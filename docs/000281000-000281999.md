# StackOverflow 问答 000281000-000281999

# sql-server - 在 SQL Server 2000 中发送电子邮件警报

> ID：281015
> 
> 赞同：1
> 
> 时间：2008-11-11T14:27:35.803
> 
> 标签：sql-server, database, sql-server-2000

您好想在检查查询结果后发送电子邮件警报，该结果将返回表中的行数。有谁知道我如何在 2005 年的 SQL Server 2000 中做到这一点，我会使用维护计划，但不确定 2000 年如何？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T14:50:06.773

几年前我这样做了 - 匆忙改编自 MS 知识库文章。我将参数更改为硬编码变量。我已经从这里删除了识别服务器名称/电子邮件地址等，但你应该能够弄清楚！

CREATE PROCEDURE [dbo].[usp_SendSuccessMail]——改编自 Microsoft 知识库文章，2006 年 1 月 16 日。

```
--   @From varchar(100) ,
 --  @To varchar(100) ,
  -- @Subject varchar(100)=" ",
   --@Body varchar(4000) =" "
/*********************************************************************

This stored procedure takes the parameters and sends an e-mail.
All the mail configurations are hard-coded in the stored procedure.
Comments are added to the stored procedure where necessary.
References to the CDOSYS objects are at the following MSDN Web site:
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cdosys/html/_cdosys_messaging.asp

***********************************************************************/
   AS
   Declare @From varchar(100) --origninally passed as parameter above. We want to hard-code it.
   Declare @To varchar(100) --origninally passed as parameter above. We want to hard-code it.
   Declare @Subject varchar(100) --origninally passed as parameter above. We want to hard-code it.
   Declare @Body varchar(4000) --origninally passed as parameter above. We want to hard-code it.
   Declare @iMsg int
   Declare @hr int
   Declare @source varchar(255)
   Declare @description varchar(500)
   Declare @output varchar(1000)
   Set @From = 'abc@xyz.com'
   Set @To = 'xyz@abc.com'
   Set @Subject = 'Whatever Subject You Want'
   Set @Body = 'Some useful text'

--************* Create the CDO.Message Object ************************
   EXEC @hr = sp_OACreate 'CDO.Message', @iMsg OUT
   IF @hr <>0 BEGIN
print 'sp_OACreate failed'
   END

--***************Configuring the Message Object ******************
-- This is to configure a remote SMTP server.
-- http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cdosys/html/_cdosys_schema_configuration_sendusing.asp
   EXEC @hr = sp_OASetProperty @iMsg, 'Configuration.fields("http://schemas.microsoft.com/cdo/configuration/sendusing").Value','2'
-- This is to configure the Server Name or IP address.
-- Replace MailServerName by the name or IP of your SMTP Server.
   EXEC @hr = sp_OASetProperty @iMsg, 'Configuration.fields("http://schemas.microsoft.com/cdo/configuration/smtpserver").Value', 'mail.xxxxxxxxxx.com'
-- Save the configurations to the message object.
   EXEC @hr = sp_OAMethod @iMsg, 'Configuration.Fields.Update', null
-- Set the e-mail parameters.
   EXEC @hr = sp_OASetProperty @iMsg, 'To', @To
   EXEC @hr = sp_OASetProperty @iMsg, 'From', @From
   EXEC @hr = sp_OASetProperty @iMsg, 'Subject', @Subject
-- If you are using HTML e-mail, use 'HTMLBody' instead of 'TextBody'.
   EXEC @hr = sp_OASetProperty @iMsg, 'TextBody', @Body
   EXEC @hr = sp_OAMethod @iMsg, 'Send', NULL
   IF @hr <>0
     BEGIN
       EXEC @hr = sp_OAGetErrorInfo NULL, @source OUT, @description OUT
       IF @hr = 0
         BEGIN
           SELECT @output = '  Source: ' + @source
           PRINT  @output
           SELECT @output = '  Description: ' + @description
           PRINT  @output
         END

     END

-- Do some error handling after each step if you have to.
-- Clean up the objects created.
    send_cdosysmail_cleanup:
If (@iMsg IS NOT NULL) -- if @iMsg is NOT NULL then destroy it
BEGIN
    EXEC @hr=sp_OADestroy @iMsg

END
ELSE
BEGIN
    PRINT ' sp_OADestroy skipped because @iMsg is NULL.'

        RETURN
END 
```

去

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T00:22:03.613

尝试这个：

```
xp_smtp_sendmail 
```

[关联](http://www.sqldev.net/xp/xpsmtp.htm)

[http://www.sqldev.net/xp/xpsmtp.htm](http://www.sqldev.net/xp/xpsmtp.htm)

我以前在生产中使用过它，效果很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T15:29:46.723

也许 CDOSYS 会满足您的需求，请查看以下链接

*   [使用 CDOSys 配置 SQL Server 2000 通知](http://code.msdn.microsoft.com/SQLExamples/Wiki/View.aspx?title=SQL2000CDOSysMail&referringTitle=DiskSpaceMon)
*   [如何在 SQL Server 中不使用 SQL Mail 发送电子邮件？](http://support.microsoft.com/kb/312839)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T14:32:20.680

因为 SQLMail 对于现实世界的使用（MAPI 等）是如此无用，所以我们最终使用了非常强大且易于使用的[SQLAnswersMail 。](http://www.sqlanswers.com/)

# asp.net - default.aspx 中的“StartTag：无效元素名称”

> ID：281017
> 
> 赞同：7
> 
> 时间：2008-11-11T14:27:59.110
> 
> 标签：asp.net, iis

（警告 - asp 新手）我有一个带有标签的 aspx 文件

```
 <%@ Page Language=VB  ... %> 
```

就在文件的开头。

从我的 IIS 服务器（[http://localhost/myservice/default.aspx](http://localhost/myservice/default.aspx)）调用它时，这给了我错误

> 此页面包含以下错误：
> 
> 第 1 行第 2 列的错误： StartTag：无效元素名称
> 下面是第一个错误之前的页面呈现。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T14:36:29.000

看起来好像浏览器试图显示它认为是 XML 文件的内容，因为它在第一行的第二个字符上给出了错误。所以我认为该文件没有被解析，而是立即按原样返回。检查您的 IIS 服务器是否配置正确，以及它是否在返回页面之前实际解析了您的 ASP 标记。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T14:43:36.083

当我进入虚拟目录的 ASP.NET 选项卡时，我注意到没有选择 ASP.NET 版本（它是一个空的组合框）。选择 .NET 框架版本就可以了。谢谢。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-06T14:23:02.537

与前面的评论类似，在我的设置中也没有选择 ASP.NET 版本。但是在选择版本后，我在访问 aspx 文件时遇到了以下错误。Windows XP、IIS 5.1。异常详细信息：System.Web.Hosting.HostingEnvironmentException：无法访问 IIS 元数据库。

执行了以下命令，aspnet_iis -i 和 aspnet_iis -ga

解决了这个问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-24T13:36:19.450

当我这样做的时候。它工作得很好。

在命令提示符 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727 中转到此目录运行此命令 Aspnet_regiis -I

这将安装 aspnet

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-18T06:13:45.280

试试这个 ：

要安装和启用 ASP.NET：

单击开始，然后单击控制面板。单击添加或删除程序。单击添加/删除 Windows 组件。双击应用程序服务器，然后单击详细信息。单击以选中 ASP.NET 复选框，然后单击确定。点击下一步。单击完成。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-08-26T19:43:08.850

对我来说，问题是当我打算使用服务器的逐字路径时，我正在使用映射到浏览器中服务器的本地文件路径查看 .svc 文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-11-27T10:48:38.167

对我来说，问题在于响应客户端的序列化。

我的问题出在 xml 标签空间中：

```
 - < tag > text < / tag >  ---> wrong

  - <tag> text </tag> ----> good. 
```

# rest - J2ME/MIDP 有一个好的 HttpClient 库吗？

> ID：281020
> 
> 赞同：6
> 
> 时间：2008-11-11T14:30:18.840
> 
> 标签：rest, java-me, midp, cldc

我想从运行在支持 MIDP 的移动设备上的 J2ME 客户端调用一些 RESTful Web 服务。我阅读了 HTTPConnections 的 MIDP api，并认为这只是需要一个简单的包装器来隐藏所有那些令人不快的字节数组等。在我自己写之前，我想知道是否已经有一个好的开源库可用。

-FE-

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T14:24:51.840

您可能想查看这个小宝石，Mobile Ajax for Java ME：

[https://meapplicationdevelopers.java.net/mobileajax.html](https://meapplicationdevelopers.java.net/mobileajax.html)

一部分是（来自网站）：

> Java ME 的异步 I/O
> 
> 该库为 Java ME 提供了与 XmlHttpRequest 等效的功能，并提供了一些对调用 RESTful Web 服务有用的附加功能。
> 
> 它位于 com.sun.me.web.path 库之上。功能包括 -
> 
> ```
> * Asynchronous versions of HTTP Get and Post
> * HTTP Basic Authentication
> * Multipart MIME (sender only)
> * Progress listeners 
> ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-18T08:50:21.463

LWUIT 1.5 现在包括用于访问 REST、使用 OAuth2、JSON 等的类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T17:23:37.727

我不知道任何这样的库，但找到了一些访问各种 RESTful Web 服务的[简洁示例](http://mobile-j2me.blogspot.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-16T18:04:40.350

由于各种原因，我们最终编写了自己的简单包装器 API，其中最重要的是我们正在开发的索尼爱立信 K750 有一个奇怪的错误（SE 拒绝修复），如果你试图得到/在设备离线时使用连接，大约 20 次以上，内部连接池将被淹没并且永远不会恢复，除非您重新启动应用程序。

# syntax-highlighting - 如何格式化演示文稿中的代码块？

> ID：281025
> 
> 赞同：159
> 
> 时间：2008-11-11T14:31:51.570
> 
> 标签：syntax-highlighting, openoffice.org, google-docs, presentation

我正在使用 Google 幻灯片准备演示文稿，但我也可以在 Open Office 中处理包含代码片段的演示文稿。

是否有任何简单的方法可以使用 Google Docs 或 Open Office Presenter 在代码片段上执行基本语法突出显示？

**编辑：**因为我相信我可以找到一种嵌入 HTML 的方法，所以任何可以在 HTML 上执行语法突出显示的工具也将是受欢迎的建议。

* * *

## 回答 #1

> 赞同：179
> 
> 时间：2012-08-24T20:52:40.693

一个在线语法高亮：

[http://hilite.me/](http://hilite.me/)

只需复制并粘贴到您的文档中。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-11T14:47:38.790

[http://www.tohtml.com/](http://www.tohtml.com/)为许多语言创建了语法高亮的 HTML 代码。这可能是您正在寻找的东西。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-12T03:27:01.473

如果您使用的是 Visual Studio（这可能也适用于 Eclipse，但我从未尝试过）并且您复制并粘贴到 Microsoft Word（或任何其他 Microsoft 产品）中，它将以您的 IDE 具有的任何颜色粘贴代码。然后，您只需将文本从 word 中复制到所需的应用程序中，它就会粘贴为富文本。

我只在 Visual Studio 和其他 Microsoft 产品中看到过这项工作，所以我不知道它是否有帮助。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-10-08T20:57:18.023

使用新[的 Google Drive 附加组件](http://googleappsupdates.blogspot.no/2014/03/bring-little-something-extra-to-docs.html)，您可以使用[Code Pretty 附加组件](https://chrome.google.com/webstore/detail/code-pretty/igjbncgfgnfpbnifnnlcmjfbnidkndnh?utm_source=permalink)突出显示代码。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-01-15T05:08:24.217

我也想过这个。最后，我的解决方案是使用[github gist](https://gist.github.com)。不要忘记它还具有突出显示功能。复制它。:)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-11T14:34:58.957

只是一些建议：

*   屏幕截图可能是一种简单的方法，但您必须确保图像中的代码足够大且足够清晰以便阅读。（不是整个截图，只是相关部分）
*   如果您可以嵌入 html，那么有很多工具可以生成语法突出显示的 html。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-11T18:14:24.973

如果您在 emacs 中编写代码，那么您可能会对[htmlize](http://web.archive.org/web/20080120061124/http://fly.srk.fer.hr/~hniksic/emacs/htmlize.el) elisp 包感兴趣。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-10-12T12:33:15.793

查看[http://codepad.org](http://codepad.org)。它可能不会解决海报的问题；但是，我认为这对阅读本文的其他人会有所帮助。

# asp.net - Visual Studio - 防止停止调试关闭 Internet Explorer

> ID：281034
> 
> 赞同：10
> 
> 时间：2008-11-11T14:35:55.163
> 
> 标签：asp.net, visual-studio

在 Visual Studio 下，如果您通过按调试工具栏上的按钮运行 Web 项目`Go`，然后通过按调试工具栏上的按钮停止它，则`Stop`Internet Explorer 将由 IDE 打开和关闭。

有没有办法阻止 IDE 在停止调试时关闭 Internet Explorer？我想这样做是为了让自己在编辑代码时可以参考 IE 中的页面内容。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-11T20:43:10.290

我发现在不调试的情况下运行一次是可行的方法。第一次，点击`CTRL`+ `F5`（不调试就启动网页）。这将打开您的浏览器并为您启动 Web 服务器。

稍后，您可以进行调试，它会使用您相同的浏览器窗口，但点击停止不会导致窗口关闭。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-11T14:45:56.440

使用菜单中的`Detach All`选项`Debug`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T14:44:43.087

这就是我的做法：获取项目的 URL，您可能必须运行一次以获取端口号并启动网络服务器（如果您使用的是内置服务器）。

然后打开浏览器会话，并输入您的 URL。

如果您想要/需要调试，那么只需在调试菜单下附加到进程，我已经设置了一个快捷方式/宏来为我执行此步骤。

# .net - “out”参数在 .NET 中是一件坏事吗？

> ID：281036
> 
> 赞同：14
> 
> 时间：2008-11-11T14:36:07.783
> 
> 标签：.net

“out”参数在 .NET 中是一件坏事吗？关于这个主题的任何好的文章/讨论？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-11T14:41:01.253

好吧，我有[一篇关于 ref/out 做什么的文章](http://pobox.com/~skeet/csharp/parameters.html)——但它没有讨论你是否应该使用它们。

基本上`out`，参数通常是您希望从方法中有效返回两个结果的标志。这*通常是*一种代码异味——但在某些情况下（尤其是 TryXXX 模式），您出于充分的理由确实想要返回两条信息，而将它们封装在一起并没有多大意义。

换句话说，在你可以轻松做到这一点的地方避免使用 out/ref，但不要为了避免它们而大费周章。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T14:38:58.277

在大多数情况下，我建议不要使用 Out 参数。它们基本上会为您的代码添加副作用，并且在调试时可能是一场噩梦。

MSDN 上有一篇关于此处可用的 Out 参数的文章：http: [//msdn.microsoft.com/en-us/library/t3c3bfhx.aspx](http://msdn.microsoft.com/en-us/library/t3c3bfhx.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T14:49:16.493

在没有元组的情况下，它们有时是最干净的做事方式。不过，我通常讨厌他们。

F# 有一些很好的语法糖来处理它们。它没有让我处理`out`参数，而是将它们视为返回元组的方法。各种`TryParse`方法最终返回两个元素元组：

```
let success, value = Int32.TryParse("1234")
(* success is true *)
(* value is 1234 *) 
```

它很方便，不会让我觉得脏。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T14:40:08.977

我认为它们在需要时非常有用。

参考和输出参数的[Msdn](http://msdn.microsoft.com/en-us/vcsharp/aa336814.aspx)文章。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T14:42:43.763

好问题。我的回答是我不是特别喜欢它们，但我确实在我的一个项目中使用了它们，其中多个返回值很常见。我有一个财务数据库，它返回实际价格（或空/零）、主要错误代码和次要错误代码。该库有几十到几百个方法，每个错误代码都是不同的类型，因此为每个创建自定义类并返回一个实例将非常笨拙。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-11T14:46:49.743

FxCop 认为这不是一个好主意……

[http://msdn.microsoft.com/en-us/library/ms182146(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms182146(VS.80).aspx)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-11T14:48:37.680

当您需要作为函数的结果返回多个对象时，Out 参数很有用。在我看来，

```
void doSomeThing(Thing toDoItTo,
                 out OtherThing result1,
                 out AnotherThing result2)
{
    ...
}

OtherThing y;
AnotherThing z;

doSomeThing(x, out y, out z);

y.method1();
z.method2(); 
```

比干净得多

```
struct DoSomeThingResults
{
    public OtherThing Result1;
    public OtherThing Result2;
}

DoSomeThingResults doSomeThing(Thing toDoItTo)
{
    ...
}

DoSomethingResults results = doSomeThing(x);

results.Result1.method1();
results.Result2.method2(); 
```

此外，使用 out 参数意味着可以保证分配结果。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2016-05-21T15:35:27.050

使用 Out 一点也不坏

让我们尝试精确的好处：

```
 using ref force us to initialize it so we are letting the ref variable to place in heap and consume some spaces .

 in most cases we return null if the operation has some none logic conditions 

 but with Out we avoid consuming the heap and refspace 
```

# c++ - parasoft C++ 单元测试题

> ID：281037
> 
> 赞同：2
> 
> 时间：2008-11-11T14:36:15.973
> 
> 标签：c++, unit-testing, parasoft

我在一个项目上工作，该项目刚刚被告知我们必须将 Parasoft C++ 单元测试工具整合到未来的任何代码更改中。我面临的问题是我们的方法更改非常小，现在看来我们被迫对整个方法进行单元测试。许多这些方法是成百上千行代码。我可以肯定地知道，如果我必须完全测试这些方法，那么我们将遇到修复空指针检查等老问题，而我们的预算和人力无法处理这些修复。

有谁知道 parasoft 是否允许您测试方法的一小部分？或者如果另一个单元测试框架会更好。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T14:50:58.970

用新方法实现你正在做的小改变，测试它。然后改变原来的调用新的方法。

您将测试更改并进行一些重构以获得更好的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-26T07:30:32.067

没有单元测试框架允许您只测试方法的一部分。

一个丑陋的建议是使用#include 将小块代码直接包含到方法中，使用相同的#include 将该代码包含到设置该代码使用的变量的测试方法中。

我推荐 Michael Feather 的《[有效地使用遗留代码》](https://rads.stackoverflow.com/amzn/click/com/0131177052)一书，以获取有关如何将测试添加到大型代码库的建议。[它也可以在Safari](http://my.safaribooksonline.com/0131177052)上在线获得。

# .net - 在查询中查找所有表名的正则表达式

> ID：281041
> 
> 赞同：10
> 
> 时间：2008-11-11T14:37:59.590
> 
> 标签：.net, sql, regex

我对正则表达式并不那么热情，它让我的小脑袋融化了一些东西。

我正在尝试在查询中查找所有表名。所以说我有查询：

```
SELECT one, two, three FROM table1, table2 WHERE X=Y 
```

我想拉出“table1，table2”或“table1”和“table2”

但是如果没有 where 语句怎么办。它可能是文件的结尾，或者可能有 group by 或 order by 等。我知道“大多数”时间这不是问题，但我不喜欢为“大多数”编码的想法情况并知道我留下了一个可能导致以后出现问题的漏洞。

这是一个可行的正则表达式吗？我是正则表达式的普通人吗？

（PS 这将在 C# 中完成，但假设这并不重要）。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-11T14:44:49.030

RegEx 在这方面不是很擅长，因为它比看起来要复杂得多：

*   如果他们使用 LEFT/RIGHT INNER/OUTER/CROSS/MERGE/NATURAL 连接而不是 a,b 语法怎么办？无论如何都应该避免使用 a,b 语法。
*   嵌套查询呢？
*   如果没有表怎么办（选择一个常数）
*   换行符和其他空白格式呢？
*   别名？

我可以继续。

您可以做的是寻找一个 sql 解析器，并通过它运行您的查询。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T14:53:15.427

一切都谈到了这种正则表达式在 SQL 上下文中的用处。如果您坚持使用正则表达式并且您的 SQL 语句总是看起来像您显示的那样（这意味着没有子查询、连接等），您可以使用

```
FROM\s+([^ ,]+)(?:\s*,\s*([^ ,]+))*\s+ 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T15:36:28.083

我发现这个网站有一个很棒的解析器！

[http://www.sqlparser.com/](http://www.sqlparser.com/)

很值得。工作一种享受。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-02-12T16:53:03.860

我参加聚会已经很晚了，但是我想我会分享一个我目前用来分析我们所有数据库对象的正则表达式，我不同意无法使用一个正则表达式来做到这一点的观点。

正则表达式有一些假设

1）您没有使用 A,B 连接语法样式

2) 无论您使用什么正则表达式解析器都支持忽略大小写。

3) 您正在分析、选择、加入、更新、删除和截断。它不支持前面提到的 MERGE/NATURAL，因为我们不使用它们，但是我相信添加进一步的支持并不难。

我很想知道该表属于哪种类型的事务，因此我包含了命名捕获组来告诉我。

现在我已经很长时间没有使用正则表达式了，所以可能会有一些改进，但是到目前为止，在我所有的测试中这是准确的。

```
\bjoin\s+(?<Retrieve>[a-zA-Z\._\d]+)\b|\bfrom\s+(?<Retrieve>[a-zA-Z\._\d]+)\b|\bupdate\s+(?<Update>[a-zA-Z\._\d]+)\b|\binsert\s+(?:\binto\b)?\s+(?<Insert>[a-zA-Z\._\d]+)\b|\btruncate\s+table\s+(?<Delete>[a-zA-Z\._\d]+)\b|\bdelete\s+(?:\bfrom\b)?\s+(?<Delete>[a-zA-Z\._\d]+)\b 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-06-04T17:02:58.100

一种解决方法是对表和视图实施命名约定。然后可以对命名前缀解析 SQL 语句。

例如：

```
SELECT tbltable1.one, tbltable1.two, tbltable2.three
FROM tbltable1
    INNER JOIN  tbltable2
        ON tbltable1.one = tbltable2.three 
```

将空格拆分为数组：

`("SELECT","tbltable1.one,","tbltable1.two,","tbltable2.three","FROM","tbltable1","INNER","JOIN","tbltable2","ON","tbltable1.one","=","tbltable2.three")`

将元素左侧移到句点：

`("SELECT","tbltable1","tbltable1","tbltable2","FROM","tbltable1","INNER","JOIN","tbltable2","ON","tbltable1","=","tbltable2")`

删除带有符号的元素：

`("SELECT","tbltable1","tbltable1","tbltable2","FROM","tbltable1","INNER","JOIN","tbltable2","ON","tbltable1","tbltable2")`

简化为唯一值：

`("SELECT","tbltable1","tbltable2","FROM","INNER","JOIN","ON")`

过滤左 3 个字符 =`"tbl"`

`("tbltable1","tbltable2")`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T14:42:47.100

这绝对不容易。

考虑子查询。

```
select
  *
from
  A
  join (
    select
       top 5 *
    from
      B)
    on B.ID = A.ID
where
  A.ID in (
    select
      ID
    from
      C
    where C.DOB = A.DOB) 
```

此查询中使用了三个表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T14:44:10.250

我认为标记字符串并查找可以绑定表名的 SQL 关键字会更容易。您知道名称会跟在 后面，但如果它们位于查询的末尾，`FROM`它们后面可以跟`WHERE`, `GROUP BY`, , 或者根本不跟关键字。`HAVING`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-12T17:05:21.967

构造一个正则表达式将是你最少的问题。根据您希望使用此代码支持的 SQL 风格，您可以在 SQL 语句中引用表的方式数量惊人。

另外，如果查询包含对视图或 UDF 的引用，则有关哪些基础表的信息甚至根本不会出现在字符串中，这使得通过解析获取该信息完全不切实际。此外，您需要聪明地检测临时表并将它们从结果中排除。

如果您必须这样做，更好的方法是使用 SQL 所针对的特定数据库引擎的 API。例如，您可以基于查询创建一个视图，然后使用 DB Server api 来检测该视图的依赖关系。数据库引擎将能够比以往任何时候都更可靠地解析它，而无需对查询引擎进行逆向工程。

如果您碰巧使用 SQL Server，这里有一篇关于检测该平台上的依赖关系的文章：[Finding Dependencies in SQL Server 2005](https://web.archive.org/web/1/http://blogs.techrepublic%2ecom%2ecom/datacenter/?p=277)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-09-23T16:13:39.933

这将在 insert Into 查询中提取表名：

```
(?<=(INTO)\s)[^\s]*(?=\(()) 
```

以下将做同样的事情，但选择包括连接

```
(?<=(from|join)\s)[^\s]*(?=\s(on|join|where)) 
```

如果您只想返回插入查询中保存的值，最后返回插入，请使用以下正则表达式

```
(?i)(?<=VALUES[ ]*\().*(?=\)) 
```

我知道这是一个旧线程，但它可能有助于其他人环顾四周

享受

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-06-03T00:16:39.697

我尝试了以上所有方法，但由于我使用了各种各样的查询，所以都没有奏效。我正在使用 PHP，并使用了一个名为 SQL_Parser 的 PEAR 库，但希望我的解决方案有所帮助。此外，我遇到了撇号和 MySQL 保留句子的问题，所以我决定在解析之前从查询中删除所有字段部分。

```
function getQueryTable ($query) {
    require_once "SQL/Parser.php";
    $parser = new SQL_Parser();
    $parser->setDialect('MySQL');

    // Stripping fields section
    $queryType = substr(strtoupper($query),0,6);            
    if($queryType == 'SELECT') { $query  = "SELECT * ".stristr($query, "FROM"); }
    if ($havingPos = stripos($query, 'HAVING')) { $query = substr($query, 0, $havingPos); }

    $struct = $parser->parse($query);

    $tableReferences = $struct[0]['from']['table_references']['table_factors'];

    foreach ((Array) $tableReferences as $ref) {
        $tables[] = ($ref['database'] ? $ref['database'].'.' : $ref['database']).$ref['table'];
    }

    return $tables;

} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-10-26T22:05:36.607

在 PHP 中，我使用这个函数，它返回一个数组，其中包含 sql 语句中使用的表名：

```
function sql_query_get_tables($statement){
    preg_match_all("/(from|into|update|join) [\\'\\´]?([a-zA-Z0-9_-]+)[\\'\\´]?/i",
            $statement, $matches);
    if(!empty($matches)){
        return array_unique($matches[2]);
    }else return array();
} 
```

请注意，它不适用于 a、b 连接或 schema.tablename 命名

我希望这个对你有用

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-01-20T17:48:17.683

我将此代码用作 Excel 宏来解析选择和提取表名。

我的解析假定`select from a , b , c`未使用该语法。

只需针对您的`SQL`查询运行它，如果您对结果不满意，您应该只需要几行代码即可获得您期望的结果。只需相应地调试和修改代码。

```
Sub get_tables()
    sql_query = Cells(5, 1).Value
    tables = ""

    'get all tables after from
    sql_from = sql_query

    While InStr(1, UCase(sql_from), UCase("from")) > 0

        i = InStr(1, UCase(sql_from), UCase("from"))
        sql_from = Mid(sql_from, i + 5, Len(sql_from) - i - 5)
        i = InStr(1, UCase(sql_from), UCase(" "))

        While i = 1

            sql_from = Mid(sql_from, 2, Len(sql_from) - 1)
            i = InStr(1, UCase(sql_from), UCase(" "))

        end

        i = InStr(1, sql_join, Chr(9))

        While i = 1

            sql_join = Mid(sql_join, 2, Len(sql_join) - 1)
            i = InStr(1, sql_join, Chr(9))

        end

        a = InStr(1, UCase(sql_from), UCase(" "))
        b = InStr(1, sql_from, Chr(10))
        c = InStr(1, sql_from, Chr(13))
        d = InStr(1, sql_from, Chr(9))

        MinC = a

        If MinC > b And b > 0 Then MinC = b
        If MinC > c And c > 0 Then MinC = c
        If MinC > d And d > 0 Then MinC = d

        tables = tables + "[" + Mid(sql_from, 1, MinC - 1) + "]"

    end

    'get all tables after join
    sql_join = sql_query

    While InStr(1, UCase(sql_join), UCase("join")) > 0

        i = InStr(1, UCase(sql_join), UCase("join"))
        sql_join = Mid(sql_join, i + 5, Len(sql_join) - i - 5)
        i = InStr(1, UCase(sql_join), UCase(" "))

        While i = 1

            sql_join = Mid(sql_join, 2, Len(sql_join) - 1)
            i = InStr(1, UCase(sql_join), UCase(" "))

        end

        i = InStr(1, sql_join, Chr(9))

        While i = 1

            sql_join = Mid(sql_join, 2, Len(sql_join) - 1)
            i = InStr(1, sql_join, Chr(9))

        end

        a = InStr(1, UCase(sql_join), UCase(" "))
        b = InStr(1, sql_join, Chr(10))
        c = InStr(1, sql_join, Chr(13))
        d = InStr(1, sql_join, Chr(9))

        MinC = a

        If MinC > b And b > 0 Then MinC = b
        If MinC > c And c > 0 Then MinC = c
        If MinC > d And d > 0 Then MinC = d

        tables = tables + "[" + Mid(sql_join, 1, MinC - 1) + "]"

    end

    tables = Replace(tables, ")", "")
    tables = Replace(tables, "(", "")
    tables = Replace(tables, " ", "")
    tables = Replace(tables, Chr(10), "")
    tables = Replace(tables, Chr(13), "")
    tables = Replace(tables, Chr(9), "")
    tables = Replace(tables, "[]", "")

End Sub 
```

# c++ - 类/结构成员是否总是按照声明的顺序在内存中创建？

> ID：281045
> 
> 赞同：47
> 
> 时间：2008-11-11T14:40:03.907
> 
> 标签：c++, memory, memory-alignment

[这是Rob Walker](https://stackoverflow.com/users/3631/rob-walker)[在此处](https://stackoverflow.com/questions/36455/alignment-restrictions-for-mallocfree#36466)的回答引发的一个问题。

假设我像这样声明一个类/结构：

```
struct
{ 
    char A;
    int B;
    char C;
    int D;
}; 
```

假设这些成员将在内存中完全按照该顺序声明是否安全，或者这是依赖于编译器的事情？我问是因为我一直认为编译器可以对它们做任何想做的事情。

这就引出了我的下一个问题。如果上面的例子导致内存对齐问题，为什么编译器不能隐式地把它变成这样的东西：

```
struct
{ 
    char A;
    char C;
    int B;
    int D;
}; 
```

（我主要是在询问 C++，但我也有兴趣听到 C 的答案）

### 相关话题

*   [为什么 GCC 不优化结构？](https://stackoverflow.com/questions/118068/why-doesnt-gcc-optimize-structs)

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2008-11-11T14:50:01.970

C99 §6.7.2.1 第 13 条规定：

> 在结构对象中，非位域成员和位域所在的单元的地址按声明顺序递增。

并继续说更多关于填充和地址的内容。C89 等效部分是 §6.5.2.1。

C++ 有点复杂。在 1998 和 2003 标准中，有 §9.2 第 12 条（C++11 中的第 15 条）：

> 分配没有中间访问说明符的（非联合）类的非静态数据成员，以便后面的成员在类对象中具有更高的地址。由访问说明符分隔的非静态数据成员的分配顺序未指定 (11.1)。实现对齐要求可能会导致两个相邻的成员不会被立即分配；管理虚拟功能 (10.3) 和虚拟基类 (10.1) 的空间要求也是如此。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T14:46:16.970

数据成员按声明的顺序排列。编译器可以随意散布填充以安排它喜欢的内存对齐方式（您会发现许多编译器都有一个对齐规范选项——如果混合不同程序编译的位时很有用。）。

另请参阅[为什么 GCC 不优化结构？](https://stackoverflow.com/questions/118068/why-doesnt-gcc-optimize-structs).

* * *

看来这个答案对于 C++ 来说有些过时了。你每天都会学到一些东西。谢谢 aib，内曼加。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T14:46:14.910

我不能代表 C++，但在 C 中，保证顺序与结构中声明的内存顺序相同。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-11T14:47:09.370

基本上，您只能指望具有[标准布局](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n2102.html)的类。严格来说，标准布局是 C++0x 的东西，但实际上只是标准化现有的做法/

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T14:51:30.220

除了对齐填充之外，任何编译器（我知道）都不允许对 C 或 C++ 进行结构优化。我不能代表 C++ 类，因为它们可能完全是另一种野兽。

考虑您的程序正在与 Windows 上的系统/库代码交互，但您想使用 GCC。您必须验证 GCC 是否使用了相同的布局优化算法，以便在将所有结构发送到 MS 编译代码之前正确打包它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T15:10:45.670

在浏览右侧的相关主题时，我查看了[这个问题](https://stackoverflow.com/questions/127290/is-it-possible-to-subclass-a-c-struct-in-c-and-use-pointers-to-the-struct-in-c)。在考虑这些问题时，我认为这可能是一个有趣的极端案例（除非它比我意识到的更常见）。

解释一下，如果你在 C 中有一个看起来像这样的结构：

```
struct foo{}; 
```

并在 C++ 中像这样子类化它（使用单独的编译单元）：

```
extern "C" foo;
struct bar: public foo{}; 
```

[由于aib](https://stackoverflow.com/questions/281045/do-classstruct-members-always-get-created-in-memory-in-the-order-they-were-decl#281082)提到的原因，内存对齐不一定相同（即使在来自同一供应商的编译器中）。

# c++ - Win32 WriteProcessMemory() 神奇的偏移值

> ID：281060
> 
> 赞同：0
> 
> 时间：2008-11-11T14:45:00.513
> 
> 标签：c++, winapi, visual-c++, virtualalloc

我正在尝试读取另一个进程拥有的 Win32 ListView 中的数据。不幸的是，我的 WriteProcessMemory() 调用失败并出现错误“此系统不支持此函数”。当我在 VirtualAlloc() 调用中为基地址指定“NULL”时。但是，如果我将 VirtualAlloc() 地址偏移了某个“神奇”值，而这些值我很幸运并在沮丧的时刻随机选择，那么该调用在我的系统上有效，但在其他系统上失败。（见下面的代码）

任何人都可以建议这个神奇的抵消对我有什么作用吗？通过反复试验，我可以找到适用于特定系统的值，但我找不到此问题的通用解决方案。

谢谢，保罗

```
#define MAGIC_OFFSET (DWORD)0x01020000

LVHITTESTINFO hti   = { 0 };
hti.pt              = clientPoint;

LPVOID lpBuffer = ::VirtualAlloc( NULL, 1, MEM_RESERVE, PAGE_READWRITE );
::VirtualFree( lpBuffer, 0, MEM_RELEASE );

lpBuffer = ::VirtualAlloc( (LPVOID)((DWORD)lpBuffer + MAGIC_OFFSET), sizeof( hti ), MEM_RESERVER, PAGE_READWRITE );
DWORD dwBuffer = (DWORD)lpBuffer + MAGIC_OFFSET - sizeof( hti );

if( !::WriteProcessMemory( hProcess, (LPVOID)dwBuffer, (LPVOID)&hti, sizeof( hti ), NULL ) )
    return 0;

if( ListView_HitTest( hWndListView, (LPVOID)dwBuffer ) < 0 )
    return 0;

if( !::ReadProcessMemory( hProcess, (LPVOID)dwBuffer, (LPVOID)&hti, sizeof( hti ), NULL ) )
    return 0;

::VirtualFree( lpBuffer, 0, MEM_RELEASE ); 
```

澄清（由 Cd-MaN 添加）：这是在 Windows Mobile 平台上，可能是非 x86 架构。所以情况可能会有所不同（ARM处理器中是否有单独的地址空间？）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T18:53:42.493

与其尝试在另一个进程中分配内存，不如使用命名共享内存。本文将带您了解[共享内存](http://msdn.microsoft.com/en-us/library/aa366551(VS.85).aspx)的基本设置，并快速检查以确保[Windows Mobile 5](http://msdn.microsoft.com/en-us/library/aa366551(VS.85).aspx)支持这些功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T15:06:48.720

VirtualAlloc 在**您**的地址空间中分配内存。在写入另一个进程的内存空间时使用该地址是绝对无效的。您应该改用[VirualAllocEx](http://msdn.microsoft.com/en-us/library/aa366907(VS.85).aspx)并传入 hProcess。

当它起作用时，您只是幸运并在一些随机的内存上乱涂乱画。

如果在查询另一个进程时不支持为 VirtualAllocEx 的第一个参数指定 NULL（不知道它是否存在）......那么您可以使用[VirtualQueryEx](http://msdn.microsoft.com/en-us/library/aa366907(VS.85).aspx)来映射另一个进程的地址空间和找到一个有效的空闲区域以传递给 VirtualAlloc。

您可能不得不将其置于重试循环中，因为在您寻找空位时，其他进程地址空间的状态可能会发生变化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T15:23:46.377

您必须记住，您正在写入程序的*虚拟*地址空间。在 Windows 上，它通常从一个地址开始，比如你的幻数。

你调试过程序吗？地址是什么样的？

在我的系统上，可执行文件通常在 00400000 或 01000000 左右加载。它从可执行文件更改为可执行文件，我相信即使在连续运行同一可执行文件时 Windows 也有能力更改此地址。

此外，可执行文件的部分有自己的（并且相对较小的）偏移量。例如，代码部分通常在 +1000 左右，然后是数据、归零数据部分等。

这一切的意思是，如果您的可执行文件的基数为 00400000，并且其数据部分的偏移量为 +2000，则数据的第一个字节将位于 00402000。为了读取/写入此字节，您必须指定基地址 00402000，不是 2000，也绝对不是 0。

尝试打印指针的值。如果指向的对象具有静态生命周期，它可能会驻留在数据部分中，并且您将获得类似 00402000 的地址。然后，如果您将进程内存写入该地址，您将修改该对象。

各种 Win32 可执行格式都包含这个“0040000”基地址以及各个部分的偏移量，但是由于这种读取​​另一个进程的内存的黑客可能会针对特定可执行文件的特定版本，所以你可能会更好只留下幻数。

# javascript - jQuery 工具提示在 IE 中不起作用

> ID：281067
> 
> 赞同：1
> 
> 时间：2008-11-11T14:46:51.507
> 
> 标签：javascript, jquery, internet-explorer, tooltip

我正在使用 jquery 工具提示，这是它的代码

**Javascript**：

```
this.tooltip = function()
{   
    var xOffset = -10;
    var yOffset = -175;     

    $("a.tooltip").hover(function(e)
    {                                             
        this.t = this.title;
        this.title = "";
        var breakdownData = "";
        var header = "<b>This document contains:</b><br />";

        switch(this.id)
        {
            case '_ctl0_MasterContentPlaceHolder_hpl_DownloadCCPS1':
                breakdownData = "<div style='padding-left:30px;'><br /></div>";
                break;
            case '_ctl0_MasterContentPlaceHolder_hpl_DownloadCCPS2':
                breakdownData = "<div style='padding-left:30px;'></div>";
                break;
            case '_ctl0_MasterContentPlaceHolder_hpl_DownloadCCPS3':
                breakdownData = "<div style='padding-left:30px;'></div>";
                break;
            case '_ctl0_MasterContentPlaceHolder_hpl_DownloadCCPS4':
                breakdownData = "<div style='padding-left:30px;'></div>";
                break;
        }   

        $("body").append("<div id='tooltip' style='width:350px; padding-left:15px; font-size:11px;'>"+ header + breakdownData +"</div>");
        $("#tooltip").css("top",(e.pageY - xOffset) + "px")
                     .css("left",(e.pageX + yOffset) + "px")
                     .fadeIn("fast");       
        }, function() {
            this.title = this.t;
            $("#tooltip").remove();
        }); 

        $("a.tooltip").mousemove(function(e) {
            $("#tooltip").css("top",(e.pageY - xOffset) + "px")
                         .css("left",(e.pageX + yOffset) + "px");
        });         
    };
}

$(document).ready(setTimeout("tooltip()", 500)); 
```

**CSS**：

```
 #tooltip
 {
     position:absolute;
     border:1px solid #333;
     background:#f7f5d1;
     padding:2px 5px;
     color:#333;
     display:none;
     width:350px;
 } 
```

我需要做的就是将工具提示类添加到在 Firefox 中可以正常工作但在 IE 中无法正常工作的锚标记。有没有其他人经历过这个？

这是原始链接，似乎可以正常工作[http://cssglobe.com/lab/tooltip/01/](http://cssglobe.com/lab/tooltip/01/)

谢谢你

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T16:05:30.850

我能够在 FF3、IE6 和 IE7 中很好地测试它。您遇到什么问题？

但是，我确实收到了 Firebug 中的一个错误：

```
fn.call 不是函数 jquery-1.2.6.js 第 2295 行
    jQuery.readyList.push(function() { return fn.call(this, jQuery); } );

```

这导致我将您的 $(document).ready 函数更改为：

```
$(文档).ready(函数(){
    设置超时（“工具提示（）”，500）
});

```

不确定这是否会解决您的问题，但请尝试一下。

# c# - .net 会员提供者使用什么加密算法？

> ID：281068
> 
> 赞同：2
> 
> 时间：2008-11-11T14:47:07.373
> 
> 标签：c#, security, asp.net-membership

我正在查看 .net 会员提供程序的源代码，它在 sqlmembershipprovider.cs 中有对 EncryptPassword 和 DecryptPassword 的调用，但我在源代码中的任何地方都看不到该方法。

他们使用什么算法？那个源不是也放出来了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T14:56:27.057

SqlMembershipProvider 派生自 MembershipProvider，从中继承 EncryptPassword() 和 DecryptPassword()。

查看带有 Reflector 的代码，如果密钥为 8 字节长，则该算法看起来是 DES，否则为 AES (Rijndael)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T14:56:41.800

SqlMembershipProvider 使用 System.Web.Security.MembershipProvider 作为其基类。正在基类上调用 EncryptPassword 和 DecryptPassword 方法。

启动 .NET Reflector 并将其指向 System.Web.Security.MembershipProvider，您将看到他们是如何做到的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T14:58:41.513

虽然加密代码是“公开的”，但会员提供者的默认加密是基于唯一的机器密钥。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T15:04:26.323

很确定基本 Decrypt/EncryptPassword 使用 AES 的标准 .NET 实现，可能在某处定义了一个密钥，可能是特定于机器的

请参阅[AesManaged](http://msdn.microsoft.com/en-us/library/system.security.cryptography.aesmanaged.aspx)类。

# delphi - 将使用 Png 图像的项目转换为 D2009

> ID：281074
> 
> 赞同：4
> 
> 时间：2008-11-11T14:47:56.730
> 
> 标签：delphi, delphi-2009

使用 Gustavo Daud 的（不再）免费提供的 TPngImage 的任何人都尝试将他们的项目移植到 Delphi 2009？

在我的情况下，在 D2009 中打开表单时，似乎所有在 D2007 中显示得很好的 TImage png 图像现在都是空白的（如果我在 D2009 中重新添加图像，保存表单并在 D2007 中打开它，那么图像是空白的再次）。

比较完全相同图像的 D2007 和 D2009 之间的 Picture.Data 表明数据不同。

有人注意到这个问题吗？我的所有项目都有几十个 png 图像，我不想在 D2009 中重新添加它们并失去向后兼容性。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T15:33:34.877

几分钟前我刚刚阅读了这个博客，然后才看到你的问题，我认为它解决了同样的问题：

[转换为 D2009：如何在 TImage 中保留 PNG](http://blog.digivendo.com/)

# windows-mobile - 使 Windows Mobile 设备模拟蓝牙 HID 设备

> ID：281081
> 
> 赞同：2
> 
> 时间：2008-11-11T14:50:00.783
> 
> 标签：windows-mobile, hid

我正在寻找一种通过蓝牙将 Windows Mobile 设备连接到 PC 并将其作为 HID 设备（即键盘或鼠标）显示在 PC 上的方法。我想这主要是修改 Windows Mobile 设备上可用的蓝牙配置文件以便它公开蓝牙 HID 接口的问题......这甚至可能吗？它是否需要自定义驱动程序或 WinMo 设备上的其他东西？在大多数情况下，我的主要要求是在 PC 端不需要任何特殊软件，它应该简单地使用内置的蓝牙堆栈，并认为 WinMo 设备实际上是 HID 设备而不是 PDA。

我有具有条形码扫描功能的 WinMo 设备，所以我希望能够使用 PDA 使用 HID 接口将条形码扫描到 PC。

另外，我主要使用 C++ 和 C#，所以如果可以用其中一种语言完成，那将是最好的。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T17:27:00.013

这是完全可能的。只需启动使用 HID 服务 Guid {00001124-0000-1000-8000-00805f9b34fb} 注册的蓝牙服务器。如果设备支持 Microsoft 蓝牙堆栈，您可以使用 Peter Foot 出色的 .NET CF 库（[http://32feet.net/](http://32feet.net/)）和 BluetoothService.HumanInterfaceDevice；

更新：

使用 Peter Foot 的库，服务器看起来像这样：

```
using System.IO;
using InTheHand.Net.Sockets;
using InTheHand.Net.Bluetooth;

// ...

BluetoothListener l = new BluetoothListener(
    BluetoothService.HumanInterfaceDevice);
using (l) {
    BluetoothClient c = l.AcceptBluetoothClient();
    using (c) {
        Stream s = c.GetStream();
        using (s) {
            // send HID bytes
        }
    }
} 
```

问候，坦伯格

# nhibernate - NHibernate：在运行时访问配置属性（Sql 方言）

> ID：281095
> 
> 赞同：7
> 
> 时间：2008-11-11T14:52:50.903
> 
> 标签：nhibernate, hibernate

我想在运行时检索配置文件中指定的“方言”和“connection.driver_class”属性的值。

你知道怎么做吗？

非常感谢，尼古拉

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-14T08:50:03.997

感谢您的回答。在该解决方案中我不喜欢的一件事是我需要保留配置并在需要方言知识的方法中传递它。

我发现了其他几种方法，只需要引用 ISessionFactory 的 ISession。

来自 ISession：

```
 public static Dialect GetDialect(ISession session)
    {
        Dialect dialect = session.GetSessionImplementation().Factory.Dialect;
        return dialect;
    } 
```

从 ISessionFactory：

```
 public static Dialect GetDialect(ISessionFactory sessionFactory)
    {
        var implementor = sessionFactory as ISessionFactoryImplementor;
        Dialect dialect = implementor.Dialect;
        return dialect;
    } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T15:22:41.920

当您构建 Configuration 对象并加载 XML 并最终构建 SessionFactory 时，请继续使用您拥有的 Configuration 对象引用。

您可以使用您拥有的配置参考的属性对象，或者您可以执行类似 Dialect.GetDialect(_configuration.Properties) 之类的操作。

# c++ - MySQL 和 C 应用程序

> ID：281101
> 
> 赞同：3
> 
> 时间：2008-11-11T14:54:19.230
> 
> 标签：c++, c, linux, coding-style, mysql4

在使用 C/C++ 在 linux 上构建访问 MySQL 数据库的应用程序时，我必须动态链接到 mysql 客户端库。有没有一种方法可以静态链接应用程序，从而不再需要 mysql 客户端库？

关于 C\C++ 开发，在应用程序中但在代码之外包含相当长的查询的最佳实践是什么？由于数据库在 MySQL 4 服务器上运行，因此无法使用存储过程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T18:33:05.840

应该很容易创建静态 mysql 客户端库。如果您下载了源代码，您只需要确保正确配置它：静态链接到您的可执行文件。

您需要您的可执行文件在 GPL 下获得许可，或者您需要从 MySQL 人员那里购买适当的许可。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T05:03:14.437

以下编译命令行对我有用，可以静态链接 mysql 客户端库：

```
gcc -I/usr/include/mysql -c mysql.c
gcc -o mysql mysql.o -static -lmysqlclient -static-libgcc -lm -lz -lpthread 
```

但是，我收到了以下警告，这对您来说可能是也可能不是问题。似乎是说目标机器具有与您的构建机器相同的 glibc 版本。

```
/usr/lib/gcc/i486-linux-gnu/4.2.4/../../../../lib/libmysqlclient.a(mf_pack.o): In function `unpack_dirname':
(.text+0x6cc): warning: Using 'getpwnam' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
/usr/lib/gcc/i486-linux-gnu/4.2.4/../../../../lib/libmysqlclient.a(libmysql.o): In function `read_user_name':
(.text+0x5ed7): warning: Using 'getpwuid' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
/usr/lib/gcc/i486-linux-gnu/4.2.4/../../../../lib/libmysqlclient.a(mf_pack.o): In function `unpack_dirname':
(.text+0x6e1): warning: Using 'endpwent' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
/usr/lib/gcc/i486-linux-gnu/4.2.4/../../../../lib/libmysqlclient.a(my_gethostbyname.o): In function `my_gethostbyname_r':
(.text+0x3c): warning: Using 'gethostbyname_r' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
/usr/lib/gcc/i486-linux-gnu/4.2.4/../../../../lib/libmysqlclient.a(libmysql.o): In function `mysql_server_init':
(.text+0x695d): warning: Using 'getservbyname' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking 
```

# file-io - Applescript 应用程序从文件中读取

> ID：281108
> 
> 赞同：4
> 
> 时间：2008-11-11T14:56:38.150
> 
> 标签：file-io, applescript

我有一个已编译的 AppleScript 应用程序，已移动到我的 Windows 服务器。然后我想在应用程序中插入一个文本文件（在 Windows 上看起来像一个 zip 文件）：

```
myapplescript.app/Contents/Resources/MyNewDir/MyTxtFile.txt 
```

因此，我已经预编译了 AppleScript 以尝试从该文本文件中读取并将内容作为字符串获取。这就是我所做的：

```
set theFolder to POSIX path of (the path to me)
set theFile to theFolder & "Contents/Resources/MyNewDir/MyTxtFile.txt"
open for access theFile
set fileContents to (read theFile)
close access theFile 
```

但这是我得到的错误：

> 无法将“/Users/mike/Desktop/myapplescript.app/Contents/Resources/MyNewDir/MyTxtFile.txt”转换为类型文件

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-12T15:32:03.193

好的，我想通了，我将第二行更改为：

```
set theFile to (POSIX file (theFolder & "Contents/Resources/MyNewDir/MyTxtFile.txt")) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-04-01T22:10:04.157

read 还有一个单行版本：

```
read POSIX file "/tmp/test.txt" as «class utf8» 
```

两个版本都使用 MacRoman，除非您添加`as «class utf8»`. （`as Unicode text`是 UTF-16。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-10-19T06:21:47.710

通过变量中的文件路径读取文件。

第一个两个工作。第三个，它将文件名存储在变量中。

将 myData 设置为读取文件 POSIX 文件 ¬“/Users/sww/Devel/afile.csv”

将 myData 设置为读取文件 ¬“Macintosh HD:Users:sww:Devel:afile.csv”

```
set fRef to "Macintosh HD:Users:sww:Devel:afile.csv"

set myData to read file fRef  -- No good 
```

修理？将文件引用作为字符串提供。

```
set myData to read file (fRef as string)  -- OK 
```

# vbscript - 如何使用 vbscript 将一个文件中的文本替换为另一个文件中的文本？

> ID：281111
> 
> 赞同：1
> 
> 时间：2008-11-11T14:57:19.083
> 
> 标签：vbscript

如何使用 vbscript 将一个文件中的文本替换为另一个文件中的文本？

被替换的文本位于文件中间的某个位置。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T15:06:13.480

filea.txt：你好残酷的世界

fileb.txt：残忍

filec.txt：开心

将在以下执行后使 sResult = "hello happy world"。

```
Dim oFSO
Dim sFileAContents
Dim sFileBContents
Dim sFileCContents
Dim sResult
Set oFSO = CreateObject("Scripting.FileSystemObject")
sFileAContents = oFSO.OpenTextFile("c:\filea.txt").ReadAll()
sFileBContents = oFSO.OpenTextFile("c:\fileb.txt").ReadAll()
sFileCContents = oFSO.OpenTextFile("c:\filec.txt").ReadAll()
sResult = Replace(sFileAContents, sFileBContents, "") 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-27T00:11:18.337

FileToSearch 是包含要搜索
替换文本的文件 FileReplaceText 是包含替换文本的文件

编辑变量 strTextToFind 的值以包含您正在搜索和替换的文本

```
Dim objFSO
Dim strFileToSearch
Dim strFileReplaceText

Dim strTextToFind
Dim strTextToSearch
Dim strTextReplaceText
Dim strFinalText

    strFileToSearch = "C:\FileToSearch.txt"
    strFileReplaceText = "C:\FileReplaceText.txt"

    strTextToFind = "text to search for here"

    Set objFSO = CreateObject("Scripting.FileSystemObject")  
    strTextToSearch = objFSO.OpenTextFile(strFileToSearch).ReadAll()  
    strFileReplaceText = objFSO.OpenTextFile(strFileReplaceText).ReadAll()  

    strFinalText = Replace(strTextToSearch, strTextToFind, strFileReplaceText) 
```

如果您想将此最终文本写回文件，请添加以下代码：

```
Const ForWriting = 2
Dim strFileFinalOutput

    strFileFinalOutput = "C:\FileFinalOutput.txt"

    Set objTextFile = objFSO.OpenTextFile(strFileFinalOutput, ForWriting, True)
    objTextFile.Write strFinalText
    objTextFile.Close
    Set objTextFile = Nothing 
```

此代码将整个文件读入内存 (.ReadAll)，并且在处理非常大的文件时可能会遇到问题。在这种情况下，可以编辑代码以逐行读取/搜索/替换/写入数据。

如果您要搜索的文本不是连续的并且都在同一行，那么搜索/替换过程会更复杂，并且此代码将需要额外的工作来处理它。

# .net-3.5 - 可观察队列？

> ID：281119
> 
> 赞同：0
> 
> 时间：2008-11-11T15:00:07.253
> 
> 标签：.net-3.5, queue, inotifycollectionchanged

有没有人编写过实现 INotifyCollectionChanged 的​​ .Net 通用队列版本，或者是否已经在 .Net 框架深处某个地方隐藏了一个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T15:09:27.843

快速搜索没有显示任何结果。但是接口很简单，扩展 Queue 类并添加对接口的支持几乎是微不足道的。因此只需覆盖所有方法：

```
// this isn't the best code ever; refactor as desired
protected void OnCollectionChanged( NotifyCollectionChangedEventArgs ccea){
  var temp = CollectionChanged;
  if(temp != null) temp(this, ccea);  
}

// and later in the class

public override SomeMethodThatAltersTheQueue(object something){
  // record state of collection prior to change
  base.SomeMethodThatAltersTheQueue(something)
  // create NotifyCollectionChangedEventArgs with prior state and new state
  OnCollectionChanged(ccea);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-18T00:49:24.560

我使用了与 Chris Wenham 相同的方法。在负载下，性能会受到影响，因为需要为每个 Enqueue/Dequeue 分配新的 NotifyCollectionChangedEventArgs。

无论如何，在 Enqueue 中，使用 NotifyCollectionChangedAction.Add、添加的项目和 Count-1 作为索引发送 args。在 Dequeue 中，发送带有 NotifyCollectionChangedAction.Remove 的 args、已删除的项目和索引 0。

# java - 是否可以使用 HashCodeBuilder 和 EqualsBuilder 使 eclipse 生成 hashCode 和 equals

> ID：281121
> 
> 赞同：12
> 
> 时间：2008-11-11T15:00:58.313
> 
> 标签：java, eclipse

默认生成的 hashCode 和 equals 实现充其量是丑陋的。

是否可以让 eclipse 从 HashCodeBuilder 和 EqualsBuilder 生成一个，甚至可能是一个带有 ToStringBuilder 的 toString？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-11T15:16:46.767

看看[Commons4E](http://marketplace.eclipse.org/content/commons4e)

它已经有一段时间没有更新了，但是我猜它需要改变很多吗？

更新：刚刚检查了 3.4.1，它工作正常。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-08-07T20:16:03.103

您可以将 Eclipse 配置为`toString()`使用自定义构建器生成。在我们的例子`ToStringBuilder`中来自[Apache Commons Lang](http://commons.apache.org/lang/)。你可以在这里看到[http://azagorneanu.blogspot.com/2011/08/how-to-generate-equals-hashcode.html](http://azagorneanu.blogspot.com/2011/08/how-to-generate-equals-hashcode.html)怎么做。

该博客文章还包含用于生成`equals()`和使用 Apache Commons Lang 构建器`hashCode()`的Eclipse 模板。`compareTo()`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T15:22:42.247

您可以使用 Eclipse 中的代码模板来做到这一点。

这是我在 HashCodeBuilder 和 EqualsBuilder 示例中找到的[解决方案。](http://www.jroller.com/Fester/?page=1)

模板 EqualsBuilder：

```
 public boolean equals(Object o) {
        boolean result = false;

        if (this == o) {
            result = true;
        } else if (o instanceof $CLASSNAME$) {
            $CLASSNAME$ other = ($CLASSNAME$) o;

            result = new org.apache.commons.lang.builder.EqualsBuilder()
                    .append($END$
                    .isEquals();
        }

        return result;
    } 
```

模板 HashCodeBuilder：

```
 public int hashCode() {
        return new org.apache.commons.lang.builder.HashCodeBuilder()
                .append( $END$ )
                .toHashCode();
    } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-08T21:55:09.113

我使用名为“Commonclipse”的 Eclipse 插件

安装后，当您在 Java 源文件中单击鼠标右键时，您会看到一个新的上下文菜单项“commonclipse”。它可以基于 Apache 公共库生成 equals、hashcode、toString 和 compareTo 方法。

要安装它，请在 Eclipse 更新中使用它：http: [//commonclipse.sourceforge.net](http://commonclipse.sourceforge.net)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-04-07T20:07:43.173

我制作了这个模板，检查了几个答案、网站并在 Eclipse Luna 上对其进行了测试。转到 Windows->Preferences，然后转到 Java->Editor->Templates 并将其添加到那里。

```
${:import(org.apache.commons.lang3.builder.HashCodeBuilder, org.apache.commons.lang3.builder.EqualsBuilder)}
@Override
public int hashCode() {
    HashCodeBuilder hashCodeBuilder = new HashCodeBuilder();
    hashCodeBuilder.append(${field1:field});
    hashCodeBuilder.append(${field2:field});
    hashCodeBuilder.append(${field3:field});
    hashCodeBuilder.append(${field4:field});
    hashCodeBuilder.append(${field5:field});
    return hashCodeBuilder.toHashCode();
}

@Override
public boolean equals(Object obj) {
    if (this == obj) {
        return true;
    }
    if (obj == null) {
        return false;
    }
    if (getClass() != obj.getClass()) {
        return false;
    }
    ${enclosing_type} rhs = (${enclosing_type}) obj;
    EqualsBuilder equalsBuilder = new EqualsBuilder();
    equalsBuilder.append(${field1}, rhs.${field1});
    equalsBuilder.append(${field2}, rhs.${field2});
    equalsBuilder.append(${field3}, rhs.${field3});
    equalsBuilder.append(${field4}, rhs.${field4});
    equalsBuilder.append(${field5}, rhs.${field5});${cursor}
    return equalsBuilder.isEquals();
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-03-25T09:49:40.017

Eclipse 3.5.0 的 Eclipse java 代码模板，源自 Bruno Conde 的模板：

```
@Override
public boolean equals(Object obj) {
    if (obj == null) {
        return false;
    } else if (obj == this) {
        return true;
    } else if (obj.getClass() != this.getClass()) {
        return false;
    }

    ${enclosing_type} other = (${enclosing_type}) obj;
    return new EqualsBuilder()//
            .appendSuper(super.equals(other))//
            .append(${cursor})//
                .isEquals();
} 
```

和

```
@Override
public int hashCode() {
    return new HashCodeBuilder(${cursor})//
            .append()//
            .toHashCode();
} 
```

# ruby-on-rails - Rails：为循环的每次迭代从表中获取数据

> ID：281123
> 
> 赞同：29
> 
> 时间：2008-11-11T15:01:42.973
> 
> 标签：ruby-on-rails, ruby, model-view-controller

我有一个循环（for item in @dataset），我希望在每次迭代中从另一个表中获取不同的数据并进行一些将在视图中打印的操作。我无法从循环中使用的数据集中获取这些数据。

如何根据 MVC 做到这一点？我可以将代码放入循环中，在视图中，但我认为这很可怕。

我必须使用助手来执行此操作，并从视图中调用该函数吗？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-11-11T20:55:45.897

如果您有一个表，并且想从另一个表中获取数据，通常是在`has_many`关系的情况下。例如，我们有`@people`（`Person`模型），每个人的`has_many`地址（`Address`模型）。在这些情况下，最好的办法就是这样做

```
# Controller
@people = Person.find(:all, :include => :addresses)
...

# View
@people.each do |p|
  p.addresses.each do |address|
    ... 
```

如果您的数据不只是普通的数据库表（也许您从 Web 服务等获取），那么最好提前在控制器中构建所有数据，然后将其传递给视图. 像这样的东西

```
# Controller
@people = Person.find(:all)
@people.each do |p|
  # attach loaded data to the person object in controller
  p.addresses = Address.load_from_somewhere_by_name(p.name)
... 
```

这样视图代码保持干净，如下所示：

```
# View
@people.each do |p|
  p.addresses.each do |address|
    ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T15:29:41.390

如果没有有关数据和模型（表）之间关系的详细信息，很难说出问题的最佳解决方案。接下来是一个共同的想法：保持你的观点愚蠢。获取在控制器操作中呈现视图所需的所有数据。在同一操作中进行所有更改和计算。然后在视图中使用此数据。

顺便说一句，如果您谈论的是 N+1 问题，那么请阅读有关“包含”和“加入”ActiveRecord 参数的更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T18:11:12.453

如果我是你，我会创建一个单独的类来封装数据集并包含处理数据集条目所涉及的所有逻辑。这个类可以是可迭代的（响应每个）。然后我会将这个类的一个实例传递给视图并在那里只使用它的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-28T09:53:05.467

```
Person(id, name, other fields...)
Event(id, title, ...)
Date(id, date, time, event_id, ...)
Disponibility(id, percent, date_id, person_id, ...) 
```

Of course, all the relationships are defined in the Model.

I have a view that shows all the dates for a event, it's easy. But I want, for each date, to print the data for all the people whose are available for that date. In my view, forgetting MVC design pattern, I could code something like this:

```
<% for date in @Dates 
  available = Disponibility.find_by_date_id(date.id)
  for item in available
    guy = Person.find_by_id(item.person_id)
%> 
```

Render date and people available...

I want to avoid this in the view. I think the Orion Edwards' answer is the nearest for what I need, but, in that example, address is an empty field for Person table? Or how can I append a new attribute to Person class?

Although, am I missing any SQL trick for do this?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T16:25:52.463

*   将 @dataset 项上的所有逻辑保留在控制器操作中
*   利用模型中的方法与您需要的其他模型对象进行交互
*   您应该只为您的视图留下@dataset，您可以在部分中呈现。

您需要进一步解释您的情况以获得更多答案。您需要与什么样的操作和其他模型进行交互？如果您发布您的模型协会，我相信我们真的可以让您远离。

祝你好运！

# java - Java volatile 引用与 AtomicReference

> ID：281132
> 
> 赞同：146
> 
> 时间：2008-11-11T15:04:26.650
> 
> 标签：java, concurrency

`volatile`对象引用和`AtomicReference`我只使用`get()`and `set()`-methods from之间有什么区别`AtomicReference`吗？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-11-11T15:17:05.580

简短的回答是：不。

从[`java.util.concurrent.atomic`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/atomic/package-summary.html)包文档。去引用：

> 原子访问和更新的记忆效应通常遵循 volatile 的规则：
> 
> *   `get`具有读取`volatile`变量的记忆效应。
> *   `set`具有写入（分配）`volatile`变量的记忆效应。

顺便说一句，该文档非常好，并且对所有内容都进行了解释。

* * *

[`AtomicReference::lazySet`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/atomic/AtomicReference.html#lazySet(V))是一种较新的（Java 6+）操作，其语义无法通过`volatile`变量实现。有关更多信息，请参阅[此帖子](https://stackoverflow.com/a/1468020/591495))。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-11-11T15:20:33.983

不，那里没有。

AtomicReference 提供的额外功能是 compareAndSet() 方法和朋友。如果您不需要这些方法，可变引用提供与 AtomicReference.set() 和 .get() 相同的语义。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2017-07-19T10:10:38.117

有几个区别和权衡：

1.  使用`AtomicReference`get/set 具有与 volatile 字段相同的**JMM 语义**（如 javadoc 所述），但它`AtomicReference`是引用的包装器，因此**对该字段的任何访问都涉及进一步的指针追踪**。

2.  **内存占用成倍增加**（假设一个压缩的OOP 环境，对于大多数 VM 来说都是如此）：

    *   易失性参考 = 4b
    *   `AtomicReference`= 4b + 16b（12b 对象头 + 4b 参考字段）
3.  `AtomicReference`提供比 volatile 参考更丰富的 API。`AtomicFieldUpdater`您可以使用或使用 Java 9 a重新获得 volatile 引用的 API `VarHandle`。`sun.misc.Unsafe`如果你喜欢用剪刀跑步，你也可以直接伸手去拿。`AtomicReference`本身是使用`Unsafe`.

那么，什么时候最好选择一个而不是另一个：

*   只需要获取/设置？坚持使用易变字段、最简单的解决方案和最低的开销。
*   需要额外的功能？`AtomicReference`如果这是代码的性能（速度/内存开销）敏感部分`AtomicFieldUpdater`，请`Unsafe`在您倾向于为可读性和性能增益风险付出代价之间做出选择。如果这不是一个敏感区域，那就去吧`AtomicReference`。库编写者通常根据目标 JDK、预期的 API 限制、内存限制等混合使用这些方法。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-02-03T15:24:41.673

[JDK 源代码](http://download.java.net/openjdk/jdk7/)是解决此类困惑的最佳方法之一。如果您查看 AtomicReference 中的代码，它使用 volatie 变量进行对象存储。

```
private volatile V value; 
```

所以，很明显，如果你打算只在 AtomicReference 上使用 get() 和 set() ，那就像使用 volatile 变量一样。但正如其他读者评论的那样，AtomicReference 提供了额外的 CAS 语义。因此，首先决定是否需要 CAS 语义，如果只需要，则使用 AtomicReference。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-30T20:35:39.417

[`AtomicReference`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/atomic/AtomicReference.html)提供了普通 volatile 变量不提供的附加功能。当您阅读过 API Javadoc 时，您会知道这一点，但它还提供了一个锁，这对某些操作很有用。

但是，除非您需要此附加功能，否则我建议您使用普通`volatile`字段。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-06-05T09:40:41.187

有时即使您只使用获取和设置，AtomicReference 也可能是一个不错的选择：

易失性示例：

```
private volatile Status status;
...
public setNewStatus(Status newStatus){
  status = newStatus;
}

public void doSomethingConditionally() {
  if(status.isOk()){
    System.out.println("Status is ok: " + status); // here status might not be OK anymore because in the meantime some called setNewStatus(). setNewStatus should be synchronized
  }
} 
```

AtomicReference 的实现将免费为您提供写时复制同步。

```
private AtomicReference<Status> statusWrapper;
...

public void doSomethingConditionally() {
  Status status = statusWrapper.get();
  if(status.isOk()){
    System.out.println("Status is ok: " + status); // here even if in the meantime some called setNewStatus() we're still referring to the old one
  }
} 
```

有人可能会说，如果您替换以下内容，您仍然可以获得正确的副本：

```
Status status = statusWrapper.get(); 
```

和：

```
Status statusCopy = status; 
```

然而，第二个更有可能在将来“代码清理”期间被某人意外删除。

# python - 如何使用 Python 在 Mac 中控制鼠标？

> ID：281133
> 
> 赞同：37
> 
> 时间：2008-11-11T15:04:43.577
> 
> 标签：python, macos, mouse

在 OS X 上使用 Python 移动鼠标（并可能单击）的最简单方法是什么？

这只是为了快速原型设计，它不一定是优雅的。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2011-11-20T15:48:30.543

试试[这个页面](http://web.archive.org/web/20111229234504/http://www.geekorgy.com:80/index.php/2010/06/python-mouse-click-and-move-mouse-in-apple-mac-osx-snow-leopard-10-6-x/)的代码。它定义了几个函数`mousemove`和`mouseclick`，它们与 Apple 在 Python 和平台的 Quartz 库之间的集成挂钩。

此代码适用于 10.6，我在 10.7 上使用它。这段代码的好处是它会生成鼠标事件，而某些解决方案不会。我用它来控制 BBC iPlayer，方法是将鼠标事件发送到 Flash 播放器中的已知按钮位置（我知道这很脆弱）。尤其需要鼠标移动事件，否则 Flash 播放器永远不会隐藏鼠标光标。类似的功能`CGWarpMouseCursorPosition`不会这样做。

```
from Quartz.CoreGraphics import CGEventCreateMouseEvent
from Quartz.CoreGraphics import CGEventPost
from Quartz.CoreGraphics import kCGEventMouseMoved
from Quartz.CoreGraphics import kCGEventLeftMouseDown
from Quartz.CoreGraphics import kCGEventLeftMouseUp
from Quartz.CoreGraphics import kCGMouseButtonLeft
from Quartz.CoreGraphics import kCGHIDEventTap

def mouseEvent(type, posx, posy):
        theEvent = CGEventCreateMouseEvent(
                    None, 
                    type, 
                    (posx,posy), 
                    kCGMouseButtonLeft)
        CGEventPost(kCGHIDEventTap, theEvent)

def mousemove(posx,posy):
        mouseEvent(kCGEventMouseMoved, posx,posy);

def mouseclick(posx,posy):
        # uncomment this line if you want to force the mouse 
        # to MOVE to the click location first (I found it was not necessary).
        #mouseEvent(kCGEventMouseMoved, posx,posy);
        mouseEvent(kCGEventLeftMouseDown, posx,posy);
        mouseEvent(kCGEventLeftMouseUp, posx,posy); 
```

这是上面页面的代码示例：

```
##############################################################
#               Python OSX MouseClick
#       (c) 2010 Alex Assouline, GeekOrgy.com
##############################################################
import sys
try:
        xclick=intsys.argv1
        yclick=intsys.argv2
        try:
                delay=intsys.argv3
        except:
                delay=0
except:
        print "USAGE mouseclick [int x] [int y] [optional delay in seconds]"
        exit
print "mouse click at ", xclick, ",", yclick," in ", delay, "seconds"
# you only want to import the following after passing the parameters check above, because importing takes time, about 1.5s
# (why so long!, these libs must be huge : anyone have a fix for this ?? please let me know.)
import time
from Quartz.CoreGraphics import CGEventCreateMouseEvent
from Quartz.CoreGraphics import CGEventPost
from Quartz.CoreGraphics import kCGEventMouseMoved
from Quartz.CoreGraphics import kCGEventLeftMouseDown
from Quartz.CoreGraphics import kCGEventLeftMouseDown
from Quartz.CoreGraphics import kCGEventLeftMouseUp
from Quartz.CoreGraphics import kCGMouseButtonLeft
from Quartz.CoreGraphics import kCGHIDEventTap
def mouseEventtype, posx, posy:
        theEvent = CGEventCreateMouseEventNone, type, posx,posy, kCGMouseButtonLeft
        CGEventPostkCGHIDEventTap, theEvent
def mousemoveposx,posy:
        mouseEventkCGEventMouseMoved, posx,posy;
def mouseclickposx,posy:
        #mouseEvent(kCGEventMouseMoved, posx,posy); #uncomment this line if you want to force the mouse to MOVE to the click location first (i found it was not necesary).
        mouseEventkCGEventLeftMouseDown, posx,posy;
        mouseEventkCGEventLeftMouseUp, posx,posy;
time.sleepdelay;
mouseclickxclick, yclick;
print "done." 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2017-03-12T15:44:11.297

该[`pynput`](https://pypi.python.org/pypi/pynput)库似乎是目前维护得最好的库。它允许您控制和监视输入设备。

下面是控制鼠标的例子：

```
from pynput.mouse import Button, Controller

mouse = Controller()

# Read pointer position
print('The current pointer position is {0}'.format(
    mouse.position))

# Set pointer position
mouse.position = (10, 20)
print('Now we have moved it to {0}'.format(
    mouse.position))

# Move pointer relative to current position
mouse.move(5, -5)

# Press and release
mouse.press(Button.left)
mouse.release(Button.left)

# Double click; this is different from pressing and releasing
# twice on Mac OSX
mouse.click(Button.left, 2)

# Scroll two steps down
mouse.scroll(0, 2) 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2018-03-27T13:29:22.877

最简单的方法是使用 PyAutoGUI。

安装：

```
pip install pyautogui 
```

例子：

*   获取鼠标位置：

    ```
    >>> pyautogui.position()
    (187, 567) 
    ```

*   将鼠标移动到特定位置：

    ```
    >>> pyautogui.moveTo(100,200) 
    ```

*   要触发鼠标单击：

    ```
    >>> pyautogui.click() 
    ```

更多细节：[PyAutoGUI](http://pyautogui.readthedocs.io/en/latest/)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-19T23:15:07.620

试试这个代码：

```
#!/usr/bin/python

import objc

class ETMouse():    
    def setMousePosition(self, x, y):
        bndl = objc.loadBundle('CoreGraphics', globals(), 
                '/System/Library/Frameworks/ApplicationServices.framework')
        objc.loadBundleFunctions(bndl, globals(), 
                [('CGWarpMouseCursorPosition', 'v{CGPoint=ff}')])
        CGWarpMouseCursorPosition((x, y))

if __name__ == "__main__":
    et = ETMouse()
    et.setMousePosition(200, 200) 
```

它适用于 OSX leopard 10.5.6

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-11T16:10:11.010

我翻遍了 Synergy 的源代码，找到了生成鼠标事件的调用：

```
#include <ApplicationServices/ApplicationServices.h>

int to(int x, int y)
{
    CGPoint newloc;
    CGEventRef eventRef;
    newloc.x = x;
    newloc.y = y;

    eventRef = CGEventCreateMouseEvent(NULL, kCGEventMouseMoved, newloc,
                                        kCGMouseButtonCenter);
    //Apparently, a bug in xcode requires this next line
    CGEventSetType(eventRef, kCGEventMouseMoved);
    CGEventPost(kCGSessionEventTap, eventRef);
    CFRelease(eventRef);

    return 0;
} 
```

现在开始编写 Python 绑定！

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-11T16:23:20.830

当我想这样做时，我安装了[Jython](http://www.jython.org/Project/)并使用了[`java.awt.Robot`](http://docs.oracle.com/javase/1.5.0/docs/api/java/awt/Robot.html)该类。如果您需要制作 CPython 脚本，这显然不合适，但是当您可以灵活选择任何东西时，它是一个不错的跨平台解决方案。

```
import java.awt

robot = java.awt.Robot()

robot.mouseMove(x, y)
robot.mousePress(java.awt.event.InputEvent.BUTTON1_MASK)
robot.mouseRelease(java.awt.event.InputEvent.BUTTON1_MASK) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-07-10T18:49:19.417

最好的办法是使用[AutoPy 包](https://pypi.python.org/pypi/autopy/0.51)。它使用起来非常简单，并且可以跨平台启动。

要将光标移动到位置 (200,200)：

```
import autopy
autopy.mouse.move(200,200) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-05-22T05:51:10.757

来自[geekorgy.com](http://www.geekorgy.com/index.php/2010/06/python-mouse-click-and-move-mouse-in-apple-mac-osx-snow-leopard-10-6-x/)的 python 脚本很棒，除了我安装了更新版本的 python 后遇到了一些障碍。所以这里有一些提示给其他可能正在寻找解决方案的人。

如果您在 Mac OS 10.6 上安装了 Python 2.7，您有几个选项可以让 Python 从 Quartz.CoreGraphics 导入：

**A）**在终端中，**键入`python2.6`**而不是就`python`在脚本路径之前

**B）**您可以通过执行以下操作来**安装 PyObjC ：**

1.  [从http://pypi.python.org/pypi/setuptools](http://pypi.python.org/pypi/setuptools)安装 easy_install
2.  在终端中，键入`which python`并复制路径`2.7`
3.  然后输入`easy_install –-prefix /Path/To/Python/Version pyobjc==2.3`

    **IE。`easy_install –-prefix /Library/Frameworks/Python.framework/Versions/2.7 pyobjc==2.3`

4.  `import objc`在顶部的脚本类型内
5.  如果第一次 easy_install 不起作用，您可能需要先安装核心：

    **IE。`easy_install --prefix /Library/Frameworks/Python.framework/Versions/2.7 pyobjc-core==2.3`

**C）**您可以**将您的 python 路径重置**为原始 Mac OS python：

*   在终端中，键入：`defaults write com.apple.versioner.python Version 2.6`

***另外，一种快速找出屏幕上 (x,y) 坐标的方法：

1.  按下`Command+Shift+4`（屏幕抓取选择）
2.  然后光标显示坐标
3.  然后按 Esc 退出它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-15T03:48:07.897

最简单的方法？编译[这个](http://web.archive.org/web/20100328083020/http://www.macosxhints.com/article.php?story=2008051406323031)Cocoa 应用程序并将鼠标移动传递给它。

这是代码：

```
// File:
// click.m
//
// Compile with:
// gcc -o click click.m -framework ApplicationServices -framework Foundation
//
// Usage:
// ./click -x pixels -y pixels
// At the given coordinates it will click and release.

#import <Foundation/Foundation.h>
#import <ApplicationServices/ApplicationServices.h>

int main(int argc, char **argv) {
  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
  NSUserDefaults *args = [NSUserDefaults standardUserDefaults];

  // grabs command line arguments -x and -y
  //
  int x = [args integerForKey:@"x"];
  int y = [args integerForKey:@"y"];

  // The data structure CGPoint represents a point in a two-dimensional
  // coordinate system.  Here, X and Y distance from upper left, in pixels.
  //
  CGPoint pt;
  pt.x = x;
  pt.y = y;

  // https://stackoverflow.com/questions/1483567/cgpostmouseevent-replacement-on-snow-leopard
  CGEventRef theEvent = CGEventCreateMouseEvent(NULL, kCGEventLeftMouseDown, pt, kCGMouseButtonLeft);
  CGEventSetType(theEvent, kCGEventLeftMouseDown);
  CGEventPost(kCGHIDEventTap, theEvent);
  CFRelease(theEvent);

  [pool release];
  return 0;
} 
```

> 名为 click 的应用程序从 CGRemoteOperation.h 头文件调用 CGPostMouseEvent。它将坐标作为命令行参数，将鼠标移动到该位置，然后单击并释放鼠标按钮。
> 
> 将以上代码另存为click.m，打开终端，切换到你保存源码的文件夹。然后通过键入来编译程序`gcc -o click click.m -framework ApplicationServices -framework Foundation`。不要被需要编译它吓倒，因为注释多于代码。这是一个非常短的程序，可以完成一项简单的任务。

* * *

其他方式？导入[pyobjc](http://developer.apple.com/cocoa/pyobjc.html)以访问某些 OSX 框架并以这种方式访问​​鼠标。（有关想法，请参见第一个示例中的代码）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-05-26T13:25:29.330

从 Quartz 库中使用`CoreGraphics`，例如：

```
from Quartz.CoreGraphics import CGEventCreate
from Quartz.CoreGraphics import CGEventGetLocation
ourEvent = CGEventCreate(None);
currentpos = CGEventGetLocation(ourEvent);
mousemove(currentpos.x,currentpos.y) 
```

^(资料来源：[Geekorgy 页面上的 Tony 评论](http://web.archive.org/web/20120417231126/http://www.geekorgy.com:80/index.php/2010/06/python-mouse-click-and-move-mouse-in-apple-mac-osx-snow-leopard-10-6-x/)。)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-05-28T18:26:22.463

这是使用`Quartz`库的完整示例：

```
#!/usr/bin/python
import sys
from AppKit import NSEvent
import Quartz

class Mouse():
    down = [Quartz.kCGEventLeftMouseDown, Quartz.kCGEventRightMouseDown, Quartz.kCGEventOtherMouseDown]
    up = [Quartz.kCGEventLeftMouseUp, Quartz.kCGEventRightMouseUp, Quartz.kCGEventOtherMouseUp]
    [LEFT, RIGHT, OTHER] = [0, 1, 2]

    def position(self):
        point = Quartz.CGEventGetLocation( Quartz.CGEventCreate(None) )
        return point.x, point.y

    def location(self):
        loc = NSEvent.mouseLocation()
        return loc.x, Quartz.CGDisplayPixelsHigh(0) - loc.y

    def move(self, x, y):
        moveEvent = Quartz.CGEventCreateMouseEvent(None, Quartz.kCGEventMouseMoved, (x, y), 0)
        Quartz.CGEventPost(Quartz.kCGHIDEventTap, moveEvent)

    def press(self, x, y, button=1):
        event = Quartz.CGEventCreateMouseEvent(None, Mouse.down[button], (x, y), button - 1)
        Quartz.CGEventPost(Quartz.kCGHIDEventTap, event)

    def release(self, x, y, button=1):
        event = Quartz.CGEventCreateMouseEvent(None, Mouse.up[button], (x, y), button - 1)
        Quartz.CGEventPost(Quartz.kCGHIDEventTap, event)

    def click(self, button=LEFT):
        x, y = self.position()
        self.press(x, y, button)
        self.release(x, y, button)

    def click_pos(self, x, y, button=LEFT):
        self.move(x, y)
        self.click(button)

    def to_relative(self, x, y):
        curr_pos = Quartz.CGEventGetLocation( Quartz.CGEventCreate(None) )
        x += current_position.x;
        y += current_position.y;
        return [x, y]

    def move_rel(self, x, y):
        [x, y] = to_relative(x, y)
        moveEvent = Quartz.CGEventCreateMouseEvent(None, Quartz.kCGEventMouseMoved, Quartz.CGPointMake(x, y), 0)
        Quartz.CGEventPost(Quartz.kCGHIDEventTap, moveEvent) 
```

^(以上代码基于这些原始文件：.[`Mouse.py`](https://github.com/MichaelLeith/pyInputSim/blob/master/src/OSX/Mouse.py)[`mouseUtils.py`](https://github.com/OzTamir/PebbleMouse/blob/master/Server/mouseUtils.py))

这是使用上述类的演示代码：

```
# DEMO
if __name__ == '__main__':
    mouse = Mouse()
    if sys.platform == "darwin":
        print("Current mouse position: %d:%d" % mouse.position())
        print("Moving to 100:100...");
        mouse.move(100, 100)
        print("Clicking 200:200 position with using the right button...");
        mouse.click_pos(200, 200, mouse.RIGHT)
    elif sys.platform == "win32":
        print("Error: Platform not supported!") 
```

您可以将两个代码块合并到一个文件中，授予执行权限并将其作为 shell 脚本运行。

# unicode - 有人可以为我解释 Encoding.Unicode.GetBytes("hello") 吗？

> ID：281135
> 
> 赞同：2
> 
> 时间：2008-11-11T15:04:51.143
> 
> 标签：unicode

我的代码：

```
 string input1;

        input1 = Console.ReadLine();

        Console.WriteLine("byte output");

        byte[] bInput1 = Encoding.Unicode.GetBytes(input1);

        for (int x = 0; x < bInput1.Length; x++)
            Console.WriteLine("{0} = {1}", x, bInput1[x]); 
```

输出：

104 0 101 0 108 0 108 0 111 0

对于输入“你好”

是否有对我可以理解的字符图的参考？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T15:10:38.090

[您应该阅读http://www.joelonsoftware.com/articles/Unicode.html](http://www.joelonsoftware.com/articles/Unicode.html)上的“每个软件开发人员绝对、肯定必须了解 Unicode 和字符集（没有借口！）的绝对最低要求”

[您可以在http://www.unicode.org](http://www.unicode.org)找到所有 Unicode 字符的列表，但不要指望能够在不了解文本编码问题的情况下阅读那里的文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T15:35:54.467

在[http://www.unicode.org/charts/](http://www.unicode.org/charts/)您可以找到所有 Unicode 代码图表。[http://www.unicode.org/charts/PDF/U0000.pdf](http://www.unicode.org/charts/PDF/U0000.pdf)显示“h”的代码点是 U+0068。（查看这些数据的另一个好工具是[BabelMap](http://www.babelstone.co.uk/Software/BabelMap.html)。）

UTF-16 编码的确切细节可以在[http://unicode.org/faq/utf_bom.html#6](http://unicode.org/faq/utf_bom.html#6)和[http://www.ietf.org/rfc/rfc2781.txt 找到](http://www.ietf.org/rfc/rfc2781.txt)。简而言之，U+0068 被编码（在 UTF-16LE 中）为 0x68 0x00。在十进制中，这是您看到的前两个字节：104 0。

其他字符的编码类似。

最后，除了[Unicode 标准](http://www.unicode.org/versions/Unicode5.1.0/)本身之外，一个很好的参考资料（当试图理解各种 Unicode 规范时）是[Unicode Glossary](http://unicode.org/glossary/)。

# c++ - 在 C++ 中的 Shared Lib (so) 内的共享内存中创建一个对象

> ID：281136
> 
> 赞同：1
> 
> 时间：2008-11-11T15:05:16.760
> 
> 标签：c++, memory, shared-libraries

是否可以在链接到此代码的每个人之间共享一个“上帝”实例，以放置在共享对象中？

```
god* _god = NULL;
extern "C" 
{

int set_log_level(int level)
{
    if(_god == NULL) return -1;
    _stb->log_level(level);
    return 0;
}

int god_init(){
    if(_god == NULL){
        _god = new god(); //Magic happens here
    }
}

} 
```

假设我在每个函数的开头都进行了锁同步，并且考虑到上帝本身可以 new/malloc 其他东西，但那些东西永远不会自己返回给调用者（上帝 malloc 仅供内部使用），什么是最简单的这样做的方式，如果可能的话。

如何将其扩展到链接到此共享库的任意数量的程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T15:50:20.460

[Boost Interprocess](http://www.boost.org/doc/libs/1_37_0/doc/html/interprocess.html)库具有更高（ER）级别的可移植共享内存对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T15:19:03.643

这根本不是正确的方法。通过执行您的建议，变量是库的全局变量，因此是程序的全局变量，但数据对于实际运行的进程是私有的。您将无法在正在运行的程序之间共享这些值。@grieve 指的是由多个线程访问的全局，但线程共享相同的父进程实例。

在实际进程中，您需要突破到特定于操作系统的共享内存设施。查看[共享内存](http://en.wikipedia.org/wiki/Shared_memory)了解详细信息。这是一个可行的问题，但实现起来并不是特别简单。您还需要像信号量这样的进程间同步系统来协调使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T15:41:17.717

我感觉*上帝*会成为某种服务器。考虑使用适当的客户端/服务器架构，以使上帝远离大众。

# .net - 如何将 Windows Mobile Professional 设备保持在无人值守电源状态

> ID：281139
> 
> 赞同：0
> 
> 时间：2008-11-11T15:06:33.527
> 
> 标签：.net, windows-mobile, compact-framework

我有一个在 windows mobile 专业版上运行的 .net 3.5 应用程序，它使用 sql server ce 3.5 并将复制与 sql server 2005 sp2 合并，它还不是 1.0 产品。每隔几分钟左右，它就会使用计时器控件启动合并复制。我想我必须有某种推送 senario，要么使用长寿命的 HTTP 请求，要么使用 Window Mobile 电子邮件 WCF。然而，与此同时，我的问题是设备在等待轮询计时器时“进入睡眠状态”，要么是设备达到其空闲断电超时，要么是用户按下待机按钮。我以为只是屏幕和键盘掉电了，但事实证明这是大多数设备功能，包括我的应用程序。

有什么方法可以捕捉待机事件并关闭屏幕和键盘但保持我的应用程序运行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T16:15:44.200

我建议您不要禁用睡眠模式，而是注册事件以唤醒您的设备并运行您的任务。查看[OpenNetCf](http://www.opennetcf.com)上的智能设备框架。除其他外，您会发现：

*   注册唤醒事件的方法
*   断电事件的事件处理程序

其中大部分位于 OpenNETCF.WindowsCE 命名空间中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T15:45:03.247

本[主题](https://stackoverflow.com/questions/246407/disable-sleep-mode-in-windows-mobile-6)中的建议对您有帮助吗？

CodeProject 有这篇[文章](http://www.codeproject.com/KB/mobile/WiMoPower1.aspx)，对 Windows Mobile 电源状态进行了非常详细的解释。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-27T19:57:54.190

也许这个 SO 问题的答案会有所帮助：[如何在被挂起的情况下在 Windows Mobile 上运行代码？](https://stackoverflow.com/questions/336771/how-can-i-run-code-on-windows-mobile-while-being-suspended)它使用“无人值守”模式来保持应用程序在屏幕关闭的情况下运行。

# .net - ASP.Net MVC 框架和数据绑定

> ID：281144
> 
> 赞同：3
> 
> 时间：2008-11-11T15:07:11.437
> 
> 标签：.net, asp.net-mvc

我在掌握 MVC 框架背后的一些概念时遇到了一些麻烦。我正在做一个对产品进行分类的非常简单的应用程序。

创建屏幕将简单地使用显示类别列表、产品名称和提交的下拉列表。

在普通的 .Net 应用程序中，我会在 Page_Load 中对服务器下拉列表进行数据绑定，但在 MVC 应用程序中，从数据库中检索我的类别并将它们添加到下拉列表中的最佳方法是什么？

（对不起，我的问题非常无聊，但不幸的是 MVC 上的资源是多余的，并且由于早期的更改，示例经常被破坏）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T16:04:12.520

我不确定我是否完全掌握，但如果您的页面显示单个产品并且唯一的用户输入只是从下拉列表中选择一个类别，我可以提供帮助（但我也是菜鸟！） .

参考这个页面：

[http://weblogs.asp.net/scottgu/archive/2008/05/27/asp-net-mvc-preview-3-release.aspx](http://weblogs.asp.net/scottgu/archive/2008/05/27/asp-net-mvc-preview-3-release.aspx)

您将要在控制器中为类别创建一个 SelectList（可能引用一个 ID，并显示一个名称）。然后将此 SelectList 添加到您的 ViewData。您也可以将其设置为 ViewData.Model 的一部分并从您的视图中引用它。

在您的视图中，您将 HtmlHelper 用于以 SelectList 作为参数的 DropDownList。

上面的链接应该能更好地传达它，这只是一个简短的总结。该链接适用于预览版 3，但我认为它应该仍然适用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T15:28:57.023

您的模型检索数据，您的演示者为视图组织数据，视图控件将您的模型绑定到 UI 元素。例如，这是一个 LogEvent 的模型：

```
public class LogEvent{
  public string Title {get;set;}
  public string Date {get;set;}
  public string Message {get;set;}

  // this is for example only; you would most likely bind directly against the host.GetAllLogs() result
  public static IEnumerable<LogEvent> RetrieveAllLogs(ILogProvider host){
    return from x in host.GetAllLogs() select new LogEvent(x.LogTitle, x.Date, x.Message);
  } 
```

这是处理用户请求以查看所有日志的控制器：

```
[DependencyPropertyLolJk]
protected ILogProvider MyLogProvider {get;set;} // set by DI

[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Logs()
{
    return View("Logs", LogEvent.GetAllLogs(MyLogProvider).OrderByDescending(x => x.Date));
} 
```

这是视图以及它如何绑定到模型：

```
<!-- header left out for brevity -->
<table>
    <thead>
        <tr>
            <th>
                Date
            </th>
            <th>
                Title
            </th>
            <th>
                Message
            </th>
        </tr>
    </thead>
    <% foreach(var log in ViewData.Model) %>
    <tr>
<td><%= log.Date %></td>
<td><%= log.Title %></td>
<td><%= log.Message %></td>
    </tr>
    <% }; %>
</table>

<!-- ... --> 
```

所以你看，你必须使用内联代码编写你的 html。这适用于简单的 UI，但在涉及更复杂的事物（例如寻呼机和网格视图）时可能会很复杂且乏味。

当您的 UI 变得复杂时，最简单的做法是创建 HtmlHelper 类的扩展。下面是两个示例，展示了如何降低 UI 的复杂性：HtmlHelper [GridView](http://weblogs.asp.net/stephenwalther/archive/2008/06/24/asp-net-mvc-tip-8-create-an-asp-net-mvc-gridview-helper-method.aspx)和[Pager](http://weblogs.asp.net/stephenwalther/archive/2008/09/18/asp-net-mvc-tip-44-create-a-pager-html-helper.aspx)控件。我已经创建了类似的辅助方法，以及如何在 lambdas 中混合 html 和内联代码，这非常了不起。现在，如果设计师只能体面地格式化这种混合代码/标记......

# asp.net - ASP.NET 托管环境/shadowCopyBinAssemblies

> ID：281145
> 
> 赞同：6
> 
> 时间：2008-11-11T15:08:43.290
> 
> 标签：asp.net, assemblies, web-config

今天我偶然发现了**[hostingEnvironment](http://msdn.microsoft.com/en-us/library/ms228159.aspx)**标签中的**shadowCopyBinAssemblies**选项。

显然，此属性是一个**web.config** (system.web) 配置布尔选项，指示 Bin 目录中应用程序的程序集是否被影子复制到应用程序的 ASP.NET 临时文件目录。

```
<hostingEnvironment shadowCopyBinAssemblies="false" /> 
```

一位同事[必须启用此设置](http://dotnetsoldier.blogspot.com/2008/09/cannot-create-shadow-copy-visual-studio_1635.html)，因为（仅）在他的开发机器上，他经常在 Web 浏览器中遇到 ASP.NET 错误：

```
 Cannot create shadow copy assembly file dll when that file already exists. 
```

在 Visual Studio 2008 中编译特定的 Web 项目并打开一个页面。

所以现在我的问题是：我可以**在生产环境中**保留此设置还是会损害性能和/或产生其他问题？

*谢谢！*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T15:35:34.013

我不时收到此错误，通常执行**清洁解决方案**，然后执行**重建解决方案**会解决问题。如果这适用于您的同事，则无需使用该设置（尤其是在生产中）。

# .net - 有没有办法使用 T-SQL 验证 XML？

> ID：281156
> 
> 赞同：0
> 
> 时间：2008-11-11T15:13:14.153
> 
> 标签：.net, xml, tsql

我正在将 varchar(8000) 字段转换为 MSSQL 2005 中的 xml 字段。许多 XML 文档都有小问题（例如：度数符号未编码）。有没有比 Try/Catch 过程更好的验证 XML 的方法？

也许我可以编写一个 .NET 存储过程。在 .NET 中验证（或无效）XML 文档的正确方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T15:18:11.523

您可以在托管代码中编写存储过程。以下是一些示例[http://www.yukonxml.com/articles/sqlclr/](http://www.yukonxml.com/articles/sqlclr/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-19T13:06:46.363

到目前为止，我认为使用 Try/Catch 方法更简单（但很粗暴）。我正在工作的团队还没有真正开始使用托管存储过程。

# c# - RijndaelManaged 支持 128-256 位密钥，默认构造函数生成器的密钥大小是多少？

> ID：281158
> 
> 赞同：20
> 
> 时间：2008-11-11T15:13:58.207
> 
> 标签：c#, aes, rijndaelmanaged

对于 new RijndaelManaged()，文档说它支持 128 位和最多 256 位的密钥。

当您实例化 new RijndaelManaged() 时，它会为您创建密钥和 IV。

它的默认大小是多少，128 位？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-11T15:17:06.377

默认密钥大小为 256 位，而默认块大小为 128 位。

# sql - MS Access 中本地服务器上的慢速 SQL 代码

> ID：281167
> 
> 赞同：2
> 
> 时间：2008-11-11T15:18:43.050
> 
> 标签：sql, ms-access

我有一个特定的 SQL 语句，它需要大约 30 秒才能执行，我想知道是否有人可以看到它的问题，或者我需要额外索引的地方。

该代码位于 Access 中的一个子窗体上，该子窗体显示的结果取决于主窗体中五个字段的内容。正在查询的表中有近 5000 条记录。Access 项目是从实际 SQL 服务器上的终端服务器会话存储和运行的，所以我认为这不是网络问题，还有另一种非常相似的表单，它使用相同类型的查询......

谢谢

PG

```
SELECT TabDrawer.DrawerName, TabDrawer.DrawerSortCode, TabDrawer.DrawerAccountNo, TabDrawer.DrawerPostCode, QryAllTransactons.TPCChequeNumber, tabdrawer.drawerref
FROM TabDrawer LEFT JOIN QryAllTransactons ON  TabDrawer.DrawerRef=QryAllTransactons.tpcdrawer
WHERE (Forms!FrmSearchCompany!SearchName Is Null 
      Or [drawername] Like Forms!FrmSearchCompany!SearchName & "*") 
      And (Forms!FrmSearchCompany.SearchPostcode Is Null 
      Or [Drawerpostcode] Like Forms!FrmSearchCompany!Searchpostcode & "*") 
      And (Forms!FrmSearchCompany!SearchSortCode Is Null 
      Or [drawersortcode] Like Forms!FrmSearchCompany!Searchsortcode & "*") 
      And (Forms!FrmSearchCompany!Searchaccount Is Null 
      Or [draweraccountno] Like Forms!FrmSearchCompany!Searchaccount & "*") 
      And (Forms!FrmSearchCompany!Searchcheque Is Null 
      Or [tpcchequenumber] Like Forms!FrmSearchCompany!Searchcheque & "*");
    "); 
```

* * *

**编辑**

Hold up 似乎在形成 QryAllTransactons 查询的联合查询中。

```
SELECT 
  "TPC" AS Type, 
  TabTPC.TPCRef, 
  TabTPC.TPCBranch, 
  TabTPC.TPCDate, 
  TabTPC.TPCChequeNumber, 
  TabTPC.TPCChequeValue, 
  TabTPC.TPCFee, 
  TabTPC.TPCAction,
  TabTPC.TPCMember, 
  tabtpc.tpcdrawer,
  TabTPC.TPCUser,
  TabTPC.TPCDiscount,
  tabcustomers.*
FROM 
  TabTPC 
  INNER JOIN TabCustomers ON TabTPC.TPCMember = TabCustomers.CustomerID

UNION ALL 

SELECT 
 "CTP" AS Type, 
  TabCTP.CTPRef, 
  TabCTP.CTPBranch, 
  TabCTP.CTPDate, 
  TabCTP.CTPChequeNumb, 
  TabCTP.CTPAmount, 
  TabCTP.CTPFee, 
  TabCTP.CTPAction,
  TabCTP.CTPMember,
  0 as CTPXXX,
  TabCTP.CTPUser,
  TabCTP.CTPDiscount, 
  TABCUSTOMERS.*
FROM 
  TabCTP  
  INNER JOIN TabCustomers ON Tabctp.ctpMember = TabCustomers.CustomerID; 
```

我已经用简单的联合查询做了很多工作，但以前从未有过......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T21:56:41.217

两件事情。由于这是一个带有 SQL Server 后端的 Access 数据库，因此您可以通过将其转换为存储过程来显着提高速度。

其次，您真的需要返回所有这些字段，尤其是在 tabCustomers 表中吗？永远不要返回比您实际打算使用更多的字段，您将提高性能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T15:29:33.293

首先，尝试压缩和修复 .mdb 文件。

然后，简化您的 WHERE 子句：

```
WHERE
  [drawername] Like Nz(Forms!FrmSearchCompany!SearchName, "") & "*"
  And 
  [Drawerpostcode] Like Nz(Forms!FrmSearchCompany!Searchpostcode, "") & "*"
  And 
  [drawersortcode] Like Nz(Forms!FrmSearchCompany!Searchsortcode, "") & "*"
  And 
  [draweraccountno] Like Nz(Forms!FrmSearchCompany!Searchaccount, "") & "*"
  And 
  [tpcchequenumber] Like Nz(Forms!FrmSearchCompany!Searchcheque, "") & "*" 
```

它仍然运行缓慢吗？

**编辑**

事实证明，这个问题并不清楚，因为它是一个带有 SQL Server 后端和一个 Access Project 前端的大型 Access 数据库。

这为整个问题提供了不同的视角。

您能否更详细地解释*整个*查询的用途？

如果您使用它来填充某些表单或报告的 RecordSource，我认为您将能够像这样重构整个事情：

*   在返回正确数据的 SQL 服务器上创建视图
*   使用 SQL 服务器语法而不是 Access 语法查询该视图
*   让服务器整理一下

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T18:24:46.870

QryAllTransactons 中有多少行？

如果您的结果返回 0 行，则 Access 可能会立即看到并停止，但如果它甚至返回单行，则它需要拉入 QryAllTransactons 的整个结果集，以便它可以在内部进行连接。这将是我对正在发生的事情的第一个猜测。

您最好的选择通常是在 SQL Server 上进行连接。尝试创建一个执行 LEFT OUTER JOIN 的视图并对其进行查询。

即使 Access 在 SQL Server 本身上运行并最大限度地减少网络流量，您的目标也是仅向 Access 发送它绝对需要的内容。否则一个大表仍然会占用内存等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T18:42:49.033

您是否尝试过运行联合中的每个子查询？通常优化器不会花太多时间来检查联合元素之间的效率——每个元素都有自己的优点。

鉴于这一事实，您还可以将“IF”逻辑放入过程代码中，并以某种可能的发现顺序运行每个测试，而不会因更多调用而产生大量额外开销。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T19:02:07.887

摆脱那些喜欢运营商的人。

在您的情况下，您不需要它们。只需检查该字段是否以给定值开头，您可以通过以下方式实现：

```
Left([field], Len(value)) = value 
```

应用于您的查询的这个方法看起来像这样（为了更好的可读性做了一些重新格式化）：

```
SELECT
  TabDrawer.DrawerName, 
  TabDrawer.DrawerSortCode, 
  TabDrawer.DrawerAccountNo, 
  TabDrawer.DrawerPostCode, 
  QryAllTransactons.TPCChequeNumber, 
  TabDrawer.DrawerRef
FROM
  TabDrawer 
  LEFT JOIN QryAllTransactons 
    ON TabDrawer.DrawerRef = QryAllTransactons.TpcDrawer
WHERE 
  (Forms!FrmSearchCompany!SearchName Is Null 
  Or Left([drawername], Len(Forms!FrmSearchCompany!SearchName)) = Forms!FrmSearchCompany!SearchName)
And
  (Forms!FrmSearchCompany.SearchPostcode Is Null 
  Or Left([Drawerpostcode], Len(Forms!FrmSearchCompany!Searchpostcode)) = Forms!FrmSearchCompany!Searchpostcode) 
And 
  (Forms!FrmSearchCompany!SearchSortCode Is Null 
  Or Left([drawersortcode], Len(Forms!FrmSearchCompany!Searchsortcode)) = Forms!FrmSearchCompany!Searchsortcode) 
And 
  (Forms!FrmSearchCompany!Searchaccount Is Null 
  Or Left([draweraccountno], Len(Forms!FrmSearchCompany!Searchaccount)) = Forms!FrmSearchCompany!Searchaccount) 
And 
  (Forms!FrmSearchCompany!Searchcheque Is Null 
  Or Left([tpcchequenumber], Len(Forms!FrmSearchCompany!Searchcheque)) = Forms!FrmSearchCompany!Searchcheque) 
```

请注意，您正在比较区分大小写。我不完全确定 MS-Access 中的 like 运算符是否不区分大小写。如果需要，将两个字符串都转换为大写或小写。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-19T22:22:40.407

当您升迁时，您是否确保表已正确索引？如果使用得当，索引将极大地加快查询速度（注意它们也可能减慢插入/更新/删除速度，因此请谨慎选择要索引的内容）

# c# - 在 .Net 中解压 MSI

> ID：281170
> 
> 赞同：2
> 
> 时间：2008-11-11T15:20:14.217
> 
> 标签：c#, .net, installation

我有一个将 Web 服务部署到 IIS 的安装程序。完成此操作后，将触发自定义操作，使用 Web 服务所需的脚本更新数据库。这些脚本目前也部署到 IIS，因为它们是 .net 项目的一部分。如何配置安装过程，使脚本不属于项目并从 MSI 中解压缩，以便我的自定义操作可以访问它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T01:45:10.227

如果您使用的是标准 Visual Studio 安装项目，请执行以下操作：

1.  将脚本作为文件添加到安装项目
2.  右键单击文件
3.  选择“属性”
4.  将“PackageAs”属性更改为“vsdpaLoose”

您的文件现在将与您的 MSI 一起输出，以便随时可用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T16:21:58.150

使用 WIX，抱歉不知道您使用的是什么。我会创建一个

```
<Binary Id="webServiceScript.sql" src="[DirectoryToFile]\webServiceDataScript.sql" /> 
```

设置 CA 以运行脚本后

```
<CustomAction Id="CallCmd" Value="[Path_to_Exe_Folder][Your_EXE_TO_RUN_SCRIPT_HERE]" />

<CustomAction Id="RunCmd" ExeCommand="webServiceScript.sql" BinaryKey="webServiceScript.sql" Return="Ignore" /> 
```

然后只需设置安装顺序

```
<InstallExecuteSequence>
  <Custom Action="CallCmd" Before="InstallFinalize" />
  <Custom Action="RunCmd" After="CallCmd" />
</InstallExecuteSequence> 
```

# .net - ClickOnce .appref-ms 不仅仅是指向 .application 文件的链接？

> ID：281173
> 
> 赞同：11
> 
> 时间：2008-11-11T15:20:44.357
> 
> 标签：.net, .net-3.5, clickonce, applicationreference

我有一个这样的 ClickOnce 环境：

`\\Fileserver\ClickOnceApps\App1.application`

`C:\Documents and Settings\user\Start Menu\Programs\publisher\app1.appref-ms`

我的理解是 .apppref-ms 文件是 app.application 文件的美化链接。它还有其他作用吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-11T15:35:09.397

如果您在文本编辑器中打开 appref-ms 文件，您会看到它包含应用程序的 Url、文化、处理器架构和用于签署应用程序的密钥，所以是的，它只是一个链接。

这些“应用程序引用”文件和快捷方式（.lnk）之间的区别在于应用程序引用指向原始应用程序Url而不是磁盘上exe的位置，当您运行appref-ms文件时系统知道如何找到程序的副本在本地磁盘上并从那里运行它而不访问 Url（这不准确，取决于 ClickOnce 清单中的设置，但它是一个近似值）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-10-25T18:55:26.743

如果你打开它，然后打开任务管理器，然后右键单击任务，打开文件位置，它会（大多数时候）直接带你到实际的 .exe

# comments - 已删除的注释代码

> ID：281177
> 
> 赞同：34
> 
> 时间：2008-11-11T15:22:23.463
> 
> 标签：comments

评论被删除的代码是一个好习惯吗？例如：

```
// Code to do {task} was removed by Ajahn on 10/10/08 because {reason}. 
```

在同行评审期间，我的开发人员组中的某个人注意到我们应该评论要删除的代码行。我认为这是一个糟糕的建议，因为它用无用的注释使代码混乱。我们谁是对的？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2008-11-11T15:24:59.590

一般来说，被删除的代码不应该被评论，正是因为它使代码库变得混乱（而且，为什么要评论一些不存在的东西？）。

您的缺陷跟踪系统或源代码控制管理工具是此类评论所属的地方。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-11-11T16:55:25.100

当注释掉代码（而不是删除）是一个好主意时，有一些（罕见的）情况。这是一个。

我有一行看起来不错且必要的代码。后来我意识到这是不必要的和有害的。我没有删除该行，而是将其注释掉，并添加了另一条评论：“由于某些原因，下面的行是错误的”。为什么？

因为我相信下一个代码读者会首先认为*没有*这一行是一个错误，并会尝试将其添加回来。（即使读者是两年后的我。）我不希望他先咨询源代码控制。我需要添加评论以警告他这种棘手的情况；并且有错误的线路以及错误的原因恰好是最好的方法。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-11T15:25:08.013

我同意在评论中删除代码不是一个好主意。

应通过版本控制系统查看代码历史记录，在这里可以找到旧代码以及删除它的原因。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-11T15:25:47.433

您应该始终删除代码。

至于能够看到旧的/删除的代码，这就是版本控制。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-11T15:27:12.720

取决于删除的原因。

我认为注释是对未来维护代码的人的提示，如果代码存在但被删除的信息对维护代码的人有帮助（可能是“不要那样做”的标志），那么它应该在那里。

否则，在每个代码更改上添加带有名称和日期的详细注释只会使整个事情变得不可读。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-11T15:27:41.330

我认为它非常没用，并且使代码的可读性降低。想想几个月后会是什么样子......

```
// removed because of this and that
/* 
      removed this stuff because my left leg...
*/
 doSomething();
// this piece of has been removed, we don't need it... 
```

你会花半个小时来了解发生了什么

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-11T15:25:00.353

问题是，为什么要删除代码？

没用吗？一开始就把它放在那里是错误的吗？

从我的角度来看，不需要评论。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-11T15:25:16.000

它在调试时很有用，但没有理由以这种方式*签入*代码。源代码控制的重点是能够恢复旧版本，而不会用注释掉的代码弄乱代码。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-11T15:26:43.313

我建议，是的，对已删除但**不在代码本身中的代码**进行评论是一种很好的做法。

为了进一步阐明这一立场，您应该使用允许某种形式的签入注释的源代码控制系统 (SCCS)。那是你应该放置关于为什么代码被删除的注释的地方。SCCS 将提供代码发生情况的完整上下文历史记录，包括已删除的内容。通过添加签入评论，您可以进一步阐明该历史记录。

直接在代码中添加注释只会导致混乱。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-11T15:26:46.917

最近的共识（来自这里的其他讨论）是应该删除代码。

我个人会注释掉代码并用日期或原因标记它。如果它是旧的/陈旧的并且我正在通过文件，那么我将其删除。版本控制使返回变得容易，但不像取消注释那么容易......

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-11T15:28:38.990

听起来您正试图绕过对代码进行版本控制。从理论上讲，这听起来是个好主意，但在实践中，它很快就会变得非常混乱。

我强烈建议将代码注释掉以进行调试或运行其他测试，但在做出最终决定后将其从文件中完全删除！

获得一个好的版本控制系统，我想你会发现注释掉更改的做法很混乱。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-11T16:57:47.000

这里没有人写过很多关于*为什么*你不应该留下注释掉的代码，除了它看起来很乱。我认为最大的原因是代码可能会停止工作。没有人在编译它。没有人通过单元测试来运行它。当人们重构代码的其余部分时，他们并没有重构它。很快，它就会变得毫无用处。或者比无用更糟糕——有人可能会取消注释，盲目地相信它有效。

如果我们*仍在*对项目进行繁重的设计/开发，有时我会注释掉代码。在这个阶段，我通常会尝试几种不同的设计，寻找正确的方法。有时正确的方法是我之前已经尝试过的方法。因此，如果该代码不会在源代码控制的深处丢失，那就太好了。但是一旦设计完成，我就会摆脱旧代码。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-11T17:21:31.133

一般来说，我倾向于很少评论。我相信好的代码应该易于阅读，无需太多评论。

我还对我的代码进行了版本控制。我想我可以对过去 20 次签入进行比较，以查看特定行是否因特定原因而更改。但是对于大多数更改，这将浪费我的时间。

所以我尝试巧妙地评论我的代码。如果出于相当明显的原因删除了某些代码，我不会费心评论删除。但是，如果由于某种微妙的原因而删除了一段代码（例如，它执行了一个现在由不同线程处理的函数），我将注释掉或删除代码并添加横幅注释原因：

```
 // this is now handled by the heartbeat thread
   // m_data.resort(m_ascending); 
```

或者：

```
 // don't re-sort here, as it is now handled by the heartbeat thread 
```

就在上个月，我遇到了一段我在一年前为了解决一个特定问题而更改的代码，但没有添加解释原因的注释。这是原始代码：

```
 cutoff = m_previous_cutofftime; 
```

这是代码，因为它最初被修复为在恢复中断状态时使用正确的截止时间：

```
 cutoff = (!ok_during) ? m_previous_cutofftime : 0; 
```

当然，另一个不相关的问题出现了，它碰巧触及了同一行代码，在这种情况下将它恢复到原来的状态。所以现在新问题已经修复，但旧问题突然被重新破解。哦！

所以现在签入的代码如下所示：

```
 // this works for overlong events but not resuming
// cutoff = m_previous_cutofftime;
   // this works for resuming but not overlong events
// cutoff = (!ok_during) ? m_previous_cutofftime : 0;
   // this works for both
   cutoff = (!resuming || !ok_during) ? m_previous_cutofftime : 0; 
```

当然，YMMV。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-11T18:49:33.233

作为唯一的反对声音，我会说在特殊情况下有一个注释掉代码的地方。有时，您将拥有通过旧代码运行的继续存在的数据，最明确的做法是将旧代码保留在源代码中。在这种情况下，我可能会留下一点说明，说明为什么旧代码被简单地注释掉了。任何后来出现的程序员都能够理解仍然存在的数据，而不必从心理上检测是否需要检查旧版本。

不过，通常情况下，我发现注释掉的代码完全令人讨厌，我经常在遇到它时将其删除。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-11-11T15:26:11.273

如果您要删除代码。你不应该评论你删除它。这是源代码控制的全部目的（您正在使用源代码控制？对吗？），正如您所说的那样，注释只会使代码混乱。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-11T15:26:18.853

我同意这是一个糟糕的建议。这就是为什么您拥有具有修订版的源代码控制。如果您需要返回并查看两个修订版之间的更改，请区分这两个修订版。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-11T15:27:10.427

我讨厌看到代码被注释掉的代码弄得乱七八糟。删除代码并写一条提交消息，说明它被删除的原因。你确实使用源代码控制，不是吗？

不要用死代码乱扔活动代码。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-11-11T15:27:13.283

我将在共识中加入我的声音：将关于为什么删除代码的评论放在源代码控制存储库中，而不是在代码中。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-11-11T17:53:16.903

这是诸如编译器提示/警告未解决的“损坏”窗口之一。它总有一天会伤害你，它会促进团队的马虎。

版本控制中的签入注释可以跟踪删除此代码的内容/原因 - 如果开发人员没有留下注释，则跟踪它们并限制它们。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-11-25T15:08:13.590

一个小轶事，为了好玩：几年前我在一家公司，对源代码版本控制一无所知（他们后来得到了这样的工具......）。
因此，在我们的 C 源代码中，他们有一条规则：“当您进行更改时，请使用预处理器宏禁用旧代码”：

```
#ifdef OLD /* PL - 11/10/1989 */
void Buggy()
{
// ...
}
#else
void Good()
{
// ...
}
#end 
```

不用说，我们的资源很快变得难以阅读！维护是一场噩梦......
这就是为什么我在 SciTE 中添加了在嵌套的 #ifdef / #else / #end 等之间跳转的能力......它在更常见的情况下仍然有用。
后来，我写了一个 Visual Studio 宏来愉快地摆脱旧代码，一旦我们得到了我们的 VCS！

现在，就像 buti-oxa 一样，有时我觉得有必要说明为什么我删除了一些代码。出于同样的原因，或者因为我删除了我认为不再需要的旧代码，但我不太确定（遗留、遗留......）。显然不是在所有情况下！
实际上，我不会留下这样的评论，但我能理解这种需要。
更糟糕的是，我会在一个版本中注释掉，并在下一个版本中删除所有内容......
在我目前的工作中，对于重要的本地更改，我们保留旧代码但可以通过属性重新激活它，以防万一。在生产中测试了一段时间后，我们最终删除了旧代码。

当然，VCS 注释是最好的选择，但是当更改是大文件中的几行以及其他更改时，引用小删除可能会很困难......

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-12-02T12:24:22.827

如果您正在进行重大更改，并且需要对现有功能进行修复，那么注释掉未来的代码是合理的做法，前提是您指出这是未来的功能，至少在我们拥有对未来友好的源代码控制之前系统。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-11-11T15:26:07.310

我也认为这是一个糟糕的建议:)

您应该使用源代码控制，如果您删除了一些代码，您可以在提交时添加注释。因此，如果您愿意，您仍然拥有代码历史记录...

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-11-11T15:26:59.883

我评论未使用的代码是因为你永远不知道什么时候必须回退到古老的代码，也许旧代码会帮助其他人理解它，如果它当时更简单的话。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-11-11T15:27:17.947

我同意你的看法，安德鲁；IMO 这就是您使用版本控制的原因。通过良好的签入/提交评论和差异工具，您总能找出删除行的原因。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-11-11T15:27:37.120

如果您使用任何形式的源代码管理，那么这种方法有些多余（只要使用描述性日志消息）

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-11-11T18:54:31.943

有一种通用的“干净代码”实践表明，永远不要将已删除的代码保留为注释掉的代码，因为它很混乱，而且您的 CVS/SVN 无论如何都会将其存档。

虽然我确实同意这一原则，但我不认为它是适用于所有开发情况的可接受方法。根据我的经验，很少有人会跟踪代码中的所有更改和每次签入。因此，如果没有注释掉的代码，他们可能永远不会意识到它曾经存在过。

像这样将代码注释掉可能是提供即将被删除的一般警告的一种方式，但是当然，不能保证感兴趣的各方会看到该警告（尽管如果他们经常使用该文件，他们会看见）。

我个人认为正确的方法是将代码分解到另一个私有方法中，然后联系相关利益相关者并在实际摆脱该功能之前通知他们待删除的内容。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-11-11T22:20:47.270

在我所在的位置，我们在一个发布周期内注释掉旧代码，然后在此之后删除注释。（如果某些新代码有问题并且需要用旧代码替换，它可以让我们快速修复。）

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-11-25T15:29:48.867

在几乎所有情况下，旧代码当然应该在您的 RCS 中删除和跟踪。

就像所有事情一样，我认为声明“所有已删除的代码将始终被删除”是一种不正确的方法。

出于多种原因，可能需要保留旧代码。保留代码的主要原因是当您希望将来在该部分代码中工作的任何开发人员看到旧代码时。

依靠源跟踪显然不能做到这一点。

所以，我相信正确的答案是：

- 删除旧代码，除非留下它提供代码中的下一个开发人员需要的关键信息。即，在 99% 的情况下将其删除，但不要制定一项严厉的规则，即当情况需要时，您将无法向下一个开发人员提供急需的文档。

# c# - 是否可以通过 LINQ to SQL 使用/访问标量函数？

> ID：281210
> 
> 赞同：7
> 
> 时间：2008-11-11T15:28:53.140
> 
> 标签：c#, sql, sql-server, linq, linq-to-sql

我们的数据库中有标量函数，用于返回诸如“客户的任务数”或“客户的总发票金额”之类的内容。

我们正在试验并希望尝试在不使用存储过程的情况下执行此操作……通常我们只会在存储过程中调用此函数并将其作为单个值返回。

有没有办法通过 LINQ to SQL 使用或访问标量函数？如果是这样，我很想看一个如何......如果不是，最好如何处理这种情况......如果它甚至是可行的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T15:33:15.657

LINQ-to-SQL 支持与 UDF 一起使用，如果这就是您的意思。只需将 UDF 拖到设计器表面上即可。这会在数据上下文中创建一个匹配方法，标记[`[Function(..., IsComposable=true)]`](http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.functionattribute.aspx)或类似，告诉 LINQ-to-SQL 它可以在查询中使用它（请注意，EF 不支持这种用法）。

然后，您将在查询中使用它，例如：

```
var qry = from cust in ctx.Custs
           select new {Id = cust.Id, Value = ctx.GetTotalValue(cust.Id)}; 
```

这将成为 TSQL 之类的东西：

```
SELECT t1.Id, dbo.MyUdf(t1.Id)
FROM CUSTOMER t1 
```

（或附近）。

它是可组合的这一事实意味着您可以在查询中使用该值 - 例如在`Where()`/中`WHERE`- 从而减少从服务器带回的数据（尽管显然 UDF 仍需要以某种方式执行）。

[这是一个类似的示例](http://groups.google.co.uk/group/microsoft.public.dotnet.languages.csharp/browse_thread/thread/608b6b08532ed7eb/4cf42640934bf45e#bfc790be1a24e37a)，显示了在数据上下文中使用的伪 UDF，说明未使用该方法的 C# 版本。

实际上，我目前正在研究这样的 UDF，以便以可组合的方式提供“模型外”数据 - 即系统的特定部分需要访问一些不是真的数据（恰好在同一个数据库中）同一模型的一部分，但我想以`JOIN`有趣的方式。我也有为此目的的现有 SP...所以我正在考虑将这些 SP 移植到表格 UDF，它提供了围绕模型外数据的合同/抽象级别。所以因为它不是我模型的一部分，所以我只能通过 UDF 获得它——但我保留了用我的常规模型组合它的能力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T15:31:29.747

我相信[这个 MSDN 文档](http://msdn.microsoft.com/en-us/library/bb386973.aspx)是您所追求的（作为[在 LINQ to SQL 中调用用户定义函数的更广泛主题的](http://msdn.microsoft.com/en-us/library/bb546175.aspx)一部分）。不能说我自己做过，但听起来不错……

# aes - 如何将 AES Rijndael 生成的密钥存储到数据库中？

> ID：281212
> 
> 赞同：3
> 
> 时间：2008-11-11T15:28:59.707
> 
> 标签：aes, rijndaelmanaged, key-management

创建实例时，会为我生成 KEY 和 IV。

```
 RijndaelManaged myRijndael = new RijndaelManaged(); 
```

如何将密钥存储在我的数据库或 web.config 文件中？
以及以什么格式？

因为在尝试解密加密字符串时我将不得不加载密钥。

感谢您的帮助，在这个话题上**有点迷失。**

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-11T15:46:39.797

将二进制存储为文本时（无论是文本文件还是数据库字段），Base64 编码都是可行的方法。

```
RijndaelManaged myRijndael = new RijndaelManaged();

// to Base64
string keyb64 = Convert.ToBase64String(myRijndael.Key);

// reverse
myRijndael.Key = Convert.FromBase64String(keyb64); 
```

Base64 字符串可以安全地存储在您喜欢的任何地方。

# javascript - 如何动态添加 tag with JavaScript in IE? I have to add either an embed tag for Firefox or an object tag for Internet Explorer with JavaScript to address the appropriate ActiveX / Plugin depending on the browser. The plugin could be miss 问问题 Detlef 问问题 2008-11-11T15:39:48.797 26417 次 This question shows research effort; it is useful and clear 3 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. I have to add either an embed tag for Firefox or an object tag for Internet Explorer with JavaScript to address the appropriate ActiveX / Plugin depending on the browser. The plugin could be missing and needs to get downloaded in this case. The dynamically added embed tag for Firefox works as expected. The dynamically added object tag for Internet Explorer seems to do nothing at all. The object tag needs the following attributes to function properly. id ="SomeId" classid = "CLSID:{GUID}" codebase = "http://www.MyActicexSource.com/MyCuteActivex.CAB#Version=2,0,0,1" Even a general working idea or method would be nice. Thanks! I needed to do this same thing and simply place all of the HTML needed for the OBJECT tag in a string in JavaScript and simply replace the innerHTML of a div tag with the OBJECT HTML and it works in IE just fine. // something akin to this: document.getElementById(myDivId).innerHTML = "<OBJECT id='foo' classid='CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95'.....etc"; That should work, it does just fine for me - I use it to embed Windows Media Player in a page. UPDATE: You would run the above code after the page loads via an event handler that either runs on the page's load event or maybe in response to a user's click. The only thing you need to do is have an empty DIV tag or some other type of tag that would allow us to inject the HTML code via that element's innerHTML property. UPDATE: Apparently you need more help than I thought you needed? Maybe this will help: Have your BODY tag look like this: <body onload="loadAppropriatePlugin()"> Have somewhere in your page, where you want this thing to load, an empty DIV tag with an id attribute of something like "Foo" or whatever. Have code like this in a <script> tag in your <head> section: function getIEVersion() { // or something like this var ua = window.navigator.userAgent; var msie = ua.indexOf("MSIE "); return ((msie > 0) ? parseInt(ua.substring(msie+5, ua.indexOf(".", msie))) : 0); } function loadAppropriatePlugin() { if(getIEVersion() != 0) { // this means we are in IE document.getElementById("Foo").innerHTML = "<OBJECT id='foo' classid='CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95'.....etc"; } else { // if you want to maybe do the same for FF and load that stuff... } } Does that help? javascriptinternet-explorerdynamic-dataobject-tag 4 3 回答 3 This answer is useful 13 我需要做同样的事情，只需将 OBJECT 标签所需的所有 HTML 放在 JavaScript 中的字符串中，然后将 div 标签的 innerHTML 替换为 OBJECT HTML，它就可以在 IE 中正常工作。 // something akin to this: document.getElementById(myDivId).innerHTML = "<OBJECT id='foo' classid='CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95'.....etc"; 这应该可以，它对我来说很好 - 我用它来在页面中嵌入 Windows Media Player。 更新：您将在页面加载后通过事件处理程序运行上述代码，该事件处理程序在页面的加载事件上运行，或者可能响应用户的点击。您唯一需要做的就是有一个空的 DIV 标记或其他类型的标记，它们允许我们通过该元素的innerHTML属性注入 HTML 代码。 更新：显然你需要比我想象的更多的帮助？也许这会有所帮助： 让您的 BODY 标签看起来像这样：<body onload="loadAppropriatePlugin()"> 在您希望加载此内容的页面中的某个位置有一个空的 DIV 标记，其id属性类似于“Foo”或其他内容。 <script>在您的部分的标签中有这样的代码<head>： function getIEVersion() { // or something like this var ua = window.navigator.userAgent; var msie = ua.indexOf("MSIE "); return ((msie > 0) ? parseInt(ua.substring(msie+5, ua.indexOf(".", msie))) : 0); } function loadAppropriatePlugin() { if(getIEVersion() != 0) { // this means we are in IE document.getElementById("Foo").innerHTML = "<OBJECT id='foo' classid='CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95'.....etc"; } else { // if you want to maybe do the same for FF and load that stuff... } } 这有帮助吗？ 于 2008-11-11T15:55:04.957 回答 This answer is useful 1 var object = document.createelement('object') object.setAttribute('id','name') object.setAttribute('clssid','CLSID:{}') And the same for other parameters. 于 2010-05-03T15:50:44.540 回答 This answer is useful -5 Two ways. 1) Just do a document.write where ever you want it <script type="text/javascript"> <!-- document.write("<object id=\"SomeId\" classid=\"CLSID:{GUID}\" codebase=\"http://www.MyActicexSource.com/MyCuteActivex.CAB#Version=2,0,0,1\"></object>"); --> </script> 2) Edit a tag's innerHTML property. <div id="my-div"></div> <script type="text/javascript"> <!-- document.getElementById("my-div").innerHTML = "<object id=\"SomeId\" classid=\"CLSID:{GUID}\" codebase=\"http://www.MyActicexSource.com/MyCuteActivex.CAB#Version=2,0,0,1\"></object>"; --> </script> EDIT: Just a note, it is best to not use JavaScript to do this, since people with JavaScript enabled will never see the object. It would be better to just place it in your HTML. 于 2008-11-11T15:57:48.477 回答 Related 2 html - 修复了 100% 宽度的 DIV 覆盖滚动条 1 xpath - 将 XPath 转换为 CSS 1 mongodb - 显式连接到 Mongo 副本集有什么好处？ 1 mysql - 这个 MySQL 多表连接好吗？ 1 java - Java：使用 OOP 构建用户控制系统 2 objective-c - 从视图 1 到视图 2 2 php - 为什么在 CodeIgniter 中完全调用 sess_update？ 2 sql - SQL - WHERE 子句中的派生字段 2 clojure - Clojure 动态绑定 3 json - 带有 JSON 结果示例的 Bing Search HTTP 请求？ Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：281246
> 
> 赞同：3
> 
> 时间：
> 
> 标签：javascript, internet-explorer, dynamic-data, object-tag

I have to add either an embed tag for Firefox or an object tag for Internet Explorer with JavaScript to address the appropriate ActiveX / Plugin depending on the browser. The plugin could be missing and needs to get downloaded in this case. The dynamically added embed tag for Firefox works as expected. The dynamically added object tag for Internet Explorer seems to do nothing at all. The object tag needs the following attributes to function properly.

`id ="SomeId" classid = "CLSID:{GUID}" codebase = "http://www.MyActicexSource.com/MyCuteActivex.CAB#Version=2,0,0,1"`

Even a general working idea or method would be nice.

Thanks!

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-11T15:55:04.957

我需要做同样的事情，只需将 OBJECT 标签所需的所有 HTML 放在 JavaScript 中的字符串中，然后将 div 标签的 innerHTML 替换为 OBJECT HTML，它就可以在 IE 中正常工作。

```
// something akin to this:
document.getElementById(myDivId).innerHTML = "<OBJECT id='foo' classid='CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95'.....etc"; 
```

这应该可以，它对我来说很好 - 我用它来在页面中嵌入 Windows Media Player。

* * *

更新：您将在页面加载后通过事件处理程序运行上述代码，该事件处理程序在页面的加载事件上运行，或者可能响应用户的点击。您唯一需要做的就是有一个空的 DIV 标记或其他类型的标记，它们允许我们通过该元素的`innerHTML`属性注入 HTML 代码。

* * *

更新：显然你需要比我想象的更多的帮助？也许这会有所帮助：

让您的 BODY 标签看起来像这样：`<body onload="loadAppropriatePlugin()">`

在您希望加载此内容的页面中的某个位置有一个空的 DIV 标记，其`id`属性类似于“Foo”或其他内容。

`<script>`在您的部分的标签中有这样的代码`<head>`：

```
function getIEVersion() { // or something like this
   var ua = window.navigator.userAgent;
   var msie = ua.indexOf("MSIE ");
   return ((msie > 0) ? parseInt(ua.substring(msie+5, ua.indexOf(".", msie))) : 0);
}

function loadAppropriatePlugin() {
    if(getIEVersion() != 0) { // this means we are in IE
        document.getElementById("Foo").innerHTML = "<OBJECT id='foo' classid='CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95'.....etc";
    } else {
        // if you want to maybe do the same for FF and load that stuff...
    }
} 
```

这有帮助吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-03T15:50:44.540

```
var object = document.createelement('object')
object.setAttribute('id','name')
object.setAttribute('clssid','CLSID:{}') 
```

And the same for other parameters.

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2008-11-11T15:57:48.477

Two ways.

1) Just do a document.write where ever you want it

```
<script type="text/javascript">
<!--
   document.write("<object id=\"SomeId\" classid=\"CLSID:{GUID}\" codebase=\"http://www.MyActicexSource.com/MyCuteActivex.CAB#Version=2,0,0,1\"></object>");
-->
</script> 
```

2) Edit a tag's innerHTML property.

```
<div id="my-div"></div>
<script type="text/javascript">
<!--
   document.getElementById("my-div").innerHTML = "<object id=\"SomeId\" classid=\"CLSID:{GUID}\" codebase=\"http://www.MyActicexSource.com/MyCuteActivex.CAB#Version=2,0,0,1\"></object>";
-->
</script> 
```

**EDIT:** Just a note, it is best to not use JavaScript to do this, since people with JavaScript enabled will never see the object. It would be better to just place it in your HTML.

# c# - NHibernate：一个基类，多个映射

> ID：281247
> 
> 赞同：6
> 
> 时间：2008-11-11T15:40:04.193
> 
> 标签：c#, nhibernate, oop, nhibernate-mapping

我对 NHibernate 比较陌生，但在最近的几个程序中一直在使用它，我爱上了它。我遇到了需要将 4-5 个数据库中的数据聚合到一个数据库中的情况。具体来说就是序列号数据。每个数据库都有自己的映射文件，但最终实体都共享相同的基本结构（Serial 类）。

我知道 NHibernate 想要每个类都有一个映射，所以我最初的想法是有一个基本的串行类，然后从它为每个不同的数据库继承并创建一个唯一的映射文件（继承的类将有零内容）。这对于抓取所有数据和填充对象应该很有用。然后我想做的是使用基类映射将这些继承的类（不确定正确的术语是什么）保存到基类表中。

问题是我不知道如何强制 NHIbernate 为对象使用特定的映射文件。使用“session.save()”时，将继承的类转换为基类没有任何作用（它抱怨没有映射）。

有没有办法明确指定要使用的映射？还是我缺少一些 OOP 主体来更具体地将继承的类转换为基类？或者这个想法只是一个坏想法。

我能找到的关于 NHibernate（第 8 章）的所有继承内容似乎并不完全适用于这个函数，但我可能错了（每个具体类的 table-per-concrete-class 看起来可能有用，但我可以'关于 NHibernate 如何计算出要做什么，我完全不了解它）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T00:42:46.127

我不知道这是否会有所帮助，但基本上我不会尝试这样做。

从本质上讲，我认为您可能患有“金锤”综合症：当您拥有一个非常好的锤子（即 Hibernate（我同意您对此的看法；它是一个很棒的工具））时，一切看起来都像钉子。

我通常会尝试简单地拥有一个“手动转换”类，即一个具有构造函数的构造函数，该构造函数为您的各个串行类获取休眠类，并将数据简单地复制到其自己的特定格式；然后 Hibernate 可以使用自己的映射简单地将其序列化到（单个）数据库。

实际上，我认为这是一个更好的解决方案的原因是您有效地尝试做的是在您的课程中进行不对称序列化；即从派生类中的一个数据库读取，写入基类中的另一个数据库。真的没有什么太可怕的，只是它基本上是一个单向的过程。如果您真的想从一个数据库转换到另一个，只需进行转换，然后就可以了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T01:15:25.933

这可能会有所帮助；

[将 NHibernate 与多个数据库一起使用](http://www.codeproject.com/KB/aspnet/NHibernateMultipleDBs.aspx)

来自文章；

> 介绍
> 
> ...描述了在 ASP.NET 中使用 NHibernate；它提供了与单个数据库进行通信的指南。 **但有时需要同时与多个数据库进行通信。**为了让 NHibernate 做到这一点，需要为您将与之通信的每个数据库都存在一个会话工厂。但是，与多个数据库的情况一样，一些数据库很少使用。因此，在实际需要之前不要创建会话工厂可能是个好主意。本文从上一篇 NHibernate 与 ASP.NET 文章离开的地方开始，并描述了这种听起来很简单的方法的实现细节。尽管上一篇文章重点介绍了 ASP.NET，但 ASP.NET 和 .NET 都支持以下建议。
> 
> ...
> 
> **使用多个数据库时要做的第一件事是配置正确的通信。为每个数据库创建一个单独的配置文件，将它们全部放入一个中央配置文件夹，然后从 web/app.config 中引用它们。**
> 
> ...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T21:23:53.150

我不是 100% 确定这会满足我的需要，但我今天在谷歌上发现了这个关于 NHibernate 和匿名类型的搜索：

[http://infozerk.com/averyblog/refactoring-using-object-constructors-in-hql-with-nhibernate/](http://infozerk.com/averyblog/refactoring-using-object-constructors-in-hql-with-nhibernate/)

有趣的部分（对我来说，我是新手）是 HQL 选择子句中的“新”关键字。所以我可以做的是使用mappingX从DatabaseX中选择SerialX，并将其传递给SerialY（通用/基本Serial）的构造函数。所以现在我从mappingX/databaseX 生成了SerialY，并且（希望）我可以然后session.save 和NHibernate 将使用mappingY/databaseY。

我喜欢这个的原因只是没有持久化两个具有相同数据的类（我认为！）。这与返回 SerialX 列表、迭代并生成 SerialY 并将其添加到新列表（给出的第一个和最佳答案）之间实际上没有功能区别。

这没有为具有继承的 NHibernate 映射创建有用案例的更普遍的好处，但我认为它会做我想要的有限的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T23:01:01.067

虽然您确实需要为每个表创建一个映射文件/类，但没有什么能阻止您让所有这些类实现一个通用接口。

然后，您可以将它们全部聚合到应用程序层（即列表）中的单个集合中，其中每个类都实现列表）

如果您希望进行更新，您可能必须编写一些管道来跟踪将其存储在哪个会话下（因为您的目标是多个数据库）。但是这样做的过程将根据您的设置方式而有所不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-15T01:57:17.777

我写了一篇很长的帖子，里面有代码和所有内容来回应丹。最后，我想我错过了显而易见的事情。

```
public class Serial
{
    public string SerialNumber {get; set;}
    public string ItemNumber {get; set;}
    public string OrderNumber {get; set;}
} 
```

...

```
Serial serial = sessionX.get(typeof(Serial), someID);
sessionY.save(serial); 
```

NHibernate 应该使用 mappingX 进行获取，使用 mappingY 进行保存，因为会话没有被共享，并且映射与会话相关联。所以我可以有 2 个映射指向同一个类，因为在任何特定会话中只有一个映射到类关系。

至少我认为是这样（无法测试atm）。

不幸的是，这个特定的案例真的很无聊而且没有用处。在同一领域的不同程序中，我从基类中派生出业务逻辑的特定部分。我不想创建映射文件，因为它只是为了简化一小段代码。无论如何，由于与我的第一个问题相同的原因，我无法使其在 NHibernate 中工作，并且确实使用了 McWafflestix 描述的方法来解决它（因为它很小）。

也就是说我通过谷歌找到了这个：

[http://jira.nhibernate.org/browse/NH-662](http://jira.nhibernate.org/browse/NH-662)

这是完全相同的情况，它似乎（可能）在 NH 2.1+ 中得到解决？我还没有跟进。

（注意：丹，在我的情况下，我从几个数据库中获取，只写给一个。我仍然对你关于接口的建议感兴趣，因为我认为这对于其他情况是个好主意。你会定义映射接口？如果我尝试保存一个实现没有映射定义的接口的类，NHibernate 会使用接口映射吗？或者我是否必须在映射中为每个实现接口映射的类声明空子类？）

# c# - 是否可以重载 ShowDialog() 以便子表单将信息作为输出参数返回？

> ID：281257
> 
> 赞同：4
> 
> 时间：2008-11-11T15:45:12.123
> 
> 标签：c#, .net, winforms

在之前关于[如何从对话框窗口返回字符串的](https://stackoverflow.com/questions/280579/c-beginner-help-how-do-i-pass-a-value-from-a-child-back-to-the-parent-form)问题中，**yapiskan**建议[重载子窗体的 ShowDialog() 方法](https://stackoverflow.com/questions/280579/c-beginner-help-how-do-i-pass-a-value-from-a-child-back-to-the-parent-form#280731)以包含 out 参数。

我的问题是这是否是 C# 中的好方法。

这是一些示例代码，基于 yapiskan 的建议。在子窗体中（在本例中，它是一个带有文本框的窗体），您只需添加 ShowDialog 重载并将 UI 值分配给 out 参数：

```
public DialogResult ShowDialog(out string s)
{
    DialogResult result = this.ShowDialog();
    s = this.textBox1.Text;
    return result;
} 
```

要显示表单并检索输入的文本，请执行以下操作：

```
using (CustomDialog frm = new CustomDialog())
{
    string s;
    if (frm.ShowDialog(out s) == DialogResult.OK)
    {
        // do something with s
    }
} 
```

我能想到的一个优点是，这种方法迫使 CustomDialog 表单的用户通过表单的 ShowDialog 方法获取它包含的信息（而不是从诸如 GetMyData() 之类的所谓的方法） .

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T15:47:41.540

最好有一个公共属性/方法并获取信息。

如果你需要 3..4..5 条信息，有 5 个参数，你会怎么做？让访问者从对话框中获取您的信息更加干净。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T14:47:28.433

应该不行，因为 .net 框架不使用这种设计。对于 OpenFileDialog 类，它有一个返回 DialogResult 的无参数 ShowDialog() 方法。调用此方法后，用户应该使用 FileName、FileNames、SafeFileName 和 SafeFileNames 方法获取选定的文件。

让我们假设这是以“输出参数”的方式实现的。我必须编写这样的代码才能获得 SafeFileName：

```
string dummyFileName;
string[] dummyFileNames;
string safeFileName;
string[] dummySafeFileNames;

myDialog.ShowDialog(out dummyFileName, out dummyFileNames, out safeFileName, out dummySafeFileNames); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T15:56:33.550

就我个人而言，我尽量避免使用参数，尽管我知道像 GoTo 一样，它们有时是必要的邪恶。我会说使用属性或方法来返回信息会更好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T19:47:48.497

以我的经验，只收集一条信息的自定义模式对话框是一个非常极端的异常值。更常见的是零和多。

一个收集多条数据的对话框几乎肯定会在某个时候被修改为只收集一个。我宁愿只修复使用那条新数据的代码，也不愿修复使用修改后的对话框的每一段代码。

此外，请考虑开发人员如何使用 IntelliSense 来使用您的类。他要输入这个：

```
MyDialog d = new MyDialog();
d.ShowDialog( 
```

...在最后一次击键时，IntelliSense 会弹出告诉他他现在必须声明三个新的字符串变量来保存输出参数。于是他向上移动光标，开始输入：

```
string foo;
string 
```

...而且，第二个参数的名称又是什么？所以它回到了开放的paren，按CTRL + SPACE，哦是的，它是`bar`，回到上一行，等等。

在自定义对话框中使用属性的问题在于，Form 类已经拥有一百万个属性，而您正在创建的三四个特殊属性将会在混合中丢失。`Parameters`要解决此问题，请在自定义对话框上为对话框参数和该类型的属性创建一个类。这使得这样的代码很容易编写：

```
MyDialog d = new MyDialog();
d.Parameters.Foo = "foo";
d.Parameters.Bar = "bar";
d.Parameters.Baz = "baz"; 
```

因为参数名称会在 IntelliSense 中弹出，您无需声明任何变量来保存它们的值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T19:59:16.400

我的方法通常是编写一个内部调用 ShowDialog 的方法，然后适当地格式化输出数据。对于（人为的）示例：

```
public string GetFolderName(){
    if(this.ShowDialog() == DialogResult.OK) {
        return this.FolderName.Text;
    }
    return String.Empty;
} 
```

在大多数情况下，我将此方法设为静态，并从方法主体中实例化对话框本身——这样调用者就不必处理表单引用，或者不必选择调用哪个“显示”方法的概念.

在具有多个输出值的非边缘情况下，我通常构造一个包含这些值的结构，然后让我的“获取”函数返回该结构。

```
public struct FolderData {
    public static FolderData Empty = new FolderData();

    public string FolderName {get; set;}
    public int FilesInFolder {get; set;}
}

public FolderData GetFolderData(){
    if(this.ShowDialog() == DialogResult.OK) {
        return new FolderData {
            FolderName = this.FolderName.Text;
            FilesInFolder = int.Parse(this.FilesInFolder.Text);
        }
    }
    return FolderData.Empty;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T16:05:47.480

我更喜欢这个，因为我不喜欢在完成课程后从属性或方法获取结果的方法。在显示并关闭对话框表单后，我认为不应再使用该对象，因为从逻辑上讲您已经完成了对话框，那么我为什么要使用它的属性或方法来获得结果？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T20:30:13.030

@Musigenesis，您真的不想在更改对话框时强制客户端代码中断，并且使用仅有时有效的 out 参数不是一个好的设计。正如@Daok 所说，当您返回的值超过 1 个时，这开始变得混乱和难看。

您也不能强制客户端代码使用结果，就像 .net 框架确保您在文件对话框上调用属性一样。你也没有强迫调用者对 out 参数做任何事情，你强迫他们做的只是接受一个他们可能不想使用的变量。

如果对话框非常通用，这可能不适用，但与其将各种属性添加到对话框本身，不如使用一个在整个应用程序中一致使用的方法，并让它返回一个包含相关数据的特定类。

```
public sealed class MySaveDialogResult
{
    public static MySaveDialogResult NonOkResult(); // Null Object pattern
    public MySaveDialogResult( string filePath ) { ... }

    // encapsulate the dialog result
    public DialogResult DialogResult { get; private set; } 
    // some property that was set in the dialog
    public string FilePath { get; private set; }
    // another property set in the dialog
    public bool AllowOVerwrite { get; private set; }
} 
```

你的对话是

```
public MySaveDialog ...
{
    public MySaveDialogResult GetDialogResult() { .... }
} 
```

本质是一个小的不可变实用程序类，它也实现了空对象模式。只要对话结果不正确，就会返回 null 对象。显然，上面的内容是为了满足您的需要而在黑暗中拍摄的，因此可以随意更改它，制作继承层次结构等。

主要的一点是`GetDialogResult()`，对话框上的单个方法，返回一个封装所有相关对话框数据的类。

* * *

编辑：

@yapiskan 想知道为什么不直接“淘汰” `MyDialogResult`vs call `GetDialogResult()`。

IMO - 要点很简单：

1.  这不是约定
2.  方法调用非常简单，并且当您遵循上面的“约定”参数时会变得更容易。
3.  `out`使用起来很尴尬。`GetDialogResult()`不会强迫调用者编写笨拙的代码，也不会强迫用户在调用对话框时使用对话框结果。
4.  *通常*对话框不会重新实例化或重新显示以获得结果，它已经存在。Show() 和 Hide() 就是这样做的。

现实情况是，您正在用一个笨拙的 ShowDialog() 语法调用方法。方法调用很便宜，你不能保证调用者会使用你的 out 参数，就像你不能保证他们会调用 GetDialogResult() 一样。那何必呢。使事情易于使用，或者首先不要重载 ShowDialog。

也许你的子类化是时髦的并且行为不同，它不适用于你的情况，但一般的设计是当你点击 OK 时表单不会消失，当它们被 Disposed() 时它们会消失。

# javascript - 如何使用 javascript 动态创建框架的源？

> ID：281258
> 
> 赞同：0
> 
> 时间：2008-11-11T15:45:12.293
> 
> 标签：javascript, html, dhtml

假设我有一个带框架的 html 页面。左框架只是一个链接列表，将显示在右框架中。是否可以使用 javascript 在页面加载时生成左框架的内容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T15:49:43.127

当然。您可以使用 javascript`document.write()`或（我更喜欢）在左侧框架上保留一个空容器 (DIV)，并将您的 HTML 注入其`innerHTML`属性（也通过 javascript）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T15:52:21.297

parent.frameName.document.body 将是该框架的主体元素，您可以使用 DOM 方法（.createElement、.appendChild、.insertBefore）或 .innerHTML 来使用内容填充框架。

# c++ - Win32中的RGB后台缓冲区

> ID：281260
> 
> 赞同：0
> 
> 时间：2008-11-11T15:46:28.547
> 
> 标签：c++, c, winapi

我有一个 RGB 值数组，我可以保证其大小与屏幕上窗口的客户区相匹配。

使用 Win32 API，响应 WM_PAINT 消息，在屏幕上获取我的数组内容的最简单和最快的方法是什么？

如果它使它更简单/更快，我们可以假设它是一个 32 位显示器，并且数组的每个元素都是 32 位。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T16:26:08.110

如果您可以完全控制支持格式，请使用 DIB 格式和虚拟 BITMAPINFO 结构。然后使用[SetDIBitsToDevice](http://msdn.microsoft.com/en-us/library/ms532346(VS.85).aspx)复制到 DC。

请注意 DIB 格式的特殊性 - 每行必须扩展为 4 字节的倍数，缓冲区的第一行是图像的底行，字节顺序是蓝、绿、红。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T16:03:56.593

使用 BitBlt

# javascript - 在Javascript中从数组中删除空元素

> ID：281264
> 
> 赞同：1440
> 
> 时间：2008-11-11T15:48:54.113
> 
> 标签：javascript, arrays

如何从 JavaScript 中的数组中删除空元素？

有没有一种简单的方法，还是我需要遍历它并手动删除它们？

* * *

## 回答 #1

> 赞同：1574
> 
> 时间：2010-05-16T12:02:48.050

## 简单的方法：

```
var arr = [1,2,,3,,-3,null,,0,,undefined,4,,4,,5,,6,,,,];

arr.filter(n => n)
// [1, 2, 3, -3, 4, 4, 5, 6]

arr.filter(Number) 
// [1, 2, 3, -3, 4, 4, 5, 6]

arr.filter(Boolean) 
// [1, 2, 3, -3, 4, 4, 5, 6] 
```

**或 - （仅适用于“文本”类型的*单个*数组项）**

```
['','1','2',3,,'4',,undefined,,,'5'].join('').split(''); 
// output:  ["1","2","3","4","5"] 
```

**或 - 经典方式：简单迭代**

```
var arr = [1,2,null, undefined,3,,3,,,0,,,[],,{},,5,,6,,,,],
    len = arr.length, i;

for(i = 0; i < len; i++ )
    arr[i] && arr.push(arr[i]);  // copy non-empty values to the end of the array

arr.splice(0 , len);  // cut the array and leave only the non-empty values

arr // [1,2,3,3,[],Object{},5,6] 
```

## 通过 jQuery：

```
var arr = [1,2,,3,,3,,,0,,,4,,4,,5,,6,,,,];

arr = $.grep(arr,function(n){ return n == 0 || n });

arr // [1, 2, 3, 3, 0, 4, 4, 5, 6] 
```

## 更新 - 只是另一种快速、酷炫的方式（使用 ES6）：

```
var arr = [1,2,null, undefined,3,,3,,,0,,,4,,4,,5,,6,,,,], 
    temp = [];

for(let i of arr)
    i && temp.push(i); // copy each non-empty value to the 'temp' array

arr = temp;

arr // [1, 2, 3, 3, 4, 4, 5, 6] 
```

### 删除空值

```
['foo', '',,,'',,null, ' ', 3, true, [], [1], {}, undefined, ()=>{}].filter(String)

// ["foo", null, " ", 3, true, [1], Object {}, undefined, ()=>{}] 
```

* * *

## 回答 #2

> 赞同：1392
> 
> 时间：2008-11-11T16:12:59.400

**编辑：**这个问题几乎在九年前就得到了回答，当时`Array.prototype`.

现在，当然，我会建议您使用该`filter`方法。

请记住，此方法将返回*一个新数组*，其中包含通过您提供给它的回调函数标准的元素。

例如，如果要删除`null`或`undefined`值：

```
var array = [0, 1, null, 2, "", 3, undefined, 3,,,,,, 4,, 4,, 5,, 6,,,,];

var filtered = array.filter(function (el) {
  return el != null;
});

console.log(filtered);
```

这将取决于您认为什么是“空的”，例如，如果您正在处理字符串，上述函数不会删除空字符串的元素。

我经常看到的一种典型模式是删除*虚假*元素，其中包括空字符串`""`、`0`、`NaN`、`null`、`undefined`和`false`。

您可以传递给`filter`方法、`Boolean`构造函数，或者在过滤条件函数中返回相同的元素，例如：

```
var filtered = array.filter(Boolean); 
```

或者

```
var filtered = array.filter(function(el) { return el; }); 
```

这两种方式都有效，因为第`filter`一种情况下的方法将`Boolean`构造函数作为函数调用，转换值，而在第二种情况下，该`filter`方法在内部将回调的返回值隐式转换为`Boolean`.

如果您正在使用稀疏数组，并且试图摆脱“漏洞”，则可以使用`filter`传递返回 true 的回调的方法，例如：

```
var sparseArray = [0, , , 1, , , , , 2, , , , 3],
    cleanArray = sparseArray.filter(function () { return true });

console.log(cleanArray); // [ 0, 1, 2, 3 ]
```

**旧答案：**不要这样做！

我使用这种方法，扩展原生 Array 原型：

```
Array.prototype.clean = function(deleteValue) {
  for (var i = 0; i < this.length; i++) {
    if (this[i] == deleteValue) {         
      this.splice(i, 1);
      i--;
    }
  }
  return this;
};

test = new Array("", "One", "Two", "", "Three", "", "Four").clean("");
test2 = [1, 2,, 3,, 3,,,,,, 4,, 4,, 5,, 6,,,,];
test2.clean(undefined); 
```

或者您可以简单地将现有元素推送到其他数组中：

```
// Will remove all falsy values: undefined, null, 0, false, NaN and "" (empty string)
function cleanArray(actual) {
  var newArray = new Array();
  for (var i = 0; i < actual.length; i++) {
    if (actual[i]) {
      newArray.push(actual[i]);
    }
  }
  return newArray;
}

cleanArray([1, 2,, 3,, 3,,,,,, 4,, 4,, 5,, 6,,,,]); 
```

* * *

## 回答 #3

> 赞同：255
> 
> 时间：2011-10-28T01:41:09.063

如果您需要删除所有空值（“”、null、未定义和 0）：

```
arr = arr.filter(function(e){return e}); 
```

要删除空值和换行符：

```
arr = arr.filter(function(e){ return e.replace(/(\r\n|\n|\r)/gm,"")}); 
```

例子：

```
arr = ["hello",0,"",null,undefined,1,100," "]  
arr.filter(function(e){return e}); 
```

返回：

```
["hello", 1, 100, " "] 
```

**更新（基于 Alnitak 的评论）**

在某些情况下，您可能希望在数组中保留“0”并删除其他任何内容（null、未定义和“”），这是一种方法：

```
arr.filter(function(e){ return e === 0 || e }); 
```

返回：

```
["hello", 0, 1, 100, " "] 
```

* * *

## 回答 #4

> 赞同：141
> 
> 时间：2012-12-10T09:25:25.017

只需一个班轮：

```
[1, false, "", undefined, 2].filter(Boolean); // [1, 2] 
```

或使用[underscorejs.org](http://underscorejs.org/#filter)：

```
_.filter([1, false, "", undefined, 2], Boolean); // [1, 2]
// or even:
_.compact([1, false, "", undefined, 2]); // [1, 2] 
```

* * *

## 回答 #5

> 赞同：135
> 
> 时间：2008-11-11T16:29:34.780

如果你有 Javascript 1.6 或更高版本，你可以使用[`Array.filter`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/filter)一个简单的`return true`回调函数，例如：

```
arr = arr.filter(function() { return true; }); 
```

因为`.filter`自动跳过原始数组中缺失的元素。

上面链接的 MDN 页面还包含一个很好的错误检查版本`filter`，可用于不支持官方版本的 JavaScript 解释器。

请注意，这不会删除`null`条目或具有显式`undefined`值的条目，但 OP 特别要求“丢失”条目。

* * *

## 回答 #6

> 赞同：101
> 
> 时间：2018-01-09T07:28:03.840

为了去除孔，你应该使用

```
arr.filter(() => true)
arr.flat(0) // New in ES2019 
```

用于删除空洞、空和未定义：

```
arr.filter(x => x != null) 
```

用于删除空洞，并且，假 (null, undefined, 0, -0, 0n, NaN, "", false, document.all) 值：

```
arr.filter(x => x) 
```

```
arr = [, null, (void 0), 0, -0, 0n, NaN, false, '', 42];
console.log(arr.filter(() => true)); // [null, (void 0), 0, -0, 0n, NaN, false, '', 42]
console.log(arr.filter(x => x != null)); // [0, -0, 0n, NaN, false, "", 42]
console.log(arr.filter(x => x)); // [42]
```

笔记：

*   孔是一些没有元素的数组索引。

```
arr = [, ,];
console.log(arr[0], 0 in arr, arr.length); // undefined, false, 2; arr[0] is a hole
arr[42] = 42;
console.log(arr[10], 10 in arr, arr.length); // undefined, false, 43; arr[10] is a hole

arr1 = [1, 2, 3];
arr1[0] = (void 0);
console.log(arr1[0], 0 in arr1); // undefined, true; a[0] is undefined, not a hole

arr2 = [1, 2, 3];
delete arr2[0]; // NEVER do this please
console.log(arr2[0], 0 in arr2, arr2.length); // undefined, false; a[0] is a hole 
```

*   以上所有方法都返回给定数组的副本，而不是就地修改它。

```
arr = [1, 3, null, 4];
filtered = arr.filter(x => x != null);
console.log(filtered); // [1, 3, 4]
console.log(arr); // [1, 3, null, 4]; not modified 
```

* * *

## 回答 #7

> 赞同：59
> 
> 时间：2011-03-26T16:57:34.957

干净的方式来做到这一点。

```
var arr = [0,1,2,"Thomas","false",false,true,null,3,4,undefined,5,"end"];
arr = arr.filter(Boolean);
// [1, 2, "Thomas", "false", true, 3, 4, 5, "end"] 
```

* * *

## 回答 #8

> 赞同：43
> 
> 时间：2018-10-16T06:15:51.920

实际上，您可以使用`ES6+`方法，假设数组如下：

```
 const arr = [1,2,3,undefined,4,5,6,undefined,7,8,undefined,undefined,0,9]; 
```

答案可能是以下两种方式之一：

*   第一种方式：

    ```
    const clearArray = arr.filter(i => i); // [ 1, 2, 3, 4, 5, 6, 7, 8, 9 ] 
    ```

*   第二种方式：

    ```
    const clearArray = arr.filter(Boolean); // [ 1, 2, 3, 4, 5, 6, 7, 8, 9 ] 
    ```

```
const arr = [1,2,3,undefined,4,5,6,undefined,7,8,undefined,undefined,0,9];
console.log("arr.filter(i => i)", arr.filter(i => i));
console.log("arr.filter(Boolean)", arr.filter(Boolean));
```

* * *

## 回答 #9

> 赞同：42
> 
> 时间：2017-03-22T20:24:54.740

简单的 ES6

```
['a','b','',,,'w','b'].filter(v => v); 
```

* * *

## 回答 #10

> 赞同：42
> 
> 时间：2018-07-10T11:27:25.423

# ES6：

```
let newArr = arr.filter(e => e); 
```

* * *

## 回答 #11

> 赞同：22
> 
> 时间：2012-11-30T18:25:11.080

**使用下划线/Lodash：**

一般用例：

```
_.without(array, emptyVal, otherEmptyVal);
_.without([1, 2, 1, 0, 3, 1, 4], 0, 1); 
```

有空的：

```
_.without(['foo', 'bar', '', 'baz', '', '', 'foobar'], '');
--> ["foo", "bar", "baz", "foobar"] 
```

请参阅[lodash 文档以了解无](https://lodash.com/docs#without).

* * *

## 回答 #12

> 赞同：16
> 
> 时间：2011-12-19T18:57:01.500

如果使用库是一个选项，我知道 underscore.js 有一个名为 compact() [http://documentcloud.github.com/underscore/](http://documentcloud.github.com/underscore/)的函数，它还有其他几个与数组和集合相关的有用函数。

以下是他们文档的摘录：

> _.compact(数组)
> 
> 返回删除所有虚假值的数组副本。在 JavaScript 中，false、null、0、""、undefined 和 NaN 都是假的。
> 
> _.compact([0, 1, false, 2, '', 3]);
> 
> => [1, 2, 3]

* * *

## 回答 #13

> 赞同：15
> 
> 时间：2009-03-18T23:54:18.027

@Alnitak

如果您添加一些额外的代码，实际上 Array.filter 适用于所有浏览器。见下文。

```
var array = ["","one",0,"",null,0,1,2,4,"two"];

function isempty(x){
if(x!=="")
    return true;
}
var res = array.filter(isempty);
document.writeln(res.toJSONString());
// gives: ["one",0,null,0,1,2,4,"two"] 
```

这是您需要为 IE 添加的代码，但过滤器和函数式编程值得 imo。

```
//This prototype is provided by the Mozilla foundation and
//is distributed under the MIT license.
//http://www.ibiblio.org/pub/Linux/LICENSES/mit.license

if (!Array.prototype.filter)
{
  Array.prototype.filter = function(fun /*, thisp*/)
  {
    var len = this.length;
    if (typeof fun != "function")
      throw new TypeError();

    var res = new Array();
    var thisp = arguments[1];
    for (var i = 0; i < len; i++)
    {
      if (i in this)
      {
        var val = this[i]; // in case fun mutates this
        if (fun.call(thisp, val, i, this))
          res.push(val);
      }
    }

    return res;
  };
} 
```

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2014-11-08T18:10:58.093

由于没有其他人提到它并且大多数人在他们的项目中都包含下划线，因此您也可以使用`_.without(array, *values);`.

```
_.without(["text", "string", null, null, null, "text"], null)
// => ["text", "string", "text"] 
```

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2008-11-11T16:03:56.360

您可能会发现循环遍历数组并从要保留在数组中的项目中构建一个新数组比尝试按照建议进行循环和拼接更容易，因为在循环时修改数组的长度过度会带来问题。

你可以这样做：

```
function removeFalsyElementsFromArray(someArray) {
    var newArray = [];
    for(var index = 0; index < someArray.length; index++) {
        if(someArray[index]) {
            newArray.push(someArray[index]);
        }
    }
    return newArray;
} 
```

实际上这是一个更通用的解决方案：

```
function removeElementsFromArray(someArray, filter) {
    var newArray = [];
    for(var index = 0; index < someArray.length; index++) {
        if(filter(someArray[index]) == false) {
            newArray.push(someArray[index]);
        }
    }
    return newArray;
}

// then provide one or more filter functions that will 
// filter out the elements based on some condition:
function isNullOrUndefined(item) {
    return (item == null || typeof(item) == "undefined");
}

// then call the function like this:
var myArray = [1,2,,3,,3,,,,,,4,,4,,5,,6,,,,];
var results = removeElementsFromArray(myArray, isNullOrUndefined);

// results == [1,2,3,3,4,4,5,6] 
```

你明白了 - 然后你可以有其他类型的过滤器功能。可能比你需要的多，但我感觉很慷慨......；）

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2015-12-11T11:31:28.103

**this(ES6) 怎么样：从数组中删除 Falsy 值。**

```
var arr = [0,1,2,"test","false",false,true,null,3,4,undefined,5,"end"];

arr.filter((v) => (!!(v)==true));

//output:

//[1, 2, "test", "false", true, 3, 4, 5, "end"] 
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2017-12-28T10:44:03.203

您应该使用过滤器来获取没有空元素的数组。ES6 示例

```
const array = [1, 32, 2, undefined, 3];
const newArray = array.filter(arr => arr); 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2021-08-09T15:14:10.860

要从数组中删除未定义的元素，您可以简单地使用

```
const array = [
  { name: "tim", age: 1 },
  undefined,
  { name: "ewrfer", age: 22 },
  { name: "3tf5gh", age: 56 },
  null,
  { name: "kygm", age: 19 },
  undefined,
];
console.log(array.filter(Boolean));
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2014-10-21T22:23:15.633

当使用上面投票最高的答案时，第一个例子，我得到了字符串长度大于 1 的单个字符。下面是我对这个问题的解决方案。

```
var stringObject = ["", "some string yay", "", "", "Other string yay"];
stringObject = stringObject.filter(function(n){ return n.length > 0}); 
```

如果未定义则不返回，如果长度大于 0，我们将返回。希望对那里的人有所帮助。

**退货**

```
["some string yay", "Other string yay"] 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2012-11-27T15:34:40.257

我只是将我的声音添加到上面的“`Array..filter()`使用全局构造函数调用 ES5”golf-hack 中，但我建议使用`Object`代替`String`,`Boolean`或`Number`如上所述。

具体来说，ES5`filter()`已经不会为`undefined`数组中的元素触发；所以一个普遍返回的函数`true`，它返回*所有*元素`filter()`命中，必然只返回非`undefined`元素：

```
> [1,,5,6,772,5,24,5,'abc',function(){},1,5,,3].filter(function(){return true})
[1, 5, 6, 772, 5, 24, 5, 'abc', function (){}, 1, 5, 3] 
```

但是，写出`...(function(){return true;})`比写长`...(Object)`；*在任何情况下*`Object`，构造函数的返回值都是某种对象。与上面建议的原始装箱构造函数不同，没有可能的对象值是错误的，因此在布尔设置中，它是.*`Object``function(){return true}`*

 *```
> [1,,5,6,772,5,24,5,'abc',function(){},1,5,,3].filter(Object)
[1, 5, 6, 772, 5, 24, 5, 'abc', function (){}, 1, 5, 3] 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2017-03-29T10:28:02.807

```
var data = [null, 1,2,3];
var r = data.filter(function(i){ return i != null; }) 
```

* * *

```
console.log(r) 
```

> [1,2,3]

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2020-01-25T00:20:59.750

## 删除所有空元素

如果一个数组包含空对象、数组和字符串以及其他空元素，我们可以使用以下方法删除它们：

```
const arr = [ [], ['not', 'empty'], {}, { key: 'value' }, 0, 1, null, 2, "", "here", " ", 3, undefined, 3, , , , , , 4, , 4, , 5, , 6, , , ]

let filtered = JSON.stringify(
  arr.filter((obj) => {
    return ![null, undefined, ''].includes(obj)
  }).filter((el) => {
    return typeof el != "object" || Object.keys(el).length > 0
  })
)

console.log(JSON.parse(filtered))
```

## 简单压缩（从数组中删除空元素）

使用 ES6：

```
const arr = [0, 1, null, 2, "", 3, undefined, 3, , , , , , 4, , 4, , 5, , 6, , , ,]

let filtered = arr.filter((obj) => { return ![null, undefined].includes(obj) })

console.log(filtered)
```

使用纯 Javascript ->

```
var arr = [0, 1, null, 2, "", 3, undefined, 3, , , , , , 4, , 4, , 5, , 6, , , ,]

var filtered = arr.filter(function (obj) { return ![null, undefined].includes(obj) })

console.log(filtered)
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2020-08-24T15:49:19.443

您可以将过滤器与索引和`in`运算符一起使用

```
let a = [1,,2,,,3];
let b = a.filter((x,i)=> i in a);

console.log({a,b});
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2010-12-12T18:20:31.777

那个怎么样：

```
js> [1,2,,3,,3,,,0,,,4,,4,,5,,6,,,,].filter(String).join(',')
1,2,3,3,0,4,4,5,6 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2013-05-25T19:01:21.553

另一种方法是利用数组的长度属性：将非空项打包在数组的“左侧”，然后减小长度。它是一种就地算法——不分配内存，对垃圾收集器来说太糟糕了——并且它具有非常好的最佳/平均/最坏情况行为。

与此处的其他解决方案相比，此解决方案在 Chrome 上快 2 到 50 倍，在 Firefox 上快 5 到 50 倍，您可能会在这里看到：http: [//jsperf.com/remove-null-items-from-array](http://jsperf.com/remove-null-items-from-array)

下面的代码将不可枚举的 'removeNull' 方法添加到 Array 中，该方法返回 'this' 用于菊花链：

```
var removeNull = function() {
    var nullCount = 0           ;
    var length    = this.length ;
    for (var i=0, len=this.length; i<len; i++) { if (!this[i]) {nullCount++} }
    // no item is null
    if (!nullCount) { return this}
    // all items are null
    if (nullCount == length) { this.length = 0; return this }
    // mix of null // non-null
    var idest=0, isrc=length-1;
    length -= nullCount ;                
    while (true) {
         // find a non null (source) slot on the right
         while (!this[isrc])  { isrc--; nullCount--; } 
         if    (!nullCount) { break }       // break if found all null
         // find one null slot on the left (destination)
         while ( this[idest]) { idest++  }  
         // perform copy
         this[idest]=this[isrc];
         if (!(--nullCount)) {break}
         idest++;  isrc --; 
    }
    this.length=length; 
    return this;
};  

Object.defineProperty(Array.prototype, 'removeNull', 
                { value : removeNull, writable : true, configurable : true } ) ; 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2014-07-10T07:51:28.773

```
foo = [0, 1, 2, "", , false, 3, "four", null]

foo.filter(function(e) {
    return e === 0 ? '0' : e
}) 
```

**返回**

```
[0, 1, 2, 3, "four"] 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-11-11T17:50:39.233

这行得通，我在[AppJet](http://appjet.com/)中对其进行了测试（您可以在其 IDE 上复制粘贴代码并按“重新加载”以查看它的工作原理，无需创建帐户）

```
/* appjet:version 0.1 */
function Joes_remove(someArray) {
    var newArray = [];
    var element;
    for( element in someArray){
        if(someArray[element]!=undefined ) {
            newArray.push(someArray[element]);
        }
    }
    return newArray;
}

var myArray2 = [1,2,,3,,3,,,0,,,4,,4,,5,,6,,,,];

print("Original array:", myArray2);
print("Clenased array:", Joes_remove(myArray2) );
/*
Returns: [1,2,3,3,0,4,4,5,6]
*/ 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2016-03-14T12:56:17.680

在（对象成员）循环中“滥用” for ...。=> 只有真值出现在循环体中。

```
// --- Example ----------
var field = [];

field[0] = 'One';
field[1] = 1;
field[3] = true;
field[5] = 43.68;
field[7] = 'theLastElement';
// --- Example ----------

var originalLength;

// Store the length of the array.
originalLength = field.length;

for (var i in field) {
  // Attach the truthy values upon the end of the array. 
  field.push(field[i]);
}

// Delete the original range within the array so that
// only the new elements are preserved.
field.splice(0, originalLength); 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2017-03-30T05:33:59.510

这可能会对您有所帮助：[https ://lodash.com/docs/4.17.4#remove](https://lodash.com/docs/4.17.4#remove)

```
var details = [
            {
                reference: 'ref-1',
                description: 'desc-1',
                price: 1
            }, {
                reference: '',
                description: '',
                price: ''
            }, {
                reference: 'ref-2',
                description: 'desc-2',
                price: 200
            }, {
                reference: 'ref-3',
                description: 'desc-3',
                price: 3
            }, {
                reference: '',
                description: '',
                price: ''
            }
        ];

        scope.removeEmptyDetails(details);
        expect(details.length).toEqual(3); 
```

* * *

```
scope.removeEmptyDetails = function(details){
            _.remove(details, function(detail){
                return (_.isEmpty(detail.reference) && _.isEmpty(detail.description) && _.isEmpty(detail.price));
            });
        }; 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2018-02-21T06:58:16.447

```
var data= { 
    myAction: function(array){
        return array.filter(function(el){
           return (el !== (undefined || null || ''));
        }).join(" ");
    }
}; 
var string = data.myAction(["I", "am","", "working", "", "on","", "nodejs", "" ]);
console.log(string); 
```

输出：

> 我正在研究nodejs

它将从数组中删除空元素并显示其他元素。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2020-05-21T06:46:24.330

只需使用它即可从数组中删除 `array.filter(String);` 所有空元素它在javascript中返回数组的所有非空元素

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2016-03-11T18:26:51.193

删除空元素的最佳方法是使用[**`Array.prototype.filter()`**](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/filter)，正如其他答案中已经提到的那样。

不幸的是，`Array.prototype.filter()`IE<9 不支持。如果您仍然需要支持 IE8 或更旧版本的 IE，您可以使用以下[**polyfill**](https://remysharp.com/2010/10/08/what-is-a-polyfill)来添加对`Array.prototype.filter()`这些浏览器的支持：

```
if (!Array.prototype.filter) {
  Array.prototype.filter = function(fun/*, thisArg*/) {
    'use strict';
    if (this === void 0 || this === null) {
      throw new TypeError();
    }
    var t = Object(this);
    var len = t.length >>> 0;
    if (typeof fun !== 'function') {
      throw new TypeError();
    }
    var res = [];
    var thisArg = arguments.length >= 2 ? arguments[1] : void 0;
    for (var i = 0; i < len; i++) {
      if (i in t) {
        var val = t[i];
        if (fun.call(thisArg, val, i, t)) {
          res.push(val);
        }
      }
    }
    return res;
  };
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2016-11-24T10:30:54.250

**如果有人正在寻找清理整个数组或对象，这可能会有所帮助**。

```
var qwerty = {
    test1: null,
    test2: 'somestring',
    test3: 3,
    test4: {},
    test5: {
        foo: "bar"
    },
    test6: "",
    test7: undefined,
    test8: " ",
    test9: true,
    test10: [],
    test11: ["77","88"],
    test12: {
        foo: "foo",
        bar: {
            foo: "q",
            bar: {
                foo:4,
                bar:{}
            }
        },
        bob: {}
    }
}

var asdfg = [,,"", " ", "yyyy", 78, null, undefined,true, {}, {x:6}, [], [2,3,5]];

function clean_data(obj) {
    for (var key in obj) {
        // Delete null, undefined, "", " "
        if (obj[key] === null || obj[key] === undefined || obj[key] === "" || obj[key] === " ") {
            delete obj[key];
        }
        // Delete empty object
        // Note : typeof Array is also object
        if (typeof obj[key] === 'object' && Object.keys(obj[key]).length <= 0) {
            delete obj[key];
        }
        // If non empty object call function again
        if(typeof obj[key] === 'object'){
            clean_data(obj[key]);
        }
    }
    return obj;
}

var objData = clean_data(qwerty);
console.log(objData);
var arrayData = clean_data(asdfg);
console.log(arrayData); 
```

**输出：**

删除任何`null`, `undefined`, `""`, `" "`,`empty object`或`empty array`

jsfiddle[在这里](https://jsfiddle.net/Puni/besepud2/)

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2017-01-02T16:48:18.930

这个只会删除空值而不是虚假值，我认为这是更可取的。

还有一个选项可以删除空值。

这种方法应该比使用拼接要快得多。

```
 function cleanArray(a, removeNull) {
        var i, l, temp = [];
        l = a.length;
        if (removeNull) {
            for (i = 0; i < l; i++) {
                if (a[i] !== undefined && a[i] !== null) {
                    temp.push(a[i]);
                }
            }
        } else {
            for (i = 0; i < l; i++) {
                if (a[i] !== undefined) {
                    temp.push(a[i]);
                }
            }
        }
        a.length = 0;
        l = temp.length;
        for (i = 0; i < l; i++) {
            a[i] = temp[i];
        }
        temp.length = 0;
        return a;
    }
    var myArray = [1, 2, , 3, , 3, , , 0, , null, false, , NaN, '', 4, , 4, , 5, , 6, , , , ];
    cleanArray(myArray);
    myArray; 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2017-11-29T12:46:19.367

使用过滤器删除数组中的空字符串。

```
var s = [ '1,201,karthikeyan,K201,HELPER,karthikeyan.a@limitlessmobil.com,8248606269,7/14/2017,45680,TN-KAR24,8,800,1000,200,300,Karthikeyan,11/24/2017,Karthikeyan,11/24/2017,AVAILABLE\r',
  '' ]
var newArr = s.filter(function(entry) { return entry.trim() != ''; })

console.log(newArr); 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2019-09-17T13:04:49.790

就地解决方案：

```
function pack(arr) { // remove undefined values
  let p = -1
  for (let i = 0, len = arr.length; i < len; i++) {
    if (arr[i] !== undefined) { if (p >= 0) { arr[p] = arr[i]; p++ } }
    else if (p < 0) p = i
  }
  if (p >= 0) arr.length = p
  return arr
}

let a = [1, 2, 3, undefined, undefined, 4, 5, undefined, null]
console.log(JSON.stringify(a))
pack(a)
console.log(JSON.stringify(a)) 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2021-07-28T14:34:37.590

如果您使用的是 NodeJS，则可以使用[clean-deep](https://www.npmjs.com/package/clean-deep)包。以前用过`npm i clean-deep`。

```
const cleanDeep = require('clean-deep');
var array = [0, 1, null, 2, "", 3, undefined, 3,,,,,, 4,, 4,, 5,, 6,,,,];
const filterd = cleanDeep(array);
console.log(filterd); 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2021-08-19T17:11:38.287

上述答案都不适用于所有类型。下面的解决方案将删除 null、undefined、，`{}` `[]`并将`NaN`保留日期字符串，最好的是它甚至从嵌套对象中删除。

```
function removeNil(obj) {
    // recursively remove null and undefined from nested object too.
    return JSON.parse(JSON.stringify(obj), (k,v) => {
      if(v === null || v === '') return undefined;
      // convert date string to date.
      if (typeof v === "string" && /^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d.\d\d\dZ$/.test(v))
        return new Date(v);
      // remove empty array and object.
      if(typeof v === 'object' && !Object.keys(v).length) return undefined;
      return v;
    });
  } 
```

```
function removeNil(obj) {
    // recursively remove null and undefined from nested object too.
    return JSON.parse(JSON.stringify(obj), (k,v) => {
      if(v === null || v === '') return undefined;
      // convert date string to date.
      if (typeof v === "string" && /^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d.\d\d\dZ$/.test(v))
        return new Date(v);
      // remove empty array and object.
      if(typeof v === 'object' && !Object.keys(v).length) return undefined;
      return v;
    });
  }

 const ob = {
  s: 'a',
  b: 43,
  countries: [ 'a', 'b', 'c' ],
  l: null,
  n: { ks: 'a', efe: null, ce: '' },
  d: new Date(),
  nan: NaN,
  k: undefined,
  emptyO: {},
  emptyArr: [],
 }

 const output = removeNil(ob);

 console.log(output);
 console.log('Tests: ', ob.countries.length, typeof(ob.d))
```

* * *

## 回答 #39

> 赞同：-1
> 
> 时间：2010-02-25T11:56:57.600

使用正则表达式过滤掉无效条目

```
array = array.filter(/\w/);
filter + regexp 
```

* * *

## 回答 #40

> 赞同：-1
> 
> 时间：2019-07-04T10:36:28.880

这是我清理空字段的解决方案。

从费用对象开始：仅获取有效属性（带地图）过滤空字段（带过滤器）解析结果为整数（带地图）

```
fees.map( ( e ) => e.avail ).filter( v => v!== '').map( i => parseInt( i ) ); 
```

* * *

## 回答 #41

> 赞同：-1
> 
> 时间：2019-11-21T06:34:10.320

```
var a = [{a1: 1, children: [{a1: 2}, undefined, {a1: 3}]}, undefined, {a1: 5}, undefined, {a1: 6}]
function removeNilItemInArray(arr) {
    if (!arr || !arr.length) return;
    for (let i = 0; i < arr.length; i++) {
        if (!arr[i]) {
            arr.splice(i , 1);
            continue;
        }
        removeNilItemInArray(arr[i].children);
    }
}
var b = a;
removeNilItemInArray(a);
// Always keep this memory zone
console.log(b); 
```

* * *

## 回答 #42

> 赞同：-1
> 
> 时间：2021-11-30T10:08:09.423

```
// recursive implementation
function compact(arr) {
        const compactArray = [];
        //base case 
        if(!arr.length) return []
        if(typeof arr[0] !== "undefined" 
          && arr[0]!==null && arr[0] !== " " && 
          arr[0]!== false &&
          arr[0]!== 0){
          compactArray.push(arr[0]);
        }
        return compactArray.concat(compact(arr.slice(1)))
    }

    compact([1,0,false,null,undefined,"banana"])` 
```

* * *

## 回答 #43

> 赞同：-2
> 
> 时间：2013-07-04T16:10:43.190

很好...很好我们也可以像这样替换所有数组值

```
Array.prototype.ReplaceAllValues = function(OldValue,newValue)
{
    for( var i = 0; i < this.length; i++ )  
    {
        if( this[i] == OldValue )       
        {
            this[i] = newValue;
        }
    }
}; 
```

* * *

## 回答 #44

> 赞同：-2
> 
> 时间：2015-10-12T20:52:21.827

这是一个使用可变参数行为和 ES2015 粗箭头表达式的示例：

```
Array.prototype.clean = function() {
  var args = [].slice.call(arguments);
  return this.filter(item => args.indexOf(item) === -1);
};

// Usage
var arr = ["", undefined, 3, "yes", undefined, undefined, ""];
arr.clean(undefined); // ["", 3, "yes", ""];
arr.clean(undefined, ""); // [3, "yes"]; 
```

* * *

## 回答 #45

> 赞同：-3
> 
> 时间：2012-08-23T12:10:51.603

我需要做同样的任务并遇到了这个线程。我最终使用数组“join”创建了一个使用“_”分隔符的字符串，然后做了一些正则表达式： -

```
1\. replace "__" or more with just one "_",
2\. replace preceding "_" with nothing "" and similarly 
3\. replace and ending "_" with nothing "" 
```

...然后使用数组“拆分”来制作一个清理过的数组：-

```
var myArr = new Array("","","a","b","","c","","","","","","","","","e","");
var myStr = "";

myStr = myArr.join("_");

myStr = myStr.replace(new RegExp(/__*/g),"_");
myStr = myStr.replace(new RegExp(/^_/i),"");
myStr = myStr.replace(new RegExp(/_$/i),"");
myArr = myStr.split("_");

alert("myArr=" + myArr.join(",")); 
```

...或在 1 行代码中：-

```
var myArr = new Array("","","a","b","","c","","","","","","","","","e","");

myArr = myArr.join("_").replace(new RegExp(/__*/g),"_").replace(new RegExp(/^_/i),"").replace(new RegExp(/_$/i),"").split("_");

alert("myArr=" + myArr.join(",")); 
```

...或者，扩展 Array 对象：-

```
Array.prototype.clean = function() {
  return this.join("_").replace(new RegExp(/__*/g),"_").replace(new RegExp(/^_/i),"").replace(new RegExp(/_$/i),"").split("_");
};

var myArr = new Array("","","a","b","","c","","","","","","","","","e","");

alert("myArr=" + myArr.clean().join(",")); 
```

* * *

## 回答 #46

> 赞同：-4
> 
> 时间：2014-10-27T14:21:37.000

这是另一种方法：

```
var arr = ["a", "b", undefined, undefined, "e", undefined, "g", undefined, "i", "", "k"]
var cleanArr = arr.join('.').split(/\.+/); 
```

* * *

## 回答 #47

> 赞同：-5
> 
> 时间：2008-11-11T15:58:17.433

试试这个。将您的数组传递给它，它将返回并删除空元素。*已更新以解决 Jason 指出的错误

```
function removeEmptyElem(ary) {
    for (var i = ary.length - 1; i >= 0; i--) {
        if (ary[i] == undefined)  {
            ary.splice(i, 1);
        }       
    }
    return ary;
} 
```

* * *

## 回答 #48

> 赞同：-5
> 
> 时间：2016-07-13T18:46:42.633

这样做怎么样

```
// Removes all falsy values 
arr = arr.filter(function(array_val) { // creates an anonymous filter func
    var x = Boolean(array_val); // checks if val is null
    return x == true; // returns val to array if not null
  }); 
```

# c# - .NET 中有没有一种方法可以让您的方法重载首先出现在 Intellisense 下拉列表中？

> ID：281269
> 
> 赞同：7
> 
> 时间：2008-11-11T15:50:50.910
> 
> 标签：c#, .net, visual-studio, intellisense

在一个表单中，我添加了 ShowDialog() 的重载。在 Visual Studio 中，此重载在 Intellisense 中显示为第三个版本。如何使我的重载函数显示为#1（即默认值）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T16:13:28.383

您应该为此使用一个插件：完成所需任务的插件是来自 Tomato 的 Visual Assist - [http://www.wholetomato.com/](http://www.wholetomato.com/)

它完全符合您的要求（在其他选项中）：在建议列表顶部显示非继承成员和（或）使它们变为粗体

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T16:00:30.780

据我所知，在重载选择智能感知提示中没有办法控制重载的顺序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T16:08:53.760

没有。但是 VS 应该突出显示智能感知中最近使用的选项，这是下一个最好的选择。

工具->选项->文本编辑器->（您的语言）->智能感知->智能感知预选最近使用的成员

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T16:01:16.287

我相信，除非参数的数量小于列表中当前的#1。不过，我可能是错的——我经常是。:)

我不知道你为什么想要这个，虽然......

1.  没关系。和
2.  正如其他问题中所回答的那样，有更好的方法来实现您正在寻找的东西。

# c++ - 合并多个 STL 容器、删除重复元素的最佳方法？

> ID：281275
> 
> 赞同：9
> 
> 时间：2008-11-11T15:52:29.130
> 
> 标签：c++, stl

我有两个要合并的 STL 容器，删除任何出现多次的元素。例如：

```
typedef std::list<int> container;
container c1;
container c2;

c1.push_back(1);
c1.push_back(2);
c1.push_back(3);

c2.push_back(2);
c2.push_back(3);
c2.push_back(4);

container c3 = unique_merge(c1, c2);
// c3 now contains the following 4 elements:
//   1, 2, 3, 4 
```

std::unique 似乎仅适用于相邻元素，在我的情况下，容器可以按任何顺序排列。我猜我可以做一些**std::set**诡计：

```
container unique_merge(const container& c1, const container& c2)
{
    std::set<container::value_type> s;
    BOOST_FOREACH(const container::value_type& val, c1)
        s.insert(val);
    BOOST_FOREACH(const container::value_type& val, c2)
        s.insert(val);
    return container(s.begin(), s.end());
} 
```

有没有更好的方法或者我错过了一些明显的出血？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T16:00:18.287

对于无序列表，您的设置技巧可能是最好的方法之一。每个插入应该是 O(log n)，需要 N 个插入，遍历将是 O(n)，给你 O(N*log n)。另一种选择是在每个列表上单独运行 std::sort ，然后使用[std::set_union](http://msdn.microsoft.com/en-us/library/a20tb7e2.aspx)并行遍历它们，这会为您删除重复项。这也将是 O(n*log n)，因此如果您担心性能，则必须进行分析。如果你不是，做任何对你更有意义的事情。

编辑： 仅当原始列表中没有重复项时才有效，`set_union`否则您必须使用`sort`,`merge`和. 大 O 的性能仍然相同，但对分析有相同的警告。`unique``erase`

```
template <typename container>
container unique_merge(container c1, container c2)
{
    std::sort(c1.begin(), c1.end());
    std::sort(c2.begin(), c2.end());
    container mergeTarget;
    std::merge(c1.begin(), c1.end(), c2.begin(), c2.end(), 
        std::insert_iterator(mergeTarget, mergeTarget.end())
    );
    std::erase(
        std::unique(mergeTarget.begin(), mergeTarget.end()), 
        mergeTarget.end()
    );

    return mergeTarget;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T16:08:40.860

您将需要排序（显式地或通过像 set 这样的排序容器隐式地排序）。

有一个常见的习惯用法是使用 std::sort/std::unique/std::erase 来获取容器中的唯一元素。

所以创建一个包含 c1 内容的容器，附加 c2 的内容，然后排序，将唯一元素移动到末尾，然后删除它们。像这样的东西：

```
container c(c1.begin(), c1.end());
c.insert(c.end(), c2.begin(), c2.end());
c.erase(std::unique(c.begin(), c.end()), c.end()); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T16:04:12.770

使用 STL 中的[std::set_union 算法](https://en.cppreference.com/w/cpp/algorithm/set_union)。不过，您需要先对输入列表进行排序——或者创建输入列表的副本，对它们进行排序，然后使用 std::set_union。

# version-control - 日期戳的加速键

> ID：281276
> 
> 赞同：0
> 
> 时间：2008-11-11T15:52:55.087
> 
> 标签：version-control, automation, ssms

这是一个开放式问题。我处理很多 mssql 文件，我喜欢在每个文件上都有一个日期戳。这样我就可以通过查看存储过程的源来知道它是否是最新的。

我想要一个快捷的自动完成键，如果我输入说，d-tab-tab，我会将当前日期打印到文件中。是的，我就是那么懒惰。:)

所以问题是：

1.  有没有办法完全解决这个问题？
2.  如果不是，您建议如何解决？

欢迎聪明的想法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T15:57:27.013

这些文件是否在源代码管理中？如果是这样，请查看您的源代码控制提供商是否允许源文件中的模板在您签入时填写时间和日期。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T16:00:48.473

如果您使用记事本（这可能是使用它的唯一参数），那么 F5 就可以了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T16:18:28.360

如何为您的文件使用版本控制并包括自动关键字扩展。

使用[CVS 关键字扩展](http://www.badgertronics.com/writings/cvs/keywords.html)，您可以将`$Date: $`其放入文件中，它将被上次签入的日期替换。无需输入或更新，它是“自动魔术”。

# google-analytics - 有没有通过某种 API 来获取 Google Analytics？

> ID：281281
> 
> 赞同：0
> 
> 时间：2008-11-11T15:55:36.033
> 
> 标签：google-analytics

基本上我有一个管理 CP，我已经为我的所有网站编写了代码，我很想将谷歌分析收集的信息整合到它上面，以避免每天早上都查看这两个网站。

顺便说一句，我使用的是 PHP，但我假设如果存在这样的东西，它只会被导出为 XML。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T16:04:24.580

没有。

[这是使用 Yahoo Pipes 抓取您的分析页面的](http://blogoscoped.com/archive/2008-01-17-n73.html)
[方法 或者，您可以导出报告并使用它们](http://www.google.com/support/analytics/bin/answer.py?hl=en&answer=55561)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T16:06:59.973

私人测试版中有一个官方 API。我对此很期待！

[http://analytics.blogspot.com/2008/10/more-enterprise-class-features-added-to.html](http://analytics.blogspot.com/2008/10/more-enterprise-class-features-added-to.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T16:05:23.690

Nicolas Lierman 开发了一个[AIR 应用程序，该应用程序使用他自己创建的 API](http://www.aboutnico.be/?p=23)来收集 Google 分析数据。他拒绝发布 API，但显然它暴露了 Analytics 界面中的一些严重安全漏洞。谷歌自己从来没有为它发布过 API。

如果你真的想继续你的计划，你必须自己对界面进行逆向工程。

# cvs - 是否可以强制提交 CVS 注释？

> ID：281289
> 
> 赞同：3
> 
> 时间：2008-11-11T15:58:55.980
> 
> 标签：cvs

我想我真的很想帮助那些忘记的人，Cruise Control 会向每个人发送提交的详细信息，所以人们热衷于添加有意义的评论，但有时会忘记。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T16:03:24.333

不过，您还需要人工监控人们添加的评论。

或者当人们试图绕过你的检查时，期待一连串的“foo”、“checkin”、“commit”、“changed code”评论。

在过去的生活中，我们还强制提及缺陷/任务 ID，并检查该 ID 是否存在于任务跟踪系统中......

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-11T16:01:03.463

您可以编写一个[预提交挂钩](http://www.pragmaticautomation.com/cgi-bin/pragauto.cgi/Monitor/LettingCVSPullTheTrigger.rdoc)来检查这一点。这需要访问 CVS 服务器。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T16:09:50.920

与其通过 CVS 强制执行注释，不如告诉您的开发人员您可能正在对注释进行抽查，因此请在签入代码时添加有用的注释。虽然我同意代码本身的注释更有用，但有时了解代码签入的目的是有用的（例如，修复了在发票上舍入税额的错误）。但是，这很容易被滥用，有人不断检查评论，这会浪费大量时间。通过这种方式，它依赖于荣誉系统，以及没有人愿意因为没有发表您所要求的单行评论而被挑出来的事实。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T16:36:57.870

[verifymsg](http://ximbiot.com/cvs/manual/cvs-1.11.23/cvs_18.html#SEC183)文件看起来像您想要的，尽管我自己从未尝试过。如果提交评论不符合某些标准，则提交被中止。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-11T16:06:18.553

我们使用 Subversion 和 Tortoise 并且可以做到这一点。

基本上你需要在主干文件夹上设置 tsvn:logminsize 参数。这将允许您设置评论的最小长度（任何 > 1 将导致强制性评论）

# .net - 只读 DataGridView 和 IEditableObject

> ID：281297
> 
> 赞同：3
> 
> 时间：2008-11-11T16:00:26.007
> 
> 标签：.net, winforms, data-binding, ieditableobject

晚上好

我在 .NET Windows Forms 项目中的 DataGridView 有一点问题。网格是只读的，并且绑定到`BindingList<T>`包含自定义业务对象的可排序对象。我的业务对象类确实实现了`IEditableObject`.

现在，在网格中导航时会一直调用`BeginEdit`and`EndEdit`方法。有没有办法阻止网格或绑定源这样做？它被明确设置为只读（ReadOnly = true），因此根本没有理由（不，让我们小心地说我没有看到）一遍又一遍地调用这些方法。

感谢您阅读：）

马蒂亚斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T17:38:08.277

复制您的问题后，似乎 DataGridView 调用了一系列方法/事件，最终调用您的 IEditableObject 事件，无论如何......

当您将 Bi​​ndingList 设置为 DataGridView.DataSource 以及在 Grid 中导航时，会发生这种情况。

无论我为 DataGridView 选择什么 EditMode，代码都将进入 BusinessObjects 的 IEditableObject.EndEdit() 方法。

看来这是框架的一个旧**BUG** ...我发现了这个[Bug Report](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=98030)。

这个错误报告很老了。我不是 100% 确定这是否仍然是一个问题……也许已经有一些属性可以解决这个问题。

有什么想法吗？

# user-interface - 用于分类项目的最优雅的 UI？

> ID：281300
> 
> 赞同：8
> 
> 时间：2008-11-11T16:01:03.417
> 
> 标签：user-interface, usability

我有一组项目，用户需要以多种方式对其进行分组/分类。举个例子，假设它是汽车的集合，用户希望按以下方式对它们进行分类：

*   颜色（红、银、蓝、黑等）
*   车身形状（舱口盖、轿车、轿跑车、旅行车等）
*   座位（2、4、5、6 等）
*   等等

你有没有遇到过一种特别优雅的方式来允许用户完全自由地定义他们自己的类别和价值？

显然，在任何设计中都会有许多权衡取舍。例如，可学习的设计可能效率不高，反之亦然。或者某些设计可能比其他设计对房地产的要求更高。有些将比其他人花费更长的时间来开发。

无论如何，如果您已经看到 - 或设计了 - 一个很好的模式，我很想听听它。如果有截图就更好了。

**尝试澄清**：标签确实是一种对事物进行分类的好方法，但在我见过的所有实现中，只有一个级别的标签。用户通常不会定义类别/属性以及该类别中的项目*值*。要使用上面的示例和 StackOverflow 的标记，您可以将汽车标记为“蓝色”、“轿车”、“4”等。StackOverflow 不知道一个项目不能同时标记为“轿车”和“轿跑车”。

我正在考虑的界面需要知道那种东西，所以用户定义的属性建议更符合我的想法。我只是想找到一个如何优雅地实现这种系统的具体示例（在桌面应用程序中，如果这会有所不同的话）。

那是不是更清楚了？如果没有，请发表评论，我会再次澄清。:)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-12T14:53:32.150

听起来您有两个任务：任务 1 对对象进行分类，对于一系列对象，用户在多个维度（属性）中的每一个上为每个对象分配一个类别（值）。任务 2：创建和修改维度和类别。

在数据建模人员、面向对象的程序员和数据库设计人员之外，维度和类别的概念是一个很难掌握的概念。您应该为不了解类别和维度之间差异的用户做好准备。但是，用户通常会理解表格，其中每一列是一个维度（包含多个类别），每一行是一个对象。尽可能使用表格。

第一个关键问题是通过用户研究弄清楚Task 1 和Task 2 是集成的还是分离的程度。

如果任务是集成的，用户经常在不加思索的情况下流畅地从一个切换到另一个，那么一种 UI 设计是有一个按维度划分的对象表，但提供一个空白列（或“插入”按钮）以允许用户添加维度。列标题具有用户可以编辑的维度名称。标题下方是一个空格，列出了该维度的类别。每个类别名称都是可编辑的，并且有一个空行（或“插入”按钮）来添加新类别。下面是要分类的对象，每个对象的每一列都有一个下拉列表用于维度。

在可用性测试中，注意用户试图通过单击类别列表中的类别而不是从下拉列表中选择来设置对象的类别。使类别列表在视觉上分开显示以防止这种情况。

您可能需要一个按钮来隐藏/显示类别列表，因为这可能会占用大量空间（即使使用滚动条）。即使任务 1 和 2 紧密集成，我想您也会发现用户有时可能希望让类别列表不碍事。

如果您发现任务 1 和 2 是分开的，很少一起完成（例如，用户通常设置他们的维度然后对一堆对象进行分类），那么您最好为每个任务使用单独的窗口（或页面），尽管在它们之间来回导航应该很容易。例如，虽然用户通常会预先设置他们的维度，然后很少修改它们，但有时用户会意识到在对不寻常的对象进行分类时需要一个新的维度类别，因此您提供一个“添加类别”菜单项，让用户到“管理类别”窗口，为当前维度插入一个新类别，等待用户提供名称。

任务 1 的窗口与以前相同：对象表具有每个维度的下拉列表列，但不包括类别列表、维度名称的编辑以及添加新维度的能力。如果用户需要扫描需要分类或重新分类的对象，或者如果用户通常需要将一个对象与其他一些对象进行比较（例如，决定如何对对象进行分类），这是最有效的。但是，如果用户的任务确实仅限于根据外部信息一次对一个对象进行*分类*（例如，从纸上转录信息），那么请考虑使用表格而不是表格，显示一组列表框，每个列表框一个属性。只需单击每个列表框即可设置每个类别，这比使用下拉列表要快。

任务 2 的窗口可能类似于任务 1 的标题部分。它与用于任务 1 的表格一致，并允许用户一次查看多个维度的类别，帮助他们找出最佳分类方案（例如，帮助他们找到本质上相同的类别出现在两个不同维度中的位置）。但是，如果空间是一个问题，那么考虑一个维度列表，每个维度都显示一个主从关系中的类别列表。

任务 2 的最终用户功能和灵活性是树状控件。树的根级别包括维度，层次结构中的下一步包括每个维度中的类别。主要优点是它支持 *依赖*于类别的维度。例如，一个人可能有一个车辆类型维度，其中包括汽车、船、飞机等类别。对于汽车类别，一个人可能有一个车身类型维度，其中的类别仅适用于该类别（双门轿车、掀背车等）。 ）。从属维度在树中由一个类别的分支表示。结果是树在每个级别的维度和类别之间交替。

视觉上区分类别和维度很重要，可能是通过不同的图标，也可能是不同的字体——这告诉用户层次结构中的交替步骤在性质上是不同的（例如，如果你创建一个维度，那么你应该在至少两个类别）。即使这样，如果用户将维度与类别混淆（例如，允许他们将一堆“维度”移动到另一个维度下，将前者转换为类别），请提供一种轻松恢复的方法。

我想再次强调人们对维度和类别等抽象的困难。即使他们确实理解它，人们通常也很难自行创建体面的维度和类别。有一些复杂的交互可能会导致您需要仔细考虑（例如，当一个类别移动到一个新维度时，对象分类会发生什么？）。如果您希望每个用户真正创建自己的新颖维度，那么您可能需要认真重新考虑您的整个方法。这是一项本质上复杂的任务。

如果在文化、组织或领域中已经存在相关的多维方案（例如我们的汽车），用户会做得更好。当然，如果已经有一个方案，那么您可以研究它并将其安装为您产品中的默认维度集。只需要支持任务 2 以允许专家用户对其进行微调。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T16:04:57.997

您可以使用**标签**：让用户标记每个图像，然后显示一组按标签排序的图像缩略图。

也许比标签更高级的是一组用户定义的属性。例如，不要用“red”标记图片，而是用属性“color=red”标记它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T16:06:20.380

我建议使用类似于 stackoverflow 上的标记系统。允许他们标记图像，然后按标记或选项卡组合查看。查看页面时，在其下方显示图像的缩略图和该图像的标签。

编辑：根据您的说明，您可以拥有标签类型。当用户定义他们自己的标签时，他们需要指定它来自哪个类型。考虑到这一点，您需要将标签限制为仅其中一种类型。

```
TagType { Color, Seats, BodyType, Seats }
TabSubType { Color-Red, Color-Blue, Color-Green, Seats-2, Seats-4, ... } 
```

当用户想要添加标签时，给他们一个带有标签类型的下拉菜单。在此之下，再给出一个带有 TabSubTypes 的下拉列表。给他们一个“定义新的”选项，这将导致一个文本框出现在他们可以输入新类型的地方。

我还将这些选项添加到上下文菜单中，以便用户可以在树形菜单中查看标签。即使图像被聚焦，您也可以抓住按键，查找 TagType 和 TagSubType 名称并显示可供选择的选项菜单。如果未找到匹配项，请提供“单击以添加新标签”选项。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T19:42:01.990

分面分类是一种对没有得到应有关注的事物进行分类的方法。它允许您定义互斥类别并为每个类别的每个内容项提供一个值。例如，您可以按地区、品种、年份和价格对葡萄酒进行分类，用户将通过在一个或多个类别中选择一个或多个值来进行搜索。例如，“40 美元以下的法国或意大利红葡萄酒”。假设您手头有类别数据，这通常是可用的最强大的分类和搜索技术，比尝试将所有内容放入单个层次结构或依赖标签更好。

要在后端实现这一点，请为每个类别制作表格并用不同的值填充它们。然后制作一个表，其中包含每个类别表的外键以及包含内容的字段。这类似于维度数据库设计中的“事实”表。

要了解它如何在 UI 中工作，请查看 Facetmap。我不能保证他们的产品，因为我没有使用过它，但我已经为我自己的应用程序实现了类似的东西，效果很好。

[http://www.facetmap.com/](http://www.facetmap.com/)

再一次，多面分类背后的想法值得更多关注，我知道我在这里没有公平对待它们。对于 Clay Shirky 对这个主题的有趣处理，请听“Ontology is Overrated”：

[http://itc.conversationsnetwork.org/shows/detail470.html](http://itc.conversationsnetwork.org/shows/detail470.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T16:04:32.693

我可能误解了你的问题，但如果不是标签的确切用途（如堆栈溢出和 gmail），那也不是很相似。还是您正在寻找比这更具体的东西？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T22:18:59.050

好的，好吧，我倾向于继续谈论这个太多，但标记只是你可以用三重图做什么的一个例子，例如使用 RDF。[插入维基百科的链接]。现在我知道你说标签是不够的，基于嵌套的要求，但你没有理由不能进一步“标签标签”作为彼此的孩子。

```
Car|Tagged_with|Red
Red|Is_child_of|Colours 
```

通过这种方式，您的数据仍然非常灵活，并且实际上什么是数据和什么是元数据之间的界限变得模糊。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-09T21:03:37.927

这似乎是一个需要解决的问题，尤其是让用户将维度数据分类为更进一步、更简化的维度（组或类别，无论您想如何称呼它们），以便他们可以通过简化的类别/维度更好地可视化数据。

用户需要能够导入列表，并为列表创建维度，然后根据这些维度直观地对列表进行分类。创建维度包括命名/重命名维度（列名），然后添加/重命名/删除该维度的类别（列项）。在创建新维度和使用用户创建的新维度单独或批量对列表项进行实际分类之间切换应该是无缝的。然后，用户可以导出包含新创建类别的附加列或列（维度）的列表。

这个想法是，它会比只拥有一个表格并向其添加列更加用户友好。理想情况下，您可以选择列表中的项目，然后从用户创建的维度列表中为它们分配一个经过验证的类别项目，该列表将自动填充可以导出的只读表。输入=列表，输出=综合分类列表。无需电子表格。

# .net - SELECT INTO 附加列

> ID：281323
> 
> 赞同：2
> 
> 时间：2008-11-11T16:08:11.343
> 
> 标签：.net, sql, sql-server-2005, tsql

我正在尝试将一个表中的行的副本插入到具有相同架构的另一个表中，并添加一个列（时间戳）以提供 MS Sql Server 2005 中第一个表的“历史记录”。

因此，如果没有附加列，我的查询将是：

```
"SELECT INTO [WebsiteHistory] FROM [Website]" 
```

我也想填充时间戳列，但不确定如何最好地做到这一点。我想做类似的事情：

```
"SELECT Website.*, '" + DateTime.Now.ToShortDateString() + "' INTO [WebsiteHistory] FROM [Website]" 
```

但这不应该起作用，特别是如果时间戳列不是最后一个。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-11T16:13:26.277

被警告。这可行，但既不*好*也不推荐：

```
INSERT
  WebsiteHistory
SELECT
  *,
  GETDATE()
FROM
  Website
WHERE
  Id = @WebsiteId 
```

这假设`WebsiteHistory`具有与（您所说的）相同的结构，`Website`而且还有一个附加`DATETIME`字段。

更好的是，因为它更安全（以更冗长为代价）：

```
INSERT
  WebsiteHistory
  (
  Id,
  Field1,
  Field2,
  Field3,
  Field4,
  ModifiedDate
  )
SELECT
  Id,
  Field1,
  Field2,
  Field3,
  Field4,
  GETDATE()
FROM
  Website
WHERE
  Id = @WebsiteId 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T16:27:07.843

您不能在将行插入表时自动填充时间戳列的列上设置默认约束吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T16:25:08.500

查看这个问题的公认答案：[Dynamicly look up column names for a table while in an sql query](https://stackoverflow.com/questions/205950/dynamically-look-up-column-names-for-a-table-while-in-an-sql-query)

它获取表中所有字段的名称以创建针对该表定制的查询。您应该能够简单地采用完全相同的技术在此处生成正确的字段名称。

# vb.net - 泛型表达怪异

> ID：281325
> 
> 赞同：0
> 
> 时间：2008-11-11T16:08:35.633
> 
> 标签：vb.net, linq, generics

下面的代码给出了一个错误：

> 没有为类型“ConsoleApplication1.IKeyed`1[TKey]”定义属性“Int32 Key”

当创建表达式 e 但创建 func f 时很好，任何人都可以解释为什么以及是否有办法解决它？

```
Module Module1
    Sub Main()
        Dim g = New keyedThingGetter(Of KeyedThing, Integer)
        Dim thing = g.getThing()
    End Sub
End Module

Public Class keyedThingGetter(Of Tthing As IKeyed(Of TKey), TKey)
    Public Function getThing() As Tthing
        Dim f As Func(Of Tthing, Boolean)
        f = Function(thing) thing.Key.Equals(1)
        Dim e As Expressions.Expression(Of Func(Of Tthing, Boolean))
        e = Function(thing) thing.Key.Equals(1)
        Return Nothing
    End Function
End Class

Public Interface IKeyed(Of TKey)
    ReadOnly Property Key() As TKey
End Interface

Public Class KeyedThing
    Implements IKeyed(Of Integer)
    Public ReadOnly Property Key() As Integer Implements IKeyed(Of Integer).Key
        Get
            Return 1
        End Get
    End Property
End Class 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T16:19:56.750

**解决方法在底部**

这很奇怪。我仍在研究它，但这个“大部分等效”的 C# 工作正常：

```
using System;
using System.Linq.Expressions;

interface IKeyed<TKey>
{
    TKey Key { get; }
}

class KeyedThing : IKeyed<int>
{
    public int Key { get { return 1; } }
}

class KeyedThingGetter<TThing, TKey> where TThing : IKeyed<TKey>
{
    public void GetThing()
    {
        Func<TThing, bool> f = thing => thing.Key.Equals(1);
        Expression<Func<TThing, bool>> e = thing => thing.Key.Equals(1);
    }
}

class Test
{
    static void Main()
    {
        var g = new KeyedThingGetter<KeyedThing, int>();
        g.GetThing();
    }
} 
```

编辑：创建的表达式树之间有一个有趣的区别。这是 VB 表达式（使用 Reflector 反编译为 C#）：

```
Expression<Func<Tthing, bool>> expression = Expression
.Lambda<Func<Tthing, bool>> (Expression.Call(Expression.Convert
(Expression.Property(Expression.Convert(expression2 = 
Expression.Parameter(typeof(Tthing), "thing"), typeof(IKeyed<>)),
(MethodInfo) methodof(IKeyed<TKey>.get_Key, IKeyed<TKey>)), typeof(object)), 
(MethodInfo) methodof(object.Equals), new Expression[] { 
Expression.Convert(Expression.Constant(1, typeof(int)), typeof(object)) }), new 
ParameterExpression[] { expression2 }); 
```

这是 C# 版本：

```
Expression<Func<TThing, bool>> expression = Expression
.Lambda<Func<TThing, bool>> (Expression.Call(Expression.Convert
(Expression.Property(Expression.Convert(expression2 = 
Expression.Parameter(typeof(TThing), "thing"), typeof(IKeyed<TKey>)), 
(MethodInfo) methodof(IKeyed<TKey>.get_Key, IKeyed<TKey>)), typeof(object)), 
(MethodInfo) methodof(object.Equals), new Expression[] { 
Expression.Convert(Expression.Constant(1, typeof(int)), typeof(object)) }), new 
ParameterExpression[] { expression2 }); 
```

不同之处在于第四行 - 参数的类型。在 C# 中，它是`typeof(IKeyed<TKey>)`，而在 VB 中，它是`typeof(IKeyed<>)`.

可能是 VB 编译器中的错误？还不确定。希望 Marc G 能尽快加入，作为常驻表达式树专家......

编辑：鉴于差异，我想出了如何解决它。将其更改为：

```
Dim e as Expressions.Expression(Of Func(Of Tthing, Boolean))
e = Function(thing as IKeyed(Of TKey)) thing.Key.Equals(1)) 
```

或者

```
Dim e as Expressions.Expression(Of Func(Of IKeyed(Of TKey), Boolean))
e = Function(thing) thing.Key.Equals(1)) 
```

# css - 列表项变成浮动：左块在 IE6 中看起来很奇怪

> ID：281334
> 
> 赞同：1
> 
> 时间：2008-11-11T16:12:39.370
> 
> 标签：css, internet-explorer-6

我有一个看起来像这样的 UL：

```
<ul class="popular-pages">
    <li><a href="region/us/california/">California</a></li>
    <li><a href="region/us/michigan/">Michigan</a></li>
    <li><a href="region/us/missouri/">Missouri</a></li>
    <li><a href="region/us/new-york/">New York</a></li>
    <li><a href="region/us/oregon/">Oregon</a></li>
    <li><a href="region/us/oregon-washington/">Oregon; Washington</a></li>
    <li><a href="region/us/pennsylvania/">Pennsylvania</a></li>
    <li><a href="region/us/texas/">Texas</a></li>
    <li><a href="region/us/virginia/">Virginia</a></li>
    <li><a href="region/us/washington/">Washington</a></li>
</ul> 
```

看起来像这样的 CSS：

```
ul.popular-pages li a { 
    display:block; 
    float:left; 
    border-right:1px solid #b0b0b0; 
    border-bottom:1px solid #8d8d8d; 
    padding:10px; 
    background-color:#ebf4e0; 
    margin:2px; color:#526d3f 
}
ul.popular-pages li a:hover { 
    text-decoration:none; 
    border-left:1px solid #b0b0b0; 
    border-top:1px solid #8d8d8d; 
    border-right:none; 
    border-bottom:none;
} 
```

所以它在现代浏览器中运行良好，但在 IE6 中看起来像这样。有什么建议么？ ![替代文字](https://thecleverest.com/Picture_26.png)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T16:28:57.247

您的布局的原因可能是因为您在锚点上有浮动，而是将其移动到列表项。

```
ul.popular-pages li {
 向左飘浮;
}

```

由于您没有在 LI 中设置任何宽度，因此我建议您跳过浮动并设置 display: inline 在您的 LI 上，如果您希望它们连续显示。

使用 padding/margin 调整它们之间的适当间距，并调整 line-height 以获得任何最终第二行的正确行为。

这样，您的 UL 不会占用空间，无需在列表末尾添加隐藏的 clear-element（这是您的另一种选择）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T16:46:39.440

您正在浮动您的元素，因此它们的父级需要通过[clearfix](http://www.google.com/search?q=css+clearfix) 'hack' 清除/重置流。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T16:17:35.613

您使用的是什么 DOCTYPE？DOCTYPE 对浏览器的渲染方式有影响。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T16:20:26.590

尝试将此 CSS hack 用于 IE6。

```
*html ul.popular-pages li a { 
    display:block; 
    float:left; 
    border-right:1px solid #b0b0b0; 
    border-bottom:1px solid #8d8d8d; 
    padding:10px; 
    background-color:#ebf4e0; 
    margin:2px; 
    color:#526d3f 
}

*html ul.popular-pages li a:hover { 
    text-decoration:none; 
    border-left:1px solid #b0b0b0; 
    border-top:1px solid #8d8d8d; 
    border-right:none; 
    border-bottom:none;
} 
```

然后调整 IE6 的 CSS 定义

# sql-server - 在 SQL Management Studio 中删除/更新之前确认？

> ID：281339
> 
> 赞同：10
> 
> 时间：2008-11-11T16:13:59.507
> 
> 标签：sql-server, ssms

因此，连续第二天，有人清除了整个数据表，而不是他们试图删除的一行，因为他们没有限定的 where 子句。

我一直在调整 mgmt studio 选项，但找不到确认选项。我知道其他数据库的其他工具也有。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-11T16:33:56.940

我建议您**始终**首先使用 WHERE 子句编写 SELECT 语句并执行它以实际查看您的 DELETE 命令将删除哪些行。然后只需使用相同的 WHERE 子句执行 DELETE。这同样适用于更新。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-11T16:24:28.423

在 Tools>Options>Query Execution>SQL Server>ANSI 下，您可以启用 Implicit Transactions 选项，这意味着您不需要显式包含 Begin Transaction 命令。

这样做的明显缺点是您可能会忘记在末尾添加 Commit（或 Rollback），或者更糟糕的是，您的同事默认情况下会在每个脚本的末尾添加 Commit。

你可以把马牵到水边...

*您可能会建议他们在执行任何*操作之前始终进行临时备份（取决于数据库的大小）以防万一。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-11T16:15:35.807

在运行语句`BEGIN TRANSACTION`之前尝试使用 a 。`DELETE`

然后你可以选择`COMMIT`或`ROLLBACK`相同。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-11T16:29:07.340

在 SSMS 2005 中，您可以在 Tools|Options|Query Execution|SQL Server|ANSI ... check 下启用此选项`SET IMPLICIT_TRANSACTIONS`。这将需要提交来影响未来连接的更新/删除查询。

对于当前查询，转到查询|查询选项|执行|ANSI 并选中相同的框。

如果您使用的是 SSMS 2000，[此页面也有说明。](http://bytes.com/forum/thread499461.html)

正如其他人所指出的那样，这并不能解决根本原因：在您创建的每个新查询的末尾粘贴 COMMIT 几乎与首先触发查询一样容易。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-11T18:45:59.450

首先，这就是审计表的用途。如果您知道谁删除了所有记录，您可以限制他们的数据库权限或从性能角度处理它们。在我办公室做这件事的最后一个人目前正在试用期。如果她再次这样做，她将被放开。如果您有权访问生产数据并确保您不会造成伤害，那么您就有责任是其中之一。这是一个性能问题，也是一个技术问题。您永远不会找到防止人们犯愚蠢错误的方法（数据库无法知道您是要删除表 a 还是删除 id = 100 的表 a 并且大多数人会自动点击确认）。您只能通过确保运行此代码的人员负责并制定政策来帮助他们记住要做什么来尝试减少它们。

其他人建议我们采取哪些措施来防止这种情况发生。我总是在我从查询窗口运行的删除中嵌入一个选择，以确保它只会删除我想要的记录。我们在生产中更改、插入或删除数据的所有代码都必须包含在事务中。如果它是手动运行的，则在看到受影响的记录数之前不要运行回滚或提交。

使用嵌入式选择删除的示例

```
delete a
--select a.* from 
from table1 a 
join table 2 b on a.id = b.id
where b.somefield = 'test' 
```

但即使是这些技术也不能防止所有的人为错误。不了解数据的开发人员可能会运行 select 并且仍然不了解它正在删除太多记录。当人们忘记提交或回滚并锁定系统时，在事务中运行可能意味着您会遇到其他问题。或者人们可能将它放在一个事务中并且仍然不假思索地点击提交，就像如果有一个消息框他们会点击确认一样。最好的预防措施是有一种方法可以快速从此类错误中恢复。从审计日志表中恢复往往比从备份中恢复更快。另外，您还可以知道谁犯了错误以及哪些记录受到了影响（也许您没有删除整个表，但您的 where 子句是错误的，并且您删除了一些错误的记录。）

在大多数情况下，不应即时更改生产数据。您应该编写更改脚本并首先在 dev 上检查它。然后在 prod 上，您所要做的就是在不做任何更改的情况下运行脚本，而不是一次突出显示并运行小块。现在在现实世界中，这并不总是可能的，因为有时您只在需要修复的产品上修复损坏的东西（例如，当您的客户都无法登录时，因为关键数据已被删除）。在这种情况下，您可能无法先在 dev 上重现问题，然后再编写修复程序。当您遇到这些类型的问题时，您可能需要直接在 prod 上进行修复，并且您应该只有 dbas 或数据库分析师、配置经理或其他通常负责 prod 数据的人而不是开发人员来修复。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-11T18:28:19.297

*因此，连续第二天，有人清除了整个数据表，而不是他们试图删除的一行，因为他们没有合格的 where 子句*

可能唯一的解决方案是用其他人替换某人*；**）*。否则他们总会找到解决方法

 *最终限制该人的数据库访问，并为他们提供存储过程，该存储过程采用 where 子句中使用的参数，并授予他们执行该存储过程的访问权限。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-11T16:25:52.713

这就是为什么我认为您应该始终：

1 在部署到生产之前使用在开发数据库上测试的存储过程

2 选择删除前的数据

3 使用面试和绩效评估流程筛选开发人员 :)

4 基于他们删除/不删除多少数据库表的性能评估

5 把生产数据当作有毒的，非常害怕

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-11T16:27:49.743

穿上你最好的 Trogdor 和 Burninate，直到他们学会使用 WHERE 子句。

最好的建议是让那些在数据库中乱七八糟的垃圾在测试时使用事务。它对防止“哎呀”时刻大有帮助。需要注意的是，现在您必须告诉他们 COMMIT 或 ROLLBACK，因为他们肯定会至少锁定您的数据库一次。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-11T18:59:18.847

锁定它：

`REVOKE`删除所有表的权限。

放入审计触发器和审计表。

创建参数化删除 SP 并仅授予根据需要执行的权限。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-11T18:55:04.830

难道没有办法在不提供对 SQL 的原始访问权限的情况下为用户提供他们需要的结果吗？如果您至少有一个单独的“WHERE”输入框，则可以将其默认为“WHERE 1 = 0”或其他内容。

我认为也必须有一种方法可以将这些从事务日志中删除。但可能并非没有回滚所有内容，然后有选择地重新应用致命错误之后出现的任何内容。

另一个丑陋的选择是创建一个触发器，将所有 DELETE（可能超过某个最小记录数）写入日志表。

# java - 模式的 Castor 编译根据模式中的元素产生不同的类层次结构

> ID：281341
> 
> 赞同：2
> 
> 时间：2008-11-11T16:14:40.347
> 
> 标签：java, castor

在维护基于 castor 的系统的同时，我修改了源模式以生成一组新的类，并发现引入新元素会产生不同的类层次结构。这适用于任何元素类型。

简而言之，当前模式创建了`foo`extends `fooParent`which extends的类`fooGrandparent`。在模式中引入一个与这些类无关的新元素，Castor 现在生成`foo`AND`fooParent`两者都 extend `fooGrandparent`。

有没有人见过这个？

# java - 现在选择哪个 Java GUI 框架？

> ID：281342
> 
> 赞同：18
> 
> 时间：2008-11-11T16:14:57.493
> 
> 标签：java, user-interface, cross-platform, gui-toolkit

**如果您现在**或在不久的将来开始您的新项目，您会选择哪个 GUI 框架/库？

它必须免费用于商业用途和跨平台。

我一直是一个快乐的 Swing 用户，但 Sun 似乎将**swing**推向弃用，同时推**Javafx**，它还没有准备好迎接黄金时间。

还有**SWT**，但它似乎在 Linux 上存在问题。

您选择的 Gui 库/框架是什么？

编辑：Sun 已经取消**了 swingx**项目。从[http://swingx.dev.java.net](http://swingx.dev.java.net)上的论坛评论看来，以前在核心 swing 上工作的大多数 Sun 资源现在都在全职开发 JavaFx。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T16:58:42.287

我认为尽管 Sun 管理不善，但 Swing 仍然是一个出色的框架。你可以用它做*很多*事情，特别是如果那个“很多”涉及自定义呈现的 UI 控件。如果您的应用程序需要一个品牌的 LAF，或者甚至只是一些复杂的自定义控件，Swing 正是您想要的。

另一方面，我非常喜欢 SWT。它得到了一个坏名声，因为每个人都认为这是 IBM 接管 Java 的策略，但它实际上只是另一个与 Swing 互补的 UI 框架。我不建议将 SWT 用于超复杂的图形渲染（特别是：合成）或创建真正重要的自定义控件，但对于其他一切来说，它真的很花哨。由于依赖位掩码和用户管理的事件分派循环，API 本身受到了很多批评，但是一旦你习惯了这些东西，其中大部分都是非常透明的。组件本身比 Swing 的要简单得多（在可扩展性和类似方面），这意味着 API 可以按比例更简单。我实际上可以记住如何在 SWT 中创建和填充表；*曾经*在没有 Google 帮助的情况下在 Swing 中处理过这个问题。

SWT 目前最大的问题是稳定版本依赖于 Mac OS X 上的 Carbon。这意味着 SWT 应用程序只能在 Java 5 上运行 32 位（或在 SoyLatte 上为 32 位）。至于其他平台，SWT 在 Windows（Vista 和 XP）上非常出色，在 GTK Linux 上几乎同样出色。我（最近）在 Linux 上对 SWT 没有任何问题，所以我有点惊讶你会提到它作为一个痛点。

回到您的问题：这完全取决于您的应用程序需要什么。如果它是一个带有大量自定义控件和复杂合成的华丽自定义风格的应用程序，那么 Swing 是城里唯一的游戏。但是，如果更简单的 API 对您来说更重要，或者如果您的用户需要最终的平台 LAF 保真度，那么 SWT 是最佳选择。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T16:37:09.040

现在，我正在使用 SWT 或 Qt (Jambi)。

Swing 在过去 10 年没有发展，错误没有修复，开发已经停止支持 JavaFX，所以你也不会看到任何新功能。JavaFX 可能看起来很棒，但它仍然是蒸汽软件，它是由让 Swing 饿死的人制作的，所以我不会在它上面投入任何资金。

在 SWT 和 Qt 之间，我更喜欢使用 Qt，因为它是一个非常成熟和强大的框架，由知道自己在做什么的人制作（好吧，无论如何，大部分时间 :)）和 SWT，如果新项目的许可证不是与 Qt 兼容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T16:16:47.877

我仍然使用 Swing，并将继续这样做，直到它不再受支持。感谢有关 Javafx 的提醒，我现在必须研究一下。

# svn - 发布配置管理

> ID：281350
> 
> 赞同：3
> 
> 时间：2008-11-11T16:17:13.867
> 
> 标签：svn, version-control, asset-management

我们的 Windows 可交付成果为不同的客户提供不同的配置文件和二进制资产集。现在配置是在打包之前手动完成的，容易出错。您如何看待为每个客户使用分支，并让包构建/脚本自动合并客户的分支与主干？

我不太关心可伸缩性，而是更关心尽快实现自动化。

整个包内容都在 SVN 中，但是 SVN 分支和合并非常微妙，以至于我不相信它在自动化时能够始终如一地工作。如果你们喜欢这个想法，我可能会尝试为此使用 git-svn，因为它有望使合并变得不那么微妙。我们不一定要合并资产，因为它们是有组织的，所以安装程序可以跳过不合适的目录树，但配置并不是那么简单。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T16:31:17.833

我想这取决于有多少事情需要改变。对于配置文件，我喜欢将单个文件置于源代码控制之下，并使用构建脚本来设置特定于环境（或者在您的情况下是特定于客户端）的项目。

[http://automaticchainsaw.blogspot.com/2008/02/automate-config-changes-for-different.html](http://automaticchainsaw.blogspot.com/2008/02/automate-config-changes-for-different.html)

对于二进制文件，它可能更多地与你有多少以及它们来自哪里有关。如果它们是代码编译的一部分，那么理想的编译过程将创建您需要的内容。如果它们是其他资源，例如图形，那么您可能在一个目录下有一组特定于客户的文件夹。构建脚本将根据传递给脚本的参数拉入正确的客户端文件夹。这基本上是您在问题中提到的分支和合并想法。

关于您稍后关于多行配置更改的评论 - 假设它是 xml，您可能会查看 MSBuild 社区任务中的 XmlMassUpdate 类。我自己没有使用过它，但看起来它可能是您需要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T17:30:59.350

您没有提及哪种语言，但您可能会考虑进行[条件编译](http://msdn.microsoft.com/en-us/library/x435tkbk(VS.80).aspx)：

```
#If FirstCustomer Then
   ' <code specific to the FirstCustomer version>.
#ElseIf SecondCustomer Then
   ' <code specific to the SecondCustomer version>.
#Else
        ' <code specific to other versions>.
#End If 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-10T11:21:49.387

这可能发生在不同的客户、环境（QA、Staging、Production...）、地区（US、EU、Asia...）或不同的应用程序类型（如果您必须在为移动客户端提供服务时配置服务器）而不是网络或桌面）。

通常，人们要么手动维护配置文件（如您所述），这容易出错且不安全。或者使用 Pedro 提到的构建脚本在配置文件中“偷看”和“戳”出正确的值。这种方法还意味着对于影响配置的每个代码更改，脚本也应该更改，这是不理想的。调试和测试这些脚本（无论它们使用什么语言）通常很困难，如果不是不可能的话。

面对您的确切问题，我们开发了一种解决方案，该解决方案基于中央配置服务器，为客户端提供配置服务。服务器支持值的继承、更改的审核和版本控制、模板化，甚至实时推送到客户端的运行时更改。

我们非常接近将这项服务作为云托管配置管理解决方案发布。如果您想尝试一下，请在[http://woot.configchief.com注册测试版](http://woot.configchief.com)

# .net - XML 注释中的 filterpriority 标记有什么作用？

> ID：281355
> 
> 赞同：29
> 
> 时间：2008-11-11T16:19:06.580
> 
> 标签：.net, xml-comments

我在 .NET Framework BCL 中的许多类的 XML 注释中看到了这一点，但从未找到解释其作用的文档。

例如，查看 System.Object 会发现以下注释：

```
namespace System   
{
    /// <summary>Supports all classes in the .NET Framework class hierarchy 
    /// and provides low-level services to derived classes. This is the 
    /// ultimate base class of all classes in the .NET Framework; it is the
    /// root of the type hierarchy.</summary>
    /// <filterpriority>1</filterpriority> 
    [System.Runtime.InteropServices.ClassInterfaceAttribute(2)]
    public class Object    
    {    
        /// <summary>Determines whether the specified 
        /// <see cref="T:System.Object" /> 
        /// instances are considered equal.</summary>  
        /// <returns>true if objA is the same instance as objB or
        /// if both are null
        /// references or if objA.Equals(objB) returns true; 
        /// otherwise, false.</returns>
        /// <param name="objB">The second <see cref="T:System.Object" /> 
        /// to compare. </param>
        /// <param name="objA">The first <see cref="T:System.Object" /> 
        /// to compare. </param>
        /// <filterpriority>2</filterpriority>
        public static bool Equals(object objA, object objB);
     }
 } 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-11T16:47:37.037

只是一个猜测：智能感知中的 All vs Common 选项卡？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-03T12:53:50.130

这与使用 EditorBrowsableAttribute 装饰您的成员相同。我猜值 0,1 和 2 对应于 Always、Advanced 和 Never。

# asp.net - ASP.NET 树视图和 XML 数组

> ID：281359
> 
> 赞同：1
> 
> 时间：2008-11-11T16:20:06.157
> 
> 标签：asp.net, xml, treeview

我将 TreeView 绑定到 XMLDataSource，数据绑定是自动生成的，XML 看起来像这样：-

```
<Passengers>
  <Passenger>
    <PassengerName>Name1</PassengerName>
  </Passenger>
  <Passenger>
    <PassengerName>Name2</PassengerName>
  </Passenger>
  <Passenger>
    <PassengerName>Name3</PassengerName>
  </Passenger>
</Passengers> 
```

TreeView 正确显示 XML，但是当我单击一个节点并触发 SelectedNodeChanged 事件时，无论我单击哪个乘客节点，SelectedNode.DataPath 始终是列表中第一个乘客的路径。

有谁知道如何获取我点击的实际节点的数据路径？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-26T16:30:44.307

我相信树节点使用一个值，必须提供该值才能导航值路径路径。只有这样，您才能导航。另外，不确定，但我认为 XmlDataSource 喜欢使用属性而不是子元素来描述和实体值，所以这也可能是一个问题......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T16:47:52.120

从这里我认为它无法区分乘客节点。他们有点缺乏某种身份。现在我会回来查看有关树视图数据绑定的帮助。

很好的帮助说您可以调整从 xmldatasource 绑定到哪些节点属性的方式和内容。可能是您错过了绑定中的 value 和 navigateurl 属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-01-22T16:13:49.187

可能您需要使用 ID 标识每个节点

```
<Passengers>
  <Passenger Id="Passenger1">
    <PassengerName>Name1</PassengerName>
  </Passenger>
  <Passenger Id="Passenger2">
    <PassengerName>Name2</PassengerName>
  </Passenger>
  <Passenger Id="Passenger3">
    <PassengerName>Name3</PassengerName>
  </Passenger>
</Passengers> 
```

# .net - 自动将数据库字段拉入 .NET 控件的类

> ID：281362
> 
> 赞同：0
> 
> 时间：2008-11-11T16:21:10.100
> 
> 标签：.net, controls

我正在构建一个自动加载数据库记录的类，查看每个数据库列名，并填充关联的文本框/标签/文字/等，如果它具有相同的名称。我从 Rails 得到这个想法，以防有助于澄清我正在尝试做的事情。

```
public string presentData(Page thisForm)
{
// .. for each column name
// ... thisForm.FindControl() happens
} 
```

我似乎无法以这种方式找到我想要的控件，而且很可能有更好的方法来做到这一点。

编辑：如果我可以通过另一种方式节省性能，请绝对建议。我的表单很大，递归 FindControl 会导致性能时间增加。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T16:25:19.577

FindControl 不是递归的，因此它只查找顶级控件，而不是嵌套在其他控件中的控件。有关FindControl 的递归版本的示例，请参阅[本文。](https://blog.codinghorror.com/recursive-pagefindcontrol/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T17:09:14.107

我的建议是使用绑定到 DataSet 的 BindingSource，而不是递归地查找每个控件并设置其值。

[http://msdn.microsoft.com/en-us/baya8sx4.aspx](http://msdn.microsoft.com/en-us/baya8sx4.aspx)

[http://msdn.microsoft.com/en-us/library/801dxw2t.aspx](http://msdn.microsoft.com/en-us/library/801dxw2t.aspx)

[http://www.codeproject.com/KB/grid/BindSourceBindingNavCS.aspx](http://www.codeproject.com/KB/grid/BindSourceBindingNavCS.aspx)

[http://msdn.microsoft.com/en-us/library/fbk67b6z(VS.80).aspx?ppud=4](http://msdn.microsoft.com/en-us/library/fbk67b6z(VS.80).aspx?ppud=4)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T16:45:34.013

您是否考虑过填充您的控件客户端？JQuery 可能是一个很好的起点。您将生成 Javascript/JQuery 以在服务器上进行填充，然后 JQuery 负责搜索控件。非常有效率。

# cvs - 添加到 CVSNT 后更改文件类型

> ID：281363
> 
> 赞同：2
> 
> 时间：2008-11-11T16:21:29.147
> 
> 标签：cvs

我使用 WinCVS 作为客户端和 CVSNT 作为我的源代码控制服务器。我想添加到我的 CVS 存储库中的一些文件被添加为 Unicode 文件。现在，我想重新提交与 ANSI（又名 ASCII）文件相同的内容。但是，尽管从存储库中删除了旧文件，但每次我添加同名文件时，它都会自动为文件分配 Unicode 编码。

有出路吗？或者换句话说，一旦将文件添加到 CVS，我可以更改文件的编码吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T01:31:43.670

有几件事（可能）在这里发挥作用：

*   您可以在 WinCvs 本身中禁用自动文件类型检测：转到 Admin|Preferences|Globals，名为“添加文件时提供控制”的选项 - 理论上，您应该能够在完成此操作后使用工具栏中的常规 Add 命令

*   [确保您的cvswrappers](http://www.cvsnt.org/manual/html/Wrappers.html) （客户端和服务器端）中没有任何条目来定义您添加为 unicode 的文件类型

*   最新版本的 WinCvs 捆绑了一个宏，用于在 WinCvs UI 未涵盖的情况下添加具有特定 k 模式的文件（查找 Macros|Add|Extended Add Selection... - 您可能应该明确强制它使用“文本”（又名 -kt）以确保服务器也不执行文件类型自动检测

*   CVSNT 支持文件类型更改的版本控制。在您的情况下，此命令序列`cvs update -kt`后跟`cvs commit -f`

*   最新版本的 WinCvs 还捆绑了一个用于执行后者的宏，它位于 Macros|CVS|Change File Options

[我是这里引用的两个宏的作者，所以如果他们给您带来任何麻烦，请随时与我联系 - 您可以在宏本身中找到我的联系信息]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T18:44:55.457

首先，我推荐使用[TortoiseCVS](http://www.tortoisecvs.org/)，因为它有更好的`CVSNT`支持。`CVS`和whie`CVSNT`很相似***，***`CVSNT`不是。TortoiseCVS对话框将显示它猜测的文件类型，您可以在那里覆盖文件类型。 *`CVS``Add`*

 *对于现有的情况，假设您不想保留 Unicode 文件的历史记录，您可以尝试以下方法。

好的，首先是警告：

您不应手动编辑 CVS 存储库（除非您真的很绝望）

现在请您自行承担违反上述规则的说明。

1.  备份您的 CVSNT 存储库目录（简单的 ZIP 文件即可）
2.  在客户端上，确保 Unicode 文件实际上已在本地和存储库中删除。
3.  在 CVSNT 存储库目录中：
    3.  找到您最初添加文件的模块目录
    4.  找到`Attic`目录
    5.  删除文件及其任何`,v`扩展名。
4.  在客户端：
    7.  验证文件是否具有 ANSI 编码（纯文本文件）
    8.  `cvs add`再次文件

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-08-31T21:36:11.233

这里的建议都没有帮助我，但这有效

1.  备份文件
2.  在 cvsnt 中删除文件并提交
3.  恢复文件
4.  在 cvsnt 中从命令行“add -kt -- myfile.html”添加文件
5.  提交添加的文件

注意：文件类型由 -k 开关指定，后跟文件类型

# c++ - myVector.erase(myPtr) 会删除 myPtr 指向的对象吗？

> ID：281365
> 
> 赞同：7
> 
> 时间：2008-11-11T16:22:03.843
> 
> 标签：c++, vector, stl

如果我有以下代码，

```
Foo *f = new Foo();
vector<Foo*> vect;
vect.push_back(f);
// do stuff
vect.erase(f); 
```

我是否造成了内存泄漏？我猜是这样，但*擦除*这个词给人的感觉是它正在删除它。

写到这里，我想知道将指针放在 STL 向量中是否是一个错误。你怎么看？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T16:27:44.813

是的，您由此造成了内存泄漏。std::vector 和其他容器只会删除指针，它们不会释放指针指向的内存。

将指针放入标准库容器中并不罕见。但是，问题是您必须在将其从容器中删除时跟踪删除它。一种更好但更简单的方法是使用 boost::shared_ptr：

```
{ 
    boost::shared_ptr<foo> f(new foo);

    std::vector< boost::shared_ptr<foo> > v;
    v.push_back(f);
    v.erase(v.begin());
} /* if the last copy of foo goes out of scope, the memory is automatically freed */ 
```

下一个 C++ 标准（通常称为 C++1x 和 C++0x）将包括`std::shared_ptr`. 在那里，您还可以使用`std::unique_ptr<T>`更快的，因为它不允许复制。在 c++0x 中使用`std::unique_ptr`容器类似于`ptr_container`boost 中的库。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T16:35:08.043

另一种选择是使用 Boost [Pointer Containers](http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/ptr_container.html)。它们旨在完全按照您的意愿行事。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T16:37:32.203

或者有 boost::ptr_vector[容器](http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/ptr_container.html)。

它知道它持有它拥有的指针，因此会自动删除它们。

作为一个很好的副作用，当访问元素时，它返回对对象的引用而不是指针，以使代码看起来不错。

```
Foo *f = new Foo();
boost::ptr_vector<Foo>  vect;
vect.push_back(f);
// do stuff
vect.erase(f); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-12T10:04:23.823

为了澄清为什么不删除指针，请考虑

```
std::vector<char const*> strings;
strings.push_back("hello");
strings.push_back("world");
// .erase should not call delete, pointers are to literals

std::vector<int*> arrays;
strings.push_back(new int[10]);
strings.push_back(new int[20]);
// .erase should call delete[] instead of delete

std::vector<unsigned char*> raw;
strings.push_back(malloc(1000));
strings.push_back(malloc(2000));
// .erase should call free() instead of delete 
```

一般来说，`vector<T*>::erase`无法猜测您将如何处理`T*`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T16:34:14.787

将指针指向标准容器绝对不是错误（但是，创建 auto_ptr 的容器是错误的）。是的，您确实需要显式删除以释放各个元素指向的内存，或者您可以使用 boost [smart pointers](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/smart_ptr.htm)之一。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T17:18:40.983

vector 删除它包含的数据。由于您的向量包含指针，它只删除指针，而不是它们可能指向或可能不指向的数据。

在 C++ 中，内存在分配的地方释放是一个非常普遍的规则。向量没有分配你的指针指向的任何东西，所以它不能释放它。

您可能首先不应该将指针存储在向量中。在许多情况下，您最好使用以下方法：

```
vector<Foo> vect;
vect.push_back(Foo());
// do stuff
vect.erase(f); 
```

当然这假设 Foo 是可复制的，并且它的复制构造函数不是太昂贵，但是它避免了内存泄漏，并且您不必记住删除 Foo 对象。另一种方法是使用智能指针（例如 Boost 的 shared_ptr），但您可能根本不需要指针语义，在这种情况下，简单的解决方案是最好的解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T19:40:49.400

STL 容器不会释放您的内存。最好的建议是使用智能指针，因为它知道 std::auto_ptr 不适合容器。我会推荐 boost::shared_ptr，或者如果您的编译器供应商支持 TR1 扩展（很多都支持），您可以使用 std::tr1::shared_ptr。

另请注意，向量甚至不会释放为指针保留的内部存储器。即使调用 clear()，std::vectors 也不会缩小大小。如果您需要缩小矢量，您将不得不求助于创建另一个矢量并交换内容。

# .net - 编辑 WMA 标签的最佳 .Net 库？

> ID：281369
> 
> 赞同：3
> 
> 时间：2008-11-11T16:24:19.843
> 
> 标签：.net, id3, wma

我找到了一些库来编辑 MP3 标签（UltraID3Lib 很棒），但没有一个库可以编辑 WMA 文件的标签。

任何人都可以推荐一个用于编辑 WMA 标签/元数据的 .net 库吗？

谢谢马特

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T17:56:32.187

TagLib# [http://www.taglibsharp.com](http://www.taglibsharp.com)

嗬！我怎么会错过这个？

# macos - 从 OS X Dock 执行 Shell 脚本？

> ID：281372
> 
> 赞同：176
> 
> 时间：2008-11-11T16:24:50.157
> 
> 标签：macos, shell, dock

如何设置 shell 脚本以从 Mac OSX 扩展坞执行？似乎只需创建一个快捷方式即可在我的编辑器中打开该文件。我需要在某处设置一个标志来告诉它运行而不是打开它进行编辑吗？

* * *

## 回答 #1

> 赞同：207
> 
> 时间：2008-11-11T16:47:04.680

您可以通过一个步骤创建 Automator 工作流程 - “运行 Shell 脚本”

然后`File > Save As`，将文件格式更改为“应用程序”。当您打开应用程序时，它将运行 Shell Script 步骤，执行命令，完成后退出。

这样做的好处是它*非常*简单，您可以非常轻松地获取用户输入（例如，选择一堆文件），然后将其传递给 shell 脚本的输入（传递给标准输入，或作为参数）。

*（Automator 在您的`/Applications`文件夹中！）*

![示例工作流程](https://i.stack.imgur.com/7XEIX.png)

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-11-11T16:28:24.220

如果您不需要终端窗口，您只需创建一个 shell 脚本`Example`并将其移动到 filename即可将任何可执行文件变成应用程序`Example.app/Contents/MacOS/Example`。您可以像任何其他应用程序一样将这个新应用程序放在您的 Dock 中，然后单击执行它。

**注意：**应用程序的名称必须与脚本名称完全匹配。所以顶级目录必须是，子目录`Example.app`中的脚本`Contents/MacOS`必须是命名`Example`的，并且脚本必须是可执行的。

如果您确实需要显示终端窗口，我没有简单的解决方案。你可能可以用 Applescript 做点什么，但这不是很干净。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2014-01-10T15:50:11.507

在 OSX Mavericks 上：

1.  创建你的 shell 脚本。
2.  使您的 shell 脚本可执行：

    ```
    chmod +x your-shell-script.sh 
    ```

3.  重命名您的脚本以具有`.app`后缀：

    ```
    mv your-shell-script.sh your-shell-script.app 
    ```

4.  将脚本拖到 OSX 扩展坞。
5.  将脚本重命名为`.sh`后缀：

    ```
    mv your-shell-script.app your-shell-script.sh 
    ```

6.  右键单击 Finder 中的文件，然后单击“获取信息”选项。
7.  在窗口底部，将 shell 脚本设置为使用终端打开。

现在，当您单击 Dock 中的脚本时，将弹出一个终端窗口并执行您的脚本。

奖励：要在脚本完成后关闭终端，请添加`exit 0`到末尾并将终端设置更改为“如果干净退出则关闭外壳”，就像它在[这个 SO answer](https://stackoverflow.com/questions/8798641/close-terminal-window-from-within-shell-script-unix#8822669)中所说的那样。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2010-05-04T04:34:07.243

我知道这很旧，但如果它对其他人有帮助：

如果您需要运行脚本并希望终端弹出以便您可以看到结果，您可以像深渊骑士所说的那样将扩展名更改为 .command。如果双击它，它将打开一个终端窗口并运行。

但是，我需要从 automator 或 appleScript 运行它。因此，为了打开一个新终端，我从“运行 shell 脚本”运行的命令是“打开 myShellScript.command”，它在一个新终端中打开。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-11T16:42:30.010

只要您的脚本是可执行的并且没有任何扩展名，您就可以将其按原样拖动到 Dock 的右侧（文档侧），单击时它将在终端窗口中运行，而不是打开编辑器。

如果您想要扩展名（如 foo.sh），您可以转到 Finder 中的文件信息窗口并更改该特定脚本的默认应用程序（TextEdit、TextMate、计算机上设置的任何默认值） .sh 文件）到终端。然后它将只执行而不是在文本编辑器中打开。同样，您必须将其拖到 Dock 的右侧。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-21T21:01:23.380

在脚本编辑器中：

`do shell script "/full/path/to/your/script -with 'all desired args'`"

另存为应用程序包。

只要您想要做的就是获得脚本的效果，这将可以正常工作。您不会看到 STDOUT 或 STDERR。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-11T16:27:45.530

我认为这个线程可能会有所帮助：[http ://forums.macosxhints.com/archive/index.php/t-70973.html](http://forums.macosxhints.com/archive/index.php/t-70973.html)

换句话说，您可以使用 .command 扩展名重命名它，或者创建一个 AppleScript 来运行 shell。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-12-23T04:14:45.167

正如 joe 所提到的，创建 shell 脚本，然后创建一个 applescript 脚本来调用 shell 脚本，将完成此操作，并且非常方便。

# 外壳脚本

1.  在您喜欢的文本编辑器中创建您的 shell 脚本，例如：

    `mono "/Volumes/Media/~Users/me/Software/keepass/keepass.exe"`

    （这运行 w32 可执行文件，使用 mono 框架）

2.  保存 shell 脚本，例如“StartKeepass.sh”

# 苹果脚本

1.  打开 AppleScript Editor，并调用 shell 脚本

    `do shell script "sh /Volumes/Media/~Users/me/Software/StartKeepass.sh" user name "<enter username here>" password "<Enter password here>" with administrator privileges`

    *   `do shell script`- 用于调用外部 shell 命令的 applescript 命令
    *   `"sh ...."`- 这是您在第一步中创建的 shell 脚本（完整路径）（您也可以运行直接命令，我可以省略 shell 脚本并在此处运行我的单声道命令）
    *   `user name`- 向 applescript 声明您希望以特定用户身份运行命令
    *   `"<enter username here>`- 替换为您的用户名（保留引号）前“josh”
    *   `password`- 向applescript声明您的密码
    *   `"<enter password here>"`- 替换为您的密码（保留引号），例如“mypass”
    *   `with administrative privileges`- 声明你想以管理员身份运行

# 创建您的 .APP

1.  将您的 applescript 保存为 filename.scpt，在我的情况下为 RunKeepass.scpt

2.  另存为...您的applescript并将文件格式更改为应用程序，在我的情况下导致RunKeepass.app

3.  将您的应用程序文件复制到您的应用程序文件夹

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-27T00:18:02.177

## pip install mac-appify

我在接受解决方案时遇到了麻烦，但这个命令对我有用。

### 安装

```
pip install mac-appify 
```

### 跑

```
/opt/local/Library/Frameworks/Python.framework/Versions/2.7/bin/appify ~/bin/webex_start.sh ~/Desktop/webex.app 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2013-05-14T02:33:41.273

有人写...

> 我只是将所有以“.sh”结尾的文件设置为使用终端打开。它工作正常，您不必更改要运行的每个 shell 脚本的名称。

# sharepoint - Sharepoint：用于查找用户创建/编辑的所有文档的 SQL

> ID：281373
> 
> 赞同：1
> 
> 时间：2008-11-11T16:24:55.240
> 
> 标签：sharepoint, sharepoint-2003

我正在寻找一个可以在 Sharepoint 2003 上运行的查询，以向我显示给定用户 ID 创建/触及的所有文档。

我找到了包含文档（Docs）和用户表（UserInfo、UserData）的表，但它们之间的关系似乎有点奇怪——我们的 userdata 表中有 99,000 条记录，而 userinfo 中有 12,000 条记录——我们有 400 个用户！

我想我期待一个简单的一对多关系与一个有 400 条记录的用户表并将其加入到文档表中，但我认为情况并非如此。

任何帮助，将不胜感激。

编辑：感谢 Bjorn，我已将该查询翻译回 Sharepoint 2003 结构：

```
select 
d.* from 
userinfo u join userdata d 
on u.tp_siteid = d.tp_siteid  
and 
u.tp_id = d.tp_author 
where
u.tp_login = 'userid' 
and
d.tp_iscurrent = 1 
```

这让我得到了一个 siteid/listid/tp_id 的列表，我必须看看我是否可以将它们追溯到文件名/路径。全部：仍然感谢任何额外的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T08:13:29.600

我从未查看过 SharePoint 2003 中的数据库，但在 2007 年，UserInfo 已连接到站点，这意味着每个用户在 UserInfo 中对于每个站点集合（或等效的 2003 概念）都有一行。因此，要确定用户是什么，您需要站点 ID 和该站点内的用户 ID。在 2007 年，我会从这样的事情开始：

```
select d.* from userinfo u 
join alluserdata d on u.tp_siteid = d.tp_siteid 
and u.tp_id = d.tp_author 
where u.tp_login = '[username]'
and d.tp_iscurrentversion = 1 
```

更新：正如其他人在这里写的，不建议直接进入 SharePoint 数据库，但我会说用你的头脑小心。更新是全大写的禁忌，但选择取决于上下文。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T15:36:52.410

如果您打算在 Sharepoint 中使用该查询，您应该知道在内容数据库上创建视图或直接针对数据库进行查询似乎是一个很大的禁忌。一种解决方法可能是一些自定义代码，它遍历对象模型并将结果写入您自己的数据库。这可以基于计时器或基于事件触发器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T15:50:31.587

不要直接查询 SHAREPOINT 数据库！

我想知道我是否说得足够清楚？:)

您确实需要查看 C# 中可用的对象模型，您需要获取 SiteCollection 的 SPSite 实例，然后遍历属于 SPSite 和 SPWeb 对象的 SPList 实例。

获得 SPList 对象后，您将需要使用筛选出所需用户的查询来调用 GetListItems。

这是做你想做的事的受支持的方式。

您永远不应该直接访问数据库，因为 SharePoint 根本不是为此而设计的，并且不能保证（实际上，有一个特定的警告）数据库的结构在版本和升级之间是相同的，另外当内容分布在场中的多个内容数据库中，因此无法保证在一个内容数据库上运行的查询将在另一个内容数据库上执行您期望的操作。

当您查看迭代的对象模型时，还要注意您将需要 dispose() 您创建的 SPSite 和 SPWeb 对象。

哦，是的，您可能有 400 个用户，但我敢打赌您有 30 个站点。该信息在每个站点的数据库中重复... 30 x 400 = 数据库中的 12,000 个条目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-22T17:49:01.737

You really shouldn't be doing SELECTs with Locks either i.e. adding WITH (NOLOCK) to your queries. Some parts of the system are very timeout sensitive and if you start introducing locks that the system wasn't expecting you can see the system freak out.

But really, you should be doing this via the object model. Mess around with something like IronPython and experimentations with the OM are almost downright pleasant.

# jsp - 使用 fmt:formatDate JSP 格式化日期

> ID：281380
> 
> 赞同：33
> 
> 时间：2008-11-11T16:26:18.357
> 
> 标签：jsp, jstl

我正在尝试使用以下方式格式化日期：

```
<fmt:formatDate value="${newsletter.createdOn}" pattern="MM/dd/yyyy"/> 
```

newsletter 是一个`createdOn`属性为 的对象`java.util.Date`。

当我调用上一句时，我得到：

根据 TLD，属性值不接受表达式。

我正在导入 fmt

```
<%@ taglib prefix="fmt" uri="http://java.sun.com/jstl/fmt" %> 
```

有谁知道我该如何解决这个问题？

我正在使用tomcat附带的jstl.jar。

在 jstl.jar/META-INF/MANIFEST.MF 下保持：

```
Manifest-Version: 1.0
Ant-Version: Apache Ant 1.5.3 
Created-By: 1.4.2-b28 (Sun Microsystems Inc.)
Specification-Title: JavaServer Pages Standard Tag Library (JSTL)
Specification-Version: 1.1
Implementation-Title: JavaServer Pages Standard Tag Library API Refere
 nce Implementation
Implementation-Version: 1.1.0-D13
Implementation-Vendor: Sun Microsystems, Inc.
Implementation-Vendor-Id: com.sun
Extension-Name: javax.servlet.jsp.jstl 
```

我正在使用 Apache Tomcat 版本 6.0.14

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-11-11T16:37:13.733

尝试

```
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T17:27:02.697

[这家伙](http://forums.java.net/jive/message.jspa?messageID=209779)似乎通过从 jar 中提取 TLD，修改它，将它放在 WAR 的 WEB-INF 目录中，然后`web.xml`像这样添加一个条目来解决这个问题：

```
<jsp-config>
 <taglib>
  <taglib-uri>http://java.sun.com/jstl/fmt</taglib-uri>
  <taglib-location>/WEB-INF/fmt.tld</taglib-location>
 </taglib>
</jsp-config> 
```

最后，他切换到 1.1 声明：

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"/> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-03T07:14:08.027

我遇到了同样的问题。

我将 <%@ taglib prefix="fmt" uri="http://java.sun.com/jstl/ **fmt** " %> 更改为 <%@ taglib prefix="fmt" uri="http://java.sun .com/jstl/ **fmt_rt** " %> 它对我有用！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T17:23:13.157

显然，我需要 1.1，但我必须更改 c 和 fmt 的库导入语句。
现在它起作用了。感谢您的帮助，并为造成的混乱感到抱歉。

```
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T16:33:22.040

你确定你没有使用标签库的运行时版本吗？我们可以看看库导入语句吗？

根据 JavaRanch 上的这个[常见问题解答](http://faq.javaranch.com/java/JstlTagLibDefinitions)，我认为[lucus](https://stackoverflow.com/questions/281380/format-date-with-fmtformatdate-jsp#281422)正在做一些事情，这是一个 JSTL 1.0 声明。您可能想要更新到 1.1。

您的环境、应用服务器和版本是什么？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T16:39:24.527

您使用的是 JSTL 1.0 还是 1.1？1.1 中的 formatDate 应该接受表达式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-23T08:44:29.963

它只是通过将“_rt”添加到 taglib url 来为我工作，如下所示：

```
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt_rt" %> 
```

我在[这篇文章中找到了](http://www.ibm.com/developerworks/java/library/j-jstl0211.html)

玩得开心！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T16:38:28.803

您使用的是`fmt-1_0-rt.tld`还是`fmt-1_0.tld`taglib。

不同之处在于设置`rtexprvalue`

一方面，这是错误的，另一方面，这是真的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-07-03T11:37:02.497

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix='fmt'%> 
```

正在为我工​​作。

# asp.net - 在 ASP.Net Postback 之后维护 JavaScript 代码。

> ID：281383
> 
> 赞同：3
> 
> 时间：2008-11-11T16:27:12.927
> 
> 标签：asp.net, javascript, jquery, postback

正如标题所示，我无法在回发时维护我的代码。我在 Head 部分有一堆 jQuery 代码，它工作正常，直到发生回发，之后它停止运行！

我怎样才能解决这个问题？回发时不会读取头部，有没有办法可以强制这种情况发生？

JavaScript 是：

```
 <script type="text/javascript">
        $(document).ready(function()
        {
            $('.tablesorter tbody tr').tablesorter();

        $('.tablesearch tbody tr').quicksearch({
            position: 'before',
            attached: 'table.tablesearch',
            stripeRowClass: ['odd', 'even'],
            labelText: 'Search:',
            delay: 100
        });
       }); 
        </script> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T16:36:40.647

如果您只是将该代码硬编码到页面的头部，那么回发不会影响它。我会通过调试检查以下内容（FireFox 中的 FireBug 是一个很好的调试器）：

*   验证脚本是否仍在回发的头部。
*   验证 css 类实际上是否附加到页面中的某个元素。
*   在浏览器完成回发加载后验证 jquery 代码是否正在执行。

编辑：您是否使用 UpdatePanels 进行回帖？换句话说，这是异步回发还是正常的整页刷新？

编辑编辑：啊……好吧。因此，如果您使用的是 UpdatePanels，那么文档的就绪状态已经处于就绪状态，因此这部分 jquery 代码将不会再次被触发。我会将 jquery 委托提取到一个单独的函数中，您也可以在异步回发之后调用该函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-22T22:18:02.143

把你的代码放进去

```
function pageLoad(sender, args) {

    /* code here */

} 
```

而不是在`$(document).ready(function() { ... });`

`pageLoad()`是一个将在所有同步和异步回发之后执行的函数。有关更多详细信息，请参阅此答案

*   [**如何在更新面板回发后执行 javascript 回调**](https://stackoverflow.com/questions/1152946/how-to-have-a-javascript-callback-executed-after-an-update-panel-postback/1153002#1153002)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T16:44:51.113

我猜回发会抢占页面的 onLoad 事件，jQuery 需要挂钩才能使用它的 .ready()。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T16:51:14.050

1.  回发后的 HTML 代码中是否存在脚本？
2.  如果是这样，代码会被执行吗？通过注释掉您的代码并临时添加来测试`alert('test');`
3.  如果是这样，回发后页面上的代码引用的元素是否可用？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-22T22:07:11.583

与其使用 $(document).ready，不如将代码放在一个名为 pageLoad() 的函数中。pageLoad() 函数按照惯例连接起来，以便在页面有回发/异步回发时调用。

# iphone - 知道堆栈中我上方的 UIViewController 何时弹出的最佳方法是什么？

> ID：281390
> 
> 赞同：2
> 
> 时间：2008-11-11T16:28:54.267
> 
> 标签：iphone, cocoa-touch

我有一个`UIViewController`管理一些数据的显示。当用户想要编辑此数据时，我将编辑推`UIViewController`送到堆栈中。当用户完成编辑时，顶视图控制器从堆栈中弹出。在弹出编辑视图后知道我需要更新显示的最优雅的方法是什么？

我认为我可以将内容更新代码放入`viewDidLoad`我的数据视图的方法中，但是当我的视图显示时并不总是调用此方法，尤其是在我向下导航视图堆栈时。

我还考虑将我的数据视图控制器设置为委托`UINavigationController`并等待`– navigationController:didShowViewController:animated:`被调用，我担心可能还有其他视图控制器需要在显示时得到通知，这将变成一个小麻烦管理哪个控制器应该接收`didShowViewController`消息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T17:26:28.080

我认为 viewWillAppear 可以解决问题。

否则，您的编辑视图控制器可能会调用一个新的委托方法，指向您的父控制器。在那里，您可以更新数据模型和显示。例如：

```
- (BOOL)textFieldShouldReturn:(UITextField *)textField {
    if ([delegate respondsToSelector:@selector(editEntryByTitle:)])
        [delegate performSelector:@selector(editEntryByTitle:) withObject: textField.text];
    [textField resignFirstResponder];
    [self dismissModalViewControllerAnimated:YES];
    return YES;
} 
```

# sql-server - Master 数据库中的 SQL 过程如何帮助数据库开发人员？

> ID：281397
> 
> 赞同：4
> 
> 时间：2008-11-11T16:30:53.980
> 
> 标签：sql-server

SQL Server 的主数据库中有很多程序和函数，为数据库开发人员提供了方便的工具。例如，`sp_help [database object]`将提供几个具有指定对象有用属性的结果集； `sp_helptext [procedure or function name]`将在结果窗格中返回过程或函数的主体（与您查看对象资源管理器并使用“Script as...”打开对象只是为了查看其代码内容相反）。其他真正方便的过程包括`sp_depends`和`sp_msdependencies`，其中第一个列出了如果您丢弃指定对象将停止工作的所有对象，而后者列出了如果指定对象要继续正常工作则不得丢弃的所有对象。

我今天从一位同事那里了解到所有这些，我很震惊我没有早点知道这些。

有没有人知道任何其他方便的小功能或程序可以帮助开发人员解决不熟悉（通常是错误）数据库的难题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T17:23:35.700

sp_who2 很有用 - 特别是如果您将结果转储到临时表然后只提取阻塞信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T16:33:11.497

它们都在 MS 站点上：[系统存储过程 (Transact-SQL)](http://msdn.microsoft.com/en-us/library/ms187961.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T18:16:41.443

看看这篇文章：[SQL Server 的隐藏特性](https://stackoverflow.com/questions/121243/hidden-features-of-sql-server)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T16:38:02.033

我想到的两个

锁：[sp_lock2](http://support.microsoft.com/kb/q255596/)

孤儿：[sp_change_users_login](http://technet.microsoft.com/en-us/library/ms174378(SQL.90).aspx)

# php - 加权平均数

> ID：281398
> 
> 赞同：1
> 
> 时间：2008-11-11T16:31:13.030
> 
> 标签：php, mysql, statistics

我有一个现有的网络应用程序，允许用户根据难度对项目进行“评分”。（0 到 15）。目前，我只是取每个用户意见的平均值，并直接从 MySQL 中呈现平均值。但是，我（和我的用户）越来越清楚，对数字进行加权会更合适。

奇怪的是，几个小时的谷歌搜索并没有出现太多。我确实找到了两篇文章，它们显示了基于“贝叶斯过滤器”（我部分理解）的站点范围的评级系统。 [这](http://v3.siteframe.org/document.php?id=595)是一个例子：

> 公式为：
> 
> WR=(V/(V+M)) * R + (M/(V+M)) * C
> 
> 在哪里：
> 
> ```
> * WR=Weighted Rating (The new rating)
> * R=Average Rating (arithmetic mean) so far
> * V=Number of ratings given
> * M=Minimum number of ratings needed
> * C=Arithmetic mean rating across the whole site 
> ```

我喜欢这里的想法，即根据每个项目的总票数来增加权重……但是，因为我网站上的难度级别可能因项目而异，取“C”（算术平均评分）网站）无效。

所以，重述我的问题：

使用 MySQL、PHP 或两者兼而有之，我尝试从算术平均值中获取：

```
(5 + 5 + 4)/3 = 4.67 (rounded) 
```

...加权平均：

```
rating  / weight
5 / 2 (since it was given 2 times)
5 / 2
4 / 1

(sum[(rate * weight)])/(sum of weights)
(5 * 2) + (5 * 2) + (4 * 1) / (2 + 2 + 1)
(24)/(5)
= 4.8 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T16:41:11.060

这是一个关于如何直接在 MySQL 中执行此操作的简单示例。您当然需要在子查询上添加一个条件，以仅获得相关项目的投票而不是所有投票。

```
mysql> 创建表投票（投票 int）；
查询正常，0 行受影响（0.01 秒）

mysql> 插入投票值 (5),(5),(4);
查询正常，3 行受影响（0.00 秒）
记录：3 重复：0 警告：0

mysql> 从投票中选择 *；
+------+
| 投票 |
+------+
| 5 |
| 5 |
| 4 |
+------+
3 行一组（0.00 秒）

mysql> select vote,count(vote),vote*count(vote) from votes group by vote；
+------+-------------+------------------+
| 投票 | 计数（投票）| 投票*计数（投票） |
+------+-------------+------------------+
| 4 | 1 | 4 |
| 5 | 4 | 20 |
+------+-------------+------------------+
2 行（0.00 秒）

mysql> 选择 sum(vt)/sum(cnt) FROM (选择
count(vote)*count(vote) as cnt,vote*count(vote)*count(vote)
作为 vt 从投票组投票）a；
+------------------+
| 总和（vt）/总和（cnt） |
+------------------+
| 4.8000 |
+------------------+
一组中的 1 行（0.00 秒）

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T17:07:57.400

是什么清楚地表明加权会更合适？您在算术平均值中看到什么对您没有帮助？我很好奇，因为您正在寻找的答案似乎不一定能最好地满足您的需求。（此外，16 分制的量表通常比大多数人需要的量表大得多；人们很少区分这么多分，并且倾向于将他们的回答集中在一组选定的答案上。）

您链接到的概念将平均值拉向站点的平均值；你的意思只是把自己拉向最常见的反应。通常，如果您使用平均值并希望对回复进行加权，您会根据受访者的一些情况来这样做（更多地关注更多知识渊博的人、更频繁访问该网站的人或其他类似情况的回复）。

您也可以考虑使用除平均分数之外的计算，也许是 top-N-box 百分比（给出前 N 个难度等级的受访者的百分比）。

否则，平均值的公式是 sum(response * count * count) / sum(count * count) ...

```
select sum(response*ct*ct)/sum(ct*ct) from
( select response, count(response) as ct from your_table group by response) data 
```

抱歉，如果语法不准确，我没有使用 MySQL。

请注意，您可能必须将总和从整数转换为浮点数；不确定这在 MySQL 中是如何工作的。在 SQL Server 中，您必须转换总和之一，以便它了解您不需要积分平均值。

# c# - 如何在代码中重新排序 ToolStrip 项目

> ID：281403
> 
> 赞同：6
> 
> 时间：2008-11-11T16:31:58.720
> 
> 标签：c#

您如何以编程方式在 C# 中对 ToolStrip 上的项目进行重新排序。

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T16:52:14.327

通过使用 Items 集合的 Insert() 方法并指定我想要该项目的索引，我找到了解决此问题的方法。

IE

```
toolStrip1.Items.Insert(0, myButton); 
```

# design-patterns - 进度状态报告模式

> ID：281408
> 
> 赞同：4
> 
> 时间：2008-11-11T16:33:36.127
> 
> 标签：design-patterns, progress-bar

我正在实现需要显示进程栏或进度百分比的长时间运行的进程。长时间运行过程的整体逻辑很复杂（各种分页数据检索），因此，我最终在代码中的不同位置硬编码了大量百分比。

在更新完成百分比时，什么被认为是最佳设计模式？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T21:46:16.667

我发现 JFace 中围绕[IProgressMonitor](http://help.eclipse.org/indigo/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/core/runtime/IProgressMonitor.html)使用的模式效果很好。通过查看课程，您可能会获得一些见解。要查看的其他类是[ProgressMonitorDialog](http://help.eclipse.org/indigo/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/jface/dialogs/ProgressMonitorDialog.html)和[IRunnableWithProgress](http://help.eclipse.org/indigo/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/jface/operation/IRunnableWithProgress.html)。您可能还会发现[这篇文章](http://www.eclipse.org/articles/Article-Progress-Monitors/article.html)对您有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T16:55:04.430

如果您事先知道您将要执行的任务的“长度”，并且有办法知道您的进度，您应该让条形图确定百分比。例如，如果您必须处理已知数量的文件，请将此数字提供给构建进度条。然后，在此过程中，条形图可以轮询该过程，或者该过程可以告诉条形图它有多远（以文件数计）。条形图可以根据这两个值计算百分比。这就是[Java 中标准进度条的](http://java.sun.com/docs/books/tutorial/uiswing/components/progress.html)工作方式。

# .net - 在 DataGridView 中排序的 WaitCursor

> ID：281418
> 
> 赞同：3
> 
> 时间：2008-11-11T16:36:12.300
> 
> 标签：.net, sorting, datagridview, .net-2.0

我在列上使用具有自动排序模式的标准 .Net 2.0 DataGridView。它非常慢（这可能应该是关于如何加快速度的另一个问题），但我似乎找不到在执行此排序操作时将保持 WaitCursor 的事件或事件组合。

想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T16:43:05.437

钩住“MouseDown”事件，检查用户点击的“HitTest”方法。如果用户单击列标题设置“Cursor.Current = Cursors.Wait”并将某些标志“isSorting”设置为 true。

挂钩“MouseUp”事件，检查“isSorting”标志是否为真，然后设置“Cursor.Current = Cursors.Default”。

**编辑：** 使用“Sorted”事件而不是“MouseUp”。“MouseUp”是功能性的，但“Sorted”是“更清洁”的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-04-24T14:41:13.050

Anno 2021，最好的死灵术 :) 我仍在寻找一种正确执行此操作的方法。

**我试过的和没用的**

`CellMouseDown`当用户开始拖动（重新排序列标题）时，也会触发该事件。所以这是一个妥协。

事件在事件`CellMouseClick`之后触发`Sorted`。由于在排序操作期间线程被占用并且没有真正的`SortStart`事件，我开始认为这是不可能的。

**我最终做了什么**

如果您使用 a`DataTable`作为 gridview 的数据源，则必须禁用每列的自动排序。

```
foreach (DataGridViewColumn column in dgvUsers.Columns)
{
    column.SortMode = DataGridViewColumnSortMode.Programmatic;
} 
```

`CellMouseDown`我最终使用事件、`CellMouseUp`事件和两个变量`mouseDownColumnIndex`并`sortExpression`作为先前排序操作的句柄，您也许可以做到这一点。

```
 string mouseDownColumnName = "";
    string sortExpression = "";
    private void dgvUsers_CellMouseDown(object sender, DataGridViewCellMouseEventArgs e)
    {
        mouseDownColumnName = dgvUsers.Columns[e.ColumnIndex].HeaderText;
    }

    private void dgvUsers_CellMouseUp(object sender, DataGridViewCellMouseEventArgs e)
    {
        if (e.Button == MouseButtons.Left // Obviously
            && e.RowIndex == -1 // column header row index
            && mouseDownColumnName == dgvUsers.Columns[e.ColumnIndex].HeaderText // No drag gesture
        ) {
            dgvUsers.Cursor = Cursors.WaitCursor;
            Task<DataTable> sortAction = Task<DataTable>.Factory.StartNew(() =>
            {
                DataView dvUsers = ((DataTable)dgvUsers.DataSource).DefaultView;
                string headerText = dgvUsers.Columns[e.ColumnIndex].HeaderText;
                if (sortExpression == $"{headerText} asc")
                    dvUsers.Sort = $"{headerText} desc";
                else
                    dvUsers.Sort = $"{headerText} asc";
                sortExpression = dvUsers.Sort;
                return dvUsers.ToTable();
            });
            sortAction.Wait();
            dgvUsers.DataSource = sortAction.Result;

            dgvUsers.Cursor = Cursors.Default;
        }
    } 
```

这似乎比默认的“自动”排序更快。

# reporting-services - 部署报表后不显示 Reporting Services 图像

> ID：281436
> 
> 赞同：3
> 
> 时间：2008-11-11T16:41:40.433
> 
> 标签：reporting-services

我有一份 SSRS 2005 报告，其中包含许多图像。我包含图像的方式是我有一个图像对象，其 URL 在 value 属性中设置。实际图像由同一服务器上的 IIS 虚拟目录托管。我这样做是因为我需要根据报表中的数据使用表达式动态更改图像源。

问题是图像在 Visual Studio 中预览报表时效果很好，但在部署报表时不显示。当我查看 SSRS 呈现的 HTML 时，图像标签的 SRC 属性是一个空字符串。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T18:40:11.833

我以前遇到过这个问题。

您应该检查在部署报告时是否有任何警告被抛出。rsWarningFetchingExternalImages 警告意味着报告服务在匿名访问图像时遇到问题。这可能是因为在 IIS 中未正确配置匿名访问，或者在我的情况下，您托管的图像的 MIME 类型可能存在问题。我试图托管 PNG 文件，当我将图像更改为 GIF 时它起作用了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-22T17:43:28.283

在该图像文件夹的 IIS 中设置启用匿名身份验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T15:26:34.670

我绝不是 IIS 专家，这就是为什么我放弃转为 GIF 文件的原因，但从我放弃之前所做的研究来看，我可以告诉你，并非所有版本的 IIS 默认都支持 PNG MIME 类型. 我已尝试按照[http://www.hostmysite.com/support/dedicated/IIS/newmime/](http://www.hostmysite.com/support/dedicated/IIS/newmime/)上的说明将 PNG MIME 类型添加到我的虚拟目录中，但它对我不起作用。（请记住在尝试此操作后重新部署，因为我认为这是 RS 协调图像 URL 的时候）也许对 MIME 类型有更多了解的人是 I​​IS 可能有一些输入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-25T08:54:46.930

当尚未应用 Service Pack（2 或 3）时，我在 SSRS2005 上看到了这个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-08T19:34:17.467

我有同样的问题，我只是发现这是文件夹的授权问题。我必须在 web.config 文件中添加规则以允许所有用户访问图像

// 假设 Images 是要检索图像的文件夹

```
< location path="Images" >
    < system.web >
      < authorization >
        < allow users="*" / >
       < /authorization >
    < /system.web >
  < /location > 
```

参考： http: [//msdn.microsoft.com/en-us/library/wce3kxhd (v=vs.100).aspx](http://msdn.microsoft.com/en-us/library/wce3kxhd(v=vs.100).aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-09T13:52:03.687

托管图像的文件夹需要对所有人都具有权限。此外，如果您在 Share Point 中部署报表，则需要将以下内容添加`web.config`到该文件夹​​中。

```
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <security>
       <authentication>
         <anonymousAuthentication enabled="true" />
       </authentication>
    </security>
  </system.webServer>
</configuration> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-01-16T21:16:46.077

如果您使用的图像具有太大的 DPI，SSRS 会将其渲染得非常大，并且可能不会显示在图像框中，除非您将其属性设置为适合其中。

“SSRS 中的图像渲染被硬编码为 72 96DPI。不仅如此，它还会假设原始图像是 96DPI，因此最终渲染的 300DPI 图像将比预期大 3.1 倍”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-03-11T12:18:16.620

你的图像是透明的PNG吗？它是否被放置在表格的单元格中？

一个常见的错误是将像 png 这样的图像放在文本框内。这将导致它在设计屏幕中显示但在预览中将停止工作的问题

# javascript - jQuery 对向后兼容性的支持如何？

> ID：281438
> 
> 赞同：41
> 
> 时间：2008-11-11T16:41:51.633
> 
> 标签：javascript, jquery, jquery-plugins, mootools, backwards-compatibility

我们遇到了 Mootools 不能很好地向后兼容的问题，特别是在拖放功能方面。我想知道是否有人对 jQuery 不向后兼容有任何类似的问题。我们开始大量使用它，并正在考虑升级到更新版本以开始使用几个需要它的插件。如果我们摆脱旧版本，我们会有什么问题吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-11T17:00:34.483

jQuery 似乎很好地向后兼容。我已经通过几个版本的核心使用它超过几年了，并且在升级时没有遇到问题，除了一些带有一些插件的小问题。我会说核心似乎很好，但如果你使用很多插件，你可能会遇到一些问题（但这些通常很容易修复，或者新核心无论如何都内置了该功能，所以你可以放弃他们）。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-11T17:59:53.553

jQuery 非常重视向后兼容性，以至于它们为每个版本都生成了一个“向后兼容性”插件：[http](http://docs.jquery.com/Release:jQuery_1.2#jQuery_1.1_Compatibility_Plugin) ://docs.jquery.com/Release:jQuery_1.2#jQuery_1.1_Compatibility_Plugin 。它让不需要向后兼容性的人节省了页面重量。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-12-19T14:57:10.017

*我的经验*是，在升级时，我有时会发现以前可以工作的东西会中断。例如，当从 1.7.2 升级到 1.8.3 时，我发现一些拖放功能停止工作。[一些问题可能是由于不推荐使用的 jQuery 函数被丢弃，但不兼容版本的jQuery UI](http://jqueryui.com/)仍在使用。

这是[另一个用户的报价](http://sympmarc.com/2011/06/27/jquery-and-backward-compatibility)：

> 向后兼容性可能不是 jQuery 团队的强项，但与大多数事情一样，这是一项正在进行的工作。我并不是要贬低他们所做的出色工作，但它指出了一个事实，即您*必须*始终使用新版本的 jQuery 测试您的脚本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-10-07T21:18:51.007

jQuery 从 1.0 版开始就产生了向后兼容的插件。

> 多年来，Web 开发发生了很大变化，jQuery 也随之发生了变化。在这段时间里，团队一直试图在保持与过去代码的兼容性与支持当前最佳 Web 开发实践之间取得平衡。

该项目具有以下向后兼容性存储库：

*   [jquery-compat-1.0（从 jQuery 1.0 升级到 jQuery 1.1+ 的兼容插件）](https://github.com/jquery-archive/jquery-compat-1.0)

*   [jquery-compat-1.1（从 jQuery 1.1 升级到 jQuery 1.2+ 的兼容插件）](https://github.com/jquery-archive/jquery-compat-1.1)

*   [jquery-xpath（为从 jQuery 1.1 升级到 jQuery 1.2 的用户实现 XPath 功能）](https://github.com/jquery-archive/jquery-xpath)

*   [jquery-compat-1.3（jQuery 1.3 的向后兼容性插件（用于 jQuery 1.4））](https://github.com/jquery-archive/jquery-compat-1.3)

*   [jquery-migrate-1.x-stable（将旧的 jQuery 代码迁移到 jQuery 1.9+）](https://github.com/jquery/jquery-migrate/tree/1.x-stable)

*   [jquery-migrate（将旧的 jQuery 代码迁移到 jQuery 3.0+）](https://github.com/jquery/jquery-migrate)

**参考**

*   [jQuery 博客](http://blog.jquery.com/category/jquery/)

*   [jQuery Wiki：不会修复](https://github.com/jquery/jquery/wiki/Won't-Fix)

*   [jQuery 核心升级指南](http://jquery.com/upgrade-guide/)

*   [jQuery Migrate 插件 - 警告消息 (2.0)](https://github.com/jquery/jquery-migrate/blob/1.x-stable/warnings.md)

*   [jQuery Migrate 插件 - 警告消息 (3.0)](https://github.com/jquery/jquery-migrate/blob/master/warnings.md)

*   [jqLint](https://github.com/jokeyrhyme/jqlint)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-12-09T09:01:07.223

根据我的经验，jQuery 1.x 在 1.9 版之前一直是非常向后兼容的。

> 自 jQuery 1.9.0 起，jQuery 1.x 行发生了重大变化。如果您从 1.9 之前的 jQuery 版本升级或需要使用尚未更新的插件，我们强烈建议您也使用 jQuery Migrate 插件。阅读[jQuery 1.9 升级指南](http://jquery.com/upgrade-guide/1.9/)和[jQuery 1.9 发布博客文章](http://blog.jquery.com/2013/01/15/jquery-1-9-final-jquery-2-0-beta-migrate-final-released/)了解更多信息。

在确定这对您来说不是问题之前，不要升级到 2.0：

> jQuery 2.x 具有与 jQuery 1.x 相同的 API，但*不支持 Internet Explorer 6、7 或 8。*

# perl - Perl 有 ORM 吗？

> ID：281440
> 
> 赞同：9
> 
> 时间：2008-11-11T16:42:30.073
> 
> 标签：perl, orm

```
创建表人
(
    名称 varchar(15),
    attr1 varchar(15),
    attr2 varchar(1),
    attr3 字符（1），
    attr4 整数
)

```

我如何在 Perl 中使用基本的 ORM，方法是使用一个像上面这样的简单表并将其映射到 Perl 对象？接下来，我想执行基本操作，例如使用某些标准系统 Perl 语法选择结果。例如。：

```
@myResults = findAll(attr1 == 3 && attr2 =~ /abc/); 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-11T16:48:40.247

规则#1，不要自己写。

CPAN 上有相当多的 ORM，包括...

*   [DBIx::Class](http://search.cpan.org/dist/DBIx-Class) - 目前可能排名第一
*   [玫瑰::DB::对象](http://search.cpan.org/dist/Rose-DB-Object)
*   [Fey::ORM](http://search.cpan.org/dist/Fey-ORM) - 我自己的贡献，最值得注意的是基于[Moose](http://moose.perl.org/)，这意味着您可以在基于 ORM 的类中获得 Moose 的所有功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T03:10:13.967

（迟到）Data::ObjectDriver（也在 CPAN 上）提供了极大的灵活性，特别是如果分区和缓存在您的需求列表中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T06:44:45.497

我会使用 DBIx::Class 的建议。下面是一些内省 50 表遗留数据库的代码（在模式中指定了关系）：

```
#!/usr/bin/perl
use warnings;
use strict;
use DBIx::Class::Schema::Loader qw/ make_schema_at /;

make_schema_at("Zotero::Schema",
               {
                   # components => ['InflateColumn::DateTime'],
                   debug => 1,
                   relationships => 1,
                   dump_directory => './lib' ,
               },
               ["dbi:SQLite:dbname=../zotero.sqlite", "",""]); 
```

# html - Internet Explorer 中的空白文本节点不一致

> ID：281443
> 
> 赞同：7
> 
> 时间：2008-11-11T16:43:02.460
> 
> 标签：html, internet-explorer, whitespace

以下源代码警告以下结果：

**Internet Explorer 7：29**
**Firefox 3.0.3** ： 37 （正确）
**Safari 3.0.4 (523.12.9)**： 38
**Google Chrome 0.3.154.9：38**

请忽略以下事实：

*   Webkit (Safari/Chrome) 浏览器在正文标记的末尾插入一个额外的文本节点
*   Internet Explorer 在其空白节点中没有新行，就像它们应该的那样。
*   Internet Explorer 没有起始空白节点（<form> 标签前有明显的空白，但没有匹配的文本节点）

在测试页面中的标签中，以下标签没有在 DOM 中插入空白文本节点：`form`, `input[@radio]`, `div`, `span`, `table`, `ul`, `a`.

我的问题是：**是什么让这些节点成为 Internet Explorer 中的例外？** 为什么在这些节点之后没有插入空格，而在其他节点中插入了空格？

如果您切换标签顺序，将 doctype 切换为 XHTML（同时仍保持标准模式），此行为是相同的。

这是一个[提供一些背景信息的链接](http://www.howtocreate.co.uk/wrongWithIE/?chapter=Empty+Space)，但没有理想的解决方案。这个问题可能没有解决方案，我只是对这种行为感到好奇。

感谢互联网，扎克

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript">
        function countNodes()
        {
            alert(document.getElementsByTagName('body')[0].childNodes.length);
        }
        </script>
    </head>
    <body onload="countNodes()">
        <form></form>
        <input type="submit"/>
        <input type="reset"/>
        <input type="button"/>
        <input type="text"/>
        <input type="password"/>
        <input type="file"/>
        <input type="hidden"/>
        <input type="checkbox"/>
        <input type="radio"/>
        <button></button>
        <select></select>
        <textarea></textarea>
        <div></div>
        <span></span>
        <table></table>
        <ul></ul>
        <a></a>
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-22T23:51:38.543

IE 试图提供帮助并隐藏仅包含空格的文本节点。

在下面的：

```
<p>
<input>
</p> 
```

W3C DOM 规范说`<p>`有 3 个子节点（“\n”`<input>`和“\n”），IE 会假装只有一个。

解决方案是在所有浏览器中跳过[文本节点：](https://developer.mozilla.org/en/DOM/element.nodeType)

```
var node = element.firstChild;
while(node && node.nodeType == 3) node = node.nextSibling; 
```

流行的 JS 框架具有此类功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T17:04:54.723

嗯...我会说它是 IE 的原因。我不认为程序员有这样做的具体意图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T17:38:36.200

我猜**table**标签在浏览器之间是不同的。

例如，默认表自动包含哪些节点？

```
<table>
  <thead>
  </thead>
  <tbody>
  </tbody>
  <tfoot>
  </tfoot>
</table> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T02:30:50.270

为什么不尝试遍历 DOM 并查看每个浏览器认为文档包含什么？

IE 对 DOM 做了很多“优化”。要了解这可能是什么样子，请在 IE 中“全选”、“复制”，然后在 Visual Studio 中“粘贴备用”，您将获得以下信息：

```
<INPUT value="Submit Query" type=submit> 
<INPUT value=Reset type=reset> 
<INPUT type=button> 
<INPUT type=text> 
<INPUT value="" type=password> 
<INPUT type=file> 
<INPUT type=hidden>
<INPUT type=checkbox>
<INPUT type=radio>
<BUTTON type=submit></BUTTON> 
<SELECT></SELECT>
<TEXTAREA></TEXTAREA> 
```

所以它会删除一些空标签并添加一些默认属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-05-01T00:47:51.423

Zachleat，我想我已经找到了解决问题的办法。（我冒昧地将表单元素移动到表单标签中。）

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!--REF http://stackoverflow.com/questions/281443/inconsistent-whitespace-text-nodes-in-internet-explorer -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript">
    function countNodes()
    { alert(document.getElementsByTagName('form')[0].childNodes.length);
    };
</script>
</head>
<body onload="countNodes()">
  <form
    ><input type="submit"/
    ><input type="reset"/
    ><input type="button"/
    ><input type="text"/
    ><input type="password"/
    ><input type="file"/
    ><input type="hidden"/
    ><input type="checkbox"/
    ><input type="radio"/
    ><button></button
    ><select></select
    ><textarea></textarea
    ><div></div
    ><span></span
    ><table></table
    ><ul></ul
    ><a></a
  ></form>
</body>
</html> 
```

如您所见，我已经拆分并捆绑了结束的 gt（大于）括号，因此它们紧贴下一个标签，从而确保没有模棱两可的空格。

令人惊喜的是，它适用于迄今为止尝试过的所有（4 个桌面）浏览器，所有浏览器都报告相同数量的 DOM 节点。

# c++ - 命名空间（静态）成员变量

> ID：281445
> 
> 赞同：2
> 
> 时间：2008-11-11T16:43:33.410
> 
> 标签：c++

我希望能够实现这样的目标：

```
class Zot
{
    namespace A
    {
        static int x;
        static int y;
    }    
} 
```

我正在使用一个遗留系统，该系统大量使用数据库模式的代码生成，并且某些字段在类定义中作为方法/变量公开。我需要向这些类添加一些额外的静态变量，并希望保证不会与现有名称发生冲突。

我想出的最好的方法是使用另一个结构来包装静态变量，就好像它是一个命名空间一样：

```
class Zot
{
    struct A
    {
        static int x;
        static int y;
    }    
} 
```

有没有更好的办法？

**更新：**

一个额外的要求是能够从其他地方的模板访问这些

例如

```
template<class T>
class B
{
  void foo() { return T::A::x; }
}; 
```

所以把它们放在一个单独的班级是行不通的

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T17:09:24.247

真正的内部结构是你最好的选择。另一种可能性是使用 typedef 来引入一个静态类。这适用于代码生成，因为您可以将附加内容与生成的代码分开：

在生成的文件中根本不关心 Zot_statics 中的内容：

```
class Zot_statics;    
class Zot
{
public:
    typedef Zot_statics A;

    int x; // This is ok
}; 
```

当您需要访问 x 和 y 时，在手动维护的标题中：

```
class Zot_statics
{
public:
    static int x;
    static int y;
}; 
```

在手动维护的 cpp 文件中：

```
int Zot_statics::x;
int Zot_statics::y; 
```

并且您的模板在`Zot::X`引用 Zot 上的实例变量 X 和引用静态变量的 Zot::A::x 时应该可以正常工作。

# asp.net - 实体框架：使用 FK（为什么它们会被隐藏？）

> ID：281454
> 
> 赞同：0
> 
> 时间：2008-11-11T16:46:43.653
> 
> 标签：asp.net, entity-framework, ado, entities

首先，让我们定义几个表：

用户表将存储有关用户的信息：

```
Users
- UserID (int, PK)
- ... 
```

UserTasks 是一个存储与用户关联的任务的表：

```
UserTasks
- userID (int, FK to Users table)
- taskName (varchar) 
```

当我使用 ADO 实体框架生成 UserTasks 表时，我将得到一个如下所示的类：

UserTasks
- taskName（字符串）
- 用户（用户对象的集合）

注意：在 UserTasks 表中没有生成用户 ID。所以现在让我们假设我需要插入一个新的用户任务......我该怎么做？我无权访问 userID FK 字段，所以我唯一的选择是查找并填充用户对象，然后将其传递给我的任务对象，如下所示：

```
//get the user we are interested in 
var user = (from u in context.Users
           where u.userID == 2
           select u).FirstOrDefault();  

//create the new task
UserTasks newTask = new UserTasks();
newTask.taskName = "New Task";
newTask.User = user; 
```

上面的问题是我正在做一个额外的和不必要的数据库调用来填充我的用户对象。有没有办法以某种方式创建到我的 userID 字段的新映射并仍然保留 User 对象？

谢谢

——瑞安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T17:53:35.843

不是现在，但[可能在下一个版本](http://blogs.msdn.com/efdesign/archive/2008/10/27/foreign-keys-in-the-conceptual-and-object-models.aspx "概念模型和对象模型中的外键")中。

# c# - Java 到 C# 的转换

> ID：281456
> 
> 赞同：0
> 
> 时间：2008-11-11T16:47:28.970
> 
> 标签：c#, java

我需要将几个 Java 类转换为 C#，但我遇到的问题很少。

在 Java 中，我有以下类层次结构：

```
public abstract class AbstractObject {
    public String getId() {
        return id;
    } 
}

public class ConcreteObject extends AbstractObject {
    public void setId(String id) {
        this.id= id;
    }
} 
```

有 AbstractObject 的实现不需要定义 setId()，所以我不能在层次结构中向上移动它。

如何使用属性将其转换为 C#？那可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T16:54:14.993

当您`get`在 .Net 中仅提供属性的一部分时，您明确告诉编译器该属性是只读的。这比不提供`set`. 这在属性语法的 vb 版本中很明显，您还必须显式声明该属性为 ReadOnly。

您可以做的是同时提供一个 getter 和一个 setter，但`NotImplementedException`在抽象 setter 中抛出一个，用适当的属性和文档装饰它，以便除非 setter 已被属性覆盖，否则没有人使用它。否则，您最好还是将它们保留为方法，以避免在 Java 和 .Net 版本的代码之间断开连接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T17:10:32.573

我建议使用您已经概述的方法调用，以确保调用者清楚该类的用法。如果您打算使用属性来实现它，那么您可以执行以下操作（可以在[此处](http://msdn.microsoft.com/en-us/library/6fawty39.aspx "使用 Override 和 New 关键字进行版本控制（C# 编程指南）")找到一些关于 new 关键字的文档）。

```
public abstract class AbstractObject {
    protected string id;
    public string Id
    {
        get { return id; }
    }
}

public class ConcreteObject : AbstractObject
{
    public new string Id
    {
        get { return base.Id; }
        set { id = value; }
    }
} 
```

# java - 在 Java 中更改键盘输入语言

> ID：281466
> 
> 赞同：1
> 
> 时间：2008-11-11T16:52:23.190
> 
> 标签：java, layout, keyboard, settings

有没有办法在 Java 中设置/更改键盘输入语言（例如从英语到德语）？

示例用例：在德语键盘上记录（输入）用于播放的脚本。自动播放是在英文键盘上完成的...如果在脚本运行之前未将键盘自动设置为德文，则会失败。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T17:02:09.363

键盘输入映射完全由我熟悉的每个平台上的操作系统管理。Java 没有提供用于以跨平台方式进行操作的 API。我会调查您可以通过[JNA](https://github.com/twall/jna)操作的本机 API ，或者甚至（如果您觉得很脏）调用一些特定于平台的命令来满足您的需求。

您不会在 JDK 标准库中找到解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T00:16:11.360

在 java 中，您可以使用 InputContext 类。查看它的 API 或在 InputContext 上进行谷歌搜索。

# php - 我想要最简单的ajax表单应用

> ID：281468
> 
> 赞同：0
> 
> 时间：2008-11-11T16:53:57.693
> 
> 标签：php, javascript, ajax, forms

我希望 ajax 应用程序只处理带有文本输入和提交按钮的简单表单，并且没有验证，我想用 php 脚本添加它。我问这个是因为我不知道如何使用 ajax 或 javascript 编程。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T16:56:50.793

我强烈推荐使用jQuery——在[jQuery](http://jquery.com/) [for Designers](http://jqueryfordesigners.com/)上有一些很好的教程（有些是视频）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T22:05:22.853

老实说，如果不学习 javascript，您将一事无成。你真的应该考虑学习它，它也不是那么复杂的语言。Ajax 实际上不是一种语言，它是一种功能，可以说是一种特性。一旦你掌握了使用它的窍门，它也不难，像 JQuery 和 MooTools 这样的框架会让它变得容易得多。

www.w3schools.com 是学习 javascript 的好地方，如果您在学习 JavaScript 的过程中不断查找内容，请不要担心，即使我们中最优秀的人也必须这样做。永远不要害怕提问，这就是你学习的方式。

如果你懂 php，javascript 会比较容易上手。使用 AJAX 时要记住的一件事是，您删除了用户点击后退按钮或为页面添加书签的能力，因为不会将使用带到新页面。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T16:59:29.320

在深入了解 jQuery（我推荐）之前，从一个非常简单的教程开始可能有助于了解正在发生的事情。

[Ajax 初学者教程](http://www.ajaxprojects.com/ajax/tutorialdetails.php?itemid=10)可能会有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T16:59:25.903

您应该使用[jQuery](http://jquery.com/)或[原型](http://www.prototypejs.org/)之类的 javascript 库。您还可以在那里找到一些教程。如果你想自己做，请阅读[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T18:07:21.930

您可以为 jQuery 使用[ajaxSubmit](http://exscale.se/archives/2008/01/20/ajax-submit-form-jquery-plugin/)插件。

在 html 中包含 jquery 和插件后，您只需添加

```
$(document).ready(function () {
    $('form').ajaxSubmit('#result');
}); 
```

其中“结果”是您希望结果到达的 div 的 id。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T10:20:10.937

我知道这在技术上不是主题，但我想简要介绍一下 AJAX 和用户的后退按钮 - 有一个jQuery[插件可以解决这个问题。](http://plugins.jquery.com/project/history)如果您使用单片 YUI，则还附带一个历史管理器。

# wicket - Wicket、页面堆栈和内存使用情况

> ID：281475
> 
> 赞同：4
> 
> 时间：2008-11-11T16:56:45.833
> 
> 标签：wicket

Wicket 应用程序序列化和缓存所有页面以支持有状态组件，以及支持后退按钮，以及其他可能的原因。我有一个应用程序，它使用 setResponsePage 从一个屏幕导航到另一个屏幕。在相当短的时间内会话变得相当大，因为所有先前的页面都存储在会话中。在大多数情况下，出于显而易见的原因，我只需要会话包含当前页面，也许还有最后 2 或 3 个页面，以便使用浏览器的后退按钮轻松导航。

在我离开页面并且我知道我不想使用返回到该页面版本的按钮后，我可以强制页面过期吗？更一般地说，在 Wicket 中处理会话增长的推荐方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-07T11:30:00.453

[http://apache-wicket.1842946.n4.nabble.com/Wicket-Session-grows-too-big-real-fast-td1875816.html](http://apache-wicket.1842946.n4.nabble.com/Wicket-Session-grows-too-big-real-fast-td1875816.html)

如果您在页面上使用大量域对象，这些对象最终与其他域对象紧密耦合，请务必避免对这些对象进行序列化！

查看 LoadableDetachableModel 用于包装域对象 DataView 和 IDataProvider 以显示域对象列表

您不应将域对象填充到组件的实例变量中。为了在匿名子类中使用它们，您不应将域对象引用设为 final。你不应该将域对象的列表传递给 ListView。

也许，在您的 Application 类中子类化 WbeRequestCycle 时，您可能会控制页面映射中页面的生命周期......虽然没有尝试过

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-20T11:40:10.643

为了避免由于会话中的序列化和内存使用堆积而导致字节流连续堆叠而导致会话阻塞，您可以使用可分离模型通过使用钩子在每个请求周期开始时安排自己的存储和恢复，这这样您就可以完全控制包含会话中不需要的页面字节流或可通过“返回”按钮导航的模型。

# java - Jlabel HTML 格式化

> ID：281478
> 
> 赞同：2
> 
> 时间：2008-11-11T16:58:13.833
> 
> 标签：java, swing

我有一个 JLabel，里面有一个电子邮件地址。我在 JLabel 上使用了 HTML 格式，因此它显示为链接。但是，您无法单击该链接。事实上，您不能选择标签中的任何文本。是否可以在 JLabel 上设置一个属性，以允许用户至少选择电子邮件的文本，并且最好像在网页上那样单击电子邮件地址？

我的 JLabel 代码本质上是：

```
JLabel l = new JLabel("<html><a href=\"mailto:bob@bob.com\">bob@bob.com</a>"); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T17:17:46.710

默认情况下`JLabel`不允许您这样做。如果你真的想使用 a `JLabel`，你可以添加一个鼠标监听器来捕捉点击并对它们做出反应。另一种方法是使用不可编辑`JEditorPane`并调用`addHyperlinkListener`它来添加你的`HyperlinkListener`.

# objective-c - 我可以覆盖 Tiger 上的登录窗口吗？

> ID：281485
> 
> 赞同：3
> 
> 时间：2008-11-11T17:00:00.053
> 
> 标签：objective-c, macos, plugins, sfauthorizationpluginview

我的软件在启动 Mac OS X（Tiger 和 Leopard）之前授权用户。我想使用 SFAuthorizationPluginView 创建一个插件来尝试使用我们的预启动授权（安全缓存）让用户登录到 Mac OS X 进行单点登录-on 能力。我还没有验证这是否适用于 Leopard，但我假设我能够做到。（危险，我知道。）

**问题是如何为 Tiger 执行此操作，该解决方案是否适用于 Leopard？**

我继续研究，如果我找到解决方案，我会分享。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T22:52:12.540

我期望做的是更改 /etc/authorization 数据库以充分接受您的授权，但是围绕 system.login.console 的评论并没有让我期望它会起作用。您可以通过提供您自己的类似登录的应用程序来规避 LoginWindow，您可以使用 launchd 而不是 com.apple.loginwindow 来启动该应用程序，但这似乎是在使用大锤来破解坚果。

# c - 如何最好地对循环缓冲区的一部分进行排序？

> ID：281488
> 
> 赞同：2
> 
> 时间：2008-11-11T17:02:05.883
> 
> 标签：c, algorithm, sorting, circular-buffer

我在 C 中有一个循环的、静态分配的缓冲区，我将其用作~~深度~~广度优先搜索的队列。我希望对队列中的前 N ​​个元素进行排序。只使用常规的 qsort() 会很容易——除了它是一个循环缓冲区，并且前 N 个元素可能会环绕。当然，我可以编写自己的排序实现，它使用模块化算法并且知道如何环绕数组，但我一直认为编写排序函数是一个很好的练习，但最好留给库。

我想到了几种方法：

1.  使用单独的线性缓冲区 - 首先从循环缓冲区复制元素，然后应用 qsort，然后将它们复制回来。使用额外的缓冲区意味着额外的 O(N) 空间需求，这让我
    *   使用 qsort 对“顶部”和“底部”两半进行排序，然后使用附加缓冲区将它们合并
    *   与 2 相同。但在原地进行最终合并（我在原地合并方面没有发现太多，但我看到的实现似乎不值得降低空间复杂度）

另一方面，花一个小时思考如何优雅地避免编写我自己的快速排序，而不是添加那 25 行（左右）行可能也不是最有效率的......

**更正：**在切换 DFS 和 BFS 时犯了一个愚蠢的错误（我更喜欢编写 DFS，但在这种特殊情况下我必须使用 BFS），抱歉造成混淆。

**原问题的进一步描述：**

我正在实施**广度**优先搜索（对于类似于[十五个](http://en.wikipedia.org/wiki/Fifteen_puzzle)难题的东西，只是更复杂，在每个状态下大约有 O(n^2) 个可能的扩展，而不是 4 个）。“蛮力”算法已经完成，但它是“愚蠢的”——在每一点，它以硬编码的顺序扩展所有有效状态。队列实现为循环缓冲区（无符号队列[MAXLENGTH]），它将整数索引存储到状态表中。除了对索引进行排队和出队的两个简单函数外，它没有封装——它只是一个简单的、静态分配的无符号数组。

现在我想添加一些启发式方法。我想尝试的第一件事是在展开后对展开的子状态进行排序（“以更好的顺序展开它们”）——就像我正在编写一个简单的最佳优先 DFS 一样。为此，我想加入队列（代表最近的扩展状态），并使用某种启发式对它们进行排序。我还可以以不同的顺序扩展状态（因此在这种情况下，如果我打破队列的 FIFO 属性并不重要）。

我的目标不是实现[A*](http://en.wikipedia.org/wiki/A*_search_algorithm)或基于深度优先搜索的算法（我无法扩展所有状态，但如果我不这样做，我将开始遇到状态空间中无限循环的问题，所以我必须使用诸如[迭代深化](http://en.wikipedia.org/wiki/Iterative_deepening_depth-first_search)之类的东西）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T17:11:37.283

我认为您需要从问题中退后一步并尝试将其作为一个整体来解决 - 很有可能半排序的循环缓冲区不是存储数据的最佳方式。如果是，那么您已经提交了，您将不得不编写缓冲区来对元素进行排序——这是否意味着偶尔使用外部库执行排序，或者在插入元素时进行排序，我不知道。 **但归根结底，它会变得丑陋，因为 FIFO 和排序缓冲区根本不同。**

* * *

*上一个答案，假设您的排序库具有强大且功能丰富的 API（根据您的问题的要求，这不需要您编写自己的 mod 排序或任何东西 - 它取决于支持任意定位数据的库，通常通过回调函数。如果你的排序不支持链表，它不能处理这个）：*

循环缓冲区已经使用 % (mod) 算法解决了这个问题。QSort 等不关心内存中的位置——它们只需要一个方案来以线性方式寻址数据。

它们适用于链表（在内存中不是线性的），就像它们适用于“真正的”线性非循环数组一样。

因此，如果您有一个包含 100 个条目的循环数组，并且您发现您需要对前 10 个进行排序，而前 10 个恰好在顶部折叠成一半，那么您需要向排序提供以下两位信息：

*   定位数组项的函数是 (x % 100)
*   要排序的项目在位置 95 到 105

该函数会将排序使用的地址转换为实际数组中使用的索引，并且数组环绕的事实是隐藏的，尽管对超出其边界的数组进行排序可能看起来很奇怪，根据定义，循环数组具有没有界限。% 运算符会为您处理，您也可以将数组的部分称为 1295 到 1305 以了解它所关心的一切。

拥有一个包含 2^n 个元素的数组的奖励积分。

* * *

## 额外的考虑点：

在我看来，您使用的排序库无法对线性数组以外的任何内容进行排序 - 因此它无法对链表或具有简单排序以外的任何数组进行排序。你真的只有三个选择：

*   您可以重新编写库以使其更灵活（即，当您调用它时，您会给它一组函数指针，用于比较操作和数据访问操作）
*   您可以重写您的数组，使其以某种方式适合您现有的库
*   您可以为您的特定解决方案编写自定义排序。

现在，就我而言，我将重新编写排序代码，使其更灵活（或复制它并编辑新副本，以便您拥有对线性数组快速的排序，以及对非线性数组灵活的排序）

但现实情况是，现在您的排序库非常简单，您甚至无法告诉它如何访问非线性存储的数据。

如果就这么简单，那么应该毫不犹豫地根据您的特定需求调整库本身，或者调整您的缓冲区以适应库。

尝试一个丑陋的杂物，例如以某种方式将您的缓冲区变成一个线性数组，对其进行排序，然后将其放回原处就是这样 - 一个丑陋的杂物，您以后必须理解和维护。您将“闯入”您的 FIFO 并摆弄内脏。

-亚当

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T18:24:01.070

我没有看到您在 c 中要求的解决方案。您可能会考虑以下想法之一：

*   如果您可以访问`libc`'s的源代码`qsort()`，则可以复制它并简单地将所有数组访问和索引代码替换为适当通用的等效代码。这为您提供了一些适度的保证，即下级排序是有效的并且几乎没有错误。当然，对于引入自己的错误的风险没有帮助。大 O 喜欢这个系统`qsort`，但可能有一个更差的乘数。

*   如果要排序的区域与缓冲区的大小相比较小，则可以使用直接线性排序，使用测试换行保护调用并执行复制到线性缓冲区排序然后-仅在需要时复制回例程。`O(n)`在使守卫绊倒的情况下引入额外的操作（对于`n`要排序的区域的大小），这使得平均`O(n^2/N) < O(n)`.

* * *

我看到 C++ 不适合您。::sigh:: 我会把它留在这里以防其他人可以使用它。

*   如果 C++ 是一个选项，您可以（如果需要，子类化缓冲区并）重载`[]`运算符以使标准排序算法工作。同样，应该像带有乘数惩罚的标准排序一样工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T17:22:59.837

也许可以调整[优先队列来解决您的问题。](http://en.wikipedia.org/wiki/Priority_queue)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T18:20:39.627

您可以旋转循环队列，直到有问题的子集不再环绕。然后只需将该子集传递给`qsort`正常。如果您需要频繁排序或数组元素大小非常大，这可能会很昂贵。但是，如果您的数组元素只是指向其他对象的指针，那么旋转队列可能就足够快了。事实上，如果它们只是指针，那么您的第一种方法也可能足够快：制作子集的单独线性副本，对其进行排序，然后将结果写回。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T19:09:01.027

你知道关于优化的规则吗？你可以谷歌他们（你会找到几个版本，但他们都说几乎一样的东西，不要）。

听起来您在没有测试的情况下进行优化。这是一个巨大的禁忌。另一方面，您使用的是直接 C，因此您可能在需要一定程度注意速度的受限平台上，所以我希望您需要跳过前两条规则，因为我假设您别无选择：

优化规则：

1.  不要优化。

2.  如果您知道自己在做什么，请参阅规则 #1

您可以转到更高级的规则：

优化规则（续）：

3.  如果您的规范需要一定的性能水平，请编写未优化的代码并编写测试以查看它是否符合该规范。如果它满足它，你就完成了。在达到这一点之前，切勿编写考虑性能的代码。

4.  如果您完成了第 3 步，但您的代码不符合规范，请重新编码，将原始“最明显”的代码保留在其中作为注释并重新测试。如果不符合要求，就扔掉，使用未优化的代码。

5.  如果您的改进使测试通过，请确保测试保留在代码库中并重新运行，并且您的原始代码作为注释保留在那里。

注意：那应该是 3\. 4\. 5\. 有些事情搞砸了——我什至没有使用任何标记。

好的，所以最后——我不是在说这个，因为我在某处读过它。我花了几天时间试图解开其他人编码的一些可怕的混乱，因为它是“优化的”——真正有趣的部分是，十分之九，编译器可以比他们更好地优化它。

我意识到有时您需要优化，我所说的只是在未优化的情况下编写它，对其进行测试和重新编码。它真的不会花费你太多时间——甚至可能使编写优化代码更容易。

我发布这篇文章的唯一原因是因为您写的几乎每一行都与性能有关，而且我担心下一个看到您的代码的人会像我一样是个可怜虫。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T22:32:31.590

像这里这样的例子怎么样。这个例子可以轻松地对零件或任何您想要的东西进行排序，而无需重新定义大量额外的内存。它只需要两个指针，一个状态位和一个用于 for 循环的计数器。

```
#define _PRINT_PROGRESS
#define N 10
BYTE buff[N]={4,5,2,1,3,5,8,6,4,3};
BYTE *a = buff;
BYTE *b = buff;
BYTE changed = 0;
int main(void)
{
    BYTE n=0;
    do
    {
        b++;
        changed = 0;
        for(n=0;n<(N-1);n++)
        {
            if(*a > *b)
            {
                *a ^= *b;
                *b ^= *a;
                *a ^= *b;
                changed = 1;
            }
            a++;
            b++;
        }
        a = buff;
        b = buff;
#ifdef _PRINT_PROGRESS
        for(n=0;n<N;n++)
            printf("%d",buff[n]);
        printf("\n");
    }
#endif
    while(changed);
    system( "pause" );
} 
```

# java - 我需要什么来编写基于 Java 的 Web 应用程序并在我的个人计算机上对其进行测试？

> ID：281490
> 
> 赞同：1
> 
> 时间：2008-11-11T17:02:19.190
> 
> 标签：java

我目前有 Apache HTTP Server，但我猜我需要 Tomcat（然后必须以一种不向公众开放的方式对其进行配置），一个 Java JDK（我已经拥有，但可能应该更新) 和一个 IDE（我有 Eclipse）。但是在开始之前我还应该知道什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T17:07:53.563

我建议您也安装一个数据库服务器——您可以使用各种纯 Java 实现走得很远，但是任何重要的事情都可能会从拥有 MySQL 的副本中受益。

我也会得到某种版本控制——tortoiseSVN 非常适合 Windows。即使你只是为自己玩玩，养成使用它的习惯也会节省时间和心痛。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T17:16:08.350

如果您想保持简单，那么您拥有所需的一切；一个 servlet 容器。

IDE 当然有帮助。

我会推荐 Eclipse 的 Web 工具项目，因为它允许您编写代码，然后单击一个按钮，该按钮将把该代码全部从 IDE 放到 tomcat 上。

[http://www.eclipse.org/webtools/](http://www.eclipse.org/webtools/)

正如 Bogdan 提到的，maven 是一个依赖管理工具，但取决于你的舒适程度，我不确定你是否想用它来搅浑水。

另一个使用 Maven 的项目是 appfuse ( [http://appfuse.org/display/APF/Home](http://appfuse.org/display/APF/Home) )，它将帮助您快速开始生成 webapp。它会给你一个 webapp、一个数据库、单元测试、依赖管理和一个很好的框架来构建你的项目。

所以，如果你只是想玩一些 .jsps 和一两个 servlet，我会坚持使用 IDE，但如果你对 Web 应用程序、MVC 和构建工具感到满意，我会推荐 appfuse。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-12T14:16:24.673

让我们看看......你需要：

1.  一个JDK。最好是[Standard Edition](http://java.sun.com/javase/downloads/index.jsp)，除非您打算将 GlassFish 用作 J2EE 服务器。如果您确实使用标准版，则需要包含 servlet 容器/J2EE 堆栈中的 jar 以访问 J2EE 库。
2.  一个 Servlet 容器。 [Apache Tomcat](http://tomcat.apache.org/)是一种流行的，Eclipse 已经对它提供了集成支持。请记住，Tomcat 不是一个完整的 J2EE 堆栈……为此，您需要[JBoss Application Server](http://www.jboss.org/jbossas/)或[Apache Geronimo 之](http://geronimo.apache.org/)类的东西。
3.  （半可选）Web 服务器。Apache Web Server*出人意料*地与 Apache Tomcat 或 Apache Geronimo 配合得很好……这几乎就像它们是由同一个人制作的！Eclipse 具有对 Tomcat 的内置支持，因此似乎不需要 Web 服务器。不过，我可能是错的。
4.  （可选）IDE。如果您使用[Eclipse](http://www.eclipse.org/)，请获取 Java EE Developers 的版本。
5.  （可选）数据库。MySQL 和 HSQLDB 对于 Java 来说是流行的，至少对于中小型应用程序来说是这样。请记住，您还需要为您的数据库下载 JDBC 驱动程序。
6.  （可选）修订控制系统。即使在单个开发人员项目中，如果您不小心删除了不应该删除的代码或文件，修订控制系统也可以保存您的隐藏。这里有几种选择； [Subversion](http://subversion.tigris.org/)是我个人的选择，还有一个 Eclipse 插件，例如[Subclipse](http://subclipse.tigris.org/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T17:07:08.480

这就是您需要的工具。

然后，你需要谷歌一些关于使用 servlet 和 jsp 页面的教程。甚至与 tomcat 捆绑在一起的文档也足够好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T17:10:56.257

您可能还需要一个像 MySQL 或[HSQLDB](http://hsqldb.org/)这样的数据库。[您可以用Jetty](http://www.mortbay.org/jetty/)替换 Tomcat，这通常更容易在不重新启动服务器的情况下重新加载类更改。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T17:23:19.663

如果您愿意切换 IDE，则可以在 NetBeans 中完成所有操作（这是一个相对轻松的切换，但您可以在 Eclipse 中创建类似的设置）。NetBeans 有一个 Tomcat 插件，允许您在 NetBeans 中创建、编辑、运行和调试 servlet 和 JSP Web 应用程序。[这里](http://wiki.netbeans.org/NetbeansedTomcat)有一个入门教程。当您安装 Tomcat 插件时，您会获得很多很好的示例 servlet 和 JSP 作为奖励。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T17:05:53.707

我会选择 Maven。

它将让您快速开始配置您的项目（通过使用原型），它将管理您的依赖项。

安装它并运行 archetype 命令来创建你的项目。

```
mvn archetype:create -DgroupId=com.mycompany.app -DartifactId=my-webapp -DarchetypeArtifactId=maven-archetype-webapp 
```

之后，只需使用 maven eclipse 插件为该项目配置 eclipse 环境（[http://maven.apache.org/plugins/maven-eclipse-plugin/](http://maven.apache.org/plugins/maven-eclipse-plugin/)）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T17:43:17.953

*我目前有 Apache HTTP Server，但我猜我需要 Tomcat（然后必须以不向公众开放的方式对其进行配置）*

> 对于简单的基于 Java 的 Web 应用程序，您不需要安装 Apache，除非您太关心性能并希望通过让 Apache 提供静态资源来获得收益。

*但是在开始之前我还应该知道什么？*

> 最好推荐一个好的IDE，否则开发会很痛苦。正如人们已经建议的那样，使用一个简单的数据库。我会选择 MySQL，因为它对于 webapp 来说既不太复杂也不太简单。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-11T17:50:21.607

[我推荐Jetty](http://jetty.org/)而不是 Tomcat ，它也是一个 Servlet-Container。根据我的经验，它更容易设置和维护。足以测试您的应用程序。

除此之外，您（自然）需要一个 JDK。数据库是可选的，但如果您的网络应用程序想要保存数据，它是最好的选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-07-28T08:27:18.197

第 1 步：如果没有从[http://www.oracle.com/technetwork/java/javaee/downloads/index.html](http://www.oracle.com/technetwork/java/javaee/downloads/index.html)下载，则需要在系统中安装 J2EE 。

第 2 步：应该有 Apache TomCat 服务器在本地（本地服务器）上运行您的系统上的 Web 项目。安装步骤[https://www.ntu.edu.sg/home/ehchua/programming/howto/Tomcat_HowTo.html](https://www.ntu.edu.sg/home/ehchua/programming/howto/Tomcat_HowTo.html)去这个网站。

第 3 步：设置 Java JRE 的类路径。

# visual-studio - 错误：无法生成 SQL Server 的用户实例

> ID：281500
> 
> 赞同：29
> 
> 时间：2008-11-11T17:07:59.553
> 
> 标签：visual-studio, sql-server-express, sql-server-2008-r2, user-instance

我正在尝试连接到 MDF。我什至不遗余力地重新安装了 sql server express（它现在是我的盒子上安装的唯一一种 SQL，以前我有 05 dev 和 express）。我已经验证了路径都是正确的，到目前为止我的 google-fu 没有帮助。

完整的异常消息是：

> 由于启动用户实例的进程失败，无法生成 SQL Server 的用户实例。连接将被关闭。

连接字符串是：

```
<add name= "CustomerEntities"
     connectionString="metadata=res://*/Data.CustomerModel.csdl|res://*/Data.CustomerModel.ssdl|res://*/Data.CustomerModel.msl;
     provider=System.Data.SqlClient;
     provider connection string='Data Source=.\SQLEXPRESS;
     AttachDbFilename=\App_Data\CustomerDb.mdf;
     Integrated Security=True;
     User Instance=True'"
     providerName="System.Data.EntityClient" /> 
```

### 附加信息：

我在网上找到的几个关于这个错误的引用并不适用于我。例如，我看到的一个错误是在尝试通过远程桌面启动用户实例时发生此错误（我在本地执行此操作）。而另一个建议它与旧快速安装的剩余文件有关......我查看了规定的位置并没有找到那些工件。我也试过运行`sp_configure 'user instances enabled', '1'`，但它说它已经设置为1。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-11-11T17:47:36.727

好的，现在可以使用了！猜想这是一个复杂的问题......我为解决它所采取的步骤是这样的：

1.  更改了连接字符串中的以下属性（注意细微差别）：`AttachDbFilename=|DataDirectory|CustomerDb.mdf;`
2.  删除了以下目录的内容：`c:\Users\<user name>\AppData\Local\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`. 我以为我以前找过这个，但实际上我在`Microsoft Sql Server`文件夹中查看过。再次，细微的差别。

一旦我做了这两件事，连接就开始工作了:-D

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-01-08T11:50:23.247

当我将代码从一台机器移动到另一台机器时，我遇到了同样的错误。我正在使用 VS2010 和 SQLEXPRESS 2008 附带它。

技巧，从以下文件夹中删除所有内容 "C:\Users\UserName\AppData\Local\Microsoft\Microsoft SQL Server Data\SQLEXPRESS" 对我有用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-12-24T16:09:14.960

尽管上面的答案解决了很多人的问题，但我仍然发现这些没有解决问题的本质。最接近它的是上面@sohaiby 的答案。但它错误地指的是使用 Management Studio。

该主题顶部的错误消息非常清楚地表明问题在于生成用户实例。这里详细描述了实例是什么以及如何使用它： [https ://msdn.microsoft.com/en-us/library/ms254504(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/ms254504(v=vs.110).aspx)

就个人而言，我在将 DB 连接从 windows 身份验证模式切换到 SQL Server 身份验证时遇到了这个问题。我通过将连接字符串的一部分修改为：**“User Instance=false;”来解决它** 而不是“User Instance=true;”，它适用于 Windows 身份验证。

在我更改为“User Instance=false;”之后 我的连接工作正常，没有任何额外的操作。我不能坚持认为它会起作用或适用于所有场景。但是，我肯定会建议在上述其他极端方法之前尝试它，例如擦除 SQL Server 工作目录。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-22T13:31:05.173

除了此处的其他解决方案外，此解决方案也可能会有所帮助。确保应用程序池作为网络服务运行，而不是 ApplicationPoolIdentity。

在这里找到了这个解决方案：http: [//blogs.msdn.com/b/webdevelopertips/archive/2010/05/06/tip-106-did-you-know-how-to-create-the-aspnetdb-mdf-文件.aspx](http://blogs.msdn.com/b/webdevelopertips/archive/2010/05/06/tip-106-did-you-know-how-to-create-the-aspnetdb-mdf-file.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-01T07:44:31.760

正如其他人所指出的，删除目录的内容： c:\Users\\AppData\Local\Microsoft\Microsoft SQL Server Data\SQLEXPRESS 为我解决了这个问题。可能有助于其他人的注释，在 Windows 7 上，从文档浏览器浏览 c:\users\username 目录并没有显示 AppData 文件夹，这让我暂时离开（因为我认为我没有 AppData 目录）直到我发现它确实存在（但在 Windows 7 的文档浏览器中没有显示），您只需输入完整路径名即可访问它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-13T16:14:18.493

我今天早上在测试部署环境中开始收到此错误。我使用的是 SQL Server Express 2008，我得到的错误是

“由于启动用户实例的进程失败，无法生成 SQL Server 的用户实例。连接将被关闭。”

不确定是什么原因造成的，我按照这篇文章和其他文章中关于删除“C:\Users\UserName\AppData\Local\Microsoft\Microsoft SQL Server Data\SQLEXPRESS”目录的说明进行操作，但无济于事。

对我来说诀窍是改变连接字符串

```
"Data Source=.\SQLExpress;Initial Catalog=DBFilePath;Integrated Security=SSPI;MultipleActiveResultSets=true" 
```

到

```
"Data Source=.\SQLExpress;Initial Catalog=DBName;Integrated Security=SSPI;MultipleActiveResultSets=true" 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-11-17T06:04:00.943

我在 Windows 窗体应用程序中使用我的 mdf 文件来解决这个问题，我只是重新启动我的计算机，我的问题就解决了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-03-24T16:19:44.773

只需转到 web.config 文件。将 'Connection String'="....../.../......?.......; User Instance= **True** '" 更改为 "....../. ../......?.......; 用户实例= **False** '"

是的，这可能会导致一些安全问题，但对于一些学校/学院的实际项目（我的情况），这可以运行您的项目。

**在**web.config中****从 User Instance=True 更改为 User Instance=False****

 ***** * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-07-10T12:37:52.313

我在使用 SqlLocalDB 和 SqlExpress 时遇到了这个问题。 **问题的原因：** 当我从 Visual Studio 连接到 localdb 时，会为其启动一个 LocalDB 实例并作为我们的 Windows 帐户运行。但是，当在 IIS 中作为“网络服务”或“AppPoolIdentity”运行的 Web 应用程序连接到 LocalDB 时，会为其启动另一个 LocalDB 实例并作为“网络服务”或“AppPoolIdentity”运行。因此，即使 Visual Studio 和 Web 应用程序都使用相同的 LocalDB 连接字符串，它们也会连接到不同的 LocalDB 实例。显然，在我们的 LocalDB 实例上从 Visual Studio 创建的数据库在 Web 应用程序的 LocalDB 实例中将不可用。 **解决方案：** 所以，在这里我列出了两种情况的解决方案（即）SqlExpress 和 LocalDB **如果我们使用 LocalDB 作为数据源：**

1.  将应用程序池标识设置为“网络服务”
2.  更新**applicationHost.config**文件以包含以下突出显示的设置：

*<processModel identityType="NetworkService" **loadUserProfile="true" setProfileEnvironment="true"** />*

3.  通过在管理员模式下在 CMD.exe 中运行以下命令将 SqlLocalDB 更改为共享实例 *SqlLocalDB.exe share "MyLocalDB" "MySharedLocalDB"*

*（这里“MyLocalDB”是我的本地数据库实例。您可以通过在管理员模式SqlLocalDB.exe*中的 CMD.exe 中执行以下命令来找到相同的 ）因此，我的连接字符串如下： <add name="DefaultConnection" connectionString= "**数据源=(localdb)\.\MySharedLocalDB** ;AttachDbFilename=|DataDirectory|\aspnet-DemoSite-20200716010415.mdf;初始目录=aspnet-DemoSite-20200716010415;用户ID=sa;密码=welcome123;**用户实例=false** ”

4.  由于我在 IIS 中托管应用程序，因此我确保帐户*“NT AUTHORITY\NETWORK SERVICE”*具有对应用程序根文件夹的读/写访问权限以避免“访问被拒绝”异常，并启用该帐户作为系统管理员通过执行访问 SqlInstance下面的 SQL 查询 *exec sp_addsrvrolemember 'NT AUTHORITY\NETWORK SERVICE', sysadmin*

**如果我们使用 SqlExpress 作为数据源：**

1.确保连接字符串具有正确的值，如下所示： <add name="DefaultConnection" connectionString=" **Data Source=.\SQLEXPRESS** ;AttachDbFilename=|DataDirectory|\aspnet-DemoSite-20200716010415.mdf;Initial Catalog=aspnet- DemoSite-20200716010415;User ID=sa;Password=welcome123;User Instance=false" 2.如上图所示，删除位于 C:\Users<userName>\AppData\Local\Microsoft\Microsoft SQL Server Data\ 中的旧文件SQLEXPRESS

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2014-07-21T12:01:09.267

要解决此问题，请打开 SQL Server Management Studio Express。在查询编辑器中输入以下文本：

```
sp_configure 'user instances enabled', 1;
 RECONFIGURE 
```

运行。然后重新启动 SQL Server 数据库。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2008-11-11T17:17:22.937

您是否尝试过使用 SQL Management Studio 连接到 SQL Server 实例？

如果这也不允许您连接，则可能是因为 SQL 服务未正确启动。

通过检查控制面板中的服务来验证服务是否正在运行。

# java - JPA 映射接口

> ID：281503
> 
> 赞同：4
> 
> 时间：2008-11-11T17:09:43.623
> 
> 标签：java, hibernate, orm, jpa, interface

当 List 类型是接口时，我无法创建映射。看起来我需要创建一个抽象类并使用鉴别器列是这种情况吗？我宁愿不必，因为抽象类只包含一个抽象方法，我宁愿只保留接口。

我有一个界面让我们称之为 Account

```
public interface Account {
 public void doStuff();
} 
```

现在我有 Account OverSeasAccount 和 OverDrawnAccount 的两个具体实现者

```
public class OverSeasAccount implements Account {
 public void doStuff() {
   //do overseas type stuff
 }
} 
```

和

```
public class OverDrawnAccount implements Account {
 public void doStuff() {
   //do overDrawn type stuff
 }
} 
```

我有一个名为 Work with a List 的课程

```
private List<Account> accounts; 
```

我正在查看鉴别器字段，但我似乎只能对抽象类执行此操作。是这样吗？任何指针表示赞赏。我可以对接口使用鉴别器吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T01:07:38.273

我认为可以使接口成为映射的超类型。但是，您可能无法使用注释。注释可以很好地与 xml 配置文件配合使用，因此您可能必须使用您需要的映射将休眠配置文件添加到您的项目中。但是您将能够为项目的其余部分保留注释。

[本期](http://opensource.atlassian.com/projects/hibernate/browse/ANN-9)对此进行了更多讨论。它似乎以关于如何使用注释来完成它的建议结束，所以谁知道。我建议 xml 现在仍然更安全 This [page](http://www.hibernate.org/hib_docs/v3/reference/en/html_single/#inheritance-tableperclass) of the docs解释了所需的 xml 映射。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T19:28:42.733

您还可以在不删除接口的情况下引入抽象类。

```
// not an entity
public interface Account {
    public void doStuff();
}

@Entity
public abstract class BaseAccount {
    public void doStuff();
}

@Entity
public class OverSeasAccount extends AbstractAccount {
    public void doStuff() { ... }
}

@Entity
public class OverDrawnAccount extends AbstractAccount {
    public void doStuff() { ... }
} 
```

# .net - Silverlight 2 的服务器要求是什么？

> ID：281507
> 
> 赞同：2
> 
> 时间：2008-11-11T17:10:38.767
> 
> 标签：.net, apache, iis-6, silverlight-2.0

可以从 Apache 服务器管理启用 Silverlight 2 的网页吗？（我实际上对这样做并不感兴趣，但试图更多地了解 Silverlight 2。）

假设我有 IIS6 和 Server 2003，使用 Silverlight 2 托管网站的 .NET 版本要求是什么？服务器上是否需要 .NET 3.0 和 3.5？我的想法不是因为这是一种客户端技术。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T17:14:38.260

由于 Silverlight 是一种浏览器技术，它与**服务器无关**，可以托管在各种服务器平台上：LAMP、UNIX 和 IIS。您不必在服务器上安装 .NET 或任何其他 Microsoft 软件。

Web 服务器上唯一需要的配置是**为所服务的内容注册 MIME 类型**。如果尚未注册，则必须添加以下条目。

需要三种 MIME 类型：

*   .xaml - 应用程序/xaml+xml
*   .xap - 应用程序/x-silverlight-app
*   .xbap - 应用程序/x-ms-xbap

以下是一些说明[如何为 Apache 和 IIS 执行此](http://blogs.technet.com/jorke/archive/2007/09/11/silverlight-mime-types-in-iis6.aspx)操作。

不用说，[WMS Streaming](http://blogs.msdn.com/jitghosh/archive/2007/11/30/demo-live-streams-in-silverlight.aspx)等一些功能依赖于支持它们的服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T17:21:49.230

除了 mime 类型之外，不应该依赖于特定的服务器技术。

对于较新的 IIS 版本，mime 类型已被更多锁定，因此您需要为 .rar 文件添加一个条目（示例）。服务器管理员可能会自定义 mime 配置并阻止正确下载 .xap 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T17:13:04.770

下面列出[了 Microsoft Silverlight 和相关技术的系统要求。](http://www.microsoft.com/silverlight/overview/faq.aspx#sys-req)

```
* Windows
      o Operating System: Windows Vista; Windows XP Service Pack 2
      o Intel® Pentium® III 450MHz or faster processor (or equivalent)
      o 128MB of RAM
* Mac OS
      o Operating System: Apple Mac OS X 10.4.8 or above
      o Intel Core™ Duo 1.83GHz or faster processor
      o 128MB of RAM
* Linux. For the system requirements, please refer to the Mono Project's Moonlight Web site. 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T17:17:58.630

如果您的服务器可以提供 XAP 文件，则应该知道在您想要的任何服务器中托管 Silverlight 都会出现问题。Silverlight 是一种客户端技术。您的服务器只是将它发送到浏览器，然后由客户端来处理它。

# visual-studio - Visual Studio 变量声明

> ID：281510
> 
> 赞同：6
> 
> 时间：2008-11-11T17:11:09.283
> 
> 标签：visual-studio

我有一个项目，在附加包含部分中有以下行：

"$(SOMEPATH_SHORTNAME)\包括"

有人可以告诉我在哪里可以找到定义的 $(SOMEPATH) 吗？我无法通过简单地在 Visual Studio 中搜索来找到它

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T17:24:50.127

如果它不是环境变量，那么要看的地方是宏。在属性表中，单击“Addition Include Directories”行旁边的 (...) 按钮，然后在弹出的对话框中展开“Macros>>”按钮。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T17:12:10.963

检查您的环境变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T17:58:16.923

*   右键单击我的电脑，然后单击属性。
*   单击高级选项卡。
*   单击环境变量。
*   为用户或系统变量单击以下选项之一：
*   单击新建以添加新的变量名称和值。
*   单击现有变量，然后单击编辑以更改其名称或值。

# java - 使用 Java ImageIO 进行 Tiff 压缩

> ID：281512
> 
> 赞同：7
> 
> 时间：2008-11-11T17:11:11.887
> 
> 标签：java, image, compression, tiff, javax.imageio

我在将 png 转换为 tiff 时遇到问题。转换很顺利，但图像很大。我认为问题是我没有正确压缩？有人有什么建议吗？？

这是代码示例

```
public static void test() throws IOException {

    // String fileName = "4958813_1";
    String fileName = "4848970_1";
    String inFileType = ".PNG";
    String outFileType = ".TIFF";

    ImageIO.scanForPlugins();

    File fInputFile = new File("I:/HPF/UU/" + fileName + inFileType);
    InputStream fis = new BufferedInputStream(new FileInputStream(
            fInputFile));
    PNGImageReaderSpi spi = new PNGImageReaderSpi();
    ImageReader reader = spi.createReaderInstance();

    ImageInputStream iis = ImageIO.createImageInputStream(fis);
    reader.setInput(iis, true);
    BufferedImage bi = reader.read(0);

    TIFFImageWriterSpi tiffspi = new TIFFImageWriterSpi();
    ImageWriter writer = tiffspi.createWriterInstance();
    //Iterator<ImageWriter> iter =  ImageIO.getImageWritersByFormatName("TIFF");
    //ImageWriter writer = iter.next();

    ImageWriteParam param = writer.getDefaultWriteParam();
    param.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);

    param.setCompressionType("LZW");
    param.setCompressionQuality(0.5f);
    File fOutputFile = new File("I:\\HPF\\UU\\" + fileName + outFileType);
    ImageOutputStream ios = ImageIO.createImageOutputStream(fOutputFile);
    writer.setOutput(ios);
    writer.write(bi);

} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-11T17:45:56.093

`Writer.getDefaultWriteParam()`只创建一个`ImageWriteParam`对象，它不会将它链接回其他任何东西。

我在您的代码中没有看到任何机制可以让您修改的`param`对象随后在`ImageWriter`.

我相信，而不是：

```
writer.write(bi); 
```

你需要使用：

```
writer.write(null, new IIOImage(bi, null, null), param); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T17:44:31.977

我不知道Java IO，但一般你想看看一些东西

1.  你能用JPEG压缩代替LZW吗？
2.  了解如何设置 TIFF 条带大小 - 如果您想要小尺寸，请将其设置为图像的高度。

编辑：看起来 TiffWriteParam 有以下方法

```
tiffWriteParam.setTilingMode(ImageWriteParam.MODE_EXPLICIT);
tiffWriteParam.setTiling(imageWidth, imageHeight, 0, 0); 
```

将 imageWidth 和 imageHeight 变量设置为图像的大小。缺点是读取图像区域会更慢。

# ios - 如何自定义 UITableViewCell 的背景颜色？

> ID：281515
> 
> 赞同：190
> 
> 时间：2008-11-11T17:11:51.387
> 
> 标签：ios, iphone, uitableview, cocoa-touch, background-color

我想自定义 UITableView 中所有 UITableViewCells 的背景（也可能还有边框）。到目前为止，我还无法自定义这些东西，所以我有一堆默认的白色背景单元格。

有没有办法用 iPhone SDK 做到这一点？

* * *

## 回答 #1

> 赞同：205
> 
> 时间：2009-08-03T07:02:43.847

这是我遇到的解决此问题的最有效方法，使用 willDisplayCell 委托方法（这在使用 cell.textLabel.text 和/或 cell.detailTextLabel.text 时也会处理文本标签背景的白色):

```
- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath { ... } 
```

当调用此委托方法时，单元格的颜色是通过单元格而不是表格视图控制的，就像您使用时一样：

```
- (UITableViewCell *) tableView: (UITableView *) tableView cellForRowAtIndexPath: (NSIndexPath *) indexPath { ... } 
```

因此，在单元格委托方法的主体中，将以下代码添加到单元格的交替颜色中，或者仅使用函数调用使表格的所有单元格具有相同的颜色。

```
if (indexPath.row % 2)
{
    [cell setBackgroundColor:[UIColor colorWithRed:.8 green:.8 blue:1 alpha:1]];
}
else [cell setBackgroundColor:[UIColor clearColor]]; 
```

这个解决方案在我的情况下效果很好......

* * *

## 回答 #2

> 赞同：195
> 
> 时间：2008-11-11T18:13:50.870

您需要将单元格的 contentView 的 backgroundColor 设置为您的颜色。如果您使用配件（例如披露箭头等），它们将显示为白色，因此您可能需要滚动这些配件的自定义版本。

* * *

## 回答 #3

> 赞同：105
> 
> 时间：2010-05-10T13:57:15.683

这真的很简单，因为 OS 3.0 只是在 willDisplayCell 方法中设置单元格的背景颜色。不得在 cellForRowAtIndexPath 中设置颜色。

这适用于普通样式和分组样式：

代码：

```
- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath {
    cell.backgroundColor = [UIColor redColor];
} 
```

PS：这里是 willDisplayCell 的文档摘录：

> “表格视图在使用单元格绘制行之前将此消息发送给其委托人，从而允许委托人在显示单元格对象之前对其进行自定义。此方法使委托人有机会覆盖之前设置的基于状态的属性表视图，例如选择和背景颜色。委托返回后，表视图仅设置 alpha 和 frame 属性，然后仅在行滑入或滑出时设置动画行。

我在[colionel 的这篇文章](http://www.iphonedevsdk.com/forum/iphone-sdk-development/4999-uitableviewcell-backgroundcolor.html#post132632)中找到了这些信息。谢谢他！

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2008-11-14T14:31:09.223

到目前为止我发现的最好的方法是设置单元格的背景视图和单元格子视图的清晰背景。当然，这在只有索引样式的桌子上看起来不错，无论是否有配件。

这是一个单元格背景为黄色的示例：

```
UIView *backgroundView = [ [ [ UIView alloc ] initWithFrame:CGRectZero ] autorelease ];
backgroundView.backgroundColor = [ UIColor yellowColor ];
cell.backgroundView = backgroundView;
for ( UIView *view in cell.contentView.subviews ) 
{
    view.backgroundColor = [ UIColor clearColor ];
} 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2010-04-17T10:03:54.503

只需将其放入 UITableView 委托类文件 (.m) 中：

```
- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell  forRowAtIndexPath:(NSIndexPath *)indexPath 
{
    UIColor *color = ((indexPath.row % 2) == 0) ? [UIColor colorWithRed:255.0/255 green:255.0/255 blue:145.0/255 alpha:1] : [UIColor clearColor];
    cell.backgroundColor = color;
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-12-06T15:01:42.257

我同意 Seba，我尝试在 rowForIndexPath 委托方法中设置交替行颜色，但在 3.2 和 4.2 之间得到不一致的结果。以下对我很有用。

```
- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath {

    if ((indexPath.row % 2) == 1) {
        cell.backgroundColor = UIColorFromRGB(0xEDEDED);
        cell.textLabel.backgroundColor = UIColorFromRGB(0xEDEDED);
        cell.selectionStyle = UITableViewCellSelectionStyleGray;
    }
    else
    {
        cell.backgroundColor = [UIColor whiteColor];
        cell.selectionStyle = UITableViewCellSelectionStyleGray;
    }

} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-06-08T09:43:24.427

在尝试了所有不同的解决方案之后，以下方法是最优雅的一种。在以下委托方法中更改颜色：

```
- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath {
    if (...){
        cell.backgroundColor = [UIColor blueColor];
    } else {
        cell.backgroundColor = [UIColor whiteColor];
    }
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-03-04T06:10:13.607

vlado.grigorov 有一些很好的建议 - 最好的方法是创建一个 backgroundView，并给它一个颜色，将其他所有内容设置为 clearColor。另外，我认为这种方式是正确清除颜色的唯一方法（尝试他的示例 - 但设置'clearColor'而不是'yellowColor'），这就是我想要做的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-11T21:32:17.057

自定义表格视图单元格的背景最终成为“全有或全无”的方法。很难以一种看起来不奇怪的方式更改用于内容单元格背景的颜色或图像。

原因是单元格实际上跨越了视图的宽度。圆角只是其绘图风格的一部分，内容视图位于该区域。

如果您更改内容单元格的颜色，您最终会在角落看到白色位。如果您更改整个单元格的颜色，您将有一个跨越视图宽度的颜色块。

您绝对可以自定义一个单元格，但它并不像您最初想象的那么容易。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-09-28T10:32:34.210

创建一个视图并将其设置为单元格的背景视图

```
UIView *lab = [[UIView alloc] initWithFrame:cell.frame];
            [lab setBackgroundColor:[UIColor grayColor]];
            cell.backgroundView = lab;
            [lab release]; 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-02-02T01:08:11.230

扩展 N.Berendt 的回答 - 如果您想根据实际单元格数据对象中的某些状态设置单元格颜色，则在您配置表格单元格的其余信息时，通常是在您处于cellForRowAtIndexPath 方法，您可以通过重写 willDisplayCell 方法来从内容视图背景颜色设置单元格背景颜色来做到这一点 - 这解决了披露按钮背景等问题不正确但仍然允许您控制 cellForRowAtIndexPath 方法中的颜色您正在执行所有其他单元格定制的地方。

所以：如果您将此方法添加到您的表视图委托：

```
- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath {
    cell.backgroundColor = cell.contentView.backgroundColor;
} 
```

然后在您的 cellForRowAtIndexPath 方法中，您可以执行以下操作：

```
if (myCellDataObject.hasSomeStateThatMeansItShouldShowAsBlue) {
    cell.contentView.backgroundColor = [UIColor blueColor];
} 
```

这省去了在 willDisplayCell 方法中再次检索数据对象的麻烦，还省去了对表格单元格进行剪裁/定制的两个地方——所有定制都可以在 cellForRowAtIndexPath 方法中进行。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-02-25T21:12:15.987

使用 Photoshop 或 gimp 创建一个用作背景的图像，并将其命名为 myimage。然后，将此方法添加到您的 tableViewController 类：

```
- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath {
    UIImage *cellImage = [UIImage imageNamed:@"myimage.png"];//myimage is a 20x50 px with  gradient  color created with gimp
    UIImageView *cellView = [[UIImageView alloc] initWithImage:cellImage];
    cellView.contentMode = UIContentViewModeScaleToFill;
    cell.backgroundView = cellView;
    //set the background label to clear
    cell.titleLabel.backgroundColor= [UIColor clearColor];
} 
```

如果您在属性检查器中将 UITableView 设置为自定义，这也将起作用。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-02-07T13:56:27.010

我的解决方案是将以下代码添加到 cellForRowAtIndexPath 事件中：

```
UIView *solidColor = [cell viewWithTag:100];
if (!solidColor) {

    solidColor = [[UIView alloc] initWithFrame:cell.bounds];
    solidColor.tag = 100; //Big tag to access the view afterwards
    [cell addSubview:solidColor];
    [cell sendSubviewToBack:solidColor];
    [solidColor release];
}
solidColor.backgroundColor = [UIColor colorWithRed:254.0/255.0
                                             green:233.0/255.0
                                              blue:233.0/255.0
                                             alpha:1.0]; 
```

在任何情况下都可以工作，即使使用披露按钮，并且我认为在 cellForRowAtIndexPath 中对单元格颜色状态进行操作的逻辑比在 cellWillShow 事件中更好。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-12-06T21:32:56.540

子类 UITableViewCell 并将其添加到实现中：

```
-(void)layoutSubviews
{
    [super layoutSubviews];
    self.backgroundColor = [UIColor blueColor];
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-04-04T08:55:05.163

```
 UIView *bg = [[UIView alloc] initWithFrame:cell.frame];
    bg.backgroundColor = [UIColor colorWithRed:175.0/255.0 green:220.0/255.0 blue:186.0/255.0 alpha:1]; 
    cell.backgroundView = bg;
    [bg release]; 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-04-20T07:15:40.913

这将适用于最新的 Xcode。

```
-(UITableViewCell *) tableView: (UITableView *) tableView cellForRowAtIndexPath: (NSIndexPath *) indexPath {
    cell.backgroundColor = [UIColor grayColor];
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-10-19T05:08:52.660

试试这个：

```
- (void)tableView:(UITableView *)tableView1 willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath
{
    [cell setBackgroundColor:[UIColor clearColor]];
    tableView1.backgroundColor = [UIColor colorWithPatternImage: [UIImage imageNamed: @"Cream.jpg"]];
} 
```

# c# - 无法连接到移动设备

> ID：281521
> 
> 赞同：1
> 
> 时间：2008-11-11T17:14:10.477
> 
> 标签：c#, visual-studio-2008, windows-vista, mobile

我一直在为 PSION Teklogix 的第二代 Workabout Pro 开发应用程序。

最近我的公司进行了重新升级：操作系统和 Visual Studio 版本，所以我坚持使用 Windows Vista（和 Visual Studio 2008）。

我连接了我一直用于开发的同一个 Workabout Pro 设备，我无法在 Vista 上安装 ActiveSync，但移动同步中心也无法识别该设备。最重要的是，在尝试部署项目进行测试时，Visual Studio 告诉我“连接到设备失败”。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T17:23:17.603

我以前用过这些单位。SDK Psion 提供 PtxPxa27x: ARMV4I 仿真映像，以帮助部署/连接到他们的设备。

无论如何，我都会给 Psion 支持人员打个电话（如果你有的话），看看他们能做些什么来帮助你将它连接到 Vista 上的 Visual Studio。如果您没有 Psion 支持，如果您找不到其他解决方案，我可能会为您提供帮助，因为我可以联系一些 Psion 支持代表。

为什么不能在 Vista 上安装 ActiveSync？

编辑：没关系，我只是查了一下。移动同步中心管理这个......呃。:)

快速进行一些研究，我看到[了这一点](http://www.microsoft.com/windowsmobile/en-us/help/synchronize/device-center.mspx)：

*使您能够使用 Windows Mobile 驱动的设备（Windows Mobile 2003 或更高版本）建立新的合作伙伴关系、同步内容并管理音乐、图片和视频。*

*对于 Windows Embedded CE 4.2、5.0、Pocket PC 2002 和 Smartphone 2002 设备，基本连接支持包括通过 USB 和串行连接、通过 PC 的 Internet 连接使用桌面直通和文件浏览。*

在我看来，如果您使用的是 CE 4.2/5.0，那可能是 Psion ROM 问题。找到了一些带有一些[建议](http://www.pocketpcfaq.com/faqs/wmdc/t-shoot-wmdc.htm)的链接。

# sql-server - SQL Server 中的慢 DELETE 语句需要帮助读取执行计划和修复

> ID：281526
> 
> 赞同：4
> 
> 时间：2008-11-11T17:15:28.133
> 
> 标签：sql-server

我有一个删除语句，它违反了我的一个核心应用程序表。删除语句正在使用表的主键，但仍需要大约 30 秒。据我所知，执行计划需要在其他表中进行大约 12 次检查，其中该表是 FK，然后再执行删除。我需要帮助阅读和理解这个执行计划，才能真正知道我可以做些什么来解决缓慢的问题。我猜一些索引搜索或聚集索引扫描需要调整。

```
文本
---------------------------------------------
从 CleanId = 17526195 的 Clean 中删除

（1 行受影响）

文本
--------
|--Assert(WHERE:(CASE WHEN [Expr1042] 为 NULL THEN (0) ELSE CASE WHEN [Expr1043] 为 NULL THEN (1) ELSE CASE WHEN [Expr1044] 为 NULL THEN (2) ELSE CASE WHEN NOT [Expr1045] IS NULL THEN (3) ELSE CASE WHEN NOT [Expr1046] IS NULL THEN (4) ELSE CA
       |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1053] = [PROBE VALUE]））
            |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1052] = [PROBE VALUE]））
            | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1051] = [PROBE VALUE]））
            | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1050] = [PROBE VALUE]））
            | | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1049] = [PROBE VALUE]））
            | | | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1048] = [PROBE VALUE]））
            | | | | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1047] = [PROBE VALUE]））
            | | | | | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1046] = [PROBE VALUE]））
            | | | | | | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1045] = [PROBE VALUE]））
            | | | | | | | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1044] = [PROBE VALUE]））
            | | | | | | | | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1043] = [PROBE VALUE]））
            | | | | | | | | | | |--嵌套循环（左半连接，外部引用：（[TcaNetMigrated].[dbo].[Clean].[CleanId]），定义：（[Expr1042] = [PROBE VALUE]））
            | | | | | | | | | | | |-- 聚集索引删除(OBJECT:([TcaNetMigrated].[dbo].[Clean].[PK_Clean]), OBJECT:([TcaNetMigrated].[dbo].[Clean].[_IX_Clean_CustomerID_CleanID]), OBJECT:( [TcaNetMigrated].[dbo].[Clean]。
            | | | | | | | | | | | |--Index Seek(OBJECT:([TcaNetMigrated].[dbo].[Breakage].[IX_UniqueCleanId]), SEEK:([TcaNetMigrated].[dbo].[Breakage].[CleanId]=[TcaNetMigrated].[ dbo].[Clean].[CleanId]) 已订购）
            | | | | | | | | | | |--Index Seek(OBJECT:([TcaNetMigrated].[dbo].[Cancellation].[IX_UniqueCleanId]), SEEK:([TcaNetMigrated].[dbo].[Cancellation].[CleanId]=[TcaNetMigrated].[ dbo].[Clean].[CleanId]) 已订购）
            | | | | | | | | | |-- 聚集索引 Seek(OBJECT:([TcaNetMigrated].[dbo].[CleanEmployee].[PK_CleanEmployee]), SEEK:([TcaNetMigrated].[dbo].[CleanEmployee].[CleanId]=[TcaNetMigrated]. [dbo].[Clean].[CleanId]) 订购 FO
            | | | | | | | | |--Index Seek(OBJECT:([TcaNetMigrated].[dbo].[CleanTransaction].[IX_UniqueCleanId]), SEEK:([TcaNetMigrated].[dbo].[CleanTransaction].[CleanId]=[TcaNetMigrated].[ dbo].[Clean].[CleanId]) 已订购）
            | | | | | | | |--Index Seek(OBJECT:([TcaNetMigrated].[dbo].[Complaint].[IX_UniqueCleanId]), SEEK:([TcaNetMigrated].[dbo].[Complaint].[CleanId]=[TcaNetMigrated].[ dbo].[Clean].[CleanId]) 已订购）
            | | | | | | |--Index Seek(OBJECT:([TcaNetMigrated].[dbo].[Complaint].[IX_Complaint_RedoCleanId]), SEEK:([TcaNetMigrated].[dbo].[Complaint].[RedoCleanId]=[TcaNetMigrated].[ dbo].[Clean].[CleanId]) 已订购）
            | | | | | |--Index Seek(OBJECT:([TcaNetMigrated].[dbo].[GreatJob].[IX_UniqueCleanId]), SEEK:([TcaNetMigrated].[dbo].[GreatJob].[CleanId]=[TcaNetMigrated].[ dbo].[Clean].[CleanId]) 已订购）
            | | | | |--Index Seek(OBJECT:([TcaNetMigrated].[dbo].[Inspection].[IX_Inspection_CleanId_InspectionId]), SEEK:([TcaNetMigrated].[dbo].[Inspection].[CleanId]=[TcaNetMigrated].[ dbo].[Clean].[CleanId]) 已订购）
            | | | |-- 聚集索引扫描(OBJECT:([TcaNetMigrated].[dbo].[FranchiseCall].[PK_FranchiseCalls]), WHERE:([TcaNetMigrated].[dbo].[FranchiseCall].[CleanId]=[TcaNetMigrated]。 [dbo].[Clean].[CleanId]))
            | | |-- 聚集索引扫描(OBJECT:([TcaNetMigrated].[dbo].[IVRLog].[PK_IVRLog]), WHERE:([TcaNetMigrated].[dbo].[IVRLog].[CleanId]=[TcaNetMigrated]. [dbo].[Clean].[CleanId]))
            | |--Index Seek(OBJECT:([TcaNetMigrated].[dbo].[Lockout].[IX_UniqueCleanId]), SEEK:([TcaNetMigrated].[dbo].[Lockout].[CleanId]=[TcaNetMigrated].[ dbo].[Clean].[CleanId]) 已订购）
            |-- 聚集索引扫描(OBJECT:([TcaNetMigrated].[dbo].[ManualUpdateTime].[PK_ManualUpdateTimes]), WHERE:([TcaNetMigrated].[dbo].[ManualUpdateTime].[CleanId]=[TcaNetMigrated]。 [dbo].[Clean].[CleanId]))

（26 行受影响）

```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T17:28:49.760

确保您在其他表中的 FK 上有索引。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T17:26:51.560

在执行计划中，哪一步占用了大部分时间？您还可以使用“Set Statistics IO ON”重新运行删除，并查看哪个表/索引具有最高的逻辑读取。这两位数据将有助于提示您需要注意哪些地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T17:27:56.783

您确定此表或其他从属表之一上没有触发器吗？

# virtualization - 对虚拟硬盘 (.vhd) 进行碎片整理？

> ID：281527
> 
> 赞同：10
> 
> 时间：2008-11-11T17:15:55.810
> 
> 标签：virtualization, virtual-pc, vhd

与任何其他硬盘一样，虚拟硬盘 (*.vhd) 也会出现碎片。

因此，为了保持良好的性能，我想我必须首先对虚拟机中的虚拟硬盘以及存储 .vhd 的（物理）硬盘进行碎片整理。

首先，这些假设是否正确？其次，有没有办法同时对（虚拟和物理硬盘）进行碎片整理？

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T23:12:16.963

我一直在使用的另一个选项是使用免费的[JkDefrag](http://www.kessels.com/Jkdefrag/)。对虚拟 PC 进行碎片整理也有一个完整的过程，但是由于我在 JkDefrag 论坛中找不到“官方”链接，因此对于命令行参数它是这样的：

1.  从虚拟机中对来宾驱动器进行碎片整理。
2.  退出虚拟机。
3.  在主机上，使用这些命令行运行 JkDefrag

（您也可以将它们放在批处理文件中）：

```
jkDefrag -q -a2
jkDefrag -q -a6 C:\PathToVirtualDisks\VDiskToDefrag.vhd
jkDefrag -q -a3 -e C:\PathToVirtualDisks\VDiskToDefrag.vhd 
```

以下是参数的作用：

*   `-q`= 完成后退出程序。
*   `-a2`= 碎片整理，不要优化。
*   `-a6`= 移动到磁盘末尾
*   `-a3`= 碎片整理，快速优化。

该过程可能需要很长时间，具体取决于虚拟磁盘的大小。*例如，在我的带有 56GB 虚拟磁盘的 PC 上，在非常*碎片化的日子里完成这个过程大约需要 16-18 小时。事实上，在我写这篇文章时，我对该文件的 150 多个片段进行了碎片整理，它已经运行了大约 30 分钟，仅使用该文件只完成了大约 10%。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T17:24:48.660

对客人进行碎片整理，然后对主机进行碎片整理。您可以使用[CONTIG 之](http://technet.microsoft.com/en-us/sysinternals/bb897428.aspx)类的实用程序仅对主机上的 vhd 文件进行碎片整理。

我不相信您可以同时对两者进行碎片整理，因为可能无法使用 vhd 文件来对其进行碎片整理，因此需要关闭 VM。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T17:20:47.157

是的，你的假设是正确的。碎片整理的正确方法是先在客户机内部进行碎片整理，然后是客户机硬盘文件，然后是主机硬盘。根据您使用的虚拟机，它应该为您提供选项。VMWare 为您提供了对来宾硬盘进行碎片整理的选项。

# php - 如何阻止 PHP 输出缓冲区超出内存限制？

> ID：281531
> 
> 赞同：2
> 
> 时间：2008-11-11T17:17:39.223
> 
> 标签：php, memory

我的大多数 PHP 应用程序在开头都有一个 ob_start，运行所有代码，然后在所有内容完成后输出内容，有时会进行一些修改。

```
ob_start()
//Business Logic, etc
header->output();
echo apply_post_filter(ob_get_clean());
footer->output(); 
```

这可确保 PHP 错误显示在网站的内容部分中，并且错误不会干扰`header`和`session_*`调用。

我唯一的问题是，对于一些大页面，PHP 内存不足。我该如何阻止这种情况发生？

一些想法：

1.  将所有缓冲内容写入临时文件并输出。
2.  当缓冲区达到一定大小时，输出它。尽管这可能会干扰后置过滤器。
3.  提高内存限制（thanx @troelskn）。

这些方法的缺点是什么？特别是提高内存限制？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T17:45:29.900

你不能提高内存限制吗？听起来对我来说是最好的解决方案。

编辑：显然，仅仅因为脚本达到上限就提高内存限制应该引发一些危险信号，但在我看来这是一个合法的案例 - 例如。该脚本实际上产生了相当大的输出块。因此，您必须将输出存储在*某处*，并且出于性能和方便的原因，内存似乎是最佳选择。

我还应该注意，内存限制设置就是这样 - 一个限制。不消耗太多内存的脚本不会因为你提高限制而消耗更多。它存在的主要原因是防止行为不端/错误的脚本关闭整个服务器。如果您有很多业余爱好者在共享主机上进行黑客攻击，这一点很重要（PHP 已被大量使用）。因此，如果这是您自己的服务器，或者至少您通常知道自己在做什么，那么内存限制低并没有任何好处。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T17:54:56.027

您应该在任何事情之前提高内存限制，特别是如果您唯一的其他解决方案是通过临时文件。

使用临时文件有各种缺点（主要是速度较慢），如果您确实需要在输出之前存储缓冲区的方法，请查找[memcached](http://ca3.php.net/manual/en/book.memcache.php)或[APC 缓存](http://ca3.php.net/manual/en/book.apc.php)。这将使您可以执行与文件大致相同的操作，只是您可以快速访问 RAM。

不过，我必须说这总体上是一个糟糕的主意。如果缓冲区当前无法正常工作，您可能可以构建一些不同的东西以使您的网站更好地工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T18:22:20.840

如果 php 错误是缓冲输出的唯一原因，请考虑使用 set_error_handler。使用此函数，您可以为脚本中的错误定义自定义回调。使用它将消息保存在某处并稍后打印。

[http://www.php.net/set_error_handler](http://www.php.net/set_error_handler)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-03-19T16:50:21.773

我的建议是尝试分阶段加载文件，或者将其分成更小的部分以包含在内。你如何做到这一点在很大程度上取决于文件是什么，但它可以让你加载它，比如说...... 2mb 块，如果它没有产生任何错误，那么你`ob_flush()`可以在加载下一个块之前发送它。

例如，您提到它是一个 PHP 模板；我不确定那到底是什么，如果您谈论的是混合的 PHP/HTML 文件，该文件在执行时会产生输出，那么您可以尝试在模板中添加某种形式的块标记来分隔模板的不同部分. 这样你只需要读到当前块的末尾，然后输出它并继续。如果您有循环等，这会变得更加困难，但通常总有一种方法可以解决它。例如，通过将 PHP 添加到模板中，从而触发主脚本中的方法/函数，该方法/函数可以分阶段处理循环输出。

您可能还想查看一种在加载模板之前预先验证模板的机制，因此您根本不必担心错误会蔓延到页面中。

虽然更改内存限制会在短期内“解决”问题，但它不是长期解决方案，因为如果可能的话，肯定要避免这种内存使用。一般来说，如果可以避免的话，你根本不想将任何大的东西加载到内存中，或者尽早将其吐出，因为这意味着数据至少正在发送给用户的途中，从而减少了首次使用的时间页的字节。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T09:23:44.967

为了让您因输出而耗尽内存，您必须有大量数据流出或内存限制非常低。大约 4 年前，8mb 的内存限制已经足够普遍且合理。但是随着切换到使用对象和更好的编码风格，我遇到的脚本的内存使用量有所增加。

嗯...您的脚本在哪里耗尽了内存？如果它总是在您的输出过滤功能中，也许它们只需要优化？[memory_get_usage()](http://www.php.net/memory_get_usage)将返回您的脚本在该点使用的内存量。

您正在运行的当前内存限制是多少？您是否在共享环境中运行？目前我的内存限制在 64 到 128 之间，具体取决于服务器。

如果它只是您想要增加限制的特定脚本子集，那么您可以按脚本执行此操作：

```
ini_set('memory_limit','64M'); 
```

如果您希望脚本没有限制，可以将其设置为 -1

# vb.net - VB.NET 会丢弃 Access 数据库吗？

> ID：281534
> 
> 赞同：1
> 
> 时间：2008-11-11T17:18:10.873
> 
> 标签：vb.net, ms-access, drivers

在这里抓住稻草...我使用 VB6 桌面系统使用几个 2003 样式的 Access 数据库 (.MDB)。最近，我将第一个函数从 VB6 更改为 VB.NET，仍然使用 Access 数据库。这不仅仅是一种转换，而是一种具有附加功能的重写。它仍然是相当简单的功能，具有低容量的数据库。我们有 1400 家客户，都是机器质量各异的小型企业。大多数客户都对新屏幕和功能感到满意。这些客户中的极少数经历了加载 datagridview 的极度缓慢的情况。客户服务告诉我们 1) 机器至少有 1 GB 的 RAM，并且 2) 重新启动总能解决问题。

我写了一个应用程序来严重减慢我的机器，它对我来说仍然比为少数客户运行得更好。此外，我的 Access 数据库从未被此应用程序破坏。

有什么建议么？

谢谢！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T17:23:25.140

我们也有类似的经历，大多数情况是杀毒引起的。他们经常检查文件（每次访问文件时都会有一些反病毒）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T18:32:43.347

在更新访问数据库时重新启动可能会破坏它。

您需要更多信息，以便更好地了解正在发生的事情。他们需要在出现问题的工作站上为您收集一些信息。使用任务管理器，您可以让他们获得以下信息：

*   CPU 利用率
*   什么任务消耗cpu最多
*   XP 上的峰值（承诺）内存 - Vista 上没有等效内存
*   XP 上的总（已提交）内存 - Vista 上没有等值
*   XP 上的可用（物理）内存 - Vista 上免费（被 Superfetch 弄得一文不值）

也可以在 XP 和 Vista 上使用命令行工具“SYSTEMINFO”来获取总内存和可用内存。如果您的可用资源很少，并且在 XP 上，如果您的总提交量大于您的总物理量，那么您很可能是交换并且内存不足（或内存泄漏）导致您的速度变慢。

底线是您需要更多信息。可能是工作站上的另一个应用程序导致了问题。我们遇到过 Notes 5.0 出现问题，如果大部分窗口被另一个窗口覆盖，并且您收到了新邮件消息，Notes 上的 cpu 利用率达到 100%。这导致应用程序运行缓慢，除非您在工作站上查看任务监视器，否则您永远不会猜到是 Notes 导致了问题。问题总是在不同的程序（前台程序）中调用。Access 也可以在不同的模式下使用 100% cpu，即使它似乎没有做任何事情。

尽可能多地收集信息。您可能想编写一个 vbscript 或程序来为您收集一些信息，以便遇到问题的任何人都可以在重新启动之前运行它来收集信息。

执行以下操作的批处理文件将为您提供相当多的信息：

```
 @echo off
SystemInfo  >c:\systeminfo.log
tasklist /v >>c:\systeminfo.log 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T17:20:13.663

不，VB.Net 与 Access 配合得很好。SHARED 环境将丢弃访问。

由于重新启动解决了问题，我会检查您是否正确关闭了连接。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-11T17:22:21.583

对我来说听起来像是一个很大的内存泄漏。

一些客户会让您的应用程序运行的时间比其他客户更长，并且会受到更大的打击。

在有多个并发用户的情况下使用 Access 不可避免地会导致痛苦。

# mysql - ZRM 快照与 MySQL 的 InnoDB 热备份

> ID：281538
> 
> 赞同：1
> 
> 时间：2008-11-11T17:20:01.510
> 
> 标签：mysql, backup, restore

[InnoDB 热备份](https://web.archive.org/web/20090207080811/http://www.innodb.com:80/hot-backup/features/)与 ZRM[快照](https://www.zmanda.com/zrm-enterprise/)在运行站点中断、压缩备份文件的大小以及中型到大型全 InnoDB 数据库上的备份/恢复速度方面是否有主要优势？

我的理解是，InnoDB 的方法更可靠、更快、运行时不会造成重大中断等。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T18:43:27.753

我目前正在开始使用 ZRM 来备份只有 InnoDB 表的 MySql 服务器。根据我所读到的内容，使用 ZRM 快照根本不会对您的应用程序造成任何干扰。它不需要任何时间的读锁。

与 InnoDB Hot Backup b/c 相比，我无法评论压缩备份文件的大小或备份/恢复的速度我没有使用这两种产品。

此外，如果您在 Zmanda Network 上注册，您可以下载一些不错的白皮书。其中之一是一份基准测试文件，显示了使用 InnoDB 和 LVM 快照与 ZRM 可以执行的其他备份方法相比的备份/恢复速度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-28T10:49:44.887

如果您想避免站点中断，最好的方法是为您的服务器设置一个复制从属服务器，并从中进行备份。使用这个，备份的方法变得无关紧要，因为当复制完成时，从服务器将简单地赶上主服务器，并且不会中断主服务器的运行。

您还可以将您的应用程序设置为使用从属设备进行读取查询，以减少主设备的负载。

# iphone - 应用启动时如何快速切换状态栏背景样式？

> ID：281542
> 
> 赞同：8
> 
> 时间：2008-11-11T17:21:01.697
> 
> 标签：iphone, cocoa-touch

这可能有点难以以书面形式解释，所以请在这里耐心等待。

每当我想将状态栏的样式自定义为“深色”时，我只需将以下行添加到我的 AppDelegate 的`-applicationDidFinishLaunching:`方法中：

```
[application setStatusBarStyle:UIStatusBarStyleBlackOpaque]; 
```

这很好用，但是当应用程序启动时，将状态栏更改为这种深色样式会有明显的延迟。我可以理解，因为应用程序尚未完全启动。

但是，有一些应用程序知道一个技巧，可以在应用程序启动时立即以深色样式显示状态栏，并且没有明显的延迟。其中之一是Puzzlotto。

我怎样才能为自己的应用程序做同样的事情？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T18:07:16.487

您需要向 info.plist 添加一个密钥来处理此问题：

```
<key>UIStatusBarStyle</key>
<string>UIStatusBarStyleOpaqueBlack</string> 
```

# delphi - 什么会影响 Delphi 可执行文件的大小？

> ID：281548
> 
> 赞同：8
> 
> 时间：2008-11-11T17:22:25.297
> 
> 标签：delphi, delphi-7

我有完全相同的 delphi 版本、bpls、组件，一切。然而，在三台机器中，生成的可执行文件大小不同。还有什么可以影响 exe 的大小？

在我的机器中，我得到这个尺寸（Vista 6.0.6001）：

```
4.547.584 bytes 
```

在我同事的机器上，他得到（XP 5.1.2600 SP3）：

```
4.530.688 bytes 
```

在第三个大学里，他得到：（XP 5.1.2600 SP2）

```
4.527.104 bytes 
```

操作系统版本是否会影响已编译的 exe 大小？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T19:39:24.770

这似乎是配置差异，或者您在三台机器之间安装了不同版本的组件。我建议您在验证构建设置相同后创建一个空白表单并在所有 3 个表单上进行尝试。如果相同，则添加一些第 3 方组件，直到找到不同的组件。

此外，您可能有不同版本的 Delphi（主要或次要/更新版本）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-11T18:17:01.270

几乎可以肯定，这些差异来自机器之间不同的编译器设置。例如，打开或关闭 Range Checking 会稍微改变可执行文件的结果大小。

最新版本的 Delphi 的优点之一是使用了 MSBuild，它可以轻松确保任何给定构建的设置都是相同的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-10T05:28:45.050

嗯……

SizeOf(XPSP2.exe) < SizeOf(XPSP3.exe) < SizeOf(Vista.exe)

结论：

Windows版本越晚，随机插入的“填充物”越多，以增加可信度。如果它占用更多空间，那么它一定更强大，而且它可能是由世界上最好的工程师编写的！:-)（对不起——我在微软工作太久了！）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-11T17:31:22.877

对于 Delphi/BCB，有几个因素会影响大小：

**您的构建配置**：发布模式不会在调试部分链接到 EXE（默认情况下），因此更小。你也可以从代码优化中得到提升。

**与动态 RTL 链接**：如果启用，您的 EXE 会更小，但您需要外部库可用。

**使用运行时包构建**：如果启用，您将动态链接到您使用的运行时包，而不是将它们直接链接到您的 EXE。这可能导致最大的尺寸差异。

它们是其他因素，但以上往往是我遇到的主要因素。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-18T22:11:54.333

IIRC，在进行微小更改后重新编译也可能留下杂乱无章的东西 - 我猜是智能编译器的副作用之一：}

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-13T17:59:18.760

实际上，这是一个已经存在了很长一段时间的问题。看

[CodeGear 质量控制](http://qc.codegear.com/wc/qcmain.aspx?d=29538)

[Borland Delphi 新闻组](http://groups.google.dk/group/borland.public.delphi.winapi/browse_thread/thread/cd3b52072ea9edc9)

最近在[Delphi 新闻组](https://forums.codegear.com/thread.jspa?threadID=13609&tstart=0)（http 视图）上对此进行了讨论。

它与组件安装的差异或类似的东西完全无关；事实上，最后一个参考文献提到了与每次编译/构建时插入应用程序的时间戳有关的事情。此外，如果您正在构建并包含版本信息，并将构建号设置为自动增量，这也会导致二进制差异。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-13T17:46:27.030

实际上它比比有趣得多。

即使在同一台机器上连续多次重新构建相同的应用程序，在两次编译之间绝对不更改配置，也会产生大小略有不同的可执行文件。我构建了一个特定的项目 10 次并获得了 10 个（！）不同的可执行文件大小 - 每次都不同的大小！

不过，我注意到这种现象只发生在足够大/复杂的项目上。

如果您在一个相对简单的项目上执行此操作，则可执行文件的大小将相同，即使仍然存在内部差异（如果您进行二进制比较）。我现在没有时间调查这个，但我有点好奇。

请注意，仅仅进行编译，即实际上只是重新链接应用程序，不会改变生成的可执行文件的大小，但会改变其内容（生成的二进制文件并不相同）。

# java - FreeBSD 作为一个开发平台有多好？

> ID：281555
> 
> 赞同：22
> 
> 时间：2008-11-11T17:24:46.180
> 
> 标签：java, operating-system, freebsd, platform

我知道很多网络托管服务提供商都提供 FreeBSD，但 FreeBSD 作为开发平台有多好？

具体来说，Java 1.6 是否可用？对于 Linux 下不可用的工具，它是否提供了一些特定的东西？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-11T17:35:38.110

我一直认为 FreeBSD 是一个出色的安全托管环境，但可能不是最简单的开发平台。您将不得不进行一些研究才能启动并运行 Java 1.6，尽管我认为这是可行的。我希望你熟悉 emacs 或 vi。ports 系统可以让您访问许多软件，但它们必须从源代码编译。如果您熟悉标准的 Unix 命令行工具和命令行本身，那么您对 ​​FreeBSD 应该没有任何问题。

艾伦

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-23T07:34:43.413

您可以从[FreeBSD Foundation](http://freebsdfoundation.org/)获得 Java 的二进制发行版，他们为此与 Sun 签署了协议。来自 Java 的艺术，FreeBSD 是一个很棒的开发平台，包含您可能需要/想要的每种语言和环境。免责声明：我作为 FreeBSD 开发人员已经超过 13 年了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-23T07:55:08.207

撇开 Java 等实际问题不谈，真正的问题是你在**为**.

如果您正在编写丰富的桌面应用程序，那么您自然希望在最受用户欢迎的平台上进行开发——而且我很确定这不可能是 FreeBSD。

如果您正在开发 Web 应用程序，那么您希望您的开发**服务器**尽可能靠近您的生产托管环境。如果您要在 FreeBSD 上进行部署，那么在本地运行它可能也很有意义，至少在虚拟机中是这样。（当然，浏览器测试是一个不同的问题。）

请记住，虽然您可以在 BSD 上运行的所有开发工具也可以在 Linux 上使用，但事实并非如此，尤其是在 Linux 获得了更多的商业牵引力之后。

说了这么多，最好的方法是亲眼看看：尝试在 FreeBSD 上复制您的开发环境，无论它可能是什么。如果你成功了（而且你来自 Linux，呵呵），一旦你开始编码，你甚至不会关心你使用的是什么操作系统。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-11T17:46:58.790

FreeBSD 是一个非常棒的实时环境托管平台，但 Java 在很长一段时间内一直是它的眼中钉。但是，尽管安装并非易事，但似乎不再是这种情况。

您必须从 Sun 获取 JDK 源代码，然后从[http://www.eyesbeyond.com/freebsddom/java/jdk16.html](http://www.eyesbeyond.com/freebsddom/java/jdk16.html)应用 FreeBSD 补丁集，然后编译。

更多信息：[http ://www.freebsd.org/java/](http://www.freebsd.org/java/)

一旦你有了 JDK，运行 Eclipse 和其他 Java 应用程序应该会容易得多，但我不知道 FreeBSD 的 SWT ......有人吗？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-11T17:47:59.113

您可以在 Linux 仿真模式下运行本机 Java 1.6 端口或 Sun 的 Linux JDK，两者都在[端口树](http://www.freebsd.org/ports/)中可用。我曾经运行 Linux JDK（使用 Emacs JDEE）没有任何问题，但是你的里程可能会有所不同。

至于 IDE，Netbeans 和 Eclipse 在端口树中都可用。

我建议至少尝试一下，如果没有其他原因，只是看看大惊小怪。你所花费的只是时间。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-11T17:53:13.253

我仅将 FreeBSD 用于开发。它非常安全且非常稳定。稳定性对我来说是一个重要因素，而 FreeBSd 弥补了 Linux 和 Windows 让您想要的地方。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-26T07:24:14.697

FreeBSD 是一个很棒的开发平台。例如，如果您查看内核源代码，与 Linux 的混乱相比，它是如此的干净和易于理解。很稳定，社区也很专业。我从第 4 版开始使用 FreeBSD。

但对于 Java 开发，我会选择 Linux、Windows 或 Solaris。最新的 Java 二进制文件在我的 Ubuntu 上比在 XP 上表现更好（Netbeans 作为 IDE 也表现更好）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-09-24T03:42:41.163

# 真操作系统

[![在此处输入图像描述](https://i.stack.imgur.com/hoAhY.png)](https://i.stack.imgur.com/hoAhY.png)

[TrueOS是](https://www.trueos.org)[PC-BSD](https://en.wikipedia.org/wiki/PC-BSD)的演进，建立在[FreeBSD](https://en.wikipedia.org/wiki/FreeBSD)之上。

只需在 App Cafe（TrueOS 中内置的包管理器）中单击一两次，我就安装了[OpenJDK](https://en.wikipedia.org/wiki/OpenJDK) 8 Update 102（最新）和[NetBeans](https://en.wikipedia.org/wiki/NetBeans) 8.1（最新）。

App Cafe 自动下载安装大约需要三分钟。然后启动 NetBeans 并在另一分钟内启动并运行 Hello World 应用程序。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-11T17:32:59.473

好吧，我最近安装的版本（最新版本 AFAIK）的 /usr/ports 中没有 Java 1.6。Netbeans 的端口最多只能捆绑 5.5。至少您必须四处寻找更多最新版本。作为一个完全保持最新的开发平台，看起来并不乐观。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-23T07:08:42.730

如果您主要关心的是 Java，我建议您远离 FreeBSD。在 Linux/OpenSolaris 上启动和运行 Java 开发设置要容易得多。

*BSD 是系统级、硬件级和内核级编码人员的首选开发平台，因为这部分通常比 Linux 上的文档更好，并且您有一个“官方”目标，而 Linux 发行版在补丁等方面有所不同。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-12-23T22:53:11.720

流行的操作系统（Linux、Windows 甚至 Mac OS X）更好。流行的操作系统在编译器、库等优化方面得到了更好的支持。例如，FreeBSD 是 GHC 的 2 层平台（这意味着 GHC 可能会发布新版本，即使它不能在 FreeBSD 上运行）。并且某些编程语言仅在 Windows 或 Linux 上可用。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-08-07T16:45:02.217

自 v2.1 以来，我一直使用 FreeBSD 作为服务器平台和台式机/笔记本电脑。作为一个安全、稳定的操作系统，它非常出色。然而，作为一个图形用户界面，它的表现也不尽如人意。我经常不得不手工雕刻一个 X 配置，并且在为 Firefox 安装 Flash 时几乎没有运气（无论是功能还是错误都值得商榷）。

你会发现你不能只下载 Firefox 之类的二进制文件，但是 Ports 库可以弥补这一点。从 CD/DVD 进行完整安装可为您提供可靠的服务器平台，但从源代码安装 Gnome 可能会花费大量时间，因为它必须下载和编译所有内容的源代码。是的，您经常可以找到预编译的 PKG 文件，但是在相应的 /usr/ports 目录中执行“make install clean”太容易了。

通常，您会发现添加到 Linux 内核的功能比它们在 FreeBSD 中出现的速度更快（尽管有 dtrace 和 zfs）。我认为目前还不支持 Video for Linux，这使得 MythTV 之类的事情充其量是困难的。同样，如果您使用 Asterisk，ISDN 支持。

归根结底，这是个人品味的问题。我继续在生产中使用 FreeBSD，但最近倾向于将 Ubuntu 用于桌面。

我不能谈论 Java 的东西，但是 Ruby on Rails 可以完美无缝地部署。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-09-13T14:05:42.420

[TrueOS](https://www.truenas.com/trueos-discontinuation/)已停产。我有点惊讶...... TrueNAS 和 TrueOS 之间有一些协同作用会很有趣。

# iphone - 在选项卡切换或离开 UIViewController 的焦点时运行方法

> ID：281559
> 
> 赞同：1
> 
> 时间：2008-11-11T17:25:26.117
> 
> 标签：iphone, objective-c, cocoa-touch

我想在用户切换到另一个选项卡或应用程序关闭时运行一个方法。有没有办法用 iphone sdk 做到这一点？

我试过查看视图控制器和标签栏的方法，但我没有看到任何似乎可以做到这一点的方法。

我也试过用“Editing Did End”方法来做这件事，但这似乎不起作用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T18:16:29.133

要在点击选项卡时运行方法（我假设您指的是标准 UITabBar），只需`tabBar:didSelectItem:`在 tabBar 的委托中实现。

要在应用程序退出时运行代码，请`applicationWillTerminate:`在应用程序的委托中实现。

# delphi - Delphi 2007 VI/VIM 键映射

> ID：281561
> 
> 赞同：4
> 
> 时间：2008-11-11T17:25:45.960
> 
> 标签：delphi, vim, ide, delphi-2007

在阅读*了 The Pragmatic Programmer*之后，我对 VIM 已经很熟悉了。在 Visual Studio 中，我有 ViEmu ( [http://www.viemu.com/](http://www.viemu.com/) ) 为我提供 VIM 功能。

有人知道在 CodeGear Delphi 2007 中集成 VI/VIM 键绑定的类似程序/键绑定/解决方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T21:03:17.037

Delphi 的键绑定是可扩展的，首先有几个开箱即用的键盘映射可供选择，然后在 ToolsAPI 单元中有 API 可以编写您自己的（您应该实现 IOTAKeyboardBinding 接口）。我不了解 VIM，但我认为可以使用这些 API 来完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-09-05T04:08:01.247

[https://github.com/petdr/vide](https://github.com/petdr/vide)是我编写的集成到 Delphi IDE 中的 vi 绑定的一个非常有限的子集。

它有一些怪癖，但它为我完成了这项工作。

我在 XE2、XE8 和 Berlin 10.1 中使用过它

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T19:41:50.680

我记得在 Delphi 7 中看到过，但这可能来自 CodeRush，这是一个不再可用于 Delphi 的 Delphi 插件。. . . .

另一种方法是您可以在 Visual Studio 中使用 Delphi Prism 并继续使用 ViEmu 。. . 我知道这不适用于您的本机代码。

# antlr - 使用 AntLR 获取开始和结束位置

> ID：281563
> 
> 赞同：0
> 
> 时间：2008-11-11T17:26:09.923
> 
> 标签：antlr

我目前正在使用 AntLR 用专有语言解析一些文件。我需要在编辑器上突出显示它的部分（例如，考虑突出显示 Java 类中的方法）。

有没有人提示如何获得它们？说我有这个代码：

```
function test(param1, param2) {
} 
```

由于函数是一个关键字，我在解析器中得到的第一个位置是标识符“test”之一。我怎样才能得到从那里到结束花括号的位置？正如人们所期望的那样，参数列表是动态的，因此您事先不知道它的长度。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T08:36:15.153

如果我理解您的问题，我认为您可以在每个令牌上使用属性“pos”

```
func: FUNCTION ID '(' ID (',' ID)* ')' {
        System.out.println("Position = " + $FUNCTION.pos);
} 
```

它指的是从零开始计数的行内的字符位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T17:29:09.590

不太明白为什么你得到的第一个职位是测试职位。如果您正确设计了模式规范，您应该能够轻松获得“功能”标记的字符偏移量。你能列出规范的相关部分吗？

# c# - FileSystemWatcher 和网络断开连接？

> ID：281573
> 
> 赞同：6
> 
> 时间：2008-11-11T17:30:42.690
> 
> 标签：c#, .net, .net-2.0, filesystemwatcher

我怎样才能使它在网络中工作？它可以工作，然后无缘无故停止工作（可能是因为网络不完美）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T17:32:24.230

您需要重新连接 FileSystemWatcher。

将 FileSystemWatcher 类型的变量设置为类的全局变量，添加事件 WatcherError。

在方法内部，添加类似的内容：

```
 private static void WatcherError(object source, ErrorEventArgs e)
  {
     watcher = new FileSystemWatcher();//You might want to do a method and to setup all config...
     while (!watcher.EnableRaisingEvents)
     {
        try
        {
           watcher = new FileSystemWatcher();//You might want to do a method and to setup all config...
        }
        catch
        {
           System.Threading.Thread.Sleep(30000); //Wait for retry 30 sec.
        }
     }
  } 
```

您不想使用 watcher = new... 您希望有一个方法来添加所有事件并设置路径，但上面的代码让您很好地了解该做什么。

# javascript - 网页运行时错误

> ID：281576
> 
> 赞同：0
> 
> 时间：2008-11-11T17:31:14.530
> 
> 标签：javascript, internet-explorer-7, user-experience, runtime-error

当我使用网络时，我经常会通过弹出窗口报告运行时错误（通常是 javascript）。这可能会在许多其他优秀的网站上造成非常不令人满意的用户体验，也让我想知道我无法访问哪些功能。

为什么这是一个如此普遍的问题？这是由于缺乏测试还是浏览器兼容性问题？可以做些什么来尽量减少此类问题？

顺便说一句，我没有选中“显示有关每个脚本错误的通知”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T17:46:19.243

我把它归结为缺乏测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T18:07:32.040

它的一些问题。

1.  许多网页创建者从网上复制和粘贴 JavaScript 代码。他们不是程序员，可能不会欣赏语言的细微差别。
2.  缺乏好的测试框架（至少我不知道）。对于 Java，我们有 JUNIT 和 .NET NUNIT 等。目前很难自动化 JavaScript 测试。
3.  IDE支持不佳。直到最近，大多数 IDE 在支持 JavaScript 方面做得很差。现在我看到了更多的支持，但仍然不是核心语言所获得的那种支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T17:37:25.297

JavaScript 很容易出错。直到最近使用 Aptana，还没有很多好的 JavaScript 编码工具。没有语法检查或编译的好处，小的打字错误可以使它进入页面。除此之外，有时在一个浏览器中运行良好的代码会在另一个浏览器中导致错误。例如，我看到一个 jQuery 插件在 IE 中不起作用，但在其他所有浏览器中都可以。它原来是一个没有“var”关键字声明的变量。Firefox 和 Safari 对此表示满意，而 IE 则不然，因此编写代码的人可能甚至都不知道这是个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T12:12:46.840

是的，问题通常是测试。大多数*认真*的开发人员会尝试在许多浏览器中测试他们的网页，但实际上有很多浏览器和版本，所以你不能真正测试它们。

我通常在设计时使用 Opera 和 Firefox 进行测试，我使用 Mac 的同事也在 Safari 中进行了测试；然后不时启动一个 Vista 机器（我正在运行 linux 和 IE 的 linux 只是不可靠地复制所有奇怪的 IE 行为）并在 IE 上测试它（通常是 7 和 8 beta）。我会建议任何 Web 开发人员*不要*使用 IE 进行设计！错误最多的网站显然是“为 IE 设计的”，因为它们几乎无法在其他浏览器中运行，并且弹出更多错误。如果您使用标准进行设计并使用 Opera、Firefox 和 Safari 等相对标准的浏览器进行测试，然后最好使用[条件注释](http://www.quirksmode.org/css/condcom.html "有条件的评论")为 IE 添加可怕的 hack （尽管它是非标准和专有的，但幸运且正确，*真正的*浏览器，所以你不会破坏工作代码）你有更少的问题。

错误的另一个原因是，一个使用框架旨在解决浏览器差异，并且作为副作用，或者可能只是因为错误，在某些浏览器中弹出错误消息。我当然没有时间修复框架只是为了删除错误消息，除非我可以解决问题并且它基本上仍然有效，否则我必须忽略错误消息，可能提交报告并希望它能够修复下一个版本（或者甚至更好地希望 IE 突然神奇地不复存在:)

# ruby - Ruby - 将块传递给方法

> ID：281579
> 
> 赞同：43
> 
> 时间：2008-11-11T17:31:55.340
> 
> 标签：ruby, highline

我正在尝试使用[Highline gem](http://highline.rubyforge.org/)输入 Ruby 密码，因为我让用户输入了两次密码，所以我想消除我传入的块上的重复。例如，我的一个简单版本现在正在做的是：

```
new_pass = ask("Enter your new password: ") { |prompt| prompt.echo = false }
verify_pass = ask("Enter again to verify: ") { |prompt| prompt.echo = false } 
```

我想把它改成这样：

```
foo = Proc.new { |prompt| prompt.echo = false }
new_pass = ask("Enter your new password: ") foo
verify_pass = ask("Enter again to verify: ") foo 
```

不幸的是，这不起作用。这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-11-11T18:04:05.633

David 的代码可以正常工作，但这是一个更简单、更短的解决方案：

```
foo = Proc.new { |prompt| prompt.echo = false }
new_pass = ask("Enter your new password: ", &foo)
verify_pass = ask("Enter again to verify: ", &foo) 
```

在定义方法时，您还可以使用 & 符号将块分配给变量：

```
def ask(msg, &block)
  puts block.inspect
end 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-11T19:40:54.660

这就是你应该这样做的方式，干净而简单：

```
def ask(question)
    yield(question)
end

proc = Proc.new { |question| puts question }
new_pass = ask("Enter your new password: ", &proc)
verify_pass = ask("Enter again to verify: ", &proc) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T17:47:14.700

```
foo = Proc.new { |prompt| prompt.echo = false }
new_pass = ask("Enter your new password: ") {|x| foo.call(x)}
verify_pass = ask("Enter again to verify: ") {|x| foo.call(x)} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-21T17:48:17.180

这是一个示例，它将使用 yield 方法作为索引的前缀，并使用 call 方法附加索引。

```
class Array
  def alter_each!
    self.each_with_index do |n, i|
      self[i] = yield(n,i)
    end
  end
  def modify_each!(add_one = true, &block)
    self.each_with_index do |n, i|
      j = (add_one) ? (i + 1) : i
      self[i] = block.call(n,j)
    end
  end
end

a = ["dog", "cat", "cow"]

a.alter_each! do |n, i|
  "#{i}_#{n}"
end

a.modify_each! false do |n,i|
  "#{n}_#{i}"
end

puts a 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-11T17:46:06.950

我不认为该语言支持这样的结构。我能看到以任何方式概括这一点的唯一方法是：

```
def foo(prompt)
  prompt.echo = false
end
new_pass = ask("Enter your new password: ") { |prompt| foo(prompt) }
verify_pass = ask("Enter again to verify: ") { |prompt| foo(prompt) } 
```

它并没有真正缩短代码，尽管它确实消除了一些重复——如果你想做的不仅仅是 set `prompt.echo`to `false`，你只需要在一个地方添加代码。

# ruby-on-rails - lovdbyless VS 社区引擎...哪个最好？

> ID：281582
> 
> 赞同：5
> 
> 时间：2008-11-11T17:34:54.820
> 
> 标签：ruby-on-rails, ruby, social-networking

因此，随着 ruby​​ 被引入作为新的编程救世主，我想知道是否有人基于易用性、运行所需的资源、可用性和易于定制的偏好。

两者有更好的吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-12T19:45:01.187

好吧，任何基于 Rails 的社交网络应用程序的比较都应该包括 insoshi ( [http://portal.insoshi.com/](http://portal.insoshi.com/) )。

话虽如此，这三个都*非常*相似，差异归结为实现细节。Lovd 和 Insoshi 都是完整的 Rails 应用程序；它旨在让您将它们用作入门工具包，并通过您自己的自定义扩展它们。另一方面，Community Engine 是一个 Rails 插件。这意味着您可以更轻松地向现有 Rails 应用程序添加社交功能。不过，作者已经在 Github 上放了一个完整的示例应用程序。它们似乎都具有相当的主题性，但 CE 模板都在 haml 中（如果您是 haml 粉丝，那就太好了，我不是）。

安装可能有点复杂，因为有许多外部依赖项，例如 RMagick 和搜索引擎接口。但我不会认为它对于具有这么多功能的应用程序来说太过分了。

您可以比较的几件事是更新的最近/频率以及总体受欢迎程度。幸运的是，这三个都在 GitHub 上。这为您提供了可比较的指标。您可以查看网络以确定更新频率和观看者数量，这是流行度的粗略指标（大多数观看者已经下载并至少测试过该产品）。统计数据是：

*   社区引擎：262位关注者，作者更新频繁。GitHub 上还有其他几个与 CE 相关的产品。

*   Insoshi：503 位观察者，许多来自几位作者的最新提交。

*   受少之爱：329 名观看者。原作者不再频繁提交（并且正在寻找新的维护者），但是有一个分支在最近的更新中非常活跃。

底线？没有容易确定的“更好”的应用程序。每个都有可用的演示；我会和每一个一起玩，看看哪一个最适合你的需求。如果您希望为现有应用程序启用社交功能，显然社区引擎会更容易集成，但除此之外，选择是广泛的。

# c# - 在 DataGridViews 中显示对象集合

> ID：281584
> 
> 赞同：2
> 
> 时间：2008-11-11T17:36:52.897
> 
> 标签：c#, .net

在应用程序中使用 ORM 方法通常会导致您拥有一组已检索的对象并希望使用 DataGridView 在表格视图中显示它们的情况。

在我（有限的）经验中，使用自定义 BindingList 将对象集合绑定到 DataGridView 会导致性能不佳和排序不满意。我正在寻找一个通用解决方案来解决这个问题，这样可以直接填充 DataGridView 并在以后提取底层对象。

我将描述我找到的一个很好的解决方案，但我正在寻找替代方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T17:37:40.587

Javier Lozano 建议将对象集合转换为 DataTable，然后根据需要将 DataRows 转换回对象。他的解决方案使用反射使其通用。他甚至[在他的博客上发布了代码](http://blog.lozanotek.com/archive/2007/05/09/Converting_Custom_Collections_To_and_From_DataTable.aspx)。我做了一些小的修改来支持对象中的 Nullable 类型，到目前为止这似乎对我来说效果很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T06:58:18.023

我将用我的经验在 2.0 框架领域内的声明作为这个答案的开头。较新的框架可能会提供其他解决方案。

下面是一个 BindingList 派生类，它支持 List 的双向排序和其他有用的特性。我不能将 PropertyComparer 排序归功于自己。不久前我在一篇文章中发现了这一点，但现在我看到它遍布互联网，所以很遗憾我无法引用原始来源。

另一种选择是 BindingListView： [http](http://blw.sourceforge.net/) ://blw.sourceforge.net 。此类允许您创建 List 集合的视图，就像使用 DataTable 对象一样，包括定义过滤器和排序的能力。

```
public class UsefulBindingList<T> : BindingList<T>
{
    private bool _isSorted = false;
    private ListSortDirection _sortDirection;
    private PropertyDescriptor _sortProperty;

    protected override bool SupportsSortingCore
    {
        get { return true; }
    }

    protected override bool IsSortedCore
    {
        get { return _isSorted; }
    }

    protected override ListSortDirection SortDirectionCore
    {
        get { return _sortDirection; }
    }

    protected override PropertyDescriptor SortPropertyCore
    {
        get { return _sortProperty; }
    }

    public void AddRange(IEnumerable<T> collection)
    {
        IEnumerator<T> e = collection.GetEnumerator();
        while (e.MoveNext())
        {
            this.Add(e.Current);
        }
    }

    public T Find(Predicate<T> match)
    {
        List<T> items = this.Items as List<T>;
        if (items != null)
            return items.Find(match);
        else
            return default(T);
    }

    public int FindIndex(Predicate<T> match)
    {
        List<T> items = this.Items as List<T>;
        if (items != null)
            return items.FindIndex(match);
        else
            return -1;
    }

    public bool Exists(Predicate<T> match)
    {
        List<T> items = this.Items as List<T>;
        return items.Exists(match);
    }

    public void Sort()
    {
        List<T> items = this.Items as List<T>;
        if (items != null)
            items.Sort();
    }

    public void Sort(Comparison<T> comparison)
    {
        List<T> items = this.Items as List<T>;
        if (items != null)
            items.Sort(comparison);
    }

    public void Sort(IComparer<T> comparer)
    {
        List<T> items = this.Items as List<T>;
        if (items != null)
            items.Sort(comparer);
    }

    protected override void ApplySortCore(PropertyDescriptor prop, ListSortDirection direction)
    {
        _sortProperty = prop;
        _sortDirection = direction;

        List<T> items = this.Items as List<T>;
        if (items != null)
        {
            PropertyComparer<T> pc = new PropertyComparer<T>(prop, direction);
            items.Sort(pc);
            _isSorted = true;
        }
        else
        {
            _isSorted = false;
        }
        this.OnListChanged(new ListChangedEventArgs(ListChangedType.Reset, -1));
    }

    protected override void RemoveSortCore()
    {
        _isSorted = false;
    }

}

public class PropertyComparer<T> : IComparer<T>
{
    private ListSortDirection _sortDirection;
    private PropertyDescriptor _property;

    public PropertyComparer(PropertyDescriptor property, ListSortDirection direction)
    {
        _property = property;
        _sortDirection = direction;
    }

    public int Compare(T x, T y)
    {
        int rv = 0;
        object vx = _property.GetValue(x);
        object vy = _property.GetValue(y);
        rv = System.Collections.Comparer.Default.Compare(vx, vy);
        if (_sortDirection == ListSortDirection.Descending)
            rv = -rv;
        return rv;
    }

} 
```

# asp.net - 有没有办法在动态呈现的 HTML 控件中维护 ASP.NET ViewState？

> ID：281586
> 
> 赞同：1
> 
> 时间：2008-11-11T17:37:21.897
> 
> 标签：asp.net, html, render

我想制作具有几个`<input type='checkbox' />`控件的自定义控件，这些控件在 Render 方法中呈现。是否可以在这些控件上保留 ViewState（例如是否选中）？

有一种方法可以通过使用 ASP.NET 服务器 CheckBox 控件，使用 this.Controls.Add() 将它们添加到 OnLoad 事件中，并且每次都给它们相同的 Id，但我不想这样做:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T17:51:27.640

如果要将 ViewState 恢复为动态控件，则必须在加载事件*之前重新创建该控件。*这意味着将该代码放入`Init`处理程序中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T17:53:57.497

创建控件时，请确保*先将*它们添加到页面中，然后再对其设置任何属性。这是因为，为了让 ViewState 管理器考虑对控件进行管理，它必须检测到更改，并且只有在控件被添加到 Controls 集合后才能检测到更改。

**设置显式 ID**也很重要。保存和恢复 ViewState 时，控件 ID 必须匹配。

还要确保在[页面生命周期](http://msdn.microsoft.com/en-us/library/aa719775.aspx)的正确时刻 (OnInit) 创建控件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T17:45:50.960

您可以直接访问 ViewState：

```
bool checked = (bool)(ViewState["ThisControlCheckState"] ?? false);
if (checked) {
    write("<input ... >");
}
else {
    write("<input ... >");
} 
```

要保存用户的值，您可以在 PostBack 中执行以下操作：

```
ViewState["ThisControlCheckState"] = request.Params["checkboxName"].ToString() == "1"; 
```

# .net - Int64 和 Int32 在 32 位和 64 位 MS Windows 上的实际性能差异是什么？

> ID：281590
> 
> 赞同：7
> 
> 时间：2008-11-11T17:38:00.897
> 
> 标签：.net, performance, memory, 64-bit, 32-bit

Int64 和 Int32 在 32 位和 64 位 MS Windows 上的实际性能差异是什么？

在两个操作系统变体中的每一个上看到 Int64 与 Int32 的一些实际时序也很棒。XP 或 Vista 也会很有趣。

*   另请参阅有关[memcpy](https://stackoverflow.com/questions/269408/memcpy-performance-differences-between-32-and-64-bit-processes)性能的问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T17:39:00.647

就硬件而言，Int64 在 x64 和 IA64 上比 x86 更有效，因为 64 位处理器具有 64 位寄存器来执行对它们的操作。

Int32 在所有 x86、x64 和 IA64 上同样有效。

在 x64 和 IA64 上，Int32 和 Int64 都同样有效。

在 x86 上，Int32 将比 Int64 更有效。

就操作系统本身而言，我认为除了上面提到的性能结果之外，您不会看到任何额外的性能问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T20:28:02.350

如有疑问，请使用 int32。它不仅在 x86 体系结构上更快，而且其中有很多是静止的，而且请记住，您的缓存是有限的，您可以将两倍于 int64 的 int32 放入 CPU 缓存中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T10:42:05.807

您可能希望关注 SpankyJ 过去关于 64 位开发的条目

[http://blogs.msdn.com/joshwil/archive/2005/04/28/413320.aspx](http://blogs.msdn.com/joshwil/archive/2005/04/28/413320.aspx)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-11T17:50:16.300

从硬件的角度来看，即如果操作系统充分利用架构，Int64 在 64 位系统上将更有效。

Int32 在 32 位系统上可能稍微高效一些，因为 64 位系统可能必须模拟 32 位操作。

# testing - 如何在不安装 AOL 的情况下在 AOL 浏览器中测试我的页面？

> ID：281596
> 
> 赞同：1
> 
> 时间：2008-11-11T17:39:02.893
> 
> 标签：testing, web, aol

如何在不安装 AOL 的情况下在 AOL 中测试我的网站？我在我的机器上做过一次，它杀死了它......;）

我知道，我知道...我可以使用虚拟机，但我真的只是在寻找 AOL 浏览器...单独的浏览器安装。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T17:54:16.403

您可以自行下载[AOL Explorer](http://downloads.channel.aol.com/browser)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-21T11:01:47.300

我找到了链接到通用下载位置的公认答案，您可以在此处直接访问产品：http: [//info.aol.co.uk/browser/](http://info.aol.co.uk/browser/)

# xsd - 如何在 XML Schema 中指定字段依赖项？

> ID：281597
> 
> 赞同：2
> 
> 时间：2008-11-11T17:39:32.703
> 
> 标签：xsd

这更像是一个通用的 XML Schema 问题，但是否以及如何在 XML Schema 中指定字段依赖关系。例如，如果提供了 fieldA，我怎么会说 fieldB 是必需的？？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-11T18:35:23.403

您可以使用 <choice> 和/或 <sequence> 来伪造它。例如，您可以不允许任何内容、fieldB 或 fieldA 和 fieldB，但不能只允许 fieldA。这可能会导致重复，您可以通过定义 complexType 来防止这种情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-21T00:07:38.623

您对这种事情的选择取决于“字段”在 XML 中的表示方式以及您使用的 XSD 版本。

如果`fieldA`和`fieldB`是元素，在适当的内容模型中包括以下形式的一些结构就可以了。

```
<sequence minOccurs="0">
  <element ref="tns:fieldA" minOccurs="0"/>
  <element ref="tns:fieldB"/>
</sequence> 
```

（如果您愿意，两个元素引用可以按其他顺序出现。）我不清楚 Erik Hesselink 为什么担心这可能会导致重复，或者他担心什么形式的重复。

如果您将`fieldB`成为一个元素并`fieldA`成为该元素的（可选？）属性，那么您想要的共现约束将自动遵循。

如果将它们都设为属性，则 XSD 1.0 无法强制执行共现约束；有些人求助于 Schematron 来处理这样的事情。在 XSD 1.1 中，在这种情况下强制执行约束的选项包括`xs:assert`条件类型分配。

# .net - 为文本框使用单独的滚动条

> ID：281605
> 
> 赞同：2
> 
> 时间：2008-11-11T17:42:38.627
> 
> 标签：.net, vb.net, winforms, scrollbars

我正在开发一个必须显示可能大量文本的触摸屏应用程序。我遇到的问题是附加到文本框的默认滚动条太小而无法在触摸屏应用程序中实际使用。我尝试添加一个单独的滚动条控件并使用它来控制文本框的滚动。到目前为止，我只提出了两种方法。

我想出的第一种方法是使用 ScrollToCaret() 子例程。但是我不喜欢这种方法，因为感觉好像应该有更好的方法将滚动条绑定到文本框而不更改文本选择

这是一个例子：

```
Dim oSelectionStart As Integer = CInt((TextBox1.Text.Length \ (VScrollBar1.Maximum - VScrollBar1.LargeChange - 1)) * VScrollBar1.Value)
If oSelectionStart >= TextBox1.Text.Length - 10 Then
    oSelectionStart = TextBox1.Text.Length
End If
If oSelectionStart <= 10 Or VScrollBar1.Value < 2 Then
    oSelectionStart = 0
End If
If Not TextBox1.SelectionStart = oSelectionStart Then
    TextBox1.SelectionStart = oSelectionStart
    TextBox1.ScrollToCaret()
End If 
```

我想出的第二种方法使用 Windows API 调用来设置滚动条位置并获取其当前位置。然而，这种方法也存在一些缺陷。我无法从文本框滚动信息中获得较大的变化值。大多数时候这无关紧要，但是当文本框上的默认滚动条变大时，这意味着我的滚动条无法正确缩放，使我的滚动条具有滚动到文本底部的效果，而只是酒吧的一半。我发现这种方法的另一个问题是文本框的默认滚动条必须可见，以便我能够检索和设置当前的滚动信息。我遇到的最后一个问题是困扰我发现的两种方法的问题。

下面是示例代码：

```
Private Sub VScrollBar1_Scroll(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ScrollEventArgs)
    Dim minPos As Integer = 0
    Dim maxPos As Integer = 0
    Dim newPos As Integer = 0
    GetScrollRange(TextBox1.Handle, SBS_VERT, minPos, maxPos)
    Dim vScrollPerc As Double = ((100 / (VScrollBar1.Maximum - (VScrollBar1.LargeChange - 1))) * VScrollBar1.Value) * 0.01
    newPos = CInt(((maxPos - minPos) * vScrollPerc) + minPos)
    SetScrollPos(TextBox1.Handle, SBS_VERT, newPos, True)
    PostMessageA(TextBox1.Handle, WM_VSCROLL, SB_THUMBPOSITION + &H10000 * newPos, Nothing)
End Sub

'Scrollbar direction
Const SBS_HORZ = 0
Const SBS_VERT = 1
'Windows Messages
Const WM_VSCROLL = &H115
Const WM_HSCROLL = &H114
Const SB_THUMBPOSITION = 4
<Runtime.InteropServices.StructLayout(Runtime.InteropServices.LayoutKind.Sequential)> Private Structure SCROLLINFO
    Public cbSize As Integer
    Public fMask As Integer
    Public nMin As Integer
    Public nMax As Integer
    Public nPage As Integer
    Public nPos As Integer
    Public nTrackPos As Integer
End Structure
Private Enum ScrollBarDirection
    SB_HORZ = 0
    SB_VERT = 1
    SB_CTL = 2
    SB_BOTH = 3
End Enum
Private Enum ScrollInfoMask
    SIF_RANGE = &H1
    SIF_PAGE = &H2
    SIF_POS = &H4
    SIF_DISABLENOSCROLL = &H8
    SIF_TRACKPOS = &H10
    SIF_ALL = (SIF_RANGE Or SIF_PAGE Or SIF_POS Or SIF_TRACKPOS)
End Enum
Private Declare Function GetScrollPos Lib "user32.dll" (ByVal hWnd As IntPtr, ByVal nBar As Integer) As Integer
Private Declare Function SetScrollPos Lib "user32.dll" (ByVal hWnd As IntPtr, ByVal nBar As Integer, ByVal nPos As Integer, ByVal bRedraw As Boolean) As Integer
Private Declare Function PostMessageA Lib "user32.dll" (ByVal hwnd As IntPtr, ByVal wMsg As Integer, ByVal wParam As Integer, ByVal lParam As Integer) As Boolean
Private Declare Function GetScrollRange Lib "user32.dll" (ByVal hWnd As IntPtr, ByVal nBar As Integer, ByRef lpMinPos As Integer, ByRef lpMaxPos As Integer) As Integer
Private Declare Function GetScrollInfo Lib "user32" (ByVal hWnd As IntPtr, ByVal fnBar As ScrollBarDirection, ByRef lpsi As SCROLLINFO) As Integer 
```

我知道必须有更好的方法来做到这一点，但到目前为止，我还没有想出任何合适的解决方案来解决我的问题。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T17:55:27.663

我认为，有办法改变 Win32API 滚动条的大小。看： http://pinvoke.net/search.aspx?search=scrollbar&namespace= [[All]](http://pinvoke.net/search.aspx?search=scrollbar&namespace=[All]) [http://pinvoke.net/default.aspx/user32/FindWindowEx.html](http://pinvoke.net/default.aspx/user32/FindWindowEx.html) [http://pinvoke.net/default.aspx /user32/GetScrollBarInfo.html](http://pinvoke.net/default.aspx/user32/GetScrollBarInfo.html) [http://pinvoke.net/default.aspx/user32/ShowScrollBar.html](http://pinvoke.net/default.aspx/user32/ShowScrollBar.html)

您应该能够使用 Win32API 和滚动条的句柄更改滚动条的大小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-16T00:04:57.380

我们在最近的项目中一直在使用 WPF。WPF 是您的选择吗？如果是，则似乎所有 UI 都可以在 WPF 应用程序中更改。我们使用了 2 位 UI 艺术家。一个在 Adope Photoshop 中工作，然后将输出转换为 XAML。第二个在 Expression Blend 中工作，它本机生成 XAML。

# header - 为什么 UDP 在标头中有长度字段而 TCP 没有？

> ID：281606
> 
> 赞同：28
> 
> 时间：2008-11-11T17:42:43.180
> 
> 标签：header, udp, tcp, ip-protocol

为什么 UDP 在标头中有长度字段而 TCP 没有？

我猜测 TCP 中段的长度是从 IP 标头推断出来的，但是应该能够对 UDP 数据报做同样的事情

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-27T16:21:40.047

根据*TCP/IP Illustrated Volume 1*，长度字段是多余的。这就是史蒂文斯在这件事上所说的一切。

我个人认为这是使 UDP 标头长度（以位为单位）可被 32 整除 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T17:48:31.843

在概念上，有一个 96 位的伪标头作为 TCP 标头的前缀，该标头已经包含该信息。

[此来源](http://www.freesoft.org/CIE/Course/Section4/8.htm)的校验和字段描述给出了答案：

> 校验和：16 位
> 
> 校验和字段是标题和文本中所有 16 位字的反码和的 16 位反码。如果一个段包含奇数个要校验和的标题和文本八位字节，则最后一个八位字节在右侧用零填充以形成一个 16 位字用于校验和目的。pad 不作为段的一部分传输。在计算校验和时，校验和字段本身被零替换。
> 
> 校验和还涵盖概念上以 TCP 标头为前缀的 96 位伪标头。此伪标头包含源地址、目标地址、协议和 TCP 长度。这为 TCP 提供了针对错误路由段的保护。此信息在 Internet 协议中承载，并通过 TCP/网络接口在 IP 上 TCP 调用的参数或结果中传输。
> 
> ```
>  +--------+--------+--------+--------+
>       |           Source Address          |
>       +--------+--------+--------+--------+
>       |         Destination Address       |
>       +--------+--------+--------+--------+
>       |  zero  |  PTCL  |    TCP Length   |
>       +--------+--------+--------+--------+ 
> ```

**由于 TCP 是基于流的协议，因此 TCP 级别不需要该信息。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-11-02T18:03:13.113

这只是最初指定 UDP 的方式。UDP 可以像 TCP 一样在没有长度字段的情况下工作。

TCP中每个段的长度是如何得到的？这实际上取决于具体的实现（OS）。TCP 的 RFC 只是声明：

> 任何较低级别的协议都必须提供源地址、目标地址和协议字段，以及确定“TCP 长度”的某种方式，[...]

# database - 数据库加密

> ID：281618
> 
> 赞同：9
> 
> 时间：2008-11-11T17:45:53.783
> 
> 标签：database, encryption

我需要我的数据库是安全的，以防硬盘被盗。

我还没有看到很多数据库（甚至是主流数据库）声称支持加密。

*   你们知道任何支持加密的数据库吗？
*   如果我使用的是不支持加密的数据库，那么在本机加密数据（例如使用 java 加密库）是不是一个坏主意？这可能会导致具有强类型字段的数据库出现问题吗？
*   还有哪些其他解决方案可用于加密我的数据库？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T17:49:20.313

也许您应该考虑加密整个硬盘驱动器。这是在文件系统级别本地完成的。

它使用 Windows 凭据对其进行加密。因此，即使您的整个计算机被盗，您的数据也会受到保护。

窃取者必须重新格式化驱动器才能使用它。

当然，如果您的计算机使用自动登录，则不适合您。

HTH，即使它不是真正的数据库加密解决方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T17:55:34.123

MS SQL Server 2008 绝对支持它。不太确定旧版本。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T17:59:01.167

Microsoft SQL Server 和 Oracle 都支持数据库加密。SQL Server 2008 添加了[透明数据加密](http://msdn.microsoft.com/en-us/library/cc278098.aspx)，这在仅支持单元级别加密的 SQL Server 2005 中不存在。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T18:03:57.833

Oracle 支持一种称为透明加密的东西，它可以与钱包一起使用。

也许由于我们的实施，我们没有成功。我们遇到的问题是，一旦任何有凭据的用户（即拥有钱包条目的用户）访问数据，它就会对所有有权访问该表的用户开放。如果您只关心静态加密，这可能对您有用（您想在 Oracle 的文档中验证它确实在静态加密） - 如果您需要加密传输进/出数据库，我不确定这一点是你所追求的。

说了这么多——考虑到你的问题，我认为使用另一篇文章中建议的硬盘驱动器级加密等解决方案可能更适合你。

**免责声明：**我不是专业的 DBA，所以我只能根据我们在 Oracle 技术方面的经验来提供这一点。我在一家财富 500 强公司工作，我们当然有合适的人在看它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T17:52:15.643

富士通和三星销售的硬盘在硬盘级别采用了加密技术。我不知道这些是否可以解决您的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T18:01:33.643

Sybase SQL Anywhere 支持 128 位和 256 位 AES 加密。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-30T17:54:53.420

如果您正在寻找一个支持加密的优秀嵌入式数据库，我建议您使用[SQLCipher](http://www.zetetic.net/software/sqlcipher) *，它是 SQLite 的一个版本，它在开源许可下提供透明的数据库加密。明显的用例是在移动和独立应用程序中。

*完全披露：我在开发团队。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T17:53:51.380

SQL Compact DB 通过为它们提供密码来提供开箱即用的加密。

[http://blogs.msdn.com/stevelasker/archive/2008/05/14/security-and-encryption-for-sql-server-compact.aspx](http://blogs.msdn.com/stevelasker/archive/2008/05/14/security-and-encryption-for-sql-server-compact.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-11T17:55:05.590

不确定这是否适合您，但 SQLite 的开发人员出售使用加密数据库后端的库版本：[http](http://www.hwaci.com/sw/sqlite/prosupport.html#crypto) ://www.hwaci.com/sw/sqlite/prosupport.html#crypto 。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-20T08:19:38.837

TDE 是实现这一目标的最佳方式...

[http://technet.microsoft.com/en-us/library/cc278098%28v=sql.100%29.aspx](http://technet.microsoft.com/en-us/library/cc278098%28v=sql.100%29.aspx)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-12-13T14:40:55.603

正如 Billy Gray 所推荐的，SQLipher 是最好的数据库加密库。要使用这个库，只需调用：

```
SQLiteDatabase.loadLibs(context);
SQLiteOpenHelper.getWritableDatabase(“yourSecretKey”): 
```

# java - 模块化 JSP 代码块的最佳方法

> ID：281624
> 
> 赞同：8
> 
> 时间：2008-11-11T17:47:10.660
> 
> 标签：java, jsp

我有一个需要在多个地方使用的 JSP 代码块（基本上是几个页面使用的小部件）。什么是模块化的好方法？我宁愿不把它放在一个对象中，因为 HTML 的字符串操作变得丑陋。使用`<%@ include file="foo.jsp"%>`是有问题的，因为我们最终拥有隐式全局变量。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T17:49:43.993

您可以创建一个简单的*标签*，并在您想要的小部件的任何地方使用它。标记是可以在任何 JSP 中使用的可重用对象。

请参阅[http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/JSPTags.html](http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/JSPTags.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T17:50:18.533

1.  将 JSP 分离到自己的文件中并包含它（JSP 包含、Tiles 包含等）

2.  你能创建一个包含该功能的标签库吗？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T18:09:37.527

在 JSP 2 中，改进了自定义标记。这是一篇关于它们的[好文章](http://www.vsj.co.uk/java/display.asp?id=408)。

以前，JSP 不太擅长模块化代码，包含和标记库，您打折的两个选项都与它有关。[Bogdan](https://stackoverflow.com/questions/281624/best-way-to-modularize-a-block-of-jsp-code#281634)指出，JSP 2 之前的自定义标签功能强大，但有开销。

# apache-flex - 在 BlazeDS 中优雅地处理服务器超时

> ID：281627
> 
> 赞同：7
> 
> 时间：2008-11-11T17:47:56.617
> 
> 标签：apache-flex, blazeds

我有一个 flex 客户端，它对运行 BlazeDS 的 tomcat 服务器进行服务调用。我想在这个环境中优雅地处理服务器会话超时。

我确实对服务有安全限制，因此客户端通过基于目标初始化 ChannelSet，然后使用该 ChannelSet 登录来对远程对象进行身份验证。

用户通过身份验证后，如果他们去喝一杯（长）杯咖啡，他们的会话将不可避免地超时。

我希望客户端检测到超时，并将用户返回到登录页面，并带有适当的信息消息。

但是我很难找到从客户端检测此超时的最佳方法。是否有可能，或者我必须让服务器在超时发生时抛出错误？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-10-22T08:31:55.340

我们实现了一个自定义 UI 服务，它不断地 ping 服务器（每 10 分钟 1 个 ping），从而防止 AppServer 关闭连接。我们还运行一些内部 UI 计时器，每次发出任何请求（“ping”除外）时都会丢弃该计时器，并使用完整的函数调用 UI 以切换回登录并显示“由于客户端不活动而导致会话过期”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-30T19:27:09.887

这不是 BlazeDS 特有的，但从 Flex 4.5（可能更早）开始，对于超时错误的故障事件有一个特定的故障代码：

在您的故障处理程序中：

```
if(faultEvent.fault.faultCode == "Client.Error.RequestTimeout"){
  trace("TIMEOUT ERROR");
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-07T03:29:55.620

我们为客户端编写了一个自定义组件，用于捕获击键和鼠标事件，然后在客户端处理超时。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-05T17:33:51.013

在服务器端实现 FlexSessionListener 接口。它提供了一种在实际完成之前处理 Flex 会话创建/销毁的方法。

在 sessionDestroyed 处理程序上，使用消息生产者将消息从服​​务器发送到客户端，让他知道会话即将超时。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T16:09:05.650

查看文档，看看连接断开时是否触发了事件。我想有。如果没有，请在您的连接周围使用 try/catch 并捕获任何与连接相关的问题。如果这样做，请重定向您的应用并通知用户。您可能需要使用它来查找因连接问题而引发的确切错误代码，但调试起来应该相当容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-05T18:51:51.843

扩展 CallResponder，并覆盖故障方法。

检查 data.fault.faultCode 以获取已知错误代码，例如 ErrorMessage.MESSAGE_DELIVERY_IN_DOUBT。

如果命中，请使用本机函数 navigateToURL 进行重定向。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-17T19:12:02.633

我在一个项目中遇到了这个问题，特别是因为 BlazeDS 的会话超时与实际应用程序不同（通过 ClearTrust 使用单点登录架构）。请注意，这是在 JBoss 环境中。我最终采取了一种相当简单的方法，在故障处理程序中查找 2 个特定的故障代码（有一个带有通用故障处理程序的基类）：DuplicateSessionDetected 和 DeliveryInDoubt。每当 BlazeDS 尝试为相同的 JBoss 会话 ID 创建新会话时，我都会看到 DuplicateSessionDetected。DeliveryInDoubt 有时也会出现，但我不知道为什么。当我看到这些故障代码时，我采取了必要的措施来刷新应用程序（根据您的需要，您可以重定向到登录页面或其他内容）。显然，根据环境，

讨论的另一种方法是在 Flex 应用程序中使用一个表示 BlazeDS 超时计时器的计时器，但我不喜欢为此目的设置计时器。我还听说过向服务器来回发送少量数据以检查超时，但同样，这似乎不太理想。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-28T08:41:35.523

我在我的一个项目中遇到了这个问题。为了克服这个问题，我每次客户端访问服务器时，无论是通过 RemoteObject 还是 HTTPService，它都会首先检查用户的身份验证，如果它已经超时，它会返回一些东西，如果它很好，它将继续它的过程。在客户端的响应处理结果事件中，客户端检查响应是否超时，如果是，它会再次转发到登录页面。据我所知，当用户的会话超时时，服务器不会向客户端抛出错误。您将只知道下次访问服务器时会话超时。

# c# - 如何使用 .NET 以字节缩写形式获得人类可读的文件大小？

> ID：281640
> 
> 赞同：316
> 
> 时间：2008-11-11T17:51:49.933
> 
> 标签：c#, .net, vb.net, filesize, human-readable

如何使用 .NET 以字节缩写形式获得人类可读的文件大小？

**示例**：输入 7,326,629 并显示 6.98 MB

* * *

## 回答 #1

> 赞同：398
> 
> 时间：2008-11-11T18:03:31.500

这可能不是最有效或最优化的方法，但如果您不熟悉对数数学，它会更容易阅读，并且对于大多数情况应该足够快。

```
string[] sizes = { "B", "KB", "MB", "GB", "TB" };
double len = new FileInfo(filename).Length;
int order = 0;
while (len >= 1024 && order < sizes.Length - 1) {
    order++;
    len = len/1024;
}

// Adjust the format string to your preferences. For example "{0:0.#}{1}" would
// show a single decimal place, and no space.
string result = String.Format("{0:0.##} {1}", len, sizes[order]); 
```

* * *

## 回答 #2

> 赞同：352
> 
> 时间：2011-02-12T02:31:29.587

使用**Log**解决问题....

```
static String BytesToString(long byteCount)
{
    string[] suf = { "B", "KB", "MB", "GB", "TB", "PB", "EB" }; //Longs run out around EB
    if (byteCount == 0)
        return "0" + suf[0];
    long bytes = Math.Abs(byteCount);
    int place = Convert.ToInt32(Math.Floor(Math.Log(bytes, 1024)));
    double num = Math.Round(bytes / Math.Pow(1024, place), 1);
    return (Math.Sign(byteCount) * num).ToString() + suf[place];
} 
```

也在 C# 中，但应该很容易转换。为了便于阅读，我还四舍五入到小数点后 1 位。

基本确定 Base 1024 的小数位数，然后除以`1024^decimalplaces`.

以及一些使用和输出示例：

```
Console.WriteLine(BytesToString(9223372036854775807));  //Results in 8EB
Console.WriteLine(BytesToString(0));                    //Results in 0B
Console.WriteLine(BytesToString(1024));                 //Results in 1KB
Console.WriteLine(BytesToString(2000000));              //Results in 1.9MB
Console.WriteLine(BytesToString(-9023372036854775807)); //Results in -7.8EB 
```

编辑：
有人指出我错过了一个`Math.Floor`，所以我合并了它。（`Convert.ToInt32`使用四舍五入，而不是截断，这就是为什么`Floor`有必要。）感谢您的关注。

Edit2：
有一些关于负大小和 0 字节大小的评论，所以我更新以处理这些情况。

* * *

## 回答 #3

> 赞同：122
> 
> 时间：2012-06-20T16:36:45.920

此处发布了请求功能的经过测试和显着优化的版本：

[C# 人类可读文件大小 - 优化功能](http://www.somacon.com/p576.php)

源代码：

```
// Returns the human-readable file size for an arbitrary, 64-bit file size 
// The default format is "0.### XB", e.g. "4.2 KB" or "1.434 GB"
public string GetBytesReadable(long i)
{
    // Get absolute value
    long absolute_i = (i < 0 ? -i : i);
    // Determine the suffix and readable value
    string suffix;
    double readable;
    if (absolute_i >= 0x1000000000000000) // Exabyte
    {
        suffix = "EB";
        readable = (i >> 50);
    }
    else if (absolute_i >= 0x4000000000000) // Petabyte
    {
        suffix = "PB";
        readable = (i >> 40);
    }
    else if (absolute_i >= 0x10000000000) // Terabyte
    {
        suffix = "TB";
        readable = (i >> 30);
    }
    else if (absolute_i >= 0x40000000) // Gigabyte
    {
        suffix = "GB";
        readable = (i >> 20);
    }
    else if (absolute_i >= 0x100000) // Megabyte
    {
        suffix = "MB";
        readable = (i >> 10);
    }
    else if (absolute_i >= 0x400) // Kilobyte
    {
        suffix = "KB";
        readable = i;
    }
    else
    {
        return i.ToString("0 B"); // Byte
    }
    // Divide by 1024 to get fractional value
    readable = (readable / 1024);
    // Return formatted number with suffix
    return readable.ToString("0.### ") + suffix;
} 
```

* * *

## 回答 #4

> 赞同：73
> 
> 时间：2008-11-11T18:15:26.937

```
[DllImport ( "Shlwapi.dll", CharSet = CharSet.Auto )]
public static extern long StrFormatByteSize ( 
        long fileSize
        , [MarshalAs ( UnmanagedType.LPTStr )] StringBuilder buffer
        , int bufferSize );

/// <summary>
/// Converts a numeric value into a string that represents the number expressed as a size value in bytes, kilobytes, megabytes, or gigabytes, depending on the size.
/// </summary>
/// <param name="filelength">The numeric value to be converted.</param>
/// <returns>the converted string</returns>
public static string StrFormatByteSize (long filesize) {
     StringBuilder sb = new StringBuilder( 11 );
     StrFormatByteSize( filesize, sb, sb.Capacity );
     return sb.ToString();
} 
```

来自：[http ://www.pinvoke.net/default.aspx/shlwapi/StrFormatByteSize.html](http://www.pinvoke.net/default.aspx/shlwapi/StrFormatByteSize.html)

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2014-03-12T23:59:52.500

签出[ByteSize](https://github.com/omar/ByteSize)库。这是`System.TimeSpan`字节！

它为您处理转换和格式化。

```
var maxFileSize = ByteSize.FromKiloBytes(10);
maxFileSize.Bytes;
maxFileSize.MegaBytes;
maxFileSize.GigaBytes; 
```

它还进行字符串表示和解析。

```
// ToString
ByteSize.FromKiloBytes(1024).ToString(); // 1 MB
ByteSize.FromGigabytes(.5).ToString();   // 512 MB
ByteSize.FromGigabytes(1024).ToString(); // 1 TB

// Parsing
ByteSize.Parse("5b");
ByteSize.Parse("1.55B"); 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2011-02-11T08:49:59.013

另一种皮肤的方法，没有任何类型的循环和负大小支持（对于文件大小增量之类的东西是有意义的）：

```
public static class Format
{
    static string[] sizeSuffixes = {
        "B", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB" };

    public static string ByteSize(long size)
    {
        Debug.Assert(sizeSuffixes.Length > 0);

        const string formatTemplate = "{0}{1:0.#} {2}";

        if (size == 0)
        {
            return string.Format(formatTemplate, null, 0, sizeSuffixes[0]);
        }

        var absSize = Math.Abs((double)size);
        var fpPower = Math.Log(absSize, 1000);
        var intPower = (int)fpPower;
        var iUnit = intPower >= sizeSuffixes.Length
            ? sizeSuffixes.Length - 1
            : intPower;
        var normSize = absSize / Math.Pow(1000, iUnit);

        return string.Format(
            formatTemplate,
            size < 0 ? "-" : null, normSize, sizeSuffixes[iUnit]);
    }
} 
```

这是测试套件：

```
[TestFixture] public class ByteSize
{
    [TestCase(0, Result="0 B")]
    [TestCase(1, Result = "1 B")]
    [TestCase(1000, Result = "1 KB")]
    [TestCase(1500000, Result = "1.5 MB")]
    [TestCase(-1000, Result = "-1 KB")]
    [TestCase(int.MaxValue, Result = "2.1 GB")]
    [TestCase(int.MinValue, Result = "-2.1 GB")]
    [TestCase(long.MaxValue, Result = "9.2 EB")]
    [TestCase(long.MinValue, Result = "-9.2 EB")]
    public string Format_byte_size(long size)
    {
        return Format.ByteSize(size);
    }
} 
```

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2015-08-05T13:04:21.543

我喜欢使用以下方法（它支持高达 TB，这对于大多数情况来说已经足够了，但它可以很容易地扩展）：

```
private string GetSizeString(long length)
{
    long B = 0, KB = 1024, MB = KB * 1024, GB = MB * 1024, TB = GB * 1024;
    double size = length;
    string suffix = nameof(B);

    if (length >= TB) {
        size = Math.Round((double)length / TB, 2);
        suffix = nameof(TB);
    }
    else if (length >= GB) {
        size = Math.Round((double)length / GB, 2);
        suffix = nameof(GB);
    }
    else if (length >= MB) {
        size = Math.Round((double)length / MB, 2);
        suffix = nameof(MB);
    }
    else if (length >= KB) {
        size = Math.Round((double)length / KB, 2);
        suffix = nameof(KB);
    }

    return $"{size} {suffix}";
} 
```

请记住，这是为 C# 6.0 (2015) 编写的，因此可能需要对早期版本进行一些编辑。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-11-11T17:58:55.753

```
int size = new FileInfo( filePath ).Length / 1024;
string humanKBSize = string.Format( "{0} KB", size );
string humanMBSize = string.Format( "{0} MB", size / 1024 );
string humanGBSize = string.Format( "{0} GB", size / 1024 / 1024 ); 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2018-03-28T13:18:27.480

这是一个简洁的答案，可以自动确定单位。

```
public static string ToBytesCount(this long bytes)
{
    int unit = 1024;
    string unitStr = "B";
    if (bytes < unit)
    {
        return string.Format("{0} {1}", bytes, unitStr);
    }
    int exp = (int)(Math.Log(bytes) / Math.Log(unit));
    return string.Format("{0:##.##} {1}{2}", bytes / Math.Pow(unit, exp), "KMGTPEZY"[exp - 1], unitStr);
} 
```

*"b" 代表比特，"B" 代表字节，"KMGTPEZY" 分别代表公斤、兆、千兆、兆、千亿、埃克、泽塔和约塔*

可以将其扩展以考虑[ISO/IEC80000](https://en.wikipedia.org/wiki/ISO/IEC_80000)：

```
public static string ToBytesCount(this long bytes, bool isISO = true)
{
    int unit = isISO ? 1024 : 1000;
    string unitStr = "B";
    if (bytes < unit)
    {
        return string.Format("{0} {1}", bytes, unitStr);
    }
    int exp = (int)(Math.Log(bytes) / Math.Log(unit));
    return string.Format("{0:##.##} {1}{2}{3}", bytes / Math.Pow(unit, exp), "KMGTPEZY"[exp - 1], isISO ? "i" : "", unitStr);
} 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-11-11T18:06:01.247

```
string[] suffixes = { "B", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB" };
int s = 0;
long size = fileInfo.Length;

while (size >= 1024)
{
    s++;
    size /= 1024;
}

string humanReadable = String.Format("{0} {1}", size, suffixes[s]); 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2016-03-07T21:20:55.453

如果您尝试匹配 Windows 资源管理器的详细视图中显示的大小，这就是您想要的代码：

```
[DllImport("shlwapi.dll", CharSet = CharSet.Unicode)]
private static extern long StrFormatKBSize(
    long qdw,
    [MarshalAs(UnmanagedType.LPTStr)] StringBuilder pszBuf,
    int cchBuf);

public static string BytesToString(long byteCount)
{
    var sb = new StringBuilder(32);
    StrFormatKBSize(byteCount, sb, sb.Capacity);
    return sb.ToString();
} 
```

这不仅会完全匹配 Explorer，还会提供为您翻译的字符串并匹配 Windows 版本中的差异（例如在 Win10 中，K = 1000 与以前的版本 K = 1024）。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2014-04-14T06:55:56.170

有一个开源项目可以做到这一点，甚至更多。

```
7.Bits().ToString();         // 7 b
8.Bits().ToString();         // 1 B
(.5).Kilobytes().Humanize();   // 512 B
(1000).Kilobytes().ToString(); // 1000 KB
(1024).Kilobytes().Humanize(); // 1 MB
(.5).Gigabytes().Humanize();   // 512 MB
(1024).Gigabytes().ToString(); // 1 TB 
```

[http://humanizr.net/#bytesize](http://humanizr.net/#bytesize)

[https://github.com/MehdiK/Humanizer](https://github.com/MehdiK/Humanizer)

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2012-05-12T21:54:21.230

**所有解决方案的混合:-)**

```
 /// <summary>
    /// Converts a numeric value into a string that represents the number expressed as a size value in bytes,
    /// kilobytes, megabytes, or gigabytes, depending on the size.
    /// </summary>
    /// <param name="fileSize">The numeric value to be converted.</param>
    /// <returns>The converted string.</returns>
    public static string FormatByteSize(double fileSize)
    {
        FileSizeUnit unit = FileSizeUnit.B;
        while (fileSize >= 1024 && unit < FileSizeUnit.YB)
        {
            fileSize = fileSize / 1024;
            unit++;
        }
        return string.Format("{0:0.##} {1}", fileSize, unit);
    }

    /// <summary>
    /// Converts a numeric value into a string that represents the number expressed as a size value in bytes,
    /// kilobytes, megabytes, or gigabytes, depending on the size.
    /// </summary>
    /// <param name="fileInfo"></param>
    /// <returns>The converted string.</returns>
    public static string FormatByteSize(FileInfo fileInfo)
    {
        return FormatByteSize(fileInfo.Length);
    }
}

public enum FileSizeUnit : byte
{
    B,
    KB,
    MB,
    GB,
    TB,
    PB,
    EB,
    ZB,
    YB
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2017-06-07T08:19:33.213

就像@NET3 的解决方案一样。使用 shift 代替除法来测试 的范围`bytes`，因为除法需要更多的 CPU 成本。

```
private static readonly string[] UNITS = new string[] { "B", "KB", "MB", "GB", "TB", "PB", "EB" };

public static string FormatSize(ulong bytes)
{
    int c = 0;
    for (c = 0; c < UNITS.Length; c++)
    {
        ulong m = (ulong)1 << ((c + 1) * 10);
        if (bytes < m)
            break;
    }

    double n = bytes / (double)((ulong)1 << (c * 10));
    return string.Format("{0:0.##} {1}", n, UNITS[c]);
} 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2018-11-21T06:00:10.157

我使用下面的*Long*扩展方法来转换为人类可读大小的字符串。此方法是发布在 Stack Overflow 上的同一问题的 Java 解决方案的 C# 实现，[此处](https://stackoverflow.com/a/3758880/563509)。

```
/// <summary>
/// Convert a byte count into a human readable size string.
/// </summary>
/// <param name="bytes">The byte count.</param>
/// <param name="si">Whether or not to use SI units.</param>
/// <returns>A human readable size string.</returns>
public static string ToHumanReadableByteCount(
    this long bytes
    , bool si
)
{
    var unit = si
        ? 1000
        : 1024;

    if (bytes < unit)
    {
        return $"{bytes} B";
    }

    var exp = (int) (Math.Log(bytes) / Math.Log(unit));

    return $"{bytes / Math.Pow(unit, exp):F2} " +
           $"{(si ? "kMGTPE" : "KMGTPE")[exp - 1] + (si ? string.Empty : "i")}B";
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-11-11T18:00:52.957

我假设您正在寻找“1.4 MB”而不是“1468006 字节”？

我认为.NET 中没有内置的方法可以做到这一点。你只需要弄清楚哪个单位是合适的，然后格式化。

编辑：这里有一些示例代码可以做到这一点：

[http://www.codeproject.com/KB/cpp/formatsize.aspx](http://www.codeproject.com/KB/cpp/formatsize.aspx)

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2017-10-18T08:09:54.663

一些递归怎么样：

```
private static string ReturnSize(double size, string sizeLabel)
{
  if (size > 1024)
  {
    if (sizeLabel.Length == 0)
      return ReturnSize(size / 1024, "KB");
    else if (sizeLabel == "KB")
      return ReturnSize(size / 1024, "MB");
    else if (sizeLabel == "MB")
      return ReturnSize(size / 1024, "GB");
    else if (sizeLabel == "GB")
      return ReturnSize(size / 1024, "TB");
    else
      return ReturnSize(size / 1024, "PB");
  }
  else
  {
    if (sizeLabel.Length > 0)
      return string.Concat(size.ToString("0.00"), sizeLabel);
    else
      return string.Concat(size.ToString("0.00"), "Bytes");
  }
} 
```

然后你叫它：

```
return ReturnSize(size, string.Empty); 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2021-02-01T16:24:38.280

为了完全按照用户在其 Windows 环境中的习惯获得人类可读的字符串，您应该使用`StrFormatByteSize()`：

```
using System.Runtime.InteropServices; 
```

...

```
private long mFileSize;

[DllImport("Shlwapi.dll", CharSet = CharSet.Auto)]
public static extern int StrFormatByteSize(
    long fileSize,
    [MarshalAs(UnmanagedType.LPTStr)] StringBuilder buffer,
    int bufferSize);

public string HumanReadableFileSize
{
    get
    {
        var sb = new StringBuilder(20);
        StrFormatByteSize(mFileSize, sb, 20);
        return sb.ToString();
    }
} 
```

我在这里找到了这个：http: [//csharphelper.com/blog/2014/07/format-file-sizes-in-kb-mb-gb-and-so-forth-in-c/](http://csharphelper.com/blog/2014/07/format-file-sizes-in-kb-mb-gb-and-so-forth-in-c/)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-09-13T14:50:02.803

我的 2 美分：

*   千字节的前缀是 kB（小写 K）
*   由于这些功能是出于演示目的，因此应该提供一种文化，例如：`string.Format(CultureInfo.CurrentCulture, "{0:0.##} {1}", fileSize, unit);`
*   根据上下文，千字节可以是[1000 或 1024 字节](http://en.wikipedia.org/wiki/Kilobyte)。MB，GB等也是如此。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-02-25T11:31:35.620

另一种方法，物有所值。我喜欢上面提到的@humbads 优化解决方案，所以复制了原理，但我的实现方式略有不同。

我想它是否应该是一种扩展方法是值得商榷的（因为并非所有的 long 都必须是字节大小），但我喜欢它们，而且当我下次需要它时，我可以在某个地方找到它！

关于单位，我认为我一生中从未说过“千字节”或“兆字节”，虽然我对这种强制而不是进化的标准持怀疑态度，但我想从长远来看它会避免混淆.

```
public static class LongExtensions
{
    private static readonly long[] numberOfBytesInUnit;
    private static readonly Func<long, string>[] bytesToUnitConverters;

    static LongExtensions()
    {
        numberOfBytesInUnit = new long[6]    
        {
            1L << 10,    // Bytes in a Kibibyte
            1L << 20,    // Bytes in a Mebibyte
            1L << 30,    // Bytes in a Gibibyte
            1L << 40,    // Bytes in a Tebibyte
            1L << 50,    // Bytes in a Pebibyte
            1L << 60     // Bytes in a Exbibyte
        };

        // Shift the long (integer) down to 1024 times its number of units, convert to a double (real number), 
        // then divide to get the final number of units (units will be in the range 1 to 1023.999)
        Func<long, int, string> FormatAsProportionOfUnit = (bytes, shift) => (((double)(bytes >> shift)) / 1024).ToString("0.###");

        bytesToUnitConverters = new Func<long,string>[7]
        {
            bytes => bytes.ToString() + " B",
            bytes => FormatAsProportionOfUnit(bytes, 0) + " KiB",
            bytes => FormatAsProportionOfUnit(bytes, 10) + " MiB",
            bytes => FormatAsProportionOfUnit(bytes, 20) + " GiB",
            bytes => FormatAsProportionOfUnit(bytes, 30) + " TiB",
            bytes => FormatAsProportionOfUnit(bytes, 40) + " PiB",
            bytes => FormatAsProportionOfUnit(bytes, 50) + " EiB",
        };
    }

    public static string ToReadableByteSizeString(this long bytes)
    {
        if (bytes < 0)
            return "-" + Math.Abs(bytes).ToReadableByteSizeString();

        int counter = 0;
        while (counter < numberOfBytesInUnit.Length)
        {
            if (bytes < numberOfBytesInUnit[counter])
                return bytesToUnitConverters[counter](bytes);
            counter++;
        }
        return bytesToUnitConverters[counter](bytes);
    }
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-11-17T19:14:16.437

这是一个方法`Log10`：

```
using System;

class Program {
   static string NumberFormat(double n) {
      var n2 = (int)Math.Log10(n) / 3;
      var n3 = n / Math.Pow(1e3, n2);
      return String.Format("{0:f3}", n3) + new[]{"", " k", " M", " G"}[n2];
   }

   static void Main() {
      var s = NumberFormat(9012345678);
      Console.WriteLine(s == "9.012 G");
   }
} 
```

[https://docs.microsoft.com/dotnet/api/system.math.log10](https://docs.microsoft.com/dotnet/api/system.math.log10)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-09-06T13:16:14.437

这是[@deepee1 的答案的](https://stackoverflow.com/a/4975942/155537)[BigInteger](https://docs.microsoft.com/en-us/dotnet/api/system.numerics.biginteger?view=net-5.0)版本，它绕过了 longs 的大小限制（因此支持 yottabyte 并且理论上支持之后的任何内容）：

```
public static string ToBytesString(this BigInteger byteCount, string format = "N3")
{
    string[] suf = { "B", "KiB", "MiB", "GiB", "TiB", "PiB", "EiB", "YiB" };
    if (byteCount.IsZero)
    {
        return $"{0.0.ToString(format)} {suf[0]}";
    }

    var abs = BigInteger.Abs(byteCount);
    var place = Convert.ToInt32(Math.Floor(BigInteger.Log(abs, 1024)));
    var pow = Math.Pow(1024, place);

    // since we need to do this with integer math, get the quotient and remainder
    var quotient = BigInteger.DivRem(abs, new BigInteger(pow), out var remainder);
    // convert the remainder to a ratio and add both back together as doubles
    var num = byteCount.Sign * (Math.Floor((double)quotient) + ((double)remainder / pow));

    return $"{num.ToString(format)} {suf[place]}";
} 
```

# tsql - SQL 命令添加数据库图表

> ID：281652
> 
> 赞同：5
> 
> 时间：2008-11-11T17:54:59.910
> 
> 标签：tsql, ssms, database-diagramming

sqlserver 2008 上是否有可以运行的 tsql 命令以启用数据库图表，而不是出现此对话框：

此数据库没有使用数据库图表所需的一个或多个支持对象。你想创建它们吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T18:35:09.580

该脚本有点太长，无法在此处添加，但您可以执行以下操作。1) 创建一个新的数据库。2) 启动 sql server profiler 3) 在 management studio 中单击“Database Diagrams”文件夹。4) 清除分析器。5) 确认带有提示的消息框以启用图表。6) Profiler 现在包含启用图表的脚本。7) 在分析器中选择脚本并从底部窗格复制输出。

金

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-03-17T10:06:16.440

这是创建对象以启用数据库图表所需的代码。

```
IF OBJECT_ID(N'dbo.sp_upgraddiagrams') IS NULL and IS_MEMBER('db_owner') = 1
BEGIN
    EXEC sp_executesql N'
    CREATE PROCEDURE dbo.sp_upgraddiagrams
    AS
    BEGIN
        IF OBJECT_ID(N''dbo.sysdiagrams'') IS NOT NULL
            return 0;

        CREATE TABLE dbo.sysdiagrams
        (
            name sysname NOT NULL,
            principal_id int NOT NULL,  -- we may change it to varbinary(85)
            diagram_id int PRIMARY KEY IDENTITY,
            version int,

            definition varbinary(max)
            CONSTRAINT UK_principal_name UNIQUE
            (
                principal_id,
                name
            )
        );

        /* Add this if we need to have some form of extended properties for diagrams */
        /*
        IF OBJECT_ID(N''dbo.sysdiagram_properties'') IS NULL
        BEGIN
            CREATE TABLE dbo.sysdiagram_properties
            (
                diagram_id int,
                name sysname,
                value varbinary(max) NOT NULL
            )
        END
        */

        IF OBJECT_ID(N''dbo.dtproperties'') IS NOT NULL
        begin
            insert into dbo.sysdiagrams
            (
                [name],
                [principal_id],
                [version],
                [definition]
            )
            select   
                convert(sysname, dgnm.[uvalue]),
                DATABASE_PRINCIPAL_ID(N''dbo''),            -- will change to the sid of sa
                0,                          -- zero for old format, dgdef.[version],
                dgdef.[lvalue]
            from dbo.[dtproperties] dgnm
                inner join dbo.[dtproperties] dggd on dggd.[property] = ''DtgSchemaGUID'' and dggd.[objectid] = dgnm.[objectid] 
                inner join dbo.[dtproperties] dgdef on dgdef.[property] = ''DtgSchemaDATA'' and dgdef.[objectid] = dgnm.[objectid]

            where dgnm.[property] = ''DtgSchemaNAME'' and dggd.[uvalue] like N''_EA3E6268-D998-11CE-9454-00AA00A3F36E_'' 
            return 2;
        end
        return 1;
    END
    '

END

-- This sproc could be executed by any other users than dbo
IF IS_MEMBER('db_owner') = 1
    EXEC dbo.sp_upgraddiagrams;

IF OBJECT_ID(N'dbo.sp_helpdiagrams') IS NULL and IS_MEMBER('db_owner') = 1
BEGIN
    EXEC sp_executesql N'
    CREATE PROCEDURE dbo.sp_helpdiagrams
    (
        @diagramname sysname = NULL,
        @owner_id int = NULL
    )
    WITH EXECUTE AS N''dbo''
    AS
    BEGIN
        DECLARE @user sysname
        DECLARE @dboLogin bit
        EXECUTE AS CALLER;
            SET @user = USER_NAME();
            SET @dboLogin = CONVERT(bit,IS_MEMBER(''db_owner''));
        REVERT;
        SELECT
            [Database] = DB_NAME(),
            [Name] = name,
            [ID] = diagram_id,
            [Owner] = USER_NAME(principal_id),
            [OwnerID] = principal_id
        FROM
            sysdiagrams
        WHERE
            (@dboLogin = 1 OR USER_NAME(principal_id) = @user) AND
            (@diagramname IS NULL OR name = @diagramname) AND
            (@owner_id IS NULL OR principal_id = @owner_id)
        ORDER BY
            4, 5, 1
    END
    '

    GRANT EXECUTE ON dbo.sp_helpdiagrams TO public
    DENY EXECUTE ON dbo.sp_helpdiagrams TO guest
END

IF OBJECT_ID(N'dbo.sp_helpdiagramdefinition') IS NULL and IS_MEMBER('db_owner') = 1
BEGIN
    EXEC sp_executesql N'
    CREATE PROCEDURE dbo.sp_helpdiagramdefinition
    (
        @diagramname    sysname,
        @owner_id   int = null      
    )
    WITH EXECUTE AS N''dbo''
    AS
    BEGIN
        set nocount on

        declare @theId      int
        declare @IsDbo      int
        declare @DiagId     int
        declare @UIDFound   int

        if(@diagramname is null)
        begin
            RAISERROR (N''E_INVALIDARG'', 16, 1);
            return -1
        end

        execute as caller;
        select @theId = DATABASE_PRINCIPAL_ID();
        select @IsDbo = IS_MEMBER(N''db_owner'');
        if(@owner_id is null)
            select @owner_id = @theId;
        revert; 

        select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname;
        if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId ))
        begin
            RAISERROR (''Diagram does not exist or you do not have permission.'', 16, 1);
            return -3
        end

        select version, definition FROM dbo.sysdiagrams where diagram_id = @DiagId ; 
        return 0
    END
    '

    GRANT EXECUTE ON dbo.sp_helpdiagramdefinition TO public
    DENY EXECUTE ON dbo.sp_helpdiagramdefinition TO guest
END

IF OBJECT_ID(N'dbo.sp_creatediagram') IS NULL and IS_MEMBER('db_owner') = 1
BEGIN
    EXEC sp_executesql N'
    CREATE PROCEDURE dbo.sp_creatediagram
    (
        @diagramname    sysname,
        @owner_id       int = null,     
        @version        int,
        @definition     varbinary(max)
    )
    WITH EXECUTE AS ''dbo''
    AS
    BEGIN
        set nocount on

        declare @theId int
        declare @retval int
        declare @IsDbo  int
        declare @userName sysname
        if(@version is null or @diagramname is null)
        begin
            RAISERROR (N''E_INVALIDARG'', 16, 1);
            return -1
        end

        execute as caller;
        select @theId = DATABASE_PRINCIPAL_ID(); 
        select @IsDbo = IS_MEMBER(N''db_owner'');
        revert; 

        if @owner_id is null
        begin
            select @owner_id = @theId;
        end
        else
        begin
            if @theId <> @owner_id
            begin
                if @IsDbo = 0
                begin
                    RAISERROR (N''E_INVALIDARG'', 16, 1);
                    return -1
                end
                select @theId = @owner_id
            end
        end
        -- next 2 line only for test, will be removed after define name unique
        if EXISTS(select diagram_id from dbo.sysdiagrams where principal_id = @theId and name = @diagramname)
        begin
            RAISERROR (''The name is already used.'', 16, 1);
            return -2
        end

        insert into dbo.sysdiagrams(name, principal_id , version, definition)
                VALUES(@diagramname, @theId, @version, @definition) ;

        select @retval = @@IDENTITY 
        return @retval
    END
    '

    GRANT EXECUTE ON dbo.sp_creatediagram TO public
    DENY EXECUTE ON dbo.sp_creatediagram TO guest
END

IF OBJECT_ID(N'dbo.sp_renamediagram') IS NULL and IS_MEMBER('db_owner') = 1
BEGIN
    EXEC sp_executesql N'
    CREATE PROCEDURE dbo.sp_renamediagram
    (
        @diagramname        sysname,
        @owner_id       int = null,
        @new_diagramname    sysname

    )
    WITH EXECUTE AS ''dbo''
    AS
    BEGIN
        set nocount on
        declare @theId          int
        declare @IsDbo          int

        declare @UIDFound       int
        declare @DiagId         int
        declare @DiagIdTarg     int
        declare @u_name         sysname
        if((@diagramname is null) or (@new_diagramname is null))
        begin
            RAISERROR (''Invalid value'', 16, 1);
            return -1
        end

        EXECUTE AS CALLER;
        select @theId = DATABASE_PRINCIPAL_ID();
        select @IsDbo = IS_MEMBER(N''db_owner''); 
        if(@owner_id is null)
            select @owner_id = @theId;
        REVERT;

        select @u_name = USER_NAME(@owner_id)

        select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
        if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId))
        begin
            RAISERROR (''Diagram does not exist or you do not have permission.'', 16, 1)
            return -3
        end

        -- if((@u_name is not null) and (@new_diagramname = @diagramname))  -- nothing will change
        --  return 0;

        if(@u_name is null)
            select @DiagIdTarg = diagram_id from dbo.sysdiagrams where principal_id = @theId and name = @new_diagramname
        else
            select @DiagIdTarg = diagram_id from dbo.sysdiagrams where principal_id = @owner_id and name = @new_diagramname

        if((@DiagIdTarg is not null) and  @DiagId <> @DiagIdTarg)
        begin
            RAISERROR (''The name is already used.'', 16, 1);
            return -2
        end     

        if(@u_name is null)
            update dbo.sysdiagrams set [name] = @new_diagramname, principal_id = @theId where diagram_id = @DiagId
        else
            update dbo.sysdiagrams set [name] = @new_diagramname where diagram_id = @DiagId
        return 0
    END
    '

    GRANT EXECUTE ON dbo.sp_renamediagram TO public
    DENY EXECUTE ON dbo.sp_renamediagram TO guest
END

IF OBJECT_ID(N'dbo.sp_alterdiagram') IS NULL and IS_MEMBER('db_owner') = 1
BEGIN
    EXEC sp_executesql N'
    CREATE PROCEDURE dbo.sp_alterdiagram
    (
        @diagramname    sysname,
        @owner_id   int = null,
        @version    int,
        @definition     varbinary(max)
    )
    WITH EXECUTE AS ''dbo''
    AS
    BEGIN
        set nocount on

        declare @theId          int
        declare @retval         int
        declare @IsDbo          int

        declare @UIDFound       int
        declare @DiagId         int
        declare @ShouldChangeUID    int

        if(@diagramname is null)
        begin
            RAISERROR (''Invalid ARG'', 16, 1)
            return -1
        end

        execute as caller;
        select @theId = DATABASE_PRINCIPAL_ID();     
        select @IsDbo = IS_MEMBER(N''db_owner''); 
        if(@owner_id is null)
            select @owner_id = @theId;
        revert;

        select @ShouldChangeUID = 0
        select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 

        if(@DiagId IS NULL or (@IsDbo = 0 and @theId <> @UIDFound))
        begin
            RAISERROR (''Diagram does not exist or you do not have permission.'', 16, 1);
            return -3
        end

        if(@IsDbo <> 0)
        begin
            if(@UIDFound is null or USER_NAME(@UIDFound) is null) -- invalid principal_id
            begin
                select @ShouldChangeUID = 1 ;
            end
        end

        -- update dds data          
        update dbo.sysdiagrams set definition = @definition where diagram_id = @DiagId ;

        -- change owner
        if(@ShouldChangeUID = 1)
            update dbo.sysdiagrams set principal_id = @theId where diagram_id = @DiagId ;

        -- update dds version
        if(@version is not null)
            update dbo.sysdiagrams set version = @version where diagram_id = @DiagId ;

        return 0
    END
    '

    GRANT EXECUTE ON dbo.sp_alterdiagram TO public
    DENY EXECUTE ON dbo.sp_alterdiagram TO guest
END

IF OBJECT_ID(N'dbo.sp_dropdiagram') IS NULL and IS_MEMBER('db_owner') = 1
BEGIN
    EXEC sp_executesql N'
    CREATE PROCEDURE dbo.sp_dropdiagram
    (
        @diagramname    sysname,
        @owner_id   int = null
    )
    WITH EXECUTE AS ''dbo''
    AS
    BEGIN
        set nocount on
        declare @theId          int
        declare @IsDbo          int

        declare @UIDFound       int
        declare @DiagId         int

        if(@diagramname is null)
        begin
            RAISERROR (''Invalid value'', 16, 1);
            return -1
        end

        EXECUTE AS CALLER;
        select @theId = DATABASE_PRINCIPAL_ID();
        select @IsDbo = IS_MEMBER(N''db_owner''); 
        if(@owner_id is null)
            select @owner_id = @theId;
        REVERT; 

        select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
        if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId))
        begin
            RAISERROR (''Diagram does not exist or you do not have permission.'', 16, 1)
            return -3
        end

        delete from dbo.sysdiagrams where diagram_id = @DiagId;

        return 0;
    END
    '

    GRANT EXECUTE ON dbo.sp_dropdiagram TO public
    DENY EXECUTE ON dbo.sp_dropdiagram TO guest
END

IF OBJECT_ID(N'dbo.fn_diagramobjects') IS NULL and IS_MEMBER('db_owner') = 1
BEGIN
    EXEC sp_executesql N'
    CREATE FUNCTION dbo.fn_diagramobjects() 
    RETURNS int
    WITH EXECUTE AS N''dbo''
    AS
    BEGIN
        declare @id_upgraddiagrams      int
        declare @id_sysdiagrams         int
        declare @id_helpdiagrams        int
        declare @id_helpdiagramdefinition   int
        declare @id_creatediagram   int
        declare @id_renamediagram   int
        declare @id_alterdiagram    int 
        declare @id_dropdiagram     int
        declare @InstalledObjects   int

        select @InstalledObjects = 0

        select  @id_upgraddiagrams = object_id(N''dbo.sp_upgraddiagrams''),
            @id_sysdiagrams = object_id(N''dbo.sysdiagrams''),
            @id_helpdiagrams = object_id(N''dbo.sp_helpdiagrams''),
            @id_helpdiagramdefinition = object_id(N''dbo.sp_helpdiagramdefinition''),
            @id_creatediagram = object_id(N''dbo.sp_creatediagram''),
            @id_renamediagram = object_id(N''dbo.sp_renamediagram''),
            @id_alterdiagram = object_id(N''dbo.sp_alterdiagram''), 
            @id_dropdiagram = object_id(N''dbo.sp_dropdiagram'')

        if @id_upgraddiagrams is not null
            select @InstalledObjects = @InstalledObjects + 1
        if @id_sysdiagrams is not null
            select @InstalledObjects = @InstalledObjects + 2
        if @id_helpdiagrams is not null
            select @InstalledObjects = @InstalledObjects + 4
        if @id_helpdiagramdefinition is not null
            select @InstalledObjects = @InstalledObjects + 8
        if @id_creatediagram is not null
            select @InstalledObjects = @InstalledObjects + 16
        if @id_renamediagram is not null
            select @InstalledObjects = @InstalledObjects + 32
        if @id_alterdiagram  is not null
            select @InstalledObjects = @InstalledObjects + 64
        if @id_dropdiagram is not null
            select @InstalledObjects = @InstalledObjects + 128

        return @InstalledObjects 
    END
    '

    GRANT EXECUTE ON dbo.fn_diagramobjects TO public
    DENY EXECUTE ON dbo.fn_diagramobjects TO guest
END

if IS_MEMBER('db_owner') = 1
BEGIN
    declare @val int
    select @val = 1
    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.sysdiagrams') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'TABLE', N'sysdiagrams', NULL, NULL
    end

    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.sp_upgraddiagrams') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'PROCEDURE', N'sp_upgraddiagrams', NULL, NULL
    end

    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.sp_helpdiagrams') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'PROCEDURE', N'sp_helpdiagrams', NULL, NULL
    end

    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.sp_helpdiagramdefinition') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'PROCEDURE', N'sp_helpdiagramdefinition', NULL, NULL
    end

    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.sp_creatediagram') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'PROCEDURE', N'sp_creatediagram', NULL, NULL
    end

    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.sp_renamediagram') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'PROCEDURE', N'sp_renamediagram', NULL, NULL
    end

    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.sp_alterdiagram') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'PROCEDURE', N'sp_alterdiagram', NULL, NULL
    end

    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.sp_dropdiagram') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'PROCEDURE', N'sp_dropdiagram', NULL, NULL
    end

    if NOT EXISTS(  select major_id 
                    from sys.extended_properties
                    where major_id = object_id(N'dbo.fn_diagramobjects') and class = 1 and minor_id = 0 and name = N'microsoft_database_tools_support')
    begin
        exec sp_addextendedproperty N'microsoft_database_tools_support', @val, 'SCHEMA', N'dbo', 'FUNCTION', N'fn_diagramobjects', NULL, NULL
    end
END

/* Clean up */
/*
DROP FUNCTION dbo.fn_diagramobjects
DROP PROCEDURE dbo.sp_dropdiagram
DROP PROCEDURE dbo.sp_alterdiagram
DROP PROCEDURE dbo.sp_renamediagram
DROP PROCEDURE dbo.sp_creatediagram
DROP PROCEDURE dbo.sp_helpdiagramdefinition
DROP PROCEDURE dbo.sp_helpdiagrams
DROP TABLE dbo.sysdiagrams
DROP PROCEDURE dbo.sp_upgraddiagrams
*/ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-04-07T22:46:28.427

是的，但首先您必须选择“是”选项来创建支持对象以使用数据库图表。稍后在需要配置数据库图表的数据库下运行以下选择查询。

从 dtproperties 中选择 *

通过使用以下查询向表中插入列“uvalue”来更改表 dtproperties。因为该列将在 sproc 中使用

ALTER TABLE dtproperties ADD [uvalue] nvarchar

```
CREATE PROCEDURE dbo.sp_upgraddiagrams
AS
BEGIN
    IF OBJECT_ID(N'dbo.sysdiagrams') IS NOT NULL
        return 0;

    CREATE TABLE dbo.sysdiagrams
    (
        name sysname NOT NULL,
        principal_id int NOT NULL,  -- we may change it to varbinary(85)
        diagram_id int PRIMARY KEY IDENTITY,
        version int,

        definition varbinary(max)
        CONSTRAINT UK_principal_name UNIQUE
        (
            principal_id,
            name
        )
    );

    -- Add this if we need to have some form of extended properties for diagrams */

    IF OBJECT_ID(N'dbo.sysdiagram_properties') IS NULL
    BEGIN
        CREATE TABLE dbo.sysdiagram_properties
        (
            diagram_id int,
            name sysname,
            value varbinary(max) NOT NULL
        )
    END

    IF OBJECT_ID(N'dbo.dtproperties') IS NOT NULL
    begin
        insert into dbo.sysdiagrams
        (
            [name],
            [principal_id],
            [version],
            [definition]
        )
        select   
            convert(sysname, dgnm.[uvalue]),
            DATABASE_PRINCIPAL_ID(N'dbo'),          -- will change to the sid of sa
            0,                          -- zero for old format, dgdef.[version],
            dgdef.[lvalue]
        from dbo.[dtproperties] dgnm
            inner join dbo.[dtproperties] dggd on dggd.[property] = 'DtgSchemaGUID' and dggd.[objectid] = dgnm.[objectid]   
            inner join dbo.[dtproperties] dgdef on dgdef.[property] = 'DtgSchemaDATA' and dgdef.[objectid] = dgnm.[objectid]

        where dgnm.[property] = 'DtgSchemaNAME' and dggd.[uvalue] like N'_EA3E6268-D998-11CE-9454-00AA00A3F36E_' 
        return 2;
    end
    return 1;
END 
```

所以最后右键点击数据库创建数据库图表[Invalid Column name [1](https://i.stack.imgur.com/S8ZDc.png)

# vba - 使用 VBA 拆分 Word 文档

> ID：281657
> 
> 赞同：1
> 
> 时间：2008-11-11T17:55:34.060
> 
> 标签：vba, ms-word

我有一个以目录开头的 Word 文档。我需要根据目录将文档分成几个部分。目录具有章节标题和章节编号。

如何使用 VBA 根据节号/名称拆分文档？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-11T18:07:32.040

如果这些确实是 Word 意义上的 Sections，那么您可以访问 ActiveDocument 对象中的 Sections 集合。然后可以将每个部分复制到新文档并保存。如果您的部分实际上是标题级别或类似的东西，您的宏可以搜索正确标题级别的标题样式，选择标题下的部分，然后将选择保存到上面的新文档中。

# asp.net - ASP.NET - 关注点分离

> ID：281664
> 
> 赞同：1
> 
> 时间：2008-11-11T17:58:22.137
> 
> 标签：asp.net, unit-testing, mocking, separation-of-concerns, isolation

想象以下场景 - 我们有 Page1，其中包含控件 Control A 和 Control B。

假设控件 A 有一个按钮，单击此按钮时我们希望控件 B 做出反应。但是我们想以一种抽象的方式来做这件事，即我们不能让控件 B 知道关于控件 A 的任何事情，反之亦然。

这样我们就可以单独开发这些控件，并通过单元测试来驱动它们。

现在，我以为我有解决方案，只是想知道你们对此有何看法。

单击控件 A 的按钮时，我在 Session 上放置了一条“消息”，即 Session["MESSAGES"] = "ControlA_Click"。

在 Page1 中，在 Page_LoadComplete() 上，我调用了 ProcessMessages，如下所示：

```
 List<Message> messages = SessionMessages.GetMessageList(Page);
        foreach(Message m in messages)
        {
            //Get Controls
            ControlA controlA = FindControl("controlA") as ControlA;
            controlA .ProcessMessage(m);

            ControlB controlB = FindControl("controlB") as ControlB;
            controlB.ProcessMessage(m);
      } 
```

在 ControlB 的 ProcessMessage() 方法中，我们可以对 ControlB 感兴趣的消息做出反应，如下所示：

```
 if (m.MessageName == SessionMessages.C_MESSAGE_SEARCH)
{
    this.Visible = true;
} 
```

对我来说，这似乎有效。它允许我们完全独立地开发这些控件，同时仍然允许在抽象级别进行控件间通信。

我能想到的唯一可能导致崩溃的*可能*是与页面和用户控件相关的 ASP.NET 生命周期。我认为它的方式是在拥有页面上调用 Page_LoadComplete() 之前，应该在控件上处理所有事件。

想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T18:08:49.807

1.  控件 A 应该引发一个事件
2.  包含控件的页面订阅事件，然后在另一个控件中调用适当的方法
3.  控件 B 应该处理 message()

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T18:03:14.980

一个有趣的滥用会话......

您也可以让消息队列属于托管页面

我建议您让托管页面对控件进行一些操作以响应消息，而不是使控件变得“智能”-实际上不需要按钮“智能”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T18:31:22.863

正如 Briggie 所暗示的那样——这正是 Model-View Presenter 的全部意义所在。这[是一篇](http://www.cornetdesign.com/2007/10/tdd-of-winform-app-part-2-presenting.html)关于 .NET 中的 MVP 的文章，如果你想自己动手的话。

理想情况下，您希望将 MVC 框架视为将所有内容分离出来时可以做什么的示例。

我通常做的是让按钮单击事件引发特定于域的事件，例如：

```
 private void ControlA_OnClick(..)
{
  if(LoginRequested != null)
    LoginRequested(this, loginObj);
} 
```

这样就清楚地说明了为什么有人会单击按钮并将分离带回家。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T18:18:36.917

这不是数据绑定的用途吗？控件 A 响应更新模型的事件，然后对其依赖项调用 databind。

如果你想做一个消息系统，设计它的发布者和订阅者不需要互相了解，只需要消息本身。创建一个类似的接口：

```
public interface IHandle<T> where T:IMessage
{
     void Process(T message)
} 
```

您将需要一种方法来发现哪些控件实现了它并构建消息类型-> 处理程序的映射，查看主要 DI 框架处理对 ASP .NET 控件的属性注入的方式，以了解如何实现这一点。然后，您可以使用单个 SendMessage 方法，该方法负责将消息分派给可以处理该消息的所有控件。在表单 UI 中更常见的是这种模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T21:03:58.297

你所拥有的几乎是一个[EventBroker](http://msforge.net/blogs/paki/archive/2007/11/20/EventBroker-implementation-in-C_2300_-full-source-code.aspx)。我不认为 Session 是合适的地方，因为没有必要跨越请求。[HttpContext](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.items.aspx)可能有效，但除非我希望在 IHttpModules 和 IHttpHandlers 之间共享消息总线，否则我可能只是使用自定义控件可以将其 Page 实例转换为的基 Page 类：

```
interface IEventBroker {
 void Send(Message m);
}

class ControlA {
  void MyButton_Click(object sender, EventArgs e) {
     var eb = this.Page as IEventBroker;
     if (eb != null) eb.Send(new Message());
  }
} 
```

或为控件提供对 EventBroker 的引用 - 在这种情况下，我可能会将 EventBroker 本身设为控件并将 ID 提供给每个控件，以便它们可以使用 Page.FindControl。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T18:16:15.890

查看[Managed Extensibility Framework](http://www.codeplex.com/MEFContrib) Contrib 项目。他们只有一个示例网站，正是您想要的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T18:19:00.660

这种方法存在一些问题，例如：
- 编译时未验证“事件”（您很容易输入错误的事件名称并在运行时或更糟糕的情况下发现这一点）
- 用通信内容填充会话
- 您需要输入控件名称作为字符串 - 如果有多个控件是这些事件的订阅者，则可能会变得难以控制
- 当需要在控件之间发送参数时，解决方案将变得更加难以管理

更好的方法是通过在控件上声明事件来使用内置事件机制：

```
public event EventHandler SpecialClick; 
```

每个需要做某事的控件都会订阅这个事件

```
controlA.SpecialClick += new EventHandler(controlA_SpecialClick) 
```

使用正常的 dot.net 事件。

# asp.net - ASP.NET 开发服务器或本地主机 IIS？

> ID：281667
> 
> 赞同：26
> 
> 时间：2008-11-11T17:59:06.033
> 
> 标签：asp.net, iis, localhost, cassini

目前，我们的开发团队在他们的本地机器上设置了他们在 IIS 中工作的所有网站。我们正在考虑改用内置的 ASP.NET 开发服务器。

这是一个好主意吗？使用 ASP.NET 开发服务器的优点/缺点是什么？有什么我们应该注意的问题吗？

谢谢。

注意：在 Win XP / IIS 5 / VS2005 上运行

**编辑：**

没有意识到它被称为 Cassini .. [Cassini v IIS here](https://stackoverflow.com/questions/103785/what-are-the-disadvantages-of-using-cassini-instead-of-iis)的更多答案。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-11T18:05:12.450

ASP.NET Dev WebService 没有什么是 IIS 不能做到的（您可以设置断点等，只需将 VS 调试器附加到 ASP.NET 运行时）。

但是，ASP.NET Dev WebService 并不代表真正的生产环境，因此您可能会遇到部署到生产环境时不会预料到的陷阱。

因此，我要求所有开发都在本地机器上使用 IIS 完成。在 IIS 中配置站点并不需要太多工作。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-11T18:06:59.980

这是一个非常好的主意。以下是一些原因：

*   您不再*需要*对您的机器进行管理员访问以进行 Web 开发（它仍然很有帮助）。
*   测试快速更改和继续工作要容易得多，而且[更快的迭代周期是好的](http://www.codinghorror.com/blog/archives/000788.html)。
*   它可以简化开发环境的设置和部署。
*   IIS 的 XP 版本具有 Cassini 回避的服务器版本中不存在的限制。

我知道反对的唯一论点是有几个非常罕见的边缘情况，其中 Cassini 内置服务器不完全模仿 IIS，因为您使用的是奇数端口号。我怀疑您是否会遇到它们，并且***使用 Cassini 作为主要开发环境并不妨碍开发人员也可以访问机器上的 IIS。*** 事实上，对于大多数小型工作，我首选的设置是 Cassini，然后部署到我的本地 IIS 以进行更深入的测试，然后再将代码移回共享源存储库。

**[编辑]**
忘记了 url 重写。为此，您确实需要 IIS。内置 XP IIS 的一个限制示例是，您只能在 XP 中使用一个站点（可以有多个应用程序，但那是另一回事）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-14T03:32:50.050

正如我在这里所说：[https](https://stackoverflow.com/questions/103785/what-are-the-disadvantages-of-using-cassini-instead-of-iis#104264) ://stackoverflow.com/questions/103785/what-are-the-disadvantages-of-using-cassini-instead-of-iis您的开发人员需要注意 Cassini 以本地用户身份运行，这通常是开发人员的管理员帐户。开发人员将能够访问他们的帐户可以访问的任何文件或资源，这与他们在 IIS 6 服务器上看到的完全不同。

另一个很大的问题是使用 IIS 和 vdirs 而不是单独的 Cassini 实例来调试 Web 服务要容易得多。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-11T18:10:33.170

我不得不为一个项目切换（返回）到 IIS，因为我需要设置一些**虚拟目录**，而这在 ASP.NET 开发 Web 服务器上是不可能的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T18:07:08.123

我已经使用了这两种方法，我更喜欢在本地使用 IIS，而不是使用内置服务器。至少您与最终的部署设置更加一致。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-11T18:06:17.393

我知道在某一时刻我遇到了一个问题，即身份验证在 Cassini 上无法按预期工作（内置开发服务器）

此外，如果您需要测试 ISAPI 插件（例如重写器）之类的东西，我不确定在 Cassini 上是如何完成的。

不断变化的端口也让我感到相当不安。此外，对于您的解决方案中的每个 Web 项目，它都会启动另一个 Casini 服务器实例，每个实例占用 20 到 50 MB 的内存。

我一直在使用 IIS，它很容易设置，而且你们已经在这样做了……

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-21T03:05:56.703

我在使用 asp.net 开发服务器时遇到了以下限制：

1.  不支持虚拟目录。如果您的应用程序中需要它们，IIS 似乎是您唯一的选择

2.  经典的 asp 页面不在开发服务器中运行。因此，如果您有一个混合 Web 应用程序（就像我现在在我的客户端上一样），IIS 似乎是解决方案

3.  如果您需要管理 UI 来配置设置，IIS 效果更好

当然 IIS 要求您是本地管理员。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-11T18:12:12.497

此外，在使用 IIS 5.1 时，一定要获取[JetStat IIS Admin](http://www.jetstat.com/iisadmin/download.asp)，它添加了在 IIS 5 上开箱即用的功能，例如能够设置多个站点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-09-15T05:03:29.117

我注意到的另一个区别是 Cassini 作为 32 位进程运行并且您无法控制它，而您可以控制 IIS 应用程序的应用程序池以禁止 32 位（假设您的 IIS 在 64 位服务器上运行）。如果您的 Web 应用程序要在 64 位进程（例如 SharePoint Foundation/Server 2010）中调用 API，这一点尤其重要。当您使用 Cassini 作为调试服务器来调试您的 Web 应用程序时，您将获得“URL 上的 Web 应用程序可以找不到。验证您是否正确键入了 URL”在实例化对象时键入错误。如果您使用 IIS 进行调试，该应用程序在以 64 位运行的应用程序池中运行，并且具有允许访问共享点数据库的标识，那么您将能够正确调试。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-11-28T23:05:08.143

在 VS12 中，开发服务器很慢，下载一个 2kbyte 的文件需要几秒钟。这在 vs10 中没有发生。当您有一堆 jquery 文件和 css 时，这是一个真正的问题。此外，每个页面都需要所有 css/js 文件。非常非常慢的回归测试。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-21T03:14:40.700

我在开发服务器上遇到的主要问题是带有存储在线程上下文中的自定义安全主体的 SerializationExceptions。详情[在这里](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=274696 "这里")。

# c# - 使用 XML 时引用未声明的实体异常

> ID：281682
> 
> 赞同：24
> 
> 时间：2008-11-11T18:04:54.447
> 
> 标签：c#, xml, dtd

我正在尝试设置 xmldoc 的 innerxml 但得到异常：引用未声明的实体

```
XmlDocument xmldoc = new XmlDocument();
string text = "Hello, I am text &alpha; &nbsp; &ndash; &mdash;"
xmldoc.InnerXml = "<p>" + text + "</p>"; 
```

这会引发异常：

> 引用未声明的实体“alpha”。第 2 行，位置 2..

我将如何解决这个问题？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-11T18:11:46.273

XML，不像 HTML 没有定义实体（即对 UNICODE 字符的命名引用），所以 α — 等不翻译成相应的字符。您必须改用数值。您只能使用 < 和& 在 XML 中

如果要创建 HTML，请改用 HtmlDocument。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-09T06:50:09.193

在 .Net 中，您可以使用`System.Xml.XmlConvert`该类：

```
string text = XmlConvert.EncodeName("Hello &alpha;"); 
```

或者，您可以通过将声明放在 DOCTYPE 声明中的方括号之间来在本地声明实体。将以下标头添加到您的 xml：

```
<!DOCTYPE documentElement[
<!ENTITY Alpha "&#913;">
<!ENTITY ndash "&#8211;">
<!ENTITY mdash "&#8212;">
]> 
```

在“html 字符实体”上搜索实体定义。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-11T18:06:32.993

尝试将 &Alpha 替换为

```
 &#913; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-11T18:21:14.600

前面的答案是对的。另一种选择是将您的 html 文档链接到定义这些字符实体的 DTD，这是标准的 XHTML DTD 定义。您的 xml 文件应包含以下声明：

```
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
            "http://www.w3.org/TR/html4/strict.dtd"> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-28T09:13:36.573

使用字符串 System.Net.WebUtility.HtmlDecode(string) 将所有 HTML 实体编码字符解码为其 Unicode 变体。它可从 dot.net 框架 4 获得

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-02-22T09:28:12.123

[https://stackoverflow.com/a/842836/15178054](https://stackoverflow.com/a/842836/15178054)中描述的解决方案的变体 是：在单独的文件中声明实体，然后从 XML 声明子集中引用该文件。下面是一个如何在 XSLT 样式表中使用 HTML 实体的示例。

```
<!DOCTYPE xsl:stylesheet
[
<!ENTITY % htmlentities SYSTEM "html-entity-list.ent">
%htmlentities;
]>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"...> 
```

带有实体的外部文件是“html-entitiy-list.ent”。我是从[https://html.spec.whatwg.org/entities.json](https://html.spec.whatwg.org/entities.json)生成的。生成文件中的一个示例条目是：

```
<!ENTITY Auml "Ä"> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T18:24:47.697

您还可以将 InnerText 设置为`"Hello, I am text α – —"`，使 XmlDocument 自动转义它们。我认为。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-17T22:43:57.270

HtmlDocument 的使用不适合我的情况，我们的系统有一个自定义的 XmlUrlResolver，我们使用它来加载 xml。

```
//setup
public class CustomXmlResolver : XmlUrlResolver { /* ... */ }
String originalXml; //fetched xml with html entities in it

var doc = new XmlDocument();
doc.XmlResolver = new AdCastXmlResolver();

//making use of a transitional dtd
doc.LoadXml("<!DOCTYPE html SYSTEM \"xhtml1-transitional.dtd\" > " + originalXml); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-01-04T08:36:37.160

如果您确实想使用您习惯的 HTML 实体名称，W3C 已经为您提供了覆盖并生成了“字符的 XML 实体定义” [http://www.w3.org/TR/xml-entity-names/](http://www.w3.org/TR/xml-entity-names/)，它本质上是一个与 HTML 非常相似的命名实体列表。但如上所述，这不是内置在 XML 中的，需要由想要使用这些命名实体的 XML 应用程序显式支持。

# asp.net - 如何创建名称中带有破折号的 ASP.NET 自定义控件？

> ID：281694
> 
> 赞同：1
> 
> 时间：2008-11-11T18:08:13.270
> 
> 标签：asp.net, custom-server-controls

我想设置一个 ASP.NET 自定义控件，使其具有自定义名称，特别是其中带有连字符，因此它在标记中可能如下所示：

```
<rp:do-something runat="server" id="doSomething1" />
```

我不介意这种语法是否需要在 web.config 中设置标签映射或类似的东西，但[tagMapping 元素](http://msdn.microsoft.com/en-us/library/ms164641.aspx "标签映射元素")与我想做的不太匹配。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T18:17:54.203

由于类命名的限制，我认为这是不可能的。我不相信您可以在标记中引用控件类而不按名称引用它

您需要连字符是否有特定原因？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T18:44:52.290

约翰，你是对的。我在 Reflector 中进行了一些搜索，看起来它没有到达那里：

```
Type ITagNameToTypeMapper.GetControlType(string tagName, IDictionary attribs)
{
    string str;
    string str2 = this._nsRegisterEntry.Namespace;
    if (string.IsNullOrEmpty(str2))
    {
        str = tagName;
    }
    else
    {
        str = str2 + "." + tagName;
    }
    if (this._assembly != null)
    {
        Type type = null;
        try
        {
            type = this._assembly.GetType(str, true, true);
        } 
```

在 System.Web.UI.NamespaceTagNameToTypeMapper、System.Web 中实现。

@Jonathan：我有一个特定的商业原因想要这样做。那好吧。

# asp.net - 如何在 asp.net 中找到远程主机名？

> ID：281697
> 
> 赞同：3
> 
> 时间：2008-11-11T18:09:20.553
> 
> 标签：asp.net, vb.net

我使用这样的代码来查找远程用户名：

```
banner_label.Text = "Welcome, <B>" + User.Identity.Name + "</B>!" 
```

我还想找到远程主机名。我的生产环境将是一个带有活动目录的公司内部网。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T20:41:04.350

您在 Intranet 上，因此 Request.UserHostName 应该适合您。如果你有一个复杂的网络，一些路由器可能不会让这些信息通过，但是......

这是我在以前的工作中在应用程序中所做的类似操作，用于记录 IP 和主机名：

```
// NAT'ed addresses are sometimes still shown in HTTP_X_FORWARDED_FOR
string userHost = Request.ServerVariables["HTTP_X_FORWARDED_FOR"];

if (String.IsNullOrEmpty(userHost) || String.Compare(userHost, "unknown", true) == 0)
    userHost = Request.UserHostAddress;

if (String.Compare(userHost, Request.UserHostName) != 0)
    userHost += " (" + Request.UserHostName + ")"; 
```

然后，我在每次登录尝试时将此字符串记录在数据库中。

* * *

编辑：略过你上面的回复......认为这段代码符合你的要求，让我去测试一下。

* * *

不知道为什么上面的代码在我以前的工作中有效。它不可靠，这就是为什么我在它周围加上 if 语句的原因，但我认为它半可靠地返回了主机名……网上的帖子说它与匿名访问有关。

无论如何，这可以满足您的需求，并且由于您位于 Intranet 上，因此应该可以可靠地工作：

```
System.Net.Dns.GetHostEntry(userHost).HostName 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T18:21:55.537

我相信您可以使用`HttpContext.Current.Request.ServerVariables["REMOTE_HOST"]`，但请注意该信息非常不可靠。发送给您的任何内容都可能被欺骗。

另外，我认为这不会在互联网上起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T18:19:21.953

也许这对你有用

```
Request.UserHostName 
```

编辑：

我认为您尝试做的事情不会在互联网上工作，您想要获得的是计算机的名称，它不会与请求一起传输到服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T18:23:36.017

我四处搜索并找到了 Request.UserHostName，但这在我的开发环境中只返回了 127.0.0.1。

我试过这个

```
System.Net.DNS.GetHostName 
```

这成功返回了我的主机名。但是，由于我仍在开发中，我的客户端和服务器在同一台机器上，我仍然需要测试以确保它实际上给了我远程主机名而不是服务器名。

# c++ - 这个继承有什么问题？

> ID：281698
> 
> 赞同：4
> 
> 时间：2008-11-11T18:09:34.420
> 
> 标签：c++, templates

我只是不明白。在 VC++ 2008 和 G++ 4.3.2 上试过

```
#include <map>

class A : public std::multimap<int, bool>
{
public:
    size_type erase(int k, bool v)
    {
        return erase(k); // <- this fails; had to change to __super::erase(k)
    }
};

int main()
{
    A a;
    a.erase(0, false);
    a.erase(0); // <- fails. can't find base class' function?!

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-11T18:13:09.110

当您在与超类具有相同名称但签名不同的类中声明函数时，名称解析规则规定编译器应在找到第一个匹配项后*停止查找*您尝试调用的函数。按名称找到函数后，*它*会应用重载解析规则。

所以发生的事情是编译器`erase(int, bool)`在你调用时找到你的实现`erase(0)`，然后决定参数不匹配。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-11T18:20:55.757

1：从 C++ 标准库容器派生时需要*非常小心。*可以这样做，但是因为它们没有虚拟析构函数和其他类似的细节，所以这通常是错误的方法。

2：这里的重载规则有点古怪。编译器首先在派生类中查找，如果发现*任何*具有相同名称的重载，则停止查找。如果在派生类中没有发现重载，它只会在基类中查找。

一个简单的解决方案是将基类中所需的函数引入派生类的命名空间：

```
class A : public std::multimap<int, bool>
{
public:
        using std::multimap<int, bool>::erase; // Any erase function found in the base class should be injected into the derived class namespace as well
        size_type erase(int k, bool v)
        {
                return erase(k);
        }
}; 
```

或者，当然，您可以简单地在派生类中编写一个小帮助函数，重定向到基类函数

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-11T18:20:14.603

通过在派生类中定义一个同名但参数不同的函数，您已经隐藏了基类的擦除成员函数。

[http://www.parashift.com/c++-faq-lite/strange-inheritance.html#faq-23.9](http://www.parashift.com/c++-faq-lite/strange-inheritance.html#faq-23.9)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-11T18:13:18.237

首先，您永远不应该从 STL 容器派生，因为没有 STL 容器定义虚拟析构函数。
其次，请参阅 Greg 关于继承的回答。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-11T19:39:53.693

想想你是否真的想从 std::map 继承。在我编写代码的所有时间里，这比 STL 存在的时间长，我从未见过从 std::container 继承是最佳解决方案的实例。

具体来说，问问自己你的类**是**多图还是**有多**图。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-11T19:46:04.040

其他人已经回答了如何解决语法问题以及为什么从标准类派生可能很危险，但也值得指出：

**更喜欢组合而不是继承。**

我怀疑你的意思是让“A”明确地与 multimap<int,bool> 有“is-a”关系。 [Sutter/Alexandrescu 的C++ 编码标准](https://rads.stackoverflow.com/amzn/click/com/0321113586)有整章（#34），[谷歌指出了很多](http://www.google.com/search?q=Prefer+composition+to+inheritance)关于这个主题的很好的参考资料。

似乎也有[关于该主题的 SO 线程](https://stackoverflow.com/questions/49002/prefer-composition-over-inheritance)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T20:01:16.817

对于那些使用[Effective C++](https://rads.stackoverflow.com/amzn/click/com/0321334876)作为 C++ 编程参考的人，本书的第 33 条（避免隐藏继承的名称）中介绍了这个问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-13T10:32:23.907

我同意其他人的意见，即您需要非常小心地从 STL 类继承，并且几乎总是应该避免这种情况。

但是，这个问题可能会出现在其他一些完全可以继承的基类中。

我的问题是：为什么不给你的 2-argument 函数起一个不同的名字呢？如果它采用不同的论据，大概它的含义略有不同？例如erase_if_true 或erase_and_delete 或任何布尔值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-11T19:31:17.597

要以可移植的方式替换 __super，请在类的顶部定义一个 typedef，如下所示：

```
typedef std::multimap<int, bool> parent;
public:
    size_type erase(int k, bool v)
    {
            return parent::erase(k);
    } 
```

当然，它不需要是“父母”。它可以是您喜欢的任何名称，只要它在您的项目中始终如一地使用即可。

# windows - 有人用 ReactOS 试用过他们的软件吗？

> ID：281704
> 
> 赞同：10
> 
> 时间：2008-11-11T18:12:09.550
> 
> 标签：windows, replace, operating-system, react-os

免费的 MS Windows 替代操作系统[ReactOS](http://www.reactos.com)刚刚发布了一个新版本。他们有一个庞大而活跃的开发团队。

*   你试过你的软件了吗？
*   如果是这样，您的建议是什么？
*   是时候开始调查它作为一个严肃的 Windows 替代品了吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-11T18:20:28.283

专门针对 ReactOS 有点太狭隘了 IMO - 也许更好的重点是针对与[WINE](http://www.winehq.org/)的兼容性。因为 ReactOS 与 WINE 共享了许多用户[模式 ​​DLL，所以以 WINE](http://www.reactos.org/en/about_userfaq.html#whynotnix)为目标应该会导致应用程序在 ReactOS 上运行良好。

当然，总会有 WINE 无法很好模拟的东西（因此需要 ReactOS）。这样看来，如果某些东西在 WINE 中运行，它就会在 ReactOS 中运行，而在 ReactOS 中运行的事实并不意味着它一定会在 WINE 中运行。

以 WINE 为目标是有据可查的，也许更容易测试，并且根据定义，应该使您的应用程序与 ReactOS 兼容，这是理所当然的事情。通过这种方式，您不仅收集了当前 WINE 用户的相当大的用户群，而且您可以在任何人想要将您的应用程序与 ReactOS 一起使用时为自己做准备。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T18:51:30.390

在他们的主页上，在[Tour](http://www.reactos.org/en/tour.html)中，您可以看到在 ReactOS 上运行良好（或或多或少）的办公室、工具和游戏的部分列表。如果您订阅时事通讯，您会收到更多信息——例如，当我读到大多数 SQL Server 2000 工具实际上可以在 ReactOS 上运行时，我感到非常惊讶！Query Analyzer、OSQL 和 Books Online 工作正常，Enterprise Manager 和 Profiler 有问题，DBMS 根本无法工作。

在以前的工作场所（全是 MS 商店），我们对其进行了认真调查，以减少我们在许可证方面的支出，同时保留我们内部开发的应用程序。由于它无法正常运行 MSDE，我们不得不放弃该项目 - 希望将来能解决这个问题，我的前同事可以再次推动它。

这些公告也可能在他们的主页上——我在 5 分钟后找不到它们。搜索，虽然。了解所有这些兼容性问题的最简单方法可能是加入时事通讯，或查找其档案。

很长一段时间以来，我一直在跟踪这个操作系统的进展。我相信它完全有可能真正将 OSS 操作系统推向大众，因为它打破了“鸡生蛋”的问题：它从一开始就有应用程序和驱动程序（因为它的目标是与 MS Windows 完全兼容 ABI） .

等待他们的第一个测试版，如果他们在那之后很快超越 Linux，我不会感到惊讶......

**帖子编辑**：找到了！查看[Support Database](http://www.reactos.org/support/)部分，它是查找某些程序的特定硬件是否适用于 ReactOS 的网站。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T18:15:47.140

ReactOS 已经开发了很长时间。

他们早些时候陷入了困境，因为他们的一些代码似乎是一些 NT 内核代码的逐行反汇编，我认为他们已经替换了所有这些代码。

在它们达到与 Linux 相同的市场渗透率之前，我不会为跨平台测试而烦恼，我敢打赌，这永远不会。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T18:56:34.670

在 ReactOS 不会在启动后 5 分钟内随机崩溃之前，我不会担心在其上测试我的代码。不要误会我的意思，我喜欢 ReactOS，但它还不够稳定，无法进行任何有意义的测试！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T19:05:04.527

不，我认为现在不是开始将其视为 Windows 替代品的时候了。

正如网站所述，它仍处于 Alpha 阶段。更重要的是，谁的 Windows 替代品？你的？你的用户？前者是一回事，后者绝对是不行的。

顺便说一句，我不确定这个操作系统的目标是谁。必须是依赖 Windows 软件但不想付费的人，因为根本不想要 Windows 的人可以使用 MacOS/Linux，并且对这些选择的支持（社区或其他方式）很好。

此外，如果您使用 Linux，您已经通过 Wine 获得了一些 Windows 软件支持。

回到那些依赖 Windows 软件但不想付费的人。如果他们是家庭用户，他们可以简单地盗版，如果他们是大型企业用户，他们已经有支持合同和训练有素的人员等。大型企业很难更新到新版本的 Windows，更不用说开源了替换。

所以我想这会让那些不想获得 MS 软件的非法副本、买不起操作系统许可证并依赖仅在 Windows 上运行且不存在 Wine 兼容性不好的软件的小企业。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-27T10:57:12.300

当它运行“您的”软件而不会崩溃时，它是 Windows 的有用替代品。目前它不是一个通用的操作系统，因为它太不稳定（只是 alpha），但是人们已经成功地使用 ReactOS 来完成特定的任务。作为 Windows 的替代品，它具有多种潜在用途、沙盒系统、测试和开发系统、多个虚拟实例、嵌入式设备，甚至将遗留应用程序与自己的兼容操作系统打包/捆绑。驱动程序和应用程序兼容性，摆脱了微软计划报废和定期 GUI 更新的政策，有什么不喜欢的？

# c# - 从 Windows 文件资源管理器拖放到 Windows 窗体不起作用

> ID：281706
> 
> 赞同：8
> 
> 时间：2008-11-11T18:12:56.990
> 
> 标签：c#, winforms, drag-and-drop, vista64

我在将文件从 Windows 资源管理器拖动到 Windows 窗体应用程序时遇到问题。

当我拖动文本时它工作正常，但由于某种原因它无法识别文件。这是我的测试代码：

```
namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_DragDrop(object sender, DragEventArgs e)
        {

        }

        private void Form1_DragEnter(object sender, DragEventArgs e)
        {
            if (e.Data.GetDataPresent(DataFormats.Text))
            {
                e.Effect = DragDropEffects.Copy;
            }
            else if (e.Data.GetDataPresent(DataFormats.FileDrop))
            {
                e.Effect = DragDropEffects.Copy;
            }
            else
            {
                e.Effect = DragDropEffects.None;
            }
        }
    }
} 
```

AllowDrop 在 Form1 上设置为 true，正如我所提到的，如果我将文本拖到表单上，它就可以工作，而不是实际的文件。

我正在使用 Vista 64 位...不确定这是否是问题的一部分。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-13T20:19:46.727

问题来自 Vista 的[UAC](http://en.wikipedia.org/wiki/User_Account_Control)。DevStudio 以管理员身份运行，但 explorer 以普通用户身份运行。当您从资源管理器中拖动文件并将其放到 DevStudio 托管的应用程序上时，这与尝试与特权用户通信的非特权用户相同。这不被允许。

当您在调试器之外运行应用程序时，这可能不会显示。除非您在那里以管理员身份运行它（或者如果 Vista 自动检测到它是安装程序/设置应用程序）。

您也可以[以管理员身份运行 explorer](http://www.neowin.net/forum/lofiversion/index.php/t575104.html)，至少用于测试。或者禁用 UAC（我不建议这样做，因为您真的想在开发过程中发现这些问题，而不是在部署过程中！）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T18:32:10.867

您发布的代码*应该可以*工作。

试着把它放在 DragEnter 方法的开头

```
string formats = string.Join( "\n", e.Data.GetFormats(false) );
MessageBox.Show( formats ); 
```

这将转储与 d'n'd 操作相关的数据格式。可能有助于我们缩小问题所在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T21:58:29.140

我添加了[arul](https://stackoverflow.com/questions/281706/drag-and-drop-from-windows-file-explorer-onto-a-windows-form-is-not-working#281770)提到的代码，但事情仍然没有奏效，但它让我思考。

我开始认为这可能是一个 Vista 问题，所以我将它发送给了一个使用 Windows XP 的朋友，它运行良好！然后我尝试在 bin 目录中的 Release 文件夹之外运行它，你知道它有什么用！

唯一一次它不起作用是当我在 Visual Studio 2008 IDE 中运行它时......这很奇怪。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-27T16:14:27.660

您是否尝试将`STAThread`属性添加到 main 方法？

```
 [STAThread]
  static void Main(string[] args)
  {
  } 
```

我和@mattruma 有同样的问题，这意味着我没有拖放事件。将`STAThread`属性添加到 main 方法后，它按预期工作。

# c# - DLL 中的 DoEvents

> ID：281714
> 
> 赞同：1
> 
> 时间：2008-11-11T18:14:56.300
> 
> 标签：c#, dll

你有任何想法如何从 C# DLL 调用 DoEvents

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-11T18:18:15.730

不。当您是控制事件循环的应用程序时，这已经足够粗略了；从 DLL 中抽取消息只会增加风险，即您最终会遇到一个天真的程序员无法确保重入安全的代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T18:19:03.903

你的意思是`System.Windows.Forms.Application.DoEvents()`？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T06:59:07.830

我会回应“不要”（来自 dll 或 UI 项目）。您可以做几件事来使库代码与 UI 很好地配合，包括您可能在 UI 中使用的相同线程技巧（使用事件和/或回调）。最简单的方法是让库代码简单地“按原样”执行，如果 UI 碰巧在工作线程上生成它，那么 UI 的工作就是处理任何事件并将它们编组 ( `Control.Invoke/BeginInvoke`) 到 UI 的 UI 线程更新。

对于更复杂的场景，您可以使用同步上下文`SynchronizationContext.Current`（`Control.Invoke`

你能添加更多关于场景是什么的上下文吗？有很多事情可以做...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T19:57:01.117

为 EXE 编写一个接口并让您的主窗体或主类实现它。然后用 DLL 注册实现接口的对象。将其分配给该接口类型的变量 创建一个在整个 DLL 中可见的子例程。在子例程中检查变量是否为空，如果不是，则触发您创建的触发 DoEvents 的方法的子例程。任何时候你需要做一个 DoEvents 然后调用子程序。

如果您为应用程序使用三层组织，则将子例程或变量放在代表整个应用程序的对象上。让表单向 Application 对象注册自身。

如果您有重入问题，您可以添加状态变量和其他辅助函数来安全地检查应用程序正在做什么。请注意，如果您使用某种类型的多层设计，实现这一点要容易得多。

对于其他人来说，重新进入是一个问题，但无响应的 UI 也是如此。在复杂的应用程序中，有时您必须让事件循环触发。

# firefox - 从火狐中提取 location.href 或 window.location 而不对其进行编码

> ID：281715
> 
> 赞同：1
> 
> 时间：2008-11-11T18:15:20.383
> 
> 标签：firefox, url, encoding

我正在通过谷歌翻译传递一个 url，在 Fire fox 的位置栏中，该 url 看起来应该是这样的：

[http://72.14.235.104/translate_c?hl=en&langpair=en|ru&sl=ru&tl=ru&u=http://something.something/something/.....orig_term%3Dмалярии](http://72.14.235.104/translate_c?hl=en&langpair=en|ru&sl=ru&tl=ru&u=http://something.something/something/.....orig_term%3D%D0%BC%D0%B0%D0%BB%D1%8F%D1%80%D0%B8%D0%B8)

我想获取 orig_term 并在加载时将其值应用到我页面的其他位置。问题是，尽管在位置中准确显示，window.location、window.location.href、location.href 都显示了带有 orig_term 编码的值。我试过对编码值进行解码，但它的表示是：

Ð¼Ð°Ð»ÑÑÐ¸Ð¸

任何人都知道为什么这在 IE 中很有效，但在 Fire Fox 中无效？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T20:55:45.367

我只是把这个 URL 放在我的 Firefox 3 地址栏中： [http ://www.google.com/search?q=малярии](http://www.google.com/search?q=%D0%BC%D0%B0%D0%BB%D1%8F%D1%80%D0%B8%D0%B8)

如果我对 href 进行[decodeURI](http://www.w3schools.com/jsref/jsref_decodeURI.asp) ，我可以取回正确的数据。我在地址栏中替换了上面的 URL 来测试它。

```
javascript:alert(decodeURI(window.location.href)) 
```

# sharepoint - 如何使用对象模型获取 SharePoint 版本

> ID：281718
> 
> 赞同：2
> 
> 时间：2008-11-11T18:15:51.117
> 
> 标签：sharepoint, sharepoint-2007

使用 WSSv2 (SharePoint 2003)，您可以获得您正在使用的 SharePoint 版本

例如， [SPGloablAdmin.Version](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spglobaladmin.version.aspx)为您提供[WSSv3 SP1的“12.0.0.6219”](http://www.mindsharpblogs.com/penny/articles/481.aspx)

然而它现在已经过时了（虽然仍然有效）。

有谁知道等效的 WSSv3 (SharePoint 2007)？

您有诸如[SPWebService.ContentService.Version 之](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spwebservice_properties.aspx)类的东西，但该版本号只是一个时间戳，似乎与构建版本无关。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T18:46:51.543

SPFarm.Local.BuildVersion 可能会给您相同的结果，而无需参考 SPWebService。

干杯:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T18:50:30.063

SPWebService.ContentService.Farm.BuildVersion

[http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spfarm.buildversion.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spfarm.buildversion.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-20T16:08:17.060

正如格言所说，但我将它包含在 Powershell 脚本中[http://snipt.org/nLS/](http://snipt.org/nLS/)

# windows - 有没有人在 Windows 下成功构建 Chrome？

> ID：281719
> 
> 赞同：1
> 
> 时间：2008-11-11T18:16:03.380
> 
> 标签：windows, google-chrome

我正在定量研究与自动化测试相关的各种指标。Chrome似乎有一个合理的设置，所以我想将它添加到我的数据集中。我下载了 Chrome 源代码并尝试使用 VisualStudio 构建它，但出现了数百个错误——未定义类型、未定义标识符等。有没有人在 Windows 下成功构建 Chrome？有没有我需要知道的技巧？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T18:20:38.393

从 Chromium 开发页面：

# 编译失败

当您遇到奇怪的编译失败时，需要考虑一些常见的事情：

*   确保您拥有 Visual Studio 2005 的 SP1。它是必需的。真的。
*   有时，Visual Studio 在构建 Chromium 时会做错事并陷入虚假错误。一个很好的迹象是，如果它只对一个人失败，而其他人（包括 Buildbots）没有抱怨。要解决此问题，请尝试以下步骤：
    *   关闭 Visual Studio。
    *   同步到树的顶端并确保没有冲突（“svn st”不应在您更改的文件前面显示任何“C”）。
    *   如果存在冲突，请在解决冲突后再次同步。
    *   手动擦除输出目录（chrome\Debug 和 chrome\Release。使用命令行，您可以使用 chrome 目录中的“erase /S /Q Debug Release”来执行此操作，或者如果您有“rm -rf Debug Release”安装了类 Unix 工具。
    *   重新启动 Visual Studio 并打开 Chromium 解决方案。
    *   重建解决方案。

如果它仍然不起作用，重复此过程可能无济于事。

# chrome_kjs.sln 临时文件问题

如果在构建 JavaScriptCore 时，您会看到如下错误：

```
3>Error in tempfile() using /tmp/dftables-XXXXXXXX.in: Parent directory (/tmp/) is not writable
3> at /cygdrive/c/b/slave/WEBKIT~1/build/webkit/third_party/JavaScriptCore/pcre/dftables line 236
3>make: *** [chartables.c] Error 255 
```

...这是因为 Chromium 源中包含的 Cygwin 安装无法将 NT ACL 映射到 POSIX 权限。这似乎发生在 Chromium 签出到 Cygwin 首先无法确定权限的目录时，可能是在运行 mkpasswd 之前从 Cygwin 环境中创建目录时。Cygwin 然后强加自己的访问控制，这是错误的限制。作为解决方法，请执行以下操作之一：

*   编辑third_party\cygwin\tmp 上的NT 权限，以允许Everyone 和machine\Users 的Modify 和Write 操作。Cygwin 能够解决这个问题。或者，

*   找出您的结帐出了什么问题，然后重试 - 尝试从 cmd 而不是从 Cygwin shell 进行结帐，然后验证您的 Cygwin 安装中的权限是否完全空白。或者，

*   通过编辑 webkit\build\JavaScriptCore\prebuild.bat 和 webkit\build\WebCore\prebuild.bat 来绕过 Cygwin 的访问控制（NT 仍然有效），在调用任何使用 Cygwin 的程序之前包含以下行：

    ```
     set CYGWIN=nontsec 
    ```

应该只需要其中一种解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-09T07:50:52.850

我已经能够多次构建 Chrome。如果您想查看 [使用 Visual Studio.NET 2008 在 Windows 7 中构建 Chrome，我提供了全面的材料](http://blog.umairp.com/index.php/2010/07/building-chrome-in-windows-7-using-visual-studio-net-2008/)

# mysql - MySQL TRIM 函数是否不修剪换行符或回车符？

> ID：281724
> 
> 赞同：29
> 
> 时间：2008-11-11T18:17:26.043
> 
> 标签：mysql, string, trim

从我的实验来看，它似乎没有这样做。如果这确实是真的，那么删除换行符的最佳方法是什么？我目前正在试验 TRIM 接受要删除的字符的参数，从 trimming`\n`和`\r`.

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-03-05T23:09:17.880

我的换行符位于字符串的中间，我无法控制源数据。以下 mysql 命令对我有用：

```
REPLACE(FIELD,'\r\n',' ') 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-05-02T22:55:58.883

是的，`Trim()`将在 MySQL 中工作。你有两个选择。

1）选择它：

```
select trim(BOTH '\n' from [field_name]) as field 
```

如果这不起作用，请尝试`'\r'`，如果这不起作用，请尝试`'\n\r'`。

2）用更新替换表中的错误数据......

```
update [table_name] set [field_name] = trim(BOTH '\n' from [field_name]) 
```

我建议先选择来确定您有哪个换行符（\r 或 \n）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-01-14T12:21:26.590

标准的 MySQL`trim`函数不像我知道的任何其他语言中的修剪函数，因为它只删除完全匹配的字符串，而不是字符串中的任何字符。这个存储的函数更像是你在 PHP 中找到的普通修剪，或者在 python 等中删除。

```
CREATE FUNCTION `multiTrim`(string varchar(1023),remove varchar(63)) RETURNS varchar(1023) CHARSET utf8
BEGIN
  -- Remove trailing chars
  WHILE length(string)>0 and remove LIKE concat('%',substring(string,-1),'%') DO
    set string = substring(string,1,length(string)-1);
  END WHILE;

  -- Remove leading chars
  WHILE length(string)>0 and remove LIKE concat('%',left(string,1),'%') DO
    set string = substring(string,2);
  END WHILE;

  RETURN string;
END; 
```

然后，您应该能够：

```
select multiTrim(string,"\r\n\t "); 
```

它应该删除所有换行符、制表符和空格。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-13T14:47:56.080

`select trim(both '\r\n' from FIELDNAME) from TABLE;`如果`select trim(both '\n' from FIELDNAME) from TABLE;`不工作应该工作。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-11T18:35:30.360

`Trim()`在 MySQL 中只删除空格。

我不相信有一种内置的方法可以删除 MySQL 中的各种尾随和前导空格，除非你反复使用`Trim()`.

我建议您使用另一种语言来清理您当前的数据，并确保从现在开始对您的输入进行清理。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-25T12:11:23.697

我只能通过制作`char`;

```
trim(both char(13) from fieldname) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-11T18:21:32.353

```
select trim(both '\n' from FIELDNAME) from TABLE; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-14T13:59:57.820

上面的答案，当结合起来，工作。在字段的开头和结尾替换换行符的完整示例如下所示：

```
UPDATE table SET field=REPLACE(field, field, TRIM(BOTH '\r\n' FROM field)) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-10-11T23:39:28.650

我在其中一个领域遇到了同样的问题。没有完美的解决方案。在我的情况下，我很幸运该字段的长度应该是 6。所以我使用了类似的查询

```
update events set eventuniqueid = substring(eventuniqueid, 1, 6) where length(eventuniqueid) = 7; 
```

您只需要根据您的需要选择最佳选项。替换 '\n' 和 '\r\n' 对我不起作用，最终浪费了我的时间。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-01-28T15:48:39.560

`REPLACE(FIELD,'\r\n',' ')`在 MySql 5.1 数据库上完美运行

# c++ - 基于继承类的模板特化

> ID：281725
> 
> 赞同：25
> 
> 时间：2008-11-11T18:17:46.637
> 
> 标签：c++, templates, specialization

我想把这个专门化，不改变主线。是否可以根据其基类专门化某些东西？但愿如此。

-编辑-

我将有几个继承自 SomeTag 的类。我不想为他们每个人写相同的专业。

```
class SomeTag {};
class InheritSomeTag : public SomeTag {};

template <class T, class Tag=T>
struct MyClass
{
};

template <class T>
struct MyClass<T, SomeTag>
{
    typedef int isSpecialized;
};

int main()
{
    MyClass<SomeTag>::isSpecialized test1; //ok
    MyClass<InheritSomeTag>::isSpecialized test2; //how do i make this specialized w/o changing main()
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-11T18:57:04.810

这篇文章描述了一个巧妙的技巧：[http ://www.gotw.ca/publications/mxc++-item-4.htm](http://www.gotw.ca/publications/mxc++-item-4.htm)

这是基本的想法。您首先需要一个 IsDerivedFrom 类（它提供运行时和编译时检查）：

```
template<typename D, typename B>
class IsDerivedFrom
{
  class No { };
  class Yes { No no[3]; }; 

  static Yes Test( B* ); // not defined
  static No Test( ... ); // not defined 

  static void Constraints(D* p) { B* pb = p; pb = p; } 

public:
  enum { Is = sizeof(Test(static_cast<D*>(0))) == sizeof(Yes) }; 

  IsDerivedFrom() { void(*p)(D*) = Constraints; }
}; 
```

然后您的 MyClass 需要一个可能专门的实现：

```
template<typename T, int>
class MyClassImpl
{
  // general case: T is not derived from SomeTag
}; 

template<typename T>
class MyClassImpl<T, 1>
{
  // T is derived from SomeTag
  public:
     typedef int isSpecialized;
}; 
```

MyClass 实际上看起来像：

```
template<typename T>
class MyClass: public MyClassImpl<T, IsDerivedFrom<T, SomeTag>::Is>
{
}; 
```

然后你的主要方式会很好：

```
int main()
{
    MyClass<SomeTag>::isSpecialized test1; //ok
    MyClass<InheritSomeTag>::isSpecialized test2; //ok also
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2014-09-19T12:42:45.307

现在是 2014 年的简短版本，使用 C++-11：

```
#include <type_traits>

struct SomeTag { };
struct InheritSomeTag : SomeTag { };

template<typename T, bool = std::is_base_of<SomeTag, T>::value>
struct MyClass { };

template<typename T>
struct MyClass<T, true> {
    typedef int isSpecialized;
};

int main() {
    MyClass<SomeTag>::isSpecialized test1;        /* ok */
    MyClass<InheritSomeTag>::isSpecialized test2; /* ok */
} 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-11-11T20:12:03.050

好吧，上面答案中的文章出现在 2002 年 2 月。虽然它有效，但今天我们知道还有更好的方法。或者，您可以使用`enable_if`：

```
template<bool C, typename T = void>
struct enable_if {
  typedef T type;
};

template<typename T>
struct enable_if<false, T> { };

template<typename, typename>
struct is_same {
    static bool const value = false;
};

template<typename A>
struct is_same<A, A> {
    static bool const value = true;
};

template<typename B, typename D>                                 
struct is_base_of {                                                       
    static D * create_d();                     
    static char (& chk(B *))[1]; 
    static char (& chk(...))[2];           
    static bool const value = sizeof chk(create_d()) == 1 &&  
                              !is_same<B    volatile const, 
                                       void volatile const>::value;
};

struct SomeTag { };
struct InheritSomeTag : SomeTag { };

template<typename T, typename = void>
struct MyClass { /* T not derived from SomeTag */ };

template<typename T>
struct MyClass<T, typename enable_if<is_base_of<SomeTag, T>::value>::type> {
    typedef int isSpecialized;
};

int main() {
    MyClass<SomeTag>::isSpecialized test1;        /* ok */
    MyClass<InheritSomeTag>::isSpecialized test2; /* ok */
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-11T18:41:21.813

在您的情况下，我看到的唯一方法是明确专门`MyClass`针对`InheritSomeTag`. 然而，[SeqAn 论文](http://www.biomedcentral.com/1471-2105/9/11/abstract)提出了一种称为“模板子类化”的机制，它可以满足您的需求——尽管继承语法不同，因此代码与您当前的`main`函数不兼容。

```
// Base class
template <typename TSpec = void>
class SomeTag { };

// Type tag, NOT part of the inheritance chain
template <typename TSpec = void>
struct InheritSomeTag { };

// Derived class, uses type tag
template <typename TSpec>
class SomeTag<InheritSomeTag<TSpec> > : public SomeTag<void> { };

template <class T, class Tag=T>
struct MyClass { };

template <class T, typename TSpec>
struct MyClass<T, SomeTag<TSpec> >
{
    typedef int isSpecialized;
};

int main()
{
    MyClass<SomeTag<> >::isSpecialized test1; //ok
    MyClass<SomeTag<InheritSomeTag<> > >::isSpecialized test2; //ok
} 
```

这当然看起来很奇怪并且非常麻烦，但它允许真正的继承机制具有在编译时执行的多态函数。如果您想看到这一点，请查看一些[SeqAn 示例](http://www.seqan.de/dddoc/html/INDEXPAGE_Demo.html)。

话虽如此，我相信 SeqAn 是一种特殊情况，没有多少应用程序会从这种极其困难的语法中受益（解密与 SeqAn 相关的编译器错误是 *ss 中的真正痛苦！）

# asp.net - 使用邮政信箱防止地址的最佳策略？

> ID：281743
> 
> 赞同：4
> 
> 时间：2008-11-11T18:21:58.420
> 
> 标签：asp.net, regex, shipping, street-address

我有一个通过 UPS 运送的客户，因此无法运送到邮政信箱。我希望能够验证客户地址字段，以防止他们输入包含邮政信箱的地址。最好将其实现为正则表达式，以便我可以使用客户端正则表达式验证控件 (ASP.NET)。

我意识到可能没有办法获得 100% 的检测率，我只是在寻找可以在大多数情况下工作的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T18:27:33.950

UPS 也有工具，您可以集成来执行此操作……这样您就可以准确地验证地址，以确定他们是否会发货、成本是多少、时间表等。我建议访问 UPS IT 解决方案页面更多信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T18:25:26.230

这应该让你开始。测试地址字段是否匹配此正则表达式。

```
"^P\.?\s?O\.?\sB[Oo][Xx]." 
```

翻译成英文：那是行首的P，后面是一个可选的句点和空格，然后是一个O，后面是一个可选的句点，然后是一个空格，然后是“Box”，然后是其他任何内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T18:28:30.483

您最好在页面上放置一个免责声明，警告您不能运送到邮政信箱，而不是验证输入。

如果您确实创建了一个捕获大多数邮政信箱场景的正则表达式，那么很有可能它也会捕获您不想要的东西（即街道名称包含字母“p”“o”的客户和“盒子”）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-28T19:10:15.850

不幸的是，UPS 的在线软件允许邮政信箱通过，但一旦它们进入运输渠道就会窒息。在我们的例子中，当我们试图优雅地阻止邮政信箱时，我们的购物车放弃率上升了。我们发现将其搁置一旁，接受销售，将其提交给客户服务部门并让他们解决它更具成本效益。当然，如果您的邮政信箱发生率很高，那么您的情况可能并非如此。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T18:48:16.217

我将从一个正则表达式 ala Lizard 开始（但使用“忽略大小写”标志:)），测试历史数据，然后在您看到测试中看到的无效包含和排除时进行迭代。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T06:10:40.753

大多数运输提供商（例如 FedEx）将验证送货地址。例如，使用 FedEx 网络服务，需要验证送货地址并获取估计费用。这不仅可以确保该地址不是邮政信箱，还可以确保该地址的其余部分有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T16:47:39.733

关于 OP 对 Jason Coco 回答的评论：

由于您可以将正则表达式验证添加到送货地址，我假设您可以控制应用程序（即，您拥有源代码并且可以修改它）。如果是这种情况，那么您应该能够在收到提交的数据后，检查它是通过 USPS、FedEx 还是 UPS 运送，并向适当的发件人特定地址验证器提交请求，从而获得所有杰森的回答中建议的好处。

通过使其特定于托运人，这也将允许您避免实施一刀切的规则，例如“没有邮政信箱，因为 UPS 不向他们发货”，即使用户可以选择非 UPS 托运人谁确实交付到邮政信箱。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-02T19:15:24.427

如果它不以“PO Box..”或“PO Box”开头怎么办？

例子：

约翰施密特 | 银谷邮政信箱 3901 | 哪里斯瓦尔多维尔，SI。78946

我为地址字段使用了 onblur 事件，以使用 javascript 函数 indexOf 来识别 input.toUpperCase "PO BOX" || “PO”>= 0。

如果没有找到这两个搜索中的任何一个，则返回 -1，否则，它将返回字符串的起始位置，该位置始终为 0 或更多。

这将确保惰性输入、“po box”、“po box”以及“po box”都能被识别。我想你可以添加'po。盒子'也是如此。

无论如何，该条件会触发一条不显眼的消息，显示“我们无法运送到邮政信箱地址。”如果它不适用于您，这是一个看不到它的功能。否则，对于没有 js 的用户或启用css，他们只会看到消息。这种优雅降级的唯一失败是如果用户启用了css，但没有启用js（他们根本看不到消息）。我只想出了今天解决了，但是如果我想到更好的方法，我会回来在这里发布。

# java - 在 dbcp 中使用 PreparedStatement 池

> ID：281744
> 
> 赞同：6
> 
> 时间：2008-11-11T18:22:09.140
> 
> 标签：java, prepared-statement, connection-pooling, apache-commons-dbcp

有人能解释一下如何使用 dbcp 准备的连接池吗？（如果可能，请提供一些示例代码）。我已经想出了如何打开它——将 KeyedObjectPoolFactory 传递给 PoolableConnectionFactory。但是具体的prepared statements应该如何定义呢？现在我只使用 PoolingDataSource 从池中获取连接。如何使用池中准备好的语句？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T21:05:34.160

好吧，谈论从池中获取连接与获得“非池化”连接，您的代码是否有任何更改:)？我打赌你不会。与准备好的语句相同。您的代码不应更改。因此，没有有用的代码示例。

您应该阅读有关您的 JDBC 数据源实现的文档，并了解开发人员对池的看法。没有其他可靠信息来源。

从[这里开始](http://commons.apache.org/dbcp/configuration.html)：该组件还具有汇集 PreparedStatements 的能力。启用后，将为每个 Connection 创建一个语句池，并且将池化由以下方法之一创建的 PreparedStatements：

```
* public PreparedStatement prepareStatement(String sql)
* public PreparedStatement prepareStatement(String sql, int resultSetType, int resultSetConcurrency) 
```

因此，您只需继续使用 prepareStatement() 调用，理论上您的 dbcp 将负责池化（即，如果您尝试从用户 u 中创建“select * where u.name like :id”，它将尝试找到此语句先在游泳池里）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-16T10:37:58.470

这是我使用的基本代码。

```
 GenericObjectPool connectionPool = new GenericObjectPool(null);
    connectionPool.setMinEvictableIdleTimeMillis(1000 * 60 * 30);
    connectionPool.setTimeBetweenEvictionRunsMillis(1000 * 60 * 30);
    connectionPool.setNumTestsPerEvictionRun(3);
    connectionPool.setTestOnBorrow(true);
    connectionPool.setTestWhileIdle(false);
    connectionPool.setTestOnReturn(false);

    props = new Properties();
    props.put("user", username);
    props.put("password", password);
    ConnectionFactory connectionFactory = new DriverManagerConnectionFactory(url, props);

    PoolableConnectionFactory poolableConnectionFactory = new PoolableConnectionFactory(connectionFactory, connectionPool, null, "SELECT 1", false, true);
    PoolingDataSource dataSource = new PoolingDataSource(connectionPool); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-12T09:59:24.787

问题是，如果您使用单个s，无论您是否需要`Connection`，它都会缓存s，影响这一点的唯一可能方法是使用属性或使用供应商特定的 API。但是这些语句对其他连接不可见，如果您使用另一个连接准备相同的语句，它将再次重新创建它。因此，像 DBCP 这样的连接池允许在不同的连接之间重用（它使用interface 而不是 simple ），它们跟踪所有连接准备的所有语句。`PreparedStatement``DataSource``PreparedStatement``PooledConnection``Connection`

**更新：**似乎我在这个信息上错了，至少我在 C3P0 中找不到这个功能。

# java - 单元测试与 Spring 的集成测试

> ID：281758
> 
> 赞同：39
> 
> 时间：2008-11-11T18:28:10.127
> 
> 标签：java, tdd, junit, spring-mvc, integration-testing

我正在开发一个 Spring MVC 项目，并且我对源代码树中的所有各种组件进行了单元测试。

例如，如果我有一个`HomeController`需要`LoginService`注入的控制器，那么在我的单元测试中，`HomeControllerTest`我只需像平常一样（在 Spring 之外）实例化对象并注入属性：

```
protected void setUp() throws Exception {
    super.setUp();
    //...
    controller = new HomeController();
    controller.setLoginService( new SimpleLoginService() );
    //...
} 
```

这对于将每个组件作为一个独立的单元进行测试非常有用——除了现在我在项目中有几十个类，在编写了一个类并为它编写了一个成功的单元测试之后，我一直忘记更新我的 Spring MVC 上下文文件已部署应用程序中的实际接线。我发现当我将项目部署到 Tomcat 时忘记更新上下文文件并从非连线 bean 中找到一堆 NullPointers。

所以，这是我的问题：

1.  这是我的第一个 Spring 项目 - 像我所做的那样为单个 bean 创建单元测试是否正常，然后创建第二套测试（集成测试）来测试所有内容在实际应用程序上下文中是否按预期工作？对此是否有既定的最佳实践？

2.  此外，如何将单元测试与集成测试分开？我有所有源代码`src`，单元测试在`test`- 是否应该有第二个测试文件夹（例如`test-integration`）用于集成测试用例？

由于这是我的第一个 Spring 项目，我很好奇其他人通常是如何做这种事情的——与其重新发明轮子，我更愿意询问社区的其他人。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-11T19:03:23.767

我不能说是最佳实践，但这是我过去所做的。

**单元测试：**

*   为重要的 bean 创建单元测试（即，大多数与 Spring 相关的 bean）
*   在可行的情况下使用 Mocks 注入服务（即，如果不是所有时间的话，大多数情况下）。
*   `test`在项目目录中为这些测试使用标准命名约定。使用`Test`or`TestCase`作为类名的前缀或后缀似乎被广泛使用。

**集成测试：**

*   创建一个用于集成测试类的`AbstractIntegrationTestCase`设置。`Spring` `WebApplicationContext`
*   `test`对目录中的集成测试使用命名约定。我使用`IntTest`or`IntegrationTest`作为这些测试的前缀或后缀。

设置三个 Ant`test`目标：

1.  test-all（或任何你想命名的）：运行单元和集成测试
2.  测试：运行单元测试（只是因为`test`似乎是单元测试最常见的用法
3.  test-integration：运行集成测试。

如前所述，您可以使用对您的项目有意义的命名约定。

至于将单元与集成测试分离到一个单独的目录中，我认为只要开发人员*及其工具*可以轻松找到并执行它们，这并不重要。

例如，我使用 Spring 处理的最后一个 Java 项目完全使用了上面描述的内容，集成测试和单元测试位于同一`test`目录中。另一方面，Grails 项目将单元测试目录和集成测试目录明确地分开在一个通用测试目录下。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-08-15T07:53:37.937

几个孤立的点：

是的，这是 Spring 测试的一种常用方法——单独的单元测试和集成测试，前者不加载任何 Spring 上下文。

对于您的单元测试，也许考虑模拟以确保您的测试集中在一个独立的模块上。

如果您的测试包含大量依赖项，那么它们并不是真正的单元测试。它们是集成测试，您使用新而不是依赖注入来连接依赖关系。当您的生产应用程序使用 Spring 时，浪费时间和重复工作！

用于调出 Spring 上下文的基本集成测试很有用。

@required 注释可以帮助您确保在 Spring 接线中捕获所需的依赖项。

也许看看 Maven，它会给你明确的阶段来绑定你的单元和集成测试。Maven 在 Spring 社区中被广泛使用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T19:18:30.273

如果你也切换到纯注释机制，使用 @Component、@Controller、@Service 和 @Repository 注释所有 bean，那么 Spring 的许多繁琐的双重簿记就会消失。只需将 @Autowired 添加到您需要注入的属性中。

请参阅弹簧参考手册的第 3.11 节。[http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-annotation-config](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-annotation-config)

在相关的说明中，我们一直在使用 KenG 描述的划分单元/集成测试。在我最近的方案中，我们还引入了第三个“类”测试，“ComponentTests”。它们使用完整的 spring 布线运行，但使用有线存根实现（在 spring 中使用组件扫描过滤器和注释）。

我们这样做的原因是因为对于某些“服务”层，您最终会使用大量的手工编码连接逻辑来手动连接 bean，有时还会使用大量可笑的模拟对象。5 线测试 100 线接线并不少见。组件测试缓解了这个问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T20:28:38.820

使用 InitializingBean 接口（实现方法“afterPropertiesSet”）或为您的 bean 指定一个 init 方法。InitializingBean 通常更容易，因为您不需要记住将 init 方法添加到 bean。

使用 afterPropertiesSet 确保所有内容都作为非 null 注入，如果为 null，则抛出异常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T19:23:46.377

当我为 Web 应用程序创建集成测试时，我将它们放在一个单独的目录中。[它们是使用 jUnit 或 TestNG 构建的，并使用Selenium](http://selenium.openqa.org/)之类的东西与被测系统交互，就像他们是用户一样点击网页。循环如下：编译、运行单元测试、构建 Web 应用程序、将其部署到正在运行的服务器、执行测试、取消部署应用程序并报告结果。这个想法是测试整个系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-16T12:51:38.727

关于将单元测试与集成测试分开运行，我将所有后者放入一个集成测试目录中，并使用 IDE/Ant 使用类似[这样](https://stackoverflow.com/questions/1293880/run-all-tests-in-a-source-tree-not-a-package)的方法运行它们。为我工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-17T18:09:57.690

单元测试和集成测试之间的区别是，单元测试不一定加载您的上下文，您专注于您编写的代码 - 它通过模拟任何依赖调用来快速失败，即有无异常。但是在集成测试的情况下，您加载上下文并像实际场景一样执行端到端测试。

# iphone - 在 CocoaTouch (iPhone OS) 中，如何查找/消除 Instruments Leak 工具找不到的泄漏？

> ID：281764
> 
> 赞同：4
> 
> 时间：2008-11-11T18:29:13.150
> 
> 标签：iphone, cocoa-touch, memory-management

我有一个在模拟器中运行良好的 iPhone 应用程序。它通过摆脱并非绝对必要的所有内容来很好地响应内存警告。当我在设备上运行它时，它运行良好。但是经过一定量的使用后，它会因错误代码 101 而崩溃——据我所知，这是操作系统因内存使用而杀死它。我可以看到内存警告（我正在记录它），我的应用程序对其做出响应，但此后不久就死了。

如果我查看 Instruments 中的应用程序（在设备上或在 sim 中），它没有发现任何泄漏。此外，净内存使用量在 600-700k 字节范围内。从我的应用程序的不同视图转换会增加内存使用量（如预期的那样），但是当视图和控制器被释放并解除分配时，内存使用量永远不会像以前那么低。但是，加法通常只是 1000-2000 字节范围内的内容。因此，虽然 Leaks 显示没有泄漏，但我怀疑某处存在问题。我还查看了我正在分配的所有对象，所有这些对象似乎都按预期被回收了。我看到的唯一不断增加的对象是 GeneralBlock-N（其中 N 是某个数字）

我应该不关注仪器净使用量吗？尝试诊断问题的下一步是什么？

补充：我没有对 malloc() 或任何会返回我负责的缓冲区的 CoreFoundation 库进行任何调用。我正在进行的唯一非 Obj-C 调用是将语句记录到 NSLog。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T18:52:21.013

快速尝试的一件事是运行[Clang 静态分析器](http://clang.llvm.org/StaticAnalysis.html)。这将在您的代码中找到您可能遗漏的一些（但不是全部）问题。它在编译时检查代码，所以它绝不是万无一失的，但几乎肯定会发现最明显的问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T22:08:21.147

您还应该使用内存监视器工具运行您的应用程序，以查看设备上的整体系统使用情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T03:37:18.097

Leaks 只查找未被任何内容引用但仍保留的内存。

您所看到的是您保留了记忆，并且仍然被某些东西引用。

需要特别注意的一件事是，如果您已将一个类的引用作为委托传递给其他东西，那么您可以在您的 dealloc 方法中释放它。

同样，如果您订阅了任何通知，您应该在 viewWillDisappear 中取消订阅：（如果您在视图控制器中使用通用取消订阅方法，请不要忘记重新订阅内存警告通知。

计时器也是如此，当视图消失时停用它们，并在视图返回时重新启用它们（当然，除非您需要在应用程序运行的整个过程中运行计时器）。

基本上对任何你提供一个类的引用的东西都持怀疑态度，并试着弄清楚你如何尽可能地消除那个链接（在 dealloc 或 viewWillDisappear: 或两者中）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T05:13:41.673

以下是我所学内容的摘要（感谢一些出色的答案和评论）：

*   对象分配与内存使用不同。我关于 ObjectAlloc 的净字节元素的问题的答案是，您不应该关注它 - 至少在确定您正在使用的内存量问题或导致它崩溃的原因时不应该关注它。它不能反映应用程序的真实内存使用情况。
*   我的业余猜测是 ObjectAlloc 只显示直接对象本身占用的内存。因此，如果您有一个 UIImageView，它只占用少量字节来存储各种属性，但它可能指向内存中的图像，占用大量空间。因此，查看 ObjectAlloc 仅有助于确保您没有创建和保留对象，它不会让您了解您正在使用多少内存或在崩溃之前可以使用多少。
*   MemoryMonitor 将为您提供总内存使用情况。您可以使用 Instruments 窗口右下方的搜索工具将其限制为仅查看您的应用程序的使用情况。
*   ObjectAlloc 和 Memory Monitor（以及 Leaks 工具）都是 Instruments 的插件 - 以防其他人不明显。您可以通过运行 -> 使用性能工具开始从 XCode 中启动仪器。进入 Instruments 后，您可以打开 Library 并添加新插件来监控不同方面的性能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T09:40:03.710

要寻找的一件事是循环引用。

（我不希望这听起来很傲慢——只是想确保我清楚:) 如果 object **a**指的是 object **b**而 object **b**指的是 object **a**，则可能不会报告“泄漏”，因为所有内存仍然被引用 - 但这可能是一个孤立的对象岛，与您的应用程序分离并且永远无法回收。当然它可能涉及更多的对象（**a**指**b**，**b**指**c**，**c**指**a**，等等）。

如果您在某处构建对象图，并且有任何反向或交叉引用，请确保在释放根时打破圆圈（有不同的方法。最简单的可能是确保每个类有问题的有一个 releaseAll 方法，或类似的方法——它在它的子对象上调用 releaseAll，然后释放子对象——但这并不总是最好的解决方案）。

# c# - VS.Net 2003 中的代码指针不正常

> ID：281765
> 
> 赞同：1
> 
> 时间：2008-11-11T18:29:58.047
> 
> 标签：c#, .net, asp.net, visual-studio, debugging

我在 VS.Net 2003（使用 C#）中有一个 .net 1.1 项目，在其中我可以在一种方法中设置断点，并且可以很好地单步执行代码，但是当我点击一种特定方法（我们也写过）时，断点并且代码指针变得“古怪”，因为没有更好的术语。如果断点在第 100 行，则执行指针将在第 101 行停止。突出显示断点红色的语法仍将在 100 上，但它只会与第 101 行一样长（也就是说，比 line 短100)。当您按 F10 浏览代码时，代码实际执行位置与执行指针放置位置之间的偏差似乎变得更大。以前有没有人遇到过这种类型的问题，如果是这样，重新同步事物的解决方案可能是什么，以便我可以准确地调试我的程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T18:33:17.103

是的。您的调试符号（.pdb 文件）与实际代码不同步。关闭 Visual Studio 并从所有受影响的项目中删除“bin”和“obj”文件夹。然后重新打开 Visual Studio 并重建。这应该可以解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T18:39:53.410

找到了...我的 PDB 文件与 DLL 文件不同步...清理了 /bin/ 文件夹并重建，问题就消失了。

谢谢我。:)

# mysql - 如何增加mysqld-nt CPU使用率

> ID：281767
> 
> 赞同：2
> 
> 时间：2008-11-11T18:31:43.473
> 
> 标签：mysql, windows, configuration

我在 Windows 2003 上的 mysql 上有一个几乎默认的安装。我正在重建一些索引，这个过程似乎只使用了 3-20% 的 CPU。

有没有办法让它使用更多并加快进程？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T18:39:17.403

这适用于每个应用程序/进程，而不仅仅是 mysql。如果您的数据库使用 3-20% 的 CPU 并且最终性能仍然无法接受，这意味着您并不缺乏处理器能力，因为它大部分时间都是空闲的。最有可能的是您的瓶颈在您的 HDD 或 HDD 控制器级别。你测试过你的HD的I/O带宽和访问时间吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T18:43:59.640

你能挂载一个 ramdisk，然后把你的数据库表移到那个地方吗？您将需要大量 RAM，但如果您的数据库只有几百 MB，那么您将跳过沉重的磁盘 IO。显然，如果断电，您会希望使用备份工作...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T18:44:23.697

此外，按照费尔南多所说的，试着找出你的瓶颈在哪里。应该是硬盘吧 打开 Perfmon，并为 PhysicalDisk 添加计数器，看看这是否是您的瓶颈所在。从您正在进行的活动来看，它可能正在写入导致速度变慢的实际磁盘。

# iphone - NSXMLParser 和实体引用

> ID：281781
> 
> 赞同：1
> 
> 时间：2008-11-11T18:37:41.713
> 
> 标签：iphone, cocoa-touch

我需要对 NSXMLParser 做什么才能处理实体字符？例如，如果我有以下元素 <anElement>Left & Right</anElement> 我只会在 parser:foundCharacters: 委托方法中获得“Right”。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-12T01:58:34.427

我拼凑了一个非常快速的原型应用程序来测试它。您所描述的不是我所看到的行为：

## XML 文件：

<?xml version="1.0" encoding="UTF-8" ?>
<my_element>左 & 对</my_element>

## 执行：

```
#import "XMLMeController.h"

@implementation XMLMeController

- (IBAction)parse:(id)sender
{
    NSURL *url = [NSURL fileURLWithPath:@"/Users/robertwalker/Desktop/test.xml"];
    NSXMLParser *parser = [[NSXMLParser alloc] initWithContentsOfURL:url];
    [parser setDelegate:self];
    [parser parse];
    [parser release];
}

- (void)parser:(NSXMLParser *)parser foundCharacters:(NSString *)string
{
    NSLog(@"Found: %@", string);
}

@end 
```

## 控制台输出：

2008-11-11 20:41:47.805 XMLMe[10941:10b] 发现：左
2008-11-11 20:41:47.807 XMLMe[10941:10b] 发现：&
2008-11-11 20:41:47.807 XMLMe[ 10941:10b] 发现：对

如您所见，解析器将“Left”然后“&”然后“Right”作为发送给委托的三个单独事件找到。

我无法从您的帖子中真正看出，但您需要确保在 XML 文件“&”中使用了正确的实体 而不仅仅是“&”字符，这在 XML 文件中当然是无效的。

# c++ - 在没有 Xcode 的 Mac OS X 上构建 VST 插件

> ID：281783
> 
> 赞同：4
> 
> 时间：2008-11-11T18:38:00.620
> 
> 标签：c++, vst

如何在不使用 Xcode 的情况下在 Mac 上构建 VST 插件？（我正在使用 Code::Blocks）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T00:04:04.503

如果你真的坚持要绕过 Xcode，你应该继续使用'make'，这可能会被证明与尝试使用 Code::Blocks 一样痛苦。虽然 Xcode 一开始可能会觉得很奇怪，但喝了 kool-aid 并处理它确实会为您省去很多麻烦，特别是如果您打算开发商业 VST 插件。例如，如果您不喜欢它的编辑器，那么您可以轻松地将其替换为您选择的另一个。但作为 Mac VST 开发者，Xcode 最大的优势确实在于它擅长处理“以 mac 为中心”的东西；即，构建适当的包、通用二进制文件、资源编辑、链接到系统框架等。此外，您将在那里找到的所有文档（以及其他在线 VST 开发社区，如 KVR）都是 Xcode 用户。

无论如何，如果您选择不听我的建议，应该仍然可以按照老式的方式进行操作。:)

原则上，VST 基本上只是一个动态库包，所以不管你使用的是什么 IDE，你只需要确保它被正确打包并包含适当的资源，否则主机将无法加载它。如果您不确切知道其中包括什么，只需在其他一些 VST 中四处寻找，看看它们在捆绑包中都有什么。要进行构建，您需要编译源代码和 VST SDK，并将以下框架链接到它：

*   应用服务
*   碳
*   快速时间
*   系统

...而且您可能还需要其他一些，这取决于您最终使用的是 Carbon 的哪些部分。您还应该构建为 UB，否则您最终会激怒许多仍在使用 G4/5 的制作人。然后，您需要创建一个 PkgInfo 文件，该文件将进入捆绑包的资源目录，其中必须包含以下文本：“BNDL????” （当然没有引号）。您还必须为您的插件创建一个标准的 Info.plist 文件，该文件会将系统指向加载的实际可执行文件名的名称以及在 Finder 中显示的一些其他信息。同样，如果您不知道那里需要什么，请从正在运行的 VST 中借一份副本并进行编辑以品尝。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-26T05:09:45.013

当我发现[VSTGL 的](http://www.niallmoody.com/ndcplugs/vstgl.htm)Xcode 项目太旧以至于 Xcode 4.1 甚至不会提供升级它时，我今晚这样做了。只是说“太老了”，然后在面包篮里打了我一拳。

我整理了一个简单的 Makefile，我只是在其中添加了“缺失”的部分，因为很明显我需要它们。

请注意，VSTGL 带有一个 ppc 编译的 VST，我刚刚用我新编译的包替换了它，这个 makefile 没有解决 Foo.app/Contents/[Resources|Info.plist|etc] 的布局，它只是编译它到一个有效的 VST 包中。

对我来说另一个问题是，在测试时我使用的是 Ableton Live，但我没有意识到它是 32 位的（即使在 Lion 上也是如此），这就是我省略“-arch x86_64”的原因，但如果你有一个 64 位主机，它应该工作？

此外，看起来即使在 VST 3.0 SDK 中，他们仍在使用直接的 Carbon，看不到 Cocoa。（我猜并不是说我会那么倾向于，但是再一次，使用 Lion，您会得到很多已弃用的东西。

```
INCLUDES = \
    -IVSTGL \
    -I../vstsdk2.4/ \
    -I../vstsdk2.4/public.sdk/source/vst2.x/

LIBS = \
    -framework OpenGL \
    -framework GLUT \
    -framework AGL \
    -framework Carbon \
    -framework CoreServices

SOURCES = \
    VstPlugin.cpp \
    ExampleEditor.cpp \
    VSTGL/VSTGLEditor.cpp \
    VSTGL/VSTGLTimer.cpp \
    ../vstsdk2.4/public.sdk/source/vst2.x/audioeffect.cpp \
    ../vstsdk2.4/public.sdk/source/vst2.x/audioeffectx.cpp \
    ../vstsdk2.4/public.sdk/source/vst2.x/vstplugmain.cpp

all:
    g++ -arch i386 $(INCLUDES) -bundle -o VSTGL.vst/Contents/MacOS/VSTGL $(SOURCES) 
```

# c++ - 将对象快照保存到文件的最佳方法

> ID：281787
> 
> 赞同：1
> 
> 时间：2008-11-11T18:39:28.417
> 
> 标签：c++, visual-studio-2005, file-io

将对象的公共内容输出到人类可读文件的最佳方式是什么？我正在寻找一种方法来做到这一点，它不需要我知道类的所有成员，而是使用编译器告诉我存在哪些成员，以及他们的名字是什么。必须有宏或类似的东西，对吧？

人为的例子：

```
class Container
{
public:
    Container::Container() {/*initialize members*/};
    int stuff; 
    int otherStuff;
};
Container myCollection; 
```

我希望能够做一些事情来查看“myCollection：stuff = value，otherStuff = value”的输出。但是如果另一个成员被添加到容器中，

```
class Container
{
public:
    Container::Container() {/*initialize members*/};
    int stuff;
    string evenMoreStuff;
    int otherStuff;
};
Container myCollection;
```

这一次，此快照的输出将是“myCollection: stuff = value, evenMoreStuff=value, otherStuff = value”

有没有一个宏可以帮助我完成这个？这甚至可能吗？（另外，我不能修改 Container 类。）另一个注意事项：我对 VS 中的潜在宏最感兴趣，但也欢迎其他解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T18:53:17.093

您正在寻找的是“[reflection]( [http://en.wikipedia.org/wiki/Reflection_(computer_science)#C.2B.2B)](http://en.wikipedia.org/wiki/Reflection_(computer_science)#C.2B.2B)) ”。

我在 Google 搜索“C++ 反射”时发现了两个有希望的链接：

[http://www.garret.ru/cppreflection/docs/reflect.html](http://www.garret.ru/cppreflection/docs/reflect.html)

[http://seal-reflex.web.cern.ch/seal-reflex/index.html](http://seal-reflex.web.cern.ch/seal-reflex/index.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T19:40:47.717

Boost 有一个序列化库，可以序列化成文本文件。但是，您现在无法知道类包含哪些成员。您需要反射，而 C++ 没有。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T18:47:52.237

看看[这个库](http://s11n.net)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T18:52:11.370

您需要的是对象序列化或对象编组。stackoverflow 中的一个[反复出现的主题。](https://stackoverflow.com/questions/154185/what-is-object-marshalling)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T19:00:02.650

我强烈建议您看看 Google 的[Protocol Buffers](http://code.google.com/p/protobuf/)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T18:57:58.113

不幸的是，没有宏可以为您做到这一点。您正在寻找的是反射类型库。这些可以从相当简单的到在工作环境中没有位置的家庭滚动的怪物。

没有真正简单的方法可以做到这一点，尽管您可能很想简单地将内存转储到如下地址：

```
char *buffer = new char[sizeof(Container)];
memcpy(buffer, containerInstance, sizeof(Container)); 
```

除非您拥有的只是简单类型，否则我真的建议您反对它。

如果您想要一些非常简单但不完整的东西，我建议您编写自己的 `printOn(ostream &)`成员方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T22:34:32.607

[XDR](http://en.wikipedia.org/wiki/External_Data_Representation)是以独立于平台的方式执行此操作的一种方法。

# objective-c - 以编程方式将 NSBox 的背景设置为渐变而不进行子类化

> ID：281791
> 
> 赞同：1
> 
> 时间：2008-11-11T18:40:16.327
> 
> 标签：objective-c, cocoa, interface-builder

我想将背景设置为`NSBox`渐变。在 Interface Builder 中，可以设置渐变的背景`NSBox`颜色`selectedMenuColor`。

`NSBox`只有一个`setFillColor`方法，那么 Interface Builder 如何用渐变填充它？

如何以编程方式填充一个`NSBox`而不对其进行子类化？子类化将是微不足道的，`NSBox`但 Interface Builder 的工作原理表明可能会有更好的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T14:23:38.213

`selectedMenuColor`是一种不显示为纯色的“神奇”颜色。许多这些“神奇”颜色存在于系统中。

我以前用过`colorWithPatternImage:`这个。但请注意，您用作图案的图像将被平铺，因此您可能必须将图像的大小调整为框的大小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T20:02:00.717

可能你最接近的方法是使用创建的 NSColor `colorWithPatternImage:`，然后创建你想要的渐变作为图像并将其加载。丑陋，但应该可以工作。我认为子类化是你最好的选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T20:51:32.287

selectedMenuColor 颜色实际上是渐变的预渲染图像，而不是动态绘制的渐变，因此无法指定任意渐变作为背景颜色。就像 Ben 说的那样，子类化可能是要走的路。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-18T14:08:47.690

在`xib`中，选择`NSBox`，然后转到效果检查器，检查`NSBox`核心动画层。现在

```
IBOutlet NSBox *box;

[box.setWantsLayer:YES];

[box.layer setBackgroundColor:[[NSColor whiteColor] CGColor]]; 
```

或者

```
[box.setWantsLayer:YES];

[box.layer setBackgroundColor:[[NSColor colorWithPatternImage:[NSImage imageNamed:@"white.gif"]] CGColor]]; 
```

# asp.net - ASP.Net 应用程序中的无注册 COM

> ID：281800
> 
> 赞同：1
> 
> 时间：2008-11-11T18:44:39.157
> 
> 标签：asp.net, com

我想知道是否可以在 ASP.Net 应用程序中使用 Reg-Free COM？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-15T18:50:09.723

据此它是： http: [//www.mazecomputer.com/sxs/help/iis6aspnet2.htm](http://www.mazecomputer.com/sxs/help/iis6aspnet2.htm)

我没试过，我只是在研究同样的想法......

# nunit - 如何测试两个日期是否在 NUnit 中的某个容差范围内？

> ID：281811
> 
> 赞同：3
> 
> 时间：2008-11-11T18:50:31.873
> 
> 标签：nunit

如何测试两个日期是否在 NUnit 中的某个容差范围内？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T20:32:44.413

您可能想查看依赖于 Constraint 对象的“Within”方法。

例如：

```
Assert.That(DateTime.Now, Is.EqualTo(DateTime.Now.AddMilliseconds(1000)).Within(101)); 
```

它通常用于对双精度和浮点数提供容差，但由于最终 DateTime 是双精度，它可能适合您的需要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-13T14:57:41.450

```
TimeSpan tolerance = new TimeSpan(0,1,0);  // e.g. 1 minute

Assert.IsTrue((firstDateTime-SecondDateTime).Duration() > tolerance); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T19:09:19.217

将您的公差转换为刻度，然后使用 And 约束。就像是;

```
long ticks = mydate.Ticks;
long tolerance = 1000;
Assert.That( ticks, Is.LessThan( ticks + tolerance ) & Is.GreaterThan( ticks - tolerance ) ); 
```

不过，我会创建一个扩展方法或您自己的 Assert 来执行此操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T19:11:57.527

从另一个中减去一个，得到一个 TimeSpan 值，使用 TotalXYZ 属性（如 TotalMilliseconds）获取一个值，使用 Math.Abs​​ 将其转换为始终为正的值，并检查您的容差值。

例如，如果它们需要在 10 毫秒内：

```
if (Math.Abs((dt1 - dt2).TotalMilliseconds) <= 10)
{
    CloseEnough();
} 
```

# c++ - 解开 std::type_info::name 的结果

> ID：281818
> 
> 赞同：116
> 
> 时间：2008-11-11T18:52:31.293
> 
> 标签：c++, gcc, name-mangling

我目前正在编写一些日志代码，这些代码应该 - 除其他外 - 打印有关调用函数的信息。这应该是比较容易的，标准C++有一个`type_info`类。这包含 typeid 的类/函数/等的名称。但它被破坏了。它不是很有用。即`typeid(std::vector<int>).name()`返回`St6vectorIiSaIiEE`。

有没有办法从中产生有用的东西？就像`std::vector<int>`上面的例子一样。如果它只适用于非模板类，那也没关系。

该解决方案应该适用于 gcc，但如果我可以移植它会更好。它是用于记录的，所以它不是很重要，不能关闭，但它应该有助于调试。

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2010-12-27T20:10:34.597

鉴于这个问题/答案受到的关注，以及来自[GManNickG](https://stackoverflow.com/questions/281818/unmangling-the-result-of-stdtype-infoname/4541470#comment26629807_4541470)的宝贵反馈，我已经稍微清理了代码。给出了两个版本：一个具有 C++11 特性，另一个具有 C++98 特性。

在文件**类型.hpp**

```
#ifndef TYPE_HPP
#define TYPE_HPP

#include <string>
#include <typeinfo>

std::string demangle(const char* name);

template <class T>
std::string type(const T& t) {

    return demangle(typeid(t).name());
}

#endif 
```

在文件**type.cpp 中**（需要 C++11）

```
#include "type.hpp"
#ifdef __GNUG__
#include <cstdlib>
#include <memory>
#include <cxxabi.h>

std::string demangle(const char* name) {

    int status = -4; // some arbitrary value to eliminate the compiler warning

    // enable c++11 by passing the flag -std=c++11 to g++
    std::unique_ptr<char, void(*)(void*)> res {
        abi::__cxa_demangle(name, NULL, NULL, &status),
        std::free
    };

    return (status==0) ? res.get() : name ;
}

#else

// does nothing if not g++
std::string demangle(const char* name) {
    return name;
}

#endif 
```

用法：

```
#include <iostream>
#include "type.hpp"

struct Base { virtual ~Base() {} };

struct Derived : public Base { };

int main() {

    Base* ptr_base = new Derived(); // Please use smart pointers in YOUR code!

    std::cout << "Type of ptr_base: " << type(ptr_base) << std::endl;

    std::cout << "Type of pointee: " << type(*ptr_base) << std::endl;

    delete ptr_base;
} 
```

它打印：

ptr_base`Base*`
类型：指针类型：`Derived`

在 Linux 64 位和 g++ 4.7.2（Mingw32、Win32 XP SP2）上使用 g++ 4.7.2、g++ 4.9.0 20140302（实验性）、clang++ 3.4（主干 184647）、clang 3.5（主干 202594）进行了测试。

如果你不能使用 C++11 的特性，这里是在 C++98 中可以做到的，文件**type.cpp**现在是：

```
#include "type.hpp"
#ifdef __GNUG__
#include <cstdlib>
#include <memory>
#include <cxxabi.h>

struct handle {
    char* p;
    handle(char* ptr) : p(ptr) { }
    ~handle() { std::free(p); }
};

std::string demangle(const char* name) {

    int status = -4; // some arbitrary value to eliminate the compiler warning

    handle result( abi::__cxa_demangle(name, NULL, NULL, &status) );

    return (status==0) ? result.p : name ;
}

#else

// does nothing if not g++
std::string demangle(const char* name) {
    return name;
}

#endif 
```

* * *

* * *

*（2013 年 9 月 8 日更新）*

[接受的答案（截至 2013 年 9 月 7 日）](https://stackoverflow.com/a/281876/341970)，当调用`abi::__cxa_demangle()`成功时，**返回一个指向本地堆栈分配数组的指针**......哎呀！
另请注意，如果您提供缓冲区，`abi::__cxa_demangle()`则假定它是在堆上分配的。在堆栈上分配缓冲区是一个错误（来自 gnu 文档）：*“如果`output_buffer`不够长，则使用 . 扩展它`realloc`。”* **调用`realloc()`指向堆栈的指针**……哎呀！（另见[Igor Skochinsky](https://stackoverflow.com/questions/281818/unmangling-the-result-of-stdtype-infoname#comment16312718_4541470)的善意评论。）

您可以轻松验证这两个错误：只需将已接受答案（截至 2013 年 9 月 7 日）中的缓冲区大小从 1024 减小到更小的值，例如 16，并为其命名*不*超过 15 的值（`realloc()`因此*未*调用）。尽管如此，根据您的系统和编译器优化，输出将是：垃圾/无/程序崩溃。
要验证第二个错误：将缓冲区大小设置为 1，并使用名称超过 1 个字符的名称调用它。当您运行它时，程序几乎肯定会崩溃，因为它试图`realloc()`使用指向堆栈的指针进行调用。

* * *

*（2010 年 12 月 27 日的旧答案）*

[对KeithB 的代码](https://stackoverflow.com/a/281876/341970)所做的重要更改：**缓冲区必须由 malloc 分配或指定为 NULL。**不要在堆栈上分配它。

检查该状态也是明智的。

我没能找到`HAVE_CXA_DEMANGLE`。我检查`__GNUG__`了虽然这并不能保证代码甚至可以编译。有人有更好的主意吗？

```
#include <cxxabi.h>

const string demangle(const char* name) {

    int status = -4;

    char* res = abi::__cxa_demangle(name, NULL, NULL, &status);

    const char* const demangled_name = (status==0)?res:name;

    string ret_val(demangled_name);

    free(res);

    return ret_val;
} 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2016-01-21T06:31:40.333

Boost 核心包含一个去解码器。结帐[core/demangle.hpp](http://www.boost.org/doc/libs/master/libs/core/doc/html/core/demangle.html#core.demangle.header_boost_core_demangle_hpp)：

```
#include <boost/core/demangle.hpp>
#include <typeinfo>
#include <iostream>

template<class T> struct X
{
};

int main()
{
    char const * name = typeid( X<int> ).name();

    std::cout << name << std::endl; // prints 1XIiE
    std::cout << boost::core::demangle( name ) << std::endl; // prints X<int>
} 
```

`abi::__cxa_demangle`正如之前所建议的，它基本上只是 的包装器。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-11T19:21:39.660

这就是我们使用的。HAVE_CXA_DEMANGLE 仅在可用时设置（仅 GCC 的最新版本）。

```
#ifdef HAVE_CXA_DEMANGLE
const char* demangle(const char* name)
{
   char buf[1024];
    unsigned int size=1024;
    int status;
    char* res = abi::__cxa_demangle (name,
                                 buf,
                                 &size,
                                 &status);
    return res;
  }
#else
const char* demangle(const char* name)
{
  return name;
}
#endif 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-11T19:31:18.577

在这里，看看[type_strings.hpp](https://github.com/Eelis/geordi/blob/master/prelude/type_strings.hpp)它包含一个函数，可以满足你的需求。

如果你只是在寻找一个去处理工具，例如可以用来处理日志文件中显示的内容，请查看`c++filt`binutils 附带的 . 它可以分解 C++ 和 Java 符号名称。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2021-03-09T17:19:17.463

如果我们想要的只是用于记录的未修改的类型名称，我们实际上可以在不使用`std::type_info`甚至根本不使用 RTTI 的情况下做到这一点。

适用于三大主要编译器前端（[gcc](/questions/tagged/gcc "显示标记为“gcc”的问题")、[clang](/questions/tagged/clang "显示标记为“clang”的问题")和[msvc](/questions/tagged/msvc "显示标记为“msvc”的问题")）的稍微可移植的解决方案是使用函数`template`并从函数名称中提取类型名称。

`gcc`并且`clang`两者都提供`__PRETTY_FUNCTION__`当前函数或函数模板的名称，字符串中包含所有类型参数。类似地，MSVC 具有`__FUNCSIG__`相同的功能。其中每一个的格式都略有不同，例如，对于 的调用`void foo<int>`，编译器将输出不同的内容：

*   `gcc`已格式化`void foo() [with T = int; ]`
*   `clang`已格式化`void foo() [T = int]`
*   `msvc`已格式化`void foo<int>()`

知道了这一点，只需解析出前缀和后缀并将其包装到函数中以提取类型名称即可。

我们甚至可以使用[c++17](/questions/tagged/c%2b%2b17 "显示标记为“c++17”的问题")和`std::string_view`扩展来在**编译时**`constexpr`获取字符串名称，只需解析模板函数的名称即可。这也可以在任何早期的 C++ 版本中完成，但这仍然需要某种形式的字符串解析。

 **例如：

```
#include <string_view>

template <typename T>
constexpr auto get_type_name() -> std::string_view
{
#if defined(__clang__)
    constexpr auto prefix = std::string_view{"[T = "};
    constexpr auto suffix = "]";
    constexpr auto function = std::string_view{__PRETTY_FUNCTION__};
#elif defined(__GNUC__)
    constexpr auto prefix = std::string_view{"with T = "};
    constexpr auto suffix = "; ";
    constexpr auto function = std::string_view{__PRETTY_FUNCTION__};
#elif defined(__MSC_VER)
    constexpr auto prefix = std::string_view{"get_type_name<"};
    constexpr auto suffix = ">(void)";
    constexpr auto function = std::string_view{__FUNCSIG__};
#else
# error Unsupported compiler
#endif

    const auto start = function.find(prefix) + prefix.size();
    const auto end = function.find(suffix);
    const auto size = end - start;

    return function.substr(start, size);
} 
```

有了这个，您可以在编译时调用`get_type_name<T>()`以获取一个`std::string_view`指示未损坏的类型名称。

例如：

```
std::cout << get_type_name<std::string>() << std::endl; 
```

在 GCC 上将输出：

```
std::__cxx11::basic_string<char> 
```

在铿锵声将输出：

```
std::basic_string<char> 
```

`[Live Example](https://gcc.godbolt.org/z/qo146d)`

* * *

这种方法的一个类似的增强是避免 a`prefix`并且`suffix`假设函数名称对于所有类型都是相同的，并搜索哨兵类型以解析出从每一端到哨兵的偏移量。这确保了字符串搜索只发生一次，并且假定偏移量每次都找到字符串名称。例如，`double`用作简单的哨兵：

```
template <typename T>
constexpr auto full_function_name() -> std::string_view
{
#if defined(__clang__) || defined(__GNUC__)
    return std::string_view{__PRETTY_FUNCTION__};
#elif defined(__MSC_VER)
    return std::string_view{__FUNCSIG__};
#else
# error Unsupported compiler
#endif
}

// Outside of the template so its computed once
struct type_name_info {
    static constexpr auto sentinel_function = full_function_name<double>();
    static constexpr auto prefix_offset = sentinel_function.find("double");
    static constexpr auto suffix_offset = sentinel_function.size() - sentinel_function.rfind("double");
};

template <typename T>
constexpr auto get_type_name() -> std::string_view
{
    constexpr auto function = full_function_name<T>();

    const auto start = type_name_info::prefix_offset;
    const auto end = function.size() - type_name_info::suffix_offset;
    const auto size = end - start;

    return function.substr(start, size);
} 
```

`[Live Example](https://gcc.godbolt.org/z/hszW9n)`

* * *

这不能移植到*所有*编译器，但可以针对任何提供`__FUNCSIG__`/`__PRETTY_FUNCTION__`等效的编译器进行修改；它只需要一点解析。

**注意：**这还没有经过*全面*测试，因此可能存在一些错误；`__func__`但主要想法是解析任何包含完整名称的输出 - 这通常是编译器上 -like 输出的副作用。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-11T18:59:52.230

它是实现定义的，所以它不是可移植的。在 MSVC++ 中，name() 是未修饰的名称，您必须查看 raw_name() 才能获得修饰的名称。
在这里只是在黑暗中刺伤，但在 gcc 下，您可能想查看[demangle.h](http://hte.sourceforge.net/doxygenized-0.8.0pre1/demangle_8h.html)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-11T20:14:36.103

我还找到了一个名为 的宏`__PRETTY_FUNCTION__`，它可以解决问题。它给出了一个漂亮的函数名称（数字:)）。这就是我需要的。

即它给了我以下信息：

```
virtual bool mutex::do_unlock() 
```

但我认为它不适用于其他编译器。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-12-20T09:26:23.927

[公认](https://stackoverflow.com/a/4541470/2707864)的解决方案[1] 效果很好。我发现至少一个案例（我不会称其为极端案例）它没有报告我的预期......带有参考。

对于这些情况，我找到了另一种解决方案，贴在底部。

**有问题的情况**（使用`type`[1] 中的定义）：

```
int i = 1;
cout << "Type of " << "i" << " is " << type(i) << endl;
int & ri = i;
cout << "Type of " << "ri" << " is " << type(ri) << endl; 
```

生产

```
Type of i is int
Type of ri is int 
```

**解决方案**（使用`type_name<decltype(obj)>()`，见下面的代码）：

```
cout << "Type of " << "i" << " is " << type_name<decltype(i)>() << endl;
cout << "Type of " << "ri" << " is " << type_name<decltype(ri)>() << endl; 
```

生产

```
Type of i is int
Type of ri is int& 
```

根据需要（至少由我）

**代码** 。由于专业化问题，它必须在包含的标头中，而不是在单独编译的源中。例如，请参阅[对模板函数](https://stackoverflow.com/questions/10632251/undefined-reference-to-template-function)的未定义引用。

```
#ifndef _MSC_VER
#   include <cxxabi.h>
#endif
#include <memory>
#include <string>
#include <cstdlib>

template <class T>
std::string
type_name()
{
    typedef typename std::remove_reference<T>::type TR;
    std::unique_ptr<char, void(*)(void*)> own
           (
#ifndef _MSC_VER
                abi::__cxa_demangle(typeid(TR).name(), nullptr,
                                           nullptr, nullptr),
#else
                nullptr,
#endif
                std::free
           );
    std::string r = own != nullptr ? own.get() : typeid(TR).name();
    if (std::is_const<TR>::value)
        r += " const";
    if (std::is_volatile<TR>::value)
        r += " volatile";
    if (std::is_lvalue_reference<T>::value)
        r += "&";
    else if (std::is_rvalue_reference<T>::value)
        r += "&&";
    return r;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-11T19:23:21.730

不是一个完整的解决方案，但您可能想查看一些标准（或广泛支持的）宏的定义。在记录代码中看到宏的使用是很常见的：

```
__FUNCTION__
__FILE__
__LINE__

e.g.:

log(__FILE__, __LINE__, __FUNCTION__, mymessage); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-04-13T13:38:56.823

阿里的解决方案略有不同。如果您希望代码仍然非常相似

`typeid(bla).name()`,

改为写这个

`Typeid(bla).name()` （仅首字母大写不同）

那么您可能对此感兴趣：

在文件**类型.hpp**

```
#ifndef TYPE_HPP
#define TYPE_HPP

#include <string>
#include <typeinfo>

std::string demangle(const char* name);

/*
template <class T>
std::string type(const T& t) {

  return demangle(typeid(t).name());
}
*/

class Typeid {
 public:

  template <class T>
    Typeid(const T& t) : typ(typeid(t)) {}

  std::string name() { return demangle(typ.name()); }

 private:
  const std::type_info& typ;
};

#endif 
```

**type.cpp**与阿里解决方案保持一致

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-11T19:13:36.493

看看`__cxa_demangle`你可以在`cxxabi.h`.

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-04-12T18:57:48.143

```
// KeithB's solution is good, but has one serious flaw in that unless buf is static
// it'll get trashed from the stack before it is returned in res - and will point who-knows-where
// Here's that problem fixed, but the code is still non-re-entrant and not thread-safe.
// Anyone care to improve it?

#include <cxxabi.h>

// todo: javadoc this properly
const char* demangle(const char* name)
{
    static char buf[1024];
    size_t size = sizeof(buf);
    int status;
    // todo:
    char* res = abi::__cxa_demangle (name,
                                 buf,
                                 &size,
                                 &status);
    buf[sizeof(buf) - 1] = 0; // I'd hope __cxa_demangle does this when the name is huge, but just in case.
    return res;
  } 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-06-19T08:04:47.987

遵循 Ali 的解决方案，这里是最适合我使用的**C++11**模板替代方案。

```
// type.h
#include <cstdlib>
#include <memory>
#include <cxxabi.h>

template <typename T>
std::string demangle() {
  int status = -4;

  std::unique_ptr<char, void (*)(void*)> res{
      abi::__cxa_demangle(typeid(T).name(), NULL, NULL, &status), std::free};
  return (status == 0) ? res.get() : typeid(T).name();
} 
```

用法：

```
// main.cpp
#include <iostream>

namespace test {
    struct SomeStruct {};
}

int main()
{
    std::cout << demangle<double>() << std::endl;
    std::cout << demangle<const int&>() << std::endl;
    std::cout << demangle<test::SomeStruct>() << std::endl;

    return 0;
} 
```

将打印：

```
double                                                                        
int                                                                           
test::SomeStruct 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-11T19:02:31.337

我一直想使用 type_info，但我确信 name() 成员函数的结果是非标准的，不一定会返回任何可以转换为有意义的结果的东西。
如果您坚持使用一个编译器，那么可能会有一个特定于编译器的函数可以满足您的需求。检查文档。

# c# - 右键单击菜单项时如何显示上下文菜单

> ID：281831
> 
> 赞同：10
> 
> 时间：2008-11-11T18:57:15.807
> 
> 标签：c#, .net, winforms, contextmenu

我正在将 MFC 应用程序移植到 .NET WinForms。在 MFC 应用程序中，您可以右键单击菜单或上下文菜单项，我们会显示另一个包含诊断和配置项的上下文菜单。我正在尝试将此功能移植到 .NET，但我遇到了麻烦。

我已经能够捕获右键单击，禁用底层菜单的单击并在正确的位置弹出上下文菜单，但是原始菜单一旦失去焦点就消失了。

在 MFC 中，我们通过使用**TPM_RECURSE**标志调用**TrackPopupMenuEx来显示新的上下文菜单。**

 ****.NET 中的ContextMenu**和较新的**ContextMenuStrip**类只有一个*Show*方法。有谁知道如何在.NET 中做到这一点？

**编辑**

我曾尝试通过 ap/invoke 使用**TrackPopupMenuEx**，但这限制了您使用 ContextMenu 而不是在我们的应用程序中看起来不合适的 ContextMenuStrip。它也仍然无法正常工作。它不适用于新的**MenuStrip**和**ContextMenuStrip**。

我还尝试对 ToolStripMenuItem 进行子类化，以查看是否可以向其添加上下文菜单。这适用于**MenuStrip**，但**ContextMenuStrip**仍然允许右键单击事件作为单击传递。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-11T21:33:04.543

编辑，由于评论：

在：

```
protected override void OnClick(EventArgs e)
{
    if (SecondaryContextMenu == null || MouseButtons != MouseButtons.Right)
    {
        base.OnClick(e);
    }
} 
```

这部分

```
 MouseButtons != MouseButtons.Right 
```

应该并且确实编译，因为它是对 Control.MouseButtons 的调用。由于 Form 继承了 Control 类，直接调用 MouseButtons 属性就足够了。

希望这可以帮助：

```
public partial class Form1 : Form
{
    class CustomToolStripMenuItem : ToolStripMenuItem
    {
        private ContextMenuStrip secondaryContextMenu;

        public ContextMenuStrip SecondaryContextMenu
        {
            get
            {
                return secondaryContextMenu;
            }
            set
            {
                secondaryContextMenu = value;
            }
        }

        public CustomToolStripMenuItem(string text)
            : base(text)
        { }

        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                if (secondaryContextMenu != null)
                {
                    secondaryContextMenu.Dispose();
                    secondaryContextMenu = null;
                }
            }

            base.Dispose(disposing);
        }

        protected override void OnClick(EventArgs e)
        {
            if (SecondaryContextMenu == null || MouseButtons != MouseButtons.Right)
            {
                base.OnClick(e);
            }
        }
    }

    class CustomContextMenuStrip : ContextMenuStrip
    {
        private bool secondaryContextMenuActive = false;
        private ContextMenuStrip lastShownSecondaryContextMenu = null;

        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                if (lastShownSecondaryContextMenu != null)
                {
                    lastShownSecondaryContextMenu.Close();
                    lastShownSecondaryContextMenu = null;
                }
            }
            base.Dispose(disposing);
        }

        protected override void OnControlAdded(ControlEventArgs e)
        {
            e.Control.MouseClick += new MouseEventHandler(Control_MouseClick);
            base.OnControlAdded(e);
        }

        protected override void OnControlRemoved(ControlEventArgs e)
        {
            e.Control.MouseClick -= new MouseEventHandler(Control_MouseClick);
            base.OnControlRemoved(e);
        }

        private void Control_MouseClick(object sender, MouseEventArgs e)
        {
            ShowSecondaryContextMenu(e);
        }

        protected override void OnMouseClick(MouseEventArgs e)
        {
            ShowSecondaryContextMenu(e);
            base.OnMouseClick(e);
        }

        private bool ShowSecondaryContextMenu(MouseEventArgs e)
        {
            CustomToolStripMenuItem ctsm = this.GetItemAt(e.Location) as CustomToolStripMenuItem;

            if (ctsm == null || ctsm.SecondaryContextMenu == null || e.Button != MouseButtons.Right)
            {
                return false;
            }

            lastShownSecondaryContextMenu = ctsm.SecondaryContextMenu;
            secondaryContextMenuActive = true;
            ctsm.SecondaryContextMenu.Closed += new ToolStripDropDownClosedEventHandler(SecondaryContextMenu_Closed);
            ctsm.SecondaryContextMenu.Show(Cursor.Position);
            return true;
        }

        void SecondaryContextMenu_Closed(object sender, ToolStripDropDownClosedEventArgs e)
        {
            ((ContextMenuStrip)sender).Closed -= new ToolStripDropDownClosedEventHandler(SecondaryContextMenu_Closed);
            lastShownSecondaryContextMenu = null;
            secondaryContextMenuActive = false;
            Focus();
        }

        protected override void OnClosing(ToolStripDropDownClosingEventArgs e)
        {
            if (secondaryContextMenuActive)
            {
                e.Cancel = true;
            }

            base.OnClosing(e);
        }
    }

    public Form1()
    {
        InitializeComponent();

        CustomToolStripMenuItem itemPrimary1 = new CustomToolStripMenuItem("item primary 1");
        itemPrimary1.SecondaryContextMenu = new ContextMenuStrip();
        itemPrimary1.SecondaryContextMenu.Items.AddRange(new ToolStripMenuItem[] { 
            new ToolStripMenuItem("item primary 1.1"),
            new ToolStripMenuItem("item primary 1.2"),
        });

        CustomToolStripMenuItem itemPrimary2 = new CustomToolStripMenuItem("item primary 2");
        itemPrimary2.DropDownItems.Add("item primary 2, sub 1");
        itemPrimary2.DropDownItems.Add("item primary 2, sub 2");
        itemPrimary2.SecondaryContextMenu = new ContextMenuStrip();
        itemPrimary2.SecondaryContextMenu.Items.AddRange(new ToolStripMenuItem[] { 
            new ToolStripMenuItem("item primary 2.1"),
            new ToolStripMenuItem("item primary 2.2"),
        });

        CustomContextMenuStrip primaryContextMenu = new CustomContextMenuStrip();
        primaryContextMenu.Items.AddRange(new ToolStripItem[]{
            itemPrimary1,
            itemPrimary2
        });

        this.ContextMenuStrip = primaryContextMenu;
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T19:23:47.313

您可能必须 p/invoke 该方法。

```
[DllImport("user32.dll")]
static extern bool TrackPopupMenuEx(IntPtr hmenu, uint fuFlags, int x, int y,
IntPtr hwnd, IntPtr lptpm);

const int TPM_RECURSE = 0x0001; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T19:30:05.383

这显示了如何使用多个 ContextMenus 以及通过任意鼠标单击组合使用不同的 ContextMenus。

更多信息：http: [//code.msdn.microsoft.com/TheNotifyIconExample](http://code.msdn.microsoft.com/TheNotifyIconExample)

# html - 使用 XSL 转换 HTML 并修改表单属性

> ID：281837
> 
> 赞同：2
> 
> 时间：2008-11-11T19:01:32.350
> 
> 标签：html, xslt, xhtml, transformation

我想解析 HTML 文档并替换所有表单的操作属性，并使用 XSL 添加一些隐藏字段。有人可以展示一些可以做到这一点的 XSL 示例吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T19:40:58.653

您首先需要的是格式良好的 HTML（至少是过渡性的），尽管最好推荐 XHTML。一些 XSLT 处理器可以接受格式错误的 HTML，但这不是规则。

要尝试下面的示例，您可以下载[这个小型 Microsoft 命令行应用程序](http://www.microsoft.com/downloads/details.aspx?FamilyId=2FB55371-C94E-4373-B0E9-DB4816552E41&displaylang=en)。

您需要的快速而肮脏的 XSLT 示例（example-xslt.xsl）：

```
<xsl:stylesheet version="1.0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
        <xsl:template match="*">
            <xsl:copy>
                <xsl:copy-of select="@*"/>
                <xsl:apply-templates/>
            </xsl:copy>
        </xsl:template>

        <xsl:template match="form[@action='foo']">
            <xsl:copy>
                <xsl:copy-of select="@*"/>
                <xsl:attribute name="action">non-foo</xsl:attribute>
                <input type="hidden" name="my-hidden-prop" value="hide-foo-here"/>
                <xsl:apply-templates select="*"/>
            </xsl:copy>
        </xsl:template>

</xsl:stylesheet> 
```

以及相应的 XML 示例 (example.xml)。

```
<?xml version ="1.0"?>
<?xml-stylesheet type="text/xsl" href="example-xslt.xsl"?>
<html>
    <head></head>
    <body>
        <form action="foo">
        </form>
        <form action="other">
        </form>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T19:42:57.527

考虑 gurin 的回答：HTML 的一种可能的基于 XSLT 的途径是使用 tidy 将其转换为 XHTML，将 XSLT 应用于 XHTML，但用于`xsl:output[@method="html"]`获取 HTML。和属性`@doctype-system`还`@doctype-public`允许您在输出文件中提供 doctype 声明。

我没有任何用于 shahbhat 的示例文件，但从 XSLT 的角度来看，一般方法很简单：从身份转换开始，并为操作属性添加模板，以便以您想要的方式覆盖它们。要添加隐藏字段，我怀疑最简单的方法是为`form`元素显式创建一个模板作为身份转换，但其中还包含输出的其他元素。我认为 Fernando Miguélez 刚刚发布了一个示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T19:06:55.803

您可以从[本教程开始](http://www.w3schools.com/xsl/)

但请注意，通常`XSLT`需要格式良好的`XML`输入，`HTML`并不总是格式良好

# c# - 在 CodeAccessSecurityAttribute 中检索目标元素

> ID：281843
> 
> 赞同：2
> 
> 时间：2008-11-11T19:04:17.587
> 
> 标签：c#, security, attributes

我意识到您无法在 Attribute 本身中获取目标实体，但是在使用 CodeAccessSecurityAttribute 时在关联的 Permission 对象中呢？Permission 对象在运行时被调用，所以似乎应该有办法，但我不知所措。

```
public sealed class MySecurityAttribute : CodeAccessSecurityAttribute
{
    public override IPermission CreatePermission()
    {
        MySecurityPermission permission = new MySecurityPermission();

        //set its properties
        permission.Name = this.Name;
        permission.Unrestricted = this.Unrestricted;
        return permission;
    }

}

public class MySecurityPermission : IPermission, IUnrestrictedPermission
{

    public MySecurityPermission(PermissionState state)
    {
           // what method was the attribute decorating that
           // created this MySecurityPermission?
    }

    public void Demand()
    {
           // Or here?
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-18T05:27:56.193

遍历调用堆栈呢？至少这会缩小你需要反思的范围。抓取[System.Diagnostics.StackTrace](http://msdn.microsoft.com/en-us/library/system.diagnostics.stacktrace.aspx)并使用[GetFrame](http://msdn.microsoft.com/en-us/library/system.diagnostics.stackframe.getmethod.aspx)将堆栈帧从您所在的位置上移一步。

但这很讨厌——在我看来，CAS 属性真的不应该以装饰的内容为条件，而应该取决于参数中设置的条件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T10:44:26.507

好吧，我想你可以使用反射来扫描所有加载的程序集，寻找任何具有`this`属性的类/成员。但是，它会很慢，所以这不是你经常想要做的事情，或者在一个大型项目中。

# xml - 大型 XML 宗地和使用属性或元素

> ID：281847
> 
> 赞同：2
> 
> 时间：2008-11-11T19:06:22.653
> 
> 标签：xml, performance

我知道属性与元素的争论没有统一的答案（我通读了我在这方面看到的其他问题），但任何对这种特殊情况的洞察力将不胜感激。

在我们的例子中，我们将从一个记录系统接收到大量的主数据和事务数据，这些数据将被合并到我们自己的数据库中（每晚一次以上）。我们收到的信息本质上是与我们表中的记录一一对应的，因此例如客户列表将是（在我们的旧版本中）：

```
<Custs>
  <Cust ID="101" LongName="Large customer" ShortName="LgCust" Loc="SE"/>
  <Cust ID="102" LongName="Small customer" ShortName="SmCust" Loc="NE"/>
  ....
</Custs> 
```

然而，我们一直在讨论转向基于元素的结构的优点，例如：

```
<Custs>
  <Cust ID="101">
    <LongName>Large Customer</LongName>
    <ShortName>LgCust</ShortName>
    <Loc>SE</Loc>
  </Cust>
  <Cust ID="102">
    <LongName>Small Customer</LongName>
    <ShortName>SmCust</ShortName>
    <Loc>NE</Loc>
  </Cust>
  ....
</Custs> 
```

因为文件太大，我认为我们不会使用 DOM 解析器来尝试将它们加载到内存中，也不需要在文件中定位特定项目。所以我的问题是：在这种情况下，当您需要考虑大量数据和性能需求时，一种形式（元素或属性）通常是否优于另一种形式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T20:44:19.460

如果有人一次向您提供 1gb 的数据并且您完全关心性能，那么您真的应该重新审视使​​用 XML 作为传输格式的决定。您没有将数据解析为 DOM，因此您无法真正利用 XML 为您提供的（例如）CSV 所带来的好处——确保格式正确、模式验证、转换、查询等。

现在您正在考虑采用一种格式，在这种格式中，您将要处理的一半数据是标记。这有什么意义？

我来自当你拥有的唯一工具是锤子时你倾向于将所有问题都视为钉子的 XML 学校，甚至我也不会将 XML 用于这。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T19:15:25.630

如果性能是唯一的要求，我认为你必须使用属性，因为它占用的空间更少。我看不出元素有什么好处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T19:18:01.303

我已经对非常大的文件使用了这两种方法，包括 DOM 和逐行阅读器。当然，您需要使用逐行阅读器来获得非常大的文件的良好性能。除此之外，我的直觉是属性更有效，但我没有确凿的数据来支持这种观点！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T20:53:59.083

如果您计划在处理之前通过普通的旧 DTD 验证您的 xml，则“属性方式”更可取。在 DTD 语言中没有验证一个元素内容的规则，但可以将一些基本规则应用于属性值。

如果您打算使用 XSD 或根本不使用验证，那么我会选择最易读的形式，恕我直言，这是“元素方式”。

无论 XML 来自何处，XML 验证都应该是处理任何 XML 的第一步。它使您的应用程序更安全，代码更小，因为在您的代码甚至触及 XML 数据之前进行了许多检查。XSD 应该是首选，因为它的语法允许检查数据转换（即浮点数、元素或属性内容内的日期字段）。缺点是它比普通的 DTD 文件复杂得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T01:12:26.237

以 XML 格式交换数据并不***一定***是坏事，因为它是一个大数据集。

但是，如果您要交换非常大的 XML 文件，您可能需要考虑在传输之前使用 zip、GZIP 等方式对它们进行压缩，以节省时间和带宽。

如果您正在交换数据库信息，请考虑将信息格式化为 SQL 语句（甚至在发送之前压缩这些 SQL 文件）；特别是如果那是您最终将 XML 转换为的内容。

# java - SwingWorker 的原理是什么？

> ID：281855
> 
> 赞同：6
> 
> 时间：2008-11-11T19:10:21.833
> 
> 标签：java, multithreading, swing, swingworker

据我所知，它用于在 Swing 应用程序中调度一个新线程以执行一些“后台”工作，但是使用它而不是“普通”线程有什么好处？

使用新线程和使用 SwingUtilities.invokeLater 完成调用某些 GUI 方法时不一样吗？...

我在这里想念什么？

[http://en.wikipedia.org/wiki/SwingWorker](http://en.wikipedia.org/wiki/SwingWorker)

[http://java.sun.com/products/jfc/tsc/articles/threads/threads2.html](http://java.sun.com/products/jfc/tsc/articles/threads/threads2.html)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T19:39:15.037

是的，您可以使用普通线程 + invokeLater 完成 SwingWorker 所做的事情。SwingWorker 提供了一种可预测的集成方式来在后台线程上完成任务并在 EDT 上报告结果。SwingWorker 还添加了对中间结果的支持。同样，您可以自己完成所有这些工作，但有时使用集成且可预测的解决方案很容易，尤其是在并发方面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T07:09:41.913

代码示例：

```
import org.jdesktop.swingx.util.SwingWorker; // This one is from swingx
                                             // another one is built in 
                                             // since JDK 1.6 AFAIK?

public class SwingWorkerTest {

  public static void main( String[] args ) {

    /**
      * First method
      */
    new Thread() {

      public void run() {

        /** Do work that would freeze GUI here */

        final Object result = new Object();
        java.awt.EventQueue.invokeLater( new Runnable() {

          public void run() {
          /** Update GUI here */
          }
        } );

      }
    }.start();

    /**
      * Second method
      */
    new SwingWorker< Object , Object >() {

      protected Object doInBackground() throws Exception {
        /** Do work that would freeze GUI here */

        return null;
      }

      protected void done() {
        try {
          Object result = get();
          /** Update GUI here */
        }
        catch ( Exception ex ) {
          ex.printStackTrace();
          if ( ex instanceof java.lang.InterruptedException )
            return;
        }
      }
    }.execute();
  }

} 
```

选择始终取决于个人偏好和用例。

第二种方法在重构时具有优势。当使用的方法太大时，您可以更轻松地将匿名类转换为内部类。

我个人偏好第二种，因为我们已经构建了一个框架，可以在其中添加 SwingWorkers 并一个接一个地执行......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T19:19:01.847

SwingWorker 是一种通用模式的实现（在 .Net 中我读到有~~GuiWorker~~ BackgroundWorker 为此），您必须在 GUI 程序中做一些工作，但要保持 GUI 响应。问题是 GUI 库通常不是多线程安全的，因此实现此类工作器的常用方法是使用库的消息循环将消息传递到应用程序的事件循环中。

这些类允许您轻松更新您的 GUI。通常，它们有一个`update(int status)`由线程调用、由类分派并由 GUI 处理的方法，同时线程继续其工作。

使用普通线程，您将需要为此任务编写自己的事件或一些其他消息传递机制，如果您经常需要此功能，这可能会很痛苦。例如，在 Java 中使用 invokeLater，您可以将用于更新 gui 的代码混合到用于完成工作的代码中。SwingWorker 允许您将事物分开。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T19:36:32.187

回答你的问题，你没有错过任何东西。这个类只是一个方便的实用程序，用于包装您描述的功能（启动另一个线程来完成后台工作，然后在 EDT 上调用一些最终操作并使用结果）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-03T15:30:41.043

使用 Swing 时，重要的是要知道主要的 Swing 处理（即渲染）发生在单个线程上（这不是您的主线程）。这通常称为 Swing 或 awt 事件线程。那些熟悉 JDK pre 1.6 的人会记得如果您在事件调度程序中花费太多时间来处理 swing 组件的“灰色矩形”错误。这是什么意思。在任何 Swing 应用程序中，您将运行 2 个线程，您现在必须处理这些线程。通常，如果您在事件调度程序中的所有操作（当单击按钮时触发的代码）都很短（即更改 siwng 按钮的状态），您可以在事件调度程序内部运行它。如果您的应用程序将调用 Web 服务或数据库，或者您的应用程序状态由外部事件驱动（即。jms）或者您只想使您的 UI 更具交互性（即构建项目列表并能够做其他事情），您应该使用 awt 事件线程（主要摆动线程）以外的线程。因此，在这些情况下，您会生成一个新线程并执行您必须执行的操作，当结果最终返回时，您必须以某种方式创建一个可由 awt/swing 调度程序执行的事件。SwingWorker 是一个很棒的小设计模式，它允许您这样做（另一种方式是 SwingUtilities）。它对于从外部来源获取数据或进行长时间计算（渲染图形场景）特别有用。它有助于自动调度和随后重新集成来自外部线程（除了 awt 线程）的结果。对于异步事件（即来自 JMS 的事件需要更新结果，请使用 SwingUtilities）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T14:38:43.973

`SwingWorker`使琐碎的示例代码更加简洁。然而，它会产生一个泥球。进出 GUI 和执行逻辑的通信都焊接在一起。所以，我不希望看到它在实际生产代码中使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-16T00:53:28.903

SwingWorker 比处理自己的线程要容易得多，因为它为您提供了两件手动操作很痛苦的事情，UI 和后台进程之间的线程协调以及有效执行循环，后台工作保持工作并将更新逐步发送回 UI，比如处理大量数据，或者加载一个大列表。缺点（或优点）取决于您如何看待它，它隐藏了底层实现，因此未来版本可能具有不同的行为、性能等，这可能是不可取的。我发现它作为 UI 事件和我自己的命令代码之间的粘合剂非常有用，SwingWorker 维护到 UI 的链接并且我的代码泵送数据。

# vb.net - 在 VB.Net 中获取没有 DNS 条目的远程客户端的 IP 地址

> ID：281856
> 
> 赞同：0
> 
> 时间：2008-11-11T19:10:45.890
> 
> 标签：vb.net, dns, ip-address, remote-client

我有一个在终端服务器上运行的 Windows 窗体应用程序。我需要确定每台客户端机器的 IP 地址。

我找到了一种方法来检索具有 DNS 条目的计算机的 IP 地址（下面的示例），但是我的几个瘦客户端设置为静态 IP 并且没有 DNS 名称。有没有办法在没有 DNS 名称的情况下确定远程客户端的 IP 地址？

```
Dim clientName As String = My.Computer.Network.ClientName 
Dim IPHost As Net.IPHostEntry = Net.Dns.Resolve(clientName & "domain.com") 
Dim addresses As Net.IPAddress() = IPHost.AddressList
fullIP = addresses(0).ToString() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T19:27:24.000

要获取主 IP 地址，您可以使用：

```
System.Net.Dns.GetHostEntry("").AddressList(0).ToString 
```

这可能会返回 IP6 地址，在这种情况下，您可以尝试使用以下方法查找 IP4：

```
Dim ipentry As System.Net.IPHostEntry = System.Net.Dns.GetHostEntry("")

For i As Integer = 0 To ipentry.AddressList.Count - 1
    MsgBox(System.Net.Dns.GetHostEntry("").AddressList(i).ToString)
Next 
```

# asp.net - 访问 ASP.NET 类中的响应对象

> ID：281864
> 
> 赞同：6
> 
> 时间：2008-11-11T19:16:32.180
> 
> 标签：asp.net, class, cookies, httpresponse

我有一个函数可以检查 cookie（按名称）是否存在：

```
Private Function cookieExists(ByVal cName As String) As Boolean
    For Each c As HttpCookie In Response.Cookies
        If c.Name = cName Then Return True
    Next
    Return False
End Function 
```

我有一个以特定于应用程序的方式处理 cookie 的类，我想将所有与 cookie 相关的函数合并到这个类中。但是，如果我只是将它从 aspx 页面（它当前所在的位置）移动到上述类，我将无法使用此代码，因为我收到错误：`'Name' Response is not declared.` 我修改了类以允许传递对**`Response`**对象的引用：

```
Public Function cookieExists(ByVal cName As String, ByRef Response As HttpResponse) As Boolean
    For Each c As HttpCookie In Response.Cookies
        If c.Name = cName Then Return True
    Next
    Return False
End Function 
```

我的问题是：有没有更好的方法？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-11T19:19:52.500

```
HttpContext.Current.Response
HttpContext.Current.Request 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T19:22:57.160

HttpContext.Current 使用 Ambient Context 设计模式，因此您应该能够从代码中的任何位置访问 Response 对象。这是非常有用的。

对于那些想知道的人来说，环境上下文模式非常酷，这里有详细说明：

[http://aabs.wordpress.com/2007/12/31/the-ambient-context-design-pattern-in-net/](http://aabs.wordpress.com/2007/12/31/the-ambient-context-design-pattern-in-net/)

# mysql - 查询：计算每个项目的多个聚合

> ID：281866
> 
> 赞同：2
> 
> 时间：2008-11-11T19:17:37.950
> 
> 标签：mysql, sql, grouping, mysql-error-1054

通常，您需要显示数据库项目的列表和每个项目的某些汇总数字。例如，当您在 Stack Overflow 上键入标题文本时，会出现“相关问题”列表。该列表显示相关条目的标题和每个标题的单个汇总响应数量。

我有类似的问题，但需要多个聚合。我想根据用户选项以 3 种格式中的任何一种显示项目列表：

*   我的项目名称（共 15 个，我拥有 13 个）
*   我的商品名称（共 15 个）
*   我的物品名称（我拥有 13 个）

我的数据库是：

*   **项目**: itemId, itemName, ownerId
*   **类别**：catId、catName
*   **地图**：mapId、itemId、catId

下面的查询获取：类别名称，每个类别的项目 ID 计数

```
SELECT
  categories.catName,
  COUNT(map.itemId) AS item_count
FROM categories
LEFT JOIN map
  ON categories.catId = map.catId
GROUP BY categories.catName 
```

这个得到：类别名称，仅此 owner_id 的每个类别的项目 ID 计数

```
SELECT categories.catName, 
COUNT(map.itemId) AS owner_item_count
FROM categories
LEFT JOIN map
  ON categories.catId = map.catId
LEFT JOIN items
  ON items.itemId = map.itemId
WHERE owner = @ownerId
GROUP BY categories.catId 
```

但是我如何在单个查询中同时获取它们？即：类别名称、每个类别的项目 ID 计数、每个类别的项目 ID 计数仅为此 owner_id

奖金。我怎样才能有选择地只检索其中任何一个 catId count != 0 的位置？在尝试“WHERE item_count <> 0”时，我得到：

```
MySQL said: Documentation
#1054 - Unknown column 'rid_count' in 'where clause' 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T19:27:04.733

这是一个技巧：计算`SUM()`已知为 1 或 0 的值的 a 等价于`COUNT()`值为 1 的行中的 a。您知道布尔比较返回 1 或 0（或 NULL）。

```
SELECT c.catname, COUNT(m.catid) AS item_count,
  SUM(i.ownerid = @ownerid) AS owner_item_count
FROM categories c
  LEFT JOIN map m USING (catid)
  LEFT JOIN items i USING (itemid)
GROUP BY c.catid; 
```

至于额外的问题，您可以简单地进行内部联接而不是外部联接，这意味着只返回至少包含一行的类别`map`。

```
SELECT c.catname, COUNT(m.catid) AS item_count,
  SUM(i.ownerid = @ownerid) AS owner_item_count
FROM categories c
  INNER JOIN map m USING (catid)
  INNER JOIN items i USING (itemid)
GROUP BY c.catid; 
```

这是另一种解决方案，效率不高，但我将展示它以解释您收到错误的原因：

```
SELECT c.catname, COUNT(m.catid) AS item_count,
  SUM(i.ownerid = @ownerid) AS owner_item_count
FROM categories c
  LEFT JOIN map m USING (catid)
  LEFT JOIN items i USING (itemid)
GROUP BY c.catid
HAVING item_count > 0; 
```

您不能在`WHERE`子句中使用列别名，因为`WHERE`子句中的表达式在选择列表中的表达式之前计算。换句话说，与选择列表表达式关联的值尚不可用。

`GROUP BY`您可以在、`HAVING`和`ORDER BY`子句中使用列别名。这些子句在选择列表中的所有表达式都被求值后运行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T19:32:20.447

您可以在 SUM() 中偷偷添加一个 CASE 语句：

```
SELECT categories.catName, 
    COUNT(map.itemId) AS item_count,
    SUM(CASE WHEN owner= @ownerid THEN 1 ELSE 0 END) AS owner_item_count
FROM categories
LEFT JOIN map  ON categories.catId = map.catId
LEFT JOIN items  ON items.itemId = map.itemId
GROUP BY categories.catId
HAVING COUNT(map.itemId) > 0 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T19:48:35.157

```
SELECT categories.catName, 
  COUNT(map.itemId) AS item_count,
  COUNT(items.itemId) AS owner_item_count
FROM categories
INNER JOIN map
  ON categories.catId = map.catId
LEFT JOIN items
  ON items.itemId = map.itemId
  AND items.owner = @ownerId
GROUP BY categories.catId 
```

请注意，您可以使用`HAVING`on 子句`owner_item_count`，但内部连接会为您处理 item_count。

# asp.net-mvc - 为什么 ASP.NET MVC 中的 SessionID 不断变化？

> ID：281881
> 
> 赞同：48
> 
> 时间：2008-11-11T19:23:25.427
> 
> 标签：asp.net-mvc, session

我正在尝试跟踪某些内容并使用 SessionID 作为该对象的关键

但是，每 2-3 个请求更改的 SessionID 不应该保持不变吗？

```
HttpContext.Session.SessionID 
```

是我正在使用的代码。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-11-12T08:40:19.203

我已经看到即使没有 MVC 也会发生这种情况。如果我没记错的话，ASP.NET 会一直分配新的会话 ID，直到您将某些内容放入 Session 变量中。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2011-04-29T18:04:31.197

您应该在`Global.asax.cs`.

```
void Session_Start(object sender, EventArgs e)
{
    HttpContext.Current.Session.Add("__MyAppSession", string.Empty);
} 
```

这样，除非您的浏览器窗口关闭，否则会话不会改变。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-19T18:52:14.357

我正在开发一个 .NET MVC 购物车应用程序并添加了

```
Session["myVar"] = "1234"; 
```

到 Default.aspx.cs 代码中的 Page_Load 方法。我还添加了

```
<%=  this.Session.SessionID %> 
```

到 Site.Master 页脚。然后我重新构建了我的应用程序并浏览了我的应用程序的各个页面，页脚按预期显示所有页面的相同会话 ID！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-10-28T23:18:57.540

如果您查看，除非在服务器上使用，否则会话 ID cookie 甚至不会发送到浏览器。

因此，当页面往返时，没有当前的会话 ID cookie，因此会创建一个新的会话 ID，因此它是随机的。

这是合乎逻辑的，如果会话未使用，为什么还要将应用程序绑定到会话？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T19:37:13.713

我会考虑使用 TempData 来跟踪某些内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T08:35:29.040

尝试将机器密钥添加到您的 web.config 中：
在线密钥生成器：[http](http://aspnetresources.com/tools/keycreator.aspx) ://aspnetresources.com/tools/keycreator.aspx 似乎服务器会为客户端重置机器密钥并每隔几分钟生成一个具有新会话 ID 的新密钥，这远低于应有的水平。不知道这是错误还是功能:)
另外，您可以增加会话状态超时，我认为默认为 20 分钟。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-20T21:23:08.030

我在使用 ASP.NET Web 窗体时遇到了同样的问题。我只需要`global.asax`在解决方案中添加一个文件并为我修复它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-03-23T01:36:36.437

总结上面@jrojo 和@Maxam 的答案，以及我正在使用的内容。

我使用 AWS DynamoDB 作为会话存储（超出了问题的范围，但给出了示例）。

通过 NUGET 添加包：Install-Package AWS.SessionProvider

更新 Web.config 以在 appSettings 中有键：

```
<add key="AWSAccessKey" value="XXX" />
<add key="AWSSecretKey" value="YYY" /> 
```

和 system.web 的会话提供者：

```
<sessionState timeout="20"
              mode="Custom"
              customProvider="DynamoDBSessionStoreProvider">
  <providers>
    <add name="DynamoDBSessionStoreProvider"
      type="Amazon.SessionProvider.DynamoDBSessionStateStore, AWS.SessionProvider"
      AWSProfilesLocation=".aws/credentials"
      Table="ASP.NET_SessionState"
      Region="us-east-1"
      />
  </providers>
</sessionState> 
```

在会话开始时向 global.asax 中的会话添加任何内容：

```
void Session_Start(object sender, EventArgs e) {
  HttpContext.Current.Session.Add("somethingToForceSessionIdToStick", string.Empty);
} 
```

通过将此添加到任何页面的剃刀来验证。刷新该页面，然后打开一个 ignito 窗口并查看不同的会话：

```
@HttpContext.Current.Session.SessionID 
```

# 鲍勃你叔叔

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-01-04T16:59:06.167

请查看您是否已将 cookie samesite 属性设置为严格。

删除 cookieSameSite="Strict" 并检查。

# webserver - 小型 Web 服务器

> ID：281884
> 
> 赞同：8
> 
> 时间：2008-11-11T19:23:48.407
> 
> 标签：webserver

有人可以建议一个小型网络服务器实现来说明网络服务器的功能吗？它应该是一种易于阅读和理解的语言，并且应该实现安全性和 cgi，也许是 javascript？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T02:59:30.000

[thttpd](http://www.acme.com/software/thttpd/)，一个微型/涡轮/节流 http 服务器。

它是用 C 编写的。如果“一种易于阅读的语言”是指“不是 C”，那没关系。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T19:24:45.003

[轻量级](http://www.lighttpd.net/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T19:28:26.867

[Github Mongrel 源码仓库](http://github.com/engineyard/mongrel/tree/master)

*   有据可查
*   全面测试
*   主要是 Ruby，所以它很容易阅读
*   您可以下载 repo 并很容易地使用代码

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T19:07:28.210

[http://www.rebol.org/cgi-bin/cgiwrap/rebol/view-script.r?script=webserver.r](http://www.rebol.org/cgi-bin/cgiwrap/rebol/view-script.r?script=webserver.r)

用几行代码编写的 Web 服务器 - 易于理解。

或者，这个，使用 CGI

[http://www.rebol.org/view-script.r?script=webserv.r](http://www.rebol.org/view-script.r?script=webserv.r)

你说的安全是什么意思？Javascript 通常只是页面内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T17:55:58.730

[http://www.rebol.net/cookbook/recipes/0057.html](http://www.rebol.net/cookbook/recipes/0057.html)

有解释的前 REBOL 之一

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-17T06:00:19.200

[Noir](http://webnoir.org/) Web 服务器（Clojure）非常简洁，这是一个示例服务器：

```
(ns my-app
  (:use noir.core)
  (:require [noir.server :as server]))

(defpage "/welcome" []
    "Welcome to Noir!")

(server/start 8080) 
```

# python - 在文件上打开资源管理器

> ID：281888
> 
> 赞同：89
> 
> 时间：2008-11-11T19:24:56.563
> 
> 标签：python, windows, explorer

在 Python 中，如何在 Windows 资源管理器中跳转到文件？我找到了跳转到文件夹的解决方案：

```
import subprocess
subprocess.Popen('explorer "C:\path\of\folder"') 
```

但我没有文件的解决方案。

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2008-11-11T19:33:14.737

来自[Geoff Chappell 的*Windows 资源管理器命令行*](http://www.geoffchappell.com/studies/windows/shell/explorer/cmdline.htm)

```
import subprocess
subprocess.Popen(r'explorer /select,"C:\path\of\folder\file"') 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2018-03-07T19:40:39.607

一个更好、更安全的解决方案（不幸的是仅在 Windows 中）是[os.startfile()](https://docs.python.org/3.6/library/os.html#os.startfile)。

当它被赋予一个文件夹而不是一个文件时，它将打开资源管理器。

我知道我没有完全回答这个问题，因为它没有选择文件，但是使用`subprocess`总是一个坏主意（出于安全原因），这个解决方案可能会帮助其他人。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2018-06-21T09:56:13.990

由于`explorer`可以被覆盖，直接指向可执行文件会更安全一些。（也必须[接受这方面的教育](https://bandit.readthedocs.io/en/latest/plugins/b607_start_process_with_partial_path.html#b607-start-process-with-partial-path)）

当您使用它时：使用 Python 3s current subprocess API：`run()`

```
import os
import subprocess
FILEBROWSER_PATH = os.path.join(os.getenv('WINDIR'), 'explorer.exe')

def explore(path):
    # explorer would choke on forward slashes
    path = os.path.normpath(path)

    if os.path.isdir(path):
        subprocess.run([FILEBROWSER_PATH, path])
    elif os.path.isfile(path):
        subprocess.run([FILEBROWSER_PATH, '/select,', path]) 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-12-02T13:51:51.653

出于某种原因，在 Windows 7 上，它总是打开用户路径，对我来说，如下所示：

```
import subprocess
subprocess.call("explorer C:\\temp\\yourpath", shell=True) 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2018-10-18T19:48:50.180

或者，您可以使用[EasyGUI](http://easygui.sourceforge.net/)的 fileopenbox 模块打开文件资源管理器供用户单击，然后选择一个文件（返回完整的文件路径）。

```
import easygui
file = easygui.fileopenbox() 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2020-12-15T15:57:41.223

对于任何想知道如何使用变量代替直接文件路径的人。下面的代码将打开资源管理器并突出显示指定的文件。

```
import subprocess
subprocess.Popen(f'explorer /select,{variableHere}') 
```

下面的代码只会在资源管理器中打开指定的文件夹，而不突出显示任何特定文件。

```
import subprocess
subprocess.Popen(f'explorer "{variableHere}"') 
```

我只在windows上测试过

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2021-12-06T06:27:43.097

在资源管理器中打开文件夹的代码：

```
import os
import ctypes
SW_SHOWDEFAULT = 10
path_to_open = os.getenv('windir')
ctypes.windll.shell32.ShellExecuteW(0, "open", path_to_open, 0, 0, SW_SHOWDEFAULT) 
```

# hibernate - Hibernate JPA 到 DDL 命令行工具

> ID：281890
> 
> 赞同：6
> 
> 时间：2008-11-11T19:25:39.930
> 
> 标签：hibernate, jpa

有用于将文件映射到 ddl 生成的 Hibernate 工具；ddl 到映射文件等等，但是我找不到任何命令行工具来从 JPA 注释类生成简单的 DDL。

有谁知道一个简单的方法来做到这一点？（不使用 Ant 或 Maven 解决方法）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-31T00:20:59.837

我不确定这是否被认为是一种解决方法，因为您已经在问题中提到了它。您可以使用[Hibernate 工具](http://tools.hibernate.org/)从 JPA 注释类生成 DDL。您只需要休眠工具及其对类路径的依赖关系，并且应该可以使用以下内容：

```
<target name="schemaexport" description="Export schema to DDL file"
    depends="compile-jpa"> <!-- compile model classes before running hibernatetool -->

  <!-- task definition; project.class.path contains all necessary libs -->
  <taskdef name="hibernatetool" classname="org.hibernate.tool.ant.HibernateToolTask"
      classpathref="project.class.path" />

  <hibernatetool destdir="export/db"> <!-- check that directory exists -->
    <jpaconfiguration persistenceunit="myPersistenceUnitName" />
    <classpath>
      <!--
          compiled model classes and other configuration files don't forget
          to put the parent directory of META-INF/persistence.xml here
      -->
    </classpath>
    <hbm2ddl outputfilename="schemaexport.sql" format="true"
        export="false" drop="true" />
  </hibernatetool>
</target> 
```

另一方面，如果您将 Eclipse 与 Webtools 一起使用并且已正确配置项目设置，则只需右键单击并从上下文菜单中选择*Generate DDL 。*更多关于[Eclipse Dali 网站](http://www.eclipse.org/webtools/dali/)的信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-30T21:30:28.243

这里解释了如何使用 hibernate SchemaExport 类来做你想做的事。类似于前面提到的anttask方法，但不是每个人都使用ant。您可以直接从命令行执行此示例代码。

[http://jandrewthompson.blogspot.com/2009/10/how-to-generate-ddl-scripts-from.html](http://jandrewthompson.blogspot.com/2009/10/how-to-generate-ddl-scripts-from.html)

希望这可以帮助。

# security - 如何在 .NET 中使用 Membership 重命名角色？

> ID：281891
> 
> 赞同：6
> 
> 时间：2008-11-11T19:26:06.967
> 
> 标签：security, asp.net-membership, roles

我正在使用 ASP.NET Membership 并注意到[Roles 类](http://msdn.microsoft.com/en-us/library/system.web.security.roles_members.aspx)中没有*修改*角色（例如其名称）的方法，只能创建和删除它们。

有可能还是不支持？

编辑：@CheGueVerra：是的，很好的解决方法。

你知道（额外的信用:)）为什么这是不可能的吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-11T19:41:49.947

没有直接的方法来更改成员资格提供程序中的角色名称。

我将获取您要重命名的角色中的用户列表，然后将它们从列表中删除，删除角色，使用新名称创建角色，然后将之前找到的用户添加到使用新名称的角色中。

```
public void RenameRoleAndUsers(string OldRoleName, string NewRoleName)
{
    string[] users = Roles.GetUsersInRole(OldRoleName);
    Roles.CreateRole(NewRoleName);
    Roles.AddUsersToRole(users, NewRoleName);
    Roles.RemoveUsersFromRole(users, OldRoleName);
    Roles.DeleteRole(OldRoleName);
} 
```

这将更改角色中所有用户的角色名称。

跟进：角色，用于确保用户仅在系统中发挥他的作用，因此 User.IsInRole(ROLE_NAME) 将帮助您执行适用于用户及其所在角色的 BR 证券。如果您可以即时更改角色名称，您将如何验证用户是否确实处于该角色中。嗯，这就是我的理解，当我问到它时。

rtpHarry 编辑：将伪代码示例转换为可编译的 c# 方法

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T19:31:40.823

以编程方式重命名 ASP.NET 成员模型中的角色将是一件坏事™，因为角色名称在配置文件中用于定义权限。如果有一种编程方式来更改角色名称（将更改持久化到数据库），您将立即破坏 web.config 中任何使用数据库的 Web 应用程序的基于角色的安全配置，并且没有办法保证单个 Web 应用程序可以使用该会员数据库更改每个 Web 应用程序的配置。

# vba - 如何在不使用循环的情况下返回 VBA 中的一系列单元格？

> ID：281909
> 
> 赞同：5
> 
> 时间：2008-11-11T19:32:37.810
> 
> 标签：vba, excel, range

假设我有一个如下的 excel 电子表格：

```
col1 col2
------------
狗1狗
狗2狗
狗3狗
狗4狗
猫1猫
cat2 猫
cat3 猫

```

我想根据“狗”或“猫”返回一系列单元格（dog1，dog2，dog3，dog4）或（cat1，cat2，cat3）

我知道我可以做一个循环来一一检查，但是VBA中有没有其他方法可以让我一次“过滤”结果？

也许 Range.Find(XXX) 可以提供帮助，但我只看到一个单元格而不是一系列单元格的示例。

请指教

问候

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T22:24:11.553

以下是有关使用记录集返回范围的一些说明。

```
Sub GetRange()
Dim cn As Object
Dim rs As Object
Dim strcn, strFile, strPos1, strPos2

    Set cn = CreateObject("ADODB.Connection")
    Set rs = CreateObject("ADODB.Recordset")

    strFile = ActiveWorkbook.FullName

    strcn = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" _
    & strFile & ";Extended Properties='Excel 8.0;HDR=Yes;IMEX=1';"

    cn.Open strcn

    rs.Open "SELECT * FROM [Sheet1$]", cn, 3 'adOpenStatic'

    rs.Find "Col2='cat'"
    strPos1 = rs.AbsolutePosition + 1
    rs.MoveLast
    If Trim(rs!Col2 & "") <> "cat" Then
        rs.Find "Col2='cat'", , -1 'adSearchBackward'
        strPos2 = rs.AbsolutePosition + 1
    Else
        strPos2 = rs.AbsolutePosition + 1
    End If
    Range("A" & strPos1, "B" & strPos2).Select
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T19:54:01.170

这家伙有一个很好的 FindAll 功能：

[http://www.cpearson.com/excel/findall.aspx](http://www.cpearson.com/excel/findall.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T21:15:51.380

忘记了另一个 XL2007 功能：高级过滤。如果你想在 VBA 中使用它，我是从录制的宏中得到的：

```
Range("A1:A1000000").AdvancedFilter Action:=xlFilterCopy, CopyToRange:= Range("F1"), Unique:=True 
```

我把它计时在大约0.35秒......

诚然，如果您没有 2007 年，则没有多大用处。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T20:10:44.503

谢谢DJ。

FindAll 解决方案仍然使用 VBA 循环来执行操作。

我试图找到一种方法，而不使用用户级循环来过滤 excel VBA 中的范围。

在这里，我找到了解决方案。它利用 excel 内置引擎来完成这项工作。

(1) 使用 worksheetfunction.CountIf(,"Cat") 获取“cat”单元格的计数

(2) 使用 .Find("cat") 获取第一行“cat”

通过行数和第一行，我已经可以得到“猫”范围。

这个解决方案的好处是：没有用户级循环，如果范围很大，这可能会提高性能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T20:33:03.757

Excel 支持 ODBC 协议。我知道您可以从 Access 数据库连接到 Excel 电子表格并进行查询。我还没有这样做，但也许有一种方法可以从 Excel 内部使用 ODBC 查询电子表格。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T21:07:15.233

除非您使用的是非常老旧的机器，或者您有一个包含无数行的 XL2007 工作表，否则循环将足够快。诚实的！

不相信我？看这个。我用随机字母填充了一百万行范围：

```
=CHAR(RANDBETWEEN(65,90)) 
```

然后我编写了这个函数并使用 Control-Shift-Enter 从 26 个单元格范围内调用它：

```
=TRANSPOSE(UniqueChars(A1:A1000000)) 
```

这是我在几分钟内破解的不太优化的 VBA 函数：

```
Option Explicit

Public Function UniqueChars(rng As Range)

Dim dict As New Dictionary
Dim vals
Dim row As Long
Dim started As Single

    started = Timer

    vals = rng.Value2

    For row = LBound(vals, 1) To UBound(vals, 1)
        If dict.Exists(vals(row, 1)) Then
        Else
            dict.Add vals(row, 1), vals(row, 1)
        End If
    Next

    UniqueChars = dict.Items

    Debug.Print Timer - started

End Function 
```

在我使用了一年的 Core 2 Duo T7300 (2GHz) 笔记本电脑上，耗时 0.58 秒。

# javascript - 我可以更改 JavaScript 中的事件队列优先级吗？

> ID：281912
> 
> 赞同：4
> 
> 时间：2008-11-11T19:34:15.733
> 
> 标签：javascript, event-handling, event-queue

发生错误时，我需要播放独特的声音。该错误是由于快速输入的大约 200 个条码中的一个出现问题所致。事件队列似乎首先处理键盘输入（条形码扫描仪模拟），然后播放我的声音。因此，如果条形码被快速扫描，错误声音会留在队列中，被下一次扫描撞到。

我可以操纵队列的优先级吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T19:35:56.090

Javascript 不是多线程的，所以选项 2 不起作用。而且我怀疑您所说的事件队列是操作系统的事件队列，如果有的话，它不太可能从浏览器访问。

除此之外，我在理解您的问题时遇到了一些麻烦。什么是发出错误声音？它是`keyup`, etc 事件还是返回错误代码或其他内容的服务器端验证？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-17T17:10:19.230

我可以从您的问题中猜测是用户在听到错误声音时停止扫描。如果这是真的，为什么要等待用户停止扫描。

您可以执行以下任何操作。

一旦发生错误，停止输入数据。你可以设置'keypress'返回false。您也可以在按键事件上设置一个缓冲区，该缓冲区首先存储输入数据，然后返回 false。这样，您将在发生错误后进行数据处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T19:46:00.653

如果您尝试延迟扫描（使用[`setTimeout()`](http://www.sean.co.uk/a/webdesign/javascriptdelay.shtm)），让声音在它们之间开始和结束，该怎么办？

# java - 如何使用 Java（和 SQL Server）中的 Statement.execute() 更改数据库架构？

> ID：281913
> 
> 赞同：1
> 
> 时间：2008-11-11T19:35:39.007
> 
> 标签：java, sql-server

我需要以编程方式执行 SQL Server 系统存储过程，并且由于它在当前架构中执行，因此我需要即时更改它。

像这样

语句 st = connection.createStatement(); st.execute("EXEC SP_ADDUSER ' ', ' '");

但是 SP_ADDUSER 只在连接的当前模式集上执行，所以如果我想在各种模式中创建用户，我需要更改它，这就是我正在寻找的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T20:03:05.800

我不相信可以更改连接指向的数据库。

您可能需要为每个数据库（模式）创建一个单独的数据源/连接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T20:37:00.817

`EXEC <DatabaseName>..sp_adduser`可以从连接到任何数据库（甚至`master`，比如说）运行。连接不会受到影响。

例如，以下似乎在我的系统上运行良好：

```
USE master
EXEC sp_addlogin 'test1'
EXEC SandBox..sp_adduser 'test1' 
```

同样的事情可以通过客户端正常工作。您的客户端连接是否会改变您的 SQL？

```
using System;
using System.Data.SqlClient;

namespace TestUse
{
    class Program
    {
        static void Main(string[] args)
        {
            SqlConnection cn = new SqlConnection("Server=(local);Database=master;Trusted_Connection=True;");
            cn.Open();
            SqlCommand cmd = new SqlCommand("USE master; EXEC sp_addlogin 'test1'; EXEC SandBox..sp_adduser 'test1'", cn);
            cmd.ExecuteNonQuery();
            cn.Close();
        }
    }
} 
```

# asp.net - 当 ASP.NET 忽略 CustomValidator 时，您会怀疑什么？

> ID：281914
> 
> 赞同：0
> 
> 时间：2008-11-11T19:35:46.900
> 
> 标签：asp.net, validation, webforms, maintenance

这与代码问题一样是代码维护问题，但我有一个不再检查 CustomValidator 的 WebForm。一年多前我最后一次接触代码时它起作用了，但现在用户请求了一些更改，它不再起作用了......

WebForm 包含一个数据绑定下拉菜单，其中包含默认的“-All-”项，其值为 String.Empty。当用户单击提交按钮时，验证器应检查下拉列表的值是否不是 String.Empty。我在客户端验证代码和服务器验证代码中设置了断点，但都没有触发。

你会从哪里开始寻找？常见的嫌疑人是什么？当然，我已经将我的工作副本与源代码控制中的内容进行了比较，但没有任何可疑之处。

以防万一，这是我的代码：

```
<asp:DropDownList ID="_AssessmentDropDown" runat="server" DataSourceID="_AssessmentsData" CausesValidation="true" AutoPostBack="false"
    DataTextField="AssessmentName" DataValueField="AssessmentName" OnDataBound="_HandleAssessmentsBound">
</asp:DropDownList>
<asp:CustomValidator ID="_AssessmentValidator" runat="server" ClientValidationFunction="_HandleValidateAssessment_Client"
    ControlToValidate="_AssessmentDropDown" ErrorMessage="* You must select an Assessment."
    OnServerValidate="_HandleValidateAssessment" />
<asp:ObjectDataSource ID="_AssessmentsData" runat="server"
    OldValuesParameterFormatString="original_{0}" SelectMethod="GetData"
    TypeName="DataTableAdapters.GET_GRADE_ASSESSMENTSTableAdapter">
    <SelectParameters>
      <asp:ControlParameter Name="GRADECODE" ControlID="_GradeCodeDropDown" PropertyName="SelectedValue" />
    </SelectParameters>
</asp:ObjectDataSource> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T19:44:41.127

我注意到几个问题

*   如果 AutoPostBack 设置为 false，我认为您不需要 CausesValidation=true
*   您不使用验证组，因此这不是原因
*   为什么不使用RequiredFieldValidator？
*   如果要对空字段进行验证，请将 ValidateEmptyText 属性设置为 true

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T19:52:19.473

如果要验证的控件具有空值，则 CustomValidator 不会触发，因此 CustomValidator 应始终伴随 RequiredFieldValidator

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T19:38:08.440

一些故障排除步骤：

*   这是表单上唯一的验证器吗？
*   页面上是否启用了验证？
*   是否为目标控件启用了验证？
*   验证器本身是否启用？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T19:38:31.653

我会认真看看ValidationGroup。

如果某些内容被排除在组之外，它将不再有效。否则，请确保您没有任何 javascript 错误（对于客户端）并且“OnServerValidate”方法内部有一个断点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T19:38:37.503

验证器是否与提交按钮在同一个验证器组中？

# python - 如何进行同步 rpc 调用

> ID：281922
> 
> 赞同：4
> 
> 时间：2008-11-11T19:38:34.337
> 
> 标签：python, twisted

我正在构建一个程序，它有一个在本地使用的类，但我希望在网络上以相同的方式使用同一个类。这意味着我需要能够对其任何公共方法进行同步调用。该类读写文件，所以我认为 XML-RPC 开销太大。我使用来自 twisted 的示例创建了一个基本的 rpc 客户端/服务器，但是我遇到了客户端问题。

```
c = ClientCreator(reactor, Greeter)
c.connectTCP(self.host, self.port).addCallback(request)
reactor.run() 
```

这适用于单个调用，当接收到数据时，我调用 reactor.stop()，但如果我再进行调用，反应堆将不会重新启动。我应该为此使用其他东西吗？也许是不同的扭曲模块或另一个框架？

（我不包括协议如何工作的细节，因为主要的一点是我只得到一个调用。）

附录和说明：

我分享了一个谷歌文档，里面有关于我在做什么的注释。[http://docs.google.com/Doc?id=ddv9rsfd_37ftshgpgz](http://docs.google.com/Doc?id=ddv9rsfd_37ftshgpgz)

我有一个使用保险丝编写的版本，可以将多个本地文件夹组合到保险丝安装点。文件访问已经在一个类中处理，所以我希望有服务器可以让我对同一个类进行网络访问。继续搜索后，我怀疑 pyro ( [http://pyro.sourceforge.net/](http://pyro.sourceforge.net/) ) 可能是我真正想要的（仅基于现在阅读他们的主页），但我愿意接受任何建议。

我可以通过使用 nfs 挂载并将其与我的本地文件夹组合来获得类似的结果，但我希望所有对等方都可以访问相同的组合文件系统，因此这将要求每台计算机都成为具有多个 nfs 的 nfs 服务器挂载数量等于网络中的计算机数量。

**结论：** 我决定使用 rpyc，因为它给了我我想要的东西。一个服务器，它保留一个类的实例，我可以像在本地一样操作它。如果有人感兴趣，我会将我的项目放在 Launchpad ( [http://launchpad.net/dstorage](http://launchpad.net/dstorage) ) 上。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T20:04:35.330

对于同步客户端，Twisted 可能不是正确的选择。相反，您可能想直接使用 socket 模块。

```
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((self.host, self.port))
s.send(output)
data = s.recv(size)
s.close() 
```

`recv()`可能需要重复调​​用，直到您得到一个空字符串，但这显示了基础知识。

或者，您可以重新安排整个程序以支持异步调用...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T22:53:32.297

如果您甚至在考虑 Pyro，请先检查[RPyC](http://rpyc.wikidot.com/)，然后重新考虑 XML-RPC。

关于 Twisted：尝试让反应堆保持启动而不是停止它，并且`ClientCreator(...).connectTCP(...)`每次都这样做。

如果您`self.transport.loseConnection()`在您的协议中，您将不会留下打开的连接。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-24T23:32:46.583

为什么你觉得它需要同步？

如果您想确保一次只发生其中一个，请通过 DeferredSemaphore 调用所有调用，以便您可以对实际调用进行速率限制（任意值）。

如果您希望能够在不同时间运行这些流的多个流，但不关心并发限制，那么您至少应该将反应器启动和拆除与调用分开（反应器应该在整个过程的生命周期中运行）。

如果您只是不知道如何在反应器模式中表达应用程序的逻辑，您可以使用 deferToThread 并编写一段纯同步代码——尽管我猜这不是必需的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T22:07:13.990

如果您使用的是 Twisted，您可能应该知道：

1.  您不会对任何网络服务进行同步调用
2.  反应器只能运行一次，所以在`reactor.stop()`您的应用程序准备好退出之前不要停止它（通过调用）。

我希望这回答了你的问题。我个人认为 Twisted**正是**您的用例的正确解决方案，但您需要解决同步性问题。

附录和说明：

> 我不明白的部分原因是，当我调用 reactor.run() 时，它似乎进入了一个只监视网络活动的循环。如何在使用网络时继续运行程序的其余部分？如果我能克服这一点，那么我可能可以解决同步性问题。

这正是 reactor.run() 所做的。它运行一个主循环，它是一个事件反应器。它不仅会等待工作事件，还会等待您计划发生的任何其他事情。使用 Twisted，您将需要以处理其异步特性的方式构建应用程序的其余部分。也许如果我们知道它是什么类型的应用程序，我们可以提供建议。

# c# - 使用 C# 进行缓冲池管理

> ID：281924
> 
> 赞同：6
> 
> 时间：2008-11-11T19:38:55.520
> 
> 标签：c#, buffer, pool

我们需要为使用 C# 开发的应用程序开发某种缓冲区管理。

本质上，应用程序会在设备进入时接收来自设备的消息（短时间内可能会有很多消息）。我们需要将它们排在某种缓冲池中，以便我们可以以托管方式处理它们。

我们正在考虑以 256 字节的块分配一块内存（所有消息都小于这个值），然后使用缓冲池管理来拥有一个可用于传入消息的可用缓冲区池和一个准备好处理的缓冲区池.

因此流程将是“获取缓冲区”（处理它）“释放缓冲区”或“将其留在池中”。我们还需要知道缓冲区何时填满。

潜在地，我们还需要一种“窥视”缓冲区的方法，以查看池中最高优先级的缓冲区是什么，而不是总是获取下一个缓冲区。

.NET 中是否已经对此提供了支持，或者是否有一些我们可以使用的开源代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T19:48:13.647

C#sharps 内存管理实际上非常好，因此您可以准确地分配所需的内容并将其放入队列中，而不是使用缓冲区池。一旦你完成了缓冲区，就让垃圾收集器处理它。

另一种选择（对您的应用程序知之甚少）是在收到消息时对它们进行最低限度的处理，并将它们变成完整的对象（具有优先级和所有），然后您的队列可以通过调查正确的集合来确定它们的优先级属性或方法。

如果您的消息来得太快，即使处理最少，您也可以使用两个队列系统。一个只是未处理缓冲区的队列，下一个队列是从缓冲区构建的消息对象队列。

我希望这有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T19:49:24.640

为什么不直接接收消息，创建一个 DeviceMessage（因为没有更好的名称）对象，然后将该对象放入 Queue 中？如果优先级很重要，请实现一个自动处理的 PriorityQueue 类（通过在将 DeviceMessage 对象插入队列时按优先级顺序放置它们）。看起来更像是一种面向对象的方法，并且会随着时间的推移简化关于优先级的维护。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-04T21:58:01.353

@grieve：网络是原生的，这意味着当使用缓冲区接收/发送网络上的数据时，它们被固定在内存中。请参阅下面的评论以进行详细说明。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-10T23:18:03.907

我知道这是一篇旧帖子，但我认为您应该看看 ILNumerics 项目中实现的内存池。我认为他们完全符合您的需要，这是一段非常好的代码。[在http://ilnumerics.net/](http://ilnumerics.net/)下载代码并查看文件 ILMemoryPool.cs

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T21:14:00.197

我正在做类似的事情。我收到需要在 STA 线程上处理的 MTA 线程上的消息。

我使用了一个[BlockingCollection](http://blogs.msdn.com/pfxteam/)（并行 fx 扩展的一部分），它由多个 STA 线程（可配置，但默认为 xr * 核心数）监控。每个线程都试图从队列中弹出一条消息。他们要么超时并重试，要么成功弹出消息并提供服务。

我已经将它与 perfmon 计数器连接，以跟踪空闲时间、作业长度、传入消息等，可用于调整队列的设置。

您必须实现自定义集合，或者扩展 BC，以实现队列项目优先级。

我以这种方式实现它的原因之一是，据我了解，[排队理论](http://en.wikipedia.org/wiki/Queueing_theory)通常有利于单线、多服务器（为什么我觉得我会对此胡说八道？）。

# bash - Easy parallelisation

> ID：281928
> 
> 赞同：6
> 
> 时间：2008-11-11T19:40:06.003
> 
> 标签：bash, parallel-processing

I often find myself writing simple for loops to perform an operation to many files, for example:

```
for i in `find . | grep ".xml$"`; do bzip2 $i; done 
```

It seems a bit depressing that on my 4-core machine only one core is getting used.. is there an easy way I can add parallelism to my shell scripting?

EDIT: To introduce a bit more context to my problems, sorry I was not more clear to start with!

I often want to run simple(ish) scripts, such as plot a graph, compress or uncompress, or run some program, on reasonable sized datasets (usually between 100 and 10,000). The scripts I use to solve such problems look like the one above, but might have a different command, or even a sequence of commands to execute.

For example, just now I am running:

```
for i in `find . | grep ".xml.bz2$"`; do find_graph -build_graph $i.graph $i; done 
```

So my problems are in no way bzip specific! (Although parallel bzip does look cool, I intend to use it in future).

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-11T21:20:37.717

**Solution**: Use `xargs` to run in parallel (don't forget the `-n` option!)

```
find -name \*.xml -print0 | xargs -0 -n 1 -P 3 bzip2 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T19:53:33.447

[This perl program](http://www.perlmonks.org/?node_id=651934) fits your needs fairly well, you would just do this:

```
runN -n 4 bzip2 `find . | grep ".xml$"` 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T20:53:18.040

gnu make has a nice parallelism feature (eg. -j 5) that would work in your case. Create a Makefile

```
%.xml.bz2 : %.xml

all: $(patsubt %.xml,%xml.bz2,$(shell find . -name '*.xml') ) 
```

then do a

```
nice make -j 5 
```

replace '5' with some number, probably 1 more than the number of CPU's. You might want to do 'nice' this just in case someone else wants to use the machine while you are on it.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T19:53:49.173

The answer to the general question is difficult, because it depends on the details of the things you are parallelizing. On the other hand, for this specific purpose, you should use pbzip2 instead of plain bzip2 (chances are that pbzip2 is already installed or at least in the repositories or your distro). See here for details: [http://compression.ca/pbzip2/](http://compression.ca/pbzip2/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T20:00:55.837

I find this kind of operation counterproductive. The reason is the more processes access the disk at the same time the higher the read/write time goes so the final result ends in a longer time. The bottleneck here won't be a CPU issue, no matter how many cores you have.

Haven't you ever performed a simple two big file copies at the same time on the same HD drive? I is usually faster to copy one and then another.

I know this task involves some CPU power (bzip2 is demanding compression method), but try measuring first CPU load before going the "challenging" path we all technicians tend to choose much more often than needed.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-11T21:10:00.860

I did something like this for bash. The parallel make trick is probably a lot faster for one-offs, but here is the main code section to implement something like this in bash, you will need to modify it for your purposes though:

```
#!/bin/bash

# Replace NNN with the number of loops you want to run through
# and CMD with the command you want to parallel-ize.

set -m

nodes=`grep processor /proc/cpuinfo | wc -l`
job=($(yes 0 | head -n $nodes | tr '\n' ' '))

isin()
{
  local v=$1

  shift 1
  while (( $# > 0 ))
  do
    if [ $v = $1 ]; then return 0; fi
    shift 1
  done
  return 1
}

dowait()
{
  while true
  do
    nj=( $(jobs -p) )
    if (( ${#nj[@]} < nodes ))
    then
      for (( o=0; o<nodes; o++ ))
      do
        if ! isin ${job[$o]} ${nj[*]}; then let job[o]=0; fi
      done
      return;
    fi
    sleep 1
  done
}

let x=0
while (( x < NNN ))
do
  for (( o=0; o<nodes; o++ ))
  do
    if (( job[o] == 0 )); then break; fi
  done

  if (( o == nodes )); then
    dowait;
    continue;
  fi

  CMD &
  let job[o]=$!

  let x++
done

wait 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T19:46:52.010

I think you could to the following

> ```
> for i in `find . | grep ".xml$"`; do bzip2 $i&; done 
> ```

But that would spin off however many processes as you have files instantly and isn't an optimal as just running four processes at a time.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-03-05T22:48:59.700

If you had to solve the problem today you would probably use a tool like GNU Parallel (unless there is a specialized parallelized tool for your task like `pbzip2`):

```
find . | grep ".xml$" | parallel bzip2 
```

To learn more:

*   Watch the intro video for a quick introduction: [https://www.youtube.com/playlist?list=PL284C9FF2488BC6D1](https://www.youtube.com/playlist?list=PL284C9FF2488BC6D1)
*   Walk through the tutorial (man parallel_tutorial). You command line with love you for it.

# java - 如何在 Java 中使用 StringBuilder 重写这段代码？

> ID：281933
> 
> 赞同：3
> 
> 时间：2008-11-11T19:41:05.390
> 
> 标签：java, string, stringbuilder

给定一个词，我必须用一些特定的字母替换一些特定的字母，例如 1 代表 a，5 代表 b 等。我为此使用正则表达式。我知道 StringBuilder 是处理这个问题的最好方法，因为我正在做很多字符串操作。这是我正在做的事情：

```
String word = "foobooandfoo";
String converted = "";
converted = word.replaceAll("[ao]", "1");
converted = converted.replaceAll("[df]", "2");
converted = converted.replaceAll("[n]", "3"); 
```

我的问题是如何使用 StringBuilder 重写这个程序。我尝试了一切，但我无法成功。或者使用 String 就可以了？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T19:59:43.093

我认为这是一个清晰和性能完美契合的案例。我会使用查找表来进行“翻译”。

```
 public static void translate(StringBuilder str, char[] table)
  {
    for (int idx = 0; idx < str.length(); ++idx) {
      char ch = str.charAt(idx);
      if (ch < table.length) {
        ch = table[ch];
        str.setCharAt(idx, ch);
      }
    }
  } 
```

如果`str`输入的字母很大，或者映射稀疏，则可以使用真实的映射，如下所示：

```
 public static void translate(StringBuilder str, Map<Character, Character> table)
  {
    for (int idx = 0; idx < str.length(); ++idx) {
      char ch = str.charAt(idx);
      Character conversion = table.get(ch);
      if (conversion != null) 
        str.setCharAt(idx, conversion);
    }
  } 
```

虽然这些实现就地工作，但您可以创建一个新`StringBuilder`实例（或附加到传入的实例）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T19:49:32.630

我实际上会说代码在大多数应用程序中都很好，尽管它在理论上不如其他方法。如果您不想使用`Matcher`，请尝试如下：

```
StringBuilder result = new StringBuilder(word.length());

for (char c : word.toCharArray()) {
    switch (c) {
        case 'a': case 'o': result.append('1'); break;
        case 'd': case 'f': result.append('2'); break;
        case 'n': result.append('3'); break;
        default: result.append(c); break;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T19:46:05.583

我不知道 StringBuilder 是否适合您。我会考虑查看[Matcher ，它是 java regex 包的一部分，](http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Matcher.html)*如果你真的需要性能*，它可能比你上面的例子更快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T19:50:06.327

我不相信你可以。所有正则表达式替换 API 都使用 String 而不是 StringBuilder。

如果您基本上是将每个字符转换为不同的字符，则可以执行以下操作：

```
public String convert(String text)
{
    char[] chars = new char[text.length()];
    for (int i=0; i < text.length(); i++)
    {
        char c = text.charAt(i);
        char converted;
        switch (c)
        {
            case 'a': converted = '1'; break;
            case 'o': converted = '1'; break;
            case 'd': converted = '2'; break;
            case 'f': converted = '2'; break;
            case 'n': converted = '3'; break;
            default : converted = c; break;
        }
        chars[i] = converted;
    }
    return new String(chars);
} 
```

但是，如果您执行任何复杂的正则表达式，那显然不会有太大帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-13T14:35:03.537

StringBuilder 和 StringBuffer 在某些程序中可能会有很大的性能差异。请参阅：[http](http://www.thectoblog.com/2011/01/stringbuilder-vs-stringbuffer-vs.html) ://www.thectoblog.com/2011/01/stringbuilder-vs-stringbuffer-vs.html 这将是坚持下去的一个强有力的理由。

原始帖子要求将多字符替换为单个字符。这会影响调整大小，进而影响性能。

也就是说，最简单的方法是使用字符串。但是如果性能是一个问题，要注意它是否可以最大限度地减少 gc 和其他影响。

我喜欢 P Arrayah 的方法，但对于更通用的答案，它应该使用 LinkedHashMap 或保留顺序的东西，以防替换具有依赖性。

Map replaceRules = new HashMap();

Map replaceRules = new LinkedHashMap();

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T19:49:23.207

我看了看，[`Matcher.replaceAll()`](http://java.sun.com/javase/6/docs/api/java/util/regex/Matcher.html#replaceAll(java.lang.String))我注意到它返回一个`String`. 因此，我认为你所拥有的将会非常快。正则表达式易于阅读且快速。

记住优化的第一条规则：不要这样做！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T20:21:09.693

> 我知道 StringBuilder 是处理这个问题的最好方法，因为我正在做很多字符串操作。

谁对你这么说的？最好的方法是那些更容易阅读的方法，使用 StringBuilder 的方法。StringBuilder 在某些情况下，但在许多情况下并没有提供明显的加速。

如果值总是被替换，则不应初始化“已转换”。

您可以删除一些样板来改进您的代码：

```
String word = "foobooandfoo";
String converted = word.replaceAll("[ao]", "1")
                       .replaceAll("[df]", "2")
                       .replaceAll("[n]", "3"); 
```

如果你想使用 StringBuilder 你可以使用这个方法

java.util.regex.Pattern#matcher(java.lang.CharSequence)

它接受 CharSequence（由 StringBuilder 实现）。请参阅[http://java.sun.com/javase/6/docs/api/java/util/regex/Pattern.html#matcher(java.lang.CharSequence)](http://java.sun.com/javase/6/docs/api/java/util/regex/Pattern.html#matcher(java.lang.CharSequence))。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T10:44:59.653

StringBuilder 与 regex 是错误的二分法。String#replaceAll() 是错误工具的原因是，每次调用它时，您都在编译正则表达式并处理整个字符串。您可以通过将所有正则表达式组合为一个并使用 Matcher 中的低级方法而不是 replaceAll() 来避免所有多余的工作，如下所示：

```
String text = "foobooandfoo";
Pattern p = Pattern.compile("([ao])|([df])|n");
Matcher m = p.matcher(text);
StringBuffer sb = new StringBuffer();
while (m.find())
{
  m.appendReplacement(sb, "");
  sb.append(m.start(1) != -1 ? '1' :
            m.start(2) != -1 ? '2' :
                               '3');
}
m.appendTail(sb);
System.out.println(sb.toString()); 
```

当然，这仍然是大材小用；对于这样简单的工作，我推荐埃里克森的方法。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-11-11T20:57:58.920

我不建议为此使用任何正则表达式，当您进行简单操作时，这些实际上都非常缓慢。相反，我建议你从这样的事情开始

```
// usage:
Map<String, String> replaceRules = new HashMap<String, String>();
replaceRules.put("ao", "1");
replaceRules.put("df", "2");
replaceRules.put("n", "3");
String s = replacePartsOf("foobooandfoo", replaceRules);

// actual method
public String replacePartsOf(String thisString, Map<String, String> withThese) {
    for(Entry<String, String> rule : withThese.entrySet()) {
        thisString = thisString.replaceAll(rule.getKey(), rule.getValue());
    }

    return thisString;
} 
```

在你完成这个工作之后，将它重构为使用字符数组。虽然我认为您想要做的事情可以使用 StringBuilder 完成，但很可能不值得付出努力。

# uml - 是否有任何基于 Ajax 的 UML 建模工具？

> ID：281940
> 
> 赞同：1
> 
> 时间：2008-11-11T19:42:41.800
> 
> 标签：uml, modeling

我正在寻找用于 UML 建模的[WWW SQL Designer之类的东西。](http://ondras.zarovi.cz/sql/demo/?keyword=default)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T20:39:44.400

这个不在Ajax中，在flash中，至少在网上：[http ://www.gskinner.com/gmodeler/launch.html](http://www.gskinner.com/gmodeler/launch.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-01T01:38:15.843

[http://www.websequencediagrams.com/](http://www.websequencediagrams.com/)

序列图也是 UML。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-16T16:05:00.223

[http://www.umlcanvas.org/](http://www.umlcanvas.org/)（不再在线）

编辑：[https ://github.com/christophevg/UmlCanvas](https://github.com/christophevg/UmlCanvas)

* * *

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T17:19:33.613

不完全是 UML，但它是超级用户友好的，并根据您的模型自动生成 AJAX 应用程序原型。它为我们节省了很多时间。[http://www.xifactory.com](http://www.xifactory.com)

# coldfusion - ColdFusion 中的数据类型支持 querynew()

> ID：281945
> 
> 赞同：2
> 
> 时间：2008-11-11T19:44:00.377
> 
> 标签：coldfusion, casting, apache-poi

有谁知道使用 querynew() 函数在 ColdFusion 中手动创建的查询中将值存储为 NVARCHAR 的方法？我有一个大型程序的多个部分依赖于使用查询作为输入点来构建一个 excel 工作表（使用 Ben 的 POI），所以我可以继续将它用作查询以避免相对较大的重写，这有点重要。

当用户尝试存储超出 VARCHAR 范围的内容、一些日文字符等时，问题就出现了。

编辑：如果这是不可能的，而且你 100% 确定，我也想知道 :)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T21:52:40.493

到目前为止，我唯一能想到的是：

```
<cfset x = QueryNew("foobar")/>
<cfset queryAddRow(x) />
<cfset querySetCell(x, "foobar", chr(163)) />
<cfdump var="#x#"> 
```

转储时，此查询确实包含英镑符号。

我没有用 Ben 的 POI 实用程序尝试过这个，但希望它对你有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T22:45:27.563

您可以尝试使用 JavaCast() 来设置值，如下所示： [JavaCast() 上的 Kinky Solutions (Ben Nadel)](http://www.bennadel.com/blog/291-QueryNew-JavaCast-And-Notes-About-Data-Type-Translation.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T14:11:47.233

确保您[使用的是 Unicode end-to-end](http://mysecretbase.com/ColdFusion_and_Unicode.cfm)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T00:13:20.190

使用 queryNew() 创建 ColdFusion 查询时，您可以传递数据类型列表作为第二个参数。例如：

```
<cfset x = queryNew("foo,bar","integer,varchar") /> 
```

或者，您可以使用 cf_sql_varchar（您将在 queryparam 标记中使用）。根据 livedocs，nvarchar 被接受为 CF varchar 数据类型。

[QueryParam livedoc（为 nvarchar 数据类型引用）](http://livedocs.adobe.com/coldfusion/7/htmldocs/wwhelp/wwhimpl/common/html/wwhelp.htm?context=ColdFusion_Documentation&file=part_cfm.htm)

[QueryNew livedoc（数据类型定义引用）](http://livedocs.adobe.com/coldfusion/7/htmldocs/wwhelp/wwhimpl/common/html/wwhelp.htm?context=ColdFusion_Documentation&file=00000600.htm)

[管理数据类型 livedoc（参考使用 cf_sql_datatype）](http://livedocs.adobe.com/coldfusion/7/htmldocs/wwhelp/wwhimpl/common/html/wwhelp.htm?context=ColdFusion_Documentation&file=00001270.htm#1182700)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:09:46.497

这几乎就是您所需要的：

```
<cfprocessingdirective pageEncoding="utf-8"> 
```

ColdFusion (& java) 默认以 UTF-8 存储字符串。您只需告诉 CF 页面的编码是 UTF8。另一种方法是保存字节顺序标记 (BOM)，但 Eclipse/CFEclipse 不这样做。

# .net - Windows 服务中的“net use”命令

> ID：281951
> 
> 赞同：12
> 
> 时间：2008-11-11T19:46:38.453
> 
> 标签：.net, windows-services

我们在使用 C# .Net Framework 1.1 开发的 Windows 服务中使用以下命令行：

```
net use z: \\myComputer\c$ 
```

该服务在“myComputer”上的本地管理员域帐户下运行。调试代码后，我们可以看到它没有返回任何错误，但“z:”驱动器从未被映射。我们已经从控制台应用程序中尝试了完全相同的代码，它可以正常工作。我们需要在服务中添加什么来完成这项工作？

我们正在使用的代码包含在下面。

问候，
塞尔吉奥

```
startInfo.FileName = "net";  
startInfo.Arguments = string.Format(@"use {0}: \\{1}\{2}", driveLetter,
                                    computerName, folder).Trim();  
startInfo.UseShellExecute = false;  
startInfo.RedirectStandardError = true;

proc.EnableRaisingEvents = false;  
proc.StartInfo = startInfo;

proc.Start();

// If there is an error during the mapping of the drive, it will be read
// from the StandardError property which is a StreamReader object and
// be fed into the error output parameter.  
using(StreamReader errorReader = proc.StandardError)  
{  
         string standardError = string.Empty;  
    while((standardError = errorReader.ReadLine()) != null)  
    {  
        error += standardError + " ";  
    }  
}  
proc.WaitForExit(); 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-11T19:58:07.697

来自[http://msdn.microsoft.com/en-us/library/ms685143.aspx](http://msdn.microsoft.com/en-us/library/ms685143.aspx)：

> 必须访问远程资源的服务（或在不同安全上下文中运行的任何进程）应使用通用命名约定 (UNC) 名称来访问资源。服务必须具有适当的权限才能访问资源。如果服务器端服务使用 RPC 连接，则必须在远程服务器上启用委派。
> 
> 驱动器号对系统来说不是全局的。每个登录会话都会收到自己的一组从 A 到 Z 的驱动器号。因此，重定向的驱动器不能在不同用户帐户下运行的进程之间共享。此外，服务（或在其自己的登录会话中运行的任何进程）无法访问在不同登录会话中建立的驱动器号。
> 
> 服务不应通过映射驱动器号直接访问本地或网络资源，也不应在运行时调用 net use 命令映射驱动器号。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T20:07:23.327

您无法从 Windows 服务（包括注册表中的 HKEY-CURRENT-USER）访问用户属性，因为该服务不会以登录用户身份运行。

映射的驱动器是用户设置的一部分，因此您不能将它们用作服务，除非您手动挖掘注册表中的用户属性，映射服务中的驱动器等。这很痛苦。

您可能想要尝试做的是询问有关如何让您的服务执行登录序列的问题（可能是一些 .EXE）。这可能对你有用。

希望这会有所帮助，艾伦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-25T19:11:19.750

I was doing something similar to log in to a remote server, but without the mapped drive part. I don't like using mapped drives; in programs that is, I use subst for convenience all the time. Anyway, I just had to make sure to include

```
use \\server\c$ /user:admin password 
```

or whatever your user/password is that has access to the remote server, then it doesn't matter what the service is logged on as.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T19:49:35.093

您可能需要指定用于登录的帐户。在命令提示符下键入`net use /?`以获取使用命令进行设置的帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T19:51:58.647

我怀疑这是因为该服务没有在本地用户的上下文中运行。我记得，您可以将多年前的 Windows 服务配置为“与桌面交互”或类似的东西。

# javascript - 如何在 Safari 中单击输入文本字段时突出显示它？

> ID：281960
> 
> 赞同：4
> 
> 时间：2008-11-11T19:49:50.367
> 
> 标签：javascript, html, safari

我希望输入文本框的值在获得焦点时突出显示，无论是通过单击它还是通过 Tab 键。

```
<html>
<body>

<script>
function focusTest(el)
{
   el.select();
}
</script>

<input type="text" value="one" OnFocus="focusTest(this); return false;" />
<br/>
<input type="text" value="two" OnFocus="focusTest(this); return false;" />

</body>
</html> 
```

在 Firefox 或 IE 中单击任一输入字段时，该字段将突出显示。但是，这在 Safari 中不起作用。（注意：它在字段之间切换时有效。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T20:17:34.867

我注意到 Safari 实际上是在选择文本然后快速删除选择。

所以我尝试了这个适用于所有浏览器的快速解决方法：

```
function focusTest(el)
{
  setTimeout (function () {el.select();} , 50 );
} 
```

编辑：
经过进一步测试，事实证明 OnMouseUp 事件正在清除选择，因此足以添加

```
onMouseUp="return false;" 
```

到输入元素，以使事情按应有的方式工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T19:52:18.333

不确定此处是否有特定于 Safari 的解决方案，但另一种方法是将输入元素包装在 div 中并通过 CSS 设置它的边框属性。然后在聚焦和不聚焦时更改边框颜色等。

# .net - 在 .NET 中实现 AES 加密时，Streams 会做什么？

> ID：281970
> 
> 赞同：1
> 
> 时间：2008-11-11T19:53:51.747
> 
> 标签：.net, encryption, stream, aes, rijndaelmanaged

Rijndael 加密算法在 .NET 中使用以下示例中的 3 个流实现：[Rinjdael](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged.aspx)。

有人可以向我解释这些流在做什么吗？如何/为什么使用它们？

```
// Declare the streams used
// to encrypt to an in memory
// array of bytes.
MemoryStream msEncrypt = null;
CryptoStream csEncrypt = null;
StreamWriter swEncrypt = null;

// Declare the RijndaelManaged object
// used to encrypt the data.
RijndaelManaged aesAlg = null;

try
{
    // Create a RijndaelManaged object
    // with the specified key and IV.
    aesAlg = new RijndaelManaged();
    aesAlg.Key = Key;
    aesAlg.IV = IV;

    // Create a encryptor to perform the stream transform.
    ICryptoTransform encryptor = aesAlg.CreateEncryptor(aesAlg.Key, aesAlg.IV);

    // Create the streams used for encryption.
    msEncrypt = new MemoryStream();
    csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write);
    swEncrypt = new StreamWriter(csEncrypt);

    //Write all data to the stream.
    swEncrypt.Write(plainText);

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T20:05:46.450

`swEncrypt`is a `StreamWriter`- 它的工作是将文本转换为二进制数据

`csEncrypt`is a `CryptoStream`- 它的工作是将二进制数据转换为加密的二进制数据

`msEncrypt`is a `MemoryStream`- 它的工作是将它提供的数据存储在内存中，以便您以后可以将其取出

当你把它们放在一起时，你基本上会得到一些东西，你可以在一端编写纯文本，并从另一端获取加密的二进制数据（暂时存储在内存中）。

# asp.net - 什么是所有有效的 ASP.NET Webmethod 返回类型？

> ID：281978
> 
> 赞同：2
> 
> 时间：2008-11-11T19:59:45.027
> 
> 标签：asp.net, web-services, asmx

我的 webmethod 只能返回我在所有 asp.net 站点示例中看到的字符串吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T20:03:08.593

asp.net Webmethods 可以返回任何可序列化的数据类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-31T01:18:07.923

假设这个问题是关于传统 ASMX Web 服务技术的，请参阅[Data Types Supported by XML Web Services Created Using ASP.NET](http://msdn.microsoft.com/en-us/library/bb552900(v=vs.90).aspx)。

一定要注意它说的地方：

> **本主题特定于遗留技术。现在应该使用 [Windows Communication Foundation (WCF)](http://go.microsoft.com/fwlink/?LinkID=127777)创建 XML Web 服务和 XML Web 服务客户端。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T20:03:35.720

据我所知，您几乎可以返回任何 .NET 类，包括匿名类型。我返回了代表我的业务实体的自定义对象，包括子实体的通用集合。Guids、ints、strings 等基本上可以序列化为字符串的任何东西。

# sql-server - 您是否生成数据字典？

> ID：281979
> 
> 赞同：6
> 
> 时间：2008-11-11T19:59:55.417
> 
> 标签：sql-server, code-generation, data-dictionary

您是否生成数据字典？如果是这样，怎么做？

我使用 SQL Server 2005 中的扩展过程来保存表和字段信息。我有一些查询可以从中创建字典，但它是……嗯。您是否使用了特定的查询或工具？你是从你的数据库图表中生成它的吗？

谷歌搜索“数据字典 sql server”会出现许多查询，但它们都同样具有吸引力。也就是说，良好的起点，但还没有准备好生产。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-08-09T09:41:49.770

最近我的任务是记录一个相当大的数据库（大约 500 个对象），我在这里找到的细节确实很有帮助。

这里有一些关于我们如何实现它的反馈——希望有人会发现它很有用，即使它已经很晚了。

**技术：**

*   所有对象的扩展属性 +[第三方工具](http://www.apexsql.com/sql_tools_doc.aspx)生成文档

**记录的内容：**

*   所有表格和一些列（我们为所有表格添加了良好的描述，以确保清楚表格的内容）

*   所有视图 - 说明创建视图的原因、数据中包含哪些表等以及何时使用

*   所有存储过程——在处理过程中，我们发现我们有很多重复的存储过程（开发人员没有费心去查看 proc 是否存在，所以他们创建了新的）

*   所有 UDF 和其他一些对象也是如此，但不是全部（我们真的不需要记录触发器）

我们最终做的是让我们的 DBA 拒绝来自开发人员的所有 DDL 更新，除非有扩展属性。

我们还有一个计划任务，每 2 周自动重新创建文档。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T20:29:20.340

我们使用扩展属性。

要阅读它们，我们使用[sys.extended_properties](http://msdn.microsoft.com/en-us/library/ms186989(SQL.90).aspx) 它使事情变得容易得多。

我们也使用 Red Gate SQL Doc

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T14:45:43.920

[SchemaSpy](http://schemaspy.sourceforge.net/)是一个非常好的工具，可以对数据库的描述进行逆向工程。这包括：

*   ERD
*   表、列和约束的列表
*   关于数据库异常的一组警告（例如没有索引的表）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-29T14:14:47.377

我使用这个工具（开源）： http: [//www.codeplex.com/datadictionary](http://www.codeplex.com/datadictionary)。我创建的所有信息都添加到数据库的扩展属性中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T20:46:15.667

我从`INFORMATION_SCHEMA`视图和其他特定于应用程序的元数据表中生成它。

我还使用通配符搜索`INFORMATION_SCHEMA.ROUTINES`来跟踪代码中的使用模式并识别未使用的列和表。

这篇文章刚刚出现在我的一个新闻提要中：[http ://www.mssqltips.com/tip.asp?tip=1619](http://www.mssqltips.com/tip.asp?tip=1619)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T12:35:16.950

我们在应用程序的开发者端生成数据库的字典。我们有一个使用 ADODB 连接 + ADOX 对象和集合的好程序。此过程将浏览数据库中的所有表。收集到以下主要数据：

1.  表名
2.  列名
3.  列类型
4.  列大小
5.  bool_ColumnIsThePrimaryKey
6.  bool_ColumnHasReferentialIntegrityConstraint

您还可以跟进字段默认值等。

然后可以例如：

*   `currency_id`检查我的字段（表的主键 ）被引用了多少表 `Tbl_currency`，以及每次是否正确实现了引用完整性（我们经常在没有实现相应规则的情况下创建字段......）。
*   确保相似逻辑类型的字段（如“ `description`”字段）具有相似的数据类型/大小。`item_Description nvarchar(50)`没有什么比在一个表中有一个字段，而 在另一个表中有一个字段更令人沮丧的了`document_Description ntext`！
*   等等

通过该过程提取的所有数据都插入到本地表中（可以是 XML 文件或其他文件）并保存以供进一步使用。

可以从此数据生成列字典/报告

```
SELECT DISTINT columnName FROM Tbl_Column 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T18:35:37.847

我个人更喜欢在设计数据库时创建数据字典。当然，这并不总是一种选择......

我认为答案取决于数据库的当前状态？是否已完成并投入生产？你还没有开始吗？（ETC。）

过去，像 Cade Roux 一样，我将信息从 INFORMATION_SCHEMA 提取到访问数据库中。目前，我们有开发人员偶尔将有关不同表、列、存储过程、函数等的信息添加到 Access 数据库中。在 Access 数据库中，我们创建了报告以输出一个整洁的“数据字典”打印输出。

这不是完成创建数据字典的最有效方法，但鉴于该项目已经过去 3 年没有任何数据字典的迹象，这就是我们必须做的。

所以最终，这个问题的答案取决于你的数据库的状态。

最好的问候，
弗兰克

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-17T19:47:32.203

我们编写了自己的使用扩展属性的数据字典实用程序，但是当我们找到 Redgate 的工具时，我们放弃了它，取而代之的是他们的工具。为我们工作得很好！我想这有助于我们在扩展属性中已经有了字段和表描述。不是为公司做广告，但他们有 14 天的免费试用期。值得一看。 [http://www.red-gate.com/products/SQL_Doc/index.htm](http://www.red-gate.com/products/SQL_Doc/index.htm)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-05-01T06:26:57.663

我对[SQL Data Dictionary](http://www.sqldatadictionary.com/)很幸运。

# visual-studio - Visual Studio 2005 快速查找解决方案中缺少的搜索

> ID：281985
> 
> 赞同：1
> 
> 时间：2008-11-11T20:02:05.647
> 
> 标签：visual-studio, visual-studio-2005

如果我打开一个解决方案，然后按 CTRL + F 并选择快速查找，“查找范围”下拉列表没有“整个解决方案”选项（在文件中查找仍然有它）。

知道如何解决这个问题吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-11T20:09:43.477

根据对专家交流（.Net 专家回答的社区）的回复，VS2005 pre-SP1 中缺少该选项。安装 SP1，它应该在那里。

# vb.net - 如何使用 Range 对象读取 VB.net 中 word (*.doc) 文件中复选框的值？

> ID：281990
> 
> 赞同：5
> 
> 时间：2008-11-11T20:04:02.677
> 
> 标签：vb.net, ms-word, office-interop

如何使用范围对象在 VB.net 中的 word (*.doc) 文件中读取复选框的值？

这是我到目前为止所拥有的：

```
Dim app As New Word.Application
Dim doc As Document
doc = app.Documents.Open("C:\myDoc.doc")
dim chkBox as Bookmark
chkBox = doc.Bookmarks("MyCheckbox")
Dim rng as Range
rng = chkBox.Range 
```

其中“MyCheckbox”是word文档中复选框的书签。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T19:54:43.917

您没有使用复选框本身的名称读取复选框的值的任何特殊原因？

如果您的书签定义的范围包含一个复选框，则根据插入复选框的方式，它将在`InlineShapes`集合（如果复选框与文本内联插入）或`Shapes`集合（如果作为浮动对象插入）中找到。

然后，您需要遍历 Shapes 或 InlineShapes 的集合以查找相关复选框。

*遍历 InlineShapes 集合中的控件*

```
Dim ctl As InlineShape
For Each ctl In rng.InlineShapes
    If ctl.Type = wdInlineShapeOLEControlObject Then
        If ctl.OLEFormat.ClassType Like "Forms.CheckBox*" Then
            'current version of ctl is a checkbox, do what you will with it.

        End If
    End If
Next ctl
... 
```

这应该让你更接近，但如果复选框的名称是可预测的，最好直接通过名称来解决它。

# eclipse - 如何为eclipse添加更多语法元素

> ID：281992
> 
> 赞同：3
> 
> 时间：2008-11-11T20:04:38.777
> 
> 标签：eclipse, zend-studio

我试图`Zend Studio`为 Eclipse 添加更多语法元素。我想更改等号的颜色，但它没有列出，所以我可以更改它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T22:14:55.130

您可能想要投票给[http://bugs.eclipse.org/213992](http://bugs.eclipse.org/213992)，因为如果不将源代码更改为首选项页面，就无法做到这一点。

# c# - 富文本框 CtrlI

> ID：281997
> 
> 赞同：2
> 
> 时间：2008-11-11T20:05:48.073
> 
> 标签：c#, winforms, richtextbox

我在 .NET WinForms 中有一个 RichTextBox。我一直在用 KeyUp 连接热键。一切正常，除了 CtrlI。轮到我的处理程序时，选择已被替换为“\t”。我关闭了 ShortcutsEnabled，但没有任何区别。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T20:59:06.013

像这样做：

```
using System;
using System.Windows.Forms;

public class MyRtb : RichTextBox {
  protected override bool ProcessCmdKey(ref Message m, Keys keyData) {
    if (keyData == (Keys.I | Keys.Control)) {
      // Do your stuff
      return true;
    }
    return base.ProcessCmdKey(ref m, keyData);
  }
} 
```

# winforms - WinForms .NET 2.0：如何绘制适当大小的图标？

> ID：281999
> 
> 赞同：1
> 
> 时间：2008-11-11T20:08:10.500
> 
> 标签：winforms, graphics, windows-vista

我有一个包含 48x48 和 256x256 Vista PNG 版本（以及 32x32 和 16x16 版本）的 ico 文件。我想使用适当的内部尺寸版本绘制图标。

我试过了：

```
Icon ico = Properties.Resources.TestIcon;
e.Graphics.DrawIcon(ico, new Rectangle(0, 0, 48, 48));
e.Graphics.DrawIcon(ico, new Rectangle(48, 0, 256, 256)); 
```

但他们将 32x32 版本分别绘制为 48x48 和 256x256。

我试过了：

```
Icon ico = Properties.Resources.TestIcon;
e.Graphics.DrawIconUnstretched(ico, new Rectangle(0, 0, 48, 48));
e.Graphics.DrawIconUnstretched(ico, new Rectangle(48 0, 256, 256)); 
```

但是那些画出 32x32 版本的未拉伸。

我试过了：

```
Icon ico = Properties.Resources.TestIcon;
e.Graphics.DrawImage(ico.ToBitmap(), new Rectangle(0, 0, 48, 48));
e.Graphics.DrawImage(ico.ToBitmap(), new Rectangle(48, 0, 256, 256)); 
```

但是那些绘制了 32x32 图标的拉伸版本。

如何使图标使用适当的大小自行绘制？

此外，我想使用 16x16 版本进行绘制。我试过了：

```
Icon ico = Properties.Resources.TestIcon;
e.Graphics.DrawIcon(ico, new Rectangle(0, 0, 16, 16));
e.Graphics.DrawIconUnstretched(ico, new Rectangle(24, 0, 16, 16));
e.Graphics.DrawImage(ico.ToBitmap(), new Rectangle(48, 0, 16, 16)); 
```

但是所有这些都使用按比例缩小的 32x32 版本，除了`Unstretched`调用，它将其裁剪为 16x16。

如何使图标使用适当的大小自行绘制？

* * *

按照 schnaader 的建议，构建具有您需要的大小的图标副本不适用于 256x256 大小。即以下不起作用（它使用48x48图标的缩放版本）：

```
e.Graphics.DrawIcon(
        new Icon(ico, new Size(256, 256)), 
        new Rectangle(0, 0, 256, 256)); 
```

虽然以下两个确实有效：

```
e.Graphics.DrawIcon(
        new Icon(ico, new Size(16, 16)), 
        new Rectangle(0, 0, 16, 16));

e.Graphics.DrawIcon(
        new Icon(ico, new Size(48, 48)), 
        new Rectangle(0, 0, 48, 48)); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-22T11:22:53.707

今天，我做了一个非常好的函数，可以**从 Vista 图标中提取 256x256 位图**。

我用它在“关于”框中将大图标（**256x256 ）显示为位图。**例如，此代码将 Vista 图标获取为 PNG 图像，并将其显示在 256x256 的 PictureBox 中：

```
picboxAppLogo.Image = ExtractVistaIcon(Icon.ExtractAssociatedIcon(myIcon)); 
```

该函数将 Icon 对象作为参数。因此，您可以将它与任何图标一起使用——**来自资源**、来自文件、来自流等等。（阅读下面有关提取 EXE 图标的信息）。

它可以在**任何操作系统**上运行，因为它不**使用**任何 Win32 API，它是**100% 托管代码**:-)

```
// Based on: http://www.codeproject.com/KB/cs/IconExtractor.aspx
// And a hint from: http://www.codeproject.com/KB/cs/IconLib.aspx

Bitmap ExtractVistaIcon(Icon icoIcon)
{
    Bitmap bmpPngExtracted = null;
    try
    {
        byte[] srcBuf = null;
        using (System.IO.MemoryStream stream = new System.IO.MemoryStream())
            { icoIcon.Save(stream); srcBuf = stream.ToArray(); }
        const int SizeICONDIR = 6;
        const int SizeICONDIRENTRY = 16;
        int iCount = BitConverter.ToInt16(srcBuf, 4);
        for (int iIndex=0; iIndex<iCount; iIndex++)
        {
            int iWidth  = srcBuf[SizeICONDIR + SizeICONDIRENTRY * iIndex];
            int iHeight = srcBuf[SizeICONDIR + SizeICONDIRENTRY * iIndex + 1];
            int iBitCount   = BitConverter.ToInt16(srcBuf, SizeICONDIR + SizeICONDIRENTRY * iIndex + 6);
            if (iWidth == 0 && iHeight == 0 && iBitCount == 32)
            {
                int iImageSize   = BitConverter.ToInt32(srcBuf, SizeICONDIR + SizeICONDIRENTRY * iIndex + 8);
                int iImageOffset = BitConverter.ToInt32(srcBuf, SizeICONDIR + SizeICONDIRENTRY * iIndex + 12);
                System.IO.MemoryStream destStream = new System.IO.MemoryStream();
                System.IO.BinaryWriter writer = new System.IO.BinaryWriter(destStream);
                writer.Write(srcBuf, iImageOffset, iImageSize);
                destStream.Seek(0, System.IO.SeekOrigin.Begin);
                bmpPngExtracted = new Bitmap(destStream); // This is PNG! :)
                break;
            }
        }
    }
    catch { return null; }
    return bmpPngExtracted;
} 
```

**重要的！**如果您想直接从 EXE 文件加载此图标，则**不能**使用*Icon.ExtractAssociatedIcon(Application.ExecutablePath)*作为参数，因为 .NET 函数 ExtractAssociatedIcon() 太愚蠢了，它只能提取 32x32 图标！

[相反，您最好使用由 Tsuda Kageyu ( http://www.codeproject.com/KB/cs/IconExtractor.aspx](http://www.codeproject.com/KB/cs/IconExtractor.aspx) ) 创建的整个**IconExtractor**类。您可以稍微简化这个类，使其更小。以这种方式使用**IconExtractor**：

 **```
// Getting FILL icon set from EXE, and extracting 256x256 version for logo...
using (TKageyu.Utils.IconExtractor IconEx = new TKageyu.Utils.IconExtractor(Application.ExecutablePath))
{
    Icon icoAppIcon = IconEx.GetIcon(0); // Because standard System.Drawing.Icon.ExtractAssociatedIcon() returns ONLY 32x32.
    picboxAppLogo.Image = ExtractVistaIcon(icoAppIcon);
} 
```

注意：我在这里仍然使用我的 ExtractVistaIcon() 函数，因为我不喜欢**IconExtractor**处理这项工作的方式 - 首先，它使用 IconExtractor.SplitIcon(icoAppIcon) 提取所有图标格式，然后你必须知道确切的256x256 图标索引以获得所需的 vista-icon。所以，在这里使用我的 ExtractVistaIcon() 会更快更简单：)*************