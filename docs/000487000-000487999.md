# StackOverflow 问答 000487000-000487999

# algorithm - 如何检测产品搜索中的拼写错误并提出可能的更正建议？

> ID：487003
> 
> 赞同：8
> 
> 时间：2009-01-28T09:27:11.613
> 
> 标签：algorithm, validation, search, user-interface, data-entry

给定一个非常大的产品名称数据库，您将如何检测用户搜索中可能存在的拼写错误并提出可能的更正建议（有点像 Google 呈现它们的方式）？

例如

用户输入“fork handels”并按下“搜索”。

他们回来

“没有结果。你是说‘叉柄’吗？”

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-28T09:43:19.147

有几种方法可以解决这个问题：

1.  在数据库中保留一张**最常见的拼写错误表。**如果您需要一些常见的拼写错误：[这里](http://en.wikipedia.org/wiki/Wikipedia:Lists_of_common_misspellings/For_machines)）
2.  使用基于**[编辑距离](http://en.wikipedia.org/wiki/Edit_distance)**的算法：在信息论和计算机科学中，两个字符串之间的编辑距离是将其中一个字符串转换为另一个字符串所需的操作数。有几种不同的算法来定义或计算这个指标。例如，阅读有关[Levenshtein 算法的 Wikipedia 文章](http://en.wikipedia.org/wiki/Levenshtein_distance)。
3.  如果您使用 Lucene 进行全文搜索，[这里有一篇很好的文章](http://today.java.net/pub/a/today/2005/08/09/didyoumean.html?page=2)，它展示了如何实现“您的意思是”功能。
4.  如果您将该功能视为简单的拼写校正，这里有一些不错的、非常简短的几种语言实现：[如何编写拼写校正器](http://www.norvig.com/spell-correct.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T09:37:49.393

您可以使用[语音算法](http://en.wikipedia.org/wiki/Phonetic_algorithm)（例如[Soundex](http://en.wikipedia.org/wiki/Soundex)）来查找听起来相似的匹配项。

PostgreSQL 有一个名为[blurstrmatch](http://www.postgresql.org/docs/8.3/static/fuzzystrmatch.html)的模块，文档显示了使用 Soundex、Levenshtein、Metaphone 和 Double Metaphone 的示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T09:40:15.393

我确定我读过谷歌保留了用户在没有结果时重新键入的内容的列表。您可以保留这些值的映射（例如，如果重新键入的字符串以相同的字母开头）。

# .net - 在 TFS 2008 中使用 Watin？

> ID：487011
> 
> 赞同：3
> 
> 时间：2009-01-28T09:29:19.237
> 
> 标签：.net, testing, tfs, watin

我试图让我的 WATIN 测试在 TFS2008（持续集成）中作为夜间构建的一部分工作。

所有测试都在我的本地机器上运行良好（来自 VS2008），我的单元测试（非 watin）在本地以及 TFS 中运行良好。

为了说明我们在做什么，我做了一个简单的测试：

```
 [TestMethod]
    public void Watin()
    {
        //set up stuff

        browser.GoTo("http://localhost/");
    } 
```

在 TFS 中运行测试时，这会导致以下错误：

> 无法加载 TestTypes\37e36796-fb51-4610-8d5c-e00ceaa68b9f，因为由于以下原因无法实例化 TIP：System.IO.FileNotFoundException：**无法加载文件或程序集 'Microsoft.VisualStudio.QualityTools.Tips .WebLoadTest.Tip，Version=9.0.0.0，Culture=neutral，PublicKeyToken=b03f5f7f11d50a3a'**或其依赖项之一。该系统找不到指定的文件。文件名：'Microsoft.VisualStudio.QualityTools.Tips.WebLoadTest.Tip, Version=9.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' at System.RuntimeTypeHandle._GetTypeByName(String name, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMark& stackMark, Boolean loadTypeFromPartialName)

在网上搜索类似问题时，我被引导相信这是我们正在使用的 TFS 版本的问题 - 但我不确定。我们使用的是 TFS 2008 Developer Edition / VS2008 Developer Edition

我们尝试下载*TFS 套件*试用版，其中包含有问题的 DLL。我们已将 WebLoadTest.Tip 文件复制到 TFS 服务器的全局程序集缓存中（只是想看看这是否能解决问题）。这确实导致错误消失，但不幸的是它产生了一个新错误：

> MSBUILD：警告 MSB6006：“MSTest.exe”以代码 1 退出。

解决此问题的唯一方法是升级到套件版吗？这似乎有点严格。

任何帮助表示赞赏！

编辑： *我不明白的是它似乎需要 TFS 的 WebLoadTest 功能，即使我们没有明确调用它。相反，我们使用的是第三方框架 Watin。我认为 Watin 也没有任何 webloadtest 依赖项。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T10:17:47.783

众所周知，在构建服务器上获取正确的程序集和其他所有东西以进行 Team System 内容的自动构建是非常困难的。受支持的方法是在构建服务器上安装您需要的东西的副本，并获得运行它们的许可，前提是为源代码贡献这些东西的人拥有相关团队版本的许可（例如，如果您正在运行 Web 测试，那么您需要拥有测试 SKU 许可证）。

我对 Watin 了解不多，但从您的错误来看，您似乎正在使用 WebLoadTest 功能，它是测试 SKU 的一部分，因此您需要为此获得许可证。

您可以在构建服务器上安装开发人员版和测试版，如果您拥有适当的许可证，它将构成开发+测试组合。或者，如果您有许可证，您可以安装套件。

如果您的组织中没有套件许可证，我会犹豫是否安装 Team Suite 试用版，因为这意味着您可能会解决问题并且您会启动并运行，但会在 90 天后发现（当您的试用期到期）您需要完整套件的许可副本才能继续运行您在过去 90 天内编写的所有测试...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T05:16:48.973

WatiN 对 'Microsoft.VisualStudio.QualityTools.Tips.WebLoadTest.Tip 根本没有任何依赖关系..

您需要做的就是创建一个测试项目，然后向其中添加一个单元测试，对 watin.core.dll、mshtml.dll 和 SHDocVw.dll 的引用我认为在某些时候您已经添加了一个 VS Web 测试到解决方案，它现在有对这些程序集的引用。

尝试使用新的空测试解决方案，看看效果如何。

# javascript - JavaScript 库还是原始编码？

> ID：487015
> 
> 赞同：2
> 
> 时间：2009-01-28T09:32:27.530
> 
> 标签：javascript, jquery

我目前使用原型库来处理 ajax 请求。我已经在堆栈溢出问题上待了一周左右，并且看到了很多 jQuery 问题。似乎大多数人选择使用该库来处理编程的 javascript 部分。除了 ajax 部分，我网站上的其余 javascript 部分都是用我自己编写的代码开发的。

我想知道继续编写自己的javascript代码是否更有用，还是我应该花时间学习JQuery库并使用它的功能来节省自己的时间？我在想，通过编写自己的代码，它会让我更加了解跨浏览器问题，并增加我对 javascript 的理解。另一方面，如果我只是使用库而不处理这些问题，那么学习它们就没有意义了。只是有点困惑，想听听别人的意见。其他人选择做什么，为什么？您对 JavaScript 库的依赖程度如何？如果您可以做出假设的猜测，如果您没有使用图书馆的选项，您还需要花费多少时间？

我不做任何商业工作。我只在我的个人网站上工作。（我的函数集合，如果它有助于回答我的问题：[http](http://hsbsitez.com/js/hsb_functions.js) ://hsbsitez.com/js/hsb_functions.js ）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T09:36:13.983

这里的人们会根据“不要重新发明轮子”的逻辑来推荐 jQuery 或其他 JavaScript 库。但是，如果您正在制作个人网站，*有时*亲自使用 JavaScript 会很有趣。也许提醒自己，如果您关心跨浏览器问题，并且对不同浏览器的错误修复感到厌烦，那么 jQuery（和其他类似框架）确实存在。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T09:38:12.653

好吧，如果您喜欢编写 javascript，并且喜欢解决各种跨浏览器问题的挑战，那么请坚持您正在做的事情。如果 javascript 只是使您能够完成更大工作的辅助工具，那么依靠已经为您解决了很多麻烦的库/框架具有巨大的价值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T10:23:26.163

为什么要重新发明轮子？好吧，如果你不知道轮子是如何工作的，那么当轮子坏了时，你就无法修复轮子，或者完全制造更好的轮子——jQuery 是一个非常有用的工具，但永远不要让它成为拐杖，原始 JS 是唯一的学习方法。(1)

fwiw，我相信您的个人网站是学习的理想机会。

哦，而且（显然很愚蠢）这完全取决于域。

对于一个小的本地化问题，加载一个库是一件不必要的昂贵的事情。对于大量的普遍问题，解决该问题的唯一有效方法，更不用说管理它的唯一明智方法是使用代码库 - 如果它存在/足够好/很好理解，jQuery 可能是基于其他/未来开发人员熟悉的最佳第三方库。

*1\. 这实际上是有争议的，但我的直觉说 JS -> jQuery 会很有意义，但反过来就不行。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T10:38:38.910

每个使用 JavaScript 的人都应该自己完成它。如果只是为了体验，有些事情是多么困难。

But for professional use, I’d definitively recommend a JavaScript framework.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T09:38:56.223

jQuery 不是您所有问题的答案。与许多其他框架/ api 等一样，您想做一些事情，但它们只是没有实现，或者它们不适合框架/ api。

那么，为什么要学习 jQuery？好吧，我的朋友很容易；你为什么要重新发明轮子（除了学习目的？）？

*   **尽可能使用 jQuery**

*   **需要时使用自己开发的 JS**

了解框架和 API 的概念并知道如何自己开发它从来都不是坏事。但是，如果您想要提高效率，请尽可能多地使用 jQuery。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T10:07:29.177

作为一个刚刚从多年的桌面和后端开发进入网络编程的人，我发现 jQuery 是一个巨大的帮助。让 jQuery 处理浏览器的不一致让我少担心一件事。

正如 Scott Hanselman 最近[发布](http://www.hanselman.com/blog/PainfulReminderFocusOnCoreCompetenciesAndBackStuffUp.aspx)的那样，坚持自己的核心能力并处理非标准的浏览器不是我的职责之一。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T11:36:33.600

The ideal solution would be to use a framework like jQuery but to have a deep understanding of how it works. So when you do something seemingly basic with jQuery make sure to have a look behind the curtain to see what's really going on. I've learnt so much just from looking through the jQuery source code!

The first thing people will rave about is the cross-browser peace-of-mind that you get with jQuery - and everyone keeps on saying it's a massive minefield so we should leave it to the experts! It's really not that complicated - just have a look through the source code and you'll see (fortunately the jQuery team have been diligent enough to comment important snippets): [http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.js](http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.js)

# uml - UML 最先进的技术

> ID：487020
> 
> 赞同：4
> 
> 时间：2009-01-28T09:35:14.717
> 
> 标签：uml

我是 UML 的粉丝，并使用 Fowlers [UML 精粹](http://www.amazon.co.uk/UML-Distilled-Standard-Addison-Wesley-Technology/dp/0321193687 "UML 蒸馏")书作为参考。

我的问题是：在 UML 中有什么进展，目前的“最先进技术”是什么。是否有更好的现代 UML 参考书，或者上面仍然是一个很好的参考书。

我对“提议的延期”和委员会正在考虑的事情不太感兴趣；真的，我正在寻找从业者实际使用的东西，类似于 Fowler 书中的内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T10:04:49.040

对 2.0 版的工具支持很好，练习就是使用它们，所以如果你有第三版，那么你就有了很好的介绍。

“最先进的技术”取决于您在哪个领域工作。

对于一直使用 DOORS 的公司，UML 工具（Sparx Systems Enterprise Architect）包括需求支持并与 DOORS 数据库集成。这种支持广泛用于大型项目。需求概念来自 SysML 扩展，但您无需了解 SysML 即可使用它们。

嵌入式系统还使用 UML 工具，从动作语义生成完整的代码——动作定义了方法的作用。此类工具生成完整代码，而不仅仅是 EA 价格点的工具生成的方法概述。如果您想查看此类工具，Artisan 现在有一个免费的单用户版本可供下载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-21T11:26:30.630

我会说 UML 在过去几年中并没有太大变化。对我来说，软件建模领域更相关的变化是领域特定建模语言的演变，在许多情况下，它已经取代了 UML 配置文件，作为使 UML 适应您的特定需求的一种方式（当适应很简单时） .

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-21T02:44:14.097

如果您真的对最先进的技术感兴趣，那么在概念建模方面正在进行大量研究。UML 只是一种产品，建模远不止 UML。我不确定您是只对 UML 还是对一般的 OO 建模感兴趣。让我知道; 如果是后者，我可以提供更多信息。

# sql-server - SQL Server 2000/5 - 获取活动或非活动数据库列表的脚本（系统数据库除外）

> ID：487024
> 
> 赞同：0
> 
> 时间：2009-01-28T09:36:56.257
> 
> 标签：sql-server

我需要帮助编写 SQL 2005 服务器上的所有数据库并可能查看它们的活动（特别是上次活动的日期）。我需要删除服务器上所有不活动的数据库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T11:21:34.177

最好的方法是在您的服务器上运行一个非常轻量级的分析器跟踪并仅记录“审核登录”事件。让它运行一周/一个月/无论如何，然后查看您的跟踪日志以查看当前正在使用哪些数据库。如果您运行查询，那么您只会看到**当前**正在使用的数据库，而不是上周/月内使用的数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T17:43:19.193

这里有一个技巧：使用 SQL Server 动态管理视图来获取有关已使用哪些索引的数据。

此查询将为您提供每个数据库中最近使用的索引。如果未使用索引，则可能也未使用数据。

```
SELECT db.[name] AS DatabaseName
, (SELECT TOP 1 last_user_seek FROM sys.dm_db_index_usage_stats ix1 WHERE ix1.database_id = db.database_id ORDER BY last_user_seek DESC) AS last_user_seek
, (SELECT TOP 1 last_user_scan FROM sys.dm_db_index_usage_stats ix1 WHERE ix1.database_id = db.database_id ORDER BY last_user_scan DESC) AS last_user_scan
, (SELECT TOP 1 last_user_lookup FROM sys.dm_db_index_usage_stats ix1 WHERE ix1.database_id = db.database_id ORDER BY last_user_lookup DESC) AS last_user_lookup
, (SELECT TOP 1 last_user_update FROM sys.dm_db_index_usage_stats ix1 WHERE ix1.database_id = db.database_id ORDER BY last_user_update DESC) AS last_user_update
FROM sys.databases db
ORDER BY db.[name] 
```

一个警告：如果您设置了维护计划以定期自动重新索引您的数据库，或者第三方碎片整理程序，那么这些日期可能是人为的最近的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T10:10:27.593

你可以从

```
select  name from sysdatabases
where sid <> 0x01 
```

然后对返回的每个数据库名称执行[sp_helpdb](http://msdn.microsoft.com/en-us/library/ms178568.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T18:02:24.303

对活动数据库的查询可以细化如下

```
SELECT  name
FROM    master..sysdatabases
WHERE   DATABASEPROPERTY(name, 'IsOffline') = 0 
AND     DATABASEPROPERTY(name, 'IsReadOnly') = 0
AND     DATABASEPROPERTY(name, 'IsDetached') = 0
AND     DATALENGTH(sid) > 1
ORDER BY name 
```

# asp.net - 图像缩略图 ASP.NET

> ID：487032
> 
> 赞同：1
> 
> 时间：2009-01-28T09:39:50.120
> 
> 标签：asp.net, image-processing, thumbnails

我正在尝试从存储在网站根目录下的文件夹中的图像文件生成缩略图，我目前正在使用 .NET 中的内置 capebilites 动态生成缩略图，但质量变得非常糟糕，因为它是一个网上商店，这是一个真正的问题我的问题是，是否有任何好的（开源？）框架可以帮助我处理图像缩略图的创建和调整以及在上传过程中压缩图像文件大小的可能帮助？

我已经看过但还没有找到？

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T09:47:24.270

我写了一些你可以使用的代码。请不要卖掉它；）

这是代码：

```
/*
 *  Software Developed by Filip Ekberg ( Filip@SmartIT.se )
 * 
 *  For Questions regarding this software, please send me an E-mail
 * 
 */

#region Usings
using System;
using System.Collections.Generic;
using System.Text;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Drawing.Imaging;
#endregion

namespace ImageResizer
{
    class ImageProcessor
    {
        #region Members
        private int m_imgWidht,
                    m_imgHeight,
                    m_oImgWidht,
                    m_oImgHeight;

        private float m_vertRes,
                      m_horiRes;

        private double m_size = 0.25;

        private Bitmap m_Bitmap;
        private Graphics m_Graphics;
        private Image m_currentImage;

        private PixelFormat m_pxlFormat = PixelFormat.Format32bppRgb;
        private InterpolationMode m_interpolationMode = InterpolationMode.HighQualityBilinear;
        private CompositingQuality m_compositingQuality = CompositingQuality.HighQuality;
        private SmoothingMode m_smoothingMode = SmoothingMode.None;
        #endregion

        #region Access Methods

        public int ImageWidth 
        {
            get { return m_imgWidht; }
        }
        public int ImageHeight 
       {
            get { return m_imgHeight; }
        }
        public float VerticalResolution
        {
            get { return m_vertRes; }
            set { m_vertRes = value; }
        }
        public float HorizonalResolution
        {
            get { return m_horiRes; }
            set { m_horiRes = value; }
        }

        /// <summary>
        /// Use ImageSize struct for setting this.
        /// </summary>
        public double Size
        {
            get { return m_size; }
            set { m_size = value; }
        }
        public Image ProcessImage
        {
            get { return m_currentImage; }
            set { m_currentImage = value; }
        }
        public PixelFormat ImagePixelFormat 
        {
            get { return m_pxlFormat; }
            set { m_pxlFormat = value; }
        }
        public InterpolationMode ImageInterpolationMode
        {
            get { return m_interpolationMode; }
            set { m_interpolationMode = value; }
        }
        public CompositingQuality ImageCompositingQuality
        {
            get { return m_compositingQuality; }
            set { m_compositingQuality = value; }
        }
        public SmoothingMode ImageSmoothingMode
        {
            get { return m_smoothingMode; }
            set { m_smoothingMode = value; }
        }

        #endregion

        #region Process Image
        public Bitmap BeginProcess()
        {
            if ( m_currentImage == null )
                return null;

            m_oImgWidht = m_currentImage.Width;
            m_oImgHeight = m_currentImage.Height;

            m_vertRes = m_currentImage.VerticalResolution;
            m_horiRes = m_currentImage.HorizontalResolution;

            m_imgWidht = (int)(m_oImgWidht * (double)m_size);
            m_imgHeight = (int)(m_oImgHeight * (double)m_size);

            m_Bitmap = new Bitmap(m_imgWidht, m_imgHeight, m_pxlFormat);

            m_Bitmap.SetResolution(m_vertRes, m_horiRes);

            m_Graphics = Graphics.FromImage(m_Bitmap);

            m_Graphics.InterpolationMode = m_interpolationMode;

            m_Graphics.CompositingQuality = m_compositingQuality;

            m_Graphics.SmoothingMode = m_smoothingMode;

            // m_Graphics.DrawImage(m_currentImage, new Rectangle(0, 0, m_imgWidht, m_imgHeight), new Rectangle(0, 0, m_oImgWidht, m_oImgHeight), GraphicsUnit.Pixel);

            Rectangle rectDestination = new Rectangle(0, 0, m_imgWidht, m_imgHeight);
           // m_Graphics.DrawImage(m_currentImage,
           //     new Rectangle(-1, -1, m_oImgWidht + 2, m_oImgHeight + 2),
            //    new Rectangle(m_oImgWidht, m_oImgHeight, m_imgWidht, m_oImgHeight),
            //    GraphicsUnit.Pixel);
            ImageAttributes ia = new ImageAttributes();
            ia.SetWrapMode(WrapMode.TileFlipXY);
            m_Graphics.DrawImage(m_currentImage, rectDestination, 0, 0, m_oImgWidht, m_oImgHeight, GraphicsUnit.Pixel, ia); 

            // m_Graphics.Dispose();

            return m_Bitmap;
        }
        #endregion
    }
} 
```

这是您可以使用它的方式：

```
private ImageProcessor m_processor = new ImageProcessor();

m_currentImage = new Bitmap(currentFile.FullName);

                // Display a Thumbnail of it
                pictureBox1.Image = m_currentImage.GetThumbnailImage(pictureBox1.Width, pictureBox1.Height, null, IntPtr.Zero);

                // Update the Label with Filename and what file is currently processed
                delegate_lblControl(currentFile.Name + "\n" + m_currentProcessedImage + " / " + m_fileList.Length);

                // Increase the value on the ProcessBar
                delegate_imageProcessValue(1);

                // Process the Image
                m_processor.ProcessImage = m_currentImage;

                m_processor.Size = m_size;

                m_finalProcessedImage = m_processor.BeginProcess();

                ImageCodecInfo jgpEncoder = GetEncoder(ImageFormat.Jpeg);
                System.Drawing.Imaging.Encoder myEncoder =
                    System.Drawing.Imaging.Encoder.Quality;

                EncoderParameters myEncoderParameters = new EncoderParameters(1);
                EncoderParameter myEncoderParameter = new EncoderParameter(myEncoder, m_jpegQuality);
                myEncoderParameters.Param[0] = myEncoderParameter;

                // Save the Image to the Output folder
                m_finalProcessedImage.Save(fldOutput.SelectedPath + "\\" + currentFile.Name, jgpEncoder, myEncoderParameters);

                // Dispose the Images
                m_finalProcessedImage.Dispose();

                m_currentImage.Dispose(); 
```

我编写的代码实际上可以做的是将图像大小调整为特定百分比。

# c++ - 如何将 64 位长数据类型转换为 16 位数据类型

> ID：487035
> 
> 赞同：0
> 
> 时间：2009-01-28T09:42:20.193
> 
> 标签：c++, c, timestamp

我想知道如何将`64 bit long`数据类型转换为任何`16 bit`数据类型。**以太网应用程序**需要此功能才能包含**时间戳**。只有**2 个字节**（**16 位**）可用于包含**时间戳**。但是我们从 中获取`64 bit long`时间戳值`Win API`。所以从 64 位数据类型到 16 位数据类型的转换是必不可少的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-28T09:46:22.870

嗯，你不能在不丢失一些信息的情况下将 64 位信息放入 16 位存储中。

因此，如何量化或截断时间戳取决于您。例如，假设您获得了纳秒精度的时间戳，但您只需要以秒精度存储它。在这种情况下，您将 64 位数除以 1000000000，剩下的就是秒数。然后它可能适合 16 位或不适合（16 位最多只能存储 65535 秒）。

如果它不适合，那么您将定期环绕时间戳。同样，这可能是您的问题，也可能不是问题。

在任何情况下，如果您需要连接需要时间戳的现有库 - 找出*它*在该时间戳中需要什么（时钟滴答声？秒？年？）。然后找出您正在使用的 Windows 时间函数返回什么。然后将 Windows 时间单位转换为您使用的库时间单位。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T10:15:49.847

16 位可能不够，也可能不够，这取决于您需要时间戳的用途。对于大多数用途来说，它太小或至少不方便。但是这可能会起作用的一些示例可能是：超时，测量数据包的往返时间，粗略测量时间间隔（这可能适用于向用户显示时间信息）等等。

另一方面，它可能对重新排序数据包没用。如果是这种情况，我建议您用序列计数器替换时间戳。根据流中数据包的典型数量，您甚至可以减少一些位并将它们用于其他目的，因为序列计数器可以更轻松地处理包装。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T18:53:52.187

正如其他人所说，第一个问题是决定正确的缩放比例。你必须平衡你的分辨率和你想要的最大范围。考虑它的一种方法是确定您想要的每比特多少秒。每比特 1 秒，您可以表示从 1 秒到 65536 秒或约 1000 分钟的值。每比特 1 毫秒可让您从 0.001 秒提高到 65.5 秒

这是进行转换的一种方法。

```
#define seconds_per_bit   .0001  <--YOUR VALUE HERE.
#define bits_per_second   (1/seconds_per_bit);  
int16 timestamp()
{
  Int64 counts_per_second,counts;

  QueryPerformanceFrequency(&counts_per_sec);
  QueryPerformanceCounter(&counts);  
  return (UInt16)(counts * bits_per_second / counts_per_second);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T19:06:21.990

这完全取决于您使用时间戳的目的。你提到了以太网，所以我可以想象的一个明显的用途是订购数据包。在这种情况下，您真正​​需要的只是一个计数器。而不是你的时间戳说“这个数据包是在 5 月 14 日下午 14:35 发送的”，它可以简单地说“这是第 4023 个数据包”。

如果你需要它来记录实际的时钟时间，你只需要选择它的哪些部分是相关的。16 位给你 65536 个值来玩。你想让那些代表秒吗？然后您的时间戳将每 18 小时循环一次。

或者他们可以是分钟。然后在他们结束之前将是 45 天。或几天，或微秒，这一切都取决于你需要什么。

但是，将 64 位值转换为 16 位值的唯一方法是删除 48 位数据。你选择哪些

# c# - Compact Framework - 在加载期间禁用鼠标事件

> ID：487036
> 
> 赞同：2
> 
> 时间：2009-01-28T09:42:49.960
> 
> 标签：c#, windows-mobile, compact-framework, .net-2.0

大家早，

我设计了许多紧凑的框架应用程序，而我一直不明白的是一种防止我们所说的约克郡银行综合症 (ybs) 的方法。YBS 以约克郡银行的现金点命名，因为他们的屏幕刷新速度非常慢，我的一位同事按了两次按钮，以为他没有按下按钮，最终提取了 100 英镑而不是他想要的 20 英镑（“没有收据的现金”和“100 英镑”按钮被分配给两个不同屏幕上的同一个按钮）。

基本上，我在应用程序开始时使用初始屏幕加载所有表单，并且每个其他表单都有一个名为 Initialise() 的公共事件。为了显示一个表单，我使用了 Session.Instances.FormName.Initialise() 然后执行 showdialog()。

Initialise() 方法通常会调用某种形式的表单重置或数据加载，因此在该方法中也设置了 Cursor。当用户单击按钮以显示表单时会出现问题，该表单会加载，但如果他们同时单击屏幕，则该屏幕单击会传递到当前正在加载的表单（但未显示）。

例如，我单击一个按钮以显示一个表单，然后单击屏幕的左下角。在我的大多数 CF 应用程序中，右下角的按钮是设置 DialogResult.Cancel 的后退按钮。因此，一旦加载完成，表单就不会出现，因为单击了后退按钮，即使表单从未显示过。

我已经尝试了很多东西，包括在 Initialise() 开始时的 this.Enabled = false，但似乎单击存储在后台，然后在加载完成时将单击事件触发到屏幕上。

所以，我现在想知道是否有办法在我的加载过程中禁止任何鼠标输入，并且只在我的 Form.ShowDialog() 之前再次启用它？或者是否有人对如何实现这一目标有更好的想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T10:51:07.200

Chris Tacke 创建了 ApplicationEx 作为[OpenNETCF](http://www.opennetcf.com/)的一部分。它允许获取您的应用收到的每条 Windows 消息。

[这里](http://blog.opennetcf.com/ayakhnin/PermaLink,guid,9a05b2dc-c79f-4cd8-af17-aa485fada5c7.aspx)有一个使用示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T20:52:39.203

我年轻时部署的一种粗略方法是设置一个计时器，以便在加载后将事件连接到表单上的 ui 元素。在那种情况下，这完成了工作。

这些天来，我没有遇到太多问题，尤其是在我预加载表格的情况下。也许问题在于在显示表单时在 UI 线程上执行某种形式的长数据操作？

如果您想进入“黑客”领域，您总是可以尝试在某处启动 Application.DoEvents() 以尝试清除缓冲区。

# wcf - 在 Biztalk WCF 适配器中启用流式传输

> ID：487043
> 
> 赞同：3
> 
> 时间：2009-01-28T09:48:10.730
> 
> 标签：wcf, streaming, biztalk

我想从 biztalk 发送一个带有一些元数据的大 blob 到 WCF 服务。

我可以自由控制服务设置和 biztalk 设置，但我必须使用 http 才能访问服务。

blob 很可能在千兆字节范围内，因此带有 BasicHttp 或 WSHttp 的普通 WCF BizTalk 适配器是没有问题的，因为它将消息内容序列化为 XML。

我当前的方案是将元数据作为 XML 放入 biztalk 多部分消息的第一部分，并将有效负载放入第二部分。

要调用该服务，我将准备一个 WCF MessageContract 将元数据放入消息标头并将有效负载放入正文。我还将客户端和服务器端都设置为“流式传输”传输模式。

此方案适用于“普通”WCF 客户端，但如何配置 Biztalk WCF 适配器以执行相同操作，而无需将整个有效负载放入内存？

它当然可以用一个自写的适配器来完成，但我想知道是否有办法用 WCF 自定义适配器加上一两个行为来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T10:14:12.490

不是一个完整的答案我很害怕 - 从来没有机会看这个，但是 - 如果你还没有看过这个，看看 WCF 适配器包中的 OracleDB 适配器。它的文档表明它支持流式传输（我已阅读 [Streaming and the Oracle Database Adapter](http://msdn.microsoft.com/en-us/library/cc185424.aspx) and [WCF LOB Adapter SDK and BizTalk Adapter Pack](http://blogs.msdn.com/adapters/archive/2007/10/26/streaming-in-oracledb-adapter.aspx)）而且我相信这是基于开箱即用的 WCF 适配器，这可能指向正确方向。

基本上，如果 WCF 适配器代码支持流式传输，您可能需要使用 WCF-Custom 适配器并自己提供正确的配置（通过使用提供的 UI 或通过从配置文件导入配置，这对于复杂的配置有时更容易)

对不起，相当“通用”的回应，我希望它有所帮助

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-15T18:35:57.400

BizTalk 中的 WCF 适配器支持开箱即用的流式传输。但是，您必须使用 WCF-Custom 来启用它。请参阅[此博客文章](http://blogs.msdn.com/b/paolos/archive/2010/05/25/large-message-transfer-with-wcf-adapters-part-1.aspx)了解更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T10:45:10.757

你有 Biztalk 2006 吗？因为以前版本的 BizTalk 文档映射总是发生在内存中。

# design-by-contract - 不可为空的对象有什么问题？

> ID：487046
> 
> 赞同：3
> 
> 时间：2009-01-28T09:49:38.963
> 
> 标签：design-by-contract, non-nullable, spec#

我最近一直在研究 DbC 和 Spec#，它们似乎支持不可为空的对象。不幸的是，Spec# 似乎已被放弃。

1.  Spec# 似乎内置了很多不错的语言特性，为什么它被放弃了？
2.  默认情况下让所有对象都不可为空会有什么问题，所以你必须写 int?, string？甚至MailMessage？如果你真的想要一个可为空的对象？
3.  我在这里看到了一种 Sql 类比，您可以将类属性检查为可空或不可空。您甚至可以像使用 sql 表列那样对属性施加约束吗？

我没有看到将此类功能内置到语言中的问题。有人可以启发我吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-28T09:52:37.380

您是否看到新的[Contracts 框架](http://research.microsoft.com/en-us/projects/contracts/)将成为 .NET 4.0 的一部分？

使其成为库而不是语言功能的好处是，它可以立即以所有语言提供，而无需语言团队进行任何工作。显然也有缺点...

链接：

*   [BCL 团队博客文章](http://blogs.msdn.com/bclteam/archive/2008/11/11/introduction-to-code-contracts-melitta-andersen.aspx)
*   [还有一个](http://blogs.msdn.com/bclteam/archive/2008/11/04/what-s-new-in-the-bcl-in-net-4-0-justin-van-patten.aspx)
*   [PDC 2008 视频](http://channel9.msdn.com/pdc2008/TL51/)

说了这么多，我希望能够写：

```
public Stream! Foo(string! x) 
```

同样，表明 Foo 不能接收空引用，也不会返回一个。我认为，为这种类型的合约添加一些额外的语法会*很方便。*

# c++ - C++ 中 const 声明的区别

> ID：487048
> 
> 赞同：9
> 
> 时间：2009-01-28T09:50:35.967
> 
> 标签：c++, syntax, pointers, constants, parameters

和有什么区别

```
void func(const Class *myClass) 
```

和

```
void func(Class *const myClass) 
```

* * *

也可以看看：

*   [C++ 常量问题](https://stackoverflow.com/questions/269882/c-const-question)
*   [C++ 中“const”的用途有多少？](https://stackoverflow.com/questions/455518/how-many-and-which-are-the-uses-of-const-in-c)

可能还有其他人......

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-28T09:56:23.643

不同之处在于，对于

```
void func(const Class *myClass) 
```

您指向一个无法更改的类，因为它是 const。但是您可以修改 myClass 指针（让它指向另一个类；这对调用者没有任何副作用，因为它的指针被复制，它只会更改您本地的指针副本）相比之下

```
void func(Class *const myClass) 
```

现在 myClass 指向一个可以修改而不能更改参数的类。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-28T09:57:12.443

在第一个中，您声明了一个函数，该函数接受指向常量 Class 对象的指针。您不能修改函数内的对象。在第二个中，您要声明一个函数，该函数接受一个指向非常量 Class 对象的常量指针。可以通过指针修改对象，但不能修改指针值本身。

**我始终牢记这条简单的规则：`const`总是适用于它最左边的东西，如果这个东西不存在，它适用于最右边的东西。**

也看看我一周前问的[这个](https://stackoverflow.com/questions/455518/how-many-and-which-are-the-uses-of-const-in-c)问题，它指向一些非常有用的链接来理解 const 的正确性。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-28T10:06:46.680

一个经验法则是从右到左阅读声明：

`void func(const Class *myClass)`是一个指向 const 类的指针（或者严格来说“指向一个 const 类的指针”）

`void func(Class *const myClass)`是一个指向 Class 的 const 指针

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-28T10:11:33.287

诀窍是向后阅读这些内容：

`void func(const Class *myClass)`

读取“myClass 是指向 const 类的指针”，这意味着我无法在 Class 中进行更改

`void func(Class *const myClass)`

读取“myClass 是指向类的 const 指针”，这意味着我无法更改指针。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-28T10:50:47.717

```
void func(const Class *myClass) { //... 
```

如其他答案中所述，此定义意味着参数`myClass`指向的实例`Class`可能不会被函数修改（`mutable`和`const_cast`除外）。但是，`myClass`函数体中的变量可以更改为指向`Class`. 这是函数的实现细节。

```
void func(Class *const myClass) { // ... 
```

另一方面，此定义意味着`myClass`参数是指向`Class`非 const 实例的指针，因此函数可以使用它来完全操作类实例，但`myClass`指针变量本身不能更改为指向函数体。

其他答案未提出的重要一点是，对于函数签名，在考虑函数类型时，任何顶级 const 或 volatile 限定都将被忽略。这是因为参数总是按值传递的，所以是否为 const 只影响参数本身是否可以在函数体中改变，而不能影响调用者。

因此这两个函数声明是等价的。

```
void func(Class *const myClass);

void func(Class *myClass); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T10:02:51.027

在 C++ 这个

```
const MyClass *ptr 
```

还有这个

```
MyClass const *ptr 
```

两者都意味着这`ptr`是一个指向类型*常量*对象的*变量*指针。也就是说，您不能通过. 但是，您可以使自己指向.*`MyClass``ptr``ptr``MyClass`*

 *相比之下，这

```
MyClass *const ptr 
```

暗示`ptr`是一个指向*变量*对象的*常量指针。*在这里，您确实可以更改 ptr 指向的对象，但不能指向其他对象。 *`MyClass``ptr`*

 *注意，在上述三种语法中，第二种有点奇怪，但它是有效的语法。它不遵循这里其他人建议的从左到右的阅读规则。但是，这就是你的 C++ 生活。

# php - 将系统从某种类系统迁移到 MVC 格式

> ID：487052
> 
> 赞同：1
> 
> 时间：2009-01-28T09:54:47.907
> 
> 标签：php, model-view-controller, data-structures, transitions

我正在开发一个由另一个不再在这里工作的程序员开发的相当大的系统。

而且因为我是一个狂躁的连环杀手，他正在维护它并且知道他住在哪里。

但除了有趣的事情之外，该系统有点像一个类系统开发，有点不是，我已经设置了一个开发者版本并且可以很快地部署新版本。

1.  您有关于部分迁移到新模型的任何提示（我无法进行完全转换，只是没有时间）
2.  你推荐我可以留在系统中的任何类名（看起来不像黑客）但不会与当前类名（用户、数据、日志记录等）冲突

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T15:09:55.540

提示 #0) 现有代码真的真的很糟糕，还是不符合您的个人喜好？如果是前者，请继续阅读此列表。如果是后者，做几次深呼吸，至少花一两个月的时间了解事情，然后再决定是否需要重新做。

提示 #1) 在编码时，如果发现不正确的地方，请修复它。这将花费更长的时间，但随着系统变得更加“固定”，它最终会给您带来生产力提升。如果您真的没有时间修复它，请帮自己一个忙并添加如下评论： //TODO: rejig thing so it does x 稍后，当您有时间时，只需在您的代码中搜索“TODO:”即可获取您需要做的事情的清单。你也可以给他们一些等级，比如“TODO-High”、“TODO-Medium”、“TODO-Low”。如果您使用 Eclipse 或 Zend Studio for Eclipse 作为您的编辑器/IDE，您可以在 Preferences->Tasks 中将其设置为自动查找和标记这些内容。

提示 #2) 如果您希望（最终）过渡到 MVC，要做的一件重要事情是将 HTML 从逻辑中分离出来。这意味着使用模板。这项任务可能需要很长时间，但一旦完成，您的其余过渡会容易得多。

提示#3) 尝试建立约定。示例：控制器和视图名称必须与 URL 对应，并且位于与 URL 对应的目录中。编辑地点 1234 的 URL：/places/edit/1234 控制器文件：/htdocs/sitename/controllers/placesController.php 模板文件：/htdocs/sitename/views/places/edit.tpl

提示 #4) 阅读主要框架的“入门”教程：Zend、CakePHP、CodeIgniter/Kohana、Symfony。看看一个在你看来是否比另一个更好。问问自己为什么喜欢它。它对您有用吗，还是您需要推出自己的框架（值得怀疑）。如果可能，请使用现有框架。它已经过数百或数千人的错误测试，您可以节省时间！我自己喜欢 Zend Framework，它对像你这样的“过渡项目”特别有用，因为你可以一次接受或留下它。我的意思是，你可以选择只使用 Zend 的 View 对象，或者只使用它的 DbTable 对象。您可以随意省略它。这意味着您可以按照自己的节奏逐渐过渡到 Zend 世界。EZ-Components 的工作方式相同。

提示 #5) 通过扩展它们来包装你使用的类。例如，我使用 Zend_Acl，但实际上使用的是我自己的扩展 Zend_Acl 的 Acl 类。这有两个关键含义：a) 我可以在不更改代码的情况下将 Zend_Acl 换成其他东西，因为它都指的是普通的旧 'Acl' b) 我可以修改 Zend_Acl 的工作方式以满足我的特定需求，因为我可以覆盖任何方法我喜欢我的“Acl”课程。

提示＃6）尝试获得管理层的支持。向他们解释重构实际上会为他们省钱，因为它会提高代码的一致性和可理解性，这有助于减少缺陷的数量，并使它们更容易被发现和修复。

提示 #7) 尝试阅读有关该主题的书籍，例如 Martin Fowler 的“重构：改进现有代码的设计”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T13:43:34.153

zend 有很好的命名约定： http: [//framework.zend.com/manual/en/coding-standard.naming-conventions.html](http://framework.zend.com/manual/en/coding-standard.naming-conventions.html)

他们为所有的类添加了 Zend_ 前缀，这就是他们避免与第三方类发生冲突的方式。

在我看来，每个大型项目都应该实现类似的命名约定，至少对于核心类是这样。

# jquery - 使用 jQuery 检索 Button 值

> ID：487056
> 
> 赞同：60
> 
> 时间：2009-01-28T09:55:54.223
> 
> 标签：jquery

一个简单的，我试图在使用 jQuery 按下按钮时检索按钮的 value 属性，这就是我所拥有的：

```
<script type="text/javascript">
    $(document).ready(function() {
        $('.my_button').click(function() {
            alert($(this).val());
        });
    });
</script>

<button class="my_button" name="buttonName" value="buttonValue">
    Button Label</button> 
```

在 Firefox 中，我的警报显示“buttonValue”，这很好，但在 IE7 中，它显示“按钮标签”。

我应该使用什么 jQuery 来始终获取按钮的值？还是我应该使用不同的方法？

非常感谢。

答：我现在正在使用

```
<input class="my_button" type="image" src="whatever.png" value="buttonValue" /> 
```

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2009-01-28T10:12:34.953

由于按钮值是一个属性，您需要在 jquery 中使用 .attr() 方法。这应该这样做

```
<script type="text/javascript">
    $(document).ready(function() {
        $('.my_button').click(function() {
            alert($(this).attr("value"));
        });
    });
</script> 
```

您还可以使用 attr 来设置属性，更多信息[在 docs 中](http://docs.jquery.com/Attributes/attr)。

这仅适用于 JQuery 1.6+。请参阅后现代对旧版本的回答。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-12-08T00:50:36.063

我知道这是不久前发布的，但如果有人正在寻找答案并且真的想使用按钮元素而不是输入元素......

您*不能*在 IE 中使用`.attr('value')`或`.val()`与按钮一起使用。IE 将 .val() 和 .attr("value") 报告为按钮元素的文本标签（内容），而不是 value 属性的实际值。

您可以通过暂时删除按钮的标签来解决它：

```
var getButtonValue = function($button) {
    var label = $button.text(); 
    $button.text('');
    var buttonValue = $button.val();
    $button.text(label);
    return buttonValue;
} 
```

IE 中的按钮还有一些其他的怪癖。我在[这里发布了针对两个最常见问题的修复程序](http://gist.github.com/251287)。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2012-01-06T19:15:17.733

Button 没有 value 属性。要获取按钮的文本，请尝试：

```
$('.my_button').click(function() {
     alert($(this).html());
}); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-12-02T10:50:48.980

您还可以使用新的 HTML5 自定义数据属性。

```
<script type="text/javascript">
$(document).ready(function() {
    $('.my_button').click(function() {
        alert($(this).attr('data-value'));
    });
});
</script>

<button class="my_button" name="buttonName" data-value="buttonValue">Button Label</button> 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-03-19T15:11:39.777

给按钮一个 value 属性，然后使用以下方法检索值：

```
$("button").click(function(){
  var value=$(this).attr("value");
}); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-28T10:16:41.107

试试这个按钮：

```
<input type="button" class="my_button" name="buttonName" value="buttonValue" /> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-04-07T08:03:19.933

受后后现代的启发，我做了这个，让 .val() 在我的 javascript 代码中工作：

```
jQuery(function($) {

    if($.browser.msie) {
        // Fixes a know issue, that buttons value is overwritten with the text

        // Someone with more jQuery experience can probably tell me
        // how not to polute jQuery.fn here:
        jQuery.fn._orig_val = jQuery.fn.val

        jQuery.fn.val = function(value) {
            var elem = $(this);
            var html
            if(elem.attr('type') == 'button') {
                // if button, hide button text while getting val()
                html = elem.html()
                elem.html('')
            }
            // Use original function
            var result = elem._orig_val(value);
            if(elem.attr('type') == 'button') {
                elem.html(html)
            }
            return result;
        }
    }
}) 
```

然而，它并没有解决后现代解决的提交问题。也许这可以包含在后现代的解决方案中：http: [//gist.github.com/251287](http://gist.github.com/251287)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T10:13:50.943

如果您想获取值属性（buttonValue），那么我会使用：

```
<script type="text/javascript">
    $(document).ready(function() {
        $('.my_button').click(function() {
            alert($(this).attr('value'));
        });
    });
</script> 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2017-07-10T23:47:10.593

```
 <!DOCTYPE html>
 <html>
 <head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
 </script>
 <script>
 $(document).ready(function(){
   $("#hide").click(function(){
    $("p").toggle();

    var x = $("#hide").text();

      if(x=="Hide"){
      $("button").html("show");

      }
     else 
     {
     $("button").html("Hide");

      }

       });

   });

  </script>
  </head>
  <body>

 <p>If you click on the "Hide" button, I will disappear.</p>

 <button id="hide">Hide</button>

 </body>
 </html> 
```

# cons - 如果没有人依赖它，我如何强制使用 Cons 创建文件？

> ID：487059
> 
> 赞同：1
> 
> 时间：2009-01-28T09:56:40.820
> 
> 标签：cons

由于我无法控制的原因，我正在使用的项目使用`Cons`而不是`Make`一个部分（即我们继承了并且没有足够的投资回报率来切换到 Make）。

我刚刚添加了一个新规则来创建我在项目的不相关部分中需要的文件。“不相关”是指它超出了我的`Cons`脚本范围。项目构建假定使用`Cons`的部分在需要新文件的部分之前 100% 完成。

因此，没有`Cons`需要新文件的目标，因此`Cons`不构建它。我怎么知道`Cons`无论如何都要建造它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T10:11:35.073

这可以使用以下`Depends`方法完成：

```
$CONS->Depends("target", "file_i_want_to_create"); 
```

这使得`target`依赖`file_i_want_to_create`. 如果`target`是肯定会构建的东西（例如我们想要构建的实际项目`CONS`），那么`file_i_want_to_create`肯定会被创建。

# c# - Linq很奇怪还是我很愚蠢？

> ID：487065
> 
> 赞同：2
> 
> 时间：2009-01-28T09:57:53.983
> 
> 标签：c#, linq-to-sql

为什么会这样：

```
result = (from e in db.CampaignCodes where e.Code.Equals("") && 
e.Domain.Equals(null) select e).FirstOrDefault(); 
```

但不是（结果为空）：

```
String code = "";
String domain = null;

result = (from e in db.CampaignCodes where e.Code.Equals(code) &&
 e.Domain.Equals(domain) select e).FirstOrDefault(); 
```

??

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T10:07:46.663

扩展伊恩的答案：

根据 e.Domain.Equals() 的重载，传递空字符串变量可能会与传递空值不同？我不确定这里的规则是什么，但我怀疑编译器可能更喜欢 e.Domain.Equals(object variable) 当明确给出“just”null，而不是已设置为空的字符串变量？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-28T10:01:04.027

空字符串 - 域 - 与仅传递空值不同吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-28T10:07:58.207

这听起来确实很奇怪。LINQ to SQL 可能会注意到从变量中获取值和从常量中获取值之间的区别，但我没想到它会产生任何区别。

我强烈建议，每当 LINQ to SQL 出现异常行为时，您打开上下文日志记录并查看它在每种情况下实际执行的查询。

编辑：关于重载方面的其他答案真的很有趣。如果您将`domain`变量声明为类型`object`而不是`string`在第二个查询中，或者在第一个查询中将变量`null`转换为，会发生什么`string`？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T13:33:24.457

通过日志记录下来，这些是我的结果：

我得到以下结果：

作品：

```
(from e in CampaignCodes where e.Code.Equals(code) && e.Domain.Equals(null) select e).FirstOrDefault().Dump();

SELECT TOP (1) [t0].[Id], [t0].[Code], [t0].[Domain], [t0].[ClientId], [t0].[CampaignId], [t0].[PathId], [t0].[DescriptionText], [t0].[DeleteFlag], [t0].[Created]
FROM [CampaignCodes] AS [t0]
WHERE ([t0].[Code] = @p0) AND ([t0].[Domain] IS NULL)
-- @p0: Input NVarChar (Size = 0; Prec = 0; Scale = 0) []
-- Context: SqlProvider(Sql2005) Model: AttributedMetaModel Build: 3.5.21022.8 
```

不工作：

```
(from e in CampaignCodes where e.Code.Equals(code) && e.Domain.Equals(domain) select e).FirstOrDefault().Dump();

SELECT TOP (1) [t0].[Id], [t0].[Code], [t0].[Domain], [t0].[ClientId], [t0].[CampaignId], [t0].[PathId], [t0].[DescriptionText], [t0].[DeleteFlag], [t0].[Created]
FROM [CampaignCodes] AS [t0]
WHERE ([t0].[Code] = @p0) AND ([t0].[Domain] = @p1)
-- @p0: Input NVarChar (Size = 0; Prec = 0; Scale = 0) []
-- @p1: Input NVarChar (Size = 0; Prec = 0; Scale = 0) [Null]
-- Context: SqlProvider(Sql2005) Model: AttributedMetaModel Build: 3.5.21022. 
```

8

所以

通过将我的 linq2sql 重写为：

```
(from e in CampaignCodes where e.Code.Equals(code) && ((domain==null && e.Domain.Equals(null))||e.Domain.Equals(domain)) select e).FirstOrDefault().Dump(); 
```

我得到：

```
SELECT TOP (1) [t0].[Id], [t0].[Code], [t0].[Domain], [t0].[ClientId], [t0].[CampaignId], [t0].[PathId], [t0].[DescriptionText], [t0].[DeleteFlag], [t0].[Created]
FROM [CampaignCodes] AS [t0]
WHERE ([t0].[Code] = @p0) AND ([t0].[Domain] = @p1)
-- @p0: Input NVarChar (Size = 4; Prec = 0; Scale = 0) [test]
-- @p1: Input NVarChar (Size = 14; Prec = 0; Scale = 0) [mydomain.se]
-- Context: SqlProvider(Sql2005) Model: AttributedMetaModel Build: 3.5.21022.8 
```

当域不为空并且：

```
SELECT TOP (1) [t0].[Id], [t0].[Code], [t0].[Domain], [t0].[ClientId], [t0].[CampaignId], [t0].[PathId], [t0].[DescriptionText], [t0].[DeleteFlag], [t0].[Created]
FROM [CampaignCodes] AS [t0]
WHERE ([t0].[Code] = @p0) AND (([t0].[Domain] IS NULL) OR ([t0].[Domain] = @p1))
-- @p0: Input NVarChar (Size = 4; Prec = 0; Scale = 0) [test]
-- @p1: Input NVarChar (Size = 0; Prec = 0; Scale = 0) [Null]
-- Context: SqlProvider(Sql2005) Model: AttributedMetaModel Build: 3.5.21022.8 
```

几时。

但我希望有一个很好的方法来解决这个问题......

# javascript - 如何在jQuery中制作滚动条？

> ID：487066
> 
> 赞同：0
> 
> 时间：2009-01-28T09:57:56.217
> 
> 标签：javascript, jquery, scroll

我想制作像这里给出的滚动条：http: [//www.shopping.com/xPC-Kettler-Kettler-Vito-Xl~linkin_id-8051267](http://www.shopping.com/xPC-Kettler-Kettler-Vito-Xl~linkin_id-8051267)

在 jQuery 中。我想它在道场。请给我这样的滚动条链接。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T10:02:42.197

[这个也许](http://sorgalla.com/jcarousel/)（jcarousel）

编辑：jCarousel 不支持鼠标悬停

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T10:04:07.717

我想 jQuery 滚动条有很多不同的插件，这里有一个：

[http://www.webresourcesdepot.com/scrollable-jquery-plugin-to-scroll-content/](http://www.webresourcesdepot.com/scrollable-jquery-plugin-to-scroll-content/)

及其工作的演示：

[http://www.flowplayer.org/tools/scrollable.html](http://www.flowplayer.org/tools/scrollable.html)

希望这可以帮助！:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T00:01:22.113

如果您想自己动手，那么我有一个构建这种轮播的基本配方，以回答[jCarousel with unknown content width](https://stackoverflow.com/questions/397184/jcarousel-with-unknown-content-width#408404)。

# ruby-on-rails - 如何避免短路评估

> ID：487067
> 
> 赞同：30
> 
> 时间：2009-01-28T09:58:23.563
> 
> 标签：ruby-on-rails, operators, logical-operators, short-circuiting

我正在使用 Ruby on Rails 并想验证两种不同的模型：

```
if (model1.valid? && model2.valid?)
...
end 
```

但是，“&&”运算符使用短路评估（即，仅当“model1.valid？”为真时才评估“model2.valid？”），这会阻止在model1 无效时执行model2.valids。

是否存在不使用短路评估的“&&”等价物？我需要评估这两个表达式。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-28T10:10:36.707

试试这个：

```
([model1, model2].map(&:valid?)).all? 
```

如果两者都有效，它将返回 true，并在两个实例上创建错误。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-28T11:09:03.983

& 工作得很好。

```
irb(main):007:0> def a
irb(main):008:1> puts "a"
irb(main):009:1> false
irb(main):010:1> end
=> nil

irb(main):011:0> def b
irb(main):012:1> puts "b"
irb(main):013:1> true
irb(main):014:1> end
=> nil

irb(main):015:0> a && b
a
=> false

irb(main):016:0> a & b
a
b
=> false

irb(main):017:0> a and b
a
=> false 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-02T22:44:06.963

怎么样：

```
if [model1.valid?,model2.valid?].all?
  ...
end 
```

为我工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-28T10:01:51.637

分别评估它们并将结果存储在变量中。然后在这些布尔值之间使用简单的 && :)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-05-30T15:36:13.380

让未来的开发人员更容易维护代码片段的关键概念之一是它的[表现力](https://www.oxfordlearnersdictionaries.com/definition/english/expressiveness)。

让我们考虑以下示例：

```
([model1, model2].map(&:valid?)).all? 
```

或者

```
[model1.valid?,model2.valid?].all? 
```

他们俩都做得很好，但是当未来的开发人员在没有看到任何解释性评论、您的意图文档或没有直接联系到您的情况下遇到其中任何一个时，该开发人员将修改它们，而不知道其目的是避免短路评估。

当您没有测试时，情况会变得更糟。

这就是为什么我建议引入一个小的包装器方法，它可以立即让所有事情变得清晰。

```
def without_short_circuit_evaluation(*conditions)
  conditions.all?
end 
```

稍后在您的代码库中的某个地方。

```
if without_short_circuit_evaluation(model1.valid?, model2.valid?)
  # do something
end 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-28T10:50:36.140

您可以将一个块传递给`all?`.

```
[model_instance_1, model_instance_2].all? {|i| i.valid? } 
```

# javascript - 在队列头部添加事件

> ID：487069
> 
> 赞同：3
> 
> 时间：2009-01-28T09:59:38.320
> 
> 标签：javascript, events

我已经定义了 onclick 事件。我想添加额外的回调函数，它将在已经定义的回调之前调用。

*   如何在具体事件类型的队列头部添加事件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T11:54:57.337

如果您使用`attachEvent`IE，则无法保证触发事件的顺序。请参阅[http://msdn.microsoft.com/en-us/library/ms536343(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms536343(VS.85).aspx)

> 如果将多个函数附加到同一对象上的同一事件，则在调用对象的事件处理程序后立即以随机顺序调用函数。

（我实际上已经看到事件是按相反的顺序调用的，而不是随机的）。无论如何，图书馆通常倾向于`attachEvent`深入使用，所以你会遇到同样的问题。

话虽如此，如果您可以检查节点的“点击”处理程序（例如，您在标记中的节点上设置了“onclick”属性），那么您*可以*将“您的”放在“他们的”之前：

```
var nodes = document.getElementsByTagName('*'); // collect your nodes however
for(var i=0; i < nodes.length; i++) {
    var node = nodes[i];
    if(!node.onclick)
        continue;

    // At this point we have a node with an "onclick" attr.
    // Hijack onclick to do something else first.
    var original = node.onclick;
    node.onclick = function() {
        doSomethingElse();
        return original.apply(this, arguments);
    }
} 
```

请参阅[此答案](https://stackoverflow.com/questions/446892/how-to-find-event-listeners-on-a-dom-node#447106)以了解如何检查其他库中的节点事件（如果您正在使用一个）。您也可以将它`doSomethingElse()`与这些库一起使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T09:05:39.270

极好的。这让我研究了 jquery doc，我发现将 crescentfresh 的解决方案与 jQuery 的 unbind() 方法（Extjs.removeAll() 的类似物）结合起来可以解决我的问题。

所以，最后我有这个：

```
this.onclick = function( e ) 
        if ( /*trigger clause*/ true ) { 
          //cancel all events
          $(this).unbind();
          return false;
        } else {
          //continue processing  
          return original ? original.apply(this, arguments) : true;
        }
      } 
```

感谢各位大佬的建议！

PS 什么混蛋做了这个糟糕的回复编辑？？！在这里粘贴一些代码很头疼。

PPS 很遗憾，我不能为两个回复投票，并且由于缺乏声誉，我不能为您的回复提高有用的分数，而且我不能将一个以上的答案标记为可接受的。所以，请原谅我。愚蠢的论坛引擎，但这里的人真的很酷

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T10:31:07.663

[addEventListener](https://developer.mozilla.org/En/DOM/Element.addEventListener)允许您添加另一个事件。请注意，在 IE 中您必须使用 attachEvent。

这不会让您定义事件的顺序 - 显然您[无法预测事件将被触发的顺序](http://www.quirksmode.org/js/events_advanced.html)。因此，如果您真的想要一个事件的可预测事件队列，您将不得不自己实现它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T10:56:14.680

[您可以使用preventDefault()](https://developer.mozilla.org/en/DOM/event.preventDefault)停止事件的默认操作，或者使用[stopPropagation()](https://developer.mozilla.org/en/DOM/event.stopPropagation)停止嵌套事件的传播，以仅触发您的特定事件。

[但是在不使用setTimeout()](https://developer.mozilla.org/en/DOM/window.setTimeout)的情况下本机暂停或延迟事件，停止、保存他的状态并稍后在队列中重新触发是不可能的。

*   [这是关于事件如何在 javascript 中工作的一个很好的解释](http://dev.opera.com/articles/view/timing-and-synchronization-in-javascript/)

*   [以及有关计时器如何工作的说明。](http://ejohn.org/blog/how-javascript-timers-work/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T19:25:34.433

你在使用 jquery 框架吗？我目前正在使用 extjs，我找到了一个可以使用或复制的类

让我们看看[http://extjs.com/deploy/dev/docs/](http://extjs.com/deploy/dev/docs/) Ext > EventManager > removeAll()

> removeAll( String/HTMLElement el ) : void 从元素中删除所有事件处理程序。通常，您将直接在 Element 上使用 Ext.Element.removeAllListeners 来支持调用此版本。参数： el : String/HTMLElement 要从中删除事件的 id 或 html 元素返回： void

我认为您可以将标签设置`body`为 HTMLElement 以关闭所有事件。（未测试抱歉）

在此处下载[http://extjs.com/products/extjs/build/](http://extjs.com/products/extjs/build/) > 如果您正在使用 jquery，请选择 jquery 适配器 > extcore 就足够了（它包含 EventManager.js ）。

另一方面，就像 crescentfresh（答案 n°4）一样，我将此示例代码应用于所有节点事件：

```
var nodes = document.getElementsByTagName('*'); // collect your nodes however
for(var i=0; i < nodes.length; i++) {
     var node = nodes[i];
     Ext.EventManager.removeAll(node);
    }
} 
```

如果您在使用 extjs 时遇到问题，请告诉我，如果我的回答有用，请投票给我。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-01-28T13:45:02.873

您可以通过使用正确的参数加载此示例函数来简单地停止事件侦听器：

```
 function removeEvent(obj,type,fn){
  if(obj.removeEventListener) obj.removeEventListener(type,fn,false);
  else if(obj.detachEvent){
    obj.detachEvent("on"+type,obj[type+fn]);
    obj[type+fn]=null;
    obj["e"+type+fn]=null;
  }
} 
```

此外，您可以在杀死其他侦听器的事件中触发 à setTimeout，并在外部或与其他 setTimeout 一起重新启用侦听器。

调试事件的库，可能有用。

# javascript - 如何检查滚动后元素是否可见？

> ID：487073
> 
> 赞同：1312
> 
> 时间：2009-01-28T10:00:55.303
> 
> 标签：javascript, jquery, scroll

我正在通过 AJAX 加载元素。其中一些只有在您向下滚动页面时才可见。有什么方法可以知道元素现在是否在页面的可见部分中？

* * *

## 回答 #1

> 赞同：1321
> 
> 时间：2009-01-28T15:36:57.170

这应该可以解决问题：

```
function isScrolledIntoView(elem)
{
    var docViewTop = $(window).scrollTop();
    var docViewBottom = docViewTop + $(window).height();

    var elemTop = $(elem).offset().top;
    var elemBottom = elemTop + $(elem).height();

    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
} 
```

**简单的实用函数** 这将允许您调用一个实用函数，该函数接受您正在寻找的元素以及您希望该元素是完全可见还是部分可见。

```
function Utils() {

}

Utils.prototype = {
    constructor: Utils,
    isElementInView: function (element, fullyInView) {
        var pageTop = $(window).scrollTop();
        var pageBottom = pageTop + $(window).height();
        var elementTop = $(element).offset().top;
        var elementBottom = elementTop + $(element).height();

        if (fullyInView === true) {
            return ((pageTop < elementTop) && (pageBottom > elementBottom));
        } else {
            return ((elementTop <= pageBottom) && (elementBottom >= pageTop));
        }
    }
};

var Utils = new Utils(); 
```

**用法**

```
var isElementInView = Utils.isElementInView($('#flyout-left-container'), false);

if (isElementInView) {
    console.log('in view');
} else {
    console.log('out of view');
} 
```

* * *

## 回答 #2

> 赞同：502
> 
> 时间：2014-03-18T13:31:11.193

香草的[这个答案：](https://stackoverflow.com/a/488073/643514)

```
function isScrolledIntoView(el) {
    var rect = el.getBoundingClientRect();
    var elemTop = rect.top;
    var elemBottom = rect.bottom;

    // Only completely visible elements return true:
    var isVisible = (elemTop >= 0) && (elemBottom <= window.innerHeight);
    // Partially visible elements return true:
    //isVisible = elemTop < window.innerHeight && elemBottom >= 0;
    return isVisible;
} 
```

* * *

## 回答 #3

> 赞同：130
> 
> 时间：2010-08-20T21:31:43.037

更新：使用[IntersectionObserver](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)

* * *

到目前为止我发现的最好的方法是[jQuery 出现插件](https://github.com/morr/jquery.appear)。奇迹般有效。

> 模仿自定义的“出现”事件，当元素滚动到视图中或以其他方式对用户可见时触发。
> 
> ```
> $('#foo').appear(function() {
>   $(this).text('Hello world');
> }); 
> ```
> 
> 此插件可用于防止对隐藏或可见区域之外的内容的不必要请求。

* * *

## 回答 #4

> 赞同：110
> 
> 时间：2017-08-10T15:44:42.043

# 使用[**IntersectionObserver**](https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver) API

### （在现代浏览器中原生）

* * *

*使用观察者*可以轻松高效地确定元素是否在视口中或任何可滚动容器中可见。

消除了附加`scroll`事件和手动检查事件回调的需要，这样更有效：

```
// define an observer instance
var observer = new IntersectionObserver(onIntersection, {
  root: null,   // default is the viewport
  threshold: .5 // percentage of taregt's visible area. Triggers "onIntersection"
})

// callback is called on intersection change
function onIntersection(entries, opts){
  entries.forEach(entry =>  
    entry.target.classList.toggle('visible', entry.isIntersecting)
  )
}

// Use the observer to observe an element
observer.observe( document.querySelector('.box') )

// To stop observing:
// observer.unobserve(entry.target)
```

```
span{ position:fixed; top:0; left:0; }
.box{ width:100px; height:100px; background:red; margin:1000px; transition:.75s; }
.box.visible{ background:green; border-radius:50%; }
```

```
<span>Scroll both Vertically &amp; Horizontally...</span>
<div class='box'></div>
```

* * *

### 现代浏览器支持，包括移动浏览器。IE 中不支持 -[查看浏览器支持表](http://caniuse.com/#search=IntersectionObserver)

* * *

## 回答 #5

> 赞同：99
> 
> 时间：2014-02-07T12:02:25.553

这是我的纯 JavaScript 解决方案，如果它也隐藏在可滚动容器中，它也可以工作。

[演示在这里](http://jsfiddle.net/W33YR/411/)（也尝试调整窗口大小）

```
var visibleY = function(el){
  var rect = el.getBoundingClientRect(), top = rect.top, height = rect.height, 
    el = el.parentNode
  // Check if bottom of the element is off the page
  if (rect.bottom < 0) return false
  // Check its within the document viewport
  if (top > document.documentElement.clientHeight) return false
  do {
    rect = el.getBoundingClientRect()
    if (top <= rect.bottom === false) return false
    // Check if the element is out of view due to a container scrolling
    if ((top + height) <= rect.top) return false
    el = el.parentNode
  } while (el != document.body)
  return true
}; 
```

*编辑 2016-03-26：我更新了解决方案以考虑滚动过去的元素，因此它隐藏在可滚动容器的顶部上方。* *编辑 2018-10-08：更新为在屏幕上方滚动出视图时处理。*

* * *

## 回答 #6

> 赞同：45
> 
> 时间：2017-01-20T01:37:52.370

普通香草检查元素（`el`）是否在可滚动的 div（`holder`）中可见

```
function isElementVisible (el, holder) {
  holder = holder || document.body
  const { top, bottom, height } = el.getBoundingClientRect()
  const holderRect = holder.getBoundingClientRect()

  return top <= holderRect.top
    ? holderRect.top - top <= height
    : bottom - holderRect.bottom <= height
} 
```

与 jQuery 一起使用：

```
var el = $('tr:last').get(0);
var holder = $('table').get(0);
var isVisible = isScrolledIntoView(el, holder); 
```

* * *

## 回答 #7

> 赞同：41
> 
> 时间：2011-12-04T12:08:19.307

jQuery Waypoints 插件在这里非常好用。

```
$('.entry').waypoint(function() {
   alert('You have scrolled to an entry.');
}); 
```

[插件网站](http://imakewebthings.github.com/jquery-waypoints)上有一些示例。

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2014-04-29T10:24:51.260

怎么样

```
function isInView(elem){
   return $(elem).offset().top - $(window).scrollTop() < $(elem).height() ;
} 
```

之后，一旦元素出现在这样的视图中，您就可以触发任何您想要的东西

```
$(window).scroll(function(){
   if (isInView($('.classOfDivToCheck')))
      //fire whatever you what 
      dothis();
}) 
```

这对我来说很好

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2013-04-30T16:08:20.383

Tweeked Scott Dowding 为我的要求提供的很酷的功能 - 这用于查找元素是否刚刚滚动到屏幕中，即它的顶部边缘。

```
function isScrolledIntoView(elem)
{
    var docViewTop = $(window).scrollTop();
    var docViewBottom = docViewTop + $(window).height();
    var elemTop = $(elem).offset().top;
    return ((elemTop <= docViewBottom) && (elemTop >= docViewTop));
} 
```

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2009-01-28T14:14:48.913

[WebResourcesDepot](http://www.webresourcesdepot.com)前段时间使用[jQuery](http://www.jquery.com)编写[了一个在滚动时加载的脚本。](http://www.webresourcesdepot.com/load-content-while-scrolling-with-jquery/)你可以在这里查看他们的[现场演示](http://www.webresourcesdepot.com/dnspinger/)。他们的功能的牛肉是这样的：

```
$(window).scroll(function(){
  if  ($(window).scrollTop() == $(document).height() - $(window).height()){
    lastAddedLiveFunc();
  }
});

function lastAddedLiveFunc() { 
  $('div#lastPostsLoader').html('<img src="images/bigLoader.gif">');
  $.post("default.asp?action=getLastPosts&lastPostID="+$(".wrdLatest:last").attr("id"),
    function(data){
        if (data != "") {
          $(".wrdLatest:last").after(data);         
        }
      $('div#lastPostsLoader').empty();
    });
}; 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2016-06-26T13:35:40.170

这里的大多数答案都没有考虑到一个元素也可以被隐藏，因为它被滚动到一个 div 的视图之外，而不仅仅是整个页面。

为了覆盖这种可能性，您基本上必须检查元素是否位于每个父元素的边界内。

该解决方案正是这样做的：

```
function(element, percentX, percentY){
    var tolerance = 0.01;   //needed because the rects returned by getBoundingClientRect provide the position up to 10 decimals
    if(percentX == null){
        percentX = 100;
    }
    if(percentY == null){
        percentY = 100;
    }

    var elementRect = element.getBoundingClientRect();
    var parentRects = [];

    while(element.parentElement != null){
        parentRects.push(element.parentElement.getBoundingClientRect());
        element = element.parentElement;
    }

    var visibleInAllParents = parentRects.every(function(parentRect){
        var visiblePixelX = Math.min(elementRect.right, parentRect.right) - Math.max(elementRect.left, parentRect.left);
        var visiblePixelY = Math.min(elementRect.bottom, parentRect.bottom) - Math.max(elementRect.top, parentRect.top);
        var visiblePercentageX = visiblePixelX / elementRect.width * 100;
        var visiblePercentageY = visiblePixelY / elementRect.height * 100;
        return visiblePercentageX + tolerance > percentX && visiblePercentageY + tolerance > percentY;
    });
    return visibleInAllParents;
}; 
```

它还允许您指定它必须在每个方向上可见的百分比。
它不包括它可能由于其他因素而被隐藏的可能性，例如`display: hidden`.

这应该适用于所有主要浏览器，因为它只使用[`getBoundingClientRect`](http://caniuse.com/#feat=getboundingclientrect). 我亲自在 Chrome 和 Internet Explorer 11 中对其进行了测试。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2013-10-23T17:30:40.087

**isScrolledIntoView**是一个非常需要的功能，所以我试了一下，它适用于不高于视口的元素，但如果元素比视口大，它就不起作用。要解决此问题，请轻松更改条件

```
return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop)); 
```

对此：

```
return (docViewBottom >= elemTop && docViewTop <= elemBottom); 
```

在此处查看演示：http: [//jsfiddle.net/RRSmQ/](http://jsfiddle.net/RRSmQ/)

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2014-02-15T18:51:09.633

这是另一个解决方案：

```
<script type="text/javascript">
$.fn.is_on_screen = function(){
    var win = $(window);
    var viewport = {
        top : win.scrollTop(),
        left : win.scrollLeft()
    };
    viewport.right = viewport.left + win.width();
    viewport.bottom = viewport.top + win.height();

    var bounds = this.offset();
    bounds.right = bounds.left + this.outerWidth();
    bounds.bottom = bounds.top + this.outerHeight();

    return (!(viewport.right < bounds.left || viewport.left > bounds.right ||    viewport.bottom < bounds.top || viewport.top > bounds.bottom));
 };

if( $('.target').length > 0 ) { // if target element exists in DOM
    if( $('.target').is_on_screen() ) { // if target element is visible on screen after DOM loaded
        $('.log').html('<div class="alert alert-success">target element is visible on screen</div>'); // log info       
    } else {
        $('.log').html('<div class="alert">target element is not visible on screen</div>'); // log info
    }
}
$(window).on('scroll', function(){ // bind window scroll event
if( $('.target').length > 0 ) { // if target element exists in DOM
    if( $('.target').is_on_screen() ) { // if target element is visible on screen after DOM loaded
        $('.log').html('<div class="alert alert-success">target element is visible on screen</div>'); // log info
    } else {
        $('.log').html('<div class="alert">target element is not visible on screen</div>'); // log info
    }
}
});
</script> 
```

在[JSFiddle中查看](http://jsfiddle.net/webvitaly/c7nS5/light/)

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2014-12-30T01:54:05.770

这会考虑元素具有的任何填充、边框或边距，以及大于视口本身的元素。

```
function inViewport($ele) {
    var lBound = $(window).scrollTop(),
        uBound = lBound + $(window).height(),
        top = $ele.offset().top,
        bottom = top + $ele.outerHeight(true);

    return (top > lBound && top < uBound)
        || (bottom > lBound && bottom < uBound)
        || (lBound >= top && lBound <= bottom)
        || (uBound >= top && uBound <= bottom);
} 
```

要调用它，请使用以下内容：

```
var $myElement = $('#my-element'),
    canUserSeeIt = inViewport($myElement);

console.log(canUserSeeIt); // true, if element is visible; false otherwise 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2009-10-09T09:49:01.030

```
function isScrolledIntoView(elem) {
    var docViewTop = $(window).scrollTop(),
        docViewBottom = docViewTop + $(window).height(),
        elemTop = $(elem).offset().top,
     elemBottom = elemTop + $(elem).height();
   //Is more than half of the element visible
   return ((elemTop + ((elemBottom - elemTop)/2)) >= docViewTop && ((elemTop + ((elemBottom - elemTop)/2)) <= docViewBottom));
} 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2012-09-26T16:05:32.987

有一个[名为**inview**](https://github.com/protonet/jquery.inview)的 jQuery 插件，它添加了一个新的“inview”事件。

* * *

下面是一些不使用事件的 jQuery 插件的代码：

```
$.extend($.expr[':'],{
    inView: function(a) {
        var st = (document.documentElement.scrollTop || document.body.scrollTop),
            ot = $(a).offset().top,
            wh = (window.innerHeight && window.innerHeight < $(window).height()) ? window.innerHeight : $(window).height();
        return ot > st && ($(a).height() + ot) < (st + wh);
    }
});

(function( $ ) {
    $.fn.inView = function() {
        var st = (document.documentElement.scrollTop || document.body.scrollTop),
        ot = $(this).offset().top,
        wh = (window.innerHeight && window.innerHeight < $(window).height()) ? window.innerHeight : $(window).height();

        return ot > st && ($(this).height() + ot) < (st + wh);
    };
})( jQuery ); 
```

我在这里的评论中发现了这一点（[http://remysharp.com/2009/01/26/element-in-view-event-plugin/](http://remysharp.com/2009/01/26/element-in-view-event-plugin/)）一个叫詹姆斯的家伙

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2013-04-25T09:33:18.190

我需要检查可滚动 DIV 容器内元素的可见性

```
 //p = DIV container scrollable
    //e = element
    function visible_in_container(p, e) {
        var z = p.getBoundingClientRect();
        var r = e.getBoundingClientRect();

        // Check style visiblilty and off-limits
        return e.style.opacity > 0 && e.style.display !== 'none' &&
               e.style.visibility !== 'hidden' &&
               !(r.top > z.bottom || r.bottom < z.top ||
                 r.left > z.right || r.right < z.left);
    } 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2017-03-14T03:20:51.167

在[这个很好的答案](https://stackoverflow.com/a/22480938/680394)的基础上，您可以使用 ES2015+ 进一步简化它：

```
function isScrolledIntoView(el) {
  const { top, bottom } = el.getBoundingClientRect()
  return top >= 0 && bottom <= window.innerHeight
} 
```

如果您不关心顶部超出窗口而只关心底部已被查看，则可以将其简化为

```
function isSeen(el) {
  return el.getBoundingClientRect().bottom <= window.innerHeight
} 
```

甚至是单线

```
const isSeen = el => el.getBoundingClientRect().bottom <= window.innerHeight 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2009-01-28T10:17:24.007

我的应用程序中有这样一个方法，但它不使用 jQuery：

```
/* Get the TOP position of a given element. */
function getPositionTop(element){
    var offset = 0;
    while(element) {
        offset += element["offsetTop"];
        element = element.offsetParent;
    }
    return offset;
}

/* Is a given element is visible or not? */
function isElementVisible(eltId) {
    var elt = document.getElementById(eltId);
    if (!elt) {
        // Element not found.
        return false;
    }
    // Get the top and bottom position of the given element.
    var posTop = getPositionTop(elt);
    var posBottom = posTop + elt.offsetHeight;
    // Get the top and bottom position of the *visible* part of the window.
    var visibleTop = document.body.scrollTop;
    var visibleBottom = visibleTop + document.documentElement.offsetHeight;
    return ((posBottom >= visibleTop) && (posTop <= visibleBottom));
} 
```

*编辑：此方法适用于 IE（至少版本 6）。阅读评论以了解与 FF 的兼容性。*

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2013-02-14T18:49:59.750

如果你想调整它以在另一个 div 中滚动项目，

```
function isScrolledIntoView (elem, divID) 

{

    var docViewTop = $('#' + divID).scrollTop();

    var docViewBottom = docViewTop + $('#' + divID).height();

    var elemTop = $(elem).offset().top;
    var elemBottom = elemTop + $(elem).height();

    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop)); 
} 
```

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2015-03-04T11:34:51.200

您可以使用 jquery 插件“onScreen”来检查滚动时元素是否在当前视口中。The plugin sets the ":onScreen" of the selector to true when the selector appears on the screen. 这是您可以包含在项目中的插件的链接。“ [http://benpickles.github.io/onScreen/jquery.onscreen.min.js](http://benpickles.github.io/onScreen/jquery.onscreen.min.js) ”

您可以尝试以下对我有用的示例。

```
$(document).scroll(function() {
    if($("#div2").is(':onScreen')) {
        console.log("Element appeared on Screen");
        //do all your stuffs here when element is visible.
    }
    else {
        console.log("Element not on Screen");
        //do all your stuffs here when element is not visible.
    }
}); 
```

HTML 代码：

```
<div id="div1" style="width: 400px; height: 1000px; padding-top: 20px; position: relative; top: 45px"></div> <br>
<hr /> <br>
<div id="div2" style="width: 400px; height: 200px"></div> 
```

CSS：

```
#div1 {
    background-color: red;
}
#div2 {
    background-color: green;
} 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2015-04-17T23:22:40.613

一个基于[此答案](https://stackoverflow.com/a/22480938/363155)的示例，用于检查元素是否 75% 可见（即不到 25% 的元素不在屏幕上）。

```
function isScrolledIntoView(el) {
  // check for 75% visible
  var percentVisible = 0.75;
  var elemTop = el.getBoundingClientRect().top;
  var elemBottom = el.getBoundingClientRect().bottom;
  var elemHeight = el.getBoundingClientRect().height;
  var overhang = elemHeight * (1 - percentVisible);

  var isVisible = (elemTop >= -overhang) && (elemBottom <= window.innerHeight + overhang);
  return isVisible;
} 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2017-09-11T23:15:32.937

[此答案](https://stackoverflow.com/a/22480938/443431)的更有效版本：

```
 /**
 * Is element within visible region of a scrollable container
 * @param {HTMLElement} el - element to test
 * @returns {boolean} true if within visible region, otherwise false
 */
 function isScrolledIntoView(el) {
      var rect = el.getBoundingClientRect();
      return (rect.top >= 0) && (rect.bottom <= window.innerHeight);
 } 
```

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2020-01-02T10:52:10.340

我为此找到的最简单的解决方案是**Intersection Observer API**：

```
var observer = new IntersectionObserver(function(entries) {
    if(entries[0].isIntersecting === true)
        console.log('Element has just become visible in screen');
}, { threshold: [0] });

observer.observe(document.querySelector("#main-container")); 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2013-09-16T20:02:56.930

修改了接受的答案，以便元素必须将其显示属性设置为“无”以外的其他值，以使质量可见。

```
function isScrolledIntoView(elem) {
   var docViewTop = $(window).scrollTop();
  var docViewBottom = docViewTop + $(window).height();

  var elemTop = $(elem).offset().top;
  var elemBottom = elemTop + $(elem).height();
  var elemDisplayNotNone = $(elem).css("display") !== "none";

  return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop) && elemDisplayNotNone);
} 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2014-06-14T20:59:43.157

这是一种使用 Mootools 在水平、垂直或两者中实现相同目标的方法。

```
Element.implement({
inVerticalView: function (full) {
    if (typeOf(full) === "null") {
        full = true;
    }

    if (this.getStyle('display') === 'none') {
        return false;
    }

    // Window Size and Scroll
    var windowScroll = window.getScroll();
    var windowSize = window.getSize();
    // Element Size and Scroll
    var elementPosition = this.getPosition();
    var elementSize = this.getSize();

    // Calculation Variables
    var docViewTop = windowScroll.y;
    var docViewBottom = docViewTop + windowSize.y;
    var elemTop = elementPosition.y;
    var elemBottom = elemTop + elementSize.y;

    if (full) {
        return ((elemBottom >= docViewTop) && (elemTop <= docViewBottom)
            && (elemBottom <= docViewBottom) && (elemTop >= docViewTop) );
    } else {
        return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    }
},
inHorizontalView: function(full) {
    if (typeOf(full) === "null") {
        full = true;
    }

    if (this.getStyle('display') === 'none') {
        return false;
    }

    // Window Size and Scroll
    var windowScroll = window.getScroll();
    var windowSize = window.getSize();
    // Element Size and Scroll
    var elementPosition = this.getPosition();
    var elementSize = this.getSize();

    // Calculation Variables
    var docViewLeft = windowScroll.x;
    var docViewRight = docViewLeft + windowSize.x;
    var elemLeft = elementPosition.x;
    var elemRight = elemLeft + elementSize.x;

    if (full) {
        return ((elemRight >= docViewLeft) && (elemLeft <= docViewRight)
            && (elemRight <= docViewRight) && (elemLeft >= docViewLeft) );
    } else {
        return ((elemRight <= docViewRight) && (elemLeft >= docViewLeft));
    }
},
inView: function(full) {
    return this.inHorizontalView(full) && this.inVerticalView(full);
}}); 
```

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2014-08-15T14:23:50.410

如果元素的任何部分在页面上可见，此方法将返回 true。它在我的情况下效果更好，可能会帮助其他人。

```
function isOnScreen(element) {
  var elementOffsetTop = element.offset().top;
  var elementHeight = element.height();

  var screenScrollTop = $(window).scrollTop();
  var screenHeight = $(window).height();

  var scrollIsAboveElement = elementOffsetTop + elementHeight - screenScrollTop >= 0;
  var elementIsVisibleOnScreen = screenScrollTop + screenHeight - elementOffsetTop >= 0;

  return scrollIsAboveElement && elementIsVisibleOnScreen;
} 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2015-02-22T23:33:30.590

我更喜欢使用 jQuery expr

```
jQuery.extend(jQuery.expr[':'], {  
    inview: function (elem) {
        var t = $(elem);
        var offset = t.offset();
        var win = $(window); 
        var winST = win.scrollTop();
        var elHeight = t.outerHeight(true);

        if ( offset.top > winST - elHeight && offset.top < winST + elHeight + win.height()) {
            return true;    
        }    
        return false;  
    }
}); 
```

所以你可以这样使用它

```
$(".my-elem:inview"); //returns only element that is in view
$(".my-elem").is(":inview"); //check if element is in view
$(".my-elem:inview").length; //check how many elements are in view 
```

您可以在事件函数等中轻松添加此类代码，`scroll`以在每次用户滚动视图时检查它。

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2016-09-26T17:35:43.700

这个问题有 30 多个答案，但没有一个使用我一直在使用的极其简单的纯 JS 解决方案。没有必要仅仅为了解决这个问题而加载 jQuery，因为许多其他人都在推动。

为了判断元素是否在视口内，我们必须首先确定元素在主体内的位置。我们不需要像我曾经认为的那样递归地执行此操作。相反，我们可以使用`element.getBoundingClientRect()`.

```
pos = elem.getBoundingClientRect().top - document.body.getBoundingClientRect().top; 
```

该值是对象顶部和主体顶部之间的 Y 差。

然后我们必须判断该元素是否在视野范围内。大多数实现都会询问整个元素是否在视口内，所以这就是我们要介绍的内容。

首先，窗口的顶部位置是：`window.scrollY`。

我们可以通过将窗口的高度添加到其顶部位置来获得窗口的底部位置：

```
var window_bottom_position = window.scrollY + window.innerHeight; 
```

让我们创建一个简单的函数来获取元素的顶部位置：

```
function getElementWindowTop(elem){
    return elem && typeof elem.getBoundingClientRect === 'function' ? elem.getBoundingClientRect().top - document.body.getBoundingClientRect().top : 0;
} 
```

此函数将返回元素在窗口中的顶部位置，或者如果您使用该方法`0`传递元素以外的其他内容，它将返回。`.getBoundingClientRect()`这种方法已经存在了很长时间，因此您不必担心您的浏览器不支持它。

现在，我们元素的顶部位置是：

```
var element_top_position = getElementWindowTop(element); 
```

And or 元素的底部位置是：

```
var element_bottom_position = element_top_position + element.clientHeight; 
```

现在我们可以通过检查元素的底部位置是否低于视口的顶部位置以及检查元素的顶部位置是否高于视口的底部位置来确定元素是否在视口内：

```
if(element_bottom_position >= window.scrollY 
&& element_top_position <= window_bottom_position){
    //element is in view
else
    //element is not in view 
```

从那里，您可以执行在`in-view`元素上添加或删除类的逻辑，然后您可以稍后使用 CSS 中的过渡效果进行处理。

我非常惊讶我在其他任何地方都没有找到这个解决方案，但我相信这是最干净、最有效的解决方案，而且它不需要您加载 jQuery！

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2014-09-10T20:41:18.713

可滚动div（容器）的简单修改

```
var isScrolledIntoView = function(elem, container) {
    var containerHeight = $(container).height();
    var elemTop = $(elem).position().top;
    var elemBottom = elemTop + $(elem).height();
    return (elemBottom > 0 && elemTop < containerHeight);
} 
```

注意：如果元素大于可滚动的 div，这不起作用。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2015-01-23T11:50:53.417

我改编了这个简短的 jQuery 函数扩展，您可以随意使用（MIT 许可证）。

```
/**
 * returns true if an element is visible, with decent performance
 * @param [scope] scope of the render-window instance; default: window
 * @returns {boolean}
 */
jQuery.fn.isOnScreen = function(scope){
    var element = this;
    if(!element){
        return;
    }
    var target = $(element);
    if(target.is(':visible') == false){
        return false;
    }
    scope = $(scope || window);
    var top = scope.scrollTop();
    var bot = top + scope.height();
    var elTop = target.offset().top;
    var elBot = elTop + target.height();

    return ((elBot <= bot) && (elTop >= top));
}; 
```

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2015-03-05T17:02:36.930

我已经为该任务编写[了一个组件，旨在](https://github.com/hashchange/jquery.isinview)[极快](https://github.com/hashchange/jquery.isinview#jqueryisinview)地处理大量元素（对于*慢速移动设备上的*1000 个元素，调整到 <10 毫秒）。

它适用于您可以访问的每种类型的滚动容器——窗口、HTML 元素、嵌入式 iframe、生成的子窗口——并且在它检测到的内容方面非常灵活（[完全](https://github.com/hashchange/jquery.isinview#options)[或部分可见性](https://github.com/hashchange/jquery.isinview#optionspartially)、[边框或内容框](https://github.com/hashchange/jquery.isinview#optionsbox)、自定义[容差区域](https://github.com/hashchange/jquery.isinview#optionstolerance)等））。

一个巨大的、主要是自动生成的测试套件确保它像广告宣传的那样工作，[跨浏览器](https://github.com/hashchange/jquery.isinview#browser-support)。

如果您愿意，可以试一试：[jQuery.isInView](https://github.com/hashchange/jquery.isinview)。否则，您可能会在源代码中找到灵感，例如[这里](https://github.com/hashchange/jquery.isinview/blob/ea62277c3a9b936c0253cc309184706f121a3bf3/src/jquery.isinview.js#L418-489)。

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2015-08-19T15:51:40.037

我一直在寻找一种方法来查看该元素是否会很快出现，因此通过扩展上面的片段，我设法做到了。以为我会把它留在这里以防万一它会帮助某人

elm = 是你要检查的元素在视图中

scrollElement = 您可以传递**窗口**或具有滚动的父元素

offset = 如果您希望它在元素在屏幕中之前 200px 时触发，则传递 200

```
function isScrolledIntoView(elem, scrollElement, offset)
        {
            var $elem = $(elem);
            var $window = $(scrollElement);
            var docViewTop = $window.scrollTop();
            var docViewBottom = docViewTop + $window.height();
            var elemTop = $elem.offset().top;
            var elemBottom = elemTop + $elem.height();

            return (((elemBottom+offset) >= docViewBottom) && ((elemTop-offset) <= docViewTop)) || (((elemBottom-offset) <= docViewBottom) && ((elemTop+offset) >= docViewTop));
        }
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2019-01-31T04:32:38.827

**我们可以使用ES6**在现代浏览器中做这样的事情：

```
const isFullySeen = el => el &&
  typeof el.getBoundingClientRect === 'function' &&
  el.getBoundingClientRect()['bottom'] + window.scrollY <= 
    window.innerHeight + window.scrollY && 
  el.getBoundingClientRect()['top'] + window.scrollY <= 
    window.innerHeight + window.scrollY; 
```

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2020-12-13T14:19:41.450

我添加了我的代码修改。不幸的是，我可以看到每个人的版本，每个人都忽略了 debance 功能的使用。哪个答案是让您的事件不触发，例如，滚动时每秒 200 次。

```
$(window).scroll(function(){
        if (isInView($('.class'))){
            debounce(
                someFunction(), 5
            )
        }
    });
    function isInView(elem){
        if(document.documentElement.clientWidth > 991){
            return $(elem).offset().top - $(window).scrollTop() < $(elem).height();
        }else {
            doSometing;
        }
    } 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2021-10-20T07:55:18.710

Javascript代码可以写成：

```
window.addEventListener('scroll', function() {
    var element = document.querySelector('#main-container');
    var position = element.getBoundingClientRect();

    // checking whether fully visible
    if(position.top >= 0 && position.bottom <= window.innerHeight) {
        console.log('Element is fully visible in screen');
    }

    // checking for partial visibility
    if(position.top < window.innerHeight && position.bottom >= 0) {
        console.log('Element is partially visible in screen');
    }
});
```

并在 react js 中写成：

```
 componentDidMount() {
        window.addEventListener('scroll', this.isScrolledIntoView);
    }

    componentWillUnmount() {
        window.removeEventListener('scroll', this.isScrolledIntoView);
    }

  isScrolledIntoView() {
        var element = document.querySelector('.element');
        var position = element.getBoundingClientRect();

        // checking whether fully visible
        if (position.top >= 0 && position.bottom <= window.innerHeight) {
            console.log('Element is fully visible in screen');
        }
        // checking for partial visibility
         if (position.top < window.innerHeight && position.bottom >= 0) {
            console.log('Element is partially visible in screen');
         }
    }
```

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2013-03-14T14:35:58.993

我只是想分享一下我将它与我的脚本结合以移动 div 以便它始终保持在视图中：

```
 $("#accordion").on('click', '.subLink', function(){
        var url = $(this).attr('src');
        updateFrame(url);
        scrollIntoView();
    });

    $(window).scroll(function(){
            changePos();
    });

  function scrollIntoView()
  {
        var docViewTop = $(window).scrollTop();
        var docViewBottom = docViewTop + $(window).height();    
        var elemTop = $("#divPos").offset().top;
        var elemBottom = elemTop + $("#divPos").height();               
        if (elemTop < docViewTop){
            $("#divPos").offset({top:docViewTop});
        }
   }

   function changePos(){        
    var scrTop = $(window).scrollTop();
    var frmHeight = $("#divPos").height()
        if ((scrTop < 200) || (frmHeight > 800)){   
         $("#divPos").attr("style","position:absolute;");
        }else{
          $("#divPos").attr("style","position:fixed;top:5px;");
        }
    } 
```

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2021-05-17T14:33:12.853

在**打字稿上**

```
 private readonly isElementInViewPort = (el: HTMLElement): boolean => {
      const rect = el.getBoundingClientRect();
      const elementTop = rect.top;
      const elementBottom = rect.bottom;
      const scrollPosition = el?.scrollTop || document.body.scrollTop;
      return (
        elementBottom >= 0 &&
        elementTop <= document.documentElement.clientHeight &&
        elementTop + rect.height > elementTop &&
        elementTop <= elementBottom &&
        elementTop >= scrollPosition
      ); 
```

};

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2015-04-18T12:15:33.083

唯一对我有用的插件是：[https ://github.com/customd/jquery-visible](https://github.com/customd/jquery-visible)

我最近将此插件移植到[GWT](http://gwtproject.org)，因为我不想将 jquery 添加为仅用于使用该插件的依赖项。这是我的（简单）端口（仅包括我的用例所需的功能）：

```
public static boolean isVisible(Element e)
{
    //vp = viewPort, b = bottom, l = left, t = top, r = right
    int vpWidth   = Window.getClientWidth();
    int vpHeight = Window.getClientHeight();

    boolean tViz = ( e.getAbsoluteTop() >= 0 && e.getAbsoluteTop()<  vpHeight);
    boolean bViz = (e.getAbsoluteBottom() >  0 && e.getAbsoluteBottom() <= vpHeight);
    boolean lViz = (e.getAbsoluteLeft() >= 0 && e.getAbsoluteLeft() < vpWidth);
    boolean rViz = (e.getAbsoluteRight()  >  0 && e.getAbsoluteRight()  <= vpWidth);

    boolean vVisible   = tViz && bViz;
    boolean hVisible   = lViz && rViz;

    return hVisible && vVisible;
} 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2015-05-04T21:39:42.660

检查元素是否在屏幕上，而不是接受答案的方法来检查 div 是否完全在屏幕上（如果 div 比屏幕大，这将不起作用）。在纯 Javascript 中：

```
/**
 * Checks if element is on the screen (Y axis only), returning true
 * even if the element is only partially on screen.
 *
 * @param element
 * @returns {boolean}
 */
function isOnScreenY(element) {
    var screen_top_position = window.scrollY;
    var screen_bottom_position = screen_top_position + window.innerHeight;

    var element_top_position = element.offsetTop;
    var element_bottom_position = element_top_position + element.offsetHeight;

    return (inRange(element_top_position, screen_top_position, screen_bottom_position)
    || inRange(element_bottom_position, screen_top_position, screen_bottom_position));
}

/**
 * Checks if x is in range (in-between) the
 * value of a and b (in that order). Also returns true
 * if equal to either value.
 *
 * @param x
 * @param a
 * @param b
 * @returns {boolean}
 */
function inRange(x, a, b) {
    return (x >= a && x <= b);
} 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2016-06-14T11:04:16.283

制作了一个简单的插件来检测元素是否在可滚动容器中可见

```
 $.fn.isVisible = function(){

      var win;
      if(!arguments[0])
      {
        console.error('Specify a target;');
        return false;
      }
      else
      {
        win = $(arguments[0]);
      }
      var viewport = {};
      var bounds = this.offset();
      bounds.right = bounds.left + this.outerWidth();
      bounds.bottom = bounds.top + this.outerHeight();
      viewport.bottom = win.height() + win.offset().top;
      return (!( bounds.top > viewport.bottom) && (win.offset().top < bounds.bottom));
    }; 
```

像这样称呼它`$('elem_to_check').isVisible('scrollable_container');`

希望它会有所帮助。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2020-05-07T20:10:29.017

jquery scrollspy 插件可以让你轻松做到这一点。 [https://github.com/thesmart/jquery-scrollspy](https://github.com/thesmart/jquery-scrollspy)

```
$('.tile').on('scrollSpy:enter', function() {
    console.log('enter:', $(this).attr('id'));
});

$('.tile').on('scrollSpy:exit', function() {
    console.log('exit:', $(this).attr('id'));
});

$('.tile').scrollSpy(); 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2021-04-19T12:44:53.383

唯一对我有用的解决方案是（当 $("#elementToCheck") 可见时返回 true）：

$(document).scrollTop()+window.innerHeight+$("#elementToCheck").height()>$("#elementToCheck").offset().top

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2022-01-15T17:50:50.247

其他答案通常不检查元素是否沿 X 轴在视图中，即可能在当前视口 Y 范围内，但在 X 范围之外。如果项目的任何部分显示在视口中，此函数会检查 X 和 Y：

```
function checkElInView(el) {
    if (!el || !typeof el.getBoundingClientRect === "function") return false;
    const r = el.getBoundingClientRect();
    const vw = document.documentElement.clientWidth;
    const vh = document.documentElement.clientHeight;
    const inViewX = (r.left > 0 && r.left < vw) || (r.right < vw && r.right > 0);
    const inViewY = (r.top > 0 && r.top < vh) || (r.bottom < vh && r.bottom > 0);
    return inViewX && inViewY;
} 
```

* * *

## 回答 #45

> 赞同：-1
> 
> 时间：2017-05-30T19:31:11.570

仅限 Javascript :)

```
function isInViewport(element) {
  var rect = element.getBoundingClientRect();
  var html = document.documentElement;
  return (
    rect.top >= 0 &&
    rect.left >= 0 &&
    rect.bottom <= (window.innerHeight || html.clientHeight) &&
    rect.right <= (window.innerWidth || html.clientWidth)
  );
} 
```

* * *

## 回答 #46

> 赞同：-1
> 
> 时间：2017-08-21T08:53:27.277

在无效率地跑来跑去并使用了几个不起作用的代码之后。这就是使用 Jquery 在垂直滚动可见性方面对我有用的方法。将“#footerplace”替换为您要垂直跟踪的元素。

```
jQuery.expr.filters.offscreen = function(el) {
  var rect = el.getBoundingClientRect();
  console.log(rect)
  console.log('window height', $(window).height());

  return (
           (rect.top <= $(window).height()) && (rect.bottom <= $(window).height())
         );
};
$(document).scroll(function(){
    if ($('#footerplace').is(':offscreen')){
      console.log('this is true');
    $('#footerplace').is(':offscreen');
    } else {
     console.log('this is false');
    $('#footerplace').is(':offscreen');

    } 
```

# javascript - 连接来自不同来源的 javascript 文件并将它们作为一个文件加载总是安全的吗？

> ID：487074
> 
> 赞同：3
> 
> 时间：2009-01-28T10:00:55.353
> 
> 标签：javascript

我想将[javascript 文件连接在一起](https://stackoverflow.com/questions/486063/what-clever-things-have-you-done-with-an-asp-net-mvc-action-method)，并将它们作为我的站点中的一个提供 - 这就是我的代码和 jquery 插件或其他 3rd 方脚本。（我使用 google CDN 来托管 jQuery）。

我想知道我**总是**保证这是一件安全的事情。就命名空间之类的事情而言，我不是 Javascript 专家，我只是有点担心可能会有一些东西——比如可能导致冲突的命名空间构造。我很好地假设每个来源的 javascript 都是正确的。

据我所知，`<script>`标签基本上只是将 JS 固定在适当的位置，就好像它在文件中一样，但我想知道是否存在任何边界情况，这不是真的。

我知道文件的连接是常见的，并且被[雅虎 YUI](http://developer.yahoo.com/yui/articles/hosting/?layout#configure)等 javascript 框架使用- 但显然他们可以完全控制他们的文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T11:37:08.620

您可能会遇到分号周围的语法错误。

档案一：

```
var foo = 3 // END OF FILE 
```

文件 B：

```
var bar = 4 // BEGINNING OF FILE 
```

文件 A+B：

```
var foo = 3var bar = 4 
```

只需在要连接的每个文件之间插入一个分号即可轻松解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T11:30:23.457

我不得不同意 krosenvold 的观点，我没有理由认为它不应该起作用。只要确保您注意您的全局变量和函数名称，如果您从多个非协作来源获取脚本，它们可能会导致问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T10:14:35.713

只要您以正确的顺序连接它们，您就应该是安全的。正确的顺序与您今天加载它们的顺序相同。

# mysql - 从 MySQL 获取数据库到 SQLite

> ID：487079
> 
> 赞同：0
> 
> 时间：2009-01-28T10:02:43.740
> 
> 标签：mysql, ios, sqlite, cocos2d-iphone

我正在尝试完成一个 iPhone 应用程序。为此，我需要将数据库从 MySQL 获取到 SQLite。对于这种情况，我确实使用了如下代码-

```
MCPConnection *theConnec;
MCPResult *theRes;
//initialize connection string vars
NSString *dbURL = @"XXXXXX";
NSString *userName = @"XXXXXX";
NSString *pass = @"XXXXXX";
//open connection to database
theConnec = [theConnec initToHost:dbURL withLogin:userName password:pass usingPort:3306];
//NSLog(@"The connection to database was successfull");
[theConnec selectDB:@"XXXXXX"];
//{
// NSLog(@"Database found");
//}
//else
//{
// NSLog(@"Database not found");
//}
theRes = [theConnec queryString:@"select * from seahawk_tag"];
//get the number of rows
NSInteger numberOfRows = [theRes numofRows];
NSLog(@"Query of MySQL Database %@", numberOfRows);
return NSApplicationMain(argc, (const char **) argv);
[theConnec release]; 
```

但是这段代码不能正常工作。这里还提到我使用了一些框架，如 cocoa.framework、cocos2d、openGLES.framework、openAL.framework、APPKit.framework、MCPKit.framework、Quartzcore.framewrok。最后我收到一个错误消息，表明 CIColer.h 丢失。

朋友，如果您知道解决方案或者您有其他代码，请帮助我

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-16T04:18:42.917

您是在问如何轮询远程数据库，还是如何预导出？

轮询远程数据库和导入数据***应该***像打开远程数据库的套接字、执行查询并再次关闭一样简单。

# sql - MySQL 4.0 查询帮助双连接代替子查询

> ID：487082
> 
> 赞同：0
> 
> 时间：2009-01-28T10:03:13.770
> 
> 标签：sql, select, join, limit

从用户、组、u2g 中选择 u.user、g.group、u2g.something，其中 users.u = u2g.u 和 groups.g = u2g.g

返回如下数据：

```
user, group, something
----------------------
1   , 3,     a
1   , 5,     b
2   , 3,     c
3   , 3,     d
4   , 5,     e 
```

现在我想限制这个查询，使其只显示第 3 组和第 5 组中的用户**-**所以它只会返回 {1,3, a} , {1,5, b} 用于我的示例数据.

编辑：我在数据中添加了另一列，因为使用 group by 可能存在不正确的解决方案。

edit2：对不起，我被文档误导了。MySQL 4.0 不支持子查询 :(

编辑 3：此 SQL 将以编程方式为任意数量的组生成（嗯，在当前规范中最多 20 个），所以我想避免给我太多额外编码的解决方案。如果找不到解决方案，我将只修改生成的 .Net 1.1 DataTable，但如果可能的话，我想避免这种情况。

编辑4：有什么新想法吗？也许一个没有包含 IN (3,5) 的子查询？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T10:16:33.883

```
select u.user, g.group, u2g.something 
from users u, groups g, u2g 
where u.user = u2g.user and g.group = u2g.group 
    where exists 
     (select 1 
         from u2g u2g2 
        where u2g2.user=u.user and u2g2.group in(3,5)) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T10:34:32.430

这些方面的东西？

```
select u.[user], g.group
from     u
    inner join ug on ug.userid = u.id   
    inner join g on g.id = ug.groupid
    inner join 
    (
        select ug.userid
        from ug
        where ug.groupid in (1,2)
        group by ug.userid
        having count(*) = 2
    ) sub on sub.userid = u.id 
```

-Edoode

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T10:45:13.327

使用带有 groups-table 的双重联接将为您提供正确的结果：

```
  选择 u.user, u2g.something
  来自用户
  内部联接 u2g ON users.u = u2g.u
  u2g.g = g1.g 和 g1.group = 3 上的内部连接组 g1
  INNER JOIN 组 g2 ON u2g.g = g2.g AND g2.group = 5
  /* 尝试两行，每组一个 */
  u2g.g = groups.g 上的 INNER JOIN 组

```

但是，这并不完全符合您的要求，即您需要两行，每组一行。这只会给你一行，你可能可以再次加入它与组，从而呈现两行。

另一个示例（如果您选择使用与映射相同的 groupID）：

```
选择 u.uID，gm.something
FROM cdcms_users 你
内部连接 ​​cdcms_group_memberships gm1 on gm1.uID = u.uID AND gm1.gID = 32
内部连接 ​​cdcms_group_memberships gm2 on gm2.uID = u.uID AND gm2.gID = 33

```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T11:52:31.447

相当可怕的非通用解决方案，导致 Oracle 中出现两行：

```
 select users.u, groups.g
    from   users , groups, u2g, groups g2, u2g u2g2
    where  users.u = u2g.u 
           and users.u = u2g2.u
           and groups.g = u2g.g
           and g2.g = u2g2.g
           and (groups.g in (3,5) and g2.g in (3,5) and groups.g <> g2.g)
           ; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T23:16:21.340

为什么`groups`在查询中使用？其唯一访问的字段 ( `g`) 存在于`u2g`. 我想你可能也想从那里带回一大堆东西。

为了在不使用子查询的情况下获得您描述的那种结果集，您最终会遇到一团糟：查询文本的二次爆炸！

你需要以下形式的东西：

```
select users.u, groups.g, u2g0.something
from users u, groups g, u2g u2g0, u2g u2g1
where groups.g = 3
     and users.u = u2g0.u
     and u2g0.g = 3
     and users.u = u2g1.u
     and u2g1.g = 5
union all
select users.u, groups.g, u2g1.something
from users u, groups g, u2g u2g0, u2g u2g1
where groups.g = 5
     and users.u = u2g0.u
     and u2g0.g = 3
     and users.u = u2g1.u
     and u2g1.g = 5 
```

由于这是一个以编程方式生成的查询，因此我将在此处使用类似网页脚本的符号来描述查询构造。我还将做出轻率和毫无根据的简化假设，即组标识符不是潜在的 SQL 注入攻击向量。:-)

```
<% for(int i = 0; i < requiredGroups.Length; i++) { %>
  <% if(i > 0) { %>
    union all
  <% } %>
select users.u, groups.g, u2g<%=i%>.something
from users u, groups g
  <% for(int j = 0; j < requiredGroups.Length; j++) { %>
     , u2g u2g<%=j%>
  <% } %>
where groups.g = <%=requiredGroups[i]%>
  <% for(int j = 0; j < requiredGroups.Length; j++) { %>
     and users.u = u2g<%=j%>.u
     and u2g<%=j>.g = <%=requiredGroups[j]%>
  <% } %>
<% } %> 
```

# linux - linux/shell脚本

> ID：487085
> 
> 赞同：1
> 
> 时间：2009-01-28T10:04:27.093
> 
> 标签：linux

我编写了一个程序，它为 2 个变量生成参数索引。说，a 和 b 以 5 为步长。像这样我必须为 23 个变量做。所以我不想写 23 个 for 循环来运行，我怎样才能把它变成一个对所有 23 个变量都通用的 for 循环。我希望它可以用一个数组来完成，但我不知道如何通过程序来实现它。请你帮助我好吗？

程序：

```
int z, p
float a, b
float  a0, an, s, a1, b0, bn, b1
str var
s=5; a0=1; an=10; b0=8; bn=13     // s= steps, a0, b0= initial  value, an,bn=final value
z=0

a1=(an-a0)/s
b1=(bn-b0)/s

for (a=(a1+a0);a<=an;a=a+a1)   
for (b=(b1+b0);b<=bn;b=b+b1)
echo {z} {a} {b}  -format "%25s" >> /home/genesis/genesis-2.3/genesis/Scripts/kinetikit/dhanu19.txt
z=z+1
end
end

output : dhanu19.txt
                        0                      2.8                        9
                        1                      2.8                       10
                        2                      2.8                       11
                        3                      2.8                       12
                        4                      2.8                       13
                        5                      4.6                        9
                        6                      4.6                       10
                        7                      4.6                       11
                        8                      4.6                       12
                        9                      4.6                       13
                       10                      6.4                        9
                       11                      6.4                       10
                       12                      6.4                       11
                       13                      6.4                       12
                       14                      6.4                       13
                       15                      8.2                        9
                       16                      8.2                       10
                       17                      8.2                       11
                       18                      8.2                       12
                       19                      8.2                       13
                       20                       10                        9
                       21                       10                       10
                       22                       10                       11
                       23                       10                       12
                       24                       10                       13 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T10:23:45.367

您是否考虑过编写脚本或程序来为您编写脚本？生成 shell 脚本，然后运行它们有时可以成为解决问题的有效方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T10:09:48.923

你指的是哪个壳牌？声明数组在 zsh、bash 等之间有一些语法差异......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T10:54:23.030

假设您编写了 23 for 循环。如果每个循环有 5 个步骤，您将得到 5^23 参数！

假设每个循环输出 1 个字节，您仍然需要存储 10^16 个字节或一万兆字节。我认为您应该重新考虑您的问题，或重新提出您的问题

编辑：这不是一个论坛（你可以在论坛中编辑你的帖子）。请编辑您的问题而不是发布新答案，我认为这很有趣

# ruby - 从命令行运行 Ruby 库

> ID：487086
> 
> 赞同：16
> 
> 时间：2009-01-28T10:04:37.123
> 
> 标签：ruby, command-line

在对 Python 非常满意几年后，我刚刚学习了 Ruby 的基础知识（我仍在使用 Python 做一些事情），但我想知道是否有成语或 hack 来解决这个特殊问题。

我有一个我希望能够使用的 Ruby 脚本`require script_name`，但我也希望能够`ruby script_name.rb`从终端运行并将它作为命令行脚本运行。在 Python 中，这将通过在脚本底部具有以下结构来完成：

```
if __name__ == '__main__':
    # do something here 
```

但是，我似乎无法在 Ruby 中找到等价物。有没有办法检测当前脚本是否正在从命令行运行？也许某种`Kernel::`方法或什么？理想情况下，我想要的是脚本底部的类似内容：

```
if from_command_line?
  # do something here
end 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-28T10:20:38.027

你想使用：

```
if __FILE__ == $0
  # do stuff
end 
```

`__FILE__`是源文件名，`$0`是当前正在执行的脚本的名称。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-28T10:18:44.910

您可以在 ruby​​ 中找到类似的功能。

> **__FILE__**当前源文件名。
> 
> **$0**包含正在执行的脚本的名称。可能是可分配的。

来源：[Ruby 快速参考](http://www.zenspider.com/Languages/Ruby/QuickRef.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-06-23T08:10:16.923

尽管

```
if __FILE__ == $0
  Foo.run
end 
```

是常用的方法，我目前正在使用

```
if File.identical?(__FILE__, $0)
  Foo.run
end 
```

因为像 ruby​​-prof 这样的程序[即使](https://stackoverflow.com/questions/5335942/is-there-a-better-way-to-make-ruby-profs-replace-progname-work-properly) `__FILE__`在你使用`--replace-progname`.

# svn - Delphi 开发人员的 SVN

> ID：487090
> 
> 赞同：5
> 
> 时间：2009-01-28T10:06:43.203
> 
> 标签：svn, delphi, version-control, tortoisesvn

我之前发布了一个问题，[Moving away from VSS](https://stackoverflow.com/questions/225115/delphi-moving-away-from-vss)，其中我询问了使用 VSS 的 Delphi 开发人员的最佳 VCS 控件。大多数开发人员似乎将 svn 与 TortoiseSVN 一起使用。我尝试了几天，我认为这是最好的路线。

但是，我仍然对 svn 的工作方式有些困惑，所以这里有一些我想回答的问题：

1.  我可以使用 vss 使用的旧锁定方式（checkout-modify-checkin）吗？

2.  Delphi 表单有两个文件（MyForm.pas、MyForm.dfm）。当我向表单添加任何控件时，两个文件都将被修改，因此我想提交“myform.pas”并同时提交“myform.dfm”。我在这里错过了什么吗？

3.  这同样适用于 Delphi 项目文件。因为这与其他文件链接，所以当我更改项目文件时，它们都应该被提交。

4.  您在 TSVN 中将哪些文件标记为忽略，因此 TSVN 不会查找这些文件，例如（*.dcu、* .exe、...），我可以将其从一台 PC 导出到另一台吗？

我现在必须改变我在 vss 样式中的思考方式，并且需要将其更改为 SVN 样式，但是使用 vss，所有东西都在 IDE 中进行管理，这太棒了;-)。

**更新：**

5.如果我提交了Delphi表单(.pas & dfm)，发现有人之前已经更新过版本，如果在该表单和单元中添加了一些新的控件和事件，你如何解决冲突(这需要使用svn的Delphi开发人员）。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-28T10:17:03.743

1.  是的，您仍然可以锁定文件，但不建议这样做。您必须在所有可能要锁定的文件上设置 svn:needs-lock 属性，以便在您签出时设置只读标志。但同样，这不是文本文件的推荐工作流程。试试修改合并工作流程吧！
2.  由于您使用的是 TortoiseSVN：右键单击您的父文件夹，选择“提交”。在提交对话框中，您将看到所有需要提交的文件。只需检查 myform.pas 和 myform.dfm 文件的提交即可。所有检查的文件将一起提交，无需（绝对不推荐！）单独提交每个文件！
3.  见 2。 - 但是你应该先阅读精彩的[Subversion 书](http://svnbook.red-bean.com/)来熟悉这个概念。您应该始终提交属于逻辑更改的所有文件。例如，如果您向表单添加新控件并实现处理它的代码，您可能不仅修改了表单文件，而且还修改了多个文件。始终将所有这些文件一起提交，因为提交是一个逻辑实体。
4.  您不必“导出”忽略设置。只需添加 svn:ignored 属性。[如文档](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-ignore.html)中所述，使用 TortoiseSVN 很容易做到这一点。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-28T10:27:59.370

回复 5.: 你应该试试看。为了限制潜在的冲突，积极的开发人员经常提交是一个非常好的主意，而所有其他人也经常从 SVN 更新。设置电子邮件提交通知可以提供很大帮助，以便所有人都知道何时更新。但是话虽如此 - 您会发现删除控件及其所有事件处理程序或添加控件和一些处理程序的简单行为不会导致您需要手动解决的冲突。

**编辑：** [DiGi 的这个答案](https://stackoverflow.com/questions/487090/svn-for-delphi-developers#487208)表明即使用户没有修改 DFM，Delphi 也会修改。这不是真正的 IMO，因为 DFM 时间戳的简单更改不符合对 DFM 文件的本地修改，并且 SVN 不会提交新修订。然而，必须小心不要在 Delphi IDE 中移动表单，因为这会改变表单的 Top 和/或 Left 属性。同样，更改页面控件的活动页面将被视为本地修改。因此，在提交之前检查所有本地修改是一个好主意，并恢复所有那些仅仅是偶然的。

**编辑2：**正如onnodb在他的评论中指出的那样，表单的属性似乎确实是自动修改的，至少在Delphi 2007（可能以后？）。这将强调在提交之前检查所有本地修改的重要性。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-28T10:45:20.287

另请参阅[如何开始使用 Sub-Version + Delphi？](https://stackoverflow.com/questions/370518/how-do-i-start-with-working-sub-version-delphi)对于一些也集成到 Delphi IDE 中的 SVN 工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T10:16:51.233

1.  是的。

2.  当您提交时，TortoiseSVN 会自动将所有修改过的文件标记在版本控制之下。

3.  见 2。

4.  创建一个忽略列表非常容易。只需右键单击一个文件，您就可以选择忽略该文件类型的所有文件。

如果您使用的是 Visual Studio，则可以使用[Ankh SVN](http://ankhsvn.open.collab.net/)进行 IDE 集成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-28T10:45:57.210

开发人员可以使用[CommitMonitor](http://tools.tortoisesvn.net/CommitMonitor)接收有关新提交的信息。

广告 5：如果两个或多个开发人员使用相同的 .dfm，那就不好了。简单的修改可以正常工作（合并）。仅当您确实在文件中有所不同时，才提交很重要。Delphi 通常会修改 .dfm，即使您不做任何更改。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T12:54:51.693

我通常在从 SVN 更新之前使用这个小 Python 脚本，以清理我的源代码树。

我将`.dof`文件存储在 SVN 中，因此我需要`.dof`在清理源代码树之前手动提交任何更改。

```
import os
import sys

exts = ['.~pas', '.~dpk', '.~bpl','.dcu', '.~dcu', '.dcp', '.~dcp',
        '.dof', '.cfg', '.res', '.~res']

def mydir():
    if __name__ == '__main__':
        filename = sys.argv[0]
    else:
        filename = __file__
    return os.path.abspath(os.path.dirname(filename))

def clean_dir(arg, dirname, names):
    for name in names:
      if os.path.splitext(name)[1].lower() in exts:
        file2delete = os.path.join(dirname,name)
        print os.path.join(file2delete)
        os.remove(file2delete)

if __name__=="__main__":
  print "Cleaning Tree"
  os.path.walk(mydir(), clean_dir, "a") 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-30T08:26:49.840

对我来说，DFM 文件不会自行更改。

我不确定其他人对他们的 dfm 文件做了什么，或者 Delphi 中的哪些设置可能会导致这种情况。我没有问题。只有我更改的 dfm 文件会在“提交”对话框中列出（已更改）。我正在使用 Delphi 2007 和 Delphi 7。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-10-14T14:35:32.367

下面是我们看到的 DFM 文件行为： * 无论所讨论的 Delphi 版本如何，IDE 都喜欢提示开发人员“保存”表单，即使 PAS 级别的 DFM 级别没有发生真正的更改。示例：开发人员在 IDE 中稍微重新定位了 formX 的设计窗口，但没有对 formX 做任何其他事情。在 VSS 下，文件上的只读属性充当警察——确保没有“非更改更改”成为签入的候选对象。* 在 D2006 下，以及可能在 D2007 和 D2009 等同类 IDE 下，根据我们的经验，对于坐在 WinVista 或 Win7 机器上的开发人员来说，情况更糟。在设计模式下，表单的某些操作将“移动”底层 DFM 中的像素值。并移动足够小的值 (2,6)，开发人员可能不会注意到。面板和滚动框似乎特别容易受到攻击。所有这一切都没有开发商的意图。在 VSS 时代，这是一个小麻烦，因为只有明确签出的 DFM 在“转移”方面存在风险。在 SVN/Tortoise 下，这个问题越来越严重，因为没有只读属性保护文件。是的，是的，最终是开发人员负责在签入时在 DFM as-text 级别仔细检查更改的内容。但这很麻烦，增加了开发周期的开销，我们当然希望不是这样。有趣的是，这种“转变”确实不会发生在 WinXP 工作站上。为什么这很重要，对于 SVN/Tortoise 社区。任何匆忙签入 DFM 的人，无论出于何种原因，都有可能让“转变”接管其 UI 的有效命令。并让人怀念暴力 VSS 只读属性；甚至考虑使用上面提到的 svn:needs-lock 属性。小姐，我有一些解决方案要提供，但到目前为止，我们发现自己只有变量，并且正在规划如何通过我们的 SVN/Tortoise 实现最小化 DFM 问题。仅供参考，目前我们没有看到 Embarcedero 发布关于“转变”症状的帖子。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-28T11:59:04.817

你可以给我们[SourceConexion](http://www.epocalipse.com/scx.htm)。它集成在 Delphi IDE 中。它支持锁定文件，这样您就不会在处理 DFM 文件时遇到麻烦。

我在使用 C# 时使用 TortoiseSVN，但在 Delpi 中，我发现使用 SC 很好，因为在一个以上的开发人员对它们进行更改后，我最终得到了损坏的 DFM 文件。

# c# - 为了可测试性，向 ComboBox 添加功能的正确方法是什么？

> ID：487100
> 
> 赞同：2
> 
> 时间：2009-01-28T10:10:02.493
> 
> 标签：c#, .net, winforms, unit-testing, testability

“增强”组合框的所需功能是一种快速查找方法。组合框中的每个项目都有一个 ToString() 方法，以便它们可以显示在下拉列表中。单击下拉列表中的项目时，组合框的观察者会收到选择通知。

此外，每次组合框中输入的文本发生变化时，都会生成一个“候选人”列表，该列表由下拉列表中包含迄今为止输入的文本的所有项目组成。按 Enter 会将您带到该列表中的第一个候选人，反复按 Enter 循环您通过列表。

我已经通过从 ComboBox 派生来实现了这个功能——我认为这是有道理的，因为我仍然在功能上留下了一个组合框，它只是添加了这个“快速查找”功能。但是，创建候选列表并循环遍历它的逻辑虽然简单，但并非完全不重要，并且会进行一些测试。

然而，正如[这里](https://stackoverflow.com/questions/479587/testing-custom-control-derived-from-combobox)所看到的，仅仅通过构建它并刺激我添加的额外例程来测试 ComboBox 似乎并不那么容易 - 它需要存在于一个表单中，以便它的行为方式与它相同在应用程序中。测试一个简单的组合框的简单添加似乎太费力了！

但是，循环遍历候选对象的代码中没有任何内容特定于我的应用程序 - 我创建了一个可以在任意数量的上下文中使用的通用控件，唯一的要求是组合框中的对象具有 ToString() 方法，它无论如何，对进入普通组合框的对象施加的限制相同，并且由 C# .NET 保证。

那么，考虑到可测试性，您会将增强的功能放在哪里？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T10:17:26.567

与您引用的帖子一样：将逻辑与 gui 元素分开也是这里的解决方案。

您应该考虑使用类似控制器的类，该类公开您可以将其数据绑定到您的 ComboBox 数据源的项目列表。控制器本身负责维护这个列表。

因此，每当您在 ComboBox 中键入一个字母时，您就会调用控制器上的一个函数，比如 UpdateList(string typedString)。通过这种方式，您已经分离了用“候选人”填充列表的逻辑。

现在您可以轻松编写多个测试，每个测试使用不同的参数调用 UpdateList()，然后检查项目列表。进行测试不需要 GUI 的东西，你只是在测试算法本身。

# java - Java：四舍五入到任意值

> ID：487107
> 
> 赞同：5
> 
> 时间：2009-01-28T10:12:56.310
> 
> 标签：java, math, rounding

在 Java 中，如何舍入到任意值？具体来说，我想四舍五入到 0.0025 步，即：

0.032611 -> 0.0325

0.034143 -> 0.0350

0.035233 -> 0.0350

0.037777 -> 0.0375

...

任何想法或库？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-28T10:16:56.007

```
y = Math.round(x / 0.0025) * 0.0025 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T10:18:04.880

你可以这样做：

```
double step = 0.0025;
double rounded = ((int)(unrounded / step + 0.5)) * step; 
```

# c++ - 如何抑制 g++ 中的特定警告

> ID：487108
> 
> 赞同：36
> 
> 时间：2009-01-28T10:13:30.460
> 
> 标签：c++, gcc, g++

我想禁止来自 g++ 的特定警告。我知道这个`-Wno-XXX`标志，但我正在寻找更具体的东西。我想要**一些**警告`-Weffc++`，但不是**全部**。类似于您可以使用 lint 执行的操作 - 禁用特定消息。

gcc 中是否有内置方法来执行此操作？我必须编写包装脚本吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-28T12:55:58.633

~~不幸的是，这个特性不是由 g++ 提供的。~~在 VC++ 中，您可以使用[#pragma warning](http://msdn.microsoft.com/en-us/library/2c8f766e(VS.80).aspx)来禁用某些特定的警告。在 gcc 中，您可以拥有的最接近的是[diagnostic pragmas](http://gcc.gnu.org/onlinedocs/gcc/Diagnostic-Pragmas.html)，它允许您为某些文件或项目启用/禁用某些类型的诊断。

*编辑*：GCC 自 4.6.4 起支持推送/弹出警告（请参阅[更改日志](https://gcc.gnu.org/gcc-4.6/changes.html)）

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-28T13:00:37.360

对于某些警告，有一个命令行开关可以禁用它们。为了知道使用哪个开关，传递`-fdiagnostics-show-option`给 gcc。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T15:26:53.120

您可以在输出上使用***grep -v***。

根据您希望禁用的警告，您有时可以在代码中进行更正。例如：

```
int main()
{
  int i;
} 
```

*生成：* foo.cc:4：警告：未使用的变量“i”

而这不是：

```
#define MARKUSED(X)  ((void)(&(X)))

int main()
{
  int i;
  MARKUSED(i);
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-03-09T23:03:32.377

将标准错误传递给过滤器，以删除您不想看到的内容。例如，这是我的 make 文件：

```
main.o:  main.cpp
    g++ -c -Wall main.cpp 2>&1 | grep -v Wunused-variable 
```

# c++ - C/C++ 头文件文档

> ID：487114
> 
> 赞同：19
> 
> 时间：2009-01-28T10:15:19.503
> 
> 标签：c++, c, documentation, javadoc

在 C++ 中创建公共头文件时，您认为最佳实践是什么？

1.  头文件应该不包含、简短或大量的文档吗？我已经看到了从几乎没有文档（依赖于一些外部文档）到不变量、有效参数、返回值等的大型规范的所有内容。我不确定我到底喜欢什么，大型文档很好，因为你总是可以访问它来自您的编辑器，另一方面，带有非常简短文档的头文件通常可以在一两页文本上显示完整的界面，从而更好地概述类可以做什么。

2.  假设我使用简短或大量文档之类的东西。我想要类似于 javadoc 的东西，我在其中记录返回值、参数等。c++ 中最好的约定是什么？据我所知，doxygen 在 java doc 样式文档方面做得很好，但是在使用 javadoc 样式文档之前我应该​​了解其他任何约定和工具吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-01-28T10:27:17.577

通常我将接口的文档（参数、返回值、*函数*的作用）放在接口文件（.h）中，将实现的文档（函数*如何*做）放在实现文件（.c、.cpp、 .m)。

我在声明之前写了一个类的概述，所以读者可以立即获得基本信息。

我使用的工具是 Doxygen。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-28T10:26:44.940

1.  我肯定会在头文件本身中有一些文档。它极大地改进了调试，将信息放在代码旁边，而不是在单独的文档中。根据经验，我会在代码旁边记录 API（返回值、参数、状态更改等），并在单独的文档中记录高级架构概述（以更广泛地了解所有内容是如何组合在一起的；它是很难将它与代码放在一起，因为它通常一次引用多个类）。

2.  根据我的经验，Doxygen 很好。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-28T19:57:06.630

我相信 Doxygen 是最常用的生成文档的平台，据我所知，它或多或少能够涵盖 JavaDoc-notation（当然不限于）。我已经将 doxygen 用于 C，结果还不错，但我确实认为它更适合 C++。您可能还想研究 robodoc，尽管我认为奥卡姆剃刀会告诉您宁愿选择 Doxygen。

关于有多少文档，我自己从来都不是文档迷，但无论我喜欢与否，拥有更多文档总是胜过没有文档。我会将 API 文档放在头文件中，并将实现文档放在实现中（按道理说，不是吗？）。:) 这样一来，IDE 就有机会在自动完成过程中提取并显示它（例如，Eclipse 为 JavaDocs 执行此操作，也许也为 doxygen 执行此操作？），这不应被低估。JavaDoc 有一个额外的怪癖，它使用第一句（即直到第一个句号）作为简要描述，虽然不知道 Doxygen 是否这样做，但如果是这样，在编写文档时应该考虑到这一点。

拥有大量文档存在过时的风险，但是，将文档保持在代码附近将使人们有机会使其保持最新，因此您绝对应该将其保存在源/头文件中。不应该忘记的是文档的制作。是的，有些人会直接使用文档（通过 IDE 或其他方式，或者只是阅读头文件），但有些人更喜欢其他方式，因此您可能应该考虑将您的（定期更新的）API 文档放在网上，所有这些都很好且可浏览，以及如果您的目标是基于 *nix 的开发人员，可能还会生成 man 文件。

那是我的两分钱。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-28T10:27:12.787

将足够多的代码放入可以独立运行的代码中。几乎我参与过的每个项目的文档都是单独的，它已经过时或没有完成，部分原因是如果它是一个单独的文档，它就会成为一个单独的任务，部分是因为管理层不允许它作为一项任务在预算中。根据我的经验，将内联文档作为流程的一部分效果更好。

以大多数编辑认为是块的形式编写文档；对于 C++，这似乎是 /* 而不是 //。这样你就可以折叠它，只看到声明。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-28T16:46:48.527

也许您会对[gtk-doc](http://www.gtk.org/gtk-doc/)感兴趣。它可能“设置和使用有点尴尬”，但您可以从源代码中获得一个不错的 API 文档，如下所示：

[字符串实用函数](http://library.gnome.org/devel/glib/stable/glib-String-Utility-Functions.html)

# string - 存储字符串的数据结构？

> ID：487115
> 
> 赞同：4
> 
> 时间：2009-01-28T10:15:41.437
> 
> 标签：string, data-structures

我正在寻找一种数据结构来存储字符串。我需要接口中的一个函数，该函数将字符串作为其唯一参数并返回一个引用/迭代器/指针/句柄，该引用/迭代器/指针/句柄可用于检索其余字符串数据结构的生命周期。不需要设置成员资格、条目删除等。

我更关心内存使用而不是速度。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-28T11:45:02.567

[Trie](http://www.answers.com/topic/trie)是一种用于存储字符串的高效数据结构。这通过使用相同的内存存储具有公共前缀的字符串来节省内存和时间。

![替代文字](https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Trie_example.svg/250px-Trie_example.svg.png)

您可以使用作为指针返回 Trie 中字符串的最终标记，它唯一地标识字符串，并且可以用于通过向上遍历 Trie 来重新创建字符串。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T11:05:29.700

我认为这里的关键字是[string interning](http://en.wikipedia.org/wiki/String_intern_pool)，您只存储每个不同字符串的一个副本。在 Java 中，这是通过以下方式完成的[`String.intern()`](http://java.sun.com/javase/6/docs/api/java/lang/String.html#intern())：

```
String ref1 = "hello world".intern();
String ref2 = "HELLO WORLD".toLowerCase().intern();
assert ref1 == ref2; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T10:25:04.477

我认为这里最好的选择是[ArrayList](http://en.wikipedia.org/wiki/Dynamic_array)。常见的实现在为新元素分配数组中的额外空间时会产生一些开销，但如果内存是这样的要求，您可以为每个新元素手动分配。它会更慢，但只会为字符串使用必要的内存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-31T20:47:28.227

存储字符串的三种方式：

1.  固定长度（数组类型结构）
2.  可变长度但最大大小在运行期间是固定的（指针类型结构）
3.  链表结构

# java - 在 Java 中使用匿名类被认为是不好的风格还是好的？

> ID：487126
> 
> 赞同：38
> 
> 时间：2009-01-28T10:17:32.167
> 
> 标签：java, coding-style, anonymous-class

我知道匿名类在实现监听器和类似的东西时可以节省打字。它们试图替代闭包的某些用法。

但是社区如何看待这种语言特性的价值？它有意义吗？您是否经常使用它？它是否使代码更清晰、更易于理解和更易于维护？还是匿名类会降低代码的可读性？

您的意见是什么，请提供方便的示例/论据来支持您的意见？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-28T10:30:56.710

在不需要为了执行某些任务而拥有一个成熟的类的情况下，我倾向于使用匿名内部类。例如，如果我想实现`ActionListener`or `Runnable`，但我认为没有必要使用内部类。例如，对于启动一个简单的`Thread`，使用匿名内部类可能更具可读性：

```
public void someMethod()
{
    new Thread(new Runnable() {
        public void run()
        {
            // do stuff
        }
    }).start();
} 
```

在某些情况下，例如上面的示例，它可以增加可读性，特别是对于一次性任务，因为要执行的代码都写在一个地方。使用内部类会“离域”代码：

```
public void someMethod()
{
    new Thread(new MyRunnable()).start();
}

// ... several methods down ... //

class MyRunnable implements Runnable
{
    public void run()
    {
        // do stuff
    }
} 
```

尽管如此，如果要重复相同的事情，它确实应该是一个单独的类，无论是普通类还是内部类。

我倾向于在我只是尝试的程序中使用匿名内部类，而不是将其作为实际应用程序的核心功能。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-06-07T09:03:57.100

匿名内部类的另一个好用处是当您需要初始化像 ArrayList 和 Set 这样的集合时。这种做法也称为**双括号初始化** ，例如，

```
private static final Set<String> VALID_CODES = new HashSet<String>() {{
add("XZ13s");
add("AB21/X");
add("YYLEX");
add("AR2D");
}}; 
```

显然，这不仅限于收藏；它可用于初始化任何类型的对象——例如 Gui 对象：

```
 add(new JPanel() {{
setLayout(...);
setBorder(...);
add(new JLabel(...));
add(new JSpinner(...));
}}); 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-28T11:23:11.300

我的观点是匿名类使代码的可读性降低。对于实现侦听器，匿名类很有用。对于开发[GWT](http://en.wikipedia.org/wiki/Google_Web_Toolkit)应用程序，匿名类是更好的选择。对于这些情况，如果我们不使用匿名类，那么代码行数将会增加。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-28T10:23:28.787

我们定期使用匿名类。我发现它们很容易用于实现只有一两个方法的接口，并且在其他任何地方都**没有使用该功能。**如果您在其他地方再次使用相同的功能，则应该有一个真正的类可以重用。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-01-03T12:51:49.137

使用匿名类是提高还是降低易读性是一个品味问题。主要问题绝对不在这里。

匿名类，就像内部类一样，携带对封闭类的引用，从而使没有它的东西成为非私有的东西。简而言之，封闭类的**this**引用可能会通过内部类逃逸。所以答案是：如果内部类自己发布，那么使用它是一种非常糟糕的做法，因为这会自动发布封闭类。例如：

```
changeManager.register(new ChangeListener() {
    public void onChange(...) {
       ...
    }}); 
```

在这里，匿名**ChangeLsener**被传递给**ChangeManager的****register**方法。这样做也会自动发布封闭类。

 **这绝对是一个不好的做法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-28T10:23:41.077

我主要将匿名类用于只有一个方法的接口，即[Runnable](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Runnable.html)或[ActionListener](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/event/ActionListener.html)。大多数较大的接口在已经存在的类中保留自己的类或实现。因为这是我的观点，我不需要论据来支持它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-28T13:08:11.947

如果尽可能限制范围和访问是一件好事，那么匿名类就非常好。它们的范围仅限于需要它们的一类。在适当的时候，我会说匿名课程很好。

一旦你复制相同的功能，它就变成了一个坏主意。将其重构为一个独立的公共类。具有重构功能的 IDE 使这变得容易。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-11-30T04:16:14.490

匿名类主要出现在 GUI 应用程序中，专门用于事件处理。匿名类在实现包含一个或两个方法的小接口的情况下很有用..例如..您有一个有两个或三个线程的类，并且您想要使用这些线程执行两个或三个不同的任务。在这种情况下，您可以借助匿名类来执行您想要的任务。看下面的例子

```
class AnonymousClass{

public static void main(String args[]){

    Runnable run1=new Runnable(){

        public void run(){

            System.out.println("from run1");
        }

    };
    Runnable run2=new Runnable(){

        public void run(){

            System.out.println("from run2");
        }

    };
    Runnable run3=new Runnable(){

        public void run(){

            System.out.println("from run3");
        }

    };

    Thread t1=new Thread(run1);
    Thread t2=new Thread(run2);
    Thread t3=new Thread(run3);

    t1.run();t2.run();t3.run();

}
} 
```

输出：

> 从运行1
> 
> 从 run2
> 
> 从 run3

在上面的代码片段中，我使用了三个线程来执行三个不同的任务。看，我创建了三个匿名类，其中包含 run 方法的实现，以执行三个不同的小任务。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-28T10:22:22.190

使用它们是有道理的，但你必须知道下面正在做什么。只有当我需要一门课来做一些我在其他地方不需要的非常具体的事情时，我才会使用它们。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-28T10:28:41.520

这取决于您将它们与什么进行比较。我宁愿拥有它们也不愿没有它们，但是我宁愿能够为 Arrays.sort() 之类的方法提供纯代码块，而不必显式创建一个包含我的 compare() 实现的类。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-28T10:40:01.840

匿名类在本质上没有什么不同或特别之处。它们最终只是支持引用外部类的语法糖。这使得编写适配器更容易——就像 Collections 框架返回的大多数迭代器实现一样。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-28T11:08:56.807

我主要使用匿名类 a) 如果接口有一个或两个方法并且它不会影响可读性的简写符号

b) 我无法证明创建新类的情况，例如在摇摆中，当您必须附加一个 actionlistner 以让 JButton 进行一些琐碎的操作时。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-28T15:05:28.840

我同意许多其他人所说的，即它们仅在使用一次时对小型接口很有用。但我还要添加一个限制，即如果必须更改匿名类外部的代码才能使其工作，则不要使用匿名类。

如果您必须开始将变量声明为 final 以适应 anon 类，因为它引用了它们，那么请改用内部类。我还看到了一些不良代码气味，其中最终数组（大小为 1）用于从匿名类返回结果。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-05-01T16:38:01.310

匿名类不会“隐藏”代码，但它们确实倾向于使其可重用性稍差。请注意，这也适用于闭包。

在某些方面，它们允许进行一些不错的重构，因为您可以将代码传递给方法。这可以非常有效地用于减少重复，我当然不反对匿名类/闭包，但是在某些情况下它们可能是一个缺点。

首先考虑您传入的匿名内部类代码不适合在您的代码中重用。如果您在其他代码中执行相同的操作，则必须将其重写为匿名内部类以外的其他内容才能重用它，此时甚至可能很难知道其他地方有代码可重用。

除了缺乏重用之外，参数化也很困难，这导致了我最大的抱怨……它们往往会导致复制和粘贴代码。

我见过不少 GUI，其中有人从匿名内部类开始作为事件响应者。许多人不得不做一些稍微不同的事情，例如，5行代码，唯一的区别是中间的一个字符串。一旦您习惯了使用内部类，简单的解决方案就是复制并粘贴块并替换该字符串。

创建具有字符串参数的新“命名”类并将该类传递给所有方法的解决方案很少发生在那个时候。这个命名类可以使用参数或继承来定义不同的行为以及代码。

我是闭包的粉丝，并不讨厌匿名类——只是指出我见过的一些陷阱。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-12-05T22:54:45.383

因此，借助接口中方法的 java 8 新特性`static`，您可以使用匿名内部类来返回接口的实例。例如：

```
interface Person {
 String getName();
 int getAge();

 static Person newInstance() {
   return new Person() {
     public String getName() {
        return "Bob";
     }

     public int getAge() {
        return 99;
     }
   } 
 }
} 
```

你可以得到一个像这样的实例：

`Person person = Person.newInstance();`

基本上，这允许您的接口的单个​​默认实现。

# parsing - 文件解析器的设计建议

> ID：487131
> 
> 赞同：1
> 
> 时间：2009-01-28T10:18:32.023
> 
> 标签：parsing

我正在尝试设计一个 edifact 解析器，我计划让一个类来读取文件，一个类来映射数据，然后另一个类来处理数据存储。我遇到的主要问题是这些类的实例应该如何相互通信。任何意见，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T10:28:34.767

我认为类不需要进行通信（传递消息），但建议使用一些策略模式。

您将有一个类来读取文件并理解它的语法。例如，可以处理空格并返回“token”、“word”等格式化信息的东西。

读取和解析语法的类被传递到语义解析器中。语义解析器可以理解含义。例如，您可能希望按该顺序排列“Id、命令、令牌、字符串”。语义解析器可能使用命令模式。

Semantic 类输出结构化数据，因此被传递到您的结构构建器（构建器模式）中。

所以你的代码可能看起来像；

MyDataStructure = DataBuilder(SemanticParser(SyntaxParse(FileReader(filename))));

高温高压

# c# - 在 WPF 文本框上调用 Select() 没有任何作用

> ID：487141
> 
> 赞同：8
> 
> 时间：2009-01-28T10:22:45.370
> 
> 标签：c#, .net, wpf, user-interface

我正在使用 WPF 文本框，并且正在调用该`Select()`方法进行选择。**不幸的是，除非**我先手动选择某些东西，否则它似乎不起作用。有人可以建议它为什么会发生吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-28T17:41:55.500

当您调用 Select 方法时，您的文本框是否有焦点？

除非有焦点，否则选择不会显示，但文本框获得焦点的常用方法是单击它...取消选择文本。这种行为可能会给人一种它不起作用的印象。

在调用 Select() 之后（或之前）调用 TextBox.Focus() 应该可以修复它。

# sql - 分析查询

> ID：487142
> 
> 赞同：4
> 
> 时间：2009-01-28T10:22:52.203
> 
> 标签：sql, informix

我正在寻找可以转换表中以下信息的单个查询

```
name:time    :state
a   :10:00 AM:login
b   :10:05 AM:login
a   :10:06 AM:chatting
a   :10:08 AM:Idle
b   :10:11 AM:chatting
a   :10:10 AM:Logout
b   :10:12 AM:Logout 
```

到这样的事情（给定时间范围 10 AM 到 10:15 AM 作为查询时段）

```
name: State    :Duration
a   : chatting :2 Minutes 
a   : Idle     :2 Minutes
b   : chatting :1 Minute 
```

这只能使用 SQL 来完成吗？我正在使用 Informix 11.5 版

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-30T03:55:06.270

它可以在单个 SQL 语句中完成。这是证据。

### 设置

```
CREATE TEMP TABLE eventtable
(
    name CHAR(3) NOT NULL,
    time DATETIME HOUR TO MINUTE NOT NULL,
    state CHAR(8) NOT NULL
);

INSERT INTO eventtable(name, time, state) VALUES('a', '10:00', 'login');
INSERT INTO eventtable(name, time, state) VALUES('b', '10:05', 'login');
INSERT INTO eventtable(name, time, state) VALUES('a', '10:06', 'chatting');
INSERT INTO eventtable(name, time, state) VALUES('a', '10:08', 'Idle');
INSERT INTO eventtable(name, time, state) VALUES('b', '10:11', 'chatting');
INSERT INTO eventtable(name, time, state) VALUES('a', '10:10', 'Logout');
INSERT INTO eventtable(name, time, state) VALUES('b', '10:12', 'Logout');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:01', 'login');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:02', 'chatting');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:03', 'Idle');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:04', 'Logout');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:05', 'Idle');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:06', 'Logout');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:07', 'Idle');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:08', 'Logout');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:09', 'login');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:11', 'chatting');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:12', 'Idle');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:13', 'chatting');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:14', 'Idle');
INSERT INTO eventtable(name, time, state) VALUES('c', '10:15', 'Logout'); 
```

### 正确查询

注意条件。结果表必须排除“登录”和第一个其他事件之间的时间段；此外，它必须排除“注销”和下一个事件（可能是“登录”）之间的时间段。*名称*列上的表之间的自连接和*时间*列上的非对称连接（使用' `<`'）确保事件按时间顺序排列。NOT EXISTS 子选择确保只考虑相邻事件。在子查询中使用 BETWEEN AND 是一个错误，因为它包含了它的端点，并且将`r1.time`和`r2.time`排除在范围之外是至关重要的；我花了几分钟才发现那个错误（查询运行但没有返回任何行，但*为什么*？）！

```
SELECT r1.name, r1.state, r2.TIME - r1.TIME AS duration
    FROM eventtable r1, eventtable r2
    WHERE r1.name = r2.name
      AND r1.time < r2.time
      AND r1.state != 'login'
      AND r1.state != 'Logout'
      AND r1.time BETWEEN DATETIME(10:00) HOUR TO MINUTE
                      AND DATETIME(10:15) HOUR TO MINUTE
      AND r2.time BETWEEN DATETIME(10:00) HOUR TO MINUTE
                      AND DATETIME(10:15) HOUR TO MINUTE
      AND NOT EXISTS (SELECT 1 FROM eventtable r3
                            WHERE r3.time > r1.time AND r3.time < r2.time
                      AND r3.name = r1.name
                      AND r3.name = r2.name); 
```

这产生了答案：

```
name state      duration
a    chatting   0:02
a    Idle       0:02
b    chatting   0:01

c    chatting   0:01
c    Idle       0:01
c    Idle       0:01
c    Idle       0:01
c    chatting   0:01
c    Idle       0:01
c    chatting   0:01
c    Idle       0:01 
```

'duration' 值是一个 INTERVAL HOUR TO MINUTE；如果您想在几分钟内获得一个值，则必须使用强制转换来转换它（使用 4 表示精度，以允许长达 1440 分钟或 1 天的间隔；对于较长的时间范围，数据不明确）：

```
(r2.time - r1.time)::INTERVAL MINUTE(4) TO MINUTE 
```

或者：

```
CAST (r2.time - r1.time AS INTERVAL MINUTE(4) TO MINUTE) 
```

IBM Informix Dynamic Server (IDS) 有非常冗长的时间常数表示法。在标准 SQL 中，您可以使用 TIME 作为类型，使用 TIME '10:00:00' 作为值，但在严格的标准 SQL 中，秒是必需的。IDS 确实提供了人们想要的确切类型 - 例如 DATETIME HOUR TO MINUTE。您还可以在标准 SQL 中编写 INTERVAL MINUTE(4)；'TO MINUTE' 应该是可选的。

### 查询不正确

在我对 Ray Hidayat 的回答的评论中，我指出 EXISTS 子查询对于确保正在考虑的事件是连续的 - 没有中间事件是必要的。这是在输出中添加了开始和结束时间的相同查询，并且缺少 EXISTS 子句（并且 'duration' 重命名为 'lapse'）：

```
SELECT r1.name, r1.state, r2.TIME - r1.TIME AS lapse,
       r1.time AS start, r2.time AS end
    FROM eventtable r1, eventtable r2
    WHERE r1.name = r2.name
      AND r1.time < r2.time
      AND r1.state != 'login'
      AND r1.state != 'Logout'
      AND r1.time BETWEEN DATETIME(10:00) HOUR TO MINUTE
                      AND DATETIME(10:15) HOUR TO MINUTE
      AND r2.time BETWEEN DATETIME(10:00) HOUR TO MINUTE
                      AND DATETIME(10:15) HOUR TO MINUTE; 
```

这产生了答案：

```
name state     lapse start end
a    chatting   0:04 10:06 10:10
a    chatting   0:02 10:06 10:08
a    Idle       0:02 10:08 10:10
b    chatting   0:01 10:11 10:12
c    chatting   0:13 10:02 10:15
c    chatting   0:12 10:02 10:14
c    chatting   0:11 10:02 10:13
c    chatting   0:10 10:02 10:12
c    chatting   0:09 10:02 10:11
c    chatting   0:07 10:02 10:09
c    chatting   0:06 10:02 10:08
c    chatting   0:05 10:02 10:07
c    chatting   0:04 10:02 10:06
c    chatting   0:03 10:02 10:05
c    chatting   0:02 10:02 10:04
c    chatting   0:01 10:02 10:03
c    Idle       0:12 10:03 10:15
c    Idle       0:11 10:03 10:14
c    Idle       0:10 10:03 10:13
c    Idle       0:09 10:03 10:12
c    Idle       0:08 10:03 10:11
c    Idle       0:06 10:03 10:09
c    Idle       0:05 10:03 10:08
c    Idle       0:04 10:03 10:07
c    Idle       0:03 10:03 10:06
c    Idle       0:02 10:03 10:05
c    Idle       0:01 10:03 10:04
c    Idle       0:10 10:05 10:15
c    Idle       0:09 10:05 10:14
c    Idle       0:08 10:05 10:13
c    Idle       0:07 10:05 10:12
c    Idle       0:06 10:05 10:11
c    Idle       0:04 10:05 10:09
c    Idle       0:03 10:05 10:08
c    Idle       0:02 10:05 10:07
c    Idle       0:01 10:05 10:06
c    Idle       0:08 10:07 10:15
c    Idle       0:07 10:07 10:14
c    Idle       0:06 10:07 10:13
c    Idle       0:05 10:07 10:12
c    Idle       0:04 10:07 10:11
c    Idle       0:02 10:07 10:09
c    Idle       0:01 10:07 10:08
c    chatting   0:04 10:11 10:15
c    chatting   0:03 10:11 10:14
c    chatting   0:02 10:11 10:13
c    chatting   0:01 10:11 10:12
c    Idle       0:03 10:12 10:15
c    Idle       0:02 10:12 10:14
c    Idle       0:01 10:12 10:13
c    chatting   0:02 10:13 10:15
c    chatting   0:01 10:13 10:14
c    Idle       0:01 10:14 10:15 
```

这显示了用户“c”的每个符合条件的起始行如何与每个符合条件的结束行匹配，从而产生许多虚假数据行。NOT EXISTS 子查询是处理基于时间的查询时的常见主题。[您可以在 Snodgrass 的“在 SQL 中开发面向时间的应用程序](http://www.cs.arizona.edu/~rts/publications.html)”（在 URL 上在线提供 PDF）以及在 Date、Darwen 和 Lorentzos[的“时间数据和关系模型](https://rads.stackoverflow.com/amzn/click/com/B001E4587Q)”中找到有关这些操作的信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T10:38:56.447

我很确定它可以只使用 SQL 来完成，这将花费我相当多的时间来为您提供查询，我将在完成后对其进行编辑。我认为的基本步骤首先是计算每个人花费的时间（通过获取每个条目并将其连接到下一个条目并减去以找到时间差来完成）然后一个简单的 group by 子句和一个总和将很容易得到它变成你描述的形式。

编辑：这是我想出的

```
SELECT l.userid, l.state, SUM(t.minutes) AS duration
FROM Log l 
INNER JOIN (
    SELECT l1.id, (l2.time - l1.time) AS minutes
    FROM Log l1, Log l2
    WHERE l2.time == ( 
        -- find the next entry --
        SELECT TOP 1 ls.time
        FROM Log ls
        WHERE ls.Time > l1.Time && ls.userid = l1.userid
        ORDER BY ls.Time
    )
) t ON l.id == t.id
GROUP BY l.userid, l.state
ORDER BY l.userid 
```

这是半伪代码，我编了所有的表名和东西，你不能只从另一个中减去一次，你可能会使用 DATEDIFF 函数。除此之外，我认为这就是它的要点。我认为 SQL 是最神奇的语言之一，几乎可以用很少的代码做任何事情。

# c# - PictureBox调整大小和绘画问题

> ID：487148
> 
> 赞同：2
> 
> 时间：2009-01-28T10:23:55.617
> 
> 标签：c#, winforms, resize, picturebox, paint

我想在 Winform 应用程序中显示一些图形，它将是股票图表绘制工具。我认为（但我不确定......）我必须使用 PictureBox，并使用 System.Drawing.Graphics 类的绘图原语来绘制图表。我已经开始对其进行编码，现在它或多或少可以工作，但是我在调​​整大小功能时遇到了问题，如下所示：当我调整整个表单的大小时，我看到程序显示图形然后立即清除它。当我停止鼠标移动（没有释放鼠标按钮）时，图形消失了！？！？

我做了一个小测试环境来演示这个bug：使用VS2005，新建一个C# Windows Forms app，只在表单中添加一个PictureBox。将 PictureBox 的锚点设置为左、上、右和下。添加两个事件处理程序，Resize 到 PictureBox，Paint 到 Form。

```
namespace PictureBox_Resize {
public partial class Form1 : Form {
    public Form1() {
        InitializeComponent();
        Ellipse_Area = this.pictureBox1.Size;
    }

    private Pen penBlack = new Pen(Color.Black, 1.0f);
    private Size Ellipse_Area;

    private void Form1_Paint(object sender, PaintEventArgs e) {
        Graphics g = this.pictureBox1.CreateGraphics();

        g.DrawEllipse(penBlack, 0, 0, Ellipse_Area.Width, Ellipse_Area.Height);
    }

    private void pictureBox1_Resize(object sender, EventArgs e) {
        Control control = (Control)sender;
        Ellipse_Area = control.Size;
        this.pictureBox1.Invalidate();
    }
} 
```

}

这个小应用程序显示了问题。它只画一个椭圆，但当然我的绘图代码要复杂得多......

知道为什么当我调整表格大小时椭圆会消失吗？？？？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T10:49:53.210

你为什么用一个`PictureBox`？我将为`UserControl`您的图表创建一个并在其方法中绘制椭圆`Paint`，仅使用其当前大小。在其构造函数中，将其设置为双缓冲，并在paint方法中进行所有绘制。

```
this.SetStyle(ControlStyles.DoubleBuffer | 
  ControlStyles.UserPaint | 
  ControlStyles.AllPaintingInWmPaint,
  true); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T10:32:56.193

据我记得在我的 C++ 时代——我做了很多这样的图像材料——你需要调用**repaint**方法——或者重写它以适应你的行为。

# iphone - UIView 被状态栏剪切，直到自动旋转

> ID：487150
> 
> 赞同：5
> 
> 时间：2009-01-28T10:25:52.073
> 
> 标签：iphone, ios-simulator

我创建了一个使用多个控制器来显示和控制视图的多视图应用程序。我遇到的问题是，当模拟器最初加载视图时，标题部分被屏幕顶部的栏覆盖，并且底部的工具栏没有接触屏幕的底部。我使用 Interface builder size 属性来控制 iphone 旋转时的视图，它可以完美运行。旋转后，所有 smap 在横向和纵向模式下都完美到位，但问题在于旋转发生之前的初始加载。非常感谢您的想法。托尼

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2010-05-23T23:35:32.027

我为这个问题苦苦挣扎了好几天——在 IB 中的任何摆弄都没有奏效。

最终我通过添加这一行让它工作：

```
mainViewController.view.frame = window.screen.applicationFrame; 
```

到应用程序：didFinishLaunchingWithOptions: 方法。（其中 mainViewController 是主要的 UIViewController）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T17:49:39.697

我遇到了视图被状态、导航和标签栏剪切的问题。我已经通过使用 Interface Builder 中的 Simulated Metrics 功能修复了其中的大部分问题。这样一来，您在 IB 中的布局就更准确地反映了您实际将要获得的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-06T15:03:30.087

我也遇到了这个问题。具体来说，当显示 时`ADBannerView`，我的整个视图会移动并位于状态栏下方，并在 iPhone 屏幕底部留下一个与状态栏大小相同的空白空间。这是我解决它的方法：（*亚当在这里的回答帮助我解决了这个问题）：*

```
// In the function that displays an iAD Banner
CGRect contentFrame = self.view.bounds;
CGRect myStatusBarFrame = [[UIApplication sharedApplication] statusBarFrame];
CGFloat statusHeight = myStatusBarFrame.size.height;

// Set the view's origin to be under the status bar.

contentFrame.origin.y = statusHeight; 
```

我需要将视图的原点设置在状态栏下方，这为我解决了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-31T18:57:27.810

问题是您根据 Apple 文档“错误地”添加了控制器（尽管恕我直言，Apple 设计得很糟糕 - 默认应该是您不需要移动！）

*如果*您要拥有状态栏，Apple*要求*您“手动”将所有控制器向下移动 20 像素（更准确地说，是状态栏的高度 - 尽管今天总是 20 像素，但 Apple 允许您请求高度在运行时，来自 UIApplication 中的“statusBarFrame”属性）

Apple 的类 - 例如 UINavigationController / UITabBarController - 在添加到屏幕时会自动将自身向下移动 20 个像素。这两个类都有一个错误，*即使*它们不是主控制器，它们也会进行这种转变——所以你的应用程序突然向下移动了额外的 20 像素，在顶部留下了 20 像素的空白区域。

但是，当他们轮换时，这些课程通常会“做对”并回到原位。或相反亦然。

cf这个链接更详细地解释了正在发生的事情，以及如何按照Apple希望你的方式编写代码：

[http://blog.red-glasses.com/index.php/tutorials/iphone-auto-rotation-for-intermediate-developers-tutorial-1/](http://blog.red-glasses.com/index.php/tutorials/iphone-auto-rotation-for-intermediate-developers-tutorial-1/)

# iphone - UIImagePickerController 的内存泄漏问题

> ID：487173
> 
> 赞同：1
> 
> 时间：2009-01-28T10:37:12.843
> 
> 标签：iphone, objective-c, image, memory-leaks, picker

我的 UIImagePickerController 类出现内存泄漏。

这是我使用它的方式：

```
 UIImagePickerController *picker = [[UIImagePickerController alloc] init];
    picker.delegate = self;
    picker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;
    [self presentModalViewController:picker animated:YES];
    [picker release]; 
```

要删除我调用的选择`[picker dismissModalViewControllerAnimated:YES];`器`didFinishPickingImage`和`imagePickerControllerDidCancel`.

--

由于此指令，仪器显示大约 160 字节泄漏：

`+[UIImagePickerController _loadPhotoLibraryIfNecessary]`

> 显然这个问题已经困扰着很多人，避免这个问题的解决方案是构建一个单例类，专门用于从库中挑选图像或使用设备的内置摄像头进行捕获。
> 
> 有人想添加一些东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T12:36:35.757

作为[第一篇](http://blog.airsource.co.uk/index.php/2008/11/12/memory-usage-in-uiimagepickercontroller/)关于使用单例的必要性的文章的作者，其动机是防止在第 7/8 次图像捕获时崩溃，而不是因为任何特别担心泄漏。160 字节很烦人，但不是主要问题，因此不值得担心（因为开发人员无法修复它）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T12:59:54.007

您是否尝试过删除代理线路？我`AVAudioPlayer`在委派给`self`. （即使访问者`assign`在这两种情况下都说。）如果泄漏随着委托而消失，您可以委托给不同的对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-10T03:24:02.863

如果您看到多个内存泄漏`GeneralBlock`并`SegmentMachO`使用`UIImagePickerController`,

尝试将 CoreLocation 框架和`MapKit`框架添加到您的项目中。我在仪器工具泄漏检查中不再看到内存泄漏。我不知道`UIImagePickerController`与这些框架有什么关系。我不确定这是否是好的解决方案。“在不使用或不需要的情况下添加框架”。

我也有使用`UIImagePickerController`. [即使在从developer.apple.com](http://developer.apple.com)下载的示例代码“PhotoLocation”和“iPhoneCoreDataRecipes”中也会发生内存泄漏。我还通过将这些框架添加到那些下载的示例代码来进行检查。不再有内存泄漏。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-26T04:54:54.793

我在 Instruments 中发现了内存分配泄漏。我所做的只是打开和关闭图像选择器（打开/取消）并使用 Apple 代码、我的代码和其他人的代码。

每次都显示分配不断增加，就好像选择器没有被释放一样。如果你试图释放它，它会崩溃（过度释放）。

然后我发现了一个非常有用的网页，它基本上说：

“在设备上测试时不会发生这种情况”

所以我从模拟器切换并在设备上运行测试。瞧，没有分配增加，而且表现正常。

然而，这完全是邪恶的，现在我们不能信任模拟器来完成可靠的工作。无论这是否与您的特定问题有关，我都带您添加任何其他内容，而我要添加的内容是不要在模拟器上测试内存！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-30T05:04:23.530

原因可能是您忘记发布图像。因为每次你写

```
UIImageView.image = image_a; 
```

然后，`image_a`将被保留一次。

直到你让`UIImageView.image = nil`，什么时候`image_a`才能最终释放。

我以这种方式解决了我的问题。

# javascript - Dojo“加载”-消息

> ID：487174
> 
> 赞同：6
> 
> 时间：2009-01-28T10:37:22.547
> 
> 标签：javascript, ajax, modal-dialog, dojo

我是 Dojo 的新手，所以我需要一点帮助。

我的一些链接需要一段时间（当用户点击时，页面开始加载需要几秒钟），我想添加一个“加载”消息。

我可以用“老式方式”来做，但我想学习新的、更简单、更智能的 Dojo 方式。

它究竟是如何工作的现在并不重要，但我想像这样：

一个矩形出现在浏览器窗口的中间。（不是文档的中间。）它有一个动画 gif 和一个类似“请稍候......”的消息。

所有其他元素都被禁用，可能会“淡出”一点。可能是一个 50% 透明的大白色矩形，它位于“正在加载”消息和文档的其余部分之间。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-28T17:55:39.153

您所描述的假设在模式`dijit.Dialog`与加载消息一起出现时，dojo 本身已经被加载。

现在，通常，一旦您的页面完全加载，dojo 就会开始执行，并且您通常会将您的 dojo 代码放在作为参数传递的匿名函数中`dojo.addOnLoad()`。

这意味着您的页面的其余部分（您称之为“链接”）必须通过 ajax 加载（例如，使用`dijit.layout.ContentPane`）。这样，dojo 可以在内容下载之前执行，并且您的“等待”消息可以更早出现。

它可能看起来像这样：

```
<html>

<head>
<link rel="stylesheet" href="/dojo/dijit/themes/tundra/tundra.css" type="text/css" media="screen" />
<script type="text/javascript" src="/dojo/dojo.js" djConfig="parseOnLoad:true"></script>
/* make sure that you shrinksafe together your libraries and dojo's for faster loading... */
<script type="text/javascript" src="/dojo/yourOwnDojoCompressedScripts.js"></script>
<script type="text/javascript">
   var dialog;
   dojo.addOnLoad(function(){
      dojo.require("dijit.layout.ContentPane");
      dojo.require("dijit.Dialog");
      dialog = new dijit.Dialog();
      dialog.setContent("<p>This page will be available in a tick!</p>");
      dialog.show();
   });
</script>
</head>

<body class="tundra">
   <div id="delayedContent" 
        dojoType="dijit.layout.ContentPane" 
        href="/myContentUrl"
        onLoad="dialog.hide()">
   </div>
</body>

</html> 
```

该计划中唯一的缺陷是 dojo 本身：预计您的*收缩安全*库的重量会超过 90K（可能高达 300K，具体取决于您放了多少东西）。在慢速连接上，下载仍然需要相当长的时间。也就是说，我们说的是*静态*90K --- 同一用户在每个会话中只会下载一次，如果您在提供这些静态文件时花时间设置适当的缓存/过期标头，则甚至更少。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-29T23:03:46.280

Dojo 已经有一个这样的组件：[Dojox Busy Button](http://download.dojotoolkit.org/release-1.2.3/dojo-release-1.2.3/dojox/form/tests/test_BusyButton.html)。您可能还对 Sitepen 的以下文章感兴趣：[Dojo：Web 的构建块](http://www.sitepen.com/blog/2008/10/17/dojo-building-blocks-of-the-web/)（演示阻止页面内容）和[实现 Web 应用程序预加载覆盖](http://www.sitepen.com/blog/2008/10/06/implementing-a-web-application-preloading-overlay/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-12-13T16:37:54.133

我为此目的 使用**dojox.widget.Standby ：** [http ://dojotoolkit.org/reference-guide/dojox/widget/Standby.html](http://dojotoolkit.org/reference-guide/dojox/widget/Standby.html)

```
dojo.require("dojox.widget.Standby");

var standby = new dojox.widget.Standby({
                                 target: "target-id-toStandby",
                                 color: "white",
                                 image: "/images/loading-ajax.gif"
                             });
                             document.body.appendChild(standby.domNode);
                             standby.startup();
                             standby.show(); 
```

当您的内容可以使用时...

```
standby.hide(); 
```

“target-id-toStandby”是您要“冻结”的 div 的 id

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-30T06:40:28.557

我以这种方式实现了这样的事情：

首先，在每个页面上，将事件处理程序添加到任何附加了“慢”类的 href：

```
    dojo.addOnLoad(function() {
        dojo.query('a.slow').onclick(function() {loading(); return true;});
    });

```

加载函数如下所示：

```
    函数加载（）{
        var underlay = new dijit.DialogUnderlay({'class': 'loading'});
        underlay.show();
    }

```

“加载”类的 CSS 如下所示：

```
div.loading {
    背景图片：网址（/images/loading.gif）；
    背景重复：不重复；
    背景位置：中心；
}

```

哪里`loading.gif`有漂亮的 GIF 动画。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-01T16:56:02.057

pierdeux 让我走上了这条路。到目前为止，这是我的代码：

```
dojo.require("dijit.form.Button");
dojo.require("dijit.Dialog");

function displayWait(txtContent) {
    if (!txtContent) {
        txtContent = "Please wait...";
    }
    txtContent = "<img src=\"loading.gif\" alt=\"\" /> " + txtContent;
    var thisdialog = new dijit.Dialog({ title: "", content: txtContent });
    dojo.body().appendChild(thisdialog.domNode);
    //thisdialog.closeButtonNode.style.display='none';
    thisdialog.titleBar.style.display='none';
    thisdialog.startup();
    thisdialog.show();
} 
```

这是一个无法关闭的模态消息框，因此用户无法使用页面上的其他元素。这正是我所要求的，所以我会接受 pierdeux 的回答。

# c# - 将 MemoryStream 与需要 Filestream 的函数一起使用

> ID：487177
> 
> 赞同：1
> 
> 时间：2009-01-28T10:38:27.367
> 
> 标签：c#, .net, filestream, memorystream

我在这里有一些功能，例如定义为

```
private int WriteLogikParameterTyp(FileStream filestream) 
```

这是我无法改变的。我希望他们写入 MemoryStream 对象。这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T10:41:54.223

不。

FileStream 是一个具体的实现。

但它是一种私有方法，因此应该很容易更改，因为您可以找到所有内部用途？建议用 Stream 而不是 FileStream 替换方法签名。

好吧...除非您创建一个临时文件，否则先写入它然后将其读入内存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T10:42:14.940

由于您无法更改函数签名以接受更通用的类型。我建议写出一个临时文件，然后将内容读入 MemoryStream 实例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T10:43:48.883

不。

如果您无权访问它们，您可以使用反射器来了解它们是如何工作的，并为 MemoryStream 实现您自己的版本。这是否合法是另一回事...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T10:48:29.313

不。 FileStream 不公开可以调用的构造函数，因此您不能从它继承来模拟它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T10:49:13.087

建议;

像这样重命名方法

```
private int WriteLogikParameterTyp_Ex(Stream stream); 
```

然后重新创建原始签名，例如；

```
private int WriteLogikParameterTyp(FileStream filestream)
{
     return WriteLogikParameterTyp_Ex(filestream);
} 
```

# java - 如何检查路径是否存在于java中？

> ID：487181
> 
> 赞同：23
> 
> 时间：2009-01-28T10:39:33.247
> 
> 标签：java, file-io

我有一个以路径为参数的 java 程序。我想在进行其他验证之前检查给定路径是否存在。例如：如果我给出一个不存在的路径 D:\Log\Sample，它必须抛出 filenotfound 异常。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-28T10:41:13.430

```
if (!new File("D:\\Log\\Sample").exists())
{
   throw new FileNotFoundException("Yikes!");
} 
```

此外[`File.exists()`](http://java.sun.com/javase/6/docs/api/java/io/File.html#exists())，还有[`File.isDirectory()`](http://java.sun.com/javase/6/docs/api/java/io/File.html#isDirectory())和[`File.isFile()`](http://java.sun.com/javase/6/docs/api/java/io/File.html#isFile())。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-28T10:41:48.327

类 java.io.File 可以为您处理：

```
File f = new File("....");
if (!f.exists()) {
    // The directory does not exist.
    ...
} else if (!f.isDirectory()) {
    // It is not a directory (i.e. it is a file).
    ... 
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T10:41:02.353

新文件（路径）.exists（）。

阅读 javadoc，它非常有用，并且经常提供许多有用的示例。

# python - 如何在 python 注释中指定输入和输出数据类型？

> ID：487184
> 
> 赞同：15
> 
> 时间：2009-01-28T10:40:31.403
> 
> 标签：python, documentation, comments, types

我已经看到了几个标准，用于编写关于函数在 Python 中期望和返回的数据类型的注释。是否就哪一个是最佳实践达成共识？

[http://www.python.org/dev/peps/pep-3107/](http://www.python.org/dev/peps/pep-3107/)中的新功能是我应该开始使用的吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-28T10:44:32.487

函数注解不是为了特定用途，它们可以用于任何事情。

可以编写工具来从注释中提取信息并做任何你想做的事情，包括检查类型或生成文档。但是 python 本身并没有对这些信息做任何事情。您可以使用完全不同的目的，即提供将在参数上调用的函数或声明可能返回值的字符串。

注释可以是任何对象：

```
def somefunc(param1: "string annotation", 
             param2: 151631,  
             param3: any_object): -> "some information here": 
```

您可以使用以下方法检索对象：

```
print (somefunc.func_annotations)
{'param1': "string annotation", 
 'param2': 151631,  
 'param3': <object any_object>,
 'return': "some information here"} 
```

PEP 提供的用例建议：

*   提供打字信息
    *   类型检查
    *   让 IDE 显示函数期望和返回的类型
    *   函数重载/泛型函数
    *   外语桥梁
    *   适应
    *   谓词逻辑函数
    *   数据库查询映射
    *   RPC 参数封送
*   其他信息
    *   参数和返回值的文档

由于函数注解语法太新，它实际上并没有用于任何生产工具。

我建议使用其他方法来记录。我使用 epydoc 来生成我的文档，它可以从文档字符串中读取参数类型信息：

```
def x_intercept(m, b):
    """
    Return the x intercept of the line M{y=m*x+b}.  The X{x intercept}
    of a line is the point at which it crosses the x axis (M{y=0}).

    This function can be used in conjuction with L{z_transform} to
    find an arbitrary function's zeros.

    @type  m: number
    @param m: The slope of the line.
    @type  b: number
    @param b: The y intercept of the line.  The X{y intercept} of a
              line is the point at which it crosses the y axis (M{x=0}).
    @rtype:   number
    @return:  the x intercept of the line M{y=m*x+b}.
    """
    return -b/m 
```

这个例子来自[epydoc 的网站](http://epydoc.sourceforge.net/)。它可以生成各种格式的文档，并且可以从您的类和调用配置文件中生成良好的图表。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-28T11:30:54.360

如果您使用[epydoc](http://epydoc.sourceforge.net/)生成 API 文档，您有三种选择。

*   密码文本。

*   重组文本，RST。

*   JavaDoc 表示法，看起来有点像 epytext。

我推荐 RST，因为它可以很好地与[sphinx](http://sphinx.pocoo.org/)一起生成包含 API 参考的整体文档套件。RST 标记[在这里](http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html)定义。您可以指定的各种 epydoc 字段[在此处](http://epydoc.sourceforge.net/manual-fields.html)定义。

例子。

```
def someFunction( arg1, arg2 ):
    """Returns the average of *two* (and only two) arguments.

    :param arg1: a numeric value
    :type arg1: **any** numeric type

    :param arg2: another numeric value
    :type arg2: **any** numeric type

    :return: mid-point (or arithmetic mean) between two values 
    :rtype: numeric type compatible with the args.
    """
    return (arg1+arg2)/2 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-05-19T20:33:58.050

**Python 3.5 官方`typing`**

[https://docs.python.org/3/library/typing.html](https://docs.python.org/3/library/typing.html)

此更新使类型成为语言的实际部分。

例子：

```
#!/usr/bin/env python3

from typing import List

def f(x: int, ys: List[float]) -> str:
    return "abc"

# Good.
f(1, [2.0, 3.0])

# Bad.
f("abc", {}) # line 12

x = 1
x = "a" # line 15

y = [] # type: List[int]
y.append("a") # line 18 
```

此代码运行正常：Python 3.5 默认不强制键入。

但是它可以被静态 linter 用来诊断问题，例如：

```
sudo pip3 install mypy
mypy a.py 
```

给出：

```
a.py:12: error: Argument 1 to "f" has incompatible type "str"; expected "int"
a.py:12: error: Argument 2 to "f" has incompatible type Dict[<nothing>, <nothing>]; expected List[float]
a.py:15: error: Incompatible types in assignment (expression has type "str", variable has type "int")
a.py:18: error: Argument 1 to "append" of "list" has incompatible type "str"; expected "int" 
```

现有的静态分析器（如 Pycharm）已经可以解析 Sphinx 文档类型，但此语言更新提供了一种可能会流行的官方规范方式。

Sphinx 1.8.2 似乎还不支持它，但这只是时间问题：[Python 3: Sphinx doesn't show type hints correct](https://stackoverflow.com/questions/40071573/python-3-sphinx-doesnt-show-type-hints-correctly)

# winforms - WinForms 应用程序中的图标显示

> ID：487201
> 
> 赞同：5
> 
> 时间：2009-01-28T10:44:24.033
> 
> 标签：winforms, icons

当显示应用程序图标时，是 Windows 决定使用哪个版本（位深度）还是它以某种方式设置在 ICO 文件中？

如果我只创建一个 32 位颜色（24 位 + 8 位透明度）的 ICO 文件，则该图标在 Win XP 上显示正常。如果我添加例如 4 位版本，Windows 总是使用这个 4 位版本，即使还有 32 位图像也是如此。我的显示器设置为 32 位颜色。如果这很重要，我正在使用 Greenfish 图标编辑器。

有什么方法可以推动 Windows 使用 32 位图标而不是 4 位图标？

编辑：我使用 IcoFX 打开原始 ICO 文件并重新保存它，现在 Windows 总是选择正确的位深度。有趣的...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-16T10:38:50.207

它是由 Windows 根据它所绘制的表面的位深度来选择的。它还取决于 .ICO 文件（或资源）中图标的实际顺序，这就是使用 IcoFX 得到不同结果的原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T11:28:00.340

Windows 将使用它可以显示的任何位深度的图标，因此您对事情应该如何工作的理解是正确的。

我没有使用过Greenfish，所以不知道它是否正确创建了图标文件。如果您使用的是 VS2008，您可以尝试（免费）[Axialis IconWorkshop](http://www.axialis.com/download/iwlite.html)来仔细检查图标文件（他们也有非免费的独立版本）。

# .net - .NET 数组的内存布局

> ID：487202
> 
> 赞同：45
> 
> 时间：2009-01-28T10:44:30.910
> 
> 标签：.net, arrays, overhead

.NET 数组的内存布局是什么？

以这个数组为例：

```
Int32[] x = new Int32[10]; 
```

我知道数组的大部分是这样的：

```
0000111122223333444455556666777788889999 
```

其中每个字符是一个字节，数字对应于数组中的索引。

另外，我知道所有对象都有一个类型引用和一个同步块索引，所以上面可以调整为：

```
ttttssss0000111122223333444455556666777788889999
        ^
        +- object reference points here 
```

此外，需要存储数组的长度，所以也许这更正确：

```
ttttssssllll0000111122223333444455556666777788889999
        ^
        +- object reference points here 
```

这是完整的吗？数组中是否有更多数据？

我问的原因是我们试图估计一个相当大的数据语料库的几个不同的内存表示将占用多少内存，并且数组的大小变化很大，所以开销可能有在一种解决方案中影响很大，但在另一种解决方案中可能影响不大。

所以基本上，对于一个数组，有多少开销，这基本上是我的问题。

在*数组坏*了小队醒来之前，这部分解决方案是静态构建一次引用-经常类型的东西，因此这里不需要使用可增长列表。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-28T12:21:17.207

检查这一点的一种方法是查看 WinDbg 中的代码。所以给定下面的代码，让我们看看它是如何出现在堆上的。

```
var numbers = new Int32[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 }; 
```

首先要做的是找到实例。由于我已将其设为本地 in `Main()`，因此很容易找到实例的地址。

从地址我们可以转储实际的实例，这给了我们：

```
0:000> !do 0x0141ffc0
Name: System.Int32[]
MethodTable: 01309584
EEClass: 01309510
Size: 52(0x34) bytes
Array: Rank 1, Number of elements 10, Type Int32
Element Type: System.Int32
Fields:
None 
```

这告诉我们这是我们的 Int32 数组，有 10 个元素，总大小为 52 字节。

让我们转储实例所在的内存。

```
0:000> d 0x0141ffc0
0141ffc0 [84 95 30 01 0a 00 00 00-00 00 00 00 01 00 00 00  ..0.............
0141ffd0  02 00 00 00 03 00 00 00-04 00 00 00 05 00 00 00  ................
0141ffe0  06 00 00 00 07 00 00 00-08 00 00 00 09 00 00 00  ................
0141fff0  00 00 00 00]a0 20 40 03-00 00 00 00 00 00 00 00  ..... @.........
01420000  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
01420010  10 6d 99 00 00 00 00 00-00 00 01 40 50 f7 3d 03  .m.........@P.=.
01420020  03 00 00 00 08 00 00 00-00 01 00 00 00 00 00 00  ................
01420030  1c 24 40 03 00 00 00 00-00 00 00 00 00 00 00 00  .$@............. 
```

我为 52 个字节插入了括号。

*   前四个字节是对 01309584 处方法表的引用。
*   然后是数组长度的四个字节。
*   接下来是数字 0 到 9（每个四个字节）。
*   最后四个字节为空。我不完全确定，但我想如果实例用于锁定，那一定是对同步块数组的引用的存储位置。

编辑：在第一次发布时忘记了长度。

该列表有点不正确，因为正如 romkyns 指出的那样，实例实际上从地址 4 开始，第一个字段是 Syncblock。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-28T11:28:56.547

好问题。我发现[这篇](http://www.codeproject.com/KB/cs/net_type_internals.aspx?fid=459323&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2567811)文章包含值类型和引用类型的框图。另请参阅Ritcher 指出的这篇[文章：](https://web.archive.org/web/20150110150255/http://msdn.microsoft.com/en-us/magazine/cc301755.aspx)

> [snip] 每个数组都有一些与之相关的额外开销信息。此信息包含数组的等级（维数）、数组每个维的下限（几乎总是 0）以及每个维的长度。开销还包含数组中每个元素的类型。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-28T12:03:24.123

好问题！我想亲眼看看，这似乎是试用 CorDbg.exe 的好机会……

似乎对于简单的整数数组，格式是：

```
ssssllll000011112222....nnnn0000 
```

其中 s 是同步块，l 是数组的长度，然后是各个元素。似乎最后有一个finally 0，我不知道为什么会这样。

对于多维数组：

```
ssssttttl1l1l2l2????????
    000011112222....nnnn000011112222....nnnn....000011112222....nnnn0000 
```

其中 s 是同步块，t 是元素的总数，l1 是第一维的长度，l2 是第二维的长度，然后是两个零，然后依次是所有元素，最后又是一个零。

对象数组被当作整型数组，这次是引用的内容。锯齿状数组是对象数组，其中引用指向其他数组。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T11:14:03.380

数组对象必须存储它有多少维以及每个维的长度。所以至少还有一个数据元素要添加到您的模型中

# asp.net-mvc - 使用 ASP.NET MVC 帮助器方法设置 maxlength 和其他 html 属性

> ID：487204
> 
> 赞同：7
> 
> 时间：2009-01-28T10:44:35.857
> 
> 标签：asp.net-mvc

目前，当我想设置像 maxlength 和 autocomplete 这样的 html 属性时，我必须使用以下语法：

```
<%= Html.TextBox("username", ViewData["username"], new { maxlength = 20, autocomplete = "off" }) %> 
```

有什么方法可以做到这一点而不必显式设置 ViewData["username"] 部分？换句话说，我想依赖辅助方法的自动加载例程，而不是明确告诉它要从 ViewData 加载哪个字段。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-28T12:24:33.563

只需将“null”作为第二个参数传递：

```
<%= Html.TextBox("username", null, new { maxlength = 20, autocomplete = "off" }) %> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T12:09:57.463

是的，但你必须使用 ViewData.Model 而不是 ViewData.Item()

控制器中的代码应如下所示（sry 4 VB.NET 代码）

```
Function Index()
    ViewData("Title") = "Home Page"
    ViewData("Message") = "Welcome to ASP.NET MVC!"

    Dim user As New User

    Return View(user)
End Function 
```

现在您可以在视图中执行此操作

```
<%=Html.TextBox("username", Nothing, New With {.maxlength = 30})%> 
```

请注意，用户对象有一个公共属性用户名

hth

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T21:02:00.133

我使用的构造如下：

```
<%= Html.TextBox("username", "", new { @maxlength = "20", @autocomplete = "off" }) %> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-11-02T11:40:32.187

对于设置 TextBox 的最大长度，您可以为第二个参数传递“”或 null 并将 html 属性（最大长度）设置为第三个参数

```
<%=Html.TextBox("username", "", new { @maxlength = 10 }) %> 
```

# lisp - 在 Lisp 中循环变量

> ID：487209
> 
> 赞同：5
> 
> 时间：2009-01-28T10:46:06.837
> 
> 标签：lisp, elisp

我写了函数

```
(defun test ()
  (let ((str1 "foo") (str2 "bar"))
    (loop for s in '(str1 str2) do (message s)))) 
```

但它不起作用。Elisp*回溯*消息是：

> 调试器进入--Lisp 错误: (wrong-type-argument stringp str1)

我怎样才能让它工作？

PS：以下修改版本完美运行，但我需要原始版本

```
(defun test1 ()
  (loop for s in '("asdf" "fdsa") do (message s))) 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-28T11:31:40.363

运算符（撇号`quote`是语法糖）意味着它的参数不被评估，即`(quote (str1 str2))`返回两个*符号*的列表。改用`list`：`(list str1 str2)`.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-30T22:15:22.493

建立一个值列表：

```
(defun test ()
  (let ((str1 "foo") (str2 "bar"))
    (loop for s in (list str1 str2) do (message s)))) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T10:58:52.177

尝试：

```
`(,str1 ,str2) 
```

# unit-testing - 单元测试以验证时间复杂度

> ID：487211
> 
> 赞同：5
> 
> 时间：2009-01-28T10:47:18.037
> 
> 标签：unit-testing, complexity-theory

有没有人使用单元测试来验证代码的时间/空间复杂度？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T11:00:14.750

这是你提出的一个非常好的观点。当然，您为此使用单元测试。

单元测试主要是测试代码结果的一种“方式”。你测试它是否做了它应该做的事情，并且当你希望它失败时它会失败。

时间和空间是两个非常重要的变量，你可能“想要”快速的速度和低的空间成本，但程序实际上恰恰相反，那么你就有了一个错误，这就是单元测试的目的，发现错误并解决他们。

一些消耗时间的单元测试的伪代码，您可能知道如何解决这个问题，但这是一种相当不错的测试方法：

```
Unit_Test_To_See_If_X_Takes_More_Than_Y_Seconds(int max_milli_seconds)
{
    int current_millis = getMillis();

    do_operations_on_objects_and_functions();

    int millis_after_executions = getMillis();

    int elapes_millis = millis_after_execution - current_millis;

    if ( elapsed_millis > max_milli_seconds )
      Assert(ERROR);

} 
```

另外你想一想，你会不会有太多的测试？不，你不能。测试所有结果是好的，即使你测试“愚蠢”的东西，如果你不测试结果并且进化了一个错误，是否意味着它不存在只是因为你没有看到它或者你没有测试它？:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T11:40:11.157

我在调整算法时遇到了类似的问题。我所做的是循环它，然后除以循环数和大 O 值。然后，我称之为“q”或“质量值”。有趣的是，这个值或多或少像我预期的那样是恒定的，并且对于错误的参数来说会更高一些。关键是，如果您查看 big-O 的定义，您会得到对除主要计算之外的“次要”计算的测量。它们通常是恒定的或具有较低的复杂性。就我而言，它有点线性，但仍然没有什么可考虑的。

我的建议是，计算这样的质量值。然后您可以查看是否有突然升高，这表明您上次更改的副作用打破了您的复杂性假设。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T11:40:30.783

虽然时间方面很好地涵盖了 Filip 和 Josh 的答案，但空间问题更复杂，因为有问题的代码可能会在完成时释放它使用的任何内存和资源。因此，我猜想单元测试本身对于确定空间复杂度并不是特别有用。您将需要一个探针或其他一些与您的代码异步运行的监视器正在测试。

我想说在正在测试的代码中提供一些原位日志/跟踪将是最简单的解决方案，可能会从发布版本中删除。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T11:10:56.303

可能的解决方案是使用 Filip 的函数进行 1 次迭代、100 次、1000 次、10000 次（等）测试，并将结果绘制在图表上以确定时间复杂度。或者使用数学计算每次运行之间的最大因子差异。但是，我不确定您将如何测试空间。

我认为输出不会是简单的通过或失败，除非存在现有算法来推导最高因子（N^2 等）并与之进行比较。

# xml - Perl 最好的 XML 解析器是什么？

> ID：487213
> 
> 赞同：33
> 
> 时间：2009-01-28T10:48:29.047
> 
> 标签：xml, perl, libxml2

我已经尝试过许多 Perl XML 解析器。我对 Sablotron Parser 很感兴趣，但是安装在 Windows 机器上实在是太痛苦了。目前我已经开始使用[XML::LibXML](http://search.cpan.org/dist/XML-LibXML)和[XML::LibXSLT](http://search.cpan.org/dist/XML-LibXSLT)两者似乎都能满足我的所有需求。

它们似乎也很标准。还有比这更好的 XML 解析器吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-28T10:57:48.920

我认为你正在使用一个非常好的。 [XML::LibXML](http://search.cpan.org/dist/XML-LibXML/)、Matt Sergeant 和 Christian Glahn 对 Daniel Velliard 的[libxml2](http://xmlsoft.org/)的 Perl 接口是我所知道的更快的 XML 解析器之一。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-06-18T15:37:23.833

正如人们所说，这实际上取决于您的需求。为了解析大约 100Mb 大小的 XML 文件（来自[TAIR](ftp://ftp.arabidopsis.org/home/tair/Genes/TAIR8_genome_release/Tair8_XML/)的基因注释，每个染色体 1 个文件），我使用了 mirod 的[XML::Twig](http://xmltwig.org/)模块，它允许您设置回调来解析您感兴趣的元素，将每个子文档显示为一个 XML::Simple 树。它结合了 SAX 解析器（将文件作为流扫描）和 DOM 解析器（更容易处理有趣的部分）的优点。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-28T13:45:16.787

如果您需要速度、功能或特性，XML::LibXML 是您的不二之选。但是，如果您追求易用性，那么[XML::Simple](http://search.cpan.org/dist/XML-Simple/)是一个可行的替代方案。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-28T19:51:08.763

根据我的经验， [XML::Simple](http://search.cpan.org/dist/XML-Simple/)最适合快速和肮脏的 XML 解析。我们使用它来解析来自第三方的数据，这些数据并不总是符合 XML 标准。XML::Simple 会引发信息性错误并让您以极快的​​速度运行。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-04-14T13:23:47.697

（实际上这不是答案，而是评论 - 但是，我无法评论......）

XML::Simple 已在此处提及。
（我知道几年前很少，但今天谷歌出现了......）

但是，它的网站（[http://metacpan.org/pod/XML::Simple](http://metacpan.org/pod/XML::Simple)）现在说：

本模块的状态

不鼓励在新代码中使用此模块。其他模块也可以提供更直接和一致的接口。特别是，强烈推荐使用 XML::LibXML。

这个模块的主要问题是大量的选项以及这些选项交互的任意方式——通常会产生意想不到的结果。

欢迎使用带有错误修复和文档修复的补丁，但不太可能添加新功能。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-28T21:13:57.070

您还可以查看在下面使用 LibXML的[XML::Liberal 。](http://search.cpan.org/dist/XML-Liberal/lib/XML/Liberal.pm)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-04-06T23:22:37.447

我认为您也应该尝试一下[XML::MyXML](https://metacpan.org/module/XML%3a%3aMyXML)。它非常易于使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-01-15T17:13:57.300

我将提供一个*不*应该使用的：[XML::Parser](http://search.cpan.org/~msergeant/XML-Parser-2.36/Parser.pm)。

它会自动将 HTML 实体扩展为其 UTF-8 等效项，并且禁用此行为的选项不适用于所有实体中最具特征的`&amp;`.

此外，它的 XMLDecl 解析器会将块中的`standalone`属性解释并显示为，这是绝对不正确的——它应该是。`<?xml ... ?>``"standalone"="1"``"standalone"="yes"`

# actionscript-3 - 在舞台上寻找空闲区域

> ID：487216
> 
> 赞同：3
> 
> 时间：2009-01-28T10:48:48.127
> 
> 标签：actionscript-3, algorithm, geometry

我在舞台上的随机位置绘制矩形，我不希望它们重叠。所以对于每个矩形，我需要找一个空白区域来放置它。

我考虑过尝试一个随机位置，验证它是否免费

```
private function containsRect(r:Rectangle):Boolean {
    var free:Boolean = true;
    for (var i:int = 0; i < numChildren; i++)
        free &&= getChildAt(i).getBounds(this).containsRect(r);
    return free;
} 
```

如果它返回 false，则尝试另一个随机位置。

问题是，如果没有可用空间，我将永远被困在尝试随机位置。

有一个优雅的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T13:37:08.177

您可以通过转换来简化事情。如果您正在寻找放置 LxH 矩形的有效位置，则可以改为将所有先前的矩形 L 个单位向右增长，H 个单位向下增长，然后搜索一个不与其中任何一个相交的点. 该点将是放置新矩形的有效位置的右下角。

接下来应用扫描线扫描算法来查找未被任何矩形覆盖的区域。如果你想要一个均匀的分布，你应该选择一个由自由区域分布加权的随机 y 坐标（假设你向下扫）。然后从您选择的扫描线中的开放段中均匀地选择一个随机 x 坐标。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T17:27:42.470

设 S 为舞台面积。令 A 为我们要绘制的最小矩形的面积。令 N = S/A

**一种可能的确定性方法：**

当您在空舞台上绘制一个矩形时，这会将舞台划分为最多 4 个可以适合您的下一个矩形的区域。当您绘制下一个矩形时，一个或两个区域被分成最多 4 个子区域（每个）可以适合一个矩形等。您永远不会创建超过 N 个区域，其中 S 是您的舞台面积，并且A 是最小矩形的面积。保留区域列表（未排序即可），每个区域由其四个角点表示，每个区域都标有其面积，并使用按面积加权的[水库采样](http://blogs.msdn.com/spt/archive/2008/02/05/reservoir-sampling.aspx)使用 1 的水库大小选择一个区域，其概率与其面积成正比，最多一次通过列表。然后在该区域的随机位置放置一个矩形。（从该区域的左下角选择一个随机点，该点允许您绘制一个以该点为左下角的矩形，而不会碰到上墙或右墙。）

如果您不是从空白阶段开始，那么只需在 O(N) 中构建可用区域列表（例如，通过以任何顺序在空白阶段重新绘制所有现有矩形），然后再搜索要绘制的第一个点一个新的矩形。

注意：您可以将水库大小更改为 k 以一步选择接下来的 k 个矩形。

注意 2：您也可以将可用区域存储在树中，每个边的权重等于子树中区域面积与舞台面积之和。然后在 O(logN) 中选择一个区域，我们递归地选择具有根区域的概率面积 / S 的根，或者具有概率边缘权重 / S 的每个子树。但是，在重新平衡树时更新权重会很烦人。

**运行时间：O(N)**

**空间：O(N)**

**一种可能的随机方法：**

在舞台上随机选择一个点。如果您可以绘制一个或多个包含该点的矩形（不仅仅是一个以该点为左下角的矩形），则返回一个包含该点的随机定位矩形。可以通过一些细微的差别来定位矩形而不带偏见，但我会把这个留给你。

在最坏的情况下，有一个空间正好足以容纳我们的矩形，而舞台的其余部分则被填满。所以这种方法成功的概率 > 1/N，或者失败的概率 < 1-1/N。重复N次。我们现在失败的概率 < (1-1/N)^N < 1/e。失败是指我们的矩形有一个空间，但我们没有找到它。成功意味着我们找到了一个空间（如果存在的话）。为了获得合理的成功概率，我们重复 Nlog(N) 次以获得 1/N 的失败概率，或 N² 次以获得 1/e^N 的失败概率。

总结：尝试随机点直到我们找到一个空间，在 NlogN（或 N²）次尝试后停止，在这种情况下，我们可以确信不存在空间。

**运行时间：O(NlogN)**

**O(N²)**

**空间：O(1)**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T11:56:07.803

我不确定这会有多优雅，但您可以设置最大尝试次数。也许100？

当然，您可能还有一些可用空间，但无论如何您都可以触发“完成”事件。这就像补间库将对象捕捉到目标点只是因为它“足够接近”。

高温高压

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T12:16:20.103

您可以进行一项可能的检查以确定是否有足够的空间，即检查当前矩形组占用了多少面积。如果剩余的面积小于新矩形的面积，那么您可以立即放弃并退出。我不知道您可以获得哪些信息，或者矩形是否以常规模式放置，但如果是这样，您可以更改检查以查看是否明显没有足够的可用空间。

这可能不是最适合你的方法，但它是我脑海中第一时间蹦出来的！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T13:10:24.407

假设您在尝试绘制矩形之前定义了矩形的尺寸，我认为这样的事情可能会起作用：

在舞台上为候选矩形建立一个可能的中心点网格。因此，对于 6x4 矩形，您的第一个点将位于 (3, 2)，然后是 (3 + 6 * x, 2 + 4 * y)。如果您可以在四个相邻点之间绘制一个矩形，则可能存在空间。

```
for (x = 0, x < stage.size / rect.width - 1, x++)
    for (y = 0, y < stage.size / rect.height - 1, y++)
        if can_draw_rectangle_at([x,y], [x+rect.width, y+rect.height])
            return true; 
```

这并没有告诉您可以*在哪里*绘制它（尽管应该可以构建可能的绘图区域的列表），只是您可以。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T14:35:17.717

我认为用你所拥有的唯一有效的方法是维护一个开放位置的 2D 布尔数组。具有足够大小的数组，以使绘图位置仍然显得随机。

当您绘制一个新矩形时，将数组中相应的矩形块归零。然后检查空闲区域是恒定的^H^H^H^H^H^H^H时间。糟糕，这意味着查找是 O(nm) 时间，其中 n 是长度，m 是宽度。必须有一个基于范围的解决方案，啊。

Edit2：显然答案就[在这里，](http://en.wikipedia.org/wiki/Kd-tree)但在我看来，这在 Actionscript 上实现可能有点多，特别是如果您不热衷于几何图形。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T18:27:16.687

这是我要使用的算法

1.  放下N个随机点，其中N是你想要的矩形数量
2.  迭代地增加在每个点 N 创建的矩形的尺寸，直到它们接触另一个矩形。

如果您想要最小允许的矩形大小，您可以限制初始点的放置方式。

如果您希望所有空间都被矩形覆盖，则可以将随机点逐步添加到剩余的“空闲”空间，直到没有区域未被覆盖。

# sql-server - SQL Server 脚本向导

> ID：487223
> 
> 赞同：0
> 
> 时间：2009-01-28T10:51:53.673
> 
> 标签：sql-server, sql-server-2005, sql-scripts

我正在使用 SQL Server 2005。如果我尝试使用管理工作室中的生成脚本向导为 dB 生成脚本（右键单击 dB-> 任务-> 生成脚本）

我在列表中没有像 IF EXISTS DROP 条件这样的选项。而安装在不同机器上的一些 SQL Server 启用了此选项。

是否缺少服务包或需要修改任何选项才能获得此功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T10:57:22.117

如果您右键单击向导中的一个页面，您可以在其中设置脚本选项。一种选择是“**如果不存在则包括**”。或者转到工具-> 选项-> SQL Server 对象资源管理器-> 脚本来设置它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T21:16:42.460

当我执行这个命令时，我得到的只是一个 CREATE DATABASE 语句，然后设置了相关的选项。

您想生成 DROP DATABASE 语句吗？

看起来不存在此功能，但您可以生成 drop 语句，然后将其粘贴到前面。

# python - 减少 Django 内存使用。低悬的果实？

> ID：487224
> 
> 赞同：139
> 
> 时间：2009-01-28T10:52:19.617
> 
> 标签：python, django, profiling, memory-management, mod-python

我的内存使用量随着时间的推移而增加，并且重新启动 Django 对用户不利。

我不确定如何分析内存使用情况，但一些关于如何开始测量的提示会很有用。

我有一种感觉，有一些简单的步骤可以产生巨大的收益。确保“调试”设置为“假”显然是一件大事。

任何人都可以建议其他人吗？在低流量站点上缓存会有多大改进？

在这种情况下，我使用 mod_python 在 Apache 2.x 下运行。我听说 mod_wsgi 有点精简，但在这个阶段切换会很棘手，除非我知道收益会很大。

编辑：感谢到目前为止的提示。有什么建议如何发现内存用尽了吗？是否有 Python 内存分析的指南？

另外如前所述，有一些事情会使切换到 mod_wsgi 变得很棘手，所以我想在朝着这个方向前进之前对我可以期待的收益有所了解。

**编辑：** Carl 在这里发布了一个更详细的回复，值得一读：[Django Deployment:Cutting Apache's Overhead](https://stackoverflow.com/questions/488864/django-deployment-cutting-apaches-overhead)

**编辑：** [Graham Dumpleton 的文章](http://blog.dscpl.com.au/2009/03/load-spikes-and-excessive-memory-usage.html)是我在 MPM 和 mod_wsgi 相关内容上找到的最好的文章。我相当失望的是，没有人可以提供任何有关调试应用程序本身内存使用情况的信息。

**最终编辑：**嗯，我一直在与 Webfaction 讨论这个问题，看看他们是否可以帮助重新编译 Apache，这是他们对此事的看法：

> “我真的认为切换到 MPM Worker + mod_wsgi 设置不会给您带来太多好处。我估计您可能能够节省大约 20MB，但可能不会更多。”

所以！这让我回到了我最初的问题（我仍然对此一无所知）。如何确定问题所在？这是一个众所周知的格言，没有测试就不会优化，看看你需要优化的地方，但是关于测量 Python 内存使用的教程很少，而且根本没有特定于 Django。

感谢大家的帮助，但我认为这个问题仍然悬而未决！

**另一个最终编辑;-)**

我在 django-users 列表上问了这个问题，得到了一些[*非常*有用的回复](http://groups.google.com/group/django-users/browse_thread/thread/1d56d48fc192ceed?fwc=1&pli=1)

**老实说最后一次更新！**

这是刚刚发布的。可能是最好的解决方案：[Profiling Django object size and memory usage with Pympler](http://www.rkblog.rk.edu.pl/w/p/profiling-django-object-size-and-memory-usage-pympler/)

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-01-28T11:11:14.943

确保您没有保留对数据的全局引用。这可以防止 python 垃圾收集器释放内存。

不要使用`mod_python`. 它在 apache 中加载一个解释器。如果您需要使用 apache，请[`mod_wsgi`](http://code.google.com/p/modwsgi/)改用。切换并不难。这很容易。[为 django 配置](http://code.google.com/p/modwsgi/wiki/IntegrationWithDjango)比 Brain-dead`mod_wsgi`更容易。`mod_python`

如果您可以从您的要求中删除 apache，那对您的记忆会更好。[`spawning`](http://pypi.python.org/pypi/Spawning/0.7)似乎是运行 python web 应用程序的新的快速可扩展方式。

**编辑**：我不明白切换到 mod_wsgi 是多么“*棘手*”。这应该是一项非常容易的任务。请详细说明您在使用交换机时遇到的问题。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-02-01T20:18:57.733

如果您在 mod_wsgi 下运行，并且由于它与 WSGI 兼容而可能正在生成，您可以使用[Dozer](http://pypi.python.org/pypi/Dozer)查看您的内存使用情况。

在 mod_wsgi 下，只需在 WSGI 脚本的底部添加：

```
from dozer import Dozer
application = Dozer(application) 
```

然后将浏览器指向[http://domain/_dozer/index](http://domain/_dozer/index)以查看所有内存分配的列表。

我还将添加我对 mod_wsgi 的支持的声音。与 mod_python 相比，它在性能和内存使用方面有着天壤之别。Graham Dumpleton 对 mod_wsgi 的支持非常出色，无论是在积极开发方面还是在帮助邮件列表中的人们优化他们的安装方面。[curse.com](http://www.curse.com/)的David Cramer发布了一些图表（不幸的是，我现在似乎找不到）显示他们在那个高流量站点上切换到 mod_wsgi 后 cpu 和内存使用量急剧下降。一些 django 开发人员已经切换。说真的，这很容易:)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-06T19:55:59.537

这些是我知道的 Python 内存分析器解决方案（与 Django 无关）：

*   [堆的](http://guppy-pe.sourceforge.net/#Heapy)
*   [pysizer](http://pysizer.8325.org/)（已停产）
*   ~~Python 内存验证器（商业）~~
*   [品普勒](http://pypi.python.org/pypi/Pympler)

免责声明：我持有后者的股份。

单个项目的文档应该让您了解如何使用这些工具来分析 Python 应用程序的内存行为。

以下是一个不错的“战争故事”，也提供了一些有用的指示：

*   [减少 python 应用程序的占用空间](http://wingolog.org/archives/2007/11/27/reducing-the-footprint-of-python-applications)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-04T21:22:05.030

此外，请检查您是否不使用任何已知的泄密者。众所周知，由于 unicode 处理中的错误，MySQLdb 会在 Django 中泄漏大量内存。除此之外，[Django Debug Toolbar](http://github.com/robhudson/django-debug-toolbar/tree/master)可能会帮助您跟踪猪。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-28T16:13:18.190

除了不保留对大型数据对象的全局引用之外，尽量避免将大型数据集加载到内存中。

在守护进程模式下切换到 mod_wsgi，并使用 Apache 的 worker mpm 而不是 prefork。后一步可以让您以更少的内存开销为更多的并发用户提供服务。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-01T03:15:41.403

Webfaction 实际上有[一些降低 django 内存使用率的技巧](http://blog.webfaction.com/tips-to-keep-your-django-mod-python-memory-usage-down)。

要点：

*   确保 debug 设置为 false（你已经知道了）。
*   在您的 apache 配置中使用“ServerLimit”
*   检查内存中没有加载大对象
*   考虑在单独的进程或服务器中提供静态内容。
*   在您的 apache 配置中使用“MaxRequestsPerChild”
*   找出并了解您正在使用多少内存

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-30T20:23:11.657

mod_wsgi 的另一个优点：在指令中设置一个`maximum-requests`参数`WSGIDaemonProcess`，mod_wsgi 将每隔一段时间重新启动守护进程。除了第一次遇到新进程时页面加载缓慢之外，用户应该没有明显的影响，因为它将把 Django 和您的应用程序代码加载到内存中。

但即使您*确实*有内存泄漏，也应该防止进程大小变得太大，而不必中断对用户的服务。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-06T07:09:02.347

这是我用于 mod_wsgi 的脚本（称为 wsgi.py，并放在我的 django 项目的根目录中）：

```
import os
import sys
import django.core.handlers.wsgi

from os import path

sys.stdout = open('/dev/null', 'a+')
sys.stderr = open('/dev/null', 'a+')

sys.path.append(path.join(path.dirname(__file__), '..'))

os.environ['DJANGO_SETTINGS_MODULE'] = 'myproject.settings'
application = django.core.handlers.wsgi.WSGIHandler() 
```

根据需要调整 myproject.settings 和路径。我将所有输出重定向到 /dev/null 因为 mod_wsgi 默认情况下会阻止打印。请改用日志记录。

对于阿帕奇：

```
<VirtualHost *>
   ServerName myhost.com

   ErrorLog /var/log/apache2/error-myhost.log
   CustomLog /var/log/apache2/access-myhost.log common

   DocumentRoot "/var/www"

   WSGIScriptAlias / /path/to/my/wsgi.py

</VirtualHost> 
```

希望这至少可以帮助您设置 mod_wsgi，以便您可以查看它是否有所作为。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-04T04:31:53.260

缓存：确保它们被刷新。某些东西很容易进入缓存，但由于缓存引用而永远不会被 GC 处理。

Swig'd 代码：确保正确完成任何内存管理，在 python 中很容易错过这些，尤其是第三方库

监控：如果可以，获取有关内存使用情况和命中的数据。通常你会看到某种类型的请求和内存使用之间的相关性。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-01-13T19:37:37.737

我们偶然发现了 Django 中的一个带有大型站点地图（10.000 个项目）的错误。似乎 Django 在生成站点地图时试图将它们全部加载到内存中：http: [//code.djangoproject.com/ticket/11572](http://code.djangoproject.com/ticket/11572) - 当 Google 访问该站点时有效地杀死了 apache 进程。

# python - python中的客户端服务器编程？

> ID：487229
> 
> 赞同：10
> 
> 时间：2009-01-28T10:55:51.013
> 
> 标签：python, multithreading, client, sockets

这是python中多线程服务器和客户端的源代码。

在代码中，客户端和服务器在作业完成后关闭连接。我想保持连接活动并通过相同的连接发送更多数据，以**避免每次关闭和打开套接字的开销**。

以下代码来自： http: [//www.devshed.com/c/a/Python/Basic-Threading-in-Python/1/](http://www.devshed.com/c/a/Python/Basic-Threading-in-Python/1/)

```
import pickle
import socket
import threading

# We'll pickle a list of numbers:
someList = [ 1, 2, 7, 9, 0 ]
pickledList = pickle.dumps ( someList )

# Our thread class:
class ClientThread ( threading.Thread ):

   # Override Thread's __init__ method to accept the parameters needed:
   def __init__ ( self, channel, details ):

      self.channel = channel
      self.details = details
      threading.Thread.__init__ ( self )

   def run ( self ):

      print 'Received connection:', self.details [ 0 ]
      self.channel.send ( pickledList )
      for x in xrange ( 10 ):
         print self.channel.recv ( 1024 )
      self.channel.close()
      print 'Closed connection:', self.details [ 0 ]

# Set up the server:
server = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )
server.bind ( ( '', 2727 ) )
server.listen ( 5 )

# Have the server serve "forever":
while True:
   channel, details = server.accept()
   ClientThread ( channel, details ).start() 
```

* * *

```
import pickle
import socket
import threading

# Here's our thread:
class ConnectionThread ( threading.Thread ):

   def run ( self ):

      # Connect to the server:
      client = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )
      client.connect ( ( 'localhost', 2727 ) )

      # Retrieve and unpickle the list object:
      print pickle.loads ( client.recv ( 1024 ) )

      # Send some messages:
      for x in xrange ( 10 ):
         client.send ( 'Hey. ' + str ( x ) + '\n' )

      # Close the connection
      client.close()

# Let's spawn a few threads:
for x in xrange ( 5 ):
   ConnectionThread().start() 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-28T11:19:49.437

为每个连接生成一个新线程是一个**非常糟糕的**设计选择。如果你被很多连接击中会发生什么？

实际上，使用线程等待网络 IO 是不值得的。您的程序变得非常复杂，并且您绝对**没有任何好处**，因为在线程中等待网络不会让您**等待得更快**。在这种情况下，您只会因使用线程而失败。

以下文本来自 python 文档：

> 只有两种方法可以让单个处理器上的程序“一次做不止一件事”。多线程编程是最简单和最流行的方法，但还有另一种非常不同的技术，它让您几乎拥有多线程的所有优点，而无需实际使用多线程。只有当您的程序主要受 I/O 限制时，它才真正实用。如果您的程序受处理器限制，那么抢占式调度线程可能是您真正需要的。然而，网络服务器很少受处理器限制。

如果它是处理器绑定的服务器案例。你总是可以留下另一个进程/线程来做处理器部分。继续：

> 如果您的操作系统在其 I/O 库中支持 select 系统调用（几乎所有都支持），那么您可以使用它同时处理多个通信通道；当您的 I/O 在“后台”中进行时做其他工作。尽管这种策略可能看起来很奇怪和复杂，尤其是刚开始时，但它在许多方面都比多线程编程更容易理解和控制。

因此，不要使用线程，而是使用非阻塞输入/输出：收集列表中的套接字并使用带有[select.select](http://docs.python.org/library/select.html#select.select)的事件循环来了解哪个套接字有要读取的数据。在单个线程中执行此操作。

你可以选择一个像[twisted](http://twistedmatrix.com/)这样的 python 异步网络框架来为你做这件事。这将为您省去很多麻烦。Twisted 的代码多年来一直在改进，涵盖了一些您需要时间掌握的极端情况。

**编辑**：任何现有的异步 IO 库（如 Twisted）都是 python 代码。你本可以自己写的，但它已经为你写好了。我不明白为什么您不使用其中一个库并编写自己的**最糟糕**的代码，因为您是初学者。网络 IO 很难正确处理。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T11:08:09.147

我不确定我是否理解这个问题，但`close()`如果您不想关闭连接，请不要打电话...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T11:20:54.427

有关保持 TCP 连接打开并使用熟悉的协议的客户端示例，请查看[telnetlib 模块](http://docs.python.org/library/telnetlib.html#module-telnetlib)的[源代码](http://svn.python.org/view/python/trunk/Lib/telnetlib.py?rev=63788&view=log)。（对不起，其他人将不得不回答您的线程问题。）

保持 TCP 连接打开的服务器示例位于[SocketServer 模块](http://docs.python.org/library/socketserver.html)的源代码中（任何标准 Python 安装都包括源代码）。

# asp.net - 在 ASP.NET MVC 中服务 favicon.ico

> ID：487230
> 
> 赞同：260
> 
> 时间：2009-01-28T10:55:56.223
> 
> 标签：asp.net, asp.net-mvc, razor, favicon

关于如何在 ASP.NET MVC 中服务 favicon.ico 的最终/最佳建议是什么？

我目前正在执行以下操作：

*   在我的 RegisterRoutes 方法的**最开始**添加一个条目：

    ```
    routes.IgnoreRoute("favicon.ico"); 
    ```

*   将 favicon.ico 放在我的应用程序的根目录中（这也将成为我的域的根目录）。

我有两个问题：

*   除了我的应用程序的根目录之外，没有办法将 favicon.ico 放在其他地方。`Content`与和处于同一水平非常令人讨厌`Controllers`。
*   这个`IgnoreRoute("favicon.ico")`陈述是否足够 - 或者我也应该按照[Phil Haack 的博客文章](http://haacked.com/archive/2008/07/14/make-routing-ignore-requests-for-a-file-extension.aspx)中的讨论执行以下操作。我不知道曾经在根目录以外的任何目录中看到过对 favicon.ico 的请求 - 这将使这变得不必要（但知道如何去做是件好事）。

    ```
    routes.IgnoreRoute("{*favicon}", new {favicon=@"(.*/)?favicon.ico(/.*)?"}); 
    ```

* * *

## 回答 #1

> 赞同：233
> 
> 时间：2012-03-27T15:43:04.807

我同意 Chris 的回答，但看到这是一个特定的 ASP.NET MVC 问题，最好使用 Razor 语法：

```
<link rel="icon" href="@Url.Content("~/content/favicon.ico")"/> 
```

或者传统上

```
<link rel="icon" href="<%= Url.Content("~/content/favicon.ico") %>"/> 
```

而不是

```
<link rel="icon" href="http://www.mydomain.com/content/favicon.ico"/> 
```

* * *

## 回答 #2

> 赞同：207
> 
> 时间：2009-01-28T11:19:41.027

将 favicon.ico 放在域的根目录中只会影响 IE5、IIRC。对于更现代的浏览器，您应该能够包含一个链接标记以指向另一个目录：

```
<link rel="SHORTCUT ICON" href="http://www.mydomain.com/content/favicon.ico"/> 
```

您还可以将非 ico 文件用于 IE 以外的浏览器，为此我可能会使用以下条件语句将 PNG 提供给 FF 等，并将 ICO 提供给 IE：

```
<link rel="icon" type="image/png" href="http://www.mydomain.com/content/favicon.png" />
<!--[if IE]>
<link rel="shortcut icon" href="http://www.mydomain.com/content/favicon.ico" type="image/vnd.microsoft.icon" />
<![endif]--> 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-01-28T11:15:31.927

1）您可以将您的网站图标放在您想要的位置并将此标签添加到您的页面标题

```
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" /> 
```

虽然有些浏览器默认会尝试从 /favicon.ico 获取 favicon，所以你应该使用 IgnoreRoute。

2）如果浏览器在另一个目录中请求网站图标，它将得到一个 404 错误，这很好，如果您的母版页中的答案 1 中有链接标签，浏览器将获得您想要的网站图标。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-28T11:18:51.357

我认为***favicon.ico***应该在根文件夹中。它只属于那里。

如果您想使用不同的图标 - 将其放入控制器中。你可以这样做。如果没有 - 只需将其留在根文件夹中。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2018-05-08T18:32:04.683

以上都不适合我。我终于通过将 favicon.ico 重命名为 myicon.ico 解决了这个问题，并在头部引用它`<link rel="icon" href="~/myicon.ico" type="image/x-icon" />`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-12-24T08:02:20.343

还应该可以创建一个返回 ico 文件的控制器并注册路由 /favicon.ico 以指向该控制器。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-11-24T14:13:30.213

您需要做的就是添加`app.UseStaticFiles();`您的 startup.cs -> `public void Configure(IApplicationBuilder app, IHostingEnvironment env)`。

ASP.net 核心提供了一种获取静态文件的绝佳方式。那是使用 wwwroot 文件夹。请阅读[ASP.NET Core 中的静态文件](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files?view=aspnetcore-2.1)。

使用`<Link />`不是一个好主意。为什么有人会在 favicon.ico 的每个 HTML 或 cshtml 上添加链接标签？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-03-11T13:27:28.310

使用它而不是 favicon.ico，它倾向于搜索收藏图标文件

```
> <link rel="ICON" 
> href="@System.IO.Path.Combine(Request.PhysicalApplicationPath,
> "favicon.ico")" /> 
```

使用请求的路径并与收藏图标文件结合，以便获得其搜索的准确地址

使用它解决了总是在 Application_Error 上引发的 Fav.icon 错误

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-06-14T21:10:50.277

发现在 .Net Core 中，将 favicon.ico 放在 /lib 而不是 wwwroot 可以解决问题

# c# - 服务 -> 应用程序通信。最好的方法？

> ID：487237
> 
> 赞同：0
> 
> 时间：2009-01-28T10:58:51.867
> 
> 标签：c#, service

我正在开发某种服务器服务，它在特定的时间范围内开始运行并停止，我需要编写一个监控应用程序来接收从同一本地主机中的服务发送的一些状态文本。

这是我第一次需要在进程之间进行通信，我一直在寻找一些方法，您认为哪种方法最适合这种情况？为什么？各有优劣？

*   远程处理
*   命名管道
*   窗口消息
*   本地 tcp 连接
*   数据库表日志（我正在使用数据库，所以这是另一种选择）
*   磁盘上的数据文件

编辑：我使用的是 .net 2，所以很棒的 wcf 解决方案对我不起作用:(

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T11:05:28.840

看到这个问题：

[C# IPC 最佳实践](https://stackoverflow.com/questions/56121/ipc-mechanisms-in-c-usage-and-best-practices)

您几乎肯定想使用 WCF。这取代了其他 .Net 技术，例如远程处理。此外，如果您使用 WCF：

*   其他客户端将来也可以订阅该状态信息。
*   如果您需要横向扩展，监听状态更新的服务可以在另一个物理机器上运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T12:01:47.573

如果您真的只是在寻找“状态消息”——而不是实际的客户端应用程序——那么您可以使用 Trace/Debug.Write* 语句。如果 DebugView 正在运行，它将获取它们，并且也可以跨主机使用。当然，如果您以后想保存消息，可以通过配置文件添加其他侦听器。

# c++ - 在全局函数或由全局函数包装的类中实现

> ID：487243
> 
> 赞同：3
> 
> 时间：2009-01-28T11:03:04.883
> 
> 标签：c++, oop, static, namespaces, global

根据预定义的签名，我必须实现一组 60 个函数。它们必须是全局函数，而不是某些类的成员函数。当我实现它们时，我使用了一组由第 3 方提供的做得很好的类。

我对大多数功能的实现都很短，大约 5-10 行，主要处理对 3rd 方类的不同访问。对于一些更复杂的函数，我创建了几个新类来处理所有复杂的东西，我也在函数中使用它们。所有状态信息都存储在我和第 3 方类的静态成员中，因此我不必创建全局变量。

问题：如果我实现一个有 60 个成员函数的大类，并在那里完成所有实现（现在在全局函数中）会更好吗？我必须编写的每个函数都只会调用类中相应的成员函数。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T11:54:48.180

> 所有状态信息都存储在我和第 3 方类的静态成员中，因此我不必创建全局变量。

这是关键点。不，他们绝对不应该上课。类用于创建对象。在您的情况下，您会将它们用作数据和函数的范围。但这是*命名空间*已经更好地解决的问题：

```
namespace stuff {
    ... 60 functions ...
    namespace baz {
        ... if you want, you can have nested namespaces, to ...
        ... categorize the functions ...
    }

    namespace data {
        ... you can put data into an extra namespace if you want ...
    }
} 
```

创建仅由静态成员组成的类是一个坏主意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T11:23:04.640

你的代码的用户真的需要这个大类吗？

如果是，请实施。

如果不是，不要浪费你的时间来实现它，也不要浪费其他人的时间来测试它或试图理解这个类在 OOP 外观之外的确切作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T14:38:27.227

[litb](https://stackoverflow.com/questions/487243/implementation-in-global-functions-or-in-a-class-wrapped-by-global-functions#487362)可能是正确的。`class`您甚至会考虑包装一堆免费函数的唯一原因是您是否需要附加一些自己的数据以在包装器中使用。唯一突然出现在我脑海中的是是否需要日志文件的句柄或包装器中的类似内容。

在相关的说明中，与 ! 的诱惑作斗争`using namespace stuff;`！始终使用命名空间限定来引用函数：

```
#include <stuff.h>
void some_function() {
    stuff::function_wrapper();
} 
```

代替：

```
#include <stuff.h>
using namespace stuff;
void some_function() {
    function_wrapper();
} 
```

好处是，如果您需要将 转换`namespace`为一个充满`static`方法的类，您可以轻松完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T11:12:51.977

我认为“一类一责任”的规则应该在这里指导你。这 60 个函数可能可以划分为不同的职责，并且每个职责都值得一个类。这也将为不受全局函数需求限制的 API 客户端提供更多的 OO 接口。

# opengl - OpenGL：渲染一批几何图形的有效方法？

> ID：487244
> 
> 赞同：12
> 
> 时间：2009-01-28T11:03:53.087
> 
> 标签：opengl, vbo

这是我一直在研究的东西，但我还没有找到任何具体的信息或好的例子。比如说，我有一堆未连接的对象（例如三角形条带）。渲染这些的有效方法是什么？

我听说将几个对象放在一个 VBO 中以减少 openGL 调用，但还没有看到如何做到这一点的适当示例。我也看到了与这个想法相矛盾的帖子。所以现在，我大多只是困惑。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-28T13:40:49.433

首先，您可能应该一直使用 VBO。适用于小型和大型物体。

那么，第二个问题是“如何将几个单独的对象组合成一个大对象？” - 以减少必须进行的 OpenGL 调用次数。通常，可以组合使用相同纹理、材质设置和着色器的对象。例如，如果您周围有大量相同的板条箱，则将它们组合成几个更大的“板条箱堆”可能是有意义的。

如果一个对象是一个三角形列表，那么组合很容易——只需从源列表中创建一个大的三角形列表。如果一个对象是一个三角形条带，那么你必须使用“退化三角形”来连接条带（如果它不能表示为单个条带，这对于单个对象也是非常有用的优化）。

“退化三角形”是具有两个或三个相同顶点索引的三角形。图形硬件可以识别它们并非常快速地跳过它们。

因此，如果您有，例如，两条带，每条带一个三角形，总共有六个顶点。

条带的原始三角形索引为：

```
1) 0, 1, 2
2) 0, 1, 2 
```

现在将所有顶点连接在一起，最终得到 6 个顶点。

```
1) 0, 1, 2 (unchanged)
2) 3, 4, 5 
```

现在你有一个顶点数组，但仍然有两个单独的条带。必须通过插入退化三角形来加入它们：

```
1) 0, 1, 2, 2, 2, 3, 4, 5 
```

*（我认为以上是正确的，但尚未实际验证）*

想法是这样的：使用上面的条带，显卡将从这些顶点中绘制出三角形：

```
0, 1, 2
1, 2, 2 <- degenerate! won't be drawn
2, 2, 2 <- degenerate! won't be drawn
2, 2, 3 <- degenerate! won't be drawn
3, 4, 5 
```

在一般情况下，您必须根据原始条带长度插入两个或三个退化三角形，以便三角形缠绕保持正确。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T11:21:00.243

查看[glDrawElements()](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/drawelements.html)，这是实现您想要的一种好方法。请注意，如果您的数据每帧都发生变化，性能可能会下降，因为您需要更新数据的相关部分，这意味着将它们复制到显卡的内存中。对于静态数据，这非常快。

# algorithm - “Big O”符号的简单英文解释是什么？

> ID：487258
> 
> 赞同：5208
> 
> 时间：2009-01-28T11:10:32.043
> 
> 标签：algorithm, complexity-theory, computer-science, big-o, time-complexity

我更喜欢尽可能少的正式定义和简单的数学。

* * *

## 回答 #1

> 赞同：6932
> 
> 时间：2009-01-28T11:18:57.817

快速说明，我的回答几乎肯定会混淆[Big Oh 表示法](http://en.wikipedia.org/wiki/Big_O_notation)（这是一个上限）和 Big Theta 表示法“Θ”（这是一个两侧的界限）。但根据我的经验，这实际上是非学术环境中的典型讨论。对造成的任何混乱表示歉意。

* * *

BigOh 复杂度可以用这个图来可视化：

![大哦分析](https://i.stack.imgur.com/WcBRI.png)

我可以为 Big Oh 符号给出的最简单的定义是：

**Big Oh 表示法是算法复杂性的相对表示。**

这句话中有一些重要且故意选择的词：

> *   **相对：**您只能将苹果与苹果进行比较。您无法将进行算术乘法的算法与对整数列表进行排序的算法进行比较。但是比较两种算法来进行算术运算（一个乘法，一个加法）会告诉你一些有意义的事情；
> *   **表示：** BigOh（以最简单的形式）将算法之间的比较简化为单个变量。该变量是根据观察或假设选择的。例如，排序算法通常基于比较操作（比较两个节点以确定它们的相对顺序）进行比较。这假设比较是昂贵的。但是，如果比较便宜但交换很昂贵怎么办？它改变了比较；和
> *   **复杂性：**如果我需要一秒钟来对 10,000 个元素进行排序，那么我需要多长时间才能对 100 万个元素进行排序？在这种情况下，复杂性是对其他事物的相对衡量。

阅读完其余部分后，请返回并重新阅读以上内容。

我能想到的 BigOh 最好的例子就是做算术。取两个数字（123456 和 789012）。我们在学校学到的基本算术运算是：

> *   添加;
> *   减法；
> *   乘法; 和
> *   分配。

这些中的每一个都是一个操作或一个问题。解决这些问题的方法称为**算法**。

加法是最简单的。您将数字排成一行（向右）并将数字添加到一列中，在结果中写入该加法的最后一个数字。该数字的“十”部分被转移到下一列。

让我们假设这些数字的相加是该算法中最昂贵的操作。理所当然地，要将这两个数字相加，我们必须将 6 个数字相加（并且可能带有第 7 个数字）。如果我们将两个 100 位数字相加，我们必须进行 100 次加法。如果我们将**两个**10,000 位数字相加，我们必须进行 10,000 次加法。

看到图案了吗？**复杂度**（即操作数）与较大数字中的位数*n*成正比。我们称之为**O(n)**或**线性复杂度**。

减法是类似的（除了你可能需要借而不是进位）。

乘法不同。您将数字排成一行，取底部数字中的第一个数字，然后将其与顶部数字中的每个数字依次相乘，依此类推。因此，要将我们的两个 6 位数字相乘，我们必须进行 36 次乘法。我们可能还需要添加多达 10 或 11 列才能获得最终结果。

如果我们有两个 100 位数字，我们需要进行 10,000 次乘法和 200 次加法。对于两个一百万位数的数字，我们需要进行一万亿（10 ^(12)）次乘法和两百万次加法。

由于算法以 n*平方*进行缩放，因此这是**O(n ² )**或**二次复杂度**。现在是介绍另一个重要概念的好时机：

**我们只关心复杂性中最重要的部分。**

精明的人可能已经意识到我们可以将操作数表示为：n ² + 2n。但正如您从我们的示例中看到的，每个数字都有两个百万位数，第二项 (2n) 变得微不足道（占该阶段总操作的 0.0002%）。

可以注意到，我们在这里假设了最坏的情况。在乘以 6 位数字时，如果其中一个有 4 位，另一个有 6 位，那么我们只有 24 次乘法。尽管如此，我们还是计算了那个“n”的最坏情况，即当两者都是 6 位数字时。因此，Big Oh 表示法是关于算法的最坏情况。

# 电话簿

我能想到的下一个最好的例子是电话簿，通常称为白页或类似名称，但它因国家而异。但我说的是按姓氏，然后是首字母或名字，可能是地址，然后是电话号码的人。

现在，如果你让计算机在包含 1,000,000 个姓名的电话簿中查找“John Smith”的电话号码，你会怎么做？忽略你可以猜到 S 开始多远的事实（假设你不能），你会怎么做？

一个典型的实现可能是打开中间，取第 500,000^个并将其与“Smith”进行比较。如果它恰好是“史密斯，约翰”，我们真的很幸运。更有可能的是，“John Smith”将出现在该名称之前或之后。如果是在我们之后将电话簿的后半部分分成两半并重复。如果在此之前，我们将电话簿的前半部分分成两半并重复。等等。

这称为**二进制搜索**，无论您是否意识到，每天都会在编程中使用它。

因此，如果您想在包含一百万个名字的电话簿中找到一个名字，您实际上最多可以通过这样做 20 次来找到任何名字。在比较搜索算法时，我们决定这个比较是我们的“n”。

> *   对于 3 个姓名的电话簿，最多需要 2 次比较。
> *   对于 7，最多需要 3 个。
> *   15个需要4个。
> *   …</li>
> *   1,000,000 需要 20。

这真是太好了，不是吗？

在 BigOh 术语中，这是**O(log n)**或**对数复杂度**。现在有问题的对数可能是 ln（以 e 为底）、log [10]、log [2]或其他一些底。没关系，它仍然是 O(log n)，就像 O(2n ² ) 和 O(100n ² ) 仍然都是 O(n ² )。

在这一点上值得解释一下，BigOh 可用于通过算法确定三种情况：

> *   **最佳情况：**在电话簿搜索中，最好的情况是我们在一次比较中找到姓名。这是**O(1)**或**恒定复杂度**；
> *   **预期情况：**如上所述，这是 O(log n); 和
> *   **最坏情况：**这也是 O(log n)。

通常我们不关心最好的情况。我们对预期和最坏的情况感兴趣。有时其中一个或另一个会更重要。

回到电话簿。

如果您有电话号码并想查找姓名怎么办？警方有一个反向电话簿，但公众拒绝进行此类查找。还是他们？从技术上讲，您可以反向查找普通电话簿中的号码。如何？

您从名字开始并比较数字。如果这是一场比赛，很好，如果不是，你继续下一场。你必须这样做，因为电话簿是**无序**的（无论如何都是通过电话号码）。

因此，要查找给定电话号码的名称（反向查找）：

> *   **最佳情况：** O(1)；
> *   **预期情况：** O(n)（对于 500,000）；和
> *   **最坏情况：** O(n)（对于 1,000,000）。

# 旅行推销员

这是计算机科学中一个非常著名的问题，值得一提。在这个问题中，你有 N 个城镇。这些城镇中的每一个都通过一定距离的道路与一个或多个其他城镇相连。旅行推销员问题是找到访问每个城镇的最短路径。

听起来很简单？再想想。

如果您有 3 个城镇 A、B 和 C，所有对之间都有道路，那么您可以去：

> *   A → B → C
> *   A → C → B
> *   B → C → A
> *   B → A → C
> *   C → A → B
> *   C → B → A

嗯，实际上比这要少，因为其中一些是等价的（例如，A → B → C 和 C → B → A 是等价的，因为它们使用相同的道路，只是相反）。

实际上，有3种可能。

> *   把它带到 4 个城镇，你就有（iirc）12 种可能性。
> *   5是60。
> *   6变成360。

**这是称为阶乘**的数学运算的函数。基本上：

> *   5！= 5 × 4 × 3 × 2 × 1 = 120
> *   6！= 6 × 5 × 4 × 3 × 2 × 1 = 720
> *   7！= 7 × 6 × 5 × 4 × 3 × 2 × 1 = 5040
> *   …</li>
> *   25！= 25 × 24 × … × 2 × 1 = 15,511,210,043,330,985,984,000,000
> *   …</li>
> *   50！= 50 × 49 × … × 2 × 1 = 3.04140932 × 10 ^(64)

所以旅行推销员问题的 BigOh 是**O(n!)**或**阶乘或组合复杂度**。

**当你到达 200 个城镇时，宇宙中已经没有足够的时间来解决传统计算机的问题了。**

需要考虑的事情。

# 多项式时间

我想快速提及的另一点是，任何复杂度为**O(n ^a )**的算法都被称为具有**多项式复杂度或可在****多项式时间内**求解。

O(n)、O(n ² ) 等都是多项式时间。有些问题不能在多项式时间内解决。正因为如此，世界上使用了某些东西。[公钥密码术](https://en.wikipedia.org/wiki/Public-key_cryptography)就是一个很好的例子。在计算上很难找到两个非常大的素数。如果不是，我们就无法使用我们使用的公钥系统。

无论如何，这就是我对 BigOh（修订版）的（希望是简单的英语）解释。

* * *

## 回答 #2

> 赞同：778
> 
> 时间：2009-01-28T11:28:23.523

它显示了算法如何根据输入大小进行缩放。

**O(n ² )** : 称为**二次复杂度**

*   1 项：1 次操作
*   10 项：100 次操作
*   100 项：10,000 次操作

请注意，项目的数量增加了 10 倍，但时间增加了 10 ²倍。基本上，n=10 等 O(n ² ) 为我们提供了比例因子 n ²，即 10 ²。

**O(n)**：称为**线性复杂度**

*   1 项：1 秒
*   10 项：10 秒
*   100 项：100 秒

这次项目的数量增加了 10 倍，时间也是如此。n=10，因此 O(n) 的比例因子为 10。

**O(1)**：称为**常数复杂度**

*   1 项：1 次操作
*   10 项：1 次操作
*   100 项：1 次操作

项目的数量仍然增加了 10 倍，但 O(1) 的比例因子始终为 1。

**O(log n)**：称为**对数复杂度**

*   1 项：1 次操作
*   10 项：2 次操作
*   100 项：3 次操作
*   1000 项：4 次操作
*   10,000 项：5 次操作

计算次数仅增加输入值的对数。所以在这种情况下，假设每次计算需要 1 秒，输入的对数`n`就是所需的时间，因此`log n`.

这就是它的要点。他们减少了数学，所以它可能不完全是 n ²或他们所说的任何东西，但这将是缩放的主要因素。

* * *

## 回答 #3

> 赞同：433
> 
> 时间：2011-07-08T04:46:50.113

* * *

## 回答 #4

> 赞同：254
> 
> 时间：2009-01-28T11:16:57.163

编辑：快速说明，这几乎肯定会将[Big O 表示法](http://en.wikipedia.org/wiki/Big_O_notation)（它是一个上限）与 Theta 表示法（它既是上限又是下限）混淆。以我的经验，这实际上是非学术环境中的典型讨论。对造成的任何混乱表示歉意。

一句话：随着你的工作规模越来越大，完成它需要多长时间？

显然，这只是使用“大小”作为输入，“所用时间”作为输出——如果你想谈论内存使用等，同样的想法也适用。

这是一个示例，我们有 N 件 T 恤要烘干。我们*假设*让它们处于干燥位置非常快（即人为交互可以忽略不计）。当然，现实生活中并非如此……

*   在外面使用晾衣绳：假设您有一个无限大的后院，洗涤物在 O(1) 时间内干燥。不管你有多少，它都会得到同样的阳光和新鲜空气，所以大小不会影响干燥时间。

*   使用滚筒式干衣机：您在每个负载中放入 10 件衬衫，然后它们在一个小时后完成。（忽略这里的实际数字——它们无关紧要。）因此，烘干 50 件衬衫所需的时间*大约*是烘干 10 件衬衫所需时间的 5 倍。

*   把所有东西都放在一个晾晒的柜子里：如果我们把所有东西都放在一大堆里，让一般的温暖来做，中间的衬衫需要很长时间才能变干。我不想猜测细节，但我怀疑这至少是 O(N^2) - 随着洗涤负荷的增加，干燥时间增加得更快。

“大 O”表示法的一个重要方面是它*没有*说明对于给定大小哪种算法更快。采用哈希表（字符串键，整数值）与对数组（字符串，整数）。基于字符串在哈希表中查找键或数组中的元素是否更快？（即对于数组，“找到字符串部分与给定键匹配的第一个元素。”）哈希表通常是摊销的（~=“平均”）O（1）——一旦它们被设置，它应该花费大约在 100 个条目表中查找条目与在 1,000,000 个条目表中查找条目的时间相同。在数组中查找元素（基于内容而不是索引）是线性的，即 O(N) — 平均而言，您将不得不查看一半的条目。

这是否使哈希表比查找数组更快？不必要。如果您有一个非常小的条目集合，那么数组可能会更快 - 您可以在计算您正在查看的字符串的哈希码所需的时间内检查所有字符串。然而，随着数据集变大，哈希表最终将击败数组。

* * *

## 回答 #5

> 赞同：136
> 
> 时间：2009-01-28T11:23:07.620

Big O 描述了当输入变大时函数增长行为的上限，例如程序的运行时间。

例子：

*   O(n)：如果我将输入大小加倍，则运行时间加倍

*   O(n ² )：如果输入大小翻倍，则运行时翻四倍

*   O(log n)：如果输入大小翻倍，则运行时间增加一

*   O(2 ^n )：如果输入大小增加一，运行时间加倍

输入大小通常是表示输入所需的位空间。

* * *

## 回答 #6

> 赞同：109
> 
> 时间：2011-09-05T16:31:43.940

Big O notation is most commonly used by programmers as an approximate measure of how long a computation (algorithm) will take to complete expressed as a function of the size of the input set.

Big O is useful to compare how well two algorithms will scale up as the number of inputs is increased.

More precisely [Big O notation](http://en.wikipedia.org/wiki/Big_O_notation) is used to express the asymptotic behavior of a function. That means how the function behaves as it approaches infinity.

In many cases the "O" of an algorithm will fall into one of the following cases:

*   **O(1)** - Time to complete is the same regardless of the size of input set. An example is accessing an array element by index.
*   **O(Log N)** - Time to complete increases roughly in line with the log2(n). For example 1024 items takes roughly twice as long as 32 items, because Log2(1024) = 10 and Log2(32) = 5\. An example is finding an item in a [binary search tree](http://en.wikipedia.org/wiki/Binary_search_tree) (BST).
*   **O(N)** - Time to complete that scales linearly with the size of the input set. In other words if you double the number of items in the input set, the algorithm takes roughly twice as long. An example is counting the number of items in a linked list.
*   **O(N Log N)** - Time to complete increases by the number of items times the result of Log2(N). An example of this is [heap sort](http://en.wikipedia.org/wiki/Heap_sort) and [quick sort](http://en.wikipedia.org/wiki/Quick_sort).
*   **O(N^2)** - Time to complete is roughly equal to the square of the number of items. An example of this is [bubble sort](http://en.wikipedia.org/wiki/Bubble_sort).
*   **O(N!)** - Time to complete is the factorial of the input set. An example of this is the [traveling salesman problem brute-force solution](http://en.wikipedia.org/wiki/Travelling_salesman_problem).

Big O ignores factors that do not contribute in a meaningful way to the growth curve of a function as the input size increases towards infinity. This means that constants that are added to or multiplied by the function are simply ignored.

* * *

## 回答 #7

> 赞同：88
> 
> 时间：2009-01-28T11:14:21.850

Big O 只是一种以常见方式“表达”自己的方式，“运行我的代码需要多少时间/空间？”。

你可能经常看到 O(n)、O(n ² )、O(nlogn) 等等，这些只是展示的方式；算法如何变化？

O(n) 表示大 O 是 n，现在你可能会想，“n 是什么！？” 那么“n”是元素的数量。成像您要在数组中搜索项目。您必须查看每个元素并作为“您是正确的元素/项目吗？” 在最坏的情况下，该项目位于最后一个索引处，这意味着它花费的时间与列表中的项目一样多，所以为了通用，我们说“哦，嘿，n 是一个公平的给定数量的值！” .

那么您可能会理解“n ² ”的含义，但更具体地说，请考虑一下您有一个简单、最简单的排序算法；冒泡排序。该算法需要针对每个项目查看整个列表。

我的列表

1.  1
2.  6
3.  3

这里的流程是：

*   比较 1 和 6，哪个最大？Ok 6 位置正确，继续前进！
*   比较 6 和 3，哦，3 少了！让我们移动它，好吧，列表改变了，我们需要从头开始！

这是 On n ²因为，您需要查看列表中的所有项目，其中有“n”个项目。对于每个项目，你再看一遍所有项目，为了比较，这也是“n”，所以对于每个项目，你看“n”次，意思是 n*n = n ²

我希望这和你想要的一样简单。

但请记住，Big O 只是一种以时空方式表达自己的方式。

* * *

## 回答 #8

> 赞同：58
> 
> 时间：2009-01-28T13:12:24.403

**Big O 描述了算法的基本缩放性质。**

Big O 没有告诉你关于给定算法的很多信息。它切入骨干，仅提供有关算法缩放性质的信息，特别是算法的资源使用（思考时间或内存）如何响应“输入大小”而缩放。

考虑蒸汽机和火箭之间的区别。它们不仅是同一事物的不同品种（例如，普锐斯发动机与兰博基尼发动机），而且它们的核心是截然不同的推进系统。蒸汽机可能比玩具火箭快，但没有蒸汽活塞发动机能够达到轨道运载火箭的速度。这是因为这些系统在达到给定速度（“输入大小”）所需的燃料（“资源使用”）关系方面具有不同的缩放特性。

为什么这个这么重要？因为软件处理的问题的大小可能相差多达一万亿倍。考虑一下。前往月球所需的速度与人类步行速度之间的比率小于 10,000:1，与软件可能面临的输入大小范围相比，这绝对是微不足道的。并且由于软件可能面临输入大小的天文数字范围，因此算法的大 O 复杂性（它是基本的缩放性质）可能胜过任何实现细节。

考虑规范排序示例。冒泡排序是 O(n ² )，而合并排序是 O(n log n)。假设您有两个排序应用程序，应用程序 A 使用冒泡排序，应用程序 B 使用合并排序，假设对于大约 30 个元素的输入大小，应用程序 A 在排序时比应用程序 B 快 1,000 倍。如果您不必对超过 30 个元素进行排序，那么显然您应该更喜欢应用程序 A，因为在这些输入大小下它要快得多。但是，如果您发现您可能需要对一千万个项目进行排序，那么您所期望的是，在这种情况下，应用程序 B 实际上最终比应用程序 A 快数千倍，这完全是由于每种算法的扩展方式。

* * *

## 回答 #9

> 赞同：45
> 
> 时间：2014-01-27T23:09:37.870

Here is the plain English bestiary I tend to use when explaining the common varieties of Big-O

In all cases, prefer algorithms higher up on the list to those lower on the list. However, the cost of moving to a more expensive complexity class varies significantly.

**O(1):**

No growth. Regardless of how big as the problem is, you can solve it in the same amount of time. This is somewhat analogous to broadcasting where it takes the same amount of energy to broadcast over a given distance, regardless of the number of people that lie within the broadcast range.

**O(log *n*):**

This complexity is the same as **O(1)** except that it's just a little bit worse. For all practical purposes, you can consider this as a very large constant scaling. The difference in work between processing 1 thousand and 1 billion items is only a factor six.

**O(*n*):**

The cost of solving the problem is proportional to the size of the problem. If your problem doubles in size, then the cost of the solution doubles. Since most problems have to be scanned into the computer in some way, as data entry, disk reads, or network traffic, this is generally an affordable scaling factor.

**O(*n* log *n*):**

This complexity is very similar to **O(*n*)**. For all practical purposes, the two are equivalent. This level of complexity would generally still be considered scalable. By tweaking assumptions some **O(*n* log *n*)** algorithms can be transformed into **O(*n*)** algorithms. For example, bounding the size of keys reduces sorting from **O(*n* log *n*)** to **O(*n*)**.

**O(*n*²):**

Grows as a square, where *n* is the length of the side of a square. This is the same growth rate as the "network effect", where everyone in a network might know everyone else in the network. Growth is expensive. Most scalable solutions cannot use algorithms with this level of complexity without doing significant gymnastics. This generally applies to all other polynomial complexities - **O(*n*^k)** - as well.

**O(2^(*n*)):**

Does not scale. You have no hope of solving any non-trivially sized problem. Useful for knowing what to avoid, and for experts to find approximate algorithms which are in **O(*n*^k)**.

* * *

## 回答 #10

> 赞同：38
> 
> 时间：2009-01-28T11:19:29.500

大 O 衡量算法相对于其输入大小使用了多少时间/空间。

如果算法是 O(n)，那么时间/空间将以与其输入相同的速率增加。

如果算法为 O(n ² )，则时间/空间以其输入平方的速率增加。

等等。

* * *

## 回答 #11

> 赞同：37
> 
> 时间：2013-05-29T13:51:20.603

It is very difficult to measure the speed of software programs, and when we try, the answers can be very complex and filled with exceptions and special cases. This is a big problem, because all those exceptions and special cases are distracting and unhelpful when we want to compare two different programs with one another to find out which is "fastest".

As a result of all this unhelpful complexity, people try to describe the speed of software programs using the smallest and least complex (mathematical) expressions possible. These expressions are very very crude approximations: Although, with a bit of luck, they will capture the "essence" of whether a piece of software is fast or slow.

Because they are approximations, we use the letter "O" (Big Oh) in the expression, as a convention to signal to the reader that we are making a gross oversimplification. (And to make sure that nobody mistakenly thinks that the expression is in any way accurate).

If you read the "Oh" as meaning "on the order of" or "approximately" you will not go too far wrong. (I think the choice of the Big-Oh might have been an attempt at humour).

The only thing that these "Big-Oh" expressions try to do is to describe how much the software slows down as we increase the amount of data that the software has to process. If we double the amount of data that needs to be processed, does the software need twice as long to finish it's work? Ten times as long? In practice, there are a very limited number of big-Oh expressions that you will encounter and need to worry about:

The good:

*   `O(1)` **Constant**: The program takes the same time to run no matter how big the input is.
*   `O(log n)` **Logarithmic**: The program run-time increases only slowly, even with big increases in the size of the input.

The bad:

*   `O(n)` **Linear**: The program run-time increases proportionally to the size of the input.
*   `O(n^k)` **Polynomial**: - Processing time grows faster and faster - as a polynomial function - as the size of the input increases.

... and the ugly:

*   `O(k^n)` **Exponential** The program run-time increases very quickly with even moderate increases in the size of the problem - it is only practical to process small data sets with exponential algorithms.
*   `O(n!)` **Factorial** The program run-time will be longer than you can afford to wait for anything but the very smallest and most trivial-seeming datasets.

* * *

## 回答 #12

> 赞同：36
> 
> 时间：2013-02-22T01:00:27.490

> What is a plain English explanation of Big O? With as little formal definition as possible and simple mathematics.

**A Plain English Explanation of the *Need* for Big-O Notation:**

When we program, we are trying to solve a problem. What we code is called an algorithm. Big O notation allows us to compare the worse case performance of our algorithms in a standardized way. Hardware specs vary over time and improvements in hardware can reduce the time it takes an algorithms to run. But replacing the hardware does not mean our algorithm is any better or improved over time, as our algorithm is still the same. So in order to allow us to compare different algorithms, to determine if one is better or not, we use Big O notation.

**A Plain English Explanation of *What* Big O Notation is:**

Not all algorithms run in the same amount of time, and can vary based on the number of items in the input, which we'll call *n*. Based on this, we consider the worse case analysis, or an upper-bound of the run-time as *n* get larger and larger. We must be aware of what *n* is, because many of the Big O notations reference it.

* * *

## 回答 #13

> 赞同：32
> 
> 时间：2011-08-23T04:06:03.963

Ok, my 2cents.

Big-O, is **rate of increase** of resource consumed by program, w.r.t. problem-instance-size

Resource : Could be total-CPU time, could be maximum RAM space. By default refers to CPU time.

Say the problem is "Find the sum",

```
int Sum(int*arr,int size){
      int sum=0;
      while(size-->0) 
         sum+=arr[size]; 

      return sum;
} 
```

problem-instance= {5,10,15} ==> problem-instance-size = 3, iterations-in-loop= 3

problem-instance= {5,10,15,20,25} ==> problem-instance-size = 5 iterations-in-loop = 5

For input of size "n" the program is growing at speed of "n" iterations in array. Hence Big-O is N expressed as O(n)

Say the problem is "Find the Combination",

```
 void Combination(int*arr,int size)
    { int outer=size,inner=size;
      while(outer -->0) {
        inner=size;
        while(inner -->0)
          cout<<arr[outer]<<"-"<<arr[inner]<<endl;
      }
    } 
```

problem-instance= {5,10,15} ==> problem-instance-size = 3, total-iterations = 3*3 = 9

problem-instance= {5,10,15,20,25} ==> problem-instance-size = 5, total-iterations= 5*5 =25

For input of size "n" the program is growing at speed of "n*n" iterations in array. Hence Big-O is N² expressed as O(n²)

* * *

## 回答 #14

> 赞同：31
> 
> 时间：2013-11-13T10:23:28.960

A simple straightforward answer can be:

Big O represents the worst possible time/space for that algorithm. The algorithm will never take more space/time above that limit. Big O represents time/space complexity in the extreme case.

* * *

## 回答 #15

> 赞同：29
> 
> 时间：2010-07-17T02:29:35.880

大 O 表示法是一种在空间或运行时间方面描述算法上限的方法。n 是问题中元素的数量（即数组的大小、树中的节点数等）。我们感兴趣的是描述随着 n 变大的运行时间。

当我们说某个算法是 O(f(n)) 时，我们是在说该算法的运行时间（或所需空间）总是低于某个常数时间 f(n)。

说二分查找的运行时间为 O(logn) 就是说存在一些常数 c，你可以将它乘以 log(n) 总是大于二分查找的运行时间。在这种情况下，您将始终有一些 log(n) 比较的常数因子。

换句话说，其中 g(n) 是算法的运行时间，我们说 g(n) = O(f(n)) 当 g(n) <= c*f(n) 当 n > k 时，其中c 和 k 是一些常数。

* * *

## 回答 #16

> 赞同：28
> 
> 时间：2013-08-15T01:57:54.307

> "*What is a plain English explanation of Big O? With as little formal definition as possible and simple mathematics.*"

Such a beautifully simple and short question seems at least to deserve an equally short answer, like a student might receive during tutoring.

> Big O notation simply tells how much time* an algorithm can run within, in terms of *only the amount of input data***.

( *in a wonderful, *unit-free* sense of time!)
(**which is what matters, because people will [*always* want more](http://www.youtube.com/watch?v=OnA3C9Af_oc), whether they live today or tomorrow)

Well, what's so wonderful about Big O notation if that's what it does?

*   Practically speaking, Big O analysis is *so useful and important* because Big O puts the focus squarely on the algorithm's *own* complexity and completely *ignores* anything that is merely a proportionality constant—like a JavaScript engine, the speed of a CPU, your Internet connection, and all those things which become quickly become as laughably outdated as a Model *T*. Big O focuses on performance only in the way that matters equally as much to people living in the present or in the future.

*   Big O notation also shines a spotlight directly on the most important principle of computer programming/engineering, the fact which inspires all good programmers to keep thinking and dreaming: the only way to achieve results beyond the slow forward march of technology is to *invent a better algorithm*.

* * *

## 回答 #17

> 赞同：26
> 
> 时间：2013-03-23T15:19:15.313

**Algorithm example (Java):**

```
public boolean search(/* for */Integer K,/* in */List</* of */Integer> L)
{
    for(/* each */Integer i:/* in */L)
    {
        if(i == K)
        {
            return true;
        }
    }

    return false;
} 
```

**Algorithm description:**

*   This algorithm searches a list, item by item, looking for a key,

*   Iterating on each item in the list, if it's the key then return True,

*   If the loop has finished without finding the key, return False.

*Big-O notation represents the upper-bound on the Complexity (Time, Space, ..)*

**To find The Big-O on Time Complexity:**

*   Calculate how much time (regarding input size) the worst case takes:

*   Worst-Case: the key doesn't exist in the list.

*   Time(Worst-Case) = 4n+1

*   Time: O(4n+1) = O(n) | in Big-O, constants are neglected

*   O(n) ~ Linear

**There's also Big-Omega, which represent the complexity of the Best-Case:**

*   Best-Case: the key is the first item.

*   Time(Best-Case) = 4

*   Time: Ω(4) = O(1) ~ Instant\Constant

* * *

## 回答 #18

> 赞同：21
> 
> 时间：2014-06-25T20:32:59.110

Big O notation is a way of describing how quickly an algorithm will run given an arbitrary number of input parameters, which we'll call "n". It is useful in computer science because different machines operate at different speeds, and simply saying that an algorithm takes 5 seconds doesn't tell you much because while you may be running a system with a 4.5 Ghz octo-core processor, I may be running a 15 year old, 800 Mhz system, which could take longer regardless of the algorithm. So instead of specifying how fast an algorithm runs in terms of time, we say how fast it runs in terms of number of input parameters, or "n". By describing algorithms in this way, we are able to compare the speeds of algorithms without having to take into account the speed of the computer itself.

* * *

## 回答 #19

> 赞同：20
> 
> 时间：2013-03-15T21:18:33.570

**Big O**

*f*(x) = O(*g*(x)) when x goes to a (for example, a = +∞) means that there is a function *k* such that:

1.  *f*(x) = *k*(x)*g*(x)

2.  k is bounded in some neighborhood of a (if a = +∞, this means that there are numbers N and M such that for every x > N, |*k*(x)| < M).

In other words, in plain English: *f*(x) = O(*g*(x)), x → a, means that in a neighborhood of a, *f* decomposes into the product of *g* and some bounded function.

**Small o**

By the way, here is for comparison the definition of small o.

*f*(x) = o(*g*(x)) when x goes to a means that there is a function k such that:

1.  *f*(x) = *k*(x)*g*(x)

2.  *k*(x) goes to 0 when x goes to a.

*Examples*

*   sin x = O(x) when x → 0.

*   sin x = O(1) when x → +∞,

*   x² + x = O(x) when x → 0,

*   x² + x = O(x²) when x → +∞,

*   ln(x) = o(x) = O(x) when x → +∞.

**Attention!** The notation with the equal sign "=" uses a "fake equality": it is true that o(g(x)) = O(g(x)), but false that O(g(x)) = o(g(x)). Similarly, it is ok to write "ln(x) = o(x) when x → +∞", but the formula "o(x) = ln(x)" would make no sense.

*More examples*

*   O(1) = O(n) = O(n²) when n → +∞ (but not the other way around, the equality is "fake"),

*   O(n) + O(n²) = O(n²) when n → +∞</p>

*   O(O(n²)) = O(n²) when n → +∞</p>

*   O(n²)O(n³) = O(n⁵) when n → +∞</p>

* * *

Here is the Wikipedia article: [https://en.wikipedia.org/wiki/Big_O_notation](https://en.wikipedia.org/wiki/Big_O_notation)

* * *

## 回答 #20

> 赞同：14
> 
> 时间：2015-12-27T10:34:52.030

You want to know all there is to know of big O? So do I.

So to talk of big O, I will use words that have just one beat in them. One sound per word. Small words are quick. You know these words, and so do I. We will use words with one sound. They are small. I am sure you will know all of the words we will use!

Now, let’s you and me talk of work. Most of the time, I do not like work. Do you like work? It may be the case that you do, but I am sure I do not.

I do not like to go to work. I do not like to spend time at work. If I had my way, I would like just to play, and do fun things. Do you feel the same as I do?

Now at times, I do have to go to work. It is sad, but true. So, when I am at work, I have a rule: I try to do less work. As near to no work as I can. Then I go play!

So here is the big news: the big O can help me not to do work! I can play more of the time, if I know big O. Less work, more play! That is what big O helps me do.

Now I have some work. I have this list: one, two, three, four, five, six. I must add all things in this list.

Wow, I hate work. But oh well, I have to do this. So here I go.

One plus two is three… plus three is six... and four is... I don’t know. I got lost. It is too hard for me to do in my head. I don’t much care for this kind of work.

So let's not do the work. Let's you and me just think how hard it is. How much work would I have to do, to add six numbers?

Well, let’s see. I must add one and two, and then add that to three, and then add that to four… All in all, I count six adds. I have to do six adds to solve this.

Here comes big O, to tell us just how hard this math is.

Big O says: we must do six adds to solve this. One add, for each thing from one to six. Six small bits of work... each bit of work is one add.

Well, I will not do the work to add them now. But I know how hard it would be. It would be six adds.

Oh no, now I have more work. Sheesh. Who makes this kind of stuff?!

Now they ask me to add from one to ten! Why would I do that? I did not want to add one to six. To add from one to ten… well… that would be even more hard!

How much more hard would it be? How much more work would I have to do? Do I need more or less steps?

Well, I guess I would have to do ten adds… one for each thing from one to ten. Ten is more than six. I would have to work that much more to add from one to ten, than one to six!

I do not want to add right now. I just want to think on how hard it might be to add that much. And, I hope, to play as soon as I can.

To add from one to six, that is some work. But do you see, to add from one to ten, that is more work?

Big O is your friend and mine. Big O helps us think on how much work we have to do, so we can plan. And, if we are friends with big O, he can help us choose work that is not so hard!

Now we must do new work. Oh, no. I don’t like this work thing at all.

The new work is: add all things from one to n.

Wait! What is n? Did I miss that? How can I add from one to n if you don’t tell me what n is?

Well, I don’t know what n is. I was not told. Were you? No? Oh well. So we can’t do the work. Whew.

But though we will not do the work now, we can guess how hard it would be, if we knew n. We would have to add up n things, right? Of course!

Now here comes big O, and he will tell us how hard this work is. He says: to add all things from one to N, one by one, is O(n). To add all these things, [I know I must add n times.][1] That is big O! He tells us how hard it is to do some type of work.

To me, I think of big O like a big, slow, boss man. He thinks on work, but he does not do it. He might say, "That work is quick." Or, he might say, "That work is so slow and hard!" But he does not do the work. He just looks at the work, and then he tells us how much time it might take.

I care lots for big O. Why? I do not like to work! No one likes to work. That is why we all love big O! He tells us how fast we can work. He helps us think of how hard work is.

Uh oh, more work. Now, let’s not do the work. But, let’s make a plan to do it, step by step.

They gave us a deck of ten cards. They are all mixed up: seven, four, two, six… not straight at all. And now... our job is to sort them.

Ergh. That sounds like a lot of work!

How can we sort this deck? I have a plan.

I will look at each pair of cards, pair by pair, through the deck, from first to last. If the first card in one pair is big and the next card in that pair is small, I swap them. Else, I go to the next pair, and so on and so on... and soon, the deck is done.

When the deck is done, I ask: did I swap cards in that pass? If so, I must do it all once more, from the top.

At some point, at some time, there will be no swaps, and our sort of the deck would be done. So much work!

Well, how much work would that be, to sort the cards with those rules?

I have ten cards. And, most of the time -- that is, if I don’t have lots of luck -- I must go through the whole deck up to ten times, with up to ten card swaps each time through the deck.

Big O, help me!

Big O comes in and says: for a deck of n cards, to sort it this way will be done in O(N squared) time.

Why does he say n squared?

Well, you know n squared is n times n. Now, I get it: n cards checked, up to what might be n times through the deck. That is two loops, each with n steps. That is n squared much work to be done. A lot of work, for sure!

Now when big O says it will take O(n squared) work, he does not mean n squared adds, on the nose. It might be some small bit less, for some case. But in the worst case, it will be near n squared steps of work to sort the deck.

Now here is where big O is our friend.

Big O points out this: as n gets big, when we sort cards, the job gets MUCH MUCH MORE HARD than the old just-add-these-things job. How do we know this?

Well, if n gets real big, we do not care what we might add to n or n squared.

For big n, n squared is more large than n.

Big O tells us that to sort things is more hard than to add things. O(n squared) is more than O(n) for big n. That means: if n gets real big, to sort a mixed deck of n things MUST take more time, than to just add n mixed things.

Big O does not solve the work for us. Big O tells us how hard the work is.

I have a deck of cards. I did sort them. You helped. Thanks.

Is there a more fast way to sort the cards? Can big O help us?

Yes, there is a more fast way! It takes some time to learn, but it works... and it works quite fast. You can try it too, but take your time with each step and do not lose your place.

In this new way to sort a deck, we do not check pairs of cards the way we did a while ago. Here are your new rules to sort this deck:

One: I choose one card in the part of the deck we work on now. You can choose one for me if you like. (The first time we do this, “the part of the deck we work on now” is the whole deck, of course.)

Two: I splay the deck on that card you chose. What is this splay; how do I splay? Well, I go from the start card down, one by one, and I look for a card that is more high than the splay card.

Three: I go from the end card up, and I look for a card that is more low than the splay card.

Once I have found these two cards, I swap them, and go on to look for more cards to swap. That is, I go back to step Two, and splay on the card you chose some more.

At some point, this loop (from Two to Three) will end. It ends when both halves of this search meet at the splay card. Then, we have just splayed the deck with the card you chose in step One. Now, all the cards near the start are more low than the splay card; and the cards near the end are more high than the splay card. Cool trick!

Four (and this is the fun part): I have two small decks now, one more low than the splay card, and one more high. Now I go to step one, on each small deck! That is to say, I start from step One on the first small deck, and when that work is done, I start from step One on the next small deck.

I break up the deck in parts, and sort each part, more small and more small, and at some time I have no more work to do. Now this may seem slow, with all the rules. But trust me, it is not slow at all. It is much less work than the first way to sort things!

What is this sort called? It is called Quick Sort! That sort was made by a man called [C. A. R. Hoare](https://en.wikipedia.org/wiki/Tony_Hoare) and he called it Quick Sort. Now, Quick Sort gets used all the time!

Quick Sort breaks up big decks in small ones. That is to say, it breaks up big tasks in small ones.

Hmmm. There may be a rule in there, I think. To make big tasks small, break them up.

This sort is quite quick. How quick? Big O tells us: this sort needs O(n log n) work to be done, in the mean case.

Is it more or less fast than the first sort? Big O, please help!

The first sort was O(n squared). But Quick Sort is O(n log n). You know that n log n is less than n squared, for big n, right? Well, that is how we know that Quick Sort is fast!

If you have to sort a deck, what is the best way? Well, you can do what you want, but I would choose Quick Sort.

Why do I choose Quick Sort? I do not like to work, of course! I want work done as soon as I can get it done.

How do I know Quick Sort is less work? I know that O(n log n) is less than O(n squared). The O's are more small, so Quick Sort is less work!

Now you know my friend, Big O. He helps us do less work. And if you know big O, you can do less work too!

You learned all that with me! You are so smart! Thank you so much!

Now that work is done, let’s go play!

* * *

[1]: There is a way to cheat and add all the things from one to n, all at one time. Some kid named Gauss found this out when he was eight. I am not that smart though, so [don't ask me how he did it](http://nzmaths.co.nz/gauss-trick-staff-seminar).

* * *

## 回答 #21

> 赞同：13
> 
> 时间：2012-09-29T20:54:23.713

Not sure I'm further contributing to the subject but still thought I'd share: I once found [this blog post](http://rob-bell.net/2009/06/a-beginners-guide-to-big-o-notation/) to have some quite helpful (though very basic) explanations & examples on Big O:

Via examples, this helped get the bare basics into my tortoiseshell-like skull, so I think it's a pretty descent 10-minute read to get you headed in the right direction.

* * *

## 回答 #22

> 赞同：12
> 
> 时间：2013-10-25T15:11:17.940

Assume we're talking about an algorithm **A**, which should do something with a dataset of size **n**.

Then `O( <some expression X involving n> )` means, in simple English:

> **If you're unlucky when executing A, it might take as much as X(n) operations to complete.**

As it happens, there are certain functions (think of them as *implementations* of **X(n)**) that tend to occur quite often. These are well known and easily compared (Examples: `1`, `Log N`, `N`, `N^2`, `N!`, etc..)

By comparing these when talking about **A** and other algorithms, it is easy to rank the algorithms according to the number of operations they *may* (worst-case) require to complete.

In general, our goal will be to find or structure an algorithm **A** in such a way that it will have a function `X(n)` that returns as low a number as possible.

* * *

## 回答 #23

> 赞同：12
> 
> 时间：2015-01-30T07:00:50.920

I've more simpler way to understand the time complexity he most common metric for calculating time complexity is Big O notation. This removes all constant factors so that the running time can be estimated in relation to N as N approaches infinity. In general you can think of it like this:

```
statement; 
```

Is constant. The running time of the statement will not change in relation to N

```
for ( i = 0; i < N; i++ )
  statement; 
```

Is linear. The running time of the loop is directly proportional to N. When N doubles, so does the running time.

```
for ( i = 0; i < N; i++ ) 
{
for ( j = 0; j < N; j++ )
  statement;
} 
```

Is quadratic. The running time of the two loops is proportional to the square of N. When N doubles, the running time increases by N * N.

```
while ( low <= high ) 
{
 mid = ( low + high ) / 2;
 if ( target < list[mid] )
 high = mid - 1;
 else if ( target > list[mid] )
  low = mid + 1;
else break;
} 
```

Is logarithmic. The running time of the algorithm is proportional to the number of times N can be divided by 2\. This is because the algorithm divides the working area in half with each iteration.

```
void quicksort ( int list[], int left, int right )
{
  int pivot = partition ( list, left, right );
  quicksort ( list, left, pivot - 1 );
  quicksort ( list, pivot + 1, right );
} 
```

Is N * log ( N ). The running time consists of N loops (iterative or recursive) that are logarithmic, thus the algorithm is a combination of linear and logarithmic.

In general, doing something with every item in one dimension is linear, doing something with every item in two dimensions is quadratic, and dividing the working area in half is logarithmic. There are other Big O measures such as cubic, exponential, and square root, but they're not nearly as common. Big O notation is described as O ( ) where is the measure. The quicksort algorithm would be described as O ( N * log ( N ) ).

Note: None of this has taken into account best, average, and worst case measures. Each would have its own Big O notation. Also note that this is a VERY simplistic explanation. Big O is the most common, but it's also more complex that I've shown. There are also other notations such as big omega, little o, and big theta. You probably won't encounter them outside of an algorithm analysis course.

*   See more at: [Here](http://proprogramming.org/2015/01/how-to-calculate-time-complexity-of.html#sthash.URrGFhqm.dpuf)

* * *

## 回答 #24

> 赞同：11
> 
> 时间：2015-05-16T16:02:02.267

If you have a suitable notion of infinity in your head, then there is a very brief description:

> Big O notation tells you the cost of solving an infinitely large problem.

And furthermore

> Constant factors are negligible

If you upgrade to a computer that can run your algorithm twice as fast, big O notation won't notice that. Constant factor improvements are too small to even be noticed in the scale that big O notation works with. Note that this is an intentional part of the design of big O notation.

Although anything "larger" than a constant factor can be detected, however.

When interested in doing computations whose size is "large" enough to be considered as approximately infinity, then big O notation is approximately the cost of solving your problem.

* * *

If the above doesn't make sense, then you don't have a compatible intuitive notion of infinity in your head, and you should probably disregard all of the above; the only way I know to make these ideas rigorous, or to explain them if they aren't already intuitively useful, is to first teach you big O notation or something similar. (although, once you well understand big O notation in the future, it may be worthwhile to revisit these ideas)

* * *

## 回答 #25

> 赞同：11
> 
> 时间：2015-12-06T06:01:13.677

Say you order Harry Potter: Complete 8-Film Collection [Blu-ray] from Amazon and download the same film collection online at the same time. You want to test which method is faster. The delivery takes almost a day to arrive and the download completed about 30 minutes earlier. Great! So it’s a tight race.

What if I order several Blu-ray movies like The Lord of the Rings, Twilight, The Dark Knight Trilogy, etc. and download all the movies online at the same time? This time, the delivery still take a day to complete, but the online download takes 3 days to finish. For online shopping, the number of purchased item (input) doesn’t affect the delivery time. The output is constant. We call this **O(1)**.

For online downloading, the download time is directly proportional to the movie file sizes (input). We call this **O(n)**.

From the experiments, we know that online shopping scales better than online downloading. It is very important to understand big O notation because it helps you to analyze the **scalability** and **efficiency** of algorithms.

**Note:** Big O notation represents the **worst-case scenario** of an algorithm. Let’s assume that **O(1)** and **O(n)** are the worst-case scenarios of the example above.

**Reference** : [http://carlcheo.com/compsci](http://carlcheo.com/compsci)

* * *

## 回答 #26

> 赞同：11
> 
> 时间：2018-04-13T12:36:18.870

> What is a plain English explanation of “Big O” notation?

Very Quick Note:

The O in "Big O" refers to as "Order"(or precisely "order of")
so you could get its idea literally that it's used to order something to compare them.

*   **"Big O" does two things:**

    1.  Estimates how many steps of the method your computer applies to accomplish a task.
    2.  Facilitate the process to compare with others in order to determine whether it's good or not?
    3.  "Big O' achieves the above two with standardized `Notations`.
*   **There are seven most used notations**

    1.  O(1), means your computer gets a task done with `1` step, it's excellent, Ordered No.1
    2.  O(logN), means your computer complete a task with `logN` steps, its good, Ordered No.2
    3.  O(N), finish a task with `N` steps, its fair, Order No.3
    4.  O(NlogN), ends a task with `O(NlogN)` steps, it's not good, Order No.4
    5.  O(N^2), get a task done with `N^2` steps, it's bad, Order No.5
    6.  O(2^N), get a task done with `2^N` steps, it's horrible, Order No.6
    7.  O(N!), get a task done with `N!` steps, it's terrible, Order No.7

[![enter image description here](https://i.stack.imgur.com/6zHEt.png)](https://i.stack.imgur.com/6zHEt.png)

Suppose you get notation `O(N^2)`, not only you are clear the method takes N*N steps to accomplish a task, also you see that it's not good as `O(NlogN)` from its ranking.

Please note the order at line end, just for your better understanding.There's more than 7 notations if all possibilities considered.

In CS, the set of steps to accomplish a task is called algorithms.
In Terminology, Big O notation is used to describe the performance or complexity of an algorithm.

In addition, Big O establishes the worst-case or measure the Upper-Bound steps.
You could refer to Big-Ω (Big-Omega) for best case.

[Big-Ω (Big-Omega) notation (article) | Khan Academy](https://www.khanacademy.org/computing/computer-science/algorithms/asymptotic-notation/a/big-big-omega-notation)

*   **Summary**
    "Big O" describes the algorithm's performance and evaluates it.

    or address it formally, "Big O" classifies the algorithms and standardize the comparison process.

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2018-05-11T08:33:03.180

***Definition :- Big O notation is a notation which says how a algorithm performance will perform if the data input increases.***

When we talk about algorithms there are 3 important pillars Input , Output and Processing of algorithm. Big O is symbolic notation which says if the data input is increased in what rate will the performance vary of the algorithm processing.

I would encourage you to see this youtube video which explains [Big O Notation](https://www.youtube.com/watch?v=k6kxtzICG_g) in depth with code examples.

[![Algorithm basic pillars](https://i.stack.imgur.com/nuFCp.png)](https://i.stack.imgur.com/nuFCp.png)

So for example assume that a algorithm takes 5 records and the time required for processing the same is 27 seconds. Now if we increase the records to 10 the algorithm takes 105 seconds.

In simple words the time taken is square of the number of records. We can denote this by **O(n ^ 2)**. This symbolic representation is termed as Big O notation.

Now please note the units can be anything in inputs it can be bytes , bits number of records , the performance can be measured in any unit like second , minutes , days and so on. So its not the exact unit but rather the relationship.

[![Big O symbols](https://i.stack.imgur.com/ZnRL6.png)](https://i.stack.imgur.com/ZnRL6.png)

For example look at the below function "Function1" which takes a collection and does processing on the first record. Now for this function the performance will be same irrespective you put 1000 , 10000 or 100000 records. So we can denote it by **O(1)**.

```
void Function1(List<string> data)
{
string str = data[0];
} 
```

Now see the below function "Function2()". In this case the processing time will increase with number of records. We can denote this algorithm performance using **O(n)**.

```
void Function2(List<string> data)
        {
            foreach(string str in data)
            {
                if (str == "shiv")
                {
                    return;
                }
            }
        } 
```

When we see a Big O notation for any algorithm we can classify them in to three categories of performance :-

1.  Log and constant category :- Any developer would love to see their algorithm performance in this category.
2.  Linear :- Developer will not want to see algorithms in this category , until its the last option or the only option left.
3.  Exponential :- This is where we do not want to see our algorithms and a rework is needed.

So by looking at Big O notation we categorize good and bad zones for algorithms.

[![Bog O classification](https://i.stack.imgur.com/N2k4s.png)](https://i.stack.imgur.com/N2k4s.png)

I would recommend you to watch this 10 minutes video which discusses Big O with sample code

[https://www.youtube.com/watch?v=k6kxtzICG_g](https://www.youtube.com/watch?v=k6kxtzICG_g)

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2015-08-16T20:38:14.153

**Simplest way to look at it (in plain English)**

We are trying to see how the number of input parameters, affects the running time of an algorithm. If the running time of your application is proportional to the number of input parameters, then it is said to be in Big O of n.

The above statement is a good start but not completely true.

**A more accurate explanation (mathematical)**

Suppose

n=number of input parameters

T(n)= The actual function that expresses the running time of the algorithm as a function of n

c= a constant

f(n)= An approximate function that expresses the running time of the algorithm as a function of n

Then as far as Big O is concerned, the approximation f(n) is considered good enough as long as the below condition is true.

```
lim     T(n) ≤ c×f(n)
n→∞ 
```

The equation is read as As n approaches infinity, T of n, is less than or equal to c times f of n.

In big O notation this is written as

```
T(n)∈O(n) 
```

This is read as T of n is in big O of n.

**Back to English**

Based on the mathematical definition above, if you say your algorithm is a Big O of n, it means it is a function of n (number of input parameters) **or faster**. If your algorithm is Big O of n, then it is also automatically the Big O of n square.

Big O of n means my algorithm runs at least as fast as this. You cannot look at Big O notation of your algorithm and say its slow. You can only say its fast.

Check [this](https://www.youtube.com/watch?v=V1xXmQkzkZI&index=13&list=PLZBP-86GmPTxpbvoFFzad0qYw5dKA8MV2) out for a video tutorial on Big O from UC Berkley. It is actually a simple concept. If you hear professor Shewchuck (aka God level teacher) explaining it, you will say "Oh that's all it is!".

* * *

## 回答 #29

> 赞同：8
> 
> 时间：2017-01-29T15:39:38.427

I found a really great explanation about big O notation especially for a someone who's not much into mathematics.

[https://rob-bell.net/2009/06/a-beginners-guide-to-big-o-notation/](https://rob-bell.net/2009/06/a-beginners-guide-to-big-o-notation/)

> Big O notation is used in Computer Science to describe the performance or complexity of an algorithm. Big O specifically describes the worst-case scenario, and can be used to describe the execution time required or the space used (e.g. in memory or on disk) by an algorithm.
> 
> Anyone who's read Programming Pearls or any other Computer Science books and doesn’t have a grounding in Mathematics will have hit a wall when they reached chapters that mention O(N log N) or other seemingly crazy syntax. Hopefully this article will help you gain an understanding of the basics of Big O and Logarithms.
> 
> As a programmer first and a mathematician second (or maybe third or fourth) I found the best way to understand Big O thoroughly was to produce some examples in code. So, below are some common orders of growth along with descriptions and examples where possible.
> 
> # O(1)
> 
> O(1) describes an algorithm that will always execute in the same time (or space) regardless of the size of the input data set.
> 
> ```
> bool IsFirstElementNull(IList<string> elements) {
>     return elements[0] == null;
> } 
> ```
> 
> # O(N)
> 
> O(N) describes an algorithm whose performance will grow linearly and in direct proportion to the size of the input data set. The example below also demonstrates how Big O favours the worst-case performance scenario; a matching string could be found during any iteration of the for loop and the function would return early, but Big O notation will always assume the upper limit where the algorithm will perform the maximum number of iterations.
> 
> ```
> bool ContainsValue(IList<string> elements, string value) {
>     foreach (var element in elements)
>     {
>         if (element == value) return true;
>     }
> 
>     return false;
> } 
> ```
> 
> # O(N²)
> 
> O(N²) represents an algorithm whose performance is directly proportional to the square of the size of the input data set. This is common with algorithms that involve nested iterations over the data set. Deeper nested iterations will result in O(N³), O(N⁴) etc.
> 
> ```
> bool ContainsDuplicates(IList<string> elements) {
>     for (var outer = 0; outer < elements.Count; outer++)
>     {
>         for (var inner = 0; inner < elements.Count; inner++)
>         {
>             // Don't compare with self
>             if (outer == inner) continue;
> 
>             if (elements[outer] == elements[inner]) return true;
>         }
>     }
> 
>     return false;
> } 
> ```
> 
> # O(2^N)
> 
> O(2^N) denotes an algorithm whose growth doubles with each additon to the input data set. The growth curve of an O(2^N) function is exponential - starting off very shallow, then rising meteorically. An example of an O(2^N) function is the recursive calculation of Fibonacci numbers:
> 
> ```
> int Fibonacci(int number) {
>     if (number <= 1) return number;
> 
>     return Fibonacci(number - 2) + Fibonacci(number - 1);
> } 
> ```
> 
> # Logarithms
> 
> Logarithms are slightly trickier to explain so I'll use a common example:
> 
> Binary search is a technique used to search sorted data sets. It works by selecting the middle element of the data set, essentially the median, and compares it against a target value. If the values match it will return success. If the target value is higher than the value of the probe element it will take the upper half of the data set and perform the same operation against it. Likewise, if the target value is lower than the value of the probe element it will perform the operation against the lower half. It will continue to halve the data set with each iteration until the value has been found or until it can no longer split the data set.
> 
> This type of algorithm is described as O(log N). The iterative halving of data sets described in the binary search example produces a growth curve that peaks at the beginning and slowly flattens out as the size of the data sets increase e.g. an input data set containing 10 items takes one second to complete, a data set containing 100 items takes two seconds, and a data set containing 1000 items will take three seconds. Doubling the size of the input data set has little effect on its growth as after a single iteration of the algorithm the data set will be halved and therefore on a par with an input data set half the size. This makes algorithms like binary search extremely efficient when dealing with large data sets.

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2015-10-11T18:00:20.030

This is a very simplified explanation, but I hope it covers most important details.

Let's say your algorithm dealing with the problem depends on some 'factors', for example let's make it N and X.

Depending on N and X, your algorithm will require some operations, for example in the WORST case it's `3(N^2) + log(X)` operations.

Since Big-O doesn't care too much about constant factor (aka 3), the Big-O of your algorithm is `O(N^2 + log(X))`. It basically translates 'the amount of operations your algorithm needs for the worst case scales with this'.

* * *

## 回答 #31

> 赞同：7
> 
> 时间：2017-10-10T03:15:25.193

### Preface

**algorithm**: procedure/formula for solving a problem

* * *

**How do analyze algorithms and how can we compare algorithms against each other?**

*example:* you and a friend are asked to create a function to sum the numbers from 0 to N. You come up with f(x) and your friend comes up with g(x). Both functions have the same result, but a different algorithm. In order to objectively compare the efficiency of the algorithms we use **Big-O notation**.

**Big-O notation:** describes *how quickly runtime will grow relative to the input as the input get arbitrarily large.*

**3 key takeaways:**

1.  Compare *how quickly runtime grows* **NOT** *compare exact runtimes* (depends on hardware)
2.  Only concerned with runtime grow relative to the input **(n)**
3.  As *n* gets arbitrarily large, focus on the terms that will grow the fastest as n gets large (think infinity) AKA **asymptotic analysis**

**Space complexity:** aside from time complexity, we also care about space complexity (how much memory/space an algorithm uses). Instead of checking the time of operations, we check the size of the allocation of memory.

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2016-10-24T10:39:08.170

Big O is a means to represent the upper bounds of any function. We generally use it for expressing the upper bounds of a function that tells the running time of an Algorithm.

*Ex : f(n) = 2(n^2) +3n be a function representing the running time of a hypothetical algorithm, Big-O notation essentially gives the upper limit for this function which is O(n^2)*

This notation basically tells us that, for any input 'n' the running time won't be greater than the value expressed by Big-O notation.

Also, agree with all the above detailed answers. Hope this helps !!

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2016-10-31T23:57:42.280

Big O is describing a class of functions.

It describes how fast functions grow for big input values.

For a given function f, O(f) descibes all functions g(n) for which you can find an n0 and a constant c so that all values of g(n) with n >= n0 are less or equal to c*f(n)

In less mathematical words O(f) is a set of functions. Namely all functions, that from some value n0 onwards, are growing slower or as fast as f.

If f(n) = n then

g(n) = 3n is in O(f).Because constant factors do not matter h(n) = n+1000 is in O(f) because it might be bigger for all values smaler than 1000 but for big O only huge inputs matter.

However i(n) = n^2 is not in O(f) because a quadratic funcion grows faster than a linear one.

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2018-12-09T07:57:24.367

It represents the speed of an algorithm in *the long run*.

To take a literal analogy, you don't care how fast a runner can sprint a 100m dash, or even a 5k run. You care more about marathoners, and preferably ultra marathoners (beyond which the analogy to running breaks down and you have to revert to the metaphorical meaning of "the long run").

You can safely stop reading here.

I'm adding this answer because I'm surprised how mathematical and technical the rest of the answers are. The notion of the "long run" in first sentence is related to the arbitrarily time-consuming computational tasks. Unlike running, which is limited by human capacity, computational tasks can take even more than millions of years for certain algorithms to complete.

What about all those mathematical *logarithms* and *polynomials*? It turns out that algorithms are *intrinsically* related to these mathematical terms. If you are measuring the heights of all the kids on the block, it will take you as much time as there are kids. This is intrinsically related to the notion of *n^1* or just *n* where *n* is nothing more than the number of kids on the block. In the ultra-marathon case, you are measuring the heights of all the kids in your city, but you then have to ignore travel times and assume they are all available to you in a line (otherwise we jump ahead of the current explanation).

Suppose then you are trying to arrange the list that you made of of kids heights in order of shortest height to longest height. If it is just the kids in your neighborhood you might just eyeball it and come up with the ordered list. This is the "sprint" analogy, and we truly don't care about sprints in computer science because why use a computer when you can eyeball something?

But if you were arranging the list of the heights of all kids in your city, or better yet, your country, then you will find that how you do it is intrinsically tied to the mathematical **log** and **n^2**. Going through your list to find the shortest kid, writing his name in a separate notebook, and crossing it out from the original notebook is *intrinsically* tied to the mathematical *n^2*. If you think of arranging half your notebook, then the other half, and then combining the results, you will arrive at a method that is *intrinsically* tied to the *logarithm*.

Finally, suppose you first had to go to the store to buy a measuring tape. This is an example of an effort that is of consequence in short sprints, such as measuring the kids on the block, but when you are measuring all the kids in the city you can safely ignore this cost. This is the intrinsic connection to the mathematical dropping of say lower order polynomial terms.

I hope I have explained that the big-O notation is merely about the long run, that the mathematics is inherently connected to ways of computation, and that the dropping of mathematical terms and other simplifications are connected to the long run in a rather common sense way.

Once you realize this, you'll find the big-O is really super-easy because all the hard high school math just drops out easily. The only difficult part is analyzing an algorithm to identify the mathematical terms, but with some practice you can start dropping terms during the analysis itself and safely ignore chunks of the algorithm to focus only on the part that is relevant to the big-O. I. e. you should be able to eyeball most situations.

Happy big-O-ing, it was my favorite thing about Computer Science -- finding that something was way easier than I thought, and then being able to show off at Google interviews when the uninitiated would be intimidated, lol.

* * *

## 回答 #35

> 赞同：4
> 
> 时间：2016-07-04T20:46:32.063

Big O in plain english is like <= (less than or equal). When we say for two functions f and g, f = O(g) it means that f <= g.

However, this does not mean that for any n f(n) <= g(n). Actually what it means is that **f is less than or equal to g in terms of growth**. It means that **after a point** f(n) <= c*g(n) if **c is a constant**. And **after a point** means than for all n >= n0 where n0 **is another constant**.

* * *

## 回答 #36

> 赞同：4
> 
> 时间：2018-02-15T03:52:05.150

**Big O - Economic Point of View.**

My favourite English word to describe this concept is the **price** you pay for a task as it grows larger.

Think of it as recurring costs instead of fixed costs that you would pay at the beginning. The fixed costs become negligible in the big picture because costs only grow and they add up. We want to measure how fast they would grow and how soon they would add up with respect to the raw material we give to the set up - size of the problem.

However, if initial set up costs are high and you only produce a small amount of the product, you would want to look at these initial costs - they are also called the constants.

Since, these constants don't matter in the long run, this language allows us to discuss tasks beyond what kind of infrastructure we are running it on. So, the factories can be anywhere and the workers can be whoever - it's all gravy. But the size of the factory and the number of workers would be the things we could vary in the long run as your inputs and outputs grow.

Hence, this becomes a **big picture approximation** of how much you would have to spend to run something. Since **time** and **space** are the economic quantities (i.e. they are limited) here, they can both be expressed using this language.

Technical notes: Some examples of time complexity - O(n) generally means that if a problem is of size 'n', I at least have to see everything. O(log n) generally means that I halve the size of the problem and check and repeat until the task is done. O(n^2) means I need to look at pairs of things (like handshakes at a party between n people).

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2015-06-13T15:29:11.090

If I want to explain this to 6 years old child I will start to draw some functions f(x) = x and f(x) = x^2 for example and ask a child which function will be the upper function on the top of the page. Then we will proceed with drawing and see that x^2 wins. "Who wins" actually is the function which grows faster when x tends to infinity. So "function x is in Big O of x^2" means that x grows slower than x^2 when x tends to infinity. The same can be done when x tends to 0\. If we draw these two function for x from 0 to 1 x will be an upper function, so "function x^2 is in Big O of x for x tends to 0". When the child will get older I add that really Big O can be a function which grows not faster but the same way as given function. Moreover constant is discarded. So 2x is in Big O of x.

* * *

## 回答 #38

> 赞同：3
> 
> 时间：2018-10-03T13:31:24.423

> What is a plain English explanation of “Big O” notation?

I would like to stress that the driving motive for *“Big O” notation* is one thing, when an input size of algorithm gets **too big** some parts (i.e constants, coefficients, terms )of the equation describing the measure of the algorithm becomes **so insignificant** that we **ignore** them. The parts of equation that survives after ignoring some of its parts is termed as the *“Big O” notation* of the algorithm.

So if the input size is NOT too big the idea of *“Big O” notation*( upper bound ) will be unimportant.

Les say you want to quantify the performance of the following algorithm

```
int sumArray (int[] nums){
    int sum=0;   // taking initialization and assignments n=1
    for(int i=0;nums.length;i++){
        sum += nums[i]; // taking initialization and assignments n=1
    }
    return sum;
} 
```

In above algorithm, lets say you find out `T(n)` as follows (time complexity):

```
T(n) = 2*n + 2 
```

To find its “Big O” notation, we need to consider very big input size:

```
n= 1,000,000   -> T(1,000,000) = 2,000,002
n=1,000,000,000  -> T(1,000,000,000) = 2,000,000,002
n=10,000,000,000  -> T(10,000,000,000) = 20,000,000,002 
```

Lets give this similar inputs for another function `F(n) = n`

```
n= 1,000,000   -> F(1,000,000) = 1,000,000 
n=1,000,000,000  -> F(1,000,000,000) = 1,000,000,000
n=10,000,000,000  -> F(10,000,000,000) = 10,000,000,000 
```

As you can see as input size get **too big** the `T(n)` approximately equal to or getting closer to `F(n)`, so the constant `2` and the coefficient `2` are becoming too insignificant, now the idea of Big O” notation comes in,

```
O(T(n)) = F(n)
O(T(n)) = n 
```

We say the big O of `T(n)` is `n`, and the notation is `O(T(n)) = n`, it is the upper bound of `T(n)` as `n` gets **too big**. the same step applies for other algorithms.

* * *

## 回答 #39

> 赞同：3
> 
> 时间：2020-05-13T07:33:10.993

There are some great answers already posted, but I would like to contribute in a different way. If you want to visualize what all is happening you can assume that a compiler can perform close to 10^8 operations in ~1sec. If the input is given in 10^8, you might want to design an algorithm that operates in a linear fashion(like an un-nested for-loop). below is the table that can help you to quickly figure out the type of algorithm you want to figure out ;)

[![given order of input: the type of algorithm you might want to use](https://i.stack.imgur.com/LTXe5.png)](https://i.stack.imgur.com/LTXe5.png)

* * *

## 回答 #40

> 赞同：3
> 
> 时间：2020-06-17T16:13:27.993

When we have a function like `f(n) = n+3` and we want to know how the graph looks likes when `n` approaches infinity, we just drop all the constants and lower order terms because they don't matter when `n` gets big. Which leaves us with `f(n) = n`, so why can't we just use this, why do we need to look for some function which is above and below our `f(n) = n+3` function, so big O and big Omega.

Because it would be incorrect to say that the function is just `f(n) = n` when `n` approaches infinity, so to be correct we describe the area where the `f(n) = n+3` could be. We are not interested where the graph is exactly, because lower order terms and constant don't change the growth of the graph significantly, so in other words the area which is enclosed from upper and lower bound is a vague version of our f(n) = n+3 function.

The mere dropping of the constant and lower order term is exactly the process of finding the function which is below and above.

By definition is a function a lower or upper bound of another function if you can find a constant with whom you can multiply the `f(n) = n` function so that for every `n` the output is bigger (or smaller for lower bound) than for the original function:

```
f(n) = n*C > f(n) = n+3 
```

And yes `C = 2` would do it, therefore our function `f(n) = n` can be an upper bound of our `f(x) = x+3` function.

Same for lower bound:

```
f(n) = n*C < f(n) = n+3 
```

`C = -2` would do it

So `f(x) = n` is the upper and lower bound of `f(x) = x+3`, when its both big O and Omega than its Theta, which means its tightly bound.

So big O could also be `f(x) = x^2` because it fulfills the condition `f(n) = n^2*C > f(n) = n+3`. Its above our `f(n) = n+3` graph, but the area between this upper bound and the lower bound is not as precise as our earlier bounds.

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2018-04-15T01:20:20.497

TLDR: Big O explains performance of an algorithm in mathematical terms.

Slower algorithms tend to run at n to the power of x or many, depending on depth of it, whereas faster ones like binary search run at O(log n), which makes it run faster as data set gets larger. Big O could be explained with other terms using n, or not even using n too (ie: O(1) ).

One can calculate Big O Looking at the most complex lines of the algorithm.

With small or unsorted datasets Big O can be surprising, as n log n complexity algorithms like binary search can be slow for smaller or unsorted sets, for a simple running example of linear search versus binary search, take a look at my JavaScript example:

[https://codepen.io/serdarsenay/pen/XELWqN?editors=1011](https://codepen.io/serdarsenay/pen/XELWqN?editors=1011) (algorithms written below)

```
function lineerSearch() {
  init();
  var t = timer('lineerSearch benchmark');
  var input = this.event.target.value;
  for(var i = 0;i<unsortedhaystack.length - 1;i++) {
    if (unsortedhaystack[i] === input) {
      document.getElementById('result').innerHTML = 'result is... "' + unsortedhaystack[i] + '", on index: ' + i + ' of the unsorted array. Found' + ' within ' + i + ' iterations';
      console.log(document.getElementById('result').innerHTML);
      t.stop(); 
      return unsortedhaystack[i]; 
    }
  }
}

function binarySearch () {
  init();
  sortHaystack();
  var t = timer('binarySearch benchmark');
  var firstIndex = 0;
  var lastIndex = haystack.length-1;
  var input = this.event.target.value;

  //currently point in the half of the array
  var currentIndex = (haystack.length-1)/2 | 0;
  var iterations = 0;

  while (firstIndex <= lastIndex) {
    currentIndex = (firstIndex + lastIndex)/2 | 0;
    iterations++;
    if (haystack[currentIndex]  < input) {
      firstIndex = currentIndex + 1;
      //console.log(currentIndex + " added, fI:"+firstIndex+", lI: "+lastIndex);
    } else if (haystack[currentIndex] > input) {
      lastIndex = currentIndex - 1;
      //console.log(currentIndex + " substracted, fI:"+firstIndex+", lI: "+lastIndex);
    } else {
      document.getElementById('result').innerHTML = 'result is... "' + haystack[currentIndex] + '", on index: ' + currentIndex + ' of the sorted array. Found' + ' within ' + iterations + ' iterations';
      console.log(document.getElementById('result').innerHTML);
      t.stop(); 
      return true;
    }
  }
} 
```

* * *

## 回答 #42

> 赞同：2
> 
> 时间：2021-02-08T22:31:28.747

From ([source](https://en.wikipedia.org/wiki/Big_O_notation)) one can read:

> **Big O notation is a mathematical notation** that describes the limiting behavior of a function when the argument tends **towards a particular value or infinity**. (..) **In computer science,** big O notation is used to classify algorithms according to how their run time or space requirements grow **as the input size grows**.

`Big O` notation does not represent a function per *si* but rather a [set of functions](https://stackoverflow.com/questions/10376740/what-exactly-does-big-%D3%A8-notation-represent) with a certain asymptotic upper-bound; as one can read from [source](https://en.wikipedia.org/wiki/Big_O_notation):

> Big O notation characterizes functions according to their growth rates: different functions with the same growth rate may be represented using the same `O` notation.

Informally, in computer-science [time-complexity](https://en.wikipedia.org/wiki/Time_complexity) and [space-complexity](https://en.wikipedia.org/wiki/Space_complexity) theories, one can think of the `Big O` notation as a categorization of algorithms with a certain worst-case scenario concerning time and space, respectively. For instance, `O(n)`:

> An algorithm is said to take linear time/space, or O(n) time/space, if its time/space complexity is O(n). Informally, this means that the running time/space increases at most linearly with the size of the input ([source](https://en.wikipedia.org/wiki/Time_complexity#Linear_time)).

and `O(n log n)` as:

> An algorithm is said to run in quasilinear time/space if T(n) = O(n log^k n) for some positive constant k; linearithmic time/space is the case k = 1 ([source](https://en.wikipedia.org/wiki/Time_complexity#Linearithmic_time)).

Nonetheless, typically such relaxed phrasing is normally used to quantify (for the worst-case scenario) how a set of algorithms behaves compared with another set of algorithms regarding the increase of their input sizes. To compare two classes of algorithms (*e.g.*, `O(n log n)` and `O(n)`) one should analyze how both classes of algorithms behaves with the increase of their input size (*i.e.,* n) for the worse-case scenario; analyzing `n` when it tends to the infinity

[![enter image description here](https://i.stack.imgur.com/2pnDQ.png)](https://i.stack.imgur.com/2pnDQ.png)

In the image above `big-O` denote one of the asymptotically least upper-bounds of the plotted functions, and does not refer to the sets `O(f(n))`.

For instance comparing `O(n log n)` vs. `O(n)` as one can see in the image after a certain input, `O(n log n)` (green line) grows faster than `O(n)` (yellow line). That is why (for the worst-case) `O(n)` is more desirable than `O(n log n)` because one can increase the input size, and the growth rate will increase slower with the former than with the latter.

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2022-01-20T16:37:55.457

Just to express a complexity of an algorithm in a fast and simple way. The big O notation exist to explain the best, worst, and average-case time complexities for any given algorithm. There are just numerical functions over the size of possible problem instances.

In other way it is very difficult to work precisely with these functions, because they tend to:

*   Have too many bumps – An algorithm such as binary search typically runs a bit faster for arrays of size exactly n = 2k − 1 (where k is an integer), because the array partitions work out nicely. This detail is not particularly significant, but it warns us that the exact time complexity function for any algorithm is liable to be very complicated, with little up and down bumps as shown in Figure 2.2.
*   Require too much detail to specify precisely – Counting the exact number of RAM instructions executed in the worst case requires the algorithm be specified to the detail of a complete computer program. Further, the precise answer depends upon uninteresting coding details (e.g., did he use a case statement or nested ifs?). Performing a precise worst-case analysis like T(n) = 12754n2 + 4353n + 834lg2 n + 13546 would clearly be very difficult work, but provides us little extra information than the observation that “the time grows quadratically with n.”</li>

It proves to be much easier to talk in terms of simple upper and lower bounds of time-complexity functions using the Big Oh notation. The Big Oh simplifies our analysis by ignoring levels of detail that do not impact our comparison of algorithms. The Big Oh notation ignores the difference between multiplicative constants. The functions f(n)=2n and g(n) = n are identical in Big Oh analysis

[https://mimoza.marmara.edu.tr/~msakalli/cse706_12/SkienaTheAlgorithmDesignMan ual.pdf](https://mimoza.marmara.edu.tr/%7Emsakalli/cse706_12/SkienaTheAlgorithmDesignManual.pdf)

# c# - 安装程序自定义操作

> ID：487259
> 
> 赞同：0
> 
> 时间：2009-01-28T11:10:35.913
> 
> 标签：c#, .net-3.5

如何在Unistall的应用程序启动路径（程序文件）中删除应用程序创建的所有文件夹。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T21:51:03.000

删除文件夹也要小心。如果某个用户只是将您的程序安装到 C:. 之后你会清理他的整个驱动器吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T11:12:24.303

您实际上并不需要，卸载将在安装时保留日志并为您执行此操作。

但是我猜你是在指出它不会删除它一开始就没有安装的东西。在此基础上，您应该覆盖自定义[Installer类上的](http://msdn.microsoft.com/en-us/library/system.configuration.install.installer.aspx)[回滚](http://msdn.microsoft.com/en-us/library/system.configuration.install.installer.rollback.aspx)/[卸载](http://msdn.microsoft.com/en-us/library/system.configuration.install.installer.uninstall.aspx)方法，并编写代码来查找和删除自安装以来创建的内容（可能由您的应用程序创建）。

请注意，即使使用这种方法，您可能会发现很难确保完全删除文件夹（带有卸载日志）。

# asp.net - 在 UpdatePanel 更新后注册动态 javascript

> ID：487269
> 
> 赞同：6
> 
> 时间：2009-01-28T11:15:41.380
> 
> 标签：asp.net, javascript, updatepanel

我有一个动态创建的 javascript 页面（脚本实际上是非常静态的，但其变量的值是根据用户输入填充的）。

结果和接受用户输入的控件位于 UpdatePanel 中，该面板根据某些用户输入进行自我更新。其中一些用户输入会导致我之前提到的变量发生变化，因此我需要注册一个新的 javascript。

问题当然是只有更新面板得到更新，并且脚本在更新面板之外注册，因此没有添加新脚本。

你认为现在最好的做法是什么？我可以通过让这个脚本（和变量）存在*于*更新面板中来解决这个问题，或者我可以确保在需要发布新的 javascript 时完全重新加载页面？我已经在页面上的 ScriptManager 可能可以帮助我解决这个问题......

所以我正在寻找有类似问题并以很好的方式解决它们的人，或者只是有一些好主意的人:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T11:25:35.227

看看[`ScriptManager.RegisterClientScriptBlock`](http://msdn.microsoft.com/en-us/library/bb350750.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T15:17:29.263

我的运气`ScriptManager.RegisterStartupScript`比我好`ScriptManager.RegisterClientScriptBlock`。你可以试一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T11:53:01.740

为什么不直接将变量放在更新面板中，或者让 JavaScript 通过 DOM 获取值？

# iphone - NSTimer 和 Touches 事件冲突

> ID：487276
> 
> 赞同：1
> 
> 时间：2009-01-28T11:18:50.577
> 
> 标签：iphone, objective-c, touch, nstimer

我试图在发生特定事件时执行 2 个动作，一个是在触发具有固定间隔的计时器时发生的动画，另一个也是在检测到触摸时发生的动画

两个 r 单独工作正常，但是当同时发生时，动画中的任何一个都会变慢。它因为在给定的时间单位只执行一个动作

对于 NSTimer im 使用 0.01s 的时间间隔

如何在不减慢任何动画速度的情况下使这种情况工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-04T01:00:53.730

NSTimer 不是执行动画的工具。[Core Animation](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html)是您想要解决 iPhone 上几乎所有动画问题的工具。NSTimer 不是实时定时器。它不能保证何时触发。它是解决许多问题的绝佳工具；动画不是其中之一。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:36:19.327

**触摸拒绝响应通常表示 CPU 压力过大**。每秒动画 100 次可能是造成这种情况的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T00:50:18.963

当触摸动画正在进行时，我也会停止计时器触发。您可以调用 [timer invalidate] 来停止计时器触发。也许这会奏效？不过，0.05 的时间间隔会更合理 - 并且可以完全解决问题！祝你好运！

# c++ - 存储和检索动态变化的结构

> ID：487283
> 
> 赞同：1
> 
> 时间：2009-01-28T11:20:27.797
> 
> 标签：c++, file-io, dynamic-data

我正在使用 Allegro/C++ 创建游戏。游戏快完成了，现在我想创建一个地图编辑器。游戏包含许多类，它们的数量将根据地图所需的对象数量而有所不同。我正在考虑创建一个单独的结构来保存关卡数据并将其存储为地图。问题是大小因地图而异，我必须根据数量使用指针来容纳对象。存储和检索此类数据的最佳方式是什么。

我正在考虑的结构示例-

```
struct Level
{    
    int soldierCount;

    Soldier **soldier;

    int taskCount;

    int *taskPercentage;

    int *taskBitmapX;

    int *taskBitmapY;

}; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T15:37:23.723

所以，你想做的是序列化。

我建议简单地使用一个已经存在的库。看看这个线程：[如何在 C++ 中序列化？](https://stackoverflow.com/questions/234724/how-to-serialize-in-c)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T12:03:46.540

为每个不同的数据结构创建类，然后为它们实现读/写函数。在记录之间使用一些标志来指示记录的类型。对于动态数组，首先存储项目的数量，然后存储项目。

# reporting-services - 报告服务：用颜色分组行

> ID：487288
> 
> 赞同：3
> 
> 时间：2009-01-28T11:22:06.547
> 
> 标签：reporting-services, formatting

我在 SQL Server Reporting Services 报告中有一个表格。几行可以在其中一列中具有相同的值，我想用交替的颜色标记这样的“组”行。我该怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-28T11:36:59.823

答案。

[http://kylefinley.net/archive/2006/07/06/226.aspx](http://kylefinley.net/archive/2006/07/06/226.aspx)

# html - 对齐 到顶部，一个到表底部

> ID：487289
> 
> 赞同：3
> 
> 时间：2009-01-28T11:22:24.407
> 
> 标签：html, css

我遇到了一些垂直 CSS 定位的问题。我想创建一个具有以下布局的页面：

```
B AAA
  AAA 
  AAA
C AAA 
```

A 是数据的网格（表格） B 与网格顶部对齐 C 与网格底部对齐

如何让 B 和 C 正确对齐？

编辑：对不起关于 Div/Table 标签的混淆！理想情况下，我希望使用纯 CSS 来做到这一点，但如果工作量很大，那么我会满足于 dittodhole 使用表格的解决方案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T11:36:43.863

我刚刚测试了这个（添加了一个包装器 div）：

```
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <style type="text/css" media="screen">
            #wrapper{ position: relative; }
            #b, #c{ position: absolute; left: 0; width: 80px; background: #ccc; }
            #a{ margin-left: 80px; }
            #b{ top: 0; }
            #c{ bottom: 0; }
        </style>
    </head>

    <body>
        <div id="wrapper">
            <div id="b">Contents of B</div>
            <table border="0" id="a">
                <tr><th>Header</th><th>Header</th><th>Header</th></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
            </table>
            <div id="c">
                Contents of C
            </div>
        </div>
    </body>
</html> 
```

div C 和 B 需要固定宽度，并且绝对定位。包装器被赋予相对定位以使其工作。表 A 的边距等于 C 和 B 的宽度。

我没有测试过跨浏览器，只是 Firefox 3。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-28T11:40:33.577

为什么这么可疑 - 这很容易：

```
<table>
    <tr>
        <td style="vertical-align: top;">B</td>
        <td rowspan="2">grid</td>
    </tr>
    <tr>
        <td style="vertical-align: bottom;">C</td>
    </tr>
</table> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-13T17:01:03.150

我找不到对我有用的这个问题的任何解决方案。我发现的最接近的事情是只有当你只有 1 行时才有效的解决方案。我正在使用 ASP.NET 日历控件，并希望在每个日期单元格的底部有一个 div。我想出的解决方案是让 JQuery 猜测最大单元格的高度，并单独设置底部 div 的 margin-top 以使其工作。locationInfo 是要移动到每个单元格底部的。num_events 查找单元格中上面列出的条目数。

```
var line_height = 24; // line height plus padding
$(document).ready(function () {
    // find out the most events in one day
    var most_events = 0;
    $(".locationInfo").each(function () {
        // get number of events in this cell
        var parent_td = $(this).parent();
        var num_events = parent_td.children().length - 2;
        if (num_events > most_events) {
            most_events = num_events;
        }
    });
    //alert(most_events);

    // loop through each (location info) div and reposition by setting margin-top
    // this could  be improved further by finding the most_events for each week instead of the whole month
    $(".locationInfo").each(function () {
        //$(this).css("top", 50);
        parent_td = $(this).parent();
        num_events = parent_td.children().length - 2;
        $(this).css("margin-top", (5 + (most_events * line_height)) - (num_events * line_height));
    });

}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T12:56:06.417

使用一些 jQuery，我可以得到这个工作的跨浏览器（包括 IE6）。包装 div 上需要一个边框才能使 IE6 正常工作（可能是 hasLayout 的东西？）。Div B 可以是可变宽度，一切都应该适应。

```
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <style type="text/css" media="screen">
            #wrapper{ position: relative;  border: 1px solid #fff; }
            #b, #c{ position: absolute; left: 0; background: #ccc; margin: 0; }
        </style>
        <script src="http://code.jquery.com/jquery-latest.js"></script>
        <script type="text/javascript" charset="utf-8">
            $(function(){
                var b_width = $('#b').width();
                var a_height = $('#a').height();
                var c_height = $('#c').height();
                var c_top = a_height - c_height;
                $('#a').css({"margin-left": b_width + "px"});
                $('#c').css({top: c_top + "px"});
            })
        </script>
    </head>

    <body id="">
        <div id="wrapper">
            <div id="b">Contents of B</div>
            <table border="0" id="a">
                <tr><th>Header</th><th>Header</th><th>Header</th></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
                <tr><td>Data</td><td>Data</td><td>Data</td></tr>
            </table>
            <div id="c">
                Contents of C
            </div>
        </div>
    </body>
</html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-10T07:58:04.297

这是解决方案：

```
 <style type="text/css">
    table { width:500px; border-collapse:collapse}
    th, td { border:1px solid black; vertical-align: top;}
    th { width:100px; }
    td { background:#ccc; }
    .wrap { position:relative; height:100%; padding-bottom:1em; background:#aaa; height:200px;}
    .manage { text-align:right; position:absolute; bottom:0; right:0; }
    p{ margin: 0 0 5px 0; }
    </style>

<table>
    <tr>
            <th>Mauris tortor nulla, sagittis ut, faucibus eu, imperdiet ut, libero.</th>
            <td><div class="wrap">
                <p><a href="http://www.pronexo.com">www.pronexo.com</a></p>
      <div class="manage">Edit | Delete</div></div></td>
    </tr>

    <tr>
            <th>Cras diam.</th>
            <td><div class="wrap"><p>Mauris tortor nulla, sagittis ut, faucibus eu, imperdiet ut, libero. Sed elementum. Praesent porta, tellus ut dictum ullamcorper, est ante condimentum metus, non molestie lorem turpis in sapien. Aenean id enim. Nullam placerat blandit ante. Aenean ac ligula.</p><div class="manage">Edit | Delete</div></div></td>
    </tr>
</table> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-25T06:40:08.213

这可以通过使用此[网格布局生成器](http://www.pagecolumn.com/grid_layout_generator.htm)的纯 div 设计来完成。4 行 4 列。将第一列的第二和第三网格留空。

# delphi - 德尔福PDF生成

> ID：487290
> 
> 赞同：12
> 
> 时间：2009-01-28T11:22:29.103
> 
> 标签：delphi, pdf, pdf-generation, fastreport

我们正在使用 Fast Reports 创建报告，但我们对它创建的 PDF 的质量不太满意。我知道我们可以插入其他 PDF 组件，而不是 FastReports 附带的组件，所以我的问题是

Delphi 有哪些好的 PDF 组件（免费或商业）？理想情况下，它不应该需要任何 dll。

**编辑：**我最终购买了[Gnostice](http://www.gnostice.com/)，因为它具有 FastReports 集成、可用源和相当好的声誉。然而，我确实发现了一个问题（在我购买它之后），将多页报告从 FastReports 导出到 PDF，其中组件泄漏内存并破坏输出。我已经向 Gnostice 报告了它，所以我想我们会在接下来的几天里看到他们的支持有多好......

**编辑 2：** Gnostice 回来了，修复了内存泄漏和损坏的输出。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-11-25T07:43:28.103

使用我们的 SynPDF 单元。在其功能中，您可以使用真正的 TCanvas 创建 PDF，并嵌入 True Type 字体子集。它是少数几个处理阿拉伯语等的库之一（通过 UniScribe API）。它完全支持 Unicode，而且速度非常快。

而且它是免费和开源的！适用于从 Delphi 6 到 Delphi XE。

[http://blog.synopse.info/?q=pdf](http://blog.synopse.info/?q=pdf)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-28T11:58:51.307

我们正在使用 Gnostice，并且对它非常满意。它允许我们将我们的 ReportBuilder 报告打印为 PDF、HTML、XML、Excel、Gif...

* * *

我们在使用该组件时遇到的一些小问题

1.  在组件内部深处的某个地方，Application.Processmessages 被调用。您必须确保您的代码处理重入。
2.  我们必须将 TgtDocSettings 组件的 Preferences.UseImagesAsResources 设置为 True 以在打印到除 PDF 之外的任何其他内容时解析 AV。
3.  可能是由于我们使用组件的方式，但第一个打印页面始终是纵向的。如果需要，我们必须添加对 gtRBExportInterface.Engine.Settings.Page.Orientation 的调用以将方向设置为横向。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T13:47:22.947

我们使用[wPDF](http://www.wpcubed.com/products/wpdf/index.htm)。我们不会直接生成 pdf 文件 - 我们生成不同的报告，并将它们“打印”为 pdf 作为打印机的替代品。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T08:50:29.290

PowerPDF 是免费和开源的 (LGPL)。它真的很小但很有效！

[电源PDF](http://www.est.hi-ho.ne.jp/takeshi_kanno/powerpdf/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-28T12:10:33.750

以下是我在寻找类似内容时遇到的一些（所有商业广告）：

*   [VisPDF 库](http://www.vispdf.com/)- 这值得一试，您可以获得源代码。

*   [PDFDoc Scout 库](http://www.bytescout.com/pdfdocscout.html)- 这是一个 ActiveX 控件，您无需获取源代码，但具有一些不错的功能（例如，良好的 HTML 到 PDF 转换）。

*   [PDF Creator Pilot](http://www.colorpilot.com/pdflibrary.html) - 也值得一试。

不幸的是，我发现免费提供的 LibHaru、PoDoFo 并不能满足我的要求。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T21:43:58.757

我一直在使用[wPDF](http://www.wpcubed.com/products/wpdf/index.htm)和 QuickReports / QRDesign。基本上是通过将报告转换为元文件，然后从中生成 pdf。它还声称具有快速报告支持。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T16:10:35.573

llionsoft 提供的 IIPDFLib，网址为：[www.llion.net](http://www.llion.net/)

Delphi 库 llPDFLib 3.6

llPDFLib 是用于创建 PDF 文档的纯 Object Pascal 库。该库不使用任何 DLL 或外部第三方软件来生成 PDF 文件。库包括具有属性和方法的 TPDFDocument 组件，如 Delphi 的 TPrinter，但旨在生成 PDF 文件。

特征：

*   Real Canvas.Handle (HDC)
*   Unicode 支持
*   Acroforms（按钮、单选按钮、复选框、组合框、文本输入字段）
*   水印
*   缩略图
*   JavaScript
*   vEncryption（40 位和 128 位）
*   大纲（支持俄语、土耳其语、波罗的海、东欧、希腊语、CJK 语言）
*   压缩
*   图像压缩（Jpeg、Flate、CCITT 3、CCITT 3 (2D)、CCITT 4）
*   超链接
*   注释（支持俄语、土耳其语、波罗的海、东欧、希腊语、CJK 语言）
*   嵌入 True Type 字体（TTF 和 TTC）
*   模拟 Underline 和 StrikeOut 字体样式
*   将输出呈现到 Stream 以用于 CGI/ISAPI 应用程序
*   QReport、FastReport 和 Report Builder 的过滤器。
*   用于 DBGrids 的组件集
*   True Type 字体子集

它的价格为 299 美元，但你得到你所支付的。

[![替代文字](https://i.stack.imgur.com/EjeOz.jpg)](https://i.stack.imgur.com/EjeOz.jpg)
[（来源：[llion.net](http://www.llion.net/images/products/llpdflib-s-mid.jpg)）]

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-29T05:56:16.093

使用 eDocEngine 创建 PDF 报告有两种方法。您可以使用报告生成器组件（如 QuickReport、Rave 等），然后使用 eDocEngine 界面将内容保存为 PDF。

另一种方法是以编程方式使用 TgtPDFDocument 类，然后设置它的属性和集合。这可以更好地控制水印、权限、密码安全等功能。

# php - php给出一个空白页，没有错误

> ID：487301
> 
> 赞同：6
> 
> 时间：2009-01-28T11:28:28.123
> 
> 标签：php, mysql, ajax, mysqli

我有一个 AJAX 应用程序的以下部分，它没有给出任何错误，但屏幕上也没有显示任何内容，所以我不确定问题出在哪里。使用 ?cmd&id=1 直接从浏览器调用此页面应该返回，或者甚至在没有 ?cmd 的情况下调用它应该返回 cmd 错误消息。

编辑：添加了测试用例：我确实收到了 cmd 错误消息，但是当我通过 &id=1（1 是一个有效的 id）时，没有任何 html 被返回，查看源代码是完全空白的。我是否错误地使用了回声或类似的东西？

编辑2：添加回声作为第一行：第一个回声无论如何都看不到

编辑3：回到旧版本并再次进行所有更改后，我现在在使用有效的 cmd 和 id 参数调用时得到测试字符集输出。我使用的代码与下面粘贴的代码相同。

编码：

```
<?php
echo "hello world";    
error_reporting(E_ALL);

if (isset($_GET["cmd"]))
  $cmd = $_GET["cmd"];
else
  die("You should have a 'cmd' parameter in your URL");

$id = $_GET["id"];

$con = mysqli_connect("localhost", "user", "password", "db");
echo "test con";

if(!$con)
{
  die('Connection failed because of' .mysqli_connect_error());
  echo "test error";
}

//$con->query("SET NAMES 'utf8'"); 
$con->set_charset("utf8"));
echo "test charset";

if($cmd=="GetSALEData")
{
  echo "test cmdifloop";

  if ($getRecords = $con->prepare("SELECT * FROM SALES WHERE PRODUCT_NO = ?"))
  {
    echo "test recordifloop";

    $getHtml = $con->prepare("SELECT PRODUCT_DESC FROM SALES WHERE PRODUCT_NO = ?");
    $getHtml->bind_param("s", $id);
    $getHtml->execute();
    $getHtml->bind_result($PRODUCT_DESC);

    $getRecords->bind_param("s", $id);
    $getRecords->execute(); 
    $getRecords->bind_result($PRODUCT_NO, $PRODUCT_NAME, $SUBTITLE, $CURRENT_PRICE, $START_PRICE,
                             $PRICE_COUNT, $QUANT_TOTAL, $QUANT_SOLD, $ACCESSSTARTS, $ACCESSENDS,
                             $ACCESSORIGIN_END, $USERNAME, $BEST_PRICEDER_ID, $FINISHED, $WATCH,
                             $BUYITNOW_PRICE, $PIC_URL, $PRIVATE_SALE, $SALE_TYPE, $ACCESSINSERT_DATE,
                             $ACCESSUPDATE_DATE, $CAT_DESC, $CAT_PATH, $COUNTRYCODE, $LOCATION,
                             $CONDITIONS, $REVISED, $PAYPAL_ACCEPT, $PRE_TERMINATED, $SHIPPING_TO,
                             $FEE_INSERTION, $FEE_FINAL, $FEE_LISTING, $PIC_XXL, $PIC_DIASHOW,
                             $PIC_COUNT, $ITEM_SITE_ID
                            ); 
    while ($getRecords->fetch()) 
    {
      $ccodes = array(  "1" => "USA",
                       "77" => "Germany",
                       "16" => "Austria",
                      "122" => "Luxemburg",
                      "193" => "Switzerland",
                     );

      $conditions = array( "0" => "USA",
                          "77" => "Germany",
                          "16" => "Austria",
                         );

      $country = $ccodes[$COUNTRYCODE];
      if ( $country == "" ) $country = "Not applicable";

      $columns = array('FINISHED', 'WATCH', 'PRIVATE_SALE', 'REVISED', 'PAYPAL_ACCEPT', 'PRE_TERMINATED', 'PIC_XXL', 'PIC_DIASHOW');

      foreach($columns as $column) {
        $$column = $row[$column] ? 'YES' : 'NO';
      }

      imageResize($PIC_URL, 250, 300);
      file_put_contents($id, file_get_contents($PIC_URL));

      $html = htmlentities(json_encode($PRODUCT_DESC));
      $shortDate = strftime("%d %m %Y", strtotime($ACCESSSTARTS));

      echo "<h1>".$PRODUCT_NAME."</h1>
<div id='leftlayer' class='leftlayer'>
<p><strong>Username: </strong>".$USERNAME."
<p><strong>PRODUCT Number: </strong>".$PRODUCT_NO."
<p><strong>Subtitle: </strong>".$SUBTITLE."
<p><strong>SALE Start: </strong>".$ACCESSSTARTS." 
<p><strong>SALE End: </strong>".$ACCESSENDS."
<p><strong>SALE Type: </strong>".$SALE_TYPE."
<p><strong>Category: </strong>".$CAT_DESC."
</div>
<div class='leftlayer2'>
  <p><strong>Condition: </strong> ".$CURRENT_PRICE."
  <p><strong>Total Items: </strong> ".$QUANT_TOTAL."
  <p><strong>Total Sales: </strong> ".$QUANT_SOLD."
  <p><strong>Start Price: &#8364</strong> ".$START_PRICE."
  <p><strong>Buyitnow Price: &#8364</strong> ".$BUYITNOW_PRICE."
  <p><strong>PRICEs: </strong> ".$PRICE_COUNT." 
  <p><strong>Revised: </strong> ".$REVISED."
</div>
<div class='leftlayer2'>
  <p><strong>Private: </strong> ".$PRIVATE_SALE."
  <p><strong>Finished: </strong> ".$FINISHED."
  <p><strong>Cancelled: </strong> ".$PRE_TERMINATED."
  <p><strong>Paypal: </strong> ".$PAYPAL_ACCEPT."
  <p><strong>Country: </strong> ". $country ."
  <p><strong>Location: </strong> ".$LOCATION."
  <p><strong>Shipping to: </strong> ". $country ."
</div>
<div id='rightlayer'>
 <img src='".$PIC_URL."' width='".$imageSize["width"]."' height='".$imageSize["height"]."'>
 <p><a href='#' onclick=\"makewindows(" . $html . "); return false;\">Click for full description </a></p>
</div>
</div>
</div>";

    } 
  }

  function imageResize($imageURL, $maxWidth, $maxHeight)
  {
    $imageSize["width"] = 0;
    $imageSize["height"] = 0;

    $size = getimagesize($imageURL);
    if ($size) {
      $imageWidth  = $size[0];

      $imageHeight = $size[1];
      $wRatio = $imageWidth / $maxWidth;
      $hRatio = $imageHeight / $maxHeight;
      $maxRatio = max($wRatio, $hRatio);

      if ($maxRatio > 1) {
        $imageSize["width"] = $imageWidth / $maxRatio;
        $imageSize["height"] = $imageHeight / $maxRatio;
        return $imageSize;
      } else {
        $imageSize["width"] = $imageWidth;
        $imageSize["height"] = $imageHeight;
        return $imageSize;
      }
    } else {
      die(print_r(error_get_last()));
    }
  }

} 
```

我为间距道歉，但是当我按下代码按钮时它会自动发生。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-28T11:32:08.147

这将帮助您查看错误：

```
ini_set('display_errors', '1'); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-28T16:23:36.047

第 22 行有一个额外的括号

这

```
$con->set_charset("utf8")); 
```

需要是这个

```
$con->set_charset("utf8"); 
```

未来的两个调试技巧。首先，您需要访问您的 Web 主机的 shell，或者您需要在您的开发机器上本地安装 PHP。如果您正在运行 Unix，您可能已经拥有它。打开终端并输入

```
php -v 
```

如果你有它，你可以通过执行检查 PHP 文件的语法

```
//on *nix
php yourfile.php

//or on windows
c:\path\to\php.exe yourfile.php 
```

这将避免严重的语法错误。此外，谷歌/搜索此站点以查找“本地设置 php 教程”或类似内容，以了解如何获取在您自己的机器上运行的 Web 服务器、mysql 数据库和 php 的完整副本。

第二个建议是检查错误日志，如果您安装本地副本会更容易。即使 PHP 不显示错误消息，错误仍然会记录到某个文件中。在您的情况下，您会在日志文件中看到类似的内容

```
PHP Parse error:  syntax error, unexpected ')' in foo.php on line 22 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-28T11:58:35.800

你在这里有一个额外的右括号：

```
$con->set_charset("utf8")); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-28T15:09:12.670

您是否尝试过在脚本顶部立即放置 print 或 echo 语句来测试输出的基本测试？

```
<?php

  print "Test";

?> 
```

我还建议`or die($msg)`在您尝试连接后使用 catch 。

对你的情况很好。只是作为一个起点。我会在需要时不时这样做。与其假设问题是一些非常复杂的问题，不如说是请求变量中的意外情况、访问错误的页面、在错误的时间访问正确的页面等。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-28T11:43:34.910

可能会有所帮助：

1.  监控 Web 服务器日志（如`tail -f /var/log/apache2/error.log`）

2.  使用 Firebug 并在控制台中查看来自您的脚本的 AJAX 响应。错误可能出现在那里

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T12:43:14.743

如果没有达到任何调试回显，那么故障点似乎在数据库连接周围，除非我遗漏了一些东西。

检查连接详细信息，并检查您是否启用了 mysqli 扩展。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T12:52:23.540

我遇到过类似的问题，我会莫名其妙地得到一个空白页面，通常在 IE6 中，但有时在其他浏览器中。原来是字符编码问题。我输出了一些奇怪的字符，浏览器根据内容猜测编码是什么。我通过显式设置此标头来修复它：

```
header('Content-type: text/html; charset=utf-8'); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T15:10:07.490

> 直接从浏览器调用这个页面`?cmd&id=1`应该返回

“回归”是什么意思？根据我对您的代码的了解，您需要`?cmd=`**`GetSALEData`**，否则将返回一个空白页，因为所有内容都包含在`if($cmd=="GetSALEData")`语句中。

**更正**`test contest charset`：如果您的查询字符串`cmd`设置为“GetSALEData”以外的内容，您应该看到“ ”。（这两个测试后来被添加到代码中。）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-28T15:11:27.177

```
$getHtml->bind_param("s", $id); 
```

我不知道这是否会导致错误，但这不应该和 getRecords bind_param 有“i”作为第一个参数吗？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-28T15:48:26.163

在 if-else 语句周围加上括号。我有一种感觉，编辑您的代码的人可能已经“修复”了那里的潜在问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-28T15:57:28.643

这里有几个很好的尝试建议。我还没有看到的是确保有足够的内存分配给 PHP。[drupal.org](http://drupal.org)上的人很好地分解了[增加 PHP 内存分配的方法](http://drupal.org/node/207036)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-06-22T14:20:33.117

发生这种情况的原因是因为您的服务器配置设置为不显示错误，因此您的脚本依赖于执行它`error_reporting(E_ALL);`- 只要`error_reporting()`函数被执行，这应该可以正常工作。但是，**如果出现解析错误，`error_reporting(E_ALL)`则不会执行**，因此您不会看到错误，因为 php.ini 错误报告设置永远不会被覆盖。

您唯一的解决方案是在更高的位置设置 error_reporting，例如 htaccess 或 php.ini。但是现在至少您知道空白页 = 解析错误！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-05-20T20:28:57.143

如果您确定没有错误并且一直出现空白页，我建议您安装 php-process。

```
yum -y install php-process 
```

在其他情况下，如果您没有安装 pear，则会收到此类错误。

`yum -y install php-pear php-pear-DB`或者只是安装数据库`pear install DB`

希望这可以帮助解决空白页问题的人。

# delphi - 如何在 Delphi 中实现引用计数对象

> ID：487311
> 
> 赞同：1
> 
> 时间：2009-01-28T11:32:07.913
> 
> 标签：delphi, object, reference-counting

我有一个类似结构的图。我不确切知道何时以传统的 Delphi 方式销毁对象，相反我想实现类似引用计数对象之类的东西。我知道我可以使用 object.GetReference 和 object.Release 之类的东西来代替 Free，并使用私有变量进行引用计数，但有没有更好的方法？

谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-28T12:05:59.437

如果您在确定在 Delphi 程序中销毁标准对象的正确方法（位置、顺序等）时遇到问题，那么使用引用计数对象或接口对您毫无帮助。

我知道您希望图中的节点保持相互引用，并且当没有对对象的引用时，它应该自动销毁。但是考虑到两个节点都可以引用另一个节点的事实，并且引用计数永远不会再次达到 0，因此这些对象永远不会被释放。您将需要手动中断至少一个引用/依赖项。如果无论如何你都必须这样做，那么你也可以完全跳过引用计数。有关更多信息，请参阅有关[弱引用](http://en.wikipedia.org/wiki/Weak_reference)的 Wikipedia 文章。接口可以在 Delphi 中用于引用计数，但弱引用只能通过巧妙的类型转换来维护。有关示例，请参阅[此源代码及其注释](http://dunit.svn.sourceforge.net/viewvc/dunit/trunk/contrib/DUnitWizard/Source/Common/XPObserver.pas?view=markup)。

您可能想要探索的一个想法是保持对象的标准生命周期管理，并让图形对象跟踪依赖关系。

让每个图形对象都有一个与它有连接的其他对象的列表。现在您可以简单地释放任何对象，并且列表的管理代码将从所有其他对象中删除对正在销毁的对象的所有引用。如果要修改图形，只需释放要删除的节点，依赖项就会更新。如果要销毁整个图，只需销毁所有节点。基本上，您有一个节点列表（所有权、生命周期管理）和另一个用于描述图形的数据结构。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T11:53:36.233

您可以使用接口代替对象，底层对象将自动引用计数，最好的是当 refcount = 0 时，delphi 会为您销毁对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T11:55:33.547

您可能知道，Delphi 没有垃圾收集器。

最好的办法是让你的对象从 TInterfacedObject 继承。就像是

```
type
  IMyObject = interface
    [Guid]
  end;

  MyObject = class(IMyObject, TInterfacedObject)
  end;

var
  myObject: IMyObject;
begin
  myObject := TMyObject.Create;
end 
```

myObject 变量是引用计数的，当它的引用计数下降到零时将被释放。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-28T19:41:08.800

如果您使用的是 D2009，您可以使用 Barry Kelly 的智能指针实现。

[http://barrkel.blogspot.com/2008/11/somewhat-more-efficient-smart-pointers.html](http://barrkel.blogspot.com/2008/11/somewhat-more-efficient-smart-pointers.html)

否则使用接口是你最好的选择。创建一个具有您需要的所有功能的接口，创建一个实现该接口并从 TInterfacedObject 继承的对象，然后在任何地方使用接口，而不是对象。

# sql - 主键还是唯一索引？

> ID：487314
> 
> 赞同：141
> 
> 时间：2009-01-28T11:33:08.787
> 
> 标签：sql, database, database-design

在工作中，我们有一个带有唯一索引而不是主键的大型数据库，并且一切正常。

我正在为一个新项目设计新数据库，但我遇到了一个难题：

在 DB 理论中，主键是基本元素，这没关系，但在 REAL 项目中，两者的优缺点是什么？

你在项目中使用什么？

**编辑：** ...MS SQL 服务器上的主键和复制呢？

* * *

## 回答 #1

> 赞同：183
> 
> 时间：2010-05-26T20:20:40.280

**什么是唯一索引？**

列上的唯一索引是该列上的索引，它还强制执行约束，即在该列中的两个不同行中不能有两个相等的值。例子：

```
CREATE TABLE table1 (foo int, bar int);
创建唯一索引 ux_table1_foo ON table1(foo); -- 在 foo 上创建唯一索引。

INSERT INTO table1 (foo, bar) VALUES (1, 2);  -  好的
INSERT INTO table1 (foo, bar) VALUES (2, 2);  -  好的
INSERT INTO table1 (foo, bar) VALUES (3, 1);  -  好的
INSERT INTO table1 (foo, bar) VALUES (1, 4); ——失败！

键“ux_table1_foo”的重复条目“1”

```

`foo`最后一次插入失败，因为它在尝试第二次将值 1 插入此列时违反了列上的唯一索引。

在 MySQL 中，唯一约束允许多个 NULL。

可以在多个列上创建唯一索引。

**主键与唯一索引**

相同的东西：

*   主键意味着唯一索引。

不一样的东西：

*   主键也意味着 NOT NULL，但唯一索引可以为空。
*   可以只有一个主键，但可以有多个唯一索引。
*   如果没有定义聚集索引，则主键将是聚集索引。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-01-28T11:36:04.723

你可以这样看：

**主键是唯一的**

**唯一值不必是元素的表示**

意义？; 那么主键用于识别元素，如果您有一个“个人”，您希望有一个个人识别号（SSN 或此类），它是您的个人的主要号码。

另一方面，该人可能有一个唯一的电子邮件，但不能识别该人。

我总是有主键，即使在关系表（中间表/连接表）中我也可能有它们。为什么？好吧，我喜欢在编码时遵循一个标准，如果“Person”有一个标识符，那么 Car 有一个标识符，那么 Person -> Car 也应该有一个标识符！

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-28T12:20:59.577

外键与唯一约束以及主键一起使用。来自在线书籍：

> FOREIGN KEY 约束不必只链接到另一个表中的 PRIMARY KEY 约束；它也可以定义为引用另一个表中唯一约束的列

对于事务复制，您需要主键。来自在线书籍：

> 为事务复制发布的表必须具有主键。如果表在事务复制发布中，则不能禁用与主键列关联的任何索引。复制需要这些索引。要禁用索引，您必须首先从发布中删除表。

这两个答案都适用于 SQL Server 2005。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-28T19:41:15.290

选择何时使用代理主键而不是自然键是很棘手的。诸如总是或从不之类的答案很少有用。我发现这取决于情况。

例如，我有以下表格：

```
CREATE TABLE toll_booths (
    id            INTEGER       NOT NULL PRIMARY KEY,
    name          VARCHAR(255)  NOT NULL,
    ...
    UNIQUE(name)
)

CREATE TABLE cars (
    vin           VARCHAR(17)   NOT NULL PRIMARY KEY,
    license_plate VARCHAR(10)   NOT NULL,
    ...
    UNIQUE(license_plate)
)

CREATE TABLE drive_through (
    id            INTEGER       NOT NULL PRIMARY KEY,
    toll_booth_id INTEGER       NOT NULL REFERENCES toll_booths(id),
    vin           VARCHAR(17)   NOT NULL REFERENCES cars(vin),
    at            TIMESTAMP     DEFAULT CURRENT_TIMESTAMP NOT NULL,
    amount        NUMERIC(10,4) NOT NULL,
    ...
    UNIQUE(toll_booth_id, vin)
) 
```

我们有两个实体表（`toll_booths`和`cars`）和一个事务表（`drive_through`）。该`toll_booth`表使用代理键，因为它没有不能保证更改的自然属性（名称很容易更改）。该`cars`表使用自然主键，因为它具有不变的唯一标识符 ( `vin`)。事务`drive_through`表使用代理键便于识别，但对属性也有唯一性约束，保证在插入记录时是唯一的。

[http://database-programmer.blogspot.com](http://database-programmer.blogspot.com)有一些关于这个特定主题的精彩文章。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-28T11:47:03.000

主键没有缺点。

仅向@MrWiggles 和@Peter Parker 答案添加一些信息，例如，当表没有主键时，您将无法在某些应用程序中编辑数据（他们最终会说无法编辑/删除数据）首要的关键）。Postgresql 允许多个 NULL 值在 UNIQUE 列中，PRIMARY KEY 不允许 NULL。此外，一些生成代码的 ORM 可能对没有主键的表有一些问题。

更新：

据我所知，在 MSSQL 中复制没有主键的表是不可能的，至少没有问题（[详细信息](http://searchsqlserver.techtarget.com/generic/0,295582,sid87_gci1110521,00.html)）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-28T11:36:15.613

如果某物是主键，则取决于您的数据库引擎，整个表将按主键排序。这意味着在主键上查找要快得多，因为它不必像与任何其他类型的索引一样进行任何取消引用。除此之外，这只是理论。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-12-20T05:17:06.773

聚集索引与唯一索引相比有一些缺点。

如前所述，CLUSTERED INDEX 对表中的数据进行物理排序。

这意味着当您对包含聚集索引的表进行大量插入或删除操作时，每次（嗯，几乎，取决于您的填充因子）您更改数据时，都需要更新物理表以保持排序。

在相对较小的表中，这很好，但是当获取具有 GB 数据价值的表时，插入器/删除器会影响排序，您会遇到问题。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-28T12:39:46.700

关系数据理论中没有主键之类的东西，所以你的问题必须在实践层面上回答。

唯一索引不是 SQL 标准的一部分。DBMS 的特定实现将决定声明唯一索引的后果。

在 Oracle 中，声明主键将导致代表您创建唯一索引，因此这个问题几乎没有实际意义。我不能告诉你其他 DBMS 产品。

我赞成声明一个主键。这具有禁止键列中的 NULL 以及禁止重复的效果。我也赞成声明 REFERENCES 约束来强制实体完整性。在许多情况下，在外键的列上声明索引将加快连接速度。这种索引通常不应该是唯一的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-28T11:39:50.847

除了其他答案所说的之外，某些数据库和系统可能*需要*存在主数据库。想到一种情况；将企业复制与 Informix 一起使用时，必须存在 PK 表才能参与复制。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-28T11:40:38.363

只要您不允许 NULL 值，它们应该被处理相同，但值 NULL 在数据库上的处理方式不同（AFAIK MS-SQL 不允许超过一（1）个 NULL 值，mySQL 和 Oracle 允许这样做, 如果一列是唯一的) 所以你**必须**定义这个列 NOT NULL UNIQUE INDEX

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-28T19:09:46.180

我几乎从不创建没有数字主键的表。如果还有一个自然键应该是唯一的，我也会在上面放一个唯一索引。整数上的连接比多列自然键更快，数据只需要在一个地方更改（自然键往往需要更新，这在主键 - 外键关系中是一件坏事）。如果您需要复制，请使用 GUID 而不是整数，但在大多数情况下，我更喜欢用户可读的密钥，特别是如果他们需要查看它以区分 John Smith 和 John Smith。

我没有创建代理键的几次是当我有一个涉及多对多关系的连接表时。在这种情况下，我将两个字段都声明为主键。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-08-20T18:35:20.517

我的理解是主键和具有非空约束的唯一索引是相同的（*）；我想一个人选择一个或另一个取决于规范明确说明或暗示的内容（你想要表达和明确执行的问题）。如果它需要唯一性且不为空，则将其设为主键。如果它只是发生了唯一索引的所有部分都不是空的而没有任何要求，那么只需将其设为唯一索引。

唯一剩下的区别是，您可能有多个非空唯一索引，而您不能有多个主键。

(*) 除了实际差异：主键可以是某些操作的默认唯一键，例如定义外键。前任。如果定义了一个引用表的外键并且没有提供列名，如果被引用的表有一个主键，那么主键将是被引用的列。否则，必须显式命名被引用的列。

这里的其他人提到了数据库复制，但我不知道。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-06-04T09:16:02.030

在 MSSQL 中，主键应该单调递增以获得聚集索引的最佳性能。因此，具有标识插入的整数比任何可能不会单调递增的自然键要好。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-04-11T08:42:28.557

唯一索引可以有一个 NULL 值。它创建非聚集索引。主键不能包含 NULL 值。它创建集群索引。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2018-03-05T22:33:03.497

如果由我来...

您需要满足数据库和应用程序的要求。

为每个表添加一个自动递增的整数或长 id 列作为主键，可以满足数据库的要求。

然后，您将向表中添加至少一个其他唯一索引以供您的应用程序使用。这将是employee_id、account_id 或customer_id 等上的索引。如果可能，该索引不应是复合索引。

与综合指数相比，我更倾向于单独在几个领域使用指数。每当 where 子句包含这些字段时，数据库将使用单个字段索引，但仅当您以完全正确的顺序提供字段时，它才会使用复合索引 - 这意味着它不能使用复合索引中的第二个字段，除非您提供where 子句中的第一个和第二个。

我完全赞成使用计算或函数类型的索引 - 并建议在复合索引上使用它们。通过在 where 子句中使用相同的函数，可以很容易地使用函数索引。

这可以满足您的应用需求。

其他非主索引很可能实际上是该索引键值到主键值的映射，而不是 rowid() 的映射。这允许在不必重新创建这些索引的情况下进行物理排序操作和删除。

# iphone - 将 UIImage 大小减小到可管理的大小（减少字节）

> ID：487316
> 
> 赞同：9
> 
> 时间：2009-01-28T11:34:21.590
> 
> 标签：iphone, objective-c, cocoa, image, resize

我想减少设备捕获的图像的字节数，因为我相信`_imageScaledToSize`不会减少图片的字节数（或者是吗？） - 我想将图像的缩略图存储在本地字典中对象并且不能将全尺寸图像放入字典中。任何的想法？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-30T19:02:30.337

如果你想简单地压缩你的 UIImage，你可以使用

```
NSData *dataForPNGFile = UIImagePNGRepresentation(yourImage); 
```

生成编码为 PNG 的图像的 NSData 版本（轻松插入 NSDictionary 或写入磁盘），或者您可以使用

```
NSData *dataForPNGFile = UIImageJPEGRepresentation(yourImage, 0.9f); 
```

做同样的事情，只是在一个JPEG格式。第二个参数是JPEG的图像质量。这两个都应该产生比你的 UIImage 更小的、内存方面的图像。

使用已发布的方法调整 UIImage 的大小以创建更小的缩略图（以像素为单位）有点棘手。_imageScaledToSize 来自私有 API，我强烈建议您不要使用它。有关在记录的方法中起作用的方法，请参阅[这篇文章](http://ofcodeandmen.poltras.com/2008/10/30/undocumented-uiimage-resizing/)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-03-06T15:49:44.493

前几天我遇到了这个问题，做了很多研究。我在这里找到了一个很棒的解决方案，其中包含代码：

[http://vocaro.com/trevor/blog/2009/10/12/resize-a-uiimage-the-right-way/](http://vocaro.com/trevor/blog/2009/10/12/resize-a-uiimage-the-right-way/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T13:44:39.487

您需要以较小的尺寸将图像绘制到图形上下文中。然后，释放原始图像。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T04:23:21.290

当您说“物理尺寸”时，您指的是印刷品吗？因为您可以更改打印机页面大小。

您是在谈论用于捕获图像的像素数吗？例如，如果您有一个 3000x2000 的像素阵列，而您只想要 150x150，那么您可以裁剪图像。拍摄时，如果您有科学成像仪，则只需设置要拍摄的区域即可。相机驱动程序将包含相关说明。如果您想在 1500x1000 中捕获 3000x2000，则可以尝试对图像进行 bin，如果这是您需要的。

或者，您可以使用重新采样后捕获以使图像更小。一种这样的算法是双三次重采样，也是线性重采样——有很多变化。

我想这最后一个是你最感兴趣的......在这种情况下，请查看算法上的[这个维基百科页面](http://en.wikipedia.org/wiki/Bicubic_interpolation)。或者，您可以转到[FreeImage](http://freeimage.sourceforge.net/)并获取一个可以读取图像并且还可以调整图像大小的库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-13T03:05:43.423

`UIImageJPEGRepresentation`可以解决问题，但我发现使用该`ImageIO`框架通常会在相同质量设置下获得明显更好的压缩结果。它可能会更慢，但根据您的用例，这可能不是问题。

（代码改编`NSData`自 Zachary West 的这篇[博客文章](http://zacwe.st/blog/saving-jpegs/)）。

```
#import <MobileCoreServices/MobileCoreServices.h>
#import <ImageIO/ImageIO.h>

...

+ (NSData*)JPEGDataFromImage:(UIImage*)image quality:(double)quality
{
    CFMutableDataRef outputImageDataRef = CFDataCreateMutable(kCFAllocatorDefault, 0);
    CGImageDestinationRef imageDestinationRef = CGImageDestinationCreateWithData(outputImageDataRef, kUTTypeJPEG, 1, NULL);

    NSDictionary* properties = @{
        (__bridge NSString*)kCGImageDestinationLossyCompressionQuality: @(quality)
    };
    CGImageDestinationSetProperties(imageDestinationRef, (__bridge CFDictionaryRef)properties);

    CGImageDestinationAddImage(imageDestinationRef, image.CGImage, NULL);

    CGImageDestinationFinalize(imageDestinationRef);

    CFRelease(imageDestinationRef);

    NSData* imageData = CFBridgingRelease(outputImageDataRef);
    return imageData;
} 
```

# asp.net - 使用带有数组的 ASP.NET 中继器？

> ID：487318
> 
> 赞同：13
> 
> 时间：2009-01-28T11:35:00.030
> 
> 标签：asp.net, arrays, testing, webforms, repeater

这可能是一个愚蠢的问题，但我正在编写一个快速测试页面并意识到我不知道如何将字符串数组或 ArrayList 绑定到 ASP.NET 中继器。

我试验了一下。

```
 <asp:Repeater ID="rptImages" runat="server">
        <HeaderTemplate>
            <h3>Items</h3>
        </HeaderTemplate>
        <ItemTemplate>
            <p style="background-color:Black;color:White"><%#Eval(Container.DataItem.ToString())%></p>
        </ItemTemplate>
        <FooterTemplate>
            <h4>End of Items</h4>
        </FooterTemplate>
    </asp:Repeater> 
```

我完全愚蠢吗？我只真正将它用于具有属性的对象集合。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-28T11:50:08.453

呵呵……

```
<%# Container.DataItem %> 
```

# sql - SQL Server，将 NTEXT 转换为 NVARCHAR(MAX)

> ID：487324
> 
> 赞同：10
> 
> 时间：2009-01-28T11:36:29.840
> 
> 标签：sql, sql-server, sql-server-2005

我有一个数据库，其中包含大量当前为 NTEXT 的字段。

升级到 SQL 2005 后，我们运行了一些将这些转换为 NVARCHAR(MAX) 的性能测试。

如果你读到这篇文章：

[http://geekswithblogs.net/johnsPerfBlog/archive/2008/04/16/ntext-vs-nvarcharmax-in-sql-2005.aspx](http://geekswithblogs.net/johnsPerfBlog/archive/2008/04/16/ntext-vs-nvarcharmax-in-sql-2005.aspx)

这解释了简单的 ALTER COLUMN 不会将数据重新组织成行。

我用我的数据体验到了这一点。如果我们只运行 ALTER COLUMN，我们实际上在某些方面的性能要差得多。但是，如果我为所有这些字段运行一个 UPDATE Table SET Column = Column，我们就会获得非常巨大的性能提升。

我遇到的问题是数据库由数百个具有数百万条记录的列组成。一个简单的测试（在低性能虚拟机上）有一个包含 700 万条记录的单个 NTEXT 列的表需要 5 个小时来更新。

任何人都可以就如何以更有效的方式更新数据以最大程度地减少停机时间和锁定提供任何建议吗？

编辑：我的备份解决方案是随着时间的推移更新块中的数据，但是，对于我们的数据，这会导致性能更差，直到所有记录都已更新，并且时间越短越好，所以我仍在寻找更快的更新方式。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T14:16:15.210

如果您无法获得预定的停机时间......

创建两个新列： nvarchar(max) processesflag INT DEFAULT 0

在已处理标志上创建非聚集索引

您可以使用 UPDATE TOP（您想更新按主键排序的 top）。

只需在更新期间将已处理标志设置为 1，以便下一次更新将仅在已处理标志仍为 0 的情况下更新

您可以在更新后使用@@rowcount 来查看是否可以退出循环。

我建议在每次更新查询后使用 WAITFOR 几秒钟，让其他查询有机会获取表上的锁，而不是使磁盘使用量过载。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T11:49:04.540

如何批量运行更新 - 一次更新 1000 行。

您将使用一个递增计数器的 while 循环，对应于更新查询的每次迭代中要更新的行的 ID。这可能不会加快更新所有 700 万条记录所需的时间，但应该会大大降低用户因记录锁定而遇到错误的可能性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T14:21:39.350

如果您可以获得预定的停机时间：

1.  备份数据库
2.  将恢复模式更改为简单
3.  从您正在更新的表中删除所有索引
4.  添加带有非聚集索引的列maintenanceflag(INT DEFAULT 0)
5.  运行：UPDATE TOP 1000 tablename SET nvarchar from ntext, maintenanceflag = 1 WHERE maintenanceflag = 0

根据需要多次（在一个有延迟的循环内）。

完成后，进行另一次备份，然后将恢复模式更改回原来的模式并添加旧索引。

请记住，该表上的每个索引或触发器都会导致额外的磁盘 I/O，并且简单恢复模式可以最大限度地减少日志文件 I/O。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T13:58:35.293

在低性能虚拟机上运行数据库测试并不能真正表明生产性能，所涉及的繁重 IO 将需要快速磁盘阵列，虚拟化将对其进行节流。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T14:37:01.333

您还可以考虑进行测试以查看 SSIS 包是否可以更有效地执行此操作。

无论您做什么，都要让它成为一个可以在非工作时间安排和运行的自动化流程。您尝试访问数据的用户越少，一切都会越快。如果可能的话，挑出三个或四个最关键的更改并关闭数据库进行维护（在正常关闭的时间内）并在单用户模式下进行。一旦你得到最关键的，其他的可以安排一两个晚上。

# sql - 构建数据库的最佳构建系统是什么？

> ID：487331
> 
> 赞同：2
> 
> 时间：2009-01-28T11:38:32.113
> 
> 标签：sql, database, build-process

这是我偶尔会遇到的一个问题，但尚未找到我满意的答案。我正在寻找一个可以很好地构建数据库的构建系统——它以正确的用户和正确的顺序在正确的数据库实例中运行所有 SQL 文件，并正确处理依赖关系等。

我有一个使用 Gnu Make 一起破解的系统，它可以工作，但它不是特别灵活，坦率地说，在某些情况下使用起来有点痛苦。我也考虑过看看 SCons 和 CMake 之类的东西，但我不知道它们可能会好多少，或者是否有更好的系统已经存在......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-28T11:48:17.710

对于 SQL Server，我只使用带有 SQLCMD.EXE 的批处理文件和一堆 .SQL 文件。它并不完美，但似乎有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T11:50:09.530

对于我的数据库，我使用 Migrator.NET 这是一个 .NET 框架，它允许您在定义 DDL 语句的位置创建类。该框架带有一个命令行工具，您可以使用该工具以正确的顺序执行“迁移”。它还有一个 msbuild - 任务，因此您也可以将它集成到持续集成构建中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T12:20:36.117

只是一个以正确顺序运行所有创建语句和导入的 shell 脚本。您可能还会发现[迁移](http://garrettsnider.backpackit.com/pub/367902)（带有导轨）很有趣。它提供了一个`make`类似的基础架构，让您可以维护一个数据库，该数据库的结构随着时间的推移而发展。

假设您向某个表添加了一个新列。在迁移中，您将编写一段代码，描述添加列的要求以及回滚更改，以便您可以自动切换到不同版本的架构。

不过，我不太喜欢与 rails 紧密集成，但它背后的原理非常有趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-02-11T18:56:36.207

首先导出描述
数据库模式的所有表、视图、源代码（过程、函数、包）、序列和授权的 完整 DDL 文件

请参阅
[是否有工具可以为 SQL Server 生成完整的数据库 DDL？Postgres 和 MySQL 呢？](https://stackoverflow.com/questions/1929815/is-there-a-tool-to-generate-a-full-database-ddl-for-sql-server-what-about-postg)

我创建了一个数据库构建系统（部分是 SQL 解析器，部分是制作文件）来使用 python 将这些文件放在一个数据库创建脚本中。

# asp.net - WebApp 中的 EntiryFramework：如何存储 DSN

> ID：487332
> 
> 赞同：0
> 
> 时间：2009-01-28T11:39:45.120
> 
> 标签：asp.net, security, entity-framework

我在 asp.net 3.5 Web 应用程序中使用实体框架。

以安全（加密）方式存储数据库连接字符串的最佳实践是什么？（我使用用户名/密码来访问数据库）

（我必须经常删除模型，因为 vs2008 中的数据库设计器不会很好地更新外键）​​。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T13:40:17.827

一种选择是加密 web.config 文件中包含连接字符串的配置部分。有关详细信息，请参阅[此支持文章](http://support.microsoft.com/kb/329290)。

# iphone - 将 SQLite 数据库添加到 iPhone 应用程序

> ID：487339
> 
> 赞同：23
> 
> 时间：2009-01-28T11:40:38.647
> 
> 标签：iphone, cocoa-touch, sqlite

我正在尝试学习 SQLite，并且正在构建一个 iPhone 应用程序。但我想在我的构建应用程序中添加一个 SQLite 数据库。我有三个教程，但我不清楚那个代码。

如何将 SQLite 数据库添加到我的构建应用程序？示例代码会是什么样子？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-28T12:58:00.533

首先，您需要创建数据库。
从命令行创建您的 db 文件。

```
sqlite3 mydb.db 
```

然后在您的数据库中创建表

```
CREATE TABLE tags (id int(5), name varchar(255), created_at datetime, updated_at datetime); 
```

对您想要在数据库中的任何表重复此操作。

然后你需要在你的项目中包含数据库文件。像添加任何其他现有文件一样，将现有数据库文件添加到您的项目中。

接下来，您必须在框架中链接才能与数据库进行交互。这可以在您当前的 iPhone SDK 文件夹下找到。

*/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS2.2.sdk/usr/lib/libsqlite3.0.dylib*

最后你必须包含头文件 sqlite3.h 来自

*/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS2.2.sdk/usr/include/sqlite3.h*

现在应该可以编写代码来从您的 iPhone 应用程序中访问您的 sqlite 数据库。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-28T13:12:36.587

**网上有很多信息。**

你看过演示应用程序吗？[SQLite Book List](http://developer.apple.com/iphone/library/samplecode/SQLiteBooks/index.html)这显示了 SQLite 下常用数据库函数的示例。这有效地使用了标准 SQLite C API。

有可能更适合您的 Objective C 包装器。 [EntropyDB](http://code.google.com/p/entropydb/)、[SQLitePersistenceObjects](http://code.google.com/p/sqlitepersistentobjects/)和[FMDB](http://gusmueller.com/blog/archives/2008/06/new_home_for_fmdb.html)。

我找到了本[教程](http://icodeblog.com/2008/08/19/iphone-programming-tutorial-creating-a-todo-list-using-sqlite-part-1/)和可能有帮助的[资源列表。](http://www.mobileorchard.com/iphone-sqlite-tutorials-and-libraries/)

最近我一直在使用[ORM SQLite.net](http://code.google.com/p/sqlite-net/)这是我要走的路，但后来我在 MonoTouch C# 中进行开发。

托尼

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-04T00:48:37.860

我还建议查看[FMDB](http://code.google.com/p/flycode/)。它使 SQLite 的使用更加类似于 Objective-C/Cocoa。它不是一个完整的 ORM 包装器或任何东西；它只是将 C API 包装成更美味的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-29T13:53:26.177

如果您使用 Firefox，则可以使用这个[方便的插件](https://addons.mozilla.org/en-US/firefox/addon/sqlite-manager/)来管理和创建 SQLite 数据库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-28T14:17:47.843

[http://sqlite.org/docs.html](http://sqlite.org/docs.html)是一个很好的起点。

如果您更具体地了解您正在尝试做的事情以及遇到的障碍，您可能会获得更多有用的帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-18T12:48:04.343

您必须在框架中链接才能与数据库进行交互。这可以在您当前的 iPhone SDK 文件夹下找到。

```
/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS2.2.sdk/usr/lib/libsqlite3.0.dylib 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T17:55:49.277

CoreData 应该有帮助，但我在可导入框架列表中的任何地方都找不到它。

您可以看一下 iPhone 示例，尤其是[SQLite Book List](https://developer.apple.com/iphone/library/samplecode/SQLiteBooks/index.html)示例。

# c++ - 彻底关闭 ATL 应用程序

> ID：487340
> 
> 赞同：1
> 
> 时间：2009-01-28T11:40:45.383
> 
> 标签：c++, atl, exit-handler

我已经开发了一个控制台 ATL 应用程序并且想要捕获关闭？、退出？、终止？事件，以便我可以关闭日志文件并在退出时执行一般清理。

如何捕获由于某人在任务管理器中结束 .exe 而导致的“终止”事件？

**编辑：**

这是一个控制台应用程序，我附加了主类。你能指出我应该在哪里以及如何使用`SetConsoleCtrlHandler`吗？

```
// Override CAtlExeModuleT members
int WinMain(int nShowCmd) throw()
{   
    if (CAtlBaseModule::m_bInitFailed) //ctor failed somewhere
    {
        ATLASSERT(0);
        return -1;
    }

    HRESULT hr = S_OK;

    LPTSTR lpCmdLine = GetCommandLine(); //this line necessary for _ATL_MIN_CRT

    if( ParseCommandLine( lpCmdLine, &hr ) )
    {
        if( SUCCEEDED( RegisterClassObjects( CLSCTX_LOCAL_SERVER, REGCLS_MULTIPLEUSE ) ) )
        {
            CComPtr<IRORCAdapterMain> pAdapter;

            if( SUCCEEDED( pAdapter.CoCreateInstance( L"RORCAdapter.RORCAdapterMain" ) ) )
            {
                if( SUCCEEDED( pAdapter->StartAdapter() ) )
                {
                    MSG msg;

                    while( GetMessage( &msg, 0, 0, 0 ) )
                        DispatchMessage( &msg );
                }
            }

            RevokeClassObjects();
        }
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T11:46:18.633

您不能从任务管理器的“进程”选项卡中捕获“结束进程”。如果一个程序可以捕获它，你会如何杀死它？

要响应任务管理器中应用程序选项卡上的“结束进程”，请在主窗口中处理 WM_CLOSE 消息。

这假定您的 ATL 应用程序是 Windows GUI 应用程序。如果是控制台应用程序，则需要查看 SetConsoleCtrlHandler。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T15:48:16.143

捕捉 Ctrl-C / Ctrl-Break 并不难。只需调用 SetConsoleCtrlHandler 来指定哪个回调函数应该处理它。

（希望）举例说明：

```
#include <wincon.h>

bool g_terminate = false;

int main(void)
{
    SetConsoleCtrlHandler( control_handler, TRUE );

    while ( !g_terminate )
    {
       doWork();
    }    
}

int WINAPI control_handler ( DWORD dwCtrlType )
{
    switch( dwCtrlType )
    {
        case CTRL_BREAK_EVENT:  
        case CTRL_C_EVENT:      
            g_terminate = true;
            return 1;
        default:
            return 0;
    }
} 
```

/L

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T15:53:25.510

当然，要让您终止示例，请在 control_handler 中替换

```
g_terminate = true; 
```

和

```
PostMessage(HWND_BROADCAST, WM_CLOSE, 0, 0); 
```

# c++ - QSqlTableModel 继承表中的错误

> ID：487342
> 
> 赞同：1
> 
> 时间：2009-01-28T11:42:29.470
> 
> 标签：c++, qt4

我有一个继承自 QSqlTableModel 的类，它在调用 submitAll() 插槽后中断，在调用 insertPoint 几次之后。这是代码。

谢谢您的帮助。

问候。

```
#ifndef VWLANDMARKTABLEMODEL_H
#define VWLANDMARKTABLEMODEL_H

#include <QSqlTableModel>

class GraphicsPointLandmarkItem;

class VWLandmarkTableModel : public QSqlTableModel
{
    Q_OBJECT
public:
    enum Column {
        IdColumn=0,
        IdImageColumn=1,
        UsernameColumn=2,
        NameColumn=3,
        DefinitionColumn=4
    };

    VWLandmarkTableModel(QObject *parent=0);

    int idImage() const { return m_idImage; }
    QString username() const { return m_username; }
    void setIdImage(int idImage);
    void setUsername(const QString &username);
    virtual bool select();
    bool insertPoint(GraphicsPointLandmarkItem *item);
signals:
protected:
    virtual void setFilter(const QString &filter) 
        { QSqlTableModel::setFilter(filter); }
    virtual bool insertRowIntoTable(const QSqlRecord &values);
protected slots:
    void setDefaults(int row, QSqlRecord &r);
private:
    QString m_username;
    int m_idImage;
};

#endif // VWLANDMARKTABLEMODEL_H

#include "vwlandmarktablemodel.h"

#include <QtGui>
#include <QtSql>
#include <QtCore>

#include "graphicspointlandmarkitem.h"

VWLandmarkTableModel::VWLandmarkTableModel(QObject *parent)
    : QSqlTableModel(parent)
{ 
    setTable("vwLandmark");
    setEditStrategy(OnManualSubmit);

    connect(this, SIGNAL(primeInsert(int,QSqlRecord&)), 
        SLOT(setDefaults(int,QSqlRecord&)));
}

void VWLandmarkTableModel::setIdImage(int idImage)
{ m_idImage=idImage; }

void VWLandmarkTableModel::setUsername(const QString &username)
{ m_username=username; }

bool VWLandmarkTableModel::select()
{
    Q_ASSERT(!username().isEmpty());

    QString stmt="IdImage = %1 AND Username = '%2'";

    setFilter(stmt.arg(idImage()).arg(username()));
    return QSqlTableModel::select();
}

bool VWLandmarkTableModel::insertPoint(GraphicsPointLandmarkItem *item)
{
    QString text;
    QTextStream out(&text);
    int row=rowCount();
    bool ok;

    ok=insertRow(row); Q_ASSERT(ok);

    QModelIndex idx=index(row, DefinitionColumn);

    out<<*item;
    ok=setData(idx, text); 
    Q_ASSERT(ok);
    idx=index(row, NameColumn);
    ok=setData(idx, tr("New point landmark"));
    Q_ASSERT(ok);
    return ok;
}

bool VWLandmarkTableModel::insertRowIntoTable(const QSqlRecord &values)
{
    QString sql="EXEC InsertLandmark :IdImage,:Definition";
    QSqlQuery q;
    bool ok;

    ok=q.prepare(sql); Q_ASSERT(ok);
    q.bindValue(":IdImage", values.value("IdImage"));
    q.bindValue(":Definition", values.value("Definition"));
    q.setForwardOnly(true);
    if(!q.exec()) {
        setLastError(q.lastError());
        return false;
    }
    qDebug()<<"hola mundo";
    return true;
}

void VWLandmarkTableModel::setDefaults(int row, QSqlRecord &r)
{
    r.setValue("IdImage", idImage());
    r.setValue("Name", "Unnamed landmark");
    r.setValue("Username", username());
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T08:35:40.203

问题出在我的自定义选择中。调用 setFilter() 会导致无限调用循环

# math - 学习游戏编程（第 2 部分）（数学）

> ID：487352
> 
> 赞同：15
> 
> 时间：2009-01-28T11:49:45.163
> 
> 标签：math, vector, 3d

[所以，距离我写这个问题](https://stackoverflow.com/questions/174830/learning-game-programming)已经有几个月了，从那以后我玩弄了“原始”C++ D3D、Ogre 和 Irrlicht 图形引擎以及最近的 Microsoft XNA。我已经制作了一些 2D 游戏（主要是俄罗斯方块、小行星等旧东西的复制品），并在上述技术中向 3D 世界迈出了一些（非常）小步。

创建实际的游戏逻辑、抽象出对象交互以允许我插入不同形式的控制（计算机、播放器、网络等）、执行线程或我使用的任何其他东西时，我几乎没有问题从我的日常工作开始——这对我来说感觉非常自然。我很少使用 HLSL 和粒子效果（非常非常基础）。

**但是**涉及矩阵和向量的 3D 数学（以及 Ogre3D 中的四元数（？），这些*真的*需要吗？）......真的让我明白，我可以遵循示例（例如，我从 O'Reilly 购买的 Learning XNA 3.0 书，这是一本很棒的书顺便说一句），我理解示例中发生某些事情的*原因*和*方式*，但是当我尝试自己做某事时，我觉得我缺乏对这种数学的理解，无法*真正*理解并使其工作我。

所以我正在寻找学习 3D 数学（主要是）和一些着色器/粒子效果书籍的资源。我更喜欢教育性的资源，并且比诸如向量数学的医生论文之类的东西要慢一点，这将*超出*我的想象。理想的资源应该是在 D3D 中展示这一切的东西。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-28T12:45:52.757

好的，矩阵/向量计算的快速课程：

矩阵是在矩形网格中排序的数字集合，例如：

```
[ 0,  1,  2 ]
[ 2,  3,  5 ]
[ 2,  1,  3 ]
[ 0,  0,  1 ] 
```

上述矩阵有 4 行 3 列，因此是一个 4 x 3 矩阵。向量是具有 1 行（行向量）或 1 列（列向量）的矩阵。正态数称为标量以与矩阵进行对比。

矩阵使用大写字母，标量使用小写字母也很常见。

我们可以用矩阵进行基本计算，但有一些条件。

**添加**

如果矩阵具有相同的维度，则可以添加矩阵。因此，2x2 矩阵可以添加到 2x2 矩阵，但不能添加到 3x5 矩阵。

```
[ 1,  2 ] + [ 2,  5 ] = [ 3,  7 ]
[ 2,  4 ]   [ 0,  3 ]   [ 2,  7 ] 
```

您会看到，通过添加每个单元格中的每个数字，都会将其添加到另一个矩阵中相同位置的数字上。

**矩阵乘法**

矩阵可以相乘，但这有点复杂。为了将矩阵 A 与矩阵 B 相乘，您需要将矩阵 A 中的每一行中的数字与矩阵 B 中的每一列相乘。这意味着如果将 axb 矩阵与 acxd 矩阵相乘，则 b 和 c 必须相等，并且结果矩阵为 axd：

```
[1,2,3] x [4,6] = [1x4+2x2+3x2, 1x6+2x1+3x3 ] = [4+4+6,  6+2+9  ] = [14, 20]
[1,4,5]   [2,1]   [1x4+4x2+5x2, 1x6+4x1+5x3 ]   [4+8+10, 6+4+15 ]   [22, 25]
          [2,3] 
```

如您所见，对于矩阵，A x B 不同于 B x A。

**矩阵标量乘法**

您可以将矩阵与标量相乘。在这种情况下，每个单元格都乘以该数字：

```
3 x [1,2] = [ 3, 6]
    [4,7]   [12,21] 
```

**反转矩阵** 矩阵除法是不可能的，但您可以创建一个矩阵的反转，使得 A x A-inv 是一个除主对角线外全为零的矩阵：

```
[ 1, 0, 0 ]
[ 0, 1, 0 ]
[ 0, 0, 1 ] 
```

矩阵求逆只能用方阵来完成，这是一项复杂的工作，不一定有结果。

从矩阵 A 开始：

```
 [ 1, 2, 3 ]
A = [ 1, 3, 4 ]
    [ 2, 5, 1 ] 
```

我们添加 3 个额外的列并用单位矩阵填充它们：

```
[ 1, 2, 3, 1, 0, 0 ]
[ 1, 3, 4, 0, 1, 0 ]
[ 2, 5, 1, 0, 0, 1 ] 
```

现在我们从第一列开始。我们需要从每一行中减去第一行，使得第一列除了第一行之外只包含零。为了做到这一点，我们从第二行中减去第一行一次，从第三行中减去两次：

```
[ 1, 2, 3, 1, 0, 0 ]
[ 0, 1, 1,-1, 1, 0 ]
[ 0, 1,-5,-2, 0, 1 ] 
```

现在我们对第二列重复此操作（第一行两次，第三行一次）

```
[ 1, 0, 1, 3,-2, 0 ]
[ 0, 1, 1,-1, 1, 0 ]
[ 0, 0,-6,-1,-1, 1 ] 
```

对于第三列，我们有一个小问题。枢轴数是 -6 而不是 1。但我们可以通过将整行乘以 -1/6 来解决这个问题：

```
[ 1, 0, 1,   3,  -2,    0 ]
[ 0, 1, 1,  -1,   1,    0 ]
[ 0, 0, 1, 1/6, 1/6, -1/6 ] 
```

现在我们可以从第一行和第二行中减去第三行：

```
[ 1, 0, 0, 17/6,-13/6,  1/6 ]
[ 0, 1, 0, -7/6,  5/6,  1/6 ]
[ 0, 0, 1,  1/6,  1/6, -1/6 ] 
```

好的，现在我们有了 A 的倒数：

```
[ 17/6,-13/6,  1/6 ]
[ -7/6,  5/6,  1/6 ]
[  1/6,  1/6, -1/6 ] 
```

我们可以这样写：

```
 [ 17,-13,  1 ]
1/6 * [ -7,  5,  1 ]
      [  1,  1, -1 ]

    [ 1, 2, 3 ]   [ 17,-13,  1 ]                [ 6, 0, 0 ]    [ 1, 0, 0 ]
A = [ 1, 3, 4 ] x [ -7,  5,  1 ] x 1/6  = 1/6 x [ 0, 6, 0 ] =  [ 0, 1, 0 ]
    [ 2, 5, 1 ]   [  1,  1, -1 ]                [ 0, 0, 6 ]    [ 0, 0, 1 ] 
```

希望这个对你有帮助。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-28T12:37:48.017

Fredrik - 简短的回答是，是的，您必须学习矩阵和向量，因为它们是 3D 工作的数学基础。

虽然线性代数绝对不是博士水平的数学，但它需要一些工作。要开始使用，请在亚马逊上查看[这本书](https://rads.stackoverflow.com/amzn/click/com/1556229119)：它看起来正是您正在寻找的。我没有读过这本特别的书（我在研究生院使用的那本书有点过时了），但它的评价特别好。

另一件事：市场上有各种 3D 建模引擎可以为您完成这项工作。其中最著名的可以说是 Valve 的[Source Engine](http://en.wikipedia.org/wiki/Source_engine)。您可以使用这个引擎（专为 HalfLife2 和 CounterStrike 构建）来创建一些非常复杂的游戏，同时工作在 3D 建模级别*之上。*事实上，作为 Steam 网络上最受欢迎的游戏之一，[Garry 的 mod](http://garrysmod.com/)开始时有人只是在玩一些你可以用 Steam 引擎做的很酷的事情。这是一个站点的[链接](http://www.tutorialhero.com/click-32134-setting_up_hammer_for_the_very_first_time.php)，该站点提供了使用 Source Engine 构建自己的世界的教程，以防您感兴趣。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T22:16:26.997

你肯定需要学习线性代数。麻省理工学院在 youtube 上免费发布了整个课程。你可以从[这里](https://www.youtube.com/watch?v=ZK3O402wf1c)开始。没那么难，相信我！玩得开心 ;）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T22:02:47.273

“[计算机图形应用数学](https://rads.stackoverflow.com/amzn/click/com/083113111X)”是一本入门级教科书，采用适合课堂的方法来学习 3D 编程需要熟悉的所有基本数学（主要是矩阵和向量）

还有关于四元数的说明：它们对某些应用*非常*有用。SLERP（球面线性插值）可以非常方便地制作平滑/吸引人的相机运动（除其他外）。SLERP 对于矩阵来说是一种痛苦（昂贵），但对于四元数来说既便宜又容易。学会使用并爱上它们——即使你不完全理解它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-28T12:04:47.207

特别是对于向量，线性代数的介绍性文本或课程应该能够让您很快上手。

# logging - 非 Web 应用程序的日志分析器

> ID：487360
> 
> 赞同：2
> 
> 时间：2009-01-28T11:54:00.630
> 
> 标签：logging

我一直在寻找某种工具来分析自定义格式的日志文件（例如我自己的程序格式）。有许多工具专为 Web 流量日志分析而设计，但我还没有找到适合自定义日志文件的工具。我很乐意找到一个可以收集所有时间戳并据此得出结论或图表的地方。例如显示 TPS（每秒事务数）。

我最好使用免费程序。基本上它可以是任何类型的数据分析器，只要它能够解析日志文件。如果我只需要分析一种文件，我会编写自己的程序，但我需要分析各种各样的文件。

很长时间以来，我确实尝试在谷歌上搜索合适的工具，但每个分析器似乎都是为网络流量而设计的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T12:23:35.330

使用[Log Parser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)，您可以通过简单的 sql 查询获取信息。

在 cmd 行用于文本文件使用，如下所示：

```
LogParser -i:textline "select * from 'c:\path\*.txt' where text like '%TEXT TO FIND%'" 
```

或尝试使用[GUI](http://www.codeplex.com/visuallogparser)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T12:19:49.563

这个问题对我来说似乎有点宽泛，但是您的一个示例（使用时间戳计算/显示每秒事务的图表）向我尖叫[RRD 。](http://oss.oetiker.ch/rrdtool/ "RRD")

虽然这可以帮助您分析和绘制数据图表，但它的级别非常低，可能需要在您的站点上进行一些工作。如果您对 Web 应用程序没有任何问题，您可能希望查看基于 RRD的[Cacti ，它为您提供了一种图形化的方式来分析您的数据和配置数据源。](http://www.cacti.net/)您可能*仍然*需要创建脚本来从日志文件/其他文件中提取您选择的数据，但是您可以免费获得“GUI”。

底线：编写一些 (g)awk/perl 脚本并使用上面提到的工具，您应该可以轻松完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T12:24:50.973

在以前的工作中，我维护了一些 perl 脚本来汇总这类数据并将其放入 postgres 数据库中......然后使用 www.databeacon.com 进行分析......但是在您获得数据库中的信息后可以生成任何你想要的图表......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T13:20:06.917

您可以尝试将文件导入 Excel 或 Access 等电子表格或数据库应用程序。

# jboss - 如何让 JBoss 分解已部署的 WAR 文件？

> ID：487363
> 
> 赞同：17
> 
> 时间：2009-01-28T11:54:54.060
> 
> 标签：jboss, web-applications

我在 /usr/local/jboss-4.3/ 下的 Ubuntu 上运行 JBoss 4.3。我已将我的应用程序作为 WAR 文件（即 myapp.war）部署到 /usr/local/jboss-4.3/server/myserver/deploy。但是，deploy 文件夹下似乎没有'exploded' /myapp 目录，这是怎么回事？

我习惯了在 Windows 上运行的 Tomcat，所以我对 JBoss 有点陌生。当你将 WAR 部署到 Tomcat 时，这个 WAR 的物理内容将被分解到 /myapp 目录。有了这个，就可以修改网络应用程序下的文件，例如配置设置等。

我怎样才能在 JBoss 中做到这一点？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-28T16:08:27.403

您可以将 .war 内容解压缩到“myapp.war”文件夹中，JBoss 会将其视为已部署的应用程序，就好像它是压缩的战争一样。

更好的是，大多数 IDE（当然是 Eclipse，但我猜其他 IDE，例如 Netbeans）允许您部署展开的包而不是压缩的 .war，从而允许您只更改您修改的单个文件而不是整个 .war 包

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-11-24T14:20:55.657

此链接可能很有用：

[http://community.jboss.org/wiki/DeployTipsAndBuildSampleScripts](http://community.jboss.org/wiki/DeployTipsAndBuildSampleScripts)

本文关注内容的快速总结：当涉及到 JBoss 中的应用程序构建/部署时，有很多可行的方法。这个 wiki 重点介绍了几个构建/部署场景，以及步骤和相关的构建脚本示例。涵盖以下方法：

*   使用 JBossIDE 的点/点击部署 - 对于不喜欢 ANT 构建脚本的用户

*   Exploded EAR、JAR、SAR、WAR 部署（选项 1） - 通过消除 ANT 复制任务最大限度地提高开发效率

*   Exploded EAR、JAR、SAR、WAR 部署（选项 2） - 将 IDE 与编译、构建和部署过程分开

*   正常 EAR、JAR、SAR、WAR 部署 - 部署压缩存档（使用集群/农场部署时是必需的

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-08T10:27:38.643

面临同样的问题，当我`.war`从 Eclipse 导出为文件并将其复制到（UAT 或 Prod）JBOSS Server 7.1.1 Final AS 部署目录，并启动成功部署的 Windows JBOSS 服务 .war 文件但`.war`文件未解包或分解到部署文件夹中时。

对于此解决方案，将 example.war 展开的文件夹（文件夹名称）复制到部署文件夹中，然后启动。并在 standalon.xml 中提到 auto-deploye-exploded=true

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T12:20:02.967

它在 tmp 文件夹中执行此操作......

但是您可以在部署目录中分解文件，只需将其命名为“app.war”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-19T15:28:29.890

我在使用 JBoss 7 时遇到了完全相同的问题。我的 ant 脚本会将**.war**文件复制到 JBoss*部署*文件夹（我的系统中的*jboss-as-7.1.1.Final/standalone/deployments*），但**.war**不会爆炸. **.war**可以通过管理 CLI 完美部署，因此它不是不满意的依赖项或其他任何东西。当我指示我的 Ant 战争任务**不压缩**战争（将属性*compress*设置为*false*）时，它已解决，如下所示：

```
...
<target name="war" depends="build">
  <mkdir dir="${build.dir}"/>
  <war
    compress="false"
    needxmlfile="false"
    basedir="${webroot.dir}"
    warfile="${build.dir}/${project.distname}.war">
    <exclude name="WEB-INF/${build.dir}/**"/>
    <exclude name="WEB-INF/src/**"/>
   </war>
</target> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-03-16T15:20:03.893

在standalone.xml 中，我只看到这部分代码：

```
<subsystem xmlns="urn:jboss:domain:deployment-scanner:1.1"> 
```

我没有看到部署扫描器参数，例如：

```
auto-deploy-exploded" => false, 
```

“自动部署压缩”=> 真，“部署超时”=> 60L，

等等。

# sql-server - OLE DB 命令中存储过程的 SSIS 返回值

> ID：487366
> 
> 赞同：9
> 
> 时间：2009-01-28T11:55:59.067
> 
> 标签：sql-server, stored-procedures, ssis, oledbcommand

我正在迁移必须使用已经存在的存储过程插入的数据。存储过程具有插入行的 id 参数和返回值（来自 select 语句）。在 SSIS 的 OLE DB 命令中，我可以调用将列值作为参数传递的存储过程，并且我通常在存储过程上使用输出参数来处理“id”输出；但是我不确定当过程使用选择返回 id 值时如何使用返回值来处理这个问题。这是我之前使用的示例，但我需要获取从选择返回的值：

```
exec dbo.uspInsertContactAddress
@Address = ?,
@ContactID = ?,
@DeliveryMethodId = ?,
@ID = ? output,
@Version = ? output 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-04T13:01:35.417

我发现我可以做到这一点的方式实际上非常简单：

```
exec ? = dbo.StoredProc @param = ?, @param2 = ? 
```

然后@RETURN_VALUE 将出现在可用目标列上

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-28T17:48:44.363

不要在 SqlCommand 属性中使用变量名，只使用问号和输出参数的“OUT”或“OUTPUT”标签。

获取输出参数值的技巧是将派生列转换放在 OLE DB 命令之前的管道中，以引入列（映射到 SSIS 变量）以捕获过程结果。

有关如何执行此操作的屏幕截图，请参阅[OLEDB 命令转换和标识列。](http://wiki.sqlis.com/default.aspx/SQLISWiki/OLEDBCommandTransformationAndIdentityColumns.html?diff=y)另请参阅第一个链接中使用的[垃圾目标适配器的垃圾目标适配器。](http://www.sqlis.com/post/Trash-Destination-Adapter.aspx)这是一个方便的工具，可用于调试这样的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T23:50:58.603

如果存储过程返回一个结果集，那么您需要捕获它：

```
DECLARE @results TABLE (
    [ID] INT NOT NULL
)

INSERT @results ([ID])
EXEC dbo.uspInsertContactAddress @Address = ?, @ContactID = ?, @DeliveryMethodId = ?, @ID = ? output, @Version = ? output

SELECT * FROM @results 
```

注意：我使用了 TABLE 变量。您可能需要使用临时表，具体取决于您的 SQL Server 版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T23:39:00.407

我一直在执行 SQL 任务中使用参数映射并取得了很大的成功。SQL 语句是“EXEC nameofstoredproc ?, ? OUTPUT”，问号指定参数的位置，如果参数是输出，则为 OUTPUT。

您可以使用适当的变量名称、方向（输入、输出、ReturnValue）和数据类型来指定映射中的参数。由于您的存储过程正在通过结果集返回您想要的数据，因此请指定变量的方向以收集 ID 和版本作为 ReturnValue。它应该适合你。

# c# - 泛型方法类型参数的 C# 类型推断，其中方法没有参数

> ID：487373
> 
> 赞同：7
> 
> 时间：2009-01-28T12:00:30.120
> 
> 标签：c#, generics, type-inference

给定以下通用接口和实现类：

```
public interface IRepository<T> {
    // U has to be of type T of a subtype of T
    IQueryable<U> Find<U>() where U : T;
}

public class PersonRepository : IRepository<Employee> {

} 
```

如果不指定 U，我怎么能调用 Find 方法？

```
var repository = new EmployeeRepository();
// Can't be done
IQueryable<Employee> people = repository.Find();

// Has to be, but isn't Employee a given in this context?
IQueryable<Employee> people = repository.Find<Employee>();

// Here I'm being specific
IQueryable<Manager> managers = repository.Find<Manager>(); 
```

换句话说，可以做些什么来进行类型推断？

谢谢！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-28T12:08:47.217

> 如果不指定 U，我怎么能调用 Find 方法？

### 你不能。

不幸的是，C# 的泛型方法重载决议不匹配基于返回值。

请参阅 Eric Lippert 的博客文章： [C# 3.0 Return Type Inference doesn't Work On Method Groups](http://blogs.msdn.com/ericlippert/archive/2007/11/05/c-3-0-return-type-inference-does-not-work-on-member-groups.aspx)

但是写这个的一种简单方法是使用`var`关键字。

```
var employees = repository.Find<Employee>(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-28T12:03:25.963

怎么写

```
var people = repository.Find<Employee>(); 
```

它节省了相同数量的打字，但方式不同。

# asp.net - 如何使自定义控件的属性成为泛型类型？

> ID：487374
> 
> 赞同：0
> 
> 时间：2009-01-28T12:01:03.957
> 
> 标签：asp.net, generics, controls, web-controls

我创建了一个自定义的 ASP.NET 控件（派生自`WebControls.TextBox`）。

我想向该控件添加一个属性，该属性将是一种类型。

这个属性实际上总是某种类型的 enum 。因此，当在设计器中查看该控件的属性窗口时 - 我希望能够通过从特定枚举中进行选择来为该属性分配值。所以我想在那里看到我传递的枚举中的枚举数列表..

示例（不是将编译的实际代码..只是为了说明我的意思）：

我有 2 个枚举：

```
enum MyEnumABC
{
    A,B,C
}

enum MyColor
{
    Red,Blue,Green
} 
```

我有这个控制：

```
 public class MyTextBox<T> : TextBox
{
    public T Classification
    {
        get { }
        set { }
    }
} 
```

现在我创建了一个具有以下控件的网页：

```
<Alex:MyTextBox runat=server id="alex" Classification=MyEnumABC.A></Alex:MyTextBox>
<Alex:MyTextBox runat=server id="alex2" Classification=MyColor.Red></Alex:MyTextBox> 
```

问题是我实际上可以在哪里将类型传递给该控件的构造函数？（因为页面类是调用控件构造函数的那个​​。）实际上我需要将 alex1 的类型设置为 MyEnumABC ，并将 alex2 的类型设置为 MyColor 类型。

第二个问题是我如何让 VS2008 在 HTML 设计器中支持这一点（这样当我在标签中键入分类时 - 它会打开写入枚举以选择值）和控件的属性页。

我希望你明白我在这里的意思。

谢谢 。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-28T12:57:08.053

设计器将支持枚举属性，而无需您做任何特别的事情。只需在控件代码中指定属性，为其提供所有常用属性以使其显示在属性窗口中，并且属性窗口将自动在下拉列表中显示枚举值。

# php - 将 mysql 转换为 mysqli - 如何获取超全局连接对象？

> ID：487375
> 
> 赞同：4
> 
> 时间：2009-01-28T12:01:15.407
> 
> 标签：php, mysql, mysqli

我正在尝试将代码从 mysql 转换为 mysqli。该代码在一个文件中使用单个 mysql_connect，该文件包含在所有其他文件中。

mysql_connect 返回一个超全局的 MySQL 链接标识符，因此您可以依赖在您自己的任何函数中提供数据库连接。

看起来 mysqli_connect 不是这种情况，返回的对象不是全局的。

这是否意味着我必须添加： global $mysqli; 在每个函数的顶部，或者有没有办法让它成为一个超全局的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-28T12:56:04.343

如果您不指定一个，则依赖于 PHP 将使用最后打开的连接资源这一事实，这可能不是一个好主意。
如果您的应用程序发生更改并且您需要两个连接，或者连接不存在，会发生什么？
因此，无论如何您似乎都需要进行一些重构。

这是一个类似于 Karsten 的解决方案，它总是返回相同的 mysqli 对象。

```
class DB {
    private static $mysqli;
    private function __construct(){} //no instantiation

    static function cxn() {
        if( !self::$mysqli ) {
            self::$mysqli = new mysqli(...);
        }
        return self::$mysqli;
    }
}        

//use
DB::cxn()->prepare(.... 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T12:08:23.770

我通常做一个功能：

```
$mysqli = new mysqli(...);

function prepare($query) {
  global $mysqli;
  $stmt = $msqyli->prepare($query);
  if ($mysqli->error()) {
    // do something
  }
  return $stmt;
}

function doStuff() {
  $stmt = prepare("SELECT id, name, description FROM blah");
  // and so on
} 
```

然后调用它。话虽如此，我已经放弃了 mysqli ，因为它的漏洞太多而不能被认为是可用的。真是惭愧。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-10-29T05:40:13.797

一个非常简单的方法是使用一个固定的数据库类，只保存 mysqli 连接对象：

```
class Database {
    public static $connection;
}

Database::$connection = new mysqli(HOST, USERNAME, PASSWORD, DATABASE); 
```

然后您可以通过正常方式访问它：

```
$sql = 'SELECT * FROM table';
$result = Database::$connection->query($sql);
$result = mysqli_query(Database::$connection, $sql);
echo 'Server info ' . mysqli_get_server_info(Database::$connection); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T12:15:40.570

要向您介绍一些 oop 并解决您的问题，您可以使用这样的类：

```
class MyDatabase
{
    private static $_connection;

    public static function connect()
    {
        $mysqli = new mysqli(...);
        self::$_connection = $mysqli;
    }

    public static function getConnection()
    {
        return self::$_connection;
    }
} 
```

在您的数据库连接文件中，您将加载此类并执行`MyDatabase::connect();`一次。要在脚本中的任何位置获取 $mysqli-connection，只需调用`MyDatabase::getConnection();`.

# php - 效率、基准测试、速度测试、性能

> ID：487378
> 
> 赞同：3
> 
> 时间：2009-01-28T12:02:04.017
> 
> 标签：php, performance, profiling, benchmarking

我正在尝试编写一个我试图衡量其效率的脚本。我有一些问题：-

1.  对于小型应用程序，是否需要这种分析？还是我变得偏执？（假设大多数代码都相当高效/没有无限循环）
2.  我应该以什么为基准？我应该与什么比较？
3.  下面是我从 ab 得到的效率输出。这种方式是不是太离谱了？我设计这个应用程序的方向是错误的吗？有什么我应该注意的警告信号吗？

```
abs -n10000 -c100 http://localhost/testapp

这是 ApacheBench，版本 2.3
版权所有 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
授权给 Apache 软件基金会，http://www.apache.org/

对本地主机进行基准测试（请耐心等待）
已完成 1000 个请求
已完成 2000 个请求
已完成 3000 个请求
完成 4000 个请求
已完成 5000 个请求
已完成 6000 个请求
已完成 7000 个请求
已完成 8000 个请求
已完成 9000 个请求
已完成 10000 个请求
完成10000个请求

服务器软件：Apache/2.2.10
服务器主机名：本地主机
服务器端口：80

文档路径：/testapp
文档长度：525 字节

并发级别：100
测试时间：33.608 秒
完成请求：10000
失败的请求：5179
   （连接：0，接收：0，长度：5179，例外：0）
写入错误：0
总传输量：6973890 字节
传输的 HTML：5253890 字节
每秒请求数：297.55 [#/sec]（平均）
每个请求的时间：336.080 [ms]（平均值）
每个请求的时间：3.361 [ms]（平均，所有并发请求）
传输速率：收到 202.64 [Kbytes/sec]

连接时间（毫秒）
              最小值平均值[+/-sd] 中值最大值
连接：0 1 1.5 0 109
处理：8 334 403.9 176 3556
等待：7 334 403.9 176 3556
总计：9 335 403.8 177 3556

特定时间内服务的请求百分比（毫秒）
  50% 177
  66% 296
  75% 415
  80% 519
  90% 842
  95% 1141
  98% 1615
  99% 1966
 100% 3556（最长请求）

```

我正在使用 PHP 编写脚本。在进一步测试中，我还发现如果我从我的 PHP 脚本中注释 MySQL 连接部分，“失败的请求”会变为 0。怎么了？如何降低这种失败率？

谢谢你，亚历克

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-28T16:08:35.907

您期望 100 个并发请求吗？您希望在 30 秒内收到 10K 请求吗？

很高兴您可以运行此基准测试，但问问自己这意味着什么。考虑一下您将收到的实际流量。您确实需要一个问题来进行基准测试：

*   我预计我的网站将拥有 3,000 名用户。
*   我预计在高峰使用期间，其中 500 个将点击页面
*   通常的用法是一分钟内 3 个请求：`3 * 500 / 60 = ~ 25 req/sec`
*   我的站点可以处理 25 个请求/秒并做出响应（每个请求<200 毫秒）吗？

除非您处于网络的前百分之几，否则您的页面在现实生活中不会看到 100 个并发请求。为这种流量水平调整您的网站是没有意义的。要达到这些数字，您需要在架构级别做出设计妥协（数据库使用、缓存方法等：因此当数据库打开时您的失败次数）。

如果您只是想分析您的脚本，请使用[xdebug](http://www.xdebug.org/docs/profiler)来查找您的代码花费时间的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T12:08:51.723

我认为这看起来是一项很棒的工作。走开？我会说这远远超过标准。

一个问题是服务器上的负载将在生产中。您的脚本正在此服务器上触发请求，但如果您是开发实例上的唯一用户，您将看不到在处理典型生产负载时访问生产服务器时会发生什么。

如果是这种情况，您需要两个请求来源：一个代表您的新应用程序，另一个代表它将与资源竞争的生产流程。

您可以在基准软件中设置同时用户数吗？这个测试是不是一个接一个地发送 1000 个请求？让多个用户同时敲击服务器可能更现实。

你可以让发送间隔随机吗？这可能更能代表你的真实情况。

你能改变脚本使用的数据吗？它是否代表了它会被很好地使用的条件？

除此之外，我能提供的只有我的祝贺。看来你对我很认真。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T12:25:50.690

您不应该收到任何失败的请求 - 您需要检查错误日志以了解它们失败的原因。

最有可能是 MySQL 连接不足，在这种情况下，您可以简单地调整您的服务器以允许更多的并发连接（如果您期望这样的流量）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T15:12:47.827

尝试使用[xdebug](http://www.xdebug.org/docs/profiler)来分析您的代码。 [xdebug](http://www.xdebug.org/docs/profiler)还将为您提供更好的屏幕错误和堆栈跟踪。

然后使用[webgrind](http://code.google.com/p/webgrind/)以漂亮的格式查看配置文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T12:20:45.023

每个请求约 200 毫秒是一个比较常见的数字，在这个数字上，对于大多数用户来说，页面看起来“很快”。

# svg - 向 SVG 添加新节点 标签

> ID：487386
> 
> 赞同：5
> 
> 时间：2009-01-28T12:05:37.800
> 
> 标签：svg

刚玩defs并第一次使用。我想做的是使用 defs 来构建一个基本模板，然后在我使用它时通过添加更多内部标签来自定义它。

这是否可能，因为当我尝试在 Firefox 中执行此操作时，它不会呈现我作为子项放置到 use 标记的任何标记。例如：

```
<?xml version="1.0" standalone="no"?>
<svg width="10000px" height="5500px" version="1.1"
     baseProfile="full"
     xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink">

    <defs>
        <g id="storyCard">
            <rect width="800px" height="500px" fill="#ffff00" />
            <path d="M 20 120 L 780 120 M 640 20 L 640 120" stroke-width="6px" stroke="black" fill="none" />
        </g>
    </defs>

    <!-- White Board -->
    <path d="M 0 0 L 10000 0 L 10000 550 L 0 5500 z M 2000 0 L 2000 5500" stroke-width="20px" stroke="black" fill="none" />
    <use xlink:href="#storyCard" transform="translate(100,100)" />
    <use xlink:href="#storyCard" transform="translate(1000,200)" >
            <text x="20" y="80" font-size="45" font-weight="bold" font-family="Comic Sans MS, cursive">
                My Dummy Story
            </text>
    </use>
</svg> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-28T12:32:03.503

不能直接使用。[use 元素](http://www.w3.org/TR/SVG/struct.html#UseElement)可以包含描述和动画元素，但它的行为不像[XBL](http://www.w3.org/TR/xbl/)容器。

如果你的目标是 Firefox，你可以使用 XBL。

要留在 SVG 中，请创建一个组并使用背景：

```
 <g transform="translate(1000,200)" >
        <use xlink:href="#storyCard"/>
        <text x="20" y="80" font-size="45" font-weight="bold" font-family="Comic Sans MS, cursive">
            My Dummy Story
        </text>
    </g> 
```

# php - 使用魔法常量类返回调用类的文件路径

> ID：487388
> 
> 赞同：0
> 
> 时间：2009-01-28T12:06:13.663
> 
> 标签：php, constants

我一直在使用以下内容来返回方法的文件路径和行号

```
echo (__METHOD__) . "() - ln : " . (__LINE__) . "<br />"; 
```

我真的很想把它更新成一个类（比如comment.php）

```
class comment
{   
    public static function show()
    {
        echo (__METHOD__) . "() - ln : " . (__LINE__) . "<br />";
    }
} 
```

我可以在我的开发中的任何地方打电话

```
if(COMMENT) comment::show(); 
```

并让它返回调用代码的文件路径。我尝试了一些变体，但我错过了一些东西。你能帮我吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T12:10:40.067

查看[debug_backtrace](http://php.net/debug_backtrace) - 这可以为您提供有关您需要的调用者的信息。

例如：

```
<?php

class comment
{
    public static function show()
    {
            $trace=debug_backtrace();
            print_r($trace);
    }

    public function test()
    {
         comment::show();
    }

}

$comment=new comment();
$comment->test(); 
```

将产生这个输出

```
 Array
(
    [0] => Array
        (
            [file] => /tmp/test.php
            [line] => 13
            [function] => show
            [class] => comment
            [type] => ::
            [args] => Array()

        )

    [1] => Array
        (
            [file] => /tmp/test.php
            [line] => 19
            [function] => test
            [class] => comment
            [object] => comment Object ()
            [type] => ->
            [args] => Array()

        )

) 
```

第一个元素显示调用者详细信息 - 根据您的喜好对其进行格式化，如果有帮助也显示整个调用堆栈！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T12:08:20.167

尝试：

```
echo __FILE__; 
```

# language-agnostic - 有没有使用工厂方法/模式来创建游戏对象/角色的好例子？

> ID：487398
> 
> 赞同：2
> 
> 时间：2009-01-28T12:10:36.290
> 
> 标签：language-agnostic, factory

我想要一种干净的方式来创建游戏对象，例如 NPC、子弹和道具，从而减少对特定类的相互依赖量。我相信这就是工厂模式的用途？

我很想从真正的游戏中看到一个好的实现。

我不是设计模式方面的专家，如果我不理解它们，就永远不要使用它们。我不想为了它而使用设计模式——我只想了解这种模式是否是解决这个问题的正确方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T12:22:12.073

看起来您正在尝试找到解决方案的问题。

在这个特别的问题上，实际上不可能给出一个好的实现，因为它取决于你的游戏对象是如何存储的，它们代表什么。

您不应该尝试寻找如何为问题实现特定模式，而应该为您的问题找到正确的解决方案，这可能是一种设计模式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T13:39:04.740

经过一番谷歌搜索后，我实际上找到了一个很好的例子：

[http://cheezeworld.com/object-creation-game-factory/](http://cheezeworld.com/object-creation-game-factory/)

谢谢大家

# visual-studio - 无线同步程序

> ID：487401
> 
> 赞同：1
> 
> 时间：2009-01-28T12:12:27.287
> 
> 标签：visual-studio, windows-mobile, wifi

嗨，在我到达这里之前，我一直在寻求帮助，但运气并不好。我想开发一个 SQL 服务器数据库和一个应用程序，它将充当服务器以允许 pda 发送数据并无线同步和发送信息因为它使用移动应用程序我想通过 WIFI 网络使用它。任何信息都会非常感谢。我将使用 Visual Studio 进行开发，因为它内置了 SQL SERVER。谢谢

维尔马

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T12:24:05.250

如果您在 PDA 上使用 SQLCE，则有两种技术可以提供帮助。

[SQL 合并复制](http://msdn.microsoft.com/en-us/library/ms151329.aspx)

[ADO.NET 同步服务](http://msdn.microsoft.com/en-us/sync/bb887608.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T17:40:51.383

Microsoft Sync Framework v2.0 CTP1 是相当新的（MS 的 08 年 10 月发布）您可以从[Microsoft Sync Framework 页面](http://msdn.microsoft.com/en-us/sync/default.aspx)获取有关它的更多信息以及最新版本。

> “Microsoft Sync Framework 是一个全面的同步平台，支持应用程序、服务和设备的协作和离线访问。它具有支持漫游、共享和离线数据的技术和工具。使用 Microsoft Sync Framework，开发人员可以构建集成的同步生态系统任何应用程序，来自任何商店的任何数据，在任何网络上使用任何协议。”

# oracle-apex - SELECT * breaks when adding columns in Oracle Application Express (ApEx) 3.0

> ID：487402
> 
> 赞同：1
> 
> 时间：2009-01-28T12:12:52.713
> 
> 标签：oracle-apex

When I define a report region's SQL as SELECT * FROM some_table, all is fine until new columns are added to some_table -- then it breaks with a "ORAxxx No data found" error. It is easy to remediate, as it's enough to Apply Changes on the region again, even without making any changes. However, it does not make for a robust application.

Is there some combination of parameters that would allow SELECT * that does not break with new columns? It would be enough to apply any default formatting or heading to the new columns.

I'm aware I could construct the column list from data dictionary and then concatenate everything into the SELECT statement to evaluate, but this seems rather inelegant.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T12:23:42.910

Normally is not recommended to use `SELECT *` queries because:

*   Returns all the columns, then the optimizer have less play to do.
*   It makes **less** robust the applications because adding new columns changes the result of the query giving unexpected results. Without `SELECT *`, I mean giving exactly the columns you need, adding new columns does not matter to the application.

Anyway, remember that creating a `SELECT *` for a view, oracle create the view replacing the `*` for all the columns, may be APPEX is making the same thing.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T14:38:25.353

Currently your region source is (I presume) set to "Use Query-Specific Column Names and Validate Query". This means that a report column is defined explicitly for each column in the query, and the SQL is expected to be static.

If you change the region source to "Use Generic Column Names (parse query at runtime only)", then it will still work after a new column is added, with the column title defaulting to the column name.

There is another property "Maximum number of generic report columns" that defaults to 60 and must be set to a value big enough to accommodate any future columns added to the table.

# regex - 寻找正则表达式扩展

> ID：487406
> 
> 赞同：3
> 
> 时间：2009-01-28T12:14:46.970
> 
> 标签：regex, powerbuilder

我正在寻找一个可以在我们的应用程序中使用的正则表达式库，它是用 PowerBuilder 编写的（PB 有一些 RegEx 功能，但它对我的需求来说太有限了）。要求的特征是：

*   接口：COM 或导出的函数（不能使用导出的类）
*   统一码
*   自由
*   生产就绪

有什么建议我在哪里可以找到这样的工具？

谢谢，伊兰

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-28T12:20:45.430

这个自定义（和最近的）PowerBuilder 库可能会有所帮助：[**Extension PBNI PbniRegex**](http://sebastien.kirche.free.fr/powerbuilder/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-08T07:06:29.660

您还可以使用 VBScript.RegExp OLE 对象。

```
OLEObject l_ole
l_ole = CREATE OLEObject
l_ole.ConnectToNewObject("VBScript.RegExp") 
```

现在您可以使用 RegExp 方法。有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/ms974570.aspx](http://msdn.microsoft.com/en-us/library/ms974570.aspx)

# wia - 如何从 WIA 相机获取图像？

> ID：487415
> 
> 赞同：0
> 
> 时间：2009-01-28T12:17:05.577
> 
> 标签：wia

我安装了 WIA 相机的示例驱动程序。

我不知道如何从中获取图像。

我应该怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:35:04.390

[在GraphEdit](http://en.wikipedia.org/wiki/GraphEdit)中使用 WIA Stream Snapshot 过滤器。

如果您想以编程方式执行此操作，您可以使用[WIA 接口](http://msdn.microsoft.com/en-us/library/ms630368(VS.85).aspx)。

# c++ - 使 C++ 应用程序可编写脚本

> ID：487416
> 
> 赞同：8
> 
> 时间：2009-01-28T12:17:50.693
> 
> 标签：c++, string, scripting

我的程序中有几个函数，如下所示：

```
void foo(int x, int y) 
```

现在我希望我的程序采用如下所示的字符串：

```
foo(3, 5) 
```

并执行相应的功能。实现这一点最直接的方法是什么？

当我说直截了当时，我的意思是可合理扩展和优雅，但编写代码应该不会花费太长时间。

**编辑：**

虽然使用真正的脚本语言当然可以解决我的问题，但我仍然想知道是否有一种快速的方法可以在纯 C++ 中实现它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-28T12:22:37.733

您可以相当简单地嵌入 Python，这将为您提供一种非常强大、可扩展的方式来编写程序脚本。您可以使用以下内容轻松（或多或少）将 C++ 代码公开给 Python：

*   [提升 Python](http://www.boost.org/doc/libs/release/libs/python/doc/)
*   [痛饮](http://www.swig.org/)

我个人使用 Boost Python，我对它很满意，但它编译速度很慢，而且很难调试。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-28T12:20:25.290

你可以看看[Lua](http://www.lua.org/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-28T13:14:34.617

我也会去寻找脚本语言的答案。

使用纯 C++，我可能会使用解析器生成器，它将获取标记和语法规则，并为我提供完全可以解析给定函数调用语言的 C 代码，并为我提供该调用的语法树。[`flex`](https://github.com/westes/flex)可用于标记输入，[`bison`](http://www.gnu.org/software/bison/)可用于解析标记并将其转换为语法树。作为该方法的替代方案，[Boost Spirit](http://www.boost.org/doc/libs/1_37_0/libs/spirit/classic/index.html)也可用于解析函数调用语言。我从来没有使用过这些工具中的任何一个，但是我曾在使用它们的程序上工作过，因此我有点知道如果我不得不解决这个问题我会使用什么。

对于非常简单的情况，您可以将语法更改为：

```
func_name arg1, arg2 
```

然后你可以使用：

```
std::istringstream str(line);
std::string fun_name; str >> fun_name;
map[fun_name](tokenize_args(str)); 
```

该地图将是

```
std::map<std::string, boost::function<void(std::vector<std::string>)> > map; 
```

它将在程序开始时填充函数。`tokenize_args`只会分离参数，并将它们的向量作为字符串返回。当然，这是非常原始的，但我认为如果你想要的只是某种调用函数的方法是合理的（当然，如果你想要真正的脚本支持，这种方法是不够的）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-28T12:23:17.093

正如丹尼尔所说：

像 Lua 和 Python 这样的脚本语言将是最常用的用于将 c++ 库绑定在一起的脚本语言。

您必须将脚本接口添加到您的 c++ 应用程序。这个界面的构建显然取决于您选择的脚本语言。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-23T17:42:21.037

CERN 提供[CINT](http://root.cern.ch/drupal/content/cint)，这是一种 C/C++ 解释器，可以嵌入到您的应用程序中以提供脚本功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T13:08:08.110

如果您只想通过文字名称调用函数，则可以使用链接器特定的函数。

在符合 POSIX 的操作系统（如 Linux）上，您可以使用 dlopen() 和 dlsym()。您只需解析输入字符串并找出函数名称和参数。然后您可以要求链接器使用 dlsym() 按名称查找函数。

然而，在 Windows 上，这些功能不可用（除非周围有一些 POSIX 环境，如 Cygwin）。但是您可以使用 Windows API。

您可以在此处查看有关这些内容的详细信息：[http ://en.wikipedia.org/wiki/Dynamic_loading](http://en.wikipedia.org/wiki/Dynamic_loading)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-23T16:41:59.483

Fabio Lombardelli 的 C++ Reflection [2] 通过模板元编程技术为 C++ 提供了完整的反思。虽然它完全符合 C++ 标准，但它要求程序员对类进行注释以使其具有反射性

[http://cppreflect.sourceforge.net/](http://cppreflect.sourceforge.net/)

否则你会想要一个我认为的函数指针哈希表

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T19:02:59.157

您的系统是否必须“接受字符串”？您可以在应用程序上公开 COM（或 CORBA 或其他）接口，并让生成这些命令的任何内容直接调用您的应用程序。

# javascript - 使用 jQuery Validation 插件验证不在表单内的输入

> ID：487430
> 
> 赞同：9
> 
> 时间：2009-01-28T12:22:40.510
> 
> 标签：javascript, jquery, jquery-validate

如何验证一些不在表单标签内的输入？

我发现的所有样本都有一个表单标签，但我想验证一些不在表单内的输入。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2014-10-05T15:54:27.367

[先前接受的答案（自删除后）](https://stackoverflow.com/a/487690/594235)链接到最后一次更新于 2009 年 1 月[的插件。这个过时](http://code.google.com/p/jquery-validator/)[的插件与 OP 询问的插件](http://jqueryvalidation.org)非常不同：

**标题：“****使用 jQuery 验证插件验证**不在表单内的输入”

**标签**： [jQuery-验证](/questions/tagged/jquery-validate "显示标记为“jquery-validate”的问题")

使用[jQuery Validate 插件](http://jqueryvalidation.org)，您**无法**验证包含在容器外部的输入元素`<form></form>`。 **没有解决此限制的方法。**

**DEMO 1** : 展示`form`容器的正确用法。

```
<form id="myform">
    <input type="text" name="myinput" />
    <input type="submit" />
</form> 
```

[http://jsfiddle.net/nswnomn6/](http://jsfiddle.net/nswnomn6/)

* * *

**演示 2**：显示`form`容器已更改为 a`div`并且相同的代码现在完全损坏。`form`没有容器，插件什么也不做。

```
<div id="myform">
    <input type="text" name="myinput" />
    <input type="submit" />
</div> 
```

[http://jsfiddle.net/nswnomn6/1/](http://jsfiddle.net/nswnomn6/1/)

* * *

您唯一的选择是使用不同的 jQuery 插件进行表单验证。不幸的是，我知道没有 jQuery 表单验证插件可以让您验证`<form>`容器外的输入元素。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T12:43:36.710

如果我们谈论的是[相同](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)的验证插件，我认为这是不可能的。

我认为插件的要求规定要验证的项目在表单中。

您可以随时尝试在示例页面中用 div 替换表单...

# c# - WebService 和轮询

> ID：487441
> 
> 赞同：3
> 
> 时间：2009-01-28T12:27:23.997
> 
> 标签：c#, .net, web-services, c#-2.0

我想实现一个 WebService 包含一个方法，该方法的回复将延迟不到 1 秒到大约一个小时（这取决于数据是否已经缓存或需要获取）。

基本上我的问题是，如果您只能从客户端连接到 WebService（无法通知），那么实现此功能的最佳方法是什么？

*AFAIK 这只能通过使用某种轮询来实现。但是轮询很糟糕，所以我宁愿避免使用它。另一个极端可能是只要方法没有完成就让连接保持打开状态。但我想这最终可能会减慢网络服务器和网络的速度。我考虑将这两种技术结合起来。然后客户端将调用该方法，服务器将在至少 10 秒后返回客户端需要再次轮询的消息或实际结果。*

你怎么认为？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T12:35:26.257

你可能想看看[彗星](http://en.wikipedia.org/wiki/Comet_(programming))

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T12:50:55.930

如果可能的话，我会建议一种智能轮询：

*   在第一次请求时，返回一个表示请求的令牌。这是未来请求中呈现的内容，因此很容易检查该请求是否真的完成。
*   在未来的请求中，保持连接打开一段时间（例如一分钟，可能在客户端上指定）并返回结果*或*“仍然没有结果；请在 X 处重试”的结果，其中 X 是最好*的*猜你知道什么时候会完成响应。

好处：

*   您允许客户端使用“保持连接打开”模型，该模型相对昂贵（就连接而言），但允许在准备好后立即提供响应。确保你没有在每个连接中都坚持一个线程！（并且有某种时间限制......）
*   通过说客户端应该何时回来，您可以实施退避策略 - 即使您不知道它何时准备好，您也可以对 1、2、4、8、16、30、30 进行“退避， 30、30..." 分钟政策。（您应该检查客户是否忽略了这一点。）您不会因长时间未命中而浪费大量民意调查，但您仍然可以快速获得快速结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T12:38:23.147

我认为对于可能需要一个小时来响应 Web 服务的事情来说，这并不是最好的使用机制。

为什么民意调查不好？当然，如果您调整轮询的频率，它不会那么糟糕。Prehaps 两次民意调查之间的时间，最多约五分钟。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T12:43:08.020

当我使用过的一些 Web 服务无法立即响应时，它们会返回“请在 xml 消息中重试”。我意识到这只是对轮询技术的改进，但是如果您的服务器可以在请求时确定可能的延迟是什么，它可以告诉客户端然后忘记它，让客户端轮询间隔到期后再次询问。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T12:45:14.927

IIS 和客户端存在超时，这将阻止您保持连接打开。这也不实际，因为资源/连接在服务器上被阻止。

为什么要让用户等待这么长时间运行的任务？让他们在某处查找操作的状态。

# .net - 如何用 NAnt 修改源代码？

> ID：487451
> 
> 赞同：8
> 
> 时间：2009-01-28T12:32:41.193
> 
> 标签：.net, build-automation, nant

在构建解决方案之前，我想用 NAnt 修改 .h 文件中的字符串。

.h 文件中有一个宏：#define SERVER_ADDRESS "www.customserver.net" 我想在部署软件之前修改字符串，以便通过在命令行中传递地址来为自定义地址进行每次构建。

有谁知道如何做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-28T15:38:04.453

可以使用[loadfile](http://nant.sourceforge.net/release/latest/help/tasks/loadfile.html)任务来帮助解决这个问题。此任务将给定文件加载到属性中。真正有用的是当您应用带有替换标记的[过滤器链](http://nant.sourceforge.net/release/latest/help/types/filterchain.html)[来](http://nant.sourceforge.net/release/latest/help/filters/replacetokens.html)替换文件的某些区域时。例如，如果要定义一个*类似模板的*头文件，看起来像这样：

```
#ifndef MyMacros_h
#define MyMacros_h

#define SERVER_ADDRESS "@SERVER_ADDRESS_TOKEN@"

#endif 
```

可以使用 loadfile 任务将 @SERVER_ADDRESS_TOKEN@ 替换为任何字符串，然后使用[echo](http://nant.sourceforge.net/release/latest/help/tasks/echo.html)任务将*真正的头*文件写回。

```
<loadfile file="MyMacrosTemplate.h" property="theMacrosFileContents">
    <filterchain>
        <replacetokens>
            <token key="SERVER_ADDRESS_TOKEN" value="www.customerserver.net" />
        </replacetokens>
    </filterchain>
</loadfile>
<echo file="MyMacros.h" message="${theMacrosFileContents}" /> 
```

这将生成一个 MyMacros.h 文件，其中包含 SERVER_ADDRESS 的修改字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T12:42:25.337

我认为这不是使用 NAnt 的正确方法。我不想那样修改文件内容。我不相信这是可能的。

也许您可以为每种情况使用不同的文件，并根据输入参数指定其路径。

就个人而言，我认为不应将这样的字符串硬编码到应用程序中。如果它们要更改，最好将它们外部化到启动时读取的配置或属性文件中。这样您就可以更改它们而无需更改源或重新编译。

# javascript - 在两者之间终止一个 Ajax 请求

> ID：487474
> 
> 赞同：3
> 
> 时间：2009-01-28T12:42:11.313
> 
> 标签：javascript, jquery, ajax

我正在使用 jQuery 触发 Ajax 请求。在此过程中，我向用户显示加载文本，直到它到达成功/错误处理函数。有没有办法在它中间中止请求。这样它就不会转到 success/errorHandler 变量。我能想到的一种方法是使用全局变量。有没有更好的方法。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T12:49:05.263

也许是一个开始？

> $.ajax() 返回它创建的 XMLHttpRequest。在大多数情况下，您不需要直接操作该对象，但**如果您需要手动*中止***请求，它是可用的。

[http://docs.jquery.com/Ajax/jQuery.ajax#options](http://docs.jquery.com/Ajax/jQuery.ajax#options)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T12:50:36.103

我认为您可以只调用请求对象的 abort() 方法。

根据您在此处看到的行为，它可能比这更复杂[。](http://www.quirksmode.org/blog/archives/2005/09/xmlhttp_notes_a_1.html)

# python - pyqt导入问题

> ID：487484
> 
> 赞同：2
> 
> 时间：2009-01-28T12:44:30.637
> 
> 标签：python, pyqt, dcop

我在 Python 中执行此操作时遇到了一些麻烦：

```
from PyQt4 import QtCore, QtGui
from dcopext import DCOPClient, DCOPApp 
```

我得到的回溯是

```
from dcopext import DCOPClient, DCOPApp 
File "/usr/lib/python2.5/site-packages/dcopext.py", line 35, in <module>
from dcop    import DCOPClient
RuntimeError: the qt and PyQt4.QtCore modules both wrap the QObject class 
```

我尝试切换导入，稍后在文件中导入 dcopext，但没有任何效果。感谢您的任何建议。

**编辑：**我已将其缩小到一个问题：我正在使用内部使用 qt3 的 dcopext，但我希望它使用 PyQt4。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:14:55.100

该`dcopext`模块是[PyKDE3](http://www.riverbankcomputing.co.uk/software/pykde/intro)的一部分，它是使用 Qt 3.x 的 KDE3 的 Python 绑定，而您使用的是 PyQt/Qt 4.x。

您需要升级到[PyKDE4](http://techbase.kde.org/Development/Languages/Python/Using_PyKDE_4)，它现在作为 KDE 本身的一部分发布，除非您想以 KDE 3 为目标，在这种情况下您需要相应的旧版本的 Qt 和 PyQt (3.x)。

# language-agnostic - 硬编码的字符串是否可以接受？

> ID：487485
> 
> 赞同：3
> 
> 时间：2009-01-28T12:45:05.303
> 
> 标签：language-agnostic, literals, string-literals, hard-coding

类似于[硬编码文字是否可以接受？](https://stackoverflow.com/questions/401919/is-hard-coding-literals-ever-acceptable)，但我在这里特别考虑“魔术字符串”。

在一个大型项目中，我们有一个配置选项表，如下所示：

```
Name         Value
----         -----
FOO_ENABLED  Y
BAR_ENABLED  N
... 
```

（数百个）。

通常的做法是调用通用函数来测试这样的选项：

```
if (config_options.value('FOO_ENABLED') == 'Y') ... 
```

（当然，同样的选项可能需要在系统代码中的很多地方进行检查。）

添加新选项时，我正在考虑添加一个函数来隐藏“魔术字符串”，如下所示：

```
if (config_options.foo_enabled()) ... 
```

然而，同事们认为我过分了，反对这样做，更喜欢硬编码，因为：

*   这就是我们通常所做的
*   它使调试代码时更容易看到发生了什么

麻烦的是，我能看出他们的意思！实际上，我们永远不会出于任何原因重命名选项，所以我能想到的函数的唯一优势是编译器会捕捉到任何像 fo_enabled() 这样的错字，但不会捕捉到“FO_ENABLED”。

你怎么看？我是否错过了任何其他优点/缺点？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-28T12:54:36.513

如果我在代码中使用一次字符串，我通常不会担心在某处将其设为常量。

如果我在代码中使用了两次字符串，我会*考虑*将其设为常量。

如果我在代码中使用了 3 次字符串，我几乎肯定会将其设为常量。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-28T13:19:16.420

```
if (config_options.isTrue('FOO_ENABLED')) {...
} 
```

将硬编码的 Y 检查限制在一个地方，即使这意味着为您的 Map 编写一个包装类。

```
if (config_options.isFooEnabled()) {...
} 
```

在您拥有 100 个配置选项和 100 种方法之前可能看起来还不错（因此您可以在此处对未来的应用程序增长和需求做出判断，然后再决定实施）。否则最好有一个参数名称的静态字符串类。

```
if (config_options.isTrue(ConfigKeys.FOO_ENABLED)) {...
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-28T12:52:50.980

我真的应该使用常量而不是硬编码的文字。

你可以说它们不会改变，但你可能永远不会知道。最好让它成为一种习惯。使用符号常量。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-28T13:44:21.047

以我的经验，这类问题掩盖了一个更深层次的问题：未能进行实际的 OOP 并遵循 DRY 原则。

简而言之，在启动时通过语句中每个操作的适当定义来捕获决策**，**然后`if`丢弃`config_options`运行时测试和运行时测试。

详情如下。

示例用法是：

```
if (config_options.value('FOO_ENABLED') == 'Y') ... 
```

这提出了一个明显的问题，“省略号中发生了什么？”，特别是考虑到以下陈述：

> （当然，同样的选项可能需要在系统代码中的很多地方进行检查。）

让我们假设这些`config_option`值中的每一个都确实对应于单个问题域（或实施策略）概念。

而不是这样做（重复，在整个代码的各个地方）：

1.  取一个字符串（标签），
2.  找到它对应的其他字符串（值），
3.  将该值测试为布尔等效项，
4.  根据该测试，决定是否执行某些操作。

我建议封装“可配置操作”的概念。

`FOO_ENABLED`让我们以您的代码必须以英制单位或公制单位工作为例（显然就像... ;-) 一样假设。如果`METRIC_ENABLED`为“真”，则将用户输入的数据从公制转换为英制以进行内部计算，并在显示结果之前转换回来。

定义一个接口：

```
public interface MetricConverter {
    double toInches(double length);
    double toCentimeters(double length);
    double toPounds(double weight);
    double toKilograms(double weight);
} 
```

它在一个地方标识了与 的概念相关的所有行为`METRIC_ENABLED`。

然后编写执行这些行为的所有方式的具体实现：

```
public class NullConv implements MetricConverter {
    double toInches(double length) {return length;}
    double toCentimeters(double length) {return length;}
    double toPounds(double weight)  {return weight;}
    double toKilograms(double weight)  {return weight;}
} 
```

和

```
// lame implementation, just for illustration!!!!
public class MetricConv implements MetricConverter {
    public static final double LBS_PER_KG = 2.2D;
    public static final double CM_PER_IN = 2.54D
    double toInches(double length) {return length * CM_PER_IN;}
    double toCentimeters(double length) {return length / CM_PER_IN;}
    double toPounds(double weight)  {return weight * LBS_PER_KG;}
    double toKilograms(double weight)  {return weight / LBS_PER_KG;}
} 
```

在启动时，不是加载一堆`config_options`值，而是初始化一组可配置的操作，如下所示：

```
MetricConverter converter = (metricOption()) ? new MetricConv() : new NullConv(); 
```

（上面的表达式`metricOption()`是您需要进行的任何一次性检查的替代，包括查看 METRIC_ENABLED 的值 ;-)

然后，无论代码会说什么：

```
double length = getLengthFromGui();
if (config_options.value('METRIC_ENABLED') == 'Y') {
    length = length / 2.54D;
}
// do some computation to produce result
// ...
if (config_options.value('METRIC_ENABLED') == 'Y') {
    result = result * 2.54D;
}
displayResultingLengthOnGui(result); 
```

将其重写为：

```
double length = converter.toInches(getLengthFromGui());
// do some computation to produce result
// ...
displayResultingLengthOnGui(converter.toCentimeters(result)); 
```

由于与该概念相关的所有实现细节现在都已打包干净，因此与此相关的所有未来维护`METRIC_ENABLED`都可以在一个地方完成。此外，运行时权衡是一种胜利；与从 Map 中获取 String 值并执行 String#equals 的开销相比，调用方法的“开销”微不足道。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-01-31T03:02:33.243

我意识到这个问题很老，但它出现在我的边缘。

AFAIC，无论是在问题中还是在答案中，这里的问题都没有被准确地识别出来。暂时忘记“编码字符串”。

1.  该数据库有一个参考表，其中包含`config_options`. PK 是一个字符串。

2.  PK有两种类型：

    *   有意义的标识符，用户（和开发人员）可以看到和使用。这些 PK 应该是稳定的，可以信赖。

    *   `Id`用户不应该看到的无意义的列，开发人员必须注意这些列，并编写代码。这些不能依赖。

3.  `IF CustomerCode = "IBM" ...`使用有意义的 PK等的绝对值编写代码是普通的，正常的`IF CountryCode = "AUS"`。

    *   引用无意义的 PK 的绝对值是不可接受的（由于自动增量；间隙正在改变；值被批量替换）。
        .
4.  您的参考表使用有意义的 PK。在代码中引用这些文字字符串是不可避免的。隐藏值会使维护更加困难；代码不再是字面的；你的同事是对的。此外，还有额外的冗余功能可以咀嚼循环。如果文字中有错字，您很快就会在开发测试期间发现，早在 UAT 之前。

    *   数百个文字的数百个函数是荒谬的。如果你确实实现了一个函数，那么规范化你的代码，并提供一个可以用于数百个文字中的任何一个的函数。在这种情况下，我们又回到了一个赤裸裸的字面量，函数可以省略。

    *   关键是，隐藏文字的尝试没有任何价值。
        .

5.  它不能被解释为“硬编码”，那是完全不同的东西。我认为这就是您的问题所在，将这些构造标识为“硬编码”。它只是从字面上引用一个有意义的 PK。

6.  现在仅从任何代码段的角度来看，如果您多次使用相同的值，您可以通过在变量中捕获文字字符串来改进代码，然后在代码块的其余部分中使用该变量。当然不是函数。但这是一个效率和良好实践问题。即使这样也不会改变效果`IF CountryCode = @cc_aus`

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-28T12:51:05.353

我相信您提到的两个原因，可能是字符串中的拼写错误，直到运行时才能检测到，并且名称更改的可能性（尽管很小）将证明您的想法是正确的。

最重要的是，您可以获得类型化函数，现在您似乎只存储布尔值，如果您需要存储 int、字符串等怎么办。我宁愿使用 get_foo() 和类型，而不是 get_string("FOO") 或get_int("FOO")。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-28T13:01:28.483

我认为这里有两个不同的问题：

*   在当前的项目中，使用硬编码字符串的约定已经很成熟，所以所有从事该项目的开发人员都熟悉它。由于已列出的所有原因，这可能是一个次优约定，但熟悉代码的每个人都可以查看它并且本能地知道代码应该做什么。更改代码以便在某些部分使用“新”功能将使代码稍微难以阅读（因为人们必须思考并记住新约定的作用），因此更难维护。但我猜想将整个项目更改为新约定可能会非常昂贵，除非您可以快速编写转换脚本。
*   在一个*新*项目中，符号常量是 IMO 的方式，出于列出的所有原因。*特别是*因为任何使编译器在编译时捕获错误的东西，否则会在运行时被人类捕获，这是一个非常有用的约定。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-09-11T04:18:39.477

要考虑的另一件事是意图。如果您在一个需要本地化的项目中，硬编码字符串可能会模棱两可。考虑以下：

```
const string HELLO_WORLD = "Hello world!";
print(HELLO_WORLD); 
```

程序员的意图很明确。使用常量意味着该字符串不需要本地化。现在看这个例子：

```
print("Hello world!"); 
```

在这里我们不太确定。程序员真的不希望这个字符串被本地化，还是程序员在编写这段代码时忘记了本地化？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-28T13:09:19.840

如果在整个代码中使用强类型配置类，我也更喜欢它。使用正确命名的方法，您不会失去任何可读性。如果您需要从字符串转换为另一种数据类型（十进制/浮点数/整数），则无需在多个位置重复执行转换的代码，并且可以缓存结果，因此转换只发生一次。你已经有了这方面的基础，所以我认为适应*新*的做事方式并不需要太多。

# javascript - 为什么有些对象在 IE 中没有构造函数？

> ID：487491
> 
> 赞同：1
> 
> 时间：2009-01-28T12:46:50.867
> 
> 标签：javascript, internet-explorer, dom, object, constructor

下面的 JavaScript 代码在不同的浏览器中有不同的效果：

```
document.write(this.location.constructor);
document.write("<br/>");
document.write(this.constructor);
document.write("<br/>"); 
```

在 Chrome 中，该页面具有：

```
function Location() { [native code] }
function DOMWindow() { [native code] } 
```

在 Firefox 中，该页面具有：

```
[object Location]
[object Window] 
```

在 IE8 中，页面有：

```
undefined
undefined 
```

Chrome 和 Firefox 之间的区别可能是不同的`toString()`实现。我只是不明白为什么这两个对象的构造函数在 IE中是***未定义的。***如果它们的构造函数是未定义的，那么它们的原型呢？它们也是***未定义***的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:06:33.603

使用 IE8 调试控制台，使用您提供的代码作为示例，我没有问题。

我的结果...

```
[object Location]
[object Window] 
```

您确定其他原因不会导致这些失败吗？

# ant - 常春藤：我如何删除传递依赖？

> ID：487493
> 
> 赞同：21
> 
> 时间：2009-01-28T12:48:21.003
> 
> 标签：ant, dependencies, ivy

我正在使用[Ivy](http://ant.apache.org/ivy)来管理我的项目的依赖关系。

到目前为止，我已经指定了对 Hibernate 和 servlet-api 的依赖。但是，hibernate jar 本身有很多并不是真正需要的依赖项，例如[jaas](http://en.wikipedia.org/wiki/Java_Authentication_and_Authorization_Service)和[jacc](http://java.sun.com/j2ee/javaacc/)。

这成为一个阻碍，因为 jaas 和 jaac 是 Sun 库，因此它们的许可证禁止将它们放在 Maven 存储库中，因此 Ivy 无法在那里找到它们。

*   如何让 Ivy 下载 Hibernate 而不是这两个？
*   作为奖励，如果我真的需要这些并从 Sun 下载了他们的 Jars，Ivy 会在我机器的哪个文件夹中查找它们？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-18T04:04:59.413

不下载任何依赖项的另一个选项是使用`transitive`属性禁用它们。因此，如果您想要`hibernate-core`，但没有它的依赖项，您可以这样做：

```
<dependencies>  
   <dependency org="org.hibernate" name="hibernate-core"
               rev="3.3.1.GA" conf='..'
               transitive="false" /> 
</dependencies> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-30T21:04:05.833

**如何让 Ivy 下载 Hibernate 而不是这两个？**

常春藤使用它所谓的“配置”来做到这一点。代表 Hibernate的您`ivy.xml`将需要提供不同的配置来代表不同的 hibernate 用例。（显然有一些需要 jaas 和 jacc 的 hibernate 使用，但显然你没有使用这种情况。）

[这](http://ant.apache.org/ivy/history/latest-milestone/tutorial/conf.html)是有关配置的文档。如果您想提供`ivy.xml`用于休眠的，我可以提供有关构建配置的指针，这些配置将删除您要删除的特定库。

**如果我真的需要这些并从 Sun 下载了他们的 Jars，Ivy 会在我机器的哪个文件夹中查找它们？**

ivy 查找 ivy 文件和工件的“目录”由您正在使用的解析器列表指定。解析器列表在 ivy 设置文件（通常命名为`ivysettings.xml`.）中指定。通常，这些不是本地目录，而是远程 URL。有; 但是，一种适用于此的本地文件解析器类型。

如果这样做，您将需要提供 ivy 文件和工件（jar），每个文件的文件名都与解析器模式匹配。有关详细信息，请参阅文档。

下面是一个来自 ivy 设置文件的本地文件解析器示例：

```
<filesystem name="myfiles" checkconsistency="false" checksums="" transactional="false">
   <ivy pattern="/data/repo/[organisation]/[module]-[revision].ivy.xml"/>
   <artifact pattern="/data/repo/[organisation]/[module]-[revision].[ext]"/>
</filesystem> 
```

另请注意，您需要将您的 ivy 任务指向正确的解析器。您可以使用 ant 任务的 resolver 属性或ivy 设置文件`defaultResolver`中元素的属性来执行此操作。`settings`

[这](http://ant.apache.org/ivy/history/2.5.0-rc1/settings/resolvers.html)是有关解析器的文档。

**编辑：** OP 为他的特定原始问题找到了一种耗时较少的解决方法。依赖标签的“排除”子标签为他完成了这项工作：

```
<dependencies>  
   <dependency org="org.hibernate" name="hibernate-core" rev="3.3.1.GA" conf='..'> 
       <exclude name='jaas' /> 
       <exclude name='jacc' />
   </dependency>
</dependencies> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-29T02:42:01.613

浏览网页和博客，我发现以下常春藤设置可用于抓取 jaas/jacc 和休眠

```
<ivysettings>

<settings defaultResolver="chained" checkUpToDate="true" />

<resolvers>
    <chain name="chained">
        <url name="com.springsource.repository.bundles.release">
            <ivy pattern="http://repository.springsource.com/ivy/bundles/release/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]" />
            <artifact pattern="http://repository.springsource.com/ivy/bundles/release/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]" />
        </url>

        <url name="com.springsource.repository.bundles.external">
            <ivy pattern="http://repository.springsource.com/ivy/bundles/external/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]" />
            <artifact pattern="http://repository.springsource.com/ivy/bundles/external/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]" />
        </url>

        <ibiblio name="ibiblio" m2compatible="true"/>

        <ibiblio name="jboss" root="http://repository.jboss.org/maven2/" m2compatible="true"/>

        <ibiblio name="java-net-maven1" root="http://download.java.net/maven/1" pattern="${java.net.maven.pattern}" m2compatible="false"/>

        <ibiblio name="java-net-maven2" root="http://download.java.net/maven/2/" m2compatible="true"/>

        <ibiblio name="compass" m2compatible="true" root="http://repo.compass-project.org" />

    </chain>

</resolvers> 
```

jboss ibibilio 解析器是获取 JAAS/JAAC 的诀窍

然后我的 ivy.xml 可以将其拉入

```
<ivy-module version="2.0">

<info organisation="foo" module="Bar"/>
<dependencies>

    <dependency org="com.h2database" name="h2" rev="1.2+"/>

    <dependency org="org.hibernate" name="hibernate-annotations" rev="3.4.0.GA"/>     

</dependencies> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-08T17:00:54.953

**从字面上**回答你的第二个子问题，到目前为止没有人做过，“Ivy 会在我机器的哪个文件夹中查找 JAR？” 那要看。假设您没有更改 ivysettings.xml 或其他配置文件中的位置：对于 JAAS，这将是：( *user home* )/.ivy2/cache/javax.security/jaas/jars。如果 Ivy 已经尝试在 Maven Central 或其他 repo 中查找 JAAS 失败，则该目录树大部分应该已经存在，您需要做的就是创建“jars”目录并将[jaas-1.0.01.jar](http://maven.glassfish.org/content/groups/glassfish/javax/security/jaas/1.0.01/jaas-1.0.01.jar)放入它。Ivy 将不再抱怨在下一次调用中缺少依赖项。

**编辑：**再一次，请参阅下面的讨论以了解不这样做的注意事项。

（（*用户主页*）在 Windows 7 上是 C:/Users/（*用户名））。*

# c# - 如何格式化 DataGridView 在虚拟模式下使用的工具提示？

> ID：487499
> 
> 赞同：0
> 
> 时间：2009-01-28T12:49:31.190
> 
> 标签：c#, .net, datagridview, tooltip

我需要将格式（特别是粗体文本）应用于 DataGridView 在虚拟模式下使用的工具提示。我可以在 CellToolTipTextNeeded 事件中设置文本，但它不支持 HTML 标签；我应该使用其他语法吗？我不想自己重新实现工具提示支持。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-10T15:44:34.780

[您可以使用来自http://www.codeproject.com/KB/GDI-plus/HtmlRenderer.aspx](http://www.codeproject.com/KB/GDI-plus/HtmlRenderer.aspx)的 HtmlToolTip

```
To use it with DataGridView create a ToolTip (HtmlToolTip) and add this after the InitalizeComponent() in your form to replace the default tooltip:

System.Reflection.FieldInfo toolTipControlFieldInfo=
typeof(DataGridView).GetField("toolTipControl", System.Reflection.BindingFlags.Instance | System.Reflection.BindingFlags.NonPublic);

System.Reflection.FieldInfo toolTipFieldInfo=
toolTipControlFieldInfo.FieldType.GetField("toolTip", System.Reflection.BindingFlags.Instance | System.Reflection.BindingFlags.NonPublic);

object toolTipControlInstance =
toolTipControlFieldInfo.GetValue(myDataGridView);

toolTipFieldInfo.SetValue(toolTipControlInstance, myToolTip); 
```

使用 .net 3.5 为我工作

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T16:41:32.937

正如事件的名称所暗示的那样，它只是希望显示文本，而不会有格式。

如果您想要粗体或其他类型的格式，您将不得不自己处理工具提示的显示和绘制。您可以使用 ToolTip 控件来提供帮助，将 OwnerDraw 属性设置为 true 并处理 Draw 事件，但请注意，您很可能必须以一种重要的方式覆盖网格才能在适当的时间进入该事件。

# c# - 缓冲折线以创建多边形的有效算法？

> ID：487504
> 
> 赞同：2
> 
> 时间：2009-01-28T12:51:03.340
> 
> 标签：c#, geometry, geospatial, virtual-earth

我需要编写一些代码来缓冲一条线以创建多边形，如下所示。

[http://www.sli.unimelb.edu.au/gisweb/BuffersModule/Buff_line.htm](http://www.sli.unimelb.edu.au/gisweb/BuffersModule/Buff_line.htm)

按照概述的步骤，我可以围绕不交叉或曲线太紧的简单线条创建多边形形状，但由于我试图缓冲的线条是波浪状旋涡状的飓风轨迹，这真的不够好。

我知道 SQL Server 2008 中有一个函数可以做到这一点，但恐怕目前还不行。

谁能指出我可以遵循的更完整算法的方向，或者任何可以帮助我解决这个问题的背景信息？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T23:55:36.167

尽管这在 GIS 中称为*缓冲*，但从事算法工作的数学家显然将其称为[Minkowski 和](http://en.wikipedia.org/wiki/Minkowski_addition)。谷歌搜索发现了算法专家 Steven Skiena 的[这个页面，该页面链接到几个算法实现和一些书籍。](http://www.cs.sunysb.edu/~algorith/files/minkowski-sum.shtml)希望这可以帮助！

它现在（3 月 9 日）链接到的算法实现之一是[CGAL](http://www.cgal.org/)，一个开源 C 库。

# seo - robots.txt：除了少数几个，禁止所有，为什么不呢？

> ID：487508
> 
> 赞同：5
> 
> 时间：2009-01-28T12:51:55.850
> 
> 标签：seo, web-crawler, robots.txt

我一直在考虑禁止除 Ask、Google、Microsoft 和 Yahoo! 之外的所有爬虫。从我的网站。

这背后的原因是我从未见过任何其他网络爬虫产生任何流量。

我的问题是：

1.  有什么理由不这样做吗？
2.  有人做过吗？
3.  你注意到任何负面影响了吗？

**更新：**
到目前为止，我使用黑名单方法：如果我不喜欢爬虫，我将它们添加到禁止列表中。
我不喜欢列入黑名单，因为这是一个永无止境的故事：那里总是有更多的爬虫。

我不太担心真正丑陋的行为不端的爬虫，它们会被自动检测并阻止。（无论如何，他们通常不要求 robots.txt :)

然而，许多爬虫实际上并没有以任何方式行为不端，它们似乎并没有为我/我的客户创造任何价值。
例如，有几个爬虫为网站提供动力，声称他们将成为下一个谷歌；只有更好。我从未见过来自他们的任何流量，而且我对他们变得比上述四个搜索引擎中的任何一个都好持怀疑态度。

**更新 2：**
一段时间以来，我一直在分析几个站点的流量，似乎对于合理的小型站点，每天有 100 个唯一的人类访问者（=我无法识别为非人类的访问者）。大约 52% 的生成流量来自自动化流程。

60% 的自动访问者没有阅读 robots.txt，40%（占总流量的 21%）确实请求 robots.txt。（这包括 Ask、Google、Microsoft 和 Yahoo!）

所以我的想法是，如果我阻止所有似乎对我没有任何价值的表现良好的爬虫，我可以将带宽使用和服务器负载减少大约 12% - 17%。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T12:20:06.367

互联网是一种*发布*机制。如果你想将你的网站列入白名单，那你就反对，但这没关系。

*您*想将您的网站列入白名单吗？

请记住，忽略 robots.txt 的行为不端的机器人无论如何都不会受到影响（显然），而行为良好的机器人可能是有充分理由的，只是这对你来说是不透明的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T12:57:16.260

虽然抓取您网站的其他网站可能不会以您的方式发送任何内容，但它们本身可能被 google 等编入索引，因此增加您的网页排名，阻止它们进入您的网站可能会影响这一点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T13:06:48.270

> 有什么理由不这样做吗？

您是否希望被排除在可能包括您不了解的网站并且间接为您带来大量内容的事情之外。

如果一些奇怪的爬虫正在攻击您的网站并占用您的带宽，您可能想要这样做，但这些爬虫很可能也不会尊重您的 robots.txt。

检查您的日志文件并查看您拥有哪些爬虫以及它们占用的带宽比例。可能有更直接的方法来阻止正在轰炸您网站的流量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-26T13:16:11.020

这目前有点尴尬，因为没有“允许”字段。简单的方法是将所有不允许的文件放到一个单独的目录中，比如“stuff”，然后将一个文件留在该目录的上一级。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-24T18:23:10.297

我唯一担心的是你可能会错过下一件大事。

很长一段时间，AltaVista 都是*搜索*引擎。可能比现在的谷歌还要多。（没有 bing 或 Ask，Yahoo 是一个目录，而不是一个搜索引擎）。当时除了 Altavista 之外所有网站都被屏蔽的网站永远不会看到来自 Google 的流量，因此永远不会知道它的受欢迎程度，除非他们从另一个来源听说过，这可能会使他们在一段时间内处于相当不利的地位。

Pagerank 往往偏向于较旧的网站。您不希望显得比实际更新，因为您无缘无故地阻止了通过 robots.txt 的访问。这些家伙：[http](http://www.dotnetdotcom.org/) ://www.dotnetdotcom.org/现在可能完全没用，但也许在 5 年后，你现在不在他们的索引中的事实将在下一个大型搜索引擎中对你不利。

# javascript - 将变量传递给javascript中的正则表达式

> ID：487509
> 
> 赞同：44
> 
> 时间：2009-01-28T12:52:16.050
> 
> 标签：javascript, regex

> **可能重复：**
> [用于 Javascript 正则表达式的转义字符串](https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex)

我有这样的味精：

> **{1} 中最多允许使用 {0} 个字符**

我有一个函数可以使用传递的参数创建一条消息

```
for(var i = 0; i < agrs.length; i++){
    reg = new RegExp('\{'+i+'\}', 'gi');
    key = key.replace(reg,agrs[i])
} 
```

问题是它无法使用参数`i`来创建 reg exp。

实现这一目标的方法是什么？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-01-28T13:12:45.293

您的正则表达式是`/{0}/gi`因为您从字符串创建它。它不是一个有效的表达式。您需要在正则表达式中转义 { 因为它在正则表达式语法中具有特殊含义，所以它应该是：

```
new RegExp('\\{'+i+'\\}', 'gi'); 
```

这是`/\\{0\\}/gi`。您需要*转义*`\\`字符串中的转义。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-28T15:48:14.777

我强烈建议您使用[String.replace()](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/String/Replace)的函数形式来解决您的问题，而不是尝试在迭代 {0}、{1} 等的 for 循环中对正则表达式进行参数化。

换句话说，不是寻找'{0}'或'{1}'，而是寻找'{([0-9]+)}'（即{}'包围任意数字，并传递一个函数到 replace() 函数，根据 {} 之间的数字智能替换这些表达式。这使您可以使用 RegExp 文字，您可以将其写为 /{([0-9]+)}/ 而不是乱七八糟在字符串中带有转义字符。

像这样的东西：

```
s='the song says {0} little {1} little {2} little-endians';
args=['zero','one','two'];
new_string = s.replace(/{([0-9]+)}/g, function(wholematch,firstmatch)
  {return args[(+firstmatch)]; }
); 
```

产生

```
the song says zero little one little two little-endians 
```

看到这个[类似的问题](https://stackoverflow.com/questions/423107)。

编辑：如果您想留下大于`args`列表长度的项目，请确保检查参数编号：

```
s='the song says {0} little {1} little {2} little-endians,\n'+
  ' {3} little {4} little {5} little-endians';
args=['zero','one','two'];
new_string = s.replace(/{([0-9]+)}/g, function(wholematch,firstmatch)
  {var i = +firstmatch; return i < args.length ? args[i] : wholematch;}
); 
```

产生

```
the song says zero little one little two little-endians,
 {3} little {4} little {5} little-endians 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T12:54:34.533

我认为你的第二行应该是

```
reg = new RegExp('\{'+i+'\}', 'gi'); 
```

但我不知道这是否是你唯一的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-02T17:09:20.137

```
function escapeRegExp(str) {
  return str.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
}

var re = new RegExp(escapeRegExp(str)); 
```

请参阅：[用于 Javascript 正则表达式的转义字符串](https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex/6969486#6969486)

# javascript - 如何让 Google Adsense 在页面的其余部分最后加载

> ID：487511
> 
> 赞同：6
> 
> 时间：2009-01-28T12:52:37.347
> 
> 标签：javascript, adsense

我有一个包含 Google Adsense 广告的页面。内容在左边，广告在右边。下载页面时，它首先检索内容，然后从 Google Adsense 广告开始。在此期间，在整个广告完全下载之前，不会获取页面的其余部分（页脚图像）。

如何让我的所有页面（内容、图像）先加载，广告最后加载？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T13:39:40.980

您必须将广告代码放在 html（php、asp 等）页面的底部，以便浏览器最后请求该数据。浏览器从文档顶部读取到文档末尾并一路请求。我不认为有任何解决办法。

您仍然可以使用 CSS 将广告放置在页面顶部附近。一个绝对的位置，或者一些疯狂的花车可能能够做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-21T12:05:49.607

现在没有必要这样做。AdSense 宣布广告请求将不再阻止页面内容：http: [//adsense.blogspot.com/2011/03/making-web-faster-for-all-adsense-for.html](http://adsense.blogspot.com/2011/03/making-web-faster-for-all-adsense-for.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T13:58:33.343

我认为最简单的方法是使用 body onload 来启动一个 javascript 计时器，然后说 5 秒后将填充 div 占位符的 html。

如果您想等待所有内容加载，则需要跟踪数组中的每个图像等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-31T14:47:14.273

另一个答案中的lnk：

[http://semplicewebsites.com/google-ads](http://semplicewebsites.com/google-ads)

...绝对是要走的路。我在使用 jQuery 时遇到了一些问题，但这就是我使用的。经过一些 CSS 调整后，我基本上只是移动 iframe。

假设您将页面底部的广告加载到名为 ads_footer 的（*隐藏*）div 中，并且您希望它们进入名为 ads_inline 的 div 中（*如链接中的示例所示*）。你可以这样做：

```
$(document.ready(
  function() {
    $('#ads_footer iframe').css('position', '')
    $('#ads_inline').append($('#ads_footer iframe'))
  }) 
```

除了删除绝对定位之外，不需要任何浮动或花哨的 CSS。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-10T09:02:24.207

是的，这是要走的路。我在这里更详细地讨论了它，并举例：

[http://semplicewebsites.com/google-ads](http://semplicewebsites.com/google-ads)

# sql - SQL UNION 和 ORDER BY

> ID：487515
> 
> 赞同：0
> 
> 时间：2009-01-28T12:53:31.963
> 
> 标签：sql, sorting, select, union

我有一个烦人的 SQL 语句，看起来很简单，但看起来很糟糕。我希望 sql 返回一个用户数据排序的结果集，以便某个用户是结果集中的第一行，如果该用户的电子邮件地址在公司表中。

我有这个返回我想要的 SQL，但我认为它看起来很糟糕：

```
select 1 as o, * 
from Users u
where companyid = 1
and email = (select email from companies where id=1)
union 
select 2 as o, * 
from Users u
where companyid = 1
and email <> (select email from companies where id=1)
order by o 
```

顺便说一句，用户表中的电子邮件地址可以在许多公司中，因此不能在电子邮件地址上加入:-(

你有什么想法可以改进这个陈述吗？

我正在使用 Microsoft SQL Server 2000。

编辑：我使用这个：

```
select *, case when u.email=(select email from companies where Id=1) then 1 else 2 end AS SortMeFirst 
from Users u 
where u.companyId=1 
order by SortMeFirst 
```

它比我的更优雅。谢谢理查德 L！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T13:02:13.300

你可以做这样的事情..

```
 select CASE 
                WHEN exists (select email from companies c where c.Id = u.ID and c.Email = u.Email) THEN 1 
                ELSE 2 END as SortMeFirst,   * 
    From Users u 
    where companyId = 1 
    order by SortMeFirst 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-28T12:57:48.787

这会工作吗？：

```
select c.email, * 
from Users u
     LEFT JOIN companies c on u.email = c.email
where companyid = 1
order by c.email desc
-- order by case when c.email is null then 0 else 1 end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T12:57:52.420

我不确定这会更好，但这是一种替代方法

```
select *, (select count(*) from companies where email = u.email) as o 
from users u 
order by o desc 
```

编辑：如果不同公司之间可以有许多匹配的电子邮件，并且您只对给定的公司感兴趣，那么这就变成了

```
select *, 
 (select count(*) from companies c where c.email = u.email and c.id = 1) as o 
from users u 
where companyid = 1
order by o desc 
```

# html - 有序列表 , XHTML Strict 的起始索引？

> ID：487528
> 
> 赞同：4
> 
> 时间：2009-01-28T12:57:43.763
> 
> 标签：html, xhtml-1.0-strict, html-lists

有没有办法在遵循 XHTML Strict 时从特定索引开始有序列表？使用 start=n 效果很好，但已被[弃用](http://www.w3schools.com/tags/tag_ol.asp)……预期目的是通过分页恢复索引。

我看到了一些对 CSS 解决方案的引用，但不能像在不推荐使用的 start 情况下的属性那样使用起始索引。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-28T14:00:55.320

正如[kdgregory](https://stackoverflow.com/questions/487528/ordered-lists-ol-starting-index-with-xhtml-strict#487569)所指出的，计数器将是完成此操作并仍保持有效文档的方法。[Array Studio 上的这篇文章](http://www.arraystudio.com/as-workshop/make-ol-list-start-from-number-different-than-1-using-css.html)展示了如何用 XHTML 和 CSS 编写代码。以下是从他们的文章中复制的：

> 您需要在 CSS 中编写以下内容：
> 
> ```
> OL#page_one { counter-reset: item }
> OL#page_two { counter-reset: item 5 }
> LI { display: block }
> LI:before {
>     content: counter(item) ". ";
>     counter-increment: item;
>     display:block;
> } 
> ```
> 
> 而且，这就是您的列表应该如何定义：
> 
> ```
> <ol id="page_one">
>     <li>Division Bell</li>
>     <li>Atom Hearth Mother</li>
>     <li>Relics</li>
>     <li>Dark Side of the Moon</li>
>     <li>Wish You Were Here</li>
> </ol>
> 
> <ol id="page_two">
>     <li>The Wall</li>
>     <li>More</li>
>     <li>Piper at the gates of Dawn</li>
>     <li>Final Cut</li>
>     <li>Meddle</li>
> </ol> 
> ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T13:14:55.647

CSS 解决方案是使用列表计数器：[http ://www.w3.org/TR/CSS2/generate.html#counters](http://www.w3.org/TR/CSS2/generate.html#counters)

看来，为了支持分页，您可以简单地将硬编码的 <style> 元素放入 <head> 中，或者在元素上显式设置样式（也没有尝试过，所以 ymmv）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T13:17:47.840

您绝对可以使用计数器，但也许更实用的解决方案是使用 XHTML 过渡文档类型。我知道这并不能回答您的问题，但这是您最终可以在墙壁和天花板上进行编码以做一些对您没有太大帮助的情况之一。

# .net - 如何处理数据访问层（.net）中的连接

> ID：487545
> 
> 赞同：2
> 
> 时间：2009-01-28T13:03:43.300
> 
> 标签：.net, data-access-layer

我正在编写一个数据访问层。我对管理系统中的连接感到困惑。我知道.net 使用连接池。但我不想在所有 dml 操作或所有 sql 查询中打开和关闭数据库连接。我该如何处理？应该在何时何地（可能在使用数据访问层或数据访问层的全局 asax 中）管理连接？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-28T13:10:35.953

您应该为每个查询打开和关闭 sql 连接，除非您正在运行一批语句。

“迟开早关”是您应该始终处理数据库连接的方式。

如果您以传统方式（进行自己的查询）进行处理，MS 已经编写了一个不错的数据访问接口。用于数据的[企业库](http://msdn.microsoft.com/en-us/library/cc512464.aspx)（应用程序块）具有所有格式良好的花里胡哨。

如果您不想费心编写查询，我建议您查看[linq2Sql](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)或[linq2EF](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)（首选）。它们将大大简化您的编码。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-28T13:08:00.280

为什么不想为每个离散逻辑操作打开/关闭连接？大多数现有的 DAL 都以这种方式运行。通常，尝试超越运行时自动为您做的事情并不是一个好主意，例如智能地管理您的连接。在投入时间和精力将这种复杂性添加到您的应用程序之前，您应该有一个强大的、可证明的技术需求。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T14:47:10.883

必须作为事务发生的操作呢？

是您的 BL 负责操作和逻辑/验证吗？

假设你有一个 BL 层

1.  更新您的客户帐户信息。（DAL -> 更新客户记录）
2.  插入地址记录。（DAL -> 插入地址）
3.  根据第三个对象验证您的客户。（DAL -> 获取客户端、地址和验证对象）

结果：客户无效。所以你必须回滚你的交易。

如何解决这个问题？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-16T17:59:37.943

我不清楚回答老问题的礼仪，我不知道如何评论另一个答案（我对 SO 是全新的，我今天还没有喝完第一杯咖啡，所以让我放松一下=]）。

我总是编写我的 DAL 来打开/关闭每个查询的连接，并让驱动程序的连接池完成连接管理工作。

但是，我有一个使用共享 MS Access DB 的多用户桌面应用程序（创建此应用程序时，SQL Express 并没有以真正可用的形式出现），并且我偶尔会看到指示损坏的错误。 [这篇 MS 文章](http://support.microsoft.com/?kbid=274211)建议对整个应用程序仅使用一个连接：

“不建议重复打开和关闭 Microsoft Access 数据库。在应用程序开始时打开数据库一次，然后在应用程序结束时关闭数据库。”

我的应用程序是多线程的，所以我假设我必须修改建议以“每个线程打开一个连接”以避免冲突。有没有人有使用共享 Access 数据库与 OLEDB 和类似损坏问题的经验？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T13:15:20.357

连接管理不应由 DAL 管理。

唯一可以负责/可以决定是否应该打开新连接或关闭连接的层是使用​​ DAL 的服务层或应用程序层。该层是唯一了解上下文的层，因此您可以在该层决定是否应该关闭连接，或者将其保持打开状态，因为其他数据库通信应该使用相同的连接。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T13:18:17.060

您确实应该为每个操作打开/关闭。不要将连接使用视为高成本操作，因为它根本不是。当您在站点上打开连接时，它们将在连接池中创建。当您“关闭”连接时，连接池不会释放连接：它保持在手边，准备重用。因此，虽然导致新连接的第一次调用需要更长的时间，但后续连接非常快。

更新：在 Web 应用程序中尤其如此！不要尝试在全局对象中只打开一次连接*并*在所有线程中重复使用它，否则您的站点将无法正常工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T13:30:19.283

在 .Net 中编写了几个数据层（之前在 VB6 中编写了更多数据层）后，我的建议是：

1.  尽可能使用数据集而不是阅读器。
2.  建立和断开连接（无论如何，您*都不能*在任何一个连接上打开 >1 个阅读器）。
3.  在后端使用参数化的 sps 进行工作。3.5 确保所有表都有唯一的单字段主键！

有点OT？...

4.  使用代码生成（您的或购买的）来生成 ORM 类 - 但请注意，它们不是全部和全部（一次一张表的东西很方便 - 但可以让您编写丑陋的低效代码，其中一个查询在后端使用连接或狡猾的 SP 或视图会更好地完成工作）。
5.  阅读 Connection 对象的 Transaction 方法 - 非常非常方便（尽管一些需要事务的纯数据库事物（例如，存在关系的删除）应该是后端的事务。

我自己最新的基本 DAL（无 ORM）花了我半个小时来编写，并且非常紧凑且非常高效。MS 企业的东西是巨大的！

最后一件事——我个人认为从 xsds 生成的强类型数据集对增益率有很高的烦恼（和膨胀）——以及它们让你处理 NULL sux 的方式很重要。您为使用它们而编写的所有代码也很臃肿......或者您最终将它们向下转换为 DataSet 以实际获得一个高效、非重复代码库。

# windows - windows上的文件偏移量

> ID：487549
> 
> 赞同：0
> 
> 时间：2009-01-28T13:04:47.727
> 
> 标签：windows, ms-access, scripting, file, offset

有没有一种简单的方法，最好是使用脚本语言或可以通过批处理文件调用的小工具，对文本文件进行操作，标记偏移量，并将偏移量之后的所有内容放入新文件中？

我有一个文本文件添加到 nightly，我想让它标记文件的结尾，然后在添加新数据后，只处理偏移量和结尾之间的数据。我不能只用字符串或分隔符来做到这一点，因为它是 blob 数据。

编辑：文本文件是通过从计划任务中运行 ms 访问宏来创建的，该宏将数据导出为 csv 文件。在考虑帕特里克的建议时，我想知道是否可以在文件名中添加通配符，例如日期，以始终拥有不同的文件。然后这个文件将被 scp'd 到一个 linux 服务器，在那里它将被加载到一个 mysql 数据库中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T13:19:22.237

用python很简单：

```
import sys

def divide_file(fname, mark):
    mark_found = 0
    f = file(fname, 'r')
    for line in f.readlines():
        if mark in line:
            mark_found = 1
        if mark_found:
            print line.rstrip()
    f.close()

divide_file(sys.argv[1], sys.argv[2]) 
```

用法和输出示例：

```
c:\tmp>divide_file.py divide_file.py close
        f.close()

divide_file(sys.argv[1], sys.argv[2]) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T13:34:19.820

我可以从类 Unix 系统中想到*tail*、*bash和其他实用程序。*[您可以通过最低限度地安装MSYS](http://www.mingw.org/wiki/msys)在 Windows 上获得这些。引用这些实用程序的文档和示例很容易找到。而且*bash*的东西比 Windows 批处理文件要强大得多。脚本看起来像这样：

```
#!/bin/bash

PREV_SIZE=`du -b text_file`
write_something_to_file text_file
CURR_SIZE=`du -b text_file`
let NUM=$PREV_SIZE-$CURR_SIZE
tail -c $NUM > new_text_file 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T16:05:26.350

假设您当前已经使用脚本从 Access 数据库中导出数据：

```
@echo OFF

:: Force a new line and add a marker; assuming your file is data.txt.
@echo. >> data.txt
@echo **MARKER** >> data.txt

:: Run your export here: these lines just simulate the export.
@echo Test Line 1 >> data.txt
@echo Test Line 2 >> data.txt

:: Find line number of last marker:
for /f "usebackq delims=:" %%I in (`findstr /N "**MARKER**" data.txt`) do (
    set LAST_MARKER=%%I
)

:: Get all the lines after the last marker
for /f "skip=%LAST_MARKER% tokens=*" %%L in (data.txt) do (
    @echo %%L >> new_data.txt
) 
```

中的输出`new_data.txt`将是：

> 测试线 1
> 测试线 2

# python - 通过 Pyro 传输对象

> ID：487553
> 
> 赞同：4
> 
> 时间：2009-01-28T13:07:31.963
> 
> 标签：python, distributed

我在一个项目中使用 Pyro，似乎无法理解如何通过网络传输完整的对象。该对象**不是**分布式的（我的分布式对象工作得很好），但应该作为一个已经可用的分布式对象的参数。

我的对象是从包含一些方法和一些变量的自定义类派生的——一个整数和一个列表。该类可用于服务器和客户端。当使用我的对象作为分布式对象的方法的参数时，整数变量被正确“接收”，但列表为空，即使我可以看到它包含在“发送”之前的值。

为什么是这样？

课程的简短版本：

```
class Collection(Pyro.core.ObjBase):
    num = 0
    operations = [("Operation:", "Value:", "Description", "Timestamp")]

def __init__(self):
    Pyro.core.ObjBase.__init__(self)

def add(self, val, desc):
    entry = ("Add", val, desc, strftime("%Y-%m-%d %H:%M:%S"))
    self.operations.append(entry)
    self.num = self.num + 1

def printop(self):
    print "This collection will execute the following operations:"
    for item in self.operations:
        print item 
```

分布式对象中的接收方法：

```
def apply(self, collection):
    print "Todo: Apply collection"
    #op = collection.getop()
    print "Number of collected operations:", collection.a
    collection.printop() 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T14:04:50.243

操作是类属性，而不是对象属性。这就是为什么它没有被转移。尝试`__init__`通过设置它`self.operations = <whatever>`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T14:10:33.087

您的接收方法**apply**与内置 Python 函数同名。

# c++ - 为什么这个指针-指针初始化 Seg 错误？

> ID：487566
> 
> 赞同：-1
> 
> 时间：2009-01-28T13:12:53.000
> 
> 标签：c++, dynamic-data, segmentation-fault

我创建了一个类对象的指针，当我尝试使用指针创建一个新对象时，它会出现段错误。为什么会这样？

```
struct Level
{   
        int SoldierCount;
        Soldier **soldier;
        int taskCount;
        int *taskPercentage;
        int *taskBitmapX;
        int *taskBitmapY;
}level;

void createMap()
{
    //Input and Declartion of various variabls goes here

    level.soldier = new Soldier* [level.SoldierCount];

    //Seg Faults Here
        level.Soldier[i] = new Soldier(initX, initY, initDirection, steps);     

} 
```

士兵类构造函数：

```
Soldier(int, int, int, int); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:21:56.787

我在您的代码中找不到任何与段错误相关的问题。

但是我对为什么您的区分大小写不匹配感到困惑：
该课程称为“**士兵**”，而士兵**称为“**士兵**”。

但是你写：

```
level.soldier = new soldier* [level.SoldierCount]; 
```

和：

```
level.Soldier[i] = new Soldier(initX, initY, initDirection, steps); 
```

如果代码真的像你写的那样编译，这可能就是问题所在。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T13:23:24.007

使用空`Soldier`构造函数，您的代码可以正常工作（除了更正的拼写错误，例如小写`level.soldier[]`）

请发布构造函数正文。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T13:26:22.333

可能`i >= level.SoldierCount`吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T13:25:14.050

的价值是`level.SoldierCount`多少？什么是价值`i`

发生段错误的唯一方法是访问未分配的内存。在您突出显示的行中，唯一可能发生的位置是在数组中（或在构造函数中，您没有为其发布代码）。最有可能的是，您正在越界访问数组。

# sharepoint - 使用 STSADM 导出和导入网站集

> ID：487571
> 
> 赞同：1
> 
> 时间：2009-01-28T13:15:03.993
> 
> 标签：sharepoint, import, export, stsadm

尝试使用 stsadm 导入现有导出时遇到问题。

成功导出网站集后，我创建了一个新的空白网站。当我运行导入命令时，它会运行一段时间，然后完成并出现以下错误：

2009 年 1 月 28 日 13:04:28.84 STSADM.EXE (0x3F54) 0x1D74 Windows SharePoint Services 常规 72ju 高 **stsadm：找到重复的名称“团队”。**调用堆栈：在 Microsoft.SharePoint.SPFieldCollection.AddFieldAsXmlInternal(String schemaXml, Boolean addToDefaultView, SPAddFieldOptions op) 在 Microsoft.SharePoint.SPFieldCollection.AddFieldToWeb(String strXml, Boolean checkDisplayName) 在 Microsoft.SharePoint.Deployment.FieldTemplateSerializer.CreateField(SPWeb web, SerializationInfoHelper infoHelper) 在 Microsoft.SharePoint.Deployment.XmlFormatter.ParseObject(Type objectType, Boolean isChildObject) 在 Microsoft.SharePoint.Deployment.SetObjectData(Object obj, SerializationInfo info, StreamingContext context, ISurrogateSelector 选择器) 在 Microsoft.SharePoint.Deployment.XmlFormatter .DeserializeObject(Type objectType, Boolean isChildObject, Deployme...
2009 年 1 月 28 日 13:04:28.84* STSADM.EXE (0x3F54) 0x1D74 Windows SharePoint Services 一般 72ju 高 ...ntObject 信封）在 Microsoft.SharePoint.Deployment.XmlFormatter.Deserialize(Stream serializationStream) 在 Microsoft.SharePoint.Deployment .ObjectSerializer.Deserialize(Stream serializationStream) 在 Microsoft.SharePoint.Deployment.ImportObjectManager.ProcessObject(XmlReader xmlReader) 在 Microsoft.SharePoint.Deployment.SPImport.DeserializeObjects() 在 Microsoft.SharePoint.Deployment.SPImport.Run() 在 Microsoft.SharePoint .StsAdmin.SPImportOperation.Run(StringDictionary keyValues) at Microsoft.SharePoint.StsAdmin.SPStsAdmin.RunOperation(SPGlobalAdmin globalAdmin, String strOperation, StringDictionary keyValues, SPParamCollection pars)

然后当我运行该站点时，它似乎只完成了一半的工作并在错误处停止。

谁能指出我可能导致此错误的正确方向？

非常感谢

基兰

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T17:32:45.627

您是否安装了[12 月累积更新](http://blogs.msdn.com/sharepoint/archive/2008/12/17/announcing-december-cumulative-update-for-office-sharepoint-server-2007-and-windows-sharepoint-services-3-0.aspx)？微软最近修复了内容迁移框架中的一些错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T20:25:50.737

堆栈跟踪告诉我们很多关于正在发生的事情。最重要的一行是 Microsoft.SharePoint.SPFieldCollection.AddFieldToWeb 这意味着当将字段而不是列表添加到 SPWeb 时会发生错误。如果您使用现有名称添加到 SPFieldCollection，则会出错。

如果您很好奇，您可以使用[SharePointManager](http://www.codeplex.com/spm)来了解正在进入的网站。

发生这种情况的原因是您正在恢复到子站点，而主站点仍然具有那里的所有字段。

您最好的选择是确保您拥有最新的补丁等（[请参阅 Lars 建议](https://stackoverflow.com/questions/487571/using-stsadm-to-export-and-import-site-collection#488566)）。

[Walm3864 的帖子](https://stackoverflow.com/questions/487571/using-stsadm-to-export-and-import-site-collection#487903)是正确的，因为新的网站集不会有同样的问题。一个新的网站集通常是一个严肃的决定，必须根据您当前的信息架构来判断。

这不会影响搜索，因为可以使用托管路径（例如[http://intranet/sites/](http://intranet/sites/) *mynewsiteyay*）将新网站集添加到现有 url

它将影响您的备份策略，因为您需要将新数据库添加到该进程。

为一些较大的子站点添加新的站点集可能是有益的，因为如果所有数据库都低于 100GB，它将缩短备份时间。尽早拆分潜在的大型站点很重要，因为事后很难做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-19T13:19:44.410

查找此冲突的一种方法是打开 CMP 文件（例如使用 Winrar），然后查看 manifest.xml 文件。在那里，搜索“团队”。即使显示名称不同，您也可能会找到两个 NAME="Team"... --> 我们遇到了类似的问题，我们必须修复源站点（集合），然后重新导出它，然后才能成功导入它.

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T14:55:20.373

这可能与列表 ID 冲突。试试这个，创建一个新的内容数据库，然后创建一个新的网站集并进行导入？

# ruby-on-rails - 使用 Rails 和 ActiveRecord 维护记录编辑历史的最佳方法是什么

> ID：487572
> 
> 赞同：5
> 
> 时间：2009-01-28T13:15:15.303
> 
> 标签：ruby-on-rails, activerecord, transactions

在 Rails 中维护记录的编辑历史的最佳/最干净/最简单的方法是什么？

我正在寻找日志记录 - 谁进行了编辑以及何时以及能够回滚到早期版本的记录。

我的猜测是，您将在更新或删除时使用 ActiveRecord 回调，而不是更新/删除记录，您将创建一个新记录并具有某种标识符以保持相同的“记录”关联，也许是一个区分哪个记录是当前记录的字段和版本字段。

我隐约记得看到一些插件，但我现在似乎找不到它们。r

（有没有我不知道的术语？）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-28T13:30:37.003

act_as_audited 胜出。您甚至可以将acts_as_versioned 与它一起使用。[插件页面](http://opensoul.org/2006/7/21/acts_as_audited)解释了一切。浏览页面上帖子下方的讨论评论。开发者已经发布了问题，并得到了作者和其他人的积极回应。

我在许多应用程序中使用过这个插件，我发现它非常有用。强烈推荐。

这是插件页面的预览：

> acts_as_audited 是一个 Active Record 插件，它将对模型的所有修改记录在审计表中。它使用多态关联来存储您希望审计的任何模型对象的审计记录。审计日志存储更改所在的模型、“操作”（创建、更新、销毁）、更改的序列化哈希，以及可选的执行操作的用户。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-05-04T18:46:33.980

这里的答案很好，但需要一些更新。

act_as_audited 已重命名为已审核，请参阅[https://github.com/collectiveidea/audited](https://github.com/collectiveidea/audited)。我使用它取得了巨大的成功。

[paper_trail](https://github.com/airblade/paper_trail)也可能很有趣。[http://railscasts.com/episodes/255-undo-with-paper-trail](http://railscasts.com/episodes/255-undo-with-paper-trail)恢复版本有点尴尬，并且在 audited/acts_as_audited 中没有记录。paper_trail 在这方面有更清晰的例子。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T13:20:46.323

act_as_versioned 应该做你正在寻找的东西 - [http://wiki.rubyonrails.org/rails/pages/ActsAsVersioned](http://wiki.rubyonrails.org/rails/pages/ActsAsVersioned)

# sql - 使用 SELECT * 时的性能问题？

> ID：487578
> 
> 赞同：7
> 
> 时间：2009-01-28T13:16:35.317
> 
> 标签：sql, database, performance

> **可能重复：**
> [哪个更快/最好？SELECT * 或 SELECT column1,colum2,column3 等](https://stackoverflow.com/questions/65512/which-is-faster-best-select-or-select-column1-colum2-column3-etc)
> [不使用 select * 的原因是什么？](https://stackoverflow.com/questions/321299/what-is-the-reason-not-to-use-select)

使用 SELECT * 而不是 SELECT FiledName, FiledName2 ... 是否存在任何性能问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-28T13:29:07.570

看看这个帖子：

[不使用select *的原因是什么？](https://stackoverflow.com/questions/321299/what-is-the-reason-not-to-use-select)

还有这些：

*   [SQL 查询受限与调用整行时的性能优势](https://stackoverflow.com/questions/430605/performance-benefit-when-sql-query-is-limited-vs-calling-entire-row)
*   [哪个更快或最好，选择 * 或选择 column1 colum2 column3](https://stackoverflow.com/questions/65512/which-is-faster-best-select-or-select-column1-colum2-column3-etc)
*   [SQL查询问题 select * from view or select col1 col2 col3 from view](https://stackoverflow.com/questions/128412/sql-query-question-select-from-view-or-select-col1-col2-from-view)
*   [哪个更快，选择 * 或选择 column1 column2 等](https://stackoverflow.com/questions/65512/which-is-fasterbest-select-or-select-column1-colum2-column3-etc)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-28T13:22:17.113

如果您需要列的子集，那么您对优化器的帮助很糟糕（不能选择索引，或者不能只去索引，......）

某些数据库可以选择仅从索引中检索数据。那件事非常有帮助，并且提供了令人难以置信的加速。运行 SELECT * 查询不允许这个技巧。

无论如何，从应用的角度来看并不是一个好的做法。

* * *

示例：

*   您有一个包含 20 列（C1、C2、...、C19 C20）的表 T。
*   您在 T 上有一个索引 (C1,C2)
*   你做`SELECT C1, C2 FROM T WHERE C1=123`
*   优化器拥有索引的所有信息，不需要去表数据

相反，如果`SELECT * FROM T WHERE C1=123`优化器需要获取所有列数据，则无法使用 (C1,C2) 上的索引。

多个表的连接很有帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-28T13:19:27.073

唯一的性能问题是，如果您的应用程序只需要`select *`. 数据库中没有性能差异，因为它们实际上是同一件事。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-28T13:23:19.750

每次执行 select * 时，~~可能~~会有一个额外的查询来获取列列表。在高事务环境中，这*可能*成为可见的开销，但时不时地进行一次并没有什么区别。

此外，在插入记录时，切勿在插入时使用 select * 以防添加列。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-28T13:20:07.040

我不了解计算性能，但就读取/维护能力（即人类性能）而言，我们不在我的商店使用 select *。一切都是明确选择的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-28T13:23:25.957

我不是 DBA，但从我记得从我们的 DBA 那里学到的东西，推理（至少对于 SQL Server）是 DB 缓存算法不能很好地缓存 '*' 查询，但是如果您正在运行相同的查询多次指定确切的列，它会很好地缓存。

我确信知识渊博的 DBA 可以详细了解缓存机制的工作原理，但这就是性能下降的原因。

注意：缓存性能仅在查询要运行多次时才有效，尤其是在很短的时间范围内，否则您将看不到性能差异。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-28T22:35:37.387

也许。这在很大程度上取决于数据库引擎、它如何存储内容、返回多少行、有多少其他列以及其他列的大小。

如果您使用的是基于行的数据库（即大多数），它将所有列存储在一起（几乎所有列都这样做，除了通常单独存储的 BLOB，尤其是较大的），那么执行 SELECT * 对服务器本身 - 无论如何它必须获取整行。

另一方面，如果您通过网络发送数据（甚至在本地发送数据，因为它会影响使用的缓冲区的大小等），那么减少列数可能会有所帮助，因为要发送的字节数会更少背部。如果查询有任何困难（例如需要 IO），那么服务器性能无论如何都会使这种差异相形见绌。

如果行中有大斑点，则 SELECT * 不是很聪明 - 否则，它不太可能产生太大影响，但可以。

有一些“基于列”的数据库引擎在四处游荡——它们完全不同——对它们来说，“SELECT *”是一个全面的性能杀手；一定要避免它。很有可能，如果您使用的是一个，那么您会完全意识到这一点（通常它们用于非常大的数据仓库应用程序）。

对我来说，不使用“SELECT *”的主要优点是可维护性。当有人向表中添加额外的列时，您不会感到惊讶；当有人删除您正在使用的列之一时，您的查询“快速失败”。它使代码更具自我记录性，因为有人可以随便看到您想要的列。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-28T13:20:37.990

如果指定了所有字段，则不，在性能方面不应该有有意义的差异。但是，如果您只想要一个有十几个列的表中的几个特定字段，那么它会更慢。

存在可读性和可维护性问题`SELECT *`。始终使用特定的字段名称是有意义的，即使您想选择所有字段。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-28T13:35:53.000

性能，不多。只是有点笨拙：在一个表中，比如说，有 10 列，连接到其他两个表甚至更多，特别是对于大型结果集，SELECT * 可以返回数十列，通常包含大部分未使用甚至无用的数据。就对 DBMS 的影响而言，不会有太多影响，但所有数据仍然需要以某种方式通过网络传输；网络带宽和随之而来的延迟肯定会增加。我在大容量环境中亲眼目睹了这一点。这绝对很重要。

除了带宽问题之外，您还可能遇到模棱两可的列命名问题（消除歧义通常意味着无论如何都要删除 SELECT *，所以您不妨从一开始就这样做），而且明确说明代码里面的代码；这样做在很多方面都有帮助——调试、协作等。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-28T14:43:19.230

如果您在连接中使用 select *，那么您将自动发送比您需要的信息更多的信息，因为连接字段会重复。这是对处理时间和网络资源的浪费，并可能导致性能问题。进一步不指定字段意味着您的应用程序可能会在添加新字段时中断，特别是如果它们是用户不打算看到但用于审计或数据库类型处理的字段。在插入中选择 * 总是一个坏主意，因为某些不太聪明的人实际上可能会更改表中列的顺序。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-28T13:18:17.357

据说是的。我在工作中全心全意地告诉我，我永远不应该使用 SELECT *。事实上，我们的政策是不使用它，因为 a) 这意味着仅通过查看查询就可以使用的内容和可用的内容不明确，并且 b) 它速度较慢，因为 SQL 服务器必须找到它需要的每一列并返回它们.

然而，我从未见过任何证据。

**编辑**：此外，如果存储过程在服务器上编译并使用 SELECT *，则当基础表结构发生更改时，*它*不会选择新引入的列，因为 SQL 将 SELECT * 编译到各个列。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-28T13:21:45.743

SELECT * 在运行之前被转换为 SELECT Field1 ， Field2 .... 等，因此它们实际上是同一件事。性能上没有区别。

但是，当它的 SELECT Field1 , Field2 .. 时，可读性和可维护性更好。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-28T13:23:30.823

从技术上讲，这取决于您使用的关系数据库管理系统。我认为性能影响将是微秒。如果您绝对想从系统中挤出最后一点性能，我会说不要使用它们。

我个人一直在使用它。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-28T13:30:58.687

如果您只使用字段的子集，则性能差异可能很大。请参阅以下示例，其中涉及从[CScout](http://www.spinellis.gr/cscout/)[对 Linux 代码](http://www.spinellis.gr/pubs/conf/2008-ICSE-4kernel/html/Spi08b.html)的分析中检索 1,411,771 行。

```
$ time sh -c "echo 'select * from IDS' | mysql cslinux >/dev/null"
real    0m5.622s
user    0m2.580s
sys     0m0.532s

$ time sh -c "echo 'select EID from IDS' | mysql cslinux >/dev/null"
real    0m4.492s
user    0m0.716s
sys     0m0.096s 
```

这甚至没有衡量对服务器的性能影响。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-28T13:32:07.437

如果您在代码中嵌入 sql，那么为了清晰起见，您应该始终使用长格式，而不是性能。对于临时查询，选择 * 语法的效率基本上不低于指定列名，除非您有大量列，除非您进行非规范化，否则您不应该这样做。

我应该得到 1 分，因为在一个句子中使用 2 个除非它仍然有意义！:)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-28T13:47:53.630

SELECT * 需要 SQL 来查找所有列名，但这并不是长期影响最大的性能。

SELECT * 语句对性能的最大影响是当您执行需要非聚集索引来评估的查询时。即使非聚集索引是每列的覆盖索引，SQL 仍然会查找主键并从聚集索引中获取值。

最重要的是，如果您只需要一两列，由于返回的结果集比所需的大，您将面临网络瓶颈。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-28T14:12:11.537

我将回应其他人所说的关于“select *”检索列列表作为请求处理的一部分。相比之下，您还可以按序号选择列，这样可以节省更多时间，因为 RDBMS 引擎甚至不需要查找列来确定要检索的列的位置。我发现这对于聚合查询非常有用。

例如： select count(1) from ... 与 select count(*) from ...

在这个例子中，RDBMS 只需要知道它需要第一列的计数，ZING，它是关闭的。在（不幸的是）更常见的选择计数（*）中，RDBMS 检索所有列的列表，然后验证每一行以确定它是否对计数有效（而不是仅验证第一列）。

这在大多数情况下都很有效。我很确定大多数数据库系统都会在计数中计算 NULL 值，但您应该注意这一点并在假设之前进行验证。

YMMV，禁止的地方无效等！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-28T14:40:56.503

**性能** 如果您不需要所有列，这总是很糟糕。返回比需要更多的数据将限制数据库和您的局域网/广域网带宽。

**可读性** 知道哪些列在视图中，过程可能非常有用，SELECT * 根本没有帮助，我认为它会适得其反。

***测试** 如果您进行架构更改，则所有使用 SELECT * 的代码都**应该失效**，因为您编写的任何用于检查元数据的测试都应该检查视图的输出，proc。

*当然，假设您已经进行了测试，因为所有优秀的 DB 开发人员都应该拥有 :)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-01-28T15:50:50.217

除了某些性能要求外，我几乎同意所有答案。如果您实际上要使用表中的所有列，我认为 SELECT * 版本要快一点。原因如下：

在 (id,x) 上有唯一索引的表上执行这两个查询：

```
SELECT x,y,z,w FROM tab WHERE id='abc' ORDER BY s

SELECT x,y,z,w FROM tab WHERE id='abc' 
AND x in ('a','b','c','d','e','f','g','h',...)
ORDER BY ('a','b','c','d','e','f','g','h',...) 
```

哪个更快？如果 'x in' 子句将表中 x 的所有值命名为 id 'abc'，那么第一个查询可能会更快。现在让我们重命名这些字段：

```
SELECT field_name, field_type, field_offset, field_len
FROM internal_field_catalog
WHERE table_name = 'abc'
ORDER BY field_order 
```

因此，在检索数据时，SELECT * 允许引擎执行（相当于）单个 memcpy 以将行数据移动到结果集，并且在检索字段数据时可能更快地选择它。

我要说的是有一个极端情况 SELECT * 非常有用并且可能更快。您可能总是需要表中的所有列的一个原因是在 RDBMS 中存储对象持久性时（出于某种原因）。每个经验法则都有一个例外。

# java - 使用 Java 系统属性的最佳实践

> ID：487590
> 
> 赞同：11
> 
> 时间：2009-01-28T13:21:28.207
> 
> 标签：java, properties

我们的代码使用了很多系统属性，例如“java.io.tmpdir”、“user.home”、“user.name”等。我们没有在任何地方为这些定义任何常量（我认为 java 也没有）或处理它们的任何其他巧妙方法，因此它们以纯文本形式散布在整个代码中。

```
String tempFolderPath = System.getProperty("java.io.tmpdir"); 
```

每个人都如何使用系统属性？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-28T13:23:58.483

我会将其视为散布在代码中的任何其他字符串常量，并为它定义一个常量变量。当然，在这种情况下，“java.io.tmpdir”不太可能改变，但你永远不知道。（我并不是说 Sun 可能会改变“java.io.tmpdir”的含义，或者它指向的系统属性，而是您可能会改变对需要读取的系统属性的想法。）

如果您只在一个类中使用特定属性，那么我会在该类中定义常量。

```
private final String TEMPDIR = "java.io.tmpdir"; 
```

如果您在不同的类中使用相同的属性，您可能需要定义自己的静态类来保存您最常使用的常量。

```
public final Class Prop {
    public static final String TEMPDIR = "java.io.tmpdir";
    ...
} 
```

然后，在任何需要使用该常量的地方，只需使用

```
System.getProperty(Prop.TEMPDIR); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-07-19T08:03:39.697

Apache Commons Lang 包提供的[SystemUtils解决了这个问题。](http://commons.apache.org/proper/commons-lang/javadocs/api-release/index.html?org/apache/commons/lang3/SystemUtils.html)

SystemUtils 已经为大部分系统属性定义了常量，可以通过查找获得，例如：

```
import org.apache.commons.lang3.SystemUtils;

class Something
{
    public static void main(String[] args){     
        System.out.println(SystemUtils.JAVA_IO_TMPDIR);
    }
} 
```

可能，这是一种更清洁的方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-28T14:35:13.207

如果您在多个地方使用它，最好编写一个类来封装读取属性以及其他属性。

所以可能是这样的： Configuration.getTemporaryDirectory()

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-28T17:28:43.980

由于问题标题非常宽泛，我将提出另一个在使用系统属性时应该考虑的好习惯。可以通过 拒绝访问系统属性`SecurityManager`，因此您可能需要通过 访问它们[`PrivilegedAction`，](http://java.sun.com/j2se/1.5.0/docs/api/java/security/PrivilegedAction.html)如下所示：

```
String tmpdir = AccessController.doPrivileged(new PrivilegedAction<String>() {
  public String run() {
    return System.getProperty("java.io.tmpdir");
  }
}); 
```

当您的代码限制敏感操作时使用特权操作，这样即使恶意代码调用它也是安全的。

例如，在方法中使用特权操作是不安全的，例如`OutputStream open(File file)`. 不受信任的代码可以调用它，并使用您代码的权限在任何地方编写任何内容。

但是，如果您有一种方法可以将应用程序的用户首选项保存到您选择的文件中，那可能是安全的。恶意调用者无法选择文件位置或其内容；这些由您的代码指定。因此，您的方法可以使用特权操作来允许非特权代码调用它。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-11-09T10:03:09.573

我认为在面向对象的软件中，您可能有一个对象（或方法）依赖于必须完成工作的目录。因此，您可以证明这种对构造函数或方法的依赖。之后，如果您需要该目录的默认值并且默认值来自系统属性，您可以简单地创建一个工厂方法或构造函数/方法，并将较少的参数传递给另一个 costrunctor/方法：

```
new File(System.getProperty("java.io.tmpdir"); 
```

你不需要创建一个“依赖磁铁”来包含一个配置参数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T13:30:29.313

我会将它们视为任何其他常量，可能带有`P_`or`PROP_`前缀，并将它们放在适当的常量类中。

如果您使用很多，我什至会考虑将它们拆分为`PropertyNames`常量类：

```
public final class PropertyNames
{
  private PropertyNames()
  {
     // no instantiation
  }

  public static final String P_VAR_DIRECTORY = "org.acme.app.varDir";

  public static final String P_TMP_DIRECTORY = "java.io.tmpDir";
} 
```

最后，我会认真考虑使用用于包的标准反向域名对属性名称本身进行命名空间。这只是为了避免与第三方物业消费者发生冲突。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-05-22T17:11:09.353

在 Java 中，字符串是不可变的，这意味着内存空间中的同一个对象不会被覆盖；每次都会创建一个新字符串。目前投票率最高的建议是使用常量：

```
System.getProperty(Prop.TEMPDIR); 
```

不幸的是，所使用的常量是用于实际属性键的。这意味着每次进行此调用时，您都将创建一个新的 String 对象来保存该值。在我看来，您应该将常量作为调用本身的结果：

```
public static final String SYS_PROP_TEMP_DIR = System.getProperty("java.io.tmpdir"); 
```

# c# - LINQ to XML 和 LINQ to Objects 语法

> ID：487615
> 
> 赞同：4
> 
> 时间：2009-01-28T13:30:17.253
> 
> 标签：c#, xml, linq, object

为什么是：

```
(CheckBox)lstControls.Where(x => x.ID == "some_id").SingleOrDefault(); 
```

不如以下有效：

```
(CheckBox)lstControls.SingleOrDefault(x => x.ID == "some_id"); 
```

对于格式不太好的 XML 文档，您只知道要查找的元素的名称，这是您可以用来查找元素的最佳语句：

```
var xmlElem = (from n in xDocument.Descendants() where (string)n.Attribute("name") == "some_node_name" select n).SingleOrDefault(); 
```

谢谢....

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T13:43:47.757

如果我没记错的话，就大 O 效率而言，是一样的。这只是一个额外的方法调用。

关于第二个问题，

```
var xmlElem = (from n in xDocument.Descendants() where (string)n.Attribute("name") == "some_node_name" select n).SingleOrDefault(); 
```

可以更简单地表示为

```
var xmlElem = xDocument.Descendants().SingleOrDefault(n => (string)n.Attribute("name") == "some_node_name"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-12T18:01:03.120

```
(CheckBox)lstControls.Where(x => x.ID == "some_id").SingleOrDefault(); 
```

这必须测试枚举中的每一项。

```
(CheckBox)lstControls.SingleOrDefault(x => x.ID == "some_id"); 
```

这可以停止测试项目并在发现某些内容后立即返回。

如果您有一个非常大的枚举，并且靠近前面的项目满足条件，那么前者可能会明显更快。在满足条件的项目数随着枚举的大小而增加的情况下，加速可能是渐近的。例如，如果平均每 k 个项目中有一个满足条件，则第二个片段的平均运行时间是恒定的。

# .net - 执行 Nunit 测试期间的进程终止

> ID：487624
> 
> 赞同：0
> 
> 时间：2009-01-28T13:32:43.897
> 
> 标签：.net, nunit, cruisecontrol.net

我有一个测试项目需要花费大量时间来测试用例。我已经用 Nunit、msbuild 配置了 Cruisecontrol.net。现在，如果我在 Nunit 执行期间运行我的项目，它会终止进程并导致构建失败。此外，如果您强制构建，则结果不会更新，它会显示最后的构建结果，并且即使测试通过，在查看结果后也会给 Textfixturesetup 失败。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-27T15:27:14.783

看起来与[您的另一个问题](https://stackoverflow.com/questions/734484/process-timeout-without-showing-any-error-in-test-execution-using-cc-net/916342#916342)很相似。有关更多信息，请参阅那里的答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T16:25:26.760

“在执行 NUnit 期间运行项目”是什么意思？你的意思是CCNet和Visual Studio在同一个盒子上？

如果是这种情况，那么您可能不想要该配置。首先将 CCNet 放在单独的机器上。

# java - Java http下载损坏文件

> ID：487632
> 
> 赞同：3
> 
> 时间：2009-01-28T13:35:04.937
> 
> 标签：java, http, download

我有一个问题，我似乎无法解决...我对文件进行了 http 下载，但服务器和客户端上文件的 CRC32 不匹配。另外，文件的大小不同，所以很明显我一定做错了什么……当我通过 Firefox 下载时，文件大小还可以……所以我猜它在客户端代码中的某个地方。

我在使用 Java 下载文件时已经发现[Corrupt 文件](https://stackoverflow.com/questions/401748/corrupt-file-when-using-java-to-download-file)，但这对我也没有帮助......

这是代码：

```
private void downloadJar(String fileName, long crc32Server) throws IOException {
  System.out.println("Downloading file '" + fileName + "' from server '" + mServer + "'.");
  HttpURLConnection sourceConnection = null;
  BufferedInputStream inputStream = null;
  BufferedWriter fileWriter = null;
  long crc32Client;
  try {
    URL sourceURL = new URL(fileName);
    try {
      sourceConnection = (HttpURLConnection)sourceURL.openConnection();
    }
    catch (MalformedURLException exc) {
      throw new RuntimeException("Configured URL caused a MalformedURLException: ", exc);
    }
    sourceConnection.setRequestProperty("Accept-Encoding", "zip, jar");
    sourceConnection.connect();
    inputStream = new BufferedInputStream(sourceConnection.getInputStream());
    fileWriter = new BufferedWriter(new FileWriter(targetFolder + File.separator + fileName));
    CRC32 crc32 = new CRC32();
    for (int singleByte = inputStream.read(); singleByte != -1; singleByte = inputStream.read()) {
      fileWriter.write(singleByte);
      crc32.update(singleByte);
    }
    crc32Client = crc32.getValue();
  }
  finally {
    if (inputStream != null) {
      inputStream.close();
    }
    if (fileWriter != null) {
      fileWriter.flush();
      fileWriter.close();
    }
    if (sourceConnection != null) {
      sourceConnection.disconnect();
    }
  }
  if (crc32Client != crc32Server) {
    //      deleteFile(fileName);
    throw new IOException("CRC32 did not match for file '" + fileName + "': " + crc32Client + "!="
        + crc32Server);
  }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T13:38:41.077

您应该使用[BufferedOutputStream](http://java.sun.com/javase/6/docs/api/java/io/BufferedOutputStream.html)而不是[`FileWriter`](http://java.sun.com/javase/6/docs/api/java/io/FileWriter.html)/ [`BufferedWriter`](http://java.sun.com/javase/6/docs/api/java/io/BufferedWriter.html)。通常，`*Streams`处理原始二进制数据，同时`*Writers`处理字符数据（这是对给定字符编码的原始二进制数据的解释）。

# email - 在 Postfix 中定义“消息处理程序”

> ID：487635
> 
> 赞同：0
> 
> 时间：2009-01-28T13:38:02.543
> 
> 标签：email, postfix-mta

我们正在使用 Postfix 进行邮件传递，我正在尝试让一个 shell 脚本处理发送到 foo-bar-baz-bat@example.org 的电子邮件。

有没有办法做到这一点以及如何做到这一点？

我正在尝试为公告板创建一个基于电子邮件的前端。用户分为两派：喜欢使用论坛的用户和喜欢使用邮件列表的用户。这个想法是创建一个解决方案，通过发送有关新帖子的电子邮件通知（这是简单的部分）并允许人们通过电子邮件发帖，其中元数据（如主题 ID）将被编码在电子邮件地址。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:47:28.797

在 /etc/别名

您应该能够像这样为脚本别名

```
foo-bar-baz-bat@example.org: |"/path/to/ScriptOrExecutableHere" 
```

我用我的 Trac 安装做到了这一点，它就像一个魅力......

编辑：哦......我没有意识到你会为动态地址起别名......我认为你需要一个脚本来为创建论坛线程时的电子邮件地址起别名......

EDIT2：实际上，您可能可以将包罗万象用于这样的事情......

我还没有这样做，但是您可以将“@example.org”别名为命令。看[这里](http://www.postfix.org/VIRTUAL_README.html)了解更多

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T15:22:33.720

如果 example.org 电子邮件仅用于讨论，您可以将整个 @example.org 转发到您的脚本。或者您可以使用@discussions.example.org。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-29T08:36:47.807

Postfix 的队列前内容过滤器可以帮助：

[http://www.postfix.org/SMTPD_PROXY_README.html](http://www.postfix.org/SMTPD_PROXY_README.html)

我写了一篇关于如何使用它的帖子，但您可以轻松地根据自己的需要调整它：

[http://returnbooleantrue.blogspot.com/2011/10/google-apps-split-delivery-for-email.html](http://returnbooleantrue.blogspot.com/2011/10/google-apps-split-delivery-for-email.html)

# arrays - 如何将数组作为参数从 Hibernate 传递到 PL/SQL？

> ID：487636
> 
> 赞同：1
> 
> 时间：2009-01-28T13:38:08.800
> 
> 标签：arrays, hibernate, plsql

我需要将一个整数数组从 Hibernate 传递给 PL/SQL 函数。当前的解决方案是将数组转换为逗号分隔的字符串并用括号括起来以将其用作参数。这是[此处](http://forums.hibernate.org/viewtopic.php?p=2323190&sid=f50814e84d17f277eb74cc6755163e1c)概述的解决方案。

但是，当需要传递 200k 个元素的数组时，这种方法看起来不是一个好的解决方案。

有没有办法使用 Hibernate 的构造来传递这个数组？

编辑：我正在使用 PostgreSQL。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-20T01:28:38.300

不建议将 200k 元素数组传递给数据库函数。我认为更好的方法是将这些值作为批量插入插入到单独的表中，然后调用该函数并让它引用该表。

# python - 跨多台服务器的库存控制 .. 想法？

> ID：487642
> 
> 赞同：0
> 
> 时间：2009-01-28T13:39:54.740
> 
> 标签：python, tracking, inventory

我们目前有一个内部构建的库存管理系统。它工作得很好，我们一直在对其进行创新。

去年秋天，我们开始通过购物车结账直接在我们的一个网站上销售产品。

我们的库存管理系统在办公室的服务器上运行，而我们目前拥有的三个网站（只有一个实际销售商品）显然是在外部资源上运行的。

看到我的问题了吗？基本上，我正在尝试如何创建一个中央库存控制系统，该系统允许内部软件和外部网站进行通信，以便库存始终是最新的，并且我们不会出售我们没有的东西。

我们的内部库存跟踪运行良好且流畅，但我不知道如何实施可以在两者之间进行通信的可靠跟踪系统。

该软件都是用 Python 编写的，但这并不重要，因为我主要是在寻找关于如何实现它的想法和方法。

提前感谢您的任何答案，我希望这是有道理的..我可以详细说明。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:45:27.397

一种可能性是在您的库存管理系统上公开一个 Web 服务接口，该接口允许远程访问 Web 店面使用的交易。通过合理安全的 VPN 链接或 ssh 隧道类型安排，网络店面可以获取库存水平、下订单或针对库存系统执行搜索。

笔记：

1.  您仍然需要为库存服务添加一个合理的安全层，以防网络店面受到威胁。

2.  您必须确保您的库存管理应用程序和服务器足够大以处理负载，或者可以合理地轻松扩展以便它可以这样做。

库存应用程序的 SLA 需要足够好才能支持网络店面。这可能意味着某种热故障转移安排。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T13:50:56.683

我没有看到问题...您有一个在本地管理数据库的服务器上运行的应用程序。远程服务器没有理由也不能与该数据库通信。

当然，如果您没有数据库，而是使用本地开发的应用程序来充当某种人造数据库，我建议您尽快重构以使用某种实际的数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T18:03:48.340

我不确定是否有任何一个非常好的解决方案来解决您的问题。我认为你现在这样做的方式很好，但如果你不同意，那么我不知道该告诉你什么。

# post - PL/SQL (mod_plsql)：只接受来自 POST 的参数，而不是 GET 请求？

> ID：487646
> 
> 赞同：2
> 
> 时间：2009-01-28T13:41:11.880
> 
> 标签：post, parameters, plsql, mod-plsql

我正在开发一个应用程序，该应用程序将 mod_plsql 与 Oracle 10G 一起使用，通过直接从 Web 浏览器调用的 PL/SQL 存储过程生成网页。我正在寻找一种仅通过 POST 请求而不是 GET 请求接受参数的方法。

即，在 PHP 中，我只想要 $_POST['parameter_name'] 的值而不是 $_GET['parameter_name']。我无法在 Pl/SQL 中找到实现此目的的方法，因为参数是在过程定义中指定的并且没有请求类型。

有什么方法可以用 PL/SQL 实现这一点？

谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T19:21:53.897

如果您无权访问 Apache 配置，您可以将以下代码放在 Oracle 过程的顶部：

```
if owa_util.get_cgi_env('REQUEST_METHOD') != 'POST' then
    raise_application_error(-20001,'Only POST request method is allowed.');
end if; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T23:52:14.713

在 Apache 配置中，您可能可以使用[Limit 指令](http://httpd.apache.org/docs/2.2/mod/core.html#limit)将相关 URL 限制为 POST 请求。

# multithreading - 由于 java.lang.OutOfMemoryError：Java 堆空间，RMI 线程终止

> ID：487649
> 
> 赞同：1
> 
> 时间：2009-01-28T13:43:02.220
> 
> 标签：multithreading, rmi

我正在开发基于 comp 的应用程序。在这个应用程序中，有 n 个容器通过它们相互提供的 RMI 服务相互通信。在某些情况下，连接到我的容器的一个 rmi 线程由于内存不足错误而失去连接，但连接到我的容器的所有其他 RMI 线程都工作正常。

错误的堆栈tarce在这里：

```
Exception dispatching call to [655d565c:11f1d5dbae2:-7ffb, -3259564578052694518] in thread "RMI TCP Connection(21)-132.186.96.179" at Wed Jan 28 18:50:37 GMT+05:30 2009: 
java.lang.OutOfMemoryError: Java heap space
    at java.lang.reflect.Array.newArray(Native Method)
    at java.lang.reflect.Array.newInstance(Unknown Source)
    at java.io.ObjectInputStream.readArray(Unknown Source)
    at java.io.ObjectInputStream.readObject0(Unknown Source)
    at java.io.ObjectInputStream.defaultReadFields(Unknown Source)
    at java.io.ObjectInputStream.readSerialData(Unknown Source)
    at java.io.ObjectInputStream.readOrdinaryObject(Unknown Source)
    at java.io.ObjectInputStream.readObject0(Unknown Source)
    at java.io.ObjectInputStream.defaultReadFields(Unknown Source)
    at java.io.ObjectInputStream.readSerialData(Unknown Source)
    at java.io.ObjectInputStream.readOrdinaryObject(Unknown Source)
    at java.io.ObjectInputStream.readObject0(Unknown Source)
    at java.io.ObjectInputStream.readObject(Unknown Source)
    at sun.rmi.server.UnicastRef.unmarshalValue(Unknown Source)
    at sun.rmi.server.UnicastServerRef.dispatch(Unknown Source)
    at sun.rmi.transport.Transport$1.run(Unknown Source)
    at java.security.AccessController.doPrivileged(Native Method)
    at sun.rmi.transport.Transport.serviceCall(Unknown Source)
    at sun.rmi.transport.tcp.TCPTransport.handleMessages(Unknown Source)
    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(Unknown Source)
    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(Unknown Source)
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
    at java.lang.Thread.run(Unknown Source) 
```

要查看此异常，我必须激活 RMI 特定的日志记录。出现此问题是因为此终止线程的每个 RMI 调用都会将一些数据添加到我的容器的堆中。并且在某些时候它的大小超过了。

**我对你们的问题是，如果我的容器的堆大小内存不足，为什么其他线程正在工作？如果您有任何想法，请告诉我。**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T13:54:16.643

失败的调用是

`java.lang.reflect.Array.newArray(Native Method)`

这意味着失败的 RMI 线程正在尝试分配一个数组。不幸的是，它没有告诉我们它试图分配的数组有多大。它试图分配一个*巨大*的数组，但失败了，那么这不会伤害任何其他线程。与正在发出的其他请求相比，失败的请求必须分配更多的内存，这有什么不同**吗**？

详细说明……假设出于某种原因，这个请求试图分配一个 500 兆的数组（并且堆上没有足够的内存）。那么，*该*分配请求将失败。但只要堆仍有足够的内存用于正常的分配请求，其他线程创建新对象就不会出现问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T13:54:50.950

简单的回答：因为其他操作没有失败操作的内存要求。

更长的答案从查看堆栈跟踪开始：

```
java.lang.OutOfMemoryError: Java heap space at java.lang.reflect.Array.newArray(Native Method) at
java.lang.reflect.Array.newInstance(Unknown Source) at java.io.ObjectInputStream.readArray(Unknown Source) at
java.io.ObjectInputStream.readObject0(Unknown Source) at java.io.ObjectInputStream.defaultReadFields(Unknown
...
sun.rmi.transport.tcp.TCPTransport.handleMessages(Unknown Source) at 
```

因此，失败的线程正在尝试创建一个新数组，以处理传入的请求。如果该数组特别大，则请求处理程序可能无法分配它，而使用较少数据量的其他请求将毫无问题地处理。

所以，第一个问题是：这个数组有多大？您应该在客户端放置一些日志来确定这一点。如果一个特定的客户端试图发送一个非常大的数组，你可能需要减小它的大小。

第二个问题：您是否为服务器 JVM 提供了足够的内存来处理预期的负载？Jave 是少数仍然需要您告诉它程序需要多少内存的环境之一，而且默认值非常小（我相信是 64M）。查看 -ms 和 -mx 参数以了解如何增加它。

# c# - 如何暂停控件及其子控件的绘制？

> ID：487661
> 
> 赞同：190
> 
> 时间：2009-01-28T13:46:34.443
> 
> 标签：c#, .net, winforms, paint

我有一个控件，我必须对其进行大量修改。我想在这样做时完全防止它重绘 - SuspendLayout 和 ResumeLayout 是不够的。如何暂停控件及其子控件的绘制？

* * *

## 回答 #1

> 赞同：323
> 
> 时间：2009-01-28T14:15:31.890

在我之前的工作中，我们努力让我们丰富的 UI 应用程序能够立即流畅地绘制。我们使用的是标准的 .Net 控件、自定义控件和 devexpress 控件。

经过大量谷歌搜索和反射器使用后，我遇到了 WM_SETREDRAW win32 消息。这确实会在您更新控件时停止绘图，并且可以将 IIRC 应用于父/包含面板。

这是一个非常简单的类，演示如何使用此消息：

```
class DrawingControl
{
    [DllImport("user32.dll")]
    public static extern int SendMessage(IntPtr hWnd, Int32 wMsg, bool wParam, Int32 lParam);

    private const int WM_SETREDRAW = 11; 

    public static void SuspendDrawing( Control parent )
    {
        SendMessage(parent.Handle, WM_SETREDRAW, false, 0);
    }

    public static void ResumeDrawing( Control parent )
    {
        SendMessage(parent.Handle, WM_SETREDRAW, true, 0);
        parent.Refresh();
    }
} 
```

对此有更全面的讨论 - google for C# 和 WM_SETREDRAW，例如

[C# 抖动](https://web.archive.org/web/20160324214157/http://blog.bee-eee.com/2008/04/18/c-getting-rid-of-the-jitter/)

[暂停布局](http://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=52)

对于它可能关心的人来说，这是 VB 中的一个类似示例：

```
Public Module Extensions
    <DllImport("user32.dll")>
    Private Function SendMessage(ByVal hWnd As IntPtr, ByVal Msg As Integer, ByVal wParam As Boolean, ByVal lParam As IntPtr) As Integer
    End Function

    Private Const WM_SETREDRAW As Integer = 11

    ' Extension methods for Control
    <Extension()>
    Public Sub ResumeDrawing(ByVal Target As Control, ByVal Redraw As Boolean)
        SendMessage(Target.Handle, WM_SETREDRAW, True, IntPtr.Zero)
        If Redraw Then
            Target.Refresh()
        End If
    End Sub

    <Extension()>
    Public Sub SuspendDrawing(ByVal Target As Control)
        SendMessage(Target.Handle, WM_SETREDRAW, False, IntPtr.Zero)
    End Sub

    <Extension()>
    Public Sub ResumeDrawing(ByVal Target As Control)
        ResumeDrawing(Target, True)
    End Sub
End Module 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2011-06-10T04:36:33.073

以下是 ng5000 的相同解决方案，但不使用 P/Invoke。

```
public static class SuspendUpdate
{
    private const int WM_SETREDRAW = 0x000B;

    public static void Suspend(Control control)
    {
        Message msgSuspendUpdate = Message.Create(control.Handle, WM_SETREDRAW, IntPtr.Zero,
            IntPtr.Zero);

        NativeWindow window = NativeWindow.FromHandle(control.Handle);
        window.DefWndProc(ref msgSuspendUpdate);
    }

    public static void Resume(Control control)
    {
        // Create a C "true" boolean as an IntPtr
        IntPtr wparam = new IntPtr(1);
        Message msgResumeUpdate = Message.Create(control.Handle, WM_SETREDRAW, wparam,
            IntPtr.Zero);

        NativeWindow window = NativeWindow.FromHandle(control.Handle);
        window.DefWndProc(ref msgResumeUpdate);

        control.Invalidate();
    }
} 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-11-24T13:04:07.487

我通常使用 ngLink's [answer](https://stackoverflow.com/questions/487661/how-do-i-suspend-painting-for-a-control-and-its-children/487757#487757)的一些修改版本。

```
public class MyControl : Control
{
    private int suspendCounter = 0;

    private void SuspendDrawing()
    {
        if(suspendCounter == 0) 
            SendMessage(this.Handle, WM_SETREDRAW, false, 0);
        suspendCounter++;
    }

    private void ResumeDrawing()
    {
        suspendCounter--; 
        if(suspendCounter == 0) 
        {
            SendMessage(this.Handle, WM_SETREDRAW, true, 0);
            this.Refresh();
        }
    }
} 
```

这允许嵌套暂停/恢复调用。您必须确保将每个`SuspendDrawing`与`ResumeDrawing`. 因此，将它们公开可能不是一个好主意。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2015-03-10T11:40:42.813

为了帮助不要忘记重新启用绘图：

```
public static void SuspendDrawing(Control control, Action action)
{
    SendMessage(control.Handle, WM_SETREDRAW, false, 0);
    action();
    SendMessage(control.Handle, WM_SETREDRAW, true, 0);
    control.Refresh();
} 
```

用法：

```
SuspendDrawing(myControl, () =>
{
    somemethod();
}); 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-10-28T16:07:53.410

根据 ng5000 的回答，我喜欢使用这个扩展：

```
 #region Suspend
        [DllImport("user32.dll")]
        private static extern int SendMessage(IntPtr hWnd, Int32 wMsg, bool wParam, Int32 lParam);
        private const int WM_SETREDRAW = 11;
        public static IDisposable BeginSuspendlock(this Control ctrl)
        {
            return new suspender(ctrl);
        }
        private class suspender : IDisposable
        {
            private Control _ctrl;
            public suspender(Control ctrl)
            {
                this._ctrl = ctrl;
                SendMessage(this._ctrl.Handle, WM_SETREDRAW, false, 0);
            }
            public void Dispose()
            {
                SendMessage(this._ctrl.Handle, WM_SETREDRAW, true, 0);
                this._ctrl.Refresh();
            }
        }
        #endregion 
```

采用：

```
using (this.BeginSuspendlock())
{
    //update GUI
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-03-10T22:53:44.513

不使用互操作的一个很好的解决方案：

与往常一样，只需在您的 CustomControl 上启用 DoubleBuffered=true。然后，如果您有任何容器，如 FlowLayoutPanel 或 TableLayoutPanel，请从这些类型中的每一个派生一个类，并在构造函数中启用双缓冲。现在，只需使用您的派生容器而不是 Windows.Forms 容器。

```
class TableLayoutPanel : System.Windows.Forms.TableLayoutPanel
{
    public TableLayoutPanel()
    {
        DoubleBuffered = true;
    }
}

class FlowLayoutPanel : System.Windows.Forms.FlowLayoutPanel
{
    public FlowLayoutPanel()
    {
        DoubleBuffered = true;
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-03-12T15:47:57.123

这里结合了 ceztko 和 ng5000 带来了一个不使用 pinvoke 的 VB 扩展版本

```
Imports System.Runtime.CompilerServices

Module ControlExtensions

Dim WM_SETREDRAW As Integer = 11

''' <summary>
''' A stronger "SuspendLayout" completely holds the controls painting until ResumePaint is called
''' </summary>
''' <param name="ctrl"></param>
''' <remarks></remarks>
<Extension()>
Public Sub SuspendPaint(ByVal ctrl As Windows.Forms.Control)

    Dim msgSuspendUpdate As Windows.Forms.Message = Windows.Forms.Message.Create(ctrl.Handle, WM_SETREDRAW, System.IntPtr.Zero, System.IntPtr.Zero)

    Dim window As Windows.Forms.NativeWindow = Windows.Forms.NativeWindow.FromHandle(ctrl.Handle)

    window.DefWndProc(msgSuspendUpdate)

End Sub

''' <summary>
''' Resume from SuspendPaint method
''' </summary>
''' <param name="ctrl"></param>
''' <remarks></remarks>
<Extension()>
Public Sub ResumePaint(ByVal ctrl As Windows.Forms.Control)

    Dim wparam As New System.IntPtr(1)
    Dim msgResumeUpdate As Windows.Forms.Message = Windows.Forms.Message.Create(ctrl.Handle, WM_SETREDRAW, wparam, System.IntPtr.Zero)

    Dim window As Windows.Forms.NativeWindow = Windows.Forms.NativeWindow.FromHandle(ctrl.Handle)

    window.DefWndProc(msgResumeUpdate)

    ctrl.Invalidate()

End Sub

End Module 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-01-05T23:56:50.853

我知道这是一个老问题，已经回答了，但这是我对此的看法；我将更新的暂停重构为 IDisposable - 这样我就可以将要运行的语句包含在`using`语句中。

```
class SuspendDrawingUpdate : IDisposable
{
    private const int WM_SETREDRAW = 0x000B;
    private readonly Control _control;
    private readonly NativeWindow _window;

    public SuspendDrawingUpdate(Control control)
    {
        _control = control;

        var msgSuspendUpdate = Message.Create(_control.Handle, WM_SETREDRAW, IntPtr.Zero, IntPtr.Zero);

        _window = NativeWindow.FromHandle(_control.Handle);
        _window.DefWndProc(ref msgSuspendUpdate);
    }

    public void Dispose()
    {
        var wparam = new IntPtr(1);  // Create a C "true" boolean as an IntPtr
        var msgResumeUpdate = Message.Create(_control.Handle, WM_SETREDRAW, wparam, IntPtr.Zero);

        _window.DefWndProc(ref msgResumeUpdate);

        _control.Invalidate();
    }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-01-08T17:13:27.940

这甚至更简单，*也许也很老套—​​—因为我可以在这个线程上看到很多 GDI 肌肉*，而且**显然只适合某些场景。**YMMV

在我的场景中，我使用我称之为“父级”的用户控件——在`Load`事件期间，我只是从父级的`.Controls`集合中删除要操作的控件，父`OnPaint`级负责完全绘制孩子以任何特殊方式进行控制.. 使孩子的绘画能力完全离线。

现在，我将我的孩子绘画例程交给基于 Mike Gold 的这个概念的扩展方法[，用于打印 windows 窗体](http://www.c-sharpcorner.com/UploadFile/mgold/HowToPrintingFormControlsinCSharpand.NET11212005063649AM/HowToPrintingFormControlsinCSharpand.NET.aspx)。

在这里，我需要一组标签来**垂直**于布局呈现：

[![Visual Studio IDE 的简单图表](https://i.stack.imgur.com/bpB8X.png)](https://i.stack.imgur.com/bpB8X.png)

`ParentUserControl.Load`然后，我在事件处理程序中使用以下代码使子控件免于绘制：

```
Private Sub ParentUserControl_Load(sender As Object, e As EventArgs) Handles MyBase.Load
    SetStyle(ControlStyles.UserPaint, True)
    SetStyle(ControlStyles.AllPaintingInWmPaint, True)

    'exempt this control from standard painting: 
    Me.Controls.Remove(Me.HostedControlToBeRotated) 
End Sub 
```

然后，在同一个 ParentUserControl 中，我们从头开始绘制要操作的控件：

```
Protected Overrides Sub OnPaint(e As PaintEventArgs)
    'here, we will custom paint the HostedControlToBeRotated instance...

    'twist rendering mode 90 counter clockwise, and shift rendering over to right-most end 
    e.Graphics.SmoothingMode = Drawing2D.SmoothingMode.AntiAlias
    e.Graphics.TranslateTransform(Me.Width - Me.HostedControlToBeRotated.Height, Me.Height)
    e.Graphics.RotateTransform(-90)
    MyCompany.Forms.CustomGDI.DrawControlAndChildren(Me.HostedControlToBeRotated, e.Graphics)

    e.Graphics.ResetTransform()
    e.Graphics.Dispose()

    GC.Collect()
End Sub 
```

一旦您将 ParentUserControl 托管在某处，例如 Windows 窗体 - 我发现我的 Visual Studio 2015在设计时和运行时正确 呈现*窗体：*[![ParentUserControl 托管在 Windows 窗体或其他用户控件中](https://i.stack.imgur.com/hATjt.png)](https://i.stack.imgur.com/hATjt.png)

现在，由于我的特定操作将子控件旋转了 90 度，我确信该区域中的所有热点和交互性都已被破坏 - 但是，我要解决的问题都是需要预览和打印的包装标签，这对我来说很好。

如果有办法将热点和控制性重新引入我故意孤立的控制中 - 我很想有朝一日了解这一点（当然不是为了这种情况，但是......只是为了学习）。当然，WPF 支持这种疯狂的 OOTB.. 但是.. 嘿.. WinForms 仍然很有趣，对吧？

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2012-01-14T15:22:38.380

或者只是使用`Control.SuspendLayout()`and `Control.ResumeLayout()`。

# wcf - 从一个客户端使用多个 WCF 服务

> ID：487662
> 
> 赞同：3
> 
> 时间：2009-01-28T13:46:42.667
> 
> 标签：wcf

我有 10 台运行 IIS 的服务器的网络场，在每台服务器上我都有相同的网站以及相同的 WCF 服务（它公开了一些用于读取/删除缓存、会话、应用程序变量、其他内部数据的功能）

在其他一些 Web 服务器上，我有一个“管理”Web 应用程序，它是上述 WCF 服务的客户端。

为这种架构创建和管理代理的最佳方式是什么？

如果具有 WCF 服务的新服务器可用，则以不需要重新编译客户端应用程序的方式从 Web 场服务器使用 WCF 服务的推荐方法是什么？

您能否指出一些资源，其中显示了一些类似的设置？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T14:08:30.813

如果多台服务器上的服务相同，那很容易，只需在打开连接时提供端点地址即可；

```
MyHelloServiceClient proxy = new MyHelloServiceClient("myServerNameorIP"); 
```

代理的构造函数中有一个可选参数（假设您正在使用代理生成），它采用服务器名称或 EndpointAddress。

然后，您所需要的只是一个可供您选择的服务器列表。

# c++ - 针对 MS Windows 的 TAPI 组件的建议

> ID：487663
> 
> 赞同：0
> 
> 时间：2009-01-28T13:47:15.113
> 
> 标签：c++, tapi

谁能推荐一个在 MS Windows 环境中与 C++ 一起使用的 TAPI 组件？我已经尝试过 TAPI 2 和 3 的标准 MS 实现，但两者都有问题。主要是从调制解调器被关闭或失去连接中恢复。
最新的问题是 TAPI 设备在完美运行几天后消失了——但仅在某些计算机上。
为组件付费没有问题 - 我只想要一个有效的！

两个我们还没有弄清楚的问题：
1）如果调制解调器在我们使用它时被关闭，我们将无法再次使用它，直到我们重新启动计算机
2）我们收到一个回调“CTapiLine::OnCallStateChange (hCall, dwState, dwStateDetail, dwPrivilage);", 其中 dwState = LINECALLSTATE_DISCONNECTED; 和 dwStateDetail=LINEDISCONNECTMODE_NODIALTONE 建立连接后，但我们已经关闭了调制解调器属性中的“等待拨号音”。使用不同的计算机连接到同一个目的地可以正常工作，因此我们认为这不是目的地的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T01:49:07.053

如果您愿意用 C++ 编写 COM 代码，则可以使用任何 TAPI OCX 控件。上一次使用 TAPI 时（几年前），我使用了[Exceletel TeleTools OCX](http://www.exceletel.com/)。它运作良好，并且是（恕我直言）当时的最佳选择。如果您环顾四周，您会发现一些具有类似功能的免费和共享软件 OCX 控件。但是，如果您使用的是 C++，最好直接调用 TAPI，而不是使用 OCX 来增加复杂性。

你没有说你使用的是什么 TAPI 设备，但我猜它是一个语音调制解调器。如果是这样，您的问题可能不在于 Microsoft 的 TAPI 实现（大多数第三方 TAPI 组件将使用它与语音调制解调器通信），而在于语音调制解调器硬件或 Unimodem TSP。Exceletel 的支持页面对[使用语音调制解调器进行电话工作所涉及的问题进行](http://www.exceletel.com/support/hardware/VoiceModems/index.htm)了很好的描述。如果可能的话，如果您希望您的应用程序具有任何可靠性，那么您应该使用专用的语音电话设备而不是语音调制解调器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-09T05:45:33.337

我们正在放弃 TAPI——无论我们如何编码，测试部门总能找到破解它的方法（通常是在某个关键点关闭调制解调器），因此唯一的解决方案是重新启动 PC。所以它又回到了通过串口直接控制调制解调器。我们越早让客户放弃使用 ADSL 和 3G 调制解调器就越好……

# linq - 使用数据缓存和延迟加载时是否有冲突？

> ID：487669
> 
> 赞同：2
> 
> 时间：2009-01-28T13:48:30.573
> 
> 标签：linq, caching, lazy-loading

如果我打算使用数据缓存，在使用延迟加载时是否需要担心冲突？似乎使用 linq 我正在失去对数据的控制。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T17:20:16.213

LinqToSql 和 EntityFramework 都提供了这两种功能（延迟加载和数据缓存）。

例如，如果您最初加载一个客户，该客户将被缓存，如果您再次请求它，您将获得相同的实例。

如果您在初始加载期间未加载客户的订单，则该客户实例的 Orders 属性将处于未加载状态。当您加载这些订单时，订单实例将通过该属性可用。

*   LinqToSql 将在第一次使用时加载该属性。
*   EntityFramework 将在被要求时加载该属性（使用 Load 方法）。

在这两种技术中，上下文都是进行缓存的东西......因此，如果您使用多个上下文实例 - 您可以观察到真正代表同一客户的不同客户实例。

* * *

在评论中解决您的问题。我将谈论 LinqToSql，但这些东西也应该在 EntityFramework 中工作。

*   这是[延迟加载与立即](http://msdn.microsoft.com/en-us/library/bb399393.aspx)加载的解释。
*   这是[对象标识和缓存的解释](http://msdn.microsoft.com/en-us/library/bb399376.aspx)。

> 如果我关闭延迟加载，我接受它，数据缓存仍然有效吗？

是的，这会奏效。但是，它们并不是完全独立的。

*   这是[关闭缓存](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.objecttrackingenabled.aspx)的方法（默认情况下它是打开的）。
*   以下是[如何打开延迟加载](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.deferredloadingenabled.aspx)（默认开启）。 **阅读这篇文章**，因为它解释了这些特性是如何相互作用的。

> 数据缓存刷新是否取决于数据表和/或时间是否发生变化？

没有刷新或重置缓存。如果你想要一个新的缓存，要做的就是创建一个新的 DataContext。DataContext 的每个实例都有自己的缓存。

*   有一种方法可以使用数据库中的更改来更新缓存，也就是[Refresh](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.refresh.aspx)。
*   无法将更改从数据库推送到缓存。

# .net - 用于 .NET 的耙子

> ID：487671
> 
> 赞同：10
> 
> 时间：2009-01-28T13:49:06.810
> 
> 标签：.net, rake

使用 Rake 构建 .NET 解决方案和运行 MbUnit 测试的最佳方法是什么？

我目前正在像这样直接调用命令：

```
sh "#{DOT_NET_PATH}msbuild.exe /p:Configuration=#{CONFIG} #{SOLUTION}" 
```

这有效，但似乎有点垃圾。有没有人们会推荐使用的宝石？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-12-15T01:36:41.090

我刚开始使用[http://github.com/derickbailey/Albacore](http://github.com/derickbailey/Albacore)上提供的[albacore](http://albacorebuild.net/)。

[wiki](http://wiki.github.com/derickbailey/Albacore)上的完整文档

您执行构建的任务很简单：

```
msbuild do |msb|
 msb.solution = "mysolution.sln"
 #... other settings here
end 
```

想要执行单元测试？

```
desc "NUnit Test Runner Example"
nunit do |nunit|
    nunit.path_to_command = "NUnit/nunit-console.exe"
    nunit.assemblies << "assemblies/TestSolution.Tests.dll"
end 
```

更新：查看[这篇 2010 年 5 月的文章](http://code-magazine.com/Article.aspx?QuickID=1006101)以获得非常全面的教程。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-10T14:21:19.047

[rake-dotnet](http://www.neverrunwithscissors.com/development/tools/2009/04/03/raking-it-in-rake-dotnet-hello-world-release-v005.html)非常有用，尽管它很新（尽管我承认这很无耻 ;-)）。

[源代码](http://github.com/petemounce/rake-dotnet)

# backup - 如何使用 SQL Server Express 安排每日备份？

> ID：487675
> 
> 赞同：64
> 
> 时间：2009-01-28T13:51:01.580
> 
> 标签：backup, sql-server-express, scheduled-tasks

我正在运行一个使用 SQL server express (2005) 作为后端的小型 Web 应用程序。我可以使用 SQL 脚本创建备份，但是，我想每天安排一次。作为额外选项（应该有），我只想保留最后的 X 备份（显然是出于节省空间的原因）任何指针？

[编辑] SQL Server 代理在 SQL Server Express 中不可用...

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-01-28T14:03:31.790

您不能在 SQL Server Express 中使用 SQL Server 代理。我之前的做法是创建一个 SQL 脚本，然后每天将其作为计划任务运行，您可以有多个计划任务以适应您的备份计划/保留。我在计划任务中使用的命令是：

"C:\Program Files\Microsoft SQL Server\90\Tools\Binn\SQLCMD.EXE" -i"c:\path\to\sqlbackupScript.sql"

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2011-05-10T18:28:19.417

## Eduardo Molteni had a great answer:

*   [SQL Server Automated Backups](https://stackoverflow.com/questions/493886/sql-server-automated-backups/493952#493952)

> Using Windows Scheduled Tasks:
> 
> **In the batch file**

```
"C:\Program Files\Microsoft SQL Server\100\Tools\Binn\SQLCMD.EXE" -S 
(local)\SQLExpress -i D:\dbbackups\SQLExpressBackups.sql 
```

> **In SQLExpressBackups.sql**

```
BACKUP DATABASE MyDataBase1 TO  DISK = N'D:\DBbackups\MyDataBase1.bak' 
WITH NOFORMAT, INIT,  NAME = N'MyDataBase1 Backup', SKIP, NOREWIND, NOUNLOAD,  STATS = 10

BACKUP DATABASE MyDataBase2 TO  DISK = N'D:\DBbackups\MyDataBase2.bak' 
WITH NOFORMAT, INIT,  NAME = N'MyDataBase2 Backup', SKIP, NOREWIND, NOUNLOAD,  STATS = 10

GO 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-12-28T07:47:34.723

只需使用[此](http://support.microsoft.com/kb/2019698)脚本即可动态备份服务器上的所有数据库。然后根据文章创建批处理文件。创建两个批处理文件很有用，一个用于完整备份，一个用于差异备份。然后在任务计划程序中创建两个任务，一个是完整的，一个是差异的。

```
-- // Copyright © Microsoft Corporation.  All Rights Reserved.
-- // This code released under the terms of the
-- // Microsoft Public License (MS-PL, http://opensource.org/licenses/ms-pl.html.)
USE [master] 
GO 
/****** Object:  StoredProcedure [dbo].[sp_BackupDatabases] ******/ 
SET ANSI_NULLS ON 
GO 
SET QUOTED_IDENTIFIER ON 
GO 

-- ============================================= 
-- Author: Microsoft 
-- Create date: 2010-02-06
-- Description: Backup Databases for SQLExpress
-- Parameter1: databaseName 
-- Parameter2: backupType F=full, D=differential, L=log
-- Parameter3: backup file location
-- =============================================

CREATE PROCEDURE [dbo].[sp_BackupDatabases]  
            @databaseName sysname = null,
            @backupType CHAR(1),
            @backupLocation nvarchar(200) 
AS 

       SET NOCOUNT ON; 

            DECLARE @DBs TABLE
            (
                  ID int IDENTITY PRIMARY KEY,
                  DBNAME nvarchar(500)
            )

             -- Pick out only databases which are online in case ALL databases are chosen to be backed up
             -- If specific database is chosen to be backed up only pick that out from @DBs
            INSERT INTO @DBs (DBNAME)
            SELECT Name FROM master.sys.databases
            where state=0
            AND name=@DatabaseName
            OR @DatabaseName IS NULL
            ORDER BY Name

            -- Filter out databases which do not need to backed up
            IF @backupType='F'
                  BEGIN
                  DELETE @DBs where DBNAME IN ('tempdb','Northwind','pubs','AdventureWorks')
                  END
            ELSE IF @backupType='D'
                  BEGIN
                  DELETE @DBs where DBNAME IN ('tempdb','Northwind','pubs','master','AdventureWorks')
                  END
            ELSE IF @backupType='L'
                  BEGIN
                  DELETE @DBs where DBNAME IN ('tempdb','Northwind','pubs','master','AdventureWorks')
                  END
            ELSE
                  BEGIN
                  RETURN
                  END

            -- Declare variables
            DECLARE @BackupName varchar(100)
            DECLARE @BackupFile varchar(100)
            DECLARE @DBNAME varchar(300)
            DECLARE @sqlCommand NVARCHAR(1000) 
        DECLARE @dateTime NVARCHAR(20)
            DECLARE @Loop int                  

            -- Loop through the databases one by one
            SELECT @Loop = min(ID) FROM @DBs

      WHILE @Loop IS NOT NULL
      BEGIN

-- Database Names have to be in [dbname] format since some have - or _ in their name
      SET @DBNAME = '['+(SELECT DBNAME FROM @DBs WHERE ID = @Loop)+']'

-- Set the current date and time n yyyyhhmmss format
      SET @dateTime = REPLACE(CONVERT(VARCHAR, GETDATE(),101),'/','') + '_' +  REPLACE(CONVERT(VARCHAR, GETDATE(),108),':','')  

-- Create backup filename in path\filename.extension format for full,diff and log backups
      IF @backupType = 'F'
            SET @BackupFile = @backupLocation+REPLACE(REPLACE(@DBNAME, '[',''),']','')+ '_FULL_'+ @dateTime+ '.BAK'
      ELSE IF @backupType = 'D'
            SET @BackupFile = @backupLocation+REPLACE(REPLACE(@DBNAME, '[',''),']','')+ '_DIFF_'+ @dateTime+ '.BAK'
      ELSE IF @backupType = 'L'
            SET @BackupFile = @backupLocation+REPLACE(REPLACE(@DBNAME, '[',''),']','')+ '_LOG_'+ @dateTime+ '.TRN'

-- Provide the backup a name for storing in the media
      IF @backupType = 'F'
            SET @BackupName = REPLACE(REPLACE(@DBNAME,'[',''),']','') +' full backup for '+ @dateTime
      IF @backupType = 'D'
            SET @BackupName = REPLACE(REPLACE(@DBNAME,'[',''),']','') +' differential backup for '+ @dateTime
      IF @backupType = 'L'
            SET @BackupName = REPLACE(REPLACE(@DBNAME,'[',''),']','') +' log backup for '+ @dateTime

-- Generate the dynamic SQL command to be executed

       IF @backupType = 'F' 
                  BEGIN
               SET @sqlCommand = 'BACKUP DATABASE ' +@DBNAME+  ' TO DISK = '''+@BackupFile+ ''' WITH INIT, NAME= ''' +@BackupName+''', NOSKIP, NOFORMAT'
                  END
       IF @backupType = 'D'
                  BEGIN
               SET @sqlCommand = 'BACKUP DATABASE ' +@DBNAME+  ' TO DISK = '''+@BackupFile+ ''' WITH DIFFERENTIAL, INIT, NAME= ''' +@BackupName+''', NOSKIP, NOFORMAT'        
                  END
       IF @backupType = 'L' 
                  BEGIN
               SET @sqlCommand = 'BACKUP LOG ' +@DBNAME+  ' TO DISK = '''+@BackupFile+ ''' WITH INIT, NAME= ''' +@BackupName+''', NOSKIP, NOFORMAT'        
                  END

-- Execute the generated SQL command
       EXEC(@sqlCommand)

-- Goto the next database
SELECT @Loop = min(ID) FROM @DBs where ID>@Loop

END 
```

批处理文件可能如下所示：

```
sqlcmd -S localhost\myDB -Q "EXEC sp_BackupDatabases @backupLocation='c:\Dropbox\backup\DB\', @backupType='F'"  >> c:\Dropbox\backup\DB\full.log 2>&1 
```

和

```
sqlcmd -S localhost\myDB -Q "EXEC sp_BackupDatabases @backupLocation='c:\Dropbox\backup\DB\', @backupType='D'"  >> c:\Dropbox\backup\DB\diff.log 2>&1 
```

这种方法的优点是添加新数据库或删除数据库时不需要更改任何内容，甚至不需要在脚本中列出数据库。JohnB 的回答对于具有一个数据库的服务器来说更好/更简单，这种方法更适合多数据库服务器。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-12-04T17:53:17.450

MSSQLTips 的人们有一些非常有用的文章，与此最相关的是“[自动化 SQL Server 2005 Express 备份和删除旧备份文件](http://www.mssqltips.com/tip.asp?tip=1486)”

基本方法是使用 Windows 任务计划程序设置两个任务。一项任务运行一个 TSQL 脚本，该脚本为所有 MSSQL 数据库（TEMPDB 除外）生成单独的备份文件，其中数据库名称和文件名中的日期/时间戳记到指定目录中。第二个任务运行一个 VBScript 脚本，该脚本遍历该目录并删除所有 .BAK 扩展名超过 3 天的文件。

这两个脚本**都需要**对您的环境进行少量编辑（路径、保留这些数据库转储的时间），但非常接近即插即用。

请注意，如果您对这些或目录权限马虎，则可能存在安全隐患，因为它们是纯文本文件，需要以某种级别的权限运行。不要马虎。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-28T16:21:03.523

我们使用了以下组合：

1.  用于调度/维护的[Cobian Backup](http://www.educ.umu.se/~cobian/cobianbackup.htm)

2.  [ExpressMaint](http://www.codeplex.com/ExpressMaint)用于备份

这两个都是免费的。该过程是编写 ExpressMaint 脚本以将备份作为 Cobian“备份前”事件。我通常让它覆盖以前的备份文件。然后 Cobian 从中取出一个 zip/7zip 并将它们存档到备份文件夹中。在 Cobian 中，您可以指定要保留的完整副本的数量、进行多个备份周期等。

ExpressMaint 命令语法示例：

```
expressmaint -S HOST\SQLEXPRESS -D ALL_USER -T DB -R logpath -RU WEEKS -RV 1 -B backuppath -BU HOURS -BV 3 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-03-27T06:20:57.187

您可以在服务器对象中创建一个备份设备，让我们说

> 测试

然后创建一个包含以下命令的批处理文件

```
sqlcmd -S 192.168.1.25 -E -Q "BACKUP DATABASE dbtest TO BDTEST" 
```

让我们用名字说

> 备份.bat

然后你可以打电话

> 备份.bat

根据您的方便在任务调度程序中

# json - 从输入字段设置 JSON 对象

> ID：487677
> 
> 赞同：0
> 
> 时间：2009-01-28T13:51:28.600
> 
> 标签：json

我基本上有以下流程：

XML -> JSON -> Spring MVC -> jsp 页面，显示为带有可编辑字段的表格。

如何使当我编辑字段值时正确更新 Json 对象？

我目前使用了一些令人讨厌的黑客攻击，因为我知道（测试）我将要获得的值/对象，所以我只是在 javascript 中解析 JSON 字符串并将其发送回来。

所以我可以然后转换 json 对象（使用新值）并将其发回。

干杯。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T19:39:56.707

您可以使用来自prototypejs 的序列化方法。

[http://www.prototypejs.org/api/form/serialize](http://www.prototypejs.org/api/form/serialize)

只需调用 .serialize() 您就可以获取更新的对象。

# ruby-on-rails - Ruby 的自动代码完整性检查工具

> ID：487680
> 
> 赞同：5
> 
> 时间：2009-01-28T13:52:25.837
> 
> 标签：ruby-on-rails, ruby, coding-style

您使用哪些工具进行自动代码完整性检查并遵守 Ruby 应用程序中的编码约定？您如何将它们纳入您的流程？（我指的是 roodi、reek、heckle、rcov、dcov 等工具。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-04-17T15:03:52.647

我建议看看[RuboCop](https://github.com/bbatsov/rubocop)。它是一个基于[Ruby 样式指南](https://github.com/bbatsov/rubocop)的 Ruby 代码样式检查器。它维护得非常积极，它基于标准的 Ruby 工具（如`ripper`库）。它适用于 Ruby 1.9 和 2.0，并具有出色的 Emacs 集成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T18:05:13.067

metric_fu [gem](http://github.com/jscruggs/metric_fu/tree/master)可能非常适合您的需要。来自它的 README：“Metric-fu 是一组 rake 任务，可以轻松生成指标报告。它使用 Saikuro、Flog、Rcov 和 Rails 的内置统计任务来创建一系列报告。它旨在集成通过将文件放在 Custom Build Artifacts 文件夹中，可以轻松使用 CruiseControl.rb。” 由于他们将其转换为 gem，因此它也适用于非 Rails 应用程序。我敢打赌你也可以为其他工具添加钩子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-23T09:55:23.803

最近[在 On-Ruby 博客](http://on-ruby.blogspot.com/2009/05/questions-five-ways-static-code.html)上对此主题进行了一些很好的讨论。对于我的个人开发过程，我将质量工具构建到我的测试中，但只有在所有其他测试都运行之后。所以我有一个看起来像这样的顶级 rake 任务：

```
desc 'Runs all unit tests, acceptance tests and quality checks'
task 'test' => ['test:spec', 'test:features', 'test:quality'] 
```

如果最后一个套件“失败”，我允许自己做出承诺，但我确实每天至少尝试将它们归零一次。

# .net - 如何迭代 .NET 托管堆中存在的对象？

> ID：487682
> 
> 赞同：2
> 
> 时间：2009-01-28T13:53:53.370
> 
> 标签：.net, garbage-collection

.NET API 中有没有一种方法可以迭代托管堆中存在的托管对象？

我们想在程序的某些点添加一个例程，用于检查托管堆中某些对象的存在。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T14:12:21.350

1.  安装“Windows 调试工具”。

    一种。链接： http: [//www.microsoft.com/whdc/devtools/debugging/default.mspx](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)

    湾。您将使用本机 Windows 调试器 WinDbg.EXE 和托管代码的 WinDbg 扩展 SOS.DLL（又名“罢工之子”）。

    C。默认安装位置是“C:\Program Files\Debugging Tools for Windows”。

2.  运行您的托管进程。

3.  运行 WinDbg 并单击“文件 -> 附加到进程...”

4.  从列表中选择您的流程。

5.  WinDbg 将在附加到您的进程时自动中断（停止）执行。

6.  在 WinDbg 的命令行中键入“.load sos.dll”（是的，使用前面的 '.'）以加载 Son of Strike。

7.  键入“！help”以查看Son of Strike 提供的命令/功能列表。

8.  键入“!traverseheap –xml heap.xml”将进程的堆转储到 WinDbg 目录中的 heap.xml（例如，C:\Program Files\Debugging Tools for Windows”）。

    一种。遍历堆并将其转储到文件可能需要非常非常长的时间。WinDbg 会将“ *BUSY* ”发布到其状态并打印“.”-s 以指示进度。

    湾。一般来说，heap.xml 的结构如下：

    > < 类型 ID >
    > 
    > ...
    > 
    > < 对象 >
    > 
    > 每个类（类型）都拥有一个 ID，每个对象都拥有其类型 ID、托管地址和大小。

9.  对 heap.xml 使用 findstr（命令提示符）在堆中进行 grep，并使用 WinDbg 转储对象。

    一种。示例：查找 DataTable 类的类型 ID。

    *   findstr "DataTable" heap.xml

        > 输出：< type id="1002" name="System.Data.DataTable"/>

    湾。示例：查找所有 DataTable 对象。

    *   findstr "typeid=\"1002\"" heap.xml

        > 输出：<对象地址="0x0137ECD8" typeid="1002" size="296" >

    C。示例：转储 DataTable 对象。

    *   （在 WinDbg 中）！dumpobj 0137ecd8

    d。示例：转储成员对象。成员对象的地址存储在成员的包含对象转储的“值”字段中。

    *   !dumpobj < "值" >

> .

添加，如果你想跟踪大对象分配，这里是如何在 LOH 分配上中断 CLR。中断时，按“k”查看调用堆栈。

运行 WinDbg 并附加如下。

1.  将微软的符号服务器添加到符号路径中：
    *   .sympath srv *c:\windows\symbols* [http://msdl.microsoft.com/download/symbols](http://msdl.microsoft.com/download/symbols)
2.  重新加载符号：
    *   .reload
3.  重新加载运行时 shim：
    *   .reload /f mscorwks.dll
4.  打破 UP 分配：
    *   bp mscorwks!WKS::gc_heap::allocate_large_object
5.  中断 MP 分配：
    *   bp mscorwks!SVR::gc_heap::allocate_large_object
6.  确认断点：
    *   bl
7.  恢复：
    *   G

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-28T13:57:36.997

您需要使用[调试/分析 API](http://msdn.microsoft.com/en-us/magazine/cc188781.aspx)来执行此操作 - 我不建议将其用于“普通”应用程序。

# asp.net - .net Ajax - 在更新时隐藏内容

> ID：487684
> 
> 赞同：0
> 
> 时间：2009-01-28T13:54:11.467
> 
> 标签：asp.net, ajax, updatepanel

我在一个页面上有许多 asp.net AJAX 更新面板，可以独立刷新。我希望它在使用刷新按钮时隐藏面板中的内容，并且在获取数据时仅显示加载图像（从服务器返回数据需要 5-10 秒）。实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T14:08:11.030

您可以使用 JavaScript 在 RequestHandler 的开始和结束函数上隐藏/显示面板：

```
var panel = new Sys.UI.Control($get("myUpdatePanel"));

function beginRequestHandler(sender, args) {            
    panel.set_visible(false); 
}

function endRequestHandler(sender, args) {
    panel.set_visible(true); 
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T14:06:17.697

加载图像是否与更新面板放置在同一位置？

如果是这样的话，只需让加载面板覆盖整个更新面板。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T14:07:48.567

加载时使用 CSS 将“display”属性设置为 none，并在从 AJAX 面板返回值时将其设置回“inline”或“block”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T14:12:25.187

```
<div class="overlay">
<img src="/...." alt="Loading" />
<div class="your_content">

</div>
</div> 
```

您可以在完成事件后将 your_content 的 z-index 设置为小于覆盖 z-index 的值，您可以将所有值设置为默认范围。

# visual-studio-2008 - Team System 开发版无法识别项目类型

> ID：487692
> 
> 赞同：0
> 
> 时间：2009-01-28T13:55:51.790
> 
> 标签：visual-studio-2008, tfs

我目前使用 VS 2008 Professional，但我正在尝试让 Team System Developer Edition 在虚拟机中工作以对其进行评估。但是，当我尝试打开我当前的任何解决方案时，它会给我以下消息：

无法打开“Z:\Samples\ChartControl\WebSamples”，因为此版本的 Visual Studio 不支持其项目类型 ()。

知道这想告诉我什么吗？为什么无法识别项目类型？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T15:04:12.667

这可能是因为您的 Visual Studio 上有未包含在 TFS 构建中的额外项目类型。一个例子是 MVC 项目类型。为什么要在 TFS 中打开项目？TFS 应该只是源代码控制、错误列表和构建服务器，而不是在 Visual Studio 中处理项目

还要检查 TFS 是否与您的开发环境处于相同的 .NET 版本。如果要从 .NET 3.5 SP1 项目创建自动构建，请确保 TFS 处于同一级别。

# sql-server - 2 层是否是这种情况的有效选择

> ID：487705
> 
> 赞同：0
> 
> 时间：2009-01-28T14:00:59.487
> 
> 标签：sql-server, database, architecture, 2-tier

对于这种情况，2 层是否是一个有效的选择：

1.  sql server 数据库
2.  业务永远不会需要超过几百个通过 LAN 连接到共享数据库的同时连接
3.  事实上（我相信）开发 2 层应用程序的工作量要少得多
4.  通过 LAN 自动更新客户端程序

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T14:23:54.510

2 层解决方案可能更容易开发，但如果应用程序具有任何规模和/或复杂性，则将更难维护。

如果这个应用程序对业务很重要并且在很长一段时间内到位，我认为您会发现花费在将您的表示、业务逻辑和数据访问分离到它们自己的层中的额外时间将在它得到回报时得到回报是时候修复问题、更改逻辑或扩展应用程序了。

这是您可能会得到与答案一样多的不同意见的问题之一。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T14:32:30.763

一开始可能更容易开发，但我也认为，如果项目不是仅供内部使用的微不足道的工具，那么从长远来看，这会让你付出代价。

您是否需要 3 层应该取决于您要维护项目多长时间以及您稍后计划为它计划多少功能/更新。它还可能取决于您愿意接受（并修复）多少错误。IMO 3 层倾向于创建更稳定的软件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T23:14:12.640

这两个答案似乎几乎都在说 3 层是优越的解决方案是不言而喻的。也许

[Rockford lhotka](http://www.lhotka.net/weblog/ShouldAllAppsBeNtier.aspx)似乎在争论您应该选择 2 层，除非您的特定情况的成本效益分析支持 3 层。

他说 ：

> 作为一名优秀的架构师，您应该被拖着大喊大叫地为您的系统添加层级。

他认为安全性是唯一明显优于 3 层解决方案的领域。

他认为

> 更糟糕的是，边界增加了软件设计、网络基础设施、系统的可管理性和整体可维护性的原始复杂性。简而言之，应用程序中的层越多，处理的复杂性就越高——这直接增加了构建和维护应用程序的成本。

最后，关于可扩展性，我想知道，如果您在 ado 中使用断开连接的记录集进行数据访问，那么您是否默认拥有连接池，因此无论如何都具有高度的可扩展性？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T20:41:53.767

抄自 Charles Williams 的《Professional Visual Basic 6 Databases》一书：-

> 2 层与 N 层
> 
> 在 2 层和 n 层模型之间进行选择似乎是人们的想法。等式中有很多变量（包括偏好），没有一本书可以确定您的客户端-服务器模型的最佳结构。其中一些变量可以包括：
> 
> > 您选择的数据库服务器的灵活性和功能。今天的数据库服务器能够处理数百甚至数千个并发连接，而​​无需迁移到 3 层架构。
> > 
> > 容纳服务器的 CPU 的强大功能和多功能性。CPU 越强大，服务器处理请求的任务就越快。
> > 
> > 有多少吞吐量正在运行到服务器中，以及存在多少连续连接。您可能有很少或很多连接，每个连接可能会传递很少或很多请求。
> > 
> > 经济因素。你愿意在你的系统上花多少钱。通常，n 层系统的开发和维护成本更高。如果您可以使用 2 层解决方案，您可以节省大量资金。

对我来说，这似乎表明除非您正在开发（非常流行的）基于 Web 的应用程序，否则 2 层可能是更合乎逻辑的选择。

# jsp - JSP中是否有等效于java @SuppressWarnings

> ID：487715
> 
> 赞同：10
> 
> 时间：2009-01-28T14:03:13.570
> 
> 标签：jsp, warnings

问题在标题中：“JSP 中是否有与 java @SuppressWarnings 等效的东西？”

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-10-22T17:30:26.927

是的，只需使用：

```
<%! @SuppressWarnings("unchecked") %> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T14:22:17.603

如果您在从 JSP 生成的代码中（或在 JSP 中的内联代码中）收到警告，一种解决方案是将问题代码移到 Servlet 或实用程序类中。这样您就可以随心所欲地标记它，并且您的 JSP 中的 Java 代码更少。双赢！

# c# - 在不在根文件夹中的文件中使用在 Web.Config 中注册的程序集

> ID：487719
> 
> 赞同：0
> 
> 时间：2009-01-28T14:03:55.907
> 
> 标签：c#, asp.net, visual-studio-2008, web-config

我在 web.config 文件中注册了一个控件，并且该控件的 .dll 已放置在应用程序的 Bin 文件夹中。

```
 <compilation debug="true">
        <assemblies>
            <add assembly="System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
            <add assembly="RichTextEditor"/>
        </assemblies>

    </compilation>
    <pages>
        <controls>
            <add assembly="RichTextEditor" namespace="RichTextEditor" tagPrefix="cc1" />
        </controls>
    </pages> 
```

我现在可以在应用程序根文件夹的 .aspx 页面中使用此控件而不会出现问题。但是，我想在其中使用此控件的一些 .aspx 页面存储在应用程序的子文件夹中（在本例中为名为“Admin”的子文件夹）。当我尝试在这些页面中使用这些控件并在调试中运行时，我收到以下错误：

```
Error   1   Unknown server tag 'cc1:RichTextEditor'.    N:\IntranetV2\admin\EditMenuItem.aspx   27 
```

我确定我在这里遗漏了一些简单的东西，但我似乎无法弄清楚如何让这个工作和谷歌搜索似乎没有多大帮助。

更新：

好的，我尝试了 Aaron 的解决方案，但没有成功，我将他的代码建议修改为：

```
<add tagPrefix="cc1" tagName="RichTextEditor" src="~/Bin/RichTextEditor.dll" /> 
```

我希望这就是所需要的，但是我现在得到了错误：

```
Error   1   There is no build provider registered for the extension '.dll'. You can register one in the <compilation><buildProviders> section in machine.config or web.config. Make sure is has a BuildProviderAppliesToAttribute attribute which includes the value 'Web' or 'All'. 
```

请有人帮忙！我知道这个问题的答案一定非常简单，但我想自己修复它会发疯，而谷歌证明没有帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T15:07:03.300

不久前我遇到了一些类似的问题。我能够使控件正常工作的唯一方法是这样的：

```
<add tagPrefix="cc1" tagName="RichTextEditor" src="~/controls/richtexteditor.ascx"> 
```

而不是这个：

```
<add assembly="RichTextEditor" namespace="RichTextEditor" tagPrefix="cc1" /> 
```

**编辑：**

由于您使用的是二进制文件，请将 .dll 添加到您的解决方案中，并在您使用它的项目中添加对它的引用。这样，.NET 会将 .dll 添加到您的 bin 文件夹中。然后，回到这个（并验证命名空间和程序集是否正确）：

```
<add assembly="RichTextEditor" namespace="RichTextEditor" tagPrefix="cc1" /> 
```

另外，请查看此作为参考：[提示/技巧：如何在 Web.config 中注册用户控件和自定义控件](http://weblogs.asp.net/scottgu/archive/2006/11/26/tip-trick-how-to-register-user-controls-and-custom-controls-in-web-config.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T14:46:49.410

该文件夹是否定义为 IIS 中的应用程序？这将导致这样的问题，因为在这种情况下，IIS 将在该子文件夹中查找 web.config（以及 bin/ 和其他特殊文件和文件夹）。

# asp.net - 自定义 ClickOnce 应用程序的默认网页

> ID：487725
> 
> 赞同：-1
> 
> 时间：2009-01-28T14:06:31.067
> 
> 标签：asp.net, vb.net, deployment, clickonce

桑德，为此写了一篇相关的文章......

[http://todotnet.com/archive/2005/10/11/2595.aspx](http://todotnet.com/archive/2005/10/11/2595.aspx)

不幸的是，代码在 C# 中。

哪个是 vb.net 版本的等价物？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T14:16:53.277

使用[http://www.developerfusion.com/tools/convert/csharp-to-vb/转换](http://www.developerfusion.com/tools/convert/csharp-to-vb/)

```
Imports System.Net
Imports System.Xml.Xsl  
Imports System.Net

Dim request As HttpWebRequest = DirectCast(HttpWebRequest.Create("...url to the original publish.htm file..."), HttpWebRequest)
Dim response As HttpWebResponse = DirectCast(request.GetResponse(), HttpWebResponse)
Dim dataStream As Stream = response.GetResponseStream()
Dim reader As New StreamReader(dataStream)
Dim responseFromServer As String = reader.ReadToEnd()

responseFromServer = responseFromServer.Replace(" ", " ")

Dim xml As New System.Xml.XmlDocument()
xml.LoadXml(responseFromServer)

Dim xslt As New XslCompiledTransform()
Dim html As TextWriter = New StringWriter()
xslt.Load(Server.MapPath("CustomPublish.xsl"))
xslt.Transform(xml, Nothing, html)

Response.Write(html.ToString())
Response.[End]() 
```

让我知道它是否有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T11:38:31.853

```
Response.Write(html.ToString()) 
```

大写。

请评论[答案](https://stackoverflow.com/questions/487725/customize-the-default-web-page-for-a-clickonce-application/487767#487767)并检查最佳答案，以便我们保持联系。

# php - 查询字符串和 Mod 重写

> ID：487726
> 
> 赞同：3
> 
> 时间：2009-01-28T14:06:48.880
> 
> 标签：php, apache, .htaccess, mod-rewrite, url-rewriting

我对 ReWrite 并不太缺乏经验（不过也不是大师），所以我希望有人能帮助我。

```
RewriteRule ^$ index.php?page=home [NC]
RewriteRule ^adm$ index.php?page=adm_home [NC]
RewriteRule ^adm/stats index.php?page=adm_stats [NC] 
```

以上是我的 .htaccess 文件的片段。如您所见，当有人访问[http://www.example.com/adirectory/](http://www.example.com/adirectory/)它实际上调用 index.php?page=home，如果有人访问[http://www.example.com/adirectory/adm /](http://www.example.com/adirectory/adm/)它仍然会在“adirectory”中调用 index.php?page=adm_home。

我想要实现的是：我希望能够在我的页面上显示警报，为此我只想能够添加 alert=n （其中 n 是一个数字），因此重定向为index.php?page=home&alert=n

但是，我无法理解如何做到这一点，正则表达式让我感到困惑。寻求你的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T14:15:45.727

您可以设置[QSA 标志](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewriteflags)以自动将最初请求的查询字符串附加到新的查询字符串：

```
RewriteRule ^$ index.php?page=home [L,QSA]
RewriteRule ^adm$ index.php?page=adm_home [L,QSA]
RewriteRule ^adm/stats$ index.php?page=adm_stats [L,QSA] 
```

# oop - 有多少个对象太多了？

> ID：487728
> 
> 赞同：11
> 
> 时间：2009-01-28T14:06:59.537
> 
> 标签：oop

在设计应用程序时，是否会出现对象过多的情况？您如何确定何时越过了对象模型中的粒度线？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T14:10:11.043

当你想知道“为什么这是一个物体？”

我最近有一个“BetForgetter”类，我在另一个类中将其重构为两行代码。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-28T14:35:58.650

我假设您在谈论类型而不是对象（我知道它被称为对象模型，但它确实是所涉及类型的模型）。

无论如何，如果您遵守单一职责原则，即每种类型只应处理单一职责，则类型的数量将随着应用程序的增长而增长。

但是，由于其大小有限，每种类型都应该相当容易理解，并且假设您有某种结构，您应该很少（如果有的话）需要一次查看所有类型。

管理大型软件项目就是将事物分解成可管理的部分并以合理的方式标记它们。如果你这样做，根据我的经验，类型的数量就变得不那么重要了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T14:26:32.883

这**可能是另一个问题的征兆**。

恕我直言，只要您有良好的项目、名称空间和/或目录组织，以及合理的命名约定，您应该能够轻松处理任意数量的类。

PS-我假设您在说“对象”时是指“类”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-28T14:11:14.753

我不确定整个项目范围内的答案是什么，但我通常可以说，如果两个类过于依赖彼此，它们作为一个类可能会更好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-28T14:13:40.740

没有硬性规定，但很大程度上取决于程序员的判断。
但作为一般的经验法则，如果你浪费时间编写类到最小的操作，那么这对很多......而且很复杂。如果您编写大量代码，那就太少了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T14:11:40.913

不仅*对象*太多，而且*复杂性太高*，当我在休息一天后阅读我的代码时感到迷失方向时，我发现了这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T14:12:38.183

我会说您可能应该更多地担心对象/类太少。[SRP](http://en.wikipedia.org/wiki/Single_responsibility_principle)是值得坚持的，因为它通常会导致代码更清晰、更易读。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T14:16:14.383

我认为不知道你的问题就不可能回答你的问题。

这在很大程度上取决于您尝试使用应用程序解决的问题。

**Iraimbilanja**是绝对正确的。如果您开始为遇到的所有事物创建对象，您很快就会想知道您可以为它们提供什么用途，以及您为什么要花时间创建它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-28T14:33:32.027

你永远不会有太多的，问问任何一个体面的 Java 程序员。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-28T15:34:26.817

一个具有适当 OO 设计的项目，具有数百个对象，其状态比具有较少的单一类的项目要好得多。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-28T16:13:56.097

一段绳子有多长？（从中间到末端的长度是两倍，但这不是重点）

我认为这真的取决于你在写什么以及你是如何写的。对象的数量是一个不好的度量标准，您应该担心对象模型的复杂性而不是您拥有多少对象。您的对象的耦合程度如何是您需要询问的。

如果您有 100 个不同类型的 Bird 对象，所有这些对象都实现了一个接口，并且共享方法在一个抽象类中，那么您就没有太多的对象，因为您可能需要每个 Bird 以不同的方式行动。

但是，如果您有一堆都实现相同代码的对象，那么您的对象太多，可以重构为更少。

同样，如果您有一个包含许多不同功能的大型类，那么您的类太少了。

除非你有做同样事情的类或者复制框架中其他类已经做的事情，否则你没问题。

请记住，仅仅因为您可以使用继承并不意味着您必须这样做，组合通常更好。

# web-applications - Web 可用性 - 数据列表和对数据行的操作

> ID：487730
> 
> 赞同：1
> 
> 时间：2009-01-28T14:07:19.660
> 
> 标签：web-applications, user-interface, usability, databound-lists

如果您有一个数据绑定的项目列表，并且对于每个项目，您可能希望为用户提供以下能力（例如）：

*   删除
*   下载
*   查看详细
*   或以某种方式“标记”

你有几个选择：

*   提供行本身内的按钮或链接，完成对行项的操作
*   在行内提供复选框选择，然后提供对一组选定项目执行操作的方法
*   以上的组合（某些操作 - 例如“查看详细信息” - 不适用于分组选择方法）

人们认为提供这种交互的最有用的方法是什么？

指向“可用”列表示例的链接会很好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T14:12:53.067

我的意见：这取决于此表中显示的数据。

如果我真的需要对多个元素执行一项操作，例如删除 10 个元素，我希望复选框带有全局按钮选项。在链接上单击 10 次来执行此操作确实对用户不友好。

所以，也许复选框和链接的组合是一个不错的选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T14:15:58.193

我遇到过的最佳可用列表：gmail

我会选择你提到的混合方法。如果操作是特定于项目的（查看详细信息）或非常常见，则在行本身内提供按钮或链接。否则提供您建议的复选框功能。

phpMyAdmin 的大部分操作仅依赖于复选框功能，我总是对删除一行所需的点击次数感到恼火。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T18:35:03.753

只需三四个命令，您就可以将所有命令都作为按钮和链接放在每一行中。这为用户提供了一种快速执行单行命令的方法——每个操作一次单击——而替代选择操作模型需要两次单击。不过也有一些考虑。

*   选择动作可能更适合在多行上执行相同的动作。如果其中一些操作导致延迟（例如，删除后需要一两秒刷新表）或对话框（例如，下载，用户必须指定要下载到的本地文件夹），选择-允许用户多选一堆项目并一次处理它们，动作更快。

*   虽然您现在只有几个命令，但请考虑在未来版本或应用程序的其他页面中可能有多少命令（例如，插入新的、剪切、复制、粘贴）。你想在内部保持一致。五个或更多命令的重复控件行可能过于混乱。

如果您使用选择操作，您应该实现其他交互功能以使其真正运作良好。

*   不要使用复选框，这可能会与记录属性混淆，而不是选中状态。使用整行或行图标的突出显示来指示选择。

*   通过 ctrl 单击、shift 单击和拖动选择框支持多选（后两者允许选择操作比多个项目的行内控件更快）。请注意，一些用户不知道这些约定，因此如果多选是非高级用户需要执行的通常工作流程的一部分，请考虑完全不同的 UI。

*   支持快捷方式，例如使用删除键删除记录和包含所有操作的右键单击上下文菜单。

至于将行内与选择操作相结合，在任何情况下，行中的控件都可以支持查看详细信息，方法是将记录的功能标识符变成一个链接（只要不需要编辑标识符），或者允许用户双击记录图标（后者是专家激活，应该是多余的按钮）。

我不清楚“标记”是什么意思。立个flag？这听起来像是记录的属性。无论您对其余操作使用选择操作还是行内操作，这意味着应该使用表格行中的复选框之类的控件来完成标记，以便用户可以查看和设置值。

# php - 从 php 中的 url 存储图像的最佳方法？

> ID：487734
> 
> 赞同：2
> 
> 时间：2009-01-28T14:08:31.310
> 
> 标签：php

我想知道从 php 中的 URL 保存图像的最佳方法。

目前我正在使用

```
file_put_contents($pk, file_get_contents($PIC_URL)); 
```

这并不理想。我无法使用卷曲。有没有专门针对这个的方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-28T14:11:20.510

使用 file_get_contents 很好，除非文件非常大。在这种情况下，您实际上不需要将整个内容保存在内存中。

对于大型检索，您可以[打开](http://php.net/fopen)远程文件，一次读取[32KB](http://php.net/fread)，然后在[本地](http://php.net/fwrite)循环写入，直到读取所有文件。

例如：

```
$fout = fopen('/tmp/verylarge.jpeg', 'w');
$fin = fopen("http://www.example.com/verylarge.jpeg", "rb");
while (!feof($fin)) {
    $buffer= fread($fin, 32*1024);
    fwrite($fout,$buffer);
}
fclose($fin);
fclose($fout); 
```

（为简单起见，没有错误检查！）

或者，您可以放弃使用[url 包装器](http://uk.php.net/manual/en/wrappers.php)并使用 PEAR 的[HTTP_Request之类的类，或者使用](http://pear.php.net/manual/en/package.http.http-request.php)[fsockopen](http://php.net/fsockopen)等滚动您自己的 HTTP 客户端代码。如果您正在维护缓存，这将使您能够执行有效的操作，例如发送[If-Modified-Since](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.25)标头远程文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T14:33:04.787

我建议使用 Paul Dixon 的策略，但将 fopen 替换为[fsockopen()](http://www.php.net/manual/en/function.fsockopen.php)。原因是某些服务器配置不允许 fopen() 和 file_get_contents() 访问 URL。该设置可以在 php.ini 中找到，名为 allow_url_fopen。

# visual-studio - 将 Visual Studio 2005 与 ClearCase Eclipsed 文件一起使用

> ID：487737
> 
> 赞同：1
> 
> 时间：2009-01-28T14:10:14.537
> 
> 标签：visual-studio, clearcase

我正在尝试将 Visual Studio 2005 与 ClearCase eclipse 文件一起使用（查看私有的“eclipse”版本文件），但是任何时候我将文件保存在 VS 中，它都会变得不黯淡，并返回到版本文件。在 Linux 中，我使用 VIM 而不是 Visual Studio，并通过设置 backupcopy=yes 来解决此问题，从而强制它通过写入新文件然后将新文件复制到现有文件来保存文件，而不是移动原始文件将文件移开（撤消 Eclipse），然后编写一个新文件，但在 Windows 中，我想使用 Visual Studio（因为树还包括在 VS 下编译的 C# 代码）。有没有办法教它以这种方式保存文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T16:34:12.047

我认为 Visual Studio 不会以特定方式保存文件，这可能会导致文件先被删除，然后再写入。

考虑到这一点，在开发人员的环境中，如带有 Visual Studio 的 Windows，通常仅通过编写区分大小写的文件，然后再不区分大小写，就会发生重叠文件。
因此，您是否检查了文件的大小写？

您还可以检查与您的 Windows 视图关联的配置规范吗？（并将其与您的 Linux 视图进行比较）。

* * *

我只花了 1/2 小时使用 Visual Studio 2005 / ClearCase / 动态视图，然后……我确实看到了同样的东西！

我能理解的唯一解决方法是添加一个非选择规则：

```
element /my/private/file -none 
```

这样，即使 VS2005 在保存时删除然后添加私有文件，ClearCase 也不会尝试恢复版本化文件，因为它根本没有被选中。

Si，答案可能不在 VS2005 中（我研究了这些选项，但没有看到任何明显的设置会改变保存过程......），而是在 ClearCase 中。

让我知道它是否有帮助。

* * *

正如评论中所指出的，这种方法的缺点是“un-eclipse”不再是移动/删除私有文件以让 ClearCase 动态恢复版本化文件的问题。

现在，该步骤必须补充另一个步骤，即在配置规范中注释非选择规则。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-25T18:39:26.187

如果有人还在阅读这篇文章……我刚刚发现 Visual Studio 2008 似乎工作得很好。去搞清楚...

# security - 苔藓杀毒软件

> ID：487739
> 
> 赞同：0
> 
> 时间：2009-01-28T14:10:32.883
> 
> 标签：security, sharepoint, moss, antivirus

我们的服务器已经启用了带有自动保护功能的语义防病毒软件，并定期扫描和更新。我对其进行了测试，它确实会自动将上传的文件扫描到文档库。

我的问题是，使用特定的防病毒插件而不是当前的设置有什么额外的好处？我可以找到至少 3 个不同的插件，其中一个来自 symantic、avg 和 microsoft。尽管我猜它可能会在 MOSS 中添加“扫描此文件”链接，但没有一个产品描述真正说明它的作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T17:21:52.777

您可能需要特定的 SharePoint 防病毒解决方案的原因是为了在 SharePoint 列表中进行扫描。例如，传统的病毒扫描程序无法扫描文档库和附件中的列表项。

如果您的 MOSS 解决方案的每个用户在他们的桌面上都安装了防病毒软件，这*可能有点过头了，因为这些软件会在从 SharePoint 打开 Word 文档时对其进行扫描。*尽管如此，有一个论点是在您的服务器上安装不同供应商的反病毒产品作为额外的保护（例如，一个产品的扫描启发式可能有点不同，或者它的病毒签名可能更旧）。

您需要权衡成本/收益比，并询问您的公司对安全性的重视程度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T14:25:19.373

对于 MOSS，您是指 Microsoft Office Sharepoint Server？

无论如何：您的情况下的防病毒软件依赖于签名；简单地说，如果文件与签名匹配，它就会将文件识别为受感染。我猜这些插件对文档中的宏或不同的 GUI 有不同的功能集......应该没有那么大的区别。

# testing - 测试复选框单击

> ID：487741
> 
> 赞同：2
> 
> 时间：2009-01-28T14:11:14.690
> 
> 标签：testing, qunit

我已经开始使用 qUnit 测试我的 UI，所以我需要模拟一些用户交互。是否可以“模拟”用户使用 javascript 单击复选框？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T14:38:04.683

谢谢各位。在我发布问题后大约两秒钟，我想通了。正如你所说，比我想象的要简单

```
document.getElementById('cb1').click(); 
```

成功了

编辑：似乎在 IE7（可能还有其他浏览器）中，单击方法实际上不会选中复选框。因此，要完全模拟，您需要在单击之前“选中”复选框

```
document.getElementById('cb1').checked=true
document.getElementById('cb1').click(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T14:28:39.180

你可以看看这个：

[通过javascript模拟buttonclick](http://www.randomsnippets.com/2008/03/05/simulate-a-button-click-via-javascript/)

这是另一种方式，所以我不确定它是否也适用于复选框。

# git - 如何在 Git 中实现部署分支

> ID：487753
> 
> 赞同：22
> 
> 时间：2009-01-28T14:13:38.010
> 
> 标签：git, deployment, branch

我正在将 git 用于 PHP 项目，我认为它真的很方便。如果我让它发挥作用，有一件事会很棒。

我创建了一个分支，用于部署。它有一些差异，例如不同的配置文件和文档。

我不能忽略它们，因为那样它们将保留在两个分支中，而我想让它们在两个分支中保持不同。

问题是当我合并分支时，那些本来应该不同的文件也被合并了。

有没有方便的方法来完成这样的事情？这通常是如何完成的？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-28T14:23:05.243

2021 年 2 月更新：Git 本身仍然不太合适，但[GitHub Action 环境可以提供帮助](https://stackoverflow.com/a/66248867/6309)。

2009：我不确定 Git 是否应该以这种方式使用。

首先是一个快速的[Linus 建议](http://www.gelato.unsw.edu.au/archives/git/0701/37960.html)，总是“丰富多彩”且内容丰富；）

> Git从根本上跟踪项目状态，而不是文件状态*。*这意味着您不能尝试“合并文件”。这是 git 中的一个毫无意义的操作，事实上，任何允许它的 SCM 都注定是一个彻头彻尾的 sh*t (*)。
> 
> (*) 我并不是因为 git 不这样做而这么说。它比这更根本。一旦你开始进行每个文件的分支和合并，你基本上就搞砸了，你将永远无法将项目作为一个“整个项目”来工作——你不再有一个定义明确的历史，实际上是整个项目的历史。

* * *

那里。

也就是说，您可以：

*   管理那些 config/doc 文件单独的 git 子项目（注意：[子模块的使用已在此处讨论](http://markmail.org/message/emzectaqyfdeqmeu)）
*   或记录部分合并（对我们不想合并的文件使用“我们的”策略），然后 --amend 它。

* * *

此线程中的其他解决方案涉及在部署服务器上处理“特定于服务器”的分支

```
Development        Deployment

#origin/master:
x--x               $ git clone

                   # master
                   x--x

                   $ git checkout -b deployment origin/master

                   x--x
                       \ 
                        -- #deployment

                   $ .... #makes changes for config files
                          #or other specific deployment files

                   x--x
                       \
                        --d1--d2 # no need to push that branch ever.

#new developments
x--x--x--x

                   $ git pull --rebase #pull origin/master and 
                                       #replay current branch on top of it
                   x--x--x--x
                             \
                              --d1'--d2' #SHA1 rewritten in deployment branch
                                         #not important since this branch 
                                         #is not pushed (published) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-29T21:32:55.387

我做了一些愚蠢的把戏，比如：

*   让应用程序读取文件`config`
*   添加`config.development`和`config.production`但不添加`config`到存储库
*   让您的部署脚本不仅克隆存储库，而且还克隆存储库`cp config.production config`

这有任何意义吗？

它对我来说没问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-07-31T23:00:01.483

这对我有用，我只对部署进行了较小的配置更改（配置文件中的 3 行）。

1.  从 GitHub 或您保存它的任何地方克隆您的存储库。到您希望部署的位置。

2.  运行`git checkout -b deployment origin/master`。

3.  进行更改（如果您愿意，请推动它们）。

4.  每当您的 master（或您进行部署的任何分支）有您想要部署的更改时，只需`git pull --rebase`.

这是一个简单的解决方案，它肯定对我有用，我不能说它是否像其他人建议的那样使它“shi*t”，但它肯定对我们的目的非常有用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-28T14:17:18.063

快速回答是，永远不要合并分支。事实上，您根本不需要合并它们，只需从开发（又名“主”）合并到部署以合并修复和通用更改。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-28T17:48:05.940

如果您想保持历史记录良好，可以将部署文件保存在干净分支之上的一些提交中。然后，当需要部署新版本时，检查部署分支和“git rebase master”，将这些提交放在原始分支之上。

这样，您还可以轻松更改配置文件，并使用“git commit --amend”更改顶部提交。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-23T13:58:54.617

我之前提到过补丁文件。我现在已经取消了这个，而是维护部署分支。

即，我使用一个名为“master-deployed”的新分支从 master 分支，并在该分支上进行更改，我只需要在构建服务器上的测试版本中进行更改（即添加一个警告，表明这不是实时版本，和 web.config 中的不同数据库服务器）。

构建前沿版本时的构建服务器然后检查 master-deployed，并在执行通常的构建之前将其重新定位到 origin/master。如果没有人做出任何有冲突的更改，那么一切都很好。如果他们有，那么我看不到任何系统在没有人工干预的情况下处理这个问题。

qa 的提示也是如此，它有一个分支'qa-deployed'

我使用 --onto 标志来确保如果整个分支被重写，那么补丁不会使用它所有的旧提交。

所以在构建服务器上，qa 构建看起来像

```
git reset --hard
git clean -xfd
git checkout -f qa-deployed
git rebase --onto qa HEAD^ qa-deployed
build-script 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-31T19:47:02.387

我遇到了类似的问题，并创建了一个名为 config-magic 的小项目来帮助管理它。

Config-magic 允许您创建模板 conf 文件，然后为每个 dev/staging/production 创建数据配置文件。然后运行“cfg dev”来生成“dev”配置文件，“cfg staging”来生成登台配置等。

然后我将它与脚本连接起来，这样当我部署到登台时，我在本地运行“cfg 登台”，然后在从 git 更新代码库后对所有配置文件进行 scp。

“实际”配置文件设置为被 git 忽略。到目前为止，这对我来说非常有效。

[https://github.com/apinstein/config-magic/tree](https://github.com/apinstein/config-magic/tree)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-18T02:27:57.577

我正在考虑针对我的情况的所有这些解决方案，但似乎没有一个适用。我在我的实时服务器和开发服务器上进行编辑。如果您不需要重新发布该分支，Rebase 效果很好，但是我在我的部署分支上进行了更改并将这些更改发布回主存储库。仅当您的文件位于单独的子目录中时，子模块方式才有效，我的配置文件位于多个位置。合并我们的方法也不能很好地工作，因为我必须先拉那个分支，然后再拉大分支。如果仍然有他们的合并可能会起作用，并且我可以在需要时拉入正确的配置分支。现在 .gitignore 有效，我只是手动上传文件。

在做了更多研究之后，我发现我的解决方案是在实时站点上没有 git repo，而是使用暂存站点通过暂存/实时配置文件将最新更改拉入我的分支。然后通过 git archive 部署并将文件提取到我的实时站点上。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-12-22T00:54:06.947

cherry-pick 似乎为此工作（以稍微污染日志为代价）。

git checkout -b testing 进行更改并提交 git checkout master git checkout -b deploy 进行更改并提交 git checkout master

在 master 和 git cherry-pick testing 或 git cherry-pick deploy 下执行所有操作，以应用从当前系统切换到测试或部署版本所需的差异。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T21:25:44.030

目前我签入了几个补丁文件，构建服务器将这些补丁应用于相关版本。虽然我现在对此有第二个想法

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-04-03T02:38:27.263

这既简单又干净。

您将创建一个部署分支，例如：

```
> git checkout deployment-1234 
```

现在，您可以进行特定于部署的更改。完成后，提交它：

```
> git commit -as 
```

回到你的主分支。

```
> git checkout master 
```

立即合并部署分支。这将使用那些特定于部署的更改来修改您的主分支，但不要担心，我们会还原它。

```
> git merge --no-ff deployment-1234 
```

要恢复更改，只需在合并前签出文件并修改提交即可。

```
> git checkout HEAD^ .
> git commit --amend 
```

就是这样。现在git将deployment-1234的第一次提交中的文件更改视为master已经考虑并发现不合适。因此，即使您尝试将整个 deployment-1234 分支合并到 master，它也永远不会将这些更改添加到 master 分支。（尝试一下！）

我还在需要更好控制的项目中使用了另一种方法。上述不利之处在于，您可能会在未来从部署 1234 合并到 master 期间产生冲突。如果这些合并是手动的，那没关系。但是如果你需要自动合并，我最好能防止这种系统冲突。因此，我创建了一个脚本，可以应用和撤消特定于部署的更改。然后更改本身不需要在存储库中，而是出现在存储库中的是该脚本。

# sql - 编程语言中的 SQL CASE 语句与条件语句

> ID：487770
> 
> 赞同：1
> 
> 时间：2009-01-28T14:17:18.347
> 
> 标签：sql, language-agnostic

我在工作中经历了一些旧的存储过程，并且不断遇到

```
CASE MyColumn WHEN 'Y' THEN 'Yes' WHEN 'N' THEN 'No' ELSE 'Unknown' END 
```

当这不是与一个词联系在一起，而是与一种颜色联系在一起时，情况会变得更糟。

```
CASE MyColumn WHEN 'Y' THEN 'style="background-color:pink"' ELSE '' END 
```

这样做的原因是针对旧的 ASP 1 页面，其中所有内容都必须内联完成，但由于它是一个如此大的系统，不可能跟上所有页面的更新。

任何人都可以提供任何有效的证据证明使用条件语句的 SQL 查询优于 C# 或 Java 等其他语言吗？这是提高速度的好习惯吗？是否应该返回纯值并由表示层决定应该做什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T14:25:45.643

当速度至关重要时，SQL 案例语句甚至可能是最快的（我将运行一个测试），但为了可维护性，将纯值返回到表示层（或某些业务层的东西）是最好的选择。

[更新] 运行了一些快速而肮脏的测试（下面的代码），发现 C# 代码变体比 SQL 案例变体稍快。结论：返回“原始”数据并在表示层中对其进行操作既更快又更易于维护。

-Edoode

我用下面的查询检索了 196288 行。

```
StringBuilder result = new StringBuilder();
using (SqlConnection conn = new SqlConnection(Settings.Default.Conn))
{                
    conn.Open();
    string cmd = "select [state], case [state] when 'ca' then 'california' else [state] end from member";
    SqlCommand command = new SqlCommand(cmd, conn);
    using (SqlDataReader reader = command.ExecuteReader(CommandBehavior.CloseConnection))
    {
        while (reader.Read())
        {                        
            result.AppendLine(reader.GetString(1));
        }
    }
} 
```

C#变体：

```
StringBuilder result = new StringBuilder();
using (SqlConnection conn = new SqlConnection(Settings.Default.Conn))
{

    conn.Open();
    string cmd = "select [state] from member";
    SqlCommand command = new SqlCommand(cmd, conn);
    using (SqlDataReader reader = command.ExecuteReader(CommandBehavior.CloseConnection))
    {
        while (reader.Read())
        {
            result.AppendLine(reader.GetString(0) == "ca" ? "california" : reader.GetString(0));
        }
    } 
```

}

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T14:23:12.997

我会担心将这种逻辑放在 SQL 语句中。如果您的数据库引擎发生变化会发生什么？您是否必须将每个 SQL 语句更新为 Oracle SQL？如果存储库本身发生变化，当您移动到消息总线、XML 文件或 Web 服务调用时会怎样...

看起来您正在存储显示信息。在这种情况下，它是数据模型的一部分。让控制器（在典型的[MVC 模式](http://www.asp.net/mvc/)中）执行条件逻辑。表示层不需要知道发生了什么，存储库只需保存数据即可。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T14:26:29.793

> 任何人都可以提供任何有效的证据证明使用条件语句的 SQL 查询优于 C# 或 Java 等其他语言吗？这是提高速度的好习惯吗？是否应该返回纯值并由表示层决定应该做什么？

有时（有时）它只是有助于避免在表示层中进行额外的编码。

通常，如果数据库和演示文稿都是由一个人开发的，那没关系。当工作被共享时，问题就开始了。在这种情况下，很明显，您需要一个明确说明数据库发出什么以及 ASP 接受什么的合同。

当然，CSS 属于表示层的领域，它应该由 ASP 解析，而不是用 SQL 硬编码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T14:29:23.377

那是旧式代码，我不再相信人们会再编写这样的代码（我们现在使用 CSS）
您可能正在寻找一些即将被重写或废弃的遗留代码

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T14:29:56.417

在 SQL 性能方面，如果您只返回几行（或从外观上看是一行），这影响很小，因为语句的 WHERE 部分在案例之前进行评估（案例仅在匹配的行上执行哪里）。

从最佳实践的角度来看，显示信息不应该真正在 SQL 中确定。也许返回一个主题类型，但肯定不是谨慎的样式信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T16:47:51.427

同意 100% 的重构以将显示决策提交到表示层（或尽可能接近）。

`CASE ... END`在 SQL 中仍然可以有它的用途，例如，假设我要计算所有订单在国内客户的总价值中所占的百分比。我想我会很高兴

```
SELECT
  SUM(CASE domestic WHEN 'Y' THEN order_value ELSE 0 END) / SUM(order_value) AS pctg
FROM orders 
```

作为查询。当然，除非有人知道得更好。

# .net - 是否可以从.net webservices返回接口，或者只能返回具体类？

> ID：487773
> 
> 赞同：7
> 
> 时间：2009-01-28T14:18:05.690
> 
> 标签：.net, web-services, interface

我需要从 web 服务返回一个复杂类型，并构建了实现 IMyComplexType 接口的 MyComplexType 类。现在在我的网络服务中，我有一个方法应该返回一个实现 IMyComplexType 的对象，如下所示：

```
[WebMethod]
public IMyComplexType GetMyComplexType()
{
   IMyComplexType myCt = new MyComplexType();
   ...
   return myCt; 
} 
```

一切都可以编译，但是当我运行 web 服务时，它会引发如下异常：

```
System.NotSupportedException: Cannot serialize interface MyWebService.IMyComplexType. 
```

这是设计使然还是我遗漏了什么。我可以以某种方式装饰我的班级或界面以允许这样做吗？我是否必须消除所有接口，只使用具体的或者抽象的基类才能使用 .net webservices 做到这一点？

编辑：

这是我要序列化的接口：

```
public interface ICustomer
{
     long Id {get; set;}
     string Name {get; set;}
     string EmailAddress {get; set;}
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T09:09:07.093

简短的回答是否定的，您不能通过 WebService 返回接口。

长答案是你可以得到你想要的行为，但这有点hacky。解决方案是使用二进制序列化。所以你将你的类型序列化为字节，让 web 方法返回一系列字节，然后在另一方面你将字节反序列化回你的复杂类型。

例如

```
[WebMethod]
public byte[] GetMyComplexType()
{

   IMyComplexType myCt = new MyComplexType();
   ...

   MemoryStream stream = new MemoryStream();
   IFormatter fmt = new BinaryFormatter();
   fmt.Serialize(stream, myCt);
   stream.Flush();
   byte[] bytes = stream.ToArray();
   stream.Close();

   return bytes;
} 
```

您需要将所有内容都转换回另一端。

```
byte[] bytes = service.GetMyComplexType();
MemoryStream stream = new MemoryStream(bytes);
BinaryFormatter fmt = new BinaryFomatter();
MyComplexType myCt = fmt.DeSerialize(stream); 
```

您可能可以通过创建通用方法来清理反序列化。我应该补充一点，您需要确保可以在客户端上引用复杂类型。

或者，如果它们是您的接口，那么您*可以*将它们转换为抽象类。但是，如果您希望该类实现多个接口（或者您已经从另一个类继承），这将不起作用，因为您只能继承一个类。如果您需要客户端上的某些多态行为，则需要使用 XmlInclude 属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T14:23:15.773

已经有一段时间了，但我相信你只需要扩展你的接口`ISerializable`，一切都应该很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T14:29:28.493

您不需要实现`ISerializable`- 只需使用`Serializable`属性标记接口即可。如果你想实现接口，一定要继续——它会让你对接口的序列化方式进行细粒度的控制。但我想默认实现应该没问题。还要检查以确保所有接口成员也是可序列化的。

[编辑] 我什至没有直截了当地思考 - 无论如何你都无法实现`ISerializable`，因为你正在尝试序列化一个 iterface。合适的地方`ISerializable`是需要接口公开的自定义序列化的自定义类型。

# user-interface - 多语言网站的最佳实践是什么？

> ID：487776
> 
> 赞同：13
> 
> 时间：2009-01-28T14:19:00.930
> 
> 标签：user-interface, internationalization, search-engine

我想制作一个多语言网站，以便所有或*几乎*所有页面都提供 2 种或更多翻译版本。要遵循的最佳实践是什么？

例如，我考虑以下语言选择机制：

1.  基于 Cookie 的首选语言选择。
2.  `Accept-Language`如果未设置 cookie，则基于标头。
3.  否则（可能）基于 GeoIP。

还有别的事吗？

应该如何提供不同的翻译？

1.  作为`LANG.example.com/page`
2.  作为`example.com/LANG/page`
3.  作为`example.com/page?hl=LANG`
4.  ...
5.  以上任何一个重定向到`example.com/page`？（好像很[气馁](/questions/368570/)）

如何确保所有翻译都被正确索引？

1.  包含所有页面 + 正确`Content-Language`标题的站点地图就足够了吗？

让用户知道还有其他翻译但不分散他们注意力的最佳方式是什么？

1.  在页眉/页脚/侧边栏中列出可用语言（如维基百科）
2.  将“选择语言”选择器放在内容旁边

处理缺失/过时翻译的最佳策略是什么？

1.  根本不显示丢失的页面或以不同的语言显示页面？
2.  显示旧翻译、带有警告的旧翻译或不同语言的页面？

我还应该考虑什么？我应该做什么，绝对不应该做什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-28T16:07:19.043

除了@Quassnoi 的答案，请确保您使用标准的 RFC 4646 语言标识符（例如 EN-US、DE-AT）；您可能已经意识到这一点。[CLDR](http://www.unicode.org/cldr)项目是一个优秀的国际化数据存储库（补充数据非常有用）。

如果特定页面的翻译不可用，请使用语言回退机制回到中性语言；例如“DE-AT”、“DE”、“”（中性，例如“EN”）。

如果页面编码正确，最新的浏览器和底层操作系统将正确显示语言环境选择器列表所需的所有字符（我建议所有页面都是 UTF-8）。确保区域设置列表同时包含母语和当前语言名称，以允许母语和非母语使用者查看指定的翻译，例如，如果当前区域设置为 EN-，则为“Deutsch (German)” `*`。

许多网站使用旗帜图标来显示当前区域设置，但这与位置更相关，如果您只显示主要旗帜（例如英语的美国或英国旗帜），有些人可能会被冒犯。

如果没有提交区域设置 cookie，则可能值得在主页上使用更可见（半图形）的区域设置选择器，使用 GeoIP 和 Accept-Language 的组合来确定默认的区域设置选择。

半相关：如果您的用户位于不同的时区，请在其帐户配置文件中包含一个区域首选项，以显示其本地时间的时间值。并使用 UTC 存储所有时间戳。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-28T14:30:34.730

决定是否需要早期支持需要双字节字符的语言（中文、日文、韩文等），Unicode 是首选。以后更改可能很乏味，特别是如果您有一个不使用 unicode 的数据库。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-28T14:31:35.167

1.  基于 Cookie 的首选语言选择。
2.  如果未设置 cookie，则基于 Accept-Language 标头。

这两个你应该支持。

在页面顶部放置一个大的英文横幅，上面写着**This page in English**。

> 如example.com/LANG/page

这是最好的选择。

LANG.example.com 不适合自动完成，而且问号看起来很难看。

> 在页眉/页脚/侧边栏中列出可用语言（如维基百科）

**选择一个语言的**保管箱是令人困惑的，因为用错误的外语书写是难以理解的，并且会破坏用英语书写的整体印象。

而且你总是倾向于犯错误，选择你甚至没有字体的语言，让自己留在一个充满问号的页面上。

> 显示带有警告的旧翻译

你知道有些东西你可以阅读并理解重点，但对于细节，你最好拿一本字典并用英文阅读。

# configuration - 文件或数据库中的配置？

> ID：487778
> 
> 赞同：23
> 
> 时间：2009-01-28T14:20:31.710
> 
> 标签：configuration

我并不是真的在问我是否应该对我的应用程序配置 100% 使用 RDBMS 或配置文件，而是问哪种*配置*最适合每种方法。

例如，我听说“最终用户无法更改的任何类型的配置”都应该在配置文件而不是数据库中。这是准确的吗？您如何解决配置问题？

（我在这里主要关注多用户 Web 应用程序，但没有特定的平台。）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-28T14:54:47.363

我发现在开发过程中，将配置存储在文件中是非常有益的。

签出文件（web.config、app.config 或一些自定义文件）并在代码运行时立即获取更改要容易得多。使用存储在数据库中的配置会涉及更多摩擦。如果您的团队使用单个开发数据库，​​您的更改很容易影响其他团队成员，并且如果您有单独的数据库，则只需“获取最新”即可启动并使用最新配置运行。此外，XML 的灵活性使得在文件中存储不仅仅是“名称-值”对的配置比在关系数据库中存储配置更自然。

缺点是您希望跨多个应用程序或网站实例重用配置。在我自己的例子中，我们在一个众所周知的位置有一个配置文件，任何应用程序都可以引用它。

至少，这是我们存储不需要在运行时由系统更新的“静态”配置的方式。用户设置可能更适合存储在数据库中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-20T11:15:00.517

oneliner：作为一般原则 - 配置数据更改的可能性越大，将其放入 db 就越好。

法律免责声明：您几乎总是需要一种“引导”配置，必须将其保存到文件中，因此如果您使用数据库来存储配置，“引导”配置的大小将取决于另一个伟大的原则：“更聪明地工作而不是更努力地工作！！！”

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-28T14:24:20.810

需要考虑的一件事是有多少配置数据，以及它可能多久更改一次。如果数据量很小，那么将其保存在数据库中（如果您还没有将数据库用于其他任何事情）将是矫枉过正，同样为每 6 个月更改一次的东西维护一个数据库可能会浪费资源。

也就是说，如果您已经在站点的其他部分使用数据库，那么为配置数据添加一两个表可能不是一个大问题，并且可能非常适合您存储其余数据的方式。如果您已经有一个用于将数据保存到数据库的类，为什么要编写一个新的类来保存到配置文件。

# .net - XSLT 转换日期时间到日期格式

> ID：487779
> 
> 赞同：5
> 
> 时间：2009-01-28T14:21:01.753
> 
> 标签：.net, xslt, xsd

我正在尝试将日期时间转换为日期格式 yyyy-MM-dd，因为我使用的是 xsd.exe 工具，所以 xs:date 数据类型会自动更改为日期时间数据类型，因为 .NET 中没有类型完全匹配类型 xs:date 的框架。

但我无法让它工作

```
<articles>
        <article>
          <articleid>48992</articleid>
          <deliverydateasked>2009-01-29T00:00:00+01:00</deliverydateasked>
        </article>
        <article>
          <articleid>48993</articleid>
          <deliverydateasked>2009-01-30T00:00:00+01:00</deliverydateasked>
        </article>
</articles> 
```

试图将xml转换为

```
<articles>
        <article>
          <articleid>48992</articleid>
          <deliverydateasked>2009-01-29</deliverydateasked>
        </article>
        <article>
          <articleid>48993</articleid>
          <deliverydateasked>2009-01-30</deliverydateasked>
        </article>
</articles> 
```

目前我正在使用这个 XSLT

```
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
<xsl:template match="/">
    <articles>
        <xsl:apply-templates select="article">
        </xsl:apply-templates>
            </articles>
</xsl:template>

<xsl:template name="FormatDate">

    <xsl:param name="DateTime" />
    <xsl:variable name="date">
        <xsl:value-of select="substring-before($DateTime,'T')" />
    </xsl:variable>

    <xsl:if test="string-length($date) != 10">
        <xsl:value-of select="$DateTime"/>
    </xsl:if>
    <xsl:if test="string-length($date) = 10">
        <xsl:value-of select="$date"/>
    </xsl:if>
</xsl:template>

<xsl:template match="article">
        <xsl:call-template name="FormatDate">
            <xsl:with-param name="DateTime" select="deliverydateasked"/>
        </xsl:call-template>    
</xsl:template> 
```

有谁知道一个好的 xslt 转换。

提前致谢

我的代码的输出结果是

```
<articles /> 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-03-23T18:50:14.540

在 XPath 2.0 中格式化将变得更加容易，微软目前在过去 8 年一直拒绝支持。由于格式问题实际上只存在于 .Net 中的 XSLT，所以我喜欢使用自定义函数，它更简洁、更容易：

XSLT 带格式化功能：

```
 xmlns="http://www.w3.org/1999/xhtml"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:msxsl="urn:schemas-microsoft-com:xslt"
    xmlns:user="http://www.tempuri.org/User">

  <msxsl:script implements-prefix="user" language="C#">
        <![CDATA[
          public string FormatCurrency(string amount)
          {
            return decimal.Parse(amount).ToString("C0");
          }

          public string FormatDate(string dateValue)
          {
            return DateTime.Parse(dateValue).ToString("MM/dd/yyyy hh:mm");
          }
          ]]>
      </msxsl:script> 
```

用法：

```
<xsl:value-of select="user:FormatDate(@transactionDate)"/>
<xsl:value-of select="user:FormatCurrency(@amount)"/> 
```

当您在 .Net 中执行 XSLT 时，请确保告诉它它是受信任的（以便 msxsl:script 块运行。

```
XslCompiledTransform.Load(reader, XsltSettings.TrustedXslt, null); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-28T14:43:06.780

坦率地说，这对我来说看起来很合适——有时一个简单的子字符串就足够了。

但是，如果您在 .NET 领域并且确实需要额外的功能，.NET 具有[XSLT 扩展对象](http://www.15seconds.com/issue/031112.htm)

* * *

编辑：oic，你有一个基本的应用模板概念问题。试试这个（注意副本和根模板匹配）：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">

<xsl:template match="*">
    <xsl:copy><xsl:apply-templates /></xsl:copy>
</xsl:template>

<xsl:template match="deliverydateasked">
    <xsl:copy>
        <xsl:call-template name="FormatDate">
            <xsl:with-param name="DateTime" select="."/>
        </xsl:call-template>    
    </xsl:copy>
</xsl:template>

<xsl:template name="FormatDate">

        <xsl:param name="DateTime" />
        <xsl:variable name="date">
                <xsl:value-of select="substring-before($DateTime,'T')" />
        </xsl:variable>

        <xsl:if test="string-length($date) != 10">
                <xsl:value-of select="$DateTime"/>
        </xsl:if>
        <xsl:if test="string-length($date) = 10">
                <xsl:value-of select="$date"/>
        </xsl:if>
</xsl:template>

</xsl:stylesheet> 
```

模板是一个很难学习的概念，您最好从更简单的 开始`for-each`，和/或似乎您可以使用一些 XSLT 教程/书籍。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T07:39:25.480

感谢 Stesoc 和 annakata 我想通了这是我现在正在使用的代码，它运行完美

```
<xsl:template match="*">
    <xsl:param name="parentElm">
        <xsl:value-of select="name(..)" />
    </xsl:param>
    <xsl:choose>
        <xsl:when test="local-name() = 'deliverydateasked'">
            <xsl:element name="deliverydateasked">
                <xsl:call-template name="FormatDate">
                    <xsl:with-param name="DateTime" select="."/>
                </xsl:call-template>
            </xsl:element>
        </xsl:when>
        <xsl:otherwise>
            <xsl:element name="{local-name()}">
                <xsl:copy-of select="@*" />
                <xsl:apply-templates select="@* | node()" />
            </xsl:element>
        </xsl:otherwise>
    </xsl:choose>
</xsl:template>

<xsl:template name="FormatDate">
    <xsl:param name="DateTime" />
    <xsl:variable name="date">
        <xsl:value-of select="substring-before($DateTime,'T')" />
    </xsl:variable>

    <xsl:if test="string-length($date) != 10">
        <xsl:value-of select="$DateTime"/>
    </xsl:if>
    <xsl:if test="string-length($date) = 10">
        <xsl:value-of select="$date"/>
    </xsl:if>
</xsl:template> 
```

# php - 用于限制 sql 记录的导航

> ID：487780
> 
> 赞同：0
> 
> 时间：2009-01-28T14:21:03.627
> 
> 标签：php, mysql

我想编写一个页面来显示数据库中的所有记录，并使用 SQL LIMIT 语法对其进行限制。

我的问题是如何使用 PHP 自动生成链接？我是否有一个变量会以某种方式自动增加，对链接等进行硬编码，这种事情是否有约定或最佳实践？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T14:23:52.387

这是听起来像的[标准分页。](http://php.about.com/od/phpwithmysql/ss/php_pagination.htm)基本上，您将使用 MySQL 中的[LIMIT](http://php.about.com/od/mysqlcommands/g/Limit_sql.htm)功能，设置每页的记录数量，最后跟踪页码。

您将通过一个名为“page”的 $_GET 变量来运行它。如果 Page 等于 2，并且每页的结果数为 10，那么您的[LIMIT](http://php.about.com/od/mysqlcommands/g/Limit_sql.htm)应该从第 21 条记录开始。所以你的[LIMIT](http://php.about.com/od/mysqlcommands/g/Limit_sql.htm)子句变成了 LIMIT 21, 10。

大部分工作将用于构建第 1 页、第 2 页、第 3 页等的链接。您需要知道您有多少记录，除以每页记录的限制。每页100条记录和10条记录？您将拥有第 1 页 - 第 10 页。每个链接仅调用相同的页面，但具有不同的 $_GET["page"] 值。

这是对[分页](http://php.about.com/od/phpwithmysql/ss/php_pagination.htm)的粗略描述。网上有[教程](http://www.google.com/search?hl=en&q=tutorial+pagination+php+mysql&btnG=Google+Search&aq=f&oq=)。

# dependency-injection - Castle Windsor：如果创建的对象引用回工厂，如何防止工厂创建的对象中的循环引用

> ID：487786
> 
> 赞同：1
> 
> 时间：2009-01-28T14:22:55.137
> 
> 标签：dependency-injection, inversion-of-control, castle-windsor, factory

我正在使用温莎城堡作为我的 IoC 容器，但遇到了一些问题。这在代码中得到了最好的解释，所以我会试一试。我有一个工厂类，它应该为我提供某个接口的实现：

```
public interface IObjectCreatorFactory
{
    IObjectCreator GetObjectCreator(Type objectType);
}
public interface IObjectCreator
{
    T CreateObject<T>(IDataRow data);
    bool SupportsType(Type type);
} 
```

工厂类的实现可能如下所示，但我不确定这是要走的路： public interface ObjectCreatorFactory:IObjectCreatorFactory { IEnumerable specificCreators; IObjectCreator 默认创建者；

```
 public ObjectCreatorFactory(IEnumerable<IObjectCreator> specificCreators, IObjectCreator defaultCreator)
    {
        this.specificCreators= specificCreators;
        this.defaultCreator= defaultCreator;
    }
    public IObjectCreator GetObjectCreator(Type objectType)
    {
        foreach (IObjectCreator creator in specificCreators)
        {
            if (creator.SupportsType(objectType))
            {
                return creator;
            }
        }
        return defaultCreator;
    }
} 
```

现在这样就可以了，但是如果我希望我的 IObjectCreator 实例使用特定的 IObjectCreator 创建子对象，我想调用 ObjectCreatorFactory，这显然会导致循环引用：

```
public void SpecificObjectCreator:IObjectCreator
{
    IObjectCreatorFactory objCreatorFactory;
    public SpecificObjectCreator(IObjectCreatorFactory objCreatorFactory)
    {
        this.objCreatorFactory = objCreatorFactory;
    }
    T CreateObject<T>(IDataRow data)
    {
        T obj = new T;
        ChildObject childObject = objCreatorFactory.GetObjectCreator(typeof(ChildObject)).CreateObject<ChildObject>(data);
         .......
    }
    bool SupportsType(Type type);        
} 
```

这行不通。在这种情况下，创建的对象将引用回工厂以供子对象创建者使用，该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T08:11:51.880

我将简单地将工厂从各种特定对象创建者的构造函数中移出，并在 IObjectCreator 接口上引入一个方法，负责初始化创建者：

```
public interface IObjectCreator
{
    T CreateObject<T>(IDataRow data);
    bool SupportsType(Type type);
    void Initialize(IObjectCreatorFactory factory);
} 
```

然后只需在传入工厂的每个对象创建者上调用 Initialze(this)。

在过去，我使用自定义生命周期阶段来处理自动调用组件的“构建后”设置，以避免循环依赖并处理其他相关问题（即从外部源应用额外的组件配置，例如一个数据库） - 但它可能对你需要的东西来说太过分了。

# persistence - 为基于 Greasemonkey 的爬虫存储数据的最佳方式？

> ID：487787
> 
> 赞同：8
> 
> 时间：2009-01-28T14:23:05.197
> 
> 标签：persistence, xmlhttprequest, greasemonkey, storage, web-crawler

我想用 Greasemonkey 抓取一个网站，想知道是否有比使用 GM_setValue 更好的方法来临时存储值。

我想做的是在社交网络中抓取我的联系人并从他们的个人资料页面中提取 Twitter URL。

我目前的计划是在它自己的选项卡中打开每个配置文件，使其看起来更像一个普通的浏览者（即浏览器将加载 css、scrits 和图像）。然后用 GM_setValue 存储 Twitter URL。抓取完所有个人资料页面后，使用存储的值创建一个页面。

不过，我对存储选项不太满意。也许有更好的方法？

我已经考虑将用户配置文件插入当前页面，以便我可以使用相同的脚本实例处理它们，但我不确定 XMLHttpRequest 看起来是否与普通用户发起的请求没有区别。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T06:03:41.983

我有一个类似的项目，我需要从网站获取大量（发票行数据），并将其导出到会计数据库中。

您可以创建一个 .aspx（或 PHP 等）后端，它处理 POST 数据并将其存储在数据库中。

您想要从单个页面获得的任何数据都可以存储在表单中（如果需要，可以使用样式属性隐藏），使用字段名称或 id 来标识数据。然后，您需要做的就是将表单操作设为 .aspx 页面并使用 javascript 提交表单。

（或者，您可以在页面上添加一个提交按钮，允许您在提交到数据库之前检查表单值）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T22:47:49.820

我认为您应该首先问自己为什么要使用 Greasemonkey 来解决您的特定问题。Greasemonkey 是作为一种修改浏览体验的方式而开发的——而不是作为网络蜘蛛。虽然您可以使用 GM_setValue 让 Greasemonkey 执行此操作，但我认为您会发现您的解决方案很笨拙且难以开发。那将需要许多手动步骤（例如打开所有这些选项卡，在脚本运行之间清除 Greasemonkey 变量等）。

您所做的任何事情都需要执行页面上的 JavaScript 吗？如果是这样，您可能需要考虑使用 Perl 和[WWW::Mechanize::Plugin::JavaScript](http://search.cpan.org/~sprout/WWW-Mechanize-Plugin-JavaScript-0.007a/lib/WWW/Mechanize/Plugin/JavaScript.pm)。否则，我建议您在一个简单的 Python 脚本中完成所有这些操作。你会想看看[urllib2](http://docs.python.org/library/urllib2.html?highlight=urllib2#module-urllib2)模块。例如，看一下下面的代码（注意它使用 cookielib 来支持 cookie，如果你的脚本要求你登录到一个站点，你很可能需要它）：

```
import urllib2
import cookielib
opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookielib.CookieJar()))
response = opener.open("http://twitter.com/someguy")
responseText = response.read() 
```

然后，您可以使用正则表达式进行所有您想要的处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-10T20:57:49.537

您是否考虑过 Google Gears？这将使您可以访问可以存储大量信息的本地 SQLite 数据库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-16T12:53:55.243

> 想要 Greasemonkey 的原因是要爬的页面并不真正认可机器人。Greasemonkey 似乎是让爬虫看起来合法的最简单方法。

实际上，通过浏览器污染您的爬虫并不会使其更合法。您仍然违反了网站的使用条款！例如，WWW::Mechanize 同样适合“欺骗”您的用户代理字符串，但如果该站点不允许蜘蛛/爬虫，那么爬网是非法的！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-16T13:05:28.177

> 想要 Greasemonkey 的原因是要爬的页面并不真正认可机器人。Greasemonkey 似乎是让爬虫看起来合法的最简单方法。

我认为这是使爬虫看起来合法的最难的方法。通过对 HTTP 标头的一些基本了解，欺骗 Web 浏览器非常容易。

此外，一些站点具有寻找行为像蜘蛛的客户端的启发式方法，因此简单地使请求看起来像浏览器并不意味着不会知道您在做什么。

# perl - 你如何在 Perl 中读取系统时间和日期？

> ID：487791
> 
> 赞同：11
> 
> 时间：2009-01-28T14:23:43.853
> 
> 标签：perl, datetime

我需要读取系统时钟（时间和日期）并在 Perl 中以人类可读的格式显示它。

目前，我正在使用以下方法（我在[这里](http://perl.about.com/od/perltutorials/a/perllocaltime_2.htm)找到）：

```
#!/usr/local/bin/perl
@months = qw(Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec);
@weekDays = qw(Sun Mon Tue Wed Thu Fri Sat Sun);
($second, $minute, $hour, $dayOfMonth, $month, $yearOffset, $dayOfWeek, $dayOfYear, $daylightSavings) = localtime();
$year = 1900 + $yearOffset;
$theTime = "$hour:$minute:$second, $weekDays[$dayOfWeek] $months[$month] $dayOfMonth, $year";
print $theTime; 
```

> 当你运行程序时，你应该会看到一个更易读的日期和时间，如下所示：

```
9:14:42, Wed Dec 28, 2005 
```

这似乎更像是为了说明而不是实际的生产代码。有没有更规范的方法？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-28T14:27:09.527

使用[本地](http://perldoc.perl.org/functions/localtime.html)时间功能：

> 在标量上下文中，localtime() 返回 ctime(3) 值：
> 
> ```
> $now_string = localtime;  # e.g., "Thu Oct 13 04:54:34 1994" 
> ```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-28T14:49:22.400

您可以使用 localtime 来获取时间和 POSIX 模块[`strftime`](http://perldoc.perl.org/POSIX.html#strftime)来格式化它。

虽然使用 Date::Format 及其 strftime 会很好，因为它使用较少的开销，但 POSIX 模块是与 Perl 一起分发的，因此几乎可以保证在给定的系统上。

```
use POSIX;
print POSIX::strftime( "%A, %B %d, %Y", localtime());
# Should print something like Wednesday, January 28, 2009
# ...if you're using an English locale, that is.
# Note that this and Date::Format's strftime are pretty much identical 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-28T15:52:46.280

正如其他人所说，“本地时间”是你驯服日期的方式，以一种简单直接的方式。

但只是为了给你更多的选择。日期[时间模块](http://search.cpan.org/perldoc?DateTime)。这个模块已经成为我的最爱。

```
use DateTime;
my $dt = DateTime->now;

my $dow = $dt->day_name;
my $dom = $dt->mday;
my $month = $dt->month_abbr;
my $chr_era = $dt->year_with_christian_era;

print "Today is $dow, $month $dom $chr_era\n"; 
```

这将打印“今天是 2009 年 1 月 28 日星期三”。只是为了炫耀它可以做的许多事情中的一些。

```
use DateTime;
print DateTime->now->ymd; 
```

它打印出“2009-01-28”

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-28T14:29:09.257

就像其他人提到的那样，您可以使用本地时间，但我会使用[Date::Format](http://search.cpan.org/dist/TimeDate/lib/Date/Format.pm)解析它。它会以几乎任何您需要的方式为您提供格式化的时间戳。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-11-22T09:11:58.163

以清晰易读的格式打印本地时间的最简单的单行打印语句是：

```
print scalar localtime (); #Output: Fri Nov 22 14:25:58 2019 
```

# python - 如何在允许 utf-8 输入的同时获得交互式 Python 以避免使用 readline？

> ID：487800
> 
> 赞同：4
> 
> 时间：2009-01-28T14:26:28.047
> 
> 标签：python, utf-8, interactive

我使用一个终端（9term），它自己进行命令行编辑——使用 readline 的程序只会妨碍它。它完全支持 utf-8。如何在保留 utf-8 输入和输出的同时使交互式 python 会话禁用 readline？

目前我使用：

```
LANG=en_GB.UTF-8 export LANG
cat | python -i 
```

但是这会导致 sys.stdin.encoding 为 None，这意味着 Ascii（系统默认编码，似乎不可更改）

```
TERM=dumb python 
```

不会禁用 readline （它也会破坏 utf-8 输入）。

我是 python 新手，如果这是一个明显的问题，我深表歉意。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T14:51:43.190

过去，我通过从源代码重建它来禁用 Python readline：`configure --disable-readline`

但是，对于您的情况，这可能有点矫枉过正。

# iphone - 在警报视图中点击了哪个按钮

> ID：487805
> 
> 赞同：0
> 
> 时间：2009-01-28T14:27:18.217
> 
> 标签：iphone, objective-c

我创建这样的警报视图：

```
UIAlertView* av = [UIAlertView new];
av.title = @"Dealer offer Insurence";
[av addButtonWithTitle:@"YES"];
[av addButtonWithTitle:@"NO"]; 
```

如何找出用户点击了哪个按钮？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T14:37:02.050

[文档](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIAlertView_Class/UIAlertView/UIAlertView.html)在哪些方面不足？您甚至可以从[众多代码示例](http://developer.apple.com/iphone/library/samplecode/UICatalog/index.html)之一中复制代码。

# .net - ASP.NET MVC RC 中的 Html.RouteLink 错误

> ID：487810
> 
> 赞同：1
> 
> 时间：2009-01-28T14:28:04.110
> 
> 标签：.net, asp.net-mvc

我在 asp.net MVC beta 中使用 Html.RouteLink("LINKTEXT","RouteName",new RouteValueDictionary()) 没有问题，今天我升级到 ASP.NET MVC RC，这不再创建链接。该路线仍然有效，因为我在浏览器中输入并转到我想要的页面。有什么帮助吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T19:21:57.543

这是RC中的错误。目前的解决方法是将控制器和操作名称放在 RouteLink 中。

例如：

```
<%= Html.RouteLink(cat.Name, "Category", new { id = cat.id, controller = "Home", action = "Category" })%> 
```

我还发现了将网络发布到共享主机的另一个问题（我的是在 iis6 上）：项目中 system.web.mvc 引用的“特定版本”属性必须设置为“false”。在它是“真的”之前，我在 web.config 中遇到了一个关于注册 sys.web.mvc 程序集的错误。

# forums - 您的软件产品论坛中应该包含哪些内容，以便客户可以最大限度地利用它？

> ID：487812
> 
> 赞同：1
> 
> 时间：2009-01-28T14:28:53.890
> 
> 标签：forums

我公司正计划为我们的软件产品开设一个论坛，客户可以参考一般常见问题解答、问题等。

现在我们计划拥有：-

1.  用户手册。
2.  应用程序不同部分的最佳实践
3.  经常遇到的问题。
4.  用户可以与开发团队讨论问题的论坛。

还有其他想法吗？

编辑：-

5.  我们订阅了论坛的 RSS 和电子邮件通知。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T15:31:37.260

如果您按照 Kevin 的建议添加问题跟踪器，那么您的列表对我来说似乎还不错。

我还建议您一开始不要使用太多需要与您（例如您的开发人员）互动的不同服务 - 我已经看到（太多）许多好的计划仅仅因为公司中没有人有足够的时间而死例如，定期回答论坛问题。

就您而言，我猜“最佳实践”、“常见问题”和论坛都会消耗您的开发团队的定期时间，如果您想让它们保持活力和最新状态，尤其是在开始时。因此，我不会在一开始就添加更多服务，但请确保正确使用这些服务（如果您发现用户需要它们，您以后可以随时添加更多服务 :-)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T14:33:59.857

> 用户可以与开发团队讨论问题的论坛。

我不知道这是否是“问题跟踪器”的委婉说法，但如果不是，请确保您包含一种供人们提交错误/功能/增强报告并跟踪它们直至完成的方法。没有什么比不能提交错误报告或能够提交错误报告但只能进入黑洞更糟糕的了。

沟通是关键。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T14:40:27.253

你。

表明您关心您的客户。

[创建热情用户](http://headrush.typepad.com/)博客中的许多有用提示。

# jquery - 当用户在文本框中输入时，使用 jquery 提交表单发布事件

> ID：487822
> 
> 赞同：1
> 
> 时间：2009-01-28T14:30:31.737
> 
> 标签：jquery

每当用户在文本框中键入以过滤 div 标记中的结果时，我如何回发。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T14:41:07.923

我认为这对您来说是一篇有趣的文章：

[jQuery Live Ajax 搜索插件](http://exscale.se/archives/2008/05/16/jquery-live-ajax-search-plug-in/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T14:42:39.730

有几个简洁的 jQuery 插件可以做到这一点。我最喜欢的是[jQuery LiveSearch](http://ejohn.org/blog/jquery-livesearch/)，但如果你用谷歌[搜索 jQuery AJAX](http://www.google.com/search?rlz=1C1GGLS_enUS291&sourceid=chrome&ie=UTF-8&q=jQuery+AJAX+search)，你会发现很多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T11:59:01.893

```
<script language=javascript>
    $(document).ready(function () {
        $("#SearchBox").focus();
        $("#SearchBox").keyup(function (event) {
            var e = window.event || e
            var keyunicode = e.charCode || e.keyCode
            //Allow alphabetical keys, plus BACKSPACE and SPACE
            if (keyunicode >= 65 && keyunicode <= 122 || keyunicode == 8 || keyunicode == 32) {
                $("#SubBut").click();
            }
        });
    });

    function SetEnd(TB) {
        var FieldRange = TB.createTextRange();
        FieldRange.moveStart('character', TB.value.length);
        FieldRange.select();
    }
</script> 
```

将 onfocus="SetEnd(this) 添加到搜索输入控件的属性中。这会将插入符号设置为文本的末尾。

这只会在文本框中输入字母数字字符时回发，包括删除。

希望这可以帮助某人。

注意我只在 IE7 上测试过，因此有些东西在 Firefox 或其他浏览器中可能不起作用。

# java - Java Web 应用程序属性

> ID：487826
> 
> 赞同：5
> 
> 时间：2009-01-28T14:31:30.267
> 
> 标签：java, spring, jakarta-ee, properties, jstl

Java 和/或 Spring 是否有属性的概念？我有一堆域模型，每个模型都有几个属性。例子：

```
public class Person {
    private String name;
    private Date dateOfBirth;
    private float height;
    private float weight;
    // getters and setters not shown
} 
```

当显示一个人时，属性名称在 JSP 中是硬编码的。

```
Name: ${person.name}<br>
Date of birth: ${person.dateOfBirth}<br>
Height: ${person.height}<br>
Weight: ${person.weight}<br> 
```

此外，可能有几个不同的页面显示一个人。请注意，出生日期是 a `java.util.Date`，因此 JSP 或控制器将使用`java.text.SimpleDateFormat`它来格式化它。身高和体重是数字，它们可能有自己`java.util.Format`的格式。

我正在寻找一种属性查找机制。每个属性（姓名、出生日期、身高等）都有显示名称、格式和描述（用于帮助或工具提示）。属性的属性将在某个配置文件中定义。显示属性时，将通过属性机制查找显示名称和格式。这也将解决本地化问题。

我的问题是是否已经为 Java 实现了类似的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T15:35:16.487

要使用 JSP 和 JSTL 做到这一点，您可以使用“fmt”标签库，它支持数字、日期等的本地化和格式化。

在您发布的示例中，代码将如下所示：

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%-- ..assuming bundle and locale are already set... --%>
<fmt:message key="NAME" bundle="${myBundle}"/>: ${person.name}<br>
<fmt:message key="DOB" bundle="${myBundle}"/>: <fmt:formatDate type="date" value="${person.dateOfBirth}"/><br>
<fmt:message key="HEIGHT" bundle="${myBundle}"/>: <fmt:formatNumber pattern="##.##" value="${person.height}"/><br>
<fmt:message key="WEIGHT" bundle="${myBundle}"/>: <fmt:formatNumber pattern="##.##" value="${person.weight}"/><br> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T15:01:33.233

如果我理解正确，您希望能够将其中一些属性的格式和描述放在外部文件中。您可能想看一下 Spring 的（[此处为 javadoc](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/context/MessageSource.html)[`MessageSource`](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#context-functionality-messagesource)的链接），它有点环绕，类似于JDK 中的类。[`ResourceBundle`](http://java.sun.com/j2se/1.5.0/docs/api/java/util/ResourceBundle.html)

使用`MessageSource`'s 将允许您将格式和任何文本放在外部文件中（并且对于不同的语言有不同的属性文件），但我相信您仍然需要在 JSP 中包含哪些属性作为参数传递，例如：

```
<spring:message code="user.dob" arguments="${user.dateOfBirth}"/> 
```

您的`messages.properties`文件包含：

```
user.dob = Your date of birth is {0} 
```

我不完全确定如何在 中指定格式`messages.properties`，但我知道这是可能的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T14:44:00.927

您想要提供的一些信息非常适合 BeanInfo 对象，最初是为了支持 JavaBeans 的东西——我不知道它是否仍在使用，以及它是否可以按照您想要的方式使用。

另外 spring:message 标签提供了对静态文本 i18n 的支持，但我认为它不会轻易与您的 bean 绑定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T15:03:09.750

您是在寻找对表达式评估的支持，还是在寻找一种输出 bean 属性的方法？

Spring 两者都有，对于前者检查 spring 文档：[Spring Expression Evaluator](http://www.springframework.net/doc-latest/reference/html/expressions.html) 对于后者检查文档：[Spring MVC](http://static.springframework.org/spring/docs/2.5.x/reference/view.html)。

Java 语言本身并没有指定访问属性的语言，也不支持您想要的级别的属性概念，尽管 Swing 等一些东西支持属性，而 java 也支持相关的东西，请检查[java.beans](http://java.sun.com/j2se/1.3/docs/api/java/beans/package-summary.html)包。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T08:30:56.120

您想要一些格式化人员属性的东西，并且您想在多个页面中使用它。在我看来，您应该使用自定义标签来执行此操作：

```
<you:person = "${person}"/> 
```

当您使用 facelets 时，该标签可能只是另一个 facelet，您可以在其中编写 outputTexts 以打印信息。因此，您可以添加对不同位置的支持。

结帐：[https](https://facelets.dev.java.net/) ://facelets.dev.java.net/ 和[http://andrewfacelets.blogspot.com/2006/06/creating-composite-controls-with-jsf.html](http://andrewfacelets.blogspot.com/2006/06/creating-composite-controls-with-jsf.html)

蒂姆

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-30T17:51:06.410

看看[Wicket Web Beans](http://wicketwebbeans.sourceforge.net/)。

> Wicket Web Beans (WWB) 是一个 Apache Wicket ( [http://wicket.apache.org](http://wicket.apache.org) ) 组件工具包，用于显示和编辑符合 JavaBeans 规范的 POJO。网页是根据 bean 属性和某些约定自动生成的。如有必要，可以例外地自定义这些页面的布局、可编辑性和操作。换句话说，该工具包通常会执行您所期望的操作，但当它没有执行时，您可以覆盖它的行为。
> 
> 在最高级别，net.sourceforge.wicketwebbeans.containers.BeanForm 组件提供了丰富的 AJAX 表单功能。该表单嵌入在您设计的页面中。这允许您创建自定义页面设计。此外，这允许将多个 BeanForm 合并到一个页面上。根据您的选择，可以独立于 BeanForm 使用其他较低级别的组件（例如 BeanGridPanel）。WWB 不会试图强迫您采用某种方式做事，但是如果您不想做很多额外的工作，BeanForm 可以非常方便地实现基于 bean 的表单。您专注于模型（bean），WWB 处理用户界面。
> 
> 表单中的字段在更改时会动态发送回服务器端 bean，从而消除了典型的提交周期。这使得 WWB 更像是一个富客户端应用程序，而不是一个标准的基于表单的应用程序。

# sharepoint - 如何强制新网站集继承母版页？

> ID：487831
> 
> 赞同：1
> 
> 时间：2009-01-28T14:33:00.030
> 
> 标签：sharepoint, master-pages, wss

我有一些在 SharePoint 中创建新网站的代码。浏览到新创建的站点时，会引发 File Not Found 错误。如果您浏览到 /_layouts/ChangeSiteMasterPage.aspx，您可以选择一个新的站点母版和系统母版页，并且该站点可以正常工作。这篇 kb 文章完美地描述了我的症状：http: [//support.microsoft.com/kb/936908](http://support.microsoft.com/kb/936908)

我的问题是给出的两个（也许三个？）解决方案中，只有一个有效。如果我手动选择新的母版页，它工作正常。第二种解决方法是在新站点上激活发布功能。这并不能解决任何问题。

还有一个建议是将发布功能装订到我用于新站点的站点定义中。就我而言，这是 STS#1（空白站点），装订发布功能并不能缓解我的问题。

任何人都知道如何整理出正确的母版页？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T18:54:25.837

我们通过委托控制来做到这一点。在 OnLoad 我们调用以下方法：

```
private void ConfigureMasterPage(SPWeb web)
{
       string masterURL = string.Empty;
       masterURL = web.Site.ServerRelativeUrl + "/_catalogs/masterpage/XXX.master";
       masterURL = masterURL.Replace("//", "/");
       web.MasterUrl = masterURL;
       web.CustomMasterUrl = masterURL;
       web.Update();
} 
```

不要忘记处理 SPSite 和 SPWeb 对象，您必须将 AllowUnsafeUpdates 设置为 true。

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T03:31:04.940

结果我只需要在其中一个生成的站点中更改主模板，然后将其保存为模板。我删除了损坏的模板并将其放置在它的位置。现在所有生成的站点都可以正常工作。

# compiler-construction - 递归下降与生成的解析器 - 效率

> ID：487833
> 
> 赞同：8
> 
> 时间：2009-01-28T14:33:24.973
> 
> 标签：compiler-construction, recursive-descent

就性能而言，手写递归下降解析器（不可避免地是 LL(k)）与生成的 LALR 解析器相比如何？

我知道 LALR 解析器能够处理比 LL(k) 多得多的语法；然而，我打算手动编写我的解析器，递归下降似乎是最合适的选择。出于兴趣，是否可以手动（合理地可读）编写任何其他类型？

**注意**我使用的是带有尾调用优化 (F#) 的函数式语言，因此 [精心定制的] 递归不会像其他语言那样成为问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-28T16:14:58.827

我认为很大程度上取决于您要解析的语言。另一个有时会被遗忘的性能部分是词法分析（扫描）部分——它对性能很重要，因为它处理的是字符而不是符号。递归下降是编写解析器的一个很好的第一次迭代，它使得遵循被解析语言的逻辑非常自然。我认为如果解析的语言适合（没有左递归），你应该从递归下降开始。在这个阶段为性能选择 LALR 似乎是过早的优化。您可以手动编写[图表解析器](http://en.wikipedia.org/wiki/Chart_parser)，但我怀疑这就是您的意思。手动编写 LALR 解析器是可能的，但很乏味。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T15:33:27.837

*此时出于性能*原因在LALR 和 LL 之间做出决定听起来像是过早的优化。解析时间很少是编译器的瓶颈。如果我是您，我会根据您是否更愿意自下而上或自上而下定义语法来进行选择。

就我个人而言，我发现 LALR 语法易于使用，并且 F# 的 fsyacc 集成（这是我学习解析的方法）使得将 yacc 集成到您的项目中变得非常容易。

# browser - “你确定要离开这个页面吗？”是如何在浏览器中生成的？

> ID：487836
> 
> 赞同：5
> 
> 时间：2009-01-28T14:34:13.693
> 
> 标签：browser, refresh, modal-dialog

我有一个页面，我在其中打开一个“模态窗口”。它实际上只是一个 DIV，里面有一个 IFRAME，我在其中加载另一个页面。当我想刷新页面时，浏览器会弹出一个窗口说“你确定要离开这个页面吗？重新加载这个页面会导致模态窗口消失。按确定继续，或取消留在当前页面。”

此消息是如何生成的？浏览器如何确定我在那里有一个模态窗口，因为我没有使用来自 JavaScript 的任何 window.open() 调用？有什么办法可以禁用浏览器的这种行为。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T14:36:31.443

它可能`body.onunload`在 IFRAME 中加载的页面的源代码中。

由于模态窗口本质上是一个 IFRAME，因此当您关闭（或刷新）主窗口时，浏览器知道它正在杀死该 IFRAME，因此该 IFRAME 中的任何`body.onunload`内容都会触发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-18T23:47:47.123

如果您有一个处理 onbeforeunload 的函数，则会自动生成 Firefox 消息。

您可以通过在处理程序的 and 处返回 null 来禁用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T14:36:47.230

这可能是由于某些脚本修改了所有非现场链接以显示此模式窗口，然后*返回 true*，或者根据您与模式窗口的交互*返回 false 。*

如果您想去除该行为，您可以删除外部链接的所有点击事件。

# c# - SharePoint：以编程方式获取网站目录的类别

> ID：487849
> 
> 赞同：2
> 
> 时间：2009-01-28T14:37:42.970
> 
> 标签：c#, sharepoint, moss, sitedirectory

我正在寻找一种以编程方式获取门户网站目录中定义的类别的方法。据我所见，类别表示为具有多个值的“选择”类型的字段，用户可以选择表单。

我的问题是，如何区分类别字段和“标题”或“作者”等普通字段。实际上，我不想对类别名称进行硬编码，而是想动态加载它们。我认为必须有一些标准，因为站点目录页面上的标准 Web 部件也动态加载类别。

不幸的是，我找不到很多关于这个问题的信息。

再见弗洛

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T21:02:01.680

获取对 SPWeb 的引用。使用[SharePoint 管理器](http://www.codeplex.com/spm)（并非绝对必要，但该应用程序很有用）获取所需字段的详细信息。

此代码可以从字段 xmlSchema 中获取列表。注意：注释的 xml 是我自己的 Category 字段的 SchemaXml 的外观。

```
public static ArrayList GetCategory(SPWeb web)
{
    ArrayList result = new ArrayList();

    /*            <?xml version="1.0" encoding="utf-16"?>
    <Field ID="{6DF9BD52-550E-4a30-BC31-A4366832A87D}" Type="Choice" Group="_Hidden" Name="Category" DisplayName="Category" SourceID="http://schemas.microsoft.com/sharepoint/v3" StaticName="Category">
      <CHOICES>
        <CHOICE>(1) Category1</CHOICE>
        <CHOICE>(2) Category2</CHOICE>
        <CHOICE>(3) Category3</CHOICE>
      </CHOICES>
      <Default>(2) Category2</Default>
    </Field>*/
    try
    {
        SPField catField = web.Fields[new Guid("6DF9BD52-550E-4a30-BC31-A4366832A87D")];
        XmlDocument Doc = new XmlDocument();
        Doc.LoadXml(catField.SchemaXml);
        XmlNodeList Choices = Doc.SelectNodes("Field/CHOICES/CHOICE");
        foreach (XmlNode Choice in Choices)
        {
            result.Add(Choice.InnerText);
        }
    }
    catch (Exception ex)
    {
        result.Add("Failed: " + ex.Message);
    }
    return result;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T22:30:43.263

好吧，我明白了，我表达的不是很清楚。我知道如何获取字段架构表单字段。但我想在你的帖子之后我自己得到了我的问题的答案。

我想知道的是，我可以假设站点目录的“网站”列表中“选择”类型的每个字段都代表一个站点可以分配到的类别？所以每个类别字段都必须是“选择”类型？

要获得所有可用的类别，我必须遍历列表的字段并根据“选择”类型查找字段，对吗？

**更新**

同时，我想我找到了问题的答案。如果网站列表中的列是“类别”视图的一部分，则将其作为网站目录的类别处理。一般来说，类别列不一定是“选择”类型，尽管其他类型在这种情况下没有意义。

# regex - 如何替换 Perl 中所有 HTML 编码的重音符号？

> ID：487855
> 
> 赞同：4
> 
> 时间：2009-01-28T14:40:26.053
> 
> 标签：regex, perl, string, replace

我有以下情况：

有一个工具可以从 Web 界面获取 XSLT 并将 XSLT 嵌入到 XML 文件中（应该已经解雇了某人）。“不幸的是”我在一个讲法语的国家工作，因此 XSLT 有许多带有口音的单词。当 XSLT 嵌入到 XML 中时，该工具会将所有重音符号转换为它们的 HTML 代码（Iacute、igrave 等）。

我的 Perl 代码正在从 XML 中检索 XSLT，并使用 Xalan 命令行工具针对其他 XML 执行它。每次 XSLT 中出现一些重音时，Xalan 工具都会引发异常。

我最初虽然做一个正则表达式来更改 XSLT usch 中的所有重音符号：

```
# & 在代码中被省略，因为它将在页面中呈现
$xslt =~s/Aacute;/Á/gso;
$xslt =~s/aacute;/á/gso;
$xslt =~s/Agrave;/À/gso;
$xslt =~s/Acirc;/Â/gso;
$xslt =~s/agrave;/à/gso;

```

但这样做意味着我必须为每个重音代码编写一个正则表达式....

我的问题是，有没有办法在不为每个代码编写正则表达式的情况下做到这一点？（认为​​这是唯一的解决方案，让人想呕吐。）

顺便说一句，工具是 TeamSite，它很烂.....

**编辑：**我忘了提到我需要一个仅 Perl 的解决方案，安全性不允许我安装他们一周左右没有检查过的任何类型的库:(

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T14:44:16.887

你可以试试[HTML::Entities 之](http://search.cpan.org/~gaas/HTML-Parser-3.59/lib/HTML/Entities.pm)类的东西。从 POD：

```
use HTML::Entities;
$a = "V&aring;re norske tegn b&oslash;r &#230res";
decode_entities($a);
#encode_entities($a, "\200-\377");  ## not needed for what you are doing 
```

作为对您的编辑的回应，HTML::Entities 不在 perl 核心中。它可能仍安装在您的系统上，因为许多其他库都在使用它。您可以通过运行以下命令进行检查：

```
perl -MHTML::Entities -le 'print "If this prints, the it is installed"' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T16:23:33.347

为了您的目的，[HTML::Entities](http://search.cpan.org/~gaas/HTML-Parser-3.59/lib/HTML/Entities.pm)是最好的解决方案，但是如果您找不到一些现有的包适合您的需求，那么以下方法比多个`s///`语句更有效

```
# this part do in inter function module code which is executed in compile time
# or place in BEGIN or do once before first s/// statement using it
my %trans = (
  'Aacute;' => 'Á',
  'aacute;' => 'á',
  'Agrave;' => 'À',
  'Acirc;' => 'Â',
  'agrave;' => 'à',
); # remember you can generate parts of this hash for example by map

my $re = qr/${ \(join'|', map quotemeta, keys %trans)}/;

# this code place in your functions or methods
s/($re)/$trans{$1}/g; # 'o' is almost useless here because $re has been compiled yet 
```

**编辑**：不需要[Chas](https://stackoverflow.com/users/78259/chas-owens)`e`提到的正则表达式修饰符。[欧文斯](https://stackoverflow.com/users/78259/chas-owens)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T15:29:35.063

我认为不可能让 TeamSite 将其保留为 utf-8/将其转换为 utf-8？

CGI.pm 有一个（未记录的）unescapeHTML 函数。但是，由于它没有记录（而且我没有查看源代码），我不知道它是否只处理基本的 HTML 实体（<、>、&）或更多。但是，我猜它只做基本实体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T11:46:26.880

为什么有人会因为将 XSL（即 XML）放入 XML 文件而被解雇？

# java - 打破业务逻辑和数据层似乎重叠的最佳设计？

> ID：487857
> 
> 赞同：3
> 
> 时间：2009-01-28T14:40:43.960
> 
> 标签：java, model-view-controller, data-access-layer, business-logic

我正在构建一个 MVC Web 应用程序（使用 Spring MVC 框架），我对设计特定区域的最佳方式感到有些困惑。

应用程序必须与一系列 Web 服务进行交互，这些 Web 服务的设计并没有那么大，并且它们本身并没有提供太多抽象 - 基本上每个创建/更新/检索/删除操作都有一个 Web 服务方法每个“数据类型”，除此之外没有太多的 API。Web 服务客户端需要知道调用哪些方法以及调用顺序，以便能够创建它需要的数据——换句话说，没有基于“事务”的方法。

例如，简单地创建一个新用户帐户需要调用总共七种不同的 Web 服务方法来设置必要表中的所有记录（一条`user`记录、为该用户添加正确`privileges`的、设置用户的`billing`详细信息等） .

我正在努力寻找将其抽象化并将其封装在我们的应用程序中的最佳方法。大多数应用程序都遵循标准流程：

```
request ---> Controller <---> Service/Business-level object <---> DAOs for data access 
```

在我的应用程序中，我使用自己的一组“域对象”来表示和抽象 Web 服务 WSDL 中定义的数据类型，这样我的域逻辑不依赖于 Web 服务类型，因此我们可以抽象和隐藏我们喜欢的任何细节。

我正在寻找一些意见是设计我上面作为示例提到的“用户创建过程”的最佳方式。正如我所提到的，创建“普通用户”的过程涉及调用七种不同的 Web 服务，但这只是用户的一种“类型”——我们必须能够创建几种不同类型的用户，每一种都需要不同的要调用的 Web 服务。

目前我只设计了这个“普通用户”的创建，作为一个概念证明——我有一个域对象`User`，一个`UserDao`接口，它有和的方法`getUser(name)`，`createUser(User)`以及一个`WebServiceUserDao`实现`UserDao`方法并知道如何调用上述内容的接口——提到了七种网络服务方法。该`createUser()`方法由 a 调用`UserCreationService`，这是我的业务/服务级别类，而该类又由`SignupController`.

但是为了扩展这个逻辑以便能够创建不同的用户类型（它们`User.getType()`由：

1.  为每个“用户类型”创建一个`UserDao`实现，因此创建每个“用户类型”的逻辑可以封装在它自己的类中，让`UserCreationService`决定`UserDao`使用哪个？这将对应于 1 个服务类：许多 DAO。
2.  我是否应该将它们`UserDao`分成更小的部分，一个对应于需要在 Web 服务/数据库中创建的每个“记录”，即使我的整个应用程序不需要了解这些单独类型中的每一个？然后`UserCreationService`对各种不同的“用户类型”有不同的实现？换句话说，即使我不需要相应的或域对象，该策略也会有 a `PrivilegesDao`、 a等。这将是许多服务类：许多 DAO。`BillingPlanDao``Privilege``BillingPlan`
3.  包含所有需要为每个“用户类型”调用 Web 服务的逻辑`WebServiceUserDao`？这将具有一个非常复杂的类的缺点（并且 PMD 已经在抱怨圈复杂性），但是所有这些逻辑都将封装在一个类中，并且从整体 API 的角度来看可能会导致更少的复杂性。

我对这个应用程序的一个目标是确保如果我们必须更改数据持久性的细节，我们需要做的就是更改 DAO 实现——如果我们必须开始与不同的计费系统交互，除了在 DAO 级别之外，我不希望应用程序的任何部分发生更改。

有什么意见吗？当“业务逻辑”和“数据访问逻辑”似乎重叠时，您在决定在哪里分解它们时使用什么样的策略？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-28T14:58:17.670

> 当“业务逻辑”和“数据访问逻辑”似乎重叠时，您在决定在哪里分解它们时使用什么样的策略？

也许你可以有三层而不是两层：“一个额外的间接级别”。

在顶层，您可能有不了解数据访问的业务逻辑：该业务层使用 、 等类`User`，`Account`可能还有一些工厂方法，例如`User.getAccounts`和`Account.getOwners`。

底层可能是数据访问层，它是您的包装器或外观，无论您的数据层是什么。

在这两个层之间，一个层知道您的业务对象是什么（例如用户和帐户），但不知道您的业务逻辑是什么。中间层知道你的数据访问层。中间层的工作是使用数据访问层的 API 来 I/O 业务对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T16:00:55.733

“我不确定在业务/服务层类和 DAO 之间的界限在哪里。”

我们不都是吗？

我建议使用 ORM（[iBatis](http://ibatis.apache.org/)、[Hibernate](http://www.hibernate.org/)、[Toplink](http://www.oracle.com/technology/products/ias/toplink/index.html)等）。不要实现自己的 DAO。

# c++ - 热（堆在顶部）队列

> ID：487866
> 
> 赞同：7
> 
> 时间：2009-01-28T14:43:48.713
> 
> 标签：c++

谁能给我指出一个 HOT Queue 的示例实现，或者就如何实现一个提供一些指示？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T17:10:11.033

[这是](http://www.lonesock.net/misc.html)我发现的一个页面，它至少为您可能使用哪些数据结构来实现这一点提供了线索。向下滚动到名为“使 A* 可扩展”的部分。不幸的是，有关该主题的学术论文提到编写了 C++ 代码但没有提供任何代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T20:59:19.843

这是描述 HOT 队列的论文的链接。它非常抽象，这就是为什么我想看一个编码示例（我仍在努力解决它）。 [http://www.star-lab.com/goldberg/pub/neci-tr-97-104.ps](http://www.star-lab.com/goldberg/pub/neci-tr-97-104.ps)

“最便宜的”，可以说是这个变体是一个两级堆队列（也许这听起来更熟悉）。我想做的是提高 Dijkstra 最短路径算法的运行时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T15:19:50.710

> 我想做的是提高 Dijkstra 最短路径算法的运行时间。

您是否考虑过使用[Boost Graph Library](http://www.boost.org/doc/libs/1_37_0/libs/graph/doc/table_of_contents.html)？如果您使用自己的算法实现，则使用[BGL 提供](http://www.boost.org/doc/libs/1_37_0/libs/graph/doc/dijkstra_shortest_paths.html)的算法可能已经获得了更好的结果。

但是，修改您的代码以使其与 BGL 一起使用可能并非易事。

当然，通过完全不使用 Dijkstra 而是使用另一种算法也可以获得加速。

# .net - 允许用户对 DataGridView 中的 LINQ 查询中的列进行排序

> ID：487870
> 
> 赞同：8
> 
> 时间：2009-01-28T14:44:54.373
> 
> 标签：.net, linq, data-binding, datagridview, bindingsource

我无法完全弄清楚如何允许在运行时填充的 DataGridView 进行排序（当用户单击列标题时），其中来自 XML 查询的 LINQ 是 DataSource，通过 BindingSource。

```
 Dim QueryReOrder = From Q In Query _
                       Where ((0 - Q.Qualifier) / cmbTSStakeValue.Text) <= 0.1 _
                       Order By Q.Qualifier Descending _
                       Select Q

    Dim bs As New BindingSource
    bs.DataSource = QueryReOrder
    DGFindMatch.DataSource = bs 
```

DataGridView 的一些属性是：

```
Sort            Nothing String
SortProperty                Nothing System.ComponentModel.PropertyDescriptor
SupportsAdvancedSorting         False   Boolean
SupportsChangeNotification      True    Boolean
SupportsFiltering           False   Boolean
SupportsSearching           False   Boolean
SupportsSorting             False   Boolean 
```

是否有一个简单的解决方案允许用户通过单击列标题对这些值进行排序？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T03:03:29.010

您需要将 LINQ 查询的结果转换为支持排序功能的东西。这通常通过从 BindingList 派生一个类并在派生类中实现排序核心功能来完成。

有许多实现示例可供选择，而且实现起来非常简单。[这是在 MSDN 上执行此操作的示例](http://msdn.microsoft.com/en-us/library/aa480736.aspx)。

实现此功能后，您只需将结果放入其中并将其用作数据源，并且网格应允许用户使用列进行排序。

```
 //I know that you asked the question in VB.NET but I don't know the syntax that well.
    public class SortableBindingList<T> : BindingList<T>
    {
         //override necessary sort core methods
    }

    SortableBindingList<string> list = new SortableBindingList<string>(QueryReOrder.ToList());

    //use list as your DataSource now 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-04T13:30:14.077

我的默认方法是将所有内容复制到 DataTable 并将 DataGridView 绑定到它。

显然，如果您想添加分页，那将无法正常工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-17T20:29:48.940

是的，所以我为此挣扎了一段时间。关于为每个类创建自定义通用 IBindingList 的所有相同答案。如果网格视图中的列不是静态的，那将是一项疯狂的工作。我希望能够更改我的 linq 查询，而不必更改或更新实现自定义 IBindingList 的类。所以，这就是我所做的：

1）获取您的**IEnumerable**查询。

```
var query = from o in m_ds.Objective

        join ot in m_ds.ObjectiveType on o.ObjectiveTypeId equals ot.Id
        join dst in m_ds.DevelopmentStatusType on o.DevelopmentStatusTypeId equals dst.Id
        join rt in m_ds.ResultType on o.PrecedenceResultTypeId equals rt.Id

        select new
        {
            o.Id,
            type = ot.Description,
            precedence = rt.Description,
            o.Symbol,
            o.Title,
        }; 
```

2）将该**IEnumerable**结果集转换为**DataTable**！

```
public static DataTable DataTableFromIEnumerable( IEnumerable ien )
{
    DataTable dt = new DataTable();
    foreach ( object obj in ien )
    {
        Type t = obj.GetType();
        PropertyInfo[] pis = t.GetProperties();
        if ( dt.Columns.Count == 0 )
        {
            foreach ( PropertyInfo pi in pis )
            {
                dt.Columns.Add( pi.Name, pi.PropertyType );
            }
        }

        DataRow dr = dt.NewRow();
        foreach ( PropertyInfo pi in pis )
        {
            object value = pi.GetValue( obj, null );
            dr[ pi.Name ] = value;
        }

        dt.Rows.Add( dr );
    }

    return dt;
} 
```

3) 将您的**DataGridView**绑定到该*通用* **DataTable**对象。

```
var query = SqlHelper.GetFilteredObjective();
var bs = new BindingSource();
bs.DataSource = Utils.DataTableFromIEnumerable( query );
dgvObjectives.DataSource = bs; 
```

4) 就是这样。一个实用功能，你就完成了:)

向编写上述函数以从 IEnumerable 变为 DataTable 的 Alberto Poblacion 的道具： [函数线程](http://www.eggheadcafe.com/software/aspnet/31867968/convert-ienumerable-to-datatable.aspx)

*时间：2019-04-01 标签：c#datagridview sortable linq to ADO.NET*

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T17:28:17.190

您需要将查询结果作为 AsEnumerable() 获取。

Dim QueryReOrder = (From Q In Query _ Where ((0 - Q.Qualifier) / cmbTSStakeValue.Text) <= 0.1 _ Order By Q.Qualifier Descending _ Select Q).AsEnumerable()

我应该提到我通常在 C# 中，所以你可能不得不稍微改变语法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-08-06T08:03:20.137

在此页面中仅使用 MySortableBindingList 类[Implementing-a-Sortable-BindingList-](http://www.codeproject.com/Articles/31418/Implementing-a-Sortable-BindingList-Very-Very-Quic)

然后

var yourLinqList = ...;

MySortableBindingList sortList = new MySortableBindingList(yourLinqList);

dataGridView1.DataSource = 排序列表；

那么当单元格标题单击时，您的 dataGridView 必须进行排序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-14T18:41:23.350

可以在此处找到另一个链接，该链接提供了如何构造 SortableBindingList 的完整示例，如[Brian ONeil 的回答中所述：](https://stackoverflow.com/questions/487870/allow-user-to-sorting-columns-from-a-linq-query-in-a-datagridview-vb2008/846592#846592)

[自定义数据对象的可排序绑定列表](http://www.tech.windowsapplication1.com/content/sortable-binding-list-custom-data-objects)

我几乎可以一字不差地使用这个例子。

# security - 您是否更改 cookie 身份验证用户的身份验证令牌？如果有，多久一次？

> ID：487876
> 
> 赞同：1
> 
> 时间：2009-01-28T14:46:12.123
> 
> 标签：security, authentication, authorization

当用户登录时，我给他们一个名为 auth 的 cookie，其值是一个 GUID，它会在 2 周后过期。我将散列的 GUID 与他们的用户 ID 的盐一起保存在数据库中，然后在它到期时显示日期。当用户访问该站点时，我会检查 cookie 并在其匹配且未在数据库中过期时将其登录。

在 2 周结束之前的某个时间点，我正在考虑更新行并增加过期日期。你多久这样做一次？每个页面请求似乎都太频繁了，因为我会不断地写入用户表。

此时我也在考虑更改 auth cookie 的值。这样做的缺点是您无法在多台计算机/浏览器上进行身份验证。

我可以通过会话 cookie 来完成此操作，因此这种重写在每个会话中只发生一次。当用户访问一个页面时，我会检查一个名为 authenticated 的会话 cookie。如果它不存在，我给他们一个新的身份验证 cookie 值和身份验证会话 cookie，并增加数据库和身份验证 cookie 中的到期时间。如果是，我只是验证 auth cookie。

在您注销并重新登录之前，StackOverflow 似乎永远不会更改他们的身份验证 cookie。这似乎使其更容易受到会话劫持 - 如果您获得身份验证 cookie，您可以访问用户帐户，直到他们再次登录。由于他们的身份验证 cookie 不会过期或更改，因此您登录后不会注销用户。

*   您是否允许用户从多个位置/浏览器登录？
*   如果没有，您多久更改一次他们的身份验证令牌？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-28T14:52:43.720

这取决于安全级别，我工作过的地方通常必须有点高。

1.  不，我们不允许人们从多个浏览器登录。
2.  我们让人们在闲置 20 分钟后再次登录。根据您希望将人员超时的准确程度决定了您想要更新令牌的频率。每次用户将帖子发回系统时，我一直在更新过期时间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T15:08:58.460

嗯，我在这里找到了所有答案。看起来我需要一个连接表>.<。

[http://fishbowl.pastiche.org/2004/01/19/persistent_login_cookie_best_practice/](http://fishbowl.pastiche.org/2004/01/19/persistent_login_cookie_best_practice/)

# php - 在 GoDaddy (PHP) 上劫持会话变量有多容易

> ID：487889
> 
> 赞同：3
> 
> 时间：2009-01-28T14:50:09.807
> 
> 标签：php, security, session-hijacking

[这篇文章](http://www.sitepoint.com/article/php-security-blunders/)指出

> 如果您的站点在共享 Web 服务器上运行，请注意任何会话变量都可以被同一服务器上的任何其他用户轻松查看。

在像 GoDaddy 这样的大型主机**上，真的没有针对这种情况的保护措施吗？**真的有那么容易吗？如果就这么简单，**那么我主机上其他用户的会话变量在哪里，以便我可以查看它们？**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-28T14:58:52.567

这非常简单，因为默认情况下[`php.ini#session.save_path`](http://us3.php.net/manual/en/session.configuration.php#ini.session.save-path)指向`/tmp`Linux 安装和类似的 Windows。这很糟糕，因为大多数用户都拥有读写权限，`/tmp`因为他们需要这些权限。您可以通过将会话状态存储在数据库中或通过更改 PHP 应用程序存储其会话文件的方式来防止这种情况，使用[`session_save_path`](http://us3.php.net/session_save_path)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T14:56:26.130

默认情况下，会话文件存储在 php.ini中[session.save_path给出的位置。](http://php.net/manual/en/session.configuration.php#ini.session.save-path)虽然这可以为每个虚拟主机单独定义，但文件必须可由 httpd 进程读取，因此如果您知道位置，您的脚本可以从另一个虚拟主机读取会话文件。

您可以将会话存储在数据库中（例如，[使用 ADODb](http://phplens.com/lens/adodb/docs-session.htm)），假设服务器的其他用户无法读取您的 PHP 源代码以了解您的数据库凭据！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T15:08:21.860

如果您使用 PHP 并担心会话劫持，请查看`session_regenerate_id`（[链接到手册](http://php.net/session_regenerate_id)）。

这不会解决这里其他人提到的 session_save 路径公开的问题，但它应该可以防止 99.999% 的劫持尝试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-21T10:03:53.937

我建议您将会话数据存储在数据库中以避免这些问题，它还有一个额外的好处是可以轻松访问来自用户会话的实时信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T08:51:41.157

使用 session.save_path 来设置、保存和处理仅在您的帐户空间内的访问者会话，只要您在分片主机上。

那么除了您和您​​的主机拥有目录访问权限的员工之外，没有人可以访问它们。

永远不要依赖共享主机上的默认会话处理程序/位置！

```
<?php

        $handle = opendir(session_save_path());
        if ($handle == false)
            {
                return -1;
            }
        while (($file = readdir($handle)) !== false)
            {
                echo session_save_path() . '/' . $file .':<BR />';
                if (ereg("^sess", $file))
                    {
                        $file_array = file(session_save_path() . '/' . $file);
                        foreach ($file_array as $this_line)
                            {
                                echo $this_line."<BR />";
                            }
                echo '<BR /><BR />';

                    }
            }
        closedir($handle);

?> 
```

# linux - 如何在 shell 脚本中向文件中添加一行？

> ID：487894
> 
> 赞同：45
> 
> 时间：2009-01-28T14:53:19.100
> 
> 标签：linux, shell, sed

我想在现有的 CSV 文件中添加一行标题，并就地编辑。我怎样才能做到这一点？

```
echo 'one, two, three' > testfile.csv 
```

我想结束

```
column1, column2, column3
one,     two,     three 
```

我无法更改初始 CSV 输出。

任何标准命令都可以。重要的是文件被编辑到位，并且在文件的开头插入了行。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-01-28T17:14:42.653

要回答您最初的问题，以下是使用 sed 的方法：

```
sed -i '1icolumn1, column2, column3' testfile.csv 
```

“1i”命令告诉 sed 转到第 1 行并在那里插入文本。

-i 选项使文件被“就地”编辑，也可以采用可选参数来创建备份文件，例如

```
sed -i~ '1icolumn1, column2, column3' testfile.csv 
```

会将原始文件保留在“testfile.csv~”中。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-01-28T15:21:57.217

这会在文件开头添加自定义文本：

```
echo 'your_custom_escaped_content' > temp_file.csv
cat testfile.csv >> temp_file.csv
mv temp_file.csv testfile.csv 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-28T14:57:44.613

这不使用 sed，但使用 >> 将附加到文件。例如：

```
echo 'one, two, three' >> testfile.csv 
```

**编辑**：要添加到文件中，请尝试以下操作：

```
echo "text"|cat - yourfile > /tmp/out && mv /tmp/out yourfile 
```

我通过快速[谷歌搜索](http://www.google.com/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=ySC&q=prepend+to+a+file+linux&btnG=Search)找到了这个。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-28T15:10:06.087

据我了解，您想`column1, column2, column3`在现有的`one, two, three`.

我会使用`ed`, 代替`sed`，因为`sed`写入标准输出而不是文件中。

命令：

```
printf '0a\ncolumn1, column2, column3\n.\nw\n' | ed testfile.csv 
```

应该做的工作。

`perl -i`也值得一看。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-28T15:00:53.607

sed 是基于行的，所以我不确定您为什么要使用 sed 来执行此操作。范式更多的是一次处理一行（您也可以通过编程方式找到 CSV 中的字段数并使用 awk 生成标题行）为什么不只是

```
echo "c1, c2, ... " >> file
cat testfile.csv >> file 
```

?

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T15:28:31.993

使用 perl -i，命令将第 1 行的开头替换为您要插入的内容（.bk 将具有备份原始文件的效果）：

```
perl -i.bk -pe 's/^/column1, column2, column3\n/ if($.==1)' testfile.csv 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-08T05:00:20.943

在两个命令的文件开头添加给定行：

```
cat <(echo "blablabla") input_file.txt > tmp_file.txt
mv tmp_file.txt input_file.txt 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-06-09T16:43:26.740

如何在文件中添加行

```
sed -i -e "48r../../../../folder1/lines_to_add.txt" a.txt 
```

> a.txt - 您要更改的文件 48r 是 a.txt 的行号 有些行在lines_to_add.txt 文件中

```
../../../../scripts3_2d/lines_to_add.txt 
```

> -i 更新 a.txt，在运行代码之前尝试不使用 -i，小心新行，

```
"keep a newline at the end of lines_to_add.txt" 
```

# msbuild - 迁移到 TFS 2008，构建不再将资源 dll 移动到 bin 文件夹

> ID：487895
> 
> 赞同：1
> 
> 时间：2009-01-28T14:53:33.093
> 
> 标签：msbuild

我们最近将源代码控制从 2005 年移至 2008 年，并且 Web 项目构建已停止将引用（项目引用）resx 文件的资源 dll 复制到 bin 文件夹中（它们与 _publishedWebsites 保持在同一级别）。我在构建中看不到任何不同（它仍然设置为混合平台），但是在 _CopyWebApplication 目标处，副本忽略了这些文件夹，有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-28T19:48:39.737

看起来我们的 web 应用程序的目标文件有问题，我复制了旧文件并且构建工作正常。没有完全回答为什么，但它让我们工作。如果我有机会区分它们，我会发布结果

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-27T09:48:37.563

如果您有机会，请发布您的答案，因为我最近遇到了同样的问题。引用的项目 .dll 未放置在 _PublishedWebsites 文件夹中，而是放置在同一级别。

# java - 如何将 Java 系统属性传递给 maven-cargo 容器

> ID：487901
> 
> 赞同：2
> 
> 时间：2009-01-28T14:54:27.693
> 
> 标签：java, testing, maven-2, continuous-integration, maven-cargo

我正在为持续集成准备一个 maven2 Web 项目。在运行集成测试之前，我使用[maven cargo 插件](http://cargo.codehaus.org/Maven2+plugin)自动将 WAR 部署到 Tomcat6x。

我的代码取决于一些用`MAVEN_OPTS=-Dfoo=bar`. 不幸的是，当应用程序部署到 Tomcat 时，这些属性会丢失：

```
System.getProperty("foo"); // null, when deployed to container by maven-cargo 
```

如何将这些属性传递给 Tomcat？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T07:15:19.617

您应该可以通过在插件的容器定义中使用 systemProperties 标记来做到这一点：

```
 <container>
        [...]
      <systemProperties>
        <MAVEN_OPTS>-Dfoo=bar</MAVEN_OPTS>
      </systemProperties>
    </container> 
```

或者，您可以在 $CATALINA_HOME/bin/ 目录中的 setenv.sh（在 linux 上）文件中进行设置。如果此文件不存在，您应该创建它并添加以下行：

```
MAVEN_OPTS=-Dfoo=bar 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-09T16:02:34.300

您应该可以通过在插件的容器定义中使用 systemProperties 标记来做到这一点：

```
<container>
  <systemProperties>
    <foo>bar</foo>
  </systemProperties>
</container> 
```

这相当于在命令行或其他选项中传递 -Dfoo=bar 。

# c# - 您发现了扩展方法的哪些优点？

> ID：487904
> 
> 赞同：84
> 
> 时间：2009-01-28T14:55:55.397
> 
> 标签：c#, extension-methods

一个 C# 的“非信徒”问我扩展方法的目的是什么。我解释说，然后您可以向已定义的对象添加新方法，尤其是当您不拥有/控制原始对象的源时。

他提出“为什么不给你自己的类添加一个方法？” 我们一直在兜兜转转（以一种好的方式）。我的一般反应是它是工具带中的另一个工具，他的回答是这是对工具的无用浪费......但我认为我会得到一个更“开明”的答案。

在哪些情况下您使用了无法（或不应该）使用添加到您自己的类中的方法的扩展方法？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-01-28T15:04:36.830

扩展方法的**唯一**优点是代码可读性。就是这样。

扩展方法允许您这样做：

```
foo.bar(); 
```

而不是这个：

```
Util.bar(foo); 
```

现在C#中有很多东西都是这样的。换句话说，C# 中有许多看似微不足道的特性，它们本身并没有太大的好处。但是，一旦您开始将这些功能组合在一起，您就会开始看到比其部分总和大一点的东西。LINQ 从扩展方法中受益匪浅，因为没有它们，LINQ 查询几乎无法读取。如果没有扩展方法， LINQ 是*可能的*，但不实用。

扩展方法很像 C# 的部分类。它们本身并不是很有帮助，而且看起来微不足道。但是当您开始使用需要生成代码的类时，部分类开始变得更有意义。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-01-28T15:07:21.927

我认为扩展方法在编写代码时很有帮助，如果您将扩展方法添加到基本类型，您将在智能感知中快速获得它们。

我有一个格式提供程序来[格式化文件大小](https://stackoverflow.com/questions/128618/c-file-size-format-provider)。要使用它，我需要编写：

```
Console.WriteLine(String.Format(new FileSizeFormatProvider(), "{0:fs}", fileSize)); 
```

创建一个我可以编写的扩展方法：

```
Console.WriteLine(fileSize.ToFileSize()); 
```

更干净更简单。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-01-28T15:01:42.313

不要忘记工具！当您在 Foo 类型上添加扩展方法 M 时，您会在 Foo 的智能感知列表中获得“M”（假设扩展类在范围内）。这使得 'M' 比 MyClass.M(Foo,...) 更容易找到。

归根结底，它只是其他静态方法的语法糖，但就像买房子一样：“位置，位置，位置！” 如果它挂在类型上，人们会找到它！

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2009-01-28T15:18:03.153

我遇到的扩展方法的另外两个好处：

*   一个流畅的接口可以封装在一个静态类的扩展方法中，从而实现核心类和它的流畅扩展的关注点分离；我已经看到实现了更高的可维护性。
*   扩展方法可以挂在接口之外，从而允许您指定合同（通过接口）和相关的一系列基于接口的行为（通过扩展方法），再次提供关注点分离。一个示例是 Linq 扩展方法，如`Select(...)`,`Where(...)`等。挂在`IEnumerable<T>`接口之外。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2009-01-28T15:52:53.003

我对扩展方法的一些最佳用途是能够：

1.  扩展第三方对象的功能（无论是商业的还是我公司内部的，但由单独的组管理），在许多情况下将标记为`sealed`.
2.  无需实现抽象类即可为接口创建默认功能

举个例子，`IEnumerable<T>`。虽然它有丰富的扩展方法，但我发现它没有实现通用的 ForEach 方法很烦人。所以，我自己做了：

```
public void ForEach<T>(this IEnumerable<T> enumerable, Action<T> action)
{
    foreach ( var o in enumerable )
    {
        action(o);
    }
} 
```

瞧，我的所有`IEnumerable<T>`对象，无论实现类型如何，无论是我编写还是其他人现在都`ForEach`通过在我的代码中添加适当的“使用”语句来获得方法。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-01-28T15:01:49.677

使用扩展方法的重要原因之一是 LINQ。如果没有扩展方法，您在 LINQ 中可以做的很多事情都会非常困难。Where()、Contains()、Select 扩展方法意味着更多的功能被添加到现有类型而不改变它们的结构。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2010-01-21T21:44:36.237

关于扩展方法的**优点**有很多答案；如何解决**缺点**？

最大的缺点是，如果您在同一上下文中拥有具有相同签名的常规方法和扩展方法，则不会出现编译器错误或警告。

假设您创建了一个应用于特定类的扩展方法。然后后来有人在该类本身上创建了一个具有相同签名的方法。

您的代码将编译，您甚至可能不会收到运行时错误。 **但是您不再运行与以前相同的代码。**

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-01-28T15:05:01.073

**Greg Young 在[CodeBetter上演示的](http://codebetter.com/gregyoung/2007/12/05/a-use-for-extension-methods/)**流畅接口和上下文敏感性****

 *** * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-28T15:04:31.590

我对扩展方法的个人观点是，它们非常适合 OOP 设计：考虑简单的方法

```
bool empty = String.IsNullOrEmpty (myString) 
```

相比

```
bool empty = myString.IsNullOrEmpty (); 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-02-05T05:15:22.830

关于扩展方法可以让你做什么，上面有很多很好的答案。

我的简短回答是——它们几乎消除了对工厂的需求。

我只想指出它们不是一个新概念，对它们的最大验证之一是它们是 Objective-C 中的杀手级特性（*类别*）。它们为基于框架的开发增加了极大的灵活性，以至于 NeXT 将 NSA 和华尔街金融建模师作为主要用户。

REALbasic 也将它们作为*扩展方法来*实现，它们在简化开发方面也有类似的用途。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-09-15T19:21:24.927

我想在这里支持其他答案，这些答案提到提高代码可读性是扩展方法背后的一个重要原因。我将通过两个方面来证明这一点：方法链接与嵌套方法调用，以及使用无意义的静态类名使 LINQ 查询混乱。

* * *

让我们以这个 LINQ 查询为例：

```
numbers.Where(x => x > 0).Select(x => -x) 
```

`Where`和都是`Select`扩展方法，在静态类中定义`Enumerable`。因此，如果扩展方法不存在，并且这些是普通的静态方法，那么最后一行代码基本上必须如下所示：

```
Enumerable.Select(Enumerable.Where(numbers, x => x > 0), x => -x) 
```

看看这个查询刚刚得到了多少。

* * *

其次，如果您现在想引入自己的查询运算符，您自然无法在`Enumerable`静态类中定义它，就像所有其他标准查询运算符一样，因为`Enumerable`它在框架中，您无法控制该类。因此，您必须定义自己的包含扩展方法的静态类。然后，您可能会收到如下查询：

```
Enumerable.Select(MyEnumerableExtensions.RemoveNegativeNumbers(numbers), x => -x)
//                ^^^^^^^^^^^^^^^^^^^^^^
//                different class name that has zero informational value
//                and, as with 'Enumerable.xxxxxx', only obstructs the
//                query's actual meaning. 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-28T15:07:37.853

确实，您可以将（扩展）方法直接添加到您的类中。但并非所有课程都是由您编写的。来自核心库或第三方库的类通常是封闭的，没有扩展方法就不可能获得语法糖。但请记住，扩展方法就像例如（静态）独立方法。C++

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-01-28T17:02:55.017

扩展方法还可以帮助保持您的类和类依赖项干净。例如，在使用 Foo 的任何地方，您可能都需要 Foo 类的 Bar() 方法。但是，您可能希望在另一个程序集中使用 .ToXml() 方法，并且仅用于该程序集。在这种情况下，您可以在该程序集中而不是在原始程序集中添加必要的 System.Xml 和/或 System.Xml.Linq 依赖项。

好处：定义类程序集中的依赖关系减少到仅是必需品，并且将阻止其他消费程序集使用 ToXml() 方法。请参阅[此 PDC 演示文稿](http://blogs.msdn.com/brada/archive/2008/10/29/framework-design-guidelines-slides-from-pdc2008-talk.aspx)以获取更多参考。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-09-15T18:21:25.343

我同意扩展方法增加了代码的可读性，但它实际上只是静态辅助方法。

IMO 使用扩展方法向您的类添加行为可以是：

困惑：程序员可能认为方法是扩展类型的一部分，因此不理解为什么不导入扩展命名空间时方法会消失。

反模式：您决定使用扩展方法向框架中的类型添加行为，然后将它们发送给某个人进行单元测试。现在他被困在一个包含一堆他无法伪造的方法的框架中。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-01-28T15:08:43.217

扩展方法实际上是Martin Fowler 书中[“引入外部方法”](http://www.refactoring.com/catalog/introduceForeignMethod.html)重构的 .NET 合并（直至方法签名）。它们具有基本相同的好处和陷阱。在有关此重构的部分中，他说当您无法修改应该真正拥有该方法的类时，它们是一种解决方法。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-01-28T15:34:22.917

我主要将扩展方法视为一种承认，也许它们不应该禁止免费功能。

在 C++ 社区中，通常认为良好的 OOP 实践是更喜欢免费的非成员函数而不是成员，因为这些函数不会通过访问它们不需要的私有成员来破坏封装。扩展方法似乎是实现相同目标的一种迂回方式。也就是说，对于无法访问私有成员的静态函数来说，这是一种更简洁的语法。

扩展方法只不过是语法糖，但我认为使用它们没有任何害处。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-02-01T04:45:28.897

*   对对象本身进行智能感知，而不必调用一些丑陋的实用程序函数
*   对于转换函数，可以将“XToY(X x)”更改为“ToY(this X x)”，从而得到漂亮的 x.ToY() 而不是丑陋的 XToY(x)。
*   扩展您无法控制的课程
*   当不希望向类本身添加方法时扩展类的功能。例如，您可以保持业务对象的简单和无逻辑，并在扩展方法中添加具有丑陋依赖关系的特定业务逻辑

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-02-05T04:19:59.307

我使用它们来重用我的对象模型类。我有一堆代表我在数据库中拥有的对象的类。这些类在客户端仅用于显示对象，因此基本用法是访问属性。

```
public class Stock {
   public Code { get; private set; }
   public Name { get; private set; }
} 
```

由于这种使用模式，我不想在这些类中包含业务逻辑方法，因此我将每个业务逻辑都作为扩展方法。

```
public static class StockExtender {
    public static List <Quote> GetQuotesByDate(this Stock s, DateTime date)
    {...}
} 
```

通过这种方式，我可以将相同的类用于业务逻辑处理和用户界面显示，而不会用不必要的代码使客户端超载。

关于这个解决方案的一个有趣的事情是我的对象模型类是使用[Mono.Cecil](http://www.mono-project.com/Cecil)动态生成的，所以即使我想要添加业务逻辑方法也会非常困难。我有一个编译器，它读取 XML 定义文件并生成这些存根类，这些存根类代表我在数据库中拥有的一些对象。在这种情况下，唯一的方法是扩展它们。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-01-28T15:06:09.917

它允许 C# 更好地支持动态语言、LINQ 和其他十几种东西。查看[Scott Guthrie 的文章](http://weblogs.asp.net/scottgu/archive/2007/03/13/new-orcas-language-feature-extension-methods.aspx)。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-01-28T15:26:36.660

在我的上一个项目中，我使用扩展方法将 Validate() 方法附加到业务对象。我证明了这一点是因为可序列化数据传输对象的业务对象将在不同的域中使用，因为它们在一般电子商务实体（如产品、客户、商家等）中使用。在不同的域中，业务规则也可能不同，所以我封装了我的附加到我的数据传输对象的基类的 Validate 方法中的后期绑定验证逻辑。希望这是有道理的:)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-01-29T00:15:27.500

扩展方法非常有用的一种情况是在使用 ASMX Web 服务的客户端应用程序中。由于序列化，Web 方法的返回类型不包含任何方法（只有这些类型的公共属性在客户端可用）。

扩展方法允许用于向 Web 方法返回的类型添加功能（在客户端），而无需在客户端创建另一个对象模型或大量包装类。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-09-15T18:25:51.740

扩展方法可用于在 C#中创建[一种 mixin 。](http://codecrafter.blogspot.com/2010/02/c-quasi-mixins-pattern.html)

反过来，这为正交概念提供了更好的关注点分离。以这个[答案](https://stackoverflow.com/questions/3610891/c-copying-property-values-from-one-instance-to-another-different-classes/3611351#3611351)为例。

这也可用于启用C# 中的*角色，这是*[DCI 架构](http://www.artima.com/articles/dci_vision.html)的核心概念。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2011-01-15T21:01:12.110

还请记住，添加扩展方法是为了帮助 Linq 查询在其 C# 样式中使用时更具可读性。

这两种做作是绝对等价的，但第一种更具可读性（并且随着更多方法链接，可读性的差距当然会增加）。

```
int n1 = new List<int> {1,2,3}.Where(i => i % 2 != 0).Last();

int n2 = Enumerable.Last(Enumerable.Where(new List<int> {1,2,3}, i => i % 2 != 0)); 
```

请注意，完全限定的语法甚至应该是：

```
int n1 = new List<int> {1,2,3}.Where<int>(i => i % 2 != 0).Last<int>();

int n2 = Enumerable.Last<int>(Enumerable.Where<int>(new List<int> {1,2,3}, i => i % 2 != 0)); 
```

偶然地，不需要明确提及和的类型参数，因为这两个方法的第一个参数的存在可以推断它们（由关键字引入`Where`并使其成为扩展方法的参数）。`Last``this`

这一点显然是扩展方法的一个优势（除其他外），您可以在涉及方法链接的每个类似场景中从中受益。

特别是，我发现它是一种更优雅和令人信服的方式，它有一个可由任何子类调用的基类方法，并返回对该子类的强类型引用（使用子类类型）。

例子（好吧，这个场景很俗气）：一个晚安之后，一只动物睁开眼睛然后哭了；每只动物都以同样的方式睁开眼睛，而狗叫，鸭子叫。

```
public abstract class Animal
{
    //some code common to all animals
}

public static class AnimalExtension
{
    public static TAnimal OpenTheEyes<TAnimal>(this TAnimal animal) where TAnimal : Animal
    {
        //Some code to flutter one's eyelashes and then open wide
        return animal; //returning a self reference to allow method chaining
    }
}

public class Dog : Animal
{
    public void Bark() { /* ... */ }
}

public class Duck : Animal
{
    public void Kwak() { /* ... */ }
}

class Program
{
    static void Main(string[] args)
    {
        Dog Goofy = new Dog();
        Duck Donald = new Duck();
        Goofy.OpenTheEyes().Bark(); //*1
        Donald.OpenTheEyes().Kwak(); //*2
    }
} 
```

从概念上讲`OpenTheEyes`应该是一个`Animal`方法，但它会返回一个抽象类的实例`Animal`，它不知道特定的子类方法，如`Bark`or`Duck`或其他。注释为 *1 和 *2 的 2 行将引发编译错误。

但是由于扩展方法，我们可以拥有一种“知道调用它的子类类型的基本方法”。

请注意，一个简单的通用方法可以完成这项工作，但以一种更尴尬的方式：

```
public abstract class Animal
{
    //some code common to all animals

    public TAnimal OpenTheEyes<TAnimal>() where TAnimal : Animal
    {
        //Some code to flutter one's eyelashes and then open wide
        return (TAnimal)this; //returning a self reference to allow method chaining
    }
} 
```

这一次，没有参数，因此没有可能的返回类型推断。调用可以是：

```
Goofy.OpenTheEyes<Dog>().Bark();
Donald.OpenTheEyes<Duck>().Kwak(); 
```

...如果涉及更多链接，这可能会给代码带来很大的负担（尤其是知道类型参数将始终`<Dog>`在 Goofy 的线路和`<Duck>`Donald 的线路上......）

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-01-28T14:58:43.503

我只有一个词要说：**可维护性**这是扩展方法使用的关键

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-01-28T16:23:34.753

我认为扩展方法有助于编写更清晰的代码。

正如您的朋友所建议的那样，您没有将新方法放入您的类中，而是将其放入 ExtensionMethods 命名空间中。通过这种方式，您可以保持班级的逻辑秩序感。不真正直接处理你的类的方法不会把它弄得乱七八糟。

我觉得扩展方法使您的代码更清晰，组织更恰当。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-02-05T05:43:32.773

它允许您的编辑器/IDE 智能地自动完成建议。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2009-09-19T21:28:10.797

我喜欢他们构建 html。经常有一些部分被重复使用，或者在一个函数有用但会破坏程序流程的情况下递归生成。

```
 HTML_Out.Append("<ul>");
        foreach (var i in items)
            if (i.Description != "")
            {
                HTML_Out.Append("<li>")
                    .AppendAnchor(new string[]{ urlRoot, i.Description_Norm }, i.Description)
                    .Append("<div>")
                    .AppendImage(iconDir, i.Icon, i.Description)
                    .Append(i.Categories.ToHTML(i.Description_Norm, urlRoot)).Append("</div></li>");
            }

        return HTML_Out.Append("</ul>").ToString(); 
```

在某些情况下，对象需要为 HTML 输出准备自定义逻辑 - 扩展方法允许您添加此功能，而无需在类中混合表示和逻辑。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2010-01-21T21:29:25.653

我发现扩展方法对于匹配嵌套的泛型参数很有用。

这听起来有点奇怪 - 但假设我们有一个泛型 class `MyGenericClass<TList>`，并且我们知道 TList 本身是泛型的（例如 a `List<T>`），我认为没有任何扩展名的情况下没有办法从 List 中挖掘出嵌套的“T”方法或静态辅助方法。如果我们只有静态辅助方法可供我们使用，它 (a) 丑陋，并且 (b) 将迫使我们将属于该类的功能移动到外部位置。

例如，要检索元组中的类型并将它们转换为方法签名，我们可以使用扩展方法：

```
public class Tuple { }
public class Tuple<T0> : Tuple { }
public class Tuple<T0, T1> : Tuple<T0> { }

public class Caller<TTuple> where TTuple : Tuple { /* ... */ }

public static class CallerExtensions
{
     public static void Call<T0>(this Caller<Tuple<T0>> caller, T0 p0) { /* ... */ }

     public static void Call<T0, T1>(this Caller<Tuple<T0, T1>> caller, T0 p0, T1 p1) { /* ... */ }
}

new Caller<Tuple<int>>().Call(10);
new Caller<Tuple<string, int>>().Call("Hello", 10); 
```

也就是说，我不确定分界线应该在哪里——方法什么时候应该是扩展方法，什么时候应该是静态辅助方法？有什么想法吗？

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2010-12-04T12:23:45.807

我的屏幕上有输入区域，无论它们的确切类型是什么（文本框、复选框等），都必须实现标准行为。它们不能继承公共基类，因为每种类型的输入区域已经派生自特定类（TextInputBox 等）

也许通过继承层次结构我可以找到一个共同的祖先，比如 WebControl，但我没有开发框架类 WebControl，它也没有暴露我需要的东西。

使用扩展方法，我可以：

1）扩展WebControl类，然后在我所有的输入类上获取我的统一标准行为

2）或者让我所有的类都从一个接口派生，比如IInputZone，并用方法扩展这个接口。我现在可以在所有输入区域上调用与接口相关的扩展方法。由于我的输入区域已经从多个基类派生，因此我实现了一种多重继承。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2012-04-28T09:27:20.900

扩展方法有很多很好的例子……尤其是在上面发布的 IEnumerables 上。

例如，如果我有一个`IEnumerable<myObject>`我可以创建和扩展的方法`IEnumerable<myObject>`

```
mylist List<myObject>; 
```

...创建列表

```
mylist.DisplayInMyWay(); 
```

没有扩展方法将不得不调用：

```
myDisplayMethod(myOldArray); // can create more nexted brackets. 
```

另一个很好的例子是快速创建一个循环链表！

我不能把它归功于它！

[使用扩展方法的循环链表](https://stackoverflow.com/questions/716256/creating-a-circually-linked-list-in-c)

现在结合这些并使用扩展方法代码如下。

```
myNode.NextOrFirst().DisplayInMyWay(); 
```

而不是

```
DisplayInMyWay(NextOrFirst(myNode)). 
```

使用扩展方法它更整洁、更容易阅读并且更面向对象。也非常接近：

```
myNode.Next.DoSomething() 
```

把它展示给你的同事！:)

# .net - 安装项目未安装引用的项目内容文件

> ID：487905
> 
> 赞同：2
> 
> 时间：2009-01-28T14:56:16.253
> 
> 标签：.net, setup-project

我有一个 Windows 服务项目 A，它依赖于类库项目 B。项目 B 的 XML 文件设置为`Content`, `Copy if newer`。在`bin\Debug`项目A的文件夹中，这些内容文件复制成功。

**编辑（更多失败）：**

`Primary output`安装很好。我无法`Content Files`安装。

**编辑（获胜）：**

我错了，我`Primary Output`来自项目 A 并添加了一个自定义操作来安装它，因为它是服务 exe。`Content files`来自项目 B 只需包含在安装项目中......而不是作为自定义操作“安装”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T15:10:58.877

我想是的，是的。当我使用安装项目时，我必须明确引用项目 A 的主要输出和内容文件，以及项目 B 的所有 DLL 文件。

# java - Java 电话号码格式 API

> ID：487906
> 
> 赞同：30
> 
> 时间：2009-01-28T14:56:17.800
> 
> 标签：java

我有一个数据库，其中包含数百万个免费格式的电话号码。即，UI 不强制执行任何约束，用户可以输入任何他们想要的内容。

我正在寻找的是一个 Java API，它可以尽最大努力将这些转换为一致的格式。理想情况下，API 将获取自由文本值和国家代码并生成有效的国际电话号码或抛出异常。

例如，系统中的电话号码可能如下所示：

```
(555) 478-1123
555-478-1123    
555.478.1123
5554781123 
```

给定美国这个国家，API 将为所有这些产生值“+1 (555) 478-1123”。确切的格式并不重要，只要它是一致的。

系统中也有没有区号的号码，如“478-1123”。在这种情况下，我会期待 NoAreaCodeException 或类似的东西。

也可能有诸如“abc”之类的数据，它也应该抛出异常。

当然，我发布的示例有无数种变体，以及国际电话号码的巨大复杂性，其验证规则非常复杂。这就是为什么我不会考虑自己滚动。

有人见过这样的API吗？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-28T15:10:38.033

您可以自己编写（适用于美国电话 # 格式）：

*   从字符串中删除任何非数字字符
*   检查剩余的字符串是否为十个字符长
*   在前三个字符周围加上括号，在第六个和第七个字符之间加上一个破折号。
*   在字符串前面加上“+1”

* * *

### 更新：

Google 最近发布了用于解析、格式化、存储和验证国际电话号码的[libphonenumber 。](http://code.google.com/p/libphonenumber/)

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2010-10-26T09:49:01.843

你可以试试这个 Java 电话号码格式库[https://github.com/googlei18n/libphonenumber](https://github.com/googlei18n/libphonenumber)

它有数百个国家和格式的数据。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-07-18T13:20:39.027

# 简单的正则表达式解析器

```
/**
 * @param pPhoneNumber
 * @return true if the phone number is correct
 */
private boolean isPhoneNumberCorrect(String pPhoneNumber) {

    Pattern pattern = Pattern
            .compile("((\\+[1-9]{3,4}|0[1-9]{4}|00[1-9]{3})\\-?)?\\d{8,20}");
    Matcher matcher = pattern.matcher(pPhoneNumber);

    if (matcher.matches()) return true;

    return false;
} 
```

# 格式

我根据自己的需要做了这个，它接受数字：

1.  国家代码-号码
2.  数字

## 国家代码：

它们可能有一个：`+`，或者一个或两个零。然后，它后面可能会跟着一个`-`.

接受：

*   `+456`
*   `00456`
*   `+1234`
*   `01234`

以上所有内容可能会或可能不会跟随`-`

拒绝：

*   `0456`
    *   它应该是：
        *   `00456`或`+456`或`04444`

## 数字

一个简单的 8-20 位数字。

接受：

*   `00456-12345678`
*   `+457-12345678`
*   `+45712345678`
*   `0045712345678`
*   `99999999`

# 延长它？

随意，因此您可以包含对`.`或“（”分隔符的支持。只要确保您避开它们，例如`(`使用`\(`。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-28T15:00:22.173

我不知道这样的 API，但看起来可以通过使用正则表达式来完成。可能您无法将所有数字都转换为有效格式，但大多数数字都是如此。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-02-20T11:12:28.847

最新版本的[http://code.google.com/p/libphonenumber/](http://code.google.com/p/libphonenumber/)添加了许多新国家/地区的元数据，并为之前列出的一些国家/地区添加了更多详细信息。

当前源代码版本为 r74，.jar 文件版本为 2.6。以前的 .jar 文件是为 Java 1.6 编译的，但从 libphonenumber 2.5.1 版开始，它们现在是为 Java 1.5 及更高版本编译的。

不要忘记代码也可以直接移植到 JavaScript。它可以在[http://code.google.com/p/libphonenumber/source/browse/#svn%2Ftrunk%2Fjavascript的源代码树中找到](http://code.google.com/p/libphonenumber/source/browse/#svn%2Ftrunk%2Fjavascript)

欢迎提交错误报告。积极鼓励更新元数据，因为即使是许多国家/地区的官方政府发布的区号列表也不完整或已过时。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-01-09T15:08:03.597

不要重新发明轮子；使用 API，例如[http://libphonenumber.googlecode.com/](http://libphonenumber.googlecode.com/) 这个 API 也提供了很好的格式。 **示例**：

```
String number = "(555) 478-1123";
PhoneNumberUtil phoneNumberUtil = PhoneNumberUtil.getInstance();
try {
  Phonenumber.PhoneNumber phoneNumber = phoneNumberUtil.parse(number, Locale.US.getCountry());
} catch (NumberParseException e) {
  // error handling
} 
```

您甚至可以使用 phoneNumber 对象在将其保存到数据库或其他任何内容之前很好地将其格式化为有效的电话号码。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-09-01T08:31:20.857

对于看起来像“01 44 55 66 77”的法语号码，我们可以使用以下逻辑。

```
DecimalFormatSymbols dfs = new DecimalFormatSymbols();
dfs.setGroupingSeparator(' ');  // sometimes '.' is used
DecimalFormat decfmt = new DecimalFormat("0,0", dfs);  // enable grouping
decfmt.setMinimumIntegerDigits(10);  // we always have 10 digits
decfmt.setGroupingSize(2);  // necessary in order to group digits by 2 orders
System.out.println(decfmt.format(144556677));  // outputs "01 44 55 66 77" 
```

一旦可以做到这一点，使用其他人提到的谷歌电话号码 API，我们可以轻松地解析这些序列并将它们重新格式化为其他形式，例如“+33 1 44 55 66 77”，如下所示：

```
Iterable<PhoneNumberMatch> numbers = PhoneNumberUtil.getInstance().findNumbers(textWithPhoneNums, "FR");
for(Iterator<PhoneNumberMatch> iterator = numbers.iterator(); iterator.hasNext(); ){
    PhoneNumberMatch pnm = iterator.next();
    PhoneNumber number = pnm.number();
    System.out.println(PhoneNumberUtil.getInstance().formatOutOfCountryCallingNumber(number, null));
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-28T15:09:41.423

有一些商业程序可以格式化和验证国际电话号码，比如[这个](http://www.quentinsagerconsulting.com/documents/10025.htm)甚至可以检查某些国家/地区的有效区号。对于北美，[NANPA](http://www.nanpa.com/)提供了[一些](http://www.nanpa.com/area_codes/index.html)用于验证区号的资源。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-28T15:13:23.410

我认为没有一种方法可以识别缺少区号，除非您的号码全部来自一个国家（可能是美国），因为每个国家/地区都有自己的区号等规则。

[我会开始在这里](http://en.wikipedia.org/wiki/Telephone_numbering_plan)、[这里](http://www.wtng.info/)和[这里](http://www.itu.int/oth/T0202.aspx?parent=T0202)寻找详细信息——如果有 API 来处理它（在 Java 或其他语言中），它们也可能链接到那里。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-28T15:19:18.797

我找到的最好的是`javax.telephony`，可以在这里找到：http: [//java.sun.com/products/javaphone/](http://java.sun.com/products/javaphone/)

它有一个 Address 类，但遗憾的是，该类并没有解决您的问题 :( 好吧，也许您可​​以通过深入研究找到解决方案。

除此之外，我的第一个想法是使用正则表达式。但是，对于这个特定问题，这似乎是一种糟糕的解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-09-03T15:26:20.167

我自己的需求很简单。我只需要取一个 7 位或 10 位数字并在区号、交换机和交换机号之间放置分隔符（破折号、句点、一些字符串等）。传递给方法的不是全数字或长度不是 7 或 10 的任何值都将被简单地返回。空值返回一个空字符串，并且分隔符的空值被视为空字符串。我的代码：

```
import java.util.regex.Matcher;
import java.util.regex.Pattern;
// ...
private String formatPhoneNumber(String phnumber, String separator) {
  phnumber = (phnumber == null) ? "" : phnumber;
  if ((phnumber.length() != 7) && (phnumber.length() != 10)) { return phnumber; }

  // If we get here, 'phnumber' is for sure either 7 or 10 chars long

  separator = (separator == null) ? "" : separator;
  Pattern p = Pattern.compile("([0-9]*)");
  Matcher m = p.matcher(phnumber);
  if (m.matches()) {
   if (phnumber.length() == 7) {
     return phnumber.substring(0, 3) + separator + phnumber.substring(4);
    } else {
     return phnumber.substring(0, 3) + separator + phnumber.substring(3, 6)  
            + separator + phnumber.substring(6);
    }
  // If we get here, it means 1 or more of the chars in 'phnumber'
  // is not a digit and so 'phnumber' is returned just as passed in.
  return phnumber;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-02-25T10:27:37.920

我已经使用 libphonenumber 创建了一个 Helper 类，但它仍然存在可能性，即（用户主要将本地联系人中的本地号码保存为本地格式）我的意思是没有国家代码，因为它是本地号码，但会使用国家代码保存国际号码。如果数字是全局格式，这个助手适用于这两种情况，它会简单地保持原样，同时将本地数字转换为内部格式。以下是代码和用法

```
class PhoneNumberHelper {

    companion object {
        fun correctNumber(number: String, context: Context): String? {
            val code = StorageAdapter.get(context).userCountryCode
            return validateNumber(number, code)
        }

        private fun validateNumber(number: String, mUserCountryCode: Int): String? {
            return Utils.formatNumber(Utils.removeDelimetersFromNumber(number), mUserCountryCode)

        }

        fun formatNumber(destinationNumber: String, countryCode: Int): String? {
            try {
                val phoneUtil = PhoneNumberUtil.getInstance()
                val regionCode = phoneUtil.getRegionCodeForCountryCode(countryCode)

                var formattedNumber = formatNumber(destinationNumber, regionCode)
                if (TextUtils.isEmpty(formattedNumber)) {
                    formattedNumber = destinationNumber
                }
                return formattedNumber
            } catch (exp: Exception) {
                Log.e("formatNumber", exp.toString())
            }

            return destinationNumber
        }

        fun formatNumber(destinationNumber: String, regionCode: String): String? {

            if (TextUtils.isEmpty(regionCode)) {
                return null
            }

            var number: String? = null
            try {

                val phoneUtil = PhoneNumberUtil.getInstance()
                val phoneNumber = phoneUtil.parse(destinationNumber, regionCode)

                if (phoneUtil.isValidNumber(phoneNumber)) {

                    /*
                 * E164 format is as per international format but no
                 * formatting applied e.g. no spaces in between
                 */

                    number = phoneUtil.format(phoneNumber, PhoneNumberUtil.PhoneNumberFormat.E164)
                    number = number!!.replace("+", "00")
                }

            } catch (e: Exception) {
                // number would be returned as null if it catches here
            }

            return number
        }
    }

} 
```

以下是您将如何使用它：

```
var globalnumber = PhoneNumberHelper.correctNumber(contact.mobile, context) 
```

澄清：

```
val code = StorageAdapter.get(context).userCountryCode 
```

这是您在注册期间应存储的国家/地区代码。例如`0044`或`+44`

不要忘记包含 libphone 的依赖项：

```
implementation 'com.googlecode.libphonenumber:libphonenumber:8.8.0' 
```

# c# - WinForms AcceptButton 不起作用？

> ID：487920
> 
> 赞同：41
> 
> 时间：2009-01-28T15:00:37.993
> 
> 标签：c#, winforms, modal-dialog

好吧，这让我很烦，我就是不知道出了什么问题......

我做了两个表格。第一种形式只有一个简单的按钮，它以对话框的形式打开另一种形式，如下所示：

```
using (Form2 f = new Form2())
{
    if (f.ShowDialog() != DialogResult.OK)
        MessageBox.Show("Not OK");
    else
        MessageBox.Show("OK");
} 
```

第二个，即`Form2`，上面有两个按钮。我所做的只是将表单 AcceptButton 设置为一个，将 CancelButton 设置为另一个。在我看来，这就是完成这项工作所需要的一切。但是当我运行它时，我单击打开 Form2 的按钮。我现在可以单击设置为 CancelButton 的一组，然后出现“Not OK”消息框。但是当我单击一组作为 AcceptButton 时，什么也没有发生？Form2 的 InitializeComponent 代码如下所示：

```
private void InitializeComponent()
{
    this.button1 = new System.Windows.Forms.Button();
    this.button2 = new System.Windows.Forms.Button();
    this.SuspendLayout();
    // 
    // button1
    // 
    this.button1.Location = new System.Drawing.Point(211, 13);
    this.button1.Name = "button1";
    this.button1.Size = new System.Drawing.Size(75, 23);
    this.button1.TabIndex = 0;
    this.button1.Text = "button1";
    this.button1.UseVisualStyleBackColor = true;
    // 
    // button2
    // 
    this.button2.DialogResult = System.Windows.Forms.DialogResult.Cancel;
    this.button2.Location = new System.Drawing.Point(130, 13);
    this.button2.Name = "button2";
    this.button2.Size = new System.Drawing.Size(75, 23);
    this.button2.TabIndex = 1;
    this.button2.Text = "button2";
    this.button2.UseVisualStyleBackColor = true;
    // 
    // Form2
    // 
    this.AcceptButton = this.button1;
    this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
    this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
    this.CancelButton = this.button2;
    this.ClientSize = new System.Drawing.Size(298, 59);
    this.Controls.Add(this.button2);
    this.Controls.Add(this.button1);
    this.Name = "Form2";
    this.Text = "Form2";
    this.Load += new System.EventHandler(this.Form2_Load);
    this.ResumeLayout(false);
} 
```

除了添加这两个按钮并设置 AcceptButton 和 CancelButton 之外，我什么也没做。为什么它不起作用？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-01-28T15:05:31.243

仅设置`AcceptButton`/`CancelButton`是不够的。这只是告诉应该在`Enter`/上调用哪个按钮`Esc`。您必须设置按钮的`DialogResult`属性。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2009-01-28T15:05:02.227

尝试`DialogResult`设置`button1`

```
this.button1.DialogResult = System.Windows.Forms.DialogResult.OK; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-05-21T02:52:04.377

绝对尝试教程*[How to easy to apply AcceptButton and CancelButton for custom dialog box in Winform](http://www.itjungles.com/dotnet/how-to-easily-apply-acceptbutton-and-cancelbutton-for-custom-dialog-box-in-winform)*。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-11-06T23:24:59.833

我遇到了 AcceptButton 无法正常工作的问题，虽然 DialogResult 建议是修复的一部分，但我还有两件事需要更改：

1.  我的按钮不可见 - 故意是因为我想在通过扫描条形码“按下”回车时停止“叮”。
2.  按钮所在的容器有所不同。我必须将它放在同一个容器中，在我的例子中是 Forms.Panel，作为试图访问它的文本框。我不确定为什么这会有所作为，但确实如此。

我希望这可以帮助别人。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-03-01T19:33:09.313

您需要将表单的 KeyPreview 属性设置为 True，默认值为 False。请记住，如果焦点设置为任何其他按钮而不是 AcceptButton，则 Enter 键将执行此按钮

# delphi - Intraweb 可以运行超过 65,536 个并发会话吗？

> ID：487927
> 
> 赞同：3
> 
> 时间：2009-01-28T15:02:44.680
> 
> 标签：delphi, file, caching, session, intraweb

我正在尝试使用 Intraweb 建立一个到繁忙的社交网站的网络链接。

Intraweb 为每个会话创建临时文件夹以存储临时文件，这些临时文件会在会话到期时自动删除。

如果托管在 Win 32 上，则限制为 65,536 个文件夹 - 这意味着只有 65k 个并发会话是可能的。

有没有办法关闭临时文件的创建或允许在 intraweb 中进行更多的并发会话？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-16T06:29:13.827

IntraWeb 并不是为处理此类会话数量而设计的。IntraWeb 是为 Web*应用程序*设计的，而不是为*网站*设计的。尽管一个普通的 IntraWeb 会话只需要几个 KB，但 IntraWeb 的会话处理模型更像是一个“胖”模型。它非常适合创建可以处理数百个并发会话的复杂有状态应用程序。

对于每天拥有数千名用户的网站——许多用户只打开一个页面然后再次离开——你/可以/当然使用 Webbroker——但这基本上意味着你必须从头开始构建所有内容。

如果您是 Delphi 人，那么我建议您研究 Delphi Prism plus ASP.NET。有大量的 ASP.NET 控件可以简化快速构建您的网站。来自 DevExpress.com、Telerik.com 和其他网站的 ASP.NET 控件在 Delphi Prism 中运行良好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T01:06:59.037

我敢肯定，在一个机器上接近 65,000 个用户之前，您会用完系统资源。要处理该负载，您需要一个负载平衡的集群，然后 65K 限制将不是问题。我不会关注这个限制。

# c# - iText - 如何在现有的 RTF 文档上进行搜索/替换

> ID：487931
> 
> 赞同：1
> 
> 时间：2009-01-28T15:04:01.840
> 
> 标签：c#, itext, mailmerge

目前我正在开发一个简单的邮件合并模块。

我需要加载普通的 *.RTF 模板，然后替换 [[field]] 标记中包含的所有单词，最后将它们打印出来。

我找到了免费的 iText 库，它能够加载/保存 pdf 和 rtf。我设法加载 rtf，将几个副本合并到一个巨大的文档中，但我不知道如何用客户姓名/地址等自定义数据替换 [[field]]。

该功能是否存在，如果存在 - 怎么做？解决方案平台为c#/.NET

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-28T15:52:37.153

我不认为 pdf 是你想要的方式。

根据[这篇文章](http://itext.ugent.be/library/question.php?id=48)，这充其量是极其困难的，在最坏的情况下是不可能的。

像[RTFLib](http://xmlgraphics.apache.org/fop/dev/rtflib.html)这样的东西会更适合你吗？

G人

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-16T11:52:14.800

最后我决定使用 *.docx 和“Open XML SDK 2.0 for Microsoft Office”.NET 强类型包装器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-11T12:20:34.680

您可以使用 RichTextBox 控件来查找/替换占位符。

```
RichTextBox rtb = new RichTextBox(); 
rtb.LoadFile("template.rtf");
string placeHolder = "[[placeholder_name]]"; 
int pos = rtb.Find(placeHolder); 
rtb.Select(pos, placeHolder.Length);
rtb.SelectedText = "new value"; 
```

在此之后，您可以获得 rtf 格式的文本：

```
rtb.Rtf; 
```

# java - 将 Java 编程到 iPhone 应用程序的转变有多大？

> ID：487932
> 
> 赞同：12
> 
> 时间：2009-01-28T15:04:05.380
> 
> 标签：java, iphone

我是一名熟练的 Java 开发人员，正在考虑学习 iPhone 开发。抛开 Mac 只是开发方面的问题，学习移动应用程序堆栈会有多大的飞跃？当然，我知道它在如何处理它方面更接近于 C，随之而来的是内存管理等等。

我的查询还包括

1.  OOP/OOAD 的支持情况如何？
2.  是否有一些支持单元测试的 API？

我鼓励那些回答引用外部网站和参考资料的人来帮助详细说明

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-28T15:15:13.050

开发语言是 Objective-C，它是纯 C 语言，顶部有一个非常薄的对象包装器。它们的语法看起来有点奇怪，但是如果您在克服消息调用后了解 C，就很容易掌握 - 我自己有扎实的 C 背景，并且在一两个月后才开始学习 Objective-C但我发现它真的很令人愉悦——比 C++ 更令人愉悦。

如果您只编写过 Java 代码，您将遇到的困难是指针和内存管理。内存管理在概念上并不难，因为它只是（！）跟踪您正在分配和释放的内容的问题，而且 XCode 似乎带有检测泄漏的好工具（尽管我还没有在愤怒中使用这些工具） -并且由于 iPhone 程序相对较小，因此编写大型系统程序并不像编写一个非常困难的大型系统程序。您可能遇到的主要概念困难是简单地了解指针，因为它们被广泛使用（就像几乎在每一行代码中一样），您确实需要完全理解这些。Joel 在播客中反复出现的主题之一是一些编码人员使用指针时遇到的困难，所以我

有人可能想纠正我，但尽管 Cocoa API 看起来很出色，但似乎在框架之外可用的库很少（与 C++ 或 Java 不同）。例如，我必须添加自己的队列和堆栈类——尽管 NSMutableArray 使这非常容易。

总而言之，尽管我肯定会发现它是我使用过一段时间的最有趣的平台之一。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-28T15:33:17.613

几个月前，我是一名 Java Web 程序员，从大学开始就没有接触过 C。现在我已经完成了一个 iPhone 应用程序（对于我的日常工作，卡在官僚机构中，所以它还没有出现在应用程序商店中），我的第二个应用程序即将完成。

要回答您的问题，最大的障碍是理解约定（委托模式、类别等）、掌握内存管理以及使用 XCode（一个很好的 IDE，但肯定落后于 Eclipse 和 IntelliJ）。

我也觉得 Apple Developer Center 网站上的文档写得很好，一个好的开发者可以快速上手运行。

为了更具体地回答您的问题，我还没有尝试过单元测试，但我认为 OOP 很棒——我的 iPhone 应用程序中的域对象与我用 Java 编写的对象一样健壮和强大。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-28T16:25:36.073

我作为 Java 开发人员从大学毕业。我的第一份（真正的）工作是 Mac 开发。从我知道的语言（我的起点是 Java）转换到像 Objective-C 这样的语言是相当容易的，代码方面。为了最大限度地利用您开发 iPhone / Mac 应用程序的时间，您必须使用 XCode 和 Interface Builder。一旦你掌握了附加事件和 GUI 出口（你的 UI 想要与之通信的对象）的窍门，你就会为正常的 iPhone 应用程序开发做好准备。

以下是我学习具有 Java 背景的 Objective-C（iPhone 开发的编程语言）的步骤：

1.  学习基本的 OC 面向对象概念。子类化（继承）、协议（Java 接口）、对象属性（Bean 属性）、方法（您必须明确指出“参数条目”标签，这与在 C/C++/Java 中您猜测参数顺序不同）。

2.  了解 Objective-C、Cocoa、Aqua 和 C 之间的区别。然后了解如何使用框架。框架与 Java 包几乎相同。

3.  熟悉使用这些 Foundation 类：NSString、NSArray、NSDictionary、NSSet、NSURL、NSAutoreleasePool。

4.  进一步了解 Interface Builder。我之前认为 Visual Basic 的编程方式限制了程序员。我错了。最好先“可视化”应用程序，然后再了解其中的运作方式。请注意关键字 IBAction（类似于创建 EventListener）、Outlets（您的 UI 元素只有几个“暴露”的对象）、Views（在 iPhone 的情况下为 UIView，应用程序中“可见”的所有内容都可以是被视为“视图”）和控制器（有现成的控制器可用于填充表格视图、翻转卡片视图等）。

5.  了解如何通过 iPhone Developer Portal 部署您的应用程序。如果您没有此“权利”，您将无法将任何 iPhone 应用程序发送到任何设备。是的，我知道这很糟糕，但无论如何，如果你想出售你的应用程序，你必须经历这个过程。

顺便说一句，您可以使用以下代码对 iPhone 代码进行单元测试：[iPhone 单元测试](http://code.google.com/p/google-toolbox-for-mac/wiki/iPhoneUnitTesting)

希望这个有帮助。:)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-28T16:09:53.033

对于单元测试，有几个选项，上面链接了 OCUnit。还有[google-toolbox-for-mac](http://code.google.com/p/google-toolbox-for-mac/)。

Objective-c 中的 OOP 很好，相当干净。您有时也会遇到老式的 C 函数。

使用的 API 称为 Cocoa-Touch，它是基于 Cocoa 构建的，后者是从 NextStep 构建的，因此在设计和改进方面有着悠久的历史。

iPhone 上没有垃圾收集。黄金法则是“**如果你分配，那么你释放**”。关于内存管理的 SO 有很多问题，这里不再赘述。

主要障碍是设计/架构差异。iPhone 应用程序和 Java 应用程序是使用不同的约定构建的。因此，尽可能多地使用[objective-c](https://stackoverflow.com/questions/tagged/objective-c) / [cocoa](https://stackoverflow.com/questions/tagged/cocoa) / [cocoa-touch](https://stackoverflow.com/questions/tagged/cocoa-touch)代码。

花一些时间使用 Interface Builder，它可能会加重，但这通常意味着你不明白它在做什么。一旦您清楚地了解了 IB 是如何工作的，以及它可以为您做什么，您就会非常感激它。

[Cocoadev.com](http://cocoadev.com)是获取设计和代码示例的便捷资源。

[Cocoadevcentral.com](http://cocoadevcentral.com/)收集了很多优秀的文章，包括桌面可可开发。他的[学习objective-c](http://cocoadevcentral.com/d/learn_objectivec/)文章是你能找到的最好的文章之一。

如果您还没有 Apple Developer Connection 帐户，请获取一个。您不必为此付费，但会让您进入文档和工具。

[ADC iPhone](http://developer.apple.com/iphone/index.action)

[iPhone 参考库](http://developer.apple.com/iphone/library/navigation/index.html)API 文档、指南、示例代码、Apple 官方资料。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-28T15:13:04.847

Objective-C 是一种面向对象的语言，所以就 OOP 而言，几乎所有你可以用 Java 做的事情都可以用 Obj-C 做。

我没有任何经验，但这里至少有一个关于 OCUnit 的资源，objective-c 相当于 JUnit：http: [//developer.apple.com/tools/unittest.html](http://developer.apple.com/tools/unittest.html)

我在过渡时遇到的最大问题肯定是内存管理方面。学习语法和 API 非常简单，但没有 GC 的生活会很艰难！

编辑：哦，是的，第二大问题是 XCode，用于 Mac/iPhone 开发的 IDE。重构支持很少，我发现在文件之间导航很痛苦。预计这也会减慢您的速度。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T15:28:52.803

嗯，Java 是基于 Objective C 和 Smalltalk 的，它们都是面向对象的语言。最大的问题将是语法（不像 C++ 和 Java 那样完全基于 C）、指针和手动内存管理。

这是基于一些非常古老的 Objective C 知识，但我知道当我从 Objective C 切换到 Java 时（大约 2000 年），这很容易，因为底层概念非常接近。

[基于目标 C](http://cs.gmu.edu/~sean/stuff/java-objc.html)

[内存管理](http://www.peachpit.com/articles/article.aspx?p=377302)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-28T15:32:21.797

我不会说我是任何语言的专家，但我能胜任一些语言。我最近编写的大部分代码都是“企业”类型的东西。

假设您对学习新的 API 和语言感到满意，我发现最大的不同是 iPhone 在 CPU 性能和可用内存方面的限制。我非常习惯于用一点内存来换取更好的性能——几乎是无意识的——或者有点浪费，因为我有八个内核可供我使用。这在 iPhone 上*真是*个坏主意！

另一个困难的事情是确保它是 iPhone-y。制作一个好的应用程序不仅仅是缩小 GUI 的问题，你真的需要考虑有效地呈现数据。

技术方面都差不多。单元测试方面不如 Java 方面先进。另一方面，我发现我在 Objective C 中比 Java 更高效，更不容易出错，这可能是由于对象模型完全不同（你倾向于委托而不是继承）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T19:55:02.627

值得一提的是，您可以在 Objective-C 代码中使用 C++ 和 C++ 对象，通常称为 Objective-C++。这可能是一种有价值的方法，可以将数据模型和其他独立于平台的代码（用标准 C++ 编写）与 UI 代码（使用 Cocoa 框架用 Objective-C 编写）分离。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-05T19:44:46.020

如果您通过您的 Java 经验了解 OOP 的概念，并且您对指针和内存管理是什么有基本的了解，那么您遇到的最后一个障碍将是外星语法。

语法：我发现[本教程](http://www.cocoadevcentral.com/d/learn_objectivec/)等内容非常简洁明了。在我的脑海中，我在概念上映射了 Objective-C 和 Java 基础架构，大部分情况下您都可以这样做（即，消息大部分是方法，协议是接口，等等）。一旦你克服了最初的震惊，你会发现用于 UI 应用程序的 Objective-C 开发可以相当直观和愉快。

结构：我不太会编程 UI，所以我发现我需要更好地掌握 MVC 范式。

您还可能会发现一些很酷的语言特性，例如[类别](http://macdevelopertips.com/objective-c/objective-c-categories.html)，它们是您*希望*在 Java 中拥有的。我同样发现缺少其他一些结构，例如[缺少静态成员](http://www.omnigroup.com/mailman/archive/macosx-dev/2002-April/037868.html)。

# php - 遗留 PHP 应用程序和新的 Ruby on Rails 应用程序的棘手集成

> ID：487934
> 
> 赞同：2
> 
> 时间：2009-01-28T15:04:24.693
> 
> 标签：php, ruby-on-rails, interop

我们有一个旧的 PHP 应用程序。现在我想使用 Ruby on Rails 编写一个新的应用程序模块。

部署是一个问题。我想应该可以在一个 Apache 服务器上运行 PHP 应用程序（通过 mod_php）和 RoR 应用程序（通过 mod_proxy / mongrel）。我不想使用 mod_rails 因为它需要通过 fcgi 运行 php。破坏某些东西的风险也是如此。PHP 和 RoR 都将使用相同的数据库。

棘手的部分是如何将登录信息从 PHP 应用程序传递到 RoR 应用程序。用户登录 PHP，他们的信息存储在 PHP 会话数据中。RoR 应用程序将放置在主 PHP 应用程序的子目录中（例如 www.example.com/railsapp）。所以 RoR 应该接收所有的 HTTP cookie。问题是如何从 RoR 应用程序中提取 PHP 会话数据。

以上只是我的第一个想法，由于 PHP mod 和 RoR 之间可能存在竞争条件，这很糟糕。当用户登录时，我可以修改 PHP 应用程序以在 DB 中存储一些信息。但我不知道如何处理 PHP 会话数据过期并且应该更新 DB 中的一些数据（注销用户）的情况。

有没有人解决过类似的问题？或者至少可以指出一个最有希望的方向？

更新：应该可以配置 mod_php 将会话数据存储在 sql DB 中。这样就不会有竞争条件。数据库引擎应该防止竞争条件。

Update2：实际上可以在 prefork 模式下将 mod_rails 与 Apache 一起使用。这是 mod_php 所要求的。只是建议 mod_rails 在 worker mpm 模式下运行 Apache。因此 PHP / RoR 应用程序的整个部署被大大简化了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T18:27:45.750

首先，如果您将 rails 应用程序放在子目录中，则可以使用 mod_rails。在 PHP 站点的配置中，您可以拥有一个具有 rails 根目录的位置。

```
<Location /railsapp>
  DocumentRoot /.../app/public
</Location> 
```

要将会话转移到 rails 端，您可以在 rails 上创建一个连接页面并从 PHP 端调用它并传入一些数据以登录。你只需要保护这个页面免受任何不是来自本地主机的请求（很容易做到）。

您还可以切换 rails 以使用数据库来存储其会话，然后您应该能够生成会话 ID，将其存储在具有正确名称和机密的 cookie 中，并使用该 ID 在数据库中手动创建会话。

您还可以（我推荐）在 rails 端设置代理页面，让用户登录并将他们重定向到他们想要的页面。你可以这样做（*不是实际的工作代码，但你明白了）*：

PHP

```
$key = md5hash($user_id . $user_password_hash . $timestamp)
$url = "/railsapp/proxy?userid=" . $user_id . "&key=" . $key . "&page=home%2Fwelcome"
<a href="<$ $url $>">Rails App</a> 
```

导轨

```
map.proxy 'proxy', :controller => 'proxy', :action => 'connect'

class ProxyController < ActionController::Base
  def connect
    key = ...
    if params[:key] == key
      login_user params[:userid]
      redirect_to params[:page]
    else
      render :nothing, :status => 403
    end
  end
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T00:40:03.517

我之前做过一个混合的 PHP/RoR 应用程序（旧的 PHP 代码，新的 hawt RoR 功能，因为需要修复它的东西被重新实现了）。这并不难——您只需将 PHP 作为普通文件提供，并使用 404 处理程序将其他所有内容重定向到 Rails 应用程序。

就会话数据而言，您*可以将*其填充到数据库中，但如果您愿意编写/查找例程来读取和写入 PHP 的编组数据格式，PHP 使用`flock()`来确保在读取/写入中没有竞争条件会话数据文件。在你的 Rails 应用程序中做同样的事情，以减少痛苦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T15:47:53.827

首先，混合这两种技术似乎是在自找麻烦。我的第一个建议是“不要那样做”。

但是，由于您可能不会听取该建议，因此我将对您的实际问题提出建议。在我见过的将会话数据存储在数据库中的 PHP 应用程序中，我也注意到了清理数据的方法。两者都包括始终对记录进行时间戳记，以便您知道它们的年龄，并在用户处于活动状态时不时刷新该时间戳记（有时是每次页面查看，有时根据预期的负载和查询计数而不太频繁）。

如果您的应用程序执行的数据库调用相对较少，因此有一点空闲时间，您可以在每次页面查看时针对会话表运行一个额外的查询，至少到某些页面。这意味着一个额外的查询和一个繁忙的应用程序是一个问题。替代方案往往是定期运行以清理过期记录表的 cron 作业。这些定期清理作业也只能在完成特定的其他任务时运行（例如用户登录，因为您必须设置会话数据，所以这通常有点慢）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-28T08:34:54.157

嘿，我一直认为这实际上是那些从 php 迁移到 ruby​​ 的人的一个非常普遍的问题，他们在 php 中有遗留应用程序/数据，并且很惊讶它没有被问更多。

我很想采用以下两种方法中的任何一种，这两种方法过去都很好用。第二个选项将需要更多的工作，它们都需要修改您现有的登录代码：

1) 使用 openid 处理您的登录，因此您不必担心推出自己的解决方案。运行您自己的 openid 服务器或使用 google、yahoo 等。将您的每个应用程序作为唯一的子域运行。rails 和 php 有 openid 插件/代码，它是一个久经考验的安全标准

2) 使用 memcached 存储登录会话（而不是 db）。有一个登录页面（在您的 php 应用程序或 rails 应用程序中）。无论您访问 ruby​​ 应用程序还是 php 应用程序，oucome 都会与此类似。

a) 用户尝试访问登录保护页面

b) 应用程序检查自己的会话数据以查看用户是否已登录

c）如果存在正确的会话数据，则用户已登录并且应用程序继续

d) 如果应用程序找不到当前登录会话检查浏览器 cookie

e) 然后 App 检查 memcache 中的这个 cookie 键。

f) 如果 cookie 密钥存在，则用户必须登录（否则重定向到登录页面）

g) 应用程序从 memcached 中获取 user_id（存储为 cookie 键），因此它知道哪个用户已登录

h) 应用程序设置登录会话，因此它不必再次经过 c，除非会话过期

这是正在发生的事情的过度简化版本，但确实有效。在这种情况下，我会使用 memcached，因为它会自动过期您定义的值，而且速度非常快。请记住，不要在应用程序之间传递用户名和密码，甚至不要在用户 ID 之间传递用户名和密码。传递一个唯一键，它只是指向存储在 DB/memcached 中的信息的指针

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-28T10:17:39.897

1) 我在一个 prefork Apache 上同时成功地使用了 Passenger 和 mod_php，无论是在开发机器上还是在服务器上。

2) 我将通过 HTTP 质询/响应序列或可能通过共享的 memcached 密钥连接应用程序。

# hibernate - 使用分组的 HQL 查询

> ID：487946
> 
> 赞同：0
> 
> 时间：2009-01-28T15:06:27.013
> 
> 标签：hibernate, hql

我有以下类结构 FlowerDAO 和字段（使用 Hibernate 映射）：

*   ID

*   单价

*   姓名

*   颜色

    我如何创建一个 hql 查询来获取每种颜色的花朵，该颜色具有（ve）该颜色的最低单价？

我试过这个，但它不起作用

```
from FlowerDAO as f where f.unitPrice<= (select min(f2.unitPrice) from FlowerDAO as f2 where f2.color=f.color)
group by f.color 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T15:21:39.823

我怀疑问题是将单个值与一组结果进行比较。尝试将 <= 替换为“in”，这样您的查询将显示为：

```
from FlowerDAO as f 
  where f.unitPrice in 
    (select min(f2.unitPrice) from FlowerDAO as f2 where f2.color=f.color) 
```

另外，我从最后删除了“分组依据”，因为这只会为每种颜色提供一个结果，并且您在问题花中提到。您可能想使用

```
order by f.color 
```

反而？

# c# - 使用 Silverlight 适当实现 IDisposable？

> ID：487952
> 
> 赞同：2
> 
> 时间：2009-01-28T15:07:54.997
> 
> 标签：c#, .net, silverlight, idisposable

我正在使用 MVVM 模式开发 Silverlight 应用程序。我的 ViewModel 当前包含一个表示模型对象集合的属性：

```
public ObservableCollection<IndexEntry> IndexList
        {
            get;
            set;
        } 
```

它还有几种方法可以使用从 Web 服务返回的数据填充该集合。

由于此类的实例可能在应用程序运行时创建和销毁，我应该实现`IDisposable`并将属性的引用设置为 null 还是该类的销毁足以删除对集合 tis 属性引用的所有引用？是否有任何警告可能会留下参考？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-28T15:23:11.253

引用在垃圾回收中幸存的唯一方法是它是否有根。如果还有其他仍在使用的类包含对 ObservableCollection 的引用，那么 ObservableCollection 将不会被销毁，无论您是否将其设置为 null。例如，假设有一个“内存中”对象是您的集合。在您的财产中，您对它有一个引用。其他一些代码执行“ObservableCollection<> myOtherReference = YourObject.IndexList;”行。他们现在也有对实际内存对象的引用。将您的属性引用设为 null 只会消除您的属性引用；'myOtherReference' 引用不受影响，因为它现在直接指向内存，而不是您的属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T15:54:58.647

GWLlosa 恰到好处。此外，Silverlight 数据绑定将保持您的 ViewModel 固定，只要您有对它的 Binding 引用。换句话说，您需要从视图的 DataContext 中删除您的 ViewModel（通过设置 View.DataContext=null），或者您的视图需要在您的 ViewModel 发布之前从可视化树中删除。实施 IDisposable 无济于事，我不会为此推荐它。IDisposable 旨在清理非托管资源或更好地控制您的托管资源处置。在这种情况下，如果您正确理解绑定和引用的工作原理并让垃圾收集器处理这些事情，则没有必要。这篇文章可以帮助：

[在 WPF 应用程序中查找内存泄漏](http://blogs.msdn.com/jgoldb/archive/2008/02/04/finding-memory-leaks-in-wpf-based-applications.aspx)

它主要是 WPF，但您也可以使用 Silverlight 上的技术。

顺便说一句，很高兴看到您使用 ViewModel。我是这个模式的忠实粉丝。

# php - 为 php/mysql CMS 预处理和后处理多语言用户输入的最佳方法

> ID：487962
> 
> 赞同：2
> 
> 时间：2009-01-28T15:10:18.910
> 
> 标签：php, mysql, content-management-system, filtering, user-input

好的，有很多关于清理字符串的东西，但我能找到的东西很少，关于准备用户输入的最佳方法（比如我现在正在输入的内容）以插入内容管理系统然后如何过滤它出来了。

我正在构建两个多语言（日语、英语 + 其他浪漫语言）CMS，并且有一段时间让两个特殊字符（如 ®、™）与日语字符一起显示。

我继续得到非常不一致的结果。

我将所有内容都设置为 UTF-8：

网页：和

.htaccess 文件：AddDefaultCharset UTF-8 AND（强制问题）

在每个数据库连接之后： mysql_query("SET NAMES 'UTF8'");

每个数据库、表和字段也设置为 utf8_general_ci

魔术报价已关闭。我首先使用 htmlpurifier 的默认设置预处理用户输入，然后在其上运行此函数：

```
function html_encode($var) {

        // Encodes HTML safely for UTF-8\. Use instead of htmlentities.
        $var = htmlentities($var, ENT_QUOTES, 'UTF-8');

        // convert pesky special characters to unicode
        $look = array('™', '&trade;','®','&reg;');
        $safe = array('&#8482;', '&#8482;', '&#174;', '&#174;'); 

        $var = str_replace($look, $safe, $var);

        $var = mysql_real_escape_string($var); 

        return $var; 
                            } 
```

这样就可以进入数据库了。

我通过使用此函数过滤所有内容从数据库中返回它：

```
function decodeit($var) {

        return html_entity_decode(stripcslashes($var), ENT_QUOTES, 'UTF-8');
                            } 
```

不幸的是，毕竟我仍然得到不一致的结果。大多数情况下，® 符号会变成小菱形。

我已经到处寻找一个很好的方法，但似乎找不到最好的方法......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T16:11:38.730

不要将 htmlentities 放入数据库中！永远不要调用 html_entities()，它应该在 php.ini 中被弃用。使用 htmlspecialchars 但在显示文本时，而不是在将其放入数据库之前。关键是防止您的数据被视为html。翻译商标符号或版权符号没有意义，因为它们不会造成风险。您需要担心的唯一html是： > < & ' "

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T15:12:41.807

抱歉，所见即所得编辑器清除了网页标题。为了清楚起见：

网页标题是：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

和

```
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T19:28:44.380

一切都已经编码为 utf8。将其解码为 ISO-8859-1 只会破坏任何日本人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T04:53:16.323

我曾经遇到过编码问题，归结为 php 文件本身的编码。所以基本上确保文件本身被编码为 utf-8。在 vim 中你可以做 :e ++enc=

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T15:14:35.577

[http://us3.php.net/utf8_encode](http://us3.php.net/utf8_encode) [http://us3.php.net/utf8-decode](http://us3.php.net/utf8-decode)

那应该有帮助。

# c# - .net 的 SIP/SIMPLE 客户端 (MSN Messenger)

> ID：487969
> 
> 赞同：0
> 
> 时间：2009-01-28T15:11:23.713
> 
> 标签：c#, .net

我想创建一个小的“Windows Messenger”客户端，我可以从脚本（本质上是一个通知机器人）触发它。它是内部的，所以我认为它针对[Live Communications Server 2005使用](http://en.wikipedia.org/wiki/Live_Communications_Server_2005)[SIP](http://en.wikipedia.org/wiki/Session_Initiation_Protocol)或[SIMPLE](http://en.wikipedia.org/wiki/SIMPLE)。

现在，在我深入研究 RFC 和 Wireshark 日志之前，我想知道是否有可用的 .net 库来执行此操作？这适用于服务器端应用程序，这意味着它应该在没有 GUI 的情况下工作，并且它不应该使用非托管代码。

[dotMSN](http://www.xihsolutions.net/dotmsn/)似乎不支持 SIP，而[SIP Objects.NET](http://developers.inova.si/sipobjects/Home/tabid/36/Default.aspx)似乎只针对电话而不是 IM。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-31T22:07:30.057

我要自己动手。

# python - 是否有一种标准方法可以列出包中 Python 模块的名称？

> ID：487971
> 
> 赞同：124
> 
> 时间：2009-01-28T15:11:32.870
> 
> 标签：python, module, package

有没有一种直接的方法来列出包中所有模块的名称，而不使用`__all__`？

例如，给定这个包：

```
/testpkg
/testpkg/__init__.py
/testpkg/modulea.py
/testpkg/moduleb.py 
```

我想知道是否有标准或内置的方式来做这样的事情：

```
>>> package_contents("testpkg")
['modulea', 'moduleb'] 
```

手动方法是遍历模块搜索路径以找到包的目录。然后可以列出该目录中的所有文件，过滤掉唯一命名的 py/pyc/pyo 文件，去除扩展名，然后返回该列表。但这对于模块导入机制已经在内部做的事情来说似乎是相当多的工作。该功能是否暴露在任何地方？

* * *

## 回答 #1

> 赞同：222
> 
> 时间：2009-08-21T09:21:02.440

使用[python2.3 及更高版本](http://docs.python.org/library/pkgutil.html)，您还可以使用该`pkgutil`模块：

```
>>> import pkgutil
>>> [name for _, name, _ in pkgutil.iter_modules(['testpkg'])]
['modulea', 'moduleb'] 
```

**编辑：**请注意，参数 for`pkgutil.iter_modules`不是模块列表，而是路径列表，因此您可能想要执行以下操作：

```
>>> import os.path, pkgutil
>>> import testpkg
>>> pkgpath = os.path.dirname(testpkg.__file__)
>>> print([name for _, name, _ in pkgutil.iter_modules([pkgpath])]) 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-01-28T21:35:25.747

```
import module
help(module) 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-01-28T22:14:44.090

也许这会做你想要的？

```
import imp
import os
MODULE_EXTENSIONS = ('.py', '.pyc', '.pyo')

def package_contents(package_name):
    file, pathname, description = imp.find_module(package_name)
    if file:
        raise ImportError('Not a package: %r', package_name)
    # Use a set because some may be both source and compiled.
    return set([os.path.splitext(module)[0]
        for module in os.listdir(pathname)
        if module.endswith(MODULE_EXTENSIONS)]) 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2013-04-05T12:18:29.550

~~不知道我是否忽略了某些东西，或者答案是否已经过时但是；~~

正如 user815423426 所述，这仅适用于活动对象，并且列出的模块只是之前导入的模块。

[使用inspect](http://docs.python.org/2/library/inspect.html)列出包中的模块似乎很容易：

```
>>> import inspect, testpkg
>>> inspect.getmembers(testpkg, inspect.ismodule)
['modulea', 'moduleb'] 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-10-13T02:52:51.060

这是一个适用于 python 3.6 及更高版本的递归版本：

```
import importlib.util
from pathlib import Path
import os
MODULE_EXTENSIONS = '.py'

def package_contents(package_name):
    spec = importlib.util.find_spec(package_name)
    if spec is None:
        return set()

    pathname = Path(spec.origin).parent
    ret = set()
    with os.scandir(pathname) as entries:
        for entry in entries:
            if entry.name.startswith('__'):
                continue
            current = '.'.join((package_name, entry.name.partition('.')[0]))
            if entry.is_file():
                if entry.name.endswith(MODULE_EXTENSIONS):
                    ret.add(current)
            elif entry.is_dir():
                ret.add(current)
                ret |= package_contents(current)

    return ret 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-01-18T22:59:41.757

这应该列出模块：

```
help("modules") 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-04-21T08:33:14.593

基于 cdleary 的示例，这是所有子模块的递归版本列表路径：

```
import imp, os

def iter_submodules(package):
    file, pathname, description = imp.find_module(package)
    for dirpath, _, filenames in os.walk(pathname):
        for  filename in filenames:
            if os.path.splitext(filename)[1] == ".py":
                yield os.path.join(dirpath, filename) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-03-22T16:28:17.463

如果你想在 python 代码之外（从命令提示符）查看关于你的包的信息，你可以使用 pydoc。

```
# get a full list of packages that you have installed on you machine
$ python -m pydoc modules

# get information about a specific package
$ python -m pydoc <your package> 
```

您将获得与 pydoc 相同的结果，但在解释器内部使用帮助

```
>>> import <my package>
>>> help(<my package>) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-01-12T20:40:08.477

此处的其他答案将在检查包时运行包中的代码。如果你不想要那个，你可以像[这个答案一样grep文件](https://stackoverflow.com/questions/26836201/a-smarter-grep-for-python-code-want-to-find-nesting-function-or-class)

```
def _get_class_names(file_name: str) -> List[str]:
    """Get the python class name defined in a file without running code
    file_name: the name of the file to search for class definitions in
    return: all the classes defined in that python file, empty list if no matches"""
    defined_class_names = []
    # search the file for class definitions
    with open(file_name, "r") as file:
        for line in file:
            # regular expression for class defined in the file
            # searches for text that starts with "class" and ends with ( or :,
            # whichever comes first
            match = re.search("^class(.+?)(\(|:)", line) # noqa
            if match:
                # add the cleaned match to the list if there is one
                defined_class_name = match.group(1).strip()
                defined_class_names.append(defined_class_name)
    return defined_class_names 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2009-03-25T14:58:11.463

```
def package_contents(package_name):
  package = __import__(package_name)
  return [module_name for module_name in dir(package) if not module_name.startswith("__")] 
```

# coding-style - 在新工作中继承应用程序

> ID：487973
> 
> 赞同：6
> 
> 时间：2009-01-28T15:12:12.617
> 
> 标签：coding-style, legacy-code

在新工作中继承应用程序时，您倾向于坚持原始开发人员的编码实践还是开始应用自己的代码？

我在一家没有指导方针的小商店工作，一直想知道这里的规则是什么。有些应用程序写得很好，但不遵循我使用的标准（变量名等......），我不想“弄脏”它们。我发现我自己花了一些额外的时间来保持一致。

其他人写得非常糟糕，看起来开发人员每次击键都会改变主意......

## 额外的想法

当我开始自己的项目时呢？所以现在我引入了一个新的编码标准：

1.  好的代码——但不是我的风格
2.  具有不良实践和缺乏标准的不良代码
3.  我自己的标准

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-28T15:14:26.827

如果代码中有明显的标准，你应该遵守它们。如果没有，请开始介绍自己的。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-28T16:13:44.397

如果有多个开发人员在同一模块上工作，请不要更改样式。

如果您将在不久的将来将其交给其他开发人员（此角色是临时的），请不要更改样式。

如果您要获得模块的完整、独占、永久所有权，请更改它，但请遵循以下规则：

**一次改变一个。**

立即根据您的喜好修复所有缩进，并提交该更改。

立即根据您的喜好修复所有支撑位置，并提交该更改。

立即根据您的喜好修复所有其他格式，并提交该更改。

立即根据您的喜好修复所有命名，并提交该更改。

**不要花很多时间在上面。**

如果需要超过一两个小时，则减少。

**使提交描述清晰。**

因此，您可以在分析更改历史记录时快速忽略这些更改。

**使用自动化工具**

确保结果一致且完整，这样您就不必再搞砸了。

**运行你的测试**

仅仅因为您的更改不应该影响行为并不意味着它们不会。（三重否定，哎哟！）

**确保每个人都知道你在做什么**

有人可能有一个他们想要现在提交的更改，并且与您的更改合并会很痛苦。此外，您不希望任何人感到惊讶并在您这样做之前告诉您的老板。

**不要再这样做了**

这是一次性的事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T15:18:31.403

发布遵循最佳实践的风格指南，并围绕遵循它建立共识。根据需要重构旧代码以维护它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-28T15:24:12.283

我和你在同一条船上。从上一个人那里继承了一些应用程序的孤独开发者。一世

我一直坚持他对现有项目的一致性标准，并使用我自己对新事物的偏好。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-28T16:20:18.673

我注意到大多数人认为在他们之前的任何人都不知道如何编写代码。然后，无论谁跟在*他们*后面，都会有同样的想法。有些事情是常识，但大多数事情只是个人喜好。

对于主要问题，即使用注释与不使用注释，更新代码可能会更容易使用，也更容易让其他人使用。即使这样，您最好还是花时间在遇到代码时对其进行更新，而不是着手进行一个巨大的项目来重构所有内容（在此过程中引入新问题）。

对于缩进、行距、变量名、单行 ifs 与多行 ifs 等问题，现实情况是您的编码风格可能和您认为的一样糟糕。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-28T15:20:04.320

我认为这取决于您所说的“编码实践”是什么意思。如果您的意思是诸如代码格式和命名约定之类的东西以及我个人认为“装饰性”的东西，那么请坚持使用已有的东西。如果您的意思是首先编写最佳实践和正确编写代码之类的事情，那么请尽可能返回并解决问题，但至少要让您的新代码遵循最佳实践。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-28T15:26:51.043

鉴于我继承的大多数应用程序都被“牛仔编码员”破解，他们甚至没有应用最基本的编码实践，我的观点有点偏颇。

如果没有编码标准，或者存在的标准明显错误和/或愚蠢（例如“所有变量的长度不得超过 4 个字符”、“每个数据库列都是 varchar(255) null”等，我会说引入编码标准.)。显然，如果你有一个团队，那么你需要就实施哪些实践达成一致，但如果你是一个单独的开发者，那么你可以自由支配，IMO 你应该为混乱引入秩序。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-28T15:28:23.583

*   如果代码有效，并且似乎有一个干净的格式。不要浪费时间改变风格。
*   如果代码写得不好。当你有一些空闲时间，或者下次你在项目上工作时，一定要改变它。
*   对于新项目，请按照自己的方式进行，因为没有标准。与其他编写良好的程序一样，您的程序应该很容易维护。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-28T17:21:47.943

组合通常优于继承

:-P

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-28T15:17:27.350

如果只有你，那就去吧。如果它是一个团队，特别是如果任何原始开发人员仍然存在（或可能被要求进行咨询），请尽可能保持现有的风格和实践。不要跟着他们走下一个老鼠洞——如果你认为他们在做一些愚蠢的事情，那就改变它，但如果这只是一个风格上的事情，尽可能地保持他们的风格。

在我从事的几项工作中，除了“如果您要对现有文件/类进行更改，请使用现有风格，即使是新代码”，我们对编码风格没有任何规定。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-28T15:17:52.483

如果我继承了显然从未被重构过的代码，我会借此机会强加一些我自己的结构。

如果人们希望我为向代码添加功能做出时间和成本估算，我需要非常熟悉它，并确保它符合我的标准。

如果代码已经写得很好，那将是我不会乱来的福气。但根据我的经验，这种情况并不经常发生。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-28T15:29:23.363

如果有的话，我会遵守公司标准。

如果没有并且变化很小，我采用使用的编码风格。

如果要进行较大的更改并且我不喜欢编码器的样式，我将使用自己的。如果现有代码不好，我也会改变它。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-28T15:30:17.980

您是否有更好的机会使用标准样式更新现有代码？可能不是。当您对代码不熟悉时，您将有最好的机会花一些额外的时间来进行非新功能和非错误修复的更改。缺乏标准可能令人沮丧，但您不太可能有比第一次继承代码时更好的机会进行标准化。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-01-28T15:32:07.103

听起来我们在谈论没有官方风格指南/最佳实践的情况。在那种情况下，正如肖恩所说，我会带头建立一些。但是……如果可能的话，选择一个现有的、广泛使用的标准。它更有可能被接受，所有论点都已完成，并且开箱即用的工具支持（编辑器、代码审查工具等）的几率大大增加。

让其他人采用它通常会自下而上发挥最佳效果——根据新标准编写新代码，向其他人提及你已经这样做，征求反馈意见。比试图提前获得批准和支持要容易得多。

在现有的丑陋项目中，避免对现有模块进行大规模更改。一方面，如果文件突然重新缩进，差异和版本控制会变得相当混乱。

如果您正在处理的块*太*糟糕以至于无法阅读，我会进行初始签入以*重新*格式化它；跟进实际的代码更改。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-01-28T15:34:23.917

如果代码符合我的风格标准，我会应用相同的重构标准。也就是说，我会忽略这种风格，继续我的事业。

如果遵循代码中的风格不是很困难 - 关于命名约定，我会继续将它们用于新代码。

但是，我不会费心尝试遵循诸如“不应使用制表符”、“每行应缩进 2 个空格”等内容。有很多编辑器可以在需要时“漂亮”代码这几天。

G人

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-01-28T15:54:27.383

我认为这在很大程度上取决于具体情况。

*   如果你是一个项目的短期顾问，你应该坚持原来的样子。
*   如果你开很长时间。尝试将不良代码重构为您自己的方案。
*   如果您的工作时间很短，但您正在处理一个独立的模块，那么请使用您自己的方案。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-01-28T16:36:59.513

简短的回答是，“这取决于。” 在确定是否保留旧样式时，我认为以下几个因素很重要：

1) 变更范围。如果它接近于对应用程序的完全重写，那么如果你有一个你认为适合你的新标准，那么引入一个新标准可能更有意义。

2) 未来变化的可能性。这会一次又一次地改变吗？如果是这样，那么尽早花一些时间最终可能是值得的。这确实需要一些判断和预测未来，但在某些情况下，很容易看出对于一些相当复杂的系统会一次又一次地发生变化。

3) 与完全自主开发的应用程序相比，有多少代码是在第三方代码库上定制的，例如，公司对其业务流程的 Oracle 产品的特定定制。这里的影响是，当发布新版本并请求升级时，由于定制了如此多的内容，可能会对哪些问题造成多大的痛苦。

在开始您自己的项目时，请输入您所知道的最佳标准。

# tfs - 自动构建 TFS 的分支

> ID：487974
> 
> 赞同：3
> 
> 时间：2009-01-28T15:12:25.940
> 
> 标签：tfs, build-automation, branch

在 TFS 中，您可以创建自动构建并创建分支（希望如此。;)）我有以下结构：

```
->Trunk
->Branches
   -> Branch A 
```

如果您创建自动构建，则可以为构建创建触发器。在我的情况下，我想为分支 A 创建一个构建，以便在发生签入时构建分支 A。但是，如果我在 Trunk 中签入，我的自动构建将在检测到签入时开始。无论如何我可以为每个分支进行构建吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-28T15:43:27.767

确保构建定义中分支的工作区仅设置为分支，而不是项目的根目录。我的猜测是 TFS 通过工作区进行文件更改检测。在您的示例中，您希望将其设置为 $Project/Branches/Branch A。

# asp.net - 从书签到 asp 的 AJAX 调用

> ID：487978
> 
> 赞同：1
> 
> 时间：2009-01-28T15:12:50.543
> 
> 标签：asp.net, javascript, ajax, asp.net-ajax

我正在尝试创建一个书签，它将启动对我编写的 aspx 页面的 AJAX 调用。

当我将 javascript 放在静态 html 页面中时，代码测试完美，但是当我尝试从小书签中调用它时，代码只会挂在 xmlHttp.open("GET", url, true) 部分。

小书签的代码基本上是这样的（在网上的几个例子中找到）：

```
javascript:(function(){
  var s,
  d=document,
  a=function(o){ d.body.appendChild(o) };
  s=d.createElement('script');
  s.type='text/javascript';
  s.src='http://localhost/squirt/sq.js';
  a(s)
})(); 
```

这会将 sq.js 的内容（ajax 调用 + 一些其他处理）添加到浏览器当前所在的任何页面，然后将 ajax 调用到我的 aspx 页面。

我正在使用 ASP 2.0（带有 VS2008）和 IIS 7。到目前为止，我只是在我的家庭网络上对其进行了测试。

我认为来自外部页面的 ajax 调用一定存在某种权限问题，因为就像我说的，在静态页面上一切正常。这是我需要更改以允许调用的 IIS 设置，还是我做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T16:02:48.647

XMLHttpRequest 对象受同源策略的约束。
这就是为什么您的书签加载的脚本不能使用 XHR 从您的服务器获取数据，除非它嵌入到您服务器的页面中。
正如您所知，通过动态添加脚本标签添加的脚本将起作用 - 您的小书签可以从不同的来源加载脚本。
所以这就是你的答案。不要使用 XMLHttpRequest 对象：以与小书签相同的方式动态加载脚本。
这就是 JSONP 的工作原理（实际上 JSONP 还有更多内容，但这就是它绕过 SOP 的方式）

实际上，为什么不直接使用[JSONP](http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T16:05:41.713

在页面上注入 JavaScript 代码仍然存在与通常存在的代码相同的权限问题。您不能对不同的域进行 Ajax 调用。因此，如果您从 example.com 调用 localhost，它将无法正常工作。

您可能希望查看从您的服务返回 JSON 并使用脚本标记进行 JSON 调用。

埃里克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T16:13:24.897

您在那里使用的代码相当难看，我建议使用我构建的类似代码：http: [//sktrdie.org/getScript.js](http://sktrdie.org/getScript.js)

它是这样工作的：

```
getScript("http://anotherdomain.com/something", function(data) {
    alert(data); // the request is complete
}); 
```

在[http://anotherdomain.com/something](http://anotherdomain.com/something)上，它必须返回类似这样的内容，因为您使用的是 PHP：

```
echo $_GET["jsonp"]."('Testing data, you can put anything in here');"; 
```

请务必阅读有关[JSONP](http://remysharp.com/2007/10/08/what-is-jsonp/)的信息。

# ssis - SSIS - 是否有一个数据流源组件可以处理列顺序可能更改的 CSV 文件？

> ID：487988
> 
> 赞同：1
> 
> 时间：2009-01-28T15:14:57.153
> 
> 标签：ssis, csv

我们编写了许多使用平面文件源从 CSV 文件导入数据的 SSIS 包。

现在看来，在将这些包部署到生产中之后，这些文件的提供者可能会在文件的列顺序发生变化的情况下交付文件（不要问！）。目前，如果发生这种情况，我们的包将失败。

例如，在每行的开头插入一个附加列。在这种情况下，平面文件源继续使用现有的列顺序，这显然对转换产生了不利影响！

例如。使用一个简单的示例，原始文件具有以下内容：

```
OurReference,Client,Amount
235,MFI,20000.00
236,MS,30000.00 
```

平面文件源的输出是：

```
OurReference   Client   Amount
235            ClientA  20000.00
236            ClientB  30000.00 
```

随后，该文件将更改传递到：

```
OurReference,ClientReference,Client,Amount
235,A244,ClientA,20000.00
236,B222,ClientB,30000.00 
```

当针对此文件运行现有的未更改包时，平面文件源的输出为：

```
OurReference   Client   Amount
235            A244     ClientA,20000.00
236            B222     ClientB,30000.00 
```

理想情况下，我们希望使用能够解决这个问题的数据源——即根据列名而不是列顺序产生输出。

任何建议都会受到欢迎！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T16:00:56.577

最好的方法是在 SSIS 包导入 CSV 数据之前运行检查。这可能必须是外部脚本/应用程序，因为我认为您无法在 MS Business Intelligence Studio 中操作数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T18:25:51.417

从来没听说过。

提前检查问题的一种可能性是设置两个不同的连接管理器，一个具有单个扁平行。这个可以读取第一行并判断它是否正常并中止。

如果您想完成这项工作，您可以更进一步，将单字段行设置为唯一的连接管理器，并在流程中使用脚本组件来解析行并分配给稍后需要的列流动。

据我所知，没有办法在运行时动态地将列添加到流中 - 所以您需要的所有列都需要添加到脚本任务输出中。是否可以从每一行中找到并解析它们取决于您。不能使用任何“新”（即未预料到的）列。缺少的列可能会默认或引发异常。

最后一种可能性是使用 SSIS 对象模型在运行之前修改包以更改连接管理器 - 甚至根据输入文件的检查使用对象模型动态编写整个包。我已经使用模板在 C# 中进行了大量的包生成，然后根据从描述大型机文件的主文件中获得的元数据添加信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-02T05:58:13.130

这是一个粗略的方法。我会在最后写下限制。创建平面文件源。将整行放在一列中。不要检查第一个数据行中的列名。创建脚本组件代码：

```
public override void Input0_ProcessInputRow(Input0Buffer Row)
{
    string sRow = Row.Column0;

    string sManipulated = string.Empty;
    string temp = string.Empty;

    string[] columns = sRow.Split(',');

    foreach (string column in columns)
    {
       sManipulated = string.Format("{0}{1}", sManipulated, column.PadRight(15, ' '));
    }
    /* Note: For sake of demonstration I am padding to 15 chars.*/

    Row.Column0 = sManipulated; 
} 
```

创建平面文件目标将 Column0 映射到 Column0

限制：我已将每个字段任意填充到 15 个字符。需要考虑的要点： 1\. 我们需要让每个字段的大小相同吗？2\. 如果是，那是什么尺寸？

一种通用的处理方法是创建一个表来存储文件名、字段和字段大小。使用文件名动态创建源和目标连接管理器。使用字段名称和相应的字段大小来决定填充。不确定，如果你需要这么大的灵活性。如果您有任何问题，请回复。

# .net - App.config 文件有没有办法引用另一个完整的配置文件？（。网）

> ID：487991
> 
> 赞同：13
> 
> 时间：2009-01-28T15:15:25.030
> 
> 标签：.net, app-config

**更新：这个问题，包括标题，被改写，详情见历史**

我知道以下 App.config 包含一个外部文件：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <appSettings configSource="appSettings.config"/>
  <system.net>
    <connectionManagement>
      <add address="*" maxconnection="50"/>
    </connectionManagement>
  </system.net>
</configuration> 
```

但我不知道如何将 system.net 移动到第二个文件。实际上我没有尝试过，但我几乎可以肯定它不会起作用，我想知道 App.config 是否有办法通过引用包含另一个 App.config 文件。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-28T23:13:02.553

我能够使用 configSource 让它工作

```
<configSections>
    <section name="Sites"
             type="Wap.Common.Configuration.SiteHandler, Wap.Common" />
</configSections>

<Sites configSource="Sites.Prod.config" /> 
```

然后在外部配置文件中它需要有 ?xml 标记

```
<?xml version="1.0" encoding="utf-8" ?>
<Sites>
...
</Sites> 
```

然后您需要将外部配置文件设置为始终复制到输出目录

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-28T18:40:48.360

您不应将 system.net 部分放在 appSettings.config 中。标准做法是子配置文件中的一个配置节点。我什至不确定是否可以与不同的节点共享同一个文件。

您应该创建另一个名为 system.net.config 的文件，并将整个主体放在其中，完整的

```
 <system.net>
    <connectionManagement>
      <add address="*" maxconnection="50"/>
    </connectionManagement>
  </system.net> 
```

然后在 App.config 中您将更新 system.net 为

```
 <system.net>
    <connectionManagement configSource="system.net.connectionManagement.config"/>
  </system.net> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T15:21:18.887

我认为您只需删除 configSource 属性，然后在`<appSettings>`and`<connectionStrings>`元素中包含所有内容

# .net - 我可以使用哪些工具和技术来检测和隔离调用大量非托管代码的 .NET 应用程序中的高内存使用情况？

> ID：487994
> 
> 赞同：2
> 
> 时间：2009-01-28T15:17:45.883
> 
> 标签：.net, profiling, unmanaged, memory-profiling

假设我有一个用 C# 编写的 WinForms .NET 应用程序。此应用程序从托管堆和非托管堆中分配大量内存。[使用Red Gate ANTS Profiler](http://www.red-gate.com/Products/ants_profiler/index.htm)（我没有使用过）或[JetBrains dotTrace](http://www.jetbrains.com/profiler/)等工具，我可以（相对）轻松地找出托管对象的分配细节（谁、何时、多少等）。

当托管对象使用大量本机资源（例如图像或大型 COM 对象）时，或者当我调用具有大量内存需求的非托管第三方库时，我遇到了麻烦。到目前为止，我真的需要做一些侦探工作来弄清楚 1) 是托管代码还是非托管代码是内存占用者，以及 2) 谁使用了这么多非托管堆。

我目前唯一的技术是在 perfmon 中设置性能计数器，比较托管堆和非托管堆的大小、分配等。如果托管堆稳定时非托管堆继续增长，我知道要开始查看非托管库和/或消耗本机资源的 .NET 对象。

帮助开发人员处理大量托管**和**非托管代码的最佳工具和技术组合是什么？

更新：为了更清楚，我想知道如何检测从托管代码调用的非托管代码中的内存问题（高使用率、泄漏）。我相信像 dotTrace 这样的产品只跟踪托管对象。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T15:39:53.327

您可以使用与 .net 应用程序兼容的许多内存分析工具中的任何一种。一些如下：

1) [.NET 探查器 API](http://msdn.microsoft.com/en-us/magazine/cc188781.aspx)

2) [dotTRACE 分析器](http://www.jetbrains.com/profiler/index.html)

3)[内存分析器](http://memprofiler.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T15:45:06.797

您只需查看 Perfmon 中可用的许多 .NET 内存计数器即可获得概览。

如果您想使用免费工具，[Windows 调试工具](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)（特别是 WinDbg + SoS）可以告诉您为什么没有按预期收集对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-16T19:53:54.467

[Memory Validator](http://www.softwareverify.com/cpp/memory/index.html)可以告诉您所有有关 .Net 应用程序或混合模式 .Net 应用程序或本机应用程序中非托管（本机）分配的内存的信息。

# vba - 运行宏以更新单元格

> ID：487998
> 
> 赞同：0
> 
> 时间：2009-01-28T15:18:27.677
> 
> 标签：vba, excel

我有相当多的单元格链接到其他工作表/书籍等，使用标准 excel 公式。但是，是否有一个我可以运行的宏只允许在运行时更新这些单元格？我希望他们保留以前的值，直到我希望他们更新。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T15:27:11.620

您可以在工具 -> 选项 -> 计算选项卡中设置一些选项（这适用于 Excel 2003，不确定 2007）。我不确定是否有任何方法可以在 VBA 中编辑它们...

这些设置会影响在设置更改时打开的工作簿。如果您设置为手动计算，则公式仅在您按 F9 时更新，或者您可以使用 Shift + F9 更新当前工作表。

希望这可以帮助。

[编辑] 做了更多的阅读，看起来你可以使用 VBA 进行调整：

```
Application.Calculation = (xlCalculationAutomatic | xlCalculationManual | xlCalculationSemiAutomatic) 
```

还有一个 CalculateBeforeSave 属性，它听起来像它所做的那样......******