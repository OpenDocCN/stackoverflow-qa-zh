# StackOverflow 问答 000731000-000731999

# data-structures - 删除方法上不正确参数的最佳实践

> ID：731012
> 
> 赞同：3
> 
> 时间：2009-04-08T17:33:39.783
> 
> 标签：data-structures, collections, error-handling

所以我有一个名为 RegionModel 的抽象数据类型，它具有一系列值（区域），每个值都映射到一个索引。可以通过调用删除多个区域：

```
regionModel.removeRegions(index, numberOfRegionsToRemove); 
```

我的问题是当索引有效时处理呼叫的最佳方式是什么：

*（介于 0（含）和模型中的 Region 数量（不含）之间）*

但 numberOfRegionsToRemove 无效：

*(index + regionToRemove > 模型中的区域数)*

最好是抛出像 IllegalArgumentException 这样的异常，还是尽可能多地删除区域（从索引到模型末尾的所有区域）？

*子问题：*如果我抛出异常，推荐的单元测试方法是调用抛出异常并保持模型不变（我在这里使用 Java 和 JUnit，但我想这不是 Java 特定的问题）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T17:40:10.533

通常，对于这样的结构，您有一个带有索引的 remove 方法，如果该索引超出结构中项目的范围，则会引发异常。

话虽如此，您应该与采用单个索引的 remove 方法保持一致。如果它只是忽略不正确的索引，那么如果您的范围超过（甚至开始于）结构中项目的索引，则忽略它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T17:35:44.957

我会说诸如非法参数异常之类的参数将是最好的方法。如果调用代码没有传递一个可行的值，你不一定要相信他们真的想删除它让他们做的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T17:52:07.320

我同意 Mitchel 和 casperOne 的观点——例外是最有意义的。

就单元测试而言，JUnit4 允许您直接异常：http: [//www.ibm.com/developerworks/java/library/j-junit4.html](http://www.ibm.com/developerworks/java/library/j-junit4.html)

您只需传递保证会导致异常的参数，并将正确的注释 ( `@Test(expected=IllegalArgumentException.class)`) 添加到 JUnit 测试方法。

**编辑**：正如 Tom Martin 所提到的，JUnit 4 与 JUnit 3 相距相当大。但是，也可以使用 JUnit 3 测试异常。这并不容易。

我测试异常的方法之一是`try/catch`在类本身中使用一个块，并在其中嵌入`Assert`语句。

这是一个简单的例子——它不完整（例如 regionModel 被假定为被实例化），但它应该能够理解这个想法：

```
public void testRemoveRegionsInvalidInputs() {
  int originalSize = regionModel.length();
  int index = 0;
  int numberOfRegionsToRemove = 1,000; // > than regionModel's current size
  try {
    regionModel.removeRegions(index, numberOfRegionsToRemove);

    // Since the exception will immediately go into the 'catch' block this code will only run if the IllegalArgumentException wasn't thrown
    Assert.assertTrue("Exception not Thrown!", false);
  }
  catch (IllegalArgumentException e) {
     Assert.assertTrue("Exception thrown, but regionModel was modified", regionModel.length() == originalSize);
  }
  catch (Exception e) {
      Assert.assertTrue("Incorrect exception thrown", false);
  }
} 
```

# regex - 有没有办法使用正则表达式来匹配引号之外的文本模式？

> ID：731015
> 
> 赞同：3
> 
> 时间：2009-04-08T17:34:37.410
> 
> 标签：regex

如标题中所述，有没有一种方法可以使用正则表达式来匹配出现在引号之外的文本的文本模式。理想情况下，给定以下示例，我希望能够匹配引号之外的逗号，而不是引号中的逗号。

> 这是一些文本，后跟“文本，带引号！”

或者

> 这是一些文本，然后是“文本，带引号”和更多“文本，带引号！”

此外，如果表达式尊重嵌套引号，如以下示例所示，那就太好了。但是，如果这在技术上对于正则表达式是不可行的，那么很高兴知道是否是这种情况。

> 程序员从办公桌上抬起头来，“这不好，”他惊呼道，“系统在说‘找不到文件！’”

我找到了一些表达式来匹配引号中的内容，但对于引号之外的内容却没有。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T17:50:15.610

最简单的是匹配逗号和引号字符串，然后过滤掉引号字符串。

```
/"[^"]*"|,/g 
```

如果你真的不能让引号匹配，你可以这样做：

```
/,(?=[^"]*(?:"[^"]*"[^"]*)*\Z)/g 
```

这可能会变得很慢，因为对于每个逗号，它必须查看剩余的字符并计算引号的数量。`\Z`匹配字符串的结尾。类似于`$`，但永远不会匹配行尾。

如果您不介意额外的捕获组，则可以这样做：

```
/\G((?:[^"]*"[^"]*")*?[^"]*?)(,)/g 
```

这只会扫描字符串一次。它从字符串的开头计算引号。`\G`将匹配上一场比赛结束的位置。

* * *

最后一个模式可能需要一个例子。

```
Input String: 'This is, some text, followed by "text, in quotes!" and more ,-as'
Matches:
1\. ['This is', ',']
2\. [' some text', ',']
3\. [' and followed by "text, in quotes!" and more ', ','] 
```

它匹配逗号前的字符串以及逗号。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T18:04:14.967

由于存在大量对正则表达式引擎的黑客攻击，因此可以使用现代正则表达式来完成此操作，但让我成为发布“不要使用正则表达式执行此操作”答案的人。

这*不是*正则表达式的工作。这是一个成熟的解析器的工作。作为一个你不能用（经典）正则表达式做的事情的例子，考虑一下：

```
()(())(()()) 
```

没有（经典）正则表达式可以确定这些括号是否正确匹配，但是在没有正则表达式的情况下这样做是微不足道的：

```
/* C code */

char string[] = "()(())(()())";
int parens = 0;
for(char *tmp = string; tmp; tmp++)
{
  if(*tmp == '(') parens++;
  if(*tmp == ')') parens--;
}
if(parens > 0)
{
  printf("%s too many open parenthesis.\n", parens);
}
else if(parens < 0)
{
  printf("%s too many closing parenthesis.\n", -parens);
}
else
{
  printf("Parenthesis match!\n");
}

# Perl code

my $string = "()(())(()())";
my $parens = 0;
for(split(//, $string)) {
  $parens++ if $_ eq "(";
  $parens-- if $_ eq ")";
}
die "Too many open parenthesis.\n" if $parens > 0;
die "Too many closing parenthesis.\n" if $parens < 0;
print "Parenthesis match!"; 
```

看看编写一些非正则表达式代码来为您完成这项工作有多简单？

编辑：好的，从冒险乐园回来。:) 试试这个（用 Perl 写的，如果你不知道 Perl，评论帮助你理解我在做什么）：

```
# split $string into a list, split on the double quote character
my @temp = split(/"/, $string);

# iterate through a list of the number of elements in our list
for(0 .. $#temp) {

  # skip odd-numbered elements - only process $list[0], $list[2], etc.
  # the reason is that, if we split on "s, every other element is a string
  next if $_ & 1;

  if($temp[$_] =~ /regex/) {
    # do stuff
  }

} 
```

另一种方法：

```
my $bool = 0;
my $str;
my $match;

# loop through the characters of a string
for(split(//, $string)) {

  if($_ eq '"') {
    $bool = !$bool;
    if($bool) {

      # regex time!
      $match += $str =~ /regex/;

      $str = "";
    }
  }

  if(!$bool) {

    # add the current character to our test string
    $str .= $_;
  }
}

# get trailing string match
$match += $str =~ /regex/; 
```

（我给出两个是因为，在另一种语言中，一种解决方案可能比另一种更容易实现，而不仅仅是因为 There's More Than One Way To Do It™。）

当然，随着你的问题变得越来越复杂，构建一个成熟的解析器会带来一些好处，但那是另一回事。目前，这已经足够了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:08:09.730

如前所述，正[则表达式无法匹配任何嵌套模式](https://stackoverflow.com/questions/133601/can-regular-expressions-be-used-to-match-nested-patterns/133684#133684)，因为它不是[上下文无关语言](https://stackoverflow.com/questions/133601/can-regular-expressions-be-used-to-match-nested-patterns/133684#133684)。

因此，如果您有任何嵌套引号，则不会使用正则表达式来解决此问题。
（除了 .Net 正则表达式引擎的“[平衡组](http://blog.stevenlevithan.com/archives/balancing-groups)”功能 - 正如[Daniel L](https://stackoverflow.com/users/62055/daniel-l)在评论中提到的那样 - 但我在这里没有对正则表达式风格做出任何假设）

除非您添加进一步的规范，例如必须对引号中的引号进行转义。

在这种情况下，以下内容：

```
text before string "string with \escape quote \" still
within quote" text outside quote "within quote \" still inside" outside "
inside" final outside text 
```

将成功匹配：

```
(?ms)((?:\\(?=")|[^"])+)(?:"((?:[^"]|(?<=\\)")+)(?<!\\)")? 
```

*   group1：引用文本之前的文本
*   group2：双引号内的文本，即使`\"`其中存在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T17:42:03.693

这是一个获得匹配的表达式，但它并不完美，因为它获得的第一个匹配是整个字符串，删除了最后的 ".

```
[^"].*(,).*[^"] 
```

我一直在使用我的[免费 RegEx 测试器](http://www.iowacomputergurus.com/free-products/regular-expression-tester.aspx)来看看有什么用。

*测试结果*

```
Group Match Collection # 1
Match # 1
Value: This is some text, followed by "text, in quotes!
Captures: 1

Match # 2
Value: ,
Captures: 1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T18:05:07.337

您最好自己构建一个简单的解析器（伪代码）：

```
quoted := False
FOR char IN string DO
    IF char = '"'
        quoted := !quoted
    ELSE
        IF char = "," AND !quoted
            // not quoted comma found
        ENDIF
    ENDIF
ENDFOR 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T18:05:40.673

这实际上取决于您是否允许嵌套引号。

理论上，使用嵌套引号你不能这样做（常规语言不能算）

在实践中，如果可以限制深度，您可能会管理。随着复杂性的增加，它会变得越来越难看。这通常是人们对正则表达式感到悲痛的方式（试图匹配通常实际上不是正则的东西）。

请注意，一些“正则表达式”库/语言添加了非常规功能。

如果这种事情变得足够复杂，你真的必须为它编写/生成一个解析器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T18:13:56.660

你需要更多的描述。你想要任何一组可能的带引号的字符串和不带引号的字符串吗...

Lorem ipsum “dolor sit” amet，“consectetur adipiscing” elit。

...或者只是您要求的模式？我认为这非常接近......

```
(?<outside>.*?)(?<inside>(?=\")) 
```

但是，它确实捕获了“。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-08T18:33:23.180

也许你可以分两步完成？
首先，您替换引用的文本：

```
("[^"]*") 
```

然后你从剩余的字符串中提取你想要的

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-08T18:41:05.847

```
,(?=(?:[^"]*"[^"]*")*[^"]*\z) 
```

正则表达式可能无法计数，但它们可以确定是奇数还是偶数。找到逗号后，前瞻断言，如果前面有任何引号，则它们的数量是偶数，这意味着逗号*不在*一组引号内。

如果需要，可以对其进行调整以处理转义的引号，尽管最初的问题没有提到这一点。此外，如果您的正则表达式支持它们，我会添加原子组或所有格量词以保持回溯检查。

# python - 如何从 flash swf 文件中获取有用的信息？

> ID：731016
> 
> 赞同：1
> 
> 时间：2009-04-08T17:34:51.277
> 
> 标签：python, actionscript, flash

我正在用 Python 进行一些爬网，并希望能够识别（尽管不完美）我遇到的 flash - 它是视频、广告、游戏还是其他任何东西。

我想我必须反编译 swf，这似乎是可行的。但是我会用反编译的 Actionscript 做什么样的处理来弄清楚它的目的是什么？

编辑：或者任何更好的想法也将受到欢迎。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T17:48:08.937

我认为你最好的选择是检查你看到 swf 文件的上下文

通常它们嵌入在网页中，因此如果该页面出现 100 次“游戏”一词，那么它可能是一个游戏，例如

要检测广告可能会比较棘手，但我认为检查托管​​ swf 的域名可能会奏效，而且 swf 周围的 html 标签也很有用

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T17:55:12.197

查看传递给 Flash 电影的参数可能会有所帮助。如果引用了 FLV 文件，那么 SWF 很有可能被用于播放电影。

通往 SWF 的路径也可能有所帮助。如果它位于 /ads 目录下，那么它可能只是一个横幅广告。或者如果它在 /games 下，那么它可能是一个游戏。

除了使用这样的启发式方法之外，您可能无能为力。SWF 可以用于许多不同的事情，而且 SWF 本身并没有什么可以告诉您它是什么“类型”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T23:29:30.837

艰难的一个。我想您应该尝试为 swf 上下文找到一个范围。正如你所说，swfs 可以是：广告、游戏、视频播放器，它们还可以包含实验艺术。谁知道。一旦你知道你究竟想要什么，就应该更容易弄清楚如何寻找那种数据。

我认为开始使用商业网站会更容易。那些需要促销，所以如果他们可能会在考虑到一点 SEO 的情况下宣传 ria 的设置，那么请寻找 swfobject、swfaddress 和跟踪的东西（omniture 和谁知道还有什么）。他们应该在嵌入的 html 中有关键字。

据我所知，Google 和 Yahoo 正在与 Adob​​e 合作以使 SWF 可索引。[Adobe MAX](http://www.peterelst.com/blog/2009/03/10/flash-player-internals/)的 Flash Internals 演示文稿中提到了用于 Flash 索引的自定义 FlashPlayer 。希望能帮助到你。

# javascript - jQuery UI Datepicker：今天也被选中时不要突出显示

> ID：731018
> 
> 赞同：4
> 
> 时间：2009-04-08T17:35:16.910
> 
> 标签：javascript, jquery, css, datepicker

我正在使用[jQuery datepicker](http://docs.jquery.com/UI/Datepicker)来选择日期。它工作正常，除了我想更改 1 个默认行为。当您选择一天时，所选日期会突出显示（我喜欢）。当天也突出显示，但使用不同的 css 样式（我也喜欢）。但是，如果您选择当天，突出显示因为它是当天取代它被选择...我更希望它被选择取代当天的突出显示，我觉得这很清楚您已经选择了当天。

现在，我觉得我可能可以更新 css 来解决我的问题。但是，我真的不想调整开箱即用的 jQuery UI css，因为我想稍后将皮肤添加到我的应用程序中。这意味着如果我抓住一堆 jQuery UI 主题......然后我必须对所有主题进行相同的调整（非常不受欢迎）。

我可能也可以更新实际的 Datepicker 插件来执行此操作，但后来我遇到了一个问题，如果我想稍后更新我的 Datepicker...我需要记住再次进行此修复。

理想情况下，我可以使用 Datepicker 中内置的一些选项来实现我的目标，但到目前为止，似乎没有一个选项是正确的。我会满足于某种 JavaScript hack，或者 css 突然出现在页面中，但我现在不知所措。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T18:24:16.540

向您的页面添加额外的 CSS 文件绝对是首选方法。它易于管理并按照预期的方式使用 CSS！

您需要将覆盖 CSS 放在任何先前加载的基本 jQuery CSS 或任何主题 CSS 文件之后的 head 标记中，以便覆盖它们的值。（您还可以增加默认标记的特异性，在您的特定实例中引用类或 ID。）

IE

```
<head>
  <link href="base_jquery_css_file" rel="stylesheet"/>
  <link href="theme_jquery_css_file" rel="stylesheet"/>

  <link href="your_override_css" rel="stylesheet"/>
</head> 
```

“your_override_css”文件将仅包含：

```
.ui-state-active, .ui-widget-content .ui-state-active {
  /*any CSS styles you want overriden i.e.*/
  border: 1px solid #999999;
  background-color: #EEEEEE;
} 
```

* * *

**迈克的注意事项：**

我最终发现在代表日子的锚点周围有一个 td ，并且 td 也有“今天”信息......所以尽管没有跨浏览器的方式来选择具有多个类的项目（我发现），以下将在这种情况下工作，在一个新文件中，就像 PHPexperts.ca 描述的那样：

```
.ui-datepicker-today .ui-state-active {
  border: 1px solid #aaaaaa;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-17T20:28:06.583

由于我花了一段时间才弄清楚如何在今天的风格之上准确地复制“选定”风格，即使有 PHPexperts.ca 的答案，这里有更多信息，如果你是遇到麻烦。

如果您选择“今天”以外的日期，则在选择“今天”时应复制的样式在`a`标签和选择器中

`.ui-state-active, .ui-widget-content .ui-state-active, .ui-widget-header .ui-state-active`

如果您安装了带有 Firebug 的 Firefox，这应该很容易找到（选择日期，重新打开日期选择器，右键单击并选择“检查元素”。

对于 jQuery UI 主题“UI 黑暗”，要复制到覆盖 CSS 中的样式是

`.ui-state-active, .ui-widget-content .ui-state-active, .ui-widget-header .ui-state-active { background:url("images/ui-bg_inset-soft_30_f58400_1x100.png") repeat-x scroll 50% 50% #F58400; border:1px solid #FFAF0F; color:#FFFFFF; }`

如果您更改主题，看起来所有 3 种样式都会更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-19T18:09:01.603

实际上，这很容易，只需将背景和边框元素添加`!important`到`.ui-state-active`类中即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-09-18T23:02:53.417

```
.ui-state-highlight {
    border: 1px solid #d3d3d3 !important;
    background-color: #e6e6e6 !important;
} 
```

# c# - .Net 中 C# 指针的使用

> ID：731019
> 
> 赞同：1
> 
> 时间：2009-04-08T17:35:31.697
> 
> 标签：c#, pointers

我想知道是否有人可以给我一个在 .Net 中在 C# 中使用指针的好例子，以及为什么选择使用指针？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T17:42:53.210

这并不是一个特定于 ASP.NET 的问题。

如果您打算在 .NET 中使用指针，主要原因是您有一个互操作场景，在这种情况下，在不安全代码中使用指针而不是 IntPtr 实例会更容易。

第二个最流行（也很遥远）的原因是，在处理不安全代码中的大量数据时，您实际上可能比在托管代码中获得性能提升。图像处理算法就是一个很好的例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T17:42:18.467

如果您想为 Web 应用程序执行一些高性能的图像处理，您可能需要考虑在那里使用指针。请参阅codeproject.com 上*[的 C# 图像处理基础知识。](http://www.codeproject.com/KB/recipes/ImageBasicCS.aspx)*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T17:42:26.003

只有在使用非托管代码或进行 pinvoke 调用时，才需要使用指针。

# asp.net-mvc - MVC 中服务器控件的替代方案

> ID：731020
> 
> 赞同：0
> 
> 时间：2009-04-08T17:35:32.447
> 
> 标签：asp.net-mvc, servercontrols

ASP.NET MVC 中服务器控件的替代品是什么？我想做的是创建一个声明式和命令式绑定，这样我就可以编写

```
<cc1:MyControl Header="Some Header" Content="Some Content" /> 
```

这意味着 MyControl 类的一个实例将被创建并可能呈现给

```
<h1>Some Header</h1>
<p>Content</p> 
```

我不想要任何视图状态或回发废话，只是模块化。我还希望这些模块包含在一个单独的类库中，所以 ViewUserControls 不会为我做。以正常方式使用服务器控件是可行的，但它会生成一个表单标记和一个视图状态字段，如果可以避免的话，我不想要它。

我已经看到[了这个问题](https://stackoverflow.com/questions/317995/server-controls-and-mvc)和[这个](https://stackoverflow.com/questions/264664/server-controls-in-asp-net-mvc)关于如何在 ASP.NET MVC 中使用服务器控件的问题，但它们没有提供足够的答案。

**编辑：**我找到了答案。当我使用设计器添加用户控件时，它会自动创建一个我错过的 <form>。如果我只是删除该标签，一切都会完美无缺。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T17:38:35.277

如果不需要在服务器窗体中呈现，您仍然可以使用ASP.NET MVC 中的**所有控件。**

`ascx`文件和`@Register`指令仍然可以很好地工作。伟大的新事物是`Html.RenderPartial`允许您将模型对象传递给局部视图 ( `ascx`) 并使其相应呈现的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T17:51:06.823

只需为**Mehrdad**答案添加一种可能性，您就可以使用**扩展方法**来执行如下简单控制：

```
<%= html.MyControl( "Some header", "Some content" ) %>

<Extension()> _
Public Function MyControl(ByVal htmlHelper As HtmlHelper, _
                         ByVal Header As String, _
                         ByVal Content As String) As String

Dim sb As New StringBuilder()
sb.AppendFormat("<h1>{0}</h1>", Header)
sb.AppendFormat("<p>{0}</p>", Content)
Return sb.ToString()
End Function 
```

或者你可以像这个例子一样制作一个更复杂的控件：[创建一个 ASP.NET MVC GridView Helper Method](http://stephenwalther.com/blog/archive/2008/06/25/asp-net-mvc-tip-8-create-an-asp-net-mvc-gridview-helper-method.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T09:34:48.017

除了仍然适用于 ASP.Net MVC 的控件之外，您还可以使用`mvc`控件。

*   [中继器示例](http://davidhayden.com/blog/dave/archive/2009/04/07/ASPNETMVCControlsASPNETMVCFuturesRepeaterControlExample.aspx)-***死链接***
*   [探索 ASP.Net MVC 期货](http://blog.maartenballiauw.be/post/2009/04/02/Back-to-the-future!-Exploring-ASPNET-MVC-Futures.aspx)-***死链接***

**更新**：此答案适用于 2009 年的 ASP.Net MVC 1.0。此时它已过时且无关紧要。

# java - 调试 JBehave 场景

> ID：731023
> 
> 赞同：3
> 
> 时间：2009-04-08T17:36:02.850
> 
> 标签：java, debugging, testing, bdd

我在调试 jbehave 测试时遇到问题。我无法让 Maven 启动 jbehave 测试并在断点处停止。我的 pom 中有这个：

```
<pluginManagement>
 <plugins>
   <plugin>
     <groupId>org.jbehave</groupId>
     <artifactId>jbehave-maven-plugin</artifactId>
     <version>2.0.1</version>
   </plugin>
 </plugins>
</pluginManagement>
<plugins>
 <plugin>
   <groupId>org.jbehave</groupId>
   <artifactId>jbehave-maven-plugin</artifactId>
   <executions>
     <execution>
       <id>run-scenarios-found</id>
       <phase>test</phase>
       <configuration>
         <scenarioIncludes>
           <scenarioInclude>**/scenario/**/*${test}.java</scenarioInclude>
         </scenarioIncludes>
         <scenarioExcludes>
           <scenarioExclude>**/*Steps.java</scenarioExclude>
         </scenarioExcludes>
       </configuration>
       <goals>
         <goal>run-scenarios</goal>
       </goals>
     </execution>
   </executions>
 </plugin>
</plugins> 
```

我试过这样的事情：

```
$  mvn -e -o -Dtest=MyTest -Dmaven.surefire.debug="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8787 -Xnoagent -Djava.compiler=NONE" clean test 
```

和

```
$ export MVN_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8787 -Xnoagent -Djava.compiler=NONE" ; mvn -Dtest=MyTest clean test 
```

我可以尝试使用[jsadebugd](http://java.sun.com/javase/6/docs/technotes/tools/share/jsadebugd.html)，但我可能需要完美的时间来自动化，所以这听起来像是一个次优的解决方案，我觉得 JBehave Maven 插件应该提供这个功能。显然，我还没有找到合适的文档。有什么想法我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T20:45:20.880

以下对我有用： export MAVEN_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8787 -Xnoagent -Djava.compiler=NONE"

然后开始我的 mvn 测试： mvn install

（maven 现在挂起等待调试器连接）

然后在远程调试会话中启动 Eclipse，指向本地主机，端口 8787（如上），并设置适当的断点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-22T15:14:29.463

不使用 maven 开始测试，而是使用 JUnit 在 IDE 中开始测试不是更容易吗？那你可以直接使用调试器吗？我通常这样做，CI 服务器使用 maven 来执行 JBehave，但在 IDE 中，我更喜欢更直接的执行方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-06-14T08:21:22.257

这对我有用：

1.  在 Eclipse**运行**->**调试配置...**
2.  选择**Maven Build**并单击**New**按钮
3.  设定目标（`clean very`在我的例子中）和可能的参数
4.  点击**调试**按钮

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2016-10-13T19:19:15.220

mvn -e -o -Dmaven.surefire.debug="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8787 -Xnoagent -Djava.compiler=NONE" 集成测试

这条线非常适合我。使用调试端口 (8787) 在 eclipse 中设置您的 Jbehave 项目，并在 mvn 等待连接到您的 eclipse 项目时快速连接到调试器。

# java - 作为服务器的 servlet 中的套接字编程，启动一种服务器推送环境是一个好的解决方案吗？

> ID：731031
> 
> 赞同：0
> 
> 时间：2009-04-08T17:40:50.763
> 
> 标签：java, servlets, server-push

作为服务器的 servlet 中的套接字编程，启动一种服务器推送环境是一个好的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T19:53:11.930

我不会在 servlet 中进行套接字编程。如果套接字比启动它的请求寿命长，您可能会遇到各种问题。

看看[cometd](http://cometdproject.dojotoolkit.org/)项目。Comet 是一种进行 HTTP-push 的技术（基本上，您将 HTTP 连接保持打开任意长时间，服务器在事件发生时将事件推送到客户端，而不是等待客户端轮询）。您需要一个可以扩展以支持大量大部分空闲连接的 Web 服务器，但这并不难，而且 cometd 项目有许多可供下载的实现。你可以使用他们的，或者如果你想建立自己的，就看看它以获得灵感。

# c++ - 在应用程序中加入文本文件？

> ID：731032
> 
> 赞同：0
> 
> 时间：2009-04-08T17:40:54.273
> 
> 标签：c++, file, import, text-files

无论如何我可以将一个相当大的文本文件（大约 700KB）合并到程序本身中，所以我不必将文本文件一起发送到应用程序目录中？这是我第一次尝试做这样的事情，我不知道从哪里开始。

非常感谢您的帮助（：

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T17:45:26.337

根据您所在的平台，您很可能能够将文件嵌入到某种资源容器中。

如果您在 Windows 平台上编程，那么您可能需要查看资源文件。您可以在此处找到基本介绍：

[http://msdn.microsoft.com/en-us/library/y3sk7e6b.aspx](http://msdn.microsoft.com/en-us/library/y3sk7e6b.aspx)

这里有更详细的信息：

[http://msdn.microsoft.com/en-us/library/zabda143.aspx](http://msdn.microsoft.com/en-us/library/zabda143.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T18:23:10.677

查看**`xxd`**命令及其**`-include`**选项。您将在 C 格式文件中获得一个缓冲区和一个长度变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:13:25.570

如果您能弄清楚如何使用资源文件，那将是首选方法。

将文本文件转换为可以由编译器直接编译的文件并不难。这可能仅适用于小文件 - 您的编译器可能对单个字符串的大小有限制。如果是这样，一个微小的语法更改将使它成为一个可以正常工作的较小字符串的数组。

您需要通过在顶部添加一行、将每一行括在引号中、在每行末尾放置一个换行符、转义文本中的任何引号或反斜杠以及在末尾添加一个分号来转换文件。您可以编写一个程序来执行此操作，或者可以在大多数编辑器中轻松完成。

```
This is my example document:
"Four score and seven years ago,"
can be found in the file c:\quotes\GettysburgAddress.txt 
```

将其转换为：

```
static const char Text[] =
"This is my example document:\n"
"\"Four score and seven years ago,\"\n"
"can be found in the file c:\\quotes\\GettysburgAddress.txt\n"
; 
```

这会产生一个变量 Text ，其中包含一个包含文件全部内容的字符串。它之所以有效，是因为之间只有空格的连续字符串被连接成一个字符串。

# asp.net-mvc - 如何为 ASP.NET MVC 站点的主页设置路由？

> ID：731040
> 
> 赞同：14
> 
> 时间：2009-04-08T17:42:38.513
> 
> 标签：asp.net-mvc, routing

我正在使用一个 ASP.NET MVC 站点，该站点将对除主页之外的所有站点页面使用 CMS 控制器。这是想法：

**家庭控制器：**

*   www.site.com
*   www.site.com/default.aspx

**CMS 控制器：**

*   www.site.com/about
*   www.site.com/agenda/schedule
*   www.site.com/monkey/eats/spaghetti
*   （几乎所有其他）

[此页面](http://www.58bits.com/blog/2008/09/29/ASPNetMVCAndRoutingDefaultaspx.aspx)列出了一些有关如何设置默认页面路由的选项：

1.  保留 Default.aspx 未路由和未重定向作为应用程序的入口点 - 使用静态链接将您的用户带入应用程序的 MVC 部分（或其他静态内容）。
2.  在后面的代码中重定向 Default.aspx，或者使用 Page_Load 事件处理程序代码，或者使用 Response.Redirect("~/home") 将它们发送到 Home 控制器（尽管这是一个往返重定向）。
3.  重命名或删除 Default.aspx。尽管标记中的警告说 default.aspx 需要确保 ASP.NET MVC 在用户发出“/”请求时被 IIS 激活......它实际上在 VS 开发服务器或 IIS7 中都不需要. 默认请求将保持为应用程序根请求“/”，并将被默认路由捕获并发送到主控制器。

我想另一种选择是只使用一个带有一些逻辑的控制器来检测主页案例，但这似乎与这个概念背道而驰。

您如何建议为网站主页设置特定路由？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-08T17:52:08.537

www.site.com 可以由根地图路由处理

```
routes.MapRoute(
    "Root",
    "",
    new { controller = "Home", action = "Index", id = "" }
); 
```

将以下内容放入 Default.aspx 的页面加载中

```
HttpContext.Current.RewritePath(Request.ApplicationPath, false);
IHttpHandler httpHandler = new MvcHttpHandler();
httpHandler.ProcessRequest(HttpContext.Current); 
```

这会将请求重写为 root 并由上面的 map 路由处理。

顺便说一句，您实际上可以从 MVC 模板项目中找到代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T17:50:55.670

如果托管在 IIS7 集成模式下，我建议只是摆脱 default.aspx。据我了解，它只需要在 IIS6 和 IIS7 经典模式下激活。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T17:59:50.890

我认为选项＃1是最简单的。我可能会坚持下去，直到找到搬家的有力理由或找到替代方案。默认模板使用这种方法。

[更新] 广州打败了我

# .net - 我在哪里可以下载适用于 .NET 的 Crystal Reports 的免费开发人员版本/版本/包？

> ID：731046
> 
> 赞同：0
> 
> 时间：2009-04-08T17:44:30.617
> 
> 标签：.net, crystal-reports

如果可能，我正在寻找版本 11，但找不到它。我有 Visual Studio 2005 附带的旧版本，但需要更新的版本。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:57:04.237

[Crystal Reports 2008 30 天评估](http://www.businessobjects.com/campaigns/forms/downloads/crystal/2008/default.asp)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:00:09.127

我所知道的唯一免费的软件是 Visual Studio 安装。你指的是这个吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T23:48:18.737

Visual Studio 2008 附带“Crystal Reports Basic for Visual Studio 2008”，它基于完整 Crystal 产品的第 XI 版。

# c# - 如何在不显示表单的情况下打印 ReportViewer 的报告

> ID：731049
> 
> 赞同：14
> 
> 时间：2009-04-08T17:46:23.777
> 
> 标签：c#, .net, reporting-services

虽然我意识到我可以只在屏幕外显示表单并将其隐藏，以及许多其他形式的 WinForms hackish 巫术，但我宁愿坚持使用禅宗路径并正确完成此操作。我有一个 SSRS 本地报告（所以没有服务器），我想让用户选择查看或打印（换句话说，我不想强​​迫他们查看打印）。不幸的是，当我尝试将 ReportViewer 控件打印为我在代码中显式创建的组件（当然是在 using() 块内）或尝试实例化查看器表单时，ReportViewer 控件抱怨其“状态”只是打印而不显示它。

有没有一种方法可以让我很满意，或者我应该在屏幕外展示它并继续我的生活？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-12T20:49:05.683

我在我的博客上发布了一个示例：http: [//blogs.msdn.com/brianhartman/archive/2009/02/27/manually-printing-a-report.aspx](http://blogs.msdn.com/brianhartman/archive/2009/02/27/manually-printing-a-report.aspx)

LocalReport 对象可以独立于 ReportViewer 控件进行实例化，并直接在该博客文章所附的示例代码中使用。或者，即使您没有首先在 UI 中显示报告，也可以传入 ReportViewer.LocalReport。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T21:28:14.680

检查一下，看看它是否有帮助...... [http://scruffylookingcatherder.com/archive/2007/12/07/printing-reporting-services-2005-reports.aspx](http://scruffylookingcatherder.com/archive/2007/12/07/printing-reporting-services-2005-reports.aspx)

一点解释：它使用 SSRS Web 服务将报告呈现为 EMF 图像，然后将图像发送到打印机。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-24T20:03:19.473

请参阅以下对您非常有用的链接 [http://social.msdn.microsoft.com/Forums/en-US/9f52d79d-5baf-4e84-97d5-7dbba6623b89/printing-without-the-reportviewer](http://social.msdn.microsoft.com/Forums/en-US/9f52d79d-5baf-4e84-97d5-7dbba6623b89/printing-without-the-reportviewer)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-03-20T09:19:58.663

```
Private Sub btnReceipt_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnReceipt.Click

    My.Forms.FormA5.ReportViewer.LocalReport.DataSources.Clear()
    Dim cmd = New SqlClient.SqlCommand("Select * from V_Sale where InvoiceNo=" & Me.txtInvoice.Text, cn)
    Dim dr = cmd.ExecuteReader()
    Dim dt As New DataTable
    dt.Load(dr)
    dr.Close()
    Dim rpt As New ReportViewer
    rpt.LocalReport.DataSources.Clear()
    rpt.LocalReport.DataSources.Add(New ReportDataSource("posds_receipt", dt))
    rpt.LocalReport.ReportEmbeddedResource = "POSsystem.receipt.rdlc"
    rpt.SetDisplayMode(DisplayMode.PrintLayout)
    rpt.ZoomMode = ZoomMode.FullPage

    Dim printDialog1 As PrintDialog = New PrintDialog
    printDialog1.Document = PrintDocument1
    Dim result As DialogResult = printDialog1.ShowDialog
    If (result = DialogResult.OK) Then
        PrintDocument1.Print()
    End If

End Sub 
```

# .net - Web 服务、ADO.NET 连接池、超时错误

> ID：731051
> 
> 赞同：0
> 
> 时间：2009-04-08T17:47:44.007
> 
> 标签：.net, web-services, ado.net, soap, connection-pooling

如果我有一个只公开一个调用的 .asmx Web 服务。一种需要一些参数并将这些值作为记录插入 SQL Server 2005 表中的方法。该方法应该看起来如何与 ADO.NET 连接池尽可能“友好”？如果它可能每秒被调用 10 次（分散）到多个客户端，它应该是什么样子。我应该调整任何其他设置吗？

目前我收到错误：

> System.Web.Services.Protocols.SoapException：
> 服务器无法处理请求--> System.Data.SqlClient.SqlException：超时已过期。操作前超时时间已过或服务器未响应。

如果连接池是问题，错误会有所不同吗？如何判断这是连接池问题、SOAP 限制，还是我的数据库太忙以至于调用真的超时了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:58:08.977

您没有发布有关您正在做的事情的一些最重要的信息。它是一个网络方法的事实是一个红鲱鱼，它只是归结为一个数据库问题，以及你有多少锤击它。

正如异常状态所示，您似乎在这里可能遇到了连接问题（而且我认为这与池没有任何关系）。您是否在尝试打开连接或尝试执行操作时收到此信息？每个都有一个单独的超时，因此最好显式打开连接然后调用操作，这样您就可以看到超时发生的位置。

另外，我想看看您是否正在使用事务。如果这包含在连接中，并且操作超时，并且您正在使用事务，那么您是否使用事务来访问包含在事务中的其他任何地方（读取或写入）的表？那时可能会陷入僵局。

除此之外，如果不是这种情况，那么这是一个连接问题，您必须查看机器和服务器是否配置正确（例如，您是否使用 tcp ip、命名管道或共享内存）用于数据库操作。

# asp.net - 如何在 ASP.NET 中动态生成图像

> ID：731055
> 
> 赞同：0
> 
> 时间：2009-04-08T17:48:52.540
> 
> 标签：asp.net, vb.net, graphics, image

正如标题所说，如何动态生成（和显示）图像以进行简单的图表、调整大小等？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T17:52:27.430

对于图表，您可能需要查看 ASP.NET 图表控件。

[http://weblogs.asp.net/scottgu/archive/2008/11/24/new-asp-net-charting-control-lt-asp-chart-runat-quot-server-quot-gt.aspx](http://weblogs.asp.net/scottgu/archive/2008/11/24/new-asp-net-charting-control-lt-asp-chart-runat-quot-server-quot-gt.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T17:52:42.513

使用`System.Drawing`命名空间。

添加对`System.Drawing`程序集的引用。创建一个新`Bitmap`类。调用`CreateGraphics`它。使用返回的`Graphics`对象进行绘图。将 设置`Response.ContentType`为适当的图像 MIME 类型。最后保存`Bitmap`到`Response.Output`流中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:43:45.183

检查有关 System.Drawing 和 ASP.NET [http://msdn.microsoft.com/en-us/library/system.drawing.aspx](http://msdn.microsoft.com/en-us/library/system.drawing.aspx)的注意事项 如果我现在这样做，我会使用 WPF [http://www。 codeproject.com/KB/WPF/WPF-Image-to-WebPage.aspx](http://www.codeproject.com/KB/WPF/WPF-Image-to-WebPage.aspx)

# python - Pygame无效的语法我只是想不通

> ID：731057
> 
> 赞同：0
> 
> 时间：2009-04-08T17:49:15.563
> 
> 标签：python, syntax, pygame

我一直在学习“McGugan - 使用 Python 和 Pygame 开始游戏开发（Apress，2007）”教程，在涉及对象移动的第五章左右的代码中，我不断收到关于代码中使用的“-”的无效语法警报。它不是最新的，但由于其简单性和必要性，我认为在任何更新中都不会更改减法。

这是我的代码：

```
background_image_filename = 'sushiplate.jpg'
sprite_image_filename = 'fugu.png'
import pygame
from pygame.locals import *
from sys import exit
from gameobjects.vector2 import Vector2
pygame.init()
screen = pygame.display.set_mode((640, 480), 0, 32)
background = pygame.image.load(background_image_filename).convert()
sprite = pygame.image.load(sprite_image_filename).convert_alpha()
clock = pygame.time.Clock()
position = Vector2(100.0, 100.0)
speed = 250.
heading = Vector2()
while True:
    for event in pygame.event.get():
        if event.type == QUIT:
            exit()
    if event.type == MOUSEBUTTONDOWN:
        destination = Vector2(*event.pos) – Vector2(*sprite.get_size())/2.
        heading = Vector2.from_points(position, destination)
        heading.normalize()
    screen.blit(background, (0,0))
    screen.blit(sprite, position)
    time_passed = clock.tick()
    time_passed_seconds = time_passed / 1000.0
    distance_moved = time_passed_seconds * speed
    position += heading * distance_moved
    pygame.display.update() 
```

我做错了什么还是只是过时了？

非常需要任何帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T17:54:20.887

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T17:55:01.760

I can't be sure without a stack trace, but I have a hunch that it's the wrong - symbol. What editor are you using? Is it possible that your editor is taking the - symbol and turning it into a fancier dash, like an ndash or an mdash?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T17:55:13.040

Maybe try changing speed to "speed = 250.0". I don't know if that dangling dot would throw python off.

What is going on here, with your error message at least, is the Python parser is stumbling over something before your '-', which screws up its interpretation of '-'. So I recommend looking before the '-' for typos.

Also, make sure you turn on visible white space in your editor when debugging Python code. This could be a white space error, which would be invisible to us at Stack Overflow.

**EDIT:**
So I was completely wrong about that '-' error being a red herring. But keep that parser behavior in mind/white space thing in mind, could help in the future.

Apologies if this is obvious to you, I don't know what level you are at with Python.

# design-patterns - 访问者模式和递归

> ID：731059
> 
> 赞同：3
> 
> 时间：2009-04-08T17:49:58.073
> 
> 标签：design-patterns, visitor-pattern

在递归场景中使用访问者模式有什么优势吗？如果是这样，您可以以编程方式演示它吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T18:10:09.523

遍历二叉树怎么样？例如

```
private class NodeVisitor{
 public void visit(VisitableNode<T> node){
    if (node!=null) {
       print node.data;
    }
 }
}

public class VisitableTree<T> {

  private VisitableNode<T> root;
  public void printNodes(){
    new NodeVisitor.visit(root);
  }

 private class VisitableNode<T> {
     T data;
     VisitableNode<T> left;
     VisitableNode<T> right; 
     public void visit(NodeVisitor<T> visitor){
       ..do something
       visitor.visit(left);
       visitor.visit(right);
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:09:03.833

我认为主要的好处是它只需要对 1 级深度的集合进行迭代。它可以回调，但至少 accept() 方法是干净的。

# c - 静态矩阵或动态分配矩阵

> ID：731065
> 
> 赞同：0
> 
> 时间：2009-04-08T17:51:08.867
> 
> 标签：c, network-programming

我想为 Petri 网络的净化建模。我被建议使用动态分配的矩阵。在考虑了这个问题后，我想出了一种不同的方法，如下所示：

一个包含 n 个转移和 p 个位置的静态矩阵，以及一个从静态矩阵返回纯化矩阵的函数。

哪种方法最安全、最好？静态实现还是动态实现？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:53:24.230

动态分配的矩阵更好：

*   可以调整大小以适应输入尺寸
*   你只为你需要的东西付费

尽管您有责任自己管理内存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T17:55:30.107

在安全方面，静态实现泄漏内存的可能性要小得多。动态的虽然更灵活。如果您正在考虑这个问题，最好只使用动态解决方案。

# c# - 从负载处理程序关闭表单

> ID：731068
> 
> 赞同：10
> 
> 时间：2009-04-08T17:51:53.047
> 
> 标签：c#, winforms, objectdisposedexception

我有一个非常奇怪的行为，似乎只发生在一种形式上。

基本上我正在创建一个实例`Form`，并调用`Show()`以非阻塞显示表单。在该表单的事件处理程序中，我有一些在某些情况下`Load`可能会调用的逻辑。`this.Close()`这会关闭表单，但随后`Show()`客户端代码中的表单方法会抛出`ObjectDisposedException`.

ObjectDisposedException 的堆栈跟踪如下：

> 在 System.Windows.Forms.Control.CreateHandle()
> 在 System.Windows.Forms.Form.CreateHandle()
> 在 System.Windows.Forms.Control.get_Handle()
> 在 System.Windows.Forms.ContainerControl.FocusActiveControlInternal()
> 在 System .Windows.Forms.Form.SetVisibleCore(Boolean value)
> at System.Windows.Forms.Control.Show()
> ...等。

这就是我所看到的：

1.  `Control.Show()`叫做
2.  我的表格已启动
3.  该`OnFormLoad`方法被调用
4.  事件`FormLoad`处理程序被调用，在其中我调用`this.Close()`
5.  该`OnFormClosing`方法被调用
6.  事件`FormClosing`处理程序被调用
7.  `Dispose`在我的表单及其所有用户控件上调用

然后在接近`Control.Show()`方法末尾的某个地方，它尝试获取表单的句柄，因为对象被标记为已释放，所以它吓坏了并抛出异常。

我真正的问题是，为什么我可以毫无例外地在我拥有的所有其他表格上做同样的事情？是GC问题吗？我试过在`GC.Collect()`之后立即打电话`this.Close()`，这没有什么区别。就像我说的，它 100% 的发生在这个表单上，从来没有发生在其他任何地方，不管子用户控件、表单变量的范围等。

有任何想法吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2013-07-22T08:49:57.493

最好的方法：

```
 this.BeginInvoke(new MethodInvoker(this.Close)); 
```

这是您不会得到 ObjectDisposedException 的最简单方法

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-10-29T13:33:58.273

我知道这是一个老问题，但似乎没有人发布明显的答案。

你说你打电话`Control.Show()`，然后`Form.Close()`表格就被处理掉了。好吧，除非您使用 MDI 或使用`ShowDialog`文档中的内容。虽然，`Close()`文档的简短版本是“关闭表单”，但它实际上也在某些条件下隐式处理它。

请参阅备注部分：http: [//msdn.microsoft.com/en-us/library/system.windows.forms.form.close.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.close.aspx)

如果您想再次显示表单。使用`Hide()`方法而不是`Close()`.

希望能帮助其他寻找灵魂的人。

伙计们，不要停止搜索“我不知道为什么它有时会起作用”。这变成了有很多防御性的错误软件“我会再次调用这个方法以防万一”的东西。不好。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-08T19:35:08.900

好的，讨厌回答我自己的问题，但这让我发疯了，这是我见过的最难重现的错误之一。

在我的表单上，我重写了 OnFormLoad 和 OnFormClose 方法，在其中我将表单的大小、位置和 WindowState 保存到注册表/从注册表中恢复。我把这段代码拿出来，它解决了这个问题。奇怪的是，我把它放回去了，问题没有回来。

我终于重现了这个问题：您必须让表单完全打开，将其最大化，然后将其关闭，以便将最大化状态保存到注册表中。然后当你再次打开它时，它会将其设置为最大化，如果它在负载处理程序中关闭，它会在关闭时尝试访问大小/位置。显然，在 OnFormClosing 方法中访问这些值会导致表单在且仅当表单最大化时才尝试聚焦，这是非法的，因为表单已被释放。

因此，基本上，如果该表单要从其 Load 事件中调用 Close，则您无法在表单的 OnFormClosing 方法中访问表单显示属性。（除非您先检查 Disposed 道具）

我知道非常具体的 Winforms 智慧，但我还是把它写下来。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-10-30T09:25:40.907

如果您想像用户按下右上角的十字一样关闭表单（通常表示取消），只需添加以下代码即可。

```
this.DialogResult = System.Windows.Forms.DialogResult.Cancel;
this.Close(); 
```

这也适用于表单加载功能：

```
private void MyForm_Load (object sender, EventArgs e)
{
    // do some initializations

    if (!ContinueLoadingForm())
    {
         this.DialogResult = System.Windows.Forms.DialogResult.Cancel;
         this.Close();
         return;
    }
    // continue loading the form
} 
```

如果您不希望表单在短时间内可见，请将 Visible 属性设置为 false（例如在设计器或构造器中），并在您确定程序可以继续加载时将其设置回 true。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T17:56:22.053

在加载事件中关闭表单并不是一个好主意。在激活事件之后执行此操作。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-05-15T16:22:44.990

```
protected override void CreateHandle()
   {
        base.CreateHandle();

        if (FormMustClose)  //FormMustClose is a variable in the loadevent.
        {
            Close();
        }
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T17:56:06.483

一种可能：

他们可能在此表单上有一个计时器，该计时器在他们的 FormLoad 事件中被初始化和启用。如果计时器在触发时尝试访问表单，则还需要在表单关闭之前禁用和停止计时器。

我以前见过这样的表格...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-08T17:55:48.013

在我看来，如果不仔细观察，完成您想要的最干净的方法可能是创建一个派生自 的自定义表单类`Form`，并覆盖`OnFormLoad(...)`和/或`Show()`检查您的状况并提前取消。

也就是说，我不知道为什么它有时会起作用而其他时候不起作用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-08T18:10:33.500

您是否尝试过进入 .net 代码以查看发生异常时调用了哪一行代码？如果您有 VS 2008，您可以通过转到工具 --> 选项 --> 调试并选择启用 .NET Framework 源步进来执行此操作。请注意，下载所有必要的文件可能需要一段时间，但这样您就可以进入 form.Show() 并查看到底发生了什么。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-08T20:08:19.333

好吧，事实证明它比我想象的更简单、更通用，但仍然很奇怪和晦涩。

如果您像我们一样在表单加载/关闭时保存/加载表单 Size/Location/WindowState，则必须确保 OnLoad 方法首先调用 base.OnLoad 以便触发 Form Load 事件处理程序，然后设置属性。不这样做只会在表单从 Load 方法内部调用 Close 时引起问题。表单关闭事件完成后，您将在 Show 调用中获得 ObjectDisposedException。

我头疼。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-02-11T18:57:57.963

Form.Shown() 也是诀窍。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-11-18T23:44:11.287

据我了解，设置表单的 DialogResult 将关闭表单 - 可能必须不是 DialogResult.None。（即您不需要调用 Form.Close() 方法）。

问题的一部分还在于，如果在代码的其他地方，您正在访问表单的属性或其中的控件，这可能会阻止表单关闭。

如果按照建议，您有一个属性，例如

```
private bool _loadedOk = false; 
```

在您在初始化代码中设置的表单中。在 Form_Loaded 之后的后续事件之一中，您随后会询问它并在它为假时关闭表单。

也许有人可以建议最好的活动来做到这一点？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-11-13T18:47:09.933

如果你想关闭窗体而不闪烁，我发现最好的方法是覆盖 SetVisibleCore 方法：

```
public partial class MyForm : Form
{

...
    protected override void SetVisibleCore(bool value)
    {
        if (value && !IsHandleCreated && !ContinueLoadingForm())
        {
            base.SetVisibleCore(false);
            this.Close();
            return;
        }

        base.SetVisibleCore(value);
    }
} 
```

然后你可以简单地做：

```
...
var myForm = new MyForm();
myForm.Show();
... 
```

仅当 ContinueLoadingForm() 为 true 时才会出现表单，这也适用于 ShowDialog() 和 Application.Run()。

# c# - 如何在 GridView 上获取 DataSet.DataTable 的总计？

> ID：731071
> 
> 赞同：1
> 
> 时间：2009-04-08T17:52:11.157
> 
> 标签：c#, .net, asp.net

我有一个gridview，每页显示（50）行数据。由于用户先前的请求，我显示了金额的总计。现在，无论他们在哪个页面上，他们都希望获得整个结果的总数。我怎么做？

我为我的完整总数执行了以下操作：

在表格中填充 Gridview 结果后

```
Count = dsReport.DataTable1.Count; 
```

我迄今为止失败的完整总计计划：

```
for (int i = 0; i < Count; i++) 
{ Total += dsPoint.DataTable1.Columns[3].Row[i]; ??? I dont know what to do } 
```

特定小数列 [3] 的总和是多少？即使我显示 50 个结果，我也需要 ENTIRE 列的总计。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T18:29:30.787

就像是：

```
Total = dsPoint.Tables["DataTable1"].Compute("SUM(columnName)", String.Empty); 
```

你提供`columnName`:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T18:10:22.473

看起来你有它倒退。通常要获取 DataTable 中的值，您需要使用 DataTable.Row[i].Column[j]。所以假设你的列中有一个整数，你可以像这样运行你的总数：

```
for (int i = 0; i < Count; i++) 
{ 
   Total += Integer.Parse(dsPoint.DataTable1.Rows[i].Columns[3];
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:14:24.490

您可以查看数据表的[Compute 方法](http://msdn.microsoft.com/en-us/library/system.data.datatable.compute.aspx)。这比遍历数据表要容易得多。

# c# - 在 C# 中组织程序集（程序集结构）

> ID：731075
> 
> 赞同：4
> 
> 时间：2009-04-08T17:52:40.783
> 
> 标签：c#, .net

假设您正在编写像 Photoshop 这样的应用程序，其中您有效果（过滤器）等，是否应该使用单独的项目将这些过滤器中的每一个都设为单独的程序集？

主要思想是将这些过滤器中的每一个都作为节点，所以可以这样想：

```
sourceImage -> Sharpen -> Darken -> Contrast -> Blur ... 
```

在我看来，拥有如下 dll 文件是有意义的：

```
[Filters folder]   
Sharpen.dll  
Darken.dll
Contrast.dll
Blur.dll 
```

但是这样管理它们会很困难，这会阻止我使用`internal`关键字来表示班级成员，对吧？

所以现在我只有 1 个用于所有过滤器的 dll。

组织集会的最佳做法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T17:56:41.350

我不会将自己限制为每个组件一个过滤器。您可能希望将实现类似功能的组件（例如颜色/对比度）组合在一起，同时将它们与非常不同类型的过滤器（例如边缘增强）分开。

*只是一点点轶事证据：我经常看到由于程序集太多*而难以管理的应用程序。我不记得曾经见过一个有问题的，因为它没有将组件拆分得足够多。我并不是说它不会发生——只是我没有看到它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T18:21:00.090

NDepend 工具的作者 Patrick Smacchia 建议将程序集的数量保持在较低水平。看[这里](http://codebetter.com/blogs/patricksmacchia/archive/2008/12/08/advices-on-partitioning-code-through-net-assemblies.aspx)。这在一定程度上也意味着您使用 NDepend 来管理命名空间之间的依赖关系。此外，如果您的程序集较少并且部署更容易，则编译速度会更快。

我会支持 Reed Copsey DI（如[StructureMap](http://structuremap.sourceforge.net/Default.htm)）解决方案可以为您提供可扩展性和可测试性，如果这是您所追求的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-08T18:37:04.810

有单独程序集的原因：

*   您可以单独部署它们并在运行时使用反射（即插件）加载它们。但要确保这种增加的复杂性是值得的。
*   您可以将您的业务逻辑与您的 UI 分开，并且理论上（有时在实践中）有一个单独的 UI。
*   您有一个实用程序类库，您可能希望在 Windows 窗体和 ASP.NET 应用程序中使用它。
*   您可以将您的业务逻辑放在一个 DLL 中，然后拥有一个包含单元测试的 DLL 来执行该代码。
*   除了最后一点，您可以将某些程序集配置为仅在调试或发布模式下构建。因此，您可能只在调试模式下构建单元测试程序集，而不是在发布模式下发布它。或者你可能有一个额外的帮助程序（可能是为了安装），它只为 Release 构建。

避免单独组装的原因：

*   它增加了复杂性。不要仅仅根据程序的理论“建模”将代码组织成多个程序集。确保额外的复杂性实际上为您带来了更大的价值。
*   它减慢了编译/构建。
*   您不能在程序集之间进行循环引用，因此如果您发现程序集需要从更高级别的程序集中访问类和方法，则必须跳过很多圈和“管道抽象”。例如，如果您的 Windows 窗体 UI (.exe) 程序集调用业务逻辑 DLL，则 DLL 无法引用 UI 类，而无需大量处理接口并跨层传递引用。

我认为这是经验带来的东西。我自己的经验是，随着我作为 .NET 开发人员的成熟，我越来越不愿意创建更多的程序集，除非有非常令人信服的理由。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T17:57:29.087

我认为更好的方法可能是为该程序集中的类型创建一个带有`Sharpen`、`Darken`、`Contrast`和`Blur`命名空间的过滤器程序集。这实际上完全取决于您需要每个功能的模块化程度。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T17:58:15.433

拥有单独的程序集可以更容易地添加更多内容而无需重新编译。特别是，如果您使用某种类型的 DI 解决方案（如[MEF](http://mef.codeplex.com/)），您可以在运行时加载这些程序集并将它们注入您的程序。

但是，这将要求您的主程序公开适当的公共接口，以便其他程序集可以使用您的类型。内部修饰符变得更加棘手，因为您必须为要访问内部的每个程序集设置内部可见属性。

# xml - 格式良好的 XML？标记名称和属性名称中的 XML 引用

> ID：731077
> 
> 赞同：4
> 
> 时间：2009-04-08T17:53:22.810
> 
> 标签：xml

我一直在搜索以确认我对 XML 规范的阅读。我的解释是标签名称和属性名称中不允许使用预定义的实体和数字字符引用，例如 XML 1.0 规范不允许这样做：

```
<root>
<test&apos;&#x27;&#39;tag test&apos;&#x27;&#39;attribute="one"/>
</root> 
```

但是，我有一个解析器返回**`test'''tag`**标签名称和**`test'''attribute`**属性名称，而另一个解析器返回**`test&apos;&#x27;&#39;tag`**标签名称和**`test&apos;&#x27;&#39;attribute`**属性名称。

哪个解析器是正确的？还是他们都错了（即他们应该抛出一个格式正确的错误）？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T18:42:55.920

在我看来，他们都错了。根据[规范](http://www.w3.org/TR/REC-xml/#NT-NameStartChar)，开始标签中只能包含以下字符：

```
":" | [A-Z] | "_" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF] | "-" | "." | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040] 
```

XMLSpy 当然也不满意。也不是<Oxygen/>。

而且......只是为了很好的衡量......这是.NET不得不说的：

```
The '&' character, hexadecimal value 0x26, cannot be included in a name. Line 1, position 12. 
```

你用的是什么解析器？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T20:40:27.743

这很简单：**在 names 中不能使用任何实体**。两个“解析器”在这里都是错误的。XML 规范非常清楚地定义了这一点——没有隐藏的默认规则；如果某些构造不包括在内，则不允许。

实体只能在常规字符内容和属性值中使用。它们可以包含在其他一些地方（注释、处理指令、DTD 子集）但不会被扩展（即不被识别为实体）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:42:29.167

在浏览[w3.org](http://www.w3.org/TR/REC-xml/#sec-starttags)时，我发现了以下相关部分：

> [41] Attribute ::= Name Eq AttValue [VC: Attribute Value Type] [WFC: No External Entity References] [WFC: No < in Attribute Values]

[WFC：无外部实体引用] 链接到：

> 格式良好的约束：没有外部实体引用
> 属性值不得包含对外部实体的直接或间接实体引用。

将链接命名为：

> [5] 名称 ::= NameStartChar (NameChar)*
> 
> [4] NameStartChar ::= ":" | [AZ] | "_" | [az] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]
> 
> [4a] NameChar ::= NameStartChar | "-" | “。” | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]

是的，它像泥一样清澈！我对此的解释是，您可以使用十六进制实体引用，只要它们落在上面指定的范围内，但您不能使用预定义的引用。

当名称不符合此要求时，我会期望出现格式正确的错误。

# visual-studio - 如何禁用 VisualStudio2008 编辑器的“自动格式化”功能？

> ID：731084
> 
> 赞同：0
> 
> 时间：2009-04-08T17:54:28.017
> 
> 标签：visual-studio

在 VS2008 Web App 中编写页面的 HTML 部分时，编辑器会不断地用换行符格式化 HTML，这会破坏代码的可读性（在我看来）。可以禁用此功能吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:58:05.573

您是否尝试过工具/选项/文本编辑器/HTML？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T18:03:35.483

工具/选项/

[显示所有设置]

文本编辑器/HTML

超过指定长度时包装标签

如果有兴趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:05:24.700

您可能正在文本编辑器设置下的文本编辑器 -> HTML 选项中查看标记环绕选项。您可以完全禁用它，也可以将其扩展到 80 个字符的默认值之外。

但是，当您将新控件拖到页面中时，仍然会在幕后进行某种程度的代码重新格式化，除了尽可能多地留在文本编辑器中之外，我没有找到任何解决方案。

有两件好事需要注意： 1\. 在格式化 HTML 方面，VS2K8 比 VS2K5 做得更好。2\. VS2K8 中内置了新的智能感知，在添加标签的同时可以很容易地留在文本编辑器中。我想我现在大部分的 HTML 东西都在那里。您可以将显示保持在“拆分视图”中，并且不时刷新以查看控件的显示方式。

# sql - 将查询结果复制到另一个 mysql 表

> ID：731085
> 
> 赞同：4
> 
> 时间：2009-04-08T17:54:56.423
> 
> 标签：sql, mysql

我正在尝试将大型 CSV 文件导入 MySQL 数据库。我已将整个文件加载到一个平面表中。我可以使用选择语句选择需要进入单独表的数据，我的问题是如何将这些选择查询的结果复制到不同的表中。我宁愿完全用 SQL 来完成，而不必担心使用脚本语言。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T17:55:57.687

```
INSERT
INTO    new_table_1
SELECT  *
FROM    existing_table
WHERE   condition_for_table_1;

INSERT
INTO    new_table_2
SELECT  *
FROM    existing_table
WHERE   condition_for_table_2; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T17:57:22.410

```
INSERT INTO anothertable (list, of , column, names, to, give, values, for)
SELECT list, of, column, names, of, compatible, column, types
FROM bigimportedtable
WHERE possibly you want a predicate or maybe not; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-30T20:22:05.603

Quassnoi 的答案是我一直在寻找的答案。请注意，如果 new_table_1 尚不存在，则必须将“INSERT INTO”语句替换为“CREATE TABLE”语句。

# java - 使用 Netbeans 6.5 分析器来分析远程 Web 应用程序？

> ID：731088
> 
> 赞同：5
> 
> 时间：2009-04-08T17:55:04.070
> 
> 标签：java, netbeans, profiler

我无法使用 Netbeans 6.5 分析器远程分析 Java Web 应用程序的内存使用情况。

我已按照[教程](http://profiler.netbeans.org/docs/help/5.5/profile_j2ee_attachprofiler.html)中的步骤进行操作，并且能够自定义 Tomcat 实例以从分析代理开始。我还可以将 Netbeans 分析器附加到正在运行的服务器：在几秒钟内，分析器会显示服务器内存使用情况的图表。

但是，我无法运行已部署的 Web 应用程序。几秒钟后，服务器会优雅地关闭，就好像它只是到达了 main 方法的底部（几乎不是 web 服务器的预期行为）。

在这几秒钟内，服务器不负责，我无法连接到其中的 Web 应用程序，它们根本没有部署。

我不想将我的应用程序导入到新的 Netbeans 项目中，只是为了对其进行分析。可以在不访问其源代码的情况下分析远程应用程序，对吗？毕竟，在几秒钟内，服务器正在运行并被分析。

我想在 Netbeans 6.5 中分析 Web 应用程序。我忘记了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-02-07T11:04:11.013

您也可以使用 VisualVM 工具。请按照以下提到的步骤操作。

1）运行jstatd（jstat恶魔进程）（在运行应用程序的远程机器上运行）jstatd -p 1098 -J-Djava.security.policy=tools.policy（指定未使用的端口）如果未指定tools.policy文件创建它如下。

```
tools.policy 
grant codebase "file:${java.home}/../lib/tools.jar" { 
```

权限 java.security.AllPermission; };

2) 在启动 JVM 之前还要指定以下属性。

```
#JMX property
JVM_ARGS="${JVM_ARGS} -Dcom.sun.management.jmxremote=true"
JVM_ARGS="${JVM_ARGS} -Dcom.sun.management.jmxremote.port=10992"
JVM_ARGS="${JVM_ARGS} -Dcom.sun.management.jmxremote.authenticate=false"
JVM_ARGS="${JVM_ARGS} -Dcom.sun.management.jmxremote.ssl=false" 
```

3) 在本地机器上启动可视虚拟机。一个。在远程选项卡下添加远程节点。湾。等待几分钟，您将在远程选项卡下看到所有核心应用程序实例。C。单击远程节点，然后选择添加 JMX 连接，指定节点：端口（上面第 2 点中提到的端口）。等待几秒钟，您将在远程节点下看到 JMX 连接。

4) 几秒钟后，您将看到新选项卡出现在远程节点下。双击 remote_node:10992 您将在右侧看到配置文件表。您可以查看内存、cpu、线程等详细信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-03T12:28:30.747

是分析整个网络服务器还是使用分析过滤器只分析你的包？减少profiler和app server本身的交互就可以解决。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-23T05:16:20.883

Check your jvm version. The version used by netbeans should be same as that in tomcat. Use default ports. If you have changed any ports ensure they are above 1024. Try to profile the example application in tomcat (remove all other applications). If it is running sucessfully it means there is a memory constraint. Profiling requires huge memory. use -xms1024m -xmx1024m for tomcat. If every thing else fail. think of switching to jdk6 and tomcat 6. After many trials I discoverd that there are lot of limitations in jdk5 and tomcat5\. switching to tomcat6 and jdk6 solved the problem for me.

Profiling with netbeans does not work jrockit, ibm jdk etc..

--kiran.kumar

# .net - NMock2，犀牛模拟。选择哪一个？

> ID：731093
> 
> 赞同：1
> 
> 时间：2009-04-08T17:55:31.353
> 
> 标签：.net, unit-testing

我正在使用 Visual Studio 单元测试框架，并且需要使用模拟框架。而且我不确定我应该选择哪个模拟框架 NMock2、Rhino mock。你能分享你的经验吗？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T18:20:36.083

如果您使用 C#3.5，我也会强烈考虑起订量。Rhino 文档没有明确区分您可以使用的“语法”的数量，这很容易导致在编写测试时混淆，从而导致各种错误。

在过去两个月向 Rhino 介绍自己，并将其纳入我们正在开发的新产品版本的测试中后，我正在将所有内容更改为 Moq。我根本无法将 Rhino 介绍给我们的开发人员并获得成功，学习曲线太费时，收效甚微。我不在乎他们是否理解存根和模拟之间的区别，部分或严格或完整。

Moq API 的简单性和可发现性意味着我们所有的开发人员都可以立即开始模拟，而无需关心细微的差异。我想我们的经理在嘲笑方面与 Moq 的创建者有相同的理念，这会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T18:09:52.643

我对使用 AAA (Arrange-Act-Assert) 模式的 RhinoMocks 非常满意。我能够很快地跟上它，并且能够做几乎所有我需要的事情，而无需求助于手动模拟。RhinoMocks 中可用的其他一些使用模式对我来说不太清楚，所以我建议使用 AAA。

```
 // Arrange

   var mock = MockRepository.GenerateMock<IMyInterface>();

   mock.Expect( m => m.Method() ).Return( value ).Repeat.AtLeastOnce();

   //  Act

   var testClass = new TestClass( mock ); // injection of mocked object

   var expected = ...expected result from method...
   var actual = testClass.TestMethod();

   // Assert

   Assert.AreEqual( expected, actual );

   mock.VerifyAllExpectations(); 
```

# c# - 特定成员的 FieldInfo

> ID：731112
> 
> 赞同：-1
> 
> 时间：2009-04-08T17:59:33.667
> 
> 标签：c#, reflection

> **可能重复：**
> [如何获取特定属性的 PropertyInfo？](https://stackoverflow.com/questions/491429/how-to-get-the-propertyinfo-of-a-specific-property)

我有一个带有公共成员的 C# 类。例如：

```
public class Foo
{
    public int Bar;
} 
```

我想获得 Bar 的 FieldInfo，而不必这样做：

```
return this.GetType().GetField("Bar"); 
```

我只是在寻找一种更清洁、更短的方法来做到这一点。就像是：

```
return field(Bar); 
```

当然，我可以构建一个方法：

```
public FieldInfo field(string name)
{
     return this.GetType().GetField(name);
} 
```

我只是想知道 C# 是否为这种代码内置了一些东西。会在编译时检查的东西，因为如果我拼错了字段的名称，上述方法将导致运行时错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T18:10:43.907

您可以使用 Expressions 和 Linq 试一试。但我无法为您提供更多细节，抱歉。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T18:01:30.170

不，你所拥有的就是尽可能干净。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:02:40.807

我不太确定除了反射之外是否还有其他方法，基本上完全可以达到这个目的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T18:09:49.197

我也在寻找这样的东西，因为反射在混淆代码中效果不佳。恐怕没有更好的解决方案......（我最终为所有字段添加了自定义属性，并让一些代码遍历所有字段以查找这些属性，但这比您的解决方案更难看）。

我希望微软在 C#4.0 中得到这个修复（我在[这个线程](https://stackoverflow.com/questions/138367/most-wanted-feature-for-c-4-0/426002#426002)`methodof`中看到了一个/`propertyof`运算符的建议）

# language-agnostic - 阻止对给定地理位置的访问

> ID：731113
> 
> 赞同：3
> 
> 时间：2009-04-08T17:59:43.120
> 
> 标签：language-agnostic, networking, geolocation

防止用户从某个地理位置访问 Web 可用应用程序的最可靠方法是什么？

我知道 IP 与地理定位有关，我也知道最天真的方法是获取 HTTP 请求标头 IP 地址并从那里获取。

很明显，像上面描述的那样简单的方法非常容易绕过，特别是使用代理或 VPN。

所以问题是：是否有 100% 可靠的方法来确定网络用户的地理位置？如果没有，有哪些可用选项，每个选项的优缺点是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T18:55:04.940

最简洁的答案是不。没有办法 100% 锁定来自特定地理位置的人，因为您无法保证可靠地使用 IP 地址的用户的位置。即使可以，也可以通过重定向伪造。

有一些方法可以让某个地区的人们更难访问该网站，但这些方法的限制越多，您可能会锁定更多的合法用户。例如，关闭服务器可以让你 100% 保证中国没有人可以攻击它，但它也可以让你 100% 保证美国也没有人可以攻击它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T19:10:31.673

TCP/IP 中没有任何内容包括位置数据（除了您可以从路由表推断或在数据库中查找的内容），也没有任何内容表明机器是否“代表”另一个位置的某人行事。

因此，正如您所说，代理和 VPN、SSH 端口转发、TOR 等可以完全阻止您的 Web 应用程序了解使用您网站的人的物理位置。您可以查找的只是最后一跳的 IP 地址，即您实际看到的 TCP/IP 连接和 HTTP 请求。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T18:10:04.297

如果有人试图通过其他国家的中继重定向来向您隐藏他们的位置，上述技术将不起作用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-06-09T19:55:17.613

我发现这个脚本是实现这个的简单方法：

[https://www.blocked.com/](https://www.blocked.com/)

免费版本中包含国家/地区封锁，开放代理服务器、匿名网络等的封锁也是如此。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T18:04:54.653

管子上某处有一个名为[IP 2 Country](http://ip-to-country.webhosting.info/)的数据库，可以判断 IP 的来源。

它当然不是完美的，但它可以为您提供 ip 来自的国家/地区。

还有一种方法叫做 SSN，它与 IP 地址有关。但是我不知道它是如何工作的，而且似乎相当复杂。它通常用于向您发送本地化垃圾邮件的广告中。例如，如果您住在加拿大蒙特利尔，则广告将显示“寻找蒙特利尔的单身人士！”。该人背后的 ISP 确实必须支持此服务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T18:05:53.340

首先-找出分配给该区域的IP组，然后您可以检查每个对用户IP地址的请求。如果它与您要阻止的部分区域匹配，则将它们发送到 disney.com。

看看这是否对您有帮助：[IP 地址信息](http://www.hostip.info/dl/index.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T08:02:41.830

不，没有万无一失的方法可以做到这一点。

[GeoPriv](http://tools.ietf.org/wg/geopriv/)工作组的 IETF 正在进行大量相关工作，其中正在设计协议（例如[HELD](https://datatracker.ietf.org/doc/html/draft-ietf-geopriv-http-location-delivery)）以允许实体向网络询问他们自己的位置，并允许其他*授权*实体请求该信息。

然而，VPN 问题仍然会导致问题，以至于具有 VPN 功能的客户端需要在建立 VPN 之前请求其位置信息。

# debugging - “步入”时如何让GDB不打印函数参数值？

> ID：731114
> 
> 赞同：8
> 
> 时间：2009-04-08T17:59:48.923
> 
> 标签：debugging, gdb

当遇到断点并单步执行函数时，gdb 6.8 版会打印函数名称，后跟函数参数。

碰巧的是，在我正在调试的程序中，参数值之一是通过引用传递的巨大记录。*gdb*打印变量名，后跟其所有成员变量。从字面上看，*gdb*需要一两分钟来打印类中包含的所有成员变量......这在调试时真的很烦人。

我很确定有一个设置可以禁用此行为，该设置是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-08T19:04:26.227

终于找到了 要完全禁用输出：

```
set print frame-arguments none 
```

仅打印标量值并忽略数组和结构：

```
set print frame-arguments scalars 
```

要重新打开打印：

```
set print frame-arguments all 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:45:05.913

我有一种我一直这样做的方法，但是看到你的问题让我很好奇是否有更好的机制。我什么也没找到。

你总是可以在你要进入的函数中设置一个断点，但是在你执行这个步骤之前，使用'commands'命令告诉gdb你不希望它在遇到那个断点时打印任何东西。一个例子将使事情更清楚......

您会注意到，当我运行程序时，我在第 10 行的断点处停止（对 foo 的调用）并打印我当前的上下文。在发出“commands 2”命令并告诉 gdb 对该断点保持沉默后，当我点击它时，什么都没有打印出来。我做了回溯（bt）只是为了表明我在我想去的地方。

希望这可以帮助：

```
> cat tmp.cpp

#include <stdio.h>

void foo(int a)
{
        printf ("%d\n", a);
}

int main()
{
        foo(0);

        return 0;
}

> g++ -g tmp.cpp
> gdb a.out
GNU gdb Fedora (6.8-27.el5)
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "i386-redhat-linux-gnu"...
(gdb) break 10
Breakpoint 1 at 0x8048491: file tmp.cpp, line 10.
(gdb) break 5
Breakpoint 2 at 0x804846a: file tmp.cpp, line 5.
(gdb) run
Starting program: /home/ronb/software/a.out

Breakpoint 1, main () at tmp.cpp:10
10              foo(0);
(gdb) commands 2
Type commands for when breakpoint 2 is hit, one per line.
End with a line saying just "end".
>silent
>end
(gdb) c
Continuing.
(gdb) bt
#0  foo (a=0) at tmp.cpp:5
#1  0x0804849d in main () at tmp.cpp:10
(gdb) 
```

# php - 使用带有 SSL 证书的 PHP cURL 时出错

> ID：731117
> 
> 赞同：29
> 
> 时间：2009-04-08T18:00:50.343
> 
> 标签：php, ssl, curl, certificate

我正在尝试使用 cURL 编写一个 PHP 脚本，该脚本可以通过使用 SSL 证书的页面授权用户，除了用户名和密码，我似乎无法通过 SSL 证书阶段。

在这种情况下，`curl_setopt($handle, CURLOPT_VERIFYPEER, 0)`不幸的是不是一个选择。证书是身份验证的必需部分，否则我会收到[其他类似 SO 帖子](https://stackoverflow.com/questions/521418/reading-ssl-page-with-curl-php)中提到的错误。

我用 cURL 尝试了一些命令行运行：

`> curl --url https://website`

这将返回`(60) SLL certificate problem`错误。如果我调整命令以包含该`--cacert`选项：

`> curl --url https://website --cacert /path/to/servercert.cer`

它工作得很好；返回身份验证网站。

但是，我尝试了以下 PHP 代码：

```
$handle = curl_init();
$options = array( 
                  CURLOPT_RETURNTRANSFER => false,
                  CURLOPT_HEADER         => true,
                  CURLOPT_FOLLOWLOCATION => false,
                  CURLOPT_SSL_VERIFYHOST => '0',
                  CURLOPT_SSL_VERIFYPEER => '1',
                  CURLOPT_CAINFO         => '/path/to/servercert.cer',
                  CURLOPT_USERAGENT      => 'Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)',
                  CURLOPT_VERBOSE        => true,
                  CURLOPT_URL            => 'https://website'
           );

curl_setopt_array($handle, $options);
curl_exec($handle);
if (curl_errno($handle)) {
  echo 'Error: ' . curl_error($handle);
}
curl_close($handle); 
```

我原以为代码本质上类似于 shell 命令，但我收到以下错误消息：

> 错误：错误设置证书验证位置：CAfile：/path/to/servercert.cer CApath：无

我已经阅读了我能找到的所有文献（特别是在 php.net 和 curl.haxx 上），但似乎找不到任何可以解决这个问题的东西。有什么建议么？

我试过`chmod 777 servercert.cer`没有成功。但是，在使用上述代码从命令行而不是浏览器 via 执行 PHP 脚本时`php test.php`，它可以完美运行。关于为什么它在浏览器中不起作用的任何解释？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2012-05-02T16:30:48.213

因为事情是通过命令行而不是通过使用 curl 的 php 工作的，所以我会追求 curl 是问题所在。

根据此 URL，[http://curl.haxx.se/docs/sslcerts.html](http://curl.haxx.se/docs/sslcerts.html)，这是您在上面引用的 SO 帖子中的引用（[使用 CURL (php) 阅读 SSL 页面](https://stackoverflow.com/questions/521418/reading-ssl-page-with-curl-php)）...

“在 7.18.0 之前，curl 捆绑了一个默认安装的严重过时的 ca 捆绑文件。这些天来，curl 档案根本不包含 ca 证书。您需要在其他地方获取它们。例如，请参见下文。

如果远程服务器使用自签名证书，如果您未安装 CA 证书捆绑包，如果服务器使用由 CA 签名的证书，但您使用的捆绑包中未包含该证书，或者远程主机是冒名顶替者冒充您最喜欢的站点，并且您想从该服务器传输文件，请执行以下操作之一："

然后继续列出您可以尝试的一些步骤。

由于您的 7.16.3 版本的 curl 在 7.18.0 之前，如果您还没有，我建议您更新您的 curl 和 openssl 组件，然后完成上面引用的列表。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2015-12-08T09:55:29.000

经过6年的问题，我在共享主机上遇到了同样的问题，显然没有令人满意的答案。我为自己找到了一个解决方案，希望它对大家有用。

你可以试试这个配置：

```
curl_setopt($config,CURLOPT_SSL_VERIFYHOST,0);
curl_setopt($config,CURLOPT_SSL_VERIFYPEER,1);
curl_setopt($config,CURLOPT_CAINFO,'ca-bundle.crt');
curl_setopt($config,CURLOPT_CAPATH,'ca-bundle.crt'); 
```

我在@Magsol 遇到了同样的错误：`Error: error setting certificate verify locations: CAfile: /path/to/servercert.cer CApath: none`；所以我添加了第 4 行来设置 CAPath。

这是和我一起工作。但请注意，CA 文件必须放在可访问的目录中（使用 chmod 755 或 777），如果 CA 文件与 PHP 文件位于同一目录中会更好。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2017-07-14T17:15:44.820

详细说明和总结一下：

如果您有一个使用 PHP curl 的 PHP 文件并将系统的 ca 证书放在同一目录中，则以下代码将为您提供快速入门

```
 $url = "https://myserver.mydomain.local/get_somedata.php";
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);

//These next lines are for the magic "good cert confirmation"
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);
    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 2);
    curl_setopt($ch, CURLOPT_VERBOSE, true);

//for local domains:
//you need to get the pem cert file for the root ca or intermediate CA that you signed all the domain certificates with so that PHP curl can use it...sorry batteries not included
//place the pem or crt ca certificate file in the same directory as the php file for this code to work
    curl_setopt($ch, CURLOPT_CAINFO, __DIR__.'/cafile.pem');
    curl_setopt($ch, CURLOPT_CAPATH, __DIR__.'/cafile.pem');

//DEBUG: remove slashes on the next line to prove "SSL verify" is the cause       
//curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);

    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

//Error handling and return result
    $data = curl_exec($ch);
    if ($data === false) {
        $result = curl_error($ch);
    } else {
        $result = $data;
    }

// Close handle
    curl_close($ch);
    return $result; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-10-01T13:14:25.163

现在这个问题已经很老了，但可能对目前正在寻找答案的一些用户有用。

我对带有 SSL 的 API 有类似的问题，CURL 有问题（不是浏览器）我的问题是我只放了证书而不是 certifcates 链/捆绑包。然后我把它和事情开始工作。所以这对于避免问题很重要。

希望这对某人有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-10-14T12:58:59.107

如果它适合你，你可以试试这个：

```
curl_setopt($ch, CURLOPT_URL, "https://test.example.com/v1/authenticate.json?api_key=123456");
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,0);
curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
curl_setopt($ch, CURLOPT_FAILONERROR, true);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch,CURLOPT_CAINFO,'cert.embedapp.20191004.pem');
curl_setopt($ch,CURLOPT_CAPATH,'./cert.embedapp.20191004.pem'); 
```

注释这些行并添加：

```
//curl_setopt($ch,CURLOPT_CAINFO,'cert.embedapp.20191004.pem');
//curl_setopt($ch,CURLOPT_CAPATH,'./cert.embedapp.20191004.pem');
curl_setopt($ch, CURLOPT_SSLCERT,'cert.embedapp.20191004.pem'); 
```

# linux - 如何将所有区域移动到新的绑定 DNS 服务器

> ID：731118
> 
> 赞同：0
> 
> 时间：2009-04-08T18:01:11.887
> 
> 标签：linux, unix, dns, bind, redhat

现有服务器 = BIND 版本 9.1.3

新服务器 = BIND 版本 9.3.4

如何将所有区域记录移动到新服务器？我尝试通过处理文件和更改配置文件来移动它们以匹配和区域没有解决，没有解决。

有没有一种平滑的方法可以将所有区域转移到这个新服务器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T07:54:40.913

复制文件并更新配置是正确的方法。

使用 AXFR（区域转移）并不好：

1.  您仍然必须在列出所有区域的新服务器上创建一个配置文件，没有办法说“转移每个区域”。

2.  您得到的文件将与原始记录中的记录顺序不同，缺少任何注释等。如果您通常手工制作区域文件，这将非常烦人。

请扩展“它不起作用”，以便我们确定原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T18:24:06.620

通过使您的新服务器成为旧服务器的从属服务器来设置区域传输怎么样？这样，新服务器将从旧服务器中获取数据，之后您可能会破坏主从关系。

# java - 将字节数组转换为 .wav java

> ID：731120
> 
> 赞同：1
> 
> 时间：2009-04-08T18:01:52.367
> 
> 标签：java, audio, wav

我有一个返回字节数组的 Web 服务，我的目的是将所述数组转换为客户端中的 .wav（手持设备，如 Blackberry）。但是我真的不知道该怎么做，我尝试只制作一个 FileOutputStream 但当然不会播放。所以我又一次不知道该怎么办了。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T18:05:11.080

所以，有很多 .WAV 格式，这里有一些文档：

*   [http://en.wikipedia.org/wiki/WAV](http://en.wikipedia.org/wiki/WAV)
*   [http://ccrma.stanford.edu/courses/422/projects/WaveFormat/](http://ccrma.stanford.edu/courses/422/projects/WaveFormat/)（注意字节序变化）
*   [http://www.lightlink.com/tjweber/StripWav/WAVE.html](http://www.lightlink.com/tjweber/StripWav/WAVE.html)

它不仅仅是一个数据字节流，而且很接近......只是一点标题，你应该很好。

我想你也可以使用类似[http://java.sun.com/j2se/1.5.0/docs/api/javax/sound/sampled/spi/AudioFileWriter.html](http://java.sun.com/j2se/1.5.0/docs/api/javax/sound/sampled/spi/AudioFileWriter.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-27T17:13:55.310

```
*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

package bemukan.voiceRecognition.speechToText;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.IOException;
import javax.sound.sampled.AudioFileFormat;
import javax.sound.sampled.AudioFormat;
import javax.sound.sampled.AudioInputStream;
import javax.sound.sampled.AudioSystem;
import javax.sound.sampled.Clip;
import javax.sound.sampled.LineUnavailableException;
import javax.sound.sampled.UnsupportedAudioFileException;

/**
 *
 * @author MuhammedYC
 */
public class SplitAudio {
    private int BUFFER_LENGTH=1024;
    private double startTime;
    private double endTime;
    private File sourceFile;
    public SplitAudio(File sourceFile,int startTime,int endTime){
        this.startTime=startTime;
        this.endTime=endTime;
        this.sourceFile = sourceFile;
        AudioInputStream inputAIS = null;
        try {
            inputAIS = AudioSystem.getAudioInputStream(sourceFile);
            Clip clip = AudioSystem.getClip();
            clip.open(inputAIS);
            long totalMicroSecond = clip.getMicrosecondLength();
        } catch (UnsupportedAudioFileException e) {

        } catch (IOException e) {

        } catch (LineUnavailableException e) {

        }
    }
    public void splitAudio(){

        File outputFile = new File("a.wav");
        AudioFileFormat fileFormat = null;
        try {
            fileFormat = AudioSystem.getAudioFileFormat(sourceFile);
            AudioFileFormat.Type targetFileType = fileFormat.getType();
                AudioFormat audioFormat = fileFormat.getFormat();

                AudioInputStream inputAIS = AudioSystem.getAudioInputStream(sourceFile);

                ByteArrayOutputStream baos = new ByteArrayOutputStream();
                int nBufferSize = BUFFER_LENGTH * audioFormat.getFrameSize();
                byte[] abBuffer = new byte[nBufferSize];
                while (true) {

                    int nBytesRead = inputAIS.read(abBuffer);

                    if (nBytesRead == -1) {
                        break;
                    }
                    baos.write(abBuffer, 0, nBytesRead);
                }
                /* Here's the byte array everybody wants.
                 */
                byte[] abAudioData = baos.toByteArray();

               // double baslangic = abBuffer.length * oranBaslangic;
               // double bitis = abBuffer.length * oranSon;

                byte[] splittedAudio = new byte[(int) (endTime - startTime)];
                for (int i = 0; i < (int) (endTime- startTime); i++) {
                    splittedAudio[i] = abAudioData[i + (int) startTime];
                }
                ByteArrayInputStream bais = new ByteArrayInputStream(splittedAudio);
                AudioInputStream outputAIS = new AudioInputStream(bais, audioFormat,
                        splittedAudio.length / audioFormat.getFrameSize());

                AudioSystem.write(outputAIS, targetFileType, outputFile);

        } catch (UnsupportedAudioFileException e) {

        } catch (IOException e) {

        }

    }
} 
```

# xml - XPathDocument 线程问题

> ID：731124
> 
> 赞同：1
> 
> 时间：2009-04-08T18:02:44.300
> 
> 标签：xml, multithreading, xpathdocument

我有一个 Web 应用程序，我试图在其中缓存一个**XPathDocument**。

**XPathDocument**创建如下。

> XPathDocument xdoc = new XPathDocument(new StringReader(ruleXml));

然后我只想缓存这个 xdoc 并为每个请求检索它。

然后我打算打电话

> XPathNavigator 导航 = xdoc.CreateNavigator();

在每个线程上。

我的问题是这是否是线程安全的。您能否在具有相同底层**XPathDocument的不同线程上拥有多个****XPathNavigator**类？

 **如果不是，我将只缓存 ruleXml 字符串并 在每个线程上创建一个新的**XPathDocument 。**

只是想知道在这样的场景中人们的建议是什么，我想缓存一个 xml 只读文档，然后在每个线程上执行不同的 xpath 查询。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T18:14:08.563

只要文档是只读的，那应该是安全的。将 XPathNavigator 与 XmlDocument 或 XPathDocument 分开的全部目的是能够针对同一个文档同时进行多个导航。

# vb6 - 将程序编译成 EXE、VB 6 的问题

> ID：731129
> 
> 赞同：2
> 
> 时间：2009-04-08T18:04:18.710
> 
> 标签：vb6, compilation, exe

我最近根据我的要求编辑了一个同学的数据收集软件。当我在 Visual Basic 6 中运行时，该程序运行良好，但理想情况下，我想将该程序编译为 .exe 文件，以便可以在任何 PC 上运行它。但是，当我选择将其转换为 exe 的选项时，在编译时出现以下错误：

编译错误：未定义子或函数。

我很好奇为什么我的程序会在 Visual Basic 中运行，但不能编译成 exe。任何修复/建议将不胜感激！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T18:11:58.333

您必须使用 Start (F5) 在 IDE 中运行应用程序 - 这不会进行完整编译，因此不会捕获所有编译错误。我建议你总是使用 Start With Full Compile (Ctrl+F5) - 然后它会告诉你错误在哪里。

您可以创建一个自定义控制栏按钮来执行 Start With Full Compile - 无需一直键入 CTRL+F5。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T18:12:24.697

在每个文件的开头，写上“ [option explicit](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5798636.html) ”。这将 vb 行为从弱类型更改为强类型。

这意味着当您将字符串放入整数时，vb 会立即告诉您，或者至少在您按下“运行”时会告诉您。在弱类型模式下，程序将一直运行，直到遇到错误，例如“未定义子或函数”然后崩溃。

当您编译成“exe”时，vb 需要进行额外的健全性检查，就像“选项显式”所做的那样。这就是为什么您在正常执行时看不到问题的原因。它仍然在那里，潜伏着，但你可能没有执行有问题的行。

在你拥有的每个 vb 源文件中使用这个关键字是非常重要的，否则你会一直看到这样的问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-08T18:16:04.283

它允许您运行程序，即使由于IDE 支持的[按需编译功能而无法编译。](http://msdn.microsoft.com/en-us/library/aa231238(VS.60).aspx)如其他帖子中所述，您可以 CTRL-F5 进行完整编译，或者您可以进入 Options --> General 并关闭按需编译...（节省大量 CTRL-F5）

# java - 在 Java 中返回嵌套类类型

> ID：731131
> 
> 赞同：5
> 
> 时间：2009-04-08T18:04:26.917
> 
> 标签：java, class, oop, nested-class

我有一个具有抽象 getType() 方法的基类。我希望子类能够实现此方法并提供要使用的实际类。

在代码中，类似于以下内容：

```
public abstract class A {
    public static interface Tile;

    protected abstract Class<Tile> getTileClass();
}

public class B extends A {
    public static class MyTile implements A.Tile { }

    @Override
    protected abstract Class<A.Tile> getTileClass() {
        MyTile t = new MyTile();  // WORKS 
        return MyTile;            // ERROR HERE
    }
} 
```

这里的问题是我在标记的行中得到“MyTile 无法解决”。所以我试图返回这个：

> 返回新的 MyTile().getClass()

但现在 Eclipse 告诉我：

> 类型不匹配：无法从 Class `<`capture#1-of 转换？将 B.MyTile 扩展为A.Tile`>` 类`<``>`

我什至不确定 Eclipse 中是否存在错误（捕获#1？）。

接下来，我将放弃接口并尝试使用抽象基 Tile 类。在 Eclipse 的帮助下，我最终得到了以下似乎可以编译的代码：

```
public abstract class A {
    public static abstract class Tile;

    protected abstract Class<? extends Tile> getTileClass();
}

public class B extends A {
    public static class MyTile exends A.Tile { }

    @Override
    protected abstract Class<? extends A.Tile> getTileClass() {
        return new MyTile().getClass();  // WORKS
        return MyTile;                   // "Cannot be resolved"
    }
} 
```

所以我基本上似乎有三个问题：

1）是否有可能让它与 A.Tile 作为接口一起使用？

2）使用基类时，`Class<? extends X>`真的是正确的方法吗？

3) 如何从方法内部返回嵌套的 B.MyTile 类引用？不得不做的事情`new MyTile().getClass()`是不对的，不是吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T18:10:18.963

泛型和协变类型覆盖不能很好地协同工作。您必须将 getTileClass() 显式声明为返回一个可以是A.Tile*子类*的类。

您还可以使用 MyTile.class 访问 MyTile 的类对象，而无需实例化它。

试试这个：

```
public abstract class A {
    public static interface Tile;

    protected abstract Class<? extends Tile> getTileClass();
}

public class B extends A {
    public static class MyTile implements A.Tile { }

    @Override
    protected Class<MyTile> getTileClass() {
        return MyTile.class;
    }
} 
```

更好的是使 A 通用。您仍然必须在类类型定义中使用*扩展*，但您可以更具体一点：

```
public abstract class A<T extends A.Tile> {
    public static interface Tile;

    protected abstract Class<? extends T> getTileClass();
}

public class B extends A {
    public static class MyTile implements A.Tile { }

    @Override
    protected Class<MyTile> getTileClass() {
        return MyTile.class;
    }
} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-08T18:13:59.750

```
public abstract class A {
    public static interface Tile {};

    // I return something that is-a Tile
    protected abstract Tile getTileClass();
}

public class B extends A {
    public static class MyTile implements A.Tile { }

    @Override
    protected abstract Tile getTileClass() {
        return new MyTile();
    }
} 
```

不需要泛型，你只想说你返回一个 Tile 或 Tile 子类。

顺便说一句，类中的公共静态接口是“代码气味”；要么使其受到保护，因此只有 A 的子类才能实现 Tile，要么将其放在自己的顶级接口中。加入一个但允许任何人实施它会发出一个混合的信息。

# c++ - 在 C++ 中使用 pthread 时，何时需要实现锁定？

> ID：731141
> 
> 赞同：0
> 
> 时间：2009-04-08T18:06:26.537
> 
> 标签：c++, locking, pthreads

在发布[我](https://stackoverflow.com/questions/724536/does-memory-stay-allocated-when-a-c-thread-exits/730868#730868)自己关于内存问题的解决方案后，[nusi 建议我的解决方案缺少锁定](https://stackoverflow.com/questions/724536/does-memory-stay-allocated-when-a-c-thread-exits/731025#731025)。

以下伪代码以非常简单的方式模糊地代表了我的解决方案。

```
std::map<int, MyType1> myMap;

void firstFunctionRunFromThread1()
{
    MyType1 mt1;
    mt1.Test = "Test 1";
    myMap[0] = mt1;
}

void onlyFunctionRunFromThread2()
{
    MyType1 &mt1 = myMap[0];
    std::cout << mt1.Test << endl; // Prints "Test 1"
    mt1.Test = "Test 2";
}

void secondFunctionFromThread1()
{
    MyType1 mt1 = myMap[0];
    std::cout << mt1.Test << endl; // Prints "Test 2"
} 
```

我完全不确定如何实现锁定，我什至不确定我为什么要这样做（注意实际的解决方案要复杂得多）。有人可以解释一下在这种情况下我应该如何以及为什么要实施锁定？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T18:12:04.607

一个函数（即线程）修改映射，两个读取它。因此，读取可能会被写入中断，反之亦然，在这两种情况下，映射都可能被破坏。你需要锁。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T18:32:57.970

实际上，问题甚至不仅仅是锁定...

如果您真的希望线程 2 始终打印“测试 1”，那么您需要一个条件变量。

原因是存在竞争条件。不管你是否在线程 2 之前创建线程 1，线程 2 的代码都可能在线程 1 之前执行，因此映射不会正确初始化。为了确保在映射初始化之前没有人从映射中读取，您需要使用线程 1 修改的条件变量。

正如其他人所提到的，您还应该对映射使用锁，因为您希望线程访问映射，就好像它们是唯一使用它的线程一样，并且映射需要处于一致状态。

这是一个概念性示例，可帮助您思考：

假设您有一个有 2 个线程正在访问的链表。在线程 1 中，您要求从列表中删除第一个元素（在列表的头部），在线程 2 中，您尝试读取列表的第二个元素。

假设delete方法是这样实现的：做一个临时ptr指向列表中的第二个元素，让head指向null，然后让head成为临时ptr...

如果发生以下事件序列怎么办： -T1 删除第二个元素的下一个指针 - T2 尝试读取第二个元素，但没有第二个元素，因为修改了头的下一个 ptr -T1 完成删除头并设置第二个元素作为头部

T2 读取失败，因为 T1 没有使用锁来使链表中的删除成为原子操作！

这是一个人为的例子，不一定是你将如何实现删除操作；但是，它说明了为什么需要锁定：对数据执行的操作是原子的。您不希望其他线程使用处于不一致状态的东西。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:11:59.737

整个想法是防止程序由于多个线程访问相同的资源和/或更新/修改资源而进入不确定/不安全状态，以便后续状态变为未定义。阅读[互斥](https://computing.llnl.gov/tutorials/pthreads/#Mutexes)锁和[锁定](https://computing.llnl.gov/tutorials/pthreads/#MutexLocking)（带有示例）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T18:27:03.540

通常，线程可能在不同的 CPU/内核上运行，具有不同的内存缓存。它们可能在同一个核心上运行，其中一个中断（“抢占”另一个）。这有两个后果：

1）你无法知道一个线程是否会在做某事的过程中被另一个线程中断。因此，在您的示例中，无法确保 thread1 在 thread2 写入字符串值之前不会尝试读取它，或者甚至当 thread1 读取它时，它处于“一致状态”。如果它不是处于一致的状态，那么使用它可能会做任何事情。

2）当您在一个线程中写入内存时，不知道在另一个线程中运行的代码是否或何时会看到这种变化。更改可能位于写入器线程的缓存中，并且不会刷新到主内存。它可能会被刷新到主内存，但不会进入读取器线程的缓存。部分更改可能会通过，而部分更改则不会。

一般来说，如果没有锁（或其他同步机制，如信号量），您无法确定线程 A 中发生的事情是否会发生在线程 B 中发生的事情“之前”或“之后”。您也无法说线程 A 中所做的更改是否或何时在线程 B 中“可见”。

正确使用锁定可确保所有更改都通过缓存刷新，以便代码以您认为应该看到的状态看到内存。它还允许您控制特定代码位是否可以同时运行和/或相互中断。

在这种情况下，查看上面的代码，您需要的最小锁定是有一个同步原语，它在写入字符串后由第二个线程（编写器）释放/发布，并由第一个线程获取/等待（读者）在使用该字符串之前。这将保证第一个线程看到第二个线程所做的任何更改。

这是假设在调用 firstFunctionRunFromThread1 之后才启动第二个线程。如果情况并非如此，那么您需要对 thread1 写入和 thread2 读取进行相同的处理。

实际执行此操作的最简单方法是拥有一个“保护”您的数据的互斥锁。您决定要保护哪些数据，并且任何读取或写入数据的代码在执行此操作时都必须持有互斥锁。所以首先你锁定，然后读取和/或写入数据，然后解锁。这确保了一致的状态，但它本身并不能确保线程 2 将有机会在线程 1 的两个不同函数之间做任何事情。

任何一种消息传递机制都会包含必要的内存屏障，所以如果你从写线程向读线程发送一条消息，意思是“我已经写完了，你现在可以阅读了”，那将是真的。

如果证明太慢，可以有更有效的方法来做某些事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T18:38:53.153

作为编译代码的结果创建的指令集可以按任何顺序交错。这会产生不可预测和不希望的结果。例如，如果 thread1 在选择运行 thread2 之前运行，您的输出可能如下所示：

> 测试 1
> 
> 测试 1

更糟糕的是，一个线程可能在分配过程中被抢占——如果分配不是**原子**操作的话。在这种情况下，让我们将**atomic**视为不能进一步拆分的最小工作单元。

为了创建一个逻辑原子指令集——即使它们在现实中产生多个机器代码指令——是使用**锁**或**互斥锁**。Mutex 代表“互斥”，因为这正是它的作用。**它确保对某些对象或代码的关键部分**的独占访问。

处理多道程序的主要挑战之一是识别**关键部分。**在这种情况下，您有两个关键部分：分配给 myMap 的位置和更改 myMap[0] 的位置。由于您不想在写入 myMap 之前**阅读它，因此这****也是**一个关键部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T09:48:54.323

The simplest answer is: you have to lock whenever there is an access to some shared resources, which are not atomics. In your case `myMap` is shared resource, so you have to lock all reading and writing operations on it.

# credentials - SyBase 文件的密码恢复

> ID：731142
> 
> 赞同：2
> 
> 时间：2009-04-08T18:07:01.823
> 
> 标签：credentials, sqlanywhere, password-recovery, sybase-asa

我有一个`.db`文件，我认为它是一个 Sybase 数据库文件，我的任务是从中提取数据。查看记事本中的文件显示数据未加密（我可以从中读取文本字符串），但我没有用户名/密码来说服 Sybase 工具读取它。

是否有任何工具/程序可以跳过凭据检查？

（顺便说一句，客户拥有数据，所以这一切都是合法的）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T18:10:53.407

如果绕过 Sybase 安全性这么容易，我会感到惊讶……但永远不知道。您是否尝试过默认用户名 (dba) 和密码 (sql)？你会惊讶于有多少人太懒惰而无法改变它！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-15T03:34:50.797

假设这是一个 Sybase SQL Anywhere 或 Sybase IQ 数据库，Sybase 提供的任何工具都可以在不提供有效用户名/密码的情况下访问数据。如果有任何第三方工具可以做到这一点（我不知道），我们当然不会批准它们。

*全面披露*：我在 SQL Anywhere 工程部门为 Sybase 工作。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-08-15T04:15:36.767

ASE（Adaptive Server Entreprise）下，默认用户ID：“sa”，pass：“”

# java - 如何创建自定义 JVM？

> ID：731143
> 
> 赞同：21
> 
> 时间：2009-04-08T18:07:28.283
> 
> 标签：java, jvm

我正在阅读[http://www.cafeaulait.org/javafaq.html](http://www.cafeaulait.org/javafaq.html)上的第 6.10 项，我开始想知道大玩家是如何创建自己的 JVM 实现的。对于一个人来说，实验性的某件事或另一件事是可能的（并且可行的）吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-08T19:44:40.653

从技术上讲，人们创建新 JVM 所需的所有信息都在语言和目标平台的公共规范中。JVM 需要根据它是在台式计算机还是手机上运行而表现出不同的行为，即使字节码解释基本相同。

从几个地方开始寻找信息：

[http://en.wikipedia.org/wiki/List_of_Java_virtual_machines](http://en.wikipedia.org/wiki/List_of_Java_virtual_machines)
阅读 Tim Lindholm 的“Java 虚拟机规范”
[http://www.jcp.org/en/jsr/detail?id=30](http://www.jcp.org/en/jsr/detail?id=30)

根据我对 Sun、IBM 或 Esmertec 等较小公司的 JVM 实现的了解，编写一个简单的 JVM 是一个几个月的项目，但在 JSR 之后添加 JSR 以支持更多功能可能需要数年时间。

现在，如果您只需要一个简单的字节码解释器，那还不错，但仍然需要编写相当多的代码。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-10T15:11:43.607

手工制作的 JVM 将是了解一般虚拟机、程序语言设计问题（通过 JVM 规范）以及解析的细节等方面的好方法。

如果您选择朝那个方向发展，您还可以探索优化，这是它变得有趣的地方，您可以获取研究论文并实施他们的算法。

话虽如此，如果您对从头开始创建 VM 的漫长而艰巨的任务不太感兴趣，您可能想要修改现有的开源 VM，例如[Kaffe](http://www.kaffe.org/)。它将向您展示虚拟机的功能，但不一定展示 Java 代码在 Sun 的 JVM 中的工作方式：

> Kaffe 是 Java 虚拟机的无尘室实现，以及提供 Java 运行时环境所需的相关类库。

这样，您可以研究细节，但可以深入实施更有趣的功能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T19:45:57.267

我知道，目前，大公司从 Sun 获得 Java 库的许可。然后他们添加自己的改进。实现之间的主要区别在于字节码->机器码编译器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T18:18:03.810

一方面，您可能想看看[Apache Harmony](http://harmony.apache.org/)他们已经走了很长一段路，所以他们的项目历史实际上可能会让您对所需的工作有一个很好的了解。我自己不会打赌这对一个人来说是可行的

# c# - FormsAuthentication RedirectToLoginPage 怪癖

> ID：731146
> 
> 赞同：10
> 
> 时间：2009-04-08T18:08:39.090
> 
> 标签：c#, forms-authentication

在 SignOut() 调用后使用此方法会重定向到 '...login.aspx?ReturnUrl=%2fmydomainname%2flogout.aspx' 以便用户无法再次登录，因为成功登录会返回注销页面。登录页面在 webconfig 中设置，应用程序成功获取该页面。为什么 ReturnURL 会卡在 URL 的尾部？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-08T18:11:44.013

这是如何`RedirectFromLoginPage`工作的。它将当前 URL 附加到登录页面的查询字符串中。这样，登录页面可以将用户重定向回他所在的位置。

如果您不希望发生这种情况，您可以使用手动重定向到登录页面`Response.Redirect`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-09-04T08:34:22.413

在注销时使用此代码

```
<asp:LoginStatus ID="LoginStatus1" runat="server" LogoutPageUrl="/xyz.aspx" LogoutAction="Redirect" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T09:25:02.077

不确定这是否有帮助，但根据文档，还有一个重载的 FormsAuthentication.RedirectToLoginPage 方法，它接受一个字符串并“使用指定的查询字符串将浏览器重定向到登录 URL”。

请参阅[http://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.redirecttologinpage.aspx](http://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.redirecttologinpage.aspx)

# sql - 我需要哪些更改才能让我的表在 AppEngine 的 BigTable 上运行？

> ID：731147
> 
> 赞同：4
> 
> 时间：2009-04-08T18:08:43.707
> 
> 标签：sql, database, google-app-engine, bigtable, table-structure

假设我有一个由**用户**组成的预订数据库：

```
user_id
fname
lname 
```

和他们的**票**

```
ticket_id
user_id
flight_no 
```

和相关**航班**

```
flight_no
airline
departure_time
arrival_time 
```

*我需要更改哪些内容才能移动此 Google AppEngine？*

我了解 AppEngine*不允许 joins*。

这是否意味着我的桌子应该成为一大堆混在一起的字段？

**预订**：

```
user_id
fname
lname
ticket_id
flight_no
airline
departure_time
arrival_time 
```

换句话说，我的所有查询现在都针对同一个表运行？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T18:35:03.613

您需要进行哪些更改主要取决于您需要运行哪些查询，而不是您拥有哪些数据。很可能您只需要添加几件事。

列出查询，然后查看[Restrictions on Queries](http://code.google.com/appengine/docs/java/datastore/queriesandindexes.html#Restrictions_on_Queries)。在你找到有问题的那些之后，试着用 BigTable 的约束来重写它们。

例如，如果您经常需要查找航班列表的机票数量，您将无法做到：

```
选择
    航班号，COUNT(*)
从
    航班
加入
    机票 ON Tickets.flight_no = flight.flight_no
通过...分组
    航班号

```

因此，您需要`flights`在创建/删除票证时添加票证计数器并增加/减少该票证。

这样做的好处是 BigTable 迫使您拥有一个非常可扩展的数据库设计。不好的一面是，当您并不真正*需要*可扩展的设计时，它会浪费您的大量时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-17T19:51:38.247

您可以通过网络服务使用来自 Google appengine 应用程序的正版 SQL 关系数据库。

一种这样的 Web 服务是 Rdbhost，位于[http://www.rdbhost.com](http://www.rdbhost.com)。

它涉及到它的妥协，特别是速度，因为每个页面视图都需要另一个后端 http 页面请求到 db 服务器，但它允许您使用您已经拥有的 SQL 设计知识。

# sql-server - 什么是 SQL Server 模块？

> ID：731165
> 
> 赞同：5
> 
> 时间：2009-04-08T18:10:49.757
> 
> 标签：sql-server

我今天刚看到系统视图`sys.sql_modules`。什么是模块与数据库对象？该视图最显着地返回包含定义文本的列，由`sys.syscomments`.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2014-02-21T13:41:16.500

在 SQL-Server 中，模块是包含 sql 批处理的独立对象，例如视图、表值函数、存储过程、触发器或标量函数。SQL 对象是一个更全面的术语，包括一些包含 SQL 表达式的术语，例如检查或默认约束。在 SQL Server 2005 之前，模块曾被称为“例程”，但我认为这两个术语可以互换使用。

表构建脚本不存储在 SQL Server 中，因为可以轻松地单独更改表的组件。因此，它被视为一个对象，而不是一个模块。
不被视为模块的典型对象是系统表、默认约束、外键约束、服务队列、检查约束、用户表、主键约束、内部表和唯一约束。

列不被视为对象。索引也不是。

是的，这一切都比人们最初想象的要复杂。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T20:44:52.223

构成存储过程、存储函数、触发器或视图定义的是 T-SQL 语句块。

来自“创建过程”部分的“在线图书”：

> 获取有关存储过程的信息 要显示 Transact-SQL 存储过程的定义，请使用该过程所在数据库中的 sys.sql_modules 目录视图。

在 sys.sql_modules 中，您会找到实际的 T-SQL 代码。

马克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:13:02.183

模块是函数、过程、队列和触发器。这些模块称为对象。这就是我从这篇描述“EXECUTE AS”的文章中所理解的：

[执行为](http://msdn.microsoft.com/en-us/library/ms178106.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-09-12T13:20:34.223

当我想获得 EXECUTE 命令的详细解释时，我遇到了这个问题。我想深入了解如何阅读命令的 t-sql 帮助，并意识到我不知道模块是什么意思。

我只想将这些添加到 sql 模块列表中：

*   系统存储过程，
*   用户定义的存储过程，
*   CLR 存储过程，
*   标量值用户定义函数，
*   或扩展存储过程。

> **在 Transact-SQL 批处理或以下模块之一中** 执行命令字符串或字符串：*系统存储过程*、*用户定义存储过程*、*CLR 存储过程*、*标量值用户定义函数*或*扩展存储过程*。EXECUTE 语句可用于将传递命令发送到链接服务器。此外，可以显式设置执行字符串或命令的上下文。可以使用 WITH RESULT SETS 选项定义结果集的元数据。

[https://docs.microsoft.com/en-us/sql/t-sql/language-elements/execute-transact-sql?view=sql-server-2017](https://docs.microsoft.com/en-us/sql/t-sql/language-elements/execute-transact-sql?view=sql-server-2017)

# iphone - 嵌入 UIScrollView 时 UIWebView 不滚动

> ID：731173
> 
> 赞同：2
> 
> 时间：2009-04-08T18:12:58.533
> 
> 标签：iphone, uiwebview, uiscrollview

我有一个包含 3 个 UIWebview 的 UIScrollView。问题是我的 webview 不再滚动。

你有想法吗 ？

谢谢

蒂埃里

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T14:24:55.690

UIWebView 内部实现了滚动，所以它自己的滚动与包含它的 UIScrollView 的滚动冲突。

一个可能的解决方案是调整 webview 的大小以完全包含它们的内容，类似于 webview 如何调整框架集中的框架的大小。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-11-16T07:37:30.187

您可能尚未将委托设置为`UIScrollView`main `UIWebViewController`。添加您的视图控制器类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-03T10:45:35.057

您可能尚未将 UIScrollView 的委托设置为主 UIWebViewController。添加：

```
[scroll setDelegate:self]; 
```

并在 .h 中添加：

```
... : UIViewController <UIScrollViewDelegate> 
```

# visual-studio-2008 - VS 2008 可以在构建项目之前杀死 w3wp 吗？

> ID：731176
> 
> 赞同：0
> 
> 时间：2009-04-08T18:13:18.503
> 
> 标签：visual-studio-2008, w3wp

有没有办法让 VS 2008 在构建项目之前总是杀死 w3wp 进程？我觉得它曾经在我的机器上执行此操作，但现在我总是必须在开始构建之前手动杀死它，否则它将无法将新的二进制文件部署到我的本地主机。

编辑：

如果我在 VS 2008 中开始构建之前没有手动终止该进程，我会收到以下错误消息：

错误 1：无法将文件“UPDATED_DLL_I_JUST_BUILT”复制到“DLL_CURRENTLY_ON_SERVER”。该进程无法访问文件“DLL_CURRENTLY_ON_SERVER”，因为它正被另一个进程使用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T18:15:56.093

哪个w3wp.exe进程？其中可能不止一个。

假设您有权执行此操作，您可以创建一个预构建脚本来执行此操作。如果多个开发人员正在构建这个项目，或者如果您正在运行自动构建，那么您需要确保在这些情况下它可以工作（并且是需要的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:18:18.443

您可以将 iisreset 作为 Web 项目的预编译步骤的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:25:21.377

正如其他人所说，添加一个预构建事件。这是一个命令：

```
taskkill /F /IM w3wp.exe 
```

（正如评论中指出的，这不适用于 Windows XP Home）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T18:16:24.720

如果需要，您可以添加预构建事件来终止进程。您将这些添加到项目的属性表中。

作为一个附带问题，您为什么要/需要在每个构建中杀死 w3wp.exe？

# database - 数据库架构问题

> ID：731181
> 
> 赞同：0
> 
> 时间：2009-04-08T18:14:23.663
> 
> 标签：database, database-design, schema

我很难决定如何在我的数据库模式中处理业务需求。我在数据库中有很多表，但是对于这个问题我只需要处理三个表：Courses、PersonnelCourses 和 Personnel。

*   课程是课程列表
*   人员是人员列表
*   PersonnelCourses 是 Personnel 参加的课程**列表**。

在课程中有一个名为 Universal 的列。如果一门课程是通用的，则意味着所有人员都必须参加该课程。

我需要生成人员**必须参加**的所有通用课程的列表，但我能够生成此列表的唯一方法是使用交叉联接/笛卡尔联接：

> 选择 P.LastName, C.Name from Courses C, Personnel P where Universal = 1

从那我想在 PersonnelCourses 上做一个左连接，这样我就可以列出所有人员和他们**必须**参加的课程以及他们已经参加的课程。我认为如果在 Personnel 和 Courses 之间有一个多对多表，这一切都会更容易。但是，如果所有的人员无论如何都要在这个中间的桌子上，那不是有点多余吗？

有没有更好的方法来处理这个？

## 非常感激，

-马特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T18:27:18.047

有一个每个人都必须参加的课程清单。为什么不直接使用这个列表并使用它，而不是为每个人员行重复相同的列表？我不明白您为什么要尝试将结果集相乘。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:37:01.550

您的 PersonnelCourses 不是在 Person 和 Courses 之间建立多对多关系吗？如果不是那么我不确定，如果是那么...

```
select *

from Personnel_Courses 
    inner join Person on... /*get the Person details*/
    inner join Courses on... /*get the Course details*/

where Course.Universal = 1 and Person.Id = @Id 
```

会告诉你他们上过哪些通用课程...

进而

```
select *

from Courses

where Courses.Universal = 1 and Course.Id not in (
        select Course.Id from Personnel_Courses 
        inner join Person on... /*get the Person details*/
        inner join Courses on... /*get the Course details*/
        where Course.Universal = 1 and Person.Id = @Id
        ) 
```

会给你他们没有上过的通用课程......

对我来说，在您的代码中执行第二个可能更容易（获取第一个查询结果，从课程表中进行选择以获取所有通用然后进行比较......）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:37:55.510

这是书籍已经写过的[数据库规范化主题，并且您想要这样做的部分原因是](http://databases.about.com/od/specificproducts/a/normalization.htm)[DRY](http://www.artima.com/intv/dry.html)或不要重复自己。

因此，要回答您有关更好方法的问题-我会回答否。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T18:36:20.257

所有人员都不会出现在personalcourses 表中，只有参加过课程的人员。

我觉得你的设计很好。你只需要调整你的查询来得到你想要的。

在子查询中提取人员所学的课程。然后在外部查询中选择人员必须参加的所有课程并与子查询进行左外部联接。

```
Select a.CourseName, b.PersonName from Courses a, 
(select P.LastName, C.Name from Courses C, Personnel P, PersonnelCourses pc 
  c.courseid = pc.courseid and
  p.personnelid = pc.personnelid and
  c.Universal = 1)  b 
where
a.courseid += b.courseid order by courseid 
```

如果这是为了报告，最好按人员过滤。这样，您将看到所有所需的课程，包括每人参加的课程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T18:44:42.093

像这样的东西怎么样（使用现有的结构）？

```
SELECT P.LastName, C.Name, 1 as Taken  
FROM Courses C   
  INNER JOIN PersonnelCourses PC ON (C.CourseID=PC.CourseID)  
  INNER JOIN Personnel P ON (P.PersonID=PC.PersonID)  
WHERE(C.Universal = 1)  

UNION  

SELECTP.LastName, C.name, 0 as Taken  
FROM Courses C, Personnel P   
WHERE (Universal = 1) and   
   NOT EXISTS(SELECT * FROM Courses C2 
             INNER JOIN PersonnelCourses PC2 ON (C.CourseID=PC.CourseID)
             INNER JOIN Personnel P2 ON (P.PersonID=PC.PersonID)
             WHERE (Universal = 1)  and 
                    (PC2.CourseID=C.CourseID) and       
                    (P2.PersonID=PC2.PersonID)
             ) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T18:54:48.450

`Universal`是 的二值（布尔）属性`Course`，对吗？在这种情况下，请考虑进一步规范化。重新设计，使其`UniversalCourse`成为表格，而不是`Course`. 该表将有一个引用课程的列。要查找所有通用课程，只需从该表中选择所有内容。现在您可以大大缩短笛卡尔连接，因为您只需乘以`Personnel`UniversalCourse 表，消除了该`where Universal = 1`子句。

# ios - iOS - 将徽章添加到 UITableViewCell

> ID：731185
> 
> 赞同：12
> 
> 时间：2009-04-08T18:15:26.750
> 
> 标签：ios, objective-c, uitableview

如何向 中添加徽章`UITableViewCell`，如下所示：

[替代文字 http://img17.imageshack.us/img17/9974/img0001ac9.png](http://img17.imageshack.us/img17/9974/img0001ac9.png)

我应该简单地添加一个带有文本和标签的子视图吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2015-06-03T07:51:12.903

这是对@POF 答案的快速增强。我们不需要那么多子视图，我们可以使用数学来支持 N 位，而不仅仅是 1-3：

```
func setDiscountBadge(count: Int) {
  let size: CGFloat = 26
  let digits = CGFloat( count("\(number)") ) // digits in the label
  let width = max(size, 0.7 * size * digits) // perfect circle is smallest allowed
  let badge = UILabel(frame: CGRectMake(0, 0, width, size))
  badge.text = "\(number)"
  badge.layer.cornerRadius = size / 2
  badge.layer.masksToBounds = true
  badge.textAlignment = .Center
  badge.textColor = UIColor.whiteColor()
  badge.backgroundColor = cfg.UIColors.brand
  YOURCELL.accessoryView = badge // !! change this line
} 
```

结果（我使用品牌颜色，但您的可以是任何颜色）：

![uilabel 徽章](https://i.stack.imgur.com/QKYz5.png)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-01-12T15:15:13.303

至于我**最简单的**方法是使用`cell.accessoryView`. 请查看我的代码我是如何做到的：

```
UIImageView * commentsViewBG = [[UIImageView alloc] initWithImage: [UIImage imageNamed: @"counter1.png"]];
commentsViewBG.frame = CGRectMake(
    commentsViewBG.frame.origin.x,
    commentsViewBG.frame.origin.y, 30, 20);

UILabel *commentsCount;
if (commentsArray.totalCount < 10)
    commentsCount = [[UILabel alloc]initWithFrame:CGRectMake(10, -10, 40, 40)];
else if (commentsArray.totalCount < 100)
    commentsCount = [[UILabel alloc]initWithFrame:CGRectMake(5, -10, 40, 40)];
else if (commentsArray.totalCount < 1000)
{
    commentsViewBG.frame = CGRectMake(
        commentsViewBG.frame.origin.x,
        commentsViewBG.frame.origin.y, 40, 20);
    commentsCount = [[UILabel alloc]initWithFrame:CGRectMake(5, -10, 40, 40)];
}
commentsCount.text = [NSString stringWithFormat:@"%ld",(long)commentsArray.totalCount];
commentsCount.textColor = [UIColor whiteColor];
commentsCount.backgroundColor = [UIColor clearColor];
[commentsViewBG addSubview:commentsCount];
cell.accessoryView = commentsViewBG; 
```

**我的结果：**

![在此处输入图像描述](https://i.stack.imgur.com/d1JLl.png)

希望能帮助到你。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-06-06T01:26:15.363

[TDBadgedCell](https://github.com/tmdvs/TDBadgedCell)是一个不错的选择。高度可定制以满足您的需求。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-23T21:36:21.333

是的，目前尚不支持将徽章添加到 UITableView 单元格的方式。在这个例子中，它很可能是一个包含图像和 UILabel 的自定义子视图。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-11T11:50:26.633

我想添加另一种方法来创建自定义徽章。[CustomBadge](https://github.com/ckteebe/CustomBadge)更强大一点。它是免费开放的。

# vim - 如何复制选择并将其放置在选择的上方或下方

> ID：731189
> 
> 赞同：16
> 
> 时间：2009-04-08T18:16:16.013
> 
> 标签：vim, duplicates, selection

如果我在 Vim 中以可视模式选择了某些内容，我如何复制该选择并将其放置在所选内容的下方或上方？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-08T18:20:15.490

按`y`拉出您在视觉上选择的内容，然后`p`粘贴到光标下方或粘贴到光标`P`上方。

既然你问到在选择块下面粘贴，我会复制下面的[迈克尔](https://stackoverflow.com/users/59592/michael)说的：在你拉动之后`y`，使用`'``>`将它移动到选择块之后，然后`p`粘贴。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-01-31T20:36:30.133

由于我经常这样做（选择一个块，拉动，转到最后一个视觉选择的末尾，粘贴）我在`CTRL`+下设置了一个视觉块快捷方式`P`（在此之前，`CTRL`+`p`似乎与`j`视觉块中的相同）。

```
vmap <C-p> y'>p 
```

现在它只是进行视觉选择并按下`CTRL`+ `p`。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T00:15:20.567

除了`V`...`y``p`组合之外，您可能还想了解一些跳跃`'``<`并`'``>`到达上一个视觉模式文本的最后一个字符。具体来说，如果你想在下面粘贴，你会去`V`... `y``'``>``p`。如果它是一条长的多线，它可能会很方便。

如果您经常这样做，这是您可能会觉得很方便的跳跃之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T18:19:51.280

用于`y`将所选内容拉出（复制）到缓冲区中。

用于`p`将选择粘贴到您想要的位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T18:19:00.517

你想复制/粘贴整行吗？如果是这样，请退出可视模式，然后使用`yy`y **ank****整**行，然后`p`粘贴。

 *** * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T18:21:58.637

你有两个选择：

*   `y``y`它复制当前行，然后`p`粘贴。
*   进行选择，`v`例如，然后使用复制`y`和粘贴`p`。

# language-agnostic - 是否有任何模式/算法来处理可本地化的助记符？

> ID：731192
> 
> 赞同：1
> 
> 时间：2009-04-08T18:17:18.493
> 
> 标签：language-agnostic, localization, user-interface, mnemonics

我在一个允许助记符的网络应用程序产品上工作（即字符'C'下方的下划线，以允许键盘组合和键C触发“关闭”按钮）。

*   表单是由不同的开发人员创建的，他们可以各自为按钮静态设置助记符。
*   表单可以嵌套，因此在设计时不一定知道一页所需的确切助记符。
*   在包含许多表格的页面上，最多可以有一个使用任何字符的助记符。
*   更重要的是，表单必须能够本地化为任何语言，这意味着关闭的“C”甚至可能不会出现在用于“关闭”的... [插入语言] 词中。

理想的解决方案是一些算法，开发人员不必手动指定助记符，而是在运行时计算它们，它们将被本地化，并且它们既方便又一致（我确实说过*理想*的解决方案;-D)。

所以我想知道，有没有什么好的策略可以在接近理想解决方案的任何地方实现目标？

* * *

编辑：澄清一下，

*   我不是在谈论键盘加速器，例如用于保存的 Ctrl+S，它隐藏在菜单上。助记符仅用于显示在屏幕上的操作，例如在按钮标签下。没有隐藏的键盘快捷键会随着本地化而改变（反正没有，我们在网络浏览器中运行，所以唯一的加速器是那些正在使用的浏览器的一部分）。
*   在设计时尝试选择助记符的问题在于，负责开发 UI 的人员不知道本地化，因为这可能会在几个月后完成。此外，使用嵌套和模块化形式的问题意味着即使没有本地化，仍然可能存在冲突。

我提出的一些想法包括拥有一个全局助记符注册表，表单可以使用该注册表根据其本地化标签申请某个助记符，然后注册表将计算哪个是可用字符的最佳使用。不知何故，它必须保持这种状态——这样在应用程序使用过程中，相同的表单不会出现不同的助记符集，它甚至可以静态完成并持久化。

当然，如果我想做类似的事情，它会适合更通用的算法——我只是不知道是哪一个！:-)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T15:34:16.417

我试图在过去的项目中做类似的事情，并放弃了它。在任何合理的时间内完成都太复杂了。

挑战之一是某些语言没有一个可显示的“字母”映射到键盘上的单个键。英文的另一个挑战是可用性标准要求助记符与其他应用程序中类似按钮/菜单中的助记符保持一致。如果您动态选择字母，这可能会很困难。

我不知道它是否可以称为“最佳实践”，但请考虑一下 Microsoft Internet Explorer 在日语中的作用。请注意菜单和工具栏上熟悉的 F、E、V、A 和 D 助记符。我想它在适当的情况下遵循相同的约定，用于表单上的按钮等。

[![带有日文菜单的 IE6 屏幕截图](https://i.stack.imgur.com/GTm2r.png)](https://i.stack.imgur.com/GTm2r.png)
[（来源：[sidenet.ddo.jp](http://sidenet.ddo.jp/winetips/files/wine-ie6-01.png)）]

[（我从谷歌图片搜索](http://images.google.com/images?q=ie6+jp)中截取了那个截图。如果它过时了，你可以很容易地找到**jp**本地化 IE 的其他图片。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:47:16.440

这实际上是一个设计问题，而不是算法问题。事实证明，大多数应用程序都没有本地化键盘加速器，包括大多数微软的，尽管在某些市场也有一些例外。并非每个键盘快捷键都是助记符；真的，只有几个最常见的。

我应该指出，这次不将加速器本地化的选举是一个相当近期的趋势。在 2000 年左右之前，在某些产品中本地化快捷方式仍然很常见（例如，在德语和瑞典产品中，“Fett”的 ctrl-F 而不是“bold”）。但钟摆已经向相反的方向摆动，这可能是 MUI 和类似特征的结果。

一些本地化工具将在这方面为您提供帮助；我将此功能视为我从未使用过的产品 Visual Localize 的要点。我不确定自动分配有多有用，因为在没有特定产品的领域知识的情况下自动决定哪个字符是最好的助记符表示是一个相当困难的问题。

通常，只有在对话框中本地化带下划线的助记符才有意义，也许在菜单中。大多数本地化服务公司都熟悉这个过程，有些公司有工具来检测任何构建时资源中的重复项，然后再交回本地化资源包。您实际上可能希望投资于查找或构建一个可以在运行时执行此重复检查的工具，并将该工具作为验收标准的一部分运行。

对于常规菜单项或键盘命令序列，它可能比有用更令人困惑，除非您有一个完整的键盘到命令映射自定义功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:23:09.773

我看到这样做的问题是在运行时，当您部署具有新表单的版本并将 Close 从 alt-c 更改为 ctrl-c 时会发生什么。或者当您在两个不同的页面上有两个操作但它们都关闭时，您要确保关闭始终是 alt-c。更糟糕的是，如果算法基于非确定性的东西，并且可以在没有部署的情况下随时间变化。

似乎您可能会花费更多时间尝试为应该在设计时决定的事情构建算法。

# c# - C#中具有双向关联的价值平等

> ID：731206
> 
> 赞同：4
> 
> 时间：2009-04-08T18:20:54.943
> 
> 标签：c#, .net, equals, iequatable

## 背景

在我正在处理的 C# 项目中，我有两个对象之间具有双向关联。由于多种原因（例如，在集合中使用它们），我需要能够检查值相等（与引用相等），因此我正在实现 IEquatable 和相关功能。

## 假设

*   我正在使用 C# 3.0、.NET 3.5 和 Visual Studio 2008（尽管对于相等比较例程问题应该无关紧要）。

## 约束

任何解决方案都必须：

*   允许双向关联保持不变，同时允许检查值相等。
*   允许类的外部使用从 IEquatable 调用 Equals(Object obj) 或 Equals(T class) 并接收正确的行为（例如在 System.Collections.Generic 中）。

## 问题

在实现 IEquatable 以检查具有双向关联的类型的值相等时，会发生无限递归，从而导致堆栈溢出。

**注意：**类似地，在 GetHashCode 计算中使用类的所有字段将导致类似的无限递归和堆栈溢出问题。

* * *

## 问题

**如何检查两个具有双向关联的对象之间的值相等而不导致堆栈溢出？**

* * *

## 代码

**注意：**此代码仅用于显示问题，而不是演示我正在使用的遇到此问题的实际类设计

```
using System;

namespace EqualityWithBiDirectionalAssociation
{

    public class Person : IEquatable<Person>
    {
        private string _firstName;
        private string _lastName;
        private Address _address;

        public Person(string firstName, string lastName, Address address)
        {
            FirstName = firstName;
            LastName = lastName;
            Address = address;
        }

        public virtual Address Address
        {
            get { return _address; }
            set { _address = value; }
        }

        public virtual string FirstName
        {
            get { return _firstName; }
            set { _firstName = value; }
        }

        public virtual string LastName
        {
            get { return _lastName; }
            set { _lastName = value; }
        }

        public override bool Equals(object obj)
        {
            // Use 'as' rather than a cast to get a null rather an exception
            // if the object isn't convertible
            Person person = obj as Person;
            return this.Equals(person);
        }

        public override int GetHashCode()
        {
            string composite = FirstName + LastName;
            return composite.GetHashCode();
        }

        #region IEquatable<Person> Members

        public virtual bool Equals(Person other)
        {
            // Per MSDN documentation, x.Equals(null) should return false
            if ((object)other == null)
            {
                return false;
            }

            return (this.Address.Equals(other.Address)
                && this.FirstName.Equals(other.FirstName)
                && this.LastName.Equals(other.LastName));
        }

        #endregion

    }

    public class Address : IEquatable<Address>
    {
        private string _streetName;
        private string _city;
        private string _state;
        private Person _resident;

        public Address(string city, string state, string streetName)
        {
            City = city;
            State = state;
            StreetName = streetName;
            _resident = null;
        }

        public virtual string City
        {
            get { return _city; }
            set { _city = value; }
        }

        public virtual Person Resident
        {
            get { return _resident; }
            set { _resident = value; }
        }

        public virtual string State
        {
            get { return _state; }
            set { _state = value; }
        }

        public virtual string StreetName
        {
            get { return _streetName; }
            set { _streetName = value; }
        }

        public override bool Equals(object obj)
        {
            // Use 'as' rather than a cast to get a null rather an exception
            // if the object isn't convertible
            Address address = obj as Address;
            return this.Equals(address);
        }

        public override int GetHashCode()
        {
            string composite = StreetName + City + State;
            return composite.GetHashCode();
        }

        #region IEquatable<Address> Members

        public virtual bool Equals(Address other)
        {
            // Per MSDN documentation, x.Equals(null) should return false
            if ((object)other == null)
            {
                return false;
            }

            return (this.City.Equals(other.City)
                && this.State.Equals(other.State)
                && this.StreetName.Equals(other.StreetName)
                && this.Resident.Equals(other.Resident));
        }

        #endregion
    }

    public class Program
    {
        static void Main(string[] args)
        {
            Address address1 = new Address("seattle", "washington", "Awesome St");
            Address address2 = new Address("seattle", "washington", "Awesome St");

            Person person1 = new Person("John", "Doe", address1);

            address1.Resident = person1;
            address2.Resident = person1;

            if (address1.Equals(address2)) // <-- Generates a stack overflow!
            {
                Console.WriteLine("The two addresses are equal");
            }

            Person person2 = new Person("John", "Doe", address2);
            address2.Resident = person2;

            if (address1.Equals(address2)) // <-- Generates a stack overflow!
            {
                Console.WriteLine("The two addresses are equal");
            }

            Console.Read();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T18:22:17.857

您将类耦合得太紧并且混合了值和引用。您应该考虑检查其中一个类的引用相等性或使它们彼此了解（通过为特定类提供`internal`专门的`Equals`方法或手动检查另一个类的值相等性）。这应该没什么大不了的，因为您的要求明确要求这种耦合，因此您不会通过这样做来引入一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:52:58.533

我认为这里最好的解决方案是将 Address 类分成两部分

1.  核心地址信息（比如地址）
2.  # 1 + 个人信息（比如 OccupiedAddress）

那么在 Person 类中比较核心地址信息而不创建 SO 将是相当简单的。

是的，这确实在您的代码中产生了一些耦合，因为 Person 现在将对 OccupiedAddress 的工作原理有了一些内在的了解。但是这些类已经有紧密的耦合，所以你确实没有让问题变得更糟。

理想的解决方案是完全解耦这些类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T19:32:32.710

如果重新设计类结构以消除双向关联是可能的并减少与实现相关的问题的数量，那么这是首选的解决方案。

如果这种重新设计是不可能的或引入了相同或更大的实现问题，那么一种可能的解决方案是使用专门的 Equals 方法，由双向关联中涉及的类的 Equals 方法调用。正如 Mehrdad 所说，这应该没什么大不了的，因为需求明确要求这种耦合，所以你不会通过这样做来引入一个。

* * *

## 代码

这是一个实现，它使专门的方法只检查它们自己的字段。这减少了维护问题，而不是让每个类对另一个类进行每个属性的比较。

```
using System;

namespace EqualityWithBiDirectionalAssociation
{

    public class Person : IEquatable<Person>
    {
        private string _firstName;
        private string _lastName;
        private Address _address;

        public Person(string firstName, string lastName, Address address)
        {
            FirstName = firstName;
            LastName = lastName;
            Address = address;
        }

        public virtual Address Address
        {
            get { return _address; }
            set { _address = value; }
        }

        public virtual string FirstName
        {
            get { return _firstName; }
            set { _firstName = value; }
        }

        public virtual string LastName
        {
            get { return _lastName; }
            set { _lastName = value; }
        }

        public override bool Equals(object obj)
        {
            // Use 'as' rather than a cast to get a null rather an exception
            // if the object isn't convertible
            Person person = obj as Person;
            return this.Equals(person);
        }

        public override int GetHashCode()
        {
            string composite = FirstName + LastName;
            return composite.GetHashCode();
        }

        internal virtual bool EqualsIgnoringAddress(Person other)
        {
            // Per MSDN documentation, x.Equals(null) should return false
            if ((object)other == null)
            {
                return false;
            }

            return ( this.FirstName.Equals(other.FirstName)
                && this.LastName.Equals(other.LastName));
        }

        #region IEquatable<Person> Members

        public virtual bool Equals(Person other)
        {
            // Per MSDN documentation, x.Equals(null) should return false
            if ((object)other == null)
            {
                return false;
            }

            return (this.Address.EqualsIgnoringPerson(other.Address)   // Don't have Address check it's person
                && this.FirstName.Equals(other.FirstName)
                && this.LastName.Equals(other.LastName));
        }

        #endregion

    }

    public class Address : IEquatable<Address>
    {
        private string _streetName;
        private string _city;
        private string _state;
        private Person _resident;

        public Address(string city, string state, string streetName)
        {
            City = city;
            State = state;
            StreetName = streetName;
            _resident = null;
        }

        public virtual string City
        {
            get { return _city; }
            set { _city = value; }
        }

        public virtual Person Resident
        {
            get { return _resident; }
            set { _resident = value; }
        }

        public virtual string State
        {
            get { return _state; }
            set { _state = value; }
        }

        public virtual string StreetName
        {
            get { return _streetName; }
            set { _streetName = value; }
        }

        public override bool Equals(object obj)
        {
            // Use 'as' rather than a cast to get a null rather an exception
            // if the object isn't convertible
            Address address = obj as Address;
            return this.Equals(address);
        }

        public override int GetHashCode()
        {
            string composite = StreetName + City + State;
            return composite.GetHashCode();
        }

        internal virtual bool EqualsIgnoringPerson(Address other)
        {
            // Per MSDN documentation, x.Equals(null) should return false
            if ((object)other == null)
            {
                return false;
            }

            return (this.City.Equals(other.City)
                && this.State.Equals(other.State)
                && this.StreetName.Equals(other.StreetName));
        }

        #region IEquatable<Address> Members

        public virtual bool Equals(Address other)
        {
            // Per MSDN documentation, x.Equals(null) should return false
            if ((object)other == null)
            {
                return false;
            }

            return (this.City.Equals(other.City)
                && this.State.Equals(other.State)
                && this.StreetName.Equals(other.StreetName)
                && this.Resident.EqualsIgnoringAddress(other.Resident));
        }

        #endregion
    }

    public class Program
    {
        static void Main(string[] args)
        {
            Address address1 = new Address("seattle", "washington", "Awesome St");
            Address address2 = new Address("seattle", "washington", "Awesome St");

            Person person1 = new Person("John", "Doe", address1);

            address1.Resident = person1;
            address2.Resident = person1;

            if (address1.Equals(address2)) // <-- No stack overflow!
            {
                Console.WriteLine("The two addresses are equal");
            }

            Person person2 = new Person("John", "Doe", address2);
            address2.Resident = person2;

            if (address1.Equals(address2)) // <-- No a stack overflow!
            {
                Console.WriteLine("The two addresses are equal");
            }

            Console.Read();
        }
    }
} 
```

* * *

## 输出

> 两个地址相等。
> 
> 两个地址相等。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-08T18:25:37.943

我会说，不要调用 'this.resident.Equals(other.Resident));'

一个地址可以住不止一个人，因此检查居民是错误的。一个地址就是一个地址，不管谁住在那里！

在不知道您的领域的情况下，很难确认这一点，但是根据孩子与他们的关系来定义两个父母之间的平等似乎有点臭！

如果不检查孩子，您的父母真的无法识别自己吗？您的孩子是否真的拥有自己的唯一 ID，或者他们真的由父母及其与兄弟姐妹的关系定义？

如果你有某种独特的层次结构，那只是因为它的关系而唯一，我建议你的相等测试应该递归到根，并根据树关系本身进行相等检查。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-08T18:26:13.010

```
public override bool Equals(object obj){
// Use 'as' rather than a cast to get a null rather an exception            
// if the object isn't convertible           .
Person person = obj as Person;            
return this.Equals(person);        // wrong
this.FirstName.Equals(person.FirstName)
this.LastName.Equals(person.LastName)
// and so on
} 
```

# c++ - 指向成员和成员函数的指针的最佳用途是什么？

> ID：731208
> 
> 赞同：2
> 
> 时间：2009-04-08T18:21:05.037
> 
> 标签：c++

指向成员的指针用得不多，但它们确实很强大，你是如何使用它们的，你做过的最酷的事情是什么？

**编辑：** 这并不是列出可能的事情，例如列出*boost::bind*和*boost::function*不好。相反，它们可能是一个很酷的用法？我知道他们本身很酷，但这不是本文的目的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T18:57:22.483

我曾经需要将标准数据作为纯结构进行操作，以便能够将所有标准的列表存储在队列中。而且我必须将结构与 GUI 和其他过滤器元素等绑定。所以我想出了使用指向成员的指针以及指向成员函数的指针的解决方案。

假设你有一个

```
struct Criteria
{
    typedef std::string Criteria::* DataRefType;
    std::string firstname;
    std::string lastname;
    std::string website;
}; 
```

比您可以包装条件字段并使用该字段的字符串表示形式绑定

```
class Field
{
public:
    Field( const std::string& name,
           Criteria::DataRefType ref ):
        name_( name ),
        ref_( ref )
    {}
    std::string getData( const Criteria& criteria )
    {
        return criteria.*ref_;
    }
    std::string name_;
private:
    Criteria::DataRefType ref_;
}; 
```

然后，您可以随时注册所有要使用的字段：GUI、序列化、按字段名称进行比较等。

```
class Fields
{
public:
    Fields()
    {
        fields_.push_back( Field( "First Name", &Criteria::firstname ) );
        fields_.push_back( Field( "Last Name", &Criteria::lastname ) );
        fields_.push_back( Field( "Website", &Criteria::website ) );
    }
    template < typename TFunction >
    void forEach( TFunction function )
    {
        std::for_each( fields_.begin(), fields_.end(),
                       function );
    }
private:
    std::vector< Field > fields_;
}; 
```

例如通过调用`fields.forEach( serialization );`或

```
GuiWindow( Criteria& criteria ):
    criteria_( criteria )
{
    fields_.forEach( std::bind1st( 
                         std::mem_fun( &GuiWindow::bindWithGui ),
                         this ) );
}
void bindWithGui( Field field )
{
    std::cout << "name " << field.name_
              << " value " << field.getData( criteria_ ) << std::endl;
}; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T18:24:14.107

指向成员函数的指针非常适合使用 for_each 创建伪 Lamba 表达式

```
vector<SomeClass*> v = getAVector();
for_each(v.begin(), v.end(), mem_fun(&SomeClass::print)); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T18:28:41.197

我和他们做过的最酷的事情，我很久以前做过。今天可能有更好的方法来做到这一点。

我为网络管理工具创建了一个自生成的命令行解析器。代表要管理的对象的类都有自己的子类表（名称，指向工厂成员的指针），实例（id，从列表中指向实例的指针）和命令（名称，指向成员函数的指针） ）。这允许解析器处理以下内容：

```
SET NETWORK ROUTE 192.168.0.0 HOPS 1 
```

或者

```
QUERY NETWORK NAMESERVER servername 
```

对路由或名称服务器一无所知。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T18:22:44.347

好吧，我经常使用标准算法使用指向成员函数的指针。就我而言，它们并没有什么特别之处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T18:24:29.457

您可以使用 boost::bind 绑定成员变量和函数并获得常用函子。
接下来与他们一起工作将喜欢通常的功能用法：

*   作为回调或信号函数传递；
*   在标准算法中使用；
*   在 std::map/set 中用作比较器；
*   用作数据访问器；

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T18:26:00.623

除了前面的，您还可以将它们用作回调函数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T19:02:51.410

我在我编写的这个巨大的应用程序的“DomainEditor”类中完成了它。我在数据库中的所有类型（域）表都可以由程序管理员编辑，并且由于客户端使用与其他类型不同的名称调用某些类型，因此我创建了一个对话框，允许您编辑它们。好吧，我不想为超过 15 种域类型创建一个编辑器，所以我编写了一个超类，我可以将每个类转换为，并且使用指针我可以对每个域表进行简单的调用。每个都支持所有相同的属性、描述（名称）、ID、非活动标志和必需标志。因此，代码以宏开头来设置我的调用：

```
#define DomainList(Class, Description, First, Next, Item, UpdateItem, DeleteItem, IsItemRequired, MaxLength) { \
   CWFLHandler *handler = new CWFLHandler; \
   handler->pWFL = new Class;\
   handler->LoadFirstType = (LoadFirst)&Class::First;\
   handler->LoadNextType  = (LoadNext)&Class::Next;\
   handler->LoadType      = (Load)&Class::Item;\
   handler->UpdateType    = (Update)&Class::UpdateItem;\
   handler->DeleteType    = (Delete)&Class::DeleteItem;\
   handler->IsRequiredType= (IsRequired)&Class::IsItemRequired; \
   handler->MAX_LENGTH    = MaxLength;\
   PopulateListBox(m_Domain, Description, (long)handler); }\ 
```

然后，大量调用宏：（这里只是一个）

```
 DomainList(CConfigWFL,   "Application Parameter Types",        LoadFirstParameterType,                   LoadNextParameterType,                 LoadParameterTypeByTypeId,                                        UpdateParameterType,                DeleteParameterType,                IsParameterTypeRequired,            LEN_APPL_PARAMETER_DESC); 
```

然后，编辑数据的调用都很常见，我根本不需要复制任何代码......

例如，要使用 DropDownList 中的选定项目（由宏填充）填充列表，代码如下所示：

```
 if((pWFLPtr->pWFL->*pWFLPtr->LoadFirstType)(true))
  {
     do
     {
        m_Grid.AddGridRow();
        m_Grid.SetCheck(COLUMN_SYSTEM,         (pWFLPtr->pWFL->*pWFLPtr->IsRequiredType)(pWFLPtr->pWFL->TypeId));
        m_Grid.SetCheck(COLUMN_STATUS,      pWFLPtr->pWFL->InactiveIndc == false);
        m_Grid.AddTextToGrid(COLUMN_NAME,   pWFLPtr->pWFL->TypeDesc);
        m_Grid.AddTextToGrid(COLUMN_DEBUG,  pWFLPtr->pWFL->TypeId);
        m_Grid.AddTextToGrid(COLUMN_ID,     pWFLPtr->pWFL->TypeId);
     }
     while((pWFLPtr->pWFL->*pWFLPtr->LoadNextType)()); 
```

当然，这一切都存储在作为对话一部分的类中。我只是创建了该类的新实例，将它们存储在 ListBox 的 ItemData 成员中。因此，当对话框关闭时，我确实必须清理所有这些内容。但是，我将该代码从这条消息中删除了。

存储所有这些东西的类被定义为：

```
 typedef bool (CMyWFL::*LoadFirst)(bool);
   typedef bool (CMyWFL::*LoadNext)();
   typedef bool (CMyWFL::*Load)(long);
   typedef bool (CMyWFL::*Update)(long, const char*, bool);
   typedef bool (CMyWFL::*Delete)(long);
   typedef bool (CMyWFL::*IsRequired)(long);

   class CWFLHandler {
   public:
      CWFLHandler()  {};
      ~CWFLHandler() { if(pWFL) delete pWFL; }

      CMyWFL    *pWFL;
      LoadFirst   LoadFirstType;
      LoadNext    LoadNextType;
      Load        LoadType;
      Update      UpdateType;
      Delete      DeleteType;
      IsRequired  IsRequiredType;
      int         MAX_LENGTH;
   };
   CWFLHandler *pWFLPtr; 
```

所有这些工作使得能够向应用程序添加新域非常好，只需很少的工作即可将它们添加到域编辑器中......可能有更好的方法，我不知道。但这就是我的方式，它对我来说效果很好，而且恕我直言，它非常有创意...... :)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T09:39:34.080

我使用它们作为 StructSerlialiser 的一部分从 SAX Parser 事件填充 C++ POD 结构，即将 XML 映射到 C++ 数据模型。

```
template<class STRUCT, typename FIELDTYPE>
struct FieldBinderImpl : public FieldBinder<STRUCT>
{
    typedef FIELDTYPE (STRUCT::*MemberPtr);

    FieldBinderImpl (const std::string& tag, MemberPtr memberPtr)
        : FieldBinder (tag)
        , memberPtr_ (memberPtr)
    {
    }

    virtual SerialiserBase* createSerialiser (STRUCT& data) const
    {
        return new Serialiser<FIELDTYPE> (&(data.*memberPtr_));
    }

private:
    MemberPtr memberPtr_;
};

template<class T>
class StructSerialiser : public SerialiserData<T>
{
public:
    typedef std::vector<FieldBinder<T>*> FieldBinderList;

private:
    static FieldBinderList fieldBinderList_;

protected:
    template<typename FIELDTYPE>
    static void bind (const std::string& tag, FIELDTYPE (T::* member))
    {
        fieldBinderList_.push_back (new FieldBinderImpl<T, FIELDTYPE> (tag, member));
        if (tag.empty ())
            fieldBinderList_.back ()->tags_ = Serialiser<FIELDTYPE>::getTags ();
    }

    // ...
}

// ... 
```

还有用于双精度、字符串、向量等的序列化器。要使用它，您只需将结构成员绑定到名称，例如：

```
class Index
{
public:
    std::string         currency;
    std::string         name;
};

template<>
class Serialiser<Index> : public StructSerialiser<Index>
{
public:
    Serialiser (Index* data) : StructSerialiser<Index> (data) {}

    static void initialise ()
    {
        bind ("currency", &Index::currency);
        bind ("name", &Index::name);
    }
}; 
```

# c# - C#中的策略模式

> ID：731216
> 
> 赞同：10
> 
> 时间：2009-04-08T18:23:06.310
> 
> 标签：c#, design-patterns, strategy-pattern

我一直在阅读 Head First Design Patterns （最近才出现），并且正在阅读有关策略模式的内容，我突然想到这可能是在所有我在工作中使用的特定对象，但我对此有疑问。

这就是我的想法：

```
public interface ITax
{
    decimal ProvincialTaxRate { get; set; } // Yes, I'm Canadian :)
    decimal CalculateTax(decimal subtotal);
}

public SaskatchewanTax
{
    public decimal ProvincialTaxRate { get; set; }

    public SaskatchewanTax()
    {
        ProvincialTaxRate = new decimal(0.05f);
    }

    public decimal CalculateTax(subtotal)
    {
        return ProvincialTaxRate * subtotal + FederalTaxRate * subtotal;
    }
}

public OntarioTax
{
    public decimal ProvincialTaxRate { get; set; }

    public OntarioTax()
    {
        ProvincialTaxRate = new decimal(0.08f);
    }

    public decimal CalculateTax(decimal subtotal)
    {
        return ProvincialTaxRate * subtotal + FederalTaxRate * subtotal;
    }
} 
```

您可能已经注意到没有声明 FederalTaxRate，这就是我想问的。那应该去哪里？

*   将它传递给每个具体 Itax 的构造函数似乎是多余的，并且会导致不正确的行为（所有税收计算器必须共享完全相同的联邦税率）。
*   同样，创建 Itax 的成员也会使它们不一致。

所有的税收计算器都应该继承自静态定义的其他类以及 Itax 吗？

```
public class TaxCalculator
{
    public static decimal FederalTaxRate = new decimal(0.05f);
} 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-08T18:41:03.427

我认为这是模式滥用的常见案例。

如果您检查您的两个“策略”，它们会做完全相同的事情。唯一改变的是ProvincialTaxRate。

我会让事情保持干燥，不要过度使用这种模式（或任何其他模式），在这里你可以获得一点灵活性，但是你也有 2 类不拉他们的重量，可能**你不会需要**那种灵活性。

当您学习一项新技术或洞察力时，这很常见，您想将它应用到任何地方（它发生在我们每个人身上），即使这样做会损害代码的可读性和可维护性。

我的意见：保持简单

问候

**编辑（回应作者对我的回答的评论）**

我没有试图取笑你或任何人。这是一个常见的错误，我犯了很多次，并且通过艰难的方式学会了它，不仅用模式，而且用花哨的框架、服务器、新的流行语技术，你能想到的。

这本书的作者自己警告读者不要过度使用模式，这个答案中的赞成票也清楚地表明了一些事情。

但是如果由于某种原因你仍然想实现这个模式，这是我的拙见：

*   为这两种策略创建一个超类，这个超类将是抽象的，并且应该包含其子策略的共享税率值（FederalTaxRate）

*   在每个子类中继承并实现抽象方法“Calculate”（这里你会看到两个方法是一样的，但让我们继续）

*   尽量让每一个具体的策略都是不可变的，就像 Joshua Bloch 所说的那样，总是倾向于不可变。为此，删除ProvincialTaxRate 的设置器并在其构造函数中或直接在其声明中指定值。

*   最后，我将在 StrategySuperclass 中创建一些静态工厂方法，以便您将客户与实现或具体策略分离（现在可以很好地成为受保护的类）

**编辑二：** 这是一个带有一些（伪）代码的馅饼，使解决方案更加清晰

[http://pastie.org/441068](http://pastie.org/441068)

希望能帮助到你

问候

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T18:34:23.867

在我看来，您有正确的解决方案 - 创建一个包含加拿大联邦传真费率的基类，您的所有派生类都可以从中继承。静态定义它是一个非常好的主意。您还可以使 FederalTaxRate 仅定义税率的访问器函数，以便您可以在运行时从文件或其他内容中定义它。

我不认为这是唯一最好的解决方案，但它会很好地工作。设计模式不应该妨碍你的常识，我认为常识会很好地解决这个问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T18:37:37.773

您可能想从这段代码开始，然后从那里继续：

```
public interface ITax
{
    decimal CalculateTax(decimal subtotal);
}

public class SaskatchewanTax : ITax
{
    private readonly decimal provincialTaxRate;
    private readonly decimal federalTaxRate;

    public SaskatchewanTax(decimal federalTaxRate)
    {
        provincialTaxRate = 0.05m;
        this.federalTaxRate = federalTaxRate;
    }

    public decimal CalculateTax(decimal subtotal)
    {
        return provincialTaxRate * subtotal + federalTaxRate * subtotal;
    }
}

public class OntarioTax : ITax
{
    private readonly decimal provincialTaxRate;
    private readonly decimal federalTaxRate;

    public OntarioTax(decimal federalTaxRate)
    {
        provincialTaxRate = 0.08m;
        this.federalTaxRate = federalTaxRate;
    }

    public decimal CalculateTax(decimal subtotal)
    {
        return provincialTaxRate * subtotal + federalTaxRate * subtotal;
    }
} 
```

在这一点上，有两个不同的策略对象代表税收计算可能没有多大意义，但是通过更现实的实现（我假设税收计算更复杂，并且因省而异），这可能是有意义的。

但是，您应该考虑应用“最简单的事情可能会起作用”的原则，并且仅在您认为需要时才使用策略模式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T18:52:10.373

你为什么不忘记接口，只使用继承来做你能做的事情：

```
public abstract class Tax
{
    protected decimal ProvincialTaxRate; // Yes, you are Canadian ;)
    public decimal CalculateTax(decimal subtotal)
    {
        return ProvincialTaxRate * subtotal + FederalTaxRate * subtotal;
    }
    decimal FederalTaxRate = new decimal(0.20f);
}

public class SaskatchewanTax : Tax
{
    public SaskatchewanTax()
    {
        base.ProvincialTaxRate = new decimal(0.05f);
    }

}

public class OntarioTax : Tax
{
    public OntarioTax()
    {
        base.ProvincialTaxRate = new decimal(0.08f);
    }

} 
```

如果您需要接口，只需在基类中实现它，然后将派生类用于自定义行为/行为。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T18:35:22.880

几点：

1.  `ProvincialTaxRate`几乎可以肯定在接口级别是不可变的（无`set`属性）。改变税率似乎不是一个好主意，尽管这意味着您不能在实施中使用自动属性。

2.  如果只有一个`FederalTaxRate`并且它只是一个简单的数值，我认为抽象基类是一种安全的方法。

3.  不太可取：根据税收的运作方式，您可能会争辩说这`CalculateTax`取决于`FederalTaxRate`，因此需要将其作为参数提供（也许有不同的`FederalTaxRates`，您不想`CalculateTax`知道它们）。

不要让设计模式的定义妨碍一个好主意。它们是模式，而不是公式。;)

* * *

PS我是美国人，所以如果加拿大税真的那么简单，我希望国税局明年能从你的书中吸取一页！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T19:56:51.577

只是深思熟虑 - 将此方法放在适当的类中并调用它有什么问题？

```
public decimal CalculateTax(decimal subtotal, decimal provincialTaxRate, decimal federalTaxRate) {
    return provincialTaxRate * subtotal + federalTaxRate * subtotal;
    } 
```

我知道您会希望对每个省使用不同的省率，但肯定不应该在接口实现中硬编码吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-12-20T13:34:43.740

已经给出了很多很好的答案。只是加我的两分钱。当使用这样的设计模式时：

*   将策略创建为从抽象类派生的单独类
*   清理东西：将策略之间的所有重复代码放在抽象派生基类中

如果您遇到这样一种情况，即您有 10 个需要州税的税收策略模式，以及 5 个使用政府税的策略模式，您可以创建两个派生抽象类（例如 StateTax 和 GovernmentTax），派生自主要抽象类（Tax ?) 并且您可以从 StateTax 和 GovernmentTax 派生具体类（如 OntarioTax、TexasTax 等）。如果以后需要更改税种类型，您可以让它从另一个税类派生，同时保持所有通用代码不变。

# bash - 双引号字符串中的 Bash TAB 补全

> ID：731219
> 
> 赞同：3
> 
> 时间：2009-04-08T18:23:22.957
> 
> 标签：bash, shell, twitter, tab-completion

### 问题

我正在为命令行（用 C 语言）编写 Twitter 客户端。我目前正在为 Twitter 屏幕名称进行 TAB 补全，如下所示：

> 推特“@s<TAB>
> @sourcebits @spolsky

但是，我无法让它在中间工作，例如：

> 推文“Foo bar @s<TAB>

因为 Bash 将字符串视为一个单词。我在 Bash 手册页中找不到任何建议简单修复的内容，所以我决定绕过它。以下是我对这个问题的半成品解决方案。我只是用空格分割传入的字符串，取最后一个单词（现在是简化）并将其发送到`compgen`（下面的变量`$last_word`）。但是，我需要附加`$prefix`到 TAB 完成生成的字符串的开头，因为它会替换整个输入字符串（请记住：它被视为一个单词）。这就是我卡住的地方。

### 问题

如何才能做到这一点？

### 代码等

```
__cltwitter_complete () {
  local cache="$HOME/.cltwitter_users.cache"
  local string=${COMP_WORDS[COMP_CWORD]}
  local last_word=${string##* }
  local prefix=${string% *}

  COMPREPLY=()

  #if [ ! -f ${cache} ] || [ "`find ${cache} -mmin +60`" != "" ]; then
  #  cltwitter-update-cache
  #fi

  if [[ "$last_word" == \"@* ]]; then  # if word is beginning of a quotation
    last_word=${last_word:2}
  elif [[ "$last_word" == @* ]]; then  # if user put '@' in front
    last_word=${last_word:1}
  fi

  COMPREPLY=( $( compgen -W "`cat $cache`" -P @ -- $last_word ) )
}

complete -F __cltwitter_complete tweet 
```

Bash 手册页中的相关部分：

> **COMP_WORDS**
> 
> > 一个数组变量（参见下面的数组），由当前命令行中的各个单词组成。这些词在 shell 元字符上被拆分，**因为 shell 解析器会将它们分开**。此变量仅在可编程完成工具调用的 shell 函数中可用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-14T08:58:10.460

你真的需要报价吗？

例如，您的命令可能是：

```
tweet Foo bar @s<TAB> 
```

那么@s 就是您要完成的单词，您可以搜索它。在脚本内部，您仍然可以使用 $* 获取整个字符串。

但是，您现在必须更加小心地调用，因为您不能使用特殊字符，例如 ! 和 ( ) 不再需要用反斜杠转义它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T19:19:15.533

查看可编程完成： http: [//www.faqs.org/docs/bashman/bashref_103.html](http://www.faqs.org/docs/bashman/bashref_103.html)

# regex - 在固定长度文件中查找/替换的正则表达式

> ID：731220
> 
> 赞同：0
> 
> 时间：2009-04-08T18:23:27.293
> 
> 标签：regex, notepad++, replace

所以我有这个固定长度行的大文件。我想在字符行位置上进行查找和替换。

例子：

```
xxxxxxx     010109 xxxxxx xxxxx
xxxxxxx     010309 xxxxxx xxxxx
xxxxxxx     021506 xxxxxx xxxxx
xxxxxxx     041187 xxxxxx xxxxx 
```

所以在这种情况下，我想找到从位置 13 到位置 18 的任何值，并将其替换为 010107。

谁能帮我解决如何为此制定正则表达式？

非常感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T18:29:04.393

**编辑：经过测试，Notepad++ 不支持定义确切字符数的 {n} 方法**

这有效，对您的数据进行了测试：

寻找：

```
^(............)...... 
```

代替：

```
\1010107 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T18:28:55.593

试试这个搜索模式：

```
^(.{12})\d{6} 
```

这作为替换表达式：

```
\1010107 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:35:08.293

s/^(?:.{12})(.{6})(?:.*)$/NNNNNN/

用所需的数字替换 NNNNNN

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T18:49:40.023

像这样的东西：

```
sed 's/^\(.\{12\}\).\{6\}\(.*\)$/\1010107\2/'

```

应该做的伎俩（转义为命令行使用）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T01:09:22.230

只是为了记录，你不需要这样的正则表达式。一个简单的拆分或某种解包功能就可以了。

# .net - jQuery 对话框和设置文本框值

> ID：731223
> 
> 赞同：0
> 
> 时间：2009-04-08T18:24:13.267
> 
> 标签：.net, asp.net, jquery

所以我在我的asp .net 页面中有一个与jQuery 一起使用的模式对话框。我正在尝试使用 jquery 设置文本框值。这是一些示例代码：

```
<div class="popup-template popup1">
    <div class="content">     
      <input type="text" id="tbX" value="asdf" />
      <input type="button" onclick="$('#tbX').val('TEST VALUE');" value="Input Test" />
      <input type="button" onclick="alert($('#tbX').val());" value="Output Test" />
   </div>
</div> 
```

*   如果我单击“输出测试”，警报会显示“asdf”
*   然后我点击“输入测试”，文本框的值没有改变
*   我再次单击“输出测试”，警报显示“测试值”
*   如果我手动更改文本框中的文本，警报仍然显示“测试值”

我已经有了将对话框移回表单标签的代码，所以这不是问题。

如果我将输入移到模态 div 之外，那么一切正常。

谢谢你的帮助

-拉斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T18:31:19.583

尝试使用带有 Firebug 的 Firefox（“查看生成的源代码”）并查看模式对话框是否正在为您重新创建 DOM 并重命名输入。这意味着您正在访问来自单击处理程序的原始、现在隐藏的输入以及键入时的新输入。如果是这样，您可以更改获取文本框元素的方式以使用以下内容：

```
$(this).parent('div').find('input[type=text]:first').val(...) 
```

# jms - ActiveMQ 或 RabbitMQ 或 ZeroMQ 或

> ID：731233
> 
> 赞同：645
> 
> 时间：2009-04-08T18:26:03.650
> 
> 标签：jms, rabbitmq, activemq, message-queue, zeromq

我们很想听听有关 ActiveMQ、RabbitMQ 和 ZeroMQ 优缺点的任何经验。也欢迎提供有关任何其他有趣消息队列的信息。

* * *

## 回答 #1

> 赞同：342
> 
> 时间：2009-11-06T13:46:28.913

**编辑：**我最初的回答非常关注 AMQP。我决定重写它以提供有关该主题的更广泛的观点。

这 3 种消息传递技术在构建分布式系统方面有不同的方法：

**RabbitMQ**是 AMQP 协议（​​与 Apache Qpid 一起）的主要实现之一。因此，它实现了代理架构，这意味着消息在发送到客户端之前在中央节点上排队。这种方法使 RabbitMQ 非常易于使用和部署，因为只需几行代码即可支持路由、负载平衡或持久消息队列等高级场景。然而，它也降低了可扩展性和“速度”，因为中央节点增加了延迟并且消息信封非常大。

**ZeroMq**是一个非常轻量级的消息传递系统，专为高吞吐量/低延迟场景而设计，例如您在金融界可以找到的场景。Zmq 支持许多高级消息传递方案，但与 RabbitMQ 相反，您必须通过组合框架的各个部分（例如：套接字和设备）自己实现其中的大部分。Zmq 非常灵活，但你必须学习[80 页左右的指南](http://zguide.zeromq.org/page:all)（我建议任何编写分布式系统的人阅读，即使你不使用 Zmq）才能做任何比发送消息更复杂的事情2 对等之间。

**ActiveMQ**处于中间地带。与 Zmq 一样，它可以使用代理和 P2P 拓扑进行部署。与 RabbitMQ 一样，实现高级场景更容易，但通常以原始性能为代价。这是消息传递的瑞士军刀:-)。

最后，所有 3 款产品：

*   拥有最常用语言（C++、Java、.Net、Python、Php、Ruby 等）的客户端 API
*   有强大的文档
*   得到积极支持

* * *

## 回答 #2

> 赞同：174
> 
> 时间：2011-03-18T09:17:56.027

为什么你错过了[Sparrow](http://code.google.com/p/sparrow/)、[Starling](http://github.com/starling/starling/tree/master)、[Kestrel](http://github.com/robey/kestrel/tree/master)、[Amazon SQS](http://aws.amazon.com/sqs/)、[Beanstalkd](http://kr.github.com/beanstalkd/)、[Kafka](http://incubator.apache.org/kafka/)、[IronMQ](http://www.iron.io)？

消息队列服务器

消息队列服务器有多种语言版本，Erlang (RabbitMQ)、C (beanstalkd)、Ruby (Starling 或 Sparrow)、Scala (Kestrel、Kafka) 或 Java (ActiveMQ)。可以在[这里找到简短的概述](http://nubyonrails.com/articles/about-this-blog-beanstalk-messaging-queue)

**麻雀**

*   由亚历克斯·麦考撰写
*   Sparrow 是一个用 Ruby 编写的轻量级队列，可以“说 memcache”</li>

**八哥**

*   由布莱恩库克在推特上撰写
*   Starling 是一个基于 MemCached 的消息队列服务器
*   用红宝石写的
*   将作业存储在内存中（消息队列）
*   文档：一些很好的教程，例如[关于八哥和工作的 railscast](http://railscasts.com/episodes/128-starling-and-workling)或[关于八哥的博客文章](http://davedupre.com/2008/03/25/ruby-background-tasks-with-starling/)

**红隼**

*   写的罗比指针
*   用 Scala 编写的 Starling 克隆（从 Ruby 到 Scala 的 Starling 端口）
*   队列存储在内存中，但记录在磁盘上

**兔MQ**

*   RabbitMQ 是 Erlang 中的消息队列服务器
*   将作业存储在内存中（消息队列）

**Apache ActiveMQ**

*   ActiveMQ 是 Java 中的开源消息代理

**豆茎**

*   由 Philotic, Inc. 编写，用于提高 Facebook 应用程序的响应时间
*   主要用 C 编写的内存工作队列服务
*   文档：http : [//nubyonrails.com/articles/about-this-blog-beanstalk-messaging-queue](http://nubyonrails.com/articles/about-this-blog-beanstalk-messaging-queue)

**亚马逊 SQS**

*   [亚马逊简单队列服务](http://aws.amazon.com/sqs/)

**卡夫卡**

*   用 Scala 写在 LinkedIn
*   LinkedIn 使用它来卸载所有页面和其他视图的处理
*   默认使用持久性，对热数据使用 OS 磁盘缓存（具有比上述任何启用持久性的更高的吞吐量）
*   支持在线处理和离线处理

**ZMQ**

*   充当并发框架的套接字库
*   比 TCP 更快，适用于集群产品和超级计算
*   通过 inproc、IPC、TCP 和多播传送消息
*   通过 fanout、pubsub、pipeline、request-reply 连接 N 对 N
*   用于可扩展多核消息传递应用程序的异步 I/O

**EagleMQ**

*   [EagleMQ](https://github.com/yakushstanislav/EagleMQ)是一个开源、高性能和轻量级的队列管理器。
*   用 C 写的
*   将所有数据存储在内存中并支持持久性。
*   它有自己的协议。支持使用队列、路由和通道。

**IronMQ**

*   [IronMQ](http://www.iron.io)
*   写在围棋
*   完全托管的队列服务
*   提供云版本和本地版本

我希望这对我们有帮助。 [资源](http://4loc.wordpress.com/)

* * *

## 回答 #3

> 赞同：83
> 
> 时间：2009-04-08T20:46:32.597

More information than you would want to know:

[http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes](http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes)

* * *

## UPDATE

Just elaborating what Paul added in comment. The [page mentioned above](http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes) is dead after 2010, so read with a pinch of salt. Lot of stuff has been been changed in 3 years.

![History of Wiki Page](https://i.stack.imgur.com/3yeAD.png)

* * *

## 回答 #4

> 赞同：71
> 
> 时间：2011-02-02T19:06:39.867

这实际上取决于您的用例。

将 0MQ 与 ActiveMQ 或 RabbitMQ 进行比较是不公平的。ActiveMQ 和 RabbitMQ 是需要安装和管理的消息系统。它们提供的功能远远超过 ZeroMQ。他们有真正的持久队列，支持事务等。

ZeroMQ 是一个轻量级的面向消息的套接字实现。它也适用于进程内异步编程。可以在 ZeroMQ 上运行“企业消息系统”，但您必须自己实现很多。

所以：

ActiveMQ、RabbitMQ、Websphere MQ 和 MSMQ 是“企业消息队列”

ZeroMQ 是一个面向消息的 IPC 库。

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2009-10-20T17:26:35.190

[这里](http://www.nighttale.net/activemq/python-messaging-activemq-and-rabbitmq.html)有 RabbitMQ 和 ActiveMQ 的比较。开箱即用，ActiveMQ 被配置为保证消息传递 - 与不太可靠的消息传递系统相比，这可能给人以缓慢的印象。如果您愿意，您可以随时更改性能配置，并获得至少与任何其他消息传递系统一样好的性能。至少你有这个选择。论坛和 ActiveMQ 常见问题解答上有很多关于可扩展性、性能和高可用性配置的信息。此外，当规范最终确定时，ActiveMQ 将支持 AMQP 1.0，以及其他有线格式，如 STOMP。

ActiveMQ 的另一个优点是它是一个 Apache 项目，因此开发人员社区存在多样性——而且它不依赖于一家公司。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2010-08-24T07:28:21.280

I have not used ActiveMQ or RabbitMQ but have used ZeroMQ. The big difference as I see it between ZeroMQ and ActiveMQ etc. is that 0MQ is brokerless and does not have built in reliabilty for message delivery. If you are looking for an easy to use messaging API supporting many messaging patterns,transports, platforms and language bindings then 0MQ is definitely worth a look. If you are looking for a full blown messaging platform then 0MQ may not fit the bill.

See [www.zeromq.org/docs:cookbook](http://www.zeromq.org/docs:cookbook) for plenty examples of how 0MQ can be used.

I an successfully using 0MQ for message passing in an electricity usage monitoring application (see [http://rwscott.co.uk/2010/06/14/currentcost-envi-cc128-part-1/](http://rwscott.co.uk/2010/06/14/currentcost-envi-cc128-part-1/))

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2010-07-28T16:18:54.343

我正在使用 zeroMQ。我想要一个简单的消息传递系统，我不需要代理的复杂性。我也不想要一个庞大的面向 Java 的企业系统。

如果您想要一个快速、简单的系统并且需要支持多种语言（我使用 C 和 .net），那么我建议您查看 0MQ。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-10-29T09:47:10.790

关于 ActiveMQ，我只能加 2 美分，但因为这是最受欢迎的之一：

你想写的语言可能很重要。尽管 ActiveMQ 对大多数人来说确实有一个客户端，但与 Java 库相比，它们的 C# 实现还远未完成。

这意味着一些基本功能是不稳定的（故障转移协议......好吧......在某些情况下失败，没有重新交付支持）而其他根本不存在。由于 .NET 对项目来说似乎并不那么重要，因此开发速度相当缓慢，而且似乎没有任何发布计划。主干经常坏掉，所以如果你考虑到这一点，如果你想让事情继续下去，你可能想考虑为项目做出贡献。

然后是 ActiveMQ 本身，它有很多不错的功能，但也有一些非常奇怪的问题。出于稳定性原因，我们使用 Fuse (Progress) 版本的 activemq，但即便如此，您也需要记住一些奇怪的“错误”：

*   在某些情况下停止发送消息的代理
*   使队列显示消息的日志错误不再存在（它们没有传递给消费者，但仍然存在）
*   优先级仍未实现（自人类开始以来就在问题列表中）
*   等等等等

总而言之，如果你能忍受它的问题，它是一个非常好的产品：

A) 在使用 .NET 时不要害怕积极参与
B) 在 Java 中开发 ;-)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2010-08-23T11:05:21.913

在
[http://bhavin.directi.com/rabbitmq-vs-apache-activemq-vs-apache-qpid/给出了 RabbitMQ ActiveMQ 和 QPID 的特性和性能比较](http://bhavin.directi.com/rabbitmq-vs-apache-activemq-vs-apache-qpid/)

就个人而言，我已经尝试了以上三个。在我看来，RabbitMQ 是最好的性能，但它没有故障转移和恢复选项。ActiveMQ 的功能最多，但速度较慢。

更新： [HornetQ](http://www.jboss.org/hornetq)也是您可以考虑的一个选项，它是 JMS Complaint，如果您正在寻找基于 JMS 的解决方案，它是比 ActiveMQ 更好的选择。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2010-08-19T14:49:27.197

ZeroMQ 真的是零队列！这真是一个错误！它没有队列、主题、持久性，什么都没有！它只是套接字 API 的中间件。如果这是你看起来很酷的！否则算了！它不像 activeMQ 或 rabbitmq。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2010-09-25T20:13:51.827

我在这里写了关于 AMQP、Qpid 和 ZeroMQ 的初步经验：[http ://ron.shoutboot.com/2010/09/25/is-ampq-for-you/](http://ron.shoutboot.com/2010/09/25/is-ampq-for-you/)

我的主观意见是，如果您确实需要持久消息传递设施并且不太担心代理可能会成为瓶颈，那么 AMQP 很好。此外，AMQP 目前缺少 C++ 客户端（Qpid 没有赢得我的支持；但不确定 ActiveMQ 客户端），但可能正在进行中。ZeroMQ 可能是其他方式。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2011-05-14T18:12:02.783

我已经在生产环境中使用 ActiveMQ 大约 3 年了。虽然它完成了工作，但排列可以正常工作且没有错误的客户端库版本可能是一个问题。目前正在寻求过渡到 RabbitMQ。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-04-08T20:33:02.737

There is some discussion in the comments of [this blog post](http://unlimitednovelty.com/2009/04/twitter-blaming-ruby-for-their-mistakes.html), about Twitter writing their own message queue, which may be interesting.

> Steve did extensive load and stress testing of ActiveMQ, RabbitMQ, etc. ActiveMQ is actually quite slow (much slower than Kestrel), RabbitMQ consistently crashes with too many producers and too few consumers.

You probably won't have Twitter-like load initially however :)

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2010-07-20T19:17:13.087

很少有应用程序像 ActiveMQ 那样拥有如此多的调优配置。使 ActiveMQ 脱颖而出的一些特性是：

可配置的预取大小。可配置的线程。可配置的故障转移。向生产者发送可配置的管理通知。...详情请见：

[http://activemq.net/blog](http://activemq.net/blog) [http://activemq.apache.org](http://activemq.apache.org)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-07-28T08:20:37.017

[如果你也对商业实现感兴趣，你应该从my-channels](http://www.my-channels.com)看看 Nirvana 。

Nirvana 在金融服务行业中被大量用于大规模低延迟交易和价格分配平台。

支持跨企业、Web 和移动域的各种客户端编程语言。

如果透明 HA 或负载平衡对您很重要，集群功能非常先进，值得一看。

Nirvana 可免费下载用于开发目的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-05-15T03:06:44.823

关于 ZeroMQ aka 0MQ，正如您可能已经知道的那样，它可以让您每秒获得最多的消息（上次我检查时它们在他们的 ref 服务器上大约每秒 400 万条消息），但您可能也已经知道，文档不存在。您将很难找到如何启动服务器，更不用说如何使用它们了。我想这就是为什么还没有人贡献 0MQ 的部分原因。

玩得开心！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-05-18T13:07:28.457

Abie，这一切都取决于您的用例。与其依赖其他人对其用例的描述，不如随意将您的用例发布到 rabbitmq-discuss 列表。在推特上提问也会得到一些回应。最好的祝愿，亚历克西斯

# java - 最佳实践：Java 静态非最终变量

> ID：731236
> 
> 赞同：24
> 
> 时间：2009-04-08T18:26:25.740
> 
> 标签：java, static

在Java中，什么时候应该使用静态非最终变量？

例如

```
private static int MY_VAR = 0; 
```

显然，我们在这里讨论的不是常数。

```
public static final int MY_CONSTANT = 1; 
```

根据我的经验，我经常在使用单例时证明它们是合理的，但最终我需要拥有多个实例，这给自己带来了极大的头痛和重构。

似乎很少在实践中使用它们。你怎么看？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-08T18:28:53.830

统计数据收集可能使用非最终变量，例如计算创建的实例数。另一方面，对于那种你可能想要使用`AtomicLong`etc 的情况，此时它可能是最终的。或者，如果您要收集多个统计信息，则最终可能会得到一个`Statistics`类和对其实例的最终引用。

拥有（合理地）非最终静态变量当然非常罕见。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T19:06:13.803

当用作缓存时，日志记录、统计信息或调试开关是显而易见的合理用途。当然，都是私人的。

如果您将可变对象分配给最终字段，则在道德上与拥有可变字段相同。

某些语言，例如 Fan，完全不允许可变静态（或等效）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T22:00:08.973

根据我的经验，静态非最终变量只能用于单例实例。其他所有内容都可以更干净地包含在单例中（例如缓存），或者制成最终的（例如记录器引用）。但是，我不相信硬性规定和快速规定，所以我会接受我的建议。也就是说，我建议仔细检查您考虑在单例实例之外声明非最终静态变量并查看它是否可以重构或以不同方式实现的任何情况 - 即移入单例容器或使用对可变的最终引用目的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-07T10:06:58.393

静态变量可用于控制应用程序级别的行为，例如指定全局日志记录级别、要连接的服务器。

我在旧应用程序中遇到过这样的用例，通常来自其他公司。

如今，将静态变量用于此类目的显然是一种**不好的做法**，但在 1999 年就不是那么明显了。没有 Spring，没有 log4j，没有来自 RCMartin 的 Clean 代码等。

Java 语言现在已经很老了，即使现在强烈反对某些功能，它也经常在开始时使用。而且由于向后兼容性，它不太可能改变。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T22:03:38.853

我认为包装您的静态数据并通过单例（或至少通过静态方法）提供访问通常是一个好主意，因为您可以更好地控制访问并避免一些竞争条件和同步问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T12:47:49.073

静态变量意味着它可用于整个类，因此这两个示例都可用于整个类。Final 表示该值不能更改。所以我想问题是你什么时候想要一个值可供整个类使用，并且在实例化后不能更改它。我的猜测是该类的所有实例都可用的常量。否则，如果您需要人口计数器之类的东西，那么非最终变量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-10-23T17:30:37.123

对于类非最终变量，我个人使用 CamelCase 表示法。从代码中可以清楚地看出它是一个类变量，因为您必须这样引用它：`FooBar.bDoNotRunTests`.

在那一点上，我在类实例变量前面加上 ，`this`以将它们与局部范围变量区分开来。前任。`this.bDoNotRunTests`.

# java - 记录可用/必需的 Java 属性文件内容的最佳实践

> ID：731237
> 
> 赞同：6
> 
> 时间：2009-04-08T18:26:27.677
> 
> 标签：java, configuration-files

是否有一种完善的方法来记录 Java“属性”文件内容，包括：

*   指定给定键的预期数据类型/内容
*   指定应用程序是否需要密钥才能运行
*   提供密钥含义的描述

目前，我（手动）维护一个默认的 .properties 文件，并且我在之前的评论中写了数据类型的散文描述和每个键的描述。这不会导致以编程方式访问的属性文件。

我想我正在寻找的是属性文件的“getopt”等价物......

[编辑：相关]

*   [Java 配置框架](https://stackoverflow.com/questions/25765/)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T19:29:03.470

您可以使用[Apache Commons 配置](http://commons.apache.org/configuration/)包中的一些功能。它至少提供对您的属性的类型访问。

传统的 java 属性文件中只有约定。我见过的一些包括提供，就像你说的，一个示例属性文件。另一种是提供所有属性的默认配置，但被注释掉了。

如果你真的需要一些东西，也许你不是在寻找属性文件。您可以使用 XML 配置文件并指定具有数据类型和要求的模式。您可以使用 jaxb 将架构编译成 java 并以这种方式读取它。通过验证，您可以确保所需的属性在那里。

您可能希望的最好结果是当您执行应用程序时，它会读取、解析和验证文件中的属性。如果您绝对必须保持基于属性并且不想使用 xml，但需要此解析。您可以有一个辅助属性文件，其中列出了可以包含的每个属性、其类型以及是否需要。然后，您必须编写一个属性文件验证器，该验证器将接收要验证的文件以及类似于验证模式的属性文件。就像是

```
#list of required properties
required=prop1,prop2,prop3

#all properties and their types
prop1.type=Integer
prop2.type=String 
```

我没有浏览过所有的 Apache 配置包，但它们通常有像这样有用的实用程序。如果您可以在其中找到可以简化此操作的内容，我不会感到惊讶。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-02-12T17:03:53.043

签出的另一个选项是名为[OWNER](http://owner.aeonbits.org/)的项目。在那里，您可以使用类型和注释定义用作应用程序中配置对象的接口。然后，OWNER 查找和解析正确的`Properties`文件。因此，您可以为您的界面编写一个*javadoc*并将其用作文档。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:35:15.487

一种简单的方法是使用示例属性文件分发您的项目，例如我的项目在 svn 中有一个“build.properties.example”，并根据需要对属性进行注释。本地正确的属性不会进入 svn。

不过，既然您提到了“getopt”，我想知道您是否真的在考虑命令行参数？如果有一个需要特定属性的“main”，我通常会将相关说明放在“useage”消息中，如果参数不正确或“-h”会打印出来。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T19:22:50.503

我从未见过这样做的标准方法。我可能会做的是：

*   包装或扩展[java.util.Properties](http://java.sun.com/javase/6/docs/api/java/util/Properties.html)类
*   覆盖（扩展）或提供方法（如果包装）为每一行写出注释的存储方法（或 storeToXML 等）。
*   具有存储属性的方法具有某种输入文件，您可以在其中描述每个属性的属性。

它不会让你对你正在做的事情有任何帮助，除了你可以用一种不同的方式来管理信息，这可能更容易处理——例如，你可以有一个程序来吐出要读入的评论。它可能会为您提供所需的编程访问，但它是一种您自己的东西。

或者它可能只是工作太多而收获太少（这就是为什么那里没有明显的东西）。

如果你可以指定你想看到的评论类型，如果我感到无聊，我可以尝试写一些东西:-)（这是我喜欢做的有趣的事情，我知道恶心:-)。

好的...我很无聊...这至少是一个开始:-)

```
import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Properties;

public class PropertiesVerifier
{
    private final Map<String, PropertyInfo> optionalInfo;
    private final Map<String, PropertyInfo> requiredInfo;

    {
        optionalInfo = new HashMap<String, PropertyInfo>();
        requiredInfo = new HashMap<String, PropertyInfo>();
    }

    public PropertiesVerifier(final PropertyInfo[] infos)
    {
        for(final PropertyInfo info : infos)
        {
            final Map<String, PropertyInfo> infoMap;

            if(info.isRequired())
            {
                infoMap = requiredInfo;
            }
            else
            {
                infoMap = optionalInfo;
            }

            infoMap.put(info.getName(), info);
        }
    }

    public void verifyProperties(final Properties properties)
    {
        for(final Entry<Object, Object> property : properties.entrySet())      
        {
            final String key;
            final String value;

            key   = (String)property.getKey();
            value = (String)property.getValue();

            if(!(isValid(key, value)))
            {
                throw new IllegalArgumentException(value + " is not valid for: " + key);
            }
        }
    }

    public boolean isRequired(final String key)
    {
        return (requiredInfo.get(key) != null);
    }

    public boolean isOptional(final String key)
    {
        return (optionalInfo.get(key) != null);
    }

    public boolean isKnown(final String key)
    {
        return (isRequired(key) || isOptional(key));
    }

    public Class getType(final String key)
    {
        final PropertyInfo info;

        info = getPropertyInfoFor(key);

        return (info.getType());
    }

    public boolean isValid(final String key,
                           final String value)
    {
        final PropertyInfo info;

        info = getPropertyInfoFor(key);

        return (info.verify(value));
    }

    private PropertyInfo getPropertyInfoFor(final String key)
    {
        PropertyInfo info;

        info = requiredInfo.get(key);

        if(info == null)
        {
            info = optionalInfo.get(key);

            if(info == null)
            {
                // should be a better exception maybe... depends on how you 
                // want to deal with it
                throw new IllegalArgumentException(key + " 
                                                   is not a valid property name");
            }
        }

        return (info);
    }

    protected final static class PropertyInfo
    {
        private final String name;
        private final boolean required;
        private final Class clazz;
        private final Verifier verifier;

        protected PropertyInfo(final String   nm,
                               final boolean  mandatory,
                               final Class    c)
        {
            this(nm, mandatory, c, getDefaultVerifier(c));
        }

        protected PropertyInfo(final String   nm,
                               final boolean  mandatory,
                               final Class    c,
                               final Verifier v)
        {
            // check for null
            name     = nm;
            required = mandatory;
            clazz    = c;
            verifier = v;
        }

        @Override
        public int hashCode()
        {
            return (getName().hashCode());
        }

        @Override
        public boolean equals(final Object o)
        {
            final boolean retVal;

            if(o instanceof PropertyInfo)
            {
                final PropertyInfo other;

                other  = (PropertyInfo)o;
                retVal = getName().equals(other.getName());
            }
            else
            {
                retVal = false;
            }

            return (retVal);
        }

        public boolean verify(final String value)
        {
            return (verifier.verify(value));
        }

        public String getName()
        {
            return (name);
        }

        public boolean isRequired()
        {
            return (required);
        }

        public Class getType()
        {
            return (clazz);
        }
    }

    private static Verifier getDefaultVerifier(final Class clazz)
    {
        final Verifier verifier;

        if(clazz.equals(Boolean.class))
        {
            // shoudl use a singleton to save space...
            verifier = new BooleanVerifier();
        }
        else
        {
            throw new IllegalArgumentException("Unknown property type: " + 
                                               clazz.getCanonicalName());
        }

        return (verifier);
    }

    public static interface Verifier
    {
        boolean verify(final String value);
    }

    public static class BooleanVerifier
        implements Verifier
    {
        public boolean verify(final String value)
        {
            final boolean retVal;

            if(value.equalsIgnoreCase("true") ||
               value.equalsIgnoreCase("false"))
            {
                retVal = true;
            }
            else
            {
                retVal = false;
            }

            return (retVal);
        }
    }
} 
```

并对其进行简单的测试：

```
import java.util.Properties;

public class Main
{
    public static void main(String[] args)
    {
        final Properties         properties;
        final PropertiesVerifier verifier;

        properties = new Properties();
        properties.put("property.one",   "true");
        properties.put("property.two",   "false");
//        properties.put("property.three", "5");
        verifier = new PropertiesVerifier(
            new PropertiesVerifier.PropertyInfo[]
            {
                new PropertiesVerifier.PropertyInfo("property.one",   
                                                    true, 
                                                    Boolean.class),
                new PropertiesVerifier.PropertyInfo("property.two",   
                                                    false, 
                                                    Boolean.class),
//                new PropertiesVerifier.PropertyInfo("property.three", 
//                                                    true, 
//                                                    Boolean.class),
            });

        System.out.println(verifier.isKnown("property.one"));
        System.out.println(verifier.isKnown("property.two"));
        System.out.println(verifier.isKnown("property.three"));

        System.out.println(verifier.isRequired("property.one"));
        System.out.println(verifier.isRequired("property.two"));
        System.out.println(verifier.isRequired("property.three"));

        System.out.println(verifier.isOptional("property.one"));
        System.out.println(verifier.isOptional("property.two"));
        System.out.println(verifier.isOptional("property.three"));

        System.out.println(verifier.getType("property.one"));
        System.out.println(verifier.getType("property.two"));

        // System.out.println(verifier.getType("property.tthree"));
        System.out.println(verifier.isValid("property.one", "true"));
        System.out.println(verifier.isValid("property.two", "false"));
        // System.out.println(verifier.isValid("property.tthree", "5"));

        verifier.verifyProperties(properties);
    }
} 
```

# c# - 如何转换函数 谓词 ?

> ID：731249
> 
> 赞同：28
> 
> 时间：2009-04-08T18:29:41.317
> 
> 标签：c#, .net-3.5, lambda

是的，我已经看到[了，](https://stackoverflow.com/questions/665494/c-why-funct-bool-instead-of-predicatet)但我找不到我的具体问题的答案。

给定一个接受 T 并返回布尔值的 lambda **testLambda**（我可以将其设为 Predicate 或 Func，这取决于我）

我需要能够同时使用 List.FindIndex(testLambda) （采用谓词）和 List.Where(testLambda) （采用 Func）。

任何想法如何做到这两点？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-04-08T18:31:48.693

简单的：

```
Func<string,bool> func = x => x.Length > 5;
Predicate<string> predicate = new Predicate<string>(func); 
```

*基本上，您可以使用任何兼容*的现有实例创建一个新的委托实例。这也支持方差（co-和contra-）：

```
Action<object> actOnObject = x => Console.WriteLine(x);
Action<string> actOnString = new Action<string>(actOnObject);

Func<string> returnsString = () => "hi";
Func<object> returnsObject = new Func<object>(returnsString); 
```

如果你想让它通用：

```
static Predicate<T> ConvertToPredicate<T>(Func<T, bool> func)
{
    return new Predicate<T>(func);
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-08T18:31:45.087

我懂了：

```
Func<object, bool> testLambda = x=>true;
int idx = myList.FindIndex(x => testLambda(x)); 
```

有效，但很糟糕。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-07T15:48:21.750

我玩游戏有点晚了，但我喜欢扩展方法：

```
public static class FuncHelper
{
    public static Predicate<T> ToPredicate<T>(this Func<T,bool> f)
    {
        return x => f(x);
    }
} 
```

然后你可以像这样使用它：

```
List<int> list = new List<int> { 1, 3, 4, 5, 7, 9 };
Func<int, bool> isEvenFunc = x => x % 2 == 0;
var index = list.FindIndex(isEvenFunc.ToPredicate()); 
```

嗯，我现在看到了 FindIndex 扩展方法。我猜这是一个更笼统的答案。与 ConvertToPredicate 也没有太大区别。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T19:20:40.180

听起来像一个案例

```
static class ListExtensions
{
  public static int FindIndex<T>(this List<T> list, Func<T, bool> f) {
    return list.FindIndex(x => f(x));
  }
}

// ...
Func<string, bool> f = x=>Something(x);
MyList.FindIndex(f);
// ... 
```

我喜欢 C#3 ...

# vb6 - SQL 2K浮点数据类型的VB6等效项？

> ID：731259
> 
> 赞同：2
> 
> 时间：2009-04-08T18:32:38.690
> 
> 标签：vb6

有谁知道 VB6 等效于 SQL 2K 浮点数据类型？谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T18:35:09.870

那将是一个双

这是一个很好的[交叉参考](http://www.carlprothman.net/Default.aspx?tabid=97)。

# c# - MVC 站点使用链接的相对路径而不是视图语法

> ID：731262
> 
> 赞同：1
> 
> 时间：2009-04-08T18:33:02.293
> 
> 标签：c#, asp.net, asp.net-mvc

**编辑！！** 我应该补充一点，这个站点在本地运行得很好。只有在部署时才会出现此问题

**原帖：**

我有一个网站，我刚刚建立了[http://splattonet0.web704.discountasp.net/](http://splattonet0.web704.discountasp.net/)

这很好地加载了 Home 控制器的 Index 视图。但是，当单击左侧的链接时，网络服务器正在寻找不正确的相对路径（即 E:\web\splattonet0\htdocs\Home\AboutMe），因为主文件夹当然位于名为“Views”的文件夹下"

我以前做过 MVC 网站，从来没有遇到过这个问题。我看不出这个网站和我做过的任何其他网站有什么区别。

我在链接部分的主模板中的代码如下：

```
<div id="navContainer">
            <ul id="mainNav">
                <li><a href="/Home/Index" title="Home">Home</a></li>
                <li><a href="/Home/AboutMe" title="About Us">About Me</a></li>
                <li><a href="/Skills/Index" title="Skills">Skills</a></li>
                <li><a href="/Home/Resume" title="Resume">Resume</a></li>
                <li><a href="/Home/Experience" title="Experience">Experience</a></li>
                <li><a href="/Home/SitesIveDesigned" title="Websites I've developed">My Websites</a></li>
                <li><a href="/Home/References" title="References">References</a></li>
                <li><a href="/Home/Projects" title="Projects">Projects</a></li>
                <li><a href="/Home/Hobbies" title="Hobbies">Hobbies</a></li>
                ....etc
            </ul>
        </div> 
```

在 href 属性中使用和不使用前面的前斜杠时，我都有同样的问题。我决定保留它，因为这就是我的其他网站（有效！）的样式。

任何人都可以为我阐明这一点吗？谢谢！

**进一步编辑：**

我被要求在我编写的这台服务器上提供来自 MVC 站点的代码，并且工作正常。另一个站点（[YorkCentre](http://yorkcentreconservative.ca/)）中的链接代码是相同的样式：`<li><a href="/Controller/Action">text</a></li>`

编码：

```
<li><a href="/News/Index">Archived News</a></li>
<li><a href="/Home/BoardOfDirectors">Board Of Directors</a></li>
<li><a href="/Media/Index">In The Media</a>
...
</ul> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T18:55:04.503

/Home/Index 应该调用“Home”控制器的“Index”操作，假设您使用的是默认路由。“Home”位于“Views”文件夹下的事实与 MVC 无关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T19:24:39.937

如果两个位置的代码相同，并且问题只发生在一个位置，那么答案可能不在代码中。以下是一些可能会有所帮助的故障排除提示，因为如果没有有关这两种环境的更多信息，我不知道究竟是什么问题。

您的本地环境和服务器环境的 Web 服务器平台是什么？您是否在本地使用 Visual Studio 和 Cassini，而在远程使用 IIS？如果是这样，哪个版本的 IIS？如果不是，平台是什么？无论如何，目标服务器是否配置正确？

检查以确保您的路由在目标服务器上设置正确。如果您的目标服务器运行 IIS6 尤其如此——IIRC，IIS 6 需要一些特殊的配置帮助来处理 ASP.NET MVC 中的标准路由。

如果以上所有方法都不能帮助您找出原因，请尝试通过创建一个新的 MVC 站点并将现有文件放入其中来在本地复制它。看看是成功还是失败。

您在该服务器上是否有其他成功执行的 ASP.NET MVC 应用程序？根据您的新站点检查他们的配置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:00:49.820

我已经解决了这个问题！在 DiscountASP 中，我已将应用程序池管道模式从经典更改为集成，这导致我的视​​图被正确呈现。

# wcf - 什么时候适合在 webclient 或 httpwebrequest 上使用 WCF？

> ID：731263
> 
> 赞同：5
> 
> 时间：2009-04-08T18:33:05.087
> 
> 标签：wcf, networking

我希望了解何时使用 WCF 服务，而不仅仅是使用 webclient 或 httpwebrequest。我想我也想了解适合两者的设计模式之间的区别。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T19:49:49.330

您是在谈论何时自己（通过 Web 服务）创建 WCF 服务，还是何时使用 WCF 而不是 .NET 2.0 ASMX 客户端使用现有的 Web 服务？

至于自己创建 WCF 服务：

*   在托管方面为您提供更多选择（在应用程序、Windows 服务、IIS、WAS 中）
*   为您提供更多安全选项
*   为您提供更多协议选项（除了 HTTP，您还可以使用 WS-*、TCP、命名管道、MSMQ 等）
*   允许您编写一次服务，并同时在具有不同协议的多个端点上公开它

至于使用 WCF 与现有的 HTTP (ASMX) Web 服务通信 - 我没有看到很多巨大的好处，除了 WCF 使用更多的代码配置，并且标准化一种做事方式可能会很好，如果您已经使用其他 WCF 服务，无论如何。

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T18:37:38.583

我目前正在将 WCF 用于过去我会使用 WebClient 或 HttpWebRequest/HttpWebResponse 的大多数事情。虽然学习如何使用 WCF 调用 Web 方法肯定存在开销，但 WCF 的可扩展性和它提供的抽象使其成为这些类型调用的更好候选者。

我已经用它很容易地调用 Akismet 和 RPX。

首先，我将查看 MSDN 文档中标题为“WCF Web Programming Object Model”的部分，该部分位于：

[http://msdn.microsoft.com/en-us/library/bb412204.aspx](http://msdn.microsoft.com/en-us/library/bb412204.aspx)

# jquery - 使用 JQuery 获取 ListItem 值

> ID：731277
> 
> 赞同：1
> 
> 时间：2009-04-08T18:36:08.620
> 
> 标签：jquery, listitem

我正在尝试使用 JQuery 在无序列表中获取 ListItems 的值（见下文）。下面的代码接近工作，但它总是返回第一个 ListItem 的值，即使第二个被选中。

```
<script>
    $(document).ready(function () {
        $("li").click(function () {
            $("input:checked").each(function () {
                alert($("label").attr('InnerText'));
            });
        });
    });
</script>

<div>
    <ul class="AspNet-CheckBoxList-RepeatDirection-Vertical">
        <li class="AspNet-CheckBoxList-Item">
            <input id="CheckBoxList1_0" type="checkbox" name="CheckBoxList1$0" value="first1" />
            <label for="CheckBoxList1_0">First $30.00</label>
        </li>
        <li class="AspNet-CheckBoxList-Item">
            <input id="CheckBoxList1_1" type="checkbox" name="CheckBoxList1$1" value="second2" />
            <label for="CheckBoxList1_1">Second $25.00</label>
        </li>
    </ul>
</div> 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T18:43:33.703

在您的每次回调中，您并没有限制选择器的范围，它只是在您调用 .attr 时获取它找到的第一个标签。尝试类似以下的...

```
$("input:checked").each(function() {
    $(this).next("label").text(); //Or
    $(this).parent().find("label").text(); //Depending on your markup
}); 
```

这将选择器的范围限定为复选框周围的元素，而不是整个文档

# c# - 将 ResourceDictionary 复制到 C# 中的字典

> ID：731281
> 
> 赞同：4
> 
> 时间：2009-04-08T18:36:33.627
> 
> 标签：c#, wpf, resourcedictionary

我有一个仅包含字符串键和字符串值的 ResourceDictionary。现在我想要一个具有相同内容的 Dictionary< string, string >。

你会怎么做？C# 中最快的解决方案是什么？

编辑：在性能方面最快；）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T18:41:35.643

就最简单而言最快？假设.NET 3.5（以及LINQ）我会使用：

```
resourceDictionary.Keys.Cast<string>().ToDictionary
    (x => x,                             // Key selector
     x => (string) resourceDictionary[x] // Value selector
     ); 
```

# hardware - 虚拟服务器的硬件要求

> ID：731286
> 
> 赞同：4
> 
> 时间：2009-04-08T18:37:05.810
> 
> 标签：hardware, vmware, virtualization, virtual-server

我们决定为我们的一些开发服务器使用虚拟化解决方案。如果我们购买单独的物理服务器，我知道硬件规格会是什么样子，但我不知道如何将这些信息整合到通用虚拟服务器的规范中。

我直观地知道规格不是附加的——我不应该只是将每台机器的所有 RAM 要求相加来获得虚拟服务器所需的 RAM。我也不能真正将它们视为并行系统，因为无论虚拟化软件有多好，它都无法抽象出试图同时固定 CPU 的两台服务器。

所以我的问题是——在给定底层虚拟机的硬件需求估计的情况下，是否有一种标准方法来估计虚拟化系统的硬件需求？VMWare/MS 虚拟服务器开销是否有 +C 常量（如果有，C 是什么？）？

PS 我保证一旦它进入测试版就将它转移到服务器故障（承诺[保持](https://serverfault.com/questions/2556/hardware-requirements-for-a-virtual-server)）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T19:30:54.587

是的，增加 25% 的额外资源来管理 VM。因此，如果我需要 4 台服务器，相当于单核 2 ghz 机器和 2 gigs ram，我将需要 10 ghz 处理能力和 10 gigs ram。这将允许所有系统红线并且仍然可以。

但在现实世界中，这永远不会发生，您的所有服务器不会一直都在运行。您可以通过分析当前服务器并确定它们的确切要求，然后再增加 25% 的资源来了解使用情况。

查看此软件以了解分析利用率[http://confluence.atlassian.com/display/JIRA/Profiling+Memory+and+CPU+usage+with+YourKit](http://confluence.atlassian.com/display/JIRA/Profiling+Memory+and+CPU+usage+with+YourKit)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T18:40:50.307

这些要求实际上是附加的。您应该将每个 VM 的内存要求和磁盘要求相加，并且每个 VM 至少有一个处理器内核。然后添加主机系统所需的任何内容。在某种程度上，如果您的性能要求非常低，VM 可以共享一个 CPU，但它们不能共享磁盘空间或内存。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T07:16:19.870

上面的答案太高了，第二个（每个 VM 1 个核心）更接近。您可以 1) 提前计划并可能过度购买 2) 及时添加。你有什么理由必须提前知道（年度预算？你选择的主机平台没有集群主机，所以你不能以后添加？）

除非您拥有令人难以置信的简单使用配置文件，否则之前很难预测并且您会过度购买。上面的答案 (+25%) 将是智能管理资源的现代服务器虚拟化软件（VMware、Zen 等）所需的数倍。它仅适用于 VPC 等桌面产品。我选择在餐巾纸上对其进行粗略处理，并在主机上配置我的第一个环境（一组机器）。我很高兴。

会混淆你的估计的事情的例子

*   磁盘空间，某些系统 (Lab Manager) 仅使用与基本模板的空间差异。10 台部署了 10 GB 驱动器的机器，使用大约 10 GB（模板）+ 200 MB。
*   磁盘空间：然后您会发现您不喜欢特定场景中的增量。
*   CPU / 内存：这是开发商店 - 所以你会有不稳定的负载。智能主机不保留内存和 CPU。
*   CPU / 内存：但是你会想要进行性能测试，并想要保留 CPU 周期（并非所有主机都可以这样做）
*   我们都出于不同的原因进行虚拟化。我们环境中的许多客人没有太多工作。我们希望他们在那里查看由 3 台 X 型服务器组成的集群如何运行。或者，我们有一堆奇怪的客户端桌面在等待，测试人员一次次使用一个。它们很少消耗许多主机资源。

因此，如果您使用类似的东西不做增量磁盘，磁盘空间可能有点可计算。如果是实验室管理器（增量磁盘），磁盘空间真的很难预测。

内存和处理器使用情况：您将不得不大量分析或过度购买。我的客户 CPU 比主机 CPU 多得多，并且没有性能问题 - 但这是因为我们的 QA 环境中使用不稳定。

# c# - 在 C# 中生成下一个可用的唯一名称

> ID：731294
> 
> 赞同：5
> 
> 时间：2009-04-08T18:38:48.987
> 
> 标签：c#, .net, performance

如果您的应用程序中有一个命名系统，其中该应用程序包含 100 个操作，这些操作会创建新对象，例如：

```
Blur
Sharpen
Contrast
Darken
Matte
... 
```

每次使用其中一个时，都会创建一个具有唯一可编辑名称的新实例，例如`Blur01`, `Blur02`, `Blur03`, `Sharpen01`,`Matte01`等。您将如何生成下一个可用的唯一名称，以便它是 O(1) 操作或接近常量时间。请记住，用户还可以将名称更改为自定义名称，例如`RemoveFaceDetails`等。

有一些限制是可以接受的，比如将字符数限制为 100，使用字母、数字、下划线等......

编辑：您也可以在不“填补空白”的情况下提出解决方案，即不重复使用已使用但已删除的名称，当然自定义名称除外。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T18:47:59.043

我会在动作类中创建一个静态整数，它会递增并作为类的每个新实例的一部分分配。例如：

```
class Blur
{
    private static int count = 0;

    private string _name;
    public string Name
    {
        get { return _name; }
        set { _name = value; }
    }

    public Blur()
    {
        _name = "Blur" + count++.ToString();
    }
} 
```

由于 count 是静态的，因此每次创建新类时，它都会递增并附加到默认名称。O(1) 时间。

**编辑**

如果你需要在删除时填补漏洞，我建议如下。当项目被重命名时，它会自动将数字排队，但总体而言成本会更高：

```
class Blur
    {
        private static int count = 0;
        private static Queue<int> deletions = new Queue<int>();

        private string _name;
        public string Name
        {
            get { return _name; }
            set
            {
                _name = value;
                Delete();
            }
        }

        private int assigned;

        public Blur()
        {
            if (deletions.Count > 0)
            {
                assigned = deletions.Dequeue();
            }
            else
            {
                assigned = count++;
            }
            _name = "Blur" + assigned.ToString();
        }

        public void Delete()
        {
            if (assigned >= 0)
            {
                deletions.Enqueue(assigned);
                assigned = -1;
            }
        }
    } 
```

此外，当您删除一个对象时，您需要在该对象上调用 .Delete()。

**CounterClass 字典版本**

```
class CounterClass
{
   private int count;
   private Queue<int> deletions;

   public CounterClass()
   {
      count = 0;
      deletions = new Queue<int>();
   }

   public string GetNumber()
   {
      if (deletions.Count > 0)
      {
          return deletions.Dequeue().ToString();
      }
      return count++.ToString();
   }

   public void Delete(int num)
   {
      deletions.Enqueue(num);
   }
} 
```

您可以创建一个字典来查找每个字符串的计数器。只要确保在重命名或删除值时解析索引并调用 .Delete(int) 即可。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T18:51:47.053

我向您推荐 Michael A. Jackson 的[两个程序优化规则](http://en.wikipedia.org/wiki/Optimization_(computer_science)#Quotes)：

1.  不要这样做。
2.  仅适用于专家：暂时不要这样做。

*简单、可维护的代码比针对您认为以后可能*遇到的速度问题进行优化要重要得多。

我会从简单开始：建立一个候选名称（例如“Sharpen01”），然后遍历现有过滤器以查看该名称是否存在。如果是这样，请增加并重试。这是 O(N ² )，但在您获得数千个过滤器之前，这已经足够了。

如果稍后某个时间 O(N ² ) 确实成为问题，那么我将从构建现有名称的 HashSet 开始。然后，您可以根据 HashSet 检查每个候选名称，而不是迭代。每次需要唯一名称时重新构建 HashSet，然后将其丢弃；面对变化，您不需要维护它的复杂性。这将使您的代码易于维护，而只是 O(N)。

O(N) 就足够了。您不需要 O(1)。用户不会单击“锐化”足够的次数来产生任何差异。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T18:42:19.820

您可以轻松地在`O(m)`其中`m`名称的现有实例数（而不依赖于`n`列表中的项目数）中执行此操作。

1.  查找有`S`问题的字符串。如果`S`不在列表中，您就完成了。
2.  `S`存在，所以构造`S+"01"`并检查它。继续递增（例如，下一次尝试`S+"02"`直到它不存在。

这为您提供了唯一的名称，但它们仍然“漂亮”且易于阅读。

除非您期望大量重复，否则这应该是“近乎恒定”的时间，因为`m`它是如此之小。

*警告：*如果字符串*自然*以例如“01”结尾怎么办？在你的情况下，这听起来不太可能，所以也许你不在乎。如果您确实在意，请考虑添加更多后缀，例如“ `_01`”而不是“ `01`”，这样更容易区分它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T19:08:18.760

你可以这样做：

```
 private Dictionary<string, int> instanceCounts = new Dictionary<string, int>();

    private string GetNextName(string baseName)
    {
        int count = 1;

        if (instanceCounts.TryGetValue(baseName, out count))
        {
            // the thing already exists, so add one to it
            count++;
        }

        // update the dictionary with the new value
        instanceCounts[baseName] = count;

        // format the number as desired
        return baseName + count.ToString("00");
    } 
```

然后，您只需使用所需的基本名称调用 GetNextName(...) 即可使用它，例如 `string myNextName = GetNextName("Blur");`

使用它，您不必预先初始化字典。它会在您使用各种基本词时填写。此外，这是 O(1)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T19:10:49.207

我将创建一个带有字符串键和整数值的字典，存储下一个用于给定操作的数字。这在实践中几乎是 O(1)。

```
private IDictionary<String, Int32> NextFreeActionNumbers = null;       

private void InitializeNextFreeActionNumbers()
{
   this.NextFreeActionNumbers = new Dictionary<String, Int32>();

   this.NextFreeActionNumbers.Add("Blur", 1);
   this.NextFreeActionNumbers.Add("Sharpen", 1);
   this.NextFreeActionNumbers.Add("Contrast", 1);
   // ... and so on ...
}

private String GetNextActionName(String action)
{
   Int32 number = this.NextFreeActionNumbers[action];

   this.NextFreeActionNumbers[action] = number + 1;

   return String.Format("{0} {1}", action, number);
} 
```

并且您必须检查与用户编辑值的冲突。再次，字典可能是一个明智的选择。没有办法解决这个问题。无论您以何种方式生成名称，用户始终可以将现有名称更改为您生成的下一个名称，除非您将所有现有名称包含到生成模式中。（或者使用用户编辑的名称中不允许的特殊字符，但这不是很好。）

由于有关重用孔的评论，我也想在此处添加它。**不要重复使用重命名或删除产生的漏洞。**这会使用户感到困惑，因为他删除或修改的名称会突然重新出现。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T13:42:58.893

我会寻找简化问题的方法。

有没有可以应用的约束？举个例子，如果每个用户只能有一种（活动的）操作类型就足够了吗？然后，可以使用用户的名称（或 ID）来区分这些操作。

*   模糊 (Ben F)
*   模糊（阿德里安 H）
*   焦点（本 F）

在这种情况下，也许这不是一个选择，但也许还有其他可能。我会竭尽全力避免某些提议的解决方案的复杂性！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T18:48:07.497

如果您想要 O(1) 时间，那么只需跟踪您拥有的每个实例的数量。保留包含所有可能对象的哈希表，当您创建对象时，增加该对象的值并在名称中使用结果。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-08T18:49:47.370

您绝对不想将 GUID 公开给用户界面。

您是否建议使用像“Blur04”这样的初始名称，让用户重命名它，然后在用户的自定义名称冲突时引发错误消息？或者默默地将其重命名为“CustomName01”或其他什么？

您可以使用字典在 O(1) 时间内检查重复项。您可以为创建新效果实例的类中的每种效果类型设置递增计数器。就像 Kevin 提到的那样，如果您必须在删除效果时填充编号中的空白，它会变得更加复杂。

# visual-studio-2008 - 如何在 Visual Studio 中为控件指定默认字体和大小？

> ID：731314
> 
> 赞同：3
> 
> 时间：2009-04-08T18:43:33.500
> 
> 标签：visual-studio-2008, controls, ssrs-2008

我正在 Visual Studio 中创建报告，并且正在寻找一种方法来指定默认字体和大小，每次我将其放到设计器上时都适用于文本框。

更新：这不是 winforms 或 webforms 开发，而是使用 Visual Studio 中的报表设计器。我最大的问题是默认情况下文本框的高度为 0.25 英寸，在我将字体从 Arial、10pt 更改为 Tahoma、8pt 后，文本框的高度需要更改为 0.2 英寸。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T18:49:16.480

我认为公共属性是从父容器继承的，因此如果您更改父窗体中的字体大小和样式，它将默认更改为新的子控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T19:14:23.457

伙计们，我在这里可能不正常，但根据标签（特别是 ssrs-2008 -- SQL Server Reporting Services），我猜原始海报不是指 WinForms 或 WebForms（[@pablito](https://stackoverflow.com/questions/731314/how-do-i-specify-a-default-font-and-size-for-a-control-in-visual-studio/731336#731336)的答案和[@jmein](https://stackoverflow.com/questions/731314/how-do-i-specify-a-default-font-and-size-for-a-control-in-visual-studio/731338#731338)将适用）。

我在 VS2005 下的 SSRS 中遇到了同样的问题。我的团队通过首先布置整个报告来解决这个问题，**根本没有格式化。**整个报表布置好后，我们煞费苦心地按住 shift 键一次选择多个报表元素，然后相应地设置属性。

如果您非常熟悉报告 XML 格式，您还可以尝试通过 XSLT 转换运行报告文件，以添加适当的缺失格式 XML。如果你得到这个工作，它会很光滑，但我个人不会去麻烦，除非我知道我需要在多个报告中使用完全相同的格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:49:35.887

[在这种情况下， @john 的](https://stackoverflow.com/questions/731314/how-do-i-specify-a-default-font-and-size-for-a-control-in-visual-studio/731425#731425)答案似乎是正确的答案，但由于这个问题的措辞含糊不清，它也可能会受到 WebForms 的欢迎，所以我将把答案留在这里

**对于 Web 表单：**

您正在寻找控制皮肤

你所要做的就是在你的 App_Themes 文件夹中创建一个 .skin 文件，在这里你可以为你想要设置的任何控件设置默认值，比如你的文本框，但是如果你想拥有多个，那么你需要设置一个 skinId

```
<asp:TextBox runat="server" CssClass="skin_Textbox" />
<asp:TextBox runat="server" skinID="txt_"  Width="20px" CssClass="skin_Textbox" /> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T18:55:01.070

你可以做的简单的事情是放下一个文本框，设置你想要的属性（大小，字体）。
然后，复制/粘贴以创建新的文本框（与复制的文本框具有相同的属性）。

# clearquest - 将 ClearQuest 用于库存管理应用程序

> ID：731317
> 
> 赞同：4
> 
> 时间：2009-04-08T18:44:11.643
> 
> 标签：clearquest

是否有人使用 IBM Rational ClearQuest 为库存管理或类似应用程序创建模式？我们被“要求”使用这个工具，因为它已经被购买并支付给支持网络的一些遗留系统，但我认为它完全不适合这项工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-05T00:33:50.993

我在这个问题上与您同在，而 ClearQuest 是一个可定制的工作流引擎，将它用于诸如库存之类的一堆“无状态”记录似乎有点不对劲。还有比这更多的吗，或者您对跟踪库存的兴趣很简单？

如果是这样，我会争辩说，虽然这是可能的，而且前期设置的努力成本，而且由于您现在已经拥有它，但您现在可能最终会为这种简单性付出代价，而系统并不是您想要的一年或两年，或者当你达到几百万条记录并开始爬行时......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-25T05:09:19.143

您的 Inventory Mgt 系统是否需要 Web 界面和定制的工作流程供您的管理员/资产管理人员使用？

如果是，那么 CQ 是有道理的。否则，如果您只是查看转储存储区域以供记录，则 MS Access 甚至可能更适合这项工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:55:19.743

？？？

Clearquest 是一个错误/问题跟踪系统，尽管它是一个高度可定制的系统。但是使用错误跟踪系统可以做的事情是有限的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-29T11:27:22.377

这绝对是可能的，但我看不出您如何从 Clearquests 功能中获得最大收益（状态转换是主要功能）。我想您可以为每个项目类型位置等创建无状态记录，然后使用导入工具导入您的旧数据。如果您已经为 Clearquest 分配了一名开发人员，那么这可能是比购买某些东西或使用开源软件更快的解决方案。反对的论点不是自动发现或集成管理。

# sharepoint - 工作流程：暂停持续时间 SPD WF 操作挂起

> ID：731329
> 
> 赞同：0
> 
> 时间：2009-04-08T18:47:55.050
> 
> 标签：sharepoint, sharepoint-designer

目前，我正在开发一个 SPOnline 工作流，试图根据下拉框的值每月、每季度或每年自动分配一项任务。从我一直在测试的情况来看，设置为 5 分钟的持续时间暂停似乎挂起并且在暂停后不会恢复工作流程。我已尝试删除持续时间操作的暂停，并且已成功分配任务。以下是它目前如何解决问题：

步骤/动作

1 / 工作流程初始化

2 / 根据下拉列表确定月/季度/年

3 / 基于暂停的 DDL 值（这是挂起的地方）

4 / 设置文件审批状态为待处理

5 / 分配任务

6 / 将文档审批状态设置为已完成

无论我将它设置为什么时间间隔，它似乎都挂起并且没有完成工作流程或进入下一个任务。我尝试了以下步骤：

• 通过删除持续时间步骤的暂停来调试工作流

• 更改了区域设置以匹配服务器

• 将工作流操作分解为多个步骤，反之亦然（查看是否需要分离暂停）

• 尝试了 5、10、15、30 分钟和 1 小时的暂停

关于看什么或暂停持续时间是否无法正常工作的任何建议？谢谢！！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T13:19:47.373

There was a hotfix to address a problem with the "pause for duration" actions not firing. However, I think this was rolled into SP1, so you should have that applied already:

[Hot fix blog entry](http://blogs.msdn.com/sharepointdesigner/archive/2007/05/02/hotfix-for-delay-need-better-title.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T18:52:42.753

[http://www.microsoft.com/downloads/details.aspx?FamilyId=256CE3C3-6A42-4953-8E1B-E0BF27FD465B&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=256CE3C3-6A42-4953-8E1B-E0BF27FD465B&displaylang=en)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-22T20:09:21.650

FWIW，我在安装 SP2 时得到了相同的行为。几个“暂停持续时间”WFA 每个应该暂停 3 分钟，现在已经等待超过 4 天，工作流中没有错误，并且所有计时器作业在中央管理中报告健康。

MSDN 上有一篇关于此的帖子，表明该修补程序仅修复了部分问题：[http ://social.msdn.microsoft.com/Forums/en-US/sharepointworkflow/thread/1965d387-8436-4868-98dc-7a76cbda75d3 /](http://social.msdn.microsoft.com/Forums/en-US/sharepointworkflow/thread/1965d387-8436-4868-98dc-7a76cbda75d3/)（该讨论已被锁定，感谢 MSDN）

# windows - 在 Windows 批处理中检查空变量

> ID：731332
> 
> 赞同：69
> 
> 时间：2009-04-08T18:48:33.877
> 
> 标签：windows, batch-file

我正在处理一个 Windows 批处理文件，它将三个文本文件 bcp 到 SQL Server 中。如果生产中出现问题，我希望能够覆盖文件名。所以我正在考虑做这样的事情。

```
bcp.exe MyDB..MyTable1 in %1 -SMyServer -T -c -m0
bcp.exe MyDB..MyTable2 in %2 -SMyServer -T -c -m0
bcp.exe MyDB..MyTable3 in %3 -SMyServer -T -c -m0 
```

我希望能够为所有三个文件输入默认名称，以便在未提供位置参数时使用。这个想法要么是执行

```
myjob.bat 
```

没有参数，并让它使用默认值，或者执行

```
myjob.bat "c:\myfile1" "c:\myfile2" "c:\myfile3" 
```

并让它使用这些文件。我无法弄清楚如何判断 %1、%2 和 %3 是否存在和/或是否为空。我也不知道如何有条件地设置这些值。这可能吗？任何建议，将不胜感激。

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2009-04-08T18:54:04.957

要测试是否存在命令行参数，请使用空括号：

```
IF [%1]==[] echo Value Missing 
```

或者

```
IF [%1] EQU [] echo Value Missing 
```

IF 上的[SS64 页面](http://www.ss64.com/nt/if.html)将在这里为您提供帮助。在“%1 是否存在？”下。

你不能设置一个位置参数，所以你应该做的是做类似的事情

```
SET MYVAR=%1 
```

然后，您可以根据其内容重新设置 MYVAR。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-12-22T09:48:18.457

正确的做法是使用“if defined”语句，用于测试变量是否存在。例如：

```
IF DEFINED somevariable echo Value exists 
```

在这种特殊情况下，应使用否定形式：

```
IF NOT DEFINED somevariable echo Value missing 
```

**PS：变量名应不带“%”字符。**

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-04-08T19:17:32.030

给出的两个答案都是正确的，但我的答案有点不同。您可能需要考虑几件事...

使用以下命令开始批处理：

```
SetLocal 
```

并以

```
EndLocal 
```

这将使您的所有“SET”仅在当前会话期间有效，并且不会留下命名为“FileName1”或您在运行期间设置的任何其他变量的变量，这可能会干扰批处理文件的下一次运行. 所以，你可以这样做：

```
IF "%1"=="" SET FileName1=c:\file1.txt 
```

另一个技巧是，如果您只提供 1 个或 2 个参数，请使用 SHIFT 命令移动它们，因此您要查找的始终位于 %1...

例如，处理第一个参数，移动它们，然后再做一次。这样，您就不会对 %1、%2、%3 等进行硬编码...

Windows 批处理器比人们认为的要强*大得多*。我用它做了一些疯狂的事情，包括计算昨天的日期，甚至跨越包括闰年和本地化等月份和年份的界限。

如果你真的想有创意，你可以在批处理器中调用函数......但这真的是一个不同的讨论...... :)

哦，也不要将批处理文件命名为**.bat** .. 它们现在是**.cmd** .. 呵呵..

希望这可以帮助。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-08T19:03:27.977

```
rem set defaults:
set filename1="c:\file1.txt"
set filename2="c:\file2.txt"
set filename3="c:\file3.txt"
rem set parameters:
IF NOT "a%1"=="a" (set filename1="%1")
IF NOT "a%2"=="a" (set filename2="%2")
IF NOT "a%3"=="a" (set filename1="%3")
echo %filename1%, %filename2%, %filename3% 
```

但是请注意引号字符，您的变量中可能需要也可能不需要它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-12-05T10:00:33.643

迟到的答案，但目前被接受的答案至少不是最理想的。

使用引号总是比使用任何其他字符括起来更好`%1`。
因为当`%1`包含空格或特殊字符（如`&`）时，`IF [%1] ==`只会因语法错误而停止。

但是对于`%1`包含引号的情况，例如 in `myBatch.bat "my file.txt"`，一个简单的`IF "%1" == ""`会失败。

但是由于您不知道是否使用了引号，因此有语法`%~1`，这会在必要时删除封闭的引号。

因此，代码应如下所示

```
set "file1=%~1"
IF "%~1"=="" set "file1=default file"

type "%file1%"   --- always enclose your variables in quotes 
```

如果您必须处理更奇怪和更讨厌`myBatch.bat "This & will "^&crash`
的参数，请看一下[SO:How to receive even 最奇怪的命令行参数？](https://stackoverflow.com/q/4200316/463115)

# c# - 在 C# 中为通用列表的 FindAll 添加参数

> ID：731337
> 
> 赞同：5
> 
> 时间：2009-04-08T18:49:33.750
> 
> 标签：c#, generics, predicate, findall

我有一个要按整数参数过滤的对象列表

```
List<testObject> objectList = new List<testObject>();

// populate objectList with testObjects

objectList.FindAll(GroupLevel0);

private static bool GroupLevel0(testObject item)
{ return item._groupLevel == 0; }

private class testObject
{
     public string _FieldSQL = null;
     public int _groupLevel;
} 
```

我要做的是让 GroupLevel0 接受一个整数作为参数，而不是硬编码为 0。我在 .NET 2.0 中工作，所以 lambda 表达式是不行的。甚至可以将参数传递给谓词吗？

谢谢，

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T18:51:49.907

如果您坚持使用 C# 2.0，请使用匿名方法 - 只是稍微笨拙的 lambda 表达式（忽略表达式树）：

```
List<testObject> objectList = new List<testObject>();
int desiredGroupLevel = 10;

objectList.FindAll(delegate (testObject item)
{
    return item._groupLevel == desiredGroupLevel;
}); 
```

或者您仍然可以使用方法调用开始：

```
List<testObject> objectList = new List<testObject>();
int desiredGroupLevel = 10;

objectList.FindAll(CheckGroupLevel(desiredGroupLevel));

...

public Predicate<testItem> CheckGroupLevel(int level)
{
    return delegate (testItem item)
    {
        return item._groupLevel == level;
    };
} 
```

但是，如果您使用 Visual Studio 2008 但*面向*.NET 2.0，您仍然可以使用 lambda 表达式。这只是一个不需要框架支持的编译器技巧（同样，忽略表达式树）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:52:10.483

```
 int groupLevel = 0;

  objectList.FindAll(
       delegate(testObject item) 
       { 
          return item._groupLevel == groupLevel; 
       }); 
```

这是一个匿名委托，它关闭了其父级的词法范围，因此它可以看到“groupLevel”。

适用于 C# 2.0 及更高版本。如果您将来迁移到 .NET 3.5，我建议您使用 lambda。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T18:53:08.017

```
List<testObject> objectList = new List<testObject>();

// populate objectList with testObjects

objectList.FindAll(delegate(testObject o){ return GroupLevel(o, 0);} );

private static bool GroupLevel(testObject item, int groupLevel)
{ return item._groupLevel == groupLevel; } 
```

此外，如果您使用 VS 2008，则在编译到 2.0 时仍然可以使用 lambda。它使用带有 2.0 目标的 3.5 编译器，我们已经使用了几个月。

# ant - Ant 的宏定义的默认元素？

> ID：731351
> 
> 赞同：8
> 
> 时间：2009-04-08T18:53:31.213
> 
> 标签：ant

我想这样创建一个宏：

```
<macrodef name="testing">
  <element name="test" implicit="yes"/>
  <sequential>
    <test/>
  </sequential>
</macrodef> 
```

然后使用它：

```
<testing>
  <echo message="hello world"/>
</testing> 
```

但是，我想为隐式元素指定一个默认值......比如：

```
<macrodef name="testing">
  <element name="test" implicit="yes">
    <echo message="hello world"/>
  </element>
  <sequential>
    <test/>
  </sequential>
</macrodef> 
```

所以我可以这样使用它：

```
<testing/> 
```

除了我想更改默认元素的地方。

如果不通过 Java 类定义任务，这可能吗？到目前为止，如果是这样，我还没有看到任何说明如何操作的文档。

* * *

**更新**

我最终通过对文件集使用 refid 解决了我的特定问题（这是我实际上试图拉入元素的内容）。使用 refid，只需使用一个可以具有默认值的 macrodef 属性就很简单。

另一种选择是创建一个使用该元素的新基本宏，然后我可以将现有的宏保留为使用那个宏......但是仍然没有元素的真正默认机制（这会很好）。

所以，西蒙得到了答案，因为他是正确的！谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-10T04:58:50.490

[根据任务](http://ant.apache.org/manual/Tasks/macrodef.html)`element`的嵌套元素文档，这是不可能的。[`macrodef`](http://ant.apache.org/manual/Tasks/macrodef.html)

对于您描述的功能，有[一个 Bugzilla 问题开放](https://issues.apache.org/bugzilla/show_bug.cgi?id=32725)，不幸的是，它自 2004 年以来一直开放。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T19:14:26.717

如果您将宏定义定义为：

```
<macrodef name="testing">
    <element name="additional" optional="true"/>
    <sequential>
        <echo message="hello"/>
        <additional/>
    </sequential>
</macrodef> 
```

以下调用：

```
<target name="testing-call">
    <mylib:testing/>
    <mylib:testing>
        <additional>
            <echo message="world!"/>
        </additional>
    </mylib:testing>
</target> 
```

将输出：

```
[echo] hello
[echo] hello
[echo] world! 
```

# javascript - javascript 跨域 document.getElementById

> ID：731352
> 
> 赞同：0
> 
> 时间：2009-04-08T18:53:32.180
> 
> 标签：javascript, browser

我正在尝试打开 usps 网站上的邮政编码查找页面并使用 javascript 填写表单，但出现以下错误： `'Permission denied to get property Window.document'`

这是我的脚本：

```
function lookupZipCode(line1, line2, city, state, zip) {
  var usps = window.open('http://zip4.usps.com/zip4/welcome.jsp');
  usps.document.getElementById('address2').value = line1;
  usps.document.getElementById('address1').value = line2;
  usps.document.getElementById('city').value = city;
  usps.document.getElementById('state').value = state;
  usps.document.getElementById('zip5').value = zip);
} 
```

我了解这是一项安全功能。理想情况下，我会使用查询字符串参数，但页面似乎不支持它们。

有人对解决方法有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T19:06:41.947

如果您不喜欢 API (;-))，**可以**使用查询字符串参数：http: [//zip4.usps.com/zip4/welcome.jsp ?address1=somethingelse&address2=something&state=FL&city=Miami&zip5=123456789&urbanization =](http://zip4.usps.com/zip4/welcome.jsp?address1=somethingelse&address2=something&state=FL&city=Miami&zip5=123456789&urbanization=)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T18:56:02.737

您应该使用[他们提供的 API，](http://www.usps.com/webtools/?from=zclsearch&page=webtools&WT.z_zip4link=webtools)而不是尝试自动填写表格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:36:31.310

了解您收到的安全错误会很有帮助。这是网络脚本“[同源策略”的结果。](http://en.wikipedia.org/wiki/Same_origin_policy)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T04:38:10.917

我没有使用太多，但您可以使用 Yahoo Query 语言 ( [http://developer.yahoo.com/yql/](http://developer.yahoo.com/yql/) ) 中的 HTML 选择器来获取您需要的部分。然后，您可以将其作为 JSON 传递，您可以获得跨域。

# .net - 将 varbinary 数据从 SQL Server 获取到 C# 字节数组的最快方法是什么？

> ID：731353
> 
> 赞同：0
> 
> 时间：2009-04-08T18:54:02.070
> 
> 标签：.net, sql-server, performance, varbinary

标题不言自明。

我正在处理大小接近 2MB 的文件/数据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T18:59:12.713

[SqlDataReader.GetBytes](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldatareader.getbytes.aspx)应该是您正在寻找的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T19:02:48.010

如果您需要数组中的字节，那么所有方法几乎都是相同的，因为您必须将结果流中的所有字节流式传输到数组中（SqlClient 类将为您执行此操作）。

存储过程或数据库表中的字段是否具有 varbinary 输出参数并不重要，尽管存储过程会稍微快一些，因为您没有关于要返回的结果集的架构信息。但是，与您要返回的数据的大小相比，这可以忽略不计。

如果您真的想要提高性能，最好使用设置了 SequentialAccess 的 DataReader，然后在读取器上为返回的字段调用 GetBytes。通过调用它，您只提取您需要的字节并且可以分块处理数据。

这很重要，因为您在尝试分配大小为 2MB 的字节数组时肯定会遇到问题。一般来说，开始分配**大**的连续内存块（数组就是这样）是一个坏主意，并且会降低性能。在可能的情况下，以较小的块处理数据。

# php - 需要一些关于数据库模式设计的建议

> ID：731358
> 
> 赞同：0
> 
> 时间：2009-04-08T18:54:50.120
> 
> 标签：php, sql, mysql, database, schema

我正在设计一个非常简单（就功能而言）但困难（就可扩展性而言）的系统，用户可以在其中互相发送消息。把它想象成一个非常简单的聊天服务。用户可以通过 php 页面插入消息。消息很短，并有一个收件人姓名。

在另一个 php 页面上，用户可以一次查看所有发送给他的所有消息，然后将它们从数据库中删除。而已。这就是该系统所需的所有功能。我应该如何设计这个（从数据库/php的角度来看）？

到目前为止，我有这样的表：

*   field1 -> 消息（varchar）
*   field2 -> 收件人（varchar）

现在对于 sql insert，我发现无论数据库中的行数如何，它所花费的时间都是恒定的。所以我的 send.php 将有一个很好的保证返回时间。

但是对于下拉消息，随着行数的增加，我的 pull.php 将花费更长的时间！我发现随着行的增长，sql 选择（和删除）将花费更长的时间，即使在我**为收件人字段添加索引之后也是如此。**

现在，如果只是这种情况，用户将不得不等待更长的时间才能将他们的消息拉到 php 上，那么就可以了。但我担心的是，当每个 pull.php 服务时间真的很长时，php 服务器会开始拒绝某些请求的连接。或者更糟糕的是，服务器可能会死掉。

所以问题是，如何设计它以使其可扩展？任何提示/提示？

PS。对数字的一些估计：

*   用户数量从 50,000 开始并不断增加。
*   每个用户平均存储大约 10 条消息，然后另一端可能会将其拉下来。
*   每个用户每天发送大约 10-20 条消息。

* * *

到目前为止阅读答案的更新：

我只是想澄清一下，通过从 pull.php 中提取更少的消息并没有帮助。当表很大时，即使只是拉一条消息也需要很长时间。这是因为该表包含所有消息，因此您必须像这样进行选择：

```
select message from DB where recipient = 'John' 
```

即使您将其更改为此也无济于事

```
select top 1 message from DB where recipient = 'John' 
```

到目前为止，从答案看来，表格越长，选择越慢，O(n) 或稍微好一点，没有办法。如果是这种情况，我应该如何从 php 端处理这个问题？我不希望 php 页面在 http 上失败，因为用户会感到困惑并最终像疯了一样刷新，这使得情况变得更糟。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T19:01:29.837

正如您所建议的那样，为此的数据库设计很简单。只要用户收到更多消息需要更长的时间，您可以做的就是对结果进行分页。显示第一个 10/50/100 或任何有意义的内容，并且只提取那些记录。一般来说，除非消息量增加一个数量级或更多，否则您的时间不应增加太多。您应该能够在不到一秒的时间内拉回 1000 条短消息。现在页面显示可能需要更多时间，但这就是分页应该提供帮助的地方。

我建议尽管仔细考虑未来的功能，并在此基础上再构建你的数据库。向软件添加更多功能很容易，而更改数据库则相对困难。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T19:50:30.017

不要为您的收件人使用**VARCHAR**。最好创建**一个主键为整数的 Recipient 表**（如果您预计人数非常多，则为 bigint）。

然后，当您执行选择语句时：

```
SELECT message FROM DB WHERE recipient = 52; 
```

检索行的速度会快得多。

另外，我相信 MySQL 索引是[B-Trees](http://dev.mysql.com/doc/refman/5.0/en/mysql-indexes.html)，在大多数情况下是 O(log n) 。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T19:36:58.177

1.  遵循规范化规则。尝试达到第三范式。为这种类型的应用程序走得更远可能是不值得的。保持你的桌子薄。
2.  实际上不要删除行，只需使用位标志将它们标记为已删除。如果您确实需要将它们移除以进行某种类型的维护/清理以减小尺寸。将它们标记为已删除，然后创建清理过程以在低使用时间归档或删除记录。
3.  整数值更容易让 SQL 服务器处理字符值。因此，而不是 where recipient = 'John' 使用 WHERE Recipient_ID = 23 当您规范化数据库时，您将获得这种类型的行为。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T20:49:25.677

没有索引的数据库表称为堆，即使使用 'where' 子句，查询堆也会导致对表的每一行进行评估，堆的大 O 表示法是 O(n)，其中 n 是表中的行。添加索引（这实际上取决于数据库引擎的底层方面）会导致在表中查找匹配行的复杂度为 O(log(n))。这是因为索引肯定是以 b 树的方式实现的。向表中添加行，即使存在索引也是 O(1) 操作。

```
 > But for pulling down messages, my pull.php will take longer as the number of rows 
 increase! I find the sql select (and delete) will take longer as the rows grow and
 this is true even after I have added an index for the recipient field. 
```

除非您插入到索引的中间，否则数据库引擎将需要向下移动行以适应。从索引中删除时也会发生同样的情况。请记住，索引不止一种。确保您使用的索引不是聚集索引，因为必须筛选更多数据并通过插入和删除移动。

FlySwat 为您提供了最佳选择……不要使用 RDBMS，因为您的消息在正式意义上不是关系型的。您将从文件系统中获得更好的性能。

dbarker 也给出了正确的答案。我不知道他为什么被投了 3 次，但我会冒着丢分的风险投票给他。dbarker 指的是“垂直分区”，他的建议既可以接受又*很好*。这不是火箭手术的人。

我的建议是不要在您的 RDBMS 中实现这种功能，如果您确实记得选择、更新、插入、删除表中页面上的所有位置锁。如果您确实继续将此功能放入数据库中，那么如果您的平台上可以使用 nolock 锁定提示运行您的选择以增加并发性。此外，如果您有这么多并发用户，请按照 dbarker 的建议对表进行垂直分区，并将这些数据库文件放在单独的驱动器上（不仅是卷，而且是单独的硬件）以增加 I/O 并发性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T19:00:01.947

> 所以问题是，如何设计它以使其可扩展？任何提示/提示？

是的，您不想使用关系数据库进行消息队列。您要做的不是关系数据库最适合设计的东西，虽然您可以做到，但它有点像用螺丝刀钉钉子。

相反，看看那里的许多开源消息队列之一，SecondLife 的人有一个整洁的 wiki，他们在其中审查了很多。

[http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes](http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T19:02:01.083

这是一个不可避免的问题——更多的消息，更多的时间来找到请求的消息。你唯一能做的就是你已经做的——添加一个索引并将 O(n) 查找时间用于完整的表扫描变成 O(log(u) + m) 用于聚集索引查找，其中 n 是数字消息总数，u 用户数，m 每个用户的消息数。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-04-08T19:01:34.627

您总是可以每个用户只有一行，并将消息连接在一起形成一个长记录。如果您要长时间保留消息，那不是最好的方法，但它可以将您的问题减少到存储时的单个查找和连接以及检索时的单个查找。没有更多细节很难说 - 使数据库设计困难的部分原因是以一种折衷的方式满足系统的所有目标。没有所有细节，很难就最佳折衷提供建议。

编辑：我认为我对此很清楚，但显然不是：除非您在阅读者阅读时排空了读者队列，否则您不会这样做。这就是我要求澄清的原因。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-04-08T19:01:40.790

限制您的 pull.php 在任何时候显示的行数。

您传输的数据越多，显示页面所需的时间就越长，无论您的数据库有多好。

你必须在 SQL 中限制你的数据，返回最近的 N 行。

**编辑** 在收件人上放置一个索引，它会加快速度。如果您想获取前 50 个或其他内容，可能需要 SendDate 或自动递增字段，则需要另一列来区分行。聚集索引会减慢插入速度，因此请在此处使用常规索引。

# java - 从 .txt 文件读取和显示数据

> ID：731365
> 
> 赞同：24
> 
> 时间：2009-04-08T18:55:52.223
> 
> 标签：java

您如何读取和显示 .txt 文件中的数据？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-04-08T20:06:12.053

```
BufferedReader in = new BufferedReader(new FileReader("<Filename>")); 
```

然后，您可以使用 in.readLine(); 一次读取一行。要读到最后，请编写一个 while 循环，如下所示：

```
String line;
while((line = in.readLine()) != null)
{
    System.out.println(line);
}
in.close(); 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-08T19:00:39.637

如果您的文件是严格的文本，我更喜欢使用[`java.util.Scanner`](http://java.sun.com/javase/6/docs/api/java/util/Scanner.html)该类。

您可以通过以下方式创建[`Scanner`](http://java.sun.com/javase/6/docs/api/java/util/Scanner.html)文件：

```
Scanner fileIn = new Scanner(new File(thePathToYourFile)); 
```

然后，您可以使用以下方法从文件中读取文本：

```
fileIn.nextLine(); // Reads one line from the file
fileIn.next(); // Reads one word from the file 
```

而且，您可以检查是否还有更多文本：

```
fileIn.hasNext(); // Returns true if there is another word in the file
fileIn.hasNextLine(); // Returns true if there is another line to read from the file 
```

阅读文本并将其保存到 中`String`后，您可以使用以下命令将字符串打印到命令行：

```
System.out.print(aString);
System.out.println(aString); 
```

发布的链接包含 Scanner 类的完整规范。帮助您完成您可能想做的其他事情会很有帮助。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-08T18:58:30.530

一般来说：

*   为文件创建一个`FileInputStream`。
*   创建一个[`InputStreamReader`](http://java.sun.com/javase/6/docs/api/java/io/InputStreamReader.html)包装输入流，指定正确的[编码](http://java.sun.com/javase/6/docs/api/java/nio/charset/Charset.html)
*   [`BufferedReader`](http://java.sun.com/javase/6/docs/api/java/io/BufferedReader.html)可以选择在周围创建一个`InputStreamReader`，这样可以更轻松地一次读取一行。
*   读取直到没有更多数据（例如[`readLine`](http://java.sun.com/javase/6/docs/api/java/io/BufferedReader.html#readLine())返回 null）
*   随时显示数据或将其缓冲以备后用。

如果您需要更多帮助，请在您的问题中更具体。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-08T19:57:16.380

我喜欢这段代码，用它将文件加载到一个字符串中：

```
File file = new File("/my/location");
String contents = new Scanner(file).useDelimiter("\\Z").next(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-07-27T12:25:05.760

下面是您可以尝试使用扫描程序类读取文件并在 java 中显示的代码。代码将从用户那里读取文件名并打印数据（记事本 VIM 文件）。

```
import java.io.*;
import java.util.Scanner;
import java.io.*;

public class TestRead
{
public static void main(String[] input)
{
    String fname;
    Scanner scan = new Scanner(System.in);

    /* enter filename with extension to open and read its content */

    System.out.print("Enter File Name to Open (with extension like file.txt) : ");
    fname = scan.nextLine();

    /* this will reference only one line at a time */

    String line = null;
    try
    {
        /* FileReader reads text files in the default encoding */
        FileReader fileReader = new FileReader(fname);

        /* always wrap the FileReader in BufferedReader */
        BufferedReader bufferedReader = new BufferedReader(fileReader);

        while((line = bufferedReader.readLine()) != null)
        {
            System.out.println(line);
        }

        /* always close the file after use */
        bufferedReader.close();
    }
    catch(IOException ex)
    {
        System.out.println("Error reading file named '" + fname + "'");
    }
} 
```

}

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T19:34:02.490

如果你想采取一些捷径，你可以使用[Apache Commons IO](http://commons.apache.org/io)：

```
import org.apache.commons.io.FileUtils;

String data = FileUtils.readFileToString(new File("..."), "UTF-8");
System.out.println(data); 
```

:-)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-11-16T09:31:52.370

```
public class PassdataintoFile {

    public static void main(String[] args) throws IOException  {
        try {
            PrintWriter pw = new PrintWriter("C:/new/hello.txt", "UTF-8");
            PrintWriter pw1 = new PrintWriter("C:/new/hello.txt");
             pw1.println("Hi chinni");
             pw1.print("your succesfully entered text into file");
             pw1.close();
        } catch (FileNotFoundException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        } catch (UnsupportedEncodingException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        BufferedReader br = new BufferedReader(new FileReader("C:/new/hello.txt"));
           String line;
           while((line = br.readLine())!= null)
           {
               System.out.println(line);
           }
           br.close();
    }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-07-24T07:54:50.990

在 Java 8 中，您可以读取整个文件，只需：

```
public String read(String file) throws IOException {
  return new String(Files.readAllBytes(Paths.get(file)));
} 
```

或者如果它是一个资源：

```
public String read(String file) throws IOException {
  URL url = Resources.getResource(file);
  return Resources.toString(url, Charsets.UTF_8);
} 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-04-08T19:01:23.863

您很可能会想要使用 FileInputStream 类：

```
int character;
StringBuffer buffer = new StringBuffer("");
FileInputStream inputStream = new FileInputStream(new File("/home/jessy/file.txt"));

while( (character = inputStream.read()) != -1)
        buffer.append((char) character);

inputStream.close();
System.out.println(buffer); 
```

您还需要捕获 read() 方法和 FileInputStream 构造函数引发的一些异常，但这些是特定于您的项目的实现细节。

# objective-c - Objective-C 中的空对象模式

> ID：731366
> 
> 赞同：2
> 
> 时间：2009-04-08T18:55:53.830
> 
> 标签：objective-c, design-patterns, oop, null

在 Java 中，很容易编写以下设计代码：

```
public abstract class Pizza {
    public static final Pizza.NULL = new Pizza() {
        /* "null" implementations */
    }

    /* actual/abstract implmentations */
} 
```

在 Objective-C 中实现相同高效场景的首选方法是什么？我一直无法找到有关该主题的任何文档，并且我尝试了几个不同的场景`static const`，`#define`等等，但它们似乎都没有像上面的 Java 方法那样有效。

我想避免编写一个具体的 NullPizza 类，它有一个静态方法来获取单例实例，因为它看起来更“合适”，因为它是最高级别接口的一些最终属性/字段。（比萨，在这种情况下。）

**编辑：**虽然我了解由于 Obj-C 处理对“nil”的方法调用的独特方法，将如何具体处理 NULL 模式，但其他静态常见实例（例如 Response.YES 和 Response.NO）呢？（见评论讨论。）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-08T19:07:31.837

在 Objective-C 中不需要这种类型的模式，因为向类的 nil 实例发送消息不被视为运行时错误。如果该方法具有定义的返回类型，则从消息传递一个 nil 对象定义返回（例如，返回整数的方法在传递一个 nil 对象时返回 0）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T19:10:43.187

这里有两件事可以提供帮助。第一个是`nil`Java NULL 指针的Objective-C 等价物——它实际上可以接收消息并响应它们。`nil`如果返回值是一个对象，并且`0`返回值是某种原始类型，它将始终返回。因此，如果您的对象的 Null 行为是“什么都不做”，您可以轻松地将`nil`其用作 Null 值。

另一件有用的事情是当您需要在容器对象中存储占位符或空值时 - 如果您尝试添加`nil`为值，这些通常会引发异常。相反，您可以使用 singleton `+[NSNull null]`，它除了充当“这个空间故意留空”对象之外什么都不做。

有了这两种武器供您使用，就没有理由编写自定义类的空实例:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T07:15:45.637

我认为没有一种简单的方法可以提供这种实现。您要求在 Objective-C 中实现 Java 的一种语言特性——你可以做到，但你必须自己编写 Java 运行时中的代码——没有什么可以阻止你这样做，但它是不是语言内置的东西。

这有点像在 Cocoa 中询问“如何在 Cocoa 中显示 Windows 风格的‘每个窗口一个菜单’UI”——你可以做到，但它不是从框架中免费提供的。或者，“如何在 Java 中轻松实现 Objective-C 的零指针处理？”

如果你真的想看到这种类型的功能，我认为你应该遵循 NSArray/NSMutableArray 设计模式。声明一个可以处理所有特殊情况的超类：

```
@interface NullPizza : NSObject
{
}
- (BOOL)areYouANullPizza;
@end 
```

然后使用您的真实 Pizza 进行子类化，并包含一个 newNullPizza 类方法（这只是语法糖）：

```
@interface Pizza : NullPizza
{
}

+ (Pizza*)Null;
@end

@implementation Pizza
+ (Pizza*)newNullPizza
{
    return [[NullPizza]alloc init]; // Singleton code left as an exercise.
}

- (BOOL)areYouANullPizza;
{
    return NO;
}
@end 
```

请注意，如果您想`+(Pizza*)NULL`在 Pizza 上实现一个方法，您应该自动释放您创建的新 NullPizza。

免责声明，我将此代码直接输入SO。如果它编译，我会感到惊讶，但你明白了。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-29T10:07:39.893

对于您的 Response.YES 和 Response.NO，我假设您确实有想要更改的实例，而不是仅仅将所有 Response 属性设为只读。

Cocoa 中的一个常见模式是同时拥有一个类的不可变和可变版本（NSArray 与 NSMutableArray）。对于您的响应示例，拥有一个具有静态 YES 和 NO 方法的不可变 Response 类以及在您确实希望对象更改它们的时候公开设置器的 MutableResponse 子类是有意义的。这是否涵盖了您的第二个示例？

# java - 如何读取 WEB-INF 目录中的文件？

> ID：731367
> 
> 赞同：3
> 
> 时间：2009-04-08T18:56:01.677
> 
> 标签：java, tomcat, web-inf

我正在使用 Tomcat 运行 Java Web 应用程序，并且我想读取`Properties`位于我的`WEB-INF`目录中的文件。我怎样才能得到`InputStream`这个`Properties`文件，以便我可以阅读它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T18:59:39.687

`ServletContext.getResource`/ `getResourceAsStream`，IIRC。

# winforms - 主窗体概念？

> ID：731378
> 
> 赞同：1
> 
> 时间：2009-04-08T19:00:26.470
> 
> 标签：winforms, master-pages

像 ASP.NET 中的母版页一样，我们是否对 Windows 窗体应用程序有任何类似的概念。这样我就不必在整个应用程序中多次重复表单的相同部分（页眉和页脚）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T19:02:09.993

创建一个定义所需组件的表单类，并使所有其他表单成为该表单类的子类。

[这是 VB.NET 中的一个很好的例子。](http://msdn.microsoft.com/en-us/magazine/cc301345.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T19:14:28.933

这就是用户控件在 Windows 窗体中的用途。

基本上，您将创建“主”表单，然后将使用“占位符”中的用户控件类型初始化主表单。然后表单将在给定 Type 实例的情况下创建控件并将这些实例添加到 Controls 集合中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T19:13:27.920

您可以使用该类型的每个表单上的控件创建一个基表单类，然后从该基类派生所有实际表单。这称为“视觉继承”，Windows 窗体设计器对此有一些很好的设计时支持。

或者，您也可以考虑使用一个带有页眉和页脚字段的实际表单以及您的个人“页面”所在的大空白面板的概念。使每个页面成为用户控件，并在运行时根据需要将它们换入和换出。例如，这是制作“向导”对话框的标准方式。

# wcf - 带有证书身份验证的 BasicHttpBinding - 错误“禁止”？

> ID：731379
> 
> 赞同：8
> 
> 时间：2009-04-08T19:00:27.797
> 
> 标签：wcf, web-services

我正在尝试使用 BasicHttpBinding 在传输级别使用 SSL 证书相互验证 WCF 服务器和客户端。以下是服务器的创建方式：

```
var soapBinding = new BasicHttpBinding() { Namespace = "http://test.com" };
soapBinding.Security.Mode = BasicHttpSecurityMode.Transport;
soapBinding.Security.Transport.ClientCredentialType =
    HttpClientCredentialType.Certificate;
var sh = new ServiceHost(typeof(Service1), uri);
sh.AddServiceEndpoint(typeof(IService1), soapBinding, "");
sh.Credentials.ServiceCertificate.SetCertificate(
    StoreLocation.LocalMachine, StoreName.My, 
    X509FindType.FindBySubjectName, "localhost");
sh.Open(); 
```

这是客户端：

```
var binding = new BasicHttpBinding();
binding.Security.Mode = BasicHttpSecurityMode.Transport;
var service = new ServiceReference2.Service1Client(binding,
    new EndpointAddress("https://localhost:801/Service1"));

service.ClientCredentials.ClientCertificate.SetCertificate(
    StoreLocation.LocalMachine, StoreName.My, 
    X509FindType.FindBySubjectName, "localhost");

service.ClientCredentials.ServiceCertificate.Authentication.
    CertificateValidationMode =
        System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust;

service.HelloWorld(); 
```

localhost 的证书位于个人、受信任的根和受信任的第 3 方容器中。Internet Explorer 可以连接到主机并查看 WSDL。此外，SSL 调用适用于 ClientCredentialType = HttpClientCredentialType.None

HelloWorld() 失败：

```
System.ServiceModel.Security.MessageSecurityException occurred<br/>
  Message="The HTTP request was forbidden with client authentication
  scheme 'Anonymous'." 
```

这是一个重新抛出的异常：“远程服务器返回错误：（403）禁止。”

一个人如何四处弄清楚 wtf 是怎么回事？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T22:47:06.733

在设置后尝试在客户端中添加它`Security.Mode`：

```
binding.Security.Transport.ClientCredentialType = HttpClientCredentialType.Certificate; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-09-11T09:59:10.550

如果您使用标准生成的代理类，您可以将传输客户端凭据类型设置为`Certificate`in `App.Config`：

```
<binding name="SpoDataServiceSoap">
    <security mode="Transport">
        <transport clientCredentialType="Certificate"></transport>
    </security>
</binding> 
```

C＃

```
var client = new MyServiceSoapClient()
X509Certificate2 cert = CertificateHelper.GetClientCertificate();
client.ClientCredentials.ClientCertificate.Certificate = cert; 
```

# c++ - 为什么我在使用 vfork() 时会出错？

> ID：731403
> 
> 赞同：0
> 
> 时间：2009-04-08T19:07:35.017
> 
> 标签：c++, operating-system, fork

这是我的代码...我不知道为什么我得到一个错误段...有人可以向我解释原因吗？

```
#include <iostream>

#include <string>

// Required by for routine
#include <sys/types.h>
#include <unistd.h>

using namespace std;

int globalVariable = 2;

main()
{
   string sIdentifier;
   int    iStackVariable = 20;

   pid_t pID = vfork();
   if (pID == 0)                // child
   {
      // Code only executed by child process

      sIdentifier = "Child Process: ";
      globalVariable++;
      iStackVariable++;
      cout << "PROCESO NUMERO"<<getpid()<<sIdentifier;
//          printf("Proceso hijo: PID %d - PPID %d\n", getpid(), getppid());
      cout << " Global variable: " << globalVariable;
      cout << " Stack variable: "  << iStackVariable << endl;
      return (0);
    }
    else if (pID < 0)            // failed to fork
    {
        cerr << "Failed to fork" << endl;
        return (1);
        // Throw exception
    }
    else                                   // parent
    {
      // Code only executed by parent process

      sIdentifier = "Parent Process:";
    }

    // executed only by parent

    cout << sIdentifier;
    cout << " Global variable: " << globalVariable;
    cout << " Stack variable: "  << iStackVariable << endl;
    return (0);
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T19:15:11.333

[这个](http://opengroup.org/onlinepubs/007908775/xsh/vfork.html)有用吗？请注意围绕变量修改的注意事项。

> vfork() 函数与 fork() 具有相同的效果，除了如果由 vfork() 创建的进程修改了除用于存储来自 vfork() 的返回值的 pid_t 类型的变量以外的任何数据，则行为未定义，或从调用 vfork() 的函数返回，或在成功调用 _exit() 或 exec 系列函数之一之前调用任何其他函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T19:46:34.753

如果你 vfork() 两个进程共享一个地址空间。如果您要立即在子进程中执行另一个进程，您可能应该只使用 vfork() 。创建系统调用的原因是为了避免复制父进程地址空间中的每个页面的开销，只是为了在子 exec 时丢弃所有这些映射。对于您的情况，请改用 fork() 。

# asp.net - 在 ASP.NET 中使用 MasterPages 时使用 JQuery 的正确方法？

> ID：731407
> 
> 赞同：40
> 
> 时间：2009-04-08T19:08:47.107
> 
> 标签：asp.net, jquery, master-pages, fancybox

在没有母版页的 aspx 页面中使用 JQuery 时我没有问题，但是当我尝试在有母版页的页面中使用它时，它不起作用，所以我最终将 jquery 文件和其他脚本文件放在页面而不是母版。现在，如果我有 10 页，我对所有 10 页都这样做，我知道这是不正确的。在下面的示例母版页中，我将我的脚本文件放在哪里。

```
<html>
<head runat="server">
    <asp:ContentPlaceHolder ID="head" runat="server">
    </asp:ContentPlaceHolder>
</head>
<body>
    <asp:ContentPlaceHolder ID="ContentPanel" runat="server">
    </asp:ContentPlaceHolder>            
</body>
</html> 
```

我最近使用了fancybox插件，我所做的不是将jquery脚本和fancybox脚本放在母版页中，因为我对让它工作感到沮丧，我只是把它放在我希望脚本运行的页面中，特别是在底部，就在关闭 asp:Content 之前。当然，现在我有一个问题，如果我想在其他页面中使用fancybox插件，我会将jquery脚本和fancybox脚本放在所有5个页面上，而不仅仅是母版页。在处理母版页时，使用我上面的示例，一切都在哪里？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-04-08T19:44:22.310

您可以像往常一样在母版页中声明主要的 jQuery 脚本：

```
<head runat="server">
  <link href="/Content/Interlude.css" rel="Stylesheet" type="text/css" />
  <script type="text/javascript" src="/Scripts/jquery-1.3.2.min.js"></script>
  <asp:ContentPlaceHolder ID="head" runat="server">
  </asp:ContentPlaceHolder>
</head> 
```

然后可以在引用 Head ContentPlaceholder 的 Content 控件中加载任何特定于页面的 JS 文件。

但是，更好的选择是查看[ScriptManager](http://msdn.microsoft.com/en-us/library/system.web.ui.scriptmanager.aspx)和[ScriptManagerProxy](http://msdn.microsoft.com/en-us/library/system.web.ui.scriptmanager.aspx)控件——它们可以让您更好地控制 JS 文件提供给客户端的方式。

因此，您将在母版页中放置一个 ScriptManager 控件，并在其中添加对 jQuery 核心代码的引用：

```
<body>
  <form id="form1" runat="server">
    <asp:ScriptManager ID="ScriptManager1" runat="server">
      <Scripts>
        <asp:ScriptReference Path="/Scripts/jquery-1.3.2.min.js" />
      </Scripts>
    </asp:ScriptManager> 
```

然后，在需要一些自定义 JS 文件或 jQuery 插件的页面中，您可以拥有：

```
<asp:Content ID="bodyContent" ContentPlaceholderID="body">
  <asp:ScriptManagerProxy ID="ScriptManagerProxy1" runat="server">
      <Scripts>
        <asp:ScriptReference Path="/Scripts/jquery.fancybox-1.2.1.pack.js" />
      </Scripts>
  </asp:ScriptManagerProxy> 
```

ScriptManager 允许您执行诸如使用[LoadScriptsBeforeUI](http://msdn.microsoft.com/en-us/library/system.web.ui.scriptmanager.loadscriptsbeforeui.aspx)控制页面脚本在何处呈现（或者更好的是，将其设置为 False 之后）之类的操作。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-02-11T01:40:25.623

我使用这种方法。

```
<script type="text/javascript" language="javascript" src='<%=ResolveUrl("~/scripts/jquery.js") %>' ></script> 
```

只需将其放在您的标签上方...

```
<asp:ContentPlaceHolder ID="head" runat="server">
    </asp:ContentPlaceHolder> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T19:19:10.793

好的，为您的脚本使用不同的内容占位符。它应该看起来像这样

```
<script type="text/javascript" src="myscript.js" />
<asp:ContentPlaceHolder ID="ScriptContent" runat="server">

</asp:ContentPlaceHolder> 
```

将此标签放在母版页底部，靠近`</body>`标签。这将允许您在母版页以及您的页面上添加脚本。通过查看页面源代码并确保 HTML 以正确的方式呈现，确保您的脚本以正确的顺序加载。祝你好运。

哦还有一件事，确保 jQuery 和 FancyBox 在您可能拥有的任何其他 js 之前加载，否则它将无法工作。Javascript按调用顺序加载，jQuery必须先加载！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-05-12T01:12:52.617

这将在母版页中起作用：

*对于脚本文件：*

```
<script type="text/javascript" src="<%= ResolveUrl("~/script/scriptFile.min.js") %>"></script> 
```

*对于 CSS 文件：*

```
<link rel="stylesheet" href="~/styles/CssFile.min.css" runat="server" /> 
```

**补充笔记：**

1.  尽可能使用缩小版本 (FileName.min.js) 和 (FileName.min.css) 以减少加载时间并改善 SEO。
2.  将 CSS 放在前面`</head>`，将脚本放在前面，`</body>`以提高性能并改善 SEO。
3.  路径中的平铺字符 (~) 将自动解析为您网站的根目录。
4.  不要忘记`runat="server"`仅用于样式表。该脚本必须没有，`runat="server"`因为它已经使用了服务器操作符`<%= %>`。
5.  您可以使用在线[http://jscompress.com/](http://jscompress.com/)来压缩您的 javascript 和[https://csscompressor.net/](https://csscompressor.net/)来压缩您的 CSS 文件。

# c# - 如何在 MVC 项目中使用 C# 创建 excel 文件并交付到屏幕？

> ID：731408
> 
> 赞同：-1
> 
> 时间：2009-04-08T19:09:12.160
> 
> 标签：c#, asp.net-mvc, excel

如果可以，请发送代码示例，谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T19:40:32.350

Excel 2007 格式可以在没有 Excel 的情况下创建，因为它只是一个包含 XML 文件的 zip 文件，我之前动态生成了 Word 2007 文档，并从没有安装 Word 的网页提供它们。

CodeProject 上有一篇[文章](http://www.codeproject.com/KB/office/ExcelPackage.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T19:20:01.040

我认为您需要对 3d 方表单进行控制。

我找到了有关此问题的下一个主题：

*   [是否有模拟 Excel 功能但不是 Excel 的控件？](https://stackoverflow.com/questions/413538/is-there-a-control-which-emulates-excel-functionality-but-is-not-excel)
*   [生成 HTML 和 Excel 的 ASP.Net Web 服务器控件](https://stackoverflow.com/questions/236185/asp-net-web-server-control-that-generates-html-and-excel)

还有更多的标签`excel`，，，`control`等`asp.net`

我认为最好的实现是非免费的[谷歌：excel+reports+asp.net](http://www.google.ru/search?q=asp.net+excel+reports)有很多解决方案

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T19:57:56.753

如果您不认为它是“一个 excel 文件”并且实际上是指“一个包含我拥有的一些数据的文件，加载了 excel”，那么您所要做的就是创建一个 .csv 并使用 excel 以编程方式打开它。它看起来与“真正的”excel文件相同，主要是有点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-30T00:18:13.823

看看这个：[http ://code.google.com/p/excel-generator/](http://code.google.com/p/excel-generator/)

希望能帮助到你！

# oracle - 如何将所有具有 FK 的表转移到另一个表？

> ID：731413
> 
> 赞同：9
> 
> 时间：2009-04-08T19:10:15.307
> 
> 标签：oracle, foreign-keys

有没有办法通过查询获取所有具有外键的表到 oracle 中的另一个表？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-08T19:20:44.720

这是一篇带有答案[的好文章：](http://www.databasejournal.com/features/oracle/article.php/3665591/Finding-Foreign-Key-Constraints-in-Oracle.htm)

```
select owner,constraint_name,constraint_type,table_name,r_owner,r_constraint_name
from all_constraints 
where constraint_type='R'
and r_constraint_name in (select constraint_name from all_constraints 
where constraint_type in ('P','U') and table_name='TABLE_NAME'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T19:56:24.073

假设父表和子表都在同一个模式中，请执行以下操作：

```
select t1.table_name child_table, t1.constraint_name, t2.table_name parent_table

from user_constraints t1, user_constraints t2

where t1.r_constraint_name = t2.constraint_name 
```

请注意，r_constraint_name 仅针对 FK（类型“R”）约束填充，因此自联接仅返回感兴趣的信息

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-24T06:32:06.890

如果我们知道父键，只需用员工表更改 juan 的答案

```
select *
from user_constraints 
where R_CONSTRAINT_NAME='EMP_EMP_ID_PK'
and constraint_type='R' 
```

# qt - GTK 或 Qt 的图表小部件

> ID：731417
> 
> 赞同：14
> 
> 时间：2009-04-08T19:11:29.470
> 
> 标签：qt, gtk, charts, stocks

是否有 GTK 或 Qt 的小部件可以让我绘制这样的股票图表？

[http://smartquant.com/openquant/openquant_chart.jpg](http://smartquant.com/openquant/openquant_chart.jpg)
（由于盗链限制，复制粘贴网址）

谢谢，乔尔

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T18:07:58.597

Qwt 可以处理它，主要开发人员 Uwe Rathmann 很积极且乐于助人

[http://qwt.sourceforge.net/](http://qwt.sourceforge.net/)

关于财务图表的邮件线程。 [http://sourceforge.net/mailarchive/forum.php?thread_name=78f82c3e0903191242m52567cb8ja2de6a273ed4b8be%40mail.gmail.com&forum_name=qwt-interest](http://sourceforge.net/mailarchive/forum.php?thread_name=78f82c3e0903191242m52567cb8ja2de6a273ed4b8be%40mail.gmail.com&forum_name=qwt-interest)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T19:14:18.747

[GTKGraph](http://gtkgraph.sourceforge.net/)怎么样？或者看看你能不能从[Grism](http://www.grism.org/)中拉出一些东西？作者[写道](http://www.ruby-forum.com/topic/132689)：

> 我使用 GtkDrawingArea 和 Cairo 上下文绘制股票图表。图表没有动画，但是如果您调整图表窗口的大小，图表会自动调整大小（实际上，它会执行重绘）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T19:17:16.307

Qt有[KD 图表](http://www.ics.com/products/qt/kdchart/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-24T10:02:55.363

试试这个：[NightCharts](http://qt-apps.org/content/show.php?content=132560)。

但是你应该记住，它是一个没有任何支持的白手起家的东西，它的开发似乎已经停止了。所以可能有很多错误。

还有一件事情。恕我直言，它在其他 Qt 图表库中绘制了最漂亮的饼图。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T18:14:16.943

Medsphere 提供了他们的图形小部件，但请注意它是在 gtk# 中实现的。

[http://medsphere.org/projects/widgets/wiki/Graph](http://medsphere.org/projects/widgets/wiki/Graph)

# jquery - 运行以下 JQuery 脚本的正确方法？

> ID：731419
> 
> 赞同：2
> 
> 时间：2009-04-08T19:12:14.303
> 
> 标签：jquery, fancybox

我正在使用 FancyBox 插件，当用户单击小图像时，会弹出更大的图像。我看到了使用 1 张图像而不是 2 张图像的代码，所以我认为正确的方法是执行以下操作，我很好奇它是否正确？您是否只是将您希望fancybox 操作的语句元素紧挨着放置。

```
<script type="text/javascript">
    $(document).ready(function() {
        $("a#link1").fancybox();
        $("a#link2").fancybox();
    });
</script> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T19:23:22.250

如果您打算拥有多个希望发生这种情况的链接，您可以只给它们一个类，`fancybox`然后执行以下操作：

```
$(function() {
    $('a.fancybox').fancybox();
}); 
```

这样，每当您有应该是花哨的框的新链接时，您不必给它们唯一的 ID 并返回到 javascript 以确保它们被初始化。每个元素可以有 1 个以上的类，因此它也不会影响现有的类。大多数时候，当您拥有一组东西时，使用类是明智的，这样您就可以在使用 jQuery 操作它们时这样对待它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T19:20:58.433

是的，将要运行的代码放入*就绪*块中是正确的。您可以使用更短的语法

```
<script type="text/javascript">
    $(function() {
        $("a#link1").fancybox();
        $("a#link2").fancybox(); 
    });
</script> 
```

这完全一样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T19:13:50.213

是的，看起来不错。

# linux - Linux 上 _emit 的等价物是什么？

> ID：731428
> 
> 赞同：8
> 
> 时间：2009-04-08T19:14:52.753
> 
> 标签：linux, gcc, assembly

我正在尝试将一些用 Visual Studio 编写的汇编代码移植到 Linux 上的 GNU 内联汇编中。原始代码使用[_emit](http://msdn.microsoft.com/en-us/library/1b80826t.aspx)，MSDN 将其描述为伪指令并解释为：

> _emit 伪指令类似于 MASM 的 DB 指令。您使用 _emit 在当前文本段的当前位置定义单个立即字节。但是，_emit 一次只能定义一个字节，并且只能定义文本段中的字节。它使用与 INT 指令相同的语法。

我怎样才能在 Linux 上做同样的事情？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-08T19:37:30.687

要发出字节 0x12（例如），请执行以下操作：

```
asm __volatile__ (".byte 0x12"); 
```

虽然，启用优化后您可能会得到令人惊讶的结果。

# asp.net-mvc - ASP.NET MVC - 如何处理应用程序的全局设置

> ID：731431
> 
> 赞同：2
> 
> 时间：2009-04-08T19:15:30.443
> 
> 标签：asp.net-mvc

假设每个用户都有特定的偏好，这些偏好保存在该用户的数据库中。例如：*UnitSystem*、*UILanguage*、*TimeZone*、...

当发出 http 请求时，我们需要访问用户首选项（例如*UnitSystem*、*TimeZone*等）以正确处理数据并以正确的*语言*呈现视图。

在程序执行期间保存/访问用户首选项的正确方法是什么？

1.  从数据库中读取每个 http 请求的用户首选项
2.  当用户登录应用程序时读取用户首选项并将其保存在会话变量中。
3.  当用户登录应用程序时读取用户首选项并将其保存在 cookie 中。

您如何处理基于 MVC 的应用程序中的全局设置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T19:20:33.987

在您的情况下，我可能会将设置存储在会话和 cookie 中，并按以下顺序检查它们：

1.  检查会话中的变量。
2.  如果不在会话中，请检查 cookie 并将 cookie 值存储在会话中。
3.  如果不在 cookie 中，请检查数据库并存储在 cookie 和 session 中。

这样，您应该能够非常透明地处理会话超时和关闭 cookie 的用户，同时仅在绝对必要时才通过访问数据库来最大化性能。

当然，如果用户在数据库中更改了他们的偏好，您还需要一些机制来更新 cookie 和会话。假设这些偏好设置在同一个应用程序中，那应该没什么大不了的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T19:24:26.180

这就是 ASP.NET 中配置文件提供程序的用途。查看 MSDN 文档中标题为“ASP.NET Profile Properties Overview”的部分，该部分位于：

[http://msdn.microsoft.com/en-us/library/2y3fs9xs.aspx](http://msdn.microsoft.com/en-us/library/2y3fs9xs.aspx)

然后，您可以创建自己的配置文件提供程序（如果提供的其中一个不适合您的需要），它将加载/保存配置文件数据。

# c# - 创建其构造函数需要参数的泛型类型的实例？

> ID：731452
> 
> 赞同：282
> 
> 时间：2009-04-08T19:26:06.550
> 
> 标签：c#, .net, generics

如果`BaseFruit`有一个接受 的构造函数，`int weight`我可以用这样的通用方法实例化一块水果吗？

```
public void AddFruit<T>()where T: BaseFruit{
    BaseFruit fruit = new T(weight); /*new Apple(150);*/
    fruit.Enlist(fruitManager);
} 
```

注释后面添加了一个示例。`BaseFruit`如果我给出一个无参数的构造函数然后通过成员变量填写所有内容，我似乎只能这样做。在我的真实代码（不是关于水果）中，这是相当不切实际的。

**-更新-**
所以它似乎无法以任何方式通过约束来解决。从答案中有三个候选解决方案：

*   工厂模式
*   反射
*   活化剂

我倾向于认为反射是最不干净的，但我无法在其他两个之间做出决定。

* * *

## 回答 #1

> 赞同：421
> 
> 时间：2009-04-08T20:16:50.267

另外一个更简单的例子：

```
return (T)Activator.CreateInstance(typeof(T), new object[] { weight }); 
```

请注意，在 T 上使用 new() 约束只是为了让编译器在编译时检查公共无参数构造函数，用于创建类型的实际代码是 Activator 类。

您需要确保自己了解现有的特定构造函数，并且这种要求可能是代码异味（或者更确切地说，您应该在 c# 的当前版本中尽量避免）。

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2009-04-08T19:28:32.440

您不能使用任何参数化构造函数。如果您有“ `where T : new()`”约束，则可以使用无参数构造函数。

这是一种痛苦，但生活就是这样:(

这是我想用[“静态接口”](http://codeblog.jonskeet.uk/2008/08/29/lessons-learned-from-protocol-buffers-part-4-static-interfaces.aspx)解决的问题之一。然后，您可以约束 T 以包含静态方法、运算符和构造函数，然后调用它们。

* * *

## 回答 #3

> 赞同：73
> 
> 时间：2009-04-08T19:28:22.550

是的; 改变你的位置：

```
where T:BaseFruit, new() 
```

但是，这只适用于*无参数*构造函数。你必须有一些其他的方法来设置你的属性（设置属性本身或类似的东西）。

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2013-03-14T12:00:20.617

最简单的解决方案 `Activator.CreateInstance<T>()`

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-04-08T19:32:43.147

正如 Jon 指出的那样，这是约束非无参数构造函数的生命。然而，另一种解决方案是使用工厂模式。这很容易约束

```
interface IFruitFactory<T> where T : BaseFruit {
  T Create(int weight);
}

public void AddFruit<T>( IFruitFactory<T> factory ) where T: BaseFruit {    
  BaseFruit fruit = factory.Create(weight); /*new Apple(150);*/    
  fruit.Enlist(fruitManager);
} 
```

另一种选择是使用功能方法。传入工厂方法。

```
public void AddFruit<T>(Func<int,T> factoryDel) where T : BaseFruit { 
  BaseFruit fruit = factoryDel(weight); /* new Apple(150); */
  fruit.Enlist(fruitManager);
} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-04-08T19:54:08.777

您可以通过使用反射来做到：

```
public void AddFruit<T>()where T: BaseFruit
{
  ConstructorInfo constructor = typeof(T).GetConstructor(new Type[] { typeof(int) });
  if (constructor == null)
  {
    throw new InvalidOperationException("Type " + typeof(T).Name + " does not contain an appropriate constructor");
  }
  BaseFruit fruit = constructor.Invoke(new object[] { (int)150 }) as BaseFruit;
  fruit.Enlist(fruitManager);
} 
```

**编辑：**添加了构造函数 == null 检查。

**编辑：**使用缓存的更快变体：

```
public void AddFruit<T>()where T: BaseFruit
{
  var constructor = FruitCompany<T>.constructor;
  if (constructor == null)
  {
    throw new InvalidOperationException("Type " + typeof(T).Name + " does not contain an appropriate constructor");
  }
  var fruit = constructor.Invoke(new object[] { (int)150 }) as BaseFruit;
  fruit.Enlist(fruitManager);
}
private static class FruitCompany<T>
{
  public static readonly ConstructorInfo constructor = typeof(T).GetConstructor(new Type[] { typeof(int) });
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2018-12-11T12:58:34.093

作为对 user1471935 建议的补充：

要通过使用带有一个或多个参数的构造函数来实例化泛型类，您现在可以使用 Activator 类。

```
T instance = Activator.CreateInstance(typeof(T), new object[] {...}) 
```

对象列表是您要提供的参数。[根据微软](https://docs.microsoft.com/en-us/dotnet/api/system.activator.createinstance?view=netframework-4.7.2)：

> CreateInstance [...] 使用与指定参数最匹配的构造函数创建指定类型的实例。

CreateInstance ( ) 还有一个通用版本，`CreateInstance<T>()`但它也不允许您提供构造函数参数。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-01-08T16:31:31.553

我创建了这个方法：

```
public static V ConvertParentObjToChildObj<T,V> (T obj) where V : new()
{
    Type typeT = typeof(T);
    PropertyInfo[] propertiesT = typeT.GetProperties();
    V newV = new V();
    foreach (var propT in propertiesT)
    {
        var nomePropT = propT.Name;
        var valuePropT = propT.GetValue(obj, null);

        Type typeV = typeof(V);
        PropertyInfo[] propertiesV = typeV.GetProperties();
        foreach (var propV in propertiesV)
        {
            var nomePropV = propV.Name;
            if(nomePropT == nomePropV)
            {
                propV.SetValue(newV, valuePropT);
                break;
            }
        }
    }
    return newV;
} 
```

我以这种方式使用它：

```
public class A 
{
    public int PROP1 {get; set;}
}

public class B : A
{
    public int PROP2 {get; set;}
} 
```

代码：

```
A instanceA = new A();
instanceA.PROP1 = 1;

B instanceB = new B();
instanceB = ConvertParentObjToChildObj<A,B>(instanceA); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-10-05T18:46:18.600

您可以使用以下命令：

```
 T instance = (T)typeof(T).GetConstructor(new Type[0]).Invoke(new object[0]); 
```

请务必查看以下 [参考资料](https://docs.microsoft.com/en-us/dotnet/api/system.type.getconstructor?view=netcore-3.1)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-05-25T16:03:32.200

最近我遇到了一个非常相似的问题。只是想与大家分享我们的解决方案。我想`Car<CarA>`从一个 json 对象创建一个实例，使用它有一个枚举：

```
Dictionary<MyEnum, Type> mapper = new Dictionary<MyEnum, Type>();

mapper.Add(1, typeof(CarA));
mapper.Add(2, typeof(BarB)); 

public class Car<T> where T : class
{       
    public T Detail { get; set; }
    public Car(T data)
    {
       Detail = data;
    }
}
public class CarA
{  
    public int PropA { get; set; }
    public CarA(){}
}
public class CarB
{
    public int PropB { get; set; }
    public CarB(){}
}

var jsonObj = {"Type":"1","PropA":"10"}
MyEnum t = GetTypeOfCar(jsonObj);
Type objectT = mapper[t]
Type genericType = typeof(Car<>);
Type carTypeWithGenerics = genericType.MakeGenericType(objectT);
Activator.CreateInstance(carTypeWithGenerics , new Object[] { JsonConvert.DeserializeObject(jsonObj, objectT) }); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-04-22T14:03:28.073

如果您愿意使用 ac# 预编译器，您可以解决此问题，使其具有编译时间限制：

```
 // Used attribute
 [AttributeUsage(AttributeTargets.Parameter)]
 class ResolvedAsAttribute : Attribute
 {
    public string Expression;
    public ResolvedAsAttribute(string expression)
    {
        this.Expression = expression;
    }
 }

// Fruit manager source:
class FruitManager {

    ...

    public void AddFruit<TFruit>([ResolvedAs("(int p) => new TFruit(p)")] Func<int,TFruit> ctor = null)where TFruit: BaseFruit{
        BaseFruit fruit = ctor(weight); /*new Apple(150);*/
        fruit.Enlist(fruitManager);
    }
}

// Fruit user source:
#ResolveInclude ../Managers/FruitManager.cs
...
fruitManager.AddFruit<Apple>();
... 
```

然后，您的预编译器会将 Fruit 用户源代码转换为：

```
...
fruitManager.AddFruit<Apple>((int p) => new Apple(p));
... 
```

使用 Roslyn，您的预编译器可能看起来像这样（这里有改进的空间）：

```
 using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Text;
    using Microsoft.CodeAnalysis;
    using Microsoft.CodeAnalysis.CSharp;
    using Microsoft.CodeAnalysis.CSharp.Syntax;
    using Microsoft.CodeAnalysis.CSharp.Symbols;
    using System.Threading;
    using System.Text.RegularExpressions;

    public class CsResolveIncludeAnalyser : CSharpSyntaxWalker
    {
        private List<(string key, MethodDeclarationSyntax node)> methodsToResolve = new List<(string key, MethodDeclarationSyntax node)>();
        public List<(string key, MethodDeclarationSyntax node)> Analyse(string source)
        {
            var tree = CSharpSyntaxTree.ParseText(source);
            var syntaxRoot = tree.GetRoot();
            Visit(tree.GetRoot());
            return methodsToResolve;
        }

        public override void VisitMethodDeclaration(MethodDeclarationSyntax methodDeclaration)
        {
            base.VisitMethodDeclaration(methodDeclaration);

            if (methodDeclaration.ParameterList.Parameters.Count > 0)
            {
                foreach (var parm in methodDeclaration.ParameterList.Parameters)
                {
                    var parmHasResolvedAs = parm.AttributeLists.Where((el) => el.Attributes.Where((attr) => attr.Name is IdentifierNameSyntax && ((IdentifierNameSyntax)attr.Name).Identifier.Text.Contains("ResolvedAs")).Any()).Any();
                    if (parmHasResolvedAs)
                    {
                        var name = methodDeclaration.Identifier.ValueText;
                        methodsToResolve.Add((name, methodDeclaration));
                        return;
                    }
                }
            }
        }
    }

    public class CsSwiftRewriter : CSharpSyntaxRewriter
    {
        private string currentFileName;
        private bool withWin32ErrorHandling;
        private Dictionary<string,MethodDeclarationSyntax> methodsToResolve = new Dictionary<string, MethodDeclarationSyntax>();

        private Dictionary<string, MethodDeclarationSyntax> getMethodsToResolve(string source, string fileName)
        {
            Dictionary<string, MethodDeclarationSyntax> methodsToResolve = new Dictionary<string, MethodDeclarationSyntax>();

            var path = Path.GetDirectoryName(fileName);
            var lines = source.Split(new[] { '\r', '\n' });
            var resolveIncludes = (from el in lines where el.StartsWith("#ResolveInclude") select el.Substring("#ResolveInclude".Length).Trim()).ToList();

            var analyser = new CsResolveIncludeAnalyser();
            foreach (var resolveInclude in resolveIncludes)
            {
                var src = File.ReadAllText(path + "/" + resolveInclude);
                var list = analyser.Analyse(src);
                foreach (var el in list)
                {
                    methodsToResolve.Add(el.key, el.node);
                }
            }

            return methodsToResolve;
        }
        public static string Convert(string source, string fileName)
        {
            return Convert(source, fileName, false);
        }

        public static string Convert(string source, string fileName, bool isWithWin32ErrorHandling)
        {

            var rewriter = new CsSwiftRewriter() { currentFileName = fileName, withWin32ErrorHandling = isWithWin32ErrorHandling };
            rewriter.methodsToResolve = rewriter.getMethodsToResolve(source, fileName);

            var resolveIncludeRegex = new Regex(@"(\#ResolveInclude)\b");
            source = resolveIncludeRegex.Replace(source, "//$1");

            var tree = CSharpSyntaxTree.ParseText(source);
            var syntaxRoot = tree.GetRoot();
            var result = rewriter.Visit(tree.GetRoot());
            return "#line 1 \"" + Path.GetFileName(fileName) + "\"\r\n" + result.ToFullString();
        }

        internal List<string> transformGenericArguments(List<string> arguments, GenericNameSyntax gName, TypeParameterListSyntax typeParameterList)
        {
            var res = new List<string>();
            var typeParameters = typeParameterList.ChildNodes().ToList();

            foreach (var argument in arguments)
            {
                var arg = argument;
                for (int i = 0; i < gName.TypeArgumentList.Arguments.Count; i++)
                {
                    var key = typeParameters[i];
                    var replacement = gName.TypeArgumentList.Arguments[i].ToString();
                    var regex = new System.Text.RegularExpressions.Regex($@"\b{key}\b");
                    arg = regex.Replace(arg, replacement);
                }
                res.Add(arg);
            }

            return res;
        }

        const string prefix = "";
        internal List<string> extractExtraArguments(MethodDeclarationSyntax methodDeclaration)
        {
            var res = new List<String>();

            foreach (var parm in methodDeclaration.ParameterList.Parameters)
            {
                foreach (var attrList in parm.AttributeLists)
                {
                    foreach (var attr in attrList.Attributes)
                    {
                        if (attr.Name is IdentifierNameSyntax && string.Compare(((IdentifierNameSyntax)attr.Name).Identifier.Text, "ResolvedAs") == 0)
                        {
                            var programmCode = attr.ArgumentList.Arguments.First().ToString().Trim();
                            var trimmedProgrammCode = (programmCode.Length >= 2 && programmCode[0] == '"' && programmCode[programmCode.Length - 1] == '"') ? programmCode.Substring(1, programmCode.Length - 2) : programmCode;
                            res.Add(prefix + parm.Identifier.Text + ":" + trimmedProgrammCode);
                        }
                    }
                }
            }
            return res;
        }

        internal List<string> extractExtraArguments(MethodDeclarationSyntax methodDeclaration, SimpleNameSyntax name)
        {
            var arguments = extractExtraArguments(methodDeclaration);
            if (name != null && name is GenericNameSyntax)
            {
                var gName = name as GenericNameSyntax;
                return transformGenericArguments(arguments, gName, methodDeclaration.TypeParameterList);
            }

            return arguments;
        }

        public override SyntaxNode VisitInvocationExpression(InvocationExpressionSyntax c_expressionStatement)
        {
            InvocationExpressionSyntax expressionStatement = (InvocationExpressionSyntax) base.VisitInvocationExpression(c_expressionStatement);

            List<string> addedArguments = null;
            switch (expressionStatement.Expression)
            {
                case MemberAccessExpressionSyntax exp:
                    if (methodsToResolve.ContainsKey(exp.Name?.Identifier.ValueText))
                    {
                        addedArguments = extractExtraArguments(methodsToResolve[exp.Name.Identifier.ValueText], exp.Name);
                    }
                    break;
                case GenericNameSyntax gName:
                    if (methodsToResolve.ContainsKey(gName.Identifier.ValueText))
                    {
                        addedArguments = extractExtraArguments(methodsToResolve[gName.Identifier.ValueText], gName);
                    }
                    break;
                default:
                    var name = (from el in expressionStatement.ChildNodes()
                                where el is GenericNameSyntax
                                select (el as GenericNameSyntax)).FirstOrDefault();
                    if (name != default(GenericNameSyntax))
                    {
                        if (methodsToResolve.ContainsKey(name.Identifier.ValueText))
                        {
                            addedArguments = extractExtraArguments(methodsToResolve[name.Identifier.ValueText], name);
                        }
                    }
                    break;
            }

            if (addedArguments?.Count > 0)
            {
                var addedArgumentsString = string.Join(",", addedArguments);
                var args = expressionStatement.ArgumentList.ToFullString();
                var paras = $"({(expressionStatement.ArgumentList.Arguments.Count > 0 ? string.Join(",", args.Substring(1,args.Length - 2), addedArgumentsString) : addedArgumentsString)})" ;
                var argList = SyntaxFactory.ParseArgumentList(paras);
                return expressionStatement.WithArgumentList(argList);
            }

            return expressionStatement;
        }
    } 
```

可以使用 T4 脚本调用预编译器，可选择在编译时重新生成源代码。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2017-01-28T14:46:37.390

通过执行以下操作，仍然可以实现高性能：

```
 //
    public List<R> GetAllItems<R>() where R : IBaseRO, new() {
        var list = new List<R>();
        using ( var wl = new ReaderLock<T>( this ) ) {
            foreach ( var bo in this.items ) {
                T t = bo.Value.Data as T;
                R r = new R();
                r.Initialize( t );
                list.Add( r );
            }
        }
        return list;
    } 
```

和

```
 //
///<summary>Base class for read-only objects</summary>
public partial interface IBaseRO  {
    void Initialize( IDTO dto );
    void Initialize( object value );
} 
```

然后相关的类必须从这个接口派生并相应地初始化。请注意，在我的情况下，此代码是周围类的一部分，它已经将 <T> 作为通用参数。在我的情况下，R 也是一个只读类。IMO，Initialize() 函数的公共可用性对不变性没有负面影响。此类的用户可以放入另一个对象，但这不会修改底层集合。

# asp.net - UpdatePanel - 关于如何避免 UI 闪烁的任何想法？- ASP.NET/Jquery

> ID：731455
> 
> 赞同：3
> 
> 时间：2009-04-08T19:26:31.290
> 
> 标签：asp.net, javascript, jquery, user-interface

我有一个相当复杂的用户界面。但是，出于这个问题的目的，假设有一个 HTML 表默认呈现 UILayout1（比如默认模式）。用户可以使用一个按钮在默认模式和预览模式之间切换（UILayout2）

在预览模式下，表格中的某些列是不可见的，并且行会重新排序。我在加载时使用 JS (jquery) 来检查模式并相应地更改它。

表格和切换按钮位于 UpdatePanels 中。

从功能上讲，一切都按预期工作。但是，当用户在默认模式和预览模式之间切换或反之亦然时，表格默认呈现，然后 JS 运行进行更改的时间间隔很短。

这会导致 UI 体验下降。有没有什么创造性的方法可以避免这种“闪烁”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T23:55:34.530

您可以在 UI 生成中使用 DIV 或不使用更新面板使用任何其他概念

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T23:56:09.817

问题很可能是您的代码在加载时运行。我假设您正在使用标准 jQuery 方法在加载时运行代码，而不是使用窗口的 onload 事件。在任何情况下，如果您要加载许多其他 javascript 文件，即使使用 jQuerys`$(document).ready(...)`也会太慢，因为在所有 javascript 包含加载之前，不会在文档上触发 .ready 事件。

您应该能够通过在页面中的表格的html之后包含修改表格的代码并且不在加载时运行它来解决该问题，即确保您不将其包装在`$(document).ready(...);`

要使这种方法起作用，您需要拥有修改页面前面包含的表的代码所需的所有 javascript。

如果您包含其他非必要的 javascript 文件，您应该稍后尝试在页面中包含它们。

我不能 100% 确定在更新面板中会如何影响它 - 您需要确保在更新面板更新时重新触发您的代码，但我相信这一切都应该自动发生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:12:22.763

大概你的 UI 是由 CSS 控制的？您可以通过在 JavaScript 开头或 HTML 的 <head> 中添加类似这样的内容来消除闪烁：

```
if (previewMode) {
    document.documentElement.className = 'preview';
} 
```

然后，如果您修改适用于预览模式的 CSS 规则，以将具有 class="preview" 的 HTML 元素反映为：

```
.preview table .defaultMode {
    display:none;
} 
```

希望您的表格第一次应该正确渲染，并且不需要重新绘制。

# mysql - 使用 Mysql 转换日期

> ID：731456
> 
> 赞同：6
> 
> 时间：2009-04-08T19:27:36.653
> 
> 标签：mysql, datetime

我有这种格式的日期

2006 年 5 月 30 日上午 12:00

mysql 中是否有等效的 strtotime() 可以让我将其转换为 mysql 日期？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-08T19:29:30.863

我认为您正在寻找该[`STR_TO_DATE`](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_str-to-date)功能。不幸的是，它不如 PHP 的那么棒`strtotime`，所以你必须给它一个格式掩码来解析：

```
mysql> SELECT STR_TO_DATE('04/31/2004', '%m/%d/%Y');
        -> '2004-04-31' 
```

对于您的日期，我认为掩码是`%M %e %Y %l:%i%p`，这取决于您是否期望短/长月份名称和基于 0 的天数。根据您的示例，它可能是：

```
mysql> SELECT STR_TO_DATE('May 30 2006 12:00AM', '%M %e %Y %l:%i%p');
+--------------------------------------------------------+
| STR_TO_DATE('May 30 2006 12:00AM', '%M %e %Y %l:%i%p') |
+--------------------------------------------------------+
| 2006-05-30 00:00:00                                    |
+--------------------------------------------------------+
1 row in set (0.00 sec) 
```

查看面罩选项的[完整参考表](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_date-format)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T19:31:40.920

您可以使用 STR_TO_DATE ( [http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_str-to-date](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_str-to-date) )。

格式应该是这样的：

```
"%b %d %Y %l:%i%p" 
```

# c# - 如何检查空的 Gridview

> ID：731461
> 
> 赞同：16
> 
> 时间：2009-04-08T19:28:28.383
> 
> 标签：c#, asp.net, gridview, null

我有一个 ASP.NET 2.0 (C#) Web 应用程序，其中我有一个从 oracle 数据库获取数据的 gridview。

我想知道如何检查gridview是否为空，然后做点什么。

我已经尝试过：

```
if(GridView.Rows.Count == 0)
{
// Do Something
} 
```

但它不起作用......

有任何想法吗？

谢谢你。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-08T19:36:27.147

您的代码*应该可以*工作。但只有在调用 GridView.DataBind() 之后。一般来说，我不检查 GridView 它是自己的，而是检查网格视图的数据源。

```
DataTable data = DAL.getdata();
if (data.Rows.Count == 0)
{
    ShowEmptyData();
}
else
{
    Grid.DataSource = dt;
    Grid.DataBind();
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-08T19:34:34.627

这不起作用，因为它`GridView`是数据绑定的，并且将在稍后呈现页面时获取实际数据。您应该通过直接查询网格视图的数据绑定源来检查这一点（查看网格视图绑定到的实际列表是否为空）。

如果你只是想在空的时候显示一些东西，你应该`<EmptyDataTemplate>`在你的标记中使用：

```
<asp:GridView runat="server">
<EmptyDataTemplate>The grid is empty</EmptyDataTemplate>
</asp:GridView> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-08T19:38:40.577

我同意其他回答。我想补充一点信息，你应该在 databind 方法之后得到 rows.count ：

```
int rowCount = GridView.Rows.Count; // returns zero

GridView.DataBind();

rowCount = GridView.Rows.Count; // returns actual row count 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T19:34:14.487

如果您使用数据绑定，则数据源的行数不是网格本身的计数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-07-04T07:20:18.160

它非常简单：希望它对你有用.. :)

使用 GridView DataBound 的事件：绑定数据后触发。

```
 protected void GridView1_DataBound(object sender, EventArgs e)
 {
     int rowCount = GridView1.Rows.Count;

     if (rowCount == 0)
     {
         GridView1.Visible = false;                
     }
     else
     {
        GridView1.Visible = true;
     }

 } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-03-20T19:21:06.447

首先创建一个助手类。

```
public static class GridViewExtensions
{
    public static IEnumerable<GridViewRow> AsEnumerable(this GridView grid)
    {
        foreach (GridViewRow row in grid.Rows)
        {
            yield return row;
        }
    }

    public static bool IsEmpty(this GridView grid)
    {
        return !grid.AsEnumerable().Any(t => t.RowType == DataControlRowType.DataRow);
    }
} 
```

然后只需调用 IsEmpty

```
GridView1.IsEmpty() 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-10-31T20:31:21.413

如果您已将 GV 配置为自动从 DB 获取数据，则可以在 Source 模式下添加以下行作为 GV 的第一条语句：

```
<EmptyDataTemplate>No data found.</EmptyDataTemplate> 
```

然后继续使用 GV 中的正常代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-03-24T01:42:24.403

已经基于答案`GridView.Rows.Count`，根据您的性质，它本身是不够的`GridView`，特别是如果它是一个动态 gv，在大多数情况下它是，而且您必须考虑`Paginating`，页眉和页脚，这会改变行数。

我用一个简单的方法告诉我...

```
//checks if a gridview has any actual rows of data (not just blank rows filled in by the Load
protected bool gvNoData(GridView gv)
{
    int wsDataRow = 0;
    foreach (GridViewRow gvRow in gv.Rows)
        if (gvRow.RowType == DataControlRowType.DataRow)
        {
            HiddenField hf = (HiddenField)gvRow.FindControl("hfStudentID");
            if (hf != null)
                if (hf.Value.ToString().Length > 0)
                    wsDataRow +=1;
        }

    //if a count was generated then there are data rows, otherwise the rows are blank or nonexistant
    if (wsDataRow > 0) return false;
    else return true;
} 
```

所以运行这样的东西会告诉你这些行是否真的是“数据”行，或者是空的还是什么都没有！

显然，在我的情况下，我有一个 HiddenField 来告诉我 GridViewRow 是否是实际的数据行，因为我用空白行（出于我的目的）和一些数据行预填充了我的 gridview。

但是，基于 DataRow 与 HeaderRow 等检查的更简单版本...

```
 foreach (GridViewRow gvRow in myGridView.Rows)
            if (gvRow.RowType == DataControlRowType.DataRow)
            {
//do what you need
            } 
```

我希望这有帮助。

简而言之，遗憾的是没有 GridView.IsEmpty() 函数，除非您枚举一个，如下所示。

# javascript - 在网络上获取 Python 脚本输出的最简单方法是什么？

> ID：731470
> 
> 赞同：7
> 
> 时间：2009-04-08T19:31:04.930
> 
> 标签：javascript, python

我有一个连续运行的 python 脚本。它每 30 秒输出 2 行信息。我希望能够在网络上查看此输出。特别是，我希望站点自动更新（每 30 秒在页面/站点顶部添加新输出，而无需刷新页面）。

我知道我可以使用 javascript 来做到这一点，但是否有仅基于 python 的解决方案？即使有，javascript是要走的路吗？如果需要，我非常愿意学习 javascript，但如果没有，我想继续专注于 python。

很抱歉这个基本问题，但在网络编程方面我仍然一无所知。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T20:20:40.223

这个问题似乎有两件事。

1.  在网络上演示。这在 Python 中很容易做到——使用 Django 或 TurboGears 或任何基于 Python 的 Web 框架。

2.  刷新网页以显示新数据。这可以通过两种方式完成。

    *   一些花哨的 Javascript 来刷新。

    *   一些花哨的 HTML 来刷新页面。元[刷新](http://webdesign.about.com/od/metataglibraries/a/aa080300a.htm)标签是你想要的。如果你这样做，你就有了一个全 Python 的解决方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T20:46:33.127

如果您想要一种非常简单的方法将数据从 Python 脚本打印到网页并自动更新，您可以从脚本中打印。例如，将 Apache 与以下 Python CGI 脚本一起使用：

```
#!/usr/bin/python 

import time
import sys
import random

def write(inline=''):
    sys.stdout.write(inline)
    sys.stdout.write('\r\n')
    sys.stdout.flush()

#prints out random digits between 1 and 1000 indefinitely
write("Content-type: text/html\r\n")
i = 0
while(True):
    i = i + 1
    time.sleep(1)
    write(str(i) + "<br />") 
```

如果我在浏览器中导航到它（Firefox，不知道其他浏览器在缓冲等方面的工作方式是否不同），它会不断打印数字。请注意，它按顺序打印，因此较新的数据位于底部而不是顶部，但它可能会根据您要执行的操作而起作用。

如果这不是您真正想要的，那么唯一的其他方法是自动刷新页面（在 iframe 或整个页面中）或使用 javascript 来获取数据。

您可以在 iframe 或页面 HTML 源代码中使用元刷新标记，并且您的 CGI 可以在每次刷新时打印新数据。或者，您可以使用带有 XMLHTTPRequest 的 javascript 来读取新数据，而无需刷新可视页面。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T20:02:13.343

您可以使用[Comet](http://en.wikipedia.org/wiki/Comet_(programming))，但我强烈建议您不要这样做。我只想写一个简短的 Javascript，使用[jQuery](http://jquery.com)这真的很简单。

另一种可能性是使用每 30 秒重新加载一次的 iframe，这将阻止整个页面重新加载。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T20:11:31.587

如果你想完全用 python 来做，你可以使用[pajamas](http://pyjs.org/)。

它直接从 python 代码生成 javascript，因此您完全避免自己编写 javascript。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T19:33:24.300

您需要以一种或另一种方式使用 Javascript 来进行 30 秒的刷新。或者，您可以设置每 30 秒刷新一次元标记以重定向到当前页面，但 Javascript 路由将防止页面闪烁。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T20:35:43.480

将您的输出写入日志文件，然后通过 Web 服务器将日志文件加载到浏览器。如果您需要自动刷新，请创建一个带有标签的模板 HTML 文件以每 15 秒刷新一次：

```
<META HTTP-EQUIV="refresh" CONTENT="15"> 
```

并使用[服务器端包含](http://en.wikipedia.org/wiki/Server_Side_Includes)在页面上包含日志文件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T21:06:22.783

也许您正在寻找[“长轮询” ？](https://stackoverflow.com/questions/333664/simple-long-polling-example-code)

长轮询可以描述为“HTTP推送”，基本上你有一个通过网络服务器提供的（Python）脚本，它只在可用时输出数据。然后你尝试通过Javascript异步加载这个页面，当它失败时你重试，当它成功时，你对数据做一些事情（通常显示它）

[我的答案](https://stackoverflow.com/questions/333664/simple-long-polling-example-code/333884#333884)中的示例是用 PHP 编写的，但实际上只有 2 个命令（`sleep(rand(1, 10))`-其他几个是为了演示 javascript 的错误处理）

好吧，事情没*那么*简单。你不能只通过 Apache 提供 CGI python 脚本，因为你会用完工作线程，并且网络服务器将无法接受任何进一步的连接。所以，您需要使用更专业的服务器..

*   [扭曲](http://twistedmatrix.com/trac/)的Python 框架非常适合此类服务器 - 以下两个服务器都是用它编写的
*   [cometd——](http://cometdproject.dojotoolkit.org/) “最著名的”长轮询服务器，虽然我在 Python 实现方面从来没有过好运气
*   [slosh](http://github.com/dustin/slosh/tree/master) - 使用起来似乎非常简单。在 Python 中实现，尽管您可以通过 HTTP 请求与之交互

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-08T19:33:21.103

JavaScript 是将这种交互性添加到网站的主要方式。您可以制作后端 Python，但客户端必须使用 JavaScript AJAX 调用来更新页面。Python 不能在浏览器中运行，所以如果你只想使用 Python，那你就不走运了。

（也可以使用 Flash 或 Java 小程序，但对于看起来很小的问题，这是一个相当重量级的解决方案。）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-08T20:13:48.197

这是一个真正的网络应用程序吗？或者这对您在浏览器中查看输出是否方便？如果为了方便起见，您可以考虑使用 mod_python。

mod_python 是 apache webserver 的扩展，它在 web 服务器中嵌入了 python 解释器（因此脚本在服务器端运行）。它很容易让你在本地或为了你自己的方便做这种事情。然后，您可以使用 mod python 运行脚本并让处理程序发布您的结果。您也可以轻松地实现刷新，但我不知道该怎么做。

希望这会有所帮助...查看 mod_python。配置完所有内容后，这还不错。

# sharepoint - SharePoint Web 部件中的异步线程终止

> ID：731485
> 
> 赞同：1
> 
> 时间：2009-04-08T19:34:58.087
> 
> 标签：sharepoint, sharepoint-2007

我为加载现有用户控件的 SharePoint 2007 编写了一个自定义 Web 部件。用户控件所做的一件事是通过 FTP 异步上传文件。我正在使用具有 BeginUpload/EndUpload 方法的第三方 FTP 库来进行异步文件传输。我还在用户控件中有一个更新面板，用于根据 FTP 库引发的事件显示已传输字节数的运行总数。我已将所有必要的 AJAX 设置添加到 web.config。

如果我从一个单独的项目中单独运行用户控件，一切都会很好。但是当我访问托管控件的 Web 部件并尝试上传时，FTP 库传输了大约 64 KB，然后它运行的线程就死了。我在 VS 输出窗口中得到的消息是：

线程“Win32 线程”(0xf34) 已退出，代码为 0 (0x0)。

我得到了其中的几个，然后 FTP 库抛出异常（基本上它超时），IIS 工作进程崩溃，整个事情都停止了。我需要在我的 SharePoint 配置或 Web 部件中做一些特别的事情来完成这项工作吗？这似乎与 SharePoint 有关，因为如果 SP 不在图片范围内，相同的代码也可以正常工作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T01:16:06.140

我将此问题提交给 Microsoft SharePoint 开发人员支持，他们能够使用我正在使用的 FTP 库重现该错误，该库来自 ComponentSpace。通常我想要做的事情是可能的，但由于某种原因它只是不想工作。

他们的解决方案是通过执行 Request.Files(0).SaveAs 将文件保存在 Web 服务器上，然后执行 FTP 上传。不理想，但它给了我想要的进度指标。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-03T10:19:26.220

Chris Tybur，我试过他们的 FTP 组件，发现了很多错误。我不推荐 ComponentSpace 的 FTP

# ruby-on-rails - Rails：命名空间资源的正确路由

> ID：731487
> 
> 赞同：6
> 
> 时间：2009-04-08T19:35:31.457
> 
> 标签：ruby-on-rails

如果您将资源映射添加到`routes.rb`Rails 2.3 中的命名空间，您如何让`link_to`（和`form_for`等）理解它应该获取命名空间控制器而不是根命名空间中的控制器？

例如...

有了这个`routes.rb`：

```
map.namespace :admin do |admin|
  admin.resources :opt_in_users
end 
```

这在视图中：

```
<%= link_to @anOptInUser %> 
```

那`link_to`应该使用`link_for_admin_opt_in_user`，但它尝试使用`link_for_opt_in_user`，但失败了。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-28T16:11:24.553

对于命名空间资源，与嵌套资源一样，您可以使用带有符号的数组：

```
link_to 'Click here', [:admin, @opt_in_user] 
```

或者

```
form_for [:admin, @opt_in_user] do |form| .... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T19:51:38.377

url_for 的 rails 文档表明您必须明确调用它：

> 如果您不是通过哈希传递一条记录（如 Active Record 或 Active Resource）作为选项参数，您将触发该记录的命名路由。查找将发生在类的名称上。所以传递一个 Workshop 对象将尝试使用 Workshop_path 路由。如果您有嵌套路由，例如 admin_workshop_path，则必须显式调用它（url_for 无法猜测该路由）。

（来自[http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M001564](http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M001564)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T22:29:09.697

Rails 可以接受一个对象数组，然后映射到一个命名路由

例如 <%= link_to @comment.title, [@article, @comment] %>

你会得到一个链接`/articles/@article.to_param/comments/@article.to_param`

这也可以在`form_for`其他地方使用

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T22:34:24.647

采用：

```
link_to '...', admin_opt_in_user_path(@anOptInUser) 
```

收藏：

```
admin_opt_in_users_path 
```

您还可以添加编辑和新前缀。

当您使用 form_for 时，请确保您将 admin_opt_in_users_path 传递给新操作，并将 admin_opt_in_user_path(@anOptInUser) 传递给编辑操作。

# c# - 在 C# NET 3.5 中使用组合框属性

> ID：731497
> 
> 赞同：1
> 
> 时间：2009-04-08T19:38:53.180
> 
> 标签：c#, winforms, .net-3.5, combobox

我想知道如何将组合框设置为只读，这意味着用户不能将文本写入其中，而只能选择？

另一个问题，如何确定所选选项的文本。例如它有 4 个值的索引（10、20、30 和 40）。如果用户选择 20，我怎样才能得到他选择的选项的文本（不是索引号，但文本）？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T19:43:36.430

对于仅列表组合框：

```
comboBox.DropDownStyle = ComboBoxStyle.DropDownList; 
```

获取文本：

```
string text = comboBox.Text; 
```

# java - 如何准确计算 Java 程序写入或读取文件所需的时间？

> ID：731498
> 
> 赞同：5
> 
> 时间：2009-04-08T19:39:03.413
> 
> 标签：java, profiling, io

如何准确计算 Java 程序从/向文件写入或读取多个字节所需的时间？

准确测量时间非常重要。（时间应该由程序自己计算）。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-08T19:41:23.830

标准的成语是：

```
long startTime = System.nanoTime();
doSomething();
long elapsedTime = System.nanoTime() - startTime; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T19:44:03.743

未经测试，但类似：

```
long delta = System.nanoTime();
try {
    // do your stuff
} finally {
    delta = System.nanoTime() - delta;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T23:37:44.633

The way I would do that is just run it in a loop some number of times. Like if you run it 1000 times and clock it, that gives you milliseconds. Run it 1,000,000 times, and it gives you microseconds.

If you also want to find out why it's taking as long as it is, you can just pause it some number of times (like 10) while it's running, and that will tell you what it's doing and why.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T19:44:26.037

这里有一个代码示例：

[http://www.goldb.org/stopwatchjava.html](http://www.goldb.org/stopwatchjava.html)

```
/*
    Copyright (c) 2005, Corey Goldberg

    StopWatch.java is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
*/

public class StopWatch {

    private long startTime = 0;
    private long stopTime = 0;
    private boolean running = false;

    public void start() {
        this.startTime = System.currentTimeMillis();
        this.running = true;
    }

    public void stop() {
        this.stopTime = System.currentTimeMillis();
        this.running = false;
    }

    //elaspsed time in milliseconds
    public long getElapsedTime() {
        long elapsed;
        if (running) {
             elapsed = (System.currentTimeMillis() - startTime);
        }
        else {
            elapsed = (stopTime - startTime);
        }
        return elapsed;
    }

    //elaspsed time in seconds
    public long getElapsedTimeSecs() {
        long elapsed;
        if (running) {
            elapsed = ((System.currentTimeMillis() - startTime) / 1000);
        }
        else {
            elapsed = ((stopTime - startTime) / 1000);
        }
        return elapsed;
    }

    //sample usage
    public static void main(String[] args) {
        StopWatch s = new StopWatch();
        s.start();
        //code you want to time goes here
        s.stop();
        System.out.println("elapsed time in milliseconds: " + s.getElapsedTime());
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T23:55:59.067

get System.xxx 方法的问题在于该方法本身需要几毫秒来计算。通常“接受”的方法是运行测试数万次并计算其平均值。

此外，根据您的操作系统，有一些称为[时间粒度](http://www.bytefusion.com/products/ntm/ptnt/highresolutiontime.htm)的东西（例如 windows）。这是您的操作系统可以计算的最短时间。在某些操作系统上它是一毫秒，在另一些操作系统上是纳秒。它可能与您的情况相关，也可能不相关。

# asp.net - ASP.NET 应用程序中的 Sharepoint 控件

> ID：731500
> 
> 赞同：1
> 
> 时间：2009-04-08T19:39:17.297
> 
> 标签：asp.net, sharepoint, controls

有没有一种方法可以在 ASP.NET Web 应用程序中使用共享点控件，就像为 ASP.NET 开箱即用的任何其他控件一样？如果是，我需要安装哪些先决条件？

谢谢你，哈沙

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T19:43:05.587

是的，只要应用程序在 SharePoint 中运行，您就可以在 ASP.NET 应用程序中使用 SharePoint“控件”。

换句话说，先决条件是 SharePoint。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T12:37:41.497

大多数控件对 SharePoint 具有内部依赖性（即它们在内部使用 SPContext 或 SPWeb）。此外，由于它们包含在 Sharepoint 程序集中，因此您不能只获取 .dll 并将它们放入您的应用程序中。

简而言之：在大多数情况下，使用反射器重新构建它们会更好。你在看哪一个？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T02:58:34.043

你指的是什么具体的控制？您在 SharePoint Designer 中找到的那些？

如果您指的是 WSS v3 中的 Web 部件，那些使用 ASP.NET Web 部件作为基本 Web 部件（推荐的方法）的 Web 部件可能在 ASP.NET 中工作正常，因为 Web 部件类继承自 Panel，而 Panel 继承自 Web控制（从这里记忆） - 所有 ASP.Net 类。它仅取决于 Web 部件是否具有高度依赖于 Web 部件的任何 SharePoint 特定代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T12:33:51.600

在 SharePoint 的 _layouts 目录中托管应用程序（[有关更多详细信息，请参阅此视频](http://msdn.microsoft.com/en-us/library/bb418732.aspx)）。然后，您的 ASP.NET 应用程序将“在 SharePoint 中运行”并可以访问所有 SharePoint 控件。

请注意，除非在实际的 SharePoint 页面上运行，否则某些控件将不起作用。

# asp.net - ASP.NET 动态数据 DisplayColumn 属性导致排序问题

> ID：731502
> 
> 赞同：3
> 
> 时间：2009-04-08T19:40:28.730
> 
> 标签：asp.net, dynamic-data, asp.net-dynamic-data

将 ASP.NET 动态数据与 Northwind 数据库中的 LINQ to SQL DataContext 结合使用...

当我将 DisplayColumn 属性添加到我的 LINQ to SQL`entity`类之一并从部分类中的自定义代码中引用一个属性时，我无法在生成的*GridViews*中按该列进行排序。即使我将非自定义属性引用为`sortColumn`.

为什么会这样？

示例代码：

```
[DisplayColumn("LastNameFirstName", "LastName", false)]
public partial class Employee
{
    public string LastNameFirstName
    {
        get { return LastName + ", " + FirstName; }
    }
} 
```

亚伦

编辑：`sortColumn`指定当它用作外键时（在*DropDownList*中）将用于对该实体进行排序的列，而不是在*GridView*中对其进行排序时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T11:07:29.090

这是正确的，因为该属性不在数据库中，并且 linq to SQL 将尝试构造一个 T-SQL 查询到数据库以获取您的实体。但会失败，因为这些不是具有该名称的列。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-25T22:42:53.503

这可能是设计使然...

“sortColumn”指定当它用作外键时（在 DropDownList 中），而不是在 GridView 中对其进行排序时，将用于对该实体进行排序的列。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T12:40:30.120

您可以尝试覆盖可能有效的 ToString() 方法，但它只会过滤 FK 关系引用的实体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-23T19:09:13.720

尝试添加**[ScaffoldColumn(true)]** - 它可能会欺骗动态数据以启用排序

```
[DisplayColumn("LastNameFirstName", "LastName", false)]
public partial class Employee
{
    [ScaffoldColumn(true)]
    public string LastNameFirstName
    {
        get { return LastName + ", " + FirstName; }
    }
} 
```

# jquery - protect_from_forgery & 不显眼的 Javascript

> ID：731504
> 
> 赞同：13
> 
> 时间：2009-04-08T19:41:16.623
> 
> 标签：jquery, ruby-on-rails, ajax

我有一些 javascript 在我的 Rails 站点中进行 ajax 调用：

```
$.ajax({type: "PUT", url: url, data: { dummy: data }, complete: function(data) {}}); 
```

当 Rails 得到它时，它会抛出一个`ActionController::InvalidAuthenticityToken`错误。如果可能的话，我想将protect_from_forgery 的东西保留在那里......但是我不知道如何从javascript文件中传递身份验证令牌？

谁能帮我吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-08T19:49:32.483

在您的布局中，在任何其他 JS 运行之前添加：

```
<script>
  function authToken() {
    return '<%= form_authenticity_token if protect_against_forgery? -%>';
  }
</script> 
```

`authToken`被编码为一个函数，这样你就不太可能不小心用其他 JavaScript 覆盖它。

或者，从 Rails 3 开始，身份验证令牌作为`<meta>`标签嵌入，您可以阅读：

```
<script>
  function authToken() {
    return $('meta[name="csrf-token"]').attr('content');
  }
</script> 
```

然后，在您的主 JS 中，您可以调用`authToken()`，它会将您的真实性令牌作为字符串返回，以包含在您的 Ajax 调用中。例如，使用 jQuery：

```
$.ajax({
  type: 'PUT',
  url:  url,
  data: {
    foo: bar,
    authenticity_token: authToken()
  },
  complete: function(data) {}
}); 
```

请注意，如果您使用 Rails 的内置`form_for`帮助程序，它会自动将真实性令牌添加到隐藏输入中。如果您想发送所有表单数据，包括隐藏的身份验证令牌，您可以简单地使用：

```
var $form = $('form');
$.ajax({
  url:      $form.attr('action'),
  type:     $form.attr('method'),
              // "get" or "post"; overridden by Rails' hidden "_method"
              // input value, e.g., "put"
  data:     $form.serialize(),
              // Includes hidden "authenticity_token" and "_method" inputs
  complete: function(data) {}
}); 
```

当您已经编写了一个无需 JS 的表单，并且您正在添加一个不显眼的 JS 层，它只是通过 Ajax 发送表单的数据时，这种模式通常很有用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T21:44:17.753

感谢上述解决方案。
我在我的网站中使用了一些不使用 rails form_tag 的标准表单，因此我只是将其添加为隐藏的表单元素。

```
<form action="...">
    <%= hidden_field_tag 'authenticity_token', form_authenticity_token if protect_against_forgery? %>
    ... rest of form...
</form> 
```

工作一种享受。

# powershell - 使用 -EncodedCommand 时无法重定向 PowerShell 输出

> ID：731509
> 
> 赞同：2
> 
> 时间：2009-04-08T19:42:42.453
> 
> 标签：powershell, output-redirect

对于我的测试，我使用的是“开始 > 运行”对话框（不是 cmd.exe）。

这工作正常，我在 log.txt 中得到 9

```
powershell -Command 4+5 > c:\log.txt 
```

但这不起作用：

```
powershell -EncodedCommand IAA1ACsANwAgAA== > c:\log.txt 
```

那么在这种情况下如何重定向输出呢？

实验代码：

```
function Test
{
    $cmd = { 5+7 }
    $encodedCommand = EncodeCommand $cmd

    StartProcess "powershell -Command $cmd > c:\log.txt"
    StartProcess "powershell -EncodedCommand $encodedCommand > c:\log2.txt"
}

function StartProcess($commandLine)
{
    Invoke-WMIMethod -path win32_process -name create -argumentList $commandLine
}

function EncodeCommand($expression)
{
    $commandBytes = [System.Text.Encoding]::Unicode.GetBytes($expression)
    [Convert]::ToBase64String($commandBytes)
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T20:15:31.437

“运行”对话框似乎根本不提供重定向。 [根据this usenet post](http://groups.google.ca/group/microsoft.public.scripting.wsh/msg/d2034742beef06c2?hl=en)，如果您有控制台，您只会获得重定向。我想知道重定向参数是否正在由 powershell.exe 解析，如果它没有接收到编码输入则选择重定向？听起来像是[Raymond Chen](http://blogs.msdn.com/oldnewthing/)的问题。

无论如何，这是可行的，但代价是产生了一个原本无用的控制台：

```
cmd /c powershell -EncodedCommand IAA1ACsANwAgAA== > c:\ps.txt 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T23:44:55.460

这两个命令之间的区别在于 -Command 参数是贪婪的。它在它之后获取命令行上的所有内容，而 -EncodedCommand 并不贪婪。第一个命令真正在做的是：

```
powershell -Command "4+5 > c:\log.txt" 
```

所以新的 PowerShell 实例正在处理重定向。但是，如果您使用 -EncodedCommand 参数，则新的 PowerShell 实例不会看到重定向，因为您没有将其包含在编码命令中。如果调用 PowerShell 的环境没有重定向（如在计划任务中），这可能是一件坏事。

因此，正如“crb”所示，您需要将重定向编码到您的命令中，或者从可以处理重定向的环境（如 cmd 或另一个 PowerShell 实例）中调用 PowerShell。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T20:54:20.377

我必须将命令与重定向一起编码。

```
function Test
{
    $cmd = { 5+7 }
    $encodedCommand = EncodeCommand "$cmd > 'c:\log2.log'"

    StartProcess "powershell -Command $cmd > c:\log.txt"
    StartProcess "powershell -EncodedCommand $encodedCommand"
} 
```

所以这会将总和 5+7 写入 c:\log2.log

```
powershell -EncodedCommand IAA1ACsANwAgACAAPgAgACcAYwA6AFwAbABvAGcAMgAuAGwAbwBnACcA 
```

附言

**crb**建议使用“cmd /c”。但在这种情况下，编码的脚本长度将受到[命令行限制](http://support.microsoft.com/default.aspx?scid=kb;en-us;830473)

> 在运行 Microsoft Windows XP 或更高版本的计算机上，您可以在命令提示符处使用的最大字符串长度为 8191 个字符。在运行 Microsoft Windows 2000 或 Windows NT 4.0 的计算机上，可以在命令提示符处使用的字符串的最大长度为 2047 个字符。

# iphone - 如何在多视图应用程序中使用 UIScrollView？

> ID：731513
> 
> 赞同：1
> 
> 时间：2009-04-08T19:43:34.167
> 
> 标签：iphone, uiscrollview

我有： - 一个 AppDelegate 类 - 两个 viewController 类 - 三个 nib 文件（MainWindow.xib、firstView.xib、secondView.xib）

我想要：secondView.xib 里面应该有一个 UIScrollView，这样我就可以在视图中添加很多东西，并且可以向下滚动。

我现在必须在哪里符合 UIScrollViewDelegate 协议？我觉得 AppDelegate 类是错误的地方，因为它远离第二个视图，并不是我所有的视图都想使用 UIScrollView。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T20:26:36.793

since UIScrollView is located in the secondView.xib I assume its functionality is limited to that view. If you have an instance of UIViewController that serves as the controller for the secondView.xib then the best place to implement UIScrollViewDelegate would be on that UIViewController directly. You are correct that implementing it on the AppDelegate doesn't make sense if you have a more specific derived controller where it should belong. Hope this helps!

# java - 阻塞 Graphics.drawImage

> ID：731519
> 
> 赞同：1
> 
> 时间：2009-04-08T19:44:17.363
> 
> 标签：java, graphics

我正在使用 Graphics2D.drawImage 将图像绘制到 BufferedImage 中。然后我使用 ImageIO.write() 将其输出到 PNG。我经常看不到我以这种方式绘制的某些图像。

我认为这是因为 drawImage 是一个异步操作，我需要等待它完成。我试过实现 ImageObserver 但没有成功。

谁能告诉我它是怎么做的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T19:47:17.683

`java.awt.MediaTracker`是确保图像已加载的一种相对简单的方法。

# amazon-s3 - Amazon S3：何时/为什么

> ID：731526
> 
> 赞同：28
> 
> 时间：2009-04-08T19:46:09.060
> 
> 标签：amazon-s3, cdn

所以，我有一个专用服务器。我主持了大约十几个小网站。

将 S3（或 Mosso）用于我的图像和静态文件托管是否有真正的好处？我的服务器有足够的磁盘空间，还是我完全错过了 S3 的意义？

我一直在阅读它是多么美妙和便宜，我问自己“自己，你为什么不使用这个”，而回答总是“为什么？”

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-08T20:00:21.927

如果您在服务器的包含存储和带宽内运行并且您的需求得到了很好的满足，那么您已经在做最适合您的最简单的事情，这就是您应该始终开始的地方。在我的脑海中，我可以想到您将来可能希望将一些存储移动到 S3 的几个原因：

*   您的存储或带宽需求超出了您的现有量，S3 比升级您当前的解决方案更便宜
*   您出于故障转移/性能原因迁移到多专用服务器解决方案，并希望能够将资产存储在单个共享位置
*   您的带宽需求变化很大（因此您可以在没有流量时避免按月付费）[感谢 Jim，来自评论]

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-08T21:47:10.390

如果您在一台机器上运行整个网站，并且该机器足以处理您的网站，那么值得称赞的是，图像不是现在需要解决的瓶颈。暂时忘记 S3。

但是，随着您的服务器变得越来越繁忙，您将希望您的服务器将所有时间都花在服务器上。传输平面 HTML 文件和图像等静态内容是一项简单而愚蠢的工作，在它们上浪费宝贵的活动连接、带宽和 CPU 周期是不好的。通过切换到 S3，您的服务器可以专注于做重要的事情，这就是您的程序实际所做的事情。

S3 还具有分布和连接到可能比服务器更粗的管道的好处，这意味着图像在客户端计算机上的显示速度会稍快一些，因此这是一个额外的好处。

S3 也得到了备份，这意味着它是一个非常好的地方，可以在阳光下存储几乎所有的私人数据，除了你想提供给其他人的东西（尽管不要混淆这两者之间的权限设置事情——事实上，您可能希望完全使用单独的帐户）。

S3 也是近乎无限的，这意味着如果您想让用户将文件上传到您的站点（个人资料图片、附件等），S3 是一个不错的选择，这样您就不必经常担心服务器是否会运行用完磁盘空间（这里是强制性的 $$$ 警告）。

但就像我在顶部所说的那样，如果你是一个只有少数用户的服务器设置，那么这些都不重要。它和其他任何工具一样，可能还不是您需要的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-08T21:05:24.673

这只是一个简单的数字问题：给定一组文件的一定流量，您可以准确计算在 S3 上托管这些文件的成本，并且您应该能够为您当前的提供商做同样的事情。如果 S3 的数字较低，那么你有你的理由。

另一个好处是 S3 与流量几乎呈线性关系，您只需为实际使用的内容付费，而大多数提供商都会向您收取固定费用，无论您实际拥有的流量有多少，如果您超过固定费用中包含的最大流量。

更好的速度和可用性可能是一个额外的好处。

基本上，如果您的网站可能会产生非常不同的流量，那么将 S3 用于其图像和其他静态文件意味着如果您受到 Slashdot 效应的打击，该网站有更好的机会保持可访问性，并且您有更好的机会避免关于超额交通费的令人讨厌的意外。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-04-14T14:02:39.303

Amazon S3 的优势在于可靠性、可扩展性、速度和成本。这是每个方面的一些信息。

可靠性：亚马逊将您的数据存储在多个数据中心。如果发生灾难并且一个数据中心被破坏，您的内容将继续从第二个数据中心提供。您上传到亚马逊的数据不太可能丢失。

可扩展性：如果您的某个网站变得流行并且数百万人访问该网站，您的网络服务器将无法处理负载。相比之下，当您将文件上传到亚马逊时，它们存储在多个位置。如果您的内容负载增加，您的文件会自动复制到更多服务器，因此您的文件将始终可用。

速度：亚马逊有一项名为 CloudFront 的服务，可与 Amazon S3 结合使用。当您在 S3 内容上激活 CloudFront 时，您的内容将移动到边缘站点。这些是使您的内容可用于高速传输的服务器。

成本：使用 Amazon S3，您只需按使用量付费。如果您有一些流量很少的文件，您每月只需支付几美分。

SprightlySoft 有一篇博文，其中给出了 Amazon S3 出色的更多理由。阅读[http://sprightlysoft.com/blog/?p=8](http://sprightlysoft.com/blog/?p=8)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T19:58:24.100

如果您要托管一个高流量的网站，那么您自己托管图像的带宽成本（和延迟问题）会使 S3 和 Akami 等其他服务具有吸引力。对于低流量的网站，这可能不是问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T20:00:34.610

我想说，如果您的基本托管计划提供足够的空间/带宽，那是没有理由的。我认为它有用的地方是当您的文件传输变得足够时，您必须考虑从提供商处购买存储/带宽的附加组件——在这种情况下，S3 可能是一个可行的替代方案。但是，如果我每月支付 X 美元并且没有使用所有存储空间，那么它没有任何好处。

另一方面，如果您的容量规划要求您在某天超出提供商的限制，那么 S3 可能从一开始就是一个很好的解决方案，这样您就不会从多个地方提供文件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T20:45:24.033

我会第二次提到“冗余”——您可以指望 S3 中的任何内容都分发到多个数据中心，并且任何具有正常网络连接的人都可以有效地随时访问。

成本可能是另一个因素：S3 的数据传输率非常具有竞争力。

速度是最后一个：您可以非常快地从 S3 访问数据。但这对于浏览器可见图像以外的数据来说是一个更大的问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-08T21:11:44.937

对于小型网站，S3 或 Mosso 可能不适合图像托管，但如果您有任何视频文件（.wmv、.flv 等）或大型下载（应用程序分发等），我会如果出于某种奇怪的原因，您的内容变得非常受欢迎，仍然将它们放在 S3 或 Mosso 上以节省潜在的带宽峰值。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-08T21:23:00.497

你写：

> 我的服务器有足够的磁盘空间，还是我完全错过了 S3 的意义？

如果您在服务器上拥有的是一次写入一次读取次数少于一次的东西，例如灾难恢复备份（您希望永远不会读取），那么您不会错过这一点，因为传输时间无关紧要。S3的重点是交付速度。

首先，S3 在地理上分发您的内容。最终用户受益于更短的路径。

~~其次，S3 可以充当 BitTorrent 种子，这不仅可以节省您的带宽，还意味着您最受欢迎的内容将被更快地分发，因为它可以利用 ad-hoc swarm。~~AWS 论坛上有报道称 S3 对 BitTorrent 协议的支持“[非常非常参差不齐](http://developer.amazonwebservices.com/connect/thread.jspa?threadID=28887)”。我自己没有测试过。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-12-25T09:23:43.463

你们中的许多人不会有这个问题，但是如果您（和您的 Web 服务器）位于澳大利亚（阅读：互联网的第三世界），您会遇到 S3 没有地理位置接近的问题，这意味着您的图像和其他静态内容会有更高的延迟。可扩展：是的。快：没有。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-08T19:58:08.813

据我所知，除了低成本之外，主要优势是从 EC2 设置中轻松备份。

链接.. [http://groups.drupal.org/node/2383](http://groups.drupal.org/node/2383)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-08T19:59:07.250

速度*可能*是唯一的好处。如果您的专用服务器只是通过您的 ISP 联网（即使下行速度很高，它也可能会限制上行速度），那么您可能会发现您的站点通常加载缓慢。如果是这样，那么 S3 或其他专用服务器提供商可以提供帮助。除此之外，我想不出亚马逊的服务更适合你的理由——尤其是对于简单的静态网站。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-08T21:32:06.090

它与您实际托管的网站并没有真正*直接相关，但它肯定是其中的一个重要部分，***特别是**如果这些网站不属于您一个人 - S3 是一个很好的备份解决方案。有诸如[duplicity](http://duplicity.nongnu.org/)之类的工具可以自动有效地为您将内容备份到 S3 上，并且为此目的非常便宜。我以每月不到 1 美元的价格备份大量数据。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-02-25T20:45:54.440

除了 S3 的 Fat Pipe 和 Local Delivery 参数之外，当单个服务器同时作为数据库服务器和文件服务器运行时，它的运行方式也不是最佳的。如果您运行任何类型的数据库，我建议您将所有静态文件卸载到 s3。成本微不足道，您会在页面加载时看到相当大的性能提升。

# c# - 针对 Active Directory 进行身份验证的 Web 服务的安全密码解决方案？

> ID：731528
> 
> 赞同：1
> 
> 时间：2009-04-08T19:46:15.207
> 
> 标签：c#, web-services, authentication, active-directory

我正在修改的应用程序有一个 Web 服务，并且该 Web 方法上的一个 Web 方法用于针对 Active Directory 对用户进行身份验证。因此，AuthenticateUser Web 方法调用的当前代码如下所示：

```
string domainAndUsername = aDomain + @"\\" + username;
string ldsPath = buildLdsPath(searchBase);
DirectoryEntry entry = new DirectoryEntry(ldsPath, domainAndUsername, 
    password);

try
{
    //Bind to the native AdsObject to force authentication.
    object obj = entry.NativeObject;

    DirectorySearcher search = new DirectorySearcher(entry);

    search.Filter = "(sAMAccountName=" + username + ")";
    search.PropertiesToLoad.Add("cn");
    SearchResult result = search.FindOne();

    // more code to validate the result, etc...
} 
```

当我开始查看这段代码时，首先让我担心的是 web 方法的参数如下所示：

```
[WebMethod]
public ResultObj AddRole(string roleToAdd, string username, string password)
{
    // code that calls above Authentication fragment...
} 
```

因此，当向 service.asmx 页面发出请求时，当前的 Web 服务需要一个密码字符串，大概是通过网络作为 XML**以明文形式发送的。**

以前有没有人处理过这类问题？是否有我可以使用的替代 Active Directory 身份验证机制来避免传递纯文本密码？我自己能想到的最佳选择是使用加密密码调用 WebMethod，并让另一端的代码对其进行解密。但是，我更喜欢更好的解决方案——例如：有没有办法使用单向哈希而不是密码来搜索 DirectoryEntry？

**编辑：**

*附加细节：* 到目前为止，我还没有考虑 SSL，因为这是我们公司内部的工具，所以它看起来有点矫枉过正，并且可能有问题（它将在公司内部网上运行，而不是外部可见）。我什至担心发送纯文本密码的安全性的唯一原因是，这些天甚至在公司内部网上也出现了越来越多的（可能是密码嗅探）恶意软件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T19:51:55.537

如果你有一个公钥/私钥组合，那么客户端可以用公钥加密，你用私钥解密。

但是，这对客户来说工作量太大，而且不是一种非常“网络方法”的方式。

由于您将用户名和密码作为参数发送，因此您应该求助于传输安全性，基本上是 HTTPS，这要求您拥有从受信任的证书颁发机构颁发给您的公钥/私钥组合。

* * *

应该注意的是，您将 SSL 加密通道与面向外部的站点的关联是不正确的。想要加密通道的目的是防止中间人攻击，就像您在这里尝试做的那样。

您可以使用自行颁发的证书，但这需要在将调用您的 Web 方法的每台机器上安装证书的公钥。从受信任的权威那里获得一个更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T20:33:15.623

HTTPS（如前所述）是一个简单的选择。或者，您可以让 IIS 通过 Digest 或 NTLM 处理身份验证。您的应用仍然可以制定授权规则。NTLM 是安全的，但它会损害您的互操作性。否则，AD 确实提供了一些摘要式身份验证方法，但我没有使用它们测试过代码。

对于 Server 2000 域，有一个“以可逆格式存储密码”选项 - 这将允许域控制器计算密码的 MD5 哈希值，以与您提供的 MD5 哈希值进行比较。不过，MS 意识到这是一个安全问题，因此 Server 2003 实施了“高级”摘要身份验证——它预先计算了哈希值。

LDAP 登录应选择 MD5 Digest 作为身份验证类型，提供用户名，然后提供密码的 MD5 哈希。不过，普通的 LDAP 客户端可能希望自己对您的密码进行 MD5 处理，因此您必须自己覆盖或制作它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T19:54:15.063

我们将我们的 AD 服务放在其自己的网站上并获得了 SSL 证书。问题解决了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T20:15:07.447

我认为 SSL，或者可能是 IPSec，可能是您最好的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T17:33:54.663

对于我们的特殊情况，因为客户端和 Web 服务都在我们公司的 Intranet 上运行，可能对我们有用的解决方案是使用集成 Windows NTLM 身份验证在客户端处理身份验证，然后让客户端向 Web 服务提供凭据。这是客户端代码：

```
public void AddRole(string roleName)
{
    webSvc.Credentials = CredentialCache.DefaultCredentials;
    // Invoke the WebMethod
    webSvc.AddRole(roleName);
} 
```

Web 方法现在看起来像这样：

```
[WebMethod]
public ResultObj AddRole(string roleToAdd)
{
    IIdentity identity = Thread.CurrentPrincipal.Identity;
    if (!identity.IsAuthenticated)
    {
        throw new UnauthorizedAccessException(
                ConfigurationManager.AppSettings["NotAuthorizedErrorMsg"]);
    }
    // Remaining code to add role....
} 
```

再次，我必须强调这个解决方案可能只有在服务器信任客户端并且都与同一个 Active Directory 服务器通信的情况下才有效。对于公共 Web 服务，给出的其他答案之一将是一个更好的解决方案。

有关详细信息，请参阅：

*   [有关传递凭据的 Microsoft 支持文章](http://support.microsoft.com/kb/813834)
*   [关于构建安全应用程序的 MSDN 文章](http://msdn.microsoft.com/en-us/library/aa302383.aspx)
*   [有关 Windows 身份验证的 MSDN 文章](http://msdn.microsoft.com/en-us/library/aa480475.aspx)- 包括有关正确配置 Web 服务以使用所需的 Windows 主体和身份对象的信息。

# jquery - jQuery UI 选项卡和带有 mvc 的 ajax 表单

> ID：731531
> 
> 赞同：1
> 
> 时间：2009-04-08T19:46:29.090
> 
> 标签：jquery, asp.net-mvc, ajax, forms, tabs

我试图做的这个设置有问题就是这样。

**脚步**

1.  填写 a 的所有元素`Ajax.BeginForm()`。
2.  点击提交
3.  然后 Ajax 表单呈现一个局部视图。
4.  局部视图有一个处理不同任务的选项卡列表。
5.  所有选项卡本质上都有自己的局部视图。
6.  当加载每个局部视图时，它们会针对该特定选项卡执行必要的查询。
7.  渲染必要的数据。

    （这应该全部在 AJAX 中完成。）

我添加 jquery 选项卡并为它们设置不同的操作没有问题，它们可以使用默认的 ajax 调用，但是一旦我添加`Ajax.BeginForm()`到页面，它们就不能使用默认的 ajax 调用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-14T19:45:19.233

为了回答我自己的问题，我曾经`Ajax.ActionLink()`做过可点击的选项卡并模仿了 jQuery 选项卡 UI，这对我来说非常适合最终确定解决方案。

这也与`Ajax.BeginForm()`

# python - 有没有办法在 Python 中获取所有目录而不是目录中的文件？

> ID：731534
> 
> 赞同：1
> 
> 时间：2009-04-08T19:47:11.287
> 
> 标签：python, directory

此[链接](http://linux.die.net/diveintopython/html/file_handling/os_module.html)使用自定义方法，但我只想看看在 Python 2.6 中是否有一个方法可以做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T20:20:44.920

没有仅列出文件的内置函数，但很容易在几行中定义：

```
def listfiles(directory):
    return [f for f in os.listdir(directory) 
              if os.path.isdir(os.path.join(directory, f))] 
```

**编辑**：固定，谢谢 Stephan202

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T20:00:13.567

如果*a_directory*是您要检查的目录，则：

`next(f[1](http://docs.python.org/library/os.html#os.walk) for f in os.walk(a_directory))`

从[os.walk()](http://docs.python.org/library/os.html#os.walk)参考：

> 通过自上而下或自下而上遍历树，在目录树中生成文件名。对于以目录 top 为根的树中的每个目录（包括 top 本身），它会产生一个 3 元组（dirpath、dirnames、filenames）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T20:04:18.347

我不相信有。由于目录也是文件，因此您必须询问所有文件，然后询问每个文件是否是目录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T20:37:21.837

```
def listdirs(path):
    ret = []
    for cur_name in os.listdir(path):
        full_path = os.path.join(path, cur_name)
        if os.path.isdir(full_path):
            ret.append(cur_name)
    return ret

onlydirs = listdir("/tmp/")
print onlydirs 
```

..或作为列表理解..

```
path = "/tmp/"
onlydirs = [x for x in os.listdir(path) if os.path.isdir(os.path.join(path, x))]
print onlydirs 
```

# javascript - 为什么以下 jquery 脚本不起作用？

> ID：731542
> 
> 赞同：0
> 
> 时间：2009-04-08T19:49:03.780
> 
> 标签：javascript, jquery

我有一个简单的单页设置。在根文件夹下，我有 3 个子文件夹（js、css 和图像）。在根文件夹中，我有一个 index.html 页面，其中包含以下内容：

```
<html>
<head>
<title></title>
<script language="javascript" src="js/jquery-1.3.2.min.js"></script>
<script language="javascript" src="js/myscript.js"></script>
</head>
<body>
<a onclick="doSomething()" href="#" class="doSomething">Click!</a>
</body>
<html> 
```

myscript.js 包含以下代码：

```
$('a.doSomething').click(function(){
//Do Something here!
alert('You did sometihng, woo hoo!');
}); 
```

当我单击链接时，没有任何反应。我错过了什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-08T19:50:22.653

将 document.ready 包裹在代码周围：

```
$(document).ready(function() {
    $('a.doSomething').click(function(){
        //Do Something here!
        alert('You did sometihng, woo hoo!');
        return false; // return false to prevent default action
    });
}); 
```

就像现在一样，您正在尝试将事件绑定到 DOM 中尚不存在的元素。

另外，不知道为什么你有`onclick`链接本身，因为 jQuery 的重点是能够将那些丑陋的内联事件从那里取出并在 javascript 中干净地绑定它们。如果你这样做：

```
<a href="#" class="doSomething">yay click me</a> 
```

然后使用上面的代码，它应该可以正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T19:52:34.880

起初我以为你只是缺少一个名为“doSomething”的函数。然后我意识到你希望你的选择器在哪里找到锚标签。然而，这不会发生。在您的脚本运行时，锚点尚未添加到 DOM。

# html - Safari 的 CSS 间距问题？

> ID：731546
> 
> 赞同：3
> 
> 时间：2009-04-08T19:49:53.950
> 
> 标签：html, css

我为我的最新项目制作了一个基于列表的导航栏，并在导航的每一侧添加了两个信息栏。它在 Firefox 和 IE 中如愿以偿，但奇怪的是 Safari 正在发挥作用。它在导航栏和右侧信息栏之间留出了很大的空间。

CSS

```
body{
    background-color:#4c7094;
    background-image: url(images/bg.gif);
    background-repeat:repeat-x;
    font-size:.9em;
    color:#FFF;
    margin-top:0px;
    font-family: Tahoma, Geneva, sans-serif;
}

#nav {
    float:left;
    padding: 0px 0px 0px 3px;
    margin: 0px 0px 0px 0px;
    list-style:none;
        border:0px solid #000;
}

#nav li { 
    float:left;
    margin: 3px 3px 0px 0px;
    font-family:Tahoma, Geneva, sans-serif;
    background-color:#e7ebf0;
    border:3px double;
    display: inline;
    border-color:#99aabb;
}

#nav a {
    float:left;
    display: block;
    color:#1d4c7b;
    padding: 5px 15px 5px 15px;
    font-size: .8em;
    vertical-align:middle;
    text-decoration:none;
    font-family: Georgia, "Times New Roman", Times, serif;
}

#nav a:hover {
    float:left;
    display: block;
    color:#FFF;
    padding: 5px 15px 5px 15px;
    font-size: .8em;
    background-color:#5b7290;
    vertical-align:middle;
    text-decoration:none;
    font-family: Georgia, "Times New Roman", Times, serif;
}

#phonebar{
    padding: 0px 6px 9px 6px;
    background-image: url(images/phonebg.gif);
    background-repeat: repeat-x;
    background-color:#335b83;
    color:#FFF;
    float:left;
    border:0px solid #000;
    width:15%;
    text-align:center;
}

#asseenbar{
    padding: 0px 9px 9px 6px;
    margin-right: 0px;
    background-image: url(images/phonebg.gif);
    background-repeat: repeat-x;
    background-color:#335b83;
    color:#FFF;
    float:right;
    display:inline;
    border:0px solid #000;
    width:19.7em;
    text-align:center;
}

h2 {
    font-size:1.5em;
    margin: 0px 0px 0px 0px;
    padding: 0px 0px 0px 0px;
    display: inline;
    font-family:Georgia, "Times New Roman", Times, serif;
}

#phone {
    font-size:1em;
    margin: 0px 0px 0px 0px;
    padding: 8px 0px 0px 0px;
    font-family:"Times New Roman", Times, serif;
}

#asseen {
    font-size:.8em;
    margin: 0px 0px 0px 0px;
    padding: 9px 0px 0px 5px;
    text-align:left;
    font-family:"Times New Roman", Times, serif;
}

#menubar{
    clear:left;
    margin-bottom:0px;
    width:1000px;
    margin-left:auto;
    margin-right:auto;
    background-color:#FFF;
    height:40px;
}

#content{
    margin-right:auto;
    margin-left:auto;
    background-color:#FFF;
    width:975px;
    height:890px;
    padding: 20px 5px 5px 20px;
    border:0px solid;
    border-color:#4c7094;
    color:#333;
} 
```

HTML：

```
<body>
 <center> <img src="images/banner.jpg" width="1000" height="72" /></center>
<div id="menubar">
<div id="phonebar">
<p id="phone">888-325-1924</p>
</div>
  <ul id="nav">
<li><a href="#">HOME</a></li>
<li><a href="#">WHAT WE BUY</a></li>
<li><a href="#">ABOUT US</a></li>
<li><a href="#">LOCATIONS</a></li>
<li><a href="#">CONTACT US</a></li>
</ul>
<div id="asseenbar">
<p id="asseen">As seen on CNN and NBC</p>
</div>
</div>
<div id="content">Welcome to Georgia Buying Group</div>
</body> 
```

我已经为此奋斗了好几个小时，并且是 CSS 的新手，我希望有人可以帮我一把！任何建议表示赞赏！谢谢 ：）

*   克里斯

编辑：我的文档类型是过渡性的：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

对不起

**编辑**-----------

我将所有单位更改为像素，但问题仍然存在。现在它在我的 macbook 上的 safari 上看起来不错，但在我的 pc 上的 safari 或 Firefox 上就不行了。它只是扩展得如此之多，以至于它被推到了一条线上。

这是我的CSS：

```
body{
    background-color:#4c7094;
    background-image: url(images/bg.gif);
    background-repeat:repeat-x;
    font-size:.9em;
    color:#FFF;
    margin-top:0px;
    font-family: Tahoma, Geneva, sans-serif;
}

#nav {
    float:left;
    padding: 0px 0px 0px 3px;
    margin: 0px 0px 0px 0px;
    list-style:none;
    border:0px solid #000;
}

#nav li { 
    float:left;
    margin: 3px 3px 0px 0px;
    font-family:Tahoma, Geneva, sans-serif;
    background-color:#e7ebf0;
    border:3px double;
    display: inline;
    border-color:#99aabb;
}

#nav a {
    float:left;
    display: block;
    color:#1d4c7b;
    padding: 5px 15px 5px 15px;
    font-size: .8em;
    vertical-align:middle;
    text-decoration:none;
    font-family: Georgia, "Times New Roman", Times, serif;
}

#nav a:hover {
    float:left;
    display: block;
    color:#FFF;
    padding: 5px 15px 5px 15px;
    font-size: .8em;
    background-color:#5b7290;
    vertical-align:middle;
    text-decoration:none;
    font-family: Georgia, "Times New Roman", Times, serif;
}

h2 {
    font-size:1.5em;
    margin: 0px 0px 0px 0px;
    padding: 0px 0px 0px 0px;
    display: inline;
    font-family:Georgia, "Times New Roman", Times, serif;
}

#phonebar{
    padding: 0px 6px 9px 6px;
    background-image: url(images/phonebg.gif);
    background-repeat: repeat-x;
    background-color:#335b83;
    color:#FFF;
    float:left;
    border:0px solid #000;
    width:120px;
    text-align:center;
}

#asseenbar{
    padding: 0px 9px 9px 6px;
    margin-right: 0px;
    background-image: url(images/phonebg.gif);
    background-repeat: repeat-x;
    background-color:#335b83;
    color:#FFF;
    float:right;
    display:inline;
    border:0px solid #000;
    width:326px;
    text-align:center;
}

#phone {
    font-size:1em;
    margin: 0px 0px 0px 0px;
    padding: 8px 0px 0px 0px;
    font-family:"Times New Roman", Times, serif;
}

#asseen {
    font-size:.8em;
    margin: 0px 0px 0px 0px;
    padding: 9px 0px 0px 5px;
    text-align:left;
    font-family:"Times New Roman", Times, serif;
}

#menubar{
    clear:left;
    margin-bottom:0px;
    width:1000px;
    margin-left:auto;
    margin-right:auto;
    background-color:#FFF;
    height:40px;
}

#content{
    margin-right:auto;
    margin-left:auto;
    background-color:#FFF;
    width:975px;
    height:890px;
    padding: 20px 5px 5px 20px;
    border:0px solid;
    border-color:#4c7094;
    color:#333;
} 
```

在这里能找到它;

[http://www.christopherbier.com/gbg](http://www.christopherbier.com/gbg)

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T20:09:35.663

我没有 Safari，所以我无法测试，（虽然我使用的是 Chrome），但问题可能来自

```
#phonebar {
    padding: 0px 6px 9px 6px;
    width:15%;
} 

#asseenbar{
    padding: 0px 9px 9px 6px;
    width:19.7em;
} 

#nav li { 
    margin: 3px 3px 0px 0px;
    border:3px double;
}

#nav a {
    padding: 5px 15px 5px 15px;
} 
```

尝试使用一致的单位（即尝试所有像素，当你做对时，如果你觉得勇敢，你可以乱用 %）并确保你的列的宽度总和 - 不超过容器的宽度分区`#menubar`。

另外你应该指定一个 DOCTYPE 否则你会在不同的浏览器之间遇到问题。如果您没有正确声明特定的 docType，访问者浏览器必须“猜测”（通常通过应用最松散的可能 docType 或它自己的“怪癖”模式 docType）导致渲染速度变慢。

**如果您不指定 DOCTYPE，您可能会遇到很多麻烦。**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T22:53:22.603

您似乎已经根据您链接到的站点的状态进行了一些调整，但它仍然无法在不同的浏览器中正常工作。

我认为你最好的办法是将该`phonebg.gif`图像设置为整个`#menubar`div 的背景，而不是它的左右部分，然后在`#nav`.

这样，您根本不必在该右侧 div 上设置宽度（或者至少不需要精确到确保 3 个部分与整个宽度匹配的宽度）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:43:20.623

尝试在列表周围添加一个 div。

# actionscript-3 - 盖亚框架，是福还是祸？

> ID：731552
> 
> 赞同：4
> 
> 时间：2009-04-08T19:51:19.343
> 
> 标签：actionscript-3, gaia

作为一名新开发人员，我想研究 GAIA 框架吗？这会扼杀我的学习并让我依赖这些吗？

这个框架有什么限制。是否有其他框架可供您建议使用深度链接和其他花里胡哨的快速网站开发？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T20:06:19.713

作为一名新开发人员，如果像 Gaia 这样的结构化框架迫使您编写更好的代码，您很有可能会编写出更好的代码。除非您精通 Flash 和 Actionscript，否则构建 Flash 网站可能是一项棘手的考验。

我说试试看你喜不喜欢。一旦你理解它，盖亚应该会为你节省一些时间。每当我尝试一个新框架时，我都会尝试构建一个或两个示例项目，以便在实际将其用于实际项目之前掌握它。

如果您是 Flash 新手，Gaia 也可能是一个很好的工具，可以在您的设计和代码之间学习一个体面的工作流程，而且一般来说，当涉及到 Flash 时。

如果您深入研究代码并试图弄清楚事情是如何完成的以及为什么要这样做，我真的不认为 Gaia 会阻碍您的学习。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T15:44:35.477

这完全取决于您如何使用 Gaia。如果您使用 Gaia 制作网站，然后将创建的代码分解并弄清楚它是如何完成它所做的事情的，那么它将极大地帮助您学习。

另一方面，如果您只是使用它发布网站并且不费心将其拆开来学习内部结构，那么它将只是一个拐杖，让您永远无法自己学习如何做。一种创造你无法创造的东西的能力，如果你将来不能再次使用它，你将不知道如何去做。

将其用作学习工具，而不仅仅是构建工具。

编辑：这是对一般构建工具的一般评论。具体与 Gaia 有关，我想补充一点，我个人认为大多数高端开发人员都让他们的网站比 Gaia 框架好得多。就*个人观点*而言，我只建议将其用作基础学习工具，然后构建自己的框架，当你变得更好时，你可以不断改进。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-26T08:13:42.893

我已经在几个项目中使用过它。我的经验是，有些事情用 GAIA 真的很容易做，有些事情很难，因为你需要坚持结构。

它还取决于您正在创建的项目类型。我认为值得一试，因为你可以从 GAIA 团队创建的结构和方法中学到很多东西。

# java - 您可以将 Java EE 框架与 Google App Engine 一起使用吗？

> ID：731553
> 
> 赞同：8
> 
> 时间：2009-04-08T19:51:26.130
> 
> 标签：java, google-app-engine, stripes

我一直在使用 Stripes 框架开发一个小型 Web 应用程序。现在 Google App Engine 增加了对 Java 的支持，我想知道是否可以将它转换为在 Google App Engine 中运行以节省托管成本。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T19:52:51.507

是的，它支持 servlet，所以它应该支持[Stripes](http://www.stripesframework.org/display/stripes/Home)就好了。

根据 App Engine[文档](http://code.google.com/appengine/docs/java/overview.html)，

> App Engine 将 Java Servlet 标准用于 Web 应用程序。您在标准 WAR 目录结构中提供应用程序的 servlet 类、JavaServer Pages (JSP)、静态文件和数据文件，以及部署描述符（web.xml 文件）和其他配置文件。App Engine 通过根据部署描述符调用 servlet 来处理请求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T22:40:35.440

由于缺少对本地临时目录的访问权限，似乎存在[一些障碍（和解决方法） 。](http://www.nabble.com/Stripes-and-Google-App-Engine-td22948917.html)您需要提供自己的文件上传工具（或禁用该功能）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T00:08:22.020

[从GAE 的 RoR](https://stackoverflow.com/questions/753031/ror-on-gae/753250#753250)那里得到这个？

更多信息：

*   [官方工作图书馆清单](http://groups.google.com/group/google-appengine-java/web/will-it-play-in-app-engine)
*   [非官方工作图书馆清单](http://spreadsheets.google.com/pub?key=pRJ%5F0hajVrhacLjp3HqD5ew)

# c# - LINQ to SQL：针对列表、数组和对象列表的高级查询

> ID：731569
> 
> 赞同：3
> 
> 时间：2009-04-08T19:56:58.270
> 
> 标签：c#, linq, linq-to-sql

**单个和多个列表**

考虑以下列表：

```
List<Int32> appleIdentities = new List<int>(new[] { 1, 2, 3 });
List<Int32> chocolateIdentities = new List<int>(new[] { 2, 3, 4 });
List<Int32> icecreamIdentities = new List<int>(new[] { 11, 14, 15, 16 }); 
```

使用 LINQ to SQL；是否有可能写一个翻译成的声明：

```
SELECT
    DesertsID,
    DesertsName
FROM
    Deserts
WHERE
    Deserts.AppleIdentity IN (1, 2, 3) AND
    Deserts.ChocolateIdentity IN (2, 3, 4) AND
    Deserts.IcecreamIdentity IN (11, 14, 15m 16) 
```

如是; 如果我只想根据`appleIdentities`列表查询我的沙漠数据库，代码会如何？

**数组**

考虑以下数组：

```
Int32[] appleIdentities = new[] {1, 2, 3, 4};
String[] chocolateNames = new[] {"Light", "Dark"}; 
```

使用 LINQ to SQL；是否有可能写一个翻译成的声明：

```
SELECT
    DesertsID,
    DesertsName
FROM
    Deserts
WHERE
    Deserts.AppleIdentity IN (1, 2, 3) AND
    Deserts.ChocolateName IN ('Light', 'Dark') 
```

如是; 如果我想仅针对`appleIdentities`数组查询我的沙漠数据库，代码会如何？

**对象列表**

考虑以下：

```
public class Identities
{
    public Int32 appleIdentity { get; set; }
    public String chokolateName { get; set; }
}

List<Identities> identities = new List<Identities>(new[] {
    new Identities { appleIdentity = 1, chokolateName = "Light" },
    new Identities { appleIdentity = 2, chokolateName = "Dark" },
}); 
```

使用 LINQ to SQL；是否有可能写一个翻译成的声明：

```
SELECT
    DesertsID,
    DesertsName
FROM
    Deserts
WHERE
    Deserts.AppleIdentity IN (1, 2) AND
    Deserts.ChocolateName IN ('Light', 'Dark') 
```

如是; 如果我想仅`appleIdentity`针对我的对象列表中的 -property查询我的沙漠数据库，代码将如何显示`Identities`？ [这是针对实体列表的 LINQ to SQL 查询的](https://stackoverflow.com/questions/729899/linq-to-sql-query-against-a-list-of-entities)

分支

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T20:12:59.337

> 如果我想仅针对 appleIdentities 列表查询我的沙漠数据库，代码会如何？

您可以像这样在多个语句中编写 linq 查询，并在运行时选择要在 where 子句中使用的过滤器。

```
var query = db.Desserts;
if (filterbyAppleIdentity)
    query = query.Where( q => appleIdentities.Contains(q.DesertsID));
if (filterbyChocolateIdentities)
    query = query.Where( q => chocolateIdentities.Contains(q.DesertsID));
if (filterbicecreamIdentities)
    query = query.Where( q => icecreamIdentities.Contains(q.DesertsID));

var deserts = query.ToList(); 
```

您也可以编写一个扩展方法来执行此操作而无需 if 语句：（编辑固定错字，返回类型应为 IQueriable

```
public static class LinqExtensions {
  public IQueriable<T> CondWhere<T>(this IQueriable<T> query, bool condition, Expression<Func<T,bool>> predicate) {
     if (condition)
        return query.Where(predicate);
     else 
        return query;
  }
 } 
```

并像这样编写您的 linq 查询：

```
 var deserts = db.Desserts;
      .CondWhere(filterbyAppleIdentity, q => appleIdentities.Contains(q.DesertsID));
      .CondWhere(filterbyChocolateIdentities, q => chocolateIdentities.Contains(q.DesertsID));
      .CondWhere(filterbicecreamIdentities, q => icecreamIdentities.Contains(q.DesertsID)).ToList(); 
```

另一种方法是合并 id 列表：

```
var deserts = db.Deserts
        .Where( d => appleIdentities.Union(chocolateIdentities).Union(icecreamIdentities).Contains(d.DesertsID); 
```

对于对象列表，您可以使用 .Select 扩展方法将列表投影到 int 或字符串 IEnumerable 中，并且可以以相同的方式在查询中使用 contains：

```
var deserts = db.Deserts
    .Where(d => 
        identities.Select(i => i.appleIdentity).Contains(d => d.DesertID) &&
        identities.Select(i => i.chokolateName).Contains(d => d.DesertsName)
     ) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T20:00:44.297

好吧，你可以试试：

```
var query = from dessert in db.Desserts
            where appleIdentities.Contains(dessert.AppleIdentity)
               && chocolateIdentities.Contains(dessert.ChocolateIdentity)
               && iceCreamIdentities.Contains(dessert.IceCreamIdentity)
            select new { dessert.Id, dessert.Name }; 
```

我相信这没关系，尽管当列表变得足够大 IIRC 时它会失败。这对于列表和数组应该没问题。

不过，我不确定您的第三个查询 - 我认为您需要每个单独的 Contains 调用的列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T20:01:14.513

当然 - 只需使用`Contains`- 以 Northwind 为例：

```
var qry = from cust in ctx.Customers
          where custIds.Contains(cust.CustomerID)
             && regions.Contains(cust.Region)
          select cust; // or your custom projection 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T20:49:19.110

正如其他人所说，LinqToSql 将转换`Contains`为`IN`.

有一些警告：

*   此翻译适用于`List<T>.Contains()`，但不适用于`IList<T>.Contains()`。它适用于数组吗？我不知道。
*   这种翻译会很高兴地翻译尽可能多的元素 - 每个元素都成为一个 sql 参数。SQL Server 2008 有大约 2000 个参数限制，如果您尝试使用太大的集合进行此操作，*则会向您抛出 sql 异常。*
*   当应用于字符串集合时，这种转换将产生**nvarchar**参数。**如果目标列是varchar**并且您想在该列上使用索引，这可能是一个严重的问题。Sql Server 将*转换索引*，而不是参数......这涉及读取和转换整个索引中的每个字符串。

**这是您的对象列表**问题的一些代码：

```
List<int> someIDs = identities
   .Select(x => x.appleIdentity).ToList();
List<string> someStrings = identities
   .Select(x => x.chokolateName).ToList();

var query = db.Desserts.Where(d =>
  someIDs.Contains(d.AppleIdentity) &&
  someStrings.Contains(d.ChocolateName)
  ) 
```

# java - JBoss 5.0.1 上的 servlet jar 文件在哪里？

> ID：731571
> 
> 赞同：6
> 
> 时间：2009-04-08T19:57:34.897
> 
> 标签：java, servlets, jboss, build

大家好： 我正在尝试设置我的构建文件以在 JBossAS 5.0.1 上运行部署，我需要找到我应该用于构建的 servlet jar 文件。

我看过的所有网页似乎都表明该文件是 javax.servlet.jar 并且它应该位于 C:\< install dir >\server\default\lib 目录中。我正在查看这个（以及我能想到的所有其他目录），但找不到这个文件。

我要么疯了，要么安装了一个不稳定的 jboss，要么有错误的信息。有人可以帮助我吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T21:17:05.347

您要查找的文件是`JBOSS_HOME/common/lib/servlet-api.jar`.

来自 JBossAS 5.0.0[发行说明](http://sourceforge.net/project/shownotes.php?release_id=645033)：“另一个值得注意的变化是，不同配置通用的大多数库已移动到新的共享位置 JBOSS_HOME/common/lib/。这是为了避免拥有多个发行版中的相同库。”

希望这可以帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-02-14T07:18:46.943

在 Jboss 6.2 中找到路径上所需的 jar：

> /jboss-eap-6.2/modules/system/layers/base/javax/servlet/api/main/jboss-servlet-api_3.0_spec-1.0.2.Final-redhat-1.jar

# c++ - 保存没有结束标记的 IXMLDOMDocument

> ID：731574
> 
> 赞同：1
> 
> 时间：2009-04-08T19:58:18.953
> 
> 标签：c++, xml, msxml, ixmldomdocument

通过 C++ 使用 MSXML，当我调用 时`IXMLDOMDocument::save`，空 XML 元素将获得一个结束标记，如下所示：

```
<root>
    <child name="first">
    </child>
</root> 
```

但我希望它保存为：

```
<root>
    <child name="first" />
</root> 
```

我需要做什么才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T02:26:53.993

如果没有子节点，DOM 本身会这样做，但我不知道为什么在你的情况下它会这样做。如果你想在 DOM 指针上显式调用 Pretty Print。

```
#include <msxml2.h>

bool FormatDOMDocument (IXMLDOMDocument *pDoc, IStream *pStream)
{

     // Create the writer
     CComPtr <IMXWriter> pMXWriter;
    if (FAILED (pMXWriter.CoCreateInstance(__uuidof (MXXMLWriter), NULL, CLSCTX_ALL)))
    {
        return false;
    }
    CComPtr <ISAXContentHandler> pISAXContentHandler;
    if (FAILED (pMXWriter.QueryInterface(&pISAXContentHandler)))
    {
        return false;
    }
    CComPtr <ISAXErrorHandler> pISAXErrorHandler;
    if (FAILED (pMXWriter.QueryInterface (&pISAXErrorHandler)))
    {
        return false;
    }
    CComPtr <ISAXDTDHandler> pISAXDTDHandler;
    if (FAILED (pMXWriter.QueryInterface (&pISAXDTDHandler)))
    {
        return false;
    }

   if (FAILED (pMXWriter ->put_omitXMLDeclaration (VARIANT_FALSE)) ||
       FAILED (pMXWriter ->put_standalone (VARIANT_TRUE)) ||
       FAILED (pMXWriter ->put_indent (VARIANT_TRUE)) ||
       FAILED (pMXWriter ->put_encoding (L"UTF-8")))
   {
       return false;
   }

   CComPtr <ISAXXMLReader> pSAXReader;
   if (FAILED (pSAXReader.CoCreateInstance (__uuidof (SAXXMLReader), NULL, CLSCTX_ALL)))
   {
      return false;
   }

   if (FAILED (pSAXReader ->putContentHandler (pISAXContentHandler)) ||
    FAILED (pSAXReader ->putDTDHandler (pISAXDTDHandler)) ||
    FAILED (pSAXReader ->putErrorHandler (pISAXErrorHandler)) ||
    FAILED (pSAXReader ->putProperty (
    L"http://xml.org/sax/properties/lexical-handler", CComVariant (pMXWriter))) ||
    FAILED (pSAXReader ->putProperty (
    L"http://xml.org/sax/properties/declaration-handler", CComVariant (pMXWriter))))
   {
      return false;
   }

   // Perform the write

   return SUCCEEDED (pMXWriter ->put_output (CComVariant (pStream))) &&
   SUCCEEDED (pSAXReader ->parse (CComVariant (pDoc)));
} 
```

# asp.net-mvc - ASP.NET MVC 局部视图和表单动作名称

> ID：731575
> 
> 赞同：4
> 
> 时间：2009-04-08T19:58:24.083
> 
> 标签：asp.net-mvc

如何创建具有指定 id 的表单的局部视图？我做到了：

```
using (Html.BeginForm(?action?,"Candidate",FormMethod.Post,new {id="blah"})) 
```

局部视图用于创建和编辑，因此第一个参数`?action?`将不同。我无法弄清楚`?action?`应该是什么价值。

* * *

**更新：**

我想我对这个问题还不够清楚。我最终做的是拆分`Request.RawUrl`以获取控制器名称和操作名称：

```
 string[] actionUrlParts = ViewContext.HttpContext.Request.RawUrl.Split('/');
 using (Html.BeginForm(actionUrlParts.Length >= 2? actionUrlParts[2] : "",
        actionUrlParts.Length >= 1 ? actionUrlParts[1] : "", FormMethod.Post, new { id = "blah" })) 
```

有点难看，但它有效。有没有更好的方法在局部视图中获取动作名称？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T20:08:41.347

通过 ViewData 传入要执行的操作。

在呈现视图的操作中，为回发操作创建一个 ViewData 项。在您的表单中引用此 ViewData 项以填写操作参数。或者，您可以创建一个仅包含操作和实际模型作为属性的视图模型，并从那里引用它。

使用 ViewData 的示例：

```
using (Html.BeginForm( (string)ViewData["PostBackAction"], "Candidate", ... 
```

渲染动作：

```
public ActionResult Create()
{
     ViewData["PostBackAction"] = "New";
     ...
}

public ActionResult Edit( int id )
{
     ViewData["PostBackAction'] = "Update";
     ...
} 
```

使用模型的示例

```
public class UpdateModel
{
     public string Action {get; set;}
     public Candidate CandidateModel { get; set; }
}

using (Html.BeginForm( Model.Action, "Candidate", ... 
```

渲染动作：

```
public ActionResult Create()
{
     var model = new UpdateModel { Action = "New" };

     ...

     return View(model);
}

public ActionResult Edit( int id )
{
     var model = new UpdateModel { Action = "Update" };

     model.CandidateModel = ...find corresponding model from id...

     return View(model);
} 
```

**编辑**：根据您的评论，如果您认为这应该在视图中完成（尽管我不同意），您可以尝试一些基于 ViewContext.RouteData 的逻辑

```
<%
    var action = "Create";
    if (this.ViewContext.RouteData.Values["action"] == "Edit")
    {
        action = "Update";
    }
    using (Html.BeginForm( action, "Candidate", ... 
    {
 %> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-21T19:26:14.620

将空值作为操作和控制器传递。扩展将只使用当前动作和当前控制器

```
using (Html.BeginForm(null, null, FormMethod.Post, new { id="Model" })) 
```

为表单生成的操作将与此部分视图的父视图相同。

它生成

```
<form action="/Orders/Edit/1" id="Model" method="post"> 
```

对于 url [http://localhost:1214/Orders/Edit/1](http://localhost:1214/Orders/Edit/1)

... 还有这个

```
<form action="/Orders/Create" id="Model" method="post"> 
```

对于 url [http://localhost:1214/Orders/Create](http://localhost:1214/Orders/Create)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:16:39.640

```
<% html.RenderPartial("MyUserControl", Model.ID) %> 
```

# c# - 新对象的值相等比较

> ID：731589
> 
> 赞同：1
> 
> 时间：2009-04-08T20:02:43.077
> 
> 标签：c#, .net, oop, domain-driven-design

我在抽象基类中重写了 Equals 和 GetHashCode 以实现基于对象的键属性的值相等。我的主要目的是能够在集合上使用 Contains 方法而不是 Find 或 FirstOrDefault 来检查是否已将实例添加到集合中。

```
public abstract class Entity
{
    public abstract Guid Id { get; }

    public override bool Equals(object obj)
    {
        if (obj == null)
        {
            return false;
        }

        if (obj.GetType() != GetType())
        {
            return false;
        }

        var entity = (Entity)obj;
        return (entity.Id == Id);
    }

    public override int GetHashCode()
    {
        return Id.GetHashCode();
    }

} 
```

这种方法的问题在于，我的所有对象在它们被持久化并获得一个 Id（由 NHibernate 生成）之前都是相等的。我做错了吗？我可以在构造函数中生成 Id，但我想为其他使用 int id 的项目实现相同的模式，所以这显然行不通。

在我看来，任何覆盖 Equals 的对象都将在对象被实例化后立即等于同一对象的任何其他实例。

**编辑添加：** 这是我关心的场景：在我的集合的 Add 方法中，我正在检查以确保集合尚未包含要添加的对象。如果所有新的对象都相等，那么我永远无法将两个新对象添加到集合中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T20:10:23.137

NHibernate 保证与相同上下文关联的实体的对象引用标识与数据库标识相同。因此无需重写 Equals() 和 GetHashCode()，因为这是您要实现的同一标识。

`10.3\. Considering object identity`请参阅[NHibernate 参考文档](http://www.hibernate.org/hib_docs/nhibernate/nhibernate_reference.pdf)。

此外，使用数据库生成的密钥将新实体与上下文相关联应该立即将该实体持久保存到数据库并将实体的密钥设置为生成的密钥。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T20:10:51.870

您应该在构造函数中获取您的 ID，或者至少是某种标识符。

如果没有设置ID（或者是默认值）；显然，Equals 方法将为任何相同类型的对象（也没有设置 ID）返回 true。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:11:32.010

如果 Id 未初始化，如果您返回“不等于”可能会有所帮助吗？

```
public override bool Equals(object obj)
{
    if (obj == null)
    {
        return false;
    }

    if (obj.GetType() != GetType())
    {
        return false;
    }

    var entity = (Entity)obj;
    if ((Id == Guid.Empty) || (entity.Id == Guid.Empty))
    {
      return false;
    }
    return (entity.Id == Id);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T16:04:16.070

有一个主要细节会影响您的决定：

> ...我想为使用 int ids 的其他项目实现相同的模式...

通常，在数据库中生成 ID 以强制*唯一性*。现在您有了 GUID，您不必依赖数据库来生成值 - GUID 保证是唯一的。不要因为错误的原因而遵循模式:)

所以继续在构造函数中创建 GUID 值 - 只需确保有一个设置器，以便 NHibernate 在从数据库中获取实体时可以覆盖该值。

此外，如果您的 DBA 关心 GUID 和数据库碎片，您可能需要考虑使用[COMB GUID 。](http://www.informit.com/articles/article.aspx?p=25862)

# c# - 任何人翻译 X12 271 医疗保健响应

> ID：731591
> 
> 赞同：6
> 
> 时间：2009-04-08T20:03:27.303
> 
> 标签：c#, edi, x12

我正在寻找将 271 医疗保健资格福利响应转换为更可用格式的 C# 代码，以便我可以将某些段和值显示到 datagridview 中。我正在寻找可以用来分解这个东西的代码，因为它并不难，只是非常乏味，并且想知道是否有其他人做过这个并愿意分享。

谢谢！！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2015-03-25T21:35:49.063

有一个开源 X12 解析器（OopFactory X12 解析器：[https](https://x12parser.codeplex.com) ://x12parser.codeplex.com ）可以为您执行此操作。

要将任何 X12 文档转换为 Xml：

```
FileStream fstream = new FileStream("Sample1.txt", FileMode.Open, FileAccess.Read);
var parser = new X12Parser();
Interchange interchange = parser.Parse(fstream);
string xml = interchange.Serialize(); 
```

要将任何 X12 文档转换为 Html：

```
var htmlService = new X12HtmlTransformationService(new X12EdiParsingService(suppressComments: false));
Stream ediFile = new FileStream("Sample.txt", FileMode.Open, FileAccess.Read);
string html = htmlService.Transform(new StreamReader(ediFile).ReadToEnd()); 
```

更多详细信息：[https ://x12parser.codeplex.com/wikipage?title=Parsing%20an%20837%20Transaction&referringTitle=Documentation](https://x12parser.codeplex.com/wikipage?title=Parsing%20an%20837%20Transaction&referringTitle=Documentation)

要将 X12 271 响应加载到 .Net 对象中，您可以使用：

```
FileStream fstream = new FileStream("Sample1.txt", FileMode.Open, FileAccess.Read);
var service = new EligibilityTransformationService();
EligibilityBenefitDocument eligibilityBenefitDocument = service.Transform271ToBenefitResponse(fstream); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-20T23:52:41.193

DataDirect Technologies 销售一种将其转换为 XML的[转换器。](http://www.xmlconverters.com/standards/hipaa)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-06-18T09:56:29.390

我推荐使用 perl 或 python 进行原型设计。一旦你有你想要的行为，你可以：

*   编译整个事情
*   让程序员为太慢的部分编写 C（无论您需要什么风格）。
*   使用原型作为您需要的任何语言的开发规范。

# php - 奇怪的 javascript 表单行为

> ID：731592
> 
> 赞同：0
> 
> 时间：2009-04-08T20:03:29.813
> 
> 标签：php, javascript, html, ajax

我正在使用这个 php 生成以下 html 表单：

```
echo "<form name=\"userForm\">
Username:
<input type=\"text\" name=\"username\" />
<br />
First name:
<input type=\"text\" name=\"firstname\" />
<br />
Last name:
<input type=\"text\" name=\"lastname\" />
<br />
<input name=\"Submit\" type=\"submit\" value=\"Update\" onclick=\"submitUserInfo();return false\"/>
</form>"; 
```

由 submitUserInfo 处理，这里是：

```
function submitUserInfo() {
    url = "edit_user.php?cmd=submitinfo&username="+document.userForm.username.value+"&firstname="+document.userForm.firstname.value+"&lastname="+document.userForm.lastname.value;
    var xmlHttp=GetXmlHttpObject();
    if(xmlHttp.responseText == 'true') {
        alert(url);
        xmlHttp.open("GET",url,true);
        xmlHttp.send(null);
        //updateByUser(username);
    }
} 
```

我显然将 url 定义为以

```
edit_user.php?cmd=submitinfo&username 
```

但是，当按下提交按钮时，它会尝试将 url 发送为

```
edit_user.php?username= 
```

我不知道为什么。我已经成功地将上述技术与我网站上的其他表单一起使用，并且找不到任何排除 cmd=submitinfo& 的原因。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T20:09:35.650

使用像 Firebug 这样的工具来确定浏览器是否在没有 cmd=submitinfo& 的情况下发送它，或者它是否在服务器端丢失。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T20:20:52.267

改变：

```
url = "edit_user.php?cmd=submitinfo&username="+document.userForm.username.value+"&firstname="+document.userForm.firstname.value+"&lastname="+document.userForm.lastname.value; 
```

到：

```
var url = "edit_user.php?cmd=submitinfo&username="+document.userForm.username.value+"&firstname="+document.userForm.firstname.value+"&lastname="+document.userForm.lastname.value; 
```

`url`在尝试使用它之前，您必须声明您的变量。

此外，避免`echo`直接将 HTML 插入页面。你完成它的方式将是调试、更新和风格化的绝对痛苦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:35:58.083

Frameworks like [jQuery](http://jquery.com) is not really needed for such simple tasks, although I would suggest you taking a look if you plan to implement more JavaScript on your site.

Your code, using jQuery, would look like this:

```
$("#<id of form goes here>").submit(function ()
{
    $.ajax({
        data: {
            "username": $("#<id of username-input goes here>").val(),
            "firstname": $("#<id of firstname-input goes here>").val(),
            "lastname": $("#<id of lastname-input goes here>").val()
        },

        url: "edit_user.php"
    });

    return false;
}); 
```

Looks a bit nicer, I think :)

Also; using frameworks - not jQuery in particular - takes care of browser work-arounds.. so you won't have to.. take care of 'em, that is :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T20:59:11.880

I think you need to change the type of the button from "submit" to "button":

```
<input name=\"Submit\" type=\"button\" value=\"Update\" onclick=\"submitUserInfo();return false\"/> 
```

# django - django queryset：选择加入 auth_user

> ID：731593
> 
> 赞同：0
> 
> 时间：2009-04-08T20:03:58.750
> 
> 标签：django

这可能是一个非常n00b的问题，但我无法让它工作。

如果我有以下型号：

```
from django.contrib.auth.models import User

class Entry(models.Model):
    title = models.CharField()
    users = models.ManyToManyField(User) 
```

我如何获得当前登录用户的所有条目标题的列表？就像是：

```
list = Entry.objects.filter(users__????__contains = request.user) 
```

?

在此先感谢您帮助我前进。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T20:13:39.213

在我的脑海中，我相信它可能是这样的：

```
list = Entry.objects.filter(users__id__exact = request.user.pk) 
```

或者

```
list = Entry.objects.filter(users = request.user) 
```

我相信其中任何一个都应该有效。有关[多对多关系](http://www.djangoproject.com/documentation/models/many_to_many/)的更多信息，请查看 Django 文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T00:08:34.687

我发现以下内容更优雅，但这取决于你。

```
request.user.entry_set.all() 
```

编辑：每次要查找与用户关联的条目时，您都不需要导入 Entry 模型类。使用 user.entry_set 可以避免这种麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T20:14:37.430

你应该能够做到这一点：

```
Entry.objects.filter(users=request.user) 
```

Django 将整理出与 M2M 表的正确连接，并添加一个 WHERE 子句将其限制为当前用户。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T20:18:32.647

```
Entry.objects.filter(users=request.user) 
```

并且您的代码中有错误。*CharField*需要*max_length*。

# version-control - 您如何解释 $Log$ 关键字的风险？

> ID：731595
> 
> 赞同：6
> 
> 时间：2009-04-08T20:04:58.857
> 
> 标签：version-control, keyword

我似乎进入了关于`$Log$`关键字使用的年度辩论。我的观点是这样的：

`$Log$`是白热化的死亡。

它所做的只是将无关紧要的垃圾邮件塞入您的源文件。任何人认为他们可以从 $Log$ 中获得的任何信息都更容易从您的版本控制系统中获得（并且可能更准确）。

那么，问题来了：您如何向“老派”编码员（他们认为 $Log$ 是管理源代码更改的方式）解释我们现在有更好的工具？

[CVSNT 对 $Log$ 的评论是一个好的开始](http://www.cvsnt.org/manual/html/Log-keyword.html)，但它们还不够明确。迄今为止，我想出的最接近的单行词是“`$Log$`是一个愿望。您*希望*垃圾邮件发送到您的文件中的内容与实际发生的事情有*任何*关系文件。”

*PS为了清楚起见：当我说“老派”时，我的意思是态度老，而不是岁数老。我的第一份编程薪水（也是一笔非常低的薪水）是在 1986 年的某个时候，我从没想过 $Log$ 是个好主意。*

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T20:09:04.497

我认为[Subversion FAQ](http://subversion.tigris.org/faq.html#log-in-source)也有很好的解释。

> 当您开始合并分支之间的更改时，$Log$ 是一种彻头彻尾的恐惧。实际上，您肯定会在那里遇到冲突，由于这个关键字的性质，根本无法自动解决。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T20:12:26.140

除了其他人所说的之外，尝试将评论 (/* ... */) 放入提交消息中：->。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T20:17:32.603

随着 $Log$ 语句对源文件的更改，源文件中有用位的数量会慢慢减少。我们在一些来自 CVS 的文件中有它，$Log$ 语句的行数比文件中的可执行代码实际长 10 倍。并且它有几组由于某些分支的错误合并而导致的重复。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T20:18:50.493

您可以考虑（强调*may*）在文件中嵌入*不可变*的元数据。
（请参阅我和“老学生”之间的辩论：[嵌入式版本号 - 好还是坏？](https://stackoverflow.com/questions/645008/what-are-the-basic-clearcase-concepts-every-developer-should-know/645424#645424)）。

尽管我一直认为这种做法是邪恶的（将元数据信息混合到数据中），引入了“合并地狱”，但有人可能会争辩说，使用正确的合并管理器，它可以适用于**具有固定格式的不可变元数据**，像：

*   $修订版$ $修订版：9.13 $
*   $日期$ $日期：2009/03/06 06:52:26 $
*   $RCSfile$ $RCSfile: stderr.c,v $

但是像日志这样的可变元数据？格式或内容未知？那是注定要失败的。

# sharepoint - 如何准确判断一个 SPFile 实例是否为转换后的文件？

> ID：731596
> 
> 赞同：1
> 
> 时间：2009-04-08T20:05:54.347
> 
> 标签：sharepoint, moss, openxml

我一直在研究使用 MOSS 2007 将 docx 文件转换为 pdf 文件的文档转换功能。在 ItemAdded 事件中进行了 SPFile.Convert() 调用，并且 ItemFileConverted 事件也被很好地触发了。事件似乎工作正常，但转换过程并不总是设置转换后的 SPFile 实例的 IsConvertedFile 和 SourceLeafName 属性。这就是我试图用来确定是否应该调用 SPFile.Convert 的方法。

在深入研究 SPFile IsConvertedFile、GeneratingConverterId 和 SourceLeafName 属性的代码时，似乎这些是基于 SPFile.Properties “vti_dttransformerid”和“vti_dtparentleafname”的。问题是，每当我的 ISPConversionProcessor.PostProcess() 实现中有代码时，这两个属性的设置并不一致，我希望在其中对文件进行一些后处理。如果 PostProcess 方法中没有代码（只有 runDefaultPostProcessing = true; 语句），则属性设置更加一致。

我[在 Wiki 页面中](http://wiki.threewill.com/display/enterprise/SharePoint+and+Open+XML)有一些关于正在发生的事情的其他详细信息，但是使用 .NET Reflector 来确定这些字段的更新位置是在 OWSTIMER.EXE 的一堵墙（我可以找到属性的所有读取，但是甚至 HtmlLauncher 和 LoadBalancer 服务也没有提到这些属性）。

有没有人完成了完整的文档转换实现并成功使用了 SPFile.IsConvertedFile 和 SPFile.SourceLeafName 属性？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T13:39:15.660

我为 SharePoint 创建了一个 PDF 转换器，但没有使用文档转换器功能，因为它不符合我们的需求并且不够灵活。

不确定此回复是否会作为垃圾邮件被丢弃，因为我现在要将您链接到可以下载免费试用版的地方。[下载适用于 SharePoint 的 PDF 转换器。](http://www.muhimbi.com/Products/PDF-Converter-for-SharePoint.aspx)

我现在觉得有点脏，但我可能真的帮助了你;-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T12:29:23.653

如果您不能信任 API，请将 IsConverted 元数据存储在 SPListItem 的属性包中。或者，如果您更喜欢在 UI 中显示它，请将另一个字段添加到您的列表中。这应该从事件处理程序中正常工作。

做额外的工作很烦人，但我想可能会有额外的元数据，你可以添加 SPFile 无论如何都无法提供的元数据。

# asp.net - 无法连接到内置 Web 服务器的 Web Developers

> ID：731598
> 
> 赞同：1
> 
> 时间：2009-04-08T20:06:00.603
> 
> 标签：asp.net, windows, webserver, visual-web-developer

当我昨天回到 Visual Web Developer 时，我不再能够运行/调试我的项目。单击绿色播放按钮启动 ASP.NET 开发服务器（它显示在系统托盘中），但浏览器仅显示错误消息“Firefox 无法连接到 localhost:58127”（翻译自瑞典语）。IE7 显示“无法显示网页”。

我无法弄清楚为什么会这样。几周前它起作用了。会不会有一个 Windows 设置把事情搞砸了？（我试图在没有任何更改的情况下禁用防火墙。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T23:31:21.407

你用的是Vista吗？我最近的 Vista 更新也有同样的问题。

首先，确保 Visual Studio 正在“以管理员身份”运行。

其次，当浏览器启动时，将“ [http://localhost](http://localhost) :”替换为“ [http://127.0.0.1](http://127.0.0.1) :”。如果这有效，那是因为 Windows 更新弄乱了您的主机文件。

如果是这种情况，请确保您的主机文件中有这一行，未注释：“127.0.0.1 localhost”

我的主机文件位于此目录中：“C:\Windows\System32\drivers\etc”

你的将与此类似。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T20:08:45.713

您是否正在使用[NOD32 或任何其他](http://insomniacgeek.com/blog/using-asp-net-development-server-with-nod32/)可能导致问题的防病毒软件？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-11T17:40:16.837

我今天遇到了这个问题，只是想详细说明一下，因为我的主机文件已经定义了“127.0.0.1 localhost”。

我可以通过引用 localhost 来查看默认的 IIS 站点，但是当我尝试在我的 IDE 中进行调试时，它总是会在 IE 中显示“无法显示网页”，并且在 Chrome 中显示“糟糕！Google Chrome 无法连接到 localhost”。

我打开命令提示符并输入“netstat -a”并查看结果。我看到我的调试 Web 服务器使用的端口仅在 [::1] 的本地地址上列为“LISTENING”：

TCP [::1]:64212 [计算机名]:0 监听

对我来说不寻常的是调试工作了一段时间，然后似乎突然停止了。前几次发生这种情况时，我重新安装了 Visual Web Developer Express 2010。这变得相当烦人，因为这是一个漫长的过程，而且问题在似乎是任意时间段后继续重新出现。

最近一次我更改了我的主机文件以包含“::1 localhost”（与此解决方案和我在网上找到的许多其他解决方案相反），这解决了我的调试环境问题。

我很感激这解决了我的问题，但我仍然对我的调试环境为什么以及如何变化感到好奇。另外，我很好奇为什么除了127.0.0.1之外还有多个环回地址。“::1”是ip6标准吗？如果是这样，localhost 不应该路由到 127.0.0.1 并由 tcp/ip 堆栈解释为与 ::1 相同吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-27T22:07:58.417

**我在使用Visual Studio 2013**时遇到了这个问题。我已经手动设置了**防火墙系统。**这意味着，在通信程序防火墙通知我的时间。防火墙阻止了错误链接到**“devenv.exe” 。**正确的通信模式“devenv.exe”将解决问题。在您的情况下检查防火墙选项和过滤的通信。

# coldfusion - 如何使自定义标签中的代码块仅在第一次调用该标签时运行？

> ID：731599
> 
> 赞同：4
> 
> 时间：2009-04-08T20:06:00.697
> 
> 标签：coldfusion, custom-tags

我正在创建一组 ColdFusion 自定义标签，旨在使某些布局元素的重用变得容易。我将以类似于以下方式使用它们：

```
<cfimport prefix="layout" taglib="commonfunctions/layouttags">

<layout:fadingbox>
    This text will fade in and out
</layout:fadingbox>
<layout:stockticker>
    This text will scroll across the screen
</layout> 
```

为了使这些自定义标记生成的代码能够正常工作，需要将 JavaScript 文件链接到页面，如下所示：

```
<script src="commonfunctions/layouttags/enablingscript.js" type="text/javascript"></script> 
```

我更愿意在自定义标签中包含脚本，而不是让用户自己包含它。问题是 JavaScript 文件每页只应包含*一次。*在第一次使用这些自定义标签中的一个之后，我希望后续调用同一页面上的同一标签以避免重复 <script> 标签。我突然想到我可以做这样的事情：

```
<cfif NOT isDefined("Caller.LayoutTagInitialized")>
    <script src="commonfunctions/layouttags/enablingscript.js" type="text/javascript"></script>
</cfif>
<cfset Caller.LayoutTagInitialized = 1> 
```

...但它似乎不优雅。

我想知道，有没有更好的方法？

你将如何实现这一点？

**编辑 - 澄清：**

如果我上面写的没有意义，这里有一个更详细的例子：

如果我有这样的自定义标签：

```
<cfif ThisTag.ExecutionMode EQ "start">
    <script src="commonfunctions/layouttags/enablingscript.js" type="text/javascript"></script>
    <div class="mytag">
<cfelse>
    </div>
</cfif> 
```

...我有 CFML 标记像这样调用标签：

```
<layout:mytag>
    One
</layout:mytag>
<layout:mytag>
    Two
</layout:mytag>
<layout:mytag>
    Three
</layout:mytag> 
```

...我希望生成如下 HTML：

```
<!-- Script included only the first time the tag is called -->
<script src="commonfunctions/layouttags/enablingscript.js" type="text/javascript"></script>
<div class="mytag">
    One
</div>
<!-- No <script> tag on the second call -->
<div class="mytag">
    Two
</div>
<!-- No <script> tag on the third call -->
<div class="mytag">
    Three
</div> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T21:42:29.653

使用请求范围。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T20:19:31.523

自定义标签有一个名为 thistag 的内置范围。

此代码将起作用：

```
<cfif thisTag.ExecutionMode eq "start"> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T20:43:46.800

您的解决方案并不遥远。

萨姆说得对，当您希望在标签的开始或结束模式中出现某些内容时，您想要使用执行模式，这是您想要的一部分。

但是然后您说您希望该脚本标记仅在页面上使用的第一个标记的启动模式下输出。

这就是您将使用彼得对请求范围的建议的地方。与默认（或“变量”）范围不同，请求范围在给定请求的所有自定义标记之间共享。您建议使用调用者范围，这也可以工作，除非调用者是另一个自定义标签，在这种情况下，调用者范围将只是自定义标签中的本地范围。请求范围（自 CF 4.01 以来一直存在）是您的最佳选择。

在这种情况下，您提出的解决方案很接近：在自定义标记中，在启动模式下，当您第一次放出脚本标记时，以编程方式检查您是否已经在请求范围内创建了跟踪变量。如果没有，则取出脚本标签并创建跟踪变量。

除了将代码从使用调用者更改为请求之外，我还建议您将 CFSET 放在 IF 中。当 IF 测试失败时无需再次执行。

# java - 带有 Cookie 的 Android MediaPlayer URL

> ID：731603
> 
> 赞同：5
> 
> 时间：2009-04-08T20:08:13.593
> 
> 标签：java, android, cookies, media-player

我有一个从网站播放音乐的 android 应用程序，但是要对流进行身份验证，您需要先发送 cookie IE：

[http://example.com/site/content?id=SOMEID](http://example.com/site/content?id=SOMEID) = mp3 格式流

如果您在没有 cookie 的情况下访问 url，您将收到 Server 500 错误。如果你有一个cookie，那么你会得到流。

对于我的生活，我无法弄清楚如何让媒体播放器在发送 cookie 时播放 URL。

但是，我可以播放任何不需要 cookie 的 url。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T14:37:07.187

据我所知，你不能。MediaPlayer 所做的几乎所有事情都是在本机代码中完成的，包括打开任何连接，因此无法访问它使用 AFAICT 的流。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-10-28T13:16:22.393

一种可能的解决方法是在您的 Android 应用程序中创建一个 Web 服务器，对其进行身份验证并下载您的 MP3，并让您的 MediaPlayer 使用本地服务器的地址（类似于`http://127.0.0.1:8000/mymp3.mp3`）调用 setDataSource。您可以在 Web 服务器类仍在下载时进行播放，因此理想情况下您的用户会注意到不同之处。

# testing - Castle Windsor：如何测试所有注册的组件都是可解析的？

> ID：731616
> 
> 赞同：5
> 
> 时间：2009-04-08T20:11:10.857
> 
> 标签：testing, castle-windsor

我想编写一个测试来确保注册到我的 WindsorContainer 的所有组件确实可以被解析。有人知道我该怎么做吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T22:48:11.273

请参阅 Bil Simser 的这些帖子：

*   [http://weblogs.asp.net/bsimser/archive/2008/06/04/the-first-spec-you-should-write-when-using-castle.aspx](http://weblogs.asp.net/bsimser/archive/2008/06/04/the-first-spec-you-should-write-when-using-castle.aspx)
*   [http://weblogs.asp.net/bsimser/archive/2008/06/27/testing-castle-windsor-mappings-part-deux.aspx](http://weblogs.asp.net/bsimser/archive/2008/06/27/testing-castle-windsor-mappings-part-deux.aspx)

# c# - 列表 到 ObservableCollection

> ID：731626
> 
> 赞同：17
> 
> 时间：2009-04-08T20:13:30.133
> 
> 标签：c#, silverlight

我在 Silverlight 应用程序中有一个方法，该方法当前返回 IList，我想找到最干净的方法将其转换为 ObservableCollection，因此：

```
public IList<SomeType> GetIlist()
{
   //Process some stuff and return an IList<SomeType>;
}

public void ConsumeIlist()
{
   //SomeCollection is defined in the class as an ObservableCollection

   //Option 1
   //Doesn't work - SomeCollection is NULL 
   SomeCollection = GetIlist() as ObservableCollection

   //Option 2
   //Works, but feels less clean than a variation of the above
   IList<SomeType> myList = GetIlist
   foreach (SomeType currentItem in myList)
   {
      SomeCollection.Add(currentEntry);
   }
} 
```

ObservableCollection 没有将 IList 或 IEnumerable 作为参数的构造函数，所以我不能简单地新建一个。是否有一个看起来更像我缺少的选项 1 的替代方案，或者我只是在这里过于挑剔，而选项 2 确实是一个合理的选择。

此外，如果选项 2 是唯一真正的选项，那么如果我真正要做的只是遍历返回值并将其添加到其他类型的集合中，是否有理由使用 IList 而不是 IEnuerable？

提前致谢

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-08T20:16:45.087

您可以编写一个快速而肮脏的扩展方法以使其变得容易

```
public static ObservableCollection<T> ToObservableCollection<T>(this IEnumerable<T> enumerable) {
  var col = new ObservableCollection<T>();
  foreach ( var cur in enumerable ) {
    col.Add(cur);
  }
  return col;
} 
```

现在你可以写

```
return GetIlist().ToObservableCollection(); 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-08T20:20:21.160

呃……

[`ObservableCollection`](http://msdn.microsoft.com/en-us/library/ms668604.aspx) **确实**有一个[构造函数](http://msdn.microsoft.com/en-us/library/cc679169.aspx)，该构造函数将采用[`IEnumerable<T>`](http://msdn.microsoft.com/en-us/library/9eekhta0.aspx), 并[`IList<T>`](http://msdn.microsoft.com/en-us/library/5y536ey6.aspx)派生自`IEnumerable<T>`.

所以你可以“刚刚上新”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T20:39:03.940

JaredPar 为您提供的扩展方法是您在 Silverlight 中的最佳选择。它使您能够通过引用命名空间自动将任何 IEnumerable 转换为 observable 集合，并减少代码重复。与提供构造函数选项的 WPF 不同，没有内置任何内容。

ib。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-08T15:41:14.593

不重新打开线程，但采用[IEnumerable](http://msdn.microsoft.com/en-us/library/cc679169%28v=VS.95%29.aspx)的 ObservableCollection 的构造函数已添加到 silverlight 4

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-01T00:35:04.020

Silverlight 4 确实有能力[“新建”一个 ObservableCollection](http://msdn.microsoft.com/en-us/library/cc679169%28v=VS.95%29.aspx)

这是 Silverlight 4 中可能的缩短扩展方法。

```
public static class CollectionUtils
{
    public static ObservableCollection<T> ToObservableCollection<T>(this IEnumerable<T> items)
    {
        return new ObservableCollection<T>(items);
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T20:22:45.837

```
 IList<string> list = new List<string>();

        ObservableCollection<string> observable = 
            new ObservableCollection<string>(list.AsEnumerable<string>()); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-08-14T02:27:55.113

```
Dim taskList As ObservableCollection(Of v2_Customer) = New ObservableCollection(Of v2_Customer)
' Dim custID As Guid = (CType(V2_CustomerDataGrid.SelectedItem,  _
'         v2_Customer)).Cust_UUID
' Generate some task data and add it to the task list.
For index = 1 To 14
    taskList.Add(New v2_Customer() With _
                 {.Cust_UUID = custID, .Company_UUID, .City
                 })
Next

Dim taskListView As New PagedCollectionView(taskList)
Me.CustomerDataForm1.ItemsSource = taskListView 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-03-04T23:49:47.713

你可以这样做：

```
public class SomeTypeCollection: ObservableCollection<SomeType>
{
    public SomeTypeCollection() : base() { }
    public SomeTypeCollection(IEnumerable<SomeType> IEObj) : base(IEObj) { 
 }
}

public ConsumeIlist
{
    public SomeTypeCollection OSomeTypeCllt { get; set; }
    MyDbContext _dbCntx = new MyDbContext();
     public ConsumeIlist(){
          OSomeTypeCllt = new 
   SomeTypeCollection(_dbCntx.ComeTypeSQLTable);
     }
} 
```

# windows - 在 Windbg 脚本中分配数据的最简单方法是什么？

> ID：731628
> 
> 赞同：1
> 
> 时间：2009-04-08T20:13:41.257
> 
> 标签：windows, scripting, windbg

我有一个我计划分配通过断点运行的 windbg 脚本。在这个脚本中，我想使用 .foreach 对命令进行标记，但我希望能够分配一个变量来记住有关当前标记的内容，以便下次在 for 循环周围。

例如，像这样的东西（用伪 windbg-script-code 编写）：

```
$thistokenisinteresting = false
.foreach (line {k100})
{
    .if ($thistokenisinteresting)
    {
        .printf line
        $thistokenisinteresting = false
    }
    .if ($SPAT("line","*SomeToken*")) 
    {
        $thistokenisinteresting = true
    }
} 
```

我不知道如何分配像 $thistokenisinteresting 这样的变量。我使用寄存器吗？这不会搞砸我的调试吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T20:46:32.800

我相信 $t0-$t19 是在脚本中用作变量的伪寄存器，您可以通过 r 设置它们。

IE，

r $t0 = 0 r $t0 = 1

等等

# c - 向gcc添加通行证？

> ID：731639
> 
> 赞同：8
> 
> 时间：2009-04-08T20:17:27.830
> 
> 标签：c, gcc, compiler-construction

有人向 gcc 添加了通行证吗？或者不是真正的通行证，而是添加一个选项来做一些讨厌的事情...... :-) ...

在从另一个函数返回之前调用一个函数我仍然有同样的问题......所以我想通过在 gcc 中实现一些东西来调查它......

干杯。

**编辑**：向编译器添加传递意味着重新访问树以执行一些优化或一些分析。我想模拟 __cyg_profile_func_exit 的行为，但仅适用于某些函数并且能够访问原始返回值。

所以我将尝试加强我的问题。我想模仿真正基本的类似 AOSD 的行为。AOSD 或面向方面的编程可以添加横切关注点（调试是横切关注点）。

```
int main(int argc, char ** argv) {
  return foo(argc);
}

int foo(int arg_num) { 
   int result = arg_num > 3 ? arg_num : 42;
   return result;
}

int dbg(int returned) {
   printf("Return %d", returned);
} 
```

我想说，我想在函数 foo 执行后触发 dbg 函数。问题是如何告诉编译器修改控制流并执行dbg。dbg 应该在 return 和 foo(argc) 之间执行...

这真的很像 __cyg_profile_function_exit 但仅在某些情况下（而 __cyg_profile_function_exit 中的问题是您无法轻松查看和修改返回的值）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-23T19:54:51.133

如果您仍然对添加 GCC 通行证感兴趣，您可以开始阅读 GCC Wiki 材料：

*   [http://gcc.gnu.org/wiki/WritingANewPass和来自](http://gcc.gnu.org/wiki/WritingANewPass)[http://www.airs.com/dnovillo/200711-GCC-Internals/](http://www.airs.com/dnovillo/200711-GCC-Internals/)的“实施通行证”关于如何添加通行证。
*   您感兴趣的中间表示称为 GIMPLE。一些介绍在[http://www.airs.com/dnovillo/200711-GCC-Internals/200711-GCC-Internals-3-IR.pdf](http://www.airs.com/dnovillo/200711-GCC-Internals/200711-GCC-Internals-3-IR.pdf)
*   [http://gcc.gnu.org/wiki/GettingStarted](http://gcc.gnu.org/wiki/GettingStarted)上的其他信息

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-19T11:58:17.427

仅供将来参考：即将推出的 gcc (4.4.0+) 版本将支持专门用于用例的[插件，例如向编译器添加](http://gcc.gnu.org/wiki/plugins)[优化传递](http://gcc.gnu.org/wiki/GCC_PluginAPI)，而无需引导整个编译器。

> 2009 年 5 月 6 日：GCC 现在可以在支持动态可加载对象的主机平台上使用通用插件框架进行扩展。（见[gcc.gnu.org](http://gcc.gnu.org)）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T20:33:35.967

回答你的问题：gcc 是一个非常流行的编译器平台，可以在上面进行编译器研究，所以是的，我相信有人已经做到了。

但是，我不认为这是在周末完成的事情。挂钩到 gcc 的代码生成不是你周末会做的事情。（我不确定你的范围是什么以及你愿意投入多少时间。）如果你真的想破解 gcc 来做你想做的事，你肯定想先在其中一个 gcc 上讨论它[邮件列表](http://gcc.gnu.org/lists.html)。

提示：不要假设人们已经阅读了您的其他问题。如果您想引用一个问题，请添加一个链接，如果您希望人们找到它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T13:59:36.827

这是一个有趣的问题。我将围绕这个问题讨论概念，而不是直接回答这个问题，因为，好吧，我对 gcc 内部结构了解不多。

您可能已经探索了源代码的一些更高级别的操作以实现您想要完成的目标；一些

```
int main(int argc, char ** argv) {
    return dbg(foo(argc));
} 
```

在函数“foo”上插入一个宏，也许。但是，如果您正在寻找编译器技巧，那么您可能不想修改源代码。

[这里](http://gcc.gnu.org/onlinedocs/gcc-4.3.3/gcc/Constructing-Calls.html#Constructing-Calls)讨论了一些 gcc 扩展，听起来有点像你想要的。如果 gcc 有任何你想要的东西，它可能会记录在文档的 C 语言[扩展](http://gcc.gnu.org/onlinedocs/gcc-4.3.3/gcc/index.html#toc_C-Extensions)区域中。我找不到任何听起来与您所描述的完全一样的东西，但也许因为您最了解您要查找的内容，您会更好地知道如何找到它。

gdb 脚本可以很好地输出调试，但听起来你有比简单地执行 printf 更大的计划。在代码中插入重要的逻辑似乎是您所追求的。

这让我想起了我最近遇到的一些动态链接器技巧。库[插入](http://technopark02.blogspot.com/2005/05/solaris-hijacking-function-call.html)可以在函数调用周围插入代码，而不会影响原始源。我遇到的例子是在 Solaris 上，但在其他平台上可能也有类似的例子。

刚刚遇到了[此处记录的 -finstrument-functions 选项](http://gcc.gnu.org/onlinedocs/gcc-4.3.3/gcc/Code-Gen-Options.html#Code-Gen-Options)

**-仪器功能**

生成用于进入和退出函数的检测调用。在函数进入之后和函数退出之前，将使用当前函数的地址及其调用站点调用以下分析函数。（在某些平台上， __builtin_return_address 在当前函数之外不起作用，因此调用站点信息可能无法用于分析函数。）

```
 void __cyg_profile_func_enter (void *this_fn,
                                         void *call_site);
          void __cyg_profile_func_exit  (void *this_fn,
                                         void *call_site); 
```

但我想这不起作用，因为您无法修改分析函数的返回值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T14:10:46.953

你需要使用GCC吗？[LLVM](http://llvm.org/)看起来会起作用。它是用 C++ 编写的，而且很容易[写一个 pass](http://llvm.org/docs/WritingAnLLVMPass.html)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T22:55:44.487

GCC，即 GNU 编译器集合，是一个大型套件，我不认为破解它的源代码是在单个应用程序中查找问题的答案。

听起来您正在寻找更多的调试或分析工具，例如[gdb](http://www.gnu.org/software/gdb/)及其各种前端（xgdb、ddd）和[gprof](http://sourceware.org/binutils/docs-2.19/gprof/)。如果这是内存或指针问题，内存/边界检查工具（如电子围栏、glibc 的[memcheck](http://hald.dnsalias.net/projects/memcheck/)、valgrind 和[mudflap）可能会有所帮助。](http://gcc.gnu.org/wiki/Mudflap_Pointer_Debugging)为警告和较新的 C 标准启用编译器标志可能很有用`-std=c99 -Wall -pedantic`。

我无法理解你的意思

> 在从另一个函数返回之前调用一个函数我仍然有同样的问题。

所以我不确定你在找什么。你能举一个简单或伪代码的例子吗？

IE

```
#include <stdio.h>
void a(void) {
   b();
}
void b(void) {
   printf("Hello World\n");
}
int main(int ac, char *av[]) {
   a();
   return 0;
} 
```

# c# - 如何在 C# 中将 HTML 转换为文本？

> ID：731649
> 
> 赞同：75
> 
> 时间：2009-04-08T20:20:16.433
> 
> 标签：c#, html, .net, parsing, text

我正在寻找将 HTML 文档转换为纯文本的 C# 代码。

我不是在寻找简单的标签剥离，而是在*合理*保留原始布局的情况下输出纯文本的东西。

输出应如下所示：

[W3C 的 Html2Txt](http://www.w3.org/services/html2txt)

我看过 HTML Agility Pack，但我认为这不是我需要的。有没有人有任何其他建议？

**编辑：我只是从**[CodePlex](http://html-agility-pack.net/?z=codeplex)下载 HTML Agility Pack ，然后运行 ​​Html2Txt 项目。多么令人失望（至少是进行 html 到文本转换的模块）！它所做的只是剥离标签、展平表格等。输出看起来与 W3C 生成的 Html2Txt 完全不同。太糟糕了，该来源似乎不可用。我正在寻找是否有更多“罐装”解决方案可用。

**编辑2：**谢谢大家的建议。 **FlySwat**将我引向了我想去的方向。我可以使用`System.Diagnostics.Process`该类运行带有“-dump”开关的 lynx.exe，以将文本发送到标准输出，并使用 and 捕获标准`ProcessStartInfo.UseShellExecute = false`输出`ProcessStartInfo.RedirectStandardOutput = true`。我将把所有这些包装在一个 C# 类中。这段代码只会偶尔被调用，所以我不太担心产生一个新进程而不是在代码中执行它。另外，Lynx 速度很快！！

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2014-08-07T09:21:24.513

只是一个关于 HtmlAgilityPack 的注释供后代使用。该项目包含一个[将文本解析为 html 的示例](https://github.com/zzzprojects/html-agility-pack/blob/master/src/Samples/Html2Txt/HtmlConvert.cs)，正​​如 OP 所指出的那样，它根本不像任何编写 HTML 的人所设想的那样处理空格。那里有全文渲染解决方案，其他人对此问题提出了意见，但事实并非如此（它甚至无法处理当前形式的表格），但它轻巧且快速，这是我创建简单文本所需的全部HTML 电子邮件的版本。

```
using System.IO;
using System.Text.RegularExpressions;
using HtmlAgilityPack;

//small but important modification to class https://github.com/zzzprojects/html-agility-pack/blob/master/src/Samples/Html2Txt/HtmlConvert.cs
public static class HtmlToText
{

    public static string Convert(string path)
    {
        HtmlDocument doc = new HtmlDocument();
        doc.Load(path);
        return ConvertDoc(doc);
    }

    public static string ConvertHtml(string html)
    {
        HtmlDocument doc = new HtmlDocument();
        doc.LoadHtml(html);
        return ConvertDoc(doc);
    }

    public static string ConvertDoc (HtmlDocument doc)
    {
        using (StringWriter sw = new StringWriter())
        {
            ConvertTo(doc.DocumentNode, sw);
            sw.Flush();
            return sw.ToString();
        }
    }

    internal static void ConvertContentTo(HtmlNode node, TextWriter outText, PreceedingDomTextInfo textInfo)
    {
        foreach (HtmlNode subnode in node.ChildNodes)
        {
            ConvertTo(subnode, outText, textInfo);
        }
    }
    public static void ConvertTo(HtmlNode node, TextWriter outText)
    {
        ConvertTo(node, outText, new PreceedingDomTextInfo(false));
    }
    internal static void ConvertTo(HtmlNode node, TextWriter outText, PreceedingDomTextInfo textInfo)
    {
        string html;
        switch (node.NodeType)
        {
            case HtmlNodeType.Comment:
                // don't output comments
                break;
            case HtmlNodeType.Document:
                ConvertContentTo(node, outText, textInfo);
                break;
            case HtmlNodeType.Text:
                // script and style must not be output
                string parentName = node.ParentNode.Name;
                if ((parentName == "script") || (parentName == "style"))
                {
                    break;
                }
                // get text
                html = ((HtmlTextNode)node).Text;
                // is it in fact a special closing node output as text?
                if (HtmlNode.IsOverlappedClosingElement(html))
                {
                    break;
                }
                // check the text is meaningful and not a bunch of whitespaces
                if (html.Length == 0)
                {
                    break;
                }
                if (!textInfo.WritePrecedingWhiteSpace || textInfo.LastCharWasSpace)
                {
                    html= html.TrimStart();
                    if (html.Length == 0) { break; }
                    textInfo.IsFirstTextOfDocWritten.Value = textInfo.WritePrecedingWhiteSpace = true;
                }
                outText.Write(HtmlEntity.DeEntitize(Regex.Replace(html.TrimEnd(), @"\s{2,}", " ")));
                if (textInfo.LastCharWasSpace = char.IsWhiteSpace(html[html.Length - 1]))
                {
                    outText.Write(' ');
                }
                    break;
            case HtmlNodeType.Element:
                string endElementString = null;
                bool isInline;
                bool skip = false;
                int listIndex = 0;
                switch (node.Name)
                {
                    case "nav":
                        skip = true;
                        isInline = false;
                        break;
                    case "body":
                    case "section":
                    case "article":
                    case "aside":
                    case "h1":
                    case "h2":
                    case "header":
                    case "footer":
                    case "address":
                    case "main":
                    case "div":
                    case "p": // stylistic - adjust as you tend to use
                        if (textInfo.IsFirstTextOfDocWritten)
                        {
                            outText.Write("\r\n");
                        }
                        endElementString = "\r\n";
                        isInline = false;
                        break;
                    case "br":
                        outText.Write("\r\n");
                        skip = true;
                        textInfo.WritePrecedingWhiteSpace = false;
                        isInline = true;
                        break;
                    case "a":
                        if (node.Attributes.Contains("href"))
                        {
                            string href = node.Attributes["href"].Value.Trim();
                            if (node.InnerText.IndexOf(href, StringComparison.InvariantCultureIgnoreCase)==-1)
                            {
                                endElementString =  "<" + href + ">";
                            }  
                        }
                        isInline = true;
                        break;
                    case "li": 
                        if(textInfo.ListIndex>0)
                        {
                            outText.Write("\r\n{0}.\t", textInfo.ListIndex++); 
                        }
                        else
                        {
                            outText.Write("\r\n*\t"); //using '*' as bullet char, with tab after, but whatever you want eg "\t->", if utf-8 0x2022
                        }
                        isInline = false;
                        break;
                    case "ol": 
                        listIndex = 1;
                        goto case "ul";
                    case "ul": //not handling nested lists any differently at this stage - that is getting close to rendering problems
                        endElementString = "\r\n";
                        isInline = false;
                        break;
                    case "img": //inline-block in reality
                        if (node.Attributes.Contains("alt"))
                        {
                            outText.Write('[' + node.Attributes["alt"].Value);
                            endElementString = "]";
                        }
                        if (node.Attributes.Contains("src"))
                        {
                            outText.Write('<' + node.Attributes["src"].Value + '>');
                        }
                        isInline = true;
                        break;
                    default:
                        isInline = true;
                        break;
                }
                if (!skip && node.HasChildNodes)
                {
                    ConvertContentTo(node, outText, isInline ? textInfo : new PreceedingDomTextInfo(textInfo.IsFirstTextOfDocWritten){ ListIndex = listIndex });
                }
                if (endElementString != null)
                {
                    outText.Write(endElementString);
                }
                break;
        }
    }
}
internal class PreceedingDomTextInfo
{
    public PreceedingDomTextInfo(BoolWrapper isFirstTextOfDocWritten)
    {
        IsFirstTextOfDocWritten = isFirstTextOfDocWritten;
    }
    public bool WritePrecedingWhiteSpace {get;set;}
    public bool LastCharWasSpace { get; set; }
    public readonly BoolWrapper IsFirstTextOfDocWritten;
    public int ListIndex { get; set; }
}
internal class BoolWrapper
{
    public BoolWrapper() { }
    public bool Value { get; set; }
    public static implicit operator bool(BoolWrapper boolWrapper)
    {
        return boolWrapper.Value;
    }
    public static implicit operator BoolWrapper(bool boolWrapper)
    {
        return new BoolWrapper{ Value = boolWrapper };
    }
} 
```

例如，以下 HTML 代码...

```
<!DOCTYPE HTML>
<html>
    <head>
    </head>
    <body>
        <header>
            Whatever Inc.
        </header>
        <main>
            <p>
                Thanks for your enquiry. As this is the 1<sup>st</sup> time you have contacted us, we would like to clarify a few things:
            </p>
            <ol>
                <li>
                    Please confirm this is your email by replying.
                </li>
                <li>
                    Then perform this step.
                </li>
            </ol>
            <p>
                Please solve this <img alt="complex equation" src="http://upload.wikimedia.org/wikipedia/commons/8/8d/First_Equation_Ever.png"/>. Then, in any order, could you please:
            </p>
            <ul>
                <li>
                    a point.
                </li>
                <li>
                    another point, with a <a href="http://en.wikipedia.org/wiki/Hyperlink">hyperlink</a>.
                </li>
            </ul>
            <p>
                Sincerely,
            </p>
            <p>
                The whatever.com team
            </p>
        </main>
        <footer>
            Ph: 000 000 000<br/>
            mail: whatever st
        </footer>
    </body>
</html> 
```

...将转化为：

```
Whatever Inc. 

Thanks for your enquiry. As this is the 1st time you have contacted us, we would like to clarify a few things: 

1\.  Please confirm this is your email by replying. 
2\.  Then perform this step. 

Please solve this [complex equation<http://upload.wikimedia.org/wikipedia/commons/8/8d/First_Equation_Ever.png>]. Then, in any order, could you please: 

*   a point. 
*   another point, with a hyperlink<http://en.wikipedia.org/wiki/Hyperlink>. 

Sincerely, 

The whatever.com team 

Ph: 000 000 000
mail: whatever st 
```

...相对于：

```
 Whatever Inc.

            Thanks for your enquiry. As this is the 1st time you have contacted us, we would like to clarify a few things:

                Please confirm this is your email by replying.

                Then perform this step.

            Please solve this . Then, in any order, could you please:

                a point.

                another point, with a hyperlink.

            Sincerely,

            The whatever.com team

        Ph: 000 000 000
        mail: whatever st 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-04-08T22:20:01.700

你可以使用这个：

```
 public static string StripHTML(string HTMLText, bool decode = true)
        {
            Regex reg = new Regex("<[^>]+>", RegexOptions.IgnoreCase);
            var stripped = reg.Replace(HTMLText, "");
            return decode ? HttpUtility.HtmlDecode(stripped) : stripped;
        } 
```

**更新**

感谢我更新以改进此功能的评论

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-08T20:33:14.767

我从一个可靠的来源听说，如果你在 .Net 中进行 HTML 解析，你应该再次查看 HTML 敏捷包。

[http://www.codeplex.com/htmlagilitypack](http://www.codeplex.com/htmlagilitypack)

SO..上的一些样本

[HTML 敏捷包 - 解析表](https://stackoverflow.com/questions/655603/html-agility-pack-parsing-tables)

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-08T20:26:23.300

您正在寻找的是一个输出文本的文本模式 DOM 渲染器，很像 Lynx 或其他文本浏览器......这比您预期的要难得多。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T20:27:48.757

您是否尝试过[http://www.aaronsw.com/2002/html2text/](http://www.aaronsw.com/2002/html2text/)它是 Python，但开源。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-06-07T02:09:20.153

假设您有格式良好的 html，您也可以尝试 XSL 转换。

这是一个例子：

```
using System;
using System.IO;
using System.Xml.Linq;
using System.Xml.XPath;
using System.Xml.Xsl;

class Html2TextExample
{
    public static string Html2Text(XDocument source)
    {
        var writer = new StringWriter();
        Html2Text(source, writer);
        return writer.ToString();
    }

    public static void Html2Text(XDocument source, TextWriter output)
    {
        Transformer.Transform(source.CreateReader(), null, output);
    }

    public static XslCompiledTransform _transformer;
    public static XslCompiledTransform Transformer
    {
        get
        {
            if (_transformer == null)
            {
                _transformer = new XslCompiledTransform();
                var xsl = XDocument.Parse(@"<?xml version='1.0'?><xsl:stylesheet version=""1.0"" xmlns:xsl=""http://www.w3.org/1999/XSL/Transform"" exclude-result-prefixes=""xsl""><xsl:output method=""html"" indent=""yes"" version=""4.0"" omit-xml-declaration=""yes"" encoding=""UTF-8"" /><xsl:template match=""/""><xsl:value-of select=""."" /></xsl:template></xsl:stylesheet>");
                _transformer.Load(xsl.CreateNavigator());
            }
            return _transformer;
        }
    }

    static void Main(string[] args)
    {
        var html = XDocument.Parse("<html><body><div>Hello world!</div></body></html>");
        var text = Html2Text(html);
        Console.WriteLine(text);
    }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-10-04T16:06:01.830

因为我想用 LF 和项目符号转换为纯文本，所以我在 codeproject 上找到了这个漂亮的解决方案，它涵盖了许多转换用例：

[将 HTML 转换为纯文本](http://www.codeproject.com/Articles/11902/Convert-HTML-to-Plain-Text)

是的，看起来很大，但工作正常。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-10-18T07:43:36.640

我对 HtmlAgility 有一些解码问题，我不想花时间调查它。

相反，我使用了 Microsoft Team Foundation API中的[该实用程序：](https://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.workitemtracking.controls.htmlfilter.converttoplaintext(v=vs.120).aspx)

```
var text = HtmlFilter.ConvertToPlainText(htmlContent); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-08T20:27:28.103

最简单的可能是标签剥离结合使用文本布局元素替换一些标签，例如列表元素 (li) 的破折号和 br 和 p 的换行符。将其扩展到表格应该不会太难。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-08T20:36:18.563

[另一篇文章](https://stackoverflow.com/questions/356597/render-or-convert-html-to-formatted-text-net)建议使用[HTML 敏捷包](http://www.codeplex.com/htmlagilitypack)：

> 这是一个敏捷的 HTML 解析器，它构建了一个读/写 DOM 并支持普通的 XPATH 或 XSLT（你实际上不必了解 XPATH 或 XSLT 就可以使用它，不用担心......）。它是一个 .NET 代码库，允许您解析“网络之外”的 HTML 文件。解析器对“真实世界”格式错误的 HTML 非常宽容。对象模型与 System.Xml 的提议非常相似，但用于 HTML 文档（或流）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-08T22:20:25.867

我过去使用[过 Detagger](http://www.jafsoft.com/detagger/)。它在将 HTML 格式化为文本方面做得非常好，而且不仅仅是一个标签去除器。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-01-11T14:20:24.970

此功能将“您在浏览器中看到的内容”转换为带有换行符的纯文本。（如果您想在浏览器中查看结果，只需使用注释返回值）

```
public string HtmlFileToText(string filePath)
{
    using (var browser = new WebBrowser())
    {
        string text = File.ReadAllText(filePath);
        browser.ScriptErrorsSuppressed = true;
        browser.Navigate("about:blank");
        browser?.Document?.OpenNew(false);
        browser?.Document?.Write(text);
        return browser.Document?.Body?.InnerText;
        //return browser.Document?.Body?.InnerText.Replace(Environment.NewLine, "<br />");
    }   
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-05-14T17:01:00.853

这是使用 HtmlAgilityPack 的简短而甜蜜的答案。您可以在 LinqPad 中运行它。

```
var html = "<div>..whatever html</div>";
var doc = new HtmlAgilityPack.HtmlDocument();
doc.LoadHtml(html);
var plainText = doc.DocumentNode.InnerText; 
```

我只是在任何需要 HTML 解析的 .NET 项目中使用 HtmlAgilityPack。它简单、可靠且快速。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-04-08T20:28:40.643

我不知道 C#，但这里有一个相当小且易于阅读的 python html2txt 脚本：[http ://www.aaronsw.com/2002/html2text/](http://www.aaronsw.com/2002/html2text/)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-11-05T21:01:25.243

我[最近在博客上写了一个](http://www.prolificnotion.co.uk/index.php/2009/11/04/convert-html-to-plain-text-in-c-using-markdown/)对我有用的解决方案，它使用 Markdown XSLT 文件来转换 HTML 源。HTML 源代码当然首先需要是有效的 XML

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2015-06-16T12:11:20.173

**尝试简单实用的方法：** 只需调用`StripHTML(WebBrowserControl_name);`

```
 public string StripHTML(WebBrowser webp)
        {
            try
            {
                doc.execCommand("SelectAll", true, null);
                IHTMLSelectionObject currentSelection = doc.selection;

                if (currentSelection != null)
                {
                    IHTMLTxtRange range = currentSelection.createRange() as IHTMLTxtRange;
                    if (range != null)
                    {
                        currentSelection.empty();
                        return range.text;
                    }
                }
            }
            catch (Exception ep)
            {
                //MessageBox.Show(ep.Message);
            }
            return "";

        } 
```

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2011-06-01T14:47:03.907

在 Genexus 中，您可以使用 Regex

&pattern = '<[^>]+>'

&TSTRPNOT=&TSTRPNOT.ReplaceRegEx(&pattern,"")

在 Genexus possiamo gestirlo con Regex 中，

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2014-10-25T23:23:55.003

如果您使用的是 .NET 框架 4.5，则可以使用 System.Net.WebUtility.HtmlDecode()，它采用 HTML 编码字符串并返回解码字符串。

记录在 MSDN 上：http: [//msdn.microsoft.com/en-us/library/system.net.webutility.htmldecode (v=vs.110).aspx](http://msdn.microsoft.com/en-us/library/system.net.webutility.htmldecode(v=vs.110).aspx)

您也可以在 Windows 应用商店应用程序中使用它。

* * *

## 回答 #19

> 赞同：-3
> 
> 时间：2010-09-22T06:52:37.263

您可以使用**WebBrowser**控件在内存中呈现您的 html 内容。在**LoadCompleted**事件触发后...

```
IHTMLDocument2 htmlDoc = (IHTMLDocument2)webBrowser.Document;
string innerHTML = htmlDoc.body.innerHTML;
string innerText = htmlDoc.body.innerText; 
```

* * *

## 回答 #20

> 赞同：-4
> 
> 时间：2009-09-29T11:23:41.453

这是在 C# 中将 HTML 转换为文本或 RTF 的另一种解决方案：

```
 SautinSoft.HtmlToRtf h = new SautinSoft.HtmlToRtf();
    h.OutputFormat = HtmlToRtf.eOutputFormat.TextUnicode;
    string text = h.ConvertString(htmlString); 
```

这个库不是免费的，这是商业产品，它是我自己的产品。

# c# - 将字节流从模型传递到视图，以便用户保存

> ID：731651
> 
> 赞同：0
> 
> 时间：2009-04-08T20:20:37.103
> 
> 标签：c#, asp.net-mvc

我有一个调用另一个服务来生成 pdf 的 asp.net MVC 应用程序。我希望用户能够单击视图中的链接并从浏览器中获取“另存为...”对话框以保存 pdf。

对第 3 方服务的调用是在使用 WebClient 的模型中进行的。

如何将来自 WebClient 的数据调用到 View 并输出到浏览器以便保存？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T20:31:18.607

试试这个

```
Response.AddHeader("content-disposition", fileName);    
Response.ContentType = "application/pdf";
Response.BinaryWrite(byteArray); 
```

当然 bytearray 来自你需要做的 WebRequest 来获取文件

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T23:19:27.160

更好的是，使用我们的文件助手之一。

```
public ActionResult ShowPdf() {
  byte[] byteArray = GetBytes();
  return File(byteArray, "application/pdf");
} 
```

# c# - nHibernate 映射问题 - 无法删除集合的成员

> ID：731655
> 
> 赞同：0
> 
> 时间：2009-04-08T20:21:00.817
> 
> 标签：c#, nhibernate, collections, nhibernate-mapping, parent-child

行。所以情况是：

具有子类 IDictionary 的父类。我希望在父类存在时删除这些子类。这工作正常。我还希望能够单独删除子类的成员，但这不起作用。

所以我的问题是；为什么我不能删除这些子成员？

我得到的错误是：

> 不能删除，会被级联读取

我在父类中的映射文件具有“all-delete-orphan”的级联设置，而子类没有定义级联。

任何的想法？干杯。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T23:54:26.920

查看映射会很有帮助。但我的猜测是，除了删除它之外，您并没有从父集合中删除它。

# c# - 如何在报表服务中为报表查看器控件创建此报表？

> ID：731656
> 
> 赞同：2
> 
> 时间：2009-04-08T20:21:05.950
> 
> 标签：c#, .net, reporting-services, reportviewer

我在我的项目中使用 Visual Studio 2008 创建了这个数据集。我已经用我需要的数据填充了每个表。将有多个工单，每个子表将有 0 个或多个与工单表相关的项目。没有建立作为数据集一​​部分的关系（目前）。我还创建了这个报告，可以很好地处理一张票。如果可能的话，我想扩展它以处理多张票。

数据集被传递到报表中，并且来自报表查看器控件的打开为数据集中的每个表设置了绑定源。

  [![](https://i.stack.imgur.com/eetrX.jpg)](https://i.stack.imgur.com/eetrX.jpg)   [![](https://i.stack.imgur.com/xlL06.jpg)](https://i.stack.imgur.com/xlL06.jpg)

我需要报告在单页（或根据需要两页）上打印出每张带有子数据的票。然后为下一张票开始一个新页面。

我还没有想出一个有效的信息分组方案。我已经显示了所有表格，但是如果没有 FIRST 聚合，我无法访问子信息，这无济于事，因为每张票对于打印的每个部分都有相同的 1 条记录。

有什么建议么？我知道可能需要更多信息，因此请根据需要提出问题，我将使用更多信息和/或评论更新此帖子。

编辑：我们最终将子数据表变成了子报告。然后，我们将票号作为参数传递到子报告中，并适当地过滤子数据表。除了一些小的格式问题，我们必须解决这个问题，但这解决了我们需要做的事情。每张票都放在一个列表中，并为每张票运行子报告。

*   开始报告
*   票 1
*   -- 带有注释、历史记录和响应的子报告。
*   票 2
*   -- 带有注释、历史记录和响应的子报告。
*   ETC
*   结束报告

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T21:48:59.810

在我看来，您需要将所有信息/控件放入单个表格控件中。然后将表格控件格式化为您想要的外观。

# sharepoint - SharePoint 列表项是否可以计算或以其他方式自动指定其目标受众？

> ID：731657
> 
> 赞同：4
> 
> 时间：2009-04-08T20:21:30.317
> 
> 标签：sharepoint, moss

我想向用户显示列表中的目标（过滤）内容。我已经在列表中有一个基本上具有目标受众值的列。此字段是一个多选列（复选框输入），我更喜欢目标受众的当前输入字段。

不幸的是，为了让受众过滤起作用，我需要为每个列表项填写目标受众字段。我目前的计划是使用简单的 SharePoint 设计器工作流来根据我的其他字段设置 Targeted Audiences 字段，但我想知道是否有更好的方法。我只是看错了吗？

请注意，我知道受众也可用于隐藏/显示 Web 部件，但这不是我感兴趣的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T19:45:37.287

你可以试试看这个...

```
SPField audienceField = null;

try
{
    audienceField = list.Fields[Microsoft.SharePoint.Publishing.FieldId.AudienceTargeting]
}
catch
{}

if(audienceField != null)
{
try
{
    Audience siteAudience;
    ServerContext context = ServerContext.GetContext(site);
    AudienceManager audManager = new AudienceManager(context);
    foreach (SPListItem item in list.Items)
    {
      string audienceName = item["fakeAudienceField"]; //should be the audience name created in SSP
      siteAudience = audManager.GetAudience(audienceName);
      Guid id = siteAudience.AudienceID;
      item["Target Audiences"] = id.ToString()+";;;;";
      item.Update();
    }
}
catch
{} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T21:48:08.423

也许使用 webpart 来显示列表的内容并在 webpart 上使用 Audiences 听起来是一个更易于管理的解决方案......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T22:43:54.213

我不相信目标受众可以设置为计算字段，在这种情况下，您的选项是工作流或列表项事件接收器。

要设置受众字段值，您可以使用[`AudienceManager.GetAudienceIDsAsText`](http://msdn.microsoft.com/en-us/library/microsoft.office.server.audience.audiencemanager.getaudienceidsastext.aspx); Gary Lapointe 有一个[示例用法的帖子](http://stsadm.blogspot.com/2008/04/programmatically-setting-web-part.html)。

# sql-server - 如何以与 MSSQL 2000 和 2005 兼容的方式将这两个 SQL 语句合并为一个？

> ID：731662
> 
> 赞同：0
> 
> 时间：2009-04-08T20:22:37.053
> 
> 标签：sql-server, sql-server-2005, tsql, sql-server-2000

我的最终目标是完成类似的事情：

```
CREATE FOREIGN KEY IF NOT EXISTS FOREIGN KEY 
```

由于该声明似乎不存在，因此我试图将其组合在一起。

我有一个语句将返回 FK 名称（如果存在）：

```
SELECT f.name AS ForeignKey
FROM sys.foreign_keys AS f 
WHERE OBJECT_NAME(f.parent_object_id) = 'myTableName' 
```

我有一个添加所需外键的语句：

```
ALTER TABLE myTableName
WITH CHECK 
ADD CONSTRAINT [FK_myTableName_otherTable] 
FOREIGN KEY([columnName]) 
REFERENCES otherTable ([otherColumn]) 
```

对于我的一生，我只是无法弄清楚如何将它们混合在一起成为一个单一的陈述。

绝对要求该解决方案在 MS SQL 2000 和 MS SQL 2005 中都可以工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T20:26:22.677

```
if not exists (SELECT f.name AS ForeignKey
FROM sys.foreign_keys AS f 
WHERE OBJECT_NAME(f.parent_object_id) = 'myTableName'
)
begin
    ALTER TABLE myTableName
    WITH CHECK 
    ADD CONSTRAINT [FK_myTableName_otherTable] 
    FOREIGN KEY([columnName]) 
    REFERENCES otherTable ([otherColumn])
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T20:43:37.267

[sys.foreign_keys](http://msdn.microsoft.com/en-us/library/ms189807(SQL.90).aspx)是在 SQL Server 2005 中引入的。您必须使用[sysobjects](http://msdn.microsoft.com/en-us/library/ms177596(SQL.90).aspx)才能与 SQL Server 2000 和 2005 兼容。

试试这个 SQL：

```
IF NOT EXISTS (
    SELECT NULL FROM sysobjects 
    WHERE name = 'FK_myTableName_otherTable' 
    AND parent_obj = OBJECT_ID(N'myTableName'))
ALTER TABLE myTableName
WITH CHECK 
ADD CONSTRAINT [FK_myTableName_otherTable] 
FOREIGN KEY([columnName]) 
REFERENCES otherTable ([otherColumn]) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:27:56.573

```
if not exists (
    SELECT f.name AS ForeignKey
    FROM sys.foreign_keys AS f 
    WHERE OBJECT_NAME(f.parent_object_id) = 'myTableName') 
begin
    ALTER TABLE myTableName
    WITH CHECK 
    ADD CONSTRAINT [FK_myTableName_otherTable] 
    FOREIGN KEY([columnName]) 
    REFERENCES otherTable ([otherColumn])
end 
```

# java - 在 JBoss 5.0.x 中创建单个 jbossall-client.jar 包？

> ID：731669
> 
> 赞同：0
> 
> 时间：2009-04-08T20:24:59.107
> 
> 标签：java, jboss

从 JBoss 5.0.0 开始，jbossall-client.jar 只包含一个指向客户端目录中所有 jar 的清单。有没有办法创建一个包含所有这些类的 jbossall-client.jar 而不必将 70 个左右的单个 jar 放在类路径上？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T03:28:47.637

可能不建议将所有客户端 jar 合并到一个 jar 中。但是，如果您希望看到一个包含所有类的单个 jar，一种方法是编写一个 ant 脚本，该脚本可以将所需的 jar 解压到临时目录，然后在临时目录中制作一个类的 jar。

```
 <target name="unjar.jar">
        <unjar dest="${temp.dir}">
              <patternset>
                    <include name="**/*.class" />
              </patternset>
              <fileset dir="${lib.dir}">
                    <include name="**/*.jar" />
              </fileset>
        </unjar>
  </target>

  <target name="combine.jar" depends="unjar.jar">
        <jar jarfile="${base.dir}/${jar.filename}"
              basedir="${temp.dir}" includes="**/*.class" update="true"
              compress="false">
        </jar>
        <delete dir="${temp.dir}" quiet="true" />
  </target> 
```

# ssas - 通过 SMS 浏览分析服务时出错

> ID：731672
> 
> 赞同：0
> 
> 时间：2009-04-08T20:26:22.677
> 
> 标签：ssas

尝试通过 SQL Management Studio 浏览任何已部署的多维数据集时出现异常：0x800414154 (REGDB_E_CLASSNOTREG)。我读到它与 Microsoft.Jet.OLEDB 4.0 有关，但不确定如何解决问题。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T13:30:14.243

在我发布这个问题后大约 2 分钟发现了这个问题。Microsoft 建议这可能是因为您在同一台计算机上安装了以前版本的 SQL Server，并且您应该重新注册，但在我的情况下，这是因为我缺少可以在此处下载的 Microsoft Office Web 组件 (OWC)：

[http://www.microsoft.com/downloads/details.aspx?FamilyId=7287252C-402E-4F72-97A5-E0FD290D4B76&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=7287252C-402E-4F72-97A5-E0FD290D4B76&displaylang=en)

# sql-server - Best way to literal phrase search a text column in SQL Server

> ID：731686
> 
> 赞同：0
> 
> 时间：2009-04-08T20:28:43.717
> 
> 标签：sql-server, full-text-search, sql-like

I thought full-text search would let me do exact phrase searching in a more optimized way than a LIKE predicate, but I'm reading that it doesn't do that exactly.

Is "LIKE" the most efficient way to search thousands of rows of TEXT fields in a table for a literal string?

It's got to be exact matching...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T21:00:46.993

如果您在列上有正确的索引并且您只在值的开头查找“字符串”，LIKE(string%) 将更快地工作。如果“字符串”可能在您的值的中间，您必须使用 LIKE(%string%) ；在这种情况下会触发表扫描，而且速度很慢（主要比全文搜索慢）。您可以使用全文搜索的 CONTAINS() 函数进行精确匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T20:30:25.037

Apparently, `CONTAINS` is faster than a `LIKE` query...

[http://www.docstoc.com/docs/2280727/Microsoft-SQL-Server-70-Full-Text-Search-What-is-full-text-search](http://www.docstoc.com/docs/2280727/Microsoft-SQL-Server-70-Full-Text-Search-What-is-full-text-search)

(Profiling can be found on Page 19 of that presentation)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:36:37.923

What version of SQL Server are you on? I would recommend replacing TEXT with VARCHAR(MAX), if you ever can (SQL Server 2005 and up).

What makes you say that full text won't work? How have you set up fulltext, and what do your fulltext queries look like?

Marc

# java - 在 Java 接口中，我如何*不*使用从父接口继承的特定方法？

> ID：731704
> 
> 赞同：3
> 
> 时间：2009-04-08T20:36:04.510
> 
> 标签：java, interface

我有三个接口的层次结构，祖父母，父母和孩子。**parent 和 child 有一个方法“add”，它需要在 child 中输入不同的参数。**虽然**在孩子中添加所需的签名没有问题，但继承的方法将毫无意义**，那么有没有办法根本没有它呢？**其他方法工作正常。**

也许，为了实现我想要的，我可以完全改进设计，所以我将简要概述接口的含义：

我收集由时间和值组成的仪表读数。祖父母界面用于单次阅读。我还有代表多个连续读数（一个系列）的类，以及一个包含在同一时间段内运行的多个系列的类（我们称之为表格）。

该表可以被视为一个系列（它聚合与时间轴正交的值），并且表和系列都可以被视为一个单一的读数（实现提供不同的聚合方式），因此是继承。这似乎很好，但对于 add 方法。（我可以在系列中添加一个点，但对于表格，我需要一个额外的参数来告诉我它属于哪个系列。）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T20:44:34.800

不，您不能避免继承方法，因为这样做会违反[Liskov 替换原则](http://en.wikipedia.org/wiki/Liskov_substitution_principle)。

在实践中，你可以让实现抛出一个`UnsupportedOperationException`，但这会很讨厌。

你不能用系列的某种默认值来实现继承的方法吗？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T20:41:44.760

也许将接口继承全部中断是有意义的。只需为特定类型的行为提供特定接口。无论您拥有实现这些接口的任何类，都可以选择有意义的类，而不必担心实现没有意义的方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T20:59:53.687

继承的问题在于，对语言机制的关注使人们考虑实现而不是语义。

当 B 从 A 继承时，这意味着 B 的每个实例也是 A 的实例。在 OOP 中，作为某物的实例通常意味着您应该对其方法有一个合理的响应，并且至少支持它们的消息。

如果您认为 B 不应该支持 A 的消息之一，那么就我而言，您有两种选择：

不好 - 抛出一个“未实现”异常，就像使用集合框架一样。但是，在我看来，这是一种糟糕的形式。

好 - 接受 B 不是 A 的类型并避免继承，或重组它（例如，使用组合和/或接口），这样您就不必重写代码但不使用子类型关系。如果您的应用程序将随着时间的推移而存在，您不希望在您的层次结构中存在语义问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T21:10:42.927

感谢您让我走上正轨，我对我认为最有帮助的帖子投了赞成票。由于我的解决方案受到帖子的启发，但没有发布，我将分享我决定做的事情：

由于层次结构的灵感来自应如何*查看*数据，而问题出现在如何*添加*数据的语义上，我将把系列和表的接口拆分为一个读取和一个写入接口。写接口彼此无关，读接口可以继承而不会冲突。

我会制作这个 wiki，以防有人想对此进行扩展。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T21:17:58.713

您可能想查看[Refused Bequest](http://sourcemaking.com/refactoring/refused-bequest)代码气味。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T20:41:34.043

接口是一种契约。这意味着实现该接口的任何东西都必须实现定义的方法。从技术上讲，您可以将其实现为虚拟方法（没有主体，只需返回，无论如何），但据我所知，它必须实现。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T20:44:51.710

您始终可以将该方法实现为空，例如：

```
class A implements B{ void add(A) { /*Goes Nowhere Does Nothing*/ return;} } 
```

但实际上，这不是一个好主意。一个更好的解决方案是让你的所有祖父母、父母和孩子都是同一个类，并使用两个额外的方法 - hasParent():boolean 和 hasChild():boolean。这具有成为 liskov 替换兼容更改以及更简洁的设计的好处。

# bash - 我可以使用 cygwin 编写 hudson 构建步骤的脚本吗？

> ID：731705
> 
> 赞同：1
> 
> 时间：2009-04-08T20:36:06.023
> 
> 标签：bash, continuous-integration, cygwin, hudson

我尝试执行以下操作：

```
#!C:\cygwin\bin\bash.exe
ls ${WORKSPACE} 
```

但这找不到 ls （即使它在 windows 路径上）。有什么办法可以设置吗？

**更新**：换句话说，我希望能够设置一个使用 cygwin bash 而不是 windows cmd 的构建步骤，就像[这个页面](http://wiki.hudson-ci.org/display/HUDSON/Shells)向您展示了如何使用 Python。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T05:19:57.543

所以把你`cygwin`的`bin`目录放在你的`PATH`.

如果您不知道如何操作 ( `Control Panel`-> `System`-> `Advanced`-> `Environment Variables`)，请参阅：[http://support.microsoft.com/kb/310519](http://support.microsoft.com/kb/310519)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T20:41:58.957

该 shell 脚本有两个错误：hash-bang 行应该是“#!/bin/bash”，并且 ${WORKSPACE} 不是 shell 变量。Hudson 有一堆自己的变量，这些变量在您指定要运行的命令中扩展（即，当您在 web gui 中添加命令时）。

如果要在 Cygwin 命令行上运行 Hudson 构建步骤，则需要弄清楚 Hudson 运行什么命令以及在哪个目录中运行。

要给出更具体的答案，您需要向我们展示您的项目是如何配置的，以及您希望单独运行哪些步骤。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T22:18:13.337

如果 cygwin 的 bin 文件夹在您的路径中，则以下内容对我有用：

```
#!/bin/sh
ls ${WORKSPACE} 
```

我发现除非您重新启动服务器，否则 Hudson 不会选择环境变量更改。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T20:55:41.967

您可能想尝试提供 ls 的完整路径

```
/cygdrive/c/cygwin/bin/ls 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T21:05:09.477

似乎有效的另一件事是使用它：

```
#!C:\cygwin\bin\bash.exe
export PATH=$PATH:/usr/bin
ls 
```

但是最好不必修改每个脚本的路径。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T22:24:35.740

您是否考虑过[电源外壳](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)？尽管我很喜欢 cygwin，但它总是有点不稳定，powershell 是 Windows 上功能齐全的可靠 shell，另一种选择是[Windows Services for UNIX](http://technet.microsoft.com/en-us/interopmigration/bb380242.aspx)它为您提供的 korn shell 或 c shell 不如 bash 好，但它可以胜任完毕

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-10T20:12:05.783

您将需要传递`--login`(aka `-l`) 选项，`bash`以便它获取 Cygwin`/etc/profile`并正确设置`PATH`变量。这将导致当前目录更改为默认的“home”，但您可以在运行之前将环境变量设置`CHERE_INVOKING`为，如果您需要保留它，它将保留在当前目录中。`1``bash -l`

# cocoa - Change cursor in GL fullscreen on OSX using cocoa?

> ID：731709
> 
> 赞同：2
> 
> 时间：2009-04-08T20:36:44.007
> 
> 标签：cocoa, macos, opengl, fullscreen, nsview

Can anyone provide a sample / link to a sample Cocoa app that changes the 'hardware' cursor in a fullscreen OpenGL Cocoa app? I have been able to create a full screen GL app and an app that changes the cursor by overriding NSView::resetCursorRects but I have not been able to get both to work simultaneously. I've also refitted some of the Apple GL samples (CocoaGL, Custom Cocoa OpenGL, etc) by overriding NSView::resetCursorRects and I haven't been able to get the cursor to change in fullscreen in them either. I have the book "OpenGL Programming on Mac OS X" which also avoids the problem.

@Christopher: I hadn't tried [NSCursor set]. Good call but I made a run at it and no luck. It still returns to the system cursor. I'd say that perhaps something is overriding it in my calls that switch to fullscreen but I've actually tried reseting the mouse cursor in my NSView's draw routine (which gets called repeatedly) and the cursor never switches from the system default.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T16:16:07.680

尝试直接使用 NSCursor，NSView 光标 rect 方法依赖于诸如适当大小和可见的 NSWindow 之类的东西才能正常工作，而在全屏模式下不一定如此。

# naming-conventions - Is the name IsFemale inappropriate for a database column?

> ID：731710
> 
> 赞同：16
> 
> 时间：2009-04-08T20:36:59.453
> 
> 标签：naming-conventions

Just browsing our db schema and found a field named 'IsFemale'

Is the name good, or is it kinda laughable?

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-08T21:02:17.037

如果可能，您应该坚持使用[ISO 标准](http://en.wikipedia.org/wiki/ISO_5218)。

> **ISO/IEC 5218** *信息技术——人类性别表示代码*是一项国际标准，它通过语言中立的一位数字代码定义人类性别的表示。...
> 
> ISO/IEC 5218 中规定的四个代码是：
> 
> *   0 = 未知，
> *   1 = 男性，
> *   2 = 女性，
> *   9 = 不适用。
> 
> 该标准规定它的使用可以用代号“SEX”来指代。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-04-08T20:39:05.610

Female and male are not mutually exclusive, so you'll have to come up with something for transsexuals, unisex, etc.

To make this as enterprisey as possible, create a `GenderTypeID` column:

```
GenderTypes
-----------
GenderTypeID  Name     Greeting

      1       Male     Dear Sir
      2       Female   Dear Madam
      3       Unisex   Dear Sir and Madam
      4       Unknown  Dear Sir or Madam
      5       Android  Dear Artificial Life Form 
```

... and so on.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-08T20:39:23.190

Maybe naming the column "gender" (char with 'M', 'F') would me more "sensitive".

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-08T20:48:13.433

Well, the typical thing is to have "sex" column, but you may end up with clueless clients trying filing it with values as "twice a week".

Other problem is that it's language dependent. For example in English M will mean **M**an, while in Spanish it may mean **M**ujer (woman).

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T21:01:54.103

isFemale 表示您的架构存在更大的问题，应该将类似的东西概括化，甚至可能将其标准化：

就像，在你的桌子上有一个性别列，这是一个性别表的 FK：

```
---------------------
| ID   | Type       |
|-------------------|
|   1  | Male       |
|   2  | Female     |
|   3  | Yes Please |
--------------------- 
```

请注意，实际上不要这样做，这很愚蠢，除非您计划支持不寻常的性别。我仍然认为通用列比 isFemale 位更好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-08T22:01:27.347

很明显，提问者（正确地）担心数据库设计者未能考虑到价值中立的语言。

（请注意，政治正确（正确地）不再被认为是可接受的、价值中立的语言。）

作为计算机设计师，您有特别的义务确保您的设计不会无意或无意地包含或传播性别偏好或优越感。

虽然设计者可能天真地假设 IsFemale 会给女性一个 1 并因此更高/优越的值，但真实值通常被赋予 -1 的值。更不用说 0 是神圣价值的文化了。

在下周的文章中，我们将介绍双性人和酷儿理论及其对变量命名标准的影响。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T20:38:13.303

Are you only ever going to have to check for "IsFemale" true/false?

Wouldn't a column like "PersonType" or something like that be more appropriate? That way, you could have "female", "male", "company" and so forth - more possible values.

Marc

PS: but if you choose to use a "bit" (boolean) column, then the "Is" or "Has" prefix is a good choice, in my opinion - makes it quite clear it's a boolean!

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-08T20:40:19.990

What is wrong with the classic "sex" and supporting sub types such as M,F, etc...

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-08T21:41:52.777

我曾经使用过的每个数据库都使用了 Gender 列名，其值为 0 代表女性，1 代表男性。我一直认为这些值的分配方式与电子设备具有被描述为母头或公头的连接器的方式大致相同。

IsFemale 是否可笑取决于系统的意图，但它似乎确实将应用程序画到了一个角落。例如，性别字段可以增长以适应额外的“类型”，但 IsFemale 显然只会是真或假，因此根本不可扩展。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-08T20:39:55.873

`Gender` seems a better choice, but if you want or need to use a boolean column, there are only two choices - IsMale or IsFemale.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-08T21:06:39.723

如果你问它是否可笑，那取决于。isMale 会更好吗，你这个沙文主义者？（只是在开玩笑！）

我的猜测是，设计数据库的人想到了针对女性的特殊业务规则，并以这种方式设计了它。

确实没有理由说明男性应该为真而女性应该为假，并且您的数据库可能在使用字符和字符比较方面效率较低。

从编程的角度来看，在表中避免布尔值是有意义的，原因与在函数参数中避免布尔值是有意义的原因相同。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-08T21:55:48.140

对于没有性别歧义的简单系统，我使用 IsMale。如果您的要求包括双性人，另一种方法是使用查找表。如果您只有男性和女性，则使用布尔值以外的任何内容都会给系统带来不必要的复杂性和歧义。

# c# - GridView 的自动分页不起作用

> ID：731717
> 
> 赞同：1
> 
> 时间：2009-04-08T20:38:57.263
> 
> 标签：c#, asp.net, gridview

根据我的书，开始使用自动分页所需的只是将 GridView.AllowPaging 设置为 true。但是当我尝试导航到另一个页面时，我得到*了 GridView 触发的事件 PageIndexChanging ，它没有被处理异常*。然后我必须为 PageIndexChanging 事件创建事件处理程序，但是当我导航到下一页时，GridView 不显示任何内容。

Q1 - 我做错了什么？

Q2 - 本书是为 Asp.Net 3.5 编写的，但作者没有提到上述行为？！任何想法为什么我的 GridView 行为如此不同？

谢谢

编辑：

我很尴尬地说，但它不起作用的原因是因为我忘了删除线

```
if(IsPostBack) GridView.DataSourceID=""; 
```

很抱歉占用您的时间，感谢您帮助我

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T20:50:53.897

已经有一段时间了，但是您不必设置页面并重新绑定数据吗？从记忆中，类似...

```
gv.PageIndex = e.NewPageIndex
// Rebind Grid 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T20:51:21.367

当您回发时，您必须将数据重新绑定到网格视图。

您可能还需要设置页码，例如：

```
GridView1.CurrentPageIndex = e.NewPageIndex; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T12:03:28.950

如果您使用 ObjectDataSource 作为 GridView 的数据源，则不必执行那些代码隐藏方法 - 所有这些都是免费处理的。

# tomcat - Tomcat 无法从清单文件中选择类路径

> ID：731729
> 
> 赞同：1
> 
> 时间：2009-04-08T20:40:44.200
> 
> 标签：tomcat, classpath, manifest.mf

Tomcat 版本：5.0.28 JDK：1.5.0.14

**问题：**

我正在使用hibernate和struts我们不是这些库的最新和最好的版本所以 - 两者都需要不同版本的apache-commons库。

**我想到的解决方案：**

使用清单文件并为每个指定不同版本的 apache-commons

我的网络应用程序部署为 webapps\myapp

而库是 webapps\myapp\WEB-INF\lib

我修改了 hibernate3.jar 中的 Manifest.mf 如下

> 清单版本：1.0
> 
> Archiver-Version: Plexus Archiver Created-By: 1.5.0_15-b04 (Sun> Microsystems Inc.) Class-Path: hibernatelib/slf4j-api-1.5.2.jar

并将 slf4j-api-1.5.2.jar 放入 webapps\myapp\WEB-INF\lib\hibernatelib

现在我希望 slf4j-api-1.5.2.jar 会与 hibernate 一起自动加载但它不工作...... Tomcat 无法找到上述 .MF 中指定的 jar 文件

**问题：**

1.  难道我做错了什么？还是Tomcat？
2.  这个问题有另一种解决方案吗？

**我已经试过\检查了以下**

1.  检查文件末尾的换行符
2.  如果我将 slf4j-api-1.5.2.jar 放在主 lib 文件夹中 - 错误就会消失 - 所以我知道它无法找到这个特定的 jar 文件
3.  在清单文件中尝试了相对、绝对路径

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T20:45:28.963

您是否检查过任何权限是否正确？也可能是一个想法，以确保在最后一个 Class-Path 行之后有一个换行符，这在今天早些时候帮助了我！

* * *

更新：如果 Tomcat 不支持这样的类路径声明，那么唯一想到的就是搞乱 ClassLoaders。就我个人而言，我不会那样做——在这条道路上，整个世界都有潜在的痛苦，你可能会更容易升级。对不起，我想不出更好的答案！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T21:04:32.677

清单中的属性被使用的唯一地方`Class-Path`是当`jar`包含清单被调用为使用 (" `java -jar theFile.jar`") 的可执行 jar 时。

一些 servlet 容器似乎支持它，但根据[这个邮件列表帖子](http://markmail.org/message/fekqhwpakxvsfblx)（对不起，找不到任何更权威的东西这么快）它也没有在规范中指定。

据我了解，Web 应用程序通常使用单个类加载器加载它们的类。“正确”解决该依赖问题将需要至少 2 个不同的类加载器。

一个 hack-ish 解决方案可能是使用[jarjar](http://code.google.com/p/jarjar/)或类似工具将不同的库及其各自的依赖项打包在一起。

因此，您将生成一个`jar`包含 Hibernate 及其 apache-commons 库的另一个，以及另一个`jar`包含 struts 及其 apache-commons 库的文件。apache-commons 库的每个副本都将移动到不同的包（可能是`hibernate.org.apache.*`and `struts.org.apache.*`）以解决不同类版本的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T21:22:42.510

您是否尝试过最新、最好的 Tomcat 版本，看看问题是否仍然存在？Tomcat 6 已经好几年了，更别说 5.5 或 5.0 了……

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T23:19:13.993

我不相信你能做到这一点。Tomcat 不会查看 JAR 清单来决定 CLASSPATH 问题。它使用它自己的类加载器层次结构来找到它需要的东西，使用它所说的 CLASSPATH 是什么。

如果您希望应用程序的不同部分使用不同版本的 JAR，那么您听起来像是一个真正需要[OSGi](http://www.osgi.org/Main/HomePage)的人。这就是发明要解决的问题。

那里有[两个相互竞争的 JSR](http://www.infoq.com/news/2007/08/osgi-jsr277-debate)，但我不知道 Sun 模块提案的任何实现。

我所知道的一个可以让你这样做的应用服务器是[Spring 的 DM server](http://www.springsource.com/products/dmserver)。这是他们正在增强的 Tomcat 的一个分支。

# java - Java Memcached 客户端

> ID：731738
> 
> 赞同：53
> 
> 时间：2009-04-08T20:42:15.930
> 
> 标签：java, web-applications, memcached

哪个是最好的 Java memcached 客户端，为什么？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-04-09T16:31:09.853

作为[spymemcached](http://code.google.com/p/spymemcached/)的作者，我有点偏见，但我会说这是我的，原因如下：

## 从头开始设计，尽可能做到无阻塞。

当您请求数据、发布集合等时......有一个很小的并发队列插入，您会得到一个 Future 来阻止结果（对于常见情况，如 get 有一些方便的方法）。

## 积极优化

[您可以在我的优化](http://code.google.com/p/spymemcached/wiki/Optimizations)页面上阅读更多内容，但我会进行整个应用程序优化。

我在微基准测试中仍然做得很好，但是要与其他客户端进行公平比较，您必须设计不切实际的使用模式（例如，等待每个 set 操作的响应或围绕 get 构建锁以防止它们进行数据包优化）。

## 痴迷测试

我维护了一个非常严格的测试套件，每个版本都有[覆盖率报告](http://dustin.github.com/java-memcached-client/emma/)。

错误仍然存​​在，但它们通常很小，而且客户端只会越来越好。:)

## 有据可查

[示例](http://code.google.com/p/spymemcached/wiki/Examples)页面提供了快速介绍，但[javadoc](http://dustin.github.com/java-memcached-client/apidocs/)提供了非常详细的信息。

## 提供高级抽象

我有一个映射到缓存的接口以及一个功能性的 CAS 抽象。二进制和文本都支持 incr-with-default 机制（由二进制协议提供，但在文本中相当棘手）。

## 跟上规格

我在服务器本身上做了[很多工作](http://cloud.github.com/downloads/dustin/memcached/changelog.html)，所以我跟上协议的变化。

我完成了第一个二进制协议服务器实现（测试服务器和 memcached 本身），这是第一个支持它的生产就绪客户端，并且做到了一流。

我还支持几种散列算法和节点分布算法，所有这些算法都针对每个构建都经过了良好的测试。如果你想要更好的性能，你可以做一个股票 ketama 一致的哈希，或者使用 FNV-1（甚至是 java 的本机字符串哈希）的派生。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-04-30T02:47:34.170

我相信**memcached java 客户端**是最好的客户端。

## 特征

*   **二进制协议支持**。访问存储在 memcached 服务器中的键/值的最快方法。
*   **UDP 协议支持**。您可以使用 tcp 协议设置密钥，并使用 udp 协议获取。实际上，一些大公司正在这样做。
*   支持自定义序列化和反序列化。
*   带有 NIO 和直接缓冲区的连接池。连接池不使用时动态增加连接。

## 表现

*   有关现有流行的 memcached java 客户端的基准测试，请参阅[性能](http://wiki.github.com/gwhalin/Memcached-Java-Client/performance)。
*   接收响应时反序列化
*   对源代码的每一行进行性能调整。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-08T04:05:54.537

如果这些数字仍然有效，那么... [http://xmemcached.googlecode.com/svn/trunk/benchmark/benchmark.html](http://xmemcached.googlecode.com/svn/trunk/benchmark/benchmark.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-09T14:57:58.057

大约一年前，当我不得不使用 memcached java 客户端时，spymemcached 连接器被描述为具有更多功能的优化 API。从那时起，memcached 客户端已经发布了许多新版本，因此可能值得一试。

FWIW 间谍客户端对我来说非常有效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-19T01:24:24.927

我一直在使用 SpyMemcached，并且必须同意它是目前最好的，有很多更新的改进。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T21:39:47.273

有[用于 Java 的 memcached 客户端](http://www.whalin.com/memcached/)和[spymemcached](http://code.google.com/p/spymemcached/)。不过两者都没有太多经验。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-14T06:50:28.230

请尝试[xmemcached](https://github.com/killme2008/xmemcached)，它也是基于 nio 并具有一些强大的功能。

# asp.net-mvc - 如何在 ASP.NET MVC 的视图中使用多个数据集？

> ID：731739
> 
> 赞同：1
> 
> 时间：2009-04-08T20:42:53.307
> 
> 标签：asp.net-mvc

我刚刚学习 ASP.NET MVC，我的第一个项目是创建一个简单的链接目录（如 DMOZ）。

我可以轻松地为某个类别的子类别列表构建强类型视图。

我可以轻松地构建特定类别中所有站点列表的强类型视图。

现在，这就是我难以理解的问题：

如果我正在查看特定类别，我将如何在同一页面视图中显示两个模型（集）数据：

1.  页面顶部：正在查看的类别的所有子类别。
2.  页面底部：正在查看的类别中的所有网站。

我不知道如何将子类别列表*和站点列表**都*返回到特定视图。是否可以？有干净的方法吗？（请随时将我指向在线教程或书籍章节）。

 ** * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T20:48:09.753

有两种方法：您可以将一个列表存储在 ViewData 中并且在视图中不对其进行强类型化，或者您可以创建一个单独的 ViewModel 类，该类采用两个或多个现有模型，因此您可以将这些模型作为您的强属性在视图本身内键入 ViewModel 类。

我找到的最佳信息来源是即将出版的 ASP.NET MVC 1.0 书籍的示例章节。第一章由 Scott Guthrie 编写，可在此处找到：http: [//aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

# php - PHP vs template engine

> ID：731743
> 
> 赞同：61
> 
> 时间：2009-04-08T20:43:45.020
> 
> 标签：php, templates

I'm currently having a discussion about the choice between PHP as a template engine versus a template engine on top of PHP.

What is your choice, and why?

I say why use another template engine when PHP is a template engine itself.

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-04-08T20:53:09.787

对于模板引擎：

1.  为最终用户定制增加了安全性。纯 PHP 中的主题具有对用户及其安装造成伤害的不受限制的能力。因此，模板引擎可以消除这种风险，如果它是一个好的引擎的话。
2.  易于非程序员使用，例如图形艺术家或网页设计师。

对于纯 php：

1.  纯 PHP 的速度是任何基于它构建的模板引擎都无法比拟的。
2.  PHP的*全部*功能可用于输出，而不仅仅是解释或过滤的部分。

如果可能的话，我更喜欢 PHP 本身。而且大多数人不想通过制作自定义主题来破解您的软件，因此很容易粗略阅读并调查其安全性。也就是说，我是做模板和编程，甚至一些图形艺术的“中间人”；我的技能不同于严格的程序员和严格的艺术家/设计师。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-08T20:51:15.610

我发现当我介绍 Smarty 时，让网页设计师使用 smarty 变量生成 HTML 是相当直接的。编程团队的人现在专注于更多的后端工作，即 Smarty 变量内容的生产。

这缩短了开发生命周期，可以将工作分配给更多人，并最终带来更好的设计。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-04-08T20:47:34.310

Well, it's just my opinion, but template engines suck. You have to first understand how the template engine is implemented and then learn how to use it. It seems just wasted time, because PHP alone does it best and offers much more flexibility.

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-04-08T20:53:05.263

以下原因适用：

*   使用引擎将您的应用程序分离为模板可以使您的应用程序不易受到暂停代码错误的影响
*   使用模板可以在未来重构时为您提供更大的灵活性，因为命名空间不会直接构建到应用程序中
*   使用模板鼓励（强制）开发人员将业务逻辑和代码保留在表示层之外。
*   使用模板可以更轻松地模拟数据集并将它们传递给模板引擎并预览网站的数据外观

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-04-08T20:46:28.603

Using a template engine can be helpful if you have a non-programmer doing the templates. In many cases, the simplified template language can be easier for a non-programmer to pick up than PHP itself.

That said, I find myself moving away from using templates when it's just me (or me and other developers).

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-07-10T16:40:38.187

PHP**不是**模板引擎，而是一种可以用来编写模板的语言，也就是模板引擎。模板引擎不仅是一种语言，而且是允许脚本定位、组织模板或将脚本中的数据分配给它们的编程 API。纯 PHP 绝对没有为您提供任何东西——它只是一种语言。相反，您应该将诸如 Zend Framework 中的 Zend_View 之类的库进行比较（基本上，它的工作方式与 Smarty 完全相同，只是它使用 PHP 编写模板）。您应该询问是否应该将模板引擎与 PHP 或其他东西一起用作模板语言。

说到模板语言本身，那么好吧……普通的循环和条件足以编写模板，但这“足够”并不意味着它容易、舒适、高效或灵活。PHP 没有为模板设计者提供任何特别的东西，但是许多“模板语言”（如 Smarty）只提供了 PHP 的有限子集，所以程序员选择 PHP 我并不感到惊讶。至少他们可以编写函数并使用 OOP，这对于这个来说太大了（在我看来），但确实有效并且确实有帮助。

关键是自定义模板语言不受 PHP 缺点的限制，但他们的设计者不寻常地没有看到它，声称“显示变量和循环就足够了”。模板语言可能更有效的可能领域：

*   表单显示和渲染（我还没有看到任何使用 PHP 作为模板语言的框架，它提供了一个简单、灵活和通用的系统来自定义表单外观）。
*   了解 HTML/XML 文档结构。
*   自动 XSS 注入过滤器。
*   解决表示层中的各种常见问题（即自定义分页系统的外观，按列显示数据等）
*   模板可移植性以及应用程序逻辑和实现细节与模板的**真正**分离。

遵循这种方式的模板语言示例在上面的 PHPTAL 和 Open Power Template 2 中有所提及。在 TinyButStrong 中也可以找到一些类似的想法，但不幸的是，这个模板引擎非常慢。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-25T19:57:01.090

当您混淆 HTML 语法时，PHP 作为模板引擎不会抱怨。它会让你忘记关闭标签、错误嵌套它们等。

PHP 的输出默认是不转义的，所以除非你记得在`htmlspecialchars()`任何地方都严格添加，否则你的网站会有 HTML 注入 (XSS) 漏洞。

```
<p>Hello <?= $name ?></b>
<!-- Simple template full of errors --> 
```

当您尝试[正确](http://hsivonen.iki.fi/producing-xml/#nottext)生成 XHTML 时，这些问题会更加严重。并不是说你不能用普通的 PHP 做到这一点——当然你可以——但这需要更多的努力和勤奋。

这就是为什么我的推荐是[PHPTAL](http://phptal.org)。[OPT2](http://www.invenzzia.org/en/projects/open-power-libraries/open-power-template)也可以。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-11-30T18:05:40.363

Savant 正是您所寻找的。它是一个很好的包装类，允许您在模板中使用 PHP 运算符，而不是在 PHP 之上解释新的模板语言。

优点：

不给系统增加额外的工作是有意义的。
开发人员没有学习曲线 如果你们每个人都遵守纪律，那么这就是要走的路。（学者）

缺点：

尽管 Savant 鼓励您正确分离，但它并不强制开发人员将业务逻辑与开发代码分离。我有一条永远不应该被打破的规则。您只能在模板中输出变量、使用条件和循环。您绝不能允许开发人员在模板中创建变量。不幸的是，无论您告诉他们多少次，开发人员似乎都不会这样做。因此，使用像 Smarty 这样的引擎变得值得，因为开发人员被迫将业务和设计完全分开。

如果我正在为自己或没有很多开发人员的项目做一个项目，我倾向于使用 Savant。如果它是一个比我更大的项目，那么在架构中我会选择像 Smarty 这样的东西。

无论哪种方式，代码中的分离都是您使用 Savant 或 Smarty 的重要天气。我敢肯定还有其他不错的选择。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-08T21:12:35.623

PHP 非常适合大多数任务，但模板引擎可以帮助项目更轻松地扩展。

如果您没有时间推出自己的产品（并且不需要超过他们提供的东西），那么像[Smarty](http://www.smarty.net/)或[PHPTAL](http://phptal.org/)这样的现成产品非常棒。此外，如果您以后发现需要更专业的东西，您可以很容易地用您自己的实现替换/修改它们。

我个人对 PHPTAL 有很好的体验，主要是因为它不会妨碍您并且很简单。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-04-08T20:54:57.147

我发现用 PHP 构建一个轻量级的模板引擎对我们来说效果最好。允许良好的代码分离，我们的图形设计师可以学习一些简单的规则来遵循，但大多数编写的是 HTML/CSS 而不是 PHP。我可以编写繁重的代码，而无需过多考虑界面。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-04-01T22:08:27.647

下面的文章总结了关于 PHP 模板引擎的不同观点。

**做第三种 PHP 模板** [http://www.tinybutstrong.com/article_3rd_kind.html](http://www.tinybutstrong.com/article_3rd_kind.html)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-06-04T14:22:21.700

对于任何新项目，我的选择可能是简单地使用 PHP 的模板功能，可能与 MVC 框架结合使用，而不是使用另一个模板引擎。`{$myVar}`毕竟，为了代码的简单性或分离的清洁度，您是否拥有或`<?= $myVar ?>`在您的代码中并不重要。更复杂的模板功能，例如条件、循环或后端技术（例如缓存）可以由 PHP 或 MVC 框架处理（或更好）。

我已经使用了这两种方法（有和没有模板引擎），但只在个人项目中，从不在团队项目中，所以在这样的环境中使用模板引擎可能有令人信服的论据。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-01-10T13:43:18.230

PHP 编码功能不断发展，设计功能相同，这就是为什么如果您与设计师和开发人员一起工作，您需要一个模板引擎来并行化工作，并让设计师使用 HTML。

我个人的选择是 Raintpl，因为它是轻量级、友好和快速的，这里有一个基准可以帮助你选择（smarty 和 savant 也不错！）：

[http://www.raintpl.com/PHP-Template-Engines-Speed-Test/](http://www.raintpl.com/PHP-Template-Engines-Speed-Test/)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-06-04T13:35:23.823

我不知道是因为 VirtueMart、Joomla 还是 PHP 中的模板概念，但将 VirtueMart 调整为自己的图形主题是 PURE HELL。（我不是在谈论普通的 CSS 样式。）

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-06-04T14:11:32.267

PHP 不是模板引擎，它是一种脚本语言。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-09-01T01:11:00.860

目前，它是最快和最容易使用的。在对 PHP 模板引擎进行了一套基准测试之后，twig 排在第二位，仅次于原生 php 语言。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-04-08T20:54:00.830

如果我不得不花时间学习一个独立的模板引擎，我宁愿花时间学习一个框架。我的选择是使用 Zend Framework，当它使用 MVC 方法实现时，它为您提供了框架的强大功能，以及 PHP 本身的本机模板功能。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-08-08T17:15:10.243

我最近写了一篇关于这个的博客文章。

仅出于安全考虑，一定要使用模板引擎（Twig 是安全的）。

一个好的模板引擎（例如 Twig）提供：

*   安全性（最重要的）
*   不冗长（如 php）
*   更多模板功能

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-07-20T22:06:57.510

自从我问这个问题以来，我遇到了[mustache](http://mustache.github.com/)。这是一种无逻辑的模板语言。

因此，这与 PHP 或 smarty 不同，您可以在模板中添加各种逻辑，而是强制您将所有逻辑保留在视图模型之类的东西中。

在我看来，这似乎是一个更好的选择，然后切换到逻辑仍然可能的模板语言。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-07-28T22:32:15.947

我在 PHP 中使用模板引擎，因为我更喜欢业务逻辑和表示逻辑之间的高度分离。当您的 PHP（或任何其他编程语言）没有散布在各处的 HTML 时，Web 编程会容易得多。这就是微软的代码背后如此受欢迎。

我使用一个名为 KudzuPHP 的模板引擎。它是我的 KudzuASP 的经典 ASP 端口。它与许多模板引擎的不同之处在于，承载业务规则和逻辑的代码在调用模板引擎后成为模板引擎的事件处理程序。这种方法允许您修改模板（移动大块的演示文稿），而不需要您修改 PHP 代码的代码。

KudzuPHP 包含它自己的库系统，编写新的扩展标签和库非常容易。

您可以在此处找到 KudzuPHP：[http](http://www.andrewfriedl.com/downloads/) ://www.andrewfriedl.com/downloads/ 如果您想要嵌入在 Wordpress 插件中的版本，该版本允许您在没有 PHP 的情况下针对 Wordpress API 进行编码，请前往 Wordpress.org 并在插件中搜索“卡祖”。

# powershell - PowerShell Copy-Item 中的排除列表似乎不起作用

> ID：731752
> 
> 赞同：76
> 
> 时间：2009-04-08T20:46:24.360
> 
> 标签：powershell

我有以下 PowerShell 脚本片段：

```
$source = 'd:\t1\*'
$dest = 'd:\t2'
$exclude = @('*.pdb','*.config')
Copy-Item $source $dest -Recurse -Force -Exclude $exclude 
```

它可以将所有文件和文件夹从 t1 复制到 t2，但它仅排除“根”/“一级”文件夹中的排除列表，而不排除子文件夹中的排除列表。

如何使它排除所有文件夹中的排除列表？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-04-08T23:48:34.233

我认为最好的方法是在 Copy-Item 命令中使用 Get-ChildItem 和管道。

我发现这行得通：

```
$source = 'd:\t1'
$dest = 'd:\t2'
$exclude = @('*.pdb','*.config')
Get-ChildItem $source -Recurse -Exclude $exclude | Copy-Item -Destination {Join-Path $dest $_.FullName.Substring($source.length)} 
```

基本上，这里发生的事情是您正在逐一浏览有效文件，然后将它们复制到新路径。最后的“加入路径”语句是为了在复制文件时也保留目录。该部分获取目标目录并将其与源路径之后的目录连接。

我从[这里](http://www.eggheadcafe.com/conversation.aspx?messageid=29718342&threadid=29718323)得到了这个想法，然后对其进行了一些修改以使其适用于这个示例。

我希望它有效！

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-08-01T13:24:08.877

我也遇到了这个问题，花了 20 分钟在这里应用解决方案，但一直遇到问题。
所以我选择使用 robocopy - 好吧，它不是 powershell，但应该在 powershell 运行的任何地方都可用。

它开箱即用：

```
robocopy $source $dest /S /XF <file patterns to exclude> /XD <directory patterns to exclude> 
```

例如

```
robocopy $source $dest /S /XF *.csproj /XD obj Properties Controllers Models 
```

此外，它还有很多功能，比如可恢复副本。文档[在这里](https://technet.microsoft.com/en-us/library/cc733145(v=ws.11).aspx)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-01-10T17:41:07.533

由于评论格式代码很糟糕，我将作为答案发布，但这只是@landyman 答案的补充。建议的脚本有一个缺点 - 它会创建双嵌套文件夹。例如对于“d:\t1\sub1”，它将创建空目录“d:\t2\sub1\sub1”。这是因为目录的 Copy-Item 需要 -Destination 属性中的父目录名称而不是目录名称本身。这是我找到的解决方法：

```
Get-ChildItem -Path $from -Recurse -Exclude $exclude | Copy-Item -Force -Destination {
  if ($_.GetType() -eq [System.IO.FileInfo]) {
    Join-Path $to $_.FullName.Substring($from.length)
  } else {
    Join-Path $to $_.Parent.FullName.Substring($from.length)
  }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-11-11T14:43:12.890

exclude 参数不适用于目录。Bo 脚本的一个变体可以解决问题：

```
$source = 'c:\tmp\foo'
$dest = 'c:\temp\foo'
$exclude = '\.bak'
Get-ChildItem $source -Recurse  | where {$_.FullName -notmatch $exclude} | 
    Copy-Item -Destination {Join-Path $dest $_.FullName.Substring($source.length)} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2018-03-23T18:42:58.247

请注意，语法规范要求使用 STRING ARRAY；阿拉字符串[]

```
SYNTAX
    Copy-Item [[-Destination] <String>] [-Confirm] [-Container] [-Credential <PSCredential>] [-Exclude <String[]>] [-Filter <String>] [-Force] [-FromSession <PSSession>] [-Include 
    <String[]>] -LiteralPath <String[]> [-PassThru] [-Recurse] [-ToSession <PSSession>] [-UseTransaction] [-WhatIf] [<CommonParameters>] 
```

如果您在数组生成中不明确，那么您最终会得到一个 Object[] - 这在许多情况下会被忽略，由于类型安全而留下“错误行为”的外观。由于 PowerShell 可以处理脚本块，因此对特定类型变量以外的评估（以便可以确定有效字符串）将为执行策略松懈的任何系统上的注入模式攻击的可能性留下一个机会。

所以这是不可靠的：

```
PS > $omissions = @("*.iso","*.pdf","*.zip","*.msi")
PS > $omissions.GetType()

Note the result....
IsPublic IsSerial Name                                     BaseType
-------- -------- ----                                     --------
True     True     Object[]                                 System.Array 
```

这有效....例如：

```
PS > $omissions = [string[]]@("*.iso","*.pdf","*.zip","*.msi")
**or**
PS > [string[]]$omissions = ("*.iso,*.pdf,*.zip,*.msi").split(',')
PS > $omissions.GetType()

IsPublic IsSerial Name                                     BaseType
-------- -------- ----                                     --------
True     True     String[]                                 System.Array 
```

请注意，即使是“单个”元素仍需要相同的强制转换，以便创建一个 1 元素数组。

如果您在家中尝试此操作，请务必使用 Replace-Variable“遗漏”清除 $omissions 的存在，然后再在上面显示的示例中重铸它。

至于我测试过的可靠工作的管道......

```
--------------------------------------------------------------------------------------- cd $sourcelocation

ls | ?{$_ -ne $null} | ?{$_.BaseName -notmatch "^\.$"} | %{$_.Name} | cp -Destination $targetDir -Exclude $omissions -recurse -ErrorAction silentlycontinue 
--------------------------------------------------------------------------------------- 
```

上面做了一个基本（选择的“当前”）目录中源文件的目录列表，过滤掉潜在的问题项目，将文件转换为基本名称并强制cp（复制项目别名）重新访问文件“通过“当前目录”中的名称” - 从而重新获取文件对象，并复制它。这将创建空目录，包括那些甚至可能包含排除文件的目录（当然少了排除）。另请注意，“ls”（get-childitem）不会 -recurse - 留给 cp。最后 - 如果您遇到问题并需要调试，请删除 -ErrorAction silentlycontinue 开关和参数，这隐藏了许多可能会中断脚本的麻烦。

对于那些评论与“\”包含相关的人，请记住，您正在通过解释器（即 PowerShell）处理 .NET 子层，例如，在 c# 中，包含单个“\”（或字符串中的多个单数），导致编译器要求您通过使用“\\”来转义反斜杠来更正条件，或者在字符串前面加上@，如@“\”；剩下的另一个选项是用单引号括起来的字符串，如'\'。所有这一切都是因为字符组合（如“\n”等）的 ASCII 插值。

后者是一个更大的主题，所以我会把这个考虑留给你。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-08-25T06:17:09.490

我正在寻找一种方法来复制在某个日期/时间戳之后修改的文件以便存档它们。这样我就可以准确地保存我处理的文件（假设我知道我什么时候开始）。（是的，我知道这就是 SCM 的用途，但有时我只想在不签入的情况下对我的工作进行快照。）

使用landyman的小费和我在其他地方找到的东西，我发现这很有效：

```
$source = 'c:\tmp\foo'
$dest = 'c:\temp\foo'
$exclude = @('*.pdb', '*.config')
Get-ChildItem $source -Recurse -Exclude $exclude |  
    where-object {$_.lastwritetime -gt "8/24/2011 10:26 pm"} | 
    Copy-Item -Destination {Join-Path $dest $_.FullName.Substring($source.length)} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-05-22T02:34:26.277

带有 Join-Path 的 Get-ChildItem 主要为我工作，但我意识到它正在将根目录复制到其他根目录中，这很糟糕。

例如

*   c:\SomeFolder
*   c:\SomeFolder\CopyInHere
*   c:\SomeFolder\CopyInHere\Thing.txt
*   c:\SomeFolder\CopyInHere\SubFolder
*   c:\SomeFolder\CopyInHere\SubFolder\Thin2.txt

*   源目录：c:\SomeFolder\CopyInHere

*   目标目录：d:\PutItInHere

目标：将 c:\SomeFolder\CopyInHere 中的每个子项复制到 d:\PutItInHere 的根目录，但不包括 c:\SomeFolder\CopyInHere 本身。
- 例如，将 CopyInHere 的所有子代设为 PutItInHere 的子代

上面的例子大部分都是这样做的，但发生的是它创建了一个名为 SubFolder 的文件夹，并在名为 SubFolder 的文件夹中创建了一个文件夹。

这是因为 Join-Path 为 SubFolder 子项计算 d:\PutItInHere\SubFolder 的目标路径，因此在名为 SubFolder 的文件夹中创建了 SubFolder。

我通过使用 Get-ChildItems 带回项目的集合，然后使用循环来解决这个问题。

```
Param(
[Parameter(Mandatory=$True,Position=1)][string]$sourceDirectory,
[Parameter(Mandatory=$True,Position=2)][string]$destinationDirectory
)
$sourceDI = [System.IO.DirectoryInfo]$sourceDirectory
$destinationDI = [System.IO.DirectoryInfo]$destinationDirectory
$itemsToCopy = Get-ChildItem $sourceDirectory -Recurse -Exclude @('*.cs', 'Views\Mimicry\*')
foreach ($item in $itemsToCopy){        
    $subPath = $item.FullName.Substring($sourceDI.FullName.Length)
$destination = Join-Path $destinationDirectory $subPath
if ($item -is [System.IO.DirectoryInfo]){
    $itemDI = [System.IO.DirectoryInfo]$item
    if ($itemDI.Parent.FullName.TrimEnd("\") -eq $sourceDI.FullName.TrimEnd("\")){      
        $destination = $destinationDI.FullName  
    }
}
$itemOutput = New-Object PSObject 
$itemOutput | Add-Member -Type NoteProperty -Name Source -Value $item.FullName
$itemOutput | Add-Member -Type NoteProperty -Name Destination -Value $destination
$itemOutput | Format-List
Copy-Item -Path $item.FullName -Destination $destination -Force
} 
```

简而言之，它使用当前项目的全名进行目标计算。但是，它会检查它是否是 DirectoryInfo 对象。如果是，它检查它的父文件夹是否是源目录，这意味着当前被迭代的文件夹是源目录的直接子目录，因此我们不应该将它的名称附加到目标目录，因为我们希望该文件夹是在目标目录中创建，而不是在目标目录中的文件夹中。

之后，每个其他文件夹都可以正常工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-06-13T20:29:58.260

```
$sourcePath="I:\MSSQL\Backup\Full"
$excludedFiles=@("MASTER", "DBA", "MODEL", "MSDB")
$sourceFiles=(ls $sourcePath -recurse -file) | where-object { $_.directory.name -notin $excludedFiles } 
```

这就是我所做的，我需要将一堆备份文件复制到网络上的一个单独位置以供客户提取。我们不希望他们拥有上述系统数据库备份。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-24T18:54:28.357

我有一个类似的问题扩展了这一点。我想要一个适用于以下来源的解决方案

```
$source = "D:\scripts\*.sql" 
```

也。我找到了这个解决方案：

```
function Copy-ToCreateFolder
{
    param(
        [string]$src,
        [string]$dest,
        $exclude,
        [switch]$Recurse
    )

    # The problem with Copy-Item -Rec -Exclude is that -exclude effects only top-level files
    # Copy-Item $src $dest    -Exclude $exclude       -EA silentlycontinue -Recurse:$recurse
    # http://stackoverflow.com/questions/731752/exclude-list-in-powershell-copy-item-does-not-appear-to-be-working

    if (Test-Path($src))
    {
        # Nonstandard: I create destination directories on the fly
        [void](New-Item $dest -itemtype directory -EA silentlycontinue )
        Get-ChildItem -Path $src -Force -exclude $exclude | % {

            if ($_.psIsContainer)
            {
                if ($Recurse) # Non-standard: I don't want to copy empty directories
                {
                    $sub = $_
                    $p = Split-path $sub
                    $currentfolder = Split-Path $sub -leaf
                    #Get-ChildItem $_ -rec -name  -exclude $exclude -Force | % {  "{0}    {1}" -f $p, "$currentfolder\$_" }
                    [void](New-item $dest\$currentfolder -type directory -ea silentlycontinue)
                    Get-ChildItem $_ -Recurse:$Recurse -name  -exclude $exclude -Force | % {  Copy-item $sub\$_ $dest\$currentfolder\$_ }
                }
            }
            else
            {

                #"{0}    {1}" -f (split-path $_.fullname), (split-path $_.fullname -leaf)
                Copy-Item $_ $dest
            }
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-01-30T07:48:17.557

下面的代码片段会将所有文件和文件夹从 复制到`$source`，`$dest`不包括根文件夹和子文件夹中的文件：`.pdb``.config`

```
Get-ChildItem -Path $source | Copy-Item -Destination $dest -Recurse -Container -Exclude @('*.pdb','*.config') 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-11-07T01:47:17.323

使用正则表达式将项目从一个文件夹复制到另一个文件夹以进行排除的一种方法：

```
$source = '.\source'
$destination = '.\destination'
$exclude = '.*\.pdf$|.*\.mp4$|\\folder1(\\|$)|\\folder2(\\|$)'

$itemsToCopy = Get-ChildItem $source -Recurse |
    Where-Object FullName -notmatch $exclude | Select-Object -Expand FullName

$sourceFullNameLength = (Get-Item $source).FullName.Length

foreach ($item in $itemsToCopy) {
    $relativeName = $item.Substring($sourceFullNameLength + 1)
    Copy-Item -Path $item -Destination "$destination\$relativeName"
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-11-14T17:40:22.253

我写这个是为了日常使用并打包在脚本模块中，它维护了所有的目录结构并支持通配符：

```
function Copy-Folder {
    [CmdletBinding()]
    param(
        [Parameter(Mandatory)]
        [String]$FromPath,

        [Parameter(Mandatory)]
        [String]$ToPath,

        [string[]] $Exclude
    )

    if (Test-Path $FromPath -PathType Container) {
        New-Item $ToPath -ItemType Directory -ErrorAction SilentlyContinue | Out-Null
        Get-ChildItem $FromPath -Force | ForEach-Object {
            # avoid the nested pipeline variable
            $item = $_
            $target_path = Join-Path $ToPath $item.Name
            if (($Exclude | ForEach-Object { $item.Name -like $_ }) -notcontains $true) {
                if (Test-Path $target_path) { Remove-Item $target_path -Recurse -Force }
                Copy-Item $item.FullName $target_path
                Copy-Folder -FromPath $item.FullName $target_path $Exclude
            }
        }
    }
} 
```

只需调用`Copy-Folder -FromPath 'fromDir' -ToPath 'destDir' -Exclude *.pdb,*.config`

和可以省略`-FromPath`，`-ToPath`

`Copy-Folder -FromPath 'fromDir destDir -Exclude *.pdb,*.config`

# python - 在数据来自外部来源的 GUI 中显示数据

> ID：731759
> 
> 赞同：0
> 
> 时间：2009-04-08T20:46:50.927
> 
> 标签：python, user-interface, named-pipes

我对如何解决这个问题有点迷茫，我想用 Tkinter 和 python 编写一个理想的 GUI，但我最初是从 Qt 开始的，发现问题延伸到所有 GUI 框架或我有限的理解。

在这种情况下，数据来自命名管道，我想将通过管道传入的任何内容显示到文本框中。我试过让一个线程在管道上侦听，另一个线程创建 GUI，但在这两种情况下，一个线程似乎总是挂起或 GUI 永远不会被创建。

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T21:25:20.367

当我做这样的事情时，我使用了一个单独的线程来监听管道。该线程有一个指向 GUI 的指针/句柄，因此它可以发送要显示的数据。

我想你可以在 GUI 的更新/事件循环中做到这一点，但你必须确保它在管道上进行非阻塞读取。我在一个单独的线程中完成了它，因为我必须对通过的数据进行大量处理。

哦，当您进行显示时，请确保一次以非平凡的“块”进行显示。最大化将更新命令发送到文本框的消息队列（至少在 Windows 上）非常容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T21:27:51.843

过去，当我让 GUI 从外部事物（例如：以太网套接字）读取数据时，我有一个单独的线程来处理外部事物的服务，以及一个定时回调（通常设置为半秒左右）更新显示外部数据的 GUI 小部件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T22:21:50.543

这是我的做法（在 Windows 上）：

```
import wx, wx.lib.newevent, threading
import win32event, win32pipe, win32file, pywintypes, winerror

NewMessage, EVT_NEW_MESSAGE = wx.lib.newevent.NewEvent()
class MessageNotifier(threading.Thread):
    pipe_name = r"\\.\pipe\named_pipe_demo"

    def __init__(self, frame):
        threading.Thread.__init__(self)
        self.frame = frame

    def run(self):
        open_mode = win32pipe.PIPE_ACCESS_DUPLEX | win32file.FILE_FLAG_OVERLAPPED
        pipe_mode = win32pipe.PIPE_TYPE_MESSAGE

        sa = pywintypes.SECURITY_ATTRIBUTES()
        sa.SetSecurityDescriptorDacl(1, None, 0)

        pipe_handle = win32pipe.CreateNamedPipe(
            self.pipe_name, open_mode, pipe_mode,
            win32pipe.PIPE_UNLIMITED_INSTANCES,
            0, 0, 6000, sa
        )

        overlapped = pywintypes.OVERLAPPED()
        overlapped.hEvent = win32event.CreateEvent(None, 0, 0, None)

        while 1:
            try:
                hr = win32pipe.ConnectNamedPipe(pipe_handle, overlapped)
            except:
                # Error connecting pipe
                pipe_handle.Close()
                break

            if hr == winerror.ERROR_PIPE_CONNECTED:
                # Client is fast, and already connected - signal event
                win32event.SetEvent(overlapped.hEvent)

            rc = win32event.WaitForSingleObject(
                overlapped.hEvent, win32event.INFINITE
            )

            if rc == win32event.WAIT_OBJECT_0:
                try:
                    hr, data = win32file.ReadFile(pipe_handle, 64)
                    win32file.WriteFile(pipe_handle, "ok")
                    win32pipe.DisconnectNamedPipe(pipe_handle)
                    wx.PostEvent(self.frame, NewMessage(data=data))
                except win32file.error:
                    continue

class Messages(wx.Frame):
    def __init__(self):
        wx.Frame.__init__(self, None)
        self.messages = wx.TextCtrl(self, style=wx.TE_MULTILINE | wx.TE_READONLY)
        self.Bind(EVT_NEW_MESSAGE, self.On_Update)

    def On_Update(self, event):
        self.messages.Value += "\n" + event.data

app = wx.PySimpleApp()
app.TopWindow = Messages()
app.TopWindow.Show()
MessageNotifier(app.TopWindow).start()
app.MainLoop() 
```

通过发送一些数据来测试它：

```
import win32pipe

print win32pipe.CallNamedPipe(r"\\.\pipe\named_pipe_demo", "Hello", 64, 0) 
```

（在这种情况下，您也会收到回复）

# c# - *可以*为静态的C#方法应该是静态的吗？

> ID：731763
> 
> 赞同：106
> 
> 时间：2009-04-08T20:49:05.163
> 
> 标签：c#, static, methods

*可以*是静态的 C# 方法应该是静态的吗？

我们今天讨论了这个问题，我有点犹豫。想象一下，您有一个很长的方法，您可以从中重构出几行代码。新方法可能会从父方法中获取一些局部变量并返回一个值。这意味着它*可能*是静态的。

问题是：它*应该*是静态的吗？它在设计或选择上不是静态的，只是由于它不引用任何实例值的性质。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-04-08T21:26:36.290

这取决于。实际上有两种类型的静态方法：

1.  静态的方法，因为它们可以是
2.  静态的方法，因为它们必须是

在中小型代码库中，您可以真正互换地对待这两种方法。

如果您有一个属于第一类的方法（可以是静态的），并且您需要将其更改为访问类状态，那么确定是否可以将静态方法转换为实例方法是相对简单的。

然而，在大型代码库中，调用站点的绝对数量可能会使搜索以查看是否可以将静态方法转换为非静态方法的成本太高。很多时候人们会看到调用的数量，然后说“好的......我最好不要更改此方法，而是创建一个新的方法来满足我的需要”。

这可能导致：

1.  大量代码重复
2.  方法参数数量的爆炸式增长

这两件事都很糟糕。

因此，我的建议是，如果您的代码库超过 200K LOC，那么我只会将方法设为静态，前提是它们必须是静态方法。

从非静态到静态的重构相对容易（只需添加一个关键字），因此如果您想稍后将可静态变为实际静态（当您需要实例之外的功能时），那么您可以。但是，逆向重构，将静态方法转换为实例方法的成本要高得多。

对于大型代码库，最好在易于扩展的方面出错，而不是在思想纯洁方面。

因此，对于大型项目，除非您需要它们，否则不要让事情变得静态。对于小型项目，只做你最喜欢的事情。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-04-08T20:56:47.597

我*不会*让它成为*该类的**公共*静态成员。原因是，将其设为 public static 是在说明类的类型：不仅“这种类型知道如何执行此行为”，而且“执行此行为是该类型的责任”。而且很可能该行为不再与较大的类型有任何实际关系。

 *不过，这并不意味着我根本不会让它成为静态的。问问自己这个问题：新方法在逻辑上是否属于其他地方？如果您对此回答“是”，您可能确实希望将其设为静态（并同时移动它）。即使这不是真的，您仍然可以将其设为静态。只是不要标记它`public`。

为方便起见，您至少可以标记它`internal`。如果您无法轻松访问更合适的类型，这通常可以避免需要移动方法，但仍然可以在需要的地方访问它，这样它就不会作为公共接口的一部分显示给您的类的用户.

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-04-08T20:52:05.173

不必要。

将公共方法从静态转移到非静态是一个重大变化，需要对所有调用者或消费者进行更改。如果一个方法看起来像一个实例方法，但碰巧没有使用任何实例成员，我建议将其作为一个实例方法作为未来证明的衡量标准。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-08T20:59:39.443

是的。“它可以是静态的”的原因是它不对调用它的对象的状态进行操作。因此它不是实例方法，而是类方法。如果它可以在不访问实例数据的情况下完成它需要做的事情，那么它应该是静态的。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-04-08T21:00:08.447

是的，它应该。有多种[耦合指标](http://en.wikipedia.org/wiki/Coupling_%28computer_science%29)可以衡量您的类如何依赖于其他事物，例如其他类、方法等。将方法设为静态是一种降低耦合程度的方法，因为您**可以确定**静态方法不引用任何成员。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-04-08T20:51:18.467

我认为如果您将其标记为静态，它会使其更具可读性......然后出现的人会知道它不会引用任何实例变量而无需阅读整个函数......

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-04-08T20:51:16.000

静态方法比非静态方法快，所以是的，如果可以的话，它们应该是静态的，**并且没有特殊的理由让它们成为非静态**的。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-04-08T21:10:27.967

就个人而言，我是无国籍状态的忠实粉丝。您的方法是否需要访问类的状态？如果答案是否定的（而且很可能是否定的，否则您不会考虑将其设为静态方法），那么是的，去做吧。

无法访问状态是不那么令人头疼的。正如隐藏其他类不需要的私有成员是一个好主意一样，对不需要它的成员隐藏状态也是一个好主意。减少访问可能意味着更少的错误。此外，它使线程更容易，因为它更容易保持静态成员线程安全。还有一个性能考虑，因为运行时不需要传递对**this**的引用作为静态方法的参数。

当然，缺点是如果您发现以前的静态方法由于某种原因必须访问状态，那么您必须更改它。现在我明白这可能是公共 API 的问题，所以如果这是公共类中的公共方法，那么也许你应该考虑一下它的含义。尽管如此，在现实世界中，我从未遇到过这实际上导致问题的情况，但也许我只是幸运。

所以，是的，去吧，无论如何。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-16T08:57:25.080

我很惊讶实际上很少有人在这里提到封装。实例方法将自动访问所有私有（实例）字段、属性和方法。除了从基类继承的所有受保护的。

当您编写代码时，您应该编写它，以便尽可能少地公开，并且尽可能少地访问。

所以是的，如果你让你的方法成为静态的，那么让你的代码变得更快可能很重要，但通常更重要的是让你的代码也尽可能地不能创建错误。实现这一目标的一种方法是让您的代码尽可能少地访问“私有内容”。

乍一看这似乎无关紧要，因为 OP 显然是在谈论重构，在这种情况下不会出错并创建任何新的错误，但是这个重构的代码必须在未来维护和修改，这使得你的代码具有更大的“攻击”如果它可以访问私有实例成员，则关于新错误的表面”。所以总的来说，我认为这里的结论是*“是的，大多数情况下你的方法应该是静态的”*，除非有任何其他原因不让它们保持静态。这仅仅是因为它“更好地使用封装和数据隐藏并创建'更安全'的代码”......

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-04-08T20:58:12.397

仅仅因为你可以做一些静态的事情并不是一个好主意。静态方法应该是静态的，因为它们的设计，而不是偶然的。

就像迈克尔说的那样，稍后更改它会破坏正在使用它的代码。

话虽如此，听起来您正在为该类创建一个私有实用程序函数，实际上它是静态设计的。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-04-08T21:15:36.317

如果您能够重构出几行并且生成的方法可能是静态的，则可能表明您从该方法中提取的行根本不属于包含类，您应该考虑将它们移入他们自己的班级。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-08T20:51:42.210

这取决于但通常我不会将这些方法设为静态。代码总是在变化，也许有一天我会想让这个函数成为虚拟函数并在子类中覆盖它。或者也许有一天它需要引用实例变量。如果必须更改每个呼叫站点，则进行这些更改将更加困难。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-08T21:12:40.553

就个人而言，我别无选择，只能将其设为静态。在这种情况下，Resharper 会发出警告，我们的 PM 有一条规则“Resharper 没有警告”。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-08T20:58:01.540

我建议最好的考虑方法是：如果您需要一个在没有实例化类的实例时需要调用的类方法，或者维护某种全局状态，那么静态是一个好主意。但总的来说，我建议您应该更喜欢使成员成为非静态的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-08T21:35:11.917

您应该考虑您的方法和类：

*   你将如何使用它们？
*   您是否需要从代码的不同级别对它们进行大量访问？
*   这是我可以在几乎所有可以想到的项目中使用的方法/类吗？

如果最后两个是“是”，那么您的方法/类可能应该是静态的。

最常用的例子可能是`Math`类。每个主要的 OO 语言都有它，所有的方法都是静态的。因为您需要能够随时随地使用它们，而无需创建实例。

另一个很好的例子是[`Reverse()`](http://msdn.microsoft.com/en-us/library/d3877932.aspx)C# 中的方法。
这是`Array`类中的静态方法。它颠倒了数组的顺序。

代码：

```
public static void Reverse(Array array) 
```

它甚至不返回任何东西，你的数组被反转了，因为所有数组都是 Array 类的实例。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-09T01:32:48.557

只要您将新方法设为*私有静态*，它就不是重大更改。事实上，FxCop 将此指南作为其规则之一 ( [http://msdn.microsoft.com/en-us/library/ms245046(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms245046(VS.80).aspx) )，并提供以下信息：

> 将方法标记为静态后，编译器将向这些成员发出非虚拟调用站点。发出非虚拟调用站点将阻止在运行时对每个调用进行检查，以确保当前对象指针不为空。这可以为性能敏感的代码带来可衡量的性能增益。在某些情况下，无法访问当前对象实例代表了正确性问题。

话虽如此，David Kean 的第一条评论更简洁地总结了这些担忧，他说这实际上更多的是关于正确性，而不是关于性能提升：

> 虽然这条规则被归类为性能问题，但将方法设为静态的性能提升仅为 1% 左右。相反，它更多的是一个正确性问题，它可能通过未能使用其他实例成员来指示成员中的不完整或错误。将方法标记为静态（在 Visual Basic 中为**Shared**）可以清楚地表明其不触及实例状态的意图。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-16T08:39:15.293

出于不同的原因，我肯定会把我能做的任何事情都变成静态的：

静态函数，当 JIT'd 时，在没有“this”参数的情况下调用。这意味着，例如，一个 3 参数的非静态函数（成员方法）被推送到堆栈上的 4 个参数。

编译为静态函数的同一函数将使用 3 个参数调用。这可以为 JIT 释放寄存器并节省堆栈空间......

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-04-16T08:49:26.393

我在“只使私有方法静态”阵营。创建公共方法可能会引入您不想要的耦合，并且可能会降低可测试性：您不能存根公共静态方法。

如果你想对使用公共静态方法的方法进行单元测试，你最终也会测试静态方法，这可能不是你想要的。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-10-29T15:53:43.247

由于某种原因被制成非静态的固有静态方法简直令人讨厌。以机智：

我打电话给我的银行，询问我的余额。
他们要我的帐号。
很公平。实例方法。

我打电话给我的银行，询问他们的邮寄地址。
他们要我的帐号。
怎么回事？失败——应该是静态方法。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-08-04T20:41:19.530

我一般从纯函数的功能角度来看待它。它需要是实例方法吗？如果没有，您可能会受益于强制用户传递变量而不破坏当前实例的状态。（好吧，你仍然可以破坏状态，但重点是，按照设计，不要这样做。）我通常将实例方法设计为公共成员，并尽我所能将私有成员设为静态。如有必要（您可以稍后更轻松地将它们提取到其他类中。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2009-04-08T20:54:33.340

在这些情况下，我倾向于将方法移至静态或实用程序库，因此我不会将“对象”的概念与“类”的概念混为一谈

# javascript - 如何在其他事件后禁用 Jquery 功能？

> ID：731775
> 
> 赞同：4
> 
> 时间：2009-04-08T20:51:48.637
> 
> 标签：javascript, jquery, javascript-events

当另一个事件发生时，我想禁用特定列表上的悬停事件。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-08T20:54:21.703

您可以使用该[`unbind`](http://docs.jquery.com/Events/unbind)功能删除这些事件。

```
$('#theListId').unbind('mouseenter').unbind('mouseleave'); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-07T07:38:04.133

您还可以使用：

```
$('#item').unbind('mouseenter mouseleave'); 
```

这与以下内容相同：

```
$('#theListId').unbind('mouseenter').unbind('mouseleave'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T20:55:59.110

```
function test(){ alert('test'); };

$( "li" ).hover( test );

$("li").unbind('hover', test); 
```

# database - 在插入数据库之前或之后格式化数据？

> ID：731782
> 
> 赞同：1
> 
> 时间：2009-04-08T20:53:09.570
> 
> 标签：database, formatting

我永远无法决定在将数据插入数据库之前或将其拉出时格式化数据是否更好。

我不是在谈论数据清理；我们都知道要防止 SQL 注入。我说的是如果用户给你一个 URL，并且它前面没有 http://，你应该在将它插入数据库之前添加它还是在将它拉出时添加它？更复杂的事情呢，比如格式化一大堆文本。我想在之前还是之后用 HTML 标记它（或剥离它）？如果我稍后改变主意并想以不同的方式格式化怎么办？如果我已经格式化了它，我就不能这样做，但是如果我将它存储为未格式化的，我可以这样做......但是每次我从数据库中提取一条数据时，我都在做额外的工作，我可以有完成一次并完成它。

你怎么认为？

* * *

从答案来看，似乎有一个普遍的共识，即 URL、电话号码和电子邮件（任何具有明确格式的内容）等内容应该首先标准化为一致的格式。文本之类的内容通常应保留为原始格式或可操作的格式，以获得最大的灵活性。如果速度是一个问题，可以存储两种格式。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T20:55:10.720

我认为最好确保数据库中的数据采用最一致的格式。您可能有多个应用程序使用此数据，因此如果您可以确保它们的格式相同，您就不必担心在每个应用程序中重新格式化不同的格式。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T20:55:16.850

在插入之前将 URL 规范化为规范形式可能是可以的；执行任何类型的广泛格式化，例如 HTML 转换/解析等。我觉得这是个坏主意 - 始终在数据库中保留“最原始”的数据，特别是如果您想稍后更改演示格式。

为了避免对每个查询进行不必要的后处理，您可能会考虑采用对象缓存或类似技术来处理更昂贵的操作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T21:00:07.727

你在这里问两个问题。

规范化应始终在数据库插入之前执行，例如，如果列只有 URL，则应始终首先对其进行规范化。

关于格式化，这是一个视图问题，而不是模型（在本例中为 DB）问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T20:55:50.763

在我看来，它应该首先被格式化。如果您选择在检索而不是插入时执行此操作，那么当其他应用程序/脚本想要使用同一数据库中的数据时，这可能会导致问题。他们都需要知道如何在提取数据时对其进行清理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T20:57:05.877

依靠

如果您正在处理定义明确的项目、SSN、邮政编码、电话号码，请将其存储为格式化（这并不一定意味着包含破折号或圆点等。它可能意味着删除它们以便所有内容保持一致。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T20:57:18.763

如果在存储数据之前更改数据，则必须非常小心。您总是会遇到需要向原始用户回显他们给您的*确切文本的情况。*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T21:09:28.110

我的倾向通常是以尽可能灵活的形式存储数据。例如，数字应该使用整数或浮点类型存储，而不是字符串，因为您可以使用数字类型进行数学运算，但不能使用字符串（尽管将数字解析为字符串很容易，这没什么大不了的） . 也许是一个更实际的例子：日期/时间应该使用数据库的实际日期/时间数据类型而不是字符串来存储。此外，将 HTML 转换为纯文本可能比反之更容易，在这种情况下，您希望将文本存储为 HTML。或者甚至可以使用像 Markdown 这样可以轻松转换为 HTML 或纯文本的格式。

这与矢量图形格式（SVG、EPS 等）存在的原因相同：SVG 文件本质上是一系列说明如何绘制图像的指令。将其转换为任意大小的位图图像很容易，而如果您只有一个位图图像开始，您将很难在不损失质量的情况下更改其大小（例如创建缩略图）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-08T21:53:29.410

您可能希望同时存储已格式化和未格式化的数据版本。例如，让我们以美国电话号码为例。如果您存储一列只包含数字，一列存储最常用的格式，例如 (111) 111-1111，那么您可以轻松地格式化为特殊情况的客户规范，或者快速提取最常用的一列而无需批量的铸造。这在插入时只需要很少的额外时间（并且可以通过计算列来完成，因此无论数据来自何处，它总是会发生）。

数据在放入数据库之前应该被清除，这样无效的日期或非数字数据等就不会被放入该字段中。电子邮件是人们出于某种原因经常将垃圾放入其中的一个领域。如果它没有@ 符号，则不应存储它。如果您实际上使用该字段通过您的应用程序发送电子邮件，则尤其如此。如果您明白我的意思，尝试发送电子邮件到“联系他的秘书”或“aol.com”是浪费时间。

If the format will be consistently needed, it is better to convert the data to that format once on insert or update and not have to convert it ever again. If the standard format changes, you will need to update the column for all existing records at that time, then use the new format going forth. If you have frequent changes of format and large tables or if differnt applications use different formats, it might be best to store unformatted.

# iphone - 为什么我在 Xcode 中的 iPhone 项目模板中看不到主要功能实现？

> ID：731791
> 
> 赞同：-1
> 
> 时间：2009-04-08T20:54:58.927
> 
> 标签：iphone

这很奇怪，因为苹果说某处有一个主要功能。但我真的找不到。

它应该看起来像这样：

```
#import <UIKit/UIKit.h>

int main(int argc, char *argv[])
{
    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];
    int retVal = UIApplicationMain(argc, argv, nil, nil);
    [pool release];
    return retVal;
} 
```

我能看到的那个文件是什么文件？它是隐藏的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T05:29:03.730

它始终在`Other Sources`您预生成的项目布局的组中。

[![主文件](https://i.stack.imgur.com/efURA.png)](https://i.stack.imgur.com/efURA.png)
[（来源：[lyndir.com](http://lhunath.lyndir.com/stuff/main.png)）]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T21:05:24.593

如果你找不到它，你总是可以创建一个新的代码文件并复制到这个函数中。当项目编译时，它只允许你拥有一个 main 函数，所以如果它在某个时候消失了，你可以重新添加它。

或者，您可能选择了不编译为可执行文件的项目类型。不确定这些是否适用于 iphone，但通常“图书馆”项目不会有主要功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T22:21:13.320

在 Groups and Files 部分展开“Other Sources”，文件名为 main.m 。

# delphi - 如何在我的 Delphi 应用程序中找到所有单位？

> ID：731799
> 
> 赞同：10
> 
> 时间：2009-04-08T20:56:48.687
> 
> 标签：delphi, debugging

很容易找到所有外部依赖项。只需运行程序并打开模块信息窗口。但是我怎样才能找到我所有的*内部*依赖呢？我知道程序保留了所有单元的列表，因为我已经跟踪了一两次初始化代码。但是有什么简单的方法可以从调试器访问这个列表吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2010-07-01T03:15:46.963

Delphi 调试器可以显示哪些单元被编译成模块（exe、dll 或包）。您可以在“模块”视图（查看 | 调试窗口 | 模块）中看到这一点。单击左上窗格中的一个模块，左下窗格将显示该模块中内置的所有编译单元。如果一个特定的编译单元由多个源文件（即一个 .pas 和一个 .inc 文件）组成，那么也会显示（当您展开该编译单元时）。

或者，您可以在编译项目时通过传递 --depends 让 Delphi 编译器向您显示使用的 .dcus 列表。它将输出一个 .d 文件，其中包含所需的 .dcus（和 .dcps）列表。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T01:08:06.243

我使用[GExperts](http://www.gexperts.org/)项目依赖项。
使用“使用者...”，您可以查看包含但未被任何人使用的单位。但是您看不到使用子句中包含的单元，当它们没有实际调用的任何代码时可以将其删除。

这是帮助：

* * *

**项目依赖**

项目依赖性专家使您能够查看特定单元使用的单元，以及哪些单元使用特定单元。当这个专家被激活时，它会解析所有当前项目的源代码中的uses子句并建立一个依赖列表。要查看特定单元的依赖关系信息，请在左侧窗格中单击它。右窗格将包含依赖关系信息。间接依赖是由特定单元的已用单元使用的单元。

您可以通过单击工具栏上的刷新按钮随时刷新依赖信息，您可以通过单击列标题对文件列表进行排序。[（来源：][[gexperts.org](http://www.gexperts.org/tour/project%20dependencies.png)][）]
[![替代文字](https://i.stack.imgur.com/5eWd2.png)](https://i.stack.imgur.com/5eWd2.png)

* * *

OTOH，您还可以使用免费[的 Peganza 的 ICARUS](http://www.peganza.com/products_icarus.htm)作为更详细的报告工具，但交互性较差...

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T05:12:06.517

另一种但相当麻烦的方法是生成一个映射文件，它包含程序中使用的所有单元的列表。

另请参阅此答案： [如何在我的 Delphi 应用程序中找到所有单元？](https://stackoverflow.com/questions/731799/how-can-i-find-all-the-units-in-my-delphi-app/3154875#3154875)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T21:00:19.600

[您是否看过 Pascal Analyzer 或Peganza Software](http://www.peganza.com/)的免费限量版 Icarus ？他们将创建“使用报告”，告诉您哪个模块使用其他模块，这样就可以为您提供所需的信息。

马克

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-09T00:00:17.717

[GExperts](http://www.gexperts.org/)有一个项目依赖项工具。我以前在尝试追踪使用过的单位时使用过它。您无法在其中搜索，但可以将列表导出到 CSV 文件并在那里搜索。这也只列出了使用部分中的内容。如果您包含一个未使用的模块，它仍会显示。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-08T21:09:20.343

我知道至少有两种方法可以尝试查看项目中使用的所有单元

1.  CTRL-SHIFT-B 打开对象浏览器。如果我没记错的话，你可以在这里查看使用过的单位。我不完全确定这种方法，也没有可用的 Delphi 来验证它。
2.  使用[模型制作者](http://www.modelmakertools.com/)；Modelmaker 可以为您提供所有单元依赖关系的树状视图。查看[可视化现有代码](http://www.modelmakertools.com/modelmaker/index.html)部分以获取更多信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-02-13T16:44:13.850

最简单的方法是编译程序并检查`.dcu`编译器创建的程序。确保将编译器设置为`.dcu`在单独的目录中创建，例如`c:\dcu`. 我创建了一个简单的实用程序，用于搜索编译器搜索路径（可以从或文件中读取）中的目录中`.pas`的每个文件。`.dcu``.cfg``.dof``.bdsproject`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-11-01T12:52:50.360

您可以将 MAP 文件与[MapFileStats](http://delphitools.info/other-tools/mapfilestats/)结合使用，这不仅会提供所有依赖项，还会提供它们在最终可执行文件中贡献的代码量（和资源）。

有助于发现您依赖但很少使用的单位，以及发现“肥猪”单位，这些单位会带走所有东西以及厨房水槽。

FWIW，减少依赖关系和消除 hogs 不仅有利于可执行文件大小，而且在升级到新版本的时候也有好处。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-08T21:34:11.687

有一个（相当老的）实用程序叫做 UsgParse。它构建项目引用的所有单元的树视图。

[我通过http://coding.derkeiler.com/Archive/Delphi/borland.public.delphi.thirdpartytools.general/2004-03/0231.html](http://coding.derkeiler.com/Archive/Delphi/borland.public.delphi.thirdpartytools.general/2004-03/0231.html)在 NexusDB 网站上找到了一份副本

来源： http: [//www.nexusdb.com/downloads/USGParse/USGParse_src.zip](http://www.nexusdb.com/downloads/USGParse/USGParse_src.zip)

二进制： http: [//www.nexusdb.com/downloads/USGParse/USGParse.zip](http://www.nexusdb.com/downloads/USGParse/USGParse.zip)

# oop - 组合关系和关联关系有什么区别？

> ID：731802
> 
> 赞同：23
> 
> 时间：2009-04-08T20:57:31.040
> 
> 标签：oop

在OOP中，类之间的组合（在UML中用实心菱形表示）和关联（在UML中用空菱形表示）关系有什么区别。我有点困惑。什么是聚合？我可以有一个令人信服的现实世界的例子吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-09T06:23:10.137

**作品**

想象一个软件公司，它由不同的业务单元（或部门）组成，例如存储 BU、网络 BU。汽车事业部 这些业务单位的生命周期由组织的生命周期决定。换言之，这些业务单位不能离开公司而独立存在。这是组成。（即公司由业务单位组成）

**协会**

软件公司可能有外部餐饮服务商为员工提供食物。这些餐饮服务商不是公司的一部分。但是，他们与公司有关联。即使我们的软件公司关闭，餐饮服务商也可以存在。他们可能会为另一家公司服务！因此，餐饮服务商的生命周期不受软件公司生命周期的支配。这是典型的联想

**聚合**

考虑一个汽车制造单位。我们可以将 Car 视为一个整体，而将 Car Wheel 视为 Car 的一部分。（此时，它可能看起来像合成......等等）车轮可以提前几周制造，它可以放在仓库中，然后在组装过程中放置​​在汽车上。在这个例子中，Wheel 类的实例显然独立于 Car 类的实例。因此，与组合不同，在聚合中，所涉及对象的生命周期不是紧密耦合的。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-08T21:28:36.910

这里举几个例子：

*   我是一家公司的员工，因此我与那家公司有联系。然而，我不是它的一部分，也不是它的创作者，而是与之相关的。

*   我是由器官组成的，除非被移植，否则它会和我一起死去。这就是组合，它是对象之间非常强的结合。基本上对象是由其他对象组成的。动词说明了一切。

*   还有另一种约束较少的组合，称为聚合。聚合是指对象由其他对象组成，但它们的生命周期不一定绑定。举一个极端的例子，乐高玩具是零件的集合。即使玩具可以拆卸，它的部件也可以重新组合以制作不同的玩具。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-08T21:03:39.327

拥有和使用。

组合：具有引用的对象*拥有*所引用的对象，并对它的“生命周期”、它的销毁（通常是创建，尽管它可能被传入）负责。也称为*有*关系。

关联：有引用的对象使用被引用*的*对象，不能是独占用户，不负责被引用对象的生命周期。也称为*使用*关系。

OP评论：

> 你能提供一个真实世界的例子吗？另外，什么是聚合？– 马克

聚合：从整体到部分的关联，不能循环。

例子：

组成：一辆车有一个引擎，一个人有一个地址。基本上，必须有，控制寿命。

关联：一个 Car 有一个 Driver，某个类实例有一个 ErrorLogger。终生不受控制，可以共享。

聚合：一个 DOM（文档对象模型，即构成 HTML 元素树的对象）节点有一个（一个数组）子节点。节点是顶级（嗯，更高）级别；它“包含”它的孩子，他们不包含它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-05-05T03:15:36.043

我相信基于代码的示例可以帮助说明上述响应给出的概念。

```
import java.util.ArrayList;

public final class AssoCia
{
    public static void main( String args[] )
    {
        B b = new B();
        ArrayList<C> cs = new ArrayList();

        A a = new A( b, cs );

        a.addC( new C() );
        a.addC( new C() );
        a.addC( new C() );
        a.listC();
    }
}

class A
{
    // Association -
    // this instance has a object of other class
    // as a member of the class.
    private B b;

    // Association/Aggregation -
    // this instance has a collection of objects
    // of other class and this collection is a
    // member of this class
    private ArrayList<C> cs;

    private D d;

    public A(B b, ArrayList<C> cs)
    {
        // Association
        this.b = b;

        // Association/Aggregation
        this.cs = cs;

        // Association/Composition -
        // this instance is responsible for creating
        // the instance of the object of the
        // other class. Therefore, when this instance 
        // is liberated from the memory, the object of
        // the other class is liberated, too.
        this.d = new D();
    }

    // Dependency -
    // only this method needs the object
    // of the other class.
    public void addC( C c )
    {
        cs.add( c );
    }

    public void listC()
    {
        for ( C c : cs )
        {
            System.out.println( c );
        }
    }

}

class B {}

class C {}

class D {} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T21:41:09.127

组合是比聚合更严格的关系。组合意味着某事物与其他事物密切相关，以至于它们基本上不能独立存在，或者如果可以，它们生活在不同的环境中。

现实世界的例子：您定义一个 GUI 窗口，然后定义一个文本字段来写一些东西。在定义 GUI 的类和定义文本字段的类之间存在组合。它们一起组成了一个小部件，该小部件可以单独视为一个实体。假设您删除了窗口，同时也删除了文本字段。

聚合是不同的，因为两个实体之间的联系是暂时的、不稳定的和偶尔的。一个真实世界的例子。假设您有一个包含多个数据实例的对象数据库。现在您运行一些过滤器来收集符合给定标准的数据实例，并将生成的实例推送到图形列表中，以便用户可以看到它们。当图形小部件接收到对象时，它可以形成这些实体的聚合，并呈现它们。如果用户关闭带有图形列表的窗口，而后者被删除，则不应删除数据对象。也许它们显示在其他地方，或者您仍然需要它们。

此外，一般来说，组合是在创建时定义的。相反，聚合是在对象生命周期的后期定义的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T21:02:37.567

通常，组合意味着包含对象的生命周期受容器生命周期的限制，而关联是对可能独立存在的对象的引用。

但是，这只是我观察到的做法。我不想承认，但是通过 UML2 规范在我要做的有趣事情清单上并不高！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T21:03:30.170

独立存在。

发票由行项目组成。

发票上没有的行项目是什么？它——好吧——没什么。它不能独立存在。

另一方面，发票与客户相关联。

客户有独立的存在，有或没有发票。

如果这两个东西独立存在，它们可能是相关联的。

如果一件事不能独立存在，那么它就是组合的一部分。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-08T21:04:25.783

组合意味着实体状态的一部分被另一种类型封装，但它在概念上是实体状态的一部分。例如，您可能有一个地址类型和一个包含地址的员工实体类型。

关联意味着一个实体类型与另一个实体类型关联，但关联的实体在概念上不是实体状态的一部分。例如，员工可能与公司相关联。

# javascript - 有人可以解释以下 javascript 代码吗？

> ID：731810
> 
> 赞同：1
> 
> 时间：2009-04-08T20:59:59.867
> 
> 标签：javascript, jquery

除了解释，javascript中的$是什么意思？这是代码：

```
var ZebraTable = {
    bgcolor: '',
    classname: '',
    stripe: function(el) {
        if (!$(el)) return;
        var rows = $(el).getElementsByTagName('tr');
    for (var i=1,len=rows.length;i<len;i++) {
        if (i % 2 == 0) rows[i].className = 'alt';
        Event.add(rows[i],'mouseover',function() { 
ZebraTable.mouseover(this); });
    Event.add(rows[i],'mouseout',function() { ZebraTable.mouseout(this); });
    }
},
mouseover: function(row) {
    this.bgcolor = row.style.backgroundColor;
    this.classname = row.className;
    addClassName(row,'over');
},
mouseout: function(row) {
    removeClassName(row,'over');
    addClassName(row,this.classname);
    row.style.backgroundColor = this.bgcolor;
}
}

window.onload = function() {
ZebraTable.stripe('mytable');
} 
```

这是我获取代码的链接，您可以在页面上查看演示。它似乎没有使用任何框架。我实际上正在阅读一个 JQuery 教程，该教程采用此代码并在其上使用 JQuery 来进行表条带化。链接在这里：

[http://v3.thewatchmakerproject.com/journal/309/stripe-your-tables-the-oo-way](http://v3.thewatchmakerproject.com/journal/309/stripe-your-tables-the-oo-way)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T21:15:43.603

> 有人可以解释以下 javascript 代码吗？

```
//Shorthand for document.getElementById
function $(id) {
    return document.getElementById(id);
}

var ZebraTable = {
    bgcolor: '',
    classname: '',

    stripe: function(el) {
        //if the el cannot be found, return
        if (!$(el)) return;

        //get all the <tr> elements of the table
        var rows = $(el).getElementsByTagName('tr');

        //for each <tr> element
        for (var i=1,len=rows.length;i<len;i++) {

            //for every second row, set the className of the <tr> element to 'alt'
            if (i % 2 == 0) rows[i].className = 'alt';

            //add a mouseOver event to change the row className when rolling over the <tr> element
            Event.add(rows[i],'mouseover',function() {
                ZebraTable.mouseover(this); 
            });

            //add a mouseOut event to revert the row className when rolling out of the <tr> element
            Event.add(rows[i],'mouseout',function() { 
                ZebraTable.mouseout(this); 
            });
        }
    },

    //the <tr> mouse over function
    mouseover: function(row) {
        //save the row's old background color in the ZebraTable.bgcolor variable
        this.bgcolor = row.style.backgroundColor;

        //save the row's className in the ZebraTable.classname variable
        this.classname = row.className;

        //add the 'over' class to the className property
        //addClassName is some other function that handles this
        addClassName(row,'over');
    },
    mouseout: function(row) {
        //remove the 'over' class form the className of the row
        removeClassName(row,'over');

        //add the previous className that was stored in the ZebraTable.classname variable
        addClassName(row,this.classname);

        //set the background color back to the value that was stored in the ZebraTable.bgcolor variable
        row.style.backgroundColor = this.bgcolor;
    }
}

window.onload = function() {
    //once the page is loaded, "stripe" the "mytable" element
    ZebraTable.stripe('mytable');
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T21:03:23.243

$ 在 Javascript 中没有任何意义，但它是一个有效的函数名称，并且一些库将它用作它们的包罗万象的函数，例如[Prototype](http://www.prototypejs.org/)和[jQuery](http://jquery.com/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T21:17:59.650

从您链接到的示例中：

```
function $() {
    var elements = new Array();
    for (var i=0;i<arguments.length;i++) {
        var element = arguments[i];
        if (typeof element == 'string') element = document.getElementById(element);
        if (arguments.length == 1) return element;
        elements.push(element);
    }
    return elements;
} 
```

该函数正在按属性`$`搜索元素。`id`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T21:06:10.083

该代码基本上将交替的表格行设置为具有不同的 CSS 类，并将 mouseover 和 mouseout 事件更改添加到第三个 css 类，突出显示鼠标下的行。

我不确定是否引用了 jQuery、原型或其他第三方 JS 库，但 jQuery 使用美元符号作为选择器。在这种情况下，用户正在测试对象是否为空。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T21:10:33.147

这个函数循环遍历表中的行并做两件事。

1) 设置交替行样式。if (i % 2 == 0) rows[i].className = 'alt' 表示每隔一行都将其类名设置为 alt。

2) 将 mouseover 和 mouseout 事件附加到行，以便当用户将鼠标悬停在行上时，行会更改背景颜色。

$ 是由各种 javascript 框架（例如 jquery）设置的函数，它只是调用 document.getElementById

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T21:05:50.397

`$`是所谓的“美元函数”，在许多 JavaScript 框架中用于查找元素和/或“包装”它，以便它可以与框架函数和类一起使用。我不认识使用的其他函数，所以我不能确切地告诉你这是使用*哪个*框架，但我的第一个猜测是[Prototype](http://www.prototypejs.org/)或[Dojo](http://www.dojotoolkit.org/)。（它当然*不是* [jQuery](http://jquery.com/)。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T21:12:30.507

该代码在 Javascript 中创建了一个 ZebraTable“对象”，它在 Javascript 中逐行对表进行条带化。

它有几个值得注意的成员函数：

*   stripe(el) - 你传入一个元素 el，假定它是一个表格。它获取表中的所有 <tr> 标记 (getElementsByTagName)，然后遍历它们，将类名“alt”分配给交替行。它还为鼠标悬停和鼠标移出添加了事件处理程序。
*   mouseover(row) - 一行的“鼠标悬停”事件处理程序，它存储该行的旧类和背景颜色，然后为其分配类名“over”
*   mouseout(row) - mouseover 的反转，恢复旧的类名和背景颜色。

$ 是一个函数，它返回给定元素名称或元素本身的元素。如果其参数无效（例如，不存在的元素），则返回 null

我相信正在使用的框架是 Prototype，因此您可以查看他们的文档以获取更多信息

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-08T21:14:34.043

看看你从中获得代码的文章的底部，你会看到他们说你还需要[原型的 $ 函数](http://www.sergiopereira.com/articles/prototype.js.html#DollarFunction)。来自文章

> 在您的 CSS 中，您需要为表格行指定默认样式，以及 tr.alt 和 tr.over 类。这是一个简单的演示，其中还包括您需要的其他函数（一个事件注册对象和 Prototype 的 $ 函数）。

# javascript - Javascript 模糊事件

> ID：731816
> 
> 赞同：1
> 
> 时间：2009-04-08T21:00:59.113
> 
> 标签：javascript, onblur

我有以下代码：

```
<span style="margin:0px 2px 0px 2px;">
    <asp:Label ID="labelPromptText" runat="server" Text="Selected Location:" />
    <span id="spanSelectedLocation" style="padding:2px 2px 2px 2px; cursor:pointer;" onmouseover="javascript:SetBackgroundColor('spanSelectedLocation', '#E0E0E0');" onmouseout="javascript:SetBackgroundColor('spanSelectedLocation', '#FFFFFF');" onclick="ControlLocationsVisibility();">
        <asp:Label ID="labelDisplay" runat="server" Text="None" Font-Bold="True" />
        <img alt="Click to change" src="Images/downArrow.png" />
    </span>
</span>

<asp:Panel ID="panelLocations" runat="server" DefaultButton="buttonFindLocation" style="position:absolute;border:solid 1px #E0E0E0;padding:10px 5px 5px 10px;background-color:#F7F7F7;width:350px;display:none;" >
    Search: <asp:TextBox ID="textboxLocationSearch" runat="server" />

    <asp:Button ID="buttonFindLocation" runat="server" Text="Find" OnClick="buttonFindLocation_Click" />

    <input type="button" value="Cancel" onclick="javascript:ControlLocationsVisibility();"

    <hr />

    <asp:TreeView ID="TreeViewLocations" runat="server" OnSelectedNodeChanged="TreeViewLocations_SelectedNodeChanged" NodeIndent="10"></asp:TreeView>
</asp:Panel> 
```

当有人点击面板时，我希望能够隐藏 panelLocations。我尝试放置 panelLocations 的 onblur 事件，但单击 TreeView 时它总是消失。

当有人在面板外部单击而不是在面板内部单击时，如何隐藏面板？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T21:12:42.877

如果你使用 setTimeout() 和 clearTimeout() 你可以使用你提到的 blurevent，但是当面板内的任何东西获得焦点时清除超时。这样，事件执行的唯一时间就是它“真正”失去焦点的时候。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T21:23:01.260

您的另一种选择是处理主体上的 onclick 事件，但这可能会很快变慢。如果你走那条路，它看起来像这样：

```
<html>
 <head>
  <title>Hide Test</title>
 </head>
 <body>
  <div id="first">
    <p>This is the first div.</p>
  </div>
  <div id="second">
    <p>This is the second div.</p>
  </div>
  <script type="text/javascript">
  var first = document.getElementById("first");
  var second = document.getElementById("second");
  var isChildOf = function (ele, parent) {
    if (ele.parentNode === null) {
        return false;
    } else if (ele.parentNode === parent) {
        return true;
    } else {
        return isChildOf(ele.parentNode, parent);
    }
  };
  document.body.onclick = function(e) {
    if (isChildOf(e.target, second)) {
        console.log("Hiding second.");
        second.style.display = 'none';
    } else {
        console.log("Showing second.");
        second.style.display = 'block';
    }
  };
  </script>
 </body>
</html> 
```

# selenium - 如何将焦点更改为 Selenium 中的新弹出选项卡？

> ID：731817
> 
> 赞同：21
> 
> 时间：2009-04-08T21:01:17.100
> 
> 标签：selenium

我正在使用 Selenium 和 Firefox。

我在一个页面上有一个链接（比如linkA），它在新选项卡中打开一个新页面。单击链接A 时会显示新选项卡。然后我想与新页面进行交互。

这是我的硒脚本：

*   点击链接A
*   暂停 5000
*   选择窗口标题
*   点击linkB（注意：linkB在新页面上）

Selenium 无法识别新选项卡。它报告：

[警告] 链接有目标“_blank”，Selenium 不支持！随机化目标为：selenium_blank24003

有没有办法告诉 Selenium 与显示的选项卡进行交互？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T21:05:26.047

您是否尝试在 selectWindow 之间添加 windowFocus 并单击 linkB？

编辑：selectWindow 采用 Javascript windowID。您的 linkA 是否指定了一个供 Selenium 访问的 windowID？

这是完整的第一个测试页面 (t1.html)，在 window.open 调用中，第二个参数是 'WindowTest'，这是 selenium 查找的 javascript windowID。

```
<a href="javascript:void(0);" name="t1" 
   onclick="window.open('t2.html', 'WindowTest', 'width=450,height=600');">
 test
</a> 
```

这是第二个测试页面（t2.html）：

```
<a href="t1.html" name="t2">2test2</a> 
```

运行您的脚本最终会在 t1.html 上弹出窗口 我的脚本

```
click              link=test
pause              5000
selectWindow       WindowTest
windowFocus
click              link=2test2 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-06-17T07:23:32.157

嗨试试这个..

```
Set<String> winSet = driver.getWindowHandles();
        List<String> winList = new ArrayList<String>(winSet);
        String newTab = winList.get(winList.size() - 1);
        System.out.println("winList: "+winList.size());
        //driver.close(); // close the original tab
        driver.switchTo().window(newTab); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-24T13:35:08.133

它对我有用。

```
[info] Executing: |storeEval | this.browserbot.findElement('link=Pastanet').href | Link_PastaNet |
[info] Executing: |openWindow | ${Link_PastaNet} | MyWindows | 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-24T08:02:25.207

```
Iterator<String> windowIterator = driver.getWindowHandles().iterator();while (windowIterator.hasNext()) {
String windowHandle = windowIterator.next();
driverwindow = driver.switchTo().window(windowHandle);
if (_driverwindow.getTitle().equals("Title of the window to switch")) {
}
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-16T10:29:33.537

以下是我为 Selenium IDE 采取的步骤：

1.  找到有问题的链接
2.  从链接中删除属性“目标”
3.  将 href 目标复制到变量 (myUrl) 中
4.  修改链接 href->javascript:window.open(myUrl,'myWindow')
5.  点击链接
6.  选择窗口“我的窗口”</li>

获取评估 | this.page().findElement('link=click here').removeAttribute('target')||

商店评估 | this.page().findElement('link=click here').href | 我的网址

获取评估 | this.page().findElement('link=click here').href=”javascript:window.open('${myUrl}','myWindow')” ||

点击 | 链接=点击这里 ||

暂停 | 1000 ||

选择窗口 | 名称=我的窗口 ||

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-29T08:36:33.503

只需使用此代码。

```
public void newtab(){

    System.setProperty("webdriver.chrome.driver", "E:\\eclipse\\chromeDriver.exe");

    WebDriver driver = new ChromeDriver();

    driver.get("http://www.w3schools.com/tags/att_a_target.asp");

    //I have provided a sample link. Make sure that you have provided the correct link in the above line.

    driver.findElement(By.className("tryitbtn")).click();

    new Actions(driver).sendKeys(driver.findElement(By.tagName("html")), Keys.CONTROL).sendKeys(driver.findElement(By.tagName("html")), Keys.NUMPAD2).build().perform();

    // In keyboard we will press 

    //ctrl+1 for 1st tab

   //ctrl+2 for 2nd tab

   //ctrl+3 for 3rd tab.

  //Same action is written in the above code.

} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-28T04:06:08.853

lericain59 向我发送了正确的方向，尽管我必须进行一些更改才能使其适用于我的 selenium IDE 版本（我正在运行 1.0.6）。此外，出于我的目的，我不需要验证它是否在单独的窗口中打开，只需要它打开正确的窗口即可。

这是对我有用的脚本。

*   商店评估 | this.browserbot.findElement('link=click here').href | 我的网址 |
*   开放| ${我的网址} ||

this.page() 不起作用。它似乎已被 this.browserbot 取代。另外，我只是直接打开了页面-它避免了手动暂停并且步骤更少。

# php - 显示 mysql 查询的内容，只有第一个字段有效

> ID：731818
> 
> 赞同：0
> 
> 时间：2009-04-08T21:01:46.880
> 
> 标签：php, mysql, mysqli, prepared-statement

我正在使用带有 php 的 mysqli prepard 查询，代码是：

```
$retreiveQuery = 'SELECT username, firstname, lastname FROM USERS WHERE username = ?';

if ($getRecords = $con->prepare($retreiveQuery)) {
    $getRecords->bind_param("s", $username);

    $getRecords->execute();        
    $getRecords->bind_result($username, $firstname, $lastname);

echo "<h1>".$username."</h1>
<p><strong>First Name: </strong>".$firstname."
<p><strong>Surname: </strong>".$lastname."
} else {
print_r($con->error); 
```

这很奇怪。用户名是唯一显示的字段。为什么其他列不会被返回/绑定？

如果我做

```
SELECT username, firstname, lastname FROM USERS WHERE username = 'test'; 
```

直接到数据库，显示所有字段，并且都包含有效数据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T21:05:31.460

如果您对用户名的输出使用不同的变量名会发生什么？像这样：

SELECT username as user_name, firstname, lastname FROM USERS WHERE username = 'test';

进而

$getRecords->bind_result($user_name, $firstname, $lastname);

我想知道是否因为输入和输出使用相同的名称而感到困惑？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T21:08:00.393

我还没有运行它，但我注意到您使用相同的变量 $username 用于绑定参数和绑定结果变量。

可能是结果没有返回其中任何一个，但 $username 显示了一个值，因为您预先分配了它，而不是因为它来自数据库。

尝试使用不同的变量，如 $param_user 和 $result_user，看看会发生什么。我的猜测是不会返回任何结果，这将表明查询或结果绑定存在问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T21:09:34.710

你必须打电话

```
$getRecords->fetch(); 
```

在`bind_result()` 真正得到记录之后。

正在输出用户名，因为您已经将其设置为输入参数。

# sql - T-SQL 执行和范围

> ID：731821
> 
> 赞同：5
> 
> 时间：2009-04-08T21:02:18.893
> 
> 标签：sql, tsql, scope, identity

假设我的主体中有一个存储过程：

```
EXEC 'INSERT INTO ' + quotename(@table) ' blah...'
SELECT IDENT_CURRENT('' + @table + '') 
```

IDENT_CURRENT() 是否保证在 EXEC 中获得插入该行的标识？IDENT_CURRENT() “返回在任何会话和任何范围内为特定表生成的最后一个标识值”，但 EXEC 中的范围与存储过程不同，对吧？

我想确保如果一次多次调用存储过程，则选择正确的标识。

编辑：或者我是否需要在 EXEC 中同时执行 INSERT 和 SELECT，如下所示：

```
declare @insert nvarchar
set @insert = 
    'INSERT INTO ' + quotename(@table) ' blah...' +
    'SELECT IDENT_CURRENT(''' + @table + ''')'
EXEC @insert 
```

如果是这种情况，如果我想继续使用 T-SQL 中的更多代码，我该如何选择 EXEC 的结果？像这样（虽然它显然是不正确的）：

```
declare @insert nvarchar
set @insert = 
    'INSERT INTO ' + quotename(@table) ' blah...' +
    'SELECT IDENT_CURRENT(''' + @table + ''')'

declare @ident int
set @ident = EXEC @insert

-- more code
SELECT * FROM blah 
```

**更新：在第一个片段中，如果我选择 SCOPE_IDENTITY() 而不是使用 IDENT_CURRENT()，则 SELECT 将返回 NULL。:(**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T21:04:30.697

尝试

```
EXEC 'INSERT INTO ' + quotename(@table) ' blah...; SELECT @@IDENTITY' 
```

或者更好，根据[这个](https://stackoverflow.com/questions/42648/best-way-to-get-identity-of-inserted-row)

```
EXEC 'INSERT INTO ' + quotename(@table) ' blah...; SELECT SCOPE_IDENTITY()' 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T21:07:34.340

根据微软的 T-SQL 文档：

> IDENT_CURRENT 类似于 SQL Server 2000 标识函数 SCOPE_IDENTITY 和 @@IDENTITY。所有三个函数都返回最后生成的标识值。但是，在每个函数中定义 last 的范围和会话不同：
> 
> IDENT_CURRENT 返回为任何会话和任何范围内的特定表生成的最后一个标识值。
> 
> @@IDENTITY 返回为当前会话中的任何表在所有范围内生成的最后一个标识值。
> 
> SCOPE_IDENTITY 返回为当前会话和当前范围中的任何表生成的最后一个标识值。

所以我想说，不，IDENT_CURRENT*不能*保证给你正确的价值。它可能是在不同会话中插入的最后一个 IDENTITY 值。

我会确保改用 SCOPE_IDENTITY - 这应该可以可靠地工作。

马克

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T21:16:31.417

[http://blog.sqlauthority.com/2009/03/24/sql-server-2008-scope_identity-bug-with-multi-processor-parallel-plan-and-solution/](http://blog.sqlauthority.com/2009/03/24/sql-server-2008-scope_identity-bug-with-multi-processor-parallel-plan-and-solution/)

*SCOPE_IDENTITY() 中有一个错误* 我已将存储过程切换到用于从插入中检索默认值的方法：

```
 declare @TheNewIds table (Id bigint, Guid uniqueidentifier)
 insert [dbo].[TestTable] output inserted.Id, inserted.Guid into @TheNewIds
 values (default);
 select @Id = [Id], @Guid = [Guid] from @TheNewIds; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T21:06:48.757

我认为 Scope_Identity() 是您正在寻找的，它将为您提供当前范围内的最新标识。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T09:52:40.690

我想通过使用 OUTPUT 关键字加入我最喜欢的解决方案。由于 INSERT 一次可以支持多行，我们想知道插入的身份。开始：

```
 -- source table
if object_id('Source') is not null drop table Source
create table Source
(
    Value datetime
)
-- populate source
insert Source select getdate()
waitfor delay '00:00.1'
insert Source select getdate()
waitfor delay '00:00.1'
insert Source select getdate()
select * from Source -- test
-- destination table
if object_id('Destination') is null
create table Destination
(
    Id int identity(1, 1),
    Value datetime
)
-- tracking table to keep all generated Id by insertion of table Destination
if object_id('tempdb..#Track') is null
create table #Track 
(
    Id int  
)
else delete #Track
-- copy source into destination, track the Id using OUTPUT
insert Destination output inserted.Id into #Track select Value from Source
select Id from #Track -- list out all generated Ids 
```

继续运行它多次以感受它是如何工作的。

# c# - 将非泛型集合转换为泛型集合的最佳方法

> ID：731831
> 
> 赞同：12
> 
> 时间：2009-04-08T21:04:08.450
> 
> 标签：c#, generics, enumerator

将非泛型集合转换为泛型集合的最佳方法是什么？有没有办法 LINQ 呢？

我有以下代码。

```
public class NonGenericCollection:CollectionBase
{
    public void Add(TestClass a)
    {
        List.Add(a);
    }
}

public class ConvertTest
{
    public static List<TestClass> ConvertToGenericClass( NonGenericCollection    collection)
    {
        // Ask for help here.
    }
} 
```

谢谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-08T21:15:54.587

由于您可以保证它们都是 TestClass 实例，因此请使用[LINQ Cast<T> 方法](http://msdn.microsoft.com/en-us/library/bb341406.aspx)：

```
public static List<TestClass> ConvertToGenericClass(NonGenericCollection collection)
{
   return collection.Cast<TestClass>().ToList();
} 
```

编辑：如果您只想要（可能）异构集合的 TestClass 实例，请使用 OfType<T> 过滤它：

```
public static List<TestClass> ConvertToGenericClass(NonGenericCollection collection)
{
   return collection.OfType<TestClass>().ToList();
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-08-18T06:43:30.773

另一种优雅的方法是创建一个这样的包装类（我将它包含在我的实用程序项目中）。

```
public class EnumerableGenericizer<T> : IEnumerable<T>
{
    public IEnumerable Target { get; set; }

    public EnumerableGenericizer(IEnumerable target)
    {
        Target = target;
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }

    public IEnumerator<T> GetEnumerator()
    {
        foreach(T item in Target)
        {
            yield return item;
        }
    }
} 
```

您现在可以这样做：

```
IEnumerable<MyClass> genericized = 
    new EnumerableGenericizer<MyClass>(nonGenericCollection); 
```

然后，您可以在泛型集合周围包装一个普通的泛型列表。

# math - 设计函数 f(f(n)) == -n

> ID：731832
> 
> 赞同：846
> 
> 时间：2009-04-08T21:04:18.170
> 
> 标签：math, integer

我上次面试时遇到的一个问题：

> 设计一个函数`f`，这样：
> 
> ```
> f(f(n)) == -n 
> ```
> 
> 哪里`n`是 32 位有**符号整数**；你不能使用复数算术。
> 
> 如果您不能为整个数字范围设计这样的函数，请尽可能设计最大范围。

有任何想法吗？

* * *

## 回答 #1

> 赞同：442
> 
> 时间：2009-04-08T21:59:54.620

你没有说他们期望什么样的语言......这是一个静态解决方案（Haskell）。它基本上弄乱了 2 个最重要的位：

```
f :: Int -> Int
f x | (testBit x 30 /= testBit x 31) = negate $ complementBit x 30
    | otherwise = complementBit x 30 
```

使用动态语言（Python）要容易得多。只需检查参数是否为数字 X 并返回一个返回 -X 的 lambda：

```
def f(x):
   if isinstance(x,int):
      return (lambda: -x)
   else:
      return x() 
```

* * *

## 回答 #2

> 赞同：378
> 
> 时间：2009-04-08T21:23:00.683

怎么样：

```
f(n) = 符号(n) - (-1) n * n
```

在 Python 中：

```
def f(n): 
    if n == 0: return 0
    if n >= 0:
        if n % 2 == 1: 
            return n + 1
        else: 
            return -1 * (n - 1)
    else:
        if n % 2 == 1:
            return n - 1
        else:
            return -1 * (n + 1) 
```

Python 自动将整数提升为任意长度的 long。在其他语言中，最大的正整数会溢出，因此它适用于除那个之外的所有整数。

* * *

要使其适用于实数，您需要将(-1) n 中*的 n*^(替换)为`{ ceiling(n) if n>0; floor(n) if n<0 }`。

在 C# 中（适用于任何双精度，溢出情况除外）：

```
static double F(double n)
{
    if (n == 0) return 0;

    if (n < 0)
        return ((long)Math.Ceiling(n) % 2 == 0) ? (n + 1) : (-1 * (n - 1));
    else
        return ((long)Math.Floor(n) % 2 == 0) ? (n - 1) : (-1 * (n + 1));
} 
```

* * *

## 回答 #3

> 赞同：288
> 
> 时间：2009-05-05T13:33:58.640

如果不使用额外信息（32 位 int 除外），以下是为什么对于所有数字都不能存在这样的函数的证明：

我们必须有 f(0) = 0。（证明：假设 f(0) = x。那么 f(x) = f(f(0)) = -0 = 0。现在，-x = f(f(x )) = f(0) = x，这意味着 x = 0。)

此外，对于任何`x`和`y`，假设`f(x) = y`。那时我们想要`f(y) = -x`。和`f(f(y)) = -y => f(-x) = -y`。总结一下：如果`f(x) = y`, 那么`f(-x) = -y`, 和`f(y) = -x`, 和`f(-y) = x`.

因此，我们需要将除 0 以外的所有整数分成 4 个一组，但我们有奇数个这样的整数；不仅如此，如果我们删除没有正对应的整数，我们仍然有 2(mod4) 个数字。

如果我们删除剩下的 2 个最大数（按绝对值），我们可以得到函数：

```
int sign(int n)
{
    if(n>0)
        return 1;
    else 
        return -1;
}

int f(int n)
{
    if(n==0) return 0;
    switch(abs(n)%2)
    {
        case 1:
             return sign(n)*(abs(n)+1);
        case 0:
             return -sign(n)*(abs(n)-1);
    }
} 
```

当然，另一种选择是不遵守 0，并获得我们删除的 2 个数字作为奖励。（但这只是一个愚蠢的假设。）

* * *

## 回答 #4

> 赞同：148
> 
> 时间：2009-04-10T08:55:22.013

由于 C++ 中的重载：

```
double f(int var)
{
 return double(var);
} 

int f(double var)
{
 return -int(var);
}

int main(){
int n(42);
std::cout<<f(f(n));
} 
```

* * *

## 回答 #5

> 赞同：134
> 
> 时间：2009-04-09T09:37:01.793

或者，您可以滥用预处理器：

```
#define f(n) (f##n)
#define ff(n) -n

int main()
{
  int n = -42;
  cout << "f(f(" << n << ")) = " << f(f(n)) << endl;
} 
```

* * *

## 回答 #6

> 赞同：104
> 
> 时间：2009-04-08T21:08:21.967

这适用于所有负数。

```
    f(n) = 绝对值(n)

```

因为对于二进制补码整数，负数比正数多一个，所以比与 相同的解`f(n) = abs(n)`多一种情况有效。得到你一个... :D`f(n) = n > 0 ? -n : n``f(n) = -abs(n)`

**更新**

不，这对于一种情况无效，因为我刚刚从 litb 的评论中认识到......`abs(Int.Min)`只会溢出......

我也考虑过使用 mod 2 信息，但得出结论，它不起作用......到早。如果操作正确，它将适用于所有数字，除非`Int.Min`它会溢出。

**更新**

我玩了一段时间，寻找一个不错的位操作技巧，但我找不到一个不错的单线，而 mod 2 解决方案适合其中。

```
    f(n) = 2n(abs(n) % 2) - n + sgn(n)

```

在 C# 中，这变为以下内容：

```
public static Int32 f(Int32 n)
{
    return 2 * n * (Math.Abs(n) % 2) - n + Math.Sign(n);
} 
```

要使其适用于所有值，您必须替换`Math.Abs()`为`(n > 0) ? +n : -n`并将计算包含在一个`unchecked`块中。然后，您甚至`Int.Min`可以像未经检查的否定一样映射到自身。

**更新**

受另一个答案的启发，我将解释该函数的工作原理以及如何构造这样的函数。

让我们从头开始。该函数`f`重复应用于给定值`n`，从而产生一系列值。

```
    n => f(n) => f(f(n)) => f(f(f(n))) => f(f(f(f(n)))) => ...

```

问题要求`f(f(n)) = -n`，即`f`否定论点的两次连续应用。两个进一步的应用`f`- 总共四个 - 再次否定了这个论点`n`。

```
    n => f(n) => -n => f(f(f(n))) => n => f(n) => ...

```

现在有一个明显的长度为四的循环。代入`x = f(n)`并注意到所获得的方程`f(f(f(n))) = f(f(x)) = -x`成立，得到以下结果。

```
    n => x => -n => -x => n => ...

```

所以我们得到一个长度为 4 的循环，其中有两个数字，两个数字取反。如果您将循环想象为一个矩形，则否定值位于对角。

构造这样一个循环的许多解决方案之一是以下从 n 开始。

```
n => 否定和减一
-n - 1 = -(n + 1) => 加一
-n => 取反加一
 n + 1 => 减一
 n

```

一个具体的例子就是这样一个循环`+1 => -2 => -1 => +2 => +1`。我们快完成了。注意到构造的循环包含一个奇数正数，它的偶数后继，并且两个数都取反，我们可以很容易地将整数划分为许多这样的循环（`2^32`是四的倍数），并找到了一个满足条件的函数。

但是我们有一个零问题。循环必须包含`0 => x => 0`，因为零对其自身取反。并且因为循环状态已经`0 => x`遵循它`0 => x => 0 => x`。这只是一个长度为 2 的循环，并且`x`在两次应用后变为自身，而不是变为`-x`. 幸运的是，有一个案例可以解决这个问题。如果`X`等于 0，我们得到一个长度为 1 的只包含零的循环，并且我们解决了这个问题，得出的结论是零是 的一个不动点`f`。

完毕？几乎。我们有`2^32`数字，零是留下`2^32 - 1`数字的固定点，我们必须将该数字划分为四个数字的循环。不好，这`2^32 - 1`不是四的倍数 - 将保留三个数字，不在任何长度为四的循环中。

我将使用较小的一组 3 位有符号迭代器来解释解决方案的其余部分，范围从`-4`到`+3`. 我们已经完成了零。我们有一个完整的周期`+1 => -2 => -1 => +2 => +1`。现在让我们构造从 开始的循环`+3`。

```
    +3 => -4 => -3 => +4 => +3

```

出现的问题`+4`是不能表示为 3 位整数。我们将`+4`通过取反`-3`来获得`+3`- 仍然是一个有效的 3 位整数 - 但然后将`+3`(binary `011`) 加 1 产生`100`二进制。解释为无符号整数，`+4`但我们必须将其解释为有符号整数`-4`。所以实际上`-4`对于这个例子或`Int.MinValue`在一般情况下是整数算术否定的第二个固定点 -`0` 并且`Int.MinValue`被映射到它们自己。所以循环实际上如下。

```
    +3 => -4 => -3 => -4 => -3

```

它是一个长度为 2 的循环，另外`+3`通过 进入循环`-4`。结果`-4`在两次函数应用后正确映射到自身，在两次函数应用后正确映射到自身`+3`，`-3`但`-3`在两次函数应用后错误地映射到自身。

所以我们构造了一个函数，它适用于除一个以外的所有整数。我们能做得更好吗？不，我们不可以。为什么？我们必须构造长度为四的循环，并且能够覆盖整个整数范围，最多四个值。剩下的值是两个固定点`0`，`Int.MinValue`必须映射到它们自己和两个任意整数`x`，`-x`并且必须由两个函数应用程序相互映射。

要映射`x`到`-x`，反之亦然，它们必须形成一个四环，并且它们必须位于该环的对角。因此`0`，`Int.MinValue`也必须在对角。这将正确映射`x`并`-x`交换两个固定点`0`，并`Int.MinValue`在两个函数应用程序之后给我们留下两个失败的输入。所以不可能构造一个适用于所有值的函数，但是我们有一个适用于除一个之外的所有值的函数，这是我们能达到的最好的。

* * *

## 回答 #7

> 赞同：98
> 
> 时间：2009-04-09T21:18:47.507

使用复数，您可以有效地将求反的任务分为两个步骤：

*   将 n 乘以 i，得到 n*i，将 n 逆时针旋转 90°
*   再乘以 i，得到 -n

最棒的是您不需要任何特殊的处理代码。只需乘以 i 就可以了。

但是你不能使用复数。因此，您必须使用部分数据范围以某种方式创建自己的假想轴。由于您需要与初始值一样多的虚构（中间）值，因此您只剩下一半的数据范围。

假设有符号的 8 位数据，我试图在下图中对此进行可视化。您必须将其缩放为 32 位整数。初始 n 的允许范围是 -64 到 +63。以下是该函数对正 n 的作用：

*   如果 n 在 0..63（初始​​范围）内，则函数调用添加 64，将 n 映射到范围 64..127（中间范围）
*   如果 n 在 64..127（中间范围）内，则函数从 64 中减去 n，将 n 映射到范围 0..-63

对于负 n，函数使用中间范围 -65..-128。

![替代文字](https://i.stack.imgur.com/JHgzb.png)

* * *

## 回答 #8

> 赞同：67
> 
> 时间：2010-06-27T08:11:23.470

作品除了 int.MaxValue 和 int.MinValue

```
 public static int f(int x)
    {

        if (x == 0) return 0;

        if ((x % 2) != 0)
            return x * -1 + (-1 *x) / (Math.Abs(x));
        else
            return x - x / (Math.Abs(x));
    } 
```

![画报](https://i.stack.imgur.com/ahbF8.jpg)

* * *

## 回答 #9

> 赞同：48
> 
> 时间：2009-04-08T21:32:25.187

**这个问题没有说明函数的输入类型和返回值`f`必须是什么**（至少不是你提出的方式）......

...只是当 n 是一个 32 位整数时`f(f(n)) = -n`

那么，像这样的东西怎么样

```
Int64 f(Int64 n)
{
    return(n > Int32.MaxValue ? 
        -(n - 4L * Int32.MaxValue):
        n + 4L * Int32.MaxValue);
} 
```

如果 n 是 32 位整数，则该语句`f(f(n)) == -n`为真。

显然，这种方法可以扩展到更广泛的数字范围......

* * *

## 回答 #10

> 赞同：48
> 
> 时间：2009-04-08T22:01:15.817

对于 javascript（或其他动态类型语言），您可以让函数接受一个 int 或一个对象并返回另一个。IE

```
function f(n) {
    if (n.passed) {
        return -n.val;
    } else {
        return {val:n, passed:1};
    }
} 
```

给予

```
js> f(f(10))  
-10
js> f(f(-10))
10 
```

或者，您可以在强类型语言中使用重载，尽管这可能会违反规则，即

```
int f(long n) {
    return n;
}

long f(int n) {
    return -n;
} 
```

* * *

## 回答 #11

> 赞同：46
> 
> 时间：2009-04-08T21:09:26.927

根据您的平台，某些语言允许您在函数中保持状态。VB.Net，例如：

```
Function f(ByVal n As Integer) As Integer
    Static flag As Integer = -1
    flag *= -1

    Return n * flag
End Function 
```

IIRC，C++ 也允许这样做。我怀疑他们正在寻找不同的解决方案。

另一个想法是，由于他们没有定义第一次调用函数的结果，您可以使用奇数/偶数来控制是否反转符号：

```
int f(int n)
{
   int sign = n>=0?1:-1;
   if (abs(n)%2 == 0)
      return ((abs(n)+1)*sign * -1;
   else
      return (abs(n)-1)*sign;
} 
```

所有偶数的大小加一，所有奇数的大小减一。两次调用的结果具有相同的量级，但一次调用甚至我们交换了符号。在某些情况下这不起作用（-1、max 或 min int），但它比迄今为止建议的任何其他方法都好得多。

* * *

## 回答 #12

> 赞同：26
> 
> 时间：2010-06-27T07:02:54.443

利用 JavaScript 异常。

```
function f(n) {
    try {
        return n();
    }
    catch(e) { 
        return function() { return -n; };
    }
} 
```

> `f(f(0)) => 0`
> 
> `f(f(1)) => -1`

* * *

## 回答 #13

> 赞同：21
> 
> 时间：2009-04-08T22:08:50.730

对于所有 32 位值（需要注意的是 -0 是 -2147483648）

```
int rotate(int x)
{
    static const int split = INT_MAX / 2 + 1;
    static const int negativeSplit = INT_MIN / 2 + 1;

    if (x == INT_MAX)
        return INT_MIN;
    if (x == INT_MIN)
        return x + 1;

    if (x >= split)
        return x + 1 - INT_MIN;
    if (x >= 0)
        return INT_MAX - x;
    if (x >= negativeSplit)
        return INT_MIN - x + 1;
    return split -(negativeSplit - x);
} 
```

您基本上需要将每个 -x => x => -x 循环与 ay => -y => y 循环配对。所以我将`split`.

例如对于 4 位整数：

```
0 => 7 => -8 => -7 => 0
1 => 6 => -1 => -6 => 1
2 => 5 => -2 => -5 => 2
3 => 4 => -3 => -4 => 3 
```

* * *

## 回答 #14

> 赞同：21
> 
> 时间：2009-04-09T09:21:45.853

一个 C++ 版本，可能有点违反规则，但适用于所有数字类型（浮点数、整数、双精度数），甚至是重载一元减号的类类型：

```
template <class T>
struct f_result
{
  T value;
};

template <class T>
f_result <T> f (T n)
{
  f_result <T> result = {n};
  return result;
}

template <class T>
T f (f_result <T> n)
{
  return -n.value;
}

void main (void)
{
  int n = 45;
  cout << "f(f(" << n << ")) = " << f(f(n)) << endl;
  float p = 3.14f;
  cout << "f(f(" << p << ")) = " << f(f(p)) << endl;
} 
```

* * *

## 回答 #15

> 赞同：20
> 
> 时间：2009-08-12T00:38:08.460

x86 asm（AT&T 风格）：

```
; input %edi
; output %eax
; clobbered regs: %ecx, %edx
f:
    testl   %edi, %edi
    je  .zero

    movl    %edi, %eax
    movl    $1, %ecx
    movl    %edi, %edx
    andl    $1, %eax
    addl    %eax, %eax
    subl    %eax, %ecx
    xorl    %eax, %eax
    testl   %edi, %edi
    setg    %al
    shrl    $31, %edx
    subl    %edx, %eax
    imull   %ecx, %eax
    subl    %eax, %edi
    movl    %edi, %eax
    imull   %ecx, %eax
.zero:
    xorl    %eax, %eax
    ret 
```

检查代码，所有可能的 32 位整数都通过，错误 -2147483647（下溢）。

* * *

## 回答 #16

> 赞同：19
> 
> 时间：2009-04-09T16:29:26.033

使用全局变量...但是这样吗？

```
bool done = false
f(int n)
{
  int out = n;
  if(!done)
  {  
      out = n * -1;
      done = true;
   }
   return out;
} 
```

* * *

## 回答 #17

> 赞同：19
> 
> 时间：2009-08-26T13:10:13.587

这个 Perl 解决方案**适用于整数、浮点数和字符串**。

```
sub f {
    my $n = shift;
    return ref($n) ? -$$n : \$n;
} 
```

尝试一些测试数据。

```
print $_, ' ', f(f($_)), "\n" for -2, 0, 1, 1.1, -3.3, 'foo' '-bar'; 
```

输出：

```
-2 2
0 0
1 -1
1.1 -1.1
-3.3 3.3
foo -foo
-bar +bar 
```

* * *

## 回答 #18

> 赞同：18
> 
> 时间：2009-08-26T20:58:02.543

没有人说过 f(x) 必须是同一类型。

```
def f(x):
    if type(x) == list:
        return -x[0]
    return [x]

f(2) => [2]
f(f(2)) => -2 
```

* * *

## 回答 #19

> 赞同：16
> 
> 时间：2009-04-10T09:23:07.517

我实际上并没有试图解决问题本身，但确实有一些评论，因为问题表明这个问题是（工作？）面试的一部分：

*   我首先会问“为什么需要这样的功能？这是什么更大的问题？” 而不是试图当场解决实际提出的问题。这显示了我的想法以及我如何解决这样的问题。谁知道？这甚至可能是最初在面试中提出这个问题的实际原因。如果答案是“没关系，假设它是必需的，然后告诉我你将如何设计这个功能。” 然后我会继续这样做。
*   然后，我将编写我将使用的 C# 测试用例代码（很明显：循环 from `int.MinValue`to `int.MaxValue`，并且对于`n`该范围内的每个调用`f(f(n))`并检查结果是`-n`），告诉我然后将使用测试驱动开发来获得这样的功能。
*   只有当面试官继续要求我解决提出的问题时，我才会在面试过程中真正开始尝试并写下伪代码，以尝试得到某种答案。但是，如果面试官能说明公司的情况，我真的不认为我会跳槽接受这份工作……

哦，这个答案假设面试是针对 C# 编程相关职位的。如果面试是针对与数学相关的职位，那当然是一个愚蠢的答案。;-)

* * *

## 回答 #20

> 赞同：16
> 
> 时间：2009-05-31T04:58:45.233

我会更改 2 个最重要的位。

```
00.... => 01.... => 10.....

01.... => 10.... => 11.....

10.... => 11.... => 00.....

11.... => 00.... => 01..... 
```

正如你所看到的，它只是一个加法，省略了进位。

我是怎么得到答案的？我的第一个想法只是需要对称。4转回到我开始的地方。起初我以为，那是 2 位格雷码。然后我认为实际上标准二进制就足够了。

* * *

## 回答 #21

> 赞同：16
> 
> 时间：2009-09-26T16:45:59.067

这是一个受需求启发或声称不能使用复数来解决此问题的解决方案。

乘以 -1 的平方根是一个想法，这似乎只是失败了，因为 -1 在整数上没有平方根。但是玩像mathematica这样的程序给出了例如方程

> (1849436465 ² +1) 模 (2 ^(32) -3) = 0。

这几乎和-1的平方根一样好。函数的结果需要是有符号整数。因此，我将使用修改后的模运算 mods(x,n) 返回整数 y，它与最接近 0 的 x 模 n 一致。只有极少数编程语言具有模运算，但可以轻松定义. 例如在python中是：

```
def mods(x, n):
    y = x % n
    if y > n/2: y-= n
    return y 
```

使用上面的等式，现在可以将问题解决为

```
def f(x):
    return mods(x*1849436465, 2**32-3) 
```

这满足`f(f(x)) = -x`范围内的所有整数。的结果也在这个范围内，但是计算当然需要 64 位整数。`[-2`^(`31`)`-2, 2`^(`31`)`-2]``f(x)`

* * *

## 回答 #22

> 赞同：13
> 
> 时间：2009-04-08T22:59:51.217

C# 范围为 2^32 - 1 个数字，除 (Int32.MinValue) 之外的所有 int32 数字

```
 Func<int, int> f = n =>
        n < 0
           ? (n & (1 << 30)) == (1 << 30) ? (n ^ (1 << 30)) : - (n | (1 << 30))
           : (n & (1 << 30)) == (1 << 30) ? -(n ^ (1 << 30)) : (n | (1 << 30));

    Console.WriteLine(f(f(Int32.MinValue + 1))); // -2147483648 + 1
    for (int i = -3; i <= 3  ; i++)
        Console.WriteLine(f(f(i)));
    Console.WriteLine(f(f(Int32.MaxValue))); // 2147483647 
```

印刷：

```
2147483647
3
2
1
0
-1
-2
-3
-2147483647 
```

* * *

## 回答 #23

> 赞同：12
> 
> 时间：2009-04-08T23:45:55.007

本质上，该函数必须将可用范围划分为大小为 4 的循环，其中 -n 在 n 循环的另一端。但是，0 必须是大小为 1 的循环的一部分，否则`0->x->0->x != -x`. 因为 0 是单独的，所以在我们的范围内必须有 3 个其他值（其大小是 4 的倍数），而不是在具有 4 个元素的正确循环中。

我选择了这些额外奇怪的值是`MIN_INT`,`MAX_INT`和`MIN_INT+1`。此外，`MIN_INT+1`将映射到`MAX_INT`正确，但卡在那里而不是映射回来。我认为这是最好的折衷方案，因为它具有只有极值不能正常工作的优良特性。此外，这意味着它适用于*所有*BigInts。

```
int f(int n):
    if n == 0 or n == MIN_INT or n == MAX_INT: return n
    return ((Math.abs(n) mod 2) * 2 - 1) * n + Math.sign(n) 
```

* * *

## 回答 #24

> 赞同：12
> 
> 时间：2009-04-12T16:51:30.543

没有人说它必须是无国籍的。

```
int32 f(int32 x) {
    static bool idempotent = false;
    if (!idempotent) {
        idempotent = true;
        return -x;
    } else {
        return x;
    }
} 
```

作弊，但没有很多例子那么多。更邪恶的是查看堆栈以查看调用者的地址是否为 &f，但这将更便于移植（虽然不是线程安全的......线程安全版本将使用 TLS）。更邪恶的：

```
int32 f (int32 x) {
    static int32 answer = -x;
    return answer;
} 
```

当然，对于 MIN_INT32 的情况，这些都不是很好，但是除非允许您返回更广泛的类型，否则您对此无能为力。

* * *

## 回答 #25

> 赞同：11
> 
> 时间：2009-04-08T21:10:17.453

我可以想象将第 31 位用作虚构 ( *i* ) 位将是一种支持一半总范围的方法。

* * *

## 回答 #26

> 赞同：10
> 
> 时间：2009-04-08T21:13:49.443

适用于 n= [0 .. 2^31-1]

```
int f(int n) {
  if (n & (1 << 31)) // highest bit set?
    return -(n & ~(1 << 31)); // return negative of original n
  else
    return n | (1 << 31); // return n with highest bit set
} 
```

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2009-05-11T17:08:26.630

问题说明“32 位有符号整数”，但没有指定它们是[二进制补码](http://en.wikipedia.org/wiki/Two%27s_complement)还是二进制补[码](http://en.wikipedia.org/wiki/Ones%27_complement#Ones.27_complement)。

如果您使用补码，则所有 2^32 值都出现在长度为 4 的循环中 - 您不需要零的特殊情况，也不需要条件。

在 C 中：

```
int32_t f(int32_t x)
{
  return (((x & 0xFFFFU) << 16) | ((x & 0xFFFF0000U) >> 16)) ^ 0xFFFFU;
} 
```

这通过

1.  交换高低 16 位块
2.  反转块之一

经过两遍之后，我们得到了原始值的按位倒数。其中一个补码表示相当于否定。

例子：

```
Pass |        x
-----+-------------------
   0 | 00000001      (+1)
   1 | 0001FFFF (+131071)
   2 | FFFFFFFE      (-1)
   3 | FFFE0000 (-131071)
   4 | 00000001      (+1)

Pass |        x
-----+-------------------
   0 | 00000000      (+0)
   1 | 0000FFFF  (+65535)
   2 | FFFFFFFF      (-0)
   3 | FFFF0000  (-65535)
   4 | 00000000      (+0) 
```

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2009-04-08T23:12:29.967

:D

```
boolean inner = true;

int f(int input) {
   if(inner) {
      inner = false;
      return input;
   } else {
      inner = true;
      return -input;
   }
} 
```

* * *

## 回答 #29

> 赞同：9
> 
> 时间：2009-04-09T18:33:19.293

```
return x ^ ((x%2) ? 1 : -INT_MAX); 
```

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2009-04-20T14:02:09.397

作为一名数学家，我想分享我对这个有趣问题的看法。我认为我有最有效的解决方案。

如果我没记错的话，您只需翻转第一位即可否定有符号的 32 位整数。例如，如果 n = 1001 1101 1110 1011 1110 0000 1110 1010，则 -n = 0001 1101 1110 1011 1110 0000 1110 1010。

那么我们如何定义一个函数 f ，它接受一个有符号的 32 位整数并返回另一个有符号的 32 位整数，其属性是两次取 f 与翻转第一位相同？

让我在不提及整数等算术概念的情况下重新表述这个问题。

我们如何定义一个函数 f ，它接受一个长度为 32 的零和一个序列并返回一个长度相同的零和一个序列，并具有两次取 f 与翻转第一位相同的属性？

观察：如果你能回答上述问题的32位情况，那么你也可以回答64位情况，100位情况等。你只需将f应用于前32位。

现在，如果您可以回答 2 位案例的问题，瞧！

是的，事实证明，改变前 2 位就足够了。

这是伪代码

```
1\. take n, which is a signed 32-bit integer.
2\. swap the first bit and the second bit.
3\. flip the first bit.
4\. return the result. 
```

备注：步骤 2 和步骤 3 一起可以总结为 (a,b) --> (-b, a)。看起来很熟悉？这应该让你想起平面的 90 度旋转和乘以 -1 的平方根。

如果我只是单独提出伪代码，没有冗长的前奏，那看起来就像一只脱了帽子的兔子，我想解释一下我是如何得到解决方案的。

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2009-04-09T02:06:03.187

在 PHP 中

```
function f($n) {
    if(is_int($n)) {
        return (string)$n;
    }
    else {
        return (int)$n * (-1);
    }
}
```

我相信您可以理解其他语言的这种方法的精神。我明确地将其转换回 int 以使不使用弱类型语言的人更清楚。对于某些语言，您必须重载该函数。

这个解决方案的巧妙之处在于，无论您以字符串还是整数开头，它都可以工作，并且在返回 f(n) 时不会明显改变任何内容。

在我看来，面试官会问，“这个候选人是否知道如何标记数据以供以后操作”，以及“这个候选人是否知道如何标记数据，同时最少改变它？” 您可以使用双精度、字符串或任何其他您喜欢转换的数据类型来执行此操作。

* * *

## 回答 #32

> 赞同：6
> 
> 时间：2011-01-06T21:57:28.663

这很容易！

## 每个数字都以 4 个周期映射到另一个数字，其中所需的条件成立。

例子：

规则是：

*   0 → 0

*   ±2³¹ → ±2³¹

*   奇数→偶数，偶数→-奇数：

    对于所有 k, 0 < k < 2³⁰: (2k-1) → (2k) → (-2k+1) → (-2k) → (2k-1)

唯一不匹配的值是 ±(2³¹-1)，因为只有两个。**必须有两个无法匹配**，因为**在二进制补码系统**中只有四的倍数，其中 0 和 ±2³¹ 已被保留。

在一个补码系统中，存在+0和-0。我们去：

对于所有 k, 0 < k < 2³⁰: (+2k) → (+2k+1) → (-2k) → (-2k-1) → (+2k)

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2009-11-26T14:25:49.297

我有另一个解决方案在一半的时间内有效：

```
def f(x):
    if random.randrange(0, 2):
        return -x
    return x 
```

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2013-06-25T16:25:22.230

简单的 Python 解决方案之所以成为可能，是因为对 f(x) 应该输出的内容没有限制，只有 f(f(x))：

```
def f(x):
    return (isinstance(x, tuple) and -x[0]) or (x,) 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2009-05-30T14:56:55.620

```
int f( int n ){
    return n==0?0:(n&1?n:-n)+(n<0?-1:1);
} 
```

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2009-05-30T15:27:23.330

我的给出了正确的答案......50％的时间，*所有的时间*。

```
int f (int num) {
    if (rand () / (double) RAND_MAX > 0.5)
         return ~num + 1;
    return num;
} 
```

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2009-08-22T01:21:44.913

这个怎么样？

```
int nasty(int input)
{
    return input + INT_MAX/2;
} 
```

* * *

## 回答 #38

> 赞同：3
> 
> 时间：2009-08-26T21:39:52.850

虽然问题说 n 必须是 32 位 int，但它没有说参数或返回类型必须是 32 位 int。这应该在 java 中编译——在 c 中你可以去掉 != 0

```
private final long MAGIC_BIT=1<<38;
long f(long n) {
    return n & MAGIC_BIT != 0 ? -(n & !MAGIC_BIT) : n | MAGIC_BIT;
} 
```

编辑：

这实际上是一个非常好的面试问题。最好的是那些难以或不可能回答的问题，因为它迫使人们仔细思考，您可以观察并寻找：

*   他们只是放弃吗？
*   他们说这很愚蠢吗？
*   他们是否尝试独特的方法？
*   他们在解决问题时是否与您沟通？
*   他们是否要求进一步细化要求？

等等

除非你有一个非常好的答案，否则永远不要只回答行为问题。始终保持愉快并尝试让提问者参与进来。不要沮丧，不要早早放弃！如果你真的一无所获，尝试一些完全非法的可行的方法，你将获得几乎全部的功劳。

* * *

## 回答 #39

> 赞同：3
> 
> 时间：2009-12-14T00:03:17.667

这也是一个解决方案（但我们稍微改变了规则）：

```
def f(n):
    if isinstance(n,int):
        return str(n)
    else:
        return -int(n) 
```

* * *

## 回答 #40

> 赞同：3
> 
> 时间：2010-12-06T22:41:47.377

我认为这些问题的答案最好用图表来直观地解释。当我们忽略零时，我们可以将整数划分为 4 个数字的小集合：

```
 1  → 2    3  → 4    5  → 6
 ↑    ↓    ↑    ↓    ↑    ↓   ...
-2 ← -1   -4 ← -3   -6 ← -5 
```

这很容易翻译成代码。请注意，偶数改变符号，奇数增加或减少 1。在 C# 中，它看起来像这样：

```
public static int f(int x)
{
    if(x == 0)
        return 0;

    if(x > 0)
        return (x % 2 == 0) ? -x+1 : x+1;

    // we know x is negative at this point
    return (x % 2 == 0) ? -x-1 : x-1;
} 
```

当然，您可以使用巧妙的技巧来缩短此方法，但我认为这段代码最能说明问题。

然后关于范围。32 位整数的范围从 -2^31 到 2^31-1。数字 2^31-1、-2^31-1 和 -2^31 不在 f(x) 的范围内，因为缺少数字 2^31。

* * *

## 回答 #41

> 赞同：3
> 
> 时间：2010-12-07T21:06:22.297

1.  将 n 转换为符号和大小表示；
2.  添加范围的 1/4；
3.  转换回来。

```
 #define STYPE int
    STYPE sign_bit = (unsigned STYPE) 1 << ( sizeof ( STYPE ) * 8  - 1 );
    STYPE f ( STYPE f )
    {
        unsigned STYPE smf = f > 0 ? f : -f | sign_bit;
        smf += sign_bit >> 1;
        return smf & sign_bit ? -( smf & ~sign_bit ) : smf;
    } 
```

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2013-06-25T08:13:02.543

使用问题中提供的信息，您可以

1.  从 2 补码转换为符号位表示
2.  如果设置了最后一位，则翻转符号位和最后一位；否则，只翻转最后一位
3.  转换回 2 补码。

因此，您基本上是奇数->偶数->奇数或偶数->奇数->偶数，并且仅更改偶数的符号。唯一不起作用的数字是 -2^31

代码：

```
function f(x) {
  var neg = x < 0;
  x = Math.abs(x) ^ 1;
  if (x & 1) {
    neg = !neg;
  }
  return neg ? -x : x;
} 
```

* * *

## 回答 #43

> 赞同：2
> 
> 时间：2009-04-08T21:43:40.697

```
f(n) { return -1 * abs(n) } 
```

我该如何处理这个溢出问题？还是我错过了重点？

* * *

## 回答 #44

> 赞同：2
> 
> 时间：2009-04-09T00:02:49.083

在 Scala 中使用隐式转换的一个奇怪且稍微聪明的解决方案：

```
sealed trait IntWrapper {
  val n: Int
}

case class First(n: Int) extends IntWrapper
case class Second(n: Int) extends IntWrapper
case class Last(n: Int) extends IntWrapper

implicit def int2wrapper(n: Int) = First(n)
implicit def wrapper2int(w: IntWrapper) = w.n

def f(n: IntWrapper) = n match {
  case First(x) => Second(x)
  case Second(x) => Last(-x)
} 
```

我不认为这是完全正确的想法。

* * *

## 回答 #45

> 赞同：2
> 
> 时间：2009-04-11T04:15:41.617

Clojure 解决方案：

```
（定义宏 f [n]
  （如果（列表？n）`（-〜n）n））
```

也适用于任何大小、双倍和比率的正整数和负整数！

* * *

## 回答 #46

> 赞同：2
> 
> 时间：2010-06-27T06:33:03.023

卢阿：

```
function f(n)
    if type(n) == "number" then
        return (-number) .. ""
    else
        return number + 0
    end
end 
```

* * *

## 回答 #47

> 赞同：2
> 
> 时间：2013-06-25T06:17:44.483

在咖啡脚本中打高尔夫球：

```
f = (n)-> -n[0] or [n] 
```

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2013-06-25T21:09:48.973

这是一个**简短的 Python 答案**：

```
def f(n):
  m = -n if n % 2 == 0 else n
  return m + sign(n) 
```

**一般情况**

对上述内容稍作调整可以处理我们希望`k`自调用否定输入的情况——例如，如果`k = 3`，这将意味着`g(g(g(n))) = -n`：

```
def g(n):
  if n % k: return n + sign(n)
  return -n + (k - 1) * sign(n) 
```

这通过将 0 留在原处并创建长度为 2 * k 的循环来工作，以便在任何循环内，n 和 -n 的距离为 k。具体来说，每个周期看起来像：

```
N * k + 1, N * k + 2, ... , N * k + (k - 1), - N * k - 1, ... , - N * k - (k - 1) 
```

或者，为了更容易理解，这里是示例循环`k = 3`：

```
1, 2, 3, -1, -2, -3
4, 5, 6, -4, -5, -6 
```

这组循环最大化了可以在以零为中心的任何机器类型中工作的输入范围，例如有符号 int32 或有符号 int64 类型。

**兼容范围分析**

`x -> f(x)`实际上，映射必须形成长度循环`2 * k`，其中`x = 0`是一个特殊情况 1 长度循环，因为 -0 = 0。因此，`k`当且仅当输入的范围 - 1（补偿 0）为2 * k 的倍数，正负范围相反。

对于有符号整数表示，我们总是有一个最小的负数，在该范围内没有正对应物，因此问题在整个范围内变得无法解决。例如，a 的`signed char`范围为 [-128, 127]，因此不可能`f(f(-128)) = 128`在给定范围内。

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2009-04-08T21:32:25.293

不会在 MIN_INT 上失败：

```
int f(n) { return n < 0 ? -abs(n + 1) : -(abs(n) + 1); } 
```

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2009-04-08T22:38:12.267

如上所述的问题并不要求该函数必须只接受 32 位整数，只有给定的 n 是一个 32 位整数。

红宝石：

```
def f( n )
  return 0 unless n != 0 
  ( n == n.to_i ) ? 1.0 / n : -(n**-1).to_i
end 
```

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2009-04-08T22:51:14.793

这将适用于非常广泛的数字：

```
 static int f(int n)
    {
        int lastBit = int.MaxValue;
        lastBit++;
        int secondLastBit = lastBit >> 1;
        int tuple = lastBit | secondLastBit;
        if ((n & tuple) == tuple)
            return n + lastBit;
        if ((n & tuple) == 0)
            return n + lastBit;
        return -(n + lastBit);
    } 
```

我最初的方法是使用最后一位作为检查位，以了解我们在第一次或第二次通话中的位置。基本上，我会在第一次调用后将此位设置为 1，以表示第一次调用已经通过。但是，这种方法被负数打败了，负数在第一次调用期间最后一位已经到达 1。

对于大多数负数，相同的理论适用于倒数第二位。但是，通常发生的情况是，大多数情况下，最后一位和倒数第二位是相同的。对于负数，它们要么都是 1，要么对于正数，它们都是 0。

所以我最后的方法是检查它们是否都是 1 或都是 0，这意味着对于大多数情况这是第一次调用。如果最后一位与倒数第二位不同，那么我假设我们在第二次通话中，只需重新反转最后一位。显然，这不适用于使用最后两位的非常大的数字。但是，再一次，它适用于非常广泛的数字。

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2009-04-09T09:01:04.077

似乎很容易。

```
<script type="text/javascript">
function f(n){
    if (typeof n === "string") {
        return parseInt(n, 10)
    }
    return (-n).toString(10);
}

alert(f(f(1)));
</script> 
```

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2009-04-11T03:04:40.303

也许作弊？（Python）

```
def f(n):    
    if isinstance(n, list):
        return -n[0]
    else:
        return [n,0]    
n = 4
print f(f(n))

--output--
-4 
```

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2009-04-11T03:57:28.460

简单的：

```
function f($n) {
   if ($n%2 == 0) return ($n+1)*-1;
   else return ($n-1);
} 
```

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2009-04-13T01:30:51.370

在 C 中，

```
int 
f(int n) {
     static int r = 0;
     if (r == 1) {r--; return -1 * n; };
     r++;
     return n;
} 
```

知道这是什么语言会有所帮助。我错过了什么吗？许多“解决方案”似乎过于复杂，而且坦率地说，不起作用（当我阅读问题时）。

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2009-04-15T07:04:06.887

*这是rossfabricant*答案的 C 实现。请注意，由于我始终坚持使用 32 位整数，因此 f( f( 2147483647 ) ) == 2147483647，**而不是**-2147483647。

```
int32_t f( int32_t n )
{
    if( n == 0 ) return 0;
    switch( n & 0x80000001 ) {
        case 0x00000000:
            return -1 * ( n - 1 );
        case 0x00000001:
            return n + 1;
        case 0x80000000:
            return -1 * ( n + 1 );
        default:
            return n - 1;
    }
} 
```

如果您将问题定义为允许 f() 接受并返回 int64_t，则涵盖 2147483647。当然，switch 语句中使用的文字必须更改。

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2009-04-15T07:40:09.453

这个怎么样（C语言）：

```
int f(int n)
{
    static int t = 1;
    return (t = t ? 0 : 1) ? -n : n;
} 
```

刚试了一下，然后

```
f(f(1000)) 
```

返回 -1000

```
f(f(-1000)) 
```

返回 1000

这是正确的还是我错过了重点？

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2009-04-17T06:04:54.203

确实，这些问题更多是关于看到面试官与规范、设计、错误处理、边界案例以及为解决方案选择合适的环境等问题搏斗，而不是关于实际解决方案。然而： ：）

这里的函数是围绕封闭的 4 循环思想编写的。如果函数 f 只允许落在有符号的 32 位整数上，那么除了其他人指出的三个输入范围数字之外，上述各种解决方案都将起作用。minint 永远不会满足函数方程，因此如果这是输入，我们将引发异常。

在这里，我允许我的 Python 函数操作并返回*元*组*或*整数。任务规范承认这一点，它只指定函数的两个应用程序应该返回一个等于原始对象的对象，如果它是一个 int32。（我会询问有关规范的更多详细信息。）

 *这使我的轨道很好且对称，并覆盖了所有输入整数（minint 除外）。我最初设想循环访问半整数值，但我不想纠结于舍入错误。因此元组表示。这是一种在不使用复杂算术机器的情况下将复杂的旋转作为元组偷偷摸摸的方法。

请注意，调用之间不需要保留任何状态，但调用者确实需要允许返回值是元组或 int。

```
def f(x) :
  if isinstance(x, tuple) :
      # return a number.
      if x[0] != 0 :
        raise ValueError  # make sure the tuple is well formed.
      else :
        return ( -x[1] )

  elif isinstance(x, int ) :
    if x == int(-2**31 ):
      # This value won't satisfy the functional relation in
      # signed 2s complement 32 bit integers.
      raise ValueError
    else :
      # send this integer to a tuple (representing ix)
      return( (0,x) )
  else :
    # not an int or a tuple
    raise TypeError 
```

因此将 f 应用于 37 两次得到 -37，反之亦然：

```
>>> x = 37
>>> x = f(x)
>>> x
(0, 37)
>>> x = f(x)
>>> x
-37
>>> x = f(x)
>>> x
(0, -37)
>>> x = f(x)
>>> x
37 
```

将 f 两次应用于零得到零：

```
>>> x=0
>>> x = f(x)
>>> x
(0, 0)
>>> x = f(x)
>>> x
0 
```

我们处理一个问题没有解决方案的情况（在 int32 中）：

```
>>> x = int( -2**31 )
>>> x = f(x)

Traceback (most recent call last):
  File "<pyshell#110>", line 1, in <module>
    x = f(x)
  File "<pyshell#33>", line 13, in f
    raise ValueError
ValueError 
```

如果您认为该函数通过模仿乘以 i 的 90 度旋转来打破“无复杂算术”规则，我们可以通过扭曲旋转来改变它。这里元组代表半整数，而不是复数。如果你在数轴上追踪轨道，你会得到满足给定函数关系的非相交环。

```
f2: n -> (2 abs(n) +1, 2 sign( n) ) if n is int32, and not minint.
f2: (x, y) -> sign(y) * (x-1) /2  (provided y is \pm 2 and x is not more than 2maxint+1 
```

练习：通过修改 f 来实现这个 f2。还有其他解决方案，例如让中间着陆点为半整数以外的有理数。有一个分数模块可能会被证明是有用的。你需要一个签名功能。

这个练习让我真正体会到了动态类型语言的乐趣。我在 C 中看不到这样的解决方案。

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2009-05-05T12:41:27.080

这是在 Python 中的。适用于 n 的所有负值：

```
f = abs 
```

* * *

## 回答 #60

> 赞同：1
> 
> 时间：2009-05-05T13:07:05.257

这是我没有看到人们使用的变体。由于这是 ruby​​，32 位整数的东西有点出乎意料（当然可以添加检查）。

```
def f(n)
    case n
    when Integer
        proc { n * -1 }
    when Proc
        n.call
    else
        raise "Invalid input #{n.class} #{n.inspect}"
    end
end

(-10..10).each { |num|
    puts "#{num}: #{f(f(num))}"
} 
```

* * *

## 回答 #61

> 赞同：1
> 
> 时间：2009-05-11T15:45:28.357

创建许多解决方案的一种方法是注意，如果我们将整数划分为两个集合 S 和 R st -S=S，-R=R，并且函数 g st g(R) = S

然后我们可以创建 f 如下：

如果 x 在 R 中，则 f(x) = g(x)

如果 x 在 S 中，则 f(x) = -invg(x)

其中 invg(g(x))=x 所以 invg 是 g 的反函数。

上面提到的第一个解决方案是分区R=偶数，R=奇数，g(x)=x+1。

我们可以取任意两个无限集合 T,P st T+U= 整数集合，并取 S=T+(-T), R=U+(-U)。

然后 -S=S 和 -R=R 根据它们的定义，我们可以将 g 视为从 S 到 R 的任何 1-1 对应关系，因为这两个集合都是无限且可数的，所以它必须存在。

因此，这将为我们提供许多解决方案，但当然并非所有解决方案都可以编程，因为它们不会被有限定义。

一个可能的例子是：

R= 能被 3 整除的数，S= 不能被 3 整除的数。

然后我们取 g(6r) = 3r+1, g(6r+3) = 3r+2。

* * *

## 回答 #62

> 赞同：1
> 
> 时间：2009-05-11T16:25:51.817

很简单，只需`f`返回看起来等于*任何*整数的东西，并且可以从整数转换。

```
public class Agreeable
{
    public static bool operator==(Agreeable c, int n)
        { return true; }

    public static bool operator!=(Agreeable c, int n)
        { return false; }

    public static implicit operator Agreeable(int n)
        { return new Agreeable(); }
}

class Program
{
    public static Agreeable f(Agreeable c)
        { return c; }

    static void Main(string[] args)
    {
        Debug.Assert(f(f(0)) == 0);
        Debug.Assert(f(f(5)) == -5);
        Debug.Assert(f(f(-5)) == 5);
        Debug.Assert(f(f(int.MaxValue)) == -int.MaxValue);
    }
} 
```

* * *

## 回答 #63

> 赞同：1
> 
> 时间：2009-05-25T12:05:12.363

```
const unsigned long Magic = 0x8000000;

unsigned long f(unsigned long n)
{    
    if(n > Magic )
    {
        return Magic - n;
    }

    return n + Magic;
} 
```

0~2^31

* * *

## 回答 #64

> 赞同：1
> 
> 时间：2009-05-25T13:07:28.447

```
int j = 0;

void int f(int n)
{    
    j++;

    if(j==2)
    {
       j = 0;
       return -n;
    }

    return n;
} 
```

:D

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2009-05-25T13:43:23.460

以下情况如何：

```
int f (int n)
{
    static bool pass = false;
    pass = !pass;
    return pass? n : -n;
} 
```

* * *

## 回答 #66

> 赞同：1
> 
> 时间：2009-05-30T15:29:33.590

这适用于 -1073741823 到 1073741822 的范围：

```
int F(int n)
{
    if(n < 0)
    {
        if(n > -1073741824)
            n = -1073741824 + n;
        else n = -(n + 1073741824);
    }
    else
    {
        if(n < 1073741823)
            n = 1073741823 + n;
        else n = -(n - 1073741823);
    }
    return n;
} 
```

它的工作原理是将 32 位有符号整数的可用范围一分为二。该函数的第一次迭代将**n**本身置于该范围之外。第二次迭代检查它是否在此范围之外 - 如果是，则将其放回范围内但使其为负。

它实际上是一种保留有关值 n 的额外“位”信息的方法。

* * *

## 回答 #67

> 赞同：1
> 
> 时间：2009-05-31T15:26:38.973

```
void f(int x)
{
     Console.WriteLine(string.Format("f(f({0})) == -{0}",x));
} 
```

对不起，伙计们……这太诱人了；）

* * *

## 回答 #68

> 赞同：1
> 
> 时间：2009-06-01T08:29:37.437

C++ 解决方案；

```
long long f(int n){return static_cast <long long> (n);}
int f(long long n){return -static_cast <int> (n);}

int n = 777;
assert(f(f(n)) == -n); 
```

* * *

## 回答 #69

> 赞同：1
> 
> 时间：2009-06-03T20:57:47.730

另一个作弊解决方案。我们使用一种允许运算符重载的语言。然后我们让 f(x) 返回一些已经重载`==`的东西，总是返回 true。这似乎与问题描述相符，但显然与谜题的精神背道而驰。

红宝石示例：

```
class Cheat
  def ==(n)
     true
  end
end

def f(n)
  Cheat.new
end 
```

这给了我们：

```
>> f(f(1)) == -1
=> true 
```

但也（不太令人惊讶）

```
>> f(f(1)) == "hello world"
=> true 
```

* * *

## 回答 #70

> 赞同：1
> 
> 时间：2009-06-03T21:27:29.340

```
int f(const int n)  {
    static int last_n;

    if (n == 0)
        return 0;
    else if (n == last_n)
        return -n;
    else
    {
        last_n = n;
        return n;
    }
} 
```

骇人听闻，但正确。

* * *

## 回答 #71

> 赞同：1
> 
> 时间：2009-07-14T22:10:59.893

有些是相似的，但只是想我会写下我的第一个想法（在 C++ 中）

```
#include <vector>

vector<int>* f(int n)
{
  returnVector = new vector<int>();
  returnVector->push_back(n);
  return returnVector;
}

int f(vector<int>* n) { return -(n->at(0)); } 
```

只是使用重载导致 f(f(n)) 实际调用两个不同的函数

* * *

## 回答 #72

> 赞同：1
> 
> 时间：2009-07-19T02:54:21.837

JavaScript 单行：

```
function f(n) { return ((f.f = !f.f) * 2 - 1) * n; } 
```

* * *

## 回答 #73

> 赞同：1
> 
> 时间：2009-08-11T22:46:37.490

另一种方法是将状态保持在一个位并在负数的情况下小心翻转它的二进制表示......限制是2 ^ 29

诠释ffn（诠释n）{

```
 n = n ^ (1 << 30); //flip the bit
    if (n>0)// if negative then there's a two's complement
    {
        if (n & (1<<30))
        {
            return n;
        }
        else
        {
            return -n;
        }
    }
    else
    {
        if (n & (1<<30))
        {
            return -n;
        }
        else
        {
            return n;
        }
    }

} 
```

* * *

## 回答 #74

> 赞同：1
> 
> 时间：2009-08-24T10:03:32.873

```
number f( number n)
{
  static count(0);
  if(count > 0) return -n;
  return n;
}

f(n) = n

f(f(n)) = f(n) = -n 
```

* * *

## 回答 #75

> 赞同：1
> 
> 时间：2009-08-25T19:05:18.683

```
int f(int n) {
    return ((n>0)? -1 : 1) * abs(n);
} 
```

* * *

## 回答 #76

> 赞同：1
> 
> 时间：2009-09-26T01:52:09.967

这个怎么样：

```
do
    local function makeFunc()
        local var
        return function(x)
            if x == true then
                return -var
            else
                var = x
                return true
            end
        end

    end
    f = makeFunc()
end
print(f(f(20000))) 
```

* * *

## 回答 #77

> 赞同：1
> 
> 时间：2009-10-16T11:30:44.743

```
f(n) { return IsWholeNumber(n)? 1/n : -1/n } 
```

* * *

## 回答 #78

> 赞同：1
> 
> 时间：2009-11-07T01:49:52.040

C++

```
struct Value
{
  int value;
  Value(int v) : value(v) {}
  operator int () { return -value; }
};

Value f(Value input)
{
  return input;
} 
```

* * *

## 回答 #79

> 赞同：1
> 
> 时间：2009-11-23T16:15:39.123

类似于函数重载解决方案，在python中：

```
def f(number):
 if type(number) != type([]):
  return [].append(number)
 else:
  return -1*number[0] 
```

选择：`static datamembers`

* * *

## 回答 #80

> 赞同：1
> 
> 时间：2009-11-23T16:41:25.623

蟒蛇2.6：

```
f = lambda n: (n % 2 * n or -n) + (n > 0) - (n < 0) 
```

我意识到这对讨论没有任何帮助，但我无法抗拒。

* * *

## 回答 #81

> 赞同：1
> 
> 时间：2010-02-15T02:43:35.320

```
整数 f(整数 n)
{
   静态 int x = 0;
   结果 = -x;
   x = n;
   返回结果；
}

```

这是一个带否定的单项 FIFO。当然，它不适用于最大负数。

* * *

## 回答 #82

> 赞同：1
> 
> 时间：2010-03-18T22:34:37.993

在 Python 中

```
f=lambda n:n[0]if type(n)is list else[-n] 
```

* * *

## 回答 #83

> 赞同：1
> 
> 时间：2010-03-18T23:31:15.060

好问题！

这花了我大约 35 秒的时间来思考和写下：

```
int f(int n){
    static int originalN=0;
    if (n!=0)
        originalN=n;
    return n-originalN;
} 
```

* * *

## 回答 #84

> 赞同：1
> 
> 时间：2010-04-26T15:29:00.737

斯卡拉：

```
def f(x: Any): Any = x match {
  case i: Int => new { override def hashCode = -i }
  case i @ _  => i.hashCode
} 
```

Java中的同样的事情：

```
public static Object f(final Object x) {
  if(x instanceof Integer) {
    return new Object() {
      @Override 
      public int hashCode() {
        return -(Integer)x;
      }
    };
  }
  return x.hashCode();
} 
```

* * *

## 回答 #85

> 赞同：1
> 
> 时间：2010-04-27T02:43:35.420

另一种利用短路的 Javascript 解决方案。

```
​function f(n) {return n.inv || {inv:-n}}

f(f(1)) => -1
f(f(-1)) => 1 
```

* * *

## 回答 #86

> 赞同：1
> 
> 时间：2010-06-09T05:09:01.087

以为我会在不先查看其他人的答案的情况下尝试这个：

```
#include <stdio.h>
#include <limits.h>
#include <stdlib.h>

int f(int n) {
    如果（n > 0）{  
        如果（n % 2）
            返回-(++n);
        别的 {
            返回（--n）；

        }
    }
    别的 {
        如果（n % 2）
            返回-(--n);
        别的 {
            返回 (++n);

        }
    }
}

int main(int argc, char* argv[]) {
    诠释n;
    对于（n = INT_MIN；n < INT_MAX；n++）{
        int N = f(f(n));

        如果（N！= -n）{
            fprintf(stderr, "失败！%i != %i\n", N, -n);
        }
    }
    n = INT_MAX；
    int N = f(f(n));
    如果（N！= -n）{
        fprintf(stderr, "失败！n = %i\n", n);
    }
    返回0；
}

```

输出：[无]

* * *

## 回答 #87

> 赞同：1
> 
> 时间：2011-11-05T02:48:06.853

交流功能：

```
int f(int n) /* Treats numbers in the range 0XC0000000 to 0X3FFFFFFF as valid to
                generate f(f(x)) equal to -x. If n is within this range, it will
                project n outside the range. If n is outside the range, it will
                return the opposite of the number whose image is n. */
{
    return n ? n > 0 ? n <= 0X3FFFFFFF ? 0X3FFFFFFF + n : 0X3FFFFFFF - n :\
           n >= 0XC0000000 ? 0XC0000000 + n : 0XC0000000 - n : 0;
} 
```

### [用于测试和下载的 Ideone 链接](http://www.ideone.com/Cl2rh)

* * *

## 回答 #88

> 赞同：1
> 
> 时间：2013-04-06T02:40:06.813

好吧，我既不是数学，也不是编程专家，但这不是很容易吗？

```
int f(int i) {
    static bool b;
    if (b) {
        b = !b;
        return i;
    } else {
        b = !b;
        return -i;
    }
} 
```

用大大小小的正负值，INT_MIN，INT_MAX 进行测试，它似乎工作......如果这是一个问题，可以使线程安全，但它不是任务的一部分。

或者，也许我错过了什么？

* * *

## 回答 #89

> 赞同：0
> 
> 时间：2009-07-30T09:19:20.560

```
int f(int n)
{
  static long counter=0;
  counter++;
  if(counter%2==0)
    return -n;
  else
    return n;
} 
```

* * *

## 回答 #90

> 赞同：0
> 
> 时间：2010-03-18T23:05:52.573

我相信这符合所有要求。没有说参数必须是 32 位有符号整数，只是你传入的值 'n' 是。

```
long long f(long long n)
{
    int high_int = n >> 32;
    int low_int  = n & 0xFFFFFFFF;

    if (high_int == 0) {
        return 0x100000000LL + low_int;
    } else {
        return -low_int;
    }
} 
```

* * *

## 回答 #91

> 赞同：0
> 
> 时间：2010-04-26T15:53:34.663

C#重载：

```
string f(int i) {
  return i.ToString();
}

int f(string s) {
  return Int32.Parse(s) * -1;
} 
```

或者

```
object f(object o) {
  if (o.ToString.StartsWith("s"))
    return Int32.Parse(s.Substring(1)) * -1;
  return "s" + i.ToString();
} 
```

* * *

## 回答 #92

> 赞同：0
> 
> 时间：2010-04-28T17:48:06.627

Tcl：

```
proc f {input} {
    if { [string is integer $input] } {
      return [list expr [list 0 - $input]]
    } else {
      return [eval $input]
    }
}

% f [f 1]
-1 
```

沿着其他一些答案的思路......如果它是一个整数，则返回一个返回该数字的负数的命令。如果不是数字，则对其进行评估并返回结果。

* * *

## 回答 #93

> 赞同：0
> 
> 时间：2010-05-05T16:45:42.390

这是一个 C/C++ 解决方案，不使用任何位运算符，也不需要任何数学库，尽管它有点作弊......

```
double f(double n)
{
    if (n == (double)(int)n)
        return n + 0.5;
    else
        return -(n - 0.5);
} 
```

这适用于所有 32 位整数，唯一的例外是`0x80000000`（因为它的反面不能存储在 32 位整数系统中）。`f(f(n)) == -n`将永远是`true`除了在那种情况下。

不过，我确信有一种更简单、更快捷的方法来实现它。这只是浮现在脑海中的第一件事。

* * *

## 回答 #94

> 赞同：0
> 
> 时间：2010-10-27T10:43:39.510

```
int func(int a)  
{   
    static int p = 0;  
    int ret = a;  

    if ( p ) ret *= -1;  
    p ^= 1;  

    return ret;  
} 
```

* * *

## 回答 #95

> 赞同：0
> 
> 时间：2010-12-07T04:28:10.027

我不知道这是否完全正确，但是一个简单的标志不起作用吗？在 C 中，使用静态局部变量，我成功地做到了：

```
int main()
{
    int n = -256; // 32-bit signed integer
    printf("%d", f(f(n)));
}

int f(int n){
    static int x = 0; // not returning negative;
    switch(x){
        case 0:
            x = 1;
            return n;
            break;

        case 1:
            x = 0;
            return -n;
            break;
        default:
            return -999;
            break;
    }
} 
```

* * *

## 回答 #96

> 赞同：0
> 
> 时间：2010-12-21T11:43:05.407

```
#include <cmath>

int f(int n)
{
    static int count = 0;
    return ::cos(M_PI * count++) * n;
} 
```

* * *

## 回答 #97

> 赞同：0
> 
> 时间：2011-09-08T05:06:59.137

这个想法已在其他答案中使用，但我将其放入了一行 Python：

```
def f(n):
    return str(n) if type(n) == int else -int(n) 
```

* * *

## 回答 #98

> 赞同：0
> 
> 时间：2013-04-07T15:16:13.083

f# 中的一个简单解决方案（不使用“技巧”）

```
let rec f n =
    if n = 0 then 0
    elif n > 0 then
        if (f (n - 1) <> n) then n + 1
        else -(n - 1)
    else
        if (f (-(n - 1)) = n) then n - 1
        else -(n + 1) 
```

* * *

## 回答 #99

> 赞同：0
> 
> 时间：2013-04-20T19:59:16.687

SQL Server 中的解决方案

```
create function dbo.fn_fo(@num int) -- OUTER FUNCTION
RETURNS int
AS
begin
RETURN @num * -1
end
GO

create function dbo.fn_fi(@num int) -- INNER FUNCTION
RETURNS int
AS
begin
RETURN @num * -1
end
GO

declare @num AS int = -42
SELECT dbo.fn_fo(dbo.fn_fi(@num)) -- Gives (-42) 
```

* * *

## 回答 #100

> 赞同：0
> 
> 时间：2013-06-25T11:37:46.343

**也许我错过了什么？**

这不是简单的事情吗：

```
 function f(n)
    {
        if(n ==0 || n < 0){return n;}
        return n * -1;
    } 
```

**编辑：**

所以我错过了这个问题，哼哼，所以：

```
 function f(n)
    {
        if(!c(n,"z")&&!c(n,"n")){if(n==0){return "z"+n;}return "n"+n;}
        if( c(n,"z")){return 0;}return parseInt(n.replace("n",""))*-1;
    }
    function c(x,y){return x.indexOf(y) !==-1;} 
```

丑陋但有效。

* * *

## 回答 #101

> 赞同：0
> 
> 时间：2013-06-25T16:00:30.673

f(x) = 在二维笛卡尔坐标系中绕原点逆时针旋转 90 度的点 (x)。只有一个数 x 的输入被假定为 (x, 0)，并且 y=0 的输出被提供为单个数 x。

```
object f: (object) x {
    if (x.length == 1)
        x = (x, 0)
    swap = x[0]
    x[1] = x[0]
    x[0] = -swap
    if (x[1] == 0)
        x = x[0]
    return x 
```

* * *

## 回答 #102

> 赞同：0
> 
> 时间：2013-06-25T16:46:21.217

我承认我会作弊，但仍然符合要求。这是编程魔法，而不是真正的数学。它适用于整个范围，除了-2 ^ 31。

```
int f(int n)
{
    static bool eFlag = false; // Only executed once
    eFlag = !eFlag;
    return eFlag?-n:n;
} 
```

* * *

## 回答 #103

> 赞同：0
> 
> 时间：2013-06-25T19:14:47.887

C++ 中的另一个作弊解决方案，运算符重载。

```
struct func {
    int n;
    func operator()(int k) { n = -k; return *this; }
    int operator()(const func &inst) { return inst.n; }
} f; 
```

* * *

## 回答 #104

> 赞同：0
> 
> 时间：2014-07-14T00:11:48.170

**Objective-C**

这适用于除“-1”之外的所有数字。

如果你要从使用`int`到使用，`NSInt`那么你可以设置 -1 值`NULL`，然后第二次将它们转换为 +1，但我觉得这`NSInt`欺骗了提问者的意图。

* * *

f(n):

```
-(int)f:(int)n {
    if (abs(n)==1) {
        n = -1;
    } else {
        if (abs(n)%2) {//o
            if (n>0) {//+
                n--;
                n*=+1;
            } else if (n<0) {//-
                n++;
                n*=+1;
            }
        } else {//e
            if (n>0) {//+
                n++;
                n*=-1;
            } else if (n<0) {//-
                n--;
                n*=-1;
            }
        }
    }
    return n;
} 
```

当然，这都可以缩短到像一行，但其他人可能无法阅读......

无论如何，我将 BOOLEAN 逻辑存储在数字为奇数或偶数的状态下。

* * *

## 回答 #105

> 赞同：0
> 
> 时间：2014-07-22T17:49:27.997

### F＃

```
let f n =
    match n with
    | n when n % 2 = 0 -> -n + System.Math.Sign n
    | _ -> n - System.Math.Sign -n 
```

哪里`n`这样`System.Int32.MinValue < n < System.Int32.MaxValue`。

* * *

## 回答 #106

> 赞同：0
> 
> 时间：2014-09-08T00:20:05.107

我试着打*高尔夫罗德里克查普曼*的[这个答案](https://stackoverflow.com/a/3126784/155137)。

 *无分支：**74 个字符**

```
int f(int i){return(-((i&1)<<1)|1)*i-(-((i>>>31)<<1)|1)*(((i|-i)>>31)&1);} 
```

带分支，Java 风格：**58 个字符**

```
int f(int i){return i==0?0:(((i&1)==0?i:-i)+(i>0?-1:1));} 
```

带分支，C 风格：**52 个字符**

```
int f(int i){return i?(((i&1)?-i:i)+(i>0?-1:1)):0;} 
```

* * *

经过快速但有效的基准测试后，分支版本在我的机器上速度提高了 33%。（正数和负数的随机数据集，足够的重复并阻止编译器优化代码，并进行预热。）这并不奇怪，考虑到非分支版本中的操作数量和可能的良好分支预测，因为事实上该函数被调用两次：`f(f(i))`. 当我将基准更改为 measure:`f(i)`时，分支版本仅快 28%。我认为这证明了分支预测在第一种情况下确实做了一些好事。更多证明：使用 进行测试时`f(f(f(f(i))))`，分支版本的速度提高了 42%。

* * *

## 回答 #107

> 赞同：0
> 
> 时间：2014-09-08T12:22:40.010

[Wolfram 语言](http://www.wolfram.com/language/)中的解决方案：

```
f[f[n_]] := -n 
```

应用：

```
In[2]:= f[f[10]]                                                                                                                                                                                                                                                                              
Out[2]= -10
In[3]:= f[10]                                                                                                                                                                                                                                                                                 
Out[3]= f[10] 
```

因为问题没有说明 f(n) 的值，所以 f[n] 仍未计算。

* * *

## 回答 #108

> 赞同：0
> 
> 时间：2015-01-09T19:48:21.200

Javascript

```
function f(n)  { 
        return typeof n === "number" ? 
        function() {return -n} : 
        n();
} 
```

* * *

## 回答 #109

> 赞同：0
> 
> 时间：2015-02-27T02:17:05.333

根据微软/谷歌面试官在面试中通常会问的问题，我认为提问者的意思是一种创新的、轻量级的、简单的解决方案，将使用按位运算，而不是那些复杂的高级答案。

受@eipipuz 答案的启发，我编写了这个 C++ 函数（但没有运行它）：

```
int32_t f(int32_t n){
    int32_t temp = n & 00111111111111111111111111111111;
    x = n >> 30;
    x++;
    x = x << 30;
    return x | temp;
} 
```

*它将n*的最左边两位存储在*x*中，将 1 加到*x ，然后再次将其替换为**n*的最左边两位。

如果我们继续运行*f(n)*并将另一个*f(n)*作为参数*n*，最左边的两位将像这样旋转：

> 00 --> 01 --> 10 --> 11 --> 00 ...

请注意，最右边的 30 位不会改变。8 位整数的示例：

示例 1：

*   > f(00001111) = 01001111
*   > f(01001111) = 10001111 [这是原始值的负数，00001111]

示例 2：

*   > f(11101010) = 00101010
*   > f(00101010) = 01101010 [这是原始值的负数，11101010]

* * *

## 回答 #110

> 赞同：-1
> 
> 时间：2009-04-15T01:16:05.977

我认为*可能的最大范围*暗示了模块化算术解决方案。在一些模基 M 中，有一个数在平方时与 M-1 一致（与 -1 一致）。例如，如果 M=13, 5*5=25, 25 mod 13=12 (= -1)
无论如何这里有一些用于 M=2**32-3 的 python 代码。

```
def f(x):
    m=2**32-3;
    halfm=m//2;
    i_mod_m=1849436465
    if abs( x ) >halfm:
        raise "too big"
    if x<0:
        x+=m
    x=(i_mod_m*x) % m
    if (x>halfm):
        x-=m
    return x; 
```

请注意，有 3 个值不适用于 2 ** 31-1、-(2 ** 31-1) 和 -(2 ** 31)

* * *

## 回答 #111

> 赞同：-1
> 
> 时间：2009-04-23T06:15:08.917

```
int f(int x){
    if (x < 0)
        return x;
    return ~x+1; //two's complement
} 
```

* * *

## 回答 #112

> 赞同：-1
> 
> 时间：2009-05-31T15:06:53.770

PHP，不使用全局变量：

```
function f($num) {
  static $mem;

  $answer = $num-$mem;

  if ($mem == 0) {
    $mem = $num*2;
  } else {
    $mem = 0;
  }

  return $answer;
} 
```

适用于整数、浮点数和数字字符串！

*刚刚意识到这做了一些不必要的工作，但是，无论如何*

* * *

## 回答 #113

> 赞同：-1
> 
> 时间：2009-06-11T02:11:12.880

记住你最后的状态不是一个足够好的答案吗？

```
int f (int n)
{
    //if count 
    static int count = 0;

    if (count == 0)
        { 
            count = 1;
            return n;
        }

    if (n == 0)
        return 0;
    else if (n > 0)
    {
        count = 0;
        return abs(n)*(-1);
    } 
    else
    {
        count = 0;
        return abs(n);
    }
}

int main()
{
    int n = 42;
    std::cout << f(f(n))
} 
```

* * *

## 回答 #114

> 赞同：-1
> 
> 时间：2013-06-25T07:57:56.613

使用循环置换方法来做到这一点。

-bab -a

ab -a -b

在平凡的情况下 f(0) 返回 0

抱歉我的电话粗略回答，28 日之后我将发布一个完整版本（现在正在检查......）简要地说，认为 f(n) 是一个循环排列，问题是如何构造它。

定义 fk = f(f(f(f(...f(n))))) (k fs) 情况 k=2 0.琐碎情况 f(0) 返回 0 1\. 分组，情况 k=2 ，组：{0} {1,2} {3,4} ... {n,n+1 | (n+1)%2 = 0 }，注意：我只使用Z+，因为构造不需要使用负数。2.构造排列：如果n % 2 = 0，那么a=n-1 b=n 如果n % 2 = 1，那么a=nb=n+1

这将产生相同的排列，因为 n 和 f(n) 在同一组中。

注意排列为 P 返回 P(n)

对于 k=2t ，只做上面相同的事情，只是 MOD k。对于k=2t-1，虽然方法行得通，但是没有意义，啊？(f(n) = -n 没问题)

* * *

## 回答 #115

> 赞同：-1
> 
> 时间：2013-06-25T12:02:18.100

它通过保存状态来作弊，但它可以工作，将操作分成两部分： -n = (~n + 1) 用于整数

```
int f(int n) {
    static int a = 1;
    a = !a;
    if (a) {
        return (~n);
    } else {
        return (n+1);
    }
} 
```

* * *

## 回答 #116

> 赞同：-2
> 
> 时间：2009-07-29T15:25:42.250

我还没有看过其他答案，我假设已经彻底讨论了按位技术。

我以为我会在 C++ 中想出一些邪恶的东西，希望不是骗人的：

```
struct ImplicitlyConvertibleToInt
{
    operator int () const { return 0; }
};

int f(const ImplicitlyConvertibleToInt &) { return 0; }

ImplicitlyConvertibleToInt f(int & n)
{
    n = 0; // The problem specification didn't say n was const
    return ImplicitlyConvertibleToInt();
} 
```

整个`ImplicitlyConvertibleToInt`类型和重载是必要的，因为临时对象不能绑定到非常量引用。

当然，现在看`f(n)`之前是否执行是不确定的`-n`。

对于这种程度的邪恶，也许更好的解决方案很简单：

```
struct ComparesTrueToInt
{
    ComparesTrueToInt(int) { } // implicit construction from int
};
bool operator == (ComparesTrueToInt, int) const { return true; }

ComparesTrueToInt f(ComparesTrueToInt ct) { return ComparesTrueToInt(); } 
```

* * *

## 回答 #117

> 赞同：-2
> 
> 时间：2010-04-28T18:19:13.480

## 少于 50 个字符 (C#)

```
int f(int n) { return (n <= 0) ? n : f(-n); } 
```

### 或者更容易阅读：

```
static int f(int n) { 
  if (n <= 0)
    return n;
  else 
    return f(-n);
} 
```

### 去测试

```
static void Main(string[] args) {
    for (int n = int.MinValue; n < int.MaxValue; n+=1) {
        Console.Out.WriteLine("Value: " + n + " Result: " + f(f(n)));
    }
} 
```

它有效（假设我正确理解了这个问题）

* * *

## 回答 #118

> 赞同：-4
> 
> 时间：2009-04-09T16:46:53.807

怎么样

```
int f(int n)
{
    return -abs(n);
} 
```

# java - 使用 UUID 作为数据库主键，Java 类型是 byte[]

> ID：731840
> 
> 赞同：2
> 
> 时间：2009-04-08T21:05:29.743
> 
> 标签：java, sql, jpa, types, bytearray

在 JPA 实体中使用 byte[] 作为主键有什么问题吗？

我想使用 UUID 作为我的主键，但存储为字符串我觉得它太大了。

我正在考虑做这样的事情来将 ID 存储为 byte[] 并将其设置为我的实体 ID：

```
 public static byte[] byteArray(UUID uuid) {
        long lsb = uuid.getLeastSignificantBits();
        long msb = uuid.getMostSignificantBits();

        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        DataOutputStream dos = new DataOutputStream(bos);
        try {
            dos.writeLong(lsb);
            dos.writeLong(msb);
            dos.flush();
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }

        byte[] data = bos.toByteArray();
//      System.out.println("Byte Array Length "+data.length);
        return data;

    } 
```

我在数据库中放置索引会有什么问题吗？我同时使用 Postgres 和 HSQL。我使用 Hibernate 作为我的 JPA 提供程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T21:08:29.267

我认为除了主键大于通常的 4 字节 (int) 的主键会带来一点性能损失之外，这不会有任何问题。

为什么需要 UUID 作为主键？为什么不能只使用具有自动增量的代理整数键？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T12:39:15.360

请记住，使用 SQL 客户端的用户在查询 byte[] id 时会遇到问题。这就是为什么 db id 通常是数字的原因。手写查询要容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T13:46:16.883

我同意较早的一位受访者的观点，即在进行问题诊断时将键存储为字节会使手动查询变得非常困难。使用 char(x) 或 varchar(x) 字段不会占用更多空间，并且支持人员更容易阅读。

# database - 幂等 PostgreSQL DDL 脚本

> ID：731851
> 
> 赞同：15
> 
> 时间：2009-04-08T21:07:16.713
> 
> 标签：database, postgresql, plpgsql

我正在寻找一种以幂等方式编写 postgreSQL 模式更改脚本的方法。

在 MSSQL 中，我可以这样做：

```
if(not exists(select * from information_schema.columns where table_name = 'x' and column_name = 'y'))
begin
    alter table x add y int
end
go 
```

PostgreSQL 似乎不像 MSSQL 对 T-SQL 那样允许 ad-hoc pl/pgsql，所以我不能在 SQL 脚本中使用控制结构并使用 psql -f x.sql 运行它。

我知道如果对象已经存在，PostgreSQL 会抛出一个错误，但我不想忽略错误。

我可以使用一些模式版本控制技术，例如 dbdeploy，但我真的很喜欢通过 psql 运行一组文件而不会产生任何不需要的副作用的简单性。

这可能吗？

谢谢，马克

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2017-06-28T13:54:38.063

**免责声明：我知道，这是一个非常古老的问题，并且已经有一个公认的答案。**

但我想在这里注册一个完全幂等的脚本，没有外部链接。

* * *

演示 PostgreSQL 9.5+ 幂等内置功能的简单脚本。您可以根据需要多次运行此脚本。开始了：

```
--Table
CREATE TABLE IF NOT EXISTS person (
  id integer NOT NULL,
  person_name character varying(40) NOT NULL,
  updated_date date,
  CONSTRAINT person_pkey PRIMARY KEY (id)
);

--Index
CREATE INDEX IF NOT EXISTS idx_person_name ON person (person_name);

--Sequence
CREATE SEQUENCE IF NOT EXISTS seq_person_inc;

--Function
CREATE OR REPLACE FUNCTION simple_sum(a_integer int, b_integer int) RETURNS INT
    AS $$ SELECT a_integer+b_integer $$
LANGUAGE SQL;

--View
CREATE OR REPLACE VIEW vw_select_1 AS
    SELECT 1;

--Role
DO $$
BEGIN
    CREATE ROLE rick_deckard;    
EXCEPTION   
    WHEN duplicate_object THEN
        RAISE NOTICE 'Role already exists. Ignoring...';    
END$$;

--Simple insert
INSERT INTO person (id, person_name) VALUES (1, 'HAL-9000'); 

--Upsert (insert + update)
INSERT INTO person (id, person_name) VALUES (1, 'Betrayer') ON CONFLICT ON CONSTRAINT person_pkey DO UPDATE SET person_name = EXCLUDED.person_name;

--Upsert (ignoring duplicate error)
INSERT INTO person (id, person_name) VALUES (1, 'HAL-9000') ON CONFLICT ON CONSTRAINT person_pkey DO NOTHING;

--Upsert (ignoring any error)
INSERT INTO person (id, person_name) VALUES (1, 'HAL-9000') ON CONFLICT DO NOTHING;

--Field
DO $$
BEGIN
    ALTER TABLE person ADD COLUMN id_another_person INTEGER;
EXCEPTION   
    WHEN duplicate_column THEN
        RAISE NOTICE 'Field already exists. Ignoring...';
END$$;

--Constraint
DO $$
BEGIN
    ALTER TABLE person ADD CONSTRAINT person_id_another_person_fkey FOREIGN KEY (id_another_person) REFERENCES person (id);
EXCEPTION   
    WHEN duplicate_object THEN
        RAISE NOTICE 'Constraint already exists. Ignoring...';
END$$;

--Trigger
CREATE OR REPLACE FUNCTION person_trigger_function() RETURNS trigger AS $BODY$
BEGIN
   --Something complex here =)
   RETURN NEW; 
END;
$BODY$
LANGUAGE plpgsql;

DO $$
BEGIN
    CREATE TRIGGER person_trigger BEFORE INSERT OR UPDATE ON person FOR EACH ROW EXECUTE PROCEDURE person_trigger_function();
EXCEPTION   
    WHEN duplicate_object THEN
        RAISE NOTICE 'Trigger already exists. Ignoring...';
END$$;

--Drop
DROP TRIGGER IF EXISTS person_trigger ON person;
DROP INDEX IF EXISTS idx_person_name;
ALTER TABLE person DROP COLUMN IF EXISTS person_name;
ALTER TABLE person DROP CONSTRAINT IF EXISTS person_id_another_person_fkey;
DROP ROLE IF EXISTS rick_deckard;
DROP VIEW IF EXISTS vw_select_1;
DROP FUNCTION IF EXISTS simple_sum(integer, integer);
DROP FUNCTION IF EXISTS person_trigger_function();
DROP TABLE IF EXISTS person;
DROP SEQUENCE IF EXISTS seq_person_inc; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T22:15:44.863

您可能会发现这篇博文很有帮助： http: [//www.depesz.com/index.php/2008/06/18/conditional-ddl/](http://www.depesz.com/index.php/2008/06/18/conditional-ddl/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T22:33:05.493

您应该能够使用[plpgsql](http://www.postgresql.org/docs/8.3/static/plpgsql-structure.html)：

```
create language plpgsql;
create function f() ... as $$
<plpgsql code>
$$language plpgsql;
select f(); 
```

# objective-c - 在初始化中设置实例变量

> ID：731859
> 
> 赞同：0
> 
> 时间：2009-04-08T21:08:51.060
> 
> 标签：objective-c, initialization

是否可以在初始化类方法期间为实例变量赋值？

我声明了一些数组，然后创建了一个数组数组，然后将其分配给 self.months，它是一个实例变量。为什么这不起作用，我该如何做到这一点？

```
 +(void)initialize
 {
    // .....
        NSArray *matrix = [[NSArray alloc] initWithObjects:jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec, nil ];

    self.months = matrix;
    [matrix release] 
```

}

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T21:15:44.507

我认为你对做什么感到困惑`initialize`。这是初始化**类本身**。没有实例，因此没有实例变量。要初始化实例，请覆盖该`init`方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T21:15:54.880

您不能在类方法中设置实例变量，因为您没有对实例的引用。类上的`initialize`方法在该类第一次接收任何消息时被调用，并且意味着在处理任何实际消息之前执行您的类可能需要的任何类型的全局设置。例如，设置初始用户默认值通常在`initialize`应用程序的控制器或委托类的方法中完成。

要设置实例变量，您应该在对象的指定初始值设定项中执行此操作（这是`init`默认设置，但某些对象在需要参数时会更改指定初始值设定项）。例如：

```
- (id)init {
  if( (self = [super init]) ) {
    myInstanceVariable = (int *)malloc(50 * sizeof(int));
  }
}

- (void)dealloc {
  free(myInstanceVariable);
  [super dealloc];
} 
```

在这里，您实际上有一个`self`可以使用的引用，因为已经分配了一个对象的不同实例。

# ruby-on-rails - Rails 与相同模型的关联

> ID：731870
> 
> 赞同：4
> 
> 时间：2009-04-08T21:10:28.623
> 
> 标签：ruby-on-rails, associations

我有两个具有以下关联的类：

```
class Incident
  has_one :assignee
  has_one :technician

class User 
  has_many :incidents 
```

请注意，受理人和技术人员字段是指用户类型的对象。这些关系在模型中应该如何？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T22:11:47.260

据推测，事件应该属于受让人和技术人员，因为持有这些关系的外键将在事件表中，而不是在雇员表中

```
类事件
  belongs_to :assignee, :class_name => '用户'
  belongs_to :technician, :class_name => '用户'

类用户
  has_many :assigned_incidents, :class_name => '事件', :foreign_key => 'assignee_id'

  # 不确定你想为这种关系使用的措辞
  has_many :technician_incidents, :class_name => '事件', :foreign_key => 'technician_id'

```

您希望外键字段`incidents.assignee_id`为`incidents.technician_id`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-23T22:05:18.927

这是这个问题的完整答案，以防访问这个问题的人很难将所有东西放在一起（就像我第一次研究这个问题时一样）。

答案的某些部分发生在您的迁移中，而某些部分发生在您的模型中：

## 迁移

```
class CreateIncidents < ActiveRecord::Migration
  create_table :incidents do |t|
    def up
      t.references :assignee
      t.references :technician
    end
  end
end 
```

在这里，您指定此表中有两列将被称为 :assignee 和 :technician 并保存对另一个表的引用。Rails 实际上会为您创建名为“assignee_id”和“technician_id”的列。在我们的例子中，它们将引用用户表中的每个行，但我们在模型中指定，而不是在迁移中。

## 楷模

```
class Incident < ActiveRecord::Base
  belongs_to :assignee, class_name => 'User'
  belongs_to :technician, class_name => 'User'
end 
```

在这里，您将在名为 :assignee 的事件模型上创建一个属性，然后指定该属性将引用 User 类的一个实例。Rails 看到“belongs_to”，将在您的数据库中查找我们上面定义的名为“assignee_id”的列，并使用它来存储外键。然后你为技术人员做同样的事情。

这将允许您通过 Incident 模型的实例访问您的受让人和技术人员，这两个实例都是 User 模型的实例，如下所示：

```
Incident.assignee.name
Incident.technician.email 
```

这是您的用户模型：

```
class User < ActiveRecord::Base
  has_many :assigned_incidents, :class_name => 'Incident', :foreign_key => 'assignee_id'
  has_many :incidents_as_technician, :class_name => 'Incident', :foreign_key => 'technician_id'
end 
```

在这里，您将在用户模型上创建一个名为 :assigned_incidents 的属性，指定此属性将引用事件模型的实例，以及引用此事件模型的外键，即我们要使用的用户模型此属性称为“assignee_id”。然后你在为 events_as_technician 做同样的事情（这个命名似乎有点尴尬，但如果没有更好地了解你想要做什么，我真的没有什么好的建议）。

这允许您通过执行以下操作获取用户分配的所有事件或作为技术人员的事件：

```
User.assigned_incidents
User.incidents_as_technician 
```

执行其中任何一个都将返回 Incident 模型的实例数组。

# css - 某些元素在 Mac 上的 Safari 中显示更小？

> ID：731885
> 
> 赞同：1
> 
> 时间：2009-04-08T21:14:19.190
> 
> 标签：css, safari, cross-browser

在摆弄一个问题后，我得出了这个结论：

我的列表元素在我的 Macbook 上的 Safari 中显示的比在我的 PC 上的 Safari 上显示的要小。IE 和 Firefox 也正常显示。

什么可能导致这种差异？这阻碍了我完成这个设计的能力。

www.christopherbier.com/gbg

请让我知道是否有任何可能导致此问题的 css 标签。

这是我之前的问题，包括我的 CSS 等[。Safari 的 CSS 间距问题？](https://stackoverflow.com/questions/731546/css-spacing-issues-with-safari)

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T22:12:00.347

您可能需要考虑包含 css 重置样式表。你可以在这里找到一个好的：

[YUI CSS 重置](http://developer.yahoo.com/yui/reset/)

这基本上“消除并消除了 HTML 元素不一致的默认样式，在 A 级浏览器之间创建了一个公平的竞争环境”。

希望这能解决您的问题！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T21:24:40.727

我的猜测是，它很可能不是导致问题的 css 标签，而只是两个不同浏览器版本的默认值不同。每个版本可能在一定程度上是针对操作系统量身定制的，并且看起来可能会有所不同，这是意料之中的。

覆盖此默认行为应引发警告标志，因为您正在更改整体外观和感觉，并且通常可能与操作系统布局不匹配。这并不意味着不要这样做，但它确实意味着您可能要谨慎行事。

# python - 重置主 GUI 窗口

> ID：731887
> 
> 赞同：3
> 
> 时间：2009-04-08T21:14:42.013
> 
> 标签：python, tkinter

我只想要相当于关闭和重新打开我的主程序。我想在单击下拉菜单中的类似“新”的选项时调用它。比如调用 root.destroy() 然后重新启动主循环。

我怎样才能完成这项工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T02:08:10.420

至少有三种方法可以解决这个问题。

方法一：**假头**。创建应用程序时，不要将所有小部件都放在根窗口中。相反，隐藏根窗口并创建一个代表您的应用程序的新顶层。当您重新启动时，只需破坏新的顶层并重新运行所有启动逻辑即可。

方法二：**nuke 和 pave**。概念相似，但执行方式略有不同。在此模型中，当您想要重新启动时，您只需删除主窗口中的所有小部件，将几何图形重置为 null（因此窗口将再次根据其内容调整自身大小），然后运行绘制所有其他小部件的逻辑.

方法三：**如果它第一次起作用...**正如 Martin v. Löwis 所建议的，只需让您的程序执行该程序的一个新实例，然后退出。

前两种方法可能更快，并且具有保留当前环境的（不利）优势。例如，您可以保存剪贴板的副本、列宽等。第三种方法绝对保证空白。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T22:09:52.520

如果您在 Unix 上，请使用 os.execv 重新启动整个应用程序。确保传递所有命令行参数等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T22:25:23.763

您可以将所有 GUI 构建逻辑和初始状态代码从主循环中取出，并将其放入函数中。从主循环调用这些函数（类似于：buildgui() 和 initstate()），然后，当用户单击您的菜单图标时，只需调用 initstate() 将其设置为应用程序首次启动时的状态。

# perl - 生成“动态”网站静态版本的最佳方法

> ID：731895
> 
> 赞同：4
> 
> 时间：2009-04-08T21:16:10.187
> 
> 标签：perl, dynamic-content

我有一个动态的网站，从数据库生成大量数据，但数据库的内容很少更改（大约每周 1-3 次）。这些更改是手动和受控的。

我更喜欢使用静态页面，而不是动态网站的开销。我正在讨论什么是最好的解决方案：

**卷曲/wget/蜘蛛**

这个[问题](https://stackoverflow.com/questions/44517/tools-to-convert-asp-net-dynamic-site-into-static-site)提到了它。我看到的缺点可能是：

*   需要手动清理（链接、丢失的图像等）
*   不能混合静态和动态页面

**代理**

我可以使用代理将静态页面缓存一定天数。缺点：

*   难以管理每个页面的缓存
*   每次手动更改后需要清除缓存吗？

**使用程序生成静态页面**

我目前的选择：我使用 perl 程序从动态内容生成静态页面。这不能很好地扩展，因为我必须对很多 HTML 进行硬编码，尤其是页面结构

还有其他方法吗？你/你更喜欢什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T21:29:18.187

Memcache 基础全页缓存，过期时间长。[标签扩展](http://code.google.com/p/memcached-tag/)可以让您仅使选定的页面范围无效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T21:20:20.363

您想这样做的任何特殊原因，而不是仅仅设置[数据库缓存](http://en.wikipedia.org/wiki/Database_caching)解决方案来阻止查询实际上必须访问数据库？

是否可能取决于您站点上的动态数据量以及服务器中可用的内存量，但它不会有您担心的任何问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T21:50:55.763

我会像你现在做的那样做，使用脚本来生成静态页面。您可以使用模板系统来避免每次都编写新的 HTML。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T08:10:27.133

您没有提到尽​​快向用户显示更改的数据的重要性。

我们已经成功地为我们的网站使用代理缓存来处理获得大量点击的动态页面。根据我们希望客户多久看到更新的数据，我们为每个类别保留不同的缓存年龄。

# c# - 如何摆脱数据库中的多个列？

> ID：731902
> 
> 赞同：5
> 
> 时间：2009-04-08T21:18:18.090
> 
> 标签：c#, database, database-design, oledb

我正在创建一个 Access DB 用于学校的 C# 应用程序。我没有太多使用 DB 的经验，所以如果这听起来很愚蠢，请忽略它。我希望用户能够选择某个学生在我们 IT 部门上过的**所有课程。**我们总共有大约 30 个，一个人在 4 年的高中学习的最大值是 15 个。现在我的数据库有 15 个不同的列用于用户可以拥有的每个班级。如何将其压缩为一列（如果有办法）？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-08T21:31:37.853

很好的问题卢卡斯，这深入研究了数据库规范化的行为。

您认识到为什么使用多个列来表示类是不好的这一事实已经表明您具有巨大的潜力。

如果我们想添加一个新类怎么办？现在我们必须添加一个全新的列。对此几乎没有灵活性。

那么可以做些什么呢？

我们创建了三个表。

一张桌子是给学生的：

```
Student
   |-------------------------|
   | StudentID | Student_Name|
   |-------------------------|
   |     1     |     John    |
   |     2     |     Sally   | 
   |     3     |     Stan    | 
   --------------------------- 
```

一张表用于类：

```
Class
   ------------------------
   | ClassID  | Class_Name|
   ------------------------
   |    1     |   Math    |
   |    2     |   Physics |
   ------------------------ 
```

最后，一张表包含学生和班级之间的关系：

```
Student_Class
   -----------------------
   | StudentID | ClassID |
   ----------------------- 
```

如果我们想将 John 注册到物理，我们将在 Student_Class 表中插入一行。

```
 INSERT INTO Student_Class (StudentID, ClassID) VALUES (1, 2); 
```

现在，我们有一个记录说学生#1（约翰）正在上班级#2（物理）。让莎莉上数学，斯坦上物理和数学。

```
 INSERT INTO Student_Class (StudentID, ClassID) VALUES (2, 1);
  INSERT INTO Student_Class (StudentID, ClassID) VALUES (3, 1);
  INSERT INTO Student_Class (StudentID, ClassID) VALUES (3, 2); 
```

为了以可读的方式拉回这些数据，我们将三个表连接在一起：

```
 SELECT Student.Student_Name, 
         Class.Class_Name 
  FROM Student, 
       Class, 
       Student_Class 
  WHERE Student.StudentID = Student_Class.StudentID 
       AND Class.ClassID = Student_Class.ClassID; 
```

这会给我们一个这样的结果集：

```
 ------------------------------
  | Student_Name  | Class_Name |
  ------------------------------
  |    John       |  Physics   |
  |    Sally      |   Math     |
  |    Stan       |  Physics   |
  |    Stan       |   Math     |
  ------------------------------ 
```

简而言之，这就是数据库规范化的工作方式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T21:25:27.307

听起来您需要考虑[规范化](http://en.wikipedia.org/wiki/Database_normalization)您的数据库模式。

学生和班级之间存在[多对多的关系](http://www.databasedev.co.uk/many_to_many.html)，因此许多学生可以选修许多课程，并且许多学生可以选修许多课程。处理这种情况的最常用方法是使用[联结表](http://en.wikipedia.org/wiki/Junction_table)。

像这样的东西

```
Student Table
-------------
id
first_name
last_name
dob

Class Table
-----------
id
class_name
academic_year

Student_Class Table
-------------------
student_id
class_id
year_taken 
```

然后您的查询将加入表，例如，

```
SELECT
    s.last_name + ', ' + s.first_name AS student_name,
    c.class_name,
    sc.year_taken
FROM
    student s
INNER JOIN
    student_class sc
ON
    s.id = sc.student_id
INNER JOIN
    class c
ON
    sc.class_id = class.id
ORDER BY
    s.last_name, sc.year_taken 
```

我要提到的一个建议是，Access 要求您在查询中加入多个表时使用括号，我相信这是因为它要求您指定加入它们的顺序。就个人而言，我觉得这很尴尬，尤其是当我习惯于在没有设计人员的情况下编写大量 SQL 时。在 Access 中，我建议使用设计器来连接表，然后根据您的目的修改生成的 SQL。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T21:25:49.973

所以你有 15 列（例如 class1、class2、class3 ... class15）？

看起来你有一个经典[的多对多关系](http://www.databasedev.co.uk/many_to_many_example.html)。您应该创建一个新表来关联学生和班级。

```
student { StudentID, StudentName ... }
classes { ClassID, ClassName ... }
student_classes { StudentID, ClassID } 
```

如果您逐年跟踪课程，您也可以在关系中添加一个年份列：

```
student_classes { StudentID, Year, ClassID } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T21:32:08.180

这是一个规范化问题。实际上，您问的是错误的问题。而是问自己一个问题，如何存储 0 个或多个 classes_taken？您还需要存储关于每节课的哪些其他详细信息？例如，只是上课，或数据，结果等？

例如考虑如下

```
表学生
 id int
 名称 varchar(25)
 ...

表类
 id int
 名称 varchar(25)
 ...

表 clases_taken
 student_id int (student.id 的外键)
 class_id int（class.id 的外键）
 data_started 数据时间
 结果 varchar(5)
 utor_id int（tutor.id 的外键）
 ...

```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T21:32:49.257

您永远不应该在数据库表中包含 class1、class2、class3、class4 等列。你应该有一个相关的表。您的结构将类似于：

```
Student Table with the following columns
StudentID
StudentLastName
StudentFirstName 
(and so forth for all the data to describe a student) 
```

然后

```
Course table with the following columns
CourseId
CourseName 
```

然后

```
StudentCourse Table with the following columns
StudentId
CourseID
CourseDate 
```

现在要找出这个人参加了哪些课程，您可以将这些表格一起加入。就像是：

```
Select StudentID,StudentLastName,StudentFirstName, CourseName, CourseDate
from Student 
join StudentCourse on student. studentid = StudentCourse.StudentID
join Course on Course.courseID = StudentCourse.CourseID 
```

请阅读此链接以开始学习数据库基础知识：http: [//www.deeptraining.com/litwin/dbdesign/FundamentalsOfRelationalDatabaseDesign.aspx](http://www.deeptraining.com/litwin/dbdesign/FundamentalsOfRelationalDatabaseDesign.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T21:21:26.553

学生表中没有班级列怎么样。设置一个包含学生 ID 和班级 ID 列的新表。每行代表学生上的一门课。也许添加更多列，例如：年/学期、年级等。

# c# - 如何判断我的表单是否显示在屏幕之外？

> ID：731903
> 
> 赞同：0
> 
> 时间：2009-04-08T21:18:45.967
> 
> 标签：c#, winforms, .net-3.5, screen-positioning

所以我有两种形式，mainform和extraform。
当 mainform 初始化时，extraform 设置总是移动到 mainform 的右侧
有时 mainform 占用了两个监视器，extraform 被推离屏幕，再也看不到了。如果可能的话，我想防止这种情况发生。我该怎么做？它必须支持双显示器，它们之间可能有也可能没有距离（即屏幕 1 距屏幕 2 左侧 20 像素）。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T21:33:32.373

您可以使用 Screen 类来确定您的窗口相对于桌面的位置。Screen 类有一个 FromRectangle 方法，因此您可以确定应该将 Form 放置在哪个屏幕上（通过传入表单的 Bounds 属性）。

每个 Screen 对象都有一个 Bounds 属性，您可以使用它来比较窗口的位置和大小，并相应地调整它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T21:42:00.340

当extraform被推到屏幕边界之外时，这取决于您想要发生的事情。

但是，要确定它是否被推迟，使用 System.Windows.Forms.Screens 类非常简单。然后你可以像这样进行边界检查：

```
 foreach (var screen in Screen.AllScreens)
        {
            if(screen.Bounds.Contains(this.Bounds))
            {
                Console.WriteLine("Device "+screen.DeviceName+" contains form!");
            }
        } 
```

代码假定存在于一种形式中。请注意，如果表单完全包含在屏幕上，则此代码仅打印屏幕包含表单。但这应该很容易解决，具体取决于您的需要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T21:38:00.007

也许您的 Forms 中的 DesktopLocation 属性可以为您提供有关它们正在发生的事情的线索

# html - 自动调整容器 容纳绝对定位的孩子的高度 s

> ID：731907
> 
> 赞同：30
> 
> 时间：2009-04-08T21:20:53.433
> 
> 标签：html, css, layout

有没有办法自动调整容器 DIV 高度以适应绝对定位的子 DIV？我想得到类似的东西

```
+------------------------+
| 集装箱 |
| +------+ +------+ |
| | 孩子 | | 孩子 | |
| | 1 | | 2 | |
| | | | | |
| +------+ +------+ |
| +--------+ |
| | 孩子 | |
| | 3 | |
| | | |
| +--------+ |
+------------------------+

```

我尝试类似：

```
<div class="container" style="position: relative; border: solid thin">
    <div class="chld" style="width: 20px; 
                             height: 20px; 
                             position: absolute; left: 5px; top: 5px;
                             border: dashed thin;"><div>
    <div class="chld" style="width: 20px; 
                             height: 20px; 
                             position: absolute; left: 30px; top: 5px;
                             border: dashed thin;"><div>
    <div class="chld" style="width: 20px; 
                             height: 20px; 
                             position: absolute; left: 15px; top: 30px;
                             border: dashed thin;"></div>
</div> 
```

但“容器” div 保持零高度。我了解，这可能是预期的行为，因为元素在绝对定位时会从流程中“取出”，但是有解决方法吗？（除了预先计算得到的高度并手动设置）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-10-26T06:12:53.870

> 溢出：自动

这是新的**clearfix**方法，仅供参考。但是，它并不总是将容器扩展到其*最高*且*绝对定位*的孩子的高度。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-08T23:09:50.083

如果您使用 position:relative 而不是 position absolute，则空白空间将保留在元素应该位于的页面结构中，并且该空间将是您已移动元素的高度。

因此，您可以浮动 chld1 和 chld2 以使它们并排放置，添加顶部和底部填充以将 chld 3 向下推，并使用相对位置将它们分开并移动到任何高度。然后在 chld3 上同时使用 clear。

就像是

```
#exp_outer {
  width: 400px;
  border: 1px solid black;
}
#chld1 {
  float: left;
  margin: 30px 0 20px;
  left: 50px
}
#chld2 {
  float: right;
  margin: 30px 0 20px;
  right: 50px;
}
#chld3 {
  left: 150px;
  clear: both;
}
.box {
  position: relative;
  width: 80px;
  height: 80px;
  border: 1px solid black;
}
```

```
<div id="exp_outer">
  <div id="chld1" class="box">Child1</div>
  <div id="chld2" class="box">Child2</div>
  <div id="chld3" class="box">Child3</div>
</div>
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-09T11:00:14.697

我最终使用了 clearfix，这允许我设置容器的所需宽度，并且它的高度将根据内容自动调整（这适用于所有浏览器）

```
<style>
        .inner_box {
            position: relative;
            float: left;
            width: 50px; 
            height: 50px; 
            border: dashed thin;
            margin: 5px 5px 5px;
            text-align: center;
        }

        .outer_box {
            position: relative; 
            top: 200px;
            border: solid thin; 
            width: 190px;
            //height: 1%;
        }

        .outer_box:after {
            content: '.'; 
            display: block; 
            clear: both; 
            visibility: hidden; 
            height: 0; 
            line-height: 0;
        }
    </style>

<div class="outer_box">
    <div class="inner_box">1</div>
    <div class="inner_box">2</div>
    <div class="inner_box">3</div>
    <div class="inner_box">4</div>
    <div class="inner_box">5</div>
    <div class="inner_box">6</div>
</div> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T23:23:44.887

不，整个想法是绝对定位的元素不会影响其父布局。

尝试通过相对定位浮动而不是绝对定位 div 来实现您的目标。它不是那么方便（因为你的浮动的起始位置不是屁股 0,0），但它会起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-15T15:43:24.483

为了实现这一点，我费了很大的力气，现在我有了一个解决方案，它看起来很简单，无论如何，需要一些 jQuery/Javascript：

```
jQuery(window).load(function(){
    var valueCheck = [];
    jQuery('.projectsWrap .hentry').each(function(){
        var itemObj = jQuery(this);
        var itemValues = itemObj.position();
        var top = itemValues.top;
        var height = jQuery(this).height();
        var sum = top + height;
        valueCheck.push(sum);
    });
    var res = Math.max.apply(Math, valueCheck);
    jQuery('.projectsWrap').height(res);
}); 
```

我在 WordPress 主题中编写并实现了这个小脚本，因此您会看到“$”被转换为“jQuery”以实现兼容性，但如果您不使用 WordPress，您应该将它们恢复为“$”。

我所处的情况比问题中的情况更困难，因为用户想要自主地绝对定位容器中的每个元素，并且元素在 dom 中出现的顺序与它们在容器中的位置无关：完全出乎意料结果（例如，dom 中的第一个元素可能显示为窗口中的最后一个底部元素）。

此外，元素的高度都不同，所有不同的高度和所有不同的最高值（偏移量），都是一场噩梦。

脚本所做的是获取每个元素的高度和顶部值，对它们求和并将这个和放入一个数组中，然后检查数组以找到最大值，这个值是容器将设置的高度，神奇！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-01T13:17:58.873

对于这个小问题，我找不到任何简单的纯 JavaScript 解决方法，所以它来了（您需要在 html 代码中添加 id 字段）：

```
var containerBox = document.getElementById('container');
var statBoxBottom = document.getElementById('chld3').getBoundingClientRect().bottom + window.scrollY;
var mainDivBottom = containerBox.getBoundingClientRect().bottom + window.scrollY;
var boxHeightDiff = statBoxBottom - mainDivBottom;
if (boxHeightDiff > 0) 
    containerBox.style.height = Math.ceil( containerBox.offsetHeight + boxHeightDiff ) + 'px'; 
```

它基本上根据“chld3”的绝对底部位置增加“容器”高度。

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2009-04-08T21:38:46.590

如果您将 .container div 的高度设置为 100%，它应该从大多数浏览器中的子元素计算它，但不幸的是不是 IE6 或更低版本。

# c++ - 为什么会编译（在初始化之前在函数中使用）？

> ID：731908
> 
> 赞同：4
> 
> 时间：2009-04-08T21:21:11.560
> 
> 标签：c++, visual-studio-2008, compiler-construction

考虑在 Visual Studio 2008 下测试的这段代码（使用 CString，因为它在未构造时很熟悉且易于查看，但类没有什么特别之处）：

```
CString DoSomething( const CString& sString )
{
    return sString;
}

CString sTest1 = DoSomething( sTest1 ); // Compiles (no warnings), fails at runtime
CString sTest2( DoSomething( sTest2 ) ); // Doesn't compile
CString sTest3; sTest3 = DoSomething( sTest3 ); // Compiles, self-assignment, works 
```

据我了解 C++ 标准，Test1 可以作为编译时优化自动编译到 Test2 中，前提是提供适当的构造函数（默认情况下，将生成与第一个测试相同的构造函数）。然而，值得注意的是，该行为与 Test3 不同，后者可以正常工作。

现在我明白了为什么 Test1 不起作用，为什么 Test2 不能编译。我很好奇的是为什么首先要编译 Test1？这在标准中是否允许，可以解释，VS2008 编译器中的缺陷，使用前初始化静态检查的缺陷，还是什么？在这种情况下，有什么方法可以强制编译器至少发出警告（Test1 在 VS2008 下似乎以最大警告级别编译干净）？C++ 规范允许这种结构的理由是什么？

编辑：或者，有什么方法可以强制编译器将 Test1 编译为 Test2 （从而触发错误）？

编辑以添加 Test2 的逐字错误消息：错误 C2065: 'sTest2' : undeclared identifier

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T21:26:26.010

您在 sTest1 中看到的行为在 C++ 标准中未定义。这很奇怪而且错误，但它可以在一些编译器上编译。

有关更多详细信息，请参阅以下线程上的 litb 答案：[在对象已初始化之前在对象上运行的方法？](https://stackoverflow.com/questions/723344/method-running-on-an-object-before-the-object-has-been-initialised/723358#723358)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T21:25:33.703

这几天有几个关于相关现象的问题。

我的理解是，即使 sTest1 没有初始化，它已经是一个有效的标识符（例如，在 C 中你可以调用 sizeof ），它只是没有内容。因此，当您调用 DoSomething 时，您传递的是对合法但危险的未初始化变量的引用。

我猜测返回是运行时的问题，因为您正在尝试对本质上应该是字符串的未初始化内存空间进行按值返回（复制构造函数）。根据 CString 的存储方式，代码可能正在寻找空终止符或表示分配字节数的东西。

# java - 内存缓存监控

> ID：731914
> 
> 赞同：2
> 
> 时间：2009-04-08T21:23:05.583
> 
> 标签：java, memcached

`memcached`从 Linux 机器上的 Java 应用程序监视的最佳方法是什么？我想要以下信息：

1) 每个对象使用的内存
2) 为回收内存而驱逐的项目数 3) 等等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2014-02-10T03:25:00.743

我知道这个问题很老：

但是对于正在运行的 memcached 系统的一些快速监控：（在 ubuntu 中）

```
$ sudo apt-get install libmemcached-tools 
```

这包括一些方便的工具。我特别使用的是**memcstat**

```
$ watch -n1 -d 'memcstat --servers localhost' 
```

这将显示很多方便的信息，例如：

```
curr_connections: 5
total_connections: 26
get_hits: 202
get_misses: 12
bytes_read: 1650
bytes_written: 74345 
```

这很方便，因为它不需要您编写一行代码，而且更好的是会告诉您缓存基础设施是否也像您期望的那样工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T21:38:41.987

以下是[有关 memcached 监控的一些信息](http://www.netuality.ro/monitoring-memcached-with-cacti/tools/20060802)和[另一个列表](http://code.google.com/p/memcached/wiki/HowToMonitor)。

不过，来自 Java 的 Memcached 是一个有点奇怪的选择。我很好奇你为什么选择它。Java 上的缓存解决方案往往围绕[EHCache](http://ehcache.sourceforge.net/)或[Terracotta](http://www.terracotta.org/)展开。这是一个[更完整的 Java 缓存解决方案列表](https://stackoverflow.com/questions/383920/what-is-the-best-library-for-java-to-grid-cluster-enable-your-application/383929#383929)。

# c# - WCF 自定义服务行为

> ID：731915
> 
> 赞同：1
> 
> 时间：2009-04-08T21:23:19.233
> 
> 标签：c#, .net, wcf

上下文：我正在使用 WCF 托管许多服务。我希望他们每个人都支持 Ping 操作（心跳，保持活动，等等......）。但是，我宁愿不要在每一个上都实施 IPingable。相反，我喜欢做一些类似于 serviceMetadata 行为的事情，并动态添加一个通道调度程序。这意味着我需要做的就是向服务添加可 ping 的行为，并且支持此操作。

有任何想法吗？我查看了 serviceMetadata 的源代码，并且有各种内部的东西被称为我无权访问。此外，可能还有更简单的方法。

谢谢你的时间。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T21:54:24.837

就在我的脑海中，您能否添加一个调度行为来处理调用并欺骗返回真/假？

我还发现了[以下](http://geekswithblogs.net/LeonidGaneline/archive/2008/05/07/wcf-availability-of-the-wcf-services.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T23:47:28.543

如果你通过一个行为来做，你的元数据会表明Ping操作存在吗？

# java - 如何以特定格式显示txt文件中的数据

> ID：731917
> 
> 赞同：0
> 
> 时间：2009-04-08T21:24:19.603
> 
> 标签：java, file, text-files

我有一个文本文件输入，其中包含如下数据。如何将文本文件中的数据显示为特定格式？

```
Monday
Jessy
Walking
20 minutes
Matthew
Run
20 minutes
Karen
Jogging
40 minutes
Jessica
Run
12 minutes
Tuesday
Messia
Walking
10 minutes
Matthew
Run
20 minutes
Pete
Run
10 minutes
Carol
Walking
30 minutes 
```

我想将文本文件中的数据显示为这种格式：

```
Day            Name               Type of exercise           Time
Monday         Jessy              Walking                    20 minutes
               Matthew            Run                        20 minutes
               Karen              Jogging                    40 minutes
               Jessica            Run                        12 minutes 
Tuesday        Messia             Walking                    10 minutes
               Matthew            Run                        20 minutes
               Pete               Run                        10 minutes
               Carol              Walking                    30 minutes 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T21:48:31.917

我只是快速地把它放在一起，但是像这样的东西呢：

```
static final String[] DAYS =
{ "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday" };

public class ActivityEvent
{
  public int day;
  public String name;
  public String typeOfExercise;
  public String time;
}

public List loadActivities(String filename) throws IOException
{
  List activities = new ArrayList();
  FileInputStream fis = new FileInputStream(filename);
  InputStreamReader isr = new InputStreamReader(fis);
  BufferedReader br = new BufferedReader(isr);
  int lastDay = -1;
  String line;
  while ((line = br.readLine()) != null)
  {
      line = line.trim();
      int day;
      for (day = DAYS.length - 1; day >= 0; day--)
      {
          if (line.equals(DAYS[day]))
          {
              break;
          }
      }
      String name;
      if (day < 0)
      {
          day = lastDay;
          if (lastDay < 0)
          {
              throw new IOException(filename + " must start with day of week");
          }
          name = line;
      }
      else
      {
          name = br.readLine();
          if (name == null)
          {
              throw new IOException(filename + " expected name, reached end of file");
          }
      }
      String type = br.readLine();
      if (type == null)
      {
          throw new IOException(filename + " expected type of exercise, reached end of file");
      }
      String time = br.readLine();
      if (time != null)
      {
          throw new IOException(filename + " expected time of exercise, reached end of file");
      }
      ActivityEvent activity = new ActivityEvent();
      activity.day = day;
      activity.name = name;
      activity.typeOfExercise = type;
      activity.time = time;
      activities.add(activity);
  }
  return activities;
}

public void printActivities(List activities)
{
    StringBuilder str = new StringBuilder("Day\tName\tType of Exercise\tTime\n");
    int numActivities = activities.size();
    int lastDay = -1;
    for (int index = 0; index < numActivities; index++)
    {
        ActivityEvent activity = (ActivityEvent)activities.get(index);
        if (activity.day != lastDay)
        {
            str.append(DAYS[activity.day]);
        }
        str.append('\t');
        str.append(activity.name);
        str.append('\t');
        str.append(activity.typeOfExercise);
        str.append('\t');
        str.append(activity.time);
        str.append('\n');
    }
    System.out.print(str.toString());
} 
```

然后调用所有内容，例如：

```
List activities = loadActivities("somefile.txt");
// Do optional sorting, etc. here.
printActivities(activities); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T21:33:10.050

我会看看 Java 的 [sprintf](http://java.sun.com/j2se/1.5.0/docs/api/java/io/PrintStream.html#printf%28java.lang.String,%20java.lang.Object...%29) () 函数，它能够[左/右对齐](http://www.java2s.com/Tutorial/Java/0120__Development/Rightjustifyingandleftjustifyingvalues.htm)具有指定宽度的数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T21:36:19.730

**关于解析输入：**

您将遇到的一个问题是数据的每个“记录”（输出中的每一行）都不是固定大小。有些是 name,exercise,time 的 3 元组，有些是 day,name,exercise,time 的 4 元组

也就是说，假设您提供的格式确实是它的全部内容，则可以解决此问题。

读完一行后，您可以检查工作日，如果是，则假设这是 4 元组的开始，然后阅读接下来的 3 行。如果不是工作日，则假设它是一个 3 元组，并且只读取接下来的 2 行。

如果输出中的名称、类型或时间列中也可能存在“间隙”，并且以不同的组合形式存在，那么它会变得更加棘手。

您确实需要您的程序特别了解哪些值在哪些列中有效。例如，“Jessica”不是有效的锻炼类型，“Jogging”不是有效的名称。

**关于格式化输出**

[布赖恩的回答](https://stackoverflow.com/questions/731917/how-to-display-data-from-txt-file-in-specific-format/731952#731952)是相关的。

这取决于您使用的语言。大多数语言都有 printf 等效项。printf 的格式化代码允许您用空格等填充。

如果您使用 Perl（可能非常适合此任务），您可以使用[格式](http://www.perl.com/doc/manual/html/pod/perlform.html)

# asp.net - 如何在 ASP.NET 中覆盖页面加载生命周期以防止加载 ASPX 表单？

> ID：731930
> 
> 赞同：2
> 
> 时间：2009-04-08T21:28:21.107
> 
> 标签：asp.net, page-lifecycle, response.write

我需要在几个 ASPX 代码隐藏文件中测试一个条件，并且在某些情况下，我想完全绕过正常的页面加载过程，以便不加载相应的 ASPX 页面。Intead，我想向浏览器发送从代码隐藏方法编写的自定义响应。

有谁知道从哪里开始——在页面生命周期中覆盖哪些方法以及确保我的自定义 Response.Write 在正常 ASPX 页面内容被抑制时发送到浏览器的最佳技术？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T21:32:21.580

可能是最简单的方法 - 使用`Page_Load()`.

```
protected void Page_Load(object sender, EventArgs e)
{
    bool customResponse = true;
    if (customResponse)
    {
        Response.Write("I am sending a custom response");
        Response.End(); //this is what keeps it from continuing on...
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-05-04T02:43:05.467

使用 Response.End() 的“简单”方法对性能来说很糟糕，会引发终止线程的异常。
[http://blogs.msdn.com/b/tmarq/archive/2009/06/25/correct-use-of-system-web-httpresponse-redirect.aspx](http://blogs.msdn.com/b/tmarq/archive/2009/06/25/correct-use-of-system-web-httpresponse-redirect.aspx)
[http://weblogs.asp.net/hajan/archive /2010/09/26/why-not-to-use-httpresponse-close-and-httpresponse-end.aspx](http://weblogs.asp.net/hajan/archive/2010/09/26/why-not-to-use-httpresponse-close-and-httpresponse-end.aspx)

我有同样的问题并以这种方式解决了。这是一个两步过程：首先调用 HttpApplication.CompleteRequest() 并退出您的处理。接下来重写 Render() 以便不调用基本方法。然后示例代码变为：

```
bool customResponse = true;

protected void Page_Load(object sender, EventArgs e)
{
    如果（自定义响应）
    {
        Response.Write("我正在发送自定义回复");
        this.Context.ApplicationInstance.CompleteRequest();
        返回; // 绕过正常处理。
    }
    // 正常处理...
}

受保护的覆盖无效渲染（HtmlTextWriter writer）
{
    如果 (!customResponse)
        base.Render(作家); // 然后像往常一样写页面。
}

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T21:41:40.653

这真的取决于你在回应什么，它是一个发布的表单字段、身份验证信息等......？使用 Page_Load 显示的方法将起作用，但页面生命周期中该点之前的任何内容也将执行。

# actionscript-3 - 如何让 mx:textarea 高度与内容相同

> ID：731932
> 
> 赞同：1
> 
> 时间：2009-04-08T21:28:48.953
> 
> 标签：actionscript-3, flex3, textarea

文本区域的初始高度远大于内容，我找不到使其始终与文本内容高度相同的方法：

```
<mx:TextArea id="textarea" borderStyle="solid" width="100%" wordWrap="true" selectable="false" backgroundAlpha="0" focusAlpha="0" text="this is a little test" /> 
```

给出一个比需要的高得多的带边框的框。

如果您在内容中有链接，这也会带来一个无意的问题，因为当链接不远处时会触发链接“鼠标悬停”。

```
<mx:Script>
<![CDATA[
public function onInit():void
{
    var style:StyleSheet = new StyleSheet();

    var aLink:Object = new Object();
    aLink.color = "#0000FF";

    var aHover:Object = new Object();
    aHover.color = "#00FF00";
    aHover.textDecoration = "underline";

    style.setStyle( "a:hover", aHover );
    style.setStyle( "a:link", aLink );

    textarea.styleSheet = style;
}
]]>
</mx:Script>

<mx:TextArea id="textarea" width="100%" wordWrap="true" borderStyle="solid" selectable="false" backgroundAlpha="0" focusAlpha="0" >
    <mx:htmlText>
    <![CDATA[<a href='event:http://www.adobe.com'>Navigate to Adobe.com.</a> this is testing nothing at all really]]>
    </mx:htmlText>
</mx:TextArea> 
```

Text 组件不会受此影响，但我无法将样式表附加到文本组件。

希望有人可以提供帮助。或者我可以使用其他一些组件来添加样式表来样式化锚标记。

我在 TextArea.as 源中发现它是可覆盖的，如果我覆盖它并删除“2 x”乘数，它几乎可以工作，但不幸的是，这意味着内容在需要时不会变大，而是垂直滚动，所以它几乎就在那里：

```
override protected function measure():void
{
    super.measure();

    measuredMinWidth = DEFAULT_MEASURED_MIN_WIDTH;
    measuredWidth = DEFAULT_MEASURED_WIDTH;
    // TextArea is minimum of two lines of text
    measuredMinHeight = measuredHeight = 2 * DEFAULT_MEASURED_MIN_HEIGHT;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T22:20:22.557

如果你扩展 Text，你可以添加一个 getter/setter，允许你设置底层 UITextField 对象的 styleSheet。

```
package
{
    import flash.events.Event;
    import flash.text.StyleSheet;

    import mx.controls.Text;

    import mx.core.mx_internal;

    use namespace mx_internal;

    public class StyledText extends Text
    {
        public function StyledText()
        {
            super();
        }

        private var _styleSheet:StyleSheet = null;

        [Bindable("stylesheetChanged")]
        public function get styleSheet():StyleSheet {
            return _styleSheet;
        }

        public function set styleSheet(value:StyleSheet):void {
            _styleSheet = value;

            if ( textField ) {
                textField.styleSheet = _styleSheet;
            }

            dispatchEvent(new Event("stylesheetChanged"));
        }

        override protected function createChildren():void {
            super.createChildren();

            //textField is created in the createChildren 
            //method of the Label class
            if ( textField && styleSheet ) {
                textField.styleSheet = _styleSheet;
            }
        }

    }
} 
```

然后你可以像这样使用组件：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" xmlns:ns1="*" preinitialize="onInit()">
    <mx:Script>
    <![CDATA[
    public function onInit():void
    {
        var style:StyleSheet = new StyleSheet();

        var aLink:Object = new Object();
        aLink.color = "#0000FF";

        var aHover:Object = new Object();
        aHover.color = "#00FF00";
        aHover.textDecoration = "underline";

        style.setStyle( "a:hover", aHover );
        style.setStyle( "a:link", aLink );

        text.styleSheet = style;
    }
    ]]>
    </mx:Script>

    <ns1:StyledText id="text" x="0" y="79">
        <ns1:htmlText>
        <![CDATA[<a href='event:http://www.adobe.com'>Navigate to Adobe.com.</a> this is testing nothing at all really]]>
        </ns1:htmlText>
    </ns1:StyledText>

</mx:Application> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T22:09:10.057

我还没有尝试过您正在尝试的内容，但是此链接看起来可能会有所帮助：

[http://www.adobe.com/cfusion/communityengine/index.cfm?event=showdetails&postId=13628&productId=2](http://www.adobe.com/cfusion/communityengine/index.cfm?event=showdetails&postId=13628&productId=2)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T21:49:25.707

基于 Bedwyr 的链接，我想我会尝试自己重新计算高度，这似乎工作正常（尚未注意到任何不良副作用，但可能存在）：

```
this.addEventListener( Event.CHANGE, onReMeasure );
this.addEventListener( Event.RESIZE, onReMeasure );

override protected function measure():void
{
        super.measure();

        measuredMinWidth = DEFAULT_MEASURED_MIN_WIDTH;
        measuredWidth = DEFAULT_MEASURED_WIDTH;

        var lm:TextLineMetrics = getLineMetrics( 0 );
        measuredMinHeight = measuredHeight = DEFAULT_MEASURED_MIN_HEIGHT;
}

private function onReMeasure( eventObj:Event ):void
{
    var ht:Number = 0;
    for( var n:int = 0; n < textField.numLines; n++ )
    {
        ht += textField.getLineMetrics(n).height;
    }
    ht += 10;   // padding

    height = ht;
    validateNow();
} 
```

# pdf - 在 Latex 中包含图像时出错

> ID：731933
> 
> 赞同：38
> 
> 时间：2009-04-08T21:29:15.520
> 
> 标签：pdf, latex, eps

编译我的 Latex 文件时出现以下错误：

**！LaTeX 错误：无法确定 tree.jpg 中图形的大小（无边界框）。**

为什么我会收到此错误？这与 .eps 文件有什么关系？

事实上，我可以在我的机器上用 MacTex 编译它。但是当我将它在线提交给科学期刊发表时，它会在服务器上对其进行编译并将生成的 PDF 发送给我，其中包含所有这些阻止它编译的错误。

我使用以下语法来包含图像：

```
\begin{figure}[!h]
    \begin{center}
        \scalebox{0.45}{
            \includegraphics{tree.jpg}}
    \end{center}
            \caption{\small A sample}
            \label{tree}
\end{figure} 
```

我该怎么办 ？会不会是他们的服务器使用的是旧的编译器？

**更新：**它终于奏效了。我将第一张图片转换为 PDF，编译过程完美。我猜它使用了该 PDF 中的边界框值并将其应用于所有图像。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2011-08-23T03:34:28.347

要包含*png*和*jpg*，您需要明确指定边界框。

```
\includegraphics[bb=0 0 1280 960]{images/some_image.png} 
```

其中 1280 和 960 分别是宽度和高度。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-04-08T21:31:55.607

我遇到了同样的问题，包括 LaTeX 中的 jpeg。该引擎并不是真正为从 JPG 收集所有必要的大小和比例信息而构建的。通常最好将 JPEG 文件转换为 PDF（在 Mac 上）或 EPS（在 PC 上）。Mac 上的 GraphicsConvertor 可以轻松为您完成。PDF 包含 DPI 和大小，而 JPEG 只有像素大小。

（我知道这不是您想要的答案，但最好给他们可以使用的 EPS/PDF，而不是担心他们尝试缩放您的 JPG 时会发生什么）。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-07-01T11:21:46.820

使用 .jpg 文件不要忘记直接编译为 .pdf ( *pdflatex* ) 并使用： 带有*pdftex选项的 graphicsx 包 (\usepackage[pdftex]{* *graphicx* })。

 ** * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-04-25T00:09:10.450

如果你有 Gimp，我看到以 .eps 格式导出图像就可以了。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-08T21:45:34.403

我使用 MacTex，我的编辑器是 TexShop。这可能与您使用的编译器有关。当我使用 pdftex 时，命令：

```
\includegraphics[height=60mm, width=100mm]{number2.png} 
```

工作正常，但是当我使用“Tex and Ghostscript”时，我得到了和你一样的错误，关于无法获得尺寸信息。使用 pdftex。

顺便说一句，您可以在 TexShop 中从“排版”菜单中更改它。

希望这可以帮助。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-06-15T17:22:30.510

在Mac（pdftex）上，我设法简单地包含了一个png文件

```
\includegraphics[width=1.2\textwidth]{filename.png} 
```

. *但*为了让它工作，我不得不注释掉以下 2 个包：

```
%\usepackage[dvips]{epsfig}

%\usepackage[dvips]{graphicx} 
```

...并简单地使用包graphicx：

```
\usepackage{graphicx} 
```

`[dvips]`与 pdftex 一起使用时似乎有问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-20T13:01:43.873

我遇到了同样的问题，这是由于包裹之间的冲突`graphicx`和包含经久不衰的包裹`epsfig`造成的......

请检查没有包含`epsfig`，它已被弃用。

# svn - 同步 SVN 服务器（在线和本地）

> ID：731939
> 
> 赞同：1
> 
> 时间：2009-04-08T21:31:42.143
> 
> 标签：svn, version-control

嘿。有没有一种简单的方法可以将我的本地 svn 服务器与在线服务器同步？这就是我想要做的：

我正在通过在线 svn repos 开展几个项目。但有时我会离开电网，但仍希望能够访问我所有的回购历史记录。我没有在我的系统上注册 svn 服务器的问题（或者，更准确地说，这是我可以做到的，没有我无法处理的问题），我希望它在更新时与在线服务器同步。可能的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T21:43:23.380

[git-svn](http://git-scm.com/docs/git-svn)可能会很好地满足您的需求（在非常相似的情况下它对我有用）。

如果您希望更接近您当前正在做的事情，您可能需要查看[svk](http://svk.bestpractical.com/view/HomePage)。

这里有很多[关于 SO 的问题](https://stackoverflow.com/questions/tagged/git-svn)，`git-svn`总的来说，很容易找到关于它的信息。

# biztalk - 在同步系统中协调数据

> ID：731943
> 
> 赞同：0
> 
> 时间：2009-04-08T21:32:13.673
> 
> 标签：biztalk, distributed, soa

我的情况是，一个 Oracle 系统是两个独立 CRM 系统（PeopleSoft 和 Siebel）的数据主控系统。Oracle 系统向 BizTalk 发送 CRUD 消息以获取客户数据、库存数据、产品信息和产品定价。BizTalk 格式化消息并将其转发到 PeopelSoft 和 Siebel Web 服务接口以供操作。在数据初始同步后，正在进行的操作造成了一种情况，即尽管数据已成功交付，但外围 Siebel 和 PeopleSoft 系统中的数据仍不准确（这是关于这些系统在返回“成功”时的含义的另一个对话' 到 BizTalk）。

在这种分布式的面向服务的方法中，其他类似的实现如何协调系统数据？他们是否从所有系统定期转储以进行比较？是否有任何其他技术或方法来发现失败的更新并确保同步？

感谢您的想法和经验。谢谢！

## 附加信息

那么为什么系统会不同步呢？当目标系统向 BizTalk 确认它已收到消息时，这意味着很多事情。有时 HTTP 200 意味着我已经得到它并将它放在临时表中，然后我会提交它。有时这是成功的，有时不是因为各种数据问题。有时 HTTP 200 意味着……是的，我已经收到并提交了数据。使用 HTTP，订单交付可能会出现问题。所有这些问题都可以通过预先进行大量的架构规划来解决。它没有完成。没有更新/创建时间戳来防止无序交付踩到数据。没有来自目的地系统的数据通信的完整往返确认。所有这些都导致事情变得不同步。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T17:49:33.323

（对不起，这是一个答案，而不是一个评论，我的得分高达 50 分）。

数据可以在其他系统中更新还是本质上是只读的？
您能否在 BizTalk 层中实现一些进一步的验证，以确保更新不会因为数据问题而失败？您能否从目标系统中获取更新失败的任何类型的通知，这将允许您在 BizTalk 层中进行补偿？

FWIW 在这种情况下，我通常最终得到一个中央数据存储，其中至少包含来自 3 个系统的数据密钥，充当数据的新黄金存储库，但这通常是为了补偿多个更新源。似乎我们通常也操作某种用户必须维护的手动错误队列。

对于您的批量对账的想法，我已经看到补偿交易错误非常普遍，尤其是在金融服务领域。

# asp.net - 将 HTML 转换为 PDF 时如何保持外观

> ID：731949
> 
> 赞同：3
> 
> 时间：2009-04-08T21:32:58.007
> 
> 标签：asp.net, itext, pdf-generation

我一直在使用 iTextSharp 进行 HTML 到 PDF 的转换，总体上它工作得很好，但它似乎不像大多数格式。

粗体、斜体和下划线都可以正常工作，但是，没有考虑字体大小、样式或其他信息，因此导出看起来与用于创建格式的 HTML 完全不同。

有谁知道如何

*   修复 iTextSharp 导出的方式（下面是我的代码示例）
*   或者知道提供此功能且不会破坏银行的不同产品？

这是我的代码：

```
//Do the PDF thing
Document document = new Document(PageSize.A4);
using (Stream output = new FileStream(Server.MapPath(relDownloadDoc), FileMode.Create, FileAccess.Write, FileShare.None))
using (Stream htmlStream = new FileStream(Server.MapPath(relProcessingDoc), FileMode.Open, FileAccess.Read, FileShare.Read))
using (XmlTextReader reader = new XmlTextReader(htmlStream))
{
    reader.WhitespaceHandling = WhitespaceHandling.None;
    PdfWriter.GetInstance(document, output);
    document.Open();
    Console.ReadLine();
    HtmlParser.Parse(document, reader);
    document.Close();
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-31T13:43:33.497

试试 WKHTMLTOPDF。

它是 webkit 的开源实现。两者都是免费的。

我们在[这里设置了一个小教程](http://beebole.com/en/blog/general/convert-html-to-pdf-with-full-css-support-an-opensource-alternative-based-on-webkit/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T22:11:54.450

从[使用 PHP 将 HTML + CSS 转换为 PDF？](https://stackoverflow.com/questions/391005/convert-html-css-to-pdf-with-php)我发现了[Prince XML](http://princexml.com/)，它有[许多语言](http://princexml.com/download/accessories/)的客户端，包括 .Net 平台。

它是一个特殊的转换器，虽然是商业的，而且不便宜。有一个关于它的[谷歌技术讲座](http://www.youtube.com/watch?v=vcXUrNSvjhU)。据称，[谷歌将它用于谷歌文档](http://www.absoluteastronomy.com/topics/Prince_XML)。它的渲染引擎也通过了 Acid2 测试。

如果您想要高质量的 HTML 到 PDF 的转换并且愿意花费大约 3800 美元购买服务器许可证，那就别无所求。坦率地说，我认为让其他任何事情来做普林斯所做的事情的时间成本将很快超过所涉及的成本。开发人员的时间很昂贵。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T21:59:40.127

我已经将[pd4ml](http://pd4ml.com/index.htm)用于一些事情。它似乎工作得很好。

这是 pd4ml 支持的列表 html 标签/属性：http: [//pd4ml.com/html.htm](http://pd4ml.com/html.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T23:45:00.733

单个服务器许可证的 ActivePDF 价格为 375 美元，并且做得非常好。我们以前在客户项目中使用过，效果很好。

[http://www.activepdf.com/products/serverproducts/webgrabber/index.cfm](http://www.activepdf.com/products/serverproducts/webgrabber/index.cfm)

**编辑**：没关系，这取决于他们另一款售价 1,400 美元的产品。认为它会比其他一些建议便宜。经过几分钟的研究，我们得出了以下替代方案：

500 美元以下：

[http://www.websupergoo.com/abcpdf-1.htm](http://www.websupergoo.com/abcpdf-1.htm)（您需要专业版以保持尽可能多的格式）。

# java - EJB 和 FLEX

> ID：731950
> 
> 赞同：1
> 
> 时间：2009-04-08T21:32:59.083
> 
> 标签：java, apache-flex, ejb-3.0, integration, blazeds

我正在使用 EJB3 -> BlazeDS -> Flex 开发一个新应用程序。我找不到很好的例子来了解如何将 EJB 与 BLAZEDS 集成。有人可以给我一些关于如何将它们链接在一起的指示。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T21:49:18.093

您需要[EJB 和 Flex 集成 v1.1](http://www.adobe.com/cfusion/exchange/index.cfm?event=extensionDetail&extid=1089970)。

它可以与 BlazeDS 或 LCDS 一起使用，并支持远程和本地 EJB。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T21:40:02.967

BlazeDS 本质上是一个 Tomcat 服务器。Tomcat 并不完全支持 J2EE，但它确实支持一些 JNDI。您可以将 EJB 放入 WEB-INF/web.xml 和 META-INF/context.xml

这是 Tomcat 关于使用 bean 的文档：[JNDI 资源](http://www.mbaworld.com/docs/jndi-resources-howto.html)

编辑：为 Glassfish 找到这个 -> BlazeDS -> Flex: [Flex-BlazeDS-and-GlassFish](http://anachronymous.com/2009/01/flex-blazeds-and-glassfish-part-1.html)

# ajax - 请求多个回复

> ID：731956
> 
> 赞同：0
> 
> 时间：2009-04-08T21:34:14.743
> 
> 标签：ajax, httpwebrequest

我想创建一个 Web 应用程序。

在某些情况下，用户的请求会导致刷新 2-3 个甚至更多容器中的内容。最干净的方法是按顺序一个接一个地运行请求并一个一个地处理结果。如果可能的话，我只想有一个请求，并收集所有响应结果。

例如：假设有一个主容器（M），还有一些其他（较小的）容器（A、B、C 等）

简单的方法是：从服务器请求 M 的主要功能，在 M 容器中显示它

从 A_container 专用服务器获取一些其他内容，在 A_container 中显示 从 B_container 专用服务器获取一些其他内容，在 B_container 中显示 从 C_container 专用服务器获取一些其他内容，在 C_container 中显示

根据用户请求的主要功能，只有一些容器需要刷新它的内容，而不是全部。

我想尽量减少请求的数量。实际上将其最小化为一个。当然，也可以通过 Json 或 XML 来完成。

我想收集来自服务器的所有响应，封装它们（A_container：“这是 A_container 的内容”，C_container：“C_container 的其他内容”），并将其发送回客户端，客户端将在其中解压缩它，并且关于内容，它会将它们中的每一个委托给适当的容器。

我的问题是，当您知道返回的数据非常多变时，您会怎么做：在某些情况下，它甚至可能包含 html 元素、引号、双引号等。如果我没记错的话，在某些特殊情况下这也可能搞砸 Json 和 xml。

我的想法是用特殊的分隔符来划分不同的内容（现在只是一个简单的例子，让我们使用 xxx 和 yyy）。这是一个非常难看的解决方案，但如果分隔符足够独特，你不能肯定地搞砸内容。

之前的类似 Json 的解决方案如下所示：“A_containeryyythis is content for A_containerxxxC_containeryyyOther content for C_container”

然后在客户端首先将代码按 xxx 拆分，在这种情况下，这将导致两个数组元素（字符串），将由 yyy 再次拆分。第一个元素将给出容器的 id，第二个元素给出它的内容。在此之后，最后一步将遍历新数组，并将结果显示在适当的容器中。

有没有人会为此提出一个更好的方法，或者谁能展示一种在 Json 或 XML 等中执行此操作的安全方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T21:48:42.557

> 之前的类似 Json 的解决方案如下所示：“A_containeryyythis is content for A_containerxxxC_containeryyyOther content for C_container”

这看起来更像是来自服务器的“文本/纯文本”响应，您将通过 javascript 拆分处理。你真正想做的是从服务器返回一个 json 对象，例如

```
object = {'A container content','etc','etc','etc'} 
```

然后使用 eval(object) 从客户端使用 javascript 评估它。从那里我会填充你的每个“容器”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T23:17:27.990

Format your request using XML:

```
<response>
    <m>Content</m>
    <a>Content</a>
    <b>Content</b>
    <c>Content</c>
</response> 
```

Then parse the XML in your XMLHttpRequest callback:

```
var xmldoc = req.responseXML;
var root = xmldoc.getElementsByTagName('response').item(0);
var contentm = root.getElementsByTagName('m');
var contenta = root.getElementsByTagName('a');
var contentb = root.getElementsByTagName('b');
var contentc = root.getElementsByTagName('c');
if (contentm) {
  /* Update Container M */
}
if (contenta) {
  /* Update Container A */
}
if (contentb) {
  /* Update Container B */
}
if (contentc) {
  /* Update Container C */
} 
```

# c++ - C++ 中每个语句的 Emacs 缩进

> ID：731959
> 
> 赞同：1
> 
> 时间：2009-04-08T21:35:17.957
> 
> 标签：c++, emacs, foreach, indentation

我试图让emacs正确格式化C++中的“for each”构造。

在以下两个示例中，我希望大括号与`f`in对齐：`for`

```
for each(Type a in b)
        { //^c^s shows substatement-open
            //... do stuff
        }

for( ; ; )
{ //^c^s shows substatement-open
    //... do stuff
} 
```

在这两种情况下，使用 [Ctrl-c Ctrl-s]（或 [Ctrl-c Ctrl-o]）显示两个开头的 { 字符都是类型`substatement-open`，并且在查看时`c-offsets-alist`我看到`substatement-open`等于 0。

如何使 emacs 缩进`for each()`命令类似于它如何缩进`for(;;)`命令？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T21:45:33.047

大概emacs没有将“ `for each`”识别为c ++语法（我也不识别。这是微软扩展吗？预处理器黑客？即将到来的标准的新功能？）。所以难怪它没有“正确”地格式化它。

您可以破解该模式，或询问相同的维护者（不过，我不希望得到积极的回应，除非这将是正确的 c++ 现在很快）。

* * *

**从评论**我的括号问题的答案是：

*   OP 询问的确切形式是 Microsoft managed-c++ 扩展。
*   现在有`BOOST_FOREACH`可用的
*   C++0x 支架将包括一个容器范围的循环，其语法如下`for( <type> <loopcounter> : <container> )`

从[slink 的回答](https://stackoverflow.com/questions/731959/emacs-indentation-of-the-for-each-statement-in-c/733354#733354)看来，模式维护者在最新版本中支持 Microsoft 语法......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T08:45:10.340

对我来说——在 Emacs 23.0.91 下——`c++-mode`缩进`for each`块，因为它是一个正常的`for`循环。

# c++ - 函子定义中的函数

> ID：731971
> 
> 赞同：0
> 
> 时间：2009-04-08T21:40:34.353
> 
> 标签：c++

我有以下仿函数用于重新定义向量类型的 sort 方法的 less 运算符：

```
typedef vector< vector<int> > MxInt2d;
typedef vector< vector<double> > MxDouble2d;

class QSweep{   
public:
....
static MxDouble2d myPoints_;
    MxDouble2d myEdges_;

class order{
public:
    bool operator() (const vector<int>& edge1, const vector<int>& edge2){
        //std::cout<<"inside sort"<<endl;
        //3 sort criteria
        return (myPoints_[edge1[0]][0]<myPoints_[edge2[0]][0])|| 
                           (myPoints_[edge1[0]][0]==myPoints_[edge2[0]][0]&& 
                            myPoints_[edge1[0]][1]<myPoints_[edge2[0]][1]) 
               ||
                (myPoints_[edge1[0]][0]==myPoints_[edge2[0]][0]&& 
                             myPoints_[edge1[0]][1]==myPoints_[edge2[0]][1]&& 
                 getSlope(myPoints_[edge1[0]][0],myPoints_[edge1[0][1],  
                                      myPoints_[edge1[1]][0],myPoints_[edge1[1]][0])
                 <
                             getSlope(myPoints_[edge2[0][0],myPoints_[edge2[0][1],    
                                      myPoints_[edge2[1]][0],myPoints_[edge2[1]][0]));
            }
};
static double getSlope(double a, double b, double c, double d);

}; 
```

其中 getSlope 是以下列方式定义的函数：

```
double QSweep::getSlope(double a, double b, double c, double d){
double slope=0.0;
//std::cout<<"slope criteria"<<endl;
double denum=c-a;
if (denum==0){
    std::cout<<"zero denominator"<<endl;
}
else{
    slope=(d-b)/denum;
}
return slope;
} 
```

每个点由索引、x 和 ay 坐标给出；每条边由 source-edge[0] 和 destination-edge[1] 给出，其中 edge[0],edge[1] 是点的索引）。我想排列边缘： - 通过它们的边缘 [0] 坐标的 x 坐标（如果 2 个边缘的 x 不同） - 通过它们的边缘 [0] 坐标的 y 坐标（如果 2 个边缘的 x 相等) - 通过它们相应的斜率（如果边缘的 x 和边缘的 y 相等）。

我将 getSLope 函数声明为静态的，但是当我对边缘进行排序时

```
 sort(myEdges_.begin(),myEdges_.end(),order()); 
```

最后一个条件没有满足。如果我有两条边，edgep[0] 的 x 和 y 相同，但斜率不同，例如 slope(edge1)=1 ,slope(edge2)=1/2 比我想要得到 [edge2, edge1]; 相反，我得到 [edge1，edge2]。所以我的 getSlope 标准没有计算出来。

是因为我声明 getSlope 是静态的吗？我应该改变什么才能满足标准？提前感谢您的建议，马达琳娜

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T21:49:48.107

坏蛋！它看起来很复杂，首先您是否尝试过使用一组不太复杂的值来计算 - 即我看到您有 cout 语句，我相信它们在您运行时可以正常工作？

如果是这样，那么您对 ​​getSlope 的输入是否错误 - 不应该

```
getSlope(myPoints_[edge2[0][0],myPoints_[edge2[0][1],    
         myPoints_[edge2[1]][0],myPoints_[edge2[1]][0]) 
```

是

```
getSlope(myPoints_[edge2[0][0],myPoints_[edge2[0][1],    
         myPoints_[edge2[1]][0],myPoints_[edge2[1]][1]) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T21:47:53.057

可能是因为没有它就可以计算表达式结果。
例如：

```
false && someFunction(); - function will not be called
true || someFunction(); - function will not be called 
```

这是一个很好的规则，它允许我们接下来写：

```
if ( ptr && ptr->someMethod() ) 
// call method will not be called for NULL pointers 
```

# c# - 如果 Sql Server 返回错误，则应抛出 SqlException。但它不是

> ID：731974
> 
> 赞同：1
> 
> 时间：2009-04-08T21:41:36.770
> 
> 标签：c#, asp.net, gridview, ado.net

如果我将 GridView 绑定到 SqlDataSource 并将 AutoGenerateEditButton 设置为 true，然后我尝试更新一个字段（该字段是数据库中的主键），那么数据库应该返回一个错误，因此应该抛出 SqlException？！那么为什么page不报告异常呢？相反，Gridview 所做的只是将该行中的所有字段设置回其原始值。

谢谢

编辑：

你好，

当我使用以下代码执行相同的更新语句时，我得到了*Cannot update identity column 'EmployeeID' exception*，所以我假设 Sql Server 在 GridView 尝试更新时确实报告了相同的错误，但由于某种原因没有引发异常：

```
 SqlConnection sc = new SqlConnection();
        sc.ConnectionString = @"Data source=localhost; integrated security=sspi; initial catalog=northwind;";
        SqlCommand sComand = new SqlCommand();

        sComand.Connection = sc;
        sComand.CommandText = "update Employees set EmployeeId=100,FirstName='Suzy',"+ 
                   "LastName='Smile',City='Moon' where EmployeeId=1";
        sc.Open();
        int I = sComand.ExecuteNonQuery(); 
```

第二次编辑：

> 您的 DataKeyNames 属性设置是否正确？

我尝试设置 DataKeyNames="EmployeeId"，但仍然没有引发异常

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T21:44:22.347

如果您的 SQL 查询返回结果，则 C# 将获得该结果。如果您的 SQL 查询引发异常，则 C# 将获得该异常。你不能在这里混搭，它不是衣柜。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T22:03:10.337

仅当 T-SQL 中的 ERROR 严重性为 16 或更高 AFAIK 时才会引发异常。因此，并非所有错误在 SQL Server 中都是相同的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T22:22:33.817

您实际上应该能够修改主键而不会出错，只要它不会导致重复。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T23:04:36.727

Is your [DataKeyNames property](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.datakeynames.aspx) set correctly?

# c# - 如何将相对鼠标移动发送到另一台电脑

> ID：731979
> 
> 赞同：2
> 
> 时间：2009-04-08T21:42:01.153
> 
> 标签：c#, controls, mouse, hook

我捕获 Windows 鼠标移动事件并计算相对鼠标移动以将其发送到另一台电脑。到目前为止一切顺利，效果很好。

但是，如果我阻止发送鼠标坐标（客户端）的屏幕上的鼠标移动或到达屏幕的一侧，则 Windows api 会触发第二个鼠标事件，该事件会将鼠标弹回。

我的第一个想法是记录相对运动并忽略每一个“倒转”运动。但我正在寻找更好的方法。

首先我打电话：

```
Cursor.Position = new Point(0, 0);

    void HookManager_MouseMoveExt(object sender, MouseEventExtArgs e)
    {
        Logger.Log(String.Format("Pos: {0} {1} Delta: {2} {3}", e.X, e.Y, e.DeltaX, e.DeltaY), LogLevel.Info);

        if (hasControl)
            server.MouseMove(e.DeltaX, e.DeltaY, true); // send the coordinates to the client

        e.Handled = true; // Don't move the mouse
    } 
```

现在我启动应用程序并将鼠标移动到左上角方向。我只想接收负增量，但会发生这种情况：

```
09.04.2009 00:29:31 <10> Pos: 0 -1 Delta: 0 -1
09.04.2009 00:29:31 <10> Pos: -1 0 Delta: -1 0
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: 0 -1
09.04.2009 00:29:31 <10> Pos: 0 0 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -1 0 Delta: -1 0
09.04.2009 00:29:31 <10> Pos: 0 -1 Delta: 0 -1
09.04.2009 00:29:31 <10> Pos: -1 0 Delta: -1 0
09.04.2009 00:29:31 <10> Pos: 0 -1 Delta: 0 -1
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: -1 0
09.04.2009 00:29:31 <10> Pos: -1 0 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: 0 0 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: -1 -1
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -1 0 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: 0 -1
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -2 -1 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: 1 0 // Here it starts to snap back first time
09.04.2009 00:29:31 <10> Pos: -1 0 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: 0 -1
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -2 -1 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -2 -1 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -2 -1 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -1 -2 Delta: 1 0
09.04.2009 00:29:31 <10> Pos: -3 -1 Delta: 0 1
09.04.2009 00:29:31 <10> Pos: -2 -2 Delta: 1 0
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: 1 1
09.04.2009 00:29:31 <10> Pos: -3 -1 Delta: 0 0
09.04.2009 00:29:31 <10> Pos: -1 0 Delta: 2 0
09.04.2009 00:29:31 <10> Pos: 0 -1 Delta: 0 -1
09.04.2009 00:29:31 <10> Pos: -1 -1 Delta: -1 0
09.04.2009 00:29:32 <10> Pos: -1 0 Delta: 0 0
09.04.2009 00:29:32 <10> Pos: 0 0 Delta: 0 0
09.04.2009 00:29:32 <10> Pos: -1 -1 Delta: -1 -1
09.04.2009 00:29:32 <10> Pos: -1 -1 Delta: 0 0
09.04.2009 00:29:32 <10> Pos: -1 0 Delta: 0 0
09.04.2009 00:29:32 <10> Pos: 0 -1 Delta: 0 -1
09.04.2009 00:29:32 <10> Pos: -1 0 Delta: -1 0
09.04.2009 00:29:32 <10> Pos: 0 -1 Delta: 0 -1
09.04.2009 00:29:32 <10> Pos: -1 0 Delta: -1 0
09.04.2009 00:29:32 <10> Pos: 0 -1 Delta: 0 -1
09.04.2009 00:29:32 <10> Pos: -1 -1 Delta: -1 0
09.04.2009 00:29:32 <10> Pos: -1 0 Delta: 0 0
09.04.2009 00:29:32 <10> Pos: -1 -1 Delta: 0 -1
09.04.2009 00:29:32 <10> Pos: -1 0 Delta: 0 0
09.04.2009 00:29:32 <10> Pos: -2 -2 Delta: 0 -2
09.04.2009 00:29:32 <10> Pos: 0 0 Delta: 2 2
09.04.2009 00:29:32 <10> Pos: -1 0 Delta: -1 0
09.04.2009 00:29:32 <10> Pos: 0 -1 Delta: 0 -1
09.04.2009 00:29:32 <10> Pos: -1 0 Delta: -1 0
09.04.2009 00:29:32 <10> Pos: -1 -1 Delta: 0 -1
09.04.2009 00:29:33 <10> Pos: -1 -1 Delta: 0 0
09.04.2009 00:29:36 <10> Pos: -1 -1 Delta: 0 0
09.04.2009 00:29:36 <10> Pos: -2 -2 Delta: 0 0
09.04.2009 00:29:36 <10> Pos: -5 -5 Delta: -3 -3
09.04.2009 00:29:36 <10> Pos: -5 -4 Delta: 0 1
09.04.2009 00:29:36 <10> Pos: -6 -6 Delta: -1 -2
09.04.2009 00:29:36 <10> Pos: -8 -7 Delta: -2 -1
09.04.2009 00:29:36 <10> Pos: -8 -7 Delta: 0 0
09.04.2009 00:29:36 <10> Pos: -14 -11 Delta: -6 -4
09.04.2009 00:29:36 <10> Pos: -20 -17 Delta: -6 -6
09.04.2009 00:29:36 <10> Pos: -26 -25 Delta: -6 -8
09.04.2009 00:29:36 <10> Pos: -33 -25 Delta: -7 0
09.04.2009 00:29:36 <10> Pos: -36 -31 Delta: -3 -6
09.04.2009 00:29:36 <10> Pos: -39 -31 Delta: -3 0
09.04.2009 00:29:36 <10> Pos: -38 -29 Delta: 1 2
09.04.2009 00:29:36 <10> Pos: -38 -24 Delta: 0 5
09.04.2009 00:29:36 <10> Pos: -33 -24 Delta: 5 0
09.04.2009 00:29:36 <10> Pos: -28 -21 Delta: 5 3
09.04.2009 00:29:36 <10> Pos: -27 -18 Delta: 1 3
09.04.2009 00:29:36 <10> Pos: -22 -16 Delta: 5 2
09.04.2009 00:29:36 <10> Pos: -19 -12 Delta: 3 4
09.04.2009 00:29:36 <10> Pos: -16 -11 Delta: 3 1
09.04.2009 00:29:36 <10> Pos: -14 -8 Delta: 2 3
09.04.2009 00:29:36 <10> Pos: -11 -8 Delta: 3 0
09.04.2009 00:29:36 <10> Pos: -8 -5 Delta: 3 3
09.04.2009 00:29:36 <10> Pos: -8 -5 Delta: 0 0
09.04.2009 00:29:36 <10> Pos: -4 -2 Delta: 4 3
09.04.2009 00:29:36 <10> Pos: -3 -3 Delta: 1 -1
09.04.2009 00:29:36 <10> Pos: -1 0 Delta: 2 3 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T22:20:33.353

我实际上无法回答您的问题，但是您知道开源程序[Synergy](http://synergy2.sourceforge.net/)吗？

它会做你想做的事情——也许你可以看看源代码以获取提示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T21:46:09.927

我不确定您要做什么的细节，但为什么不尝试将光标剪辑到屏幕的一小部分并使其不可见。然后每次检测到移动时，将客户端的光标移回该剪切框的中心。因此，您每次都在计算从同一屏幕上的点开始的相对运动。

这就是 PC 模拟器 Bochs 所做的（几乎——它不会将光标剪辑到窗口上）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T23:02:11.443

得到了我的解决方案，基于盒子方法。MouseSimulator.Position 只是做：

```
 Cursor.Position = new Point(value, Y); 
```

HookManager_MouseMoveExt 是我的回调。MouseEventExtArgs 只是扩展的 MouseEventArgs，添加了诸如 deltas 之类的功能。

```
 private bool ignoreNext = false;
        void HookManager_MouseMoveExt(object sender, MouseEventExtArgs e)
        {
            // Should we block all mouse interactions?
            if (Block) {
                e.Handled = true;
                return;
            }

            // Return if we should ignore the nex, because we made a big jump
            if (ignoreNext) {
                ignoreNext = false;
                return;
            }

            if (hasControl) 
            {
                // Lock the mouse to 100,100 : 200,200 and flip back to 150,150 if out of bounds
                if (e.X < 100 || e.X > 200 || e.Y < 100 || e.Y > 200) // Box leaved
                {
                    // If we leave the box, we set the position to the center 
                    // and set the event to handled otherwise the mouse is free
                    MouseSimulator.Position = new System.Drawing.Point(150, 150);
                    e.Handled = true;
                    ignoreNext = true;
                }

                // We moved fine, send the delta to the server
                // The MouseSimulator.Position change will not be visible yet.
                server.MouseMove(e.DeltaX, e.DeltaY, true);

            }

            Logger.Log(String.Format("Pos: {0} {1} Delta: {2} {3}", e.X, e.Y, e.DeltaX, e.DeltaY), LogLevel.Info);
        } 
```

# .net - ADO.NET Entity Framework 和 NHibernate - 何时使用其中一个

> ID：731981
> 
> 赞同：5
> 
> 时间：2009-04-08T21:42:26.970
> 
> 标签：.net, nhibernate, entity-framework, orm

我在 Microsoft .NET 商店工作，可以使用 NHibernate 或 ADO.NET EF。当你应该选择一个而不是另一个时，我们应该使用什么指导？

例如，在编写 Silverlight 应用程序时，似乎 EF -to-> ADO.NET Data Services -to-> Silverlight 会提供生产力提升，并为您提供 REST 服务 API，无需额外工作。

还有哪些其他事情可以帮助您逐个应用地指导您？

**更新（基于评论）：** 这个有点用[Nhibernate 与其他 ORM 的区别是什么？](https://stackoverflow.com/questions/658824)其他人则陷入奇怪的切线（如 SubSonic），并且不直接比较两者。我想我是专门寻找同时使用这两种方法的人，并逐个项目决定他们将使用哪一个。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T22:41:39.137

简而言之，EF 没有开箱即用的 Persistence Ignorance 支持。去年我第一次尝试使用 EF 构建解决方案时，我有点恼火的是你的应用程序中不能有 POCO。我希望与我的模型有更高程度的解耦，所以我最终切换到 NHibernate。从那以后，有人写了一个 EF POCO 适配器。 [http://code.msdn.microsoft.com/EFPocoAdapter](http://code.msdn.microsoft.com/EFPocoAdapter) - 但是它实际上只是一个代码生成器，它生成一个适配器层来映射您的对象。

出于某种原因，我的应用程序在 NHibernate 下也运行得更快了。对此持保留态度，因为我对配置这两种解决方案都不熟悉。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T23:02:44.063

Microsoft 最近开始开发一种新的解决方案，称为[.NET Ria Services](http://www.microsoft.com/downloads/details.aspx?FamilyID=76bb3a07-3846-4564-b0c3-27972bcaabce&displaylang=en)（目前），它将是“独立于 ORM”的，用于从位于服务器上的业务逻辑层将数据输入和输出 Silverlight。

他们已经公开提到（甚至在 MIX 的幻灯片上）NH*将*在这里得到支持。

如果您正在寻找获得最多社区支持的解决方案，NHibernate 绝对是您的最佳选择。我承认它有一个陡峭的学习曲线，但根据我的经验，它肯定是值得的。只需对“实体框架”和“休眠”进行比较搜索，您就会明白我的意思。大多数 EF 的东西将是“新闻”，而 NHibernate 的东西实际上将是深入人心的技术、血腥细节。和问题。被回答。

但正如其他海报所提到的 - 我相信实体框架会随着时间的推移而改进。但就目前而言，我相信他们正试图用一个工具集解决太多问题。NHibernate 只做一件事，但做得非常好。

这里还有应用程序设计的问题。EF 似乎（在其当前的化身中）旨在将数据库传递给 C# 应用程序。NHibernate 则相反，它使对象模型更容易持久化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T22:56:25.733

我现在可能会完全避免使用实体框架。有名声[的不信任投票，](http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/)更不用说它不像 NHibernate 那样成熟。

话虽如此，我将继续评估实体框架，因为我确信它会随着时间的推移而得到改进。

# performance - 在性能（和分类）方面，分层数据与相关数据的优缺点是什么？

> ID：731983
> 
> 赞同：6
> 
> 时间：2009-04-08T21:42:36.190
> 
> 标签：performance, database-design, tags, hierarchy

这与[这个问题有关](https://stackoverflow.com/questions/728593/what-would-be-the-best-way-to-design-database-and-relationships-for-a-website-lik)。它让我想到，例如，[这本书](http://cgi.ebay.com/2009-Farm-Equipment-Guide_W0QQitemZ400041074215QQcmdZViewItemQQptZLH_DefaultDomain_0?hash=item400041074215&_trksid=p3286.c0.m14&_trkparms=72%3A1205%7C66%3A2%7C65%3A12%7C39%3A1%7C240%3A1318%7C301%3A1%7C293%3A1%7C294%3A50)。与其在树和中分别成为`[Agriculture]`和的子级，不如将这些级别作为标签独立存在。`[Other]``[Books > Catalogs > Agriculture]``[Business & Industrial > Agriculture & Forestry > Other]`

在像 eBay 这样的网站中，如果数据被正确规范化，列出所有带有**标签** `[Agriculture`AND的记录的性能成本是否会`Catalog]`大大超过列出该`[Books > Catalogs > Agriculture]` **类别中的所有记录的性能成本？**

我意识到这可能是一个愚蠢的问题（不，我不认为我正在为下一个 eBay 编程），但我无法摆脱这种好奇心，更糟的是；*诱惑*；_ 所以我宁愿现在听起来很愚蠢，并很好地理解我的误解，而不是以后做一些愚蠢或毫无意义的事情。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-08T22:28:15.533

当关系模型第一次出现时，占主导地位的数据库范式是分层的。然后（仍然如此）分层更有效，因为从本质上讲，您可以从部分预连接查询开始。

但仅基于一种静态层次结构。当您想将数据视图从另一个根维度弯曲时，就会出现很大的困难。（关系数据库在实际使用中是否足够高效，这是一个激烈争论的问题；很快通过摩尔定律的勤奋应用得到解决。）

想想拥有包含产品的订单的客户；一个层次结构。不可避免地，您还希望能够考虑将在客户订单中找到的产品；整个其他层次结构。以及从客户那里生成订单的区域销售人员；或让客户下订单。

关系数据库使您能够以大致相同的效率随意重构层次结构；以嵌入多个正交层次结构为代价的仅在其他数据库格式中可用的好处；在这种情况下，更改、添加或删除数据的成本将是天文数字。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T22:05:25.200

关系模型的主要目的是防止重复。分层数据虽然更容易手动挖掘，但存在重复问题。

使用最适合您的数据的模型，而不是过早地进行优化。

我倾向于从关系数据中构建表现层次树。

# java - 部分bean序列化和反序列化+合并

> ID：731989
> 
> 赞同：3
> 
> 时间：2009-04-08T21:43:36.127
> 
> 标签：java, xml, json, serialization

我正在开发一个 RESTful Web 服务。

我有一堆实体类（主要是 JPA 实体，还有其他 bean）。

有大量的对象映射、序列化、绑定和诸如此类的库。我正在寻找一个能够让我：

*   **将实体序列化为 XML 和 JSON**

    序列化必须支持使用**getters**，而不仅仅是对象字段。

    它必须支持**视图**。视图是指一种指定要序列化的实体属性子集的方法。例如，请参阅在 Yahoo! 中[检索部分资源](http://developer.yahoo.com/social/rest_api_guide/partial-resources.html) 社交平台 API。我也不希望它无限深地递归：

    视图应该定义 a) 要在实体中公开的属性和 b) 每个属性的视图（如果它们本身就是实体）。

    例如，实体`Person`可能具有视图`full`和`simple`. 当请求 a 的`simple`视图时，`Person`只有 properties`id`和会被序列化。请求视图时，属性和（它们本身）也将被序列化，但仅限于视图（因此它不会递归到祖父母）。`firstName``lastName``full``mother``father``Persons``simple`

    JSON 序列化必须是**“自然的”**，即在 Javascript 中有意义。这意味着我想要正确的整数、布尔值和空值，并且我不想要额外的对象包装器或试图捕获整个 XML 信息集的东西。

    对于 XML，必须可以将序列化配置为使用**空元素**来序列化 null，而不是 XML Schema 的`xsi:nil="true"`属性。

    此外，数组必须使用嵌套元素进行序列化，以便区分空数组和给定视图中不存在的属性：

    *   未定义`friends`的属性（视图中不存在）：

        ```
        <person>
        </person> 
        ```

    *   空数组，人没有朋友：

        ```
        <person>
            <friends></friends>
        </person> 
        ```

*   **反序列化 XML 和 JSON 并将数据合并到现有实体中**

    现在这是困难的部分。接下来的两个是连接的：

    **必须可以对部分对象**进行反序列化（类似于视图，但未预先定义存在哪些属性）。

    **合并**到现有属性中，而不是创建新属性。

    这有点难以解释。大多数库都反序列化为 Java 对象，但在那个时候，未定义属性和空/空属性之间的区别（因为它存在于 Javascript/JSON、上述 XML、PHP 等中）已经丢失。

    收到此 XML 时：

    ```
    <person>
        <lastName>Bon Jovi</lastName>
        <friends></friends>
    </person> 
    ```

    并被传递一个`Person`对象，库应该：

    ```
    person.setLastName("Bon Jovi");
    person.setFriends(new ArrayList()); 
    ```

    例如，它不应该接触实体`firstName`和/或清除它`father`。

    当然，对于列表，这应该更复杂。我希望配置一个 id 属性，通过它来决定是更新嵌套实体还是创建一个新实体。

    这些更新/补丁是库不能只返回 DTO 的一个原因：因为那时 a`null`可能意味着“未设置”或“什么都不做”。

嗯，就是这样。我一直在说“必须”很多，我现在意识到 :) 库实际上不需要提供它，但必须有一种方法以一种干净的方式添加功能（= 不是以一种会重写所有内容的方式更轻松）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T13:22:38.880

I don't know of existing libraries that do everything you need, but, assuming you're going to need to implement something:

*   Writing XML or JSON based on bean properties is pretty simple:

    *   Look at using Apache Commons BeanUtils to be able to get all property values ([http://commons.apache.org/beanutils/](http://commons.apache.org/beanutils/)). In particular, the PropertyUtils class.
    *   Use BeanUtils recursively to walk your entire object graph - be careful of cycles - you'll need a Set or something on the side to keep track of what you've already seen
    *   XML: Look at XMLEncoder - it works using JavaBean properties to create XML
*   For reading: One approach might be to use existing libs (for JSON or XML) to create objects then deal with merging the properties between objects. The XMLDecoder class can read bean XML (assuming you create it using XMLEncoder). The tricky part to this approach is to know when a value has been "set" to null vs just not been set in the XML. This approach also has the extra overhead of creating a bunch of new objects.

*   Otherwise, reading JSON or XML is a little trickier, but not too bad

    *   I assume you already have some means of indexing the objects you want to merge into (like a Map of some sort)
    *   I assume you already have some means to know which property is the key that uniquely identifies an object (I assume last name is just to get the point across, as it would make a bad key)
    *   XML: For this type of use, I'd recommend a SAX reader for the xml - you'll need a stack to keep track of which objects you're adding data to. The SAX reader tells you what tags are seen and then gives the values for those tags. You could also use XML pull here, which tends to be a little faster
    *   JSON: take a look at some of the open source JSON libraries and do some tweaking. JSON is pretty simple to parse, and these tools tend to be pretty small so this shouldn't be a big deal. Alternatively, you could write an ANTLR (or other generator) parser to read the JSON and do with it as you like.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-13T00:39:50.343

对于它的价值，[杰克逊](http://jackson.codehaus.org)有部分更新开箱即用：

```
ObjectMapper mapper = new ObjectMapper();
Bean existing = ...;
mapper.updatingReader(existing).readValue(jsonSource); 
```

它还可以转换兼容的类型（类似于序列化为 JSON，读回不同的类型）。

对于 XML 部分，您可以使用 JAXB，尽管据我所知它只能完成绑定。

# python - 多处理还是多线程？

> ID：731993
> 
> 赞同：24
> 
> 时间：2009-04-08T21:44:44.173
> 
> 标签：python, multithreading, multiprocessing, multicore, python-stackless

我正在制作一个程序，用于在 Python 中运行模拟，带有 wxPython 接口。在程序中，您可以创建一个模拟，程序会为您渲染（=计算）它。渲染有时会非常耗时。

当用户开始模拟并定义初始状态时，我希望程序在后台连续渲染模拟，而用户可能在程序中做不同的事情。有点像一个充满了 YouTube 风格的栏：您只能播放模拟到渲染的点。

我应该使用多个进程或多个线程还是什么？人们告诉我要使用这个`multiprocessing`包，我检查了一下，它看起来不错，但我也听说进程与线程不同，不能共享很多信息（我认为我的程序需要共享很多信息。 ) 此外，我还听说过 Stackless Python：它是一个单独的选项吗？我不知道。

请指教。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-08T22:21:29.217

**“我查了一下，看起来不错，但我也听说进程不像线程，不能共享很多信息……”**

这只是部分正确。

线程是进程的一部分——线程共享内存微不足道。这既是一个帮助问题，也是一个问题——两个随意忽视彼此的线程可能会覆盖内存并产生严重的问题。

然而，进程通过许多机制共享信息。Posix 管道 ( `a | b`) 意味着进程 a 和进程 b 共享信息——a 写入它，b 读取它。这对很多事情都非常有效。

操作系统将在您创建进程时尽快将进程分配给每个可用内核。这对很多事情都非常有效。

Stackless Python 与本次讨论无关——它更快并且具有不同的线程调度。但我不认为线程是最好的途径。

**“我认为我的程序需要分享很多信息。”**

你应该先解决这个问题。然后，确定如何围绕信息流构建流程。一个“管道”是很容易和自然的；任何外壳都会轻松创建管道。

“服务器”是另一种架构，其中多个客户端进程获取和/或将信息放入中央服务器。这是共享信息的好方法。您可以使用 WSGI 参考实现来构建简单、可靠的服务器。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-08T22:22:13.757

*   **无堆栈**：使用 1 个 CPU。“小任务”必须自愿让步。抢占选项并非始终有效。
*   **线程**：使用 1 个 CPU。在运行 20-100 个 python 操作码后，本机线程会随机共享时间。
*   **多处理**：使用多个 cpu

**更新**

深入分析

轻松使用螺纹。但是，如果您调用需要很长时间才能返回的 C 例程**，**那么如果您的 C 例程不释放锁，这可能不是一个选择。

如果CPU 功率**非常**有限并且您需要最大的响应能力，请使用多处理。

不要使用无堆栈，我之前有过段错误，除非你使用数百个或更多线程，否则线程几乎是等效的。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-04-09T01:21:33.620

今年在 Pycon 上有一个关于多处理的精彩演讲。外卖消息是“仅使用多处理，除非你确定你有一个问题可以解决，不能用线程解决；否则，使用线程。”

进程有很多开销，所有要在进程之间共享的数据都必须是可序列化的（即pickleable）。

您可以在此处查看幻灯片和视频：http: [//blip.tv/pycon-us-videos-2009-2010-2011/introduction-to-multiprocessing-in-python-1957019](http://blip.tv/pycon-us-videos-2009-2010-2011/introduction-to-multiprocessing-in-python-1957019)

~~[http://us.pycon.org/2009/conference/schedule/event/31/](http://us.pycon.org/2009/conference/schedule/event/31/)~~

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-08T22:48:35.970

进程有自己的内存空间。它使共享信息变得更加困难，但也使程序更安全（更少需要显式同步）。也就是说，进程可以在只读模式下共享相同的内存。

线程创建或终止的成本更低，但主要区别在于它与同一进程中的其他线程共享内存。这有时是有风险的，此外，使进程崩溃会杀死所有线程。

在多个线程上使用多个进程的一个优点是可以更轻松地扩展您的程序以与通过网络协议进行通信的多台机器一起工作。

例如，您可能会在 8 台双核机器上运行 16 个进程，但不会从四核机器上超过 4 个线程中受益。如果您需要传达的信息量很少，那么多处理可能更有意义。

至于您所描述的 youtube 风格，我想说的是多处理。如果您遵循 MVC 方法，您的 GUI 不应该还包含模型（计算结果）。使用多进程，您可以与可以报告哪些数据已经可用的工作经理进行通信。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-08T22:41:01.183

[由于 GIL: link text](http://en.wikipedia.org/wiki/Global_Interpreter_Lock)，使用 CPython 多个线程不能同时执行。

我认为线程仍然有可能提升您的应用程序，例如，一个线程可能会阻塞 I/O，而另一个线程会做一些工作。

如果您从未使用过线程，我建议您先尝试一下。它将在任何其他语言中都很有用，并且您会在网络上找到很多资源。然后，如果您意识到需要更多并行性，您仍然可以切换回进程。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-14T16:35:01.890

如果您想阅读关于 Mozilla 中多线程的冗长讨论，请考虑查看始于 2000 年的讨论。[该](https://bugzilla.mozilla.org/show_bug.cgi?id=40848)讨论不一定能回答您的问题。但是，这是一个深入的讨论，我认为它很有趣且内容丰富，我认为这可能非常有价值，因为您提出了一个困难的问题。希望它能帮助您做出明智的决定。

顺便说一句，Mozilla 项目的一些成员（尤其是 Brendan Eich，Mozilla 的 CTO 和 JavaScript 的创建者）对多线程尤其持批评态度。[这里](http://weblogs.mozillazine.org/roadmap/archives/2007/02/threads_suck.html)、[这里](http://weblogs.mozillazine.org/roc/archives/2005/12/night_of_the_living_threads.html)、[这里](http://weblogs.mozillazine.org/roc/archives/2006/12/parallelism_1.html)和[这里](http://weblogs.mozillazine.org/roc/archives/2007/05/performance_obs.html)引用的一些材料支持这样的结论。

希望有帮助，祝你好运。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T21:52:44.403

为了简单起见，我总是更喜欢多线程，但亲和力存在一个真正的问题。没有办法（据我所知）告诉 Python 的线程实现绑定到特定的处理器。这对你来说可能不是问题，听起来不应该是这样。除非您有充分的理由不这样做，否则听起来您的问题可以通过 Python 的线程实现轻松解决。

如果您决定使用已处理，子进程之间的共享信息可以通过多种方式完成：tcp/udp 连接、共享内存或管道。它确实增加了一些开销和复杂性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-03-13T16:01:39.027

很不解。Bastien Léonard 正确地指出，GIL 将阻止以任何有用的方式使用线程的能力。他的参考资料指出：

> “在一种语言中使用全局解释器锁有效地限制了通过具有多个线程的单个解释器进程的并发性可达到的并行量。如果该进程几乎完全由解释代码组成并且不会长时间在解释器之外进行调用一段时间（这可以在它处理时释放该线程上 GIL 上的锁），在多处理器机器上运行该进程时，速度可能几乎没有增加。由于使用 CPU-bound 线程发出信号，它即使在单个处理器上，也可能导致显着减速。”

在这种情况下，多处理是明智的选择。根据我自己的经验，Python + MT 对用户没有明显的好处。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T16:17:00.057

听起来你想要线程。

按照您描述的方式，听起来只有一件事实际上占用了大量 CPU……模拟的实际运行。

通过在模拟运行时允许用户交互和图形更新，您想要获得的是响应更快的显示。这正是 python 的线程的目的。

这不会让您获得利用系统上多个内核/处理器的能力。我不知道你的模拟是什么样的，但如果它是 CPU 密集型的，它可能是一个很好的拆分候选者。在这种情况下，您可以使用多处理在不同的内核/处理器上运行模拟的不同部分。然而，这并不是微不足道的……您现在需要某种方式在进程之间传回和第四次数据，因为单独的进程无法轻松访问相同的内存空间。

# c# - 我的线程似乎没有被创建......知道为什么吗？

> ID：731997
> 
> 赞同：0
> 
> 时间：2009-04-08T21:45:08.540
> 
> 标签：c#, multithreading

在我的 Windows 应用程序中，我有一个用户控件，它又托管了一些其他用户控件。

就在主用户控件的构造函数结束之前，我尝试创建一个线程......但它似乎没有被创建：

```
mainUserControl()
{
   var t=new Thread(ThreadJob);
   t.IsBackground=true;
   t.Start();
}

private void ThreadJob() 
{
   //Thread.Sleep(120000);
   //if(txtStatus.InvokeRequired) {
   //  txtStatus.Invoke(new MethodInvoker(delegate { txtStatus.Text="Thread started"; }));
   //}

   txtStatus.Text="sample";
 } 
```

此代码不起作用：我将此作为线程没有产生的证据，好像它`txtStatus.Text="sample";`会引发异常......对吗？

那么这里发生了什么？为什么没有创建我的线程？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T21:51:00.867

它不一定会引发异常。它可能有，但话又说回来，它可能只是没有工作。不鼓励跨线程 UI 访问是有原因的：它不稳定且危险。总的来说，验证您的程序是否按照您认为的方式设置并不是一个好方法。

使用断点和调试器...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T21:49:54.580

后台线程通常无法访问 UI 线程创建的组件。我的建议是在 ThreadJob 中添加一个 try catch，但最重要的是使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)，因为它被设计为直接访问 UI 线程组件（嗯，使用看不见的魔法 :-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T21:51:57.400

我的猜测是，由于您消除了延迟，因此线程正在生成、设置值并关闭。

`txtStatus.Text`但是，不能保证从错误的线程访问会抛出异常。在某些情况下，您可以从后台线程访问控件上的属性并且它不会抛出。（不过，您仍然不应该这样做！）

如果你仍然认为线程没有开始，你可以尝试在那里设置一个断点——我很确定你会看到它正在达到那个点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T21:54:30.263

未引发 Forms 线程异常并**不能**很好地证明您的线程没有运行。验证线程运行的更好方法：用 a 替换分配，`Console.Out.WriteLine("sample")`然后检查控制台输出。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-08T22:47:30.403

您不应该使用 ThreadStart 对象吗？

如：

```
Thread t = new Thread(new ThreadStart(ThreadJob)); 
```

我一直在毫无问题地使用 ThreadStart 和 ParamatizedThreadStart 对象。您绝对不应该访问在另一个线程中创建的 UI 对象，除非您已禁用此异常，否则如果您的上述线程按预期工作，则应该抛出它，正如您正确声明的那样。

大卫*********