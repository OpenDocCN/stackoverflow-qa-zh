# StackOverflow 问答 000138000-000138999

# ajax - 如何使 XMLHttpRequest 在 Firefox 上通过 HTTPS 工作？

> ID：138000
> 
> 赞同：3
> 
> 时间：2008-09-26T06:10:28.197
> 
> 标签：ajax, firefox

当我尝试通过 XMLHttpRequest 发送 HTTP GET 请求时，它适用于非安全 HTTP。

但是当通过 HTTPS 发送时，不同的浏览器会给出不同的结果：

在 Firefox 3.0.2 上： - GET 请求未到达 Web 服务器。

在 IE 7 上： - GET 请求到达 Web 服务器。

这是否与 Firefox 3 对不受信任的证书变得更加严格有关？有没有解决的办法？

我已经在 Firefox 的证书管理器中添加了 URL 作为例外。错误控制台不报告任何错误。我在 XMLHttpRequest 的 open() 和发送周围添加了一个 try-catch。不会抛出异常。

同时使用绝对和相对 URL 路径不起作用。

这是代码片段：

```
 var xmlHttp;
    try
    {
        // Firefox, Opera 8.0+, Safari
        xmlHttp=new XMLHttpRequest();
    }
    catch (e)
    {
        // Internet Explorer
        try
        {
            xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
        }
        catch (e)
        {
            try
            {
                xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
            catch (e)
            {
                return false;
            }
        }
    }
    // we won't be handling any HTTP response
    xmlHttp.onreadystatechange=function()
    {
        // do nothing..
    }
    // send HTTP GET request
    try
    {
        xmlHttp.open("GET", "/[relative path to request]", true);
        xmlHttp.send(null);
    }
    catch (e)
    {
        alert('Error sending HTTP GET request!');
        return false;
    } 
```

谢谢，肯尼斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T11:54:23.830

尝试在打开后放置您的关闭：

```
// send HTTP GET request
try
{
    xmlHttp.open("GET", "/[relative path to request]", true);
}
catch (e)
{
    alert('Error sending HTTP GET request!');
    return false;
}
// we won't be handling any HTTP response
xmlHttp.onreadystatechange=function()
{
    // do nothing..
}

// Then send it.
xmlHttp.send(null); 
```

谷歌搜索发现确认： [http ://www.ghastlyfop.com/blog/2007/01/onreadystate-changes-in-firefox.html](http://www.ghastlyfop.com/blog/2007/01/onreadystate-changes-in-firefox.html)

尽管该文档说要在 .send(null) 之后附加该函数，但我总是在打开之后附加该函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T06:13:19.220

无论如何，您是否在 HTTPS 页面中请求非 HTTPS URL？错误日志/控制台中是否出现任何消​​息？

# eclipse - 您知道 *latest* eclipse 组件的更新站点地址吗？

> ID：138004
> 
> 赞同：11
> 
> 时间：2008-09-26T06:10:52.143
> 
> 标签：eclipse, build, p2

我正在寻找与以下相关的所有地址：

*   3.x eclipse 本身（里程碑和/或集成构建）
*   3.x 其他组件（GEF、GMF、EMF、...）

本着[回答我自己的问题](https://stackoverflow.com/questions/18557/how-does-stackoverflow-work-the-unofficial-faq#119658)的精神，我确实有一个答案：

*   [3.5 eclipse 本身，有一些细节和**注意事项**](https://stackoverflow.com/questions/138004/do-you-know-update-site-addresses-for-latest-eclipse-35-components#138013)，
*   [**3.6 Helios**，包含遵循更新的步骤](https://stackoverflow.com/questions/138004/do-you-know-update-site-addresses-for-latest-eclipse-3-5-components/1464210#1464210)。

但是，如果您有更多关于 eclipse 或其他 eclipse 组件的地址，请在此处发布。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T06:13:55.113

**2009 年 9 月更新**：另请参阅**[eclipse 3.6 Helios 的地址](https://stackoverflow.com/questions/138004/do-you-know-update-site-addresses-for-latest-eclipse-3-5-components/1464210#1464210)**

* * *

对于 eclipse 本身，[eclipse wiki](http://wiki.eclipse.org/Eclipse_Project_Update_Sites)

*   [3.5 里程碑](http://download.eclipse.org/eclipse/updates/3.5milestones) [http://download.eclipse.org/eclipse/updates/3.5milestones](http://download.eclipse.org/eclipse/updates/3.5milestones)
*   [3.5-I-builds](http://download.eclipse.org/eclipse/updates/3.5-I-builds) [http://download.eclipse.org/eclipse/updates/3.5-I-builds](http://download.eclipse.org/eclipse/updates/3.5-I-builds)

但是，里程碑名称尚不存在。（例如，内部版本号 20080807 假设为 3.5M1）

更新站点将添加为构建位置，以便自动发布：请参阅错误[248509](https://bugs.eclipse.org/bugs/show_bug.cgi?id=248509)

警告：更新过程本身可能会产生一些冻结（请参阅错误[234916](https://bugs.eclipse.org/bugs/show_bug.cgi?id=234916)），这可以通过使用本地 http 客户端（错误[220240](https://bugs.eclipse.org/bugs/show_bug.cgi?id=220240)）来解决。

[这意味着您应该首先使用ECF_Apache_Httpclient-Based_Provider 更新站点](http://download.eclipse.org/technology/ecf/httpclientrepo)( [http://download.eclipse.org/technology/ecf/httpclientrepo](http://download.eclipse.org/technology/ecf/httpclientrepo) )更新您的 eclipse 安装，然后尝试为 eclipse 组件提及的不同更新站点。

* * *

**2009 年 5 月更新**

“[**比较包**](http://www.eclipse.org/downloads/packages/compare-packages)”页面现在提供了指向不同已发布包的所有链接
（参见页面左侧的链接：Europa 3.3、Ganymede 3.4、Ganymede SR1 和 Galileo 3.5Mx）

当前[可用的 Galileo M6](http://www.eclipse.org/downloads/packages/release/galileo/m6)列出了使用 M6 版本构建的软件包。[由于伽利略 M7 刚刚发布](http://download.eclipse.org/eclipse/downloads/drops/S-3.5M7-200904302300/eclipse-news-M7.html)（2009 年 5 月 2 日），该地址很快就会失效。
新的 Galileo 软件包 (M7) 将位于[此地址](http://www.eclipse.org/downloads/packages/release/galileo/m7)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-23T06:10:21.550

对于**eclipse 3.6 Helios**（见[上文 eclipse3.5](https://stackoverflow.com/questions/138004/do-you-know-update-site-addresses-for-latest-eclipse-3-5-components/138013#138013)），来自[“**赶上里程碑和 I-Builds** ”](http://blog.eclipse-tips.com/2009/09/catching-up-with-milestones-and-i.html)

> Eclipse的 **p2 存储库**不仅适用于稳定版本，还适用于 Milestones、I Builds 和 Nightly builds：
> 请参阅[**Eclipse 项目更新站点**](http://wiki.eclipse.org/Eclipse_Project_Update_Sites)

*   [**里程碑**](http://download.eclipse.org/eclipse/updates/3.6milestones)：http: [//download.eclipse.org/eclipse/updates/3.6milestones](http://download.eclipse.org/eclipse/updates/3.6milestones)
*   [**我构建**](http://download.eclipse.org/eclipse/updates/3.6-I-builds)：http: [//download.eclipse.org/eclipse/updates/3.6-I-builds](http://download.eclipse.org/eclipse/updates/3.6-I-builds)
*   [**每晚构建**](http://download.eclipse.org/eclipse/updates/3.6-N-builds)：http: [//download.eclipse.org/eclipse/updates/3.6-N-builds](http://download.eclipse.org/eclipse/updates/3.6-N-builds)

**Prakash GR**在他的帖子建议中：

> 转到您的首选项并在您的可用软件站点首选项中添加所需的存储库（并禁用所有其他，更新速度会很慢）。

![替代文字](https://i.stack.imgur.com/Mmjal.png)

> 同时启用自动更新。你完成了。每当有新的 Milestone（或 I-Build）时，您的 Eclipse 都会自动更新到它，您不必担心安装其他必需的插件

![替代文字](https://i.stack.imgur.com/Dbzs5.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-26T19:13:54.523

这个 Eclipse 3.5 怎么样？ [http://download.eclipse.org/releases/galileo](http://download.eclipse.org/releases/galileo)

# asp.net-mvc - 最佳方法是 ASP.NET MVC 中的类型化视图还是非类型化视图？

> ID：138009
> 
> 赞同：2
> 
> 时间：2008-09-26T06:13:05.163
> 
> 标签：asp.net-mvc

在 ASP.NET MVC 中，如果您在代码隐藏中定义视图应该期望什么样的数据，则可以选择是否具有类型化视图。但也可以不定义它，只传递任何类型的数据以在 ViewData 容器中查看。

这里最好的模型是什么，或者我应该根据我们正在谈论的数据类型来混合（也许只是确保有对视图的功能至关重要的数据类型化和其他未类型化的数据？）？我真的不明白为什么这里有一个选项......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T17:30:44.353

我建议始终使用强类型的 ViewData... 这样您就可以进行编译时检查、智能感知，您不必在视图中进行强制转换，并且能够更轻松地重构代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T14:52:05.577

该框架的早期版本要求您在 ViewData 字典和强类型视图模型之间进行选择。

现在您可以将两者混合使用。将此与预览版 5 的一些新功能（例如 ModelState、验证和自动绑定到表单字段）结合起来，将 ViewPage 用于正在呈现的视图中的主模型变得更加引人注目。

您仍然可以将数据添加到控制器管道中的字典，并稍后使用 ViewData["key"] ... 甚至更好的 ViewData.Get("key") 从[MvcContrib 请求](http://mvccontrib.org)它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T06:26:34.757

我以前也有这个想法。在我的站点中，我曾经对视图进行强类型化，当视图几乎是您所显示的类的 1:1 模型时。就像显示所有用户的列表一样，我输入到列表，这样我就不需要随时转换以获得正确的数据类型。

在没有具体的观点中，我只是将强类型转换为最“重”/使用的类型。

在forms中，form本身就是返回View(form)时视图的类型；……

# java - 是否可以从 Java 调用 COM API？

> ID：138028
> 
> 赞同：9
> 
> 时间：2008-09-26T06:26:10.373
> 
> 标签：java, api, com, hp-quality-center

是否可以从 Java 调用 COM API（特别是 HP/Mercury Quality Center OTA API）？如果是这样，最好的方法是什么？

像 JACOB 这样的东西合适吗？

代码片段将对基础有所帮助:-)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T06:41:28.247

jacob：是的， http: [//sourceforge.net/projects/jacob-project/](http://sourceforge.net/projects/jacob-project/)是一个非常适合您的目的的活跃项目。

你可以看到多个例子：http: [//jacob-project.wiki.sourceforge.net/Event+Callbacks](http://jacob-project.wiki.sourceforge.net/Event+Callbacks)

但是，如果您想要经过更多测试并且愿意付钱的东西，那就去[http://www.nevaobject.com/_docs/_java2com/java2com.htm](http://www.nevaobject.com/_docs/_java2com/java2com.htm)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2017-04-27T12:58:02.253

经过以上所有的比较，没有一个是完全令人满意的。

最完整的解决方案在 [https://github.com/java-native-access/jna](https://github.com/java-native-access/jna)

现在。

它支持，

*   获取到正在运行的 COM 对象的接口
*   启动一个新的 COM 对象并返回其接口
*   调用 COM 方法并返回结果
*   可选的独立 COM 线程处理
*   ComEventCallbacks
*   RunninObjectTable 查询
*   低级 COM 使用
*   util/高级java代理抽象

例如

```
MsWordApp comObj = this.factory.createObject(MsWordApp.class);

Documents documents = comObj.getDocuments();
_Document myDocument = documents.Add();

String path = new File(".").getAbsolutePath();
myDocument.SaveAs(path + "\\abcdefg", WdSaveFormat.wdFormatPDF);
comObj.Quit(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-11T16:30:57.280

也许你应该看看[http://qctools4j.sourceforge.net/](http://qctools4j.sourceforge.net/) 它是 qclylyn (http://sourceforge.net/apps/mediawiki/qcmylyn/index.php?title=Main_Page) 用来检索缺陷的 java 库来自质检。

不幸的是，COM 桥不适用于 linux，因为它加载了 jacob dll

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-10T09:37:28.917

j-Interop 是一个 Java-COM 桥：[j-Interop](http://www.j-interop.org/)。它是用纯 Java 编写的，并在 LGPL v3 下获得许可。它使用 DCOM 有线协议来调用 COM 对象，而不是 JACOB 使用的 JNI 方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-17T08:25:04.500

您可以使用 J-Integra [COM2JAVA](http://j-integra.intrinsyc.com/support/com/doc/com2java/index.html)工具。com2java 工具生成 Java“代理”类和接口，它们对应于 COM 类型库中包含的 coclasses 和接口。它有效地生成了一个 Java API，您可以使用它从 Java 访问 COM 组件。

# python - 在 Tkinter 中获取绑定事件处理程序

> ID：138029
> 
> 赞同：1
> 
> 时间：2008-09-26T06:26:17.520
> 
> 标签：python, user-interface, events, tkinter

在将方法绑定到 Tkinter 元素的事件之后，有没有办法恢复该方法？

```
>>> root = Tkinter.Tk()
>>> frame = Tkinter.Frame(root, width=100, height=100)
>>> frame.bind('<Button-1>', lambda e: pprint('Click')) # function needed
>>> frame.pack()
>>> bound_event_method = frame.??? 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T15:01:35.367

在 Tcl/Tk 中执行此操作的标准方法很简单：您使用相同的绑定命令但没有最终参数。

```
bind .b <Button-1> doSomething
puts "the function is [bind .b <Button-1>]"
=> the function is doSomething 
```

你可以用 Tkinter 做类似的事情，但不幸的是，结果并不那么有用：

```
e1.bind("<Button-1>",doSomething)
e1.bind("<Button-1>")
=> 'if {"[-1208974516doSomething %# %b %f %h %k %s %t %w %x %y %A %E %K %N %W %T %X %Y %D]" == "break"} break\n' 
```

显然，Tkinter 在幕后做了很多杂耍。一种解决方案是编写一个小帮助程序，为您记住这一点：

```
def bindWidget(widget,event,func=None):
    '''Set or retrieve the binding for an event on a widget'''

    if not widget.__dict__.has_key("bindings"): widget.bindings=dict()

    if func:
        widget.bind(event,func)
        widget.bindings[event] = func
    else:
        return(widget.bindings.setdefault(event,None)) 
```

你会像这样使用它：

```
e1=Entry()
print "before, binding for <Button-1>: %s" % bindWidget(e1,"<Button-1>")
bindWidget(e1,"<Button-1>",doSomething)
print " after, binding for <Button-1>: %s" % bindWidget(e1,"<Button-1>") 
```

当我运行上面的代码时，我得到：

```
before, binding for <Button-1>: None
 after, binding for <Button-1>: <function doSomething at 0xb7f2e79c> 
```

作为最后的警告，我不经常使用 Tkinter，所以我不确定动态添加属性到小部件实例的后果是什么。它似乎是无害的，但如果不是，您总是可以创建一个全局字典来跟踪绑定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T08:15:25.680

为 tk C API 执行此操作的相关调用将是[Get_GetCommandInfo](http://linux.about.com/library/cmd/blcmdl3_Tcl_GetCommandInfo.htm)，它

> 将有关命令的信息放在由 infoPtr 指向的 Tcl_CmdInfo 结构中

然而，这个函数在[_tkinter.c](http://svn.python.org/projects/python/trunk/Modules/_tkinter.c)中的任何地方都没有使用，它是 python 槽[Tkinter.py](http://svn.python.org/projects/python/trunk/Lib/lib-tk/Tkinter.py)使用的 tk 的绑定。

因此不可能从 tkinter 中获取绑定函数。您需要自己记住该功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T06:31:03.153

似乎不是......如果您需要它，为什么不自己保存它，或者使用非匿名函数？

此外，您的代码不能像编写的那样工作：`lambda`函数只能包含表达式，不能包含语句，所以是不行的（当成为函数`print`时，这将在 Python 3.0 中改变）。`print()`

# winapi - 如何在 MFC 中创建可调整大小的 CDialog？

> ID：138040
> 
> 赞同：28
> 
> 时间：2008-09-26T06:31:51.827
> 
> 标签：winapi, mfc

我必须创建一个基于对话框的应用程序，而不是旧的 CFormView 设计类型。但是 CDialog 产生固定大小的对话框。如何使用可调整大小的对话框创建基于对话框的应用程序？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-26T06:46:44.100

在 RC 资源文件中，如果对话框具有与此类似的样式，它将是固定大小：

```
IDD_DIALOG_DIALOG DIALOGEX 0, 0, 320, 201
STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU 
```

如果对话框具有这种样式，它将相当大：

```
IDD_DIALOG_DIALOG DIALOGEX 0, 0, 320, 201
STYLE WS_POPUP | WS_VISIBLE | WS_CAPTION | WS_SYSMENU | WS_THICKFRAME 
```

使用这些可调整大小的框架选项，对话框将可重新调整大小，但您仍需要做大量工作来处理**WM_SIZE**消息以管理对话框中控件的大小和位置。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-04-21T04:42:52.077

除了将样式设置为 之外`WS_THICKFRAME`，您可能还需要一个系统来在调整对话框大小时移动对话框中的控件并调整其大小。对于我自己的个人用途，我创建了一个基类来替换具有此功能的 CDialog。从这个类派生并在你的`InitDialog`函数中调用`AutoMove`每个子控件的函数来定义它应该移动多少以及它应该相对于父对话框调整多少。资源文件中对话框的大小用作最小大小。

BaseDialog.h：

```
#if !defined(AFX_BASEDIALOG_H__DF4DE489_4474_4759_A14E_EB3FF0CDFBDA__INCLUDED_)
#define AFX_BASEDIALOG_H__DF4DE489_4474_4759_A14E_EB3FF0CDFBDA__INCLUDED_

#if _MSC_VER > 1000
#pragma once
#endif // _MSC_VER > 1000

#include <vector>

class CBaseDialog : public CDialog
{
// Construction
public:
    CBaseDialog(UINT nIDTemplate, CWnd* pParent = NULL);   // standard constructor

    void AutoMove(int iID, double dXMovePct, double dYMovePct, double dXSizePct, double dYSizePct);

// Overrides
    // ClassWizard generated virtual function overrides
    //{{AFX_VIRTUAL(CBaseDialog)
protected:
    //}}AFX_VIRTUAL

protected:
    //{{AFX_MSG(CBaseDialog)
    virtual BOOL OnInitDialog();
    afx_msg void OnGetMinMaxInfo(MINMAXINFO FAR* lpMMI);
    afx_msg void OnSize(UINT nType, int cx, int cy);
    //}}AFX_MSG
    DECLARE_MESSAGE_MAP()

public:
    bool            m_bShowGripper;         // ignored if not WS_THICKFRAME

private:
    struct SMovingChild
    {
        HWND        m_hWnd;
        double      m_dXMoveFrac;
        double      m_dYMoveFrac;
        double      m_dXSizeFrac;
        double      m_dYSizeFrac;
        CRect       m_rcInitial;
    };
    typedef std::vector<SMovingChild>   MovingChildren;

    MovingChildren  m_MovingChildren;
    CSize           m_szInitial;
    CSize           m_szMinimum;
    HWND            m_hGripper;
};

//{{AFX_INSERT_LOCATION}}
// Microsoft Visual C++ will insert additional declarations immediately before the previous line.

#endif // !defined(AFX_BASEDIALOG_H__DF4DE489_4474_4759_A14E_EB3FF0CDFBDA__INCLUDED_) 
```

BaseDialog.cpp：

```
#include "stdafx.h"
#include "BaseDialog.h"

#ifdef _DEBUG
#define new DEBUG_NEW
#undef THIS_FILE
static char THIS_FILE[] = __FILE__;
#endif

CBaseDialog::CBaseDialog(UINT nIDTemplate, CWnd* pParent /*=NULL*/)
    : CDialog(nIDTemplate, pParent),
      m_bShowGripper(true),
      m_szMinimum(0, 0),
      m_hGripper(NULL)
{
}

BEGIN_MESSAGE_MAP(CBaseDialog, CDialog)
    //{{AFX_MSG_MAP(CBaseDialog)
    ON_WM_GETMINMAXINFO()
    ON_WM_SIZE()
    //}}AFX_MSG_MAP
END_MESSAGE_MAP()

void CBaseDialog::AutoMove(int iID, double dXMovePct, double dYMovePct, double dXSizePct, double dYSizePct)
{
    ASSERT((dXMovePct + dXSizePct) <= 100.0);   // can't use more than 100% of the resize for the child
    ASSERT((dYMovePct + dYSizePct) <= 100.0);   // can't use more than 100% of the resize for the child
    SMovingChild s;
    GetDlgItem(iID, &s.m_hWnd);
    ASSERT(s.m_hWnd != NULL);
    s.m_dXMoveFrac = dXMovePct / 100.0;
    s.m_dYMoveFrac = dYMovePct / 100.0;
    s.m_dXSizeFrac = dXSizePct / 100.0;
    s.m_dYSizeFrac = dYSizePct / 100.0;
    ::GetWindowRect(s.m_hWnd, &s.m_rcInitial);
    ScreenToClient(s.m_rcInitial);
    m_MovingChildren.push_back(s);
}

BOOL CBaseDialog::OnInitDialog()
{
    CDialog::OnInitDialog();

    // use the initial dialog size as the default minimum
    if ((m_szMinimum.cx == 0) && (m_szMinimum.cy == 0))
    {
        CRect rcWindow;
        GetWindowRect(rcWindow);
        m_szMinimum = rcWindow.Size();
    }

    // keep the initial size of the client area as a baseline for moving/sizing controls
    CRect rcClient;
    GetClientRect(rcClient);
    m_szInitial = rcClient.Size();

    // create a gripper in the bottom-right corner
    if (m_bShowGripper && ((GetStyle() & WS_THICKFRAME) != 0))
    {
        SMovingChild s;
        s.m_rcInitial.SetRect(-GetSystemMetrics(SM_CXVSCROLL), -GetSystemMetrics(SM_CYHSCROLL), 0, 0);
        s.m_rcInitial.OffsetRect(rcClient.BottomRight());
        m_hGripper = CreateWindow(_T("Scrollbar"), _T("size"), WS_CHILD | WS_VISIBLE | SBS_SIZEGRIP,
                                  s.m_rcInitial.left, s.m_rcInitial.top, s.m_rcInitial.Width(), s.m_rcInitial.Height(),
                                  m_hWnd, NULL, AfxGetInstanceHandle(), NULL);
        ASSERT(m_hGripper != NULL);
        if (m_hGripper != NULL)
        {
            s.m_hWnd = m_hGripper;
            s.m_dXMoveFrac = 1.0;
            s.m_dYMoveFrac = 1.0;
            s.m_dXSizeFrac = 0.0;
            s.m_dYSizeFrac = 0.0;
            m_MovingChildren.push_back(s);

            // put the gripper first in the z-order so it paints first and doesn't obscure other controls
            ::SetWindowPos(m_hGripper, HWND_TOP, 0, 0, 0, 0, SWP_NOACTIVATE | SWP_NOMOVE | SWP_NOOWNERZORDER | SWP_NOSIZE | SWP_SHOWWINDOW);
        }
    }

    return TRUE;  // return TRUE  unless you set the focus to a control
}

void CBaseDialog::OnGetMinMaxInfo(MINMAXINFO FAR* lpMMI) 
{
    CDialog::OnGetMinMaxInfo(lpMMI);

    if (lpMMI->ptMinTrackSize.x < m_szMinimum.cx)
        lpMMI->ptMinTrackSize.x = m_szMinimum.cx;
    if (lpMMI->ptMinTrackSize.y < m_szMinimum.cy)
        lpMMI->ptMinTrackSize.y = m_szMinimum.cy;
}

void CBaseDialog::OnSize(UINT nType, int cx, int cy) 
{
    CDialog::OnSize(nType, cx, cy);

    int iXDelta = cx - m_szInitial.cx;
    int iYDelta = cy - m_szInitial.cy;
    HDWP hDefer = NULL;
    for (MovingChildren::iterator p = m_MovingChildren.begin();  p != m_MovingChildren.end();  ++p)
    {
        if (p->m_hWnd != NULL)
        {
            CRect rcNew(p->m_rcInitial);
            rcNew.OffsetRect(int(iXDelta * p->m_dXMoveFrac), int(iYDelta * p->m_dYMoveFrac));
            rcNew.right += int(iXDelta * p->m_dXSizeFrac);
            rcNew.bottom += int(iYDelta * p->m_dYSizeFrac);
            if (hDefer == NULL)
                hDefer = BeginDeferWindowPos(m_MovingChildren.size());
            UINT uFlags = SWP_NOACTIVATE | SWP_NOOWNERZORDER | SWP_NOZORDER;
            if ((p->m_dXSizeFrac != 0.0) || (p->m_dYSizeFrac != 0.0))
                uFlags |= SWP_NOCOPYBITS;
            DeferWindowPos(hDefer, p->m_hWnd, NULL, rcNew.left, rcNew.top, rcNew.Width(), rcNew.Height(), uFlags);
        }
    }
    if (hDefer != NULL)
        EndDeferWindowPos(hDefer);

    if (m_hGripper != NULL)
        ::ShowWindow(m_hGripper, (nType == SIZE_MAXIMIZED) ? SW_HIDE : SW_SHOW);
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2017-03-28T16:01:06.760

从**Visual Studio 2015 开始**，您可以使用[MFC Dynamic Dialog Layout](https://devblogs.microsoft.com/cppblog/mfc-dynamic-dialog-layout/)，但似乎没有办法将对话框大小限制为最小大小（仍然只有通过[处理](https://forums.codeguru.com/showthread.php?318933-MFC-General-How-to-prevent-a-resizable-window-to-be-smaller-than) **WM_GETMINMAXINFO**的旧方法）。

动态布局可以做到：

*   在资源编辑器中的设计时，通过选择控件并设置**移动类型**和**大小调整类型**属性（这会在 .rc 文件中发出新的**AFX_DIALOG_LAYOUT部分）；**
*   或以编程方式使用**CMFCDynamicLayout** [类](https://docs.microsoft.com/en-us/cpp/mfc/reference/cmfcdynamiclayout-class)。

文档：[动态布局](https://docs.microsoft.com/en-us/cpp/mfc/dynamic-layout)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-21T04:07:03.020

如果您使用对话框模板，则在资源编辑器中打开对话框模板并将**Style**属性设置为**Popup**并将**Border**属性设置为**Resizing**。我很确定这将与*jussij*所说的一样，并设置 WS_POPUP 和 WS_THICKFRAME 样式。要动态设置这些，然后覆盖 PreCreateWindow 函数并添加以下内容：

```
cs.style |= WS_POPUP | WS_THICKFRAME; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T06:38:42.823

没有简单的方法可以做到这一点。基本上，当窗口大小发生变化时，您将需要动态布局控件。

有关示例，请参见[http://www.codeproject.com/KB/dialog/resizabledialog.aspx](http://www.codeproject.com/KB/dialog/resizabledialog.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-08-11T08:28:50.537

我有一些关于如何在 MFC 中创建一个非常简约的可调整大小的对话框的[博客说明。](http://www.technical-recipes.com/2011/how-to-create-resizable-dialogs-in-mfc/)

它基本上是[Paulo Messina 在 CodeProject 上发布的](http://www.codeproject.com/KB/dialog/resizabledialog.aspx)一个实现， 但尽可能多地删除了无关的东西，只是为了帮助阐明如何做得更好。

一旦您进行了一些练习，实现起来就相当简单：重要的是：

一世。确保您将他的 CodeProject 库等拉入您的项目，并且它们都可以正确编译。

ii. 在 OnInitDialog 方法中进行所需的额外初始化：使抓手可见，设置最大 dilog 大小，将锚点添加到您希望“拉伸”的对话框控件项等。

iii. 在适当的地方用 CResizableDialog 替换 CDialog 的使用：在对话框类定义、构造函数、DoDataExchange、BEGIN_MESSAGE_MAP、OnInitDialog 等。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T13:55:41.080

我尝试了许多 MFC 布局库，发现这是最好的一个：http: [//www.codeproject.com/KB/dialog/layoutmgr.aspx](http://www.codeproject.com/KB/dialog/layoutmgr.aspx)。查看那里的评论以获取一些错误修复和改进（免责声明：其中一些是我的；））。当您使用此库时，将为您处理在窗口上设置正确的调整大小标志。

# c# - 在 .NET 中查找下一个 TCP 端口

> ID：138043
> 
> 赞同：79
> 
> 时间：2008-09-26T06:33:50.900
> 
> 标签：c#, .net, wcf, networking, tcp

我想为 WCF 服务调用创建一个新的 net.tcp://localhost:x/Service 端点，并动态分配一个新的开放 TCP 端口。

我知道当我打开与给定服务器的连接时，TcpClient 将分配一个新的客户端端口。

有没有一种简单的方法可以在 .NET 中找到下一个打开的 TCP 端口？

我需要实际的数字，以便我可以构建上面的字符串。0 不起作用，因为我需要将该字符串传递给另一个进程，以便我可以在该新通道上回调。

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-09-29T22:15:52.567

这是我一直在寻找的：

```
static int FreeTcpPort()
{
  TcpListener l = new TcpListener(IPAddress.Loopback, 0);
  l.Start();
  int port = ((IPEndPoint)l.LocalEndpoint).Port;
  l.Stop();
  return port;
} 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-26T06:35:18.213

使用端口号 0。TCP 堆栈将分配下一个空闲端口。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2018-03-21T13:55:16.977

这是一个与 TheSeeker 接受的答案相当的解决方案。虽然我认为它更具可读性：

```
using System;
using System.Net;
using System.Net.Sockets;

    private static readonly IPEndPoint DefaultLoopbackEndpoint = new IPEndPoint(IPAddress.Loopback, port: 0);

    public static int GetAvailablePort()
    {
        using (var socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp))
        {
            socket.Bind(DefaultLoopbackEndpoint);
            return ((IPEndPoint)socket.LocalEndPoint).Port;
        }
    } 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2019-11-18T23:37:54.797

**我从Selenium.WebDriver DLL**中找到了以下代码

 ****命名空间**：OpenQA.Selenium.Internal

**类**：PortUtility

```
public static int FindFreePort()
{
    int port = 0;
    Socket socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
    try
    {
        IPEndPoint localEP = new IPEndPoint(IPAddress.Any, 0);
        socket.Bind(localEP);
        localEP = (IPEndPoint)socket.LocalEndPoint;
        port = localEP.Port;
    }
    finally
    {
        socket.Close();
    }
    return port;
} 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2017-07-29T03:37:15.553

如果您只想提供一个起始端口，并让它返回下一个可用的 TCP 端口，请使用如下代码：

```
public static int GetAvailablePort(int startingPort)
{
    var portArray = new List<int>();

    var properties = IPGlobalProperties.GetIPGlobalProperties();

    // Ignore active connections
    var connections = properties.GetActiveTcpConnections();
    portArray.AddRange(from n in connections
                        where n.LocalEndPoint.Port >= startingPort
                        select n.LocalEndPoint.Port);

    // Ignore active tcp listners
    var endPoints = properties.GetActiveTcpListeners();
    portArray.AddRange(from n in endPoints
                        where n.Port >= startingPort
                        select n.Port);

    // Ignore active UDP listeners
    endPoints = properties.GetActiveUdpListeners();
    portArray.AddRange(from n in endPoints
                        where n.Port >= startingPort
                        select n.Port);

    portArray.Sort();

    for (var i = startingPort; i < UInt16.MaxValue; i++)
        if (!portArray.Contains(i))
            return i;

    return 0;
} 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-26T08:00:45.687

首先打开端口，然后将正确的端口号提供给其他进程。

否则，仍然有可能其他进程先打开端口，而您仍然有另一个进程。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-10-23T16:00:41.783

如果您想在给定范围内找到下一个可用的 TCP 端口，这里有一种更简洁的实现方式：

```
private int GetNextUnusedPort(int min, int max)
{
    if (max < min)
        throw new ArgumentException("Max cannot be less than min.");

    var ipProperties = IPGlobalProperties.GetIPGlobalProperties();

    var usedPorts =
        ipProperties.GetActiveTcpConnections()
            .Where(connection => connection.State != TcpState.Closed)
            .Select(connection => connection.LocalEndPoint)
            .Concat(ipProperties.GetActiveTcpListeners())
            .Concat(ipProperties.GetActiveUdpListeners())
            .Select(endpoint => endpoint.Port)
            .ToArray();

    var firstUnused =
        Enumerable.Range(min, max - min)
            .Where(port => !usedPorts.Contains(port))
            .Select(port => new int?(port))
            .FirstOrDefault();

    if (!firstUnused.HasValue)
        throw new Exception($"All local TCP ports between {min} and {max} are currently in use.");

    return firstUnused.Value;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-08-16T08:20:02.810

如果您想获得特定范围内的空闲端口以将其用作本地端口/端点：

```
private int GetFreePortInRange(int PortStartIndex, int PortEndIndex)
{
    DevUtils.LogDebugMessage(string.Format("GetFreePortInRange, PortStartIndex: {0} PortEndIndex: {1}", PortStartIndex, PortEndIndex));
    try
    {
        IPGlobalProperties ipGlobalProperties = IPGlobalProperties.GetIPGlobalProperties();

        IPEndPoint[] tcpEndPoints = ipGlobalProperties.GetActiveTcpListeners();
        List<int> usedServerTCpPorts = tcpEndPoints.Select(p => p.Port).ToList<int>();

        IPEndPoint[] udpEndPoints = ipGlobalProperties.GetActiveUdpListeners();
        List<int> usedServerUdpPorts = udpEndPoints.Select(p => p.Port).ToList<int>();

        TcpConnectionInformation[] tcpConnInfoArray = ipGlobalProperties.GetActiveTcpConnections();
        List<int> usedPorts = tcpConnInfoArray.Where(p=> p.State != TcpState.Closed).Select(p => p.LocalEndPoint.Port).ToList<int>();

        usedPorts.AddRange(usedServerTCpPorts.ToArray());
        usedPorts.AddRange(usedServerUdpPorts.ToArray());

        int unusedPort = 0;

        for (int port = PortStartIndex; port < PortEndIndex; port++)
        {
            if (!usedPorts.Contains(port))
            {
                unusedPort = port;
                break;
            }
        }
        DevUtils.LogDebugMessage(string.Format("Local unused Port:{0}", unusedPort.ToString()));

        if (unusedPort == 0)
        {
            DevUtils.LogErrorMessage("Out of ports");
            throw new ApplicationException("GetFreePortInRange, Out of ports");
        }

        return unusedPort;
    }
    catch (Exception ex)
    {
        string errorMessage = ex.Message;
        DevUtils.LogErrorMessage(errorMessage);
        throw;
    }
}

private int GetLocalFreePort()
{
    int hemoStartLocalPort = int.Parse(DBConfig.GetField("Site.Config.hemoStartLocalPort"));
    int hemoEndLocalPort = int.Parse(DBConfig.GetField("Site.Config.hemoEndLocalPort"));
    int localPort = GetFreePortInRange(hemoStartLocalPort, hemoEndLocalPort);
    DevUtils.LogDebugMessage(string.Format("Local Free Port:{0}", localPort.ToString()));
    return localPort;
}

public void Connect(string host, int port)
{
    try
    {
        // Create socket
        Socket socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        //socket.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);

        var localPort = GetLocalFreePort();
        // Create an endpoint for the specified IP on any port
        IPEndPoint bindEndPoint = new IPEndPoint(IPAddress.Any, localPort);

        // Bind the socket to the endpoint
        socket.Bind(bindEndPoint);

        // Connect to host
        socket.Connect(IPAddress.Parse(host), port);

        socket.Dispose();
    }
    catch (SocketException ex)
    {
        // Get the error message
        string errorMessage = ex.Message;
        DevUtils.LogErrorMessage(errorMessage);
    }
}

public void Connect2(string host, int port)
{
    try
    {
        // Create socket

        var localPort = GetLocalFreePort();

        // Create an endpoint for the specified IP on any port
        IPEndPoint bindEndPoint = new IPEndPoint(IPAddress.Any, localPort);

        var client = new TcpClient(bindEndPoint);
        //client.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true); //will release port when done

        // Connect to the host
        client.Connect(IPAddress.Parse(host), port);

        client.Close();
    }
    catch (SocketException ex)
    {
        // Get the error message
        string errorMessage = ex.Message;
        DevUtils.LogErrorMessage(errorMessage);
    }
} 
```

# c# - C# 中有类似 Python 的 getattr() 的东西吗？

> ID：138045
> 
> 赞同：15
> 
> 时间：2008-09-26T06:35:30.007
> 
> 标签：c#, python, user-interface

C# 中有类似[Python 的 getattr() 的东西吗？](http://effbot.org/zone/python-getattr.htm)我想通过读取包含要放在窗口上的控件名称的列表来创建一个窗口。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T06:57:23.420

还有[Type.InvokeMember](http://msdn.microsoft.com/en-us/library/66btctbe.aspx)。

```
public static class ReflectionExt
{
    public static object GetAttr(this object obj, string name)
    {
        Type type = obj.GetType();
        BindingFlags flags = BindingFlags.Instance | 
                                 BindingFlags.Public | 
                                 BindingFlags.GetProperty;

        return type.InvokeMember(name, flags, Type.DefaultBinder, obj, null);
    }
} 
```

可以这样使用：

```
object value = ReflectionExt.GetAttr(obj, "PropertyName"); 
```

或（作为扩展方法）：

```
object value = obj.GetAttr("PropertyName"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T06:39:43.663

为此使用反射。

[`Type.GetProperty()`](http://msdn.microsoft.com/en-us/library/system.type.getproperty.aspx)[`Type.GetProperties()`](http://msdn.microsoft.com/en-us/library/system.type.getproperty.aspx)每个返回实例，[`PropertyInfo`](http://msdn.microsoft.com/en-us/library/system.reflection.propertyinfo.aspx)可用于读取对象的属性值。

```
var result = typeof(DateTime).GetProperty("Year").GetValue(dt, null) 
```

[`Type.GetMethod()`](http://msdn.microsoft.com/en-us/library/system.type.getmethod.aspx)[`Type.GetMethods()`](http://msdn.microsoft.com/en-us/library/system.type.getmethods.aspx)每个返回实例，[`MethodInfo`](http://msdn.microsoft.com/en-us/library/system.reflection.methodinfo.aspx)这些实例可用于在对象上执行方法。

```
var result = typeof(DateTime).GetMethod("ToLongDateString").Invoke(dt, null); 
```

如果您不一定知道类型（如果您新属性名称会有点奇怪），那么您也可以这样做。

```
var result = dt.GetType().GetProperty("Year").Invoke(dt, null); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T06:40:58.403

是的，你可以这样做...

```
typeof(YourObjectType).GetProperty("PropertyName").GetValue(instanceObjectToGetPropFrom, null); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T06:46:51.777

可以使用 object.GetType().GetProperties() 创建 System.Reflection.PropertyInfo 类。这可用于使用字符串探测对象的属性。（对象方法、字段等也存在类似的方法）

我不认为这会帮助你实现你的目标。您可能应该直接创建和操作对象。例如，控件具有您可以设置的 Name 属性。

# emacs - 编辑 Lisp 代码时，是否可以将 emacs 配置为以不同颜色显示每个嵌套级别的括号？

> ID：138056
> 
> 赞同：11
> 
> 时间：2008-09-26T06:41:49.073
> 
> 标签：emacs, lisp

换句话说，像这样的代码块：

```
(setq initial-major-mode
  (lambda ()
    (text-mode)
    (font-lock-mode)
    )) 
```

...看起来像这样：

![替代文字](https://i.stack.imgur.com/kiaIG.gif)

如果这样的东西已经存在，它是什么？如果它不存在，我该怎么写呢？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T08:55:43.400

我认为您正在寻找类似[mwe-color-box.el](http://www.foldr.org/~michaelw/emacs/mwe-color-box.el)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-05-17T18:37:28.837

有一个包[rainbow-delimiters](http://www.emacswiki.org/emacs/RainbowDelimiters)，它并不能完全按照你的意愿做，但只是为括号着色 - 这是一个很好的子集，允许你仍然看到主要模式提供的其他语法突出显示。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T13:13:06.267

如果您需要它来帮助编辑，那么我建议打开对包含具有不同背景颜色的光标的*最里面的 sexp 进行着色。*至少我已经习惯了，这就足够了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-08T18:07:21.340

[http://nschum.de/src/emacs/highlight-parentheses/](http://nschum.de/src/emacs/highlight-parentheses/)让您只突出显示括号。

# java - 检测在 Java 中重新打开的文件

> ID：138059
> 
> 赞同：3
> 
> 时间：2008-09-26T06:45:15.663
> 
> 标签：java, multithreading, file

我正在开发一个小型 Java 应用程序（Java 1.6，Solaris），它将使用多个后台线程来监视一系列文本文件以查找与特定正则表达式模式匹配的输出行，然后使用这些行。我每个文件有一个线程；他们将感兴趣的行写入队列，另一个后台线程只是监视队列以收集整个被监视文件集合中的所有感兴趣的行。

我遇到的一个问题是当我正在监视的文件之一被重新打开时。许多创建我正在监视的文件的应用程序在重新启动时只会重新启动它们的日志文件；它们不会附加到已经存在的内容上。

我需要我的 Java 应用程序来检测该文件是否已重新打开并在该文件之后重新启动。

我怎样才能最好地做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T07:08:28.493

你能记录每个文件的每个长度吗？当当前长度随后回到零或小于您上次记录的长度时，您知道该文件已被应用程序重新启动吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T07:09:59.910

正如侏罗纪所提到的，使用锁定文件是一种解决方案。

另一种方法是在阅读模式时尝试打开文件，并查看文件是否有新的大小和创建时间。如果创建时间与您找到它的时间不同，那么您可以确定它已被重新创建。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-26T07:00:08.793

您可以在文件系统上的某处指出您正在读取给定文件。假设在正在读取的文件 (a.txt) 旁边，您在它旁边创建了一个文件 (a.txt.lock)，指示正在读取 a.txt。当您的过程完成后，a.txt.lock 将被删除。每次一个进程去打开一个文件来读取它，它都会事先检查锁定文件。如果没有锁定文件，则它没有被使用。我希望这是有道理的并回答你的问题。干杯！

# tfs - TFS Build Server 放置位置错误

> ID：138060
> 
> 赞同：1
> 
> 时间：2008-09-26T06:45:42.043
> 
> 标签：tfs, tfsbuild, network-share

我们正在使用 TFS 构建服务器来确保开发人员签入的所有文件都将编译为工作源代码树，因为没有什么比构建损坏更糟糕的了！

无论如何，我们在构建服务器想要使用的放置位置上遇到了一些问题，我们不断收到此错误：

> TFS209011：无法创建放置位置 \build-server\drops\project\BuildNumber。此时无法与此远程计算机建立更多连接，因为已存在该计算机可以接受的连接数

由于目前正在试点计划中使用它，因此我们只有 2 个项目正在使用构建服务器。我检查了网络共享，允许的连接数约为 100，所以我真的不明白问题出在哪里。

问题只是偶尔会引起人们的注意，通常我们几天都没有，然后我们会连续遇到一堆。

我似乎也找不到太多这方面的信息。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-27T00:37:14.017

我对 TFS 很熟悉——但我是开发者而不是网络人。我猜想虽然 NETWORK SHARE 本身允许 100 个连接，但它运行的底层服务器是否可能没有某种限制？

你检查过事件日志吗？

这个问题似乎很具体，我鼓励您在微软官方论坛上发帖。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T05:44:40.237

看起来问题与我们安装的 Windows 2003 有关，我们安装了“Web 版”，并且仅限于 10 个连接。

我最终在 MSDN 论坛的帖子中得到了这个答案：[http ://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3967598&SiteID=1&mode=1](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3967598&SiteID=1&mode=1)

# windows - 如何判断一个驱动器是否是网络挂载的？

> ID：138065
> 
> 赞同：4
> 
> 时间：2008-09-26T06:48:39.837
> 
> 标签：windows, winapi

我正在搜索所有驱动器及其内容。我不想搜索网络驱动器。如何确定给定驱动器是否已安装在网络上？我还想进一步获得使用 NET USE 命令获得的类似信息？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T06:51:17.817

您需要[GetDriveType](http://msdn.microsoft.com/en-us/library/aa364939.aspx)函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T06:56:28.710

此外，如果您想添加删除驱动器或检查状态，请查看这篇文章：

[http://support.microsoft.com/kb/173011](http://support.microsoft.com/kb/173011)

那是使用win32 api。

# c# - 在 .aspx 和 .ascx 页面中捕获异常

> ID：138071
> 
> 赞同：2
> 
> 时间：2008-09-26T06:54:20.290
> 
> 标签：c#, .net, asp.net, exception, error-handling

问题说明了一切，以这个示例代码为例：

```
<ul id="css-id">
    <li>
    <something:CustomControl ID="SomeThingElse" runat="server" />
    <something:OtherCustomControl runat="server" />
    </li>
</ul> 
```

现在，如果在这些控件（位于母版页中）的某个地方抛出错误，它们将关闭整个站点，如何捕获这些异常？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T06:58:44.180

您可以在 Global.asax 页面/类中捕获所有未处理的异常。看着：

```
protected void Application_Error(Object sender, EventArgs e) 
```

方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T06:59:03.180

不幸的是，未处理的异常总是会导致您的站点出错。不过，您可以通过几种方法来防止这种情况。

*   使用 web.config 中的部分显示用户友好的消息
*   在您的 Global.asax - 或自定义处理程序中 - 捕获您未处理的异常并做出相应的反应 -[像这样](http://www.webdude.co.za/archive/2008/09/17/creating-your-own-unhandled-error-logging-module.aspx)

**最佳解决方案**

*   确保您的控件不会抛出未处理的异常！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T06:58:45.583

添加一个 global.asax 并实现 Application_Error 处理程序。使用 Server.GetLastError() 函数获取抛出异常的句柄。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T07:00:13.443

使用 global.asax Application_Error 方法，如[如何使用 Visual C# .NET 在 ASP.NET 中创建自定义错误报告页面中所述](http://support.microsoft.com/kb/306355)。

另一种方法是使用[HTTP 模块](http://msdn.microsoft.com/en-us/library/aa479332.aspx)；这为您提供了更多的灵活性（例如，您可以处理来自多个应用程序的错误）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T07:03:59.660

你想捕捉异常并处理它吗？

或者你想防止黄屏死机？如果您试图阻止黄屏死机，请查看在（换句话说，在您的 Global.asax 中）处理`Error`事件。`HttpApplication`

有关详细信息，请参阅以下 MSDN 页面：http: [//msdn.microsoft.com/en-us/library/system.web.httpapplication.error.aspx](http://msdn.microsoft.com/en-us/library/system.web.httpapplication.error.aspx)

特别是这一段：

> 可以通过调用 GetLastError 方法来访问引发错误事件的异常。如果您的应用程序生成自定义错误输出，请取消由 ASP.NET 通过调用 ClearError 方法生成的默认错误消息。

# c# - 如何记录存储过程错误

> ID：138073
> 
> 赞同：4
> 
> 时间：2008-09-26T06:54:44.953
> 
> 标签：c#, sql-server

**场景：** C# 应用程序使用 SQL2000。它在应用程序的 try catch 中执行 3 个存储过程。在 catch 中，错误被抑制。由于某些合法性，c# 代码无法更改和实施。

**问：**如何将存储过程中的实际 SQL 错误捕获到日志文件或其他表中？@@Error 向应用程序返回一条错误消息，但在查询分析器中评估时，它始终为 0，尽管 'If @@Error <> 0' 确实会触发。我尝试存储@@Error 编号，但它始终为 0。

请帮忙。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T07:12:29.810

`@@ERROR`检查时重置为0。为什么？因为它反映了最后执行的语句的状态。

```
IF @@ERROR <> 0 ... 
```

是一个语句，并且该语句成功，导致`@@ERROR`设置为 0。

检查和操作`@@ERROR`值的正确方法如下：

```
DECLARE @ErrorCode INT

INSERT INTO Table ...

SET @ErrorCode = @@ERROR
IF @ErrorCode <> 0
BEGIN
    INSERT INTO ErrorLog (ErrorCode, Message)
        VALUES (@ErrorCode, 'The INSERT operation failed.')
END 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T07:11:21.437

手头没有例子，但看看使用

```
RAISERROR ... WITH LOG 
```

有关更多信息，请参见：http: [//msdn.microsoft.com/en-us/library/aa238452 (SQL.80).aspx。](http://msdn.microsoft.com/en-us/library/aa238452(SQL.80).aspx)

或使用：

```
xp_logevent {error_number, 'message'} [, 'severity'] 
```

写入事件日志。更多详细信息，请访问[http://msdn.microsoft.com/en-us/library/aa260695(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa260695(SQL.80).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T07:38:37.453

Didn't try it myself but I guess you can monitor the errors with **Sql Server Profiler**.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-03T11:25:24.750

```
ALTER PROCEDURE [dbo].[StoreProcedureName] 
(
parameters 
)
AS
BEGIN
    SET NOCOUNT On
    BEGIN TRY               
        --type your query   

    End Try
    BEGIN CATCH
        SELECT
                ERROR_NUMBER() AS ErrorNumber,
                ERROR_SEVERITY() AS ErrorSeverity,
                ERROR_STATE() AS ErrorState,
                ERROR_PROCEDURE() AS ErrorProcedure,
                ERROR_LINE() AS ErrorLine,
                ERROR_MESSAGE() AS ErrorMessage
            RETURN -1
    END CATCH
End 
```

# .net - 在 .NET 中模拟硬盘

> ID：138080
> 
> 赞同：4
> 
> 时间：2008-09-26T06:57:35.120
> 
> 标签：.net, emulation, hard-drive

有没有办法在 .NET 中模拟磁盘驱动器，拦截读/写/锁定操作？我想在 C#
中创建一个类似于[GMail Drive的前端。](http://en.wikipedia.org/wiki/GMail_Drive)

谢谢，汤姆

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T15:09:18.797

在 Linux 上，您可以使用 Mono.Fuse API ( [http://www.jprl.com/Projects/mono-fuse.html](http://www.jprl.com/Projects/mono-fuse.html) ) 来使用用户级代码实现基于 .NET 的文件系统。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T15:36:00.587

您可以看到[http://www.truecrypt.org/](http://www.truecrypt.org/)是如何做到的。它通过使用文件或使用驱动器或分区来做到这一点。然后它安装文件，就好像它是一个真正的驱动器一样。现在，可能源代码有点复杂；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T07:10:05.433

为此，我自己使用 Eldos[回调文件系统，虽然它很好，但并不便宜。](http://eldos.com/cbfs/)

还有一些免费/便宜的项目，我敢肯定其中一个最近在 SO 上的类似问题中被提及——不过，目前找不到了。然而，稳定性往往是一个主要问题，因为分层的 Windows 文件系统驱动程序并非微不足道。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T07:15:51.753

并非如此，.Net 位于诸如磁盘访问之类的操作系统功能之上，为您提供托管文件访问器之类的东西。您可以用托管 C# 编写所有这些功能，但您需要非托管调用才能使操作系统将其视为另一个驱动器。

所有外壳扩展的东西都是 COM： http: [//msdn.microsoft.com/en-us/library/cc147467 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/cc147467(VS.85).aspx)

但是，您可以编写一个允许从资源管理器拖放并且看起来像文件系统视图的 .Net 桌面应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-18T10:56:57.977

您还可以将[EZNamespaceExtension 用于 .NET](http://www.ssware.com/eznamespaceextensions/eznamespaceextensions.htm)。这使您可以与 Windows 资源管理器集成。考虑到许可证是每个开发人员而不是分发，所以不会太贵。

**更新** EZNamespaceExtension.NET 的大问题。它已经很久没有更新了。LogicNP 似乎对 EZNamespaceExtension.NET 失去了兴趣，因为自 2010 年以来还没有发布具有少数新功能的版本。不支持 .NET 4，也不支持 Windows 8 功能区工具栏

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-28T04:31:27.493

我刚刚使用上面的链接检查[了 .NET 的 EZNamespaceExtension 。](http://www.ssware.com/eznamespaceextensions/eznamespaceextensions.htm)似乎它们与 2013 版本保持同步。但不确定是否可以回答在 Explorer.exe 中显示为驱动器的问题（AFAIK。它不能显示为驱动器号）

# licensing - 如何保护应用程序免受虚拟机的复制

> ID：138081
> 
> 赞同：21
> 
> 时间：2008-09-26T06:58:13.260
> 
> 标签：licensing, virtual-machine

我们使用硬盘和 CPU ID 等标准项目将我们的软件许可证锁定到物理硬件。我们如何降低客户安装到虚拟机然后克隆虚拟机、绕过我们的许可的风险？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2013-11-20T20:10:40.670

一种方法是拥有一个许可服务器。当您将许可证代码输入客户端（在 VM 上）时，它会联系服务器并将其许可证代码和其他信息发送给它。它反复联系它（您定义间隔 - 可能每隔几个小时一次）询问“我仍然有效吗”？随着这个请求，它发送一个唯一的 ID。服务器回复“是的，你是有效的”，并发送一个新的唯一 ID 返回给客户端。客户端将此唯一 ID 连同其下一个请求一起发送回服务器。服务器验证这是它为该许可证发送给客户端的相同 ID，即上一个请求。

如果虚拟机是重复的，下次它询问服务器“我有效吗？”时，它或其他虚拟机的唯一 ID 将不正确。两者都不会继续工作。

如果服务器出现故障或网络出现故障，您将需要确定该怎么做，以使客户端无法与服务器通信。您是否立即禁用您的软件？馊主意！不要让你的客户生气。你会想给他们一个宽限期。这应该多长时间？几天？周？

假设您给他们 1 个月的宽限期。理论上，他们可以在输入许可证密钥后克隆父虚拟机，然后在其他虚拟机的宽限期到期之前将其恢复到该克隆，从而禁用对它们的网络访问。但是，这对您的客户来说会很麻烦，只是盗版了您的软件的其他副本。您必须确定什么样的宽限期不会打扰您的合法客户，同时希望为您提供您所寻求的保护。

通过验证虚拟机的时钟设置是否正确，可以实现额外的保护。这将防止上述盗版方法。

另一个考虑因素是，精明的用户可以编写自己的许可服务器来与 VM 实例通信，并告诉他们“你很好”——因此加密通信可以帮助阻止这种情况。您想在这里走多远实际上取决于您认为盗版确实可能对您的客户造成多大的问题。最后，您将无法阻止真正有时间的海盗，但您可以让诚实的用户保持诚实。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-26T07:34:58.197

License. Tell your users, they may not run unlicensed copies.

We are actually *failing* to buy a license for a software at the moment, because the vendor is scared of virtual machines: The infrastructure for our department is being moved to a centralized virtualized sollution and we have to fight the vendor to be *allowed* to buy a license for his software!

Don't be afraid of paying users.

People too cheep to buy licenses are going to look for another sollution and will be too much hassle anyway.

(good luck telling your boss that, though...)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-07T18:03:31.213

没有充分的理由锁定到物理机器。最后我检查了计算机可能会出现故障，然后用户可能不仅会因为死机而感到不便，而且不得不打电话给您将软件锁定到新机器上。如果您*必须*执行严格的许可证管理，请使用（本地）管理服务器并运行副本，每隔几分钟验证他们是否拥有许可证。只要意识到，如果有人真的想在不付钱的情况下使用您的软件，那么无论您做什么，他们都会找到方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-07T18:08:03.963

您需要计算机“硬件”之外的东西来进行身份验证。大多数公司选择硬件密钥（加密狗）用于成本高昂的软件，用户会忍受它。

其他公司使用在线方法 - 如果具有 CPUID 和其他硬件的多个用户同时使用给定许可证，则禁止另一个实例化，或关闭现有实例化。

您必须根据自己的需要和消费者愿意跳过您的反盗版圈来选择保护。

-亚当

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T07:08:50.583

除了需要定期在线激活外，您可以做的 AFAIK 并不多。

我们遇到了诺顿重影*物理*机器的问题。显然 HDD 序列号也有幻影。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T07:26:07.530

如果您的软件在 VM 下运行，那么它将在任意数量的克隆 VM 下运行。因此，唯一的选择似乎是完全阻止它在 VM 下运行。这是一篇关于虚拟机检测的文章：[检测您的程序是否在虚拟机内运行，](http://www.codeproject.com/KB/system/VmDetect.aspx)以及一篇关于[阻止](http://handlers.sans.org/tliston/ThwartingVMDetection_Liston_Skoudis.pdf)它的文章。

顺便说一句，克隆虚拟机通常足以阻止临时用户绕过您的许可，而那些一心想破解的人可能会找到绕过它的方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T18:05:53.437

“不要打扰”是简短的版本。对于您的客户而言，这样做并非易事收费很高（就像你在挖坑一样。）

“真正的”客户通常会为这些东西买单。据我所知，像企业这样的地方通常会认为不值得付出努力。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T07:18:46.050

我知道一些虚拟机软件（至少是 VMware）具有允许软件检测虚拟化的功能。但是没有万无一失的方法，无论如何都可以修补这些功能。还可以使用神秘的性能变化（由于主机中的 CPU 峰值），可靠性值得怀疑。有很多“被虚拟化的迹象”，但它们往往不是 100% 可靠的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-07T17:55:56.780

这是一个问题，任何精明的用户都将能够击败你所做的任何事情。不精通的用户可能会被诸如 VmWare 播放器之类的行为所吸引，当您移动它时，它会更改虚拟机的 MAC 和其他 ID，大概是对此类问题的一种认可。

最好的解决方案可能是使用许可证服务器，因为该服务器将计算活动许可证的数量。节点锁定更容易被击败，并且使用服务器也倾向于将责任推给 IT 部门，与只想尽快完成工作的个人用户相比，IT 部门对不违反许可协议更为敏感。

但最后，我同意这一切都归结为正确的许可语言，并让客户在一定程度上得到信任。如果您认为人们以这种方式愚弄您，那么您一开始就不应该向他们出售您的软件......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-08-11T19:58:55.797

如果您的软件**需要**在虚拟机上运行，​​那么这个概念如何：

*   在主机上，您创建一个运行的编译程序，例如。每半小时读取一次硬盘和 CPU ID，然后将其与当前时间戳以及所有这些信息的加盐哈希一起存储在一个文件中。
*   然后，您需要与 VM 共享包含该文件的文件夹。
*   然后，在您在 VM 内编译的软件中，您可以读取此文件并检查时间戳是否是最新的并且哈希是否有效。

或者更好的是，让主机程序以某种方式直接与 VM 中的软件通信。

这不是一个好的解决方案吗？不如使用硬件密钥（如 Yubikey）安全，但您必须非常精通技术才能破解它......？

# wpf - 如何使用 WPF 中的代码将页面添加到框架

> ID：138096
> 
> 赞同：10
> 
> 时间：2008-09-26T07:07:01.697
> 
> 标签：wpf

我有一个窗口，我放了一个框架。当我单击一个也在窗口上但不在框架中的按钮时，我想将一个页面添加到框架中。窗口中有几个按钮，每次单击按钮都应在框架中加载不同的页面。

因为我是这个 WPF 东西的新手，所以这种方法很可能不是最好的，我考虑过用 Canvas 替换 Frame，然后制作 UserControls 而不是将添加到 Canvas 的 Pages。我欢迎任何关于如何最好地解决这个问题的想法和建议。

我的目标是实现与 dnrtv 第 115 集中演示的应用程序 Billy Hollis 类似的功能。 ( [http://dnrtv.com/default.aspx?showID=115](http://dnrtv.com/default.aspx?showID=115) )。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-26T08:33:48.397

Frame 类公开了一个名为“Navigate”的方法，该方法将您要在框架中显示的内容作为参数。试着打电话

```
myFrame.Navigate(myPageObject); 
```

这应该工作

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2014-06-05T06:55:33.430

yourFramName.NavigationService.Navigate(yourPageObject)

例如 Frame1.NavigationService.Navigate(new Page1());

# java - 如何在 Linux 上的 Java 或 JRuby 中找到我的 PID？

> ID：138097
> 
> 赞同：13
> 
> 时间：2008-09-26T07:07:11.867
> 
> 标签：java, linux, jruby, pid

我需要在 Linux 平台上找到当前正在运行的进程的 PID（它可以是系统相关的解决方案）。Java 不支持获取进程 ID，并且 JRuby 目前存在 Ruby 方法 Process.pid 的错误。

有没有其他方法可以获取 PID？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-26T07:07:17.013

如果你安装了[procfs](http://en.wikipedia.org/wiki/Procfs)，你可以通过 /proc/self 符号链接找到进程 id，它指向一个名为 pid 的目录（这里也有包含其他相关信息的文件，包括 PID，但目录是所有在这种情况下你需要）。

因此，使用 Java，您可以：

```
String pid = new File("/proc/self").getCanonicalFile().getName(); 
```

在 JRuby 中，您可以使用相同的解决方案：

```
pid = java.io.File.new("/proc/self").canonical_file.name 
```

特别感谢免费节点上的#stackoverflow 频道帮助我解决了这个问题！（特别是[Jerub](https://stackoverflow.com/users/14648/jerub)、[gregh](https://stackoverflow.com/users/893/greg-hewgill)和[Topdeck](https://stackoverflow.com/users/1057/harley)）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T08:43:35.037

仅在使用 Sun JVM 的 Linux 中进行了测试。可能不适用于其他 JMX 实现。

```
String pid = ManagementFactory.getRuntimeMXBean().getName().split("@")[0]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-09T14:19:29.913

可以使用JNI 接口调用POSIX 函数[getpid](http://www.kernel.org/doc/man-pages/online/pages/man2/getpid.2.html) ()。这很简单。您从所需的 POSIX 函数的类开始。我称之为`POSIX.java`：

```
import java.util.*;

class POSIX
{
    static { System.loadLibrary ("POSIX"); }
    native static int getpid ();
} 
```

编译它

```
$ javac POSIX.java 
```

之后，您生成一个头`POSIX.h`文件

```
$ javah -jni POSIX 
```

头文件包含该函数的 C 原型，其中包装了 getpid 函数。现在您必须实现该功能，这很容易。我做到了`POSIX.c`：

```
#include "POSIX.h"

#include <sys/types.h>
#include <unistd.h>

JNIEXPORT jint JNICALL Java_POSIX_getpid (JNIEnv *env, jclass cls)
{
    return getpid ();
} 
```

现在你可以使用 gcc 编译它：

```
$ gcc -Wall -I/usr/lib/jvm/java-1.6.0-sun-1.6.0.21/include -I/usr/lib/jvm/java-1.6.0-sun-1.6.0.21/include/linux -o libPOSIX.so -shared -Wl,-soname,libPOSIX.so POSIX.c -static -lc 
```

您必须指定 Java 的安装位置。就这样。现在你可以使用它了。创建一个简单的 getpid 程序：

```
public class getpid
{
    public static void main (String argv[])
    {
        System.out.println (POSIX.getpid ());
    }
} 
```

编译`javac getpid.java`并运行它：

```
$ java getpid &
[1] 21983
$ 21983 
```

第一个 pid 由 shell 编写，第二个 pid 在 shell 提示符返回后由 Java 程序编写。∎</p>

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-14T21:27:48.940

生成一个将读取其父进程 pid 的 shell 进程。那一定是我们的pid。这是运行代码，没有异常和错误处理。

```
import java.io.*;
import java.util.Scanner;

public class Pid2
{
  public static void main(String sArgs[])
    throws java.io.IOException, InterruptedException
  {
    Process p = Runtime.getRuntime().exec(
      new String[] { "sh", "-c", "ps h -o ppid $$" });
    p.waitFor();
    Scanner sc = new Scanner(p.getInputStream());
    System.out.println("My pid: " + sc.nextInt()); 
    Thread.sleep(5000);
  }
} 
```

如果要获取 PID 只是为了发出另一个 shell 命令，这个解决方案似乎是最好的。将命令包含在反引号中以将其作为参数传递给另一个命令就足够了，例如：

```
nice `ps h -o ppid $$` 
```

这可能会替换给定`exec`调用的数组中的最后一个字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-09-26T22:17:41.350

`Java 9`[最后通过ProcessHandle](https://docs.oracle.com/javase/9/docs/api/java/lang/ProcessHandle.html)提供了一种官方方法：

```
ProcessHandle.current().pid(); 
```

这：

*   首先获取`ProcessHandle`当前进程的参考。

*   为了访问它的`pid`.

不需要导入，因为`ProcessHandle`它是`java.lang`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-03-11T17:02:30.163

[您可以在JNR-Posix](https://github.com/jnr/jnr-posix)中尝试 getpid() 。

它还有一个 Windows POSIX 包装器，它从 libc 中调用 getpid()。不需要 JNI。

# java - 如何将类型添加到 GWT 的序列化策略白名单？

> ID：138099
> 
> 赞同：35
> 
> 时间：2008-09-26T07:07:51.273
> 
> 标签：java, serialization, gwt, whitelist

GWT 的序列化程序支持有限`java.io.Serializable`，但出于安全原因，它支持的类型有一个白名单。我找到的文档，例如[这个 FAQ 条目](http://www.gwtproject.org/doc/latest/FAQ_Server.html#Does_the_GWT_RPC_system_support_the_use_of_java.io.Serializable)说你想要序列化的任何类型“必须包含在序列化策略白名单中”，并且该列表是在编译时生成的，但没有解释编译器如何决定白名单上发生了什么。

生成的列表包含许多属于标准库的类型，例如`java.lang.String`和`java.util.HashMap`。尝试序列化时出现错误`java.sql.Date`，它实现了`Serializable`接口，但不在白名单上。如何将此类型添加到列表中？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-06-14T12:36:44.673

有一个解决方法：定义一个新`Dummy`类，其中包含要包含在序列化中的所有类型的成员字段。然后在你的 RPC 接口中添加一个方法：

```
Dummy dummy(Dummy d); 
```

实现就是这样：

```
Dummy dummy(Dummy d) { return d; } 
```

并且异步接口将具有以下内容：

```
void dummy(Dummy d, AsyncCallback< Dummy> callback); 
```

GWT 编译器会选择这个，并且因为`Dummy`类引用了这些类型，它会将它们包含在白名单中。

示例`Dummy`类：

```
public class Dummy implements IsSerializable {
    private java.sql.Date d;
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-28T00:50:16.177

您包含在服务接口中的任何特定类型以及它们引用的任何类型都将自动列入白名单，只要它们实现 java.io.Serializable，例如：

```
public String getStringForDates(ArrayList<java.util.Date> dates); 
```

将导致 ArrayList 和 Date 都包含在白名单中。

如果您尝试使用 java.lang.Object 而不是特定类型，它会变得更加棘手：

```
public Object getObjectForString(String str); 
```

因为编译器不知道要将什么列入白名单。在这种情况下，如果在服务接口的任何地方都没有引用对象，则必须使用 IsSerializable 接口显式标记它们，否则它不会让您通过 RPC 机制传递它们。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-26T11:53:22.310

白名单由 GWT 编译器生成，包含由 IsSerializable 标记接口指定的所有条目。

要将类型添加到列表中，您只需确保该类实现 IsSerializable 接口。

此外，为了使序列化正常工作，该类必须具有默认的无参数构造函数（如果需要，构造函数可以是私有的）。此外，如果该类是内部类，则必须将其标记为静态。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-04T22:14:56.597

恕我直言，以编程方式访问白名单的最简单方法是创建一个类似于以下的类：

```
public class SerializableWhitelist implements IsSerializable {
    String[] dummy1;
    SomeOtherThingsIWishToSerialize dummy2;
} 
```

然后将其包含在`.client`包中并从 RPC 服务引用（以便编译器对其进行分析）。

我找不到更好的方法来启用未参数化地图的传输，这显然是您有时需要的，以便创建更通用的服务......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-07T19:36:48.627

以确保所需的结果删除所有`war/<app>/gwt/*.gwt.rpc`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-10T17:53:53.130

> 白名单由 gwt 编译器生成，包含由 IsSerializable 标记接口指定的所有条目。
> 
> 要将类型添加到列表中，您只需确保该类实现 IsSerializable 接口。
> 
> ——安德烈

这可能是最简单的解决方案。唯一要记住的是，您要序列化的所有类都应该具有“公共、无参数”的构造函数，并且（取决于要求）成员字段的 setter 方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-26T20:34:55.023

对于任何有相同问题并且不认为以前的答案令人满意的人......

我将 GWT 与 GWTController 一起使用，因为我使用的是 Spring，我按照[此消息](http://markmail.org/message/k5j2vni6yzcokjsw)中的描述对其进行了修改。该消息解释了如何修改 GrailsRemoteServiceServlet，但 GWTController 以相同的方式调用 RPC.decodeRequest() 和 RPC.encodeResponseForSuccess()。

这是我正在使用的 GWTController 的最终版本：

```
/**
 * Used to instantiate GWT server in Spring context.
 *
 * Original version from <a href="http://docs.google.com/Doc?docid=dw2zgx2_25492p5qxfq&hl=en">this tutorial</a>.
 * 
 * ...fixed to work as explained <a href="http://blog.js-development.com/2009/09/gwt-meets-spring.html">in this tutorial</a>.
 * 
 * ...and then fixed to use StandardSerializationPolicy as explained in
 * <a href="http://markmail.org/message/k5j2vni6yzcokjsw">this message</a> to allow
 * using Serializable instead of IsSerializable in model.
 */
public class GWTController extends RemoteServiceServlet implements Controller, ServletContextAware {

 // Instance fields

 private RemoteService remoteService;

 private Class<? extends RemoteService> remoteServiceClass;

 private ServletContext servletContext;

 // Public methods

 /**
  * Call GWT's RemoteService doPost() method and return null.
  * 
  * @param request
  *            The current HTTP request
  * @param response
  *            The current HTTP response
  * @return A ModelAndView to render, or null if handled directly
  * @throws Exception
  *             In case of errors
  */
 public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {
  doPost(request, response);
  return null; // response handled by GWT RPC over XmlHttpRequest
 }

 /**
  * Process the RPC request encoded into the payload string and return a string that encodes either the method return
  * or an exception thrown by it.
  * 
  * @param payload
  *            The RPC payload
  */
 public String processCall(String payload) throws SerializationException {
  try {
   RPCRequest rpcRequest = RPC.decodeRequest(payload, this.remoteServiceClass, this);

   // delegate work to the spring injected service
   return RPC.invokeAndEncodeResponse(this.remoteService, rpcRequest.getMethod(), rpcRequest.getParameters(), rpcRequest.getSerializationPolicy());
  } catch (IncompatibleRemoteServiceException e) {
   return RPC.encodeResponseForFailure(null, e);
  }
 }

 /**
  * Setter for Spring injection of the GWT RemoteService object.
  * 
  * @param RemoteService
  *            The GWT RemoteService implementation that will be delegated to by the {@code GWTController}.
  */
 public void setRemoteService(RemoteService remoteService) {
  this.remoteService = remoteService;
  this.remoteServiceClass = this.remoteService.getClass();
 }

 @Override
 public ServletContext getServletContext() {
  return servletContext;
 }

 public void setServletContext(ServletContext servletContext) {
  this.servletContext = servletContext;
 }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-09-23T16:38:13.657

我发现仅将它放在客户端包中或在虚拟服务接口中使用它是不够的，因为系统似乎对其进行了优化。

我发现最简单的方法是创建一个派生自服务接口中已使用的类型之一的类，并将其粘贴在客户端包中。不需要其他任何东西。

```
public class GWTSerializableTypes extends SomeTypeInServiceInterface implements IsSerializable {
    Long l;
    Double d;
    private GWTSerializableTypes() {}
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-02-06T16:04:33.800

我遇到了这个问题，但最终将问题追溯到我的 Serializable 对象中的一行代码：

```
Logger.getLogger(this.getClass().getCanonicalName()).log(Level.INFO, "Foo"); 
```

在异常被捕获之前没有其他投诉：

```
 @Override
  protected void serialize(Object instance, String typeSignature)
      throws SerializationException {
    assert (instance != null);

    Class<?> clazz = getClassForSerialization(instance);

    try {
      serializationPolicy.validateSerialize(clazz);
    } catch (SerializationException e) {
      throw new SerializationException(e.getMessage() + ": instance = " + instance);
    }
    serializeImpl(instance, clazz);
  } 
```

堆栈跟踪的业务端是：

```
com.google.gwt.user.client.rpc.SerializationException: Type 'net.your.class' was not included in the set of types which can be serialized by this SerializationPolicy or its Class object could not be loaded. For security purposes, this type will not be serialized.: instance = net.your.class@9c7edce
    at com.google.gwt.user.server.rpc.impl.ServerSerializationStreamWriter.serialize(ServerSerializationStreamWriter.java:619) 
```

# delphi - Delphi 弹出菜单可见性

> ID：138105
> 
> 赞同：4
> 
> 时间：2008-09-26T07:09:54.107
> 
> 标签：delphi, popupmenu

Delphi 7 中是否有办法确定弹出菜单是否可见（显示在屏幕上），因为它缺少 Visible 属性。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T07:48:37.273

您可以通过在 OnPopup 事件中设置它来制作自己的标志。问题是知道弹出菜单何时关闭。[彼得下面](http://groups.google.com/group/borland.public.delphi.winapi/browse_thread/thread/d4be3b47ebbf30e0/bcb981c67486cb5c?lnk=st)有一个解决方案。

但我问你为什么要这个？也许有更好的方法来解决根本问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T12:35:38.603

这似乎有点简单（我使用的是 Delphi 2007）：

在您的 WM_CONTEXTMENU 消息处理程序中，在调用继承的处理程序之前，即将显示弹出菜单，您可以设置您的标志。调用继承后，弹出菜单已关闭，重置您的标志。

```
procedure TForm1.WMContextMenu(var Message: TWMContextMenu);
begin
  FPopupActive := True;
  try
    OutputDebugString(PChar(Format('popup opening', [])));
    inherited;
  finally
    FPopupActive := False;
    OutputDebugString(PChar(Format('popup closed', [])));
  end;
end; 
```

# windows-xp - 更改图标文件中图像的顺序

> ID：138115
> 
> 赞同：0
> 
> 时间：2008-09-26T07:14:12.927
> 
> 标签：windows-xp, icons

是否有可以更改图标内图像顺序的应用程序？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T07:28:59.973

你需要做的是一个资源编辑器。[谷歌搜索](http://www.google.com/search?q=resource+editor&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)会发现许多免费的。[修复](http://www.bome.com/Restorator/)器很棒，但不是免费且价格过高的 IMO。

任何体面的资源编辑器都将允许您查看 exe 或 dll 中的图标并保存或替换它们。我不知道有什么可以让你重新排序它们，但几乎所有的东西都可以让你保存图标，然后以你想要的任何顺序将它们替换回 exe/dll 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T14:41:17.703

我所知道的唯一一个资源编辑器可以让你重新排序嵌入的图标，包括 png 压缩的 vista 图标是**[Resource Tuner Console](http://www.reseditor.com/rtc-solution-replace-icons.htm "资源编辑器")**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T10:59:15.097

[您可以使用Pixelformer](http://www.qualibyte.com/pixelformer/)（图标/位图编辑器）更改图像顺序。导入图标，根据需要重新排序图像，然后将其导出回来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-25T13:33:41.940

使用资源编辑器不是一个简单的方法，因为您必须同时编辑 ICON 和 ICON GROUP，而我尝试使用 Resource Hacker 进行此操作，但无法做到。

我发现 Easy Icon Maker 能够正确地重新排列图标的顺序......它是我发现的唯一使用此选项的图标编辑器，我尝试了大约六次。编辑器本身不如 IcoFX ( [http://portableapps.com/apps/graphics_pictures/icofx_portable](http://portableapps.com/apps/graphics_pictures/icofx_portable) )

你为什么想做这个？好吧，在某些情况下，Windows 会使用与大小匹配的第一个图标文件，但这可能不是您想要的颜色深度……例如，如果您使用的是不支持 Windows 2000 的旧机器Alpha 通道然后将它们放在 ICO 文件的开头将导致 Windows 2000 尝试渲染它，因此它会导致整个图像上出现黑点。

# java - 当我单击浏览器上的停止按钮时会发生什么？

> ID：138116
> 
> 赞同：26
> 
> 时间：2008-09-26T07:14:20.757
> 
> 标签：java, browser

假设我单击网页上的按钮以发起提交请求。然后我突然意识到我提供的一些数据是错误的，如果它被提交，那么我将面临不必要的后果（比如购物请求，我可能被迫为这个错误的请求付款）。

所以我不只是一次而是多次疯狂地点击停止按钮（以防万一）。

在这种情况下会发生什么？浏览器是否只是取消请求而不通知服务器？如果它确实通知服务器，服务器是否只是终止该进程，或者它是否还对作为该请求的一部分完成的所有操作进行一些回滚？

我用Java编码。Java 是否有任何特殊功能可用于检测 STOP 请求并回滚我们在此事务中所做的任何事情？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-26T07:34:24.033

A Web Page load from a browser is usually a 4 step process (not considering redirections):

1.  Browser sends HTTP Request, when the Server is available
2.  Server executes code (for dynamic pages)
3.  Server sends the HTTP Response (usually HTML)
4.  Browser renders HTML, and asks for other files (images, css, ...)

The browser reaction to "Stop" depends on the step your request is at that time:

*   If your server is slow or overloaded, and you hit "Stop" during step 1, nothing happens. The browser doesn't send the request.
*   Most of the times, however, "Stop" will be hit on steps 2, 3 and 4, and in those steps your code is already executed, the browser simply stops waiting for the response (2), or receiving the response (3), or rendering the response (4).

The HTTP call itself is always a 2 steps action (Request/Response), and there is no automatic way to rollback the execution from the client

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-03-23T14:47:24.867

由于这个问题可能会引起不使用 Java 的人的注意，所以我想我会提到 PHP 的行为，因为它非常令人惊讶。

PHP 在内部维护与客户端的连接状态。可能的值为 NORMAL、ABORTED 和 TIMEOUT。虽然连接状态为 NORMAL，但生活还不错，脚本将继续按预期执行。

如果用户在浏览器中单击“停止”按钮，客户端通常会关闭连接，并且状态会更改为 ABORTED。将状态更改为 ABORTED 将立即结束正在运行的脚本的执行。顺便说一句，当状态更改为 TIMEOUT 时会发生同样的事情（超出了脚本允许的运行时间的 PHP 设置）。

这种行为在某些情况下可能有用，但在其他情况下可能会出现问题。似乎在正确的 GET 请求期间随时中止应该是安全的；但是，在对服务器进行更改的请求中间中止可能会导致仅部分完成更改。

查看 PHP 手册中关于连接处理的条目，了解如何避免这种行为导致的并发症：

[http://www.php.net/manual/en/features.connection-handling.php](http://www.php.net/manual/en/features.connection-handling.php)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T07:20:32.053

一般来说，服务器不会知道你点击了停止，然后服务器端的进程就会完成。在服务器尝试将响应数据发送回客户端时，您*可能会*看到一个错误，因为连接已关闭，但同样您可能不会。你不会得到的是服务器线程突然被中断。

您可以使用各种精心设计的机制来缓解这种情况，例如让 send 向服务器发送频繁的 ajax 调用，说“仍在等待”，并让服务器在检查这些调用的新线程中执行其处理，但这并不能解决问题完全。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T07:22:45.777

客户端将立即停止传输数据并关闭其连接。十分之九的请求已经通过（可能是由于操作系统缓冲区被“刷新”到服务器）。不会向服务器发送任何额外信息，通知它您停止了请求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T07:25:25.007

您在重要场景中的提交应该有两个阶段。验证并提交。如果最终提交成功，您将提交任何交易。除了允许您的用户在提交后撤消他的操作之外，我想不出任何其他方法来真正避免这种情况。例如订单示例，在订单完成后让您的客户改变主意并取消订单（如果尚未发货）。当然，您需要编写额外的代码来支持它。

# .net - 如何在 system.net.mail 中发送富文本消息

> ID：138117
> 
> 赞同：0
> 
> 时间：2008-09-26T07:14:21.413
> 
> 标签：.net

如何在 system.net.mail 中发送富文本消息需要将邮件作为 html 发送的代码

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T07:22:18.757

```
System.Net.Mail.MailMessage mm = new System.Net.Mail.MailMessage();
mm.Body = "<html>...</html>";
mm.IsBodyHtml = true; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T07:23:39.410

```
//create the mail message
 MailMessage mail = new MailMessage();

 //set the addresses
 mail.From = new MailAddress("me@mycompany.com");
 mail.To.Add("you@yourcompany.com");

 //set the content
 mail.Subject = "This is an email";
 mail.Body = "<b>This is bold</b> <font color=#336699>This is blue</font>";
 mail.IsBodyHtml = true;

 //send the message
 SmtpClient smtp = new SmtpClient("127.0.0.1");
 smtp.Send(mail); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T07:27:21.630

您应该知道，并非每个人/邮件客户端都可以呈现 HTML 格式的消息。如果您依靠布局来明确您的信息，这可能是一个问题。

# c++ - 如何在 C++/MFC/GDI 中创建一个非常大的位图

> ID：138122
> 
> 赞同：1
> 
> 时间：2008-09-26T07:16:55.477
> 
> 标签：c++, mfc, bitmap, gdi, cdc

我希望能够在 C++ MFC 应用程序中创建一个大的（比如 20,000 x 20,000）像素位图，使用 CDC 派生类写入位图。我尝试使用 MSDN 文档中描述的内存 DC，但这些似乎仅限于与当前显示驱动程序兼容的大小。

我目前正在使用位图打印驱动程序来完成这项工作，但由于假脱机 GDI 信息，它非常慢并且使用了大量的中间存储。

我正在寻找的解决方案不应该涉及元文件或假脱机，因为我正在绘制的模型需要数百万次 GDI 调用来渲染。

我可以通过多个内存 DC 使用分而治之的方法，但这似乎是一种相当繁琐和不雅的技术。

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T07:27:46.467

CDC 和 CBitmap 似乎只支持与设备相关的位图，您可能会更幸运地使用[::CreateDIBSection](http://msdn.microsoft.com/en-us/library/ms532292(VS.85).aspx)创建位图，然后将 CBitmap 附加到该位图。不幸的是，原始的 GDI 接口有点陈旧。

至少在 32 位应用程序中，32 BPP 的 20,000 x 20,000 可能不会有太大的运气，因为它大约有 1.5 GB 的内存，但我得到了一个有效的 HBITMAP 16 bpp：

```
BITMAPINFOHEADER bmi = { sizeof(bmi) };
bmi.biWidth = 20000;
bmi.biHeight = 20000;
bmi.biPlanes = 1;
bmi.biBitCount = 16;
HDC hdc = CreateCompatibleDC(NULL);
BYTE* pbData = 0;
HBITMAP hbm = CreateDIBSection(hdc, (BITMAPINFO*)&bmi, DIB_RGB_COLORS, (void**)&pbData, NULL, 0);
DeleteObject(SelectObject(hdc, hbm)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T07:22:01.253

这是不寻常的，因为我经常基于屏幕创建一个 DC，该 DC 将用于比屏幕大得多的位图图像 - 在某些情况下超过 3000 像素 - 完全没有问题。你有一些示例代码显示这个问题吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T07:41:44.357

考虑到如此大的图像分辨率，您无法使用兼容的位图创建图像。

例子：

像素深度 = 32 位 = 每像素 4 字节

像素数 = 20.000 * 20.000 = 400.000.000

总字节数 = 像素数 * 4 = 1.600.000.000 字节 = 1.562.500 kb ~= 1525 MB ~= 1.5GB

我在猜测最终的意图，但假设您想要创建并允许用户探索具有非常详细缩放的巨大地图。您应该创建自定义图像文件格式；例如，您可以在该文件中放入包含位图网格的各种图层，以加快渲染速度。渲染过程可以使用 GDI DIB 或 GDI+ 来创建部分图像，然后将它们一起渲染。当然，这需要一些试验/优化才能达到完美的用户感觉。

祝你好运

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T08:19:24.500

为了将内存使用量保持在可接受的范围内，您必须使用“分而治之”的策略。这不是 hack，如果实施得当，它实际上是一种非常优雅的方式来处理无限大小的位图。如果设计正确，您可以结合“仅渲染/显示图像的一部分”、“以低分辨率渲染整个图像以在屏幕上显示”和“将整个图像渲染到磁盘位图”方法一个引擎并保护您的代码的用户（很可能是您自己在两周内；））免受内部影响。我在使用具有相同问题的产品：将（可能很大）映射到屏幕或 .bmp 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T08:05:40.353

如果图像必须是这个分辨率——比如 X 射线的高分辨率扫描——那么你可能想看看为它编写自定义假脱机例程——1.5 GB 非常昂贵——即使对于现代台式机也是如此。

如果它是基于矢量的，那么您可以查看 SVG，因为它支持视口，并且大多数允许您渲染为其他格式。我通过 Batik (java) 使用 SVG 到 JPG，所以可以这样做。

# design-patterns - 社区何时认为使用单例是合适的？

> ID：138124
> 
> 赞同：0
> 
> 时间：2008-09-26T07:20:02.820
> 
> 标签：design-patterns, singleton

> **可能重复：**
> [单例：应该如何使用](https://stackoverflow.com/questions/86582/singleton-how-should-it-be-used)

继 Ewan Makepeace 之前关于单例模式的出色问题之后，我想我会问“社区何时认为使用单例是合适的？”

让我举一个例子来批评：

我有一个“IconManager”单身人士。它首先读取一个属性文件，该文件指示我的图标在磁盘上的位置，然后读取所有图标并缓存它们以供将来使用。

这些图标可以在我的整个 UI 中使用（选项卡、表格、框架等）......因此通过静态 Singleton 方法访问它们非常方便。我还想确保只读取一次图标（如果每次我需要从磁盘读取它们会很慢）社区是否认为这是对单例的适当使用？如果没有，它还能如何实施？

单身人士还有哪些其他有效用途？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T07:26:19.293

另一种方法是创建加载图标的类的实例，然后将对该实例的引用传递给需要访问资源的每个控件。这样，将来您可以拥有多个图标加载器并根据需要传递它们。未来更加灵活，但有一个相当大的缺点是让您将参考传递给无数控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T07:29:31.173

您的 IconManager 实现了工厂模式，它构建图标。而且您可能只需要一个工厂来构建图标。所以这种情况下使用单例恕我直言没有问题。我已经使用其中几个集中式工厂构建了软件，并且一切正常。

另请参阅此线程：[最常见的滥用单例类示例](https://stackoverflow.com/questions/135347/most-common-examples-of-misuse-of-singleton-class)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T09:05:02.567

单例的一个很好的用途是访问可能只有一个活动连接的资源。有很多硬件设备都有这个限制。

假设您正在连接一个只允许一个连接的[闭路电视摄像机。](http://en.wikipedia.org/wiki/CCTV_camera)单例模式将在首次使用时创建此连接并保持打开状态。每当您需要来自相机的图片（可能来自多个来源）时，您可以点击 Singleton 知道，考虑到所有其他问题，图片将可用。

如果相机的初始连接时间也很慢，以这种方式保持连接打开而不是打开连接，抓取照片并再次关闭连接可能会更有效率。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-26T07:33:52.973

我实际上从未使用过单例，但没有太多使用设计模式。我认为当其他模式（如工厂模式和网关模式）需要它们时，它们非常有价值。然而，他们几乎从来都不是靠自己的好。

您可能需要考虑[单态模式](http://jeremyjarrell.com/archive/2008/04/21/88.aspx)，它为您提供了单例的所有优点，而没有很多缺点。这还允许您拥有一个富对象，该对象具有恰好具有您正在寻找的全局属性的状态。

# css - 如何使用 CSS 在表格单元格中拆分字符串（例如长 URL）？

> ID：138132
> 
> 赞同：3
> 
> 时间：2008-09-26T07:23:32.327
> 
> 标签：css, myspace, html-table

**情况**如下：我正在尝试一些 MySpace 页面定制。如果您[曾经尝试过](https://stackoverflow.com/questions/116610/myspace-dom)[stackoverflow]，我相信您会理解它是多么令人沮丧。
基本上，它可以通过 CSS 自定义，在一定的规则集内（例如，'#' 字符是不允许的......多么有用！）。
看看这个[博客](http://www.mikeindustries.com/blog/archive/2006/04/hacking-myspace-layouts)，我将其用作自定义的基础

所以唯一的问题是评论部分，“朋友”发表他们的感受。它已经...

```
max-width:423px; 
```

...设置在桌子上，但我发现如果在评论部分发布长 URL，它会吹出桌子宽度，无论最大设置如何！

**问题**：有没有办法管理会推动表格宽度的文本？
也许分割/切断字符串？还是我应该做的更多..？
URL 以文本形式发布，而不是 href。

顺便说一句，使用 Firefox 和 Firebug。

**编辑**：也不允许使用 javascript ;)

**另一个编辑**刚刚用IE7检查过，它似乎工作..所以Firefox在这种情况下很麻烦..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T07:28:17.353

Have you tried the various values for the "overflow" css property? I think that may do what you need in some permutation.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T07:31:24.883

a few browsers support [word-wrap](http://www.css3.info/preview/word-wrap/)

ex.

```
<div style="width: 50px; word-wrap: break-word">insertsuperlongwordhereplease</div> 
```

browser support currently is IE / Safari / Firefox 3.1 (Alpha)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T07:29:40.113

Your options are pretty limited, if you are using only CSS. You can try

```
 overflow: hidden 
```

to hide the offending parts. CSS 3 supports [text-wrap](http://www.w3.org/TR/css3-text/#wrapping), but support for it is probably non-existent. IIRC there is an IE-only css-property for doing the same thing, but I can't remember it at the moment and my Google-Fu fails me.

# c# - 是否有使用属性的 .NET 参数验证标准框架？

> ID：138133
> 
> 赞同：8
> 
> 时间：2008-09-26T07:23:39.330
> 
> 标签：c#, .net, validation, attributes, parameters

是否有允许您在方法属性中进行通用参数验证的标准框架（可能是企业库的一部分......或 .NET 本身）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T07:33:11.320

Microsoft Enterprise Library 具有 Microsoft.Practices.EnterpriseLibrary.Validation 库/命名空间，允许使用属性进行验证。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-09-17T11:39:57.093

[Microsoft Code Contracts](http://msdn.microsoft.com/en-us/devlabs/dd491992.aspx)是 .NET Framework 4.0 CTP 的一部分，可用于早期 .NET Framework 版本作为独立包，允许指定编码假设。这包括指定可以验证参数的前提条件。

用于参数检查的示例是（从[代码合同文档](http://download.microsoft.com/download/C/2/7/C2715F76-F56C-4D37-9231-EF8076B7EC13/userdoc.pdf)中复制）：

```
public Rational(int numerator, int denominator)
{
    Contract.Requires(denominator ! = 0);

    this.numerator = numerator;
    this.denominator = denominator;
} 
```

使用代码契约的好处是它是一个库，将成为未来 .NET Framework 版本的一部分，因此迟早您的应用程序中会减少一个依赖项。

**编辑：**刚刚注意到您特别要求使用属性进行参数检查的库......代码合同没有。Code Contracts 不使用属性的原因在他们的[FAQ](http://research.microsoft.com/en-us/projects/contracts/faq.aspx)中列出：

> 使用自定义属性的优点是它们根本不会影响代码。然而，使用方法调用的好处远远超过了看似自然的首选属性：
> 
> **运行时支持：**在不依赖二进制重写器的情况下，用属性表示的合约不能在运行时强制执行。这意味着，如果您希望在运行时强制执行先决条件（或其他协定），则需要在代码中复制这些协定，或者在构建过程中包含二进制重写器。Contract.RequiresAlways 既可用作声明性合同，也可用作运行时检查的验证。
> 
> **需要解析：**由于可以与自定义属性一起使用的值是有限的，因此条件最终被编码为字符串。这需要定义一种适用于所有源语言的新语言，需要解析字符串，复制编译器已经拥有的所有功能。
> 
> **缺乏 IDE 支持：**以字符串表示，不支持 Intellisense、类型检查或重构，所有这些都可用于将合约编写为代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-24T04:17:26.260

虽然 Microsoft 代码合同已经发布了一段时间，但它们仍然托管在 MS Research 中，您不能使用配置（app.config/database 等）来打开/关闭甚至更改规则。我的库[Bouncer](http://bouncer.codeplex.com/)确实提供了声明性规则定义：源代码中的属性或实体类/属性级别的规则的 app.config 条目。该库在 LGPL 下是开源的（您可以在商业产品中自由使用它）。如果您通过 app.config 配置规则，则无需重新编译即可调整规则设置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T07:29:58.257

[ASP.NET（和 ASP.NET MVC）的动态数据](http://www.codeplex.com/aspnet/Wiki/View.aspx?title=Dynamic%20Data&referringTitle=Home)允许您使用属性对模型属性进行验证。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T08:27:25.683

您还可以使用[postsharp](http://www.postsharp.org)并实现自己的属性进行验证。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-01T21:38:34.010

这是使用 PostSharp [http://dpatrickcaldwell.blogspot.com/2009/03/validate-parameters-using-attributes.html的示例](http://dpatrickcaldwell.blogspot.com/2009/03/validate-parameters-using-attributes.html)

# sql-server - BUILTIN\Administrators 已删除 - 如何撤消它

> ID：138142
> 
> 赞同：3
> 
> 时间：2008-09-26T07:27:28.200
> 
> 标签：sql-server, tsql

SQL Server 2000 Standard、Windows 2003
我的同事从 SQL Server 中删除了“BUILTIN\Administrators”组，这导致“SQL Server 代理”不起作用。我所有用于同步数据库的 TSQL 都停止工作。

我在服务器上拥有管理员权限，并且我的数据库用户处于 sysadmin 角色。

有谁知道如何在不从备份恢复主数据库的情况下恢复“BUILTIN\Administrators”？

**编辑：**当我尝试使用 Enterprise Manager 添加管理员或 MACHINENAME\Administrators 时，我在列表中有这个组可供选择，但是当我接受我的选择时出现错误：

`Error 15041: Windows NT user or group 'MACHINENAME\Administrators' not found. Check the name again`

当然，而不是 MACHINENAME 我看到我的服务器名称

**Edit2：**找到它

1.  以系统管理员身份登录
2.  运行以下 TSQL 查询
    `EXEC sp_grantlogin 'BUILTIN\Administrators'`
    和
    `EXEC sp_addsrvrolemember 'BUILTIN\Administrators','sysadmin'`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T07:53:26.687

您不想重新添加“BUILTIN\Administrators”，因为它是 SQL Server 2000 安全漏洞。所有域管理员都将对您的 SQL Server 拥有完整的系统管理员权限，以删除数据库等。

找到正在运行 SQL 代理的帐户（在企业管理器中右键单击 SQL Server 代理并选择属性）。然后将此帐户添加为使用 windows 身份验证的 SQL Server 登录名，并将其添加到 sysadmin 固定服务器角色。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-11-18T08:15:11.600

另一种方法是使用“NT AUTHORITY\SYSTEM”帐户连接到 SQL Server 数据库。[此方法](http://www.top-password.com/blog/how-to-reset-forgotten-sa-password-without-stopping-sql-server-instance/)要求您以系统帐户身份启动 SQL Server Management Studio。连接后，您可以创建新的登录名或重置 sa 密码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T07:35:48.477

使用企业管理器，您不能只进入登录并将“管理员”作为 Windows 登录添加到服务器吗？然后将登录添加到 sysadmin 角色？

如果您不能使用“Administrators”，请尝试“MACHINENAME\Administrators”（显然用 MACHINENAME 代替实际名称）。

抱歉，我没有更明确的答案，我真的不想尝试 :)

# powershell - What’s in your PowerShell `profile.ps1` file?

> ID：138144
> 
> 赞同：90
> 
> 时间：2008-09-26T07:28:11.503
> 
> 标签：powershell

What essential things (functions, aliases, start up scripts) do you have in your profile?

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2010-01-03T17:10:54.740

我经常发现自己需要一些基本的聚合来计算/求和一些东西。我已经定义了这些函数并经常使用它们，它们在管道末端工作得非常好：

```
#
# useful agregate
#
function count
{
    BEGIN { $x = 0 }
    PROCESS { $x += 1 }
    END { $x }
}

function product
{
    BEGIN { $x = 1 }
    PROCESS { $x *= $_ }
    END { $x }
}

function sum
{
    BEGIN { $x = 0 }
    PROCESS { $x += $_ }
    END { $x }
}

function average
{
    BEGIN { $max = 0; $curr = 0 }
    PROCESS { $max += $_; $curr += 1 }
    END { $max / $curr }
} 
```

为了能够在我的提示中使用颜色获取时间和路径：

```
function Get-Time { return $(get-date | foreach { $_.ToLongTimeString() } ) }
function prompt
{
    # Write the time 
    write-host "[" -noNewLine
    write-host $(Get-Time) -foreground yellow -noNewLine
    write-host "] " -noNewLine
    # Write the path
    write-host $($(Get-Location).Path.replace($home,"~").replace("\","/")) -foreground green -noNewLine
    write-host $(if ($nestedpromptlevel -ge 1) { '>>' }) -noNewLine
    return "> "
} 
```

以下功能是从博客中窃取并修改以适合我的口味，但带有颜色的 ls 非常好：

```
# LS.MSH 
# Colorized LS function replacement 
# /\/\o\/\/ 2006 
# http://mow001.blogspot.com 
function LL
{
    param ($dir = ".", $all = $false) 

    $origFg = $host.ui.rawui.foregroundColor 
    if ( $all ) { $toList = ls -force $dir }
    else { $toList = ls $dir }

    foreach ($Item in $toList)  
    { 
        Switch ($Item.Extension)  
        { 
            ".Exe" {$host.ui.rawui.foregroundColor = "Yellow"} 
            ".cmd" {$host.ui.rawui.foregroundColor = "Red"} 
            ".msh" {$host.ui.rawui.foregroundColor = "Red"} 
            ".vbs" {$host.ui.rawui.foregroundColor = "Red"} 
            Default {$host.ui.rawui.foregroundColor = $origFg} 
        } 
        if ($item.Mode.StartsWith("d")) {$host.ui.rawui.foregroundColor = "Green"}
        $item 
    }  
    $host.ui.rawui.foregroundColor = $origFg 
}

function lla
{
    param ( $dir=".")
    ll $dir $true
}

function la { ls -force } 
```

以及一些避免真正重复的过滤任务的捷径：

```
# behave like a grep command
# but work on objects, used
# to be still be allowed to use grep
filter match( $reg )
{
    if ($_.tostring() -match $reg)
        { $_ }
}

# behave like a grep -v command
# but work on objects
filter exclude( $reg )
{
    if (-not ($_.tostring() -match $reg))
        { $_ }
}

# behave like match but use only -like
filter like( $glob )
{
    if ($_.toString() -like $glob)
        { $_ }
}

filter unlike( $glob )
{
    if (-not ($_.tostring() -like $glob))
        { $_ }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-28T22:50:08.017

这将遍历脚本 PSDrive 并点源以“lib-”开头的所有内容。

```
### ---------------------------------------------------------------------------
### Load function / filter definition library
### ---------------------------------------------------------------------------

    Get-ChildItem scripts:\lib-*.ps1 | % { 
      . $_
      write-host "Loading library file:`t$($_.name)"
    } 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-26T14:50:50.540

为了从 PowerShell 设置我的 Visual Studio 构建环境，我从[这里](http://www.tavaresstudios.com/Blog/post/The-last-vsvars32ps1-Ill-ever-need.aspx)获取了 VsVars32 。并一直使用它。

```
################################################# #############################
# 批量暴露环境变量并在此 PS 会话中设置它们
################################################# #############################
函数 Get-Batchfile($file)
{
    $theCmd = "`"$file`" & 设置"
    cmd /c $theCmd | Foreach-对象 {
        $thePath, $theValue = $_.split('=')
        Set-Item -path env:$thePath -value $theValue
    }
}

################################################# #############################
# 设置这个 PS 会话使用的 VS 变量
################################################# #############################
函数 VsVars32($version = "9.0")
{
    $theKey = "HKLM:SOFTWARE\Microsoft\VisualStudio\" + $version
    $theVsKey = 获取项目属性 $theKey
    $theVsInstallPath = [System.IO.Path]::GetDirectoryName($theVsKey.InstallDir)
    $theVsToolsDir = [System.IO.Path]::GetDirectoryName($theVsInstallPath)
    $theVsToolsDir = [System.IO.Path]::Combine($theVsToolsDir, "工具")
    $theBatchFile = [System.IO.Path]::Combine($theVsToolsDir, "vsvars32.bat")
    获取批处理文件 $theBatchFile
    [System.Console]::Title = "Visual Studio" + $version + "Windows Powershell"
}

```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-22T20:18:28.190

***开始成绩单***。这会将您的整个会话写入文本文件。非常适合培训新员工如何在环境中使用 Powershell。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-12-26T19:48:42.710

我的提示包含：

```
$width = ($Host.UI.RawUI.WindowSize.Width - 2 - $(Get-Location).ToString().Length)
$hr = New-Object System.String @('-',$width)
Write-Host -ForegroundColor Red $(Get-Location) $hr 
```

这给了我一个在向后滚动时很容易看到的命令之间的分隔线。它还向我显示当前目录，而无需在我正在输入的行上使用水平空间。

例如：

```
C:\Users\Jay -------------------------------------------------------- -------------------------------------------------- ------------
[1] 附言>

```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-03-29T19:32:18.010

我使用了一些功能，因为我是模块作者，所以我通常会加载一个控制台并且迫切需要知道什么在哪里。

```
write-host "Your modules are..." -ForegroundColor Red
Get-module -li 
```

死硬的书呆子：

```
function prompt
{
    $host.UI.RawUI.WindowTitle = "ShellPower"
    # Need to still show the working directory.
    #Write-Host "You landed in $PWD"

    # Nerd up, yo.
    $Str = "Root@The Matrix"
    "$str> "
} 
```

强制性的任何我能 PowerShell 我将发挥作用的东西都在这里......

```
# Explorer command
function Explore
{
    param
        (
            [Parameter(
                Position = 0,
                ValueFromPipeline = $true,
                Mandatory = $true,
                HelpMessage = "This is the path to explore..."
            )]
            [ValidateNotNullOrEmpty()]
            [string]
            # First parameter is the path you're going to explore.
            $Target
        )
    $exploration = New-Object -ComObject shell.application
    $exploration.Explore($Target)
} 
```

我仍然是管理员，所以我确实需要...

```
Function RDP
{
    param
        (
            [Parameter(
                    Position = 0,
                    ValueFromPipeline = $true,
                    Mandatory = $true,
                    HelpMessage = "Server Friendly name"
            )]
            [ValidateNotNullOrEmpty()]
            [string]
            $server
        )

    cmdkey /generic:TERMSRV/$server /user:$UserName /pass:($Password.GetNetworkCredential().Password)
    mstsc /v:$Server /f /admin
    Wait-Event -Timeout 5
    cmdkey /Delete:TERMSRV/$server
} 
```

有时我想以登录用户以外的人身份启动资源管理器......

```
# Restarts explorer as the user in $UserName
function New-Explorer
{
    # CLI prompt for password

    taskkill /f /IM Explorer.exe
    runas /noprofile /netonly /user:$UserName explorer
} 
```

这只是因为它很有趣。

```
Function Lock-RemoteWorkstation
{
    param(
        $Computername,
        $Credential
    )

    if(!(get-module taskscheduler))
    {
        Import-Module TaskScheduler
    }
    New-task -ComputerName $Computername -credential:$Credential |
        Add-TaskTrigger -In (New-TimeSpan -Seconds 30) |
        Add-TaskAction -Script `
        {
            $signature = @"
            [DllImport("user32.dll", SetLastError = true)]
            public static extern bool LockWorkStation();
            "@
                $LockWorkStation = Add-Type -memberDefinition $signature -name "Win32LockWorkStation" -namespace Win32Functions -passthru
                $LockWorkStation::LockWorkStation() | Out-Null
        } | Register-ScheduledTask TestTask -ComputerName $Computername -credential:$Credential
} 
```

我也有一个，因为`Win`+`L`太远了......

```
Function llm # Lock Local machine
{
    $signature = @"
    [DllImport("user32.dll", SetLastError = true)]
    public static extern bool LockWorkStation();
    "@
        $LockWorkStation = Add-Type -memberDefinition $signature -name "Win32LockWorkStation" -namespace Win32Functions -passthru

        $LockWorkStation::LockWorkStation() | Out-Null
} 
```

几个过滤器？我认同...

```
 filter FileSizeBelow($size){if($_.length -le $size){ $_ }}
 filter FileSizeAbove($size){if($_.Length -ge $size){$_}} 
```

我还有一些我还不能发布，因为它们还没有完成，但它们基本上是一种在会话之间保留凭据而不将它们作为加密文件写出的方法。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-09-28T14:02:03.357

```
# ----------------------------------------------------------
# msdn search for win32 APIs.
# ----------------------------------------------------------

function Search-MSDNWin32
{

    $url = 'http://search.msdn.microsoft.com/?query=';

    $url += $args[0];

    for ($i = 1; $i -lt $args.count; $i++) {
        $url += '+';
        $url += $args[$i];
    }

    $url += '&locale=en-us&refinement=86&ac=3';

    Open-IE($url);
}

# ----------------------------------------------------------
# Open Internet Explorer given the url.
# ----------------------------------------------------------

function Open-IE ($url)
{    
    $ie = new-object -comobject internetexplorer.application;

    $ie.Navigate($url);

    $ie.Visible = $true;
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-01T17:35:13.117

这是我不那么微妙的个人资料

```
 #==============================================================================
# Jared Parsons PowerShell Profile (jaredp@rantpack.org) 
#==============================================================================

#==============================================================================
# Common Variables Start
#==============================================================================
$global:Jsh = new-object psobject 
$Jsh | add-member NoteProperty "ScriptPath" $(split-path -parent $MyInvocation.MyCommand.Definition) 
$Jsh | add-member NoteProperty "ConfigPath" $(split-path -parent $Jsh.ScriptPath)
$Jsh | add-member NoteProperty "UtilsRawPath" $(join-path $Jsh.ConfigPath "Utils")
$Jsh | add-member NoteProperty "UtilsPath" $(join-path $Jsh.UtilsRawPath $env:PROCESSOR_ARCHITECTURE)
$Jsh | add-member NoteProperty "GoMap" @{}
$Jsh | add-member NoteProperty "ScriptMap" @{}

#==============================================================================

#==============================================================================
# Functions 
#==============================================================================

# Load snapin's if they are available
function Jsh.Load-Snapin([string]$name) {
    $list = @( get-pssnapin | ? { $_.Name -eq $name })
    if ( $list.Length -gt 0 ) {
        return; 
    }

    $snapin = get-pssnapin -registered | ? { $_.Name -eq $name }
    if ( $snapin -ne $null ) {
        add-pssnapin $name
    }
}

# Update the configuration from the source code server
function Jsh.Update-WinConfig([bool]$force=$false) {

    # First see if we've updated in the last day 
    $target = join-path $env:temp "Jsh.Update.txt"
    $update = $false
    if ( test-path $target ) {
        $last = [datetime] (gc $target)
        if ( ([DateTime]::Now - $last).Days -gt 1) {
            $update = $true
        }
    } else {
        $update = $true;
    }

    if ( $update -or $force ) {
        write-host "Checking for winconfig updates"
        pushd $Jsh.ConfigPath
        $output = @(& svn update)
        if ( $output.Length -gt 1 ) {
            write-host "WinConfig updated.  Re-running configuration"
            cd $Jsh.ScriptPath
            & .\ConfigureAll.ps1
            . .\Profile.ps1
        }

        sc $target $([DateTime]::Now)
        popd
    }
}

function Jsh.Push-Path([string] $location) { 
    go $location $true 
}
function Jsh.Go-Path([string] $location, [bool]$push = $false) {
    if ( $location -eq "" ) {
        write-output $Jsh.GoMap
    } elseif ( $Jsh.GoMap.ContainsKey($location) ) {
        if ( $push ) {
            push-location $Jsh.GoMap[$location]
        } else {
            set-location $Jsh.GoMap[$location]
        }
    } elseif ( test-path $location ) {
        if ( $push ) {
            push-location $location
        } else {
            set-location $location
        }
    } else {
        write-output "$loctaion is not a valid go location"
        write-output "Current defined locations"
        write-output $Jsh.GoMap
    }
}

function Jsh.Run-Script([string] $name) {
    if ( $Jsh.ScriptMap.ContainsKey($name) ) {
        . $Jsh.ScriptMap[$name]
    } else {
        write-output "$name is not a valid script location"
        write-output $Jsh.ScriptMap
    }
}

# Set the prompt
function prompt() {
    if ( Test-Admin ) { 
        write-host -NoNewLine -f red "Admin "
    }
    write-host -NoNewLine -ForegroundColor Green $(get-location)
    foreach ( $entry in (get-location -stack)) {
        write-host -NoNewLine -ForegroundColor Red '+';
    }
    write-host -NoNewLine -ForegroundColor Green '>'
    ' '
}

#==============================================================================

#==============================================================================
# Alias 
#==============================================================================
set-alias gcid      Get-ChildItemDirectory
set-alias wget      Get-WebItem
set-alias ss        select-string
set-alias ssr       Select-StringRecurse 
set-alias go        Jsh.Go-Path
set-alias gop       Jsh.Push-Path
set-alias script    Jsh.Run-Script
set-alias ia        Invoke-Admin
set-alias ica       Invoke-CommandAdmin
set-alias isa       Invoke-ScriptAdmin
#==============================================================================

pushd $Jsh.ScriptPath

# Setup the go locations
$Jsh.GoMap["ps"]        = $Jsh.ScriptPath
$Jsh.GoMap["config"]    = $Jsh.ConfigPath
$Jsh.GoMap["~"]         = "~"

# Setup load locations
$Jsh.ScriptMap["profile"]       = join-path $Jsh.ScriptPath "Profile.ps1"
$Jsh.ScriptMap["common"]        = $(join-path $Jsh.ScriptPath "LibraryCommon.ps1")
$Jsh.ScriptMap["svn"]           = $(join-path $Jsh.ScriptPath "LibrarySubversion.ps1")
$Jsh.ScriptMap["subversion"]    = $(join-path $Jsh.ScriptPath "LibrarySubversion.ps1")
$Jsh.ScriptMap["favorites"]     = $(join-path $Jsh.ScriptPath "LibraryFavorites.ps1")
$Jsh.ScriptMap["registry"]      = $(join-path $Jsh.ScriptPath "LibraryRegistry.ps1")
$Jsh.ScriptMap["reg"]           = $(join-path $Jsh.ScriptPath "LibraryRegistry.ps1")
$Jsh.ScriptMap["token"]         = $(join-path $Jsh.ScriptPath "LibraryTokenize.ps1")
$Jsh.ScriptMap["unit"]          = $(join-path $Jsh.ScriptPath "LibraryUnitTest.ps1")
$Jsh.ScriptMap["tfs"]           = $(join-path $Jsh.ScriptPath "LibraryTfs.ps1")
$Jsh.ScriptMap["tab"]           = $(join-path $Jsh.ScriptPath "TabExpansion.ps1")

# Load the common functions
. script common
. script tab
$global:libCommonCertPath = (join-path $Jsh.ConfigPath "Data\Certs\jaredp_code.pfx")

# Load the snapin's we want
Jsh.Load-Snapin "pscx"
Jsh.Load-Snapin "JshCmdlet" 

# Setup the Console look and feel
$host.UI.RawUI.ForegroundColor = "Yellow"
if ( Test-Admin ) {
    $title = "Administrator Shell - {0}" -f $host.UI.RawUI.WindowTitle
    $host.UI.RawUI.WindowTitle = $title;
}

# Call the computer specific profile
$compProfile = join-path "Computers" ($env:ComputerName + "_Profile.ps1")
if ( -not (test-path $compProfile)) { ni $compProfile -type File | out-null }
write-host "Computer profile: $compProfile"
. ".\$compProfile"
$Jsh.ScriptMap["cprofile"] = resolve-path ($compProfile)

# If the computer name is the same as the domain then we are not 
# joined to active directory
if ($env:UserDomain -ne $env:ComputerName ) {
    # Call the domain specific profile data
    write-host "Domain $env:UserDomain"
    $domainProfile = join-path $env:UserDomain "Profile.ps1"
    if ( -not (test-path $domainProfile))  { ni $domainProfile -type File | out-null }
    . ".\$domainProfile"
}

# Run the get-fortune command if JshCmdlet was loaded
if ( get-command "get-fortune" -ea SilentlyContinue ) {
    get-fortune -timeout 1000
}

# Finished with the profile, go back to the original directory
popd

# Look for updates
Jsh.Update-WinConfig

# Because this profile is run in the same context, we need to remove any 
# variables manually that we don't want exposed outside this script 

```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-28T13:55:42.933

我什么都保留一点。大多数情况下，我的配置文件设置了所有环境（包括调用脚本来设置我的 .NET/VS 和 Java 开发环境）。

我还`prompt()`用我自己的风格重新定义了函数（[见实际操作](http://www.winterdom.com/weblog/2008/08/14/MyPowerShellPrompt.aspx)），为其他脚本和命令设置了几个别名。并更改`$HOME`指向的内容。

这是我完整的[个人资料脚本](http://github.com/tomasr/dotfiles/tree/master/.profile.ps1)。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-26T08:03:17.193

apropos.

Although I think this has been superseded by a recent or upcoming release.

```
############################################################################## 
## Search the PowerShell help documentation for a given keyword or regular 
## expression.
## 
## Example:
##    Get-HelpMatch hashtable
##    Get-HelpMatch "(datetime|ticks)"
############################################################################## 
function apropos {

    param($searchWord = $(throw "Please specify content to search for"))

    $helpNames = $(get-help *)

    foreach($helpTopic in $helpNames)
    {
       $content = get-help -Full $helpTopic.Name | out-string
       if($content -match $searchWord)
       { 
          $helpTopic | select Name,Synopsis
       }
    }
} 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-12-22T07:22:50.660

我添加了此功能，以便我可以轻松查看磁盘使用情况：

```
function df {
    $colItems = Get-wmiObject -class "Win32_LogicalDisk" -namespace "root\CIMV2" `
    -computername localhost

    foreach ($objItem in $colItems) {
        write $objItem.DeviceID $objItem.Description $objItem.FileSystem `
            ($objItem.Size / 1GB).ToString("f3") ($objItem.FreeSpace / 1GB).ToString("f3")

    }
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-12-16T08:40:26.863

```
Set-PSDebug -Strict 
```

如果您曾经搜索过愚蠢的错字，那么您将受益匪浅。输出 $varsometext 而不是 $var sometext

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-28T22:53:10.303

这将创建一个 scripts: drive 并将其添加到您的路径中。请注意，您必须自己创建文件夹。下次您需要返回它时，只需键入“脚本：”并按 Enter，就像 Windows 中的任何驱动器号一样。

```
$env:path += ";$profiledir\scripts"
New-PSDrive -Name Scripts -PSProvider FileSystem -Root $profiledir\scripts 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-28T22:57:58.137

这会将您已安装的管理单元添加到您的 powershell 会话中。您可能想要做这样的事情的原因是它易于维护，并且如果您在多个系统之间同步您的个人资料，则效果很好。如果未安装管理单元，您将不会看到错误消息。

### -------------------------------------------------- -------------------------

### 添加第三方管理单元

### -------------------------------------------------- -------------------------

```
$snapins = @(
    "Quest.ActiveRoles.ADManagement",
    "PowerGadgets",
    "VMware.VimAutomation.Core",
    "NetCmdlets"
)
$snapins | ForEach-Object { 
  if ( Get-PSSnapin -Registered $_ -ErrorAction SilentlyContinue ) {
    Add-PSSnapin $_
  }
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-09-26T08:02:03.560

```
############################################################################## 
# Get an XPath Navigator object based on the input string containing xml
function get-xpn ($text) { 
    $rdr = [System.IO.StringReader] $text
    $trdr = [system.io.textreader]$rdr
    $xpdoc = [System.XML.XPath.XPathDocument] $trdr
    $xpdoc.CreateNavigator()
} 
```

Useful for working with xml, such as output from svn commands with --xml.

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-10-06T15:12:54.193

我将所有函数和别名放在单独的脚本文件中，然后将它们点源到我的配置文件中：

. c:\scripts\posh\jdh-functions.ps1

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-11-01T16:00:50.177

查看键入命令的整个历史记录的功能（Get-History，他的别名 h 默认只显示最后 32 个命令）：

```
function ha {
    Get-History -count $MaximumHistoryCount
} 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2011-07-31T06:46:50.423

我实际上将我的保留在[github 上](https://github.com/scottmuc/poshfiles)。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2012-04-26T16:05:10.740

除许多其他事项外：

```
function w {
    explorer .
} 
```

在当前目录中打开一个资源管理器窗口

```
function startover {
    iisreset /restart
    iisreset /stop

    rm "C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\*.*" -recurse -force -Verbose

    iisreset /start
} 
```

删除我的临时 asp.net 文件中的所有内容（对于处理依赖于有问题的非托管代码的托管代码很有用）

```
function edit($x) {
    . 'C:\Program Files (x86)\Notepad++\notepad++.exe' $x
} 
```

在记事本++中编辑$x

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2011-10-05T21:42:22.747

```
Function funcOpenPowerShellProfile
{
    Notepad $PROFILE
}

Set-Alias fop funcOpenPowerShellProfile 
```

只有[聪明懒惰的人](https://web.archive.org/web/20170222194554/http://www.undefined.com/ia/2006/10/24/the-fourteen-types-of-programmers-type-4-lazy-ones/)会告诉您，这`fop`比`Notepad $PROFILE`按提示输入要容易得多，当然，除非您将“fop”与[17 世纪的英语 ninny](http://en.wikipedia.org/wiki/Fop)联系起来。

* * *

如果你愿意，你可以更进一步，让它有点用处：

```
Function funcOpenPowerShellProfile
{
    $fileProfileBackup = $PROFILE + '.bak'
    cp $PROFILE $fileProfileBackup
    PowerShell_ISE $PROFILE # Replace with Desired IDE/ISE for Syntax Highlighting
}

Set-Alias fop funcOpenPowerShellProfile 
```

* * *

为了满足生存主义者的偏执狂：

```
Function funcOpenPowerShellProfile
{
    $fileProfilePathParts = @($PROFILE.Split('\'))
    $fileProfileName = $fileProfilePathParts[-1]
    $fileProfilePathPartNum = 0
    $fileProfileHostPath = $fileProfilePathParts[$fileProfilePathPartNum] + '\'
    $fileProfileHostPathPartsCount = $fileProfilePathParts.Count - 2
        # Arrays start at 0, but the Count starts at 1; if both started at 0 or 1, 
        # then a -1 would be fine, but the realized discrepancy is 2
    Do
    {
        $fileProfilePathPartNum++
        $fileProfileHostPath = $fileProfileHostPath + `
            $fileProfilePathParts[$fileProfilePathPartNum] + '\'
    }
    While
    (
        $fileProfilePathPartNum -LT $fileProfileHostPathPartsCount
    )
    $fileProfileBackupTime = [string](date -format u) -replace ":", ""
    $fileProfileBackup = $fileProfileHostPath + `
        $fileProfileBackupTime + ' - ' + $fileProfileName + '.bak'
    cp $PROFILE $fileProfileBackup

    cd $fileProfileHostPath
    $fileProfileBackupNamePattern = $fileProfileName + '.bak'
    $fileProfileBackups = @(ls | Where {$_.Name -Match $fileProfileBackupNamePattern} | `
        Sort Name)
    $fileProfileBackupsCount = $fileProfileBackups.Count
    $fileProfileBackupThreshold = 5 # Change as Desired
    If
    (
        $fileProfileBackupsCount -GT $fileProfileBackupThreshold
    )
    {
        $fileProfileBackupsDeleteNum = $fileProfileBackupsCount - `
            $fileProfileBackupThreshold
        $fileProfileBackupsIndexNum = 0
        Do
        {

            rm $fileProfileBackups[$fileProfileBackupsIndexNum]
            $fileProfileBackupsIndexNum++;
            $fileProfileBackupsDeleteNum--
        }
        While
        (
            $fileProfileBackupsDeleteNum -NE 0
        )
    }

    PowerShell_ISE $PROFILE
        # Replace 'PowerShell_ISE' with Desired IDE (IDE's path may be needed in 
        # '$Env:PATH' for this to work; if you can start it from the "Run" window, 
        # you should be fine)
}

Set-Alias fop funcOpenPowerShellProfile 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2014-06-06T23:03:07.840

Jeffrey Snover 的[Start-NewScope](http://blogs.msdn.com/b/powershell/archive/2006/04/25/583268.aspx)因为重新启动 shell 可能会很麻烦。

我从来没有对[diruse](http://ss64.com/nt/diruse.html)选项感到满意，[所以](http://blogs.technet.com/b/heyscriptingguy/archive/2013/01/05/weekend-scripter-sorting-folders-by-size.aspx)：

```
function Get-FolderSizes { # poor man's du
  [cmdletBinding()]
  param(
    [parameter(mandatory=$true)]$Path,
    [parameter(mandatory=$false)]$SizeMB,
    [parameter(mandatory=$false)]$ExcludeFolders,
    [parameter(mandatory=$false)][switch]$AsObject
  ) #close param
  # http://blogs.technet.com/b/heyscriptingguy/archive/2013/01/05/weekend-scripter-sorting-folders-by-size.aspx
  # uses Christoph Schneegans' Find-Files https://schneegans.de/windows/find-files/ because "gci -rec" follows junctions in "special" folders
  $pathCheck = test-path $path
  if (!$pathcheck) { Write-Error "Invalid path. Wants gci's -path parameter."; return }
  if (!(Get-Command Find-Files)) { Write-Error "Required function Find-Files not found"; return }
  $fso = New-Object -ComObject scripting.filesystemobject
  $parents = Get-ChildItem $path -Force | where { $_.PSisContainer -and $ExcludeFolders -notContains $_.name -and !$_.LinkType }
  $folders = Foreach ($folder in $parents)
  {
    $getFolder = $fso.getFolder( $folder.fullname.tostring() )
    if (!$getFolder.Size)
    { 
      #for "special folders" like appdata
      # maybe "-Attributes !ReparsePoint" works in v6? https://stackoverflow.com/a/59952913/
      # what about https://superuser.com/a/650476/ ?
      # abandoned because it follows junctions, distorting results # $length = gci $folder.FullName -Recurse -Force -EA SilentlyContinue | Measure -Property Length -Sum
      $length = Find-Files $folder.FullName -EA SilentlyContinue | Measure -Property Length -Sum -EA SilentlyContinue
      $sizeMBs = "{0:N0}" -f ($length.Sum /1mb)
    } #close if size property is null
    else { $sizeMBs = "{0:N0}" -f ($getFolder.size /1mb) }
    New-Object -TypeName psobject -Property @{
      Name = $getFolder.Path
      SizeMB = $sizeMBs
    } #close new obj property
  } #close foreach folder
  #here's the output
  $foldersObj = $folders | Sort @{E={[decimal]$_.SizeMB}} -Descending | ? {[Decimal]$_.SizeMB -gt $SizeMB}
  if (!$AsObject) { $foldersObj | Format-Table -AutoSize } else { $foldersObj }
  #calculate the total including contents
  $sum = $folders | Select -Expand SizeMB | Measure -Sum | Select -Expand Sum
  $sum += ( gci $path | where {!$_.psIsContainer} | Measure -Property Length -Sum | Select -Expand Sum ) / 1mb
  $sumString = "{0:n2}" -f ($sum /1kb)
  $sumString + " GB total" 
} #end function
Set-Alias gfs Get-FolderSizes

function Find-Files
{
    <# by Christoph Schneegans https://schneegans.de/windows/find-files/ - used in Get-FolderSizes aka gfs
    .SYNOPSIS
        Lists the contents of a directory. Unlike Get-ChildItem, this function does not recurse into symbolic links or junctions in order to avoid infinite loops.
    #>

    param (
        [Parameter( Mandatory=$false )]
        [string]
        # Specifies the path to the directory whose contents are to be listed. By default, the current working directory is used.
        $LiteralPath = (Get-Location),

        [Parameter( Mandatory=$false )]
        # Specifies a filter that is applied to each file or directory. Wildcards ? and * are supported.
        $Filter,

        [Parameter( Mandatory=$false )]
        [boolean]
        # Specifies if file objects should be returned. By default, all file system objects are returned.
        $File = $true,

        [Parameter( Mandatory=$false )]
        [boolean]
        # Specifies if directory objects should be returned. By default, all file system objects are returned.
        $Directory = $true,

        [Parameter( Mandatory=$false )]
        [boolean]
        # Specifies if reparse point objects should be returned. By default, all file system objects are returned.
        $ReparsePoint = $true,

        [Parameter( Mandatory=$false )]
        [boolean]
        # Specifies if the top directory should be returned. By default, all file system objects are returned.
        $Self = $true
    )

    function Enumerate( [System.IO.FileSystemInfo] $Item ) {
        $Item;
        if ( $Item.GetType() -eq [System.IO.DirectoryInfo] -and ! $Item.Attributes.HasFlag( [System.IO.FileAttributes]::ReparsePoint ) ) {
            foreach ($ChildItem in $Item.EnumerateFileSystemInfos() ) {
                Enumerate $ChildItem;
            }
        }
    }

    function FilterByName {
        process {
            if ( ( $Filter -eq $null ) -or ( $_.Name -ilike $Filter ) ) {
                $_;
            }
        }
    }

    function FilterByType {
        process {
            if ( $_.GetType() -eq [System.IO.FileInfo] ) {
                if ( $File ) { $_; }
            } elseif ( $_.Attributes.HasFlag( [System.IO.FileAttributes]::ReparsePoint ) ) {
                if ( $ReparsePoint ) { $_; }
            } else {
                if ( $Directory ) { $_; }
            }
        }
    }

    $Skip = if ($Self) { 0 } else { 1 };
    Enumerate ( Get-Item -LiteralPath $LiteralPath -Force ) | Select-Object -Skip $Skip | FilterByName | FilterByType;
} # end function find-files 
```

上面最有价值的一点是 Christoph Schneegans 的`Find-Files` [https://schneegans.de/windows/find-files](https://schneegans.de/windows/find-files)

指向东西：

```
function New-URLfile {
  param( [parameter(mandatory=$true)]$Target, [parameter(mandatory=$true)]$Link )
  if ($target -match "^\." -or $link -match "^\.") {"Full paths plz."; break}
  $content = @()
  $header = '[InternetShortcut]'
  $content += $header
  $content += "URL=" + $target
  $content | out-file $link  
  ii $link
} #end function

function New-LNKFile {
  param( [parameter(mandatory=$true)]$Target, [parameter(mandatory=$true)]$Link )
  if ($target -match "^\." -or $link -match "^\.") {"Full paths plz."; break}
  $WshShell = New-Object -comObject WScript.Shell
  $Shortcut = $WshShell.CreateShortcut($link)
  $Shortcut.TargetPath = $target
  $shortCut.save()
} #end function new-lnkfile 
```

穷人的grep？用于搜索大型 txt 文件。

```
function Search-TextFile {
  param( 
    [parameter(mandatory=$true)]$File,
    [parameter(mandatory=$true)]$SearchText
  ) #close param
  if ( !(Test-path $File) )
  { 
    Write-Error "File not found: $file" 
    return
  }
  $fullPath = Resolve-Path $file | select -Expand ProviderPath
  $lines = [System.IO.File]::ReadLines($fullPath)
  foreach ($line in $lines) { if ($line -match $SearchText) {$line} }
} #end function Search-TextFile
Set-Alias stf Search-TextFile 
```

列出远程计算机上安装的程序。

```
function Get-InstalledProgram { [cmdletBinding()] #http://blogs.technet.com/b/heyscriptingguy/archive/2011/11/13/use-powershell-to-quickly-find-installed-software.aspx
      param( [parameter(mandatory=$true)]$Comp,[parameter(mandatory=$false)]$Name )
      $keys = 'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall','SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall'
      TRY { $RegBase = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey([Microsoft.Win32.RegistryHive]::LocalMachine,$Comp) }
      CATCH {
        $rrSvc = gwmi win32_service -comp $comp -Filter {name='RemoteRegistry'}
        if (!$rrSvc) {"Unable to connect. Make sure that this computer is on the network, has remote administration enabled, `nand that both computers are running the remote registry service."; break}
        #Enable and start RemoteRegistry service
        if ($rrSvc.State -ne 'Running') {
          if ($rrSvc.StartMode -eq 'Disabled') { $null = $rrSvc.ChangeStartMode('Manual'); $undoMe2 = $true }
          $null = $rrSvc.StartService() ; $undoMe = $true       
        } #close if rrsvc not running
          else {"Unable to connect. Make sure that this computer is on the network, has remote administration enabled, `nand that both computers are running the remote registry service."; break}
        $RegBase = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey([Microsoft.Win32.RegistryHive]::LocalMachine,$Comp)  
      } #close if failed to connect regbase
      $out = @()
      foreach ($key in $keys) {
         if ( $RegBase.OpenSubKey($Key) ) { #avoids errors on 32bit OS
          foreach ( $entry in $RegBase.OpenSubKey($Key).GetSubkeyNames() ) {
            $sub = $RegBase.OpenSubKey( ($key + '\' + $entry) )
            if ($sub) { $row = $null
              $row = [pscustomobject]@{
                Name = $RegBase.OpenSubKey( ($key + '\' + $entry) ).GetValue('DisplayName')
                InstallDate = $RegBase.OpenSubKey( ($key + '\' + $entry) ).GetValue('InstallDate')
                Version = $RegBase.OpenSubKey( ($key + '\' + $entry) ).GetValue('DisplayVersion')
              } #close row
              $out += $row
            } #close if sub
          } #close foreach entry
        } #close if key exists
      } #close foreach key
      $out | where {$_.name -and $_.name -match $Name}
      if ($undoMe) { $null = $rrSvc.StopService() }
      if ($undoMe2) { $null = $rrSvc.ChangeStartMode('Disabled') }
    } #end function 
```

去元，传播福音，诸如此类

```
function Copy-ProfilePS1 ($Comp,$User) {
  if (!$User) {$User = $env:USERNAME}
  $targ = "\\$comp\c$\users\$User\Documents\WindowsPowershell\"
  if (Test-Path $targ)
  {
    $cmd = "copy /-Y $profile $targ"
    cmd /c $cmd
  } else {"Path not found! $targ"}
} #end function CopyProfilePS1 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2010-02-03T11:23:37.977

[您可以在http://github.com/jamesottaway/windowspowershell](http://github.com/jamesottaway/windowspowershell)查看我的 PowerShell 配置文件

如果您使用 Git 将我的 repo 克隆到您的 Documents 文件夹（或 $PROFILE 变量中“WindowsPowerShell”上方的任何文件夹），您将得到我所有的好处。

main`profile.ps1`设置名称`Addons`为 a的子文件夹`PSDrive`，然后查找该文件夹下的所有 .ps1 文件进行加载。

我非常喜欢这个`go`命令，它存储了一个速记位置字典，以便轻松访问。例如，`go vsp`将带我到`C:\Visual Studio 2008\Projects`.

我还喜欢覆盖`Set-Location`cmdlet 以同时运行`Set-Location`和`Get-ChildItem`.

我的另一个最爱是能够在运行后执行`mkdir`which does 。`Set-Location xyz``New-Item xyz -Type Directory`

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-26T12:27:48.047

```
$MaximumHistoryCount=1024 
function hist {get-history -count 256 | %{$_.commandline}}

New-Alias which get-command

function guidConverter([byte[]] $gross){ $GUID = "{" + $gross[3].ToString("X2") + `
$gross[2].ToString("X2") + $gross[1].ToString("X2") + $gross[0].ToString("X2") + "-" + `
$gross[5].ToString("X2") + $gross[4].ToString("X2") + "-" + $gross[7].ToString("X2") + `
$gross[6].ToString("X2") + "-" + $gross[8].ToString("X2") + $gross[9].ToString("X2") + "-" +` 
$gross[10].ToString("X2") + $gross[11].ToString("X2") + $gross[12].ToString("X2") + `
$gross[13].ToString("X2") + $gross[14].ToString("X2") + $gross[15].ToString("X2") + "}" $GUID } 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-09-16T21:15:15.567

我的个人资料是空的。相反，我有脚本文件夹，我可以导航以将功能和别名加载到会话中。一个文件夹将是模块化的，带有函数库和程序集。对于临时工作，我将有一个脚本来加载别名和函数。如果我想处理事件日志，我会导航到文件夹 scripts\eventlogs 并执行

```
PS > . .\DotSourceThisToLoadSomeHandyEventLogMonitoringFunctions.ps1 
```

我这样做是因为我需要与其他人共享脚本或将它们从一台机器移动到另一台机器。我希望能够复制一个包含脚本和程序集的文件夹，并让它在任何机器上为任何用户工作。

但是你想要一个有趣的技巧集合。这是我的许多“个人资料”所依赖的脚本。它允许调用使用自签名 SSL 的 Web 服务，以便对开发中的 Web 服务进行临时探索。是的，我在我的 powershell 脚本中自由地混合了 C#。

```
# Using a target web service that requires SSL, but server is self-signed.  
# Without this, we'll fail unable to establish trust relationship. 
function Set-CertificateValidationCallback
{
    try
    {
       Add-Type @'
    using System;

    public static class CertificateAcceptor{

        public static void SetAccept()
        {
            System.Net.ServicePointManager.ServerCertificateValidationCallback = AcceptCertificate;
        }

        private static bool AcceptCertificate(Object sender,
                        System.Security.Cryptography.X509Certificates.X509Certificate certificate,
                        System.Security.Cryptography.X509Certificates.X509Chain chain,
                        System.Net.Security.SslPolicyErrors policyErrors)
            {
                Console.WriteLine("Accepting certificate and ignoring any SSL errors.");
                return true;
            }
    }
'@
    }
    catch {} # Already exists? Find a better way to check.

     [CertificateAcceptor]::SetAccept()
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-07-21T17:46:56.537

好问题。因为我处理几个不同的 PowerShell 主机，所以我在几个配置文件中的每一个都做一些日志记录，只是为了使任何其他消息的上下文更清晰。在`profile.ps1`，我目前只有那个，但我有时会根据上下文更改它：

```
if ($PSVersionTable.PsVersion.Major -ge 3) {
    Write-Host "Executing $PSCommandPath"
} 
```

我最喜欢的主机是 ISE，在 中`Microsoft.PowerShellIse_profile.ps1`，我有：

```
if ($PSVersionTable.PsVersion.Major -ge 3) {
    Write-Host "Executing $PSCommandPath"
}

if ( New-PSDrive -ErrorAction Ignore One FileSystem `
        (Get-ItemProperty hkcu:\Software\Microsoft\SkyDrive UserFolder).UserFolder) { 
    Write-Host -ForegroundColor Green "PSDrive One: mapped to local OneDrive/SkyDrive folder"
    }

Import-Module PSCX

$PSCX:TextEditor = (get-command Powershell_ISE).Path

$PSDefaultParameterValues = @{
    "Get-Help:ShowWindow" = $true
    "Help:ShowWindow" = $true
    "Out-Default:OutVariable" = "0"
}

#Script Browser Begin
#Version: 1.2.1
Add-Type -Path 'C:\Program Files (x86)\Microsoft Corporation\Microsoft Script Browser\System.Windows.Interactivity.dll'
Add-Type -Path 'C:\Program Files (x86)\Microsoft Corporation\Microsoft Script Browser\ScriptBrowser.dll'
Add-Type -Path 'C:\Program Files (x86)\Microsoft Corporation\Microsoft Script Browser\BestPractices.dll'
$scriptBrowser = $psISE.CurrentPowerShellTab.VerticalAddOnTools.Add('Script Browser', [ScriptExplorer.Views.MainView], $true)
$scriptAnalyzer = $psISE.CurrentPowerShellTab.VerticalAddOnTools.Add('Script Analyzer', [BestPractices.Views.BestPracticesView], $true)
$psISE.CurrentPowerShellTab.VisibleVerticalAddOnTools.SelectedAddOnTool = $scriptBrowser
#Script Browser End 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-07-14T22:11:42.427

在尚未列出的所有内容中，***Start-Steroids***必须是我最喜欢的，除了 Start-Transcript。

（[http://www.powertheshell.com/isesteroids2-2/](http://www.powertheshell.com/isesteroids2-2/)）

# c++ - ncurses可用于Windows吗？

> ID：138153
> 
> 赞同：64
> 
> 时间：2008-09-26T07:30:33.090
> 
> 标签：c++, c, ncurses

Windows 的 C/C++ 中是否有任何 ncurses 库可以在本机可调整大小的 Win32 窗口（*不在*控制台模式下）中模拟 ncurses？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2010-09-21T15:25:45.047

PDCurses 移植正在进行中：

[http://www.mail-archive.com/pdcurses-l@lightlink.com/msg00129.html](http://www.mail-archive.com/pdcurses-l@lightlink.com/msg00129.html)

[http://www.projectpluto.com/win32a.htm](http://www.projectpluto.com/win32a.htm)

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-10-05T00:38:35.313

这样的事情可能并不“按原样”存在。它在 Linux 或其他类似 UNIX 的操作系统上也不存在。

ncurses 只是一个帮助您管理与底层终端环境交互的库。但它本身不提供终端仿真器。

实际在屏幕上显示内容的东西（在您的要求中被列为“本机可调整大小的 win32 窗口”）通常称为终端仿真器。如果您不喜欢 Windows 附带的那个（您并不孤单；地球上没有人喜欢），还有一些替代方案。有[Console](http://sourceforge.net/projects/console/)，根据我的经验，它有时可以工作，并且似乎只是包装了一个底层的 Windows 终端仿真器（我不确定，但我猜，因为有一个菜单选项可以实际访问该底层终端仿真器，果然会出现一个旧的硬壳 Windows/DOS 框，它反映了控制台窗口中的所有内容）。

**更好的选择**

另一种可能更具吸引力的选择是[puttycyg](http://code.google.com/p/puttycyg/)。它与 Putty 挂钩（它来自 Linux 背景，非常接近我的习惯，而且是免费的），但实际上访问的是底层 cygwin 而不是 Windows 命令解释器 ( `CMD.EXE`)。因此，您可以获得 Putty 令人敬畏的终端仿真器的所有好处，以及`ncurses`cygwin 提供的漂亮（和许多其他）库。向启动 Putty（或批处理文件）的快捷方式添加几个命令行参数，您的应用程序可以自动启动而无需通过 Putty 的 UI。

# java - Java - 类似控制台的 Web 小程序

> ID：138157
> 
> 赞同：5
> 
> 时间：2008-09-26T07:33:29.073
> 
> 标签：java, api, console, applet

嘿，我一直在使用 Java 在 Windows 控制台中开发一个应用程序，并希望将它放在其所有控制台图形荣耀中。

是否有一个简单的 Web 小程序 API 可以用来移植我的应用程序？

我只是使用基本的 System.out 和 System.in 功能，但我很高兴重建我的 I/O 包装器。

我认为这些方面的东西对于任何想要将他们的工作放到网上的 Java 初学者来说都是一笔巨大的财富。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T07:52:10.993

当然，只需制作一个小程序，在其上放置一个带有 JFrame 的小型摇摆 UI，该 JFrame 具有两个组件 - 一个用于写入输出，一个用于输入输入。在页面中嵌入小程序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-09T12:35:29.547

我按照[拉斯](https://stackoverflow.com/questions/138157/java-console-like-web-app#138206)的建议做了，并写了我自己的。

```
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import java.io.*;
import java.awt.Font;

public class Applet extends JFrame {
    static final long serialVersionUID = 1;

    /** Text area for console output. */
    protected JTextArea textArea;

    /** Text box for user input. */
    protected JTextField textBox;

    /** "GO" button, in case they don't know to hit enter. */
    protected JButton goButton;

    protected PrintStream printStream;
    protected BufferedReader bufferedReader;

    /**
     * This function is called when they hit ENTER or click GO.
     */
    ActionListener actionListener = new ActionListener() {
        public void actionPerformed(ActionEvent actionEvent) {
            goButton.setEnabled(false);
            SwingUtilities.invokeLater(
                new Thread() {
                    public void run() {
                        String userInput = textBox.getText();
                        printStream.println("> "+userInput);
                        Input.inString = userInput;
                        textBox.setText("");
                        goButton.setEnabled(true);
                    }
                }   
            );
        }
    };

    public void println(final String string) {
        SwingUtilities.invokeLater(
            new Thread() {
                public void run() {
                    printStream.println(string);
                }
            }   
        );
    }

    public void printmsg(final String string) {
        SwingUtilities.invokeLater(
            new Thread() {
                public void run() {
                    printStream.print(string);
                }
            }   
        );
    }

    public Applet() throws IOException {
        super("My Applet Title");

        Container contentPane = getContentPane();

        textArea = new JTextArea(30, 60);
        JScrollPane jScrollPane = new JScrollPane(textArea);
        final JScrollBar jScrollBar = jScrollPane.getVerticalScrollBar();
        contentPane.add(BorderLayout.NORTH, jScrollPane);
        textArea.setFocusable(false);
        textArea.setAutoscrolls(true);
        textArea.setFont(new Font("Comic Sans MS", Font.TRUETYPE_FONT, 14));

        // TODO This might be overkill
        new Thread() {
            public void run() {
                while(true) {
                    jScrollBar.setValue(jScrollBar.getMaximum());
                    try{
                        Thread.sleep(100);
                    } catch (Exception e) {}
                }
            }
        }.start();

        JPanel panel;
        contentPane.add(BorderLayout.CENTER, panel = new JPanel());

        panel.add(textBox = new JTextField(55));
        textBox.addActionListener(actionListener);

        panel.add(goButton = new JButton("GO"));
        goButton.addActionListener(actionListener);

        pack();

        // End of GUI stuff

        PipedInputStream inputStream;
        PipedOutputStream outputStream;

        inputStream = new PipedInputStream();
        outputStream = new PipedOutputStream(inputStream);

        bufferedReader = new BufferedReader(new InputStreamReader(inputStream, "ISO8859_1"));
        printStream = new PrintStream(outputStream);

        new Thread() {
            public void run() {
                try {
                    String line;
                    while ((line = bufferedReader.readLine()) != null) {
                        textArea.append(line+"\n");
                    }
                } catch (IOException ioException) {
                    textArea.append("ERROR");
                }
            }
        }.start();
    }
} 
```

下面的代码在一个单独的类“Input”中，它有一个静态的“inString”字符串。

```
 public static String getString() {
        inString = "";

        // Wait for input
        while (inString == "") {
            try{
                Thread.sleep(100);
            } catch (Exception e) {}
        }

        return inString;
    } 
```

在项目的整个生命周期中，我可能会更多地维护这段代码，但在这一点上 - 它可以工作:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-27T21:01:10.737

作为一个光荣且非常有用的类似 cnsole 的 web 应用程序的首要示例，请参阅[goosh](http://goosh.org)，即 Google Shell。我无法想象没有它浏览网络了。

诚然，没有源代码，但您可能会通过使用 Firebug 左右来获得一点它的魔力。

使用 TextArea 可能是一种容易出错的方法。请记住，您需要对此 TextArea 进行输入和输出，因此您必须跟踪光标位置。我建议，如果你真的采用这种方法，你可以抽象出一个纯 TextArea（可能是继承？）并使用一个组件，例如，a`prompt()`来显示提示并启用输入，并且 a 也遵循通常的 shell 抽象具有`stdin`（一个 InputStream，从提示中读取，但可以绑定到，比如说文件左右），`stdout`并且可能还有`stderr`OutputStreams，绑定到 TextArea 的文本。

这不是一件容易的事，而且我不知道有任何图书馆可以做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T07:45:24.740

我记得几年前看到了 telnet 客户端小程序实现（当人们使用 telnet 时）。也许你可以把它们挖出来并修改它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T12:45:03.637

System.out 和 System.in 是静态的，因此是邪恶的。您需要通过您的程序用非静态变量（“从上面的参数化”）替换它们。从小程序中，您不能使用 System.setOut/setErr/setIn。

然后你就差不多整理好了。一个小程序。添加一个 TextArea（或等效项）。将输出附加到文本区域。将击键写入输入。任务完成。

# php - PHP别名@函数

> ID：138159
> 
> 赞同：5
> 
> 时间：2008-09-26T07:33:53.533
> 
> 标签：php, operators, error-suppression

我是 PHP 新手，看到一些示例调用带有 @ 前缀的函数（如 @mysql_ping()），我感到很困惑。

它是干什么用的？谷歌搜索/搜索并没有太大帮助，因为 @ 被丢弃并且“别名”不是足够好的关键字。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T07:36:29.083

@ 抑制错误、警告和通知。

[如果您使用自定义错误处理程序](http://php.net/manual/en/function.set-error-handler.php)或适当检查 $php_errormsg 变量来补充它，那么您可以将其用于良好目的，以便您可以正确处理错误。

以我的经验，这种正确的用法很少见，而是以不好的方式大量使用，只是为了隐藏错误而不采取行动。

更多信息请访问[http://www.php.net/manual/en/language.operators.errorcontrol.php](http://www.php.net/manual/en/language.operators.errorcontrol.php)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T07:37:43.697

它抑制错误消息的输出。与这里的另一位评论员相反，我认为使用它是一种很好的编程习惯（特别是如果您正在开发一个 Web 应用程序，其中输出将混合在输出页面的 html 中）。

像 mysql_connect 这样的函数返回一个资源标识符，或者错误时返回 FALSE。使用 @mysql_connect(...) 并检查返回值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T07:36:09.973

谷歌搜索“php at symbol”表明它要求 PHP 不显示调用导致的任何错误消息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T07:42:28.130

它抑制了任何可能以其他方式输出的错误。

这是痛苦和困难的秘诀，因为当确实发生错误时，它不可避免地会导致困难，你一定要花费数小时来追查原因。如果没有使用 @ 操作符，那么几秒钟内就会发现错误。

没有充分的理由使用它，使用 display_errors 和 error_log ini 设置来防止错误显示在实时站点上，并让它们显示在您的开发站点上。

如果有一个你不想看到的错误，你最好只是修复它而不是抑制它！

如果它在外部库中并且超出您的控制范围，只需将其写入日志，在生产环境中关闭 display_errors 并使用它。因为不知道您现在正在压制并乐于忍受的错误是否总是从那里抛出的错误。

@ === 不好

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T07:37:15.087

抑制错误消息： [http ://bytes.com/forum/thread10951.html](http://bytes.com/forum/thread10951.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T07:42:23.793

如果发生错误，使用 a 符号为函数添加前缀会阻止它触发 PHP 错误处理程序。请记住，如果您决定使用它，则必须自己完成所有错误处理。

```
$test = @file_get_contents('nonexistant.file');
if(!$test)
{
    die('Failed');
} 
```

更好的做法是`display_errors`关闭并使用自定义错误处理程序（请参阅[错误异常](http://docs.php.net/manual/en/class.errorexception.php)）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-06T04:05:42.037

有时它很有用——特别是如果管理员不希望您使用 php 环境或者该值不重要并且主要是装饰性的。不过，请记住；这是一种解决方法，而不是灵丹妙药。

[...]

```
.$foutDate = @filemtime($keyring); /* Don't care, as we've already established file */

$f["date"] = $foutDate;

$f["fullDate"] = date("r", $foutDate); 
```

[...]

# windows - Windows 主机文件中的通配符

> ID：138162
> 
> 赞同：309
> 
> 时间：2008-09-26T07:35:43.967
> 
> 标签：windows, apache, dns, hosts, virtual-hosts

我想设置我的本地开发机器，以便将任何请求`*.local`重定向到`localhost`. 这个想法是，当我开发多个站点时，我可以将虚拟主机添加到 Apache等，并让它们全部解析为`site1.local`，而 Apache 相应地为不同的站点提供服务。`site2.local``localhost`

我在 Windows XP 上。

我尝试添加

```
127.0.0.1       *.local 
```

到我的`c:\windows\system32\drivers\etc\hosts`文件，也试过：

```
127.0.0.1       .local 
```

两者似乎都不起作用。

我知道我可以将它们设置在不同的端口号上，但这很痛苦，因为很难记住哪个端口是哪个。

我不想设置本地 DNS 服务器或任何困难的东西，有什么建议吗？

* * *

## 回答 #1

> 赞同：454
> 
> 时间：2012-03-14T04:17:26.727

Acrylic DNS 代理（免费、开源）可以完成这项工作。它使用自己的 hosts 文件创建一个代理 DNS 服务器（在您自己的计算机上）。hosts 文件接受通配符。

**从官网下载**

[http://mayakron.altervista.org/support/browse.php?path=Acrylic&name=Home](http://mayakron.altervista.org/support/browse.php?path=Acrylic&name=Home)

## 配置 Acrylic DNS 代理

**要配置 Acrylic DNS 代理，请从上面的链接安装它，然后转到：**

1.  开始
2.  程式
3.  亚克力 DNS 代理
4.  配置
5.  编辑自定义主机文件 (AcrylicHosts.txt)

**在文件末尾添加以下行：**

```
127.0.0.1   *.localhost
127.0.0.1   *.local
127.0.0.1   *.lc 
```

**重启 Acrylic DNS 代理服务：**

1.  开始
2.  程式
3.  Acrilic DNS 代理
4.  配置
5.  重启亚克力服务

**您还需要在网络接口设置中调整 DNS 设置：**

1.  开始
2.  控制面板
3.  网络和互联网
4.  网络连接
5.  本地连接属性
6.  TCP/IPv4

**设置“使用以下 DNS 服务器地址”：**

```
Preferred DNS Server: 127.0.0.1 
```

*如果您随后将此答案与 jeremyasnyder 的答案（使用`VirtualDocumentRoot`）结合起来，您可以通过简单地创建一个目录来自动设置域/虚拟主机。*

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2008-11-07T13:42:16.193

要回答您的问题，您不能在 Windows 下的 hosts 文件中使用通配符。

但是，如果您只想更改主机文件以使新站点正常工作......您可以像这样配置您的 Apache，而不必继续编辑它的配置：

[http://postpostmodern.com/instructional/a-smarter-mamp/](http://postpostmodern.com/instructional/a-smarter-mamp/)

基本上是基于我的设置的快速总结，将以下内容添加到您的 apache.conf 文件中：

```
 LoadModule vhost_alias_module modules/mod_vhost_alias.so

 NameVirtualHost *:80

  <Directory "/xampp/sites">
      Options Indexes FollowSymLinks Includes ExecCGI
      AllowOverride All
      Order allow,deny
      Allow from all 
  </Directory>

  <VirtualHost *:80>
      VirtualDocumentRoot c:/xampp/sites/%-1/%-2+/
  </VirtualHost> 
```

这允许我添加一个条目，例如：

```
127.0.0.1       test.dev 
```

然后创建目录 c:\xampp\sites\dev\test 并将必要的文件放在那里，它就可以工作了。

另一种选择是在 apache.conf 中使用`<Directory>`标签并引用来自[http://localhost/project/](http://localhost/project/)的页面。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-09-26T07:41:53.983

我不认为这是可能的。

无论如何，每次添加新站点和位置时，您都必须修改 apache virtualroot 条目，因此将新名称同步到 Windows vhost 文件并不是一项大工作。

更新：请检查下一个答案以及对此答案的评论。这个答案已有 6 年历史，不再正确。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-03-20T03:37:42.273

为了补充已经在这里的好建议，[**XIP.IO**](http://xip.io)是一个出色的公开可用的通配符 DNS 服务器。

```
 myproject.127.0.0.1.xip.io  -- resolves to -->   127.0.0.1
  other.project.127.0.0.1.xip.io  -- resolves to -->   127.0.0.1
   other.machine.10.0.0.1.xip.io  -- resolves to -->   10.0.0.1 
```

（指定非环回地址的功能非常适合在无法访问主机文件的 iOS 设备上测试站点。）

如果您将此与其他答案中提到的一些 Apache 配置结合使用，您可以添加 VirtualHosts with *zero setup*。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-10-17T17:43:54.717

当您从 Windows 命令提示符运行“ipconfig /flushdns”而不是重新启动计算机时，编辑 hosts 文件就不那么痛苦了。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-27T23:58:24.477

[我发现一篇关于使用 Windows 主机文件](http://vlaurie.com/computers2/Articles/hosts.htm)的帖子也说“不允许使用通配符”。

过去，我只是在 hosts 文件中添加了额外的条目，因为（如前所述），当您已经在编辑 apache 配置文件时，这并没有太多额外的工作。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-26T08:02:56.583

您可以说服您的网络管理员为您设置一个域（例如“evilpuppetmaster.hell”）并在那里使用通配符，以便所有内容（*.evilpuppetmaster.hell'）都解析为您的 IP

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-07-23T13:46:18.957

我们在本地 DNS 服务器中使用通配符 DNS 进行这项工作：添加`A`类似的记录`*.local -> 127.0.0.1`

我认为您的网络设置需要在网络上机器的域后缀搜索列表中具有所选的域后缀，因此您可能希望替换`.local`为您公司的内部域（例如`.int`），然后添加一个子域`.localhost.int`，以便清楚这是为了什么。

所以`*.localhost.int`会`127.0.0.1`为网络上的每个人解决，如果端点挂断该子域，所有开发人员的配置文件设置将“正常工作”，例如`site1.localhost.int`，`site2.localhost.int`这几乎是我们引入的方案。

**dnsmasq**看起来也不错，但我还没有尝试过：http: [//ihaveabackup.net/2012/06/28/using-wildcards-in-the-hosts-file/](http://ihaveabackup.net/2012/06/28/using-wildcards-in-the-hosts-file/)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-05-02T09:32:31.660

我用 Python 编写了一个简单的 dns 代理。它将读取 /etc/hosts 中的通配符条目。见这里：[http ://code.google.com/p/marlon-tools/source/browse/tools/dnsproxy/dnsproxy.py](http://code.google.com/p/marlon-tools/source/browse/tools/dnsproxy/dnsproxy.py)

我已经在 Linux 和 Mac OS X 中进行了测试，但还没有在 Windows 中进行测试。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-03-05T13:41:42.547

你可以试试[AngryHosts](http://angryhosts.com/)，它提供了一种支持通配符和正则表达式的方法。实际上，它是一个主机文件增强和管理软件。
更多功能可以看@http [://angryhosts.com/features/](http://angryhosts.com/features/)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2014-02-28T14:07:53.057

我正在使用 DNSChef 来做到这一点。

[https://thesprawl.org/projects/dnschef/](https://thesprawl.org/projects/dnschef/)

您必须下载该应用程序，在 Linux 或 Mac 中您需要 python 来运行它。Windows 有自己的 exe。

您必须使用您的 dns 条目创建一个 ini 文件，例如

```
[A]
*.google.com=192.0.2.1
*.local=127.0.0.1
*.devServer1.com=192.0.2.3 
```

然后您必须以管理员权限启动 dns 应用程序

```
sudo python dnschef.py --file myfile.ini -q 
```

或在窗口中

```
runas dnschef.exe --file myfile.ini -q 
```

最后，您需要将本地主机环境（网络、接口、dns 或类似或在 linux /etc/resolv.conf 中）设置为唯一的 DNS。

就是这样

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2015-03-04T04:04:29.567

我制作了这个简单的工具来代替主机。支持正则表达式。 [https://github.com/stackia/DNSAgent](https://github.com/stackia/DNSAgent)

示例配置：

```
[
    {
        "Pattern": "^.*$",
        "NameServer": "8.8.8.8"
    },
    {
        "Pattern": "^(.*\\.googlevideo\\.com)|((.*\\.)?(youtube|ytimg)\\.com)$",
        "Address": "203.66.168.119"
    },
    {
        "Pattern": "^.*\\.cn$",
        "NameServer": "114.114.114.114"
    },
    {
        "Pattern": "baidu.com$",
        "Address": "127.0.0.1"
    }
] 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-01-16T04:50:40.433

@petah 和 Acrylic DNS 代理是最好的答案，最后他提到了使用 Apache 进行多站点的能力，@jeremyasnyder 描述得更深入一点......

...但是，在我们的案例中，我们正在测试一个多租户托管系统，因此我们要测试的*大多数*`virtualhost`域都使用相同的域，而其他几个域则指向其他地方。

`ServerAlias`所以在我们的例子中，你只需在指令中使用正则表达式通配符，就像这样......

```
ServerAlias *.foo.local 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-01-09T10:12:45.123

您可以为此使用 echoipdns ( [https://github.com/zapty/echoipdns](https://github.com/zapty/echoipdns) )。

通过运行`echoipdns local` 对 .local 子域的所有请求，将重定向到 127.0.0.1，因此任何具有 xyz.local 等的域都将解析为 127.0.0.1。您可以使用任何其他后缀，也只需将 local 替换为您想要的名称。

Echoipdns 更强大，当你想使用网络中其他机器的 url 时，你仍然可以零配置使用它。

例如，如果您的机器 IP 地址是 192.168.1.100，您现在可以使用域名 xyz.192-168-1-100.local，它始终会解析为 192.168.1.100。这个魔法是由 echoipdns 通过查看域名第二部分中的 IP 地址并在 DNS 查询中返回相同的 IP 地址来完成的。您必须在要访问远程系统的机器上运行 echoipdns。

echoipdns 也可以设置为独立的 DNS 代理，因此只需指向此 DNS，您现在无需每次运行特殊命令即可使用上述所有好处，甚至可以在移动设备上使用它。

因此，这从本质上简化了本地和团队环境中基于通配符域的 DNS 开发。

echoipdns 适用于 Mac、Linux 和 Windows。

注意：我是 echoipdns 的作者。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-05T00:48:06.943

我找不到书面禁止，但按照惯例，Windows 主机文件紧跟 UNIX 主机文件，您不能将通配符主机名引用放入该文件。

如果您阅读手册页，它会说：

```
DESCRIPTION
     The hosts file contains information regarding the known hosts on the net-
     work.  For each host a single line should be present with the following
     information:

           Internet address
           Official host name
           Aliases 
```

虽然说的是，

```
 Host names may contain any printable character other than a field delim-
     iter, newline, or comment character. 
```

从实际层面来看，情况并非如此。

基本上，查看 /etc/hosts 文件的代码不支持通配符条目。

解决方法是提前创建所有条目，也许使用脚本一次放置几百个条目。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-06-28T20:21:00.880

虽然您不能添加这样的通配符，但您可以添加您需要的站点的完整列表，至少用于测试，这对我来说足够好，在您的主机文件中，您只需添加：

127.0.0.1 site1.local
127.0.0.1 site2.local
127.0.0.1 site3.local
...

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-08-19T19:56:09.700

这是那些试图实现目标的总配置（开发环境中的通配符，即 XAMPP——这个例子假设所有站点都指向相同的代码库）

# 主机文件（添加条目）

文件：%SystemRoot%\system32\drivers\etc\hosts

```
127.0.0.1   example.local 
```

# httpd.conf 配置（启用虚拟主机）

文件：\XAMPP\etc\httpd.conf

```
# Virtual hosts
Include etc\extra\httpd-vhosts.conf 
```

# httpd-vhosts.conf 配置

文件：XAMPP\etc\extra\httpd-vhosts.conf

```
<VirtualHost *:80>
    ServerAdmin admin@example.local
    DocumentRoot "\path_to_XAMPP\htdocs"
    ServerName example.local
    ServerAlias *.example.local
#    SetEnv APP_ENVIRONMENT development
#    ErrorLog "logs\example.local-error_log"
#    CustomLog "logs\example.local-access_log" common
</VirtualHost> 
```

重启阿帕奇

# 创建 pac 文件：

保存为whatever.pac，然后在浏览器的network>proxy>auto_configuration设置中加载文件（如果你改变这个，重新加载）

```
function FindProxyForURL(url, host) {
  if (shExpMatch(host, "*example.local")) {
    return "PROXY example.local";
  }
  return "DIRECT";
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-01-29T14:21:51.893

使用 Acrylic DNS 代理配置 nginx config 自动子域

> nginx 站点文件夹的 auto.conf 文件

```
server {
    listen 80;
    server_name ~^(?<branch>.*)\.example\.com;
    root /var/www/html/$branch/public;  

    index index.html index.htm index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_log  /var/log/nginx/$branch.error.log error;

    sendfile off;

    client_max_body_size 100m;

    location ~ \.php$ {
       try_files $uri /index.php =404;
       fastcgi_pass php-fpm:9000;
       fastcgi_index index.php;
       fastcgi_buffers 16 16k;
       fastcgi_buffer_size 32k;
       fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
       include fastcgi_params;
    }

    location ~ /\.ht {
        deny all;
    }
} 
```

添加到 Acrylic hosts 文件`127.0.0.1 example.com *.example.com`并重新启动 Acrylic 服务。 **$branch** - 您的子域名。

设置而不是 *根 /var/www/html/$branch/public;* 你的项目路径

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-10-30T09:30:00.463

这可以使用[Pi-Hole](https://pi-hole.net)完成，只需编辑“/etc/hosts”并重新启动 dns 服务。

```
nano /etc/hosts
pihole restartdns 
```

例子：

```
127.0.1.1       raspberrypi
192.168.1.1     w1.dev.net
192.168.1.2     w2.dev.net
192.168.1.3     w3.dev.net 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-04-30T21:03:48.460

您可以使用动态 DNS 客户端，例如[http://www.no-ip.com](http://www.no-ip.com)。然后，使用外部 DNS 服务器 CNAME *.mydomain.com 到 mydomain.no-ip.com。

# php - 您将如何自动检测 Textile 与 Markdown？

> ID：138174
> 
> 赞同：4
> 
> 时间：2008-09-26T07:38:43.680
> 
> 标签：php, javascript, markdown, textile

我正在考虑在当前项目中同时支持**[Textile](http://textism.com/tools/textile/)**和**[Markdown 。](http://daringfireball.net/projects/markdown/)**我宁愿不强迫用户选择其中一个。有没有办法自动检测用户正在使用哪个？你会怎么做？我想查找/开发 JavaScript 和 PHP 解决方案，以便我可以提供实时预览以及在服务器端处理用户输入。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T09:55:54.427

考虑到用户可能只在帖子中使用一个特定的语法元素，因此您必须检查所有内容。寻找“h1”。显然只有在用户完全使用该元素时才有效。

使用 headers 之类的东西非常容易，但请考虑 markdown 格式`*this*`as`<em>this</em>`和 Textile 会将其转换为`<strong>this</strong>`。所以你会有模棱两可的语法结构，会在每种语言中产生不同的结果。

我建议使用用户选择。尝试找出您的用户（或您）通常首选的语法，为那些想要其他选择的人提供“使用 x 而不是 y”复选框。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T09:38:22.330

这真的不应该那么难。Markdown 不支持以下语法；

```
h1\. Header

p. Paragraph 
```

...所以您只需扫描它以检查它是否是纺织品。非常简单的正则表达式让您开始使用 PHP 代码（扫描以 hX. 或 p. 开头的行）：

```
if (preg_match('/^(p|h[1-6])\. /m', $subject)) 
{
    // Successful match
} else 
{
    // Match attempt failed
} 
```

您可能可以编写自己的正则表达式来扫描 Markdown。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T07:57:31.403

自动检测，我不知道，两者都是基于“自然”打字。
也许您可以要求用户选择一种格式，带有一对单选按钮或其他东西。

# security - DotNetNuke 漏洞

> ID：138175
> 
> 赞同：8
> 
> 时间：2008-09-26T07:38:49.590
> 
> 标签：security, dotnetnuke

任何熟悉当前版本 DotNetNuke 中特定安全问题的人？
（我已经查看了他们的网站、安全焦点等...）

我重新提出了这个问题，因为我的客户使用 DotNetNuke 开发了他们的系统 - 因此这是一个编程问题。我只需要知道关于这个平台的一些问题。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T14:12:56.747

DNN 漏洞信息位于： http: [//www.dotnetnuke.com/News/SecurityPolicy/tabid/940/Default.aspx](http://www.dotnetnuke.com/News/SecurityPolicy/tabid/940/Default.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T14:48:24.057

我不知道当前版本的 DotNetNuke (4.9.0) 已宣布任何安全问题。DotNetNuke 的安全策略是在发现任何已知安全问题后立即予以解决。他们不会发布存在已知安全问题的版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T14:05:55.123

我只想补充一点，DotNetNuke 公司，无论对错，都要求人们不要公开讨论已知的漏洞利用细节，因为这会使广大社区面临更大的风险。

通常使用 DNN 的经验法则是升级到最新版本，并密切关注网站上发布的安全项目，此外，关注 Cathal 的博客也是一个好主意，因为他是首席安全人员。

# sql - 从整数到 GUID 作为主键

> ID：138177
> 
> 赞同：9
> 
> 时间：2008-09-26T07:40:27.043
> 
> 标签：sql, sql-server, foreign-keys, primary-key, guid

我使用了几个带有整数主键的引用表。现在我想将整数更改为 GUID，使所有引用保持不变。最简单的方法是什么？

谢谢！

**添加**

我确实了解这个过程，所以我需要更详细的建议，例如，如何填写新的 GUID 列。使用默认值 newid() 是正确的，但是对于已经存在的行呢？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T07:48:08.883

*   在主表中为 guid 值创建一个新列。使用 uniqueidentifier 数据类型，使用 newid() 默认使其不为空，以便填充所有现有行。
*   在子表中创建新的 uniqueidentifier 列。
*   运行更新语句以使用现有的 int 关系来构建公会关系以引用实体。
*   删除原始的 int 列。

此外，在数据/索引页面中留出一些空间（指定 fillfactor < 100），因为 guid 不像 int 标识列那样是连续的。这意味着插入可以在数据范围内的任何位置，如果您的页面 100% 已满，则会导致页面拆分。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T07:42:42.657

首先：亲爱的上帝为什么？！？！？

其次，您必须首先将 GUID 列添加到所有表中，然后根据 int 值填充它们。完成后，您可以将 GUID 设置为主键/外键，然后删除 int 列。

要更新值，你会做类似的事情

1.  在主键表中设置新的 GUID
2.  运行这个：

.

```
UPDATE foreignTable f
SET f.guidCol = p.guidCol
FROM primaryTable p
WHERE p.intCol = f.intCol 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T08:18:29.060

这在实现**分布式计算模型**的系统中是相关的。如果在系统中持久化信息时要求系统知道主键，则使用由**ONE**处理程序维护的自增主键会降低系统速度。相反，您需要一种类似于 GUID 生成器的机制来创建主键（请记住，主键的真正特征是它的唯一性）。因此，我可以扩展多个服务，每个服务都创建自己的主键，彼此独立。

我以前有过这样做的可疑特权，基本上我要做的就是将整个该死的数据库导出为 XML。接下来，我有一个 Java 应用程序，它使用 java.util.Random 的 nextLong() 函数将主键替换为新的 guid 键。之后，我将整个内容重新导入数据库。

当然，我第一次尝试将XML文件导入回来时，我忘记关闭主键字段的自动编号功能，所以请从我的错误中吸取教训。我确信有更好的方法可以做到这一点，但这是一种快速而肮脏的方法......而且它奏效了。如果您想知道，该项目是为了使应用程序规模化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T07:46:03.163

是的，我和格伦在一起……实际上，在他发布之前，我一直在犹豫是否要发布相同的内容……

为什么不希望将自动增量 int 主键与 GUID 分开？它更加灵活，您只需将 GUID 列编入索引，这样您的查询就有了良好的性能......

* * *

至于灵活性，我喜欢将我的 id 保持为自动增量整数，因为这样其他看似唯一且值得主键的项目可以更改。

灵活性的一个很好的例子是如果您使用用户名作为主键。即使它们是独一无二的，也很高兴能够改变它们。如果用户使用电子邮件地址作为用户名怎么办？能够更改用户名并且不影响您的所有查询是一大优势，我怀疑您的 GUID 可能也是如此......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T07:47:48.383

我认为，您必须手动进行。或者你可以为它写一些实用程序。场景应该是：

*   使用新的“guid”列复制“int”PK/FK 列。
*   为“guid”PK 列生成新值。
*   使用指定值更新“guid”FK 列中的值（您可以通过“int”PK 找到记录）。
*   删除带有“int”PK/FK 列的引用（关系）。
*   使用“guid”PK/FK 列创建类似的引用（关系）。
*   删除“int”PK/FK 列。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T08:45:42.223

这是一个非常好的选择。我为我的一个应用程序从 longs 切换到 UUID，我不后悔。如果您使用 MS SQL Server，它包含在标准中（我使用 postgresql，它仅包含在 8.3 之后的标准中）。

正如[Glenn Slaven](https://stackoverflow.com/questions/138177/moving-from-ints-to-guids-as-primary-keys#138185)所提到的，您可以根据当前记录中的键重新创建 UUID。请注意，它们不会是独一无二的，但这样很容易保持关系完整。您在移动后创建的新记录将是唯一的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T08:49:21.980

不要这样做！我们开始使用 GUID，现在我们几乎完成了将 INT 作为 PK 的迁移；我们保留 GUID 用于记录目的（以及一些表，呃，“可协商的关系完整性”;)），但是使用 int 的速度提高是惊人的。

请注意，当表格行数超过数百万时，这才真正变得明显。

到目前为止，我们最大的愚蠢是使用 NEWID() 作为我们（顺序）日志表的 PK ——当我们意识到我们的错误时，我们非常头疼。

# visual-studio - 在 Visual Studio 中，何时需要使用测试视图？

> ID：138178
> 
> 赞同：0
> 
> 时间：2008-09-26T07:41:34.030
> 
> 标签：visual-studio, unit-testing, visual-studio-2008, visual-studio-2005

为了在 Visual Studio 中管理单元测试，我使用了测试列表编辑器。还有一个看起来相似但更有限的测试视图。**我什么时候想使用测试视图而不是测试列表编辑器或任何其他测试窗口？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-26T07:53:03.503

对我来说，测试视图是一个很好的紧凑列表，更适合屏幕（如果我需要它在屏幕上），因为我对大多数 vs 工具窗口使用单独的纵向监视器。

# apache-flex - Patch flex framework to show preloader instantly?

> ID：138194
> 
> 赞同：2
> 
> 时间：2008-09-26T07:46:59.197
> 
> 标签：apache-flex, preloader, monkeypatching

In the Flex framework a custom preloader can be used while the site is loading.

In the [Adobe docs](http://livedocs.adobe.com/flex/3/html/help.html?content=app_container_4.html) it specifies that '**the progress bar [preloader] is displayed if less than half of the application is downloaded after 700 milliseconds of downloading.**'

However I ALWAYS want the preloader to appear instantly since I know that 95% of our users are first time visitors and the site is over 500kb. I dont want people to have to wait .7 seconds for the preloader animation to appear.

I would think in theory that it is possible to 'monkey patch' the framework to remove this .7 second limitation. I dont have time to figure out how, and I've never done it before.

Anybody help?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T09:01:58.113

您应该只扩展 DownloadProgressBar，尝试以下代码。我以前用过这个，我发现 jessewarden 网站 [点击这里](http://jessewarden.com/2007/07/making-a-cooler-preloader-in-flex-part-1-of-3.html)有用的信息（我在那里发现了它，这是他的代码的精简版）

```
package{
import flash.display.MovieClip;
import flash.display.Sprite;
import flash.events.Event;
import flash.events.ProgressEvent;

import mx.events.FlexEvent;
import mx.preloaders.DownloadProgressBar;

public class Preloader extends DownloadProgressBar
{

    /**
    * The Flash 8 MovieClip embedded as a Class.
    */      
    [Embed(source="yourPreloaderFile.swf")]
    private var FlashPreloaderSymbol:Class;

    private var clip:MovieClip;

    public function Preloader()
    {
        super();
        clip = new FlashPreloaderSymbol();
        addChild(clip);
    }

    public override function set preloader(preloader:Sprite):void 
    {                   
        preloader.addEventListener( FlexEvent.INIT_COMPLETE ,   onFlexInitComplete );

        centerPreloader();
    }

    private function centerPreloader():void
    {
        x = (stageWidth / 2) - (clip.width / 2);
        y = (stageHeight / 2) - (clip.height / 2);
    }

    private function onFlexInitComplete( event:FlexEvent ):void 
    {
        dispatchEvent( new Event( Event.COMPLETE ) ); 
    }

    protected override function showDisplayForDownloading(time : int, event : ProgressEvent) : Boolean {
        return true;
    }

} 
```

}

之后，只需将主应用程序标记中的 preloader 属性更改为 Preloader 类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T08:09:34.167

这是在`showDisplayForDownloading`函数中的 mx.preloaders::DownloadProgressBar.as 的第 1205 行中。

旧式猴子补丁已在 AS3 中推出，但您可以编辑 Flex 源代码并自己编译一个新的 framework.swc（显然很痛苦），或者只是将其包含在源路径中（源路径覆盖 .swcs）；或从仅覆盖`showDisplayForDownloading`并返回 true 的 DownloadProgressBar 派生您自己的预加载器类。

您可以在 '%PROGRAMFILES%\Adobe\Flex Builder 3[ Plug-in]\sdks\3.0.0\frameworks\projects\framework\src' 中找到框架源，然后是包路径。如果您使用的是 3.1 或其他版本，请更改 sdk 版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T11:09:40.647

我猜延迟有两个原因：

1.  一旦页面已经缓存，您不希望预加载器“闪烁”
2.  预加载器本身必须加载

当我需要确保立即显示预加载器时，我会制作一个*只有*预加载器的小型包装 swf，然后从那里加载主 swf。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-15T10:41:19.487

它不可能使预加载器立即显示，因为在显示进度之前需要下载一些类。其他选择可以是您在 html 中显示进度，当加载 flash 电影时，它会显示在此处。

# reporting-services - 如何在没有服务器或 UI 的情况下从嵌入式报表定义生成 PDF？

> ID：138203
> 
> 赞同：5
> 
> 时间：2008-09-26T07:50:36.507
> 
> 标签：reporting-services

独立可执行文件是否可以在不显示 ReportViewer 控件的情况下生成报告并将其输出为 PDF（或报告查看器中可用的其他导出选项之一）？

报表定义应嵌入在可执行文件中，并且不应使用 Reporting Services Web 服务。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T08:48:19.410

其实你根本不需要ReportViewer，你可以直接实例化并使用LocalReport：

```
LocalReport report = new LocalReport();
report.ReportPath = "templatepath";
// or use file from resource with report.ReportEmbeddedResource

// add parameters, datasource, etc.

Warning[] warnings;
string[] streamids;
string mimeType;
string encoding;
string filenameExtension;

byte[] bytes;
bytes =report.Render("PDF", null, out mimeType, out encoding, out filenameExtension, out streamids, out warnings);

// save byte[] to file with FileStream or something else 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T08:01:23.140

您不必显示控件本身。

```
ReportViewer rv = new ReportViewer();
rv.LocalReport.ReportPath = "templatepath";
// or use file from resource with rv.LocalReport.ReportEmbeddedResource

// add parameters, datasource, etc.

Warning[] warnings;
string[] streamids;
string mimeType;
string encoding;
string filenameExtension;

byte[] bytes;
bytes = rv.LocalReport.Render("PDF", null, out mimeType, out encoding, out filenameExtension, out streamids, out warnings);

// save byte[] to file with FileStream or something else 
```

但是，它只能呈现 PDF 和 XLS（因为 ReportViewer 控件无法像 Reportig Service 那样导出到 Word 和其他控件）。

我忘了说上面的代码是 C#，使用 .NET 框架和 ReportViewer 控件。查看[GotReportViewer](http://www.gotreportviewer.com/)以获取快速入门。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T22:00:43.687

您可以将 .rdlc 报告直接传递给带有参数的 pdf 吗？我有两个下拉列表，可以用来提取我的报告。自动导出为 pdf 时，我无法使参数正常工作。这是我得到的错误： Microsoft.ReportingServices.ReportProcessing.ReportProcessingException：未指定运行报告所需的一个或多个参数。

当我使用报表查看器时，下拉列表工作，但我想跳过这一步。如果没有任何参数，我也可以让我的数据直接转到 pdf。我的下拉列表称为 ddlyear 和 ddlmonth。

# squid - 鱿鱼编程

> ID：138211
> 
> 赞同：3
> 
> 时间：2008-09-26T07:54:06.717
> 
> 标签：squid

有人知道关于 Squid 插件开发的好教程吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T08:31:25.220

鱿鱼文档中有一个。IIRC 它相当简单——squid 分叉一个进程并将数据通过管道传递到进程。可以在[此处](http://old.squid-cache.org/Doc/Prog-Guide/)找到有点过时但仍然相关的程序员指南。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-07-23T12:41:14.237

Squid 现在是一个非常模块化和可扩展的平台，所以它真的取决于你需要做什么。大多数信息都可以在 squid wiki ( [http://wiki.squid-cache.org](http://wiki.squid-cache.org) )中找到

有基于协进程的扩展的“助手”系列（[http://wiki.squid-cache.org/Features/AddonHelpers](http://wiki.squid-cache.org/Features/AddonHelpers)）

*   重定向器助手（[http://wiki.squid-cache.org/Features/Redirectors](http://wiki.squid-cache.org/Features/Redirectors)）
*   Basic/NTLM/Digest/Negotiate/Kerberos 等的身份验证助手
*   LDAP/Active Directory/Session/...的授权助手

如果您对内容修改感兴趣，可以使用 ICAP 进行进程外调整，eCAP 进行进程内调整。

对不起，我不能发布直接链接；您可以通过在 squid wiki 中查找相关关键字来找到所需的数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-16T22:03:11.253

您可能还会发现[请求操作的附加帮助程序](http://wiki.squid-cache.org/Features/AddonHelpers?highlight=%28%5CbCategoryFeature%5Cb%29%7C%28faqlisted.yes%29)主题很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-12T15:14:29.917

您可以访问 [http://www.squid-cache.org/Versions/v3/3.4/cfgman/](http://www.squid-cache.org/Versions/v3/3.4/cfgman/)以完全了解 squid... 我认为最新版本 3.5 已经到来但是这个网页可以解决您当前的问题.

# c - char和整数数组之间的速度差异？

> ID：138245
> 
> 赞同：5
> 
> 时间：2008-09-26T08:08:34.217
> 
> 标签：c, arrays, memory, alignment, sse

目前我正在处理一个视频处理软件，其中图片数据（8位有符号和无符号）存储在分配为 16 位对齐整数的数组中

```
__declspec(align(16)) int *pData = (__declspec(align(16)) int *)_mm_malloc(width*height*sizeof(int),16); 
```

一般来说，如果使用这样的有符号/无符号字符数组，它不会加快读写速度吗？：

```
__declspec(align(16)) int *pData = (__declspec(align(16)) unsigned char *)_mm_malloc(width*height*sizeof(unsigned char),16); 
```

我对缓存行大小和数据传输优化知之甚少，但至少我知道这是一个问题。除此之外，SSE 将在未来使用，在这种情况下，char-arrays - 与 int 数组不同 - 已经是*打包*格式。那么哪个版本会更快呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T08:31:19.217

如果您打算使用 SSE，则以本机大小（8 位）存储数据几乎肯定是更好的选择，因为无需解包即可完成大量操作，即使您需要为 pmaddwd 或其他类似文件解包说明，它仍然更快，因为您必须加载更少的数据。

即使在标量代码中，加载 8 位或 16 位值也不会比加载 32 位慢，因为 movzx/movsx 在速度上与 mov 没有区别。因此，您只需节省内存，这肯定不会受到伤害。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T08:53:28.227

这真的取决于你的目标 CPU——你应该阅读它的规格并运行一些基准测试，正如每个人都已经建议的那样。许多因素可能会影响性能。我想到的第一个明显的问题是您的整数数组比字符数组大 2 到 4 倍，因此，如果数组足够大，您将获得更少的数据缓存命中，这肯定会减慢降低性能。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-26T08:28:42.390

相反，打包和解包是 CPU 命令昂贵的。

如果您想进行大量随机像素操作 - 将其设置为 int 数组会更快，这样每个像素都有自己的地址。

但是，如果您依次遍历图像，则需要创建一个 chars 数组，使其尺寸较小并减少出现页面错误的机会（尤其是对于大图像）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-03T12:15:20.393

在某些情况下，字符数组可能会更慢。作为一个非常普遍的经验法则，本机字长是最好的选择，它很可能是 4 字节（32 位）或 8 字节（64 位）。更好的是像您已经完成的那样将所有内容对齐到 16 字节...如果您使用 SSE 指令 (MOVNTA)，这将实现更快的复制。如果您只关心移动项目，这将比数组使用的类型产生更大的影响......

# python - 如何在 Python 中读取给定像素的 RGB 值？

> ID：138250
> 
> 赞同：170
> 
> 时间：2008-09-26T08:10:50.857
> 
> 标签：python, graphics, rgb, pixel

如果我打开一个图像`open("image.jpg")`，假设我有像素的坐标，我如何获得像素的 RGB 值？

那么，我该如何做相反的事情呢？从一个空白图形开始，“写”一个具有特定 RGB 值的像素？

如果我不必下载任何其他库，我会更喜欢。

* * *

## 回答 #1

> 赞同：240
> 
> 时间：2008-09-26T08:15:56.583

最好使用[Python Image Library](http://www.pythonware.com/products/pil/)来执行此操作，恐怕是单独下载。

做你想做的最简单的方法是通过[Image 对象上的 load() 方法，](http://effbot.org/imagingbook/image.htm)它返回一个像素访问对象，你可以像数组一样操作它：

```
from PIL import Image

im = Image.open('dead_parrot.jpg') # Can be many different formats.
pix = im.load()
print im.size  # Get the width and hight of the image for iterating over
print pix[x,y]  # Get the RGBA Value of the a pixel of an image
pix[x,y] = value  # Set the RGBA Value of the image (tuple)
im.save('alive_parrot.png')  # Save the modified pixels as .png 
```

或者，查看[ImageDraw](http://effbot.org/imagingbook/imagedraw.htm)，它为创建图像提供了更丰富的 API。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2015-01-15T09:46:10.940

使用[Pillow](http://python-pillow.github.io/)（适用于 Python 3.X 和 Python 2.7+），您可以执行以下操作：

```
from PIL import Image
im = Image.open('image.jpg', 'r')
width, height = im.size
pixel_values = list(im.getdata()) 
```

现在你有了所有的像素值。如果是 RGB 或其他模式可以通过`im.mode`. 然后您可以通过以下方式获取像素`(x, y)`：

```
pixel_values[width*y+x] 
```

或者，您可以使用 Numpy 并重塑数组：

```
>>> pixel_values = numpy.array(pixel_values).reshape((width, height, 3))
>>> x, y = 0, 1
>>> pixel_values[x][y]
[ 18  18  12] 
```

一个完整且易于使用的解决方案是

```
# Third party modules
import numpy
from PIL import Image

def get_image(image_path):
    """Get a numpy array of an image so that one can access values[x][y]."""
    image = Image.open(image_path, "r")
    width, height = image.size
    pixel_values = list(image.getdata())
    if image.mode == "RGB":
        channels = 3
    elif image.mode == "L":
        channels = 1
    else:
        print("Unknown mode: %s" % image.mode)
        return None
    pixel_values = numpy.array(pixel_values).reshape((width, height, channels))
    return pixel_values

image = get_image("gradient.png")

print(image[0])
print(image.shape) 
```

## 冒烟测试代码

您可能不确定宽度/高度/通道的顺序。出于这个原因，我创建了这个渐变：

[![在此处输入图像描述](https://i.stack.imgur.com/H70ww.png)](https://i.stack.imgur.com/H70ww.png)

图像的宽度为 100 像素，高度为 26 像素。它具有从`#ffaa00`（黄色）到`#ffffff`（白色）的颜色渐变。输出是：

```
[[255 172   5]
 [255 172   5]
 [255 172   5]
 [255 171   5]
 [255 172   5]
 [255 172   5]
 [255 171   5]
 [255 171   5]
 [255 171   5]
 [255 172   5]
 [255 172   5]
 [255 171   5]
 [255 171   5]
 [255 172   5]
 [255 172   5]
 [255 172   5]
 [255 171   5]
 [255 172   5]
 [255 172   5]
 [255 171   5]
 [255 171   5]
 [255 172   4]
 [255 172   5]
 [255 171   5]
 [255 171   5]
 [255 172   5]]
(100, 26, 3) 
```

注意事项：

*   形状是（宽度，高度，通道）
*   ，`image[0]`因此第一行有 26 个相同颜色的三元组

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-26T12:20:38.577

**PyPNG - 轻量级 PNG 解码器/编码器**

尽管问题暗示了JPG，但我希望我的回答对某些人有用。

以下是使用[PyPNG 模块](https://pypi.python.org/pypi/pypng/0.0.18)读取和写入 PNG 像素的方法：

```
import png, array

point = (2, 10) # coordinates of pixel to be painted red

reader = png.Reader(filename='image.png')
w, h, pixels, metadata = reader.read_flat()
pixel_byte_width = 4 if metadata['alpha'] else 3
pixel_position = point[0] + point[1] * w
new_pixel_value = (255, 0, 0, 0) if metadata['alpha'] else (255, 0, 0)
pixels[
  pixel_position * pixel_byte_width :
  (pixel_position + 1) * pixel_byte_width] = array.array('B', new_pixel_value)

output = open('image-with-red-dot.png', 'wb')
writer = png.Writer(w, h, **metadata)
writer.write_array(output, pixels)
output.close() 
```

PyPNG 是一个不到 4000 行的纯 Python 模块，包括测试和注释。

[PIL](http://www.pythonware.com/products/pil/)是一个更全面的成像库，但它也明显更重。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-03-20T00:10:43.180

正如戴夫韦伯所说：

> 这是我从图像中打印像素颜色的工作代码片段：
> 
> ```
> import os, sys
> import Image
> 
> im = Image.open("image.jpg")
> x = 3
> y = 4
> 
> pix = im.load()
> print pix[x,y] 
> ```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-11-10T13:02:32.363

```
photo = Image.open('IN.jpg') #your image
photo = photo.convert('RGB')

width = photo.size[0] #define W and H
height = photo.size[1]

for y in range(0, height): #each pixel has coordinates
    row = ""
    for x in range(0, width):

        RGB = photo.getpixel((x,y))
        R,G,B = RGB  #now you can use the RGB value 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-26T08:14:23.827

图像处理是一个复杂的主题，最好*使用*库。我可以推荐[gdmodule](http://newcenturycomputers.net/projects/gdmodule.html)，它可以轻松访问 Python 中的许多不同图像格式。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T08:28:57.007

在 wiki.wxpython.org 上有一篇非常好的文章，名为[Working With Images](http://wiki.wxpython.org/index.cgi/WorkingWithImages)。文章提到了使用 wxWidgets (wxImage)、PIL 或 PythonMagick 的可能性。就个人而言，我使用过 PIL 和 wxWidgets，它们都使图像处理变得相当容易。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-19T20:14:21.097

您可以使用[pygame](http://www.pygame.org)的 surfarray 模块。该模块有一个 3d 像素数组返回方法，称为 pixel3d(surface)。我在下面展示了用法：

```
from pygame import surfarray, image, display
import pygame
import numpy #important to import

pygame.init()
image = image.load("myimagefile.jpg") #surface to render
resolution = (image.get_width(),image.get_height())
screen = display.set_mode(resolution) #create space for display
screen.blit(image, (0,0)) #superpose image on screen
display.flip()
surfarray.use_arraytype("numpy") #important!
screenpix = surfarray.pixels3d(image) #pixels in 3d array:
#[x][y][rgb]
for y in range(resolution[1]):
    for x in range(resolution[0]):
        for color in range(3):
            screenpix[x][y][color] += 128
            #reverting colors
screen.blit(surfarray.make_surface(screenpix), (0,0)) #superpose on screen
display.flip() #update display
while 1:
    print finished 
```

我希望对您有所帮助。最后一句话：屏幕在 screenpix 的生命周期内被锁定。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-06-17T06:49:49.750

使用名为 Pillow 的库，您可以将其变成一个函数，以便在您的程序中稍后使用，如果您必须多次使用它。该函数只接受图像的路径和您要“抓取”的像素的坐标。它打开图像，将其转换为 RGB 颜色空间，并返回请求像素的 R、G 和 B。

```
from PIL import Image
def rgb_of_pixel(img_path, x, y):
    im = Image.open(img_path).convert('RGB')
    r, g, b = im.getpixel((x, y))
    a = (r, g, b)
    return a 
```

> **注意：我不是这段代码的原作者；它没有任何解释。由于它相当容易解释，我只是提供上述解释，以防万一有人不理解它。*

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-04-05T07:23:04.770

使用命令“sudo apt-get install python-imaging”安装 PIL 并运行以下程序。它将打印图像的 RGB 值。如果图像很大，则使用“>”将输出重定向到文件，稍后打开文件以查看 RGB 值

```
import PIL
import Image
FILENAME='fn.gif' #image can be in gif jpeg or png format 
im=Image.open(FILENAME).convert('RGB')
pix=im.load()
w=im.size[0]
h=im.size[1]
for i in range(w):
  for j in range(h):
    print pix[i,j] 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-12-09T02:22:25.827

您可以使用 Tkinter 模块，它是 Tk GUI 工具包的标准 Python 接口，您不需要额外下载。请参阅[https://docs.python.org/2/library/tkinter.html](https://docs.python.org/2/library/tkinter.html)。

（对于 Python 3，Tkinter 被重命名为 tkinter）

以下是设置 RGB 值的方法：

```
#from http://tkinter.unpythonic.net/wiki/PhotoImage
from Tkinter import *

root = Tk()

def pixel(image, pos, color):
    """Place pixel at pos=(x,y) on image, with color=(r,g,b)."""
    r,g,b = color
    x,y = pos
    image.put("#%02x%02x%02x" % (r,g,b), (y, x))

photo = PhotoImage(width=32, height=32)

pixel(photo, (16,16), (255,0,0))  # One lone pixel in the middle...

label = Label(root, image=photo)
label.grid()
root.mainloop() 
```

并获得 RGB：

```
#from http://www.kosbie.net/cmu/spring-14/15-112/handouts/steganographyEncoder.py
def getRGB(image, x, y):
    value = image.get(x, y)
    return tuple(map(int, value.split(" "))) 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-07-27T06:30:58.713

```
import matplotlib.pyplot as plt
import matplotlib.image as mpimg

img=mpimg.imread('Cricket_ACT_official_logo.png')
imgplot = plt.imshow(img) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-03-12T18:29:41.267

如果您正在寻找 RGB 颜色代码形式的三位数字，那么下面的代码应该可以做到这一点。

```
i = Image.open(path)
pixels = i.load() # this is not a list, nor is it list()'able
width, height = i.size

all_pixels = []
for x in range(width):
    for y in range(height):
        cpixel = pixels[x, y]
        all_pixels.append(cpixel) 
```

这可能对你有用。

# impersonation - 从 IIS 上的 ASP.NET 调用 WMPLib.mediaCollection 方法返回空列表

> ID：138251
> 
> 赞同：2
> 
> 时间：2008-09-26T08:12:59.213
> 
> 标签：impersonation, wmplib

我正在尝试从 ASP.NET 访问 Windows Media Player 库。

以下代码：

WMPLib.WindowsMediaPlayer mplayer = new WMPLib.WindowsMediaPlayer();

WMPLib.IWMPStringCollection list = mplayer.mediaCollection.getAttributeStringCollection("artist", "audio");

使用 VS2005 开发 Web 服务器运行时返回非空列表，但使用 IIS 时返回空列表。

设置模拟：

System.Security.Principal.WindowsImpersonationContext impersonationContext = ((System.Security.Principal.WindowsIdentity)User.Identity).Impersonate();

没有帮助。似乎 WMPLib 仍然不认为它作为拥有库的用户运行。

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T17:51:53.680

您是否尝试过在 ASP.NET 中通过 web.config 进行配置？当您在 VS2005 调试器中运行时，您（可能）以自己的身份运行代码，但在 IIS 下，您将作为 IUSR_ *machinename*或其他低权限系统帐户运行它。

尝试将这样的内容添加到您的 web.config 文件中：

```
<system.web>
<identity impersonate="true" userName="MYDOMAIN\myuser" password="p@ssw0rd" />
</system.web> 
```

不知道这是否适用于媒体播放器，但它适用于像这样的其他身份/安全相关问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T13:17:51.113

我遇到了类似的问题：代码在我的本地机器上运行良好，但是一旦部署在我的家庭服务器上，它就无法从媒体库中提取任何内容（我可以打开媒体播放器来验证库中是否有歌曲)

一开始我还以为是进程问题，所以我尝试了将应用程序池设置为在我自己的帐户下运行，并通过身份模拟标签进行设置；都没有解决问题。

我不确定还有哪些其他差异会导致问题

# process - 我将如何拍摄流程快照以保留其状态以供将来调查？这可能吗？

> ID：138255
> 
> 赞同：1
> 
> 时间：2008-09-26T08:14:46.040
> 
> 标签：process, state, snapshot

我不知道这是否可能，但它会非常有用！

我有一个定期失败的进程（在 Windows 2000 中运行）。然后我只有一次机会对它做出反应，然后不得不重新启动它并痛苦地等待它再次失败。我没有写这个过程，所以没有调试的源代码。失败似乎是随机的。

通过对过程的快照，我可以反复快速地测试对失败的反应。

我曾想过在虚拟机中运行，但在这种情况下这是不可能的。

编辑：@Jon Cage 问：

> 当您说快照时，您的意思是捕获即将失败的进程（包括内存，程序状态等）......然后在最后几秒钟反复重播它以查看它对其他组件有什么影响？

这正是我的意思！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T08:49:21.450

我认为[minidump](http://www.codeproject.com/KB/debug/postmortemdebug_standalone1.aspx)是您正在寻找的。

您还可以使用[Userdump](http://www.microsoft.com/downloads/details.aspx?FamilyID=E089CA41-6A87-40C8-BF69-28AC08570B7E&displaylang=en&displaylang=en)：

> 用户模式进程转储程序 (userdump) 可即时转储任何正在运行的 Win32 进程内存映像（包括 csrss.exe、winlogon.exe、services.exe 等系统进程），而无需附加调试器或终止目标进程。生成的转储文件可以使用标准调试工具进行分析或调试。

本文[将向](http://www.dumpanalysis.org/blog/index.php/2007/06/28/correcting-microsoft-article-about-userdumpexe/)您展示如何使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T08:31:14.160

我最好的选择是在调试器中启动该过程（[OllyDbg](http://www.ollydbg.de/)是我的首选工具）。该过程将在出现异常时暂停，您可以尝试找出在那之前不久发生的事情。

这需要对汇编器有一定的了解，并且不允许创建过程的快照以供以后分析。您需要为此编写自己的调试器——理论上应该是可行的。

# asp.net - 在 SQL 中选择查询 + 列中的所有值

> ID：138261
> 
> 赞同：4
> 
> 时间：2008-09-26T08:16:31.700
> 
> 标签：asp.net, sql-server

我有一个表 Table1 列 id1、id2、id3 所有列都可以为空

我可以在行中的所有列中输入空值或值。

我的问题是我需要选择所有列值都不应该为空的行。

谢谢

* * *

表中总共有大约 300 列。我不能为条件`is null`中的所有列做属性`where`。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T08:20:45.777

使用“函数”测试空值的答案是正确的。语法取决于数据库。如果您的数据库中不存在 ISNULL()，请尝试：

SELECT * FROM Table1 WHERE id1 IS NOT NULL AND id2 IS NOT NULL AND id3 IS NOT NULL

即使您的表中有 300 个字段，也无法缩短此时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T08:37:59.947

不明白为什么这个问题会受到负面评论 - 这个问题可以扩展到从社区中的非程序员那里继承了一张大桌子的人（我从以前的经验中知道），同样如果这张桌子是未知的。降级这是因为它的“300”列是毫无意义的IMO。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T08:29:39.733

最好的办法是重新考虑表的设计，如果需要，将它们分开。

否则最好的选择是以编程方式进行 - 获取表元数据，遍历列并从那里干式创建 SQL。大多数编码语言都可以访问表元数据，但它不需要第二个 SQL。

但是，最好的办法是想想我怎样才能更好地设计桌子。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T11:12:06.083

你需要这样做：

```
SELECT *
FROM yourtable
WHERE
    column1 IS NOT NULL
AND column2 IS NOT NULL
AND column3 IS NOT NULL
AND .... 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T08:22:03.277

您是说要选择所有列都不为空的行吗？

 `````
SELECT id1, id2, id3 
FROM Table1 
WHERE id1 IS NOT NULL AND id2 IS NOT NULL AND id3 IS NOT NULL

````  `* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T15:09:09.903

抱歉 - 我可能在这里有点厚。您正在尝试取回在其中一列（除了 id 列）中有 SOMETHING 的行吗？

你不能吗？

```
创建 vw_View_Fields1to5 为
  从员工中选择 id
  其中 name 不为 null 或 description 不为 null 或 field3 不为 null
  或 field4 不为空或 field5 不为空；
创建 vw_View_Fields6to10 为
  从员工中选择 id
  其中 field6 不为 null 或 field7 不为 null 或 field8 不为 null
  或字段 9 不为空或字段 10 不为空；
（ETC）

从 vw_View_Fields1to5 中选择 id
联盟
从 vw_View_Fields6to10 中选择 id .... （等）

```

当然，您必须采取 DISTINCT 或其他方式来减少落入多个视图的行。

如果您希望返回除 id 之外的任何列中没有任何内容的行，您可以将 ' **or blah is not null** ' 切换为 '**并且 blah is null** ' （等等）。

这有意义......还是我错过了什么？:-)

编辑：实际上，我相信 UNION 过程无论如何只会带回不同的行（而不是 UNION ALL），但我可能是错的 - 我实际上还没有尝试过......（还没有！）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T08:33:05.747

您可以尝试 CLR 存储过程（如果您使用的是 SQL Server）或使用 C# 或您使用的任何语言将此逻辑移动到应用程序的另一层。

另一种选择是动态创建查询，连接您的 WHERE 子句并执行您动态生成的查询。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T08:54:37.710

您只是在读取数据，还是想尝试更新有问题的行？

我只是想知道您是否可以通过制作六个视图来完成某些操作，每个视图都基于说 50 列不为空，然后将它们与某种 EXISTS 或 UNION 语句链接起来？

你能告诉我们更多关于你想用你的结果集做什么吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T05:15:30.260

第一次无论 Georgi、engram 还是 robsoft 都是这样。但是，对于后续的内容，如果可能的话，您可以更改表并添加一个名为 CSELECTFLAG 的列，并且最初将所有具有值的列更新为 Y，其他列更新为 N。每次有插入时都需要更新。这将有助于使您的后续查询更快、更容易。

# language-agnostic - 什么是哈希表和哈希映射以及它们的典型用例？

> ID：138273
> 
> 赞同：41
> 
> 时间：2008-09-26T08:19:32.583
> 
> 标签：language-agnostic, hashtable, hashmap

我最近几次遇到这些术语，但我很困惑它们是如何工作的以及它们通常何时实施？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-09-26T08:25:12.100

嗯，这样想吧。

如果你使用一个数组，一个简单的基于索引的数据结构，并用随机的东西填充它，当你用数据填充它时，找到一个特定的条目会变得越来越昂贵，因为你基本上必须从一端朝向另一端，直到你找到你想要的。

如果您想更快地访问数据，您通常会求助于对数组进行排序并使用二进制搜索。然而，这在提高查找现有值的速度的同时，也会使插入新值变慢，因为当您需要在中间插入一个元素时，您需要移动现有元素。

另一方面，哈希表有一个相关的函数，它接受一个条目，并将其简化为一个数字，一个哈希键。然后将该数字用作数组的索引，这是您存储条目的位置。

哈希表围绕一个数组旋转，该数组最初是空的。空并不意味着零长度，数组以一个大小开始，但数组中的所有元素都不包含任何内容。

每个元素都有两个属性，数据和标识数据的键。例如，美国的邮政编码列表将是邮政编码 -> 名称类型的关联。该函数减少密钥，但不考虑数据。

因此，当您将某些内容插入哈希表时，该函数会将键减少为一个数字，该数字用作此（空）数组的索引，这是您存储数据的地方，包括键和相关数据。

然后，稍后，您想找到一个您知道密钥的特定条目，因此您通过相同的函数运行该密钥，获取它的哈希键，然后转到哈希表中的那个特定位置并在那里检索数据。

理论认为，将您的密钥减少为哈希密钥的函数，即该数字，在计算上比线性搜索便宜得多。

典型的哈希表没有无限数量的可用于存储的元素，因此该数量通常会进一步减少到适合数组大小的索引。一种方法是简单地将索引的模数与数组的大小进行比较。对于大小为 10 的数组，索引 0-9 将直接映射到索引，索引 10-19 将再次映射到 0-9，以此类推。

一些键将减少到与哈希表中现有条目相同的索引。此时，直接比较实际的键，所有规则都与比较键的数据类型相关联（例如，普通字符串比较）。如果完全匹配，则要么忽略新数据（它已经存在），要么覆盖（替换该键的旧数据），或者添加它（多值哈希表）。如果没有匹配，这意味着尽管哈希键是相同的，但实际的键不是，您通常会找到一个新的位置来存储该键+数据。

冲突解决有很多实现，最简单的一种就是直接去数组中的下一个空元素。不过，这个简单的解决方案还有其他问题，因此找到正确的解析算法也是哈希表的一个很好的练习。

哈希表也可以增长，如果它们完全（或接近）填满，这通常是通过创建一个新大小的新数组，再次计算所有索引，并将项目放入新数组中的新地点。

将密钥减少为数字的函数不会产生线性值，即。“AAA”变为 1，然后“AAB”变为 2，因此哈希表不按任何典型值排序。

[这里](http://en.wikipedia.org/wiki/Hashtable)也有一篇很好的关于该主题的维基百科文章。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-09-26T09:33:09.287

lassevk 的回答非常好，但可能包含太多细节。这是执行摘要。我**故意省略了某些相关**信息，您可以放心地忽略 99% 的时间。

99% 的情况下，哈希表和哈希映射之间没有**重要区别。**

## 哈希表很神奇

严重地。它是一个神奇的数据结构，几乎**可以保证三件事**。（也有例外。您可以在很大程度上忽略它们，尽管有一天学习它们可能对您有用。）

1) 哈希表中的所有内容都是一对的一部分——有一个**键**和一个**值**。您通过指定您正在操作的键来输入和取出数据。

2）如果您通过哈希表上的单个键执行任何操作，它的速度非常**快**。这意味着 、`put(key,value)`、`get(key)`和`contains(key)`都`remove(key)`非常快。

3) 通用哈希表**无法执行 #2 中未列出的任何操作**！（通过“失败”，我们的意思是他们非常缓慢。）

## 我们什么时候使用哈希表？

**当哈希表的魔力适合我们的问题时，**我们会使用哈希表。

 **例如，**缓存**经常使用哈希表结束——例如，假设我们在一所大学有 45,000 名学生，并且某个进程需要保留所有学生的记录。如果您经常通过 ID 号引用学生，那么`ID => student`缓存非常有意义。您正在为此缓存优化的操作是**快速查找**。

当您不想全力以赴并更改对象本身时，哈希对于**存储数据之间的关系也非常有用。**例如，在课程注册期间，能够将学生与他们正在学习的课程联系起来可能是一个好主意。但是，无论出于何种原因，您可能不希望 Student 对象本身知道这一点。`studentToClassRegistration`在你做任何你需要做的事情时， 使用散列并保留它。

它们也是**数据结构的一个相当不错的首选，**除非您需要执行以下操作之一：

## 何时不使用哈希表

**迭代元素**。哈希表通常不能很好地进行迭代。（即通用的。特定的实现有时包含链表，用于减少对它们的迭代。例如，在 Java 中，`LinkedHashMap`可以让您快速迭代键或值。）

**排序。** 如果你不能迭代，排序也是一种痛苦。

**从 value 到 key**。使用*两个*哈希表。相信我，我只是为你减轻了很多痛苦。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T08:30:49.997

如果您在谈论 Java，两者都是允许添加、删除和更新对象并在内部使用 Hasing 算法的集合。

然而，如果我们谈到 Java，显着的区别在于哈希表本质上是同步的，因此是线程安全的，而哈希映射不是线程安全的集合。

除了同步之外，存储和检索对象的内部机制在这两种情况下都是散列。

如果您需要了解散列是如何工作的，我建议您在谷歌上搜索一下数据结构和散列技术。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-26T08:26:37.230

哈希表/哈希图将一个值（为消除歧义称为“键”）与另一个值相关联。您可以将它们视为一种字典（单词：定义）或数据库记录（键：数据）。

# hash - GUID 的哈希值是否唯一？

> ID：138279
> 
> 赞同：24
> 
> 时间：2008-09-26T08:22:50.843
> 
> 标签：hash, guid, unique

我创建一个 GUID（作为字符串）并获取它的哈希值。我可以认为这个哈希是唯一的吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-26T08:24:28.390

不像 GUID 本身那样可靠独特，不。

只是为了扩展，您将您的唯一性减少了 4 倍，从 16 个字节到 4 个字节的可能组合。

正如评论中指出的那样，哈希大小会有所不同。4 字节的东西是一个假设，我知道充其量是可怕的，它可以在 .NET 中使用，其中默认哈希大小为 4 字节（int）。所以你可以用你的散列可能是什么字节大小来替换我上面所说的。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-26T08:27:09.740

没有。

如果您想要一个迷你 GUID，请参见此处：[https ://devblogs.microsoft.com/oldnewthing/20080627-00/?p=21823](https://devblogs.microsoft.com/oldnewthing/20080627-00/?p=21823)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-26T08:27:31.377

一句话，没有。

假设您的哈希比 GUID 的位数少，根据鸽子洞原理，必须存在多个 GUID -> 哈希的映射，因为哈希比 GUID 少。

如果我们假设散列具有比 GUID 更多的位数，那么在您使用良好的散列函数的情况下，发生冲突的可能性非常小（但有限）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T08:28:18.520

将任意大小的数据块减少到固定大小的位数的散列函数不会在两者之间产生一对一的映射。总是存在将两个不同的数据块减少为哈希中相同的位序列的机会。

好的散列算法将这种情况发生的可能性降到最低，通常，散列中的位越多，发生冲突的可能性就越小。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T08:25:26.343

由于**散列冲突**，它**不能保证**。GUID 本身几乎可以保证。

 **出于实际原因，您可能可以假设散列是唯一的，但为什么不使用 GUID 本身呢？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T09:06:51.097

不，我不会假设任何哈希值的唯一性。这无关紧要，因为哈希值不需要唯一，它们只需要均匀分布在它们的范围内。分布越均匀，发生的冲突就越少（在哈希表中）。更少的冲突意味着更好的哈希表性能。

fyi 有关哈希表如何工作的良好描述，请阅读[什么是哈希表和哈希映射及其典型用例？](https://stackoverflow.com/questions/138273/what-are-hashtables-and-hashmaps-and-their-typical-use-cases)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T09:29:30.900

*如果您使用加密散列（MD5、SHA1、RIPEMD160），散列将是唯一的（模冲突，这是非常不可能的——SHA1 用于例如数字签名，MD5 在随机输入*上也是抗冲突的）。不过，为什么要散列 GUID？

# performance - 如何在多站点场景中提高 CVS 性能？

> ID：138280
> 
> 赞同：1
> 
> 时间：2008-09-26T08:23:07.723
> 
> 标签：performance, cvs

我目前正在与开发人员在三个站点上工作的项目中工作。其中一个位于印度德里，另外两个位于欧洲。欧洲办事处和德里办事处之间的通信带宽很差，延迟也很差，从那里进行 CVS 更新通常需要 5-10 分钟，即使只有几个文件发生了变化。

有没有好的 CVS 代理，或者有什么巧妙的方法可以让单独的 CVS 服务器保持同步？对于在这种情况下如何提高性能，您还有其他提示吗？

不幸的是，在这个项目的范围内，我们将被 CVS 卡住，所以在短期内切换到完全不同的东西不是一个选择。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T08:23:49.733

为什么不切换选项？

我强烈建议改用 SVN 或 git。并且您尽快进行此转换......就像今天一样:)

甚至还有[svn 工具/指南](http://www.google.ca/search?rlz=1C1CHMG_enCA291&sourceid=chrome&ie=UTF-8&q=cvs+to+svn)和[git 工具/指南](http://www.google.ca/search?hl=en&rlz=1C1CHMG_enCA291&q=cvs+to+git&btnG=Search&meta=)可以为您进行 CVS 转换。

我个人在工作中使用并喜欢 SVN，但根据您的上述描述，听起来 git 可能是您更好的选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T13:38:51.603

这是我很久以前在带宽和不可靠网络成为问题的类似情况下所做的：

*   制作存储库的副本并将其安装在远程位置。你知道有 CVS1 和 CVS2。
*   通过阻止提交来锁定两个副本（CVS1）之一。这是通过修改 CVSROOT 模块中的 'commitinfo' 来实现的。
*   CVS1 只能用于更新
*   CVS2 可用于更新和提交

当您想在提交中授予对副本 1 的访问权限时，请执行以下操作：

*   锁定 CVS2
*   将 CVS2 复制到 CVS1
*   解锁 CVS1

这听起来很麻烦，如果您手动执行它，但它确实有效。如果您手动进行，则需要一些纪律。可能时区一次就在你身边。

我编写了一个工具来跟踪谁拥有提交令牌，并通过 rsync 和 SSH 自动将存储库从一个站点传输到另一个站点。它工作了几年。我们从未丢失任何数据，将令牌从一个位置转移到另一个位置大约需要 5 分钟。

传输工具是用 perl 编写的，我花了大约两周的时间来开发它，全职工作。

我知道很久以前 FreeBSD 开发人员使用[CVSup](http://www.cvsup.org/)，但我自己从未使用过该工具。

# rdf - 对于您的语义网络类型应用程序，您使用 RDF 还是专有模型进行内部表示？

> ID：138292
> 
> 赞同：4
> 
> 时间：2008-09-26T08:27:22.737
> 
> 标签：rdf, semantic-web

如果您从事过一个存储数据以供语义网络使用的项目，您是否使用 RDF 甚至 OWL 作为内部数据格式，或者您是否有自己的数据模型/本体映射到 RDF 以实现互操作性？

如果您使用 RDF，您在实现诸如循环类层次结构之类的各种事物方面有什么经验？

如果你自己做，它与 RDF/OWL 有何不同？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T21:09:08.493

我与 HP 的 Jena 团队一起工作（事实上，我自己也为 Jena 做出了贡献），所以在我们的团队中使用 Jena 是一个相当直接的选择。然而，除了“下一个工作台”的便利之外，还有更多的原因。语义网的各种标准包含相当多的细节和复杂性，而要做到这一点并不是一件容易的事。我遇到了许多可下载的本体和其他数据集，例如，它们不符合 IRI 规范。在一个完全独立的应用程序中，如果您违反标准走捷径可能并不重要，但在这种情况下，您首先需要问为什么要使用语义网络技术。对我来说，semweb 方法对应用程序的一个重要价值是数据互操作和开放数据链接，

我的大部分数据都在三重存储中，但我确实使用自定义表作为常见查询的索引。如果您提前知道查询模式，那么对于通用无模式三元组存储来说，一个好的数据库引擎中索引良好的表将很难被击败。

显然，使用 Jena 的一个缺点是它是特定于 Java 的。我确实将 Jena 与 jruby 一起使用，但我期待一个好的原生 Ruby RDF 库（工作[正在进行中](http://tommorris.org/blog/2008/02/27)）。当我们在做复杂的富客户端界面时，我还希望在 Javascript 和 Flex 中提供更完整的 RDF/OWL 支持。

伊恩

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T08:35:57.223

我目前正在从事该领域的一些非常小的项目，并且我“主要”在那里使用 RDF，尽管出于解析目的，我使用简单的 URI 注册表以避免数据结构本身的循环。虽然，我不得不说我还处于这些项目的概念阶段。最后，我主要依赖于 Jena、rdflib 等第三方存储后端。

# delphi - Delphi 2009 和 Informix dbExpress 与 Windows 2003

> ID：138298
> 
> 赞同：7
> 
> 时间：2008-09-26T08:28:44.417
> 
> 标签：delphi, delphi-2009, informix, dbexpress

我有一个简单的应用程序，它使用 dbExpress 连接 Informix 数据库。如果我用 TurboDelphi 编译它，它可以在 WinXP 和 Win2003 上运行。

当我使用新的 Deplhi 2009 时，我的应用程序在 WinXP 上运行正常，但在 Win2003 上无法启动。没有错误消息框，只有事件日志中的信息：

> 错误应用程序 inf_dbexpress_test.exe，版本 0.0.0.0，错误模块 kernel32.dll，版本 5.2.3790.4062，错误地址 0x0000bee7。

我认为这是 dbExpress 驱动程序的问题，而我使用 ODBC 连接 Informix 的德里 2009 编译的其他应用程序在 Win2003 上工作。

任何人都可以测试来自 Delphi 2009 的 Informix dbExpress 驱动程序是否适用于 Windows 2003？

* * *

感谢您的帮助，但它不起作用。

至于`$INFORMIXDIR`：我重新安装了 ClientSDK 3.5，我`$INFORMIXDIR`现在是：

> c:\informix

（是 c:\Program Files ...）。

我可以从使用 ODBC 的应用程序连接到数据库。但是 dbExpress 应用程序无法启动，即使在 WinXP 兼容模式下也是如此。

* * *

我已在 Delphi Quality Central 中将其报告为[错误 #67823：](http://qc.codegear.com/wc/qcmain.aspx?d=67823)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T17:27:21.840

你有哪个 turbo 版本（.net 版本或 Win32 版本）？您是否在 2003 年安装了 .net 框架？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:58:22.973

嗯，这可能是一个奇怪的建议，但 Delphi 2009 中引入的最大差异之一是 Unicode。所有字符串现在都是 Unicode 字符串。这可能是对问题的解释吗？

# .net - 如何在具有 GUID 主键和默认 newsequentialid() 的表上使用 SQLBulkCopy？

> ID：138302
> 
> 赞同：6
> 
> 时间：2008-09-26T08:30:18.797
> 
> 标签：.net, sql

在具有 GUID 主键和默认 newsequentialid() 的表上使用 SQLBulkCopy 时

例如

```
CREATE TABLE [dbo].[MyTable](
[MyPrimaryKey] [uniqueidentifier] NOT NULL CONSTRAINT [MyConstraint]  DEFAULT (newsequentialid()),
[Status] [int] NULL,
[Priority] [int] NULL,
 CONSTRAINT [PK_MyTable] PRIMARY KEY NONCLUSTERED 
(
[MyPrimaryKey] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY] 
```

使用 C# 代码

```
 tran = connection.BeginTransaction();
        SqlBulkCopy sqlCopy = new SqlBulkCopy(connection,SqlBulkCopyOptions.Default, tran);            

        sqlCopy.DestinationTableName = "MyTable";            
        sqlCopy.WriteToServer(dataTable); 
```

给你一个错误...

列“MyPrimaryKey”不允许 DBNull.Value

我试过摆弄 SqlBulkCopyOptions。唯一可行的是将 MyPrimaryKey 字段设置为允许空值并删除主键。

有谁知道这个问题是否有解决方法？或者您能否验证没有解决方法（除了更改表结构）？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T14:24:38.497

You need to set up the column mappings. First call

```
sqlCopy.ColumnMappings.Clear(); 
```

Then call

```
sqlBulkCopy.ColumnMappings.Add("Status", "Status");
sqlBulkCopy.ColumnMappings.Add("Priority", "Priority"); 
```

This means the bulk copy will stop trying to insert into MyPrimaryKey column and will only insert into the status and Priority columns.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T14:18:08.577

You're only options are to remove the MyPrimaryKey field from the data that is being loaded or to modify the table structure.

With the field being there with no values you are telling SQL that you want to force a null into the field, which, obviously, is not allowed.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-15T00:13:36.253

在写入之前从列集中删除数据库生成的列是您需要做的。

我们对大多数数据库操作使用 LINQ-to-SQL，但使用另一种方法一次插入多条记录，因为 L2S 在这方面有点慢。

我们有一个通用方法`BulkInsertAll<>`，我们可以在任何`SqlBulkCopy`内部使用的表上使用它。我们基于泛型类型的属性使用反射动态生成列。位于`ColumnAttribute`从我们的 .dbml 文件生成的 .cs 文件中，我们已将 guid 主键列指定为`IsDbGenerated="true"`.

```
public void BulkInsertAll<T>( IEnumerable<T> entities ) {
    entities = entities.ToArray();

    string cs = Connection.ConnectionString;
    var conn = new SqlConnection( cs );
    conn.Open();

    Type t = typeof( T );

    var tableAttribute = (TableAttribute) t.GetCustomAttributes(
        typeof( TableAttribute ), false
    ).Single();

    var bulkCopy = new SqlBulkCopy( conn ) {
        DestinationTableName = tableAttribute.Name
    };

    var properties = t.GetProperties().Where( EventTypeFilter );

    // This will prevent the bulk insert from attempting to update DBGenerated columns
    // Without, inserts with a guid pk will fail to get the generated sequential id
    // If uninitialized guids are passed to the DB, it will throw duplicate key exceptions
    properties = properties.Where( 
        x => !x.GetCustomAttributes( typeof( ColumnAttribute ), false )
            .Cast<ColumnAttribute>().Any( attr => attr.IsDbGenerated )
    );

    var table = new DataTable();

    foreach( var property in properties ) {
        Type propertyType = property.PropertyType;
        if( propertyType.IsGenericType &&
            propertyType.GetGenericTypeDefinition() == typeof( Nullable<> ) ) {
            propertyType = Nullable.GetUnderlyingType( propertyType );
        }

        table.Columns.Add( new DataColumn( property.Name, propertyType ) );
    }

    foreach( var entity in entities ) {
        table.Rows.Add( 
            properties.Select( 
                property => GetPropertyValue( property.GetValue( entity, null ) ) 
            ).ToArray()
        );
    }

    //specify the mapping for SqlBulk Upload
    foreach( var col in properties ) {
        bulkCopy.ColumnMappings.Add( col.Name, col.Name );
    }

    bulkCopy.WriteToServer( table );

    conn.Close();
}

private bool EventTypeFilter( System.Reflection.PropertyInfo p ) {
    var attribute = Attribute.GetCustomAttribute( p,
        typeof( AssociationAttribute ) ) as AssociationAttribute;

    if( attribute == null ) return true;
    if( attribute.IsForeignKey == false ) return true;

    return false;
}

private object GetPropertyValue( object o ) {
    if( o == null )
        return DBNull.Value;
    return o;
} 
```

这很好用。实体不会使用新分配的 Guid 进行更新，因此您必须进行另一个查询才能获取这些实体，但新行在数据库中具有属性生成的 guid。

我们可以将该`.Where`过滤器包装到 EventTypeFilter 方法中，但我不是编写大部分内容的人，而且我还没有通过它来调整所有内容。

# biztalk - Biztalk 主机进程的配置文件

> ID：138308
> 
> 赞同：3
> 
> 时间：2008-09-26T08:31:49.120
> 
> 标签：biztalk, configuration-files

一个 Biztalk Server 可以有多个 Host 进程。是否可以为每个主机进程创建一个应用程序配置文件？例如，我想使用 Unity 或 log4net 或任何需要此类配置文件的东西。

编辑：感谢大卫霍尔。更详细一点：我们在一个组中有 12 个 Biztalk 服务器，每个服务器运行 5 到 10 个主机进程。宿主进程运行的某些东西对于每个进程来说都是独一无二的，但它们在库级别上也共享大量代码。我的问题的触发因素是需要为当前造成麻烦的一个系统部分（相当于主机进程）配置例如跟踪级别。

作为替代方案，如果我能弄清楚当前代码在哪个主机进程中运行会有所帮助，但我会将其发布到另一个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T08:58:50.990

如果我正确解释了您的问题，您是否希望能够为每个主机实例提供单独版本的 BTSNTSvs.exe.config 文件？

那么，除了 BizTalkServerApplication 主机实例之外，您还有 YourHostInstance 主机实例，您希望有一个单独的配置吗？

我不是**100%**知道你不能这样做，但我几乎可以肯定这是不可能的。

我相当确定这是不可能的原因是：

1.  BTSNTSvc.exe.config 文件附加到主可执行文件 BTSNTSvc.exe
2.  BTSNTSvc.exe.config 中的配置更改适用于所有主机实例，无论其名称如何。

我刚刚翻阅了我必须手头的 BizTalk 书籍以及一些优秀的网络资源，但找不到任何人在做你想做的事。

据我所知，您需要将 log4net 之类的配置设置放入 BTSNTSvc.exe.config 文件中，并为每个主机实例设置相同的设置。

接近您想要的一种方法是从规则引擎加载应用程序特定的设置。

# javascript - 是否可以使用 JavaScript 操作嵌入在 HTML 文档中的 SVG 文档？

> ID：138309
> 
> 赞同：21
> 
> 时间：2008-09-26T08:32:03.240
> 
> 标签：javascript, html, svg

我制作了一个 SVG 图像，或者更像是迷你应用程序，用于查看数据图表。我想将其包含在 HTML 页面中，并在 SVG 图像上调用方法。

例子：

```
<object id="img" data="image.svg" width="500" height="300"/>
<script>document.getElementById("img").addData([1,23,4]);</script> 
```

是否可以在 SVG 文档上调用方法？如果是这样，我如何声明要在 SVG 文件中公开的方法，以及如何从 HTML 文档中调用它们？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T08:55:58.297

解决方案：

在 svg 中：

```
<script>document.method = function() {}</script> 
```

在 html 中（使用原型添加事件监听器）：

```
<script>$("img").observe("load", function() {$("img").contentDocument.method()}); 
```

您需要监听图像上的加载事件。加载图像后，您可以使用`element.contentDocument`访问 svg 文档上的文档变量。添加到其中的任何方法都将可用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-08-24T23:46:03.413

事情实际上比你想象的要简单。你不需要阅读复杂的教程来理解这个概念，你也不需要使用 JQuery。这是基本布局：

*   html 文档中的 JavaScript 函数。

    ```
    <script type="text/javascript">
    function change(){
        var s=document.getElementById("cube");
        s.setAttribute("stroke","0000FF");
    }
    </script> 
    ```

*   我们试图操纵的 SVG 元素。

    ```
    <svg width=100 height=100 style='float: left;'>
      <rect x="10" y="10" width="60" height="60" id="cube" onclick="change()" stroke=#F53F0C stroke-width=10 fill=#F5C60C />
    </svg> 
    ```

*   将触发更改的内联按钮。请注意，在我的示例中，也可以通过单击多维数据集本身来触发事件。

    ```
    <button onclick="change()">Click</button> 
    ```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-27T19:01:23.940

几年前，我被要求使用 SVG 创建一个基于 Ajax 的 2 人游戏。它可能不是您正在寻找的解决方案，但它可以帮助您侦听 SVG 中的事件。这是 SVG 控制器：

*仅供参考，SVG正在被拖放（它是Stratego）*

```
/****************** Track and handle SVG object movement *************/
var svgDoc;
var svgRoot;
var mover='';       //keeps track of what I'm dragging

///start function////
//do this onload
function start(evt){
    //set up the svg document elements
    svgDoc=evt.target.ownerDocument;
    svgRoot=svgDoc.documentElement;
    //add the mousemove event to the whole thing
    svgRoot.addEventListener('mousemove',go,false);
    //do this when the mouse is released
    svgRoot.addEventListener('mouseup',releaseMouse,false); 
}

// set the id of the target to drag
function setMove(id){ mover=id; }

// clear the id of the dragging object
function releaseMouse(){ 
    if(allowMoves == true){ sendMove(mover); }
    mover=''; 
}

// this is launched every mousemove on the doc
// if we are dragging something, move it
function go(evt){
    if(mover != '' && allowMoves != false) {
        //init it
        var me=document.getElementById(mover);

        //actually change the location
        moveX = evt.clientX-135; //css positioning minus 1/2 the width of the piece
        moveY = evt.clientY-65;
        me.setAttributeNS(null, 'x', evt.clientX-135);
        me.setAttributeNS(null, 'y', evt.clientY-65);
    }
}

function moveThis(pieceID, x, y) {
    $(pieceID).setAttributeNS(null, 'x', x);
    $(pieceID).setAttributeNS(null, 'y', y);
} 
```

我的应用程序是纯 SVG + JavaScript，但这就是它的要点。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-03T02:12:47.507

我会参考 David Dailey 博士作为你会发现的最棒的 SVG / JS 信息 [http://srufaculty.sru.edu/david.dailey/svg/](http://srufaculty.sru.edu/david.dailey/svg/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-03T02:03:27.680

我已经通过 JavaScripts 探索了 svg。请参阅博客：[使用 JavaScript 缩放 SVG 图形](http://davidchuprogramming.blogspot.com/2008/10/scaling-svg-graphics-with-javascript.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-11T23:03:20.020

另请参阅[jQuery SVG 插件](http://keith-wood.name/svg.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-10T10:40:06.287

有关 IE6 的支持，请查看[SVGWeb](http://code.google.com/p/svgweb/)。

库提供的示例代码中有关于如何使用 JavaScript 操作 SVG 的示例。

邮件列表的档案中也有相当多的信息。

# ruby-on-rails - 如何在 Rails 应用程序中关闭 CSRF 保护？

> ID：138311
> 
> 赞同：20
> 
> 时间：2008-09-26T08:32:50.973
> 
> 标签：ruby-on-rails, security, csrf

Rails 中内置的 CSRF 预防对我们正在进行的一些自动负载测试造成了一些问题，我想在整个过程中将其关闭。我该怎么做呢？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-26T09:01:03.637

我喜欢有明确答案的简单问题。

```
#I go in application.rb
self.allow_forgery_protection = false 
```

如果您只想这样做以进行测试，您可以将其移动到环境文件之一中（显然，您将触摸`Application`then 而不是`self`）。你也可以这样写：

```
#I still go in application.rb
self.allow_forgery_protection = false unless ENV["RAILS_ENV"] == "production" 
```

有关详细信息，请参见[此处](http://ryandaigle.com/articles/2007/9/24/what-s-new-in-edge-rails-better-cross-site-request-forging-prevention)。（延续 Rails 在 2 年前的博文中记录核心特性的优良传统，这些博文是从提交日志中提炼出来的。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-09-27T06:11:29.673

在 Rails 3 中，删除`protect_from_forgery`命令`app/controllers/application_controller.rb`

# php - 如何使用 php 从 html 中提取 img src、title 和 alt？

> ID：138313
> 
> 赞同：161
> 
> 时间：2008-09-26T08:33:05.950
> 
> 标签：php, html, regex, html-parsing, html-content-extraction

我想创建一个页面，其中列出了我网站上的所有图像以及标题和替代表示。

我已经给我写了一个小程序来查找和加载所有 HTML 文件，但现在我被困在如何从这个 HTML中提取和`src`提取：`title``alt`

```
<img **src**="/image/fluffybunny.jpg" **title**="Harvey the bunny" **alt**="a cute little fluffy bunny" />
```

我想这应该用一些正则表达式来完成，但由于标签的顺序可能会有所不同，而且我需要所有这些，我真的不知道如何以一种优雅的方式解析它（我可以通过char方式，但这很痛苦）。

* * *

## 回答 #1

> 赞同：265
> 
> 时间：2010-05-30T05:43:50.690

```
$url="http://example.com";

$html = file_get_contents($url);

$doc = new DOMDocument();
@$doc->loadHTML($html);

$tags = $doc->getElementsByTagName('img');

foreach ($tags as $tag) {
       echo $tag->getAttribute('src');
} 
```

* * *

## 回答 #2

> 赞同：214
> 
> 时间：2008-09-27T11:33:36.887

## 编辑：现在我知道了

使用正则表达式来解决这类问题是[一个坏主意](https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454)，并且可能会导致无法维护和不可靠的代码。最好使用[HTML 解析器](http://simplehtmldom.sourceforge.net/)。

## 正则表达式的解决方案

在这种情况下，最好将过程分成两部分：

*   获取所有 img 标签
*   提取他们的元数据

我假设您的文档不是 xHTML 严格的，因此您不能使用 XML 解析器。EG 与此网页源代码：

```
/* preg_match_all match the regexp in all the $html string and output everything as 
an array in $result. "i" option is used to make it case insensitive */

preg_match_all('/<img[^>]+>/i',$html, $result); 

print_r($result);
Array
(
    [0] => Array
        (
            [0] => <img src="/Content/Img/stackoverflow-logo-250.png" width="250" height="70" alt="logo link to homepage" />
            [1] => <img class="vote-up" src="/content/img/vote-arrow-up.png" alt="vote up" title="This was helpful (click again to undo)" />
            [2] => <img class="vote-down" src="/content/img/vote-arrow-down.png" alt="vote down" title="This was not helpful (click again to undo)" />
            [3] => <img src="http://www.gravatar.com/avatar/df299babc56f0a79678e567e87a09c31?s=32&d=identicon&r=PG" height=32 width=32 alt="gravatar image" />
            [4] => <img class="vote-up" src="/content/img/vote-arrow-up.png" alt="vote up" title="This was helpful (click again to undo)" />

[...]
        )

) 
```

然后我们通过循环获取所有 img 标签属性：

```
$img = array();
foreach( $result as $img_tag)
{
    preg_match_all('/(alt|title|src)=("[^"]*")/i',$img_tag, $img[$img_tag]);
}

print_r($img);

Array
(
    [<img src="/Content/Img/stackoverflow-logo-250.png" width="250" height="70" alt="logo link to homepage" />] => Array
        (
            [0] => Array
                (
                    [0] => src="/Content/Img/stackoverflow-logo-250.png"
                    [1] => alt="logo link to homepage"
                )

            [1] => Array
                (
                    [0] => src
                    [1] => alt
                )

            [2] => Array
                (
                    [0] => "/Content/Img/stackoverflow-logo-250.png"
                    [1] => "logo link to homepage"
                )

        )

    [<img class="vote-up" src="/content/img/vote-arrow-up.png" alt="vote up" title="This was helpful (click again to undo)" />] => Array
        (
            [0] => Array
                (
                    [0] => src="/content/img/vote-arrow-up.png"
                    [1] => alt="vote up"
                    [2] => title="This was helpful (click again to undo)"
                )

            [1] => Array
                (
                    [0] => src
                    [1] => alt
                    [2] => title
                )

            [2] => Array
                (
                    [0] => "/content/img/vote-arrow-up.png"
                    [1] => "vote up"
                    [2] => "This was helpful (click again to undo)"
                )

        )

    [<img class="vote-down" src="/content/img/vote-arrow-down.png" alt="vote down" title="This was not helpful (click again to undo)" />] => Array
        (
            [0] => Array
                (
                    [0] => src="/content/img/vote-arrow-down.png"
                    [1] => alt="vote down"
                    [2] => title="This was not helpful (click again to undo)"
                )

            [1] => Array
                (
                    [0] => src
                    [1] => alt
                    [2] => title
                )

            [2] => Array
                (
                    [0] => "/content/img/vote-arrow-down.png"
                    [1] => "vote down"
                    [2] => "This was not helpful (click again to undo)"
                )

        )

    [<img src="http://www.gravatar.com/avatar/df299babc56f0a79678e567e87a09c31?s=32&d=identicon&r=PG" height=32 width=32 alt="gravatar image" />] => Array
        (
            [0] => Array
                (
                    [0] => src="http://www.gravatar.com/avatar/df299babc56f0a79678e567e87a09c31?s=32&d=identicon&r=PG"
                    [1] => alt="gravatar image"
                )

            [1] => Array
                (
                    [0] => src
                    [1] => alt
                )

            [2] => Array
                (
                    [0] => "http://www.gravatar.com/avatar/df299babc56f0a79678e567e87a09c31?s=32&d=identicon&r=PG"
                    [1] => "gravatar image"
                )

        )

   [..]
        )

) 
```

正则表达式是 CPU 密集型的，因此您可能需要缓存此页面。如果您没有缓存系统，您可以通过使用[ob_start](http://fr2.php.net/manual/fr/function.ob-start.php)并从文本文件加载/保存来调整自己的缓存系统。

## 这东西是如何工作的？

首先，我们使用[preg_match_all](http://fr2.php.net/manual/fr/function.preg-match-all.php)，一个获取每个匹配模式的字符串并将其输出到它的第三个参数中的函数。

正则表达式：

```
<img[^>]+> 
```

我们将其应用于所有 html 网页。它可以被读取为*每个以 " " 开头`<img`、包含非 ">" 字符并以 > 结尾的*字符串。

```
(alt|title|src)=("[^"]*") 
```

我们将它依次应用于每个 img 标签。它可以被解读为*每个以“alt”、“title”或“src”开头的字符串，然后是“=”，然后是'"'，一堆不是'"'并以'"'结尾的东西. 隔离 () 之间的子字符串*。

最后，每次您想处理正则表达式时，拥有快速测试它们的好工具会很方便。检查这个[在线正则表达式测试器](http://regex.larsolavtorvik.com/)。

编辑：回答第一条评论。

确实，我没有考虑过（希望很少）使用单引号的人。

好吧，如果您只使用'，只需将所有“替换为'。

如果你把两者混合。首先你应该打自己一巴掌:-)，然后尝试使用 ("|') 代替或 " 和 [^ø] 代替 [^"]。

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2008-09-26T10:18:20.393

仅举一个使用 PHP 的 XML 功能完成任务的小例子：

```
$doc=new DOMDocument();
$doc->loadHTML("<html><body>Test<br><img src=\"myimage.jpg\" title=\"title\" alt=\"alt\"></body></html>");
$xml=simplexml_import_dom($doc); // just to make xpath more simple
$images=$xml->xpath('//img');
foreach ($images as $img) {
    echo $img['src'] . ' ' . $img['alt'] . ' ' . $img['title'];
} 
```

我确实使用了该`DOMDocument::loadHTML()`方法，因为该方法可以处理 HTML 语法并且不强制输入文档为 XHTML。`SimpleXMLElement`严格来说，不需要转换为 a - 它只是使使用 xpath 和 xpath 结果更简单。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-26T10:30:44.793

如果它是 XHTML，你的例子是，你只需要 simpleXML。

```
<?php
$input = '<img src="/image/fluffybunny.jpg" title="Harvey the bunny" alt="a cute little fluffy bunny"/>';
$sx = simplexml_load_string($input);
var_dump($sx);
?> 
```

输出：

```
object(SimpleXMLElement)#1 (1) {
  ["@attributes"]=>
  array(3) {
    ["src"]=>
    string(22) "/image/fluffybunny.jpg"
    ["title"]=>
    string(16) "Harvey the bunny"
    ["alt"]=>
    string(26) "a cute little fluffy bunny"
  }
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-09-28T16:59:34.353

我使用 preg_match 来做到这一点。

就我而言，我有一个字符串，其中包含`<img>`从 Wordpress 获得的一个标签（并且没有其他标记），我试图获取该`src`属性，以便可以通过 timthumb 运行它。

```
// get the featured image
$image = get_the_post_thumbnail($photos[$i]->ID);

// get the src for that image
$pattern = '/src="([^"]*)"/';
preg_match($pattern, $image, $matches);
$src = $matches[1];
unset($matches); 
```

在抓取标题或替代品的模式中，您可以简单地使用`$pattern = '/title="([^"]*)"/';`抓取标题或`$pattern = '/title="([^"]*)"/';`抓取替代品。可悲的是，我的正则表达式还不足以一次通过就抓住所有三个（alt/title/src）。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-01-27T07:24:20.060

您可以使用[simplehtmldom](http://simplehtmldom.sourceforge.net/)。simplehtmldom 支持大多数 jQuery 选择器。下面给出一个例子

```
// Create DOM from URL or file
$html = file_get_html('http://www.google.com/');

// Find all images
foreach($html->find('img') as $element)
       echo $element->src . '<br>';

// Find all links
foreach($html->find('a') as $element)
       echo $element->href . '<br>'; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-09-27T05:14:26.607

脚本必须像这样编辑

`foreach( $result[0] as $img_tag)`

因为 preg_match_all 返回数组数组

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-11-09T07:44:52.330

这是一个 PHP 函数，我出于类似目的从上述所有信息中蹒跚而行，即动态调整图像标签的宽度和长度属性……也许有点笨拙，但似乎工作可靠：

```
function ReSizeImagesInHTML($HTMLContent,$MaximumWidth,$MaximumHeight) {

// find image tags
preg_match_all('/<img[^>]+>/i',$HTMLContent, $rawimagearray,PREG_SET_ORDER); 

// put image tags in a simpler array
$imagearray = array();
for ($i = 0; $i < count($rawimagearray); $i++) {
    array_push($imagearray, $rawimagearray[$i][0]);
}

// put image attributes in another array
$imageinfo = array();
foreach($imagearray as $img_tag) {

    preg_match_all('/(src|width|height)=("[^"]*")/i',$img_tag, $imageinfo[$img_tag]);
}

// combine everything into one array
$AllImageInfo = array();
foreach($imagearray as $img_tag) {

    $ImageSource = str_replace('"', '', $imageinfo[$img_tag][2][0]);
    $OrignialWidth = str_replace('"', '', $imageinfo[$img_tag][2][1]);
    $OrignialHeight = str_replace('"', '', $imageinfo[$img_tag][2][2]);

    $NewWidth = $OrignialWidth; 
    $NewHeight = $OrignialHeight;
    $AdjustDimensions = "F";

    if($OrignialWidth > $MaximumWidth) { 
        $diff = $OrignialWidth-$MaximumHeight; 
        $percnt_reduced = (($diff/$OrignialWidth)*100); 
        $NewHeight = floor($OrignialHeight-(($percnt_reduced*$OrignialHeight)/100)); 
        $NewWidth = floor($OrignialWidth-$diff); 
        $AdjustDimensions = "T";
    }

    if($OrignialHeight > $MaximumHeight) { 
        $diff = $OrignialHeight-$MaximumWidth; 
        $percnt_reduced = (($diff/$OrignialHeight)*100); 
        $NewWidth = floor($OrignialWidth-(($percnt_reduced*$OrignialWidth)/100)); 
        $NewHeight= floor($OrignialHeight-$diff); 
        $AdjustDimensions = "T";
    } 

    $thisImageInfo = array('OriginalImageTag' => $img_tag , 'ImageSource' => $ImageSource , 'OrignialWidth' => $OrignialWidth , 'OrignialHeight' => $OrignialHeight , 'NewWidth' => $NewWidth , 'NewHeight' => $NewHeight, 'AdjustDimensions' => $AdjustDimensions);
    array_push($AllImageInfo, $thisImageInfo);
}

// build array of before and after tags
$ImageBeforeAndAfter = array();
for ($i = 0; $i < count($AllImageInfo); $i++) {

    if($AllImageInfo[$i]['AdjustDimensions'] == "T") {
        $NewImageTag = str_ireplace('width="' . $AllImageInfo[$i]['OrignialWidth'] . '"', 'width="' . $AllImageInfo[$i]['NewWidth'] . '"', $AllImageInfo[$i]['OriginalImageTag']);
        $NewImageTag = str_ireplace('height="' . $AllImageInfo[$i]['OrignialHeight'] . '"', 'height="' . $AllImageInfo[$i]['NewHeight'] . '"', $NewImageTag);

        $thisImageBeforeAndAfter = array('OriginalImageTag' => $AllImageInfo[$i]['OriginalImageTag'] , 'NewImageTag' => $NewImageTag);
        array_push($ImageBeforeAndAfter, $thisImageBeforeAndAfter);
    }
}

// execute search and replace
for ($i = 0; $i < count($ImageBeforeAndAfter); $i++) {
    $HTMLContent = str_ireplace($ImageBeforeAndAfter[$i]['OriginalImageTag'],$ImageBeforeAndAfter[$i]['NewImageTag'], $HTMLContent);
}

return $HTMLContent;

} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-05-15T13:57:38.907

我已阅读此页面上的许多评论，抱怨使用 dom 解析器是不必要的开销。好吧，它可能比单纯的正则表达式调用更昂贵，但 OP 已经声明无法控制 img 标签中属性的顺序。这一事实导致了不必要的正则表达式模式卷积。除此之外，使用 dom 解析器还提供了可读性、可维护性和 dom 感知（regex 不是 dom 感知）的额外好处。

我喜欢正则表达式，我回答了很多正则表达式问题，但是在处理有效的 HTML 时，很少有充分的理由在解析器上进行正则表达式。

在下面的演示中，看看 DOMDocument 是如何简单和干净地以任何顺序处理 img 标记属性并混合引用（并且根本没有引用）。另请注意，没有目标属性的标签根本不会造成破坏——提供一个空字符串作为值。

代码：（[演示](https://3v4l.org/jsNCc)）

```
$test = <<<HTML
<img src="/image/fluffybunny.jpg" title="Harvey the bunny" alt="a cute little fluffy bunny" />
<img src='/image/pricklycactus.jpg' title='Roger the cactus' alt='a big green prickly cactus' />
<p>This is irrelevant text.</p>
<img alt="an annoying white cockatoo" title="Polly the cockatoo" src="/image/noisycockatoo.jpg">
<img title=something src=somethingelse>
HTML;

libxml_use_internal_errors(true);  // silences/forgives complaints from the parser (remove to see what is generated)
$dom = new DOMDocument();
$dom->loadHTML($test);
foreach ($dom->getElementsByTagName('img') as $i => $img) {
    echo "IMG#{$i}:\n";
    echo "\tsrc = " , $img->getAttribute('src') , "\n";
    echo "\ttitle = " , $img->getAttribute('title') , "\n";
    echo "\talt = " , $img->getAttribute('alt') , "\n";
    echo "---\n";
} 
```

输出：

```
IMG#0:
    src = /image/fluffybunny.jpg
    title = Harvey the bunny
    alt = a cute little fluffy bunny
---
IMG#1:
    src = /image/pricklycactus.jpg
    title = Roger the cactus
    alt = a big green prickly cactus
---
IMG#2:
    src = /image/noisycockatoo.jpg
    title = Polly the cockatoo
    alt = an annoying white cockatoo
---
IMG#3:
    src = somethingelse
    title = something
    alt = 
--- 
```

在专业代码中使用这种技术会给你留下一个干净的脚本，更少的打嗝，更少的同事希望你在其他地方工作。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-11-13T13:52:25.357

这是 PHP 中的解决方案：

只需下载 QueryPath，然后执行以下操作：

```
$doc= qp($myHtmlDoc);

foreach($doc->xpath('//img') as $img) {

   $src= $img->attr('src');
   $title= $img->attr('title');
   $alt= $img->attr('alt');

} 
```

就是这样，你完成了！

# linux - linux编译多个java文件

> ID：138318
> 
> 赞同：1
> 
> 时间：2008-09-26T08:34:33.840
> 
> 标签：linux, shell, javac

这是我的目录结构。

/user/a /user/b /user/b

在文件夹 a,b,c 中有一个文件 person.java （它是同一个文件，只是一行修改。

现在，在我的外壳上，我在我的 /user/ 目录上，我尝试做

```
 javac */person.java 
```

外壳返回以下错误，

person.java:14：重复类：人

有什么可以解决的吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T08:42:04.587

我认为这里的问题可能是，javac 试图一次性编译所有内容，这自然会导致重复的类定义。

解决此问题的一种简单方法是

`find . -name '*.java' -exec javac {} \;`

**编辑：**

或者更准确地说`find . -name 'person.java' -maxdepth 2 -exec javac {} \;`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T08:55:16.537

我会选择小的 shell 脚本：

```
for f in */person.java; do
  javac $file
done 
```

第一行在子目录中找到所有文件 person.java，第二行编译该文件。

# version-control - 我如何使用 ClearCase 递归地“添加到源代码控制......”？

> ID：138321
> 
> 赞同：47
> 
> 时间：2008-09-26T08:35:41.937
> 
> 标签：version-control, clearcase

我将一个 zip 文件解压缩到一个清晰的视图中。现在我想将完整的文件树添加到存储库中。GUI 只为单个文件/目录提供“添加到源代码控制...”。你知道如何递归地添加整棵树吗？

（我在 Windows 系统上，但安装了 Cygwin。）

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-27T19:41:03.940

我宁愿使用 clearfsimport 脚本，更好地导入多次相同的文件集，并且自动：

*   添加新文件，
*   制作先前导入的现有文件的新版本（但在重新导入的源文件集中修改）
*   删除已导入但不再存在于源文件集中的文件。
*   清晰记录导入过程中的所有操作。

因此，如果您的 'zip 文件交付需要定期更新，clearfsimport 是可行的方法，但有以下选项：

```
clearfsimport -preview -rec -nset c:\sourceDir\* m:\MyView\MyVob\MyDestinationDirectory 
```

注意：

*   -preview 选项：它将允许在不实际执行任何操作的情况下检查*会发生什么。*
*   '*' 只在 Windows 环境下使用，为了导入目录的内容
*   -nset 选项。

来自[CMWiki](http://www.cmcrossroads.com/cgi-bin/cmwiki/view/CM/ClearFsImport)，关于“nset”选项：

> 默认情况下，clearfsimport 旨在供 vob 所有者或特权用户使用，但用户经常忽略 -nsetevent 选项，任何用户都可以使用该选项。
> 此选项驱动 clearfsimport 不将元素的时间戳设置为 vob 之外的源文件对象的时间戳（这需要特权访问）。
> 这样做有一个不明显的次要副作用：一旦使用当前时间戳创建了一个版本，即使是 vob 所有者也无法在其上导入具有较旧版本的版本（因为它会) 时间戳，没有这个 -nsetevent 选项。即，一旦您使用此选项，普通用户或特权用户，您或多或少都会继续使用它。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-29T08:15:57.237

这是我使用 Windows 资源管理器发现的另一种方法：

1.  从目标目录的上下文菜单中选择`Search...`。
2.  搜索`*`。
3.  在结果列表中选择所有 ( `Ctrl-A`) 文件/目录。
4.  从结果列表中某个项目的上下文菜单中选择`ClearCase`> `Add to source control...`。

给你...

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2016-04-11T13:29:48.830

由于我无权访问 clearfsimport ，因此我分两步添加了文件/目录：

1.)`find . ! -path . -type d | xargs cleartool mkelem -mkpath -nc`

这将递归地为所有新目录创建节点

2.)`find ./ -type f | xargs cleartool mkelem -nc`

这将递归地为所有新文件创建节点

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-06-25T18:51:26.783

当您选择“添加到源代码管理”时，ClearTeam Explorer 版本 8（可能更早）具有递归添加子目录/文件的功能。当“添加到源代码管理”对话框出现时，选中“包括所选目录的后代工件”复选框并取消选中“仅检出后代文件，不检出后代目录”复选框。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T08:37:51.807

您必须使用命令行。资源管理器中的上下文菜单不会递归执行此操作！

```
clearfsimport –recurse /usr/src/projectx /vobs/projectx/src 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-26T09:08:05.103

这是一个脚本来做它和提示从资源管理器集成脚本

[http://www.ibm.com/developerworks/rational/library/4687.html](http://www.ibm.com/developerworks/rational/library/4687.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-12-15T09:35:06.230

有类似的要求以递归方式将目录添加到 ClearCase。由于我无法访问 clearfsimport 工具，也没有将 ClearCase 与 Windows 资源管理器集成，因此在 ClearCase GUI 中找到了一个简单的解决方案。

1) 使用“添加到源代码管理”菜单选项添加根目录。2) 点击该目录，然后使用“ClearCase Search”搜索该目录下的所有Private Files。3）从搜索结果和“添加到源代码管理”中选择所有

给你！整个目录是从 ClearCase GUI 中递归添加的

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-11-03T21:45:42.013

你可以在

[http://www-01.ibm.com/support/docview.wss?ratlid=cctocbody&rs=984&uid=swg21117629](http://www-01.ibm.com/support/docview.wss?ratlid=cctocbody&rs=984&uid=swg21117629)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-09T13:45:28.837

您还可以使用小脚本将此命令添加到上下文菜单中...

[十大最佳触发器](http://www.ibm.com/developerworks/rational/library/4687.html)

**编辑**：哦，对不起。没有看到这已经被建议了......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-04-26T11:16:13.120

我同意，如果要进行版本控制的文件数量很大，则 Windows 资源管理器中的 find+select+add-to-source-control 不是一个好的选择。如上所述，如果我们尝试添加大量文件，explorer.exe 会崩溃。

clearfsimport 是完成这项任务的最佳和最轻松的实用程序。

-GP

# .net - .NET 的任何体面的文本差异/合并引擎？

> ID：138331
> 
> 赞同：114
> 
> 时间：2008-09-26T08:42:34.650
> 
> 标签：.net, merge, diff

要求：

*   免费，最好是开源的
*   在 .NET 托管语言之一中实现

谷歌发现了这些：

*   [一个通用的、可重用](http://www.codeproject.com/KB/recipes/diffengine.aspx)的代码项目差异算法
*   [C# 的 O(ND) 差分算法](http://www.mathertel.de/Diff/)
*   Joshua Tauberer[的 C#/.NET 的 Diff/Merge/Patch 库](http://razor.occams.info/code/diff/)

编辑：

请不要应用程序，只有库。

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-05-14T16:42:58.053

您可以获取[使用 Google 的 Diff/Patch/Match 的 COM 组件](https://stackoverflow.com/questions/848246/how-can-i-use-javascript-within-an-excel-macro)。它适用于 .NET。

**2010 年 10 月 17 日更新**：[Google Diff/Patch/Merge 代码](http://code.google.com/p/google-diff-match-patch/)已移植到 C#。COM 组件仍然可以工作，但如果您来自 .NET，您将希望直接使用 .NET 端口。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-26T09:32:17.383

我认为 Codeproject 上的“Generic - Reusable Diff Algorithm in C#”是你能找到的最好的 .NET 引擎，用于 diff/patch/merge。我用它自己做了一个项目，它适合我在大多数情况下的需求。当算法使补丁文件比它必须的大时，会出现一两个最坏的情况。但在大多数情况下，它对我来说效果很好（文本文件大小> 30 MB）。

我目前正在测试另一个 Codeproject-Project，您可以在此处找到：http: [//www.codeproject.com/KB/applications/patch.aspx](http://www.codeproject.com/KB/applications/patch.aspx) 它使用 Microsoft 的一些 DLL 进行修补，因此看起来很有趣。但是这些 DLL 是非托管的，这个项目只是它的某种包装器。但也许它可以帮助你

**编辑：** 刚刚找到另一个项目，**DiffPlex**：[http](http://diffplex.codeplex.com/) ://diffplex.codeplex.com/ 它*是 .NET Diffing Library 与 Silverlight 和 HTML diff viewer 的组合*。如上所述[，](https://docs.microsoft.com/en-us/archive/blogs/codeplex/net-4-and-change-set-listing) DiffPlex 是 CodePlex 用来生成文件差异的库。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-01-31T00:45:07.073

GitSharp 包含一个基于 meyers diff 的 diff 引擎。看一下基于 Diff.Sections 集合实现简单 wpf 差异查看器的演示：http: [//www.eqqon.com/index.php/GitSharp#GitSharp.Demo](http://www.eqqon.com/index.php/GitSharp#GitSharp.Demo)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-05-21T13:11:06.140

到目前为止，没有一个答案（可能除了 GitSharp 参考）涉及 3 路合并，所以如果它对我最近移植 Tony Garnock-Jones 的 javascript diff3 实现的任何人有帮助（来自 [同步加速器](http://homepages.kcbbs.gen.nz/tonyg/projects/synchrotron.html)项目，基于 Hunt 和 McIlroy 1976）到 C#。

It's a simplistic single-file port of diff and three-way merge methods, but it's the standard algorithm and so far works very well for me: [https://gist.github.com/2633407](https://gist.github.com/2633407)

# debugging - 开始学习Windbg

> ID：138334
> 
> 赞同：50
> 
> 时间：2008-09-26T08:45:15.843
> 
> 标签：debugging, windbg

[在被一个我根本不具备调试知识的问题](http://blogs.cozi.com/tech/2008/03/transparent-png.html)困扰之后，我决定*必须*学习如何使用 Windbg。我唯一的问题：我不知道从哪里开始 :-( 我不是真正的 WinApi-Guy，我使用的语言通常会从我身上抽象出 Windows Api。

所以我只是想知道：对于了解编程但对 Windows 内部深度了解不多的人来说，学习 Windbg 的最佳来源（书籍、网站）是什么？（是的，我确实每天都在阅读 oldnewthing :)）

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-01T19:10:07.943

有一些优秀的博客可以帮助您每天熟练掌握windbg：

*   [德格瓦洛夫博士](http://www.dumpanalysis.com/blog)
*   [尼娜芙](http://www.nynaeve.net)
*   [高级 Windows 调试](http://blogs.msdn.com/ntdebugging)
*   [调试工具箱](http://blogs.msdn.com/debuggingtoolbox)
*   [调试技巧](http://www.debugtricks.com)
*   [奥列格·斯塔罗杜莫夫](http://www.debuginfo.com)
*   [来自/发往 Ivan Brugiolo 的帖子列表](http://groups.google.com/groups/search?q=ivan+brugiolo+windbg&qt_s=Search+Groups)
*   [沃尔克·冯·埃涅姆的 Windbg](http://voneinem-windbg.blogspot.com/)

就我个人而言，我刚刚开始使用 windbg 来完成我**所有**的调试任务，很快就有很多我无法回答的问题，也很少有我无法解决的问题。强大而令人兴奋的工具。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-26T11:17:50.407

想要一本书，试试

[高级 Windows 调试（Addison-Wesley Microsoft 技术系列）](https://rads.stackoverflow.com/amzn/click/com/0321374460)

[![高级 Windows 调试](https://i.stack.imgur.com/27qDU.jpg)](https://i.stack.imgur.com/27qDU.jpg)
[（来源：[knowfree.net](http://knowfree.net/wp-content/uploads/2008/02/032137446001l.jpg)）]

此外，有关出色的参考表，请参阅

[Robert Kuster 的常见 WinDbg 命令（按主题分组）](http://windbg.info/doc/1-common-cmds.html)。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-01T09:28:51.677

一个很棒的博客是[如果它坏了，你应该修复它](http://blogs.msdn.com/tess/default.aspx)。实际上有一些关于 WinDbg 入门的帖子。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T11:27:52.147

*   Hewardt 和 Pravat 的高级 Windows 调试（最适合一般 Win32 的东西）
*   John Robbins 调试 .Net 2.0 应用程序（如果您需要 .Net 的 SOS）
*   [NT 调试博客](http://blogs.msdn.com/ntdebugging/default.aspx)（相当低级，但他们刚刚发布了一[组很好的链接](http://blogs.msdn.com/ntdebugging/archive/2008/09/25/some-of-our-favorite-debugging-related-links.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T11:13:16.643

我对调试器（实际上是软 ICE）的第一次体验是……嗯……有点破解。网上有一些关于如何使用调试器搜索事件和绕过/更改程序行为的指南。一旦您掌握了基本的调试器技能，您就可以使用任何简单的应用程序（或您自己的应用程序）并使用它。

（这只是我所说的指南之一：[http](http://www.woodmann.com/krobar/other/patch36.txt) ://www.woodmann.com/krobar/other/patch36.txt ）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T11:11:41.170

[Debugging .NET Applications](https://rads.stackoverflow.com/amzn/click/com/0735622027)有一章介绍如何使用 WinDbg

# asp.net - 中止 ASP.NET Web 服务异步调用

> ID：138346
> 
> 赞同：2
> 
> 时间：2008-09-26T08:52:11.397
> 
> 标签：asp.net, web-services

我有一个 Web 服务，它需要相当长的时间才能完成执行，并且我正在异步调用这个 Web 服务。我还想实现一个中止功能，它将中止 Web 服务方法。目前，我观察到，即使我处理了请求的 Web 服务对象，Web 服务仍然会在服务器端完成它的执行。我如何实现中止功能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T09:02:04.023

您在 Web 服务代理对象本身上调用 Abort() 方法。不要简单地丢弃它。

# testing - 游乐场项目

> ID：138348
> 
> 赞同：0
> 
> 时间：2008-09-26T08:52:32.707
> 
> 标签：testing

当我不确定某个项目的某些东西时，我通常会使用一个单独的小型项目，并将其作为需要测试的东西的游乐场。你是怎样做的 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T08:57:42.133

这取决于我想尝试什么。对于简单的算法内容，我有一个控制台应用程序，它由许多类组成，一个用于我想尝试的每一件事。这样，我将所有内容都包含在一个项目中，并且可以浏览我多年来尝试过的想法和方法。当我为一个问题尝试不同的解决方案时，我将文件夹用于新主题，并使用增加的索引（或类似的东西，通过查看类名可以很容易地看到实现中的差异）对类名进行后缀。

我对类所做的唯一维护是过滤掉（不再）不能编译的东西，但错误的方法只会在相应的类文件中被大量注释标记。对我来说，这也是了解我的技能如何随着时间的推移而提高的好方法……而且查看旧代码也很有趣。

对于 GUI 相关的东西以及 ASP.net 应用程序，我有一个类似的方法，所以我总共有三个测试项目，都按照上述方式组织。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T09:10:39.417

我使用了我在 Ron Jeffries 的“C# 中的 TDD 冒险”中第一次看到的“尖峰测试”想法。尖峰测试被编码为单元测试类，使用您想要尝试的代码块而不是测试方法。这样，您可以通过在测试运行器中运行它来轻松尝试一些您不喜欢的代码。

我通常将尖峰测试与单元测试放在同一个项目中。一旦进入存储库，尖峰测试代码可以帮助其他开发人员了解您在生产代码中的决策。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T08:55:37.393

我也是这样做的。临时项目有一些缺点......一旦你想测试其他东西，你就必须设置一个新项目。我还发现游乐场是很好的参考。我经常记得我以前尝试过一些东西，然后我可以查看旧的 Playground 文件，甚至更改它以适应新的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T09:05:54.483

我不会将整个子项目用作游乐场——我通常会制作一个简单的测试用例，如果它按预期工作，我会将代码合并到我的项目中。在作为程序员的那段时间里，有很多这样的文本案例，我总是保留它们。有这个例子很好——所以每当我在想一些事情时，我总是先看看我的测试用例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T09:07:18.567

有时我会使用一个简单的控制台应用程序来测试。

其他时候，我克隆（或分支）主项目并在副本中尝试。通常，一旦我完成尝试，克隆就会被复制回（或合并到）原始文件。

还有一些时候，我会确保将主项目签入到源代码管理中，然后在那里进行尝试。如果我不喜欢事情的进展，我会回滚更改。

# python - 动态单选按钮创建

> ID：138353
> 
> 赞同：2
> 
> 时间：2008-09-26T08:54:37.787
> 
> 标签：python, user-interface, layout, wxpython

在 wxPython 中，如果我创建一个单选按钮列表并最初放置该列表，以后是否可以更改该列表中的内容？

例如，我有一个面板，它最初使用 boxSizer 来放置小部件。其中一个小部件是单选按钮列表（我也尝试过普通的单选框）。我想根据另一个类的变量动态更改列表。

但是，一旦将列表放入 sizer 中，它就会被有效地“锁定”；我不能只修改列表并显示更改。如果我尝试将列表重新添加到 sizer，它只会放在面板的左上角。

我确信我可以隐藏原始列表并手动将新列表放在相同的位置，但这感觉就像一个杂物。我敢肯定，我让这件事变得比现在更难。我可能为此使用了错误的小部件，更不用说错误的方法，但我将其构建为一种学习体验。

```
 class Job(wiz.WizardPageSimple):
    """Character's job class."""

    def __init__(self, parent, title, attribs):
        wiz.WizardPageSimple.__init__(self, parent)
        self.next = self.prev = None
        self.sizer = makePageTitle(self, title)
        self.charAttribs = attribs

#---Create widgets
        self.Job_list = ["Aircraft Mechanic", "Vehicle Mechanic", "Electronics Specialist"]

        box1_title = wx.StaticBox( self, -1, "" )
        box1 = wx.StaticBoxSizer( box1_title, wx.VERTICAL )
        grid1 = wx.BoxSizer(wx.VERTICAL)
        for item in self.Job_list:
            radio = wx.RadioButton(self, -1, item)
            grid1.Add(radio)

##Debugging
        self.btn = wx.Button(self, -1, "click")
        self.Bind(wx.EVT_BUTTON, self.eligibleJob, self.btn)

#---Place widgets
        self.sizer.Add(self.Job_intro)
        self.sizer.Add(self.btn)
        box1.Add(grid1)
        self.sizer.Add(box1)        

    def eligibleJob(self, event):
        """Determine which Jobs a character is eligible for."""

        if self.charAttribs.intelligence >= 12:
            skillList = ["Analyst", "Interrogator", "Fire Specialist", "Aircraft Pilot"]
            for skill in skillList:
                self.Job_list.append(skill)
            print self.Job_list ##Debugging
        #return self.Job_list 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T12:06:40.560

要使新的列表元素出现在正确的位置，您必须在添加新元素后重新布局网格。例如，要添加一些新项目，您可以调用：

```
def addNewSkills(self, newSkillList):
    '''newSkillList is a list of skill names you want to add'''
    for skillName in newSkillList:
        newRadioButton = wx.RadioButton(self, -1, skillName)
        self.grid1.Add(newRadioButton) # appears in top-left corner of the panel
    self.Layout() # all newly added radio buttons appear where they should be
    self.Fit() # if you need to resize the panel to fit new items, this will help 
```

`self.grid1`你保持所有单选按钮的大小在哪里。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T09:34:03.090

两种可能的解决方案

1.  每次您必须进行更改时，使用单选小部件重建 sizer
2.  按住列表中的单选按钮小部件，并在每次必须更改其标签时调用 SetLabel。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T09:47:15.387

我能够通过使用 DzinX 提供的信息修复它，并进行一些修改。

It appears that posting the radio buttons box first "locked in" the box to the sizer. If I tried to add a new box, I would get an error message stating that I was trying to add the widget to the same sizer twice.

By simply removing the radio buttons initially and having the user click a button to call a method, I could simply add a the list of radio buttons without a problem.

Additionally, by having the user click a button, I did not run into errors of "class Foo has no attribute 'bar'". Apparently, when the wizard initalizes, the attributes aren't available to the rest of the wizard pages. I had thought the wizard pages were dynamically created with each click of "Next" but they are all created at the same time.

# c# - 从 Java 调用 .NET 程序集：JVM 崩溃

> ID：138355
> 
> 赞同：11
> 
> 时间：2008-09-26T08:55:29.390
> 
> 标签：c#, java, integration

我有一个第三方 .NET 程序集和一个大型 Java 应用程序。我需要从 Java 应用程序调用 .NET 类库提供的方法。该程序集未启用 COM。我已经搜索了网络，到目前为止我有以下内容：

C# 代码（cslib.cs）：

```
using System;

namespace CSLib
{
    public class CSClass
    {
        public static void SayHi()
        {
            System.Console.WriteLine("Hi");
        }
    }
} 
```

编译（使用 .net 3.5，但使用 2.0 时也会发生同样的情况）：

```
csc /target:library cslib.cs 
```

C++ 代码（clib.cpp）：

```
#include <jni.h>
#using <CSLib.dll>

using namespace CSLib;

extern "C" _declspec(dllexport) void Java_CallCS_callCS(JNIEnv* env, jclass cls) {
    CSLib::CSClass::SayHi();
} 
```

编译时使用（使用 VC 2008 工具，但使用 2003 工具时也会发生同样的情况）：

```
cl /clr /LD clib.cpp
mt -manifest clib.dll.manifest -outputresource:clib.dll;2 
```

Java 代码（CallCS.java）：

```
class CallCS {
    static {
       System.loadLibrary("clib");
    }
    private static native void callCS();
    public static void main(String[] args) {
        callCS();
    }
} 
```

当我尝试运行 java 类时，Java VM 在调用该方法时崩溃（它能够加载库）：

```
#
# Java Runtime Environment 检测到意外错误：
#
# 内部错误 (0xe0434f4d), pid=3144, tid=3484
#
# Java VM：Java HotSpot(TM) Client VM（10.0-b19混合模式，共享windows-x86）
# 有问题的框架：
#C [kernel32.dll+0x22366]
#
...
Java 框架：（J=编译的 Java 代码，j=解释的，Vv=VM 代码）
j CallCS.callCS()V+0
j CallCS.main([Ljava/lang/String;)V+0
v ~StubRoutines::call_stub

```

但是，如果我创建一个加载 clib.dll 并调用导出函数 Java_CallCS_callCS 的普通 cpp 应用程序，则一切正常。我在 x86 和 x64 环境中都试过了，结果是一样的。我没有尝试过其他版本的 Java，但我需要代码在 1.5.0 上运行。

此外，如果我修改 clib.cpp 以仅调用 System 方法，即使从 Java 也一切正常：

```
#include <jni.h>
#using <mscorlib.dll>

using namespace System;

extern "C" _declspec(dllexport) void Java_CallCS_callCS(JNIEnv* env, jclass cls) {
    System::Console::WriteLine("It works");
} 
```

总结一下：

1.  我能够从 Java -> clib.dll -> mscorlib.dll 调用系统方法
2.  我可以从 CPPApp -> clib.dll -> cslib.dll 调用任何方法
3.  我无法从 Java -> clib.dll -> cslib.dll 调用任何方法

我知道使用上述 1\. 的解决方法 - 我可以使用反射来加载程序集并仅使用系统调用调用所需的方法，但是代码变得混乱，我希望有一个更好的解决方案。

我知道 dotnetfromjava 项目，它使用反射方法，但不希望增加比需要更多的复杂性。但是，如果没有其他方法，我会使用类似的东西。

我也看过 ikvm.net，但我的理解是它使用自己的 JVM（用 C# 编写）来发挥作用。但是，在其 VM 下运行整个 Java 应用程序对我来说是没有选择的。

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T11:05:41.357

好了，谜团解开了。

JVM 崩溃是由未处理的 System.IO.FileNotFoundException 引起的。抛出异常是因为在调用 exe 文件所在的文件夹中搜索了 .NET 程序集。

1.  mscorlib.dll 位于全局程序集缓存中，因此可以正常工作。
2.  CPP 应用程序 exe 与程序集位于同一文件夹中，因此它也可以工作。
3.  cslib.dll 程序集不在 java.exe 文件夹中，在 GAC 中也不在，所以它不起作用。

看来我唯一的选择是在 GAC 中安装 .NET 程序集（第三方 dll 确实有一个强名称）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-31T18:06:50.347

看看[jni4net](https://github.com/jni4net/jni4net)，它会为你做艰苦的工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T08:57:28.030

您是否看过 ikvm.NET，它允许在 .NET 和 Java 代码之间进行调用？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-09T19:27:18.073

我很高兴找到这篇文章，因为我遇到了这个问题。我想贡献一些代码，这有助于克服这个问题。在您的 Java 构造函数中调用 init 方法，该方法会添加 resolve 事件。根据我的经验，有必要在调用 C++ 代码中的库之前调用 init，因为由于时间问题，它可能仍然会崩溃。我已将 init 调用放入映射 JNI 调用的 java 类构造函数中，效果很好。

```
 //C# code
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;
using System.Security.Permissions;
using System.Runtime.InteropServices;

namespace JNIBridge
{
    public class Temperature
    {

        [SecurityPermission(SecurityAction.Assert, Flags = SecurityPermissionFlag.UnmanagedCode | SecurityPermissionFlag.Assertion | SecurityPermissionFlag.Execution)]
        [ReflectionPermission(SecurityAction.Assert, Unrestricted = true)]
        [FileIOPermission(SecurityAction.Assert, Unrestricted = true)]

        public static double toFahrenheit(double value)
        {
            return (value * 9) / 5 + 32;
        }

        [SecurityPermission(SecurityAction.Assert, Flags = SecurityPermissionFlag.UnmanagedCode | SecurityPermissionFlag.Assertion | SecurityPermissionFlag.Execution)]
        [ReflectionPermission(SecurityAction.Assert, Unrestricted = true)]
        [FileIOPermission(SecurityAction.Assert, Unrestricted = true)]

        public static double toCelsius(double value)
        {
            return (value - 32) * 5 / 9; 
        }

    }
} 
```

C++ 代码

```
 // C++ Code

#include "stdafx.h"

#include "JNIMapper.h"
#include "DotNet.h"
#include "stdio.h"
#include "stdlib.h"

#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     DotNet
 * Method:    toFahrenheit
 * Signature: (D)D
 */

static bool initialized = false;
using namespace System;
using namespace System::Reflection;

/*** 
 This is procedure is always needed when the .NET dll's arent in the actual directory of the calling exe!!!
 It loads the needed assembly from a predefined path, if found in the directory and returns the assembly.
*/

Assembly ^OnAssemblyResolve(Object ^obj, ResolveEventArgs ^args)
{
    //System::Console::WriteLine("In OnAssemblyResolve");
#ifdef _DEBUG
            /// Change to your .NET DLL paths here
    String ^path = gcnew String("d:\\WORK\\JNIBridge\\x64\\Debug");
#else
    String ^path = gcnew String(_T("d:\\WORK\\JNIBridge\\x64\\Release"));
#endif
    array<String^>^ assemblies =
        System::IO::Directory::GetFiles(path, "*.dll");
    for (long ii = 0; ii < assemblies->Length; ii++) {
        AssemblyName ^name = AssemblyName::GetAssemblyName(assemblies[ii]);
        if (AssemblyName::ReferenceMatchesDefinition(gcnew AssemblyName(args->Name), name)) {
        //  System::Console::WriteLine("Try to resolve "+ name);
            Assembly ^a = Assembly::Load(name);
            //System::Console::WriteLine("Resolved "+ name);
            return a;
        }
    }
    return nullptr;
}

/**
 This procedure adds the Assembly resolve event handler
*/
void AddResolveEvent()
{
    AppDomain::CurrentDomain->AssemblyResolve +=
        gcnew ResolveEventHandler(OnAssemblyResolve);
}
/*
 * Class:     DotNet
 * Method:    init
 * Signature: ()Z
 */
JNIEXPORT jboolean JNICALL Java_DotNet_init
  (JNIEnv *, jobject)

{
    printf("In init\n");    
    AddResolveEvent();  
    printf("init - done.\n");   
    return true;

}

/*
 * Class:     DotNet
 * Method:    toFahrenheit
 * Signature: (D)D
 */

JNIEXPORT jdouble JNICALL Java_DotNet_toFahrenheit
  (JNIEnv * je, jobject jo, jdouble value)
{
    printf("In Java_DotNet_toFahrenheit\n");  

      double result = 47;

      try{        
          result = JNIBridge::Temperature::toFahrenheit(value);
      } catch (...){
          printf("Error caught");
      }
      return result;
}

/*
 * Class:     DotNet
 * Method:    toCelsius
 * Signature: (D)D
 */
JNIEXPORT jdouble JNICALL Java_DotNet_toCelsius
  (JNIEnv * je, jobject jo , jdouble value){

      printf("In Java_DotNet_toCelsius\n");

      double result = 11;

      try{

          result = JNIBridge::Temperature::toCelsius(value);
      } catch (...){
          printf("Error caught");
      }

      return result;
}

#ifdef __cplusplus

} 
```

Java 代码

```
 /***
    ** Java class file
    **/
public class DotNet {    
    public native double toFahrenheit (double d);
    public native double toCelsius (double d);
    public native boolean init();

    static {
        try{            
            System.loadLibrary("JNIMapper");
        } catch(Exception ex){
            ex.printStackTrace();
        }
    }        

    public DotNet(){
        init();
    }

    public double fahrenheit (double v) {
        return toFahrenheit(v);
    }

    public double celsius (double v) {
        return toCelsius(v);
    }

} 
```

# c# - C++ 比 C# 快多少？

> ID：138361
> 
> 赞同：290
> 
> 时间：2008-09-26T08:57:46.937
> 
> 标签：c#, c++, performance, benchmarking

还是现在反过来了？

据我所知，在某些领域 C# 被证明比 C++ 更快，但我从来没有勇气自己测试它。

认为你们中的任何人都可以详细解释这些差异，或者将我指向正确的位置以获取有关此信息的信息。

* * *

## 回答 #1

> 赞同：391
> 
> 时间：2008-09-26T09:10:17.873

没有严格的理由为什么像 C# 或 Java 这样具有 JIT 的基于字节码的语言不能像 C++ 代码一样快。然而，C++ 代码在很长一段时间内都明显更快，今天在许多情况下仍然如此。这主要是因为更高级的 JIT 优化实现起来很复杂，而真正酷的优化才刚刚出现。

因此，在许多情况下，C++ 更快。但这只是答案的一部分。C++ 实际上更快的情况是高度优化的程序，专业程序员彻底优化了代码。这不仅非常耗时（因此也很昂贵），而且由于过度优化通常会导致错误。

另一方面，解释语言中的代码在运行时的更高版本（.NET CLR 或 Java VM）中变得更快，而无需您做任何事情。JIT 编译器可以进行许多有用的优化，而这些优化在具有指针的语言中是根本不可能的。此外，有些人认为垃圾收集通常应该与手动内存管理一样快或更快，而且在许多情况下确实如此。您通常可以在 C++ 或 C 中实现和实现所有这些，但它会更加复杂且容易出错。

正如 Donald Knuth 所说，“过早的优化是万恶之源”。如果您真的确定您的应用程序将主要包含对性能至关重要的算术，并且它将成为瓶颈，并且在 C++ 中它肯定会更快，并且您确定 C++ 不会与您的其他要求，去C++。在任何其他情况下，首先集中精力以最适合您的语言正确实现您的应用程序，然后在运行速度太慢时找到性能瓶颈，然后考虑如何优化代码。在最坏的情况下，您可能需要通过外部函数接口调用 C 代码，因此您仍然有能力用低级语言编写关键部分。

**请记住，优化一个正确的程序相对容易，但要纠正一个优化的程序要困难得多。**

给出速度优势的实际百分比是不可能的，这在很大程度上取决于您的代码。在许多情况下，编程语言的实现甚至不是瓶颈。[在http://benchmarksgame.alioth.debian.org/](http://benchmarksgame.alioth.debian.org/)上进行基准测试时，要抱有很大的怀疑态度，因为这些主要测试算术代码，这很可能与您的代码根本不相似。

* * *

## 回答 #2

> 赞同：237
> 
> 时间：2008-09-26T09:22:38.657

C# 可能不会更快，但它让 YOU/ME 更快。这是我所做的最重要的衡量标准。:)

* * *

## 回答 #3

> 赞同：126
> 
> 时间：2016-09-08T09:39:44.757

我将首先不同意对这个问题的部分接受（和好评）的回答，并说明：

**实际上，JITted 代码比经过适当优化的 C++（或其他没有运行时开销的语言）程序运行得慢的原因有很多，**包括：

*   根据定义，在运行时 JITting 代码上花费的计算周期不可用于程序执行。

*   JITter 中的任何热路径都将与您的代码竞争 CPU 中的指令和数据缓存。我们知道缓存在性能方面占主导地位，而像 C++ 这样的原生语言在设计上没有这种类型的争用。

*   运行时优化器的时间预算必然*比*编译时优化器的更受限制（正如另一位评论者指出的那样）

**底线：最终，您*几乎*肯定能够在 C++ 中创建比在 C# 中更快的实现**。

现在，话虽如此，实际上*有多快*是无法量化的，因为变量太多：任务、问题域、硬件、实现质量以及许多其他因素。您将在您的场景中运行测试以确定性能差异，然后决定是否值得付出额外的努力和复杂性。

这是一个非常长且复杂的话题，但为了完整起见，我觉得值得一提的是，C# 的运行时优化器非常出色，并且能够在运行时执行某些动态优化，而这些动态优化对于 C++ 的编译时根本不可用（静态）优化器。即便如此，优势仍然通常在本机应用程序的法庭上很深，但动态优化器是上面给出的“***几乎***可以肯定”限定词的原因。

--

在相对表现方面，我也对我在其他一些答案中看到的数字和讨论感到不安，所以我想我会插话，同时为我上面的陈述提供一些支持。

这些基准测试的很大一部分问题是您不能像编写 C# 一样编写 C++ 代码并期望获得具有代表性的结果（例如，在 C++ 中执行数千次内存分配会给您带来可怕的数字。）

相反，我编写了稍微惯用的 C++ 代码，并与 @Wiory 提供的 C# 代码进行了比较。我对 C++ 代码所做的两个主要更改是：

1.  使用向量::reserve()

2.  将 2d 数组展平为 1d 以实现更好的缓存局部性（连续块）

**C# (.NET 4.6.1)**

```
private static void TestArray()
{
    const int rows = 5000;
    const int columns = 9000;
    DateTime t1 = System.DateTime.Now;
    double[][] arr = new double[rows][];
    for (int i = 0; i < rows; i++)
        arr[i] = new double[columns];
    DateTime t2 = System.DateTime.Now;

    Console.WriteLine(t2 - t1);

    t1 = System.DateTime.Now;
    for (int i = 0; i < rows; i++)
        for (int j = 0; j < columns; j++)
            arr[i][j] = i;
    t2 = System.DateTime.Now;

    Console.WriteLine(t2 - t1);
} 
```

**运行时间（发布）：初始化：124 毫秒，填充：165 毫秒**

**C++14 (Clang v3.8/C2)**

```
#include <iostream>
#include <vector>

auto TestSuite::ColMajorArray()
{
    constexpr size_t ROWS = 5000;
    constexpr size_t COLS = 9000;

    auto initStart = std::chrono::steady_clock::now();

    auto arr = std::vector<double>();
    arr.reserve(ROWS * COLS);

    auto initFinish = std::chrono::steady_clock::now();
    auto initTime = std::chrono::duration_cast<std::chrono::microseconds>(initFinish - initStart);

    auto fillStart = std::chrono::steady_clock::now();

    for(auto i = 0, r = 0; r < ROWS; ++r)
    {
        for (auto c = 0; c < COLS; ++c)
        {
            arr[i++] = static_cast<double>(r * c);
        }
    }

    auto fillFinish = std::chrono::steady_clock::now();
    auto fillTime = std::chrono::duration_cast<std::chrono::milliseconds>(fillFinish - fillStart);

    return std::make_pair(initTime, fillTime);
} 
```

**运行时间（发布）：初始化：398µs（是的，那是微秒），填充：152ms**

## **总运行时间：C#：289 毫秒，C++ 152 毫秒（大约快 90%）**

**观察**

*   将 C# 实现更改为相同的一维数组实现会产生 Init：40ms，Fill：171ms，Total：211ms（**C++ 仍然快 40%**）。

*   用 C++ 设计和编写“快速”代码比用任何一种语言编写“常规”代码要困难得多。

*   在 C++ 中表现不佳（也许）非常容易；我们看到了无保留向量的性能。而且有很多这样的陷阱。

*   考虑到运行时发生的所有事情，C# 的性能相当惊人。而且这种性能相对容易获得。

*   比较 C++ 和 C# 性能的更多轶事数据：[https ://benchmarksgame.alioth.debian.org/u64q/compare.php?lang=gpp&lang2=csharpcore](https://benchmarksgame.alioth.debian.org/u64q/compare.php?lang=gpp&lang2=csharpcore)

最重要的是，C++ 让您可以更好地控制性能。你想使用指针吗？参考？堆栈内存？堆？动态多态性还是消除具有静态多态性的 vtable 的运行时开销（通过模板/CRTP）？在 C++ 中，您必须……呃，*自己*做出所有这些选择（甚至更多），理想情况下，这样您的解决方案才能最好地解决您正在解决的问题。

问问自己，您是否真的想要或需要这种控制，因为即使对于上面的微不足道的示例，您也可以看到虽然性能有了显着提高，但需要更深入的投资才能访问。

* * *

## 回答 #4

> 赞同：91
> 
> 时间：2008-09-26T09:05:32.817

快了五个橙子。或者更确切地说：不可能有（正确的）一揽子答案。C++ 是一种静态编译语言（但也有配置文件引导优化），C# 在 JIT 编译器的帮助下运行。存在如此多的差异，以至于无法回答诸如“快多少”之类的问题，即使给出数量级也无法回答。

* * *

## 回答 #5

> 赞同：64
> 
> 时间：2008-09-26T14:02:27.990

根据我的经验（我在这两种语言上做了很多工作），与 C++ 相比，C# 的主要问题是内存消耗高，我还没有找到控制它的好方法。最终会降低 .NET 软件速度的是内存消耗。

另一个因素是 JIT 编译器不能花太多时间进行高级优化，因为它在运行时运行，如果花费太多时间最终用户会注意到它。另一方面，C++ 编译器有所有时间在编译时进行优化。这个因素远没有内存消耗那么重要，恕我直言。

* * *

## 回答 #6

> 赞同：36
> 
> 时间：2008-09-26T09:26:57.037

当多态决策可以在编译时预先确定时，C++ 仍然占上风（并且将在未来几年内）的一种特殊情况发生。

一般来说，封装和延迟决策是一件好事，因为它使代码更加动态，更容易适应不断变化的需求，更容易作为框架使用。这就是为什么 C# 中的面向对象编程非常高效，并且可以在术语“泛化”下进行泛化。不幸的是，这种特殊的泛化在运行时是有代价的。

通常，这个成本是非实质性的，但在某些应用程序中，虚拟方法调用和对象创建的开销可能会产生影响（特别是因为虚拟方法会阻止其他优化，例如方法调用内联）。这就是 C++ 具有巨大优势的地方，因为您可以使用模板来实现不同类型的泛化，这对运行时*没有*影响，但不一定比 OOP 多态。事实上，构成 OOP 的所有机制都可以仅使用模板技术和编译时解析来建模。

在这种情况下（诚然，它们通常仅限于特殊问题领域），C++ 胜过 C# 和类似语言。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2008-09-26T09:55:49.090

C++（或 C）让您对数据结构进行细粒度控制。如果你想旋转，你有这个选项。使用 Java/.NET 库的内部数据结构的大型托管 Java 或 .NET 应用程序（OWB、[Visual Studio 2005](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2005)）随身携带。我已经看到 OWB 设计器会话使用超过 400 MB 的 RAM 和用于立方体或[ETL](https://en.wikipedia.org/wiki/Extract,_transform,_load)设计的 BIDS 也达到了 100 MB。

在可预测的工作负载上（例如大多数重复过程多次的基准测试），JIT 可以为您提供优化得足够好的代码，从而没有实际差异。

IMO 在大型应用程序上的区别与其说是 JIT，不如说是代码本身使用的数据结构。在应用程序占用大量内存的情况下，您的缓存使用效率会降低。现代 CPU 上的缓存未命中非常昂贵。C 或 C++ 真正胜出的地方是您可以优化数据结构的使用以与 CPU 缓存很好地配合使用。

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2008-09-26T20:13:41.997

对于图形，标准 C# Graphics 类比通过 C/C++ 访问的 GDI 慢得多。我知道这与语言本身无关，更多的是与整个 .NET 平台有关，但图形是作为 GDI 替代品提供给开发人员的，它的性能太差了，我什至不敢做图形用它。

我们有一个简单的基准来查看图形库的速度，它只是在窗口中绘制随机线。C++/GDI 在 10000 行时仍然很敏捷，而 C#/Graphics 很难实时做到 1000 行。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2008-12-08T13:46:02.643

垃圾收集是 Java# 不能用于实时系统的主要原因。

1.  GC什么时候发生？

2.  需要花多长时间？

这是不确定的。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2008-12-29T22:26:57.693

我们必须确定 C# 在性能上是否与 C++ 相当，我为此编写了一些测试程序（两种语言都使用 Visual Studio 2005）。事实证明，没有垃圾收集，只考虑语言（而不是框架）C# 与 C++ 具有基本相同的性能。C# 中的内存分配比 C++ 中的快得多，并且当数据大小增加到超出缓存线边界时，C# 在确定性方面略有优势。然而，所有这些最终都必须付出代价，并且由于垃圾收集，C# 的非确定性性能损失会带来巨大的成本。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2015-12-29T00:47:29.850

C/C++ 在有大型数组或对数组（任何大小）进行大量循环/迭代的程序中可以表现得更好。这就是图形在 C/C++ 中通常要快得多的原因，因为繁重的数组操作几乎是所有图形操作的基础。由于所有安全检查，.NET 在数组索引操作方面的速度是出了名的慢，对于多维数组尤其如此（是的，矩形 C# 数组甚至比锯齿状 C# 数组还要慢）。

如果您直接使用指针并避免使用 Boost`std::vector`和其他高级容器以及`inline`所有可能的小函数，则 C/C++ 的好处最为明显。尽可能使用老式数组。是的，您将需要更多的代码行来完成您在 Java 或 C# 中所做的相同事情，因为您避免使用高级容器。如果您需要一个动态大小的数组，您只需要记住将您的`new T[]`与相应的`delete[]`语句配对（或使用`std::unique_ptr`)——额外速度的代价是你必须更仔细地编码。但作为交换，您可以摆脱托管内存/垃圾收集器的开销，这很容易占 Java 和 .NET 中大量面向对象的程序以及那些大规模托管的执行时间的 20% 或更多内存数组索引成本。在某些特定情况下，C++ 应用程序也可以从一些漂亮的编译器开关中受益。

我是 C、C++、Java 和 C# 方面的专家级程序员。我最近难得有机会用后 3 种语言实现完全相同的算法程序。该程序有很多数学和多维数组操作。我在所有 3 种语言中都对它进行了大量优化。**结果是我通常在不太严格的比较中看到的典型结果：Java 比 C# 快约 1.3 倍（大多数 JVM 比 CLR 更优化），C++ 原始指针版本比 C# 快约 2.1 倍。**请注意，C# 程序只使用了安全代码——我认为您最好在使用`unsafe`关键字之前用 C++ 对其进行编码。

以免有人认为我反对 C#，最后我会说 C# 可能是我最喜欢的语言。它是迄今为止我遇到的最合乎逻辑、最直观和最快速的开发语言。我在 C# 中完成所有原型设计。与 Java 相比，C# 语言有许多细微的优势（是的，我知道微软有机会通过较晚进入游戏并复制 Java 来解决 Java 的许多缺点）。有人为 Java 的`Calendar`班级干杯吗？如果 Microsoft 真正花精力优化 CLR 和 .NET JITter，C# 可能会严重接管。老实说，我很惊讶他们还没有——他们用 C# 语言做了很多正确的事情，为什么不跟进重击的编译器优化呢？也许如果我们都乞求。

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2008-09-26T14:06:25.670

我知道这不是您要问的，但 C# 通常比 C++ 更快*，*这在商业环境中是一个很大的好处。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2008-09-26T09:16:49.247

像往常一样，这取决于应用程序。在某些情况下，C# 的速度可能可以忽略不计，而在其他情况下，C++ 的速度会快 5 倍或 10 倍，尤其是在操作很容易进行 SIMD 处理的情况下。

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2008-09-26T19:28:23.057

*> 据我所知...*

您的困难似乎在于确定您所听到的内容是否可信，而当您尝试评估本网站上的回复时，这种困难只会再次出现。

您将如何确定人们在这里所说的话是否比您最初听到的更可信？

一种方法是要求提供**证据**。

当有人声称“在某些领域 C# 被证明比 C++ 更快”时，**问他们*为什么*这么说**，让他们给你看测量结果，让他们给你看程序。有时他们只是犯了一个错误。有时你会发现他们只是在表达一种观点，而不是分享他们可以证明是真实的东西。

通常，信息和意见会与人们声称的内容混在一起，您必须尝试找出哪个是哪个。例如，来自这个论坛的回复：

*   *“以极大的怀疑态度来获取[http://shootout.alioth.debian.org/](http://shootout.alioth.debian.org/)上的基准，因为这些主要测试算术代码，这很可能与您的代码根本不相似。”*

    问问自己，你是否真的理解*“这些经过大量测试的算术代码”*是什么意思，然后问问自己作者是否真的向你证明了他的说法是正确的。

*   *“这是一个相当无用的测试，因为它实际上取决于各个程序的优化程度；我已经设法将其中一些程序加速了 4-6 倍或更多，这表明未优化程序之间的比较相当愚蠢的。”*

    问问你自己，作者是否真的向你展示了他已经设法“将其中一些加速了 4-6 倍或更多”——这是一个很容易提出的主张！

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2009-04-30T11:39:28.427

对于“令人尴尬的并行”问题，在 C++ 上使用英特尔 TBB 和 OpenMP 时，我观察到与使用 C# 和 TPL 完成的类似（纯数学）问题相比，性能提高了大约 10 倍。SIMD 是 C# 无法竞争的一个领域，但我也觉得 TPL 有相当大的开销。

也就是说，我只将 C++ 用于我知道我将能够多线程并快速获得结果的性能关键任务。对于其他所有内容，C#（有时是 F#）就可以了。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2008-09-26T10:02:13.897

这是一个非常模糊的问题，没有真正的明确答案。

例如; 我宁愿玩用 C++ 创建的 3D 游戏，也不愿玩 C#，因为性能肯定要好得多。（而且我知道 XNA 等，但它与真实的东西相去甚远）。

另一方面，如前所述；您应该使用一种可以让您快速完成您想做的事情的语言进行开发，然后在必要时进行优化。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-09-27T16:38:38.433

理论上，对于长时间运行的服务器类型的应用程序，JIT 编译的语言可以比本地编译的语言快得多*。*由于 JIT 编译语言通常首先编译为相当低级的中间语言，因此无论如何您都可以在编译时进行很多高级优化。最大的优势在于 JIT 可以继续动态地重新编译代码部分，因为它可以获得越来越多的关于应用程序如何使用的数据。它可以安排最常见的代码路径，以使分支预测尽可能多地成功。它可以重新排列经常一起调用的单独代码块，以将它们都保存在缓存中。它可以花更多的精力优化内部循环。

我怀疑这是由 .NET 或任何 JRE 完成的，但在我上大学时正在研究它，所以认为这些事情可能很快就会进入现实世界并不是没有道理的.

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2008-12-11T13:54:37.600

需要大量内存访问的应用程序，例如。图像处理通常最好在非托管环境 (C++) 中编写而不是在托管 (C#) 中编写。使用指针算法优化的内部循环在 C++ 中更容易控制。在 C# 中，您可能需要使用不安全的代码才能获得接近相同的性能。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2010-04-01T07:06:03.013

.NET 语言可以与 C++ 代码一样快，甚至更快，**但 C++ 代码将具有更恒定的吞吐量**，因为 .NET 运行时必须为[GC](http://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29)暂停，即使它的暂停非常聪明。

因此，如果您有一些代码必须始终快速运行而没有任何停顿，即使您对运行时 GC 非常小心，.NET 也会**在某些时候引入延迟。**

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2011-05-10T15:36:55.653

我已经`vector`在 C++ 和 C# 等价物`List`以及简单的二维数组中进行了测试。

我正在使用 Visual C#/C++ 2010 Express 版本。这两个项目都是简单的控制台应用程序，我已经在标准（无自定义设置）发布和调试模式下对它们进行了测试。C# 列表在我的电脑上运行得更快，数组初始化在 C# 中也更快，数学运算更慢。

我正在使用 Intel Core2Duo P8600@2.4GHz，C# - .NET 4.0。

我知道向量实现与 C# 列表不同，但我只是想测试用于存储对象的集合（并且能够使用索引访问器）。

当然，您需要清除内存（假设每次使用`new`），但我想保持代码简单。

**C++ 向量测试**：

```
static void TestVector()
{
    clock_t start,finish;
    start=clock();
    vector<vector<double>> myList=vector<vector<double>>();
    int i=0;
    for( i=0; i<500; i++)
    {
        myList.push_back(vector<double>());
        for(int j=0;j<50000;j++)
            myList[i].push_back(j+i);
    }
    finish=clock();
    cout<<(finish-start)<<endl;
    cout<<(double(finish - start)/CLOCKS_PER_SEC);
} 
```

**C#列表测试：**

```
private static void TestVector()
{

    DateTime t1 = System.DateTime.Now;
    List<List<double>> myList = new List<List<double>>();
    int i = 0;
    for (i = 0; i < 500; i++)
    {
        myList.Add(new List<double>());
        for (int j = 0; j < 50000; j++)
            myList[i].Add(j *i);
    }
    DateTime t2 = System.DateTime.Now;
    Console.WriteLine(t2 - t1);
} 
```

**C++ - 数组：**

```
static void TestArray()
{
    cout << "Normal array test:" << endl;
    const int rows = 5000;
    const int columns = 9000;
    clock_t start, finish;

    start = clock();
    double** arr = new double*[rows];
    for (int i = 0; i < rows; i++)
        arr[i] = new double[columns];
    finish = clock();

    cout << (finish - start) << endl;

    start = clock();
    for (int i = 0; i < rows; i++)
        for (int j = 0; j < columns; j++)
            arr[i][j] = i * j;
    finish = clock();

    cout << (finish - start) << endl;
} 
```

**C# - 数组：**

```
private static void TestArray()
{
    const int rows = 5000;
    const int columns = 9000;
    DateTime t1 = System.DateTime.Now;
    double[][] arr = new double[rows][];
    for (int i = 0; i < rows; i++)
        arr[i] = new double[columns];
    DateTime t2 = System.DateTime.Now;

    Console.WriteLine(t2 - t1);

    t1 = System.DateTime.Now;
    for (int i = 0; i < rows; i++)
        for (int j = 0; j < columns; j++)
            arr[i][j] = i * j;
    t2 = System.DateTime.Now;

    Console.WriteLine(t2 - t1);

} 
```

时间：（发布/调试）

**C++**

*   600 / 606 ms 数组初始化，
*   200 / 270 ms 阵列填充，
*   1 秒/13 秒矢量初始化和填充。

（是的，13 秒，我总是在调试模式下遇到列表/向量的问题。）

**C＃：**

*   20 / 20 ms 数组初始化，
*   403 / 440 ms 阵列填充，
*   710 / 742 毫秒列表初始化和填充。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2010-07-17T16:22:28.820

这要看情况。如果字节码被翻译成机器码（而不仅仅是 JIT）（我的意思是如果你执行程序）*并且*如果你的程序使用许多分配/释放它可能会更快，因为[GC](http://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29)算法只需要一次通过（理论上）通过整个内存一次，但正常的 malloc/realloc/free C/C++ 调用会导致每次调用的开销（调用开销、数据结构开销、缓存未命中；））。

所以理论上是可能的（也适用于其他 GC 语言）。

对于大多数应用程序，我并没有真正看到不能将[元编程](https://en.wikipedia.org/wiki/Metaprogramming)与 C# 一起使用的极端劣势，因为大多数程序员无论如何都不使用它。

另一个很大的优势是 SQL 与[LINQ](http://en.wikipedia.org/wiki/Language_Integrated_Query) “扩展”一样，为编译器提供了优化对数据库的调用的机会（换句话说，编译器可以将整个 LINQ 编译为一个“blob”二进制文件，其中被调用的函数被内联或为您的使用进行了优化，但我在这里推测）。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2008-09-26T17:06:31.573

我想有一些用 C# 编写的应用程序运行得很快，还有更多的 C++ 编写的应用程序运行得很快（好吧，C++ 更老了......而且也采用 UNIX......）
- 问题确实是 - 那是什么东西，用户和开发人员抱怨......
好吧，恕我直言，在 C# 的情况下，我们有非常舒适的 UI、非常好的库层次结构和 CLI 的整个界面系统。在 C++ 的情况下，我们有模板、ATL、COM、MFC 以及已经编写和运行的代码，如 OpenGL、DirectX 等......在一秒钟内 - 砰！它卡住了）。
用 C# 编写代码非常简单和快速（不要忘记这也会增加出错的机会。在 C++ 的情况下，开发人员抱怨内存泄漏， - 意味着崩溃，DLL 之间的调用，以及“DLL 地狱” - 问题与支持和用更新的库替换库...
我认为您在编程语言方面拥有的技能越多，您的软件的质量（和速度）就越高。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2016-05-07T23:15:55.150

我会这样说：编写更快代码的程序员，是更了解是什么使当前机器运行得更快的程序员，顺便说一句，他们也是使用适当工具的人，该工具允许精确的低级和确定性优化技术。由于这些原因，这些人是使用 C/C++ 而不是 C# 的人。我会尽可能地说明这是一个事实。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2016-07-12T17:01:23.810

如果我没记错的话，C# 模板是在运行时确定的。这必须比 C++ 的编译时模板慢。

当您考虑到许多其他人提到的所有其他编译时优化，以及缺乏安全性时，确实意味着更高的速度......

我想说 C++ 在原始速度和最小内存消耗方面是显而易见的选择。但这也意味着有更多时间开发代码并确保您不会泄漏内存或导致任何空指针异常。

判决：

*   C#：更快的开发，更慢的运行

*   C++：开发慢，运行快。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2019-06-20T19:00:23.637

C# 和 C++ 在性能方面存在一些主要差异：

*   C# 是基于 GC / 堆的。由于内存访问的非局部性，分配和 GC 本身是开销
*   多年来，C++ 优化器已经变得非常好。JIT 编译器无法达到相同的水平，因为它们只有有限的编译时间并且看不到全局范围

除此之外，程序员的能力也很重要。我见过糟糕的 C++ 代码，其中类在各处都按值作为参数传递。如果您不知道自己在做什么，实际上可以使 C++ 中的性能更差。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2020-09-01T16:32:49.033

我发现这个 2020 年 4 月的内容是：[https](https://www.quora.com/Why-is-C-so-slow-compared-to-Python) ://www.quora.com/Why-is-C-so-slow-compared-to-Python ，作者是一位拥有 15 年以上软件开发经验的真实程序员。

它指出 C# 通常较慢，因为它被编译为**通用中间语言 (CIL)**而不是 C++ 之类的机器代码。CIL 然后通过输出机器代码的**公共语言运行时 (CLR) 。**但是，如果您继续执行 C#，它将获取机器代码的输出并将**其缓存，以便保存机器代码**以供下次执行。总而言之，如果您执行多次， **C# 会更快，因为它在多次执行后处于机器代码中。**

也有评论说，一个好的 C++ 程序员可以做一些耗时的优化，最终会得到优化。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-09-27T15:59:21.977

*> 毕竟，答案必须在某个地方，不是吗？:)*

嗯，没有。

正如一些答复所指出的，**该问题的具体说明不足**，以引起回应而不是回答的方式提出问题。采取一种方式：

*   这个问题将语言与语言实现混为一谈——这个 C 程序比[这个 C# 程序](http://shootout.alioth.debian.org/gp4/benchmark.php?test=fasta&lang=csharp)[慢 2194 倍](http://shootout.alioth.debian.org/gp4/benchmark.php?test=fasta&lang=cint&id=1)，[快 1.17 倍](http://shootout.alioth.debian.org/gp4/benchmark.php?test=fasta&lang=icc&id=1)——我们不得不问你：*哪种语言实现？*

 *然后是哪些程序？哪台机器？哪个操作系统？哪个数据集？

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2018-04-07T06:37:13.567

这实际上取决于您要在代码中完成什么。我听说 VB.NET、C# 和托管 C++ 之间存在任何性能差异只是都市传说。但是，我发现，至少在字符串比较中，托管 C++ 胜过 C#，而 C# 又胜过 VB.NET。

我从来没有对语言之间的算法复杂性进行过详尽的比较。我也只是使用每种语言的默认设置。在 VB.NET 中，我使用设置来要求声明变量等。这是我用于托管 C++ 的代码：（如您所见，此代码非常简单）。我在带有 .NET 4.6.2 的 Visual Studio 2013 中以其他语言运行相同的程序。

```
#include "stdafx.h"

using namespace System;
using namespace System::Diagnostics;

bool EqualMe(String^ first, String^ second)
{
    return first->Equals(second);
}
int main(array<String ^> ^args)
{
    Stopwatch^ sw = gcnew Stopwatch();
    sw->Start();
    for (int i = 0; i < 100000; i++)
    {
        EqualMe(L"one", L"two");
    }
    sw->Stop();
    Console::WriteLine(sw->ElapsedTicks);
    return 0;
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-03-21T03:22:02.057

我在 C++ 与 C# 中检测代码的一个领域是创建与 SQL Server 的数据库连接并返回结果集。我比较了 C++（ODBC 上的薄层）与 C#（ADO.NET SqlClient），发现 C++ 比 C# 代码快 50%。ADO.NET 应该是用于处理数据库的低级接口。您看到的可能更大的差异在于内存消耗而不是原始速度。

使 C++ 代码更快的另一件事是，您可以在粒度级别调整编译器选项，以 C# 中无法做到的方式优化事物。

* * *

## 回答 #30

> 赞同：-13
> 
> 时间：2010-03-31T13:46:07.947

受此启发，我对大多数程序所需的 60% 的常用指令进行了快速测试。

这是 C# 代码：

```
for (int i=0; i<1000; i++)
{
    StreamReader str = new StreamReader("file.csv");
    StreamWriter stw = new StreamWriter("examp.csv");
    string strL = "";
    while((strL = str.ReadLine()) != null)
    {
        ArrayList al = new ArrayList();
        string[] strline = strL.Split(',');
        al.AddRange(strline);
        foreach(string str1 in strline)
        {
            stw.Write(str1 + ",");
        }
        stw.Write("\n");
    }
    str.Close();
    stw.Close();
} 
```

字符串数组和数组列表是专门用来包含这些指令的。

这是C++代码：

```
for (int i = 0; i<1000; i++)
{
    std::fstream file("file.csv", ios::in);
    if (!file.is_open())
    {
        std::cout << "File not found!\n";
        return 1;
    }

    ofstream myfile;
    myfile.open ("example.txt");
    std::string csvLine;

    while (std::getline(file, csvLine))
    {
        std::istringstream csvStream(csvLine);
        std::vector csvColumn;
        std::string csvElement;

        while( std::getline(csvStream, csvElement, ‘,’) )
        {
            csvColumn.push_back(csvElement);
        }

        for (std::vector::iterator j = csvColumn.begin(); j != csvColumn.end(); ++j)
        {
            myfile << *j << ", ";
        }

        csvColumn.clear();
        csvElement.clear();
        csvLine.clear();
        myfile << "\n";
    }
    myfile.close();
    file.close();
} 
```

我使用的输入文件大小为 40 KB。

这是结果 -

*   C++ 代码在 9 秒内运行。
*   C# 代码：4 秒！！！

哦，但这是在 Linux 上……在[Mono](http://en.wikipedia.org/wiki/Mono_%28software%29)上运行 C# ……而在 G++ 上运行 C++。

好的，这就是我在 Windows 上得到的[——Visual Studio 2003](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_.NET_2003)：

*   C# 代码在 9 秒内运行。
*   C++ 代码——可怕的 370 秒！！！

# class-design - 类结构模式问题。我应该选择什么？

> ID：138371
> 
> 赞同：6
> 
> 时间：2008-09-26T09:00:45.603
> 
> 标签：class-design

什么是（如果有的话）隐含的假设或限制以及设计的差异，例如：

在他的：

```
class SampleClass1
{
    IWorker workerA;
    IWorker workerB;

    void setWorkerA(IWorker w);
    void setWorkerB(IWorker w);
    WorkResult doWork();
} 
```

B）与此相比：

```
class SampleClass2
{
    WorkResult doWork(IWorker workerA, IWorker workerB);
} 
```

我知道这取决于具体的项目，但是如果上面的类是一个小框架的一部分呢？第一类能够更自然地维护状态并分离步骤，但第二类确保与外部调用者更自然的“实时通信”，因为每次调用 doWork() 时都会传递 Worker。

是否有任何推荐的用法或通用做法来指导上述两种方式之间的选择？谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T09:10:57.980

**样本类 1**

*   我可能需要在 doWork 之间保持工人的状态
*   我可能需要单独设置工人的能力。（使用 1 和 2，然后使用 2 和 3）
*   我想维护工人，因为它可能会在同一个工人上运行 doWork 多次。
*   我不是实用类。我的一个例子很重要。

**样本类 2**

*   给我两个工人，我会和他们一起工作。
*   我不在乎他们是谁，我也不想维护他们。
*   维持工人之间的任何配对都是别人的工作。
*   我可能更像是一个实用类。也许我可以只是静止的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T09:26:48.753

在选项 (A) 中，您正在创建所谓的 Function Object 或 Functor，这是一种有[据可查](http://en.wikipedia.org/wiki/Function_object)的设计模式。

两个主要优点是：

*   工人可以在一个地方设置，然后在其他地方使用对象
*   对象可以在调用之间保持状态

此外，如果您使用依赖注入框架（Spring、Guice 等），则可以在任何需要的地方自动初始化和注入仿函数。

函数对象广泛用于库中，例如 C++ 标准模板库

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T10:01:12.930

另一种选择是案例 A 的变体，如下所示：

```
类 SampleClass3
{
    SampleClass3(IWorker workerA, IWorker workerB);
    工作结果 doWork();
}

```

好处：

*   使对象有缺陷更难，因为您需要提供施工时所需的所有工人（与案例 A 相比）。

*   您仍然可以在 SampleClass3 和/或其中一名工作人员中携带状态。（在情况 B 中这是不可能的。）

缺点：

*   在构建 SampleClass3 之前，您必须准备好所有工作人员，而不是稍后再提供。当然，您也可以提供设置器，以便以后更改它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T09:05:58.430

如果不止一种方法依赖于 IWorker a 和 IWorker b，我说做样本 A。

如果只有 doWork() 同时使用了 IWorker a 和 IWorker b，则执行示例 B。

另外，您的 SampleClass 的真正目的是什么？doWork 看起来有点像实用方法 mroe。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T09:08:22.497

A) 是一个糟糕的设计，因为它允许对象有缺陷（可能没有设置一个或两个工作类）。

B) 可以很好。如果您不依赖 SampleClass2 的内部状态，请将其设为静态

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T09:03:22.913

另外一个选项：

IWorker 类：

静态 WorkResult doWork(Iworker a, Iworker b);

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T09:08:37.690

IMO 第二种方法看起来更好，它要求调用者使用更少的代码来执行任务。第二种方法不太容易出错，调用者不必担心对象可能没有完全初始化。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T09:08:47.863

不如定义一个简单地返回 a并让各个类决定它们如何实现它的`WorkDelegate`（或者具有一个没有参数的单个方法的接口）呢？这样，您就不会局限于过早的决定。`doWork``WorkResult`

# php - 如何提前关闭连接？

> ID：138374
> 
> 赞同：106
> 
> 时间：2008-09-26T09:02:00.780
> 
> 标签：php, jquery, ajax

我正在尝试进行 AJAX 调用（通过 JQuery），这将启动一个相当长的过程。我希望脚本简单地发送一个响应，表明进程已经开始，但是在 PHP 脚本运行完成之前，JQuery 不会返回响应。

我已经尝试过使用“关闭”标题（如下）以及输出缓冲；两者似乎都不起作用。有什么猜测吗？或者这是我需要在 JQuery 中做的事情？

```
<?php

echo( "We'll email you as soon as this is done." );

header( "Connection: Close" );

// do some stuff that will take a while

mail( 'dude@thatplace.com', "okay I'm done", 'Yup, all done.' );

?> 
```

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2008-09-26T18:04:33.213

以下 PHP 手册页（包括用户注释）建议了多个关于如何在不结束 PHP 脚本的情况下关闭与浏览器的 TCP 连接的说明：

*   [连接处理^(*文档*)](http://php.net/features.connection-handling)

据说它需要的不仅仅是发送一个关闭的标头。

* * *

OP 然后确认：*是的，这成功了：* [指向](http://php.net/manual/en/features.connection-handling.php#71172)复制到此处的用户注释#71172（2006 年 11 月）：

> 自 [PHP] 4.1 以来，在保持 php 脚本运行的同时关闭用户浏览器连接一直是一个问题，`register_shutdown_function()`当时修改了 的行为，使其不会自动关闭用户连接。
> 
> sts at mail dot xubion dot hu 贴出原解决方案：
> 
> ```
> <?php
> header("Connection: close");
> ob_start();
> phpinfo();
> $size = ob_get_length();
> header("Content-Length: $size");
> ob_end_flush();
> flush();
> sleep(13);
> error_log("do something in the background");
> ?> 
> ```
> 
> 在您替换之前，哪个工作正常`phpinfo()`，`echo('text I want user to see');`在这种情况下永远不会发送标头！
> 
> 解决方案是在发送标头信息之前显式关闭输出缓冲并清除缓冲区。例子：
> 
> ```
> <?php
> ob_end_clean();
> header("Connection: close");
> ignore_user_abort(true); // just to be safe
> ob_start();
> echo('Text the user will see');
> $size = ob_get_length();
> header("Content-Length: $size");
> ob_end_flush(); // Strange behaviour, will not work
> flush(); // Unless both are called !
> // Do processing here 
> sleep(30);
> echo('Text user will never see');
> ?> 
> ```
> 
> 刚刚花了 3 个小时试图弄清楚这一点，希望它可以帮助某人:)
> 
> 测试：
> 
> *   即 7.5730.11
> *   火狐浏览器 1.81

* * *

后来在 2010 年 7 月，在一个[相关的答案中，](https://stackoverflow.com/a/3270882/367456) [*北极火*](https://stackoverflow.com/users/347655/arctic-fire)随后将另外两个用户注释链接到上述用户注释：

*   [连接处理用户注释 #89177（2009 年 2 月）](http://www.php.net/manual/en/features.connection-handling.php#89177)
*   [连接处理用户注释 #93441（2009 年 9 月）](http://www.php.net/manual/en/features.connection-handling.php#93441)

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-11-20T21:09:02.233

有必要发送这两个标头：

```
Connection: close
Content-Length: n (n = size of output in bytes ) 
```

由于您需要知道输出的大小，因此您需要缓冲输出，然后将其刷新到浏览器：

```
// buffer all upcoming output
ob_start();
echo 'We\'ll email you as soon as this is done.';

// get the size of the output
$size = ob_get_length();

// send headers to tell the browser to close the connection
header('Content-Length: '.$size);
header('Connection: close');

// flush all output
ob_end_flush();
ob_flush();
flush();

// if you're using sessions, this prevents subsequent requests
// from hanging while the background process executes
if (session_id()) {session_write_close();}

/******** background process starts here ********/ 
```

此外，如果您的 Web 服务器在输出上使用自动 gzip 压缩（即带有 mod_deflate 的 Apache），这将不起作用，因为输出的实际大小已更改，并且 Content-Length 不再准确。禁用 gzip 压缩特定脚本。

有关详细信息，请访问[http://www.zulius.com/how-to/close-browser-connection-continue-execution](http://www.zulius.com/how-to/close-browser-connection-continue-execution/)

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2012-04-11T07:27:17.963

您可以使用 Fast-CGI 和 PHP-FPM 来使用该[`fastcgi_end_request()`函数](http://php-fpm.org/wiki/Features#fastcgi_finish_request.28.29)。这样，您可以在响应已经发送到客户端的同时继续进行一些处理。

*   [如何使用 fastcgi_finish_request() 的示例（2010 年 11 月）](https://stackoverflow.com/q/4236040/367456)

您可以在此处的 PHP 手册中找到它：[FastCGI Process Manager (FPM)](http://php.net/manual/install.fpm.php)；但是该功能没有在手册中进一步记录。这里是 PHP-FPM 的摘录[：PHP FastCGI Process Manager Wiki](http://php-fpm.org/wiki/Main_Page)：

* * *

## fastcgi_finish_request()

适用范围：php函数

类别：优化

此功能允许您加快某些 php 查询的执行速度。当脚本执行过程中存在不影响服务器响应的操作时，可以进行加速。例如，将会话保存在 memcached 中可以在页面形成并传递到 Web 服务器之后发生。`fastcgi_finish_request()`是一个 php 功能，可以停止响应输出。Web 服务器立即开始“缓慢而悲伤”地向客户端传输响应，同时 php 可以在查询的上下文中做很多有用的事情，例如保存会话、转换下载的视频、处理各种统计等

`fastcgi_finish_request()`可以调用正在执行的关闭函数。

* * *

**注意：** `fastcgi_finish_request()`有[一个怪癖](https://bugs.php.net/bug.php?id=68772)，调用`flush`,`print`或`echo`会提前终止脚本。

为避免该问题，您可以在通话[`ignore_user_abort(true)`](https://www.php.net/manual/en/function.ignore-user-abort.php)之前或之后`fastcgi_finish_request`立即拨打电话：

```
ignore_user_abort(true);
fastcgi_finish_request(); 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-08-19T10:19:26.197

完整版：

```
ignore_user_abort(true);//avoid apache to kill the php running
ob_start();//start buffer output

echo "show something to user";
session_write_close();//close session file on server side to avoid blocking other requests

header("Content-Encoding: none");//send header to avoid the browser side to take content as gzip format
header("Content-Length: ".ob_get_length());//send length header
header("Connection: close");//or redirect to some url: header('Location: http://www.google.com');
ob_end_flush();flush();//really send content, can't change the order:1.ob buffer to normal buffer, 2.normal buffer to output

//continue do something on server side
ob_start();
sleep(5);//the user won't wait for the 5 seconds
echo 'for diyism';//user can't see this
file_put_contents('/tmp/process.log', ob_get_contents());
ob_end_clean(); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2016-10-14T11:20:18.427

更好的解决方案是分叉一个后台进程。在 unix/linux 上是相当直接的：

```
<?php
echo "We'll email you as soon as this is done.";
system("php somestuff.php dude@thatplace.com >/dev/null &");
?> 
```

您应该查看这个问题以获得更好的示例：

[PHP执行一个后台进程](https://stackoverflow.com/q/45953/87015)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T11:01:56.887

假设你有 Linux 服务器和 root 访问权限，试试这个。这是我找到的最简单的解决方案。

为以下文件创建一个新目录并为其授予完全权限。（我们可以稍后让它更安全。）

```
mkdir test
chmod -R 777 test
cd test 
```

把它放在一个名为`bgping`.

```
echo starting bgping
ping -c 15 www.google.com > dump.txt &
echo ending bgping 
```

注意`&`. ping 命令将在后台运行，而当前进程继续执行 echo 命令。它将 ping www.google.com 15 次，大约需要 15 秒。

使其可执行。

```
chmod 777 bgping 
```

把它放在一个名为`bgtest.php`.

```
<?php

echo "start bgtest.php\n";
exec('./bgping', $output, $result)."\n";
echo "output:".print_r($output,true)."\n";
echo "result:".print_r($result,true)."\n";
echo "end bgtest.php\n";

?> 
```

当您在浏览器中请求 bgtest.php 时，您应该很快得到以下响应，而无需等待 15 秒左右 ping 命令完成。

```
start bgtest.php
output:Array
(
    [0] => starting bgping
    [1] => ending bgping
)

result:0
end bgtest.php 
```

ping 命令现在应该在服务器上运行。您可以运行 PHP 脚本，而不是 ping 命令：

```
php -n -f largejob.php > dump.txt & 
```

希望这可以帮助！

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-02-19T05:51:05.670

这是对使用 gzip 压缩的 Timbo 代码的修改。

```
// buffer all upcoming output
if(!ob_start("ob_gzhandler")){
    define('NO_GZ_BUFFER', true);
    ob_start();
}
echo "We'll email you as soon as this is done.";

//Flush here before getting content length if ob_gzhandler was used.
if(!defined('NO_GZ_BUFFER')){
    ob_end_flush();
}

// get the size of the output
$size = ob_get_length();

// send headers to tell the browser to close the connection
header("Content-Length: $size");
header('Connection: close');

// flush all output
ob_end_flush();
ob_flush();
flush();

// if you're using sessions, this prevents subsequent requests
// from hanging while the background process executes
if (session_id()) session_write_close();

/******** background process starts here ********/ 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-11-12T16:40:50.360

我在共享主机上，并`fastcgi_finish_request`设置为完全退出脚本。我也不喜欢这个`connection: close`解决方案。使用它会强制为后续请求建立单独的连接，从而消耗额外的服务器资源。我阅读了`Transfer-Encoding: cunked` [维基百科文章](http://en.wikipedia.org/wiki/Chunked_transfer_encoding)并了解到`0\r\n\r\n`终止响应。我还没有在浏览器版本和设备上彻底测试过这个，但它适用于我当前的所有 4 个浏览器。

```
// Disable automatic compression
// @ini_set('zlib.output_compression', 'Off');
// @ini_set('output_buffering', 'Off');
// @ini_set('output_handler', '');
// @apache_setenv('no-gzip', 1);

// Chunked Transfer-Encoding & Gzip Content-Encoding
function ob_chunked_gzhandler($buffer, $phase) {
    if (!headers_sent()) header('Transfer-Encoding: chunked');
    $buffer = ob_gzhandler($buffer, $phase);
    return dechex(strlen($buffer))."\r\n$buffer\r\n";
}

ob_start('ob_chunked_gzhandler');

// First Chunk
echo "Hello World";
ob_flush();

// Second Chunk
echo ", Grand World";
ob_flush();

ob_end_clean();

// Terminating Chunk
echo "\x30\r\n\r\n";
ob_flush();
flush();

// Post Processing should not be displayed
for($i=0; $i<10; $i++) {
    print("Post-Processing");
    sleep(1);
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-03-30T09:15:00.050

TL;DR 答案：

```
ignore_user_abort(true); //Safety measure so that the user doesn't stop the script too early.

$content = 'Hello World!'; //The content that will be sent to the browser.

header('Content-Length: ' . strlen($content)); //The browser will close the connection when the size of the content reaches "Content-Length", in this case, immediately.

ob_start(); //Content past this point...

echo $content;

//...will be sent to the browser (the output buffer gets flushed) when this code executes.
ob_end_flush();
ob_flush();
flush();

if(session_id())
{
    session_write_close(); //Closes writing to the output buffer.
}

//Anything past this point will be ran without involving the browser. 
```

函数答案：

```
ignore_user_abort(true);

function sendAndAbort($content)
{
    header('Content-Length: ' . strlen($content));

    ob_start();

    echo $content;

    ob_end_flush();
    ob_flush();
    flush();
}

sendAndAbort('Hello World!');

//Anything past this point will be ran without involving the browser. 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T09:10:51.163

你可以尝试做多线程。

您可以编写一个脚本来进行系统调用（使用[shell_exec](http://my.php.net/manual/en/function.shell-exec.php)），该脚本使用脚本调用 php 二进制文件以将您的工作作为参数。但我认为这不是最安全的方式。也许你可以通过 chrooting php 进程和其他东西来加强东西

或者，在 phpclasses 中有一个类可以做到这一点[http://www.phpclasses.org/browse/package/3953.html](http://www.phpclasses.org/browse/package/3953.html)。但我不知道实现的细节

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-01-10T06:15:58.597

[Joeri Sebrechts 的回答](https://stackoverflow.com/a/141026/315024)很接近，但它会破坏任何在您希望断开连接之前可能被缓冲的现有内容。它没有`ignore_user_abort`正确调用，导致脚本过早终止。[diyism 的答案](https://stackoverflow.com/a/7120170/315024)很好，但并不普遍适用。例如，一个人可能有更多或更少的输出缓冲区，该答案无法处理，因此它可能根本不适用于您的情况，您不知道为什么。

此功能允许您随时断开连接（只要尚未发送标头）并保留您迄今为止生成的内容。默认情况下，额外的处理时间是无限的。

```
function disconnect_continue_processing($time_limit = null) {
    ignore_user_abort(true);
    session_write_close();
    set_time_limit((int) $time_limit);//defaults to no limit
    while (ob_get_level() > 1) {//only keep the last buffer if nested
        ob_end_flush();
    }
    $last_buffer = ob_get_level();
    $length = $last_buffer ? ob_get_length() : 0;
    header("Content-Length: $length");
    header('Connection: close');
    if ($last_buffer) {
        ob_end_flush();
    }
    flush();
} 
```

如果您也需要额外的内存，请在调用此函数之前分配它。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-11-18T14:01:49.953

*mod_fcgid 用户注意事项（请自行承担使用风险）。*

## 快速解决方案

[Joeri Sebrechts](https://stackoverflow.com/users/20980/joeri-sebrechts)接受的答案确实是有用的。但是，如果您使用*mod_fcgid*，您可能会发现此解决方案无法单独运行。换句话说，当调用*刷新*函数时，与客户端的连接不会关闭。

*mod_fcgid*的`FcgidOutputBufferSize`配置参数可能是罪魁祸首。我在以下位置找到了这个提示：

 *1.  [Travers Carter 的回复](http://sourceforge.net/p/mod-fcgid/mailman/message/20924039/#msg20909317)和
2.  [Seumas Mackinnon 的这篇博文](http://fitzroytuesday.blogspot.gr/2012/08/php-fcgid-and-flush.html)。

阅读以上内容后，您可能会得出一个快速解决方案的结论是添加该行（请参阅最后的“示例虚拟主机”）：

```
FcgidOutputBufferSize 0 
```

在您的 Apache 配置文件（例如，httpd.conf）、您的 FCGI 配置文件（例如，fcgid.conf）或您的虚拟主机文件（例如，httpd-vhosts.conf）中。

> 在上面的（1）中，提到了一个名为“OutputBufferSize”的变量。`FcgidOutputBufferSize`这是(2) 中提到的旧名称（请参阅[Apache 网页中 mod_fcgid 的升级说明](https://httpd.apache.org/mod_fcgid/mod/mod_fcgid.html#upgrade)）。

## 细节和第二个解决方案

上述解决方案禁用*mod_fcgid*为整个服务器或特定虚拟主机执行的缓冲。这可能会导致您的网站性能下降。另一方面，情况可能并非如此，因为 PHP 自己执行缓冲。

如果您不想禁用*mod_fcgid*的缓冲，还有另一种解决方案……**您可以强制此缓冲区刷新**。

下面的代码通过构建 Joeri Sebrechts 提出的解决方案来做到这一点：

```
<?php
    ob_end_clean();
    header("Connection: close");
    ignore_user_abort(true); // just to be safe
    ob_start();
    echo('Text the user will see');

    echo(str_repeat(' ', 65537)); // [+] Line added: Fill up mod_fcgi's buffer.

    $size = ob_get_length();
    header("Content-Length: $size");
    ob_end_flush(); // Strange behaviour, will not work
    flush(); // Unless both are called !
    // Do processing here 
    sleep(30);
    echo('Text user will never see');
?> 
```

添加的代码行本质上是填充*mod_fcgi*的缓冲区，从而强制它刷新。选择数字“65537”是因为`FcgidOutputBufferSize`变量的默认值为“65536”，如[Apache 网页中针对相应指令所述](https://httpd.apache.org/mod_fcgid/mod/mod_fcgid.html#fcgidoutputbuffersize)。因此，如果在您的环境中设置了另一个值，您可能需要相应地调整此值。

## 我的环境

*   WampServer 2.5
*   阿帕奇 2.4.9
*   PHP 5.5.19 VC11、x86、非线程安全
*   mod_fcgid/2.3.9
*   Windows 7 专业版 x64

## 示例虚拟主机

```
<VirtualHost *:80>
    DocumentRoot "d:/wamp/www/example"
    ServerName example.local

    FcgidOutputBufferSize 0

    <Directory "d:/wamp/www/example">
        Require all granted
    </Directory>
</VirtualHost> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-02-03T12:54:56.997

这对我有用

```
//avoid apache to kill the php running
ignore_user_abort(true);
//start buffer output
ob_start();

echo "show something to user1";
//close session file on server side to avoid blocking other requests
session_write_close();

//send length header
header("Content-Length: ".ob_get_length());
header("Connection: close");
//really send content, can't change the order:
//1.ob buffer to normal buffer,
//2.normal buffer to output
ob_end_flush();
flush();
//continue do something on server side
ob_start();
//replace it with the background task
sleep(20); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T09:47:37.847

您的问题可以通过在 php 中进行一些并行编程来解决。几周前我在这里问了一个问题：[如何在 PHP 应用程序中使用多线程](https://stackoverflow.com/questions/70855/how-can-one-use-multi-threading-in-php-applications)

并得到了很好的答案。我特别喜欢一个。作者参考了 PHP[中的*简易并行处理*（2008 年 9 月；johnlim 编写）教程](http://phplens.com/phpeverywhere/?q=node/view/254)，它实际上可以很好地解决您的问题，因为我已经用它来处理几天前出现的类似问题。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-26T12:55:01.943

好的，所以基本上 jQuery 执行 XHR 请求的方式，即使 ob_flush 方法也不起作用，因为您无法在每个 onreadystatechange 上运行函数。jQuery 检查状态，然后选择正确的操作（完成、错误、成功、超时）。虽然我找不到参考，但我记得听说这不适用于所有 XHR 实现。我认为应该为您工作的一种方法是 ob_flush 和永久帧轮询之间的交叉。

```
<?php
 function wrap($str)
 {
  return "<script>{$str}</script>";
 };

 ob_start(); // begin buffering output
 echo wrap("console.log('test1');");
 ob_flush(); // push current buffer
 flush(); // this flush actually pushed to the browser
 $t = time();
 while($t > (time() - 3)) {} // wait 3 seconds
 echo wrap("console.log('test2');");
?>

<html>
 <body>
  <iframe src="ob.php"></iframe>
 </body>
</html> 
```

并且因为脚本是内联执行的，当缓冲区被刷新时，你会得到执行。为了使它有用，请将 console.log 更改为在主脚本设置中定义的回调方法，以接收数据并对其进行操作。希望这可以帮助。干杯，摩根。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-26T17:42:18.600

另一种解决方案是将作业添加到队列中并制作一个检查新作业并运行它们的 cron 脚本。

我最近不得不这样做以规避共享主机施加的限制 - exec() 等对 web 服务器运行的 PHP 被禁用，但可以在 shell 脚本中运行。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-05-05T19:02:08.607

如果`flush()`功能不起作用。***您必须在php.ini***中设置下一个选项，例如：

```
output_buffering = Off  
zlib.output_compression = Off 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-04-10T15:35:31.987

**最新工作解决方案**

```
 // client can see outputs if any
    ignore_user_abort(true);
    ob_start();
    echo "success";
    $buffer_size = ob_get_length();
    session_write_close();
    header("Content-Encoding: none");
    header("Content-Length: $buffer_size");
    header("Connection: close");
    ob_end_flush();
    ob_flush();
    flush();

    sleep(2);
    ob_start();
    // client cannot see the result of code below 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-03-10T12:00:02.940

在从这个线程尝试了许多不同的解决方案之后（在他们都没有为我工作之后），我在官方 PHP.net 页面上找到了解决方案：

```
function sendResponse($response) {
    ob_end_clean();
    header("Connection: close\r\n");
    header("Content-Encoding: none\r\n");
    ignore_user_abort(true);
    ob_start();

    echo $response; // Actual response that will be sent to the user

    $size = ob_get_length();
    header("Content-Length: $size");
    ob_end_flush();
    flush();
    if (ob_get_contents()) {
        ob_end_clean();
    }
} 
```

# winapi - SHGetFolderPath() 32 位与 64 位

> ID：138379
> 
> 赞同：1
> 
> 时间：2008-09-26T09:04:40.400
> 
> 标签：winapi, shell, 64-bit, path, 32-bit

如果我在具有 CSIDL_PROGRAM_FILESx86 文件夹 id 而不是 CSIDL_PROGRAM_FILES id 的 32 位系统中使用[SHGetFolderPath api 调用会发生什么？](http://msdn.microsoft.com/en-us/library/windows/desktop/bb762181%28v=vs.85%29.aspx)

理论上 CSIDL_PROGRAM_FILESx86 应该映射到`C:\program files (x86)`64 位系统，但它在不存在此路径的 32 位系统中映射到什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T09:33:43.857

[MSDN 上的这篇文章](http://msdn.microsoft.com/en-us/library/bb762584(VS.85).aspx)描述了不同的场景。

向下滚动到备注“FOLDERID_ProgramFiles”

> ```
> OS    Application KNOWNFOLDERID            Default Path                   CSIDL Equivalent  
> 32 bit    32 bit  FOLDERID_ProgramFiles    %SystemDrive%\Program Files    CSIDL_PROGRAM_FILES  
> 32 bit    32 bit  FOLDERID_ProgramFilesX86 %SystemDrive%\Program Files    CSIDL_PROGRAM_FILESX86  
> 32 bit    32 bit  FOLDERID_ProgramFilesX64 (undefined)    Not applicable  Not applicable 
> ```

摘要：它将指向 %SystemDrive%\Program Files

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-01T16:55:10.330

试试这个：

```
GetEnvironmentVariable("ProgramW6432", szBuffer, nBufferSize); 
```

YMMV

# debugging - 彩色grep？

> ID：138383
> 
> 赞同：11
> 
> 时间：2008-09-26T09:05:24.377
> 
> 标签：debugging, unix, logging, command-line, grep

*有时，在查找内容*和*行为*时，为日志文件或其他文件着色可以提供一个很好的概览

 *我刚刚看到 grep 有一个着色功能

```
grep -C 99999 --color <regexp> <filename> 
```

还有哪些其他方法？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-26T09:54:09.330

这是我有时使用的日志着色工具的片段。

请注意，这仅适用于标准输入/标准输出和支持 ANSI 颜色的终端。

```
#include <stdio.h>
#include <regex.h>

#define MAX_LINE 4096

#define RESET   "\033[0m"
#define BLACK   "\033[30m"      /* Black */
#define RED     "\033[31m"      /* Red */
#define GREEN   "\033[32m"      /* Green */
#define YELLOW  "\033[33m"      /* Yellow */
#define BLUE    "\033[34m"      /* Blue */
#define MAGENTA "\033[35m"      /* Magenta */
#define CYAN    "\033[36m"      /* Cyan */
#define WHITE   "\033[37m"      /* White */
#define BOLDBLACK   "\033[1m\033[30m"      /* Bold Black */
#define BOLDRED     "\033[1m\033[31m"      /* Bold Red */
#define BOLDGREEN   "\033[1m\033[32m"      /* Bold Green */
#define BOLDYELLOW  "\033[1m\033[33m"      /* Bold Yellow */
#define BOLDBLUE    "\033[1m\033[34m"      /* Bold Blue */
#define BOLDMAGENTA "\033[1m\033[35m"      /* Bold Magenta */
#define BOLDCYAN    "\033[1m\033[36m"      /* Bold Cyan */
#define BOLDWHITE   "\033[1m\033[37m"      /* Bold White */

static int selected_color = 0;
static char *colors[] = {
  "-green", GREEN,
  "-black", BLACK,
  "-red", RED,
  "-yellow", YELLOW,
  "-blue", BLUE,
  "-magenta", MAGENTA,
  "-cyan", CYAN,
  "-white", WHITE,
  "-boldgreen", BOLDGREEN,
  "-boldblack", BOLDBLACK,
  "-boldred", BOLDRED,
  "-boldyellow", BOLDYELLOW,
  "-boldblue", BOLDBLUE,
  "-boldmagenta", BOLDMAGENTA,
  "-boldcyan", BOLDCYAN,
  "-boldwhite", BOLDWHITE,
  NULL
};

/*----------------------------------------------------------------------*/

int main(int argc, char *argv[]) {
  char buf[MAX_LINE];
  int has_re = 0;
  regex_t re;

  if (argc > 1) {
    if (argc > 2) {
      int idx = 0;
      while (colors[idx*2]) {
        if (!strcmp(colors[idx*2], argv[1])) {
          selected_color = idx;
          break;
        }
        idx++;
      }
      if (regcomp(&re, argv[2], REG_EXTENDED | REG_NEWLINE)) {
        printf("regcomp() failed!\n");
        return -1;
      }
    } else if (regcomp(&re, argv[1], REG_EXTENDED | REG_NEWLINE)) {
      printf("regcomp() failed!\n");
      return -1;
    }
    has_re = 1;
  } else {
    printf("Usage: %s [ -red | -blue | -cyan | -white | -black | "
           "-yellow | -magenta ] <regexp>\n", argv[0]);
    return -1;  
  }

  while (fgets(buf, MAX_LINE, stdin) == buf) {
    char *bbuf = buf;
    while (1) {
      if (has_re) {
        regmatch_t match[10];
        if (regexec(&re, bbuf, re.re_nsub + 1, match, 0)) {
          printf("%s", bbuf);
          break;
        } else {
          int i, idx;
          for (i=idx=0; i<1; i++) {
            if (match[0].rm_so < 0) {
              break;
            } else {
              printf("%.*s", 
                     (int)(match[i].rm_so-idx), 
                     bbuf+idx);
              printf( "%s%.*s" RESET, 
                      colors[selected_color*2+1],
                      (int)(match[i].rm_eo-match[i].rm_so), 
                      bbuf+(int)match[i].rm_so);
              idx = match[i].rm_eo;
              bbuf += idx;
            }
          }
        }
      }
      fflush(stdout);
    }
  }

  if (has_re) {
    regfree(&re);
  }

  return 0;
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-26T09:06:52.797

对于搜索源代码，我使用[ack](http://petdance.com/ack/)。它有很多对搜索代码有意义的选项（例如自动忽略 SCM 目录）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T09:08:33.480

有许多支持着色的程序，如[Colortail](http://joakimandersson.se/projects/colortail/)

也许这也有帮助：[GenericColouriser](http://freshmeat.net/projects/genericcolouriser/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T09:35:57.000

我们使用[baretail](http://www.baremetalsoft.com/baretail/)，现在如果他们为[baregrep](http://www.baremetalsoft.com/baregrep/index.php)添加颜色，那就太好了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-05-08T08:24:49.327

这是一个较老的问题，但如果有人还在寻找，我最近创建[`colorize`](https://github.com/hq6/colorize)了一个工具，它允许指定固定模式或正则表达式以匹配特定颜色。它开箱即用，具有用于指定突出显示的直观语法，并且`docopt`是它唯一的依赖项。

```
colorize.py -f 'This is an interesting line=Blue' -f 'Different topic=Red' Input.log 
```

# css - IE6的简单切换功能

> ID：138392
> 
> 赞同：3
> 
> 时间：2008-09-26T09:07:08.100
> 
> 标签：css, internet-explorer

我遇到了IE6的问题。

我从这个[网站](http://www.dustindiaz.com/seven-togglers/)获取了切换功能，但是当我将它应用到我的页面时，我得到了错误（仅在 IE6 中）：

> 无法获取显示属性。无效的论点。

我可以获得显示属性，但是当我想设置为新值时会抛出错误。

编辑：我知道有几个开发人员遇到了这个问题。因此，如果它可以提供帮助：**table-row 属性不是由 internet explorer 6 管理的**！

在我的情况下，即使我将 display 属性设置为 '' 我什么也没看到，但这是因为我将一个类应用于我的元素，在加载时隐藏它们，所以默认显示是隐藏，当你设置display 属性为 '' IE 将其设置为默认显示。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T09:18:09.260

您是否尝试通过任何更改将显示属性设置为“表格行”？IE6 不支持。

提示是将 display 设置为空字符串。它使浏览器使用元素的默认值。

# .net - 您可以在版本 2 CLR 安装上运行版本 3 .Net 二进制文件吗？

> ID：138393
> 
> 赞同：0
> 
> 时间：2008-09-26T09:07:10.580
> 
> 标签：.net, clr

我们正在考虑使用 .Net 3 编写 out 项目的下一个版本，但想知道我们是否可以强制最终用户安装 .net 框架版本 3。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T09:08:51.263

如果要确保仅使用 .NET 2.0 兼容功能，则应仅使用 .NET 2.0 程序集。然后你知道你的安全和健全。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T09:16:13.880

[Jean-Baptiste Evain 的这篇文章](http://evain.net/blog/articles/2008/09/14/c-3-and-linq-on-net-2)解释了如何使用 C# 3.0 和 LINQ 以及只安装 .NET 2.0 运行时的目标计算机。

这个想法是使用 System.Core [Mono](http://www.mono-project.com/)实现，它在 MIT/X11 许可下获得许可。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T17:36:10.847

.NET 3.0 对于一些新库来说是个坏名字：WPF、WCF、Workflow 和 InfoCard。CLR 仍然是 2.0 版，ASP.NET 仍然是 2.0 版，Windows Forms 仍然是 2.0 版。

在开发中，.NET 3.0 被称为 WinFX。

# c++ - 如何以编程方式拔出和重新插入任意 USB 设备？

> ID：138394
> 
> 赞同：37
> 
> 时间：2008-09-26T09:07:16.023
> 
> 标签：c++, winapi, usb, usbserial

我正在尝试修复伪装成虚拟 COM 端口的无响应 USB 设备。手动重新插入工作，但可能有多达 12 个这样的单元。是否有 API 命令可以执行与拔出/重新插入周期等效的编程？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-01T18:01:57.347

使用 Devcon.exe 来“删除”然后“重新扫描”怎么样？

博士

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-01-08T13:31:13.037

您可以使用[C# Hardware Helper Lib](http://www.codeproject.com/Articles/21503/Hardware-Helper-Library-for-C)并添加[ResetDevice 功能](http://www.codeproject.com/Articles/21503/Hardware-Helper-Library-for-C?msg=4467165#xx4467165xx)。

```
public bool ResetDevice( IntPtr hDevInfo, IntPtr devInfoData )  
// Need to add  
// public const int DICS_PROPCHANGE = ((0x00000003));   
// at the public class Native under //PARMS  
int szOfPcp;  
IntPtr ptrToPcp;  
int szDevInfoData;  
IntPtr ptrToDevInfoData;  

Native.SP_PROPCHANGE_PARAMS pcp = new Native.SP_PROPCHANGE_PARAMS();  
pcp.ClassInstallHeader.cbSize = Marshal.SizeOf(typeof(Native.SP_CLASSINSTALL_HEADER));  
pcp.ClassInstallHeader.InstallFunction = Native.DIF_PROPERTYCHANGE;  
pcp.StateChange = Native.DICS_PROPCHANGE; // for reset  
pcp.Scope = Native.DICS_FLAG_CONFIGSPECIFIC;  
pcp.HwProfile = 0;  

szOfPcp = Marshal.SizeOf(pcp);  
ptrToPcp = Marshal.AllocHGlobal(szOfPcp);  
Marshal.StructureToPtr(pcp, ptrToPcp, true);  
szDevInfoData = Marshal.SizeOf(devInfoData);  
ptrToDevInfoData = Marshal.AllocHGlobal(szDevInfoData);  
Marshal.StructureToPtr(devInfoData, ptrToDevInfoData, true);  

bool rslt1 = Native.SetupDiSetClassInstallParams(hDevInfo, ptrToDevInfoData, ptrToPcp,   Marshal.SizeOf(typeof(Native.SP_PROPCHANGE_PARAMS)));  
bool rstl2 = Native.SetupDiCallClassInstaller(Native.DIF_PROPERTYCHANGE, hDevInfo,   ptrToDevInfoData);  

if (rslt1 && rstl2)  
{  
    return true;  
}  
return false;  
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T09:09:39.310

不幸的是，没有一个我知道。物理拔出 USB 连接会使用上拉电阻执行特定的电子操作，以便设备知道它已拔出。我还没有遇到过试图在没有物理拔出的情况下模拟这种情况的主机。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T19:30:55.083

想法：在设备管理器下，您可以右键单击计算机图标（设备树顶部）并“扫描更改”。我不确定 100%，但我认为如果你“弹出”一个 USB 设备（软件“拔出”等效），然后扫描硬件更改，即使它从未真正离开端口，它也会显示备份。

如果我是对的，您也许可以使用 Microsoft.Win32.Shell 类来模拟打开控制面板 --> 管理工具 --> 设备管理器并运行上下文菜单项。无论如何，值得一试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T11:27:12.630

我已经看过这个进行自动化测试。我们想出的最佳解决方案似乎是 USB 集线器在消耗过多电量时断开设备的能力。从 USB 的角度来看，USB 主机似乎可以指示集线器这样做。使用 12 台设备，您将拥有集线器，因此我建议调查该路径。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T10:46:19.873

正如[Greg Hewgill](https://stackoverflow.com/questions/138394/how-to-programatically-unplug-replug-an-arbitrary-usb-device#138405)所说，我认为这是不可能的。

整个 USB 启动的启动由 USB 从设备（在您的情况下是您的设备）触发。USB 主机（PC）可以向设备发送一条消息，告诉它关闭，但一旦完成，就由设备重新启动备份。楼主不能强求。

更糟糕的是，您很可能会发现 USB 设备正在检测插入的插头（通过检测电源线上的 USB 电压）以启动。对于总线供电的设备尤其如此。

* * *

听起来您的情况和尝试卸载/重新安装 USB 驱动器的情况有所不同。卸载 USB 驱动器时，没有理由不能在 PC 上保持枚举。您实际上并没有重置 USB 驱动器，只是使其文件系统处于非活动状态。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-15T14:34:50.723

不久前，我不得不为我的汽车计算机项目做这个。触摸屏驱动程序不喜欢进入休眠状态，当计算机从休眠状态恢复时需要重新插入。我最终解决它的方法是像 DigitalRacer 建议的那样使用 Devcon.exe。然而，诀窍是控制器上的删除/重新扫描不起作用。我必须在设备上游的 HUB 上进行删除/重新扫描（随后断开所有连接的设备）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-06-29T14:45:17.057

这里有一些动手指导：

[http://digital.ni.com/public.nsf/allkb/1D120A90884C25AF862573A700602459](http://digital.ni.com/public.nsf/allkb/1D120A90884C25AF862573A700602459)

这更硬核：

[http://support.microsoft.com/kb/311272](http://support.microsoft.com/kb/311272)

我会说使用 devcon.exe 可能会解决一些问题，但不是我的。假设您可以构建一个带有 USB 端口阵列的盒子，其中电源线被 MCU 控制的 FET 中断。MCU 应该说一些基本可靠的东西，比如 RS-232。可能有一个 arduino 板可以简化可怕的硬件工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T09:12:42.860

如果您在任何特定主机上拥有多个这些，则可以通过将它们从机器上插入自己的专用 USB 集线器来节省一些时间/挫败感 - 至少只需一根电缆即可拔出/插入重新启动几个设备。

当然，您可能已经想到了这一点。:-)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-06T13:57:31.770

我们用[它](http://www.electronickits.com/kit/complete/elec/ck1610.htm)来可编程断开 USB 设备。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-03T19:41:37.730

设备本身可能能够做到这一点（即，执行 USB 断开/重新连接序列）。

您是否联系过设备制造商，或者如果您是制造商，请联系设计它的 EE？

我在设计 USB 嵌入式设备时必须这样做——编程可以通过 USB 完成，但设备必须能够在多个点断开和重新连接才能完成该过程。

除此之外，还有在设备管理器中禁用 USB 主机设备的蛮力方法（我假设这可以在软件中完成）然后重新启用它。

如果不出意外，Phidg​​et 有 USB 控制的继电器板，您可以使用它来将电源或 USB 线本身连接到集线器或单个设备。

-亚当

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-26T09:12:57.197

可以通过编程方式[卸载 USB 驱动器](https://stackoverflow.com/questions/85649/safe-remove-usb-drive-using-win32-api)，但是，我不知道是否可以通过代码完成重新安装。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-26T09:21:49.750

在*[Eject USB disks using C#](http://www.codeproject.com/KB/system/usbeject.aspx)* ( [The Code Project](http://en.wikipedia.org/wiki/The_Code_Project) ) 中寻找这个：

> *CM_Request_Device_Eject*函数
> 
> 这是弹出设备（可以弹出的任何设备）的 SetupApi 函数。它需要一个设备实例句柄（或 devInst）作为输入......

# asp.net - 工具提示下拉列表

> ID：138408
> 
> 赞同：2
> 
> 时间：2008-09-26T09:10:39.713
> 
> 标签：asp.net, drop-down-menu, tooltip

我在 GridView 中有一个下拉列表。下拉列表中的数据具有可变长度，但下拉列表具有固定大小。如何在不从下拉列表中选择任何项目的情况下在每个项目上显示工具提示？

我已经用谷歌搜索，但遇到了工具提示显示在当前选定的下拉列表项上的示例。SO社区中的任何人都可以给我一个提示吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-26T12:33:35.927

我要强调这最终必须在 IE 中工作？

如果是这样，那就不漂亮了。IE6 不支持 OPTION 元素上的“title”属性。

MSDN Internet Explorer 论坛主题中列出了一个丑陋但可能可用的解决方法：

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3570987&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3570987&SiteID=1)

# asp-classic - 在网络浏览器中捕捉标签关闭事件？

> ID：138411
> 
> 赞同：4
> 
> 时间：2008-09-26T09:11:07.140
> 
> 标签：asp-classic

有没有办法知道用户是否关闭了网络浏览器中的选项卡？特别是 IE7，还有 FireFox 等。如果包含我们网站的当前选项卡关闭，我希望能够从我们的 asp 代码中处理这种情况。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-11-30T22:26:42.370

onbeforeunload 还会在以下事件中被调用 -

```
* Close the current browser window.
* Navigate to another location by entering a new address or selecting a Favorite.
* Click the Back, Forward, Refresh, or Home button.
* Click an anchor that refers the browser to another Web page.
* Invoke the anchor.click method.
* Invoke the document.write method.
* Invoke the document.open method.
* Invoke the document.close method.
* Invoke the window.close method.
* Invoke the window.open method, providing the possible value _self for the window name.
* Invoke the window.navigate or NavigateAndFind method.
* Invoke the location.replace method.
* Invoke the location.reload method.
* Specify a new value for the location.href property.
* Submit a form to the address specified in the ACTION attribute via the INPUT type=submit control, or invoke the form.submit method. 
```

因此，如果您在用户关闭选项卡或浏览器窗口时尝试注销用户，那么每次他们单击链接或提交页面时，您最终都会将他们注销。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T09:29:18.313

附加一个“ [onbeforeunload](http://msdn.microsoft.com/en-us/library/ms536907(VS.85).aspx) ”事件。它可以在浏览器/选项卡关闭之前执行代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T09:11:43.190

如果你不这样做 document.unload 吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T21:51:30.920

如果您需要知道页面何时在服务器端关闭，最好的办法是定期从页面 ping 服务器（`XMLHttpRequest`例如，通过 ）。当 ping 停止时，页面关闭。如果浏览器崩溃、被终止或计算机关闭，这也将起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T05:55:32.540

正如 Eran Galperin 建议的那样，使用`onbeforeunload`. 特别是，返回一个字符串，该字符串将包含在确认对话框中，允许用户选择是否离开页面。每个浏览器在您返回的字符串之前和之后都包含一些文本，因此您应该在不同的浏览器中进行测试以查看用户会看到什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-17T19:41:41.483

我确定 OP 是从网页本身的上下文中询问的，但是对于遇到此问题的任何 Firefox 插件开发人员，您可以使用该`TabClose`事件。[https://developer.mozilla.org/en/Code_snippets/Tabbed_browser#Notification_when_a_tab_is_added_or_removed](https://developer.mozilla.org/en/Code_snippets/Tabbed_browser#Notification_when_a_tab_is_added_or_removed)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-29T07:08:42.360

Santosh 是对的，此事件将在更多操作上触发，而不仅仅是单击选项卡/浏览器的关闭按钮。我创建了一个小技巧，以防止通过在文档就绪时添加以下功能来触发 onbeforeunload 操作。

```
 $(function () {     
        window.onbeforeunload = OnBeforeUnload;
            $(window).data('beforeunload', window.onbeforeunload);
            $('body').delegate('a', 'hover', function (event) {
                if (event.type === 'mouseenter' || event.type === "mouseover")
                    window.onbeforeunload = null;
                else
                    window.onbeforeunload = $(window).data('beforeunload');
            });
        }); 
```

此外，在触发 Santosh 提到的任何事件之前，您需要运行以下行：

```
window.onbeforeunload = null; 
```

如果您不希望触发事件。

这是最终的代码片段：

```
 function OnBeforeUnload(oEvent) {   
            // return a string to show the warning message (not every browser will use this string in the dialog)
            // or run the code you need when the user closes your page  
        return "Are you sure you want to close this window?";       
    } 
```

# c# - 如果使用自定义数据源，如何对 ASP.NET GridView 中的列进行排序？

> ID：138412
> 
> 赞同：5
> 
> 时间：2008-09-26T09:11:39.027
> 
> 标签：c#, asp.net, gridview, sqldatasource

当我使用自定义 SqlDataSource 时，我无法让我的 GridView 使用户能够对一列数据进行排序。

我有一个 GridView，其中 ASP 中的代码在 HTML 中对其进行引用是最少的：

```
<asp:GridView id="grid" runat="server" AutoGenerateColumns="False" AllowSorting="True">
</asp:GridView> 
```

在代码隐藏中，我附加了一个动态创建的 SqlDataSource（它包含的列并不总是相同的，因此用于创建它的 SQL 是在运行时构造的）。例如：

我设置了列...

```
BoundField column = new BoundField();
column.DataField = columnName;
column.HeaderText = "Heading";
column.SortExpression = columnName;

grid.Columns.Add(column); 
```

数据源...

```
SqlDataSource dataSource = new SqlDataSource(
    "System.Data.SqlClient",
    connectionString, 
    generatedSelectCommand); 
```

然后是网格视图...

```
grid.DataSource = dataSource;
grid.DataKeyNames = mylistOfKeys;
grid.DataBind(); 
```

目前，当我希望它对列数据进行排序时，当用户单击列标题时，什么也没有发生。有人知道我缺少什么吗？

如果有更好的方法这样做也会有帮助，因为这对我来说看起来很乱！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-12-13T15:11:07.167

您也可以在排序处理程序中的 DataBind() 调用之前重新分配 datasource.SelectCommand。像这样的东西：

```
protected void gvItems_Sorting(object sender, GridViewSortEventArgs e)
{
    GridView gv = (GridView)sender;
    SqlDataSource ds = (SqlDataSource)gv.DataSource;
    ds.SelectCommand = ds.SelectCommand + " order by " 
        + e.SortExpression + " " + GetSortDirection(e.SortDirection);
    gvItems.DataSource = ds;
    gvItems.DataBind();
}

string GetSortDirection(string sSortDirCmd)
{
    string sSortDir;
    if ((SortDirection.Ascending == sSortDirCmd))
    {
        sSortDir = "asc";
    }
    else
    {
        sSortDir = "desc";
    }
    return sSortDir;
} 
```

我希望这会有所帮助。如果您需要额外的帮助来实施它，请告诉我。

享受！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T09:39:15.823

首先，您需要添加一个事件：

```
<asp:GridView AllowSorting="True" OnSorting="gvName_Sorting" ... 
```

然后那个事件看起来像：

```
protected void gvName_Sorting( object sender, GridViewSortEventArgs e )
{
    ...
    //rebind gridview
} 
```

您基本上必须再次获取数据。

你说得对，它看起来很乱，有更好的方法：ASP.Net MVC

不幸的是，这是一个截然不同的页面模型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T09:30:22.427

我不确定这个，但是如果您使用标准的 SqlDataSource 并单击一个字段以根据该字段进行排序，则 SqlDataSource 将再次填充数据并将其重新绑定到网格。所以排序不会发生在客户端，也只能在 SQLDataSource 的 selectmethod 不是 DataReader 时进行。

在处理排序事件时，是否重新创建 SqlDataSource 并将其反弹到 GridView？您可以将排序字段和方向放在您使用的生成的SelectCommand 中吗？还是放到 SQLDataSource 的 SortParameterName 属性中？

我绝对确定您必须将 SqlDataSource 重新绑定到网格，并且由于您动态创建它，因此您必须再次填充它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-03T10:39:24.890

迟到总比不到好？

基思建议的一些补充，基本上是正确的。

事实是，您必须处理 gridView_Sorting 事件的排序。不需要更早地 DataBind() GridView，例如在 Page_Load 事件中。您应该只调用 GridView.Sort() 方法而不是 .DataBind()。这是怎么回事：

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load

    If Not IsPostBack Then

        Me.gridView.Sort(Request.QueryString("sortExpression"), Request.QueryString("sortDirection"))

    End If

End Sub 
```

接下来让我们看看 gridView_Sorting 事件。

在那里，您必须将数据源推送到正确的排序。GridView 本身不处理（至少在这种情况下）。

```
Protected Sub gridView_Sorting(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewSortEventArgs) Handles gridView.Sorting
    If IsPostBack Then
        e.Cancel = True
        Dim sortDir As SortDirection = SortDirection.Ascending
        If e.SortExpression = Me.Q_SortExpression And Me.Q_SortDirection = SortDirection.Ascending Then
            sortDir = SortDirection.Descending
        End If
        RedirectMe(e.SortExpression, sortDir)
    Else
        Dim sortExpr As String = e.SortExpression + " " + IIf(e.SortDirection = SortDirection.Ascending, "ASC", "DESC")
        Dim dv As System.Data.DataView = Me.dsrcView.Select(New DataSourceSelectArguments(sortExpr))
        Me.gridView.DataSource = dv
        Me.gridView.DataBind()
    End If
End Sub 
```

无需在数据源中编写任何排序功能，例如将排序参数传递给存储过程。所有排序都发生在上面的代码中。

此外，最好将 gridView.EnableViewState 切换为 False，这会导致页面对于网络流量和浏览器来说更轻。可以这样做，因为只要页面回发，网格就会完全重新创建。

祝你今天过得愉快！

马丁

# sql-server - SQL Compact 选择前 1

> ID：138419
> 
> 赞同：13
> 
> 时间：2008-09-26T09:13:04.950
> 
> 标签：sql-server, sql-server-ce

在将应用程序从 SQL 2005 移植到 SQL Server Compact Edition 时，我发现需要移植以下命令：

```
SELECT TOP 1 Id FROM tblJob WHERE Holder_Id IS NULL 
```

但 SQL Server Compact Edition 不支持该`TOP`关键字。如何移植此命令？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-26T09:20:02.047

```
SELECT TOP(1) Id 
FROM tblJob 
WHERE Holder_Id IS NULL 
```

据我所知需要括号。

参考：[http ://technet.microsoft.com/en-us/library/bb686896.aspx](http://technet.microsoft.com/en-us/library/bb686896.aspx)

补充：同样，仅适用于 3.5 及以上版本

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T17:33:37.217

这与您的问题略有正交。

SQL Server Compact Edition 实际上不能很好地处理 SQL 查询。通过直接打开表格，您可以获得更好的性能。在 .NET 中，您可以通过将命令对象的`CommandText`属性设置为表名并将`CommandType`属性设置为`CommandType.TableDirect`.

如果要过滤结果，则需要在要过滤的列上的表上建立索引。通过设置`IndexName`属性来指定要使用的索引，并使用`SetRange`来设置过滤器。

然后，您可以根据需要阅读尽可能多或尽可能少的记录。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-13T13:42:15.113

我使用了 SqlCEDataAdapter 的 Fill 方法。你可以做：

DbDataAdapter.Fill (DataSet, Int32, Int32, String) 添加或刷新 DataSet 中指定范围内的行，以使用 DataSet 和 DataTable 名称匹配数据源中的行。由 .NET Compact Framework 提供支持。

[http://msdn.microsoft.com/en-ie/library/system.data.common.dbdataadapter.fill(v=VS.80).aspx](http://msdn.microsoft.com/en-ie/library/system.data.common.dbdataadapter.fill(v=VS.80).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T09:18:43.830

看起来它不能在紧凑的情况下完成。您必须阅读所有作业，或者制作一个 SqlReader，然后只阅读第一个作业。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T16:07:44.750

好找个理由。Management Studio 携带并使用它自己的版本 od SQL Server Compact。[在http://en.wikipedia.org/wiki/SQL_Server_Compact](http://en.wikipedia.org/wiki/SQL_Server_Compact)中查看更多信息。

> SQL Server Management Studio 2005 可以读取和修改 CE 3.0 和 3.1 数据库文件（使用最新的服务包），但读取 3.5 版文件需要来自 "Katmai" 2008 CTP 版本（或更高版本）的 SQL Server Management Studio 2008。
> 
> SQL Server Management Studio 2008 和 Microsoft Visual Studio Express 2008 SP1 的 RTM 可以创建、修改和查询 CE 3.5 SP1 数据库文件。

# html - 从 HTML 横向打印

> ID：138422
> 
> 赞同：279
> 
> 时间：2008-09-26T09:13:49.677
> 
> 标签：html, css, printing

我有一个 HTML 报告，由于列多，需要横向打印。有没有办法做到这一点，而用户不必更改文档设置？

浏览器中有哪些选项。

* * *

## 回答 #1

> 赞同：444
> 
> 时间：2009-09-08T08:50:50.727

在您的 CSS 中，您可以设置 @page 属性，如下所示。

```
@media print{@page {size: landscape}} 
```

@page 是[CSS 2.1 规范](http://www.w3.org/TR/CSS21/page.html#page-box)的一部分，但这`size`并没有像问题的答案所强调的那样[@Page { size:landscape} 已过时？](https://stackoverflow.com/questions/4249532/is-page-sizelandscape-obsolete)：

> CSS 2.1 不再指定 size 属性。CSS3 Paged Media 模块的当前工作草案确实指定了它（但这不是标准或被接受的）。

如前所述，尺寸选项来自[CSS 3 Draft Specification](http://www.w3.org/TR/css3-page/#page-size)。理论上，它可以设置为页面大小和方向，尽管在我的示例中省略了大小。

该支持与[在 firefox 中开始提交的错误报告](https://developer.mozilla.org/en/Mozilla_CSS_support_chart#section_3)混合在一起，大多数浏览器不支持它。

它似乎在 IE7 中工作，但这是因为 IE7 会记住用户在打印预览中最后选择的横向或纵向（仅重新启动浏览器）。

[本文](https://web.archive.org/web/20090228163159/http://edacio.us:80/forum/comments.php?DiscussionID=39)确实有一些使用 JavaScript 或 ActiveX 将密钥发送到用户浏览器的建议解决方法，尽管它们并不理想并且依赖于更改浏览器的安全设置。

或者，您可以旋转内容而不是页面方向。这可以通过创建样式并将其应用于包含这两行的主体来完成，但这也有缺点，会产生许多对齐和布局问题。

```
<style type="text/css" media="print">
    .page
    {
     -webkit-transform: rotate(-90deg); 
     -moz-transform:rotate(-90deg);
     filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
    }
</style> 
```

我发现的最后一种选择是在 PDF 中创建横向版本。您可以指出，当用户选择打印时，它会打印 PDF。但是我无法让它在 IE7 中自动打印工作。

```
<link media="print" rel="Alternate" href="print.pdf"> 
```

总之，在某些浏览器中，使用@page size 选项相对容易，但是在许多浏览器中没有确定的方法，这取决于您的内容和环境。这可能是 Google Documents 在选择打印时创建 PDF 并允许用户打开并打印的原因。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2014-09-24T20:21:09.063

我的解决方案：

```
<style type="text/css" media="print">
    @page { 
        size: landscape;
    }
    body { 
        writing-mode: tb-rl;
    }
</style> 
```

*   `media="print"`仅适用于打印。
*   这适用于`IE`,`Firefox`和`Chrome`

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2017-02-20T12:20:57.310

如前所述，该`size`属性是您所追求的。要在打印时设置页面的方向和大小，可以使用以下命令：

```
/* ISO Paper Size */
@page {
  size: A4 landscape;
}

/* Size in mm */    
@page {
  size: 100mm 200mm landscape;
}

/* Size in inches */    
@page {
  size: 4in 6in landscape;
} 
```

这是[@page 文档](https://developer.mozilla.org/en-US/docs/Web/CSS/@page/size)的链接。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2017-05-19T12:13:16.583

仅仅旋转页面内容是不够的。这是适用于大多数浏览器（Chrome、Firefox、IE9+）的正确 CSS。

首先将 body 设置`margin`为 0，否则页边距将大于您在打印对话框中设置的页边距。还设置`background`颜色以可视化页面。

```
body {
  margin: 0;
  background: #CCCCCC;
} 
```

`margin`，`border`并且`background`是可视化页面所必需的。

`padding`必须设置为所需的打印边距。在打印对话框中，您必须设置相同的边距（本例中为 10 毫米）。

```
div.portrait, div.landscape {
  margin: 10px auto;
  padding: 10mm;
  border: solid 1px black;
  overflow: hidden;
  page-break-after: always;
  background: white;
} 
```

A4 页面尺寸为 210 毫米 x 297 毫米。您需要从尺寸中减去打印边距。并设置页面内容的大小：

```
div.portrait {
  width: 190mm;
  height: 276mm;
}
div.landscape {
  width: 276mm;
  height: 190mm;
} 
```

我使用 276 毫米而不是 277 毫米，因为不同的浏览器缩放页面略有不同。所以他们中的一些人会在两页上打印 277 毫米高的内容。第二页将为空。使用276mm更安全。

我们不需要任何`margin`, `border`, `padding`,`background`在打印页面上，所以删除它们：

```
@media print {
  body {
    background: none;
    -ms-zoom: 1.665;
  }
  div.portrait, div.landscape {
    margin: 0;
    padding: 0;
    border: none;
    background: none;
  }
  div.landscape {
    transform: rotate(270deg) translate(-276mm, 0);
    transform-origin: 0 0;
  }
} 
```

请注意，转换的起源是`0 0`！横向页面的内容也必须向下移动 276 毫米！

此外，如果您有纵向和横向页面的混合，IE 将缩小页面。我们通过设置`-ms-zoom`为 1.665 来修复它。如果您将其设置为 1.6666 或类似的值，页面内容的右边框有时可能会被裁剪。

如果您需要 IE8- 或其他旧浏览器支持，您可以使用`-webkit-transform`, `-moz-transform`, `filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3)`. 但是对于足够现代的浏览器来说，这不是必需的。

这是一个测试页面：

```
<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
      ...Copy all styles here...
    </style>
  </head>
  <body>
    <div class="portrait">A portrait page</div>
    <div class="landscape">A landscape page</div>
  </body>
</html> 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2010-12-27T16:51:55.877

引用自[CSS-Discuss Wiki](http://css-discuss.incutio.com/wiki/Print_Stylesheets#The_.40page_rule_and_forcing_Landscape_orientation)

> @page 规则的范围已从 CSS2 缩减到 CSS2.1。据报道，完整的 CSS2 @page 规则仅在 Opera 中实现（即使在那时也是错误的）。我自己的测试表明 IE 和 Firefox 根本不支持 @page。根据现已过时的 CSS2 规范第 13.2.2 节，可以覆盖用户的方向设置和（例如）在横向中强制打印，但相关的“大小”属性已从 CSS2.1 中删除，与事实一致当前没有浏览器支持它。它已在 CSS3 Paged Media 模块中恢复，但请注意，这只是一个工作草案（截至 2009 年 7 月）。
> 
> 结论：暂时忘记@page。如果您觉得您的文档需要横向打印，问问自己是否可以让您的设计更加流畅。如果您真的不能（例如，可能因为文档包含具有许多列的数据表），您将需要建议用户将方向设置为横向，并可能概述如何在最常见的浏览器中执行此操作。当然，一些浏览器具有打印适合宽度（shrink-to-fit）功能（例如 Opera、Firefox、IE7），但不建议依赖拥有此功能或将其打开的用户。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-26T09:35:56.377

尝试将此添加到您的 CSS：

```
@page {
  size: landscape;
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-09-26T09:33:47.943

您也许可以使用[CSS 2 @page 规则](http://www.w3.org/TR/CSS2/page.html)，该规则允许您将['size' 属性设置为 Landscape](http://www.w3.org/TR/CSS2/page.html#page-size-prop)。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-26T09:28:55.443

您还可以使用非标准的 IE-only css 属性[writing-mode](http://www.eskimo.com/~bloo/indexdot/css/properties/intl/writingmode.htm)

```
div.page    { 
   writing-mode: tb-rl;
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-01-05T20:06:39.183

我创建了一个带有横向设置的空白 MS 文档，然后在记事本中打开它。将以下内容复制并粘贴到我的html页面

```
<style type="text/css" media="print">
   @page Section1
    {size:11 8.5in;
    margin:.5in 13.6pt 0in 13.6pt;
    mso-header-margin:.5in;
    mso-footer-margin:.5in;
    mso-paper-source:4;}
div.Section1
    {page:Section1;}
</style>

<div class="Section1"> put  text / images / other stuff  </div> 
```

打印预览以横向尺寸显示页面。这似乎在 IE 和 Chrome 上运行良好，未在 FF 上测试。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2019-11-27T13:32:34.270

我尝试了丹尼斯的回答并遇到了一些问题（在横向页面之后没有正确打印纵向页面），所以这是我的解决方案：

```
body {
  margin: 0;
  background: #CCCCCC;
}

div.page {
  margin: 10px auto;
  border: solid 1px black;
  display: block;
  page-break-after: always;
  width: 209mm;
  height: 296mm;
  overflow: hidden;
  background: white;
}

div.landscape-parent {
  width: 296mm;
  height: 209mm;
}

div.landscape {
  width: 296mm;
  height: 209mm;
}

div.content {
  padding: 10mm;
}

body,
div,
td {
  font-size: 13px;
  font-family: Verdana;
}

@media print {
  body {
    background: none;
  }
  div.page {
    width: 209mm;
    height: 296mm;
  }
  div.landscape {
    transform: rotate(270deg) translate(-296mm, 0);
    transform-origin: 0 0;
  }
  div.portrait,
  div.landscape,
  div.page {
    margin: 0;
    padding: 0;
    border: none;
    background: none;
  }
}
```

```
<div class="page">
  <div class="content">
    First page in Portrait mode
  </div>
</div>
<div class="page landscape-parent">
  <div class="landscape">
    <div class="content">
      Second page in Landscape mode (correctly shows horizontally in browser and prints rotated in printer)
    </div>
  </div>
</div>
<div class="page">
  <div class="content">
    Third page in Portrait mode
  </div>
</div>
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2021-05-02T19:23:28.930

这就是我想出的 - 为`<html>`元素添加负旋转和相等 abs 值的正旋转`<body>`。这样就不必添加大量的 CSS 来设置正文样式，而且它的作用就像一个魅力：

```
html { 
  transform: rotate(-90deg);
}

body { 
  transform: rotate(90deg);
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-11-10T16:24:28.770

我曾经试图解决这个问题，但我所有的研究都把我引向了 ActiveX 控件/插件。浏览器（无论如何是 3 年前）允许更改任何打印设置（份数、纸张大小）没有任何技巧。

我努力警告用户，当浏览器打印对话框出现时，他们需要选择“横向”。我还创建了一个“打印预览”页面，它比 IE6 的效果要好得多！我们的应用程序在一些报告中有非常宽的数据表，打印预览让用户清楚地知道表格何时会溢出纸张的右边缘（因为 IE6 也无法处理在 2 张纸上打印）。

是的，即使现在人们仍在使用 IE6。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-06-18T09:24:57.460

```
<style type="text/css" media="print">
.landscape { 
    width: 100%; 
    height: 100%; 
    margin: 0% 0% 0% 0%; filter: progid:DXImageTransform.Microsoft.BasicImage(Rotation=1); 
} 
</style> 
```

如果您希望将此样式应用于表格，则使用此样式类创建一个 div 标签，并在此 div 标签中添加 table 标签并在最后关闭 div 标签。

此表格将仅以横向模式打印，所有其他页面将仅以纵向模式打印。但问题是如果表格大小超过页面宽度，那么我们可能会丢失一些行，有时还会丢失标题。当心。

祝你有美好的一天。

谢谢你，纳文·梅塔帕利。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-11-24T13:15:17.587

```
-webkit-transform: rotate(-90deg); -moz-transform:rotate(-90deg);
     filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3); 
```

无法在 Firefox 16.0.2 中运行，但在 Chrome 中运行

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-07-25T07:15:17.427

这也对我有用：

```
@media print and (orientation:landscape) { … } 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-09-05T23:30:20.010

我遇到的问题可能和你一样。这里的每个人都使用 CSS 来静态提供它，但我不得不寻找一个动态的解决方案，以便它可以根据活动元素进行更改，而无需重新加载页面..

我创建了 2 个文件，portrait.css 和 Landscape.css。

Portrait.css 是空白的，但 Landscape.css 有一行。

```
@media print{@page {size: landscape}} 
```

在我的主文件中，我添加了这行 html 以将 Portrait.css 指定为默认值。

```
 <link rel="stylesheet" id="PRINTLAYOUT" href="portrait.css" type="text/css" /></link> 
```

现在，要切换，您只需更改元素中的 href 即可切换打印模式。

```
$("#PRINTLAYOUT").attr("href","landscape.css")
  // OR 
document.getElementById("PRINTLAYOUT").href = "landscape.css" // I think... 
```

这对我很有用，我希望它可以帮助其他像我一样艰难地做事的人。请注意，$ 代表 JQuery。如果您还没有使用它，我强烈建议您现在开始。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2019-11-06T10:03:49.273

您可以尝试以下方法：

```
@page {
    size: auto
} 
```

# java - 如何从 Java 中确定安装了哪个 .NET 框架

> ID：138425
> 
> 赞同：3
> 
> 时间：2008-09-26T09:16:09.467
> 
> 标签：java, .net-3.5

在我的 Java 程序中，我想确定系统上安装了哪个 .NET Framework。最好（也是最简单）的方法是什么？

**回答**谢谢scubabbl！它可以检查目录`System.getenv( "WINDIR" ) + "\\Microsoft.NET\\Framework"`中以字母“v”开头的目录。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T09:29:40.933

据我了解，c:\windows\Microsoft.Net\Framework 中的实际文件结构包含安装了 .Net 版本的文件夹。在我的计算机上，我有最高 v3.5 或 c:\windows\Microsoft.Net\Framework\v3.5 的文件夹。

这有很多问题，包括安全问题。

第二个可能更好的答案是检查 Windows 注册表。

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP

Version 键将具有您要查找的值。

编辑：关于使用 java 读取注册表的 stackoverflow 问题。 [使用 Java 读取/写入 Windows 注册表](https://stackoverflow.com/questions/62289/readwrite-to-windows-registry-using-java)

这个库[http://www.trustice.com/java/jnireg/](http://www.trustice.com/java/jnireg/)将允许您读取注册表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T15:58:15.987

检查目录结构并不是最好的方法。查看此[线程](https://stackoverflow.com/questions/199080/how-to-detect-what-net-framework-versions-and-service-packs-are-installed)以获取有关您需要评估的注册表项的完整详细信息。

# security - 检测 Web 应用程序攻击的最佳方法是什么？

> ID：138432
> 
> 赞同：1
> 
> 时间：2008-09-26T09:18:01.473
> 
> 标签：security, web-applications, exploit, denial-of-service

调查和检测不良用户行为或攻击（例如拒绝服务或对我的 Web 应用程序进行攻击）的最佳方法是什么？

我知道服务器的统计数据（如[Awstats](http://awstats.sourceforge.net/)）对于这种目的非常有用，特别是查看 3XX、4XX 和 5XX 错误（[这里是 Awstats 示例页面](http://www.nltechno.com/awstats/awstats.pl?config=destailleur.fr&framename=mainright#errors)），这些错误通常是机器人或恶意用户尝试众所周知的错误或格式错误的 URL .

是否有其他（和更好的）方法来分析和检测这种尝试性攻击？

注意：我说的是基于 URL 的攻击，而不是对服务器组件（如数据库或 TCP/IP）的攻击。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T09:30:02.180

记录一切。然后手动检查日志，找到不感兴趣的内容并编写一个解析器来丢弃这些日志条目。完成后，冲洗并重复，直到只剩下有趣的东西。现在您只有有趣的日志条目要阅读，决定哪些是危险的，哪些是无害但令人讨厌的，并根据需要进行修复。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T13:11:02.560

如果您有预算，请使用 Web 应用程序防火墙 (WAF)。这些是专门为识别和阻止应用层攻击而构建的。还有一些便宜的 WAF，甚至是开源的一两个。

但是请注意，您仍然应该练习安全编码等；WAF 非常适合深度防御和临时虚拟修补。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T09:36:55.703

我通常会编写自己的日志分析器，它会尝试跟踪通常在导航由*非*人类完成时发生的事件。喜欢：
直接访问 URL 或参数未知的页面
反馈表单在不到 10 秒内加载、编译和发布
错误的引荐来源序列 HTML 或发布字段中的“关键”字符序列等等......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T09:44:23.003

首先，您必须说明什么是或不是潜在的漏洞利用，有时 url 可能是有效请求，有时可能是 XSS 攻击。大量流量可能是 DDoS，也可能是在 slashdot 文章中提及的结果。

接下来，您可以查看各种类型的攻击的日志 - 例如 DDoS，您需要使用 IP 工具来检查（因为很多 DDoS 攻击是在非 Web 端口上进行的，例如 SYN 洪水）。

然后你想安装 mod_security 并为其设置一些规则（你可以在网上找到很多预定义的规则集）。这会读取请求并将其解析为常见或已知的攻击（例如包含 sql 或 html 类型文本的 url）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T09:31:52.673

整体网络较多，但 SATAN 非常好

[http://www.porcupine.org/satan/](http://www.porcupine.org/satan/)

SATAN 是帮助系统管理员的工具。它识别几个常见的与网络相关的安全问题，并在不实际利用它们的情况下报告这些问题。

# process - 如何找出当前的 Biztalk 主机进程

> ID：138441
> 
> 赞同：0
> 
> 时间：2008-09-26T09:20:52.013
> 
> 标签：process, biztalk

我想在运行时知道我当前的代码正在执行的几个可能的主机进程中的哪一个。主机进程已在 Biztalk 管理级别配置名称，但我需要从代码内部知道我所在的进程。

我没有找到任何受支持的方法来做到这一点，我什至一直在寻找不受支持的方法:-)

编辑：感谢 tomasr 的回答。我需要它主要用于记录/跟踪目的。不仅要显示运行 ode 的主机，还要确定适当的跟踪级别。

这也意味着，我需要在图书馆层面深入了解它，而且它必须很快。例如，我不能去获取调用堆栈来找出代码正在运行的顶级组件（编排、管道等）。

另一方面，我只能在单例构造函数中弄清楚一次。这将在每个 AppDomain 中调用一次，因此可能需要一些时间来查找。但我可能在那里没有非常有意义的调用堆栈，所以我们回到第一方：-/

Edit2：Biztalk 管理数据库必须包含我需要的信息。它知道哪些主机在哪个服务器上启动，以及（可能）这些主机进程的进程 ID。如果有人有一个指针，我可以在那里开始寻找，那也会对我有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T12:30:13.547

据我所知，没有任何“简单”的方法可以做到这一点。获取该信息的一种（有点倒退）方法是使用 ExplorerOM API 来查询管理配置数据并找出您正在执行的位置以及您正在运行的主机/处理程序。

例如，如果您从 PipelineComponent 执行此操作，您可以在消息上下文中查找端口名称，然后使用 ExplorerOM 进行查找。然后，使用它来查询与适配器关联的处理程序并从那里获取主机名。尽管您会查找完整的编排名称，但编排将是类似的东西。

出于好奇，您为什么需要这些信息？

# asp.net - SQL 报告服务 - 内存不足异常

> ID：138444
> 
> 赞同：0
> 
> 时间：2008-09-26T09:22:01.653
> 
> 标签：asp.net, sql, reporting-services

我的单个 SQL 表中有大约 10 条 lac 记录。我需要在我的记录中加载这么多记录。我需要知道这是否会加载。当我尝试加载以报告其显示内存不足异常时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T00:57:22.273

Reporting Services（以及 Cognos、Business Objects 和其他 BI 报表套件）通常在呈现在 OUTPUT 中具有数十万或数百万条记录的报表时遇到问题。大多数这些系统在将数据聚合成数万条记录时没有太大问题，但是一旦开始进入数十万或数百万条记录，就会遇到内存错误。

我的建议是不要将 Reporting Services 用于数十万行的报告。没有人会阅读报告中的所有行。哎呀，由于 65,556 行的限制，如果您尝试呈现到 Excel，大多数 BI 套件甚至不会输出报告。我建议将 SSIS 用于大型原始数据转储、Analysis Services 多维数据集，如果您希望允许用户在 Excel 中进行探索性的即席切片和切块分析，或者想办法将其分解为更小、更相关的数据，供用户使用一个人——意思是聚合或过滤到几百或几千行。

如果您必须使用报告服务并且希望将其用作将数据导入 Excel 的工具，那么您可以尝试通过订阅呈现为 CSV。同样，我建议只构建一个 SSIS 包来执行此操作，因为在输出数百万行 CSV 文件时不会出现内存问题。但是，如果您必须使用报告服务作为输出工具，那么通过使用内存最少的渲染方法来最小化内存成本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T09:24:12.507

除非您扩展您的问题，否则这是无法回答的。您使用什么语言？哪个报告生成框架？SQL 查询是什么样的？

**编辑：**啊，好的，Microsoft SQL Reporting Services。好吧，我敢肯定，它应该可以轻松处理对具有数百万个元组的表的查询。这完全取决于您如何构建查询，所以在您给我们之前，我们无法帮助您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T13:03:10.863

您是否要显示数以万计的记录？哪个用户会读到它？您是否尝试过安排和通过电子邮件发送报告？

# .net - 有没有办法在 Krypton Toolkit 中创建一个独立的 ButtonSpec？

> ID：138448
> 
> 赞同：2
> 
> 时间：2008-09-26T09:24:15.127
> 
> 标签：.net, user-interface, krypton-toolkit

我需要创建一个样式`ButtonSpec`与其类型设置为相同的按钮，`Context`有没有办法创建一个`ButtonSpec`不直接附加到另一个控件的按钮，或者我错过了另一个控件上的简单样式选项？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T09:33:50.377

您无法获得独立的 ButtonSpec，但您不需要。创建一个 KryptonButton，然后将 ButtonStyle 设置为 ButtonSpec，它将以与其他控件中存在的 ButtonSpec 相同的方式绘制。如果您需要在按下时显示 KryptonContextMenu，您可以使用 KryptonDropButton。

# c# - 如何将 Unicode 字符转换为其 ASCII 等效字符

> ID：138449
> 
> 赞同：14
> 
> 时间：2008-09-26T09:25:34.607
> 
> 标签：c#, .net, unicode, ascii

这是问题所在：

在 C# 中，我从旧的 ACCESS 数据库中获取信息。.NET 在将内容交给我之前将数据库的内容（在此问题中为字符串）转换为 Unicode。

如何将此 Unicode 字符串转换回它的 ASCII 等价物？

* * *

**编辑**
Unicode char 710 确实是 MODIFIER LETTER CIRCUMFLEX ACCENT。这里的问题更精确一点：

```
-> (Extended) ASCII 字符 ê (Extended ASCII 136) 被插入到数据库中。
 -> Access 或 .NET 中的读取组件将其转换为 U+02C6 U+0065
    （修饰符字母 CIRCUMFLEX ACCENT + 拉丁文小写字母 E）
 -> 我需要（扩展的）ASCII 字符 136。

```

* * *

这是我尝试过的（我现在明白为什么这不起作用......）：

```
string myInput = Convert.ToString(Convert.ToChar(710));
byte[] asBytes = Encoding.ASCII.GetBytes(myInput); 
```

但这不会导致 94 而是一个值为 63 的字节......
这是一个新的尝试，但它仍然不起作用：

```
byte[] bytes = Encoding.ASCII.GetBytes("ê"); 
```

* * *

**解决方案**
感谢[csgero](https://stackoverflow.com/questions/138449/how-to-convert-a-unicode-character-to-its-extended-ascii-equivalent#138579)和[bzlm](https://stackoverflow.com/questions/138449/how-to-convert-a-unicode-character-to-its-extended-ascii-equivalent#138583)指出正确的方向，我在[这里](https://stackoverflow.com/questions/138449/how-to-convert-a-unicode-character-to-its-ascii-equivalent#141816)解决了问题。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T20:37:17.027

好吧，让我们详细说明。csgero和[bzlm](https://stackoverflow.com/questions/138449/how-to-convert-a-unicode-character-to-its-extended-ascii-equivalent#138579)[都](https://stackoverflow.com/questions/138449/how-to-convert-a-unicode-character-to-its-extended-ascii-equivalent#138583)指向了正确的方向。

由于 blzm 的回复，我在 wiki 上查找了 Windows-1252 页面，发现它被称为代码页。[代码页面](http://en.wikipedia.org/wiki/Codepage)的维基百科文章说明了以下内容：

> 这些'<a href="http://en.wikipedia.org/wiki/Extended_ASCII" rel="nofollow noreferrer">扩展字符集'没有正式的标准；IBM 只是将这些变体称为代码页，就像它一直对 EBCDIC 编码的变体所做的那样。

这导致我进入代码页 437：

> n ASCII 兼容代码页，较低的 128 个字符保持其标准 US-ASCII 值，并且可以在较高的 128 个字符中提供不同的页面（或字符集）。例如，为北美市场制造的 DOS 计算机使用[代码页 437](http://en.wikipedia.org/wiki/Code_page_437)，其中包括法语、德语和其他一些欧洲语言所需的重音字符，以及一些图形画线字符。

所以，代码页 437 是我称之为“扩展 ASCII”的代码页，它的 ê 作为字符 136，所以我也查找了其他一些字符，它们看起来是正确的。

csgero 带有 Encoding.GetEncoding() 提示，我用它来创建以下语句来解决我的问题：

```
byte[] bytes = Encoding.GetEncoding(437).GetBytes("ê"); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T10:05:18.757

您不能在此处使用默认的 ASCII 编码 (Encoding.ASCII)，而必须使用 Encoding.GetEncoding(...) 使用适当的代码页创建编码。您可以尝试使用代码页 1252，它是 ISO 8859-1 的超集。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T10:06:11.810

ASCII 没有定义 ê；数字 136 来自 8 位编码（例如 Windows-1252）中的抑扬符数字。

在这种情况下，您能否验证带有抑扬符 (ê) 的小 e 实际上是应该存储在 Access 数据库中的内容？也许 U+02C6 U+0065 是转换错误的结果，其中输入实际上是一个 e*后跟*一个抑扬符，或者完全是其他东西。也许您的 Access 数据库中的数据已损坏，因为指定的编码与内容不匹配，在这种情况下，.NET 客户端可能会错误地解析数据（使用错误的解码器）。

如果在从数据库读取过程中确实引入了此错误，则粘贴一些代码或配置设置可能会有所帮助。

在[代码页 437](http://en.wikipedia.org/wiki/Code_page_437)中，字符编号 136 是带有抑扬符的 e。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T09:29:29.823

嗯……我不确定你指的是哪个角色。插入符号（“^”，CIRCUMFLEX ACCENT）在 ASCII 和 Unicode (U+005E) 中具有相同的代码。

/编辑：该死，我的错。710 (U+02C6) 实际上是修饰符字母 CIRCUMFLEX ACCENT。不幸的是，这个字符根本不是 ASCII 的一部分。它可能看起来像普通的插入符号，但它是一个不同的字符。简单的转换在这里无济于事。我不确定.NET 在从 Unicode 转换时是否支持类似字符的映射。不过值得调查。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T09:36:04.787

值 63 是问号，又名“我无法以 ASCII 显示此字符”。

# javascript - Javascript：如何重新加载整个框架集 onload() 事件，包括调用 Javascript 的框架

> ID：138457
> 
> 赞同：1
> 
> 时间：2008-09-26T09:29:01.353
> 
> 标签：javascript

有没有办法使用 Javascript onload() 事件重新加载整个框架集？

```
function logout() {
    /* ... */
    // reload entire frame
    top.location.reload();
}

<body onload="logout()"> 
```

这会导致所有框架重新加载，但调用它的框架的 URL 没有更改为框架集中指定的 URL。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T11:28:18.977

据我了解，您希望使用 <frame src="..."> 中所述的原始 URL 重新加载框架集中的每个框架。

这个小函数可以做到这一点（将其放入保存框架集的文档中）：

```
this.reloadChildFrames = function()
{
    var allFrames = document.getElementsByTagName("frame");
    for (var i = 0; i < allFrames.length; i++)
    {
        var f = allFrames[i];
        f.contentDocument.location = f.src;
    }
} 
```

然后，您可以从任何子框架中调用该函数：

```
top.reloadChildFrames() 
```

当然，这只有在所有帧都来自[同一个 origin](http://en.wikipedia.org/wiki/Same_origin_policy)时才有效。

# apache-flex - 将自定义皮肤和自定义类合并到 SWC

> ID：138458
> 
> 赞同：0
> 
> 时间：2008-09-26T09:29:08.093
> 
> 标签：apache-flex, actionscript-3, flexbuilder, swc

如果我有一个 *.as 文件，它是我的自定义组件，一个包含自定义组件外观的 SWC 类和一个告诉自定义类外观的 css 文件（引用 SWC 外观文件），我该如何设置库项目（使用 flexbuilder 3）生成一个包含所有内容的 SWC 文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T10:01:45.003

很抱歉回答我自己的问题，但我发现答案是我可以忽略 CSS 文件。确保带有皮肤的 SWC 位于库项目的库路径中，然后使用 embed metadata 标签引用它。

例如

```
[Embed(skinClass="My_Slider_trackSkin")]
    private var trackSkin : Class; 
```

然后只需使用设置样式，然后当您在另一个项目中加载组件时，它将默认为正确的皮肤。

```
this.setStyle('trackSkin', trackSkin); 
```

# c++ - 从工具栏获取 Internet Explorer 中当前页面的地址

> ID：138466
> 
> 赞同：0
> 
> 时间：2008-09-26T09:30:13.770
> 
> 标签：c++, internet-explorer, com, mfc, toolbar

我试图在 MFC 中为使用 COM 的 Internet Explorer 创建一个工具栏（钢筋中的工具带）。

是否可以从工具栏中获取当前查看页面的地址（即[https://stackoverflow.com/questions/ask](https://stackoverflow.com/questions/ask)在我的情况下:-)）？

如果是这样，我应该注意什么？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T09:45:42.530

您可以使用[IWebBrowser2::get_LocationURL 方法](http://msdn.microsoft.com/en-us/library/aa752130(VS.85).aspx)。

# c# - 在 wse 中使用自己的异常，而不仅仅是 SoapException

> ID：138477
> 
> 赞同：4
> 
> 时间：2008-09-26T09:33:53.263
> 
> 标签：c#, .net, wse

是否可以通过 Soap 将我自己开发的异常发送到使用 http.sys 的客户端？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-02-16T22:27:31.750

不幸的是，据我所知，答案是否定的。您不能在服务器端构建自己的自定义异常并期望通过 WSE 在客户端使用它们。我不能提供太多技术背景来解释原因（比如为什么 WSE 不允许这样做），但我确信我的答案，因为我对此进行了测试。

您可以使用提供的链接中描述的方法返回从 System.Web.Services.Protocols.SoapException 继承的自定义异常，但是您必须在客户端将异常捕获为 SoapException，因为您将无法捕获它作为自定义异常类型：http: [//msdn.microsoft.com/en-us/library/ms229064.aspx](http://msdn.microsoft.com/en-us/library/ms229064.aspx)

要重新创建测试以供您自己确认，请执行以下操作：

1.  创建一个测试异常类，随意调用它，并确保它遵循我上面提供的链接中描述的模式（提供了代码示例）。
2.  创建一个显式返回测试异常的 Web 方法，如下所示：

    ```
    'This is in VB.Net
    <WebMethod()> _
    Public Function ThrowTestSoapException() As TestSoapException
        Return New TestSoapException()
    End Function 
    ```

3.  尝试重新生成客户端的 WSE 库（使用 WseWsdl3.exe），您应该会收到类似这样的错误消息：“*错误：服务器不可用，请稍后再试*”

这是我在尝试创建自己的可转移自定义异常时所能得到的。同样，我唯一能做的就是返回一个继承自 SoapException 类的自定义异常，并在客户端将其作为 SoapException 捕获。[这与上面](http://msdn.microsoft.com/en-us/library/aa480592.aspx)“CheGueVerra”指出的链接中描述的方法相同。

回应 John Saunders 的上述评论：是的，如果*可能*的话，转到 WCF，WSE 确实已经过时了。由于这与我和其他提出这些问题的人有关，因此从 WSE 转变为 WCF 需要管理层的批准——所以我们中的一些人不能轻易地做出这些改变——即使我们非常想这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-19T19:57:57.483

是的，您可以抛出自己的异常。任何不是从 SoapException 派生的未捕获异常都将被 .NET 框架限制为 SoapException。如果您想控制 SoapException 的某些部分是如何形成的（例如，故障和细节部分），您可以从 SoapException 派生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-17T01:06:32.953

与它所基于的 ASMX 服务一样，WSE 几乎不支持 SOAP 故障。您可以返回它们（设置了 Detail 属性的 SoapException），但它们不会出现在 WSDL 中。如果由 WSE 客户端接收，它们将显示为 SoapException，而不是自定义异常类型。

WCF 确实完全支持客户端和服务器端的 SOAP 错误。

# sql-server - 如何使用 DateTime 执行 SQL NOT NULL？

> ID：138493
> 
> 赞同：18
> 
> 时间：2008-09-26T09:39:40.423
> 
> 标签：sql-server

如何处理 a`DateTime`和 a `NOT NULL`？

我想做这样的事情：

```
SELECT * FROM someTable WHERE thisDateTime IS NOT NULL 
```

但是怎么做？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-26T09:42:17.877

嗯，它有效吗？我刚测试过？

```
/****** Object:  Table [dbo].[DateTest]    Script Date: 09/26/2008 10:44:21 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DateTest](
    [Date1] [datetime] NULL,
    [Date2] [datetime] NOT NULL
) ON [PRIMARY]

GO
Insert into DateTest (Date1,Date2) VALUES (NULL,'1-Jan-2008')
Insert into DateTest (Date1,Date2) VALUES ('1-Jan-2008','1-Jan-2008')
Go
SELECT * FROM DateTest WHERE Date1 is not NULL
GO
SELECT * FROM DateTest WHERE Date2 is not NULL 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T16:51:46.973

只是为了排除一种可能性 - 它似乎与该`ANSI_NULLS`选项没有任何关系，因为它控制与 NULL 与`=`and`<>`运算符的比较。`IS [NOT] NULL`无论`ANSI_NULLS`is`ON`或`OFF`.

我还尝试使用 对 SQL Server 2005 进行此操作`isql`，因为`ANSI_NULLS`默认为`OFF`使用 DB-Library 时。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-04T07:51:46.903

我遇到了以下查询无法按预期工作的问题：

```
select 1 where getdate()<>null 
```

我们希望它显示 1，因为 getdate() 不返回 null。我想这与 SQL 未能将 null 转换为 datetime 并跳过该行有关！当然我们知道我们应该使用 IS 或 IS NOT 关键字来比较一个变量和 null 但是当比较两个参数时很难处理 null 的情况。作为一种解决方案，您可以创建自己的比较函数，如下所示：

```
CREATE FUNCTION [dbo].[fnCompareDates]
(
    @DateTime1 datetime,
    @DateTime2 datetime
)
RETURNS bit
AS
BEGIN
    if (@DateTime1 is null and @DateTime2 is null) return 1;
    if (@DateTime1 = @DateTime2) return 1;
    return 0
END 
```

并重新编写查询，如：

```
select 1 where dbo.fnCompareDates(getdate(),null)=0 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2020-06-17T20:45:29.197

SELECT * FROM Table where codtable not in (Select codtable from Table where fecha is null)

# ruby-on-rails - 在 Rails 中按日期范围生成报告

> ID：138496
> 
> 赞同：22
> 
> 时间：2008-09-26T09:42:26.407
> 
> 标签：ruby-on-rails, report, date-range

您将如何在 Rails 应用程序中按用户选择的日期范围生成报告？什么是最好的日期范围选择器？

响应 patrick 进行编辑：我正在寻找一些小部件和活动记录建议，但我真正好奇的是如何根据用户选择的日期从容地显示日期范围列表。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-26T11:14:41.210

我们是在这里问一个界面问题（即你想要一个小部件）还是一个 ActiveRecord 问题？

# 日期选择小部件

1) **默认 Rails 解决方案**：请参阅[此处](http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html)`date_select`的文档。

2） **使用插件**：为什么要写代码？我个人喜欢[CalendarDateSelect](http://code.google.com/p/calendardateselect/)插件，当我需要一个范围时使用一对吸盘。

3) **使 Javascript 小部件适应 Rails ：将 Yahoo UI 库 (YUI)** [Calendar](http://developer.yahoo.com/yui/calendar/)之类的东西（全是 Javascript）集成到 Rails 几乎是微不足道的。从 Rails 的角度来看，它只是填充`params[:start_date]`and的另一种方式`params[:end_date]`。YUI 日历具有对范围的原生支持。

# 从小部件中获取数据

1) **默认 Rails 解决方案** 请参阅[此处](http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html)`date_select`的文档。

```
#an application helper method you'll find helpful
#credit to http://blog.zerosum.org/2007/5/9/deconstructing-date_select

# Reconstruct a date object from date_select helper form params
def build_date_from_params(field_name, params)
  Date.new(params["#{field_name.to_s}(1i)"].to_i, 
       params["#{field_name.to_s}(2i)"].to_i, 
       params["#{field_name.to_s}(3i)"].to_i)
end

#goes into view
<%= date_select "report", "start_date", ... %>
<%= date_select "report", "end_date", ... %>    

#goes into controller -- add your own error handling/defaults, please!
report_start_date = build_date_from_params("start_date", params[:report])
report_end_date = build_date_from_params("end_date", params[:report]) 
```

2) **CalendarDateSelect**：与上面的很相似，只是具有更性感的可见 UI。

3) **调整 Javascript 小部件**：通常这意味着某些表单元素会将日期输入作为字符串。对你来说是个好消息，因为 Date.parse 是一些严肃的魔法。params[:some_form_element_name] 将由 Rails 为您初始化。

```
#goes in controller.  Please handle errors yourself -- Javascript != trusted input.
report_start_date = Date.parse(params[:report_start_date]) 
```

# 编写对 ActiveRecord 的调用

非常简单。

```
 #initialize start_date and end_date up here, by pulling from params probably
  @models = SomeModel.find(:all, :conditions => ['date >= ? and date <= ?',
    start_date, end_date])
  #do something with models 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T16:37:05.777

让 URL 参数控制所选记录的范围并不是一种非 RESTful 做法。在您的索引操作中，您可以执行 Patrick 建议的操作并执行以下操作：

```
 #initialize start_date and end_date up here, by pulling from params probably
  @models = SomeModel.find(:all, :conditions => ['date >= ? and date <= ?', params[:start_date], params[:end_date]]) 
```

然后在您的索引视图中，创建一个将 ?start_date=2008-01-01&end_date=2008-12-31 附加到 URL 的表单。请记住，它是用户提供的输入，所以要小心。如果您在 index 操作中将其放回屏幕上，请务必这样做：

```
Showing records starting on 
<%= h start_date %> 
and ending on 
<%= h end_date %> 
```

# windows - 使用“for”循环迭代目录中的所有文件

> ID：138497
> 
> 赞同：405
> 
> 时间：2008-09-26T09:42:34.160
> 
> 标签：windows, batch-file, for-loop, cmd

如何使用`for`循环遍历目录中的每个文件？

我怎么知道某个条目是一个目录还是只是一个文件？

* * *

## 回答 #1

> 赞同：560
> 
> 时间：2008-09-26T09:56:07.017

这列出了当前目录中的所有文件（并且只有文件）：

```
for /r %i in (*) do echo %i 
```

此外，如果您在批处理文件中运行该命令，则需要将 % 符号加倍。

```
for /r %%i in (*) do echo %%i 
```

（感谢@agnul）

* * *

## 回答 #2

> 赞同：237
> 
> 时间：2008-09-26T10:05:56.290

遍历...

*   ...当前目录中的文件：`for %f in (.\*) do @echo %f`
*   ...当前目录中的子目录：`for /D %s in (.\*) do @echo %s`
*   ...当前和所有子目录中的文件：`for /R %f in (.\*) do @echo %f`
*   ...当前和所有子目录中的子目录：`for /R /D %s in (.\*) do @echo %s`

不幸的是，我没有找到任何同时迭代文件和子目录的方法。

只需使用[cygwin](http://www.cygwin.com)及其 bash 即可获得更多功能。

除此之外：您是否注意到，MS Windows 的内置帮助是描述 cmd 命令行语法的绝佳资源？

也看看这里：[http ://technet.microsoft.com/en-us/library/bb490890.aspx](http://technet.microsoft.com/en-us/library/bb490890.aspx)

* * *

## 回答 #3

> 赞同：109
> 
> 时间：2016-05-10T13:54:52.587

**要遍历每个文件，一个 for 循环将起作用：**

`for %%f in (directory\path\*) do ( something_here )`

**就我而言，我还想要文件内容、名称等。**

*这导致了一些问题，我认为我的用例可能会有所帮助。这是一个循环，它从目录中的每个“.txt”文件中读取信息，并允许您对它做一些事情（例如 setx）。*

```
@ECHO OFF
setlocal enabledelayedexpansion
for %%f in (directory\path\*.txt) do (
  set /p val=<%%f
  echo "fullname: %%f"
  echo "name: %%~nf"
  echo "contents: !val!"
) 
```

*限制：val<=%%f 只会获取文件的第一行。

* * *

## 回答 #4

> 赞同：66
> 
> 时间：2008-09-26T11:52:44.870

`FOR`从命令行运行和从批处理文件运行之间存在细微差别。在批处理文件中，您需要`%`在每个变量引用前放置两个字符。

从命令行：

```
FOR %i IN (*) DO ECHO %i 
```

从批处理文件：

```
FOR %%i IN (*) DO ECHO %%i 
```

* * *

## 回答 #5

> 赞同：44
> 
> 时间：2009-07-07T13:02:22.050

这个 for 循环将列出目录中的所有文件。

```
pushd somedir
for /f "delims=" %%f in ('dir /b /a-d-h-s') do echo %%f
popd 
```

"delims=" 对于显示带有空格的长文件名很有用....

'/b" 仅显示名称，不显示大小日期等。

关于 dir 的 /a 参数需要了解的一些事情。

*   任何使用“/a”都会列出所有内容，包括隐藏属性和系统属性。
*   "/ad" 只会显示子目录，包括隐藏目录和系统目录。
*   “/ad”参数消除了具有“目录”属性的内容。
*   “/adhs”将显示所有内容，但具有“目录”、“隐藏”“系统”属性的条目。

如果您在命令行上使用它，请删除“%”。

希望这可以帮助。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-09-26T09:52:34.217

%1 引用传入的第一个参数，不能在迭代器中使用。

试试这个：

```
@echo off
for %%i in (*.*) do echo %%i 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2019-06-25T20:35:49.920

在找到此参考之前，我很难让 jop 的答案使用绝对路径：[https ://ss64.com/nt/for_r.html](https://ss64.com/nt/for_r.html)

以下示例循环遍历由绝对路径给出的目录中的所有文件。

```
For /R C:\absoulte\path\ %%G IN (*.*) do (
  Echo %%G
) 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2019-02-28T12:09:14.590

要**遍历**您可以使用的所有文件和文件夹

```
for /F "delims=" %%a in ('dir /b /s') do echo %%a 
```

要**遍历所有文件夹**而不是文件，那么您可以使用

```
for /F "delims=" %%a in ('dir /a:d /b /s') do echo %%a 
```

Where`/s`将以无限的深度提供整个目录树的所有结果。`/s`如果要遍历该文件夹的内容而不是其子文件夹，则可以跳过

## 在迭代中实现搜索

要**遍历特定的命名文件和文件夹**，您可以搜索名称并使用 for 循环进行迭代

```
for /F "delims=" %%a in ('dir "file or folder name" /b /s') do echo %%a 
```

要**遍历特定的命名文件夹/目录而不是文件**，然后`/AD`在同一命令中使用

```
for /F "delims=" %%a in ('dir "folder name" /b /AD /s') do echo %%a 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-26T09:48:12.433

```
for %1 in (*.*) do echo %1 
```

在 cmd 中尝试“帮助”以获得完整指南

这是 XP 命令的指南。[http://www.ss64.com/nt/](http://www.ss64.com/nt/)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2020-01-24T22:29:52.287

这是我在代码中的注释。

我只是在刷怪技能，所以请原谅任何明目张胆的错误。

我试图在用户需要的地方稍作修改，尽可能地编写一个多合一的解决方案。

**一些重要的注意事项：**如果您只想处理根目录文件和文件夹，只需将变量更改为`recursive`。`FALSE`否则，它会遍历所有文件夹和文件。

*C&C 最欢迎...*

```
@echo off
title %~nx0
chcp 65001 >NUL
set "dir=c:\users\%username%\desktop"
::
:: Recursive Loop routine - First Written by Ste on - 2020.01.24 - Rev 1
::
setlocal EnableDelayedExpansion
rem THIS IS A RECURSIVE SOLUTION [ALBEIT IF YOU CHANGE THE RECURSIVE TO FALSE, NO]
rem By removing the /s switch from the first loop if you want to loop through
rem the base folder only.
set recursive=TRUE
if %recursive% equ TRUE ( set recursive=/s ) else ( set recursive= )
endlocal & set recursive=%recursive%
cd /d %dir%
echo Directory %cd%
for %%F in ("*") do (echo    → %%F)                                 %= Loop through the current directory. =%
for /f "delims==" %%D in ('dir "%dir%" /ad /b %recursive%') do (    %= Loop through the sub-directories only if the recursive variable is TRUE. =%
  echo Directory %%D
  echo %recursive% | find "/s" >NUL 2>NUL && (
    pushd %%D
    cd /d %%D
    for /f "delims==" %%F in ('dir "*" /b') do (                      %= Then loop through each pushd' folder and work on the files and folders =%
      echo %%~aF | find /v "d" >NUL 2>NUL && (                        %= This will weed out the directories by checking their attributes for the lack of 'd' with the /v switch therefore you can now work on the files only. =%
      rem You can do stuff to your files here.
      rem Below are some examples of the info you can get by expanding the %%F variable.
      rem Uncomment one at a time to see the results.
      echo    → %%~F           &rem expands %%F removing any surrounding quotes (")
      rem echo    → %%~dF          &rem expands %%F to a drive letter only
      rem echo    → %%~fF          &rem expands %%F to a fully qualified path name
      rem echo    → %%~pF          &rem expands %%A to a path only
      rem echo    → %%~nF          &rem expands %%F to a file name only
      rem echo    → %%~xF          &rem expands %%F to a file extension only
      rem echo    → %%~sF          &rem expanded path contains short names only
      rem echo    → %%~aF          &rem expands %%F to file attributes of file
      rem echo    → %%~tF          &rem expands %%F to date/time of file
      rem echo    → %%~zF          &rem expands %%F to size of file
      rem echo    → %%~dpF         &rem expands %%F to a drive letter and path only
      rem echo    → %%~nxF         &rem expands %%F to a file name and extension only
      rem echo    → %%~fsF         &rem expands %%F to a full path name with short names only
      rem echo    → %%~dp$dir:F    &rem searches the directories listed in the 'dir' environment variable and expands %%F to the fully qualified name of the first one found. If the environment variable name is not defined or the file is not found by the search, then this modifier expands to the empty string
      rem echo    → %%~ftzaF       &rem expands %%F to a DIR like output line
      )
      )
    popd
    )
  )
echo/ & pause & cls 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-09-28T09:21:02.290

以下代码在当前目录中创建一个名为***“AllFilesInCurrentDirectorylist.txt”***的文件，其中包含当前目录中所有文件（Only Files）的列表。看看这个

```
dir /b /a-d > AllFilesInCurrentDirectorylist.txt 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-09-11T14:41:35.343

它也可以使用[forfiles](http://technet.microsoft.com/en-us/library/cc753551.aspx)命令：

```
forfiles /s 
```

并检查它是否是一个目录

```
forfiles /p c:\ /s /m *.* /c "cmd /c if @isdir==true echo @file is a directory" 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-26T09:56:26.670

我会使用 vbscript（Windows 脚本主机），因为在批处理中我确定您无法分辨名称是文件还是目录。

在 vbs 中，它可以是这样的：

```
Dim fileSystemObject
Set fileSystemObject = CreateObject("Scripting.FileSystemObject")

Dim mainFolder
Set mainFolder = fileSystemObject.GetFolder(myFolder)

Dim files
Set files = mainFolder.Files

For Each file in files
...
Next

Dim subFolders
Set subFolders = mainFolder.SubFolders

For Each folder in subFolders
...
Next 
```

检查[MSDN 上的 FileSystemObject](http://msdn.microsoft.com/en-us/library/d6dw7aeh(VS.85).aspx)。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-01-04T17:55:15.570

试试这个来测试一个文件是否是一个目录：

```
FOR /F "delims=" %I IN ('DIR /B /AD "filename" 2^>^&1 ^>NUL') DO IF "%I" == "File Not Found" ECHO Not a directory 
```

这只会告诉您文件是否不是目录，如果文件不存在，这也是正确的，因此如果需要，请务必先检查。插入符号 (^) 用于转义重定向符号，文件列表输出被重定向到 NUL 以防止显示，而 DIR 列表的错误输出被重定向到输出，因此您可以针对 DIR 的消息“找不到文件”进行测试”。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-12-29T19:27:55.680

我使用带有 /L 选项的 xcopy 命令来获取文件名。因此，如果您想获取一个目录或子目录中的所有文件，您可以执行以下操作：

```
for /f "delims=" %%a IN ('xcopy "D:\*.pdf" c:\ /l') do echo %%a 
```

我只是使用 c:\ 作为目标，因为它始终存在于 Windows 系统上并且它不会复制，所以没关系。如果您也想要子目录，请在最后使用 /s 选项。如果您出于其他原因需要它们，也可以使用 xcopy 的其他开关。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2016-12-02T10:38:32.220

试试这个：

```
::Example directory
set SetupDir=C:\Users

::Loop in the folder with "/r" to search in recursive folders, %%f being a loop ::variable 
for /r "%SetupDir%" %%f in (*.msi *.exe) do set /a counter+=1

echo there are %counter% files in your folder 
```

它计算您的目录（和子目录）中的 .msi 和 .exe 文件。因此，它也使文件夹和文件作为可执行文件有所不同。

如果您需要过滤循环中的其他文件，只需添加扩展名 (.pptx .docx ..)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-09-26T17:54:47.073

就我而言，我必须删除临时文件夹下的所有文件和文件夹。所以这就是我最终这样做的方式。我必须运行两个循环，一个用于文件，一个用于文件夹。如果文件或文件夹的名称中有空格，那么您必须使用“”

```
cd %USERPROFILE%\AppData\Local\Temp\
rem files only
for /r %%a in (*) do (
echo deleting file "%%a" ...
if exist "%%a" del /s /q "%%a"
)
rem folders only
for /D %%a in (*) do (
echo deleting folder "%%a" ...
if exist "%%a" rmdir /s /q "%%a"
) 
```

# sql-server - 将 nvarchar 列排序为整数

> ID：138501
> 
> 赞同：4
> 
> 时间：2008-09-26T09:43:21.023
> 
> 标签：sql-server, tsql, sorting

我在 nvarchar 列（单词和数字）中有混合数据。这是按数字顺序对该列中的数据进行排序的最快方法。

结果示例：

*   1
*   2
*   3
*   ...
*   10
*   11
*   ...
*   啊啊啊
*   aaab
*   b
*   巴
*   巴
*   ...

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T10:03:39.727

用这个：

```
ORDER BY
    CASE WHEN ISNUMERIC(column) = 1 THEN 0 ELSE 1 END,
    CASE WHEN ISNUMERIC(column) = 1 THEN CAST(column AS INT) ELSE 0 END,
    column 
```

这按预期工作。

* * *

**注意**：你说*最快的方式*。这个 sql 对我来说生成速度很快，但是执行计划显示了一个表扫描，然后是一个标量计算。这可能会产生一个临时结果，其中包含该列的所有值以及 ISNUMERIC 结果的一些额外临时列。执行起来可能并不快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T13:40:10.930

如果你用 0 填充你的数字并对其进行排序，你会得到你想要的结果。您需要确保填充的 0 的数量与 varchar 列的大小相匹配。

看看这个例子……

```
Declare @Temp Table(Data VarChar(20))

Insert Into @Temp Values('1')
Insert Into @Temp Values('2')
Insert Into @Temp Values('3')
Insert Into @Temp Values('10')
Insert Into @Temp Values('11')
Insert Into @Temp Values('aaaa')
Insert Into @Temp Values('aaab')
Insert Into @Temp Values('b')
Insert Into @Temp Values('ba')
Insert Into @Temp Values('ba')

Select * From @Temp
Order By Case When IsNumeric(Data) = 1 
              Then Right('0000000000000000000' + Data, 20) 
              Else Data End 
```

另请注意，在使用 case 语句时，case 语句的每个分支返回相同的数据类型很重要，否则您将得到不正确的结果或错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T10:02:44.143

--如果存在则检查
是否存在 (select * from dbo.sysobjects where [id] = object_id(N'dbo.t') AND objectproperty(id, N'IsUserTable') = 1)
drop table dbo.t
go

--create example table
create table dbo.t (c varchar(10) not null)
set nocount on

--populate示例表
插入 dbo.t (c) 值 ('1')
插入 dbo.t (c) 值 ('2')
插入 dbo.t (c) 值 ('3')
插入 dbo .t (c) values ('10')
插入到 dbo.t (c) values ('11')
插入到 dbo.t (c) values ('aaaa')
插入到 dbo.t (c) values (' aaab')
插入 dbo.t (c) 值 ('b')
插入 dbo.t (c) 值 ('ba')
插入 dbo.t (c) 值 ('ba')

--return the data
select c from dbo.t
order by case when isumeric(c) = 1 then 0 else 1 end,
case when isumeric(c) = 1 then cast(c as int) else 0 end,
c

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T09:53:47.957

您可以将数据视为字母数字或数字，而不是同时处理。我认为您尝试做的事情是不可能的，数据模型设置不正确。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-26T09:46:12.577

投吧。

```
SELECT * FROM foo ORDER BY CAST(somecolumn AS int); 
```

自从我接触 SQL Server 以来已经有一段时间了，所以我的语法可能完全不正确:)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-26T09:59:27.677

> 我不认为你想要做的事情是可能的

这个例子工作正常

```
SELECT * FROM TableName
ORDER BY CASE WHEN 1 = IsNumeric(ColumnName) THEN Cast(ColumnName AS INT) END 
```

结果是：

*   一种
*   b
*   C
*   ...
*   1
*   2
*   3

但我首先需要数字。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-26T13:51:56.500

这应该工作：

```
select * from Table order by ascii(Column) 
```

# python - 纯 Python XSLT 库

> ID：138502
> 
> 赞同：20
> 
> 时间：2008-09-26T09:43:43.287
> 
> 标签：python, xml, xslt

是否有纯 Python 的 XSLT 库？

在我需要支持的某些平台上，安装 libxml2+libxslt 或任何类似的 C 库是一个问题。

我真的只需要基本的 XSLT 支持，速度不是主要问题。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-26T21:13:59.540

不幸的是，目前没有纯 python XSLT 处理器。如果您需要更独立于平台的东西，您可能想要使用基于 Java 的 XSLT 处理器，例如[Saxon](http://saxon.sourceforge.net/)。4Suite 正在开发纯 python XPath 解析器，但看起来纯 XSLT 处理器在一段时间内不会出现。也许最好使用 Python 的一些功能来尝试和近似现有的样式表，或者研究使用 Java 代替的可行性。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-12-02T12:47:18.667

我不认为你可以在 cpython 中做到这一点：没有纯 python XSLT 实现。

但是您可以使用 JVM 的内置 XSLT API 在 jython 中轻松完成。我为在 Google AppEngine 上执行此操作的具体案例写了一篇博客文章，但是给出的代码在任何情况下都应该在 jython 下工作。

在 Google AppEngine 和 jython 上使用 XSLT 进行转换

[http://jython.xhaus.com/transforming-with-xslt-on-google-appengine-and-jython/](http://jython.xhaus.com/transforming-with-xslt-on-google-appengine-and-jython/)

高温下，

艾伦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T09:58:28.647

你看过[4suite](http://4suite.org/index.xhtml)吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T18:18:34.770

如果您只需要*基本*支持，并且您的 XML 不是太疯狂，请考虑从等式中删除 XSLT 元素并仅使用 DOM/SAX 解析器。

以下是来自[PythonInfo Wiki](http://wiki.python.org/)的一些信息：

> [DOM] 吸收整个 XML 文件，将其保存在内存中，并让您使用它。另一方面，Sax 在逐步通过文件时发出事件。

你怎么看？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-02-01T15:51:58.573

还有[http://lxml.de/](http://lxml.de/)

> “lxml 是功能最丰富且易于使用的库，用于处理 Python 语言中的 XML 和 HTML。”

# excel - 启用旧 VBA 应用程序的最简单快捷的 Web 方式

> ID：138506
> 
> 赞同：1
> 
> 时间：2008-09-26T09:46:11.377
> 
> 标签：excel, worksheet, vba

给定一个小型 Excel VBA 应用程序（单个表单，将少量记录保存在单个工作表中）在工作站本地运行得非常愉快，那么在 Web 上提供相同应用程序的最简单和最快的方法是什么？重写应用程序是一种选择，但我认为值得检查是否有更快的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T09:58:32.297

如果您的业务逻辑与 GUI 代码完全分离，您可以尝试将其包装为 OLE 自动化对象（我认为在 VB6 中称为 COM 对象），然后在基于 ASP 的 Web 应用程序中使用该对象。ASP 部分将使用 VBScript 编写并使用 COM 对象进行计算。

这里的问题是，通常的 VBA 开发风格将 GUI 代码和业务逻辑混合在同一个子例程中，因此将它们分开并用 ASP 页面替换 GUI 比从头重写更麻烦。

还有另一种使用 VB6 编写 Web 应用程序的方法，称为 Webclasses，但我不推荐它。

# php - MVC，课程去哪儿了？

> ID：138508
> 
> 赞同：6
> 
> 时间：2008-09-26T09:46:15.837
> 
> 标签：php, model-view-controller, oop

我对 MVC 的理解如下（以防它非常错误，我毕竟是新手）

1.  模型是与数据库交互的东西
2.  视图是页面的设计/布局
3.  控制器是一切开始的地方，本质上是页面逻辑

我正在使用[CodeIgniter](http://codeigniter.com/)，但我会冒险猜测它不仅限于此，甚至可能仅限于 PHP 框架。

我在哪里放置全球课程？

我可能有一个 Products 模型，然后我运行一个从数据库中收集 20 个产品的查询。我现在是制作 20 个模型还是应该有一个单独的类，如果是后者，我应该把这个类放在哪里（其他控制器也需要使用它）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T10:08:51.133

在讨论如何处理产品时，模型是一个错误的词：每个产品都是一个**价值对象 (VO)**（或数据传输对象/DTO，任何更适合您的词）。值对象通常具有与表相同的字段。在您的情况下 ProductVO 应该具有 Products 表中的字段。

模型是一个**数据访问对象 (DAO)**，它具有类似的方法

```
findByPk --> returns a single value object
findAll --> returns a collection of value objects (0-n)
etc. 
```

在您的情况下，您将拥有一个具有上述方法的 ProductDAO。然后，此 ProductDAO 将返回 ProductVO 和它们的集合。

数据访问对象还可以返回**业务对象 (BO)**，其中可能包含多个 VO 和特定于业务案例的附加方法。

附录：在您的控制器中，您调用 ProductDAO 来查找您想要的产品。然后将返回的 ProductVO(s) 传递给视图（在 Java 中作为请求属性）。然后视图循环/显示来自 productVO 的数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T10:08:54.363

**模型**是发生业务逻辑的应用程序的一部分。模型表示对象之间的现实关系和依赖关系，例如：员工向经理报告，经理监督许多员工，经理可以将任务分配给员工，任务在过期时发出通知。模型 CAN 和最常见的 DO 与数据库接口，但这不是必需的。

**视图**基本上是所有可以显示或帮助显示的东西。视图包含模板、模板对象、处理模板组合和嵌套、用页眉和页脚包装，并以一种众所周知的格式（X/HTML，还有 XML、RSS/Atom、CSV）生成输出。

**控制器**是将用户操作转换为模型操作的转换层。换句话说，它告诉模型该做什么并返回一个响应。Controller方法尽量小，所有业务处理都在Model中，视图逻辑处理在View中。

现在，回到你的问题。这真的取决于您是否需要为每个产品单独分类。在大多数情况下，一个类就足够了，应该创建它的 20 个实例。由于产品代表业务逻辑，它应该属于应用程序的模型部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T09:53:59.267

在[CakePHP](http://cakephp.org)中还有 3 个“部分”：

1.  行为
2.  组件
3.  帮手

许多模型使用的逻辑应该作为一种行为。我不知道 CodeIgniter 是否有这个逻辑，但如果没有，我会尝试这样实现。[您可以在此处](http://book.cakephp.org/view/88/Behaviors)阅读有关行为的信息。

（组件帮助控制器共享逻辑，帮助器以同样的方式帮助视图）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T11:05:44.617

最简单的方法是：

1.  每个数据库表都有一个模型类。在这种情况下，它将是一个包含所有产品详细信息的对象。
2.  将这些类放入包/命名空间，例如 com.company.model (Java / C#)
3.  将 DAO 类放入像 com.company.model.dao 这样的包中
4.  您的视图将使用来自会话/请求/控制器的数据。在这种情况下，我将有一个 List<Product>。
5.  哦，你正在使用 PHP。不知道这会如何改变事情，但我想它有一个集合框架，就像任何现代语言一样。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T12:30:22.953

@Alexander 提到了 CakePHPs *Behaviors*、*Components*和*Helpers*。这些对于抽象出通用功能非常有用。我发现行为特别有用，因为大部分业务逻辑都包含在模型中。我目前正在从事一个项目，我们的行为如下：

*   可锁定
*   可发布
*   可标记的
*   可评价的
*   可评论的

等等

对于甚至超越 MVC 框架的代码，即代码库，您用于各种与您正在使用的特定框架无关的东西——在我们的例子中，像视频编码类等。CakePHP 有*供应商*文件夹。

任何与 CakePHP 无关的东西都在里面。

我怀疑 CodeIgniter 的结构没有那么灵活，它比 CakePHP 更小更轻，但快速查看[CakePHP 手册](http://manual.cakephp.org)，了解 Behaviors、Components、Helper 和 Vendors 文件夹可能会有所帮助。

[只在模型中包含一些常见的帮助类保持良好和干燥](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)应该是一件容易的事

# java - 要设置哪些 Java 命令行选项以允许远程调试 JVM？

> ID：138511
> 
> 赞同：352
> 
> 时间：2008-09-26T09:47:29.687
> 
> 标签：java, debugging

我知道有一些`JAVA_OPTS`设置可以远程调试 Java 程序。

它们是什么，它们是什么意思？

* * *

## 回答 #1

> 赞同：485
> 
> 时间：2008-10-06T07:19:17.737

在 Java 5.0 之前，使用`-Xdebug`和`-Xrunjdwp`参数。这些选项在以后的版本中仍然有效，但它将以解释模式而不是 JIT 模式运行，这会更慢。

从 Java 5.0 开始，最好使用`-agentlib:jdwp`单一选项：

```
-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=1044 
```

`-Xrunjdwp`或`agentlib:jdwp`参数的选项是：

*   `transport=dt_socket`: 表示连接JVM的方式（socket是个不错的选择，可以用来调试远程电脑）
*   `address=8000`: TCP/IP 端口暴露，从调试器连接，
*   `suspend=y`：如果是'y'，告诉JVM等待调试器连接开始执行，否则（如果'n'），立即开始执行。

* * *

## 回答 #2

> 赞同：342
> 
> 时间：2008-09-26T09:50:32.020

我为 Java 5 及更低版本设置了[这篇文章的书签。](http://www.eclipsezone.com/eclipse/forums/t53459.html)

基本上[运行它](http://download.oracle.com/otn_hosted_doc/jdeveloper/904preview/jdk14doc/docs/tooldocs/windows/jdb.html)：

```
-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1044 
```

对于[Java 5 及更高版本](http://javahowto.blogspot.ru/2010/09/java-agentlibjdwp-for-attaching.html)，运行它：

```
-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=1044 
```

* * *

## 回答 #3

> 赞同：97
> 
> 时间：2018-01-23T08:17:04.723

由于 Java 9.0 JDWP 默认只支持本地连接。 [http://www.oracle.com/technetwork/java/javase/9​​-notes-3745703.html#JDK-8041435](http://www.oracle.com/technetwork/java/javase/9-notes-3745703.html#JDK-8041435)

对于远程调试，应使用以下地址运行程序`*:`：

```
-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2016-10-28T13:34:51.760

对于 java 1.5 或更高版本：

```
java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 <YourAppName> 
```

对于 Java 1.4：

```
java -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005 <YourAppName> 
```

对于 Java 1.3：

```
java -Xnoagent -Djava.compiler=NONE -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005 <YourAppName> 
```

这是一个简单程序的输出：

```
java -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1044 HelloWhirled
Listening for transport dt_socket at address: 1044
Hello whirled 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2018-03-30T06:28:26.213

### 爪哇

```
java -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=8001,suspend=y -jar target/cxf-boot-simple-0.0.1-SNAPSHOT.jar 
```

`address`指定允许调试的端口

### 马文

**使用 Maven 调试 Spring Boot 应用程序：

```
mvn spring-boot:run -Drun.jvmArguments=**"-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8001" 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-02-25T11:15:15.353

## 命令行

```
-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=PORT_NUMBER 
```

## 摇篮

```
gradle bootrun --debug-jvm 
```

## 马文

```
mvn spring-boot:run -Drun.jvmArguments="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=PORT_NUMBER 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-09-20T18:38:49.763

这是最简单的解决方案。

如果您使用 Maven，则需要进行很多环境特殊配置。因此，如果您从 maven 启动程序，只需运行`mvnDebug`命令而不是`mvn`，它将负责启动您的应用程序并配置远程调试。现在您可以在端口 8000 上附加一个调试器。

它将为您解决所有环境问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-01-24T09:19:13.677

```
-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=PORT_NUMBER 
```

这里我们只使用了一个 Socket Attaching Connector，它在配置了 dt_socket 传输并且 VM 在服务器调试模式下运行时默认启用。

有关更多详细信息，您可以参考：[https ://stackify.com/java-remote-debugging/](https://stackify.com/java-remote-debugging/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-11-18T07:02:48.270

如果您使用 java 9 或更高版本，要远程调试（在本地使用 docker 时也是如此），您必须提供`--debug *:($port)`. 因为从 java 9`--debug ($port)`开始只允许***在本地调试，而不是远程***调试。

因此，您可以在 docker-compose 中提供命令，例如 `command: -- /opt/jboss/wildfly/bin/standalone.sh --debug *:8787`

# asp.net - 如何动态设置 ValidationGroup

> ID：138514
> 
> 赞同：2
> 
> 时间：2008-09-26T09:48:37.890
> 
> 标签：asp.net, validation, validationsummary

我有一个带有 2 个用户控件 (.ascx) 的 ASP.NET 2.0 网页。每个 UserControl 都包含一堆验证器。在页面上放置 ValidationSummary 将显示两个 UserControl 的所有验证错误。在每个 UserControl 中放置一个 ValidationSummary 将显示两个控件的所有错误两次。

我想要的是每个 UserControl 的 ValidationSummary，只显示该 UserControl 上的错误。

我试图通过在每个用户控件上动态设置验证器的 ValidationGroup 属性来解决这个问题。这样每个验证摘要应该只显示其用户控件的错误。我用过这段代码：

```
foreach (Control ctrl in this.Controls)
{
    if (ctrl is BaseValidator)
    {
        (ctrl as BaseValidator).ValidationGroup = this.ClientID;
    }
}
ValidationSummary1.ValidationGroup = this.ClientID; 
```

然而，这似乎禁用了客户端和服务器端验证，因为提交表单时不会发生验证。

帮助？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T10:01:25.630

导致表单提交的控件（即 Button 控件）必须与任何 ValidationSummary 和 *Validator 控件属于同一验证组。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T12:27:11.353

如果您使用 ValidationGroups，则仅当导致回发的控件分配给相同的 ValidationGroup 时才会发生验证。

如果您想使用单个控件回发，您仍然可以这样做，但您需要显式调用 Page.Validate 方法。

```
Page.Validate(MyValidationGroup1);
Page.Validate(MyValidationGroup2);
if(Page.IsValid)
{
    //do stuff
} 
```

建议：为什么不在用户控件上公开一个名为 ValidationGroup 的公共属性？在 setter 中，您可以为每个验证器显式设置验证组。您也可以使用您的循环，但明确设置每个验证器会更有效。这可能会提高使用用户控件的代码的可读性。

# .net - WinForms 或 WPF 的文本差异可视化控件

> ID：138515
> 
> 赞同：22
> 
> 时间：2008-09-26T09:48:39.153
> 
> 标签：.net, diff, custom-controls

继续我[上一个问题](https://stackoverflow.com/questions/138331/any-decent-text-diffmerge-engine-for-net)，文本差异可视化有什么好的控件吗？

类似于 StackOverflow 的修订差异查看器，但适用于 WinForms 或 WPF

要求：

*   免费，最好是开源的
*   基于 WPF 或 WinForms

请不要应用程序，只有组件。

**我对 OSS 差异工具不感兴趣**

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-01-31T00:37:55.823

有（作为 GitSharp 的一部分）在 c# 中具有非常易于使用的 API 的开源差异引擎和（作为 GitSharp.Demo 的一部分）WPF 差异查看器。从项目中提取代码应该不会太难。

在此处查找更多信息：http: [//www.eqqon.com/index.php/GitSharp#GitSharp.Demo](http://www.eqqon.com/index.php/GitSharp#GitSharp.Demo)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-07-13T12:50:31.377

可能还想看看[MeneesDiffUtils](http://www.menees.com/DotNet.htm "MeneesDiffUtils")。有一堆与差异相关的实用程序，包括可视化控件。提供了完整的源代码，并在名为 CharityWare 的许可下。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-27T14:34:09.403

我从未听说过用于差异可视化的特定 .NET 组件（这是一种利基），但也许您可以依靠高级编辑器来构建您自己的组件而不会太麻烦。

Syncfusion 提出了一个专门用于文本/代码版本的[完整组件套件](http://www.syncfusion.com/products/edit/windows/features/default.aspx)，其中包含许多您可能会觉得有用的内置功能：

*   [线条和选择背景](http://www.syncfusion.com/products/edit/windows/features/Advanced_Editor_Functions/Line_and_Selection_Background.aspx)
*   [文本突出显示](http://www.syncfusion.com/products/edit/windows/features/Advanced_Editor_Functions/Text_Highlighting.aspx)（彩色下划线、波浪线、边框、罢工等）
*   [选择边距](http://www.syncfusion.com/products/edit/windows/features/Advanced_Editor_Functions/Selection_Margin.aspx)
*   [文本选择](http://www.syncfusion.com/products/edit/windows/features/Advanced_Editor_Functions/Text_Selection.aspx)
*   [语法高亮](http://www.syncfusion.com/products/edit/windows/features/Syntax_Highlighting_and_Code_Coloring/Syntax_Highlighting.aspx)

重要提示：它**不是**免费的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-07-22T15:46:50.670

我推荐[DiffPlex](https://github.com/mmanela/diffplex)。它的`netstandard1.0`重量很轻。

您可以使用以下方法轻松地将其嵌入到您的 WPF 应用程序中`RichTextBox`：[https ://github.com/halllo/WpfDiff](https://github.com/halllo/WpfDiff)

# python - 将Python编译成机器码可行吗？

> ID：138521
> 
> 赞同：145
> 
> 时间：2008-09-26T09:51:51.907
> 
> 标签：python, c, linker, compilation

将 Python（可能通过中间 C 表示）编译成机器代码有多可行？

据推测，它需要链接到 Python 运行时库，并且 Python 标准库的任何部分本身就是 Python 也需要编译（和链接）。

此外，如果您想对表达式进行动态评估，则需要捆绑 Python 解释器，但也许不允许这样做的 Python 子集仍然有用。

它会提供任何速度和/或内存使用优势吗？大概 Python 解释器的启动时间将被消除（尽管共享库仍需要在启动时加载）。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-26T10:06:43.200

正如@Greg Hewgill 所说，这并非总是可能的，这是有充分理由的。但是，某些类型的代码（例如非常算法代码）可以变成“真正的”机器代码。

有几种选择：

*   使用[Psyco](http://psyco.sourceforge.net/)，它动态地发出机器代码。不过，您应该仔细选择要转换的方法/功能。
*   使用[Cython](http://cython.org/)，这是一种*类似*Python 的语言，被编译成 Python C 扩展
*   使用[PyPy](http://pypy.org)，它有一个从 RPython（Python 的一个*受限子集*，不支持 Python 的一些最“动态”特性）到 C 或 LLVM 的翻译器。
    *   PyPy 仍然是高度实验性的
    *   并非所有扩展都会出现

之后，您可以使用现有软件包之一（freeze、Py2exe、PyInstaller）将所有内容放入一个二进制文件中。

总而言之：您的问题没有通用答案。如果您的 Python 代码对性能至关重要，请尝试使用尽可能多的内置功能（或询问“如何使我的 Python 代码更快”的问题）。如果这没有帮助，请尝试识别代码并将其移植到 C（或 Cython）并使用扩展。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-09-26T10:00:15.553

尝试[ShedSkin](https://shedskin.readthedocs.io/en/latest/) Python-to-C++ 编译器，但它远非完美。如果只需要加速，还有 Psyco - Python JIT。但恕我直言，这是不值得的努力。对于代码的速度关键部分，最好的解决方案是将它们编写为 C/C++ 扩展。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2014-04-09T03:52:37.577

[Nuitka](http://www.nuitka.net/)是一个链接到 libpython 的 Python 到 C++ 编译器。这似乎是一个相对较新的项目。作者声称在 pystone 基准测试中[速度比 CPython 有所提高。](http://www.nuitka.net/pages/overview.html)

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-26T10:06:06.680

[PyPy](https://pypy.org/)是一个在 Python 中重新实现 Python 的项目，使用编译为本机代码作为实现策略之一（其他是带有 JIT 的 VM，使用 JVM 等）。他们编译的 C 版本的平均运行速度比 CPython 慢，但对于某些程序来说要快得多。

[Shedskin](http://code.google.com/p/shedskin/)是一个实验性的 Python 到 C++ 编译器。

[Pyrex](http://www.cosc.canterbury.ac.nz/greg.ewing/python/Pyrex/version/Doc/About.html)是一种专门为编写 Python 扩展模块而设计的语言。它旨在弥合 Python 的漂亮、高级、易于使用的世界与杂乱、低级的 C 世界之间的鸿沟。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-26T10:06:46.413

[Pyrex](http://www.cosc.canterbury.ac.nz/greg.ewing/python/Pyrex/)是编译成 C 的 Python 语言的一个子集，由第一个为 Python构建[列表解析的人完成。](http://www.secnetix.de/olli/Python/list_comprehensions.hawk)它主要是为构建包装器而开发的，但可以在更一般的环境中使用。 [Cython](http://cython.org/)是 pyrex 的一个更积极维护的分支。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-08-30T06:27:35.510

一些额外的参考：

*   [https://github.com/dropbox/pyston](https://github.com/dropbox/pyston)是 Dropbox 开发的 Python 的 JIT 编译器

*   [http://pythran.readthedocs.io/](http://pythran.readthedocs.io/)是用于科学计算的编译时 python 到 C++ 转换器

*   [https://github.com/cosmo-ethz/hope](https://github.com/cosmo-ethz/hope)是一个用于科学计算的 JIT python 到 C++ 的翻译器

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T10:00:16.740

Jython 有一个针对 JVM 字节码的编译器。字节码是完全动态的，就像 Python 语言本身一样！很酷。（是的，正如 Greg Hewgill 的回答所暗示的，字节码确实使用 Jython 运行时，因此 Jython jar 文件必须与您的应用程序一起分发。）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T09:59:12.297

[Psyco](http://psyco.sourceforge.net/)是一种即时 (JIT) 编译器：适用于 Python 的动态编译器，代码运行速度快 2-100 倍，但它需要大量内存。

简而言之：它可以更快地运行您现有的 Python 软件，而您的源代码没有任何变化，但它不会像 C 编译器那样编译为目标代码。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-26T10:14:09.843

答案是“是的，有可能”。您可以获取 Python 代码并尝试使用 CPython API 将其编译为等效的 C 代码。事实上，曾经有一个 Python2C 项目就是这样做的，但我已经很多年没有听说过它了（回到 Python 1.5 天是我最后一次看到它的时候。）

您可以尝试将 Python 代码尽可能多地转换为原生 C，并在需要实际 Python 功能时回退到 CPython API。在过去的一两个月里，我自己一直在玩弄这个想法。然而，这是一项非常大量的工作，而且大量 Python 特性很难翻译成 C：嵌套函数、生成器、除了具有简单方法的简单类之外的任何东西，任何涉及从模块外部修改模块全局变量的东西等等， ETC。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-05-11T19:29:38.003

这不会将 Python 编译为机器代码。但允许创建一个共享库来调用 Python 代码。

如果您正在寻找的是一种从 C 运行 Python 代码而不依赖 execp 的简单方法。您可以从 python 代码生成一个共享库，其中包含对[Python 嵌入 API](https://docs.python.org/2.7/c-api/intro.html#embedding-python)的一些调用。好吧，该应用程序是一个共享库，一个 .so 您可以在许多其他库/应用程序中使用。

这是一个创建共享库的简单示例，您可以将其与 C 程序链接。共享库执行 Python 代码。

将执行的python文件是`pythoncalledfromc.py`：

```
# -*- encoding:utf-8 -*-
# this file must be named "pythoncalledfrom.py"

def main(string):  # args must a string
    print "python is called from c"
    print "string sent by «c» code is:"
    print string
    print "end of «c» code input"
    return 0xc0c4  # return something 
```

你可以用`python2 -c "import pythoncalledfromc; pythoncalledfromc.main('HELLO')`. 它将输出：

```
python is called from c
string sent by «c» code is:
HELLO
end of «c» code input 
```

共享库将由以下定义`callpython.h`：

```
#ifndef CALL_PYTHON
#define CALL_PYTHON

void callpython_init(void);
int callpython(char ** arguments);
void callpython_finalize(void);

#endif 
```

相关`callpython.c`的是：

```
// gcc `python2.7-config --ldflags` `python2.7-config --cflags` callpython.c -lpython2.7 -shared -fPIC -o callpython.so

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <python2.7/Python.h>

#include "callpython.h"

#define PYTHON_EXEC_STRING_LENGTH 52
#define PYTHON_EXEC_STRING "import pythoncalledfromc; pythoncalledfromc.main(\"%s\")"

void callpython_init(void) {
     Py_Initialize();
}

int callpython(char ** arguments) {
  int arguments_string_size = (int) strlen(*arguments);
  char * python_script_to_execute = malloc(arguments_string_size + PYTHON_EXEC_STRING_LENGTH);
  PyObject *__main__, *locals;
  PyObject * result = NULL;

  if (python_script_to_execute == NULL)
    return -1;

  __main__ = PyImport_AddModule("__main__");
  if (__main__ == NULL)
    return -1;

  locals = PyModule_GetDict(__main__);

  sprintf(python_script_to_execute, PYTHON_EXEC_STRING, *arguments);
  result = PyRun_String(python_script_to_execute, Py_file_input, locals, locals);
  if(result == NULL)
    return -1;
  return 0;
}

void callpython_finalize(void) {
  Py_Finalize();
} 
```

您可以使用以下命令编译它：

```
gcc `python2.7-config --ldflags` `python2.7-config --cflags` callpython.c -lpython2.7 -shared -fPIC -o callpython.so 
```

创建一个名为的文件`callpythonfromc.c`，其中包含以下内容：

```
#include "callpython.h"

int main(void) {
  char * example = "HELLO";
  callpython_init();
  callpython(&example);
  callpython_finalize();
  return 0;
} 
```

编译并运行：

```
gcc callpythonfromc.c callpython.so -o callpythonfromc
PYTHONPATH=`pwd` LD_LIBRARY_PATH=`pwd` ./callpythonfromc 
```

这是一个非常基本的例子。它可以工作，但根据库的不同，将 C 数据结构序列化为 Python 以及从 Python 序列化为 C 可能仍然很困难。事情可以在某种程度上自动化......

[Nuitka](https://stackoverflow.com/questions/138521/is-it-feasible-to-compile-python-to-machine-code/23596973#23596973)可能会有所帮助。

还有[numba](http://numba.pydata.org/)，但他们都不打算完全按照您的意愿行事。从 Python 代码生成 C 标头是可能的，但前提是您指定如何将 Python 类型转换为 C 类型或可以推断该信息。有关 Python ast 分析器的信息，请参阅[python astroid](https://bitbucket.org/logilab/astroid)。

# java - Java Swing: Ctrl+F1 不能全局工作，但是互相组合键

> ID：138533
> 
> 赞同：4
> 
> 时间：2008-09-26T09:55:29.247
> 
> 标签：java, swing, keyevent

我在北部有一个带有选项卡式窗格的摇摆 gui。几个关键事件被添加到它的输入映射中：

```
InputMap paneInputMap = pane.getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);
paneInputMap.put( KeyStroke.getKeyStroke( KeyEvent.VK_E, KeyEvent.CTRL_MASK ), "finish");
paneInputMap.put( KeyStroke.getKeyStroke( KeyEvent.VK_F1, KeyEvent.CTRL_MASK ), "toggletoolbar"); 
```

如果工具栏中的选项卡式窗格或其他按钮具有焦点，则`Ctrl`+`F1`不起作用。如果另一个组件被聚焦（例如 JTree），`Ctrl`+`F1`执行动作。

问题是，如果我将 Keycode 更改为 eg ，它在任何地方都可以使用`VK_F2`。

密钥`F1`在程序的其他任何地方都没有使用。

任何的想法？

谢谢，安德烈

**编辑：** java源代码中的全文搜索给出了答案：如果按下组合键，则`ToolTipManager`注册键`Ctrl`+以显示工具提示文本。`F1`因此，如果带有工具提示的按钮获得焦点，`Ctrl`+`F1`将由`ToolTipManager`. 否则我的动作被调用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T11:06:25.503

为了得到答案，这是从您在问题中的编辑中复制的解决方案。;-)

> ToolTipManager 注册 Key `Ctrl`+`F1`以在按下组合键时显示工具提示文本。因此，如果带有工具提示的按钮获得焦点， `Ctrl`+`F1`将由 ToolTipManager 处理。否则我的动作被调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T10:40:57.330

操作系统可能会重新定位`F1`关键吗？安装一个关键监听器并查看处理了哪些事件。

顺便说一句：如果您可以编辑您的问题并插入一些可测试的代码，那将会有所帮助。

# sql-server - 无法使用高级服务查看 SQL Server 2008 中的全文目录

> ID：138547
> 
> 赞同：1
> 
> 时间：2008-09-26T09:58:37.913
> 
> 标签：sql-server, full-text-search

我在我的 Vista Home Premium 上使用带有高级服务的 SQL Server 2008。我在安装过程中安装了全文搜索，SQL 全文过滤器守护程序启动器正在通过管理员用户帐户运行。当我通过 SQL Server Management Studio 访问数据库时，在数据库下看不到“存储”选项，因此无法创建/编辑全文目录。

我能够通过 T-SQL 创建全文目录，并且可以对我在数据库中选择的列运行全文搜索。我只是看不到“存储”选项。

知道缺少什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T18:03:21.447

好的，答案是：

SQL Management Studio Basic 不支持全文目录。只能通过 T-SQL 创建目录。[这是将来可能添加的功能](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3912985&SiteID=1)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-08T05:12:32.513

第一的，

```
EXEC sp_fulltext_database 'enable';
GO 
```

然后，

```
CREATE FULLTEXT CATALOG ftcatalog;
GO 
```

然后，

```
CREATE FULLTEXT INDEX ON dbo.Tablename ( Column )
 KEY INDEX PK_PriKeyIndex
 ON ftcatalog
 WITH CHANGE_TRACKING AUTO
GO 
```

# installation - 如何使用 WiX 安装程序注册文件类型/扩展名？

> ID：138550
> 
> 赞同：41
> 
> 时间：2008-09-26T09:59:31.843
> 
> 标签：installation, wix, windows-installer, wix3

我在 WiX 文档（或谷歌，就此而言）中没有找到这个问题的明确答案。当然，我可以在 HKCR 中编写适当的注册表项，但这让我觉得很脏，我希望这是一个标准任务，应该有一个很好的默认解决方案。

对于奖励积分，我想知道如何使其“安全”，即不要覆盖文件类型的现有注册，并且只有在安装期间注册并且未更改时才在卸载时删除注册。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-26T07:15:19.547

不幸的是，没有办法与 Windows Installer 建立“安全”关联。

我们只需将所有内容写入注册表，然后有一个单独的组件接管系统范围的默认设置，并且仅在没有其他应用程序已将自身注册为默认设置时才安装。

使用 Vista 有新的“默认程序”界面，您再次将所有内容写入注册表。这是我们在安装程序中使用的完整示例。(WiX 3.0)

**更新：**距离我最初的回答已经过去了 12 个月，我对文件关联有了更好的理解。我现在不是手动编写所有内容，而是使用适当的`ProgId`定义来改进广告包的处理。[请参阅针对此问题发布](https://stackoverflow.com/questions/2772452/how-to-register-application-for-existing-file-types-using-wix-installer)的更新代码。

```
<Component ....>
    <RegistryValue Root="HKLM" Key="SOFTWARE\AcmeFoobar\Capabilities" Name="ApplicationDescription" Value="ACME Foobar XYZ Editor" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\AcmeFoobar\Capabilities" Name="ApplicationIcon" Value="[APPLICATIONFOLDER]AcmeFoobar.exe,0" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\AcmeFoobar\Capabilities" Name="ApplicationName" Value="ACME Foobar" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\AcmeFoobar\Capabilities\DefaultIcon" Value="[APPLICATIONFOLDER]AcmeFoobar.exe,1" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\AcmeFoobar\Capabilities\FileAssociations" Name=".xyz" Value="AcmeFoobar.Document" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\AcmeFoobar\Capabilities\MIMEAssociations" Name="application/xyz" Value="AcmeFoobar.Document" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\AcmeFoobar\Capabilities\shell\Open\command" Value="&quot;[APPLICATIONFOLDER]AcmeFoobar.exe&quot; &quot;%1&quot;" Type="string" />

    <RegistryValue Root="HKLM" Key="SOFTWARE\RegisteredApplications" Name="Acme Foobar" Value="SOFTWARE\AcmeFoobar\Capabilities" Type="string" />

    <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\.xyz" Name="Content Type" Value="application/xyz" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\.xyz\AcmeFoobar.Document\ShellNew" Value="" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\.xyz\OpenWithList\AcmeFoobar.exe" Value="" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\.xyz\OpenWithProgids" Name="AcmeFoobar.Document" Value="" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\Applications\AcmeFoobar.exe\SupportedTypes" Name=".xyz" Value="" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\Applications\AcmeFoobar.exe\shell\open" Name="FriendlyAppName" Value="ACME Foobar" Type="string" />

    <RegistryValue Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\AcmeFoobar.exe" Value="[!AcmeFoobar.exe]" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\AcmeFoobar.exe" Name="Path" Value="[APPLICATIONFOLDER]" Type="string" />

    <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\SystemFileAssociations\.xyz\shell\edit.AcmeFoobar.exe" Value="Edit with ACME Foobar" Type="string" />
    <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\SystemFileAssociations\.xyz\shell\edit.AcmeFoobar.exe\command" Value="&quot;[APPLICATIONFOLDER]AcmeFoobar.exe&quot; &quot;%1&quot;" Type="string" />

</Component>

<Component ....>
    <ProgId Id="AcmeFoobar.Document" Description="ACME XYZ Document">
        <Extension Id="pdf" ContentType="application/xyz">
            <Verb Id="open" Command="Open" TargetFile="[APPLICATIONFOLDER]AcmeFoobar.exe" Argument="%1" />
        </Extension>
    </ProgId>

    <Condition><![CDATA[DEFAULTVIEWER=1]]></Condition>
</Component> 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-26T12:36:56.010

[经过一些额外的研究，我在WiX 教程](http://www.tramontana.co.hu/wix/lesson1.php#1.7)中找到了这个问题的部分答案。它显示了一个广告解决方案，不适用于 WiX 3.0，但鉴于这些信息，我想通了。将 ProgId 元素添加到包含可执行文件的组件中，如下所示：

```
<ProgId Id="MyApplication.MyFile" Description="My file type">
  <Extension Id="myext" ContentType="application/whatever">
    <Verb Id="open" Command="open" TargetFile="MyApplication.exe" Argument="&quot;%1&quot;"/>
  </Extension>
</ProgId> 
```

myext 是不带点的文件扩展名，MyApplication.exe 是可执行文件的文件id（不是名称）（即File 元素的Id 属性）。这将使用您的可执行文件注册文件类型，并将提供一个默认图标（一个带有应用程序图标的白页），这足以满足我的需要。如果您想指定一个专用图标，似乎您仍然需要自己执行此操作，如下所示（链接教程中的代码）：

```
<Registry Id='FooIcon1' Root='HKCR' Key='.xyz' Action='write' Type='string' Value='AcmeFoobar.xyzfile' />
<Registry Id='FooIcon2' Root='HKCR' Key='AcmeFoobar.xyzfile' Action='write' Type='string' Value='Acme Foobar data file' />
<Registry Id='FooIcon3' Root='HKCR' Key='AcmeFoobar.xyzfile\DefaultIcon' Action='write' Type='string' Value='[INSTALLDIR]Foobar.exe,1' /> 
```

不过，我没有为我的奖金问题找到一个好的解决方案。

编辑：我在上一个答案出现之前就开始写这个了。但是，与之前的答案相比，我的解决方案实际上有效。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-26T12:34:07.967

“如果您的应用程序处理自己的文件数据类型，则需要为其注册文件关联。将 ProgId 放入组件中。FileId 应引用 File 元素的 Id 属性，该属性描述用于处理此文件的文件扩展名。注意感叹号：它将返回文件的短路径而不是长路径："

```
<ProgId Id='AcmeFoobar.xyzfile' Description='Acme Foobar data file'>
  <Extension Id='xyz' ContentType='application/xyz'>
     <Verb Id='open' Sequence='10' Command='Open' Target='[!FileId]' Argument='"%1"' />
  </Extension>
</ProgId> 
```

参考：[https ://www.firegiant.com/wix/tutorial/getting-started/beyond-files/](https://www.firegiant.com/wix/tutorial/getting-started/beyond-files/)

# c# - 正则表达式可以用于这种特定的字符串操作吗？

> ID：138552
> 
> 赞同：7
> 
> 时间：2008-09-26T10:00:10.920
> 
> 标签：c#, python, regex, language-agnostic

我需要用字符串中的字符（比如）**P替换字符（比如）** **x**，但前提是它包含在带引号的子字符串中。一个例子更清楚：

 **```
axbx'cxdxe'fxgh'ixj'k  -> axbx'cPdPe'fxgh'iPj'k 
```

为简单起见，我们假设引号总是成对出现。

显而易见的方法是一次只处理一个字符的字符串（一种简单的状态机方法）；
但是，我想知道是否可以使用正则表达式一次性完成所有处理。

我的目标语言是 C#，但我想我的问题与任何对正则表达式具有内置或库支持的语言有关。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T11:04:02.187

我将 Greg Hewgill 的 python 代码转换为 C# 并且成功了！

```
[Test]
public void ReplaceTextInQuotes()
{
  Assert.AreEqual("axbx'cPdPe'fxgh'iPj'k", 
    Regex.Replace("axbx'cxdxe'fxgh'ixj'k",
      @"x(?=[^']*'([^']|'[^']*')*$)", "P"));
} 
```

那个测试通过了。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-26T10:18:50.423

我可以用 Python 做到这一点：

```
>>> import re
>>> re.sub(r"x(?=[^']*'([^']|'[^']*')*$)", "P", "axbx'cxdxe'fxgh'ixj'k")
"axbx'cPdPe'fxgh'iPj'k" 
```

这样做是使用非捕获匹配 (?=...) 来检查字符 x 是否在带引号的字符串中。它查找直到下一个引号的一些非引号字符，然后查找单个字符或带引号的字符组的序列，直到字符串的末尾。

这取决于您的假设，即报价总是平衡的。这也不是很有效。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T21:16:12.040

一个更通用（和更简单）的解决方案，它允许非配对引号。

1.  查找带引号的字符串
2.  将字符串中的“x”替换为“P”

    ```
    #!/usr/bin/env python
    import re

    text = "axbx'cxdxe'fxgh'ixj'k"

    s = re.sub("'.*?'", lambda m: re.sub("x", "P", m.group(0)), text)

    print s == "axbx'cPdPe'fxgh'iPj'k", s
    # ->   True axbx'cPdPe'fxgh'iPj'k 
    ```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T14:17:33.087

诀窍是使用非捕获组来匹配我们正在搜索的匹配（字符**x ）***之后的字符串部分。*尝试将字符串匹配到**x**只会找到第一次或最后一次出现，这取决于是否使用了非贪婪量词。这是 Greg 的想法转换到 Tcl，并附有评论。

 ****```
设置 strIn {axbx'cxdxe'fxgh'ixj'k}
set regex {(?x) # 启用扩展语法
                                    # - 允许注释，忽略空格
            x # 实际匹配
            (?= # 不匹配组
                [^']*' # 匹配到当前引用子串的结尾
                                    ##
                                    ## 假设引号成对出现，
                                    ## 确保我们确实是
                                    ## 在带引号的子字符串中
                                    ## 通过确保字符串的其余部分
                                    ## 是我们所期望的
                                    ##
                (
                    [^']* # 匹配任何不带引号的子串
                    | ＃ ...或者...
                    '[^']*' # 任何带引号的子字符串，包括引号
                )* # 任意次数
                $ # 直到我们用完字符串:)
            ) # 非匹配组结束
}

#相同的正则表达式没有注释
设置 regexCondensed {(?x)x(?=[^']*'([^']|'[^']*')*$)}

设置 replRegex {P}
设置 nMatches [regsub -all -- $regex $strIn $replRegex strOut]
将“$nMatches 替换。”
如果 {$nMatches > 0} {
    puts "原文：|$strIn|"
    puts "结果：|$strOut|"
}
出口

```

这打印：

```
3 replacements. 
Original: |axbx'cxdxe'fxgh'ixj'k|
Result:   |axbx'cPdPe'fxgh'iPj'k| 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T17:56:13.543

```
#!/usr/bin/perl -w

use strict;

# Break up the string.
# The spliting uses quotes
# as the delimiter.
# Put every broken substring
# into the @fields array.

my @fields;
while (<>) {
    @fields = split /'/, $_;
}

# For every substring indexed with an odd
# number, search for x and replace it
# with P.

my $count;
my $end = $#fields;
for ($count=0; $count < $end; $count++) {
    if ($count % 2 == 1) {
        $fields[$count] =~ s/a/P/g;
    }    
} 
```

这个块不会做这项工作吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T10:08:42.663

不是普通的正则表达式。正则表达式没有“记忆”，因此它们无法区分是“内部”还是“外部”引号。

你需要更强大的东西，例如使用[gema](http://gema.sourceforge.net)它会很简单：

```
'<repl>'=$0
repl:x=P 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T10:19:31.983

关于平衡文本替换的类似讨论：[可以使用正则表达式匹配嵌套模式吗？](https://stackoverflow.com/questions/133601/can-regular-expressions-be-used-to-match-nested-patterns#133771)

虽然你可以在 Vim 中尝试这个，但它只有在字符串在一行并且只有一对 ' 的情况下才能正常工作。

```
:%s:\('[^']*\)x\([^']*'\):\1P\2:gci 
```

如果还有一对甚至是不平衡的 '，那么它可能会失败。这就是我在命令中包含`c`又名确认标志的方式。`ex`

sed 也可以做到这一点，无需交互 - 或者`awk`你可以添加一些交互。

一种可能的解决方案是在成对的 s 上打断线，`'`然后您可以使用 vim 解决方案。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T13:22:18.350

```
Pattern:     (?s)\G((?:^[^']*'|(?<=.))(?:'[^']*'|[^'x]+)*+)x
Replacement: \1P 
```

1.  `\G`— 将每个匹配项锚定在前一个匹配项的末尾或字符串的开头。
2.  `(?:^[^']*'|(?<=.))`— 如果它位于字符串的开头，则匹配第一个引号。
3.  `(?:'[^']*'|[^'x]+)*+`— 匹配任何不带引号的字符块，或任何（非引号）字符，直到 'x'。

一次扫描源字符串，除了单个字符后视。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T10:10:00.150

很抱歉打破了你的希望，但你需要一个下推式自动机来做到这一点。这里有更多信息： [下推自动机](http://en.wikipedia.org/wiki/Pushdown_automaton)

简而言之，作为有限状态机的正则表达式只能读取并且没有内存，而下推自动机具有堆栈和操作能力。

编辑：拼写...

# c# - 如何将 HTML 转换为 XHTML？

> ID：138555
> 
> 赞同：23
> 
> 时间：2008-09-26T10:00:18.470
> 
> 标签：c#, .net, html, xhtml, converter

我需要将 HTML 文档转换为有效的 XML，最好是 XHTML。最好的方法是什么？有没有人知道工具包/库/示例/......任何可以帮助我完成任务的东西？

在这里更清楚一点，我的应用程序必须在运行时自动进行转换。我不寻找可以帮助我手动将某些页面移动到 XHTML 的工具。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-26T10:02:32.803

[**使用 HTML Tidy 从 HTML 转换为 XML**](http://www.ibm.com/developerworks/library/tiptidy.html)

[**可下载的二进制文件**](http://tidy.sourceforge.net/#binaries)

JRoppert，为了您的需要，我想您可能想查看[Sources](http://sourceforge.net/cvs/?group_id=27659)

```
c:\temp>tidy -help
tidy [option...] [file...] [option...] [file...]
Utility to clean up and pretty print HTML/XHTML/XML
see http://tidy.sourceforge.net/

Options for HTML Tidy for Windows released on 14 February 2006:

File manipulation
-----------------
 -output <file>, -o  write output to the specified <file>
 <file>
 -config <file>      set configuration options from the specified <file>
 -file <file>, -f    write errors to the specified <file>
 <file>
 -modify, -m         modify the original input files

Processing directives
---------------------
 -indent, -i         indent element content
 -wrap <column>, -w  wrap text at the specified <column>. 0 is assumed if
 <column>            <column> is missing. When this option is omitted, the
                     default of the configuration option "wrap" applies.
 -upper, -u          force tags to upper case
 -clean, -c          replace FONT, NOBR and CENTER tags by CSS
 -bare, -b           strip out smart quotes and em dashes, etc.
 -numeric, -n        output numeric rather than named entities
 -errors, -e         only show errors
 -quiet, -q          suppress nonessential output
 -omit               omit optional end tags
 -xml                specify the input is well formed XML
 -asxml, -asxhtml    convert HTML to well formed XHTML
 -ashtml             force XHTML to well formed HTML
 -access <level>     do additional accessibility checks (<level> = 0, 1, 2, 3).
                     0 is assumed if <level> is missing.

Character encodings
-------------------
 -raw                output values above 127 without conversion to entities
 -ascii              use ISO-8859-1 for input, US-ASCII for output
 -latin0             use ISO-8859-15 for input, US-ASCII for output
 -latin1             use ISO-8859-1 for both input and output
 -iso2022            use ISO-2022 for both input and output
 -utf8               use UTF-8 for both input and output
 -mac                use MacRoman for input, US-ASCII for output
 -win1252            use Windows-1252 for input, US-ASCII for output
 -ibm858             use IBM-858 (CP850+Euro) for input, US-ASCII for output
 -utf16le            use UTF-16LE for both input and output
 -utf16be            use UTF-16BE for both input and output
 -utf16              use UTF-16 for both input and output
 -big5               use Big5 for both input and output
 -shiftjis           use Shift_JIS for both input and output
 -language <lang>    set the two-letter language code <lang> (for future use)

Miscellaneous
-------------
 -version, -v        show the version of Tidy
 -help, -h, -?       list the command line options
 -xml-help           list the command line options in XML format
 -help-config        list all configuration options
 -xml-config         list all configuration options in XML format
 -show-config        list the current configuration settings

Use --blah blarg for any configuration option "blah" with argument "blarg"

Input/Output default to stdin/stdout respectively
Single letter options apart from -f may be combined
as in:  tidy -f errs.txt -imu foo.html
For further info on HTML see http://www.w3.org/MarkUp 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T10:16:38.883

您可以使用[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)。它来自 CodePlex 的开源项目。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T11:40:04.973

[Validator.nu HTML Parser](http://about.validator.nu/htmlparser/)附带一个 HTML2XML 示例程序，该程序使用 HTML5 解析算法和信息集强制规则进行转换。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-03-21T00:12:05.200

为 .NET 4.0 使用 Html2Xhtml：

内存中字符串到字符串的转换：

```
var xhtml = Html2Xhtml.RunAsFilter(stdin => stdin.Write(html)).ReadToEnd(); 
```

内存中字符串到 XDocument 的转换：

```
var xdoc = Html2Xhtml.RunAsFilter(stdin => stdin.Write(html)).ReadToXDocument(); 
```

有关详细信息，请参阅[http://corsis.sourceforge.net/index.php/Html2Xhtml](http://corsis.sourceforge.net/index.php/Html2Xhtml)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-04T13:27:40.770

[http://corsis.sourceforge.net/index.php/Html2Xhtml](http://corsis.sourceforge.net/index.php/Html2Xhtml) http://corsis.sourceforge.net/index.php/Html2Xhtml

Html2Xhtml 是一个 .NET 4.0 库，用于将 HTML 转换为在 GPLv2 或更高版本下许可的 XHTML。

我在欧盟的一个大型在线数据库本地重构中测试了Html2Xhtml。Tidy/Tidy.NET 在大多数情况下甚至都不会产生有效的输出，Chilkat 的 HTML 到 XML 有点慢并且产生了奇怪的结果（错位、丢失、无法解释的元素）。为了找到一个免费、快速和可靠的转换工具，我创建了这个库。它的转换速度比我测试的所有其他库快 2 到 4 倍。

Html2Xhtml 结合 LINQ to XML 的强大功能，是所有大规模数据提取和网络爬取场景的优秀工具。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-11-22T16:13:04.297

您可以使用整洁的可执行文件将 html 转换为 xhtml：

整洁 -asxhtml -numeric < index.html > index.xhml

[您可以在此处](http://www.dotnetobject.com/Thread-Html-to-Xhtml-conversion-in-c)检查 c# 实现。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T10:06:20.923

最简单的方法是设置您的 Visual Studio IDE 以识别您需要进行的更改。您可以在 Visual Studio 2008 中执行此操作，方法是转到：工具、选项、文本编辑器、HTML、验证并选择适当的目标。可能是 XHTML 1.1 或 XHTML 1.0 过渡。

有关不同类型的一些信息，请阅读：http: [//msdn.microsoft.com/en-us/library/aa479043.aspx](http://msdn.microsoft.com/en-us/library/aa479043.aspx)

然后，您需要处理页面上突出显示的点。

# vba - VB FFT - 卡住理解结果与频率的关系

> ID：138558
> 
> 赞同：3
> 
> 时间：2008-09-26T10:01:29.903
> 
> 标签：vba, audio, signal-processing, fft

试图理解我正在使用的 fft（快速傅立叶变换）例程（窃取）（回收）

输入是一个包含 512 个数据点的数组，它们是一个样本波形。测试数据生成到这个数组中。fft 将此数组转换为频域。试图了解 fft 数组中频率、周期、采样率和位置之间的关系。我将举例说明：

=========================================

采样率为 1000 个样本/秒。以 10Hz 生成一组样本。

输入数组在 arr(28)、arr(128)、arr(228) 处具有峰值 ... 周期 = 100 个采样点

fft 数组中的峰值位于索引 6 处（不包括 0 处的巨大值）

=========================================

采样率为 8000 个样本/秒 以 440Hz 生成一组样本

输入数组峰值包括 arr(7), arr(25), arr(43), arr(61) ... period = 18 个采样点

fft 数组中的峰值位于索引 29 处（不包括 0 处的巨大值）

=========================================

如何将 fft 数组中的峰值索引与频率相关联？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T20:19:34.687

如果忽略虚部，频率分布在 bin 之间是线性的：

频率@i = (采样率/2)*(i/Nbins)。

所以对于你的第一个例子，假设你有 256 个 bin，最大的 bin 对应于 1000/2 * 6/256 = 11.7 Hz 的频率。由于您的输入是 10Hz，我猜 bin 5 (9.7Hz) 也有一个很大的分量。为了获得更好的准确性，您需要采集更多样本，以获得更小的 bin。

你的第二个例子给出了 8000/2*29/256 = 453Hz。再次关闭，但您需要更多垃圾箱。你这里的分辨率只有 4000/256 = 15.6Hz。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T02:07:28.190

如果您要提供示例数据集，这将很有帮助。

我的猜测是你有所谓的采样工件。DC（频率 0）处的强信号表明情况就是如此。

您应该始终确保输入数据中的平均值为零 - 在调用 fft 之前找到平均值并从每个样本点中减去它是一种很好的做法。

同样，您必须小心采样窗口伪影。重要的是，第一个和最后一个数据点接近于零，否则从采样窗口外到内的“步长”会产生以不同频率注入大量能量的效果。

底线是，进行 fft 分析比简单地回收某处找到的 fft 例程需要更多的注意。

这是问题中描述的 10Hz 信号的前 100 个采样点，经过按摩以避免采样伪影

```
> 辛克斯[1:100]
  [1] 0.000000e+00 6.279052e-02 1.253332e-01 1.873813e-01 2.486899e-01 3.090170e-01 3.681246e-01 4.257793e-01 4.817537e-01 5.358
 [11] 5.877853e-01 6.374240e-01 6.845471e-01 7.289686e-01 7.705132e-01 8.090170e-01 8.443279e-01 8.763067e-01 9.048275e-01 9.29
 [21] 9.510565e-01 9.685832e-01 9.822873e-01 9.921147e-01 9.980267e-01 1.000000e+00 9.980267e-01 9.921147e-01 9.8228873e-01 9.6850
 [31] 9.510565e-01 9.297765e-01 9.048271e-01 8.763067e-01 8.443279e-01 8.090170e-01 7.705132e-01 7.289686e-01 6.845440e-01 6.370
 [41] 5.877853e-01 5.358268e-01 4.817537e-01 4.257793e-01 3.681246e-01 3.090170e-01 2.486899e-01 1.873813e-01 1.2533052e-01 6.279
 [51] -2.542075e-15 -6.279052e-02 -1.253332e-01 -1.873813e-01 -2.486899e-01 -3.090170e-01 -3.681246e-01 -4.257793e-01 -4.8175268e-01 -5.358 e-01
 [61] -5.877853e-01 -6.374240e-01 -6.845471e-01 -7.289686e-01 -7.705132e-01 -8.090170e-01 -8.443279e-01 -8.763067e-01 -9.0482751e-01 -9.27 e-01
 [71] -9.510565e-01 -9.685832e-01 -9.822873e-01 -9.921147e-01 -9.980267e-01 -1.000000e+00 -9.980267e-01 -9.921147e-01 -9.8228873e-01 -9.65 e-01
 [81] -9.510565e-01 -9.297765e-01 -9.048271e-01 -8.763067e-01 -8.443279e-01 -8.090170e-01 -7.705132e-01 -7.289686e-01 -6.845240e-01 -6.34 e-01
 [91] -5.877853e-01 -5.358268e-01 -4.817537e-01 -4.257793e-01 -3.681246e-01 -3.090170e-01 -2.486899e-01 -1.873813e-01 -1.2533052e-01 -6.29 e-02

```

这是 fft 频域的结果绝对值

```
[1] 7.160038e-13 1.008741e-01 2.080408e-01 3.291725e-01 4.753899e-01 6.653660e-01 9.352601e-01 1.368212e+00 2.211653e+00 4.60126
[12] 5.293086e+00 2.742218e+00 1.891330e+00 1.462830e+00 1.203175e+00 1.028079e+00 9.014559e-01 8.052577e-01 7.294489e-01

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T11:16:55.387

自从我完成 FFT 以来已经有一段时间了，但这是我记得的

FFT 通常将复数作为输入和输出。所以我不太确定输入和输出的实部和虚部如何映射到数组。

我真的不明白你在做什么。在第一个示例中，您说您以 10Hz 的采样率处理采样缓冲区，采样率为 1000Hz？所以你应该每秒有 10 个缓冲区，每个缓冲区有 100 个样本。我不明白您的输入数组如何至少有 228 个样本长。

通常输出缓冲器的前半部分是从 0 频率（=dc 偏移）到 1/2 采样率的频率区间。第二半是负频率。如果您的输入只是真实数据，0 为虚信号正负频率是相同的。输出上实/虚信号的关系包含来自输​​入信号的相位信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T11:45:22.780

我对数学和信号处理也有点生疏，但有了额外的信息，我可以试一试。

如果您想知道每个 bin 的信号能量，您需要复数输出的幅度。所以只看真实的输出是不够的。即使输入只是实数。对于每个 bin，输出的大小是 sqrt(real^2 + imag^2)，就像 pythagoras :-)

bin 0 到 449 是从 0 Hz 到 500 Hz 的正频率。bin 500 到 1000 是负频率，应该与真实信号的正频率相同。如果您每秒处理一个缓冲区，则频率和数组索引排列得很好。所以索引 6 处的峰值对应于 6Hz，所以这有点奇怪。这可能是因为您只查看实际输出数据，而实部和虚部数据结合起来会在索引 10 处给出预期峰值。频率应该线性映射到 bin。

0 处的峰值表示 DC 偏移。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T20:47:37.007

bin i 的频率是 i * (samplerate / n)，其中 n 是 FFT 输入窗口中的样本数。

如果您正在处理音频，由于音高与频率的对数成正比，箱的音高分辨率会随着频率的增加而增加 - 很难准确地解析低频信号。为此，您需要使用更大的 FFT 窗口，这会降低时间分辨率。对于给定的采样率，存在频率与时间分辨率的权衡。

您提到了一个在 0 处具有较大值的箱 - 这是频率为 0 的箱，即直流分量。如果这很大，那么大概您的值通常是积极的。Bin n/2（在您的情况下为 256）是奈奎斯特频率，是采样率的一半，这是在此速率下可以在采样信号中解析的最高频率。

如果信号是实数，则箱 n/2+1 到 n-1 将分别包含箱 n/2-1 到 1 的复共轭。DC 值只出现一次。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T02:59:59.763

正如其他人所说，这些样本在频域中是等距的（不是对数的）。

例如 1，你应该得到这个：

[替代文字 http://home.comcast.net/~kootsoop/images/SINE1.jpg](http://home.comcast.net/~kootsoop/images/SINE1.jpg)

对于另一个例子，你应该得到

[替代文字 http://home.comcast.net/~kootsoop/images/SINE2.jpg](http://home.comcast.net/~kootsoop/images/SINE2.jpg)

因此，关于峰值位置，您的答案似乎都是正确的。

我没有得到的是大的直流分量。您确定要生成正弦波作为输入吗？输入是否为负？对于正弦波，只要您获得足够的周期，DC 应该接近于零。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-04T17:30:03.160

另一种方法是为您正在寻找的每个音符中心频率制作[Goertzel 算法。](http://en.wikipedia.org/wiki/Goertzel_algorithm)

一旦你得到一种算法的实现，你就可以让它接受参数来设置它的中心频率。有了它，您可以轻松地运行其中的 88 个或任何您需要的集合并扫描峰值。

Goertzel 算法基本上是一个单 bin FFT。使用这种方法，您可以按照音符的自然对数方式放置您的垃圾箱。

来自维基百科的一些伪代码：

```
s_prev = 0
s_prev2 = 0
coeff = 2*cos(2*PI*normalized_frequency);
for each sample, x[n],
  s = x[n] + coeff*s_prev - s_prev2;
  s_prev2 = s_prev;
  s_prev = s;
end
power = s_prev2*s_prev2 + s_prev*s_prev - coeff*s_prev2*s_prev; 
```

代表前两个样本的两个变量被保留用于下一次迭代。然后可以在流应用程序中使用它。我认为也许功率计算也应该在循环内。（但在 Wiki 文章中并未如此描述。）

在音调检测情况下，将有 88 个不同的系数、88 对先前样本，并且将产生 88 个功率输出样本，指示该频率仓中的相对电平。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-03T04:07:01.543

WaveyDavey 说他正在通过计算机的音频硬件从麦克风捕获声音，但他的结果不是以零为中心的。这听起来像是硬件的问题。它应该以零为中心。

当房间安静时，来自声音 API 的值流应该非常接近 0 幅度，环境噪声有轻微的 +- 变化。如果房间中存在振动声音（例如钢琴、长笛、人声），则数据流应显示基本为正弦波的正弦波，该波为正弦波，平均值接近于零。如果不是这种情况，系统就会出现一些问题！

-瑞克

# php - PHP 类数据库连接范围问题

> ID：138565
> 
> 赞同：1
> 
> 时间：2008-09-26T10:03:25.453
> 
> 标签：php, mysql, class, scope, code-reuse

对于我在 PHP 中做的一个新项目，我创建了一个 SQLMethods 类来连接到数据库并执行查询。今晚是我真正测试它的第一个晚上（我大约一周前写了它并忘记了它）并且发生了意外错误：当它调用我的 ExecuteQuery() 函数时，它不会使用我的数据库在构造函数中选择。

构造函数：

```
 public function SQLMethods() {
        $SQLConnection = mysql_connect($SQLDBAddress, $SQLUserName, $SQLPassword);

        if (!$SQLConnection) {
            die('Could not connect: ' . mysql_error());
        }

        mysql_select_db($SQLDB, $SQLConnection);
    } 
```

有问题的功能：

```
 public function ExecuteQuery($Query) {
        mysql_query($Query, $SQLConnection) or die('Could not perform query: ' . mysql_error());
    } 
```

有谁看到问题可能是什么？构造函数完成后连接是否关闭？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T10:07:49.140

你应该在你的类中声明 $SQLConnection ，你应该把它称为

```
 $this->SQLConnection 
```

而不仅仅是 $SQLConnection。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T10:07:51.917

`$SQLConnection`方法中不存在`ExecuteQuery`。

您可以将其作为参数直接传递给`ExecuteQuery`，或者添加`sqlConnection`在构造函数中设置并`$this->sqlConnection`在类方法中访问的类属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T10:10:41.053

尝试使用的变量`$SQLConnection` `ExecuteQuery()`是在另一个范围内创建的。（`SQLMethods`函数）。

当 PHP 脚本完成其工作或您自己关闭它（如果在该脚本中建立连接）时，连接将关闭

您应该按照 php.net 文档的说明跳过其中的`$SQLConnection`变量`ExecuteQuery`

> 如果未指定链接标识符，`mysql_connect()`则假定打开的最后一个链接。

# asp.net - 压缩ASP.Net的脚本资源

> ID：138570
> 
> 赞同：1
> 
> 时间：2008-09-26T10:03:44.297
> 
> 标签：asp.net, javascript, compression

如何压缩 ASP.Net 的脚本资源？我看到那里的文件高达 255 KB！我尝试寻找解决方案，但到目前为止它只讨论脚本动态和静态文件。我检查了 IIS 的压缩临时文件夹，发现那里没有压缩的脚本资源。这使我得出结论，这些文件是以高带宽传输的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T11:36:25.120

如果您正在运行 IIS6，OrcsWeb 的人有一篇不错的文章 -

> [http://weblogs.asp.net/owscott/archive/2004/01/12/57916.aspx](http://weblogs.asp.net/owscott/archive/2004/01/12/57916.aspx)

我们有客户运行 port80 软件，因为他们获得了更多控制权：

> [http://www.port80software.com/products/zipenable/](http://www.port80software.com/products/zipenable/) [http://www.port80software.com/products/httpzip/](http://www.port80software.com/products/httpzip/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T12:28:20.477

我不知道将某些东西绑定到 ASP.net 但有许多独立的压缩器。 [Packer](http://dean.edwards.name/packer/)可作为 .Net 应用程序使用。 [JSMin](http://www.crockford.com/javascript/jsmin.html)有多种语言版本，但没有一种是 .Net，还有[ShrinkSafe](http://shrinksafe.dojotoolkit.org/)需要 java。将它们中的任何一个绑定到您的构建过程中应该非常简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T12:38:56.050

最好的办法是在 web.Config 中实现一个 httpHandler。

见[http://blog.madskristensen.dk/post/Optimize-WebResourceaxd-and-ScriptResourceaxd.aspx](http://blog.madskristensen.dk/post/Optimize-WebResourceaxd-and-ScriptResourceaxd.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T14:07:55.090

Check out the JSCompress task in the MSBuild Community Tasks ([http://msbuildtasks.tigris.org/](http://msbuildtasks.tigris.org/)). It'll strip out the whitespace from a JS file for you.

# visual-studio-2008 - Visual Studio 2008 报告中的权限

> ID：138573
> 
> 赞同：3
> 
> 时间：2008-09-26T10:04:18.510
> 
> 标签：visual-studio-2008, reporting-services

我已经成功添加了一个自定义程序集，使用`AddTrustedCodeModuleInCurrentAppDomain`. 我正在当前 appdomain 中执行报告。

当我尝试访问 SQL 时，我得到了报告服务`System.Data.SqlClient.SqlClientPermission failed.`，我尝试将其添加`System.Data`到上述受信任的程序集中，但它没有帮助。

如何确保存在此权限？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T17:12:41.107

从错误听起来像是您的登录凭据正在丢失。你使用什么样的授权？

如果您使用的是 Windows 授权，您可能会失去“您”的身份。听起来不太可能，因为您是从当前 appdomain 调用的。您可能希望更改连接字符串以指定用户名和密码。如果没有别的，它应该有助于调试。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T18:28:38.130

我找到了解决方案。您指定 System.Security.Policy.Evidence 执行程序集（或具有足够权限的程序集）到 LocalReport 以在执行期间使用。

```
reportViewer.LocalReport.ExecuteReportInCurrentAppDomain(System.Reflection.Assembly.GetExecutingAssembly().Evidence); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T21:42:48.237

这有什么好运气吗？

我在本地模式下使用 Visual Studio 2008 中的 ReportViewer 控件，并将对象作为数据源。我的类被映射到我的数据库中的数据表。在对象中，它根据需要加载相关对象。因此，在您尝试使用该属性之前，它会保留引用为空，然后它会尝试自动从数据库中加载它。这些类使用 System.Data.SqlClient 命名空间。

当我与 Windows 窗体应用程序中的对象交互时，一切都按预期工作。但是当我传递要用作报表数据源的对象并尝试自动加载相关对象时，它会失败。该代码创建了一个 SqlConnection 对象，当我在其上调用 GetCommand() 时，会引发以下异常：

```
[System.Security.SecurityException] {
"Request for the permission of type 'System.Data.SqlClient.SqlClientPermission, System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' failed."
} System.Security.SecurityException 
```

我尝试搜索错误，但显示的所有结果都是针对在 SQL Server 或 ASP.Net 上运行的 CLR 程序集。在创建 SqlConnection 对象之前，我尝试在我的代码中添加以下调用（如搜索结果中所建议的那样），但它显然没有做任何事情：

```
System.Data.SqlClient.SqlClientPermission(System.Security.Permissions.PermissionState.Unrestricted).Assert(); 
```

# .net - 如何从 XSD 文件创建数据库表？

> ID：138575
> 
> 赞同：35
> 
> 时间：2008-09-26T10:04:26.887
> 
> 标签：.net, sql, database, xsd, code-generation

我有一组 XSD，我从中生成数据访问类、存储过程等。

我没有一种从这些生成数据库表的方法 - 是否有工具可以为我生成 DDL 语句？

这与[从数据集表创建数据库表](https://stackoverflow.com/questions/16443/create-db-table-from-dataset-table)不同，因为我没有数据集表，而是 XSD。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-20T15:20:56.727

有一个名为[XSD2DB](http://xsd2db.sourceforge.net/)的命令行工具，它从 xsd 文件生成数据库，可在 sourceforge 获得。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-26T10:29:28.667

商业产品：Altova 的[XML Spy](http://www.altova.com/features_sql.html)。

请注意，没有通用的解决方案。XSD 可以轻松描述未映射到关系数据库的内容。

虽然您可以尝试“自动化”这一点，但您的 XSD 必须在设计时考虑到关系数据库，否则将无法正常工作。

如果 XSD 的特性不能很好地映射，您必须 (1) 设计某种映射，然后 (2) 编写自己的应用程序将 XSD 转换为 DDL。

去过也做过。雇佣工作——没有可用的开源。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-26T10:59:36.300

我使用 XSLT 来做到这一点。编写您的 XSD，然后通过输出 SQL 命令的手写 XSLT 传递您的数据模型。编写 XSLT 比您可能编写的自定义程序/脚本更快且可重用。

至少我在工作中就是这样做的，多亏了我才有时间在 SO 上闲逛 :)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-11-27T19:32:31.920

使用 XSD 文件创建 SQL 数据库模式的最佳方法是一个名为 Altova XMLSpy 的程序，这非常简单：

1.  创建一个新项目
2.  在 DTDs / Schemas 文件夹上右键单击并选择添加文件
3.  选择 XSD 文件
4.  双击打开添加的XSD文件
5.  转到工具栏并查看转换
6.  他们选择从 XML 模式创建结构数据库
7.  选择数据源
8.  最后让它导出路由调用，立即将它们的脚本模式留给 SQL Server 来执行查询。

希望能帮助到你。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-18T01:08:42.227

XML Schema 描述了分层数据模型，可能无法很好地映射到关系数据模型。将 XSD 映射到数据库表与将对象映射到数据库表非常相似，实际上您可以使用像 Castor 这样的框架来实现这两者，它允许您采用 XML 模式并生成类、数据库表和数据访问代码。我想现在有很多工具可以做同样的事情，但是会有一个学习曲线，默认映射很可能不是你想要的，所以你必须花时间定制你使用的任何工具。

XSLT 可能是准确生成所需代码的最快方法。如果它是一个小的模式硬编码，它可能比评估和学习一堆新技术更快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T10:54:03.740

使用 Axis wsdl2java（可以接收 .xsd 文件）创建 Java 模型。

使用接受 Java 模型的 Java 数据库生成工具。当然像 Hibernate 这样的东西可以做到这一点？我编写了自己的工具（需要几天时间，也用 Java 生成 CRUD 代码）以节省自己的工作时间，也许这将是一个不错的个人项目？

或者只是手动进行，以便您可以检查一切是否正确且良好！数据库工具现在已经足够好了，您可以轻松地为模型创建表而不会出现太多问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-27T17:23:58.107

可能会看看 Visual Studio 2k8 中的 XSD 工具......我已经从 xsd 创建了一个关系数据集，它可能会以某种方式帮助你。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T00:45:55.813

hyperjaxb（版本 2 和 3）实际上生成休眠映射文件和相关实体对象，并且还对给定的 XSD 和示例 XML 文件进行往返测试。您可以捕获日志输出并自己查看 DDL 语句。我不得不稍微调整它们，但它为您提供了一个基本的蓝图。

# windows - 将“tree /f /a”结果保存到支持 unicode 的文本文件

> ID：138576
> 
> 赞同：44
> 
> 时间：2008-09-26T10:04:32.797
> 
> 标签：windows, command-line, unicode

我正在尝试在 Windows 命令行中使用 tree 命令来生成一个列出目录内容的文本文件，但是当我通过管道输出时，unicode 字符会被填满。

这是我正在使用的命令：

```
tree /f /a > output.txt 
```

控制台窗口中的结果很好：

```
\---Erika szobája
        封面.jpg
        Erika szobája.m3u
        Kátai Tamás - 01 Télvíz.ogg
        Kátai Tamás - 02 Zölderdõ.ogg
        Kátai Tamás - 03 雷诺阿 kertje.ogg
        Kátai Tamás - 04 Esõben szaladtál.ogg
        Kátai Tamás - 05 Ázik az út.ogg
        Kátai Tamás - 06 Sûrû völgyek takaród.ogg
        Kátai Tamás - 07 Õszhozó.ogg
        Kátai Tamás - 08 Mécsvilág.ogg
        Kátai Tamás - 09 Zúzmara.ogg

```

但是文本文件不好：

```
\---Erika szob ja
        封面.jpg
        Erika szob ja.m3u
        K tai Tam s - 01 T‚lv¡z.ogg
        K tai Tam s - 02 Z”lderdä.ogg
        K tai Tam s - 03 雷诺阿 kertje.ogg
        K tai Tam s - 04 Esäben szaladt l.ogg
        K tai Tam s - 05 µzik az £t.ogg
        K tai Tam s - 06 S–r– v”lgyek takar¢d.ogg
        K tai Tam s - 07 åszhoz¢.ogg
        K tai Tam s - 08 M‚csvil g.ogg
        K tai Tam s - 09 Z£zmara.ogg

```

我怎样才能解决这个问题？理想情况下，文本文件将与控制台窗口中的输出完全相同。

我尝试了使用 /U 开关运行命令行的 Chris Jester-Young 的建议（发生了什么事，你删除了它吗？），它看起来正是我需要的，但它似乎不起作用。我尝试在 VS2008 和记事本中打开文件，都显示相同的错误字符。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2012-06-26T02:02:42.377

有人已经尝试过这个：

```
tree /f /a |clip 
```

打开记事本，ctrl + V，在记事本中保存为支持unicode的output.txt？

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2013-04-12T01:45:49.003

使用 PowerShell：

```
powershell -command "tree /f > tree.txt" 
```

## 测试用例：

`create.ps1`：

```
mkdir "Erika szobája"
$null | Set-Content "Erika szobája/cover.jpg"
$null | Set-Content "Erika szobája/Erika szobája.m3u"
$null | Set-Content "Erika szobája/Kátai Tamás - 01 Télvíz.ogg"
$null | Set-Content "Erika szobája/Kátai Tamás - 02 Zölderdõ.ogg"
$null | Set-Content "Erika szobája/Kátai Tamás - 03 Renoir kertje.ogg"
$null | Set-Content "Erika szobája/Kátai Tamás - 04 Esõben szaladtál.ogg"
$null | Set-Content "Erika szobája/Kátai Tamás - 05 Ázik az út.ogg"
$null | Set-Content "Erika szobája/Kátai Tamás - 06 Sûrû völgyek takaród.ogg"
$null | Set-Content "Erika szobája/Kátai Tamás - 07 Õszhozó.ogg"
$null | Set-Content "Erika szobája/Kátai Tamás - 08 Mécsvilág.ogg"
$null | Set-Content "Erika szobája/Kátai Tamás - 09 Zúzmara.ogg" 
```

输出：

`tree.txt`：

```
Folder PATH listing
Volume serial number is 00000000 0000:0000
C:.
│   create.ps1
│   tree.txt
│   
└───Erika szobája
        cover.jpg
        Erika szobája.m3u
        Kátai Tamás - 01 Télvíz.ogg
        Kátai Tamás - 02 Zölderdo.ogg
        Kátai Tamás - 03 Renoir kertje.ogg
        Kátai Tamás - 04 Esoben szaladtál.ogg
        Kátai Tamás - 05 Azik az út.ogg
        Kátai Tamás - 06 Sûrû völgyek takaród.ogg
        Kátai Tamás - 07 Oszhozó.ogg
        Kátai Tamás - 08 Mécsvilág.ogg
        Kátai Tamás - 09 Zúzmara.ogg 
```

# 编辑：

# 高级用户的增强和改进版本

[![使用 Unicode 的列表树菜单](https://i.stack.imgur.com/xTbFr.png)](https://i.stack.imgur.com/xTbFr.png)

## 测试用例：

```
$null | Set-Content "欲速则不达.txt"
$null | Set-Content "爱不是占有,是欣赏.txt"
$null | Set-Content "您先请是礼貌.txt"
$null | Set-Content "萝卜青菜，各有所爱.txt"
$null | Set-Content "广交友，无深交.txt"
$null | Set-Content "一见钟情.txt"
$null | Set-Content "山雨欲来风满楼.txt"

$null | Set-Content "悪妻は百年の不作。.txt"
$null | Set-Content "残り物には福がある。.txt"
$null | Set-Content "虎穴に入らずんば虎子を得ず。.txt"
$null | Set-Content "夏炉冬扇.txt"
$null | Set-Content "花鳥風月.txt"
$null | Set-Content "起死回生.txt"
$null | Set-Content "自業自得.txt"

$null | Set-Content "아는 길도 물어가라.txt"
$null | Set-Content "빈 수레가 요란하다.txt"
$null | Set-Content "방귀뀐 놈이 성낸다.txt"
$null | Set-Content "뜻이 있는 곳에 길이 있다.txt"
$null | Set-Content "콩 심은데 콩나고, 팥 심은데 팥난다.txt" 
```

从他的[回答](https://stackoverflow.com/questions/138576/saving-tree-f-a-results-to-a-textfile-with-unicode-support/139302#139302)中，@Chris Jester-Young 写道：

> 现在，在 中`ulib`，该`WriteString`方法在两个类中实现，`SCREEN`并且`STREAM`。该`SCREEN`版本 `WriteConsoleW`直接使用，因此所有 Unicode 字符都能正确显示。该`STREAM`版本将 Unicode 文本转换为三种不同编码之一（`_UseConsoleConversions`⇒ 控制台代码页 ( `GetConsoleCP`)、`_UseAnsiConversions`⇒ 默认 ANSI 代码页，否则 ⇒ 默认 OEM 代码页），然后将其写出。

这意味着我们不能依赖从流中获取字符。文件重定向不起作用。我们必须依靠写入控制台来获取 Unicode 字符。

解决方法或 hack 是将树写入控制台，然后将缓冲区转储到文件中。

当您在资源管理器中右键单击目录时，我已经编写了添加树上下文菜单的脚本。将文件保存在同一目录中，然后`Install list menu.bat`以管理员身份运行进行安装。

`Install list menu.bat`

```
@echo on

regedit /s "List files.reg"

copy "List.ps1" "%SystemRoot%"

pause 
```

`List files.reg`

```
Windows Registry Editor Version 5.00

; Directory.
[HKEY_LOCAL_MACHINE\Software\Classes\Directory\Shell\List]
"MUIVerb"="List"
"ExtendedSubCommandsKey"="Directory\\ContextMenus\\List"

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\ContextMenus\List\Shell\Files]
"MUIVerb"="Files"

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\ContextMenus\List\Shell\Files\Command]
; powershell -executionPolicy bypass "%SystemRoot%\List.ps1" -type 'files' -directory '%1'
@=hex(2):70,00,6f,00,77,00,65,00,72,00,73,00,68,00,65,00,6c,00,6c,00,20,00,2d,\
  00,65,00,78,00,65,00,63,00,75,00,74,00,69,00,6f,00,6e,00,50,00,6f,00,6c,00,\
  69,00,63,00,79,00,20,00,62,00,79,00,70,00,61,00,73,00,73,00,20,00,22,00,25,\
  00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,00,5c,00,\
  4c,00,69,00,73,00,74,00,2e,00,70,00,73,00,31,00,22,00,20,00,2d,00,74,00,79,\
  00,70,00,65,00,20,00,27,00,66,00,69,00,6c,00,65,00,73,00,27,00,20,00,2d,00,\
  64,00,69,00,72,00,65,00,63,00,74,00,6f,00,72,00,79,00,20,00,27,00,25,00,31,\
  00,27,00,00,00

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\ContextMenus\List\Shell\FilesRecursively]
"MUIVerb"="Files recursively"

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\ContextMenus\List\Shell\FilesRecursively\Command]
; powershell -executionPolicy bypass "%SystemRoot%\List.ps1" -type 'filesRecursively' -directory '%1'
@=hex(2):70,00,6f,00,77,00,65,00,72,00,73,00,68,00,65,00,6c,00,6c,00,20,00,2d,\
  00,65,00,78,00,65,00,63,00,75,00,74,00,69,00,6f,00,6e,00,50,00,6f,00,6c,00,\
  69,00,63,00,79,00,20,00,62,00,79,00,70,00,61,00,73,00,73,00,20,00,22,00,25,\
  00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,00,5c,00,\
  4c,00,69,00,73,00,74,00,2e,00,70,00,73,00,31,00,22,00,20,00,2d,00,74,00,79,\
  00,70,00,65,00,20,00,27,00,66,00,69,00,6c,00,65,00,73,00,52,00,65,00,63,00,\
  75,00,72,00,73,00,69,00,76,00,65,00,6c,00,79,00,27,00,20,00,2d,00,64,00,69,\
  00,72,00,65,00,63,00,74,00,6f,00,72,00,79,00,20,00,27,00,25,00,31,00,27,00,\
  00,00

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\ContextMenus\List\Shell\Tree]
"MUIVerb"="Tree"

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\ContextMenus\List\Shell\Tree\Command]
; powershell -executionPolicy bypass "%SystemRoot%\List.ps1" -type 'tree' -directory '%1'
@=hex(2):70,00,6f,00,77,00,65,00,72,00,73,00,68,00,65,00,6c,00,6c,00,20,00,2d,\
  00,65,00,78,00,65,00,63,00,75,00,74,00,69,00,6f,00,6e,00,50,00,6f,00,6c,00,\
  69,00,63,00,79,00,20,00,62,00,79,00,70,00,61,00,73,00,73,00,20,00,22,00,25,\
  00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,00,5c,00,\
  4c,00,69,00,73,00,74,00,2e,00,70,00,73,00,31,00,22,00,20,00,2d,00,74,00,79,\
  00,70,00,65,00,20,00,27,00,74,00,72,00,65,00,65,00,27,00,20,00,2d,00,64,00,\
  69,00,72,00,65,00,63,00,74,00,6f,00,72,00,79,00,20,00,27,00,25,00,31,00,27,\
  00,00,00

; Directory background.
[HKEY_LOCAL_MACHINE\Software\Classes\Directory\Background\Shell\List]
"MUIVerb"="List"
"ExtendedSubCommandsKey"="Directory\\Background\\ContextMenus\\List"

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\Background\ContextMenus\List\Shell\Files]
"MUIVerb"="Files"

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\Background\ContextMenus\List\Shell\Files\Command]
; powershell -executionPolicy bypass "%SystemRoot%\List.ps1" -type 'files' -directory '%V'
@=hex(2):70,00,6f,00,77,00,65,00,72,00,73,00,68,00,65,00,6c,00,6c,00,20,00,2d,\
  00,65,00,78,00,65,00,63,00,75,00,74,00,69,00,6f,00,6e,00,50,00,6f,00,6c,00,\
  69,00,63,00,79,00,20,00,62,00,79,00,70,00,61,00,73,00,73,00,20,00,22,00,25,\
  00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,00,5c,00,\
  4c,00,69,00,73,00,74,00,2e,00,70,00,73,00,31,00,22,00,20,00,2d,00,74,00,79,\
  00,70,00,65,00,20,00,27,00,66,00,69,00,6c,00,65,00,73,00,27,00,20,00,2d,00,\
  64,00,69,00,72,00,65,00,63,00,74,00,6f,00,72,00,79,00,20,00,27,00,25,00,56,\
  00,27,00,00,00

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\Background\ContextMenus\List\Shell\FilesRecursively]
"MUIVerb"="Files recursively"

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\Background\ContextMenus\List\Shell\FilesRecursively\Command]
; powershell -executionPolicy bypass "%SystemRoot%\List.ps1" -type 'filesRecursively' -directory '%V'
@=hex(2):70,00,6f,00,77,00,65,00,72,00,73,00,68,00,65,00,6c,00,6c,00,20,00,2d,\
  00,65,00,78,00,65,00,63,00,75,00,74,00,69,00,6f,00,6e,00,50,00,6f,00,6c,00,\
  69,00,63,00,79,00,20,00,62,00,79,00,70,00,61,00,73,00,73,00,20,00,22,00,25,\
  00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,00,5c,00,\
  4c,00,69,00,73,00,74,00,2e,00,70,00,73,00,31,00,22,00,20,00,2d,00,74,00,79,\
  00,70,00,65,00,20,00,27,00,66,00,69,00,6c,00,65,00,73,00,52,00,65,00,63,00,\
  75,00,72,00,73,00,69,00,76,00,65,00,6c,00,79,00,27,00,20,00,2d,00,64,00,69,\
  00,72,00,65,00,63,00,74,00,6f,00,72,00,79,00,20,00,27,00,25,00,56,00,27,00,\
  00,00

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\Background\ContextMenus\List\Shell\Tree]
"MUIVerb"="Tree"

[HKEY_LOCAL_MACHINE\Software\Classes\Directory\Background\ContextMenus\List\Shell\Tree\Command]
; powershell -executionPolicy bypass "%SystemRoot%\List.ps1" -type 'tree' -directory '%V'
@=hex(2):70,00,6f,00,77,00,65,00,72,00,73,00,68,00,65,00,6c,00,6c,00,20,00,2d,\
  00,65,00,78,00,65,00,63,00,75,00,74,00,69,00,6f,00,6e,00,50,00,6f,00,6c,00,\
  69,00,63,00,79,00,20,00,62,00,79,00,70,00,61,00,73,00,73,00,20,00,22,00,25,\
  00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,00,5c,00,\
  4c,00,69,00,73,00,74,00,2e,00,70,00,73,00,31,00,22,00,20,00,2d,00,74,00,79,\
  00,70,00,65,00,20,00,27,00,74,00,72,00,65,00,65,00,27,00,20,00,2d,00,64,00,\
  69,00,72,00,65,00,63,00,74,00,6f,00,72,00,79,00,20,00,27,00,25,00,56,00,27,\
  00,00,00 
```

`List.ps1`

```
function sortNaturally {
    [Regex]::replace($_, '\d+', {
        $args[0].value.padLeft(20)
    })
}

function writeList {
    param(
        [parameter(mandatory = $true)]
        [string] $text = $null
    )

    $filePath = "$env:temp\List.txt"
    $text > "$filePath"
    notepad "$filePath" | out-null
    del "$filePath"
}

function listFiles {
    param(
        [switch] $recurse = $false
    )

    get-childItem -name -recurse:$recurse -force | sort-object $function:sortNaturally | out-string
}

function listTree {
    tree /f
}

function getBufferText {
    $rawUi = $host.ui.rawUi
    $width = [Math]::max([Math]::max($rawUi.bufferSize.width, $rawUi.windowSize.width) - 1, 0)
    $height = [Math]::max($rawUi.cursorPosition.y - 1, 0)

    $lines = new-object System.Text.StringBuilder
    $characters = new-object System.Text.StringBuilder

    for ($h = 0; $h -lt $height; $h += 1) {
        $rectangle = new-object System.Management.Automation.Host.Rectangle 0, $h, $width, $h
        $buffer = $rawUi.getBufferContents($rectangle)

        for ($w = 0; $w -lt $width; $w += 1) {
            $cell = $buffer[0, $w]
            $character = $cell.character
            $characters.append($character) | out-null
        }

        $lines.appendLine($characters.toString()) | out-null
        $characters.length = 0
    }

    $lines.toString() -replace '[ \0]*\r?\n', "`r`n"
}

function main {
    param(
        [parameter(mandatory = $true)]
        [string] $type = $null,

        [parameter(mandatory = $true)]
        [string] $directory = $null
    )

    $outputEncoding = [Text.UTF8Encoding]::UTF8
    [Console]::outputEncoding = [Text.UTF8Encoding]::UTF8
    $PSDefaultParameterValues['out-file:encoding'] = 'utf8'

    set-location -literalPath "$directory"

    $typeFunction = @{
        'files' = { writeList -text $(listFiles) };
        'filesRecursively' = { writeList -text $(listFiles -recurse) };
        'tree' = {
            listTree
            writeList -text $(getBufferText)
        }
    }

    &($typeFunction.get_item($type))
}

main @args 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-26T10:59:40.637

如果您输出为非 Unicode（您显然是这样做的），您必须使用控制台窗口使用的相同编码查看您创建的文本文件。这就是它在控制台中看起来正确的原因。在某些文本编辑器中，您可以在打开文件时选择编码（或“代码页”）。（如何输出为 Unicode 我不知道。 cmd /U 没有按照文档所说的那样做。）

控制台编码取决于您的 Windows 安装。对我来说，它是 Microsoft Word 中的“西欧 (DOS)”（或只是“MS-DOS”）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-26T12:54:49.913

我决定我必须看看`tree.com`并弄清楚为什么它不尊重控制台的 Unicode 设置。事实证明（就像许多命令行文件实用程序一样），它使用一个名为的库`ulib.dll`来执行所有打印（特别是`TREE::DisplayName`调用`WriteString`in `ulib`）。

现在，在 中`ulib`，该`WriteString`方法在两个类中实现，`SCREEN`并且`STREAM`。该`SCREEN`版本`WriteConsoleW`直接使用，因此所有 Unicode 字符都能正确显示。该`STREAM`版本将 Unicode 文本转换为三种不同编码之一（`_UseConsoleConversions`⇒ 控制台代码页 ( `GetConsoleCP`)、`_UseAnsiConversions`⇒ 默认 ANSI 代码页，否则 ⇒ 默认 OEM 代码页），然后将其写出。我不知道如何更改转换模式，我不相信可以禁用转换。

我只是简单地看了这个，所以也许更喜欢冒险的灵魂可以更多地谈论它！:-)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-04-18T15:50:05.740

这会将结果保存为 ASCII（美国信息交换标准代码）在您的桌面上，ASCII\ANSI 不能识别每个国际或扩展字符：

```
tree /f > ascii.txt 
```

这会将您的 ASCII 文本转换为 Unicode（/c 必须在实际命令之前）：

```
cmd /u /c type ascii.txt > unicode.txt 
```

那么为什么不把 ascii 文件看作一个临时文件并删除它呢？

```
del ascii.txt 
```

如果您必须将所有内容放在一行中，您可以使用：

```
tree /f > ascii.txt & cmd.exe /u /c type ascii.txt > unicode.txt & del ascii.txt 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-05-04T17:22:20.383

简短的回答是**你不能**，这是因为`tree.com`它是一个 ANSI 应用程序，即使在 Windows 7 上也是如此。

唯一的解决方案是编写自己的`tree`实现。您也可以向 Microsoft 提交错误，但我怀疑他们还没有意识到这一点。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-01-25T08:23:36.300

你可以试试

```
tree /A > output.txt 
```

虽然它看起来与 CMD 线不同，但它仍然可以接受。:P

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-12-19T03:53:07.540

这对我有用：

```
tree /f /a > %temp%\Listing >> files.txt 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-07-10T00:48:50.443

XP1 的答案很好，但有一个小警告：输出编码是 UCS2-LE，而我更喜欢 UTF8（更小的文件大小，更广泛）。

经过*大量*搜索和挠头，我终于可以向您展示以下命令，该命令会生成一个 UTF8-BOM 文件：

```
PowerShell -Command "TREE /F | Out-File output.txt -Encoding utf8" 
```

如果输出文件名有空格：

```
PowerShell -Command "TREE /F | Out-File ""output file.txt"" -Encoding utf8" 
```

非常感谢这篇文章：[https ://www.kongsli.net/2012/04/20/powershell-gotchas-redirect-to-file-encodes-in-unicode/](https://www.kongsli.net/2012/04/20/powershell-gotchas-redirect-to-file-encodes-in-unicode/)

* * *

另外，我个人在我的 PATH 中创建了以下文件：

`xtree.cmd`：

```
@IF [%1]==[] @(
    ECHO You have to specify an output file.
    GOTO :EOF
)

@PowerShell -Command "TREE | Out-File %1 -Encoding utf8" 
```

`xtreef.cmd`：

```
@IF [%1]==[] @(
    ECHO You have to specify an output file.
    GOTO :EOF
)

@PowerShell -Command "TREE /F | Out-File %1 -Encoding utf8" 
```

最后，而不是`tree > output.txt`我只是做`xtree output.txt`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-05-29T13:53:48.470

[我已经设法通过Take Command Console](https://jpsoft.com/downloads/v21/tcc.exe)正确地将树命令中的非 ascii 字符输出到文件中。

在 TCC 中键入“选项”并在第一个选项卡上选择“Unicode 输出”。然后简单地运行

```
tree /f /a > output.txt 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-08-11T20:52:54.267

我已经成功地获得了控制台中的输出，所有非ASCII字符都没有转换，通过输出到控制台（只是`tree`）然后从中复制（系统菜单->编辑->标记，全选，回车） . 控制台缓冲区大小应根据文件/文件夹的数量在控制台的属性（系统菜单 -> 属性）中提前增加。其他方法都不起作用。`tree|clip`，在之前的文章中提到，将非 ascii 字符转换为 ascii 字符，与`tree>file.txt`.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-04-27T21:40:07.403

我使用这种方法对近 100 个 SDRAM 和 USB 闪存驱动器进行了编目，并且效果很好。

从DOS内部......

C:\doskey [enter] {启用方便的键盘快捷键}

C:\tree j:\ >> d:\MyCatalog.txt /a [enter] {j:= is my USB drive ; d:= 是我想要目录的地方；/a = 查看此页面上的其他帖子}

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-07-22T17:48:17.170

XP1 的答案很棒，或者至少是这里最好的答案——tree 命令即使经过这种处理也无法处理某些符号。

但是，至少在我的设置中，这个脚本会生成缺少最后一行的树。虽然我不确定为什么会发生这种情况，但可以通过修改函数 listTree 来修复它，如下所示：

```
function listTree {
    tree /f
    echo .
} 
```

Where`echo .`打印一行让 PowerShell 自由蚕食。这种牺牲满足了它，并且整个树都被输出了。

# c++ - 初始化静态 std::map 在 C++ 中

> ID：138600
> 
> 赞同：496
> 
> 时间：2008-09-26T10:10:45.967
> 
> 标签：c++, stl, stdmap

初始化静态地图的正确方法是什么？我们需要一个静态函数来初始化它吗？

* * *

## 回答 #1

> 赞同：691
> 
> 时间：2008-09-26T10:17:44.530

使用 C++11：

```
#include <map>
using namespace std;

map<int, char> m = {{1, 'a'}, {3, 'b'}, {5, 'c'}, {7, 'd'}}; 
```

使用[Boost.Assign](http://www.boost.org/doc/libs/1_36_0/libs/assign/doc/index.html)：

```
#include <map>
#include "boost/assign.hpp"
using namespace std;
using namespace boost::assign;

map<int, char> m = map_list_of (1, 'a') (3, 'b') (5, 'c') (7, 'd'); 
```

* * *

## 回答 #2

> 赞同：141
> 
> 时间：2008-09-26T10:22:55.983

Best way is to use a function:

```
#include <map>

using namespace std;

map<int,int> create_map()
{
  map<int,int> m;
  m[1] = 2;
  m[3] = 4;
  m[5] = 6;
  return m;
}

map<int,int> m = create_map(); 
```

* * *

## 回答 #3

> 赞同：116
> 
> 时间：2009-11-13T17:37:17.997

制作类似于 boost 的东西并不是一个复杂的问题。这是一个只有三个函数的类，包括构造函数，用于复制 boost 所做的（几乎）。

```
template <typename T, typename U>
class create_map
{
private:
    std::map<T, U> m_map;
public:
    create_map(const T& key, const U& val)
    {
        m_map[key] = val;
    }

    create_map<T, U>& operator()(const T& key, const U& val)
    {
        m_map[key] = val;
        return *this;
    }

    operator std::map<T, U>()
    {
        return m_map;
    }
}; 
```

用法：

```
std::map mymap = create_map<int, int >(1,2)(3,4)(5,6);

```

上面的代码最适合初始化需要初始化的全局变量或类的静态成员，您不知道何时首先使用它，但您想确保其中的值可用。

如果说，您必须将元素插入到现有的 std::map 中......这是另一个适合您的类。

```
template <typename MapType>
class map_add_values {
private:
    MapType mMap;
public:
    typedef typename MapType::key_type KeyType;
    typedef typename MapType::mapped_type MappedType;

    map_add_values(const KeyType& key, const MappedType& val)
    {
        mMap[key] = val;
    }

    map_add_values& operator()(const KeyType& key, const MappedType& val) {
        mMap[key] = val;
        return *this;
    }

    void to (MapType& map) {
        map.insert(mMap.begin(), mMap.end());
    }
}; 
```

用法：

```
typedef std::map<int, int> Int2IntMap;
Int2IntMap testMap;
map_add_values<Int2IntMap>(1,2)(3,4)(5,6).to(testMap); 
```

在此处使用 GCC 4.7.2 查看它：http: [//ideone.com/3uYJiH](http://ideone.com/3uYJiH)

**##############下面的所有内容都已过时#################**

**编辑**：`map_add_values`下面的课程是我建议的原始解决方案，当涉及到 GCC 4.5+ 时会失败。请查看上面的代码，了解如何向现有地图**添加**值。

```
 template<typename T, typename U>
class map_add_values
{
private:
    std::map<T,U>& m_map;
public:
    map_add_values(std::map<T, U>& _map):m_map(_map){}
    map_add_values& operator()(const T& _key, const U& _val)
    {
        m_map[key] = val;
        return *this;
    }
};
```

用法：

```
std::map<int, int> my_map;
// 稍后在代码中的某个地方
map_add_values<int,int>(my_map)(1,2)(3,4)(5,6);
```

注意：以前我使用 a`operator []`添加实际值。正如 dalle 所评论的那样，这是不可能的。

**#################### 过时部分结束#####################**

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2010-01-19T20:06:02.573

这是使用 2 元素数据构造函数的另一种方法。不需要任何函数来初始化它。没有第 3 方代码（Boost），没有静态函数或对象，没有技巧，只有简单的 C++：

```
#include <map>
#include <string>

typedef std::map<std::string, int> MyMap;

const MyMap::value_type rawData[] = {
   MyMap::value_type("hello", 42),
   MyMap::value_type("world", 88),
};
const int numElems = sizeof rawData / sizeof rawData[0];
MyMap myMap(rawData, rawData + numElems); 
```

自从我写了这个答案后，C++11 就出来了。您现在可以使用新的初始化列表功能直接初始化 STL 容器：

```
const MyMap myMap = { {"hello", 42}, {"world", 88} }; 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2016-12-28T19:51:27.137

例如：

```
const std::map<LogLevel, const char*> g_log_levels_dsc =
{
    { LogLevel::Disabled, "[---]" },
    { LogLevel::Info,     "[inf]" },
    { LogLevel::Warning,  "[wrn]" },
    { LogLevel::Error,    "[err]" },
    { LogLevel::Debug,    "[dbg]" }
}; 
```

如果map是一个类的数据成员，可以直接在header中初始化，方法如下（C++17起）：

```
// Example

template<>
class StringConverter<CacheMode> final
{
public:
    static auto convert(CacheMode mode) -> const std::string&
    {
        // validate...
        return s_modes.at(mode);
    }

private:
    static inline const std::map<CacheMode, std::string> s_modes =
        {
            { CacheMode::All, "All" },
            { CacheMode::Selective, "Selective" },
            { CacheMode::None, "None" }
            // etc
        };
}; 
```

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2008-09-26T10:19:19.033

我会将地图包装在一个静态对象中，并将地图初始化代码放入该对象的构造函数中，这样您就可以确保在执行初始化代码之前创建地图。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2014-07-10T17:56:56.493

只是想分享一个纯 C++ 98 解决方法：

```
#include <map>

std::map<std::string, std::string> aka;

struct akaInit
{
    akaInit()
    {
        aka[ "George" ] = "John";
        aka[ "Joe" ] = "Al";
        aka[ "Phil" ] = "Sue";
        aka[ "Smitty" ] = "Yando";
    }
} AkaInit; 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2016-09-10T07:33:33.630

你可以试试：

```
std::map <int, int> mymap = 
{
        std::pair <int, int> (1, 1),
        std::pair <int, int> (2, 2),
        std::pair <int, int> (2, 2)
}; 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2009-11-13T19:06:02.157

这类似于`PierreBdR`，无需复制地图。

```
#include <map>

using namespace std;

bool create_map(map<int,int> &m)
{
  m[1] = 2;
  m[3] = 4;
  m[5] = 6;
  return true;
}

static map<int,int> m;
static bool _dummy = create_map (m); 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2017-03-07T13:47:34.260

如果你被 C++98 卡住并且不想使用 boost，这里有我在需要初始化静态映射时使用的解决方案：

```
typedef std::pair< int, char > elemPair_t;
elemPair_t elemPairs[] = 
{
    elemPair_t( 1, 'a'), 
    elemPair_t( 3, 'b' ), 
    elemPair_t( 5, 'c' ), 
    elemPair_t( 7, 'd' )
};

const std::map< int, char > myMap( &elemPairs[ 0 ], &elemPairs[ sizeof( elemPairs ) / sizeof( elemPairs[ 0 ] ) ] ); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-03-15T09:05:10.563

除了使用的最佳答案之外

```
const std::map<int, int> m = {{1,1},{4,2},{9,3},{16,4},{32,9}} 
```

通过直接调用在某些情况下可能有用的 lambda 还有另一种可能性：

```
const std::map<int, int> m = []()->auto {
  std::map<int, int> m;
  m[1]=1;
  m[4]=2;
  m[9]=3;
  m[16]=4;
  m[32]=9;
  return m;
}(); 
```

显然，使用文字值从头开始编写时，一个简单的初始化列表会更好，但它确实开辟了其他可能性：

```
const std::map<int, int> m = []()->auto {
  std::map<int, int> m;
  for(int i=1;i<5;++i) m[i*i]=i;
  m[32]=9;
  return m;
}(); 
```

（显然，如果您想重新使用它，它应该是一个正常的功能；这确实需要最近的 C++。）

* * *

## 回答 #12

> 赞同：-6
> 
> 时间：2014-07-05T09:31:04.490

你在这里有一些很好的答案，但我对我来说，这看起来像是“当你所知道的只是一把锤子”......

为什么没有标准方法来初始化静态地图的最简单答案是没有充分的理由使用静态地图......

地图是为快速查找一组未知元素而设计的结构。如果您事先知道元素，只需使用 C 数组。以排序方式输入值，或者对它们运行排序，如果您不能这样做。然后，您可以通过使用 stl::functions 循环条目 lower_bound/upper_bound 来获得 log(n) 性能。当我之前对此进行测试时，它们的执行速度通常比地图快至少 4 倍。

优点很多... - 更快的性能（*4，我在许多 CPU 类型上测量过，它总是在 4 左右） - 更简单的调试。更容易看到线性布局发生了什么。- 如果有必要，复制操作的简单实现。- 它在运行时不分配内存，因此永远不会抛出异常。- 这是一个标准接口，因此很容易在 DLL 或语言等之间共享。

我可以继续说下去，但如果你想要更多，为什么不看看 Stroustrup 关于这个主题的许多博客。

# mysql - 简单的 ColdFusion 脚本在 IE 中有效，但在 Firefox 中无效？

> ID：138607
> 
> 赞同：4
> 
> 时间：2008-09-26T10:15:35.737
> 
> 标签：mysql, firefox, coldfusion, internet-explorer-7

我有一个非常简单的脚本，可以更改 MySql 数据库中项目的状态 - 它在 IE7 中运行良好，但如果我在 Firefox 中尝试它，它看起来很有效，但没有......这是非常奇怪的。

代码非常简单 - 首先我得到了我正在寻找的记录的详细信息：

```
<cfscript>
// Get the Product Attribute details
Arguments.qGetProductAttribute = Application.cfcProducts.getProductAttributes(Arguments.iProductAttributeID);
</cfscript> 
```

这工作正常，如果我转储结果，它只是预期的记录内容。因此，我使用 if 语句将“活动”字段从 1 更改为 0，反之亦然。

```
<!--- If Product Attribute is active, mark as inactive --->
<cfif Arguments.qGetProductAttribute.bActive EQ 0>
    <cfquery name="qChangeStatus" datasource="#Request.sDSN#">
    UPDATE  tblProductAttributes
    SET     bActive = <cfqueryparam value="1" cfsqltype="CF_SQL_INTEGER" maxlength="1" />
    WHERE   iProductAttributeID = <cfqueryparam value="#Arguments.iProductAttributeID#" cfsqltype="CF_SQL_INTEGER" />;
    </cfquery>

<!--- Else if Product Attribute is inactive, mark as active --->
<cfelseif Arguments.qGetProductAttribute.bActive EQ 1>
    <cfquery name="qChangeStatus" datasource="#Request.sDSN#">
    UPDATE  tblProductAttributes
    SET     bActive = <cfqueryparam value="0" cfsqltype="CF_SQL_INTEGER" maxlength="1" />
    WHERE   iProductAttributeID = <cfqueryparam value="#Arguments.iProductAttributeID#" cfsqltype="CF_SQL_INTEGER" />;
    </cfquery>
</cfif> 
```

我看不出有任何理由让它不起作用......事实上，在 IE7 中它完美地工作......

运行此脚本后会发生什么，浏览器会返回显示所有这些记录的页面。对于每条记录，如果“bActive”字段设置为“1”，它将显示单词“Active”，如果设置为“零”，它将显示“Disabled”。很简单。

如果我运行脚本来禁用记录，Firefox 实际上会按预期显示“禁用”一词，但数据库记录不会改变！

我不知所措......服务器端代码如何在一个浏览器中正常工作而不在另一个浏览器中工作？！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T10:34:47.907

您是否 100% 确定数据库记录不会更改？如果 Firefox 两次调用您的脚本，您可能会受到这种影响，一次是在呈现页面之前，一次是在呈现页面之后。

所以产品被设置为禁用，然后在页面发送到浏览器后它会再次更新（并且由于它已经被禁用，它被重新启用）。

如果您已将最后更新字段添加到数据库并在每次修改产品时更新，那么您将能够判断是否是这种情况。

编辑：回应下面的评论，一个快速+肮脏的修复将是首先检查最后一个更新时间戳，如果它在当前时间的 n 秒内关闭更新。

Firefox 中是否有任何可能重新调用页面的插件？也许出于开发目的？一个简单的测试，看看它是你的脚本还是 Firefox 中的一个怪癖，是将你的 get url 更改为带有 post 方法的表单，因为浏览器/插件不应该重新调用 post 请求。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T17:39:39.423

我找到了问题的原因...... Firebug。

我一点也不知道 Firebug 认为它在做什么，如果我从脚本中删除“cflocation”标签（将用户带回摘要页面的那个），那么它工作正常。但如果我保留它，Firebug 似乎会在将浏览器转发到摘要页面之前再次运行该功能。

它没有理由这样做。难以置信。

至少它不会发生在客户的机器上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T16:34:07.627

这可能是浏览器缓存问题。直接的 CF 代码不可能受到正在使用的浏览器的影响。如果刷新显示产品的页面会发生什么？您还需要直接查看数据库以查看值是否正在更改。

稍微有点切线，您可以通过一些简单的数学运算完全消除对 if 语句的需要。

```
<cfquery name="qChangeStatus" datasource="#Request.sDSN#">
    UPDATE  tblProductAttributes
    SET
         bActive = <cfqueryparam value="#val(1 - Arguments.qGetProductAttribute.bActive)#" cfsqltype="CF_SQL_INTEGER" maxlength="1" />
    WHERE   
        iProductAttributeID = <cfqueryparam value="#Arguments.iProductAttributeID#" cfsqltype="CF_SQL_INTEGER" />;
</cfquery> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T17:12:00.560

您发布的代码不是错误的原因，因为它都是服务器端代码 - 那里的客户端没有任何事情发生。

我会打开 CF 调试（包括数据库活动）并在结束标记之后以及任何重定向回产品视图页面之前粘贴一个标记。运行代码并查看 SQL 调试输出。

我的猜测是，当使用 Firefox 时，包含查询的代码块不会被调用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T14:18:22.913

尝试删除 SQL 代码中 WHERE 子句末尾的分号。

```
WHERE   iProductAttributeID = <cfqueryparam value="#Arguments.iProductAttributeID#" cfsqltype="CF_SQL_INTEGER" />; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T20:27:12.843

所有这些不同的答案，但没有一个对我有用。我不得不去另一个论坛，那里有人说是 Firefox 中的 Skype 扩展插件导致 ColdFusion 数据库发疯或无法运行。我卸载了 Skype 扩展程序（谢谢你，Skype），一切恢复正常。希望这也适用于其他人。

# sql-server - Sql Server 2005 效率节省？

> ID：138608
> 
> 赞同：2
> 
> 时间：2008-09-26T10:16:36.077
> 
> 标签：sql-server, performance, upgrade

与 Sql Server 2000 相比，使用 Sql Server 2005 是否有很好的效率节省？

或者它只是有更多的服务等

有没有人看到他们的系统在升级后工作得更快了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T10:25:45.493

诸如分析服务等周边工具已被大量重写，可以根据您的要求为您带来各种胜利。但是，我没有看到核心数据库引擎从 2000 年到 2005 年有很多真正根本性的变化。

有一些改进可能会在某些情况下让您获得更好的性能。SQL2005 比 SQL2000 对 64 位体系结构和更好的表分区有更好的支持（您可以对表进行分区，而不是制作分区视图）。64 位支持最有可能在大型系统上为您带来性能优势，因为它允许您设置更大的缓存。

除了这些功能，我不相信真的有很大的不同。可能有一些小的性能调整。

从 SQL2000 迁移到 SQL2005 的主要原因是当 SQL2000 不再支持时。如果您有一个在 SQL2000 上运行的应用程序，那么在 Microsoft 仍然支持 2000 的情况下切换到 2005 并没有太多令人信服的理由。

迁移到 SQL2005 后，数据仓库系统将获得相当多的胜利。SSIS、SSAS2005 和 SSRS2005 比它们的 SQL2000 对应物要好得多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T10:31:29.380

2005 提供了 MVCC - 基本上是行级版本控制 - 因此作为开发人员有一些效率：更少的锁定担心。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T10:43:45.963

从 2000 年到 2005 年，我没有迁移过一个系统——我要么从一个开始，要么从另一个开始——所以我没有自己的比较。但是您很有可能会看到性能差异；如果不是利用快照隔离等一些新特性，那么至少由于 SQL2005 的许可模型允许您在不增加许可成本的情况下使用多核，并且 SQL2005 改进了内存管理这一事实.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T11:29:56.743

到 2005 年，事情绝对会运行得更快。对查询优化器进行了几项改进。现在您可以创建覆盖索引，以便包含的列仅存在于叶级别，而不必进行排序。仅此一项就是一个巨大的改进，并且足以升级。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T17:05:51.963

SQL 2005 在处理缓存方面做得更好。您过去必须定期轮询 SQL 2000 以检查对整个表的更新。现在，您可以在发生变化时订阅通知。它也适用于查询、表格和其他一些元素。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T18:05:21.930

出于其他人列出的所有原因，我会说是的，但是即使您的 SQL 技能不是那么强大并且您的查询也不是那么好，它们可能会在 2005 年运行得更快。我们从 2000 年搬到了 2005 年，我们有一些复杂的查询我们无法在 2000 年得到适当的优化。当我们搬到 2005 年时，它吃掉了查询！显然，优化器正在做出更好的开箱即用决策。

除非您对 2000 没有任何问题，否则我强烈建议您改用 2005。

# c++ - 如何在 C++ 中将自定义项添加到系统菜单？

> ID：138616
> 
> 赞同：5
> 
> 时间：2008-09-26T10:19:11.437
> 
> 标签：c++, enumeration

我需要枚举所有正在运行的应用程序。特别是所有顶部窗口。对于每个窗口，我都需要将自定义项添加到该窗口的系统菜单中。

我怎样才能在 C++ 中做到这一点？

**更新。**

我非常乐意为 Windows、MacOS 和 Ubuntu 提供解决方案（不过，我不确定 MacOS 和 Ubuntu 是否有“系统菜单”之类的东西）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T11:34:26.950

对于 Windows，获取顶层窗口的另一种方法（除了使用回调的 EnumWindows 之外）是获取桌面的第一个子级，然后检索其所有兄弟：

```
HWND wnd = GetWindow(GetDesktopWindow(), GW_CHILD);
while (wnd) {
    // handle 'wnd' here
    // ...
    wnd = GetNextWindow(wnd, GW_HWNDNEXT);
} 
```

至于获取*系统*菜单，使用[`GetSystemMenu`](http://msdn.microsoft.com/en-us/library/ms647985(VS.85).aspx)函数，第二个参数为FALSE。其他答案中[`GetMenu`](http://msdn.microsoft.com/en-us/library/ms647640(VS.85).aspx)提到的返回*正常*的窗口菜单。

但是请注意，虽然将自定义菜单项添加到外部进程的窗口很容易，但响应该项目的选择却有点棘手。您要么必须向进程注入一些代码才能对窗口进行子类化，要么安装一个全局挂钩（可能是 a`WH_GETMESSAGE`或`WH_CBT`类型）来监视`WM_SYSCOMMAND`消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T10:34:37.813

一旦你有了另一个窗口的顶级句柄，你就可以调用[GetMenu()](http://msdn.microsoft.com/en-us/library/ms647640(VS.85).aspx)来检索窗口的系统菜单，然后对其进行修改，例如：

```
HMENU hMenu = GetMenu(hwndNext); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T11:11:31.250

回复：更新 - 请注意，即使 Microsoft Windows 也不要求 Windows 具有系统菜单。GetMenu() 可能返回 0。您还需要拦截窗口创建，因为每个新的顶部窗口可能也需要它。

此外，您提出的建议对其他应用程序具有相当的侵入性。当您修改他们的菜单时，您将如何确保它们不会中断？你将如何确保你压制这些信息？特别是，您将如何确保在其他人看到它们之前拦截它们？引用 Raymond Chen 的话，想象一下如果两个程序都尝试这样做会发生什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T10:37:10.723

您可以使用[EnumWindows()](http://msdn.microsoft.com/en-us/library/ms633497(VS.85).aspx)枚举顶级 Windows。

对于您问题的第二部分，我没有具体的答案，但是如果您将窗口子类化，我想您可以修改系统菜单。

编辑：或者按照克里斯所说的去做：调用 GetMenu()

# java - 如何使用 JSF 和导航规则创建带参数的 GET 请求？

> ID：138617
> 
> 赞同：11
> 
> 时间：2008-09-26T10:19:12.247
> 
> 标签：java, jsf, redirect, navigation

有没有办法使用 h:outputLink、其他 JSF 标记或代码创建带有请求参数的非面孔请求 (HTTP GET) 的 html 链接？

例如我有以下导航规则

```
<navigation-rule>
    <navigation-case>
        <from-outcome>showMessage</from-outcome>
        <to-view-id>/showMessage.jsf</to-view-id>
        <redirect/>
    </navigation-case>
</navigation-rule> 
```

在我的页面中，我想输出以下 html 代码：

```
<a href="/showMessage.jsf?msg=23">click to see the message</a> 
```

我可以只在页面中编写 html 代码，但我想使用导航规则以便在单个可配置文件中定义所有 url。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T15:00:42.967

这是一个有趣的想法。我很想知道它在实践中的表现如何。

**获取导航规则**

导航由[NavigationHandler](http://java.sun.com/javaee/javaserverfaces/1.1_01/docs/api/javax/faces/application/NavigationHandler.html)处理。掌握 NavigationHandler 并不困难，但 API 不会公开它使用的规则。

如我所见，您可以：

1.  在初始化时解析 faces-config.xml 并将规则存储在应用程序上下文中（*简单*）
2.  实现您自己的 NavigationHandler 忽略 faces-config.xml 中的规则或用您自己的规则文件补充它们并以某种方式公开其规则集（*可行，但需要一些工作*）
3.  模拟你自己的[FacesContext](http://java.sun.com/javaee/javaserverfaces/1.1_01/docs/api/javax/faces/context/FacesContext.html)并将其传递给现有的导航处理程序（*真的很难让两个 FacesContext 对象在同一个线程中共存并且效率极低*）

现在，你还有另一个问题。您要将映射保存在哪里以查找视图？将它们硬编码在 bean 中？

**使用导航规则**

顺便说一句，我可以想到两种可以从后端构造包含参数的 URL 的方法。两者都涉及定义某种 bean。

```
<managed-bean>
    <managed-bean-name>navBean</managed-bean-name>
    <managed-bean-class>foo.NavBean</managed-bean-class>
    <managed-bean-scope>application</managed-bean-scope>
</managed-bean> 
```

来源：

```
package foo;

import java.io.IOException;
import java.io.Serializable;
import java.net.URLEncoder;

import javax.faces.context.ExternalContext;
import javax.faces.context.FacesContext;

public class NavBean implements Serializable {

    private String getView() {
        String viewId = "/showMessage.faces"; // or look this up somewhere
        return viewId;
    }

    /**
     * Regular link to page
     */
    public String getUrlLink() {
        FacesContext context = FacesContext.getCurrentInstance();
        ExternalContext extContext = context.getExternalContext();
        String viewId = getView();
        String navUrl = context.getExternalContext().encodeActionURL(
                extContext.getRequestContextPath() + viewId);
        return navUrl;
    }

    /**
     * Just some value
     */
    public String getValue() {
        return "" + System.currentTimeMillis();
    }

    /**
     * Invoked by action
     */
    public String invokeRedirect() {
        FacesContext context = FacesContext.getCurrentInstance();
        ExternalContext extContext = context.getExternalContext();
        String viewId = getView();
        try {
            String charEncoding = extContext.getRequestCharacterEncoding();
            String name = URLEncoder.encode("foo", charEncoding);
            String value = URLEncoder.encode(getValue(), charEncoding);
            viewId = extContext.getRequestContextPath() + viewId + '?' + name
                    + "=" + value;
            String urlLink = context.getExternalContext().encodeActionURL(
                    viewId);
            extContext.redirect(urlLink);
        } catch (IOException e) {
            extContext.log(getClass().getName() + ".invokeRedirect", e);
        }
        return null;
    }

} 
```

**得到**

对于 GET 请求，您可以使用 UIParameters 设置值并让渲染器构建参数列表。

```
<h:outputLink value="#{navBean.urlLink}">
    <f:param name="foo" value="#{navBean.value}" />
    <h:outputText value="get" />
</h:outputLink> 
```

**邮政**

如果您想在 POST 操作期间将 URL 设置为视图，您可以在操作中使用重定向（由按钮或 commandLink 调用）。

```
<h:commandLink id="myCommandLink" action="#{navBean.invokeRedirect}">
    <h:outputText value="post" />
</h:commandLink> 
```

**笔记**

请注意，[ExternalContext.encodeActionURL](http://java.sun.com/javaee/javaserverfaces/1.1_01/docs/api/javax/faces/context/ExternalContext.html#encodeActionURL(java.lang.String))用于对字符串进行编码。这是生成可跨上下文（portlet 等）移植的代码的良好实践。如果您正在对图像或下载文件的链接进行编码，您将使用*encodeResourceURL 。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-03T19:18:53.813

尝试使用 PrettyFaces？它是一个开源 JSF 扩展，专门设计用于使带有 GET 请求的可收藏 JSF 页面/JSF 成为可能。

[PrettyFaces - JSF / JSF2 的 SEO、动态参数、书签和导航](http://ocpsoft.com/prettyfaces "PrettyFaces - JSF / JSF2 的 SEO、动态参数、书签和导航")

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T13:52:30.540

你考虑过表格吗？

```
<h:form>
    <h:commandLink value="Click to see the message" action="#{handler.outcome}" />
    <h:inputHidden id="msgId" value="#{bean.msgId}"/>
</h:form> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T18:46:34.073

您可以使用带有嵌套参数标签的 commandLink。这和上面说的 hubbardr 基本一样：

```
<h:form>
  <h:commandLink value="click here" action="${handler.outcome}">
    <f:param name="msgId" value="${bean.id}" />
  </h:commandLink>
</h:form> 
```

然后在你的backing bean中你需要做：

```
Map requestMap = FacesContext.getCurrentInstance()
                 .getExternalContext().getRequestParameterMap();
String msgId = (String) requestMap.get("msgId"); 
```

然后做任何你需要做的事情。

# object - LabVIEW对象

> ID：138624
> 
> 赞同：3
> 
> 时间：2008-09-26T10:20:25.600
> 
> 标签：object, labview

我有一个基类对象数组，我将许多不同的子类对象类型转换到其中，并将其传递给子 vi。有什么方法可以找出数组中每个元素的对象的原始类型？

谢谢 ...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T20:23:27.510

对于后代，这被交叉发布到[LAVA](http://forums.lavag.org/Finding-Object-type-t12034.html&p=52521#entry52521 "岩浆")论坛。用户 Aristos Queue 是 LabVIEW 原生 OO 功能的开发者之一，他回答如下：

> 在每个类中使用动态调度方法是处理此问题的推荐方法，尽管建议是创建一个方法来执行您尝试执行的任何操作。我猜你正在考虑一个动态调度方法，它返回对象的名称或 ID，所以你可以说，“它等于这个吗？好的，那么它一定是这个类......”然后你如果是那个班级，请执行动作 X。如果您编写一个动态调度方法 ActionX.vi 然后适当地覆盖它，您将节省性能并在将来有更容易的时间进行代码维护。
> 
> 您还可以使用 To More Specific 节点来测试给定对象是否可以向下转换为给定类型——这允许进行继承测试，而不是只进行类型等效的名称或 ID 比较。如果 To More Specific 节点返回错误，则它不是目标类型。
> 
> 所以你的选择是（按优先顺序）：
> 
> *   执行动作的动态调度方法
> *   到更具体的节点做类型测试
> *   动态调度方法，返回对象类的名称/ID
> *   获取 LabVIEW Object.vi 的路径（在 LabVIEW 8.5 中的 vi.lib 中提供，但直到 LabVIEW 8.6 才添加到选项板中）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T15:14:57.190

NI[对 LVOOP 有很好的概述，](http://zone.ni.com/devzone/cda/tut/p/id/3574)这是一本必读的书，因为 OO 以 LabVIEW 的独特方式实现。

您是否在应用程序控制面板上尝试过“ [to more generic class](http://zone.ni.com/reference/en-XX/help/371361B-01/glang/to_more_generic_class/) ”和“ [to more specific class ”功能？](http://zone.ni.com/reference/en-XX/help/371361D-01/glang/to_more_specific_class/)

# java - Hibernate 全局过滤标准

> ID：138631
> 
> 赞同：2
> 
> 时间：2008-09-26T10:21:45.020
> 
> 标签：java, hibernate

有没有办法在会话工厂（配置）级别添加一个标准，该标准将适用于使用 Session 检索到的*所有*实体？我们要求不要从我们的数据库中删除任何行，而是“标记”已删除的实体，这样它们就不会参与任何进一步的操作。

我知道我们可以通过一个公共接口（例如一个公共基础 Dao 对象）来检索所有实体，但是使用全局过滤的方法不太容易出错，因为它不需要使用这个公共接口的知识。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T12:10:35.137

[Hibernate 文档](http://www.hibernate.org/hib_docs/reference/en/html/filters.html)对此进行了详细说明。看起来处理这个问题的最好方法是使用过滤器。

首先，您在类或集合上定义一个 fitler，如下所示：

```
<filter-def name="IsDeletedFilter">
  <filter-param name="IsDeleted" type="bool"/>
</filter-def> 
```

然后将其附加到类或集合中：

```
<class/set  ...>
...
<filter name="IsDeletedFilter" condition=":IsDeleted = Is_Deleted"/> 
```

唉，你必须对你想要软删除的每个类都这样做。但是您可能能够映射出一个基类`SoftDeleteEntity`并为每个子类层次结构创建一个表。

我还看到有些人声称能够与听众一起做到这一点，尽管我不知道如何做到这一点。

# c# - 我可以将另一个 .net 命名空间中的类公开为我的命名空间中的类吗？

> ID：138638
> 
> 赞同：3
> 
> 时间：2008-09-26T10:26:11.763
> 
> 标签：c#, .net, namespaces

我可以将另一个 .net 命名空间中的类公开为我的命名空间中的类吗？我使用一个类——antlr.collections.AST——作为属于我的命名空间中一个类的函数的返回类型；因此，用户必须拥有

```
using antlr.collections;
using myNamespace; 
```

在他们文件的顶部，以便使用我的功能。我可以让 myNamespace.AST 成为 antlr.collections.AST 的别名，这样用户只需拥有

```
using myNamespace; 
```

在他们文件的顶部？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T11:10:07.993

请记住，您的代码的使用者实际上*不需要*使用 using 语句。这些是为了让他们的生活更轻松，所以他们不必在源代码中输入 antlr.collections.Foo 和 antlr.collections.Bar。

更大的“影响”（如果确实存在严重影响）是您的代码的使用者将需要对定义 antlr.collections 的程序集的硬引用。

但是，如果这是预先记录的，老实说，我认为这不是什么大问题。它与需要对生成的 DAL 程序集和原始 SubSonic 程序集的引用的 SubSonic 生成的 DAL 的消费者没有什么不同。（而且，很可能，也使用语句。）

依赖关系就是它们。将类分解为命名空间是有原因的——主要是为了组织和减少命名冲突。不知道你提到的命名空间中有哪些类，我不知道在你的场景中这种冲突实际上有多大可能......但是试图将类从一个命名空间移动到另一个命名空间，或者隐藏需要这样的事实通过从中派生一个空白类，可能不是最好的主意。拥有另一个引用和使用语句不会杀死您班级的消费者。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T10:29:02.507

在新命名空间中使用相同名称派生一个类怎么样？我的意思是：

```
namespace MyForms {
    class Class1 : Some.Other.Namespace.Class1 {
        // ...
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T10:38:00.923

创建一个继承新命名空间中的类的新类。这并不理想，但它对单元测试等很有用。

但是，您应该考虑为什么要这样做，类被分解为命名空间是有原因的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T10:33:20.013

不，你不能。

类的完整路径和名称是其身份的一部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T11:57:06.137

如果您从该类派生并返回您的派生类，您将自己负责提供返回类型的所有文档。

我认为你会对使用你的库的开发人员造成伤害，因为他们不一定知道他们真正使用的是来自 antir.collections 的类型（我什至不知道那是什么，但那不是点）。如果开发人员来到 StackOverflow.com 搜索有关该返回类型的信息，他们是否更有可能找到来自“通用”库或来自您的类型的信息？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T13:57:20.483

唯一的解决方案是隐藏对 antlr.collections.AST 类型的整个依赖。

您可以为此目的使用[适配器。](http://en.wikipedia.org/wiki/Adapter_pattern)

# cvs - CVS 中的功能分支？

> ID：138641
> 
> 赞同：5
> 
> 时间：2008-09-26T10:28:25.800
> 
> 标签：cvs, version-control, branch

我有义务在这个特定项目中使用 CVS，所以即使我真的想切换到其他东西，比如 Git，我也不能。

所以，我真正的问题是这样的：我们有一个约定，每次发布时我们都会在 CVS 中创建一个新分支（我们也标记，但这不是重点）。我们称这些版本分支，它们使我们能够轻松地检查特定版本并对其进行热修复更改 - 这就是我们的次要版本。

但是现在我有一些大的、充满风险的变化即将到来，如果我在 Git 中工作，我会在眨眼之间创建一个功能分支。然而，在 CVS 中工作时，我尝试在另一个项目中创建功能分支，但很快发现事情变得一团糟。我最终得到了很多分支，但我忘记了哪些分支已同步，哪些需要合并，哪些不再使用。

那么，接近问号，在 CVS 中使用特征分支是否可行？它们是不是太麻烦而不值得，还是我最终会因为不使用它们而感到抱歉？我是否应该硬着头皮开始在 HEAD 中编码，但要弯曲我的编码过程，以尽可能不引人注意的方式引入更改？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T10:50:53.123

如果您是唯一一个在功能分支上进行开发的人，您可以简单地将 Git 作为您的“沙盒开发”系统，然后在完成更改后，将它们合并到您的 CVS 存储库中。

您仍然可以获得中间工作产品的源代码控制的好处。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T12:39:47.610

对称为[流线](http://www.cmcrossroads.com/bradapp/acme/branching/)的分支策略进行了精彩的讨论，这可能会有所帮助 - 它描述了使用特征分支的优点和缺点。

它还涵盖了您可能希望实施的代码行所有权和策略选项

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T10:47:39.403

需要考虑的一件事是，在完成功能分支后，在将其与主干合并后实际**关闭它。**在这种情况下，关闭只是意味着放弃分支，而不是真正的删除。

一旦工作被合并，分支就真的没有必要“存在”了。

为了快速识别哪些分支是功能分支，我建议使用命名约定泄漏“FEAT_MY_FEATURE”或“FEAT_20080926”（开始日期？）。这将使在浏览存储库结构时忽略所有这些功能分支变得容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T13:47:50.630

我已经在这样的环境中工作了几年，这是一种常见的做法，而且真的很痛苦。确保合并是您项目计划的一部分，因为它们会消耗大量时间并且是延迟的来源。

记录分支并为它们分配特定职责会有所帮助。

我们必须创建一个工具来帮助我们逐步合并更改（一次一个更改，而不是合并分支的尖端），因为如果两个分支出现分歧，CVS 的表现就不好。

经常同步（至少每周一次）。

我认为回想起来解决这个问题的最佳方法是确保差异保持最小，并通过使用 Scrum 将风险开发划分为不同的里程碑。

我还鼓励您阅读[SCM 模式](http://www.scmpatterns.com/book/)。这本书包含了很多很好的建议。

# ruby-on-rails - 使用 form_remote_for() 成功验证后如何重定向页面？

> ID：138643
> 
> 赞同：0
> 
> 时间：2008-09-26T10:29:02.880
> 
> 标签：ruby-on-rails

我正在使用 form_remote_for() 对表单的数据进行验证，以便我的 rails 应用程序可以在不重新加载页面的情况下显示用户错误。如果没有错误，我在重定向页面时遇到问题。这是我的代码：

```
def create
  # Validate the data
  if error_count > 0
    render :update do |page|
      page.replace_html(div_id, error_text)
    end
  else
    # Save the data
    redirect_to(page_to_go_to)
  end
end 
```

除了重定向之外，此方法中的所有内容都可以正常工作。服务器声称它进行了成功的重定向，我相信它是被重定向的 AJAX 调用。我想要发生的是包含要重定向的表单的页面。那可能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T10:44:55.463

我对此进行了更多思考，并意识到我需要重定向页面而不是我正在处理的请求。所以我尝试了以下方法，效果很好。

```
def create
  # Validate the data
  if error_count > 0
    render :update do |page|
      page.replace_html(div_id, error_text)
    end
  else
    # Save the data
    render :update do |page|
      page.redirect_to(page_to_go_to)
    end
  end
end 
```

# javascript - 如何确定页面中是否定义了 JavaScript 变量？

> ID：138669
> 
> 赞同：118
> 
> 时间：2008-09-26T10:41:04.940
> 
> 标签：javascript

如果在页面中定义了变量，我如何检查 JavaScript？假设我想检查一个名为“x”的变量是否在页面中定义，如果我这样做`if(x != null)`，它会给我一个错误。

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2008-09-26T10:44:01.503

我让它使用`if (typeof(x) != "undefined")`

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-09-26T19:39:00.537

为了避免意外赋值，我养成了颠倒条件表达式顺序的习惯：

```
if ('undefined' !== typeof x) { 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-26T11:30:43.807

与其他运算符不同，typeof 运算符在与未声明的符号一起使用时不会引发 ReferenceError 异常，因此可以安全使用...

```
if (typeof a != "undefined") {
    a();
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-08T12:46:55.937

你可以这样做：

if (window.x !== undefined) { // 你在这里编码 }

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-08T17:51:24.027

正如其他人所提到的，`typeof`操作员甚至可以评估未声明的标识符而不会引发错误。

```
alert (typeof sdgfsdgsd); 
```

将显示“未定义”，其中类似

```
alert (sdgfsdgsd); 
```

将抛出一个 ReferenceError。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T13:53:35.640

Assuming your function or variable is defined in the typical "global" (*see: **window**'s)* scope, I much prefer:

```
if (window.a != null) {
   a();
} 
```

or even the following, if you're checking for a function's existence:

```
if (window.a) a(); 
```

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2008-09-26T10:42:05.033

尝试使用[未定义](http://www.w3schools.com/jsref/jsref_undefined.asp)

```
if (x !== undefined) 
```

这就是检查特定浏览器功能的方式。

# php - php会话ID的唯一性

> ID：138670
> 
> 赞同：92
> 
> 时间：2008-09-26T10:41:50.883
> 
> 标签：php, session, guid

php会话ID有多独特？我从读过的各种内容中得到的印象是，我不应该依赖两个用户永远不会获得相同的 sessionid。不是 GUID 吗？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-09-26T11:01:35.797

它在发货时并不是很独特。在默认配置中，它是各种事物的哈希结果，包括 gettimeofday 的结果（这并不是非常独特），但是如果您担心，您应该将其配置为从 /dev/urandom 中提取一些熵，就像这样

```
ini_set("session.entropy_file", "/dev/urandom");
ini_set("session.entropy_length", "512"); 
```

[在代码](https://github.com/php/php-src/blob/34792280bcd2210784ba574d52fc3619cc06160d/ext/session/session.c#L279)中搜索他们正在使用的实际算法的“php_session_create_id” 。

编辑添加：有一个由pid播种的DFA随机数生成器，与usecs中的时间混合。这不是一个确定的唯一性条件[，尤其是从安全角度来看](http://seclists.org/vuln-dev/2001/Jul/33)。使用上面的熵配置。

**更新：**

> 从 PHP 5.4.0 开始 session.entropy_file 默认为 /dev/urandom 或 /dev/arandom 如果可用。在 PHP 5.3.0 中，该指令默认为空。[PHP 手册](http://www.php.net/manual/en/session.configuration.php#ini.session.entropy-file)

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-09-26T11:25:54.770

session_id确实可以重复，但是概率很低。如果您有一个流量公平的网站，它可能会在您的网站生活中发生一次，并且只会在一次会话中惹恼一位用户。

除非您期望建立一个非常高流量的网站或为银行业提供服务，否则这不值得关心。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2014-12-04T15:45:59.937

如果您想知道 PHP 默认如何生成会话 ID，请查看[Github](https://github.com/php/php-src/blob/master/ext/session/session.c#L284)上的源代码。它当然不是随机的，而是基于这些成分的散列（默认值：md5）（参见代码片段的第 310 行）：

1.  **客户端的**IP 地址****
***   **当前时间***   **PHP Linear Congruence Generator** - 一个伪随机数生成器 (PRNG)*   **操作系统特定的随机源**- 如果操作系统有可用的随机源（例如 /dev/urandom）**

 **如果操作系统有可用的随机源，则生成的 ID 的强度作为会话 ID 的强度很高（*/dev/urandom 和其他操作系统随机源（通常）是加密安全的 PRNG*）。但是，如果它没有，那么它是令人满意的。

会话标识生成的目标是：

1.  *最小化生成两个具有相同值的会话 ID 的概率*
2.  *使生成随机密钥并命中一个正在使用的密钥在计算上变得非常具有挑战性*。

这是通过 PHP 的会话生成方法实现的。

**你不能绝对保证唯一性**，但是两次命中相同哈希的概率是如此之低，一般来说，不值得担心。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-26T11:01:28.620

如果您想自定义生成 ID 的方式（默认情况下是通过 MD5 生成的 128 位数字），您可以安装替代的哈希生成函数。见[http://www.php.net/manual/en/session.configuration.php#ini.session.hash-function](http://www.php.net/manual/en/session.configuration.php#ini.session.hash-function)

有关 PHP 会话的更多信息，请参阅这篇出色的文章[http://shiflett.org/articles/the-truth-about-sessions](http://shiflett.org/articles/the-truth-about-sessions)，它还链接到有关会话固定和劫持的其他文章。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-06-13T22:42:42.087

**session_id 的大小**
假设seesion_id 是均匀分布的，大小=128 位。假设地球上的每个人每天登录一次，并且持续 1000 年的新会话。

```
num_sesion_ids  = 1000*365.25 *7*10**9 < 2**36
collission_prob < 1 - (1-1/2**82)**(2**36)  ≈ 1 - e**-(1/2**46) 
                ≈ 1/2**46 
```

所以发生一次或多次碰撞的概率小于七亿分之一。因此 session_id 的 128 位大小应该足够大。正如其他评论中提到的， session_manager 也可能会检查新的 session_id 是否不存在。

**随机性**
因此，我认为最大的问题是 session_id:s 是否以良好的伪随机性生成。关于这一点，您永远无法确定，但我建议为此目的使用众所周知且经常使用的标准解决方案（您可能已经这样做了）。

即使通过检查避免了冲突，session_id 的随机性和大小也很重要，因此黑客无法以某种方式进行有资格的猜测并以大概率找到活动的 session_id:s。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-26T10:53:13.603

我还没有找到对此的确认，但我相信 php 在创建具有该 ID 的会话 ID 之前会检查会话 ID 是否已经存在。

人们担心的会话劫持问题是当有人发现活跃用户的会话 id 时。这可以通过多种方式防止，有关更多信息，您可以查看php.net 上的[此页面和](http://is2.php.net/manual/en/session.security.php)[有关会话固定的本文](http://www.acros.si/papers/session_fixation.pdf)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T10:50:50.143

不，会话 ID 不是 GUID，但两个用户不应获得相同的会话 ID，因为它们存储在服务器端。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-09-23T10:22:22.687

您可以选择将各种会话与数据库生成唯一字段一起存储在数据库中；合并两者并将其保存在会话变量中，然后检查那个而不是会话ID。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-05-13T05:06:17.913

我知道这篇文章很老了。然而，我在这里添加我的答案，因为我找不到这个问题的相关解决方案，即使在我自己发布了一个类似的问题之后。然而，我从对我的帖子的回复中得到了线索。对于那些感兴趣的人，[这里](http://www.outsource-online.net/blog/2021/05/05/php-session-handling-with-database-ensuring-unique-session-id-in-high-traffic-sites/)解释了算法和解决方案。它使用会话和不同 cookie 的组合。

算法简而言之是这样的

会话处理将通过使用 DB 的自定义类“MySessionHandler”完成

1.就在 session_start 之前，一个 cookie cookie_start_time 被设置为当前时间。此 cookie 的生命周期将与会话的生命周期相同。两者都使用变量 $this->cookieLifeTime 来设置生命周期。

2.  在会话“_write”中，我们将该值设置为 db 表字段 cookie_start_time 与 $this->cookieStartTime 相同

3.  在会话“_read”中，我们进行检查

if($getRowsOfSession[0]['cookie_start_time'] != $this->cookieStartTime)。

如果它返回 true，则意味着这是一个重复会话，并且用户被重定向以销毁会话并再次重定向以启动新会话。（总共 2 次重定向）

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2018-07-23T08:48:23.503

```
<?php
session_start();
$_SESSION['username']="username";
?>

<!DOCTYPE html>
<html>
<head>
    <title>Update</title>
</head>
<body>

<table border="2">
    <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Edit</th>
    </tr>
<?php
     $conn=mysqli_connect("localhost","root","","telephasic");
     $q2="select * from register where username = '".$_SESSION['username']."'";
     $run=mysqli_query($conn, $q2);
     while($row=mysqli_fetch_array($run))
     {
         $name=$row[1];
         $email=$row[2];
     ?>

    <tr>
        <td><?php echo $name; ?></td>
        <td><?php echo $email; ?></td>
        <td><a href="edit.php"> Edit </a></td>
    </tr>
 <?php } ?>
 </table> 
 </body> 
```

如果您的用户名不同或唯一，您可以使用此代码进行会话

# python - Vim 扩展（通过 Python）？

> ID：138680
> 
> 赞同：10
> 
> 时间：2008-09-26T10:45:57.020
> 
> 标签：python, vim

是否可以通过自定义扩展（最好用 Python 编写）来扩展 vim 功能？

理想情况下，我需要的是在命令模式下的自定义命令。例如

ESC键

：做这个

：去做

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-26T10:55:13.347

vim 支持在 python 中编写脚本（我认为在 perl 中也是如此）。

你只需要确保你使用的 vim 发行版已经编译了 python 支持。

如果您使用的是 Linux 系统，您可以下载源代码，然后使用

```
./configure --enable-pythoninterp 
make
sudo make install 
```

在 vim 里面，你可以输入

```
:version 
```

列出可用的功能；如果它支持python，你应该在某处看到一个'+python'（否则是'-python'）。

然后，要检查 python 模块的使用情况，您可以键入

```
:help python 
```

PS：如果您要编译 vim 源代码，请确保检查可用的配置选项，您可能还需要指定 --with-python-config-dir 。

PPS：要创建“命令模式下的自定义命令”（如果我正确理解您的意思），您可以在 vim 脚本（使用 python 或 vim 脚本语言）中创建一个函数“MyFunction”，然后调用它

```
:Call MyFunction() 
```

查看

```
:help user-functions 
```

详情

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T10:57:54.120

是的。[http://www.vim.org/scripts/index.php](http://www.vim.org/scripts/index.php)上有几个扩展

如果编译了对 python 的支持，也可以使用 python 来完成。

关于它的文章：[http ://www.techrepublic.com/article/extending-vim-with-python/](http://www.techrepublic.com/article/extending-vim-with-python/)

谷歌是我们的朋友。

高温高压

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-03-14T00:29:53.533

用 Python 编译 Vim 时遇到问题。

> ...检查 Python 的编译和链接标志是否正常...否：./configure 输出中的 PYTHON DISABLED”。

在 Ubuntu 10.04 上，您必须安装`python2.6-dev`. 的标志`./configure`是：

```
--enable-pythoninterp
--with-python-config-dir=/usr/lib/python2.6/config 
```

确保你有一个目录路径，其中包含`config.c`文件。也没有`/`在路径的尽头！这给我带来了问题。

# perl - 有没有办法在 Perl 中托管进程（即实际工作的线程替换）？

> ID：138696
> 
> 赞同：3
> 
> 时间：2008-09-26T10:52:46.287
> 
> 标签：perl, multithreading, fork, signals

我在 perl 中有一个多线程应用程序，我必须依赖几个非线程安全模块，所以我一直使用`fork()`带有信号的 ed 进程`kill()`作为消息传递接口。

问题是信号处理程序有点不稳定（至少可以这么说），并且通常最终会导致进程在不适当的状态下被杀死。

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T14:29:00.717

根据您的程序需要做什么，您可能会考虑使用[POE](http://search.cpan.org/perldoc?POE)，这是一个用于具有用户空间线程的多线程应用程序的 Perl 框架。它很复杂，但优雅而强大，可以通过将活动限制在单个 Perl 解释器线程中来帮助您避免使用非线程安全模块。

有用的入门资源：

*   [Matt Sergeant 的编程 POE](http://axkit.org/docs/presentations/tpc2002/poe.pdf)演示文稿（从这里开始了解它是什么以及做什么）
*   [POE 项目页面](http://poe.perl.org)（大量食谱示例）

此外，还有数百个预构建的[POE 组件](http://search.cpan.org/search?query=POE::Component&mode=module)可用于组装到应用程序中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T11:11:23.607

您总是可以在父母和孩子之间建立一个管道来来回传递消息。

```
pipe my $reader, my $writer;
my $pid = fork();
if ( $pid == 0 ) {
    close $reader;
    ...
}
else {
    close $writer;
    my $msg_from_child = <$reader>;
    ....
} 
```

不是一种非常舒适的编程方式，但它不应该是“不稳定的”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T14:58:26.997

看看[forks.pm](http://search.cpan.org/~rybskej/forks-0.27/lib/forks.pm)，一个“使用 fork() 替代 Perl 线程的替代品”，它可以更合理地使用内存（但不要在 Win32 上使用它）。它将允许您声明“共享”变量，然后它会自动在进程之间传递对此类变量所做的更改（类似于threads.pm 的处理方式）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T11:04:10.283

从 perl 5.8 开始，您应该查看核心线程模块。看看[http://metacpan.org/pod/threads](http://metacpan.org/pod/threads)

如果你想使用不是线程安全的模块，你通常可以在线程入口点使用 require 和 import 加载它们。

# visual-studio-2008 - 有什么方法可以在 Visual Studio 2008 的第 80 列自动包装注释？..或显示第 80 列在哪里？

> ID：138703
> 
> 赞同：13
> 
> 时间：2008-09-26T10:53:43.617
> 
> 标签：visual-studio-2008, comments, word-wrap

有什么方法可以在您键入时自动将注释包装在 80 列边界处？..或者失败了，有什么方法可以在 coulmn 80 边界处显示一条微弱的线，以使手动包装它们更容易一些？

我使用的其他几个 IDE 具有这些功能中的一个或其他，它使编写包含在合理位置的注释更容易/更快。

**[编辑]**如果（像我一样）您使用 Visual C++ Express，则需要将密钥的 VisualStudio 部分更改为 VCExpress - 让我困惑了一会儿！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T10:58:35.400

看看这里的问题：[Visual Studio (2005-2010) 的隐藏功能？](https://stackoverflow.com/questions/100420/hidden-features-of-visual-studio-2005-2008)

它显示了如何做到这一点：

“在“HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\8.0\Text Editor”下创建一个名为“Guides”的字符串，其值为“RGB(255,0,0) 79”，以便在文本编辑器的第 80 列有一条红线。 "

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-13T12:54:01.120

这是作为示例宏提供的：

Macros.Samples.VSEditor.FillCommentParagraph

第一次运行时，它会询问您想要的填充宽度（即 80）。因为我是 Emacs 难民，所以我将它绑定到 Alt-Q。之后，您只需进入要格式化的评论，运行命令，它就会适当地包装您的评论。

它并不完美，但它非常好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T11:52:21.530

对于 Visual C 2008 Express 用户（如我），您需要：

```
HKEY_CURRENT_USER\Software\Microsoft\VCExpress\9.0\Text Editor 
```

添加一个名为**Guides**的字符串值，其值如下（根据其他响应）：

```
RGB(180,180,255) 80 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T10:59:14.523

请参阅 Sara Ford 的博文：http: [//blogs.msdn.com/saraford/archive/2004/11/15/257953.aspx](http://blogs.msdn.com/saraford/archive/2004/11/15/257953.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T11:14:03.800

为了使 Visual Studio 文本编辑器在第 80 列上显示一条微弱的线，您打开 RegEdit 并找到以下内容：

HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\9.0\文本编辑器

请注意，9.0 适用于 Visual Studio 2008。如果您有 Visual Studio 2005，则应输入 8.0。

您创建一个名为 Guides 的新字符串值并输入以下值：

RGB(128,0,0) 80

您可以将 RGB 颜色调整为您喜欢的值。数字 80 是您希望该行出现的列。您可以像这样添加另一行（尽管我看不出这有什么帮助）：

RGB(128,0,0) 2,80

这将出现两条线，一条在第 2 列，一条在第 80 列。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T10:58:37.020

HKCU\Software\Microsoft\VisualStudio\9.0\Text Editor\Guides = [REG_SZ] "RGB(192,192,192) 80" （查看我的 8.0 注册表，所以我不是 100% 确定）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T12:29:39.693

顺便说一句，除了上面评论中最右边的指南之外，我还为第 4、8、12、16 列等设置了较低对比度的指南。这确实有助于提高代码的可读性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-19T15:49:13.963

适用于 Visual Studio 的 SlickEdit 工具。有一个非常好的实时注释包装器，可以在您键入时自动调整行长。

[http://www.slickedit.com/products/slickedit-tools](http://www.slickedit.com/products/slickedit-tools)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-20T04:41:19.950

看看[http://www.kynosarges.de/CommentReflower.html](http://www.kynosarges.de/CommentReflower.html)。

Visual Studio 的评论重花

Comment Reflower 是 Microsoft Visual Studio 的一个重要插件，它提供可配置的自动重新格式化块注释，包括 XML 注释。

# security - 禁用 HTTPS 的通用名称检查的安全隐患

> ID：138705
> 
> 赞同：6
> 
> 时间：2008-09-26T10:54:32.007
> 
> 标签：security, ssl, https, certificate

我正在查看我为通过 HTTPS 进行安全通信而继承的一些客户端代码，它似乎没有检查服务器证书中的公用名（例如，'CN = "example.com"' 与实际 URL被请求。这可能是故意的，因为我们的客户端应用程序需要与各种环境对话，因此在联系初始门户（例如 example.com/main）并且用户选择环境后，应用程序将被重定向到特定 IP，所以所有未来的请求看起来都像“ [http://127.0.0.1/page](http://127.0.0.1/page) ”。

但是，作为 SSL 新手，我不确定禁用此检查的含义。我的第一反应是执行某种中间人攻击会更容易，因为其他人可以复制我们的证书并假装是我们的服务器之一。但是，如果我们进行通用名称检查，那么无论如何您都可以使用自定义 DNS 设置来做同样的事情，所以它似乎并没有真正为我们带来任何好处。是否还有其他攻击让我们敞开心扉，否则我们不会受到攻击？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T11:09:09.180

其他人不能只是复制您的证书并使用它，因为他们没有您的私钥。

如果您不检查证书的 CN 是否与域名不匹配，那么他们可以简单地创建自己的证书（并由受信任的 CA 签名，因此看起来有效），使用它代替您的，然后执行中间攻击的人。

此外，您需要检查证书是否来自受信任的 CA。CA 的工作是确保您只有在您实际控制该域的情况下才能获得带有 CN= 的证书。

如果您跳过这些检查中的任何一个，那么您将面临 MITM 攻击的风险。

如果您对客户端有足够的控制权，另请参阅[此答案以了解另一种可行的方法。](https://stackoverflow.com/questions/138705/security-implications-of-disabling-the-common-name-check-for-https#138876)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T11:28:35.280

如果您控制客户端代码，那么您可以将受信任的 CA 限制为您自己的。那么域检查就不那么重要了——你的任何服务器都可以伪装成另一台服务器。

如果您不控制客户端代码，则可以用受信任的 CA 签名的证书代替您的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-28T10:37:30.353

0.02 美元：不推荐使用 CN 作为主机名，而应使用 X.509 主题备用名称。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-23T18:25:24.693

*   验证证书本身以及它是否可以链接到您已经信任的 CA 证书允许您检查证书是否真实有效。
*   检查证书中的主机名允许您检查您正在与您打算与之交谈的服务器交谈，前提是您已验证证书确实有效。
*   （检查远程方确实是持有该证书私钥的一方在 SSL/TLS 握手中完成。）

如果您想与护照/身份证检查进行类比：

*   验证证书就像检查护照或身份证件是否真实。您可以决定您希望从一个人那里接受哪些形式的身份证明（例如护照、驾驶执照、员工证……）以及您信任哪些发行国能够验证他们的真实性。
*   检查远程方是否是持有私钥的一方类似于检查护照/身份证上的图片是否与您面前的人的脸相匹配。
*   检查主机名就像检查护照是否属于您要查找的那个人。

如果您不检查主机名，那么任何持有您认为真实的有效护照的人都可能来找您并声称他们就是您要找的人（按姓名）。

在非常有限的情况下，您只信任特定 CA 或自签名证书，您允许任何潜在证书模拟您信任的整个证书集中的任何其他证书，忽略此验证是可以接受的，但这是非常罕见，也不是很好的做法。

检查护照上的姓名是否与您要找的人的姓名相符将被视为常识；也为证书做。如果不这样做，任何拥有您信任的真实证书的人都可以冒充您信任的任何其他证书，从而可能执行 MITM 攻击。

HTTPS 主机名验证规则在[RFC 2818 第 3.1 节](https://www.rfc-editor.org/rfc/rfc2818#section-3.1)中定义（最近也在“最佳实践”规范[RFC 6125](https://www.rfc-editor.org/rfc/rfc6125)中，尚未实现太多）。

简而言之，主机名应该在主题备用名称 DNS 条目中（尽管您可以使用证书中没有 SAN 的主题 DN 的 CN）。当您使用 IP 地址时，该 IP 地址必须位于 SAN IP 地址条目中（尽管有些浏览器会让您使用主题 DN 的 CN 中的 IP 地址）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T10:32:52.097

主机名验证（验证 CN 部分）可确保连接的另一端（服务器）与您在地址栏中键入的域名存在 SSL 证书问题。通常，攻击者将无法获得这样的证书。

如果您不验证主机名部分，那么某人（有人坐在任何路由器或请求通过的代理）可能会进行中间人攻击。或者有人可以利用一些 DNS 攻击。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T10:58:07.693

要对“自定义 DNS 设置”做同样的事情，攻击者应该利用 DNS 服务器（您的或客户的）将 example.com 指向他控制的 IP，而不是仅仅复制证书。如果可能，我会将所有特定应用程序创建为 example.com 的子域，并使用通配符证书 (*.example.com) 来验证 CN。

# oracle - 使用 Oracle 的 utl_smtp 进行调试

> ID：138747
> 
> 赞同：3
> 
> 时间：2008-09-26T11:01:31.600
> 
> 标签：oracle, email

我的一个客户使用 Oracle 9i 的 utl_smtp 向经理发送邮件通知，当他们的员工提出旅行请求并且他们希望对邮件进行一些更改时。

我们在让 utl_smtp 与我们网络上的任何 smtp 服务器通信时遇到很多问题。我们甚至尝试在 oracle 机器上安装免费的 smtp 服务器，但它不会发现在端口 25 上运行的邮件服务器。错误代码是 ORA-29278。

所以真的有两个问题。

1.  有没有人有使用 Oracle 的 utl_smtp 实用程序设置电子邮件的经验，并对我们可能出错的地方有任何建议。

2.  有谁知道如果您使用 system.net.mail 的指定pickupdirectory 配置设置，是否可以让 utl_smtp 将文本电子邮件转储到目录中。这将是迄今为止更可取的选择。

谢谢，丹

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T14:25:38.807

看起来 HELO 是问题所在。请我们用一个简单的测试用例来检查...

```
set serveroutput on

declare
      lConnection UTL_SMTP.CONNECTION;
begin
      lConnection := UTL_SMTP.OPEN_CONNECTION(your_smtp_server);
      DBMS_OUTPUT.PUT_LINE('Opened ok');

      UTL_SMTP.HELO(lConnection, your_client_machine_name);
      DBMS_OUTPUT.PUT_LINE('HELO ok');

      UTL_SMTP.MAIL(lConnection, your_email_address);
      UTL_SMTP.RCPT(lConnection, your_email_address);
      DBMS_OUTPUT.PUT_LINE('Addressing ok');
end;
/ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T15:28:47.750

看起来我们已经解决了这个问题。要回答这两个问题。

1.  仔细检查架构调用是否对 和具有`utl_smtp`执行权限。还要检查发送的消息是否大于 32Kb。`sys.utl_smtp``sys.utl_tcp``sys.dbms_lob`

2.  不，没有办法让 utl_smtp 将电子邮件转储到诸如 system.net.mail 的目录中。

感谢 cagcowboy 的帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T12:10:24.233

是的，我们可以远程登录到服务器。

```
-- ****** Object: Stored Procedure TRAVELADMIN_DEV.HTML_EMAIL Script Date: 22/08/2008 12:41:02 ******
CREATE PROCEDURE "HTML_EMAIL"  (
    p_to            in varchar2,
    p_cc            in varchar2,
    p_from          in varchar2,
    p_subject       in varchar2,
    p_text          in varchar2 default null,
    p_html          in varchar2 default null
    )
is
    l_boundary      varchar2(255) default 'a1b2c3d4e3f2g1';
    l_connection    utl_smtp.connection;
    l_body_html     clob := empty_clob;  --This LOB will be the email message
    l_offset        number;
    l_ammount       number;
    l_temp          varchar2(32767) default null;
    p_smtp_hostname varchar2(30):= 'rockies';
    p_smtp_portnum  varchar2(2) := '25';
begin
    l_connection := utl_smtp.open_connection( p_smtp_hostname, p_smtp_portnum );
    utl_smtp.helo( l_connection, p_smtp_hostname );
    utl_smtp.mail( l_connection, p_from );
    utl_smtp.rcpt( l_connection, p_to );
    l_temp := l_temp || 'MIME-Version: 1.0' ||  chr(13) || chr(10);
    l_temp := l_temp || 'To: ' || p_to || chr(13) || chr(10);
    IF ((p_cc <> NULL) OR (LENGTH(p_cc) > 0)) THEN
      l_temp := l_temp || 'Cc: ' || p_cc || chr(13) || chr(10);
      utl_smtp.rcpt( l_connection, p_cc );
    END IF;
    l_temp := l_temp || 'From: ' || p_from || chr(13) || chr(10);
    l_temp := l_temp || 'Subject: ' || p_subject || chr(13) || chr(10);
    l_temp := l_temp || 'Reply-To: ' || p_from ||  chr(13) || chr(10);
    l_temp := l_temp || 'Content-Type: multipart/alternative; boundary=' ||
                         chr(34) || l_boundary ||  chr(34) || chr(13) ||
                         chr(10);
    ----------------------------------------------------
    -- Write the headers
    dbms_lob.createtemporary( l_body_html, false, 10 );
    dbms_lob.write(l_body_html,length(l_temp),1,l_temp);
    ----------------------------------------------------
    -- Write the text boundary
    l_offset := dbms_lob.getlength(l_body_html) + 1;
    l_temp   := '--' || l_boundary || chr(13)||chr(10);
    l_temp   := l_temp || 'content-type: text/plain; charset=us-ascii' ||
                  chr(13) || chr(10) || chr(13) || chr(10);
    dbms_lob.write(l_body_html,length(l_temp),l_offset,l_temp);
    ----------------------------------------------------
    -- Write the plain text portion of the email
    l_offset := dbms_lob.getlength(l_body_html) + 1;
    dbms_lob.write(l_body_html,length(p_text),l_offset,p_text);
    ----------------------------------------------------
    -- Write the HTML boundary
    l_temp   := chr(13)||chr(10)||chr(13)||chr(10)||'--' || l_boundary ||
                    chr(13) || chr(10);
    l_temp   := l_temp || 'content-type: text/html;' ||
                   chr(13) || chr(10) || chr(13) || chr(10);
    l_offset := dbms_lob.getlength(l_body_html) + 1;
    dbms_lob.write(l_body_html,length(l_temp),l_offset,l_temp);
    ----------------------------------------------------
    -- Write the HTML portion of the message
    l_offset := dbms_lob.getlength(l_body_html) + 1;
    dbms_lob.write(l_body_html,length(p_html),l_offset,p_html);
    ----------------------------------------------------
    -- Write the final html boundary
    l_temp   := chr(13) || chr(10) || '--' ||  l_boundary || '--' || chr(13);
    l_offset := dbms_lob.getlength(l_body_html) + 1;
    dbms_lob.write(l_body_html,length(l_temp),l_offset,l_temp);
    ----------------------------------------------------
    -- Send the email in 1900 byte chunks to UTL_SMTP
    l_offset  := 1;
    l_ammount := 1900;
    utl_smtp.open_data(l_connection);
    while l_offset < dbms_lob.getlength(l_body_html) loop
        utl_smtp.write_data(l_connection,
                            dbms_lob.substr(l_body_html,l_ammount,l_offset));
        l_offset  := l_offset + l_ammount ;
        l_ammount := least(1900,dbms_lob.getlength(l_body_html) - l_ammount);
    end loop;
    utl_smtp.close_data(l_connection);
    utl_smtp.quit( l_connection );
    dbms_lob.freetemporary(l_body_html);
end; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T12:45:49.733

*   OPEN_CONNECTION 参数应该是您要连接的服务器的 FQDN 或 IP 地址。
*   HELO 参数应该是您连接的机器的 FQDN。

如果这不起作用，你知道它在哪一行出错吗？

# installation - 安装程序给出 2732 错误：目录管理器未初始化

> ID：138758
> 
> 赞同：5
> 
> 时间：2008-09-26T11:04:32.140
> 
> 标签：installation, windows-installer

我有一个运行良好的 msi 安装程序。我添加了一个外部合并模块。编译过程中出现了一些目录合并错误。我从合并模块的目录表中删除了导致错误的目录。

我收到错误消息：

> MSI 错误 2732 错误：目录管理器未初始化。

请帮助解决问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T16:37:57.397

错误 2732的[Windows 安装程序错误消息文档说：](http://msdn.microsoft.com/en-us/library/aa372835(VS.85).aspx)

“目录管理器负责确定目标和源路径。它在成本计算操作（CostInitialize 操作、FileCost 操作和 CostFinalize 操作）期间进行初始化。标准操作或自定义操作调用了之前需要目录管理器的函数目录管理器的初始化。此操作应在成本操作之后排序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T11:15:28.027

一种可能性是您可能没有在设置目录操作中的目录路径后放置反斜杠 (\)，或者自定义操作应该是 CostInitialize

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-26T09:20:23.620

正如 Mike Dimmick 所说，从“InstallUISequence”表中获取 CostIntialize 的序列号。现在转到 InstallExecuteSequence 表并找到您的自定义操作并将序列值更新为 CostIntialize 值。

它对我来说很好。你必须检查你的情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-12-13T15:53:09.267

另一个可能查看的地方是安装日志。尝试使用日志记录安装包：

```
msiexec /i <package.msi> /l*v 
```

检查日志以查找包含“ **Return value 3.** ”的行。失败的自定义操作将显示在上方。

# desktop - Web 应用程序和桌面应用程序

> ID：138761
> 
> 赞同：2
> 
> 时间：2008-09-26T11:05:15.587
> 
> 标签：desktop

我是一名为桌面应用程序编写大量代码的程序员，现在开始将跨平台应用程序视为一个问题，但在工作中我编写 C# 应用程序，我来自 C++ 和 CS 背景，当然，我在 QT/ C++。但是现在我对 Web 应用程序有点困惑，我在 PHP 上做了一些工作，我知道事情是如何发展的，我是 gmail 和 google docs 用户很长时间了，我已经看到新的 Web 应用程序改进了多少web 2.0 技术包括 Ajax、XML 等。我的困惑是我应该开始期待 Web 应用程序开发吗？并继续探索 web 2.0 的力量，还是我必须坚持我对并行性和其他东西感到非常舒服的旧世界？因为相信我，我收到了太多作为 Web 应用程序开发人员的工作机会，但我没有 没有意识到这个机会，现在我有点困惑是否必须开始编写网络应用程序。您是否一直在编写桌面应用程序并切换到 Web？或者有人在这种情况下有经验？

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T21:30:34.183

这完全取决于您想要编写什么样的程序。由于一些公司在外包数据处理和 IT 基础设施方面发现了优势，最终用户应用程序已经开始向面向 Web 的重大转变。因为这个发展领域是一个新兴的、不断增长的领域，我毫不怀疑你会得到各种各样的报价，并听到所有关于以开发这些应用程序为中心的新初创公司等等。

这并不意味着桌面应用程序会消失。一些公司和许多私人喜欢有一种实际拥有他们的数据的感觉，并且认为“租用”在线应用程序或外包他们的数据处理没有金钱利益。这些人将在可预见的未来保持桌面应用市场的开放，尽管可能不会达到我们之前看到的程度。

所以在这一点上，你不必被迫进入网页游戏，但如果你想要的话，肯定有机会。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T22:22:07.370

桌面应用程序和 Web 应用程序之间的界限已经非常模糊。虽然曾几何时，为 Web 开发的性质与为桌面开发完全不同，但现在您会发现两者都出现了相同的概念（例如您提到的并行性）。不要认为开发 Web 应用程序是从传统软件开发迈出的一大步，因为您将使用与您已经使用的一样多的技能和概念。如果您有 C# 经验，则无需学习更多内容即可参与 Web 开发，因为您可以以与当前工作方式非常相似的方式编写 Web 应用程序的后端代码。如果您想/需要参与 UI 方面的工作，您需要学习新技术，但它们

跟进 Dustman 关于希望严格控制其数据等的公司的评论；请记住，并非所有“网络应用程序”都涉及使用互联网。实际上，所有术语的意思是“基于 Web 技术开发的应用程序”，除了在 Web 上公开部署外，它们通常部署在 Intranet 和其他封闭访问环境中。我在一家开发“Web 应用程序”的软件公司工作，但由于 Dustman 所指的原因，大量系统由客户托管以在其内部网络上使用 - 他们希望严格控制他们的数据。基于 Web 的技术的美妙之处在于，您可以在实现这一目标的同时仍然获得集中式系统的好处，

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-04T00:44:49.777

在不久的将来，Web 开发和桌面应用程序开发之间的界限将继续被抹去。对于一个专业的程序员来说，学习新事物才是真正的成长。对于有经验的程序员来说，学习 Web 开发并不是一项艰巨的任务。您显然可以继续学习 Web 开发。您应该很好地认识网络，因为它肯定会在不久的将来遇到桌面应用程序。

# c# - 如何“顺利”格式化 HttpHandler URI？

> ID：138771
> 
> 赞同：1
> 
> 时间：2008-09-26T11:08:01.460
> 
> 标签：c#, asp.net, rest, httphandler, web-services

我只是在使用 ASP.Net 2.0 干预 C# 中的 RESTful Web 服务的方式，并且已经管理（通过类库、对前者产生的 dll 的引用以及对我的 web.config 的一些调整）来哄出一个URI 格式如下：

http://localhost/DevelopmentProject/testhandler/?input=thisismyinput

毫无疑问，它只是将输入作为带有启发性前缀“您的输入是：”的文本返回

我的印象是，我可以让 URI 变得更加平滑，类似于以下内容：

http://localhost/DevelopmentProject/testhandler/thisismyinput

并得到相同的结果，但不知道如何摆脱讨厌的 "?input="

我的 web.config 的 httphandlers 部分的条目是（添加空格以便代码显示）：

< add verb="*" path="testhandler/*" type="HandlerLib.testhandler, HandlerLib"/ >

我在本地机器上运行 IIS 5.1，这会带来问题吗？

基本上我哪里错了？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T11:17:51.717

一种解决方案是使用 UrlRewriting 将 Url 重写为您需要的内容。

我使用[http://urlrewriter.net/](http://urlrewriter.net/)进行所有重写，你可以在你的场景中设置这样的东西

```
<rewriter>
   <rewrite 
     url="DevelopmentProject/testhandler/([\w]+)" 
     to="DevelopmentProject/testhandler/?input=$1" />
</rewriter> 
```

这将在您的浏览器地址栏中保留“http://localhost/DevelopmentProject/testhandler/thisismyinput”，但处理为“http://localhost/DevelopmentProject/testhandler/?input=thisismyinput”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T11:17:15.680

[您可以使用URLRewriter.net](http://www.urlrewriter.net/)之类的东西来实现 URL 重写， 这将使您可以使用您提到的语法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T16:07:24.117

我有点作弊。

尝试：

[我关于如何绕过它的文章](http://www.codeproject.com/KB/aspnet/RestServicesInASPNET2.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T05:52:38.433

将您的配置从： < add verb="" path="testhandler/" type="HandlerLib.testhandler, HandlerLib"/> 更改为： < add verb="" path="testhandler/*" type="HandlerLib.testhandler,处理程序库"/ >

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-25T05:45:50.373

[使用http://localhost/DevelopmentProject/testhandler/thisismyinput 之](http://localhost/DevelopmentProject/testhandler/thisismyinput)类的 URL 在处理程序的 ProcessRequest 函数中检查 Request.PathInfo 的值。

如果不这样做，请确保 IIS 5.1 将所有请求路由到 aspnet_isapi.dll。（虽然，它似乎已经是）这是 IIS 中虚拟目录中的“配置...”按钮 >“应用程序映射”选项卡。

# ruby - Ruby RegEx 问题 text.gsub[^\W-], '') 失败

> ID：138785
> 
> 赞同：6
> 
> 时间：2008-09-26T11:11:16.460
> 
> 标签：ruby, regex

根据我在“ *The Rails Way* ”中阅读的内容，我正在尝试在 Ruby 中学习 RegEx。但是，即使是这个简单的例子也让我难过。我不知道这是否是一个错字：

```
text.gsub(/\s/, "-").gsub([^\W-], '').downcase 
```

在我看来，这会将所有空格替换为`-`，然后在字符串以非字母或数字开头后跟破折号的任何地方，将其替换为 ''。但是，使用 irb，它首先失败`^`：

> 语法错误，意外的 '^'，期待 ']'

如果我取出`^`，它会在 W 上再次失败。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T11:14:32.660

```
>> text = "I love spaces"
=> "I love spaces"
>> text.gsub(/\s/, "-").gsub(/[^\W-]/, '').downcase
=> "--" 
```

失踪 //

虽然这更有意义:-)

```
>> text.gsub(/\s/, "-").gsub(/([^\W-])/, '\1').downcase
=> "i-love-spaces" 
```

这可能是什么意思

```
>> text.gsub(/\s/, "-").gsub(/[^\w-]/, '').downcase
=> "i-love-spaces" 
```

\W 表示“不是一个词” \w 表示“一个词”

// 生成一个正则表达式对象

> > /[^\W-]/.class => 正则表达式

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-27T00:09:03.913

第 1 步：[将此添加到您的书签](http://www.zenspider.com/Languages/Ruby/QuickRef.html)中。每当我需要查找正则表达式时，这是我的第一站

第 2 步：让我们看一下您的代码

```
text.gsub(/\s/, "-") 
```

您正在调用该`gsub`函数，并为其提供 2 个参数。
第一个参数是`/\s/`ruby​​ ，表示“创建一个新的正则表达式包含`\s`（// 就像正则表达式的特殊“”）。
第二个参数是字符串`"-"`。

因此，这将用连字符替换所有空白字符。到现在为止还挺好。

```
.gsub([^\W-], '').downcase 
```

接下来你再次调用 gsub，传递给它 2 个参数。第一个参数是`[^\W-]`。因为我们没有在正斜杠中引用它，所以 ruby​​ 会尝试运行该代码。`[]`创建一个数组，然后它尝试放入`^\W-`数组，这是无效的代码，所以它会中断。
将其更改为`/[^\W-]/`给我们一个有效的正则表达式。

查看正则表达式，`[]`“匹配该组中的任何字符”。该组包含`\W`（表示非单词字符）和`-`，因此正则表达式应匹配任何非单词字符或任何连字符。

由于您传递给 gsub 的第二件事是一个空字符串，因此它最终应该用空字符串替换所有非单词字符和连字符（从而将它们剥离）

```
.downcase 
```

这只是将字符串转换为小写。

希望这可以帮助 ：-）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T11:13:34.833

你忘记了斜线。它应该是`/[^\W-]/`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T11:24:17.880

好吧， .gsub(/[^\W-]/,'') 说替换任何不是单词也不是 - 的东西。

你可能想要

```
>> text.gsub(/\s/, "-").gsub(/[^\w-]/, '').downcase
=> "i-love-spaces" 
```

小写 \w （\W 正好相反）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T11:18:10.220

斜线表示它们之间的内容是正则表达式，就像引号表示它们之间的内容是字符串一样。

# java - 如何在 Java 中向 JComboBox 添加分隔符？

> ID：138793
> 
> 赞同：11
> 
> 时间：2008-09-26T11:12:15.803
> 
> 标签：java, swing, jcombobox, jseparator

我有一个*JComboBox*并希望在元素列表中有一个分隔符。我如何在 Java 中做到这一点？

一个可以派上用场的示例场景是在为字体系列选择制作组合框时；类似于 Word 和 Excel 中的字体系列选择控件。在这种情况下，我想在顶部显示最常用的字体，然后是分隔符，最后按字母顺序显示分隔符下方的所有字体系列。

任何人都可以帮助我如何做到这一点，或者这在 Java 中是不可能的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T11:41:53.850

有一个非常简短的教程，其中包含一个示例，展示了如何在 java2s [http://www.java2s.com/Code/Java/Swing-Components/BlockComboBoxExample.htm上使用自定义 ListCellRenderer](http://www.java2s.com/Code/Java/Swing-Components/BlockComboBoxExample.htm)

基本上它涉及在列表模型中插入一个已知的占位符，当您在​​ ListCellRenderer 中检测到占位符时，您返回一个“新 JSeparator（JSeparator.HORIZONTAL）”的实例

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T13:04:08.847

当我编写和测试下面的代码时，您可能会得到很多更好的答案......
我不介意，因为我喜欢实验/学习（Swing 前端仍然有点绿色）。

[编辑] 三年后，我有点不那么绿色了，我考虑到了 bobndrew 的有效言论。我对正常工作的键导航没有任何问题（可能是 JVM 版本问题？）。不过，我改进了渲染器以显示高光。我使用了更好的演示代码。接受的答案可能更好（更标准），如果您想要自定义分隔符，我的可能更灵活......

基本思想是为组合框的项目使用渲染器。对于大多数项目，它是一个带有项目文本的简单 JLabel。对于最近/最常用的项目，我用自定义边框装饰 JLabel，在其底部画一条线。

```
import java.awt.*;
import javax.swing.*;

@SuppressWarnings("serial")
public class TwoPartsComboBox extends JComboBox
{
  private int m_lastFirstPartIndex;

  public TwoPartsComboBox(String[] itemsFirstPart, String[] itemsSecondPart)
  {
    super(itemsFirstPart);
    m_lastFirstPartIndex = itemsFirstPart.length - 1;
    for (int i = 0; i < itemsSecondPart.length; i++)
    {
      insertItemAt(itemsSecondPart[i], i);
    }

    setRenderer(new JLRenderer());
  }

  protected class JLRenderer extends JLabel implements ListCellRenderer
  {
    private JLabel m_lastFirstPart;

    public JLRenderer()
    {
      m_lastFirstPart = new JLabel();
      m_lastFirstPart.setBorder(new BottomLineBorder());
//      m_lastFirstPart.setBorder(new BottomLineBorder(10, Color.BLUE));
    }

    @Override
    public Component getListCellRendererComponent(
        JList list,
        Object value,
        int index,
        boolean isSelected,
        boolean cellHasFocus)
    {
      if (value == null)
      {
        value = "Select an option";
      }
      JLabel label = this;
      if (index == m_lastFirstPartIndex)
      {
        label = m_lastFirstPart;
      }
      label.setText(value.toString());
      label.setBackground(isSelected ? list.getSelectionBackground() : list.getBackground());
      label.setForeground(isSelected ? list.getSelectionForeground() : list.getForeground());
      label.setOpaque(true);

      return label;
    }
  }
} 
```

分隔符类，可以加粗，带自定义颜色等。

```
import java.awt.*;
import javax.swing.border.AbstractBorder;

/**
 * Draws a line at the bottom only.
 * Useful for making a separator in combo box, for example.
 */
@SuppressWarnings("serial")
class BottomLineBorder extends AbstractBorder
{
  private int m_thickness;
  private Color m_color;

  BottomLineBorder()
  {
    this(1, Color.BLACK);
  }

  BottomLineBorder(Color color)
  {
    this(1, color);
  }

  BottomLineBorder(int thickness, Color color)
  {
    m_thickness = thickness;
    m_color = color;
  }

  @Override
  public void paintBorder(Component c, Graphics g,
      int x, int y, int width, int height)
  {
    Graphics copy = g.create();
    if (copy != null)
    {
      try
      {
        copy.translate(x, y);
        copy.setColor(m_color);
        copy.fillRect(0, height - m_thickness, width - 1, height - 1);
      }
      finally
      {
        copy.dispose();
      }
    }
  }

  @Override
  public boolean isBorderOpaque()
  {
    return true;
  }
  @Override
  public Insets getBorderInsets(Component c)
  {
    return new Insets(0, 0, m_thickness, 0);
  }
  @Override
  public Insets getBorderInsets(Component c, Insets i)
  {
    i.left = i.top = i.right = 0;
    i.bottom = m_thickness;
    return i;
  }
} 
```

测试类：

```
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;

@SuppressWarnings("serial")
public class TwoPartsComboBoxDemo extends JFrame
{
  private TwoPartsComboBox m_combo;

  public TwoPartsComboBoxDemo()
  {
    Container cont = getContentPane();
    cont.setLayout(new FlowLayout());

    cont.add(new JLabel("Data: ")) ;

    String[] itemsRecent = new String[] { "ichi", "ni", "san" };
    String[] itemsOther = new String[] { "one", "two", "three" };
    m_combo = new TwoPartsComboBox(itemsRecent, itemsOther);

    m_combo.setSelectedIndex(-1);
    cont.add(m_combo);
    m_combo.addActionListener(new ActionListener()
    {
      public void actionPerformed(ActionEvent ae)
      {
        String si = (String) m_combo.getSelectedItem();
        System.out.println(si == null ? "No item selected" : si.toString());
      }
    });

    // Reference, to check we have similar behavior to standard combo
    JComboBox combo = new JComboBox(itemsRecent);
    cont.add(combo);
  }

  /**
   * Start the demo.
   *
   * @param args   the command line arguments
   */
  public static void main(String[] args)
  {
    // turn bold fonts off in metal
    UIManager.put("swing.boldMetal", Boolean.FALSE);

    SwingUtilities.invokeLater(new Runnable()
    {
      public void run()
      {
        JFrame demoFrame = new TwoPartsComboBoxDemo();
        demoFrame.setTitle("Test GUI");
        demoFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        demoFrame.setSize(400, 100);
        demoFrame.setVisible(true);
      }
    });
  }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T11:23:16.620

您可以使用自定义`ListCellRenderer`以不同方式绘制分隔项。请参阅[文档](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/JComboBox.html#setRenderer(javax.swing.ListCellRenderer))和一个小[教程](http://www-eleves-isia.cma.fr/documentation/JavaTutorial/uiswing/components/combobox.html#renderer)。

# windows - 批量查找文件扩展名

> ID：138819
> 
> 赞同：18
> 
> 时间：2008-09-26T11:15:30.617
> 
> 标签：windows, batch-file, dos

如果我使用以下方法迭代每个文件：

```
@echo off

FOR %%f IN (*\*.\**) DO (
    echo %%f
) 
```

如何打印每个文件的扩展名？我尝试将 %%f 分配给临时变量，然后使用代码 :`echo "%t:~-3%"`打印但没有成功。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-26T11:22:49.083

FOR 命令有几个允许您修改文件名的内置开关。尝试以下操作：

```
@echo off
for %%i in (*.*) do echo "%%~xi" 
```

有关更多详细信息，请使用`help for`获取修饰符的完整列表 - 有很多！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T11:39:35.177

这行得通，尽管它的速度并不快：

```
@echo off
for %%f in (*.*) do call :procfile %%f
goto :eof

:procfile
    set fname=%1
    set ename=
:loop1
    if "%fname%"=="" (
        set ename=
        goto :exit1
    )
    if not "%fname:~-1%"=="." (
        set ename=%fname:~-1%%ename%
        set fname=%fname:~0,-1%
        goto :loop1
    )
:exit1
    echo.%ename%
    goto :eof 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-03T05:02:08.073

[Sam](https://stackoverflow.com/questions/138819#138847)的答案绝对是您想要的最简单的答案。但我想补充：

不要在a 的's 中使用`set`变量并期望立即使用它，除非您之前已发布`()``for`

```
setlocal ENABLEDELAYEDEXPANSION 
```

并且您使用`!`而不是 % 来包装变量名。例如，

```
@echo off
setlocal ENABLEDELAYEDEXPANSION

FOR %%f IN (*.*) DO (

   set t=%%f
   echo !t:~-3!

) 
```

查看

```
set /? 
```

了解更多信息。

另一种选择是调用一个子例程来执行`set`，就像[Pax](https://stackoverflow.com/questions/138819#138913)显示的那样。

# cross-platform - 如何编写跨平台程序？

> ID：138831
> 
> 赞同：13
> 
> 时间：2008-09-26T11:17:31.593
> 
> 标签：cross-platform

问候，

我想编写一个带有 GUI 的小型跨平台实用程序。我应该坚持使用哪种语言/GUI 库？有可能吗？

这将是一个小程序，所以我不想让人们下载 JVM 或 .NET Framework。可以原生开发吗？

更新 1。

“本机”是指最终结果将是本机代码，没有 Java 虚拟机或 .NET 公共语言运行时等中间层

更新 2。

免费的解决方案更可取；）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T11:23:32.327

如果您了解 C 或 C++，我能想到的第一个跨平台 GUI 框架是：

*   [QT](http://qt-project.org/)（C++，专有但通过 LGPL 许可免费）
*   [wxWidgets](http://www.wxwidgets.org/)（C++，最完整稳定但也很大）
*   [FLTK](http://www.fltk.org/) (C++)
*   [福克斯](http://www.fox-toolkit.org/)(C++)
*   [IUP](http://www.tecgraf.puc-rio.br/iup/)（C，比上面的更简单、更干净）

如果你知道 Pascal，你可以试试[freepascal](http://www.freepascal.org) + [Lazarus](http://www.lazarus.freepascal.org)。不过我从来没用过。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T11:24:25.603

问题是：如果您不想拥有 GUI，但又不想要求用户下载永恒的 API、框架或虚拟机来运行它，无论是 TCL/TK、Java 还是 QT 等，那么您很快就迷路了。

原因是：您必须重新构建这些 API、框架和虚拟机为您提供的所有（GUI）功能，以使其独立于平台。这是一大堆工作要做......

另一方面：Java 虚拟机几乎可以从零开始安装在任何操作系统上，为什么不试试这个呢？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T11:18:57.270

您想本地开发跨平台程序吗？呃……我认为这行不通，主要是因为那句话是个悖论。如果您编写本机代码，它本质上只能在您为其编程的平台上运行。;-) 这就是框架的全部意义所在。

所以如果你的程序非常小，你应该做的是使用一个非常苗条的框架。itsmatt 对 Qt 的想法是有可能的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T11:23:54.137

WxWindows？哦，现在叫 WxWidgets：[http ://www.wxwidgets.org/](http://www.wxwidgets.org/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T11:24:22.013

[wxWidgets](http://www.wxwidgets.org)绑定了各种语言——例如 python，如果你的应用程序足够小的话。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-01T22:36:58.290

拉撒路很棒。Linux 上的 GTK2，Windows 上的 win32/64，euh 上的 WINCE，Wince。它甚至在 Mac 上使用 Carbon（在 COCOA 上工作）。也很容易卖给你的老板（代码与 Delphi 兼容）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T11:23:05.840

Python 使用 Qt 或 Wx，然后使用 PythonToExe 制作“可分发”怎么样？

必须考虑开发以确保不使用本机功能（即注册表等）。此外，文本文件中的换行符等内容将具有不同的转义字符，因此需要处理

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-26T11:45:26.743

当您说跨平台时，您会想到哪些操作系统？

正如 Epaga 正确指出的那样，原生和跨平台是相互排斥的。您可以编写在多个平台上本地运行的多个版本，或者您需要使用一些跨平台框架。

在跨平台框架方法的情况下，总是需要额外的安装。例如，这里的许多人建议使用 Python 及其框架之一。这将需要指导人们首先安装 python - 可能还有框架。

如果您的目标是 Windows 和 OS X（如果需要对 Linux 的支持，并准备试验 Linux 的 alpha-release 代码），我强烈建议您看看使用 Adob​​e AIR 进行跨平台 GUI 应用程序.

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-26T12:12:25.133

我同意 Georgi 的观点，Java 是要走的路。通过一些工作，您可以使您的桌面应用程序也像 Java 小程序一样工作（这样用户根本不需要主动下载任何东西）。请参阅[http://www.geogebra.org](http://www.geogebra.org)作为应用程序示例，该应用程序可以作为跨平台 Java 应用程序顺利运行，并且具有到 Web 小程序的简单端口。

使用 Java 的另外两个优点是：

1.  他们拥有大量用于构建 UI 的库，包括 UI 组件构建器。
2.  Java 运行时框架通常会为用户自动更新。

缺点之一：

1.  安装在您的最终用户计算机上的 Java 版本可能与您的应用程序不完全兼容，要求您编码到可能的最低分母。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-26T12:42:57.370

试试 RealBasic。类似 Visual Basic 的语法，针对 Win32、OS X 和 Linux。我不知道任何以 Linux 为目标的细节，但对于我在 Win32 和 OS X 之间进行的任何跨平台开发来说，这都是一个梦想。

[http://www.realbasic.com](http://www.realbasic.com)

编辑：生成本机可执行文件。有一个小成本 - 100美元。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-26T11:20:38.247

你看过[Qt](http://trolltech.com/products/qt/)吗？

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-26T11:59:23.870

闪光？它几乎无处不在。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-26T11:27:57.327

如果它“有”成为桌面使用 Qt。现在没有什么能比得上它。

但是我个人放弃了桌面，并且我所做的任何基于 UI 的项目通常都是基于浏览器/服务器的。您可以轻松编写一个小型自定义服务器来侦听某个端口，这样程序就可以在本地运行，而无需您的用户安装 Apache 或访问网络。我有一个为此目的制作的小型 Lua、Python 和 C++ 框架（想用 V8 为后端添加 Javascript :)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-26T11:57:02.253

如果您要查看 Qt 和 WxWidgets，请不要忘记查看[GTK+](http://www.gtk.org/)！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-01-17T23:29:12.577

我同意 David Wees 和 Georgi，

Java 是卓越的跨平台性。你真的只写一次，到处运行。无需为每个目标操作系统或位数编译代码，无需担心链接任何内容等。

唯一的问题是，正如您所指出的，必须安装 JRE，但即使对于新手最终用户来说，它也是快速而直接的（只需在安装程序中单击“下一步>”几次）。

使用 Java Web Start 部署变得更加容易：用户只需单击网页上的启动按钮，应用程序就会运行（如果根据 JNLP 描述符中指定的内容安装了正确的 JVM）或者用户被重定向到 Java 下载页面（如果没有找到合适的 JVM）。

# c# - 如何解析图像标签的 HTML 字符串以获取 SRC 信息？

> ID：138839
> 
> 赞同：26
> 
> 时间：2008-09-26T11:18:32.900
> 
> 标签：c#, .net, html, regex, xpath

目前我使用.Net`WebBrowser.Document.Images()`来做到这一点。它需要`Webrowser`加载文档。它很乱，占用资源。

根据[这个问题](https://stackoverflow.com/questions/138313/how-to-extract-img-src-title-and-alt-from-html-using-php)， XPath 在这方面比正则表达式更好。

任何人都知道如何在 C# 中做到这一点？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-26T11:32:43.197

如果您的输入字符串是有效的 XHTML，您可以将其视为 xml，将其加载到 xmldocument 中，然后执行 XPath 魔术 :) 但并非总是如此。

否则你可以试试这个函数，它会从 HtmlSource 返回所有图片链接：

```
public List<Uri> FetchLinksFromSource(string htmlSource)
{
    List<Uri> links = new List<Uri>();
    string regexImgSrc = @"<img[^>]*?src\s*=\s*[""']?([^'"" >]+?)[ '""][^>]*?>";
    MatchCollection matchesImgSrc = Regex.Matches(htmlSource, regexImgSrc, RegexOptions.IgnoreCase | RegexOptions.Singleline);
    foreach (Match m in matchesImgSrc)
    {
        string href = m.Groups[1].Value;
        links.Add(new Uri(href));
    }
    return links;
} 
```

你可以像这样使用它：

```
HttpWebRequest request = (HttpWebRequest)WebRequest.Create("http://www.example.com");
request.Credentials = System.Net.CredentialCache.DefaultCredentials;
HttpWebResponse response = (HttpWebResponse)request.GetResponse();
if (response.StatusCode == HttpStatusCode.OK)
{
    using(StreamReader sr = new StreamReader(response.GetResponseStream()))
    {
        List<Uri> links = FetchLinksFromSource(sr.ReadToEnd());
    }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T20:19:37.240

任何 HTML 解析的大问题是“格式良好”的部分。您已经看到了那里的废话 HTML - 其中有多少是格式正确的？我需要做类似的事情 - 解析文档中的所有链接（在我的情况下）用重写的链接更新它们。我在 CodePlex 上找到了[Html Agility Pack 。](http://www.codeplex.com/htmlagilitypack)它摇摆不定（并处理格式错误的 HTML）。

这是一个用于迭代文档中链接的片段：

```
HtmlDocument doc = new HtmlDocument();
doc.Load(@"C:\Sample.HTM");
HtmlNodeCollection linkNodes = doc.DocumentNode.SelectNodes("//a/@href");

Content match = null;

// Run only if there are links in the document.
if (linkNodes != null)
{
    foreach (HtmlNode linkNode in linkNodes)
    {
        HtmlAttribute attrib = linkNode.Attributes["href"];
        // Do whatever else you need here
    }
} 
```

[原始博客文章](http://www.rcs-solutions.com/blog/2008/08/13/ProcessingHTMLDocuments.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T11:27:07.717

如果您只需要图像，我只会使用正则表达式。这样的事情应该可以解决问题：

```
Regex rg = new Regex(@"<img.*?src=""(.*?)""", RegexOptions.IgnoreCase); 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-09-26T11:26:43.070

如果它是有效的 xhtml，你可以这样做：

```
XmlDocument doc = new XmlDocument();
doc.LoadXml(html);
XmlNodeList results = doc.SelectNodes("//img/@src"); 
```

# python - 如何测试 django 数据库模式？

> ID：138851
> 
> 赞同：6
> 
> 时间：2008-09-26T11:23:51.237
> 
> 标签：python, django, unit-testing, model

我想编写可以显示数据库是否与我的 models.py 文件同步的测试。其实我已经写好了，只是发现django每次基于models.py文件运行测试时都会创建一个新的数据库。有什么方法可以让**models.py 测试**使用现有的数据库模式？mysql/postgresql 中的那个，而不是 /myapp/models.py 中的那个？

我不关心数据库中的数据，我只关心它的**架构**，即我希望我的测试能够注意到数据库中的表的字段是否少于我的 models.py 文件中的架构。

如果这有任何相关性，我正在使用 unittest 框架（实际上是它的 django 扩展）。

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T12:32:46.037

我们所做的是覆盖默认的 test_runner，这样它就不会创建一个新的数据库来进行测试。这样，它就可以针对我们当前本地数据库的外观运行测试。但是，如果您使用此方法，请务必小心，因为您在测试中对数据所做的任何更改都将是永久性的。我确保我们所有的测试都将任何更改恢复到其原始状态，并将我们数据库的原始版本保存在服务器上并进行备份。

所以要做到这一点，你需要将 run_test 方法从 django.test.simple 复制到你项目中的一个位置——我把我的放在 myproject/test/test_runner.py

然后对该方法进行以下更改：

```
// change
old_name = settings.DATABASE_NAME
from django.db import connection
connection.creation.create_test_db(verbosity, autoclobber=not interactive)
result = unittest.TextTestRunner(verbosity=verbosity).run(suite)
connection.creation.destroy_test_db(old_name, verbosity)

// to:
result = unittest.TextTestRunner(verbosity=verbosity).run(suite) 
```

确保在顶部进行所有必要的导入，然后在您的设置文件中设置设置：

```
TEST_RUNNER = 'myproject.test.test_runner.run_tests' 
```

现在，当您运行 ./manage.py test 时，Django 将针对您的数据库的当前状态运行测试，而不是根据您当前的模型定义创建一个新版本。

您可以做的另一件事是在本地创建数据库的副本，然后检查新的 run_test() 方法，如下所示：

```
if settings.DATABASE_NAME != 'my_test_db': 
    sys.exit("You cannot run tests using the %s database. Please switch DATABASE_NAME to my_test_db in settings.py" % settings.DATABASE_NAME) 
```

这样就没有针对您的主数据库运行测试的危险。

# c# - 可以与 WCF 交互的 Java 中的 Web 服务工具包

> ID：138877
> 
> 赞同：2
> 
> 时间：2008-09-26T11:28:44.750
> 
> 标签：c#, java, wcf, web-services, axis

我们在尝试集成到我们公开的 WCF 服务中的外部公司遇到了一些问题，他们是一家 Java 商店。我想知道他们是否可以尝试解决他们的问题的工具包不止一个，并且想要一份建议给他们的列表，但我对 Java 世界一点也不熟悉。

本质上他们有一些内存泄漏（显然！）但他们在细节上非常粗略。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T10:51:53.373

Microsoft 和 Sun[合作](https://wsit.dev.java.net/)以确保他们最新的 Web 服务工具包能够相互配合。Sun 的 java 实现是[Metro](https://metro.dev.java.net/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T11:41:16.097

如果您向他们提供标准的 Web 服务，他们是否使用 Axis？或者您是否正在展示他们必须为（HTTPClient、XML 生成器/解析器等）进行更多手动编码的自定义 REST 服务？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T16:31:45.183

您需要确保您使用的是普通的 Web 服务绑定，而不是其他任何东西。我承认，尽管这些年来让 java 和 .net Web 服务能够很好地发挥作用并不是一件容易的事。顺便说一句，内存泄漏与调用您的 Web 服务无关，而与外部公司管理其内存的方式有关。毕竟你没有在他们的服务器上执行任何东西:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-06T20:31:15.547

我已经用[Axis](http://ws.apache.org/axis/)成功地做到了这一点。它实际上非常简单，使用 Eclipse 插件。

# ruby-on-rails - IE6 由于 *server* 配置而冻结

> ID：138880
> 
> 赞同：5
> 
> 时间：2008-09-26T11:29:51.050
> 
> 标签：ruby-on-rails, internet-explorer-6

我们的网站（运行 Rails）几乎每次都会冻结 IE6。部署在不同服务器上的相同代码不会冻结 IE6。我们应该从哪里以及如何开始追踪它？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T12:27:32.600

您需要确定它们之间的区别，因此我将从以下内容开始：

```
curl -D first.headers -o first.body http://first.example.com
curl -D second.headers -o second.body http://second.example.com
diff -u first.headers second.headers
diff -u first.body second.body 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T11:35:09.850

1.  可能是沟通问题。针对冻结的服务器和未冻结的服务器尝试使用wireshark。比较结果以查看是否存在差异。

2.  缩小问题范围。开始剪切代码，直到 IE6 不冻结。然后，您可能能够准确找出导致问题的原因。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-08T00:13:42.237

我今天在一个重 AJAX 的网站上遇到了这个问题。我想我已经将问题缩小到打开了 GZIP 压缩的服务器。当我们服务器上的 GZIP 关闭时，IE6 加载页面时完全没有冻结。当 GZIP 打开时，IE6 完全冻结/崩溃。

我还注意到我们的服务器使用 GZIP 提供图像，所以我为图像禁用了它，这解决了 IE6 冻结/崩溃的问题。现在服务器只对 .js、.html 和 JSON 使用 GZIP。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T11:36:42.233

在不同机器上的 IE6 中尝试两者，最好使用尽可能少的插件，例如间谍软件拦截器或 Google 工具栏...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T11:32:43.180

使用 Firefox 和 Firebug 比较来自两台服务器的请求和响应中的 HTTP 标头。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T11:43:57.637

您也可以尝试：[http ://projects.nikhilk.net/WebDevHelper/Default.aspx](http://projects.nikhilk.net/WebDevHelper/Default.aspx)

它安装在 IE 中，可以帮助您解决网络问题等问题。通过使用其跟踪功能，您可以准确地看到它在请求/响应中冻结的时间和地点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T11:56:30.257

冻结发生在您的开发服务器或生产服务器上吗？天气您的开发服务器是否锁定 IE6 并不是什么大问题，但如果您的生产服务器无法杀死 IE6，您可能会遇到问题！

:-P

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-16T11:05:32.797

也许更多信息会对您有所帮助。

我们遇到了同样的问题，并将其范围缩小到 GZIP 压缩。关键是我们为 ScriptResources 启用了 gzip 压缩，它还提供了 .NET 页面中的控件使用的 javascript。

显然IE6中存在一个导致冻结的错误，我们认为浏览器接收文件并**在解包之前对其进行**解析，从而导致冻结。

现在我们已经关闭了 gzip 压缩，但是由于我们有大量通过 ScriptsResource 管理器提供的文件，我们需要一个不同的解决方案。

# javascript - 我什么时候应该使用内联和外部 Javascript？

> ID：138884
> 
> 赞同：133
> 
> 时间：2008-09-26T11:31:10.750
> 
> 标签：javascript, html, performance, frontend

我想知道在性能和易于维护方面，何时应该包含外部脚本或将它们与 html 代码内联编写。

这方面的一般做法是什么？

真实世界场景 - 我有几个需要客户端表单验证的 html 页面。为此，我使用了一个包含在所有这些页面上的 jQuery 插件。但问题是，我是否：

*   编写内联配置此脚本的代码位？
*   在一个文件中包含所有这些 html 页面共享的所有位？
*   将每个位包含在单独的外部文件中，每个 html 页面一个？

谢谢。

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2008-09-26T11:33:08.497

在最初发布此答案时（2008 年），规则很简单：所有脚本都应该是外部的。无论是维护还是性能。

（为什么是性能？因为如果代码是分开的，它可以更容易被浏览器缓存。）

JavaScript 不属于 HTML 代码，如果它包含特殊字符（例如`<`, `>`），它甚至会产生问题。

如今，Web 的可扩展性已经发生了变化。由于发出多个 HTTP 请求的延迟，减少请求的数量已成为一个有效的考虑因素。这使得答案更加复杂：在大多数情况下，*仍然*建议使用外部 JavaScript。但是对于某些情况，尤其是非常小的代码段，将它们内联到站点的 HTML 中是有意义的。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-09-26T11:38:24.977

可维护性绝对是将它们保持在外部的一个原因，但是如果配置是单行的（或者通常比将这些文件外部化所获得的 HTTP 开销短），那么将它们保持内联在性能方面会更好。永远记住，每个 HTTP 请求都会在执行时间和流量方面产生一些开销。

自然，当您的代码超过几行并且并非真正特定于单个页面时，这一切都变得无关紧要。在您希望能够重用该代码的那一刻，将其设为外部。如果你不这样做，看看它的大小然后再决定。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2014-10-08T01:17:37.080

如果你只关心性能，那么这个线程中的大多数建议都是完全错误的，并且在 SPA 时代变得越来越错误，我们可以假设没有 JS 代码的页面是无用的。我花了无数时间优化 SPA 页面加载时间，并使用不同的浏览器验证这些结果。通过重新编排您的 html，全面提高性能可能非常显着。

为了获得最佳性能，您必须将页面视为两级火箭。这两个阶段大致对应于`<head>`和`<body>`阶段，但可以将它们视为`<static>`和`<dynamic>`。静态部分基本上是一个字符串常量，您可以尽可能快地将其推下响应管道。如果您使用大量设置 cookie 的中间件（这些需要在发送 http 内容之前设置），这可能会有点棘手，但原则上它只是刷新响应缓冲区，希望在跳转到一些模板代码（razor、php、等）在服务器上。这听起来可能很困难，但我只是解释错了，因为它几乎是微不足道的。您可能已经猜到了，这个静态部分应该包含所有内联和缩小的 javascript。它看起来像

```
<!DOCTYPE html>
     <html>
         <head>
             <script>/*...inlined jquery, angular, your code*/</script>
             <style>/* ditto css */</style>
         </head>
         <body>
             <!-- inline all your templates, if applicable -->
             <script type='template-mime' id='1'></script>
             <script type='template-mime' id='2'></script>
             <script type='template-mime' id='3'></script> 
```

由于将这部分发送到网络上几乎不需要任何费用，因此您可以预期客户端将在连接到您的服务器后大约 5 毫秒 + 延迟时间开始接收此内容。假设服务器相当接近，这个延迟可能在 20 毫秒到 60 毫秒之间。浏览器将在收到此部分后立即开始处理，并且处理时间通常会超过传输时间 20 倍或更多，这现在是服务器端处理该`<dynamic>`部分的摊销窗口。

浏览器（chrome，rest 可能慢 20%）处理内联 jquery + signalr + angular + ng animate + ng touch + ng routes + lodash 大约需要 50 毫秒。这本身就非常了不起。大多数 Web 应用程序的代码比所有这些流行的库加起来的代码少，但假设你的代码量差不多，所以我们将在客户端赢得延迟 + 100 毫秒的处理（这种延迟胜利来自第二个传输块）。当第二个块到达时，我们已经处理了所有的 js 代码和模板，我们可以开始执行 dom 转换。

您可能会反对此方法与内联概念正交，但事实并非如此。如果您不是内联，而是链接到 cdns 或您自己的服务器，浏览器将不得不打开另一个连接并延迟执行。由于此执行基本上是免费的（因为服务器端正在与数据库通信），所以必须清楚所有这些跳转的成本都比不执行跳转要高。如果有一个浏览器怪癖说外部 js 执行得更快，我们可以衡量哪个因素占主导地位。我的测量表明，额外的请求会在这个阶段扼杀性能。

我在 SPA 应用程序的优化方面做了很多工作。人们通常认为数据量很重要，而实际上延迟和执行往往占主导地位。我列出的压缩库加起来有 300kb 的数据，压缩后的数据只有 68kb，或者在 2mbit 3g/4g 手机上下载 200ms，这正是在同一部手机上检查是否有相同数据所需的延迟已经在其缓存中，即使它被代理缓存，因为移动延迟税（电话到塔延迟）仍然适用。同时，具有较低首跳延迟的桌面连接通常具有较高的带宽。

简而言之，现在（2014 年），最好内联所有脚本、样式和模板。

**编辑（2016 年 5 月）**

随着 JS 应用程序的不断增长，我的一些有效负载现在堆叠了 3 多兆字节的缩小代码，很明显，至少应该不再内联常见的库。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-09-26T11:41:02.337

外部化 javascript 是雅虎性能规则之一：http: [//developer.yahoo.com/performance/rules.html#external](http://developer.yahoo.com/performance/rules.html#external)

虽然您应该始终将脚本外部化的硬性规则通常是一个不错的选择，但在某些情况下，您可能希望内联一些脚本和样式。但是，您应该只内联您知道会提高性能的东西（因为您已经对此进行了测量）。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-30T18:55:20.343

我认为[特定于一页的短脚本案例](http://www.thefutureoftheweb.com/blog/when-to-use-inline-javascript)（仅）是内联脚本的可辩护案例

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-08-10T14:32:08.150

实际上，使用内联 javascript 是一个非常可靠的案例。**如果 js 足够小**（单行），由于两个因素，我倾向于更喜欢 javascript 内联：

*   **地方性**。无需导航外部文件来验证某些 javascript 的行为
*   **阿贾克斯**。如果您通过 AJAX 刷新页面的某些部分，您**可能会**丢失该部分的所有 DOM 处理程序（onclick 等），具体取决于您绑定它们的方式。例如，`jQuery`你可以使用[`live`](http://api.jquery.com/live/)or[`delegate`](http://api.jquery.com/delegate/)方法来规避这一点，但我发现如果 js 足够小，最好将它放在内联。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-10-02T10:05:14.950

应该始终使用外部脚本的另一个原因是为了更轻松地过渡到[内容安全策略 (CSP)](http://developer.chrome.com/extensions/contentSecurityPolicy.html)。CSP 默认禁止所有内联脚本，使您的站点更能抵抗 XSS 攻击。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-26T13:10:03.107

我会看一下所需的代码，并根据需要将其分成多个单独的文件。每个 js 文件将只包含一个“逻辑集”功能等。例如。所有登录相关功能的一个文件。

然后在每个 html 页面上的站点开发过程中，您只包含需要的那些。当您上线您的网站时，您可以通过将页面所需的每个 js 文件合并到一个文件中来进行优化。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-03-01T14:01:34.497

我可以为内联 javascipt 提供的唯一防御是，当使用带有 .net MVC 的强类型视图时，您可以参考我发现有用的 c# variables mid javascript。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-29T03:02:38.113

三个考虑：

*   您需要多少代码（有时库是一流的消费者）？
*   特异性：此代码是否仅在此特定文档或元素的上下文中起作用？
*   文档中的每个代码都会使其更长，从而更慢。除了 SEO 考虑因素之外，您还可以最大限度地减少内部脚本...

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-08T07:09:12.890

关于将 JavaScript 保持在外部的观点：

ASP.NET 3.5SP1 最近引入了创建复合脚本资源的功能（将一堆 js 文件合并为一个）。这样做的另一个好处是，当 Webserver 压缩打开时，下载一个稍大的文件将比许多较小的文件具有更好的压缩率（也更少的 http 开销、往返等......）。我想这可以节省初始页面加载，然后如上所述启动浏览器缓存。

除了 ASP.NET，这个截屏视频更详细地解释了好处： [http ://www.asp.net/learn/3.5-SP1/video-296.aspx](http://www.asp.net/learn/3.5-SP1/video-296.aspx)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-08T05:44:36.257

使用 Firebug 也更容易调试外部脚本。我喜欢对我的 JavaScript 进行单元测试并获得所有外部帮助。我讨厌在 PHP 代码和 HTML 中看到 JavaScript，这对我来说是一团糟。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-08T07:23:55.480

外部脚本的另一个隐藏的好处是您可以通过像[jslint](http://www.jslint.com/)这样的语法检查器轻松运行它们。这可以使您免于许多令人心碎、难以发现的 IE6 错误。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-26T11:35:22.020

在您的场景中，听起来像在页面之间共享的一个文件中编写外部内容对您有好处。我同意上面所说的一切。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T11:36:05.543

在早期原型设计期间，为了快速迭代，保持代码内联，但确保在生产时将其全部外部化。

我什至敢说，如果你不能将所有的 Javascript 放在外部，那么你的设计就很糟糕，你应该重构你的数据和脚本

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-06-14T05:04:48.073

谷歌已经在它的页面排名测量中包含了加载时间，如果你内联很多，蜘蛛爬过你的页面需要更长的时间，如果你必须包含很多，这可能会影响你的页面排名。无论如何，不​​同的策略可能会影响您的排名。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-03-01T10:38:38.180

好吧，我认为在制作单页网站时应该使用内联，因为脚本不需要跨多个页面共享

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-09-28T03:59:38.153

拥有内部 JS 专业人员：更容易管理和调试你可以看到正在发生的事情

内部 JS 的缺点：人们可以随意改变它，这真的会惹恼你。

外部 JS 专业人士：不改变你可以看起来更专业（或者至少我是这么认为的）

外部 JS 缺点：更难管理，很难知道发生了什么。

* * *

## 回答 #19

> 赞同：-4
> 
> 时间：2018-04-26T18:31:55.390

始终尝试使用外部 Js，因为内联 js 总是难以维护。

此外，由于大多数开发人员建议在外部使用 js，因此专业要求您使用外部 js。

我自己使用外部js。

# c++ - Visual Studio 调试器在内联代码中变慢

> ID：138917
> 
> 赞同：2
> 
> 时间：2008-09-26T11:40:47.753
> 
> 标签：c++, windows, visual-studio, debugging

自从我从 vs2005 升级到 Visual Studio 2008 后，在调试大型项目时发现了一个非常烦人的行为。如果我尝试单步执行内联代码，调试器似乎会锁定数十秒。每次我进入这样的函数时，都会出现类似的停顿。有没有人经历过这种情况，是否有人知道解决方法？

后记：

在得知MS有一个vs2008的服务包并且由于其他编译问题需要得到它之后，我在调试器中遇到的问题得到了解决。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T12:34:10.603

我曾经得到这个 - 我认为这是“自动”调试窗口的错误：

[http://social.msdn.microsoft.com/Forums/en-US/vsdebug/thread/eabc58b1-51b2-49ce-b710-15e2bf7e7516/](http://social.msdn.microsoft.com/Forums/en-US/vsdebug/thread/eabc58b1-51b2-49ce-b710-15e2bf7e7516/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T12:01:59.900

在调试 ASP.NET 应用程序时，我会遇到这样的延迟，并且在后台访问符号（pdb）文件时似乎会发生这种情况。图书馆越大，等待的时间就越长。我的延迟最多约为 10 秒，但似乎确实发生在已经访问过的符号上。

当我尝试跳过导致 VS 给我“步入特定”消息的项目时，我确实会等待很多 1-3 秒（[http://blogesh.wordpress.com/category/visual-studio-2008/](http://blogesh.wordpress.com/category/visual-studio-2008/) #3）。也许这可能会给您带来真正的打击。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-18T16:59:19.130

值得一提的是，这个问题似乎在 Visual Studio 2008 Service Pack 1 中得到了解决。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T13:32:04.660

作为一种解决方法，您可以使用类似这样的方法进行调试：

```
#ifdef _DEBUG
  #define INLINE
#else
  #define INLINE inline
#endif 
```

为了更加整洁，您可以将函数放在单独的 .inc 文件中，该文件包含在头文件或 cpp 文件中，具体取决于构建类型。

# ruby-on-rails - How do I fix routing errors from rails in production mode?

> ID：138928
> 
> 赞同：5
> 
> 时间：2008-09-26T11:43:13.270
> 
> 标签：ruby-on-rails, routing, http-status-code-404, production

If I try and access some random string in the URL of my rails app, such as `/asdfasdifjasdfkj` then I am seeing a rails error message

Routing Error

`No route matches "/asdfasdifjasdfkj" with {:method=>:get}`

Even though I am in production mode. Clearly I don't want any real users to see this, and would prefer a 404 page. Anyone know whats going wrong and how I fix it?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T11:46:55.350

To get 404 you need to run server in production environment and use external ip address rather than local/loopback ip address in the url.

You can also force controller to consider all your requests as local:

```
 def local_request?
    return false
  end 
```

# xml - CSV、JSON 和 XML 对于 REST API 的相对优点是什么？

> ID：138929
> 
> 赞同：24
> 
> 时间：2008-09-26T11:43:30.820
> 
> 标签：xml, json, api, rest, csv

我们目前正在`API`为一个应用程序计划一个新的，并讨论我们应该用于交换的各种数据格式。关于 和 的相对优点正在进行相当激烈的`CSV`讨论。`JSON``XML`

基本上，争论的关键是我们是否应该支持`CSV`，因为缺乏递归（***即拥有一个拥有`multiple authors`并且`multiple references`需要`multiple API calls`获取所有的`information`***文档）。

根据您在处理`Web APIs`来自`API`.

* * *

**我们的决定：**

> 由于递归的困难，`XML`我们决定提供单个逻辑操作需要多次调用。没有解析器，似乎也没有实现，所以它们暂时也没有，但最终可能会得到支持。`JSON``CSV``JSON``Qt``Protocol Buffers``non-alpha PHP`

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-26T11:55:07.250

好处：

*   XML - 很多库，开发人员熟悉它，XSLT，可以很容易地被客户端和服务器（XSD，DTD）验证，分层数据
*   JSON - 易于在客户端解释，紧凑符号，分层数据
*   CSV - 在 Excel 中打开（？）

缺点：

*   XML - 臃肿，在 JavaScript 中比 JSON 更难解释
*   JSON - 如果使用不当会造成安全漏洞（不要使用 eval），并非所有语言都有库来解释它。
*   CSV - 不支持分层数据，您将是唯一一个这样做的人，实际上解析有效的 csv 文件比大多数开发人员认为的要困难得多（CSV 值可以包含新行，只要它们在引号之间等）。

鉴于上述情况，我什至不会费心支持 CSV。如果确实需要，客户端可以从 XML 或 JSON 生成它。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-26T11:47:05.023

CSV 就出来了。JSON 是一种比 XML 更紧凑的对象表示法，因此如果您正在寻找高容量，它具有优势。XML 具有更广泛的市场渗透（我喜欢这句话），并且得到所有编程语言及其核心框架的支持。JSON 正在到达那里（如果还没有的话）。

就个人而言，我喜欢括号。我敢打赌，与使用 json 相比，更多的开发人员更愿意使用 xml 数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T11:48:06.987

XML 有时可能有点重量级。JSON 非常好，但它具有良好的语言支持，并且 JSON 数据可以直接转换为许多游戏形式上的原生对象。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T11:47:32.197

CSV 作为一个复杂的数据模型有很多问题，我不会使用它。XML 非常灵活且易于编程 - 客户端对 XML 生成器和解析器进行编码没有问题，您甚至可以使用 SAX 提供示例解析器。

你检查过谷歌的网络数据格式吗？它被称为协议缓冲区。不知道它是否对 REST 服务有用，因为它也跳过了整个 HTTP 层。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T12:24:53.997

我对 JSON 没有任何经验，当您的数据非常表格且结构均匀时，CSV 可以工作。XML 很快就会变得笨拙，特别是如果您没有自动创建对象绑定的工具。

我也没有尝试过，但[Google 的协议缓冲区](http://code.google.com/p/protobuf/)看起来非常好，格式简单，创建与 C++、Java 和 Python 的自动绑定，并实现创建对象的序列化和反序列化。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-08-09T13:54:46.217

除了 Alllain [Lalonde 已经说过](https://stackoverflow.com/a/138973/679240)的，CSV 的另一个优点是它往往比 XML 甚至 JSON 更紧凑。因此，如果您的数据是*严格*的表格，具有完全平坦的层次结构，那么 CSV 可能是一个正确的选择。CSV 的其他缺点是它可能使用不同的定界符和小数分隔符，这取决于生成它的工具（甚至国家！）。

# winapi - 如何在 Win32 中获取 CPU 周期数？

> ID：138932
> 
> 赞同：7
> 
> 时间：2008-09-26T11:44:26.887
> 
> 标签：winapi, timer, cpu-cycles

在 Win32 中，有没有办法获得唯一的 cpu 循环计数或类似的东西，这对于多个进程/语言/系统/等来说是统一的。

我正在创建一些日志文件，但必须生成多个日志文件，因为我们正在托管 .NET 运行时，并且我想避免从一个到另一个调用来记录。因此，我想我只是生成两个文件，将它们组合起来，然后对它们进行排序，以获得涉及跨世界调用的连贯时间线。

但是，GetTickCount 并不是每次调用都会增加，所以这并不可靠。有没有更好的号码，以便我在排序时按正确的顺序接听电话？

* * *

**编辑**：感谢[@Greg](https://stackoverflow.com/users/893/greg-hewgill)让我走上了 QueryPerformanceCounter 的轨道，它成功了。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T11:52:36.787

[这是一篇有趣的文章！](http://www.geisswerks.com/ryan/FAQS/timing.html)说不要使用 RDTSC，而是使用[QueryPerformanceCounter](http://msdn.microsoft.com/en-us/library/windows/desktop/ms644904)。

结论：

> 在许多基于 Windows 的操作系统上，使用常规的 old`timeGetTime()`进行计时并不可靠，因为系统计时器的粒度可能高达 10-15 毫秒，这意味着 `timeGetTime()`只能精确到 10-15 毫秒。[请注意，高粒度出现在基于 NT 的操作系统上，如 Windows NT、2000 和 XP。Windows 95 和 98 往往具有更好的粒度，大约 1-5 毫秒。]
> 
> 但是，如果您 `timeBeginPeriod(1)`在程序开始（和 `timeEndPeriod(1)`结束）调用，`timeGetTime()`通常会精确到 1-2 毫秒，并且会为您提供极其准确的计时信息。
> 
> `Sleep()`行为相似；`Sleep()`实际休眠的时间长度与 的粒度密切相关`timeGetTime()`，因此在调用 `timeBeginPeriod(1)`一次后， `Sleep(1)`实际上将休眠 1-2 毫秒，`Sleep(2)`持续 2-3 毫秒，依此类推（而不是以高达10-15 毫秒）。
> 
> **对于更高精度的计时（亚毫秒精度），您可能希望避免使用汇编助记符 RDTSC，因为它很难校准**；而是使用 `QueryPerformanceFrequency`and `QueryPerformanceCounter`，其精确到小于 10 微秒（0.00001 秒）。
> 
> 对于简单的计时，timeGetTime 和 QueryPerformanceCounter 都很好用，QueryPerformanceCounter 显然更准确。但是，如果您需要执行任何类型的“定时暂停”（例如帧速率限制所必需的暂停），则需要小心坐在调用 QueryPerformanceCounter 的循环中，等待它达到某个值；这将消耗 100% 的处理器。相反，考虑一个混合方案，当您需要通过超过 1 毫秒的时间时，您调用 Sleep(1)（不要忘记 timeBeginPeriod(1)！），然后只进入 QueryPerformanceCounter 100%-busy 循环完成您需要的最后 < 1/1000 秒的延迟。这将为您提供超精确的延迟（精确到 10 微秒），并且 CPU 使用率非常低。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-26T11:48:39.480

您可以使用[RDTSC](http://en.wikipedia.org/wiki/RDTSC) CPU 指令（假设 x86）。该指令提供 CPU 周期计数器，但请注意，它会很快增加到最大值，然后重置为 0。正如 Wikipedia 文章所述，使用[QueryPerformanceCounter](http://msdn.microsoft.com/en-us/library/ms644904.aspx)函数可能会更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T11:54:16.347

System.Diagnostics.Stopwatch.GetTimestamp() 返回自时间起源以来的 CPU 周期数（可能是计算机启动时，但我不确定），我从未见过它在 2 次调用之间没有增加。

CPU 周期将特定于每台计算机，因此您不能使用它来合并两台计算机之间的日志文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T11:57:27.150

RDTSC 输出可能取决于当前内核的时钟频率，这对于现代 CPU 来说既不是恒定的，在多核机器中也不是一致的。

使用系统时间，如果处理来自多个系统的提要，则使用 NTP 时间源。您可以通过这种方式获得可靠、一致的时间读数；如果开销对于您的目的来说太大了，那么使用[HPET](http://en.wikipedia.org/wiki/HPET)计算自上次已知的可靠时间读数以来经过的时间比单独使用 HPET 更好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T11:53:27.957

在合并日志文件时使用 GetTickCount 并添加另一个计数器。不会为您提供不同日志文件之间的完美顺序，但它至少会使每个文件中的所有日志保持正确的顺序。

# java - 如何让 UTF-8 在 Java webapps 中工作？

> ID：138948
> 
> 赞同：375
> 
> 时间：2008-09-26T11:48:09.763
> 
> 标签：java, mysql, tomcat, encoding, utf-8

我需要让 UTF-8 在我的 Java webapp（servlets + JSP，未使用框架）中工作，以支持`äöå`常规芬兰文本和西里尔字母等`ЦжФ`特殊情况。

我的设置如下：

*   开发环境：Windows XP
*   生产环境：Debian

使用的数据库：MySQL 5.x

用户主要使用 Firefox2，但也使用 Opera 9.x、FF3、IE7 和 Google Chrome 访问该站点。

如何做到这一点？

* * *

## 回答 #1

> 赞同：562
> 
> 时间：2008-09-26T11:48:24.787

*回答我自己作为本网站的常见问题解答鼓励它。这对我有用：*

大多数字符 äåö 不是问题，因为浏览器使用的默认字符集和 webapps 的 tomcat/java 是 latin1 即。ISO-8859-1 “理解”这些字符。

要让 UTF-8 在 Java+Tomcat+Linux/Windows+Mysql 下工作，需要以下条件：

## 配置 Tomcat 的 server.xml

需要配置连接器使用 UTF-8 编码 url（GET 请求）参数：

```
<Connector port="8080" maxHttpHeaderSize="8192"
 maxThreads="150" minSpareThreads="25" maxSpareThreads="75"
 enableLookups="false" redirectPort="8443" acceptCount="100"
 connectionTimeout="20000" disableUploadTimeout="true" 
 compression="on" 
 compressionMinSize="128" 
 noCompressionUserAgents="gozilla, traviata" 
 compressableMimeType="text/html,text/xml,text/plain,text/css,text/ javascript,application/x-javascript,application/javascript"
 URIEncoding="UTF-8"
/> 
```

上面示例中的关键部分是**URIEncoding="UTF-8"**。这保证了 Tomcat 以 UTF-8 编码处理所有传入的 GET 参数。结果，当用户在浏览器的地址栏中写入以下内容时：

```
 https://localhost:8443/ID/Users?action=search&name=*ж* 
```

字符 ж 被处理为 UTF-8 并被编码为（通常在浏览器到达服务器之前）为**%D0%B6**。

*POST 请求不受此影响。*

## 字符集过滤器

然后是时候强制 java webapp 以 UTF-8 编码处理所有请求和响应。这要求我们定义一个字符集过滤器，如下所示：

```
package fi.foo.filters;

import javax.servlet.*;
import java.io.IOException;

public class CharsetFilter implements Filter {

    private String encoding;

    public void init(FilterConfig config) throws ServletException {
        encoding = config.getInitParameter("requestEncoding");
        if (encoding == null) encoding = "UTF-8";
    }

    public void doFilter(ServletRequest request, ServletResponse response, FilterChain next)
            throws IOException, ServletException {
        // Respect the client-specified character encoding
        // (see HTTP specification section 3.4.1)
        if (null == request.getCharacterEncoding()) {
            request.setCharacterEncoding(encoding);
        }

        // Set the default response content type and encoding
        response.setContentType("text/html; charset=UTF-8");
        response.setCharacterEncoding("UTF-8");

        next.doFilter(request, response);
    }

    public void destroy() {
    }
} 
```

此过滤器确保如果浏览器未设置请求中使用的编码，则将其设置为 UTF-8。

此过滤器完成的另一件事是设置默认响应编码，即。返回的 html/whatever 的编码。另一种方法是在应用程序的每个控制器中设置响应编码等。

必须将此过滤器添加到**web.xml**或 webapp 的部署描述符中：

```
 <!--CharsetFilter start--> 

  <filter>
    <filter-name>CharsetFilter</filter-name>
    <filter-class>fi.foo.filters.CharsetFilter</filter-class>
      <init-param>
        <param-name>requestEncoding</param-name>
        <param-value>UTF-8</param-value>
      </init-param>
  </filter>

  <filter-mapping>
    <filter-name>CharsetFilter</filter-name>
    <url-pattern>/*</url-pattern>
  </filter-mapping> 
```

制作此过滤器的说明可在[tomcat wiki (](http://wiki.apache.org/tomcat/Tomcat/UTF-8) [http://wiki.apache.org/tomcat/Tomcat/UTF-8](http://wiki.apache.org/tomcat/Tomcat/UTF-8) )中找到

## JSP 页面编码

在您的**web.xml**中，添加以下内容：

```
<jsp-config>
    <jsp-property-group>
        <url-pattern>*.jsp</url-pattern>
        <page-encoding>UTF-8</page-encoding>
    </jsp-property-group>
</jsp-config> 
```

或者，webapp 的所有 JSP 页面都需要在其顶部具有以下内容：

```
 <%@page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8"%> 
```

如果使用具有不同 JSP 片段的某种布局，那么**所有**这些都需要这样做。

## HTML 元标记

JSP 页面编码告诉 JVM 以正确的编码处理 JSP 页面中的字符。然后是时候告诉浏览器html页面的编码是什么了：

这是通过 webapp 生成的每个 xhtml 页面顶部的以下内容完成的：

```
 <?xml version="1.0" encoding="UTF-8"?>
   <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
   <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fi">
   <head>
   <meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
   ... 
```

## JDBC 连接

使用 db 时，必须定义连接使用 UTF-8 编码。这是在**context.xml**或任何 JDBC 连接被定义的地方完成的，如下所示：

```
 <Resource name="jdbc/AppDB" 
        auth="Container"
        type="javax.sql.DataSource"
        maxActive="20" maxIdle="10" maxWait="10000"
        username="foo"
        password="bar"
        driverClassName="com.mysql.jdbc.Driver" url="jdbc:mysql://localhost:3306/      ID_development?useEncoding=true&amp;characterEncoding=UTF-8"
    /> 
```

## MySQL 数据库和表

使用的数据库必须使用 UTF-8 编码。这是通过使用以下内容创建数据库来实现的：

```
 CREATE DATABASE `ID_development` 
   /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_swedish_ci */; 
```

然后，所有表也需要采用 UTF-8 格式：

```
 CREATE TABLE  `Users` (
    `id` int(10) unsigned NOT NULL auto_increment,
    `name` varchar(30) collate utf8_swedish_ci default NULL
    PRIMARY KEY  (`id`)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_swedish_ci ROW_FORMAT=DYNAMIC; 
```

关键部分是**CHARSET=utf8**。

## MySQL服务器配置

MySQL serveri 也必须配置。这通常在 Windows 中通过修改**my.ini**文件来完成，在 Linux 中通过配置**my.cnf**文件来完成。在这些文件中，应该定义连接到服务器的所有客户端都使用 utf8 作为默认字符集，并且服务器使用的默认字符集也是 utf8。

```
 [client]
   port=3306
   default-character-set=utf8

   [mysql]
   default-character-set=utf8 
```

## Mysql程序和函数

这些也需要定义字符集。例如：

```
 DELIMITER $$

   DROP FUNCTION IF EXISTS `pathToNode` $$
   CREATE FUNCTION `pathToNode` (ryhma_id INT) RETURNS TEXT CHARACTER SET utf8
   READS SQL DATA
   BEGIN

    DECLARE path VARCHAR(255) CHARACTER SET utf8;

   SET path = NULL;

   ...

   RETURN path;

   END $$

   DELIMITER ; 
```

## GET 请求：latin1 和 UTF-8

如果并且当它在 tomcat 的 server.xml 中定义 GET 请求参数以 UTF-8 编码时，则正确处理以下 GET 请求：

```
 https://localhost:8443/ID/Users?action=search&name=Petteri
   https://localhost:8443/ID/Users?action=search&name=ж 
```

因为 ASCII 字符的编码方式与 latin1 和 UTF-8 相同，所以可以正确处理字符串“Petteri”。

西里尔字母 ж 在 latin1 中根本无法理解。因为 Tomcat 被指示将请求参数作为 UTF-8 处理，所以它将该字符正确编码为**%D0%B6**。

如果并且当指示浏览器以 UTF-8 编码（带有请求标头和 html 元标记）读取页面时，至少 Firefox 2/3 和该时期的其他浏览器都将字符本身编码为**%D0%B6**。

最终结果是找到了所有名为“Petteri”的用户，也找到了所有名为“ж”的用户。

### 但是äåö呢？

HTTP 规范定义默认情况下 URL 编码为 latin1。这会导致 firefox2、firefox3 等对以下内容进行编码

```
 https://localhost:8443/ID/Users?action=search&name=*Päivi* 
```

进入编码版本

```
 https://localhost:8443/ID/Users?action=search&name=*P%E4ivi* 
```

在 latin1 中，字符**ä**被编码为**%E4**。*即使页面/请求/一​​切都被定义为使用 UTF-8*。ä 的 UTF-8 编码版本是**%C3%A4**

这样做的结果是 webapp 完全不可能正确处理来自 GET 请求的请求参数，因为有些字符是用 latin1 编码的，而另一些是用 UTF-8 编码的。 **注意：如果页面被定义为 UTF-8，则 POST 请求确实可以工作，因为浏览器将表单中的所有请求参数完全编码为 UTF-8**

## 需要阅读的东西

非常感谢以下作者为我的问题提供答案：

*   http://tagunov.tripod.com/i18n/i18n.html
*   http://wiki.apache.org/tomcat/Tomcat/UTF-8
*   http://java.sun.com/developer/technicalArticles/Intl/HTTPCharset/
*   http://dev.mysql.com/doc/refman/5.0/en/charset-syntax.html
*   http://cagan327.blogspot.com/2006/05/utf-8-encoding-fix-tomcat-jsp-etc.html
*   http://cagan327.blogspot.com/2006/05/utf-8-encoding-fix-for-mysql-tomcat.html
*   http://jeppesn.dk/utf-8.html
*   http://www.nabble.com/request-parameters-mishandle-utf-8-encoding-td18720039.html
*   http://www.utoronto.ca/webdocs/HTMLdocs/NewHTML/iso_table.html
*   http://www.utf8-chartable.de/

## 重要的提示

[mysql](/questions/tagged/mysql "显示标记为“mysql”的问题")支持使用 3 字节 UTF-8 字符的[基本多语言平面。](http://en.wikipedia.org/wiki/Plane_%28Unicode%29#Basic_Multilingual_Plane)如果您需要超出此范围（某些字母需要超过 3 个字节的 UTF-8），那么您需要使用`VARBINARY`列类型或使用[`utf8mb4`字符集](http://dev.mysql.com/doc/refman/5.5/en/charset-unicode-utf8mb4.html)（需要 MySQL 5.5.3 或更高版本）。请注意，`utf8`在 MySQL 中使用字符集不会 100% 有效。

## Tomcat 与 Apache

另一件事如果您使用的是 Apache + Tomcat + mod_JK 连接器，那么您还需要进行以下更改：

1.  将 URIEncoding="UTF-8" 添加到 8009 连接器的 tomcat server.xml 文件中，供 mod_JK 连接器使用。`<Connector port="8009" protocol="AJP/1.3" redirectPort="8443" URIEncoding="UTF-8"/>`
2.  转到您的 apache 文件夹，即并`/etc/httpd/conf`添加`AddDefaultCharset utf-8`. **注意：**首先检查它是否存在。如果存在，您可以使用此行更新它。您也可以在底部添加此行。`httpd.conf file`

 *** * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-27T21:54:08.160

我认为您在自己的答案中总结得很好。

在端到端的 UTF-8-ing(?) 过程中，您可能还想确保 java 本身使用 UTF-8。使用 -Dfile.encoding=utf-8 作为 JVM 的参数（可以在 catalina.bat 中配置）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2014-01-28T15:10:17.330

要添加到[kosoant 的答案](https://stackoverflow.com/a/138950/545127)，如果您使用的是 Spring，而不是编写自己的 Servlet 过滤器，您可以使用`org.springframework.web.filter.CharacterEncodingFilter`他们提供的类，在 web.xml 中进行如下配置：

```
 <filter>
    <filter-name>encoding-filter</filter-name>
    <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
    <init-param>
       <param-name>encoding</param-name>
       <param-value>UTF-8</param-value>
    </init-param>
    <init-param>
       <param-name>forceEncoding</param-name>
       <param-value>FALSE</param-value>
    </init-param>
 </filter>
 <filter-mapping>
    <filter-name>encoding-filter</filter-name>
    <url-pattern>/*</url-pattern>
 </filter-mapping> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-13T16:47:34.397

我还想从[这里](http://wiki.netbeans.org/FaqI18nProjectEncoding)添加这部分解决了我的 utf 问题：

```
runtime.encoding=<encoding> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-04T13:52:33.223

当我们想使用 Java 访问 MySql 表时，这是针对希腊语编码的：

在您的 JBoss 连接池 (mysql-ds.xml) 中使用以下连接设置

```
<connection-url>jdbc:mysql://192.168.10.123:3308/mydatabase</connection-url>
<driver-class>com.mysql.jdbc.Driver</driver-class>
<user-name>nts</user-name>
<password>xaxaxa!</password>
<connection-property name="useUnicode">true</connection-property>
<connection-property name="characterEncoding">greek</connection-property> 
```

如果您不想将其放入 JNDI 连接池中，则可以将其配置为 JDBC-url，如下一行所示：

```
jdbc:mysql://192.168.10.123:3308/mydatabase?characterEncoding=greek 
```

对我和尼克来说，所以我们永远不会忘记它并不再浪费时间......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-19T01:30:34.160

好详细的答案。只是想再添加一件事，这肯定会帮助其他人看到 URL 上的 UTF-8 编码在起作用。

按照以下步骤在 Firefox 中对 URL 启用 UTF-8 编码。

1.  在地址栏中输入“about:config”。

2.  使用过滤器输入类型搜索“network.standard-url.encode-query-utf8”属性。

3.  上述属性默认为 false，将其设置为 TRUE。
4.  重启浏览器。

URL 上的 UTF-8 编码默认在 IE6/7/8 和 chrome 中有效。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-04-16T18:31:07.140

以前的回复不适用于我的问题。它只是在生产中，带有 tomcat 和 apache mod_proxy_ajp。帖子正文丢失了非 ascii 字符？问题最终出在 JVM defaultCharset（默认安装中的 US-ASCII：Charset dfset = Charset.defaultCharset();）所以，解决方案是运行带有修饰符的 tomcat 服务器，以使用 UTF-8 作为默认字符集运行 JVM：

```
JAVA_OPTS="$JAVA_OPTS -Dfile.encoding=UTF-8" 
```

（将此行添加到 catalina.sh 和服务 tomcat 重新启动）

也许您还必须更改 linux 系统变量（编辑 ~/.bashrc 和 ~/.profile 以进行永久更改，请参阅[https://perlgeek.de/en/article/set-up-a-clean-utf8-environment](https://perlgeek.de/en/article/set-up-a-clean-utf8-environment)）

> 导出 LC_ALL=en_US.UTF-8
> 导出 LANG=en_US.UTF-8
> 
> 导出 LANGUAGE=en_US.UTF-8

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-07-20T13:45:30.053

我遇到了类似的问题，但是，在我使用 apache commons 压缩的文件的文件名中。所以，我用这个命令解决了它：

```
convmv --notest -f cp1252 -t utf8 * -r 
```

它对我来说效果很好。希望它可以帮助任何人;）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-21T01:59:03.767

对于从消息包中显示 Unicode 字符的情况，我不需要应用“JSP 页面编码”部分来在我的 jsp 页面上显示 Unicode。我需要的只是“CharsetFilter”部分。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-14T22:30:51.480

尚未提及的另一点与使用 Ajax 的 Java Servlet 有关。我遇到网页从用户那里获取 utf-8 文本并将其发送到 JavaScript 文件的情况，该文件将其包含在发送到 Servlet 的 URI 中。Servlet 查询数据库，捕获结果并将其作为 XML 返回到 JavaScript 文件，该文件对其进行格式化并将格式化的响应插入到原始网页中。

在一个 Web 应用程序中，我按照早期 Ajax 书籍的说明来包装 JavaScript 以构建 URI。书中的示例使用了 escape() 方法，我发现（困难的方法）是错误的。对于 utf-8，您必须使用 encodeURIComponent()。

这些天似乎很少有人推出自己的 Ajax，但我想我不妨添加这个。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-01-09T05:24:48.103

关于`CharsetFilter`@kosoant回答中提到的......

`Filter`在 tomcat中有一个内置`web.xml`（位于`conf/web.xml`）。默认情况下，过滤器已命名`setCharacterEncodingFilter`并带有注释。您可以取消注释（请记住也取消注释`filter-mapping`）

也不需要`jsp-config`在你的`web.xml`（我已经为 Tomcat 7+ 测试过）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-07-13T18:34:13.490

有时您可以通过 MySQL 管理员向导解决问题。在

> 启动变量 > 高级 >

并设置 Def。字符集：utf8

也许这个配置需要重启 MySQL。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-02-22T22:04:31.207

在 Spring MVC 5 + Tomcat 9 + JSP 上面临同样的问题。
经过长期研究，得出了一个优雅的解决方案（**Tomcat** server.xml中**无需****过滤****器**和无需**更改**（从 8.0.0-RC3 版本开始））

 ******1.  在 WebMvcConfigurer 实现中，为 messageSource 设置默认编码（用于从 UTF-8 编码的消息源文件中读取数据。

    ```
    @Configuration
    @EnableWebMvc
    @ComponentScan("{package.with.components}")
    public class WebApplicationContextConfig implements WebMvcConfigurer {

        @Bean
        public MessageSource messageSource() {
            final ResourceBundleMessageSource messageSource = new ResourceBundleMessageSource();

            messageSource.setBasenames("messages");
            messageSource.setDefaultEncoding("UTF-8");

            return messageSource;
        }

        /* other beans and methods */

    } 
    ```

2.  在 DispatcherServletInitializer 实现中 @Override onStartup 方法并在其中设置请求和资源字符编码。

    ```
    public class DispatcherServletInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

        @Override
        public void onStartup(final ServletContext servletContext) throws ServletException {

            // https://wiki.apache.org/tomcat/FAQ/CharacterEncoding
            servletContext.setRequestCharacterEncoding("UTF-8");
            servletContext.setResponseCharacterEncoding("UTF-8");

            super.onStartup(servletContext);
        }

        /* servlet mappings, root and web application configs, other methods */

    } 
    ```

3.  以 UTF-8 编码保存所有消息源和视图文件。

4.  在每个 *.jsp 文件中添加 <%@ page contentType="text/html;charset=UTF-8" %>**或**<%@ page pageEncoding="UTF-8" %>**或**将 jsp-config 描述符添加到 web.xml

    ```
    <?xml version="1.0" encoding="UTF-8"?>
    <web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee"
     xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
     id="WebApp_ID" version="3.0">
        <display-name>AppName</display-name>

        <jsp-config>
            <jsp-property-group>
                <url-pattern>*.jsp</url-pattern>
                <page-encoding>UTF-8</page-encoding>
            </jsp-property-group>
        </jsp-config>
    </web-app> 
    ```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-12-11T17:12:08.067

如果您已在连接池 (mysql-ds.xml) 中指定，您可以在 Java 代码中打开连接，如下所示：

```
DriverManager.registerDriver(new com.mysql.jdbc.Driver());
Connection conn = DriverManager.getConnection(
    "jdbc:mysql://192.168.1.12:3308/mydb?characterEncoding=greek",
    "Myuser", "mypass"); 
```

# c++ - 是否有用于 MVS 的 C++ 中的 Delphi:TClientDataSet 实现？

> ID：138952
> 
> 赞同：2
> 
> 时间：2008-09-26T11:48:53.833
> 
> 标签：c++, delphi, tclientdataset

我想从 Embarcadero Delphi 迁移到 Visual Studio，但是没有[TClientDataset](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate4/EN/html/delphivclwin32/DBClient_TClientDataSet.html)类非常困难。此类表示内存中的数据集。

我找不到像[TClientDataset](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate4/EN/html/delphivclwin32/DBClient_TClientDataSet.html)这样的类。

任何人都可以帮我找到这样的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T19:02:24.123

.NET 对 System.Dataset 和 System.Datatable 与 TClientDataset 非常不同。

过滤和绑定是在另一个类（Dataview）上完成的，dotNET DataGrid 隐藏了一点。Extract 方法是数据表在过滤方面提供的最接近的方法（它返回指向 DataRows 的指针数组）。

分组不如 TClientDataset 强大，因为索引也更差。（如在 dotNet 1.1 中）

DataTable 上没有记录光标，因此定位在可视控件上 - 只需 10 行代码即可从 DataGrid 中获取实际记录。

因此，不存在将光标定位在网格上并获取数据集字段值的简便性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T14:08:03.717

Visual Studio 有 DataSet 和 DataTable 类，它们与 Delphi 中的 TClientDataSet 非常接近。

请参阅[http://msdn.microsoft.com/en-us/library/system.data.dataset.aspx](http://msdn.microsoft.com/en-us/library/system.data.dataset.aspx)

# html - .htm 或 .html 扩展名 - 哪一个是正确的，什么是不同的？

> ID：138953
> 
> 赞同：61
> 
> 时间：2008-09-26T11:49:56.297
> 
> 标签：html, naming-conventions, filenames

当我保存带有 .htm 或 .html 扩展名的文件时，哪个是正确的，什么是不同的？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-09-26T11:50:55.433

两者都没有错，这是一个偏好问题。传统上，MS 软件`htm`默认使用，*nix 更喜欢`html`.

正如下面所指出的，.htm 传统是从 win 3.xx 继承而来的，其中文件扩展名被限制为三个字符。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-26T11:58:48.037

主要是字数不同。

“.htm”有微软操作系统的味道，文件系统历史上将文件扩展名（点后的文件名部分）限制为 3 个字符。

“.html” 带有 Un*x 操作系统的味道，没有这种限制，当时用于所有严肃的互联网工作。

从实用上讲，两者是等价的。

区别在于文化。“.html”被一些人认为更正确。同样的人倾向于看不起微软的操作系统，并认为“.htm”是对其局限性的不雅提醒。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-26T11:51:51.033

当您将文件保存在本地时，差异并不重要 - 您的本地系统可能会将这两个文件扩展名视为可互换以供您的浏览器加载。其原因是历史上基于 Windows 的系统使用 3 个字母扩展名 ( `htm`)，而基于 Unix 的系统使用 4 个字母 ( `html`)。

在服务器端，在提供[默认文件名](http://www.sightspecific.com/~mosh/WWW_FAQ/ext.html)方面可能存在一些差异：

> 两种扩展名之间可能存在差异的一种情况是服务器的默认文件名。当从服务器请求一个未指定文件名的 URL 时，例如`[http://www.domain.dom/dirname/](http://www.domain.dom/dirname/)`，服务器从请求的 URL 返回一个与默认文件名匹配的文件。常见的默认文件名的示例包括 " `index.html`、 " `index.htm`、 " `default.html`、 " `default.htm`," 等。但是，管理员可以将服务器的默认文件名设置为任何他/她想要的。
> 
> 请注意，服务器通常配置有多个默认文件名。

因此，如果您对服务器的默认文件名有任何级别的控制权，那么这应该不是问题。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-26T12:49:39.567

我个人更喜欢 .html，但正如其他人所说，两者都可以。

**只要确保你只使用一个。永远不要在同一个网站上！** 指向 mypage.html 的链接与指向 mypage.htm 的链接不同

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T12:53:55.487

另请注意，作为 URI 的一部分，文件扩展名没有任何作用。事实上，它甚至不是文件扩展名，它只是看起来像一个。由 URI 标识的资源类型*未*编码在其名称中。相反，它由`Content-Type`HTTP 标头字段决定。将位图图片`myimage.html`以`index.png`. 这也是为什么有人认为文件扩展名根本不应该是 URI 的一部分的原因。

[Tim Berners-Lee 爵士在Hypertext Style: Cool URIs Don't Change](http://www.w3.org/Provider/Style/URI)中详细阐述了这一点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T11:54:04.443

它们是完全可以互换的。如果我正确理解历史，那么一开始正确的扩展名是 .html，但是当 Windows 95 出现时，它只能处理 3 个字符扩展名。

所以 .html 根据某些标准或其他标准是正确的，但实际上这并不重要（大多数时候......刚刚完成了快速的谷歌搜索并找到了以下内容）

但是有一个需要关注的方面，大多数主机服务器将要求您的默认起始页面命名为“index.html”而不是“index.htm”

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T13:34:32.177

我使用.htm。我猜少打字。或者也许是我的 Windows 偏见。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T11:51:34.870

两者都是正确的，过去文件扩展名的长度不得超过 3 个字符。

[http://en.wikipedia.org/wiki/Filename_extension](http://en.wikipedia.org/wiki/Filename_extension)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T11:57:30.503

我个人更喜欢 .html，因为名称是“超文本标记语言”。使用 .htm 是因为某些旧版 Windows 的文件扩展名不能超过 3 个字符

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-01-05T11:48:25.660

Both are working as same,but For the technical and non technical reference please find out here, [http://www.sightspecific.com/~mosh/www_faq/ext.html](http://www.sightspecific.com/~mosh/www_faq/ext.html)

# screen - 有哪些免费的屏幕设计工具可用

> ID：138979
> 
> 赞同：10
> 
> 时间：2008-09-26T11:57:13.797
> 
> 标签：screen

我正在寻找一种免费工具，可以在与客户的研讨会中快速创建屏幕设计（用于 Web 应用程序）。

该工具的重点应该是屏幕的功能定义，而不是屏幕的设计。

您对合适的工具有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-02-26T00:43:47.663

[香脂](http://www.balsamiq.com/)

*   在线的
*   快速且易于使用
*   图纸具有手绘感，因此您可以避免设计细节并专注于布局和功能
*   您可以保存 (XML) 您的绘图以便稍后打开
*   可以另存为画图

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T12:32:26.257

我发现[样机屏幕](http://mockupscreens.com/)非常好。这些设计看起来与正在进行的作品一模一样，让客户不会分心

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T04:37:17.140

[铅笔](http://pencil.evolus.vn/)很不错：

> Pencil 旨在提供免费和开源的 GUI 原型设计工具，人们可以轻松地安装和使用该工具在流行的桌面平台上创建模型。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-08T15:57:00.707

Balsamiq 的模型对我们来说效果很好。该产品实际上交付的比它承诺的要多。我们向其展示 Mockups 的每个人都想了解我们使用的开发工具。尽管，正如另一位评论者所观察到的那样，模型故意看起来像是在进行中，但我们的模型的功能使得那些被展示给他们的人开始将模型与功能软件混淆——我们必须不断提醒人们，模型只是复杂的规格。此外，制作该产品的 Balsamiq 人员是我共事过的最好的人。尽管该产品的零售价不是免费的（有时免费并不真正经济），但它的成本非常合理，并且通过生产坚固的、半功能性的、

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T12:00:11.950

任何所见即所得的工具都应该完成这项工作。我会推荐像[Kompozer](http://www.kompozer.net)这样的东西来完成最初的工作，前提是你不太担心设计，因此会或多或少地从实际产品开始。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T22:49:18.167

我发现使用类似 PowerPoint 的应用程序可以创造奇迹。你设计不同的方面并制作新的幻灯片。使用笔记记录细节。 [Google 演示文稿](http://docs.google.com/support/bin/topic.py?topic=15116&hl=en_US)是免费的，可以满足您的需求。

对于一些钱有[http://www.axure.com/](http://www.axure.com/)这是一个更强大的“原型”工具。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-17T12:05:09.173

您可以查看有关纸质原型制作的视频[http://malaysia.video.yahoo.com/watch/919824/3643540](http://malaysia.video.yahoo.com/watch/919824/3643540) :)

# windows - 如何测试文件是否是批处理脚本中的目录？

> ID：138981
> 
> 赞同：84
> 
> 时间：2008-09-26T11:57:24.937
> 
> 标签：windows, batch-file, cmd

有什么方法可以判断文件是否是目录？

我在变量中有文件名。在 Perl 我可以这样做：

```
if(-d $var) { print "it's a directory\n" } 
```

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2009-09-23T14:51:42.477

这有效：

```
if exist %1\* echo Directory 
```

适用于包含空格的目录名称：

```
C:\>if exist "c:\Program Files\*" echo Directory
Directory 
```

请注意，如果目录包含空格，则引号是必需的：

```
C:\>if exist c:\Program Files\* echo Directory 
```

也可以表示为：

```
C:\>SET D="C:\Program Files"
C:\>if exist %D%\* echo Directory
Directory 
```

孩子们，这在家里尝试是安全的！

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2010-09-16T16:35:55.063

最近用与上述不同的方法失败了。很确定他们过去工作过，可能与此处的 dfs 有关。现在使用[文件属性](http://ss64.com/nt/syntax-args.html)并剪切第一个字符

```
@echo off
SETLOCAL ENABLEEXTENSIONS
set ATTR=%~a1
set DIRATTR=%ATTR:~0,1%
if /I "%DIRATTR%"=="d" echo %1 is a folder
:EOF 
```

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2008-09-26T12:01:33.553

你可以这样做：

```
IF EXIST %VAR%\NUL ECHO It's a directory 
```

但是，这仅适用于名称中没有空格的目录。当您在变量周围添加引号以处理空格时，它将停止工作。要处理带有空格的目录，请将文件名转换为短 8.3 格式，如下所示：

```
FOR %%i IN (%VAR%) DO IF EXIST %%~si\NUL ECHO It's a directory 
```

`%%~si`转换为`%%i`8.3 文件名。要查看您可以使用`FOR`变量执行的所有其他技巧，请`HELP FOR`在命令提示符处输入。

（注意 - 上面给出的示例是在批处理文件中工作的格式。要让它在命令行上工作，请将两个地方的替换为。`%%`）`%`

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-10-02T12:57:13.320

除了我之前的产品，我发现这也有效：

```
if exist %1\ echo Directory 
```

%1 周围不需要引号，因为调用者会提供它们。与我一年前的回答相比，这节省了一个完整的击键；-)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-09-27T16:22:44.477

下面是一个脚本，它使用 FOR 构建一个完全限定的路径，然后 pushd 测试该路径是否为目录。请注意它对带有空格的路径以及网络路径是如何工作的。

```
@echo off
if [%1]==[] goto usage

for /f "delims=" %%i in ("%~1") do set MYPATH="%%~fi"
pushd %MYPATH% 2>nul
if errorlevel 1 goto notdir
goto isdir

:notdir
echo not a directory
goto exit

:isdir
popd
echo is a directory
goto exit

:usage
echo Usage:  %0 DIRECTORY_TO_TEST

:exit 
```

上面保存为“isdir.bat”的示例输出：

```
C:\>isdir c:\Windows\system32
is a directory

C:\>isdir c:\Windows\system32\wow32.dll
not a directory

C:\>isdir c:\notadir
not a directory

C:\>isdir "C:\Documents and Settings"
is a directory

C:\>isdir \
is a directory

C:\>isdir \\ninja\SharedDocs\cpu-z
is a directory

C:\>isdir \\ninja\SharedDocs\cpu-z\cpuz.ini
not a directory 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-09-27T10:08:15.753

这完美地工作

```
if exist "%~1\" echo Directory 
```

我们需要使用 %~1 从 %1 中删除引号，并在末尾添加反斜杠。然后再次将thw整体放入qutes中。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-03-10T05:29:13.360

@batchman61 方法的一种变体（检查 Directory 属性）。

这次我使用外部“查找”命令。

（哦，注意`&&`诀窍。这是为了避免冗长乏味的`IF ERRORLEVEL`语法。）

```
@ECHO OFF
SETLOCAL EnableExtensions
ECHO.%~a1 | find "d" >NUL 2>NUL && (
    ECHO %1 is a directory
) 
```

输出是：

*   目录。
*   目录符号链接或联结。
*   *损坏*的目录符号链接或联结。（不尝试解析链接。）
*   您没有读取权限的目录（例如“C:\System Volume Information”）

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-07-29T10:12:17.063

`CD``EXIT_FAILURE`当指定的目录不存在时返回一个。你[*有条件处理符号*](https://stackoverflow.com/a/3455609/4510033)，所以你可以像下面这样做。

```
SET cd_backup=%cd%
(CD "%~1" && CD %cd_backup%) || GOTO Error

:Error
CD %cd_backup% 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-26T16:53:23.930

## NUL 技术似乎只适用于 8.3 兼容的文件名。

### （换句话说，`D:\Documents and Settings` 是 "bad" 而 `D:\DOCUME~1` 是 "good"）

* * *

我认为当目录名称中有空格（例如“文档和设置”）时，使用“NUL”技术会有些困难。

我正在使用 Windows XP Service Pack 2 并从 %SystemRoot%\system32\cmd.exe 启动 cmd 提示符

以下是一些无效的示例以及对我有效的示例：

（这些都是在交互式提示下“实时”完成的演示。我认为您应该在尝试在脚本中调试它们之前让事情在那里工作。）

**这不起作用：**

`D:\Documents and Settings>if exist "D:\Documents and Settings\NUL" echo yes`

**这不起作用：**

`D:\Documents and Settings>if exist D:\Documents and Settings\NUL echo yes`

**这确实有效（对我来说）：**

`D:\Documents and Settings>cd ..`

`D:\>REM get the short 8.3 name for the file`

`D:\>dir /x`

`Volume in drive D has no label.` `Volume Serial Number is 34BE-F9C9`

`Directory of D:\`
`09/25/2008 05:09 PM <DIR> 2008`
`09/25/2008 05:14 PM <DIR> 200809~1.25 2008.09.25`
`09/23/2008 03:44 PM <DIR> BOOST_~3 boost_repo_working_copy`
`09/02/2008 02:13 PM 486,128 CHROME~1.EXE ChromeSetup.exe`
`02/14/2008 12:32 PM <DIR> cygwin`

[[看这里！！！！]]
`09/25/2008 08:34 AM <DIR> DOCUME~1 Documents and Settings`

`09/11/2008 01:57 PM 0 EMPTY_~1.TXT empty_testcopy_file.txt`
`01/21/2008 06:58 PM <DIR> NATION~1 National Instruments Downloads`
`10/12/2007 11:25 AM <DIR> NVIDIA`
`05/13/2008 09:42 AM <DIR> Office10`
`09/19/2008 11:08 AM <DIR> PROGRA~1 Program Files`
`12/02/1999 02:54 PM 24,576 setx.exe`
`09/15/2008 11:19 AM <DIR> TEMP`
`02/14/2008 12:26 PM <DIR> tmp`
`01/21/2008 07:05 PM <DIR> VXIPNP`
`09/23/2008 12:15 PM <DIR> WINDOWS`
`02/21/2008 03:49 PM <DIR> wx28`
`02/29/2008 01:47 PM <DIR> WXWIDG~2 wxWidgets`
`3 File(s) 510,704 bytes`
`20 Dir(s) 238,250,901,504 bytes free`

`D:\>REM now use the \NUL test with the 8.3 name`

`D:\>if exist d:\docume~1\NUL echo yes`

`yes`

**这可行，但有点傻，因为点已经暗示我在一个目录中：**

`D:\Documents and Settings>if exist .\NUL echo yes`

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-09-08T13:24:22.230

我用这个：

```
if not [%1] == [] (
  pushd %~dpn1 2> nul
  if errorlevel == 1 pushd %~dp1
) 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-02-10T19:13:27.543

这有效并且还处理其中带有空格的路径：

```
dir "%DIR%" > NUL 2>&1

if not errorlevel 1 (
    echo Directory exists.
) else (
    echo Directory does not exist.
) 
```

在我看来，可能不是最有效但比其他解决方案更容易阅读的解决方案。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-07-26T09:41:05.770

一个非常简单的方法是检查孩子是否存在。

如果一个孩子没有任何孩子，该`exist`命令将返回 false。

```
IF EXIST %1\. (
  echo %1 is a folder
) else (
  echo %1 is a file
) 
```

如果您没有足够的访问权限（我没有测试过），您可能会有一些误报。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-10-25T12:17:49.733

如果你可以`cd`进入它，它是一个目录：

```
set cwd=%cd%

cd /D "%1" 2> nul
@IF %errorlevel%==0 GOTO end

cd /D "%~dp1"
@echo This is a file.

@goto end2
:end
@echo This is a directory
:end2

@REM restore prior directory
@cd %cwd% 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-26T12:01:41.103

根据[这篇](http://www.faqs.org/faqs/msdos-programmer-faq/part3/section-7.html)题为“批处理文件如何测试目录的存在”的文章，它“不完全可靠”。

但我刚刚测试了这个：

```
@echo off
IF EXIST %1\NUL goto print
ECHO not dir
pause
exit
:print
ECHO It's a directory
pause 
```

它似乎工作

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-06-07T13:34:31.343

这是我的解决方案：

```
REM make sure ERRORLEVEL is 0
TYPE NUL

REM try to PUSHD into the path (store current dir and switch to another one)
PUSHD "insert path here..." >NUL 2>&1

REM if ERRORLEVEL is still 0, it's most definitely a directory
IF %ERRORLEVEL% EQU 0 command...

REM if needed/wanted, go back to previous directory
POPD 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-09-20T15:38:03.360

我想发布我自己的关于这个主题的函数脚本，希望有一天对某人有用。

```
@pushd %~dp1
@if not exist "%~nx1" (
        popd
        exit /b 0
) else (
        if exist "%~nx1\*" (
                popd
                exit /b 1
        ) else (
                popd
                exit /b 3
        )
) 
```

此批处理脚本检查文件/文件夹是否存在以及它是文件还是文件夹。

**用法：**

脚本.bat“路径”

**退出代码：**

0：文件/文件夹不存在。

1：存在，是文件夹。

3：存在，是文件。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-09-07T22:12:45.277

使用`%%~si\NUL`方法的一个问题是它有可能猜错。有可能将文件名缩短为错误的文件。我不认为`%%~si`解决 8.3 文件名，但猜测它，但使用字符串操作来缩短文件路径。我相信如果您有类似的文件路径，它可能无法正常工作。

另一种方法：

```
dir /AD %F% 2>&1 | findstr /C:"Not Found">NUL:&&(goto IsFile)||(goto IsDir)

:IsFile
  echo %F% is a file
  goto done

:IsDir
  echo %F% is a directory
  goto done

:done 
```

您可以替换`(goto IsFile)||(goto IsDir)`为其他批处理命令：
`(echo Is a File)||(echo is a Directory)`

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-07-12T22:27:03.023

在 Windows 7 和 XP 下，我无法让它告诉映射驱动器上的文件与目录。以下脚本：

```
@echo 关闭
如果存在 c:\temp\data.csv 回显 data.csv 是一个文件
如果存在 c:\temp\data.csv\ echo data.csv 是一个目录
如果存在 c:\temp\data.csv\nul echo data.csv 是一个目录
如果存在 k:\temp\nonexistent.txt echo nonexistent.txt 是一个文件
如果存在 k:\temp\something.txt echo something.txt 是一个文件
如果存在 k:\temp\something.txt\ echo something.txt 是一个目录
如果存在 k:\temp\something.txt\nul echo something.txt 是一个目录

```

产生：

```
data.csv 是一个文件
something.txt 是一个文件
something.txt 是一个目录
something.txt 是一个目录

```

因此，请注意您的脚本是否可能会被提供映射或 UNC 路径。下面的 pushd 解决方案似乎是最万无一失的。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-07-12T20:39:58.450

这是我在 BATCH 文件中使用的代码

```
```
@echo off
set param=%~1
set tempfile=__temp__.txt
dir /b/ad > %tempfile%
set isfolder=false
for /f "delims=" %%i in (temp.txt) do if /i  "%%i"=="%param%" set isfolder=true
del %tempfile%
echo %isfolder%
if %isfolder%==true echo %param% is a directory 
```

```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-11-24T02:44:09.507

这是我经过多次测试后的解决方案，如果存在、pushd、dir/AD 等...

```
@echo off
cd /d C:\
for /f "delims=" %%I in ('dir /a /ogn /b') do (
    call :isdir "%%I"
    if errorlevel 1 (echo F: %%~fI) else echo D: %%~fI
)
cmd/k

:isdir
echo.%~a1 | findstr /b "d" >nul
exit /b %errorlevel%

:: Errorlevel
:: 0 = folder
:: 1 = file or item not found 
```

*   它适用于没有扩展名的文件
*   它适用于名为 folder.ext 的文件夹
*   它适用于 UNC 路径
*   它适用于双引号完整路径或仅使用目录名或文件名。
*   即使您没有读取权限也可以使用
*   它适用于目录链接（连接）。
*   它适用于路径包含目录链接的文件。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-01-24T12:01:52.053

如果您的目标是仅处理目录，那么这将很有用。

这取自[https://ss64.com/nt/for_d.html](https://ss64.com/nt/for_d.html)

> 示例... 列出文件夹 C:\Work\ 下名称以“User”开头的每个子文件夹：
> 
> ```
> CD \Work
> FOR /D /r %%G in ("User*") DO Echo We found 
> ```

`FOR /D`或者`FOR /D /R`

```
@echo off
cd /d "C:\your directory here"
for /d /r %%A in ("*") do echo We found a folder: %%~nxA
pause 
```

删除`/r`以仅深入一个文件夹。该`/r`开关是递归的，并且在下面的命令中没有记录。

`for /d`来自命令的帮助`for /?`

> FOR /D %variable IN (set) DO 命令 [命令参数]
> 
> 如果 set 包含通配符，则指定匹配目录名而不是文件名。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-06-09T15:58:36.247

我最近也在寻找这个，并且偶然发现了一个对我有用的解决方案，但我不知道它有什么限制（因为我还没有发现它们）。我相信这个答案本质上与上面 TechGuy 的答案相似，但我想增加另一个层次的可行性。无论哪种方式，我都在将参数扩展为完整的文件路径方面取得了巨大成功，我相信您必须使用`setlocal enableextensions`它才能正常工作。

使用下面我可以判断文件是目录还是相反。这在很大程度上取决于用户实际需要什么。如果您更喜欢使用搜索`errorlevel`vs的结构，`&&`并且`||`在您的工作中，您当然可以这样做。有时 if 构造 for`errorlevel`可以给您更多的灵活性，因为您不必使用`GOTO`有时会破坏您的环境条件的命令。

```
@Echo Off
setlocal enableextensions

Dir /b /a:D "%~f1" && Echo Arg1 is a Folder || Echo Arg1 is NOT a Folder

Dir /b /a:-D "%~f1" && Echo Arg1 is a File || Echo Arg1 is NOT a File

pause 
```

使用它，您可以简单地将文件拖放到您正在构建的工具上以解析它们。相反，如果您正在使用其他方式梳理文件结构并且您已经拥有该文件并且没有将它们拖放到批处理文件中，则可以实现以下操作：

```
@Echo Off
setlocal enableextensions

Dir /b /s "C:\SomeFolderIAmCombing\*" >"%~dp0SomeFiletogoThroughlater.txt"

For /f "Usebackq Delims=" %%a in ("%~dp0SomeFiletogoThroughlater.txt") do (
  Call:DetectDir "%%a"
)

REM Do some stuff after parsing through Files/Directories if needed.  
REM GOTO:EOF below is used to skip all the subroutines below.

REM Using ' CALL:DetectDir "%%a" ' with the for loop keeps the for 
REM loop environment running in the background while still parsing the given file
REM in a clean environment where GOTO and other commmands do not need Variable Expansion.

GOTO:EOF

:DetectDir [File or Folder being checked]

REM Checks if Arg1 is a Directory.  If yes, go to Dir coding. If not, go to File coding.
Dir /b /a:D "%~f1" && Echo Arg1 is a Folder & GOTO:IsDir || Echo Arg1 is NOT a Folder & GOTO:IsFile

REM Checks if Arg1 is NOT a Directory.  If Yes, go to File coding.  If not, go to Dir coding
Dir /b /a:-D "%~f1" && Echo Arg1 is a File & GOTO:IsFile || Echo Arg1 is NOT a File & GOTO:IsDir

:IsDir
  REM Do your stuff to the Folder
GOTO:EOF

:IsFile
  REM do your stuff to the File
GOTO:EOF 
```

* * *

## 回答 #23

> 赞同：-3
> 
> 时间：2013-04-15T14:37:25.267

我们不能只用这个测试：

```
IF [%~x1] == [] ECHO Directory 
```

它似乎对我有用。

# performance - 在 Delphi 中 inc(i) 和 i := i + 1 之间是否存在性能差异？

> ID：138994
> 
> 赞同：14
> 
> 时间：2008-09-26T12:01:27.280
> 
> 标签：performance, delphi

我有一个程序有很多

```
i := i +1; 
```

在里面，我认为

```
 inc(i); 
```

看起来好多了。是否存在性能差异或函数调用只是被编译器内联？我知道这对我的应用程序可能根本不重要，我只是好奇。

编辑：我对性能进行了一些测量，发现差异非常小，实际上小到 5.1222741794670901427682121946224e-8！所以真的没关系。优化选项确实并没有太大改变结果。感谢所有提示和建议！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-27T07:41:12.203

如果打开**溢出检查，则会有很大的不同。**基本上*Inc**不做**溢出检查*。当您打开这些编译器选项时，按照建议进行操作并使用反汇编窗口查看差异（每个选项都不同）。

If those options are turned off, then there is no difference. Rule of thumb, use Inc when you don't care about a range checking failure (since you won't get an exception!).

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T12:06:38.643

现代编译器优化代码。
inc(i) 和 i:= i+1; 几乎一样。

使用任何你喜欢的。

编辑：正如 Jim McKeeth 更正的那样：溢出检查是有区别的。Inc 不进行范围检查。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-26T12:41:02.193

这完全取决于“i”的类型。在Delphi中，通常将循环变量声明为“i：Integer”，但也可以是“i：PChar”，它在Delphi 2009和FPC（我猜这里）和PWideChar上解析为PAnsiChar Delphi 2009 和 Delphi.NET（也在猜测）。

由于 Delphi 2009 可以进行指针数学运算，因此 Inc(i) 也可以在类型指针上完成（如果它们是在 POINTER_MATH 打开的情况下定义的）。

例如：

```
type
  PSomeRecord = ^RSomeRecord;
  RSomeRecord = record
    Value1: Integer;
    Value2: Double;
  end;

var
  i: PSomeRecord; 

procedure Test;
begin
  Inc(i); // This line increases i with SizeOf(RSomeRecord) bytes, thanks to POINTER_MATH !
end; 
```

正如其他回答者已经说过的那样：通过打开，可以很容易地看到编译器对您的代码做了什么：

> 视图 > 调试窗口 > CPU 窗口 > 反汇编

请注意，OPTIMIZATION、OVERFLOW_CHECKS 和 RANGE_CHECKS 等编译器选项可能会影响最终结果，因此您应该注意根据自己的喜好进行设置。

一个提示：在每个单元中，$INCLUDE 一个引导编译器选项的文件，这样，当你的 .bdsproj 或 .dproj 以某种方式损坏时，你不会丢失设置。（查看 JCL 的源代码以获得一个很好的例子）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T12:19:41.467

您可以在调试时在 CPU 窗口中进行验证。对于这两种情况，生成的 CPU 指令是相同的。

我同意`Inc(I);`看起来更好，尽管这可能是主观的。

更正：我刚刚在 Inc 的文档中找到了这个：

> “在某些平台上，Inc 可能会生成优化的代码，这在紧密循环中尤其有用。”

因此，建议坚持使用 Inc.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T12:20:28.343

您总是可以编写两段代码（在单独的过程中），在代码中放置断点并在 CPU 窗口中比较汇编程序。

一般来说，我会使用 inc(i) 任何显然仅用作某种循环/索引的地方，以及 + 1 任何地方 1 将使代码更易于维护的地方（即，它可能会更改为另一个整数未来）或从算法/规范的角度来看更具可读性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T12:38:03.027

“在某些平台上，Inc 可能会生成优化的代码，这在紧密循环中尤其有用。” 对于优化的编译器，例如 Delphi，它并不关心。那是关于旧的编译器（例如 Turbo Pascal）

# jsp - 如何从 JSP <%! ... %> 阻塞？

> ID：138999
> 
> 赞同：39
> 
> 时间：2008-09-26T12:03:10.850
> 
> 标签：jsp

我刚开始学习JSP技术，碰壁了。

*如何从 <%! ... %> JSP 声明块？*

这不起作用：

```
<%! 
void someOutput() {
    out.println("Some Output");
}
%>
...
<% someOutput(); %> 
```

服务器说没有“出局”。

**U：**我确实知道如何用这个返回字符串的方法重写代码，但是有没有办法在 <%! 无效（）{}％>？尽管它可能不是最佳的，但它仍然很有趣。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-26T12:09:28.870

您不能在指令中使用“out”变量（也不能使用任何其他“预先声明的”scriptlet 变量）。

JSP 页面由您的网络服务器翻译成 Java servlet。例如，在 tomcats 中，scriptlet 中的所有内容（以“<%”开头）以及所有静态 HTML 都被转换为一个巨大的 Java 方法，该方法将您的页面逐行写入名为“out”的 JspWriter 实例。这就是为什么您可以直接在 scriptlet 中使用“out”参数的原因。另一方面，指令（以“<%！”开头）被翻译为单独的 Java 方法。

例如，一个非常简单的页面（我们称之为 foo.jsp）：

```
<html>
    <head/>
    <body>
        <%!
            String someOutput() {
                return "Some output";
            }
        %>
        <% someOutput(); %>
    </body>
</html> 
```

最终会看起来像这样（为清楚起见忽略了很多细节）：

```
public final class foo_jsp
{
    // This is where the request comes in
    public void _jspService(HttpServletRequest request, HttpServletResponse response) 
        throws IOException, ServletException
    {
        // JspWriter instance is gotten from a factory
        // This is why you can use 'out' directly in scriptlets
        JspWriter out = ...; 

        // Snip

        out.write("<html>");
        out.write("<head/>");
        out.write("<body>");
        out.write(someOutput()); // i.e. write the results of the method call
        out.write("</body>");
        out.write("</html>");
    }

    // Directive gets translated as separate method - note
    // there is no 'out' variable declared in scope
    private String someOutput()
    {
        return "Some output";
    }
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-06-12T12:17:25.423

```
<%!
private void myFunc(String Bits, javax.servlet.jsp.JspWriter myOut)
{  
  try{ myOut.println("<div>"+Bits+"</div>"); } 
  catch(Exception eek) { }
}
%>
...
<%
  myFunc("more difficult than it should be",out);
%> 
```

试试这个，它对我有用！

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-26T12:19:05.727

我想这会有所帮助：

```
<%! 
   String someOutput() {
     return "Some Output";
  }
%>
...
<%= someOutput() %> 
```

无论如何，在视图中包含代码并不是一个好主意。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-26T16:57:05.697

您需要做的就是将 JspWriter 对象作为参数传递到您的方法中，即

```
void someOutput(JspWriter stream) 
```

然后通过以下方式调用它：

```
<% someOutput(out) %> 
```

writer 对象是 _jspService 中的一个局部变量，因此您需要将它传递给您的实用程序方法。这同样适用于所有其他内置引用（例如请求、响应、会话）。

查看正在发生的事情的一个好方法是使用 Tomcat 作为您的服务器并深入到从您的“jsp”页面生成的“.java”文件的“工作”目录。或者，在 weblogic 中，您可以使用“weblogic.jspc”页面编译器来查看请求页面时将生成的 Java。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-03-15T17:18:52.960

一个简单的替代方案如下：

```
<%!
    String myVariable = "Test";
    pageContext.setAttribute("myVariable", myVariable);
%>

<c:out value="myVariable"/>
<h1>${myVariable}</h1> 
```

您可以在 jsp 代码中以任何方式简单地使用该变量

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-03-03T23:17:04.603

你可以这样做：

```
<%!
String myMethod(String input) {
    return "test " + input;
}
%>

<%= myMethod("1 2 3") %> 
```

这将输出`test 1 2 3`到页面。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-08-28T04:24:02.390

回答为时已晚，但这对其他人有帮助

```
<%! 
     public void printChild(Categories cat, HttpServletResponse res ){
       try{
          if(cat.getCategoriesSet().size() >0){
              res.getWriter().write("") ; 
          }
       }catch(Exception exp){

       }
     }

%> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-07-15T19:06:53.523

你可以这样做：

```
<%

out.print("<p>Hey!</p>");    
out.print("<p>How are you?</p>");

%> 
```***********************``**