# StackOverflow 问答 000670000-000670999

# c# - 流畅的 Nhibernate 和可插入的继承

> ID：670000
> 
> 赞同：0
> 
> 时间：2009-03-21T21:06:49.503
> 
> 标签：c#, inheritance, nhibernate, fluent

有什么方法可以在不使用 Fluent NHibernate 更改基表映射的情况下定义/扩展继承？例如使用 Castle.ActiveRecord（基于 NHibernate），您可以像这样定义继承：

```
[ActiveRecord("entity"), JoinedBase]
public class Entity : ActiveRecordBase
{ 
    [PrimaryKey]
    public int Id { get; set; }
}

[ActiveRecord("entitycompany")]
public class CompanyEntity : Entity
{
    [JoinedKey("comp_id")]
    public int CompId { get; set; }
} 
```

*   可以在不更改基本实体映射的情况下添加或删除新的子类。
*   当我们调用`Entity.FindAll()`它时，它会返回所有实体（也包括继承的实体）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-28T01:02:00.403

现在不行，不行。当然不是以任何方式不需要*修改*您的父类映射。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T18:37:14.943

好的，我找到了方法，可以使用 IClassConvention + IOC（带有程序集扫描的结构映射）。

# objective-c - 右侧带有“填充”的 NSTextField

> ID：670015
> 
> 赞同：6
> 
> 时间：2009-03-21T21:14:48.407
> 
> 标签：objective-c, cocoa, nstextfield

我试图让“剩余字符通知”显示在我的圆形 NSTextField 中，并且在 Interface Builder 的帮助下，我用两个 NSTextField 得到了它，它已经看起来像这样：

[替代文字 http://jeenaparadies.net/t/s/Twittia-NSTextField1.png](http://jeenaparadies.net/t/s/Twittia-NSTextField1.png)

但是当我再写一点时，它看起来像这样：

[替代文字 http://jeenaparadies.net/t/s/Twittia-NSTextField2.png](http://jeenaparadies.net/t/s/Twittia-NSTextField2.png)

我唯一能想到的就是继承 NSTextField 并用它做一些事情，这样它就不会在数字下绘制文本，但我不知道如何开始并且需要一些帮助。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-22T09:10:16.177

最简单的方法可能是子类化`NSTextFieldCell`和覆盖`-drawInteriorWithFrame:inView:`and `-selectWithFrame:inView:editor:delegate:start:length:`。

您需要决定为计数分配多少空间并在缩略空间中绘制。尽管尚未在圆形文本字段中进行测试，但类似此示例代码的内容应该可以工作。

`NSCell`您可以在 Apple 的[PhotoSearch 示例代码](http://developer.apple.com/SampleCode/PhotoSearch/index.html)中找到有关子类化的更多信息。

```
- (void)drawInteriorWithFrame:(NSRect)bounds inView:(NSView *)controlView {
    NSRect titleRect = [self titleRectForBounds:bounds];
    NSRect countRect = [self countAreaRectForBounds:bounds];

    titleRect = NSInsetRect(titleRect, 2, 0);

    NSAttributedString *title = [self attributedStringValue];
    NSAttributedString *count = [self countAttributedString];

    if (title)
        [title drawInRect:titleRect];

    [count drawInRect:countRect];
}

- (void)selectWithFrame:(NSRect)aRect inView:(NSView *)controlView editor:(NSText *)textObj delegate:(id)anObject start:(NSInteger)selStart length:(NSInteger)selLength {
    NSRect selectFrame = aRect;
    NSRect countRect = [self countAreaRectForBounds:aRect];

    selectFrame.size.width -= countRect.size.width + PADDING_AROUND_COUNT;

    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(__textChanged:) name:NSTextDidChangeNotification object:textObj];
    [super selectWithFrame:selectFrame inView:controlView editor:textObj delegate:anObject start:selStart length:selLength];
}

- (void)endEditing:(NSText *)editor {
    [[NSNotificationCenter defaultCenter] removeObserver:self name:NSTextDidChangeNotification object:editor];

    [super endEditing:editor];
}

- (void)__textChanged:(NSNotification *)notif {
    [[self controlView] setNeedsDisplay:YES];
} 
```

# javascript - Javascript焦点测量

> ID：670021
> 
> 赞同：0
> 
> 时间：2009-03-21T21:21:33.447
> 
> 标签：javascript, focus

我正在寻找一个能够测量 div （或任何其他对象）处于“焦点”中的时间的 Javascript 库（如：浏览器正在显示并且窗口被聚焦；不是正常的 Javascript 焦点事件） .

你知道这样的东西是否存在吗？或类似的东西我可以调整？

编辑：好的。改写以免误会。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T21:32:16.040

我很确定我马上就明白了你的问题！. .

如果您的意思是“在屏幕上可见”中的“焦点”，您可以通过窗口范围和 body.scrollTop 以及从父项中的偏移量递归计算的 div 的绝对位置来解决这个问题。

# c++ - 避免一千个 if 语句的最佳方法是什么？

> ID：670026
> 
> 赞同：4
> 
> 时间：2009-03-21T21:24:28.807
> 
> 标签：c++, boost, rational-rose

我基本上有这个问题：现在，我们有一个系统，它获取一个字符串作为输入，它基本上说 ACTION:。

对于每个动作都有一个自动生成的函数（Rational Rose GRRR），例如

```
bouncer_comm.chatMessage("data goes here").sendAt(msg->sapIndex0());
bouncer_comm.askforname().sendAt(msg->sapindex0()); 
```

`bouncer_comm`返回一个`RTOutSignal`，由于玫瑰使用的奇怪结构，我无法手动创建它们。

现在，我唯一的选择是创建一百个左右的 if 语句，我这样做：

```
if(action == "CHAT")  bouncer_comm.chatMessage("data goes here").sendAt(msg->sapIndex0()); 
```

这真的很烦人。

避免这种情况的最佳方法是什么？我已经看过/尝试了无数的东西，这是一个非常旧的理性玫瑰（pre 2k）版本，是的。

如果有人有任何想法，那将是惊人的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-21T21:35:01.963

我喜欢@cobbal 对上面函数指针散列的想法，但你可以用多态性替换这个条件逻辑。

见： [http ://c2.com/cgi/wiki?ReplaceConditionalWithPolymorphism](http://c2.com/cgi/wiki?ReplaceConditionalWithPolymorphism)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-21T21:27:42.433

哈希存储函数指针在这里可以很好地工作

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T21:40:57.503

我将多态性与工厂模式结合使用。我为此减少了很多如果：

```
 MyAbstractClass *ac = Factory::getHandlerFor(data);
ac->perform(parameters); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T21:46:43.900

我认为最简单的是 boost::functions 的映射。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T21:39:30.377

您可以使用 boost::bind 或 boost::function 和地图。这将允许您调用正确的函数，即使知道每个函数都有不同数量的参数。

如果您不想要任何额外的代码，您可以使用函数对象和继承。

# attributes - 如何使用 HTMLpurifier 将某些属性列入白名单？

> ID：670031
> 
> 赞同：0
> 
> 时间：2009-03-21T21:28:00.483
> 
> 标签：attributes, whitelist, htmlpurifier

如何使用 HTMLpurifier 将某些属性列入白名单？我希望 HTMLpurifier 删除所有其他不允许的属性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T13:25:57.417

[HTML.AllowedAttributes](http://htmlpurifier.org/live/configdoc/plain.html#HTML.AllowedAttributes)。请注意，[使用 HTML.AllowedAttributes 时，您还需要使用 HTML.AllowedElements](http://htmlpurifier.org/phorum/read.php?3,3048,3049#msg-3049)。而且[您可能需要在进行过程中添加更多内容](http://htmlpurifier.org/phorum/read.php?3,2928,2929#msg-2929)。喜欢`AllowedFrameTargets`for `target=""`, `AllowedRel`, `AllowedRev`, `EnableAttrID`, ... 没有太多选择，但要彻底测试。

# c++ - 模板赋值运算符：有效的 C++？

> ID：670041
> 
> 赞同：0
> 
> 时间：2009-03-21T21:34:37.597
> 
> 标签：c++, class, templates, static, variable-assignment

只是一个快速简单的问题，但在任何文档中都找不到。

```
template <class T>
T* Some_Class<T>::Some_Static_Variable = NULL; 
```

它用 g++ 编译，但我不确定这是否有效。是吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T21:41:03.057

是的，这段代码是正确的。有关更多信息，请参阅此 C++ 模板教程

[http://www.is.pku.edu.cn/~qzy/cpp/vc-stl/templates.htm#T14](http://www.is.pku.edu.cn/~qzy/cpp/vc-stl/templates.htm#T14)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T18:55:39.560

这是有效的 C++，但它与模板化赋值运算符无关？！该片段定义了 的静态成员`SomeClass<T>`并将其初始值设置为`NULL`。这很好，只要你只做一次，否则你会踩到可怕的`One Definition Rule`.

模板化赋值运算符类似于：

```
class AClass {
public:
    template <typename T>
    AClass& operator=(T val) {
        std::ostringstream oss;
        oss << val;
        m_value = oss.str();
        return *this;
    }
    std::string const& str() const { return m_value; }
private:
    std::string m_value;
};

std::ostream& operator<<(std::ostream& os, AClass const& obj) {
    os << obj.str();
    return os;
}

int main() {
    AClass anObject;
    anObject = 42;
    std::cout << anObject << std::endl;
    anObject = "hello world";
    std::cout << anObject << std::endl;
    return 0;
} 
```

*在实现类变体*类时，模板赋值运算符对于提供转换最有用。但是，如果您要使用这些小动物，则应考虑许多警告。[谷歌搜索](http://www.google.com/search?q=template+assignment+operator)会发现有问题的案例。

# informix - Informix 未来

> ID：670046
> 
> 赞同：3
> 
> 时间：2009-03-21T21:38:29.037
> 
> 标签：informix

我正在开发一个与 Informix 一起运行的系统，因此我开始越来越多地了解 Informix。我正在考虑学习并获得 Informix 认证。

您认为 Informix 有未来吗？还是我应该尝试更多地了解 Oracle 或 MySQL 或其他一些流行的数据库系统？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-23T05:36:00.410

我有偏见 - 自 1986 年以来我一直在使用 Informix，自 1990 年以来一直在使用 Informix。

我认为 Informix 有一个持续的未来。受制于预测未来的正常变幻莫测，并考虑到当前经济状况带来的额外不确定性，我仍然希望在 5 年内从事 Informix 或与 Informix 合作；我想我可能会在 10 年内这样做。

但是，值得了解不止一种 DBMS，就像值得了解不止一种操作系统和不止一种编程语言一样。因此，我当然不能责怪您还学习了其他 DBMS。

KillingMichael 对人气、价格和旅行提出了一个有趣的观点。可能存在一些相关性。这还取决于您所追求的工作类型——您是否正在寻找定期或频繁更换工作的承包工作，或者您是否正在寻找更稳定的工作。

要学习哪个其他 DBMS 是一个复杂的决定。我不确定 SQLite 和 GoogleAppEngine 是否可能拥有足够少的开发人员，以至于您可以领先于其他人。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T21:59:20.500

既然你征求意见:)

1：选择你更喜欢的。因为 Informix、Oracle 和 MySQL 都有未来。而且，最好的未来来自使用/使用您喜欢的工具。

2：一般的经验法则：如果您使用不太“流行”的工具工作，那么您的费率会上涨，但您的旅行也会如此。

3：[恕我直言] 但是：如果您愿意深入研究以掌握它，我个人的建议是选择更新的东西。例如：SQLite、GoogleAppEngine 等。您可以在其中领先于其他大约 100,000 名已经拥有该特定技能的人。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-10-04T08:58:06.207

仅作记录 - 我知道一些公司不得不在世界各地雇用人员进行远程工作，因为他们找不到具有出色本地 Informix 技能的本地甚至国家人员。

围绕 IDS 开发的新应用程序很少——至少部分是因为 IBM 将其视为遗留问题并且不推广它，即使他们继续开发它，一点点。

而且因为很少有新的应用程序正在使用 IDS 开发（更多的应用程序被移植到 Oracle 等），所以很少有人熟练掌握它。所以正如之前的海报所说——如果你真的想就去做，但不要把所有的鸡蛋都放在一个篮子里——并准备好旅行或远程工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-12T09:12:47.033

我错过了您正在使用的 Informix 的哪个领域。Informix 作为 DBA/Admin，或 Informix 作为软件开发人员。如果是后者，我会说继续。我使用 4GL（和 SPL）作为 Informix 开发人员已有 12 年了，没有人愿意再使用这些开发。我正在接受甲骨文的再培训。也就是说，作为数据库服务器的 Informix 没有理由没有未来。问题是它被视为一个遗留系统（并且很可能是），如果你有一个。它不再存在的原因是因为 IBM 在营销方面很烂。替换它的主要语言 4GL 的方法太“购买” Genero，它只是一个漂亮的面孔，围绕着旧的 4GL 语言。将其与带有 Java 的 Oracle 进行比较。或者 SQL Server 和 C#。“Informix 和 4gl/Genero”嗯。即使作为它的开发者，也从来没有作为企业去那里。那么对于大多数甚至没有听说过 Informix 的其他人来说，他们怎么能期待呢。他们需要与真正的竞争者语言上床并进行一些真正的营销以使 Informix 作为数据库服务器认真对待，因为我认为它在那里并且我选择它而不是 MS Server。

Paul@ 如果您认识需要 Informix 开发人员的公司，我会很高兴地暂停我的 Oracle 职业生涯！;)

# visual-studio-2008 - 从 VS 2005 切换到 VS 2008 但坚持使用 .Net 2.0，我应该吗？

> ID：670053
> 
> 赞同：1
> 
> 时间：2009-03-21T21:43:57.027
> 
> 标签：visual-studio-2008

我目前正在使用 VS 2005，因为我维护的大多数程序都是为 .Net 2.0 编写的，我有一个需要 .Net 3.5 的新程序，我应该切换到 VS 2008 吗？我的 .Net 没有任何问题吗？ 2.0程序？我应该注意什么？

PS 我主要使用 Winform 应用程序，如果这有什么不同的话。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-21T21:57:37.447

如果可能的话，我不仅会亲自升级 IDE，还会升级目标框架。根据我的经验，能够使用 LINQ 的好处是巨大的，可以解决各种各样的问题。

如果您真的想继续使用 .NET 2.0，您可以使用 VS2008 的“Target Framework”选项，[正如 abatishchev 所解释的那样](https://stackoverflow.com/questions/670053/switching-from-vs-2005-to-vs-2008-but-sticking-with-net-2-0-should-i/670064#670064)- 但请注意“2.0”实际上意味着“2.0SP1”。如果您不小心使用了特定于 2.0SP1 的类型（例如`DateTimeOffset`），那么您的代码将无法在 vanilla 2.0 机器上运行。

即使您使用的是 .NET 2.0，[您仍然可以使用 C# 3.0 的大部分优势](http://csharpindepth.com/Articles/Chapter1/Versions.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T21:49:19.760

Visual Studio 2008 中的 C# 项目属性面板包含设置目标框架的下拉列表：2.0；3.0 (SP1); 3.5.

您可以为所有应用程序设置 2.0，并且在大多数情况下都不会出现问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T21:50:20.960

我在 VS2008 的 NET 2.0 项目中工作过，没有任何问题。VS 允许您为每个项目选择框架目标。我建议更改为 VS2008。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T01:24:46.200

请注意，就 .NET 2.0 而言，.NET 3.5（您应该使用 3.5 SP1）只是一对服务包 - 它包括 .NET 2.0 SP1 和 .NET 2.0 SP2。它包括 .NET 3.0 SP1，您不必关心它，因为您没有使用 .NET 3.0。

除了 .NET 2.0 使用的程序集之外，其余的都是一组程序集。显然，您的 .NET 2.0 代码不使用这些新程序集，因此新程序集存在于特定计算机上这一事实对 .NET 2.0 应用程序没有影响。

这意味着使用 VS2008 (SP1) 以 .NET 2.0 为目标是完全安全的，但是您可以在给定程序中使用任何新功能，而不会损害应用程序的 .NET 2.0 部分。

增值来自 Visual Studio 本身的改进。在我看来，XML 编辑器本身就值得升级，而且我已经多次建议人们，如果他们想要一个好的、免费的 XML 编辑器，他们应该获得 Visual Studio Express 2008！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T21:57:36.353

如果可以的话，Visual Studio 2008 中的附加值值得从 VS 2005 迁移。Visual Studio 2008 中的多目标支持使继续处理 .NET 2.0 项目成为可能。也就是说，一旦您的项目迁移到 Visual Studio 2008，您可能会发现很难将其迁移回 Visual Studio 2005。因此，如果需要，您应该仔细考虑迁移。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T22:34:46.843

如果您有任何 Crystal Reports，请注意升级后将生成的安装程序包的更改。检查前几个以确保 Crystal 2008 是先决条件。

# iphone - NSURLConnection、NSURLRequest 和远程缓存

> ID：670056
> 
> 赞同：7
> 
> 时间：2009-03-21T21:45:24.497
> 
> 标签：iphone, cocoa-touch, http, nsurlconnection

我在 iPhone 上使用 NSURLConnection 异步连接进行请求缓存时遇到了一个小问题。我不知道我是否理解错误，或者 Cocoa 是否在做与它应该做的相反的事情......

NSURLRequest 的文档说：

> NSURLRequestReloadIgnoringLocalCacheData
> 
> 指定应从原始源加载 URL 加载的数据。不应使用现有缓存数据来满足 URL 加载请求。

和：

> NSURLRequestReloadIgnoringLocalAndRemoteCacheData
> 
> 指定不仅应忽略本地缓存数据，而且应指示代理和其他中间体在协议允许的范围内忽略其缓存。

现在，如果我发送一个带有 NSURLRequestReloadIgnoringLocalCacheData 的 NSURLRequest（它应该忽略本地缓存，但如果可用，则使用远程缓存），发送的标头是：

```
获取 /仪表板 HTTP/1.1
用户代理：XBlip1.0 CFNetwork/422.15.2 Darwin/9.6.0 (i386) (iMac8%2C1)
X-Blip-Api: 0.02
接受：应用程序/json
授权：基本（...）
接受语言：en-us
接受编码：gzip，放气
连接：保持活动
主机：api.blip.pl

```

状态为 200 OK。但是，如果我使用 NSURLRequestReloadIgnoringLocalAndRemoteCacheData，顾名思义，它应该忽略本地和远程缓存，添加一个额外的标头：

```
如果无匹配：“d751713988987e9331980363e24189ce”

```

响应是 304 Not Modified。我检查了 HTTP RFC，对于“If-None-Match”，它说：

> 如果任何实体标签与该资源上的类似 GET 请求（没有 If-None-Match 标头）的响应中返回的实体的实体标签匹配，（...）那么服务器不得执行请求的方法 (...) 相反，如果请求方法是 GET 或 HEAD，服务器应该以 304（未修改）响应进行响应

所以似乎如果我使用 NSURLRequestReloadIgnoringLocalAndRemoteCacheData，而不是忽略远程缓存，Cocoa 明确告诉远程服务器它*应该*使用远程缓存，如果我使用 NSURLRequestReloadIgnoringLocalCacheData，它不会添加该行，实际上远程缓存不是用过的。

那么这里到底发生了什么？我错过了什么，还是 Cocoa 设置了错误的标题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-12-18T15:35:37.720

从文档中：

> 指定不仅应忽略本地缓存数据，而且应指示代理和其他中间体在协议允许的范围内忽略其缓存。

来自 NSURLRequest.h (10.5 SDK)

> 指定不仅应忽略本地缓存数据，而且应指示代理和其他中间体在协议允许的范围内忽略其缓存。未实现。

注意区别：**未实现**

错误报告时间...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T10:20:23.470

By adding the NSURLRequestReloadIgnoringLocalAndRemoteCacheData parameter you are instructing the local cache and any proxy servers which may handle the request between your client and the target server that they are not to return their own version of the response data. I think the key-component here is that the RemoteCache is likely to be a proxy and you are just identifying that the request should always reach the real server and not a proxied copy.

Adding the "stupidly-long-named" parameter you are inferring that your application already has a previous copy of the request and so is only interested in actually receiving data from the server if it has changed, that is why you are getting a response of "304 Not Modified" from the server.

This behaviour does seem counter-intuitive as you are explicitly instructing the client not to use its own cache, which would imply that you would want to discard anything in there and certainly not use it as a reference for any subsequent requests. I believe the advanced cache parameters are provided to allow the developer to handle their own level of caching, ie. be notified if data hasn't been updated on the server so they can avoid needless re-processing.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T10:39:22.847

Note the **"proxies and other intermediates"** part. You're only avoiding caches not residing on the original server. The original server can still return a 304.

# c# - 以编程方式打印word文档的目录...总是跳过最后一个文件

> ID：670060
> 
> 赞同：1
> 
> 时间：2009-03-21T21:48:11.790
> 
> 标签：c#, .net, printing, word-automation, page-setup

尝试以编程方式打印 Word 文档目录时遇到问题。在此示例中，我尝试仅打印带有“3_”前缀的文件。问题是文件不会打印，除非有两个带有 3_ 前缀的文件。我一直在四处寻找这个问题。我打开文件的方式有问题吗？它仅在目录中有两个文件时才有效，在这种情况下，它只会打印出两个文件中的一个。

编辑：我确实尝试了一个消息框，路径是正确的。文件名是正确的。另外，如果我正在查看打印机文件夹中的打印机，则文档会闪烁一秒钟然后消失（我已暂停打印，以便可以看到输出）。如果 word 给我一个错误，为什么它不显示？如果目录中有两个带有 3_ 前缀的文件，为什么这会起作用？

编辑：我认为这是 printout() 方法的问题。当我将应用程序设置为可见并运行它时，文档可以正常打开，但没有打印任何内容。我可以手动打开文档并打印（效果很好）。

编辑：谢谢大家的回答。printout() 方法中的背景参数是问题所在。该程序将在打印完全假脱机之前退出（这就是为什么我会在打印队列中看到文档闪烁并消失的原因。关闭后台打印需要文档保持打开和打印，这是关键。谢谢

```
string[] filesToCheck = Directory.GetFiles(clientDirectoryPath);
    Object filename = null;
        for (int i = 0; i < filesToCheck.Count();i++ )
        {
            if(filesToCheck[i].Contains("3_"))
            {
                filename = filesToCheck[i];
                wrdDoc = wrdApp.Documents.Open(ref filename, ref oMissing, ref oTrue, ref oFalse,
                                               ref oMissing, ref oMissing,
                                               ref oMissing, ref oMissing, ref oMissing, ref oMissing,
                                               ref oMissing,
                                               ref oMissing, ref oMissing, ref oMissing, ref oMissing,
                                               ref oMissing);
                wrdDoc.PageSetup.FirstPageTray = letterHeadTray;
                wrdDoc.PageSetup.OtherPagesTray = defaultTray;
                wrdDoc.PrintOut(ref oMissing, ref oMissing, ref oMissing, ref oMissing, ref oMissing,
                                ref oMissing, ref oMissing, ref oMissing, ref oMissing, ref oMissing,
                                ref oMissing, ref oMissing, ref oMissing, ref oMissing, ref oMissing,
                                ref oMissing, ref oMissing, ref oMissing);
                wrdDoc.Close(ref oFalse, ref oMissing, ref oMissing);
                wrdDoc = null;
            }
        } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T22:54:33.690

[尝试将PrintOut](http://msdn.microsoft.com/en-us/library/bb237242.aspx) () 调用的 Background 参数（第一个参数）设置为 False。

由于 Word COM 对象释放得太早，可能最后一个打印作业没有完全假脱机和取消。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T22:03:20.477

尝试使用

```
string[] files = Directory.GetFiles(dir, "3_*.doc");
foreach(string file in files) { } 
```

代替

```
for (int i = 0; i < filesToCheck.Count(); i++ ) { } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T21:53:33.620

您发布的算法似乎没有任何问题。你可以试试以下

1.  添加断点并确保 filesToCheck 对象中包含所有文件名？这个值可能是不正确的并且抛出你的算法
2.  而不是打印文档，而是更改代码以为每个文件名抛出一个消息框。这将消除实际打印成为问题的一部分（不知道它是怎么回事）。

另外，您能否发布获取 filesToCheck 对象的代码？

**编辑**

OP提到所有文件肯定都通过了。尝试将打印操作包装在 try/catch 块中，并查看是否有任何异常被抛出以阻止文件被打印。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T22:46:01.323

尽量不要在文件名中使用“_”。我以前见过一些奇怪的怪癖，那个充电器和 PrintOut。

# c# - 无论顺序如何，获取字符串列表的哈希

> ID：670063
> 
> 赞同：65
> 
> 时间：2009-03-21T21:48:58.823
> 
> 标签：c#, .net, vb.net, string, hash

我想编写一个函数`GetHashCodeOfList()`，它返回字符串列表的哈希码，而不管顺序如何。给定 2 个具有相同字符串的列表应该返回相同的哈希码。

```
ArrayList list1 = new ArrayList()    
list1.Add("String1");
list1.Add("String2");
list1.Add("String3");    

ArrayList list2 = new ArrayList()    
list2.Add("String3");    
list2.Add("String2"); 
list2.Add("String1");

GetHashCodeOfList(list1) = GetHashCodeOfList(list2) //this should be equal. 
```

我有几个想法：

1.  我可以先对列表进行排序，然后将排序后的列表组合成 1 个长字符串，然后调用`GetHashCode()`. 然而，排序是一个缓慢的操作。

2.  我可以获取列表中每个单独字符串的哈希值（通过调用`string.GetHashCode()`），然后将所有哈希值相乘并调用 Mod `UInt32.MaxValue`。例如：`"String1".GetHashCode() * "String2".GetHashCode * … MOD UInt32.MaxValue`。但这会导致数字溢出。

有人有想法吗？

在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-03-21T21:52:17.117

这里有各种不同的方法，分为两大类，就有效性和性能而言，每种方法通常都有自己的优点和缺点。对于任何应用程序，最好选择最简单的算法，并且在任何情况下都只在必要时使用更复杂的变体。

请注意，这些示例使用`EqualityComparer<T>.Default`，因为它将干净地处理空元素。如果需要，您可以为 null 做得比零更好。如果 T 被限制为 struct 它也是不必要的。如果需要，您可以将`EqualityComparer<T>.Default`查找提升到函数之外。

## 交换操作

如果您对[可交换](http://en.wikipedia.org/wiki/Commutativity)的单个条目的哈希码使用操作，那么无论顺序如何，这都会导致相同的最终结果。

数字有几个明显的选择：

### 异或

```
public static int GetOrderIndependentHashCode<T>(IEnumerable<T> source)
{
    int hash = 0;
    foreach (T element in source)
    {
        hash = hash ^ EqualityComparer<T>.Default.GetHashCode(element);
    }
    return hash;
} 
```

一个缺点是 { "x", "x" } 的哈希值与 { "y", "y" } 的哈希值相同。如果这对您的情况来说不是问题，那么它可能是最简单的解决方案。

### 添加

```
public static int GetOrderIndependentHashCode<T>(IEnumerable<T> source)
{
    int hash = 0;
    foreach (T element in source)
    {
        hash = unchecked (hash + 
            EqualityComparer<T>.Default.GetHashCode(element));
    }
    return hash;
} 
```

溢出在这里很好，因此有明确的`unchecked`上下文。

仍然有一些令人讨厌的情况（例如 {1, -1} 和 {2, -2}，但它更有可能没问题，特别是对于字符串。对于可能包含此类整数的列表，您总是可以实现自定义散列函数（可能是将特定值的重复索引作为参数并相应地返回唯一散列码的函数）。

这是一个以相当有效的方式解决上述问题的算法示例。它还具有大大增加生成的哈希码分布的好处（请参阅最后链接的文章以获得一些解释）。对该算法究竟如何产生“更好”的哈希码进行数学/统计分析将是相当先进的，但是在大范围的输入值上对其进行测试并绘制结果应该可以很好地验证它。

```
public static int GetOrderIndependentHashCode<T>(IEnumerable<T> source)
{
    int hash = 0;
    int curHash;
    int bitOffset = 0;
    // Stores number of occurences so far of each value.
    var valueCounts = new Dictionary<T, int>();

    foreach (T element in source)
    {
        curHash = EqualityComparer<T>.Default.GetHashCode(element);
        if (valueCounts.TryGetValue(element, out bitOffset))
            valueCounts[element] = bitOffset + 1;
        else
            valueCounts.Add(element, bitOffset);

        // The current hash code is shifted (with wrapping) one bit
        // further left on each successive recurrence of a certain
        // value to widen the distribution.
        // 37 is an arbitrary low prime number that helps the
        // algorithm to smooth out the distribution.
        hash = unchecked(hash + ((curHash << bitOffset) |
            (curHash >> (32 - bitOffset))) * 37);
    }

    return hash;
} 
```

### 乘法

与加法相比，这几乎没有什么好处：小数字以及正数和负数的混合它们可能会导致哈希位的更好分布。作为抵消这个“1”的负数成为一个无用的条目，没有任何贡献，任何零元素都会导致零。您可以使用特殊情况零来避免这个重大缺陷。

```
public static int GetOrderIndependentHashCode<T>(IEnumerable<T> source)
{
    int hash = 17;
    foreach (T element in source)
    {
        int h = EqualityComparer<T>.Default.GetHashCode(element);
        if (h != 0)
            hash = unchecked (hash * h);
    }
    return hash;
} 
```

## 先下单

另一种核心方法是先强制执行一些排序，然后使用您喜欢的任何哈希组合函数。排序本身是无关紧要的，只要它是一致的。

```
public static int GetOrderIndependentHashCode<T>(IEnumerable<T> source)
{
    int hash = 0;
    foreach (T element in source.OrderBy(x => x, Comparer<T>.Default))
    {
        // f is any function/code you like returning int
        hash = f(hash, element);
    }
    return hash;
} 
```

这有一些显着的好处，因为可能的组合操作`f`可以具有明显更好的散列属性（例如位分布），但这会带来显着更高的成本。排序是`O(n log n)`并且所需的集合副本是内存分配，鉴于希望避免修改原始文件，您无法避免。`GetHashCode`实现通常应该完全避免分配。一个可能的实现`f`类似于加法部分下最后一个示例中给出的实现（例如，任何恒定数量的左移位移后跟一个素数相乘 - 您甚至可以在每次迭代中使用连续素数，无需额外成本，因为它们只需要生成一次）。

也就是说，如果您正在处理可以计算和缓存哈希并在多次调用`GetHashCode`此方法时分摊成本的情况，则可能会产生更好的行为。此外，后一种方法更加灵活，因为它可以避免在`GetHashCode`知道元素类型的情况下使用元素，而是对它们使用按字节操作来产生更好的散列分布。这种方法可能仅在性能被确定为重大瓶颈的情况下才有用。

最后，如果您想要对哈希码主题及其有效性进行相当全面且相当非数学的概述，那么[这些博客文章](http://blog.roblevine.co.uk/category/hash-codes/)值得一读，尤其是*实现简单的哈希算法 (pt II)*文章。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-21T23:20:19.103

对字符串列表进行排序的另一种方法是获取字符串的哈希码，然后对哈希码进行排序。（比较整数比比较字符串更便宜。）然后您可以使用算法来合并哈希码（希望）提供更好的分布。

例子：

```
GetHashCodeOfList<T>(IEnumerable<T> list) {
   List<int> codes = new List<int>();
   foreach (T item in list) {
      codes.Add(item.GetHashCode());
   }
   codes.Sort();
   int hash = 0;
   foreach (int code in codes) {
      unchecked {
         hash *= 251; // multiply by a prime number
         hash += code; // add next hash code
      }
   }
   return hash;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T13:50:03.773

```
 Dim list1 As ArrayList = New ArrayList()
    list1.Add("0")
    list1.Add("String1")
    list1.Add("String2")
    list1.Add("String3")
    list1.Add("abcdefghijklmnopqrstuvwxyz")

    Dim list2 As ArrayList = New ArrayList()
    list2.Add("0")
    list2.Add("String3")
    list2.Add("abcdefghijklmnopqrstuvwxyz")
    list2.Add("String2")
    list2.Add("String1")
    If GetHashCodeOfList(list1) = GetHashCodeOfList(list2) Then
        Stop
    Else
        Stop
    End If
    For x As Integer = list1.Count - 1 To 0 Step -1
        list1.RemoveAt(list1.Count - 1)
        list2.RemoveAt(list2.Count - 1)
        Debug.WriteLine(GetHashCodeOfList(list1).ToString)
        Debug.WriteLine(GetHashCodeOfList(list2).ToString)
        If list1.Count = 2 Then Stop
    Next

Private Function GetHashCodeOfList(ByVal aList As ArrayList) As UInt32
    Const mask As UInt16 = 32767, hashPrime As Integer = Integer.MaxValue
    Dim retval As UInt32
    Dim ch() As Char = New Char() {}
    For idx As Integer = 0 To aList.Count - 1
        ch = DirectCast(aList(idx), String).ToCharArray
        For idCH As Integer = 0 To ch.Length - 1
            retval = (retval And mask) + (Convert.ToUInt16(ch(idCH)) And mask)
        Next
    Next
    If retval > 0 Then retval = Convert.ToUInt32(hashPrime \ retval) 'Else ????
    Return retval
End Function 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-19T20:39:58.510

代码少了很多，但性能可能不如其他答案：

```
public static int GetOrderIndependentHashCode<T>(this IEnumerable<T> source)    
    => source == null ? 0 : HashSet<T>.CreateSetComparer().GetHashCode(new HashSet<T>(source)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-04-18T17:50:24.957

这是一种混合方法。它结合了三种交换操作（异或、加法和乘法），将每一种操作应用于 32 位数字的不同范围。每个操作的位范围是可调的。

```
public static int GetOrderIndependentHashCode<T>(IEnumerable<T> source)
{
    var comparer = EqualityComparer<T>.Default;
    const int XOR_BITS = 10;
    const int ADD_BITS = 11;
    const int MUL_BITS = 11;
    Debug.Assert(XOR_BITS + ADD_BITS + MUL_BITS == 32);
    int xor_total = 0;
    int add_total = 0;
    int mul_total = 17;
    unchecked
    {
        foreach (T element in source)
        {
            var hashcode = comparer.GetHashCode(element);
            int xor_part = hashcode >> (32 - XOR_BITS);
            int add_part = hashcode << XOR_BITS >> (32 - ADD_BITS);
            int mul_part = hashcode << (32 - MUL_BITS) >> (32 - MUL_BITS);
            xor_total = xor_total ^ xor_part;
            add_total = add_total + add_part;
            if (mul_part != 0) mul_total = mul_total * mul_part;
        }
        xor_total = xor_total % (1 << XOR_BITS); // Compact
        add_total = add_total % (1 << ADD_BITS); // Compact
        mul_total = mul_total - 17; // Subtract initial value
        mul_total = mul_total % (1 << MUL_BITS); // Compact
        int result = (xor_total << (32 - XOR_BITS)) + (add_total << XOR_BITS) + mul_total;
        return result;
    }
} 
```

性能几乎与简单的 XOR 方法相同，因为对`GetHashCode`每个元素的调用支配了 CPU 需求。

# visual-studio - msdev 2005 中的“汽车”视图在哪里？

> ID：670079
> 
> 赞同：0
> 
> 时间：2009-03-21T22:00:09.640
> 
> 标签：visual-studio, visual-studio-2005, debugging, visual-studio-2003

在 msdev 2003 中调试时，有一个非常方便的“自动”窗口，它显示当前执行行周围的变量和值。

我在 msdev 2005 中找不到类似的东西。它死了吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T22:01:23.053

假设您指的是 Visual Studio 2005，它可以在主菜单上的 Debug -> Windows -> Autos 中找到。

这可以通过按`Ctrl`+ `Alt`+或+ `V`、+如果您使用 C #键绑定（更容易按）来访问。`A` `-``-``Ctrl``D``Ctrl``A`

此外，Autos 工具窗口仅在调试时可见。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T22:01:38.280

调试 -> 窗口 -> 自动

它可能只显示其他一些小部件组的一部分。四处寻找一个小标签，上面写着“汽车”。通常它潜伏在 Watch 1 和 Locals 中。

您也可以按 CTRL+ALT+V、A。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T22:15:49.180

VS 倾向于丢失窗口，有时会重置菜单映射以使实际有用的命令数量最少。每当发生这种情况时，您都可以通过工具|自定义 -> 命令将它们挖掘回来。查看不同的类别，例如 Autos 在 Debug 中。从这里您可以将命令拖到菜单或工具栏上。

在“自定义”窗口中，还有“显示快捷方式”复选框。

# python - 在 python 中使用 storbinary 部分上传

> ID：670084
> 
> 赞同：1
> 
> 时间：2009-03-21T22:02:27.450
> 
> 标签：python, ftp, ftplib

我已经编写了一些 python 代码来使用下载图像

```
urllib.urlopen().read() 
```

然后使用上传到 FTP 站点

```
ftplib.FTP().storbinary() 
```

但我有一个问题。有时图像文件只是部分上传，所以我得到的图像底部 20% 左右被截断。我检查了本地下载的版本，并且已经成功下载了整个镜像，这让我相信这是 storbinary 的问题。我相信我正在正确打开和关闭所有文件。有没有人知道为什么我要使用 storbinary 进行部分上传？

**更新：** 当我在 Python shell 中运行命令时，上传成功完成，我不知道为什么它与作为脚本运行时不同......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T04:52:53.360

事实证明我没有正确关闭下载的文件。让我们都假装这从未发生过。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-03T23:47:05.230

自从我查看这段代码以来已经有一段时间了，但我记得关键是我没有正确关闭下载的文件。不过我有工作代码，所以以防万一是上传问题而不是下载问题，这里有两个片段：

这是下载图像的工作代码：

```
socket = urllib.urlopen(TheURL)
FileContents = socket.read()
LocalFilename = LocalDir + FilenameOnly
LocalFile = open(LocalDir + FilenameOnly, 'wb')
LocalFile.write(FileContents)
LocalFile.close() 
```

`TheURL`我要下载的文件的 URL 在哪里，`FilenameOnly`只是路径的文件名部分，并且`LocalDir`是本地目标。**我相信我的问题是我没有打电话`LocalFile.close()`。**

这是上传图像的工作代码：

```
FTPServer = ftplib.FTP(FTPServer, FTPUsername, FTPPassword)
UploadFile = open(Filename, "rb")
FTPServer.cwd(FTPSubDirectory)

UploadFile.close()
FTPServer.quit() 
```

**问题也可能是我没有打电话`FTPServer.quit()`**

如果有人对此代码有任何疑问，我会很乐意在评论中回复；让任何 Google 员工悬而未决，我感到非常难过！

# jquery - Django 中的游戏

> ID：670087
> 
> 赞同：1
> 
> 时间：2009-03-21T22:04:13.907
> 
> 标签：jquery, django

我的一般网站在 Django 中。我想创建一个子页面，其中发生以下游戏：从数据库加载的单词显示 100 毫秒。之后用户必须写出单词并被告知他的答案是对还是错。这个游戏会重复十次，而用户是页面的一员，我想在我的数据库中存储用户正确的答案。

解决这个问题的最佳方法是什么？Ajax 还是我应该使用 flash？我应该付出多少努力来编写这样的程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T04:21:31.243

我会使用 jQuery 来构建它。应该一点都不难。

# objective-c - 使用 [NSStringObject UTF8String] 时出现奇怪的泄漏

> ID：670091
> 
> 赞同：1
> 
> 时间：2009-03-21T22:06:06.117
> 
> 标签：objective-c

我有这个功能：

```
-(void) debugPrint
{
    printf("name: %s", [_name UTF8String]);
} 
```

这会导致运行时错误：

[会话开始于 2009-03-21 15:02:26 -0700。] 2009-03-21 15:02:26.319 TGui[20063:10b] *** _NSAutoreleaseNoPool(): NSCFData 类的对象 0x10a290 自动释放，没有池到位 - 只是泄漏堆栈：（0x9234c73f 0x92258e32 0x9226d505 0x9226d0e1 0x2406 0x22ce 0x20be）名称：名称

奇怪的是，当我执行 [_name cString] 时，它工作正常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T22:24:42.063

您调用该方法的线程没有`NSAutoreleasePool`，因此自动释放的对象没有池。您必须为每个线程设置一个`NSAutoreleasePool`。文档的介绍[`NSAutoreleasePool`](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSAutoreleasePool_Class/Reference/Reference.html)更详细地解释了这个想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T22:08:49.277

哎呀——在调用“return NSApplicationMain(argc, (const char **) argv);”之前，我将所有内容都放在 main() 中的 debugPrint 中。这引起了问题。

# vba - Outlook VBA - 如何访问日历上当前选择的时间范围？

> ID：670092
> 
> 赞同：3
> 
> 时间：2009-03-21T22:08:42.273
> 
> 标签：vba, outlook

我正在尝试在 Outlook 中编写一个 VBA 宏，它允许我显示自定义 UI 以输入有关 Outlook 约会的信息。我为现有约会工作，但我希望能够通过让用户单击并拖动以选择时间范围然后触发宏来创建新约会。（这适用于 Outlook 中内置的新约会命令。）我想知道如何以编程方式获取所选时间范围，以便在通过宏创建新约会时使用它。

有谁知道如何从 VBA 访问这些信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T20:41:05.860

找到此链接：[使用用户的时间选择创建自定义约会](http://www.outlookcode.com/codedetail.aspx?id=616)

通过：[如何使日历选择形成（VBA）？](http://help.lockergnome.com/office/calendar-selection-form--ftopict979251.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-11-29T13:28:16.300

更好的方法是使用`SelectedStartTime`和`SelectedEndTime` [https://msdn.microsoft.com/en-us/library/office/ff869571.aspx](https://msdn.microsoft.com/en-us/library/office/ff869571.aspx)

```
Public Sub GetNewAppt() 
    Dim exp As Explorer: Set exp = Outlook.ActiveExplorer
    Dim mfCalFolder As MAPIFolder
    Set mfCalFolder = exp.CurrentFolder
    Dim vw As View: Set vw = exp.CurrentView
    If vw.ViewType = olCalendarView Then
        With vw
            Dim objAppt As AppointmentItem
            Set objAppt = mfCalFolder.Items.Add
            objAppt.Start = .SelectedStartTime
            objAppt.End = .SelectedEndTime
            objAppt.Display
        End With
    End If
End Sub 
```

我使用功能区上的自定义按钮触发此操作。没有在 2007 年或更早的时候测试过这个。

# ruby - 为什么没有赋值运算符允许我在没有编译器警告的情况下修改 Ruby 常量？

> ID：670094
> 
> 赞同：4
> 
> 时间：2009-03-21T22:10:00.177
> 
> 标签：ruby, constants, concatenation, warnings

在下面的两个示例中，我做同样的事情，创建一个常量 String 并使用 concat 方法对其进行修改。因为它是一个常量，所以我期望一个编译器警告，但是当我使用赋值运算符时，在第二个示例中只收到一个警告。为什么是这样？

```
X = "hello"
X.concat(" world")
puts X # no warning

X = "hello"
X = X.concat(" world")
puts X # warning: already initialized 
```

由于 concat 方法修改了字符串，这通常是我会做的，因为不需要使用赋值运算符。那么，为什么赋值运算符的存在会导致编译器将这两个操作识别为不同的呢？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-21T22:18:34.370

在 Ruby 中，变量本质上是指向包含对象的内存中某个位置的指针，而不是对象本身。在第二个示例中，您在`X`第一行（`X = "hello"`

常量的不变性并不意味着你不能改变对象——它只是意味着你不能改变常量来指向*另一个*对象。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-21T22:19:46.113

这是因为您正在重新定义一个新的 X。当您重新定义一个常量时，它会给您“已经初始化”错误。第一个示例没有给出此错误，因为您不是在重新定义 X，而是在修改它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-21T22:52:37.173

如果你想让你的字符串“真实”不变，请尝试“冻结”：

```
X = "foo".freeze        # => "foo" 
X.concat("bar")

TypeError: can't modify frozen string
    from (irb):2:in `concat'
    from (irb):2 
```

我真的鼓励您阅读[The Ruby Programming Language](https://rads.stackoverflow.com/amzn/click/com/0596516177)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T22:26:24.460

这是因为常量`X`存储了对`String`对象的引用。在您的第一个示例中，您正在修改`String`对象的内部状态，而不是常量存储的引用。在第二个示例中，您将常量存储的引用更改为`String`从方法返回的新对象`concat`。

PickAxe 书[在这里](http://www.ruby-doc.org/docs/ProgrammingRuby/html/language.html#S4)解释了这一点。

# .net - 有人知道 IronRuby 使用的真实例子吗

> ID：670095
> 
> 赞同：2
> 
> 时间：2009-03-21T22:11:01.987
> 
> 标签：.net, ruby, ironruby

尽管我不是 .NET 开发人员，但我总是对 DLR 团队在 Microsoft 所做的工作感到兴奋。我观看了来自各种 Ruby 会议的几个视频，John Lam 展示了 IronRuby 和动态语言运行时的总体进展。我看到的最新视频来自 Ruby conf：[http ://rubyconf2008.confreaks.com/ironruby.html](http://rubyconf2008.confreaks.com/ironruby.html)

尽管它与标准的 Ruby 1.8 实现不完全兼容，但它看起来相当不错，并且 .NET 集成令人印象深刻。我想知道是否有人在一些现实生活中的项目中使用过它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T22:20:12.213

IronRuby 用于[mysipswitch](http://www.mysipswitch.com) SIP 服务器中的拨号方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-07T21:53:13.893

我正在使用它来测试 BBC 记者使用的主要基于 WPF 的应用程序......（ironruby/cucumber/bewildr 组合）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-19T02:34:57.150

我在新的[AppMakerX](http://www.appmakerx.com/)代码生成器中使用它，该代码生成器目前在 2010 年商业发布之前的一个主要咨询项目中进行改进。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T04:35:57.257

在这个阶段可能很难找到一个真实世界的例子，因为我认为它还没有达到生产就绪版本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-24T20:07:41.713

有些人已经在现实世界的应用程序中使用它。我在我的书里附上了一堆样本。例如，在我的 github 帐户中，您可以找到 ironruby 的 mocker，以及 ironruby mvc 实现。我的帐户是 github 上的随便吉姆，在 thbar 的 github 帐户中，您会发现更多 ironruby 和 .net 的东西

# c++ - C++ 函数：& 与星号

> ID：670101
> 
> 赞同：46
> 
> 时间：2009-03-21T22:15:47.123
> 
> 标签：c++, function, pointers

假设您有一个修改变量的函数。

你应该这样写：`void myfunc(int *a)`还是这样`void myfunc(int &a)`？

前者强制你调用函数，`myfunc(&b)`所以调用者知道它`b`会被修改，但后者更短，可以简单地调用`myfunc(b)`。那么哪个更好用呢？还有什么我想念的吗？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-21T22:44:46.553

指针（即'*'）应该用在传递“NULL”有意义的地方。例如，您可以使用 NULL 来表示需要创建特定对象，或者不需要执行特定操作。或者，如果需要从非 C++ 代码调用它。（例如，用于共享库）

例如。libc 函数`time_t time (time_t *result);`

如果`result`不为 NULL，则存储当前时间。但如果`result`为 NULL，则不采取任何措施。

如果您正在编写的函数不需要使用 NULL 作为有意义的值，那么使用引用（即“&”）可能不会那么混乱 - 假设这是您的项目使用的约定。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-21T22:17:38.490

只要有可能，我就会在指针上使用引用。这样做的原因是，搞砸引用比搞砸指针要困难得多。人们总是可以将 NULL 传递给指针值，但不存在与引用等价的东西。

唯一真正的缺点是 C++ 中的参考参数缺少调用站点文档。有些人认为这会使代码更难理解（我在一定程度上同意）。我通常在我的代码中定义以下内容并将其用于虚假呼叫站点文档

```
#define byref
...
someFunc(byref x); 
```

这当然不会强制执行呼叫站点文档。它只是提供了一种非常蹩脚的记录方式。我对强制调用站点文档的模板进行了一些实验。不过，这比实际的生产代码更有趣。

[http://blogs.msdn.com/jaredpar/archive/2008/04/03/reference-values-in-c.aspx](http://blogs.msdn.com/jaredpar/archive/2008/04/03/reference-values-in-c.aspx)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-21T22:42:05.703

我想我会不同意@bb 和@JaredPar，我倾向于栅栏的另一边。经过多年尝试支持其他人的 C++ 代码，我经常发现隐藏在引用参数的非明显副作用中的问题。使用 C#，很明显，因为您必须使用 'ref'/'out' 作为参数类型的前缀，但引用在 C++ 中可能会造成混淆。所以，我喜欢指针，因为很明显有些东西正在恢复。如果您不喜欢积分，C++ 不适合您。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-21T22:46:29.793

由于此处和其他地方引用的原因，我从围栏的指针一侧下来。但是，我会说，无论您决定什么，您都需要保持一致并将其记录在您的风格指南中。

Google C++ 风格指南[禁止](https://google.github.io/styleguide/cppguide.html#Reference_Arguments)非常量引用参数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T22:25:51.670

> 前者强制您使用 myfunc(&b) 调用函数，因此调用者知道 b 将被修改

有时函数可以接受 const 指针，调用者会错误地认为 b 将被修改。

我的建议 - 尽可能在任何地方使用引用（当然在需要的地方）。如果使用函数参数 - 我们会得到好处：
- 引用不能为 NULL - 它可以帮助我们避免错误和不必要的断言或检查。
- 引用只有一个初始化点，在函数体中，你总是知道输入参数点是什么。

我是大型项目的维护者。在任何一种情况下，我都会在调用它之前查看函数定义。当然，当我查看函数定义时，我会看到按值、按引用、按 const 引用或按指针定义的参数。

但这似乎是一个圣战问题，不同的民族对此有不同的看法。例如，谷歌编码公约建议在参数中使用指针，这些指针可以更改并且只允许 const 引用：http: [//google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Reference_Arguments](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Reference_Arguments)

> 通过引用传递的所有参数都必须标记为 const。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-22T05:28:37.190

如果 NULL 没有意义，我喜欢通过引用传递，但我可以看到两者的论点。如果您对编码很小心，您可能会通过确保始终通过 const 引用传递变量来消除意外的按引用传递反对，例如：

```
myfunc( const_cast< const int& >( a ) );

// Alternatively, this approach may require additional handling 
// in the function, but it's cleaner at call point
myfunc( boost::cref( a ) ); 
```

不过，这是很多额外的代码，没有什么好处。正如 Kenny 所指出的，C# 从另一端解决了这个问题（需要通过引用进行特定传递），但这不是 C++ 的选项（例如，除非您编写函数以将引用包装器作为参数，例如 boost::参考（参数）），例如：

```
void myfunc( const boost::reference_wrapper< int >& a ) { ... } 
```

但是，修复指针问题更成问题......没有编译时方法来确保指针有效，因此您最终会遇到指针问题的运行时问题，或运行时检查，或两者兼而有之。这是指针的本质。

无论如何，这只是我的意见，因为它的价值。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-25T00:51:46.147

需要注意的是，如果您使用的是 stl 仿函数，则如果参数与容器值类型匹配会更容易。

```
void foo(Bar *);

void frobnicate(vector<Bar *> vecBars)
{
   for_each(vecBars.begin(), 
            vecBars.end(), 
            ptr_fun(&foo));
} 
```

如果 foo 采用 Bar&，上面的代码会更难

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-21T22:45:12.560

在理想情况下，它归结为参数是否是可选输出。如果他们不关心它，你想让调用者传递 NULL 吗？然后使用指针。否则参考是更好的选择。

请注意，在这两种情况下，语言都使得记录输出参数变得很麻烦。如果整个代码库都是正确的，那就更好了，然后用户可以假设任何非常量引用或指针参数都是输出。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-21T23:08:39.460

一个区别，就像之前提到的那样，是你不能传递一个空引用，但你可以传递一个空指针。

另一件事，也已经提到过，当你打电话时，`f(a,b)`如果调用者不知道这`f`可能会改变`b`

然而，还有一个相当微妙但[我仍然遇到的问题](https://stackoverflow.com/questions/648888)是引用的语义。

指针是按值传递的，但引用不是。

这意味着，如果您通过指针传递参数，则可以更改指针并使其指向其他内容。

考虑一下：

```
void f1_ptr( type * a )
{
    a = new type(); //no change to passed parameters, you're changing the pointer which was passed by value
}

void f2_ptr( type * a )
{
    *a = some_other_value; //now you're changing the value of the parameter that was passed

   //or, if type is a class or struct:

   a->some_method_that_modifies_object(); //again, changing the parameter that was passed
} 
```

但是，当通过引用传递时，您不能将引用更改为引用另一个值。参考一旦设定，就无法更改。

```
void f3_ref( type& a )
{
    a = type(); //the referred variable has also changed
}

//....

type obj = type( params );

f3_ref( obj ); //obj now changed

f1_ptr( &obj ); //obj doesn't change

f2_ptr( &obj ); //obj now changed 
```

# iphone - MPMoviePlayerController 和 UIWebView

> ID：670103
> 
> 赞同：0
> 
> 时间：2009-03-21T22:16:24.907
> 
> 标签：iphone, cocoa-touch, uiwebview, mpmovieplayercontroller

我想要一个播放本地 .mp4 文件的 UIWebView 中的链接。我知道如何加载 MPMoviePlayerControler，但不确定如何在 UIWebView 中进行设置。我有一个 UIView，里面有一个 UIWebView。如何在此设置中使用 MPMoviePlayerControler？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-23T00:23:46.043

如果我正确理解您的问题，您不是在问如何将 .mp4 加载到播放器中，而是在问如何将链接放入在 Web 视图中呈现的 HTML 中，以便在单击该链接时您的代码创建电影播放器​​运行。不支持“本地文件”语法，因此您需要做的是让您的控制器成为 Web 视图消息的委托（通过实现`<UIWebViewDelegate>`和设置 Web 视图的委托）并定义一个处理程序

webView:shouldStartLoadWithRequest:navigationType:

每次 Web 视图将要加载 URL 时都会运行此处理程序。您的实现应该简单地为所有请求返回 YES，除了一种特殊类型。

然后，您选择任意自定义 URL 方案，例如 mp4movie://path/to/the/file 并在 HTML 页面的锚点中使用该 URL。在上面的处理程序中，查找与此方案匹配的请求，解析出路径/到/the/file，启动 MPMoviePlayerController，然后返回 NO。

# c# - 什么是应该使用链接列表的真实世界示例？

> ID：670104
> 
> 赞同：26
> 
> 时间：2009-03-21T22:17:12.407
> 
> 标签：c#, java, data-structures, linked-list

另一位程序员提到，在他的职业生涯中，他们还没有找到在任何专业软件中使用链表数据结构的用例。我想不出任何好的例子。他主要是 C# 和 Java 开发人员

任何人都可以举一些例子，说明这是解决特定现实世界问题的正确数据结构吗？

**相关：** [链接列表的实际示例是什么？](https://stackoverflow.com/questions/644167/)

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-21T22:22:24.907

与静态或动态扩展数组等可比较的数据结构相比，链表提供了几个优势。

1.  LinkedLists 不需要连续的内存块，因此**可以**帮助减少内存碎片
2.  LinkedLists 支持有效地删除元素（动态数组通常会强制所有元素发生变化）。
3.  LinkedLists 支持元素的有效添加（如果特定添加超出当前容量，动态数组可能会导致重新分配 + 复制）

任何这些优点对程序非常有价值的地方（并且 LinkedList 的缺点可以忽略不计）都将是使用 LinkedList 的地方。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-21T23:14:57.340

一个真实的例子是 FIFO 队列。一个简单的基于数组的列表对此非常不利，因为您需要在一端添加并在另一端删除，其中一个操作将是 O(n) 与基于数组的列表（除非您添加额外的逻辑使用开始和结束索引），而两者都是 O(1) 使用链表而不需要额外的努力。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-03-21T23:56:43.387

侵入式链表是游戏开发的有趣野兽。例如，有一个侵入性的单链接或双链接“渲染”列表是一种常见的做法：

```
class Renderable /* 或 class Object，随便 */
{
  // ...
  可渲染 * m_pNext;
  可渲染 * m_pPrev; // 或者不是，如果是单链接的
  // ...
}

```

随着 Renderables 的出现和消失，它们可以在这个列表中注册自己——而不会导致任何内存分配。如果他们的渲染深度或优先级被改变，他们可以移除并重新插入自己，等等。

到了渲染的时候，你需要做的就是找到列表的头部并压缩，调用适当的方法！

（当然，这个主题有很多变体，有多个单独的列表等。而且你不需要有一个侵入性的列表来完成这项工作，我只是觉得侵入性的列表很有趣。）

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-22T00:22:00.220

链表（[与散列表配对](http://github.com/sambo99/media-library/blob/d659cb42a48ba3f77c68a9fa695b96f22310be4a/MediaLibrary/Caching/IndexedLinkedList.cs)）对于[LRU 缓存](https://stackoverflow.com/a/589301/17174)非常有用。

每个 Get 都需要将一个节点撞到列表的前面，这个操作对于链表来说真的很便宜。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2016-09-02T22:39:11.633

**单链表的一些例子。**

1.  Microsoft Word、Paint 等任何应用程序的撤消按钮：状态链接列表。
2.  GPS 导航：地图数据的链接列表。从起点到终点的旅行是遍历所有节点的示例。GPS 重新路由是地图数据的添加和删除操作的一个示例。

**双链表的一些例子。**

1.  浏览器的下一个和上一个按钮：一个链接的 URL 列表。
2.  图像查看器的下一个和上一个按钮：图像的链接列表
3.  Photoshop 的撤消和重做按钮，状态链接列表。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-21T22:55:35.590

堆栈和队列是链表的非常清楚的例子，但正如其他人已经提到的那样，我想添加一些其他例子：

DOM 将节点存储为链表。一个在任何语言中都完全相同的简单 javascript 示例：

```
for (var node = parent.firstChild; node != null; node = node.nextSibling) {
    // ..
} 
```

我会想象一个 java 开发人员在某个时候遇到过 XML。

树是链表的另一个很好的例子，尽管它们不是简单的一维的。做过很多java开发的人可能遇到过TreeMaps和TreeSets。

整个讨论对我来说似乎有点愚蠢。链表是一种无处不在的基本数据结构。人们可能认为他/她没有遇到过它们的唯一原因是您实际上不必担心当今高级语言中数据结构的实现，但是它们当然仍然存在。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-03-21T23:02:56.027

它们一直在发生，只要对象具有指向同一类型的另一个对象的属性。在 CLR 中，异常形成一个链表，由于`InnerException`属性。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-03-21T22:26:37.987

不可*变*链表是一种非常有价值的结构，因为您可以与其他具有相同尾部的列表“共享结构”。大多数函数式语言都包含一个不可变的链表类型作为它们的基本数据结构之一，并且这些类型在所有地方都被使用。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-01-28T16:22:11.963

我为 USB 主机控制器编写了一个 BIOS 扩展（基本上是 BIOS 的设备驱动程序，用汇编语言编写）。-- 在汇编中实现像链表这样的高级看似抽象的数据结构并不像听起来那么难。-- 控制器使用主存储器中的数据包链表处理键盘和磁盘的 I/O 请求。我在另一个链表中维护了一个免费数据包池。执行 I/O 基本上包括从空闲列表的开头抓取一个空闲数据包，配置数据包，将数据包添加到设备列表中，并在 I/O 完成时将数据包重新添加到空闲池的开头。链表对于像这样在对象周围移动非常快，尤其是当对象很大时，因为对象实际上不必移动。只有它们的指针需要更新。

基于数组的队列需要：

*   使用开始/结束索引指针，速度很快，但需要固定队列的大小，以便生产者必须在消费者队列已满时等待，如果有多个生产者，则在整个数据包填满时锁定队列
*   每当您插入/删除时移动队列中的所有元素，这对于大型对象来说很慢

因此，链表是实现任意长的大对象先进先出队列的好方法。

另一件需要注意的事情是，对于小对象或从传统堆而不是自定义空闲池分配对象的地方，数组可以更快，因为如果不经常进行复制并不会那么慢，并且重复分配每次添加新元素时，链表都需要从堆中获取速度很慢。

当然，您可能希望使用一些一次性测试代码来模拟和测量您的特定场景以找到答案。我喜欢用链表和数组、大小对象运行几百万次循环，并计算每个循环需要多长时间。有时你会感到惊讶。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-22T20:30:01.113

作为 .Net 中最好的现实世界示例，请考虑[MultiCastDelegate](http://msdn.microsoft.com/en-us/magazine/cc188792.aspx)。

以这种方式实现的链接列表，其中列表链接方面直接支持到类型而不是作为单独的容器，可以非常强大和高效。然而，它们伴随着各种权衡。
一个明显的问题是代码重复，您必须在每种类型中烘焙此逻辑。诸如扩展提供指针的基类之类的技术很混乱（如果没有泛型，您将失去强类型），并且从性能的角度来看通常是不可接受的。
另一个是您仅限于每种类型的一个实现。如果不在每个实例中插入一个额外的字段并更新所有相关代码，就无法将单链接结构变成双链接结构。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-21T23:55:21.487

如前所述，当您需要插入和删除元素时，链表非常有用。

例如，为了帮助在我的代码中调试内存管理，我最近在我的所有引用计数对象之间实现了一个链接列表，以便在程序结束时（当引用应该全部达到零并删除对象时）我可以确切地看到是什么仍然存在，通常导致我能够找到问题根源的单个对象。

CPython 实现了类似的东西，它几乎在每一个构建时都带有一个庞大的链表，并带有调试功能。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-22T07:52:14.350

响应标签“数据结构”，在汇编等低级别，链表是存储其他数据结构的可变长度列表的理想方式。维护列表长度或结尾没有开销，也不需要固定大小的列表项。最后一个原因也适用于高级语言。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-03-12T08:54:09.787

链表是[Dancing Links](http://en.wikipedia.org/wiki/Dancing_Links)的基本数据结构，它是用于有效实现[算法 X](http://en.wikipedia.org/wiki/Algorithm_X)的技术，它是一种回溯算法，用于找到 NP 完全[精确覆盖](http://en.wikipedia.org/wiki/Exact_cover)问题的所有解决方案，许多难题自然可以简化为。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-21T22:24:36.040

正如 daustin777 指出的那样，链表就在你身边，你甚至可能都不知道。但问题的实用性在于它们允许以相对容易和灵活的方式执行一些非常基本的操作。例如，不排序，只是交换指针。需要在任意位置插入或移除？在列表中插入或删除您的指针。需要向前和向后迭代...链表。虽然不完全是一个商业示例，但我希望这足以澄清它，以便您将其应用到您自己的真实世界商业案例中。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-06-25T05:02:16.623

如果我可以以与其他人略有不同的方式回答这个问题，那么最近我一直在使用链接列表来组织音乐列表。这些列表提供了一种按艺术家、歌曲、专辑甚至收视率或歌曲长度存储和排序音乐的绝佳方式。我的是一个双向链表，但我可以看到它也适用于单链表。购物清单也很合适，如果你像我妈妈一样有强迫症，你可以很容易地把它整理成过道和最后的冷冻食品！

如果我们包括堆栈和队列，那么队列显然是打印队列或音乐播放列表（显然任何意义上的列表都很好）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-21T22:21:05.270

堆栈和队列是链表的示例。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-21T22:21:59.010

对于最大节点数限制在 100 或以下的问题，链表是一个合理的解决方案。冒泡排序和其他被认为是次优的事情也是如此。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2009-03-21T22:47:33.910

链表优点：

*   动态存储消除碎片
*   快速插入/移除
*   快速访问第一个元素（如果双向实现则结束）
*   有效的内存使用

链表缺点：

*   慢速穿越

在我的脑海中，我会使用链表来实现堆栈、队列和消息泵。我还将使用多引用链接列表实现数据树，以实现快速插入/删除。

# sql - 带有状态的连续 SQL 语句

> ID：670107
> 
> 赞同：0
> 
> 时间：2009-03-21T22:19:19.407
> 
> 标签：sql, database, variables, state

我正在编写一个简单的消息传递程序，其中有一个消息表，用户可以声明该表并由该用户对他们进行处理。没有预定哪个用户将声明给定消息，因此我想要一个查询来选择我拥有的所有可用消息中的第一个，然后再将该消息标记为接受，这也是我拥有的。问题是，我不希望两个用户同时使用它来声明相同的消息，所以我想连续运行这两个语句，而不必返回程序来找出接下来要运行的内容语句之间。我相信我可以通过用分号分隔它们来运行两个连续的语句，但我想将第一个查询中返回的数据用作第二个查询的一部分。变量将是完美的，但据我所知，它们在 SQL 中不存在。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T22:31:41.483

这就是 BEGIN TRAN 和 COMMIT TRAN 的用途。将要保护的语句放在事务中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T22:29:54.797

> 有什么方法可以保留查询之间的状态吗？

不，SQL 不是过程语言。您可以将两个查询重写为单个查询（并非总是可能，即使可能，通常也不值得），或者使用过程语言将它们粘合在一起。许多 SQL 服务器为此提供了一种内置语言（“存储过程”），或者您可以在应用程序中执行此操作。

> 问题是，我不希望两个用户同时使用它来声明相同的消息

使用锁。我不知道您使用的是什么 SQL 服务器，但`SELECT ... FOR UPDATE`如果它可用的话，听起来就像您想要的那样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T22:46:56.797

正如 le dorfier 所说，交易是一个不错的选择，但也有替代方案：

您可以先进行更新，即使用用户 ID 或类似名称标记消息。您没有提到您使用的是哪种 sql 风格，但在 mysql 中，我认为它看起来像这样：

```
UPDATE message
SET    user_id = ...
WHERE  user_id = 0   -- Ensures no two users gets the same message
LIMIT 1 
```

在 ms sql 中，它类似于以下内容：

```
WITH q AS (
  SELECT TOP 1
  FROM message m
  WHERE user_id = 0
) 
UPDATE q
SET    user_id = 1 
```

/乙

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T22:50:13.623

您也许可以使用临时表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T23:18:34.773

SQL 本身没有变量，但（几乎？）所有 RDBMS SQL 扩展都有。但是，我不确定仅凭这一点如何解决您的问题。

如前所述，事务将起到作用 - 有效地将您的 2 个不相关的语句组合在一起。*但是*，默认事务级别将*不起作用*。（大多数？）RDBMS 服务器的默认事务级别是 READ COMMITTED。这不会阻止用户 2 读取用户 1 读取的同一行。为此，您需要使用 REPEATABLE READ 或 SERIALIZABLE。

这是一个经典的并发问题。通常，处理它的两种方法是悲观锁定或乐观检查。REPEATABLE READ 事务将是悲观的（无论是否需要都会产生锁定费用），而检查@@ROWCOUNT 是乐观的（假设它会工作，但在@@ROWCOUNT = 0 时做一些明智的事情）。

通常，我们使用乐观（锁定是昂贵的），并且使用时间戳或读取的字段组合来确保我们正在更改我们认为的数据。因此，我的建议是包含一个 rowversion 或 timestamp 字段，并将其传递回您的 UPDATE 语句。然后，检查@@ROWCOUNT 以查看您是否更新了任何记录。如果没有，请返回并选择另一条消息。在伪代码中：

```
int messageId, byte[] rowVersion = DB.Select(
  "SELECT TOP 1 
      MessageId, RowVersion 
   FROM Messages 
   WHERE 
      User IS NULL";

int rowsAffected = DB.Update(
   "UPDATE Messages SET 
       User = @myUserId 
    WHERE 
       MessageId = @messageId 
       AND RowVersion = @rowVersion", 
    myUserId, messageId, rowVersion
);
if (rowsAffected = 0) 
   throw new ConcurrencyException("The message was taken by someone else"); 
```

根据您的特定语句，您可能只需在 UPDATE 语句中重复“UserId IS NULL”WHERE 子句即可。这类似于 Brimstedt 的解决方案 - 但*您仍然必须检查 @@ROWCOUNT*以查看行是否实际更新。

# c# - WCF 类型冲突

> ID：670113
> 
> 赞同：1
> 
> 时间：2009-03-21T22:21:34.970
> 
> 标签：c#, wcf

我对 WCF 有疑问。我想我理解问题所在，但我需要测试这种理解并询问是否有人以前见过这种情况，或者可以提出解决方法或替代方法。请耐心等待：这是一个相当大的问题，很难分解为最小的测试用例。

问题：我正在为遗留消息系统编写 C# 接口。我已经为直接接口实现了互操作程序集，并且一切正常。它的基础是我为每种消息类型都有一个类，以及一个用于传递的通用类，它与最大大小的消息占用相同的空间。

每个消息类都实现了转换运算符来转换到和转换出这个通用类，称为 QOD_Message。通用类和单个消息类都派生自无主体的最小消息类。想要发送消息的客户端 C# 应用程序只需调用接口程序集中的发送方法，该方法采用 QOD_Message，转换为通用类型以进行发送。接收者事件向接收 C# 应用程序传递一个泛型类型，该泛型类型根据与消息类型具有一对一关系的公共成员进行转换。

我已经实现了本地直接接口程序集，这一切都很好，我现在可以在 C# 测试应用程序和现有的本机遗留应用程序之间发送消息。精彩的。基本的类结构如下所示：

```
public class QOD_Message_Minimal
{
   a message header
}

public class QOD_Message : QOD_Message_Minimal
{
   generic message - defines an empty body
}

public class QOD_WcfDialout : QOD_Message_Minimal
{
   ... some irrelevant code

   // cast operators to convert to and from the abstract message class.

   public static implicit operator QOD_Message (QOD_WcfDialout m)
   {
      ... some irrelevant code
   }

   public static implicit operator QOD_WcfDialout (QOD_Message m)
   {
      ... some irrelevant code
   }
} 
```

请注意强制转换运算符。

现在问题来了。我想扩展这个接口来支持WCF，这样海外的另一群开发者可以通过WCF与我写的适配器WCF服务进行通信。这被称为 WCF_Adapter，令人钦佩地缺乏想象力。出于测试目的，WCF_Adapter 公开了一个采用字符串（拨出）的方法，并将其转换为遗留代码的消息。这也可以正常工作，对我的 WCF_Client 应用程序中的函数的调用被转换为旧消息并发送给（固定的）收件人。

所以我尝试扩展接口以添加一个可以接受 QOD_Message (Dispatch) 的入口点，希望这与直接接口的工作方式相同，即发送者将他们的消息转换为 QOD_Message，调用发送函数使用这种类型，适配器只需将接收到的通用消息传递到其本地接口程序集中以进行转发。因此，WCF 代码看起来与正常的消息传递代码非常相似。

```
[ServiceContract]
public interface IDialout
{
   [OperationContract (IsOneWay = true)]
   void Dialout (string NumberToDial);

   [OperationContract (IsOneWay = true)]
   void Dispatch (QOD_Message msg);
} 
```

所以我扩展了客户端和 WCF_adapter 服务，为 WCF 客户端生成了我的代理代码，并且......哦。客户端不会编译。

客户端应用程序似乎无法理解强制转换运算符，并引发编译错误。即使我将消息程序集与上面的代码一起作为参考，客户端代码“更喜欢”生成的代理中定义的类型并忽略原始消息类型，因此它无法“看到”转换并且不会编译。这是错误：

警告 CS0436：“blah-blah\generatedProxy.cs”中的“QOD_Messaging.QOD_Message”类型与“blah-blah\QOD_Messaging.dll”中的导入类型“QOD_Messaging.QOD_Message”冲突。使用 'blah-blah\generatedProxy.cs' 中定义的类型。

据我所知，生成的代理中定义的类是正确的，但是生成的代理类当然只定义数据成员，而不是功能。它包含两个类

```
[System.Diagnostics.DebuggerStepThroughAttribute()]
[System.CodeDom.Compiler.GeneratedCodeAttribute("System.Runtime.Serialization", "3.0.0.0")]
[System.Runtime.Serialization.DataContractAttribute(Name="QOD_Message_Minimal", Namespace="http://schemas.datacontract.org/2004/07/QOD_Messaging")]
[System.Runtime.Serialization.KnownTypeAttribute(typeof(QOD_Messaging.QOD_Message))]
public partial class QOD_Message_Minimal : object, System.Runtime.Serialization.IExtensibleDataObject
{
   whole slew of data members.
}

[System.Diagnostics.DebuggerStepThroughAttribute()]
[System.CodeDom.Compiler.GeneratedCodeAttribute("System.Runtime.Serialization", "3.0.0.0")]
[System.Runtime.Serialization.DataContractAttribute(Name="QOD_Message", Namespace="http://schemas.datacontract.org/2004/07/QOD_Messaging")]
public partial class QOD_Message : QOD_Messaging.QOD_Message_Minimal
{
   extra stuff to define the added body.
} 
```

所以.....

我可以将程序集引用排除在外，因此代码看不到强制转换并且无法编译，或者我可以保留引用并且编译器故意忽略程序集的类型定义并使用代理定义......并且无法编译.

其他 WCF 开发人员以前见过这种事情吗？还是每个人在调用 WCF 端点时都坚持简单的值参数？我是否只需要为我可能想要发送的每种消息声明一个具有唯一类参数的端点？这是维护的噩梦。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T22:29:57.197

转换运算符不是生成的 mex 的一部分，因此它们不会存在于客户端。

鉴于这里的复杂性 - 是否可以使用程序集共享？即，而不是生成（代理）类型，您可以引用类型的原始程序集吗？这在 IDE（在高级对话框中，虽然默认情况下似乎已启用，因此如果您有对带有消息类型的程序集的引用）和通过 svcutil（/r 开关）都支持此功能。然后，您在客户端拥有原始类型，包括转换。

如果您想保留代理方法，您可以为每条消息添加部分类，并在那里添加额外的转换 - 但这有明显的维护成本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T01:17:22.850

唯一可以在 Web 服务中公开的类成员是方法。属性、操作符、强制转换、索引器、委托、事件或其他任何东西都不能公开。

回想一下，以一种或另一种方式，Web 服务由一个或多个 XML 文档描述：WSDL、XML Schema、WS-Policy 等。这些文档中没有一个可以描述任何类型的任何编程语言运算符，包括强制转换运营商。

一种可以将类方法公开为 Web 服务操作符，一种可以将类公开为数据契约或故障契约，以作为 XML 模式公开，以及将消息契约公开为消息类型。没有其他可以暴露的。

# c# - Ado.net 会将值或类型传递给存储过程吗？

> ID：670132
> 
> 赞同：0
> 
> 时间：2009-03-21T22:36:09.413
> 
> 标签：c#, asp.net, sql, ado.net

" SelectCommand="SELECT EmployeeID, FirstName,LastName, Title, City FROM Employees WHERE City=@City">

A) 我假设当您没有指定参数实例“City”是哪种类型时，它会自动属于 Object 类型，这意味着以后可以为其分配任何类型的值。因此，如果“City”稍后（例如在 SqlDataSource2_Selecting() 事件处理程序中）分配了错误类型的值，则只会在 Sql server 上检测到此错误分配，而不是之前（当然 Sql server 会将该错误报告回 web服务器 ）？

B) 如果我们创建一个 NVarChar(20) 类型的 SqlParameter 实例并希望将此参数传递给存储过程，Ado.net 是否会仅将这个参数的值传递给存储过程，或者它还会以某种方式通知该过程此参数的确切类型（即 NVarChar(20)）？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T11:46:35.520

不，sql server 不会被告知存储过程调用中的参数类型。如果您传入一个参数，它会尝试将其转换为正确的类型，如果无法进行转换，则会抱怨。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T22:54:07.593

存储参数值的数据类型总是`object`。如果不指定类型，驱动程序将根据分配给它的值的数据类型来猜测数据库数据类型，因此指定您想要的类型更安全。

数据类型（NVarChar）可能会传递到数据库中，我不太确定，但长度不是。指定的长度只限制发送到数据库的数据，它不必匹配存储过程中指定的长度（但通常​​应该）。如果您使用的长度大于存储过程中指定的长度，驱动程序可能允许发送一个过长的值，存储过程无法接受。

无论数据类型是否发送到数据库，它都用于以正确的方式发送值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T11:16:03.393

参数是由 SQL Server 设置的，我可以肯定，当 ADO 实际与服务器通信时，参数指定的类型不会与数据一起传递。所以是的，完全有可能指定错误的数据类型，直到 SQL Server 返回错误时您才知道。

同样对于 B... 仅发送数据。

# wpf - 有没有办法在 WPF 中自动使画布在溢出时滚动？

> ID：670133
> 
> 赞同：2
> 
> 时间：2009-03-21T22:37:14.467
> 
> 标签：wpf, canvas, scroll

一直在检查网络和这个网站，但无法得出任何下降结果。

有没有办法让 WPF 中的画布在溢出时显示滚动条？一直在尝试滚动查看器，但无法让它工作:(

提前致谢..

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T22:43:25.730

您遇到的问题是 Canvas 与许多 WPF 面板和容器不同，它不会根据内容调整大小。这意味着如果你添加一个超出画布边界的元素，它不会更新它的大小。因此，除非您手动更新 Canvas 的大小，否则在 ScrollViewer 中嵌入 Canvas 不会有任何好处。

听起来你想要的是一个支持内容大小的画布。此博客条目具有完全的控制权。

[http://themechanicalbride.blogspot.com/2008/11/auto-sizing-canvas-for-silverlight-and.html](http://themechanicalbride.blogspot.com/2008/11/auto-sizing-canvas-for-silverlight-and.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-17T18:53:03.380

我采取了不同的方法并放弃了网格画布。Canvas 的性能更高，但至少就我的目的而言，我没有注意到有什么不同。网格可以通过执行以下操作来模仿画布的行为。

创建单行单列网格。将 Horizo​​ntalAlignment 设置为 Left 将 VerticalAlignment 设置为 Top 使用 Margin "x,y,0,0" 设置位置。

Bam..就像画布一样工作，它在 Scrollviewer 中效果很好。

# macos - 如何在 iMovie 中添加自定义共享选项？

> ID：670134
> 
> 赞同：2
> 
> 时间：2009-03-21T22:37:32.983
> 
> 标签：macos, video, content-management-system, imovie

Mac 的 OS X iMovie 具有内置的共享选项（如 YouTube、iTunes、MobileMe 等）。我目前正在开发一个面向视频的内容管理系统，**我想为我的 CMS 向 iMovie 添加“共享”功能**，即使安装过程很痛苦或“hacky”。似乎没有 API，但也许有？或者，菜单可能是经过脚本编写的并隐藏在视线范围内？或者？？？

*   iMovie '08 (7.1.4 585)
*   OS X (10.5.6)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T02:28:26.833

iMovie 捆绑包中似乎有一个名为 RADPlugins 的插件文件夹。我建议在他们身上使用[类转储](http://iphone.freecoder.org/classdump_en.html)之类的东西，看看他们在做什么。您或许可以通过这种方式将您的代码导入 iMovie。但是请注意，您将使用完全未记录的 API，因此 iMovie 的每个新版本都可能（将）破坏您的插件。

多年来，我已经为 Mac OS X Mail 应用程序制作了一个插件，并且每个版本都破坏了一些东西；）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T23:53:13.847

iMovie '08（和 iMovie '09）不允许第三方插件。我相信最后一个允许第三方插件的 iMovie 版本是 iMovie HD。

# c# - DataContractSerializer 跳过 OpenAccess 版本的值

> ID：670137
> 
> 赞同：1
> 
> 时间：2009-03-21T22:41:06.080
> 
> 标签：c#, datacontractserializer, openaccess

我正在使用 OpenAccess 断开连接模型。当我尝试使用 DataConractSerializer 反序列化对象时，该对象的 Version 属性为 0 - 但仅在 xml 中。如果我调试代码并观察值 - 它是 1（或 2,3 ...）

如果我在序列化“int temp = object.Version”之前说，seriazlier 可以保存该值。

有一个懒惰的问题，我敢肯定。如何在没有显式调用的情况下强制读取/保存此值？

代码片段：[http ://www.telerik.com/community/forums/orm/general-discussions/objectnetworkattacher-vs-datacontractserializer.aspx#775451](http://www.telerik.com/community/forums/orm/general-discussions/objectnetworkattacher-vs-datacontractserializer.aspx#775451)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T23:05:24.290

听起来好像`[DataMember]`是针对字段设置的（或默认为字段），并且绕过了惰性行为。如果您控制类型，您也许可以添加一个`[OnSerializing]`在序列化开始之前查看此属性的方法......这样它应该有一个值，并且您不需要将代码放入其他地方。

如果生成了类型，请查看它是否为`partial class`. 如果是这样，您可以添加另一个`partial class`同名（和相同的命名空间），并将您的`[OnSerializing]`方法放在那里......

示例（取消注释最后一个块以使其工作）：

```
using System;
using System.Runtime.Serialization;
using System.Xml;

class Program {
    static void Main() {
        using (XmlWriter writer = XmlWriter.Create(Console.Out)) {
            new DataContractSerializer(typeof(Foo))
                .WriteObject(writer, new Foo());
        }       
    }
}

[DataContract]
partial class Foo {
    [DataMember(Name="Bar")]
    private int? bar;
    public int Bar {
        get {
            if (bar == null) bar = 27; // somthing lazy
            return bar.GetValueOrDefault();
        }
        set { bar = value; }
    }
}
/* UNCOMMENT THIS
partial class Foo {
    [OnSerializing]
    private void BeforeSerialize(StreamingContext ctx) {
        int tmp = Bar;
    }
}
*/ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-23T17:04:28.507

您应该在对象上调用 .Retrieve() 方法，该方法将加载所有延迟加载的字段，并且您将拥有序列化所需的所有数据。希望有帮助。

# php - 如何在 centOS 上启用 locale en_EN 以使 i18n gettext 正常工作

> ID：670138
> 
> 赞同：3
> 
> 时间：2009-03-21T22:41:48.027
> 
> 标签：php, internationalization, gettext

我有我的 PHP 网站的开发版本，当我将它移动到我在 centOS 操作系统上的生产服务器时，我发现我的语言环境版本的 en_EN 不起作用。

你能告诉我是什么导致了这种情况以及如何使这项工作正常进行吗？我使用 setlocale 和 gettext 在 PHP 中使用 i18n。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-22T16:52:57.157

我不会推荐任何人在 PHP 中使用`setlocale()`和`gettext()`进行**本地化**（有一些严重的问题会让任何开发人员发疯）。但无论如何，没有 en_EN 语言环境。下划线之前的标识符是语言（en = English），下划线之后的标识符是国家（EN = ???）。您可能应该使用 en_US、en_GB 或其他东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T16:42:52.203

我不认为 en_EN 是正确的，也许你的意思是 en_US？

# silverlight - 在 Silverlight 中显示 PDF

> ID：670140
> 
> 赞同：8
> 
> 时间：2009-03-21T22:43:07.790
> 
> 标签：silverlight, pdf

我想做一个 PDF 文档阅读器，我发现唯一能帮助我的是“Amyuni PDF Suite”，它将 PDF 转换为 XAML 并流式传输。是否有任何其他控件可用于在 Silverlight 中显示 PDF？或者我可以在 Silverlight 中添加一个 IFrame 并让客户端呈现它吗？

干杯

尼克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T22:58:40.187

> 或者我可以在 Silverlight 中添加一个 IFrame 并让客户端呈现它吗？

Silverlight 并没有真正具备这种能力。您可以使 Silverlight 控件透明，并在 Silverlight 控件上方有一个 HTML div 块，然后您可以在其中加载 PDF，但至于在 Silverlight 中显示 PDF，我认为您不走运。

**编辑：** [这个问题](http://silverlight.net/forums/t/21927.aspx)有一些关于如何完成透明 Silverlight 控件的信息，希望对您有所帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T11:56:26.953

如果您可以购买 pdf 转换器，您可以执行以下操作：

```
CanvasObject.Children.Add(XamlReader.Load("xaml string from pdf converter")); 
```

并且 pdf 应该在您的 CanvasObject 中呈现。

我真的认为您将通过某种类型的 XAML 转换获得最佳结果。我想自己编写转换器不会那么难，不过我可能错了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-01T21:23:24.097

看起来一楼软件有一个解决方案，但它仍处于预览阶段。

[http://firstfloorsoftware.com/blog/pdf-for-silverlight-preview/](http://firstfloorsoftware.com/blog/pdf-for-silverlight-preview/)

我们实际上想要做的是将 PDF 转换为 SVG，然后使用类似： http: [//www.codeplex.com/XamlTune](http://www.codeplex.com/XamlTune)然后转到 Xaml

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-11T20:04:51.900

您可以使用服务器端将 PDF 转换为一组位图或如上所述的 SVG，然后通过 WCF 服务返回给 Silverlight 客户端。

# php - 如何在我的开发服务器上启用通知

> ID：670142
> 
> 赞同：5
> 
> 时间：2009-03-21T22:44:44.573
> 
> 标签：php, error-handling

我在 Apache 上有一个 PHP 的开发版本。我将其移至生产环境，并在我的网站上收到了这个奇怪的通知。我在开发版上没有。如何在我的网站开发版本上启用这些通知来修复它们？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-21T22:50:14.357

如果您可以访问您的 php.ini，那么 Björn 的答案就是您要走的路。

但是，如果您不这样做，或者如果您想更改特定的脚本/项目错误级别，请在代码开头执行此操作：

```
ini_set('display_errors', 1);

// Enable error reporting for NOTICES
error_reporting(E_NOTICE); 
```

您可以在此处查看哪些级别可用于 error_reporting：http: [//us2.php.net/manual/en/function.error-reporting.php](http://us2.php.net/manual/en/function.error-reporting.php)。

最好不要在生产环境中显示任何错误，而是记录任何奇怪的行为并通过邮件发送给管理员。NOTICES 应该只在开发环境中启用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-21T22:46:50.543

将您的 php.ini 文件，即 error_reporting 行更改为 E_ALL。

IE：

```
error_reporting = E_ALL 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T23:13:13.270

Seb 是对的，尽管您确实应该为 error_reporting() 使用常量。

```
error_reporting(E_NOTICE); 
```

您可以使用按位运算来准确选择要显示的消息。例如：

```
// notices and warnings
error_reporting(E_NOTICE | E_WARNING);

// everything except errors
error_reporting(E_ALL ^ E_ERROR); 
```

# c++ - 为什么选择 & 符号作为 C++ 中的引用符号？

> ID：670154
> 
> 赞同：5
> 
> 时间：2009-03-21T22:51:21.390
> 
> 标签：c++, c, reference, history

有谁知道为什么选择与号作为 C++ 中表示引用的方式？

AFAIK（虽然我附近没有这本书），Stroustroup 没有解释这个选择，我觉得这有点奇怪，因为相同的符号已经用于 C 中的地址。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-21T23:06:52.117

除了我普遍同意的 Earwicker 的回应。我还推测，由于 & 是“地址”运算符，它有点合适。由于在许多方面的引用就像通过**地址**而不是**值**传递。

除此之外，获取变量的地址通常被称为“引用”

（是的，我知道引用不必*在*底层使用指针来实现，我指的是它们在概念上的工作方式）。

不过，这只是猜测。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-21T22:58:27.410

Stroustrup 总是非常不愿意引入新的保留符号或名称，所以他可能使用它来避免使 C 用户觉得该功能看起来很奇怪。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T23:28:07.493

谁知道为什么 Stroustrup 会做任何事情，但我的猜测是因为引用参数的*实现*涉及传递左值的地址，所以 Stroustrup 选择了 C 的 address-of 运算符，因为它可以让 C 程序员对成本模型有正确的认识。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-22T00:10:25.600

这是我的理论。我认为这与哪些运算符对符号有效（在语法上）有很大关系。考虑

```
int a[1]; // a[1] is valid (syntactically)
int *a; // *a is valid
int a(char, bool); // a(<a char>, <a bool>) is valid (function call)
int C::*a; // <a C>.*a is valid 
```

从概念上讲，在这些声明中，以类型 ( `C`, `char`, `bool`) 命名的内容稍后会替换为该类型的表达式。当然，目的是尽可能多地重用现有语言。所以我认为他使用了`&`：

```
int &a; // &a is valid 
```

重要的是，`&`它*仅对*引用表示的表达式类型有效： For `lvalues`。引用是左值（命名变量也是），只能`&`应用它们：

```
int &g(); // &g() is valid (taking the address of the referred to integer)
int g(); // &g() is *not* valid (can't apply to temporary int) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-22T00:24:25.613

我的想法是指针中使用了 2 个符号：* 和 &。由于 int* 表示指向 int 的指针，可能 Stroustrup 不想引入一个全新的符号。由于引用有点像指针，所以他坚持使用 &。另外，& 以前唯一有效的用法是获取某物的地址，因此可以在声明中使用。

# css - 你会推荐什么 CSS 框架？

> ID：670156
> 
> 赞同：7
> 
> 时间：2009-03-21T22:53:03.337
> 
> 标签：css, frameworks

我是一名软件开发人员，而不是设计师，但我被迫设计网站。过去，我是“手工”设计的，以前从未使用过任何一种。现在，我发现有很多 CSS 框架。我想尝试其中一些，但我不知道从哪里开始，我不想浪费我的时间。

我认为最流行的 CSS 框架是：

*   [YAML CSS 框架](http://www.yaml.de/en/)
*   [YUI 网格 CSS](http://developer.yahoo.com/yui/grids/)
*   [960网格系统](http://960.gs/)

但我敢肯定还有很多。

那么，你会推荐我哪个框架？为什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-21T22:58:50.233

如果你不想浪费你的时间，我真的不会推荐任何一个。如果您对 CSS 足够熟悉，那么编写自己的而不是使用框架会更容易。使用框架，您将被迫学习和使用它们的命名约定，并且您还可能包含大量您每次都不需要的代码。如果您需要使用任何东西，我建议您在完整的 CSS 框架上使用良好的 CSS 重置规则。除此之外，花时间更深入地学习 CSS；这将是一项更好的投资，将来会获得更大的回报，因为除了能够完成工作之外，您还会知道*为什么事情会起作用。*

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-18T10:16:34.857

唯一值得使用的 CSS 框架：[Unobtrusive CSS](http://unobtrusivecss.com/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T23:17:02.153

如果您不想一遍又一遍地编写相同的东西，CSS 框架确实会很方便......这就是不要每次都重新发明轮子，而是改变已经存在的那些。:-)

[前 12 个 CSS 框架和如何理解它们](http://speckyboy.com/2008/03/28/top-12-css-frameworks-and-how-to-understand-them/)是一篇非常好的文章，我引用：

> 与世界上其他所有事物一样，CSS 框架也有一些批评者，
> 优点确实多于缺点，这都是关于意见的。

你不妨看看：[Inspiration Overload: 100 CSS Galleries You Need Check](http://www.virtualhosting.com/blog/2008/inspiration-overload-100-css-galleries-you-need-to-check-out/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T23:04:55.210

我不确定您是否会将其归类为框架，但我喜欢[jquery-ui 框架](http://jqueryui.com/docs/Theming/API)。有[ThemeRoller](http://themeroller.com)，可让您自定义 ui 或从图库中进行选择，它适用于大多数业务线风格的应用程序。更重要的是，它集成了我经常使用的大多数 jQuery UI 插件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-21T23:18:02.417

非常简单的答案：

**没有任何**

:)

为什么？因为您还需要语义 CSS，而不仅仅是语义 HTML。因此，例如，如果您有一个名为`size-1`(insdeat of... let's say `comment-form`) 的 div，这会告诉您什么？这将如何帮助您进行进一步的更改？

是的，在过去的几个月里，我尝试使用两三个框架，但完全没有运气。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-21T23:41:48.537

我也倾向于远离各种 CSS 框架。然而，我觉得有用的是想出一些你自己的基本模板来工作。

包括一个 CSS 重置，例如 Eric Meyer 的一个站点：[Reset Reloaded](http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/ "重新加载")。另一种选择（我目前使用的，因为我个人不使用 Eric 重置中包含的大多数 xhtml 标签）是 Tim Wright 的[重置浏览器默认值（reset.css）](http://www.csskarma.com/blog/reseting-browser-defaults-resetcss/ "重置浏览器默认值 (reset.css)")

然后试着想出一套你自己的排版风格，同时考虑诸如垂直节奏之类的好东西。我发现（通常）很好的资源是[The Grid System](http://www.thegridsystem.org/ "网格系统")，它有教程、文章、模板等，包括一些有用的工具来设计一个好的排版网格。

我会回避 CSS 框架，仅仅是因为它们从来都不是非常语义化的，而且大量的 div 标签真的让我很恼火。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-21T23:19:40.167

请参阅这个[关于是否使用 CSS 框架的可比较问题](https://stackoverflow.com/questions/506523/are-css-frameworks-really-worth-using)，它有一些类似（有用）的答案。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-22T15:40:09.577

以下是一些新的 CSS 框架：

*   [Emastic CSS 框架](http://code.google.com/p/emastic/)
*   [马洛 CSS](http://code.google.com/p/malo/)
*   [黄金网格](http://code.google.com/p/the-golden-grid/)

Emastic 只有 4kb（固定和流动列和基于 em），Malo 非常小，只有 8 行代码，而 Golden Grid 是 1kb，类似于 Blueprint 或 960.gs。

像这 3 个框架的作者一样，赞美我自己的工作是不恰当的，只需打开每个框架的 CSS 代码并尝试理解它。代码会跟你说话:)。

另请注意，所有 CSS 框架并不总是正确的解决方案。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-18T10:13:20.040

一个可能有帮助的简洁工具是 LessCSS：[http](http://lesscss.org/) ://lesscss.org/——它是一个 CSS 预处理器（以 Ruby gem 的形式实现），它支持变量、嵌套规则、混合等。不是框架，而是一个好的使您的 CSS 更加一致和可维护的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-18T12:52:00.830

如果您使用更复杂的语言（例如 PHP 或 ActionScript），则框架非常有用。但是对于简单的 html 和 css 来说真的不需要它，这很容易学习。而是让自己获得一个基本的重置样式表并从那里开始构建你的样式。

重置样式表集合：[perishablepress.com](http://perishablepress.com/press/2007/10/23/a-killer-collection-of-global-css-reset-styles/)

# .net - ConvertEmptyStringToNull 属性

> ID：670160
> 
> 赞同：3
> 
> 时间：2009-03-21T22:55:04.423
> 
> 标签：.net, asp.net, sql, ado.net

A) public void GetEmployee(int EmployeeID);

```
<asp:ObjectDataSource  SelectMethod=”GetEmployee” …&gt;
  <SelectParameters>
    <asp:ControlParameter Name = ”EmployeeID” ...>
  </SelectParameters> 
```

如果出于某种原因 EmployeeID 参数为 NULL，ObjectDataSource 会将 Null 转换为零并将其作为参数传递给 GetEmployee() 方法。

为什么运行时会进行这样的转换？抛出异常不是更有意义吗？

B) “使用 ConvertEmptyStringToNull 属性指定在数据源中更新数据字段时，是否将空字符串值自动转换为 null。”
我不太明白这个属性的用处。为什么空字符串表示我们希望将 null 插入到源的数据字段中？我假设这个数据字段是字符串类型的？那么为什么不也有 ConvertZeroInt32ToNull 等呢？

再见

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T23:09:27.680

A) 看起来 ODS 正在为 T 类型的 null 生成默认值。在 int 的情况下，默认值为 0。

B) HTML 中无法通过输入标签来表示空值。当将空字符串传递给 ODS 并将 Convert Empty to Null 设置为 true 时，将设置 null 值。没有 ConvertZeroToNull 属性，因为 HTML 或 Windows 表单上的所有文本框数据都是字符串类型。

# php - 如何创建友好的日期格式（例如“2 天前提交”）

> ID：670161
> 
> 赞同：16
> 
> 时间：2009-03-21T22:55:21.940
> 
> 标签：php, date, formatting

> **可能重复：**
> [我如何计算相对时间？](https://stackoverflow.com/questions/11/how-do-i-calculate-relative-time)

我想在我的社交网络应用程序上格式化日期，就像 Digg.com 和其他网站一样。在那里，您会看到非常友好的日期，例如：

*   现在
*   3 分钟前
*   一个小时之前
*   2个星期前
*   6 个月前
*   ETC

在我开始创建这样一个东西之前，有没有人知道任何现成的脚本，我只需插入一个日期戳，并根据它与当前时间的关系给出一个友好的日期文本？

PS：我在 PHP 中需要这个，但伪代码或任何其他语言也可以。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-21T22:59:11.497

这是这个[问题](https://stackoverflow.com/questions/11/how-do-i-calculate-relative-time)的副本。除了这个站点使用的代码之外，它还有一系列关于如何完成此操作的代码示例。我看了一眼，那里似乎也发布了一个 PHP 实现。

除此之外，如果你使用 jQuery，你可以使用类似[timeago](http://timeago.yarp.com/)插件的东西来做这个客户端。它的优点是随着时间的推移更新文本，所以如果你加载一个页面并显示“5 分钟前发布”并在 5 分钟后再次查看，它会显示“10 分钟前发布”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-23T09:54:06.000

感谢大家的回答，对于重复的问题，我们深表歉意。我在寻找它时没有找到重复项，因为我真的不知道要使用什么搜索词。

无论如何，由于stackoverflow使用的代码的PHP翻译，我的问题得到了解决。我在计算增量时做了一个微小的改变：

```
$delta = strtotime(gmdate("Y-m-d H:i:s", time())) - $time; 
```

由于我将日期作为 GMT 格式的时间戳存储在 MySQL 中，因此我必须使用它来计算当前时间。这可以进行时区中性比较，这正是我所需要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T23:00:30.633

您也可以在 SQL 中执行此操作：

[在 SQL 中将 DateTime 转换为“n Hours Ago”的最佳方法](https://stackoverflow.com/questions/50149/best-way-to-convert-datetime-to-n-hours-ago-in-sql)

# php - 恒定的服务器变量？

> ID：670167
> 
> 赞同：2
> 
> 时间：2009-03-21T23:00:06.377
> 
> 标签：php, variables

使用 PHP 在服务器上存储单个数字以便任何脚本都可以访问它的最简单方法是什么？目前，我有一个数字存储在一个文件中，但这似乎有点不雅。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T23:14:36.777

这里没有正确的答案，但大多数用于构建 Web 应用程序的现代 PHP 系统都有某种配置对象。这通常作为单例实现

```
//brain dead config object
class NamespaceConfiguration {
    public static function getInstance() {
        if (!self::$instance instanceof self) { 
          self::$instance = new self;
        }
        return self::$instance;
    }

    public static function set($key,$value){
        //code to set $key/$value paid
    }

    public static function get($key){
       //code to get a $value based on a $key
    }
}

$config = NamespaceConfiguration::getInstance();
$config->set('myNumber',42);
....
function somewhereElse(){
    $config   = NamespaceConfiguration::getInstance();
    $myNumber = $config->set('myNumber');
} 
```

此类在每个请求的页面上加载。这为每个开发人员提供了一个标准 API，以便在他们想要获取或设置单个配置值时调用，并允许单个开发人员控制存储位置和检索方式（可能是平面文件、XML 文件、内存缓存、 MySQL 数据库、存储在 MySQL 数据库中的 XML 文件、存储在 MySQL 数据库中的 XML 文件，其中包含指向包含值的文件的节点等）

检索的位置和方式将取决于您的应用程序环境，尽管通过使用配置对象，您可以预先创建一些效率（将已检索的值存储在属性缓存中，在实例化时预取某些值等）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T23:05:10.747

由于您的应用程序可能已经在顶部“header.php”或类似文件中有某种包含文件，您可以在该文件中创建一个常量/变量，并且所有包含标题的文件也可以访问该常量.

这可以帮助您定义常量： http: [//php.net/constant](http://php.net/constant)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-21T23:07:57.887

这取决于数字的特性。是否经常更新/修改？它是唯一的数字吗？如果没有更改，最好按照 Espo 的建议进行操作，并将其存储为 php 常量，必要时可以包含在内。如果您有其他此类数字，您可以将它们全部放入该文件中。如果它们经常更新，最好将其放入数据库中。

但。如果是单个数字，可能会发生变化，并且您认为不需要存储其他数字，为什么不使用文件？请记住在更新时使用flock() 以避免并发问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T23:02:26.357

你最好的选择是把它放在一个 MySQL 表中以便以后获取。这可能是在 PHP 中存储信息的最佳方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T23:47:31.550

如果它是一个更具环境性质的变量，您始终可以在 httpd.conf 文件中使用在 Apache 中设置这些变量，您可以设置以下内容：

```
SetEnv myVar myValue 
```

然后您可以使用 $_SERVER 来获取它

```
$_SERVER['myVar'] 
```

如果我要在几个不同的虚拟主机上设置相同的应用程序但不希望它们在配置文件中具有不同的参数，我通常会在此设置变量。

配置文件也将满足您的需求。Zend 框架中有一些易于使用的类可以帮助 [http://framework.zend.com/manual/en/zend.config.html](http://framework.zend.com/manual/en/zend.config.html) 更具体的部分[7.3](http://framework.zend.com/manual/en/zend.config.adapters.ini.html)和[7.4](http://framework.zend.com/manual/en/zend.config.adapters.xml.html)描述了如何以纯文本形式编写配置参数文件或 XML 格式。

如果您更喜欢普通的旧 php，您可以使用 parse_ini_file 函数从文本文件 [http://us.php.net/parse_ini_file读取配置参数](http://us.php.net/parse_ini_file)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-04T10:56:17.540

您还可以使用 Alternative PHP Cache 或其他缓存选项。

[http://www.php.net/manual/en/function.apc-add.php](http://www.php.net/manual/en/function.apc-add.php)

您可以将它与上面列出的其他解决方案结合使用，例如将配置保存到缓存。

# iphone - 在 UITableViewCell 中以与文本其余部分不同的颜色显示 URL

> ID：670170
> 
> 赞同：1
> 
> 时间：2009-03-21T23:02:33.670
> 
> 标签：iphone, objective-c

我正在在线学习斯坦福 iPhone 编程课程。Presence 应用程序分配拉动 Twitter 并在单独的 UITableViewCell 中显示每个。

更新通常包括 URL，我想知道如何仅以蓝色显示 URL 文本，使其可点击。我可以毫无问题地解析 URL 的文本，只是不知道如何显示 URL 本身。

任何意见或建议将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T23:50:58.360

如上所述，按钮可以工作，但就 UI 而言，如果您有标签，它可能看起来更自然。

或者，您可以使用 UIWebView 填充 UITableViewCell。UIWebView 将保存所有文本，您应该能够轻松地将部分文本设置为使用 html 的链接（蓝色）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T23:39:40.523

您必须在单元格中添加一个 UIButton（或类似的东西），按钮标题是 URL，打开实际链接的操作。

# java - 如何将生成的密钥从执行插入的 DB2 存储过程返回给 JDBC？

> ID：670177
> 
> 赞同：1
> 
> 时间：2009-03-21T23:06:42.397
> 
> 标签：java, jdbc, db2

我有一个简单的存储过程，它可以插入带有标识主键列的表。我需要获取插入生成的密钥。我更喜欢使用标准的 JDBC getGeneratedKeys 方法，但我不确定存储过程需要做什么/返回来构建该结果集。我的最终目标是从 Hibernate 做到这一点。我也尝试使用选择标识生成器，但它总是返回 0。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-14T06:51:51.553

也可以从插入中选择：

```
SELECT pkey FROM FINAL TABLE (INSERT INTO tab(a, b, c, d) VALUES ... ) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T09:16:13.993

在 DB2/400 上，它似乎是 IDENTITY_VAL_LOCAL() 函数，它返回最近分配给标识列的值。

[http://publib.boulder.ibm.com/infocenter/db2luw/v8/topic/com.ibm.db2.udb.doc/admin/r0004231.htm](http://publib.boulder.ibm.com/infocenter/db2luw/v8/topic/com.ibm.db2.udb.doc/admin/r0004231.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T16:22:47.937

我从未尝试过 identity val local() 函数；在我自己的存储过程中，我只是在插入后执行 SELECT。但是您可以让存储过程返回结果集：

```
create procedure proc1(
IN in_val
)
language sql
dynamic result sets 1

BEGIN
-- do insert

BEGIN
DECLARE c_out CURSOR WITH RETURN TO CLIENT FOR
  select max(key) as inserted_key from table where val = in_val
FOR READ ONLY;

OPEN c_out;
END;

END; 
```

您可能可以使用 identity val local 将 select 替换为“select identity val local() from sysibm.sysdummy1”。我似乎无法让下划线在降价中工作，但希望这很清楚。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-06T02:45:25.987

存储过程可以使用 identity val local 来获取生成的值并将其作为输出参数传递给 Java 程序。插入后选择不是一个好主意，因为其他进程可能已将新数据插入到表中并会导致数据完整性问题。

# perl - 延迟 Perl 中范围更改的代码

> ID：670179
> 
> 赞同：5
> 
> 时间：2009-03-21T23:07:28.027
> 
> 标签：perl, scope, tie

我经常发现能够安排代码在离开当前范围时执行很有用。在我之前在 TCL 的生活中，一位朋友创建了一个我们称为 defer 的函数。

它启用了如下代码： set fp [open "x"] defer("close $fp");

在当前范围退出时调用它。主要的好处是无论我如何/在哪里离开范围，它总是被调用。

所以我在 Perl 中实现了类似的东西，但似乎有更简单的方法。欢迎评论批评。

我在 Perl 中的做法：

*   创建一个全局绑定变量，其中包含要执行的子数组。
*   每当我想安排在退出时调用 fn 时，我都会使用 local 来更改数组。当我离开当前范围时，Perl 将全局更改为以前的值，因为全局是绑定的，我知道何时发生此值更改并且可以调用列表中的 subs。

实际代码如下。

有一个更好的方法吗？似乎这将是一个普遍需要的能力。

```
use strict;

package tiescalar;

sub TIESCALAR {
    my $class = shift;

    my $self = {};
    bless $self, $class;
    return $self;
}

sub FETCH {
    my $self = shift;
    return $self->{VAL};
}

sub STORE {
    my $self = shift;
    my $value = shift;

    if (defined($self->{VAL}) && defined($value)) {
    foreach my $s (@{$self->{VAL}}) { &$s; }
    }
    $self->{VAL} = $value;
}

1;

package main;

our $h;
tie($h, 'tiescalar');
$h = [];
printf "1\n";
printf "2\n";

sub main { 
    printf "3\n";
    local $h = [sub{printf "9\n"}];
    push(@$h, sub {printf "10\n";});
    printf "4\n";
    { 
    local $h = [sub {printf "8\n"; }];
    mysub();
    printf "7\n";
    return;
    }
}

sub mysub {
    local $h = [sub {printf "6\n"; }];
    print "5\n";
}

main();

printf "11\n"; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T00:30:47.640

我想我只是创建一个对象，而不是为此使用 tie。你也可以避免`local`这种方式。

```
{
my $defer = Scope::OnExit->new( @subs );
$defer->push( $other_sub ); # and pop, shift, etc

...
} 
```

当变量超出范围时，您有机会在 DESTROY 方法中执行操作。

此外，在您发布的示例中，您需要检查您存储的值是否是代码引用，并且检查 VAL 值是否是数组引用可能是个好主意：

```
子 TIESCALAR { 祝福 { VAL => [] }, $_[0] }

子商店{
    我的（$自我，$价值）=@_；

    carp "只能存储数组引用！" 除非 ref $value eq ref [];

    foreach { @$value } {
        carp "数组中应该只有代码引用"
            除非 ref $_ eq ref sub {}
        }

    foreach ( @{ $self->{VAL}} ) { $_->() }

    $self->{VAL} = $价值；
    }

```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-22T00:37:31.167

好吧，如果您使用词法文件句柄（而不是旧式的裸字文件句柄），您的具体情况已经得到处理。对于其他情况，您始终可以使用对象的 DESTROY 方法，该方法保证在超出范围时会转到零引用：

```
#!/usr/bin/perl

use strict;
use warnings;

for my $i (1 .. 5) {
    my $defer = Defer::Sub->new(sub { print "end\n" });
    print "start\n$i\n";
}

package Defer::Sub;

use Carp;

sub new {
    my $class = shift;
    croak "$class requires a function to call\n" unless @_;
    my $self  = {
        func => shift,
    };
    return bless $self, $class;
}

sub DESTROY { 
    my $self = shift;
    $self->{func}();
} 
```

ETA：我更喜欢 brian 的名字，Scope::OnExit 是一个更具描述性的名字。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-22T05:10:47.233

您可能想尝试[B::Hooks::EndOfScope](http://p3rl.org/B::Hooks::EndOfScope)

我相信这有效：

```
 use B::Hooks::EndOfScope; 

   sub foo {
      on_scope_end { 
               $codehere;
      };
      $morecode
      return 1; # scope end code executes.
   }

   foo(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T23:44:07.877

我认为你想要类似[Scope::Guard](http://search.cpan.org/dist/Scope-Guard)的东西，但它不能被推送。嗯。

谢谢。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-22T05:27:26.493

微不足道，

```
sub OnLeavingScope::DESTROY { ${$_[0]}->() } 
```

像这样使用：

```
{
    ...
    my $onleavingscope = bless \sub { ... }, 'OnLeavingScope';
    my $onleavingscope2 = bless \\&whatever, 'OnLeavingScope';
    ...
} 
```

（在使用非封闭匿名子时，只有在解决优化（可以说是一个错误）时才需要对子的引用的额外级别。）

# lucene - 索引复制和负载均衡

> ID：670182
> 
> 赞同：6
> 
> 时间：2009-03-21T23:09:01.830
> 
> 标签：lucene, lucene.net

我在我的门户网站中使用 Lucene API，它将有 1000 多个并发用户。我们的 Web 服务器将调用位于应用服务器上的 Lucene API。我们计划使用 2 个应用服务器进行负载平衡。鉴于此，我们在第二个应用服务器上复制 lucene 索引的策略应该是什么？有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T23:24:40.607

您可以使用[solr](http://lucene.apache.org/solr/)，其中包含内置复制。这可能是最好和最简单的解决方案，因为实现您自己的复制方案可能需要大量工作。

也就是说，对于我正在从事的项目，我将自己做这件事。不同之处在于，由于我们使用 PHP 作为前端，我们在套接字服务器中实现了 lucene，它接受查询并返回数据库主键列表。我的计划是将更改推送到服务器并将它们存储在队列中，我将首先将它们存储到内存索引中，然后在负载足够低时将内存索引刷新到磁盘。

尽管如此，这仍然是一件复杂的事情，在我们有一个足够可靠的稳定最终解决方案之前，我准备做很多工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T23:42:25.573

根据经验，Lucene 扩展到成千上万的用户应该没有问题。也就是说，如果您只使用第二个 App 服务器进行负载平衡而不是故障转移情况，您应该可以只在其中一个服务器上托管 Lucene 并通过 NDS（如果您有 unix 环境）访问它或共享来自第二台服务器的目录（在 Windows 环境中）。

同样，这取决于您的具体情况。如果您正在谈论在您的索引中拥有数百万（5 个或更多）文档并且需要您的 lucene 索引是可故障转移的，您可能需要研究 Solr 或 Katta。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-23T13:45:30.217

我们正在开发与您所描述的概念证明类似的实现。我们看到的最终产品由三个独立的服务器组成，以完成此任务。

有一个“发布”服务器，负责生成将要使用的索引。有一个服务实现可以处理用于构建这些索引的工作流，并且能够发出完成信号（通过 WCF Web 服务公开的自定义管理 API）。

有两个“面向站点”的 Lucene.NET 服务器。通过 WCF 服务向站点提供对 API 的访问。它们位于物理负载平衡器后面，并会定期“ping”发布服务器，以查看是否存在比当前运行的更新的索引集。如果是，它会从发布服务器请求锁定并通过启动到本地“传入”文件夹的传输来更新本地索引。到达那里后，只需在附加索引时暂停搜索器即可。然后它释放它的锁，其他服务器也可以做同样的事情。

就像我说的那样，我们只是接近概念验证阶段，作为我们当前解决方案的替代品，这是一个负载平衡的 Endeca 集群。指数的大小和实际完成所需任务所需的时间是尚未证明的更大问题。

我们正在考虑的只是一些随机的事情：

*   如果在每台接收数据的机器上使用两个本地文件夹来实现“循环”方法，则可以减少给定服务器的停机时间。

*   我们正在查看负载均衡器是否允许编程访问以从集群中删除和添加节点。如果他/她在更新期间访问，这将减少用户遇到挂起的机会。

*   如果无法进行集群操作，我们正在研究“请求转发”。

*   我们也看了 solr。虽然其中很多都是开箱即用的，但我们有一些工作时间来探索这条路径作为学习练习 - 学习诸如 Lucene.NET 之类的东西，提高我们的 WF 和 WCF 技能，以及为管理前端实现 ASP.NET MVC -结尾。在最坏的情况下，我们使用 solr 之类的东西，但在一些我们希望改进的技能方面获得了经验。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T21:56:18.093

我正在将发布后端机器上的索引创建到文件系统中，并将它们复制到市场营销中。这样，每个负载和故障平衡的节点都有自己的索引，没有网络延迟。

唯一的缺点是，您不应该尝试在已复制文件夹中重新创建索引，因为您将在每个节点处都有锁定文件，从而阻塞索引读取器，直到您的重新索引完成。

# c# - 在 C# 中访问 Imap

> ID：670183
> 
> 赞同：115
> 
> 时间：2009-03-21T23:09:24.763
> 
> 标签：c#, imap

是否有在 C# 中访问 Imap 服务器（使用 SSL）的内置方法，或者是否有一个好的免费库？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2011-07-15T18:11:40.807

我一直在寻找 IMAP 解决方案一段时间，在尝试了很多之后，我将使用[AE.Net.Mail](https://github.com/andyedinborough/aenetmail)。

您可以通过转到“代码”选项卡并单击小的“下载”图标来下载代码。由于作者不提供任何预编译下载，您必须自己编译。（我相信你可以通过 NuGet 获得它）。bin/ 文件夹中不再有 .dll。

没有文档，我认为这是一个缺点，但我能够通过查看源代码（开源！）并使用 Intellisense 来解决这个问题。下面的代码专门连接到 Gmail 的 IMAP 服务器：

```
// Connect to the IMAP server. The 'true' parameter specifies to use SSL
// which is important (for Gmail at least)
ImapClient ic = new ImapClient("imap.gmail.com", "name@gmail.com", "pass",
                ImapClient.AuthMethods.Login, 993, true);
// Select a mailbox. Case-insensitive
ic.SelectMailbox("INBOX");
Console.WriteLine(ic.GetMessageCount());
// Get the first *11* messages. 0 is the first message;
// and it also includes the 10th message, which is really the eleventh ;)
// MailMessage represents, well, a message in your mailbox
MailMessage[] mm = ic.GetMessages(0, 10);
foreach (MailMessage m in mm)
{
    Console.WriteLine(m.Subject);
}
// Probably wiser to use a using statement
ic.Dispose(); 
```

请务必查看[Github](https://github.com/andyedinborough/aenetmail)页面以获取最新版本和一些更好的代码示例。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2012-09-11T13:39:24.040

希望它对某些人有用，您可能想查看我的尝试：

[S22.Imap](https://github.com/smiley22/S22.Imap)

虽然有几个用于 .NET 的优秀且文档齐全的 IMAP 库可用，但它们都不是免费供个人使用的，更不用说商业用途了……而且我对我发现的大多数被放弃的免费替代品并不满意。

S22.Imap 支持 IMAP IDLE 通知以及 SSL 和部分消息获取。我已经付出了一些努力来制作[文档](http://smiley22.github.com/S22.Imap/Documentation/)并使其保持最新状态，因为在我发现的项目中，文档通常很少或不存在。

随意尝试一下，如果您遇到任何问题，请告诉我！

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2010-05-13T17:03:51.803

IMAP 没有 .NET 框架支持。您需要使用一些第 3 方组件。

试试[https://www.limilabs.com/mail](https://www.limilabs.com/mail)，它非常实惠且易于使用，它还支持 SSL：

```
using(Imap imap = new Imap())
{
    imap.ConnectSSL("imap.company.com");
    imap.Login("user", "password");

    imap.SelectInbox();
    List<long> uids = imap.SearchFlag(Flag.Unseen);
    foreach (long uid in uids)
    {
        string eml = imap.GetMessageByUID(uid);
        IMail message = new MailBuilder()
            .CreateFromEml(eml);

        Console.WriteLine(message.Subject);
        Console.WriteLine(message.TextDataString);
    }
    imap.Close(true);
} 
```

请注意，这是我创建的商业产品。

您可以在此处下载：[https](https://www.limilabs.com/mail) ://www.limilabs.com/mail 。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-11-18T15:19:23.647

[MailSystem.NET](https://github.com/pmengal/MailSystem.NET)包含您对 IMAP4 的所有需求。它是免费和开源的。

（我参与了这个项目）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-08-02T14:06:02.110

尝试使用该库： [https ://imapx.codeplex.com/](https://imapx.codeplex.com/)

该库免费、开源并在此有示例： [https ://imapx.codeplex.com/wikipage?title=Sample%20code%20for%20get%20messages%20from%20your%20inbox](https://imapx.codeplex.com/wikipage?title=Sample%20code%20for%20get%20messages%20from%20your%20inbox)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-21T23:12:09.030

我自己没有尝试过，但这是一个你可以尝试的免费库（我不太确定这个库的 SSL 部分）：

[http://www.codeproject.com/KB/IP/imaplibrary.aspx](http://www.codeproject.com/KB/IP/imaplibrary.aspx)

此外，还有 xemail，它具有 SSL 参数：

[http://xemail-net.sourceforge.net/](http://xemail-net.sourceforge.net/)

[编辑] 如果您（或客户）有钱购买专业的邮件客户端，这个线程有一些很好的建议：

[.NET 组件访问电子邮件收件箱的建议](https://stackoverflow.com/questions/18006/recommendations-for-a-net-component-to-access-an-email-inbox)

# c# - System.Data.Sqlite FormatException 使用带有 LIKE 的参数

> ID：670187
> 
> 赞同：0
> 
> 时间：2009-03-21T23:11:23.323
> 
> 标签：c#, sql, sqlite, system.data.sqlite, phxsoftware

我在 C# 表单应用程序中使用 Sqlite 作为我选择的数据库，并带有[http://sqlite.phxsoftware.com/](http://sqlite.phxsoftware.com/) System.Data.SQLite 提供程序。我正在尝试实现搜索功能，但效果不佳......或者我错过了一些东西。

我正在使用的简化 sql 如下所示：

```
SELECT *
FROM Table
WHERE column LIKE @boundParameter ESCAPE '!' 
```

当我运行此程序时，在带有参数的任何排列中（使用 ? 或 ?001 或 :boundParameter 或 @boundParameter），它会给我一个 FormatException：“输入字符串的格式不正确。” 我找不到任何说我不能在 LIKE 中使用参数的东西。有人知道吗？我需要以其他方式吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T07:11:21.200

我建议尝试这样的事情：

```
"SELECT * FROM [Table] WHERE [column] LIKE @boundParameter ESCAPE @escape"; 
```

接着：

```
command.Parameters.AddWithValue("@boundParameter", parameter));
command.Parameters.AddWithValue("@escape", "!"); 
```

Parameters.AddWithValue 是添加绑定参数的 SQLite 方式，而不必每次都声明一个新参数。

@Noah（对不起，还不能评论）

斯蒂芬詹宁斯是对的，你不必引用你所绑定的价值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T05:21:46.003

"Input string was not in a correct format" is not an error message returned by any version of SQLite

It must be being returned by the wrapper. SO ... I am going to guess that you are using the ADO.NET 2.0 Provider from sqlite.phxsoftware.com

You must remember to quote the value you are binding to the parameter.

For example, if you use

```
command.Parameters.Add(new SQLiteParameter("@boundParameter", _pattern)); 
```

then _pattern = **"'test'"** and not **"test"**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T23:19:25.050

如何连接和添加参数？

我没有太多使用 SQLite，但以下应该可以工作；

```
SQLiteCommand command = _yourConnection.CreateCommand();
command.CommandType = CommandType.Text;
command.CommandText = "SELECT * FROM Table WHERE column LIKE @boundParameter";
command.Parameters.Add(new SQLiteParameter("@boundParameter", _yourSearchCriteria));
... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T23:36:51.073

该程序代码执行一个查询，其中包括一个步骤中的参数替换和模式拟合。在这里，字符串变量 myNamePattern 是我们要为其查找客户的字符串，因此所有返回的客户都将包含变量 myNameattern 字符串。我有同样的问题，但我解决了！这是将字符串模式（也是参数）替换为 SQLiteCommand.CommandText 的完美方式：

SQLiteCommand command = conn.CreateCommand(); command.CommandText = "select * from Customer where name like @myStringParameter"; command.Parameters.Add("myStringParameter", System.Data.DbType.String).Value = "%"+ myNamePattern+ "%";

# bash - 在 bash 脚本中使用源时出现“源：未找到”错误

> ID：670191
> 
> 赞同：168
> 
> 时间：2009-03-21T23:14:11.740
> 
> 标签：bash, virtualenv

我正在尝试编写（我认为会是）一个简单的 bash 脚本，它将：

1.  以 $1 运行 virtualenv 创建一个新环境
2.  激活虚拟环境
3.  做更多的事情（安装 django，将 django-admin.py 添加到 virtualenv 的路径等）

第 1 步效果很好，但我似乎无法激活 virtualenv。对于那些不熟悉 virtualenv 的人，它会创建一个`activate`激活虚拟环境的文件。在 CLI 中，您可以使用`source`

```
source $env_name/bin/activate 
```

$env_name 显然是安装虚拟环境的目录的名称。

在我的脚本中，创建虚拟环境后，我存储激活脚本的路径，如下所示：

```
activate="`pwd`/$ENV_NAME/bin/activate" 
```

但是当我打电话时`source "$activate"`，我得到了这个：

```
/home/clawlor/bin/scripts/djangoenv: 20: source: not found 
```

我知道它`$activate`包含激活脚本的正确路径，实际上我什至在调用`source`. 但`source`它自己似乎找不到它。我还尝试在 CLI 中手动运行所有步骤，一切正常。

在我的研究中，我发现[了这个脚本](http://www.doughellmann.com/articles/CompletelyDifferent-2008-05-virtualenvwrapper/Listing1.html)，它与我想要的类似，但也做了很多我不需要的其他事情，比如将所有虚拟环境存储在 ~/.virtualenv 目录中（或任何在$WORKON_HOME）。但在我看来，他正在创造通往 的道路，并以与我基本相同的方式`activate`调用。`source "$activate"`

这是整个脚本：

```
#!/bin/sh

PYTHON_PATH=~/bin/python-2.6.1/bin/python

if [ $# = 1 ]
then
    ENV_NAME="$1"
    virtualenv -p $PYTHON_PATH --no-site-packages $ENV_NAME
    activate="`pwd`/$ENV_NAME/bin/activate"

    if [ ! -f "$activate" ]
    then
        echo "ERROR: activate not found at $activate"
        return 1
    fi

    source "$activate"
else
    echo 'Usage: djangoenv ENV_NAME'
fi 
```

免责声明：我的 bash script-fu 很弱。我对 CLI 相当满意，但很可能有一些非常愚蠢的原因，这不起作用。

* * *

## 回答 #1

> 赞同：244
> 
> 时间：2009-03-21T23:30:46.553

如果您正在编写 bash 脚本，请按名称调用它：

```
#!/bin/bash 
```

/bin/sh 不保证是 bash。几年前，这在 Ubuntu (IIRC) 中导致了大量损坏的脚本。

内置的源代码在 bash 中工作得很好；但你也可以像诺曼建议的那样使用点。

* * *

## 回答 #2

> 赞同：201
> 
> 时间：2009-03-21T23:25:03.773

在应该尊重的 POSIX 标准中，`/bin/sh`命令是`.`（一个点），而不是`source`. 该`source`命令是一个`csh`已被拉入的 -ism `bash`。

尝试

```
. $env_name/bin/activate 
```

或者，如果您的代码中必须包含非 POSIX`bash`主义，请使用`#!/bin/bash`.

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2010-09-21T05:20:22.757

在 Ubuntu 中，如果您执行脚本，`sh scriptname.sh`则会出现此问题。

尝试`./scriptname.sh`改为执行脚本。

# c - C中奇怪的堆栈行为

> ID：670194
> 
> 赞同：10
> 
> 时间：2009-03-21T23:15:09.570
> 
> 标签：c, stack

我担心我对 C 中的堆栈行为有误解。

假设我有以下代码：

```
int main (int argc, const char * argv[]) 
{
    int a = 20, b = 25;
    {
        int temp1;
        printf("&temp1 is %ld\n" , &temp1);
    }

    {
        int temp2;
        printf("&temp2 is %ld\n" , &temp2);
    }
    return 0;
} 
```

为什么我在两个打印输出中没有得到相同的地址？我得到 temp2 与 temp1 相差一个 int，就好像 temp1 从未被回收一样。

我的期望是堆栈包含 20 和 25。然后将 temp1 放在顶部，然后将其移除，然后将 temp2 放在顶部，然后将其移除。

我在 Mac OS X 上使用 gcc。

请注意，我使用 -O0 标志进行编译而不进行优化。

那些想知道这个问题的背景的人：我正在准备关于 C 的教材，我试图向学生展示他们不仅应该避免从函数返回指向自动变量的指针，还应该避免从函数中获取变量的地址嵌套块并在外部取消引用它们。我试图演示这如何导致问题，但无法获取屏幕截图。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-21T23:23:57.630

编译器完全有权*不*优化`temp1`并`temp2`进入同一位置。自从编译器一次为一个堆栈操作生成代码以来，已经有很多年了。这些天来，整个堆栈框架都是一次性布局的。（几年前，一位同事和我想出了一个[特别聪明的方法来做到这一点](http://www.cs.tufts.edu/~nr/pubs/blocks-abstract.html)。）天真的堆栈布局可能会将每个变量放在自己的插槽中，即使在您的示例中它们的生命周期不重叠。

如果你很好奇，你可能会得到不同的结果`gcc -O1`或`gcc -O2`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T23:23:21.733

无论声明的顺序如何，都无法保证将收到什么地址堆栈对象。

编译器可以愉快地重新排序堆栈变量的创建和持续时间，只要它不影响函数的结果。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-21T23:27:11.880

我相信 C 标准只是谈论在块中定义的变量的范围和生命周期。它没有承诺变量如何与堆栈交互，或者堆栈是否存在。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T23:28:41.127

我记得读过一些关于它的东西。我现在只有这个[不起眼的链接](http://lists.apple.com/archives/Darwin-dev/2009/Mar/msg00013.html)。

> *只是为了让每个人都知道（并且为了存档），我们的内核扩展似乎遇到了 GCC 的已知限制。回顾一下，我们在一个非常可移植、非常轻量级的库中有一个函数，由于某种原因，**当在 Darwin 上/为 Darwin 编译时，它会使用 1600+ 字节的堆栈进行编译**。无论我尝试了哪些编译器选项，以及我使用了哪些优化级别，在可重现（但不频繁）的情况下，堆栈都不会小于 1400 次“机器检查”恐慌。*
> 
> *在网上进行了大量搜索，学习了一些 i386 汇编并与一些更擅长汇编的人交谈后，我了解到**GCC 因具有可怕的堆栈分配而臭名昭著。**[...]*
> 
> *显然这是 gcc 肮脏的小秘密，但对某些人来说并不是什么秘密——Linus Torvalds 在各种列表中多次抱怨 gcc 堆栈分配（在 lkml.org 中搜索“gcc 堆栈使用情况”）。一旦我知道要搜索什么，就会有很多抱怨**gcc 对堆栈变量的低于标准分配，特别是它无法为不同范围内的变量重用堆栈空间。***

话虽如此，我的 Linux 版本`gcc`正确地重用了堆栈空间，我得到了两个变量的相同地址。不确定 C 标准对此有何规定，但严格的范围强制仅对 C++ 中的代码正确性很重要（由于范围末尾的破坏），而在 C 中则不重要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-22T01:48:53.037

没有设置变量如何放置在堆栈上的标准。编译器中发生的事情要复杂得多。在您的代码中，编译器甚至可能选择完全忽略和抑制变量`a`和`b`.

在编译器的许多阶段，代码可能会被转换为它的[SSA 形式](http://en.wikipedia.org/wiki/Static_single_assignment_form)，并且所有堆栈变量都以这种形式失去了它们的地址和含义（它甚至可能使调试器更难）。

堆栈空间非常便宜，因为分配 2 个或 20 个变量的时间是恒定的。此外，对于大多数函数调用来说，堆栈空间是非常动态的，因为除了少数函数（那些更接近`main()`和线程入口函数，具有长寿命的事件循环等）之外，它们往往会很快完成。所以，你只是不要打扰他们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T23:20:16.390

这完全取决于编译器及其配置方式。

# c# - 如何将 TCP/IP 摄像机连接到 PC？

> ID：670196
> 
> 赞同：0
> 
> 时间：2009-03-21T23:17:34.027
> 
> 标签：c#, vb.net, camera, surveillance

我想编写一个可以从 TCP/IP 摄像头捕获的应用程序。我还没有买相机。我有以下问题：

*   我应该在相机中寻找什么？
*   是否所有相机都有相应的 SDK 或 API？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T23:22:12.737

获取具有 HTTP 服务器的相机，允许您像任何 Web 服务器一样从中下载图像。这是大多数 IP 摄像机的标准配置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T00:47:36.650

大多数相机会生成您可以捕获的 JPEG 或 MPEG4 流，或两者兼而有之。不像 Earwicker 声称的那样，我的相机不允许你下载图像。但是，他们可以通过电子邮件、ftp 发送图像，或将图像写入 SD 卡。

我使用 Synology Rackstation 上的软件在 NAS 上录制流媒体。我没有真正看过他们使用的软件，但我几乎可以肯定，在幕后，它是一些免费提供的 Linux 软件。你可以调查一下。

# ruby-on-rails - 使用 redirect_to 将模型属性传递给 Rails 视图

> ID：670197
> 
> 赞同：5
> 
> 时间：2009-03-21T23:17:50.717
> 
> 标签：ruby-on-rails

我试图将模型属性传递给视图，在我的控制器中的操作中成功地将其设置为新值之后。但是这个变量在它到达视图时总是为零，所以我不能用它来有条件地显示东西。我应该补充一点，这个属性不是数据库中的一个字段。我错过了什么/做错了什么？

这是我模型中的代码：

```
attr_accessor :mode

#getter
def mode
 @mode
end

#setter
def mode=(val)
 @mode = val
end 
```

...在控制器中：

```
@report.mode = "t"
redirect_to edit_report_path(@report) 
```

...在我看来：

```
<%= build_report(@report.mode) %> 
```

...但是这个辅助方法永远不会得到我刚刚在控制器中设置的变量。它是零。是什么赋予了？显然我在这里遗漏了一些基本的东西，因为这看起来应该很简单。任何见解将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T23:43:00.267

`edit_report_path`生成一个带有 ID 的 URL `@report`。

`redirect_to`本质上是创建一个全新的请求，然后转到那个 URL。当它到达 时`edit`，它所拥有的只是 ID。通常这很好 - 它会查找对象并继续前进，但当然它不会有您设置的非 db 字段。

有几种方法可以解决这个问题。您可以使用 :render 来进入编辑页面 - 然后 @report 将设置该字段。

```
@report.mode = "t"
render :action => edit and return 
```

或者，您可以创建`mode`一个数据库字段。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T23:41:52.593

这里的问题出在`redirect_to`. 当您重定向到其他地方时，所有实例变量都会丢失。因此，当您设置`@report.mode = "t"`它时，它会设置属性。但是，当您重定向时，该数据会丢失。

我假设`<%= build_report(@report.mode) %>`它在 edit_report.html.erb 中，并且您设置“模式”时的代码不在编辑操作中。如果是这种情况，您可以将`report.mode`url 传递给编辑操作，如下所示：

```
 build_report(@report.mode, :mode => "t") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T23:40:37.200

问题是`redirect_to`；您正在向客户端返回一个响应，导致它使用不同的 url 重做请求。在第二个请求中，模式未设置，因为您在结束第一个请求之前没有保存它。

# cocoa - Cocoa 绑定到数组控制器中的特定项目

> ID：670202
> 
> 赞同：4
> 
> 时间：2009-03-21T23:19:50.027
> 
> 标签：cocoa, cocoa-bindings, key-value-observing, nsarraycontroller, key-value-coding

是否可以使用`NSArrayController`将 a`NSTextField`的值绑定到数组中的特定项目？特别是，我想绑定到数组中第一项的属性，如果数组为空，则不显示任何内容。

使用`arrangedObjects.command`仅显示“（” - 大概它试图为每个项目显示一个带有逗号分隔字符串的多行字符串。我只想要第一个。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T23:52:44.080

将文本字段绑定到`selection.command`，并以编程方式将数组控制器的选择索引设置为 0。在向内容数组添加或删除项目时，您可能还需要将选择索引重新设置为 0。

显然，如果您允许用户在数组控制器中选择项目（您需要第二个数组控制器），这将不起作用。我假设情况并非如此，因为如果是这样，我希望您希望显示用户选择的对象，而不是始终显示第一个对象。

编辑：更好的是，不要做这样的事情——如果数组中的第一个对象有一些特殊状态，你应该创建一个单独的非数组属性（在保存原始数组的同一个对象中，我从中假设数组控制器正在获取它）来保存具有该状态的对象。

# haskell - 如何在结构上使用 Haskell 的 FFI？

> ID：670221
> 
> 赞同：18
> 
> 时间：2009-03-21T23:34:30.567
> 
> 标签：haskell, word-wrap, ffi

我创建了以下用于读取图像的 C 库：

```
typedef struct {
    unsigned int height;
    unsigned int width;

    unsigned char* red; //length=height*width
    unsigned char* green;
    unsigned char* blue;
} Contents;

Contents readJPEGFile(const char* inFilename); 
```

我真的找不到任何使用带有外部函数接口的数组和结构的信息。我将如何继续能够在 Haskell 中使用我的库？

我尝试使用以下示例作为基础：[http](http://therning.org/magnus/archives/315) ://therning.org/magnus/archives/315但随后 hsc 文件被编译为仅包含上述 c 代码的 hs 文件，仅此而已（以及当然不能编译）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-22T03:36:47.817

基本 FFI 支持仅包括标量类型。你最终用地址算术做的所有其他事情。[FFI 文档中有关外部类型](http://www.cse.unsw.edu.au/~chak/haskell/ffi/ffi/ffise5.html#x8-240005.1)的部分提供了基础知识，您可以在[FFI Cookbook](http://www.haskell.org/haskellwiki/FFICookBook)中找到示例。

有一次，您可以使用[Green Card](http://www.haskell.org/greencard/)和[H/Direct](http://haskell.org/hdirect/)等工具为您生成编组和解组代码。由于我不明白的原因，这些工具已经很长时间没有更新了。据我所知，当前选择的工具是[`hsc2hs`](http://www.haskell.org/ghc/docs/latest/html/users_guide/hsc2hs.html).

* * *

编辑：正如评论中所述（感谢 ehemient），[`c2hs`](http://www.cse.unsw.edu.au/~chak/haskell/c2hs/)它也很受欢迎，并且由于`c2hs`来自 Manuel Chakravarty，它可能会很好。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-19T14:01:50.547

听起来好像您有构建问题；我似乎确实记得，当我将 FFI 接口写入 Windows Win32 DDEML 库时，我使用了您引用的页面作为示例。例如，我们使用的结构之一是

```
typedef struct tagHSZPAIR {
    HSZ     hszSvc;
    HSZ     hszTopic;
} HSZPAIR, *PHSZPAIR; 
```

`#include "ddeml.h"`将其带入`DDEML.hsc`文件。我们通过以下方式访问它：

```
数据 HSZPair = HSZPair HSZ HSZ
实例 Storable HSZPair where
    sizeOf _ = (#size HSZPAIR)
    对齐 = sizeOf
    peek ptr = do svc <- (#peek HSZPAIR, hszSvc) ptr
                                      主题 <- (#peek HSZPAIR, hszTopic) ptr
                                      返回 $ HSZPair svc 主题
    poke ptr (HSZPair svc 主题) = do (#poke HSZPAIR, hszSvc) ptr svc
                                      (#poke HSZPAIR, hszTopic) ptr 主题

```

不幸的是，我目前无法向您展示它编译成什么，因为我手边没有 Windows 框，但生成的代码与上面一样，除了`#size HSZPAIR`替换为`(64)`或其他等等。

（如果您真的想查看生成的内容，或者在构建过程中需要帮助，请给我发电子邮件，我会为您提供帮助。）

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-03-22T00:00:28.820

[Hackage 有几个使用 FFI 的软件包，](http://hackage.haskell.org/packages/archive/pkg-list.html)您可以查看这些软件包作为示例。

# asp.net-mvc - Silverlight 3 是否改变了 MVC 与 Silverlight 的问题？

> ID：670223
> 
> 赞同：8
> 
> 时间：2009-03-21T23:35:27.040
> 
> 标签：asp.net-mvc, silverlight, silverlight-3.0

我很快就会开始一个新项目，并研究是否使用 MVC、Silverlight 或两者兼而有之。[Silverlight vs. ASP.NET MVC](https://stackoverflow.com/questions/102357/silverlight-vs-asp-net-mvc)这个问题是一个很好的起点。但纵观 SL3 测试版，似乎有两件事稍微改变了格局。首先，导航功能是 Silverlight 的直接功能，现在是 .NET RIA 服务。虽然它实际上不是 Silverlight 的一部分，但它是相当集成的，并且似乎弥合了客户端和服务器操作之间的差距。在我看来，MVC 强大而 Silverlight（作为客户端技术）不强大的领域。我知道您仍然可以同时使用两者，但您应该使用吗？为什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-22T14:35:39.233

简单地说，没有。

桌面上的 Silverlight 和 silverlight 更像是恰好在 web 上运行的 winforms/wpf 应用程序。它们是有状态的并且行为与网站非常不同。Silverlight 应用程序只能在允许运行 silverlight 的机器上运行。在业务网络设置中，他们可能设置了组策略，因此无法安装 silverlight。那你就有问题了。

然而，ASP.NET MVC 是一种无状态类型的设计，几乎任何拥有 Web 浏览器的人都可以访问任何平台。您在使用 ASP.NET MVC 的站点上拥有更多的自由，因为您不依赖最终用户安装了任何类型的运行时。

我认为每个人都有自己的位置，这非常明显。Silverlight 非常适合在适用的情况下创建丰富的体验。我怀疑你会看到太多的silverlight 出现替代网站。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-02T04:23:52.340

当我们构建 .NET RIA 服务时，我们希望开发人员能够基本构建出 100% 的快速 RIA，因此我们针对这种方法来承担 ASP.NET WebForms 等的负担。以混合方式使用这两者是可能的，但问题是您要承担繁重的工作。

如果您的 Silverlight 解决方案在实现方面是基本的 - 即仅数据网格 - 那么 ASP.NET MVC 更适合您，因为这样您就不必担心深度链接等（因为它在本机内部是免费的基于 HTML 的方法）。

但是，如果您在 Silverlight 中构建更大的 RIA 解决方案并以特定的方式使用 ASP.NET，那没关系，但您必须记住，每次页面刷新都会带来以下惩罚：当然是页面刷新，其次您需要确保所述 Silverlight 实例可以找到返回到刷新之前的位置（或者加载到使用户能够找到前进方向的位置）。

尽管我们融入了 RIA 服务，但它可能有点非常棘手。

**Scott Barnes / Rich Platforms 产品经理 / Microsoft。**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T23:40:52.363

我认为这两种技术都有自己的位置——我认为 Silverlight 将主要用于特殊用途的应用程序，而 asp.net MVC 将主要用于公共和通用风格的网页和 Web 应用程序。

至于你想使用哪一个，这完全取决于你的需求和你的听众。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T14:41:18.087

Silverlight 甚至对于业务应用程序（导航、RIA 服务、数据表单等）也很顺利，但你最大的问题是插件。

就个人而言，我已经厌倦了 HTML，所以我将精力集中在 Silverlight 上。

这还取决于您在网站上工作是否是为了好玩。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-12T16:12:32.417

许多为企业和组织构建的网站都有一个“只读”的面向公众的前端。也就是说，信息（库存、目录、公司新闻）是从一个丰富的数据库中呈现出来的，但普通的最终用户没有能力编辑它们。

我看到的自然模式是使用 ASP.NET MVC 进行“前端”演示，但使用 Silverlight / RIA 功能以避免将所有 CRUD 内容写入管理后端。这是一个很好的选择。管理用户群通常比总受众小得多，下载时间、Silverlight 渗透等问题几乎没有那么大的问题。

然而 Silverlight RIA / ASP.NET MVC 的故事现在是一个非常模糊的故事。没有太多信息讨论如何使用 RIA 服务来提供对您为 MVC 项目构建的样式的共享存储库项目的访问。[链接文本](https://stackoverflow.com/questions/1106493/net-ria-services-with-mvc-style-repositories "关联")这使得现在很难整合它们。您可以在通用 EF 或 Linq2Sql 基础之上构建 MVC 和 RIA 层，但共享您为 MVC 构建的 Repository 类的智能是有意义的。

理想情况下，我们将获得将 RIA 服务连接到存储库样式类层的良好文档，独立于存储库用于与底层数据库通信的内容，然后快速开发故事将完成。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-01T03:12:51.817

我不认为 Silverlight 改变了 asp.net MVC 的故事。

MVC 让 asp.net 对 web 标准更加友好，并强制项目进入一个更可测试、解耦的结构。后者是网络表单中架构师/开发人员的唯一责任。

“就个人而言，我厌倦了 HTML，所以我将精力集中在 Silverlight 上。” 但愿如此。javascript也是。

十多年来，我一直在开发 Web 应用程序（经典的 asp，然后在 .Net 处于测试阶段时就跳到了 .Net）。asp.net 中的 MCTS x2 和 MCPD x2。虽然我认为 ASP.Net MVC 是网站开发人员的绝佳补充，但我确实认为 UI 层中具有严格 MVP 模式的 Web 表单通常更适合企业/B2b Web 应用程序。（仪表板、管理、报告等）

这一切都说明了当我更多地进入集成空间、SOA、biztalk、wcf 等。我真的很高兴这个 css 属性在“IE 版本”中有效应用。或“firefox 版本接下来是什么”以及处理有时很棒的有时想要拍摄自己的 web 表单中的控制层次结构。

Silverlight 3 真正开始与 LOB 应用程序相关，我认为它是 webforms 的主要编译器，而不是 MVC。

# windows - 如何从 PATH 环境变量中提取完整路径？

> ID：670224
> 
> 赞同：2
> 
> 时间：2009-03-21T23:35:33.000
> 
> 标签：windows, batch-file, scripting, cmd

我想`PATH`使用本机 cmd 工具从环境变量中提取完整路径。考虑以下`PATH`内容：

> C:\Program Files\Windows 资源工具包\Tools\;C:\Perl\site\bin;C:\Perl\bin;C:\WI NDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem ;c:\Program Files\Microsoft SQL Server\90\Tools\binn\;C:\WINDOWS\system32\WindowsPowerShell\v1.0;C:\Program Files\Microsoft SQL Server\80\Tools\Binn\; C:\Program Files\Microsoft SQL Server\10 0\DTS\Binn\;C:\Program Files\Microsoft SQL Server\100\Tools\Binn\;c:\program 文件\nmap\;C:\Program Files \WinRAR\;C:\Program Files\QuickTime\QTSystem\;C:\Program Files\hydra-5.4-win\;C:\Program Files\john1701\run;C:\dig;;C:\cygwin; C:\wamp\b in\mysql\mysql5.0.45\bin;C:\Program Files\MySQL\MySQL Server 5.0\bin;C:\Program Files\Tail4win;C:\Program Files\Overlook Fing 1.1\bin

我只想提取以下路径：

> C:\Program Files\MySQL\MySQL 服务器 5.0\bin；

有`FOR`能力做这种事吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T00:09:47.457

您可以使用`for`标记 at`;`但您需要注意其中包含 a 的路径`;`（因此需要引号）。总而言之，我会说此时您将使用大量代码构建一个非常脆弱的解决方案。

如果您想知道某个可执行文件在哪里，那么

```
for %%i in ("mysql.exe") do @echo.%%~$PATH:i 
```

会告诉你（或者不会，如果它不在 中`PATH`）。

**更新：**好的，我明白了。一个讨厌的小批处理文件如下：

```
@echo off
setlocal enabledelayedexpansion enableextensions
set p=%PATH%
:loop
for %%i in ("notepad.exe") do call :setvar "%%~$p:i"
if not :%x%:==:: (call :clearpath & goto loop)
goto :eof

:setvar
    set x=%~1
goto :eof

:clearpath
    echo %x%
    for %%x in ("!x!") do set d=%%~dpx
    set d=!d:~,-1!
    set p=!p:%d%=!
goto :eof 
```

这将打印从`PATH`哪里`notepad.exe`找到的所有匹配路径（我知道的第一个程序在这里的两个地方）。相应地适应您的问题。

`:clearpath`只需从变量中删除找到的路径，然后我们再次尝试匹配，直到没有匹配项。

也就是说，这仍然很不漂亮。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T23:50:17.753

如果您已经知道路径，为什么需要在 PATH 字符串中找到它？

或者换一种说法，您是否知道识别该字符串的方法，因为它可能因安装而异？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-08T00:16:16.967

或者，您可以使用 vbscript。

```
Set objFS=CreateObject("Scripting.FileSystemObject")
Set objArgs = WScript.Arguments
strSearch = objArgs(0)
Set WshShell = WScript.CreateObject("WScript.Shell")
Set WshPath = WshShell.Environment("SYSTEM")
strPath =WshPath("Path")

s = Split(strPath,";")
For i=LBound(s) To UBound(s)
    If InStr(1,s(i),strSearch,1) > 0 Then
        WScript.Echo s(i)
    End If 
Next 
```

将上述内容另存为 findpath.vbs 并在命令行上像这样使用它来在 PATH 变量中查找所需的任何字符串：

c:\test> cscript //nologo findpath.vbs mysql

在批处理文件中，要获取结果，请使用 for 循环

# sql-server - SQL Server WHERE 子句中的与号 (&) 运算符

> ID：670230
> 
> 赞同：34
> 
> 时间：2009-03-21T23:39:48.107
> 
> 标签：sql-server, tsql, bitwise-operators

对不起，这个非常基本的问题。`&`操作符在这条 SQL 中做了什么

```
WHERE (sc.Attributes & 1) = 0 
```

`sc`是包含列的表的别名`attributes`。

我试图理解报告中的一些 SQL，并且该行使其返回 0 个条目。如果我将其注释掉，它会起作用。我的 SQL 知识有限，我不确定`& 1`它在做什么。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-03-21T23:44:13.587

[& 是按位逻辑和运算符](http://msdn.microsoft.com/en-us/library/ms174965.aspx)- 它对 2 个整数值执行操作。

```
WHERE (sc.Attributes & 1) = 0 
```

上面的代码检查 sc.Attributes 是否为偶数。这与说第一位未设置相同。

由于列的名称：“属性”，那么“1”值可能只是一些具有某些外部含义的标志。

对于存储在属性数字中的每个标志，通常使用 1 个二进制数字。因此，要测试第一位使用 sc.Attributes&1，测试第二位使用 sc.Attributes&2，测试第三位使用 sc.Attributes&4，测试第四位使用 sc.Attributes&8，...

= 0 部分正在测试是否未设置第一位。

一些二进制示例：（== 显示操作结果）

```
//Check if the first bit is set, same as sc.Attributes&1
11111111 & 00000001 == 1
11111110 & 00000001 == 0
00000001 & 00000001 == 1

//Check if the third bit is set, same as sc.Attributes&4
11111111 & 00000100 == 1
11111011 & 00000100 == 0
00000100 & 00000100 == 1 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-21T23:41:39.600

它是[按位逻辑 AND 运算符](http://msdn.microsoft.com/en-us/library/ms174965.aspx)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-21T23:42:07.803

这是一个[位和](http://msdn.microsoft.com/en-us/library/ms176122.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-19T20:48:59.360

看到您将其标记为 sql server，我想我会从不同的角度添加一些东西，因为这周也遇到了其中一个。

如果在谓词中使用这些可能会损害查询的性能。很容易制造自己的例子。这是我查询的片段

```
WHERE
advertiserid = @advertiserid
AND (is_deleted & @dirty > 0)

WHERE
advertiserid = @advertiserid
AND (is_deleted > 0 AND @dirty > 0) 
```

通过简单地用适当的值定义每一列，这允许优化器删除书签查找，并且性能统计显示 X10 性能提升。

# iphone - 难倒：无法使用类定义

> ID：670232
> 
> 赞同：0
> 
> 时间：2009-03-21T23:40:24.347
> 
> 标签：iphone

我定义了一个 Owners 类，它在现有类中使用得很好。

我试图添加另一个类，无论我做什么（删除、重新创建新类、复制其他类文件并重命名、清理所有目标、对着月亮嚎叫），我都不能在我创建的任何新文件中使用这个特定的类.

该类很简单，具有数组的单例定义。

这里它在另一个类中使用（很好）：

```
#import "OwnersSchema.h"
#import "Owners.h"
#import "Constants.h"

@implementation OwnersViewController
@synthesize mid,imageStore;

- (OwnersSchema *)OwnersForIndexPath:(NSIndexPath *)indexPath {
return [[Owners sharedOwners].ownersArray objectAtIndex:indexPath.row];
} 
```

因此，我制作了上述头文件的精确副本并制作文件，只是重命名接口等并添加相同的确切代码，它声称 Owners 未声明：First use in function。

我可以将其他类定义添加到新文件中，它可以很好地看到它们。

这是所有者类：

```
#import <UIKit/UIKit.h>
#import "URLConnection.h"
@class OwnersSchema;

@interface Owners : NSObject <URLCacheConnectionDelegate> {
NSMutableArray *ownersArray;
NSString *lastUpdated;
NSString *url;
NSString *dbpath;
}
@property (nonatomic,retain) NSString *dbpath;
@property (nonatomic,retain) NSMutableArray *ownersArray;
@property (nonatomic,retain) NSString *lastUpdated;
@property (nonatomic,retain) NSString  *url;
-(void)saveOwnersArray;
+ (Owners *)sharedOwners;
@end 
```

我不明白。我只想创建另一个视图控制器。文件或类包含的数量是否有一些限制（实际上，我只在少数地方使用了这个 Owners 类）。为什么除了我正在尝试创建的新类之外它在其他任何地方都有效？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T00:04:15.053

尝试清洁并重建？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T00:51:00.103

好的，我再次清理了所有目标，然后运行清理缓存，然后重新启动，该类再次可用。

# vb.net - x 重复字符的索引

> ID：670236
> 
> 赞同：0
> 
> 时间：2009-03-21T23:41:35.543
> 
> 标签：vb.net, counting, recurring

以下代码应该在消息框中显示字符串*checkme中***第三个** *a*的索引，但是当我运行程序时，它没有给我正确的答案（应该是 12，而不是我得到 9）。我做错了什么，我将如何让它发挥作用？

 *```
Private Sub Button4_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button4.Click
    Dim checkme As String = "thais is a sample sentence a"
    Dim indexnum As Integer
    indexnum = checkme.IndexOf("a", checkme.IndexOf("a") + 3)
    MessageBox.Show(CStr(indexnum))
End Sub 
```

Option Explicit 和 Strict 必须打开。提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T23:54:05.810

**我究竟做错了什么？**

你正在寻找第二个`a`. 我猜你在想这个：

```
checkme.IndexOf("a", checkme.IndexOf("a", 3)) 
```

这实际上会给你正确的结果。（它说“查找出现在第一个 a 之后出现的第一个 a，该 a 出现在第三个字符上或之后（恰好是 a）”）

您的原始代码说“找到第一个 a 出现在第一个 a 之后的 3 个位置上或之后”，这只会让您到达第二个`a`。

**我如何解决它？**

您*可以*在`IndexOf`循环中使用，将最后找到的索引重新用作下一个开始索引。

```
Shared Public Function FindIndexOfNthChar(ByVal checkme as String, _
                                          ByVal checkChar as Char, _
                                          ByVal n as Integer) as Integer
   Dim lastIndex As Integer = -1

   For i As Integer = 1 To n
      lastIndex = checkme.IndexOf(checkChar, lastIndex + 1)
      If lastIndex = -1 Then Return -1
   Next i

   Return lastIndex
End Function 
```

你必须要小心; 如果您不检查`-1`每次尝试并立即退出，您可能会得到错误的结果。

如果您忘记了这一点（正如其他一些帖子似乎有），那么如果您`a`在一个字符串中搜索第三个，那么`a`您实际上将返回第一个的索引`a`（当您尝试找到第二个 a 时，您'会将您的索引重置为`-1`，这实际上是重新开始搜索）

出于这个原因，仅仅写下你的意思可能会更清楚：

```
Shared Public Function FindIndexOfNthChar(ByVal checkme as String, _
                                   ByVal checkChar as Char, _ 
                                   ByVal n as Integer) as Integer
   Dim count as Integer = 0

   For i as Integer = 0 To checkme.Length - 1
      If(checkme(i) = checkChar) Then
         count += 1
         If(count = n) Then Return i 
      End If
   Next i

   return -1
End Function 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T23:48:33.920

`checkme.IndexOf("a")`是 2。加 3 得到 5。所以整个表达式变为：

```
indexnum = checkme.IndexOf("a", 5) 
```

找到第二个。

如果你想找到第 N 个，循环 N 次，每次循环执行：

```
pos = checkme.IndexOf('a', pos + 1) 
```

在循环之前，将 pos 设置为 -1。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T23:50:15.053

你只找到第二个“a”。尝试使用这样的循环。

```
Private Sub Button4_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button4.Click
    Dim checkme As String = "thais is a sample sentence a"
    Dim indexnum As Integer = -1
    For i As Integer = 1 To 3
        indexnum = checkme.IndexOf("a", indexnum + 1)
    Next
    MessageBox.Show(CStr(indexnum))
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T23:50:18.457

您拥有的代码不会产生预期的效果。相反，它所做的是找到位于位置 2 的第一个“a”。然后它找到出现在位置 5 (2+3) 之后的第一个“a”。如果您想要第三个“a”，您可以使用类似于以下内容的内容

```
indexnum = checkme.IndexOf("a")
indexnum = checkme.IndexOf("a", indexnum+1)
indexnum = checkme.IndexOf("a", indexnum+1) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T23:51:49.607

为什么会是12？位置 5 之后的下一个“a”位于位置 9。您的代码基本上可以分解为：

```
'thais is a sample...
'0123456789
Dim idxFirstA = checkme.IndexOf("a") ' equals 2

'thais is a sample...
'0123456789
Dim idxThirdA = checkme.IndexOf("a", 2 + 3) ' equals 9 
```

您跳过第一个“a”（位置 2），然后找到第二个“a”（位置 9）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-22T00:11:46.860

```
Private Sub Button4_Click(ByVal sender As System.Object, _
                          ByVal e As System.EventArgs) _
                          Handles Button4.Click
    Dim checkme As String = "thais is a sample sentence a"
    Dim indexnum As Integer = -1, occrnc As Integer = 0
    For x As Integer = 0 To checkme.Length - 1
        indexnum = checkme.IndexOf("a", indexnum + 1)
        If indexnum <> -1 Then occrnc += 1
        If occrnc = 3 Then Exit For
    Next
    If occrnc = 3 Then MessageBox.Show(indexnum.ToString)
End Sub 
```

# ruby-on-rails - 如何让 redirect_to 使用不同的 HTTP 请求？

> ID：670250
> 
> 赞同：12
> 
> 时间：2009-03-21T23:45:48.747
> 
> 标签：ruby-on-rails, redirect, http-request

在我的一个控制器操作结束时，我需要重定向到一个只接受 put 请求的页面。我一直在试图弄清楚如何让 redirect_to 使用 put 请求但没有成功。

这可能吗？还是有另一种方法可以做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-22T01:05:38.913

我认为您无法做到这一点，并且我怀疑限制是 HTTP 本身的一部分。

使用**redirect_to**时 - 除非参数中另有指定，否则重定向将作为“302 Moved”标头发生。

查看 HTTP 规范本身并没有揭示任何改变浏览器通过重定向发出的请求类型的方法。

[HTTP 重定向](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3)：

> 此类状态码表明用户代理需要采取进一步的行动才能满足请求。当且仅当第二个请求中使用的方法是 GET 或 HEAD 时，用户代理可以执行所需的操作，而无需与用户交互。

我认为您可能需要使用 JavaScript 来实现此功能，或者重新考虑应用程序中的控制流。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T06:01:50.497

如果该操作与您尝试重定向的控制器位于同一控制器中，只需调用该操作并呈现模板，如下所示：

```
def show
  index
  render :action => "index"
end 
```

如果不是，那我不知道你是怎么做到的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T18:57:38.777

好的，所以我找到了解决问题的方法。[我在这里](http://last10percent.com/2008/05/26/post-redirects-in-rails/)找到了一篇很好的关于这种情况的文章。我的实现如下所示：

```
private
def redirect_post(redirect_post_params)
  controller_name = redirect_post_params[:controller]
  controller = "#{controller_name.camelize}Controller".constantize
  # Throw out existing params and merge the stored ones
  request.parameters.reject! { true }
  request.parameters.merge!(redirect_post_params)
  controller.process(request, response)
  if response.redirected_to
    @performed_redirect = true
  else
    @performed_render = true
  end
end 
```

然后我这样调用这个方法：

```
 redirect_post :controller => 'registrations', :action => 'order', :_method => 'put', :authenticity_token => params[:authenticity_token] 
```

因此，我能够通过发出发布请求（使用`redirect_post`）然后将“放置”分配给`_method`参数来“伪造”放置请求。如果您查看一个正常的`put`请求，那么它就是一个`post`带有`_method`参数的表单。所以它有点hackish，但它完成了工作。

此外，您必须确保在调用`redirect_post`哈希值时是字符串，否则将引发错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T00:22:37.287

[您可以使用 Javascript](http://www.wynia.org/wordpress/2007/03/18/not-just-get-and-post-http-put-and-delete-with-javascript/)重定向到从客户端发出 put 请求的不同页面。

# nhibernate - 使用 Rhino Commons UnitOfWork 为集成测试嵌套事务范围

> ID：670263
> 
> 赞同：0
> 
> 时间：2009-03-21T23:52:34.550
> 
> 标签：nhibernate, transactionscope, unit-of-work, rhino-commons

我正在尝试设置一个集成测试类，将每个测试包装在一个事务中。这样我可以在每次测试后回滚事务，而不是在每次测试前重置数据库。

我还希望能够在集成测试本身中使用事务。

我正在为该项目使用 NHibernate 和 Rhino Commons UnitOfWork。我正在使用 MSTest 进行测试。

我想要这样的东西：

```
[TestInitialize]
public void TestInit() {
    // create outer transaction scope
    UnitOfWork.Start();
    UnitOfWork.Current.BeginTransaction();
}

[TestCleanup]
public void TestCleanup() {
    // rollback outer transaction
    UnitOfWork.Current.Dispose();
}

[TestMethod]
public void IntegrationTest() {
    using (UnitOfWork.Start(UnitOfWorkNestingOptions.CreateNewOrNestUnitOfWork)) {
        UnitOfWork.Current.BeginTransaction();

        // integration test code

        UnitOfWork.Current.TransactionalFlush();

        // possibly more transactions
    }
} 
```

这是我第一次使用 NHibernate、Rhino Commons 和 MSTest。我不清楚嵌套 Rhino Commons`UnitOfWork`的会话行为。我在这里所拥有的不会回滚集成测试中的更改。

我尝试使用`TransactionScope`from ，但在s 结束`System.Transactions`时出现以下错误：`UnitOfWork`

> System.InvalidOperationException：事务正在进行时无法调用断开连接。

所以这是我的问题：
有没有办法在 Rhino Commons 中使用 UnitOfWork 获得这种行为？如果不是，我应该在每次测试之前重置数据库，还是有另一种方法可以嵌套与 UnitOfWork 配合得很好的事务？

谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-16T16:33:19.853

我相信`UnitOfWork.Start().BeginTransaction()`返回一个`RhinoTransaction`. 因此，为了更清楚，您可以尝试将代码重写为：

```
using(IUnitOfWork uow = UnitOfWork.Start(UnitOfWorkNestingOptions.CreateNewOrNestUnitOfWork))
{
    RhinoTransaction tx = uow.BeginTransaction();
    .
    .
    .
    .
    tx.Rollback();
} 
```

不过请注意，我没有尝试过上面的代码，如果它有效，请告诉我。

# scripting - 如何扩展此批处理命令？

> ID：670266
> 
> 赞同：0
> 
> 时间：2009-03-21T23:53:57.463
> 
> 标签：scripting, batch-file

我遇到了这段批处理代码。`.exe`如果您输入它，它应该找到每个文件的路径。

```
@Set Which=%~$PATH:1
@if "%Which%"=="" ( echo %1 not found in path ) else ( echo %Which% ) 
```

例如，如果将此代码保存在文件中`which.bat`，然后在 DOS 中转到其目录，则可以编写

```
which notepad.exe 
```

结果将是：`C:\WINDOWS\System32\notepad.exe`

但它有点受限，因为它找不到其他可执行文件。我做了一些批处理，但我不知道如何编辑此代码，以便它可以爬取硬盘驱动器并返回确切的路径。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T00:27:39.583

当您想在驱动器上的任何位置找到可执行文件（或其他文件）时，而不仅仅是在 中`PATH`，那么也许只有以下内容可以可靠地工作：

```
dir /s /b \*%!~x1 | findstr "%1" 
```

但是，它仍然非常缓慢。它不适用于循环目录结构。它可能会吃掉孩子。

使用 Windows 搜索（取决于操作系统）或从头开始编写完全符合您要求的程序可能会更好（循环目录的事情可能很容易在最近的 Windows 版本上发生；afaik 默认情况下他们已经有了）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T00:52:08.043

这是用python编写的相同内容：

```
 import os

def which(program,additional_dirs=[]):
    path = os.environ["PATH"]
    path_components = path.split(":")
    path_components.extend(additional_dirs)
    for item in path_components:
        location = os.path.join(item,program)
        if os.path.exists(location):
            return location
    return None 
```

如果仅使用参数调用，则只会搜索路径。如果使用两个参数调用（第二个是数组），将搜索其他目录。这里有一些片段：

```
 # this will search notepad.exe in the PATH variable
print which("notepad.exe")
# this will search whatever.exe in PATH. If not found there,
# it will continue searching in the D:\ drive and in the Program Files
print which("whatever.exe",["D:/","C:/Program Files"]) 
```

# python - 无法通过 AWK/SED/Python 找到权限为 777 的文件/文件夹

> ID：670269
> 
> 赞同：0
> 
> 时间：2009-03-21T23:55:39.020
> 
> 标签：python, sed, awk

**问题**

1.  获取每个文件夹中每个文件的权限

2.  查找具有 777 权限的文件，然后将文件名及其路径打印到列表中

我们可以通过以下方式获取一个文件夹中文件的权限

```
ls -ls 
```

我不知道如何有效地获取每个文件夹中每个文件的权限。

**如何通过 AWK/SED/Python 找到具有 777 权限的文件？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-22T00:05:57.513

你在找`find`吗？

```
find /some/path -perm 0777 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-22T15:43:47.993

查找 /some/path -perm 0777 -type f

# java - 刷新 JPanel

> ID：670274
> 
> 赞同：4
> 
> 时间：2009-03-22T00:00:38.913
> 
> 标签：java, swing, refresh, jpanel

我需要在 JPanel 上显示不同的图纸。我已将绘图文件放入一个数组中，但是当我使用按钮更改它时，JPanel 仅显示第一张绘图并且不会更改为下一张绘图...

我已经调用了 panel.revalidate()，但它不起作用。

这是我使用但不工作的代码段。JPanel 显示是静态的。

```
 String[] a = {"image1.txt","image2.txt","image3.txt"};
    List<String> files = Arrays.asList(a);

    public void actionPerformed(ActionEvent e) {
    if (e.getSource() == answer1){
        fileNumber++;
        //call other class for painting (files=array files, fileNumber=index of the array)  
        draw = new drawingPanel(files,fileNumber);
        panel.add(draw);
    }
    panel.revalidate();
    panel.repaint();
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T00:48:48.673

您一次只显示一张图纸吗？如果是这样，您可能想尝试使用 CardLayout，这样您就可以轻松地在图纸之间切换。有关示例，请参见[http://java.sun.com/docs/books/tutorial/uiswing/layout/card.html 。](http://java.sun.com/docs/books/tutorial/uiswing/layout/card.html)

前几天我遇到了类似的问题，试图根据用户选择的 JTabbedPane 的哪个选项卡在我的 UI 上动态显示不同的按钮。CardLayout 只是让事情变得简单的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T01:53:20.173

您可以尝试保留对您的drawingPanel 的引用并在重新添加现有drawingPanel 之前调用[remove() 。](http://java.sun.com/javase/6/docs/api/java/awt/Container.html#remove(java.awt.Component))根据[JPanel](http://java.sun.com/javase/6/docs/api/javax/swing/JPanel.html) JavaDoc，默认情况下布局为[FlowLayout](http://java.sun.com/javase/6/docs/api/java/awt/FlowLayout.html) - 它不会像您想要的那样替换图像，而是将下一个绘图面板放置在前一个绘图面板的右侧。（调整窗口大小时会发生什么？）

顺便说一句，您如何处理超出数组中最后一个图像的情况？

# web-services - 为邮政编码和月份返回 HDD 和 CDD 的天气网络服务？

> ID：670275
> 
> 赞同：2
> 
> 时间：2009-03-22T00:01:33.797
> 
> 标签：web-services

我正在寻找一个网络服务，它将接受两个参数，邮政编码和月份，并返回该邮政编码和月份的加热度日（HDD）和冷却度日（CDD）。我很肯定气象服务 (www.weather.gov) 有这些信息——我每个月都会从他们的网站手动获取。

我要问的是是否已经有一个网络服务可以做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-12-27T15:56:11.200

Degree Days.net 刚刚发布了一个商业 API： http: [//www.degreedays.net/api/](http://www.degreedays.net/api/)

您可以完全按照您提到的数据查找类型进行，还有其他选项。

（我应该提到我为运行该服务的公司工作。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-06T17:57:53.627

经过详尽的研究，我现在可以说“不”。该死。

数据可用（[http://cdo.ncdc.noaa.gov/cgi-bin/climatenormals/climatenormals.pl?directive=prod_select&subrnum=](http://cdo.ncdc.noaa.gov/cgi-bin/climatenormals/climatenormals.pl?directive=prod_select&subrnum=)），但没有人建立网络服务。

数据也可从 www.degreedays.net 获得

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-18T21:04:19.727

试着看一下 ForeCastFox 的源代码，这是一个 Firefox 的预测插件。

你可以在[这里](https://addons.mozilla.org/fr/firefox/addon/398)找到它。从那里你会看到他们如何向网络服务询问（“来自 AccuWeather.com 的国际天气预报”）

奥利维尔

# unix - 在 UNIX 中循环和组合两个文件

> ID：670282
> 
> 赞同：0
> 
> 时间：2009-03-22T00:05:18.357
> 
> 标签：unix, for-loop

对于那些有一些编程知识的人来说，这应该很简单......不幸的是我没有。

我正在尝试遍历图像标题的文本文件并将它们作为标题标签添加到 html 文件中。图片标题文件有 105 个标题（每个标题由回车分隔），图库文件的每个 a 标签上都有空白 alt 标签（设置如 alt="#"）。标题的顺序与 html 文件中图像的顺序相对应。

所以换句话说......伪代码将是：“遍历captions.txt中的每一行以及gallery.html文件中的每个alt="#"，将#替换为相应的标题。”

我在 Mac 上，所以我想使用 UNIX。

任何帮助是极大的赞赏！

谢谢，迈克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T00:17:38.063

如果所有这些`alt="#"`都在不同的行上，则可以使用 ed：

```
{
  while read cap
    do echo "/alt=\"#\"/ s//alt=\"$cap\"/"
  done < captions.txt
  echo wq
} | ed gallery.html 
```

这假设您的任何字幕都不包含斜线。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T18:38:15.593

有很多方法可以实现这一目标。 `awk`是经典的文本操作程序。（嗯，`awk`和`sed`，用于不同的目的，但`sed`在这里无济于事。）

```
awk '
    BEGIN {
        caps = ARGV[1]
        delete ARGV[1]
    }
    /#/ {
        getline cap < caps
        gsub("#", cap)
    }
    { print }
' captions.txt gallery.html 
```

您可以将其放入脚本中以避免多次键入。只需用“ `#!/usr/bin/awk -f`”开始一个纯文本文件，将“ `BEGIN ... { print }`”放在它下面，并赋予文件执行权限。

* * *

这可以简单地翻译成大多数脚本语言。珀尔：

```
#!/usr/bin/perl -p
BEGIN { open CAPS, shift }
if (/#/) {
    chomp($cap = <CAPS>);
    s/#/$cap/g;
} 
```

在 Ruby 中几乎相同：

```
#!/usr/bin/ruby
caps = IO.readlines(ARGV.shift).each {|s| s.chomp!}
while gets
    $_.gsub!(/#/, caps.shift) if $_ =~ /#/
    print
end 
```

和 Python：

```
#!/usr/bin/python
import sys
caps = [s.strip() for s in file(sys.argv[1]).readlines()]
for f in [file(s, 'r') for s in sys.argv[2:]] or [sys.stdin]:
    for s in f:
        if s.find('#') > 0: s = s.replace('#', caps.pop(0))
        print s, 
```

# php - 将 Substr 设置为大于字符串长度

> ID：670285
> 
> 赞同：3
> 
> 时间：2009-03-22T00:06:29.947
> 
> 标签：php

这更多的是底层 PHP 执行问题。

以下两种限制字符串大小的方法有哪些**优点或缺点？**

```
function max_length($string, $length) {
  return (strlen($string) > $length)?substr($string, 0, $length):$string;
}

substr($string, 0, $length); 
```

我担心的情况是**字符串小于请求的长度。** 它会导致缓冲区溢出错误吗？额外的空格？重复字符？

我唯一知道的是速度方面，`substr`至少比提供的自定义函数**快 2 倍。**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T00:10:08.767

正如您在[http://us2.php.net/substr中看到的](http://us2.php.net/substr)

```
如果给出了长度并且是正数，则返回的字符串将
最多包含从 start 开始的 length 个字符（取决于
字符串的长度）。

```

这意味着您不会得到任何额外的字符，只会得到您要求的字符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T00:11:22.600

不，没什么好担心的。如果指定的长度参数大于字符串的长度 -**整个字符串，而不是其他**- 将被返回。所以就去吧：

```
$maxString = substr($string, 0, $length); 
```

# jquery - jQuery getTime 函数

> ID：670290
> 
> 赞同：33
> 
> 时间：2009-03-22T00:08:06.773
> 
> 标签：jquery, gettime

是否可以创建一个 jQuery 函数以获取当前日期和时间？我一直在寻找文档，但到目前为止还没有找到任何东西......

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-03-22T00:19:43.830

@nickf 是正确的。但是，更准确地说：

```
// if you try to print it, it will return something like:
// Sat Mar 21 2009 20:13:07 GMT-0400 (Eastern Daylight Time)
// This time comes from the user's machine.
var myDate = new Date(); 
```

因此，如果您想将其显示为 mm/dd/yyyy，您可以这样做：

```
var displayDate = (myDate.getMonth()+1) + '/' + (myDate.getDate()) + '/' + myDate.getFullYear(); 
```

查看 Date 对象的[完整参考](http://www.w3schools.com/jsref/jsref_obj_date.asp)。不幸的是，打印出各种格式不如使用其他服务器端语言好。出于这个原因[，有](http://blog.stevenlevithan.com/archives/date-time-format)-[有](http://jacwright.com/projects/javascript/date_format)-[许多](http://www.webdevelopersnotes.com/tips/html/10_ways_to_format_time_and_date_using_javascript.php3)-在野外可用的[功能。](http://www.codeproject.com/KB/scripting/dateformat.aspx)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-07-04T12:45:27.897

**是**的，有可能：

```
jQuery.now() 
```

或者干脆

```
$.now() 
```

[请参阅 jQuery.now() 的 jQuery 文档](http://api.jquery.com/jQuery.now/)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-03-22T00:21:23.577

你不需要 jquery 来做到这一点，只需要 javascript。例如，你可以使用这个来做一个计时器：

```
<body onload="clock();">

<script type="text/javascript">
function clock() {
   var now = new Date();
   var outStr = now.getHours()+':'+now.getMinutes()+':'+now.getSeconds();
   document.getElementById('clockDiv').innerHTML=outStr;
   setTimeout('clock()',1000);
}
clock();
</script>   

<div id="clockDiv"></div>

</body> 
```

您可以在此处查看完整的参考：[http ://www.hunlock.com/blogs/Javascript_Dates-The_Complete_Reference](http://www.hunlock.com/blogs/Javascript_Dates-The_Complete_Reference)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-22T00:10:42.977

这是普通的javascript：

```
new Date() 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-06-23T14:21:21.627

### 带有 jQ​​uery 的数字时钟

```
  <script type="text/javascript" src='http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js?ver=1.3.2'></script>
  <script type="text/javascript">
  $(文档).ready(函数() {
  函数我的日期（）{
  var now = new Date();

  var outHour = now.getHours();
  if (outHour >12){newHour = outHour-12;outHour = newHour;}
  if(outHour<10){document.getElementById('HourDiv').innerHTML="0"+outHour;}
  else{document.getElementById('HourDiv').innerHTML=outHour;}

  var outMin = now.getMinutes();
  if(outMin<10){document.getElementById('MinutDiv').innerHTML="0"+outMin;}
  else{document.getElementById('MinutDiv').innerHTML=outMin;}

  var outSec = now.getSeconds();
  if(outSec<10){document.getElementById('SecDiv').innerHTML="0"+outSec;}
  else{document.getElementById('SecDiv').innerHTML=outSec;}  }
  我的约会（）;
  setInterval(function(){ myDate();}, 1000);

  });
  </脚本>
  <风格>
  正文 {字体系列：“Comic Sans MS”，草书；}
  h1 {text-align:center;background: gray;color:#fff;padding:5px;padding-bottom:10px;}
  #Content {margin:0 auto;border:solid 1px gray;width:140px;display:table;background:gray;}
  #HourDiv, #MinutDiv, #SecDiv {float:left;color:#fff;width:40px;text-align:center;font-size:25px;}
  跨度{浮动：左；颜色：#fff；字体大小：25px；}
  </style>
  <div id="clockDiv"></div>
  <h1>我的 jQery 时钟</h1>
  <div id="内容">
  <div id="HourDiv"></div><span>:</span><div id="MinutDiv"></div><span>:</span><div id="SecDiv"></分区>
  </div>

```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-09-16T10:13:14.480

这是我的方式 ：

```
 <script type="text/javascript">
$(document).ready(function() {
    setInterval(function(){currentTime("#idTimeField")}, 500);
});
function currentTime(field) {
    var now = new Date();
    now = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();
    $(field).val(now);
} 
```

这可能不是最好的，但做的工作:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-07T12:42:38.270

令人讨厌的是 Javascript 的`date.getSeconds()` *et al*不会用零`11:0:0`而不是`11:00:00`.

所以我喜欢用

```
date.toLocaleTimestring() 
```

呈现`11:00:00 AM`. 使用额外选项时请注意，某些浏览器不支持它们（Safari）

[文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleTimeString)

# design-patterns - Rehash：会计软件设计模式

> ID：670299
> 
> 赞同：22
> 
> 时间：2009-03-22T00:16:24.150
> 
> 标签：design-patterns, accounting

早在 10 月，Kristopher Johnson 就询问了[会计软件设计模式](https://stackoverflow.com/questions/163517/accounting-software-design-patterns)

他收到了几个答案，但都基本相同，都指向[Martin Fowlers Accounting Patterns](http://www.martinfowler.com/apsupp/accounting.pdf)。

我真的觉得 Fowlers 模式并不是那么有用。对于更简单的会计系统，它们似乎过于复杂，所以我正在重新讨论 Kristopher 的问题并寻找更多选项，最好是针对较小的系统。

这将主要是一个基于现金的系统，其中为用户提供类似于银行的账户。他们可以登录（基于网络）并检查余额、进行某些交易等。

我想它更像是 Paypal 或信用卡公司，而不是银行，但规模更小。它不必处理税收、摊销或您在成熟的会计系统中看到的任何事情。只是余额和交易。

那么任何人都可以指出基于会计的软件设计甚至是简单会计系统的良好实现的任何其他资源吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-02T09:32:56.827

Fowler 的模式*并不*过分复杂。他们是关于什么是需要的。您不太可能在不与最终用户或会计师发生麻烦的情况下构建更简单的东西。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-09-06T01:52:00.023

> 那么任何人都可以指出基于会计的软件设计甚至是简单会计系统的良好实现的任何其他资源吗？

[免费数字货币项目](http://www.freedmoney.org/index/)看起来对您的需求很有帮助。它提供了一个基本的交易和平衡框架。它有意简单和抽象，因此可以提供有用的设计见解，特别是如果您想测试新颖的想法。

[Cyclos](http://project.cyclos.org/)更实用。它涵盖了用户帐户和交易。

[MyBanco](http://www.mybanco.org/)是另一个开源银行系统，支持用户银行账户和基于 Web 的访问。它可以与虚拟货币和真实货币一起使用。

所有这些都是开源的，因此您可以直接查看文档、架构和代码。

顺便说一句，如果你真的只对余额和交易感兴趣，那么听起来任何与声誉、业力或积分系统相关的模式或项目都可能有相关的重叠......

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-09-06T02:31:32.107

当我实施会计时，它是日记帐、交易和帐户以及帐户类型的典型模型。

```
tblTransactions
    - Amount
    - AccountID1
    - AccountID2
    - Type [CR/DR]
    - DateEntered 
```

然后我也有一个`tblJournals`明显的基础上对交易进行分组。您还可以添加 JournalTypes，它包含对期刊类型的一般描述，因此您可以检测到好东西（reverals 等）。

这很好，因为这种模型下的逆转是微不足道的。您可以为您的日记收集所有交易，并交换类型。

tblTransactions 有一个触发器，触发器根据类型更新针对特定帐户的“CalculatedBalance”。然后，您还可以在给定时间段内运行报告，依此类推。

它不需要太多的会计知识来实现​​这一点，而且简单而有效。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T23:54:26.283

[谷歌搜索“两阶段提交”](http://www.google.com/search?q=two+phase+commit)

本身不是设计模式，但您需要确保 **“将 $amount 从 $account1 转移到 $account2”之类**的操作在没有匹配的“存款”的情况下*永远不会*“提款”......即如果电源在“存款”完成，“提款”回滚（撤消）

可提交事务由可撤消（可回滚）子事务组成...

1.  获得所需的权限：琐碎的拒绝，“资金不足”
2.  开始“两阶段提交”
3.  添加子交易
4.  提交或回滚

*警告：发明 BCD 数学是为了防止 Base 10 数学中的舍入错误。你没有提到国际问题，但你需要定点或“大精度”数学、货币转换等等……*

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-03-22T18:55:57.423

将钱存储为美分（整数）而不是美元（浮点数）。这不是一个设计，但它可能更有用。

# iphone - 从按钮调用 UIWebView 上的 stringByEvaluatingJavaScriptFromString 时崩溃

> ID：670300
> 
> 赞同：1
> 
> 时间：2009-03-22T00:16:37.487
> 
> 标签：iphone

我找不到任何文档来确认这一点，但似乎您只能在 UIWebView 委托的重写方法中调用方法**stringByEvaluatingJavaScriptFromString**。谁能证实这一点？

这是我尝试过的。我在视图上设置了一个按钮，将它链接到我的视图控制器上的一个方法，并确保它工作正常。我的视图上也有一个 UIWebView 控件。如果我在模拟器或 iPhone 上运行该项目，则没有问题。然后我将此代码添加到按钮的方法中。

```
[theWebView stringByEvaluatingJavaScriptFromString:@"alert('Hi there!');"]; 
```

当我运行项目时，我可以单击该按钮并看到“您好”提示，然后我可以单击“确定”将其关闭。通常 4-5 秒后模拟器崩溃。我偶尔会看到`"__TERMINATING_DUE_TO_UNCAUGHT_EXCEPTION__"`错误，但并非始终如一；有时没有错误。它也不总是第一次崩溃。有时我转到另一个页面，然后再试一次，它就崩溃了。

如果我将相同的代码放在 webPageDidFinishLoad 事件中，它可以正常工作。但我希望在用户需要时调用代码，以便该事件不适合我的需要。

如果您有任何想法，我愿意接受解决方法？提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-22T18:48:07.437

我仍然不知道这不起作用的确切原因，但我发现我可以重写我的代码以在 UIWebView 委托方法期间被调用。

# c - 如何在C中搜索图结构中的特定节点？

> ID：670301
> 
> 赞同：0
> 
> 时间：2009-03-22T00:16:38.360
> 
> 标签：c, linked-list, structure, graph-theory, traversal

并不是说我有时间适当地讨论这个以得出结论并调整我的代码，因为学校项目的第一阶段（第三阶段）是在 24 小时内，但至少我需要知道我是否做出了正确的决定。

我正在使用链表，这是我的结构：

```
typedef struct sCity {
    int cityID;
    char *cityName;

    struct sCityLink *links;
    struct sCity *next;
} nCity, *City;

typedef struct sCityLink {
    City cityLinkParent;
    City cityLinkTo;

    struct sCityLink *next;

} nCityLink, *CityLink; 
```

基本上，我有很多城市，这些城市都连接在一起，就像一个图表。例如，A、B、C、D 和 E 它们按此顺序插入到结构**City**中。然后，我将 A 连接到 B，C 和 D，B 连接到 C，D，E，C 连接到 D，E 和 D 连接到 E。

现在，假设我需要去E市。这是链表中的最后一个，并且需要时间遍历链表。也许不是在这个有 5 个城市的例子中，但在真正的应用程序中，我应该至少支持 10,000 个城市。但是最短的路线是从A（这是起点）从C到E（或者可以是ADE或ABE，没关系）。

我的结构是否允许我找到从 A 到 E 的最短路径，而无需一一遍历整个链表？如果没有，我做错了什么？

如果是，我该怎么做？我不知道我怎么能找到这样的路径......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T00:27:04.937

您可以使用称为[广度优先搜索](http://en.wikipedia.org/wiki/Breadth-first_search)(BFS) 的算法。您需要在每个节点上实现一个“颜色”标志才能使用它。请注意，此算法仅在您的边缘**未加权**时才有效——如果连接了 2 个城市，则它们的距离相等。如果边缘有重量（看起来不像它们），你需要像[Dijkstra's Algorithm](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)或[A*](http://en.wikipedia.org/wiki/A*)这样的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T00:29:49.030

有两个不同的问题 - 一个，您可能想要找到城市 ID 的城市指针（例如“E”）。你不能用你的结构在少于线性的时间内做到这一点；如果您需要更快，请使用哈希表或二叉搜索树。

第二，你想找到两个给定城市之间的路径。为此，您可能会使用 BFS 算法，您的数据结构就可以了。请注意，BFS 需要 O(V+E) 时间，其中 V 和 E 是诱导子图的顶点和边数，其顶点到起始顶点的距离不大于从起始顶点到结束顶点的距离。这意味着在最坏的情况下，它比遍历城市列表需要更多的时间。

# django - 在apache中设置标题

> ID：670307
> 
> 赞同：0
> 
> 时间：2009-03-22T00:20:33.047
> 
> 标签：django, apache, static, content-type

我正在尝试在 django 应用程序中提供静态文件以供下载，我想我会将静态文件放在 /media/files 中，并让 Apache 将 content-type 标头设置为 application/octet-stream （要下载的文件将是word文件，但我稍后会制定详细信息）。

为此，我激活了 mod_headers，然后在 apache 配置中这样做：

```
<位置“/媒体/文件”>
    标头集 Content-Type "application/octet-stream"
</位置>

```

完成此操作后，我重新启动了 apache 并尝试了一个示例文件，但它不起作用，我仍然在内容类型中获得 text/plain，并且浏览器不会提示我下载任何内容。

顺便说一句，我知道建议对静态文件使用不同的 Web 服务器，但我对要部署的服务器没有太多控制，它只能是带有 mod_python 的 Apache。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T06:12:02.283

可能存在许多问题（它需要比您提供的更多信息来追踪一些 apache 配置问题），但这里有一些想法：

*   您是否绝对确定此代码段已应用于正确的文件（例如，如果有多个虚拟服务器，而您将其卡在错误的文件中，嗯..）
*   您是否正在进行重写以防止这被视为匹​​配？
*   您是否在其他地方设置了 Content-Type 标头？
*   您是否正在进行内容仲裁？视情况而定，这可能会覆盖您在标题中所做的任何事情。

您可能会尝试的一件事是添加一些其他标题并查看它是否会返回。另外，尝试使用 telnet 自己发出请求，或者减少您和服务器之间的事情的数量。使用日志文件。他们在那里帮助你。祝你好运。

# c++ - 矢量的替代品

> ID：670308
> 
> 赞同：97
> 
> 时间：2009-03-22T00:20:59.583
> 
> 标签：c++, stl, vector, boolean

正如（希望）我们都知道的那样，`vector<bool>`它完全被破坏了，不能被视为 C 数组。获得此功能的最佳方法是什么？到目前为止，我想到的想法是：

*   使用 a`vector<char>`代替，或
*   使用包装类并拥有`vector<bool_wrapper>`

大家是怎么处理这个问题的？我需要这个`c_array()`功能。

作为一个附带问题，如果我不需要该`c_array()`方法，如果我需要随机访问，解决此问题的最佳方法是什么？我应该使用双端队列还是其他东西？

编辑：

*   我确实需要动态调整大小。
*   对于那些不知道的人，`vector<bool>`是专门的，因此每个`bool`需要 1 位。因此，您不能将其转换为 C 样式的数组。
*   我想“包装器”有点用词不当。我在想这样的事情：

当然，`my_bool`由于可能的对齐问题，我必须阅读 a :(

```
struct my_bool
{
    bool the_bool;
};
vector<my_bool> haha_i_tricked_you; 
```

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-22T00:29:16.613

[`std::deque`](http://en.cppreference.com/w/cpp/container/deque)如果您不需要阵列，请使用，是的。

`vector`否则，请使用不专注于的替代方案`bool`，例如[Boost Container](http://www.boost.org/doc/libs/1_48_0/doc/html/container/Cpp11_conformance.html#container.Cpp11_conformance.Vector_bool)中的替代方案。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-22T01:20:20.830

这是一个有趣的问题。

如果您需要 std::vector 如果它不是专门的，那么它可能适用于您的情况：

```
#include <vector>
#include <iostream> 
#include <algorithm>

class Bool
{
public:

    Bool(): m_value(){}
    Bool( bool value ) : m_value(value){}

    operator bool() const { return m_value; }

    // the following operators are to allow bool* b = &v[0]; (v is a vector here).
    bool* operator& () { return &m_value; }
    const bool* operator& () const { return &m_value; }

private:

    bool m_value;

};

int main()
{
    std::vector<Bool> working_solution(10, false);

    working_solution[5] = true;
    working_solution[7] = true;

    for( int i = 0; i < working_solution.size(); ++i )
    {
        std::cout<< "Id " << i << " = " << working_solution[i] << "(" <<(working_solution[i] ? "true" : "false") << ")" <<std::endl; // i used ? : to be sure the boolean evaluation is correct
    }

    std::sort( working_solution.begin(), working_solution.end());
    std::cout<< "--- SORTED! ---" << std::endl;

    for( int i = 0; i < working_solution.size(); ++i )
    {
            bool* b = &working_solution[i]; // this works!

        std::cout<< "Id " << i << " = " << working_solution[i] << "(" << (working_solution[i] ? "true" : "false") << ")" <<std::endl; // i used ? : to be sure the boolean evaluation is correct
    }

    std::cin.get();
    return 0;
} 
```

我用 VC9 试过这个，它似乎工作正常。Bool 类的想法是通过提供相同的行为和大小（但不是相同的类型）来模拟 bool 类型。几乎所有的工作都是由 bool 运算符和这里的默认复制构造函数完成的。我添加了一种排序，以确保它在使用算法时做出假设。

不确定它是否适合所有情况。如果它适合您的需求，那么它会比重写类似矢量的类更少工作......

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-03-22T00:30:12.697

取决于你的需要。我会去`std::vector<unsigned char>`。如果您只使用功能的子集，编写包装器可能会很好，否则它将成为一场噩梦。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-04-12T03:13:09.800

> 大家是怎么处理这个问题的？我需要 c_array() 功能。

[`boost::container::vector<bool>`](http://www.boost.org/doc/libs/1_53_0/doc/html/container/Cpp11_conformance.html#container.Cpp11_conformance.Vector_bool)：

> **vector** < **bool** > 特化一直存在很大问题，并且曾多次尝试将其从标准中弃用或删除，但均未成功。`Boost.Container`没有实现它，因为有一个优越的**Boost.DynamicBitset**解决方案。
> 
> ...
> 
> 所以**boost::container::vector::iterator**返回真正的 bool 引用并作为一个完全兼容的容器工作。如果您需要**boost::container::vector** < **bool** > 功能的内存优化版本，请使用**Boost.DynamicBitset**。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-22T09:03:25.037

考虑使用向量< int >。一旦您通过了编译和类型检查，bool 和 int 都只是机器字（编辑：显然这并不总是正确的；但在许多 PC 架构上都是正确的）。如果您想在没有警告的情况下进行转换，请使用“bool foo = !!bar”，它将零转换为假，非零转换为真。

vector< char > 或类似的将使用更少的空间，尽管在某些情况下它也有可能（非常小的）速度受到影响，因为字符小于机器字长。我相信，这是使用整数而不是字符来实现布尔值的主要原因。

如果你真的想要干净的语义，我也喜欢制作你自己的布尔类的建议——看起来像一个布尔，行为像一个布尔，但愚弄了模板专业化。

此外，欢迎加入希望从 C++ 标准中删除 vector<bool> 专业化（用 bit_vector 代替它）的人的俱乐部。这是所有酷孩子们闲逛的地方:)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-22T01:52:21.860

这个问题已经在 comp.lang.c++.moderated 上[讨论过了。](http://groups.google.ru/group/comp.lang.c++.moderated/browse_thread/thread/b8d6dd59dfb295c0/e23e0f606d64550a)建议的解决方案：

*   您自己的分配器（基于`std::allocator`）和自己的向量专业化；
*   使用`std::deque`（早在 S. Mayers 的一本书中就推荐过）——但这不符合您的要求；
*   制作 POD`bool`包装器；
*   使用大小相同的东西（`char`/ /等）代替； `int``bool``bool`

同样早些时候，我看到了标准委员会的提案 - 引入宏（类似于`STD_VECTOR_BOOL_SPECIAL`）以禁止这种专业化 - 但 AFAIK 这个提案没有在 stl 实现中实现，也没有被批准。

看来你的问题没有办法很好地做到这一点......也许在 C++0x 中。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-06-23T21:19:30.647

最简单的答案是使用`vector<struct sb>`where `sb`is `struct {boolean b};`。然后你可以说`push_back({true})`。看起来不错。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-10-05T08:21:45.910

我首选的解决方法是一个`vector`具有基础类型的作用域枚举`bool`。`vector<bool>`如果委员会没有对其进行专门化，这将非常接近我们的情况。

```
enum class switch_status : bool { ON, OFF };

static_assert( sizeof( switch_status ) == 1 );

::std::vector<switch_status> switches( 20, switch_status::ON );

static_assert( ::std::is_same_v< decltype( switches.front() ), switch_status &> );
static_assert( ::std::is_same_v< decltype( switches.back()  ), switch_status &> );
static_assert( ::std::is_same_v< decltype( switches[ 0 ]    ), switch_status &> ); 
```

您将对接受 cast to/from 的智慧有自己的看法`bool`：

```
enum class switch_status : bool { OFF = false, ON = true };

static_assert( static_cast< bool          >( switch_status::ON  ) == true               );
static_assert( static_cast< bool          >( switch_status::OFF ) == false              );
static_assert( static_cast< switch_status >( true               ) == switch_status::ON  );
static_assert( static_cast< switch_status >( false              ) == switch_status::OFF ); 
```

# wpf - Visual Studio 中奇怪的 WPF 错误

> ID：670311
> 
> 赞同：0
> 
> 时间：2009-03-22T00:22:30.187
> 
> 标签：wpf

有谁知道“无法创建 UserControl 实例”错误的原因。在我看来，它完全是自发发生的，例如在我在节点之后添加空格或更改制表之后。也许这是某种VS错误？

这里是控件。此配置实际上引发了错误

```
<UserControl x:Class="ShortcutsPrototype.KeyboardShortcutsTreePanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ShortcutsPrototype="clr-namespace:ShortcutsPrototype">

    <Grid Margin="3,3,3,3">
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition Width="80" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="30" />
        </Grid.RowDefinitions>

        <ShortcutsPrototype:KeyboardShortcutsTreeView />
        <Button Grid.Row="1" Margin="3,3,3,3" Grid.Column="1" HorizontalAlignment="Stretch">Reset</Button>
    </Grid>
</UserControl>

<UserControl x:Class="ShortcutsPrototype.KeyboardShortcutsTreeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ShortcutsPrototype="clr-namespace:ShortcutsPrototype"
    Height="300" Width="300">

    <Grid>
        <TreeView>
            <TreeViewItem HorizontalContentAlignment="Stretch">
                <TreeViewItem.Header>
                    <ShortcutsPrototype:KeyboardShortcutsTreeViewEntry x:Name="generalTreeViewEntry" Title="General" />
                </TreeViewItem.Header>

                <TreeViewItem HorizontalContentAlignment="Stretch">
                    <TreeViewItem.Header>
                        <ShortcutsPrototype:KeyboardShortcutsTreeViewEntry x:Name="generalNewFileTreeViewEntry" Title="New File" ShortcutKey="Ctrl+N"  />
                    </TreeViewItem.Header>
                </TreeViewItem>

                <TreeViewItem HorizontalContentAlignment="Stretch">
                    <TreeViewItem.Header>
                        <ShortcutsPrototype:KeyboardShortcutsTreeViewEntry x:Name="generalOpenFileTreeViewEntry" Title="Open File" ShortcutKey="Ctrl+O"  />
                    </TreeViewItem.Header>
                </TreeViewItem>

                <TreeViewItem HorizontalContentAlignment="Stretch">
                    <TreeViewItem.Header>
                        <ShortcutsPrototype:KeyboardShortcutsTreeViewEntry x:Name="generalSaveFileTreeViewEntry" Title="Save File" ShortcutKey="Ctrl+S"  />
                    </TreeViewItem.Header>
                </TreeViewItem>

                <TreeViewItem HorizontalContentAlignment="Stretch">
                    <TreeViewItem.Header>
                        <ShortcutsPrototype:KeyboardShortcutsTreeViewEntry x:Name="generalSaveAsFileTreeViewEntry" Title="Save File As.." ShortcutKey="Ctrl+Shift+S"  />
                    </TreeViewItem.Header>
                </TreeViewItem>

            </TreeViewItem>
            <TreeViewItem HorizontalContentAlignment="Stretch">
                <TreeViewItem.Header>
                    <ShortcutsPrototype:KeyboardShortcutsTreeViewEntry x:Name="debugerTreeViewEntry" Title="Debuger" />
                </TreeViewItem.Header>
            </TreeViewItem>
            <TreeViewItem HorizontalContentAlignment="Stretch">
                <TreeViewItem.Header>
                    <ShortcutsPrototype:KeyboardShortcutsTreeViewEntry x:Name="refactoringTreeViewEntry" Title="Refactoring" />
                </TreeViewItem.Header>
            </TreeViewItem>
        </TreeView>
    </Grid>
</UserControl>

<UserControl x:Class="ShortcutsPrototype.KeyboardShortcutsTreeViewEntry"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Height="25">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition  />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition Width="100" />
        </Grid.ColumnDefinitions>
        <Label x:Name="titleLabel" Grid.Column="0"></Label>
        <Label x:Name="shortcutLabel" Grid.Column="1"></Label>
    </Grid>
</UserControl> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T00:59:59.787

也许您的 CodeBehind 文件中的某些内容正在引发异常。你检查过吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T02:06:18.627

我发现 Visual Studio 在使用 WPF 用户控件时遇到了很多困难。

我唯一能看到的是它似乎使用了控件的最新编译版本。通常，构建解决方案将修复我遇到的错误。有时，如果我有多个项目，我必须一个一个地手动构建它们。

# asp.net-mvc - 你能创建一个 int 或 enum 类型的强类型 ASP.NET MVC ViewUserControl 吗？

> ID：670317
> 
> 赞同：4
> 
> 时间：2009-03-22T00:26:44.063
> 
> 标签：asp.net-mvc, viewusercontrol

我希望创建一个可重用的 ASP.NET MVC ViewUserControl，它是强类型的枚举。

这可以做到吗？当我尝试它时，它说 ViewUserControl 可以接受的强类型只能是引用类型:(

这也意味着我不能将 int 作为 TModel 传递。

我为什么要这样做？我在我网站的各个地方，我正在显示一个依赖于枚举的简单图像。因此，我不想在多个地方复制该逻辑，而是希望拥有这个可重复使用的 ViewUserControl 并传入枚举。

例如。

```
public enum AnimalType
{
   Cat,
   Dog
}

// .. now code inside the view user control ...
switch (animalType)
{
    case AnimalType.Cat: source = "cat.png"; text="cute pussy"; break;
    ... etc ...
}

<img src="<%=Url.Content("~/Images/" + source)%>" alt="<%=text%>" /> 
```

我猜解决方案是不创建强类型的 ViewUserControl （因为 TModel 类型只能是类型类），然后执行以下操作..

```
<% Html.RenderPartial("AnimalFileImageControl", animalType); %> 
```

并在 ViewUserControl ...

```
AnimalType animalType = (AnimalType) ViewData.Model;
    switch (animalType)
    { ... etc ... } 
```

干杯:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T00:46:00.443

好吧，你可以有：

```
public sealed class Box<T> where T : struct {
    public Box(T value) { Value = value; }
    public T Value { get; private set; }
    public static explicit operator T(Box<T> item) {
        return item.Value; } // also check for null and throw an error...
    public static implicit operator Box<T>(T value) {
        return new Box<T>(value); }
} 
```

and use `Box<int>`, `Box<MyEnum>`, etc - but personally, I expect it would be easier to use an untyped view and simply cast.

# jquery - jQuery forms.js ajaxSubmit 执行后的默认表单提交行为

> ID：670320
> 
> 赞同：4
> 
> 时间：2009-03-22T00:27:40.283
> 
> 标签：jquery, forms, plugins, binding, jquery-plugins

我正在使用 jQuery 表单插件来绑定同一页面上两个表单的提交事件，以便将它们提交到单独的 PHP 脚本，这些脚本将标记返回到页面上的单独 div。

一种形式刷新下一种形式。我使用“实时”，因此每个表单在刷新时都会重新绑定其事件：

```
$(document).ready(function() {
    /* Form 1 */
    $('#frmSearch').live('submit', function() {
        $(this).ajaxSubmit({
            target: '#divResults',
            url:    'search_div.php'
        });
        return false;
    });
    /* Form 2 */
    $('#frmResults').live('submit', function() {
        $(this).ajaxSubmit({
            target: '#divLookup',
            url:    'lookup_div.php',
        });
        return false;
    });
}); 
```

到现在为止还挺好。每个表单都可以使用 ajax 一次又一次地提交，并且所有绑定从一次提交到下一次都存在。

当我尝试绑定第三个表单并在第二个表单的“成功”选项中触发其提交事件时，就会出现问题：

```
/* Form 2 */
$('#frmResults').live('submit', function() {
    $(this).ajaxSubmit({
        target: '#divLookup',
        url:    'lookup_div.php',
        success: function(responseText){
            $('#frmLookup').submit();
        }
    });
    return false;
});
/* Form 3 */
$('#frmLookup').live('submit', function() {
    $(this).ajaxSubmit({
        target: '#divMappings',
        url:    'mapped_items_div.php',
    });
    return false;
}); 
```

当我这样做时，ajaxSubmit 成功执行，但随后表单的默认提交也被执行，导致页面重新加载。请注意，我确实包含了“return false”；禁止表单的默认提交，但由于某种原因它仍然提交。

我发现，如果我在 Form 2 的成功函数中使用与 Form 3 的“live”相同的选项“绑定”Form 3 的“提交”事件，则不会执行表单的默认提交。不过，这是多余的，如果可以的话，我想避免这样做。

如何抑制 Form 3 的默认提交行为？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T01:01:22.043

不确定它是否与您的问题有关，但[`live()`不支持 " `submit`" 事件](http://docs.jquery.com/Events/live)：

> 目前不支持：`blur, focus, mouseenter, mouseleave, change, submit`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T00:47:50.330

我知道它应该是一样的，但由于这似乎是一个非常奇怪的行为，我会尝试替换

```
$('#frmLookup').submit(); 
```

为了

```
$('#frmLookup').trigger('submit'); 
```

看看这是否改变了什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T06:38:16.587

谢谢，新月新鲜，让我走上正轨。对于我的解决方案，我修改了脚本以仅打印嵌套在表单中的元素，而不是表单本身及其内容。然后我将每个表单的“目标”更改为下一个表单，而不是包含下一个表单的 div。这消除了为每个表单重新绑定提交事件的需要，因为前一个表单的 ajax 函数只是替换其内部元素，而不是完全“刷新”它。

我还决定取消表单插件并简单地使用“.serialize()”和“.ajax”是合适的，如 Paolo Bergantino[所示](https://stackoverflow.com/questions/550370/jquery-form-returned-on-success-needs-re-binding)。

我的最终产品看起来像这样：

```
/* Form 1 */
$('#frmSearch').bind('submit', function() {
    var formdata = $(this).serialize();
    $.ajax({
        url:    'result_form.php',
        data:   formdata,
        success: function(responseText){
            $('#frmResults').html(responseText);
        }
    });
    return false;
});

/* Form 2 */
$('#frmResults').bind('submit', function() {
    var formdata = $(this).serialize();
    $.ajax({
        url:    'lookup_div.php',
        data:   formdata,
        success: function(responseText){
            $('#frmLookup').html(responseText);
            $('#frmLookup').trigger('submit');
        }
    });
    return false;
});

/* Form 3 */
$('#frmLookup').bind('submit', function() {
    var formdata = $(this).serialize();
    $.ajax({
        url:    'mapped_items_div.php',
        data:   formdata,
        success: function(responseText){
            $('#divMappings').html(responseText);
        }
    });
    return false;
}); 
```

# php - 在 php 中读取 Windows Live Contacts Api 时遇到问题

> ID：670321
> 
> 赞同：0
> 
> 时间：2009-03-22T00:28:54.633
> 
> 标签：php, contacts, windows-live

我正在使用[Windows Live Contacts api](http://msdn.microsoft.com/en-us/library/bb463989.aspx)在 PHP 5 应用程序中创建查找朋友功能。我能够得到很好的结果，但它被编码为“放气”。我曾尝试使用 gzuncompress 解压缩，但它返回 false。如果有人有在 php 5 中使用这个 api 的经验并且可以提供帮助，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T00:35:41.607

好的，我希望我可以删除这个问题。我使用了错误的函数（或者更具体地说，Zend 框架中有一个错误，它使用了 gzuncrompress，而它应该使用 gzinflate）。

# sql - SQL查询 - 如何有效地获取未读消息

> ID：670327
> 
> 赞同：7
> 
> 时间：2009-03-22T00:33:50.537
> 
> 标签：sql

如何最好地收集给定用户尚未阅读的消息？

现有表

```
Message table
----------------------------------
id    title    body    sentAt

User table
----------------------------------
id    username

Read Messages table
----------------------------------
user_id    message_id 
```

我在想类似的东西

```
select 
  m.id, m.title, m.sentAt, u.username
from 
  message m,
  [user] u
where 
  u.id = 1 and -- @userId parameter
  m.id not in 
    (select r.message_id from read_messages r where r.user_id = u.id) 
```

不幸的是，对我来说，我不太了解执行计划。/亚当

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-22T00:54:25.680

*建议另一种方法：*

我早些时候在工作中遇到了完全相同的问题。我浪费了一周的时间试图找出最好的方法来做到这一点。正如您所做的那样，我最终创建了一个连接表，但该表仅包含*未读*消息，而不是跟踪已*读*消息。

# 因为

1.  现状是“每个人都阅读了他们所有的消息”。
2.  获取未读消息（或其计数）应该尽可能快。
3.  现状应该是系统中压力最小的状态。

现在，如果我要跟踪每个人都读过的所有消息，那么数据库中的混乱会迅速增长（*用户***消息*行），在更小的应用程序中很容易导致数千行“死重”。如果消息的生命周期是不确定的，这个问题就会被夸大——您可能会跟踪多年前的消息状态。

如果跟踪相反的情况，您的“未读消息”表仅包含少数行，并且随着用户阅读的每条消息而减少。此外，获取未读消息的数量就像“ `SELECT COUNT(*) FROM unread WHERE user = foo`”一样简单。

# 但

作为一切，这是一个权衡。虽然阅读的计算速度几乎与计算速度一样快，但写作却是一件苦差事。对于每条书面消息，您需要在此连接表中插入一个条目。此外，如果多人可以阅读同一封邮件，您需要为每个收件人插入一行。如果收件人是隐式的（例如，只给出了用户组的名称，或者甚至具有诸如“有权访问此事物的任何人”之类的标准），则创建新消息将变得更加复杂。

但我觉得这是一个公平的妥协。

YMMV，HTH。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T00:43:02.337

NOT IN 非常昂贵。相反，您可以执行以下操作：

```
SELECT
  m.id, m.title, m.sentAt
FROM
  message m
  LEFT JOIN [Read Messages] rm
    ON m.message_id = rm.message_id AND rm.user_id = @userID
WHERE
  rm.user_id IS NULL 
```

如果您有正确的索引，这应该会快得多。

您正在获取该用户的所有消息并 LEFT JOINing 阅读消息。然后，在 WHERE 子句中，您要求该消息的 user_id 为 NULL，这意味着用户尚未阅读它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T21:02:05.527

HP 的替代建议很可能适合您。但是，如果不是，我建议在您的环境中使用 NOT EXISTS 而不是 LEFT JOIN。

至少在 MS SQL 上，它会提供一个稍微便宜的查询计划，因为它不需要最后一次过滤（user_id IS NULL）

```
SELECT  ...
FROM    message m
WHERE   NOT EXISTS (
    SELECT 1
    FROM    read_messages rm
    WHERE   rm.usr_id = ...
    AND rm.msg_id = m.msg_id
) 
```

# shell - 无法理解命令 find 的语法

> ID：670329
> 
> 赞同：11
> 
> 时间：2009-03-22T00:35:42.950
> 
> 标签：shell, find

find 命令似乎与其他 Unix 命令不同。

**为什么在以下命令的末尾会有空的大括号和向后闪烁？**

```
find * -perm 777 -exec chmod 770 {} \; 
```

我找到了大括号的一个原因，但没有找到向后闪光的原因。

大括号显然是用于路径

> 与 -exec 相同，除了 ``{}'' 被替换为每次调用实用程序时尽可能多的路径名

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-22T00:42:53.603

-exec 命令后面可以跟任意数量的参数，这些参数构成要为找到的每个文件执行的命令。需要有某种方法来识别最后一个参数。这是什么 \; 做。请注意，在 -exec 开关之后可能会出现其他内容：

```
find euler/ -iname "*.c*" -exec echo {} \; -or -iname "*.py" -exec echo {} \; 
```

（这会在 euler 目录中找到所有 c 文件和 python 文件。）

exec 不需要完整命令包含在引号内的原因是，在大多数情况下，这将需要转义命令内的大量引号。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-10-18T12:25:00.810

`{}`in的字符串`find`替换为当前文件的路径名。

分号用于终止`find`实用程序调用的 shell 命令。

它需要被转义或引用，因此它不会被 shell 解释，因为`;`它是 shell 使用的特殊字符之一（列表运算符）。

另请参阅：[为什么 find 命令的 -exec 选项需要反斜杠和分号？](https://stackoverflow.com/questions/20913198/why-are-the-backslash-and-semicolon-required-with-the-find-commands-exec-optio)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-22T00:44:19.807

需要（转义）分号，以便“find”可以告诉执行程序的参数在哪里结束（如果有的话）以及“find”的附加参数开始。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T00:44:27.997

我建议您改为这样做

```
find . -perm 777 -print0 | xargs -0 chmod 770 
```

“xargs”表示获取查找结果并一次将 20 个输入到以下命令。

# c# - 如何改变这种设计以避免沮丧？

> ID：670331
> 
> 赞同：3
> 
> 时间：2009-03-22T00:37:26.360
> 
> 标签：c#, design-patterns, overloading, downcast

假设我有一个对象集合，它们都继承自一个基类。就像是...

```
 abstract public class Animal
    {

    }

    public class Dog :Animal
    {

    }

    class Monkey : Animal
    {

    } 
```

现在，我们需要喂养这些动物，但不允许它们知道如何喂养自己。如果可以，答案将很简单：

```
foreach( Animal a in myAnimals )
{
   a.feed();
} 
```

然而，他们不知道如何养活自己，所以我们想做这样的事情：

```
 class Program
{
    static void Main(string[] args)
    {
        List<Animal> myAnimals = new List<Animal>();

        myAnimals.Add(new Monkey());
        myAnimals.Add(new Dog());

        foreach (Animal a in myAnimals)
        {
            Program.FeedAnimal(a);
        }
    }

    void FeedAnimal(Monkey m) {
        Console.WriteLine("Fed a monkey.");
    }

    void FeedAnimal(Dog d)
    {
        Console.WriteLine("Fed a dog.");
    }

} 
```

当然，这不会编译，因为它会迫使一个沮丧。

感觉好像有一种设计模式或其他一些带有泛型的解决方案可以帮助我解决这个问题，但我还没有把手指放在它上面。

建议？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-22T00:41:34.293

在 Linq 惯用语中使用的经过检查的 downcast 是完全安全的。

```
foreach (Monkey m in myAnimals.OfType<Monkey>())
    Program.FeedAnimal(m); 
```

或者您可以使用访问者模式。访问者对象知道所有类型的动物，因此它对`FeedAnimal`每种类型都有一个功能。您将访问者对象传递给动物的`Feed`函数，它会回调正确的`FeedAnimal`方法，传递`this`.

为了使其可扩展，您需要一个`Dictionary`动物喂食器：

```
private static Dictionary<Type, Action<Animal>> _feeders; 
```

要注册喂食动作，您首先要执行以下操作：

```
_feeders[typeof(Monkey)] = 
    a =>
    {
        Monkey m = (Monkey)a;

        // give food to m somehow
    }; 
```

但是有一个沮丧，你也必须在密钥中给出正确的类型。所以做一个帮手：

```
public static void AddFeeder<TAnimal>(Action<TAnimal> feeder) where TAnimal : Animal
{
    _feeders[typeof(TAnimal)] = a => feeder((TAnimal)a);
} 
```

这捕获了模式，因此您可以完全安全地重用它：

```
AddFeeder<Monkey>(monkey => GiveBananasTo(monkey));
AddFeeder<Dog>(dog => ThrowBiscuitsAt(dog)); 
```

然后当你需要喂动物时，使用这个扩展方法：

```
public static void Feed(this Animal a)
{
    _feeders[a.GetType()](a);
} 
```

例如

```
a.Feed(); 
```

因此 _feeders 将是与扩展方法相同的静态类中的私有静态字段，以及该`AddFeeder`方法。

**更新：**所有代码都在一个地方，还支持继承：

```
public static class AnimalFeeding
{
    private static Dictionary<Type, Action<Animal>> _feeders 
        = new Dictionary<Type, Action<Animal>>();

    public static void AddFeeder<TAnimal>(Action<TAnimal> feeder) 
        where TAnimal : Animal
    {
        _feeders[typeof(TAnimal)] = a => feeder((TAnimal)a);
    }

    public static void Feed(this Animal a)
    {
        for (Type t = a.GetType(); t != null; t = t.BaseType)
        {
            Action<Animal> feeder;
            if (_feeders.TryGetValue(t, out feeder))
            {
                feeder(a);
                return;
            }
        }

        throw new SystemException("No feeder found for " + a.GetType());
    }
} 
```

您还可以通过每种类型支持的接口循环`t`- 基本上是相同的想法，所以我在这里保持示例简单。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T00:42:09.097

这是OOD中的一个经典问题。如果你的类（动物）是固定的，你可以使用[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)。如果您的操作集（例如饲料）有限，您只需向 Animal 添加一个方法 feed()。如果这些都不成立，就没有简单的解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-22T01:10:57.530

首先，面向对象设计的要点之一是对象将其数据与作用于该数据的行为捆绑在一起（即“动物知道如何喂养自己”）。所以这是“医生，当我这样做时很痛！ - 所以不要那样做”的情况之一。

也就是说，我相信这个故事比你描述的要多，而且你有充分的理由不能做“正确的”OOD。所以你有几个选择。

您可以让 FeedAnimal(Animal a) 方法使用反射来查找动物的类型。基本上你是在 FeedAnimal 方法中做你的多态性。

```
static void FeedAnimal(Animal a)
{
    if (a is Dog)
    {
        Console.WriteLine("Fed a dog.");
    }
    else if (a is Monkey)
    {
        Console.WriteLine("Fed a monkey.");
    }
    else
    {
        Console.WriteLine("I don't know how to feed a " + a.GetType().Name + ".");
    }      
} 
```

一种更面向对象但更复杂的方法是使用其他人建议的访问者模式。这对于有经验的开发人员来说更优雅，但对于更多的新手程序员来说可能不太明显和可读性。您喜欢哪种方法可能取决于您拥有多少不同的动物类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T00:43:03.680

只有当你有一个“狗列表”并且想要调用一个带有“动物列表”（即`List<T> where T : Animal`）参数的方法时，泛型才会有帮助 - 我认为它在这里没有帮助。

我怀疑您将需要一个[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)......一些*可能*知道如何喂养给定类型动物的对象，并继续尝试它们，直到找到一个知道如何......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T00:42:06.163

由于不允许动物喂养自己或其他动物，因此您别无选择，只能创建一个拥有私有方法来喂养动物的“所有者”或“饲养员”或“看护人”类。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-22T00:45:43.860

您可以在动物类中包含一个成员变量，该变量将识别动物的类型，然后让 feed 函数读取它并根据它产生不同的结果。

# perl - 哪些 Perl 模块适合编写 RESTful Web API 客户端？

> ID：670333
> 
> 赞同：18
> 
> 时间：2009-03-22T00:40:10.800
> 
> 标签：perl, rest, module

我将编写一个应用程序，它对从 RESTful Web 服务获取的数据进行一些计算，然后输出到文本文件和/或 HTML 页面。Web 服务是基于 HTTP 的 XML。我已经使用 LWP::Simple 和 XML::Simple 完成了一个简单的概念验证，但这一切都有些临时性。

谁能推荐一些 Perl 模块或以这种方式与 RESTful Web 服务交互的最佳实践？是否有一个模块可以为我处理所有细节（发出请求 + 处理响应），或者问题域是否过于笼统？

请注意，Web 服务都是基于 HTTP 的 XML，尽管我希望最终必须使用 HTTP GET、POST 和 HEAD。我想我可以选择请求 JSON 而不是 XML，如果它更简单的话。

提前致谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-22T02:05:04.857

[我用LWP::Simple](http://search.cpan.org/dist/libwww-perl)、[LWP::UserAgent](http://search.cpan.org/dist/libwww-perl)、[Mojo::UserAgent](http://www.metacpan.org/module/Mojo::UserAgent)或[WWW::Mechanize](http://search.cpan.org/dist/WWW-Mechanize)来做大部分事情。REST 的东西也只是选择正确的 URL 来发送请求。收到响应后，[CPAN](http://search.cpan.org)上有很多模块可以处理 XML 或 JSON。我特别喜欢 Mojo，因为它带有自己的 JSON 和 DOM 解析器和工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-02T13:45:01.817

[REST::Client](http://search.cpan.org/~mcrawfor/REST-Client-171/lib/REST/Client.pm)很好。Atlassian 有一篇[用 Perl 编写 REST 客户端的](http://confluence.atlassian.com/display/FECRUDEV/Writing+a+REST+Client+in+Perl)文章。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2018-10-15T00:25:36.223

最好是使用 REST::Client 或者对于非生产，您可以在 Perl 中使用 curl（unix 命令）。例如：

```
 #!/usr/bin/perl
    $\="\n";
    $s=`curl -s --request GET --url https://api.thedogapi.com/v1/images/search`;
    print $s; 
```

# testing - （错误）理解 Smalltalk 和 TDD

> ID：670347
> 
> 赞同：7
> 
> 时间：2009-03-22T00:46:09.070
> 
> 标签：testing, syntax, tdd, smalltalk

我正在尝试通过实践来学习 Smalltalk，因此我通过构建一个简单的“Matrix”类来掌握语法和风格。

首先，如果链接到一个好的 Smalltak 教程（尽管这完全是可选的），我将不胜感激，最好是不涉及使用 GUI 的教程（我宁愿键入 my `.st`s 而不是在层次结构资源管理器中查找代替他们的方法）。

然后，在 TDD 上：对于我正在调用`gst-sunit -f matrix.st -f matrix-test.st BaseMatrixTests`的这个项目，肯定会有比这更好的方法。**有没有？**

最后，关于断言：我正在尝试编写一个方法并将断言放入其中，例如：

```
Matrix>>multiplyBy: anotherMatrix [
    [ self isNotEmpty ] assert.
    "Do Multiplication"
    [ result dimensions = (self height)@(anotherMatrix width) ] assert.
] 
```

**我怎么能做那种断言？**

编辑：明确标记的问题。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-22T07:07:18.077

好的，这里有几块。

首先，我同意 markusQ，尽管我完全同情：我宁愿能够直接在 EMACS 中编写我的代码。关于 Smalltalk 的一件事是，对于不想以 Smalltalk 方式做事的人来说，它确实是非常无情的。在这种情况下，Smalltalk 方式是使用浏览器。

其次，这是 Smalltalk 方式的部分原因是 Smalltalk 在很多方面*与*其他语言不同。实际上，实际上，没有办法制作“单独的” Smalltalk 可执行文件：您所能做的就是制作 Smalltalk 的图像，并添加一些您自己的代码的相对较小的片段。当您使用外部编辑器编写代码时，就像您展示的语法一样，您实际上只是手动键入一种比 XML 更容易手动键入的导入/导出格式。但只是有点。

道德是，使用浏览器以 Smalltalk 方式进行。

Smalltalk 有一些相当不错的教程。我通常使用 Squeak，所以我看到的都是使用 Squeak，就像[这里](http://wiki.squeak.org/squeak/792)一样。

在 TDD 上，您很幸运，因为 Smalltalk 是第一个获得 xUnit 的地方。对于 Smalltalk，它被称为 SUnit，这里有一个很好的[教程](http://wiki.squeak.org/squeak/1547)。

您在那里使用的断言似乎基本上是一种“按合同设计”的方法。已经完成了向 Smalltalk 添加合同设计的工作，如[这里](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.24.1768)。对于简单的断言，您可以像在[这个 SO question](https://stackoverflow.com/questions/665455/smalltalk-and-assertions)中一样添加代码。

```
assert: aBlock 
    "Throw an assertion error if aBlock does not evaluates to true."
    aBlock value
        ifFalse: [AssertionFailure signal: 'Assertion failed'] 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-22T05:57:31.693

我不想这么说（因为您明确表示您不想听到它），但请进入 IDE。在不使用 IDE 的情况下尝试了解 smalltalk 就像去巴黎并在麦当劳吃饭一样。当然，你在巴黎，但你并没有真正让自己接触到这一切。

smalltalk 的关键在于*它都是对象*。一直向下（整数和字符都是对象）一直向上（类、方法、浏览器、IDE 本身）都是*对象*。如果您坚持与之抗争，那么您将拥有与想要通过拖放东西来学习如何编写 C 的人一样多的运气。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-22T15:57:35.417

如果您下载了 Cincom Smalltalk Non-Commercial，则有许多在线教程。从这里开始：

[http://www.cincomsmalltalk.com/userblogs/cincom/blogView?content=tutorials](http://www.cincomsmalltalk.com/userblogs/cincom/blogView?content=tutorials)

如果您下载了 Squeak，请从这里开始：

[http://wiki.squeak.org/squeak/792](http://wiki.squeak.org/squeak/792)

是的，您确实需要使用 IDE 才能有效地使用 Smalltalk。

在测试时，加载 SUnit。在 Cincom Smalltalk 中，它是一个可加载的组件；我已经在上面链接的视频教程中介绍了加载（和使用）它。我不完全确定如何为 Squeak 加载它，或者它是否是那里的基础的一部分，但它肯定是可用的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-22T05:54:21.590

除了请求教程之外，我在这里看不到任何问题。你能澄清一下你想知道什么吗？

可以在此问题中找到适合初学者的良好资源列表： [https ://stackoverflow.com/questions/481976/is-there-a-dive-into-smalltalk-book](https://stackoverflow.com/questions/481976/is-there-a-dive-into-smalltalk-book)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-22T17:20:21.537

所以，关于断言，Squeak Smalltalk 已经带来了 Object>>assert: 所以，我想你可以这样做：

```
self assert: self isNotEmpty.
self assert: result dimensions equal: (self height)@(anotherMatrix width) 
```

如果您使用的是 GNU smalltalk，这可能会回答如何在那里进行断言：[Smalltalk 和断言](https://stackoverflow.com/questions/665455/smalltalk-and-assertions)

尼可

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-23T08:46:08.877

关于断言，请查看最近发布的另一个问题。

关于 TDD，是的，调用`gst-sunit -f matrix.st -f matrix-test.st BaseMatrixTests`是最好的方法。其他一切都建立在此之上，例如，这些可能是您的选择：

*   使您的包的所有 TestCase 子类都继承自一个虚假的子类，以便您可以`AllMatrixTests*`在 gst-sunit 的命令行上说（当您添加更多测试时）。
*   在 matrix-test.st 中的 matrix.st 文件中，因此消除了一个 -f 选项。
*   创建一个 Makefile 和 package.xml 文件来为您的包创建一个 .star 文件，如此[处](http://smalltalk.gnu.org/wiki/creating-and-distributing-packages)所述。然后你就可以做到了`gst-sunit -pMatrix`。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-23T12:16:13.850

上面已建议添加`#assert:`到`Object`，但我会添加`#assert`到`BlockClosure`（或`[] class`GNU Smalltalk 中的任何内容）。

```
assert
    this value ifFalse: [AssertionFailure signal: 'Assertion failed'] 
```

并因此使用

```
[ value notNil ] assert.
[ value > 0 ] assert.
[ list isEmpty not ] assert. 
```

等等。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-22T18:33:35.947

[Smalltalk Primer](http://www.smalltalk-resources.com/Smalltalk-Getting-the-Message.html)是对*Smalltalk 的面向消息编程基础的介绍*

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-24T16:11:52.593

[http://stores.lulu.com/store.php?fAcctID=2748699](http://stores.lulu.com/store.php?fAcctID=2748699)（您也可以找到下载 pdf 的链接）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-08-16T03:53:51.683

> 我宁愿键入我的 .sts 而不是在层次结构浏览器中寻找方法将方法放在它们的位置）。

你现在这么说，我也有同样的感觉，直到我花时间学习如何使用这些工具。

我是作为 Vim 的当前用户和 Emacs 的前用户这样说的。现在我已经学会了使用 Pharo 中的类浏览器和其他工具，我真的变得非常有效率。

话虽如此，如果您真的想走自己的路，GNU Smalltalk 是您的正确选择。

我想在这一点上指出，至少 Pharo 有一个 Matrix 类，你可以用它来获得灵感。吱吱声也应该。也许您会了解类浏览器检查 Matrix 有多么有用。;)

# visual-studio-2008 - 如何在 Visual Studio 中发布应用程序？

> ID：670350
> 
> 赞同：3
> 
> 时间：2009-03-22T00:48:42.310
> 
> 标签：visual-studio-2008, ide, installation

我正在使用 Visual Studio C++ 2008 开发一个小型控制台应用程序，并想制作一个安装程序，我可以将它分发给几个朋友来测试该应用程序。我记得构建菜单下有一个发布选项，但现在不存在。我可以以某种方式关闭此功能吗？

是否有一种简单的发布方式，使我的应用程序相对独立于 Windows 版本？

谢谢，

Nerf42

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T01:04:06.907

[部署您的程序 (C++)](http://msdn.microsoft.com/en-us/library/ms235317.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T00:59:58.367

您只能发布 Web 项目。如果您想要控制台应用程序的安装程序包，则需要创建一个安装项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T17:01:53.950

构建 exec 程序，确保包含所有需要的库。然后您可以使用 installcreator 并创建简单的安装程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-22T10:44:41.947

我发现我的错误：发布可用于 Visual Studio C# 项目，Visual Studio C++ 项目没有这样的选项。

感谢所有回答的人。

=-N42-=

# c - 教C时，在指针之前还是之后教数组更好？

> ID：670353
> 
> 赞同：19
> 
> 时间：2009-03-22T00:50:59.573
> 
> 标签：c, arrays, pointers

对于那些有课程开发经验的人：关于阵列的最佳策略是什么？

我见过一些学校在变量和控制结构之后教授数组，通常甚至在教授函数之前。这允许教授一些基本算法等。但是，它带来了如何将数组传递给函数的问题，因此有必要回到数组指针被教导并修补东西。

另一种选择是从变量和控制结构到函数，然后教指针，一旦有了指针，就从头开始教数组，然后使用它来进行动态内存分配。

对我来说，第二个选项更有意义，因为与简单的变量不同，数组很容易“越界”，但是尚未了解内存和指针的学生可能无法理解这些界限之外的内容。

但是，我很想知道其他人的想法。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-22T00:53:59.083

我认为最好的方法是一次引入 1 个概念。您不需要在第一个模块中 100% 解释数组。您可以通过一次引入 1 个概念来解开几乎任何事情。

我会按以下顺序教他们：数组、指针、数组+指针、OtherStuff[N]。

* * *

**数组：**

您可以先教授简单的数组，以便他们了解从单个变量名访问多个数据槽的能力。

```
//The following doesn't need an understanding of pointers
int x[10];
x[0] = 5; 
```

* * *

**指针：**

然后，您可以从一些简单的示例开始教授指针及其工作原理：

```
int y = 5;
int *p = &y;
*p = 6;
printf("%i\n", y); 
```

确保特别强调指针就像任何其他变量一样。它存储一个内存地址。

目前还没有必要进入堆栈与堆。

* * *

**数组+指针：**

如何使用指针遍历数组：

```
int x[10];
x[0] = 5;
x[1] = 6;
int *y = x;
printf("%i\n", *y);//prints the first element
y++;
printf("%i\n", *y);//prints the second element 
```

* * *

**然后你可以教更复杂的东西......**

*   如何进行指针运算。
*   Array + i 数组 [i] 的简写
*   [将数组作为数组指针与指针参数+大小参数传递给函数](https://stackoverflow.com/questions/671074/why-c-or-c-does-not-allow-passing-array-by-values-to-function/671076#671076)
*   数组如何成为连续的内存块
*   解释字符串文字，缓冲区，...
*   sizeof 如何处理指针与数组类型（指针大小与缓冲区大小）
*   解释更复杂的概念，例如分配内存、[堆栈和堆](https://stackoverflow.com/questions/79923/what-and-where-are-the-stack-and-heap/79936#79936)
*   多级间接
*   参考
*   多维数组的工作原理
*   ...

在所有示例中，大量使用 sizeof 和打印地址。这真的有助于理解发生了什么。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-22T00:55:10.593

我会先教指针。它们可以在不教授数组的情况下进行解释。在教授数组时，我可以在解释表达式时引用指针`a[i]`，以及在解释如何将它们传递给函数时。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-22T01:00:19.537

不要想太多事情。

尽可能清晰和引人入胜地教授这些概念远比你按什么顺序进行更重要。

我建议先接触数组的基础知识，然后再做指针和重新访问数组（这次更全面）。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-22T01:04:35.187

您应该首先教授数组，因为它们几乎存在于任何其他语言中，并且更容易理解。指针，或指针的某些方面，建立在对数组的了解之上。这是有机的秩序，恕我直言，以及我是如何早早学会的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-22T00:54:32.390

他们应该同时被教导。

作为指向具有偏移量（类型大小 * 索引）的基数的指针访问的一维数组的示例应该出现。

IE

```
a[i] is equivalent to *(a + i) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-22T01:19:36.837

我假设您正在向已经知道如何用另一种语言（如 Java）编程的学生教授 C（或者回到我的时代，Pascal）。我不认为 C 是一种用于教授编程以完成新手的好语言。

我会先教指针。这是将在 C 中学习的重要新思想之一。他们已经从其他语言中了解数组的概念，因此没有紧迫性首先教授这一点。因此，当您在 C 中讨论数组时，您可以谈论它们本质上是指针算术的语法糖，这是他们现在熟悉的概念。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-22T03:58:48.903

在我担心数组之前，我会教指针。但是，通常情况下，我看到的学生，他们已经在他们的第一堂 CS 课上接触过其他语言的数组。然而，即使我在第一个 CS 课上教 C，我也会在数组之前做指针，并用指针来描述数组。仅仅因为这些天认为“没有人会需要或想知道计算机实际上是如何工作的”的想法很流行，但这并不意味着它是正确的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-22T15:09:06.313

如上所述，我认为顺序并不重要，但这是我希望有人向我展示这些东西的顺序。

1.  数组
2.  指针
3.  数组和指针的相同点
4.  为什么数组和指针不一样

有关第 4 点的更多信息，我真的推荐第 4 章“令人震惊的事实：C 数组和指针不一样！” 在“专家 C，深度 C 的秘密”中。

/约翰

* * *

**更新**：

本书的一些链接，还有本书的预览。 [http://books.google.se - 专家 C，深度 C 秘密](http://books.google.se/books?id=4vm2xK3yn34C&dq=Expert+C,+deep+c+secrets&printsec=frontcover&source=bl&ots=Hn68Xd2Ea_&sig=aqj16OxpydKaGKoaxedRZVtGdrw&hl=en&ei=kY3GSfXSB4XJ-AbTg-n2Bg&sa=X&oi=book_result&resnum=1&ct=result#PPA101,M1)

用户对这本书的评论是真实的： [http ://www.amazon.co.uk/Expert-Programming-Peter-van-Linden/dp/0131774298](http://www.amazon.co.uk/Expert-Programming-Peter-van-Linden/dp/0131774298)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-22T19:35:59.043

如果他们事先接触过汇编程序，请先教指针。

如果他们接触过更高级的语言（即几乎任何东西），首先教数组。

以我的经验，在没有接触过汇编级编程（寄存器、地址、“计算机基础”）的情况下使用 C 语言的人即将进入一个痛苦的世界。恕我直言，您实际上最好先教授汇编级编码，然后将 C 作为更好的汇编程序引入。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-10-15T20:50:29.457

有趣的问题 - 我希望现在回答还为时不晚。

当我在 80 年代初在波士顿学院教授编程时，我和我的同事每年都在与这些问题作斗争，我们不断调整我们的方法。那时 C 是一门新语言，所以我们的发展经历了从 Basic 到 Pascal。我记得当时在想教 C 语言会有多难，因为它比较松散，有更多的方式让学生搞砸了，还有更多真正令人困惑的事情，比如你必须教的数组和指针之间的区别.

我发现最有用的是尝试具体化，而不是抽象化。例如，在介绍编程课程中，我使用了一个简单的十进制计算机的解释器，你可以用它的十进制“机器语言”进行编程。它的地址从 0 到 999，操作码如 1234，其中“1”表示“添加到累加器”，“234”是找到要添加的数字的地址。学生会编写非常简单的程序，比如将数字列表相加，然后他们会单步执行它们，观察每一步发生的情况。

我会让他们玩这个大约 3 周，然后开始学习 BASIC。在第二门课程中，他们将进入 Pascal。那台小十进制“计算机”完成的是传达一些具体概念，使“真实”语言中的“抽象”更容易理解，例如：

*   什么是内存，什么是地址，以及数据和程序如何只是内存地址中的数字。这使得“变量”、“数组”和“指针”的概念在后面更容易解释。
*   计算的基本模型是按顺序执行非常简单的步骤，在每一步开始之前，前一步必须完成。我知道现在人们会反对计算机高度并行化和流水线化，但我必须解释一下，你需要从非常简单的开始，因为当新手看到一个程序运行时，它会寻找整个世界，就像它一次完成所有事情一样，然后读取在这个过程中你的想法。
*   如何通过结合很少的指令词汇，包括跳转和条件跳转，让计算机几乎可以做任何你想做的事情。

现在，关于 C，我听说它被贬低为比汇编语言更高级，但我认为这是一件好事。作为专家对专家的语言，它总是让我印象深刻。我认为数组、指针和结构的想法很容易解释，如果你可以回溯到底层机器的话。对于 C++ 和面向对象编程也是如此。

所以，总而言之，如果学生理解计算机如何工作的基本概念，即使它是一台真正的人工计算机，那么解释更高级别的数据结构概念会容易得多。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-22T01:04:13.833

取决于他们知道什么。您是在教 C，还是编程和 C？

我看到后者的成功很少。C 根本不是一种非常直观或宽容的语言。我没有看到学生对开始使用它表示感谢，尽管我看到学生对它的编程感到沮丧。

无论如何，那些坚持编程的人会在业余时间出去学习C。没有必要先把它推到他们身上。

如果您只是在教 C，并且他们已经知道指针和数组，那么可以在一堂课中教指针和数组如何在 C 中工作。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-22T19:27:53.837

你会在字符串之前教指针吗？

可能不是。大多数相同的论点都适用。

（但总的来说，我同意@legion - 不要想太多。）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-22T19:45:08.037

我认为从数组开始会更好，因为数组的概念简单直观，但在 C 语言中，重要的是在教授 ponters 之后重新访问数组，正如之前“军团”所建议的那样。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-22T19:54:15.550

这个问题真的可以问任何面向对象的语言。

当我学习 Java 时，首先向我展示了数组和指针，作为数组的最后一部分，以演示深拷贝和浅拷贝之间的区别。

# bash - BASH - 为什么 TEST=' .* ' 将当前目录的列表分配给 TEST？

> ID：670363
> 
> 赞同：3
> 
> 时间：2009-03-22T00:55:35.523
> 
> 标签：bash

这让我发疯了。单引号中的所有内容都应该按原样分配，但是如果我执行以下操作：

测试='.*'

回声 $TEST

我在屏幕上看到一堆垃圾，列出当前目录中的所有“点”文件......

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-22T01:00:25.837

```
echo "$TEST" 
```

如果您不引用该变量，它会在第二个命令行上展开。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T02:26:32.043

它实际上将“.*”分配给 TEST。它仅在您回显时扩展为文件列表。

# wcf - 关于 CCR 和 WCF 集成的问题

> ID：670364
> 
> 赞同：3
> 
> 时间：2009-03-22T00:57:17.733
> 
> 标签：wcf, ccr

关于此解决方案[将 CCR 与同步 WCF 服务一起使用](https://stackoverflow.com/questions/494463/using-the-ccr-with-asynchronous-wcf-service)

为什么你需要这样做：

ThreadPool.QueueUserWorkItem(s => callback(this));

而不是仅仅调用 callback(this) ？

QueueUserWorkItem 不会使用另一个线程吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T02:49:03.610

“回调”是一种需要作为输入参数提供给 BeginGetAccount 的方法。在答案中，它没有指定“回调”方法，因此无法知道它是否使用新线程，因此将“回调”方法放在 Complete 中的单独线程上确实有意义。

如果您可以保证“回调”创建了自己的线程，那么您就不需要在 Complete 方法中创建一个。

# web - 通过筛选管理未注册用户的帖子

> ID：670370
> 
> 赞同：3
> 
> 时间：2009-03-22T01:03:19.123
> 
> 标签：web, registration

我正在考虑允许用户在不让他们注册或提供任何识别信息的情况下发布到我的网站。如果每个帖子都发送到数据库队列，然后我手动筛选这些帖子，我可能会遇到什么样的问题？我该如何处理这些问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-22T01:10:41.447

筛选每个帖子将是乏味和令人厌烦的。并且容易出现烦人的管理员垃圾邮件。我的建议是尽可能多地自动化筛选。此外，提供任何识别信息都无法防止垃圾邮件（机器人只会生成它）。

很多项目实施识别系统：首先用户必须发布 1-2 个被批准的帖子，然后通过 IP 和（可能）一个 cookie 他被识别为受信任的发布者，所以他的帖子自动出现（稍后可以标记为垃圾邮件）。

还可以使用一些关于帖子内容的启发式方法（如帖子中的链接数量）来自动丢弃潜在的垃圾邮件帖子。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-22T01:06:25.713

最明显的问题是，如果您的网站足够受欢迎，您会被提交屏幕的数量所淹没。

我会确保添加一些管理工具，这样您就可以自动终止来自特定 IP 地址或匹配特定正则表达式的所有帖子。这应该有助于更快地摆脱明显的垃圾邮件，但同样，你必须在所有这些方面都在驾驶。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T01:06:08.850

乏味似乎是最大的担忧——手动筛选帖子对垃圾邮件有效（我假设这是您想要清除的内容）但非常无聊。

除草时最好喝一杯咖啡和听好听的音乐来解决这个问题？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-22T01:40:20.860

我发现询问一个简单问题的答案会将浏览器作为图像发送（例如“2 + 3 - 4 =”，“验证码”的一种变体，但并不那么烦人），并带有一点点 Javascript很好。

发送带有图像和答案字段的表单，以及带有“挑战”（一些随机生成的字符串）的隐藏字段。当用户提交表单时，对挑战和答案进行哈希处理，并将结果发送回服务器。服务器可以在将其添加到数据库以供审查之前检查有效答案。

前期工作似乎很多，但可以节省数小时的审核时间。使用 jQuery：

```
<script type="text/javascript">
// 哈希函数来掩盖答案
函数答案掩码（）
{
  var a = $('#a').val();
  var c = $('#c').val();
  var h = hex_md5(hex_md5(a) + c);
  $('#a').val(h);
}
</脚本>
  <form onsubmit="answerMask()" action="/cgi-bin/comment.py" method="POST">
    <表格>
      <tr><td>评论</td><td><input type="text" name="comment" /></td></tr>
      <tr><td>#把图片放在这里#</td><td><input id="p" type="text" name="a" size="30" /></td></tr>
      <tr><td><input id="c" type="hidden" value="ddd8c315d759a74c75421055a16f6c52" name="c" /></td><td><input type="submit" value=" Go "> </td></tr>
    </p>
  </form>

```

* * *

**编辑更新...**

我在一个网站上看到了这种技术，我不确定是哪一种，所以这个想法不是我的，但你可能会发现它很有用。

提供一个带有挑战字段和评论字段的表单。以“从以下位置选择第三个单词：glark snerm hork morf”作为挑战的前缀，这样单词以及要选择的单词很容易在服务器上生成，并且在表单内容返回时很容易验证。

关键是让用户做*一些事情*，应用一些脑细胞，以及比脚本小子更值得的工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T01:06:47.587

*   试图看起来合法但不合法的帖子
*   纯粹的体积

这些是我在博客上看到的问题。

# sql - 使用 ORM 进行大容量数据库更新

> ID：670379
> 
> 赞同：8
> 
> 时间：2009-03-22T01:08:54.773
> 
> 标签：sql, database, performance, orm, caching

我喜欢 ORM 工具，但我经常认为对于大型更新（数千行），加载、更新和保存类似的东西似乎效率低下

```
UPDATE [table] set [column] = [value] WHERE [predicate] 
```

会提供更好的性能。

但是，假设出于性能原因想要走这条路线，那么您将如何确保缓存在内存中的任何对象都正确更新。

假设您正在使用 LINQ to SQL，并且您一直在处理 DataContext，您如何确保您的高性能 UPDATE 反映在 DataContext 的对象图中？

这可能是“你没有”或“使用数据库上的触发器来调用删除缓存的 .NET 代码”等，但我很想听听这类问题的常见解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T01:50:39.570

没错，在这种情况下，使用 ORM 加载、更改然后持久化记录效率不高。我的过程是这样的

1）早期实现使用ORM，在我的例子中是NHibernate，专门

2) 随着开发的成熟，识别性能问题，其中将包括大量更新

3) 将那些重构为 sql 或 SP 方法

4) 使用 Refresh(object) 命令更新缓存对象，

我的大问题是通知其他客户更新已经发生。在大多数情况下，我们已经接受了一些客户端将是陈旧的，无论如何标准 ORM 使用都是这种情况，然后检查更新/插入的时间戳。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T01:59:47.770

大多数 ORM 还具有高效执行大型或“批量”更新的功能。无状态会话是 Hibernate for Java 中可用的一种此类机制，显然将在 NHibernate 2.x 中可用：

[http://ayende.com/Blog/archive/2007/11/13/What-is-going-on-with-NHibernate-2.0.aspx](http://ayende.com/Blog/archive/2007/11/13/What-is-going-on-with-NHibernate-2.0.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T01:27:36.023

ORM 非常适合快速开发，但您是对的——它们效率不高。它们很棒，因为您无需考虑将内存中的对象转换为表中的行并再次返回的底层机制。然而，很多时候 ORM 并没有选择最有效的流程来做到这一点。如果您真的关心应用程序的性能，最好与 DBA 合作，帮助您设计数据库并适当调整查询。（或者至少自己了解SQL的基本概念）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T11:36:04.967

批量更新是一个有问题的设计。有时它们似乎是必要的；然而，在许多情况下，更好的应用程序设计可以消除对批量更新的需要。

通常，应用程序的某些其他部分已经一次触及每个对象。“批量”更新应该在应用程序的其他部分完成。

在其他情况下，更新是其他地方处理的前奏。在这种情况下，更新应该是稍后处理的一部分。

我的一般设计策略是重构应用程序以消除批量更新。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T01:53:39.983

ORM 不会像手工编写的 SQL 那样高效。时期。就像手工汇编程序会比 C# 更快一样。这种性能差异是否重要取决于很多事情。在某些情况下，ORM 为您提供的更高级别的抽象可能比潜在的更高性能更有价值，而在其他情况下则不然。

遍历与目标代码的关系可能非常好，但正如您正确指出的那样，存在潜在的问题。

话虽如此，我个人认为 ORms 在很大程度上是一种虚假的经济。我不会在这里重复自己，而只是指出[使用 ORM 还是纯 SQL？](https://stackoverflow.com/questions/494816/using-an-orm-or-plain-sql/494853#494853)

# javascript - Javascript Cookie 加载调用

> ID：670384
> 
> 赞同：1
> 
> 时间：2009-03-22T01:18:57.917
> 
> 标签：javascript, cookies, function-calls

我有一个使用 javascript 做的 cookie 并检查它是否必须被替换我在 HTML 的 body 标记中使用了“onload=checkCookie()”，但是现在我试图将 js 放在另一个文件中，只是使用标签链接它，但如果我这样做，我不能再使用“onload”来调用这个函数，所以我想知道我该怎么做？我问过的其他人都告诉我把代码留在那里，但我想把我的设计分层=S

这是js：

```
function getCookie(c_name){
    if (document.cookie.length>0){
        c_start=document.cookie.indexOf(c_name + "=");
        if (c_start!=-1){ 
            c_start=c_start + c_name.length+1; 
            c_end=document.cookie.indexOf(";",c_start);
            if (c_end==-1) c_end=document.cookie.length;
            return unescape(document.cookie.substring(c_start,c_end));
        } 
    }
    return "";
}

function setCookie(c_name,value,expiredays){
    var exdate=new Date();
    exdate.setDate(exdate.getDate()+expiredays);
    document.cookie=c_name+ "=" +escape(value)+
    ((expiredays==null) ? "" : ";expires="+exdate.toGMTString());
}

function checkCookie(){
    username=getCookie('username');
    if(username!=null && username!=""){
        alert('Welcome again '+username+'!');
    }else{
        username=prompt('Please enter your name:',"");
        if(username!=null && username!=""){
            setCookie('username',username,365);
        }
    }
} 
```

一切都在一个名为 init.js 的文件中

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T01:33:07.693

我不明白这个问题，即使它来自外部文件，您也应该能够使用正文的 onload 来执行 javascript，如下所示：

这是html：

```
<html>
<head>
<script type="text/javascript" src="script.js"></script>
</head>
<body onload="hello()">
</body>
</html> 
```

这是链接的javascript：

```
var hello = function()
{
    alert("Hello!");
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T03:16:57.833

将脚本放在单独的文件中是一件好事。将 onload 函数添加到脚本中-

**窗口**.onload=checkCookie; //（无括号）并将其从 html 中取出。

# asp.net - SharePoint - 最简单的解决方案和功能配置来注册服务器控件？

> ID：670392
> 
> 赞同：1
> 
> 时间：2009-03-22T01:26:47.210
> 
> 标签：asp.net, sharepoint, sharepoint-2007, wss, wss-3.0

我想知道 XML 是什么最简单的功能，它将在 GAC 中注册一个服务器控件，并将其添加到 SharePoint 网站的 web.config 的安全控件部分。

我的组装：

MyServerControl.dll（MyServerControl，版本=1.0.0.0，文化=中性，PublicKeyToken=3249363c0f6f8c59）

我可以使用 gacutil /i 手动将其添加到 GAC，但我希望该功能为我执行此操作，并将元素添加到 SafeControls。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-23T08:54:08.420

一项功能无法将文件添加到 GAC，这是解决方案的工作。该解决方案可以将您的功能部署到 12 个配置单元，将程序集部署到 GAC，并且可以将安全控件条目添加到 web.config。

[MSDN 关于解决方案和 Web 部件包](http://msdn.microsoft.com/en-us/library/ms413687.aspx)

由于手动构建 MOSS 解决方案可能会很痛苦，因此有一些很酷的工具可以为您提供支持。

[VSeWSS 1.3](http://www.microsoft.com/downloads/details.aspx?FamilyID=B2C0B628-5CAB-48C1-8CAE-C34C1CCBDC0A&displaylang=en)
[WSPBuilder](http://wspbuilder.codeplex.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T19:48:37.083

您想要构建一个解决方案包以将您的用户控件的程序集部署到 GAC 中。功能不部署程序集。事实上，部署用户控件甚至不需要功能。查看我的帖子，其中包含有关如何开始的说明和示例代码。

[在 SharePoint 中部署用户控件](http://www.dotnetmafia.com/blogs/dotnettipoftheday/archive/2008/11/18/introduction-to-sharepoint-development-deploy-a-user-control-in-sharepoint.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-11T09:46:23.017

WSPBuilder 是要走的路，它会自动将 dll 添加到 GAC，并在必要时在您部署解决方案的 Web 应用程序中将其注册为 SafeControl。

# python - 如何在本地针对 OAuth 进行开发？

> ID：670398
> 
> 赞同：37
> 
> 时间：2009-03-22T01:37:13.613
> 
> 标签：python, oauth

我正在构建一个需要与 OAuth 服务提供者通信的 Python 应用程序。SP 要求我指定回调 URL。指定 localhost 显然是行不通的。我无法设置面向公众的服务器。除了支付服务器/托管费用之外还有什么想法吗？这甚至可能吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-22T06:15:23.070

两件事情：

1.  如果您未指定回调 URL，则相关的 OAuth 服务提供者如果它给您一个错误，则它违反了 OAuth 规范。callback_url 被[指定为可选参数](http://oauth.net/core/1.0/#auth_step2)。

2.  但是，撇开迂腐不谈，您可能希望在用户完成后收到回调，以便您知道可以将请求令牌兑换为访问令牌。[雅虎的 FireEagle 开发者文档](http://fireeagle.yahoo.net/developer/documentation/oauth_best_practice)有很多关于如何做到这一点的重要信息。

即使在第二种情况下，回调 URL 实际上根本不必从 Internet 上可见。OAuth 服务提供者会将用户用来提供其用户名/密码的浏览器重定向到回调 URL。

两种常见的方法是：

1.  从您的应用程序中创建一个哑 Web 服务，该服务在某个端口（例如[http://localhost:1234/](http://localhost:1234/)）上侦听完成回调，或者
2.  注册一个协议处理程序（您必须查看您的操作系统的文档，专门了解如何执行此操作，但它可以使 <a href="skype:555-1212"> 之类的东西正常工作）。

（我相信你在[这里](http://wiki.oauth.net/iPhoto-to-Flickr)描述的流程的一个例子。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-08-24T10:16:18.753

如果您使用 *nix 样式系统，请创建一个别名，如`127.0.0.1 mywebsite.dev`in `/etc/hosts`（您需要在文件中具有与上述类似的行，`http://website.dev/callbackurl/for/app`在回调 URL 和本地测试期间使用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-11-01T18:40:58.677

This was with the Facebook OAuth - I actually *was* able to specify 'http://127.0.0.1:8080' as the Site URL and the callback URL. It took several minutes for the changes to the Facebook app to propagate, but then it worked.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T01:42:42.867

这可能会帮助您：

[http://www.marcworrell.com/article-2990-en.html](http://www.marcworrell.com/article-2990-en.html)

它是 php，因此在您的开发服务器上设置应该非常简单。

这个我试过一次：

[http://term.ie/oauth/example/](http://term.ie/oauth/example/)

这很简单。您在底部有一个下载代码的链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-01T21:59:59.423

localtunnel [端口] 瞧

[http://blogrium.wordpress.com/2010/05/11/making-a-local-web-server-public-with-localtunnel/](http://blogrium.wordpress.com/2010/05/11/making-a-local-web-server-public-with-localtunnel/)

[http://github.com/progrium/localtunnel](http://github.com/progrium/localtunnel)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-03T13:06:46.457

所以我如何解决这个问题（使用 BitBucket 的 OAuth 接口）是通过指定回调 URL 到 localhost（或任何你真正想要的），然后使用 curl 跟踪授权 URL，但只返回 HTTP 标头。例子：

```
curl --user BitbucketUsername:BitbucketPassword -sL -w "%{http_code} %{url_effective}\\n" "AUTH_URL" -o /dev/null 
```

插入您的凭据和授权网址（请记住转义感叹号！）。

你应该得到的是这样的：

```
200 http://localhost?dump&oauth_verifier=OATH_VERIFIER&oauth_token=OATH_TOKEN 
```

你可以从中刮掉 oath_verifier。

在 python 中做同样的事情：

```
import pycurl
devnull = open('/dev/null', 'w')
c = pycurl.Curl()

c.setopt(pycurl.WRITEFUNCTION, devnull.write)
c.setopt(c.USERPWD, "BBUSERNAME:BBPASSWORD")
c.setopt(pycurl.URL, authorize_url)
c.setopt(pycurl.FOLLOWLOCATION, 1) 
c.perform()

print c.getinfo(pycurl.HTTP_CODE), c.getinfo(pycurl.EFFECTIVE_URL) 
```

我希望这对某人有用！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-25T12:17:48.727

你可以创建2个应用程序？1个用于部署，另一个用于测试。

或者，您还可以在请求请求令牌时包含 oauth_callback 参数。一些提供商将重定向到 oauth_callback 指定的 url（例如 Twitter、Google），但有些提供商会忽略此回调 url 并重定向到配置期间指定的 URL（例如 Yahoo）

# php - 为什么我的 MySQL 数据库插入不起作用？

> ID：670404
> 
> 赞同：0
> 
> 时间：2009-03-22T01:43:58.323
> 
> 标签：php, mysql

```
$author = $_SESSION['username'];
$subject = $_POST['subject'];
$body = $_POST['body'];
$branched = $_POST['branched'];
$time = time();
$branchedFrom = $_POST['parent'];
$id = $_POST['parent'];
$next = 0;
$previous = 0;
$branchedTo = 0;
mysql_query(
    "INSERT INTO offtopic
    VALUES(
        '',
        '$author',
        '$subject',
        '$body',
        '$time',
        '$next',
        '$previous',
        '$branchedFrom',
        '$branchedTo'
"); 
```

我已经尝试了很多次，甚至尝试更改一些内容，但它不会将信息保存到数据库中。开头的空格是索引在数据库中的位置。我很确定 SESSION 和 POST 的东西会正确通过。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T01:49:32.663

```
"INSERT INTO offtopic VALUES('', '$author', '$subject', '$body', '$time',    '$next', '$previous', '$branchedFrom', '$branchedTo'" 
```

字符串中缺少结束 ')'。[使用mysql_error()](http://de2.php.net/manual/en/function.mysql-error.php)获取错误消息，这样的简单语法错误应该很明显。

此外，您还有[SQL 注入](http://en.wikipedia.org/wiki/SQL_injection)安全漏洞，您可以驾驶公共汽车通过。您需要在连接到字符串中的每个字符串值上调用[mysql_real_escape_string() ，或使用 mysqli](http://de2.php.net/manual/en/function.mysql-real-escape-string.php)[参数化查询](http://de2.php.net/manual/en/mysqli.prepare.php)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T01:54:16.847

也许是因为您的查询缺少要插入的字段

```
"INSERT INTO offtopic(field1, field2, etc....) VALUES('', '$author', '$subject', '$body', '$time', '$next', '$previous', '$branchedFrom', '$branchedTo'"); 
```

# c# - 重用 SqlCommand？

> ID：670407
> 
> 赞同：53
> 
> 时间：2009-03-22T01:49:00.200
> 
> 标签：c#, .net, sql-server

我不确定这是否可能。

我目前正在从事一个大学项目，并且我有一个使用存储过程的函数。我想知道是否可以采用相同的`SqlCommand`实例并应用更新的参数以在同一函数中再次调用存储过程。

可以说我的代码中有这样的东西：

```
myConStr = ConfigurationManager.ConnectionStrings["MyConnString"].ConnectionString;
myConn = new SqlConnection(myConStr);
myCommand = new System.Data.SqlClient.SqlCommand("team5UserCurrentBooks3", myConn); 
myCommand.CommandType = CommandType.StoredProcedure;
myCommand.Parameters.AddWithValue("@book_id", bookID);
myCommand.Parameters.AddWithValue("@user_id", userID);

try
{
    myConn.Open();
    myCommand.ExecuteNonQuery(); 
```

是否可以更新`MyCommand`参数并再次调用存储过程？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-03-22T02:02:09.573

是的。您需要确保在每次调用之间调用 myCommand.Parameters.Clear 以转储参数，但没有什么可以阻止您重用该对象。（我不经常使用C#，所以文中可能会有一两个错误）

```
myConStr = ConfigurationManager.ConnectionStrings["MyConnString"].ConnectionString;
myConn = new SqlConnection(myConStr);
myConn.Open();

myCommand = new System.Data.SqlClient.SqlCommand("team5UserCurrentBooks3", myConn); 
myCommand.CommandType = CommandType.StoredProcedure;
myCommand.Parameters.AddWithValue("@book_id", bookID);
myCommand.Parameters.AddWithValue("@user_id", userID);
myCommand.ExecuteNonQuery();

myCommand.Parameters.Clear();
myCommand.CommandText= "NewStoredProcedureName";
myCommand.CommandType = CommandType.StoredProcedure;
myCommand.Parameters.AddWithValue("@foo_id", fooId);
myCommand.Parameters.AddWithValue("@bar_id", barId);
mycommand.ExecuteNonQuery();

myCommand.Parameters.Clear();
myCommand.CommandText = " SELECT * FROM table1 WHERE ID = @TID;"
myCommand.CommandType = CommandType.Text;
myCommand.Parameters.AddWithValue("@tid", tId);
SqlReader rdr;
rdr = myCommand.ExecuteReader(); 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-22T02:03:18.543

是的！你绝对可以做到这一点。在一个函数中，您也可以重复使用相同的连接（我不建议在更大的范围内重复使用连接对象，但这是可能的）。

你也可以这样做：

```
myConStr = ConfigurationManager.ConnectionStrings["MyConnString"].ConnectionString;
using (var cn = new SqlConnection(myConStr) )
using (var cmd = new SqlCommand("team5UserCurrentBooks3", cn) ) 
{
    cmd.CommandType = CommandType.StoredProcedure; 
    cmd.Parameters.Add("@user_id", SqlDbType.Int).Value = userID;
    cmd.Parameters.Add("@book_id", SqlDbType.Int);
    cn.Open();

    for(int i = 0; i<10; i++)
    {
        cmd.Parameters["@book_id"].Value = i;
        cmd.ExecuteNonQuery();
    }
} 
```

这将运行查询 10 次，`user_id`每次执行时都使用相同的查询，但更改`book_id`. 该`using`块就像将您的连接包装在 try/catch 中以确保它已关闭。

# html - 表格中特定行的边框？

> ID：670424
> 
> 赞同：124
> 
> 时间：2009-03-22T02:08:11.493
> 
> 标签：html, css, border, css-tables

我正在尝试设计一些可以在表格中的特定行周围放置边框的 HTML/CSS。是的，我知道我真的不应该使用表格进行布局，但我还没有足够的 CSS 来完全替换它。

无论如何，我有一个包含多行和多列的表格，其中一些与 rowspan 和 colspan 合并，我想在表格的某些部分周围放置一个简单的边框。目前，我正在使用 4 个单独的 CSS 类（顶部、底部、左侧、右侧），它们`<td>`分别附加到表格顶部、底部、左侧和右侧的单元格。

```
.top {
  border-top: thin solid;
  border-color: black;
}

.bottom {
  border-bottom: thin solid;
  border-color: black;
}

.left {
  border-left: thin solid;
  border-color: black;
}

.right {
  border-right: thin solid;
  border-color: black;
}
```

```
<html>

<body>

  <table cellspacing="0">
    <tr>
      <td>no border</td>
      <td>no border here either</td>
    </tr>
    <tr>
      <td class="top left">one</td>
      <td class="top right">two</td>
    </tr>
    <tr>
      <td class="bottom left">three</td>
      <td class="bottom right">four</td>
    </tr>
    <tr>
      <td colspan="2">once again no borders</td>
    </tr>
    <tr>
      <td class="top bottom left right" colspan="2">hello</td>
    </tr>
    <tr>
      <td colspan="2">world</td>
    </tr>
  </table>

</html>
```

有没有更简单的方法来做我想做的事？我尝试将顶部和底部应用于 a`<tr>`但它没有用。（ps我是CSS新手，所以我可能错过了一个非常基本的解决方案。）

**注意：**我确实需要有多个带边框的部分。基本思想是有多个有边界的集群，每个集群包含多行。

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2013-06-04T16:16:04.867

怎么样`tr {outline: thin solid black;}`？在 tr 或 tbody 元素上为我工作，并且[似乎](http://www.quirksmode.org/css/user-interface/)与大多数浏览器兼容，包括 IE 8+，但以前不兼容。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-03-22T04:55:32.013

感谢所有回复的人！我已经尝试了这里提供的所有解决方案，并且我在互联网上进行了更多搜索以寻找其他可能的解决方案，我认为我找到了一个很有希望的解决方案：

```
tr.top td {
  border-top: thin solid black;
}

tr.bottom td {
  border-bottom: thin solid black;
}

tr.row td:first-child {
  border-left: thin solid black;
}

tr.row td:last-child {
  border-right: thin solid black;
}
```

```
<html>

<head>
</head>

<body>

  <table cellspacing="0">
    <tr>
      <td>no border</td>
      <td>no border here either</td>
    </tr>
    <tr class="top row">
      <td>one</td>
      <td>two</td>
    </tr>
    <tr class="bottom row">
      <td>three</td>
      <td>four</td>
    </tr>
    <tr>
      <td colspan="2">once again no borders</td>
    </tr>
    <tr class="top bottom row">
      <td colspan="2">hello</td>
    </tr>
    <tr>
      <td colspan="2">world</td>
    </tr>
  </table>

</body>

</html>
```

**输出：**

![在此处输入图像描述](https://i.stack.imgur.com/P4NGC.png)

不必将`top`, `bottom`,`left`和`right`类添加到 each `<td>`，我所要做的就是添加`top row`到 top `<tr>`，`bottom row`到 bottom `<tr>`，以及中间的`row`each `<tr>`。这个解决方案有什么问题吗？是否有任何我应该注意的跨平台问题？

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2012-11-22T11:12:24.217

如果您在父表上设置`border-collapse`样式，`collapse`您应该能够设置样式`tr`：（样式是内联的，用于演示）

```
<table style="border-collapse: collapse;">
  <tr>
    <td>No Border</td>
  </tr>
  <tr style="border:2px solid #f00;">
    <td>Border</td>
  </tr>
  <tr>
    <td>No Border</td>
  </tr>
</table> 
```

**输出：**

![HTML 输出](https://i.stack.imgur.com/uIpvS.png)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-01-09T05:20:39.897

我也只是在玩这个，这对我来说似乎是最好的选择：

```
<style>
    tr { 
        display: table;            /* this makes borders/margins work */
        border: 1px solid black;
        margin: 5px;
    }
</style> 
```

请注意，**这将阻止使用流式/自动列宽**，因为单元格将不再与其他行中的单元格对齐，但边框/颜色格式仍然可以正常工作。解决方案是**给 TR 和 TD 指定宽度**（px 或 %）。

当然，`tr.myClass`如果您只想将选择器应用于某些行，您可以制作选择器。然而，显然`display: table`不适用于 IE 6/7，但可能还有其他可能适用于这些的黑客（hasLayout？）。:-(

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-22T03:16:56.960

这是一种使用 tbody 元素的方法，可能是这样做的方法。您不能在 tbody 上设置边框（与不能在 tr 上相同），但您可以设置背景颜色。如果您想要达到的效果可以通过行组上的背景颜色而不是边框​​来获得，这将起作用。

```
<table cellspacing="0">  
    <tbody>
        <tr>    
            <td>no border</td>    
            <td>no border here either</td>  
        </tr>  
    <tbody bgcolor="gray">
        <tr>    
            <td>one</td>    
            <td>two</td>  
        </tr>  
        <tr>    
            <td>three</td>    
            <td>four</td>  
        </tr>  
    <tbody>
        <tr>    
             <td colspan="2">once again no borders</td>  
        </tr>  
    <tbody bgcolor="gray">
        <tr>    
             <td colspan="2">hello</td>  
        </tr>
    <tbody>
    <tr>    
         <td colspan="2">world</td>  
    </tr>
</table> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-02-21T20:35:39.417

使用标签将行组合在一起`<tbody>`，然后应用样式。

```
<table>
  <tr><td>No Style here</td></tr>
  <tbody class="red-outline">
    <tr><td>Style me</td></tr>
    <tr><td>And me</td></tr>
  </tbody>
  <tr><td>No Style here</td></tr>
</table> 
```

以及 style.css 中的 css

```
.red-outline {
  outline: 1px solid red;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-22T02:32:16.303

根据您希望在任意 MxN 单元块周围放置边框的要求，如果不使用 Javascript，确实没有更简单的方法可以做到这一点。如果你的单元格是固定的，你可以使用浮点数，但由于其他原因这是有问题的。你正在做的事情可能很乏味，但没关系。

好的，如果您对使用 jQuery（我的首选方法）的 Javascript 解决方案感兴趣，您最终会得到这段相当可怕的代码：

```
<html>
<head>

<style type="text/css">
td.top { border-top: thin solid black; }
td.bottom { border-bottom: thin solid black; }
td.left { border-left: thin solid black; }
td.right { border-right: thin solid black; }
</style>
<script type="text/javascript" src="jquery-1.3.1.js"></script>
<script type="text/javascript">
$(function() {
  box(2, 1, 2, 2);
});

function box(row, col, height, width) {
  if (typeof height == 'undefined') {
    height = 1;
  }
  if (typeof width == 'undefined') {
    width = 1;
  }
  $("table").each(function() {
    $("tr:nth-child(" + row + ")", this).children().slice(col - 1, col + width - 1).addClass("top");
    $("tr:nth-child(" + (row + height - 1) + ")", this).children().slice(col - 1, col + width - 1).addClass("bottom");
    $("tr", this).slice(row - 1, row + height - 1).each(function() {
      $(":nth-child(" + col + ")", this).addClass("left");
      $(":nth-child(" + (col + width - 1) + ")", this).addClass("right");
    });
  });
}
</script>
</head>
<body>

<table cellspacing="0">
  <tr>
    <td>no border</td>
    <td>no border here either</td>
  </tr>
  <tr>
    <td>one</td>
    <td>two</td>
  </tr>
  <tr>
    <td>three</td>
    <td>four</td>
  </tr>
  <tr>
    <td colspan="2">once again no borders</td>
  </tr>
</tfoot>
</table>
</html> 
```

我很乐意就更简单的方法提出建议......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-22T02:35:24.487

我能想到的唯一另一种方法是将需要边框的每一行包含在嵌套表中。这将使边框更容易做到，但可能会产生其他布局问题，您必须手动设置表格单元格的宽度等。

根据您的其他布局要求，您的方法可能是最好的方法，这里建议的方法只是一种可能的选择。

```
<table cellspacing="0">  
    <tr>    
        <td>no border</td>    
        <td>no border here either</td>  
    </tr>  
    <tr>
        <td>
             <table style="border: thin solid black">
                  <tr>    
                        <td>one</td>    
                        <td>two</td>  
                  </tr>  
                  <tr>    
                      <td>three</td>    
                      <td>four</td>  
                  </tr>  
             </table>
         </td>
    </tr>
    <tr>    
         <td colspan="2">once again no borders</td>  
    </tr>  
    <tr>
        <td>
             <table style="border: thin solid black">
                  <tr>    
                        <td>hello</td>  
                   </tr>
             </table>
         </td>
    </tr>
    <tr>    
         <td colspan="2">world</td>  
    </tr>
</table> 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-01-26T10:25:14.550

由于[enigment的回答](https://stackoverflow.com/a/16922733/4251431)几乎没有修改，诀窍在于[大纲属性](http://www.w3schools.com/css/css_outline.asp)

使用这个类

```
.row-border{
    outline: thin solid black;
    outline-offset: -1px;
} 
```

然后在 HTML

```
<tr>....</tr>
<tr class="row-border">
    <td>...</td>
    <td>...</td>
</tr> 
```

结果是 [![在此处输入图像描述](https://i.stack.imgur.com/39umQ.png)](https://i.stack.imgur.com/39umQ.png) 希望这对你有帮助

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2013-07-09T21:44:44.543

一种更简单的方法是使表成为服务器端控件。你可以使用类似的东西：

```
Dim x As Integer
table1.Border = "1"

'Change the first 10 rows to have a black border
 For x = 1 To 10
     table1.Rows(x).BorderColor = "Black"
 Next

'Change the rest of the rows to white
 For x = 11 To 22
     table1.Rows(x).BorderColor = "White"
 Next 
```

# .net - 双工 MSMQ 通道？

> ID：670426
> 
> 赞同：1
> 
> 时间：2009-03-22T02:10:03.143
> 
> 标签：.net, wcf

我希望能够使用 MSMQ 的双工合同，有人有什么想法吗？[我在这里](http://mtaulty.com/CommunityServer/blogs/mike_taultys_blog/archive/2006/10/26/8937.aspx)和[这里](http://blogs.thinktecture.com/cweyer/archive/2006/10/27/414731.aspx)看过一些博客，但似乎他们的尝试（在 MSMQ 上使用 a:ReplyTo 使用双工合同）没有成功。

可靠的会话不能帮助我，因为它不能保证当网络或接收者关闭时将发送消息。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-23T23:55:29.517

抱歉，如果这已被排除（因为这不是您要寻找的），但实现此目的的一种方法是在每个应用程序中设置单独的 NetMsmq 服务端点。在需要回复调用方的服务方法中，您只需创建一个指向接收方地址的 MSMQ 客户端，然后像往常一样发回一条消息。

如果您想要“ReplyTo”地址的更多动态行为，您可以让客户端将其服务端点的地址作为发送到服务的消息的一部分传递。当服务需要回复时，它可以使用客户端在 NetMsmqBinding 中提供的地址以编程方式创建客户端端点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-03T13:46:13.393

[这是我的解决方案](http://duplexmsmq.codeplex.com/)

# sharepoint - 将从联系人继承的 SharePoint 自定义内容类型导出到 Outlook

> ID：670427
> 
> 赞同：1
> 
> 时间：2009-03-22T02:10:07.713
> 
> 标签：sharepoint, wss, content-type, wss-3.0

我创建了一个自定义内容类型，它继承自 WSS 3.0 中的内置联系人内容类型。当我创建一个列表实例并分配我的自定义内容类型时，没有像最终用户直接创建新的“联系人”那样的“连接到 Outlook”选项。我做错了什么还是这是 SharePoint 的限制？

我的功能的相关部分如下所示：

```
<ContentType
    ID="0x010600C4945CA38AAB46cdA161C4146965F0E3" 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T22:58:29.243

“连接到 Outlook”是列表的功能，而不是内容类型。即，您可以为联系人列表提供多种内容类型，但您需要基于联系人列表创建一个列表以获得您需要的附加功能。

要进行测试以了解我的意思，请创建联系人列表，转到列表的高级设置并允许管理内容类型。添加您的自定义内容类型并删除默认联系人。

现在为了咯咯笑，删除您的自定义内容类型并添加公告内容类型。您仍然可以“连接到 Outlook”。

希望这表明内容类型主要是关于存储为该特定内容类型的列表项可用的字段。

# python - 使用 Django 将文件异步上传到 Amazon S3

> ID：670442
> 
> 赞同：36
> 
> 时间：2009-03-22T02:29:32.347
> 
> 标签：python, django, amazon-s3

我正在使用这个文件存储引擎在上传文件时将文件存储到 Amazon S3：

[http://code.welldev.org/django-storages/wiki/Home](http://code.welldev.org/django-storages/wiki/Home)

上传需要相当长的时间，因为文件必须先从客户端上传到 Web 服务器，然后再将 Web 服务器上传到 Amazon S3，然后才会向客户端返回响应。

我想让将文件发送到 S3 的过程异步，这样可以更快地将响应返回给用户。使用文件存储引擎执行此操作的最佳方法是什么？

谢谢你的建议！

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-22T16:35:38.210

我对这个问题采取了另一种方法。

我的模型有 2 个文件字段，一个使用标准文件存储后端，另一个使用 s3 文件存储后端。当用户上传文件时，它会存储在本地。

我的应用程序中有一个管理命令，它将所有本地存储的文件上传到 s3 并更新模型。

因此，当请求文件时，我检查模型对象是否使用 s3 存储字段，如果是，我将重定向发送到 s3 上的正确 url，如果不是，我发送重定向，以便 nginx 可以从磁盘提供文件.

这个管理命令当然可以由 cronjob 或其他任何事件触发。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-05-11T14:01:49.737

可以让您的用户使用特殊表单（在隐藏字段中带有加密的策略文档）从浏览器直接将文件上传到 S3。上传完成后，它们将被重定向回您的应用程序。

更多信息在这里： http: [//developer.amazonwebservices.com/connect/entry.jspa ?externalID=1434](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1434)

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2012-03-21T06:18:09.447

有一个应用程序:-)

[https://github.com/jezdez/django-queued-storage](https://github.com/jezdez/django-queued-storage)

它完全满足您的需求 - 甚至更多，因为您可以设置任何“本地”存储和任何“远程”存储。此应用程序会将您的文件存储在快速的“本地”存储（例如 MogileFS 存储）中，然后使用[Celery](http://celeryproject.org/) (django-celery)，将尝试异步上传到“远程”存储。

几点说明：

1.  棘手的是 - 您可以将其设置为复制和上传，或上传和删除策略，一旦上传就会删除本地文件。

2.  第二个棘手的事情 - 它将从“本地”存储中提供文件，直到它没有被上传。

3.  它还可以配置为在上传失败时进行重试次数。

安装和使用也非常简单明了：

```
pip install django-queued-storage 
```

附加到`INSTALLED_APPS`：

```
INSTALLED_APPS += ('queued_storage',) 
```

在`models.py`：

```
from queued_storage.backends import QueuedStorage
queued_s3storage = QueuedStorage(
    'django.core.files.storage.FileSystemStorage',
    'storages.backends.s3boto.S3BotoStorage', task='queued_storage.tasks.TransferAndDelete')

class MyModel(models.Model):
    my_file = models.FileField(upload_to='files', storage=queued_s3storage) 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-22T14:01:38.783

你可以解耦这个过程：

*   用户选择要上传的文件并将其发送到您的服务器。在此之后，他看到一个页面“感谢您上传 foofile.txt，它现在存储在我们的存储后端”
*   当用户上传文件时，它会存储在您的服务器上的临时目录中，如果需要，一些元数据会存储在您的数据库中。
*   然后，您服务器上的后台进程将文件上传到 S3。这只有在您拥有对服务器的完全访问权限时才有可能，这样您就可以为此创建某种“守护程序”（或简单地使用 cronjob）。*
*   显示的页面异步轮询并向用户显示某种进度条（或简单的“请等待”消息。仅当用户应该能够“使用”（将其放入消息中，或类似的东西）上传后直接。

[*：如果您只有一个共享主机，您可以构建一些解决方案，在用户浏览器中使用隐藏的 iframe 来启动脚本，然后将文件上传到 S3]

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-04-16T03:11:57.253

您可以直接将媒体上传到 s3 服务器，而无需使用 Web 应用程序服务器。

请参阅以下参考资料：

亚马逊 API 参考：[http ://docs.amazonwebservices.com/AmazonS3/latest/dev/index.html?UsingHTTPPOST.html](http://docs.amazonwebservices.com/AmazonS3/latest/dev/index.html?UsingHTTPPOST.html)

一个 django 实现：[https ://github.com/sbc/django-uploadify-s3](https://github.com/sbc/django-uploadify-s3)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-12T10:50:19.930

我在上传图片时遇到了同样的问题。您不能将文件传递给 Celery 工作人员，因为 Celery 需要能够腌制任务的参数。我的解决方案是将图像数据解构为一个字符串并从文件中获取所有其他信息，将这些数据和信息传递给我重建图像的任务。之后，您可以保存它，它会将其发送到您的存储后端（例如 S3）。如果要将图像与模型相关联，只需将实例的 id 传递给任务并在那里检索它，将图像绑定到实例并保存实例。

当文件通过表单上传时，它在您的视图中作为 UploadedFile 类文件对象可用。您可以直接从 request.FILES 中获取它，或者最好先将其绑定到您的表单，运行 is_valid 并从 form.cleaned_data 检索类似文件的对象。在这一点上，至少你知道它是你想要的那种文件。之后，您可以使用 read() 获取数据，并使用其他方法/属性获取其他信息。见[https://docs.djangoproject.com/en/1.4/topics/http/file-uploads/](https://docs.djangoproject.com/en/1.4/topics/http/file-uploads/)

实际上，我最终编写并分发了一个小包来异步保存图像。看看[https://github.com/gterzian/django_async](https://github.com/gterzian/django_async)是的，它只是用于图像，你可以分叉它并为你的情况添加功能。我将它与[https://github.com/duointeractive/django-athumb](https://github.com/duointeractive/django-athumb)和 S3一起使用

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-05T08:28:12.970

由于这里的一些答案建议直接上传到 S3，这里有一个使用 plupload 的 Django S3 Mixin： [https ://github.com/burgalon/plupload-s3mixin](https://github.com/burgalon/plupload-s3mixin)

# sed - 如何从历史中复制命令？

> ID：670446
> 
> 赞同：0
> 
> 时间：2009-03-22T02:33:41.247
> 
> 标签：sed, awk, history

我尝试从历史记录中复制命令。如何复制第 510 条命令？请看下面的数据。我的赌注是：

```
history | grep 510 | sed '1q;d' | awk '{print $2-$10}' | pbcopy 
```

但输出为0。我不明白原因。命令有什么问题？

```
 505  find . -perm=750 -print0 | xargs -0 chmod 750
  506  find . --perm=750 -print0 | xargs -0 chmod 750
  507  find . -perm=750 -print0 | xargs -0 chmod 750
  508  find . -perm=750 -print0 | xargs -0 chmod 750
  510  find . -perm 750 -print0 | xargs -0 chmod 750
  512  history | grep perm 750 -print0 | pbcopy 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-22T02:43:31.957

如果您使用的是 bash：

```
echo "!510" | pbcopy 
```

（另见[bash 手册](http://www.gnu.org/software/bash/manual/bashref.html#History-Interaction)中的“历史扩展” ）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T02:37:56.493

`510`您可以使用 perl 打印除请求行的第一列 ( ) 之外的所有内容：

```
history | perl -ane 'print "@F[1..$#F]" if($F[0]==510)' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-23T15:58:32.037

对于 awk 中的一系列字段，您需要一个 for 循环。你正在做的是减法，因此结果为零。

通常 cut 命令执行提取列的任务，但有时 awk 更合适。

这就是你的意思。

```
history | grep 510 | sed 1q \
 | awk '{for(i = 2; i <= NF; i++){ORS = (i == NF ? "\n" : " "); print $i;}}' \
 | pbcopy 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T02:38:04.887

原因是`$2`and`$10`不是 awk 脚本中的数字。字段的索引是从 1 开始的，所以如果你想要`750`，第一个是`$5`，第二个是`$11`。

请注意，这与带有“ `-perm=750`”的行不同

# mysql - 应用逆向工程 MySQL 和 PostgreSQL 数据库？

> ID：670450
> 
> 赞同：13
> 
> 时间：2009-03-22T02:35:55.453
> 
> 标签：mysql, postgresql, reverse-engineering

是否有应用程序对 mysql 和/或 postgre 中的现有数据库进行逆向工程？

我有兴趣从现有的数据库图获取数据库图，类似于它可以在 MSSQL Server 中完成

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-22T02:52:48.877

对于 MySQL，请尝试[MySQL Workbench](http://dev.mysql.com/workbench/)。

对于 MySQL 和 PostgreSQL，请尝试[TOAD Data Modeler](http://www.toadworld.com/products/toad-data-modeler)。

如果您使用开源图表应用[Dia](http://live.gnome.org/Dia)，有[多种工具](http://wiki.gnome.org/Apps/Dia/Links)可以从包括 MySQL 和 PostgreSQL 在内的 SQL 数据库生成 Dia 图表。

* * *

**更新：** 除了 SQL 脚本之外，MySQL Workbench 5.2 还支持来自实时数据库的逆向工程图。MySQL Workbench 5.2 刚刚[宣布](http://wb.mysql.com/?p=569)了他们的 Release Candidate 1（截至 2010 年 5 月 12 日）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-08-04T07:19:51.120

[SchemaSpy](http://schemaspy.sourceforge.net/)是逆向工程的一个很好的选择。对于图表位，它使用另一个工具[GraphViz](http://www.graphviz.org/)。为了让所有东西协同工作，请确保已安装 GraphViz，并且 SchemaSpy 可以访问其 bin 的路径。

这是一个[示例输出](http://schemaspy.sourceforge.net/sample/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T02:41:32.973

[企业架构师](http://www.sparxsystems.com.au/products/ea/index.html)

> 从许多流行的 DBMS 系统进行逆向工程，包括 Oracle 9i 和 10g、SQL Server、My SQL、Access、PostgreSQL 等

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-10-09T16:08:35.820

我推荐[DBeaver](https://dbeaver.io/)：多平台、免费、开源，连接最流行的数据库引擎并支持逆向工程。

我已经尝试过对 MySQL DB 和 PostgreSQL DB 进行逆向工程，它就像一个魅力:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-10T14:28:14.597

用于 postgres 的 pgDesigner，用于 mysql 的 mysql 工作台...

# crystal-reports - 水晶报表：全局子报表变量总和未转移到父主报表

> ID：670459
> 
> 赞同：1
> 
> 时间：2009-03-22T02:44:19.847
> 
> 标签：crystal-reports, subreport

我正在运行水晶报表 11，主报表中有一个计算余额的子报表。在子报表余额中，我有一个名为 balancetotal 的公式，它手动汇总了 tarinvoice.balance 字段的运行总计。

```
WhileReadingRecords;
global numbervar balancetotal;
balancetotal := balancetotal + {tarInvoice.Balance} 
```

在主父报表中，我有一个名为 balancetotal 的公式，其中包含以下公式：

```
 global numbervar balancetotal;
    balancetotal; 
```

这是不正确的吗？

提前致谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T21:40:09.070

没关系。我应该使用“共享”而不是“全局”

# linux - 移动除一个以外的所有文件

> ID：670460
> 
> 赞同：183
> 
> 时间：2009-03-22T02:44:38.147
> 
> 标签：linux, bash, glob

如何移动除一个以外的所有文件？我正在寻找类似的东西：

```
'mv ~/Linux/Old/!Tux.png ~/Linux/New/' 
```

我将旧东西移动到新东西文件夹的地方，除了`Tux.png`. !-符号表示否定。有什么工具可以完成这项工作吗？

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2009-03-22T02:53:55.270

如果您使用 bash 并设置了`extglob`shell 选项（通常是这种情况）：

```
mv ~/Linux/Old/!(Tux.png) ~/Linux/New/ 
```

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2009-04-25T14:26:54.493

将以下内容放入您的 .bashrc

```
shopt -s extglob 
```

它扩展了正则表达式。然后，您可以移动除一个以外的所有文件

```
mv !(fileOne) ~/path/newFolder 
```

## 与其他命令相关的异常

请注意，在复制目录时，不能在线程中注意到的名称中使用正向闪存[Why extglob except break except condition?](https://stackoverflow.com/a/31597198/54964) ：

```
cp -r !(Backups.backupdb) /home/masi/Documents/ 
```

所以`Backups.backupdb/`在否定之前这里是错误的，我不会在移动目录中使用它，因为有可能错误地使用其他命令和可能的其他异常。

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2009-03-22T04:06:19.900

我会采用传统的 find & xargs 方式：

```
find ~/Linux/Old -maxdepth 1 -mindepth 1 -not -name Tux.png -print0 | 
    xargs -0 mv -t ~/Linux/New 
```

`-maxdepth 1`使其不递归搜索。如果你只关心文件，你可以说`-type f`. `-mindepth 1`使其不将`~/Linux/Old`路径本身包含在结果中。适用于任何文件名，包括那些包含嵌入换行符的文件名。

一条评论指出 mv`-t`选项可能是 GNU 扩展。对于没有它的系统

```
find ~/Linux/Old -maxdepth 1 -mindepth 1 -not -name Tux.png \
    -exec mv '{}' ~/Linux/New \; 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-03-22T02:52:37.520

一种快速的方法是修改 tux 文件名，以便您的移动命令不匹配。

例如：

```
mv Tux.png .Tux.png

mv * ~/somefolder

mv .Tux.png Tux.png 
```

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2016-12-23T11:35:15.250

我认为最简单的方法是使用反引号

```
mv `ls -1 ~/Linux/Old/ | grep -v Tux.png` ~/Linux/New/ 
```

编辑：

将反斜杠与 ls 一起使用以防止将其与别名一起使用，即大多数情况下 ls 被别名为 ls --color。

```
mv `\ls -1 ~/Linux/Old/ | grep -v Tux.png` ~/Linux/New/ 
```

谢谢@Arnold Roa

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-03-22T03:00:27.717

对于 bash，[某事的答案](https://stackoverflow.com/questions/670460/move-all-files-except-one/670475#670475)是正确的。这是[zsh](http://www.zsh.org/)（我选择的 shell）语法：

```
mv ~/Linux/Old/^Tux.png ~/Linux/New/ 
```

需要`EXTENDED_GLOB`设置 shell 选项。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2011-04-29T01:01:45.510

对于排除某些文件或目录的简单移动，我发现这更安全、更容易依赖。

```
ls -1 | grep -v ^$EXCLUDE | xargs -I{} mv {} $TARGET 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-03-29T00:40:33.223

以下不是 100% 保证的方法，根本不应该尝试编写脚本。但有时它对于快速交互式 shell 使用来说已经足够了。一个文件文件 glob 像

```
[abc]* 
```

（将匹配名称以 a、b 或 c 开头的所有文件）可以通过先插入“^”字符来否定，即

```
[^abc]* 
```

我有时会使用它来匹配“lost+found”目录，例如：

```
mv /mnt/usbdisk/[^l]* /home/user/stuff/. 
```

当然，如果还有其他以 l 开头的文件，我必须在之后处理这些文件。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2020-03-21T04:01:57.173

这可能更简单，更容易记住，它对我有用。

`mv $(ls ~/folder | grep -v ~/folder/exclude.png) ~/destination`

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2019-01-09T10:37:38.347

怎么样：

```
mv $(echo * | sed s:Tux.png::g) ~/Linux/New/ 
```

不过，您必须在文件夹中。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-03-22T02:55:17.997

```
mv `find Linux/Old '!' -type d | fgrep -v Tux.png` Linux/New 
```

find 命令列出所有常规文件，fgrep 命令过滤掉所有 Tux.png。反引号告诉 mv 移动生成的文件列表。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2018-06-25T18:23:23.320

这可以在没有`grep`这样的情况下完成：

```
ls ~/Linux/Old/ -QI Tux.png | xargs -I{} mv ~/Linux/Old/{} ~/Linux/New/ 
```

注意：`-I`是大写的 i 并使`ls`命令忽略后面列出的 Tux.png 文件。

的输出`ls`然后通过管道传输到`mv`via `xargs`，这允许使用 ls 的输出作为 mv 的源参数。

`ls -Q`只引用 ls 列出的文件名。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2014-12-16T06:26:44.590

```
ls ~/Linux/Old/ | grep -v Tux.png | xargs -i {} mv ~/Linux/New/' 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-10-12T02:15:31.720

例如，将所有文件（不包括文件除外）移动到 except_file
`find -maxdepth 1 -mindepth 1 -not -name except_file -print0 |xargs -0 mv -t ./except_file`
（缓存是当前文件除外）
`find -maxdepth 1 -mindepth 1 -not -name cache -print0 |xargs -0 mv -t ./cache`

# oracle - Oracle 是否有等效于 SQL Server 的表变量？

> ID：670461
> 
> 赞同：36
> 
> 时间：2009-03-22T02:44:50.440
> 
> 标签：oracle

在 SQL Server 中，您可以声明一个表变量 ( `DECLARE @table TABLE`)，该变量在脚本运行时生成，然后从内存中删除。

甲骨文有类似的功能吗？或者我是否坚持`CREATE`/`DROP`分割我的硬盘驱动器的语句？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-22T02:55:14.737

是的。

> 在 PL/SQL 声明块中声明 TABLE TYPE 变量。表变量也称为索引表或数组。表变量包含一列，该列必须是标量或记录数据类型加上 BINARY_INTEGER 类型的主键。句法：
> 
> DECLARE TYPE type_name IS TABLE OF (column_type | variable%TYPE | table.column%TYPE [NOT NULL] INDEX BY BINARY INTEGER;
> 
> -- 然后声明一个这种类型的TABLE变量：variable_name type_name;
> 
> -- 为 TABLE 变量赋值：variable_name(n).field_name := 'some text'; -- 其中 'n' 是索引值

参考：[http ://www.iselfschooling.com/syntax/OraclePLSQLSyntax.htm](http://www.iselfschooling.com/syntax/OraclePLSQLSyntax.htm)

您可能还想看看[Global Temporary Tables](http://www.oracle-base.com/articles/8i/TemporaryTables.php)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-03-06T18:12:44.330

下面的解决方案是我今天能做的最接近 SQL Server 的解决方案。

对象：

```
    创建或替换类型 T_NUMBERS 是数字表；

    创建或替换函数累加（vNumbers T_NUMBERS）
    返回 T_NUMBERS 个
    作为
       vRet T_NUMBERS;
    开始
       选择总和（COLUMN_VALUE）
       批量收集到 vRet
       FROM TABLE(CAST(vNumbers AS T_NUMBERS));

       返回 vRet；
    结尾;

```

查询：

```
    --查询1：固定号码列表。
    选择 *
    从表（累积（T_NUMBERS（1、2、3、4、5）））；

    --查询2：查询的号码列表。
    与 cteNumbers 作为
    (
      从 DUAL UNION 中选择 1 作为 COLUMN_VALUE
      从双重联合中选择 2 作为 COLUMN_VALUE
      从双重联合中选择 3 作为 COLUMN_VALUE
      从双重联合中选择 4 作为 COLUMN_VALUE
      从 DUAL 中选择 5 作为 COLUMN_VALUE
    )
    选择 *
    从表（
            积累（
              (SELECT CAST(COLLECT(COLUMN_VALUE) AS T_NUMBERS)
               来自 cteNumbers)
            )
          );

```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T03:00:24.910

是的，它确实有一个可以保存查询结果集的类型（如果我能猜到 TABLE 的作用）。从[问汤姆](http://asktom.oracle.com)：您的程序可能如下所示：

```
procedure p( p_state in varchar2, p_cursor in out ref_cursor_type )
is
begin
    open p_cursor for select * from table where state = P_STATE;
end; 
```

其中 p_cursor 就像一个表类型。正如已经回答的那样，在 Oracle 中存储结果集有很多选择。通常，Oracle PL/SQL 比 sqlserver 脚本强大得多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-13T13:12:06.127

oracle 中的表变量与 MS SQLServer 中的表变量不同。在 oracle 中，它就像 java 或 c# 中的常规数组。但在 MS SQLserver 中它与任何表相同，您可以将其称为逻辑表。但是如果你想要在 oracle 中与 SQLserver 的表变量完全相同的东西，你可以使用 cursor。

问候

# asp.net - 下拉列表不会在页面重新加载时重置

> ID：670464
> 
> 赞同：5
> 
> 时间：2009-03-22T02:46:16.397
> 
> 标签：asp.net, drop-down-menu, reload

嘿，...非常简单的问题

我通常编写 php，但碰巧现在正在使用 ASP.NET 3.0 框架进行编程，但不知道如何解决这个问题。

我有一个 DropdownList ，如果我选择了一个值，......我后面的代码做了一堆东西并输出数据......

现在，...如果我重新加载页面（即按 F5 或浏览器上的小重新加载）....我所有的数据都会重置，就好像我的 selectedIndex 是 0....但实际显示的值是前一个我选择的一个！...我尝试在“if ispostback = false”语句中重置我的代码中的索引...但没有任何效果...就像值被缓存并且我无能为力它...

...任何帮助，将不胜感激 ：）

（进一步解释： ....如果从我的页面加载子中打印到屏幕 mydropdownlist.selectedIndex ...它将返回 0 ....但是屏幕上的选定索引显然不是 0 ....我明白为什么会这样……我只需要阻止它……或者至少有一种方法可以确定视图状态下的索引……）

安德鲁

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T02:53:08.627

这是表单域的正常行为。浏览器通常会尝试记住文本字段的内容、复选框的状态以及下拉菜单中的选定项目，例如页面重新加载和后退/前进等事件。

因此，您不应在脚本初始化期间假设表单字段的值与您在 HTML 中提供的内容相匹配。让脚本在页面加载时嗅探它们的当前值并相应地设置其变量和 DOM 状态。

如果您真的想在重新加载/导航时丢弃所有用户表单字段更改，请在脚本初始化中调用[form.reset()](http://www.w3.org/TR/DOM-Level-2-HTML/html.html#ID-76767677)以将其返回到 HTML 状态。但这在正常情况下可能对用户非常不友好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T05:18:34.487

听起来当您按 f5 时，您并没有重新加载新页面。你说当你从下拉列表中选择一些东西时，你会在后面做一堆代码。好吧，该操作是回发。因此，在该操作之后点击 f5 不会被视为对页面的新调用，因此 if (IsPostBack == false) 将失败，因为它是回发。

您的第一个操作导致它成为回发，因此在此之后按 f5 将成为回发。

听起来您可能也有一些视图状态问题，因为您的其他控件正在重置。尽管如果您使用客户端脚本进行隐藏/显示，但无论如何它们都不会通过视图状态持续存在。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T02:55:00.947

如果不需要，请尝试[禁用复选框上的 veiwstate 。](http://msdn.microsoft.com/en-us/library/system.web.ui.control.enableviewstate.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T02:49:34.313

您是否尝试清除浏览器中的缓存？大多数浏览器都支持 Control+F5 作为硬刷新，它将清除当前页面的缓存并从服务器重新加载整个页面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-24T18:05:30.997

问候，一旦选择了另一个下拉列表中的值，我也试图清除下拉列表。当用户提交表单时，应该只有一个具有值的下拉列表。I have started the code as shown below but the drop-down will not reset itself when a value from the other drop-down is selected. 我确定我遗漏了一些非常简单的东西，或者我的命名已关闭。谢谢。

```
enter code 
```

`<%@ Page Language="C#" AutoEventWireup="true" CodeFile="homepagestate.aspx.cs" 继承="_homepagestate"%>

```
< form id="form1" runat="server"> 
```

<asp:DropDownList ID="DropDownList1" runat="server" AutoPostBack="true" OnSelectedIndexChanged="sel"> <asp:ListItem Value="-选择一个或多个状态-"></asp:ListItem> <asp: ListItem Value="ALABAMA"></asp:ListItem>

```
 < /asp:DropDownList> 
```

<asp:DropDownList ID="DropDownList2" runat="server" AutoPostBack="true"> <asp:ListItem Value="-Select One-"></asp:ListItem> </asp:DropDownList>

```
 < asp:Button ID="Button1" runat="server" Text="Submit" /></div>
</form> 
```

使用系统；

使用 System.Data；

使用 System.Configuration；

使用 System.Collections；

使用 System.Web；

使用 System.Web.Security；

使用 System.Web.UI；

使用 System.Web.UI.WebControls；

使用 System.Web.UI.WebControls.WebParts；

使用 System.Web.UI.HtmlControls；

公共部分类_homepagestate：System.Web.UI.Page

{

```
protected void Page_Load(object sender, EventArgs e)

{

    if ( !IsPostBack )

    {

       // sel();

        DropDownList2.SelectedIndex = 0;

    } 
```

}

```
protected void sel(object sender, EventArgs e)

{

    Response.Write(DropDownList2.SelectedIndex);

    //DropDownList2.selecteditem = 0;

} 
```

}

'

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-03T15:48:57.027

这实际上来自 parrkid 的另一个 stackoverflow 问题，但在页面末尾添加：

```
<script language="javascript">
  var B01 = document.getElementById('<%=YourDropDownList.ClientID%>');
  B01.selectedIndex = 0;
</script> 
```

是的...对于可能是 asp.net 但恕我直言的总黑客攻击 :-P

# c++ - 使用 boost::iostreams::tee_device？

> ID：670465
> 
> 赞同：7
> 
> 时间：2009-03-22T02:48:27.280
> 
> 标签：c++, stream, iostream, boost-iostreams

有人能帮我吗？

我正在尝试执行以下操作：

```
#include <boost/iostreams/tee.hpp>
#include <boost/iostreams/stream.hpp>
#include <sstream>  
#include <cassert>  

namespace io = boost::iostreams;
typedef io::stream<io::tee_device<std::stringstream, std::stringstream> > Tee;
std::stringstream ss1, ss2;
Tee my_split(ss1, ss2); // redirects to both streams
my_split << "Testing";
assert(ss1.str() == "Testing" && ss1.str() == ss2.str()); 
```

但它不会在 VC9 中编译：

```
c:\lib\boost_current_version\boost\iostreams\stream.hpp(131) : error C2665: 'boost::iostreams::tee_device<Sink1,Sink2>::tee_device' : none of the 2 overloads could convert all the argument types 
```

有没有人让这个工作？我知道我可以让自己的班级去做，但我想知道我做错了什么。

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-22T03:29:41.937

您使用 的[构造函数转发版本](http://www.boost.org/doc/libs/1_38_0/libs/iostreams/doc/guide/generic_streams.html#stream_forwarding_constructors)，`io::stream`它自己构造一个 tee-stream 并将所有参数转发给它。C++03 在将参数转发给函数时只有有限的能力（需要的重载数量很容易成倍增长）。它 ( `io::stream`) 做出以下限制：

> 这些成员中的每一个都构造一个流实例，并将它与从给定参数列表构造的设备 T 的实例相关联。*涉及的 T 构造函数必须通过值或 const 引用获取所有参数。*

好吧，但是`tee_device`构造函数说

> 根据给定的一对接收器构造 tee_device 的实例。如果相应的模板参数是流或流缓冲区类型，则每个函数参数都是非 const 引用，否则是 const 引用。

这当然行不通。`io::stream`提供了另一个以 a`T`作为第一个参数的构造函数。这在这里有效（至少编译。但断言失败。我没有使用过，`boost::iostreams`所以我无能为力）

```
namespace io = boost::iostreams;
typedef io::tee_device<std::stringstream, std::stringstream> TeeDevice;
typedef io::stream< TeeDevice > TeeStream;
std::stringstream ss1, ss2;
TeeDevice my_tee(ss1, ss2); 
TeeStream my_split(my_tee);
my_split << "Testing";
assert(ss1.str() == "Testing" && ss1.str() == ss2.str()); 
```

编辑：调用`flush()`或流式处理后`<< std::flush`，断言通过。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T03:02:33.203

可能您需要像这样设置它：

```
typedef io::tee_device<std::stringstream, std::stringstream> Tee;
typedef io::stream<Tee> TeeStream;

std::stringstream ss1, ss2;
Tee my_tee(ss1, ss2);
TeeStream my_split(my_tee); 
```

# bash - 如何在 Bash 中管理长路径？

> ID：670488
> 
> 赞同：9
> 
> 时间：2009-03-22T03:02:54.950
> 
> 标签：bash, path

我在管理长路径时遇到了问题。我怎样才能快速到达像这样的路径

```
/Users/User/.../.../.../.../.../Dev/C/card.c 
```

我尝试了别名

```
alias cd C='cd /Users/User/.../.../.../.../.../Dev/C' 
```

但我无法为两个单独的单词做别名。我在 CDPATH 中有很长的 Bash 别名和路径列表，所以我犹豫要不要让它们更多。如何管理长路径？

**[回复的想法]**

用户litb的回复暴露了我在管理上的一些问题。诸如“CTRL+R”、“!-3:1:2:4:x”和“增量搜索”之类的东西对我来说很难。它们可能有助于浏览长目录，从某种意义上说，也有助于管理。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-24T10:06:30.050

使用*符号链接*可能是最好的主意；但是您可以比将它们全部转储到您的主目录更容易。

正如您所提到的，BASH 有一个称为**CDPATH**的功能，在这里非常方便。

只需在您的主目录中创建一个隐藏文件夹（这样它就不会使您的主目录过于混乱）：

```
$ mkdir ~/.paths
$ cd ~/.paths
$ ln -s /my/very/long/path/name/to/my/project project
$ ln -s /some/other/very/long/path/to/my/backups backups
$ echo 'CDPATH=~/.paths' >> ~/.bashrc
$ source ~/.bashrc 
```

这会在您的主目录中创建一个名为“.paths”的目录，其中包含指向您经常使用的所有长目录位置的符号链接，然后将 CDPATH bash 变量设置为该目录（在您的 .bashrc 中）并重新读取 .bashrc 文件。

*现在，您可以从任何地方*前往任何这些路径：

```
$ cd project
$ cd backups 
```

留给您一个简短的 CDPATH，没有杂乱的别名，更重要的是：一种非常简单的方法，可以从**其他应用程序**（例如 UI 应用程序）导航到那些长路径，只需进入 ~/.paths 或将该目录添加到您的 UI 应用程序的侧边栏左右。

可能是您可以拥有的最简单的全方位解决方案。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-22T03:07:05.237

考虑使用符号链接。我有一个`~/work/`目录，可以在其中放置指向所有当前项目的符号链接。

你也可以使用 shell 变量：

```
c='/Users/User/.../.../.../.../.../Dev/C' 
```

然后：

```
cd "$c" 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-22T03:05:54.367

在您的主目录（或您选择的其他地方）中创建符号链接

`ln -s` *longDirectoryPath ~/MySymLinkName*

有关`man ln`更多详细信息，请参阅。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-22T03:54:11.427

可能最简单的解决方案是使用：

```
alias cdc='cd /Users/User/.../.../.../.../.../Dev/C'
alias cdbin='cd /Users/User/.../.../.../.../.../Dev/bin'
alias cdtst='cd /Users/User/.../.../.../.../.../Dev/tst' 
```

如果您一次只真正从事一个项目。如果您处理多个项目，则可能有另一个别名来更改上述别名中的目录。

所以，你会使用类似的东西：

```
proj game17
cdc
make
proj roman_numerals
cdbin
rm -f *
proj game17 ; cdc 
```

由于这是一个有用的东西，我决定整理一系列可以使用的脚本。它们都基于您放置在主目录中的配置文件，以及源脚本的别名。该文件`"~/.cdx_data"`的格式为：

```
scrabble:top=~/dev/scrabble
scrabble:src=~/dev/scrabble/src
scrabble:bin=~/dev/scrabble/bin

sudoku:top=~/dev/scrabble
sudoku:src=~/dev/scrabble/src
sudoku:bin=~/dev/scrabble/bin
sudoku:data=~/dev/scrabble/data 
```

并列出所有相关项目（本例中为 scrabble 和 sodoku）及其目录（每个项目可能不同，但在本例中具有 top、bin、src 和 data）。

第一个动作是初始化东西，所以放：

```
. ~/.cdx_init 
```

在您的 .bash_profile 末尾并将`"~/.cdx_init"`文件创建为：

```
alias cdxl='. ~/.cdx_list'
alias projl='. ~/.cdx_projlist'
alias cdx='. ~/.cdx_goto'
alias proj='. ~/.cdx_proj' 
```

这设置了四个别名来获取我将在下面包含的文件。用法是：

```
cdxl     - List all directories in current project.

projl    - List all projects.

proj     - Show current project.
proj <p> - Set current project to <p> (if allowed).

cdx      - Show current project/directory and expected/actual real
           directory, since they can get out of sync if you mix cd and cdx.
cdx .    - Set actual real directory to expected directory (in other words,
           get them back into sync).
cdx <d>  - Set directory to <d> (if allowed). 
```

实际脚本如下。首先，`".cdx_list"`它只列出了当前项目中允许的目录（管道被分成多行以提高可读性，但它们都应该在一行上）。

```
echo "Possible directories are:"
cat ~/.cdx_data
    | grep "^${CDX_PROJ}:"
    | sed -e 's/^.*://' -e 's/=.*$//'
    | sort -u
    | sed 's/^/    /' 
```

同样，`".cdx_projlist"`显示所有可能的项目：

```
echo "Possible projects are:"
cat ~/.cdx_data
    | grep ':'
    | sed 's/:.*$//'
    | sort -u
    | sed 's/^/    /' 
```

在丰富的脚本中，`".cdx_proj"`设置和/或显示当前项目：

```
if [[ "$1" != "" ]] ; then
    grep "^$1:" ~/.cdx_data >/dev/null 2>&1
    if [[ $? != 0 ]] ; then
        echo "No project name '$1'."
        projl
    else
        export CDX_PROJ="$1"
    fi
fi
echo "Current project is: [${CDX_PROJ}]" 
```

并且`".cdx_goto"`对于项目中的目录是相同的：

```
if [[ "$1" == "." ]] ; then
    CDX_TMP="${CDX_DIR}"
else
    CDX_TMP="$1"
fi
if [[ "${CDX_TMP}" != "" ]] ; then
    grep "^${CDX_PROJ}:${CDX_TMP}=" ~/.cdx_data >/dev/null 2>&1
    if [[ $? != 0 ]] ; then
            echo "No directory name '${CDX_TMP}' for project '${CDX_PROJ}'."
            cdxl
    else
            export CDX_DIR="${CDX_TMP}"
            cd $(grep "^${CDX_PROJ}:${CDX_DIR}=" ~/.cdx_data
                | sed 's/^.*=//'
                | head -1
                | sed "s:^~:$HOME:")
    fi
fi
CDX_TMP=$(grep "^${CDX_PROJ}:${CDX_DIR}=" ~/.cdx_data
    | sed 's/^.*=//'
    | head -1
    | sed "s:^~:$HOME:")
echo "Current project   is: [${CDX_PROJ}]"
echo "Current directory is: [${CDX_DIR}]"
echo "                      [${CDX_TMP}]"
echo "Actual  directory is: [${PWD}]"
unset CDX_TMP 
```

它使用三个保留供自己使用的环境变量`"CDX_PROJ"`：`"CDX_DIR"`和`"CDX_TMP"`。除了这些以及上述文件和别名之外，没有使用其他资源。这是我能想到的最简单但适应性最强的解决方案。祝你好运。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-10-02T16:41:22.020

重访。今天我从一个社交书签网站收到了这个链接，然后我立刻想起了这个问题：

**[用 bm 导航](http://www.bookmark-tools.com/articles/1.html)**

> 我们保留一个简单的纯文本书签文件，并使用名为 bm 的工具进行查找。该工具还可用于动态编辑书签索引，如下所示，我们将上一个示例中的目录添加到索引中。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-22T04:31:35.113

一旦我 cd'ed 进入这么长的目录，我就会在历史记录中找到它。然后我只需输入`Ctrl-R`“（reverse-i-search）”提示并输入几个字符，就像`Dev/C`出现在路径中的某处一样，它向我显示了我当时发出的命令，我可以轻松地再次跳转到它.

这在实践中效果很好。因为如果您有一段时间没有输入该路径，它将找不到条目，​​这意味着做一些让事情变得更容易的工作可能不值得花时间。但是，如果您最近使用它，它肯定会找到它。这正是我需要的。

在某种程度上，它是长命令和路径名的自组织缓存:)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-24T09:32:20.753

您可能需要考虑在 .bashrc 中使用[这样的脚本。](https://stackoverflow.com/questions/188162/what-is-the-most-useful-script-youve-written-for-everyday-life/245784#245784)自从我阅读那篇文章以来，我每天都在使用它。非常有用。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-25T04:15:01.103

用户 jhs 建议使用 Pushd 和 Popd-commands。我在这里分享一些我在 Unix Power Tools -book 中找到的 Bash 脚本。当您的目录太长时，它们非常酷:)

```
#Moving fast between directories 
alias pd=pushd 
alias pd2='pushd +2'  
alias pd3='pushd +3' 
alias pd4='pushd +4' 
```

命令'pushd +n'“旋转”堆栈。反向命令“popd +n”删除堆栈的第 n 个条目。如果您的堆栈太长，请使用“repeat n popd”。例如，您的堆栈有 12 个目录长：

```
repeat 11 popd 
```

当你想查看你的堆栈时，写'pushd'。为了进一步阅读，我推荐第 625-626 页的书。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-03-29T14:04:47.507

在你的 .bashrc 中找到

```
PS1='${debian_chroot:+($debian_chroot)}[\033[01;32m]\u@\h[\033[00m]:[\033[01;34m]
 \W[\033[00m]\$ '
```

and replace the **\w** with **\W**.I already have it changed here. This will only give you the main directory where you are working. You can get the full directory by typing `pwd`

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-26T20:33:12.960

有一些基本的众所周知的想法，比如创建别名：

```
alias cdfoo="cd /long/path/to/foo" 
```

还有“丢卵石”

```
export foo=/long/path/to/foo 
```

并且还使上述“基于项目”。我使用“基于票证”的目录。

```
 topdir=ticket_12345
 alias cdfoo="cd home/me/sandbox/$topdir/long/path/to/foo"
 export foo="/home/me/sandbox/$topdir/long/path/to/foo" 
```

但除此之外，有时使用命令行菜单来回跳转到您最近去过的地方也很方便。（pushd 和 popd 很麻烦，恕我直言）。

我使用 acd_func.sh（如下所列）。一旦定义，你可以做

光盘——

查看最近的目录列表，带有数字菜单

光盘 -2

转到第二个最近的目录。

非常容易使用，非常方便。

这是代码：

```
 # Insert into .profile, .bash_profile or wherever
    # acd_func 1.0.5, 10-nov-2004
    # petar marinov, http:/geocities.com/h2428, this is public domain

    cd_func ()

{
  local x2 the_new_dir adir index
  local -i cnt

  if [[ $1 ==  "--" ]]; then
    dirs -v
    return 0
  fi

  the_new_dir=$1
  [[ -z $1 ]] && the_new_dir=$HOME

  if [[ ${the_new_dir:0:1} == '-' ]]; then
    #
    # Extract dir N from dirs
    index=${the_new_dir:1}
    [[ -z $index ]] && index=1
    adir=$(dirs +$index)
    [[ -z $adir ]] && return 1
    the_new_dir=$adir
  fi

  #
  # '~' has to be substituted by ${HOME}
  [[ ${the_new_dir:0:1} == '~' ]] && the_new_dir="${HOME}${the_new_dir:1}"

  #
  # Now change to the new dir and add to the top of the stack
  pushd "${the_new_dir}" > /dev/null
  [[ $? -ne 0 ]] && return 1
  the_new_dir=$(pwd)

  #
  # Trim down everything beyond 11th entry
  popd -n +11 2>/dev/null 1>/dev/null

  #
  # Remove any other occurence of this dir, skipping the top of the stack
  for ((cnt=1; cnt <= 10; cnt++)); do
    x2=$(dirs +${cnt} 2>/dev/null)
    [[ $? -ne 0 ]] && return 0
    [[ ${x2:0:1} == '~' ]] && x2="${HOME}${x2:1}"
    if [[ "${x2}" == "${the_new_dir}" ]]; then
      popd -n +$cnt 2>/dev/null 1>/dev/null
      cnt=cnt-1
    fi
  done

  return 0
}

alias cd=cd_func

if [[ $BASH_VERSION > "2.05a" ]]; then
  # ctrl+w shows the menu
  bind -x "\"\C-w\":cd_func -- ;"
fi 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-28T18:44:32.113

这也可能是一个有用的功能，可以放入您的`.bashrc`; 它会向上移动多个目录，或者移动到一个命名目录，即，如果你在其中，`/a/b/c/d/`你可以做`up 3`或`up a`最终进入`a`.

我不知道我在哪里找到的；如果你知道，请评论或添加归属。

```
function up()
{
    dir=""
    if [ -z "$1" ]; then
        dir=..
    elif [[ $1 =~ ^[0-9]+$ ]]; then
        x=0
        while [ $x -lt ${1:-1} ]; do
            dir=${dir}../
            x=$(($x+1))
        done
    else
        dir=${PWD%/$1/*}/$1
    fi
    cd "$dir";
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-30T15:15:38.680

如果你想切换到zsh，这很容易——只需使用“alias -g”（全局别名，即在命令中任何地方都可以使用的别名，而不仅仅是第一个单词）。

```
# alias -g c=/my/super/long/dir/name
# cd c
# pwd
/my/super/long/dir/name 
```

在 bash 中，我认为最接近“别名”样式的方法是编写一个函数：

```
function ccd {
  case "$1" in
    c) cd /blah/blah/blah/long/path/number/one ;;
    foo) cd /blah/blah/totally/different path ;;
    "multiword phrase") cd /tmp ;;
  esac
} 
```

这意味着当您需要快捷方式时，使用“cd”以外的命令作为命令，但除此之外，它很灵活；您还可以在该函数中添加一个“ls”，以便它在您 cd 等之后始终提醒您目录中的内容。

（请注意，要使用上面的多字参数，您需要在命令行中引用它，如下所示：

```
ccd "multiword phrase" 
```

所以这并不是那么方便。但如果你需要，它会起作用。）

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-01T20:48:56.603

根据 Andrew Medico 的建议，查看[J](http://wiki.github.com/rupa/j)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-22T03:41:52.253

Look into `pushd`，它允许您维护一堆目录，您可以将其推入、弹出或重新排列。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-25T04:28:37.170

查看[autojmp](http://wiki.github.com/joelthelion/autojump/)或[dirmarks](http://ano.malo.us/archives/directory-bookmarks)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-03-25T20:30:02.770

管理需要快速创建和删除目录。创建多个目录：

```
mkdir -p user/new_dir/new/_dir/.../new_dir 
```

递归删除许多目录（在较低目录中时要非常小心！）：

```
rm -r dir/.../new_dir/ 
```

如需进一步阅读，备忘单可以帮助您：

> [http://www.scribd.com/doc/2082838/Bash-Command-Line-History-Cheat-Sheet](http://www.scribd.com/doc/2082838/Bash-Command-Line-History-Cheat-Sheet)

它包含一些金块，但我发现它很难阅读。我无法让 Meta+> 等命令正常工作。它们可能会帮助您浏览长目录。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-04-01T02:20:47.960

我意识到这个问题已经很老了，但是没有一个脚本让我满意，所以我写了一个新的。

这是我想到的要求：

1) 只使用 bash 命令——我打算在许多不同的 unice 上使用它——Linux、cygwin、HP-UX、AIX 和其他几个，所以我不能依赖 grep 保持一致。幸运的是，我工作的任何地方都有 bash。

2) 短代码——我希望能够将它绑定到 GNU 屏幕中的一个键，然后点击那个键将脚本粘贴到我正在使用的当前 bash shell 中，这样我就不必设置 bash我使用的每个系统上的配置文件。任何超长的东西都会很烦人并且需要太多时间来粘贴。

3) 不使用文件——不想在共享登录中乱扔随机文件。

4) 在正常情况下像“cd”一样行动。不想在我开始输入之前考虑使用哪个命令。

5）提供像这个答案这样的“向上”用法：[如何在 Bash 中管理长路径？](https://stackoverflow.com/questions/670488/how-to-manage-long-paths-in-bash/693290#693290)

6）保留最近使用的目录列表，并切换到最近的。

这是脚本：

```
#Jump History - Isaiah Damron
function jfind() {
    lp=${JNHIST//==${PWD}==/==}
    lp=${lp%%${lp#==*$1*==}}
    lp=${lp##${lp%==*$1*==*}}
    lp=${lp//==/}
    [[ -d "$lp" ]] && echo $lp && return 0
    return 1;
}
function jadd() {
    [[ -z "$JNHIST" ]] && export JNHIST='=='
    [[ 3000 -lt ${#JNHIST} ]] && export JNHIST=${JNHIST:0:3000} && export JNHIST="${JNHIST%==*}=="
    export JNHIST="==$PWD${JNHIST//==${PWD}==/==}"
}
function j() {
    { cd $* 2> /dev/null && jadd; } \
    || { cd ${PWD/$1*/}$1 2> /dev/null && jadd; } \
    || { jfind $1 \
        && { cd $( jfind $1  ) 2> /dev/null && jadd; } ; } \
    || cd $*
}
function jh() {
    [[ -z "$1" ]] && echo -e ${JNHIST//==/\\n} 
    [[ -n "$1" ]] && jfind $1 && cd $(jfind $1) && jadd
} 
```

用法：

```
jh [parameters] 
```

如果单独调用，不带任何参数，它会输出当前历史列表。如果它有一个参数，那么它会在历史中搜索包含字符串 $1 和 cd 的最近使用的目录。

```
j {parameters} 
```

是否`cd parameters`。如果失败，它会检查 $PWD 的任何父目录是否匹配 $1，并 cd 到它。如果失败，则调用`jh $1`. 如果失败，则输出结果`cd parameters`

*注意：我使用 '==' 作为内部分隔符。希望您没有任何包含“==”的目录，但如果您这样做，您将不得不更改脚本。只是：%s/==/whatever/g*

# silverlight - 在 Silverlight 中托管 ASP.NET

> ID：670497
> 
> 赞同：2
> 
> 时间：2009-03-22T03:16:06.340
> 
> 标签：silverlight

是的，我知道 Silverlight 不打算托管 ASP.NET，并且名称空间/类已被删除，但我有一个小型个人/宠物项目，其中来自 Silverlight 的类似 Cassini 的托管功能（仅限本地主机）将是一个巧妙的功能。

这可以以某种方式工作吗？什么不见​​了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T03:19:06.770

您将无法执行此操作，因为无法创建侦听 TCP 套接字。您只能创建客户端 TCP 连接。

# c# - 我应该避免在winforms的后台线程上做什么

> ID：670503
> 
> 赞同：1
> 
> 时间：2009-03-22T03:20:03.320
> 
> 标签：c#, winforms

除了从后台线程更新 GUI 控件外，还有其他操作应该避免在 winforms 中的后台线程上执行吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T06:51:51.860

哦，有很多陷阱。BGW 并不能保护您免受线程编程的常见危害。并添加了一些自己的：

*   从 BGW 和 UI 线程访问的变量必须由锁保护。
*   不要更新 BGW 中的绑定数据源。控制更新将在 BGW 线程上完成，但不会产生异常。
*   不要太频繁地调用 ReportProgress()。每秒执行超过 1000 次会冻结 UI 线程。大约 25 次/秒就足够了。
*   小心你可以传递给 ReportProgress() 的 userstate 参数。调用后BGW不得修改。
*   不要在 UI 线程中循环 IsBusy 属性，它会死锁。
*   当主窗体关闭时，BGW 线程将被中止。注意必要的清理。
*   请务必检查 RunWorkerCompleted 事件中的 Error 属性，它会告诉您何时出现问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T03:41:09.227

这有点宽泛。如果不需要，不要在后台线程中做任何事情；也就是说，不要仅仅因为你喜欢它而线程化一些代码。在适当的地方使用线程，例如您不想中断 GUI 的长时间运行的任务等等。此外，如果您最终只是从主 UI 线程调用 Application.DoEvents() 只是等待另一个线程的任务，您可能会考虑保留一个线程并在循环中以小块的形式完成工作，您将在其中重新绘制 GUI使用 DoEvents() 调用。这只是一个建议；但是，当然，很多时候您*确实*需要创建多个线程。

也许您可以询问特定情况？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T04:29:34.150

好吧，您不应该在后台线程上更新 GUI 控件的原因是 GUI 控件类不是线程安全的。因此，您可以概括这一点：如果有其他线程也可能使用它们，请不要从后台线程中处理非线程安全类的实例。（这很广泛，我知道，但任何违反该规则的事情都可能给你带来麻烦）。

但我认为你的问题的要点是你是否已经涵盖了所有为`Control.Invoke()`涵盖而创建的基础。如果是这样，是的，你有...... Control.Invoke 是专门为控件不是线程安全的事实而设计的，因此，其他线程只能通过`Control.Invoke()`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T03:51:00.420

我同意鲍比的观点，你的问题太宽泛了。相反，首先假设如果您必须创建一个工作线程，那么您不会在其中放入任何东西，除非*绝对必须在那里*才能完成所需的任务。

# c# - 合并队列

> ID：670505
> 
> 赞同：1
> 
> 时间：2009-03-22T03:24:38.423
> 
> 标签：c#, queue

有没有在 dotnet.xml 中合并队列的好例子。我每秒有数千条消息来自另一个系统，我想看看这是否是最佳解决方案并查看一些实现示例

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T03:43:28.690

可能不是您想要的示例，但最好的示例是 UI 消息队列；鼠标移动事件可以合并。

您可以使用[MSMQ](http://msdn.microsoft.com/en-us/library/ms711472(VS.85).aspx)并编写自定义代码来执行合并。

# c# - .net 中的线程

> ID：670510
> 
> 赞同：4
> 
> 时间：2009-03-22T03:30:12.530
> 
> 标签：c#, multithreading

我有一个简单的 winforms 应用程序示例，我在目录选择器中选择一个目录，然后单击一个按钮循环浏览目录并将目录中的每个文件复制到另一个目录中。

我想在后台线程上进行文件复制以避免锁定 GUI。

我正在寻找最简单的解决方案：

1.  创建后台线程
2.  传递源和目标
3.  获取进度回调，以便我可以在 GUI 线程上显示进度条

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-22T03:32:15.940

我建议使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker(VS.80).aspx)类。

[例子](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.dowork.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T04:01:22.207

除了上述答案之外，我还要补充一点，BackgroundWorker 非常适合此问题，因为它也可以为您提供进度更新。只需确保防止重新进入 - 也就是说，您需要防止用户在后台工作完成之前再次启动它的情况。

# json - 将 rss 转换为 JSON

> ID：670511
> 
> 赞同：16
> 
> 时间：2009-03-22T03:31:52.853
> 
> 标签：json, rss

craigslist 有一个 rss 提要，我希望将提要转换为 JSON 格式，以便解析它。任何人都知道任何可以做到这一点的工具 - 将 craigslist rss（或任何 rss）转换为 JSON 格式

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2013-08-29T15:19:41.077

**更新**：请注意，Yahoo Pipes 现在已被 Yahoo! 关闭。并且 Google Feed API 已被弃用。检查[superfeedr.com](http://superfeedr.com/)的 API，它也进行 RSS 到 JSON 的转换。

您可以使用 google feed api 服务

例子：

```
https://ajax.googleapis.com/ajax/services/feed/load?v=2.0&q=http://phys.org/rss-feed/&num=20 
```

结构[https://ajax.googleapis.com/ajax/services/feed/load?v=2.0&q=RSS_URL_TO_CONVERT&num=](https://ajax.googleapis.com/ajax/services/feed/load?v=2.0&q=RSS_URL_TO_CONVERT&num=)

此外，如果您想更好地控制 RSS 转换，请使用[http://pipes.yahoo.com/pipes/](http://pipes.yahoo.com/pipes/)，您可以在其中可视化数据流。

编辑：由于雅虎管道不再工作，这里是替代品列表 [http://www.makeuseof.com/tag/12-best-yahoo-pipes-alternatives-look/](http://www.makeuseof.com/tag/12-best-yahoo-pipes-alternatives-look/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T04:16:01.967

RSS 已经是 XML 格式，它可以被所有浏览器本机解析。我建议直接解析 XML 而不是转换为 json 进行解析。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T03:35:48.477

John Resig 有一篇关于此的帖子：

[http://ejohn.org/projects/rss2json/](http://ejohn.org/projects/rss2json/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-04-10T18:38:22.047

我建议使用 Yahoo Pipes 来执行此操作。您可以简单地提取提要，它充当代理；也支持 JSONP。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T10:46:00.453

您可以尝试使用众多 javascript 库之一来浏览 XML。

例如，[这里](http://www.switchonthecode.com/tutorials/xml-parsing-with-jquery). 还有更多的库，[以下是](http://code.google.com/apis/ajaxlibs/documentation/#AjaxLibraries)Google 认为足以托管的库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-26T22:28:36.580

您也可以尝试 Oxygen XML 编辑器 ( [http://www.oxygenxml.com/](http://www.oxygenxml.com/) )。他们提供 30 天试用版，而且它是跨平台的。您可以在*Tools* -> *XML to JSON* ...下找到转换器

# c# - BackgroundWorker 完成事件 - 哪个线程？

> ID：670526
> 
> 赞同：4
> 
> 时间：2009-03-22T03:50:31.343
> 
> 标签：c#, multithreading, background

BackgroundWorker 控件的已完成事件是否会在 GUI 线程上返回，或者我是否必须将其封送回来。

此外，进度事件是否会在 GUI 线程上返回，或者我是否必须将其编组？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T03:54:55.543

这两个事件都将被编组到 UI 线程上。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T03:55:33.063

所有事件都将在创建 BackgroundWorker 实例的线程上返回。您的客户所要做的就是监听事件。

您可能来过这里，但另请参阅：[BackgroundWorker 事件](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker_events.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-22T03:57:17.270

它将在发起操作的 UI 线程上引发。在后台，BackgroundWorker 使用[SynchronizationContext](http://themechanicalbride.blogspot.com/2008/11/auto-sizing-canvas-for-silverlight-and.html)在两个线程之间进行封送处理。WPF 和 WinForms 都会在启动时安装适当的 SynchronizationContext。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-05T19:46:18.903

如果 BackgroundWorker 是从 UI 线程创建的，那么这两个事件也将在 UI 线程上引发。

如果它是从后台线程创建的，则该事件将在未定义的后台线程上引发。

有关更多信息，请参阅此帖子和此连接问题。

[https://stackoverflow.com/a/2806824/279999](https://stackoverflow.com/a/2806824/279999)

[http://connect.microsoft.com/VisualStudio/feedback/details/116930/backgroundworker-components-progresschanged-and-runworkercompleted-event-run-on-wrong-thread](http://connect.microsoft.com/VisualStudio/feedback/details/116930/backgroundworker-components-progresschanged-and-runworkercompleted-event-run-on-wrong-thread)

# asp.net-mvc - 不同开发计算机上的 ASP.NET 成员资格提供程序

> ID：670528
> 
> 赞同：2
> 
> 时间：2009-03-22T03:52:26.907
> 
> 标签：asp.net-mvc, asp.net-membership

“asp.net 会员提供程序”是否可移植？我是否必须运行 aspnet_regsql.exe 来为每台新机器设置它？

我将成员资格提供程序数据库导入到 Visual Studio 数据库版并签入我的源代码管理，然后将其重新部署到不同的开发机器上。在新机器上，我收到以下错误。我该如何解决？谢谢！

> “System.Web.Security.SqlMembershipProvider”需要与架构版本“1”兼容的数据库架构。但是，当前的数据库架构与此版本不兼容。您可能需要使用 aspnet_regsql.exe（在框架安装目录中提供）安装兼容架构，或者将提供程序升级到更新版本。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T04:14:27.213

只要您在新的开发环境中拥有 Framework 2.0 或更高版本并且可以访问包含该模式的数据库，它就是“可移植的”。

aspnet_regsql.exe 应用程序仅用于生成 db 架构。当指定您的提供者时，真正的交易发生在 web.config 中。

只要您在连接字符串或包含成员资格提供程序架构的数据库中有 .mdf 文件引用，一切都应该正常工作。

连接字符串：

```
<connectionStrings>
        <add name="LocalSQL" connectionString="Data Source=.\SQLEXPRESS;Initial Catalog=YourCatalog;Persist Security Info=True;User=sa;Password=password" providerName="System.Data.SqlClient"/>        
    </connectionStrings> 
```

会员提供者：

```
<membership defaultProvider="DefaultProvider" userIsOnlineTimeWindow="30">
            <providers>
                <clear/>
                <add name="DefaultProvider" connectionStringName="LocalSQL" applicationName="DefaultApp" enablePasswordRetrieval="true" enablePasswordReset="true" requiresQuestionAndAnswer="true" requiresUniqueEmail="true" passwordFormat="Encrypted" maxInvalidPasswordAttempts="5" passwordAttemptWindow="10" minRequiredPasswordLength="6" minRequiredNonalphanumericCharacters="0" type="System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"/>
            </providers>
        </membership> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-18T17:57:54.203

我也有这个问题。对我来说，我必须明确地为我的应用程序命名（在我的开发机器上是“/”）。

网络配置：

```
<membership>
  <providers>
    <clear />
    <add name="AspNetSqlMembershipProvider" applicationName="jobs"... />
  </providers>
</membership>
<profile>
  <providers>
    <clear />
    <add name="AspNetSqlProfileProvider" applicationName="jobs" ... />
  </providers>
</profile>
<roleManager enabled="true">
  <providers>
    <clear />
    <add connectionStringName="ApplicationServices" applicationName="jobs" ... />
    <add applicationName="jobs" name="AspNetWindowsTokenRoleProvider" type="System.Web.Security.WindowsTokenRoleProvider" />
  </providers>
</roleManager> 
```

然后在我的数据库中：

```
INSERT INTO [dbo].[aspnet_Applications]([ApplicationName], [LoweredApplicationName], [ApplicationId], [Description]) SELECT N'jobs', N'jobs', N'74b045ce-9c16-4e6a-b1ec-08504600a627', NULL 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T04:15:37.583

每个数据库都需要 SQL 成员资格提供程序。提供者注册过程在数据库中创建某些表。如果这些表不存在，您将收到上述错误。

由于表是在数据库中创建的，因此您可以拥有任意数量的不同应用程序或开发机器来共享单个 SQL 数据库。

但是如果您想要另一个提供程序实例，因为您有不同的应用程序或需要与另一个 SQL 数据库通信，那么您需要再次注册（创建表）。另一种可能性是使用 SQL 复制将表从一个数据库复制到另一个数据库。

很可能您的应用程序需要修改 web.config 文件以确保它具有与现有 SQL 数据库的正确连接字符串。

# c - 对于这两种情况，C 中的最佳数据结构是什么？

> ID：670536
> 
> 赞同：1
> 
> 时间：2009-03-22T04:02:52.203
> 
> 标签：c, data-structures, tree, hashtable, hashmap

我有点需要决定这个，看看我是否能在我的学校项目截止日期前的几个小时内实现它，但我对数据结构不太了解，我需要建议......

我需要做两件事，他们可能会使用不同的数据结构。

1.  我需要一个数据结构来保存个人资料记录。个人资料必须可以按姓名和社会安全号码进行搜索。SSN 是独一无二的，所以我可能可以利用它来获得优势？我想哈希图是最好的选择吗？但是如何在哈希映射中使用 SSN 来利用它作为查找特定配置文件的优势？一个基本且易于理解的解释将不胜感激。

2.  我需要一个数据结构来保存有关城市的记录。**我需要知道访问者最多的城市、访问量较少的城市以及****访问特定城市**的客户（从#1 中的数据结构中提取有关客户数据的配置文件）。

这是我的项目需要的第三个数据结构，它是我不知道从哪里开始的数据结构。如果可能，请提供有关使用哪种类型的数据结构的建议，并以粗体显示如何旧数据的示例。

**注意：第一个数据结构已经完成（我在**[上一个问题](https://stackoverflow.com/questions/670301/how-to-search-a-specific-node-in-a-graph-structure-in-c)
中谈到过）。第二个发布在 #1 上，尽管其他小组成员正在处理这个问题，但我只需要知道我们正在尝试做的是否是“最佳”方法。第三个是#2，我最需要帮助的那个。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T04:36:47.877

*正确*答案位于平衡搜索树和数组之间。

您在这里提到的情况和 else-thread 错过了一个*非常*重要的点：您正在处理的数据的大小。您可以根据必须处理的数据量来选择数据结构和算法。重要的是您能够证明您的选择是正确的。使用效率较低的通用算法并不总是*坏事*。能够支持您的选择（例如：选择冒泡排序，因为数据大小始终<10）表明a）对该领域的更大控制和b）实用主义-两者都供不应求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T08:44:27.657

在家庭作业问题之外，您将为此使用关系数据库。但这可能对您没有帮助……</p>

正如其他人已经指出的那样，您需要弄清楚的第一件事是您正在处理多少数据。*只要n*很小，O( *n* ) 蛮力搜索就足够快。由于微不足道的数据量会使这成为微不足道的问题（将其放入数组中，然后进行暴力搜索），因此我将假设数据量很大。

 *## 储存城市

首先，您的搜索要求似乎需要以多种方式对数据进行排序：

1.  一些城市唯一标识符（名称？）
2.  参观人数

这其实并不难满足。(1) 最简单。将城市存储在某个数组中。数组索引成为唯一标识符（假设：我们没有删除城市，或者如果我们确实删除了城市，我们可以让该数组点不使用，浪费一些内存。添加是可以的）。

现在，我们还需要能够找到最多和最少的访问。假设可能会发生修改（例如，添加城市、更改访客数量等）并从关系数据库中借用，我建议使用某种形式的平衡树创建索引。数据库通常使用 B-Tree，但不同的可能对您有用：检查维基百科关于树木的文章。在每个树节点中，我只保留城市数据的指针（或数组索引）。没有理由再复制一份！

我推荐一个哈希树，原因很简单：你可以很容易地进行前序或逆序遍历来找到顶部或底部的 N 个项目。哈希不能做到这一点。

当然，如果修改可能不会发生，只需使用另一个数组（指向项目的指针，再一次，不要复制它们）。

## 将城市链接到个人资料

如何做到这一点取决于您必须如何查询数据，以及它可以采用什么形式。最通用的是每个profile可以关联多个城市，每个城市可以关联多个profile。此外，我们希望能够从任一方向高效查询——同时询问“谁访问了凤凰城？” 和“鲍勃访问了哪些城市？”。

再次无耻地从数据库中提取，我将创建另一个数据结构，一个相当简单的数据结构：

```
struct profile_city {
    /* btree pointers here */
    size_t profile_idx; /* or use a pointer */
    size_t city_idx;    /* for both indices */
}; 
```

因此，如果说 Bob（个人资料 4）访问过凤凰城（城市 2），您将拥有 `profile_idx = 4`和`city_idx = 2`。假设 Bob 也访问了拉斯维加斯（城市 1），您需要添加另一个，因此您将拥有其中两个给 Bob。

现在，您有一个选择：您可以将它们存储在树或散列中。就个人而言，我会选择树，因为该代码已经编写好了。但是对于查找，哈希将是 O( *n* ) 而不是 O(log *n )。*

此外，就像我们对城市访问计数所做的那样，创建一个索引， `city_idx`以便也可以从那一侧进行查找。

## 结论

您现在可以查找访问次数最多的 5 个城市（通过按顺序遍历城市访问计数索引），并找出谁访问了这些城市，方法是搜索`city_idx`索引中的每个城市以获取 `profile_idx`. 只拿独特的物品，你就有答案了。

**哦，这里似乎有问题：对于您的讲师来说，这似乎是一个非常多的代码，需要在几个小时内完成！**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T04:18:01.777

为了跨多个键的可搜索性，以任何方便的形式存储数据，并在键上提供快速查找索引。

`(key, data*)`这可以像将数据按创建顺序保存在数组（或链表，或...）中一样简单，并为所有有趣的键（SSN ）保存一堆 {hashtables|sorted arrays|btrees} ， 姓名， ...）。

如果你有更多的时间，你甚至可以弄清楚如何为每张*不同*的地图设置不同`struct`的......

我认为这个解决方案可能适用于您的两个问题。

祝你好运。

* * *

为了清楚起见：

首先，我们有一个简单的学生记录数组

```
typedef
struct student_s {
   char ssn[10]; // nul terminated so we can use str* functions 
   char name[100];
   float GPA;
   ...
} student;
student slist[MAX_STUDENTS]; 
```

这是你去的时候填写的。它没有顺序，因此对*任何*键的搜索都是线性时间操作。1,000 个条目不是问题，但可能是 10,000 个问题，当然还有 100 万个问题。请参阅[dirkgently 的评论](https://stackoverflow.com/questions/670536/best-data-structure-in-c-for-these-two-situations/670559#670559)。

如果我们希望能够快速搜索，我们需要另一层结构。我在键和主要数据结构之间构建了一个映射，如下所示：

```
typedef
struct str_map {
   char* key;
   student *data;
} smap;
smap skey[MAX_STUDENTS] 
```

并保持 skey在键上*排序*，以便我可以快速查找。（只有数组很难*保持*排序，所以我们可能更喜欢树或哈希图。）

如果您只想在单个字段上进行快速搜索，则不需要（当然应该避免）这种复杂性。

# svn - Mac 10.4 同步文件

> ID：670540
> 
> 赞同：0
> 
> 时间：2009-03-22T04:11:59.620
> 
> 标签：svn, file, directory, sync

我正在使用谷歌代码 svn 并有一个存储库设置。在存储库中，我包含 TinyMCE，现在我想升级此文件夹中的所有文件。我遇到的问题是，如果我在本地结帐，然后下载他们的新版本并替换它会清除我所有 svn 文件的文件夹。因此实际上将其从版本控制中删除。

我想知道更新这些文件夹和文件但保持 svn 文件完整的最佳方法是什么？我一直在寻找，但似乎找不到任何简单的方法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T05:00:13.343

您可能想要设置[svn:externals](http://svnbook.red-bean.com/en/1.0/ch07s03.html)，或者您可能还想看看[Piston 之](http://piston.rubyforge.org/index.html)类的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T08:51:34.630

一些简单的东西`tar`不会破坏`.svn`目录。或者`rsync`（除非你要求），或者`unzip`，或者编写一个简单的 shell 脚本，或者......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T14:13:26.057

您可能想要使用该`ditto`命令。

它很简单：

```
ditto /path/to/newFiles /path/to/your/workingCopy 
```

# c++ - 包括g ++标头：仍然找不到定义

> ID：670541
> 
> 赞同：1
> 
> 时间：2009-03-22T04:13:54.470
> 
> 标签：c++, include, makefile, g++, header-files

晚上好 ：）

我在玩 g++ 和 makefile。我已经到了这一点：

富.h：

```
#ifndef _FOO_H_
#define _FOO_H_

#include "bar.h"

class foo {
private:
    bar something;
public:
    bool start();
    bool stop();
};

#endif // _FOO_H_ 
```

Foo.h 最终包含在我的主 cpp 文件中，因此我可以通过调用 start/stop 来启动。

```
void somewhere() {
    foo* hihi = new foo;
    hihi->start();
    delete hihi;
} 
```

然后是bar.h：

```
#ifndef _BAR_H_
#define _BAR_H_

class bar {

};

#endif // _BAR_H_ 
```

但是 g++ 似乎不喜欢它：

```
g++  (some_flags) -c main.cpp
In file included from main.cpp:2:
foo.h:8: error: ‘bar’ does not name a type 
```

我正在使用makefile，并尝试了以下组合：

```
main.o: main.cpp foo.h bar.h 
```

尽管我认为我不应该在这里添加 bar.h，但不应该将它包含在 foo.h 中就足够了吗？

为了澄清，这大致是它现在的设置方式（是的，我知道这可以以更有效的方式完成）：

```
main.o: main.cpp foo.h
    $(CC) $(CFLAGS) -c main.cpp

foo.o: foo.h foo.cpp
    $(CC) $(CFLAGS) -c foo.cpp

bar.o: bar.h bar.cpp
    $(CC) $(CFLAGS) -c bar.cpp 
```

这是怎么回事？我认为这是我对 g++ 及其处理标头的方式所缺少的东西，请指出正确的方向！

**编辑 - 找到解决方案：**

嗬！我现在觉得很傻。正在搞乱 boost::asio 并且有点忘了我仍然把它留在我的标题顶部的某个地方：使用 boost::asio::ip::tcp;

假设有一个 boost::asio::ip::tcp::bar 函数：D

哦，好吧，还是谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T04:23:22.357

仔细检查一切。如果包含`bar.h`into `foo.h`，编译器不应引发错误。你包括`foo.h`从`bar.h`吗？最好不要这样做，因为这会导致标题之间的循环依赖，这将导致那种错误。

还要检查头部防护的拼写。这可能是一个常见的烦恼来源：

```
#ifdef _BAR_H_ // OOPS! we wanted #ifndef
#define _BAR_H_

class bar {

};

#endif // _BAR_H_ 
```

此外，您应该避免在标题保护宏名称之前放置下划线。这些名称保留给编译器。打电话`INCLUDED_BAR_H`或只是`BAR_H_`代替。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T04:48:25.510

> 正在搞乱 boost::asio 并且有点忘了我仍然把它留在我的标题顶部的某个地方：使用 boost::asio::ip::tcp;
> 
> 假设有一个 boost::asio::ip::tcp::bar 函数

[Dan Saks 解释](http://www.ddj.com/article/printableArticle.jhtml?articleID=184403396&dept_url=/cpp/)了为什么应该 typedef 类名的一些原因，即使它看起来是多余的。

好吧，您已经遇到了现实生活中的情况，在这种情况下，定义一个类可能会帮助您更轻松地找到您的问题：

```
 class bar {
 // ...
 };
 typedef class bar bar; 
```

`bar()`如果已经声明了一个名为的函数，则生成这个更有意义的消息：

```
In file included from C:\temp\foo.h:4,
                 from C:\temp\test.cpp:4:
C:\temp\bar.h:7: error: `typedef class bar bar' redeclared as different kind of symbol
C:\temp\test.cpp:1: error: previous declaration of `void bar(int)'
C:\temp\bar.h:7: error: declaration of `typedef class bar bar' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T04:25:03.350

Tommy Hui 和 litb 已经指出了两个可能的原因；这里有一些背景信息，希望能派上用场。

首先，这与makefile 无关。makefile 只是一个方便的东西，它为你调用 g++，仅此而已。

这些带有头文件的东西起初可能有点难以理解，尤其是当你陷入循环依赖时。它确实帮助我意识到了这三件事：

*   A`#include`只不过是一个复制/粘贴操作，在该点插入包含文件的内容。
*   一切都必须在使用前*声明*。有时，当循环依赖出现时，您可能需要`class bar;`在另一个头文件中预先声明一个类（例如）。
*   如果在使用时需要关于类型的更多信息而不仅仅是它的存在，那么还需要类型的*定义*。这适用于调用该类型对象的方法，也适用于包含该类型的字段！（但不适用于指向该类型对象的指针，因为指针的大小都相同。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T04:17:23.447

在 main.cpp 中，您需要在文件顶部添加以下行：

```
#include "foo.h" 
```

# c# - 确定文件是否为图像

> ID：670546
> 
> 赞同：59
> 
> 时间：2009-03-22T04:17:28.720
> 
> 标签：c#, image, file

我正在遍历一个目录并复制所有文件。现在我正在`string.EndsWith`检查`".jpg"`or`".png"`等​​。.

有没有更优雅的方法来确定文件是否是图像（任何图像类型）而没有像上面那样的 hacky 检查？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-22T04:22:48.347

检查文件是否有[已知的标头](https://web.archive.org/web/20090302032444/http://www.mikekunz.com/image_file_header.html)。[（此答案](https://stackoverflow.com/a/9446045/1452172)中也提到了来自链接的信息）

PNG 文件的前 8 个字节始终包含以下（十进制）值：137 80 78 71 13 10 26 10

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-03-22T04:23:32.027

查看[System.IO.Path.GetExtension](http://msdn.microsoft.com/en-us/library/system.io.path.getextension.aspx)

这是一个快速示例。

```
public static readonly List<string> ImageExtensions = new List<string> { ".JPG", ".JPE", ".BMP", ".GIF", ".PNG" };

private void button_Click(object sender, RoutedEventArgs e)
{
    var folder = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
    var files = Directory.GetFiles(folder);
    foreach(var f in files)
    {
        if (ImageExtensions.Contains(Path.GetExtension(f).ToUpperInvariant()))
        {
            // process image
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2016-06-08T23:36:14.667

```
System.Web.MimeMapping.GetMimeMapping(filename).StartsWith("image/"); 
```

`MimeMapping.GetMimeMapping`产生这些结果：

*   文件.jpg：图像/JPEG
*   文件.gif：图像/gif
*   file.jpeg：图像/jpeg
*   文件.png：图像/png
*   文件.bmp：图像/bmp
*   文件.tiff：图像/tiff
*   file.svg：应用程序/八位字节流

file.svg 不返回图像/ MIME 类型在大多数情况下都有效，因为您可能不会像处理标量图像那样处理矢量图像。检查 MIME 类型时，请注意 SVG 确实具有 image/svg+xml 的标准 MIME 类型，即使`GetMimeMapping`没有返回它。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2014-08-26T15:19:50.953

这将查看文件的前几个字节并确定它是否是图像。

```
using System.Collections.Generic;
using System.IO;
using System.Linq;

public static class Extension
{
    public static bool IsImage(this Stream stream)
    {
        stream.Seek(0, SeekOrigin.Begin);

        List<string> jpg = new List<string> { "FF", "D8" };
        List<string> bmp = new List<string> { "42", "4D" };
        List<string> gif = new List<string> { "47", "49", "46" };
        List<string> png = new List<string> { "89", "50", "4E", "47", "0D", "0A", "1A", "0A" };
        List<List<string>> imgTypes = new List<List<string>> { jpg, bmp, gif, png };

        List<string> bytesIterated = new List<string>();

        for (int i = 0; i < 8; i++)
        {
            string bit = stream.ReadByte().ToString("X2");
            bytesIterated.Add(bit);

            bool isImage = imgTypes.Any(img => !img.Except(bytesIterated).Any());
            if (isImage)
            {
                return true;
            }
        }

        return false;
    }
} 
```

* * *

# 编辑

我对上述内容进行了一些更改，以允许您在需要时添加自己的图像，还删除了开始时不必要的集合。我还添加了一个接受`out`type 参数的重载`string`，将值设置为组成流的图像类型。

```
public static class Extension
{
    static Extension()
    {
        ImageTypes = new Dictionary<string, string>();
        ImageTypes.Add("FFD8","jpg");
        ImageTypes.Add("424D","bmp");
        ImageTypes.Add("474946","gif");
        ImageTypes.Add("89504E470D0A1A0A","png");
    }

    /// <summary>
    ///     <para> Registers a hexadecimal value used for a given image type </para>
    ///     <param name="imageType"> The type of image, example: "png" </param>
    ///     <param name="uniqueHeaderAsHex"> The type of image, example: "89504E470D0A1A0A" </param>
    /// </summary>
    public static void RegisterImageHeaderSignature(string imageType, string uniqueHeaderAsHex)
    {
        Regex validator = new Regex(@"^[A-F0-9]+$", RegexOptions.CultureInvariant);

        uniqueHeaderAsHex = uniqueHeaderAsHex.Replace(" ", "");

        if (string.IsNullOrWhiteSpace(imageType))         throw new ArgumentNullException("imageType");
        if (string.IsNullOrWhiteSpace(uniqueHeaderAsHex)) throw new ArgumentNullException("uniqueHeaderAsHex");
        if (uniqueHeaderAsHex.Length % 2 != 0)            throw new ArgumentException    ("Hexadecimal value is invalid");
        if (!validator.IsMatch(uniqueHeaderAsHex))        throw new ArgumentException    ("Hexadecimal value is invalid");

        ImageTypes.Add(uniqueHeaderAsHex, imageType);
    }

    private static Dictionary<string, string> ImageTypes;

    public static bool IsImage(this Stream stream)
    {
        string imageType;
        return stream.IsImage(out imageType);
    }

    public static bool IsImage(this Stream stream, out string imageType)
    {
        stream.Seek(0, SeekOrigin.Begin);
        StringBuilder builder = new StringBuilder();
        int largestByteHeader = ImageTypes.Max(img => img.Value.Length);

        for (int i = 0; i < largestByteHeader; i++)
        {
            string bit = stream.ReadByte().ToString("X2");
            builder.Append(bit);

            string builtHex = builder.ToString();
            bool isImage = ImageTypes.Keys.Any(img => img == builtHex);
            if (isImage)
            {
                imageType = ImageTypes[builder.ToString()];
                return true;
            }
        }
        imageType = null;
        return false;
    }
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2015-07-05T11:40:04.327

我们可以使用命名空间 System.Drawing 中的 Image 和 graphics 类；做我们的工作。如果代码正常工作，则它是图像，否则不是。那就是让 DotNet 框架为我们完成这项工作。编码 -

```
public string CheckFile(file)
{
    string result="";
    try
    {
        System.Drawing.Image imgInput = System.Drawing.Image.FromFile(file);
        System.Drawing.Graphics gInput = System.Drawing.Graphics.fromimage(imgInput);  
        Imaging.ImageFormat thisFormat = imgInput.RawFormat;   
        result="It is image";        
    }
    catch(Exception ex)
    {
        result="It is not image"; 
    }
    return result;
} 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2018-04-06T01:37:05.547

如果您想在从文件完全读取之前快速验证图像文件，除了比较文件扩展名之外，您还可以检查其标题以查找文件签名（以下代码`IsValidImageFile()`检查**BMP、GIF87a、GIF89a、PNG、 TIFF，JPEG**）

```
 /// <summary>
    /// Reads the header of different image formats
    /// </summary>
    /// <param name="file">Image file</param>
    /// <returns>true if valid file signature (magic number/header marker) is found</returns>
    private bool IsValidImageFile(string file)
    {
        byte[] buffer = new byte[8];
        byte[] bufferEnd = new byte[2];

        var bmp = new byte[] { 0x42, 0x4D };               // BMP "BM"
        var gif87a = new byte[] { 0x47, 0x49, 0x46, 0x38, 0x37, 0x61 };     // "GIF87a"
        var gif89a = new byte[] { 0x47, 0x49, 0x46, 0x38, 0x39, 0x61 };     // "GIF89a"
        var png = new byte[] { 0x89, 0x50, 0x4e, 0x47, 0x0D, 0x0A, 0x1A, 0x0A };   // PNG "\x89PNG\x0D\0xA\0x1A\0x0A"
        var tiffI = new byte[] { 0x49, 0x49, 0x2A, 0x00 }; // TIFF II "II\x2A\x00"
        var tiffM = new byte[] { 0x4D, 0x4D, 0x00, 0x2A }; // TIFF MM "MM\x00\x2A"
        var jpeg = new byte[] { 0xFF, 0xD8, 0xFF };        // JPEG JFIF (SOI "\xFF\xD8" and half next marker xFF)
        var jpegEnd = new byte[] { 0xFF, 0xD9 };           // JPEG EOI "\xFF\xD9"

        try
        {
            using (System.IO.FileStream fs = new System.IO.FileStream(file, System.IO.FileMode.Open, System.IO.FileAccess.Read))
            {
                if (fs.Length > buffer.Length)
                {
                    fs.Read(buffer, 0, buffer.Length);
                    fs.Position = (int)fs.Length - bufferEnd.Length;
                    fs.Read(bufferEnd, 0, bufferEnd.Length);
                }

                fs.Close();
            }

            if (this.ByteArrayStartsWith(buffer, bmp) ||
                this.ByteArrayStartsWith(buffer, gif87a) ||
                this.ByteArrayStartsWith(buffer, gif89a) ||
                this.ByteArrayStartsWith(buffer, png) ||
                this.ByteArrayStartsWith(buffer, tiffI) ||
                this.ByteArrayStartsWith(buffer, tiffM))
            {
                return true;
            }

            if (this.ByteArrayStartsWith(buffer, jpeg))
            {
                // Offset 0 (Two Bytes): JPEG SOI marker (FFD8 hex)
                // Offest 1 (Two Bytes): Application segment (FF?? normally ??=E0)
                // Trailer (Last Two Bytes): EOI marker FFD9 hex
                if (this.ByteArrayStartsWith(bufferEnd, jpegEnd))
                {
                    return true;
                }
            }
        }
        catch (Exception ex)
        {
            MessageBox.Show(ex.Message, Lang.Lang.ErrorTitle + " IsValidImageFile()", MessageBoxButtons.OK, MessageBoxIcon.Error);
        }

        return false;
    }

    /// <summary>
    /// Returns a value indicating whether a specified subarray occurs within array
    /// </summary>
    /// <param name="a">Main array</param>
    /// <param name="b">Subarray to seek within main array</param>
    /// <returns>true if a array starts with b subarray or if b is empty; otherwise false</returns>
    private bool ByteArrayStartsWith(byte[] a, byte[] b)
    {
        if (a.Length < b.Length)
        {
            return false;
        }

        for (int i = 0; i < b.Length; i++)
        {
            if (a[i] != b[i])
            {
                return false;
            }
        }

        return true;
    } 
```

检查标头签名可以很快，因为它不会加载整个文件或创建大对象，特别是在处理多个文件时。但它不会检查其余数据是否格式正确。为此，可以尝试将文件加载到`Image`对象的第二步（这样可以确保文件可以由您的程序显示和处理）。

```
bool IsValidImage(string filename)
{
    try
    {
        using(Image newImage = Image.FromFile(filename))
        {}
    }
    catch (OutOfMemoryException ex)
    {
        //The file does not have a valid image format.
        //-or- GDI+ does not support the pixel format of the file

        return false;
    }
    return true;
} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2014-06-05T08:21:57.920

我使用以下方法。它使用内置的图像解码器来检索系统识别为图像文件的扩展名列表，然后将这些扩展名与您传入的文件名的扩展名进行比较。返回一个简单的 TRUE/FALSE。

```
public static bool IsRecognisedImageFile(string fileName)
{
    string targetExtension = System.IO.Path.GetExtension(fileName);
    if (String.IsNullOrEmpty(targetExtension))
        return false;
    else
        targetExtension = "*" + targetExtension.ToLowerInvariant();

    List<string> recognisedImageExtensions = new List<string>();

    foreach (System.Drawing.Imaging.ImageCodecInfo imageCodec in System.Drawing.Imaging.ImageCodecInfo.GetImageEncoders())
        recognisedImageExtensions.AddRange(imageCodec.FilenameExtension.ToLowerInvariant().Split(";".ToCharArray()));

    foreach (string extension in recognisedImageExtensions)
    {
        if (extension.Equals(targetExtension))
        {
            return true;
        }
    }
    return false;
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-03-22T04:36:54.367

看看[这](http://pinvoke.net/default.aspx/urlmon/FindMimeFromData.html)是否有帮助。

编辑：另外， Image.FromFile(....).RawFormat 可能会有所帮助。如果文件不是图像，它可能会引发异常。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-22T04:53:20.193

不完全是您需要的答案。但如果是 Internet，那么[MIME](http://en.wikipedia.org/wiki/MIME)类型。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-10-01T14:05:36.937

我不确定这个解决方案的性能缺陷是什么，但你不能在 try 块中对文件执行一些图像功能，如果它不是图像，它会失败并落入 catch 块？

这种策略可能不是所有情况下的最佳解决方案，但在我目前使用它的情况下，它有一个主要优势：您可以使用您计划使用的任何功能来处理图像（如果它是图像）测试功能。通过这种方式，您可以测试所有当前的图像类型，但它也可以扩展到未来的图像类型，而无需将新的图像扩展添加到您支持的图像类型列表中。

有人看到这种策略有什么缺点吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-06-25T00:06:03.740

这就是我使用的 - 它只是对@dylmcc 答案的调整，使其更具可读性。

```
public static bool IsRecognisedImageFile(string fileName)
{
    string targetExtension = System.IO.Path.GetExtension(fileName);
    if (String.IsNullOrEmpty(targetExtension))
    {
        return false;
    }

    var recognisedImageExtensions = System.Drawing.Imaging.ImageCodecInfo.GetImageEncoders().SelectMany(codec => codec.FilenameExtension.ToLowerInvariant().Split(';'));

    targetExtension = "*" + targetExtension.ToLowerInvariant();
    return recognisedImageExtensions.Contains(targetExtension);
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-08-14T03:54:30.270

这是一个棘手的问题。如果文件不是图像，则会引发异常。从中我们可以检查文件是否为图像。

```
 using (Stream stream = File.OpenRead(file))
           {
               try
               {
                   using (Image sourceImage = Image.FromStream(stream, false, false))
                   {

                   }
               }
               catch (Exception x)
               {
                   if (x.Message.Contains("not valid"))
                   {
                     Console.Write("This is not a Image.");
                   }

               }
           } 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2018-06-13T09:12:53.630

我的简单代码

```
public static List<string> GetAllPhotosExtensions()
    {
        var list = new List<string>();
        list.Add(".jpg");
        list.Add(".png");
        list.Add(".bmp");
        list.Add(".gif");
        list.Add(".jpeg");
        list.Add(".tiff");
        return list;
    } 
```

检查图像文件是否

```
public static bool IsPhoto(string fileName)
    {
        var list = FileListExtensions.GetAllPhotosExtensions();
        var filename= fileName.ToLower();
        bool isThere = false;
        foreach(var item in list)
        {
            if (filename.EndsWith(item))
            {
                isThere = true;
                break;
            }
        }
        return isThere;     
    } 
```

# asp.net - 什么是 ASP.NET 表单身份验证部分中的凭据元素？

> ID：670548
> 
> 赞同：0
> 
> 时间：2009-03-22T04:19:38.870
> 
> 标签：asp.net, forms-authentication, credentials

我注意到表单身份验证元素有一个名为的选项子元素`Credentials`。

[MSDN Online在这里](http://msdn.microsoft.com/en-us/library/e01fc50a.aspx)解释了它是什么。

就是说，我不明白它会用来做什么？所以我可以将用户名和密码（clear/md5/sha1）添加到配置文件中。但是如何/何时使用它？

这是在用户名/密码中硬编码以与表单身份验证一起使用而不是拥有数据库的示例吗？如果是这样，后面有代码吗？如果您还有一个包含用户/密码的数据库，会发生什么？

干杯:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T11:05:25.773

你完全正确......硬编码的用户名/密码。简而言之就是这样。只有一次我真正使用它是在一个项目中，我们想要处理一些需要身份验证的代码，但没有连接真正的机制。就我而言，它只是真正身份验证的占位符。

鉴于您链接到的文档顶部的警告说明，MSDN 似乎同意。您可以将它与数据库并排使用，但何必呢？

# java - 在 Struts 中，计算应该驻留在哪里？

> ID：670557
> 
> 赞同：2
> 
> 时间：2009-03-22T04:34:02.907
> 
> 标签：java, struts

我正在用 Java 进行 Web 编程，我想知道最佳实践。我想知道我的计算应该驻留在哪里，比如说 Java MVC 应用程序或 Struts 应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T05:41:42.370

这取决于计算的类型。大多数计算都属于模型，因为大多数计算都与模型中包含的数据相关联。

但有时您需要计算视图中的某些内容（例如，您需要确定列表中是否有足够的项目来证明翻转到备用页面格式是合理的）。

有时它们属于控制器（也许您需要根据以控制器为中心的因素确定要转换到哪个视图）。

真正的答案是，计算属于它们所绑定的数据附近。不要在视图中汇总帐户总数，也不要在模型中计算字体大小。嗯。

# iphone - 在 iPhone 的 Quartz 2D 中进行旋转变换时，我可以移动原点吗？

> ID：670562
> 
> 赞同：8
> 
> 时间：2009-03-22T04:48:14.933
> 
> 标签：iphone, core-animation, 2d, quartz-graphics

抱歉，如果这很明显或在其他地方被覆盖，但我整天都在谷歌上搜索，还没有找到真正有效的解决方案。

我的问题如下：我目前正在全屏 UIView 中绘制图像，例如，我们会说图像在 UIView 的右下角。我想在该图像的中心进行旋转变换（CGAffineTransformMakeRotation），但是，默认情况下，旋转命令围绕它自身的 UIView 的中心旋转。结果，当我旋转时，我的图像会在屏幕上移动，而不是停留在原地并围绕自己的中心旋转。

根据我收集到的信息，我需要翻译我的上下文，以便原点（UIView 的中心）位于我的图像中心，旋转，然后通过翻译回原始位置来恢复上下文。

以下是我最接近的工作，但问题是图像旋转时，它在旋转时向下移动。我认为这是由动画补间第一步翻译和第三步翻译引起的，而不是仅仅意识到翻译的起点和终点是相同的......

```
// Before this i'd make a call to a function that draws a path to a passed in context
CGAffineTransform inverseTranslation = CGAffineTransformMakeTranslation( transX, transY );
CGAffineTransform translation = CGAffineTransformMakeTranslation( -transX, -transY );
CGAffineTransform rot = CGAffineTransformMakeRotation( 3.14 );
CGAffineTransform final = CGAffineTransformConcat( CGAffineTransformConcat( inverseTranslation, rot ), translation );
// Then i apply the transformation animation like normal using self.transform = final etc etc 
```

我也尝试过 CGContextTranslateCTM 和 CGContextSaveGState/UIGraphicsPushContext 之类的东西，但这些似乎效果不大。

我已经为此奋斗了好几天，我目前的解决方案似乎很接近，但我不知道如何摆脱这种翻译补间。有没有人对此有解决方案或更好的方法来解决这个问题？

[更新] 目前我正在以 UIview 的中心为中心绘制我的图像，然后将 UIView.center 属性设置为我想要旋转的原点，然后执行旋转命令。看起来有点像 hack，但在我得到真正的翻译工作之前，这是我唯一的选择。谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-01T20:30:32.283

duncanwilcox 的答案是正确的，但他忽略了将视图图层的锚点更改为要旋转的点的部分。

```
CGSize sz = theview.bounds.size;
// Anchorpoint coords are between 0.0 and 1.0
theview.layer.anchorPoint = CGPointMake(rotPoint.x/sz.width, rotPoint.y/sz.height);
[UIView beginAnimations:@"rotate" context:nil];
theview.transform = CGAffineTransformMakeRotation( 45\. / 180\. * M_PI );
[UIView commitAnimations]; 
```

这记录在这里：http: [//developer.apple.com/documentation/Cocoa/Conceptual/CoreAnimation_guide/Articles/Layers.html](http://developer.apple.com/documentation/Cocoa/Conceptual/CoreAnimation_guide/Articles/Layers.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-04-22T22:42:06.210

这也是一种选择：基础的简单改变;-)

```
CGAffineTransform transform = CGAffineTransformMakeTranslation(x, y);
transform = CGAffineTransformRotate(transform, angle);
transform = CGAffineTransformTranslate(transform,-x,-y); 
```

`(x,y)`你喜欢的旋转中心在哪里

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T12:27:21.170

旋转发生在视图层的锚点周围。anchorPoint 的默认值是中心 (0.5, 0.5)，因此没有平移的单独旋转就足够了。

做了一个快速测试，这对我有用：

```
[UIView beginAnimations:@"rotate" context:nil];
self.transform = CGAffineTransformMakeRotation( 45\. / 180\. * 3.14 );
[UIView commitAnimations]; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T13:05:02.280

如果您**不希望出现动画**，而只是设置新的旋转，则可以使用：

```
CGFloat newRotation = 3.14f 

[UIView beginAnimations:nil context:NULL];
[UIView setAnimationDuration:0.0]; // no tweening
CGAffineTransform transform = CGAffineTransformMakeRotation(newRotation);
self.transform = transform;
[UIView commitAnimations]; 
```

旋转确实应该围绕 UIView 的中心进行。**将 animationDuration 设置为零**保证不会发生补间。

请确保您不要每秒执行 60 次。使用这些工具创建类似动画的游戏非常诱人。这些动画并不完全适用于基于帧到帧的“大量精灵到处飞”的游戏。

为此——我一直在走这条路——唯一的出路是OpenGL。

# c# - LINQ 读取 XML

> ID：670563
> 
> 赞同：208
> 
> 时间：2009-03-22T04:48:24.573
> 
> 标签：c#, xml, linq, linq-to-xml

我得到了这个 XML 文件：

```
<root>
    <level1 name="A">
        <level2 name="A1" />
        <level2 name="A2" />
    </level1>
    <level1 name="B">
        <level2 name="B1" />
        <level2 name="B2" />
    </level1>
    <level1 name="C" />
</root> 
```

有人可以给我一个使用 LINQ 的 C# 代码，打印这个结果的最简单方法：（如果它是一个节点
，请注意额外的空间）`level2`

```
A
  A1
  A2
B
  B1
  B2
C 
```

目前我得到了这个代码：

```
XDocument xdoc = XDocument.Load("data.xml"));
var lv1s = from lv1 in xdoc.Descendants("level1")
           select lv1.Attribute("name").Value;

foreach (var lv1 in lv1s)
{
    result.AppendLine(lv1);

    var lv2s = from lv2 in xdoc...???
} 
```

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2009-03-22T04:53:24.747

试试这个。

```
using System.Xml.Linq;

void Main()
{
    StringBuilder result = new StringBuilder();

    //Load xml
    XDocument xdoc = XDocument.Load("data.xml");

    //Run query
    var lv1s = from lv1 in xdoc.Descendants("level1")
               select new { 
                   Header = lv1.Attribute("name").Value,
                   Children = lv1.Descendants("level2")
               };

    //Loop through results
    foreach (var lv1 in lv1s){
            result.AppendLine(lv1.Header);
            foreach(var lv2 in lv1.Children)
                 result.AppendLine("     " + lv2.Attribute("name").Value);
    }

    Console.WriteLine(result);
} 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-03-22T22:16:09.860

或者，如果您想要更通用的方法 - 即嵌套到“levelN”：

```
void Main()
{
    XElement rootElement = XElement.Load(@"c:\events\test.xml");

    Console.WriteLine(GetOutline(0, rootElement));  
}

private string GetOutline(int indentLevel, XElement element)
{
    StringBuilder result = new StringBuilder();

    if (element.Attribute("name") != null)
    {
        result = result.AppendLine(new string(' ', indentLevel * 2) + element.Attribute("name").Value);
    }

    foreach (XElement childElement in element.Elements())
    {
        result.Append(GetOutline(indentLevel + 1, childElement));
    }

    return result.ToString();
} 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-03-22T21:59:16.233

几个普通的旧`foreach`循环提供了一个干净的解决方案：

```
foreach (XElement level1Element in XElement.Load("data.xml").Elements("level1"))
{
    result.AppendLine(level1Element.Attribute("name").Value);

    foreach (XElement level2Element in level1Element.Elements("level2"))
    {
        result.AppendLine("  " + level2Element.Attribute("name").Value);
    }
} 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2012-12-13T20:59:58.173

以下是基于@bendewey 和@dommer 示例的几个完整的工作示例。我需要稍微调整一下以使其正常工作，但如果另一个 LINQ noob 正在寻找工作示例，请执行以下操作：

```
//bendewey's example using data.xml from OP
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml.Linq;

class loadXMLToLINQ1
{
    static void Main( )
    {
        //Load xml
        XDocument xdoc = XDocument.Load(@"c:\\data.xml"); //you'll have to edit your path

        //Run query
        var lv1s = from lv1 in xdoc.Descendants("level1")
           select new 
           { 
               Header = lv1.Attribute("name").Value,
               Children = lv1.Descendants("level2")
            };

        StringBuilder result = new StringBuilder(); //had to add this to make the result work
        //Loop through results
        foreach (var lv1 in lv1s)
        {
            result.AppendLine("  " + lv1.Header);
            foreach(var lv2 in lv1.Children)
            result.AppendLine("    " + lv2.Attribute("name").Value);
        }
        Console.WriteLine(result.ToString()); //added this so you could see the output on the console
    }
} 
```

接下来：

```
//Dommer's example, using data.xml from OP
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml.Linq;

class loadXMLToLINQ
{
static void Main( )
    {
        XElement rootElement = XElement.Load(@"c:\\data.xml"); //you'll have to edit your path
        Console.WriteLine(GetOutline(0, rootElement));  
    }

static private string GetOutline(int indentLevel, XElement element)
    {
        StringBuilder result = new StringBuilder();
        if (element.Attribute("name") != null)
        {
            result = result.AppendLine(new string(' ', indentLevel * 2) + element.Attribute("name").Value);
        }
        foreach (XElement childElement in element.Elements())
        {
            result.Append(GetOutline(indentLevel + 1, childElement));
        }
        return result.ToString();
    }
} 
```

它们都使用 csc.exe 版本 4.0.30319.1 在 VS2010 中编译和工作，并提供完全相同的输出。希望这些对正在寻找代码工作示例的其他人有所帮助。

编辑：也添加了@eglasius 的示例，因为它对我有用：

```
//@eglasius example, still using data.xml from OP
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml.Linq;

class loadXMLToLINQ2
{
    static void Main( )
    {
        StringBuilder result = new StringBuilder(); //needed for result below
        XDocument xdoc = XDocument.Load(@"c:\\deg\\data.xml"); //you'll have to edit your path
        var lv1s = xdoc.Root.Descendants("level1"); 
        var lvs = lv1s.SelectMany(l=>
             new string[]{ l.Attribute("name").Value }
             .Union(
                 l.Descendants("level2")
                 .Select(l2=>"   " + l2.Attribute("name").Value)
              )
            );
        foreach (var lv in lvs)
        {
           result.AppendLine(lv);
        }
        Console.WriteLine(result);//added this so you could see the result
    }
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-22T05:48:33.477

```
XDocument xdoc = XDocument.Load("data.xml");
var lv1s = xdoc.Root.Descendants("level1"); 
var lvs = lv1s.SelectMany(l=>
     new string[]{ l.Attribute("name").Value }
     .Union(
         l.Descendants("level2")
         .Select(l2=>"   " + l2.Attribute("name").Value)
      )
    );
foreach (var lv in lvs)
{
   result.AppendLine(lv);
} 
```

附言。您必须在任何这些版本上使用 .Root。

# c# - Path.Combine absolute 与相对路径字符串

> ID：670566
> 
> 赞同：111
> 
> 时间：2009-03-22T04:50:53.257
> 
> 标签：c#, .net, windows, path, filesystems

我正在尝试使用相对路径加入 Windows 路径[`Path.Combine`](http://msdn.microsoft.com/en-us/library/system.io.path.combine.aspx)。

但是，`Path.Combine(@"C:\blah",@"..\bling")`返回`C:\blah\..\bling`而不是`C:\bling\`.

有谁知道如何在不编写我自己的相对路径解析器的情况下完成此操作（这应该不会太难）？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-08-19T11:33:41.587

**什么有效：**

```
string relativePath = "..\\bling.txt";
string baseDirectory = "C:\\blah\\";
string absolutePath = Path.GetFullPath(baseDirectory + relativePath); 
```

（结果：absolutePath="C:\bling.txt"）

**什么不起作用**

```
string relativePath = "..\\bling.txt";
Uri baseAbsoluteUri = new Uri("C:\\blah\\");
string absolutePath = new Uri(baseAbsoluteUri, relativePath).AbsolutePath; 
```

（结果：absolutePath="C:/blah/bling.txt"）

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2013-05-20T09:44:09.980

[在组合路径http://msdn.microsoft.com/en-us/library/system.io.path.getfullpath.aspx](http://msdn.microsoft.com/en-us/library/system.io.path.getfullpath.aspx)上调用 Path.GetFullPath

```
> Path.GetFullPath(Path.Combine(@"C:\blah\",@"..\bling"))
C:\bling 
```

（我同意 Path.Combine 应该自己做）

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-03-22T05:09:44.990

```
 Path.GetFullPath(@"c:\windows\temp\..\system32")? 

```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-05-31T20:13:41.180

对于 windows 通用应用程序`Path.GetFullPath()`不可用，您可以改用`System.Uri`该类：

```
 Uri uri = new Uri(Path.Combine(@"C:\blah\",@"..\bling"));
 Console.WriteLine(uri.LocalPath); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-07-17T10:31:22.410

这将为您提供您所需要的（路径不必存在即可）

```
DirectoryInfo di = new DirectoryInfo(@"C:\blah\..\bling");
string cleanPath = di.FullName; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-03-01T22:44:06.630

`Path.GetFullPath()`不适用于相对路径。

这是适用于相对 + 绝对路径的解决方案。它适用于 Linux + Windows，并且`..`在文本开头保持预期（在休息时它们将被规范化）。该解决方案仍然依赖于`Path.GetFullPath`通过小变通方法进行修复。

这是一种扩展方法，所以像这样使用它`text.Canonicalize()`

```
/// <summary>
///     Fixes "../.." etc
/// </summary>
public static string Canonicalize(this string path)
{
    if (path.IsAbsolutePath())
        return Path.GetFullPath(path);
    var fakeRoot = Environment.CurrentDirectory; // Gives us a cross platform full path
    var combined = Path.Combine(fakeRoot, path);
    combined = Path.GetFullPath(combined);
    return combined.RelativeTo(fakeRoot);
}
private static bool IsAbsolutePath(this string path)
{
    if (path == null) throw new ArgumentNullException(nameof(path));
    return
        Path.IsPathRooted(path)
        && !Path.GetPathRoot(path).Equals(Path.DirectorySeparatorChar.ToString(), StringComparison.Ordinal)
        && !Path.GetPathRoot(path).Equals(Path.AltDirectorySeparatorChar.ToString(), StringComparison.Ordinal);
}
private static string RelativeTo(this string filespec, string folder)
{
    var pathUri = new Uri(filespec);
    // Folders must end in a slash
    if (!folder.EndsWith(Path.DirectorySeparatorChar.ToString())) folder += Path.DirectorySeparatorChar;
    var folderUri = new Uri(folder);
    return Uri.UnescapeDataString(folderUri.MakeRelativeUri(pathUri).ToString()
        .Replace('/', Path.DirectorySeparatorChar));
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-12-06T16:47:14.773

小心使用反斜杠，不要忘记它们（不要使用两次：）

```
string relativePath = "..\\bling.txt";
string baseDirectory = "C:\\blah\\";
//OR:
//string relativePath = "\\..\\bling.txt";
//string baseDirectory = "C:\\blah";
//THEN
string absolutePath = Path.GetFullPath(baseDirectory + relativePath); 
```

# c# - BCL 中将在给定日期时间发生事件的类？

> ID：670570
> 
> 赞同：0
> 
> 时间：2009-03-22T04:54:22.687
> 
> 标签：c#, .net, datetime, timer

是否有一个对象会在给定的 DateTime 或 DateTimeOffset 发生事件？我现在正在使用计时器来执行此操作，但它需要我进行一些计算，只是想可能已经有一些东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T06:06:46.693

我不明白你必须如何进行任何计算：

```
public void StartTimer(DateTime target) {
  double msec = (target - DateTime.Now).TotalMilliseconds;
  if (msec <= 0 || msec > int.MaxValue) throw new ArgumentOutOfRangeException();
  timer1.Interval = (int)msec;
  timer1.Enabled = true;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T07:16:51.753

我喜欢：

```
System.Timers.Timer _WaitForScheduledTime;
_WaitForScheduledTime = new System.Timers.Timer();
_WaitForScheduledTime.Elapsed += new ElapsedEventHandler(WaitForScheduledTime_OnElapsed);
_WaitForScheduledTime.Interval = _ListOfJobs.IntervalUntilFirstJobIsToRun().TotalMilliseconds;
_WaitForScheduledTime.Start(); 
```

...

```
private void WaitForScheduledTime_OnElapsed(object source, EventArgs e)
{
    log.Debug("Ready to run at least one job");

    // restart the timer
    _WaitForScheduledTime.Interval = _ListOfJobs.IntervalUntilFirstJobIsToRun().TotalMilliseconds;
    _WaitForScheduledTime.Start();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T05:10:35.813

如果您使用的是 ASP.NET，则可以使用声明的 ExpirationDate 将空对象添加到缓存中，然后处理[CacheItemRemovedCallback](http://msdn.microsoft.com/en-us/library/system.web.caching.cacheitemremovedcallback.aspx)。只是一个想法，不知道它是否适合你。

如果您不使用 ASP.NET，您仍然可以将此技巧与另一个缓存框架（例如[Enterprise Library Caching Block ）一起使用](http://msdn.microsoft.com/en-us/library/cc309502.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T06:02:49.747

从来没听说过。我推出了自己的课程来做到这一点。

# wpf - 与 Wpf 绑定时，有没有办法在不使用转换器的情况下使用 System.String 函数？

> ID：670573
> 
> 赞同：1
> 
> 时间：2009-03-22T04:56:23.540
> 
> 标签：wpf, vb.net, data-binding, converter

与 Wpf 绑定时，有没有办法在**不使用转换器**的情况下使用 System.String 函数？

```
<TextBlock Text="({Binding Path=Text}).Trim()"/> 
```

这基本上是我的愿望。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-22T05:03:08.237

我会使用转换器。

**绑定 Xaml**

```
<StackPanel>
  <StackPanel.Resources>
    <local:StringTrimmingConverter x:Key="trimmingConverter" />
  <StackPanel.Resources>
  <TextBlock Text="{Binding Path=Text, Converter={StaticResource trimmingConverter}}" />
</StackPanel> 
```

**StringTrimmingConverter.cs**

```
using System;
using System.Windows.Data;

namespace WpfApplication1
{
    [ValueConversion(typeof(string), typeof(string))]
    public class StringTrimmingConverter : IValueConverter
    {
        #region IValueConverter Members
        public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            return value.ToString().Trim();
        }
        public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            return value;
        }
        #endregion
    }
} 
```

如果 VB **StringTrimmingConverter.vb**

```
Imports System.Globalization

Public Class StringTrimmingConverter
    Implements IValueConverter

    Public Function ConvertBack(ByVal value As Object, ByVal targetType As Type, ByVal parameter As Object, ByVal culture As CultureInfo) As Object Implements IValueConverter.ConvertBack
        Return value.ToString().Trim
    End Function

    Public Function Convert(ByVal value As Object, ByVal targetType As Type, ByVal parameter As Object, ByVal culture As CultureInfo) As Object Implements IValueConverter.Convert
        Return value
    End Function

End Class 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T23:12:55.433

我为 System.String 中的所有功能创建了一个终极转换器，需要一些改进希望收到您的来信，希望将来更新它，请接受：

**VB：**

```
<ValueConversion(GetType(String), GetType(Object))> _
Class StringFunctions : Implements IValueConverter
    Public Function Convert(ByVal value As Object, ByVal targetType As System.Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements System.Windows.Data.IValueConverter.Convert
        If parameter Is Nothing OrElse Not TypeOf parameter Is String OrElse String.IsNullOrEmpty(parameter) Then Return Nothing
        Dim parameters As New List(Of String)(parameter.ToString.Split(":"c))
        parameter = parameters(0)
        parameters.RemoveAt(0)
        If String.IsNullOrEmpty(parameter) Then Return value

        Dim method = (From m In GetType(String).GetMethods _
                Where m.Name = parameter _
                AndAlso m.GetParameters.Count = parameters.Count).FirstOrDefault
        If method Is Nothing Then Return value
        Return method.Invoke(value, parameters.ToArray)
    End Function
    Public Function ConvertBack(ByVal value As Object, ByVal targetType As System.Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements System.Windows.Data.IValueConverter.ConvertBack
        Return value.ToString()
    End Function
End Class 
```

**C#：-由工具转换，不要依赖！**

```
 [ValueConversion(typeof(string), typeof(object))]
public class StringConverter : IValueConverter
{
    #region IValueConverter Members

    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        if (value == null) return null;
        value = value.ToString();
        if (String.IsNullOrEmpty(value as string)) return "";
        if (parameter == null || !parameter is string || String.IsNullOrEmpty((string)parameter)) return value;
        List<string> parameters = new List<string>(((string)parameter).Split(':'));
        parameter = parameters[0];
        parameters.RemoveAt(0);

        var method = (from m in typeof(String).GetMethods()
                        where m.Name== parameter 
                        && m.GetParameters().Count()==parameters.Count
                            select m).FirstOrDefault();
        if (method == null) return value;
        return method.Invoke(value, parameters.ToArray());
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        return value;
    }

    #endregion
} 
```

**xml:**

```
<TextBox Text="{Binding Path=String, Converter={StaticResource StringConverter}, ConverterParameter=Trim:Argument:AnotherArgument}" /> 
```

然后，在绑定中，当您使用转换器时，您可以选择将参数传递给转换器（Binding.ConverterParameter）传递所有参数，并用：（冒号 - 您可以在 String.Split 分隔符参数中更改它），而第一个参数是函数名，该函数会计算额外的参数并尝试传递它。
我仍然没有处理参数寻址，这是一个浅层函数。

希望看到您的改进和说明。
谢谢。摇摆

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T06:44:15.217

我为 System.String 中的所有功能创建了一个终极转换器，需要一些改进希望收到您的来信，希望将来更新它，请接受：

```
 <ValueConversion(GetType(String), GetType(String))> _
Class StringFunctions : Implements IValueConverter
    Public Function Convert(ByVal value As Object, ByVal targetType As System.Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements System.Windows.Data.IValueConverter.Convert
        If parameter Is Nothing OrElse Not TypeOf parameter Is String OrElse String.IsNullOrEmpty(parameter) Then Return Nothing
        Dim parameters As New List(Of String)(parameter.ToString.Split(":"c))
        parameter = parameters(0)
        parameters.RemoveAt(0)
        If String.IsNullOrEmpty(parameter) Then Return value

        Dim method = (From m In GetType(String).GetMethods _
                Where m.Name = parameter _
                AndAlso m.GetParameters.Count = parameters.Count).FirstOrDefault
        If method Is Nothing Then Return value
        Return method.Invoke(value, parameters.ToArray)
    End Function
    Public Function ConvertBack(ByVal value As Object, ByVal targetType As System.Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements System.Windows.Data.IValueConverter.ConvertBack
        Throw New NotSupportedException
    End Function
End Class 
```

在绑定中，当您使用转换器时，您可以选择将参数传递给转换器 (Binding.ConverterParameter) 传递所有参数，并以 : 分隔（冒号 - 您可以在 String.Split 分隔符参数中更改它），而第一个参数是函数名，函数会统计多余的参数并尝试传递。
我仍然没有处理参数寻址，这是一个浅层函数。

希望看到您的改进和说明。
谢谢。摇摆

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T07:22:19.163

您需要使用转换器来转换控件绑定的数据。为避免编写大量转换器简单的转换，您可以使用动态语言运行时并以您最喜欢的 DLR 脚本语言（如 Python、Ruby 等）编写表达式。

有关如何实现此目的的示例， 请参阅[我的博客系列。](http://www.thinkbottomup.com.au/site/blog/Embedding_DLR_Scripts_in_XAML_Part_1)[第 3 部分](http://www.thinkbottomup.com.au/site/blog/Embedding_DLR_Scripts_in_XAML_Part_3)专门讨论了 ValueConverters。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-16T15:57:34.123

我知道这篇文章很旧，但它仍然是搜索“WPF TextBox Binding Trim”时出现的第一个。

我没有 VB 答案，但请不要使用转换器。
原因：

1.  转换器意味着您每次都必须向所有 XAML 绑定添加额外的 XAML 代码。必须总是添加额外的代码在 XAML 中和在 C#/VB 中一样糟糕。
2.  如果您设置了 UpdateSourceTrigger=PropertyChanged，这将阻止您输入空格。

使用应该使用的面向对象编程。如果您需要一个 Trimmed TextBox，则创建一个名为 TrimmedTextBox 的 TextBox 的子项并使用它。[http://www.wpfsharp.com/2014/05/15/a-simple-trimmedtextbox-for-wpf/](http://www.wpfsharp.com/2014/05/15/a-simple-trimmedtextbox-for-wpf/)

C＃

```
using System.Windows.Controls;

namespace WpfSharp.UserControls
{
    public class TrimmedTextBox : TextBox
    {
        public TrimmedTextBox()
        {
            LostFocus += TrimOnLostFocus;
        }

        void TrimOnLostFocus(object sender, System.Windows.RoutedEventArgs e)
        {
            var trimTextBox = sender as TrimmedTextBox;
            if (trimTextBox != null)
                trimTextBox.Text = trimTextBox.Text.Trim();
        }
    }
} 
```

VB（我在我的 C# 代码中使用了转换器）

```
Imports System.Windows.Controls

Namespace WpfSharp.UserControls
    Public Class TrimmedTextBox
        Inherits TextBox
        Public Sub New()
            AddHandler LostFocus, AddressOf TrimOnLostFocus
        End Sub

        Private Sub TrimOnLostFocus(sender As Object, e As System.Windows.RoutedEventArgs)
            Dim trimTextBox = TryCast(sender, TrimmedTextBox)
            If trimTextBox IsNot Nothing Then
                trimTextBox.Text = trimTextBox.Text.Trim()
            End If
        End Sub
    End Class
End Namespace 
```

希望这可以帮助。请随意使用这个对象，就好像它是公共领域一样。

# c# - ObservableCollection 不支持 AddRange 方法，所以我会收到添加的每个项目的通知，除了 INotifyCollectionChanging 呢？

> ID：670577
> 
> 赞同：183
> 
> 时间：2009-03-22T05:08:43.977
> 
> 标签：c#, vb.net, observablecollection, addrange, inotifycollectionchanged

我希望能够添加一个范围并为整个批量更新。

我还希望能够在操作完成之前取消操作（即除了“更改”之外的集合更改）。

* * *

相关 Q [哪个 .Net 集合可以一次添加多个对象并获得通知？](https://stackoverflow.com/questions/57020/which-net-collection-for-adding-multiple-objects-at-once-and-getting-notified)

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-03-22T05:09:55.490

请参考[更新优化的 C# 7 版本](https://stackoverflow.com/a/45364074/75500)。我不想删除 VB.NET 版本，所以我只是将它发布在一个单独的答案中。

## [转到更新版本](https://stackoverflow.com/a/45364074/75500)

好像不支持，我自己实现的，仅供参考，希望对您有所帮助：

我更新了 VB 版本，从现在开始，它会在更改集合之前引发一个事件，这样你就可以后悔（在使用 with 时很有用`DataGrid`，`ListView`还有更多，你可以向用户显示“你确定”确认），**更新的 VB版本在此消息的底部**。

请接受我的道歉，屏幕太窄而无法包含我的代码，我也不喜欢它。

**VB.NET：**

```
Imports System.Collections.Specialized

Namespace System.Collections.ObjectModel
    ''' <summary>
    ''' Represents a dynamic data collection that provides notifications when items get added, removed, or when the whole list is refreshed.
    ''' </summary>
    ''' <typeparam name="T"></typeparam>
    Public Class ObservableRangeCollection(Of T) : Inherits System.Collections.ObjectModel.ObservableCollection(Of T)

        ''' <summary>
        ''' Adds the elements of the specified collection to the end of the ObservableCollection(Of T).
        ''' </summary>
        Public Sub AddRange(ByVal collection As IEnumerable(Of T))
            For Each i In collection
                Items.Add(i)
            Next
            OnCollectionChanged(New NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset))
        End Sub

        ''' <summary>
        ''' Removes the first occurence of each item in the specified collection from ObservableCollection(Of T).
        ''' </summary>
        Public Sub RemoveRange(ByVal collection As IEnumerable(Of T))
            For Each i In collection
                Items.Remove(i)
            Next

            OnCollectionChanged(New NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset))
        End Sub

        ''' <summary>
        ''' Clears the current collection and replaces it with the specified item.
        ''' </summary>
        Public Sub Replace(ByVal item As T)
            ReplaceRange(New T() {item})
        End Sub
        ''' <summary>
        ''' Clears the current collection and replaces it with the specified collection.
        ''' </summary>
        Public Sub ReplaceRange(ByVal collection As IEnumerable(Of T))
            Dim old = Items.ToList
            Items.Clear()
            For Each i In collection
                Items.Add(i)
            Next
            OnCollectionChanged(New NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset))
        End Sub

        ''' <summary>
        ''' Initializes a new instance of the System.Collections.ObjectModel.ObservableCollection(Of T) class.
        ''' </summary>
        ''' <remarks></remarks>
        Public Sub New()
            MyBase.New()
        End Sub
        ''' <summary>
        ''' Initializes a new instance of the System.Collections.ObjectModel.ObservableCollection(Of T) class that contains elements copied from the specified collection.
        ''' </summary>
        ''' <param name="collection">collection: The collection from which the elements are copied.</param>
        ''' <exception cref="System.ArgumentNullException">The collection parameter cannot be null.</exception>
        Public Sub New(ByVal collection As IEnumerable(Of T))
            MyBase.New(collection)
        End Sub
    End Class   

End Namespace 
```

**C＃：**

```
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Collections.Specialized;
using System.Linq;

/// <summary> 
/// Represents a dynamic data collection that provides notifications when items get added, removed, or when the whole list is refreshed. 
/// </summary> 
/// <typeparam name="T"></typeparam> 
public class ObservableRangeCollection<T> : ObservableCollection<T>
{
    /// <summary> 
    /// Adds the elements of the specified collection to the end of the ObservableCollection(Of T). 
    /// </summary> 
    public void AddRange(IEnumerable<T> collection)
    {
        if (collection == null) throw new ArgumentNullException("collection");

        foreach (var i in collection) Items.Add(i);
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
    }

    /// <summary> 
    /// Removes the first occurence of each item in the specified collection from ObservableCollection(Of T). 
    /// </summary> 
    public void RemoveRange(IEnumerable<T> collection)
    {
        if (collection == null) throw new ArgumentNullException("collection");

        foreach (var i in collection) Items.Remove(i);
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
    }

    /// <summary> 
    /// Clears the current collection and replaces it with the specified item. 
    /// </summary> 
    public void Replace(T item)
    {
        ReplaceRange(new T[] { item });
    }

    /// <summary> 
    /// Clears the current collection and replaces it with the specified collection. 
    /// </summary> 
    public void ReplaceRange(IEnumerable<T> collection)
    {
        if (collection == null) throw new ArgumentNullException("collection");

        Items.Clear();
        foreach (var i in collection) Items.Add(i);
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
    }

    /// <summary> 
    /// Initializes a new instance of the System.Collections.ObjectModel.ObservableCollection(Of T) class. 
    /// </summary> 
    public ObservableRangeCollection()
        : base() { }

    /// <summary> 
    /// Initializes a new instance of the System.Collections.ObjectModel.ObservableCollection(Of T) class that contains elements copied from the specified collection. 
    /// </summary> 
    /// <param name="collection">collection: The collection from which the elements are copied.</param> 
    /// <exception cref="System.ArgumentNullException">The collection parameter cannot be null.</exception> 
    public ObservableRangeCollection(IEnumerable<T> collection)
        : base(collection) { }
} 
```

## 更新 - 带有集合更改通知的可观察范围集合

```
Imports System.Collections.Specialized
Imports System.ComponentModel
Imports System.Collections.ObjectModel

Public Class ObservableRangeCollection(Of T) : Inherits ObservableCollection(Of T) : Implements INotifyCollectionChanging(Of T)
    ''' <summary>
    ''' Initializes a new instance of the System.Collections.ObjectModel.ObservableCollection(Of T) class.
    ''' </summary>
    ''' <remarks></remarks>
    Public Sub New()
        MyBase.New()
    End Sub

    ''' <summary>
    ''' Initializes a new instance of the System.Collections.ObjectModel.ObservableCollection(Of T) class that contains elements copied from the specified collection.
    ''' </summary>
    ''' <param name="collection">collection: The collection from which the elements are copied.</param>
    ''' <exception cref="System.ArgumentNullException">The collection parameter cannot be null.</exception>
    Public Sub New(ByVal collection As IEnumerable(Of T))
        MyBase.New(collection)
    End Sub

    ''' <summary>
    ''' Adds the elements of the specified collection to the end of the ObservableCollection(Of T).
    ''' </summary>
    Public Sub AddRange(ByVal collection As IEnumerable(Of T))
        Dim ce As New NotifyCollectionChangingEventArgs(Of T)(NotifyCollectionChangedAction.Add, collection)
        OnCollectionChanging(ce)
        If ce.Cancel Then Exit Sub

        Dim index = Items.Count - 1
        For Each i In collection
            Items.Add(i)
        Next

        OnCollectionChanged(New NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, collection, index))
    End Sub

    ''' <summary>
    ''' Inserts the collection at specified index.
    ''' </summary>
    Public Sub InsertRange(ByVal index As Integer, ByVal Collection As IEnumerable(Of T))
        Dim ce As New NotifyCollectionChangingEventArgs(Of T)(NotifyCollectionChangedAction.Add, Collection)
        OnCollectionChanging(ce)
        If ce.Cancel Then Exit Sub

        For Each i In Collection
            Items.Insert(index, i)
        Next

        OnCollectionChanged(New NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset))
    End Sub

    ''' <summary>
    ''' Removes the first occurence of each item in the specified collection from ObservableCollection(Of T).
    ''' </summary>
    Public Sub RemoveRange(ByVal collection As IEnumerable(Of T))
        Dim ce As New NotifyCollectionChangingEventArgs(Of T)(NotifyCollectionChangedAction.Remove, collection)
        OnCollectionChanging(ce)
        If ce.Cancel Then Exit Sub

        For Each i In collection
            Items.Remove(i)
        Next

        OnCollectionChanged(New NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset))
    End Sub

    ''' <summary>
    ''' Clears the current collection and replaces it with the specified item.
    ''' </summary>
    Public Sub Replace(ByVal item As T)
        ReplaceRange(New T() {item})
    End Sub

    ''' <summary>
    ''' Clears the current collection and replaces it with the specified collection.
    ''' </summary>
    Public Sub ReplaceRange(ByVal collection As IEnumerable(Of T))
        Dim ce As New NotifyCollectionChangingEventArgs(Of T)(NotifyCollectionChangedAction.Replace, Items)
        OnCollectionChanging(ce)
        If ce.Cancel Then Exit Sub

        Items.Clear()
        For Each i In collection
            Items.Add(i)
        Next
        OnCollectionChanged(New NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset))
    End Sub

    Protected Overrides Sub ClearItems()
        Dim e As New NotifyCollectionChangingEventArgs(Of T)(NotifyCollectionChangedAction.Reset, Items)
        OnCollectionChanging(e)

        If e.Cancel Then Exit Sub

        MyBase.ClearItems()
    End Sub

    Protected Overrides Sub InsertItem(ByVal index As Integer, ByVal item As T)
        Dim ce As New NotifyCollectionChangingEventArgs(Of T)(NotifyCollectionChangedAction.Add, item)
        OnCollectionChanging(ce)
        If ce.Cancel Then Exit Sub

        MyBase.InsertItem(index, item)
    End Sub

    Protected Overrides Sub MoveItem(ByVal oldIndex As Integer, ByVal newIndex As Integer)
        Dim ce As New NotifyCollectionChangingEventArgs(Of T)()
        OnCollectionChanging(ce)
        If ce.Cancel Then Exit Sub

        MyBase.MoveItem(oldIndex, newIndex)
    End Sub

    Protected Overrides Sub RemoveItem(ByVal index As Integer)
        Dim ce As New NotifyCollectionChangingEventArgs(Of T)(NotifyCollectionChangedAction.Remove, Items(index))
        OnCollectionChanging(ce)
        If ce.Cancel Then Exit Sub

        MyBase.RemoveItem(index)
    End Sub

    Protected Overrides Sub SetItem(ByVal index As Integer, ByVal item As T)
        Dim ce As New NotifyCollectionChangingEventArgs(Of T)(NotifyCollectionChangedAction.Replace, Items(index))
        OnCollectionChanging(ce)
        If ce.Cancel Then Exit Sub

        MyBase.SetItem(index, item)
    End Sub

    Protected Overrides Sub OnCollectionChanged(ByVal e As Specialized.NotifyCollectionChangedEventArgs)
        If e.NewItems IsNot Nothing Then
            For Each i As T In e.NewItems
                If TypeOf i Is INotifyPropertyChanged Then AddHandler DirectCast(i, INotifyPropertyChanged).PropertyChanged, AddressOf Item_PropertyChanged
            Next
        End If
        MyBase.OnCollectionChanged(e)
    End Sub

    Private Sub Item_PropertyChanged(ByVal sender As T, ByVal e As ComponentModel.PropertyChangedEventArgs)
        OnCollectionChanged(New NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset, sender, IndexOf(sender)))
    End Sub

    Public Event CollectionChanging(ByVal sender As Object, ByVal e As NotifyCollectionChangingEventArgs(Of T)) Implements INotifyCollectionChanging(Of T).CollectionChanging
    Protected Overridable Sub OnCollectionChanging(ByVal e As NotifyCollectionChangingEventArgs(Of T))
        RaiseEvent CollectionChanging(Me, e)
    End Sub
End Class

Public Interface INotifyCollectionChanging(Of T)
    Event CollectionChanging(ByVal sender As Object, ByVal e As NotifyCollectionChangingEventArgs(Of T))
End Interface

Public Class NotifyCollectionChangingEventArgs(Of T) : Inherits CancelEventArgs

    Public Sub New()
        m_Action = NotifyCollectionChangedAction.Move
        m_Items = New T() {}
    End Sub

    Public Sub New(ByVal action As NotifyCollectionChangedAction, ByVal item As T)
        m_Action = action
        m_Items = New T() {item}
    End Sub

    Public Sub New(ByVal action As NotifyCollectionChangedAction, ByVal items As IEnumerable(Of T))
        m_Action = action
        m_Items = items
    End Sub

    Private m_Action As NotifyCollectionChangedAction
    Public ReadOnly Property Action() As NotifyCollectionChangedAction
        Get
            Return m_Action
        End Get
    End Property

    Private m_Items As IList
    Public ReadOnly Property Items() As IEnumerable(Of T)
        Get
            Return m_Items
        End Get
    End Property
End Class 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2017-07-28T02:51:26.593

首先，请对 .NET repo上的[API 请求进行](https://github.com/dotnet/corefx/issues/10752#issuecomment-359197102)**投票和评论。**

这是我的优化版本`ObservableRangeCollection`（James Montemagno 的优化版本[）](https://github.com/jamesmontemagno/mvvm-helpers/blob/release-1.3.0/MvvmHelpers/ObservableRangeCollection.cs)。

它执行得非常快，旨在尽可能重用现有元素并避免不必要的事件，或者尽可能将它们批处理为一个。该`ReplaceRange`方法通过适当的索引替换/删除/添加所需的元素，并对可能的事件进行批处理。

在 Xamarin.Forms UI 上进行了测试，非常频繁地更新大型集合（每秒 5-7 次更新），结果非常好。

注意：由于**WPF**不习惯使用范围操作，因此在 WPF UI 相关工作中`NotSupportedException`使用`ObservableRangeCollection`from below 时会抛出 , 例如将其绑定到 a`ListBox`等。（您仍然可以使用`ObservableRangeCollection<T>`if not bound to UI） .
但是，您可以使用[`WpfObservableRangeCollection<T>`](https://gist.github.com/weitzhandler/65ac9113e31d12e697cb58cd92601091#file-wpfobservablerangecollection-cs)解决方法。
真正的解决方案是创建一个`CollectionView`知道如何处理范围操作的，但我仍然没有时间实现它。

**[RAW 代码](https://gist.github.com/weitzhandler/65ac9113e31d12e697cb58cd92601091)**- 以 Raw 格式打开，然后按`Ctrl`+`A`选择全部，然后`Ctrl`+`C`复制。

```
// Licensed to the .NET Foundation under one or more agreements.
// The .NET Foundation licenses this file to you under the MIT license.
// See the LICENSE file in the project root for more information.

using System.Collections.Generic;
using System.Collections.Specialized;
using System.ComponentModel;
using System.Diagnostics;

namespace System.Collections.ObjectModel
{
  /// <summary>
  /// Implementation of a dynamic data collection based on generic Collection&lt;T&gt;,
  /// implementing INotifyCollectionChanged to notify listeners
  /// when items get added, removed or the whole list is refreshed.
  /// </summary>
  public class ObservableRangeCollection<T> : ObservableCollection<T>
  {
    //------------------------------------------------------
    //
    //  Private Fields
    //
    //------------------------------------------------------

    #region Private Fields    
    [NonSerialized]
    private DeferredEventsCollection _deferredEvents;
    #endregion Private Fields

    //------------------------------------------------------
    //
    //  Constructors
    //
    //------------------------------------------------------

    #region Constructors
    /// <summary>
    /// Initializes a new instance of ObservableCollection that is empty and has default initial capacity.
    /// </summary>
    public ObservableRangeCollection() { }

    /// <summary>
    /// Initializes a new instance of the ObservableCollection class that contains
    /// elements copied from the specified collection and has sufficient capacity
    /// to accommodate the number of elements copied.
    /// </summary>
    /// <param name="collection">The collection whose elements are copied to the new list.</param>
    /// <remarks>
    /// The elements are copied onto the ObservableCollection in the
    /// same order they are read by the enumerator of the collection.
    /// </remarks>
    /// <exception cref="ArgumentNullException"> collection is a null reference </exception>
    public ObservableRangeCollection(IEnumerable<T> collection) : base(collection) { }

    /// <summary>
    /// Initializes a new instance of the ObservableCollection class
    /// that contains elements copied from the specified list
    /// </summary>
    /// <param name="list">The list whose elements are copied to the new list.</param>
    /// <remarks>
    /// The elements are copied onto the ObservableCollection in the
    /// same order they are read by the enumerator of the list.
    /// </remarks>
    /// <exception cref="ArgumentNullException"> list is a null reference </exception>
    public ObservableRangeCollection(List<T> list) : base(list) { }

    #endregion Constructors

    //------------------------------------------------------
    //
    //  Public Methods
    //
    //------------------------------------------------------

    #region Public Methods

    /// <summary>
    /// Adds the elements of the specified collection to the end of the <see cref="ObservableCollection{T}"/>.
    /// </summary>
    /// <param name="collection">
    /// The collection whose elements should be added to the end of the <see cref="ObservableCollection{T}"/>.
    /// The collection itself cannot be null, but it can contain elements that are null, if type T is a reference type.
    /// </param>
    /// <exception cref="ArgumentNullException"><paramref name="collection"/> is null.</exception>
    public void AddRange(IEnumerable<T> collection)
    {
      InsertRange(Count, collection);
    }

    /// <summary>
    /// Inserts the elements of a collection into the <see cref="ObservableCollection{T}"/> at the specified index.
    /// </summary>
    /// <param name="index">The zero-based index at which the new elements should be inserted.</param>
    /// <param name="collection">The collection whose elements should be inserted into the List<T>.
    /// The collection itself cannot be null, but it can contain elements that are null, if type T is a reference type.</param>                
    /// <exception cref="ArgumentNullException"><paramref name="collection"/> is null.</exception>
    /// <exception cref="ArgumentOutOfRangeException"><paramref name="index"/> is not in the collection range.</exception>
    public void InsertRange(int index, IEnumerable<T> collection)
    {
      if (collection == null)
        throw new ArgumentNullException(nameof(collection));
      if (index < 0)
        throw new ArgumentOutOfRangeException(nameof(index));
      if (index > Count)
        throw new ArgumentOutOfRangeException(nameof(index));

      if (collection is ICollection<T> countable)
      {
        if (countable.Count == 0)
        {
          return;
        }
      }
      else if (!ContainsAny(collection))
      {
        return;
      }

      CheckReentrancy();

      //expand the following couple of lines when adding more constructors.
      var target = (List<T>)Items;
      target.InsertRange(index, collection);

      OnEssentialPropertiesChanged();

      if (!(collection is IList list))
        list = new List<T>(collection);

      OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, list, index));
    }

    /// <summary> 
    /// Removes the first occurence of each item in the specified collection from the <see cref="ObservableCollection{T}"/>.
    /// </summary>
    /// <param name="collection">The items to remove.</param>        
    /// <exception cref="ArgumentNullException"><paramref name="collection"/> is null.</exception>
    public void RemoveRange(IEnumerable<T> collection)
    {
      if (collection == null)
        throw new ArgumentNullException(nameof(collection));

      if (Count == 0)
      {
        return;
      }
      else if (collection is ICollection<T> countable)
      {
        if (countable.Count == 0)
          return;
        else if (countable.Count == 1)
          using (IEnumerator<T> enumerator = countable.GetEnumerator())
          {
            enumerator.MoveNext();
            Remove(enumerator.Current);
            return;
          }
      }
      else if (!(ContainsAny(collection)))
      {
        return;
      }

      CheckReentrancy();

      var clusters = new Dictionary<int, List<T>>();
      var lastIndex = -1;
      List<T> lastCluster = null;
      foreach (T item in collection)
      {
        var index = IndexOf(item);
        if (index < 0)
        {
          continue;
        }

        Items.RemoveAt(index);

        if (lastIndex == index && lastCluster != null)
        {
          lastCluster.Add(item);
        }
        else
        {
          clusters[lastIndex = index] = lastCluster = new List<T> { item };
        }
      }

      OnEssentialPropertiesChanged();

      if (Count == 0)
        OnCollectionReset();
      else
        foreach (KeyValuePair<int, List<T>> cluster in clusters)
          OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, cluster.Value, cluster.Key));

    }

    /// <summary>
    /// Iterates over the collection and removes all items that satisfy the specified match.
    /// </summary>
    /// <remarks>The complexity is O(n).</remarks>
    /// <param name="match"></param>
    /// <returns>Returns the number of elements that where </returns>
    /// <exception cref="ArgumentNullException"><paramref name="match"/> is null.</exception>
    public int RemoveAll(Predicate<T> match)
    {
      return RemoveAll(0, Count, match);
    }

    /// <summary>
    /// Iterates over the specified range within the collection and removes all items that satisfy the specified match.
    /// </summary>
    /// <remarks>The complexity is O(n).</remarks>
    /// <param name="index">The index of where to start performing the search.</param>
    /// <param name="count">The number of items to iterate on.</param>
    /// <param name="match"></param>
    /// <returns>Returns the number of elements that where </returns>
    /// <exception cref="ArgumentOutOfRangeException"><paramref name="index"/> is out of range.</exception>
    /// <exception cref="ArgumentOutOfRangeException"><paramref name="count"/> is out of range.</exception>
    /// <exception cref="ArgumentNullException"><paramref name="match"/> is null.</exception>
    public int RemoveAll(int index, int count, Predicate<T> match)
    {
      if (index < 0)
        throw new ArgumentOutOfRangeException(nameof(index));
      if (count < 0)
        throw new ArgumentOutOfRangeException(nameof(count));
      if (index + count > Count)
        throw new ArgumentOutOfRangeException(nameof(index));
      if (match == null)
        throw new ArgumentNullException(nameof(match));

      if (Count == 0)
        return 0;

      List<T> cluster = null;
      var clusterIndex = -1;
      var removedCount = 0;

      using (BlockReentrancy())
      using (DeferEvents())
      {
        for (var i = 0; i < count; i++, index++)
        {
          T item = Items[index];
          if (match(item))
          {
            Items.RemoveAt(index);
            removedCount++;

            if (clusterIndex == index)
            {
              Debug.Assert(cluster != null);
              cluster.Add(item);
            }
            else
            {
              cluster = new List<T> { item };
              clusterIndex = index;
            }

            index--;
          }
          else if (clusterIndex > -1)
          {
            OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, cluster, clusterIndex));
            clusterIndex = -1;
            cluster = null;
          }
        }

        if (clusterIndex > -1)
          OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, cluster, clusterIndex));
      }

      if (removedCount > 0)
        OnEssentialPropertiesChanged();

      return removedCount;
    }

    /// <summary>
    /// Removes a range of elements from the <see cref="ObservableCollection{T}"/>>.
    /// </summary>
    /// <param name="index">The zero-based starting index of the range of elements to remove.</param>
    /// <param name="count">The number of elements to remove.</param>
    /// <exception cref="ArgumentOutOfRangeException">The specified range is exceeding the collection.</exception>
    public void RemoveRange(int index, int count)
    {
      if (index < 0)
        throw new ArgumentOutOfRangeException(nameof(index));
      if (count < 0)
        throw new ArgumentOutOfRangeException(nameof(count));
      if (index + count > Count)
        throw new ArgumentOutOfRangeException(nameof(index));

      if (count == 0)
        return;

      if (count == 1)
      {
        RemoveItem(index);
        return;
      }

      //Items will always be List<T>, see constructors
      var items = (List<T>)Items;
      List<T> removedItems = items.GetRange(index, count);

      CheckReentrancy();

      items.RemoveRange(index, count);

      OnEssentialPropertiesChanged();

      if (Count == 0)
        OnCollectionReset();
      else
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, removedItems, index));
    }

    /// <summary> 
    /// Clears the current collection and replaces it with the specified collection,
    /// using the default <see cref="EqualityComparer{T}"/>.
    /// </summary>             
    /// <param name="collection">The items to fill the collection with, after clearing it.</param>
    /// <exception cref="ArgumentNullException"><paramref name="collection"/> is null.</exception>
    public void ReplaceRange(IEnumerable<T> collection)
    {
      ReplaceRange(0, Count, collection, EqualityComparer<T>.Default);
    }

    /// <summary>
    /// Clears the current collection and replaces it with the specified collection,
    /// using the specified comparer to skip equal items.
    /// </summary>
    /// <param name="collection">The items to fill the collection with, after clearing it.</param>
    /// <param name="comparer">An <see cref="IEqualityComparer{T}"/> to be used
    /// to check whether an item in the same location already existed before,
    /// which in case it would not be added to the collection, and no event will be raised for it.</param>
    /// <exception cref="ArgumentNullException"><paramref name="collection"/> is null.</exception>
    /// <exception cref="ArgumentNullException"><paramref name="comparer"/> is null.</exception>
    public void ReplaceRange(IEnumerable<T> collection, IEqualityComparer<T> comparer)
    {
      ReplaceRange(0, Count, collection, comparer);
    }

    /// <summary>
    /// Removes the specified range and inserts the specified collection,
    /// ignoring equal items (using <see cref="EqualityComparer{T}.Default"/>).
    /// </summary>
    /// <param name="index">The index of where to start the replacement.</param>
    /// <param name="count">The number of items to be replaced.</param>
    /// <param name="collection">The collection to insert in that location.</param>
    /// <exception cref="ArgumentOutOfRangeException"><paramref name="index"/> is out of range.</exception>
    /// <exception cref="ArgumentOutOfRangeException"><paramref name="count"/> is out of range.</exception>
    /// <exception cref="ArgumentNullException"><paramref name="collection"/> is null.</exception>
    public void ReplaceRange(int index, int count, IEnumerable<T> collection)
    {
      ReplaceRange(index, count, collection, EqualityComparer<T>.Default);
    }

    /// <summary>
    /// Removes the specified range and inserts the specified collection in its position, leaving equal items in equal positions intact.
    /// </summary>
    /// <param name="index">The index of where to start the replacement.</param>
    /// <param name="count">The number of items to be replaced.</param>
    /// <param name="collection">The collection to insert in that location.</param>
    /// <param name="comparer">The comparer to use when checking for equal items.</param>
    /// <exception cref="ArgumentOutOfRangeException"><paramref name="index"/> is out of range.</exception>
    /// <exception cref="ArgumentOutOfRangeException"><paramref name="count"/> is out of range.</exception>
    /// <exception cref="ArgumentNullException"><paramref name="collection"/> is null.</exception>
    /// <exception cref="ArgumentNullException"><paramref name="comparer"/> is null.</exception>
    public void ReplaceRange(int index, int count, IEnumerable<T> collection, IEqualityComparer<T> comparer)
    {
      if (index < 0)
        throw new ArgumentOutOfRangeException(nameof(index));
      if (count < 0)
        throw new ArgumentOutOfRangeException(nameof(count));
      if (index + count > Count)
        throw new ArgumentOutOfRangeException(nameof(index));

      if (collection == null)
        throw new ArgumentNullException(nameof(collection));
      if (comparer == null)
        throw new ArgumentNullException(nameof(comparer));

      if (collection is ICollection<T> countable)
      {
        if (countable.Count == 0)
        {
          RemoveRange(index, count);
          return;
        }
      }
      else if (!ContainsAny(collection))
      {
        RemoveRange(index, count);
        return;
      }

      if (index + count == 0)
      {
        InsertRange(0, collection);
        return;
      }

      if (!(collection is IList<T> list))
        list = new List<T>(collection);

      using (BlockReentrancy())
      using (DeferEvents())
      {
        var rangeCount = index + count;
        var addedCount = list.Count;

        var changesMade = false;
        List<T>
            newCluster = null,
            oldCluster = null;

        int i = index;
        for (; i < rangeCount && i - index < addedCount; i++)
        {
          //parallel position
          T old = this[i], @new = list[i - index];
          if (comparer.Equals(old, @new))
          {
            OnRangeReplaced(i, newCluster, oldCluster);
            continue;
          }
          else
          {
            Items[i] = @new;

            if (newCluster == null)
            {
              Debug.Assert(oldCluster == null);
              newCluster = new List<T> { @new };
              oldCluster = new List<T> { old };
            }
            else
            {
              newCluster.Add(@new);
              oldCluster.Add(old);
            }

            changesMade = true;
          }
        }

        OnRangeReplaced(i, newCluster, oldCluster);

        //exceeding position
        if (count != addedCount)
        {
          var items = (List<T>)Items;
          if (count > addedCount)
          {
            var removedCount = rangeCount - addedCount;
            T[] removed = new T[removedCount];
            items.CopyTo(i, removed, 0, removed.Length);
            items.RemoveRange(i, removedCount);
            OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, removed, i));
          }
          else
          {
            var k = i - index;
            T[] added = new T[addedCount - k];
            for (int j = k; j < addedCount; j++)
            {
              T @new = list[j];
              added[j - k] = @new;
            }
            items.InsertRange(i, added);
            OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, added, i));
          }

          OnEssentialPropertiesChanged();
        }
        else if (changesMade)
        {
          OnIndexerPropertyChanged();
        }
      }
    }

    #endregion Public Methods

    //------------------------------------------------------
    //
    //  Protected Methods
    //
    //------------------------------------------------------

    #region Protected Methods

    /// <summary>
    /// Called by base class Collection&lt;T&gt; when the list is being cleared;
    /// raises a CollectionChanged event to any listeners.
    /// </summary>
    protected override void ClearItems()
    {
      if (Count == 0)
        return;

      CheckReentrancy();
      base.ClearItems();
      OnEssentialPropertiesChanged();
      OnCollectionReset();
    }

    /// <summary>
    /// Called by base class Collection&lt;T&gt; when an item is set in list;
    /// raises a CollectionChanged event to any listeners.
    /// </summary>
    protected override void SetItem(int index, T item)
    {
      if (Equals(this[index], item))
        return;

      CheckReentrancy();
      T originalItem = this[index];
      base.SetItem(index, item);

      OnIndexerPropertyChanged();
      OnCollectionChanged(NotifyCollectionChangedAction.Replace, originalItem, item, index);
    }

    /// <summary>
    /// Raise CollectionChanged event to any listeners.
    /// Properties/methods modifying this ObservableCollection will raise
    /// a collection changed event through this virtual method.
    /// </summary>
    /// <remarks>
    /// When overriding this method, either call its base implementation
    /// or call <see cref="BlockReentrancy"/> to guard against reentrant collection changes.
    /// </remarks>
    protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
    {
      if (_deferredEvents != null)
      {
        _deferredEvents.Add(e);
        return;
      }
      base.OnCollectionChanged(e);
    }

    protected virtual IDisposable DeferEvents() => new DeferredEventsCollection(this);

    #endregion Protected Methods

    //------------------------------------------------------
    //
    //  Private Methods
    //
    //------------------------------------------------------

    #region Private Methods

    /// <summary>
    /// Helper function to determine if a collection contains any elements.
    /// </summary>
    /// <param name="collection">The collection to evaluate.</param>
    /// <returns></returns>
    private static bool ContainsAny(IEnumerable<T> collection)
    {
      using (IEnumerator<T> enumerator = collection.GetEnumerator())
        return enumerator.MoveNext();
    }

    /// <summary>
    /// Helper to raise Count property and the Indexer property.
    /// </summary>
    private void OnEssentialPropertiesChanged()
    {
      OnPropertyChanged(EventArgsCache.CountPropertyChanged);
      OnIndexerPropertyChanged();
    }

    /// <summary>
    /// /// Helper to raise a PropertyChanged event for the Indexer property
    /// /// </summary>
    private void OnIndexerPropertyChanged() =>
      OnPropertyChanged(EventArgsCache.IndexerPropertyChanged);

    /// <summary>
    /// Helper to raise CollectionChanged event to any listeners
    /// </summary>
    private void OnCollectionChanged(NotifyCollectionChangedAction action, object oldItem, object newItem, int index) =>
      OnCollectionChanged(new NotifyCollectionChangedEventArgs(action, newItem, oldItem, index));

    /// <summary>
    /// Helper to raise CollectionChanged event with action == Reset to any listeners
    /// </summary>
    private void OnCollectionReset() =>
      OnCollectionChanged(EventArgsCache.ResetCollectionChanged);

    /// <summary>
    /// Helper to raise event for clustered action and clear cluster.
    /// </summary>
    /// <param name="followingItemIndex">The index of the item following the replacement block.</param>
    /// <param name="newCluster"></param>
    /// <param name="oldCluster"></param>
    //TODO should have really been a local method inside ReplaceRange(int index, int count, IEnumerable<T> collection, IEqualityComparer<T> comparer),
    //move when supported language version updated.
    private void OnRangeReplaced(int followingItemIndex, ICollection<T> newCluster, ICollection<T> oldCluster)
    {
      if (oldCluster == null || oldCluster.Count == 0)
      {
        Debug.Assert(newCluster == null || newCluster.Count == 0);
        return;
      }

      OnCollectionChanged(
          new NotifyCollectionChangedEventArgs(
              NotifyCollectionChangedAction.Replace,
              new List<T>(newCluster),
              new List<T>(oldCluster),
              followingItemIndex - oldCluster.Count));

      oldCluster.Clear();
      newCluster.Clear();
    }

    #endregion Private Methods

    //------------------------------------------------------
    //
    //  Private Types
    //
    //------------------------------------------------------

    #region Private Types
    private sealed class DeferredEventsCollection : List<NotifyCollectionChangedEventArgs>, IDisposable
    {
      private readonly ObservableRangeCollection<T> _collection;
      public DeferredEventsCollection(ObservableRangeCollection<T> collection)
      {
        Debug.Assert(collection != null);
        Debug.Assert(collection._deferredEvents == null);
        _collection = collection;
        _collection._deferredEvents = this;
      }

      public void Dispose()
      {
        _collection._deferredEvents = null;
        foreach (var args in this)
          _collection.OnCollectionChanged(args);
      }
    }

    #endregion Private Types

  }

  /// <remarks>
  /// To be kept outside <see cref="ObservableCollection{T}"/>, since otherwise, a new instance will be created for each generic type used.
  /// </remarks>
  internal static class EventArgsCache
  {
    internal static readonly PropertyChangedEventArgs CountPropertyChanged = new PropertyChangedEventArgs("Count");
    internal static readonly PropertyChangedEventArgs IndexerPropertyChanged = new PropertyChangedEventArgs("Item[]");
    internal static readonly NotifyCollectionChangedEventArgs ResetCollectionChanged = new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset);
  }
} 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-05-12T04:26:27.287

我认为 AddRange 更好地实现如下：

```
public void AddRange(IEnumerable<T> collection)
{
    foreach (var i in collection) Items.Add(i);
    OnCollectionChanged(
        new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
} 
```

它会为您保存一份列表副本。此外，如果您想进行微优化，您最多可以添加 N 个项目，如果添加的项目超过 N 个，则进行重置。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-03-22T10:08:08.110

您必须小心地将 UI 绑定到您的自定义集合 - Default CollectionView 类仅支持项目的单个通知。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2011-12-08T17:09:20.367

需要`OnPropertyChanged("Count")`和`OnPropertyChanged("Item[]")`调用的证明，以便按照`ObservableCollection`. 请注意，如果您不打扰，我不知道会有什么后果！

这是一个测试方法，它表明在普通的 observable 集合中，每个 add 都有两个 PropertyChange 事件。一为`"Count"`一为`"Item[]"`。

```
[TestMethod]
public void TestAddSinglesInOldObsevableCollection()
{
  int colChangedEvents = 0;
  int propChangedEvents = 0;
  var collection = new ObservableCollection<object>();
  collection.CollectionChanged += (sender, e) => { colChangedEvents++; };
  (collection as INotifyPropertyChanged).PropertyChanged += (sender, e) => { propChangedEvents++; };
  collection.Add(new object());
  collection.Add(new object());
  collection.Add(new object());
  Assert.AreEqual(3, colChangedEvents);
  Assert.AreEqual(6, propChangedEvents);
} 
```

@Shimmy，交换您收藏的标准并更改为添加范围，您将获得零 PropertyChanges。请注意，集合更改确实可以正常工作，但不能完全按照 ObservableCollection 所做的。所以测试 shimmy 集合看起来像这样：

```
[TestMethod]
public void TestShimmyAddRange()
{
  int colChangedEvents = 0;
  int propChangedEvents = 0;
  var collection = new ShimmyObservableCollection<object>();
  collection.CollectionChanged += (sender, e) => { colChangedEvents++; };
  (collection as INotifyPropertyChanged).PropertyChanged += (sender, e) => { propChangedEvents++; };
  collection.AddRange(new[]{
    new object(), new object(), new object(), new object()}); //4 objects at once
  Assert.AreEqual(1, colChangedEvents);  //great, just one!
  Assert.AreEqual(2, propChangedEvents); //fails, no events :(
} 
```

仅供参考，这里是来自 ObservableCollection 的 InsertItem（也由 Add 调用）的代码：

```
protected override void InsertItem(int index, T item)
{
  base.CheckReentrancy();
  base.InsertItem(index, item);
  base.OnPropertyChanged("Count");
  base.OnPropertyChanged("Item[]");
  base.OnCollectionChanged(NotifyCollectionChangedAction.Add, item, index);
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-11-27T11:10:21.227

由于可能对 ObservableCollection 执行许多操作，例如先清除然后添加范围，然后为组合框插入“全部”项，我最终得到了以下解决方案：

```
public static class LinqExtensions
{
    public static ICollection<T> AddRange<T>(this ICollection<T> source, IEnumerable<T> addSource)
    {
        foreach(T item in addSource)
        {
            source.Add(item);
        }

        return source;
    }
}

public class ExtendedObservableCollection<T>: ObservableCollection<T>
{
    public void Execute(Action<IList<T>> itemsAction)
    {
        itemsAction(Items);
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
    }
} 
```

以及如何使用它的示例：

```
MyDogs.Execute(items =>
{
    items.Clear();
    items.AddRange(Context.Dogs);
    items.Insert(0, new Dog { Id = 0, Name = "All Dogs" });
}); 
```

在 Execute 完成对基础列表的处理后，将仅调用一次 Reset 通知。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-05-12T14:18:13.840

C# 总结的后代。

更多阅读：http: [//blogs.msdn.com/b/nathannesbit/archive/2009/04/20/addrange-and-observablecollection.aspx](http://blogs.msdn.com/b/nathannesbit/archive/2009/04/20/addrange-and-observablecollection.aspx)

```
public sealed class ObservableCollectionEx<T> : ObservableCollection<T>
{
    #region Ctor

    public ObservableCollectionEx()
    {
    }

    public ObservableCollectionEx(List<T> list) : base(list)
    {
    }

    public ObservableCollectionEx(IEnumerable<T> collection) : base(collection)
    {
    }

    #endregion

    /// <summary> 
    /// Adds the elements of the specified collection to the end of the ObservableCollection(Of T). 
    /// </summary> 
    public void AddRange(
        IEnumerable<T> itemsToAdd,
        ECollectionChangeNotificationMode notificationMode = ECollectionChangeNotificationMode.Add)
    {
        if (itemsToAdd == null)
        {
            throw new ArgumentNullException("itemsToAdd");
        }
        CheckReentrancy();

        if (notificationMode == ECollectionChangeNotificationMode.Reset)
        {
            foreach (var i in itemsToAdd)
            {
                Items.Add(i);
            }

            OnPropertyChanged(new PropertyChangedEventArgs("Count"));
            OnPropertyChanged(new PropertyChangedEventArgs("Item[]"));
            OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));

            return;
        }

        int startIndex = Count;
        var changedItems = itemsToAdd is List<T> ? (List<T>) itemsToAdd : new List<T>(itemsToAdd);
        foreach (var i in changedItems)
        {
            Items.Add(i);
        }

        OnPropertyChanged(new PropertyChangedEventArgs("Count"));
        OnPropertyChanged(new PropertyChangedEventArgs("Item[]"));
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, changedItems, startIndex));
    }

    public enum ECollectionChangeNotificationMode
    {
        /// <summary>
        /// Notifies that only a portion of data was changed and supplies the changed items (not supported by some elements,
        /// like CollectionView class).
        /// </summary>
        Add,

        /// <summary>
        /// Notifies that the entire collection was changed, does not supply the changed items (may be inneficient with large
        /// collections as requires the full update even if a small portion of items was added).
        /// </summary>
        Reset
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-23T08:35:54.173

是的，添加您自己的自定义 Observable 集合就足够公平了。不要忘记引发适当的事件，无论它是否被 UI 使用；）您将必须引发“Item []”属性（WPF 侧和绑定控件需要）以及 NotifyCollectionChangedEventArgs 的属性更改通知添加了一组项目（您的范围）。我做过这样的事情（以及排序支持和其他一些事情），并且在演示层和代码隐藏层方面都没有问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-12-17T08:49:07.843

[以下](http://www.codeproject.com/KB/dotnet/MTObservableCollection.aspx?msg=3412002)是关于集合更改和 UI 问题的一些额外帮助：

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-06-16T11:10:00.150

ObservableRangeCollection 应该通过类似的测试

```
[Test]
public void TestAddRangeWhileBoundToListCollectionView()
{
    int collectionChangedEventsCounter = 0;
    int propertyChangedEventsCounter = 0;
    var collection = new ObservableRangeCollection<object>();

    collection.CollectionChanged += (sender, e) => { collectionChangedEventsCounter++; };
    (collection as INotifyPropertyChanged).PropertyChanged += (sender, e) => { propertyChangedEventsCounter++; };

    var list = new ListCollectionView(collection);

    collection.AddRange(new[] { new object(), new object(), new object(), new object() });

    Assert.AreEqual(4, collection.Count);
    Assert.AreEqual(1, collectionChangedEventsCounter);
    Assert.AreEqual(2, propertyChangedEventsCounter);
} 
```

否则我们得到

```
System.NotSupportedException : Range actions are not supported. 
```

与控件一起使用时。

我没有看到理想的解决方案，但 NotifyCollectionChangedAction.Reset 而不是 Add/Remove 部分解决了问题。参见net_prog 提到的[http://blogs.msdn.com/b/nathannesbit/archive/2009/04/20/addrange-and-observablecollection.aspx](http://blogs.msdn.com/b/nathannesbit/archive/2009/04/20/addrange-and-observablecollection.aspx)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-11-01T14:54:12.180

这是一个简单的 observablecollection，它在 AddRange 方法结束时通知，基于这篇文章 [https://peteohanlon.wordpress.com/2008/10/22/bulk-loading-in-observablecollection/](https://peteohanlon.wordpress.com/2008/10/22/bulk-loading-in-observablecollection/)

根据这篇文章[https://thomaslevesque.com/2009/04/17/wpf-binding-to-an-asynchronous-collection/ ，它也是异步和跨线程可修改的](https://thomaslevesque.com/2009/04/17/wpf-binding-to-an-asynchronous-collection/)

```
public class ConcurrentObservableCollection<T> : ObservableCollection<T>
{
    private SynchronizationContext _synchronizationContext = SynchronizationContext.Current;

    private bool _suppressNotification = false;

    public ConcurrentObservableCollection()
        : base()
    {
    }
    public ConcurrentObservableCollection(IEnumerable<T> list)
        : base(list)
    {
    }

    public void AddRange(IEnumerable<T> collection)
    {
        if (collection != null)
        {
            _suppressNotification = true;
            foreach (var item in collection)
            {
                this.Add(item);
            }
            _suppressNotification = false;

            OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
        }
    }
    public void RemoveRange(IEnumerable<T> collection)
    {
        if (collection != null)
        {
            _suppressNotification = true;
            foreach (var item in collection)
            {
                this.Remove(item);
            }
            _suppressNotification = false;

            OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
        }
    }

    protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
    {
        if (SynchronizationContext.Current == _synchronizationContext)
        {
            // Execute the CollectionChanged event on the current thread
            RaiseCollectionChanged(e);
        }
        else
        {
            // Raises the CollectionChanged event on the creator thread
            _synchronizationContext.Send(RaiseCollectionChanged, e);
        }
    }
    protected override void OnPropertyChanged(PropertyChangedEventArgs e)
    {
        if (SynchronizationContext.Current == _synchronizationContext)
        {
            // Execute the PropertyChanged event on the current thread
            RaisePropertyChanged(e);
        }
        else
        {
            // Raises the PropertyChanged event on the creator thread
            _synchronizationContext.Send(RaisePropertyChanged, e);
        }
    }

    private void RaiseCollectionChanged(object param)
    {
        // We are in the creator thread, call the base implementation directly
        if (!_suppressNotification)
            base.OnCollectionChanged((NotifyCollectionChangedEventArgs)param);
    }
    private void RaisePropertyChanged(object param)
    {
        // We are in the creator thread, call the base implementation directly
        base.OnPropertyChanged((PropertyChangedEventArgs)param);
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-04-13T19:24:22.457

这是对已接受答案的修改以提供更多功能。

RangeCollection.cs：

```
public class RangeCollection<T> : ObservableCollection<T>
{
    #region Members

    /// <summary>
    /// Occurs when a single item is added.
    /// </summary>
    public event EventHandler<ItemAddedEventArgs<T>> ItemAdded;

    /// <summary>
    /// Occurs when a single item is inserted.
    /// </summary>
    public event EventHandler<ItemInsertedEventArgs<T>> ItemInserted;

    /// <summary>
    /// Occurs when a single item is removed.
    /// </summary>
    public event EventHandler<ItemRemovedEventArgs<T>> ItemRemoved;

    /// <summary>
    /// Occurs when a single item is replaced.
    /// </summary>
    public event EventHandler<ItemReplacedEventArgs<T>> ItemReplaced;

    /// <summary>
    /// Occurs when items are added to this.
    /// </summary>
    public event EventHandler<ItemsAddedEventArgs<T>> ItemsAdded;

    /// <summary>
    /// Occurs when items are removed from this.
    /// </summary>
    public event EventHandler<ItemsRemovedEventArgs<T>> ItemsRemoved;

    /// <summary>
    /// Occurs when items are replaced within this.
    /// </summary>
    public event EventHandler<ItemsReplacedEventArgs<T>> ItemsReplaced;

    /// <summary>
    /// Occurs when entire collection is cleared.
    /// </summary>
    public event EventHandler<ItemsClearedEventArgs<T>> ItemsCleared;

    /// <summary>
    /// Occurs when entire collection is replaced.
    /// </summary>
    public event EventHandler<CollectionReplacedEventArgs<T>> CollectionReplaced;

    #endregion

    #region Helper Methods

    /// <summary>
    /// Throws exception if any of the specified objects are null.
    /// </summary>
    private void Check(params T[] Items)
    {
        foreach (T Item in Items)
        {
            if (Item == null)
            {
                throw new ArgumentNullException("Item cannot be null.");
            }
        }
    }

    private void Check(IEnumerable<T> Items)
    {
        if (Items == null) throw new ArgumentNullException("Items cannot be null.");
    }

    private void Check(IEnumerable<IEnumerable<T>> Items)
    {
        if (Items == null) throw new ArgumentNullException("Items cannot be null.");
    }

    private void RaiseChanged(NotifyCollectionChangedAction Action)
    {
        this.OnPropertyChanged(new PropertyChangedEventArgs("Count"));
        this.OnPropertyChanged(new PropertyChangedEventArgs("Item[]"));
        this.OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
    }

    #endregion

    #region Bulk Methods

    /// <summary> 
    /// Adds the elements of the specified collection to the end of this.
    /// </summary> 
    public void AddRange(IEnumerable<T> NewItems)
    {
        this.Check(NewItems);
        foreach (var i in NewItems) this.Items.Add(i);
        this.RaiseChanged(NotifyCollectionChangedAction.Reset);
        this.OnItemsAdded(new ItemsAddedEventArgs<T>(NewItems));
    }

    /// <summary>
    /// Adds variable IEnumerable<T> to this.
    /// </summary>
    /// <param name="List"></param>
    public void AddRange(params IEnumerable<T>[] NewItems)
    {
        this.Check(NewItems);
        foreach (IEnumerable<T> Items in NewItems) foreach (T Item in Items) this.Items.Add(Item);
        this.RaiseChanged(NotifyCollectionChangedAction.Reset);
        //TO-DO: Raise OnItemsAdded with combined IEnumerable<T>.
    }

    /// <summary> 
    /// Removes the first occurence of each item in the specified collection. 
    /// </summary> 
    public void Remove(IEnumerable<T> OldItems)
    {
        this.Check(OldItems);
        foreach (var i in OldItems) Items.Remove(i);
        this.RaiseChanged(NotifyCollectionChangedAction.Reset);
        OnItemsRemoved(new ItemsRemovedEventArgs<T>(OldItems));
    }

    /// <summary>
    /// Removes all occurences of each item in the specified collection.
    /// </summary>
    /// <param name="itemsToRemove"></param>
    public void RemoveAll(IEnumerable<T> OldItems)
    {
        this.Check(OldItems);
        var set = new HashSet<T>(OldItems);
        var list = this as List<T>;
        int i = 0;
        while (i < this.Count) if (set.Contains(this[i])) this.RemoveAt(i); else i++;
        this.RaiseChanged(NotifyCollectionChangedAction.Reset);
        OnItemsRemoved(new ItemsRemovedEventArgs<T>(OldItems));
    }

    /// <summary> 
    /// Replaces all occurences of a single item with specified item.
    /// </summary> 
    public void ReplaceAll(T Old, T New)
    {
        this.Check(Old, New);
        this.Replace(Old, New, false);
        this.RaiseChanged(NotifyCollectionChangedAction.Reset);
        this.OnItemReplaced(new ItemReplacedEventArgs<T>(Old, New));
    }

    /// <summary> 
    /// Clears this and adds specified collection. 
    /// </summary> 
    public void ReplaceCollection(IEnumerable<T> NewItems, bool SupressEvent = false)
    {
        this.Check(NewItems);
        IEnumerable<T> OldItems = new List<T>(this.Items);
        this.Items.Clear();
        foreach (T Item in NewItems) this.Items.Add(Item);
        this.RaiseChanged(NotifyCollectionChangedAction.Reset);
        this.OnReplaced(new CollectionReplacedEventArgs<T>(OldItems, NewItems));
    }

    private void Replace(T Old, T New, bool BreakFirst)
    {
        List<T> Cloned = new List<T>(this.Items);
        int i = 0;
        foreach (T Item in Cloned)
        {
            if (Item.Equals(Old))
            {
                this.Items.Remove(Item);
                this.Items.Insert(i, New);
                if (BreakFirst) break;
            }
            i++;
        }
    }

    /// <summary> 
    /// Replaces the first occurence of a single item with specified item.
    /// </summary> 
    public void Replace(T Old, T New)
    {
        this.Check(Old, New);
        this.Replace(Old, New, true);
        this.RaiseChanged(NotifyCollectionChangedAction.Reset);
        this.OnItemReplaced(new ItemReplacedEventArgs<T>(Old, New));
    }

    #endregion

    #region  New Methods

    /// <summary>
    /// Removes a single item.
    /// </summary>
    /// <param name="Item"></param>
    public new void Remove(T Item)
    {
        this.Check(Item);
        base.Remove(Item);
        OnItemRemoved(new ItemRemovedEventArgs<T>(Item));
    }

    /// <summary>
    /// Removes a single item at specified index.
    /// </summary>
    /// <param name="i"></param>
    public new void RemoveAt(int i)
    {
        T OldItem = this.Items[i]; //This will throw first if null
        base.RemoveAt(i);
        OnItemRemoved(new ItemRemovedEventArgs<T>(OldItem));
    }

    /// <summary>
    /// Clears this.
    /// </summary>
    public new void Clear()
    {
        IEnumerable<T> OldItems = new List<T>(this.Items);
        this.Items.Clear();
        this.RaiseChanged(NotifyCollectionChangedAction.Reset);
        this.OnCleared(new ItemsClearedEventArgs<T>(OldItems));
    }

    /// <summary>
    /// Adds a single item to end of this.
    /// </summary>
    /// <param name="t"></param>
    public new void Add(T Item)
    {
        this.Check(Item);
        base.Add(Item);
        this.OnItemAdded(new ItemAddedEventArgs<T>(Item));
    }

    /// <summary>
    /// Inserts a single item at specified index.
    /// </summary>
    /// <param name="i"></param>
    /// <param name="t"></param>
    public new void Insert(int i, T Item)
    {
        this.Check(Item);
        base.Insert(i, Item);
        this.OnItemInserted(new ItemInsertedEventArgs<T>(Item, i));
    }

    /// <summary>
    /// Returns list of T.ToString().
    /// </summary>
    /// <returns></returns>
    public new IEnumerable<string> ToString()
    {
        foreach (T Item in this) yield return Item.ToString();
    }

    #endregion

    #region Event Methods

    private void OnItemAdded(ItemAddedEventArgs<T> i)
    {
        if (this.ItemAdded != null) this.ItemAdded(this, new ItemAddedEventArgs<T>(i.NewItem));
    }

    private void OnItemInserted(ItemInsertedEventArgs<T> i)
    {
        if (this.ItemInserted != null) this.ItemInserted(this, new ItemInsertedEventArgs<T>(i.NewItem, i.Index));
    }

    private void OnItemRemoved(ItemRemovedEventArgs<T> i)
    {
        if (this.ItemRemoved != null) this.ItemRemoved(this, new ItemRemovedEventArgs<T>(i.OldItem));
    }

    private void OnItemReplaced(ItemReplacedEventArgs<T> i)
    {
        if (this.ItemReplaced != null) this.ItemReplaced(this, new ItemReplacedEventArgs<T>(i.OldItem, i.NewItem));
    }

    private void OnItemsAdded(ItemsAddedEventArgs<T> i)
    {
        if (this.ItemsAdded != null) this.ItemsAdded(this, new ItemsAddedEventArgs<T>(i.NewItems));
    }

    private void OnItemsRemoved(ItemsRemovedEventArgs<T> i)
    {
        if (this.ItemsRemoved != null) this.ItemsRemoved(this, new ItemsRemovedEventArgs<T>(i.OldItems));
    }

    private void OnItemsReplaced(ItemsReplacedEventArgs<T> i)
    {
        if (this.ItemsReplaced != null) this.ItemsReplaced(this, new ItemsReplacedEventArgs<T>(i.OldItems, i.NewItems));
    }

    private void OnCleared(ItemsClearedEventArgs<T> i)
    {
        if (this.ItemsCleared != null) this.ItemsCleared(this, new ItemsClearedEventArgs<T>(i.OldItems));
    }

    private void OnReplaced(CollectionReplacedEventArgs<T> i)
    {
        if (this.CollectionReplaced != null) this.CollectionReplaced(this, new CollectionReplacedEventArgs<T>(i.OldItems, i.NewItems));
    }

    #endregion

    #region RangeCollection

    /// <summary> 
    /// Initializes a new instance. 
    /// </summary> 
    public RangeCollection() : base() { }

    /// <summary> 
    /// Initializes a new instance from specified enumerable. 
    /// </summary> 
    public RangeCollection(IEnumerable<T> Collection) : base(Collection) { }

    /// <summary> 
    /// Initializes a new instance from specified list.
    /// </summary> 
    public RangeCollection(List<T> List) : base(List) { }

    /// <summary>
    /// Initializes a new instance with variable T.
    /// </summary>
    public RangeCollection(params T[] Items) : base()
    {
        this.AddRange(Items);
    }

    /// <summary>
    /// Initializes a new instance with variable enumerable.
    /// </summary>
    public RangeCollection(params IEnumerable<T>[] Items) : base()
    {
        this.AddRange(Items);
    }

    #endregion
} 
```

事件类：

```
public class CollectionReplacedEventArgs<T> : ReplacedEventArgs<T>
{
    public CollectionReplacedEventArgs(IEnumerable<T> Old, IEnumerable<T> New) : base(Old, New) { }
}

public class ItemAddedEventArgs<T> : EventArgs
{
    public T NewItem;
    public ItemAddedEventArgs(T t)
    {
        this.NewItem = t;
    }
}

public class ItemInsertedEventArgs<T> : EventArgs
{
    public int Index;
    public T NewItem;
    public ItemInsertedEventArgs(T t, int i)
    {
        this.NewItem = t;
        this.Index = i;
    }
}

public class ItemRemovedEventArgs<T> : EventArgs
{
    public T OldItem;
    public ItemRemovedEventArgs(T t)
    {
        this.OldItem = t;
    }
}

public class ItemReplacedEventArgs<T> : EventArgs
{
    public T OldItem;
    public T NewItem;
    public ItemReplacedEventArgs(T Old, T New)
    {
        this.OldItem = Old;
        this.NewItem = New;
    }
}

public class ItemsAddedEventArgs<T> : EventArgs
{
    public IEnumerable<T> NewItems;
    public ItemsAddedEventArgs(IEnumerable<T> t)
    {
        this.NewItems = t;
    }
}

public class ItemsClearedEventArgs<T> : RemovedEventArgs<T>
{
    public ItemsClearedEventArgs(IEnumerable<T> Old) : base(Old) { }
}

public class ItemsRemovedEventArgs<T> : RemovedEventArgs<T>
{
    public ItemsRemovedEventArgs(IEnumerable<T> Old) : base(Old) { }
}

public class ItemsReplacedEventArgs<T> : ReplacedEventArgs<T>
{
    public ItemsReplacedEventArgs(IEnumerable<T> Old, IEnumerable<T> New) : base(Old, New) { }
}

public class RemovedEventArgs<T> : EventArgs
{
    public IEnumerable<T> OldItems;
    public RemovedEventArgs(IEnumerable<T> Old)
    {
        this.OldItems = Old;
    }
}

public class ReplacedEventArgs<T> : EventArgs
{
    public IEnumerable<T> OldItems;
    public IEnumerable<T> NewItems;
    public ReplacedEventArgs(IEnumerable<T> Old, IEnumerable<T> New)
    {
        this.OldItems = Old;
        this.NewItems = New;
    }
} 
```

注意：我没有`OnCollectionChanged`在基本方法中手动引发，因为它似乎只能`CollectionChangedEventArgs`使用`Reset`操作来创建。如果您尝试提高`OnCollectionChanged`使用`Reset`单个项目更改，您的项目控件将出现闪烁，这是您想要避免的事情。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2012-10-06T17:57:42.417

您还可以使用此代码来扩展 ObservableCollection：

```
public static class ObservableCollectionExtend
{
    public static void AddRange<TSource>(this ObservableCollection<TSource> source, IEnumerable<TSource> items)
    {
        foreach (var item in items)
        {
            source.Add(item);
        }
    }
} 
```

然后您不需要更改现有代码中的类。

# c# - InvalidOperationException 使用带有 Windows 窗体的 PFX

> ID：670586
> 
> 赞同：1
> 
> 时间：2009-03-22T05:21:33.447
> 
> 标签：c#, winforms, data-binding, parallel-processing, pfx

我这里有两个例外。不知道为什么会发生，因为我使用 Form.Invoke 在 UI 线程上运行 UI 更新。所以首先，

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Xml;
using System.Windows.Forms;

namespace Toplr
{
    using System.Collections.Specialized;
    using System.Xml.XPath;
    using System.Xml.Linq;
    using System.Text;
    using System.ServiceModel.Web;
    using System.ServiceModel.Syndication;
    using System.Net;
    using System.Web;
    using System.Xml.Schema;
    using System.IO;
    using System.Threading;
    using System.Threading.Tasks;

    public partial class ToplrForm : Form
    {
        private readonly Uri SearchBase = new Uri(@"http://www.twine.com/feed/atom/entries/");

        private readonly UriTemplate SearchTemplate = new UriTemplate(@"search?type={type}&author={author}");

        public ToplrForm()
        {
            InitializeComponent();
            Exiting = false;
            TaskContext = new TaskManager();
            Items = new AsyncBindingList<Twine>(this);
            twineBindingSource.DataSource = Items;
        }

        private void ToplrForm_Load(object sender, EventArgs e)
        {
        }

        private readonly TaskManager TaskContext;

        private readonly AsyncBindingList<Twine> Items;

        private bool Exiting;

        private void exitToolStripMenuItem_Click(object sender, EventArgs e)
        {
            MessageBox.Show("Close()");
            Close();
        }

        private void ToplrForm_FormClosing(object sender, FormClosingEventArgs e)
        {
            MessageBox.Show("Exiting = tru");
            Exiting = true;
            //TaskContext.Dispose();
        }

        private void saveToolStripMenuItem_Click(object sender, EventArgs e)
        {
            var sfd = new SaveFileDialog()
            {
                ValidateNames = true
            };
            if (sfd.ShowDialog() == DialogResult.OK)
            {
                using (var xtw = new XmlTextWriter(sfd.FileName, Encoding.UTF8))
                {
                    var xw = XmlWriter.Create(xtw);
                    xw.WriteStartDocument();
                    xw.WriteStartElement("opml");
                    xw.WriteAttributeString("version", "1.1");
                    xw.WriteStartElement("head");
                    xw.WriteElementString("title", userNameComboBox.Text);
                    xw.WriteEndElement();
                    xw.WriteStartElement("body");
                    foreach (var row in twineDataGridView.SelectedRows)
                    {
                        var twine = (Twine)((DataGridViewRow)row).DataBoundItem;
                        if (twine != null)
                        {
                            xw.WriteStartElement("outline");
                            xw.WriteAttributeString("text", twine.Title);
                            xw.WriteAttributeString("type", "link");
                            xw.WriteAttributeString("url", twine.HtmlAddress);
                            xw.WriteStartElement("outline");
                            xw.WriteAttributeString("text", twine.Title);
                            xw.WriteAttributeString("type", "atom");
                            xw.WriteAttributeString("url", twine.AtomAddress);
                            xw.WriteEndElement();
                            xw.WriteEndElement();
                        }
                    }
                    xw.WriteEndElement();
                    xw.WriteEndElement();
                    xw.WriteEndDocument();
                    xw.Close();
                }
            }
        }

        private void aboutToolStripMenuItem_Click(object sender, EventArgs e)
        {
            MessageBox.Show("Copyright (C) 2009 Bent Rasmussen");
        }

        private void accessButton_Click(object sender, EventArgs e)
        {
            var user = userNameComboBox.Text;
            Task.Create(x => ProcessAccount(user));
        }

        public void ProcessAccount(string user)
        {
            this.Invoke((Action)(() =>
            {
                userNameComboBox.Enabled = false;
                accessButton.Enabled = false;
                toolStripStatusLabel1.Text = "Processing...";
            }));

            var param = new NameValueCollection();
            param.Add("type", "Twine");
            param.Add("author", user);
            var source = SearchTemplate.BindByName(SearchBase, param);

            var wc = new WebClient();

            using (var feedStream = wc.OpenRead(source))
            {
                var reader = XmlReader.Create(feedStream);
                var feed = SyndicationFeed.Load(reader);
                int c = 0, i = 0;

                foreach (var item in feed.Items)
                {
                    this.Invoke((Action)(() =>
                    {
                        toolStripProgressBar1.Increment(1);
                        toolStripStatusLabel1.Text = "Processing...";
                    }));

                    if (item.Links.Count != 0)
                    {
                        //try
                        {
                            ProcessTwine(item);
                            i++;
                        }
                        //catch (Exception)
                        {
                            c++;
                        }
                    }
                    if (Exiting)
                        break;
                }
            }

            this.Invoke((Action)(() =>
            {
                userNameComboBox.Enabled = true;
                accessButton.Enabled = true;
            }));
        }

        private Twine ProcessTwine(SyndicationItem item)
        {
            var result = new Twine();
            result.Title = item.Title.Text;
            result.HtmlAddress = item.Links[0].Uri.ToString();
            result.AtomAddress = "";

            var wc = new WebClient();
            var data = wc.DownloadData(result.HtmlAddress);

            var stream = new MemoryStream(data);
            var readerSettings = new XmlReaderSettings()
            {
                ProhibitDtd = false,
                ValidationType = ValidationType.None,
                ValidationFlags = XmlSchemaValidationFlags.None,
            };
            var reader = XmlReader.Create(stream, readerSettings);
            var doc = XDocument.Load(reader);
            var htmlNs = (XNamespace)"http://www.w3.org/1999/xhtml";
            var root = doc.Root;
            var atom = from r in root.Descendants(htmlNs + "head").Descendants(htmlNs + "link")
                       where r.Attribute("rel").Value == "alternate" && r.Attribute("type").Value == "application/atom+xml"
                       select r.Attribute("href");
            foreach (var e in atom)
            {
                if (e.Value != "")
                {
                    result.AtomAddress = e.Value;
                    this.BeginInvoke((Action)(() =>
                    {
                        Items.Add(result);
                        toolStripProgressBar1.Increment(1);
                    }));
                }
                break;
            }

            return result;
        }
    }
} 
```

这会触发此片段上的异常“无法访问已处置的对象”

```
 this.Invoke((Action)(() =>
            {
                toolStripProgressBar1.Increment(1);
                toolStripStatusLabel1.Text = "Processing...";
            })); 
```

如果这个片段被注释掉，我会遇到下一个问题——程序级别的**TargetInvocationException**。

内部异常是**InvalidOperationException**。

代码很简单，所以实现起来应该不难，我只是新的一些提示继续前进。

[Visual Studio 项目文件](http://dl.getdropbox.com/u/797094/Toplr.zip).

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T07:25:32.247

如果用户点击退出按钮，`Close()`则调用该方法，并且 UI 开始被拆除。但是，您的工作人员代码会继续运行并尝试更新 UI，但它不能再这样做了。

如果您集中所有这些调用调用：

```
public void UpdateUI(Action action) {
    if(!Exiting) this.Invoke(action);
} 
```

您可以致电：

```
UpdateUI(() =>
        {
            toolStripProgressBar1.Increment(1);
            toolStripStatusLabel1.Text = "Processing...";
        }); 
```

（等等 - 所有的`this.Invoke`调用都应该使用`UpdateUI`）并且它应该可以工作。此外，使`Exiting`挥发性。

# iphone - CAKeyframeAnimation 后 Layer.frame 没有更新？

> ID：670591
> 
> 赞同：0
> 
> 时间：2009-03-22T05:39:48.367
> 
> 标签：iphone, objective-c

我正在尝试为图层的位置设置动画。它动画，但它的 frame 属性在动画结束时没有更新，似乎只有它的presentationLayer 是。这就是我正在做的事情：

```
CGMutablePathRef path = CGPathCreateMutable();
CGPathMoveToPoint   (path, NULL, layer.frame.origin.x, layer.frame.origin.y);
CGPathAddLineToPoint(path, NULL, 20,  20);
CGPathAddLineToPoint(path, NULL, 20,  460);
CGPathAddLineToPoint(path, NULL, 300, 460);

CAKeyframeAnimation* animation = [CAKeyframeAnimation animationWithKeyPath:@"position"];
animation.path = path;
animation.calculationMode = kCAAnimationPaced;
animation.repeatCount = 0;
animation.autoreverses = NO;

CAAnimationGroup *theGroup = [CAAnimationGroup animation];
theGroup.animations = [NSArray arrayWithObject:animation];
theGroup.timingFunction=[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut];
theGroup.duration = 2;
theGroup.removedOnCompletion = NO;
theGroup.fillMode = kCAFillModeForwards;
CFRelease(path);

[layer addAnimation:theGroup forKey:@"animatePosition"]; 
```

动画完成后，图层位于正确的目的地，但是当我查询它的帧值时，它说它仍在原来的位置！我们应该何时/何地/如何使 frame 属性与 layer 的presentationLayer frame 属性同步？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T14:08:01.373

动画实际上不会更改底层图层上的任何值。要更新实际的帧值，在最后一行之后，只需将帧设置为新值。然后你可能可以摆脱`removedOnCompletion = NO;`

只要动画不是叠加的，动画就会根据您输入的数据运行，并且在动画完成之前设置实际帧对显示没有影响。

# php - PHP session_start 失败

> ID：670595
> 
> 赞同：7
> 
> 时间：2009-03-22T05:49:53.177
> 
> 标签：php, session, xampp

我正在尝试在我的网站的标题页中开始会话。但似乎可能存在某种错误，因为它失败并出现以下错误：

```
Warning: session_start() [function.session-start]: open(\xampp\tmp\sess_a7430aab4dd08d5fc0d511f781f41fe5, O_RDWR) failed: No such file or directory (2) in D:\Development\PHP\tt\Include\header.php on line 3 
```

我正在使用 xampp 的默认设置，一切都是开箱即用的。由于某种原因，它无法打开文件。但是，当我转到其中包含会话文件的目录时，文件就在那里，它们只是空的。这是一个错误吗？还是我做错了什么？

php 版本 5.2.8

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-10-28T03:32:05.903

首先停止 Xampp 服务器。

session.save_path = "\xampp\tmp"

并把它改成这样

session.save_path = "C:\xampp\tmp"

重新启动 Xampp 服务器。

就是这样，您的会话应该按预期工作。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-22T06:35:29.900

这意味着您没有正确的权限来读取或写入临时目录中的文件。

如果您在 linux 上，请执行此操作

```
sudo chmod -R 755 \xampp\tmp //or should it be 775 
```

在 Windows 上以管理员身份执行此操作

```
attrib -r -a C:\xampp\tmp /S 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-05-07T08:16:46.513

正如 Selular88 提到的，添加路径有效并解决了这个问题。您还可以使用检查路径

```
// This will output your current path.
echo session_save_path() ; 
```

# c# - 在 .NET 程序集中如何使用公钥解密？

> ID：670615
> 
> 赞同：4
> 
> 时间：2009-03-22T06:35:48.153
> 
> 标签：c#, rsa

.NET 签名的程序集包含公钥，但是公钥在 RSA 中用于加密，那么 .NET 是如何使用公钥来解密签名程序集的呢？

好的，签名的程序集包含散列，但散列是使用私钥而不是公钥加密的。那么，为什么以及如何在 .NET 中使用私钥进行加密，使用公钥进行解密。我的意思是，像 RSACryptoPad 这样的所有软件都使用公钥进行加密而不是解密。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-22T07:17:31.437

公私密钥对不用于加密整个程序集。相反，它用于**签署**程序集。

稍微简化一下，要签署文件（例如程序集），您需要对该文件进行哈希处理，然后使用您的私钥对该哈希进行加密。使用该文件的人通过自己对文件进行哈希来验证您的签名，然后使用您的公钥解密您的加密哈希并确认这两个哈希相同。这证明了两件事：

1.  该程序集来自声称来自谁 - 即您 - 因为它是使用您的私钥生成的。
2.  该程序集未被其他人更改，因为您在发布程序集时所做的哈希与当前哈希相同。没有人可以更改签名的程序集，因为他们还必须对需要您的私钥的加密哈希进行相应的更改。

[在这篇 Wikipedia 文章](http://en.wikipedia.org/wiki/Digital_signature)中有更多关于数字签名的详细信息。

公钥-私钥对的好处在于它们可以左右工作。所以用你的私钥加密的东西只能用你的公钥解密，但用你的公钥加密的东西也可以用你的私钥解密。后一种用法意味着如果有人想向您发送某些东西，并且只有您可以使用您免费提供的公钥对其进行加密，但他们知道只有您使用您的私钥才能对其进行解密。

由于密钥只能成对工作 - 使[加密不对称](http://en.wikipedia.org/wiki/Asymmetric_encryption)- 其他人不能简单地反转他们使用公钥完成的加密以将消息发送给您。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T06:39:14.713

这个想法是只能使用*私钥**创建*签名，但之后任何拥有公钥副本的人都*可以*验证*签名*。**签名不需要解密**——签名只是简单地添加到纯文本程序集中。

 ****** * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T06:51:10.597

签署程序集的目的是验证其来源。如果我签署了我的程序集然后将其发送给您，您应该有理由确定它来自我并且在此过程中没有被篡改。

# video - 有什么方法可以知道用户是否打开 UAC 对话框

> ID：670617
> 
> 赞同：0
> 
> 时间：2009-03-22T06:38:33.387
> 
> 标签：video, windows-vista, uac

我有一个简单的视频播放器 SW，但在 Vista 32 或 64 上的 UAC 消息后渲染窗口变黑或冻结。有没有办法知道用户是否打开了 UAC 对话框？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T07:37:37.070

[如果](http://www.itwriting.com/blog/198-c-code-to-detect-uac-elevation-on-vista.html)您以编程方式表示，您可能会对此感兴趣

其他方法可以在以下位置读取注册表项

HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\系统值 EnableLUA

# javascript - 为什么这种函数调用在 JavaScript 中是错误的？

> ID：670623
> 
> 赞同：5
> 
> 时间：2009-03-22T06:50:22.330
> 
> 标签：javascript, function, invocation

我想创建一个匿名函数，然后立即调用它。

1）这会带来语法错误。为什么？

```
function ()
{
    alert("hello");
}(); 
```

2）用 () 包装函数定义，它可以工作。

```
(function ()
{
    alert("hello");
})(); 
```

3) 或者，将匿名函数分配给变量。有用。

```
var dummy = function()
{
    alert("hello");
}(); 
```

为什么第一种方法不起作用？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-22T07:26:42.133

[ECMAScript 语言规范](http://www.ecma-international.org/publications/standards/Ecma-262.htm)第12.4 节说：

> *ExpressionStatement*不能以关键字开头，因为`function`这可能会使它与 *FunctionDeclaration*模棱两可。

所以你的案例 1 是不允许的，因为它可能会导致语言歧义。其他情况是不同类型的语句（不是*ExpressionStatement* s），这不是问题，因此允许构造。

# java - 在我的应用程序中，为什么 readInt() 总是抛出 EOFException？

> ID：670627
> 
> 赞同：2
> 
> 时间：2009-03-22T06:54:13.287
> 
> 标签：java, multithreading, exception, networking, sockets

（请原谅我，因为我不经常用 Java 编写代码。）

我正在用 Java 编写客户端网络应用程序，但遇到了一个有趣的问题。每次调用 readInt() 都会抛出一个`EOFException`. 变量是类型的`DataInputStream`（初始化为：`DataInputStream din = new DataInputStream(new BufferedInputStream(sock.getInputStream()));`where `sock`is of type `Socket`）。

现在，`sock.isInputShutdown()`返回`false`和`socket.isConnected()`返回`true`。我假设这意味着我与我正在连接的另一台机器建立了有效的连接。我还执行了其他检查以确保我已正确连接到另一台机器。

是否有可能`DataInputStream`没有正确设置？有没有我错过的任何先决条件？

任何帮助是极大的赞赏。

* * *

@tofubeer：我实际上向套接字写入了 17 个字节。套接字已连接到另一台机器，我正在等待该机器的输入（如果不清楚，我很抱歉）。我首先成功地从流中读取（以启动握手），这工作得很好。我现在正在检查我发送的请求是否格式错误，但我认为不是。另外，我尝试从流中读取一个字节（通过`read()`），它返回-1。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T07:08:31.180

您是否正在向套接字写入 4 个字节？根据 JavaDoc，如果此流在读取所有字节之前到达末尾，它将引发 EOFException。

尝试连续调用 readByte() 4 次，而不是 readInt()，看看会发生什么（可能并非所有这些都有效）。

编辑（给定您的编辑）。

找出在获得 -1 之前可以调用 read() 多少次。

当 read() 返回 -1 时，意味着它已经到达文件末尾。

还要找出每个 read() 返回的内容，以确保您正在阅读的内容是您实际写出的内容。

这听起来像是一个问题，要么是在握手时读取的代码比你读的多，要么是另一边没有写你认为它正在写的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T13:38:37.623

需要检查的一些事项：

*   握手是否消耗了超过 13 个字节，而 readInt() 只剩下不到 4 个字节？
*   您要读取的整数是通过 DataOutputStream.writeInt() 写入的吗？
*   您是否从发送方刷新了流？

**编辑**：我查看了 Java 源代码（我的桌面上有 1.4 源代码，不确定您使用的是哪个版本），问题可能出在 BufferedInputStream 中。DataInputStream.readInt() 只是调用了 BufferedInputStream.read() 四次。BufferedInputStream.read() 如果缓冲区已用尽（例如，如果它的第一次读取只有 16 个字节），则调用 BufferedInputStream.fill()。BufferedInputStream.fill() 调用底层 InputStream 的 read(byte[], int, int) 方法，根据合同，它实际上可能不会读取任何内容！如果发生这种情况，BufferedInputStream.read() 将返回错误的 EOF。

这一切都假设我正确阅读了所有这些内容，但情况可能并非如此。我只是快速浏览了一下消息来源。

我怀疑您的 BufferedInputStream 在第一次读取时只获得了流的前 16 个字节。我很好奇你的 DataInputStream 的 available() 在 readInt 之前返回了什么。如果您还没有，我建议您在写入您无法读取的 int 后刷新您的 OutputStream 作为一种可能的解决方法。

# linux - 有没有像cpanel这样的开源软件？

> ID：670628
> 
> 赞同：8
> 
> 时间：2009-03-22T06:54:38.980
> 
> 标签：linux, cpanel

必须知道它存在与否。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-22T07:29:18.307

[网络托管控制面板的比较。](http://en.wikipedia.org/wiki/Comparison_of_web_hosting_control_panels)您可以根据图表上的“开源”列进行排序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T07:19:20.670

有[Ravencore](http://www.ravencore.com/)和[GPLHost](http://www.gplhost.com/software-dtc.html)，可能还有更多，这些只是非常简单的搜索字符串“开源托管控制面板”的前两个谷歌结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-23T18:06:13.277

Kloxo 是最好的开源控制面板

# idl - 什么是 IDL？

> ID：670630
> 
> 赞同：62
> 
> 时间：2009-03-22T06:55:48.853
> 
> 标签：idl

IDL 是什么意思？我google了一下，发现它代表接口定义语言，用于组件的接口定义。但是，在实践中，IDL 的目的是什么？微软使用它吗？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-03-22T07:58:05.617

接口定义语言 (IDL) 用于在远程过程调用 (RPC) 中建立客户端和服务器之间的通信。这有很多变体，例如 Sun RPC、ONC RPC、DCE RPC 等。

基本上，您使用 IDL 来指定客户端和服务器之间的接口，以便 RPC 机制可以创建跨网络调用函数所需的代码存根。

RPC 需要使用 IDL 信息为客户端和服务器创建存根函数。它与 C 中的函数原型非常相似，但最终结果略有不同，如下图所示：

```
+----------------+
| Client         |
|  +----------+  |         +---------------+
|  |   main   |  |         | Server        |
|  |----------|  |         |  +----------+ |
|  | stub_cli |----(comms)--->| stub_svr | |
|  +----------+  |         |  |----------| |
+----------------+         |  | function | |
                           |  +----------+ |
                           +---------------+ 
```

在这个例子中，不是`function`在同一个程序中调用，而是`main`调用一个客户端存根函数（具有与 相同的原型`function`），该函数负责打包信息并通过 comms 通道将其通过线路传递到另一个进程。

这可以是同一台机器或不同的机器，这并不重要 - RPC 的优点之一是能够随意移动服务器。

在服务器中，有一个“侦听器”进程将接收该信息并将其传递给服务器。服务器的存根接收信息，将其解包并将其传递给真正的函数。

真正的函数然后做它需要做的并返回到服务器存根，服务器存根可以打包返回信息（返回代码和任何`[out]`或`[in,out]`变量）并将其传递回客户端存根。

客户端存根然后将其解包并将其传递回`main`.

实际细节可能略有不同，但对于概念性概述来说，这种解释应该足够好了。

实际的 IDL 可能如下所示：

```
[   uuid(f9f6be21-fd32-5577-8f2d-0800132bd567),
    version(0),
    endpoint("ncadg_ip_udp:[1234]", "dds:[19]")
] interface function_iface {
    [idempotent] void function(
        [in] int handle,
        [out] int *status
    );
} 
```

顶部的所有信息（例如，`uuid`或`endpoint`）基本上是用于连接客户端和服务器的网络信息。它的“肉”在显示原型的界面部分内。这允许 IDL 编译器构建`function`客户端和服务器存根函数，用于编译和链接您的客户端和服务器代码以使 RPC 正常工作。

微软确实使用 IDL（我认为他们有一个 MIDL 编译器）来处理 COM 的东西。我还使用了带有 MS 操作系统的第三方产品，包括 DCE 和 ONC RPC。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-23T03:58:01.097

还有一种[交互式数据语言](http://en.wikipedia.org/wiki/IDL_(programming_language))，我有一份工作用于科学数据分析，但也许从上下文来看，你很清楚这不是 IDL 所代表的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-11-23T18:10:14.410

IDL 是[接口定义语言](http://en.wikipedia.org/wiki/Interface_description_language)的首字母缩写词，根据定义该语言的供应商或标准组，它有多种变体。IDL 的目标是描述某些服务的接口，以便希望使用该服务的客户端知道该服务提供了哪些方法和属性、接口。IDL 通常与二进制接口一起使用，IDL 语言文件描述了二进制接口中使用的数据类型。

二进制组件有几种不同的标准，通常是[COTS 或 Commercial Off The Shelf](http://en.wikipedia.org/wiki/Commercial_off-the-shelf)，并且客户端与二进制组件通信的方式可能会有所不同，尽管传统上使用的是[远程过程调用或 RPC](http://en.wikipedia.org/wiki/Remote_procedure_call)的某个版本。两个这样的标准是[Microsoft 公共对象模型或 COM 标准](http://en.wikipedia.org/wiki/Component_Object_Model)和[公共对象请求代理或 CORBA 标准](http://en.wikipedia.org/wiki/Common_Object_Request_Broker_Architecture)。还有其他组件标准，例如[Firefox 插件](https://blog.mozilla.org/addons/2014/06/05/how-to-develop-firefox-extension/)或其他应用程序的插件，例如 Visual Studio 本身，但是这些不一定使用某种形式的接口描述语言，而是使用某种具有标准化和众所周知的接口的软件开发工具包或 SDK一个 API。

IDL 所允许的是更大程度的灵活性，能够创建提供各种服务的组件，由于它们的二进制性质，这些服务可以与各种不同的编程语言和各种不同的环境一起使用。

Microsoft 使用带有 COM 对象的 IDL 方言，Microsoft IDL 与 CORBA IDL 不同，尽管它们有相似之处，因为它们共享共同的语言根。IDL 文件包含 COM 对象支持的接口的描述。COM 允许创建进程内服务（可能使用 RPC，或直接 DLL 调用）或进程外服务（使用 RPC）。COM 背后的想法是客户端只需要知道组件的标识符以及能够使用它的接口。客户端请求 COM 对象，然后从 COM 对象的工厂请求支持客户端想要使用的接口的类对象，然后通过该接口使用 COM 对象。

Microsoft 提供了 MIDL 编译器，它处理 IDL 文件以生成类型库，向 COM 对象的用户提供有关接口的信息，以及跨客户端和服务之间的接口封送数据的必要存根。

数据编组基本上意味着存根获取客户端提供的数据，将其打包并将其发送到执行某些操作并将数据发送回的服务。这种数据的发送和接收可能是通过一些 RPC 服务或通过直接的 DLL 函数调用。来自服务的响应被翻译成适合客户端的形式，然后提供给客户端。所以基本上，编组功能是客户端和服务之间的[适配器（参见适配器设计模式）](http://en.wikipedia.org/wiki/Adapter_pattern)或[桥接器（参见桥接设计模式） 。](http://en.wikipedia.org/wiki/Bridge_pattern)

Visual Studio，我的经验是使用 C++，包含许多可用于生成示例的向导，以便您可以使用它。如果您有兴趣可以创建一个工作空间，然后在工作空间中创建一个 ATL 项目来生成控件，然后创建一个简单的 MFC 对话框项目来测试它。为您的 COM 控件使用 ATL 隐藏了很多您可以稍后调查的细节，而简单的 MFC 对话框项目提供了一种创建容器的简单方法。您还可以使用 Visual Studio 中提供的 ActiveX 控件测试容器工具进行初步测试并查看方法和属性的工作方式。

在 codeproject.com 等网站上也有许多示例项目。例如，这是[一个使用 C 来暴露 COM 背后的所有丑陋管道](http://www.codeproject.com/Articles/13601/COM-in-plain-C)的一个，这是[一个使用 C++ 而没有 ATL](http://www.codeproject.com/Articles/338268/COM-in-C)的一个。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T07:56:23.047

它是一种在 COM 时代用于以（据称）与语言无关的方式定义接口的语言。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-23T03:58:52.343

它定义了用于与另一个应用程序中的公开服务通信的接口。

如果您使用 SOAP，您将了解 WSDL。WSDL 是 IDL 的另一种形式。IDL 通常指 Microsoft COM 或 CORBA IDL。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-04T17:23:13.433

IDL 在 2 例中至关重要。1\. 为 exe 服务器创建代理/存根 dll。2\. 为自动化服务器创建类型库。

[链接](http://www.codeproject.com/Articles/19605/Basics-of-an-IDL-file)上有 IDL 基础知识的非常好的文章

要学习 IDL，最好阅读编译器自己的 idl 头文件，这些头文件给出了 VC++ 包的 include 子目录。

# asp.net - 什么时候读取 web.config？

> ID：670633
> 
> 赞同：4
> 
> 时间：2009-03-22T07:01:09.340
> 
> 标签：asp.net, web-config, configuration-files

我正在研究一篇关于 ASP.NET 管道的文章，但到目前为止，我所涵盖的资源都没有充分解释何时读取机器级别、应用程序级别，甚至可能是子应用程序级别的`web.config`文件。

此外，我的大部分阅读内容都误导我在 .in 中寻找默认的 HTTP 处理程序等`machine.config`，在某些时候，它似乎被`web.config`机器级别的 a 神秘地取代，即在与 .in 相同的`config`框架文件夹中`machine.config`。这么多文章等是否过时了，或者这是最近的变化？或者，我可以富有想象力并认为机器级别`web.config`实际上是从 '继承' 的`machine.config`吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T09:23:51.290

我所知道的关于 asp.net 配置文件如何工作的最全面的描述是 MSDN 上的这个：

[ASP.NET 配置文件层次结构和继承](http://msdn.microsoft.com/en-us/library/ms178685.aspx)

它是为 .NET 3.5 框架编写的，因此信息应该与您可能找到的一样最新。它非常详细地描述了如何读取各种配置文件并将其合并到应用程序的运行时设置中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T07:09:23.923

ASP.NET 配置文件以[分层](http://msdn.microsoft.com/en-us/library/aa720128(VS.71).aspx)方式工作（与 CSS 元素的方式非常相似）。

[配置继承](http://msdn.microsoft.com/en-us/library/dtbwsx8s(VS.71).aspx)

# silverlight - 输入一天中的时间或持续时间的最直观、最有用的方法是什么？

> ID：670634
> 
> 赞同：5
> 
> 时间：2009-03-22T07:02:23.003
> 
> 标签：silverlight, user-interface, usability, timespan, hci

我正在 Silverlight 中构建一个业务线应用程序，需要让用户编辑两个 .NET TimeSpan 值。一个是一天中的某个时间（相对于午夜），另一个是持续时间。目前我正在使用两个文本框，格式为 hh:mm。这很简单，但肯定可以改进。我观察到人们使用该应用程序，虽然有些人快速进入时代没有问题，但其他人却很挣扎。

鉴于我在 Silverlight2 中工作，您认为完美的自定义控件可以让您轻松可视化和编辑这两个 TimeSpan 吗？

更难的是，UI 应该允许选择一天中的任何时间，精确到分钟，但要强调正常工作日内的时间（例如：上午 8:00 - 下午 5:00）。一些用户在他们真正的意思是下午 2:00 时倾向于输入 2:00 (am)。

在我的应用程序中，我倾向于将时间和持续时间调整为 5 分钟间隔。作为背景知识，这个应用程序类似于一个房间预订应用程序，人们可以在其中指定他们想要房间的时间和时间。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-22T09:08:12.857

在我的一个 Web 应用程序中，我使用了一个带有 2 个手柄的滑块。

例子：

```
|.........Y-----------------Y...|
         5AM               8PM 
```

当然，我不需要像你那样高精度，但我相信稍微长一点的滑块 5 分钟间隔是可能的。

为了强调正常工作日，您可以为正常工作日使用不同颜色的滑块背景着色。或者让处理程序“快速”开始和结束正常工作日。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T07:13:44.350

这可能取决于您需要数据的准确性以及数据的变化程度。如果它不需要完全准确并且变化不大，你可以做类似的事情

```
Task was performed at [select start time...] o'clock for [select duration...] 
```

其中 [select start time...] 是每小时的下拉菜单，而 [select duration...] 是一个下拉菜单，其中包含您正在跟踪的常见场景，例如“30 分钟”、“1 小时”、“2 小时”

如果它需要灵活，也许只是使用句子结构并用文本框替换下拉菜单会让所有初次使用的用户都清楚。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T14:02:49.123

获取最新的[Sliverlight 工具包](http://silverlight.codeplex.com/)并使用新的面向时间的控件之一

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T14:50:13.863

也许看看 Outlook，它使用默认为半小时的下拉菜单（无论如何对我来说；），如果需要更高的精度，然后可以手动编辑选择。当开始时间更改时，持续时间也会随之变化，默认为一小时或其他时间。

我之前和你一样在一个旧的 Web 应用程序中使用文本框，并添加了双击它们的选项，以显示一个快速选择小部件，如上面的 Outlook 示例。也许一个按钮或其他一些 Silverlight 魔法可以增强它。

垂直时间线（如 Outlook 中的日历日），您可以在其中拖动会议“框”的顶部和底部，对我来说，这是放置和调整预订的最直观或至少最快的方式。也许如果它预先填充了一个跨越一个小时左右的内容，可以轻松拖动以更改开始时间 - 顶部和底部可调整大小以更改持续时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-23T22:44:15.307

扩展 Anthony 所说的内容，Silverlight Toolkit 2009 年 3 月版包括 TimePicker 和 TimeUpDown 控件。您可以在以下位置查看带有 2 个弹出窗口的 TimeUpDown 和 TimePicker 的现场演示： [http ://silverlight.codeplex.com/Wiki/View.aspx?title=Silverlight%20Toolkit%20Overview%20Part%201#TimeUpDown](http://silverlight.codeplex.com/Wiki/View.aspx?title=Silverlight%20Toolkit%20Overview%20Part%201#TimeUpDown)

我实际上拥有这个控件的功能集和 API，所以我现在非常熟悉输入时间的最佳形式是什么。对于时间输入，我们可以讨论一整套最佳实践。所有这些目前都可以在控件中轻松找到。

在某些概念上我们必须进行创新（例如“时间智能感知”功能），但大多数情况下我们使用的是真正经过时间考验的概念。（没有双关语）

但是，作为 v1 的这些控件的非目标的一部分，我们决定不支持时间范围。如果您认为时间范围是我们应该原生支持的，请随时在 codeplex 上提出建议：http://silverlight.codeplex.com/WorkItem/Create.aspx [我们](http://silverlight.codeplex.com/WorkItem/Create.aspx) 会根据投票数量和调用的用户场景积极优先考虑项目在问题。

现在，我建议您只使用 2 个 TimePicker。高级可视化（如多选标尺或多滑块）是进行时间范围输入的一种方式，但您必须有一个可靠的全球化文本输入系统作为后备选项。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-01T14:39:57.843

这是询问您的用户正在尝试完成什么任务的好时机。您可以在此基础上制作系统的性能。例如，在 Outlook 中，人们通常会输入时间，因为他们正在尝试安排会议——因此您可以轻松地将“2”或“2:00”区分为下午 2 点，因为很少有用户尝试在 2 点安排会议是。这听起来与您的应用程序相似。

如果您查看您的用户，他们可能还会安排典型时间——这些应该很容易在您的界面中指定。例如，如果大多数会议时长为 50 分钟，那应该非常突出，可能是一个按钮或其他一键式选项。

我不建议发明一个新的输入小部件。您的输入工具越标准，您的用户在使用您的产品时就越不需要思考。专注于你的逻辑中的聪明才智，弄清楚（并向用户展示）你认为他们想要什么。

# multithreading - Delphi - 线程框架

> ID：670641
> 
> 赞同：12
> 
> 时间：2009-03-22T07:07:55.347
> 
> 标签：multithreading, delphi, frameworks, omnithreadlibrary

我正在寻找在我的 Delphi 应用程序中使用的线程框架。

目前我正在评估 '<a href="http://otl.17slon.com/index.htm" rel="nofollow noreferrer">OmniThreadLibrary' - 到目前为止它看起来不错并且可以满足我的一切需求。

Delphi 还有其他“线程框架”吗？

（我正在使用 D2006 和 D2009）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-23T12:08:40.763

根据素食主义者的建议

基于我评估**OmniThreadLibrary的几个小时**

这里有一些我喜欢它的地方

1）使用简单

2）它隐藏了关于多线程的大部分细节

3) 几行代码就可以设置多个线程

4）很容易做进程间消息

5) 仍在积极开发中

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-22T07:12:24.197

不是这样的框架，但有[AsyncCalls](http://andy.jgknet.de/blog/?page_id=100)。它的范围与 OmniThreadLibrary 不同，但它也支持旧版本的 Delphi。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-22T07:14:10.853

Internet Direct (Indy) 在 IdThreadSafe.pas 中包含 IdThread 和线程安全数据类型：

```
* TIdThreadSafeInteger
* TIdThreadSafeBoolean
* TIdThreadSafeString
* TIdThreadSafeStringList 
```

......还有更多

Jedi 代码库 (JCL) 还包括同步类和函数（大约十个类）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-23T07:23:39.410

在过去的 10 年里，我一直在开发自己的广泛线程框架，该框架也与类似架构的通信框架集成。在这个阶段，它可以与 Delphi 2005-2007 一起使用，但很快将可用于 Delphi 2009-2010。该应用程序开发框架可用于构建大规模分布式系统，因为它旨在使任何线程能够在任何进程中运行，并使用简单的线程通信协议，无论线程在同一进程中还是在不同进程中，该协议都是相同的在不同的机器上。

作为一个附加功能，我现在在 C#/Visual Studio 中运行了这个框架，因此使用这个框架构建的分布式系统可以混合使用 Win32 和 .NET 应用程序，所有应用程序都使用相同的设计方法。该框架可以从[http://www.adug.org.au/downloads/CSIFramework.html下载](http://www.adug.org.au/downloads/CSIFramework.html)

我的框架使用的库并不像网站上出现的那样广泛（我刚刚改写了该页面，但可能需要一天左右的时间才能更新）。此外，所有必需的文件（除了数据库抽象层）都包含在框架中，因此无需安装第三方库即可使用框架。

除了 Delphi，使用的库有：

*   Indy（包含在 Delphi 中，虽然我使用的是最新的 pre-unicode 版本）
*   绝地JCL
*   涡轮动力缩写
*   一个 XML 整洁的库（可选）
*   数据库抽象库（可选）

我修改了一些外围 Delphi 单元 1) 修复 Delphi 2006 中开放 XML 实现中的内存泄漏（随后在以后的 Delphi 版本中修复），2) 将服务应用程序与我的日志记录框架集成，以及 3) 集成支架- 带有 Indy 10 的单独 SOAP 服务器（不是 Delphi 2006 中包含的 Indy 9）。

实际上，我的框架不仅仅是一个线程框架，尽管线程框架是其中的一部分。线程框架是通过将所有线程实现为线程队列来构建的。在线程队列之间传递的“消息”实际上是封装在通用类型对象中的数据，这允许我在线程之间传递以任何方式结构化的任何数据。我可以通过添加消息在线程之间异步传递消息，也可以通过添加消息并接收消息作为响应来同步传递消息。线程本身订阅其他线程来接收消息，因此在设计时线程之间没有耦合。

该框架已扩展为包括通信服务器和客户端，以及主 GUI 线程，具有与线程队列完全相同的消息传递接口，因此向远程进程发送消息或将其传递到 GUI 使用相同的语法正如线程之间使用的那样。该框架的设计方式是完全不需要了解多线程开发的任何知识来构建跨多个进程和多个线程部署的分布式系统。

这个框架还有很多东西，我在过去 10 年里投入了超过 2 年的时间来开发它。它已成功部署在多层警报监控系统中（在三个应用程序中使用 20 多个不同类别的线程），我目前正在使用此框架在 Visual Studio 2008 中构建分布式系统。

简而言之，如果您想要的只是一个简单的线程框架，那么这可能是矫枉过正。但是，如果您想开发一个可能跨越多个应用程序的复杂多线程系统，那么学习曲线可能是值得的。

PS另外几点：

*   线程启动和关闭全部由框架处理（无需编写任何代码）
*   组成应用程序的线程（数量和配置）都在 XML 配置文件中定义，而不是在代码本身中（无需编写任何代码将它们包含在应用程序中）
*   如果您使用数据库抽象组件，那么多线程数据库访问将自动可用（无需额外代码）
*   我目前正在添加线程池，这将允许任何线程队列具有指定数量的实例化线程（同样，无需编写任何代码来执行此操作）
*   您可以从网页下载一个简单的开发人员指南，该指南也包含在框架下载中，从开发人员的角度概述了框架
*   框架本身正在非常活跃的开发中，随着下一个版本的 Delphi，我希望有一个在 Win32 上运行的版本（在 Delphi 下）、一个 .NET 版本（C#/Visual Studio）和一个 Linux 版本（使用新的 Deplhi跨平台编译器）

# linq - 列表中的一系列对象

> ID：670645
> 
> 赞同：0
> 
> 时间：2009-03-22T07:11:18.053
> 
> 标签：linq

我有一个说 100 个对象的列表。现在我想从第 50 到第 60 获取对象。我该怎么做。我除了可以使用一个简单的 linq 查询或 lambda 表达式。但我对 LINQ 很陌生，找不到搜索方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T07:17:55.557

您可以使用[Skip](http://msdn.microsoft.com/en-us/library/bb358985.aspx)和[Take](http://msdn.microsoft.com/en-us/library/bb503062.aspx)：

```
var range = objectList.Skip(50).Take(10); 
```

# php - PHP中int的最大值是多少？

> ID：670662
> 
> 赞同：135
> 
> 时间：2009-03-22T07:33:34.020
> 
> 标签：php, integer

忽略允许您处理非常大的数字的特殊库，您可以在 PHP 中存储的最大 int 值是多少？

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2009-03-22T07:36:51.767

从[PHP 手册](http://php.net/manual/en/language.types.integer.php)：

> 整数的大小取决于平台，尽管通常值约为 20 亿的最大值（即 32 位有符号）。PHP 不支持无符号整数。自 PHP 4.4.0 和 PHP 5.0.5 起，可以使用常量 PHP_INT_SIZE 确定整数大小，使用常量 PHP_INT_MAX 确定最大值。
> 
> 64 位平台的最大值通常约为 9E18，但在 PHP 7 之前的 Windows 上，它始终为 32 位。

* * *

## 回答 #2

> 赞同：97
> 
> 时间：2010-05-16T04:01:56.893

**PHP 的 32 位版本：**

*   整数可以从**-2,147,483,648**到**2,147,483,647**（~ ± 20 亿）

**PHP 的 64 位版本：**

*   整数可以从**-9,223,372,036,854,775,808**到**9,223,372,036,854,775,807**（~ ± 9 quintillion）

数字包括在内。

*注意：一些 64 位版本曾经使用 32 位整数，尤其是 PHP 的旧 Windows 版本*

这些范围之外的值由浮点值表示，这些范围内的非整数值也是如此。解释器将根据计算的结果值是否不能表示为整数来自动确定何时需要切换到浮点。

PHP 本身不支持“无符号”整数，将所有整数的最大值限制在“有符号”整数的范围内。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-03-22T07:36:21.080

PHP int 的大小[取决于平台](http://www.php.net/manual/en/language.types.integer.php)：

> 整数的大小取决于平台，尽管通常值约为 20 亿的最大值（即 32 位有符号）。PHP 不支持无符号整数。自 PHP 4.4.0 和 PHP 5.0.5 起，可以使用常量 PHP_INT_SIZE 确定整数大小，使用常量 PHP_INT_MAX 确定最大值。

PHP 6 添加了“longs”（64 位整数）。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2010-12-28T17:11:19.913

（有点晚，但可能有用）

只信任[PHP_INT_MAX 和 PHP_INT_SIZE](http://www.php.net/manual/en/language.types.integer.php)，这个值因你的拱门（32/64 位）和你的操作系统而异......

任何其他“猜测”或“提示”都可能是错误的。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-22T07:36:16.807

啊，我找到了：2 ^(32) - 1 (2147483647)

[http://au2.php.net/int](http://au2.php.net/int)

> **整数溢出**
> 
> 如果 PHP 遇到超出整数类型范围的数字，它将被解释为浮点数。此外，导致数字超出整数类型范围的操作将改为返回浮点数。

```
<?php
$large_number =  2147483647;
var_dump($large_number);
// output: int(2147483647)

$large_number =  2147483648;
var_dump($large_number);
// output: float(2147483648) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-22T07:36:50.317

这取决于您的操作系统，但根据[手册](http://php.net/manual/language.types.integer.php)2147483647 是通常的值。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-06-29T13:14:42.443

它受制于运行 PHP 的服务器的体系结构。对于 64 位，

`print PHP_INT_MIN . ", ” . PHP_INT_MAX;`产量`-9223372036854775808, 9223372036854775807`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-03-15T17:22:53.693

尽管`PHP_INT_*`常量存在很长时间，但可以通过左移直到达到负数以编程方式找到相同的 MIN / MAX 值：

```
$x = 1;
while ($x > 0 && $x <<= 1);
echo "MIN: ", $x;
echo PHP_EOL;
echo "MAX: ", ~$x; 
```

# flash - flash 媒体播放器可以播放 wmv/asf 格式的媒体吗？

> ID：670663
> 
> 赞同：1
> 
> 时间：2009-03-22T07:34:28.107
> 
> 标签：flash, wmv, asf

我曾尝试在 HTML 页面中播放 wmv/asf 文件，但 Windows Media Player 始终嵌入在浏览器中，但 Flash Media Player 未嵌入。

这是我嵌入 Flash Media Player 的代码。我怀疑是因为 Flash Media player 不支持 wmv/asf 格式，所以即使我明确指定“application/x-shockwave-flash”值，Flash Media player 也不会显示。有任何想法吗？

Flash 媒体播放器是否支持 wmv/asf 文件？

```
<html>
<body>
<embed src="http://myserver/videos/123.asf" quality="high" width="480" height="400" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash"></embed>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T08:48:41.843

不是说Flash不支持wmv/asf；更重要的是 wmv/asf 不是 Flash 电影，所以当你使用 application/x-shockwave-flash 类型时，你不能通过将它放在 src 属性中来假装它是一个。尝试将媒体播放器 Flash 电影改为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T08:53:09.353

1.  这里有一个明显的混淆：***Flash Player***不是直接的媒体播放器。嵌入中指定的源应该是[SWF](http://en.wikipedia.org/wiki/SWF)。另一方面，Flash 中内置了媒体播放器（例如[JW FLV 媒体播放器](http://www.longtailvideo.com/players/jw-flv-player/)）。

2.  Flash 不接受 WMV，但使用[FLV](http://en.wikipedia.org/wiki/Flash_Video) /MPEG-4。

3.  使用的流媒体协议是[RTMP](http://en.wikipedia.org/wiki/Real_Time_Messaging_Protocol)，不知道如何处理 Flash 中的 ASF 流。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-03-04T07:06:10.137

**Mediaelement.js**播放器文档说，支持**wmv**和**mov**，但到目前为止我还没有看到这些格式的任何积极或成功的评论。像 wmv 和 mov 这样的格式是专有的，所以要播放视频用户需要明确安装基于浏览器的插件。最新版本的火狐不直接支持wmv，有一个变通方法。要支持**mov**格式，用户需要在系统中安装quicktime player。

[Firefox 的 WMV 插件](http://windows.microsoft.com/en-in/windows/download-windows-media-player)

[火狐文档：](https://support.mozilla.org/en-US/kb/play-windows-media-files-in-firefox)

# javascript - Javascript Datejs

> ID：670672
> 
> 赞同：2
> 
> 时间：2009-03-22T07:42:39.910
> 
> 标签：javascript, jquery, datetime

[当我偶然发现这个开源 JavaScript 日期库](http://code.google.com/p/datejs/)时，我正在浏览一些页面： Datejs 。现在我一直在尝试使用它，但每次我尝试任何功能时：

```
$(function() { Date.today().toLongDateString() } ); 
```

甚至只有

```
Date.today().toLongDateString() 
```

带有标签，当网页加载时出现错误，它告诉我 Date.today() 不是一个函数，但它出现在[文档](http://code.google.com/p/datejs/wiki/APIDocumentation)中我已经在这个文档中出现了将近 2 个小时 xD 它让我发疯了，我知道我可能只是忽略了一些东西......

我加载了：

```
<script type="text/javascript" src="assets/js/dia_hora/date_es-MX.js"></script> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T10:00:18.333

您的脚本路径和文件名是否正确？你写了：

```
<script type="text/javascript" src="assets/js/dia_hora/date_es-MX.js"></script> 
```

但根据[项目的“入门”页面](http://www.datejs.com/2007/11/27/getting-started-with-datejs/)，应该是：

```
<script type="text/javascript" src="assets/js/dia_hora/date-es-MX.js"></script> 
```

原始文件中有两个连字符：“date-es-MX.js”，不是下划线。还是你重命名了文件？

如果您使用的是 Internet Explorer，请使用[Firefox Firebug（网络选项卡）](http://getfirebug.com/net.html)或[FiddlerTool](http://www.fiddler2.com/fiddler2/)检查文件是否正确加载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T07:46:41.150

听起来脚本没有被加载。发出警报（'你好'）；在脚本的开头，看看你是否在页面加载时得到那个弹出窗口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T17:34:26.090

您的 javascript 文件路径不正确。

**或者**

在此文件之前加载的 Javascript 文件中存在语法错误。我相信一旦发生错误，浏览器就会停止尝试解释 Javascript 的其余部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-27T03:20:55.533

尝试在 Chrome 或 Firefox 或 Safari 中打开 JS 控制台 - 你会更好地了解错误是什么。JS 控制台为我节省了数小时甚至数天的时间——我记得当 JS 默默失败时，我曾经因为无法说出发生了什么而感到沮丧。但是对于 JS Console，它永远不会是无声的失败——无论多么小，您都会在错误消息中得到一些提示。

# ruby - 我可以跳回到在 Ruby 中使用“重做”的方法的开头吗？

> ID：670674
> 
> 赞同：4
> 
> 时间：2009-03-22T07:48:19.010
> 
> 标签：ruby, redo

在[Poignant Guide](http://poignantguide.net/ruby/chapter-5.html#section5)中给出了这个`redo`关键字的例子：

```
class LotteryTicket
  def self.new_random
    new(rand(25) + 1, rand(25) + 1, rand(25) + 1)
  rescue ArgumentError
    redo
  end
end 
```

它应该一直调用`new`，直到所有三个随机数都是唯一的。但是在我输入这段代码并运行了几次之后，我得到了这个错误：`LocalJumpError: unexpected redo`. 我在`redo`别处查找了关键字，看起来它只适用于循环和迭代器。那么为什么在他的例子中尝试这样使用它呢？应该如何重写此方法才能正常工作？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-22T07:53:44.377

他一定是有意[使用`retry`](http://www.tutorialspoint.com/ruby/ruby_loops.htm)，不是`redo`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-06-13T22:48:27.520

`redo`重新启动一个块：

```
l = lambda {puts "hi"; redo}
l.call 
```

# iphone - 如何更改核心动画实例的帧速率？

> ID：670683
> 
> 赞同：2
> 
> 时间：2009-03-22T07:58:56.377
> 
> 标签：iphone, objective-c, core-animation

以 CABasicAnimation 为例。如何降低帧速率（开销）？动画运行流畅，但我的 touchesMoved 方法跳过了一个节拍。想要降低动画帧率，所以 touchesMoved 不会跳过动作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T05:35:21.923

启动 CABasicAnimation 后，您对帧速率没有任何固有的控制权。

实现这一点的最佳方法可能是为单个动画创建多个插值（即，如果您向下移动 50 像素和跨过 50 像素，则每个执行 2 x 25 像素）并在您的线程中诱导人工睡眠。这不是一个完美的解决方案，但可能会取得您所看到的稍微好一点的结果。

请注意，这种技术在不同的 CPU 上会有不同的帧速率，因此通常不推荐使用。本质上，YMMV。

# asp.net-mvc - ASP.Net MVC 视图 (*.aspx) 可以在多个 ASP.net MVC 项目中重用吗？

> ID：670685
> 
> 赞同：9
> 
> 时间：2009-03-22T08:09:10.037
> 
> 标签：asp.net-mvc

我想在多个 ASP.Net MVC 项目中重用 *.aspx 文件。这可能吗？

编辑：安东尼关于使用版本控制系统在多个项目中共享公共文件的建议以一种实用的方式解决了我的问题。幸运的是，由于我使用的是 Subversion，所以该解决方案适合我。但是，如果我不使用一个，如何才能解决这个问题？

有可能做这样的事情吗？

1.  使用 VS 的网站预编译功能构建可再分发的用户控件。（如此[处](http://blogs.msdn.com/davidebb/archive/2005/10/30/487160.aspx)所述。）
2.  引用所需项目中的输出程序集。
3.  创建一个修改后的视图引擎，通过泛型类型参数实例化用户控件。

然后我们像这样构造控制器动作：

```
public ActionResult Shared()
{
    return View<SharedPageOrUserControl>();
} 
```

这看起来可能吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-22T08:27:33.970

您可以尝试的一个想法是：

1.  为您的共享视图创建一个项目（类库）
2.  在“属性”窗格中将任何 *.aspx 标记页面添加并设置到[嵌入式资源](http://dotnet.org.za/craign/archive/2007/05/05/how-to-access-resources-embedded-in-an-assembly.aspx)
3.  添加一个继承自 ActionResult 的类“EmbeddedViewResult” - 这将包含确保在控制器操作结束时调用嵌入的 .aspx 文件并在磁盘上可用的逻辑。

因此，在您想要使用共享视图的项目中，控制器操作可能会返回类似

```
public ActionResult Shared()
{
    return new EmbeddedViewResult("SharedLib.SharedPage");
} 
```

我已经对 WebForms 页面做了类似的事情，所以应该是可能的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T08:37:27.877

我通常通过源代码控制来解决这类问题。大多数系统（甚至 VSS）都允许您跨多个项目共享文件。

# ruby - 鞋子会在 Windows 上支持 GTK 吗？我们可以在鞋子中使用所有 ruby -gnome2 API 吗？

> ID：670692
> 
> 赞同：1
> 
> 时间：2009-03-22T08:22:10.627
> 
> 标签：ruby, shoes

我知道现在两者都不是真的，但我真的希望这些都是真的。我听说 ruby​​-gnome2 和 shoes 是 ruby​​ 最常用的桌面库。由于 shoes 和 gtk 依赖于一些共同的东西，而 shoes 对 UI 的抽象程度更高，为什么不进一步合并它们呢？让鞋子完全在 GTK 之上。

我尊重鞋子创作者的不同意图，所以，只是一个让我清楚的问题。

非常感谢您的出色工作！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-19T01:38:48.457

我显然不能代表_Why（鞋子的作者），但他的既定目标与 GTK 非常脱节。鞋子写得非常小，它的很多格式和功能都来自网络。GTK 是巨大的（并且非常有用，但根本不是鞋子）。

_为什么主要在 Cairo 上写鞋，这也是 GTK 用于小部件绘制的最新版本，所以看起来他故意退回到 UI 设计的核心，并出于完全不同的原因从头开始创建一个不同的框架比一个人会使用GTK。他之前发过为什么鞋子不是Tk/wX/etc.，但是我现在找不到链接了。

# perl - 如何在字符串中重复一个字符 n 次？

> ID：670693
> 
> 赞同：22
> 
> 时间：2009-03-22T08:23:30.470
> 
> 标签：perl

我正在学习 Perl，所以请耐心等待这个菜鸟问题。

如何在字符串中重复一个字符 n 次？

我想做如下的事情：

```
$numOfChar = 10;

s/^\s*(.*)/' ' x $numOfChar$1/; 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-22T08:51:35.753

默认情况下，替换将字符串作为要替换的部分。要在替换过程中执行代码，您必须使用该`e`标志。

```
$numOfChar = 10;

s/^(.*)/' ' x $numOfChar . $1/e; 
```

这将`$numOfChar`在文本的开头添加空间。要对文本中的每一行执行此操作，请使用`-p`标志（用于快速的单行处理）：

```
cat foo.txt | perl -p -e "$n = 10; s/^(.*)/' ' x $n . $1/e/" > bar.txt 
```

或者如果它是较大脚本的一部分，请使用`-g`and`-m`标志（`-g`用于全局，即重复替换并在每行的开头`-m`进行匹配）：`^`

```
$n = 10;
$text =~ s/^(.*)/' ' x $n . $1/mge; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-22T08:47:32.377

你的正则表达式可以写成：

```
$numOfChar = 10;

s/^(.*)/(' ' x $numOfChar).$1/e; 
```

但是 - 你可以这样做：

```
s/^/' ' x $numOfChar/e; 
```

或者根本不使用正则表达式：

```
$_ = ( ' ' x $numOfChar ) . $_; 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-22T08:25:42.977

你是对的。Perl 的`x`操作符重复一个字符串多次。

```
print "test\n" x 10; # prints 10 lines of "test" 
```

编辑：要在正则表达式中执行此操作，最好（也就是对维护人员最友好）将值分配给另一个变量。

```
my $spaces = " " x 10;
s/^\s*(.*)/$spaces$1/; 
```

有很多方法可以在没有额外变量的情况下做到这一点，但如果你这样做的话，它只是我的 0.02 美元，它会更容易维护。

编辑：我修复了我的正则表达式。对不起，我第一次没有读对。

# c# - 如何对数据集进行排序？

> ID：670701
> 
> 赞同：11
> 
> 时间：2009-03-22T08:32:31.150
> 
> 标签：c#

我有包含表项的数据集，如何按代码字段对该表进行排序？

提前致谢

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-22T08:39:18.903

使用`DataTable`，您通常对`DataView`- 进行排序，例如：

```
 DataTable table = dataSet.Tables["foo"];
        DataView view = table.DefaultView;
        view.Sort = "Code"; 
```

然后使用`view`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-05-08T06:57:46.410

```
DataSet fileTransferDetail = null; //Data to be sorted.
DataSet result = null; //Declare a dataSet to be filled.

// Sort data
fileTransferDetail.Tables[0].DefaultView.Sort = "ID DESC";
// Store in new Dataset
result.Tables.Add(fileTransferDetail.Tables[0].DefaultView.ToTable()); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T08:38:09.730

使用 DataView 对象并对其调用 Sort 方法。或者，如果您的数据集来自 SQL，请在将其加载到数据集之前使用 ORDER BY 子句对其进行排序。

# php - 有没有标准的地方把版本号放在源代码中？

> ID：670710
> 
> 赞同：3
> 
> 时间：2009-03-22T08:42:13.917
> 
> 标签：php, zend-framework, version

我想要一个文件，我可以在其中检查安装了哪个版本。它是一个 PHP 程序，因此您可以查看文件。我在想是否有一个标准化的地方可以放置它，因为在 Zend Framework 或 HTMLpurifier 中我根本找不到版本号。

如果没有标准位置，我还想将它添加到 Zend Framework 和 HTMLPurifier 中，这样我总是知道安装了哪个版本。必须更新 txt 文件将是另一种选择..

编辑：我们正在考虑在不久的将来使用 PHPundercontrol，但为什么要更新 Zend Frameworks 编号？它怎么知道我上传了它的新版本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T08:48:54.557

我会使用文本文件选项而不是代码。

如果您这样做，随着项目的进展，您可以更新您可能会或可能不会开始在项目中使用的其他工具（例如：phpunderconstrol 或部署系统），以便能够设置/更新此数字而不必冒险文件触及真实代码并可能导致错误。

当然，这一切都取决于您如何看待项目的进展，以及您是否认为自己会使用任何其他工具！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T09:02:13.417

我找到了..

在 Zend 框架中，他们有一个名为 Zend/Version.php -> Zend_Version 的文件，这个文件里面也有版本号：

```
const VERSION = '1.7.5'; 
```

在 HTMLPurifier 中，它位于 HTMLPurifier/HTMLPurifier.php

```
/** Version of HTML Purifier */
public $version = '3.3.0';

/** Constant with version of HTML Purifier */
const VERSION = '3.3.0'; 
```

我想我会将该版本添加到配置文件中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T11:04:45.183

如果您正在查看源文件，则有[PHPDoc 标准](http://en.wikipedia.org/wiki/PHPDoc)：

```
/**
 * ...
 * @version  1.2.3
 */ 
```

问题`const VERSION`在于 5.3 之前的 PHP 没有命名空间。因此，当您包含各种库时，它对您没有多大帮助。更难告诉您使用自动加载，并且无法确定它们包含的顺序。

例如：

索引.php

```
include_once "libA.php"
if(needsB)
  include_once "libB.php"
...
print(VERSION) 
```

libB.php

```
const VERSION='1.2.3'
...
if(needsC)
  include_once "libC.php" 
```

现在您不能确定`VERSION`您打印的是哪一个，是来自 libA、libB 还是 libC。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T08:53:45.233

我所做的是创建一个配置文件，无论我身在何处，它都与程序保持一致。我有 MySQL 配置信息和密码 HASH 以及项目的版本信息等设置。

PHP的源代码也是这样做的，他们像这样保存版本信息。

```
// this is a guess of the var names by me btw
MAJOR_VERSION = 5
MINOR_VERSION = 2
FIX_VERSION = 6 
```

通过将版本信息保留为整数，您可以计算版本号之间的差异。

# django - django：form.fields 不遍历实例字段

> ID：670711
> 
> 赞同：4
> 
> 时间：2009-03-22T08:42:21.297
> 
> 标签：django, forms, templates, django-templates

我正在尝试遍历模板中的 form.fields 并用于：

```
{% for field in form.fields %}
   {{ field }}, 
{% endfor %} 
```

我得到一个字段名称列表（“名称，描述......”），而不是使用以下内容时呈现的 html 代码：

```
{{ form.name }}, {{ form.description }} 
```

（这种情况下的输出是：

**<input id="id_name" type="text" name="name" maxlength="200" /><input id="id_description" ....**

有什么提示吗？谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-22T17:07:52.847

你想迭代“form”，而不是“form.fields”。后者返回 Field 实例，前者返回 BoundField 实例（即使在未绑定表单的情况下），它们呈现它们的小部件 HTML。

form.visible_fields 和 form.hidden_​​fields 是仅获取表单的可见/隐藏字段的实用方法，但它们也返回 BoundField 实例。它们与 form.fields 没有任何平行关系（我同意这不是最清晰的 API）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T09:43:06.487

迭代“form”而不是“form.fields”解决了这个问题。不知道为什么，因为文档还提供了示例，例如：

```
{% for field in form.visible_fields %}
... 
```

这也会导致空集。与我的表格未绑定这一事实有关吗？没有把握...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T09:29:56.190

你得到的字段是 django.forms.Field 实例。要从中获取 html 视图，您可以使用小部件功能。{{ field.widget }}

# .net - mscordacwks.dll 和 mscorwks.dll 混淆

> ID：670725
> 
> 赞同：11
> 
> 时间：2009-03-22T08:55:29.753
> 
> 标签：.net, debugging, mscorwks.dll

mscordacwks.dll 和 mscorwks.dll 在 .Net 框架运行时、构建和调试过程中执行的不同功能是什么？这个话题有推荐的读物吗？我已经搜索了很长一段时间但失败了。

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-22T09:04:40.510

mscorwks 是主要的 MS CLR 实现。

mscordacwks 提供了对 CLR 详细信息的数据访问抽象，因此调试器（例如 SOS）不需要太多了解 mscorwks 的内部结构。[这里](http://blogs.msdn.com/dougste/archive/2009/02/18/failed-to-load-data-access-dll-0x80004005-or-what-is-mscordacwks-dll.aspx)给出了一个讨论。

但一般来说，您根本不需要使用这些 - 所以除非您正在编写自己的 IDE/调试器，否则您可以不理会它们。

# c# - 当存在重叠匹配时，首选正则表达式中的一个匹配？

> ID：670726
> 
> 赞同：3
> 
> 时间：2009-03-22T08:56:25.413
> 
> 标签：c#, .net, regex

*我有一个匹配x* OR *y*条件的正则表达式。有时这些匹配重叠，我想优先考虑其中一个条件。

这是我的测试用例。

正则表达式：

```
X[^\w]*\>|\>[^\w]*X 
```

输入：

> 汤 > X > 字母
> 汤 > X
> X > 字母汤

火柴：

> [突出显示的匹配结果 http://i.friendfeed.com/b55db94551503bf13d16f944fc56d9ff56676b4f](http://i.friendfeed.com/b55db94551503bf13d16f944fc56d9ff56676b4f)

第一个突出显示的匹配（黄色）应该是**X >**而不是**> X**但我不确定如何优先考虑给定重叠的匹配之一。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-22T09:16:46.957

这应该这样做：

```
X[^\w]*>|>[^\w]*X(?![^\w]*>) 
```

低优先级替代方案后的负面展望。当它找到`"> X"`，但后面有一个`" >"`时，应该跳过它以支持`"X >"`。

# model-view-controller - 用吱吱声写一个 GUI

> ID：670727
> 
> 赞同：12
> 
> 时间：2009-03-22T08:57:53.350
> 
> 标签：model-view-controller, user-interface, smalltalk, squeak, visualworks

如何在 Squeak 中编写 GIU？我是 Smalltalk 新手，目前正在使用 Cincom 的 VisualWorks，但我想试试 Squeak。我看到 Squeak 具有用于图形的 Morphic，但对于我的生活，我似乎无法找到一个包来编写基于 MVC 的 GUI。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-22T09:22:12.060

Squeak 包含所有经典的 MVC 类，但您也可以使用 Morphic 创建 GUI，确实比使用 MVC（轻松）更有趣 - 这就是创建 Squeak 的原因！

请注意，您可能会在更具体的地方得到更好的回复——在 SO 上似乎没有多少 Smalltalk 人。尝试[http://news.gmane.org/gmane.comp.lang.smalltalk.squeak.beginners](http://news.gmane.org/gmane.comp.lang.smalltalk.squeak.beginners)开始。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-23T22:28:43.457

GUI 和 Squeak 首先是非常令人困惑的。使用 Squeak 创建 GUI 相当容易。基本上，您只需绘制几个矩形，复制一些文本框，几乎每个变形的光环都允许克隆，然后您可以将这些变形放到您的新 UI 中。将您的行为添加到您刚刚创建的 UI 更加困难，因为您必须以某种方式在代码浏览器中找到您的小部件。

这是我想指出的部分，我发现 Squeak 中的 Morphic 实现非常烦人。所以，也许我把这一切都弄错了，但这就是我的看法。Morphic 旨在让您只需单击几下即可以图形方式构建自己的 UI。它是在自编程环境中设计的，没有浏览器对象的差距。将你的克隆注册到普通的代码树中对 Self 来说是一件小事。（导出您的程序当然不是一件容易的事，但话又说回来，在 Smalltalk 中这无论如何都不容易）。

因此，我遇到的现实世界中的变形代码通常将变形视为任何其他 UI 框架对象：从代码创建 UI，而忽略图形构建。我还没有看到像Interface Builder在Mac OS X上那样将变形UI“冲击冻结”到文件中的便捷方法。或者，更一般地说，如果您一起单击变形UI，则很难从代码中访问它浏览器。

Neil 暗示将整个 Morphic 放在一边并转向 MVC 可能是可以理解的。然而，有几次我不得不在 Squeak 中处理用户界面，我检查了图像周围的 UI 生成代码，并试图模仿他们的风格。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-12-02T15:59:28.507

试试 Morphic Designer：

[https://www.hpi.uni-potsdam.de/hirschfeld/trac/SqueakCommunityProjects/wiki/designer](https://www.hpi.uni-potsdam.de/hirschfeld/trac/SqueakCommunityProjects/wiki/designer)

再见，马塞尔·泰梅尔

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T01:27:56.813

取决于你想做什么，你的听众是谁。最初的 MVC 速度很快，但不再真正维护，看起来非常 1980 年。[Self](http://selflanguage.org/)中最初的Morphic可能很好，但在Squeak中它已经演变成一团意大利面条。`Morph`看看's 继承层次结构顶部的几个类......

[Pharo](http://pharo-project.org)有一些努力为 Morphic 小部件带来更好的外观，因此它不会在他们打开图像的第二秒吓跑新手。还有一些很有前途的 GTK 和 Objective-C 绑定正在工作中，我希望看到它们得到更多使用。最后，我们看到越来越多的 Web 应用程序...... Seaside 可以成为原生 UI 的一个不错的替代品，因为它擅长处理复杂流程的 Web 应用程序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-16T17:28:39.987

我们有一个用 Squeak 编写的现成的 Windows 应用程序。其中大部分是通过 Morphic 完成的。Morphic 为主要的用户体验提供了很多价值。当您使用对话框、文件选择等时，软件配置虽然很“奇怪”。

我最近很高兴发现[WxSqueak](http://www.wxsqueak.org/)，它提供了 Windows 的原生体验。我将它与 Morphic 结合使用。

# c++ - 指向类数据成员“::*”的指针

> ID：670734
> 
> 赞同：287
> 
> 时间：2009-03-22T09:03:48.717
> 
> 标签：c++, class, pointers, c++-faq

我遇到了这个编译得很好的奇怪代码片段：

```
class Car
{
    public:
    int speed;
};

int main()
{
    int Car::*pSpeed = &Car::speed;
    return 0;
} 
```

**为什么**C++ 有这个指向类的非静态数据成员的指针？这个奇怪的指针在实际代码中有什么用**？**

* * *

## 回答 #1

> 赞同：223
> 
> 时间：2009-03-22T09:13:24.017

它是一个“指向成员的指针”——下面的代码说明了它的用法：

```
#include <iostream>
using namespace std;

class Car
{
    public:
    int speed;
};

int main()
{
    int Car::*pSpeed = &Car::speed;

    Car c1;
    c1.speed = 1;       // direct access
    cout << "speed is " << c1.speed << endl;
    c1.*pSpeed = 2;     // access via pointer to member
    cout << "speed is " << c1.speed << endl;
    return 0;
} 
```

至于您*为什么*要这样做，它为您提供了另一个层次的间接性，可以解决一些棘手的问题。但老实说，我从来没有在自己的代码中使用过它们。

**编辑：**我想不出一个令人信服的使用指向成员数据的指针。指向成员函数的指针可用于可插拔架构中，但再次在狭小的空间中生成示例让我失望。以下是我最好的（未经测试的）尝试 - 在将用户选择的成员函数应用于对象之前会执行一些前后处理的 Apply 函数：

```
void Apply( SomeClass * c, void (SomeClass::*func)() ) {
    // do hefty pre-call processing
    (c->*func)();  // call user specified function
    // do hefty post-call processing
} 
```

括号`c->*func`是必要的，因为`->*`运算符的优先级低于函数调用运算符。

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2011-04-29T16:05:59.073

这是我能想到的最简单的示例，它传达了与此功能相关的罕见情况：

```
#include <iostream>

class bowl {
public:
    int apples;
    int oranges;
};

int count_fruit(bowl * begin, bowl * end, int bowl::*fruit)
{
    int count = 0;
    for (bowl * iterator = begin; iterator != end; ++ iterator)
        count += iterator->*fruit;
    return count;
}

int main()
{
    bowl bowls[2] = {
        { 1, 2 },
        { 3, 5 }
    };
    std::cout << "I have " << count_fruit(bowls, bowls + 2, & bowl::apples) << " apples\n";
    std::cout << "I have " << count_fruit(bowls, bowls + 2, & bowl::oranges) << " oranges\n";
    return 0;
} 
```

这里要注意的是传入count_fruit的指针。这使您不必编写单独的 count_apples 和 count_oranges 函数。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-03-23T00:19:15.787

另一个应用是侵入式列表。元素类型可以告诉列表它的下一个/上一个指针是什么。所以列表不使用硬编码的名称，但仍然可以使用现有的指针：

```
// say this is some existing structure. And we want to use
// a list. We can tell it that the next pointer
// is apple::next.
struct apple {
    int data;
    apple * next;
};

// simple example of a minimal intrusive list. Could specify the
// member pointer as template argument too, if we wanted:
// template<typename E, E *E::*next_ptr>
template<typename E>
struct List {
    List(E *E::*next_ptr):head(0), next_ptr(next_ptr) { }

    void add(E &e) {
        // access its next pointer by the member pointer
        e.*next_ptr = head;
        head = &e;
    }

    E * head;
    E *E::*next_ptr;
};

int main() {
    List<apple> lst(&apple::next);

    apple a;
    lst.add(a);
} 
```

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2010-11-02T13:17:26.407

这是我现在正在处理的一个真实示例，来自信号处理/控制系统：

假设您有一些表示您正在收集的数据的结构：

```
struct Sample {
    time_t time;
    double value1;
    double value2;
    double value3;
}; 
```

现在假设您将它们填充到向量中：

```
std::vector<Sample> samples;
... fill the vector ... 
```

现在假设您想计算一个变量在一系列样本上的某个函数（例如平均值），并且您想将该平均值计算分解为一个函数。指向成员的指针使它变得容易：

```
double Mean(std::vector<Sample>::const_iterator begin, 
    std::vector<Sample>::const_iterator end,
    double Sample::* var)
{
    float mean = 0;
    int samples = 0;
    for(; begin != end; begin++) {
        const Sample& s = *begin;
        mean += s.*var;
        samples++;
    }
    mean /= samples;
    return mean;
}

...
double mean = Mean(samples.begin(), samples.end(), &Sample::value2); 
```

**注意 2016/08/05 编辑，以获得更简洁的模板函数方法**

而且，当然，您可以对其进行模板化，以计算任何前向迭代器和任何支持与自身相加和除以 size_t 的值类型的平均值：

```
template<typename Titer, typename S>
S mean(Titer begin, const Titer& end, S std::iterator_traits<Titer>::value_type::* var) {
    using T = typename std::iterator_traits<Titer>::value_type;
    S sum = 0;
    size_t samples = 0;
    for( ; begin != end ; ++begin ) {
        const T& s = *begin;
        sum += s.*var;
        samples++;
    }
    return sum / samples;
}

struct Sample {
    double x;
}

std::vector<Sample> samples { {1.0}, {2.0}, {3.0} };
double m = mean(samples.begin(), samples.end(), &Sample::x); 
```

**编辑 - 上面的代码具有性能影响**

你应该注意到，正如我很快发现的那样，上面的代码有一些严重的性能影响。总结是，如果您要计算时间序列的汇总统计量，或计算 FFT 等，那么您应该将每个变量的值连续存储在内存中。否则，遍历该系列将导致每个检索到的值的缓存未命中。

考虑这段代码的性能：

```
struct Sample {
  float w, x, y, z;
};

std::vector<Sample> series = ...;

float sum = 0;
int samples = 0;
for(auto it = series.begin(); it != series.end(); it++) {
  sum += *it.x;
  samples++;
}
float mean = sum / samples; 
```

在许多架构上，一个实例`Sample`将填充一个缓存行。因此，在循环的每次迭代中，都会将一个样本从内存中提取到缓存中。缓存行中的 4 个字节将被使用，其余的被丢弃，下一次迭代将导致另一个缓存未命中、内存访问等。

这样做要好得多：

```
struct Samples {
  std::vector<float> w, x, y, z;
};

Samples series = ...;

float sum = 0;
float samples = 0;
for(auto it = series.x.begin(); it != series.x.end(); it++) {
  sum += *it;
  samples++;
}
float mean = sum / samples; 
```

现在，当第一个 x 值从内存中加载时，接下来的三个也将加载到缓存中（假设合适的对齐方式），这意味着您不需要为接下来的三个迭代加载任何值。

通过在例如 SSE2 架构上使用 SIMD 指令，可以进一步改进上述算法。但是，如果这些值在内存中都是连续的，并且您可以使用一条指令将四个样本一起加载（在以后的 SSE 版本中更多），则这些工作会更好**。**

YMMV - 设计您的数据结构以适合您的算法。

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2009-03-22T09:10:20.263

**您可以稍后在任何**实例上访问此成员：

```
int main()
{    
  int Car::*pSpeed = &Car::speed;    
  Car myCar;
  Car yourCar;

  int mySpeed = myCar.*pSpeed;
  int yourSpeed = yourCar.*pSpeed;

  assert(mySpeed > yourSpeed); // ;-)

  return 0;
} 
```

请注意，您确实需要一个实例来调用它，因此它不像委托那样工作。
它很少使用，我多年来可能需要它一两次。

通常使用接口（即 C++ 中的纯基类）是更好的设计选择。

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2009-03-22T09:13:18.133

[IBM](http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=/com.ibm.xlcpp8l.doc/language/ref/cplr034.htm)有更多关于如何使用它的文档。简而言之，您将指针用作类的偏移量。除了它们引用的类之外​​，您不能使用这些指针，因此：

```
 int Car::*pSpeed = &Car::speed;
  Car mycar;
  mycar.*pSpeed = 65; 
```

看起来有点晦涩，但一个可能的应用是，如果您尝试编写代码以将通用数据反序列化为许多不同的对象类型，并且您的代码需要处理它完全不知道的对象类型（例如，您的代码是在库中，并且您反序列化的对象是由您的库的用户创建的）。成员指针为您提供了一种通用的、半易读的方式来引用各个数据成员的偏移量，而不必像 C 结构那样使用无类型的 void * 技巧。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2009-03-22T13:02:42.123

它使得以统一的方式绑定成员变量和函数成为可能。以下是您的 Car 类的示例。更常见的用法是绑定`std::pair::first`以及`::second`在 STL 算法和地图上的 Boost 中使用时。

```
#include <list>
#include <algorithm>
#include <iostream>
#include <iterator>
#include <boost/lambda/lambda.hpp>
#include <boost/lambda/bind.hpp>

class Car {
public:
    Car(int s): speed(s) {}
    void drive() {
        std::cout << "Driving at " << speed << " km/h" << std::endl;
    }
    int speed;
};

int main() {

    using namespace std;
    using namespace boost::lambda;

    list<Car> l;
    l.push_back(Car(10));
    l.push_back(Car(140));
    l.push_back(Car(130));
    l.push_back(Car(60));

    // Speeding cars
    list<Car> s;

    // Binding a value to a member variable.
    // Find all cars with speed over 60 km/h.
    remove_copy_if(l.begin(), l.end(),
                   back_inserter(s),
                   bind(&Car::speed, _1) <= 60);

    // Binding a value to a member function.
    // Call a function on each car.
    for_each(s.begin(), s.end(), bind(&Car::drive, _1));

    return 0;
} 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-03-23T04:24:54.230

您可以使用指向（同质）成员数据的指针数组来启用双重命名成员（iexdata）和数组下标（即x[idx]）接口。

```
#include <cassert>
#include <cstddef>

struct vector3 {
    float x;
    float y;
    float z;

    float& operator[](std::size_t idx) {
        static float vector3::*component[3] = {
            &vector3::x, &vector3::y, &vector3::z
        };
        return this->*component[idx];
    }
};

int main()
{
    vector3 v = { 0.0f, 1.0f, 2.0f };

    assert(&v[0] == &v.x);
    assert(&v[1] == &v.y);
    assert(&v[2] == &v.z);

    for (std::size_t i = 0; i < 3; ++i) {
        v[i] += 1.0f;
    }

    assert(v.x == 1.0f);
    assert(v.y == 2.0f);
    assert(v.z == 3.0f);

    return 0;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-22T11:57:30.563

我使用它的一种方法是，如果我有两个关于如何在一个类中做某事的实现，并且我想在运行时选择一个，而不必不断地通过 if 语句，即

```
class Algorithm
{
public:
    Algorithm() : m_impFn( &Algorithm::implementationA ) {}
    void frequentlyCalled()
    {
        // Avoid if ( using A ) else if ( using B ) type of thing
        (this->*m_impFn)();
    }
private:
    void implementationA() { /*...*/ }
    void implementationB() { /*...*/ }

    typedef void ( Algorithm::*IMP_FN ) ();
    IMP_FN m_impFn;
}; 
```

显然，如果您觉得代码被敲打到足以使 if 语句减慢某些事情的速度，例如，这实际上是有用的。在某处某个密集算法的内部深处。即使在没有实际用途的情况下，我仍然认为它比 if 语句更优雅，但这只是我的意见。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-06-27T18:06:31.283

指向类的指针不是*真正的*指针；类是一个逻辑构造，在内存中没有物理存在，但是，当您构造指向类成员的指针时，它会在成员所在类的对象中提供一个偏移量；这给出了一个重要的结论：*由于静态成员不与任何对象关联，因此指向成员的指针不能指向静态成员（数据或函数）* 考虑以下内容：

```
class x {
public:
    int val;
    x(int i) { val = i;}

    int get_val() { return val; }
    int d_val(int i) {return i+i; }
};

int main() {
    int (x::* data) = &x::val;               //pointer to data member
    int (x::* func)(int) = &x::d_val;        //pointer to function member

    x ob1(1), ob2(2);

    cout <<ob1.*data;
    cout <<ob2.*data;

    cout <<(ob1.*func)(ob1.*data);
    cout <<(ob2.*func)(ob2.*data);

    return 0;
} 
```

**资料来源：完整参考 C++ - Herbert Schildt 第 4 版**

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-11-01T14:38:35.663

我喜欢`*`and`&`运算符：

```
struct X 
{ 
    int a {0}; 
    int *ptr {NULL};

    int &fa() { return a; }
    int *&fptr() { return ptr; }
};

int main(void) 
{
    X x;
    int X::*p1 = &X::a;     // pointer-to-member 'int X::a'. Type of p1 = 'int X::*'
    x.*p1 = 10;

    int *X::*p2 = &X::ptr;  // pointer-to-member-pointer 'int *X::ptr'. Type of p2 = 'int *X::*' 
    x.*p2 = nullptr;
    X *xx;
    xx->*p2 = nullptr;

    int& (X::*p3)() = X::fa; // pointer-to-member-function 'X::fa'. Type of p3 = 'int &(X::*)()'
    (x.*p3)() = 20; 
    (xx->*p3)() = 30;

    int *&(X::*p4)() = X::fptr;  // pointer-to-member-function 'X::fptr'. Type of p4 = 'int *&(X::*)()'
    (x.*p4)() = nullptr; 
    (xx->*p4)() = nullptr;
} 
```

事实上，只要成员是公开的或静态的，一切都是真的

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-11-18T18:48:27.413

这是一个指向数据成员的指针可能有用的示例：

```
#include <iostream>
#include <list>
#include <string>

template <typename Container, typename T, typename DataPtr>
typename Container::value_type searchByDataMember (const Container& container, const T& t, DataPtr ptr) {
    for (const typename Container::value_type& x : container) {
        if (x->*ptr == t)
            return x;
    }
    return typename Container::value_type{};
}

struct Object {
    int ID, value;
    std::string name;
    Object (int i, int v, const std::string& n) : ID(i), value(v), name(n) {}
};

std::list<Object*> objects { new Object(5,6,"Sam"), new Object(11,7,"Mark"), new Object(9,12,"Rob"),
    new Object(2,11,"Tom"), new Object(15,16,"John") };

int main() {
    const Object* object = searchByDataMember (objects, 11, &Object::value);
    std::cout << object->name << '\n';  // Tom
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-04-12T15:08:47.250

假设你有一个结构。该结构内部是 * 某种名称 * 两个相同类型但含义不同的变量

```
struct foo {
    std::string a;
    std::string b;
}; 
```

好的，现在假设您`foo`在容器中有一堆 s：

```
// key: some sort of name, value: a foo instance
std::map<std::string, foo> container; 
```

好的，现在假设您从不同的源加载数据，但数据以相同的方式呈现（例如，您需要相同的解析方法）。

你可以这样做：

```
void readDataFromText(std::istream & input, std::map<std::string, foo> & container, std::string foo::*storage) {
    std::string line, name, value;

    // while lines are successfully retrieved
    while (std::getline(input, line)) {
        std::stringstream linestr(line);
        if ( line.empty() ) {
            continue;
        }

        // retrieve name and value
        linestr >> name >> value;

        // store value into correct storage, whichever one is correct
        container[name].*storage = value;
    }
}

std::map<std::string, foo> readValues() {
    std::map<std::string, foo> foos;

    std::ifstream a("input-a");
    readDataFromText(a, foos, &foo::a);
    std::ifstream b("input-b");
    readDataFromText(b, foos, &foo::b);
    return foos;
} 
```

此时，调用`readValues()`将返回一个“input-a”和“input-b”一致的容器；所有键都将存在，并且 foos 具有 a 或 b 或两者兼有。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-09-20T15:56:05.627

指向成员的真实世界示例可能是 std::shared_ptr 的更窄的别名构造函数：

```
template <typename T>
template <typename U>
shared_ptr<T>::shared_ptr(const shared_ptr<U>, T U::*member); 
```

**那个构造函数有什么好处**

假设你有一个 struct foo：

```
struct foo {
    int ival;
    float fval;
}; 
```

如果您已将 shared_ptr 赋予 foo，则可以使用该构造函数将 shared_ptr 检索到其成员 ival 或 fval：

```
auto foo_shared = std::make_shared<foo>();
auto ival_shared = std::shared_ptr<int>(foo_shared, &foo::ival); 
```

如果想将指针 foo_shared->ival 传递给一些需要 shared_ptr 的函数，这将很有用

[https://en.cppreference.com/w/cpp/memory/shared_ptr/shared_ptr](https://en.cppreference.com/w/cpp/memory/shared_ptr/shared_ptr)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-02-20T15:45:33.597

指向成员的指针是 C++ 中 C 的类型安全等价物`offsetof()`，它在 中定义`stddef.h`：两者都返回信息，其中某个字段位于 a`class`或`struct`中。虽然`offsetof()`在 C++ 中也可以与某些足够简单的类一起使用，但在一般情况下它会失败，尤其是虚拟基类。所以指向成员的指针被添加到标准中。它们还提供了更简单的语法来引用实际字段：

```
struct C { int a; int b; } c;
int C::* intptr = &C::a;       // or &C::b, depending on the field wanted
c.*intptr += 1; 
```

比：

```
struct C { int a; int b; } c;
int intoffset = offsetof(struct C, a);
* (int *) (((char *) (void *) &c) + intoffset) += 1; 
```

至于为什么要使用`offsetof()`（或指向成员的指针），stackoverflow 的其他地方有很好的答案。一个例子在这里：[C offsetof 宏是如何工作的？](https://stackoverflow.com/questions/7897877/how-does-the-c-offsetof-macro-work)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-07-22T10:25:37.933

使用指向成员的指针，我们可以编写这样的通用代码

```
template<typename T, typename U>
struct alpha{
   T U::*p_some_member;
};

struct beta{
   int foo;
};

int main()
{

   beta b{};

   alpha<int, beta> a{&beta::foo};

   b.*(a.p_some_member) = 4;

   return 0;
} 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2009-03-22T10:47:02.013

我认为如果成员数据非常大（例如，另一个相当大的类的对象），并且您有一些仅适用于对该类对象的引用的外部例程，您只想这样做。您不想复制成员对象，因此这可以让您传递它。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2016-12-25T07:22:39.077

只是为@anon 和@Oktalist 的答案添加一些用例，这里是关于指针到成员函数和指针到成员数据的很好的阅读材料。

[https://www.dre.vanderbilt.edu/~schmidt/PDF/C++-ptmf4.pdf](https://www.dre.vanderbilt.edu/~schmidt/PDF/C++-ptmf4.pdf)

# java - ORM：非主键连接列上的 OneToOne 映射 - 由 ISBN 映射的 Book 和 Inventory

> ID：670741
> 
> 赞同：7
> 
> 时间：2009-03-22T09:12:29.243
> 
> 标签：java, hibernate, orm, activerecord, one-to-one

我有一个由 ISBN 编号映射的 Book 模型和 Inventory 模型，但 ISBN 不是两者的主键。书籍属于书店，库存是一组书店（书店链）。库存由属于 BookstoreChain 的所有书店共享。

我在图书端使用 Hibernate @OneToOne 映射通过加入 ISBN 列来获取库存信息。不知何故，Hibernate 正确地生成了左外连接查询，但 Book 对象的库存为空。它也不是延迟加载的。忽略书店和连锁店，我如何在获取书籍时进行 OneToOne 或 ManyToOne 加入并获取库存？

```
class Book{
@Id
Long id

@Column
String isbn;

@Column
String title;

@OneToOne(optional = true)
@JoinColumn(name = "isbn", referencedColumnName = "isbn",insertable = false, updatable = false)
Inventory inventory;
}

class Inventory{
@Id
Long id

@Column
String chainId

@Column
String isbn

@Column
Long availableQty
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-15T18:49:12.423

您必须将您的加入引用命名为其他名称。isbn 已经是一列。尝试这个：

```
@OneToOne(optional = true)
@JoinColumn(name = "inventory", referencedColumnName = "isbn",insertable = false, updatable = false)
Inventory inventory; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T01:06:25.447

我怀疑这与这个问题有什么关系，但我想无论如何我都会提出它，以确保它不是被忽视的问题：

> 请注意，当对非主键列使用 referencedColumnName 时，关联的类必须是可序列化的。

参考：[ [http://docs.jboss.org/ejb3/app-server/HibernateAnnotations/reference/en/html_single/index.html][1]](http://docs.jboss.org/ejb3/app-server/HibernateAnnotations/reference/en/html_single/index.html][1])

我知道您说正在生成 LEFT OUTER JOIN，但我认为如果未指定默认提取是 LAZY。也许，明确指定获取模式可能会产生不同的结果。

最后，如果您使用的是 HQL 查询，也许将其与任何其他实体类一起发布将有助于社区帮助解决问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-09T00:16:29.977

根据您在此处显示的内容，您的数据库架构没有意义。book 和inventory 之间的关系应该是一对多的——大概同一本书在几个inventory 中，这意味着您不能仅将books 和inventory 与isbn 相关联。由于 isbn 在库存中不是唯一的，因此您将在库存中有多行具有相同的 isbn 但不同的链 ID - 哪一行是给定书籍/isbn 的正确行？图书应该有一个外键inventory.id，而不是inventory.isbn。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T10:22:15.627

只是一个猜测：name = 'ISBN' 是否需要与 Inventory 中的字段相同？

# javascript - And Or 在 Javascript 中堆叠条件（如果 $1 && ($2 || $3)）

> ID：670753
> 
> 赞同：0
> 
> 时间：2009-03-22T09:23:18.173
> 
> 标签：javascript, conditional

例如。有 3 个变量，1 是必须的，2 和 3 是两者之一，所以只要 1 和 2 为真，3 就可以为假，只要 1 和 3 为真，2 就可以为假。

```
if(xmlhttp.responseText.indexOf("type:SearchList~")>=0 && (obj == "hDrop" || obj == "iDrop")){
} 
```

不适合我

谁能发现问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T09:31:23.410

我建立了您的条件的真值表：

```
1 2 3 R
-------
0 X X 0
1 0 0 0
1 1 X 1
1 X 1 1 
```

这解析为 1 && (2 || 3)，所以还有其他问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T09:32:12.380

我可以发现您的脚本没有问题。这个非常简单的测试验证了它：

```
var a = "yes";
var b = "no2";
var c = true;
alert(c && (a == "yes" || b == 'no')); 
```

检查'obj'的值。它是一个字符串吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T09:30:46.733

您的代码编写正确，但您比较的数据可能存在错误，因此请跟踪数据，然后检查它是否正确执行您可以使用 alert(data) 跟踪的条件；

# python - IPython shell 的换行问题

> ID：670764
> 
> 赞同：13
> 
> 时间：2009-03-22T09:40:21.657
> 
> 标签：python, terminal, ipython

如果我在 IPython 中运行了很长的一行，并尝试在当前行的开头召回它（使用向上箭头）或退格键，它会显示不正确（全部变成一行）

例如，在接下来的会话中，我写了一个长行`[1]`，输入了一个有点空白的行`[2]`，然后向上箭头两次以使`print`语句上线`[3]`，然后发生了以下情况：

![换行问题](https://i.stack.imgur.com/jUjhy.png)

发生在 iTerm 和 Terminal.app 中。我在常规终端会话中遇到了类似的问题，通过正确终止颜色代码解决了这个问题，但我不知道如何用 IPython 修复它

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-23T09:52:26.957

啊哈！我有一个旧版本的 Python readline 模块 - 从[http://ipython.scipy.org/dist/](http://ipython.scipy.org/dist/)安装最新版本，它运行良好！

```
sudo easy_install http://ipython.scipy.org/dist/readline-2.5.1-py2.5-macosx-10.5-i386.egg 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-30T17:25:41.637

在雪豹上遇到了这个问题。[从http://pypi.python.org/pypi/readline/](http://pypi.python.org/pypi/readline/)安装新版本的 readline 可以修复它：

```
sudo easy_install http://pypi.python.org/packages/2.6/r/readline/readline-2.6.4-py2.6-macosx-10.6-universal.egg 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T16:49:32.593

我无法重现它（向上箭头适用于 ipython 中的长行）：

![ipython 向上箭头长线](https://i.stack.imgur.com/XRkOh.png)

# webserver - 用于 Web 开发的根服务器 - 多少功率才足够？

> ID：670770
> 
> 赞同：0
> 
> 时间：2009-03-22T09:46:43.920
> 
> 标签：webserver, root

我认为这个问题通常与编程无关，但其他 Web 开发人员可能会对答案感兴趣。

我只是想知道如何估计拥有一个快速网站的最低要求。显然，有一些事实需要考虑，例如预期的访问者数量、导出的每秒点击次数等等......同时运行 Web 服务器（Apache/lighttpd）或邮件服务器（Exim、sendmail、. ..) 可能最终有不同的需求。

也许您知道一个好的网站，或者可以就如何根据这些信息估算所需的服务器配置给出一些解释？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-22T10:07:27.270

这可以说是艺术多于科学。

您必须记住的是，就像编程和 IT 中的许多事情一样，您的网站将与链条中最慢的链接一样慢，这意味着您将遇到一些瓶颈，例如带宽、Web 服务器、磁盘 I/O、内存、您的数据库、防火墙等会限制您网站的速度。

调整和发展您的网站将涉及在您发展和解决这些问题时识别这些问题。有时您可能需要添加更多 RAM，有时您可能需要另一个 CPU，依此类推。在其他时候，添加更多内存可能没有用，因为内存不是您的问题。

同样，某些资源的缺乏可以被掩盖，就像内存不足可以通过密集的磁盘 I/O 来掩盖，因为您的系统不断交换（页面错误），但磁盘 I/O 不是问题。

所以你会怎么做？

首先，您需要确定（或做出合理的猜测）典型用户会做什么以及他们会做多少。理想情况下，您将能够使用 JMeter 等软件对 100 或 1000 或您需要的任意数量的用户进行建模，然后了解您的网站如何扩展、需要多少带宽等等。通过对 100、500、1000、2000 个用户进行建模，您将有望看到您的网站的线性扩展程度。

您可能会发现支持 1000 个用户需要 1 gig 的 RAM，但 2000 需要 4 gig：这是非线性可伸缩性的一个示例，它暴露了您在扩展 Web 站点时会遇到的问题。这就是性能测试要揭示的东西。

老实说，如今硬件非常便宜，除了最大和最受欢迎的网站（1 万美元可以为您购买 1 台甚至 2 台服务器，每台服务器具有 16G 内存和 4-8 个内核）之外，它几乎不是问题。共享和 VPS 托管是另一回事，因为您通常只想为所需的内存、带宽和磁盘空间付费。幸运的是，这些类型的解决方案往往会让您轻松升级（至少到您最终必须使用专用主机的地步）。

您可以在项目开始时通过他们所谓的“信封背面”估算来做出一些肮脏的估算。运行关键查询 100 次并计算出它们需要多少 CPU 时间，点击模拟页面 100 次并计算出它产生多少带宽等等。这些粗略的估计加上对用户将如何使用该网站的猜测将为您提供您需要的大致情况（希望在 2-3 倍之内）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T09:59:47.960

您已经提到了用户数量、服务器等。这里还有一些需要考虑。

1.  如果流量很高，则使用集群服务器
2.  服务器的物理位置：找到您网站的受众目标，最好在该国家/地区拥有服务器。
3.  灾难恢复计划。拥有更快的网站是好的，拥有更快的恢复过程也非常好。
4.  选择最好的技术并实施 AJAX 等新技术，并尽可能减少服务器请求。

如果出现问题会添加更多。

# c# - WPF/Xaml 是否有类似 Flex/MXML 的 ViewStack 的东西

> ID：670772
> 
> 赞同：2
> 
> 时间：2009-03-22T09:48:53.603
> 
> 标签：c#, wpf, xaml

Flex/MXML 中的 ViewStack 是一个容器/面板控件，它可以容纳多个子项，但一次只能使一个子项可见，这对于实现您自己的选项卡样式控件很有用。WPF/Xaml 是否有与此相同的类？我知道它有自己专用的选项卡控件（我想要做的不是真正的选项卡控件，所以没用）和 StackPanel，这是不一样的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T10:06:58.613

A）使用网格，并切换 Visibility 属性（多个 UIElements 可以在网格中的一个单元格中 B）使用选项卡控件，但根据需要重新设置它的样式 C）在 ContentPresenter 中交换实际的 Content 属性 - 例如当你想要它时，将你想要的 UI 实例推入其中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T15:49:12.480

IMO，如果您不想编写自定义控件，则模板化任何 ItemsControl 是最简单的方法。

例如，在绑定到 IsSelected 属性值的项目容器中具有一些内部面板的可见性（通过 BooleanToVisibilityConverter）。

# .net - 如何解决 ASP.NET 和 SQL Server 之间的连接池问题？

> ID：670774
> 
> 赞同：257
> 
> 时间：2009-03-22T09:50:47.297
> 
> 标签：.net, asp.net, sql-server, sql-server-2005

最近几天我们在我们的网站上看到这个错误消息太多了：

> “超时已过期。在从池中获取连接之前已经过了超时时间。这可能是因为所有池连接都在使用中并且达到了最大池大小。”

我们已经有一段时间没有更改代码中的任何内容了。我修改了代码以检查未关闭的打开连接，但发现一切正常。

*   我该如何解决这个问题？

*   我需要编辑这个池吗？

*   如何编辑此池的最大连接数？

*   高流量网站的推荐值是多少？

* * *

### 更新：

我需要在 IIS 中编辑某些内容吗？

### 更新：

我发现活动连接数从 15 到 31 不等，我发现 SQL 服务器中配置的最大允许连接数超过 3200 个连接，是 31 太多还是应该在 ASP.NET 配置中编辑一些东西?

* * *

## 回答 #1

> 赞同：258
> 
> 时间：2009-03-22T10:55:52.583

在大多数情况下，连接池问题与*连接泄漏*有关。您的应用程序可能没有正确且一致地关闭其数据库连接。当您让连接保持打开状态时，它们将保持阻塞状态，直到 .NET 垃圾收集器通过调用它们的`Finalize()`方法为您关闭它们。

您要确保您**确实关闭了连接**。例如下面的代码会导致连接泄漏，如果和之间的代码`.Open`抛出`Close`异常：

```
var connection = new SqlConnection(connectionString);

connection.Open();
// some code
connection.Close(); 
```

正确的方法是这样的：

```
var connection = new SqlConnection(ConnectionString);

try
{
     connection.Open();
     someCall (connection);
}
finally
{
     connection.Close();                
} 
```

或者

```
using (SqlConnection connection = new SqlConnection(connectionString))
{
     connection.Open();
     someCall(connection);
} 
```

当您的函数**从类方法返回连接**时，请确保将其缓存在本地并调用其`Close`方法。您将使用以下代码泄漏连接，例如：

```
var command = new OleDbCommand(someUpdateQuery, getConnection());

result = command.ExecuteNonQuery();
connection().Close(); 
```

从第一次调用返回的连接`getConnection()`没有被关闭。此行不是关闭您的连接，而是创建一个新连接并尝试关闭它。

如果您使用`SqlDataReader`or a `OleDbDataReader`，请关闭它们。尽管关闭连接本身似乎可以解决问题，但在使用数据读取器对象时要付出额外的努力来明确关闭它们。

* * *

这篇来自 MSDN/SQL Magazine 的文章“[为什么连接池溢出？](http://msdn.microsoft.com/en-us/library/aa175863(SQL.80).aspx) ”解释了很多细节并提出了一些调试策略：

*   运行`sp_who`或`sp_who2`。这些系统存储过程从`sysprocesses`系统表中返回信息，显示所有工作进程的状态和信息。通常，您会看到每个连接都有一个服务器进程 ID (SPID)。如果您使用连接字符串中的应用程序名称参数命名您的连接，您的工作连接将很容易找到。
*   使用带有 SQLProfiler`TSQL_Replay`模板的 SQL Server Profiler 来跟踪打开的连接。如果您熟悉 Profiler，则此方法比使用 sp_who 轮询更容易。
*   使用性能监视器来监视池和连接。我马上讨论这个方法。
*   监控代码中的性能计数器。您可以通过使用例程提取计数器或使用新的 .NET PerformanceCounter 控件来监视连接池的运行状况和已建立的连接数。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2016-05-31T22:53:13.497

[安装 .NET Framework v4.6.1 后，由于此更改](https://blogs.msdn.microsoft.com/dataaccesstechnologies/2016/05/07/connection-timeout-issue-with-net-framework-4-6-1-transparentnetworkipresolution/)，我们与远程数据库的连接立即开始超时。

要修复，只需`TransparentNetworkIPResolution`在连接字符串中添加参数并将其设置为*false*：

> 服务器=myServerName;数据库=myDataBase;Trusted_Connection=True; **透明网络IPResolution=False**

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-22T09:58:39.633

除非您的使用量大幅增加，否则似乎不太可能只是积压工作。IMO，最有可能的选择是某些东西正在使用连接而不是立即释放它们。你*确定*你`using`在所有情况下都在使用吗？或者（通过任何机制）释放连接？

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-03-22T10:05:28.570

您是否在关闭连接或数据读取器之前检查了未关闭的 DataReader 和 response.redirects。当您在重定向之前不关闭连接时，连接将保持打开状态。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-06-14T22:51:42.260

我们也时常在我们的网站上遇到这个问题。在我们的案例中，罪魁祸首是我们的统计数据/索引已经过时了。这会导致之前快速运行的查询（最终）变慢并超时。

尝试更新统计信息和/或重建受查询影响的表上的索引，看看是否有帮助。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2018-01-02T14:37:14.220

你也可以试试，解决超时问题：

如果您没有将 httpRuntime 添加到您的 webconfig，请将其添加到`<system.web>`标签中

```
<sytem.web>
     <httpRuntime maxRequestLength="20000" executionTimeout="999999"/>
</system.web> 
```

和

像这样修改你的连接字符串；

```
 <add name="connstring" connectionString="Data Source=DSourceName;Initial Catalog=DBName;Integrated Security=True;Max Pool Size=50000;Pooling=True;" providerName="System.Data.SqlClient" /> 
```

最后使用

```
 try
    {...} 
    catch
    {...} 
    finaly
    {
     connection.close();
    } 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2020-08-28T06:25:27.710

在我的情况下发生了另一个原因，因为使用`async`/ `await`，导致相同的错误消息：

> System.InvalidOperationException: '超时已过期。在从池中获取连接之前超时时间已过。这可能是因为所有池连接都在使用中并且达到了最大池大小。

只是对发生的事情（以及我如何解决它）的快速概述，希望这将在未来对其他人有所帮助：

### 寻找原因

这一切都发生在一个带有 Dapper 和 SQL Server 的 ASP.NET Core 3.1 Web 项目中，但我确实认为它独立于那种项目。

首先，我有一个中心函数来获取 SQL 连接：

```
internal async Task<DbConnection> GetConnection()
{
    var r = new SqlConnection(GetConnectionString());
    await r.OpenAsync().ConfigureAwait(false);
    return r;
} 
```

我在几十种方法中使用这个函数，比如这个：

```
public async Task<List<EmployeeDbModel>> GetAll()
{
    await using var conn = await GetConnection();
    var sql = @"SELECT * FROM Employee";

    var result = await conn.QueryAsync<EmployeeDbModel>(sql);
    return result.ToList();
} 
```

如您所见，我使用的是`using`不带花括号 ( `{`, `}`) 的新语句，因此连接的处理是在函数末尾完成的。

尽管如此，我还是得到了关于池中没有更多可用连接的错误。

我开始调试我的应用程序并让它在异常发生时停止。当它停止时，我首先查看了*调用堆栈*窗口，但这仅显示了 System.Data.SqlClient 中的某个位置，对我没有真正的帮助：

[![在此处输入图像描述](https://i.stack.imgur.com/xH8Fl.png)](https://i.stack.imgur.com/xH8Fl.png)

接下来，我查看了“*任务*”窗口，它提供了更好的帮助：

[![在此处输入图像描述](https://i.stack.imgur.com/3LDMN.png)](https://i.stack.imgur.com/3LDMN.png)

`GetConnection`在“等待”或“计划”状态下，我自己的方法实际上有数千次调用。

*在“任务*”窗口中双击这样一行时，它通过“*调用堆栈”*窗口向我显示了我的代码中的相关位置。

这有助于我找出这种行为的真正原因。它在下面的代码中（只是为了完整性）：

```
[Route(nameof(LoadEmployees))]
public async Task<IActionResult> LoadEmployees(
    DataSourceLoadOptions loadOption)
{
    var data = await CentralDbRepository.EmployeeRepository.GetAll();

    var list =
        data.Select(async d =>
            {
                var values = await CentralDbRepository.EmployeeRepository.GetAllValuesForEmployee(d);
                return await d.ConvertToListItemViewModel(
                    values,
                    Config,
                    CentralDbRepository);
            })
            .ToListAsync();
    return Json(DataSourceLoader.Load(await list, loadOption));
} 
```

在上面的控制器操作中，我首先调用以`EmployeeRepository.GetAll()`从数据库表“Employee”中获取模型列表。

然后，对于每个返回的模型（即结果集的每一行），我再次对`EmployeeRepository.GetAllValuesForEmployee(d)`.

虽然这在性能方面*非常*糟糕，但在异步上下文中，它的行为方式是，它正在消耗连接池连接而没有适当地释放它们。

### 解决方案

我通过删除外部 SQL 查询的内部循环中的 SQL 查询来解决它。

这应该通过完全省略它来完成，或者如果需要，将其移动到`JOIN`外部 SQL 查询中的 one/multilpe 以在一个 SQL 查询中从数据库中获取*所有*数据。

### tl;博士/经验教训

不要在短时间内执行大量 SQL 查询，尤其是在使用`async`/时`await`。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-03-22T09:53:55.120

您可以通过在连接字符串中指定`MinPoolSize=xyz`和/或指定最小和最大池大小。`MaxPoolSize=xyz`然而，问题的这个原因可能是另一回事。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2019-02-18T11:37:15.530

我刚刚遇到了同样的问题，想分享一下帮助我找到源的方法：将应用程序名称添加到您的连接字符串中，然后监视与 SQL Server 的打开连接

```
select st.text,
    es.*, 
    ec.*
from sys.dm_exec_sessions as es
    inner join sys.dm_exec_connections as ec on es.session_id = ec.session_id
    cross apply sys.dm_exec_sql_text(ec.most_recent_sql_handle) st
where es.program_name = '<your app name here>' 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-03-22T10:50:46.793

在我的一个 .NET 应用程序中使用某些第 3 方数据层时，我也遇到了这个问题。问题是该层没有正确关闭连接。

我们扔掉了层并自己创建了一个，它总是关闭并处理连接。从那时起，我们不再收到错误消息。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2018-05-31T05:32:46.187

除了发布的解决方案。

在处理 1000 页遗留代码时，每个代码都会多次调用一个通用 GetRS，这是解决问题的另一种方法：

在现有的通用 DLL 中，我们添加了**CommandBehavior.CloseConnection**选项：

```
static public IDataReader GetRS(String Sql)
{
    SqlConnection dbconn = new SqlConnection(DB.GetDBConn());
    dbconn.Open();
    SqlCommand cmd = new SqlCommand(Sql, dbconn);
    return cmd.ExecuteReader(CommandBehavior.CloseConnection);   
} 
```

然后在每个页面中，只要关闭数据读取器，连接也会自动关闭，从而防止连接泄漏。

```
IDataReader rs = CommonDLL.GetRS("select * from table");
while (rs.Read())
{
    // do something
}
rs.Close();   // this also closes the connection 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-07-31T05:57:59.037

这主要是由于应用程序中没有关闭连接。在连接字符串中使用“MinPoolSize”和“MaxPoolSize”。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2015-08-24T15:31:37.707

就我而言，我没有关闭 DataReader 对象。

```
using (SqlCommand dbCmd = new SqlCommand("*StoredProcedureName*"))
using (dbCmd.Connection = new SqlConnection(WebConfigurationAccess.ConnectionString))
{
    dbCmd.CommandType = CommandType.StoredProcedure;

    //Add parametres
    dbCmd.Parameters.Add(new SqlParameter("@ID", SqlDbType.Int)).Value = ID;

    .....
    .....

    dbCmd.Connection.Open();
    var dr = dbCmd.ExecuteReader(); //created a Data reader here
    dr.Close();    //gotta close the data reader
    //dbCmd.Connection.Close(); //don't need this as 'using' statement should take care of this in its implicit dispose method.
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-02-21T13:55:49.313

如果您正在处理无法使用简单 using(..) {..} 的复杂遗留代码 - 就像我一样 - 您可能需要查看我在此[SO 问题](https://stackoverflow.com/questions/9004602/how-to-find-leaking-db-connection-pool-handle)中发布的代码片段，以确定当连接可能泄漏（在设置的超时后未关闭）时，连接创建的调用堆栈。这使得很容易发现泄漏的原因。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-06-13T10:39:08.433

不要多次实例化 sql 连接。打开一两个连接并将它们用于所有下一个 sql 操作。

似乎即使在`Dispose`连接连接时也会引发异常。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-07-20T12:50:52.370

用这个：

```
finally
{
    connection.Close();
    connection.Dispose();
    SqlConnection.ClearPool();
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-11-18T11:41:30.223

我的代码中有这个问题。我将粘贴一些我已经完成的示例代码低于错误。 **在从池中获取连接之前超时时间已过。这可能是因为所有池连接都在使用中并且达到了最大池大小。**

```
 String query = "insert into STATION2(ID,CITY,STATE,LAT_N,LONG_W) values('" + a1 + "','" + b1 + "','" + c1 + "','" + d1 + "','" + f1 + "')";
    //,'" + d1 + "','" + f1 + "','" + g1 + "'

    SqlConnection con = new SqlConnection(mycon);
    con.Open();
    SqlCommand cmd = new SqlCommand();
    cmd.CommandText = query;
    cmd.Connection = con;
    cmd.ExecuteNonQuery();
    **con.Close();** 
```

您希望每次都关闭连接。在此之前，我没有我们关闭连接，因此我得到了错误。添加关闭语句后，我遇到了这个错误

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-01-15T09:12:39.110

我遇到了同样的问题，经过数小时的研究，我意识到我在没有 VPN 的情况下连接到访客网络，所以设置 VPN 对我有用

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-01-22T17:41:44.617

我还在我的 AWS EC2 实例上得到了这个确切的错误日志。

因为我只是部署 alpha 应用程序（没有真正的用户），所以没有连接泄漏，我通过 Activity Monitor 确认，`sp_who`实际上没有与数据库的连接。

我的问题与 AWS 相关——更具体地说，与安全组有关。看，只有某些安全组可以访问我托管数据库的 RDS 服务器。[我使用authorize-security-group-ingress](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/authorize-security-group-ingress.html)命令添加了一个入口规则，以允许使用参数访问正确的 EC2 实例到 RDS 服务器`--source-group-name`。添加了入口规则，我可以在 AWS UI 上看到 - 但我收到了这个错误。

当我在 AWS UI 上手动删除然后添加入口规则时 - 突然异常不再存在并且应用程序正在运行。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-10-05T19:00:00.070

这个问题我以前也遇到过。它最终成为防火墙的问题。我刚刚向防火墙添加了一条规则。我必须打开端口`1433`，以便 SQL 服务器可以连接到服务器。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-12-14T15:23:01.117

就我而言，我有无限循环（从试图从数据库中获取值的 get 属性），它不断打开数百个 Sql 连接。

**要重现该问题，请尝试以下操作：**

```
while (true)
{
    using (SqlConnection connection = new SqlConnection(connectionString))
    {
        connection.Open();
        someCall(connection);
    }
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-11-15T06:37:38.273

是的，有一种方法可以更改配置。如果您在专用服务器上并且只需要更多 SQL 连接，则可以按照以下说明更新两个连接字符串中的“最大池大小”条目：

1.  使用远程桌面登录您的服务器
2.  打开我的电脑 (Windows - E) 并转到 C:\inetpub\vhosts[domain]\httpdocs
3.  双击 web.config 文件。如果文件结构设置为隐藏扩展名，这可能只是作为 web 列出。这将打开 Visual Basic 或类似的编辑器。
4.  找到您的连接字符串，这些将类似于以下示例：

    "add name="SiteSqlServer" connectionString="server=(local);database=dbname;uid=dbuser;pwd=dbpassword;pooling=true;connection lifetime=120;max pool size=25;""

5.将最大池大小=X 值更改为所需的池大小。

6.  保存并关闭您的 web.config 文件。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-03-18T18:56:05.570

确保为连接池设置正确的设置。正如我在以下文章中所解释的那样，这非常重要： [https ://medium.com/@dewanwaqas/configurations-that-significantly-improves-your-app-performance-built-using-sql-server-and-net- ed044e53b60](https://medium.com/@dewanwaqas/configurations-that-significantly-improves-your-app-performance-built-using-sql-server-and-net-ed044e53b60) 如果您遵循它，您将看到应用程序性能的显着提高。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-01-29T16:33:35.847

起初我并不认为这是我的问题，但在浏览这个列表时，我发现它并没有涵盖我的问题。

我的问题是我有一个错误，它试图使用实体框架多次写入相同的记录。它不应该这样做。这是我的错误。看看你正在写的数据。我的想法是 SQL 正忙于写入记录，可能会锁定并创建超时。在我修复了尝试在连续尝试中写入多个记录的代码区域后，错误消失了。

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2016-08-15T13:14:35.213

您的代码已泄露连接。您可以尝试使用 using 来证明您正在关闭它们。

```
using (SqlConnection sqlconnection1 = new SqlConnection(“Server=.\\SQLEXPRESS ;Integrated security=sspi;connection timeout=5”)) 
{
    sqlconnection1.Open();
    SqlCommand sqlcommand1 = sqlconnection1.CreateCommand();
    sqlcommand1.CommandText = “raiserror (‘This is a fake exception’, 17,1)”;
    sqlcommand1.ExecuteNonQuery();  //this throws a SqlException every time it is called.
    sqlconnection1.Close(); //Still never gets called.
} // Here sqlconnection1.Dispose is _guaranteed_ 
```

[https://blogs.msdn.microsoft.com/angelsb/2004/08/25/connection-pooling-and-the-timeout-expired-exception-faq/](https://blogs.msdn.microsoft.com/angelsb/2004/08/25/connection-pooling-and-the-timeout-expired-exception-faq/)

# silverlight - Mac 上的 Silverlight

> ID：670781
> 
> 赞同：2
> 
> 时间：2009-03-22T10:02:27.470
> 
> 标签：silverlight, macos, comparison

我工作的公司正在开发一个供 PC 和 Mac 用户使用的 ASP.NET 应用程序。我们正在考虑在 Silverlight 中制作我们的下一个版本。如果您在 Silverlight 中开发了商业应用程序，PC 上的 Silverlight 和 Mac 上的 Silverlight 在外观/性能等方面是否存在差异？

如果您有机会在不同版本的 Mac OS 上测试 Silverlight，那也会有所帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T12:28:27.383

我个人对 Silverlight 编程的经验非常有限，但我主要为 Mac OS X 开发，因此一直使用它。

我曾经安装过 Silverlight，但注意到每当它在一个页面上激活时，一旦我关闭该页面，整个浏览器就会崩溃，我已经从我的计算机中删除了 Silverlight，这样我就可以在网上冲浪而不会发生随机崩溃.

即使在全新安装 Mac OS X 并使用 Safari 4 Beta 或 3.x 版本范围内的先前发行版本时，也会发生这种情况。我正在运行 Mac OS X Leopard，所以这不是因为我运行的是旧版本的操作系统。

在为 Silverlight 开发时要记住的一点是，当人们已经安装了 Flash 时，他们可能不愿意再安装另一个插件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T10:13:52.700

您可能只想查看当前使用它的各种 Silverlight 演示和站点，并在 Windows 和 Mac 上进行自己的测试，以进行比较。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-17T04:03:52.693

我在 Silverlight 中开发了两个数据密集型应用程序。一个开始是 SL2-B2 应用程序并在 SL2 中发布，另一个是 SL3 应用程序。从数据密集型应用程序的角度来看，mac 和 PC 之间确实没有区别。不过，我在 Mac 上遇到了一些渲染/性能问题——没有什么让我后悔使用 SL。（可以看我的其他问题看silverlight cpu使用问题）

在使用 SL 时，您会发现很多东西对于数据密集型应用程序非常有价值（我认为其中许多在更传统的 Web 语言中是不可能的）：

1.  隔离存储——你可以在本地存储大型数据集，如果你愿意，可以加密。
2.  多线程执行 - 您可以并行处理数据并充分利用多核 CPU（结合#1，您可以完成很多以前不可能的事情）
3.  二进制编码（如果使用 WCF 作为您的服务） - 这会在传输数据时提高服务器端的效率（尽管我猜这可以用其他技术复制，但 SL3 和 WCF 是免费的）
4.  使用本地 GPU 加速进行渲染。如果您的数据密集型应用程序产生复杂的可视化，这可以提供很大的推动力
5.  客户端和服务器端的通用可互换语言。我们在双方共享大量代码。我们使用与服务器端完全相同的代码块在客户端计算结果。（现在我们将代码文件“链接”到 SL 和常规 .net 程序集，使用 .net 4 我们可以共享库）——这会提高编程和测试效率。

另外——有人在上面评论说“只写原生应用程序”——我已经将我的应用程序更新了数百次——所有这些对最终用户都是透明的。根据我的经验，编写本机应用程序并不是真正的问题，而是部署它们、更新它们等。SL 使这变得非常容易，即使不是自动的。我总是告诉那些试图定位 SL 与 Flash 或 SL 与 HTML 的人——对我来说，真正的区别是 SL 与（整个原生应用程序、原生安装程序、更新体验）。

祝你好运。让我们知道结果如何。

顺便说一句：我所有的开发都是在一台运行 Win7 的 Mac Pro 上进行的，它在 VMWare Fusion 中运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T11:14:14.800

我不明白为什么人们想做这样的事情。使用 SilverLight 或 Flash 之类的东西编写的网站在发布到 Internet 时经常会出现问题，免去您的痛苦。

编辑：作为对一些评论的回应，我想我只想说他们是避免此类事情的一个很好的理由，您需要安装网络浏览器以外的其他东西才能使这些网站正常工作，然后您的网站可能会很好发布该程序/插件的新版本时不起作用。还有很多人会在工作，可能一开始就无法安装上述程序，这就是为什么我认为应该用只需要打开 javascript 的网络浏览器才能运行的语言编写网络内容的原因更容易获得。

# air - 如何在 adobe air 中访问命令行

> ID：670782
> 
> 赞同：1
> 
> 时间：2009-03-22T10:03:36.577
> 
> 标签：air

这可能很简单，我还没有掌握，但是可以将命令直接发送到命令行的功能是什么（例如： command("ls") ）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T10:10:46.763

您不能直接执行此操作。查看这篇文章以获取更多信息：

[Adobe AIR 应用程序可以在本地客户端计算机上执行进程吗？](https://stackoverflow.com/questions/265265/can-adobe-air-applications-execute-processes-on-the-local-client-machine)

# bash - 将 bash stdout/stderr 重定向到两个地方？

> ID：670784
> 
> 赞同：38
> 
> 时间：2009-03-22T10:05:17.853
> 
> 标签：bash, redirect

这个已经困扰我一段时间了。是否可以重定向`stdout`到`stderr`终端输出*和*程序？

我知道可以将输出重定向到文件和`stdout`with [`tee`](http://linux.die.net/man/1/tee)，但我希望它转到程序（我的编辑器 [TextMate]）以及终端输出......当然这是可能的（我知道它可能与 zsh …)

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-22T12:41:57.227

您可以使用命名管道，它完全适用于您描述的情况。

```
mkfifo some_pipe
command_that_writes_to_stdout | tee some_pipe \
  & command_that_reads_from_stdin < some_pipe
rm some_pipe 
```

或者，在 Bash 中：

```
command_that_writes_to_stdout | tee >(command_that_reads_from_stdin) 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-22T10:15:39.107

> 是否可以将 stdout 和 stderr 重定向到终端输出和程序？

我不确定在编辑器的输入中组合 stdout 和 stderr 有多大用处，但是这样的事情是否能满足您的需求？

```
input_prog 2>&1 | tee /dev/tty | my_editor 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T12:38:27.937

我实际上不知道 TextMate 是否可以将要编辑的文件作为其标准输入，这似乎有点奇怪。我怀疑您希望将 stdout/stderr 发送到文件并在那里进行编辑，在这种情况下您需要：

```
progname 2>&1 | tee tempfile ; textmate tempfile 
```

`2>&1`重定向`stderr`（文件句柄 2）到与（文件句柄 1）相同的位置，以便`stdout`它们最终都在一个流中。然后该`tee`命令将其写入`tempfile`以及`stdout`。

然后，一旦该过程完成，就会在临时文件上调用编辑器。

如果它可以接受标准输入进行编辑，请使用：

```
progname 2>&1 | tee /dev/tty | textmate 
```

# hosting - 在多站点应用程序设置中使用完整域

> ID：670786
> 
> 赞同：1
> 
> 时间：2009-03-22T10:05:42.983
> 
> 标签：hosting, dns, cname

我正在构建一个多站点应用程序，其中客户端必须能够使用他自己的域（与仅子域相反）。我想知道实现它的不同方法，以及当/如果客户希望在外部处理电子邮件托管时两端需要什么配置。

对 lxadmin/hypervm 的任何引用也会有所帮助。tx~

**编辑：** 我正在运行 apache；没有ssl要求。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-23T06:35:21.250

我建议在 apache`conf`目录中创建一个子目录。类似的东西`conf/user-domains`。该目录中的每个文件都将像用户的域一样命名，例如`userdomain.com`，并且将包含该子域的 apache 指令。像（在我的脑海中）：

```
<VirtualHost *:80>
   ServerName userdomain.com
   DocumentRoot "/path/to/userdomain.com/htmldocs/"
</VirtualHost> 
```

假设您有一些 Web 界面供用户创建这些域，它会将包含他的设置的文件存储在某个已知位置，例如`$webtmp/userrequests/request-XXXYYZ`. 然后，您将拥有一个 cron 作业，该作业将扫描该位置以查找新请求，并在`conf/user-domains`.

哦，帮我个忙，不要只是将用户的输入复制到配置文件中——这是让你的服务器被劫持的好方法。首先检查它，如果它是合法的，则将其清除。（我进一步建议您授予 user 的只写访问权限`conf/user-domains`，`fakedaemonuser`并以该用户身份运行 cron-job。）

编辑：忘了告诉你，你需要在 apache 的主配置文件中添加一个指令（`http.conf`通常）：

```
Include conf/user-domains/*.conf 
```

当然，这是假设您创建的所有文件都`conf/user-domain/`以`.conf`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T11:06:38.110

这类似于 wordpress.com 中博客的工作方式。xyz.wordpress.com 可以映射到 www.xyz.com。

Wordpress MU 具有相同的功能，并且有插件可以做到这一点。这个[链接](http://mu.wordpress.org/forums/topic.php?id=10182)会给你一些想法。

基本上我认为，当客户请求将他的域映射到他的站点（在子域中）时，我们会添加一个插件域并将名称服务器的详细信息提供给用户。一旦它们被设置，重定向应该可以工作。如果我找到更多有用的链接，我会添加更多。

# java - 常见的 Java 内存/引用泄漏模式？

> ID：670791
> 
> 赞同：13
> 
> 时间：2009-03-22T10:08:10.483
> 
> 标签：java, memory-leaks, reference, garbage-collection

也许最典型的例子是 JDBC 关闭方式错误并且没有正确处理可能的异常。我很想看看你见过的其他例子——最好是与 web 应用程序相关的。

那么，Java 中是否有任何常见的泄漏模式？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-22T10:15:33.537

根据我的经验，两个关键的“有效泄漏”模式是：

*   随着时间的推移逐渐增长的静力学和单例。这可能包括缓存、实施和使用不佳的连接池、“自启动以来我们见过的每个用户”的字典等
*   从长期存在的对象到原本*打算*短期存在的对象的引用。在 C# 中，这可能发生在事件中，等效的观察者模式在 Java 中也可以产生相同的效果。基本上，如果您要求一个对象（观察者）观察另一个对象（源），那么您通常最终会得到*从*源*到*观察者的引用。这最终可能成为唯一的“实时”参考，但它的寿命与源一样长。
*   如果您不断动态生成新代码，Permgen 就会泄漏。我在这里比较困难，但我很确定我以这种方式遇到了问题。这可能部分是由于 JRE 错误，这些错误已被修复 - 太久了，我无法确定地记住它。
*   保持状态的单元测试的持续时间可能比您预期的要长，因为 JUnit 将保持测试用例实例。再次，我不记得细节，但有时这使得在拆解中明确的“变量归零”是值得的，看起来不合时宜。

我不能说我经常发现内存泄漏是 Java（或 .NET）中的一个问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-22T10:15:18.843

我不会说这很常见——泄漏在 Java 中非常罕见——但我看到了一个泄漏，因为它保留了对未使用外部实例的非静态内部类的引用，但无论如何都持有对它的引用.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T02:49:13.120

由于以下原因，可能会发生 PermGen 泄漏：

*   在取消部署应用程序后保持活动状态的守护线程。
*   向 JVM 注册的关闭挂钩
*   ThreadLocal 变量，其中值引用了类加载器加载的类

这些都是与 Web 应用程序相关的。它们不会发生在标准 Java 应用程序中。

# c# - 如何在 C# 中获取具有特定扩展名的目录中的所有文件？

> ID：670796
> 
> 赞同：2
> 
> 时间：2009-03-22T10:12:08.197
> 
> 标签：c#, file

我正在使用它来获取目录中的所有文件：

```
string[] files = Directory.GetFiles(sourceDirectory_); 
```

但是有没有一种方法可以在一行中获取所有以“jpg”结尾的文件而不执行

```
if (file.endswidth("jpg") 
```

查看？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-22T10:16:16.097

```
Directory.GetFiles (sourceDirectory_, "*.jpg") 
```

有关此重载的更多详细信息，请参阅[MSDN 文档。](http://msdn.microsoft.com/en-us/library/wz42302f.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-22T10:17:32.287

您可以将搜索模式作为第二个参数提供给 GetFiles：

```
string[] files = Directory.GetFiles(sourceDirectory_, "*.jpg"); 
```

# design-patterns - 网络通信设计模式

> ID：670808
> 
> 赞同：37
> 
> 时间：2009-03-22T10:19:40.610
> 
> 标签：design-patterns, network-programming, network-protocols

我开始意识到我过去问过的几个问题，比如[这个](https://stackoverflow.com/questions/622735/how-have-you-structured-your-network-oriented-apps)真的可以归结为一个更基本的问题。

是否有任何众所周知的网络通信设计模式以及它的性质，协议构造/解析？谷歌搜索没有透露太多。

请注意，我不是在寻找任何给定问题的解决方案，而是在寻找处理网络通信及其协议的文档化设计模式。

编辑：

请不要建议各种实现细节或讨论特定协议，除非它与设计模式相关联。协议设计不是问题，它是用于创建或解析我正在寻找的协议的设计模式，更不用说通信模式本身了。

编辑2：

我很难相信没有人想出任何通用的网络通信模式。是的，我知道“这取决于”，但是您可以对任何项目这么说，但是有很多模式涵盖了一般的想法。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-26T12:25:09.310

这是一个相当广泛的问题，它的处理可能需要一本相当密集的书。

我自己不知道任何此类资源，但让我们考虑一下并考虑网络通信模式空间的维度：

连接方式：{基于连接，无连接}

交互方式：{同步，异步}

对话复杂度：{命令响应，对话}

消息形式：{自由形式流，半结构化块，完全结构化块} ..？

一个好的起点是采用 TCP/IP 协议族，将它们映射到上述空间，并查看在上述协议特征模式中占据独特位置的一个或多个样本的实现空间。您最喜欢的 *nix os 的源代码将是一个很好的查看位置。

解析器实现可能分为两大类：{命令切换处理，有限状态机}。

前者（显然）是两者中更简单的一个，并且可能是最初的实现（除非你以前做过这种事情）。

后者（可能）更健壮、更高效（就 loc 而言），并且允许对协议进行更改（如果它仍需进行设计更改）。

（底层（虚拟）OS 网络设施（当然）也极大地影响了实现。以 JVM 为例：基于 NIO 选择的通道处理可以很好地与 FSM 一起工作。）

希望有帮助。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-05T05:38:39.450

我会说责任链模式对于从网络发送/接收数据可能很有用。

您构建了一系列命令以从客户端发送到服务器。每个命令都通过责任链进行处理，并添加数据以正确处理命令。

在数据发送时，链可能看起来像这样

```
命令 --> 包装一些 --> 加密 --> 发送数据
发送数据
              命令
              （来源，额外
              信息如果
              需要）

```

在数据接收时，链可能是相似的，但反过来

```
接收数据 --> 解密 --> 解包额外数据 --> 执行命令

```

您可以查看本文以获取有关责任链的更多信息。 [http://www.vincehuston.org/dp/chain.html](http://www.vincehuston.org/dp/chain.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-22T11:57:24.683

我建议：抽象出网络协议。

首先决定什么是功能、模块和它们之间的 API。然后决定数据通过网络传输的协议是什么。

然后小心地将所有网络问题封装在它们自己的层中，以便您以后可以应用加密、压缩、添加 http 传输（以通过防火墙）或以后以与功能正交的方式添加的任何内容。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-09-09T09:44:39.580

接受器/连接器模式：[http ://www.cs.wustl.edu/~schmidt/PDF/Acceptor.pdf](http://www.cs.wustl.edu/~schmidt/PDF/Acceptor.pdf)

基于 Gof Chain Of responsabiliy 的过滤器链，它被用于许多网络堆栈/框架中。

用于编码/解码 PDU 的状态机。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T13:58:03.957

我不了解设计模式，但研究现有协议可能是一个很好的起点，尤其是已经标准化的“现代”协议。

BitTorrent 是一种非常流行的去中心化协议，具有许多扩展。

OpenSSH 是另一个不错的选择；它支持特性协商、多种加密类型和解/复用通道。

VoIP 协议适用于流媒体应用：RTP 和 H.323

网络路由协议也很好：BGP（和扩展）、LDP、VRRP/CARP。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-22T11:08:50.103

我不知道模式，但是有一些“明显的”选择点。首先，您是否要使用 ASN.1（这会影响很多）？其次，您想要人类可读的协议还是二进制协议？第三，您想要协议中的任何安全方面吗？

并不是说回答“想使用 ASN.1”会迫使回答很多协议设计问题。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-11-18T05:19:13.847

还没有彻底经历过这个，但我想[这](http://www.cs.wustl.edu/~schmidt/PDF/acceptor-patterns4.pdf)是一个很好的文档：

此外，[这](https://rads.stackoverflow.com/amzn/click/com/0521790409)看起来像一本好书：

# xml - 用于多个但相似的 XML 文件的一种 XML 模式

> ID：670811
> 
> 赞同：1
> 
> 时间：2009-03-22T10:25:38.303
> 
> 标签：xml, validation, xsd

如何创建一个可以处理多个但相似的 XML 文件的 XML 模式。例如，对于 Food Recipes 网站，我有一个名为“dessert”、另一个“indian”和另一个“vegetarian”的食谱 XML，它们几乎都相同，唯一改变的是根元素。下面是一个文件示例：

```
<?xml version="1.0" encoding="utf-8"?>
<!-- this one could be dessert, indian or vegetarian -->
<dessert id="dessert01" xmlns="http://www.w3schools.com"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="schematize.xsd">
    <category>Dessert</category>
    <headline>Caramelised Bananas and Puff Pastry</headline>
    <thumbnail>http://media.lookandtaste.com/files/video_thumbs/caramelized_banana_on_puff_pastry.jpg</thumbnail>
    <intro>Most people are terrified of making desserts so this is one
    that I invented to get you all out of that tricky situation...</intro>
    <media>
        <video><![CDATA[
        <object type="application/x-shockwave-flash" data="http://www.lookandtaste.com//web/jwplayer/player.swf" width="480" height="292" ><param name="movie" value="http://www.lookandtaste.com//web/jwplayer/player.swf" /><param name="bgColor" value="#000000" /><param name="allowfullscreen" value="true" /><param name="allowScriptAccess" value="always" /><param name="FlashVars" value="stretching=exactfit&file=http://videos.lookandtaste.com/New_Vids/Caramelised Bananas and Puff Pastry_01.flv&image=http://www.lookandtaste.com/files/video_thumbs/caramelized_banana_on_puff_pastry.jpg"/></object>
     ]]>
        </video>
    </media>
    <summary>
        <preparation>10 minutes</preparation>
        <time>20 minutes</time>
        <difficulty>Medium</difficulty>
        <healthy>2</healthy>
    </summary>
    <ingredients>
        <ingredient>Puff pastry</ingredient>
        <ingredient>Bananas</ingredient>
        <ingredient>12 cups of sugar</ingredient>
        <ingredient>Knob of butter</ingredient>
        <ingredient>2 tsp of creme fraiche</ingredient>
        <ingredient>1/2 cup of chocolate</ingredient>
    </ingredients>
    <procedures>
        <step>Peel the bananas and chop into chunks. Put the butter and
        bananas in a pan over a medium heat and sprinkle with sugar.
        Caramelise for 4-5 minutes moving the ingredients every few minutes.</step>
        <step>Meanwhile sprinkle flour onto a baking tray and also
        onto a clean flat surface. Roll your pastry on the surface and then
        cut out a circle shape using the top of a bowl as a cutter.</step>
        <step>Put the pastry on the floured baking tray and prick the
        pastry with a fork. Put the pastry into the over for 12-15 minutes at
        180c/360f.</step>
        <step>The bananas should be caramelised now so take them off the
        heat and set them aside.</step>
        <step>Take the pastry out of the oven once it is ready and pile
        the bananas on top with some creme fraiche. Drizzle with melted
        chocolate and serve.</step>
    </procedures>
    <keywords>banana hot caramel dessert</keywords>
</dessert> 
```

...这是我的 XML Schema 文件：

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified">
    <xs:element name="dessert">
        <xs:complexType>
            <xs:sequence>
                <xs:element ref="category"/>
                <xs:element ref="headline"/>
                <xs:element ref="thumbnail"/>
                <xs:element ref="intro"/>
                <xs:element ref="media"/>
                <xs:element ref="summary"/>
                <xs:element ref="ingredients"/>
                <xs:element ref="procedures"/>
                <xs:element ref="keywords"/>
            </xs:sequence>
            <xs:attribute name="id" use="required" type="xs:NCName"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="category" type="xs:NCName"/>
    <xs:element name="headline" type="xs:string"/>
    <xs:element name="thumbnail" type="xs:anyURI"/>
    <xs:element name="intro" type="xs:string"/>
    <xs:element name="media">
        <xs:complexType>
            <xs:sequence>
                <xs:element ref="video"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="video" type="xs:string"/>
    <xs:element name="summary">
        <xs:complexType>
            <xs:sequence>
                <xs:element ref="preparation"/>
                <xs:element ref="time"/>
                <xs:element ref="difficulty"/>
                <xs:element ref="healthy"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="preparation" type="xs:string"/>
    <xs:element name="time" type="xs:string"/>
    <xs:element name="difficulty" type="xs:NCName"/>
    <xs:element name="healthy" type="xs:integer"/>
    <xs:element name="ingredients">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" ref="ingredient"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="ingredient" type="xs:string"/>
    <xs:element name="procedures">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" ref="step"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="step" type="xs:string"/>
    <xs:element name="keywords" type="xs:string"/>
</xs:schema> 
```

指向可能的解决方案或如何处理它的指针将不胜感激。提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T10:45:27.820

不就是这样吗：

```
<xs:complexType name="food">...</xs:complexType>
<xs:element type="food" name="dessert"/>
<xs:element type="food" name="indian"/> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T10:41:13.273

您需要在为根元素编写架构时指定“选择”指示符。由于大部分内容对所有根元素都是通用的，因此您可以定义一种复杂类型，然后重复使用以避免再次编写它们。参考[http://www.w3schools.com/schema/schema_complex_indicators.asp](http://www.w3schools.com/schema/schema_complex_indicators.asp)

[编辑]

如果您可以控制 XML 文档结构（即如果它们不被其他应用程序使用），为什么不定义一个名为“food”的根元素并指定可能的属性 foodType 具有诸如“desert”和“indian”之类的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T10:54:28.687

这是一种方法：

将架构元素更改为：

```
<xs:schema xmlns="urn:my.nampespace"
    targetNamespace="urn:my.nampespace"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified"> 
```

将第一个元素更改为：

```
<xs:element name="dessert" type="recipeType"/>
<xs:element name="indian" type="recipeType"/>
<xs:complexType name="recipeType">
    <xs:sequence>
        <xs:element ref="category"/>
        <xs:element ref="headline"/>
        <xs:element ref="thumbnail"/>
        <xs:element ref="intro"/>
        <xs:element ref="media"/>
        <xs:element ref="summary"/>
        <xs:element ref="ingredients"/>
        <xs:element ref="procedures"/>
        <xs:element ref="keywords"/>
    </xs:sequence>
    <xs:attribute name="id" use="required" type="xs:NCName"/>
</xs:complexType> 
```

现在您可以定义您的xml，如：

```
<dessert id="dessert01"
    xmlns="urn:my.nampespace" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   
    xsi:schemaLocation="urn:my.nampespace recipe.xsd"> 
```

或者：

```
<indian id="indian01" 
    xmlns="urn:my.nampespace" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="urn:my.nampespace recipe.xsd"> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T11:15:59.447

库尔菲呢？（素食，印度甜点）

您可能不应该改变根元素，而是添加属性来指示类别。

# windows - 在 Visual C++ 中创建下一个/后退窗口

> ID：670812
> 
> 赞同：2
> 
> 时间：2009-03-22T10:27:37.923
> 
> 标签：windows, visual-c++, installation

在安装程序中创建一组窗口的最佳方法是什么，您可以在其中单击下一步/返回并在屏幕之间移动。

我的想法是定义一个类，它包含所有必要的“当前窗口”信息，例如按钮、对话框等等。并且基本上在显示这些框之间有下一个/上一个增量。

聪明的想法还是智障而有更好的办法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T11:44:54.150

您所描述的是向导模式下的属性表和属性页。

请参阅属性表/页面的 Win32 描述：http: [//msdn.microsoft.com/en-us/library/bb774540 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb774540(VS.85).aspx)

你是直接用Win32还是MFC？如果您使用 MFC，请参阅[CPropertySheet](http://msdn.microsoft.com/en-us/library/d3fkt014.aspx)和 [CPropertyPage](http://msdn.microsoft.com/en-us/library/491c89bk.aspx)类。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-22T10:33:45.960

为什么不能根据先前的状态更新一个对话框，而不是使用不同的对话框。

例如：

1.  登录屏幕 -> 用户输入信息并提交
2.  更新对话框以显示控件 -> 用户单击“下一步”
3.  根据第 2 步更新屏幕。

主要是您应该将“Steps”数组保持为状态。并根据先前的状态通过从“Steps”数组中检索状态来更新对话框。

# c# - 从完整路径获取目录

> ID：670819
> 
> 赞同：22
> 
> 时间：2009-03-22T10:42:27.420
> 
> 标签：c#, directory

如果我有：

C:\temp\foo\bar\

（**注意：** bar 是一个目录）

我该如何解析：

**酒吧**

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-22T10:59:07.880

我想到了。

```
DirectoryInfo info = new DirectoryInfo(sourceDirectory_);
string currentDirectoryName = info.Name; 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-22T10:47:09.703

尝试

```
System.IO.Path.GetFileName("C:\\temp\\foo\\bar"); 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-23T09:06:11.513

只需使用：

```
string dirname = new DirectoryInfo(@"C:\temp\foo\bar\").Name; 
```

根据 MSDN，这将返回目录的名称，而不是完整路径。

[链接到 MSDN 库](http://msdn.microsoft.com/en-us/library/system.io.directoryinfo.name.aspx)

希望这可以帮助.........

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-22T11:33:49.637

看起来一堆人撤回了他们的答案，这可能是一种耻辱。

值得一提的是，它具有“教人钓鱼”的品质——它简短、优雅，由两个独立的东西组成，一旦学会，就可以重新应用于其他问题。

```
string lastPiece = wholePath.Split('\\').Last(); 
```

`Last`如果列表为空，将抛出。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-10-20T21:18:22.530

**在不**创建新**DirectoryInfo**实例的情况下执行此操作的最简单方法是使用***Path.GetFileName***静态方法。它位于 System.IO 中。

```
using System.IO;

string lastFolderName = Path.GetFileName(@"C:\Folder1\Folder2"); 
```

该变量将设置为“Folder2”。

这比创建 DirectoryInfo 类的新实例**要高效得多！**

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-22T11:04:01.923

我可以立即想到 4 种方法

# 1

*   如果字符串以斜线结尾，请将其删除
*   使用 Path.GetFilename（或许多其他 System.IO 方法）

# 2

*   将斜杠上的字符串拆分为数组
*   获取数组的最后一个索引

# 3

*   在构造函数中用它创建一个 Uri 类
*   使用 Segments 属性

# 4

*   上面有人提到的linq方式

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-09-15T11:23:30.433

```
string dirname = new DirectoryInfo(path).Name;  
Console.WriteLine(dirname); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-22T10:46:46.723

在 Unix 中，这被称为基本名称，一个快速的 google 想出了这个[C# 版本的链接](http://www.experts-exchange.com/Programming/Languages/C_Sharp/Q_23106486.html)。我确定还有其他人...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-22T10:56:25.530

如果上面的答案不能满足您的需求，为什么不从最后一个字符串中提取字符串。

```
string dirName = originalDirName.Substring(originalDirName.LastIndexOf("\\") + 1); 
```

当然，您应该检查 originalDirName 是否不以 \ 结尾，以及 originalDirName 是否长于零并且实际上包含 \ 字符。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-23T08:57:17.603

试试这个

```
string DirName = System.IO.Directory.GetParent(@"C:\temp\foo\bar\").Name; 
```

# html - 级联样式表使用“id”或“class”

> ID：670820
> 
> 赞同：10
> 
> 时间：2009-03-22T10:44:21.487
> 
> 标签：html, css

在为特定的 html 元素设置样式时，我倾向于始终使用 class 属性。css 代码看起来更干净 imo。

为什么两者都存在您应该使用哪一个以及何时使用？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-03-22T10:49:11.647

**id** s**标识**元素。**class** es **class** ify 元素。

如果“它是一种......”（例如地址），则在元素上放置一个类

如果“它是...”（例如导航） ，则*在*元素上放置一个 ID

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-22T10:49:52.130

您按照以下优先顺序进行：

1.  ID（页面上必须只有一个）；
2.  元素和类（例如 div.myclass）；然后
3.  没有元素限定符的类。

ID 是迄今为止最快的查找。下一个最快的是按标记名查找。最慢的是类名。

至于什么时候用class或者id，可以的时候用id，不能的时候用class。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-22T10:47:03.040

如果它是单个元素，我使用 id，如果它适用于多个元素，则使用 class

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-22T10:48:56.453

ID 旨在每页使用一次。我使用 ID 来指定主要布局元素

```
<div id="mainForm">
<div id="wrapper"> 
```

一个类可以跨多个元素定义样式。我用它来定义某种类型的元素出现在页面上的方式。

```
<p class="comments">
<div class="smallText"> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-22T11:15:57.357

有很多选择风格的方法。您可以使用 id's、classes 和标签，并且可以将它们组合起来：

`#nav`- 适用于 id="nav" 的元素

`#nav div`- 适用于 id="nav" 元素内的任何 div 元素

`#nav .left`- 适用于 id="nav" 元素中 class="left" 的任何元素

`.item span`- 适用于 class="item" 元素内的任何 span 元素

`.item .address`- 适用于 class="item" 元素内 class="address" 的任何元素

`div.item`- 适用于 class="item" 的任何 div 元素

`#nav div span`- 适用于 id="nav" 元素内的 div 元素内的任何 span 元素

对 CSS 选择器来说重要的是它们的具体程度。id 比类更具体。使用这种风格：

```
.dark { color: black; }
#bright { color: white; } 
```

该元素将获得白色文本，因为使用 id 的样式比使用类的样式更具体：

```
<div id="bright" class="dark">Hello world</div> 
```

还有更多关于选择器和特异性的知识。我发现本教程很好地概述了选择器：[Selectutorial](http://css.maxdesign.com.au/selectutorial/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-22T16:35:53.483

就 HTML 而言，一个**id**标识 DOM 中的单个元素，每个元素只能有一个唯一的 id，而一个**类**对 DOM 中的一个或多个元素进行分类，每个元素可以有多个类。

```
<div id="this-unique-element" class="class1 class2 class3">...</div> 
```

同样从 CSS 的角度来看，请记住重要性的顺序是从最不具体到最具体。因此，**`#id`**属性会覆盖**`.class`**属性，而属性又会覆盖**`tag`**属性。因此，除非标记了某些类属性，否则**`#id`**样式胜过样式。**`.class`****`!important`**

```
<style>
    #red1, #red2 { color: red; }
    .blue1 { color: blue; }
    .blue2 { color: blue !important; }
</style>

<p id="red1" class="blue1">This text is red.</p>
<p id="red2" class="blue2">This text is blue.</p> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-22T10:55:31.600

身份证

```
#header
#footer
#sidebar
#menu
#content 
```

班级

```
.important
.warning
.validationError
.recent
.outOfDate
.inactive
.weekDay
.previous
.next
.first
.last 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-22T15:28:09.590

出于 CSS 的目的，我分享你只使用`class`. 当 JavaScript 需要接触元素时，我也会给它们`id`s，但我不会在`id`我的样式表中设置样式。

我这样做的原因很简单：总是有可能，在路上的某个地方，你可能需要另一个。如果您按 样式设置它`class`，则只需添加第二个元素`class`即可。如果您使用 设置样式`id`，则需要将其更改`id`为 a`class`或（如果有任何代码引用`id`）将其拆分`id`为 an`id`和 a `class`，然后弄清楚如何划分它们之间的属性和引用。从一开始就更容易设置它的样式`class`。

我也更喜欢`class`es 因为你可以为同一个元素分配多个，这有助于避免样式表中的无意义重复，尽管这是一个弱论点，因为没有理由你不能做一些样式`id`和其他样式基于任意数量的`class`es。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-22T10:48:40.713

我主要使用 ID 来识别已经分配了类的元素中的特定元素。这样我就可以更容易地识别出哪个元素得到了哪个样式。

不太确定它们之间是否存在真正的其他区别，除了您只能在页面中使用一次 ID...

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-22T10:48:59.403

id 属性只能在每个文档中使用一次。不同之处在于，您可以为文档中的特定元素拥有一个唯一的 id，这在编写脚本时非常方便，甚至在您需要专门为一个元素设置样式时甚至对于 CSS 也是如此。

类更多的是一种“类型”的描述。你可以指定一个元素应该有一个或多个类，这些类描述了它的属性。

例如：

```
<div id="header" /> 
```

给定文档上只有一个标题。

```
<div class="item alternate last" /> 
```

您有多个项目，此项目是备用项目之一。这也是最后一项。如果您确定文档中始终只有一个最后一项，您甚至可以将其指定为“last”。

等等。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-22T11:12:04.247

ID 在文档中必须是唯一的。CLASS 可以应用于（和组合）同一页面上的多个元素。

ID 不能组合（多个 ID）。这有效：

```
<div class="beautiful blonde stupid"> blah blah blah </div> 
```

但这不起作用：

```
<div id="Paris Hilton"> blah blah blah </div> 
```

动态 HTML 通常使用 id 来控制元素。正如 cletus 所提到的，当以某种方式使用 javascript 使页面与用户交互时，具有 id 的元素具有最快的“查找”。

在这些上下文中考虑类和身份，每个原因都变得清晰。

想象一个有几个功能性 div 的页面。每个 div 将具有相同的类来显示共同的样式（即宽度）。每个 div 在被选中时都需要一个唯一的 id 来设置它的样式。在这种情况下，您可能会遇到这样的情况：

```
<div class="demo" id="div1" onlick="action()"> blah blah blah </div> 
```

和一个javascript例程，例如：

```
function action() 
{
  document.getElementById( 'div1' ).style.backgroundColor = 'red'
} 
```

注意：这是愚蠢的代码，但它是为了说明问题

一个元素在每个网页上可以是唯一的，但对于一个网站来说是通用的。因此，在这种情况下使用类是有意义的，即使它在页面上是唯一的。

因此，一般**的经验法则**-*如果它是唯一的，则使用 id，如果它不是使用 class*。如果需要，将 id 更改为 class 真的很容易。切换回来并不容易。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-05T20:19:42.187

## 在哪里使用 ID 与类

两者之间的简单区别在于，虽然一个类可以在一个页面上重复使用，但一个 ID 每页只能使用一次。因此，在标记页面主要内容的 div 元素上使用 ID 是合适的，因为只有一个主要内容部分。相反，您必须使用一个类来设置表格上的交替行颜色，因为根据定义它们将被多次使用。

ID 是一个非常强大的工具。具有 ID 的元素可以是一段 JavaScript 的目标，该 JavaScript 以某种方式操纵该元素或其内容。ID 属性可以用作内部链接的目标，将锚标记替换为名称属性。最后，如果您使您的 ID 清晰且合乎逻辑，它们可以作为文档中的一种“自我文档”。例如，如果块的开始标签的 ID 为“main”、“header”、“footer”，则不必在块之前添加注释说明代码块将包含主要内容“， ETC。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-22T10:49:58.447

阅读[HTML 4.01 规范](http://www.w3.org/TR/html401/)[`id`](http://www.w3.org/TR/html401/struct/global.html#adef-id)中对and[`class`](http://www.w3.org/TR/html401/struct/global.html#adef-class)属性的描述。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-07-30T03:49:16.007

如果你想要一个简单的答案：

想象一下 Class 就像姓氏，所以你可以把它分配给几个家庭成员，对吧？每个成员都应该有一个唯一的名字，这样我们就可以直接调用他们，那就是 Id。

*   CLASS：您可以将其分配给几个不同的元素组，并且您可以轻松地一次更改它们的样式。

*   ID：当你想调用一个特定的元素时，你应该使用 ID，但请注意它必须是唯一的

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-07-30T04:19:12.693

id 表示身份，仅表示单个标签。它可以在页面上单次使用。

类可以多次使用。它可以在一个页面中多次使用。

# asp.net - 宽度， 宽度

> ID：670847
> 
> 赞同：0
> 
> 时间：2009-03-22T11:00:36.300
> 
> 标签：asp.net, html, css, firefox

我有以下标记代码：

```
<div style="width: 72%; margin: 15px; margin-left: auto; margin-right: auto;">
    <center>
        <div style="border-top: Solid 1px Black; border-left: Solid 1px Black; border-right: Solid 1px Black;
        padding: 5px; background-color: #EEEEEE;">
        </div>
        <asp:GridView Style="width: 100%;" BorderWidth="1px" BorderColor="Black">
        </asp:GridView>
    </center>
</div> 
```

结果是这样的：

[![替代文字](https://i.stack.imgur.com/1T8k5.png)](https://i.stack.imgur.com/1T8k5.png)

左上角对齐差异的原因可能是什么？

编辑：这只发生在Firefox中。我想知道我应该如何解决这个问题。我知道微不足道，但是嘿。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T14:30:19.433

网格（即表格）的边框在 100% 宽度之外（这是标准模式 CSS 的工作方式）。此外，中心标签在标准模式下会折旧。

您可以用来解决此问题的一个技巧是将内部 div 标记重写为类似于网格的表格：

```
<table style="border-top: Solid 1px Black; border-left: Solid 1px Black; 
  border-right: Solid 1px Black; border-collapse:collapse; 
  background-color: #EEEEEE; width:100%">
  <tr>
    <td style='padding: 5px'>(inner stuff)</td>
  </tr>
</table> 
```

这样它将在表格外具有相同的边框。

# project-management - 确定哪些功能足以启动

> ID：670872
> 
> 赞同：6
> 
> 时间：2009-03-22T11:31:56.490
> 
> 标签：project-management, project-planning, software-release

您如何确定哪些功能足以启动？我们应该在没有好东西的情况下使用“裸功能”启动吗？还是我们应该添加“花里胡哨”？

你如何决定？我们真的会被突然暴露“灼伤”，还是突然暴露更像是一个神话，暴露是缓慢而渐进的。

欢迎您提出建议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T12:06:20.027

有两个教条要避开：

> 在完成之前不要释放。

和

> 一有任何东西就释放，无论多小。

我喜欢后一种方法，但需要有一定的常识。任何版本都有开销，具体取决于您的组织和产品。

1.  您当然必须进行测试，最好是完整交付（与单元测试相反——您是否与其他系统集成？针对一系列 O/S？拥有复杂和/或大量业务数据？）。
2.  如果您发布商业产品，您肯定需要准备**好某种**文档并进行更新。但即使是内部软件也需要用户文档（即使它是半页的）。
3.  如果您有幸拥有商业软件和/或变更管理流程的打包（不，真的！）用于内部部署，则需要时间和精力。
4.  尤其重要的是，您的最终用户必须注意并可能重新学习您的应用程序。人们总是会厌倦新功能，即使他们承认它们的价值。对于复杂的内部软件，您需要安排最终用户培训课程，如果每两周进行一次，这会有点贵……

不要误解我的意思：尽早发布通常具有很大的优势，特别是因为我们从来没有完全正确地获得业务需求，但是您需要权衡这些好处与发布的实际成本。这是我喜欢在“真实”版本中穿插内部版本的原因之一：它们的成本较低（如果非零），但可以让您的开发过程诚实地进行。

最后，我想我最终得到了经典顾问的回答：“这取决于”！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T11:35:55.403

我同意，只要确保你已经过测试！小的承诺比大的有错误更好，而且不履行你的交易。

将 BETA 添加到您的徽标不会使错误更容易接受。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T11:47:19.417

如果您有幸有选择，请在您拥有安装例程和一个有用的功能后立即发布。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T11:33:31.463

早发，常发，让你的用户告诉你他们喜欢什么，看看[37Signals](http://www.37signals.com)的小海报男孩是不是很漂亮。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-22T11:41:01.883

根据我的经验，通常最好在完善核心功能后立即发布。如果某项功能对客户或目标受众非常重要，那么它就不再属于花里胡哨的功能，而应该被视为核心功能，无论它实施起来多么容易，或者它对产品的影响有多大。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-22T12:00:08.077

像大多数事情一样，我的回答是'这取决于'......

你的软件的目的是什么？如果它是针对具有特定需求的特定用户集的应用程序，那么您需要确保满足足够的这些需求，以使人们值得使用您的系统（请记住，大多数人相信一次被咬，两次害羞 - 你不会有第二次机会）。你会买一辆不左转的车吗？

如果您的应用程序更通用，并且您的目标是来自更广泛基础的特定用户群（通常是技术用户），以帮助您沿着敏捷路线发展您的应用程序，那么请尽早并经常发布。许多这些类型的系统不会根据时间计划发布，而是根据功能计划发布，即当分配给 2.1 的所有票证都标记为完成或丢弃时，将发布 2.1 版。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-22T12:00:52.757

我还要说这取决于市场。如果没有一个（甚至是简单的）杀手级功能，我不会发布产品。即使在早期版本中，您也必须建立一些声誉。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-23T16:01:39.347

> 我们真的会被突然暴露“灼伤”，还是突然暴露只是一个神话？

您是否在媒体上看到有关[Cuil.com](http://www.cuil.com)推出的新闻？他们的新闻稿吹捧它是一个会杀死谷歌的搜索引擎，但简单的搜索却产生了惊人的糟糕结果。（例如，搜索“COBOL”告诉您没有 COBOL 的结果。）公告中突然爆发的流量也使他们的服务器不堪重负。我会说他们在发射时经历的突然暴露被烧毁了。

有人称其为“好莱坞式”发布，因为它类似于电影的发布方式。这种发布方式有一些好处，你并不总是从逐渐积累的用户中获得。然而，这些好处中的大多数都被第一印象非常重要的事实所抵消，并且产品通常的复杂性使得很容易出现错误并给大多数潜在用户留下糟糕的第一印象。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-23T16:16:47.560

问题是，发射**什么**？

如果你在做内部软件，你希望尽早让用户参与进来，所以给他们一些快速的东西是个好主意。

如果您正在做开源，请尽早并经常发布，并为未来的开发制定路线图。

如果你在做收缩包装软件，你需要给用户一些物有所值的东西。不要指望向他们收取实际上使软件有用的升级费用，除非您是一家已经这样做的大型成熟公司。除非您被称为此类软件的主要来源，否则没有人会在被烧毁一次后为您支付两次费用。

如果你在做 Web 服务，你需要在发布时提供一些有用的东西。它可以很小，但它应该给用户一个回来的理由。否则，即使您已经实现了跳舞的大象或其他什么，它也是“Foo.com 没有任何好东西，不要去那里”。您需要让用户对您的网站感觉良好，并且最好对您接下来要做什么感到好奇。如果你要发布一个飞溅，请确保很多事情都在工作。

如果你在做嵌入式，你会在软件足够接近完美并且每个人都同意的时候发布，而不是更早。

# sharepoint-2007 - 从 MOSS 2007 中的两个不同列表中读取列表项

> ID：670876
> 
> 赞同：1
> 
> 时间：2009-03-22T11:34:01.463
> 
> 标签：sharepoint-2007

### 重复

> [将 2 个列表中的数据读入 MOSS 2007 中的第三个列表](https://stackoverflow.com/questions/670900/read-data-from-2-lists-into-the-third-list-in-moss-2007)

我有两个自定义列表显示每个州的发票数据，我的老板想要第三个列表，它必须从前两个列表中的每个列表中读取一个（列）/列表项，我是 SharePoint 2007 的新手，任何提示如何解决这个问题将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T15:33:13.663

我怀疑你的数据模型是错误的。更简单的方法是拥有一个带有“状态”列的发票列表。然后使用 2 个视图来显示两个状态中的每一个的记录（按“状态”列的值过滤）。

你可以有第三个“所有发票”，显示所有州的发票。

（您甚至可以按州对“所有发票”视图进行分组，以获得令人印象深刻的优点）

可以做替代品，但可能会有点复杂。如果您有 SharePoint Designer，则 Dataview Web 部件可以合并来自多个源的数据。[请参阅这篇关于这样做的帖子。](http://www.novolocus.com/2008/11/17/merged-data-sources-for-the-dataview-web-part/)

# networking - 在哪些情况下我应该关闭 TCP 连接？

> ID：670877
> 
> 赞同：0
> 
> 时间：2009-03-22T11:34:22.630
> 
> 标签：networking, sockets

我目前正在编写一个多进程网络游戏服务器（一个看门人进程，它告诉玩家当前正在运行哪些游戏并允许他们创建和加入游戏，以及每个游戏实例的进程）。

在哪些情况下，网守断开与客户端的 TCP 连接会很有用，在哪些情况下它应该继续侦听？例如，在客户端成功加入游戏或检索游戏列表或发生错误时（例如他尝试加入的游戏中没有空闲插槽），网关守卫是否应该关闭连接。还是应该在超时时关闭连接？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T03:14:44.767

我以网络游戏为生。我们所有不是 Web 或 XML 请求的连接只要相关，就会保持打开状态。客户端打开与服务器的连接并保持打开状态，直到发生以下情况之一：

1.  客户端由于正常操作而断开连接。在 TCP 中，这最终会在大多数情况下终止您的连接。但是，对于某些设备/网络连接，断开信号不会被干净地发送，因此您需要备份
2.  客户端超时。您希望将其设置得相当高，具体取决于延迟。对于像网守服务器这样的东西可能需要 5 秒？然后，您可以将其设置为每 2.5 秒左右执行一次定期 ping，如果您不确定数据通常是否会经常发送以保持连接处于活动状态。
3.  服务器启动播放器。如果玩家做了一些无效的事情，比如尝试作弊，服务器会强制断开玩家的连接。它首先发送一个断开连接的数据包（如果适用，带有错误消息），然后在稍后的某个时间终止连接

I would advise against using UDP for most networked game applications. UDP has a harder time getting through various firewall setups that are in use these days, and if you're doing something vaguely important you'll have to write a packet-guarantee system on top of UDP... which is basically what TCP is. From the old version of our engine to our new one we switched from UDP to TCP.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T11:45:03.683

最简单的协议通常为每个单独的事务使用单独的连接。Web 浏览器在其最简单的操作模式下，只需连接以下载页面，然后断开连接。但是重复连接和断开同一台服务器确实会带来开销，因此也可以[重用现有的连接](http://www.io.com/~maus/HttpKeepAlive.html)。

另一方面，如果在连接的使用之间会有很长的延迟，并且有大量的客户端，则必须考虑服务器可以管理的同时连接的数量有限。这是不活动超时可能有用的地方。

保持连接打开还允许您从服务器到客户端进行异步通知，而客户端无需位于防火墙之外。客户端连接然后保持连接，不断地从中读取。服务器通过连接发送通知。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T12:13:38.730

以可能可行的最简单方式设计协议。这可能意味着在事务结束时关闭连接。

如果应用程序（网络游戏的看门人）不是性能关键，或者客户端不需要执行扩展会话，您可能应该在事务结束时关闭套接字。

如果客户需要问另一个问题，客户可以稍后再做一个。

如果您需要扩展到非常高的负载（考虑每台服务器 10k 个并发会话），请考虑使用 UDP，其中服务器可以使用单个（或少量）套接字来为大量客户端提供服务。

# sockets - 有没有办法让多个进程共享一个监听套接字？

> ID：670891
> 
> 赞同：98
> 
> 时间：2009-03-22T11:56:56.477
> 
> 标签：sockets, concurrency

在套接字编程中，您创建一个侦听套接字，然后对于每个连接的客户端，您将获得一个普通的流套接字，您可以使用它来处理客户端的请求。操作系统在后台管理传入连接的队列。

两个进程不能同时绑定到同一个端口 - 默认情况下，无论如何。

我想知道是否有办法（在任何著名的操作系统，尤其是 Windows 上）启动进程的多个实例，以便它们都绑定到套接字，从而有效地共享队列。然后每个流程实例都可以是单线程的；它只会在接受新连接时阻塞。当客户端连接时，空闲进程实例之一将接受该客户端。

这将允许每个进程都有一个非常简单的单线程实现，除非通过显式共享内存，否则不会共享任何内容，并且用户将能够通过启动更多实例来调整处理带宽。

有这样的功能吗？

**编辑：**对于那些问“为什么不使用线程？”的人。显然线程是一种选择。但是在一个进程中有多个线程，所有对象都是可共享的，必须非常小心地确保对象不是共享的，或者一次只能对一个线程可见，或者是绝对不可变的，并且大多数流行的语言和运行时缺乏管理这种复杂性的内置支持。

通过启动少数相同的工作进程，您将获得一个*默认*不共享的并发系统，从而更容易构建正确且可扩展的实现。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2009-03-22T12:02:47.367

您可以在 Linux 甚至 Windows 中的两个（或更多）进程之间共享一个套接字。

在 Linux（或 POSIX 类型的操作系统）下，使用`fork()`将导致分叉的孩子拥有所有父文件描述符的副本。任何未关闭的都将继续共享，并且（例如使用 TCP 侦听套接字）可`accept()`用于客户端的新套接字。这就是在大多数情况下包括 Apache 在内的服务器数量。

在 Windows 上基本相同，除了没有`fork()`系统调用，因此父进程将需要使用`CreateProcess`或创建子进程（当然可以使用相同的可执行文件）并且需要传递给它一个可继承的句柄。

使监听套接字成为可继承的句柄并不是一件完全无关紧要的活动，但也不是太棘手。`DuplicateHandle()`需要用于创建重复句柄（但仍在父进程中），该句柄将设置可继承标志。然后，您可以将该结构中的句柄作为CreateProcess或句柄提供`STARTUPINFO`给子进程（假设您不想将其用于其他任何事情）。`STDIN``OUT``ERR`

编辑：

阅读 MDSN library ，似乎这`WSADuplicateSocket`是一种更强大或更正确的机制；它仍然很重要，因为父/子进程需要确定哪个句柄需要通过某些 IPC 机制复制（尽管这可能像文件系统中的文件一样简单）

澄清：

在回答 OP 的原始问题时，不，多个进程不能`bind()`；只是原来的父进程会调用`bind()`，`listen()`等等，子进程只会处理请求`accept()`，`send()`等等`recv()`。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2013-10-09T10:27:16.937

大多数其他人都提供了这种工作的技术原因。下面是一些你可以运行的 python 代码来为自己演示：

```
import socket
import os

def main():
    serversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    serversocket.bind(("127.0.0.1", 8888))
    serversocket.listen(0)

    # Child Process
    if os.fork() == 0:
        accept_conn("child", serversocket)

    accept_conn("parent", serversocket)

def accept_conn(message, s):
    while True:
        c, addr = s.accept()
        print 'Got connection from in %s' % message
        c.send('Thank you for your connecting to %s\n' % message)
        c.close()

if __name__ == "__main__":
    main() 
```

请注意，确实有两个进程 id 正在监听：

```
$ lsof -i :8888
COMMAND   PID    USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
Python  26972 avaitla    3u  IPv4 0xc26aa26de5a8fc6f      0t0  TCP localhost:ddi-tcp-1 (LISTEN)
Python  26973 avaitla    3u  IPv4 0xc26aa26de5a8fc6f      0t0  TCP localhost:ddi-tcp-1 (LISTEN) 
```

以下是运行 telnet 和程序的结果：

```
$ telnet 127.0.0.1 8888
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
Thank you for your connecting to parent
Connection closed by foreign host.
$ telnet 127.0.0.1 8888
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
Thank you for your connecting to child
Connection closed by foreign host.
$ telnet 127.0.0.1 8888
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
Thank you for your connecting to parent
Connection closed by foreign host.

$ python prefork.py 
Got connection from in parent
Got connection from in child
Got connection from in parent 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-07-16T18:29:52.543

我想补充一点，可以通过 AF__UNIX 套接字（进程间套接字）在 Unix/Linux 上共享套接字。似乎发生的是创建了一个新的套接字描述符，它在某种程度上是原始套接字的别名。这个新的套接字描述符通过 AFUNIX 套接字发送到另一个进程。这在进程无法 fork() 共享它的文件描述符的情况下特别有用。例如，当使用由于线程问题而防止这种情况发生的库时。您应该创建一个 Unix 域套接字并使用[libancillary](http://www.normalesup.org/~george/comp/libancillary/)通过描述符发送。

看：

*   [https://www.linuxquestions.org/questions/programming-9/how-to-share-socket-between-processes-289978/](https://www.linuxquestions.org/questions/programming-9/how-to-share-socket-between-processes-289978/)

创建 AF_UNIX 套接字：

*   [http://docs.sun.com/app/docs/doc/817-4415/portmapper-51908?a=view](http://docs.sun.com/app/docs/doc/817-4415/portmapper-51908?a=view)

例如代码：

*   [http://lists.canonical.org/pipermail/kragen-hacks/2002-January/000292.html](http://lists.canonical.org/pipermail/kragen-hacks/2002-January/000292.html)
*   [http://cpansearch.perl.org/src/SAMPO/Socket-PassAccessRights-0.03/passfd.c](http://cpansearch.perl.org/src/SAMPO/Socket-PassAccessRights-0.03/passfd.c)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-09-02T09:33:45.380

看起来 MarkR 和 zackthehack 已经完全回答了这个问题，但我想补充一点，Nginx 是监听套接字继承模型的一个例子。

这是一个很好的描述：

*   [http://zimbra.imladris.sk/download/src/GNR-601/ThirdParty/nginx/docs/IMPLEMENTATION](http://zimbra.imladris.sk/download/src/GNR-601/ThirdParty/nginx/docs/IMPLEMENTATION)

> ```
>  Implementation of HTTP Auth Server Round-Robin and
>                 Memory Caching for NGINX Email Proxy
> 
>                             June 6, 2007
>              Md. Mansoor Peerbhoy <mansoor@zimbra.com> 
> ```
> 
> ...
> 
> NGINX 工作进程的流程
> 
> 在 NGINX 主进程读取配置文件并分叉到配置数量的工作进程后，每个工作进程进入一个循环，在其中等待其各自套接字集上的任何事件。
> 
> 每个工作进程仅从侦听套接字开始，因为还没有可用的连接。因此，为每个工作进程设置的事件描述符仅从侦听套接字开始。
> 
> （注意）NGINX 可以配置为使用以下几种事件轮询机制中的任何一种：aio/devpoll/epoll/eventpoll/kqueue/poll/rtsig/select
> 
> 当连接到达任何监听套接字（POP3/IMAP/SMTP）时，每个工作进程都会从其事件轮询中出现，因为每个 NGINX 工作进程都继承了监听套接字。然后，每个 NGINX 工作进程将尝试获取一个全局互斥锁。其中一个工作进程将获得锁，而其他工作进程将返回各自的事件轮询循环。
> 
> 同时，获取全局互斥锁的工作进程将检查触发的事件，并为每个触发的事件创建必要的工作队列请求。一个事件对应于一组描述符中的一个套接字描述符，worker 正在从中监视事件。
> 
> 如果触发的事件对应一个新的传入连接，NGINX 会接受来自监听套接字的连接。然后，它将上下文数据结构与文件描述符相关联。此上下文包含有关连接的信息（是否为 POP3/IMAP/SMTP，用户是否已通过身份验证等）。然后，这个新构建的套接字被添加到该工作进程的事件描述符集中。
> 
> 工作人员现在放弃互斥锁（这意味着到达其他工作人员的任何事件都可以继续），并开始处理之前排队的每个请求。每个请求对应于一个已发出信号的事件。从发出信号的每个套接字描述符中，工作进程检索先前与该描述符关联的相应上下文数据结构，然后调用相应的回调函数，这些函数根据该连接的状态执行操作。例如，在新建立的 IMAP 连接的情况下，NGINX 要做的第一件事就是将标准的 IMAP 欢迎消息写入
> 连接的套接字（* OK IMAP4 就绪）。
> 
> 渐渐地，每个工作进程完成处理每个未完成事件的工作队列条目，并返回到其事件轮询循环。一旦与客户端建立了任何连接，事件通常会更快，因为每当连接的套接字准备好读取时，就会触发读取事件，并且必须采取相应的操作。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2014-05-04T03:25:45.483

不确定这与原始问题的相关性如何，但在 Linux 内核 3.9 中有一个补丁添加了 TCP/UDP 功能：TCP 和 UDP 支持 SO_REUSEPORT 套接字选项；新的套接字选项允许同一主机上的多个套接字绑定到同一端口，旨在提高在多核系统上运行的多线程网络服务器应用程序的性能。更多信息可以[在 Linux Kernel 3.9 中的 LWN 链接 LWN SO_REUSEPORT 中](http://lwn.net/Articles/542629/)找到，如参考链接中所述：

SO_REUSEPORT 选项是非标准的，但在许多其他 UNIX 系统（特别是 BSD，该想法的起源）上以类似的形式提供。它似乎提供了一个有用的替代方案，可以从运行在多核系统上的网络应用程序中获得最大性能，而不必使用分叉模式。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-02-20T18:20:44.787

从 Linux 3.9 开始，您可以在套接字上设置 SO_REUSEPORT，然后让多个不相关的进程共享该套接字。这比 prefork 方案更简单，没有信号问题，fd 泄漏到子进程等。

[Linux 3.9 引入了编写套接字服务器的新方法](http://freeprogrammersblog.vhex.net/post/linux-39-introduced-new-way-of-writing-socket-servers/2)

[SO_REUSEPORT 套接字选项](https://lwn.net/Articles/542629/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-22T13:44:23.457

有一个任务，其唯一工作是侦听传入连接。当接收到连接时，它会接受该连接——这会创建一个单独的套接字描述符。接受的套接字被传递给您可用的工作任务之一，主要任务返回侦听。

```
s = socket();
bind(s);
listen(s);
while (1) {
  s2 = accept(s);
  send_to_worker(s2);
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-28T18:15:35.630

在 Windows（和 Linux）下，一个进程可以打开一个套接字，然后将该套接字传递给另一个进程，这样第二个进程也可以使用该套接字（如果它愿意，可以依次传递它） .

关键的函数调用是 WSADuplicateSocket()。

这将使用有关现有套接字的信息填充结构。然后，通过您选择的 IPC 机制将此结构传递给另一个现有进程（注意我说的是现有的 - 当您调用 WSADuplicateSocket() 时，您必须指明将接收发出信息的目标进程）。

然后接收进程可以调用 WSASocket()，传入这个信息结构，并接收到底层套接字的句柄。

两个进程现在都持有同一个底层套接字的句柄。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-22T12:19:25.177

如果您使用 HTTP，Windows 中的另一种方法（避免许多复杂细节）是使用[HTTP.SYS](http://msdn.microsoft.com/en-us/library/aa364510(VS.85).aspx)。这允许多个进程在同一端口上侦听不同的 URL。在 Server 2003/2008/Vista/7 上，这是 IIS 的工作方式，因此您可以与其共享端口。（在 XP SP2 上支持 HTTP.SYS，但 IIS5.1 不使用它。）

其他高级 API（包括 WCF）使用 HTTP.SYS。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-22T12:18:31.653

听起来您想要的是一个侦听新客户端的进程，然后在获得连接后断开连接。跨线程做到这一点很容易，在 .Net 中，您甚至可以使用 BeginAccept 等方法来为您处理大量管道。跨进程边界传递连接会很复杂，并且不会有任何性能优势。

或者，您可以在同一个套接字上绑定和侦听多个进程。

```
TcpListener tcpServer = new TcpListener(IPAddress.Loopback, 10090);
tcpServer.Server.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);
tcpServer.Start();

while (true)
{
    TcpClient client = tcpServer.AcceptTcpClient();
    Console.WriteLine("TCP client accepted from " + client.Client.RemoteEndPoint + ".");
} 
```

如果您启动两个进程，每个进程都执行上述代码，它将起作用，并且第一个进程似乎获得了所有连接。如果第一个进程被杀死，那么第二个进程就会获得连接。有了这样的套接字共享，我不确定 Windows 究竟是如何决定哪个进程获得新连接的，尽管快速测试确实指向最旧的进程首先获得它们。至于第一个进程是否忙或类似的情况，我不知道它是否共享。

# sharepoint - 将 2 个列表中的数据读入 MOSS 2007 中的第三个列表

> ID：670900
> 
> 赞同：1
> 
> 时间：2009-03-22T12:04:50.857
> 
> 标签：sharepoint

我有 2 个显示发票详细信息的列表，现在我的老板想从这两个列表中读取特定字段到第三个列表中，任何人都可以提供帮助吗？我是 SharePoint 的新手。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T16:22:43.373

这两个列表是不是太大了？如果是这样，您应该查看 WSS 升级 API。它包含批量复制的方法；之后，传输单个项目的最简单方法是创建一个监听 itemAdded 事件的事件接收器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T01:47:47.620

为什么将数据移动到第三个列表中？我问的原因是使用 Web 部件（例如提到的 Bamboo Web 部件）的视图/报告可能是一种解决方案（还有其他解决方案）。

如果您需要移动数据，但只需要执行一次，那么使用数据表视图之类的东西手动复制/粘贴可以很好地工作。如果源列表相当大但不是很大，这仍然可以很好地工作，但您只想分批粘贴（比如一次 100 行）。数据表视图需要客户端集成，这通常在大多数环境中打开。

除此之外，我怀疑您需要一些自定义脚本或代码。使用 PowerShell，您可以获得强大的功能，或者您可以按照其他人的建议编写控制台应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T23:33:21.890

您可以查看 Bamboo 解决方案列表汇总 ( [http://store.bamboosolutions.com/ps-32-5-list-rollup-web-part-release-34.aspx](http://store.bamboosolutions.com/ps-32-5-list-rollup-web-part-release-34.aspx) )。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T12:28:43.220

您可以制作一个控制台应用程序来执行初始移动，然后在两个列表上添加一个工作流，这样如果将任何内容添加到其中一个，它会将更改复制到第三个列表。

# c# - 列表 - 表现得像有拳击

> ID：670903
> 
> 赞同：2
> 
> 时间：2009-03-22T12:07:36.483
> 
> 标签：c#, list, value-type

我们都知道泛型 List<> 不会装箱值类型。为什么在下面的代码片段中 rects[1] 不受 Inflate 方法的影响？

如果没有装箱并且我想影响 rect[1]，我需要编写三行代码，如图所示 - 已注释。有人可以解释一下吗？

```
List<Rectangle> rects = new List<Rectangle>();

for (int i = 0; i < 5; i++)
{
    rects.Add(new Rectangle(1, 1, 1, 1));
}

foreach (Rectangle item in rects)
{
    Console.WriteLine(item);
}

//Rectangle r = rects[1];
//r.Inflate(100, 100);
//rects[1] = r;

rects[1].Inflate(100, 100);

foreach (Rectangle item in rects)
{
    Console.WriteLine(item);
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-22T12:14:14.877

这不是装箱 - 只是当您取出矩形时，您正在操作矩形的独立**副本**。

这是具有可变值类型（结构）的副作用之一。以及您不应该编写自己的可变结构的原因 - 丢失数据太容易了。

由于您不能使预先构建的矩形不可变，恐怕您将不得不将其复制出来；变异它；并将其放回原处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T12:10:41.560

是的，`Rectangle`如果你这样做， 的值将被复制到你的本地变量中。

这不叫拳击。这只是普通的复制，因为`Rectangle`它是一种值类型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T12:10:54.430

因为`Rectangle`是值类型，调用`rects[1]`会在索引 1 处复制`Rectangle`实例。这正是值类型在 .NET 中的工作方式，真的。

# windows - 用于绘制音符的库

> ID：670906
> 
> 赞同：10
> 
> 时间：2009-03-22T12:11:09.360
> 
> 标签：windows, drawing

我正在寻找可以以某种方式在屏幕上绘制音符的 Windows 库。我打算用它来用 C# 编写一个应用程序，但是纯基于 Win32 的解决方案就足够了。有人知道这样的图书馆吗？

编辑：我将实时更新笔记，它们不需要看起来非常花哨。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-22T12:19:31.820

你一定会想看看[**Lilypond**](http://lilypond.org/web/)，它被公认为音乐排版的最佳选择。它是开源的，具有各种输出格式，并且高度可编写脚本。围绕它编写自己的 C# 包装器将非常容易。示例输出：

[![](https://i.stack.imgur.com/YadKt.png)](https://i.stack.imgur.com/YadKt.png)
[（来源：[lilypond.org](http://lilypond.org/web/images/engraver-score.png)）]

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T12:17:41.280

使用[MusicXML](http://en.wikipedia.org/wiki/MusicXML)。有[C++ 绑定](http://libmusicxml.sourceforge.net/)。

[Rosegarden](http://www.rosegardenmusic.com/)可以将 MusicXML 导出为 PDF 或 PS。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-10T18:33:50.087

你可以试试：

[http://www.archiwistykamuzyczna.pl/index.php?article=download&lang=en#psamcontrollibrary](http://www.archiwistykamuzyczna.pl/index.php?article=download&lang=en#psamcontrollibrary)

这是一个用 C# 编写的用于显示笔记的简单库。它仅限于一个五线谱，但它支持一个五线谱上的许多声音。输入格式是 MusicXml，但您也可以通过编程方式添加注释。

这是一篇关于 CodeProject 上 PSAM 控制库的文章：http: [//www.codeproject.com/KB/miscctrl/psamcontrollibrary.aspx](http://www.codeproject.com/KB/miscctrl/psamcontrollibrary.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T12:17:45.943

您可以尝试从[Rosegarden](http://www.rosegardenmusic.com/)中提取相关代码，尽管它非常特定于 Qt。

# javascript - 一页上有多个 WMD 编辑器（SO 分叉版）？

> ID：670909
> 
> 赞同：6
> 
> 时间：2009-03-22T12:15:28.040
> 
> 标签：javascript, wmd

需要明确的是，我指的是[stackoverflow 的分叉 WMD](http://github.com/derobins/wmd/tree/master)的使用，*而不是*[来自 attacklab](http://wmd-editor.com/)的原始版本。

我想使用分叉的版本，但是脚本用来识别 WMDify 的页面元素的 div id 似乎是硬编码的`wmd.js:66`：

```
// A collection of the important regions on the page.
// Cached so we don't have to keep traversing the DOM.
wmd.PanelCollection = function(){
    this.buttonBar = doc.getElementById("wmd-button-bar");
    this.preview = doc.getElementById("wmd-preview");
    this.output = doc.getElementById("wmd-output");
    this.input = doc.getElementById("wmd-input");
}; 
```

如果我只是想使用不同的区域名称，我自己就可以了——但我想在单个页面上使用**可变数量的 WMD 编辑器。**我需要一种方法来告诉 WMD 的每个实例它应该影响的页面区域，但我没有看到任何“钩子”。

没看到可能是我几乎完全缺乏 js 知识的产物。The Right Thing To Do™ 就是正确地学习 javascript，但我正在进行一个有截止日期的项目。我真的很想使用这个版本的 WMD，但我需要一些关于如何修改 WMD 脚本的线索，或者只是一个如何以我可以指定使用哪个 div id 的方式调用它的示例。

线索赞赏！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-07-12T15:40:25.710

我有类似的问题，所以我重新考虑了 WMD 以便能够做到这一点。 [我的 wmd 版本](http://moowmd.awardspace.info/)

最近，我重新检查了这个。Google 代码中的版本支持一个页面上的多个版本。
[google code fork](http://code.google.com/p/pagedown/)，是最新的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T12:24:57.627

在“有期限的项目”中，可以绕过一些限制。在这种情况下，我只需制作 WMD 编辑器脚本的多个副本（或在服务器端生成它）并将 ID 替换为您需要的标识符。这样您就可以立即在一个页面上部署多个 WMD。

您只需要非常清楚一件事：您在那里的项目**中**积累了[技术债务](http://en.wikipedia.org/wiki/Technical_debt)（“草率的软件架构和仓促的软件开发的最终后果”）。您**将**不得不重新审视这一点以偿还这笔债务，否则您将在进行维护时淹没在利息支付中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-16T17:35:13.497

wmd.js 的第 2339 行可能是一个不错的起点：

```
Attacklab.wmd_defaults = {version:1, output:"HTML", lineLength:40, delayLoad:false}; 
```

为您需要更改的每个 div id 添加一个选项。

您可以通过在包含 wmd.js 之前添加一个脚本块来覆盖这些设置，例如：

```
<script type="text/javascript">wmd_options = {"output": "Markdown"};</script> 
```

然后将`wmd.PanelCollection`功能更改为..

```
wmd.PanelCollection = function(){
        this.buttonBar = doc.getElementById(wmd.wmd_env["wmd-button-bar"]);
        this.preview = doc.getElementById(wmd.wmd_env["wmd-preview"]);
        this.output = doc.getElementById(wmd.wmd_env["wmd-output"]);
        this.input = doc.getElementById(wmd.wmd_env["wmd-input"]);
}; 
```

请注意，这完全未经测试，可能无法正常工作，但与自动生成 WMD 编辑器或制作多个副本相比，它*稍微*优雅一些​​。

**编辑**：我尝试进行编辑，但它不像添加到 wmd_defaults 那样简单 - 各种项目（主要是按钮栏）使用 ID 而不是类，但是，它很接近..

**编辑 2**：经过多次摆弄，我会说答案基本上是“不”。

更好的答案是否定的，不是没有对 WMD 进行一些相当大的更改（超出我非常有限的 javascript 经验的更改）..

我尝试将所有硬编码的 div 名称移动到设置中，并为所有按钮类名称添加了“elementNamePrefix”设置，而不是使用`"wmd-spacer1"`它`wmd.wmd_env["elementNamePrefix"] + "spacer1"`......但即使这样，您也需要在 CSS 文件中复制项目，并且这些更改导致我无法修复的奇怪行为（我认为是因为第一行定义的全局 AttackLab 变量？不确定）..

也许，作为拥有多个 WMD 控件的替代方案，您可以有一个通过 AJAX 加载不同帖子的下拉菜单？这肯定比修改 WMD 以允许多个实例更容易..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-16T02:49:10.917

[这个](http://github.com/leotiger/wmd)项目可能是一个好的开始。

# mysql - 有没有办法在 ssh 中设置变量？

> ID：670919
> 
> 赞同：3
> 
> 时间：2009-03-22T12:24:57.830
> 
> 标签：mysql, ssh

仍在努力解决这个问题，但是有什么函数/命令可以用来设置一些简单的变量吗？

当我已经 ssh 进入时，登录到 mysql 会更快，但是输入完整的连接字符串有点烦人。

任何方式来做类似的事情：

```
mysql ${变量} 数据库名
```

哪里`variable`会有类似的东西`-u user -p -h hostname`

或者，还有其他方法可以做我需要的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-22T12:28:59.973

在您的（在服务器上）创建**别名。**`~/.bash_profile`更改`~/.bash_profile`将在您下次登录时生效。

例如添加

```
alias conMy='mysql -u user -p -h hostname' 
```

然后通过

```
ssh yourServer conMy dbname 
```

或者当已经登录时，只需：

```
conMy dbname 
```

* * *

从 bash 手册页：

> **alias** [-p] [name[=value] ...] 不带参数或带有 -p 选项的别名在标准输出上以 alias name=value 的形式打印别名列表。提供参数时，将为每个给定值的名称定义一个别名。值中的尾随空格会导致在扩展别名时检查下一个单词的别名替换。对于参数列表中没有提供值的每个名称，将打印别名的名称和值。别名返回 true，除非给出的名称没有定义别名。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T13:33:28.633

这与 ssh 无关。您必须在 shell 中设置变量。

# sql - 如何摆脱动态 SQL

> ID：670922
> 
> 赞同：3
> 
> 时间：2009-03-22T12:26:54.643
> 
> 标签：sql, oracle, plsql

我的一个包体中有以下动态 SQL

```
 OPEN ccur for
    'select c.category 
     from test_category c 
     where c.deptid='||PI_N_Dept ||
     ' and c.category not in ('|| sExcludeCategories ||')'; 
```

`sExcludeCategories`将包含一组用逗号分隔的整数。我想消除这个动态 SQL 语句。有什么聪明的方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-22T14:12:18.663

我猜你知道你可以绑定一个变量`PI_N_Dept`来删除那段动态sql。不幸的是，对于您的`IN`子句，`sExcludeCategories`您无法为 Oracle 中的列表绑定变量（据我所知，至少高达 9.2）

你确实有几个选择。您当前的解决方案是最简单的。另一种解决方案是更改过程以接受多个变量并创建 AND 语句列表。

```
'select c.category 
     from test_category c 
     where c.deptid= :PI_N_Dept
       and c.category <> :sExcludeCategory1 
       and c.category <> :sExcludeCategory2
       and c.category <> :sExcludeCategory3

'; 
```

或者有一个固定的 IN 值列表

```
'select c.category 
     from test_category c 
     where c.deptid= :PI_N_Dept
       and c.category not in (:sExcludeCategory1 , :sExcludeCategory2, :sExcludeCategory3)'; 
```

如果您只需要 2 个类别，则必须小心。第三个必须设置为不在 c.category 中的某个值（注意：小心并在此处测试空值）

[Ask Tom](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:110612348061)中介绍了另一种解决方案。这看起来很简单，虽然我没有测试过。它通过创建一个函数 str2tbl() 来工作，该函数允许您传递一系列用逗号分隔的数字，并通过对偶创建一个“表”来执行 IN。

```
create or replace type myTableType as table of number;

create or replace function str2tbl( p_str in varchar2 ) return myTableType
  as
     l_str   long default p_str || ',';
     l_n        number;
     l_data    myTableType := myTabletype();
  begin
      loop
          l_n := instr( l_str, ',' );
          exit when (nvl(l_n,0) = 0);
          l_data.extend;
          l_data( l_data.count ) := ltrim(rtrim(substr(l_str,1,l_n-1)));
          l_str := substr( l_str, l_n+1 );
      end loop;
      return l_data;
  end; 
```

你的例子看起来像

```
'select c.category 
     from test_category c 
     where c.deptid= :PI_N_Dept
       and c.category not in ( select * from INLIST ( select cast( str2tbl( :sExcludeCategories  ) as mytableType ) from dual ) )'; 
```

这仅适用`sExcludeCategories`于数字列表。如果引号包含在变量中（并且您无法更改），则必须更改 str2tbl 以处理引号，并更改`myTableType`to的类型`varchar2(10)`或更合适的类型。

总体而言，如果原始 sql 不影响性能，那么为简单起见，我会将其保留为动态 SQL。维持这样的头痛要少得多。否则测试str2tbl。它应该在 Oracle 8 及更高版本中工作。

**PS**：为了完整起见，我遇到了[一篇关于绑定变量的好文章，](http://www.akadia.com/services/ora_bind_variables.html)它涵盖了一些简单的问题，比如虽然没有为 IN 子句使用变量。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T12:31:10.793

我不知道 oracle，但是在 SQL Server 中，获取将 CSV 转换为一列值并加入（[等](https://stackoverflow.com/questions/2647/split-string-in-sql/2677#2677)) 到它。pl-sql 有类似的东西吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T12:36:40.330

```
create or replace type numbertype
as object
(nr number(20,10) )
/ 

create or replace type number_table
as table of numbertype
/ 

create or replace procedure tableselect
( p_numbers in number_table
, p_ref_result out sys_refcursor)
is
begin
  open p_ref_result for
    select *
    from employees , (select /*+ cardinality(tab 10) */ tab.nr from table(p_numbers) tab) tbnrs 
    where id = tbnrs.nr; 
end; 
/ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T12:36:46.913

你可以这样写：

```
OPEN ccur for
  select c.category 
  from test_category c 
  where 
    c.deptid= PI_N_Dept
    and c.category not in 
    (select category_id from categories where <some-condition-that-finds-the-categories-that-should-be-excluded>); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T14:31:17.417

您可以通过将您的值批量复制到一个临时表中来解决这个问题，然后加入该表。一开始可能听起来有点矫枉过正，但由于这是一种非常常见的模式，您肯定会经常重复使用该代码。

# c# - 我可能一次实例化的 WorkflowInstances 的上限是多少？

> ID：670929
> 
> 赞同：0
> 
> 时间：2009-03-22T12:31:11.903
> 
> 标签：c#, .net, workflow, workflow-foundation

我一次可以运行的 WorkflowInstance 实例的数量是否有上限？

我正在使用 .Net 3.5 和 C#（并不是说语言应该有所作为。）

请注意，我并不是说它对同时运行的许多人来说是一个好的设计，我只是对上限感到好奇，如果存在的话。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T12:37:26.973

我在一次会议上向一位 MS 专家提出了这个问题。

卸载持久性服务和空闲实例后，内存中只有一个小的每个保存实例（我似乎记得 64 个字节）。因此，单个进程很容易支持数十万。

显然，如果许多实例不空闲以处理非空闲实例的处理负载，则需要横向扩展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T12:39:29.433

如果您要问的话，我知道没有硬编码的限制。显然，基于您的系统资源有一个实际限制。

# javascript - 为什么用标签创建工具栏很常见 和 ?

> ID：670932
> 
> 赞同：5
> 
> 时间：2009-03-22T12:32:59.073
> 
> 标签：javascript, html, tags, html-lists

我发现网页中相当多的“工具栏”是用 HTML 标签**UL**和**LI**实现的，样式为“ ***float:left*** ”。

例如，在 FireBug 的帮助下，很容易在[http://www.yahoo.com/](http://www.yahoo.com/)中找到这种模式。

有什么理由吗？我不认为 UL 和 LI 是为了创建工具栏而发明的。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-22T12:34:30.117

HTML 旨在用于*语义*（事物的含义），而不是*表示*（它们看起来像什么）。由于`<ul>`表示*无序列表*，并且工具栏在概念上只是项目列表，因此这是明智的。甚至 StackOverflow 也能做到！

```
<div class="nav">
  <ul>
    <li><a href="/questions">Questions</a></li>
    <li><a href="/tags">Tags</a></li>
    <li><a href="/users">Users</a></li>
    <li><a href="/badges">Badges</a></li>
    <li><a href="/unanswered">Unanswered</a></li>
  </ul>
</div> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T12:34:54.390

`UL`并且`LI`用于列表。你列出了一堆链接（子导航、工具（？）等）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T12:35:49.770

一个可能的原因 - 他们对低级客户有*合理的后备行为 - 即它变成了一棵树。*但实际上`<ul>`，`<li>`实际上只是描述嵌套列表数据；用 css 控制布局，他们的初衷很大程度上只是为了方便。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T12:35:50.283

可能是因为有人相信 Web 标准是标记它们的一种真正方式。毕竟，工具栏是图标列表！

但我个人的标记方法是，当您创建一个涉及一些应用程序 UI 元素（如工具栏）的 Web 应用程序时，您不一定必须根据 HTML Web 标准构建所有内容，因为它们不是为标记应用程序而创建的，但对于文档。在这种情况下，只需使用最适合您的方式（例如带有 span 列表的 div，使用类名来为您的应用程序指定上下文语义）。

注意：我的回答专门针对工具栏的使用，而不是网站中的常规导航。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T13:07:07.307

尚未提及的一个原因是将菜单编写为列表有助于搜索引擎更好地解析您的网站。顶级搜索引擎将能够找出嵌套的 div 甚至表格（在某些情况下），但最好让爬虫的工作更容易避免可能的混淆。

**编辑：**

按要求链接：

[http://blog.fryewiles.com/seo/03-04-2008/ul-titles-nesting-uls-for-better-seo](http://blog.fryewiles.com/seo/03-04-2008/ul-titles-nesting-uls-for-better-seo) [http://importantseotips.blogspot.com/2008/09/why-using-div -is-better-than-table-seo.html](http://importantseotips.blogspot.com/2008/09/why-using-div-is-better-than-table-seo.html) [http://webdev.entheosweb.com/2008/02/24/why-i-switched-to-a-tableless-design/](http://webdev.entheosweb.com/2008/02/24/why-i-switched-to-a-tableless-design/)

我实际上找不到很多专门针对 SEO 的 ul 标签的文章，所以我必须通过声明我的意见来限定我的答案。

我认为使用无序列表来显示菜单将有助于爬虫正确解析和索引您的网站。通常，组织良好的数据（例如列表）有助于更好和更快的可抓取性。组织好您的数据将显着提高机器人正确找到您的关键字并对您的网站进行排名的可能性。

（现在，如果我对这个主题的看法和拉里佩奇的一样有价值。;-)）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-23T13:42:56.370

通过允许使用左/右边框，它还避免了在代码中强制使用无语义分隔符（例如竖线）以进行演示的做法，这也为屏幕阅读器添加了不必要的内容来读取。例如

```
<div class="nav">
    <a href="/questions">Questions</a> |
    <a href="/tags">Tags</a> |
    <a href="/users">Users</a> |
    <a href="/badges">Badges</a> |
    <a href="/unanswered">Unanswered</a>
</div> 
```

# ruby - 如何让鞋子可执行到我的路径中？

> ID：670940
> 
> 赞同：0
> 
> 时间：2009-03-22T12:36:42.373
> 
> 标签：ruby, macos, shoes

我开始使用鞋子，nks 文档告诉我两个编写脚本，然后像这样启动它：

```
> shoes myapp.rb 
```

鞋子可执行文件在我安装的 Shoes.app 中。因此，鞋子不在我的路上，所以我不能这样做。

尝试将鞋子符号链接到 /usr/local/bin 但是当我尝试启动它时出现此错误。

```
> shoes myapp.rb
FSPathMakeRef(/usr/local/bin/../../../Shoes.app) failed with error -43. 
```

有任何想法吗？

杰夫

PS。附加信息：OSX Leopard。鞋子版，葡萄干。从 dmg 安装。该链接由绝对路径 ->

```
> sudo ln -s /Applications/Shoes.app/Contents/MacOS/shoes shoes 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T13:06:33.620

制作符号链接时需要提供绝对路径

并且您需要提供应用程序包内的路径，例如`Shoes.app/Contents/MacOS/Shoes`也许

编辑：

您总是可以将以下行添加到您的 .profile 中（假设 bash）

```
export PATH=$PATH:/Applications/Shoes.app/Contents/MacOS/ 
```

虽然这不是一个很好的解决方案

编辑：

```
alias shoes=/Applications/Shoes.app/Contents/MacOS/shoes 
```

可能是更清洁的解决方案

# sql - 删除未命名的约束

> ID：670946
> 
> 赞同：16
> 
> 时间：2009-03-22T12:42:34.963
> 
> 标签：sql, sql-server

我创建了一些没有明确名称的外键。

然后我发现 SQL 生成了疯狂的名称，例如`FK__Machines__IdArt__760D22A7`. 猜猜它们将在不同的服务器上以不同的名称生成。

是否有任何不错的函数可以删除作为参数传递给相关表和字段的未命名 FK 约束？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-06-06T16:19:17.110

要在列上删除单个未命名的默认约束，请使用以下代码：

```
DECLARE @ConstraintName VARCHAR(256)
SET @ConstraintName = (
     SELECT             obj.name
     FROM               sys.columns col 

     LEFT OUTER JOIN    sys.objects obj 
     ON                 obj.object_id = col.default_object_id 
     AND                obj.type = 'F' 

     WHERE              col.object_id = OBJECT_ID('TableName') 
     AND                obj.name IS NOT NULL
     AND                col.name = 'ColunmName'
)   

IF(@ConstraintName IS NOT NULL)
BEGIN
    EXEC ('ALTER TABLE [TableName] DROP CONSTRAINT ['+@ConstraintName+']')
END 
```

如果您想为默认列执行此操作，这可能比原始问题更常见，而且我相信很多人会通过 Google 搜索找到此列，那么只需更改行：

```
obj.type = 'F' 
```

到

```
obj.type = 'D' 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-22T12:55:55.493

没有内置过程来完成此操作，但您可以使用 information_schema 视图中的信息构建自己的过程。

基于表格的示例

```
Create Proc dropFK(@TableName sysname)
as
Begin

Declare @FK sysname
Declare @SQL nvarchar(4000)
Declare crsFK cursor for

select tu.Constraint_Name from 
information_schema.constraint_table_usage TU
LEFT JOIN SYSOBJECTS SO 
ON TU.Constraint_NAME = SO.NAME
where xtype = 'F'
and Table_Name = @TableName
open crsFK
fetch next from crsFK into @FK
While (@@Fetch_Status = 0)
Begin
    Set @SQL = 'Alter table ' + @TableName + ' Drop Constraint ' + @FK
    Print 'Dropping ' + @FK
    exec sp_executesql  @SQL
    fetch next from crsFK into @FK
End
Close crsFK
Deallocate crsFK
End 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-10-18T16:04:21.380

尽管如果您想放弃实际的 DEFAULT 约束而不是 FKey 约束（这也是将我带到这里的原因！），Gunner 的回答使人们走上了正确的轨道，但它存在问题。

我认为这可以解决所有问题。(T-SQL)

```
CREATE PROC #DropDefaultConstraint @SchemaName sysname, @TableName sysname, @ColumnName sysname
AS
BEGIN
    DECLARE @ConstraintName sysname;

    SELECT @SchemaName = QUOTENAME(@SchemaName)
         , @TableName  = QUOTENAME(@TableName);

    SELECT @ConstraintName = QUOTENAME(o.name)
      FROM sys.columns c 
      JOIN sys.objects o 
        ON o.object_id = c.default_object_id 
     WHERE c.object_id = OBJECT_ID(@SchemaName+'.'+@TableName) 
       AND c.name = @ColumnName;

    IF @ConstraintName IS NOT NULL
        EXEC ('ALTER TABLE ' + @SchemaName + '.' + @TableName + ' DROP CONSTRAINT ' + @ConstraintName + '');
END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-03-31T13:46:15.307

这将允许您删除基于表名 + 列名的特定外键约束

在尝试了其他答案之后，我只是在系统表中闲逛了一下，直到我找到了可能看起来的东西。

您想要的是 Constraint_Column_Usage 根据文档`Returns one row for each column in the current database that has a constraint defined on the column.`

我已将其加入 sys.objects 以获取外键。

在一个程序中（这借鉴了其他答案。干杯！）：

```
Create Proc yourSchema.dropFK(@SchemaName NVarChar(128), @TableName NVarChar(128), @ColumnName NVarChar(128))
as
Begin

    DECLARE @ConstraintName nvarchar(128)
    SET @ConstraintName = (
        select c.Constraint_Name
          from Information_Schema.Constraint_Column_usage c
          left join sys.objects o 
          on o.name = c.Constraint_Name
          where c.TABLE_SCHEMA = @SchemaName and 
                c.Table_name = @TableName and 
                c.Column_Name = @ColumnName and
                o.type = 'F'
    )   

    exec ('alter table [' + @SchemaName + '].[' + @TableName + '] drop constraint [' + @ConstraintName + ']')
End 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-02-26T17:17:01.020

这些都不适合我，所以我不得不想出这个来在 mssql 服务器版本 12 和 14 上工作。

1.  首先，检查 RDBMS 给 FK 的名称，它具有相同的前缀和正文，但仅在后缀散列方面有所不同。

2.  其次，选择这些约束的名称。

3.  第三，执行删除它们的更改命令。

4.  最后，您可以删除被这些阻止的列或表

```
BEGIN TRANSACTION;                                                          

DECLARE @ConstraintName nvarchar(200)

SELECT @ConstraintName = name                                               
FROM sys.objects                                                            
WHERE type_desc = 'FOREIGN_KEY_CONSTRAINT'                                  
    AND name LIKE 'FK__table_col_shortcut1___%'                             
EXEC('ALTER TABLE table1 DROP CONSTRAINT ' + @ConstraintName)                  

SELECT @ConstraintName = name                                               
FROM sys.objects                                                            
WHERE type_desc = 'FOREIGN_KEY_CONSTRAINT'                                  
    AND name LIKE 'FK__table_col_shortcut2___%'                             
EXEC('ALTER TABLE table2 DROP CONSTRAINT ' + @ConstraintName)               

SELECT @ConstraintName = name                                               
FROM sys.objects                                                            
WHERE type_desc = 'FOREIGN_KEY_CONSTRAINT'                                  
    AND name LIKE 'FK__table_col_shortcut3___%'                             
EXEC('ALTER TABLE table3 DROP CONSTRAINT ' + @ConstraintName)               

DROP TABLE table_referenced;                                                

COMMIT TRANSACTION; 
```

吸取的教训，从现在开始，我将始终明确地创建约束！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-02-26T20:39:53.917

这将生成一个脚本来重命名默认约束以使用模式 DF__table_name__column_name

```
SELECT 'EXEC sp_rename ''dbo.' + dc.name + ''', ''DF__' + t.name + '__' + c.name + '''' AS the_script,
    t.name AS table_name,
    c.name AS column_name,
    dc.name AS old_constraint_name
FROM
    sys.default_constraints dc
    INNER JOIN sys.tables t
        ON dc.parent_object_id = t.object_id
    INNER JOIN sys.columns c
        ON dc.parent_column_id = c.column_id
        AND t.object_id = c.object_id
WHERE
    dc.name <> 'DF__' + t.name + '__' + c.name 
```

# java - 如何组织包（并防止依赖循环）？

> ID：670948
> 
> 赞同：28
> 
> 时间：2009-03-22T12:44:59.840
> 
> 标签：java, dependencies, packages, project-organization

我一直在我的 Java 项目上运行一些指标，显然包之间存在很多依赖循环。我真的不知道如何将东西组织成包，所以我只是做了对我有意义的事情，这显然是错误的。

我的项目是一个神经网络框架。神经网络具有神经元，它们通过连接相互连接。他们需要相互依赖。但是，也有不同类型的神经元，所以我认为将它们都放在自己的“神经元”包中是个好主意。显然，连接不是神经元，所以它不应该在包中，但由于它们相互引用，我现在有一个循环依赖。

这只是一个例子，但我还有更多这样的情况。你如何处理这些情况？

另外，我读到包层次结构中较高的包中的类不应该引用更深的包中的类。这意味着包“nn”中的 NeuralNetwork 类不能引用包“nn.neurons”中的神经元。你们遵守这个原则吗？如果我将 NeuralNetwork 移动到 'nn.networks' 或其他什么？在这种情况下，它将引用同级包而不是子包。这是更好的做法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-22T16:17:02.327

antcontrib [VerifyDesign 任务](http://ant-contrib.sourceforge.net/tasks/tasks/verifydesign.html)将帮助您做您想做的事：

> 例如，如果一个源代码树中有三个包
> 
> ```
> * biz.xsoftware.presentation
> * biz.xsoftware.business
> * biz.xsoftware.dataaccess 
> ```
> 
> 并且自然呈现应该只依赖于业务包，而业务应该依赖于数据访问。如果您以这种方式定义您的设计并且违反了该设计，则在调用 verifydesign ant 任务时构建将失败。例如，如果我在 biz.xsoftware.presentation 中创建了一个类，并且该类依赖于 biz.xsoftware.dataaccess 中的一个类，则构建将失败。这确保了设计实际上遵循记录的内容（至少在某种程度上）。这对于自动构建特别好

因此，一旦您决定了事物的组织方式，您就可以在编译时强制执行要求。您还可以获得细粒度的控制，因此您可以允许某些情况打破这些“规则”。所以你可以允许一些循环。

根据您想要做的事情，您可能会发现“utils”包是有意义的。

对于您引用的特定情况......我可能会做这样的事情：

*   包 nn 包含 Nueron 和 Connection
*   包 nn.neurons 包含 Nueron 的子类

Neuron 和 Connection 都是 NeuralNetowrk 中使用的高级概念，因此将它们放在一起是有意义的。Neuron 和 Connection 类可以相互引用，而 Connection 类不需要了解 Neuron 子类。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-22T15:43:04.547

首先，您有理由担心，因为包之间的循环依赖关系很糟糕。随着项目规模的扩大，由此产生的问题变得越来越重要，但没有理由及时解决这种情况。

您应该通过将您一起重用的类放在同一个包中来组织您的类。因此，如果您有 AbstractNeuron 和 AbstractConnection，您会将它们放在同一个包中。如果您现在有实现 HumanNeuron 和 HumanConnection，您可以将它们放在同一个包中（例如称为 *.network.human）。或者，您可能只有一种类型的连接，例如 BaseConnection 和许多不同的神经元。原理保持不变。您将 BaseConnection 与 BaseNeuron 放在一起。HumanNeuron 与 HumanSignal 等一起在其自己的包中。 VirtualNeuron 与 VirtualSignal 等一起。您说：“显然，连接不是神经元，因此它不应该在包中..”。这不是那么明显，准确地说也不正确。

你说你把所有的神经元放在同一个包里。这都不正确，除非您一起重用所有实现。再次，看看我上面描述的方案。要么你的项目太小以至于你把所有的东西都放在一个包中，要么你开始按照描述组织包。有关更多详细信息，请查看[通用重用原则](http://www.objectmentor.com/resources/articles/granularity.pdf)：

包中的类可以一起重用。如果你重用一个包中的一个类，你就重用它们。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-22T12:52:30.277

我不认为像你描述的那样的循环依赖*一定*是坏的。只要相互依赖的概念处于相同的抽象级别并且与架构的相同部分相关，则可能没有必要将它们相互隐藏。在我的理解中，神经元和连接符合这个要求。

减少这种耦合的一个常见方法是提取接口，甚至可能将它们放在一个单独的模块中。简单地在单个项目中按包进行组织并不能充分隐藏实现细节。允许您真正隐藏实现的常见模式如下：

客户端代码---->接口<---实现

在这种模式中，您从客户端代码中隐藏了“实现”模块，这意味着“客户端代码”模块中的代码甚至看不到实现代码。

包的嵌套有几个目的： 一些项目可能有一个以包组织的域模型。在这种情况下，包反映了域的某些分组，并且引用可能会向上/向下包。当涉及到诸如服务实现之类的事情时，您建议的模式很常见，而且是一件好事。您获得的包层次结构越深，该类被认为越具体。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-22T12:53:27.137

我们在谈论什么样的代码大小？如果你只有 10-20 个类，你可能不需要（也不应该）仅仅为了它而将代码过度组织到包中。

随着项目的增长，您要做的第一个区别是将用户界面代码与底层数据模型和逻辑分开。为了能够进行适当的单元测试，拥有干净分离的层是至关重要的。

如果您在摆脱循环依赖方面遇到困难，则可能是这些类实际上是相互依赖的，并且应该驻留在同一个包中。

在设计整体代码结构时，正确设置抽象层可能是最重要的方面之一。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-22T12:55:41.813

> 你如何处理这些情况？

循环依赖本质上并不是坏事。事实上，这有时可能是“治疗不如疾病”的情况：提取接口会增加代码的复杂程度并增加另一层间接性。**对于非常简单的关系，这可能不值得。**

# mysql - 远程mysql连接

> ID：670949
> 
> 赞同：0
> 
> 时间：2009-03-22T12:46:19.790
> 
> 标签：mysql, connection, connect

我一直在本地主机上创建一个网络，当我尝试将它移动到主机上时，它显示了很多错误。好像它无法连接到我的本地数据库。这是代码：

```
$host = "myip";
$user = "root";
$pass = "";
$db = "mydatabase";

mysql_connect($host, $user, $pass);
mysql_select_db($db);
$on = mysql_fetch_row(mysql_query("SELECT COUNT(online) FROM characters WHERE online=1"));
echo "<br>Online: $on[0]<br><br>"; 
```

这是输出：

```
Warning: mysql_connect() [function.mysql-connect]: Host 'myip' is not allowed to connect to this MySQL server in * on line 46

Warning: mysql_fetch_row(): supplied argument is not a valid MySQL result resource in * on line 48

Online: 
```

感谢帮助

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T12:53:40.007

这是一个mysql用户权限问题。例如，使用 phpmyadmin 创建一个新用户，如果从 localhost 连接，则将其主机设置为 localhost，如果从外部连接，则将其设置为 %。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T12:59:46.497

正如 Alekc 正确指出的那样，这是一个权限问题：

您可以在 MySQL 提示符下执行此操作：

```
grant all privileges on mydatabase.* 
   to youruser@'your_ip_address' 
   identified by 'your_password'; 
```

其次是：

```
flush privileges; 
```

然后再次尝试重新连接。请记住：

your_ip_adress：这**不是**MySQL 服务器的 IP 地址，而是您连接的 IP 地址（您的 Web 服务器？） your_password：是您在 PHP 端建立连接时必须使用的地址

还要记住，即使此解决方案应该可以工作，也不建议将*所有权限*授予将由 Web 应用程序使用的用户。你可以用更少的权限做同样的事情。

您可以使用一个不错的 GUI 前端来完成所有这些工作。我更喜欢命令行。

# c++ - 访问者与公共成员

> ID：670958
> 
> 赞同：6
> 
> 时间：2009-03-22T12:54:56.243
> 
> 标签：c++, class, member

我有一个包含许多具有读/写访问权限的内置类型成员的类。我应该将它们设为公共成员并为每个成员提供 get/set 方法吗？结构呢？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-22T13:13:39.460

拥有访问器（getter）和修改器（setter）的全部原因是为自己提供额外的间接级别。

这种额外的间接级别允许您向公共接口提供变量的只读视图，同时不允许更改数据成员。您仍然可以使用私有或受保护的设置器。

设置器允许您在设置值时进行特殊的错误检查、验证和更正。例如 setDirectory(const std::string &strPath)，如果用户没有指定，你可以确保有一个终止斜线。这可确保您的类状态始终有效。

Getter 还可以保护您的成员不让它们暴露以允许指向它们的指针。通过不允许从外部指向它们的指针，您可以确保如果您的对象超出范围，它不会导致崩溃。

getter/setter 的额外间接级别还允许您更改它们封装的数据成员。

使用 getter，您还可以获得数据的不同视图，例如：getMinutes，当您的数据成员实际上以秒为单位存储时。

这不是使用它们的原因，但是使用 getter 和 setter 的一个很好的副作用是您可以在修饰符中设置一个断点，例如准确地查看它何时更改。

您是否应该使用它们是基于您的需要的判断电话。如果您有这么多成员，以至于提供 getter 和设置是一个巨大的痛苦，您可以考虑将数据成员存储在一个结构中，并在您的类中使用该结构。您甚至可以一次为整个结构的对象提供 getter/setter。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-22T13:22:39.470

如果您需要保留[不变量，那么可以。](http://en.wikipedia.org/wiki/Class_invariant)否则，不要打扰。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-22T12:58:34.193

首先，如果你的班级有很多数据成员，那么它可能设计得不好。您可能需要考虑将其拆分为多个类或将数据存储在地图等结构中。

关于提供访问器，问题是您是否想要修改访问权限，可能会阻止它。如果答案是肯定的，那么您需要访问功能。另一方面，如果你的类真的只是一堆比特，没有任何行为，那么就让它成为一个结构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T13:19:22.690

您应该只使用公共数据成员

*   在结构中，您不会向客户端代码公开（例如，绑定样式函子） - 保护外部任何人都无法获得的结构是没有用的
*   如果它们的类型封装了设置/获取它们的逻辑（例如，如果你创建了一个 ObservableAttribute 类）
*   如果它们是不可变结构中的 const 成员（如果它们是不可变的，除了读取它们之外，你无能为力）

如果您创建一个公共数据成员，您必须确保它的值与该类的其他成员完全正交。例如，您禁用了未来的可能性

*   观察成员的变化
*   使成员在类的不变量中扮演任何角色
*   禁止访问该成员
*   如果性能需要，更改成员的实现（例如，计算、缓存和存储）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T13:02:28.083

对私有/受保护的数据成员使用 get/set 方法是一个糟糕的设计。

它会导致客户端代码依赖于您的类的实现细节。

类中的更改会导致客户端代码的更改。

但是，可以使用公共成员的 get/set 方法。但避免它们总是好的。

# c# - 试图在编译的 SDK 中覆盖静态方法的格式化实现

> ID：670960
> 
> 赞同：0
> 
> 时间：2009-03-22T12:55:12.390
> 
> 标签：c#, inheritance

我正在使用社区服务器框架。

提供的表单控件之一允许用户更新他/她的“状态”。例如：'Joe: is going to get coffee : 12:30am'。

我想在该消息进入数据库之前更改它的格式（以格式化的 HTML 格式进入）。我想去掉名称和消息之间的“：”字符 - 或者可能进行其他格式设置。

格式化是通过“UpdateStatusMessageForm”实例化“ActivityMessage”类型和用户输入的状态消息来完成的。'ActivityMessage' 调用它的格式化方法，如下所示：

```
public static string GetFormat(IActivityMessage message, string timeCssClass)
{
        return string.Format("<a href=\"{0}\">{1}</a>: {2} <span class='{3}'>{4}</span>", SiteUrls.Instance().UserProfile(message.Author.Username), message.Author.DisplayName, message.Body, timeCssClass, Formatter.FormatTime(message.DateCreated));

} 
```

如果我不能覆盖它，我该如何更改该方法的实现？有什么建议么？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T13:13:21.770

简短的回答是您不能覆盖静态方法。

长答案和一些解决方法在[本文中](http://blogs.msdn.com/kirillosenkov/archive/2008/02/06/how-to-override-static-methods.aspx)

# php - 如何在 PHP 中更新 MySQL 行？

> ID：670964
> 
> 赞同：1
> 
> 时间：2009-03-22T12:57:33.697
> 
> 标签：php, mysql

我有一个正在使用的 MySQL 数据库，但是当我尝试更新其中的一行时，它不起作用。这是我正在使用的更新代码：

```
mysql_query("UPDATE offtopic SET next = '$insert' WHERE id = '$id'"); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-22T13:00:57.120

您的语法是正确的，因此变量或字段名称可能有错误。

试试这个：

```
$sql = "UPDATE offtopic SET next = '$insert' WHERE id = '$id'";
if (!mysql_query($sql)) {
    echo "MySQL Error: " . mysql_error() . "<br />" . $sql;
} 
```

这可能会向您显示一些有用的信息来帮助您进行调试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-22T13:08:14.590

首先，你应该让它更安全一点：

```
mysql_query(sprintf("UPDATE offtopic SET next = '%s' WHERE id = '%s'",
            mysql_real_escape_string($insert),
            mysql_real_escape_string($id)); 
```

现在，您的`id`实际是字符串，而不是数字？如果它的数字，你应该有：

```
mysql_query(sprintf("UPDATE offtopic SET next = '%s' WHERE id = %d",
            mysql_real_escape_string($insert), $id); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-15T02:39:41.017

请出于对互联网的热爱，不要自己构建 SQL 查询。使用[PDO](http://php.net/pdo)。

# installation - 帮助我的用户在 CD 上找到安装程序

> ID：670965
> 
> 赞同：3
> 
> 时间：2009-03-22T12:57:37.220
> 
> 标签：installation, usability, autorun

我需要有关非技术用户的安装 CD 布局的建议。

我的软件部署在带有 setup.exe 引导程序和 MSI 文件的 CD 上。安装程序还使用了几个依赖文件。CD 根目录如下所示：

```
myapp.msi
setup.exe
sqlexpr32.exe
dotnetfx.exe
myapp.ico
... 
```

开发人员猜测您需要运行才能开始安装的文件是`setup.exe`.

但是我的用户绝对没有那么精通技术。

我已经包含了一个`autorun.inf`文件，但我在几台机器上测试后发现它们中的大多数都不会自动启动设置。不管什么原因。在某些机器中，有人禁用了自动运行或某些防病毒软件或其他任何东西。问题是我不能依赖自动运行始终可用。

因此，我正在考虑对 CD 布局进行更改，以使必须运行哪个文件更加明显。

一种选择是制作一个新`Install.exe`程序来启动原始引导程序，并将所有内容移动到 CD 根目录中的文件夹：

```
autorun.inf   <-- launches Install.exe, if autorun is enabled for the drive.
Install.exe   <-- launches contents/setup.exe
contents/myapp.msi
contents/setup.exe
contents/sqlexpr32.exe
contents/dotnetfx.exe
contents/myapp.ico
contents/... 
```

由于我还不能依赖现有的 .net 框架，我不能使用 .net 来制作我的 Install.exe，这有点烦人。

其他选项是制作一个`Install.bat`，但大多数用户不熟悉 .bat 扩展名，可能不会考虑双击它。用户会看到一个命令提示符窗口。

其他选项是制作一个自解压 exe 并压缩里面的所有内容，因此 CD 中的唯一文件是 autorun.inf 和自解压文件。

你会怎么办？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-22T13:02:59.737

> 其他选项是制作 Install.bat，但大多数用户不熟悉 .bat 扩展名，可能不会考虑双击它。用户会看到一个命令提示符窗口。

您可以创建 Install.bat 的快捷方式，并给它一个漂亮的图标和更好的名称。你也可以让它开始最小化，这样他们可能不会注意到命令提示符短暂出现。

* * *

编辑：（塞尔吉奥·阿科斯塔）

我发现了如何解决相对路径问题：

这是应该如何配置快捷方式：

```
Target:    %windir%\system32\cmd.exe "/C start contents\setup.exe"
Start in:  %cd%
Run:       Minimized
Icon:      %SystemRoot%\system32\SHELL32.dll (and manually select the one that looks like a setup package. 
```

我已经对其进行了测试，并且可以正常工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T13:02:44.057

保持简单，不要考虑太多布局，按惯例保留 setup.exe 或 install.exe，并提供 README.txt 文件，他们可以在其中找到安装说明。大多数用户会选择 install.exe 或 setup.exe，其他用户可能会阅读 txt。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T20:22:11.457

在 CD 上贴一张大标签，上面写着“Run Setup.exe”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T19:47:27.877

我认为您提到的最简单的选项是创建一个新的 Install.exe 程序，它只启动原始引导程序，除了 CD 根目录下的 Autorun 之外没有其他任何东西，是最佳选择。

一个图标 = 没有选项。真的没有比这更好的了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-01T09:20:53.410

虽然我喜欢快捷方式的解决方案，但也可以使用免费的“ [Bat To Exe 转换器](http://www.f2ko.de/programs.php?lang=en&pid=b2e)”。
这样，您的用户将看到带有您想要的任何自定义图标的标准 EXE。另外，您可以将其配置为不可见，因此甚至不会有最小化的 CMD 框。

# nhibernate - NHibernate N+1 选择：架构解决方案？

> ID：670973
> 
> 赞同：1
> 
> 时间：2009-03-22T13:01:51.127
> 
> 标签：nhibernate, architecture

考虑以下“数据库”：

```
Post -> User 
```

实体：

```
class User
{
    public virtual string Name { get; set; }
    public virtual IList<Post> Posts { get; set; }
}

class Post
{
    public virtual string Title { get; set; }
    public virtual User Author { get; set; }
} 
```

以及以下服务层：

```
class UserService
{
    IRepositoryUsers repositoryUsers;

    IList<User> GetUsers()
    {
        return this.repositoryUsers.GetAllUsers();
    }
} 
```

当我想打印所有用户以及相关的帖子计数时，我得到（这里毫不奇怪）一个 N+1 选择问题，对于每一行，它将创建一个选择来获取用户的帖子。

现在这是我的问题：处理这个问题的“最佳”方法是什么，因为在某些情况下我不想急切地加载每个用户的帖子。

我应该在我的存储库（和服务）中创建尽可能多的方法来匹配这些场景吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T13:11:00.027

一般来说，有几种方法可以解决 Select N+1 问题。对于 NHibernate，我最喜欢的方法之一是使用 Criteria API，它非常明智且经过深思熟虑。

```
session.CreateCriteria(typeof(Fruit))            // Get me some fruit.
    .SetFetchMode("CitrusType", FetchMode.Eager) // Just get this one field.
    .Add(Expression.Eq("Basket", 47))            // Only fruit that are in this basket.
    .List();                                     // Get 'em all. 
```

要了解有关此策略和其他策略的更多信息，我建议您查看这篇[有趣的博客文章](http://ayende.com/Blog/archive/2006/05/02/CombatingTheSelectN1ProblemInNHibernate.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T23:08:33.040

您可以做的一件事是为需要检索数据的每个场景制定一个获取策略。这篇[博](http://www.codeinsanity.com/2009/02/fetching-strategy-and-adaptive-domain.html)文解释了此类问题的可能解决方案，作者使用他自己的 IRepository 版本，但您在存储库中使用相同的想法（或查看他的[NCommon](http://ncommon.codeplex.com/)项目以获得一些灵感）

# sql - 与交叉连接相比，内连接的性能

> ID：670980
> 
> 赞同：61
> 
> 时间：2009-03-22T13:06:13.503
> 
> 标签：sql, performance

发出内部连接的效果与使用 WHERE 子句中的连接条件声明交叉连接的效果相同。我注意到我公司的很多人都使用交叉联接，而我会使用内部联接。在更改其中一些查询后，我没有注意到任何显着的性能提升，我想知道这是否只是巧合，或者 DBMS 是否透明地优化了这些问题（在我们的例子中是 MySql）。这里有一个具体的讨论例子：

```
SELECT User.*
FROM User, Address
WHERE User.addressId = Address.id;

SELECT User.*
FROM User
INNER JOIN Address ON (User.addressId = Address.id); 
```

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-03-22T13:36:09.377

交叉连接产生的结果由来自两个或多个表的行的每个组合组成。这意味着如果表 A 有 6 行，表 B 有 3 行，则交叉连接将产生 18 行。这两个表之间没有建立关系——你实际上只是产生了所有可能的组合。

使用内部联接，表中一行的列值与另一个（或同一个）表的另一行中的列值组合形成单行数据。

如果将 WHERE 子句添加到交叉连接，则它的行为类似于内部连接，因为 WHERE 施加了限制因素。

只要您的查询遵守常识和供应商特定的性能指南 (i)，我喜欢将决定使用哪种类型的连接作为一个简单的品味问题。

*(i) 供应商特定绩效指南*

1.  [MySQL 性能调优和优化资源](https://www.mysql.com/why-mysql/performance/index.html)
2.  [PostgreSQL 性能优化](https://wiki.postgresql.org/wiki/Performance_Optimization)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-22T13:14:25.137

除了内部连接更清晰之外没有其他区别，因为它定义了连接，将 where 子句作为实际的限制条件。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-03-22T13:13:55.933

使用[EXPLAIN](http://dev.mysql.com/doc/refman/5.1/en/explain.html)查看两个查询的查询计划，看看是否有任何区别。MySQL 很可能在这两种情况下都使用相同的执行计划。我使用[INNER JOIN](http://dev.mysql.com/doc/refman/5.1/en/join.html)语法主要是因为它更清晰。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-25T10:39:11.320

我发现允许第一种语法（逗号分隔表）的工作场所往往会花费大量时间来调试返回的行数多于预期的情况。无意的交叉连接是系统的祸根，甚至可以使最优化的数据库崩溃。去年，它至少两次使我们的预生产系统戛然而止。

第二种语法（连接语法）迫使作者首先考虑如何将表连接在一起，然后只返回感兴趣的行。使用这种语法不可能意外地进行交叉连接，从而降低了意外执行不良查询的危险。

然而，抛开这个问题不谈，我从未注意到在我拥有的任何系统中这两种语法之间的速度差异。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-23T15:22:09.220

第一个示例在功能上与第二个示例相同。但是，出于几个原因，应该避免使用这种语法。首先，使用此语法时更容易意外获得交叉连接，尤其是当表中有多个连接时。如果您看到很多带有关键字 distinct 的此类查询，则可能有人正在尝试修复交叉连接。

接下来，不推荐使用旧样式的左右连接语法，不再支持。此外，它现在无论如何都不能正常工作。有时它会误解外连接并返回错误的结果集。因此，您在 where 子句中使用*= 或 =*的任何查询都应立即被替换。

第三，ANSI 标准连接更易于理解和维护。对连接的理解是任何查询任何关系数据库的人都需要具备的最关键的基本技能之一。根据我的经验，一些使用旧样式的人并不真正了解连接及其工作方式，因此编写的查询实际上并没有达到他们的预期。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-06-20T22:18:59.223

SQL Server 说“当 WHERE 将交叉连接变为内部连接时”，所以没有区别。 [http://msdn.microsoft.com/en-us/library/ms190690.aspx](http://msdn.microsoft.com/en-us/library/ms190690.aspx)

我做了 SQL 服务器“执行计划”，性能是一样的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-08-05T09:06:26.237

解释两个查询给出相同的输出

```
mysql> explain select * from t T1, t T2 where T1.ID=T2.ID;
+----+-------------+-------+------+---------------+------+---------+------+------+--------------------------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                          |
+----+-------------+-------+------+---------------+------+---------+------+------+--------------------------------+
|  1 | SIMPLE      | T1    | ALL  | PRIMARY       | NULL | NULL    | NULL |    3 |                                |
|  1 | SIMPLE      | T2    | ALL  | PRIMARY       | NULL | NULL    | NULL |    3 | Using where; Using join buffer |
+----+-------------+-------+------+---------------+------+---------+------+------+--------------------------------+
2 rows in set (0.00 sec)

mysql> explain select * from t T1  join t T2 on T1.ID=T2.ID;
+----+-------------+-------+------+---------------+------+---------+------+------+--------------------------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                          |
+----+-------------+-------+------+---------------+------+---------+------+------+--------------------------------+
|  1 | SIMPLE      | T1    | ALL  | PRIMARY       | NULL | NULL    | NULL |    3 |                                |
|  1 | SIMPLE      | T2    | ALL  | PRIMARY       | NULL | NULL    | NULL |    3 | Using where; Using join buffer |
+----+-------------+-------+------+---------------+------+---------+------+------+--------------------------------+
2 rows in set (0.00 sec) 
```

但最好使用内连接语法，因为它更清晰、更精确。与交叉连接相比，Mysql 可以在内部调整左右连接查询以选择更少的数据。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-22T13:50:10.417

加入表格或放置 ON / WHERE 条件的顺序无关紧要。

查询优化器无论如何都应该优化和使用最佳顺序（并选择如何最好地过滤数据、从哪里开始等）

和其他许多人一样，我建议使用 INNER JOIN 语法，因为它使事情更具可读性，使用 LEFT 或 FULL 连接的语法也更加透明。

这里有更多关于它的详细文字：http: [//linus.brimstedt.se/](http://linus.brimstedt.se/?/article/articleview/SQL) ?/article/articleview/ SQL Syntax

/乙

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-04-27T19:43:48.510

第一种语法的另一个好处是您可以在限制条件下更加通用。不仅仅是平等。

但是如果你使用相等，为什么要相信优化器呢？确保它不会首先生成交叉连接然后消除行。使用第二个。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-09-03T12:16:14.890

带有 where 子句的交叉连接和内部连接之间没有太大区别，它们可能是相同的，但是使用内部连接我们会减少代码中的某些部分。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2011-06-20T22:55:50.293

从一开始，优化器就围绕经典的限制项目笛卡尔乘积语法构建。几乎所有的供应商都复制了 System R 开创的设计。然后，供应商不情愿地采用了“最新最好的”ANSI 语法并改进了他们的 SQL 执行引擎。与营销手册告诉您的相反（“使用最新语法”），物理实现级别没有太大变化：它仍然是 [indexed] 嵌套循环，或散列或排序合并连接。因此，假设一种语法优于另一种语法是没有根据的。

就我个人而言，新语法是[多余](http://postgresql.1045698.n5.nabble.com/how-to-do-deep-queries-td2143626.html)的、嘈杂的和[不一致](http://vadimtropashko.wordpress.com/2011/03/02/ansi-join-syntax/)的。至于被委员会批准，“走进每个城市的任何公园，你都找不到委员会的雕像”。

# java - 如何实时生成简单的二维图形？

> ID：670986
> 
> 赞同：0
> 
> 时间：2009-03-22T13:09:11.687
> 
> 标签：java, c, real-time, frequency

对于我在脑机接口方面的实习，我需要在 CRT 显示器上生成一些非常快速闪烁的方块（闪烁 = 在两种颜色之间交替）。显示器的刷新率为 85Hz，我们希望这是瓶颈，这意味着重新绘制所有方块最多需要 1000/85 = 11ms。

我对 GUI/图形编程的偏好语言是 Java，所以我尝试使用 AWT 制作原型，因为它是同步的（与 Swing 不同）。我现在似乎有两个问题：第一个是时间测量表明，即使是 9 个方格的重新绘制也需要太长时间。我的算法采用所需的频率并计算系统应该提前重新绘制的时间，然后使用一个循环（没有睡眠/等待延迟）检查每次是否达到下一个“时间”，如果是，则循环遍历所有方格来重新粉刷它们。我现在实现它的方式是，正方形是背景颜色为 A 的面板，并包含在另一个背景颜色为 B 的面板中，并且闪烁发生是因为面板的可见性发生了变化。我认为这比一个必须一直绘制矩形的面板要快。我没有像样的分析工具（无法让 Eclipse TPTP 或 NetBeans 分析器工作），所以我不能确定，但​​我觉得瓶颈实际上不在重绘中，而是在循环中（有条件检查等）。你能推荐一些关于我应该做什么的事情吗？

第二个问题是，正方形似乎是从上到下渲染的。就好像它们展开得非常快，但仍然很明显。这是无法接受的。我想知道的是，是什么原因造成的。是 Java/AWT 还是 Windows，或者只是我编写了一个慢速算法？

你能推荐一些东西给我试试吗？我更喜欢使用 Java，但如果必须，我会使用 C（或其他东西）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T13:17:25.940

我会避免使用任何类型的高级“组件”，例如 JPanels 等。尝试获取一个表示窗口内容的 Graphics2D，并使用它的`fillRect()`方法。

如果做不到这一点，您可能可以在 C 和 OpenGL 中轻松做到这一点。[rasonly.c](http://www.opengl.org/resources/code/samples/glut_examples/advanced/rasonly.c)是一个标准模板程序，它将OpenGL 设置为仅作为“光栅化器”工作，即2D 模式。以此为起点，您应该能够运行一些东西来绘制您想要的“正方形”，而不会有太多麻烦。

你没有很好地描述你想要的场景，从那个等式听起来好像你想画 100 个正方形，每个正方形都有不同的颜色。为了在 OpenGL 中获得最佳性能，您应该将所有相同颜色的方块绘制在一起，以最大限度地减少绘图调用之间的“状态变化”。不过，这可能是纯粹的理论观点，因为在 85 Hz 下绘制 100 个 2D 正方形确实不应该对 OpenGL 征税。

*更新*：哦，已经有很多年了，现在你可能需要对上述内容持保留态度并阅读一些现代教程。事情变了。查找[Vulkan API](https://www.khronos.org/vulkan/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T13:18:30.167

（我记得使用 BBC 微型和调色板切换的演示，虽然那将是 50fps 而不是 85，因为它是英国国内电视）

我会切换到[jogl](https://jogl.dev.java.net/)并使用显示列表。他们在 Java 中获得了非常高的 fps 速率。

# java - 在 Android 上运行 Java 字节码 - 基于 DalvikVM 的 Sun JVM

> ID：670987
> 
> 赞同：18
> 
> 时间：2009-03-22T13:09:54.633
> 
> 标签：java, android, clojure, jvm

由于 java 实现 ( `OpenJDK`) 和 Android 的虚拟机 DalvikVM 都是开源的，因此必须可以在 Google 的 DalvikVM 上实现 Sun 的 JavaVM。这将使`Clojure, Jython`在 android 上开箱即用地运行基于 JVM 的应用程序和语言 ( ) 成为可能。

是否有持续的努力来产生这样的 Sun JVM 实现？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-22T16:07:40.977

OpenJDK 使用本机代码，因此它是一个重要的端口……至少有一个用 Java 编写的 VM ( [JikesRVM](http://jikesrvm.org/) )，不幸的是它不是一个完全可用的 Java 实现。

由于 DalvikVM 运行从 .class 文件转换的类，因此应该可以转换这些类。那么“唯一”的问题是当语言动态生成字节码时——因为它需要在程序在 DalvikVM 上运行时将生成的字节码转换为 DalvikVM 格式的额外步骤。

嗯.... 一种 JITT（即时翻译器），可在手机运行时将类文件转换为 DalvikVM 文件。我想知道那会有多慢。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-09-29T10:23:52.000

将 OpenJDK 移植到 Android 平台是可能的。有这样的努力：Shark、Zero 和 caciocavallo，它们极大地简化了端口过程（= 没有 ASM，简单的 AWT 对等体）。此外，Android 只不过是一个 linux 内核。唯一的问题是任何人什么时候完成？

顺便说一句，iphone 和 android 手机都安装了 Jazelle 兼容的处理器，非常欢迎具有非常强大的处理器黑客技能的人将 Jazelle 支持添加到 OpenJDK。这样做，我们可以选择：非常轻的资源加速 (Jazelle) 和 JIT ;-)

关于 iPhone，也是一样的：端口是可能的。只有 Apple 在 iPhone 许可证中加入了明确禁止使用 VM 的部分。根据欧洲法律，对我来说，这个许可证部分是非法的。两个原因：您不能强制/链接购买您的两种产品。在这里，我调音和 Iphone 是链接的。你不能拒绝卖你能卖的东西。在这里，一旦为 iPhone 构建了 VM，如果它被拒绝放入 iTune 商店，那么这一点将适用。世界上有没有人想挑战苹果许可的合法性？我不这么认为，不开心的人会飞到 Android 或任何其他平台。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T16:57:18.033

与此同时，我找到了一个可能的解决方案（仅限 JavaME）：

*   “ [MicroEmulator](http://www.microemu.org/)是 Java SE 中 Java ME 的纯 Java 实现。”
*   [在 Android 上运行 Java ME 应用程序](http://microemu.blogspot.com/2008/11/running-java-me-applications-on-android.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-24T00:14:00.610

从技术上讲，应该可以解释 dalvik vm 上的热点字节码或 dalvik 在热点上的字节码，但从长远来看，它永远不会是高效的（更不用说优雅的）设计。这样做的成本可能会变得非常高，尤其是在这种分裂的生态系统的未来演变中的维护方面。

我认为，从一开始，dalvik vm 就是权力/市场控制问题，而不是改进 Java 虚拟机生态系统的创新努力。dalvik vm 和hotspot vm 是横跨同一条河流的两座高速公路桥，彼此平行，相距五米。它分裂并给Java技术生态系统带来混乱。

在我看来，谷歌绝对是在过去十年中做出创新贡献的技术领导者，使保守得多的预言机相形见绌，但在这个主题上，他们几乎以破坏性的方式动摇了 Java 生态系统。我们（程序员）应该为这个问题争取一个统一的解决方案。无论如何，这就是“虚拟机”概念背后的主要思想——它既不属于谷歌也不属于甲骨文。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-05T12:08:18.130

尝试使用 debian Wheezy 的 GNURoot 应用程序（proot ptrace 容器）；
apt-get update
apt-get install openjdk-7-jre
/usr/lib/jvm/java-7-openjdk-armel/jre/bin/java ...
（包括长路径）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-22T13:14:46.243

我不认为问题是技术问题。例如，理论上您可以将 OpenJDK 迁移到 iPhone，但存在法律限制。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-31T19:12:20.393

有关Android ARM apk 的 MIDP、Foundation 和 Personal Profile jvms，请参见[http://davy.preuveneers.be/phoneme/ 。](http://davy.preuveneers.be/phoneme/)（谢谢戴维！！！）

我已经重新打包了 Foundation jvm 以供命令行使用，并将其托管在 vkfox.com/android/bin/foundation-jvm.bin 以供您使用。可以使用 JavaIDEdroid 免费应用程序中的 eclipse 编译器，或带有此 jvm 的旧 kopi 或 kopisusu 编译器，以及来自 J2ME jdk 的存根 cdc + 基础 jar 文件，用于板载开发系统。使用 TerminalIDE 的功能——控制台和 sun 编译器——以及指定的 ref jar 也可以帮助您实现目标。这本质上等同于带有 MIDP 或 awt 图形可能性的无头 jdk1.4。

# asp.net - 这将如何在 ASP.NET MVC 中完成？

> ID：670991
> 
> 赞同：2
> 
> 时间：2009-03-22T13:11:13.833
> 
> 标签：asp.net, asp.net-mvc, webforms

我对 ASP.NET MVC 有一些经验，但仅限于母版页内容不变的 Web 应用程序。我一直想知道您将如何处理一个站点，例如从数据库加载菜单（位于母版页上）的站点。你会在哪里加载这些数据？

在 WebForms 中，您可以在母版页的代码隐藏中加载菜单，或者将菜单作为用户控件并在其代码隐藏中进行加载。但是这在 MVC 中是在哪里完成的呢？

您是否创建了一个继承自`Controller`您用于所有控制器的类并让它在每次操作调用时加载菜单（我不知道这是否可能，但似乎有可能）？

或者您是否创建了一个实用程序方法，在您想要的每个操作中调用它（因为某些操作可能只返回不会重新加载菜单的部分视图），这虽然不是灾难性的，但似乎有点令人厌烦。

还是您会违反 MVC 并将其加载到母版页的代码隐藏中？

最好的方法是什么（当然不限于我的解决方案）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T13:21:20.080

`ActionFilter`s 用于拦截请求并做一些处理。你可以使用它们。

*这是对 MVC 模式的一种罪过吗？*

你在某种程度上打破了 MVC 模式。但更高层次的一点是：如果你强迫自己不打破它，它会提供更多的价值吗？我认为这不会给您带来太多麻烦，因此请牢记简单性和可维护性，并选择在您的特定情况下执行此操作的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T13:21:40.643

我将创建一个模型类型，母版页从中获取数据。然后从 MasterModel 派生页面的模型类型。

控制器填充 PageModel 的一个实例，并且母版页将其拾取。

（或者，母版页的模型可以是页面模型实现的接口。）

注意。在 MVC CTP 中，这样做需要一些中间类来覆盖类型匹配以获取基类数据。我不知道这是否已在 RTM 中修复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T07:10:54.457

ASP.NET MVC Futures 程序集（[更多信息在这里](http://weblogs.asp.net/scottgu/archive/2008/10/16/asp-net-mvc-beta-released.aspx#ten)）包含一个扩展方法，可让您在母版页中执行此操作：

```
<% Html.RenderAction<NavigationController>(c => c.Show()); %> 
```

您需要引用程序集并在您的 web.config 文件中添加“Microsoft.Web.Mvc”命名空间才能使其正常工作。*******