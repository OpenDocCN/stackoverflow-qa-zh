# StackOverflow 问答 000153000-000153999

# rest - ADO.Net 数据服务如何支持 POST 不是创建的东西？

> ID：153019
> 
> 赞同：0
> 
> 时间：2008-09-30T13:27:52.157
> 
> 标签：rest, wcf-data-services

从我目前阅读的文档来看，ADO.Net 数据服务被定位为以 RESTful 方式向数据库中的表公开类似 CRUD 的接口的方式。这对于只执行这四个操作的应用程序来说非常有用，但是执行更多操作的应用程序呢？

打印、批准、提交、复制、转移、处理、计算等动词呢？

RESTful 应用程序中的常用方法是创建可以与之交互的新资源以执行这些附加请求。例如，创建可以发布以执行打印操作的打印机资源。但是，这些资源不一定映射到数据库中的表或视图。

ADO.Net 数据服务如何处理这些不映射到表的资源？例如，假设您正在计算工资单并且您创建了一个端点 /PayrollService/PayCalculator。发布包含一些员工信息及其总工资的实体将指示 PayCalculator 资源返回员工福利和扣除额。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-02T22:58:35.233

数据服务可以公开您在其上实现 IQueryable 和可选的 IUpdateable 的“任何”对象图。对象不需要以任何方式映射到数据库。这应该做你正在寻找的。看看这个 15 分钟的视频[http://channel9.msdn.com/posts/mtaulty/ADONET-Data-Services-VS08-Sp1-B1-Surfacing-Data/](http://channel9.msdn.com/posts/mtaulty/ADONET-Data-Services-VS08-Sp1-B1-Surfacing-Data/)

如果您愿意，您还可以实现服务操作 - 方法。好的 - 不是那么 RESTful 但方便且容易做到。看看这个 7 分钟的视频[http://channel9.msdn.com/posts/mtaulty/ADONET-Data-Services-VS08-Sp1-B1-Service-Operations/](http://channel9.msdn.com/posts/mtaulty/ADONET-Data-Services-VS08-Sp1-B1-Service-Operations/)

# c# - 如何使用类似于 ASP.NET 的模板创建 XML 文件

> ID：153021
> 
> 赞同：1
> 
> 时间：2008-09-30T13:28:31.033
> 
> 标签：c#, asp.net, xml

我需要在 C# 中生成一个 XML 文件。

我想在一个主要是 XML 的文件中编写生成此代码的代码，其中包含代码，就像在 ASP.NET MVC 页面中一样。

所以我想要一个看起来像这样的代码文件：

```
<lots of angle brackets...>

  <% foreach(data in myData)
     { %>

     < <%= data.somefield %>

  <% } %>

More angle brackets> 
```

这将生成我的 XML 文件。`System.Web`如果有人告诉我如何在没有 IIS 开销或混淆生成的 Web 文件的情况下做到这一点，我不介意使用其中的一部分。

**我想使用模板，我想要类似于 ASP.NET 的模板**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T14:14:24.870

首先，使用 XElements 生成 XML 要容易得多。周围有很多例子。只需搜索“Linq to XML”。

或者，如果您绝对需要做模板，我建议使用模板引擎，例如[NVelocity](http://sourceforge.net/projects/nvelocity/)，而不是试图将 ASP.NET 混为一谈。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T14:49:53.553

除上述内容外 - 使用 Linq 提供的新 XML 类 - 它们使以逻辑方式生成 XML 变得更加容易，尽管您不会陷入类似于 C# 中的模板的内容。

如果你真的需要像这样的模板——而且我知道这不一定会顺利——你应该看看在 VB.NET 中做系统的这一部分，它*确实*支持像 XML 生成这样的模板作为它的一部分Linq to XML 实现。至少你应该先看看 VB.NET 提供了什么，然后再放弃它。

.NET 的性质意味着您不必将 VB.NET 用于其他任何事情，您可以将其限制为生成 XML 所需的类及其随 .NET 一起提供的“通用”。 NET 和周围的逻辑应该是任何有能力的 .NET 程序员都能理解的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-30T14:08:21.967

在标准 ASPX 文件中创建一个 PageView，但不要包含母版或其他任何内容。只需开始放入尖括号和其他所有内容。您需要做的一件事是设置内容类型。但这可以通过调用 Response.ContentType = "text/xml"; 在您的操作中完成。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-30T14:08:38.300

这里有一个 MvcContrib 中的 XSLT 视图：http: [//mvccontrib.googlecode.com/svn/trunk/src/MvcContrib.XsltViewEngine/](http://mvccontrib.googlecode.com/svn/trunk/src/MvcContrib.XsltViewEngine/)

这可能会给你你需要的东西。

（实际上，任何视图引擎都可以工作……尽管 WebForms 视图引擎会抱怨您正在编写的内容不是有效的 HTML。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-30T14:18:51.660

从代码中执行此操作的最简单方法是使用 System.Xml 中的[XMLWriter](http://msdn.microsoft.com/en-us/library/system.xml.xmlwriter.aspx)类。

教程[在这里](http://msdn.microsoft.com/en-us/library/4d1k42hb.aspx)。

```
XmlWriterSettings settings = new XmlWriterSettings();
settings.Indent = true;
settings.IndentChars = ("    ");
using (XmlWriter writer = XmlWriter.Create("books.xml", settings))
{
    // Write XML data.
    writer.WriteStartElement("book");
    writer.WriteElementString("price", "19.95");
    writer.WriteEndElement();
    writer.Flush();
} 
```

# ms-jet-ace - 使用 Microsoft.Jet.OLEDB.4.0 从 C# 将行插入 Access db，自动编号列设置为零

> ID：153023
> 
> 赞同：0
> 
> 时间：2008-09-30T13:29:12.717
> 
> 标签：ms-jet-ace, autonumber

我正在使用 C# 和 Microsoft.Jet.OLEDB.4.0 提供程序将行插入 Access mdb。

是的，我知道 Access 很糟糕。这是一个巨大的遗留应用程序，其他一切正常。

该表有一个自动编号列。我插入行，但自动编号列设置为零。

我用谷歌搜索了这个问题并阅读了我能找到的关于这个主题的所有文章。有人建议为自动编号列插入 -1，但这不起作用。我能找到的其他建议都没有奏效。

我使用的是 OleDbParameter，而不是连接一个大的 SQL 文本字符串。

我已经尝试过有交易和没有交易的插入。没有不同。

如何让这个插入工作（即正确设置自动编号列内容）？

首先十分感谢，

亚当莱弗特

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T14:16:59.847

在 Access 中，可以将显式值插入 IDENTITY（又名 Automnumber）列。如果您（或您的中间件）将值零写入 IDENTITY 列并且 IDENTITY 列没有唯一约束，那么这可能会解释它。

为了清楚起见，您应该使用语法

```
INSERT INTO (<column list>) ... 
```

并且列列表应该省略 IDENTITY 列。Jet SQL 将允许您省略整个列列表，但随后隐式*包含*IDENTITY 列。因此，您应该使用 INSERT INTO () 语法显式省略 IDENTITY 列。

在 Access/Jet 中，您可以将显式值写入 IDENTITY 列，在这种情况下，该值显然不会自动生成。因此，请确保您和您的中间件（ADO.NET 等）都没有将零值显式写入 IDENTITY 列。

顺便说一句，下表中的 IDENTITY 列将每秒自动生成零值 INSERT：

```
CREATE Table Test1 
(
   ID INTEGER IDENTITY(0, -2147483648) NOT NULL, 
   data_col INTEGER
); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T13:35:39.033

进行插入时，您需要确保没有为 AutoNumber 列指定值。就像在 SQL Server 中一样，您不会为标识列插入值。

# sql-server-2005 - SQL Server Management Studio 2005“记住密码”不起作用

> ID：153033
> 
> 赞同：2
> 
> 时间：2008-09-30T13:33:13.017
> 
> 标签：sql-server-2005, ssms

伙计们，

我通过 SQL Server Management Studio 2005 连接到大量 SQL Server 2005 数据库。我经常勾选“记住密码”，但下次尝试连接时实际上并没有记住它。你有过这样的经历吗？任何解决方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T13:46:09.663

根据[错误报告](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=124842)，这是一个已知问题，仍未修复，也没有解决方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-20T15:59:10.837

这是我使用过的解决方法。这很蹩脚，但在没有真正修复的情况下，这对我有用！

为服务器添加另一个**主机名**。这方面的一个例子是，如果你想让它记住“ ***coolserver1*** ”的名称，然后为自己创建一个解析到同一服务器但名称不同的主机名，可能是“ ***mycoolserver*** ”或类似的名称。

您可以通过向您的主机文件 (c:\windows\system32\drivers\ets\hosts) 添加一个条目，或者通过一些 DNS 或其他 Windows/AD 技巧来做到这一点。关键是您现在可以通过新的“名称”来寻址该服务器。

然后，在连接对话框中使用该新名称以及您的姓名/密码，然后点击“记住我”复选框，它真的会记住您:)

享受！

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-30T13:48:24.963

这也发生在我身上，但当我连接到不同的服务器时最值得注意。如果您每次都连接到同一台服务器，那么它应该每次都记住您的密码。

也许有一天，也许是 SP3，Microsoft 会针对这种持续存在的烦恼发布一个很好的修复程序。

# ms-access - 如何在 Access 表单上使外键组合框用户友好？

> ID：153035
> 
> 赞同：1
> 
> 时间：2008-09-30T13:33:47.447
> 
> 标签：ms-access, forms, user-interface

我有两张桌子：

```
Employees:
uid (number) | first_name (string) | last_name (string) | ...

Projects:
uid | project_title (string) | point_of_contact_id (FK: Employees.uid) | ... 
```

我想为带有“联系点”组合框（下拉）字段的项目创建一个表单。显示值应该是“first_name last_name”，但支持数据是 UID。如何设置表单以向用户显示一件事并将另一件事保存到表中？

我可以只显示一个字段（例如“first_name”），因为我可以创建一个带有 full_name 字段的视图。

*之后：*

如果有办法在表设计级别执行此操作，我更愿意这样做，因为那时我只需要为每个 UID 列设置一个设置（并且有*很多*表），而不是每个 UID 字段一个设置（并且有有*许多*表格，每个表格都有几个 UID 字段）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T13:40:31.130

将下拉框的rowsource设置为“select uid,first_name,lastname from tablename'并将columnwidth设置为0。这样第一列的宽度设置为零，因此用户看不到它。（您可以提供其他列的宽度用分号分隔，即：0cm;4cm;4cm)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T15:49:57.760

要扩展 Loesje 的答案，您可以在显示多个字段时使用 Bound Column 属性以及 Column Count 和 Column Widths ，以便您可以告诉 Access 应该将哪个字段写入数据库。（还有其他方法可以使用 VBA 执行此操作，但这应该适用于您的特定情况。）

在您的情况下，将 Row Source 设置为`select uid, first_name, last_name from tablename`意味着您的 Bound Column 应该是 1，对于您的 Row Source (uid) 中的第一列。这是默认值，因此如果您想保存来自不同字段的值，您只需要更改它。（例如，如果您想从上面的 Row Source 中保存 last_name，您可以将 Bound Column 设置为 3。）

不要忘记，在设置要显示的其他列的宽度时，组合框的 Width 属性应该大于或等于列宽之和，否则可能看不到所有列。

没有办法在表级别指示基于该表的表单需要提取特定列，或者特定列是外键，但您可以将组合框复制到其他表单，它将携带所有它的属性与它。如果对您有帮助，您还可以复制行源查询并将其粘贴到其他组合框中。

# javascript - ASP.NET MVC 客户端验证

> ID：153039
> 
> 赞同：5
> 
> 时间：2008-09-30T13:35:02.157
> 
> 标签：javascript, asp.net-mvc, validation, client-side

我一直在使用 ASP.NET MVC，但我希望改进的领域之一是客户端验证。

我知道最新版本（Preview 5）有很多新的验证功能，但它们似乎都是在页面发布之后。

我看过[Steve Sanderson](http://blog.codeville.net/2008/04/30/model-based-client-side-validation-for-aspnet-mvc/)的一篇有趣的文章……使用 Live Validation、Castle.Components.Validator.dll 和他制作的 Validator 框架。

我在我的项目中使用过它，但我希望它能够集成到官方的 ASP.NET MVC 版本中。我绝对认为业务规则应该驻留在模型或控制器而不是视图中。

你们中有人用过类似的方法吗？

你知道这样的东西被添加到官方 ASP.NET MVC 版本中了吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-01T14:39:04.833

*“很明显，您仍然需要在服务器端验证您的输入，以便为一小部分禁用 javascript 的用户。”*

只是对此评论的更新。服务器端验证与禁用 JavaScript 的用户无关。相反，出于安全原因需要它，并执行无法在客户端完成的复杂验证。表单应始终具有服务器端验证。客户端验证只是为了方便。

恶意用户可以轻松地将数据发布到您的表单，而绕过您已进行的任何客户端验证。**永远不要相信输入数据！**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T23:13:47.913

我同意其他海报，客户端验证严格用于改善用户体验。

查看[JQuery 验证](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)插件。从基本验证开始非常容易——实际上是一行 JS 加上向输入控件添加类名。它也非常强大。你可以扩展做任何你想做的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T13:45:29.900

LiveValidation 是另一个有用的 JavaScript 库，可以提供帮助。在此处查看示例（使用 ASP.NET MVC）：

[http://blog.codeville.net/2008/09/08/thoughts-on-validation-in-aspnet-mvc-applications/](http://blog.codeville.net/2008/09/08/thoughts-on-validation-in-aspnet-mvc-applications/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T11:49:09.137

看看[这篇博客文章](https://devermind.wordpress.com/2009/06/21/asp-net-mvc-tip-3-how-to-cover-all-your-client-side-form-validation-needs-without-writing-any-javascript-part1/#comments)。它描述了如何使用 xVal 自动生成客户端验证规则，以及如何自动实现远程客户端验证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-03T16:28:08.653

看起来这个领域将在 ASP.NET MVC 2 中看到很多改进

> [http://weblogs.asp.net/scottgu/archive/2009/07/31/asp-net-mvc-v2-preview-1-released.aspx](http://weblogs.asp.net/scottgu/archive/2009/07/31/asp-net-mvc-v2-preview-1-released.aspx)

# c++ - 从我的应用程序启动网页

> ID：153046
> 
> 赞同：10
> 
> 时间：2008-09-30T13:37:45.660
> 
> 标签：c++, c, windows, browser

好的，这可能有一个非常简单的答案，但我以前从未尝试过这样做：如何从应用程序中启动网页？您知道，“单击此处转到我们的常见问题解答”，当他们这样做时，它会启动他们的默认 Web 浏览器并转到您的页面。我在 Windows 中使用 C/C++ 工作，但如果有更广泛、更便携的方式来做这件事，我也想知道。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-30T13:42:17.210

```
#include <windows.h>

void main()
{
   ShellExecute(NULL, "open", "http://yourwebpage.com",
            NULL, NULL, SW_SHOWNORMAL);
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T13:39:37.450

我相信你想使用 ShellExecute() 函数，它应该尊重用户对默认浏览器的选择。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T14:51:40.083

请仔细阅读 ShellExecute 的[文档](http://msdn.microsoft.com/en-us/library/bb762153.aspx)。为了真正保护您的代码，他们建议初始化 COM。请参阅此处的文档，并查找“COM 应按此处所示进行初始化”的部分。简短的回答是这样做（如果你还没有初始化 COM）：

CoInitializeEx（NULL，COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-07-01T10:14:49.400

作为记录（因为您要求跨平台选项），以下在 Linux 中运行良好：

```
#include <unistd.h>
#include <stdlib.h>

void launch(const std::string &url)
{
  std::string browser = getenv("BROWSER");
  if(browser == "") return;

  char *args[3];
  args[0] = (char*)browser.c_str();
  args[1] = (char*)url.c_str();
  args[2] = 0;

  pid_t pid = fork();
  if(!pid)
    execvp(browser.c_str(), args);
} 
```

用于：

```
launch("http://example.com"); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T13:42:47.130

您可以使用 ShellExecute 函数。示例代码：

```
ShellExecute( NULL, "open", "http://stackoverflow.com", "", ".", SW_SHOWDEFAULT ); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-05-19T12:34:56.410

出于某种原因，如果应用程序在调用后立即终止，ShellExecute 有时不起作用。我们在 ShellExecute 之后添加了 Sleep(5000)，它会有所帮助。

# c# - 如何用静态方法模拟？

> ID：153048
> 
> 赞同：35
> 
> 时间：2008-09-30T13:38:53.770
> 
> 标签：c#, .net, mocking, interface, static-methods

我是模拟对象的新手，但我知道我需要让我的类实现接口才能模拟它们。

我遇到的问题是，在我的数据访问层中，我想要静态方法，但我不能将静态方法放在接口中。

解决这个问题的最佳方法是什么？我应该只使用实例方法（这似乎是错误的）还是有其他解决方案？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-30T13:43:50.963

是的，您使用实例方法。静态方法基本上是说，“有一种方法可以完成这个功能——它不是多态的。” 模拟依赖于多态性。

现在，如果您的静态方法在逻辑上不关心您正在使用什么实现，它们可能能够将接口作为参数，或者可能在根本不与状态交互的情况下工作 - 但否则您应该使用实例（并且可能依赖注入将所有东西连接在一起）。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-30T13:59:48.493

我[通过谷歌找到了一个博客，里面](http://www.lnbogen.com/2007/07/04/how-to-mock-static-class-or-static-member-for-testing/)有一些很好的例子来说明如何做到这一点：

1.  将类重构为实例类并实现接口。

    你已经说过你不想这样做。

2.  对静态类成员使用带有委托的包装器实例类

    这样做，您可以通过委托模拟静态接口。

3.  使用带有受保护成员的包装器实例类，这些成员调用静态类

    这可能是最容易模拟/管理而无需重构的，因为它可以继承和扩展。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-30T13:41:55.603

我会使用方法对象模式。有一个 this 的静态实例，并在静态方法中调用它。根据您的模拟框架，应该可以子类化进行测试。

即在你的类中使用静态方法有：

```
private static final MethodObject methodObject = new MethodObject();

public static void doSomething(){
    methodObject.doSomething();
} 
```

并且您的方法对象可以是一个非常简单、易于测试的对象：

```
public class MethodObject {
    public void doSomething() {
        // do your thang
    }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-30T13:55:01.920

您可能试图在太深的起点进行测试。不需要创建测试来单独测试每个方法；私有和静态方法应该通过调用公共方法进行测试，然后依次调用私有和静态方法。

所以可以说你的代码是这样的：

```
public object GetData()
{
 object obj1 = GetDataFromWherever();
 object obj2 = TransformData(obj1);
 return obj2;
} 
private static object TransformData(object obj)
{
//Do whatever
} 
```

您不需要针对 TransformData 方法编写测试（而且您不能）。而是为 GetData 方法编写一个测试，以测试在 TransformData 中完成的工作。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-30T13:44:57.780

尽可能使用实例方法。

在无法使用实例方法的情况下，使用 public static Func[T, U]（可以替代模拟函数的静态函数引用）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T14:13:06.497

一个简单的解决方案是允许通过 setter 更改静态类的实现：

```
class ClassWithStatics {

  private IClassWithStaticsImpl implementation = new DefaultClassWithStaticsImpl();

  // Should only be invoked for testing purposes
  public static void overrideImplementation(IClassWithStaticsImpl implementation) {
     ClassWithStatics.implementation = implementation;
  }

  public static Foo someMethod() {
    return implementation.someMethod();
  }

} 
```

因此，在您的测试设置中，您`overrideImplementation`使用一些模拟接口进行调用。好处是您不需要更改静态类的客户端。缺点是您可能会有一些重复的代码，因为您必须重复静态类的方法及其实现。但有时静态方法可以使用提供基本功能的更轻的接口。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-15T18:17:43.237

The problem you have is when you're using 3rd party code and it's called from one of your methods. What we ended up doing is wrapping it in an object, and calling passing it in with dep inj, and then your unit test can mock 3rd party static method call the setter with it.

# .net - ASP.Net 移动 Web 表单发生了什么？

> ID：153051
> 
> 赞同：3
> 
> 时间：2008-09-30T13:39:45.997
> 
> 标签：.net, asp.net, mobilewebforms

以前 Visual Studio 有用于移动 Web 表单（不是移动 SDK）的模板。它们似乎在 Visual Studio 2008 中消失了，我看到的唯一解决方案是在此处从 Omar 下载一些模板：

[http://blogs.msdn.com/webdevtools/archive/2007/09/17/tip-trick-asp-net-mobile-development-with-visual-studio-2008.aspx](http://blogs.msdn.com/webdevtools/archive/2007/09/17/tip-trick-asp-net-mobile-development-with-visual-studio-2008.aspx)

这是否不再受支持，如果是，这是受支持的解决方案吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-13T13:27:16.073

我以为我会回来回答这个问题。移动表单控件仍然存在，上面非官方提供的模板是我发现的唯一可用的模板。我不确定他们为什么在 Visual Studio 2008 中取出它们。

如果没有模板，您通常只需将页面更改为从 MobilePage 而不是 Page 派生，并且您的控件从 MobileUserControl 而不是 UserControl 派生。要访问标记中的控件，请像这样引用移动命名空间：

然后您将能够像这样使用移动控件：

移动：表单，移动：文本视图 ...

这些仍然是我发现创建与旧手机和浏览器兼容的页面的唯一方法。当然，较新的手机和浏览器大部分使用标准 HTML，并且可以像任何其他 ASP.Net 页面一样创建页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T16:46:33.527

刚刚在 MSDN 上看到了一篇关于此的博客文章。MS 厌倦了为每个移动设备维护定义，并且真正推动了 ASP.NET 的开发。正如您之前所说，它们仍然受支持，但没有设计器视图。所以，他们正在走出去。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T15:23:01.257

据我所知，这还没有出现，据说它们应该包含在 VS2008 的 SP1 中，但它们没有。

由于模板的来源来自 blogs.msdn.com，我猜是的，它是当前支持构建移动目标表单的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-23T21:05:19.003

关于我是我在 VS 2005 中设计和测试我的移动表单，在那里我可以看到设计视图和所有内容。在此之后，我只需将代码复制粘贴到 VS 2008 中。我这样做是因为 VS 2008 中没有任何用于移动表单控件的模板。

# debugging - Microsoft JET SQL 查询日志或“如何调试客户的程序？”

> ID：153053
> 
> 赞同：5
> 
> 时间：2008-09-30T13:40:42.580
> 
> 标签：debugging, ms-access, vb6, jet, trace

## 问题：

我们使用我们最大的客户编写的程序来接收订单、预订运输和做其他与订单相关的事情。我们没有其他机会，只能使用该程序，当涉及到他们的程序问题时，客户非常不支持。我们只需要接受这个程序。

现在这个程序在有两个或更多用户使用时，大部分时间都非常慢，所以我试图在幕后寻找问题的根源。

## 到目前为止我发现的程序的一些要点：

*   它是用 VB 6.0 编写的
*   它使用一个受密码保护的 Access-DB (Access 2000 MDB)，它位于一个用户机器上的一个文件夹中。
*   该文件夹通过网络共享并由所有其他用户使用。
*   它使用 msjet40.dll 版本 4.00.9704 与访问进行通信。我猜是ADO？

我还使用[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)来监视文件访问，并找出程序如此缓慢的原因：即使程序处于空闲状态，它也在对 mdb 文件执行数千次读取操作。在网络上，这当然非常慢：

[进程监视器跟踪 http://img217.imageshack.us/img217/1456/screenshothw5.png](http://img217.imageshack.us/img217/1456/screenshothw5.png)

## 真正的问题：

有没有办法监控负责读取活动的查询？我可以设置跟踪标志吗？挂钩 JET DLL 的？我猜该程序正在执行一些昂贵的查询，导致 JET 在此过程中读取大量数据。

PS：我已经尝试将mdb放在我们公司的文件服务器上，成功访问它甚至比通过本地共享还要慢。我还尝试更改客户端上的锁定机制（机会锁定），但没有成功。

我想知道发生了什么，需要为我们客户的开发人员提供一些确凿的事实和建议，以帮助他/她更快地完成程序。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-23T14:11:35.840

为了让您的肮脏手确切地了解 Access 在幕后以查询方式执行的操作，有一个名为 JETSHOWPLAN 的未记录功能 - 当在注册表中打开时，它会创建一个`showplan.out`文本文件。详细信息在 [这篇 TechRepublic 文章](https://www.techrepublic.com/article/use-microsoft-jets-showplan-to-write-more-efficient-queries/) [备用](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-22-5064388.html)，总结如下：

> ShowPlan 选项已添加到 Jet 3.0，并生成一个包含查询计划的文本文件。（ShowPlan 不支持子查询。）您必须通过向注册表添加 Debug 键来启用它，如下所示：
> 
> ```
> \\HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\JET\4.0\Engines\Debug 
> ```
> 
> 在新的 Debug 键下，添加一个名为的字符串数据类型`JETSHOWPLAN` （必须全部使用大写字母）。然后，添加键值`ON`以启用该功能。如果 Access 一直在后台运行，则必须将其关闭并重新启动才能使该功能正常工作。
> 
> 启用 ShowPlan 后，Jet 每次编译查询时都会创建一个名为`SHOWPLAN.OUT` （最终可能位于您的`My Documents`文件夹或当前默认文件夹中，具体取决于您使用的 Jet 版本）的文本文件。然后，您可以查看此文本文件以获取有关 Jet 如何运行您的查询的线索。
> 
> 我们建议您通过将键的值更改为来禁用此功能，`OFF`除非您专门使用它。Jet 将计划附加到现有文件中，最终，该过程实际上减慢了速度。仅当您需要查看特定查询计划时才启用该功能。打开数据库，运行查询，然后禁用该功能。

对于追踪噩梦般的问题，它是无与伦比的——这是你在昂贵的大型工业数据库上得到的那种东西——这个功能很酷——它可爱又蓬松——它是我的朋友……;-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T22:31:26.683

你能不能在网络上扔一个数据包嗅探器（比如 Wireshark）来观察一个用户和主机之间的流量？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T22:41:03.807

如果它使用 ODBC 连接，您可以为此启用日志记录。

1.  启动 ODBC 数据源管理器。
2.  选择跟踪选项卡
3.  选择立即开始跟踪按钮。
4.  选择应用或确定。
5.  运行应用程序一段时间。
6.  返回 ODBC 管理器。
7.  选择跟踪选项卡。
8.  选择立即停止跟踪按钮。
9.  可以在您最初在“日志文件路径”框中指定的位置查看跟踪。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T21:35:13.363

第一个问题：您有 MS Access 2000 或更高版本的副本吗？

如果是这样：当您说 MDB 受“密码保护”时，您的意思是当您尝试使用 MS Access 打开它时，您只会收到输入密码的提示，还是提示您输入用户名和密码？（或者给你一条错误消息，“你没有使用 foo.mdb 对象的必要权限。”？）

如果是后者（用户级安全性），请查找与 MDB 一起提供的相应 .MDW 文件。如果你找到了，这就是“工作组信息文件”，它被用作打开MDB的“钥匙”。尝试使用以下目标创建桌面快捷方式：

```
"Path to MSACCESS.EXE" "Path To foo.mdb" /wrkgrp "Path to foo.mdw" 
```

MS Access 然后会提示您输入您的用户名和密码（希望）与 VB6 应用程序要求您输入的相同。这至少可以让您打开 MDB 文件并查看表结构，看看是否有任何明显的设计缺陷。

除此之外，据我所知，Eduardo 是正确的，您几乎需要能够在开发人员的源代码上运行调试器以准确了解实时查询在做什么......

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-03T15:24:35.997

没有开发人员的帮助是不可能的。对不起。

# c# - 有没有办法以编程方式在 Elmah 中设置应用程序名称？

> ID：153054
> 
> 赞同：14
> 
> 时间：2008-09-30T13:41:00.020
> 
> 标签：c#, asp.net, elmah

我需要根据我在 Visual Studio 中使用的配置更改应用名称。例如，如果我在调试配置中，我希望应用程序名称在 Elmah_Error 表的应用程序字段中显示为“App_Debug”。有人对这个有经验么？还是有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2012-02-17T13:46:58.623

这现在可以纯粹在标记中完成。只需在 web.config 文件部分的元素中添加一个`applicationName`属性。例子：`errorLog``<elmah>`

```
<errorLog type="Elmah.SqlErrorLog, Elmah" 
    connectionStringName="connectionString" applicationName="myApp"  /> 
```

我已经对此进行了测试，它在记录异常和通过`Elmah.axd`.

在 OP 的情况下，人们会想象它也可以通过编程方式设置，但我没有对此进行测试。对我来说，我想在大多数情况下，标记方法就足够了。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-25T14:06:06.193

默认情况下，Elmah 使用 AppPool 的应用程序 GUID 作为默认应用程序名称。当您查看通过其 HTTP 模块创建的 Web 界面时，它使用它作为识别 Elmah_Error 表中错误的关键。

今年早些时候，我的任务是为我的公司探索这个选项。`HttpRuntime.AppDomainAppId`由于 Elmah 从ErrorLog.cs 文件中提取应用程序名称，因此我无法找到一种默认操作的方法。你可以用任何你想要的键来操作它；但是，那是 AppPool 的 GUID。

话虽如此，我能够操纵 ErrorLog.cs 文件将 Elmah 转变为可调用框架，而不是基于处理程序的框架，并允许我设置 ApplicationName。我最终做的是修改 ErrorLog.cs 以包含一个允许我设置名称的属性，如下所示：

```
public virtual string ApplicationName
{
    get 
    {
        if (_applicationName == null) {  _applicationName = HttpRuntime.AppDomainAppId; }
        return _applicationName;
    }
    set { _applicationName = value; }
} 
```

您可能需要做的是以不同的方式进行调整，并将 ApplicationName 设置为`HttpRuntime.AppDomainAppId`不是从 web.config 中提取的值。总而言之，这是可能的。我这样做的方式增强了`ErrorLog.Log(ex)`方法，因此我可以使用 Elmah 有一个可调用的框架，超出了 Web 应用程序。回想起来，我希望我改为使用 app/web.config 方法。

在 Elmah 中更改应用程序名称时要记住一件事。生成 /elmah/default.aspx 接口的 http 处理程序将不再工作。我仍在努力寻找时间绕回这样的地方；但是，您可能需要在实现时考虑创建自定义接口。

# javascript - 关于如何使就地编辑可降解的任何想法？

> ID：153061
> 
> 赞同：1
> 
> 时间：2008-09-30T13:43:03.103
> 
> 标签：javascript, mootools, graceful-degradation, progressive-enhancement, edit-in-place

我目前正在为 MooTools 编写一个就地编辑脚本，但对于如何在没有 JavaScript 的情况下使其优雅地降级同时仍然具有一些功能，我感到有些困惑。我想以某种方式使用渐进增强。我不是在寻找代码，而是更多关于如何处理这种情况的概念。如果您有任何想法或知道任何优雅降级的就地编辑脚本，请分享。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T14:05:41.647

听起来你可能是从错误的方向接近这个。与其创建就地编辑并使其很好地降级（Graceful Degradation 角度），不如创建一个非 Javascript 版本进行编辑，然后在页面加载后使用 Javascript 添加就地编辑，参考作为[渐进增强](http://en.wikipedia.org/wiki/Progressive_enhancement)。

有两种选择。使用无需 Javascript 的提交按钮将显示创建为表单，然后使用 Javascript 将输入替换为执行就地编辑的某种标签。您应该能够使用标签和 id 属性的组合来选择正确的属性，以便您的就地编辑实现工作。如果您不希望默认显示表单，则另一个选项是显示带有按钮/链接的值，以便使用服务器端处理将其转换为表单，然后向其中添加即时编辑。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T13:50:54.723

如果没有 JavaScript，您根本无法进行就地编辑，因此它的优雅降级包括确保当 JavaScript 不可用时用户仍然可以编辑有问题的项目。

因此，我只需要一个链接来编辑有问题的整个项目，然后在页面加载时在 JavaScript 中创建就地编辑控件，如果您不想让用户使用就地编辑，则隐藏编辑链接有空的时候。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T13:57:40.307

如果是文本内容，您可以将可编辑内容显示为输入类型的提交按钮，并将内容作为标题。单击时，它将提交整个表单，保留其他值，并显示一个编辑对话框。之后可以恢复表单值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T13:59:00.570

也许在每个具有就地编辑的元素下的 div 中放置一个输入。当页面加载时，使用 javascript 隐藏这些 div。这样，它们只有在 javascript 永远不会触发时才可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T14:15:35.817

我假设您正在尝试做的事情类似于以下场景：

```
<li>
    <span id="editable">Editable text</span> <a class="edit_button"> </a>
</li> 
```

其中 <a> 是一个将 <span> 替换为 <input> 的按钮，以便可以对其进行编辑。有几种方法可以使其优雅地降级（即在没有 javascript 的情况下工作）。

**理论上：**

使用 CSS，使用伪选择器来完成。:active 有点像 onclick 事件，所以如果你在 <li> 中嵌套一个隐藏的 <input>，这个 CSS 会隐藏 <span> 并在点击 li 时显示 <input>。

```
李：活动#可编辑{
    显示：无；
}
李：主动输入{
    显示：块；
}

```

这可能适用于您最喜欢的浏览器，但毫无疑问，您会发现它在 IE 中出现问题。

**在实践中：**

使用链接。让 <a> 成为一个实际链接，该链接指向在服务器端完成了此输入/跨度替换的页面。您在 <a> 上粘贴一个事件处理程序，该处理程序使用 MooTools 取消拥有 JS 的人的点击事件，如下所示：

```
函数make_editable（evt）{
    var evt = 新事件（evt）；
    evt.preventDefault();
}

```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T18:16:55.667

尝试使用样式化的输入文本，并在页面加载后使用 readonly 属性将其设为只读。当点击它时，删除只读属性，然后 onblur 再次使其只读。单击“保存”按钮或 onblur 事件时发出 Ajax 请求以将数据保存在服务器中。

# shell - 在 sed/shell 中转义 < 和 >

> ID：153062
> 
> 赞同：3
> 
> 时间：2008-09-30T13:43:17.283
> 
> 标签：shell, sed, quoting

如何在 sed 中转义 '<' 和 '>' 字符。

我有一些 xml 文件需要替换标签之间的一些文本。如何转义 '>' 和 '<' 字符。

> 和 < 的问题在于它在 shell 中具有特殊含义，可以将输出重定向到文件。所以反斜杠不起作用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T13:45:09.213

行。自己发现的。使用引号。

```
$ sed -i "s/>foo</>bar</g" file 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T13:43:53.117

用反斜杠转义它们

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T13:44:18.797

只需在它们前面加上反斜杠或用单引号或双引号将它们括起来。再想一想，我认为你的问题需要更清楚。您是否尝试使用 sed 处理 XML 文件并且想要获取标签之间的内容？然后你想要：

```
sed -re 's@(<TAG.*?>).*?(</TAG>)@\1hi\2@' test.xml 
```

# http - 为什么bittorrent没有更普及？

> ID：153064
> 
> 赞同：2
> 
> 时间：2008-09-30T13:43:33.243
> 
> 标签：http, bittorrent

我想这个问题是[一个主题的变体](https://stackoverflow.com/questions/21475/why-havent-torrents-replaced-http-downloads)，但不同。

Torrent 永远不会取代 HTTP，甚至 FTP 下载选项。这就是说，为什么更多网站上的这些选项旁边没有种子链接？

我正在想象一个网络系统，下载的文件可以通过 HTTP 下载，比如从 下载`http://example.com/downloads/files/myFile.tar.bz2`，种子可以廉价地自动生成并存储在 中`/downloads/torrents/myFile.tar.bz2.torrent`，而跟踪器可能是`/downloads/tracker/`.

跟踪器是一个定义明确的问题，实施起来并不困难，而且已经有许多替代方案。我想定制一个来做这里需要的事情并不难。

自动生成的 torrent 文件可以包含普通的 HTTP 服务器作为永久种子，大多数（如果不是全部）主要 torrent 客户端都很好地支持这样做的扩展，并且不需要在服务器端重新配置或特殊的东西（它使用库存标准 HTTP 范围标头）。

就个人而言，如果我设置了这样的系统，我会将目录速度限制在`/downloads/files/`合理的范围内，比如 40-50kb/s，具体取决于您要提供的服务。

这样的文件传递系统存在吗？如果这样做，您会使用它吗：用于您的个人、公司或其他网站？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T14:28:09.923

首先：[http](http://torrent.ubuntu.com/) ://torrent.ubuntu.com/用于 ubuntu 上的种子。

其次：Opera 有一个内置的 torrent 客户端。

第三：我同意对 p2p 的污名。如此之多以至于我们有需要称为合法种子之类的网站，因为默认情况下种子是非法的，我们不要自欺欺人，它是。

让洪流进入主流是一个绝妙的主意。你不能篡改你正在播种的文件，所以那里没有风险。

很大的原因并不是真正的耻辱。最大的原因是分析及其保护。使用洪流，这些人（微软等公司等）将无法收集有关谁在进行下载的重要信息（不是个人身份信息，并且很快就被汇总了）。使用洪流，其他人至少可以部分看到这些信息。一家公司很想播种竞争公司产品的评估版本的种子，只是为了了解它有多受欢迎以及从哪里下载。它不如在您的网络服务器上托管下载，但它是下一个最好的事情。

这可能是为什么微软网站上的 vista 下载，或者它的许多服务包和 SDK 没有在 torrent 中的原因。

另一件事是人们不会参与，这不难理解为什么因为你必须跳过的箍的数量。你必须弄清楚防火墙、NAT 的事情，然后是 uPNP 的事情，然后也许你的 ISP 正在限制你的带宽，等等。

同样，我会（而且我确实）为我下载的种子播种 1.5 次或更多，但那是因为这些是 linux、openoffice 之类的东西。我可能会觉得播种 adobe acrobat 或一些评估版之类的东西很有趣，因为那些家伙正在赚钱，我不是傻瓜为他们省钱。让他们为 http 下载付费。

编辑：（基于monoxide的评论）对于那里的免费软件和SF.net下载，他们的问题是他们不能依赖播种机并且无论如何都需要他们在镜像上的后备，所以对他们来说，种子增加了他们的费用。另一个让人想到的原因是，即使在软件商店中，互联网访问现在也受到了彻底的控制，种子所依赖的端口以及上传要求绝对是禁止的。由于大多数需要这些站点及其下载的人都在这类办公室中，因此他们将继续使用 http。

但即使这样也不是答案。这些人在其许可条款中对重新分发有限制。所以他们的问题是这样的：如果你为他们的软件播种，你就是在重新分发它。这违反了他们的许可条款，所以如果他们托管种子下载并允许您播种，那就是诱捕，他们可以被起诉（我不是律师，我从看电视中学习）。然后，他们必须巧妙地更改许可，以允许通过种子种子进行分发，但不能以其他方式进行分发。对我们大多数人来说，这是一个很容易的概念，但是英语的变幻莫测和法官脸上愚蠢的硬朗表情使它成为一件非常棘手的事情。法官可能个人理解洪流，但坐在法庭上他必须皱眉并假装不理解，因为它没有在法律术语中记录。

那里是他们挖的沟，他们掉进了那里。让我们嘲笑他们和他们的苦难。昨天的聪明，今天的愚蠢。

干杯!

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T13:46:35.887

我想知道它是否部分是与种子相关的耻辱。我看到的唯一提供 torrent 链接的软件是 Linux 发行版，而不是全部（例如，Ubuntu 网站不提供下载 Ubuntu 的 torrent）。但是，如果我说我要下载某些内容，大多数人会将其与非法下载（音乐、视频、电视节目等）联系起来。

我认为这可能来自高层。工程师可能会建议使用 torrent 系统来提供下载，但当他们听到“torrent”这个词时，管理层会不寒而栗。

也就是说，我确实会使用这样的系统。虽然我怀疑我是否能够在家中播种（我发现带宽会破坏房子里其他人的连接）。但是，在学校里，我可能不仅会使用这样的系统，而且还会使用它。

正如另一个问题中提到的，另一个问题是种子软件没有内置在浏览器中。在它出现之前，你不会看到它被广泛使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-20T14:39:00.360

[Kontiki](http://en.wikipedia.org/wiki/Kontiki)（与 bittorrent 非常相似）约占英国所有互联网流量的 10%，专门用于“大媒体”内容的合法分发。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T14:05:28.713

有些人不会安装 torrent 客户端，因为他们不希望 RIAA 向他们发送勒索信并在他们（RIAA）闯入您的计算机并看到完全合法的 MP3 文件备份副本时在法庭上收取法律费用合法购买的 CD。

那里有很多对洪流的恐惧，我对任何允许甚至限制访问我的 PC 的客户端都感到不舒服，因为那是“帐篷里的骆驼鼻子”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T14:07:02.110

其他海报是正确的。通常，由于黑客和违反版权法的人使用 Torrent 文件，它们受到了巨大的污名。看看 PirateBay，他们“服务”的只是种子文件。美国的许多有线电视公司也开始在他们的网络上调整 Torrent 流量，因为它非常消耗带宽。

请记住，种子不是下载加速器。它们旨在减轻负担不起（或者可能只是不想）自己支付所有带宽的人的负担。播种的用户承担了大部分负载。没人种吗？你没有文件。

洪流协议也很糟糕，因为它太健谈了。多达 40% 的在线通信可以是控制流消息和客户端之间的聊天请求。这就是有线电视公司如此讨厌它的原因。torrent 最终游戏还有一些其他问题（它要求很多人提供最终部件以试图完成 torrent，但有时最终会得到 0 个可用部件，所以你被困在 99% 并为每个人播种）。

http 也非常成熟，可以为负载均衡器等进行流量整形。因此，大多数提供内容的合法公司都可以负担得起托管它，或者使用 Akamai 之类的人来重复数据，然后进行负载均衡。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T13:55:08.723

也许它无处不在，支持 http 的浏览器，您不再看到那么多 FTP 下载链接，因此这可能是最大的因素（最终用户易于使用）。

尽管如此，我认为洪流下载是一个有效的替代方案，即使它们不是主要下载。

我什至建议 Sourceforge 自动生成 torrent 以供下载，他们同意这是个好主意.. 但还没有实现它（还）。希望他们会。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T14:00:50.300

speeddemosarchive.com 上确实存在类似的东西。服务器托管 Metroid Prime speedrun 并为其提供永久种子。我认为这是一个非常聪明的想法。与您的想法相反，您不需要 HTTP URL。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T14:08:29.440

我认为原因之一是（当前）在网络浏览器中不完全支持 torrent 链接......你必须启动 torrent 客户端等等。

也许是时候做一个小小的 Firefox 扩展/插件了？妈的，我现在上班了！:)

# c++ - 将指针转换为整数

> ID：153065
> 
> 赞同：100
> 
> 时间：2008-09-30T13:43:47.440
> 
> 标签：c++, gcc, casting, 64-bit, 32-bit

我正在尝试使现有代码适应 64 位机器。主要问题是在一个函数中，前面的编码器使用了一个 void* 参数，该参数在函数本身中被转换为合适的类型。一个简短的例子：

```
void function(MESSAGE_ID id, void* param)
{
    if(id == FOO) {
        int real_param = (int)param;
        // ...
    }
} 
```

当然，在 64 位机器上，我得到了错误：

```
error: cast from 'void*' to 'int' loses precision 
```

我想更正此问题，以便它仍然可以在 32 位机器上运行，并且尽可能干净。任何的想法 ？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2014-10-27T11:07:40.543

我会说这是现代 C++ 方式：

```
#include <cstdint>
void *p;
auto i = reinterpret_cast<std::uintptr_t>(p); 
```

**编辑**：

## Integer 的正确类型

因此，将指针存储为整数的正确方法是使用`uintptr_t`or`intptr_t`类型。（另请参见[C99 的 cppreference 整数类型](http://en.cppreference.com/w/c/types/integer)）。

这些类型在`<stdint.h>`C99 和`std`C++11的命名空间中定义`<cstdint>`（参见[C++ 的整数类型](http://en.cppreference.com/w/cpp/types/integer)）。

**C++11（及更高版本）版本**

```
#include <cstdint>
std::uintptr_t i; 
```

**C++03版**

```
extern "C" {
#include <stdint.h>
}

uintptr_t i; 
```

**C99版**

```
#include <stdint.h>
uintptr_t i; 
```

## 正确的铸造操作员

在 C 中只有一种转换，并且在 C++ 中使用 C 转换是不受欢迎的（所以不要在 C++ 中使用它）。在 C++ 中有不同类型的强制转换，但`reinterpret_cast`对于这种转换来说是正确的强制转换（另请参见[此处](http://en.cppreference.com/w/cpp/language/reinterpret_cast)）。

**C++11 版本**

```
auto i = reinterpret_cast<std::uintptr_t>(p); 
```

**C++03版**

```
uintptr_t i = reinterpret_cast<uintptr_t>(p); 
```

**C版**

```
uintptr_t i = (uintptr_t)p; // C Version 
```

## 相关问题

*   [什么是 uintptr_t 数据类型](https://stackoverflow.com/questions/1845482/what-is-uintptr-t-data-type)

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-09-30T13:45:34.987

使用`intptr_t`和`uintptr_t`。

为了确保它以可移植的方式定义，您可以使用如下代码：

```
#if defined(__BORLANDC__)
    typedef unsigned char uint8_t;
    typedef __int64 int64_t;
    typedef unsigned long uintptr_t;
#elif defined(_MSC_VER)
    typedef unsigned char uint8_t;
    typedef __int64 int64_t;
#else
    #include <stdint.h>
#endif 
```

只需将其放在某个 .h 文件中并包含在您需要的任何地方。

[或者，您可以从此处](http://www.azillionmonkeys.com/qed/pstdint.h)下载 Microsoft 版本的`stdint.h`文件，或从[此处](http://msinttypes.googlecode.com/svn/trunk/stdint.h)使用便携式文件。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2008-09-30T15:05:50.503

'size_t' 和 'ptrdiff_t' 需要与您的架构相匹配（无论它是什么）。因此，我认为与其使用“int”，不如使用“size_t”，在 64 位系统上应该是 64 位类型。

这个讨论[unsigned int vs size_t](https://stackoverflow.com/questions/131803/unsigned-int-vs-sizet)更详细一点。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-30T13:46:37.697

用作`uintptr_t`您的整数类型。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-30T14:20:32.467

有几个答案指出`uintptr_t`并`#include <stdint.h>`作为“解决方案”。也就是说，我建议，部分答案，但不是全部答案。您还需要查看使用 FOO 的消息 ID 调用函数的位置。

考虑这段代码和编译：

```
$ cat kk.c
#include <stdio.h>
static void function(int n, void *p)
{
    unsigned long z = *(unsigned long *)p;
    printf("%d - %lu\n", n, z);
}

int main(void)
{
    function(1, 2);
    return(0);
}
$ rmk kk
        gcc -m64 -g -O -std=c99 -pedantic -Wall -Wshadow -Wpointer-arith \
            -Wcast-qual -Wstrict-prototypes -Wmissing-prototypes \
            -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE kk.c -o kk 
kk.c: In function 'main':
kk.c:10: warning: passing argument 2 of 'func' makes pointer from integer without a cast
$ 
```

您将观察到调用位置 (in `main()`) 存在问题 — 将整数转换为没有强制转换的指针。您将需要分析您`function()`的所有用法，以查看值是如何传递给它的。`function()`如果编写调用，我的内部代码将起作用：

```
unsigned long i = 0x2341;
function(1, &i); 
```

由于您的可能写得不同，您需要检查调用函数的点，以确保使用所示值是有意义的。不要忘记，您可能会发现一个潜在的错误。

此外，如果您要格式化`void *`参数的值（如已转换），请仔细查看`<inttypes.h>`标头（而不是`stdint.h`-`inttypes.h`提供 的服务`stdint.h`，这很不寻常，但 C99 标准说*[t] 标头`<inttypes.h>`包含标头`<stdint.h>`和使用托管实现提供的其他工具对其进行扩展*）并在格式字符串中使用 PRIxxx 宏。

此外，我的评论严格适用于 C 而不是 C++，但您的代码位于 C 和 C++ 之间可移植的 C++ 子集中。我的评论适用的机会是公平的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-11-10T11:23:50.250

1.  `#include <stdint.h>`
2.  使用`uintptr_t`包含的标准头文件中定义的标准类型。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-03-25T17:11:55.120

[我在研究SQLite](https://www.sqlite.org/)的源代码时遇到了这个问题。

在[sqliteInt.h](https://github.com/mackyle/sqlite/blob/master/src/sqliteInt.h#L207)中，有一段代码定义了整数和指针之间的宏转换。作者做了一个很好的陈述，首先指出它应该是一个依赖于编译器的问题，然后实施了解决方案来解释大多数流行的编译器。

```
#if defined(__PTRDIFF_TYPE__)  /* This case should work for GCC */
# define SQLITE_INT_TO_PTR(X)  ((void*)(__PTRDIFF_TYPE__)(X))
# define SQLITE_PTR_TO_INT(X)  ((int)(__PTRDIFF_TYPE__)(X))
#elif !defined(__GNUC__)       /* Works for compilers other than LLVM */
# define SQLITE_INT_TO_PTR(X)  ((void*)&((char*)0)[X])
# define SQLITE_PTR_TO_INT(X)  ((int)(((char*)X)-(char*)0))
#elif defined(HAVE_STDINT_H)   /* Use this case if we have ANSI headers */
# define SQLITE_INT_TO_PTR(X)  ((void*)(intptr_t)(X))
# define SQLITE_PTR_TO_INT(X)  ((int)(intptr_t)(X))
#else                          /* Generates a warning - but it always works     */
# define SQLITE_INT_TO_PTR(X)  ((void*)(X))
# define SQLITE_PTR_TO_INT(X)  ((int)(X))
#endif 
```

以下是评论的引用以获取更多详细信息：

```
/*
** The following macros are used to cast pointers to integers and
** integers to pointers.  The way you do this varies from one compiler
** to the next, so we have developed the following set of #if statements
** to generate appropriate macros for a wide range of compilers.
**
** The correct "ANSI" way to do this is to use the intptr_t type.
** Unfortunately, that typedef is not available on all compilers, or
** if it is available, it requires an #include of specific headers
** that vary from one machine to the next.
**
** Ticket #3860:  The llvm-gcc-4.2 compiler from Apple chokes on
** the ((void*)&((char*)0)[X]) construct.  But MSVC chokes on ((void*)(X)).
** So we have to define the macros in different ways depending on the
** compiler.
*/ 
```

归功于提交者。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T14:05:07.247

最好的办法是避免从指针类型转换为非指针类型。但是，在您的情况下，这显然是不可能的。

正如大家所说， uintptr_t 是你应该使用的。

这个[链接](http://developer.apple.com/documentation/Darwin/Conceptual/64bitPorting/MakingCode64-BitClean/chapter_4_section_4.html)有关于转换为 64 位代码的好信息。

[在comp.std.c](http://groups.google.com/group/comp.std.c/browse_thread/thread/6bf9aa8c9e7bc523)上也有很好的讨论

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-11-10T06:21:15.280

我认为 void* 在这种情况下的“含义”是一个通用句柄。它不是指向值的指针，而是值本身。（这恰好是 C 和 C++ 程序员使用 void* 的方式。）

如果它持有一个整数值，它最好在整数范围内！

这是整数的简单渲染：

```
int x = (char*)p - (char*)0; 
```

它应该只给出警告。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-03-16T23:04:24.503

由于`uintptr_t`不能[保证在 C++/C++11 中存在](https://stackoverflow.com/a/1846648/2436175)，如果这是您可以考虑的单向转换`uintmax_t`，则始终在[`<cstdint>`](http://en.cppreference.com/w/cpp/header/cstdint).

```
auto real_param = reinterpret_cast<uintmax_t>(param); 
```

为了安全起见，可以在代码的任何地方添加断言：

```
static_assert(sizeof (uintmax_t) >= sizeof (void *) ,
              "No suitable integer type for conversion from pointer type"); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-11-24T07:24:38.503

对于 C++11，对于它的价值，假设您没有任何标题，然后定义：

```
template<bool B, class T, class F> struct cond { typedef T type; };
template<class T, class F> struct cond<false, T, F> { typedef F type;};
static constexpr unsigned int PS = sizeof (void *);

using uintptr_type = typename cond<
   PS==sizeof(unsigned short), unsigned short ,
      typename cond<
          PS==sizeof(unsigned int), unsigned int,
              typename cond<
                  PS==sizeof(unsigned long), unsigned long, unsigned long long>::type>::type>::type; 
```

之后，您可以执行以下操作：

```
static uintptr_type ptr_to_int(const void *pointer) { 
    return reinterpret_cast<uintptr_type>(pointer); 
}
static void *int_to_ptr(uintptr_type integer) { 
    return reinterpret_cast<void *>(integer); 
} 
```

# c++ - 可视化代码流的工具 (C/C++)

> ID：153074
> 
> 赞同：82
> 
> 时间：2008-09-30T13:45:04.083
> 
> 标签：c++, c, code-analysis

您是否有任何工具可以简化理解 C/C++ 代码的任务？我们只是继承了别人编写的一大块软件，我们需要快速上手。关于可能简化此任务的工具的任何建议？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-30T13:56:10.747

[SourceInsight](http://sourceinsight.com)和[Understand for C++](http://www.scitools.com)是您可以获得的用于c/c++ 代码分析（包括流程图）的最佳工具。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T13:51:42.910

分析软件让您了解调用了哪些函数。

如果您可以使用 Linux，请尝试使用[KCachegrind](https://kcachegrind.github.io/html/Home.html)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-26T04:15:09.857

[如果您打开 EXTRACT_ALL 选项， Doxygen](http://www.doxygen.nl/index.html)非常擅长从代码生成图表而不应用标记。您需要安装[GraphViz](http://www.graphviz.org/)才能使用 HAVE_DOT 设置生成图表。我发现安装它并将 DOT_PATH 留空在 Windows 上可以正常工作，但在 OS/X 上必须直接指向点工具位置。

ACM Queue 中有一篇出色的[Code Spelunking](http://queue.acm.org/detail.cfm?id=1483108)文章，其中更多地讨论了使用 doxygen 和 DTrace。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-30T13:51:19.043

就个人而言，我使用调试器。运行代码，看看它在做什么，它的去向是唯一的方法。

但是，您可以通过一些（有时）提供帮助的文档生成器来运行它。一个很好的例子是[doxygen](http://www.doxygen.org/)。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-01T07:53:19.880

KScope，基于 cscope 实用程序构建，如果您使用的是 linux (KDE)。我曾经使用过（并且一直使用）的最好的东西来深入研究一些我必须以某种方式修改的巨大的不熟悉的代码，或者我将使用哪个 API 来满足我的需要。它的功能之一是交叉引用数据库，可以通过多种方式进行搜索：您可以找到符号的所有引用、其全局定义、查找函数的调用者/被调用者等等。它甚至有一个内置的 IDE 和显示调用图的能力。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-30T13:51:32.677

[如果您使用 graphviz， Doxygen](http://www.doxygen.org)会为您提供类关系图，即使您没有专门为此做好准备。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-30T14:05:47.650

有一些像埃及[http://www.gson.org/egypt/egypt.html](http://www.gson.org/egypt/egypt.html)这样的工具可以工作，但前提是您匹配用于编译代码的预期 GCC 版本和调用图生成器的确切版本。关于codeviz [http://www.csn.ul.ie/~mel/projects/codeviz/也可以这样说](http://www.csn.ul.ie/~mel/projects/codeviz/)

其他选项是在 cachegrind 模式下使用的 valgrind（它生成一种调用图，您可以从 kcachegrind 程序中遵循该调用图。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T13:52:33.597

我个人使用 Visual Studio 调试器工具。

它带有“来电图”功能，可让您在小框中可视化内容。调用堆栈和通常的手表功能通常也是我所需要的

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T14:00:59.207

还有[AspectBrowser](http://www-cse.ucsd.edu/~wgg/Software/AB/)不能很好地与 Eclipse 3.4.0 配合使用

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T14:04:37.950

试试[AQtime](http://www.automatedqa.com/products/aqtime/)，它是一个分析工具，显示所有被调用的函数（以及它所花费的时间），您可以设置分析的起点和终点。他们有 30 天的试用期。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-30T14:41:26.473

我不久前使用了[Borland Together](http://www.borland.com/us/products/together/index.html)，它在从代码生成模型方面做得不错。我相信它甚至会从代码中生成序列图。请记住，如果您的代码一团糟，您的模型也会如此。而且我记得它并不便宜，但有时您可以买到特价商品。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-30T15:58:06.400

Rational Quantify 还提供了一个很好的调用图。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-06-30T01:39:26.893

i tried a tool named Visustin which is not very great graphically but does what it says: Flowchart from Code. [http://www.aivosto.com/visustin.html](http://www.aivosto.com/visustin.html)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T13:52:29.883

[doxygen](http://www.doxygen.nl/)是一个免费的文档生成工具（类似于 Javadoc），它也可以生成关系图。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-30T13:54:37.367

Doxygen，它的好处是它会让你知道锄头丑/好是你的代码在类的循环依赖方面。所以你将被迫重构你的代码，尽管你可能不喜欢它:-)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-12-03T20:16:21.207

Slickedit 非常适合浏览你不知道的大块代码。标签功能允许您在功能的基础上处理代码，而不必处理它在哪个文件中。（EMACS 实际上有标签，并且与 Slickedit 一样好，但学习曲线稍微陡峭）

When you get to a method or class or variable you don't understand, you just push-tag to go to that code, look it over, then pop-tag back. (those are bound to keystrokes, so it is very quick)

You can also use find-references to see where that function/variable is used.

Saves tons of time over having to go and figure out which file something is in.

# sql-server - 故障转移群集上的 SQL Server 2008 Reporting Services

> ID：153078
> 
> 赞同：3
> 
> 时间：2008-09-30T13:45:44.423
> 
> 标签：sql-server, reporting-services, failovercluster

当我尝试在故障转移群集的第二个节点上安装 Reporting Services 时，我收到以下错误消息：

现有集群或集群准备实例失败。选择安装的实例已安装并集群在节点 2 上。

但是，我们以前从未安装过它。有没有人有任何想法？这是在 64 位 Windows 2008 服务器上。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T14:40:31.450

不过只有一件事。您必须使用 Enterprise Edition 媒体安装 Reporting Services，并且为了避免对许可做各种讨厌的事情，故障转移群集也必须是 Enterprise Edition。如果您尝试使用 SQL Server Standard 媒体执行此操作，您将无法将 SSRS 安装到“共享数据库”，并且实例 #1 创建的数据库中的加密信息将被无情地摧毁。这将导致 SSRS 的实例 1 不工作，而实例 2（在第二台服务器上）正在工作。试图解决这个问题只会扭转局面。

就我个人而言，我觉得这对 Microsoft 来说是一件很糟糕的事情，因为这实际上意味着您必须权衡 Enterprise Edition 的成本与支持 HA 的 Reporting Services 的成本。

因此，基本上，如果您不希望您的 Reporting Services 成为单点故障，则必须购买 Enterprise Edition。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T18:32:36.783

显然，SQL Server 可以安装在故障转移集群的每个节点上。需要注意的是，它必须是具有两个不同实例名称的两个独立安装。但是，您可以共享同一个报表服务器数据库。有关部署 Reporting Services 的详细信息，请阅读[本文](http://msdn.microsoft.com/en-us/library/ms157293(SQL.90).aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-25T06:14:35.233

[http://msdn.microsoft.com/en-us/library/ms159114.aspx](http://msdn.microsoft.com/en-us/library/ms159114.aspx)

考虑这篇关于 SSRS 横向扩展过程的文章。在集群上安装共享报表服务器数据库。然后安装报告服务以使用共享数据库。报告服务不会进行故障转移，但数据库会。

这是故障转移 IIS 的一个选项：http: [//support.microsoft.com/kb/970759](http://support.microsoft.com/kb/970759)

# java - 如何在不安装 MS Office 且不使用互操作库的情况下读取服务器中的 MS Office 文件？

> ID：153079
> 
> 赞同：5
> 
> 时间：2008-09-30T13:45:48.370
> 
> 标签：java, .net, apache, ms-office, office-interop

互操作库很慢，需要安装 MS Office。很多时候你不想在服务器上安装 MS Office。

我想使用[Apache POI](http://en.wikipedia.org/wiki/Apache_POI)，但我使用的是 .NET。

我只需要提取文件的文本部分，而不是在 Office 文件中创建或“存储信息”。

我需要告诉您，我有一个非常大的文档库，我无法将它转换为更新的 XML 文件。

我不想为二进制文件编写解析器。像 Apache POI 这样的库可以为我们做到这一点。不幸的是，它仅适用于 Java 平台。也许我应该考虑用 Java 编写这个应用程序。

我仍然没有在 .NET 中找到 POI 的开源替代方案，我想我会用 Java 编写自己的应用程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T14:13:44.963

对于所有 MS Office 版本：

*   您可以使用第三方组件，例如[TX Text Controls](http://www.textcontrol.com/) for Word 和[TMS Flexcel Studio](http://www.tmssoftware.com/site/flexcelnet.asp) for Excel

对于新办公室（2007 年）：

*   您可以使用 .net 中的 .net 功能做一些基本的事情`system.io.packaging`。参见[http://msdn.microsoft.com/en-us/library/bb332058.aspx](http://msdn.microsoft.com/en-us/library/bb332058.aspx)

对于旧办公室（2007 年之前）：

*   现在记录了旧的 Office 格式：http: [//www.microsoft.com/interop/docs/officebinaryformats.mspx](http://www.microsoft.com/interop/docs/officebinaryformats.mspx)。如果你想做一些非常简单的事情，你可以考虑尝试一下。但请注意，这些格式非常复杂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T14:10:51.477

由于新的 docx 格式本质上是基于 XML 的文件，因此一旦您了解其结构，就可以使用标准 XML DOM 技术以编程方式创建和操作它们。

这些文件基本上是带有备用文件扩展名的 zip 档案。使用`System.IO.Packaging`命名空间来访问文件的内部元素，然后将它们打开到 a`XmlDocument`中以执行操作。

有可用的示例，SourceForge 上的 Office Open XML 项目可能值得寻找灵感。

至于较旧的二进制格式，这些是 MS 专有的，您可能从内部获取内容的唯一方法是通过 Office 对象模型（需要安装 Office）或第三方文件转换器/解析器。

不幸的是，没有任何第一方和原生的 .NET 平台可以处理这些文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T15:14:34.663

查看[Aspose 组件](http://www.aspose.com/categories/default.aspx)。它们旨在模仿互操作功能，而无需在服务器上安装完整的 Office。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T13:49:10.563

你需要对这些文件做什么？如果您只想将它​​们流式传输给用户，那么基本文件流就可以了。如果您想创建新文件（可能基于模板）以发送给用户，用户可以在 Office 中打开该文件，有多种解决方法或[解决方法](https://stackoverflow.com/questions/150339/generating-an-excel-file-in-aspnet#150368)。

如果您实际上将数据保存在 Office 文档中以供您的网站使用，那么您做错了。Office 文档，甚至 Excel 电子表格和访问数据库，都不是与交互式网站一起使用的合适选择。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T14:03:12.900

如果文档是 word 2007 格式，您可以使用 system.io.packaging 库以编程方式与之交互。

[温迪](http://www.rwendi.com)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-02T15:45:11.327

在 Java 世界中，还有[JExcelApi](http://jexcelapi.sourceforge.net/)。它写得很清楚，据我所见，比 POI 干净得多。因此，即使将该代码移植到 .NET 也不是不可能的，当然这取决于您是否有足够的时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T14:03:39.763

开发办公室。

您可以针对它进行编程并让它为您做很多事情，而无需花钱购买服务器的许可证，或者在您的服务器上安装与它相关的漏洞。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T14:22:40.357

可以使用使工作簿看起来像数据库表的 ODBC 驱动程序（或者它是 OLE DB 驱动程序？不记得）来读取 Microsoft Excel 工作簿。但我不知道如果没有 Office 套件本身，该驱动程序是否可用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-03T11:32:16.303

您可以使用 OpenOffice。它有一个命令行转换工具：

[转换方法](http://www.xml.com/pub/a/2006/01/11/from-microsoft-to-openoffice.html)

简而言之，您在 OpenOffice 中定义一个宏，然后使用 OpenOffice 的命令行参数调用该宏。在该参数中，本地文件（Office 文件）的名称被编码。

这不是一个很好的解决方案，但它应该是可行的。

# c# - 在 C# 中获取/设置文件所有者

> ID：153087
> 
> 赞同：32
> 
> 时间：2008-09-30T13:48:20.860
> 
> 标签：c#, .net

我需要读取和显示文件的所有者（出于审计目的），并可能更改它（这是次要要求）。有没有不错的 C# 包装器？

快速谷歌后，我发现只有[WMI 解决方案](http://web.archive.org/web/20061116233324/http://www.softinsight.com/bnoyes/PermaLink.aspx?guid=8edc9d4c-0f2c-4006-8186-a3697ebc7476)和 PInvoke GetSecurityInfo 的建议

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-30T14:04:18.607

无需 P/Invoke。[System.IO.File.GetAccessControl](http://msdn.microsoft.com/en-us/library/system.io.file.getaccesscontrol.aspx)将返回一个[FileSecurity](http://msdn.microsoft.com/en-us/library/system.security.accesscontrol.filesecurity_members.aspx)对象，该对象具有[GetOwner](http://msdn.microsoft.com/en-us/library/system.security.accesscontrol.objectsecurity.getowner.aspx)方法。

编辑：阅读所有者非常简单，虽然它是一个有点麻烦的 API：

```
const string FILE = @"C:\test.txt";

var fs = File.GetAccessControl(FILE);

var sid = fs.GetOwner(typeof(SecurityIdentifier));
Console.WriteLine(sid); // SID

var ntAccount = sid.Translate(typeof(NTAccount));
Console.WriteLine(ntAccount); // DOMAIN\username 
```

设置所有者需要调用 SetAccessControl 来保存更改。此外，您仍然受 Windows 所有权规则的约束 - 您不能将所有权分配给另一个帐户。您可以授予拥有所有权许可，而他们必须拥有所有权。

```
var ntAccount = new NTAccount("DOMAIN", "username");
fs.SetOwner(ntAccount);

try {
   File.SetAccessControl(FILE, fs);
} catch (InvalidOperationException ex) {
   Console.WriteLine("You cannot assign ownership to that user." +
    "Either you don't have TakeOwnership permissions, or it is not your user account."
   );
   throw;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-11-18T00:10:04.383

```
FileInfo fi = new FileInfo(@"C:\test.txt");
string user = fi.GetAccessControl().GetOwner(typeof(System.Security.Principal.NTAccount)).ToString(); 
```

# oracle - SQL 开发人员错误

> ID：153095
> 
> 赞同：2
> 
> 时间：2008-09-30T13:49:40.967
> 
> 标签：oracle, oracle-sqldeveloper

我正在尝试使用 SQL 开发人员，但它不会使用我在首选项中指定的代理进行连接。我想这是因为某种证书错误？没有把握。我收到错误：

未收到 HTTP 响应。

javax.net.ssl.SSLHandshakeException：sun.security.validator.ValidatorException：PKIX 路径构建失败：sun.security.provider.certpath.SunCertPathBuilderException：无法在 com.sun.net.ssl.internal 上找到请求目标的有效证书路径.ssl.Alerts.getSSLException(Alerts.java:174) 在 com.sun.net.ssl.internal.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1591) 在 com.sun.net.ssl.internal.ssl.Handshaker .fatalSE(Handshaker.java:187) 在 com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:181) 在 com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker .java:975) 在 com.sun.net.ssl.internal.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:123) 在 com.sun.net.ssl.internal.ssl.Handshaker.processLoop(Handshaker.java:516 ) 在 com.sun.net.ssl.internal.ssl.Handshaker。com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord 的 process_record(Handshaker.java:454)(SSLSocketImpl.java:884) com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl. java:1096) 在 com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1123) 在 com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1107)在 sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:405) 在 sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:166) 在 sun.net.www.protocol .https.HttpsURLConnectionImpl.connect(HttpsURLConnectionImpl.java:133) 在 oracle.ide.webbrowser.HttpPing$PingRunnable.run(HttpPing.java:109) 在 oracle.ide.webbrowser.ProxyOptions.doTask(ProxyOptions.java:522) 在 oracle.ide.webbrowser.HttpPing.ping(HttpPing.java:74) 在 oracle.ide.webbrowser.ProxySettingsPanel$5.run(ProxySettingsPanel.java:766) 在 java.lang.Thread.run(Thread.java: 619) 原因：sun.security.validator.ValidatorException：PKIX 路径构建失败：sun.security.provider.certpath.SunCertPathBuilderException：无法在 sun.security.validator.PKIXValidator.doBuild(PKIXValidator. java:285) 在 sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:191) 在 sun.security.validator.Validator.validate(Validator.java:218) 在 com.sun.net.ssl.internal.ssl .X509TrustManagerImpl.validate(X509TrustManagerImpl.java:126) 在 com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:209) 在 com.sun.net.ssl.internal。ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:249) at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:954) ... 15 更多原因：sun.security.provider.certpath .SunCertPathBuilderException：无法在 sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:174) 处的 java.security.cert.CertPathBuilder.build(CertPathBuilder.java:238) 处找到请求目标的有效认证路径.security.validator.PKIXValidator.doBuild(PKIXValidator.java:280) ... 21 更多无法在 sun.security 的 java.security.cert.CertPathBuilder.build(CertPathBuilder.java:238) 的 sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:174) 中找到请求目标的有效认证路径。 validator.PKIXValidator.doBuild(PKIXValidator.java:280) ... 21 更多无法在 sun.security 的 java.security.cert.CertPathBuilder.build(CertPathBuilder.java:238) 的 sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:174) 中找到请求目标的有效认证路径。 validator.PKIXValidator.doBuild(PKIXValidator.java:280) ... 21 更多

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T22:31:30.750

This most likely means that the web server you are connecting to by SSL uses a certificate issued by an unknown authority. You want to add the certificate to your keystore (on the client).

See this [article](http://www.java-samples.com/showtutorial.php?tutorialid=210) for instructions.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T05:50:48.530

我想你还没有安装jdk。我建议你如果你使用 sql developer 1.5.1，你应该使用 jdk 1.5。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-09-30T14:19:59.067

调试错误的首要规则之一：谷歌你得到的错误消息，用引号括起来，像这样：“无法找到有效的证书路径”。当我这样做时，我发现了许多可能与您相关的有用信息。

# asp.net - 如何从头开始为 Asp.Net 应用程序设置远程调试

> ID：153112
> 
> 赞同：2
> 
> 时间：2008-09-30T13:52:38.823
> 
> 标签：asp.net, debugging, .net-3.5

我希望能够逐步完成部署到远程位置的应用程序，该位置还没有 .Net 框架的 3.5 版。

我需要采取哪些步骤来实现这一目标，您预计需要多长时间？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T14:00:43.297

[如何：设置远程调试](http://msdn.microsoft.com/en-us/library/bt727f1t.aspx)

[Visual Studio 2008 的截屏视频 - 使用 MSVSMON.EXE 进行远程调试](http://www.microsoft.com/uk/msdn/screencasts/screencast/313/Visual-Studio-2008-Remote-Debugging-with-MSVSMONEXE.aspx)

这也是一个[很好的 KB](http://support.microsoft.com/kb/910448)，显示了一些故障排除方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T14:13:44.917

如果您对远程位置具有不受限制的 TCP/IP 访问权限，这将非常容易（例如，最多 5 分钟即可使其工作）：请参阅[如何：设置远程调试](http://msdn.microsoft.com/en-us/library/bt727f1t.aspx)和[如何：运行远程调试](http://msdn.microsoft.com/en-us/library/xf8k2h6a.aspx)监视器所涉及的步骤。

如果您的开发机器通过防火墙、路由器等与远程服务器隔开，事情就会变得更加困难。由于远程调试需要 Windows 身份验证、DCOM 和其他通常（并且非常明智地）被安全策略阻止的东西，因此您很可能需要对远程网络进行某种 VPN 访问才能使事情正常工作。

在目标服务器上设置[路由和远程访问](http://technet.microsoft.com/en-us/network/bb545655.aspx)服务是获得 PPTP 拨入访问它的一种快速方法，但这样做存在重大的安全隐患。因此，这很可能是占用您大部分时间的步骤（并且，取决于管理目标网络的组织，与他们的网络/安全人员进行大量讨论......）。

我的建议是首先使用本地 LAN 上的测试机器开始远程调试测试，并在您熟悉基本知识后处理连接问题。

# algorithm - 包装矩形以实现紧凑表示

> ID：153123
> 
> 赞同：6
> 
> 时间：2008-09-30T13:56:22.387
> 
> 标签：algorithm, packing, rectangles

我正在寻找解决以下问题的指针：我有一组矩形，它们的高度和 x 位置也是已知的，我想将它们打包成更紧凑的形式。通过一点绘图（所有矩形的宽度相同，但在现实生活中宽度可能会有所不同），我想要，而不是。

```
-r1-
  -r2--
     -r3--
       -r4-
        -r5-- 
```

就像是。

```
-r1-  -r3-- 
  -r2-- -r4-
         -r5-- 
```

所有提示将不胜感激。我不一定要寻找“最佳”解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T16:50:34.197

[Topcoder](http://www.topcoder.com)有一个比赛来解决这个问题的 3D 版本。获胜者在[这里](http://www.topcoder.com/longcontest/?module=Static&d1=match_editorials&d2=intel_mtcs_6)讨论了他的方法，这对你来说可能是一个有趣的读物。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T14:44:35.547

您的问题是一个更简单的变体，但您可能会获得一些关于为“装箱”问题开发的启发式方法的提示。已经有很多关于这个的文章，但是[这个页面](http://en.wikipedia.org/wiki/Bin_packing_problem)是一个好的开始。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T15:05:43.343

矩形的高度都一样吗？如果它们是，问题只是将每个矩形放在哪一行，那么问题归结为对所有矩形对 (X,Y) 的一系列约束，形式为“矩形 X 不能与当矩形 X 在 x 方向上与矩形 Y 重叠时，矩形 Y"。

用于此的“贪婪”算法从左到右对矩形进行排序，然后将每个矩形依次分配给它适合的编号最小的行。因为矩形是从左到右处理的，所以只需要担心当前矩形的左手边是否会与其他矩形重叠，这在一定程度上简化了重叠检测算法。

我无法证明这是给出了最佳解决方案，但另一方面也想不出任何反例。任何人？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T14:41:04.713

像这样的东西？

*   按 x 位置对矩形集合进行排序
*   编写一个方法来检查在 x 轴的某个间隔上存在哪些矩形

    ```
    Collection<Rectangle> overlaps (int startx, int endx, Collection<Rectangle> rects){
    ...
    } 
    ```

*   遍历矩形集合

    ```
    Collection<Rectangle> toDraw;
    Collection<Rectangle> drawn;
    foreach (Rectangle r in toDraw){
    Collection<Rectangle> overlapping = overlaps (r.x, r.x+r.width, drawn);
    int y = 0;
    foreach(Rectangle overlapRect in overlapping){
    y += overlapRect.height;
    }
    drawRectangle(y, Rectangle);
    drawn.add(r);
    } 
    ```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-22T02:08:36.780

我以前曾研究过这样的问题。最直观的图片可能是大矩形在底部，小矩形在顶部，有点像将它们全部放入容器中并摇晃它，使重的矩形落到底部。所以要做到这一点，首先按面积（或宽度）递减的顺序对数组进行排序——我们将首先处理大项目并构建图片。

现在的问题是将 y 坐标分配给一组给出了 x 坐标的矩形，如果我理解正确的话。

遍历您的矩形数组。对于每个矩形，将矩形的 y 坐标初始化为 0。然后通过增加该矩形的 y 坐标进行循环，直到它不与任何先前放置的矩形相交（您需要跟踪先前放置的矩形）。提交您刚刚找到的 y 坐标，然后继续处理下一个矩形。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T14:44:37.807

将类似俄罗斯方块的游戏放入您的网站。根据您的参数生成掉落的块和游戏区域的大小。根据设计的紧凑性（更少的可用空间 = 更多积分）向玩家奖励积分。让您的网站访问者为您执行工作。

# c++ - 如何在 MFC 中获得多行工具提示

> ID：153134
> 
> 赞同：8
> 
> 时间：2008-09-30T14:01:08.363
> 
> 标签：c++, mfc

现在，当我将鼠标悬停在编辑框上时，会弹出一个工具提示。问题是该工具提示包含多条错误消息，并且它们都排在一行中。我需要让每条错误消息都在自己的行中。错误消息包含在 CString 中，并用新行分隔它们。

我现有的代码如下。

```
BOOL OnToolTipText(UINT, NMHDR* pNMHDR, LRESULT* pResult)
{
    ASSERT(pNMHDR->code == TTN_NEEDTEXTA || pNMHDR->code == TTN_NEEDTEXTW);
    // need to handle both ANSI and UNICODE versions of the message
    TOOLTIPTEXTA* pTTTA = (TOOLTIPTEXTA*)pNMHDR;
    TOOLTIPTEXTW* pTTTW = (TOOLTIPTEXTW*)pNMHDR;
    //    TCHAR szFullText[256];
    CString strTipText=_T("");
    UINT nID = pNMHDR->idFrom;
    if (pNMHDR->code == TTN_NEEDTEXTA && (pTTTA->uFlags & TTF_IDISHWND) ||
        pNMHDR->code == TTN_NEEDTEXTW && (pTTTW->uFlags & TTF_IDISHWND))
    {
        // idFrom is actually the HWND of the tool
        nID = ::GetDlgCtrlID((HWND)nID);
    }

    //m_errProjAccel[ch] contains 1 or more error messages each seperated by a new line.
    if((int)nID >= ID_PROJECTED_ACCEL1 && (int)nID < ID_PROJECTED_ACCEL1 + PROJECTED_ROWS -1 ) {
        int ch = nID - ID_PROJECTED_ACCEL1;
        strTipText = m_errProjAccel[ch];
    } 

#ifndef _UNICODE
    if (pNMHDR->code == TTN_NEEDTEXTA)
        lstrcpyn(pTTTA->szText, strTipText, sizeof(pTTTA->szText)/sizeof(pTTTA->szText[0]));
    else
        _mbstowcsz(pTTTW->szText, strTipText, sizeof(pTTTA->szText)/sizeof(pTTTA->szText[0]));
#else
    if (pNMHDR->code == TTN_NEEDTEXTA)
        _wcstombsz(pTTTA->szText, strTipText, sizeof(pTTTA->szText)/sizeof(pTTTA->szText[0]));
    else
        lstrcpyn(pTTTW->szText, strTipText, sizeof(pTTTA->szText)/sizeof(pTTTA->szText[0]));
#endif
    *pResult = 0;

    // bring the tooltip window above other popup windows
    ::SetWindowPos(pNMHDR->hwndFrom, HWND_TOP, 0, 0, 0, 0,
        SWP_NOACTIVATE|SWP_NOSIZE|SWP_NOMOVE|SWP_NOOWNERZORDER);

    return TRUE;    // message was handled
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-30T14:20:03.297

在 MSDN 库中解释[了](http://msdn.microsoft.com/en-us/library/bb760252.aspx)创建多行工具提示- 请阅读“实施多行工具提示”部分。您应该向`TTM_SETMAXTIPWIDTH`ToolTip 控件发送一条消息以响应`TTN_GETDISPINFO`通知以强制它使用多行。在您的字符串中，您应该用`\r\n`.

此外，如果您的文本超过 80 个字符，您应该使用结构的`lpszText`成员`NMTTDISPINFO`而不是复制到`szText`数组中。

# c# - 将 GPL 许可证添加到 C# 项目

> ID：153148
> 
> 赞同：21
> 
> 时间：2008-09-30T14:04:55.627
> 
> 标签：c#, gpl

为了将 GPL 添加到 C# 项目，我需要在哪些文件中添加标题注释？

表单生成的代码是否需要它？

是否只需要在每个 *.cs 文件中？

是否有将 GPL 添加到任何类型的项目所需的资源或语言特定步骤的详细列表？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-30T15:12:38.067

规范的答案在[GPL Howto](http://www.gnu.org/licenses/gpl-howto.html)中：

> 无论您打算使用哪种许可证，该过程都涉及向程序的每个源文件添加两个元素：版权声明（例如“Copyright 1999 Terry Jones”）和复制许可声明，说明该程序是根据GNU 通用公共许可证（或小 GPL）的条款。

应用 GPL 的推荐标头是：

> 版权所有 200X 我的名字
> 
> 该文件是 Foobar 的一部分。
> 
> Foobar 是免费软件：您可以根据自由软件基金会发布的 GNU 通用公共许可证的条款重新分发和/或修改它，许可证的第 3 版或（由您选择）任何更高版本。
> 
> Foobar 的分发是希望它有用，但没有任何保证；甚至没有对适销性或特定用途适用性的默示保证。有关详细信息，请参阅 GNU 通用公共许可证。
> 
> 您应该已经收到了一份 GNU 通用公共许可证的副本以及 Foobar。如果没有，请参阅[http://www.gnu.org/licenses/](http://www.gnu.org/licenses/)。

是的，它应该被添加到**每个文件**中，因为你不能合法地依赖于每个收件人都收到你的作品作为一个整体的假设。而且，不，它不必是完整的许可证文本。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-30T14:07:43.590

您实际上不需要为每个文件添加 GPL 通知。您可以在根文件夹中的许可证文件中指定整个项目的许可证，仅此而已。

编辑：推荐的做法**是**在每个文件中添加通知。但不这样做不会使许可证无效或改变其含义。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T14:27:07.367

**提示：** Resharper for Visual Studio 有很好的指定文件头的特性（选项-语言-通用-文件头文本）。

如果您指定它，然后对整个解决方案执行“代码清理”，则每个 *.cs 文件都将获得更新的标头。

这就是我将许可证标题添加到我的开源项目的方式，

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T14:10:37.843

GPL 是一种许可证——没有“要求”在每个源文件中包含许可证的实际文本。

只需提供一个名为 license.txt 的文件，其中包含您项目中的许可证就足够了。

如果我错了，请告诉我你从哪里得到这个要求？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T14:15:02.527

Monodevelop 建议在每个文件中添加以下内容：

> ${文件名}
> 
> 版权所有 (C) ${Year} [作者姓名]
> 
> 该程序是免费软件；您可以根据自由软件基金会发布的 GNU 通用公共许可条款重新分发和/或修改它；许可证的第 2 版，或（由您选择）任何更高版本。
> 
> 分发此程序的目的是希望它有用，但不提供任何保证；甚至没有对适销性或特定用途适用性的默示保证。有关详细信息，请参阅 GNU 通用公共许可证。您应该已经收到了一份 GNU 通用公共许可证的副本以及该程序；如果没有，请写信给 Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-02T11:51:26.283

请注意，FSF 的邮寄地址不是 59 Temple Place，而是下面的地址。

> Free Software Foundation, Inc.
> 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA

不搞砸许可证文本的唯一方法是从 GNU 网站获取它。请注意，该站点具有纯文本格式的许可证，与 html 相比，这通常是首选格式。

[http://www.gnu.org/licenses/](http://www.gnu.org/licenses/)

# oracle - 使用 10g 客户端连接到 Oracle 8.0 数据库

> ID：153151
> 
> 赞同：5
> 
> 时间：2008-09-30T14:05:09.243
> 
> 标签：oracle, oracleclient

我最近将我的 oracle 客户端升级到 10g (10.2.0.1.0)。

现在，当我尝试连接到旧版 8.0 数据库时，我得到了

```
ORA-03134: Connections to this server version are no longer supported. 
```

是否有解决此问题的方法，或者我必须在本地计算机上安装两个客户端？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T14:12:42.067

**是**的，您可以使用 10g 客户端连接到 Oracle 8i 数据库，但 8i 数据库需要 8.1.7.3 补丁集，您可以从[Oracle 的 Metalink 支持站点](http://metalink.oracle.com/)获得该补丁集（需要登录）。

这是包含详细信息的[Oracle 论坛帖子](http://forums.oracle.com/forums/thread.jspa?threadID=241380)。

* * *

如果更新您的 Oracle 数据库不是一个选项，那么您可以安装 2 个不同的客户端（在不同的“Oracle 主目录”（或目录）中），并使用该`selecthome.bat`文件在已安装的客户端之间切换。

例如，在连接到 8i 之前，您将运行：

`C:\Oracle\Client1_8i\bin\selecthome.bat`

或者这个来使用你的 Oracle 10g 客户端：

`C:\Oracle\Client2_10g\bin\selecthome.bat`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T14:07:59.377

我必须将 C# 代码连接到 Oracle 7（我知道你是 8...）...我得到它的唯一方法是获取 CD 来安装 Oracle 服务器并进入“可选配置组件”并使用Oracle73 Ver2.5。

我认为你应该去检查 Oracle 8 服务器的 CD 并检查 ODBC 是否仍然可用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-20T18:45:57.103

连接 Oracle 8.1.7 及更高版本的最佳方式是通过 Instant Client。从 oracle 站点下载 Instant client 10.2，将所有文件复制到 .NET 程序集所在的同一文件夹中，并使用位于 System.Data.OracleClient 中的类。这适用于 .NET 4 项目和 oracle DB 8.1.7 服务器。

# javascript - 根据内容调整 iframe 的大小

> ID：153152
> 
> 赞同：515
> 
> 时间：2008-09-30T14:05:11.523
> 
> 标签：javascript, iframe, widget

我正在开发一个类似 iGoogle 的应用程序。来自其他应用程序（在其他域上）的内容使用 iframe 显示。

如何调整 iframe 的大小以适应 iframe 内容的高度？

我试图破译谷歌使用的 javascript，但它被混淆了，到目前为止搜索网络没有结果。

**更新：**请注意，内容是从其他域加载的，因此适用[同源策略](https://en.wikipedia.org/wiki/Same-origin_policy)。

* * *

## 回答 #1

> 赞同：593
> 
> 时间：2008-12-12T12:04:38.810

我们遇到了这种类型的问题，但与您的情况略有相反 - 我们将 iframe 内容提供给其他域上的站点，因此[同源策略](http://en.wikipedia.org/wiki/Same_origin_policy)也是一个问题。在谷歌搜索了很多小时后，我们最终找到了一个（有点..）可行的解决方案，您可能能够适应您的需求。

有一种方法可以绕过同源策略，但它需要对 iframed 内容和框架页面进行更改，因此如果您无法在双方都请求更改，此方法对您来说不是很有用，我耽心。

有一个浏览器怪癖允许我们绕过同源策略 - javascript 可以与它​​自己域中的页面通信，或者与它具有 iframe 的页面通信，但不能与它被框架的页面通信，例如，如果你有：

```
 www.foo.com/home.html, which iframes
 |-> www.bar.net/framed.html, which iframes
     |-> www.foo.com/helper.html 
```

然后`home.html`可以与`framed.html`（iframed）和`helper.html`（同一域）进行通信。

```
 Communication options for each page:
 +-------------------------+-----------+-------------+-------------+
 |                         | home.html | framed.html | helper.html |
 +-------------------------+-----------+-------------+-------------+
 | www.foo.com/home.html   |    N/A    |     YES     |     YES     |
 | www.bar.net/framed.html |    NO     |     N/A     |     YES     |
 | www.foo.com/helper.html |    YES    |     YES     |     N/A     |
 +-------------------------+-----------+-------------+-------------+ 
```

`framed.html`可以向`helper.html`（iframed）发送消息，但*不能* `home.html`（子不能与父跨域通信）。

这里的关键是`helper.html`可以接收来自 的消息`framed.html`，也可以与之**通信**`home.html`。

所以本质上，当`framed.html`加载时，它会计算出自己的高度，告诉`helper.html`，它将消息传递给`home.html`，然后它可以调整所在 iframe 的大小`framed.html`。

`framed.html`我们发现从to传递消息的最简单方法`helper.html`是通过 URL 参数。为此，请指定`framed.html`一个 iframe `src=''`。当它`onload`触发时，它会评估自己的高度，并将 iframe 的 src 设置为此时`helper.html?height=N`

[这里有一个](http://www.quora.com/How-does-Facebook-Connect-do-cross-domain-communication)关于facebook如何处理它的解释，可能比我上面的更清楚！

* * *

**代码**

在`www.foo.com/home.html`中，需要以下 javascript 代码（这可以从任何域上的 .js 文件加载，顺便说一句..）：

```
<script>
  // Resize iframe to full height
  function resizeIframe(height)
  {
    // "+60" is a general rule of thumb to allow for differences in
    // IE & and FF height reporting, can be adjusted as required..
    document.getElementById('frame_name_here').height = parseInt(height)+60;
  }
</script>
<iframe id='frame_name_here' src='http://www.bar.net/framed.html'></iframe> 
```

在`www.bar.net/framed.html`：

```
<body onload="iframeResizePipe()">
<iframe id="helpframe" src='' height='0' width='0' frameborder='0'></iframe>

<script type="text/javascript">
  function iframeResizePipe()
  {
     // What's the page height?
     var height = document.body.scrollHeight;

     // Going to 'pipe' the data to the parent through the helpframe..
     var pipe = document.getElementById('helpframe');

     // Cachebuster a precaution here to stop browser caching interfering
     pipe.src = 'http://www.foo.com/helper.html?height='+height+'&cacheb='+Math.random();

  }
</script> 
```

内容`www.foo.com/helper.html`：

```
<html> 
<!-- 
This page is on the same domain as the parent, so can
communicate with it to order the iframe window resizing
to fit the content 
--> 
  <body onload="parentIframeResize()"> 
    <script> 
      // Tell the parent iframe what height the iframe needs to be
      function parentIframeResize()
      {
         var height = getParam('height');
         // This works as our parent's parent is on our domain..
         parent.parent.resizeIframe(height);
      }

      // Helper function, parse param from request string
      function getParam( name )
      {
        name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
        var regexS = "[\\?&]"+name+"=([^&#]*)";
        var regex = new RegExp( regexS );
        var results = regex.exec( window.location.href );
        if( results == null )
          return "";
        else
          return results[1];
      }
    </script> 
  </body> 
</html> 
```

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2009-03-31T15:15:00.717

如果您不需要处理来自不同域的 iframe 内容，请尝试使用此代码，它将彻底解决问题，而且很简单：

```
<script language="JavaScript">
<!--
function autoResize(id){
    var newheight;
    var newwidth;

    if(document.getElementById){
        newheight=document.getElementById(id).contentWindow.document .body.scrollHeight;
        newwidth=document.getElementById(id).contentWindow.document .body.scrollWidth;
    }

    document.getElementById(id).height= (newheight) + "px";
    document.getElementById(id).width= (newwidth) + "px";
}
//-->
</script>

<iframe src="usagelogs/default.aspx" width="100%" height="200px" id="iframe1" marginheight="0" frameborder="0" onLoad="autoResize('iframe1');"></iframe> 
```

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2010-07-10T16:24:44.627

[https://developer.mozilla.org/en/DOM/window.postMessage](https://developer.mozilla.org/en/DOM/window.postMessage)

> *window.postMessage()*
> 
> window.postMessage 是一种安全启用跨域通信的方法。通常，只有当且仅当执行它们的页面位于具有相同协议（通常都是 http）、端口号（http 的默认值为 80）和主机（模document.domain 被两个页面设置为相同的值）。window.postMessage 提供了一种受控机制，以在正确使用时以一种安全的方式规避此限制。
> 
> *概括*
> 
> window.postMessage，当被调用时，会在任何必须执行的挂起脚本完成时在目标窗口调度 MessageEvent（例如，如果从事件处理程序调用 window.postMessage，则剩余的事件处理程序，先前设置的挂起超时等。 ）。MessageEvent 具有消息类型，数据属性设置为提供给 window.postMessage 的第一个参数的字符串值，原始属性对应于在时间窗口调用 window.postMessage 的窗口中的主文档的来源。 postMessage 被调用，源属性是调用 window.postMessage 的窗口。（事件的其他标准属性与它们的期望值一起出现。）

*iFrame-Resizer*库使用 postMessage 来保持 iFrame 的大小与其内容一致，并使用[MutationObserver](https://developer.mozilla.org/en/docs/Web/API/MutationObserver)来检测内容的变化，并且不依赖于 jQuery。

[https://github.com/davidjbradshaw/iframe-resizer](https://github.com/davidjbradshaw/iframe-resizer)

jQuery：跨域脚本的优点

[http://benalman.com/projects/jquery-postmessage-plugin/](http://benalman.com/projects/jquery-postmessage-plugin/)

有调整 iframe 窗口大小的演示......

[http://benalman.com/code/projects/jquery-postmessage/examples/iframe/](http://benalman.com/code/projects/jquery-postmessage/examples/iframe/)

这篇文章展示了如何移除对 jQuery 的依赖... Plus 有很多有用的信息和其他解决方案的链接。

[http://www.onlineaspect.com/2010/01/15/backwards-compatible-postmessage/](http://www.onlineaspect.com/2010/01/15/backwards-compatible-postmessage/)

准系统示例...

[http://onlineaspect.com/uploads/postmessage/parent.html](http://onlineaspect.com/uploads/postmessage/parent.html)

window.postMessage 上的 HTML 5 工作草案

[http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages](http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages)

John Resig 谈跨窗口消息传递

[http://ejohn.org/blog/cross-window-messaging/](http://ejohn.org/blog/cross-window-messaging/)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-08-30T17:50:38.927

使用 jQuery 的最简单方法：

```
$("iframe")
.attr({"scrolling": "no", "src":"http://www.someotherlink.com/"})
.load(function() {
    $(this).css("height", $(this).contents().height() + "px");
}); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-06-12T07:54:23.947

最后，我找到了一些其他解决方案，可以使用`window.postMessage(message, targetOrigin);`. 在这里，我解释了我是如何做到的。

站点 A = [http://foo.com](http://foo.com) 站点 B = [http://bar.com](http://bar.com)

SiteB 正在 siteA 网站内加载

SiteB网站有这条线

```
window.parent.postMessage("Hello From IFrame", "*"); 
```

或者

```
window.parent.postMessage("Hello From IFrame", "http://foo.com"); 
```

然后siteA有以下代码

```
// Here "addEventListener" is for standards-compliant web browsers and "attachEvent" is for IE Browsers.
var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
var eventer = window[eventMethod];

var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

// Listen to message from child IFrame window
eventer(messageEvent, function (e) {
   alert(e.data);
   // Do whatever you want to do with the data got from IFrame in Parent form.
}, false); 
```

如果你想添加安全连接，你可以使用这个 if 条件`eventer(messageEvent, function (e) {})`

```
if (e.origin == 'http://iframe.example.com') {
    alert(e.data); 
    // Do whatever you want to do with the data got from IFrame in Parent form.
} 
```

**对于 IE**

内部 IFrame：

```
 window.parent.postMessage('{"key":"value"}','*'); 
```

外部：

```
 eventer(messageEvent, function (e) {
   var data = jQuery.parseJSON(e.data);
   doSomething(data.key);
 }, false); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-30T14:07:20.580

[http://www.phinesolutions.com/use-jquery-to-adjust-the-if](http://www.phinesolutions.com/use-jquery-to-adjust-the-iframe-height.html) ​​rame-height.html上的解决方案效果很好（使用 jQuery）：

```
<script type=”text/javascript”&gt;
  $(document).ready(function() {
    var theFrame = $(”#iFrameToAdjust”, parent.document.body);
    theFrame.height($(document.body).height() + 30);
  });
</script> 
```

我不知道您需要在长度上加 30 ... 1 对我有用。

**仅供参考**：如果您的 iFrame 上已有“高度”属性，则只需添加 style="height: xxx"。这可能不是你想要的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-12-25T23:55:41.943

可能有点晚了，因为所有其他答案都较旧:-) 但是......这是我的解决方案。在实际的 FF、Chrome 和 Safari 5.0 中测试。

CSS：

```
iframe {border:0; overflow:hidden;} 
```

javascript:

```
$(document).ready(function(){
    $("iframe").load( function () {
        var c = (this.contentWindow || this.contentDocument);
        if (c.document) d = c.document;
        var ih = $(d).outerHeight();
        var iw = $(d).outerWidth();
        $(this).css({
            height: ih,
            width: iw
        });
    });
}); 
```

希望这会帮助任何人。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-02-03T03:38:41.317

此答案仅适用于使用 Bootstrap 的网站。Bootstrap 的响应式嵌入功能可以完成这项工作。它基于内容的宽度（而不是高度）。

```
<!-- 16:9 aspect ratio -->
<div class="embed-responsive embed-responsive-16by9">
  <iframe class="embed-responsive-item" src="http://www.youtube.com/embed/WsFWhL4Y84Y"></iframe>
</div> 
```

jsfiddle：http: [//jsfiddle.net/00qggsjj/2/](http://jsfiddle.net/00qggsjj/2/)

[http://getbootstrap.com/components/#responsive-embed](http://getbootstrap.com/components/#responsive-embed)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-06-09T03:10:32.060

这是一个使用动态生成的样式表的简单解决方案，该样式表由与 iframe 内容相同的服务器提供。很简单，样式表“知道” iframe 中的内容，并且知道用于设置 iframe 样式的尺寸。这绕过了相同的来源政策限制。

[http://www.8degrees.co.nz/2010/06/09/dynamically-resize-an-iframe-depending-on-its-content/](http://www.8degrees.co.nz/2010/06/09/dynamically-resize-an-iframe-depending-on-its-content/)

所以提供的 iframe 代码会有一个随附的样式表，像这样......

`<link href="http://your.site/path/to/css?contents_id=1234&dom_id=iframe_widget" rel="stylesheet" type="text/css" />  <iframe id="iframe_widget" src="http://your.site/path/to/content?content_id=1234" frameborder="0" width="100%" scrolling="no"></iframe>`

这确实需要服务器端逻辑能够计算 iframe 呈现内容的尺寸。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-03-20T22:49:54.667

我正在实施 ConroyP 的 frame-in-frame 解决方案来替换基于设置 document.domain 的解决方案，但发现在不同的浏览器中正确确定 iframe 内容的高度非常困难（现在使用 FF11、Ch17 和 IE9 进行测试）。

ConroyP 使用：

```
var height = document.body.scrollHeight; 
```

但这仅适用于初始页面加载。我的 iframe 具有动态内容，我需要在某些事件上调整 iframe 的大小。

我最终做的是为不同的浏览器使用不同的 JS 属性。

```
function getDim () {
    var body = document.body,
        html = document.documentElement;

    var bc = body.clientHeight;
    var bo = body.offsetHeight;
    var bs = body.scrollHeight;
    var hc = html.clientHeight;
    var ho = html.offsetHeight;
    var hs = html.scrollHeight;

    var h = Math.max(bc, bo, bs, hc, hs, ho);

    var bd = getBrowserData();

    // Select height property to use depending on browser
    if (bd.isGecko) {
        // FF 11
        h = hc;
    } else if (bd.isChrome) {
        // CH 17
        h = hc;
    } else if (bd.isIE) {
        // IE 9
        h = bs;
    }

    return h;
} 
```

*[getBrowserData() 是由 Ext Core 的http://docs.sencha.com/core/source/Ext.html#method-Ext-apply](http://docs.sencha.com/core/source/Ext.html#method-Ext-apply) “启发”的浏览器检测功能*

这对 FF 和 IE 来说效果很好，但是 Chrome 出现了问题。其中一个是时间问题，显然 Chrome 需要一段时间来设置/检测 iframe 的高度。如果 iframe 高于内容，Chrome 也永远不会正确返回 iframe 中内容的高度。当高度降低时，这不适用于动态内容。

为了解决这个问题，我总是在检测内容的高度之前将 iframe 设置为低高度，然后将 iframe 高度设置为正确的值。

```
function resize () {
    // Reset the iframes height to a low value.
    // Otherwise Chrome won't detect the content height of the iframe.
    setIframeHeight(150);

    // Delay getting the dimensions because Chrome needs
    // a few moments to get the correct height.
    setTimeout("getDimAndResize()", 100);
} 
```

代码没有优化，它来自我的开发测试:)

希望有人觉得这有帮助！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-08-19T21:55:24.437

```
<html>
<head>
<script>
function frameSize(id){
var frameHeight;

document.getElementById(id).height=0 + "px";
if(document.getElementById){
    newheight=document.getElementById(id).contentWindow.document.body.scrollHeight;    
}

document.getElementById(id).height= (frameHeight) + "px";
}
</script>
</head>

<body>

<iframe id="frame"  src="startframe.html" frameborder="0" marginheight="0" hspace=20     width="100%" 

onload="javascript:frameSize('frame');">

<p>This will work, but you need to host it on an http server, you can do it locally.    </p>
</body>
</html> 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-09-28T22:13:29.820

*这是一个老话题，但在 2020 年它仍然是一个相关问题。我实际上也在另一个旧线程中发布了这个答案^^（[https://stackoverflow.com/a/64110252/4383587](https://stackoverflow.com/a/64110252/4383587)）*

* * *

只是想分享我的解决方案和兴奋。我花了整整四天的时间进行深入的研究和失败，但我认为我找到了一种让 iframe 完全响应的巧妙方法！耶！

我尝试了很多不同的方法......我不想使用双向通信隧道，`postMessage`因为它对于同源来说很尴尬，对于跨域来说很复杂（因为没有管理员想要打开门并在代表你）。

我已经尝试使用 MutationObservers 并且仍然需要几个 EventListeners（调整大小、单击、..）以确保正确处理布局的每次更改。- 如果脚本切换元素的可见性怎么办？或者，如果它按需动态​​预加载更多内容呢？- 另一个问题是从某个地方获取 iframe 内容的准确高度。大多数人建议使用`scrollHeight`or `offsetHeight`，或将其组合使用`Math.max`。问题是，在 iframe 元素更改其尺寸之前，这些值不会更新。要实现这一点，您可以简单地`iframe.height = 0`在抓取 之前重置`scrollHeight`，但对此还有更多警告。所以，拧这个。

然后，我有了另一个想法来尝试`requestAnimationFrame`摆脱我的事件和观察者地狱。现在，我可以立即对每个布局更改做出反应，但我仍然没有可靠的来源来推断 iframe 的内容高度。我偶然发现`getComputedStyle`的！这是一个启示！一切都刚刚好。

好吧，看看我最终可以从无数次尝试中提取的代码。

```
function fit() {
    var iframes = document.querySelectorAll("iframe.gh-fit")

    for(var id = 0; id < iframes.length; id++) {
        var win = iframes[id].contentWindow
        var doc = win.document
        var html = doc.documentElement
        var body = doc.body
        var ifrm = iframes[id] // or win.frameElement

        if(body) {
            body.style.overflowX = "scroll" // scrollbar-jitter fix
            body.style.overflowY = "hidden"
        }
        if(html) {
            html.style.overflowX = "scroll" // scrollbar-jitter fix
            html.style.overflowY = "hidden"
            var style = win.getComputedStyle(html)
            ifrm.width = parseInt(style.getPropertyValue("width")) // round value
            ifrm.height = parseInt(style.getPropertyValue("height"))
        }
    }

    requestAnimationFrame(fit)
}

addEventListener("load", requestAnimationFrame.bind(this, fit)) 
```

就是这样，是的！- 在您的 HTML 代码中编写`<iframe src="page.html" class="gh-fit gh-fullwidth"></iframe>`。这`gh-fit`是一个假的 CSS 类，用于识别 DOM 中的哪些 iframe 元素应该受脚本影响。这`gh-fullwidth`是一个简单的 CSS 类，只有一条规则`width: 100%;`。

上面的脚本会自动从 DOM 中获取所有`.gh-fit`分配了类的 iframe。然后它从 中获取并使用预先计算的宽度和高度样式值`document.getComputedStyle(iframe)`，这些值始终包含该元素的像素完美尺寸！！！刚刚好！

请注意，此解决方案不能跨域工作（没有任何其他解决方案，没有像 IFrameResizer 这样的双向通信策略）。JS 根本无法访问不属于您的 iframe 的 DOM。

我能想到的唯一其他跨域解决方案是使用像[https://github.com/gnuns/allorigins](https://github.com/gnuns/allorigins)这样的代理。但这将涉及深度复制您提出的每个请求 - 换句话说 - 您“窃取”整个页面源代码（使其成为您的并让 JS 访问 DOM）并修补此源中的每个链接/路径，以便它也通过代理。重新链接例程是一个艰难的例程，但可行。

我可能会尝试解决这个跨域问题，但那是另一天。享受代码！:)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-30T14:22:23.017

iGoogle 小工具必须主动实现调整大小，所以我的猜测是在跨域模型中，如果没有远程内容以某种方式参与，您将无法做到这一点。如果您的内容可以使用典型的跨域通信技术将新大小的消息发送到容器页面，那么剩下的就很简单了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-06-01T06:43:38.300

当您想要缩小网页以使其适合 iframe 大小时：

1.  您应该调整**iframe**的大小以使其适合内容
2.  然后你应该用加载的网页内容缩小整个 iframe

这是一个例子：

```
<div id="wrap">
   <IFRAME ID="frame" name="Main" src ="http://www.google.com" />
</div> 
```

* * *

```
<style type="text/css">
    #wrap { width: 130px; height: 130px; padding: 0; overflow: hidden; }
    #frame { width: 900px; height: 600px; border: 1px solid black; }
    #frame { zoom:0.15; -moz-transform:scale(0.15);-moz-transform-origin: 0 0; }
</style> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-01-23T18:37:39.067

这是一个 jQuery 方法，它通过 iframe 的 src 属性在 json 中添加信息。这是一个演示，调整大小并滚动此窗口.. 带有 json 的结果 url 看起来像这样... [http://fiddle.jshell.net/zippyskippy/RJN3G/show/#{docHeight:5124,windowHeight:1019,scrollHeight:第571章](http://fiddle.jshell.net/zippyskippy/RJN3G/show/#%7BdocHeight:5124,windowHeight:1019,scrollHeight:571%7D#)

这是源代码小提琴[http://jsfiddle.net/zippyskippy/RJN3G/](http://jsfiddle.net/zippyskippy/RJN3G/)

```
function updateLocation(){

    var loc = window.location.href;
    window.location.href = loc.replace(/#{.*}#/,"") 
        + "#{docHeight:"+$(document).height() 
        + ",windowHeight:"+$(window).height()
        + ",scrollHeight:"+$(window).scrollTop()
        +"}#";

};

//setInterval(updateLocation,500);

$(window).resize(updateLocation);
$(window).scroll(updateLocation); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-12-11T02:49:19.250

## 获取 iframe 内容高度，然后将其提供给此 iframe

```
 var iframes = document.getElementsByTagName("iframe");
 for(var i = 0, len = iframes.length; i<len; i++){
      window.frames[i].onload = function(_i){
           return function(){
                     iframes[_i].style.height = window.frames[_i].document.body.scrollHeight + "px";
                     }
      }(i);
 } 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-06-16T21:46:52.963

在加载时使用 jquery（跨浏览器）：

```
 <iframe src="your_url" marginwidth="0"  marginheight="0" scrolling="No" frameborder="0"  hspace="0" vspace="0" id="containiframe" onload="loaderIframe();" height="100%"  width="100%"></iframe>

function loaderIframe(){
var heightIframe = $('#containiframe').contents().find('body').height();
$('#frame').css("height", heightFrame);
 } 
```

在响应页面中调整大小：

```
$(window).resize(function(){
if($('#containiframe').length !== 0) {
var heightIframe = $('#containiframe').contents().find('body').height();
 $('#frame').css("height", heightFrame);
}
}); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-04-11T11:48:39.790

David Bradshaw 和 Chris Jacob 已经建议使用 postMessage 方法。我完全同意，做这些事情的正确方法。

我只想发布一个示例，真实有效的代码，以防它成为某些人的现成答案。

在 iframe 方面：

```
<body onload="docResizePipe()">
<script>
var v = 0;
const docResizeObserver = new ResizeObserver(() => {
    docResizePipe();
});
docResizeObserver.observe(document.querySelector("body"));
function docResizePipe() {
    v += 1;
    if (v > 5) {
        return;
    }
    var w = document.body.scrollWidth;
    var h = document.body.scrollHeight;
    window.parent.postMessage([w,h], "*");
}
setInterval(function() {
    v -= 1;
    if (v < 0) {
        v = 0;
    }
}, 300);
</script> 
```

注意递归阻塞机制——这是必要的，因为 Firefox 中显然存在一个错误，但无论如何让它在那里。

在父文档方面：

```
<iframe id="rpa-frame" src="3.html" style="border: none;"></iframe>
<script>
var rpaFrame = document.getElementById("rpa-frame");

window.addEventListener("message", (event) => {
    var width = event.data[0];
    var height = event.data[1];
    rpaFrame.width = parseInt(width)+60;
    rpaFrame.height = parseInt(height)+60;
    console.log(event);
}, false);
</script> 
```

希望它会有用。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-09-17T15:38:54.003

我在这里阅读了很多答案，但几乎每个人都给出了某种跨域框架块。

示例错误：

> 未捕获的 DOMException：阻止具有源“null”的框架访问跨域框架。

相关线程中的答案也是如此：

[使iframe根据内容自动调整高度而不使用滚动条？](https://stackoverflow.com/q/9975810/3850405)

我也不想使用第三方库`iFrame Resizer`或类似库。

@ChrisJacob 的答案很接近，但我缺少一个完整的工作示例，而不仅仅是链接。@Selvamani 和 @latitov 也是很好的补充。

[https://stackoverflow.com/a/3219970/3850405](https://stackoverflow.com/a/3219970/3850405)

我正在使用`width="100%"`，`iframe`但代码也可以修改为使用宽度。

这就是我解决设置自定义高度的方法`iframe`：

嵌入式`iframe`：

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="description"
          content="Web site" />
    <title>Test with embedded iframe</title>
</head>
<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <iframe id="ifrm" src="https://localhost:44335/package/details?key=123" width="100%"></iframe>
    <script type="text/javascript">
        window.addEventListener('message', receiveMessage, false);

        function receiveMessage(evt) {
            console.log("Got message: " + JSON.stringify(evt.data) + " from origin: " + evt.origin);
            // Do we trust the sender of this message?
            if (evt.origin !== "https://localhost:44335") {
                return;
            }

            if (evt.data.type === "frame-resized") {
                document.getElementById("ifrm").style.height = evt.data.value + "px";
            }
        }
    </script>
</body>
</html> 
```

`iframe source`, 示例来自`Create React App`但仅使用`HTML`and `JS`。

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="description"
          content="Web site created using create-react-app" />
    <title>React App</title>
</head>
<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script type="text/javascript">
        //Don't run unless in an iframe
        if (self !== top) {
            var rootHeight;
            setInterval(function () {
                var rootElement = document.getElementById("root");
                if (rootElement) {
                    var currentRootHeight = rootElement.offsetHeight;
                    //Only send values if height has changed since last time
                    if (rootHeight !== currentRootHeight) {
                        //postMessage to set iframe height
                        window.parent.postMessage({ "type": "frame-resized", "value": currentRootHeight }, '*');
                        rootHeight = currentRootHeight;
                    }
                }
            }
                , 1000);
        }
    </script>
</body>
</html> 
```

`setInterval`当然可以修改代码，但它非常适合动态内容。`setInterval`仅当内容嵌入 a 时才激活，`iframe`并且`postMessage`仅在高度更改时发送消息。

您可以在此处阅读更多信息`Window.postMessage()`，但描述非常适合我们想要实现的目标：

> window.postMessage() 方法可以安全地启用 Window 对象之间的跨域通信；例如，在页面和它生成的弹出窗口之间，或者在页面和嵌入其中的 iframe 之间。
> 
> 通常，当且仅当它们源自的页面共享相同的协议、端口号和主机（也称为“同源策略”）时，才允许不同页面上的脚本相互访问。window.postMessage() 提供了一种受控机制来安全地规避此限制（如果使用得当）。

[https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-12-13T11:51:14.820

如果您可以控制 iframe 内容，我强烈建议您使用

## [调整大小观察者](https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver)

`srcdoc`只需在属性的末尾插入以下内容，如果需要`iframe`， 将其[转义。](https://codebeautify.org/html-escape-unescape)

```
<script type="text/javascript">
var ro = new ResizeObserver(entries => {
  for (let entry of entries) {
    const cr = entry.contentRect;
    // console.log(window.frameElement);
    window.frameElement.style.height =cr.height +30+ "px";
  }
});

ro.observe(document.body);
</script> 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2022-01-27T12:57:54.010

[https://getbootstrap.com/docs/4.0/utilities/embed/](https://getbootstrap.com/docs/4.0/utilities/embed/)

经过大量研究，我突然意识到，这不是一个独特的问题，我敢打赌 Bootstrap 会处理它。你瞧……</p>

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2015-09-17T02:36:30.167

使用 jQuery：

父.html

```
<body>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<style>
iframe {
    width: 100%;
    border: 1px solid black;
}
</style>
<script>
function foo(w, h) {
    $("iframe").css({width: w, height: h});
    return true;  // for debug purposes
}
</script>
<iframe src="child.html"></iframe>
</body> 
```

child.html

```
<body>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>
$(function() {
    var w = $("#container").css("width");
    var h = $("#container").css("height");

    var req = parent.foo(w, h);
    console.log(req); // for debug purposes
});
</script>
<style>
body, html {
    margin: 0;
}
#container {
    width: 500px;
    height: 500px;
    background-color: red;
}
</style>
<div id="container"></div>
</body> 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2021-02-13T23:31:26.087

找不到可以完美处理大文本+大图像的东西，但我最终得到了这个，似乎每次都正确或几乎正确：

```
 iframe.addEventListener("load",function(){
        // inlineSize, length, perspectiveOrigin, width
        let heightMax = 0;
        // this seems to work best with images...
        heightMax = Math.max(heightMax,iframe.contentWindow.getComputedStyle(iframe.contentWindow.document.body).perspectiveOrigin.split("px")[0]);
        // this seems to work best with text...
        heightMax = Math.max(heightMax,iframe.contentWindow.document.body.scrollHeight);
        // some large 1920x1080 images always gets a little bit off on firefox =/
        const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;
        if(isFirefox && heightMax >= 900){
            // grrr..
            heightMax = heightMax + 100;
        }

        iframe.style.height = heightMax+"px";
        //console.log(heightMax);
    }); 
```

* * *

## 回答 #24

> 赞同：-2
> 
> 时间：2008-09-30T14:12:16.683

这有点棘手，因为您必须知道 iframe 页面何时加载，当您无法控制其内容时，这很困难。可以将 onload 处理程序添加到 iframe，但我过去曾尝试过，并且它在浏览器中的行为有很大不同（不知道谁是最烦人的......）。您可能必须向 iframe 页面添加一个函数来执行调整大小并将一些脚本注入到内容中，以监听加载事件或调整大小事件，然后调用前一个函数。我正在考虑向页面添加一个功能，因为你想确保它的安全，但我不知道它会有多容易。

* * *

## 回答 #25

> 赞同：-2
> 
> 时间：2008-09-30T14:13:07.493

我相信这方面的东西应该有效。

```
parent.document.getElementById(iFrameID).style.height=framedPage.scrollHeight; 
```

在 iframe 内容上使用您的 body onload 加载它。

* * *

## 回答 #26

> 赞同：-4
> 
> 时间：2012-02-20T05:59:12.570

我有一个简单的解决方案，需要您确定链接中的宽度和高度，请尝试（它适用于大多数浏览器）：

```
<a href='#' onClick=" document.getElementById('myform').src='t2.htm';document.getElementById('myform').width='500px'; document.getElementById('myform').height='400px'; return false">500x400</a> 
```

# xml - 如何计算节点中的不同值？

> ID：153156
> 
> 赞同：13
> 
> 时间：2008-09-30T14:05:44.577
> 
> 标签：xml, xslt, xslt-grouping

如何计算 XSLT 中节点中的不同值？

示例：我想计算 Country 节点中现有国家的数量，在本例中为 3。

```
<Artists_by_Countries>
    <Artist_by_Country>
        <Location_ID>62</Location_ID>
        <Artist_ID>212</Artist_ID>
        <Country>Argentina</Country>
    </Artist_by_Country>
    <Artist_by_Country>
        <Location_ID>4</Location_ID>
        <Artist_ID>108</Artist_ID>
        <Country>Australia</Country>
    </Artist_by_Country>
    <Artist_by_Country>
        <Location_ID>4</Location_ID>
        <Artist_ID>111</Artist_ID>
        <Country>Australia</Country>
    </Artist_by_Country>
    <Artist_by_Country>
        <Location_ID>12</Location_ID>
        <Artist_ID>78</Artist_ID>
        <Country>Germany</Country>
    </Artist_by_Country>
</Artists_by_Countries> 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-30T16:53:00.200

如果您的文档很大，您可能希望使用通常用于分组的“Muenchian Method”来识别不同的节点。声明一个键，通过不同的值来索引您想要计数的事物：

```
<xsl:key name="artists-by-country" match="Artist_by_Country" use="Country" /> 
```

然后，您可以`<Artist_by_Country>`使用以下方法获取具有不同国家/地区的元素：

```
/Artists_by_Countries
  /Artist_by_Country
    [generate-id(.) =
     generate-id(key('artists-by-country', Country)[1])] 
```

您可以通过将其包装在对函数的调用中来计算它们`count()`。

当然，在 XSLT 2.0 中，它就像

```
count(distinct-values(/Artists_by_Countries/Artist_by_Country/Country)) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T14:16:31.837

在 XSLT 1.0 中这并不明显，但以下内容应该让您了解需求：

```
count(//Artist_by_Country[not(Location_ID=preceding-sibling::Artist_by_Country/Location_ID)]/Location_ID) 
```

XML 中的元素越多，所需的时间就越长，因为它会检查每个元素的每个前面的兄弟。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-30T14:13:45.807

尝试这样的事情：

```
count(//Country[not(following::Country/text() = text())]) 
```

“给我所有国家节点的计数，没有匹配文本的以下国家”

IMO 这个表达式的有趣之处在于[跟随](http://www.w3schools.com/xpath/xpath_axes.asp)轴。

您可能还可以删除第一个`/text()`，并将第二个替换为`.`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T14:21:58.393

如果您在第一次出现某个国家/地区时可以控制 xml 生成，您可以向国家节点添加一个属性，例如 distinct='true' 将该国家/地区标记为“已使用”，如果遇到该国家/地区，则不要随后添加 distinct 属性又是国家。

然后你可以做

```
<xsl:for-each select="Artists_by_Countries/Artist_by_Country/Country[@distinct='true']" /> 
```

# .net - 有没有办法确定 .NET 线程何时终止？

> ID：153166
> 
> 赞同：9
> 
> 时间：2008-09-30T14:07:15.260
> 
> 标签：.net, multithreading

我试图找出是否有一种方法可以可靠地确定托管线程何时即将终止。我正在使用包含对 PDF 文档的支持的第三方库，问题是为了使用 PDF 功能，我必须显式初始化 PDF 组件，完成工作，然后在线程终止之前显式取消初始化组件. 如果未调用 uninitialize，则会引发异常，因为未正确释放非托管资源。由于线程类是密封的并且没有事件，我必须将线程实例包装到一个类中，并且只允许该类的实例来完成工作。

我应该指出，这是多个 Windows 应用程序使用的共享库的一部分。我可能并不总是能够控制调用这个库的线程。

由于 PDF 对象可能是对该库的调用的输出，并且由于调用线程可能对该对象进行一些其他工作，所以我不想立即调用清理函数；我需要在线程终止之前尝试这样做。理想情况下，我希望能够订阅诸如 Thread.Dispose 事件之类的东西，但这就是我所缺少的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T14:16:49.777

你不想包装`System.Thread`本身 - 只需将它与你`PDFWidget`正在做的工作的类组合起来：

```
class PDFWidget
{
    private Thread pdfWorker;
    public void DoPDFStuff()
    {
        pdfWorker = new Thread(new ThreadStart(ProcessPDF));
        pdfWorker.Start();
    }

    private void ProcessPDF()
    {
        OtherGuysPDFThingie pdfLibrary = new OtherGuysPDFThingie();
        // Use the library to do whatever...
        pdfLibrary.Cleanup();
    }
} 
```

您也可以使用`ThreadPool`线程，如果这更符合您的口味 - 最佳选择取决于您需要对线程进行多少控制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:05:07.383

有很多方法可以做到这一点，但最简单的一种是像[McKenzieG1](https://stackoverflow.com/users/3776/mckenzieg1)所说的那样，只需将调用包装到 PDF 库。在线程中调用 PDF 库后，您可以使用 Event 或 ManualResetEvent，具体取决于您需要等待线程完成的方式。

如果您使用事件方法，请不要忘记使用 BeginInvoke 将事件调用编组到 UI 线程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T14:08:52.887

我认为您可以使用 [Auto|Manual]ResetEvent 在线程终止时设置它

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T14:10:27.360

捕获 ThreadAbortExcpetion。

[http://msdn.microsoft.com/en-us/library/system.threading.threadabortexception.aspx](http://msdn.microsoft.com/en-us/library/system.threading.threadabortexception.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T14:58:39.257

在异步模式下调用标准方法怎么样？例如

```
//declare a delegate with same firmature of your method
public delegete string LongMethodDelegate ();

//register a callback func
AsyncCallback callbackFunc = new AsyncCallback (this.callTermined); 

//create delegate for async operations
LongMethodDelegate th = new LongMethodDelegate (yourObject.metyodWichMakeWork);

//invoke method asnync.
// pre last parameter is  callback delegate.
//the last parameter is an object wich you re-find in your callback function. to recovery return value, we assign delegate itSelf, see "callTermined" method
longMethod.beginInvoke(callbackFunc,longMethod);   

//follow function is called at the end of thr method
public static void callTermined(IAsyincResult result) {
LongMethodDelegate method  = (LongMethodDelegate ) result.AsyncState;  
string output = method.endInvoke(result);
Console.WriteLine(output);
} 
```

请参阅此处的更多信息：http: [//msdn.microsoft.com/en-us/library/2e08f6yc.aspx](http://msdn.microsoft.com/en-us/library/2e08f6yc.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T14:26:48.350

你不会用 finally （如果它是单一方法）或 IDisposable 来包装你的 PDF 用法吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T14:35:11.420

检查[http://wintellect.com](http://wintellect.com)上的 Powerthreading 库。

# ruby-on-rails - RoR：嵌套命名空间路由，未定义方法错误

> ID：153183
> 
> 赞同：4
> 
> 时间：2008-09-30T14:11:25.250
> 
> 标签：ruby-on-rails, ruby

我正在开发一个新的 rails 应用程序的管理部分，我正在尝试设置一些路线来“正确”地做事。我有以下控制器：

```
class Admin::BlogsController < ApplicationController
  def index
    @blogs = Blog.find(:all)
  end

  def show
    @blog = Blog.find(params[:id])
  end

  ...
end 
```

在 routes.rb 中：

```
map.namespace :admin do |admin|
  admin.resources :blogs
end 
```

在视图/admin/blogs/index.html.erb 中：

```
<% for blog in @blogs %>
  <%= link_to 'Delete', admin_blog(blog), :method => :delete
<% end %> 
```

我已验证路线存在：

```
admin_blogs GET /admin/blogs {:action => "index", :controller=>"admin/blogs"}
admin_blog  GET /admin/blogs/:id {:action => "show", :controller => "admin/blogs"}
.... 
```

但是当我尝试查看[http://localhost:3000/admin/blogs](http://localhost:3000/admin/blogs)我得到这个错误：

```
undefined method 'admin_blog' for #<ActionView::Base:0xb7213da8> 
```

我哪里错了，为什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T14:21:03.230

您的删除链接应以 _path 结尾：

```
<%= link_to 'Delete', admin_blog_path(blog), :method => :delete %> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T14:18:18.557

我假设您使用的是 rails 2.0.x，所以您生成路线的方式是 __path

```
admin_blog_path(blog) 
```

如果您骑的是以前的版本，我认为这只是

```
blog_path(blog) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T01:56:56.270

旁注：我还看到您的控制器是这样定义的：

```
class Admin::BlogsController < ApplicationController 
```

不应该是这样吗？

```
class Admin::BlogsController < Admin::ApplicationController 
```

# asp.net - 来自经典 ASP 或 ASP.NET 的 Microsoft Search Server 2008 Express Edition

> ID：153193
> 
> 赞同：2
> 
> 时间：2008-09-30T14:12:53.047
> 
> 标签：asp.net, asp-classic, search-engine

我们在一台服务器上安装了新的 Microsoft Search Server 2008 Express Edition，它很好地索引了我们的 Intranet（在另一台服务器上），我们可以从搜索服务器上提供的搜索表单中进行搜索。

我想自定义搜索结果，使它们*看起来*像我们的 Intranet 生成的一样，并将搜索表单的文本框和提交按钮放在 Intranet 页面本身上。现有的，提供的搜索表单似乎是一个 ASP.NET 页面并执行回发，因此我不能在我的 Intranet 经典 ASP 代码中复制它，无论如何，我最终会返回一些预先格式化的 HTML '我只是在使用一些原始 XML 来转换/格式化自己。

是否有一些 URL 可以访问搜索服务器，传递查询参数并让它返回一些有效的 XML，然后我可以通过 ASP 或 ASP.NET 使用 XSLT 执行转换？

我似乎在 Web 上遇到的所有自定义文章都涉及创建 Sharepoint Web 部件并在 ASP.NET 页面上使用它们，而这（Sharepoint Web 部件）我一无所知:(

我目前正在使用 Google Mini 设备做我正在寻找的事情，调用一个带有搜索词的 URL，并使用 XSLT 将返回的 XML 搜索结果转换为至少在样式方面与我们的（主要是) 经典的 ASP 内网。但是，我们希望尽可能使用 Microsoft Search Server 2008 来执行相同的任务。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-03T15:08:06.023

您可以调用搜索网络服务。这不像调用像 Google 设备这样的 Url 那样简单，但它并不令人生畏。

在 MOSS 2007 中，网址是`http://portalname/_vti_bin/Search.asmx`. 您可能想要使用的方法是**Query**。这会将结果作为 Xml 文档返回。从那里，您可以应用您的 XSL 并在您的自定义搜索页面上显示内联。

# .net - 有没有好的免费 .Net 网络库？（FTP、SFTP、SSH 等）

> ID：153220
> 
> 赞同：40
> 
> 时间：2008-09-30T14:17:03.490
> 
> 标签：.net, open-source, ftp, ssh, sftp

我有点惊讶我还没有找到一个好的开源库来执行常见的网络任务。有一些非常好的商业库，但在开源项目中使用它们太贵了。

有人知道吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2011-03-24T17:20:42.790

SSH.NET 库 - [https://github.com/sshnet/SSH.NET](https://github.com/sshnet/SSH.NET)

受 Sharp.SSH 启发，该库使用 .NET 4.0 完全重写，没有任何第三方依赖项，并尽可能利用并行性以实现最佳性能。

它是客户端 SSH 的可靠 C# 实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T15:07:25.303

.Net 通过 System.Net.FtpWebRequest 提供了一些基本的 FTP 支持，但它充其量只是有点粗糙。我可以推荐的一个更好的替代方案是[sourceforge 的 dotNET FTP 客户端](http://sourceforge.net/projects/dotnetftpclient/)。

我不知道您是否也在寻找电子邮件库，但这是我遇到的，所以我会提到它。

对于电子邮件的撰写和传递，基本的 .NET 库就可以了。System.Net.Mail.MailMessage 非常适合撰写电子邮件，而 System.Net.Mail.SmtpClient 适合通过 SMTP 发送电子邮件。

要使用 POP3 检索电子邮件并解析 MIME 消息，您将需要一个外部库。我一直在使用codeproject中的[POP3 MIME Client ，没有任何问题。](http://www.codeproject.com/KB/IP/Pop3MimeClient.aspx)

我希望这会有所帮助！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T14:30:44.673

[edtFTPNet](http://www.enterprisedt.com/products/edtftpnet/overview.html)是免费的，但您必须购买他们的“专业”版本才能获得 SFTP（基于 SSH 的 FTP）和 FTPS（基于 SSL 的 FTP）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T14:40:37.380

虽然好久没更新了，但是免费的！我记得能够让 SharpSSH 毫不费力地运行，它支持端口转发（这是我当时正在寻找的！）。

SharpSSH [http://www.tamirgal.com/home/dev.aspx?Item=SharpSsh](http://www.tamirgal.com/home/dev.aspx?Item=SharpSsh)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T14:42:53.507

它不是一个单一的库，我不确定它们有多好，但我能够在这里找到几个指向开源库的链接：

[http://csharp-source.net/open-source/network-clients](http://csharp-source.net/open-source/network-clients)

希望这可以帮助！杰夫

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T14:44:48.807

[Lumisoft](http://www.lumisoft.ee/lsWWW/Download/Downloads/Net/)是开源的，拥有 FTP、DNS、IMAP、POP3 客户端等。但它不包括 SSH 和 SFTP。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T14:37:43.737

*   对我来说看起来不错但我没有尝试过的全唱歌全跳舞解决方案：[http ://www.nsoftware.com/products/component/sftp.aspx](http://www.nsoftware.com/products/component/sftp.aspx)
*   我公司使用的 SSH / SFTP 库： [http ://www.eldos.com/sbb/net-sftp.php](http://www.eldos.com/sbb/net-sftp.php)

实际上，我目前唯一使用 SFTP 的地方是使用[putty](http://www.chiark.greenend.org.uk/~sgtatham/putty/)捆绑的 psftp 实用程序，并从进程对象运行它。这可能不是很好，但它对我来说很可靠。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T14:20:14.637

IIRC，FTP内置于.NET，（System.Net.FtpWebRequest），上次我看（几年前，诚然）我找不到任何免费的SSH / SFTP程序集。不过，这可能已经改变了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T14:57:38.777

我做了一些研究，发现了一个 C# 中的 SSH 实现，称为[sharpSsh](http://www.codeproject.com/KB/IP/sharpssh.aspx)。它是 Java 的 Jsch（Java 安全通道）库的一个端口。我们在我的雇主这里使用 Jcsh，这很棒。我不能保证 C# 版本。

# python - 在 Windows 中将 Python Web 服务器作为服务运行

> ID：153221
> 
> 赞同：7
> 
> 时间：2008-09-30T14:17:08.857
> 
> 标签：python, windows, webserver

我有一个用 Python 编写的小型 Web 服务器应用程序，它从数据库系统获取一些数据并将其作为 XML 返回给用户。这部分工作正常——我可以从命令行运行 Python Web 服务器应用程序，我可以让客户端连接到它并取回数据。目前，要运行 Web 服务器，我必须以管理员用户身份登录到我们的服务器，并且我必须手动启动 Web 服务器。我想让 Web 服务器在系统作为服务启动时自动启动并在后台运行。

使用[ActiveState](http://code.activestate.com/recipes/576451/)的站点和[StackOverflow](https://stackoverflow.com/questions/32404/can-i-run-a-python-script-as-a-service-in-windows-how)中的代码，我对如何创建服务有了一个很好的了解，我想我已经整理好了——我可以将我的 Web 服务器作为 Windows 服务安装和启动。但是，我无法弄清楚如何再次停止该服务。我的 Web 服务器是从 BaseHTTPServer 创建的：

```
server = BaseHTTPServer.HTTPServer(('', 8081), SIMSAPIServerHandler)
server.serve_forever() 
```

serve_forever() 调用自然而然地使 Web 服务器处于无限循环中并等待 HTTP 连接（或 ctrl-break 按键，对服务无用）。我从上面的示例代码中了解到，您的 main() 函数应该处于无限循环中，并且只有在遇到“停止”条件时才退出它。我主要调用serve_forever()。我有一个 SvcStop 功能：

```
def SvcStop(self):
    self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
    exit(0) 
```

当我从命令行执行“python myservice stop”时，它似乎被调用了（我可以在其中放置一个调试行，生成文件的输出）但实际上并没有退出整个服务 - 随后调用“python myservice start” " 给我一个错误：

> 启动服务时出错：服务实例已在运行。

随后的停止呼叫给了我：

> 停止服务时出错：服务目前无法接受控制消息。(1061)

我认为我需要替换 serve_forever（serve_until_stop_received 或其他），或者我需要一些修改 SvcStop 的方法，以便它停止整个服务。

这是一个完整的列表（我已经修剪了包含/评论以节省空间）：

```
class SIMSAPIServerHandler(BaseHTTPServer.BaseHTTPRequestHandler):
    def do_GET(self):
        try:
            reportTuple = self.path.partition("/")
            if len(reportTuple) < 3:
                return
            if reportTuple[2] == "":
                return
            os.system("C:\\Programs\\SIMSAPI\\runCommandReporter.bat " + reportTuple[2])
            f = open("C:\\Programs\\SIMSAPI\\out.xml", "rb")
            self.send_response(200)
            self.send_header('Content-type', "application/xml")
            self.end_headers()
            self.wfile.write(f.read())
            f.close()
            # The output from CommandReporter is simply dumped to out.xml, which we read, write to the user, then remove.
            os.unlink("C:\\Programs\\SIMSAPI\\out.xml")
            return
        except IOError:
            self.send_error(404,'File Not Found: %s' % self.path)

class SIMSAPI(win32serviceutil.ServiceFramework):
    _svc_name_ = "SIMSAPI"
    _svc_display_name_ = "A simple web server"
    _svc_description_ = "Serves XML data produced by SIMS CommandReporter"

    def __init__(self, args):
        win32serviceutil.ServiceFramework.__init__(self, args)
        self.hWaitStop = win32event.CreateEvent(None, 0, 0, None)           

    def SvcStop(self):
            self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
            exit(0)

    def SvcDoRun(self):
        import servicemanager
        servicemanager.LogMsg(servicemanager.EVENTLOG_INFORMATION_TYPE,servicemanager.PYS_SERVICE_STARTED,(self._svc_name_, '')) 

        self.timeout = 3000

        while 1:
            server = BaseHTTPServer.HTTPServer(('', 8081), SIMSAPIServerHandler)
            server.serve_forever()

def ctrlHandler(ctrlType):
    return True

if __name__ == '__main__':
    win32api.SetConsoleCtrlHandler(ctrlHandler, True)
    win32serviceutil.HandleCommandLine(SIMSAPI) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T19:47:49.903

这就是我所做的：

我没有直接实例化 BaseHTTPServer.HTTPServer 类，而是编写了一个新的后代，它发布了一个“停止”方法：

```
class AppHTTPServer (SocketServer.ThreadingMixIn, BaseHTTPServer.HTTPServer):
    def serve_forever(self):
        self.stop_serving = False
        while not self.stop_serving:
            self.handle_request()

    def stop (self):
        self.stop_serving = True 
```

然后，在您已经拥有的方法 SvcStop 中，我调用该方法来中断 serve_forever() 循环：

```
def SvcStop(self):
    self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
    self.httpd.stop() 
```

（self.httpd 是实现网络服务器的 AppHTTPServer() 的实例）

如果您在后台线程上正确使用 setDaemon()，并正确中断服务中的所有循环，则该指令

```
exit(0) 
```

在 SvcStop() 中不应该是必要的

# asp.net - MVP 模式 - 被动视图和通过 IView (Asp.Net, Web Forms) 公开复杂类型

> ID：153222
> 
> 赞同：3
> 
> 时间：2008-09-30T14:17:09.713
> 
> 标签：asp.net, mvp

我最近使用被动视图方法切换到 MVP 模式。当视图界面仅公开基本的 clr 类型时，我觉得使用起来非常舒服，例如映射到 TextBoxes 的字符串、映射到 DropDownLists 的 IDictionary、映射到某些网格的 IEnumerable、转发器。

但是，这最后一种方法只有在我只关心一个列的那些网格中才有效。如何在 IView 中映射网格的多行内容？现在，我想到了两个解决方案，都不是很好：

1.  为网格的内容创建一个 DTO 并在 IView 中公开 IEnumerable，或者
2.  在 IView 中公开 IEnumerable 或仅公开“网格”。

第一个解决方案似乎打破了被动视图规则，同时更接近于监督控制器模式，第二个解决方案完全打破了整个 MVP 模式。你会怎么处理这个？

谢谢， Łukasz

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T14:39:44.013

MVP 使 webforms 开发变得更加容易，除非在这种情况下。但是，如果您使用 TDD 来验证您的 IView 确实*需要*该数据网格，那么我真的看不出问题出在哪里。

我假设你正在尝试做这样的事情：

```
public interface IView
{
 DataTable DataSource {get; set;}
}

public class View : IView {

private GridView _datasource;
public DataSource 
{
  get { return _datasource; }
  set 
  { 
    _datasource = value; 
    _datasource.DataBind(); 
  }
} 
```

当与 MVP 模式一起使用时，我发现这个小模式很有帮助。

# unit-testing - 您如何在 TDD 中组织单元测试？

> ID：153223
> 
> 赞同：25
> 
> 时间：2008-09-30T14:17:28.980
> 
> 标签：unit-testing, tdd

我做 TDD，我在组织单元测试方面相当松散。我倾向于从代表下一个故事或功能块的文件开始，并编写所有单元测试以使其工作。

当然，如果我要引入一个新类，我通常会为该类制作一个单独的单元测试模块或文件，但我不会将测试本身组织成任何更高级别的结构。结果是我快速编写代码，并且我相信我的实际程序结构合理，但是单元测试本身是“混乱的”。特别是，它们的结构倾向于概括发展过程的系统发育。有时我认为自己是在用代码中的懒惰来换取测试中的懒惰。

这是一个多大的问题？谁在这里不断地重构和重组他们的单元测试以试图改进他们的整体结构？对此有什么建议吗？测试的整体结构应该是什么样子。

（请注意，我并不是在问“每个函数有多少断言”问题：[我应该为每个函数/方法编写多少单元测试？](https://stackoverflow.com/questions/110430/how-do-you-organize-unit-tests)我说的是更大的图景。）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-30T14:23:34.020

将您的测试分为 2 组：

*   功能测试
*   单元测试

功能测试是每个用户的故事。单元测试是按类进行的。前者检查你是否真的支持这个故事，后者练习并记录你的功能。

有一个用于功能测试的目录（包）。单元测试应该与它们使用的功能紧密结合（所以它们是分散的）。当您移动和重构代码时，您可以移动它们并重构它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-30T16:02:32.247

不太重要的部分是组织测试。

我首先将测试放入与被测类相关的类中，因此 com.jeffreyfredrick.Foo 有一个测试 com.jeffreyfredrick.FooTest。但是，如果这些类的某些子集需要不同的设置，那么我会将它们移动到它们自己的测试类中。我将我的测试放到一个单独的源目录中，但将它们保存在同一个项目中。

更重要的部分是重构测试。

是的，我尝试重构我的测试。目标是在保持声明性和易读性的同时消除重复。在测试类和跨测试类中都是如此。在测试类中，我可能有一个用于创建测试假（模拟或存根）的参数化方法。我的测试假货通常是测试类中的内部类，但如果我发现有需要，我会将它们拉出来以便在测试中重用。如果合适，我还将创建一个带有常用方法的 TestUtil 类。

我认为重构你的测试对于大型项目的单元测试的长期成功很重要。你有没有听过人们抱怨他们的测试太脆弱或阻止他们改变？您不希望处于更改类的行为意味着对测试进行数十甚至数百次更改的位置。就像代码一样，您可以通过重构和保持测试干净来实现这一点。

测试**就是**代码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T14:20:20.767

我为应用程序中的每个类编写一个单元测试类，并将测试类组织在与被测类相同的包结构中。

在每个测试类中，我并没有太多的组织结构。对于被测类中的每个公共方法，每个方法只有少数方法，因此我在查找所需内容时从来没有遇到任何问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-30T13:32:15.233

对于软件中的每个类，我维护一个单元测试类。单元测试类遵循与被测试类相同的包层次结构。

我将单元测试代码保存在一个单独的项目中。有些人还喜欢将他们的测试代码保存在同一个项目中的一个名为“test”的单独源目录下。你可以跟随任何你觉得舒服的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T14:21:52.510

我尝试将单元测试视为一个项目。与任何项目一样，组织应该遵循一些内部逻辑。然而，它不必是具体的或正式的定义——只要它使您的项目保持井井有条和干净，任何您觉得舒服的东西都可以。

所以对于单元测试，我通常要么遵循主要的项目代码结构，要么（有时当情况需要它时）专注于功能区域。

将它们放在一堆中就像您想象的那样混乱且难以维护

# svn - TSVNCache.exe 正在加热我的 Mac

> ID：153226
> 
> 赞同：2
> 
> 时间：2008-09-30T14:18:06.623
> 
> 标签：svn, tortoisesvn, tsvncache

我在 VMWare 分区中运行 Windows。有时，TSVNCache.exe 进程开始做一些奇怪的事情（似乎它在做一个无限循环的 I/O 操作）。突然间，我的整个 VMWare 会话开始变慢。我的 Mac 发热严重。从某种意义上说，它非常热。

我的问题是这个 TSVNCache 进程到底是什么？，似乎没有它我可以在 SVN 存储库上做几乎所有事情。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T14:21:53.120

这就是在资源管理器中生成覆盖图标的原因，这些图标告诉您文件/目录是否被修改、冲突等。

最近有几个修复，请确保您拥有最新版本的 TortoiseSVN。如果您最小化 SVN 必须检查的一组内容，性能也会提高 - 告诉它忽略任何临时目录、目标文件目录等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T14:38:00.430

这是乌龟SVN图标覆盖过程，在乌龟设置中禁用图标覆盖以使其消失。如果您想查看图标覆盖，（在 Windows 资源管理器中指示文件是否已更新、修改、冲突等的图标）您必须在进程挂起时终止该进程，然后按 f5 或重新启动 Windows 资源管理器以便它重新启动和显示正确和更新的图标覆盖。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T18:49:41.400

该进程在后台查找状态更改。默认情况下，它将监视系统上的所有文件，因此您应该限制在您有结帐的目录中。进入 TortoiseSVN -> Settings -> Look and Feel -> Icon Overlays 并设置排除路径和包含路径。此外，如果您不关心查看深层状态，则“状态缓存”中的“默认”更改为“外壳”

# python - 扩展功能和“帮助”

> ID：153227
> 
> 赞同：1
> 
> 时间：2008-09-30T14:18:14.407
> 
> 标签：python, cpython

当我打电话

```
help(Mod.Cls.f) 
```

（Mod 是一个 C 扩展模块），我得到了输出

```
关于method_descriptor的帮助：

F（...）
    文档字符串
```

我需要做什么才能使帮助输出具有以下形式

```
模块 Mod 中方法 f 的帮助：

f(x, y, z)
    文档字符串
```

例如，就像 random.Random.shuffle 一样？

我的 PyMethodDef 条目当前是：

```
{ "f", f, METH_VARARGS, "doc_string" } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T14:26:30.910

你不能。'pydoc' 和 'help()' 使用的检查模块无法弄清楚 C 函数的确切签名是什么。你能做的最好的就是内置函数的作用：在文档字符串的第一行包含签名：

```
>>> help(range)
Help on built-in function range in module __builtin__:

range(...)
    range([start,] stop[, step]) -> list of integers

... 
```

random.shuffle 的文档字符串看起来“正确”的原因是它不是 C 函数。这是一个用 Python 编写的函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T17:35:36.197

当然，托马斯的回答是对的。

我只想补充一点，许多 C 扩展模块在它们周围都有一个 Python“包装器”，这样它们就可以支持标准函数签名和其他动态语言特性（例如描述符协议）。

# unit-testing - 你的单元测试有多深？

> ID：153234
> 
> 赞同：88
> 
> 时间：2008-09-30T14:19:14.593
> 
> 标签：unit-testing, tdd

我发现关于 TDD 的一点是，设置测试需要时间，而且我天生懒惰，我总是希望编写尽可能少的代码。我似乎做的第一件事是测试我的构造函数是否设置了所有属性，但这是否矫枉过正？

我的问题是您编写单元测试的粒度级别是多少？

..是否存在测试过多的情况？

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2008-09-30T15:30:47.823

我为有效的代码而不是测试获得报酬，所以我的理念是尽可能少地进行测试以达到给定的信心水平（我怀疑与行业标准相比，这种信心水平很高，但这可能只是狂妄自大） . 如果我通常不会犯某种错误（例如在构造函数中设置错误的变量），我不会对其进行测试。我确实倾向于理解测试错误，所以当我有复杂条件的逻辑时我会格外小心。在团队中编码时，我会修改我的策略以仔细测试我们共同容易出错的代码。

基于这种理念，不同的人会有不同的测试策略，但考虑到对如何最好地适应编码内部循环的理解还不成熟，这对我来说似乎是合理的。十年或二十年后，我们可能会有一个更普遍的理论来说明哪些测试可以写，哪些测试不可以写，以及如何区分。与此同时，实验似乎是有序的。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-30T14:42:26.503

为您希望破坏的事物和边缘情况编写单元测试。在那之后，测试用例应该随着错误报告的出现而被添加——在为错误编写修复之前。然后，开发人员可以确信：

1.  该错误已修复；
2.  该错误不会再次出现。

根据附加的评论 - 我猜这种编写单元测试的方法可能会导致问题，如果随着时间的推移在给定的类中发现了很多错误。这可能是自由裁量权有用的地方——只为可能再次发生的错误添加单元测试，或者这些错误再次发生会导致严重问题。我发现单元测试中的集成测试度量在这些场景中可能会有所帮助 - 测试代码路径较高的代码可以覆盖较低的代码路径。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-30T14:26:39.397

> 一切都应该尽可能简单，但不能简单。- A.爱因斯坦

关于 TDD 最容易被误解的事情之一就是它的第一个词。测试。这就是 BDD 出现的原因。因为人们并没有真正理解第一个 D 是重要的，即 Driven。我们都倾向于对测试思考得有点多，而对设计的驱动思考得有点少。而且我想这是对您的问题的模糊回答，但是您可能应该考虑如何驱动代码，而不是实际测试的内容；这是 Coverage-tool 可以帮助您解决的问题。设计是一个更大、更成问题的问题。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-17T05:29:44.707

**对于那些建议测试“一切”的人：**意识到“完全测试”这样的方法`int square(int x)`需要在通用语言和典型环境中使用大约 40 亿个测试用例。

事实上，它甚至比这更糟糕：一个方法`void setX(int newX)`也必须*不*改变任何其他成员的值，除了`x`- 你是否测试`obj.y`,`obj.z`等在调用之后都保持不变`obj.setX(42);`？

**只有测试“一切”的一个子集才实用。** 一旦你接受了这一点，考虑不测试难以置信的基本行为就变得更容易接受了。每个程序员都有一个错误位置的*概率分布*；聪明的方法是将你的精力集中在你估计错误概率很高的测试区域上。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-30T14:23:13.973

经典答案是“测试任何可能破坏的东西”。我将其解释为意味着测试除了 set 或 get 之外不做任何事情的 setter 和 getter 可能是太多的测试，不需要花时间。除非您的 IDE 为您编写这些，否则您也可以这样做。

如果您的构造函数*未*设置属性可能会在以后导致错误，那么测试它们是否已设置并不过分。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-30T14:38:35.373

我编写测试来涵盖我将要编写的类的假设。测试强制执行要求。本质上，例如，如果 x 永远不会是 3，我将确保有一个测试可以满足该要求。

总是，如果我不写一个测试来覆盖一个条件，它会在稍后的“人类”测试中出现。我当然会写一篇，但我宁愿早点赶上。我认为关键是测试很乏味（也许）但很有必要。我写了足够多的测试来完成，但仅此而已。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-30T15:26:17.083

现在跳过简单测试的部分问题是将来重构可能会使这个简单的属性变得非常复杂，并带有很多逻辑。我认为最好的想法是您可以使用测试来验证模块的要求。如果当你通过 X 时你应该得到 Y 回来，那么这就是你想要测试的。然后，当您稍后更改代码时，您可以验证 X 是否为您提供 Y，并且您可以为 A 提供 B 的测试，稍后添加该要求时。

我发现我在最初的开发编写测试中花费的时间在第一次或第二次错误修复中得到了回报。能够获取您在 3 个月内未查看过的代码并合理地确定您的修复程序涵盖了所有情况，并且“可能”不会破坏任何内容，这是非常有价值的。您还会发现单元测试将有助于对错误进行分类，远远超出堆栈跟踪等。查看应用程序的各个部分如何工作和失败可以深入了解它们作为一个整体工作或失败的原因。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-30T15:46:59.170

在大多数情况下，我会说，如果那里有逻辑，请测试它。这包括构造函数和属性，尤其是在属性中设置了多个事物时。

关于过多的测试，这是值得商榷的。有人会说应该测试所有东西的健壮性，其他人说为了有效的测试，只有可能破坏的东西（即逻辑）才应该被测试。

仅从个人经验来看，我更倾向于第二个阵营，但如果有人真的决定测试所有东西，我不会说这太过分了……对我来说可能有点矫枉过正，但对他们来说不是太多。

所以，不 - 我会说一般意义上的“太多”测试并不存在，仅针对个人。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-30T14:58:44.467

测试驱动开发意味着您在所有测试都通过时停止编码。

如果您没有对属性进行测试，那么为什么要实施它？如果您不测试/定义在“非法”分配的情况下的预期行为，该属性应该做什么？

因此，我完全是为了测试一个班级应该表现出的每一个行为。包括“原始”属性。

为了使这个测试更容易，我创建了一个简单的 NUnit `TestFixture`，它提供了用于设置/获取值的扩展点，并获取有效和无效值的列表，并有一个测试来检查属性是否正常工作。测试单个属性可能如下所示：

```
[TestFixture]
public class Test_MyObject_SomeProperty : PropertyTest<int>
{

    private MyObject obj = null;

    public override void SetUp() { obj = new MyObject(); }
    public override void TearDown() { obj = null; }

    public override int Get() { return obj.SomeProperty; }
    public override Set(int value) { obj.SomeProperty = value; }

    public override IEnumerable<int> SomeValidValues() { return new List() { 1,3,5,7 }; }
    public override IEnumerable<int> SomeInvalidValues() { return new List() { 2,4,6 }; }

} 
```

使用 lambdas 和属性，这甚至可以写得更紧凑。我收集 MBUnit 甚至对这样的事情有一些本机支持。关键是上面的代码捕获了属性的意图。

PS：PropertyTest 可能还应该有一种方法来检查对象上的**其他**属性是否没有改变。嗯..回到绘图板。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T14:47:41.637

我进行单元测试以达到最大可行覆盖率。如果我无法达到某些代码，我会重构，直到覆盖范围尽可能完整

完成盲写测试后，我通常会编写一个测试用例来重现每个错误

我习惯于区分代码测试和集成测试。在集成测试期间（这也是单元测试，但在组件组上，所以不完全是单元测试的用途）我将测试正确实现的需求。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-28T12:39:25.337

所以我越是通过编写测试来推动我的编程，我就越不担心测试的粒度级别。回想起来，似乎我正在做最简单的事情来实现验证**行为**的目标。这意味着我对我的代码正在做我要求做的事情产生了一层信心，但这并不被认为是我的代码没有错误的绝对保证。我觉得正确的平衡是测试标准行为，也许是一两个边缘情况，然后继续我的设计的下一部分。

我接受这不会涵盖所有错误并使用其他传统测试方法来捕获这些错误。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-30T14:25:10.523

通常，我从小处着手，输入和输出我知道必须有效。然后，当我修复错误时，我会添加更多测试以确保对我修复的内容进行测试。它是有机的，对我来说效果很好。

你可以测试太多吗？可能，但总的来说，最好还是谨慎行事，尽管这取决于您的应用程序的任务关键程度。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-30T14:27:48.253

我认为您必须在业务逻辑的“核心”中测试所有内容。Getter 和 Setter 也是因为它们可以接受您可能不想接受的负值或空值。如果你有时间（总是取决于你的老板），最好测试其他业务逻辑和调用这些对象的所有控制器（你从单元测试慢慢地进入集成测试）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T14:31:02.163

我不会对没有副作用的简单 setter/getter 方法进行单元测试。但我对所有其他公共方法进行单元测试。我尝试为我的算法中的所有边界条件创建测试，并检查我的单元测试的覆盖率。

它的工作量很大，但我认为这是值得的。我宁愿编写代码（甚至测试代码）也不愿在调试器中单步执行代码。我发现代码-构建-部署-调试周期非常耗时，而且我集成到构建中的单元测试越详尽，我花费在代码-构建-部署-调试周期上的时间就越少。

你也没有说你为什么要编码架构。但对于 Java，我使用[Maven 2](http://maven.apache.org)、[JUnit](http://junit.org)、[DbUnit](http://www.dbunit.org)、[Cobertura](http://cobertura.sourceforge.net)和[EasyMock](http://easymock.org)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-06T18:54:22.690

我读得越多，我就越觉得一些单元测试就像一些模式：语言不足的味道。

当您需要测试您的普通 getter 是否真的返回正确的值时，这是因为您可能会混合 getter 名称和成员变量名称。输入 'attr_reader :name' of ruby​​，这种情况就不会再发生了。在java中是不可能的。

*如果*你的吸气剂变得不平凡，你仍然可以为它添加一个测试。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-07-17T12:09:19.803

测试让你担心的源代码。

对测试您非常有信心的部分代码没有用处，只要您不犯错误即可。

测试错误修复，以便这是您第一次也是最后一次修复错误。

测试以获得对晦涩代码部分的信心，以便您创造知识。

在重重构和中重构之前进行测试，以免破坏现有功能。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-06-09T03:33:27.450

这个答案更多地用于确定由于其重要性/重要性而知道要对给定方法使用多少单元测试。使用McCabe 的**基础路径测试**技术，您可以执行以下操作以定量地获得比简单的“语句覆盖”或“分支覆盖”更好的代码覆盖置信度：

1.  确定要进行单元测试的方法的圈复杂度值（例如，Visual Studio 2010 Ultimate 可以使用静态分析工具为您计算；否则，您可以通过流程图方法手动计算 - [http://users.csc。 calpoly.edu/~jdalbey/206/Lectures/BasisPathTutorial/index.html](http://users.csc.calpoly.edu/~jdalbey/206/Lectures/BasisPathTutorial/index.html)）
2.  列出流经您的方法的基本独立路径集 - 请参阅上面的链接以获取流程图示例
3.  为步骤 2 中确定的每个独立基础路径准备单元测试

# sql - 有人可以给我一个关于 lucene.net 工作原理的概述吗？

> ID：153242
> 
> 赞同：11
> 
> 时间：2008-09-30T14:20:25.010
> 
> 标签：sql, sql-server, full-text-search, lucene, lucene.net

我有一个 MS SQL 数据库，并且有一个`varchar`我想做查询的字段，例如 `where name like '%searchTerm%'`. 但是现在它太慢了，即使使用 SQL 企业的全文索引。

有人可以解释一下如何`Lucene .Net`帮助我的情况吗？索引器如何工作？查询如何工作？

为我做了什么，我必须做什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T14:59:15.400

我在一次用户组会议上看到这个人（Michael Neel）出现在 Lucene 上 - 实际上，您构建索引文件（使用 Lucene）并且它们有指向任何你想要的（数据库行，等等）的指针

[http://code.google.com/p/vinull/source/browse/#svn/Examples/LuceneSearch](http://code.google.com/p/vinull/source/browse/#svn/Examples/LuceneSearch)

非常快速、灵活且功能强大。

Lucene 的优点是能够使用 Lucene 在您自己的索引中将各种事物（文件、图像、数据库行）一起索引，然后将其转换回您的业务域，而对于 SQL Server，这一切都必须在 SQL 中被索引。

看起来他的幻灯片不在 Google 代码中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T14:32:54.327

这篇[文章](http://blog.scalingweb.com/2007/11/03/full-text-search-for-database-using-lucene-search-engine/)（奇怪的是它在谷歌搜索结果的顶部：）对如何优化 Lucene 搜索有相当好的描述。

正确配置的 Lucene 应该可以轻松击败 SQL（2005 年之前）全文索引搜索。如果您使用 MS SQL 2005 并且您的搜索性能仍然太慢，您可能会考虑检查您的数据库设置。

# c# - 以编程方式创建 Excel 2007 表格

> ID：153248
> 
> 赞同：14
> 
> 时间：2008-09-30T14:21:26.303
> 
> 标签：c#, .net, excel

我正在尝试以编程方式创建 Excel 2007 文档。现在，我找到了两种方法：

*   [如本文](https://stackoverflow.com/questions/150339/generating-an-excel-file-in-aspnet#150368)所述，手动创建 XML
*   [使用ExcelPackage](http://www.codeplex.com/ExcelPackage)等第三方库。

目前，我使用 ExcelPackage，它有一些非常严重的缺点和问题。因为我不需要创建过于复杂的 Excel 工作表（最“复杂”的事情是我明确需要将单元格类型设置为数字或文本），所以我接下来正在寻找选项 1，但我只是想知道是否有生成 Excel 2007 表格的任何其他良好且受支持的方法？如果可以创建它们而不必将它们保存到硬盘驱动器，即生成它们并将它们直接输出到流中，则可以得到奖励积分。

.net 3.0 是这里的目标，没有 3.5 的好处 :(

**编辑：**到目前为止谢谢。XML SDK 确实只是 3.5，但俄罗斯轮​​盘...呃... COM 互操作也是我想尽可能避免的事情，特别是因为 Excel 2007 有一些复杂但仍然很容易创建文档格式。我会看看发布的各种链接和提示。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T14:25:43.190

您可以尝试使用[Office Open XML SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=c6e744e5-36e9-45f5-8d8c-331df206e0d0&DisplayLang=en)。这将允许您使用say a 在内存中创建Excel 文件，`MemoryStream`并且比手动生成所有XML 更容易。

正如 Brian Kim 指出的，SDK 2.0 版需要.NET 3.5，您说它不可用。还提供支持 .NET 3.0 的 SDK[版本 1 。](http://www.microsoft.com/downloads/details.aspx?FamilyId=AD0B72FB-4A1D-4C52-BDB5-7DD7E816D046&displaylang=en)它并不完整，但至少可以帮助您管理文档的 XML 部分以及它们之间的关系。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T08:30:15.687

我只是生成 HTML 表格，可以通过 Excel 打开：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Wnioski</title>
<style type="text/css">
<!--
br { mso-data-placement: same-cell; }
td { mso-number-format: \@; mso-displayed-decimal-separator: "."; }
-->
</style>

<table>
<tr style="height:15.0pt">
<td style="mso-number-format: general">474</td>
<td>474</td>

<tr>
<td>data2</td>
<td>data3</td>

<tr>
<td style="mso-number-format: &quot;yyyy-mm-dd&quot;">2008-10-01</td>
<td style="mso-number-format: standard">0.00</td>

<tr>
<td style="mso-number-format: general">line1<br>line2<br>line3</td>
<td></td>

</table> 
```

这也可以作为 Word 中串行字母的数据源，与 OpenOffice calc 等一起使用。而且生成起来非常简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T21:32:15.940

*我打算对 BKimmel 的帖子发表评论，但显然我还没有足够的酷点。*

如果 Excel 已经打开，您会收到烦人的“personal.xls 已打开”消息。我尝试先获取应用程序。如果失败，则创建它：

```
On Error Resume Next
Set myxlApp  = GetObject(, "Excel.Application")
If Err.Number <> 0 Then
  Err.Clear
  Set myxlApp = CreateObject("Excel.Application")
  If Err.Number <> 0 Then
    ' return False, show message, etc.
  End If
End If 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T07:26:52.370

[我在SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)中完成了大部分 Open XML (xlsx) 工作，这绝非简单的练习。我建议使用 Office Open XML SDK 或其他 3rd 方库，如 SpreadsheetGear 或我们的竞争对手之一（只需谷歌“SpreadsheetGear”即可查看我们的竞争对手是谁）。

SpreadsheetGear for .NET 似乎可以满足您的需求：

*   适用于 .NET 2.0、.NET 3.0 和 .NET 3.5。
*   支持使用 IWorkbook.SaveToStream 写入流或使用 IWorkbook.SaveToMemory 写入字节数组。
*   支持 Excel 97-2003 (xls) 工作簿，如果您需要支持非常多的用户，这很可能是您接下来需要做的事情。

[您可以在此处](https://www.spreadsheetgear.com/downloads/register.aspx)下载免费的全功能评估。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T14:27:11.733

我曾经使用函数库为表格和段落创建正确的 XML来生成[文字处理标记文档。](http://msdn.microsoft.com/en-us/library/aa223586(office.11).aspx)

然后，我将 Response 标头的 MIME 类型更改为 word 文档，并将 XML 作为响应发送给客户端。它要么在他们的浏览器中打开，要么另存为文件。

[尽管有MS Open XML SDK](http://www.microsoft.com/downloads/details.aspx?FamilyId=AD0B72FB-4A1D-4C52-BDB5-7DD7E816D046&displaylang=en)，但似乎没有相同的 2003 SDK for Excel

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T14:27:40.000

Excel 通过 COM 对象非常可编写脚本。我没有尝试过，但这应该是一个可靠的解决方案，虽然既不快速也不轻量级。

无论您最终做什么，请检查您的解决方案是否支持 Unicode。使用现有解决方案编写 xls 文件（即 2007 年之前的文件）时，我遇到了一些严重的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T14:29:18.000

您可以使用主互操作程序集（Office API）以编程方式生成 Excel 文档——我不想使用它们做任何过于复杂的事情，但听起来这不是您的要求。

这种方法也适用于在内存中生成文档。

以下是一些资源：

*   [安装主互操作程序集](http://msdn.microsoft.com/en-us/library/kh3965hw(VS.80).aspx)
*   [如何创建新的 Excel 工作簿](http://msdn.microsoft.com/en-us/library/x80526fk(VS.80).aspx)（来自 MSDN）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T21:00:06.330

每个活着的代码势利小人都讨厌 vbscript，但它很简单而且很有效：

```
Set myxlapp = CreateObject("Excel.Application")
Set mywb = myxlapp.Workbooks.Add
myxlapp.Visible = true 
```

把它放在一个文本文件中，在最后附加一个“.vbs”然后转瞬即逝。

# c++ - Vista 上的随机 MoveFileEx 失败

> ID：153257
> 
> 赞同：7
> 
> 时间：2008-09-30T14:22:21.713
> 
> 标签：c++, windows, winapi, windows-vista

我注意到在 Vista 上写入文件、关闭文件并将其移动到目标位置随机失败。具体来说，MoveFileEx() 会`ERROR_ACCESS_DENIED`无缘无故地返回。这至少发生在 Vista SP1（32 位）上。在 XP SP3 上不会发生。

在互联网上找到[这个线程](http://groups.google.com/group/microsoft.public.windows.file_system/browse_thread/thread/e9774e86e98eb623/3348d92b8ba5858d?lnk=raot&pli=1)关于完全相同的问题，没有真正的解决方案。到目前为止，该错误似乎是由 Vista 的搜索索引器引起的，见下文。

给出的代码示例足以重现该问题。我也把它贴在这里：

```
#include <windows.h>
#include <stdlib.h> 
#include <stdio.h> 

bool test() {
    unsigned char buf[] = {
        0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 
        0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99 
    }; 
    HANDLE h; 
    DWORD nbytes; 
    LPCTSTR fn_tmp = "aaa"; 
    LPCTSTR fn = "bbb"; 
    h = CreateFile(fn_tmp, GENERIC_WRITE, FILE_SHARE_READ | FILE_SHARE_WRITE, 0, OPEN_ALWAYS, 0, 0); 
    if (h == INVALID_HANDLE_VALUE) return 0; 
    if (!WriteFile(h, buf, sizeof buf, &nbytes, 0)) goto error; 
    if (!FlushFileBuffers(h)) goto error; 
    if (!CloseHandle(h)) goto error; 
    if (!MoveFileEx(fn_tmp, fn, MOVEFILE_REPLACE_EXISTING | MOVEFILE_COPY_ALLOWED | MOVEFILE_WRITE_THROUGH)) { 
        printf("error=%d\n", GetLastError()); 
        return 0; 
    } 
    return 1; 
error: 
    CloseHandle(h); 
    return 0; 
} 

int main(int argc, char** argv) { 
    unsigned int i; 
    for (i = 0;; ++i) { 
        printf("*%u\n", i); 
        if (!test()) return 1; 
    } 
    return 0; 
} 
```

使用 Visual Studio 将其构建为控制台应用程序。正确的行为是打印测试编号的无限循环。在 Vista SP1 上，程序在随机迭代次数后退出（通常在进行 100 次迭代之前）。

这在 Windows XP SP2 上不会发生。根本没有运行防病毒软件；并且没有其他奇怪的后台进程（机器几乎是 vanilla OS install + Visual Studio）。

**编辑**：通过进程监视器进一步挖掘（感谢@sixlettervariables），我看不到任何特别糟糕的事情。每次测试迭代都会产生 176 次磁盘操作，其中大部分来自 SearchProtocolHost.exe（搜索索引器）。如果停止搜索索引服务，则不会发生错误，因此看起来它是罪魁祸首。

在失败时（当应用程序获取时`ERROR_ACCESS_DENIED`），SearchProtocolHost.exe 有两个 CreateFile(s) 到以读/写/删除共享模式打开的目标文件 (bbb)，所以应该没问题。其中一个打开之后是机会锁定（`FSCTL_REQUEST_FILTER_OPLOCK`），也许这就是原因？

无论如何，我发现我可以通过在文件上设置`FILE_ATTRIBUTE_TEMPORARY`和`FILE_ATTRIBUTE_NOT_CONTENT_INDEXED`标志来避免这个问题。它本身看起来`FILE_ATTRIBUTE_NOT_CONTENT_INDEXED`就足够了，但是将文件标记为临时文件也大大减少了由搜索索引器引起的磁盘操作。

但这**并不是真正的解决方案**。我的意思是，如果一个应用程序不能指望能够创建一个文件并重命名它，因为某些 Vista 的搜索索引器正在搞乱它，**那真是太疯狂了**！它应该继续重试吗？对用户大喊大叫（这是非常不可取的）？做点别的吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T15:21:01.573

我建议您使用[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx) *（编辑：艺术家以前称为 FileMon）*来观察并查看究竟是哪个应用程序妨碍了您。它可以向您显示在您的机器上进行的文件系统调用的整个跟踪。

*（编辑：感谢@moocha 更改应用程序）*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:13:16.960

我会说是您的防病毒软件或 Windows 索引同时弄乱了文件。您可以在没有防病毒软件的情况下运行相同的测试吗？然后再次运行它，确保临时文件是在没有被 Windows Search 索引的地方创建的？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T15:18:09.473

这通常意味着其他东西对相关文件有一个打开的句柄，也许是一个正在运行的活动病毒扫描程序？您是否尝试[过从 Sysinternals](http://technet.microsoft.com/en-us/sysinternals/default.aspx)站点运行诸如 Process Monitor 之类的东西？您应该过滤所有文件操作并更好地了解引擎盖下发生的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T20:56:48.467

Windows 有一个用于存储应用程序文件的特殊位置，我认为它没有索引（至少默认情况下没有）。在 Vista 中，路径是：

C:\Users\*user name*\AppData

I suggest you put your files there if it is appropriate for your application.

# scrum - 管理 Scrum 软件

> ID：153260
> 
> 赞同：23
> 
> 时间：2008-09-30T14:22:49.263
> 
> 标签：scrum

您使用什么软件来管理 Scrum 软件开发？

到目前为止，我们已经尝试过 Tackle 和 VersionOne（都是免费的），它们都很好，只是很难跟踪正在进行的工作。例如，如果我有一项我估计需要 8 小时才能完成的任务，我已经完成了 4 小时的工作，还剩 4 小时，该任务总是报告为还剩 8 小时，直到它被标记为完成，此时它下降到零。

我想使用一种工具，使我能够在每周结束时在团队 WIP 中进行准确的工作，并查看该工作对截止日期以及已完成的任务产生了多大的影响。

感谢您的输入！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T15:00:44.617

我推荐一个白板和 Excel 电子表格。白板有故事卡（索引卡），用于跟踪正在进行的工作。故事卡以 8 小时开始，随着工作的进行，卡片上的数字会递减。在一天结束时，将卡片中的数字放入电子表格中。

白板始终可见，并让整个团队了解工作的进展情况。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T20:15:22.897

[最近](https://stackoverflow.com/questions/35760/best-scrum-tools#52817)有人问这个问题： 。

提到了从 Excel 到 VersionOne 到 Scrumworks 到 BaseCamp 的所有内容。

不过，就个人而言，我们使用高度定制的 Excel 表格、白板、各种颜色的索引卡和大软木板。

您可能还想查看[Mingle](http://studios.thoughtworks.com/mingle-project-intelligence)。它是由只做敏捷的公司 ThoughtWorks 开发的工具。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-05-11T15:56:23.297

我们已经查看了大多数工具，最终选择了[Scrumwise](http://www.scrumwise.com/)。我们已经使用它一段时间了，它非常易于使用，并且可以满足我们的需要。它使用每个任务的剩余时间来计算燃尽等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-09T08:35:08.900

我注意到没有人指出对 WIP（正在进行的工作）的误解。

在敏捷中，“只有完成了才完成”。

虽然大多数人认为完成工作是一件好事，但事实并非如此。WIP 代表尚未实现的投资。这是敏捷的重要组成部分，但在精益/看板中更加明确。

如果您跟踪已完成的工作，您将鼓励开发人员同时处理几件事情，让所有事情都完成“80%”。在项目结束时，您将花费 4 倍（80% 的时间）在“错误修复”上，完成最后的 20%。你会看起来比计划提前，但你会超负荷运行。

同样在一个 sprint 之后，如果工作包很小（如果你在做 scrum，它们会很小），那么没有将部分完成的工作添加到完成的工作的错误是微不足道的。

因此：将 WIP 与已完成的工作分开跟踪，并尽量将其保持在较低水平。

## 妥协

作为一种折衷方案，您可以使用以下规则跟踪已完成的部分：

*   每个开发人员只跟踪一项任务。（可能是最大的）
*   添加一个上限，也许是 1/2 冲刺。
*   折扣率，可能是 50%，如果完成了 80%，则报告 40%。（有证据时调整折扣率，但不要让它高达 100%）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-11T23:01:55.137

[OnTime](http://axosoft.com/ontime/scrum)最近增加了对 Scrum 管理的支持（免责声明：我为他们工作并帮助构建产品）。:) 如果您需要更多信息，我们还为 Scrum 制作了一个介绍视频：[视频](http://axosoft.com/ontime/videos/scrum)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-19T10:28:20.483

我正在查找 SCRUM 软件，发现了这个老话题 - 只是我的两分钱....

我在医疗保健领域的一个项目上工作了大约一年，我们使用的是版本一。很抱歉，它可能是项目中最被鄙视的工具。测试人员尤其讨厌它。我们开发人员也不喜欢它，因为它非常笨重/缓慢而且通常非常昏昏欲睡。我们总是从 V1 获得出色的客户支持，但该工具并没有为我们提供帮助。

我现在在另一个项目中工作，我们正在使用 www.scrumwise.com - 到目前为止一切都很好......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-03T12:27:14.973

我一直在开发一个基于 Web 的开源工具，您可以在现场安装或使用我们的托管版本。我们有子任务跟踪和实时规划扑克功能。

[http://www.scrumdo.com/](http://www.scrumdo.com/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T14:58:45.153

[VersionOne](http://www.versionone.com) **确实**允许您随时更改估计值 - 否则，燃尽报告将无法正常工作。您可能隐藏了估算列或将其设置为只读 - 单击右侧的扳手以列出可用列并确保估算/待办事项列是可编辑的。

我们发现它相当不错，尽管他们对自定义控件的奇怪坚持在 Chrome 中中断了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-05-24T20:31:37.837

[我在https://stackoverflow.com/a/16667842/1810290](https://stackoverflow.com/a/16667842/1810290)回答了一个类似的问题，我也想在这里分享它。

如果您正在寻找在线 scrum 工具，那么您可以看看[Flying Donut](https://www.flying-donut.com)。这是一个新的在线产品，我在我的项目中使用它并取得了很大的成功。有一种组织积压工作的好方法，它的 GUI 很干净，响应时间很快。它为计划、执行和审查提供了不同的迭代视图。

**免责声明**：自从我帮助构建它以来，我已经使用它好几个月了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-03-22T19:07:47.027

我建议查看 OnTime 的规划板，因为当您可以使用软件自动化流程时，使用 excel 和实际的白板会缩短实际开发时间。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2011-03-17T18:04:42.400

[在http://www.bellacode.com](http://www.bellacode.com)查看 Scrum Pig 。对于使用 Scrum 进行协作的团队来说，它是一个很棒的 Windows 工具。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2011-03-29T09:38:51.507

我们将[RallyDev](https://rallydev.com)用于 scrum 管理系统。我发现它非常方便。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-10-02T00:18:14.660

我用过这个[索引卡生成器](http://www.crisp.se/henrik.kniberg/scrum/index-card-generator/excel-access/)，但我现在看到有一个更新版本的[链接](http://blog.crisp.se/henrikkniberg/2007/12/18/1197973740000.html)，它只使用 Excel

在尝试估算时，我也喜欢他们的[Planning Poker 。](http://www.crisp.se/planningpoker/)

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-10-27T17:16:42.307

刚看到这个，可能在另一个堆栈中O q/a，[https: //scrumy.com/demo](https://scrumy.com/demo)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-09-30T14:48:08.580

ScrumWorks 非常适合小型团队。基本版本也是免费的。我们有大约 30 名开发人员，他们有多个项目/迭代/等。一些基本的燃尽图，适合“昨天的天气”等。

在以下位置查看：

[http://danube.com/scrumworks/basic](http://danube.com/scrumworks/basic)

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-09-30T14:55:31.150

我认为 RallyDev 可能值得您一试。除非我弄错了它跟踪时间的方式，否则不会导致您上面提到的问题。

几个月来，我们一直在我们的项目中使用它，并且随着它的发展而发展到团队喜欢使用该项目的地方。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-09-30T14:56:45.937

我们使用[Scrum for Team System](http://www.scrumforteamsystem.com/en/default.aspx)非常棒，但您确实需要使用 Visual Studio Team System 才能获得它！

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2011-10-13T09:25:00.907

没有人提到 JIRA，这是成本/开源的事情吗？

在过去的 3 年里，我一直在使用 JIRA，并且发现它是一个出色的工具。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2012-06-23T21:41:17.617

我们还使用带有 google 电子表格的物理板作为在线副本。如果每个人都养成维护两者的习惯，它的效果非常好，并且不会真正增加任何开销。我已经在博客中介绍了它并包含了一个示例电子表格：

[http://www.littlebluemonkey.com/blog/online-scrum-tools-part-1-the-scrum-board/](http://www.littlebluemonkey.com/blog/online-scrum-tools-part-1-the-scrum-board/)

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2008-09-30T15:00:29.627

我们使用[了 XPlanner](http://xplanner.org/)。这很简单，但它的工作做得很好。特别是开发人员可以很好地了解他们的当前状态。

# active-directory - NTFRS 问题 - 2003 服务器上缺少 Sysvol 和 Netlogon

> ID：153263
> 
> 赞同：0
> 
> 时间：2008-09-30T14:23:25.097
> 
> 标签：active-directory

这是一个影响我的问题。虽然这个描述不是我写的（见 www.experts-exchange.com (1)，其中一种网站 stackoverflow 的创建是因为）它适用于我遇到的问题的 95%。下次我不会遵循 MS 的建议时，该域一直在工作，直到我在事件日志上尝试了建议的解决方案（“启用日志包装自动还原”）。这是一个多么大的错误！！！！

描述（如（1）所示）如下：

(1) [http://www.experts-exchange.com/OS/Microsoft%5fOperating%5fSystems/Server/Windows%5f2003%5fActive%5fDirectory/Q%5f22871376.html](http://www.experts-exchange.com/OS/Microsoft%5fOperating%5fSystems/Server/Windows%5f2003%5fActive%5fDirectory/Q%5f22871376.html)

---------- 剪辑从这里开始 ----------

我在使用 2003 SBS 服务器时遇到了一些明显严重的问题。

我们刚刚开始为一个项目将第二个域控制器放入此网络的过程。

在开始现场环境之前，我在实验室环境中执行了相同的任务，并且没有任何问题。

首先，我们将 SBS（tisserver）升级到 2003 R2。之后，我进行了 adprep 以将架构更新为 R2。

我建立了 2003 R2 服务器 (tisdr)，安装了 DNS，将其加入域并进行了 DCPROMO。

这一切都很好，但我在新服务器上的文件复制服务事件日志中发现了错误：

* * *

事件 ID 13508 - 源 NtFRS

* * *

文件复制服务无法使用 DNS 名称 tisserver.TIS.local 为 c:\windows\sysvol\domain 启用从 tisserver.TIS.local 到 TISDR 的复制。FRS 将继续重试。以下是您会看到此警告的一些原因。

[1] FRS 无法从这台计算机正确解析 DNS 名称 tisserver.TIS.local。[2] FRS 未在 tisserver.TIS.local 上运行。[3] 此副本的 Active Directory 中的拓扑信息尚未复制到所有域控制器。

此事件日志消息将在每个连接中出现一次，问题解决后，您将看到另一条事件日志消息，表明连接已建立。

[有关详细信息，请参阅http://go.microsoft.com/fwlink/events.asp](http://go.microsoft.com/fwlink/events.asp)上的帮助和支持中心。

* * *

当我去检查 SBS 时，我发现出现了以下错误：

* * *

Eventid ID 13568 - 源 NtFrs

* * *

文件复制服务检测到副本集“DOMAIN SYSTEM VOLUME (SYSVOL SHARE)”在 JRNL_WRAP_ERROR 中。

副本集名称为：“DOMAIN SYSTEM VOLUME (SYSVOL SHARE)” 副本根路径为：“c:\windows\sysvol\domain” 副本根卷为：“\.\C:”它试图从 NTFS USN 日志中读取，但未找到。这可能是由于以下原因之一。

[1] 卷 "\.\C:" 已被格式化。[2] 卷 "\.\C:" 上的 NTFS USN 日志已被删除。[3] 卷 "\.\C:" 上的 NTFS USN 日志已被截断。如果 Chkdsk 在日志末尾发现损坏的条目，它可以截断日志。[4] 文件复制服务长时间未在此计算机上运行。[5] 文件复制服务无法跟上“\.\C:”上磁盘 IO 活动的速率。将“Enable Journal Wrap Automatic Restore”注册表参数设置为 1 将导致执行以下恢复步骤以自动从此错误状态中恢复。[1] 在 5 分钟后发生的第一次轮询中，这台计算机将从副本集中删除。如果您不想等待 5 分钟，请运行“net stop ntfrs”，然后运行“

警告：在恢复过程中，副本树中的数据可能不可用。您应该将上述注册表参数重置为 0，以防止在再次出现此错误情况时自动恢复使数据意外不可用。

要更改此注册表参数，请运行 regedit。

单击开始、运行并键入 regedit。

展开 HKEY_LOCAL_MACHINE。单击关键路径：“System\CurrentControlSet\Services\NtFrs\Parameters” 双击值名称“Enable Journal Wrap Automatic Restore”并更新该值。

如果值名称不存在，您可以使用“编辑”菜单项下的“新建”->“DWORD 值”功能添加它。完全如上所示键入值名称。

[有关详细信息，请参阅http://go.microsoft.com/fwlink/events.asp](http://go.microsoft.com/fwlink/events.asp)上的帮助和支持中心。

* * *

在做了一些阅读之后，似乎正确的做法是非权威性的reotre，所以我通过并创建了注册表项，然后停止并启动了NTFRS服务。

正如预期的那样，我得到了：

* * *

EventID 13560 - 源 NtFRS

* * *

文件复制服务正在从副本集“DOMAIN SYSTEM VOLUME (SYSVOL SHARE)”中删除这台计算机，以尝试从错误状态中恢复，错误状态 = FrsErrorSuccess 在下一次轮询（将在 5 分钟后发生）时，这台计算机将重新添加到副本集中。重新添加将触发副本集的完整树同步。

[有关详细信息，请参阅http://go.microsoft.com/fwlink/events.asp](http://go.microsoft.com/fwlink/events.asp)上的帮助和支持中心。

* * *

整整五分钟后，我得到：

* * *

EventID 13520 - 源 NtFRS

* * *

文件复制服务将 c:\windows\sysvol\domain 中预先存在的文件移动到 c:\windows\sysvol\domain\NtFrs_PreExisting___See_EventLog。

文件复制服务可能随时删除 c:\windows\sysvol\domain\NtFrs_PreExisting___See_EventLog 中的文件。可以通过将文件从 c:\windows\sysvol\domain\NtFrs_PreExisting___See_EventLog 中复制来避免删除文件。如果文件已存在于其他复制伙伴上，则将文件复制到 c:\windows\sysvol\domain 可能会导致名称冲突。

在某些情况下，文件复制服务可能会将文件从 c:\windows\sysvol\domain\NtFrs_PreExisting___See_EventLog 复制到 c:\windows\sysvol\domain 中，而不是从其他复制伙伴复制文件。

可以随时通过删除 c:\windows\sysvol\domain\NtFrs_PreExisting___See_EventLog 中的文件来恢复空间。

有关详细信息，请参阅帮助和支持中心，网址为

* * *

&

* * *

EventID 13553 - 源 NtFRS

* * *

文件复制服务已成功将此计算机添加到以下副本集中：“DOMAIN SYSTEM VOLUME (SYSVOL SHARE)”

与此事件相关的信息如下所示： 计算机 DNS 名称为“tisserver.TIS.local” 副本集成员名称为“TISSERVER” 副本集根路径为“c:\windows\sysvol\domain” 副本暂存目录路径为“c :\windows\sysvol\staging\domain" 副本工作目录路径为 "c:\windows\ntfrs\jet"

有关详细信息，请参阅帮助和支持中心，网址为

* * *

---------- 剪切到此结束 ----------

从这一点开始，我开始偏离原始海报：

* * *

EventID 13566 - 源 NtFRS

* * *

文件复制服务正在扫描系统卷中的数据。在此过程完成之前，计算机 DOMSERVER 无法成为域控制器。然后系统卷将作为 SYSVOL 共享。

要检查 SYSVOL 共享，请在命令提示符处键入：net share

当文件复制服务完成扫描过程时，将出现 SYSVOL 共享。

系统卷的初始化可能需要一些时间。时间取决于系统卷中的数据量。

[有关详细信息，请参阅http://go.microsoft.com/fwlink/events.asp](http://go.microsoft.com/fwlink/events.asp)上的帮助和支持中心。

* * *

我已经离开它大约一个半小时了，还没有看到任何 sysvol 或 netlogon 共享的迹象。用户无法登录。我不知道从这里去哪里。我处于如此绝望的状态，如果我有钱，我肯定会支付专家交换费用（我知道坏人会赢:(）。不幸的是，我不能这样做有很多原因（没有信用卡就是其中之一）。

您的帮助将不胜感激！

PS：对不起我的英语不太好。这不是我的母语。下次我会做得更好。:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T15:10:57.247

“使用 BurFlags 注册表项重新初始化文件复制服务副本集”（[http://support.microsoft.com/kb/290762](http://support.microsoft.com/kb/290762)）成功了！！！是的！噗！！！我现在想飞！！！

# c# - 如何将数字转换为字节？

> ID：153266
> 
> 赞同：7
> 
> 时间：2008-09-30T14:23:40.370
> 
> 标签：c#, casting

在 C 和 C++ 中，您可以通过在数字末尾添加“l”来告诉编译器数字是“long”。例如长 x = 0l;

如何告诉 C# 编译器一个数字是一个字节？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T14:24:33.287

```
byte b = (byte) 123; 
```

虽然

```
byte b = 123; 
```

做同样的事情。如果你有一个变量：

```
int a = 42;
byte b = (byte) a; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T14:29:44.130

根据[C# 语言规范](http://msdn.microsoft.com/en-us/library/aa664674(VS.71).aspx)，无法指定字节文字。您必须转换为字节才能获得一个字节。您最好的选择可能是用十六进制指定并向下转换，如下所示：

```
byte b = (byte) 0x10; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T14:26:02.017

请记住，如果您这样做：

```
byte b = (byte)300; 
```

它不会按您期望的方式工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T14:29:10.810

MSDN 使用[隐式转换](http://msdn.microsoft.com/en-us/library/5bdb6693(VS.71).aspx)。我没有看到[byte type suffix](http://msdn.microsoft.com/en-us/library/aa664674(VS.71).aspx)，但您可能会使用显式强制转换。我只使用 2 位十六进制整数 (int) 常量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T14:29:18.297

无需告诉编译器。您可以为 byte 变量分配任何有效值，编译器就可以使用它：byte 没有后缀。

如果要在对象中存储一个字节，则必须强制转换：

```
object someValue = (byte) 123; 
```

# c# - 先学什么？

> ID：153286
> 
> 赞同：5
> 
> 时间：2008-09-30T14:26:46.040
> 
> 标签：c#, asp.net, ruby, f#

几年前我去学校学习编程，毕业后我找到了一份系统管理的工作，这就是我职业生涯的方向。我想重新开始某种形式的开发，并且一直在“玩”C# 和 ASP.NET，但我听到了很多关于其他“新”语言的嗡嗡声（我所说的新是指它们是新的我）喜欢 Ruby 和 F#。我想我想知道我是否在浪费时间学习主要是 MS 语言，而不是成为一个通才。很长一段时间没有离开开发社区（如果我曾经是的话）让我在潮流中挣扎，我不想落后于时代。

有什么想法是遵循“最新”语言还是坚持使用更久经考验和真正的技术更好？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-30T14:32:02.550

C。

认真学习C。

如果你不尖叫着冲着山把你的头发拉出来，那么你就不能成为一名开发人员。

请注意，我并不是说不了解 C 的人就不是开发人员（本网站的创始人 Jeff 不了解 C，而且他做得很好），但 C 会向您介绍很多[不太迷人和糖衣方面](http://www.joelonsoftware.com/articles/ThePerilsofJavaSchools.html)的发展。

作为第二选择，选择 C#。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-30T14:30:41.617

您应该至少学习 1 种编译语言（如 C# 或 Java）和 1 种脚本语言（Python、Ruby 等）。这通常足以帮助大多数开发人员在他们所做的事情上取得成功，无论语言的年龄如何。

至于新旧，我现在会坚持使用 C#，因为它非常流行。不过学习一门新语言也不会太糟糕。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-30T14:37:16.373

您选择的语言并不重要。当你理解了这些概念后，你很可能很快就能学会一门新语言。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T14:30:20.760

有关语言流行度的完整索引，请参见[http://www.tiobe.com/index.php/content/paperinfo/tpci/index.html](http://www.tiobe.com/index.php/content/paperinfo/tpci/index.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T16:31:13.543

C# 是我选择的语言，Java 和 C# 足够相似，我认为一旦了解了 c# 基础知识，学习 Java 就没什么大不了的……但是 c++ 完全是另一只野兽。

我认为 c++ 是更好的通用工具之一，一旦 c# 被很好地理解就会更容易处理（它有很多文档和帮助论坛）。但是，c++ 的体验不仅限于微软——大多数流行的平台都将运行 c++，因此有了这种体验，您将不会仅限于 windows。它也很好，因为它不像 c# 或 Java 那样糖果，也不像纯 c 那样坚韧不拔，而且它可以很容易地与 c# 互操作（这是过渡更容易的原因之一）

所以c#是个不错的选择，imho紧随其后的是c++

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T20:18:17.740

我必须同意上述许多观点：语言并不重要。很大程度上，语言只对以下内容很重要：

1.  特征。如果需要多重继承，最好使用 C++。如果像 90+% 的开发人员一样，您不需要任何特定于一种（或一小部分）语言的东西，这没关系。
2.  句法。你讨厌空白吗？使用 C#。讨厌花括号？LISP 是你的朋友。不在乎一种或另一种？这没关系。
3.  编译还是解释？这很重要。使用已编译（或部分编译，如 .NET），它会更快......但速度差距正在缩小。
4.  当地就业机会。当然，您可能是 C# 方面的专家……但是如果您附近正在招聘的每个人都在寻找 PERL 程序员，那对您没有任何好处。
5.  社区支持。如果您的语言在 20 年（或曾经）没有被认真使用过，请不要期望 Google 有太多的生命线。QBASIC，我在看着你。StackOverflow 会在这里...

最后，我们可以讨论事情，直到我们都脸色发青。选择一种具有您喜欢的功能集的语言，其语法不会让您发疯，一个体面的社区，并希望您所在地区有工作机会。

至于新的还是旧的……都很好。较新的语言可能更容易上手，但有更广泛的文档和旧语言的使用，尽管这可能正在逐步淘汰。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T14:31:05.017

这是一个有点牵强的问题，但您会发现这里的人们对他们的工具选择充满热情，同时相信选择提供的灵活性。

也就是说，如果您不介意“供应商锁定”，Microsoft 堆栈是进入编程并在未来几年找到有酬工作的绝佳方式。微软既是“久经考验的”又是“最新的”。Microsoft 堆栈传统上面向构建业务应用程序，但您不限于此（例如，用于构建此站点的 ASP.NET MVC）。

我对 Ruby on Rails 之类的世界知之甚少，所以我会听从知识渊博的人的意见。

我真正的建议是选择你喜欢的。如果你喜欢的话，学习 C#**和F#。**

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T14:31:29.773

我会说学习什么是最简单的，并抓住它们背后的基本概念。语法是一个容易克服的障碍，语言之间的差异有点棘手。

然而，由于 C# 似乎在网上和 SO 上都有广泛的帮助基础，我将从那里开始，了解面向对象编程的来龙去脉。然后，理想情况下，您应该能够切换到当时需要的大多数其他 OO 语言（例如 ruby​​、Java、Obj-C，甚至是可怕的 C++）*jk、C++ 人*。

像 F# 这样的语言虽然很流行，但与 C# 有很大不同，因为它是函数式的。如果您习惯于编写函数式代码，F# 可能是一个不错的选择。但是，即便如此，也要了解编写函数式代码的感觉，并掌握该语言的基础知识。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T14:31:37.997

好吧，如果您及时了解最新的语言，那么您将始终可以被希望增加营销流行语数量的公司雇用。并不是说这是语言的唯一用途，但它绝对是一种用途。

另一方面，老技术也总是存在市场，任何一家公司都希望在更可靠和经过测试的老技术之上构建并维护旧技术。

我想这取决于你想如何进步。如果你追求趋势，你可能会发现你从来没有时间真正从里到外学习一门技术，但如果你追求旧语言，你可能会发现更有趣的项目正在推出你不熟悉的新东西，而你留下维护。这都是关于权衡的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T15:13:06.243

我自己的看法是考虑你想做什么样的工作，以及对这些工作有什么样的要求会有所帮助。例如，您了解设计模式吗？使用类和继承对系统建模怎么样？如果您想进入富 Internet 应用程序，则需要学习 AJAX 和其他 Javascript 元素以及 HTML 及其各种分支，如 XHTML 和 DHTML。

我认为仅了解 Microsoft 技术没有任何问题，如果它们没有碰到其他可能需要的技术，如果您想申请开发人员工作并且它们需要您没有的 Javascript 或 CSS .

另一点是要注意随着时间的推移工具的变化，因为随着 Web 的进一步发展，可能会有更多的变化，例如 Visual Studio 2010 的变化可能比当前的 Visual Studio 2008 的变化多得多。最近关于 jQuery 和 MVC 框架的公告。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-30T15:52:51.420

去年我专业地使用过 C#、Ruby、Perl、JavaScript 和 PHP，它们都以不同的方式有用。我建议，如果您想要一种简单的方法来掌握编程的基础知识，那么 Ruby 是一种很好的语言，它具有简单、易于遵循的语法，并且很容易在面向对象中进行思考方式，使用像 C# 或 Java 这样的半 OO 语言可能会更难。

C# 非常值得学习，因为了解 C 家族中的一门语言很有用 - 基本习语非常普遍，值得使用它们 - 但我会避免使用 C 或 C++，因为我真的不认为需要管理自己的记忆——它让生活变得非常艰难，引入了许多不必要的错误，并且在你真正擅长它之前几乎没有带来什么好处。先做好处理内存管理的事情，然后如果需要，你可以继续做更难的事情。

我会避免使用像 F# 这样的函数式语言。尽管从各方面来看，理解它们会让你成为更好的程序员，但它们非常困难且完全不同。

# internet-explorer - 文件下载时文件名损坏 (IE)

> ID：153287
> 
> 赞同：3
> 
> 时间：2008-09-30T14:26:46.277
> 
> 标签：internet-explorer, http, internationalization, http-headers

我已经实现了一个简单的文件上传-下载机制。当用户单击文件名时，将使用以下 HTTP 标头下载该文件：

```
HTTP/1.1 200 OK
Date: Tue, 30 Sep 2008 14:00:39 GMT
Server: Microsoft-IIS/6.0
Content-Disposition: attachment; filename=filename.doc;
Content-Type: application/octet-stream
Content-Length: 10754 
```

我也支持日文文件名。为此，我使用此 java 方法对文件名进行编码：

```
private String encodeFileName(String name) throws Exception{
    String agent = request.getHeader("USER-AGENT");
    if(agent != null && agent.indexOf("MSIE") != -1){ // is IE
        StringBuffer res = new StringBuffer();
        char[] chArr = name.toCharArray();
        for(int j = 0; j < chArr.length; j++){
            if(chArr[j] < 128){ // plain ASCII char
                if (chArr[j] == '.' && j != name.lastIndexOf("."))
                    res.append("%2E");
                else
                    res.append(chArr[j]);
            }
            else{ // non-ASCII char
                byte[] byteArr = name.substring(j, j + 1).getBytes("UTF8");
                for(int i = 0; i < byteArr.length; i++){
                    // byte must be converted to unsigned int
                    res.append("%").append(Integer.toHexString((byteArr[i]) & 0xFF));
                }
            }
        }
        return res.toString();
    }
    // Firefox/Mozilla
    return MimeUtility.encodeText(name, "UTF8", "B");
} 
```

到目前为止它运行良好，直到有人发现它不适用于长文件名。例如：`あああああああああああああああ2008.10.1あ.doc`。如果我将其中一个单字节点更改为单字节下划线，或者如果我删除了第一个字符，它可以正常工作。即，它取决于点字符的长度和 URL 编码。以下是几个例子。

这是坏的（`あああああああああああああああ2008.10.1あ.doc`）：

```
Content-Disposition: attachment; filename=%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%822008%2E10%2E1%e3%81%82.doc; 
```

这没关系（`あああああああああああああああ2008_10.1あ.doc`）：

```
Content-Disposition: attachment; filename=%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%822008_10%2E1%e3%81%82.doc; 
```

这也很好（`あああああああああああああああ2008.10.1あ.doc`）：

```
Content-Disposition: attachment; filename=%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%82%e3%81%822008%2E10%2E1%e3%81%82.doc; 
```

有人有线索吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T14:51:47.680

gmail 处理文件名转义的方式有所不同：文件名被引用（双引号），单字节句点不是 URL 转义的。这样，问题中的长文件名就OK了。

```
Content-Disposition: attachment; filename="%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%82%E3%81%822008.10.1%E3%81%82.doc" 
```

但是，文件名的字节长度仍然存在限制（显然仅限 IE）（我假设是一个错误）。因此，即使文件名仅由单字节字符组成，文件名的开头也会被截断。限制约为 160 字节。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-21T07:57:12.440

如上所述，如果没有浏览器嗅探并为每个浏览器返回不同的标头，Content-Disposition 和 Unicode 是不可能让所有主要浏览器工作的。

我的解决方案是完全避免 Content-Disposition 标头，并将文件名附加到 URL 的末尾，以诱使浏览器认为它正在直接获取文件。例如

```
http://www.xyz.com/cgi-bin/dynamic.php/あああああああああああああああ2008.10.1あ.doc 
```

这自然假设您在创建链接时知道文件名，尽管快速重定向标头可以按需设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T09:47:47.157

这里的主要问题是 IE 不支持相关的 RFC，这里是：RFC2231。请参阅[指针和测试用例](http://greenbytes.de/tech/tc2231/)。此外，用于 IE 的解决方法（仅使用百分比转义的 UTF-8）还有几个问题；它可能不适用于所有语言环境（据我记得，该方法在韩国失败，除非 IE 配置为始终在 URL 中使用 UTF-8，这不是默认设置），并且如前所述，存在长度限制（我听说这在 IE8**中**已修复，但我还没有尝试）。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2010-08-16T06:52:02.180

我认为这个问题在 IE8 中已修复，我已经看到它在 IE 8 中工作。

# linq-to-entities - 有人使用 lucene.net 和 Linq-to-Entities 吗？

> ID：153290
> 
> 赞同：1
> 
> 时间：2008-09-30T14:26:56.853
> 
> 标签：linq-to-entities, lucene, lucene.net

如果有人这样做，请告诉我。我对lucene.net一无所知。我从未使用过它，但我听说过它。我想知道这样的东西如何与 Linq 实体框架集成？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T15:53:15.920

查看[Linq to Lucene](http://www.codeplex.com/linqtolucene)项目。

# c# - 如何解耦中间层和数据集以进行单元测试？

> ID：153291
> 
> 赞同：0
> 
> 时间：2008-09-30T14:27:01.017
> 
> 标签：c#, .net, integration-testing

我在[SO](https://stackoverflow.com/questions/150038/how-to-wire-a-middle-tier-of-objects-to-a-data-tier-consisting-of-a-dataset#151255)有一个问题，询问如何将中间层连接到数据集。

我提出了一个答案，显示了我的想法，但我对紧密耦合不满意。我刚刚开始进行测试，并发现它对我的代码来说是一个很好的目标。

这段代码如何解耦以进行单元测试？

谢谢你，
基思

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T07:34:53.227

海事组织；数据集是邪恶的。它们是并且应该只用作离线数据库。仅此而已，IMO。但是，您在数据访问层 (DAL) 中所做的事情不应真正影响您的业务层 (BL)。我只是在它们之间使用对象（使用接口）（IList），然后使用接口来定义您的 DAL（IRepository），并且您可以模拟该接口以返回您在 BL 中需要的任何内容以进行单元测试。单元测试数据集是另一种野兽，从未尝试过，我希望永远不必......也许内存数据库是你最好的选择......

哦，为了模拟，我使用 RhinoMock 取得了一些成功。我还鼓励您查看 IoC ( [http://www.castleproject.org/](http://www.castleproject.org/) )。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T18:45:29.960

您需要 IOC（控制反转）和模拟对象。

我鼓励您与 James Kovacs一起观看[dnrTV 第 126 集。](http://www.dnrtv.com/default.aspx?showNum=126)

他准确地展示了您正在寻找的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T14:37:00.383

你试过[Spring.net](http://www.springframework.net/)吗？它将使您的代码更干净且耦合更少。它还提供了[有用](http://www.springframework.net/docs/1.2.0-M1/reference/html/testing.html#testing-fixture-di)的类来进行集成测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T22:42:09.903

这取决于您要测试的内容：

*   您想测试从数据库中检索数据吗？
*   从数据集中构建对象？
*   插入或更新数据库？
*   等等...

这里有一个建议：

一个订单包含它的所有子订单。这是一个集合体，一个整体。您从存储库中获得包含详细信息的订单：

```
var order = repository.GetOrderBy(id); 
```

存储库从数据库中获取数据：

```
var dataset = orderDatabase.GetOrderAndDetailsBy(id); 
```

存储库可以使用构建器来创建订单：

```
var order = orderBuilder.CreateOrderAndDetailsFrom(dataset); 
```

您必须按如下方式创建存储库：

```
var repository = new OrderRepository(orderDatabase, orderBuilder); 
```

现在，您可以根据要测试的内容创建带有假合作者的存储库。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-30T14:32:55.713

如果您有实体对象，则可以使用模拟来对中间层进行单元测试。

[温迪](http://www.rwendi.com)

# qt - Qt 中具有完整 alpha 的动画？

> ID：153295
> 
> 赞同：1
> 
> 时间：2008-09-30T14:27:43.963
> 
> 标签：qt, animation, alphablending

Qt（使用 v4.4）中是否支持支持完整 Alpha 通道的动画格式？GIF 只有一位透明，我认为 Qt 不支持 APNG。更新：似乎支持 MNG，但它比 APNG 更不受欢迎！也许 SVG 是我最好的选择。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T13:12:25.333

Qt 支持 SVG 1.2 Tiny 以及 GIF 和 MNG。顺便说一句，一个动画 API 正在开发中，你可能会感兴趣；

[http://labs.trolltech.com/blogs/2008/11/05/qt-animation-framework/](http://labs.trolltech.com/blogs/2008/11/05/qt-animation-framework/) 和 [http://labs.trolltech.com/page/Projects/Graphics/Kinetic](http://labs.trolltech.com/page/Projects/Graphics/Kinetic)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-20T21:01:27.237

将动画编解码器与 Quicktime 一起使用，它支持完整的 Alpha 通道。选择动画编解码器时，只需选择“Million of Colors+”。您可能需要在高级设置中启用“旧版编解码器”选项。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-30T17:04:29.267

在不太了解 Qt 的情况下，我可能会提到 MNG 和 SVG。

# html - 编辑环境中的 HTML 创作

> ID：153298
> 
> 赞同：2
> 
> 时间：2008-09-30T14:27:53.340
> 
> 标签：html, wysiwyg

最近从发送给我的各种 word 和 excel 文件中生成了基于 HTML/CSS/Javascript 的报告，我正在努力研究如何在未来更好地做到这一点，理想情况下使办公室中的非技术用户能够完成许多任务目前交给我。

那里有许多 HTML 编辑器，但似乎没有一个明显擅长执行此类任务。例如，文档中的大多数表格都是通过厚框（jquery 插件）显示的。除了表格之外，这还要求我将它们包含在具有各种 id 和 class 属性的 div 中，然后在页面顶部创建一个链接，如下所示：

```
<a href="#TB_inline?height=300&amp;width=700&amp;inlineId=tbtable2"
class="thickbox tablelink" title="Municipal Operating Expenditure (A$m)">Municipal Operating Expenditure</a> 
```

我需要一个解决方案，它会小心使用我的模板，有一个所见即所得的界面，而且还为这种事情提供简单的输入，而不会让办公室里没有 HTML 知识的人感到沮丧，理想情况下让他们完全远离代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T09:30:15.277

您不能为非技术用户提供如此复杂的 HTML 模板，并希望他们不会破坏它。对于比元素上的类属性更复杂的结构，没有任何 HTML 编辑器可以强制执行此类规则。

这种情况需要使用 XML：您需要将内容和表示分开。

您应该定义一种 XML 风格来描述您的报告。然后编写一个 XSLT，它将您的 <thickbox/> XML 元素转换为您在上面描述的 HTML 结构。

要允许非技术用户完成您的某些任务，您可以使用[Xopus](http://xopus.com)使 XML 可编辑（[演示](http://xopus.com/files/demo/xopus/xopus.html#/files/demo/examples/Recipe/start.html)）。您可以从 OOXML 进行初始转换，或者您可以使用 Xopus 中的复制/粘贴功能来允许他们从 Excel 复制内容并自动将其转换为您的 <thickbox/> 元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T14:39:07.993

你试过[FCKEditor](http://www.fckeditor.net/)吗？它非常流行，并在许多博客、wiki 和 CMS 中使用。它可以生成非常干净的 HTML 并且高度可定制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T14:56:55.860

让他们使用 Markdown，就像这里一样，并将渲染的 HTML 插入到您的模板中。

# silverlight - 有哪些用于在 Web 应用程序中绘制图形/图表的好工具集？

> ID：153303
> 
> 赞同：8
> 
> 时间：2008-09-30T14:28:55.037
> 
> 标签：silverlight, model-view-controller, charts, graph

有哪些用于在 Web 应用程序中绘制图形/图表的好工具集？最好是开源/免费软件，特别是考虑使用 ASP.NET MVC 或 Silverlight 2.0 进行开发。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T14:31:06.687

[谷歌图表](http://code.google.com/apis/chart/)？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T14:29:57.843

[Dundas Chart](http://www.dundas.com/)是目前最好的图表之一。它不是免费的，但值得。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-12-17T13:28:48.187

查看 Visiblox 图表，它们是我目前用于遥测应用程序的图表。我发现这里的示例很有用 - [http://www.visiblox.com/examples](http://www.visiblox.com/examples)

您现在可以看到我在[CodeProject](http://www.codeproject.com/KB/silverlight/SilverTrack.aspx)创建的遥测应用程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T10:38:57.413

您现在可能还想考虑[Microsoft Chart Controls for .NET Framework 3.5](http://www.microsoft.com/downloads/details.aspx?FamilyId=130F7986-BF49-4FE5-9CA8-910AE6EA442C&displaylang=en)

这些刚刚发布。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T18:05:38.007

对于免费的 flash 图表，您可以查看[FusionCharts Free](http://www.fusioncharts.com/free)。或者，如果您想要更专业并准备好掏出 $$$，请查看[FusionCharts v3](http://www.fusioncharts.com)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T11:18:27.083

请注意，公共[VS2010 CTP 映像](http://www.microsoft.com/downloads/details.aspx?familyid=922b4655-93d0-4476-bda4-94cf5f8d4814&displaylang=en&tm)包含内置于 ASP.NET 中的图表功能；迟到了，但欢迎。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-27T10:51:32.770

如果您不寻找动画等，我认为 Google Charts 非常出色。它会占用*您的*服务器负载，而 Google 会为您呈现整个内容。它还可以非常详细地控制您希望图表的外观。这也是我认为最简单和最干净的方式。它只是一个图像...没有 Flash 没有 SVG 等等。

我要给出的一个提示是不要使用包装 API。我发现使用它的最简单方法是直接使用实际使用的基于 URL 的“API”。但我想这只是MHO。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T15:52:29.283

在 CodePlex 上进行了搜索，发现

免费 Silverlight 图表控件[http://www.codeplex.com/FreeSilverlightChart](http://www.codeplex.com/FreeSilverlightChart)

ASP.Net 的 Google 图表控件[http://www.codeplex.com/GoogleChartNet](http://www.codeplex.com/GoogleChartNet)

免费 Silverlight 图表控件 - visifire [http://www.codeplex.com/visifire](http://www.codeplex.com/visifire)

ETC....

我使用的搜索[http://www.codeplex.com/Project/ProjectDirectory.aspx?ProjectSearchText=chart](http://www.codeplex.com/Project/ProjectDirectory.aspx?ProjectSearchText=chart)

由于我从未使用过它们，因此我个人无法提出任何建议，但希望这会有所帮助。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T14:40:32.933

如果您正在寻找免费组件，请获取 Google [Charts](http://code.google.com/apis/chart/)。

我真正喜欢的非自由组件是

*   DevExpress [Xtra 图表](http://www.devexpress.com/Products/NET/Controls/Charting/index.xml)（特别是如果您使用它们的其他组件）
*   [登打士图表](http://www.dundas.com/)（非常好，强烈推荐）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T14:49:18.717

我们使用 XSLT 将 XML 转换为 SVG。一旦你建立了各种图表格式和数据 DTD，它就很容易重用。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-30T14:51:51.067

如果您对基于 Flash 的图表感兴趣，那么：[http ://teethgrinder.co.uk/open-flash-chart/](http://teethgrinder.co.uk/open-flash-chart/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-27T11:06:39.853

取决于你在寻找什么。

Google Charts 的功能非常出色，而且使用起来既快速又容易——大约两周前我第一次使用它，并在第一次查看其文档后的大约三个小时内生成了多种不同风格的报告。然而，除非它比文档所允许的更多，否则“它的作用”仅限于相对基本的图表，它不会支持任何特别花哨的东西。它还需要您自己做很多繁重的工作，例如弄清楚比例和轴标签应该是什么。

对于超出 Google Charts 功能的任何内容，我会使用 CPAN 中的 GD::Graph 模块，但这些模块适用于 Perl 而不是 .NET 或 Silverlight，因此它们可能对您没有多大用处。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-30T14:36:38.403

[Googel Charts](http://code.google.com/apis/chart/)是我首先想到的。我还幸运地在以前的雇主处使用了[Emprise Javascript Charts ；](http://www.ejschart.com/#Features)但它不是免费使用的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T14:39:38.770

还有融合图，scruffy 和 riya。这些图表库中的大多数都从 xml 文件生成图表，因此您可以从任何框架中使用它们。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-30T14:46:22.640

对于图表，nothings 胜过 graphviz。有大量第三方包装库，因此您将能够使用大多数系统动态生成图表。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-12-29T18:23:16.727

[不是免费的解决方案，但恕我直言， Telerik 的 SL Chart](http://demos.telerik.com/silverlight/#Chart/FirstLook)是一个非常好的解决方案。注意 - 他们也有其他 Web 应用程序的图表。使用他们的控件，您不必向 Google 发送数据（收集和做谁知道用什么）。这在 HIPAA 不赞成您向 Google 发送数据的医疗保健情况下非常重要。

# dsl - DSL 工具：在自定义代码中创建新图表

> ID：153309
> 
> 赞同：0
> 
> 时间：2008-09-30T14:29:21.340
> 
> 标签：dsl, dsl-tools

我正在为 Visual Studio 2005 使用 DSL 工具。

我有一个 DSL，在某个时候我想使用自定义代码创建一个新图表。

到目前为止，我能够通过覆盖当前已打开的图表来创建一个新图表。代码如下：

```
FEGeneratorDiagram diag = new FEGeneratorDiagram(ThisElem.Store);
diag.Associate(ThisElem);
FEGeneratorDiagram currentDiag = (FEGeneratorDiagram)ThisElem.Store.ElementDirectory.FindElements<FEGeneratorDiagram>(false)[0];
currentDiag = diag; 
```

但是，我真正想做的是，

用一个新的实例 FEGeneratorDiagram 创建一个新的 DSL 文档，然后继续我添加元素和设置属性的逻辑。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-12T19:02:30.883

```
//Create a Store
Type[] modelTypes = new Type[] { typeof(CoreDesignSurfaceDomainModel), typeof(FEGeneratorDomainModel) };
Store store = new Store(modelTypes);
RootElement root;
using (Transaction t =
store.TransactionManager.BeginTransaction("Create Elements"))
{
    root = FEGeneratorSerializationHelper.Instance.LoadModel(store, diagramPath, null, null);
    t.Commit();
}
//Do whatever custom things you want!

SerializationResult result = new SerializationResult();
//Save the file
FEGeneratorSerializationHelper.Instance.SaveModel(result, root, diagramPath); 
```

# web-services - 这个 WebService 安全方案有哪些潜在问题？

> ID：153329
> 
> 赞同：5
> 
> 时间：2008-09-30T14:34:14.043
> 
> 标签：web-services, security

我们有一项基于用户名和密码处理授权的服务。我们没有将用户名和密码作为调用的一部分，而是将其放在 SOAP 标头中。

在典型的场景中，Web 服务在执行开始时调用授权服务来检查调用者是否被允许调用它。问题是这些 Web 服务中的一些相互调用，这意味着在每个子调用中都会检查用户的权限，这可能会非常昂贵。

我想做的是让授权服务在第一次调用后返回一个安全令牌。然后，Web 服务不必每次都调用授权服务，而是可以在本地验证安全标头。

安全标头看起来像这样（C# 代码 - 修剪以说明基本概念）：

```
public sealed class SecurityHeader : SoapHeader
{
    public string UserId;     // Encrypted   
    public string Password;   // Encrypted; Just realized this field isn't necessary [thanks CJP]

    public DateTime TimeStamp;   // Used for calculating header Expiry
    public string SecurityToken;
} 
```

一般的想法是每次调用都会检查 SecurityHeader。如果它存在、尚未过期且 SecurityToken 有效，则 Web 方法将照常进行。否则它将返回一个错误，或者它会尝试重新授权并生成一个新的 SecurityHeader

SecurityToken 基于 UserId、Password 和 TimeStamp 的加盐哈希。每天更换盐以防止重播。

我确实看到的一个问题是，用户可能有权访问 Web 服务 A，但不能访问 Web 服务 B。如果他调用 A 并收到一个安全令牌，就目前而言，这意味着 B 将让他通过，如果他使用同一个令牌。我必须更改它，以便安全令牌仅在 Web 服务到 Web 服务之间有效，而不是用户到 Web 服务，即。如果用户调用 A 调用 B 应该可以，但如果用户调用服务 A 然后调用服务 D 则不行。解决此问题的一种方法是为逻辑相关的服务分配一个公共密钥（或一组密钥）。（即如果客户可以做A，那么逻辑上他也可以做​​B）。

或者，我必须将用户的整个权限集编码为安全标头的一部分。我将不得不调查开销是多少。

编辑：

有几个人提到要查看其他安全方案，例如 WS-Security 和 SAML 等。我已经有了。事实上，我是从 WS-Security 得到这个想法的。问题是其他方案没有提供我需要的功能（缓存授权信息并防止在没有中间数据库的情况下重放）。如果有人知道这样的方案，那么我很乐意使用它。此外，这与身份验证*无关*。这是由我无法控制的另一种机制处理的。

如果事实证明没有办法缓存授权数据，那么这意味着我将不得不在每个级别产生授权开销。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T02:31:30.893

您的方案的根本问题是您没有使用标准框架或实现。这与您的计划本身的任何特殊优点无关。

原因很简单，安全性（尤其是密码学）非常非常复杂，而且几乎不可能做到正确。使用功能强大、易于理解和经过验证的通用工具。

有关WS-Security 的更多信息，请参见：**[http ://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wss。](http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wss)**

大多数框架（.NET/JavaEE 等）都会（在某种程度上）对 WS-Security 提供内置支持。

如果您认为您的方案在某些方面比标准更好，我建议您将其写成论文并提交给同行评审（连同参考实现），但不要使用它来保护应用程序。

编辑以响应 OP 编辑​​：我认为您有点混淆了身份验证和授权的角色，这很容易做到......

安全令牌（或类似）在方案中的作用是验证消息的发送者 - 基本上，他们应该是发送者。正如您正确指出的那样，身份验证并不意味着发送者将被授予访问哪些底层资源的任何信息。

授权是您获取经过身份验证的发件人并应用一组权限的过程，以便您可以限制访问范围。通常框架默认不会进行授权，你要么必须通过创建某种形式的 ACL 来启用它，要么通过扩展某种“安全管理器”类型的接口来启用它。

实际上，这个想法是身份验证层告诉您谁正在尝试访问页面 A，并由您决定该人是否有权访问页面 A。

您永远不应在消息本身中存储有关权限和权限的信息 - 接收者应针对每条消息的 ACL（或数据库或其他）验证权限。如果有人弄清楚如何修改消息，这会限制您的曝光。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T01:06:20.847

好的，希望用更好的答案替换我的旧答案。

如果您有办法在您的服务之间安全地共享数据，那么您所描述的应该会起作用。例如，如果您的服务与授权服务共享一个密钥，您可以使用此密钥来获取盐。

顺便说一句，我不知道足够的密码学来说明添加秘密盐 + 哈希是否足够安全（尽管看起来不错）；我很确定使用密钥或私钥对[HMAC是安全的。](http://en.wikipedia.org/wiki/HMAC)轮换密钥是个好主意，因此您仍然拥有主密钥并传播新的签名密钥。

您的方法的其他问题是（a）您在每个服务中硬编码散列逻辑，以及（b）服务可能希望从授权服务获取更详细的数据，而不仅仅是一个是/否的答案。例如，您可能希望授权服务在标头中插入该用户属于角色 A 和 B 但不属于 C。

作为替代方案，您可以让授权服务使用它拥有的任何有趣信息创建一个新标头，然后对该块进行签名。

此时，我们正在讨论单点登录实现。您已经了解[WS-Security](http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wss)规范。我描述的这个标头听起来很像[SAML](http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=security)断言。

[这是一篇](http://www.oracle.com/technology/tech/java/newsletter/articles/wsaudit/ws_audit.html)关于使用 WS-Security 和 SAML 进行单点登录的文章。

现在，我不知道您是否需要所有这些……也有中间解决方案。例如，授权服务可以签署原始用户名块；如果您担心公共/私有加密性能，并且您可以共享密钥，您也可以使用密钥来签名而不是公共/私有密钥。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T14:45:41.223

只要您有一个集中的底层框架来支持 SecurityToken 值的验证，我个人认为您不会有任何问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-05T01:43:45.543

首先，阅读@CJP 的帖子，他提出了一个很好且有效的观点。
如果您想继续自己动手（也许您确实有充分的理由），我会提出以下几点：

*   您说的是身份验证服务，而不是授权服务。只是为了确保你知道你在说什么......？
*   其次，您需要将盐（不是秘密）和密钥（是）分开。你应该有一个带键的散列（例如 HMAC）和盐（或带键的加盐散列。听起来像三明治。）。如前所述，盐不是秘密的，但应针对每个令牌进行更改，并且可以包含在标头中；密钥必须是秘密的，并且每天都更换是好的。当然，请确保您使用的是强哈希（例如 SHA-256）、适当的密钥管理技术等。

再一次，我敦促你重新考虑自己动手，但如果你必须自己出去……

# code-generation - 什么是编译的好资源？

> ID：153330
> 
> 赞同：5
> 
> 时间：2008-09-30T14:34:47.113
> 
> 标签：code-generation, language-features, compiler-theory

不耐烦的总结：我正在寻找关于为通用语言结构生成代码而不是解析的良好参考。

我对编程语言很感兴趣，并尝试尽可能多地阅读文献。但他们中的大多数都从功能和理论的角度涵盖了这个主题，我发现他们很难理解，更不用说实现这些想法了。

所以问题是；对于以更加命令式和实用的方式涵盖该主题的编程语言实现，您建议使用哪些资源？

例如，我发现“ *Lua 5.0 的实现*”论文很有启发性。

请注意，我不是在寻找有关解析或标记化的文章。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T14:36:30.933

这里有一堆很好的教科书：

Modern Compiler Implementation in Java (Tiger book) AW Appel Cambridge University Press, 1998 ISBN 0-52158-388-8 关于编译器实现的教科书教程，包括许多语言特性的技术

编译器：原理、技术和工具（龙书） Aho、Lam、Sethi 和 Ullman Addison-Wesley，2006 年 ISBN 0321486811 经典的编译器教科书，虽然它的前端重点反映了它的时代。

Advanced Compiler Design and Implementation (Whale book) Steven Muchnick Morgan Kaufman Publishers, 1997 ISBN 1-55860-320-4 非常完整，适合工业从业者和研究人员。

Engineering a Compiler (Ark book) Keith D. Cooper, Linda Torczon Morgan Kaufman Publishers, 2003 ISBN 1-55860-698-XA 现代课堂教科书，更加强调后端和实施技术。

为现代架构优化编译器 Randy Allen 和 Ken Kennedy Morgan Kaufman 出版商，2001 ISBN 1-55860-286-0 一本现代教科书，重点关注包括并行化和内存层次优化在内的优化。

编程语言语用学 Michael L. Scott Morgan Kaufmann Publishers, 2005 ISBN 0126339511

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-28T15:13:51.477

据说（我通读了它，但还没有完成），[编译器构造的增量方法](http://scheme2006.cs.uchicago.edu/11-ghuloum.pdf)非常好。它描述了作者如何教授他的编译器课程。

从摘要：

> 编译器被认为是神奇的神器，由巫师精心打造，普通人深不可测。关于编译器的书籍最好被描述为巫师谈话：由一群无所不知的从业者编写并为其编写。现实生活中的编译器过于复杂，无法用作教育工具。现实生活中的编译器和教育玩具编译器之间的差距太大了。新手编译器编写者面对一道难以逾越的障碍感到困惑，“最好写一个解释器。”</p>
> 
> 本文的目标是打破这一障碍。我们展示了构建编译器可以像构建解释器一样简单。我们构建的编译器接受 Scheme 编程语言的大部分子集，并为 Intel-x86 架构（个人计算的主要架构）生成汇编代码。编译器的开发分为许多小的增量步骤。每一步都会为逐渐扩展的 Scheme 子集生成一个完全工作的编译器。每个编译器步骤都会生成真正的汇编代码，这些代码可以被组装然后由硬件直接执行。我们假设读者熟悉基本的计算机体系结构：它的组件和执行模型。不需要详细了解 Intel-x86 架构。
> 
> 扩展教程中详细描述了编译器的开发。教程提供了支持材料，例如自动测试工具和综合测试套件。我们希望 Scheme 的当前和未来的实现者在本文中找到开发高性能编译器的动机以及实现该目标的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T18:31:45.897

“龙”和“虎”的书（见上文）都很棒，虽然我觉得“虎”（阿佩尔）的书有点密集。我也很喜欢David Galles 的*Modern Compiler Design*。至于帮助您理解的工具和实用程序，我建议您查看以下一项或多项：

*   用于 lex 和解析器生成的[JavaaCC](https://javacc.dev.java.net/)
*   用于 lex 和解析器生成的[Grammatica](http://grammatica.percederberg.net/index.html)
*   [Jasmin](http://jasmin.sourceforge.net/)和[Jasper](http://www.angelfire.com/tx4/cus/jasper/)用于代码生成

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T15:00:42.263

我建议玩[ANTLR](http://antlr.org/)。我用了一段时间，发现它很容易使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T15:45:59.837

我最喜欢的是 Robert Morgan 的“Building an Optimizing Compiler”。非常实用，涵盖了静态单一分配。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-12T19:00:49.427

Another hint: do not start digging into GCC; it is way too complicated. You want something more researchy and simple to start with, I would suggest looking into something like a Java compiler written in Java or the Erlang compilers written in Erlang.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T14:40:26.803

[Bjarne Stroustrup 撰写的 C++ 的设计和演变，](http://search.barnesandnoble.com/The-Design-and-Evolution-of-C/Bjarne-Stroustrup/e/9780201543308/?itm=1)代码很少，但主要讨论了设计语言中的权衡和其他问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T14:51:29.383

尝试查看[LLVM](http://llvm.org/)项目及其出版物和教程。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-30T11:45:52.453

我喜欢 Nicolas Wirth 的 Compiler Construction，但也许那是因为学习 (Turbo) Pascal 是我决定进入计算机科学的原因。

[http://www-old.oberon.ethz.ch/WirthPubl/CBEAll.pdf](http://www-old.oberon.ethz.ch/WirthPubl/CBEAll.pdf)

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-30T14:36:39.560

紫龙书是有史以来最好的。

# jpa - JPA 注释和接口

> ID：153344
> 
> 赞同：1
> 
> 时间：2008-09-30T14:37:58.103
> 
> 标签：jpa, java-ee-5

我有一个类 Animal 和一个从 IAnimal 继承的接口。

```
@MappedSuperclass
public class Animal implements Serializable, IAnimal{...}.

@Entity
public class Jaguar extends Animal{...} 
```

我的第一个问题是，我需要注释界面吗？

我问这个是因为我在运行测试时遇到了这个错误：

> 编译查询 [SELECT s FROM animal s WHERE s.atype = :atype] 时出错。未知的抽象模式类型 [动物]

如果我没记错的话，在我添加这个界面之前它是有效的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T01:04:57.407

发生此错误是因为您在查询中使用常见的 a 拼写了 Animal。试试这个：

```
 SELECT s FROM Animal s WHERE s.atype = :atype 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T15:02:39.777

做

```
SELECT s FROM Animal s WHERE s.atype = :atype 
```

工作？（只是改变了动物的情况）

# c++ - C++ SQL 数据库程序

> ID：153354
> 
> 赞同：4
> 
> 时间：2008-09-30T14:40:31.233
> 
> 标签：c++, sql, database

我编写了以下代码，但 SQLBindCol 似乎无法正常工作（当然我也可能搞砸了整个程序！）连接有效，它在数据库中创建表，添加记录并正常它们在 SQL 企业管理器中看起来都不错。所以我需要帮助是在评论“第 3 部分和第 4 部分：基于条件的搜索”之后。也许我应该完全不同地完成这项任务，或者这是一种可接受的方法？

```
#include <iostream>
#include <cstdio>
#include <string>

#include <windows.h>
#include <sql.h>
#include <sqlext.h>
#include <sqltypes.h> 

using namespace std;    // to save us having to type std::

const int MAX_CHAR = 1024;

int main ( )
{
   SQLCHAR   SQLStmt[MAX_CHAR];
   char      strSQL[MAX_CHAR];
   char   chrTemp;

   SQLVARCHAR rtnFirstName[50];
   SQLVARCHAR rtnLastName[50];
   SQLVARCHAR rtnAddress[30];
   SQLVARCHAR rtnCity[30];
   SQLVARCHAR rtnState[3];
   SQLDOUBLE  rtnSalary;
   SQLVARCHAR rtnGender[1];
   SQLINTEGER rtnAge;

   // Get a handle to the database

   SQLHENV EnvironmentHandle;
   RETCODE retcode = SQLAllocHandle( SQL_HANDLE_ENV, SQL_NULL_HANDLE, &EnvironmentHandle );

   // Set the SQL environment flags

   retcode = SQLSetEnvAttr( EnvironmentHandle, SQL_ATTR_ODBC_VERSION, (SQLPOINTER) SQL_OV_ODBC3, SQL_IS_INTEGER );

   // create handle to the SQL database

   SQLHDBC ConnHandle;
   retcode = SQLAllocHandle( SQL_HANDLE_DBC, EnvironmentHandle, &ConnHandle );

   // Open the database using a System DSN

   retcode = SQLDriverConnect(ConnHandle, 
   NULL, 
   (SQLCHAR*)"DSN=PRG411;UID=myUser;PWD=myPass;", 
   SQL_NTS,
   NULL, 
   SQL_NTS, 
   NULL, 
   SQL_DRIVER_NOPROMPT);
   if (!retcode) 
   {
      cout << "SQLConnect() Failed";
   }
   else
   {
      // create a SQL Statement variable

      SQLHSTMT StatementHandle;
      retcode = SQLAllocHandle(SQL_HANDLE_STMT, ConnHandle, &StatementHandle);

      // Part 1: Create the Employee table (Database)

      do
      {
         cout << "Create the new table? ";
         cin >> chrTemp;
      } while (cin.fail());

      if (chrTemp == 'y' || chrTemp == 'Y')
      {
         strcpy((char *) SQLStmt, "CREATE TABLE [dbo].[Employee]([pkEmployeeID] [int] IDENTITY(1,1) NOT NULL,[FirstName] [varchar](50) NOT NULL,[LastName] [varchar](50) NOT NULL,[Address] [varchar](30) NOT NULL,[City] [varchar](30) NOT NULL,[State] [varchar](3) NOT NULL, [Salary] [double] NOT NULL,[Gender] [varchar](1) NOT NULL,  [Age] [int] NOT NULL, CONSTRAINT [PK_Employee] PRIMARY KEY CLUSTERED ([pkEmployeeID] ASC)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]) ON [PRIMARY]");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);
      }

      // Part 2: Hardcode records into the table

      do
      {
         cout << "Add records to the table? ";
         cin >> chrTemp;
      } while (cin.fail());

      if (chrTemp == 'y' || chrTemp == 'Y')
      {
         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Mike','Slentz','123 Torrey Dr.','North Clairmont','CA', 48000.00 ,'M',34)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Sue','Vander Hayden','46 East West St.','San Diego','CA', 36000.00 ,'F',28)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Sharon','Stonewall','756 West Olive Garden Way','Plymouth','MA', 56000.00 ,'F',58)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('James','Bartholemew','777 Praying Way','Falls Church','VA', 51000.00 ,'M',45)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Joe','Smith','111 North 43rd Ave','Peoria','AZ', 44000.00 ,'M', 40)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Michael','Smith','20344 North Swan Park','Phoenix','AZ', 24000.00 ,'M', 40)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Jennifer','Jones','123 West North Ave','Flagstaff','AZ', 40000.00 ,'F', 40)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Cora','York','33rd Park Way Drive','Mayville','MI', 30000.00 ,'F', 61)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

         strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Tom','Jefferson','234 Friendship Way','Battle Creek','MI', 41000.00 ,'M', 31)");
         retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);
      }

      // Part 3 & 4: Searchs based on criteria

      do
      {
         cout << "1\. Display all records in the database" << endl;
         cout << "2\. Display all records with age greater than 40" << endl;
         cout << "3\. Display all records with salary over $30K" << endl;
         cout << "4\. Exit" << endl << endl;

         do
         {
            cout << "Please enter a selection: ";
            cin >> chrTemp;
         } while (cin.fail());

         if (chrTemp == '1')
         {
            strcpy((char *) SQLStmt, "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE");
         }
         else if (chrTemp == '2')
         {
            strcpy((char *) SQLStmt, "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE WHERE [AGE] > 40");
         }
         else if (chrTemp == '3')
         {
            strcpy((char *) SQLStmt, "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE WHERE [Salary] > 30000");
         }

         if (chrTemp == '1'  || chrTemp == '2' || chrTemp == '3')
         {
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            SQLBindCol(StatementHandle, 1, SQL_C_CHAR, &rtnFirstName, sizeof(rtnFirstName), NULL );
            SQLBindCol(StatementHandle, 2, SQL_C_CHAR, &rtnLastName, sizeof(rtnLastName), NULL );
            SQLBindCol(StatementHandle, 3, SQL_C_CHAR, &rtnAddress, sizeof(rtnAddress), NULL );
            SQLBindCol(StatementHandle, 4, SQL_C_CHAR, &rtnCity, sizeof(rtnCity), NULL );
            SQLBindCol(StatementHandle, 5, SQL_C_CHAR, &rtnState, sizeof(rtnState), NULL );
            SQLBindCol(StatementHandle, 6, SQL_C_DOUBLE, &rtnSalary, sizeof(rtnSalary), NULL );
            SQLBindCol(StatementHandle, 7, SQL_C_CHAR, &rtnGender, sizeof(rtnGender), NULL );
            SQLBindCol(StatementHandle, 8, SQL_C_NUMERIC, &rtnAge, sizeof(rtnAge), NULL );

            for(;;) 
            {
               retcode = SQLFetch(StatementHandle);
               if (retcode == SQL_NO_DATA_FOUND) break;

               cout << rtnFirstName << " " << rtnLastName << " " << rtnAddress << " " << rtnCity << " " << rtnState << " " << rtnSalary << " " << rtnGender << "" << rtnAge << endl;
            }
         }
      } while (chrTemp != '4');

      SQLFreeStmt(StatementHandle, SQL_CLOSE );
      SQLFreeConnect(ConnHandle);
      SQLFreeEnv(EnvironmentHandle);

      printf( "Done.\n" );
   }

   return 0;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T20:51:20.407

OK, here is the code now working...

```
using namespace std;    // to save us having to type std::

const int MAX_CHAR = 1024;

int main ( )
{
     SQLSMALLINT     RecNumber;
     SQLCHAR *       SQLState;
     SQLINTEGER *    NativeErrorPtr;
     SQLCHAR *       MessageText;
     SQLSMALLINT     BufferLength;
     SQLSMALLINT *   TextLengthPtr;

    SQLCHAR   SQLStmt[MAX_CHAR];
    char      strSQL[MAX_CHAR];
    char      chrTemp;

    SQLVARCHAR rtnFirstName[50];
    SQLVARCHAR rtnLastName[50];
    SQLVARCHAR rtnAddress[30];
    SQLVARCHAR rtnCity[30];
    SQLVARCHAR rtnState[3];
    SQLDOUBLE  rtnSalary;
    SQLVARCHAR rtnGender[2];
    SQLINTEGER rtnAge;

    // Get a handle to the database

    SQLHENV EnvironmentHandle;
    RETCODE retcode = SQLAllocHandle( SQL_HANDLE_ENV, SQL_NULL_HANDLE, &EnvironmentHandle );

    // Set the SQL environment flags

    retcode = SQLSetEnvAttr( EnvironmentHandle, SQL_ATTR_ODBC_VERSION, (SQLPOINTER) SQL_OV_ODBC3, SQL_IS_INTEGER );

    // create handle to the SQL database

    SQLHDBC ConnHandle;
    retcode = SQLAllocHandle( SQL_HANDLE_DBC, EnvironmentHandle, &ConnHandle );

    // Open the database using a System DSN

    retcode = SQLDriverConnect(ConnHandle, 
        NULL, 
        (SQLCHAR*)"DSN=PRG411;UID=myUser;PWD=myPass;", 
        SQL_NTS,
        NULL, 
        SQL_NTS, 
        NULL, 
        SQL_DRIVER_NOPROMPT);
    if (!retcode) 
    {
        cout << "SQLConnect() Failed";
    }
    else
    {
        // create a SQL Statement variable

        SQLHSTMT StatementHandle;
        retcode = SQLAllocHandle(SQL_HANDLE_STMT, ConnHandle, &StatementHandle);

        // Part 1: Create the Employee table (Database)

        do
        {
            cout << "Create the new table? ";
            cin >> chrTemp;
        } while (cin.fail());

        if (chrTemp == 'y' || chrTemp == 'Y')
        {
            strcpy((char *) SQLStmt, "CREATE TABLE [dbo].[Employee]([pkEmployeeID] [int] IDENTITY(1,1) NOT NULL,[FirstName] [varchar](50) NOT NULL,[LastName] [varchar](50) NOT NULL,[Address] [varchar](30) NOT NULL,[City] [varchar](30) NOT NULL,[State] [varchar](3) NOT NULL, [Salary] [decimal] NOT NULL,[Gender] [varchar](1) NOT NULL,  [Age] [int] NOT NULL, CONSTRAINT [PK_Employee] PRIMARY KEY CLUSTERED ([pkEmployeeID] ASC)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]) ON [PRIMARY]");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);
        }

        // Part 2: Hardcode records into the table

        do
        {
            cout << "Add records to the table? ";
            cin >> chrTemp;
        } while (cin.fail());

        if (chrTemp == 'y' || chrTemp == 'Y')
        {
            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Mike','Slentz','123 Torrey Dr.','North Clairmont','CA', 48000.00 ,'M',34)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Sue','Vander Hayden','46 East West St.','San Diego','CA', 36000.00 ,'F',28)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Sharon','Stonewall','756 West Olive Garden Way','Plymouth','MA', 56000.00 ,'F',58)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('James','Bartholemew','777 Praying Way','Falls Church','VA', 51000.00 ,'M',45)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Joe','Smith','111 North 43rd Ave','Peoria','AZ', 44000.00 ,'M', 40)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Michael','Smith','20344 North Swan Park','Phoenix','AZ', 24000.00 ,'M', 40)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Jennifer','Jones','123 West North Ave','Flagstaff','AZ', 40000.00 ,'F', 40)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Cora','York','33rd Park Way Drive','Mayville','MI', 30000.00 ,'F', 61)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

            strcpy((char *) SQLStmt, "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Tom','Jefferson','234 Friendship Way','Battle Creek','MI', 41000.00 ,'M', 31)");
            retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);
        }

        // Part 3 & 4: Searchs based on criteria

        do
        {
            cout << "1\. Display all records in the database" << endl;
            cout << "2\. Display all records with age 40 or over" << endl;
            cout << "3\. Display all records with salary $30K or over" << endl;
            cout << "4\. Exit" << endl << endl;

            do
            {
                cout << "Please enter a selection: ";
                cin >> chrTemp;
            } while (cin.fail());

            if (chrTemp == '1')
            {
                strcpy((char *) SQLStmt, "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE");
            }
            else if (chrTemp == '2')
            {
                strcpy((char *) SQLStmt, "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE WHERE [AGE] >= 40");
            }
            else if (chrTemp == '3')
            {
                strcpy((char *) SQLStmt, "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE WHERE [Salary] >= 30000");
            }

            if (chrTemp == '1'  || chrTemp == '2' || chrTemp == '3')
            {
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                //SQLGetDiagRec(SQL_HANDLE_STMT, StatementHandle, RecNumber, SQLState, NativeErrorPtr, (SQLCHAR*) MessageText, (SQLINTEGER) BufferLength, (SQLSMALLINT*) &TextLengthPtr);

                SQLBindCol(StatementHandle, 1, SQL_C_CHAR, &rtnFirstName, sizeof(rtnFirstName), NULL );
                SQLBindCol(StatementHandle, 2, SQL_C_CHAR, &rtnLastName, sizeof(rtnLastName), NULL );
                SQLBindCol(StatementHandle, 3, SQL_C_CHAR, &rtnAddress, sizeof(rtnAddress), NULL );
                SQLBindCol(StatementHandle, 4, SQL_C_CHAR, &rtnCity, sizeof(rtnCity), NULL );
                SQLBindCol(StatementHandle, 5, SQL_C_CHAR, &rtnState, sizeof(rtnState), NULL );
                SQLBindCol(StatementHandle, 6, SQL_C_DOUBLE, &rtnSalary, sizeof(rtnSalary), NULL );
                SQLBindCol(StatementHandle, 7, SQL_C_CHAR, &rtnGender, sizeof(rtnGender), NULL );
                SQLBindCol(StatementHandle, 8, SQL_C_LONG, &rtnAge, sizeof(rtnAge), NULL );

                for(;;) 
                {
                    retcode = SQLFetch(StatementHandle);
                    if (retcode == SQL_NO_DATA_FOUND) break;

                    cout << rtnFirstName << " " << rtnLastName << " " << rtnAddress << " " << rtnCity << " " << rtnState << " " << rtnSalary << " " << rtnGender << " " << rtnAge << endl;
                }

                SQLFreeStmt(StatementHandle, SQL_CLOSE);

            }
        } while (chrTemp != '4');

        SQLFreeStmt(StatementHandle, SQL_CLOSE );
        SQLFreeHandle(SQL_HANDLE_STMT, StatementHandle);

        SQLDisconnect(ConnHandle);

        SQLFreeHandle(SQL_HANDLE_DBC, ConnHandle);
        SQLFreeHandle(SQL_HANDLE_ENV, EnvironmentHandle);

        printf( "Done.\n" );
    }

    return 0;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T14:48:24.710

您可以从 SQL 中获得足够的诊断信息，从而可以隔离并解决问题。

您可以获取语句句柄，通过在 SQLExecDirect 返回除`SQL_SUCCESS`或`SQL_SUCCESS_WITH_INFO`

`SQLGetDiagRec( SQL_HANDLE_STMT, StatementHandle, req, state, &error, (SQLCHAR*) buffer, (SQLINTEGER) MAX_CHAR, (SQLSMALLINT*) &output_length );`

当然，您必须分配您在此处看到的变量...我建议您在调用之后放置一个丢弃行`SQLGetDiagRec`并为其分配一个断点。当它在那里中断时，您可以查看`state`的值：这将与此处的“诊断”部分一致：http: [//msdn.microsoft.com/en-us/library/ms713611 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms713611(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-30T03:34:21.667

您说您遇到以下错误：

string sqlString = "Select * From Customers Where Customers.Employee = '" +id+ "'";

这应该很明显，对不起，大声笑。id 是整数，当然。但是当您评估字符串时，它会像这样出现：

string sqlString = "Select * From Customers Where Customers.Employee = '100'";

注意有什么问题？你周围有单引号。因此，无论您使用什么数据类型，单引号都会让 SQL 将其视为字符串。所以就像这样把它们拿出来：

string sqlString = "Select * From Customers Where Customers.Employee = " + id + ""; . . . . . . . 或者，字符串 sqlString = "Select * From Customers Where Customers.Employee = " + id;

* * *

我的问题是……你能解释一下在 C++ 中循环记录是如何工作的吗？例如，用户在 strUName 中输入了一个用户名，您想查看该用户名是否在数据库表 Users 中。SQL 很简单（select * from Users where [UName] = '" + strUName + "'; 但是你如何在 C++ 中实际执行它并弄清楚呢？

我看到了 SQLStmt，我看到它是使用 Direct 执行的。然后我看到一些 SQLBindCol 垃圾，然后是一个无限循环，直到 break evals。但我不太明白发生了什么（这对我来说任何其他语言都很容易，但我是 C++ 新手。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-01-20T12:05:27.667

这是更正后的代码。

```
 #include <iostream>
    #include <cstdio>
    #include <string>

    #include <windows.h>
    #include <sql.h>
    #include <sqlext.h>
    #include <sqltypes.h> 

    using namespace std;    // to save us having to type std::

    const int MAX_CHAR = 1024;

    int main()
    {
        SQLSMALLINT     RecNumber;
        SQLCHAR *       SQLState;
        SQLINTEGER *    NativeErrorPtr;
        SQLCHAR *       MessageText;
        SQLSMALLINT     BufferLength;
        SQLSMALLINT *   TextLengthPtr;

        SQLCHAR   SQLStmt[MAX_CHAR];
        char      strSQL[MAX_CHAR];
        char      chrTemp;

        SQLVARCHAR rtnFirstName[50];
        SQLVARCHAR rtnLastName[50];
        SQLVARCHAR rtnAddress[30];
        SQLVARCHAR rtnCity[30];
        SQLVARCHAR rtnState[3];
        SQLDOUBLE  rtnSalary;
        SQLVARCHAR rtnGender[2];
        SQLINTEGER rtnAge;

        // Get a handle to the database

        SQLHENV EnvironmentHandle;
        RETCODE retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &EnvironmentHandle);

        // Set the SQL environment flags
        HWND desktopHandle = GetDesktopWindow();
        retcode = SQLSetEnvAttr(EnvironmentHandle, SQL_ATTR_ODBC_VERSION, (SQLPOINTER)SQL_OV_ODBC3, SQL_IS_INTEGER);

        // create handle to the SQL database

        SQLHDBC ConnHandle;
        retcode = SQLAllocHandle(SQL_HANDLE_DBC, EnvironmentHandle, &ConnHandle);
        SQLSetConnectAttr(ConnHandle, SQL_LOGIN_TIMEOUT, (SQLPOINTER)5, 0);
        // Open the database using a System DSN

        retcode = SQLDriverConnect(ConnHandle,
            desktopHandle,
            (SQLCHAR*)"DSN=PRG411;UID=myUser;PWD=myPass;",
            SQL_NTS,
            NULL,
            SQL_NTS,
            NULL,
            SQL_DRIVER_NOPROMPT);
        if (retcode != SQL_SUCCESS || retcode != SQL_SUCCESS_WITH_INFO)
        {
            cout << "SQLConnect() Failed";
        }   
        else
        {
            // create a SQL Statement variable

            SQLHSTMT StatementHandle;
            retcode = SQLAllocHandle(SQL_HANDLE_STMT, ConnHandle, &StatementHandle);

            // Part 1: Create the Employee table (Database)

            do
            {
                cout << "Create the new table? ";
                cin >> chrTemp;
            } while (cin.fail());

            if (chrTemp == 'y' || chrTemp == 'Y')
            {
                strcpy_s((char *)SQLStmt,1024,  "CREATE TABLE [dbo].[Employee]([pkEmployeeID] [int] IDENTITY(1,1) NOT NULL,[FirstName] [varchar](50) NOT NULL,[LastName] [varchar](50) NOT NULL,[Address] [varchar](30) NOT NULL,[City] [varchar](30) NOT NULL,[State] [varchar](3) NOT NULL, [Salary] [decimal] NOT NULL,[Gender] [varchar](1) NOT NULL,  [Age] [int] NOT NULL, CONSTRAINT [PK_Employee] PRIMARY KEY CLUSTERED ([pkEmployeeID] ASC)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]) ON [PRIMARY]");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);
            }

            // Part 2: Hardcode records into the table

            do
            {
                cout << "Add records to the table? ";
                cin >> chrTemp;
            } while (cin.fail());

            if (chrTemp == 'y' || chrTemp == 'Y')
            {
                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Mike','Slentz','123 Torrey Dr.','North Clairmont','CA', 48000.00 ,'M',34)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Sue','Vander Hayden','46 East West St.','San Diego','CA', 36000.00 ,'F',28)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Sharon','Stonewall','756 West Olive Garden Way','Plymouth','MA', 56000.00 ,'F',58)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('James','Bartholemew','777 Praying Way','Falls Church','VA', 51000.00 ,'M',45)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Joe','Smith','111 North 43rd Ave','Peoria','AZ', 44000.00 ,'M', 40)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Michael','Smith','20344 North Swan Park','Phoenix','AZ', 24000.00 ,'M', 40)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Jennifer','Jones','123 West North Ave','Flagstaff','AZ', 40000.00 ,'F', 40)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Cora','York','33rd Park Way Drive','Mayville','MI', 30000.00 ,'F', 61)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                strcpy_s((char *)SQLStmt,1024,  "INSERT INTO employee([FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age]) VALUES ('Tom','Jefferson','234 Friendship Way','Battle Creek','MI', 41000.00 ,'M', 31)");
                retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);
            }

            // Part 3 & 4: Searchs based on criteria

            do
            {
                cout << "1\. Display all records in the database" << endl;
                cout << "2\. Display all records with age 40 or over" << endl;
                cout << "3\. Display all records with salary $30K or over" << endl;
                cout << "4\. Exit" << endl << endl;

                do
                {
                    cout << "Please enter a selection: ";
                    cin >> chrTemp;
                } while (cin.fail());

                if (chrTemp == '1')
                {
                    strcpy_s((char *)SQLStmt,1024,  "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE");
                }
                else if (chrTemp == '2')
                {
                    strcpy_s((char *)SQLStmt,1024,  "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE WHERE [AGE] >= 40");
                }
                else if (chrTemp == '3')
                {
                    strcpy_s((char *)SQLStmt,1024,  "SELECT [FirstName], [LastName], [Address], [City], [State], [Salary], [Gender],[Age] FROM EMPLOYEE WHERE [Salary] >= 30000");
                }

                if (chrTemp == '1' || chrTemp == '2' || chrTemp == '3')
                {
                    retcode = SQLExecDirect(StatementHandle, SQLStmt, SQL_NTS);

                    //SQLGetDiagRec(SQL_HANDLE_STMT, StatementHandle, RecNumber, SQLState, NativeErrorPtr, (SQLCHAR*) MessageText, (SQLINTEGER) BufferLength, (SQLSMALLINT*) &TextLengthPtr);

                    SQLBindCol(StatementHandle, 1, SQL_C_CHAR, &rtnFirstName, sizeof(rtnFirstName), NULL);
                    SQLBindCol(StatementHandle, 2, SQL_C_CHAR, &rtnLastName, sizeof(rtnLastName), NULL);
                    SQLBindCol(StatementHandle, 3, SQL_C_CHAR, &rtnAddress, sizeof(rtnAddress), NULL);
                    SQLBindCol(StatementHandle, 4, SQL_C_CHAR, &rtnCity, sizeof(rtnCity), NULL);
                    SQLBindCol(StatementHandle, 5, SQL_C_CHAR, &rtnState, sizeof(rtnState), NULL);
                    SQLBindCol(StatementHandle, 6, SQL_C_DOUBLE, &rtnSalary, sizeof(rtnSalary), NULL);
                    SQLBindCol(StatementHandle, 7, SQL_C_CHAR, &rtnGender, sizeof(rtnGender), NULL);
                    SQLBindCol(StatementHandle, 8, SQL_C_LONG, &rtnAge, sizeof(rtnAge), NULL);

                    for (;;)
                    {
                        retcode = SQLFetch(StatementHandle);
                        if (retcode == SQL_NO_DATA_FOUND) break;

                        cout << rtnFirstName << " " << rtnLastName << " " << rtnAddress << " " << rtnCity << " " << rtnState << " " << rtnSalary << " " << rtnGender << " " << rtnAge << endl;
                    }

                    SQLFreeStmt(StatementHandle, SQL_CLOSE);

                }
            } while (chrTemp != '4');

            SQLFreeStmt(StatementHandle, SQL_CLOSE);
            SQLFreeHandle(SQL_HANDLE_STMT, StatementHandle);

            SQLDisconnect(ConnHandle);

            SQLFreeHandle(SQL_HANDLE_DBC, ConnHandle);
            SQLFreeHandle(SQL_HANDLE_ENV, EnvironmentHandle);

            printf("Done.\n");
        }

        return 0;
    } 
```

# .net - 是否有人在生产中使用 Microsoft 软件许可和保护服务 (SLP)？

> ID：153368
> 
> 赞同：4
> 
> 时间：2008-09-30T14:42:59.810
> 
> 标签：.net, licensing, performance

Microsoft 推出了这项相当新的技术，我正在考虑将其用于 .NET 3.5 应用程序。我很好奇，有人已经在使用这项技术了吗？我担心使用安全虚拟机会对性能产生负面影响。此外，从微软宣传产品的方式来看，许可集成似乎非常无缝，不需要在代码中进行任何开发工作。这似乎是一个很棒的产品，但我想确保在投入使用之前我知道任何陷阱。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-19T13:36:54.420

似乎[http://www.inishtech.com](http://www.inishtech.com)已经接管了...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T23:09:50.777

微软今天宣布，他们[不再接受任何](http://blogs.zdnet.com/microsoft/?p=1624)SLP 新客户。听起来整个计划都付诸东流了……我很高兴我的公司还没有注册！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T00:06:46.373

SLP 目前似乎不支持 .NET 3.5。

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3526285&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3526285&SiteID=1)

最好的办法是在 .NET 2.0 或 3.0 中实现一个包含 SLP API 调用的辅助 DLL，对其进行保护并将其添加为对 .NET 3.5 应用程序的引用。

# websphere - NameSpaceBinding 和 wsadmin

> ID：153372
> 
> 赞同：3
> 
> 时间：2008-09-30T14:44:10.710
> 
> 标签：websphere, websphere-6.1, wsadmin, jacl

我正在尝试使用 Websphere 6.1 的 wsadmin 工具创建 StringNameSpaceBinding

这是我采取的步骤 set cell [$AdminConfig getid /Cell:cell/] $AdminConfig create StringNameSpaceBinding $cell { {name bindname} {nameInNameSpace Bindings/string} {stringToBind "这是绑定的字符串值"} }

但是当我运行这最后一步时，我收到如下错误： WASX7015E: Exception running command: "$AdminConfig create StringNameSpaceBinding $cell { {name bindname} {nameInNameSpace Bindings/string} {stringToBind "这是绑定的字符串值" } }"; 异常信息：com.ibm.ws.scripting.ScriptingException：WASX7444E：命令“create”上的参数“parent config id”的参数值“无效”

知道这会发生什么吗？

谢谢达米安

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-10-01T05:09:11.600

我打赌以下命令：

```
set cell [$AdminConfig getid /Cell:cell/] 
```

不工作。很可能，`cell`不是您的单元格的名称。您无需指定单元名称；WAS 拓扑中只有一个单元。我会将其更改为：

```
set cell [$AdminConfig getid /Cell:/] 
```

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-10T07:09:57.590

我遇到了类似的问题，现在从以下行中删除节点和单元名称后解决了：

```
cell = AdminConfig.getid('/Cell:/Node:/Server:WebSphere_Portal/') 
```

# c# - C# 中的固定语句

> ID：153376
> 
> 赞同：12
> 
> 时间：2008-09-30T14:44:58.477
> 
> 标签：c#, .net, memory-management, garbage-collection, unsafe

在我们的一个项目中，我们有与以下类似的代码。谁能解释（用简单的英语）为什么这里需要固定语句？

```
class TestClass
{
    int iMyVariable;
    static void Main()
    {
        TestClass oTestClass = new TestClass();
        unsafe
        {
            fixed (int* p = &oTestClasst.iMyVariable)
            {
                *p = 9;
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-30T14:49:04.460

它修复了内存中的指针。垃圾收集语言可以自由地在内存中移动对象以提高效率。这对程序员来说都是透明的，因为他们并没有真正在“普通”CLR 代码中使用指针。但是，当您确实需要指针时，如果您想使用它们，则需要在内存中修复它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T14:48:25.520

[固定语句](http://msdn.microsoft.com/en-us/library/f58wzh21(VS.80).aspx)会将变量“固定”在内存中，以便垃圾收集器在收集时不会移动它。如果它确实移动了变量，则指针将变得无用，并且当您使用它时，您将尝试访问或修改您不打算访问或修改的内容。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T14:47:17.740

在进行指针运算的任何地方都需要它，以防止垃圾收集器在您身上移动它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T14:48:38.907

因为您在不安全模式（指针）下运行，所以固定指令会为该变量分配特定的内存空间。如果您没有放置固定指令，垃圾收集器可以在需要时将变量移动到内存中的任何位置。

希望这有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T15:00:37.643

[MSDN](http://msdn.microsoft.com/en-us/library/f58wzh21.aspx)有一个非常相似的例子。固定语句基本上阻止垃圾收集。在 .Net 中，如果您使用指向内存位置的指针，运行时可以随时将对象重新分配到“更好”的位置。因此，如果您想直接访问内存，则需要将其修复到位。

# javascript - Javascript 字符串连接比这个例子更快？

> ID：153381
> 
> 赞同：7
> 
> 时间：2008-09-30T14:46:51.920
> 
> 标签：javascript, performance, join

我必须在 Javascript 中连接一堆字符串，并且正在寻找最快的方法。让我们假设 Javascript 必须创建一个大型 XML“文件”，该文件自然由许多小字符串组成。所以我想出了：

```
 var sbuffer = [];
    for (var idx=0; idx<10000; idx=idx+1) {
        sbuffer.push(‘&lt;xmltag>Data comes here... bla... </xmltag>’);
    }
    // Now we "send" it to the browser...
    alert(sbuffer.join(”)); 
```

不要关注循环或构建示例的其他“复杂”代码。

我的问题是：对于未知数量的字符串，您是否有更快的算法/方法/想法将许多小字符串连接到一个大字符串？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-30T14:52:00.270

[JavaScript 字符串连接](https://stackoverflow.com/questions/112158/javascript-string-concatenation)问题有一个公认的答案，它链接到[JavaScript 字符串连接性能的一个非常好的比较](http://www.sitepen.com/blog/2008/05/09/string-performance-an-analysis/)。

**编辑：** 我原以为你可以通过使用 Duff 的设备来获得更多性能，正如文章所建议的那样。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-30T15:45:12.983

换行：

`sbuffer.push(‘Data comes here... bla... ’);`

到

`sbuffer[sbuffer.length] = ‘Data comes here... bla... ’;`

将为您提供 5-50% 的速度增益（取决于浏览器，在 IE 中 - 增益将最高）

问候。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T14:50:45.203

我认为你非常接近最佳状态。YMMV，在宿主进程（例如浏览器）的 JavaScript 引擎中获得或损失了很多速度。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T14:53:13.420

我认为将字符串推入数组然后加入数组是 JavaScript 中字符串连接的最快技术。[在这个关于 W3C DOM 与 innerHTML](http://www.quirksmode.org/dom/innerhtml.html)的讨论中有一些支持性证据。注意innerHTML 1 和innerHTML 2 结果之间的区别。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T14:55:48.123

据我所知，您的算法很好，并且被称为字符串连接问题的高性能解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T18:44:15.720

当心 IE 坏垃圾收集器！使用后您打算如何处理您的阵列？可能它会被GC'd？

您可以在连接连接时获得性能，然后在 GC 后失败。另一方面，如果您始终将数组保留在范围内，而不是重用它，那可能是一个很好的解决方案。

就我个人而言，我想要最简单的解决方案：只使用 += 运算符。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T06:07:55.747

[通过缓冲](https://stackoverflow.com/questions/137534/)，您可能会获得更快的速度。

# delphi - 如何解决 Delphi 的 [Pascal Fatal Error] F2084 Internal Error: LA33？

> ID：153388
> 
> 赞同：18
> 
> 时间：2008-09-30T14:48:38.657
> 
> 标签：delphi, installation, packages

我真的厌倦了这个问题。谷歌搜索似乎总是建议“删除软件包的所有 bpls”、“删除所有 dcus”。有时这只是不起作用。希望我能在这里得到一些其他的想法。

我有一个内部编写的包，几个月前安装没有问题。在对源代码进行了一些更改后，我认为是时候重新编译/重新安装软件包了。现在我得到两个错误，如果我选择“安装”，第一个是

*模块“dcc100.dll”中地址 02422108 的访问冲突。读取地址 00000000。*

...或者如果我尝试构建/编译包，我会得到

*[帕斯卡致命错误] F2084 内部错误：LA33*

这是对我们许多人来说似乎一次又一次出现的 Delphi 问题之一。如果我们可以按照“这些步骤中的任何一个或组合*可能会*修复它，但如果你执行*所有*这些步骤它将*修复*它......”的方式来整理响应，那就太好了。

目前，我已经删除了对这个包的 bpl/dcp 文件的所有引用，但仍然得到同样的错误......

使用 BDS2006（德尔福）

*2008 年 10 月 1 日更新：我设法解决了这个问题 - 请参阅下面的帖子。由于我不能接受自己的答案，因此我不完全确定在这里做什么。显然，对于某些人来说，这些类型的问题经常发生，所以我会暂时搁置一段时间以获取其他建议。那我猜如果有人把所有信息整理成一个超级帖子，我可以接受答案*

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-01T08:46:57.223

我按照以下步骤设法解决了这个问题

1.  创建一个新包
2.  一个一个地，将组件添加到包中，编译安装，直到失败。
3.  调查导致故障的单元。

事实证明，有问题的单元有一个类常量数组，例如

```
TMyClass = class(TComponent)
private
  const ErrStrs: array[TErrEnum] of string
    = ('', //erOK
       'Invalid user name or password', //erInvUserPass
       'Trial Period has Expired'); //erTrialExp
protected
  ...
public
  ...
end; 
```

所以看起来Delphi不喜欢包组件中的类常量（或者可能是类常量数组）

*更新：是的，这已报告给 codegear*

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T14:59:33.140

这些是编译器/链接器中的错误。您可以在 Internet 上以不同的 Delphi 版本找到这些错误的许多参考，但它们并不总是相同的错误。这使得很难为所有这些不同类型的问题提供一种解决方案。

正如您所指出的，可以解决它的一般解决方案是：

*   删除 *.dcp *.dcpil *.dcu *.dcuil *.bpl *.dll
*   用另一种方式重写你的代码
*   修补编译器选项
*   获取最新的 Delphi 版本

如果我关闭 Range Checking，我个人发现其中一个需要解决的错误。如果您不使用另一个单元的泛型，其他问题就解决了。如果将单元名称和类名称重命名为更小，则可以解决一个问题。

当然，您应该在[http://qc.codegear.com上报告您遇到的任何问题](http://qc.codegear.com)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-01-19T11:13:34.907

也许下面的步骤会是一个更好的解决方案：
将数组声明为一种类型，然后用这种类型定义类常量，例如。

```
TMyArray = array[TErrEnum] of string;

TMyClass = class(TComponent)
private
  const ErrStrs: TMyArray
    = ('', //erOK
       'Invalid user name or password', //erInvUserPass
       'Trial Period has Expired'); //erTrialExp
protected
  ...
public
  ...
end; 
```

这使得数组声明显式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-30T20:56:25.913

我在这个问题上浪费了几个小时，删除了 dcu 等都无济于事。

最后，对我有用的是取消选中编译器选项中的溢出检查，重建项目，重新检查溢出检查，然后再次重建。瞧！问题已经消失了。去搞清楚。（仍在使用 D7）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-13T09:59:20.707

我有一个类似的案例，解决方案是从 /lib/debug 中删除文件 urlmon.dcu。

它还可以完全关闭“使用调试 .dcus”。这当然是不可取的，但是您可以使用它来检查问题是否出在您自己的任何单位或任何 delphi 的单位上。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-01-13T13:38:57.880

尝试清理“输出目录”，这样 Delphi 就不能处理脏的 .DCU，它会被迫对 .PAS 进行处理。有时这会有所帮助。如果您没有配置“输出目录”，请尝试删除（或更好地移动到备份文件夹中）所有 .DCU 文件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-03-19T15:40:16.203

从链接器选​​项中禁用“包含远程调试符号”为我解决了 Delphi 2007，dll 项目的问题

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-07-24T11:43:36.523

德尔福 XE3 更新 2

> F2084 内部错误：URW1147

**情况1：**

问题是在泛型类的过程中声明了一个类型。

```
procedure TMyClass<TContainerItem, TTarget>.Foo();
type
  TCacheInfo = record
    UniqueList: TStringList;
    UniqueInfo: TUniqueInfo;
  end;
var
  CacheInfo: TCacheInfo; 
```

将类型声明移动到类声明的私有部分解决了这个问题。

**案例二：**

这种情况下的问题与可选参数有关：

```
unit A.pas;
interface
type
  TTest<T> = class
  public
    type
      TTestProc = procedure (X: T) of object;
    constructor Create(TestProc_: TTestProc = nil);
  end;
... 
```

一旦在另一个单元中声明了 TTest 类的变量，就会发生内部编译错误：例如

```
unit B.pas:

uses A;
var
  Test: TTest<TObject>; 
```

解决方案是使构造函数参数`TestProc_`为非可选。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-22T14:11:33.800

对我来说，在 D2010 中禁用编译器选项“Emit runtime type information”就可以了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-11-28T05:30:48.803

从各种答案来看，这个错误看起来是编译器的通用未处理异常。

我的问题是由错误调用引起的，`function X(someString:String) : Boolean;`它改变了字符串并返回了一个布尔值，使用`someString := X(someString);`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-05-04T07:53:03.837

由于我对内部错误的经验是，我逐行重新编写并再次编译并意识到某些 if else 语句不起作用

发生内部错误

```
 if (DataType in ASet) 
    begin
 //do work
    end
    else if (DataType = B)
    begin
 //do work
    end
    else 
    begin
 //do work
    end; 
```

我是如何解决的：

```
if (DataType = B)
        begin
     //do work
        end
        else if (DataType in ASet) 
        begin
     //do work
        end
        else 
        begin
     //do work
        end; 
```

只是将条件切换为示例。希望它有所帮助。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-09-20T07:57:03.680

我刚刚经历了类似的行为，导致内部错误 LA30。原因是新添加的字符串常量。从改变后 `const cLogFileName : string = 'logfilename.log';`

到 `const cLogFileName = 'logfilename.log';`

（当然还有重新启动 Delphi IDE）错误不再出现。

# java - 没有多播的tomcat会话复制

> ID：153392
> 
> 赞同：4
> 
> 时间：2008-09-30T14:49:28.950
> 
> 标签：java, tomcat, multicast, failovercluster

我计划使用在托管服务提供商处租用的 2 台专用根服务器。这些机器将在集群中运行 tomcat 6。如果我稍后会添加其他机器 - 它们不太可能通过多播访问，因为它们将位于不同的子网中。

没有多播可以运行tomcat吗？tomcat 6 集群的所有教程都包括多播心跳。有没有 SimpleTcpCluster 的替代品？

还是在这种情况下其他替代方案更合适？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T13:20:41.987

由于无法控制两台服务器之间的距离（它们可能位于两个不同的数据中心）并且没有专用的服务器间通信线路，我宁愿通过循环 DNS 或将客户端重定向到 www1.yourdomain 的负载均衡器来运行它们.xxx 或 www2.yourdomain.xxx 并小心处理服务器通信。

如果服务器之间的通信量很大，您可能会寻求更改架构，优化您的应用程序以“适应”一台服务器（至少一段时间），或者使用控制位置的专用托管，服务器的距离和布线。否则，您的服务器间通信、心跳等将使用与与之通信的客户端相同的通道（例如，相同的网段），这可能会减慢每个人的速度。

如果您真的期望有那么多负载，我想至少会涉及一些钱，不是吗？明智地使用它并使用您的设置技能来解决比设置没有控制或专用线路的分布式集群更难的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T13:44:52.873

在给出我的其他答案后看到对该问题的评论，我对您的问题是什么感到困惑......是关于会话复制吗？集群通信？陈述你的问题可能比你计划的解决方案本身有问题更好。

我将说明一些可能的问题以及快速答案：

## 您的应用程序是 CPU/RAM 密集型的

*   分析它，优化它，再试一次
*   购买更大/更好的服务器

## 您的应用程序占用大量带宽

*   使用您在问题中提到的cheapo集群很可能会使情况变得更糟，因为服务器间通信与客户端服务器通信使用相同的（隐藏的）通道
*   您可能能够分离不同类型的带宽，例如通过从不同的服务器提供动态内容而不是静态内容：这里不需要服务器间通信

## 您的应用程序是存储密集型的

*   获得更大的服务器
*   寻求专用托管并根据需要安装尽可能多的旋转磁盘
*   看看其他模型（如亚马逊 S3 存储）是否适合您）

## 您的应用程序可能会被划线

*   确定上述哪些因素（或其他因素）决定了您的应用程序的限制，修复它。

## 你只需要会话复制？

*   Tomcats SessionManager 接口很小，可以很容易地自己实现/扩展。将它用于您喜欢的任何会话复制。有关更多信息，请参阅[StandardManager](http://tomcat.apache.org/tomcat-6.0-doc/api/org/apache/catalina/session/StandardManager.html)文档和实现

## 更多创意

*   查看更灵活的设置，例如 EC2（亚马逊）、谷歌产品或其他云计算设置。利用他们自己的云存储和服务器间通信设施。注意不要过分依赖这个基础设施。

我当然忘记了一些东西，但这可能会提供一些起点。更具体地了解您的潜在问题的性质以获得更好的答案:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-17T17:50:17.617

我正在尝试部署 yale 中央身份验证服务器 (CAS)，并且我想将其集群化以实现冗余，因为这是基础架构的关键部分。CAS 要求复制会话，因为在用户登录应用程序 A 并导航到参与单点登录域的应用程序 B 后，应用程序 B 向 CAS 发送请求以确定用户是否有活动的“票证” . 由于没有设备向应用程序 B 指示它应该将自己定位到哪个节点以验证票证，因此必须将一个节点中的所有活动票证复制到集群中的所有节点。换句话说，会话粘性在这里不是解决方案，因为应用程序 B 在验证用户 cookie 中的票证时，

因此，CAS 要求跨所有节点复制会话。网络支持多播的要求增加了不小的开销，并使这种方法的部署更加繁重。我在谷歌代码测试了这个项目：

[http://code.google.com/p/memcached-session-manager](http://code.google.com/p/memcached-session-manager)

这似乎非常有用且易于部署（至少在 linux 操作系统上），但不幸的是仅提供会话故障转移，而不是会话复制解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-03T09:06:53.447

只需使用[http://code.google.com/p/memcached-session-manager/](http://code.google.com/p/memcached-session-manager/)。它工作得很好。我们多年来一直使用它来进行此设置，其中有 20 个 Tomcat 服务器共享会话。您可以有一个或两个 memcached 服务器来处理会话复制。

# oop - OO 与分层；平衡“OO 纯度”与完成任务

> ID：153394
> 
> 赞同：4
> 
> 时间：2008-09-30T14:50:31.180
> 
> 标签：oop, class-design

我相信 OO，但不至于应该使用不适当的设计/实现来实现“OO 兼容”。

那么，如何应对 Serlvet/EJB/DataContainer 分层架构：

*   Servlet 接收请求并调用“业务层”（例如会话 EJB）
*   业务层从数据库中定位DataContainers并对其进行操作以实现业务逻辑
*   DataContainers 不包含真正的代码，只是获取/设置对应于数据库。

这种方法很有吸引力；DataContainers 清楚地知道它们的作用，并且很容易知道数据的来源。

除了不是 OO 之外，这还会导致业务层类不清楚，难以命名和组织。

即使我们试图**更加**“OO”（例如，将其中一些方法放在 DataConatiners 中），其中一些操作对不止一组数据进行操作。

您如何防止业务层变得混乱，但又不会用业务逻辑污染您的 DataContainer？

### 例子

```
class UserServlet {
  handleRequest() {
    String id = request.get("id");
    String name = request.get("name");
    if (UserBizLayer.updateUserName(id,name))
      response.setStatus(OK);
    else
      response.setStatus(BAD_REQUEST);
  }
}

class UseBizLayer {
    updateUserName(String id, String name) {
        long key = toLong(id);
        user = userDAO.find(key);
        if user == null
            return false;
        if (!validateUserName(name))
            return false;
        user.setName(name);
        userDAO.update(user);
        return true;
    }

    validateUserName(String name) {
        // do some validations and return
    }
}

class User {
    long key;
    String name;
    String email;

    // imagine getters/setters here
} 
```

*   我们不想要`validateUserName`用户，因为它只对名称进行操作；我想它可以进入另一个类，但是我们有**另一个**程序“uti”类型类
*   我们不希望在 User 上使用持久化方法，因为将数据结构与其持久化策略解耦是有价值的
*   我们不希望 Servlet 中包含业务逻辑，因为我们可能需要在其他地方重用该逻辑
*   我们不希望我们的业务逻辑在我们的用户中，因为这对用户类有太多的吸引力，使得业务逻辑的重用变得困难，并将用户与其持久性策略相耦合

我意识到这个例子并没有那么糟糕，但是想象一下 10 个 DataContainers 和 20 个 BizLayer 对象，每个对象都有几个方法。想象一下，其中一些操作并非“以”特定数据容器为中心。

我们如何防止这成为程序上的混乱？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T15:30:44.327

因此，我将在几个要点中解决我对此的想法：

1.  似乎在 Java EE 系统中，有时您必须处理 Java EE 的管道，管道并不总是受益于 OO 概念，但它肯定可以通过一点创造力和工作来实现。例如，您可以利用 AbstractFactory 等东西来帮助尽可能多地通用此基础架构。
2.  您正在研究的很多内容都在 Eric Evans 的优秀著作《领域驱动设计》中进行了讨论。我强烈建议您查看它，因为他确实解决了表达领域知识和处理支持它的技术基础设施的问题。
3.  在阅读并 GROKD 一些 DDD 之后，我会将我的技术基础架构封装在存储库中。存储库都将被编写为使用基于会话 EJB 的持久性策略。您将编写一个知道如何与会话 EJBS 对话的默认实现。要完成这项工作，您需要添加一些约定并在您的界面中指定该约定/约定。存储库完成所有的 CRUD，并且仅在绝对需要时才应该做更多的事情。如果您说“我的 DAOS 是我的存储库”，那么我会同意。
4.  所以继续这个。您需要一些东西来封装在 UseBizLayer 中表达的工作单元。在这个级别上，我认为它的本质是你被困在编写所有将成为事务脚本的代码。您正在创建责任和状态的分离。这通常是我在 Java EE 系统中看到它作为一种默认架构完成的方式。但它不是面向对象的。我会尝试探索该模型，看看我是否至少可以尝试将写入 BizClasses 的一些行为通用化。
5.  我之前使用的另一种方法是去掉 BizLayer 类，然后将来自域的调用代理到执行操作的实际存储库/DAO。然而，这可能需要在基础设施建设方面进行一些投资。但是您可以使用像 Spring 这样的框架做很多事情，并使用一些 AOP 概念来使其正常工作并减少所需的自定义基础架构的数量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:14:30.980

由于您正在实现类和对象，因此无论您如何分层，您的解决方案都将是面向对象的 - 根据您的情况/需求，它的结构可能不是很好！;-)

至于您的具体问题，在某些情况下， validateUserName 属于 User 类是有意义的，因为每个 User 都希望有一个有效的名称。或者，您可以拥有一个验证实用程序类，假设其他事物具有使用相同验证规则的名称。电子邮件也是如此。您可以将它们拆分为 NameValidator 和 EmailValidator 类，如果它们会被大量使用，这将是一个很好的解决方案。您还可以在刚刚调用实用程序类方法的 User 对象上提供一个 validateUserName 函数。所有这些都是有效的解决方案。

OOD/OOP 的一大乐趣在于，当设计正确时，您就*知道*它是正确的，因为很多事情只是从模型中掉出来，您可以做到以前无法做到的。

在这种情况下，我会创建 NameValidator 和 EmailValidator 类，因为其他实体将来可能会有名称和电子邮件地址，但我会在 User 类上提供 validateName 和 validateEmailAddress 函数，因为这样可以为 biz 提供更方便的界面使用的对象。

其余的“我们不想要”的子弹都是正确的；它们不仅是正确分层所必需的，而且对于干净的 OO 设计也是必需的。

基于层之间的关注点分离，分层和 OO 密切相关。我认为您的想法是正确的，但是需要一些实用程序类来进行常见的验证

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T15:15:11.573

想想如果没有计算机，这些任务将如何完成，并以这种方式为您的系统建模。

简单示例... 客户填写表格请求小部件，将其交给员工，员工验证客户身份，处理表格，获取小部件，将小部件和交易记录提供给客户并保存公司某处的交易记录。

客户是否存储他们的数据？不，员工会。员工在存储客户数据时扮演什么角色？客户记录保管员。

表格是否验证已正确填写？不，员工会。员工在这样做时扮演什么角色？表单处理器。

谁给客户小部件？充当小部件分销商的员工

等等...

要将其推送到 Java EE 实现中...

Servlet 代表客户端执行操作，填写表单（从 HTTP 请求中提取数据并生成适当的 Java 对象）并将其传递给适当的员工（EJB），然后由员工处理表单需要完成的事情. 在处理请求时，EJB 可能需要将其传递给另一个专门处理不同任务的 EJB，其中一部分将包括从/向存储（您的数据层）访问/放入信息。唯一不应该直接映射到类比的应该是关于对象如何相互通信以及数据层如何与存储通信的细节。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T15:17:36.963

我自己也有同样的想法。

在传统的 MVC 中，最重要的是将 View 与 Model 和 Controller 部分分开。将控制器和模型分开似乎是个好主意，因为您最终可能会得到臃肿的模型对象：

```
 public class UserModel extends DatabaseModel implements XMLable, CRUDdy, Serializable, Fooable, Barloney, Baznatchy, Wibbling, Validating {
  // member fields
  // getters and setters
  // 100 interface methods
} 

```

尽管您可以为上述许多接口使用单独的控制器（或整个模式），是的，它本质上是相当程序化的，但我想这就是现在的工作方式。或者，您可以意识到某些接口正在做同样的事情（CRUDdy - 数据库存储和检索，Serializable - 与二进制格式相同，XMLable，与 XML 相同），因此您应该创建一个单独的系统来处理这个问题，使用每个潜在的后端都是系统处理的单独实现。天哪，写的真烂。

也许有像“co-classes”这样的东西，让你有单独的源文件用于控制器实现，就好像它们是它们所作用的模型类的成员一样。

至于业务规则，它们经常同时处理多个模型，因此它们应该是分开的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-14T21:43:24.707

我认为这是一个关于“关注点分离”的问题。您似乎在分层架构的正确轨道上走了很长一段路，但也许您需要做更多相同的事情 - 即在您的 Java EE 层中创建架构层？

DataContainer 看起来很像数据传输对象 (DTO) 模式。

现代 OO 设计有很多小类，每个小类都与少数“朋友”相关，例如通过组合。这可能会产生比您真正熟悉的更多的类和 Java 样板，但它应该会产生更好的分层设计，并且更容易进行单元测试和维护。

（+1 代表问题，+1 代表您何时知道自己拥有分层权利的答案）

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-30T14:59:23.343

粗略地说，“我们不想要”部分必须删除。要么你希望它是正确的，要么你希望它保持原样。当你需要一个类时，*不*创建一个类是没有意义的。“我们有很多”是一个糟糕的借口。

确实，*公开*所有内部类*是*不好的，但根据我的经验，为每个概念创建一个类（即一个用户、一个 ID、一个数据库概念......）总是有帮助的。

 *其次，Facade 模式难道不是可以解决大量 BizRules 类的存在，隐藏在一个组织良好且干净的界面后面吗？

# panel - Echo2：如何创建居中的窗格？

> ID：153396
> 
> 赞同：2
> 
> 时间：2008-09-30T14:51:10.523
> 
> 标签：panel, center, echo2

我是 Echo 2 框架的新手。我认为它应该很简单，但是我发现没有办法将生成的内容水平和垂直居中。是否有可能获得具有固定宽度和高度的居中 ContentPane （或类似的东西）？

谢谢，安德烈

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-03-19T08:30:55.650

使用 echoPointNG 找到解决方案：

```
public static ContainerEx createCenteredPane( int width, int height ) {
    ContainerEx cp = new ContainerEx();
    cp.setPosition( Positionable.ABSOLUTE );
    cp.setOutsets( new Insets( width / 2 * -1, height / 2 * -1, 0, 0 ) );
    cp.setWidth( new Extent( width ) );
    cp.setHeight( new Extent( height ) );
    cp.setLeft( new Extent( 50, Extent.PERCENT ) );
    cp.setTop( new Extent( 50, Extent.PERCENT ) );
    return cp;
} 
```

# javascript - 如何对托管在不同域上的 WCF 服务进行 JavaScript 调用？

> ID：153406
> 
> 赞同：3
> 
> 时间：2008-09-30T14:53:38.083
> 
> 标签：javascript, ajax, wcf, xmlhttprequest, wcf-routing

我们正在使用 ASP.NET 和 AJAX 设计一个 Web 应用程序，我们希望在不同的网站上托管我们的 WCF 服务层，并从我们的客户端页面对服务层进行 JavaScript 调用。我们知道浏览器不允许 AJAX 调用到不同的端口或域。构建解决方案的最佳方法是什么？我们正在考虑使用代理层，其服务托管在与具有对服务层的 Web 引用的客户端相同的域上。有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T15:01:13.960

通常最好限制您的页面访问的域数量。服务器端代理确实是一个不错的选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:18:32.220

我认为最好的方法是调用调用远程资源并返回结果的本地页面。通过这种方式，您可以避免跨域问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-14T07:40:12.960

Prototype has a plug in for this. The issue is on the client not the server. www.mellowmorning.com/2007/10/25/introducing-a-cross-site-ajax-plugin-for-prototype/

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-06T08:47:37.193

您的负载均衡器可以将所有请求发送到 /service 到您的服务服务器。

如果您没有负载均衡器，您可以让您的网络服务器充当服务服务器的反向代理。如果您使用的是 IIS7，则可以使用[Application Request Routing 模块](http://learn.iis.net/page.aspx/489/using-the-application-request-routing-module)来执行此操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T09:29:15.247

*   您可以在同一域但不同文件夹下对服务和网站进行虚拟托管。
*   在不同的 dll 中定义服务并在您的网站中创建 svc 文件并将 svc 文件指向具有服务的 dll
*   服务器端代理。

# silverlight - 将“TranslatePosition”从 Silverlight beta 2 更新到 RC 的最佳方法是什么？

> ID：153407
> 
> 赞同：0
> 
> 时间：2008-09-30T14:53:54.400
> 
> 标签：silverlight

我正在将 silverlight beta 2 应用程序升级到 RC0，并具有将点从子元素转换为其父元素的功能。该函数的目的是确保元素恰好出现在子元素的顶部，即使它们不在同一个画布上并且不共享父元素。

这是当前功能：

```
 protected Point TranslatePosition(Point current, Panel from, Panel to, MouseEventArgs e)
    {
        Point rtn = new Point(-1, -1);
        // get point relative to existing parent
        Point fromPoint = e.GetPosition(from);
        // get point relative to new parent
        Point toPoint = e.GetPosition(to);

        // calculate delta
        double deltaX = fromPoint.X - toPoint.X;
        double deltaY = fromPoint.Y - toPoint.Y;

        // calculate new position
        rtn = new Point(current.X - deltaX, current.Y - deltaY);

        return rtn;
    } 
```

请注意，它依赖于 MouseEventArgs.GetPosition 函数来获取相对于现有父级和新父级的位置。在没有可用的 MouseEventArgs 的情况下，我们正在创建一个新实例并将其传入。这是一个 hack，但似乎有效。现在，在 RC0 中，MouseEventArgs 构造函数是内部的，所以这个 hack 不再有效。

关于如何编写一个方法来翻译 RC0 中不依赖于 MouseEventArgs.GetPosition 的点的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T17:39:05.470

请参阅框架元素的 TransformToVisual 方法。它完全符合您的要求：给定另一个控件，它会生成一个新的变换，该变换将一个点相对于当前控件的坐标映射到相对于传入控件的坐标。

```
var transform = from.TransformToVisual(to);
return transform.Transform(current); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T08:40:27.013

然而，但是......呈现转换管道如何接受更新似乎存在问题，这与它在 WPF 中的工作方式不同。

我在[daisley-harrison.com](http://support.daisley-harrison.com/wiki/DeveloperNotes.ashx)创建了一个 wiki 条目，然后讨论了这个问题。[稍后我会在blog.daisley-harrison.com 上将](http://blog.daisley-harrison.com/blog)其转换为博客条目。

# vb.net - 如何在 Linq to XML 中获取 XElement 的 .InnerText 值？

> ID：153413
> 
> 赞同：3
> 
> 时间：2008-09-30T14:54:57.267
> 
> 标签：vb.net, linq, linq-to-xml, kml

我正在尝试从 KML 文件中的地标中提取多边形。到现在为止还挺好：

```
Imports <xmlns:g='http://earth.google.com/kml/2.0'>
Imports System.Xml.Linq

Partial Class Test_ImportPolygons
    Inherits System.Web.UI.Page

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        Dim Kml As XDocument = XDocument.Load(Server.MapPath("../kmlimport/ga.kml"))
        For Each Placemark As XElement In Kml.<g:Document>.<g:Folder>.<g:Placemark>
            Dim Name As String = Placemark.<g:name>.Value
            ...
        Next
    End Sub

End Class 
```

我想将整个`<polygon>...</polygon>`块捕获为字符串。我尝试过这样的事情（上面的 ... ）：

```
 Dim Polygon as String = Placemark.<g:Polygon>.InnerText 
```

但据我所知，XElement 对象没有 InnerText 属性或任何等价物。如何获取定义 XElement 的原始 XML？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T15:11:59.567

你有没有尝试过：

```
Placemark.ToString() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:19:00.283

我缺少的是`Placemark.<g:Polygon>`XElement 的集合，而不是单个 XElement。这有效：

```
 For Each Placemark As XElement In Kml.<g:Document>.<g:Folder>.<g:Placemark>
        Dim Name As String = Placemark.<g:name>.Value
        Dim PolygonsXml As String = ""
        For Each Polygon As XElement In Placemark.<g:Polygon>
            PolygonsXml &= Polygon.ToString
        Next
    Next 
```

正如 tbrownell 所建议的，XElement.ToString 相当于 InnerText。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T15:36:58.540

我也错过了枚举。使用 .Value 时，可能会收到空异常。试试这个的等价物：

```
(string)Placemark.<g:name> 
```

抱歉，不确定 VB 语法，，，自从我在 VB 中编码以来已经有一段时间了。

# java - 用Java可视化代码流的工具？

> ID：153414
> 
> 赞同：36
> 
> 时间：2008-09-30T14:55:30.310
> 
> 标签：java, code-analysis

我受到代码流可视化工具的[C/C++问题的启发。](https://stackoverflow.com/questions/153074/tool-to-visualise-code-flow-cc)

Java servlet 或应用程序有这样的事情吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-10-18T13:59:42.343

也许Eclipse / IntelliJ IDEA 中的++ `Ctrl`？（albo 出现在 NB 某处）或 IntelliJ IDEA 中的“数据流向/流向”？`Alt``H`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-02-24T11:40:17.753

[http://code.google.com/p/jtracert/](http://code.google.com/p/jtracert/)已停止使用。新项目的链接是： [https ://github.com/bedrin/jsonde](https://github.com/bedrin/jsonde)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T15:00:26.257

如果发现[doxygen](http://www.doxygen.nl/)也适用于 Java。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-25T09:19:45.020

Source Navigator 说它支持 Java，尽管我自己只将它用于 C/C++。 [http://developer.berlios.de/projects/sourcenav](http://developer.berlios.de/projects/sourcenav)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-10T21:59:19.597

我已经对此进行了测试，并且非常适合自动生成序列图

[https://github.com/bedrin/jsonde](https://github.com/bedrin/jsonde)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T15:06:57.130

IBM 有一个旧的（2004 年）[结构分析工具](http://www.alphaworks.ibm.com/tech/sa4j)，可以对 Java 代码进行一些可视化。

[Netbeans 的](http://www.netbeans.org/)UML 对代码进行逆向工程也做得不错。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T14:57:51.987

[JBuilder](http://www.codegear.com/products/jbuilder)的 UML 视图取得了一些进展

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-06-22T14:07:00.287

你的意思是[Jeliot](http://cs.joensuu.fi/jeliot/)和[jGrasp 之](http://www.jgrasp.org/)类的东西？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-03T14:00:33.963

HandyEdit 制作了一个插件，可以做到这一点：[http ://plugins.intellij.net/plugin/?id=3739](http://plugins.intellij.net/plugin/?id=3739)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-10-26T14:02:36.983

我最喜欢的是[克里奥尔语](http://www.thechiselgroup.com/creole)。不幸的是，最后一次更新是在 2007 年 8 月 10 日进行的……但仍然值得一试。

另一个选择，但更多的是架构可视化而不是代码流，是 Structure101，它是一个很棒的工具，绝对值得一试。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-10-18T14:30:30.337

在 UML 2 中有两种基本类型的图：结构图和行为图。每个 UML 图都属于这两个图类别之一。结构图的目的是显示被建模系统的静态结构。它们包括类、组件和/或对象图。另一方面，行为图显示了系统中对象之间的动态行为，包括它们的方法、协作和活动等。示例行为图是活动图、用例图和序列图。

在这里，我的理解是，OP 要求一种工具来可视化**代码流**（这是问题的标题），即动态行为。一个完美的图表将是序列图。

但是，AFAIK，UML 逆向工程工具和 Doxygen 都无法从源代码中找出此类图表。这些工具知道如何生成结构图（例如类图），但不知道如何生成行为图（这需要执行）。所以这些工具不能回答这个问题（即使对于 C++）。

IMO，要可视化代码流，您必须查看有人指出的调用层次结构。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-04-25T04:40:40.613

[Heatlamp](http://www.jmolly.com/heatlamp)将可视化运行的 Java 代码。它还可以可视化 Java 堆栈跟踪。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-04-09T03:59:36.010

查看[Onyem JTracer](http://www.onyem.com)该工具通过分析您的 java 程序自动生成执行流程图。我也将它与相对较大的代码库一起使用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-06-05T18:03:50.580

我认为[Zeta Code](http://www.kickstarter.com/projects/296054304/zeta-code)试图做到这一点。

# security - 在 EXE / RAM 中加密纯文本 :: HxD 编辑器

> ID：153416
> 
> 赞同：1
> 
> 时间：2008-09-30T14:55:37.533
> 
> 标签：security, hex-editors

HxD（十六进制编辑器）允许搜索/查看/编辑 RAM。

如何保护 EXE 免受此类编辑器的侵害？数据在 INI/registry/DB 中加密，但在 RAM 中解码。

解决办法是什么？在运行时尽快解码、使用和重新编码 RAM 中的数据？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-30T14:59:53.170

您可以使用 Themida 之类的 exe 保护程序（它甚至会使查看内存变得困难），但请记住，用户会因此而讨厌您。此外，请记住，Themida 与所有其他保护程序一样，经常被破解，尽管此类软件的供应商声称如此。

简而言之：永远没有防止逆向工程的好方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T15:15:14.333

你正试图用茶匙阻止大海。

这种“内存保护”是好的（邪恶的？）恶意软件所做的。我已经看到了如何打破这种“保护”的现场演示。它最终是无用的 - 在某些时候，您的明文*必须*可供计算机执行。一个称职的程序员/逆向工程师可以很容易地找到明文何时可用，然后暂停程序并在空闲时检查进程内存。

这与 RIAA 面临的 DRM 问题相同：要求有缺陷。您想对用户隐藏您的程序，但为了让他们使用它，他们*必须*在某个时候拥有明文。

您唯一可能的拯救[TPM](http://en.wikipedia.org/wiki/Trusted_Platform_Module)，但它们在消费市场中非常罕见，您的用户群将降至个位数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T16:08:27.763

不太确定他们是否在这个级别上这样做，但开源密码管理器[KeePass声称会尽一切可能小心隐藏密码以防止调查。](http://keepass.info/ "记事通")看看他们是如何做到的可能会很有趣...... :-)

# java - 使用 Flex 创建 REST 客户端是否可行？

> ID：153420
> 
> 赞同：32
> 
> 时间：2008-09-30T14:56:40.977
> 
> 标签：java, apache-flex, rest

我正在使用用 Java 实现的 Restful 架构开始一个项目（使用新的 JAX-RS 标准）

我们计划使用 Flex 应用程序开发 GUI。我已经发现使用 HTTPService 组件的这个实现存在一些问题（响应错误代码、标题访问......）。

你们中的任何人都有类似项目的经验。可行吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-02T16:10:31.297

这里的问题是，很多围绕这个问题的网络讨论已经有一年或更长时间了。我现在正在做同样的研究，这就是我今天学到的。

Jorge Rasillo 和 Mike Burr 于 2008 年 8 月撰写的这篇[IBM Developer Works 文章](http://www.ibm.com/developerworks/websphere/library/techarticles/0808_rasillo/0808_rasillo.html)展示了如何制作 Flex 前端/RESTful 后端应用程序（PHP 和 Groovy 中的示例）。不错的文章。无论如何，这里是外卖：

*   他们的 PHP/Groovy 代码*使用并期望*PUT 和 DELETE。
*   但是 Flex 代码必须使用 POST，但将 HTTP 标头 X-Method-Override 设置为 DELETE（我认为您可以对 PUT 执行相同的操作）。
*   请注意，这*不是*上面讨论的代理方法。

```
`// Flex doesn't know how to generate an HTTP DELETE.
// Fortunately, sMash/Zero will interpret an HTTP POST with
// an X-Method-Override: DELETE header as a DELETE.
deleteTodoHS.headers['X-Method-Override'] = 'DELETE';`
```

`这里发生了什么事？IBM Web 服务器截获“POST with DELETE”并将其解释为 DELETE。`

 `因此，我进一步挖掘并找到了这篇[文章并与 Don Box](http://www.pluralsight.com/community/blogs/dbox/archive/2007/01/16/45725.aspx)（最初的 SOAP 人之一）进行了讨论。显然这是一种相当标准的行为，因为某些浏览器等不支持 PUT 和 DELETE，并且是一种已经存在一段时间的解决方法。这是一个片段，但还有更多的讨论。

> “如果我正在构建一个 GData 客户端，我真的想知道为什么我会费心使用 DELETE 和 PUT 方法，因为 X-HTTP-Method-Override 将在更多情况/部署中工作。”

我从中得出的结论是，如果您的 Web 端支持此 X-Method-Override 标头，那么您可以使用这种方法。Don Box 的评论让我觉得它得到了很好的支持，但我还没有证实这一点。

另一个问题是关于能够读取 HTTP 响应标头。同样，从[Nathan de Vries 2007 年的一篇博文中](http://www.atnan.com/2007/6/11/can-as3-do-rest-or-not)，我们看到了这一点的讨论。他用自己的评论跟进了那篇博文和讨论：

> “Web 前端的唯一变化是 Flash Player 的较新版本（当然是 Flex 3 beta 提供的那些）现在支持 HTTPStatusEvent 实例的 responseHeaders 属性。”

我希望这意味着它现在不是问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T13:16:26.747

正如许多人指出的那样`HTTPService`，这有点简单，并没有做你想做的所有事情。但是，这只是,和等类`HTTPService`之上的糖。使用这些，您可以组装大多数 HTTP 请求。`flash.net.*``URLLoader``URLRequest``URLRequestHeader`

当涉及到对 GET 和 POST 以外的其他方法的支持时，问题主要在于某些浏览器（例如 Safari）不支持这些方法，而 Flash Player 的所有网络都依赖于浏览器。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-30T15:16:05.377

Flex 充当纯 RESTful 客户端的能力存在明显的缺陷。

以下评论来自此[博客](http://fantastic.wordpress.com/2007/12/26/flex-is-not-friendly-to-rest/#comments)：

> 问题是 HTTPService 类有几个主要限制：
> 
> 1.  开箱即用仅支持 GET 和 POST 方法（除非您使用 FDS 并将 useProxy 属性设置为 true）
> 2.  无法设置请求标头，也无法访问响应标头。因此，如果出现错误，我将无法访问响应正文。
> 3.  它 HTTPService 得到一个 200 以外的状态码，它认为是一个错误。（事件 201，哎哟！！）。FaultEvent 不提供有关任何响应正文的状态代码的信息。Flex 客户端不知道出了什么问题。

[Matt Raible](http://raibledesigns.com)还[对带有 Rails、Grails、GWT 和 Flex 的 REST 做了一个很好的介绍，](http://raibledesigns.com/rd/entry/oscon_2008_web_frameworks_of)其中有一些很好的参考链接。

它是否可行实际上取决于您愿意通过代理等来解决多少问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-09T00:52:13.733

我一直在研究完全支持 REST 的 HTTPService 组件的开源替代品。如果有兴趣，您可以在此处找到 beta 版本（源代码和/或编译后的 Flex 共享运行时库）和说明：

[http://code.google.com/p/resthttpservice/](http://code.google.com/p/resthttpservice/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-14T02:29:29.393

简短的回答是肯定的，你可以用 Flex 做 RESTful。您只需要解决 Flash 播放器的限制（使用最新版本更好）和包含浏览器的 HTTP 堆栈限制。

在通过 rails-esque ?_method= 方法解决了基本的 HTTP 请求标头以及缺少 PUT 和 DELETE 之后，我们在 Flex 中进行 RESTful 客户端开发已经有一年多了。也许俗气，但它可以完成工作。

[我在http://verveguy.blogspot.com/2008/07/truth-about-flex-httpservice.html](http://verveguy.blogspot.com/2008/07/truth-about-flex-httpservice.html)的一篇旧博客文章中注意到了一些标题的痛苦

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-03-10T21:31:50.573

Flex 对 REST 的支持充其量是很弱的。我花了很多时间构建原型，所以我知道大部分问题。如前所述，开箱即用仅支持 GET 和 POST。乍一看，您似乎可以使用 LiveCycle Data Services 或 Blaze 中的代理配置来获得对 PUT 和 DELETE 的支持。然而，它是一个骗局。来自您的 Flex 应用程序的请求仍将是 ​​POST。代理将其转换为服务器端的 PUT 或 DELETE 以欺骗您的服务器端代码。还有其他问题。听说这是 Adob​​e 所能想到的最好的方案。经过我的评估，我们决定朝另一个方向发展。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T15:35:54.393

是的，我能够使用 POST 并通过此组件访问标头：

[http://code.google.com/p/as3httpclient/wiki/Links](http://code.google.com/p/as3httpclient/wiki/Links)

[例子](http://www.abdulqabiz.com/blog/archives/flash_and_actionscript/http_authentica.php)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T19:29:05.393

我现在正在开发一个严重依赖于 Flex 和 JavaScript 以及 Java Servlet 之间的 REST 调用的应用程序。我们通过建立一个在错误时返回的 <status id="XXX" name="YYYYYY"> 块的约定来解决响应错误代码问题，错误 ID 大致映射到 HTTP 错误代码。

我们通过使用 Java Servlet 作为 HTTP 代理解决了跨站点脚本的限制。对代理的调用（它在为其余内容（包括 Flex 内容）提供服务的同一台服务器上运行，将请求发送到另一台服务器，然后将响应发送回原始调用者。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-10-05T07:43:48.050

[RestfulX](http://wiki.github.com/dima/restfulx_framework/working-with-restfulx-service-providers)解决了 Flex 的大部分/所有 REST 问题。它支持 Rails/GAE/Merb/CouchDB/AIR/WebKit，我相信将它连接到您的 Java 实现会很容易。

Dima 也将 AS3HTTPClient 库集成到其中。

看看这个！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T15:31:18.147

实际上已经在使用带有 Rest-Style 框架的 Flex。正如 mbrevort 已经提到的那样，不能直接使用 PUT 和 DELETE 方法。相反，我们通过 POST 进行 PUT，而对于 DELETE，我们在具有 URL 参数（如 ?action=delete）的资源上使用 GET。

这不是 100% Rest 风格，所以我不确定这是否适用于 JSR 311 实现。您将需要服务器端的一些灵活性来解决 PUT 和 DELETE 限制。

关于错误处理，我们实现了错误服务。如果发生服务器端错误，Flex 应用程序可以查询此错误服务以获取实际的错误消息。这也比仅仅将 HTTP 返回码映射到静态消息灵活得多。

然而，感谢 Flex 的 ECMA 脚本，使用基于 XML 的 REST 服务非常容易。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-24T21:13:03.167

REST 更像是一种意识形态。你去 REST 演示，他们有coolaide 分配器。

对于 Flex 应用程序，结合 BlazeDS 和 AMF 数据编组滚动堆栈更方便且性能更高。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-24T22:06:10.017

我过去管理这个的方法是利用一个 PHP 代理来处理远程 Web 服务调用并将 RTU JSON 返回给客户端..

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-08-12T20:57:03.557

可能是新的 flex 4 是答案[http://labs.adobe.com/technologies/flex4sdk/](http://labs.adobe.com/technologies/flex4sdk/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-02-10T17:10:35.637

《[Flexible Rails](http://www.manning.com/armstrong/) 》一书可能会有所帮助——它是关于如何将 Flex 用作 RESTful 客户端的极好资源。尽管它侧重于将 Flex 与 Rails 框架结合使用，但我相信这些概念适用于任何 RESTful 框架。我使用这本书来快速了解如何将 Flex 与 REST 结合使用。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-10-25T15:58:40.877

我为富兰克林柯维做一个大型的弹性项目。我们使用 REST 服务。为了支持这一点。我们创建了一个 XMLHttpRequest 包装器。通过使用带有一些事件处理程序的外部接口。我们开源了这个库。[您可以在https://github.com/FranklinCovey/AS3-XMLHttpRequest](https://github.com/FranklinCovey/AS3-XMLHttpRequest)查看它

# java - 是否有用于运行测试组的 JUnit TestRunner？

> ID：153427
> 
> 赞同：14
> 
> 时间：2008-09-30T14:58:18.867
> 
> 标签：java, unit-testing, junit

我目前正在使用 JUnit 4，并且需要将我的测试分成可以以任何组合有选择地运行的组。我知道 TestNG 具有注释测试以将它们分配给组的功能，但我现在无法迁移到 TestNG。似乎这可以通过一些自定义注释和自定义 JUnit TestRunner 在 JUnit 中轻松完成。我已经检查了 JUnit 文档并搜索了网络，但找不到这样的东西。有人知道这样的TestRunner吗？

更新：感谢您对测试套件的回复。我应该在我原来的问题中解决这些问题。让我们开始吧：我不想使用测试套件，因为它们需要我手动创建和管理它们，这意味着我要手动处理我的所有测试并将它们安排到套件中（太多的工作和维护的噩梦）。我需要做的就是运行所有的单元测试，除了一些真正的集成测试。所以我想注释这些，并运行所有其他的。在其他时候，我只想运行集成测试。我还需要将单元测试放入多个组中，这在套件中是不可能的。希望这有助于解决问题。

更新 2：如果 JUnit 没有此 OOB，我正在寻找一个将其添加到 JUnit 的开源库（注释 + 自定义 JUnit 测试运行器）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-30T15:21:53.460

JUnit 目前没有这样的跑步者。解决根本问题，需要在有限的时间内从测试套件中获得合理保证，这是我们下一个版本的最高开发优先级。与此同时，实现一个通过注释工作的过滤器似乎不是一个大项目，尽管我有偏见。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T15:24:55.153

查看 Spring 的[SpringJUnit4ClassRunner](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/test/context/junit4/SpringJUnit4ClassRunner.html)。[我使用IfProfileValue](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/test/annotation/IfProfileValue.html)注释，使用它来选择性地运行基于 System 属性的测试。

这：

```
@IfProfileValue(name="test-groups", values={"unit-tests", "integration-tests"})
  public void testWhichRunsForUnitOrIntegrationTestGroups() {
      // ...
 } 
```

如果系统属性“test-groups”设置为“unit-tests”或“integration-tests”，将运行。

更新：[JUnitExt](http://junitext.sourceforge.net/)有`@Category`和`@Prerequisite`注释，看起来它应该做你需要的。但是，我自己从未使用过它，所以我不能保证它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T15:41:12.993

首先，您要解决两个问题 - 单元测试（通常与被测单元在同一个包中）和集成测试。我通常将集成测试保存在一个单独的包中，例如 com.example.project.tests。在 Eclipse 中，我的项目如下所示：

```
project/
  src/
    com.example.project/
  tsrc/
    com.example.project/
    com.example.project.tests/ 
```

右键单击包并选择“运行”运行包中的测试；对源文件夹执行相同操作会运行所有测试。

[您可以通过使用Suite runner 获得](http://junit.sourceforge.net/javadoc_40/org/junit/runners/Suite.html)类似的效果，尽管您对此表示不感兴趣 。但是，这违反了 DRY - 您必须在套件类中保持测试名称的副本是最新的。但是，您可以轻松地将相同的测试放在多个套件中。

```
@RunWith(Suite.class)
@Suite.SuiteClasses( { 
    TestAlpha.class, 
    TestBeta.class })
public class GreekLetterUnitTests {
} 
```

当然，我真的应该让这些事情保持自动化。一个很好的方法是使用[Ant 任务](http://ant.apache.org/manual/Tasks/junit.html)。

```
<target name="tests.unit">
  <junit>
    <batchtest>
      <fileset dir="tsrc">
        <include name="**/Test*.java"/>
        <exclude name="**/tests/*.java"/>
      </fileset>
    </batchtest>
  </junit>
</target>
<target name="tests.integration">
  <junit>
    <batchtest>
      <fileset dir="tsrc">
        <include name="**/tests/Test*.java"/>
      </fileset>
    </batchtest>
  </junit>
</target> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T15:19:57.207

不，遗憾的是，没有与 TestNG 组类似的概念。它是为 JUnit4 计划的，但由于一些不清楚的原因，它被从计划中删除了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T15:01:17.940

您可以创建套件，尽管这会将所有配置放在套件中，而不是在注释中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T15:01:55.347

JUnit 3 允许您创建可以像任何其他测试一样运行的测试套件。JUnit 4 没有类似的概念吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T15:17:32.207

如果您使用的是 ANT 或 maven，则可以通过按名称过滤测试来控制运行哪些测试。有点尴尬，但它可能对你有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T19:32:33.233

TestNG 有我的投票。它基于注释，可以作为组、单个测试等运行，可以链接到 Maven，并且可以运行所有 JUnit 测试作为其测试运行的一部分。

我强烈推荐它而不是 JUnit。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-12T13:44:35.303

我的建议只是放弃 JUnit 并使用 TestNG。一旦你习惯了 TestNG，Junit 看起来就像石器时代。

# wix - 安装一系列嵌入式 MSI 包，每个包都使用嵌入式 UI - 显示常用进度条

> ID：153431
> 
> 赞同：6
> 
> 时间：2008-09-30T14:58:49.380
> 
> 标签：wix, windows-installer

我正在使用 Windows Installer 4.5 新功能和 WiX 来生成[MSI](http://en.wikipedia.org/wiki/Windows_Installer)包。

我创建了一个 MSI 链安装，以便将其他 MSI 包的集合安装为事务。每个包都使用新的*Embedded UI*选项，因此 UI 可以是[WPF](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)。到目前为止一切正常。

除了目标之一是为所有安装显示一个通用进度条。此时，我在链安装程序中有一个进度条，但是在其他包开始运行之前，这个进度条达到了 100%。

我读过一篇文章*[Fun with MsiEmbeddedChainer](http://softwareinstall.blogspot.com/2008/06/fun-with-msiembeddedchainer.html)*，其中指出可以实现我想要的。但我无法让它工作。我想要更详细的解释，也许还有一些代码示例。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T17:10:57.407

`INSTALLMESSAGE_PROGRESS`您可以通过向安装程序发出消息来手动控制进度条的状态。详细信息可以在这里找到：

[http://msdn.microsoft.com/en-us/library/aa370354.aspx](http://msdn.microsoft.com/en-us/library/aa370354.aspx)

特别是，您需要一个自定义操作来管理状态栏（它将负责对 进行适当的调用`MsiProcessMessage`。我建议您也使用它来生成子安装程序。这里有一些伪代码来说明我的想法是：

```
LONG LaunchSubinstallersCA(MSIHANDLE current_installer)
{
    // Initialize the progress bar range and position
    MsiProcessMessage(current_installer, reset_message); // see MSDN for details

    for each (subinstaller in list_of_installers)
    {
        launch subinstaller;  // see MSDN for details

        // Update the progress bar to reflect most recent changes
        MsiProcessMessage(current_installer, increment_message); // see MSDN for details
    }

    return (result);
} 
```

主要的缺点是进度条将以一种有点不稳定的方式前进。如果您真的想变得花哨并使其更流畅，您可以启动一个单独的“侦听器”线程，该线程将等待来自子安装程序的更新，以便对进度条进行更细粒度的增量。就像是：

```
LONG LaunchSubinstallersCA(MSIHANDLE current_installer)
{
    // Initialize the progress bar range and position
    MsiProcessMessage(current_installer, reset_message); // see MSDN for details

    launch_listener_thread();  // launches listener_thread_proc (see below)

    for each (subinstaller in list_of_installers)
    {
        launch subinstaller;  // see MSDN for details
    }

    tell_listener_thread_to_stop();
    optionally_wait_for_listener_thread_to_die();

    return (result);
}

void listener_thread_proc()
{
    // Loop until told to stop
    while (!time_for_me_to_stop)
    {
        // Listen for update from sub-installer
        timed_wait_for_update();  // probably required IPC, perhaps a named event?

        // Only update the progress bar if an update message was actually received
        if (!timeout)
        {
            // Update the progress bar to reflect most recent changes
            MsiProcessMessage(current_installer, increment_message); // see MSDN for details
        }
    }
} 
```

显然，每个子安装程序都必须能够向主安装程序发出已取得进展的信号，因此这可能需要对您的产品进行更广泛的更改。这是否值得努力取决于你。

# c# - 从通过反射调用的 COM 方法中检索原始错误号

> ID：153438
> 
> 赞同：0
> 
> 时间：2008-09-30T15:00:01.233
> 
> 标签：c#, .net, com, interop

我有一个 VB6 COM 组件，我需要从我的 .Net 方法中调用它。我使用反射来创建 COM 对象的实例并以下列方式激活它：

```
f_oType = Type.GetTypeFromProgID(MyProgId);
f_oInstance = Activator.CreateInstance(f_oType); 
```

我需要使用 GetTypeFromProgID 而不是使用 tlbimp 来针对 COM DLL 创建一个库，因为我需要实例化的类型的 ProgId 可能会有所不同。然后我使用 Type.InvokeMember 在我的代码中调用 COM 方法，例如：

```
f_oType.InvokeMember("Process", BindingFlags.InvokeMethod, null, f_oInstance, new object[] { param1, param2, param3, param4 }); 
```

我捕获任何引发的 TargetInvocationException 进行日志记录，并且可以从 TargetInvocationException.InnerException 字段中获取详细的错误描述。但是，我知道 COM 组件使用 Error.Raise 来生成错误号，我需要以某种方式在我的调用 .Net 应用程序中获取它。

问题似乎源于 TargetInvocationException 不包含错误号，正如我所期望的那样，如果它是一个正常的 COMException 则：

***如何从我的 .Net 代码中的 COM 对象获取错误号？***

或者

***当 COM 组件失败时，我能否以一种会导致 COMException（包含错误号）而不是 TargetInvocationException 的方式进行相同的调用？***

另请注意，目标平台是 .Net 2.0，我确实可以访问 VB6 源代码，但会认为将 VB6 引发的错误消息更改为包含错误代码作为文本的一部分有点像 hack。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T23:06:54.107

您将处理 COMException 并使用该异常对象的 ErrorCode 属性。通常在 Visual Basic DLL 中，如果您抛出自定义错误，您会使用以下命令引发错误：Err.Raise vbObjectError + 88, "Project1.Class1.Test3()", "Forced error test"

如果是这种情况，您需要从异常 ErrorCode 中减去 vbobjecterror (-2147221504) 以获得实际的错误编号。如果不只是使用 ErrorCode 值。

示例 VB dll 代码：（来自 Project1.Class1）

公共子Test3()

```
MsgBox "this is a test 3"
Err.Raise vbObjectError + 88, "Project1.Class1.Test3()", "Forced error test" 
```

结束子

示例 C# 消费处理代码：

```
 private void button1_Click(object sender, EventArgs e)
    {
        try
        {
            var p = new Class1();
            p.Test3();
        }
        catch (COMException ex)
        {
            int errorNumber = (ex.ErrorCode - (-2147221504));
            MessageBox.Show(errorNumber.ToString() + ": " + ex.Message);
        }
        catch(Exception ex)
        { MessageBox.Show(ex.Message); }
    } 
```

我刚刚完成的这个测试中的 ErrorCode 按预期返回 88。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T23:35:52.803

我仔细查看了您的代码，并通过反射处理 TargetInvocationException 并使用内部异常 COMException ... 下面的代码示例（我也运行并测试了它）：

```
 private void button1_Click(object sender, EventArgs e)
    {
        try
        {
            var f_oType = Type.GetTypeFromProgID("Project1.Class1");
            var f_oInstance = Activator.CreateInstance(f_oType);
            f_oType.InvokeMember("Test3", BindingFlags.InvokeMethod, null, f_oInstance, new object[] {});
        }
        catch(TargetInvocationException ex)
        {
            //no need to subtract -2147221504 if non custom error etc
            int errorNumber = ((COMException)ex.InnerException).ErrorCode - (-2147221504);
            MessageBox.Show(errorNumber.ToString() + ": " + ex.InnerException.Message);
        }
        catch(Exception ex)
        { MessageBox.Show(ex.Message); }
    } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T23:50:52.987

只想提供对@sharvell 的捕获代码的更新。除非您绝对确定 InnerException 是 COMException，否则最好先安全地测试它。否则，您的异常处理程序中将出现异常。哎呀！

```
catch(TargetInvocationException ex)
{
    if( ex.InnerException != null && ex.InnerException is COMException )
    {
        COMException ce = (COMException)ex.InnerException;
        // do something with ce - e.g. logging the error
    }
    // else InnerException not set, or it's not a COMException
} 
```

# javascript - jQuery 索引选择器

> ID：153439
> 
> 赞同：5
> 
> 时间：2008-09-30T15:00:01.810
> 
> 标签：javascript, jquery, dom

我正在尝试将 4 个图像容器放入一个新窗格中，总共有 16 个图像。下面的 jQuery 是我想出的。第一个窗格正确显示，其中包含 4 个图像。但第二个有 4 个图像，加上第三个窗格。第三个窗格有 4 个图像加上第 4 个窗格。我不知道为什么会发生嵌套。我的包装不能导致他们的索引改变。我向它们添加了 css 边框，它似乎已正确编入索引。我该怎么办？我想要的是一个窗格中有 1-4 个，另一个窗格中有 5-8 个，9-12 和 13-16。它需要是动态的，以便我可以更改每个窗格中的数字，因此仅在 HTML 中执行它不是一种选择。

可以在此处查看该问题的演示：http: [//beta.whipplehill.com/mygal/rotate.html](http://beta.whipplehill.com/mygal/rotate.html)。我正在使用 firebug 来查看 DOM。

任何帮助都会很棒！

jQuery 代码

```
$(function() { 
    $(".digi_image:gt(-1):lt(4)").wrapAll("<div class=\"digi_pane\"></div>").css("border", "2px solid red");
    $(".digi_image:gt(3):lt(8)").wrapAll("<div class=\"digi_pane\"></div>").css("border", "2px solid blue");
    $(".digi_image:gt(7):lt(12)").wrapAll("<div class=\"digi_pane\"></div>").css("border", "2px solid green");
    $(".digi_image:gt(11):lt(16)").wrapAll("<div class=\"digi_pane\"></div>").css("border", "2px solid orange");
    $(".digi_pane").append("<div style=\"clear: both;\"></div>");
}); 
```

HTML（缩写），但基本上重复了 16 次。

```
<div class="digi_image">
    <div class="space_holder"><img src="images/n883470064_4126667_9320.jpg" width="100" /></div>
</div> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T15:30:29.367

我认为您的问题是您使用了 gt() 和 lt() 选择器。您应该改为查找 slice() 。

查看这篇文章： [http ://docs.jquery.com/Traversing/slice](http://docs.jquery.com/Traversing/slice)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:41:08.903

对于那些好奇的人......这就是我所做的。

```
$(".digi_image").slice(0, 4).wrapAll("<div class=\"digi_pane\"></div>").css("border", "2px solid red");
$(".digi_image").slice(4, 8).wrapAll("<div class=\"digi_pane\"></div>").css("border", "2px solid blue");
$(".digi_image").slice(8, 12).wrapAll("<div class=\"digi_pane\"></div>").css("border", "2px solid green");
$(".digi_image").slice(12, 16).wrapAll("<div class=\"digi_pane\"></div>").css("border", "2px solid orange");
$(".digi_pane").append("<div style=\"clear: both;\"></div>"); 
```

它完全按照我的需要工作。可能会变得更有效率，但它确实有效。

# dependencies - 如何跟踪系统依赖关系？

> ID：153445
> 
> 赞同：15
> 
> 时间：2008-09-30T15:01:09.937
> 
> 标签：dependencies, system

**介绍**

在我目前的组织中，我们有许多桌面和 Web 应用程序都在某个时候相互提供。在维护旧应用程序或创建新应用程序时，很难尝试记住哪个系统依赖于其他系统才能工作。我不是在谈论诸如 DLL 和图像之类的软件依赖项，而是在谈论整个系统，例如依赖于 HR 系统的财务系统等。

**我的问题**

跟踪一个整个系统如何依赖另一个系统的最佳方法是哪一种？

[答案可以建议执行上述操作的方法、软件包或文档技术。]

[在我的特定情况下，*许多*意味着十几个服务器上的 20 多个 Web 和桌面应用程序。]

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T15:03:20.510

我想说在您的架构设计文档中明确说明这一点。有一些很好的工具，比如[Enterprise Architect](http://www.sparxsystems.com.au/)。此工具允许您使用 UML 标准创建图表，以便以清晰直观的方式描述这些依赖关系。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T15:05:26.260

最好的信息来源通常在 Config 文件中。这通常具有连接字符串、Web 服务 url 等，它们可以很好地了解外部依赖关系。

另一种技术是通过使用分析或跟踪并应用过滤器，我们可以轻松跟踪任何外部调用。大多数情况下，依赖关系在数据库层，检查链接服务器并跟踪它们的依赖关系可以挖掘大量信息。

我不确定是否有任何自动获取此信息的方法，特别是如果系统位于多个平台上。将涉及大量手动工作来记录所有这些。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T21:51:39.047

[这是我们在Tideway Systems](http://www.tideway.com)生产的那种应用程序，许多大型组织正是为此目的使用它。您可以使用该产品来发现您的资产，并使用建模功能来描述您的业务应用程序（通常由多个软件和跨服务器组成）。

听起来您有资格使用免费的 Foundation 社区版，您可以在多达 30 台服务器上使用它 - 只需[下载](http://www.tideway.com/products/foundation/download/)并查看。那么请让我们知道您的想法！

免责声明：我在[Tideway](http://www.tideway.com)管理开发团队。该产品非常酷 IMO，虽然我自己没有直接写过任何一个:)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T23:27:26.240

一台一台地关掉每台机器，看看有什么坏处.. ;p

不过说真的，这个问题没有简单的答案。使用一组系统，您可以创建一个显示基本依赖关系的图表，但除非您了解依赖关系是什么，否则它不会有很大的意义。通常，您的目标是确定在更改另一个系统时需要“重新验证”什么，而不是确定可以随机关闭哪些机器。但是这种信息需要大量的细节，而且一开始就很难积累。

所有这一切最终都会导致您的系统领先于自动化。您永远找不到能够跟上潮流的收缩包装自动化工具。另一方面，由于需要如此多的细节，任何可以处理一半甚至三分之一工作量的东西都将是有价值的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T15:09:09.543

这是一个很好的问题——我们似乎每次都在为此苦苦挣扎。

在过去一年左右的时间里，我们试图做的是在两件事上“无情”：

1.  自动化——如果你自动化它并经常构建/部署，那么自动化过程往往会在大多数时候让事情变得正确（配置设置等）

2.  wiki、wiki、wiki——我们努力保持团队和项目 wiki 的最新状态。

好奇地看到其他回应。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T15:08:39.123

听起来像是一项尽可能自动化的企业发现工作。根据您的组织规模和环境，有不同的解决方案。对于大环境，无论如何您都需要一个 CMDB（配置管理数据库）。[HP Universal CMDB](https://h10078.www1.hp.com/cda/hpms/display/main/hpms_content.jsp?zn=bto&cp=1-11-15-25%5E1059_4000_100__)等产品可以发现和跟踪大规模环境中的依赖关系。

例如，它可以发现 SAP 系统与其相关数据库以及运行分布式系统的主机之间的关系，并向您显示依赖关系。更重要的是，它可以在对实际环境进行一些未经授权的更改时向您发出警告。

所以答案取决于你认为什么是“很多”。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-03-27T23:21:14.567

涉及两类问题：

a.) 对于那些想知道如何确定每个组件的依赖关系的人

b.) 对于那些想要在组件系统中跟踪相互依赖关系及其优先级的人。（例如，哪个组件首先安装到测试环境中等等......）

如果您拥有的是一系列组件，您知道每个组件的依赖关系，并且您想要整个组件列表的依赖顺序，您可能会发现一个名为 Algorithm::Dependency::Ordered 的 Perl 模块具有一定的价值. 还有其他相关模块可以处理组件的数据库记录等，甚至是简单的文件记录。但是一个警告：我在让它工作时遇到了问题。

或者，绘图工具可能是有价值的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-06-03T14:58:04.317

这是“配置管理”组的功能。要开始，您必须与公司的“专家”交谈并创建应用程序地图/图表。使用 graphviz/dot 生成图表，它不会很漂亮，但它会给你一个依赖关系的可视化表示。

这是一个例子：

```
digraph g {
 rankdir=LR;
 app1->app2->db1;
 app1->app3;
} 
```

希望这可以帮助，

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-11-19T20:51:48.263

系统依赖映射是一回事。真正的环境设置、uid、密码、模拟设置、数据库名称和其他从开发到 qa 到 uat 到生产的数据是真正的挑战。

谁存储/记住它们？

开发人员不知道他的应用程序将驻留在哪个生产服务器上。他只记录了他的开发数据库的名称、uid、pwd，并描述了他的数据库表、conn 字符串等。

一旦它被检入代码存储库并迁移到 QA 环境，谁是使用正确值更新这些配置文件所需的数据的保管人？

再次迁移到 QA 和 UAT 时，谁？

谁有责任通知下一个迁移组需要更改的内容？

在我公司，这是最让我们头疼的问题。当它被内部变更控制流程批准并创建迁移请求以将应用程序迁移到生产环境时，只需忘记一个配置设置就可以破坏整个实现，并且它一直在发生，因为没有明确的责任线（在我看来）。

我认为超越责任是这些信息的中央存储库。

IE。存储所有项目/应用程序的所有配置设置的系统，并且根据您的“角色”，您可以/看不到实际值。

开发人员完成他的构建，并在“系统”中创建迁移请求。QA 人员收到构建### 已准备就绪的通知。QA 人员登录“系统”并检索迁移指令。现在他们清楚地知道需要做什么，并且开始执行代码检查和迁移过程。

重复 UAT 并最终刺激。

当有人建立这个迁移系统时，请告诉我，因为这会帮助很多人。

也许我会自己建造……谁想和我签约？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-11-22T23:22:50.947

我是新来的工作，有人建议我去识别系统依赖项作为第一个任务。事实证明，我老板的意思是去和人交谈——这样我就能知道谁是谁。我以为我的老板想让我写一个计算机程序来做到这一点。所以我做到了。我的假设是，如果一个程序是另一个程序（服务或服务器）的客户端，`netstat -pant`那么`netstat -panu`grep for ESTABLISHED 会给你这个。您可以通过对 LISTENING 的输出进行 grepping 来识别服务。

这只是部分解决方案。是的，它告诉您哪些应用程序与哪些应用程序通信，但还有其他依赖项。因此，例如，一些应用程序使用 DNS 来查找它们的服务器，而其他应用程序则是硬编码或在配置文件中。任何使用 TCP 或 UDP 的东西都依赖于 IP。在大多数地方，IP 依赖​​于 ARP 以及以太网或 WiFi。任何依赖于另一个 LAN 上的服务的东西都依赖于至少一个路由器。

如果你有一个负载均衡器或某种集群，那么问题就会变得更有趣。如果我的服务来自负载平衡器，并且防火墙后面的任一“真实”服务器出现故障，则该服务已降级但仍处于运行状态。

它变得更加有趣，因为服务（程序）依赖于服务器（硬件）。反过来，服务器依赖于电力和空调。

因此，当我的想法失控时，事情变得更加复杂，我考虑创建一种领域特定语言 (DSL) 来捕获所有这些依赖关系。我认为，例如，server_1、server_3 和 server_5 处于电源阶段 1；server_2、server_4 和 server_6 在电源阶段 2。Server_1、Server_3 和 server_5 几乎同时发生故障：可能阶段 1 发生故障。我还没有完全弄清楚。显然，情况可以用有向图来表示，只是我还没有弄清楚细节。

# c# - 如何检查 System.Net.WebClient.DownloadData 是否正在下载二进制文件？

> ID：153451
> 
> 赞同：23
> 
> 时间：2008-09-30T15:02:06.737
> 
> 标签：c#, file, download, webclient

我正在尝试使用`WebClient`WinForms 应用程序从 Web 下载文件。但是，我真的只想下载 HTML 文件。我想忽略的任何其他类型。

我检查了`WebResponse.ContentType`，但它的值始终是`null`。

任何人都知道可能是什么原因？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-10-01T08:49:06.873

鉴于您的更新，您可以通过更改 GetWebRequest 中的 .Method 来做到这一点：

```
using System;
using System.Net;
static class Program
{
    static void Main()
    {
        using (MyClient client = new MyClient())
        {
            client.HeadOnly = true;
            string uri = "http://www.google.com";
            byte[] body = client.DownloadData(uri); // note should be 0-length
            string type = client.ResponseHeaders["content-type"];
            client.HeadOnly = false;
            // check 'tis not binary... we'll use text/, but could
            // check for text/html
            if (type.StartsWith(@"text/"))
            {
                string text = client.DownloadString(uri);
                Console.WriteLine(text);
            }
        }
    }

}

class MyClient : WebClient
{
    public bool HeadOnly { get; set; }
    protected override WebRequest GetWebRequest(Uri address)
    {
        WebRequest req = base.GetWebRequest(address);
        if (HeadOnly && req.Method == "GET")
        {
            req.Method = "HEAD";
        }
        return req;
    }
} 
```

或者，您可以在覆盖 GetWebRespons() 时检查标头，如果不是您想要的，可能会抛出异常：

```
protected override WebResponse GetWebResponse(WebRequest request)
{
    WebResponse resp = base.GetWebResponse(request);
    string type = resp.Headers["content-type"];
    // do something with type
    return resp;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-12-04T18:49:36.653

我不确定原因，但也许你还没有下载任何东西。这是获取远程文件/页面的内容类型的懒惰方式（我还没有检查这在网络上是否有效。据我所知，它可能会下载大量内容）

```
 Stream connection = new MemoryStream(""); // Just a placeholder
        WebClient wc = new WebClient();
        string contentType;
        try
        {
            connection = wc.OpenRead(current.Url);
            contentType = wc.ResponseHeaders["content-type"];
        }
        catch (Exception)
        {
            // 404 or what have you
        }
        finally
        {
            connection.Close();
        } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T15:09:47.873

WebResponse 是一个抽象类，ContentType 属性是在继承类中定义的。例如，在 HttpWebRequest 对象中，此方法被重载以提供内容类型标头。我不确定 WebClient 使用的是哪个 WebResponse 实例。如果您只想要 HTML 文件，最好直接使用 HttpWebRequest 对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-07-20T16:47:35.507

这是一种使用 TCP 的方法，http 是建立在它之上的。它会在连接时或超时（毫秒）后返回，因此可能需要根据您的情况更改该值

```
var result = false;
try {
    using (var socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp)) {
        var asyncResult = socket.BeginConnect(yourUri.AbsoluteUri, 80, null, null);
        result = asyncResult.AsyncWaitHandle.WaitOne(100, true);
        socket.Close();
    }
}
catch { }
return result; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T15:03:50.587

您可以使用 HEAD 动词发出第一个请求，并检查内容类型响应标头？[编辑] 不过，看起来您必须为此使用 HttpWebRequest。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T15:55:59.057

您的问题有点令人困惑：如果您使用的是 Net.WebClient 类的实例，则 Net.WebResponse 不会进入等式（除了它确实是一个抽象类，而且您将使用一个具体的实现，例如 HttpWebResponse，正如另一个响应中指出的那样）。

无论如何，在使用 WebClient 时，您可以通过执行以下操作来实现您想要的：

```
Dim wc As New Net.WebClient()
Dim LocalFile As String = IO.Path.Combine(Environment.GetEnvironmentVariable("TEMP"), Guid.NewGuid.ToString)
wc.DownloadFile("http://example.com/somefile", LocalFile)
If Not wc.ResponseHeaders("Content-Type") Is Nothing AndAlso wc.ResponseHeaders("Content-Type") <> "text/html" Then
    IO.File.Delete(LocalFile)
Else
    '//Process the file
End If 
```

请注意，您必须检查 Content-Type 标头是否存在，因为服务器不能保证返回它（尽管大多数现代 HTTP 服务器将始终包含它）。如果没有 Content-Type 标头，您可以回退到另一种 HTML 检测方法，例如打开文件，将前 1K 字符左右读入字符串，并查看其中是否包含子字符串 <html>

另请注意，这有点浪费，因为在决定是否需要之前，您总是会传输完整的文件。要解决这个问题，切换到 Net.HttpWebRequest/Response 类可能会有所帮助，但额外的代码是否值得取决于您的应用程序......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T03:18:10.820

我很抱歉不是很清楚。我编写了一个扩展 WebClient 的包装类。在这个包装类中，我添加了 cookie 容器并公开了 WebRequest 的超时属性。

我正在使用此包装类中的 DownloadDataAsync()，但无法从此包装类的 WebResponse 中检索内容类型。我的主要目的是拦截响应并确定其是否属于 text/html 性质。如果不是，我将中止此请求。

在覆盖 WebClient.GetWebResponse(WebRequest, IAsyncResult) 方法后，我设法获得了内容类型。

以下是我的包装类的示例：

```
public class MyWebClient : WebClient
{
    private CookieContainer _cookieContainer;
    private string _userAgent;
    private int _timeout;
    private WebReponse _response;

    public MyWebClient()
    {
        this._cookieContainer = new CookieContainer();
        this.SetTimeout(60 * 1000);
    }

    public MyWebClient SetTimeout(int timeout)
    {
        this.Timeout = timeout;
        return this;
    }

    public WebResponse Response
    {
        get { return this._response; }
    }

    protected override WebRequest GetWebRequest(Uri address)
    {
        WebRequest request = base.GetWebRequest(address);

        if (request.GetType() == typeof(HttpWebRequest))
        {
            ((HttpWebRequest)request).CookieContainer = this._cookieContainer;
            ((HttpWebRequest)request).UserAgent = this._userAgent;
            ((HttpWebRequest)request).Timeout = this._timeout;
        }

        this._request = request;
        return request;
    }

    protected override WebResponse GetWebResponse(WebRequest request)
    {
        this._response = base.GetWebResponse(request);
        return this._response;
    }

    protected override WebResponse GetWebResponse(WebRequest request, IAsyncResult result)
    {
        this._response = base.GetWebResponse(request, result);
        return this._response;
    }

    public MyWebClient ServerCertValidation(bool validate)
    {
        if (!validate) ServicePointManager.ServerCertificateValidationCallback += delegate(object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors) { return true; };
        return this;
    }
} 
```

# .net - 添加到.NET任务栏中的右键单击应用程序菜单

> ID：153460
> 
> 赞同：7
> 
> 时间：2008-09-30T15:04:27.837
> 
> 标签：.net, windows, taskbar

大多数应用程序只有“恢复、移动、大小、最小化、最大化和关闭”，但是*MS SQL*提供了额外的选项“帮助、自定义视图”。按照这些思路，是否可以在任务栏中添加到应用程序的右键菜单？

注意：我指的**不是时钟旁边通知区域中的图标。**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T15:31:01.863

这是我找到的一个更简单的[答案。](http://bytes.com/forum/thread529258.html)我很快测试了它并且它有效。

我的代码：

```
 private const int WMTaskbarRClick = 0x0313;

    protected override void WndProc(ref Message m)
    {
        switch (m.Msg)
        {
            case WMTaskbarRClick:
                {
                    // Show your own context menu here, i do it like this
                    // there's a context menu present on my main form so i use it

                    MessageBox.Show("I see that.");

                    break;
                }
            default:
                {
                    base.WndProc(ref m);
                    break;
                }
        }
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-09-30T01:00:31.477

右键单击最小化程序或 Alt+Space 或右键单击标题栏中的窗口图标的菜单称为 SysMenu。

这是 WPF 的一个选项：

```
// License MIT 2019 Mitch Gaffigan
// https://stackoverflow.com/a/58160366/138200
public class SysMenu
{
    private readonly Window Window;
    private readonly List<MenuItem> Items;
    private bool isInitialized;
    private IntPtr NextID = (IntPtr)1000;
    private int StartPosition = 5;

    public SysMenu(Window window)
    {
        this.Items = new List<MenuItem>();
        this.Window = window ?? throw new ArgumentNullException(nameof(window));
        this.Window.SourceInitialized += this.Window_SourceInitialized;
    }

    class MenuItem
    {
        public IntPtr ID;
        public string Text;
        public Action OnClick;
    }

    public void AddSysMenuItem(string text, Action onClick)
    {
        if (string.IsNullOrWhiteSpace(text))
        {
            throw new ArgumentNullException(nameof(text));
        }
        if (onClick == null)
        {
            throw new ArgumentNullException(nameof(onClick));
        }

        var thisId = NextID;
        NextID += 1;

        var newItem = new MenuItem()
        {
            ID = thisId,
            Text = text,
            OnClick = onClick
        };
        Items.Add(newItem);
        var thisPosition = StartPosition + Items.Count;

        if (isInitialized)
        {
            var hwndSource = PresentationSource.FromVisual(Window) as HwndSource;
            if (hwndSource == null)
            {
                return;
            }
            var hSysMenu = GetSystemMenu(hwndSource.Handle, false);
            InsertMenu(hSysMenu, thisPosition, MF_BYPOSITION, thisId, text);
        }
    }

    private void Window_SourceInitialized(object sender, EventArgs e)
    {
        var hwndSource = PresentationSource.FromVisual(Window) as HwndSource;
        if (hwndSource == null)
        {
            return;
        }

        hwndSource.AddHook(WndProc);

        var hSysMenu = GetSystemMenu(hwndSource.Handle, false);

        /// Create our new System Menu items just before the Close menu item
        InsertMenu(hSysMenu, StartPosition, MF_BYPOSITION | MF_SEPARATOR, IntPtr.Zero, string.Empty);
        int pos = StartPosition + 1;
        foreach (var item in Items)
        {
            InsertMenu(hSysMenu, pos, MF_BYPOSITION, item.ID, item.Text);
            pos += 1;
        }

        isInitialized = true;
    }

    private IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
    {
        if (msg == WM_SYSCOMMAND)
        {
            var item = Items.FirstOrDefault(d => d.ID == wParam);
            if (item != null)
            {
                item.OnClick();
                handled = true;
                return IntPtr.Zero;
            }
        }

        return IntPtr.Zero;
    }

    #region Win32

    private const Int32 WM_SYSCOMMAND = 0x112;
    private const Int32 MF_SEPARATOR = 0x800;
    private const Int32 MF_BYPOSITION = 0x400;
    private const Int32 MF_STRING = 0x0;

    [DllImport("user32.dll")]
    private static extern IntPtr GetSystemMenu(IntPtr hWnd, bool bRevert);

    [DllImport("user32.dll")]
    private static extern bool InsertMenu(IntPtr hMenu, int wPosition, int wFlags, IntPtr wIDNewItem, string lpNewItem);

    #endregion
} 
```

使用示例：

```
internal partial class MainWindow : Window
{
    public MainWindow()
    {
        var sysMenu = new SysMenu(this);
        sysMenu.AddSysMenuItem("Quit", miQuit_Click);
        sysMenu.AddSysMenuItem("Show debug tools", miShowDebug_Click);
    }

    private void miQuit_Click()
    {
        // "On-Click" logic here
    }

    private void miShowDebug_Click()
    {
        // "On-Click" logic here
    }
} 
```

# ruby-on-rails - 如何在 Rails 2.1 中的会话 cookie 上设置 HttpOnly？

> ID：153461
> 
> 赞同：1
> 
> 时间：2008-09-30T15:04:55.933
> 
> 标签：ruby-on-rails, security, cookies, httponly

我注意到 Rails 2.2（当前为 edge）支持[在 session cookie 上设置 HttpOnly](http://rails.lighthouseapp.com/projects/8994/tickets/1046-http-only-cookies-in-cookiestore)。

有没有办法在 Rails 2.1 应用程序上设置它而不移动到 edge/2.2？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T20:07:13.790

好吧，正如您所指出的，它不受支持，但是您当然可以[猴子补丁](http://en.wikipedia.org/wiki/Monkey_patch)Rails 来做您想做的事情。实际上，在这种情况下，直接修补 Rails 与猴子修补之间的区别非常小，因为当您升级到 2.2 时，两者都会被删除/恢复。

在这两种情况下，您都会将应用的差异视为自己修补 2.1 的指南 - 通过直接应用补丁（以任何 2.1/edge 差异为模），或者通过在环境加载后从您自己的代码中重新打开这些类以应用变化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T14:20:46.890

我已经[编写了一个猴子补丁](http://gist.github.com/14086)来将这种支持添加到 Rails 2.1，来自 Rails 2.2 的补丁。

我没有在 Rails 2.1 以外的任何东西上测试过，你的里程可能会有所不同！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T15:14:47.533

`http_only`在 cookie 的选项哈希中将选项设置为 true：

```
cookies['visits'] = { :value => '20', :http_only => true } 
```

# flash - 开发 Flash 应用程序的最佳开源工具是什么？什么是开始学习的最佳场所？

> ID：153468
> 
> 赞同：10
> 
> 时间：2008-09-30T15:06:16.570
> 
> 标签：flash, open-source

就工具而言，我知道[Haxe](http://haxe.org/)、[MTASC](http://www.mtasc.org/)和[swfmill](http://swfmill.org/)。你能提供任何与其中任何一个相关的成功或恐怖故事吗？还有其他我应该调查的吗？

关于学习，[Adobe Developer Connection](http://www.adobe.com/devnet/)似乎包含了不错的参考资料，但教程都假设读者使用的是“Adobe Flash”产品。是否有针对开源用户的教程？

Flash 9/ActionScript 3 与 Flash 8/ActionScript 2 相比有哪些优势？我认为 Flash 8 仍然比 Flash 9 更广泛地部署，并且得到开源 Flash 播放器更好的支持，我是否正确？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T15:12:11.063

就工具而言，[FlashDevelop](http://osflash.org/flashdevelop)非常好（而且免费）。事实上，整个[osflash.org](http://osflash.org)网站非常令人印象深刻和彻底。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T15:11:46.527

Flash Develop 是一个很棒的 IDE：[http ://www.flashdevelop.org/wikidocs/index.php?title=Main_Page](http://www.flashdevelop.org/wikidocs/index.php?title=Main_Page)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T15:49:32.473

另一个旧工具：[Ming](http://www.libming.org/moin.cgi/FrontPage?action=show "明")。看起来它还活着。

Flash 7/8/9 的部署：请参阅 Adob​​e 统计数据：[Adobe Flash Player 版本渗透](http://www.adobe.com/products/player_census/flashplayer/version_penetration.html "Adobe Flash Player 版本渗透")。不过，我不太清楚这些数字意味着什么，我想它们意味着以 Flash 7 为目标的 Flash 小程序具有 99% 的渗透率（即从 7 到 9 产生读者），而以 Flash 9 为目标的那些具有 97.7% 的渗透率，仍然是一个很高的数字。

如果我尝试开始为 Flash 编码，我想我会直接使用 AS 3（更好的 OO 支持，更好的性能）。

PS.：我看到你提到了开源播放器。我不知道他们的渗透率，但我担心它非常低。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T16:45:25.240

> “我认为 Flash 8 仍然比 Flash 9 更广泛地部署，并且得到开源 Flash 播放器更好的支持，这是否正确？”

担心开源**播放**器没有多大意义，因为很少有人使用它们。据我所知，没有任何开源播放器支持 Flash 8——我认为它们都是 6/7 版。有适用于 Windows/Mac/Linux 的官方 Flash 9 播放器和各种其他设备支持旧版本或 FlashLite。例如 Wii 和 PS3 支持 Flash player 7。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T17:23:19.377

如果您打算针对移动设备（或 Wii），您可能会想要坚持使用 Flash 7。

Adobe 仍然没有可用于这些（嵌入式/移动）平台的 Flash 9 SDK。最新的 SDK 是支持 Flash 8的[FlashLite 3 。](http://www.adobe.com/products/flashlite/)

不过，在 07 年 10 月之前或前后构建的任何东西很可能仍会使用[Flash 7 SDK](http://www.adobe.com/products/flashplayer_sdk/)。

当然，如果你只是为 Mac/Win/Linux 开发，那么这些都不重要。

我一直认为，如果您不需要任何新功能或错误修复，通常最好坚持使用稍旧但更兼容的版本。这几乎适用于任何开发。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T21:15:10.600

从开发的角度来看 - 我会避免像瘟疫一样的 actionscript 2（除非它当然是您要求的一部分……也就是说，您的客户需要瘟疫）。

它很旧，没有被积极开发（即 Adob​​e 没有在 AS2 代码库上投入更多精力），而且你学到的大多数东西（比如为什么你必须使用 .createMovieClip() 来实例化一个对象）不会延续到您的 AS3 开发中。

# c# - 与数据库保持同步

> ID：153473
> 
> 赞同：2
> 
> 时间：2008-09-30T15:07:57.800
> 
> 标签：c#, sql-server, .net-3.5

我们开发的解决方案使用数据库（sqlserver 2005）来实现持久性，因此，所有更新的数据都保存到数据库中，而不是发送到程序中。

我有一个前端（桌面），目前它一直在轮询数据库以获取可能随时对某些关键数据发生的更新，而且我并不是真正喜欢数据库轮询和浪费 CPU 周期的工作，而这些工作正在无用地重做。

我们的经理似乎不介意我们轮询数据库。数据量小（少于100条记录），间隔高（1分钟），但我是编码员。我愿意。是否有更好的方法来完成使内存中的数据与数据库中的数据尽可能同步的任务？该系统使用 C# 3.5 开发。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T15:10:45.950

我首先想到的是一个与消息队列相结合的触发器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T15:22:39.480

由于您使用的是 SQL2005，因此您可以使用[SqlDependency](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldependency.aspx)来获得更改通知。请注意，您可以毫不费力地将它与[System.Web.Caching.Cache](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.aspx)一起使用，尽管它的命名空间[在 WinForms app 中运行得很好](http://weblogs.asp.net/rosherove/archive/2003/08/12/23813.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T15:10:14.843

对于您的情况，这可能有点矫枉过正，但看看[Microsoft Sync Framework可能会很有趣](http://msdn.microsoft.com/en-us/sync/default.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T15:18:40.923

SQL Notification Services 将允许您根据多种协议将数据库回调到应用程序。一种实现方法是让通知服务在可访问的网络共享上创建（或修改）文件，并让您的桌面应用程序使用 FileSystemWatcher 做出反应。

有关通知服务的更多信息，请访问：[http ://technet.microsoft.com/en-us/library/aa226909(SQL.80).aspx](http://technet.microsoft.com/en-us/library/aa226909(SQL.80).aspx)

请注意，这可能是解决螺母类型问题的大锤方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T15:18:14.920

在 ASP.NET 中， http: [//msdn.microsoft.com/en-us/library/ms178604](http://msdn.microsoft.com/en-us/library/ms178604(VS.80).aspx) (VS.80).aspx 。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T15:25:31.720

这也可能是矫枉过正，但也许你可以实现某种缓存机制。也就是说，当数据写入数据库时​​，你可以同时缓存它，当你试图从数据库中取回数据时，首先检查缓存。

# java - 是否有类似于 Java/.Net 分析器的 SQL Server 分析器？

> ID：153478
> 
> 赞同：4
> 
> 时间：2008-09-30T15:10:09.713
> 
> 标签：java, sql-server, stored-procedures, profiling

我喜欢分析 Java/.Net 应用程序以发现性能瓶颈或内存问题的方式。例如，通过查看[调用树以及每个方法的执行时间和调用计数，](http://www.yourkit.com/dotnet/features/cpu-tree-threads-together.gif)很容易找到性能瓶颈。在 SQL Server 中，我有存储过程调用其他依赖于视图的存储过程，这类似于 Java/.Net 方法调用其他方法。所以看起来同一种探查器在这里会很有帮助。然而，我四处张望，一个也找不到。是否有人知道此类工具，无论是用于 SQL Server 还是任何其他 DBMS？

更新：感谢您对 SQL Server Profiler 的回复，但此工具非常有限。看看[截图](http://www.yourkit.com/dotnet/features/cpu-tree-threads-together.gif)。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T15:42:40.960

查看[SQL Nexus 工具](http://www.codeplex.com/sqlnexus/Wiki/View.aspx?title=SqlNexusReports&referringTitle=Home)。这有一些关于识别瓶颈的好报告。SQL Nexus 是一种工具，可帮助您确定 SQL Server 性能问题的根本原因。它加载和分析 SQLDiag 和 PSSDiag 收集的性能数据。它可以显着减少您手动分析数据所花费的时间。

在 Inside SQL 2005 的一本书（可能是 T-SQL 查询）中，有一种很酷的技术，作者将 SQL 分析器输出转储到表或 excel 文件中，并应用枢轴来获取与您的格式相似的输出截屏。

我还没有看到任何内置的 SQL 工具可以为您提供这种分析。另一个有用[的帖子](http://blogs.msdn.com/khen1234/archive/2007/12/12/a-sql-profiler-trace-swiss-army-knife.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T15:14:56.470

除了@Galwegian 的评论中提到的 SQL Server Profiler 之外，还可以在运行查询时检查您的执行计划。

[http://www.sql-server-performance.com/tips/query_execution_plan_analysis_p1.aspx](http://www.sql-server-performance.com/tips/query_execution_plan_analysis_p1.aspx)
[http://en.wikipedia.org/wiki/Query_plan](http://en.wikipedia.org/wiki/Query_plan)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T15:15:23.380

关于 SQL Server 探查器的另一个完整线程：

[识别 SQL Server 性能问题](https://stackoverflow.com/questions/14717/identifying-mssql-performance-problems)

我理解您在说什么，但通常情况下，数据库优化是在更细粒度的级别上进行的。如果数据库活动是由客户端驱动的，您应该能够使用现有的客户端分析器来获取每个步骤的总时间，然后解决容易实现的目标（无论是否在数据库中）。

当您需要详细分析特定数据库步骤时，可以使用分析器和跟踪。

通常，数据库访问具有一定的粒度，该粒度是在单个基础上解决的，并且数据库活动与所有类型的用户访问都不是线性的，而程序分析器通常是对代码的线性路径进行分析。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T15:16:58.540

如前所述，SQL Server Profiler 非常适合检查您的程序传递给 SQL 等的参数。如果您需要，它不会显示执行树。为此，我能想到的就是使用 Show Plan 来查看运行时到底执行了什么。例如，如果您正在调用调用视图的 sp，Profiler 只会显示 sp 已执行以及传入的参数。此外，Windows 性能监视器具有特定于 SQL Server 的大量运行时性能指标。您可以在服务器上运行它，或远程连接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T15:21:54.410

要查找性能瓶颈，您可以使用数据库引擎优化顾问（在 SQL Server Management Studio 的工具菜单中找到。它提供优化查询的建议并自动为您优化它们（例如创建适当的索引等）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T15:14:11.060

您可以使用 S [ql Profiler](http://msdn.microsoft.com/en-us/library/ms181091.aspx) - 它涵盖了分析方面，但我倾向于将其更多地视为一种日志记录工具。为了诊断性能，您可能应该只查看[查询计划](http://www.sql-server-performance.com/tips/query_execution_plan_analysis_p1.aspx)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T15:16:46.343

有 sql server profiler，但尽管有它的名字，但从你的问题的声音来看，它并没有做你想做的事。它将向您显示数据库中正在进行的所有调用的详细视图。最好对整个应用程序进行故障排除，而不是一次只处理一个存储过程

听起来您需要在**查询分析器**中查看查询/spoc**的执行计划**，这将为您提供类似于您正在寻找的数据的东西。

 *** * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-16T17:16:01.717

正如几个回复所提到的，SQL Profiler 将显示您的要求。您必须确保打开事件 SP:StmtCompleted，它位于 Stored Procedures 组中，如果您还想要查询计划，请打开 Showplan XML Statistics Profile，它位于 Performance 组中. XML 计划最后一个为您提供图形描述，并显示计划中每个步骤处理的实际行。

如果分析器使您的应用程序变慢，请尽可能对其进行过滤并考虑转到服务​​器端跟踪。

HTH安迪

# java - 为应用程序中的单个 Tapestry 4 页面设置 ISO-8859-1 编码，否则完全是 UTF-8

> ID：153482
> 
> 赞同：4
> 
> 时间：2008-09-30T15:10:48.183
> 
> 标签：java, encoding, utf-8, tapestry, iso-8859-1

我有一个 Tapestry 应用程序将其页面作为 UTF-8 提供服务。也就是说，服务器响应具有标题：

```
Content-type: text/html;charset=UTF-8 
```

现在在这个应用程序中有一个页面应该使用 ISO-8859-1 编码。也就是说，服务器响应应该有这个头：

```
Content-type: text/html;charset=ISO-8859-1 
```

这该怎么做？我不想更改整个应用程序的默认编码。

基于谷歌搜索，我尝试了以下操作：

```
 @Meta({    "org.apache.tapestry.output-encoding=ISO-8859-1", 
    "org.apache.tapestry.response-encoding=ISO-8859-1", 
    "org.apache.tapestry.template-encoding=ISO-8859-1",
    "tapestry.response-encoding=ISO-8859-1"})
 abstract class MyPage extends BasePage {

    @Override
    protected String getOutputEncoding() {
        return "ISO-8859-1";
    }
 } 
```

但是使用 @Meta 注释设置这些值或覆盖 getOutputEncoding 方法都不起作用。

我正在使用 Tapestry 4.0.2。

编辑：我最终使用带有子类 HttpServletResposeWrapper 的 Servlet 过滤器来执行此操作。包装器覆盖 setContentType() 以强制响应所需的编码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T02:59:56.860

你考虑过过滤器吗？也许不像 Tapestry 中的那样优雅，但使用一个普通的过滤器，注册感兴趣的 url 映射。它的 init 参数之一将是您之后的编码。例子：

```
public class EncodingFilter implements Filter {
private String encoding;
private FilterConfig filterConfig;

/**
* @see javax.servlet.Filter#init(javax.servlet.FilterConfig)
*/
public void init(FilterConfig fc) throws ServletException {
this.filterConfig = fc;
this.encoding = filterConfig.getInitParameter("encoding");
}

/**
* @see javax.servlet.Filter#doFilter(javax.servlet.ServletRequest, javax.servlet.ServletResponse, javax.servlet.FilterChain)
*/
public void doFilter(ServletRequest req, ServletResponse resp,
FilterChain chain) throws IOException, ServletException {
req.setCharacterEncoding(encoding);
chain.doFilter(req, resp);
}

/**
* @see javax.servlet.Filter#destroy()
*/
public void destroy() {
}

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-27T21:53:28.703

你可以这样做：

```
 @Override
public ContentType getResponseContentType() {
        return new ContentType("text/html;charset=" + someCharEncoding);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T15:11:27.133

过滤器建议很好。您还可以将 servlet 与 Tapestry 混合使用。例如，我们有用于显示 XML 文档和动态生成的 Excel 文件的 servlet。只需确保在 web.xml 中正确设置映射，这样 servlet 就不会通过 Tapestry。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T13:22:41.240

Tapestry 具有可应用于请求/响应管道的过滤器概念，但其优势在于您可以访问 T5 IoC 容器和服务。

[http://tapestry.apache.org/tapestry5/tapestry-core/guide/request.html](http://tapestry.apache.org/tapestry5/tapestry-core/guide/request.html)

# java - 自动 Python 到 Java 翻译

> ID：153491
> 
> 赞同：33
> 
> 时间：2008-09-30T15:13:05.727
> 
> 标签：java, python, jython, code-translation

有没有可以自动将 Python 转换为 Java 的工具？Jython 可以做到这一点吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-30T22:31:39.370

实际上，这可能会或可能不会有太大帮助，但您可以编写一个脚本，为每个 Python 类创建一个 Java 类，包括方法存根，将方法的 Python 实现放在 Javadoc 中

事实上，这在 Python 中可能很容易解决。

我在一家公司工作，该公司将一个巨大的 Smalltalk（类似于 Python）系统移植到 Java，这正是他们所做的。填写方法是手动的，但非常宝贵，因为它让你真正思考发生了什么。我怀疑蛮力方法会产生好的代码。

这是另一种可能性：您能否更轻松地将您的 Python 转换为 Jython？Jython 只是用于 JVM 的 Python。可以使用 Java 反编译器（例如 JAD）然后将字节码转换回 Java 代码（或者您可能只希望在 JVM 上运行）。但是，我不确定这一点，也许其他人会有更好的主意。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T15:23:47.650

这可能不是一个容易的问题。由于每种类型绑定时间的差异，确定如何将 Python 中定义的类映射到 Java 中的类型将是一个很大的挑战。（鸭子打字与编译时绑定）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-13T02:59:32.917

是的，Jython 会这样做，但它可能是也可能不是您想要的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T15:22:24.940

澄清你的问题：

从 Python 源代码到 Java 源代码？（我不这么认为）

.. 还是从 Python 源代码到 Java 字节码？（Jython 在后台执行此操作）

# forms - .Net CF 防止过度、不耐烦的点击（屏幕重绘时）

> ID：153496
> 
> 赞同：3
> 
> 时间：2008-09-30T15:14:24.320
> 
> 标签：forms, compact-framework, refresh

.Net 紧凑型框架

场景：用户在屏幕上。设备找不到打印机并询问用户是否要重试。如果他们单击“否”，则关闭当前屏幕并返回到父菜单屏幕。如果他们多次单击“否”按钮，第一次单击将被“否”按钮使用，下一次单击将在屏幕完成重绘后生效。（实际上是单击一个菜单项，然后将用户带到另一个屏幕。）

我看不到放置等待光标的好地方……当用户单击“否”时，除了表单关闭外，没有发生太多事情。但是CF框架重绘屏幕很慢。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T10:50:39.027

您可以通过使用 Application.DoEvents() 清除 Windows 消息队列来跳过挂起的点击；

我们使用以下自定义事件类来解决您的问题（防止多次单击并在必要时显示等待光标）：

```
using System;
using System.Windows.Forms;

public sealed class Event {

    bool forwarding;

    public event EventHandler Action;

    void Forward (object o, EventArgs a) {
        if ((Action != null) && (!forwarding)) {
            forwarding = true;
            Cursor cursor = Cursor.Current;
            try {
                Cursor.Current = Cursors.WaitCursor;
                Action(o, a);
            } finally {
                Cursor.Current = cursor;
                Application.DoEvents();
                forwarding = false;
            }
        }
    }

    public EventHandler Handler {
        get {
            return new EventHandler(Forward);
        }
    }

} 
```

您可以验证它是否适用于以下示例（仅当 HandleClick 已终止时，控制台才会输出单击）：

```
using System;
using System.Threading;
using System.Windows.Forms;

class Program {

    static void HandleClick (object o, EventArgs a) {
        Console.WriteLine("Click");
        Thread.Sleep(1000);
    }

    static void Main () {
        Form f = new Form();
        Button b = new Button();
        //b.Click += new EventHandler(HandleClick);
        Event e = new Event();
        e.Action += new EventHandler(HandleClick);
        b.Click += e.Handler;
        f.Controls.Add(b);
        Application.Run(f);
    }

} 
```

要重现您的问题，请按如下方式更改上述代码（控制台输出所有点击，有延迟）：

```
 b.Click += new EventHandler(HandleClick);
        //Event e = new Event();
        //e.Action += new EventHandler(HandleClick);
        //b.Click += e.Handler; 
```

Event 类可用于公开 EventHandler 事件（Button、MenuItem、ListView、...）的每个控件。

问候，坦伯格

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T15:46:50.513

随意的想法：

*   在模式对话框启动时禁用父对话框上的某些控件。我不相信您可以禁用整个表单，因为它是模态对话框的父级。
*   或者，我建议使用透明控件来捕捉点击，但 CF 不支持透明度。
*   父对话框上有多少个控件？我还没有发现 CF.Net 更新速度慢。对话框是否有可能超载并且可以比使用子控件更快地自定义绘制？
*   覆盖 DialogResult 属性和类的 Dispose 方法以处理添加/删除等待光标。

# math - 计算一定时间后加速体的位置

> ID：153507
> 
> 赞同：21
> 
> 时间：2008-09-30T15:16:57.513
> 
> 标签：math, physics, equation

如何在一定时间（例如 1 秒）后计算加速体（例如汽车）的位置？

对于一个不加速的运动体，它是线性关系，所以我假设对于一个加速体，它在某处包含一个正方形。

有任何想法吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-30T15:18:54.933

等式是：s = ut + (1/2)at^2

其中 s 是位置，u 是 t=0 时的速度，t 是时间，a 是恒定加速度。

例如，如果一辆车从静止开始，以 3m/s^2 的加速度加速两秒钟，它移动 (1/2) * 3 * 2^2 = 6m

这个方程来自对方程的分析积分，这些方程表明速度是位置的变化率，加速度是速度的变化率。

通常在游戏编程情况下，人们会使用稍微不同的公式：在每一帧，速度和位置的变量不是解析地积分，而是数值积分：

```
s = s + u * dt;
u = u + a * dt; 
```

其中 dt 是帧的长度（使用计时器测量：1/60 秒左右）。这种方法的优点是加速度可以随时间变化。

**编辑**有几个人注意到，数值积分的欧拉方法（如图所示）虽然是最简单的演示方法，但精度却相当差。请参阅[Velocity Verlet](http://en.wikipedia.org/wiki/Verlet_integration)（经常在游戏中使用）和[4 阶 Runge Kutta](http://en.wikipedia.org/wiki/Runge_kutta)（科学应用的“标准”方法）以了解改进的算法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T15:27:39.843

嗯，这取决于加速度是否恒定。如果是的话，那就简单了

```
s = ut+1/2 at^2 
```

如果 a 不是常数，则需要进行数值积分。现在有很多种方法，但没有一种方法能比手工更准确，因为它们最终都是近似解。

最简单和最不准确的是[欧拉方法](http://en.wikipedia.org/wiki/Eulers_method)。在这里，您将时间划分为称为时间步长的离散块，并执行

```
v[n] = v[n-1] * t * a[t] 
```

`n`是索引，`t`是时间步长的大小。位置也同样更新。这仅适用于准确性并不那么重要的情况。Euler 方法的一个特殊版本将为弹丸运动产生一个精确的解决方案（参见 wiki），因此虽然这种方法很粗糙，但它对于某些情况来说可能是完美的。

游戏和某些化学模拟中最常用的数值积分方法是[Velocity Verlet](http://en.wikipedia.org/wiki/Velocity_Verlet#Velocity_Verlet)，它是更通用的 Verlet 方法的一种特殊形式。如果欧拉太粗糙，我会推荐这个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T15:21:16.613

你可以谷歌一下。我发现了这个：[http ://www.ugrad.math.ubc.ca/coursedoc/math101/notes/applications/velocity.html](http://www.ugrad.math.ubc.ca/coursedoc/math101/notes/applications/velocity.html)

但如果你不想阅读，那就是：

> p(t) = x(0) + v(0)*t + (1/2) *a* t^2

在哪里

*   p(t) = 时间 t 的位置
*   x(0) = 零时刻的位置
*   v(0) = 零时间的速度（如果你没有速度，你可以忽略这个术语）
*   a = 加速度
*   t = 您当前的项目

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T15:22:36.203

假设您正在处理恒定加速度，则公式为：

距离 = (initial_velocity * time) + (acceleration * time * time) / 2

在哪里

*distance*是经过的距离

*initial_velocity*是初始速度（如果身体最初处于静止状态，则为零，因此在这种情况下您可以删除该术语）

*时间*就是时间

*加速度*是（恒定的）加速度

计算时请确保使用正确的单位，例如米、秒等。

关于该主题的一本非常好的书是[面向游戏开发者的物理](http://oreilly.com/catalog/9780596000066/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T15:29:13.037

假设恒定加速度和初速度 v0，

```
x(t) = (1/2 * a * t^2) + (v0 * t) 
```

# logging - 代码与日志记录的比率？

> ID：153524
> 
> 赞同：49
> 
> 时间：2008-09-30T15:20:57.690
> 
> 标签：logging, coding-style

理想的代码与日志记录比率是多少？我不习惯写日志，因为我开发的大多数应用程序都没有太多的日志记录。

最近虽然我换了工作，但我注意到您看不到调用 log4net 的应用程序代码。我很欣赏这很有用，但肯定有太多的调试语句和没有任何调试语句一样糟糕？

有一些日志语句会告诉您每个方法何时开始和结束以及它们返回的内容。当几乎所有事情都完成时。

使用反射在编译时添加日志语句的插件会不会更容易，这样它们就不会在您尝试查看代码时妨碍您？

同样在这些强大的 IDE 和远程调试的日子里，这么多的日志记录真的需要吗？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-09-30T15:26:48.160

由于 log4net 在不堵塞资源方面做得很好，所以我倾向于在日志记录方面有点冗长，因为当您必须更改为调试模式时，您拥有的信息越多越好。这是我通常记录的内容：

**调试级别**

*   传入方法的任何参数
*   我检索的结果集中的任何行数
*   传递给方法时可能包含可疑数据的任何数据行
*   任何“生成的”文件路径、连接字符串或其他值在被环境“拼凑”时可能会被混淆。

**信息级别**

*   方法的开始和结束
*   任何主要循环的开始和结束
*   任何主要 case/switch 语句的开始

**错误级别**

*   处理的异常
*   无效的登录尝试（如果存在安全问题）
*   我为报告而截获的不良数据

**致命级别**

*   未处理的异常。

还有很多日志记录详细信息使我无法询问用户在收到错误消息时他们在做什么。我可以很容易地把它拼凑起来。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-30T15:28:54.923

完整的日志文件非常有用。考虑一种情况，您的应用程序部署在银行之类的地方。你不能进去手动调试它，他们肯定不会向你发送他们的数据。您可以获得的是一个完整的日志，它可以指出问题发生的位置。拥有多个日志级别非常有帮助。通常，应用程序会以仅报告致命错误或严重错误的模式运行。当您需要对其进行调试时，用户可以打开调试或跟踪输出并获得更多信息。

您看到的那种日志记录似乎确实过多，但如果不了解有关应用程序及其可能部署的位置的更多信息，我真的不能肯定地说这是肯定的。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-30T15:47:38.703

> 同样在这些强大的 IDE 和远程调试的日子里，这么多的日志记录真的需要吗？

是的，当然，尽管许多不熟练的开发人员犯的错误是尝试使用错误的方法修复错误，通常倾向于在应该调试时进行日志记录。每个都有一个地方，但至少有几个领域几乎总是需要记录：

*   用于检查实时代码中的问题，其中调试器暂停会影响计算结果（当然，在这样的实时过程中，日志记录会对时间产生轻微影响，但在很大程度上取决于软件）
*   对于发送给 beta 测试人员或其他可能无法访问调试器的同事的构建
*   用于将数据转储到在调试器中可能不容易查看的磁盘。例如，某些 IDE 无法正确解析 STL 结构。
*   获得程序正常流程的“感觉”
*   除了注释之外，为了使代码*更具可读性，如下所示：*

```
// 现在打开数据文件
fp = fopen("data.bin", "rb");

```

上面的注释可以很容易地放在日志调用中：

```
const char *kDataFile = "data.bin";
log("现在打开数据文件 %s", kDataFile);
fp = fopen(kDataFile, "rb");

```

也就是说，您在某些方面是正确的。将日志记录机制用作美化的堆栈跟踪记录器将生成质量非常差的日志文件，因为它没有为开发人员提供足够有用的故障点来检查。所以这里的关键显然是正确和谨慎地使用日志调用，我认为这归结为开发人员的自由裁量权。您需要考虑到您实际上是在为**自己**制作日志文件；您的用户并不关心它们，并且通常无论如何都会严重误解他们的内容，但您至少可以使用它们来确定您的程序行为不端的原因。

此外，日志文件很少会指出某个错误的直接来源。根据我的经验，它通常会提供一些关于如何复制错误的见解，然后通过复制或调试它的过程来找到问题的原因。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-30T15:24:43.547

正如您所说，实际上有一个不错的库可以在事后添加日志记录[PostSharp](https://www.postsharp.net/)。它允许您通过基于属性的编程来完成它，以及许多其他非常有用的东西，而不仅仅是日志记录。

我同意你所说的日志记录有点过分。

其他一些提出了一些优点，尤其是银行场景和其他关键任务应用程序。极端日志记录可能需要它，或者至少能够在需要时打开和关闭它，或者设置各种级别。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-30T15:26:02.123

不需要那么多的日志记录。没有理由（在生产中）知道每种方法何时开始和结束。也许您在某些方法上需要它，但是日志文件中有这么多噪音使得它们几乎不可能有效地分析。

当重要事情发生时，您应该记录，例如错误、用户登录（审计日志）、事务开始、重要数据更新......等等。如果您有无法从日志中找出的问题，那么您可以在必要时添加更多内容……但仅限于必要时。

此外，仅供参考，在编译时添加登录将是所谓的[面向方面编程](http://en.wikipedia.org/wiki/Aspect-oriented_programming)的一个示例。日志记录将是“横切关注点”。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-20T13:04:06.463

我认为“日志与代码的比率”是对问题的误解。

在我的工作中，我偶尔会遇到这样一种情况，即 Java 程序中的错误无法在生产环境之外重现，并且客户不希望它再次发生。

然后，您可以用来修复错误的所有信息，就是您自己放入日志文件中的信息。没有调试会话（无论如何在生产环境中都是禁止的） - 没有戳输入数据 - 什么都没有！

因此，日志是您回到错误发生时的时间机器，并且由于您无法提前预测修复未知错误所需的信息 - 否则您可以首先修复错误 - 您需要记录很多东西...

确切的内容取决于场景，但基本上足以确保您永远不会怀疑发生了什么:)

自然这意味着会发生大量的日志记录。然后，您将创建两个日志 - 一个包含仅保留足够长的时间以确保您不需要它的所有内容，另一个包含可以保留更长时间的重要信息。

忽略日志记录过多，通常是由那些不必修复错误而没有其他事情可做的人完成的:)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-04T10:05:05.960

当您在应用程序的 beta 版本中遇到错误并且无法重现它时，您知道您应该进行过多的日志记录。同样，如果客户报告了错误但您无法重现它，那么过多的日志记录功能可以节省一天的时间。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-30T15:26:22.623

当您有一个客户场景（即，您无法物理访问其机器的人）时，“太多日志记录”的唯一事情是重新绘制函数以及它们调用的几乎任何东西（应该几乎什么都没有）。或者在操作期间每秒调用 100 次的其他函数（程序启动是可以的，但是，记录 100 次对 get/set 例程的调用，因为根据我的经验，这是大多数问题的根源）。

否则，当您错过一些可以明确告诉您用户机器上的问题所在的关键日志点时，您只会自责。

（注意：这里我指的是为面向开发人员的日志启用跟踪模式时发生的日志记录，而不是面向用户的正常操作日志。）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T15:26:03.700

我个人认为，首先没有硬性规定。我有一些应用程序记录了很多，进出方法，以及通过中间的状态更新。这些应用程序虽然是计划进程，但无需手动运行，并且日志由另一个存储成功/失败的应用程序解析。

我发现实际上，许多用户应用程序不需要大量的日志记录，因为如果真的出现问题，您将通过调试来跟踪那里的值。此外，您通常不需要记录日志的费用。

但是，这实际上取决于项目。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-30T15:33:33.620

默认情况下，其中有多少行正在记录？我在一个非常像你描述的系统上工作过 - 如果日志记录被加速，只需启动它就会导致超过 20MB 的日志被写入，但即使调试我们也没有为所有模块完全打开它. 默认情况下，它会记录输入代码模块和主要系统事件的时间。它非常适合调试，因为 QA 可以将日志附加到票证上，即使它不可重现，您也可以看到问题发生时发生的情况。如果您正在处理严重的多线程，那么日志记录仍然比我使用过的任何 IDE 或调试器都要好。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-06T18:11:30.657

在我的工作中，我编写了很多 Windows 服务。对我来说，伐木不是奢侈品。它实际上是我唯一的用户界面。当我们部署到生产环境时，我们无法进行调试，甚至无法访问我们的服务写入的数据库，如果没有日志记录，我们将无法了解出现的任何问题的细节。

话虽如此，我确实相信简洁的日志记录风格是最好的方法。日志消息往往仅限于应用程序的业务逻辑，例如“从帐户 xxx 收到消息”而不是“输入函数 yyy”。我们会记录异常、线程启动、环境设置和时间的回显。除此之外，我们希望调试器在开发和 QA 阶段识别逻辑错误。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-06T18:20:23.633

我发现自从我开始使用 TDD 以来，日志记录的必要性要小得多。它使确定错误所在的位置变得更加容易。但是，我发现日志语句可以帮助理解代码中发生了什么。当然，调试器可以帮助您对正在发生的事情有一个低层次的了解。但是，如果我想从高层次上了解正在发生的事情，我可以将一行输出与一行代码匹配起来，这样会更容易。

但是，我应该添加的一件事是：确保您的日志语句包含日志语句所在的模块！我无法计算我不得不返回并找到日志语句的实际位置的次数。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-08T04:34:49.383

我必须承认，当开始编程时，我或多或少地记录了“Dillie-O”所描述的所有细节。

相信我……它在生产部署的最初几天帮助很大，我们严重依赖日志文件来解决数百个问题。

一旦系统变得稳定，我慢慢开始删除日志条目，因为它们的附加值开始减少。（当时没有[Log4j 。）](https://en.wikipedia.org/wiki/Log4j)

我认为，代码与日志条目的比例取决于项目和环境，它不必是一个恒定的比例。

如今，我们在使用 Log4j 等包进行日志记录、动态启用日志级别等方面具有很大的灵活性。

但是如果程序员没有正确使用它，例如何时使用，何时不使用 INFO、DEBUG、ERROR 等以及日志消息中的详细信息（我见过类似的日志消息，“Hello X, Hello XX,你好，XXX等”只有程序员才能理解）比例将继续保持较高的[投资回报率](https://en.wiktionary.org/wiki/ROI#Noun)。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T15:30:35.013

我认为另一个因素是正在使用的工具集/平台以及随之而来的约定。例如，日志记录在 J(2)EE 世界中似乎非常普遍，而我不记得曾经在 Ruby on Rails 应用程序中编写过日志语句。

# html - 在 Internet Explorer 的表单提交中设置字符编码

> ID：153527
> 
> 赞同：60
> 
> 时间：2008-09-30T15:21:38.360
> 
> 标签：html, internet-explorer, forms, encoding, iso-8859-1

我有一个包含表单的页面。此页面以内容类型 text/html;charset=utf-8 提供。我需要使用 ISO-8859-1 字符编码将此表单提交到服务器。这可以通过 Internet Explorer 实现吗？

像这样将 accept-charset 属性设置为表单元素，适用于 Firefox、Opera 等，但不适用于 IE。

```
<form accept-charset="ISO-8859-1">
  ...
</form> 
```

编辑：此表单由服务器 A 创建，并将提交给服务器 B。我无法控制服务器 B。

如果我将服务器 A 设置为使用字符集 ISO-8859-1 提供内容，那么一切正常，但我正在寻找一种方法来使这项工作在不更改服务器 A 编码的情况下进行。我有另一个[关于在服务器 A 中设置编码的问题。](https://stackoverflow.com/questions/153482/setting-iso-8859-1-encoding-for-a-single-tapestry-4-page-in-application-that-is)

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-09-02T12:42:03.063

有一个简单的技巧：

在表单中插入一个隐藏的输入字段，其中包含一个实体，该实体仅出现在您发布（或执行 GET）接受的服务器的字符集中。

示例：如果表单位于服务 ISO-8859-1 的服务器上，并且表单将发布到期望 UTF-8 的服务器，则在表单中插入如下内容：

```
<input name="iehack" type="hidden" value="&#9760;" /> 
```

然后，IE 将“检测”表单包含 UTF-8 字符，并在您 POST 或 GET 时使用 UTF-8。奇怪，但它确实有效。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2012-08-08T11:24:42.363

使用不错的浏览器：

```
<form accept-charset="ISO-8859-1" .... > 
```

使用 IE（任何）：

```
document.charset = 'ISO-8859-1'; // do this before submitting your non-utf8 <form>! 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-08T13:51:59.190

这似乎无法做到，至少在当前版本的 IE（6 和 7）中是无法做到的。

IE 支持表单属性accept-charset，但前提是它的值为'utf-8'。

解决方案是修改服务器 A 为包含表单的页面生成编码“ISO-8859-1”。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-04-12T09:36:27.840

我在这里遇到了同样的问题。我有一个 UTF-8 页面，需要发布到 ISO-8859-1 服务器。

看起来 IE 无法处理 ISO-8859-1。**但**它可以处理 ISO- **8859-15**。

```
<form accept-charset="ISO-8859-15">
  ...
</form> 
```

所以这对我有用，因为 ISO-8859-1 和 ISO-8859-15 几乎相同。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T21:19:55.067

如果您完全可以访问服务器，请将其处理转换为 UTF-8。提交非 UTF-8 表单的艺术是一个漫长而遗憾的故事。这份[关于表格和 i18n](http://web.archive.org/web/20060427015200/ppewww.ph.gla.ac.uk/~flavell/charset/form-i18n.html)的文档可能会引起您的兴趣。我知道您似乎并不关心国际支持；您始终可以将 UTF-8 数据转换为 html 实体，以确保它保持为 Latin-1。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-04-09T00:16:19.550

对于俄罗斯符号“windows-1251”

```
<form action="yourProcessPage.php" method="POST" accept-charset="utf-8">
<input name="string" value="string" />
...
</form> 
```

当简单地将字符串转换为 cp1251

```
$string = $_POST['string'];
$string = mb_convert_encoding($string, "CP1251", "UTF-8"); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-07-23T20:48:22.533

刚遇到同样的问题，我有一个相对简单的解决方案，不需要对页面字符编码进行任何更改（这很麻烦）。

例如，您的站点是 utf-8 格式，而您想将表单发布到 iso-8859-1 格式的站点。只需将帖子的操作更改为您网站上的一个页面，该页面会将发布的值从 utf-8 转换为 iso-8859-1。

这可以在 php 中通过以下方式轻松完成：

```
<?php
$params = array();
foreach($_POST as $key=>$value) {
    $params[] = $key."=".rawurlencode(utf8_decode($value));
}
$params = implode("&",$params);

//then you redirect to the final page in iso-8859-1
?> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T21:16:56.397

I seem to remember that Internet Explorer gets confused if the accept-charset encoding doesn't match the encoding specified in the content-type header. In your example, you claim the document is sent as UTF-8, but want form submits in ISO-8859-1\. Try matching those and see if that solves your problem.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T15:40:39.607

看起来微软知道[accept-charset](http://msdn.microsoft.com/en-us/library/ms533061%28VS.85%29.aspx "acceptCharset 属性 (FORM)")，但他们的文档没有说明它开始工作的版本......
您也没有说明您在哪个版本的浏览器中测试了它。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-30T15:33:51.747

我很确定使用旧版本的 IE 是不可能的。在`accept-charset`设计属性之前，`form`元素无法指定它们接受哪种字符编码，浏览器能做的最好的事情就是假设表单所在页面的编码可以做到。

您需要知道使用了哪种编码，这有点令人难过——现在我们希望我们的 Web 框架能够无形地处理这些细节，并将文本数据作为 Unicode 字符串公开给应用程序，已经解码......

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2009-07-31T17:31:05.203

```
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
```

# java - 为并置对象停用 Weblogic 负载平衡优化

> ID：153537
> 
> 赞同：5
> 
> 时间：2008-09-30T15:24:52.097
> 
> 标签：java, jakarta-ee, weblogic, load-balancing, cluster-computing

有没有办法停用Weblogic 默认为特定 EJB 使用的[并置对象的优化？](http://download.oracle.com/docs/cd/E11035_01/wls100/cluster/load_balancing.html#wp1026599)

编辑：一些背景：

我们有一个在集群的一个节点内运行的调度程序服务。这是出于历史原因，目前无法更改。

该服务调用 EJB，我们希望对这些调用进行负载平衡。不幸的是，由于问题中提到的优化，目前每个调用都在托管调度程序服务的节点上运行。

我正在考虑编写一个自定义负载平衡类，但是这种优化似乎是在负载平衡步骤发生之前完成的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T00:13:56.323

Supposing you are trying to call a remote EJB (load balancing on local ejbs can only be obtained through an indirection trick like Patrick mentioned) you will have to create a new InitialContext using the address of the cluster instead of a particular server. This new IC will provide stubs as if you were a foreign client, subject to the same load balancing strategies as they are.

Unfortunately, this means that EJB3 injections won't work. You will have to do the lookup yourself. There is a chance, an this is pure speculation, that those stubs you can get from the cluster IC are serializable. In other words, it might be possible to bind them and get them injected using @Resource afterwards.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T17:07:43.613

不太熟悉 weblogic 的内容，但阅读他们的材料我会说你不能，没有一些诡计。

看起来您可以在不遵守并置对象优化的 EJB 前面放置一个 JMS (MDB) 外观。

或者

如果您的调度程序是基于 servlet 的，您应该能够将其部署在容器内的单独 Web 应用程序中，并让它执行对 EJB 集群的调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T09:26:21.557

您的集群中有多少个节点？您是否考虑过将 EJB 部署到调度程序服务已部署到的节点以外的节点？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-12T02:55:33.983

我碰巧偶然发现了这个老问题。

是否可以在调度程序和实际执行程序之间创建一个 JMS 队列？由于所有托管服务器都将从同一个队列中消费，因此队列将在某种程度上充当负载平衡器。

如果您以不同的方式解决了这个问题，我很想知道如何:)

# asp.net - 浏览器中的 Flex/Flash 调试

> ID：153553
> 
> 赞同：2
> 
> 时间：2008-09-30T15:28:45.113
> 
> 标签：asp.net, apache-flex, flash, debugging

我在 Firefox 中遇到 Flash/Flex 错误问题，但在 IE 中没有。我需要查看 Flash/Flex 应用程序从 ASP.NET 应用程序获得的错误。有什么方法可以调试 Flash/Flex 得到的响应？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T15:35:58.747

为 Firefox 安装 FlashPlayer 的调试版本。也许这已经足够了，并且可能会弹出一个错误。

如果不使用 FlexBuilder 并调试 Flex 应用程序。如果您没有 FlexBuilder 许可证，您也可以使用评估许可证。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:45:44.760

请记住，您还可以通过 firebug 观察网络流量，即使对于 Flash 应用程序也是如此。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T17:18:08.453

根据您调用 ASP.net 应用程序的方式 - 您可以使用[LiveHTTPHeaders](http://livehttpheaders.mozdev.org/)之类的东西来查看您的 flex 应用程序调用的 url，并查看从服务器发回的响应（即 200、404、503 等） ...)

另外——你可以使用像[Charles](http://www.charlesproxy.com/)这样的东西来做同样的事情，但实际上可以看到来自服务器的完整响应（无论是图像、文本、xml ......），而不仅仅是标题信息。

# c++ - Windows 上的原生 C++ 有哪些好的分析器？

> ID：153559
> 
> 赞同：17
> 
> 时间：2008-09-30T15:29:48.837
> 
> 标签：c++, windows, performance, profiling

我正在寻找与本机 C++ 一起使用的分析器。它当然不一定是免费的，但是成本确实会影响购买决定。这是商业作品，所以我不能使用个人或学术许可的副本。

我正在寻找的主要功能是：

*   流程级别指标
*   组件级指标
*   行级指标
*   支持多线程代码
*   可用性
*   成本
*   需要 Visual Studio 2005 Professional 支持（非常需要 VS 2008 Professional 支持）

我使用过 Intel 的 VTune 和 Compuware 的 Devpartner Performance Analysis Community Edition。

VTune 似乎非常强大，但它的学习曲线很陡峭。它也非常“模块化”，因此您必须弄清楚需要购买哪些零件。

DevPartner PACE 非常易于使用并提供所有关键功能，但它只有 45 天的试用期。许可版本（Visual C++ BoundsChecker Suite 的 DevPartner）每个席位大约 1400 美元，这是可行的，但 imo 有点高。

**本机 C++ 和WHY**有哪些好的分析器？

* * *

### 也可以看看：

[你最喜欢的 C++ 分析工具是什么](https://stackoverflow.com/questions/26663/whats-your-favorite-profiling-tool-for-c)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T17:49:43.073

在 Windows 上，[GlowCode](http://www.glowcode.com)价格实惠，相当容易使用，并提供免费试用，以便您查看它是否适合您。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T04:22:52.880

许多人不知道，但 MSFT 正在取得巨大进步，将提高性能的最佳工具免费提供给开发人员 :-)。他们向我们所有人展示了 Windows 跟踪的内部结构：ETW。

[性能工具](http://www.microsoft.com/whdc/system/sysperf/perftools.mspx)

它是用于 server 2008 和 Vista 的新 windows SDK 的一部分。如果您的目标是在 Windows 下进行性能分析和分析（无论使用哪种语言），那简直令人印象深刻并且必须下载。

在您决定下载之前，请查看此处的文档：

[msdn 文档](http://msdn.microsoft.com/en-us/library/ff191077.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-02T06:10:45.183

试试英特尔 Parallel Studio。目前，它处于测试阶段，但英特尔的名字说明了一切。

[http://www.intel.com/go/parallel](http://www.intel.com/go/parallel)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-08T16:07:45.757

[刚刚在 SourceForge ( http://lukestackwalker.sourceforge.net/](http://lukestackwalker.sourceforge.net/) )上找到了 Luke StackWalker 。不幸的是，它没有“专注于子树”，但它仍然易于使用，使用符号服务器（如果您还没有它，我建议您立即设置它），提供图形可视化，...

不利的一面是它不显示子函数的累积时间（样本）。

另一种选择是“非常困”（[http://www.codersnotes.com/sleepy](http://www.codersnotes.com/sleepy)）。它可以显示孩子的累积次数，但不幸的是它不使用符号服务器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-09-26T06:00:31.443

CodeXL 也可能值得一看，它可以在 Linux 和 Windows 上运行，尽管它主要用于 OpenGL/OpenCL 调试和分析，但在分析部分下有一个基于时间的 CPU 示例选项可能会有所帮助。它也是免费的，只要 pdb 文件可用就可以工作（在 Windows 上，我不知道它在 Linux 上是如何工作的）（即使是使用 pdb 的发布版本）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-02T09:46:16.013

绝对是 Visual Studio Team System。到目前为止。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-04-23T16:14:44.747

我刚刚完成了[CxxProf](https://github.com/monsdar/CxxProf)的第一个可用版本，这是一个用于 C++ 的便携式手动检测分析库。

它满足您的要求：

*   分析多线程应用程序
*   正在支持对同一网络中的多个进程进行分析
*   它的编写考虑了最佳可用性和最简单的集成
*   它像啤酒一样免费，像言论一样免费
*   它适用于 VS05、08、10、12 和 13。以及 Linux 上的 g++。它目前已使用 VS 2013 Express 进行了测试。

有关更多信息，请参阅[项目 wiki](https://github.com/monsdar/CxxProf/wiki/What-is-CxxProf?)。

*免责声明：我是 CxxProf 的主要开发者*

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-12-21T17:10:35.933

我写了一个开源的轻量级 win32/64 profiler，支持 CPU 和内存 profiling，它和 VS profiler 有点类似，但有 CPU 和内存数据的火焰图等独特的功能。在这里：　[dprofiler](https://github.com/xwlan/dprofiler)

# c# - 在给定 BNF 语法的情况下输出 C# 的解析器生成器？

> ID：153572
> 
> 赞同：9
> 
> 时间：2008-09-30T15:32:02.763
> 
> 标签：c#, parsing, bnf

[如果我给它一个 BNF 语法（例如http://savage.net.au/SQL/sql-2003-2.bnf](http://savage.net.au/SQL/sql-2003-2.bnf)），我正在寻找一个能够构建解析器（在 C# 中）的工具

这样的发电机存在吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-30T15:35:07.250

通常 BNF 语法太模棱两可了。ANTLR 可能对您正在寻找的东西有好处。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-13T21:14:37.733

[Visual Studio SDK](http://msdn.microsoft.com/en-us/library/bb166441(loband).aspx)实际上附带了词法分析器和解析器生成工具。它们被称为 MPPG 和 MPLex，是[Managed Babel](http://msdn.microsoft.com/en-us/library/bb165037(loband).aspx)包的一部分。虽然将它们与 SDK 捆绑在一起的目的是为 Visual Studio 开发语言扩展，但它们完全可用于创建通用 AST 发射解析器。

MPlex 和 MPPG 基于[GPLEX](http://plas.fit.qut.edu.au/gplex/)和[GPPG](http://plas.fit.qut.edu.au/gppg/)（昆士兰科技大学的项目），并以与 Lex 和 Yacc 类似的方式使用。SDK 还包含 MSBuild 操作，用于使解析器生成成为常规构建过程的一部分。

这是一个显示 MPLex 和 MPPG 的截屏视频：http:
[//msdn.microsoft.com/en-us/vstudio/cc837016.aspx](http://msdn.microsoft.com/en-us/vstudio/cc837016.aspx)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-01T11:18:18.777

您将不得不稍微调整 BNF，但[TinyPG](http://www.codeproject.com/KB/recipes/TinyPG.aspx "小PG")是一个很棒的工具。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-10-18T20:54:46.967

也看看讽刺：

[http://irony.codeplex.com/](http://irony.codeplex.com/)

看起来很有希望

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-12-04T16:54:51.497

[IronMeta](http://sourceforge.net/projects/ironmeta/ "IronMeta")是 Alex Warth 的[OMeta](https://github.com/alexwarth/ometa-js "奥美达")的 C# 实现；它是一个 Packrat PEG（解析表达式语法；使用有偏见的选择），因此语法比使用类似 yacc 的 LALR 系统时更简洁。

# c# - 如何在 C# 中清除事件订阅？

> ID：153573
> 
> 赞同：146
> 
> 时间：2008-09-30T15:32:17.867
> 
> 标签：c#, .net, events, delegates

学习以下 C# 类：

```
c1 {
 event EventHandler someEvent;
} 
```

如果有很多订阅`c1`'s`someEvent`事件并且我想将它们全部清除，那么实现这一目标的最佳方法是什么？**还要考虑到此事件的订阅可能/是 lambdas/匿名委托。**

目前我的解决方案是添加一个设置为 null的`ResetSubscriptions()`方法。我不知道这是否有任何看不见的后果。`c1``someEvent`

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2008-09-30T16:05:02.233

在类中，您可以将（隐藏）变量设置为 null。空引用是有效地表示空调用列表的规范方式。

在课堂之外，你不能这样做——事件基本上暴露了“订阅”和“取消订阅”，仅此而已。

值得注意的是，类似字段的事件实际上在做什么——它们同时创建了一个变量*和*一个事件。在类中，您最终会引用该变量。从外部，您引用该事件。

有关更多信息，请参阅我[关于事件和代表](http://csharpindepth.com/Articles/Chapter2/Events.aspx)的文章。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-09-30T15:33:46.550

向 c1 添加一个方法，将 'someEvent' 设置为 null。

```
public class c1
{
    event EventHandler someEvent;
    public ResetSubscriptions() => someEvent = null;    
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-04-30T16:33:55.273

```
class c1
{
    event EventHandler someEvent;
    ResetSubscriptions() => someEvent = delegate { };
} 
```

`delegate { }`使用它比`null`避免 null ref 异常更好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-01T11:17:04.630

在类中将事件设置为 null 有效。当您处置一个类时，您应该始终将事件设置为 null，GC 会遇到事件问题，并且如果已处置的类有悬空事件，则可能不会清理它。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-10-16T12:00:05.027

清除所有订阅者的最佳做法是，如果您想将此功能公开给外部，则通过添加另一个公共方法将 someEvent 设置为 null。这没有看不见的后果。前提是要记住用关键字'event'声明SomeEvent。

请参阅书 - 简而言之 C# 4.0，第 125 页。

这里有人提出使用`Delegate.RemoveAll`方法。如果您使用它，示例代码可以遵循以下形式。但这真的很愚蠢。为什么不只是`SomeEvent=null`在`ClearSubscribers()`函数内部？

```
public void ClearSubscribers ()
{
   SomeEvent = (EventHandler) Delegate.RemoveAll(SomeEvent, SomeEvent);
   // Then you will find SomeEvent is set to null.
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-30T15:36:21.320

您可以通过使用 Delegate.Remove 或 Delegate.RemoveAll 方法来实现此目的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-03-24T18:39:12.553

**概念性扩展无聊评论。**

我宁愿使用“事件处理程序”这个词而不是“事件”或“委托”。并将“事件”一词用于其他内容。在某些编程语言（VB.NET、Object Pascal、Objective-C）中，“事件”被称为“消息”或“信号”，甚至还有“消息”关键字，以及特定的糖语法。

```
const
  WM_Paint = 998;  // <-- "question" can be done by several talkers
  WM_Clear = 546;

type
  MyWindowClass = class(Window)
    procedure NotEventHandlerMethod_1;
    procedure NotEventHandlerMethod_17;

    procedure DoPaintEventHandler; message WM_Paint; // <-- "answer" by this listener
    procedure DoClearEventHandler; message WM_Clear;
  end; 
```

并且，为了响应该“消息”，“事件处理程序”响应，无论是单个委托还是多个委托。

摘要：“事件”是“问题”，“事件处理程序（s）”是答案（s）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-12-20T20:00:54.253

# 移除所有事件，假设事件是“Action”类型：

```
Delegate[] dary = TermCheckScore.GetInvocationList();

if ( dary != null )
{
    foreach ( Delegate del in dary )
    {
        TermCheckScore -= ( Action ) del;
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-03-05T07:14:39.347

这是我的解决方案：

```
public class Foo : IDisposable
{
    private event EventHandler _statusChanged;
    public event EventHandler StatusChanged
    {
        add
        {
            _statusChanged += value;
        }
        remove
        {
            _statusChanged -= value;
        }
    }

    public void Dispose()
    {
        _statusChanged = null;
    }
} 
```

您需要调用`Dispose()`或使用`using(new Foo()){/*...*/}`模式来取消订阅调用列表的所有成员。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2020-01-29T15:37:35.643

而不是手动添加和删除回调并在各处声明一堆委托类型：

```
// The hard way
public delegate void ObjectCallback(ObjectType broadcaster);

public class Object
{
    public event ObjectCallback m_ObjectCallback;

    void SetupListener()
    {
        ObjectCallback callback = null;
        callback = (ObjectType broadcaster) =>
        {
            // one time logic here
            broadcaster.m_ObjectCallback -= callback;
        };
        m_ObjectCallback += callback;

    }

    void BroadcastEvent()
    {
        m_ObjectCallback?.Invoke(this);
    }
} 
```

您可以尝试这种通用方法：

```
public class Object
{
    public Broadcast<Object> m_EventToBroadcast = new Broadcast<Object>();

    void SetupListener()
    {
        m_EventToBroadcast.SubscribeOnce((ObjectType broadcaster) => {
            // one time logic here
        });
    }

    ~Object()
    {
        m_EventToBroadcast.Dispose();
        m_EventToBroadcast = null;
    }

    void BroadcastEvent()
    {
        m_EventToBroadcast.Broadcast(this);
    }
}

public delegate void ObjectDelegate<T>(T broadcaster);
public class Broadcast<T> : IDisposable
{
    private event ObjectDelegate<T> m_Event;
    private List<ObjectDelegate<T>> m_SingleSubscribers = new List<ObjectDelegate<T>>();

    ~Broadcast()
    {
        Dispose();
    }

    public void Dispose()
    {
        Clear();
        System.GC.SuppressFinalize(this);
    }

    public void Clear()
    {
        m_SingleSubscribers.Clear();
        m_Event = delegate { };
    }

    // add a one shot to this delegate that is removed after first broadcast
    public void SubscribeOnce(ObjectDelegate<T> del)
    {
        m_Event += del;
        m_SingleSubscribers.Add(del);
    }

    // add a recurring delegate that gets called each time
    public void Subscribe(ObjectDelegate<T> del)
    {
        m_Event += del;
    }

    public void Unsubscribe(ObjectDelegate<T> del)
    {
        m_Event -= del;
    }

    public void Broadcast(T broadcaster)
    {
        m_Event?.Invoke(broadcaster);
        for (int i = 0; i < m_SingleSubscribers.Count; ++i)
        {
            Unsubscribe(m_SingleSubscribers[i]);
        }
        m_SingleSubscribers.Clear();
    }
} 
```

# air - 我可以为 Adob e AIR 应用程序分配全局热键吗？

> ID：153581
> 
> 赞同：12
> 
> 时间：2008-09-30T15:34:50.090
> 
> 标签：air, development-environment, customization

是否可以为 Adob​​e AIR 应用程序中的特定功能分配全局热键，即无论应用程序是否处于活动状态，应用程序功能都会响应热键（它当然必须在运行，但仅在系统托盘中）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T00:59:14.773

我不认为 Adob​​e AIR 本身可以做到这一点。我能想到的唯一方法：

1.  安装第 3 方热键应用程序（如[AutoHotkey](http://www.autohotkey.com/)或[HotKeyBind](http://sourceforge.net/projects/hotkeybind/)）
2.  配置热键应用程序使`CTRL`++`ALT`启动`Q`“ `c:\programs\thvo42\coolapp.exe --hotkey q`”
3.  在您的 AIR 应用程序中，注册[NativeApplication.invoke](http://livedocs.adobe.com/labs/air/1/aslr/flash/desktop/NativeApplication.html#event:invoke)事件，并观察诸如“--hotkey q”之类的参数以了解 Q 热键被按下，然后采取相应的行动。

当然，这有点麻烦，也许通过一些黑客攻击，您可以将其全部整合到一个安装文件中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T02:27:56.617

从参考手册：

要全局侦听关键事件，请在舞台上侦听捕获和目标或冒泡阶段。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-28T13:52:02.560

SWFKit 为您的 flash/flex 电影创建一个包装器，并允许访问系统 DLL 和其他好东西，但不幸的是它会导出为 .exe，因此只有 windows 而没有 AIR。

ASFAIK，单独使用 AIR 不支持它。

# python - 如何在数天、数小时、数周和数月之后迭代一个时间跨度？

> ID：153584
> 
> 赞同：74
> 
> 时间：2008-09-30T15:35:22.600
> 
> 标签：python, datetime

如何在数天、数小时、数周或数月后迭代一个时间跨度？

就像是：

```
for date in foo(from_date, to_date, delta=HOURS):
    print date 
```

其中 foo 是一个函数，返回一个迭代器。我一直在查看日历模块，但这仅适用于特定的年份或月份，而不适用于日期之间。

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2008-09-30T21:30:00.907

使用[dateutil](http://labix.org/python-dateutil)及其 rrule 实现，如下所示：

```
from dateutil import rrule
from datetime import datetime, timedelta

now = datetime.now()
hundredDaysLater = now + timedelta(days=100)

for dt in rrule.rrule(rrule.MONTHLY, dtstart=now, until=hundredDaysLater):
    print dt 
```

输出是

```
2008-09-30 23:29:54
2008-10-30 23:29:54
2008-11-30 23:29:54
2008-12-30 23:29:54 
```

将 MONTHLY 替换为 YEARLY、MONTHLY、WEEKLY、DAILY、HOURLY、MINUTELY 或 SECONDLY 中的任何一个。将 dtstart 和 until 替换为您想要的任何日期时间对象。

这个配方的优点是适用于所有情况，包括每月。我能发现的唯一警告是，如果您传递的天数在所有月份都不存在，它会跳过那些月份。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-09-30T15:50:06.153

我认为 Python 库中没有方法，但是您可以使用[datetime](http://docs.python.org/lib/module-datetime.html)模块轻松地自己创建一个方法：

```
from datetime import date, datetime, timedelta

def datespan(startDate, endDate, delta=timedelta(days=1)):
    currentDate = startDate
    while currentDate < endDate:
        yield currentDate
        currentDate += delta 
```

然后你可以像这样使用它：

```
>>> for day in datespan(date(2007, 3, 30), date(2007, 4, 3), 
>>>                     delta=timedelta(days=1)):
>>>     print day
2007-03-30
2007-03-31
2007-04-01
2007-04-02 
```

或者，如果你想让你的 delta 更小：

```
>>> for timestamp in datespan(datetime(2007, 3, 30, 15, 30), 
>>>                           datetime(2007, 3, 30, 18, 35), 
>>>                           delta=timedelta(hours=1)):
>>>     print timestamp
2007-03-30 15:30:00
2007-03-30 16:30:00
2007-03-30 17:30:00
2007-03-30 18:30:00 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-30T17:14:29.273

对于几个月的迭代，您需要不同的配方，因为 timedeltas 不能表示“一个月”。

```
from datetime import date

def jump_by_month(start_date, end_date, month_step=1):
    current_date = start_date
    while current_date < end_date:
        yield current_date
        carry, new_month = divmod(current_date.month - 1 + month_step, 12)
        new_month += 1
        current_date = current_date.replace(year=current_date.year + carry,
                                            month=new_month) 
```

（注意：您必须从月份中减去 1 进行模运算，然后将其加回`new_month`，因为`datetime.date`s 中的月份从 1 开始。）

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2018-05-23T09:34:30.383

我使用 pandas 和 datetime 库实现了这一点，如下所示。这对我来说方便多了。

```
import pandas as pd
from datetime import datetime

DATE_TIME_FORMAT = '%Y-%m-%d %H:%M:%S'

start_datetime = datetime.strptime('2018-05-18 00:00:00', DATE_TIME_FORMAT)
end_datetime = datetime.strptime('2018-05-23 13:00:00', DATE_TIME_FORMAT)

timedelta_index = pd.date_range(start=start_datetime, end=end_datetime, freq='H').to_series()
for index, value in timedelta_index.iteritems():
    dt = index.to_pydatetime()
    print(dt) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-09-13T13:22:35.417

月迭代法：

```
def months_between(date_start, date_end):
    months = []

    # Make sure start_date is smaller than end_date
    if date_start > date_end:
        tmp = date_start
        date_start = date_end
        date_end = tmp

    tmp_date = date_start
    while tmp_date.month <= date_end.month or tmp_date.year < date_end.year:
        months.append(tmp_date)  # Here you could do for example: months.append(datetime.datetime.strftime(tmp_date, "%b '%y"))

        if tmp_date.month == 12: # New year
            tmp_date = datetime.date(tmp_date.year + 1, 1, 1)
        else:
            tmp_date = datetime.date(tmp_date.year, tmp_date.month + 1, 1)
    return months 
```

更多代码，但它可以很好地处理长时间检查给定日期是否有序......

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-30T15:43:38.977

这个库提供了一个方便的日历工具：[mxDateTime](http://www.egenix.com/products/python/mxBase/mxDateTime/)，应该足够了:)

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-04-15T13:04:10.843

您应该修改此行以使其正常工作：

current_date = current_date.replace(year=current_date.year + carry,month=new_month,day=1)

;)

# sql - 分组的SQL子查询问题，平均

> ID：153585
> 
> 赞同：4
> 
> 时间：2008-09-30T15:35:34.207
> 
> 标签：sql, sql-server-2005

在 MS Transact SQL 中，假设我有一个像这样的表（订单）：

```
 Order Date       Order Total     Customer #
 09/30/2008       8.00            1
 09/15/2008       6.00            1
 09/01/2008       9.50            1
 09/01/2008       1.45            2
 09/16/2008       4.50            2
 09/17/2008       8.75            3
 09/18/2008       2.50            3 
```

我需要的是：对于每个客户，最近两个订单的平均订单金额。所以对于客户 #1，我应该得到 7.00（而不是 7.83）。

我已经盯着这个看了一个小时（在一个更大的问题中，我已经解决了），我想我的大脑已经冻结了。帮助解决一个简单的问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T15:38:11.253

这应该使它

```
select avg(total), customer 
from orders o1 
where orderdate in 
  ( select top 2 date 
    from orders o2 
    where o2.customer = o1.customer 
    order by date desc )
group by customer 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T15:39:25.057

在 SQL Server 2005 中，您有 RANK 函数，与分区一起使用：

```
USE AdventureWorks;
GO
SELECT i.ProductID, p.Name, i.LocationID, i.Quantity
    ,RANK() OVER 
    (PARTITION BY i.LocationID ORDER BY i.Quantity DESC) AS 'RANK'
FROM Production.ProductInventory i 
    INNER JOIN Production.Product p 
        ON i.ProductID = p.ProductID
ORDER BY p.Name;
GO 
```

[关联](http://msdn.microsoft.com/en-us/library/ms176102.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T15:40:55.177

一种选择是让您使用游标遍历所有客户 ID，然后将平均值作为几个子查询。

不过，公平的警告是，对于大型数据集，查询效率不高，并且可能需要很长时间才能处理。

# c# - 如何确定 GDI+ 中两条线的交点？

> ID：153592
> 
> 赞同：2
> 
> 时间：2008-09-30T15:36:04.767
> 
> 标签：c#, .net, graphics, geometry, gdi+

我正在使用 .NET 制作具有绘图表面的应用程序，类似于 Visio。UI 用 Graphics.DrawLine 连接屏幕上的两个对象。这个简单的实现效果很好，但是随着表面变得越来越复杂，我需要一种更健壮的方式来表示对象。这些强大的要求之一是确定两条线的交点，以便我可以通过某种图形指示分离。

所以我的问题是，任何人都可以提出一种方法来做到这一点吗？也许使用不同的技术（也许是 GraphViz）或算法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T16:12:42.057

用 y = mx + c 表示线对于计算机图形来说是有问题的，因为垂直线要求 m 是无限的。

此外，计算机图形中的线具有起点和终点，这与无限延伸的数学线不同。如果交叉点位于所讨论的两条线段上，人们通常只对线的交叉感兴趣。

如果您有两条线段，一条从向量 x1 到 x1+v1，一条从向量 x2 到 x2+v2，则定义：

```
a = (v2.v2 v1.(x2-x1) - v1.v2 v2.(x2-x1)) / ((v1.v1)(v2.v2) - (v1.v2)^2)
b = (v1.v2 v1.(x2-x1) - v1.v1 v2.(x2-x1)) / ((v1.v1)(v2.v2) - (v1.v2)^2) 
```

其中对于向量 p=(px,py), q=(qx,qy)，pq 是点积 (px * qx + py * qy)。首先检查 (v1.v1)(v2.v2) = (v1.v2)^2 - 如果是，则线平行且不交叉。

如果它们不平行，则如果 0<=a<=1 和 0<=b<=1，则交点位于两条线段上，由点给出

```
x1 + a * v1 
```

**编辑**a 和 b 方程的推导如下。交点满足向量方程

```
x1 + a*v1 = x2 + b*v2 
```

通过将这个方程与`v1`和 相乘`v2`，我们得到两个方程：

```
v1.v1*a - v2.v1*b = v1.(x2-x1)
v1.v2*a - v2.v2*b = v2.(x2-x1) 
```

这形成了 a 和 b 的两个线性方程。求解这个系统（通过将第一个方程乘以 v2.v2 并将第二个方程乘以 v1.v1 并减去，或以其他方式）给出 a 和 b 的方程。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T15:41:56.033

[问博士。数学](http://mathforum.org/library/drmath/view/53254.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T18:10:13.913

如果您旋转参考系以与第一条线段对齐（因此原点现在是第一条线的起点，第一条线的矢量沿 X 轴延伸）问题就变成了，第二条线在哪里击中新坐标系中的 X 轴。这是一个更容易回答的问题。如果第一条线被调用`A`，它被定义`A.O`为线的起点，'AV'是线的向量，所以它`A.O + A.V`是线的终点。参考系可以由矩阵定义：

```
 | A.V.X   A.V.Y   A.O.X |
M = | A.V.Y  -A.V.X   A.O.Y |
    |   0       0       1   | 
```

`A`在齐次坐标中，该矩阵为将线映射到 X 轴上的 0 到 1的参考系提供了基础。我们现在可以将转换后的线定义`B`为：

```
C.O = M*(B.O)
C.V = M*(B.O + B.V) - C.O 
```

运算符为齐次坐标正确定义的位置（在`*`这种情况下是从 3 个空间到 2 个空间的投影）。现在剩下的就是检查并查看`C`X 轴的位置，这与求解for`Y`的参数方程的一侧相同：`C``t`

```
C.O.Y + t * C.V.Y = 0
     -C.O.Y
t = --------
      C.V.Y 
```

如果`t`在 0 到 1 的范围内，则`C`命中线段内的 X 轴。它落在 X 轴上的位置由 的参数方程的 X 侧给出`C`：

```
x = C.O.X + t * C.V.X 
```

如果`x`在 0 到 1 的范围内，则交点`A`在线段上。然后我们可以在原始坐标系中找到点：

```
p = A.O + A.V * x 
```

您当然必须首先检查任何一条线段是否为零长度。此外，如果`C.V.Y = 0`您有平行线段。如果`C.V.X`也为零，则您有共线线段。

# c# - 从 C# 以编程方式访问 Microsoft Project (MPP) 文件

> ID：153593
> 
> 赞同：20
> 
> 时间：2008-09-30T15:36:12.893
> 
> 标签：c#, ms-project

以编程方式访问 Microsoft Project 文件的选项有哪些？每种方法的优缺点是什么？

我基本上需要将文件中的所有数据导入另一个数据结构。使用 Office 互操作程序集的偏好规模较低。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-09T08:09:17.633

MPXJ ( [mpxj.sf.net](http://mpxj.sf.net) ) 库具有 Java 和 .Net 两种风格，允许您使用单一一致的 API 读取和写入多种 Microsoft Project 文件格式。我知道使用 Java 和 .Net 版本的 MPXJ 的商业产品没有任何问题。

免责声明：我是 MPXJ 的维护者。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-08-10T08:07:49.723

您可以将[Aspose.Tasks 用于 .NET](http://www.aspose.com/categories/.net-components/aspose.tasks-for-.net/default.aspx)。该组件允许您[使用 Microsoft Project 文件](http://www.aspose.com/documentation/.net-components/aspose.tasks-for-.net/index.html)。与 Office Interop 不同，它不需要在服务器上安装 MS Office。API 非常简单易用。它提供了一组丰富的功能来读取、编辑、写入和转换 MPP 文件。

该组件是一个普通的 .NET 程序集，可以与您的 .NET 应用程序一起使用。它适用于任何 Windows 操作系统以及 32/64 位环境。

披露：我在 Aspose 担任开发人员布道师。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T05:09:21.020

以下是选项：

1.  互操作（大型项目的混乱和可怕的缓慢）
2.  以 XML 格式保存项目并使用它（混乱）
3.  将项目保存在数据库中（不发布，仅适用于项目 2003 - 保存时请参阅 ODBC 选项）。我已经看到它在集成场景中被大量使用
4.  [Projette](http://www.highlydeveloped.net/)（商业，每个许可证 10 美元）
5.  [ILog 项目查看器](http://www.ilog.com/products/ganttnet/projectviewer/)（也可商用）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T19:10:31.523

Microsoft Office API 提供对 MS Project 的编程访问。我只将它用于 Word 和 Excel，所以我不知道界面有多丰富 - 你必须在 MSDN 上进行一些挖掘才能找出你能做什么和不能做什么。

我公司的一个 Java 项目使用[Aspose](http://www.aspose.com/categories/file-format-components/default.aspx)的商业产品，它允许应用程序操作包括 Project 在内的 Office 文档。它适用于他们的目的，但同样，他们只将它用于 Word 和 Excel，因此无法对 Project 提供太多建议。

*编辑（2019）*：我可以确认它是一个非常有能力的产品。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-05T04:13:08.607

Sourcefourge.net 提供了一个 Java 组件，它可以与 .net 应用程序集成以读取 MPP 文件到 MPP 2007，链接是 [http://mpxj.sourceforge.net/getting-started.html](http://mpxj.sourceforge.net/getting-started.html)

# c# - 从控制台程序记录到 txt 文件的有效方法

> ID：153596
> 
> 赞同：4
> 
> 时间：2008-09-30T15:36:46.823
> 
> 标签：c#, .net, performance, logging

从 C# 和 .NET 2.2 上的控制台程序记录到日志 (.txt) 的最有效方法是什么？我的程序循环多次，总是根据用户的需要输出不同的数据，所以我正在寻找实现这一目标的最有效方法。

我知道我总是可以重新打开一个流然后关闭它，但是每次我这样做时它只会写一行，然后下一次（几秒钟后）程序重新循环并需要再次写入。在我看来，这似乎对资源不太友好。

我正在使用多个线程，这些线程都有我想要记录的输出数据（打开/关闭同一个文件或在不同线程上访问同一个文件可能很糟糕）。“持有对自动刷新的流编写器的引用”听起来是个好主意，但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-30T15:39:06.477

考虑使用[log4net](http://logging.apache.org/log4net/index.html)：

> 一个帮助程序员将日志语句输出到各种输出目标的工具...我们在利用 .NET 运行时中的新功能的同时，使框架在精神上与原始 log4j 相似。有关 log4net 的更多信息，请参阅[功能](http://logging.apache.org/log4net/release/features.html)文档...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T15:42:36.093

我接受每次写一行时打开和关闭所带来的性能损失。这是一个可靠性决定。如果您将所有内容都保存在内存中并且发生了严重崩溃，那么您根本没有日志信息来帮助进行故障排除。如果这不是您关心的问题，那么将其保存在内存中肯定会提供更好的性能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T15:52:14.433

您可以连接到构成 CLR 一部分的跟踪框架。使用一个简单的类，如：[http](http://www.chaosink.co.uk/files/tracing.zip) ://www.chaosink.co.uk/files/tracing.zip ，您可以有选择地记录诊断信息。要使用它，请将类添加到您的应用程序中。在您的类中创建跟踪器的实例，例如：

```
private Tracing trace = new Tracing("My.Namespace.Class"); 
```

并使用以下方法调用它：

```
MyClass()
{
    trace.Verbose("Entered MyClass");
    int x = 12;
    trace.Information("X is: {0}", x);
    trace.Verbose("Leaving MyClass");
} 
```

内置跟踪框架中有 4 个级别的信息：

详细 - 记录程序流

信息 - 记录监视器感兴趣的特定信息

警告 - 记录无效状态或可恢复异常

错误 - 记录不可恢复的异常或状态

要从您的应用程序访问信息，请在 app.config（或 web.config）中添加以下内容：

```
<system.diagnostics>
    <trace autoflush="false" indentsize="4">
        <listeners>
            <add name="myListener" type="System.Diagnostics.TextWriterTraceListener" initializeData="c:\mylogfile.log" />
        </listeners>
    </trace>
    <switches>
        <add name="My.Namespace.Class" value="4"/>      
    </switches>
</system.diagnostics> 
```

您还可以附加侦听器以将其发布到事件日志或您感兴趣的任何其他位置。有关跟踪框架的更多信息，请访问：

[http://msdn.microsoft.com/en-us/library/ms733025.aspx](http://msdn.microsoft.com/en-us/library/ms733025.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T15:48:54.940

我同意使用 log4net。

但是，如果你真的需要一些简单的东西，可以考虑只使用一个单例来保存对 StreamWriter 的引用，该 StreamWriter 会在每个 WriteLine 上自动刷新。

因此，您可以在整个会话期间保持文件打开，避免关闭/打开开销，同时在发生硬崩溃时不冒丢失日志数据的风险。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T15:47:53.320

一种简单的方法是提供一个 TextWriterTraceListener 并将其添加到 Trace 类的 TraceListeners 集合中。这将自动将所有 Trace.Write... 调用写入相应的文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T05:51:28.797

像 log4net 这样的日志框架应该正确处理多线程。

可能还有一个有用的提示：日志记录严重污染了代码，使其可读性降低。您是否考虑过在编译时使用方面将日志记录功能注入代码？[有关示例](http://www.developerfusion.com/article/5307/aspect-oriented-programming-using-net/)，请参见本文。

# mysql - Where 子句中的未知列

> ID：153598
> 
> 赞同：140
> 
> 时间：2008-09-30T15:37:17.090
> 
> 标签：mysql, sql, mysql-error-1054

我有一个简单的查询：

```
SELECT u_name AS user_name FROM users WHERE user_name = "john"; 
```

我明白了`Unknown Column 'user_name' in where clause`。即使在之后，我也不能`'user_name'`在声明的其他部分提及`select 'u_name as user_name'`吗？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2008-09-30T15:41:00.060

SQL 是从右到左向后计算的。因此 where 子句在 select 子句之前被解析和评估。因此，尚未发生 u_name 到 user_name 的别名。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2010-10-04T15:03:43.537

关于什么：

```
SELECT u_name AS user_name FROM users HAVING user_name = "john"; 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2008-09-30T15:44:29.707

请参阅以下 MySQL 手册页：[http ://dev.mysql.com/doc/refman/5.0/en/select.html](http://dev.mysql.com/doc/refman/5.0/en/select.html)

> “可以使用 AS alias_name 为 select_expr 赋予别名。别名用作表达式的列名，可用于 GROUP BY、ORDER BY 或 HAVING 子句。”

(...)

> 不允许在 WHERE 子句中引用列别名，因为在执行 WHERE 子句时可能尚未确定列值。请参阅第 B.5.4.4 节，“列别名问题”。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-30T15:41:35.190

```
select u_name as user_name from users where u_name = "john"; 
```

可以这样想，您的 where 子句首先评估，以确定需要返回哪些行（或连接行）。一旦执行了 where 子句，select 子句就会为其运行。

说得更好，想象一下：

```
select distinct(u_name) as user_name from users where u_name = "john"; 
```

没有后半部分就不能参考前半部分。where 总是首先被评估，然后是 select 子句。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2011-05-26T11:04:29.073

如果您尝试执行如下查询（查找所有具有至少一个附件的节点），您已使用 SELECT 语句创建数据库中实际不存在的新字段，并尝试使用该结果的别名会遇到同样的问题：

```
SELECT nodes.*, (SELECT (COUNT(*) FROM attachments 
WHERE attachments.nodeid = nodes.id) AS attachmentcount 
FROM nodes
WHERE attachmentcount > 0; 
```

您将收到错误“WHERE 子句中的未知列 'attachmentcount'”。

解决方案实际上相当简单 - 只需将别名替换为生成别名的语句，例如：

```
SELECT nodes.*, (SELECT (COUNT(*) FROM attachments 
WHERE attachments.nodeid = nodes.id) AS attachmentcount 
FROM nodes 
WHERE (SELECT (COUNT(*) FROM attachments WHERE attachments.nodeid = nodes.id) > 0; 
```

您仍然会得到返回的别名，但现在 SQL 不应该在未知别名上出现问题。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2013-07-30T17:28:09.993

您定义的条款`alias`不欢迎`WHERE`您必须为此使用该`HAVING`条款

```
SELECT u_name AS user_name FROM users HAVING user_name = "john"; 
```

或者您可以直接使用原始列名`WHERE`

```
SELECT u_name AS user_name FROM users WHERE u_name = "john"; 
```

由于子查询或任何计算的结果，用户定义的别名中的结果相同，它将由`HAVING`子句访问，而不是由`WHERE`

```
SELECT u_name AS user_name ,
(SELECT last_name FROM users2 WHERE id=users.id) as user_last_name
FROM users  WHERE u_name = "john" HAVING user_last_name ='smith' 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-30T15:41:33.833

任何一个：

```
SELECT u_name AS user_name
FROM   users
WHERE  u_name = "john"; 
```

或者：

```
SELECT user_name
from
(
SELECT u_name AS user_name
FROM   users
)
WHERE  u_name = "john"; 
```

如果 RDBMS 支持将谓词推入内联视图，则后者应该与前者相同。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-30T15:39:50.437

更正：

```
SELECT u_name AS user_name FROM users WHERE u_name = 'john'; 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-30T15:38:50.267

不，您需要使用正确的名称选择它。如果你给了你从别名中选择的表，你可以使用它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-30T15:38:22.763

你不能。user_name 直到返回时间才存在。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-23T08:44:53.427

```
SELECT user_name
FROM
(
SELECT name AS user_name
FROM   users
) AS test
WHERE  user_name = "john" 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-01-28T23:06:49.907

子句中的未知列`WHERE`由第 1 行和第 2 行引起并由第 3 行解决：

1.  `$sql = "SELECT * FROM users WHERE username =".$userName;`
2.  `$sql = "SELECT * FROM users WHERE username =".$userName."";`
3.  `$sql = "SELECT * FROM users WHERE username ='".$userName."'";`

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-11-22T10:59:09.917

可能会有所帮助。

你可以

```
SET @somevar := '';
SELECT @somevar AS user_name FROM users WHERE (@somevar := `u_name`) = "john"; 
```

有用。

但要确保你做什么！

*   此处不使用索引
*   将扫描 FULL TABLE - 您尚未指定 LIMIT 1 部分
*   所以， - 这个查询将在巨大的桌子上 SLLLOOOOOOW。

但是，在某些情况下可能会有所帮助

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T15:41:37.530

虽然您可以在查询中为您的表设置别名（即“SELECT u.username FROM users u;”），但您必须使用您所引用的列的实际名称。AS 仅影响字段的返回方式。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-04-02T15:15:57.520

刚遇到这个问题。

确保数据库中实体的名称中没有空格。

例如“用户名”而不是“用户名”

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2020-01-20T15:10:40.363

对我来说，问题的根源是我复制的一个数字，以便在 WHERE 子句中使用。该数字具有“隐形”符号，至少对于 MySQL Workbench 而言。我将数字放在 Chrome 控制台中，它清晰可见。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2013-01-05T10:05:54.597

我有同样的问题，我发现这很有用。

```
mysql_query("SELECT * FROM `users` WHERE `user_name`='$user'"); 
```

记得将 $user 放在 ' ' 单引号中。

# c# - 创建 MSBuild 自定义任务以修改 C# 代码 *before* 编译

> ID：153602
> 
> 赞同：8
> 
> 时间：2008-09-30T15:38:17.197
> 
> 标签：c#, .net, vb.net, msbuild, build-process

我想创建一个自定义 MSBuild 任务，在 csc.exe 编译它们之前更改我的 .cs 文件（但是，当然，这并没有就地修改它们 - 我不希望触及实际的源文件）。我知道 PostSharp 和其他用于 .NET 的 AOP 框架，它们不是这个特定项目的选项，而且我想学习如何做到这一点。

我必须做些什么才能让它发挥作用？

谢谢理查德

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T15:46:41.107

鉴于您的限制，我认为您可以执行以下操作：

1.  创建接受 cs 文件列表以在编译之前进行调整的自定义任务
2.  自定义任务调整接收到的文件列表并在磁盘上创建它们
3.  自定义任务在输出参数上设置更改文件列表
4.  任务的输出将替换原始的 cs 文件列表
5.  编译是针对更改的文件完成的。

第 4 步确保最终编译的文件是由您的自定义任务更改的文件。

您将严重依赖[ITaskItem](http://msdn.microsoft.com/en-us/library/microsoft.build.framework.itaskitem.aspx)接口来完成这项工作。

# c++ - MPI 还是套接字？

> ID：153616
> 
> 赞同：9
> 
> 时间：2008-09-30T15:40:15.193
> 
> 标签：c++, c, cluster-computing, hpc

我正在为一些数据处理开发一个松散耦合的集群。网络代码和处理代码已经到位，但我们正在评估我们方法中的不同方法。现在，正如我们应该做的那样，我们在性能问题上受到 I/O 的限制，我们正在努力减少这个瓶颈。显然，像 Infiniband 这样更快的交换机会很棒，但我们不能承担仅仅扔掉我们拥有的东西并获得新设备的奢侈。

我提出的问题是这样的。在集群上完成的所有传统和严肃的 HPC 应用程序通常都是通过消息传递而不是直接通过套接字发送来实现的。这有什么性能优势？如果我们从套接字切换，我们应该看到加速吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-30T16:18:58.330

MPI 可能使用套接字。但也有与使用直接分布式共享内存的 SAN（系统区域网络）一起使用的 MPI 实现。当然，如果你有硬件的话。所以 MPI 允许你在未来使用这些资源。在这种情况下，您可以获得巨大的性能改进（根据我在大学时期使用集群的经验，您可以获得几个数量级的收益）。因此，如果您正在编写可以移植到高端集群的代码，那么使用 MPI 是一个非常好的主意。

即使放弃性能问题，使用 MPI 也可以为您节省大量时间，您可以使用这些时间来提高系统其他部分的性能或简单地节省您的理智。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-30T16:02:03.410

我建议使用 MPI 而不是自己滚动，除非你非常擅长那种事情。在使用我自己的协议编写了​​一些分布式计算类应用程序之后，我总是发现自己正在重现（并且重现不佳）在 MPI 中发现的特性。

性能方面，我不希望 MPI 给你任何切实的网络加速——它和你一样使用套接字。然而，MPI 将为您提供管理许多节点所需的许多功能，即节点之间的同步。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-17T20:14:03.817

在这种情况下，性能并不是唯一的考虑因素，即使在高性能集群上也是如此。MPI 提供标准 API，并且是“可移植的”。在不同版本的 MPI 之间切换应用程序相对简单。

大多数 MPI 实现使用套接字进行基于 TCP 的通信。与直接使用套接字的本地应用程序相比，任何给定的 MPI 实现都将得到更好的优化并提供更快的消息传递，这很有可能。

此外，如果您有机会在具有 InfiniBand 的集群上运行您的代码，MPI 层将抽象出任何这些代码更改。这不是一个微不足道的优势 - 编写应用程序以直接使用 OFED（或其他 IB Verbs）实现非常困难。

大多数 MPI 应用程序都包含小型测试应用程序，可用于独立于您的应用程序验证网络设置的正确性。在调试应用程序时，这是一个主要优势。MPI 标准包括“pMPI”接口，用于分析 MPI 调用。此接口还允许您轻松地将校验和或其他数据验证添加到所有消息传递例程。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T17:46:43.610

消息传递是一种范式，而不是一种技术。在最一般的安装中，MPI 将使用套接字进行通信。您可以通过切换到 MPI 看到速度加快，但前提是您尚未优化套接字通信。

您的应用程序 I/O 是如何绑定的？是在将数据块传输到工作节点时绑定，还是因为计算过程中的通信而绑定？

如果答案是“因为通信”，那么问题是您正在编写一个紧密耦合的应用程序并试图在为松散耦合任务设计的集群上运行它。获得性能的唯一方法是获得更好的硬件（更快的交换机、infiniband 等）……也许您可以借用其他人的 HPC 的时间？

如果答案是“数据块”传输，那么考虑为工作人员分配多个数据块（这样他们会更长时间地忙碌）并在传输之前压缩数据块。这是一种有助于松散耦合应用程序的策略。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-19T16:29:03.803

MPI 的好处是您可以进行集体通信。在 O(log p) /* p is your number of processor*/ 而不是 O(p) 中进行广播/减少是一个很大的优势。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T17:40:19.367

我必须同意 OldMan 和自由空间。除非您知道对 MPI 的某些有用指标（性能、可维护性等）的特定和改进，否则为什么要重新发明轮子。MPI 代表了有关您尝试解决的问题的大量共享知识。

您需要解决大量问题，而不仅仅是发送数据。连接设置和维护都将成为您的责任。如果 MPI 是您需要的确切抽象（听起来确实如此），请使用它。

至少，使用 MPI 并随后用您自己的系统对其进行重构是一种减少 MPI 安装和依赖性的好方法。

我特别喜欢 OldMan 的观点，即 MPI 为您提供的不仅仅是简单的套接字通信。您将获得大量具有透明抽象的并行和分布式计算实现。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T16:29:18.057

我没有使用过 MPI，但我使用过很多套接字。在高性能套接字上需要考虑一些事项。你是在做很多小包，还是大包？如果您正在处理许多小数据包，请考虑关闭 Nagle 算法以获得更快的响应：

setsockopt(m_socket, IPPROTO_TCP, TCP_NODELAY, ...);

此外，在尝试获取大量数据时，使用信号实际上会慢得多。很久以前我做了一个测试程序，阅读器会等待一个信号，然后读取一个数据包——它会得到大约 100 个数据包/秒。然后我只是做了阻塞读取，并获得了 10000 次读取/秒。

重点是查看所有这些选项，并实际测试它们。不同的条件将使不同的技术更快/更慢。重要的是不仅要获得意见，还要对它们进行测试。Steve Maguire 在“Writing Solid Code”中谈到了这一点。他使用了许多违反直觉的示例，并对其进行测试以找出使代码更好/更快的原因。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T15:52:55.973

MPI 在下面使用套接字，因此真正唯一的区别应该是您的代码与之交互的 API。如果您直接使用套接字，您可以微调协议，但仅此而已。你到底在用这些数据做什么？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T16:01:23.693

MPI 使用套接字，如果您知道自己在做什么，您可能可以从套接字中获得更多带宽，因为您不需要发送尽可能多的元数据。

但是你必须知道你在做什么，而且它可能更容易出错。本质上，您将用自己的消息传递协议替换 mpi。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T16:09:57.040

对于大容量、低开销的*业务*消息传递，您可能需要查看 带有多个产品的[OAMQ 。](http://amqp.org)开源变体[OpenAMQ](http://www.openamq.org)应该在 JP Morgan 进行交易，所以它应该是可靠的，不是吗？

# c# - 如何在 .NET 中编写调度程序应用程序？

> ID：153617
> 
> 赞同：2
> 
> 时间：2008-09-30T15:40:15.630
> 
> 标签：c#, .net

如何在 C# .NET 中编写调度程序应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T16:23:56.040

你也可以试试[Quartz.Net](http://quartznet.sourceforge.net/index.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T16:47:52.927

编写一个 Windows 服务，MSDN 上有很好的[帮助主题，](http://msdn.microsoft.com/en-us/library/9k985bc9.aspx)关于您需要做什么才能使其可安装等。

接下来，为您的项目添加一个计时器。*不是*Winforms 计时器，它们在 Windows 服务中不起作用。当事件没有触发时，您会注意到这一点。弄清楚你需要的计时器分辨率是多少——换句话说，如果你有计划在午夜开始，如果它在午夜和 12:15 之间的某个时间开始，是否可以？在生产中，您将计时器设置为每 X 分钟触发一次，其中 X 是您负担得起的任何时间。

最后，当我这样做时，我使用一个 Switch 语句和一个枚举来创建一个状态机，该状态机具有“正在启动”、“致命错误”、“计时器已过/扫描待办工作”和“正在工作”等状态。（我将上面的 X 除以二，因为实际工作需要两个 X。）

这可能不是最好的方法，但我已经这样做了好几次了，它对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T15:44:45.230

这完全取决于您的要求：

*   如果您有权访问数据库，则可以将表用作队列，并使用服务定期轮询队列。

*   如果您的应用程序仅是客户端 (CLI)，您可以使用系统调度程序（“Scheduled Tasks”）。

*   最后，如果您的应用程序仅在数据库中（例如使用 SQL Server 2005 中的 CLR），那么您可以创建一个 SQL Server 作业来安排它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T15:54:15.020

假设您正在编写一些需要在特定时钟时间执行操作的系统，以下内容将涵盖引发事件的基本任务。

为要安排的每个事件创建一个 System.Timer（包装在一个包含事件参数的对象中）。通过计算直到事件应该发生的毫秒数来设置计时器。例如：

```
// Set event to occur on October 1st, 2008 at 12:30pm.
DateTime eventStarts = new DateTime(2008,10,1,12,30,00);
Timer timer = new Timer((eventStarts - DateTime.Now).TotalMilliseconds); 
```

由于您没有详细说明，其余的将取决于您；处理 timer.Elapsed 事件以执行您想要的操作，并将应用程序编写为 Windows 服务或独立或其他。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-28T20:50:46.207

您可以尝试使用[Windows 任务计划程序 API](http://msdn.microsoft.com/en-us/library/aa384006(VS.85).aspx)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-30T15:45:19.817

您还可以使用计时器控件让程序在每个 X 滴答声中触发您想要的任何事件，甚至只是一个。最好的解决方案实际上取决于您要完成的工作。

# asp.net-mvc - 如何在 ASP.NET MVC 应用程序中获得“真实”的 HttpContext？

> ID：153630
> 
> 赞同：55
> 
> 时间：2008-09-30T15:41:54.770
> 
> 标签：asp.net-mvc, elmah

不幸的是，我需要这样做。我正在为我的错误日志使用 ELMAH。在我路由到我的 error.aspx 视图之前，我必须获取默认的 ELMAH 错误日志，以便我可以记录异常。你以前可以使用

```
Elmah.ErrorLog.Default 
```

但是，现在已将其标记为已过时。编译器指示我使用该方法

```
Elmah.ErrorLog.GetDefault(HttpContext context) 
```

MVC 的上下文是 HttpContextBase 类型的，这使我们能够模拟它（耶！）。我们如何处理需要旧式 HttpContext 的不支持 MVC 的库？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2008-09-30T15:53:21.183

试试`System.Web.HttpContext.Current`。它应该可以解决问题。

获取有关单个 HTTP 请求的特定于 HTTP 的信息。

[MSDN](https://msdn.microsoft.com/en-us/library/system.web.httpcontext.current%28v=vs.110%29.aspx)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-09-24T04:12:23.693

```
this.HttpContext.ApplicationInstance.Context 
```

# sql - MySQL中的自然排序

> ID：153633
> 
> 赞同：90
> 
> 时间：2008-09-30T15:42:27.857
> 
> 标签：sql, mysql, sorting, natural-sort

有没有一种优雅的方法可以在 MySQL 数据库中进行高效、自然的排序？

例如，如果我有这个数据集：

*   最终幻想
*   最终幻想4
*   最终幻想10
*   最终幻想12
*   最终幻想 12：Promathia 锁链
*   最终幻想冒险
*   最终幻想起源
*   最终幻想战术

除了将游戏名称拆分为组件之外的任何其他**优雅解决方案**

*   *书名*：《最终幻想》
*   *编号*：“12”
*   *副标题*：“Promathia 之链”

以确保它们以正确的顺序出现？（10 在 4 之后，而不是在 2 之前）。

这样做对a**来说是一种痛苦，因为时不时会有另一款游戏打破解析游戏标题的机制（例如“战锤40,000”、“詹姆斯邦德007”）

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2011-06-14T13:15:00.960

这是一个快速的解决方案：

```
SELECT alphanumeric, 
       integer
FROM sorting_test
ORDER BY LENGTH(alphanumeric), alphanumeric 
```

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2009-01-19T16:44:11.527

刚发现这个：

```
SELECT names FROM your_table ORDER BY games + 0 ASC 
```

当数字在前面时进行自然排序，也可能适用于中间。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2012-09-04T06:30:55.137

与@plalx 发布的功能相同，但重写为 MySQL：

```
DROP FUNCTION IF EXISTS `udf_FirstNumberPos`;
DELIMITER ;;
CREATE FUNCTION `udf_FirstNumberPos` (`instring` varchar(4000)) 
RETURNS int
LANGUAGE SQL
DETERMINISTIC
NO SQL
SQL SECURITY INVOKER
BEGIN
    DECLARE position int;
    DECLARE tmp_position int;
    SET position = 5000;
    SET tmp_position = LOCATE('0', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF; 
    SET tmp_position = LOCATE('1', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;
    SET tmp_position = LOCATE('2', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;
    SET tmp_position = LOCATE('3', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;
    SET tmp_position = LOCATE('4', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;
    SET tmp_position = LOCATE('5', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;
    SET tmp_position = LOCATE('6', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;
    SET tmp_position = LOCATE('7', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;
    SET tmp_position = LOCATE('8', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;
    SET tmp_position = LOCATE('9', instring); IF (tmp_position > 0 AND tmp_position < position) THEN SET position = tmp_position; END IF;

    IF (position = 5000) THEN RETURN 0; END IF;
    RETURN position;
END
;;

DROP FUNCTION IF EXISTS `udf_NaturalSortFormat`;
DELIMITER ;;
CREATE FUNCTION `udf_NaturalSortFormat` (`instring` varchar(4000), `numberLength` int, `sameOrderChars` char(50)) 
RETURNS varchar(4000)
LANGUAGE SQL
DETERMINISTIC
NO SQL
SQL SECURITY INVOKER
BEGIN
    DECLARE sortString varchar(4000);
    DECLARE numStartIndex int;
    DECLARE numEndIndex int;
    DECLARE padLength int;
    DECLARE totalPadLength int;
    DECLARE i int;
    DECLARE sameOrderCharsLen int;

    SET totalPadLength = 0;
    SET instring = TRIM(instring);
    SET sortString = instring;
    SET numStartIndex = udf_FirstNumberPos(instring);
    SET numEndIndex = 0;
    SET i = 1;
    SET sameOrderCharsLen = CHAR_LENGTH(sameOrderChars);

    WHILE (i <= sameOrderCharsLen) DO
        SET sortString = REPLACE(sortString, SUBSTRING(sameOrderChars, i, 1), ' ');
        SET i = i + 1;
    END WHILE;

    WHILE (numStartIndex <> 0) DO
        SET numStartIndex = numStartIndex + numEndIndex;
        SET numEndIndex = numStartIndex;

        WHILE (udf_FirstNumberPos(SUBSTRING(instring, numEndIndex, 1)) = 1) DO
            SET numEndIndex = numEndIndex + 1;
        END WHILE;

        SET numEndIndex = numEndIndex - 1;

        SET padLength = numberLength - (numEndIndex + 1 - numStartIndex);

        IF padLength < 0 THEN
            SET padLength = 0;
        END IF;

        SET sortString = INSERT(sortString, numStartIndex + totalPadLength, 0, REPEAT('0', padLength));

        SET totalPadLength = totalPadLength + padLength;
        SET numStartIndex = udf_FirstNumberPos(RIGHT(instring, CHAR_LENGTH(instring) - numEndIndex));
    END WHILE;

    RETURN sortString;
END
;; 
```

用法：

```
SELECT name FROM products ORDER BY udf_NaturalSortFormat(name, 10, ".") 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-09-30T15:44:44.480

我想这就是为什么很多东西都是按发布日期排序的。

一个解决方案可能是在您的表中为“SortKey”创建另一列。这可能是标题的净化版本，它符合您为便于分类或计数器创建的模式。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-04-07T14:52:28.903

我刚才为**MSSQL 2000**编写了这个函数：

```
/**
 * Returns a string formatted for natural sorting. This function is very useful when having to sort alpha-numeric strings.
 *
 * @author Alexandre Potvin Latreille (plalx)
 * @param {nvarchar(4000)} string The formatted string.
 * @param {int} numberLength The length each number should have (including padding). This should be the length of the longest number. Defaults to 10.
 * @param {char(50)} sameOrderChars A list of characters that should have the same order. Ex: '.-/'. Defaults to empty string.
 *
 * @return {nvarchar(4000)} A string for natural sorting.
 * Example of use: 
 * 
 *      SELECT Name FROM TableA ORDER BY Name
 *  TableA (unordered)              TableA (ordered)
 *  ------------                    ------------
 *  ID  Name                    ID  Name
 *  1\.  A1\.                 1\.  A1-1\.       
 *  2\.  A1-1\.                   2\.  A1.
 *  3\.  R1      -->         3\.  R1
 *  4\.  R11                 4\.  R11
 *  5\.  R2                  5\.  R2
 *
 *  
 *  As we can see, humans would expect A1., A1-1., R1, R2, R11 but that's not how SQL is sorting it.
 *  We can use this function to fix this.
 *
 *      SELECT Name FROM TableA ORDER BY dbo.udf_NaturalSortFormat(Name, default, '.-')
 *  TableA (unordered)              TableA (ordered)
 *  ------------                    ------------
 *  ID  Name                    ID  Name
 *  1\.  A1\.                 1\.  A1\.     
 *  2\.  A1-1\.                   2\.  A1-1.
 *  3\.  R1      -->         3\.  R1
 *  4\.  R11                 4\.  R2
 *  5\.  R2                  5\.  R11
 */
CREATE FUNCTION dbo.udf_NaturalSortFormat(
    @string nvarchar(4000),
    @numberLength int = 10,
    @sameOrderChars char(50) = ''
)
RETURNS varchar(4000)
AS
BEGIN
    DECLARE @sortString varchar(4000),
        @numStartIndex int,
        @numEndIndex int,
        @padLength int,
        @totalPadLength int,
        @i int,
        @sameOrderCharsLen int;

    SELECT 
        @totalPadLength = 0,
        @string = RTRIM(LTRIM(@string)),
        @sortString = @string,
        @numStartIndex = PATINDEX('%[0-9]%', @string),
        @numEndIndex = 0,
        @i = 1,
        @sameOrderCharsLen = LEN(@sameOrderChars);

    -- Replace all char that has to have the same order by a space.
    WHILE (@i <= @sameOrderCharsLen)
    BEGIN
        SET @sortString = REPLACE(@sortString, SUBSTRING(@sameOrderChars, @i, 1), ' ');
        SET @i = @i + 1;
    END

    -- Pad numbers with zeros.
    WHILE (@numStartIndex <> 0)
    BEGIN
        SET @numStartIndex = @numStartIndex + @numEndIndex;
        SET @numEndIndex = @numStartIndex;

        WHILE(PATINDEX('[0-9]', SUBSTRING(@string, @numEndIndex, 1)) = 1)
        BEGIN
            SET @numEndIndex = @numEndIndex + 1;
        END

        SET @numEndIndex = @numEndIndex - 1;

        SET @padLength = @numberLength - (@numEndIndex + 1 - @numStartIndex);

        IF @padLength < 0
        BEGIN
            SET @padLength = 0;
        END

        SET @sortString = STUFF(
            @sortString,
            @numStartIndex + @totalPadLength,
            0,
            REPLICATE('0', @padLength)
        );

        SET @totalPadLength = @totalPadLength + @padLength;
        SET @numStartIndex = PATINDEX('%[0-9]%', RIGHT(@string, LEN(@string) - @numEndIndex));
    END

    RETURN @sortString;
END

GO 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-09-30T15:48:35.300

MySQL 不允许这种“自然排序”，因此看起来获得所需内容的最佳方法是按照您上面描述的方式拆分数据设置（单独的 id 字段等），或者失败即，根据数据库中的非标题元素、索引元素（日期、数据库中插入的 id 等）执行排序。

让数据库为您进行排序几乎总是比将大型数据集读入您选择的编程语言并在那里对其进行排序更快，因此，如果您在此处对数据库架构有任何控制权，那么请查看添加如上所述的易于排序的字段，从长远来看，它将为您节省很多麻烦和维护。

[在MySQL 错误](http://bugs.mysql.com/bug.php?id=16348)和[讨论论坛](http://forums.mysql.com/read.php?10,34908,35157,quote=1)上不时出现添加“自然排序”的请求，许多解决方案围绕着剥离数据的特定部分并将它们转换为`ORDER BY`查询的一部分，例如

```
SELECT * FROM table ORDER BY CAST(mid(name, 6, LENGTH(c) -5) AS unsigned) 
```

这种解决方案几乎可以用于上面的最终幻想示例，但不是特别灵活，不太可能干净地扩展到数据集，例如“战锤 40,000”和“詹姆斯邦德 007” .

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2011-06-15T06:07:04.943

所以，虽然我知道你已经找到了一个令人满意的答案，但我在这个问题上苦苦挣扎了一段时间，我们之前已经确定它不能在 SQL 中相当好地完成，我们将不得不在 JSON 上使用 javascript大批。

这是我仅使用 SQL 解决它的方法。希望这对其他人有帮助：

我有以下数据：

```
场景 1
场景 1A
场景 1B
场景 2A
场景 3
...
场景 101
场景 XXA1
场景 XXA2

```

我实际上并没有“铸造”东西，尽管我想这也可能奏效。

我首先替换了数据中不变的部分，在本例中为“场景”，然后做了一个 LPAD 来排列。这似乎可以很好地使 alpha 字符串以及编号的字符串正确排序。

我的`ORDER BY`条款看起来像：

```
ORDER BY LPAD(REPLACE(`table`.`column`,'Scene ',''),10,'0') 
```

显然这对不那么统一的原始问题没有帮助 - 但我想这可能适用于许多其他相关问题，所以把它放在那里。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-30T15:57:22.203

1.  在表中添加排序键（排名）。`ORDER BY rank`

2.  利用“发布日期”列。`ORDER BY release_date`

3.  从 SQL 中提取数据时，让您的对象进行排序，例如，如果提取到 Set 中，则将其设为 TreeSet，并使您的数据模型实现 Comparable 并在此处制定自然排序算法（如果您使用的是插入排序就足够了一种没有集合的语言），因为您将在创建模型并将其插入集合时从 SQL 中逐一读取行）

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-12-05T02:47:01.880

关于 Richard Toth 的最佳回复[https://stackoverflow.com/a/12257917/4052357](https://stackoverflow.com/a/12257917/4052357)

注意包含 2 字节（或更多）字符和数字的 UTF8 编码字符串，例如

```
12 南新宿 
```

使用 MySQL 的`LENGTH()`in`udf_NaturalSortFormat`函数将返回字符串的字节长度并且不正确，而使用`CHAR_LENGTH()`which 将返回正确的字符长度。

在我的情况下，使用`LENGTH()`导致查询永远不会完成并导致 MySQL 100% 的 CPU 使用率

```
DROP FUNCTION IF EXISTS `udf_NaturalSortFormat`;
DELIMITER ;;
CREATE FUNCTION `udf_NaturalSortFormat` (`instring` varchar(4000), `numberLength` int, `sameOrderChars` char(50)) 
RETURNS varchar(4000)
LANGUAGE SQL
DETERMINISTIC
NO SQL
SQL SECURITY INVOKER
BEGIN
    DECLARE sortString varchar(4000);
    DECLARE numStartIndex int;
    DECLARE numEndIndex int;
    DECLARE padLength int;
    DECLARE totalPadLength int;
    DECLARE i int;
    DECLARE sameOrderCharsLen int;

    SET totalPadLength = 0;
    SET instring = TRIM(instring);
    SET sortString = instring;
    SET numStartIndex = udf_FirstNumberPos(instring);
    SET numEndIndex = 0;
    SET i = 1;
    SET sameOrderCharsLen = CHAR_LENGTH(sameOrderChars);

    WHILE (i <= sameOrderCharsLen) DO
        SET sortString = REPLACE(sortString, SUBSTRING(sameOrderChars, i, 1), ' ');
        SET i = i + 1;
    END WHILE;

    WHILE (numStartIndex <> 0) DO
        SET numStartIndex = numStartIndex + numEndIndex;
        SET numEndIndex = numStartIndex;

        WHILE (udf_FirstNumberPos(SUBSTRING(instring, numEndIndex, 1)) = 1) DO
            SET numEndIndex = numEndIndex + 1;
        END WHILE;

        SET numEndIndex = numEndIndex - 1;

        SET padLength = numberLength - (numEndIndex + 1 - numStartIndex);

        IF padLength < 0 THEN
            SET padLength = 0;
        END IF;

        SET sortString = INSERT(sortString, numStartIndex + totalPadLength, 0, REPEAT('0', padLength));

        SET totalPadLength = totalPadLength + padLength;
        SET numStartIndex = udf_FirstNumberPos(RIGHT(instring, CHAR_LENGTH(instring) - numEndIndex));
    END WHILE;

    RETURN sortString;
END
;; 
```

ps 我会将此作为对原件的评论添加，但我没有足够的声誉（还）

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-30T15:54:00.513

另一种选择是在从 mysql 中提取数据后在内存中进行排序。虽然从性能的角度来看它不是最好的选择，但如果你不对巨大的列表进行排序，你应该没问题。

如果您查看 Jeff 的帖子，您会发现大量算法适用于您可能使用的任何语言。 [人类排序：自然排序](https://blog.codinghorror.com/sorting-for-humans-natural-sort-order/)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-02T04:31:08.843

为“排序键”添加一个字段，该字段将所有数字字符串零填充为固定长度，然后对该字段进行排序。

如果您可能有很长的数字字符串，另一种方法是将数字数量（固定宽度，零填充）添加到每个数字字符串。例如，如果连续的数字不超过 99 个，那么对于“Super Blast 10 Ultra”，排序键将为“Super Blast 0210 Ultra”。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2016-06-13T15:16:55.110

**订购：**
0
1
2
10
23
101
205
1000
a
aac
b
casdsadsa
css

**使用此查询：**

```
选择
    列名
从
    表名
订购方式
    column_name REGEXP '^\d*[^\da-z&\.\' \-\"\!\@\#\$\%\^\*\(\)\;\:\\,\?\/ \~\`\|\_\-]' DESC,
    列名 + 0，
    列名；

```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2017-05-04T17:56:31.630

如果您不想重新发明轮子或对大量不起作用的代码感到头疼，只需使用[Drupal Natural Sort](https://www.drupal.org/project/natsort) ...只需运行压缩后的 SQL（MySQL 或 Postgre），就是这样。进行查询时，只需使用以下命令进行排序：

```
... ORDER BY natsort_canon(column_name, 'natural') 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-10-17T12:35:27.323

您还可以以动态方式创建“排序列”：

```
SELECT name, (name = '-') boolDash, (name = '0') boolZero, (name+0 > 0) boolNum 
FROM table 
ORDER BY boolDash DESC, boolZero DESC, boolNum DESC, (name+0), name 
```

这样，您可以创建要排序的组。

在我的查询中，我想要在所有内容前面加上“-”，然后是数字，然后是文本。这可能会导致类似：

```
-
0    
1
2
3
4
5
10
13
19
99
102
Chair
Dog
Table
Windows 
```

这样您就不必在添加数据时以正确的顺序维护排序列。您还可以根据需要更改排序顺序。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-03-07T16:24:42.923

如果您使用的是 PHP，您可以在 php.ini 中进行自然排序。

```
$keys = array();
$values = array();
foreach ($results as $index => $row) {
   $key = $row['name'].'__'.$index; // Add the index to create an unique key.
   $keys[] = $key;
   $values[$key] = $row; 
}
natsort($keys);
$sortedValues = array(); 
foreach($keys as $index) {
  $sortedValues[] = $values[$index]; 
} 
```

我希望 MySQL 会在未来的版本中实现自然排序，但是[功能请求（#1588）](http://bugs.mysql.com/bug.php?id=1588)从 2003 年开始开放，所以我不会屏住呼吸。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-03-02T11:33:19.863

@plaix/Richard Toth/Luke Hoggett 的最佳响应的简化非 udf 版本，仅适用于该字段中的第一个整数，是

```
SELECT name,
LEAST(
    IFNULL(NULLIF(LOCATE('0', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('1', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('2', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('3', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('4', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('5', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('6', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('7', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('8', name), 0), ~0),
    IFNULL(NULLIF(LOCATE('9', name), 0), ~0)
) AS first_int
FROM table
ORDER BY IF(first_int = ~0, name, CONCAT(
    SUBSTR(name, 1, first_int - 1),
    LPAD(CAST(SUBSTR(name, first_int) AS UNSIGNED), LENGTH(~0), '0'),
    SUBSTR(name, first_int + LENGTH(CAST(SUBSTR(name, first_int) AS UNSIGNED)))
)) ASC 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-08-25T16:13:08.203

我尝试了几种解决方案，但实际上它非常简单：

```
SELECT test_column FROM test_table ORDER BY LENGTH(test_column) DESC, test_column DESC

/* 
Result 
--------
value_1
value_2
value_3
value_4
value_5
value_6
value_7
value_8
value_9
value_10
value_11
value_12
value_13
value_14
value_15
...
*/ 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-09-29T10:57:03.920

我在这里（以及重复的问题中）看到的许多其他答案基本上只适用于格式*非常*明确的数据，例如完全是数字的字符串，或者有固定长度的字母前缀。这在一般情况下不起作用。

确实没有任何方法可以在 MySQL 中实现 100% 通用的 nat-sort，因为要做到这一点，您*真正*需要的是一个修改后的*比较函数*，如果/当它遇到时，它会在字符串的字典排序和数字排序之间切换一个号码。这样的代码可以实现任何你想要识别和比较两个字符串中的数字部分的算法。不幸的是，MySQL 中的比较功能是其代码内部的，用户无法更改。

这留下了某种 hack，您尝试为您的字符串创建一个*排序键*，其中数字部分被重新格式化，以便*标准字典排序实际上按照您想要的方式对它们进行排序*。

对于最多位数的普通整数，显而易见的解决方案是简单地用零填充它们，以便它们都是固定宽度。这是 Drupal 插件采用的方法，以及 @plalx / @RichardToth 的解决方案。（@Christian 有一个不同且更复杂的解决方案，但它没有提供我能看到的优势）。

正如@tye 指出的那样，您可以通过为每个数字添加固定数字长度来改进这一点，而不是简单地左填充它。不过，即使考虑到本质上是笨拙的 hack 的局限性，您也可以改进很多。然而，那里似乎没有任何预先构建的解决方案！

例如，关于：

*   加号和减号？+10 对 10 对 -10
*   小数点？8.2、8.5、1.006、.75
*   前导零？020, 030, 00000922
*   千位分隔符？“1,001 只斑点狗”与“1001 只斑点狗”
*   版本号？MariaDB v10.3.18 与 MariaDB v10.3.3
*   很长的数字？103,768,276,592,092,364,859,236,487,687,870,234,598.55

* * *

扩展 @tye 的方法，我创建了一个相当紧凑的 NatSortKey() 存储函数，它将任意字符串转换为 nat-sort 键，并处理所有上述情况，相当有效，并保留总排序 -顺序（没有两个不同的字符串具有比较相等的排序键）。第二个参数可用于限制每个字符串中处理的数字数量（例如，前 10 个数字），可用于确保输出适合给定长度。

**注意：使用此第二个参数的给定值生成的排序键字符串只能针对使用*相同*参数值生成的其他字符串进行排序，否则它们可能无法正确排序！**

您可以直接在订购时使用它，例如

```
SELECT myString FROM myTable ORDER BY NatSortKey(myString,0);  ### 0 means process all numbers - resulting sort key might be quite long for certain inputs 
```

但是为了对大表进行高效排序，最好将排序键预先存储在另一列中（可能带有索引）：

```
INSERT INTO myTable (myString,myStringNSK) VALUES (@theStringValue,NatSortKey(@theStringValue,10)), ...
...
SELECT myString FROM myTable ORDER BY myStringNSK; 
```

* * *

*[理想情况下，您可以通过将键列创建为计算存储列来自动实现这一点，使用类似：*

```
CREATE TABLE myTable (
...
myString varchar(100),
myStringNSK varchar(150) AS (NatSortKey(myString,10)) STORED,
...
KEY (myStringNSK),
...); 
```

*但是目前**MySQL 和 MariaDB 都不允许在计算列中存储函数**，所以很遗憾**你还不能这样做**。]*

* * *

我的功能**只影响数字的排序**。如果您想做其他排序规范化的事情，例如删除所有标点符号，或修剪每一端的空格，或用单个空格替换多空格序列，您可以扩展函数，或者可以在`NatSortKey()`is之前或之后完成应用于您的数据。（我建议`REGEXP_REPLACE()`用于此目的）。

它也有点以盎格鲁为中心，因为我假设“。” 用于小数点，',' 用于千位分隔符，但如果您想要反转，或者如果您希望将其作为参数进行切换，它应该很容易修改。

它可能会以其他方式进一步改进；例如，它目前按绝对值对负数进行排序，因此 -1 在 -2 之前，而不是相反。也无法在为文本保留 ASC 词典排序的同时为数字指定 DESC 排序顺序。这两个问题都可以通过更多的工作来解决；如果/当我有时间时，我会更新代码。

还有许多其他细节需要注意——**包括对您正在使用的追逐和排序规则的一些关键依赖项**——但我已将它们全部放入 SQL 代码中的注释块中。***在您自己使用该功能之前，请仔细阅读此内容！***

所以，这里是代码。如果你发现了一个错误，或者有我没有提到的改进，请在评论中告诉我！

* * *

```
delimiter $$
CREATE DEFINER=CURRENT_USER FUNCTION NatSortKey (s varchar(100), n int) RETURNS varchar(350) DETERMINISTIC
BEGIN
/****
  Converts numbers in the input string s into a format such that sorting results in a nat-sort.
  Numbers of up to 359 digits (before the decimal point, if one is present) are supported.  Sort results are undefined if the input string contains numbers longer than this.
  For n>0, only the first n numbers in the input string will be converted for nat-sort (so strings that differ only after the first n numbers will not nat-sort amongst themselves).
  Total sort-ordering is preserved, i.e. if s1!=s2, then NatSortKey(s1,n)!=NatSortKey(s2,n), for any given n.
  Numbers may contain ',' as a thousands separator, and '.' as a decimal point.  To reverse these (as appropriate for some European locales), the code would require modification.
  Numbers preceded by '+' sort with numbers not preceded with either a '+' or '-' sign.
  Negative numbers (preceded with '-') sort before positive numbers, but are sorted in order of ascending absolute value (so -7 sorts BEFORE -1001).
  Numbers with leading zeros sort after the same number with no (or fewer) leading zeros.
  Decimal-part-only numbers (like .75) are recognised, provided the decimal point is not immediately preceded by either another '.', or by a letter-type character.
  Numbers with thousand separators sort after the same number without them.
  Thousand separators are only recognised in numbers with no leading zeros that don't immediately follow a ',', and when they format the number correctly.
  (When not recognised as a thousand separator, a ',' will instead be treated as separating two distinct numbers).
  Version-number-like sequences consisting of 3 or more numbers separated by '.' are treated as distinct entities, and each component number will be nat-sorted.
  The entire entity will sort after any number beginning with the first component (so e.g. 10.2.1 sorts after both 10 and 10.995, but before 11)
  Note that The first number component in an entity like this is also permitted to contain thousand separators.

  To achieve this, numbers within the input string are prefixed and suffixed according to the following format:
  - The number is prefixed by a 2-digit base-36 number representing its length, excluding leading zeros.  If there is a decimal point, this length only includes the integer part of the number.
  - A 3-character suffix is appended after the number (after the decimals if present).
    - The first character is a space, or a '+' sign if the number was preceded by '+'.  Any preceding '+' sign is also removed from the front of the number.
    - This is followed by a 2-digit base-36 number that encodes the number of leading zeros and whether the number was expressed in comma-separated form (e.g. 1,000,000.25 vs 1000000.25)
    - The value of this 2-digit number is: (number of leading zeros)*2 + (1 if comma-separated, 0 otherwise)
  - For version number sequences, each component number has the prefix in front of it, and the separating dots are removed.
    Then there is a single suffix that consists of a ' ' or '+' character, followed by a pair base-36 digits for each number component in the sequence.

  e.g. here is how some simple sample strings get converted:
  'Foo055' --> 'Foo0255 02'
  'Absolute zero is around -273 centigrade' --> 'Absolute zero is around -03273 00 centigrade'
  'The $1,000,000 prize' --> 'The $071000000 01 prize'
  '+99.74 degrees' --> '0299.74+00 degrees'
  'I have 0 apples' --> 'I have 00 02 apples'
  '.5 is the same value as 0000.5000' --> '00.5 00 is the same value as 00.5000 08'
  'MariaDB v10.3.0018' --> 'MariaDB v02100130218 000004'

  The restriction to numbers of up to 359 digits comes from the fact that the first character of the base-36 prefix MUST be a decimal digit, and so the highest permitted prefix value is '9Z' or 359 decimal.
  The code could be modified to handle longer numbers by increasing the size of (both) the prefix and suffix.
  A higher base could also be used (by replacing CONV() with a custom function), provided that the collation you are using sorts the "digits" of the base in the correct order, starting with 0123456789.
  However, while the maximum number length may be increased this way, note that the technique this function uses is NOT applicable where strings may contain numbers of unlimited length.

  The function definition does not specify the charset or collation to be used for string-type parameters or variables:  The default database charset & collation at the time the function is defined will be used.
  This is to make the function code more portable.  However, there are some important restrictions:

  - Collation is important here only when comparing (or storing) the output value from this function, but it MUST order the characters " +0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ" in that order for the natural sort to work.
    This is true for most collations, but not all of them, e.g. in Lithuanian 'Y' comes before 'J' (according to Wikipedia).
    To adapt the function to work with such collations, replace CONV() in the function code with a custom function that emits "digits" above 9 that are characters ordered according to the collation in use.

  - For efficiency, the function code uses LENGTH() rather than CHAR_LENGTH() to measure the length of strings that consist only of digits 0-9, '.', and ',' characters.
    This works for any single-byte charset, as well as any charset that maps standard ASCII characters to single bytes (such as utf8 or utf8mb4).
    If using a charset that maps these characters to multiple bytes (such as, e.g. utf16 or utf32), you MUST replace all instances of LENGTH() in the function definition with CHAR_LENGTH()

  Length of the output:

  Each number converted adds 5 characters (2 prefix + 3 suffix) to the length of the string. n is the maximum count of numbers to convert;
  This parameter is provided as a means to limit the maximum output length (to input length + 5*n).
  If you do not require the total-ordering property, you could edit the code to use suffixes of 1 character (space or plus) only; this would reduce the maximum output length for any given n.
  Since a string of length L has at most ((L+1) DIV 2) individual numbers in it (every 2nd character a digit), for n<=0 the maximum output length is (inputlength + 5*((inputlength+1) DIV 2))
  So for the current input length of 100, the maximum output length is 350.
  If changing the input length, the output length must be modified according to the above formula.  The DECLARE statements for x,y,r, and suf must also be modified, as the code comments indicate.
****/
  DECLARE x,y varchar(100);            # need to be same length as input s
  DECLARE r varchar(350) DEFAULT '';   # return value:  needs to be same length as return type
  DECLARE suf varchar(101);   # suffix for a number or version string. Must be (((inputlength+1) DIV 2)*2 + 1) chars to support version strings (e.g. '1.2.33.5'), though it's usually just 3 chars. (Max version string e.g. 1.2\. ... .5 has ((length of input + 1) DIV 2) numeric components)
  DECLARE i,j,k int UNSIGNED;
  IF n<=0 THEN SET n := -1; END IF;   # n<=0 means "process all numbers"
  LOOP
    SET i := REGEXP_INSTR(s,'\\d');   # find position of next digit
    IF i=0 OR n=0 THEN RETURN CONCAT(r,s); END IF;   # no more numbers to process -> we're done
    SET n := n-1, suf := ' ';
    IF i>1 THEN
      IF SUBSTRING(s,i-1,1)='.' AND (i=2 OR SUBSTRING(s,i-2,1) RLIKE '[^.\\p{L}\\p{N}\\p{M}\\x{608}\\x{200C}\\x{200D}\\x{2100}-\\x{214F}\\x{24B6}-\\x{24E9}\\x{1F130}-\\x{1F149}\\x{1F150}-\\x{1F169}\\x{1F170}-\\x{1F189}]') AND (SUBSTRING(s,i) NOT RLIKE '^\\d++\\.\\d') THEN SET i:=i-1; END IF;   # Allow decimal number (but not version string) to begin with a '.', provided preceding char is neither another '.', nor a member of the unicode character classes: "Alphabetic", "Letter", "Block=Letterlike Symbols" "Number", "Mark", "Join_Control"
      IF i>1 AND SUBSTRING(s,i-1,1)='+' THEN SET suf := '+', j := i-1; ELSE SET j := i; END IF;   # move any preceding '+' into the suffix, so equal numbers with and without preceding "+" signs sort together
      SET r := CONCAT(r,SUBSTRING(s,1,j-1)); SET s = SUBSTRING(s,i);   # add everything before the number to r and strip it from the start of s; preceding '+' is dropped (not included in either r or s)
    END IF;
    SET x := REGEXP_SUBSTR(s,IF(SUBSTRING(s,1,1) IN ('0','.') OR (SUBSTRING(r,-1)=',' AND suf=' '),'^\\d*+(?:\\.\\d++)*','^(?:[1-9]\\d{0,2}(?:,\\d{3}(?!\\d))++|\\d++)(?:\\.\\d++)*+'));   # capture the number + following decimals (including multiple consecutive '.<digits>' sequences)
    SET s := SUBSTRING(s,LENGTH(x)+1);   # NOTE: LENGTH() can be safely used instead of CHAR_LENGTH() here & below PROVIDED we're using a charset that represents digits, ',' and '.' characters using single bytes (e.g. latin1, utf8)
    SET i := INSTR(x,'.');
    IF i=0 THEN SET y := ''; ELSE SET y := SUBSTRING(x,i); SET x := SUBSTRING(x,1,i-1); END IF;   # move any following decimals into y
    SET i := LENGTH(x);
    SET x := REPLACE(x,',','');
    SET j := LENGTH(x);
    SET x := TRIM(LEADING '0' FROM x);   # strip leading zeros
    SET k := LENGTH(x);
    SET suf := CONCAT(suf,LPAD(CONV(LEAST((j-k)*2,1294) + IF(i=j,0,1),10,36),2,'0'));   # (j-k)*2 + IF(i=j,0,1) = (count of leading zeros)*2 + (1 if there are thousands-separators, 0 otherwise)  Note the first term is bounded to <= base-36 'ZY' as it must fit within 2 characters
    SET i := LOCATE('.',y,2);
    IF i=0 THEN
      SET r := CONCAT(r,LPAD(CONV(LEAST(k,359),10,36),2,'0'),x,y,suf);   # k = count of digits in number, bounded to be <= '9Z' base-36
    ELSE   # encode a version number (like 3.12.707, etc)
      SET r := CONCAT(r,LPAD(CONV(LEAST(k,359),10,36),2,'0'),x);   # k = count of digits in number, bounded to be <= '9Z' base-36
      WHILE LENGTH(y)>0 AND n!=0 DO
        IF i=0 THEN SET x := SUBSTRING(y,2); SET y := ''; ELSE SET x := SUBSTRING(y,2,i-2); SET y := SUBSTRING(y,i); SET i := LOCATE('.',y,2); END IF;
        SET j := LENGTH(x);
        SET x := TRIM(LEADING '0' FROM x);   # strip leading zeros
        SET k := LENGTH(x);
        SET r := CONCAT(r,LPAD(CONV(LEAST(k,359),10,36),2,'0'),x);   # k = count of digits in number, bounded to be <= '9Z' base-36
        SET suf := CONCAT(suf,LPAD(CONV(LEAST((j-k)*2,1294),10,36),2,'0'));   # (j-k)*2 = (count of leading zeros)*2, bounded to fit within 2 base-36 digits
        SET n := n-1;
      END WHILE;
      SET r := CONCAT(r,y,suf);
    END IF;
  END LOOP;
END
$$
delimiter ; 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-09-20T15:21:39.163

其他答案是正确的，但您可能想知道 MariaDB 10.7 会有一个`natural_sort_key()`功能。在撰写本文时，它仅作为预览版提供。[此处](https://mariadb.org/10-7-preview-feature-natural-sort/)解释了该功能。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2011-06-20T07:58:55.437

还有[natsort](http://drupalcode.org/project/natsort.git/tree/refs/heads/5.x-1.x)。它旨在成为[drupal 插件](http://drupal.org/project/natsort)的一部分，但它可以独立工作。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-11-12T21:58:23.083

如果标题只有版本作为数字，这是一个简单的：

```
ORDER BY CAST(REGEXP_REPLACE(title, "[a-zA-Z]+", "") AS INT)'; 
```

否则，如果您使用模式（此模式在版本之前使用 #），则可以使用简单的 SQL：

```
create table titles(title);

insert into titles (title) values 
('Final Fantasy'),
('Final Fantasy #03'),
('Final Fantasy #11'),
('Final Fantasy #10'),
('Final Fantasy #2'),
('Bond 007 ##2'),
('Final Fantasy #01'),
('Bond 007'),
('Final Fantasy #11}');

select REGEXP_REPLACE(title, "#([0-9]+)", "\\1") as title from titles
ORDER BY REGEXP_REPLACE(title, "#[0-9]+", ""),
CAST(REGEXP_REPLACE(title, ".*#([0-9]+).*", "\\1") AS INT);     
+-------------------+
| title             |
+-------------------+
| Bond 007          |
| Bond 007 #2       |
| Final Fantasy     |
| Final Fantasy 01  |
| Final Fantasy 2   |
| Final Fantasy 03  |
| Final Fantasy 10  |
| Final Fantasy 11  |
| Final Fantasy 11} |
+-------------------+
8 rows in set, 2 warnings (0.001 sec) 
```

如果需要，您可以使用其他模式。例如，如果您有电影“我是 #1”和“我是 #1 第 2 部分”，则可以包装版本，例如“最终幻想 {11}”

* * *

## 回答 #22

> 赞同：-4
> 
> 时间：2012-11-12T15:11:34.217

我知道这个话题很古老，但我想我已经找到了一种方法：

```
SELECT * FROM `table` ORDER BY 
CONCAT(
  GREATEST(
    LOCATE('1', name),
    LOCATE('2', name),
    LOCATE('3', name),
    LOCATE('4', name),
    LOCATE('5', name),
    LOCATE('6', name),
    LOCATE('7', name),
    LOCATE('8', name),
    LOCATE('9', name)
   ),
   name
) ASC 
```

报废它，它对以下集合进行了错误的排序（没用的哈哈）：

最终幻想1 最终幻想2 最终幻想5 最终幻想7 最终幻想7：降临之子 最终幻想12 最终幻想112 FF1 FF2

# asp.net - 在异步 WebMethod 调用之后更新 UI

> ID：153639
> 
> 赞同：6
> 
> 时间：2008-09-30T15:43:24.470
> 
> 标签：asp.net, web-services, asp.net-ajax, asynchronous

问候！

我有一个 WebService，它包含一个 WebMethod，它做一些工作并返回一个布尔值。它所做的工作可能需要也可能不需要一些时间，所以我想异步调用它。

```
[WebService(Namespace = "http://tempuri.com/")]
[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
[System.ComponentModel.ToolboxItem(false)]
public class MyWebSvc : System.Web.Services.WebService
{
    [WebMethod]
    public bool DoWork()
    {
        bool succ = false;

        try
        {
            // do some work, which might take a while
        }
        catch (Exception ex)
        {
            // handle
            succ = false; 
        }

        return succ;        
    }
} 
```

此 WebService 存在于 Web 场中的每台服务器上。因此，要在每台服务器上调用 DoWork() 方法，我有一个基于服务器 URL 列表的类库：

```
static public class WebSvcsMgr
{
    static public void DoAllWork(ICollection<string> servers)
    {
        MyWebSvc myWebSvc = new MyWebSvc();

        foreach (string svr_url in servers)
        {
            myWebSvc.Url = svr_url;
            myWebSvc.DoWork();
        }
    }
} 
```

最后，在 asp:Button 点击​​事件中从 Web 界面调用它，如下所示：

```
WebSvcsMgr.DoAllWork(server_list); 
```

对于 Web 窗体调用的静态 DoAllWork() 方法，我计划通过 IAsyncResult 进行异步调用。但是，我想在返回结果时为场中的每台服务器报告 DoWork() WebMethod 的成功/失败。与 UpdatePanel 结合使用的最佳方法是什么？一个网格视图？标签？静态助手类如何将其返回给 Web 表单？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T17:59:20.677

当您需要异步调用 Web 服务方法时，[异步页面非常有用。](http://msdn.microsoft.com/en-us/magazine/cc163725.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T16:28:36.840

条件更新面板中的文字会很好。

```
<asp:UpdatePanel ID="up" runat="server" UpdateMode="Conditional">
   <ContentTemplate>
     <asp:Literal ID="litUpdateMe" runat="server" />
   </ContentTemplate>
</asp:UpdatePanel> 
```

# perl - 为什么在 Perl 中访问数组和哈希元素时需要 $？

> ID：153644
> 
> 赞同：12
> 
> 时间：2008-09-30T15:44:45.400
> 
> 标签：perl, arrays, hash, sigils

既然在 Perl 中数组和散列只能包含标量，为什么在访问数组或散列元素时必须使用 $ 告诉解释器该值是标量？换句话说，假设你有一个 array`@myarray`和一个 hash `%myhash`，你为什么需要这样做：

```
$x = $myarray[1];
$y = $myhash{'foo'}; 
```

而不仅仅是做：

```
$x = myarray[1];
$y = myhash{'foo'}; 
```

为什么上面有歧义？

如果在那个地方不是 $ 的话，那不是非法的 Perl 代码吗？例如，在 Perl 中，以下所有内容不都是非法的吗？

```
@var[0];
@var{'key'};
%var[0];
%var{'key'}; 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-30T16:43:53.217

我刚用过

```
my $x = myarray[1]; 
```

在一个程序中，令我惊讶的是，这是我运行它时发生的事情：

```
$ perl foo.pl 
Flying Butt Monkeys! 
```

那是因为整个程序看起来像这样：

```
$ cat foo.pl 
#!/usr/bin/env perl

use strict;
use warnings;

sub myarray {
  print "Flying Butt Monkeys!\n";
}

my $x = myarray[1]; 
```

因此 myarray 调用一个子例程，将一个对包含单个元素 1 的匿名数组的引用传递给它。

这是您需要阵列访问上的印记的另一个原因。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-30T15:55:35.063

切片并不违法：

```
@slice = @myarray[1, 2, 5];
@slice = @myhash{qw/foo bar baz/}; 
```

我怀疑这是您需要指定是否要从哈希/数组中获取单个值的部分原因。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-30T16:01:44.533

印记为您提供容器的返回类型。因此，如果某些内容以 开头`@`，您就知道它会返回一个列表。如果它以 开头`$`，则返回一个标量。

现在，如果在 sigil 之后只有一个标识符（如`$foo`or `@foo`，那么它是一个简单的变量访问。如果它后面跟着 a `[`，它是对数组的访问，如果它后面跟着 a `{`，它是对哈希的访问。

```
# variables
$foo
@foo

# accesses
$stuff{blubb} # accesses %stuff, returns a scalar
@stuff{@list} # accesses %stuff, returns an array
$stuff[blubb] # accesses @stuff, returns a scalar
              # (and calls the blubb() function)
@stuff[blubb] # accesses @stuff, returns an array 
```

一些人类语言有非常相似的概念。

然而，许多程序员发现这令人困惑，因此 Perl 6 使用了一个不变的印记。

一般来说，Perl 5 编译器希望在编译时知道某些内容是在列表中还是在标量上下文中，因此如果没有前导符号，某些术语会变得模棱两可。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-30T15:59:41.183

这是有效的 Perl: `@var[0]`。它是一个长度为 1 的数组切片。`@var[0,1]`将是长度为 2 的数组切片。

`@var['key']`是无效的 Perl，因为数组只能由数字索引，另外两个 ( `%var[0] and %var['key']`) 是无效的 Perl，因为散列切片使用 {} 来索引散列。

`@var{'key'}`并且`@var{0}`都是有效的哈希片。显然，取长度为 1 的切片是不正常的，但它肯定是有效的。

有关在 Perl 中切片的更多信息，请参阅[perldata perldoc 的切片部分。](http://perldoc.perl.org/perldata.html#Slices)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-30T17:24:20.933

人们已经指出，你可以有切片和上下文，但是符号是用来将变量的东西与其他东西分开的。您不必知道所有的关键字或子程序名称来选择一个合理的变量名称。这是我怀念其他语言中 Perl 的一大优点。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-30T15:50:28.897

我可以想到一种方法

```
$x = myarray[1]; 
```

是模棱两可的——如果你想要一个名为 m 的数组怎么办？

```
$x = m[1]; 
```

除了正则表达式匹配之外，你怎么能分辨出来呢？

换句话说，语法可以帮助 Perl 解释器，好吧，解释！

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-30T17:09:20.377

在 Perl 5（将在 Perl 6 中更改）中，符号指示表达式的*上下文*。

*   你想从哈希中得到一个特定的标量，所以它是`$hash{key}`.
*   您希望从数组中获取特定插槽的值，因此它是`$array[0]`.

但是，正如 zigdon 所指出的，*切片*是合法的。*他们在列表*上下文中解释这些表达式。

*   `@hash{key}`您想要哈希作品中包含 1 个值的列表
*   但也可以使用更大的列表，例如`@hash{qw<key1 key2 ... key_n>}`.

*   你想要一个数组中的几个插槽可以`@array[0,3,5..7,$n..$n+5]`工作

*   `@array[0]`是大小为 1 的列表。

没有“哈希上下文”，因此也`%hash{@keys}`没有`%hash{key}`意义。

所以你有`"@"`+ `"array[0]"`<=> < sigil = context > + < indexing expression > 作为完整的表达式。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-30T16:21:44.470

印记为访问提供了上下文：

*   `$`表示标量上下文（标量变量或散列或数组的单个元素）
*   `@`表示列表上下文（整个数组或散列或数组的一部分）
*   `%`是一个完整的哈希

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-30T18:50:25.237

在 Perl 5 中，您需要符号（$ 和 @），因为裸字标识符的默认解释是子例程调用的解释（因此在大多数情况下无需使用 & ）。

# .net - 自动化 Word Mailmerge 未按预期工作

> ID：153666
> 
> 赞同：2
> 
> 时间：2008-09-30T15:49:59.150
> 
> 标签：.net, automation, ms-word, mailmerge, word-automation

我遇到了一些应该在我们的应用程序中生成字母的邮件合并代码的问题。我知道这段代码目前有点粗糙，但在我们整理之前我们正处于“让某些东西工作”阶段。

现在它应该工作的方式，以及当我们手动执行它时的工作方式，是我们有一个文件（fileOut 变量+“.template”），它是一个字母的模板。我们打开该模板，将其合并，然后将其作为文件名保存在 fileOut 变量中。

但是，它所做的是将模板文件的副本保存到文件输出文件名，而不是合并的输出。

我已经搜索过了，我似乎正在用头撞砖墙。

datafile 是包含合并数据的数据文件。

使用相同的文件，如果您手动执行，这一切都有效。

```
Public Function processFile(ByVal datafile As String, ByVal fileOut As String) As String
    Dim ans As String = String.Empty

    errorLog = "C:\Temp\Template_error.log"

    If (File.Exists(datafile)) Then

        Try

            ' Create an instance of Word  and make it invisible.'

            wrdApp = CreateObject("Word.Application")
            wrdApp.Visible = False

            ' Add a new document.'

            wrdDoc = wrdApp.Documents.Add(fileOut & ".template")
            wrdDoc.Select()

            Dim wrdSelection As Word.Selection
            Dim wrdMailMerge As Word.MailMerge

            wrdDoc.MailMerge.OpenDataSource(datafile)

            wrdSelection = wrdApp.Selection()
            wrdMailMerge = wrdDoc.MailMerge()
            With wrdMailMerge
                .Execute()
            End With

            wrdDoc.SaveAs(fileOut)

            wrdApp.Quit(False)

            ' Release References.'
            wrdSelection = Nothing
            wrdMailMerge = Nothing
            wrdDoc = Nothing
            wrdApp = Nothing

            ans = "Merged OK"

            Call writeToLogFile(errorLog, "This worked, written to  " & fileOut)

        Catch ex As Exception
            ans = "error : exception thrown " & ex.ToString
            Call writeToLogFile(errorLog, ans)
        End Try

    Else
        ans = "error ; unable to open Date File : " & datafile
        If (logErrors) Then
            Call writeToLogFile(errorLog, "The specified source csv file does not exist. Unable " & _
               "to process it. Filename provided: " & datafile)
        End If
    End If

    Return ans

End Function 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T07:00:43.967

我找到了解决方案。合并文档时，它会创建一个包含合并结果的新文档。下面的代码片段解释。

```
wrdDoc = wrdApp.Documents.Add(TemplateFileName)
wrdDoc.Select()
Dim wrdSelection As Word.Selection
Dim wrdMailMerge As Word.MailMerge

wrdDoc.MailMerge.OpenDataSource(DataFileName)

wrdSelection = wrdApp.Selection()
wrdMailMerge = wrdDoc.MailMerge()
With wrdMailMerge
    .Execute()
End With

' This is the wrong thing to do. It just re-saves the template file you opened. '
'wrdDoc.SaveAs(OutputFileName) '

' The resulting merged document is actually stored '
' in the MailMerge object, so you have to save that '
wrdMailMerge.Application.ActiveDocument.SaveAs(OutputFileName)

wrdApp.Quit(False) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T16:15:50.693

我认为问题在于这一行：

```
wrdDoc.MailMerge.OpenDataSource(templateName) 
```

所以*templateName*类似于 'C:\My Template.doc'，对吗？

看起来您提供的是 Word 文档本身的文件路径，而不是链接到“.template”文档的数据源（Excel 或 CSV 文件、Access 表等）。

**尝试**：

```
data = "C:\My Data.xls"
wrdDoc.MailMerge.OpenDataSource(data) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T16:34:05.347

一种作弊方法是在手动执行您提到的所有步骤时录制宏。完成后，将宏调整为更灵活。

这就是我上次在编写自己的宏时无法弄清楚的事情：）

# c++ - C++ Linux GCC 应用程序中的 GUID

> ID：153676
> 
> 赞同：7
> 
> 时间：2008-09-30T15:52:43.993
> 
> 标签：c++, linux, gcc, guid

我有一堆运行这个 Linux 应用程序的服务器。我希望他们能够生成碰撞概率低的 GUID。我确定我可以从 /dev/urandom 中提取 128 个字节，这可能没问题，但是有没有一种简单易行的方法来生成更等同于 Win32 的 GUID？具体来说，一种考虑空间（好吧，MAC地址）、时间和随机性的方法？我不想取消它，我只想要[CreateGuid() 之类的东西](http://msdn.microsoft.com/en-us/library/aa713311.aspx)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T15:58:10.457

这个[Internet Draft](http://www.webdav.org/specs/draft-leach-uuids-guids-01.txt)非常详细地描述了一种类型的 UUID，当我需要 UUID 实现并且由于架构原因无法链接到现有库时，我使用了类似的方法并取得了巨大成功。

本文[提供](http://en.wikipedia.org/wiki/Universally_Unique_Identifier)了一个很好的概述。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T17:02:02.563

有[libuuid](http://linux.die.net/man/3/libuuid)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T15:59:06.600

如果您要使用某些东西，那么 Internet 标准将是一个好主意：
查看 RFC（请求评论）。

我知道特定于 GUID 的一个是： [RFC 4122](http://www.ietf.org/rfc/rfc4122.txt)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-30T17:08:36.603

有一个 Boost 版本可用。

[http://www.boostpro.com/vault/index.php?action=downloadfile&filename=uuid_v11.zip&directory=&PHPSESSID=69e18b945f686398b963710fd52f143a](http://www.boostpro.com/vault/index.php?action=downloadfile&filename=uuid_v11.zip&directory=&PHPSESSID=69e18b945f686398b963710fd52f143a)

# .net - 7-Zip (7za.dll) .NET 包装器

> ID：153678
> 
> 赞同：6
> 
> 时间：2008-09-30T15:52:55.507
> 
> 标签：.net, 7zip

是否有一些代码或库可以让我从 C# 代码中控制[7-Zip解包功能？](http://en.wikipedia.org/wiki/7-Zip)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T14:17:29.907

CodePlex 上有一个项目[SevenZipSharp](http://sevenzipsharp.codeplex.com/)。

我还没有尝试过，但它看起来很有希望。

# c++ - 像 Photoshop CS 一样管理窗口 Z 顺序

> ID：153685
> 
> 赞同：2
> 
> 时间：2008-09-30T15:53:52.307
> 
> 标签：c++, winapi

所以我有一个应用程序，我希望它的窗口行为更像 Photoshop CS。在 Photoshop CS 中，文档窗口始终位于工具窗口之后，但仍然是顶级窗口。对于 MDI 子窗口，由于文档窗口实际上是一个子窗口，因此您不能将其移出主窗口。但是，在 CS 中，您可以将图像移动到不同的监视器上，这比 Visual Studio 等停靠应用程序和常规 MDI 应用程序具有很大优势。

无论如何，这是我到目前为止的研究。我试图拦截 WM_MOUSEACTIVATE 消息，并使用 DeferWindowPos 命令对窗口进行自己的排序，然后返回 MA_NOACTIVATEANDEAT，但这会导致窗口无法正确激活，我相信还有其他命令“激活" 一个没有调用 WM_MOUSEACTIVATE 的窗口（就像我认为的 SetFocus()），所以该方法可能无论如何都行不通。

我相信 Windows“激活”窗口的过程是 1\. 使用 WM_NCACTIVATE 和 WM_ACTIVATE 消息通知未激活的窗口 2\. 将窗口移动到 z 顺序的顶部（发送 WM_POSCHANGING、WM_POSCHANGED 和重绘消息） 3\. 通知带有 WM_NCACTIVATE 和 WM_ACTIVATE 消息的新激活窗口。

似乎最干净的方法是拦截第一条 WM_ACTIVATE 消息，并以某种方式通知 Windows 您将覆盖他们进行 z 排序的方式，然后使用 DeferWindowPos 命令，但我想不通出如何做到这一点。似乎一旦 Windows 发送 WM_ACTIVATE 消息，它就已经按照自己的方式进行重新排序，所以我使用的任何 DeferWindowPos 命令都会被覆盖。

现在我有一个基本的实现准工作，当应用程序被激活时，使工具窗口处于最顶层，但当它不是时，它使它们成为非最顶层，但它非常古怪（它有时会出现在其他窗口之上，如任务管理器，而 Photoshop CS 不这样做，所以我认为 Photoshop 以某种方式做了不同的事情），而且似乎会有一种更直观的方式来做这件事。

无论如何，有谁知道 Photoshop CS 是如何做到的，或者比使用 topmost 更好的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-16T13:44:07.990

我还没有看到 Photoshop CS 有什么值得注意的地方，它要求任何接近这种黑客级别的东西，而不能通过在创建窗口时简单地指定正确的所有者窗口关系来完成。即任何必须在其他窗口上方显示的窗口在创建时都指定该窗口为其所有者 - 如果您有多个文档窗口，每个窗口都有自己的一组拥有的子窗口，您可以在文档窗口获得时动态显示和隐藏并失去激活。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-11-14T15:50:41.120

您可以尝试处理 WM_WINDOWPOSCHANGING 事件以防止与另一个窗口重叠（使用伪最高标志）。因此，您可以避免设置/清除 TopMost 标志的所有问题。

```
public class BaseForm : Form
{
    public virtual int TopMostLevel
    {
        get { return 0; }
    }

    [DllImport("user32.dll")]
    [return: MarshalAs(UnmanagedType.Bool)]
    static extern bool EnumThreadWindows(uint dwThreadId, Win32Callback lpEnumFunc, IntPtr lParam);

    /// <summary>
    /// Get process window handles sorted by z order from top to bottom.
    /// </summary>
    public static IEnumerable<IntPtr> GetWindowsSortedByZOrder()
    {
        List<IntPtr> handles = new List<IntPtr>();
        EnumThreadWindows(GetCurrentThreadId(),
                          (hWnd, lparam) =>
                              {
                                  handles.Add(hWnd);
                                  return true;
                              }, IntPtr.Zero);
        return handles;
    }

    protected override void WndProc(ref Message m)
    {
            if (m.Msg == (int)WindowsMessages.WM_WINDOWPOSCHANGING)
            {
                //Looking for Window at the bottom of Z-order, but with TopMostLevel > this.TopMostLevel
                foreach (IntPtr handle in GetWindowsSortedByZOrder().Reverse())
                {
                    var window = FromHandle(handle) as BaseForm;
                    if (window != null && this.TopMostLevel < window.TopMostLevel)
                    {
                        //changing hwndInsertAfter field in WindowPos structure
                        if (IntPtr.Size == 4)
                        {
                            Marshal.WriteInt32(m.LParam, IntPtr.Size, window.Handle.ToInt32());
                        }
                        else if (IntPtr.Size == 8)
                        {
                            Marshal.WriteInt64(m.LParam, IntPtr.Size, window.Handle.ToInt64());
                        }
                        break;
                    }
                }
            }

        base.WndProc(ref m);
    }
}

public class FormWithLevel1 : BaseForm
{
    public override int TopMostLevel
    {
        get { return 1; }
    }
} 
```

因此，FormWithLevel1 将始终在任何 BaseForm 之上。您可以添加任意数量的 Z 顺序级别。同一级别的 Windows 的行为与往常一样，但始终位于具有 Current+1 级别的 Windows 之下和具有 Current-1 级别的 Windows 之上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T04:15:24.620

对 Photoshop CS 不熟悉，很难确切地知道您想要实现的外观和感觉。

但是我会想，如果您在**工具窗口**中创建了一个无模式对话框窗口并确保它具有**WS_POPUP**样式，那么生成的**工具窗口**将不会被剪辑到主父窗口并且**Windows**会自动管理**z-Order**以确保工具**窗口**停留在父窗口的顶部。

并且由于**工具窗口**对话框是无模式的，它不会干扰主窗口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-16T11:54:08.257

[像 Photoshop CS 一样管理窗口 Z 顺序](https://stackoverflow.com/questions/153685/managing-window-z-order-like-photoshop-cs#160862)

您应该使用图像作为父级创建工具窗口，以便窗口管理 zorder。无需设置 WS_POPUP 或 WS_EX_TOOLWINDOW。这些标志只控制窗口的呈现。

以图像窗口的 hwnd 作为父级调用 CreateWindowEx。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T17:36:19.683

在回复 Chris 和 Emmanuel 时，使用所有者窗口功能的问题是一个窗口只能由另一个窗口拥有，并且您不能更改谁拥有一个窗口。因此，如果工具窗口 A 和 B 始终需要位于文档窗口 C 和 D 之上，那么当文档窗口 C 处于活动状态时，我希望它拥有窗口 A 和 B，以便 A 和 B 始终位于其之上。但是当我激活文档窗口 D 时，我必须将工具窗口 A 和 B 的所有权更改为 D，否则它们将落后于窗口 D（因为它们属于窗口 C）。但是，Windows 不允许您更改窗口的所有权，因此该选项不可用。

现在我已经让它与最顶层的功能一起工作，但它充其量只是一个 hack。我确实得到了一些安慰，因为 GIMP 已经尝试用他们的 2.6 版来模拟 Photoshop，但即使他们的实现偶尔也会表现得古怪，这让我相信他们的实现也是一个 hack。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T01:53:39.720

您是否尝试过在主窗口获得焦点时将工具窗口置于最顶层，而在失去焦点时将其置于非最顶层？听起来您已经开始研究这种解决方案……但要复杂得多。

需要注意的是，工具窗口在 z 排序方面表现出意想不到的行为似乎已经得到了很好的证明。我在 MSDN 上没有找到任何东西来确认它，但可能是 Windows 专门管理它们。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-30T16:03:49.757

我想他们已经，因为他们不使用 .NET，在其存在的多年中推出了自己的窗口代码，现在就像亚马逊的原始[OBIDOS](http://en.wikipedia.org/wiki/Obidos_(software))一样，对他们的产品定制了现成的（又名.NET 的 MDI 支持）只是不会接近。

我不喜欢在没有真正答案的情况下回答，但如果你的目标确实是类似 Photoshop 的**东西，你可能不得不花费大量时间和精力来获得类似的东西。**值得你花时间吗？请记住，*多年来，**许多*程序员和版本齐心协力，使 Photoshop 看似简单的窗口行为能够正常工作并让您感觉自然。

 *看起来您已经不得不深入研究 Win32 API 函数和值，甚至可以瞥见“解决方案”，这应该是您的第一个危险信号。最终可能吗？大概。但是根据您的需求和时间以及许多其他因素，只有您可以决定，这可能不切实际。

# oop - 建模相关对象

> ID：153689
> 
> 赞同：3
> 
> 时间：2008-09-30T15:54:32.320
> 
> 标签：oop, class-design

我正在设计一个处理两组数据的应用程序——用户和区域。数据是从第三方生成的文件中读取的。我有一个用户类和一个区域类，数据被读入一个用户数组和一个区域数组（或其他适当的内存结构，取决于我们采用的技术）。

这两个类都有一个从文件中读取的唯一 ID 成员，并且 User 类包含一组区域 ID，给出一个用户与多个区域相关联的关系。

要求非常简单：

*   用户列表
*   地区列表
*   指定区域用户列表
*   指定用户的区域列表

我的第一个想法是将数据留在两个数组中，然后对于每个要求，有一个单独的方法可以根据需要询问一个或两个数组。这很容易实现，但我不相信它一定是最好的方法。

然后我考虑在 User 类上有一个“Get Areas”方法，在 Area 类上有一个“Get Users”成员，这会更有用，例如，如果我正处于我有一个 Area 对象的阶段，我可以找到它是一个属性的用户，但是 Area 类上的“获取用户”方法如何知道/有权访问用户数组。

我之前遇到过这个问题很多次，但从来没有真正想出一个明确的解决方案。也许我只是让它比实际情况更复杂。任何人都可以提供任何可以帮助我进行此类设计的提示、URL 或书籍吗？

更新：感谢大家花时间留下一些提示。非常感谢您的意见。

我同意这个问题的根源是多对多关系。我了解如何在关系数据库中对其进行建模，这非常简单。

我收到的数据是来自第三方的二进制文件的形式，所以我无法控制这些文件的结构，但我可以在读取时以最好的方式存储它。它有点像圆形的钉子漏洞，但我认为将其读取然后将其存储在数据库中，然后程序将不得不查询数据库以获取结果。这不是大量的数据，所以我认为可以通过将其存储在内存结构中来获取我需要的内容。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T15:58:55.990

这真的是多对多的关系，

```
User <<--->> Area 
```

将其分解为 3 个对象，User、Area 和 UserArea：

```
User: Id, name, etc.
Area: Id, name, etc.
UserArea: UserId, AreaId 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T16:03:26.917

非常基本，但想法是：

```
struct/class Membership
{
   int MemberID;
   int userID;
   int areaID;
} 
```

该类实现了“用户属于区域”的成员资格概念。为集合中的每个成员粘贴其中一个，并在该集合中查询满足您要求的子集。

编辑：另一种选择

您可以在每个成员中存储一个区域列表，并在每个区域中存储一个成员列表。

在地区：

```
public bool addMember(Member m)
{
   if (/*eligibility Requirements*/)
   {
      memberList.add(m);
      m.addArea(this);
      return true;
   }
   return false;
} 
```

和 Member 中的类似实现（没有回调）

这样做的好处是很容易返回一个迭代器来遍历一个区域并找到成员（反之亦然）

缺点是它的耦合非常紧密，这可能会导致未来的问题。

我认为第一个实现对 LINQ 更友好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T15:59:19.033

一个区域是否属于多个用户？如果是，从技术上讲，这是一个多对多的关系。如果要将数据转换为关系数据库，则需要创建一个包含所有关系的表。我想如果你想使用数组，你可以创建第三个数组。或者，如果您确实想以 OO 方式执行此操作，则两个类都应具有指向相关区域/用户的指针数组。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T16:57:01.407

很抱歉，但这不是面向对象的问题。这是一个关系问题。因此，所有对基数的引用（多对多）。这是关系数据库建模101。我不是要批评Gavin，只是要指出一个新的视角。

所以我的咆哮有什么好处。答案应该是与关系数据存储集成，而不是将其融入面向对象的范例中。这是经典的方钉圆孔问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T19:51:58.630

同意 dacracot

另请查看 DevExpress XPO

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T15:57:16.417

如果涉及 .NET，为什么不将 DataTables 与关系一起使用？如果涉及 .NET，您可能还想再次研究泛型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T16:00:44.100

一种选择是为最后两个要求中的每一个使用字典。即 a`Dictionary<Area, List<User>>`和 a `Dictionary<User, List<Area>>`。您可以在读取数据时构建它们。您甚至可以围绕这两个字典包装一个类，并在该类上为每个需求提供一个方法。这将允许您确保字典保持同步。

# mysql - 在 phpmyadmin 中更改默认排序规则

> ID：153706
> 
> 赞同：37
> 
> 时间：2008-09-30T15:58:54.820
> 
> 标签：mysql, phpmyadmin

在我看来，phpMyAdmin 默认使用排序规则 latin1_swedish_ci 导入表，我该如何更改？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-30T16:17:11.877

在您的 Mysql 配置中，更改 [mysqld] 选项卡下的默认字符集。例如：

```
[mysqld]
default-character-set=utf8 
```

之后不要忘记重新启动您的 Mysql 服务器以使更改生效。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2012-07-07T10:21:44.263

**对于 Linux：**

1.  您需要有权访问 MySQL 配置文件。
    位置可能因（用户目录）`/etc/mysql/my.cnf`而异。`~/my.cnf`

2.  在部分中添加以下行`[mysqld]`：

    ```
    collation_server = utf8_unicode_ci
    character_set_server=utf8 
    ```

3.  重启服务器：

    ```
    service mysqld restart 
    ```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-30T16:09:31.940

这不是 phpMyAdmin 问题。

排序规则是最近 MySQL 版本的一部分，您必须设置服务器（或至少数据库）的默认排序规则以更改该行为。

要将已导入的表转换为 UTF-8，您可以执行以下操作（在 PHP 中）：

```
$dbname = 'my_databaseName';
mysql_connect('127.0.0.1', 'root', '');
mysql_query("ALTER DATABASE `$dbname` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci");
$res = mysql_query("SHOW TABLES FROM `$dbname`");
while($row = mysql_fetch_row($res)) {
   $query = "ALTER TABLE {$dbname}.`{$row[0]}` CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci";
   mysql_query($query);
   $query = "ALTER TABLE {$dbname}.`{$row[0]}` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci";
   mysql_query($query);
}
echo 'all tables converted'; 
```

从[这里](http://jonas.elunic.de/blog/index.php/2006/07/26/mysql-datenbank-zu-utf8-konventieren/)获取的代码片段。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-09-02T08:44:32.353

知道这是一个旧帖子。但是我通过 phpMyAdmin 更改默认字符集的方式是：

phpMyadmin 主页 > 变量选项卡（服务器变量和设置） > 搜索“字符”并将所有变量从“latin1”更改为“utf8”。（在使用 phpMyAdmin v. 3.5.7 安装 MAMP 时）

正如其他人所说，这是 MySQL 的变量，而不是某些 phpMyAdmin 特定的变量。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-07-24T16:52:51.783

对于`utf8mb4`，在部分中添加/更改以下`[mysqld]`内容：

```
collation_server = utf8mb4_unicode_ci
character_set_server = utf8mb4 
```

然后重新启动`mysql`服务（对于 Ubuntu，命令是`sudo service mysql restart`）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2018-01-25T07:49:44.760

MySQL DB «更改数据库的[排序规则](https://dev.mysql.com/doc/refman/5.7/en/charset-unicode-sets.html)名称|表`utf8_general_ci`以支持 Unicode。

更改**配置设置**文件也

* * *

XAMPP：`UTF 8 Settings`从配置设置文件中取消注释 «`D:\xampp\mysql\bin\my.ini`

```
## UTF 8 Settings
#init-connect=\'SET NAMES utf8\'
collation_server=utf8_unicode_ci
character_set_server=utf8
skip-character-set-client-handshake
character_sets-dir="D:/xampp/mysql/share/charsets" 
```

* * *

让 MySQL 服务器支持 UTF8 和文件中的以下代码行`my.cnf`

```
## UTF 8 Settings
collation_server=utf8_unicode_ci
character_set_server=utf8 
```

* * *

@看

*   [XAMPP - Apache 虚拟主机设置](https://stackoverflow.com/a/48404726/5081877)
*   [XAMPP 安全概念 - 错误 403,404](https://stackoverflow.com/a/48380154/5081877)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-09-02T17:55:03.243

1.  将此字符串插入`my.ini`（或`my.cnf`）

```
[mysqld]
collation_server = utf8_unicode_ci
character_set_server=utf8 
```

2.  添加到`config.inc.php`

```
$cfg['DefaultConnectionCollation'] = 'utf8_general_ci'; 
```

3.  您需要重新启动**MySQL服务器并删除 cookie、** **PhpMyAdmin**所在域的数据

***   **使用PhpMyAmdin**重新加载页面并查看结果** 

 **[![在此处输入图像描述](https://i.stack.imgur.com/hCHVF.png)](https://i.stack.imgur.com/hCHVF.png)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-01-09T14:23:41.107

我想改用 utf8mb4，配置必须如下：

```
collation_server = utf8mb4_general_ci
character_set_server=utf8mb4 
```

如果 character_set 设置为`utf8`

# c++ - 从 C++ 中的受保护类继承

> ID：153707
> 
> 赞同：3
> 
> 时间：2008-09-30T15:58:55.040
> 
> 标签：c++, inheritance, oop, private

假设我有以下声明：

```
class Over1
{
   protected:
      class Under1
      {
      };
}; 
```

我知道我可以执行以下操作：

```
class Over2 : public Over1
{
   protected:
        class Under2 : public Under1
        {
        };
}; 
```

但是有没有办法在没有 Over2 的情况下声明 Under2？

由于您必须扩展 Over1 以使用 Under1 的任何派生，这可能看起来很愚蠢，但在这种情况下可能有 30 种不同风格的 Under。我可以：

*   将它们全部放在 Over1 中：没有吸引力，因为 Over2 可能只使用其中的 1 或 2 个
*   将它们分别放在各自的 Over 版本中：从那以后就没有吸引力了，您将不得不从几乎同一个类中多次继承。
*   找到一种方法来创建 Under1 的子代而不创建 Over1 的子代

那么这可能吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T16:09:32.720

比创建嵌套类更好，您可能希望将这些类嵌入到命名空间中。这样，您就不需要外部类来获取内部类。[在Google C++ Style Guide](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)中有一些很好的支持和反对的论据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T16:23:31.067

使用模板和显式特化，您只需在 Over1 中添加一个类声明即可做到这一点。

```
class Over1
{
protected:
  class Under1
  {
  };

  template <typename T>
  class UnderImplementor;
};

struct Under2Tag;
struct Under3Tag;
struct Under4Tag;

template <>
class Over1::UnderImplementor<Under2Tag> : public Over1::Under1
{
};

template <>
class Over1::UnderImplementor<Under3Tag> : public Over1::Under1
{
};

template <>
class Over1::UnderImplementor<Under4Tag> : public Over1::Under1
{
}; 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T16:26:05.287

如果你想保护 Under1，那么根据定义，你需要从 Over1 继承来访问它。我建议将 Under1 公开，或者按照 Douglas 的建议使用命名空间。

我现在没有编译器来测试这些，所以我完全不确定这些会起作用，但你可以试试这个：

```
class Over1
{
   protected:
      class Under1
      {
      };

   public:
      class Under1Interface : public Under1 
      {
      };
};

class Under2 : public Over1::Under1Interface
{
}; 
```

或者可能是这样的：

```
class Over1
{
   protected:
      class Under1
      {
      };
};

class Under2 : private Over1, public Over1::Under1
{
}; 
```

甚至：

```
class Under2;

class Over1
{
   friend class Under2;

   protected:
      class Under1
      {
      };
};

class Under2 : public Over1::Under1
{
}; 
```

尽管这会将所有 Over1 的私人信息暴露给 Under2 - 这可能不是您想要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-08T22:53:22.407

对我来说，这听起来像是一个时髦的设计。为什么不尝试以不同的方式构建代码。我认为这可能是装饰器模式的一个很好的候选者，您可以将基类包装在各种装饰器中以实现所需的功能，“under”的各种风格可能是装饰器。只是一个想法，如果不了解代码的意图，很难说清楚。

# visualization - 创建音乐可视化器

> ID：153712
> 
> 赞同：59
> 
> 时间：2008-09-30T15:59:10.063
> 
> 标签：visualization, itunes

那么有人如何创建音乐可视化工具呢？我在谷歌上看过，但我还没有真正找到任何关于实际编程的东西；大多只是指向插件或可视化应用程序的链接。

我使用 iTunes，但我意识到我需要 Xcode 来编程（我目前部署在伊拉克，无法下载那么大的文件）。所以现在我只对学习它背后的“理论”感兴趣，比如处理频率和其他任何需要的东西。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-30T16:17:44.870

当可视化器播放歌曲文件时，它会在非常短的时间片（通常小于 20 毫秒）内读取音频数据。可视化器对每个切片进行傅里叶变换，提取频率分量，并使用频率信息更新视觉显示。

如何响应频率信息更新视觉显示取决于程序员。通常，图形方法必须非常快速和轻量级，以便随着音乐及时更新视觉效果（而不是让 PC 陷入困境）。在早期（现在仍然如此），可视化器经常直接修改 Windows 中的调色板以实现一些非常酷的效果。

基于频率分量的可视化器的一个特点是，它们似乎通常不能很好地响应音乐的“节拍”（例如打击乐）。可以编写更有趣和响应更快的可视化工具，将频域信息与通常对应于打击乐的音频中的“尖峰”意识相结合。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-05-20T13:56:47.353

为了创建 BeatHarness ( [http://www.beatharness.com](http://www.beatharness.com) )，我“简单地”使用 FFT 来获取音频频谱，然后使用一些过滤和边缘/起始检测器。

关于快速傅里叶变换： [http ://en.wikipedia.org/wiki/Fast_Fourier_transform](http://en.wikipedia.org/wiki/Fast_Fourier_transform)

如果您习惯于数学，您可能想阅读 Paul Bourke 的页面： [http ://local.wasp.uwa.edu.au/~pbourke/miscellaneous/dft/](http://local.wasp.uwa.edu.au/~pbourke/miscellaneous/dft/)

（无论如何，Paul Bourke 是一个你想用谷歌搜索的名字，他有很多关于你现在或可能在未来 2 年内想知道的主题的信息；））

如果您想阅读有关 Masataka Goto 的节拍/速度检测 google，他写了一些关于它的有趣论文。

编辑：

他的主页：[http](http://staff.aist.go.jp/m.goto/) ://staff.aist.go.jp/m.goto/ 有趣的阅读：[http ://staff.aist.go.jp/m.goto/PROJ/bts.html](http://staff.aist.go.jp/m.goto/PROJ/bts.html)

一旦你有了一些值，例如低音、中音、高音和音量（左和右），如何处理它们完全取决于你的想象。显示一张图片，例如将尺寸乘以低音 - 你会得到一张放大节拍的图片等。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-30T16:12:15.850

通常，您获取一定数量的音频数据，对其进行频率分析，然后使用该数据修改一些反复显示的图形。进行频率分析的明显方法是使用[FFT](http://en.wikipedia.org/wiki/Fast_Fourier_transform)，但简单的[音调检测](http://www.musicdsp.org/showone.php?id=107)也可以工作，而且计算开销较低。

因此，例如，您编写了一个例程，该例程不断地绘制一系列排列成圆形的形状。然后，您使用主要频率来确定圆圈的颜色，并使用音量来设置大小。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-30T16:35:55.217

处理音频数据的方法有很多种，其中最简单的就是将其显示为快速变化的波形，然后对其应用一些图形效果。类似地，可以计算诸如音量之类的东西（并作为参数传递给某些图形例程），而无需进行快速傅里叶变换来获取频率：只需计算信号的平均幅度即可。

使用 FFT 或其他方式将数据转换到频域可以实现更复杂的效果，包括诸如[频谱图](http://en.wikipedia.org/wiki/Spectrogram)之类的东西。尽管直接从 FFT 输出中检测甚至是非常“明显”的东西，比如鼓声的时间或音符的音高，这看似很棘手

可靠的节拍检测和音调检测是难题，尤其是实时。我不是专家，但[这个页面](http://www.gamedev.net/reference/programming/features/beatdetection/)运行了一些简单的示例算法及其结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T16:22:54.733

1.  给定一组变量，设计一种算法在屏幕上绘制有趣的东西
2.  设计一种将音频流转换为一组变量的方法，以分析诸如节拍/分钟频率、不同频率范围、音调等内容。
3.  将变量插入您的算法并观察它的绘制。

一个简单的可视化将是每次音乐超过某个频率阈值时改变屏幕颜色的可视化。或者只是将 bpm 写到屏幕上。或者只是显示一个示波器。

看看这篇[维基百科文章](http://en.wikipedia.org/wiki/Music_visualization)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-09-21T17:58:44.710

正如@Pragmaticyankee 所建议的那样，处理确实是一种可视化音乐的有趣方式。您可以在 Ableton Live 中加载音乐，并使用 EQ 过滤掉音乐中的高频、中频和低频。然后，您可以使用 VST follwoing 插件将音频包络转换为 MIDI CC 消息，例如 Mokafix Audio 的 Gatefish（适用于 windows）或 PizMidi 的 midiAudioToCC 插件（适用于 mac）。然后，您可以将这些 MIDI CC 消息发送到支持 MIDI 的发光硬件工具，例如 percussa audiocubes。您可以为要显示的每个频率使用一个立方体，并为立方体分配一种颜色。看看这个帖子：

[http://www.percussa.com/2012/08/18/how-do-i-generate-rgb-light-effects-using-audio-signals-featured-question/](http://www.percussa.com/2012/08/18/how-do-i-generate-rgb-light-effects-using-audio-signals-featured-question/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-05-30T11:47:30.510

我们最近在[LightningChart](http://www.LightningChart.com)数据可视化库中添加了基于 DirectSound 的音频数据输入例程。LightningChart SDK 是 Visual Studio .NET（WPF 和 WinForms）的一组组件，您可能会发现它很有用。

使用 AudioInput 组件，您可以从声音设备获取实时波形数据样本。您可以播放来自任何来源的声音，例如 Spotify、WinAmp、CD/DVD 播放器，或使用麦克风输入连接器。

使用 SpectrumCalculator 组件，您可以获得在许多可视化中方便的功率谱（FFT 转换）。

使用 LightningChartUltimate 组件，您可以以多种不同形式可视化数据，如波形图、条形图、热图、频谱图、3D 频谱图、3D 线等，并且可以组合它们。所有渲染都通过 Direct3D 加速进行。

我们自己在 SDK 中的示例具有科学的方法，实际上并没有太多的娱乐性，但它也绝对可以用于很棒的娱乐可视化。

我们还拥有可配置的 SignalGenerator（扫描、多通道配置、正弦波、方波、三角波和噪声波形、WAV 实时流和 DirectX 音频输出组件，用于从扬声器或线路输出发送波形数据。

![波形和 3D 频谱图](https://i.stack.imgur.com/H76AZ.jpg)

![渐变条](https://i.stack.imgur.com/yOnJ3.jpg) [我是 LightningChart 组件的 CTO，做这些只是因为我喜欢它 :-) ]

# java - 在 Java 中验证电子邮件

> ID：153716
> 
> 赞同：33
> 
> 时间：2008-09-30T15:59:46.893
> 
> 标签：java, email, verify

有什么方法可以在 Java 代码中验证电子邮件地址是否有效。有效，我不仅仅意味着它的格式正确（someone@domain.subdomain），而是它是一个真正的活动电子邮件地址。

我几乎可以肯定，没有 100% 可靠的方法可以做到这一点，因为这样的技术将是垃圾邮件发送者的梦想。但也许有一些技术可以提供一些有用的指示来判断地址是否“真实”。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-09-30T16:06:48.220

这是我周围的东西。要检查地址是否是有效格式，这里有一个正则表达式，它验证它几乎是 rfc2822（它没有捕捉到一些奇怪的极端情况）。去年在网上找到的。

```
private static final Pattern rfc2822 = Pattern.compile(
        "^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$"
);

if (!rfc2822.matcher(email).matches()) {
    throw new Exception("Invalid address");
} 
```

这将处理简单的语法（大部分）。我知道的另一项检查将让您检查域是否有 MX 记录。它看起来像这样：

```
Hashtable<String, String> env = new Hashtable<String, String>();

env.put("java.naming.factory.initial", "com.sun.jndi.dns.DnsContextFactory");

DirContext ictx = new InitialDirContext(env);

Attributes attrs = ictx.getAttributes(domainName, new String[] {"MX"});

Attribute attr = attrs.get("MX");

if (attr == null)
    // No MX record
else
    // If attr.size() > 0, there is an MX record 
```

这个，我也是在网上查到的。它来自[这个链接](http://www.rgagnon.com/javadetails/java-0452.html)。

如果这两个都通过，那么您很有可能获得一个有效的地址。至于地址是否是自己的（不仅仅是域），它不是完整的，等等......你真的无法检查。

请注意，第二次检查是**时间密集型**的。它可能需要几毫秒到大于 30 秒的时间（如果 DNS 没有响应并超时）。这不是尝试为大量人实时运行的东西。

希望这可以帮助。

**编辑**

我想指出，至少代替正则表达式，有更好的方法来检查基本有效性。Don 和 Michael 指出 Apache Commons 有一些东西，我最近发现你可以在 InternetAddress 上使用 .validate() 让 Java 检查地址是否真的是 RFC-8222，这肯定比我的正则表达式更准确。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T20:37:43.030

您无法真正验证电子邮件是否存在，请在此处查看我对非常相似问题的回答：[电子邮件 SMTP 验证器](https://stackoverflow.com/questions/27474/email-smtp-validator#27491)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T16:02:19.977

如果不发送电子邮件，可能很难获得 100%，但如果您**在主机上进行 DNS 查找**，至少应该告诉您它是一个可行的目标系统。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-21T15:46:57.487

Apache commons 也提供了一个[电子邮件验证器类](http://commons.apache.org/validator/api-1.3.1/org/apache/commons/validator/EmailValidator.html)，您可以使用它。只需将您的电子邮件地址作为参数传递给 isValid 方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T16:04:24.417

对主机名进行 DNS 查找以查看是否存在。从理论上讲，您也可以启动与邮件服务器的连接，看看它是否告诉您收件人是否存在，但我认为许多服务器假装他们知道一个地址，然后无论如何都会拒绝电子邮件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-20T06:19:59.373

您可以确定的唯一方法是实际发送邮件并阅读。

让您的注册过程有一个步骤，需要回复仅在电子邮件中找到的信息。这就是其他人所做的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-15T21:47:32.313

我不是 100% 确定，但是否可以向邮件服务器发送**RCPT** SMTP 命令以确定收件人是否有效？检查有效的 MX 主机会比上面的建议更昂贵，但它也是最准确的。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-08-20T05:11:34.793

如果您使用 GWT，则不能使用 InternetAddress，而且 MBCook 提供的模式非常可怕。

这是一个不那么可怕的正则表达式（可能不那么准确）：

```
public static boolean isValidEmail(String emailAddress) {
    return emailAddress.contains(" ") == false && emailAddress.matches(".+@.+\\.[a-z]+");
} 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2012-11-08T06:35:44.007

```
public static boolean isValidEmail(String emailAddress) {
    return emailAddress.contains(" ") == false && emailAddress.matches(".+@.+\\.[a-z]+");
} 
```

# google-app-engine - Google App Engine 有哪些替代品？

> ID：153721
> 
> 赞同：48
> 
> 时间：2008-09-30T16:00:54.207
> 
> 标签：google-app-engine, cloud

考虑到我已经有很多我想保留的代码工作，GAE 有什么替代方案。换句话说，我在挖蟒蛇。但是，我的用例更多是请求数量较少、CPU 使用率较高的用例，而且我担心我可能无法永远使用 App Engine。我听到很多人谈论亚马逊网络服务和其他类型的云提供商，但我很难看到大多数其他产品在哪里提供应用程序的服务范围（数据查询、用户身份验证、自动扩展）引擎提供。我在这里有什么选择？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2010-06-04T11:49:04.040

**AppScale**

AppScale 是一个允许用户部署和托管自己的 Google App Engine 应用程序的平台。它在 Amazon EC2 和 Eucalyptus 以及 Xen 和 KVM 上自动执行。它由[AppScale Systems](http://appscale.com)开发和维护。它支持 Python、Go、PHP 和 Java Google App Engine 平台。

[http://github.com/AppScale/appscale](http://github.com/AppScale/appscale)

# 同时...

......它几乎是 2015 年，似乎容器是前进的方式。GAE 的替代品正在出现：

Google 已经发布了[Kubernetes ，这是他们开发的用于](http://kubernetes.io/)[管理 GCE 容器](https://cloud.google.com/compute/docs/containers)的容器调度软件，但也可以在其他集群上使用。

Docker 上有一些[即将推出的 PaaS](http://thenewstack.io/docker-is-driving-a-new-breed-of-paas/)，例如

*   [http://deis.io/](http://deis.io/)
*   [http://www.tsuru.io/](http://www.tsuru.io/)
*   [甚至 Appscale 自己也在支持 Docker](http://www.appscale.com/2013/10/30/appscale-on-docker/)

有趣的东西值得关注。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-01T01:58:20.683

我不认为 GAE 现在有另一种选择（关于代码可移植性），因为 GAE 属于自己的一类。当然 GAE 是云计算，但我认为 GAE 是云计算的一个子集。亚马逊的 EC2 也是云计算（以及 Joyent Accelerators、Slicehost Slices），但显然它们也是两种不同的野兽。所以现在你需要根据你的需要重新考虑你的架构。

GAE 的直接好处是它基本上免维护，因为它与基础设施（可扩展的 Web 服务器和数据库管理）相关。GAE 更适合那些只想专注于他们的应用程序而不是底层系统的开发人员。在某种程度上你可以认为开发人员友好。现在还应该说，这些其他云计算解决方案也试图通过提供 VM 映像/模板，让您只关心您的应用程序。最终，您的需求将决定您应该采取的方法。

现在考虑到所有这些，我们还可以构建混合解决方案和变通办法，也可以满足我们的需求。例如，GAE 似乎并不*直接*适合您描述的这个特定应用程序需求。换句话说，GAE 提供的请求数量相对较多，cpu 周期数量较少（不确定付费版本是否会有所不同）。

然而，解决这一挑战的一种方法是构建一个定制的解决方案，其中将 GAE 作为前端，将 Amazon AWS（EC2、S3 和 SQS）作为后端。有人会说您不妨在 AWS 上构建整个堆栈，但这也可能涉及重写大量现有代码。此外，作为一种解决方法，之前的[stackoverflow 帖子](https://stackoverflow.com/questions/149307/background-tasks-on-appengine)描述了一种在 GAE 中模拟后台任务的方法。此外，您还可以查看[HTTP Map/Reduce](http://code.google.com/p/httpmr/)来分配工作负载。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-11-21T20:42:44.787

截至 2016 年，如果您愿意将[PaaS](https://en.wikipedia.org/wiki/Platform_as_a_service)（平台即服务）和[FaaS](https://en.wikipedia.org/wiki/Function_as_a_Service)（功能即服务）归为同一个[无服务器计算](https://en.wikipedia.org/wiki/Serverless_computing)类别，那么您有一些 FaaS 选项。

## 所有权

### [AWS 拉姆达](https://aws.amazon.com/lambda/)

> AWS Lambda 让您无需预置或管理服务器即可运行代码。您只需为您消耗的计算时间付费 - 当您的代码未运行时不收取任何费用。借助 Lambda，您几乎可以为任何类型的应用程序或后端服务运行代码 - 全部实现零管理。只需上传您的代码，Lambda 就会处理运行和扩展代码所需的一切，并具有高可用性。您可以将代码设置为从其他 AWS 服务自动触发，或直接从任何 Web 或移动应用程序调用它。

**AWS Step Functions**是对 AWS Lambda 的补充。

> AWS Step Functions 可以使用可视化工作流程轻松协调分布式应用程序和微服务的组件。从每个执行离散功能的单个组件构建应用程序可以让您快速扩展和更改应用程序。Step Functions 是一种可靠的方式来协调组件并逐步执行应用程序的功能。Step Functions 提供了一个图形控制台，可将应用程序的组件排列和可视化为一系列步骤。这使得构建和运行多步骤应用程序变得简单。Step Functions 会自动触发和跟踪每个步骤，并在出现错误时重试，以便您的应用程序按预期顺序执行。Step Functions 记录每个步骤的状态，因此当出现问题时，您可以快速诊断和调试问题。

### [谷歌云函数](https://cloud.google.com/functions/)

截至 2016 年，它处于 alpha 阶段。

> Google Cloud Functions 是一种轻量级、基于事件的异步计算解决方案，可让您创建小型、单一用途的函数来响应云事件，而无需管理服务器或运行时环境。来自 Google Cloud Storage 和 Google Cloud Pub/Sub 的事件可以异步触发 Cloud Functions，或者您可以使用 HTTP 调用进行同步执行。

### [Azure 函数](https://functions.azure.com/)

> 基于事件的无服务器计算体验可加速您的开发。它可以根据需求进行扩展，您只需为消耗的资源付费。

## 打开

### [无服务器](https://serverless.com/)

> 无服务器框架允许您将自动扩展、按执行付费、事件驱动的功能部署到任何云。我们目前支持 Amazon Web Service 的 Lambda，并且正在扩展以支持其他云提供商。

### [IronFunctions](http://open.iron.io/)

> IronFunctions 是适用于任何云（私有、公共或混合）的开源无服务器计算平台。

* * *

FaaS 与 CaaS（容器即服务）的竞争程度还有待观察。前者似乎更轻巧。两者似乎都适合微服务架构。

我预计功能（如在 FaaS 中）不是终点，而且多年以后我们将看到进一步的服务抽象，例如仅测试开发，然后是简单语言场景。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-06-15T15:41:07.470

替代方案： 1\. [AppScale](http://www.appscale.com/) 2\. [Heroku](https://www.heroku.com/)。

参考：[Google AppEngine 的替代品？](https://stackoverflow.com/questions/3444911/alternative-for-google-appengine)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T16:03:28.757

Amazon 的 Elastic Compute Cloud 或 EC2 是一个不错的选择。您基本上在他们的服务器上运行 Linux 虚拟机，您可以通过 Web 界面（用于开机和关机）进行控制，当然也可以通过 SSH 或您通常设置的任何方式进行访问……而且由于它是您控制的 linux 安装，您可以如果你愿意，当然可以运行 python。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-06T10:56:48.040

Microsoft Windows Azure 可能值得考虑。恐怕我没用过它，所以不能说它是否有任何好处，你应该记住它目前是一个 CTP。

[在这里查看。](http://www.microsoft.com/azure/services.mspx)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-07-11T03:12:23.997

您可能还想看看[AWS Elastic Beanstalk](http://aws.amazon.com/elasticbeanstalk/) - 它与 GAE 功能更接近，因为它被设计为 PaaS，而不是 IaaS（即 EC2）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-08-11T01:31:46.690

有点晚了，但我会给 Heroku 一个机会：

> Heroku 是一个多语言云应用平台。使用 Heroku，您根本不需要考虑服务器。您可以使用所选编程语言的现代开发实践编写应用程序，并使用 SQL 和 NoSQL 数据库、Memcached 等附加资源来支持它。您使用 Heroku 命令行工具管理您的应用程序，并使用 Git 修订控制系统部署代码，所有这些都在 Heroku 基础架构上运行。

[https://www.heroku.com/about](https://www.heroku.com/about)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-07-16T13:42:55.250

如果您对云感兴趣，并且可能想创建自己的用于生产和/或测试的云，您必须查看[Eucalyptus](http://ostatic.com/blog/eucalyptus-an-unsung-open-source-infrastructure-for-cloud-computing)。据称它的代码与 EC2 兼容但开源。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T21:19:02.570

我更感兴趣的是如何轻松地将 App Engine 与用于 CPU 密集型请求的另一台服务器耦合。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-06-08T18:46:35.910

[TyphoonAE](http://code.google.com/p/typhoonae/)正在尝试这样做。我还没有对其进行测试，但虽然它仍处于测试阶段，但它看起来至少在积极开发中。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-15T15:20:50.773

向云计算的转变发生得如此之快，以至于您没有时间浪费在测试不同的平台上。如果您也对 Java 感兴趣，我建议您尝试[Jelastic 。](http://jelastic.com/)

Jelastic 最大的优点之一是您不需要对应用程序的代码进行任何更改，除了应用程序功能的更改，但不是因为所选平台需要这样做。参考这一点，您实际上并没有浪费您的时间。部署过程完美无缺，您可以将 .war 文件部署到任何地方。使用 GAE 需要您根据系统需求修改应用程序。如果您碰巧开始使用 Java 并开始寻找更灵活的平台，Jelastic 是一个兼容的替代方案。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-04-16T01:08:06.250

您还可以使用 Red Hat 的 Cape Dwarf 项目，在 Wildfly 应用服务器（以前的 JBoss）之上运行 GAE 应用程序而无需修改。

你可以在这里查看：

[http://capedwarf.org/](http://capedwarf.org/)

# java - 如何在Java中将数字四舍五入到n位小数

> ID：153724
> 
> 赞同：1395
> 
> 时间：2008-09-30T16:01:34.613
> 
> 标签：java, decimal, rounding, digits

我想要的是一种将双精度数转换为使用半数方法四舍五入的字符串的方法 - 即，如果要四舍五入的小数是 5，它总是向上舍入到下一个数字。这是大多数人在大多数情况下所期望的标准舍入方法。

我也希望只显示有效数字 - 即不应该有任何尾随零。

我知道这样做的一种方法是使用以下`String.format`方法：

```
String.format("%.5g%n", 0.912385); 
```

返回：

```
0.91239 
```

这很好，但是它总是显示带有 5 位小数的数字，即使它们不重要：

```
String.format("%.5g%n", 0.912300); 
```

返回：

```
0.91230 
```

另一种方法是使用`DecimalFormatter`：

```
DecimalFormat df = new DecimalFormat("#.#####");
df.format(0.912385); 
```

返回：

```
0.91238 
```

但是，如您所见，这使用了半偶数舍入。也就是说，如果前一个数字是偶数，它将向下舍入。我想要的是这样的：

```
0.912385 -> 0.91239
0.912300 -> 0.9123 
```

在 Java 中实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：843
> 
> 时间：2008-09-30T16:14:15.940

使用[`setRoundingMode`](http://docs.oracle.com/javase/8/docs/api/java/text/DecimalFormat.html#setRoundingMode(java.math.RoundingMode))，[`RoundingMode`](http://docs.oracle.com/javase/8/docs/api/java/math/RoundingMode.html)明确设置半偶数轮来处理您的问题，然后将格式模式用于所需的输出。

例子：

```
DecimalFormat df = new DecimalFormat("#.####");
df.setRoundingMode(RoundingMode.CEILING);
for (Number n : Arrays.asList(12, 123.12345, 0.23, 0.1, 2341234.212431324)) {
    Double d = n.doubleValue();
    System.out.println(df.format(d));
} 
```

给出输出：

```
12
123.1235
0.23
0.1
2341234.2125 
```

* * *

**编辑**：原始答案没有解决双精度值的准确性。如果您不太关心它是向上还是向下舍入，那很好。但是，如果您想要精确的舍入，则需要考虑值的预期准确性。浮点值在内部具有二进制表示。这意味着像 2.7735 这样的值实际上在内部并不具有确切的值。它可以稍大或稍小。如果内部值稍小，则不会向上舍入到 2.7740。为了纠正这种情况，您需要了解您正在使用的值的准确性，并在四舍五入之前添加或减去该值。例如，当您知道您的值精确到 6 位时，然后将中间值向上舍入，将该精度添加到值中：

```
Double d = n.doubleValue() + 1e-6; 
```

要向下舍入，请减去准确度。

* * *

## 回答 #2

> 赞同：506
> 
> 时间：2008-09-30T16:07:24.550

假设`value`是`double`，你可以这样做：

```
(double)Math.round(value * 100000d) / 100000d 
```

那是5位数的精度。零的数量表示小数位数。

* * *

## 回答 #3

> 赞同：203
> 
> 时间：2008-09-30T18:33:56.337

```
new BigDecimal(String.valueOf(double)).setScale(yourScale, BigDecimal.ROUND_HALF_UP); 
```

会给你一个`BigDecimal`。要从中取出字符串，只需调用 that`BigDecimal`的`toString`方法，或者`toPlainString`为纯格式字符串调用 Java 5+ 的方法。

示例程序：

```
package trials;
import java.math.BigDecimal;

public class Trials {

    public static void main(String[] args) {
        int yourScale = 10;
        System.out.println(BigDecimal.valueOf(0.42344534534553453453-0.42324534524553453453).setScale(yourScale, BigDecimal.ROUND_HALF_UP));
    } 
```

* * *

## 回答 #4

> 赞同：125
> 
> 时间：2008-09-30T16:58:12.433

您还可以使用

```
DecimalFormat df = new DecimalFormat("#.00000");
df.format(0.912385); 
```

以确保您有尾随的 0。

* * *

## 回答 #5

> 赞同：92
> 
> 时间：2012-10-02T03:18:23.370

正如其他一些人所指出的，正确的答案是使用`DecimalFormat`或`BigDecimal`。浮点没有*小数*位，所以你不可能首先舍入/截断到它们的特定数量。你必须使用十进制基数，这就是这两个类所做的。

我发布以下代码作为此线程中所有答案的反例，实际上整个 StackOverflow（和其他地方）都建议乘法后截断后除法。这项技术的倡导者有责任解释为什么以下代码在超过 92% 的情况下会产生错误的输出。

```
public class RoundingCounterExample
{

    static float roundOff(float x, int position)
    {
        float a = x;
        double temp = Math.pow(10.0, position);
        a *= temp;
        a = Math.round(a);
        return (a / (float)temp);
    }

    public static void main(String[] args)
    {
        float a = roundOff(0.0009434f,3);
        System.out.println("a="+a+" (a % .001)="+(a % 0.001));
        int count = 0, errors = 0;
        for (double x = 0.0; x < 1; x += 0.0001)
        {
            count++;
            double d = x;
            int scale = 2;
            double factor = Math.pow(10, scale);
            d = Math.round(d * factor) / factor;
            if ((d % 0.01) != 0.0)
            {
                System.out.println(d + " " + (d % 0.01));
                errors++;
            }
        }
        System.out.println(count + " trials " + errors + " errors");
    }
} 
```

该程序的输出：

```
10001 trials 9251 errors 
```

**编辑：**`BigDecimal`为了解决下面的一些评论，我使用和为模数操作重新定义了测试循环的模数部分，`new MathContext(16)`如下所示：

```
public static void main(String[] args)
{
    int count = 0, errors = 0;
    int scale = 2;
    double factor = Math.pow(10, scale);
    MathContext mc = new MathContext(16, RoundingMode.DOWN);
    for (double x = 0.0; x < 1; x += 0.0001)
    {
        count++;
        double d = x;
        d = Math.round(d * factor) / factor;
        BigDecimal bd = new BigDecimal(d, mc);
        bd = bd.remainder(new BigDecimal("0.01"), mc);
        if (bd.multiply(BigDecimal.valueOf(100)).remainder(BigDecimal.ONE, mc).compareTo(BigDecimal.ZERO) != 0)
        {
            System.out.println(d + " " + bd);
            errors++;
        }
    }
    System.out.println(count + " trials " + errors + " errors");
} 
```

结果：

```
10001 trials 4401 errors 
```

* * *

## 回答 #6

> 赞同：88
> 
> 时间：2011-01-28T09:52:24.187

假设你有

```
double d = 9232.129394d; 
```

您可以使用[`BigDecimal`](http://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html)

```
BigDecimal bd = new BigDecimal(d).setScale(2, RoundingMode.HALF_EVEN);
d = bd.doubleValue(); 
```

或没有 BigDecimal

```
d = Math.round(d*100)/100.0d; 
```

两种解决方案`d == 9232.13`

* * *

## 回答 #7

> 赞同：64
> 
> 时间：2011-09-29T07:01:59.260

您可以使用 DecimalFormat 类。

```
double d = 3.76628729;

DecimalFormat newFormat = new DecimalFormat("#.##");
double twoDecimal =  Double.valueOf(newFormat.format(d)); 
```

* * *

## 回答 #8

> 赞同：46
> 
> 时间：2009-09-01T11:14:32.770

Real 的 Java How-to[发布](http://www.rgagnon.com/javadetails/java-0016.html)了这个解决方案，它也兼容 Java 1.6 之前的版本。

```
BigDecimal bd = new BigDecimal(Double.toString(d));
bd = bd.setScale(decimalPlace, BigDecimal.ROUND_HALF_UP);
return bd.doubleValue(); 
```

### 更新： BigDecimal.ROUND_HALF_UP 已弃用 - 使用 RoundingMode

```
BigDecimal bd = new BigDecimal(Double.toString(number));
bd = bd.setScale(decimalPlaces, RoundingMode.HALF_UP);
return bd.doubleValue(); 
```

* * *

## 回答 #9

> 赞同：32
> 
> 时间：2008-09-30T16:09:26.840

```
double myNum = .912385;
int precision = 10000; //keep 4 digits
myNum= Math.floor(myNum * precision +.5)/precision; 
```

* * *

## 回答 #10

> 赞同：31
> 
> 时间：2011-07-03T15:50:51.653

@Milhous：四舍五入的十进制格式非常好：

> 您还可以使用
> 
> ```
> DecimalFormat df = new DecimalFormat("#.00000");
> df.format(0.912385); 
> ```
> 
> 以确保您有尾随的 0。

我要补充一点，这种方法非常擅长提供实际的数字舍入机制——不仅在视觉上，而且在处理时也是如此。

假设：您必须在 GUI 程序中实现舍入机制。要更改结果输出的准确度/精度，只需更改插入符号格式（即在括号内）。以便：

```
DecimalFormat df = new DecimalFormat("#0.######");
df.format(0.912385); 
```

将作为输出返回：`0.912385`

```
DecimalFormat df = new DecimalFormat("#0.#####");
df.format(0.912385); 
```

将作为输出返回：`0.91239`

```
DecimalFormat df = new DecimalFormat("#0.####");
df.format(0.912385); 
```

将作为输出返回：`0.9124`

[编辑：如果插入符号格式是这样的（“#0.############”）并且您输入小数点，例如 3.1415926，为了论证，DecimalFormat 不会产生任何垃圾（例如尾随零）并将返回： `3.1415926`.. 如果您有这种倾向。诚然，对于某些开发人员来说，这有点冗长——但是，嘿，它在处理过程中占用的内存很少，而且很容易实现。]

所以本质上，DecimalFormat 的美妙之处在于它同时处理字符串的外观——以及设置的舍入精度级别。尔格：以一个代码实现的价格，您可以获得两个好处。;)

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2015-08-15T15:09:34.647

如果您希望结果为字符串，以下是您可以使用的摘要：

1.  [DecimalFormat#setRoundingMode()](http://docs.oracle.com/javase/6/docs/api/java/text/DecimalFormat.html#setRoundingMode%28java.math.RoundingMode%29)：

    ```
    DecimalFormat df = new DecimalFormat("#.#####");
    df.setRoundingMode(RoundingMode.HALF_UP);
    String str1 = df.format(0.912385)); // 0.91239 
    ```

2.  [BigDecimal#setScale()](http://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html#setScale(int,%20java.math.RoundingMode))

    ```
    String str2 = new BigDecimal(0.912385)
        .setScale(5, BigDecimal.ROUND_HALF_UP)
        .toString(); 
    ```

如果您愿意，这里是您可以使用哪些库的建议`double`。不过，我不建议将它用于字符串转换，因为 double 可能无法准确表示您想要的内容（参见例如[此处](https://stackoverflow.com/q/3730019/2032064)）：

1.  来自 Apache Commons Math 的[精度](http://commons.apache.org/proper/commons-math/javadocs/api-3.5/org/apache/commons/math3/util/Precision.html)

    ```
    double rounded = Precision.round(0.912385, 5, BigDecimal.ROUND_HALF_UP); 
    ```

2.  Colt 的[函数](http://dst.lbl.gov/ACSSoftware/colt/api/cern/jet/math/Functions.html)

    ```
    double rounded = Functions.round(0.00001).apply(0.912385) 
    ```

3.  来自 Weka 的[实用程序](http://weka.sourceforge.net/doc.stable/weka/core/Utils.html#roundDouble(double,%20int))

    ```
    double rounded = Utils.roundDouble(0.912385, 5) 
    ```

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2011-04-27T15:56:25.130

您可以使用以下实用程序方法 -

```
public static double round(double valueToRound, int numberOfDecimalPlaces)
{
    double multipicationFactor = Math.pow(10, numberOfDecimalPlaces);
    double interestedInZeroDPs = valueToRound * multipicationFactor;
    return Math.round(interestedInZeroDPs) / multipicationFactor;
} 
```

* * *

## 回答 #13

> 赞同：16
> 
> 时间：2017-07-27T13:36:33.137

一个简洁的解决方案：

```
 public static double round(double value, int precision) {
      int scale = (int) Math.pow(10, precision);
      return (double) (Math.round(value * scale) / scale);
  } 
```

另请参阅[https://stackoverflow.com/a/22186845/212950](https://stackoverflow.com/a/22186845/212950) 感谢[jpdymond](https://stackoverflow.com/users/2984077/jpdymond)提供此功能。

**编辑**：添加了圆括号。将整个结果转换为双倍，而不仅仅是第一个参数！

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2014-07-22T09:49:35.497

您可以使用 BigDecimal

```
BigDecimal value = new BigDecimal("2.3");
value = value.setScale(0, RoundingMode.UP);
BigDecimal value1 = new BigDecimal("-2.3");
value1 = value1.setScale(0, RoundingMode.UP);
System.out.println(value + "n" + value1); 
```

参考：[http ://www.javabeat.net/precise-rounding-of-decimals-using-rounding-mode-enumeration/](http://www.javabeat.net/precise-rounding-of-decimals-using-rounding-mode-enumeration/)

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2011-07-04T09:10:41.860

如果您确实需要十进制数进行计算（而不仅仅是输出），请不要使用基于二进制的浮点格式，如 double。

```
Use BigDecimal or any other decimal-based format. 
```

我确实使用 BigDecimal 进行计算，但请记住它取决于您正在处理的数字的大小。在我的大多数实现中，我发现从 double 或 integer 解析到 Long 足以进行非常大的数字计算。

事实上，我最近使用 parsed-to-Long 在 GUI 中为 ################## 的数字获得准确的表示（而不是十六进制结果） ############### 个字符（例如）。

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2018-03-14T17:40:39.697

为了实现这一点，我们可以使用这个格式化程序：

```
 DecimalFormat df = new DecimalFormat("#.00");
 String resultado = df.format(valor) 
```

或者：

```
DecimalFormat df = new DecimalFormat("0.00"); : 
```

使用此方法始终获得两位小数：

```
 private static String getTwoDecimals(double value){
      DecimalFormat df = new DecimalFormat("0.00"); 
      return df.format(value);
    } 
```

* * *

定义这个值：

```
91.32
5.22
11.5
1.2
2.6 
```

使用方法我们可以得到这样的结果：

```
91.32
5.22
11.50
1.20
2.60 
```

[**在线演示。**](https://www.ideone.com/jJGyRa)

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2014-02-20T05:04:07.780

试试这个：org.apache.commons.math3.util.Precision.round(double x, int scale)

请参阅：[http ://commons.apache.org/proper/commons-math/apidocs/org/apache/commons/math3/util/Precision.html](http://commons.apache.org/proper/commons-math/apidocs/org/apache/commons/math3/util/Precision.html)

Apache Commons 数学库主页是：[http ://commons.apache.org/proper/commons-math/index.html](http://commons.apache.org/proper/commons-math/index.html)

该方法的内部实现是：

```
public static double round(double x, int scale) {
    return round(x, scale, BigDecimal.ROUND_HALF_UP);
}

public static double round(double x, int scale, int roundingMethod) {
    try {
        return (new BigDecimal
               (Double.toString(x))
               .setScale(scale, roundingMethod))
               .doubleValue();
    } catch (NumberFormatException ex) {
        if (Double.isInfinite(x)) {
            return x;
        } else {
            return Double.NaN;
        }
    }
} 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2016-11-10T07:50:39.900

由于我没有找到关于这个主题的完整答案，所以我整理了一个应该正确处理这个问题的类，并支持：

*   **格式化**：轻松将双精度格式化为具有一定小数位数的字符串
*   **解析**：将格式化的值解析回双倍
*   **语言环境**：使用默认语言环境进行格式化和解析
*   **指数表示法**：在某个阈值后开始使用指数表示法

**用法很简单**：

（为了这个例子，我使用自定义语言环境）

```
public static final int DECIMAL_PLACES = 2;

NumberFormatter formatter = new NumberFormatter(DECIMAL_PLACES);

String value = formatter.format(9.319); // "9,32"
String value2 = formatter.format(0.0000005); // "5,00E-7"
String value3 = formatter.format(1324134123); // "1,32E9"

double parsedValue1 = formatter.parse("0,4E-2", 0); // 0.004
double parsedValue2 = formatter.parse("0,002", 0); // 0.002
double parsedValue3 = formatter.parse("3423,12345", 0); // 3423.12345 
```

**这是课程**：

```
import java.math.RoundingMode;
import java.text.DecimalFormat;
import java.text.DecimalFormatSymbols;
import java.text.ParseException;
import java.util.Locale;

public class NumberFormatter {

    private static final String SYMBOL_INFINITE           = "\u221e";
    private static final char   SYMBOL_MINUS              = '-';
    private static final char   SYMBOL_ZERO               = '0';
    private static final int    DECIMAL_LEADING_GROUPS    = 10;
    private static final int    EXPONENTIAL_INT_THRESHOLD = 1000000000; // After this value switch to exponential notation
    private static final double EXPONENTIAL_DEC_THRESHOLD = 0.0001; // Below this value switch to exponential notation

    private DecimalFormat decimalFormat;
    private DecimalFormat decimalFormatLong;
    private DecimalFormat exponentialFormat;

    private char groupSeparator;

    public NumberFormatter(int decimalPlaces) {
        configureDecimalPlaces(decimalPlaces);
    }

    public void configureDecimalPlaces(int decimalPlaces) {
        if (decimalPlaces <= 0) {
            throw new IllegalArgumentException("Invalid decimal places");
        }

        DecimalFormatSymbols separators = new DecimalFormatSymbols(Locale.getDefault());
        separators.setMinusSign(SYMBOL_MINUS);
        separators.setZeroDigit(SYMBOL_ZERO);

        groupSeparator = separators.getGroupingSeparator();

        StringBuilder decimal = new StringBuilder();
        StringBuilder exponential = new StringBuilder("0.");

        for (int i = 0; i < DECIMAL_LEADING_GROUPS; i++) {
            decimal.append("###").append(i == DECIMAL_LEADING_GROUPS - 1 ? "." : ",");
        }

        for (int i = 0; i < decimalPlaces; i++) {
            decimal.append("#");
            exponential.append("0");
        }

        exponential.append("E0");

        decimalFormat = new DecimalFormat(decimal.toString(), separators);
        decimalFormatLong = new DecimalFormat(decimal.append("####").toString(), separators);
        exponentialFormat = new DecimalFormat(exponential.toString(), separators);

        decimalFormat.setRoundingMode(RoundingMode.HALF_UP);
        decimalFormatLong.setRoundingMode(RoundingMode.HALF_UP);
        exponentialFormat.setRoundingMode(RoundingMode.HALF_UP);
    }

    public String format(double value) {
        String result;
        if (Double.isNaN(value)) {
            result = "";
        } else if (Double.isInfinite(value)) {
            result = String.valueOf(SYMBOL_INFINITE);
        } else {
            double absValue = Math.abs(value);
            if (absValue >= 1) {
                if (absValue >= EXPONENTIAL_INT_THRESHOLD) {
                    value = Math.floor(value);
                    result = exponentialFormat.format(value);
                } else {
                    result = decimalFormat.format(value);
                }
            } else if (absValue < 1 && absValue > 0) {
                if (absValue >= EXPONENTIAL_DEC_THRESHOLD) {
                    result = decimalFormat.format(value);
                    if (result.equalsIgnoreCase("0")) {
                        result = decimalFormatLong.format(value);
                    }
                } else {
                    result = exponentialFormat.format(value);
                }
            } else {
                result = "0";
            }
        }
        return result;
    }

    public String formatWithoutGroupSeparators(double value) {
        return removeGroupSeparators(format(value));
    }

    public double parse(String value, double defValue) {
        try {
            return decimalFormat.parse(value).doubleValue();
        } catch (ParseException e) {
            e.printStackTrace();
        }
        return defValue;
    }

    private String removeGroupSeparators(String number) {
        return number.replace(String.valueOf(groupSeparator), "");
    }

} 
```

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2015-11-05T12:54:46.600

我同意使用`DecimalFormat`--- 或替代选择的答案`BigDecimal`。

请先阅读下面的**更新**！

~~但是，如果您*确实*想对双精度值进行四舍五入并获得`double`值结果，则可以`org.apache.commons.math3.util.Precision.round(..)`如上所述使用。实现使用`BigDecimal`, 很慢并且会产生垃圾。~~

~~`DoubleRounder`该实用程序在 decimal4j 库中提供了一种类似但快速且无垃圾的方法：~~

```
 double a = DoubleRounder.round(2.0/3.0, 3);
 double b = DoubleRounder.round(2.0/3.0, 3, RoundingMode.DOWN);
 double c = DoubleRounder.round(1000.0d, 17);
 double d = DoubleRounder.round(90080070060.1d, 9);
 System.out.println(a);
 System.out.println(b);
 System.out.println(c);
 System.out.println(d); 
```

将输出

```
 0.667
 0.666
 1000.0
 9.00800700601E10 
```

见 [https://github.com/tools4j/decimal4j/wiki/DoubleRounder-Utility](https://github.com/tools4j/decimal4j/wiki/DoubleRounder-Utility)

*披露：*我参与了 decimal4j 项目。

**更新：** 正如@iaforek 指出的那样，DoubleRounder 有时会返回违反直觉的结果。原因是它执行数学上正确的舍入。例如`DoubleRounder.round(256.025d, 2)`，将向下舍入为 256.02，因为表示为 256.025d 的双精度值略小于有理值 256.025，因此将向下舍入。

**笔记：**

*   此行为与构造函数的行为非常相似`BigDecimal(double)`（但与`valueOf(double)`使用字符串构造函数的行为不同）。
*   这个问题可以先通过双舍入到更高的精度来规避，但它很复杂，我在这里不再赘述

由于这些原因以及本文上面提到的所有内容，我**不建议使用 DoubleRounder**。

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2016-03-03T11:43:00.023

以防万一有人仍然需要帮助。这个解决方案非常适合我。

```
private String withNoTrailingZeros(final double value, final int nrOfDecimals) {
return new BigDecimal(String.valueOf(value)).setScale(nrOfDecimals,  BigDecimal.ROUND_HALF_UP).stripTrailingZeros().toPlainString();

} 
```

返回 `String` 具有所需输出的 ​​a。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2017-02-20T14:42:47.630

我来这里只是想要一个关于如何舍入数字的简单答案。这是提供这一点的补充答案。

# 如何在 Java 中对数字进行四舍五入

最常见的情况是使用`Math.round()`.

```
Math.round(3.7) // 4 
```

数字四舍五入到最接近的整数。一个`.5`值被四舍五入。如果您需要不同的舍入行为，则可以使用其他[数学](http://docs.oracle.com/javase/6/docs/api/java/lang/Math.html)函数之一。请参阅下面的比较。

# [圆形的](http://docs.oracle.com/javase/6/docs/api/java/lang/Math.html#round(float))

如上所述，这会四舍五入到最接近的整数。`.5`小数四舍五入。此方法返回一个`int`.

```
Math.round(3.0); // 3
Math.round(3.1); // 3
Math.round(3.5); // 4
Math.round(3.9); // 4

Math.round(-3.0); // -3
Math.round(-3.1); // -3
Math.round(-3.5); // -3 *** careful here ***
Math.round(-3.9); // -4 
```

# [细胞](http://docs.oracle.com/javase/6/docs/api/java/lang/Math.html#ceil(double))

任何十进制值都会向上舍入到下一个整数。它达到了**天花板**。此方法返回一个`double`.

```
Math.ceil(3.0); // 3.0
Math.ceil(3.1); // 4.0
Math.ceil(3.5); // 4.0
Math.ceil(3.9); // 4.0

Math.ceil(-3.0); // -3.0
Math.ceil(-3.1); // -3.0
Math.ceil(-3.5); // -3.0
Math.ceil(-3.9); // -3.0 
```

# [地面](http://docs.oracle.com/javase/6/docs/api/java/lang/Math.html#floor(double))

任何十进制值都会向下舍入到下一个整数。此方法返回一个`double`.

```
Math.floor(3.0); // 3.0
Math.floor(3.1); // 3.0
Math.floor(3.5); // 3.0
Math.floor(3.9); // 3.0

Math.floor(-3.0); // -3.0
Math.floor(-3.1); // -4.0
Math.floor(-3.5); // -4.0
Math.floor(-3.9); // -4.0 
```

# [林特](http://docs.oracle.com/javase/6/docs/api/java/lang/Math.html#rint(double))

这类似于四舍五入，因为十进制值四舍五入到最接近的整数。但是，与 不同的是`round`，`.5`值四舍五入为偶数。此方法返回一个`double`.

```
Math.rint(3.0); // 3.0
Math.rint(3.1); // 3.0
Math.rint(3.5); // 4.0 ***
Math.rint(3.9); // 4.0
Math.rint(4.5); // 4.0 ***
Math.rint(5.5); // 6.0 ***

Math.rint(-3.0); // -3.0
Math.rint(-3.1); // -3.0
Math.rint(-3.5); // -4.0 ***
Math.rint(-3.9); // -4.0
Math.rint(-4.5); // -4.0 ***
Math.rint(-5.5); // -6.0 *** 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2018-01-07T07:10:46.997

如果您使用的是具有最小 JDK 的技术。这是一种没有任何 Java 库的方法：

```
double scale = 100000;    
double myVal = 0.912385;
double rounded = (int)((myVal * scale) + 0.5d) / scale; 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2018-02-13T10:37:22.710

这是一个更好的函数，可以`1.005`正确地舍入边缘情况。

简单地说，我们在四舍五入之前将可能的最小浮点值（= 1 ulp；最后一个单位）添加到数字中。这将移动到数字之后的下一个可表示值，远离零。

这是一个测试它的小程序：[ideone.com](https://ideone.com/TnTOic)

```
/**
 * Round half away from zero ('commercial' rounding)
 * Uses correction to offset floating-point inaccuracies.
 * Works symmetrically for positive and negative numbers.
 */
public static double round(double num, int digits) {

    // epsilon correction
    double n = Double.longBitsToDouble(Double.doubleToLongBits(num) + 1);
    double p = Math.pow(10, digits);
    return Math.round(n * p) / p;
}

// test rounding of half
System.out.println(round(0.5, 0));   // 1
System.out.println(round(-0.5, 0));  // -1

// testing edge cases
System.out.println(round(1.005, 2));   // 1.01
System.out.println(round(2.175, 2));   // 2.18
System.out.println(round(5.015, 2));   // 5.02

System.out.println(round(-1.005, 2));  // -1.01
System.out.println(round(-2.175, 2));  // -2.18
System.out.println(round(-5.015, 2));  // -5.02 
```

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2019-10-25T20:07:49.337

因此，在阅读了大部分答案后，我意识到大多数答案都不精确，实际上使用`BigDecimal`似乎是最好的选择，但如果您不了解其`RoundingMode`工作原理，您将不可避免地失去精度。我在项目中处理大数字时发现了这一点，并认为它可以帮助其他在四舍五入时遇到问题的人。例如。

```
BigDecimal bd = new BigDecimal("1363.2749");
bd = bd.setScale(2, RoundingMode.HALF_UP);
System.out.println(bd.doubleValue()); 
```

你会期望得到`1363.28`作为输出，但`1363.27`如果你不知道它在`RoundingMode`做什么，你最终会得到 ，这是不期望的。因此，查看[Oracle 文档](https://docs.oracle.com/javase/7/docs/api/java/math/RoundingMode.html)，您会发现以下描述`RoundingMode.HALF_UP`。

> 舍入模式向“最近的邻居”舍入，除非两个邻居是等距的，在这种情况下向上舍入。

所以知道了这一点，我们意识到我们不会得到精确的四舍五入，除非我们想向*最近的邻居*四舍五入。因此，为了完成足够的回合，我们需要从小数循环到`n-1`所需的小数位数。例如。

```
private double round(double value, int places) throws IllegalArgumentException {

    if (places < 0) throw new IllegalArgumentException();

    // Cast the number to a String and then separate the decimals.
    String stringValue = Double.toString(value);
    String decimals = stringValue.split("\\.")[1];

    // Round all the way to the desired number.
    BigDecimal bd = new BigDecimal(stringValue);
    for (int i = decimals.length()-1; i >= places; i--) {
        bd = bd.setScale(i, RoundingMode.HALF_UP);
    }

    return bd.doubleValue();
} 
```

这将最终为我们提供预期的输出，即`1363.28`.

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2011-09-08T11:09:10.377

下面的代码片段显示了如何显示 n 位数字。诀窍是将变量 pp 设置为 1，后跟 n 个零。在下面的示例中，变量 pp 值有 5 个零，因此将显示 5 个数字。

```
double pp = 10000;

double myVal = 22.268699999999967;
String needVal = "22.2687";

double i = (5.0/pp);

String format = "%10.4f";
String getVal = String.format(format,(Math.round((myVal +i)*pp)/pp)-i).trim(); 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2015-06-28T11:54:36.843

如果您使用`DecimalFormat`to 转换`double`为`String`，则非常简单：

```
DecimalFormat formatter = new DecimalFormat("0.0##");
formatter.setRoundingMode(RoundingMode.HALF_UP);

double num = 1.234567;
return formatter.format(num); 
```

有几个`RoundingMode`枚举值可供选择，具体取决于您需要的行为。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2016-11-25T09:06:39.857

DecimalFormat 是最好的输出方式，但我不喜欢它。我总是这样做，因为它返回双精度值。所以我可以使用它而不仅仅是输出。

```
Math.round(selfEvaluate*100000d.0)/100000d.0; 
```

或者

```
Math.round(selfEvaluate*100000d.0)*0.00000d1; 
```

如果您需要较大的小数位值，则可以改用 BigDecimal。总之`.0`很重要。没有它，0.33333d5 的舍入返回 0.33333，并且只允许 9 位数字。第二个函数没有`.0`问题，0.30000 返回 0.30000000000000004。

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2019-08-21T03:29:57.577

这是我的答案：

```
double num = 4.898979485566356;
DecimalFormat df = new DecimalFormat("#.##");      
time = Double.valueOf(df.format(num));

System.out.println(num); // 4.89 
```

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2020-05-09T04:49:42.287

**我在 java 8 中使用了波纹管。它对我有用**

```
 double amount = 1000.431;        
    NumberFormat formatter = new DecimalFormat("##.00");
    String output = formatter.format(amount);
    System.out.println("output = " + output); 
```

**输出：**

```
output = 1000.43 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2020-06-24T13:01:32.067

如果需要可以使用以下方法`double`

```
double getRandom(int decimalPoints) {
    double a = Math.random();
    int multiplier = (int) Math.pow(10, decimalPoints);
    int b = (int) (a * multiplier);
    return b / (double) multiplier;
} 
```

例如`getRandom(2)`

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2020-08-27T01:04:09.080

1.  为了使尾随 0 到第 5 位

> ```
> DecimalFormat decimalFormatter = new DecimalFormat("#.00000");
> decimalFormatter.format(0.350500); // result 0.350500 
> ```

2.  为了避免尾随 0 到第 5 位

> ```
> DecimalFormat decimalFormatter= new DecimalFormat("#.#####");
> decimalFormatter.format(0.350500); // result o.3505 
> ```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2021-01-19T06:53:33.727

```
public static double formatDecimal(double amount) {
    BigDecimal amt = new BigDecimal(amount);
    amt = amt.divide(new BigDecimal(1), 2, BigDecimal.ROUND_HALF_EVEN);
    return amt.doubleValue();
} 
```

使用 Junit 进行测试

```
@RunWith(Parameterized.class)
public class DecimalValueParameterizedTest {

  @Parameterized.Parameter
  public double amount;

  @Parameterized.Parameter(1)
  public double expectedValue;

@Parameterized.Parameters
public static List<Object[]> dataSets() {
    return Arrays.asList(new Object[][]{
            {1000.0, 1000.0},
            {1000, 1000.0},
            {1000.00000, 1000.0},
            {1000.01, 1000.01},
            {1000.1, 1000.10},
            {1000.001, 1000.0},
            {1000.005, 1000.0},
            {1000.007, 1000.01},
            {1000.999, 1001.0},
            {1000.111, 1000.11}
    });
}

@Test
public void testDecimalFormat() {
    Assert.assertEquals(expectedValue, formatDecimal(amount), 0.00);
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2014-04-21T23:51:17.513

其中*dp* = 您想要的小数位，并且*value*是 double。

```
 double p = Math.pow(10d, dp);

    double result = Math.round(value * p)/p; 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2016-11-10T22:24:26.357

请记住，String.format() 和 DecimalFormat 使用默认语言环境生成字符串。因此，他们可以用点或逗号编写格式化数字作为整数和小数部分之间的分隔符。要确保舍入字符串采用您想要的格式，请使用 java.text.NumberFormat，如下所示：

```
 Locale locale = Locale.ENGLISH;
  NumberFormat nf = NumberFormat.getNumberInstance(locale);
  // for trailing zeros:
  nf.setMinimumFractionDigits(2);
  // round to 2 digits:
  nf.setMaximumFractionDigits(2);

  System.out.println(nf.format(.99));
  System.out.println(nf.format(123.567));
  System.out.println(nf.format(123.0)); 
```

将以英语语言环境打印（无论您的语言环境是什么）：0.99 123.57 123.00

该示例取自 Farenda -[如何正确将双精度转换为字符串](http://farenda.com/java/java-format-double-2-decimal-places/)。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2020-10-17T10:24:46.503

一个简单的方法来比较它是否是有限的小数位数。我们可以使用 Casting，而不是 DecimalFormat、Math 或 BigDecimal！

这是示例，

```
public static boolean threeDecimalPlaces(double value1, double value2){
    boolean isEqual = false;
    // value1 = 3.1756 
    // value2 = 3.17
    //(int) (value1 * 1000) = 3175
    //(int) (value2 * 1000) = 3170

    if ((int) (value1 * 1000) == (int) (value2 * 1000)){
        areEqual = true;
    }

    return isEqual;
} 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2021-09-04T15:56:36.157

非常简单的方法

```
public static String round(double value, int places) {
    if (places < 0) throw new IllegalArgumentException();

    DecimalFormat deciFormat = new DecimalFormat();
    deciFormat.setMaximumFractionDigits(places);
    return deciFormat.format(value);

}

String a = round(12.36545, 2); 
```

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2016-11-22T07:36:21.243

如果您考虑 5 或 n 位小数。可能这个答案可以解决您的问题。

```
 double a = 123.00449;
    double roundOff1 = Math.round(a*10000)/10000.00;
    double roundOff2 = Math.round(roundOff1*1000)/1000.00;
    double roundOff = Math.round(roundOff2*100)/100.00;

    System.out.println("result:"+roundOff); 
```

**输出将是：** 123.0 **1**
这可以通过循环和递归函数来解决。

# nhibernate - 验证块与 Nhibernate.Validator

> ID：153731
> 
> 赞同：6
> 
> 时间：2008-09-30T16:02:48.337
> 
> 标签：nhibernate, validation, model

我正在寻找验证框架，虽然我已经在使用 NHibernate，但我正在考虑使用 contrib 项目中的 NHibernate.validator，但是我也查看了 MS Validation Block，它似乎很强大，但我还没有深入了解每个框架，所以我想知道有没有人涉足这两个框架，体验如何？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-24T21:06:19.143

NHibernate Validator 不需要您使用 NHibernate 进行持久化。用法可以很简单：

```
var engine = new ValidatorEngine();
InvalidValue[] errors = engine.Validate(someModelObjectWithAttributes);

foreach(var error in errors)
{
    Console.WriteLine(error.Message);
} 
```

当然，它可以挂钩到 NHibernate 并防止无效对象的持久性，但您也可以使用它来验证非持久性对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T17:25:37.220

在大多数情况下，我会说 Spring.NET 是相当独立的。这意味着它不应该强迫您重新架构。您可以根据需要使用尽可能多的或尽可能少的。编写一个对象应该很容易，您可以使用 spring 将其注入需要验证的类中。然后，您将该对象连接到城堡中，以获取您需要的“验证组”或“验证器”的名称，然后让 spring 将验证器注入到该对象中，然后您的表单/业务对象/服务将使用验证器。

这是文档的链接，验证是第 12 节：

[http://www.springframework.net/docs/1.2.0-M1/reference/html/index.html](http://www.springframework.net/docs/1.2.0-M1/reference/html/index.html)

您是在使用 Castle 还是在使用 Monorail？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T13:24:38.803

当然，您可以尝试编写自己的验证框架。例如。Karl Seguin 将帮助您：

[http://codebetter.com/blogs/karlseguin/archive/2009/04/26/validation-part-1-getting-started.aspx](http://codebetter.com/blogs/karlseguin/archive/2009/04/26/validation-part-1-getting-started.aspx)

[http://codebetter.com/blogs/karlseguin/archive/2009/04/27/validation-part-2-client-side.aspx](http://codebetter.com/blogs/karlseguin/archive/2009/04/27/validation-part-2-client-side.aspx)

[http://codebetter.com/blogs/karlseguin/archive/2009/04/28/validation-part-3-server-side.aspx](http://codebetter.com/blogs/karlseguin/archive/2009/04/28/validation-part-3-server-side.aspx)

这是非常好的解决方案:)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-30T16:25:05.587

D）以上都不是。我记得去年评估过这个并决定使用 Spring.NET 的验证框架。

如果您使用 NHibernate，您可能还想使用 Spring.NET 的工具来使用 NHibernate。

# performance - 如何分解 Google App Engine 上的高 CPU 请求？

> ID：153732
> 
> 赞同：1
> 
> 时间：2008-09-30T16:02:51.910
> 
> 标签：performance, google-app-engine, quotas

举一个我不知道还能做什么的请求的例子：

该应用程序是[保龄球得分/统计跟踪器](http://www.bowlsk.com)。当有人在高级模式下输入他们的分数时，会计算一些统计数据以及他们的分数。数据建模为：

游戏 - 成员，如姓名、用户、保龄球馆的引用、得分 Frame - 每个球的落点、每个球上击倒球的布尔列表、关于球路径的信息（姿势、目标、实际去向)、该帧的得分等 GameStats - 存储整个游戏的计算统计数据，根据需要与其他游戏统计数据合并，以便跨游戏组显示统计数据。

可以在[此处](http://www.bowlsk.com/games/view-series.html?series=13717)找到此信息在实践中的示例。

当游戏完成并更新一帧时，我必须更新游戏、帧、之后的每一帧，可能还有之前的一些（以确保他们的分数是正确的），以及统计数据。此操作始终标记 CPU 监视器。即使游戏没有完成，不需要计算统计数据，也需要更新分数等以向用户显示实时进度，因此这些也会被标记。这个处理程序的平均 CPU 时间超过 7000 mcycles，它甚至不显示视图。大多数人每个系列会打 3 到 4 场比赛——如果他们在球道上实时输入他们的分数，那大约是每 2 到 4 分钟 1 个请求，但如果他们把它全部写下来然后再输入，则有 30-40 个这些请求是连续提出的。

* * *

根据要求，重要类的数据模型：

```
class Stats(db.Model):
  version = db.IntegerProperty(default=1)
  first_balls=db.IntegerProperty(default=0)
  pocket_tracked=db.IntegerProperty(default=0)
  pocket=db.IntegerProperty(default=0)
  strike=db.IntegerProperty(default=0)
  carry=db.IntegerProperty(default=0)
  double=db.IntegerProperty(default=0)
  double_tries=db.IntegerProperty(default=0)
  target_hit=db.IntegerProperty(default=0)
  target_missed_left=db.IntegerProperty(default=0)
  target_missed_right=db.IntegerProperty(default=0)
  target_missed=db.FloatProperty(default=0.0)
  first_count=db.IntegerProperty(default=0)
  first_count_miss=db.IntegerProperty(default=0)

  second_balls=db.IntegerProperty(default=0)
  spare=db.IntegerProperty(default=0)
  single=db.IntegerProperty(default=0)
  single_made=db.IntegerProperty(default=0)
  multi=db.IntegerProperty(default=0)
  multi_made=db.IntegerProperty(default=0)
  split=db.IntegerProperty(default=0)
  split_made=db.IntegerProperty(default=0)

class Game(db.Model):
  version = db.IntegerProperty(default=3)
  user = db.UserProperty(required=True)
  series = db.ReferenceProperty(Series)
  score = db.IntegerProperty()
  game_number = db.IntegerProperty()
  pair = db.StringProperty()
  notes = db.TextProperty()
  simple_entry_mode = db.BooleanProperty(default=False)
  stats = db.ReferenceProperty(Stats)
  complete = db.BooleanProperty(default=False)

class Frame(db.Model):
  version = db.IntegerProperty(default=1)
  user = db.UserProperty()
  game = db.ReferenceProperty(Game, required=True)
  frame_number = db.IntegerProperty(required=True)
  first_count = db.IntegerProperty(required=True)
  second_count = db.IntegerProperty()
  total_count = db.IntegerProperty()
  score = db.IntegerProperty()
  ball = db.ReferenceProperty(Ball)
  stance = db.FloatProperty()
  target = db.FloatProperty()
  actual = db.FloatProperty()
  slide = db.FloatProperty()
  breakpoint = db.FloatProperty()
  pocket = db.BooleanProperty()
  pocket_type = db.StringProperty()
  notes = db.TextProperty()
  first_pinfall = db.ListProperty(bool)
  second_pinfall = db.ListProperty(bool)
  split = db.BooleanProperty(default=False) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T16:26:06.050

几点建议：

*   您可以将帧的统计信息存储为与游戏相同的实体的一部分，而不是为每个实体单独存储一个实体，方法是将其存储为位于每个半场末尾的引脚的位域列表（以整数存储）-以框架为例。如果您想了解有关如何实施的更多详细信息，请告诉我。
*   如果做不到这一点，您可以计算一些更相关的 fetch 统计信息。例如，如果您一次加载了整个游戏，那么计算到目前为止的分数应该很简单，这意味着您可以避免每次请求都更新多个帧。
*   如果您向我们展示您的数据模型，我们可以提供更多帮助。:)

# standards - 什么是 RFC？

> ID：153735
> 
> 赞同：37
> 
> 时间：2008-09-30T16:03:25.310
> 
> 标签：standards, rfc

我认为有很多人不知道 RFC（征求意见）。我知道它们在逻辑层面上是什么，但是任何人都可以为新开发人员提供一个好的描述吗？此外，分享一些关于如何使用和阅读它们的资源会很好。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-30T16:25:41.247

该术语来自互联网的前身 ARPANET 时代，研究人员基本上只是将想法扔到那里，然后请求其他研究人员对该项目发表评论。它们几乎可以是任何东西，而且当时不是很正式。如果你去阅读它们，它们是多么的非正式，这很可笑。

现在，关于 RFC 中的内容有更多标准，在您满足严格的指导方针并进行广泛的研究之前，您无法发布 RFC。它们几乎是为 IETF 批准的经过充分研究的网络标准保留的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T16:11:42.560

来自[http://linux.about.com/cs/linux101/g/rfclparrequestf.htm](http://linux.about.com/cs/linux101/g/rfclparrequestf.htm)

> 结果的名称和在 Internet 上创建标准的过程。新标准被提出并在互联网上发布，作为征求意见。该提案由 Internet 工程任务组 ( [http://www.ietf.org/](http://www.ietf.org/) ) 审查，这是一个促进讨论的共识构建机构，最终建立了一个新标准，但标准的参考编号/名称保留缩写词 RFC，例如电子邮件消息格式的官方标准是 RFC 822。

另请参阅：[RFC 维基百科文章](http://en.wikipedia.org/wiki/Request_for_Comments)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-11-21T23:14:49.300

这也可能意味着敏捷环境中的“变更请求”。只是把它扔在那里，因为每个人都如此确定，只是意味着“征求意见”。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T16:14:26.547

Wikipedia 很好地描述了 [RFC] 的含义，但简而言之，它是 [Internet 工程任务组](http://en.wikipedia.org/wiki/Internet_Engineering_Task_Force)的一组建议，适用于 Internet 和 Internet 连接系统的工作。它们被用作标准。

因此，如果您正在寻找有关 FTP、LDAP、IMAP、POP 等实施信息的明确来源，您无需进一步了解相应的 RFC 文档。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T16:06:07.207

这是征求意见。不过，这个标题有点误导，因为它经常被用作标准的名称，主要是 IETF 的名称。见[维基百科](http://en.wikipedia.org/wiki/Request_for_Comments)

# computer-science - 向量和层数据结构

> ID：153742
> 
> 赞同：0
> 
> 时间：2008-09-30T16:04:14.340
> 
> 标签：computer-science, data-layers

我正在处理一些让我感到困惑的代码，我想知道我是否只是不了解数据结构。我正在使用的数据使用矢量和图层。我相信向量只是一行数据，但我不确定。

您可以提供或指出我使用这些信息的任何信息都会非常有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T17:01:06.920

向量的最简单视图是固定大小的列表，例如一维数组。

我从来没有听说过“层”，谷歌搜索也没有任何相关性。

你想做什么？

# c# - 如何在 WebBrowser 控件中注入 Javascript？

> ID：153748
> 
> 赞同：82
> 
> 时间：2008-09-30T16:05:54.773
> 
> 标签：c#, javascript, .net, winforms, webbrowser-control

我试过这个：

```
string newScript = textBox1.Text;
HtmlElement head = browserCtrl.Document.GetElementsByTagName("head")[0];
HtmlElement scriptEl = browserCtrl.Document.CreateElement("script");
lblStatus.Text = scriptEl.GetType().ToString();
scriptEl.SetAttribute("type", "text/javascript");
head.AppendChild(scriptEl);
scriptEl.InnerHtml = "function sayHello() { alert('hello') }"; 
```

scriptEl.InnerHtml 和 scriptEl.InnerText 都给出错误：

```
System.NotSupportedException: Property is not supported on this type of HtmlElement.
   at System.Windows.Forms.HtmlElement.set_InnerHtml(String value)
   at SForceApp.Form1.button1_Click(Object sender, EventArgs e) in d:\jsight\installs\SForceApp\SForceApp\Form1.cs:line 31
   at System.Windows.Forms.Control.OnClick(EventArgs e)
   at System.Windows.Forms.Button.OnClick(EventArgs e)
   at System.Windows.Forms.Button.OnMouseUp(MouseEventArgs mevent)
   at System.Windows.Forms.Control.WmMouseUp(Message& m, MouseButtons button, Int32 clicks)
   at System.Windows.Forms.Control.WndProc(Message& m)
   at System.Windows.Forms.ButtonBase.WndProc(Message& m)
   at System.Windows.Forms.Button.WndProc(Message& m)
   at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message& m)
   at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message& m)
   at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam) 
```

有没有一种简单的方法可以将脚本注入到 dom 中？

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-09-30T19:11:43.033

由于某种原因，Richard 的解决方案对我不起作用（insertAdjacentText 因异常而失败）。然而，这似乎有效：

```
HtmlElement head = webBrowser1.Document.GetElementsByTagName("head")[0];
HtmlElement scriptEl = webBrowser1.Document.CreateElement("script");
IHTMLScriptElement element = (IHTMLScriptElement)scriptEl.DomElement;
element.text = "function sayHello() { alert('hello') }";
head.AppendChild(scriptEl);
webBrowser1.Document.InvokeScript("sayHello"); 
```

[这个答案](https://stackoverflow.com/a/5216255/157247)解释了如何将`IHTMLScriptElement`界面引入您的项目。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2011-06-03T02:33:40.940

```
HtmlDocument doc = browser.Document;
HtmlElement head = doc.GetElementsByTagName("head")[0];
HtmlElement s = doc.CreateElement("script");
s.SetAttribute("text","function sayHello() { alert('hello'); }");
head.AppendChild(s);
browser.Document.InvokeScript("sayHello"); 
```

（在 .NET 4 / Windows 窗体应用程序中测试）

编辑：修复了功能集中的案例问题。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2011-12-31T07:49:53.823

这是我在处理此问题后发现的最简单的方法：

```
string javascript = "alert('Hello');";
// or any combination of your JavaScript commands
// (including function calls, variables... etc)

// WebBrowser webBrowser1 is what you are using for your web browser
webBrowser1.Document.InvokeScript("eval", new object[] { javascript }); 
```

全局 JavaScript 函数`eval(str)`所做的是解析并执行 str 中写入的任何内容。在此处查看[w3schools 参考](http://www.w3schools.com/jsref/jsref_eval.asp)。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2010-06-16T22:03:28.120

此外，在 .NET 4 中，如果您使用 dynamic 关键字，这会更容易：

```
dynamic document = this.browser.Document;
dynamic head = document.GetElementsByTagName("head")[0];
dynamic scriptEl = document.CreateElement("script");
scriptEl.text = ...;
head.AppendChild(scriptEl); 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2010-02-15T20:57:02.823

如果您真正想要的是运行 javascript，这将是最简单的（VB .Net）：

```
MyWebBrowser.Navigate("javascript:function foo(){alert('hello');}foo();") 
```

我想这不会“注入”它，但它会运行你的函数，如果那是你所追求的。（以防万一你把问题复杂化了。）如果你能弄清楚如何注入javascript，把它放到函数“foo”的主体中，让javascript为你做注入。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-09-30T18:28:58.283

HTML 文档的托管包装器并没有完全实现您需要的功能，因此您需要深入了解 MSHTML API 来完成您想要的功能：

1) 添加对 MSHTML 的引用，在*COM*引用下可能将其称为“Microsoft HTML 对象库”。

2) 添加'使用 mshtml;' 到您的命名空间。

3) 获取对脚本元素的 IHTMLElement 的引用：

```
IHTMLElement iScriptEl = (IHTMLElement)scriptEl.DomElement; 
```

4) 调用insertAdjacentText 方法，第一个参数值为“afterBegin”。[此处](http://msdn.microsoft.com/en-us/library/aa170712(office.11).aspx)列出了所有可能的值：

```
iScriptEl.insertAdjacentText("afterBegin", "function sayHello() { alert('hello') }"); 
```

5) 现在您将能够在 scriptEl.InnerText 属性中看到代码。

Hth，理查德

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2011-10-18T01:42:36.173

我相信从 c# 在 WebBrowser Control HTML 文档中注入 Javascript 的最简单方法是使用要注入的代码作为参数调用“execScript”方法。

在此示例中，javascript 代码在全局范围内注入和执行：

```
var jsCode="alert('hello world from injected code');";
WebBrowser.Document.InvokeScript("execScript", new Object[] { jsCode, "JavaScript" }); 
```

如果你想延迟执行，注入函数并在之后调用它们：

```
var jsCode="function greet(msg){alert(msg);};";
WebBrowser.Document.InvokeScript("execScript", new Object[] { jsCode, "JavaScript" });
...............
WebBrowser.Document.InvokeScript("greet",new object[] {"hello world"}); 
```

这对 Windows 窗体和 WPF WebBrowser 控件有效。

此解决方案不是跨浏览器，因为“execScript”仅在 IE 和 Chrome 中定义。但问题是关于 Microsoft WebBrowser 控件，而 IE 是唯一受支持的控件。

对于注入 javascript 代码的有效跨浏览器方法，请使用新关键字创建一个 Function 对象。此示例使用注入代码创建一个匿名函数并执行它（javascript 实现了闭​​包，并且该函数可以访问全局空间而不会造成局部变量污染）。

```
var jsCode="alert('hello world');";
(new Function(code))(); 
```

当然，您可以延迟执行：

```
var jsCode="alert('hello world');";
var inserted=new Function(code);
.................
inserted(); 
```

希望能帮助到你

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-04-14T13:22:47.953

[作为已接受答案](https://stackoverflow.com/a/154496/107625)的后续，这是[`IHTMLScriptElement`接口](http://msdn.microsoft.com/en-us/library/aa768904%28v=vs.85%29.aspx)的最小定义，不需要包含其他类型库：

```
[ComImport, ComVisible(true), Guid(@"3050f28b-98b5-11cf-bb82-00aa00bdce0b")]
[InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIDispatch)]
[TypeLibType(TypeLibTypeFlags.FDispatchable)]
public interface IHTMLScriptElement
{
    [DispId(1006)]
    string text { set; [return: MarshalAs(UnmanagedType.BStr)] get; }
} 
```

因此，WebBrowser 控件派生类中的完整代码如下所示：

```
protected override void OnDocumentCompleted(
    WebBrowserDocumentCompletedEventArgs e)
{
    base.OnDocumentCompleted(e);

    // Disable text selection.
    var doc = Document;
    if (doc != null)
    {
        var heads = doc.GetElementsByTagName(@"head");
        if (heads.Count > 0)
        {
            var scriptEl = doc.CreateElement(@"script");
            if (scriptEl != null)
            {
                var element = (IHTMLScriptElement)scriptEl.DomElement;
                element.text =
                    @"function disableSelection()
                    { 
                        document.body.onselectstart=function(){ return false; }; 
                        document.body.ondragstart=function() { return false; };
                    }";
                heads[0].AppendChild(scriptEl);
                doc.InvokeScript(@"disableSelection");
            }
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2010-08-17T20:11:12.213

这是使用 mshtml 的解决方案

```
IHTMLDocument2 doc = new HTMLDocumentClass();
doc.write(new object[] { File.ReadAllText(filePath) });
doc.close();

IHTMLElement head = (IHTMLElement)((IHTMLElementCollection)doc.all.tags("head")).item(null, 0);
IHTMLScriptElement scriptObject = (IHTMLScriptElement)doc.createElement("script");
scriptObject.type = @"text/javascript";
scriptObject.text = @"function btn1_OnClick(str){
    alert('you clicked' + str);
}";
((HTMLHeadElementClass)head).appendChild((IHTMLDOMNode)scriptObject); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-11-16T19:01:52.887

这是一个 VB.Net 示例，如果您尝试从 WebBrowser 控件中加载的页面中检索变量的值。

步骤 1) 在您的项目中添加一个 COM 引用到 Microsoft HTML 对象库

步骤 2) 接下来，将此 VB.Net 代码添加到您的 Form1 以导入 mshtml 库：
Imports mshtml

步骤 3) 在“Public Class Form1”行上方添加此 VB.Net 代码：
<System.Runtime.InteropServices.ComVisibleAttribute(True)>

步骤 4) 将 WebBrowser 控件添加到您的项目

第 5 步）将此 VB.Net 代码添加到您的 Form1_Load 函数中：
WebBrowser1.ObjectForScripting = Me

第 6 步）添加这个 VB.Net 子程序，它将向网页的 Javascript 中注入一个函数“CallbackGetVar”：

```
Public Sub InjectCallbackGetVar(ByRef wb As WebBrowser)
    Dim head As HtmlElement
    Dim script As HtmlElement
    Dim domElement As IHTMLScriptElement

    head = wb.Document.GetElementsByTagName("head")(0)
    script = wb.Document.CreateElement("script")
    domElement = script.DomElement
    domElement.type = "text/javascript"
    domElement.text = "function CallbackGetVar(myVar) { window.external.Callback_GetVar(eval(myVar)); }"
    head.AppendChild(script)
End Sub 
```

第 7 步）添加以下 VB.Net 子程序，然后 Javascript 将在调用时查找该子程序：

```
Public Sub Callback_GetVar(ByVal vVar As String)
    Debug.Print(vVar)
End Sub 
```

第 8 步）最后，要调用 Javascript 回调，请在按下按钮时添加此 VB.Net 代码，或者在任何您喜欢的地方添加：

```
Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
    WebBrowser1.Document.InvokeScript("CallbackGetVar", New Object() {"NameOfVarToRetrieve"})
End Sub 
```

第 9 步）如果您对它的工作感到惊讶，您可能需要阅读第 6 步中使用的 Javascript“eval”函数，这就是使这成为可能的原因。它将接受一个字符串并确定是否存在具有该名称的变量，如果存在，则返回该变量的值。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-07-19T12:47:45.660

我用过这个：D

```
HtmlElement script = this.WebNavegador.Document.CreateElement("SCRIPT");
script.SetAttribute("TEXT", "function GetNameFromBrowser() {" + 
"return 'My name is David';" + 
"}");

this.WebNavegador.Document.Body.AppendChild(script); 
```

然后你可以执行并得到结果：

```
string myNameIs = (string)this.WebNavegador.Document.InvokeScript("GetNameFromBrowser"); 
```

我希望能有所帮助

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-30T16:09:16.090

您始终可以使用“DocumentStream”或“DocumentText”属性。对于处理 HTML 文档，我推荐使用[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-05-28T02:45:57.023

我用这个：

```
webBrowser.Document.InvokeScript("execScript", new object[] { "alert(123)", "JavaScript" }) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T16:07:32.227

你想要做的是使用 Page.RegisterStartupScript(key, script) ：

有关详细信息，请参见此处：http: [//msdn.microsoft.com/en-us/library/aa478975.aspx](http://msdn.microsoft.com/en-us/library/aa478975.aspx)

您基本上要做的是构建您的 javascript 字符串，将其传递给该方法并给它一个唯一的 id（以防您尝试在页面上注册两次。）

编辑：这就是你所说的触发快乐。随意放下它。:)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-11-08T02:52:57.370

如果你需要注入整个文件，那么你可以使用这个：

```
With Browser.Document
   Dim Head As HtmlElement = .GetElementsByTagName("head")(0)
   Dim Script As HtmlElement = .CreateElement("script")
   Dim Streamer As New StreamReader(<Here goes path to file as String>)
   Using Streamer
       Script.SetAttribute("text", Streamer.ReadToEnd())
   End Using
   Head.AppendChild(Script)
   .InvokeScript(<Here goes a method name as String and without parentheses>)
End With 
```

记住要导入`System.IO`才能使用`StreamReader`. 我希望这有帮助。

# jquery - 带有不允许用户输入的文本输入的 jQuery Datepicker

> ID：153759
> 
> 赞同：145
> 
> 时间：2008-09-30T16:08:24.440
> 
> 标签：jquery, datepicker

如何使用带有文本框输入的 jQuery Datepicker：

```
$("#my_txtbox").datepicker({
  // options
}); 
```

不允许用户在文本框中输入随机文本。我希望在文本框获得焦点或用户单击它时弹出 Datepicker，但我希望文本框忽略使用键盘的任何用户输入（复制和粘贴或任何其他）。我想专门从 Datepicker 日历中填充文本框。

这可能吗？

jQuery 1.2.6
日期选择器 1.5.2

* * *

## 回答 #1

> 赞同：278
> 
> 时间：2008-09-30T16:17:35.790

您应该能够在文本输入上使用**readonly**属性，并且 jQuery 仍然能够编辑其内容。

```
<input type='text' id='foo' readonly='true'> 
```

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2011-10-02T07:27:15.103

根据我的经验，我会推荐 Adhip Gupta 建议的解决方案：

```
$("#my_txtbox").attr( 'readOnly' , 'true' ); 
```

以下代码不会让用户输入新字符，但**会**允许他们删除字符：

```
$("#my_txtbox").keypress(function(event) {event.preventDefault();}); 
```

此外，这将使表单对禁用 JavaScript 的人无用：

```
<input type="text" readonly="true" /> 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-30T16:21:26.030

尝试

```
$("#my_txtbox").keypress(function(event) {event.preventDefault();}); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-11-17T11:16:11.550

如果您在多个地方重用日期选择器，那么也很容易通过 JavaScript 修改文本框，方法如下：

```
$("#my_txtbox").attr( 'readOnly' , 'true' ); 
```

就在您初始化日期选择器的位置之后/之前。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-11-18T07:37:23.627

```
<input type="text" readonly="true" /> 
```

导致文本框在回发后丢失其值。

你宁愿使用 Brad8118 的建议，它工作得很好。

```
$("#my_txtbox").keypress(function(event) {event.preventDefault();}); 
```

编辑：要让它在 IE 上工作，请使用“keydown”而不是“keypress”

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2017-01-27T11:01:15.400

初始化日期选择器后：

```
$(".project-date").datepicker({
    dateFormat: 'd M yy'
});

$(".project-date").keydown(false); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-11-21T08:53:01.330

您有两种选择来完成这项工作。（据我所知）

1.  **选项 A：**使您的文本字段只读。可以按如下方式完成。

2.  **选项 B：**更改光标焦点。将 ti 设置为模糊。可以通过将属性设置 `onfocus="this.blur()"`为日期选择器文本字段来完成。

前任： `<input type="text" name="currentDate" id="currentDate" onfocus="this.blur()" readonly/>`

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-09-18T10:15:43.900

```
$("#txtfromdate").datepicker({         
    numberOfMonths: 2,
    maxDate: 0,               
    dateFormat: 'dd-M-yy'       
}).attr('readonly', 'readonly'); 
```

在 jquery 中添加 readonly 属性。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-30T16:20:02.073

要在获取焦点时弹出日期选择器：

```
$(".selector").datepicker({ showOn: 'both' }) 
```

如果您不想要用户输入，请将其添加到输入字段

```
<input type="text" name="date" readonly="readonly" /> 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-03-07T10:12:27.620

我刚刚遇到这个，所以我在这里分享。这是选项

[https://eonasdan.github.io/bootstrap-datetimepicker/Options/#ignorereadonly](https://eonasdan.github.io/bootstrap-datetimepicker/Options/#ignorereadonly)

这是代码。

**HTML**

```
<br/>
<!-- padding for jsfiddle -->
<div class="input-group date" id="arrival_date_div">
  <input type="text" class="form-control" id="arrival_date" name="arrival_date" required readonly="readonly" />
  <span class="input-group-addon">
    <span class="glyphicon-calendar glyphicon"></span>
  </span>
</div> 
```

**JS**

```
$('#arrival_date_div').datetimepicker({
  format: "YYYY-MM-DD",
  ignoreReadonly: true
}); 
```

这是小提琴：

[http://jsfiddle.net/matbaric/wh1cb6cy/](http://jsfiddle.net/matbaric/wh1cb6cy/)

我的 bootstrap-datetimepicker.js 版本是 4.17.45

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-03-11T16:10:18.217

我知道这个线程很旧，但是对于遇到同样问题的其他人来说，实现@Brad8118 解决方案（我更喜欢，因为如果您选择将输入设为只读，那么用户将无法删除从 datepicker 插入的日期值如果他选择）并且还需要防止用户粘贴一个值（正如@ErikPhilips 建议的那样），我在这里添加了这个对我有用的内容： `$("#my_txtbox").bind('paste',function(e) { e.preventDefault(); //disable paste });`从这里[https://www.dotnettricks.com/learn/ jquery/disable-cut-copy-and-paste-in-textbox-using-jquery-javascript](https://www.dotnettricks.com/learn/jquery/disable-cut-copy-and-paste-in-textbox-using-jquery-javascript) 和我使用的整个特定脚本（使用 fengyuanchen/datepicker 插件代替）：

```
$('[data-toggle="datepicker"]').datepicker({
    autoHide: true,
    pick: function (e) {
        e.preventDefault();
        $(this).val($(this).datepicker('getDate', true));
    }
}).keypress(function(event) {
    event.preventDefault(); // prevent keyboard writing but allowing value deletion
}).bind('paste',function(e) {
    e.preventDefault()
}); //disable paste; 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-08-05T07:44:36.983

除了添加[只读之外](https://www.w3schools.com/tags/att_input_readonly.asp)，您还可以使用[onkeypress="return false;"](https://www.w3schools.com/jsref/event_onkeypress.asp)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-30T16:22:09.803

这个[演示](http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/datePickerClickInput.html)通过将日历放在文本字段上来做到这一点，这样你就不能输入它了。您还可以将输入字段设置为仅在 HTML 中读取以确保。

```
<input type="text" readonly="true" /> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-02-20T09:00:46.140

**HTML**

```
<input class="date-input" type="text" readonly="readonly" /> 
```

**CSS**

```
.date-input {
      background-color: white;
      cursor: pointer;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-30T16:22:15.467

我发现 jQuery Calendar 插件，至少对我来说，通常更适合选择日期。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-11-19T12:51:51.090

```
$('.date').each(function (e) {
    if ($(this).attr('disabled') != 'disabled') {
        $(this).attr('readOnly', 'true');
        $(this).css('cursor', 'pointer');
        $(this).css('color', '#5f5f5f');
    }
}); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-07-31T04:52:29.507

这是您的答案，这是解决方法。当您限制文本框控件中的用户输入时，您不想使用 jquery。

```
<input type="text" id="my_txtbox" readonly />  <!--HTML5-->

<input type="text" id="my_txtbox" readonly="true"/> 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-07-16T09:08:32.610

$("#my_txtbox").prop('readonly', true)

像魅力一样工作..

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-11-24T05:57:25.200

除了使用文本框，您还可以使用按钮。最适合我，我不希望用户手动编写日期。

[![在此处输入图像描述](https://i.stack.imgur.com/h7zpq.gif)](https://i.stack.imgur.com/h7zpq.gif)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-06-16T10:22:06.813

我知道这个问题已经得到解答，并且大多数人建议使用**`readonly`**属性。
我只想分享我的场景和答案。

将**`readonly`**属性添加到我的**HTML Element**后，我​​遇到了无法使**该**属性成为**`required`**动态的问题。
甚至尝试在 HTML 创建时同时**`readonly`**设置。**`required`**

**`readonly`**因此，如果您也想设置它，我建议不要使用**`required`**。

而是使用

```
$("#my_txtbox").datepicker({
    // options
});

$("#my_txtbox").keypress(function(event) {
    return ( ( event.keyCode || event.which ) === 9 ? true : false );
}); 
```

这只允许**`tab`**按键。
您可以添加更多要绕过的**键码。**

我在代码下面，因为我已经添加了两者**`readonly`**并且**`required`**它仍然提交表单。
删除后 **`readonly`**可以正常工作。

[https://jsfiddle.net/shantaram/hd9o7eor/](https://jsfiddle.net/shantaram/hd9o7eor/)

```
$(function() {
  $('#id-checkbox').change( function(){
  	$('#id-input3').prop('required', $(this).is(':checked'));
  });
  $('#id-input3').datepicker();
  $("#id-input3").keypress(function(event) {
    return ( ( event.keyCode || event.which ) === 9 ? true : false );
});
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<link href="https://code.jquery.com/ui/jquery-ui-git.css" rel="stylesheet"/>

<form action='https://jsfiddle.net/'>
Name:  <input type="text" name='xyz' id='id-input3' readonly='true' required='true'> 
    <input type='checkbox' id='id-checkbox'> Required <br>
    <br>
    <input type='submit' value='Submit'>
</form>
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-09-20T19:41:48.753

将时间选择器的 ID：IDofDatetimePicker 替换为您的 ID。

这将阻止用户输入任何进一步的键盘输入，但用户仍然可以访问时间弹出窗口。

$("#my_txtbox").keypress(function(event) {event.preventDefault();});

试试这个来源： [https ://github.com/jonthornton/jquery-timepicker/issues/109](https://github.com/jonthornton/jquery-timepicker/issues/109)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-04-03T09:51:31.063

这个问题有很多较旧的答案，并且 readonly 似乎是普遍接受的解决方案。我相信现代浏览器中更好的方法是`inputmode="none"`在 HTML 输入标签中使用：

```
<input type="text" ... inputmode="none" /> 
```

或者，如果您更喜欢在脚本中执行此操作：

```
$(selector).attr('inputmode', 'none'); 
```

我没有对它进行广泛的测试，但它在我使用过的 Android 设置上运行良好。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-05-24T11:17:34.777

就我而言，我有使用`disableTextInput`财产

```
$( ".datepicker" ).datepicker({'dateFormat' : 'd-m-y', 'disableTextInput':true }); 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2012-10-17T21:50:47.453

或者，例如，您可以使用隐藏字段来存储值...

```
 <asp:HiddenField ID="hfDay" runat="server" /> 
```

并在 $("#my_txtbox").datepicker({ 选项：

```
 onSelect: function (dateText, inst) {
            $("#<% =hfDay.ClientID %>").val(dateText);
        } 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2013-02-26T11:53:42.370

如果您希望用户从日期选择器中选择一个日期，但您不希望用户在文本框中输入，请使用以下代码：

```
<script type="text/javascript">
$(function () {
    $("#datepicker").datepicker({ maxDate: "-1D" }).attr('readonly', 'readonly');
    $("#datepicker").readonlyDatepicker(true);

}); 
```

# wpf - 如何将 Illustrator 文件转换为 WPF 的路径

> ID：153762
> 
> 赞同：12
> 
> 时间：2008-09-30T16:09:24.577
> 
> 标签：wpf, vector-graphics, adobe-illustrator

我们的图形人员使用 Adob​​e Illustrator，我们想在 WPF 应用程序中使用她的图像作为路径。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T19:10:52.317

我们使用表达式设计来做到这一点。

不幸的是，目前没有像 Blend 2.5 这样的免费 beta 预览版，但是，您可以[下载](http://www.microsoft.com/expression/products/overview.aspx?key=design)试用版（我认为您可以使用 90 天）。

如果你不想走这条路，我知道很多人也使用上面 curtisk 所指的 Mike Swanson 的出口商。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T16:44:31.280

这应该符合[AI->XAML的要求](http://www.mikeswanson.com/xamlexport/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-10-24T05:08:54.470

您可以从 AI 到 SVG 再到 XAML。

1.  来自 Adob​​e Illustrator：文件 -> 另存为 -> *.SVG。

    *   SVG“Profile 1.1”似乎就足够了。

    *   请注意，要在 XAML 中保留路径/组名称，您应该启用“保留 Illustrator 编辑功能”（或至少在 CS4 中调用它）。

2.  [SharpVectors](https://sharpvectors.codeplex.com/)可以将 SVG 数据转换为 XAML 数据。这将生成一个带有 root 的 XAML 片段`<DrawingGroup>`。

3.  执行您需要执行的操作来复制粘贴或以其他方式使用 XAML，例如将其放入如下所示的图像中。AI 文件中的命名对象或组仍应在 XAML 中具有它们的名称，即通过`x:Name="..."`.

```
<Image>
  <Image.Source>
    <DrawingImage>
      <DrawingImage.Drawing>
        <DrawingGroup ... the output from step #2 ...>...</DrawingGroup>
      </DrawingImage.Drawing>
    </DrawingImage>
  </Image.Source>
</Image> 
```

4.  如果您想为事物设置动画，坐标系可能会很痛苦。还有一些其他的帖子，比如[this](https://graphicdesign.stackexchange.com/questions/15401/change-viewbox-attribute-in-svg-exported-by-illustrator)，可能会有一些见解。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T16:32:46.283

让她将插图导出为其他格式（Illustrator 的最新版本支持 SVG），您可以使用这些格式或将其转换为可以使用的格式。

# file - 如何查看 db2 表（文件）的模式

> ID：153769
> 
> 赞同：7
> 
> 时间：2008-09-30T16:10:09.630
> 
> 标签：file, db2, schema

如主题...有没有办法在不插入任何行并发出 SELECT 的情况下查看空表模式？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-03-18T04:53:25.043

```
SELECT *                
FROM SYSIBM.SYSCOLUMNS  
WHERE                   
TBNAME    = 'tablename'; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T16:12:23.090

您在寻找[DESCRIBE](http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/core/r0002019.htm)吗？

`db2 describe table user1.department`

```
Table: USER1.DEPARTMENT

Column             Type        Type
name               schema      name               Length   Scale    Nulls
------------------ ----------- ------------------ -------- -------- --------
AREA               SYSIBM      SMALLINT                  2        0 No
DEPT               SYSIBM      CHARACTER                 3        0 No
DEPTNAME           SYSIBM      CHARACTER                20        0 Yes 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-07-26T17:13:06.810

对于 DB2 AS/400（此处为 V5R4），我使用以下查询来检查数据库/表/列元数据：

SELECT * FROM SYSIBM.TABLES -- 提供所有表

SELECT * FROM SYSIBM.VIEWS -- 提供所有视图及其源 (!!) 定义

SELECT * FROM SYSIBM.COLUMNS -- 提供所有列、它们的数据类型和大小、默认值等。

SELECT * FROM SYSIBM.SQLPRIMARYKEYS -- 提供主键列表及其顺序

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T17:59:54.280

查看您的[其他问题](https://stackoverflow.com/questions/153920/php-unixodbc-db2-describe-token-not-valid)， DESCRIBE 可能不起作用。我相信有一个存储所有字段信息的系统表。

也许[这会帮助你](http://www.code400.com/ffd.php)。更多的编码，但更准确。

# python - 在 Pylons 中重定向请求而不丢失表单数据的首选方法是什么？

> ID：153773
> 
> 赞同：4
> 
> 时间：2008-09-30T16:11:23.247
> 
> 标签：python, post, request, header, pylons

我正在尝试重定向/转发 Pylons 请求。使用 redirect_to 的问题是表单数据被丢弃。我需要保持 POST 表单数据以及所有请求标头的完整性。

有没有一种简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T16:21:30.400

从 POST 接收数据取决于 Web 浏览器一起发送数据。当 Web 浏览器收到重定向时，它不会重新发送该数据。一种解决方案是对要保留的数据进行 URL 编码，并将其与 GET 一起使用。在最坏的情况下，您始终可以将要保留的数据添加到会话中并以这种方式传递。

# c# - Wcf 和接口作为参数

> ID：153775
> 
> 赞同：7
> 
> 时间：2008-09-30T16:11:28.643
> 
> 标签：c#, .net, wcf, web-services

我有一个包含一些共享相同界面的实体的库。客户端和服务共享这个程序集。现在我想知道是否有办法在我的服务合同中将此接口类型作为参数，以便我可以对所有实现该接口的类使用相同的方法。

实体本身都装饰有 datacontract-attribute 及其成员具有 datamember 属性。

有可能吗？可能与*NetDataContractSerializer*？我知道我可以使用基类（例如一些抽象类）和*knowntype* -attribute 来做到这一点，但我肯定更喜欢接口作为对象的标识符，因为它在客户端应用程序中广泛使用，并且可以简化开发。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T11:05:56.920

我在 OperationContracts 的实现中使用 ServiceKnownType 属性解决了这个问题。

当告诉您的类将接口实现为 ServiceKnownType 时，您可以将该接口用作参数，因此只要它们是可序列化的，就可以使用所有实现您的接口的类。（查看 Juval Löwy 的“Programming WCF Services”，第 100 页）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T20:44:02.593

在常规的“mex”下肯定是不可能的。*装配共享可能*是可能的，但我真的不推荐它- 你正在与 WCF 作斗争：它会很脆弱，等等。当然，你总是可以在你的对象模型中屏蔽它 - 即而不是调用 [OperationContract]方法，将其抽象为隐藏 WCF 详细信息的包装方法（可能使用不同的对象进行数据传输而不是实际返回）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-18T02:46:41.560

[我刚刚阅读了您的答案，并意识到您是在专门询问服务方法的参数。我会在这里留下我的评论，以防它们仍然有帮助。]

我在我知道我在电线两侧都有 WCF 的项目上所做的事情是这样的：

仅包含共享接口的库，例如：

```
namespace SharedInterfaces {
    public interface ICompositeType {
        bool BoolValue { get; set; }
        string StringValue { get; set; }
    }
} 
```

WCF 服务库，其中 [DataContract] (POCO) 实现共享接口。

```
[DataContract]
public class CompositeType : ICompositeType {
    bool boolValue = true;
    string stringValue = "Hello ";

    [DataMember]
    public bool BoolValue {
        get { return boolValue; }
        set { boolValue = value; }
    }

    [DataMember]
    public string StringValue {
        get { return stringValue; }
        set { stringValue = value; }
    }
} 
```

在服务客户端中，可以“强制”每个代理 POCO 使用部分类来实现共享、部署的接口（如果 svcutil 正确地完成了它的工作，它无论如何都会执行），并且您将能够对接口中的接口进行编程其余的客户端代码：

```
namespace ServiceClient.ServiceReference1 {
    public partial class CompositeType : ICompositeType {
    }
} 
```

如果您想添加一些客户端可以使用的附加属性或方法（例如，MVP 或 MVVM 模式中的 Presenter 或 ViewModel 概念），此部分也很有用。

# c# - 如何从方法内部调用 javascript 函数？

> ID：153776
> 
> 赞同：4
> 
> 时间：2008-09-30T16:11:40.720
> 
> 标签：c#, asp.net, javascript, arcgis

我在里面...

```
public class bgchange : IMapServerDropDownBoxAction
{
    void IServerAction.ServerAction(ToolbarItemInfo info)
    {
     Some code... 
```

在“一些代码”之后我想触发

```
[WebMethod]
public static void DoSome()
{

} 
```

这会触发一些 javascript。这可能吗？

好的，在这里切换方法。我能够调用 dosome(); 触发但没有触发javascript。我曾尝试使用 registerstartupscript 方法，但不完全了解如何实现它。这是我尝试过的：

```
public class bgchange : IMapServerDropDownBoxAction
{

void IServerAction.ServerAction(ToolbarItemInfo info)
{
    ...my C# code to perform on dropdown selection...
        //now I want to trigger some javascript...
        // Define the name and type of the client scripts on the page.
        String csname1 = "PopupScript";
        Type cstype = this.GetType();

        // Get a ClientScriptManager reference from the Page class.
        ClientScriptManager cs = Page.ClientScript;

        // Check to see if the startup script is already registered.
        if (!cs.IsStartupScriptRegistered(cstype, csname1))
        {
            String cstext1 = "alert('Hello World');";
            cs.RegisterStartupScript(cstype, csname1, cstext1, true);
        }
} 
```

}

我从一个 msdn 示例中获得了 registerstartupscript 代码。显然我没有正确实施它。目前 vs 说“非静态字段、方法或属性‘System.Web.UI.Page.ClientScript.get’需要对象引用，引用代码段“Page.Clientscript;”谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T16:32:23.837

我不确定我是否完全理解您尝试做的事情的顺序，什么是客户端，什么不是......

但是，您可以向页面添加一个启动 javascript 方法，然后调用 WebMethod。通过 javascript 调用 WebMethod 时，您可以添加一个回调函数，然后在 WebMethod 返回时调用该函数。

如果在页面上添加 ScriptManager 标签，则可以通过 Javascript 调用页面中定义的 WebMethods。

```
<asp:ScriptManager ID="scriptManager1" 
    runat="server" EnablePageMethods="true" /> 
```

从 Page_Load 函数中，您可以添加对 WebMethod 的调用。

```
Page.ClientScript.RegisterStartupScript(
    this.GetType(), 
    "callDoSome",
    "PageMethods.DoSome(Callback_Function, null)", 
    true); 
```

Callback_Function 表示将在调用 WebMethod 后执行的 javascript 函数...

```
<script language="javascript" type="text/javascript">
    function Callback_Function(result, context) {
        alert('WebMethod was called');
    }
</script> 
```

**编辑：**

找到[Web ADF 控件](http://edndoc.esri.com/arcobjects/9.2/NET_Server_Doc/developer/ADF/custom_tools_commands.htm)的此链接。这是你用的吗？？

从那个页面来看，看起来像这样的东西会做一个 javascript 回调。

```
public void ServerAction(ToolbarItemInfo info) {
    string jsfunction = "alert('Hello');";
    Map mapctrl = (Map)info.BuddyControls[0];
    CallbackResult cr = new CallbackResult(null, null, "javascript", jsfunction);
    mapctrl.CallbackResults.Add(cr);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T17:05:37.687

如果以上是您调用 RegisterStartupScript 的方式，那么它将不起作用，因为您没有对“Page”对象的引用。

您的示例中的 bgchange 扩展了 Object （假设 IMapServerDropDownBoxAction 是一个接口），这意味着没有 Page 实例可供您引用。

这与您从 Asp.Net Page 或 UserControl 执行的操作完全相同，它会起作用，因为 Page 将是一个有效的参考。

```
public partial class _Default : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        Page.ClientScript.RegisterStartupScript(
            this.GetType(),
            "helloworldpopup",
            "alert('hello world');",
            true);          
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T16:32:58.703

您不能直接从服务器调用浏览器中的方法。但是，您可以将 javascript 函数添加到将在浏览器中执行方法的响应中。

在 ServerAction 方法中，执行以下操作

```
string script = "<script language='javascript'>\n";
script += "javascriptFunctionHere();\n";
script += "</script>";

Page.RegisterStartupScript("ForceClientToCallServerMethod", script); 
```

[更多信息在这里](http://msdn.microsoft.com/en-us/library/system.web.ui.page.registerstartupscript.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T16:27:00.307

嗯......自从我最初的回答以来，这个问题发生了巨大的变化。

现在我认为答案是否定的。但我可能错了。

# objective-c - OS X 10.5 中的文件共享 API 或框架。*

> ID：153781
> 
> 赞同：2
> 
> 时间：2008-09-30T16:12:45.177
> 
> 标签：objective-c, macos, file-sharing

是否有任何编程接口或 CLI 用于更改 OS X Leopard 中的网络或文件共享设置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T16:48:02.020

它被称为 dscl（目录服务命令行实用程序）。

# asp.net - ASP.NET 2.0 中的下拉控件

> ID：153782
> 
> 赞同：1
> 
> 时间：2008-09-30T16:13:05.427
> 
> 标签：asp.net, drop-down-menu, asp.net-2.0

我在 ASP.NET 中使用代码隐藏页面来执行 SQL 查询。查询被加载到一个字符串中，建立连接（到 Oracle），我们通过让连接执行 .ExecuteReader 到 OleDBDataReader（我们称之为 DataRead）来启动它。我将尝试在下面敲出一个例子。（将 Drop 视为 ASP DropDownList 控件）

```
Dim LookFor as String = "Fuzzy Bunnies"

While DataRead.Read
    If LookFor = DataRead.Item("Kinds of Bunnies") Then
        'Meets special critera, do secondary function'

         Drop.Items.Add(DataRead.Item("Subgroup of Bunnies"))
         ...
    End if
    ...
End While 
```

这是我知道的对 DropDownList 进行动态添加的唯一方法。但是，DropDownList 中的每个项目都有一个 .text 属性和一个 .value 属性。我们如何将 .value 定义为与代码中的 .text 不同？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T16:15:56.793

[Add](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listitemcollection.add.aspx)函数可以采用ListItem [，](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listitem.aspx)所以你可以这样做

```
Dim li as new ListItem(DataRead.Item("Subgroup of Bunnies"), "myValue")
Drop.Items.Add(li) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T16:15:47.947

Add 应该有一个接受 ListItem 对象的重载。使用它，您通常可以执行以下操作：

```
 Drop.Items.Add(New ListItem("Text", "Value")) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T16:16:58.477

如果我理解这个问题，Items.Add 有一个采用 ListItem 的重载，因此您可以在该行中创建一个新的 ListItem 对象：

```
Drop.Items.Add(new ListItem("text", "value")) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T16:15:01.147

请原谅我可能有问题的 VB

```
Dim item as New ListItem()
item.Value = "foo"
item.Text = "bar"

Drop.Items.Add(item) 
```

您还可以使用 ListItem 构造函数（例如 new ListItem("text", "value")）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T16:16:43.360

您将在数据阅读器中选择第二列（例如 IDENTITY 字段），然后像这样分配您的项目生成：

```
Dim item as new listitem
item.text = DataRead.Item("SubGroup Of Bunnies")
item.value = DataRead.Item("ID")
Drop.Items.Add(item) 
```

您可能还想查看 DATABIND 功能，并在 SQL 语句本身中过滤掉“FUZZY BUNNIES”。

# reporting-services - 在多页 SSRS RDLC 报告上打印图像不起作用

> ID：153791
> 
> 赞同：6
> 
> 时间：2008-09-30T16:15:36.247
> 
> 标签：reporting-services, reportviewer, rdlc

我正在开发一个将通用对象列表加载到 RDLC 报告中的应用程序，然后使用`WebForms` `ReportViewer Control`. 它渲染得很好，出口也很好，但如果我尝试打印它，它可能会向打印机假脱机 500k，然后停止响应。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-10-13T17:30:43.760

好吧，看来是硬件问题！

由于您将图像控件添加到 RDLC 报告中，因此它应该可以很好地工作。我创建了许多 RDLC 表单，标题上有图像，一切都很好。

您应该始终检查打印机是否存在某种问题并针对其他问题进行测试。

# ruby-on-rails - 使用 activerecord 从对象到表

> ID：153795
> 
> 赞同：2
> 
> 时间：2008-09-30T16:16:01.067
> 
> 标签：ruby-on-rails, ruby, activerecord

我从外部库中获取一些对象，我需要将这些对象存储在数据库中。有没有办法从对象开始创建表和关系，或者我必须深入研究它们并手动创建迁移和模型？

谢谢！罗伯托

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T16:32:04.117

即使您可以像那样动态地创建表（不是说可以）。我不想那样做。那里有很大的错误可能性。

我会手动创建迁移并预先创建表和字段，并根据需要用行填充它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T00:53:23.383

注意：这是一个可怕的 hack，您将在未来几年内消除这些错误，但它非常容易：

这依赖于 Rails ActiveSupport，并且 ActiveRecord 已经被加载

假设您从具有 2 个实例变量的第三方库中获得一个随机对象 - 它的类可能如下所示：

```
class Animal
    attr_accessor :name, :number_of_legs
end
a = SomeThirdPartyLibrary.get_animal 
```

您可以使用反射来找出它的名称和列：

```
table_name = a.class.to_s.tableize
column_names = a.instance_variables.map{ |n| n[1..-1] } # remove the @
column_types = a.instance_variables.map{ |n| a.instance_variable_get(n).class 
    }.map{ |c| sql_type_for_class(c) } # go write sql_type_for_class please 
```

然后您可以使用 ActiveRecord 迁移来创建您的表，如下所示：

```
ActiveRecord::Migration.class_eval do
  create_table table_name do |t|
    column_names.zip(column_types).each do |colname, coltype|
      t.column colname, coltype
    end
  end
end 
```

然后，您最终可以声明一个 activerecord 类，该类将与刚刚创建的表交互。

```
# Note we declare a module so the new classes don't conflict with the existing ones
module GeneratedClasses; end
eval "class GeneratedClasses::#{a.class} < ActiveRecord::Base; end" 
```

快！

现在你可以这样做：

```
a = GeneratedClasses::Animal.new
a.update_attributes whatever
a.save 
```

PS：不要这样做！

除了很糟糕之外，如果您的 rails 应用程序重新启动，它将失去生成类的所有概念，因此您还需要设计一些持久化这些类的机制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T17:30:05.430

我有这个确切的情况。我必须读取应用程序外部的数据，并且性能影响如此之大，以至于我存储在本地。我已经采用了一种解决方案，随着时间的推移，我已经手动开发了一个模式和迁移，它可以处理数据，并允许我将数据保存到表中。我开发了一种适用于我的数据的缓存方案，并且性能显着提高。

话虽如此，我都是手工完成的，我不后悔。我可以确信我的数据库是稳定的，并且我不会即时重新创建数据库表。因此，我不担心我的应用程序的稳定性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T20:17:57.867

根据您尝试对对象执行的操作，您可以通过[序列化](http://api.rubyonrails.org/classes/ActiveRecord/Base.html#M001319)对象将对象直接存储到数据库中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T16:18:50.827

尝试查看一些 ORM 解决方案。或存储为 XML。

# asp.net - 在 sharepoint 母版页上查找控件

> ID：153796
> 
> 赞同：0
> 
> 时间：2008-09-30T16:16:06.043
> 
> 标签：asp.net, sharepoint, master-pages

我正在尝试遍历共享点页面上的所有控件，出于测试目的，我只想输出控件 ID

这是我正在使用的代码

Public Shared Sub SubstituteValues3(ByVal CurrentPage As Page, ByRef s As StringBuilder)

```
 'Page()
    '- MasterPage
    '- HtmlForm
    '- ContentPlaceHolder
    '- The TextBoxes, etc.

    For Each ctlMaster As Control In CurrentPage.Controls

        If TypeOf ctlMaster Is MasterPage Then
            HttpContext.Current.Response.Output.Write("Master Page <br/>")

            For Each ctlForm As Control In ctlMaster.Controls

                If TypeOf ctlForm Is HtmlForm Then
                    HttpContext.Current.Response.Output.Write("HTML Form <br/>")

                    For Each ctlContent As Control In ctlForm.Controls
                        If TypeOf ctlContent Is ContentPlaceHolder Then
                            HttpContext.Current.Response.Output.Write("Content Placeholder <br/>")

                            For Each ctlChild As Control In ctlContent.Controls
                                HttpContext.Current.Response.Output.Write(ctlChild.ID.ToString & "<br />")
                            Next
                        End If
                    Next
                End If
            Next
        End If
    Next

    HttpContext.Current.Response.Output.Write("--------------")
    HttpContext.Current.Response.End() 
```

但是它没有超过“MasterPage”输出。

我希望看到我在内容占位符中拥有的所有控件的名称，但我觉得这有点令人困惑。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T01:54:36.677

从 Page.Master.Controls 开始

从那里你所拥有的应该基本上可以工作

```
 For Each ctlForm As Control In Page.Master.Controls

            If TypeOf ctlForm Is HtmlForm Then
                HttpContext.Current.Response.Output.Write("HTML Form <br/>")

                For Each ctlContent As Control In ctlForm.Controls
                    If TypeOf ctlContent Is ContentPlaceHolder Then
                        HttpContext.Current.Response.Output.Write("Content Placeholder <br/>")

                        For Each ctlChild As Control In ctlContent.Controls
                            HttpContext.Current.Response.Output.Write(ctlChild.ID.ToString & "<br />")
                        Next
                    End If
                Next
            End If
        Next 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-18T13:48:27.963

你可以用递归简单地做到这一点，不是有效的，但它很简单......试试这个方法：public void getControls（Control input）

```
{
    foreach (Control c in input.Controls)
    {
        Response.Write(c.GetType().ToString() + " - " + c.ID + "<br />");
        getControls(c);
    }
} 
```

并这样称呼它：

```
getControls(Page); 
```

这将循环遍历页面上的所有控件并输出它们的**类型 - ID**并将其打印到页面顶部......您还可以使用代码来构建列表或任何您想做的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T01:39:02.320

MasterPage 不是当前页面的控件，它是它的属性，在**Page.MasterPage**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T09:24:12.727

我发现这段代码似乎列出了我需要的控件，但我认为这更像是一种 hack。

```
For i = 0 To CurrentPage.Request.Form.AllKeys.Length - 1
        If CurrentPage.Request.Form.GetKey(i).Contains("ctl00$PlaceHolderMain$") Then

            Dim key As String = CurrentPage.Request.Form.GetKey(i).Substring(22)
            Dim keyText As String = String.Format("[{0}]", key)

            HttpContext.Current.Response.Output.Write(keyText & "<br/>")

            'Text.Replace(keyText, CurrentPage.Request.Form("ctl00$PlaceHolderMain$" & key))
        End If
    Next 
```

# php - 在 PHP (REGEX) 中连接 RTF 文件

> ID：153801
> 
> 赞同：2
> 
> 时间：2008-09-30T16:17:11.610
> 
> 标签：php, regex, rtf

我有一个脚本，它获取用户上传的 RTF 文档并将一些个人数据合并到信中（姓名、地址等），并为多人执行此操作。我合并信函内容，然后将其与下一个合并信函内容合并，用于所有人员记录。

有效地，我将单个 RTF 文档组合到自身中，以便我需要将字母合并到的人数记录。但是，我需要首先删除每个合并的关闭 RTF 标记和打开 RTF 标记，否则 RTF 将无法正确呈现。这听起来像是正则表达式的工作。

本质上，我需要一个将删除整个字符串的正则表达式：

}\n\page 任何东西 \par

例如，这个正则表达式将匹配这个：

```
crap
}
\page{\rtf1\ansi\ansicpg1252\deff0\deflang1033{\fonttbl{\f0\fswiss\fcharset0 Arial;}}
{\*\generator Msftedit 5.41.15.1515;}\viewkind4\uc1\pard\f0\fs20 September 30, 2008\par
more crap 
```

所以我可以做到：

```
crap
\page
more crap 
```

RegEx 是这里最好的方法吗？

更新：为什么我必须使用 RTF？

我想让用户上传一个套用信函，然后系统将使用该套用信函来创建合并的信函。由于 RTF 是纯文本，我可以很容易地在代码中做到这一点。我知道，RTF 是规范的灾难，但我不知道还有其他好的选择。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T21:06:32.913

我会质疑在这种情况下使用 RTF。我并不完全清楚您要整体做什么，所以我不一定能提出更好的建议，但如果您可以尝试更广泛地解释您的项目，也许我可以提供帮助。

如果这确实是你想要的方式，这个正则表达式给了我正确的输出给我你的输入：

```
$output = preg_replace("/}\s?\n\\\\page.*?\\\\par\s?\n/ms", "\\page\n", $input); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T21:16:41.687

对此我可以说 ick ick ick。尽管如此，rcar 的 cludge 可能会起作用，除非出现一些奇怪的边缘情况，即 RTF 实际上并没有以这种形式结束，或者文档范围的样式包含完全弄乱格式的重要信息，或者许多失败模式中的任何其他模式。

# windows - 最后修改的文件夹

> ID：153803
> 
> 赞同：6
> 
> 时间：2008-09-30T16:17:15.090
> 
> 标签：windows, filesystems

Windows 如何确定文件夹的最后修改日期？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-06-03T14:24:51.200

根据[MSDN](http://web.archive.org/web/20110705024711/http://support.microsoft.com/kb/299648)，最后修改时间戳存储在每个目录中：

> *   如果您在名为 D:\NTFS1 和 D:\NTFS2 的 NTFS 分区上创建两个新文件夹，则创建和修改的日期和时间都相同。
> *   如果将 D:\NTFS2 文件夹移动到 D:\NTFS1 文件夹中，创建 D:\NTFS1\NTFS2，则：
>     1.  D:\NTFS1 - 创建的文件夹是一样的，修改后的戳改变了。
>     2.  D:\NTFS1\NTFS2 - 创建的文件夹更改和修改的文件夹保持不变。出现此问题的原因是，即使您移动了文件夹，主文件表 (MFT) 也会在 D:\NTFS1 文件夹中创建一个新文件夹。
> *   如果将 D:\NTFS2 文件夹复制到 D:\NTFS1 文件夹中，创建 D:\NTFS1\NTFS2 文件夹，并且 D:\NTFS2 文件夹仍然存在（复制后）：
>     1.  D:\NTFS1 - 创建的文件夹相同，修改后的文件夹时间和日期戳更改。
>     2.  D:\NTFS2 - 因为它是原始文件夹，所以不会发生任何更改。
>     3.  D:\NTFS1\NTFS2 - 创建的文件夹和修改的文件夹都更改为相同的标记，即移动时间的标记。
>         出现此问题的原因即使您复制了文件夹，新文件夹也被视为由 MFT 创建，并被赋予新的创建和修改时间戳。
> 
> **注意**：FAT 文件系统的设计和行为在修改时间戳方面有所不同。在 FAT 文件系统上，如果文件夹的内容发生更改，文件夹的修改日期不会更改。例如，如果您有 D:\FAT1 和 D:\FAT2，并且您将 D:\FAT2 复制或移动到 D:\FAT1 中，则 D:\FAT1 的创建日期和修改日期保持不变。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T16:21:14.410

使用文件夹内最后一次文件活动的日期。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T16:35:58.697

更新目录条目时，也会更新目录本身的最后修改日期。

# svn - Subversion - 主干真的是主要开发的最佳场所吗？

> ID：153812
> 
> 赞同：17
> 
> 时间：2008-09-30T16:18:57.380
> 
> 标签：svn, branching-and-merging

在 SVN`trunk`中，推荐用于主要开发的地方，我在所有项目中都使用这个约定。但是，这意味着**主干有时不稳定，甚至损坏**。例如，当

*   我犯了错误
*   当由于 SVN 的工作方式而不得不破坏主干时。典型示例是文件重命名 - 您必须先提交任何文件重命名，然后再进行任何进一步的修改；但是，文件重命名可能需要代码重构以反映命名空间或类名更改，因此您基本上需要分两步提交单个逻辑操作。并且构建在步骤 1 和 2 之间中断。

我可以想象会有一些工具来防止错误地提交某些东西（例如 TeamCity 和延迟提交），但你真的能克服第二个问题吗？如果不是，那么在某个分支上进行“狂野开发”`/branch/dev`并仅在构建相当可靠时才合并到主干不是更好吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-30T16:21:10.837

您的主干应该始终编译，如果您需要进行重大更改，您应该使用分支并稍后合并更改。

阅读 SVN 书的这一章：http: [//svnbook.red-bean.com/nightly/en/svn.branchmerge.html](http://svnbook.red-bean.com/nightly/en/svn.branchmerge.html)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-30T16:21:32.677

我建议阅读[这篇](http://www.perforce.com/sites/default/files/pdf/perforce-best-practices.pdf)关于 SCM 最佳实践的文章。

摘自文章：

> 有主线。“主线”或“主干”是永远发展的代码线的分支。主线为几乎所有更改（包括维护修复和新功能）提供了最终目的地，并且代表了软件产品的主要线性演变。发布代码线和开发代码线从主线分支，分支中发生的工作被传播回主线。

编辑：我还建议阅读[SCM Patterns](http://www.scmpatterns.com/book/)。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-30T16:23:25.013

这真的取决于你的环境。在某些情况下，暂时损坏后备箱并不是什么大问题。但是，如果您与超过 2-3 人一起工作，那可能不是一个好主意。

在这种情况下，我认为更自由地使用分支*是*个好主意。它们很容易设置和重新合并（如果你不让事情变得太不同步）。

当然，如果您的所有开发人员都在使用同一个分支，您将不会真正获得任何东西 - 您只会将您的主干称为 /branch/dev，但它的损坏仍然是一个主要问题！分解分支，这样每个分支只有少数开发人员工作，你应该很好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-30T16:50:43.527

主干是正在进行的开发应该发生的地方。如果每个人在提交更改之前都在测试他们的更改，那么您真的不应该对“损坏”的代码有问题。一个好的经验法则是在对更改进行编码后进行更新（从存储库中获取所有最新代码）。然后构建并进行一些单元测试。如果一切都构建并正常工作，那么您应该很好地检查它。

当你准备好发布时，创建一个分支。测试可以针对分支进行发布验证。如果发现问题，则对树枝和树干进行修复，并重新切割树枝进行测试。与此同时，开发人员正忙着为主干添加新的变化。

所以......通过测试发现的问题以及这些琐碎问题的出色解决方案在分支和主干中都是当前的，测试人员有一个稳定的工作范围，并且在测试验证当前版本的同时开发继续前进。

就像 Hanibal 在“The A-Team”中经常说的那样，“我喜欢当一个计划达成时。”

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T16:50:54.773

使用 Subversion 的团队通常对合并有病态的厌恶，因为在 1.5 之前，这是一个漫长而复杂的过程，容易失败。如果你有足够多的开发人员，那么拥有一个始终工作的主干是绝对必要的，因为许多人正在开发许多协同工作的不同模块，那么分支开发肯定会有所帮助。

顺便说一句，即使您重命名文件，您仍然可以编辑它。我一直这样做。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T18:27:02.733

我创建了几个 shell 脚本来简化创建短期开发分支的过程：

```
# Create new branch and switch to it
function svn_bswitch()
{
   branch=$1; shift
   msg="$1"; shift

   URL=$(svn info . | sed -ne 's@URL: \(.*\)@\1@p')
   REPO=$(svn info . | sed -ne 's@Repository Root: \(.*\)@\1@p')
   BRANCH_URL=$REPO/branch/$branch

   svn copy $URL $BRANCH_URL -m "$msg"
}

# Switch to a branch or tag
function svn_switch()
{
  d=$1; shift
  REPO=$(svn info . | sed -ne 's@Repository Root: \(.*\)@\1@p')
  URL=$REPO/$d
  svn switch $URL
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T16:35:35.530

在我们公司，我们每晚都会构建一个后备箱。预计每个人都测试他们的代码，以便在签入之前至少可以编译。如果夜间构建失败，则会删除有问题的代码，直到修复为止。

我认为最重要的部分是让每个人都了解颠覆的作用以及为什么他们只签入可编译的代码很重要。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T16:49:40.050

不，后备箱不是最好的地方。在我们的组织中，我们始终遵循这种方法：Trunk 包含发布代码，因此它始终可以编译。随着新的每个版本/里程碑，我们打开一个新的分支。每当开发人员拥有一个项目时，他/她都会为该发布分支创建一个新分支，并仅在对其进行测试后将其合并到发布分支中。发布分支在系统测试后合并到主干。

附图是粗略的表示。![替代文字](https://i.stack.imgur.com/JwUxT.jpg)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-17T07:41:19.643

不，主干不是提交开发级代码的最佳场所。在我们的环境中，我们将主干视为已部署到生产环境的镜像。Web 开发和应用程序开发的工作流程可能不同，但主干应包含最新的生产更改。

我们在开发分支上工作，即分支/特性1，并通过复制分支/特性1->标签/特性1-qa1创建一个qa标签，并修复分支/特性1中的任何错误以创建标签/特性1-qa1等等。当准备好部署时，自上次合并到主干后在分支/功能 1 中发生的所有更改都将在创建最终发布标签（即 tags/5.1.0）之前合并回主干。

工作流程可能会有所不同，具体取决于您的团队的设置方式或您所在的项目/环境类型。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-01T13:58:11.670

当旧的“稳定的主干，分支中的开发”过程成为问题时的另一个示例：

您正在开发一个依赖于大量实时数据（可能是用户贡献的数据）的 Web 应用程序。由于某种原因，您**不仅**可以生成另一个数据库后端（-s）实例或您所依赖的外部文件系统。（例如，您的环境可能缺少数据模型迁移）

A 团队一直在 /branches/F 中开发新功能 F。团队 B 刚刚启动了另一个分支来修复在 /branches/P 中的实时站点上发生的一些性能问题，团队 B 需要做的*第一件事*是重构一堆数据库表和/或文件在外部文件系统。这导致团队 A 必须重构他们的许多新东西才能继续开发。然后 C 队进来做另一件事……突然间，每个人都有一个问题。

然后是合并阶段——在那之后，没有人愿意再使用 TortoiseSVN。

# database - 我应该如何在 Oracle 中存储 GUID？

> ID：153815
> 
> 赞同：56
> 
> 时间：2008-09-30T16:19:24.663
> 
> 标签：database, oracle, guid

我来自我们拥有唯一标识符的 SQL 服务器世界。oracle中是否有等价物？此列将被频繁查询，因此性能是关键。

我在 .Net 中生成 GUID 并将其传递给 Oracle。由于几个原因，它不能由 oracle 生成，所以我不能使用序列。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-30T16:27:23.847

```
CREATE table test (testguid RAW(16) default SYS_GUID() ) 
```

[该博客](http://preferisco.blogspot.com/2007/02/unique-ids-for-multi-master-replication.html)研究了相对性能。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-10-07T21:21:27.463

正如其他人所说，与数字序列相比，使用 GUID 会降低性能。也就是说，自 Oracle 8i 起就有一个名为“ [SYS_GUID()](http://download.oracle.com/docs/cd/B14117_01/server.101/b10759/functions153.htm) ”的函数可用，它提供原始等价物：

```
SQL> SELECT SYS_GUID() FROM DUAL;

SYS_GUID()
--------------------------------
248AACE7F7DE424E8B9E1F31A9F101D5 
```

可以创建一个函数来返回格式化的 GUID：

```
CREATE OR REPLACE FUNCTION GET_FORMATTED_GUID RETURN VARCHAR2 IS guid VARCHAR2(38) ;
BEGIN
    SELECT SYS_GUID() INTO guid FROM DUAL ;

    guid :=
        '{' || SUBSTR(guid,  1, 8) ||
        '-' || SUBSTR(guid,  9, 4) ||
        '-' || SUBSTR(guid, 13, 4) ||
        '-' || SUBSTR(guid, 17, 4) ||
        '-' || SUBSTR(guid, 21) || '}' ;

    RETURN guid ;
END GET_FORMATTED_GUID ;
/ 
```

因此返回一个可互换的字符串：

```
SQL> SELECT GET_FORMATTED_GUID() FROM DUAL ;

GET_FORMATTED_GUID()
--------------------------------------
{15417950-9197-4ADD-BD49-BA043F262180} 
```

应该注意的是，一些 Oracle 平台返回的 GUID 值相似但仍然是唯一的值，[正如](http://feuerthoughts.blogspot.com/2006/02/watch-out-for-sequential-oracle-guids.html)Steven Feuerstein 所指出的那样。

**2020 年 11 月 3 日更新**：在 10g 中，Oracle 添加了对正则表达式函数的支持，这意味着可以使用该`REGEXP_REPLACE()`函数简化连接。

```
REGEXP_REPLACE(
    SYS_GUID(),
    '([0-9A-F]{8})([0-9A-F]{4})([0-9A-F]{4})([0-9A-F]{4})([0-9A-F]{12})',
    '{\1-\2-\3-\4-\5}'
) 
```

该表达式将 by 返回的字符串值分解`SYS_GUID()`为 5 组十六进制值并重建它，在每组之间插入一个“-”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T16:28:03.427

如果我正确理解了这个问题，您希望在数据库中插入一行时生成一个唯一的 id。
您可以使用*序列*来执行此操作。 [链接在这里](http://download.oracle.com/docs/cd/B28359_01/server.111/b28310/views002.htm)
一旦你创建了你的序列，你可以像这样使用它：

```
INSERT INTO mytable (col1, col2) VALUES (myseq.NEXTVAL, 'some other data'); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-02-27T23:48:37.770

RAW(16) 显然是唯一标识符 MS SQL 类型的首选等效项。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-06T19:38:05.373

GUID 在 Oracle 中不像在 MSSQL 中那样使用，我们倾向于有一个 NUMBER 字段（不是 null 和主键）、一个序列和一个插入触发器来填充它（对于每个表）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T16:24:28.520

Oracle 中没有唯一标识符。

您可以使用 RAW（有点痛苦）或 CHAR 自己实现一个。与使用整数相比，在 CHAR 字段上 JOIN 的查询的性能会受到影响（可能高达 40%）。

如果您正在做分​​布式/复制数据库，那么性能损失是值得的。否则，只需使用整数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T16:24:44.337

使用 Oracle 的一般做法是创建人工密钥。这是一个定义为数字的列。它通过序列填充。它通过主键定义进行索引/约束。

# php - 如何将数学函数应用于 MySQL 查询？

> ID：153825
> 
> 赞同：8
> 
> 时间：2008-09-30T16:21:49.400
> 
> 标签：php, mysql, voting

我有以下查询来确定一个故事获得了多少票：

```
SELECT s_id, s_title, s_time, (s_time-now()) AS s_timediff, 

(
 (SELECT COUNT(*) FROM s_ups WHERE stories.q_id=s_ups.s_id) -
 (SELECT COUNT(*) FROM s_downs WHERE stories.s_id=s_downs.s_id)
) AS votes

FROM stories 
```

我想为即将到来的故事应用以下数学函数（我认为这是 reddit 使用的） - [http://redflavor.com/reddit.cf.algorithm.png](http://redflavor.com/reddit.cf.algorithm.png)

我可以在应用程序端执行该功能（我现在正在这样做），但我无法按功能提供的排名对其进行排序。

有什么建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T23:56:04.330

试试这个：

```
 SELECT s_id, s_title, log10(Z) + (Y * s_timediff)/45000 AS redditfunction 
    FROM (
    SELECT stories.s_id, stories.s_title, stories.s_time, 
    stories.s_time - now() AS s_timediff, 
    count(s_ups.s_id) - count(s_downs.s_id) as X, 
    if(X>0,1,if(x<0,-1,0)) as Y, 
    if(abs(x)>=1,abs(x),1) as Z
    FROM stories 
    LEFT JOIN s_ups ON stories.q_id=s_ups.s_id
    LEFT JOIN s_downs ON stories.s_id=s_downs.s_id
    GROUP BY stories.s_id
    ) as derived_table1 
```

如果它适用于您的数据集，您可能需要检查此语句。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T17:26:29.963

y 和 z 是棘手的。您需要基于 x 值的特定回报。这听起来是一个很好的理由来制作一个函数。

[http://dev.mysql.com/doc/refman/5.0/en/if-statement.html](http://dev.mysql.com/doc/refman/5.0/en/if-statement.html)

您应该为 y 创建 1 个函数，为 z 创建一个函数。传入 x，并期望返回一个数字。

```
DELIMINATOR //

CREATE FUNCTION y_element(x INT) 
  RETURNS INT

BEGIN
    DECLARE y INT;

IF x > 0 SET y =  1;
ELSEIF x = 0 SET y =  0;
ELSEIF x < 0 SET y = -1;
END IF;

RETURN y;

END //;

DELIMINATOR; 
```

有y。我是手工完成的，没有检查，所以你可能需要修正一些错字。以同样的方式执行 z，然后你就拥有了最终函数的所有值。

# java - 您使用什么来验证 XML 模式？

> ID：153835
> 
> 赞同：2
> 
> 时间：2008-09-30T16:24:08.100
> 
> 标签：java, validation, xsd

当我想根据服务器端 Java 中的模式验证 XML 文档时，我使用内置的 JRE Xerces 实现和 javax.xml.validation.Schema。它工作正常，但是当验证失败时，Xerces 会给出非常接近无用的错误消息，例如：

```
cvc-minLength-valid: Value '' with length = '0' is not facet-valid with respect to minLength '1' for type 'PopulatedStringType' 
```

这些可能需要很长时间才能诊断和追踪到 XML 文档中验证失败的特定部分，这都是因为错误消息很差。

所以我的问题是，您是否使用另一种方法来验证 XML 对 Schema，从而在验证失败时提供更有用的输出？

请不要说这是服务器端 Java，所以请不要说“使用 XML Spy”或类似的词。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T01:09:29.437

在您的验证处理程序中，您应该收到带有该消息的 SAXParseException，以及 XML 文件中的[列号和行号](http://xerces.apache.org/xerces2-j/javadocs/api/org/xml/sax/SAXParseException.html#method_summary)。不是这样吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T16:35:22.720

我们使用[Oracle 的 XDK（XML 开发工具包）](http://www.oracle.com/technology/tech/xml/xdkhome.html)，其中包括带有验证解析器的 xmlparserv2.jar 和 XSLT 2.0。它使用 JAXB API，因此您只需将其添加到您的类路径并更改您的导入。它会抛出不完美的错误，但我会说比你的例子更容易理解。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T16:52:37.627

xmlstarlet(xmlstar.sourceforge.net/) 是一个命令行工具包。您可以使用 Runtime.exec() 为给定的 xml 运行它（只要 xml 在文件中）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T15:22:01.023

我们使用[Castor](http://www.castor.org)。

> Castor 是一个用于 Java[tm] 的开源数据绑定框架。它是 Java 对象、XML 文档和关系表之间的最短路径。Castor 提供 Java 到 XML 的绑定、Java 到 SQL 的持久性等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-30T23:59:45.087

如果您在解释 Xerces 错误时遇到问题，并且想要一些有助于突出显示您在文档中违反规则的地方的内容，请查看一些 XML 创作工具，例如[oXygen](http://www.oxygenxml.com/validation.html)。

[![替代文字](https://i.stack.imgur.com/peeVR.gif)](https://i.stack.imgur.com/peeVR.gif)
[（来源：[oxyxml.com](http://www.oxygenxml.com/img/errorsOverviewRuler.gif)）]

将模式与实例 XML 文档关联后，编辑器将突出显示文档的违规区域并为您提供违规描述。

另外，您可以使用不同的引擎来执行验证：

> oXygen 内置支持：Xerces、LIBXML、XSV、Saxon SA、MSXML4.0、MSXML .NET 和 SQC。

# sqlite - 将 MFC 模型保存为 SQLite 数据库

> ID：153838
> 
> 赞同：1
> 
> 时间：2008-09-30T16:25:00.860
> 
> 标签：sqlite, mfc

我正在使用 MFC 玩 CAD 应用程序。我在想将文档（模型）保存为 SQLite 数据库会很好。

好处：

*   我避免文件格式更改（SQLite 负责）
*   免费查询引擎
*   撤消堆栈被简化（表名、列名、新值等...）

意见？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T18:45:56.557

这是个好主意。Sqlite 使用起来非常愉快！

但请记住一个古老的真理（我无法从谷歌得到关于它最初来自哪里的权威答案），将你的数据存储在关系数据库中就像把你的车开进车库，拆卸它，然后把每一块放入贴有标签的柜子中。

几何数据由点、线和按名称相互引用的线段组成，是存储在数据库表中的理想选择。但是，当您开始拥有具有子组件层次结构的复合对象时，可能需要更少的代码来使用序列化并通过一次调用来存储/加载模型。

所以这也是一个好主意。

但是 MFC 中的序列化并不像在 C# 中那样成功，所以总的来说，我会继续使用 SQL。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-06T19:00:32.527

这是一个好主意，但在开始之前，我有一些建议：

*   请注意，除了文件名之外，每个数据库都可以通过某种方式唯一标识，例如在数据库中拥有一个描述文件的表。

*   在创建您自己的之前，请查看一些已经可用的基于 MFC 的示例和包装器。我见过的那些都借用了每一个来创造更好的结果。谷歌：MFC SQLite 包装器。

*   使用 SQLite 数据库对于维护状态也很有用。提前考虑如何管理，记住 SQLite 中包含和缺少的功能。

*   您现在还可以考虑如何通过确保您的数据库表结构可以轻松地导出到其他 SQL 数据库系统以及足够容易地扩展到备份系统来将应用程序扩展到 Web。

# wcf - WCF 未绑定到正确的 IP 地址

> ID：153846
> 
> 赞同：3
> 
> 时间：2008-09-30T16:26:28.780
> 
> 标签：wcf, binding, tcp

我们在出现一些问题的 Windows 2003 服务器上部署了 WCF 服务。配置正在使用`wsHttpBinding`，我们正在指定 IP 地址。这些服务由 Windows 服务托管。

当我们启动服务时，大多数情况下它会抓取错误的 IP 地址。有几次它绑定到正确的地址只是为了放弃该绑定并在处理一小会后转到绑定到 NIC 的另一个地址（有 2 个）。

它目前正在使用端口 80（我们已将 IIS 配置为仅通过 绑定到 1 个地址`httpcfg`），尽管我们已尝试使用不同的端口获得相同的结果。

当 Windows 服务开始托管 WCF 服务时，属性显示它被绑定到正确的地址；但是，tcpview 显示它确实在侦听错误的地址。

这是设置基本地址的配置部分。绑定的最终是 0.4 而不是 0.9

```
<services>
    <service name="Service.MyService"
             behaviorConfiguration="serviceBehavior">
        <host>
            <baseAddresses>
                <add baseAddress="http://xx.xx.xx.9:80/" />
            </baseAddresses>
        </host>
        <endpoint address="MyService"
                  binding="wsHttpBinding"
                  bindingConfiguration="WSHttpBinding_IMyService"
                  contract="Service.IMyService" />
        <endpoint address="mex"
                  binding="mexHttpBinding"
                  contract="IMetadataExchange" />
    </service>
</services> 
```

*   是否还有其他需要设置的配置？
*   是否有工具可以帮助追踪绑定到错误地址的位置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T19:47:36.847

您的 WCF 配置对我来说看起来不错。这可能是您的 NIC 卡的绑定顺序问题。确保地址正确的网卡在前。这是一篇讨论如何设置和查看网卡绑定顺序的文章：

[http://theregime.wordpress.com/2008/03/04/how-to-setview-the-nic-bind-order-in-windows/](http://theregime.wordpress.com/2008/03/04/how-to-setview-the-nic-bind-order-in-windows/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T10:44:08.017

这个问题似乎与国际空间站有关。这是有关您从[http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/ddf72ae0-aa1e-48c9-88d1-10bae1e87e4f.mspx?mfr=true获得的错误的描述](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/ddf72ae0-aa1e-48c9-88d1-10bae1e87e4f.mspx?mfr=true)

*当 HTTP.sys 分析 IP 包含列表并发现列表中的所有条目均无效时，此错误会记录到事件日志中。如果发生这种情况，如表 11.15 中所述，HTTP.sys 将侦听所有 IP 地址。*

您还可以查看以下讨论类似问题的线程 [http://www.webhostingtalk.com/showthread.php?t=534174](http://www.webhostingtalk.com/showthread.php?t=534174)

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T14:15:24.410

我们遇到了同样的问题，这个功能帮助我们解决了我们的问题：

[http://msdn.microsoft.com/en-us/library/system.servicemodel.hostnamecomparisonmode.aspx](http://msdn.microsoft.com/fr-fr/library/system.servicemodel.hostnamecomparisonmode.aspx)

希望这有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T23:26:32.810

还有一条信息。如果我们将绑定更改为使用 NetTcp 而不是 WsHttp，它将绑定到端口 80 上的正确地址。将其更改回 WsHttp 它会返回到错误的 IP 地址。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T21:03:15.853

More information: I removed the xx.xx.xx.4 IP address from the NIC altogether and turned off IIS. Now when I try to start the service it fails and I find this in the System event log.

```
Description:
Unable to bind to the underlying transport for xx.xx.xx.4:80\. The IP Listen-Only list may contain a reference to an interface which may not exist on this machine.  The data field contains the error number. 
```

My configuration file still has the xx.xx.xx.9 baseAddress setting.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-05T10:42:11.833

BaseAddress 被忽略。您需要[在 IIS 下设置主机头](http://gavinmckay.wordpress.com/2009/03/24/howto-fix-wcf-host-name-on-iis/)。

# sql - sql语句中的[]括号

> ID：153861
> 
> 赞同：28
> 
> 时间：2008-09-30T16:30:48.910
> 
> 标签：sql, ms-access

sql语句中的括号有什么作用？

例如，在声明中：

```
插入 table1 ([columnname1], columnname2) 值 (val1, val2)
```

另外，如果表名在括号中，它会做什么？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-30T16:32:06.380

[] 标记标识符的分隔符，因此如果您有一个名称包含空格的列，例如 Order Qty，您需要用 [] 将其括起来，例如：

```
select [Order qty] from [Client sales] 
```

它们还用于转义用作标识符的保留关键字

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-30T18:49:55.347

这是“分隔标识符”的 Microsoft SQL Server 非标准语法。SQL 支持标识符的分隔符，以允许表名、列名或其他元数据对象包含以下内容：

*   SQL 保留字：“订单”
*   包含空格的单词：“订购数量”
*   包含标点的单词：“订单数量”
*   包含国际字符的单词
*   区分大小写的列名：“Order”与“order”

Microsoft SQL Server 使用方括号，但这不是 SQL 用于分隔标识符的语法标准。标准情况下，应使用双引号作为分隔符。

在 Microsoft SQL Server 中，您可以启用一种模式以使用标准双引号作为分隔符，如下所示：

```
SET QUOTED_IDENTIFIER ON; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-30T16:32:05.007

它们旨在转义保留的关键字或无效的列标识符。

```
CREATE TABLE test
(
  [select] varchar(15)
)

INSERT INTO test VALUES('abc')

SELECT [select] FROM test 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T16:40:36.767

它们允许您在列、表等名称中使用关键字（例如**date ）...**

由于这是一种不好的做法，因此通常不包括在内。您应该看到它们被使用的唯一地方是那些从不知道更好的 sql 查询开始的人。除此之外，它们只会使您的查询变得混乱。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T16:34:25.237

括号内的任何内容都被视为单个标识符（例如 [test machine]。这可用于将名称与空格括起来或转义保留字（例如 [order]、[select]、[group]）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-12T19:51:08.693

如果您使用与 sql 中的任何保留关键字相同的任何列名，在这种情况下，您可以将列名放在方括号中，以区分您的自定义列名和现有的保留关键字。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-01-27T08:18:09.520

当表名或文件名带有空格或破折号 (-) 等时...您会收到“FROM 子句中的系统税错误”。使用 [] 括号来解决这个问题。

请参阅：[https ://msdn.microsoft.com/en-us/library/ms175874.aspx](https://msdn.microsoft.com/en-us/library/ms175874.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T16:33:22.163

它们只是分隔符，允许您在列名或表名中放置特殊字符（如空格），例如

```
insert into [Table One] ([Column Name 1], columnname2) values (val1, val2) 
```

# class-design - 我应该如何将大而臃肿的类拆分成更小的类？

> ID：153863
> 
> 赞同：3
> 
> 时间：2008-09-30T16:31:00.610
> 
> 标签：class-design

我有一个大型的“经理”类，我认为它做得太多，但我不确定如何将它划分为更多的逻辑单元。

一般来说，该类基本上由以下方法组成：

```
FooBarManager 类
{
  GetFooEntities();
  AddFooEntity(..);
  UpdateFooEntity(..);
  提交FooEntity(..);
  GetFooTypes();
  GetBarEntities();
}

```

Manager 类是我的业务逻辑的一部分，它在数据访问级别包含另一个“Manager”类的实例，其中包含所有实体的所有 CRUD 操作。

我有来自数据访问层的不同实体，因此在 Manager 类之外有一个转换器来将数据实体转换为业务实体。

管理器类的原因是我希望在进行单元测试时能够模拟每个“管理器”类。每个管理器类现在都超过 1000 个 loc，每个包含 40-50 个方法。我认为它们非常臃肿，并且发现将所有数据访问逻辑放在一个类中很尴尬。我应该做些什么不同的事情？

我将如何拆分它们，我应该使用任何特定的设计模式吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T16:36:51.533

你真的不应该把所有的数据访问放到一个类中，除非它是通用的。我首先将您的数据访问类拆分为每个对象或相关对象组的一个管理器，即 CompanyManager、CustomerManager 等。如果您需要通过一个“上帝类”访问管理器，您可以拥有每个可用管理器的实例在您真正的经理课程中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T16:45:58.077

你`FooBarManager`看起来很像一个[上帝对象](http://en.wikipedia.org/wiki/God_object)的反模式。

在像您这样的情况下，请考虑深入研究Martin Fowler[的企业应用程序架构模式。](http://martinfowler.com/books.html#eaa)乍一看，您似乎想要创建一个[Data Mapper](http://martinfowler.com/eaaCatalog/dataMapper.html)。但是考虑一下[Active Record](http://martinfowler.com/eaaCatalog/activeRecord.html)之类的替代方案，这可能足以满足您的需求。

还可以考虑为您的平台使用[ORM 库/软件](http://en.wikipedia.org/wiki/List_of_object-relational_mapping_software)。在没有充分理由的情况下构建自己的工具只会让您面临这些工具或多或少已经解决的许多问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T16:40:39.137

```
 / FooManager
Manager                  (derive from Manager)
       \ BarManager 
```

应该不言自明

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T16:42:55.200

我建议使用组合。想想经理正在做什么。按照单一职责划分它们。看起来大部分 FooBarManager 是 Foo 和 bar 实体的集合。因此，至少从 FooBarManager 中分离出集合逻辑

```
public class EntityCollection<T> : IList<T> 
 where T : BaseEntity
{ /* all management logic here */}
public class FooCollection : EntityCollection<foo> {}
public class BarCollection : EntityCollection<bar> {}
public class FooBarManager 
{ 
public FooCollection { /*...*/ } 
public BarCollection { /*...*/ } 
public FooBarManager() : this(new FooCollection(), new BarCollection()){}
public FooBarManager(FooCollection fc, BarCollection bc) { /*...*/ } 
} 
```

# programming-languages - 什么是指针？

> ID：153874
> 
> 赞同：5
> 
> 时间：2008-09-30T16:32:28.313
> 
> 标签：programming-languages, pointers, language-features

### 请参阅：[了解指针](https://stackoverflow.com/questions/5727/understanding-pointers)

* * *

在许多 C 风格的语言和一些较旧的语言（如 Fortran）中，可以使用**Pointers**。

作为一个只真正使用基本、javascript 和 actionscript 编程的人，你能向我解释一下指针是什么，它最有用的是什么？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T16:34:09.307

这篇维基百科[文章](http://en.wikipedia.org/wiki/Pointer)将为您提供有关指针是什么的详细信息：

> 在计算机科学中，指针是一种编程语言数据类型，其值使用其地址直接引用（或“指向”）存储在计算机内存中其他位置的另一个值。获取或请求指针所指的值称为解引用指针。指针是通用引用数据类型的简单实现（尽管它与 C++ 中称为引用的工具有很大不同）。指向数据的指针提高了重复操作（例如遍历字符串和树结构）的性能，指向函数的指针用于面向对象编程中的绑定方法以及与动态链接库 (DLL) 的运行时链接。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T16:33:39.713

指针是一个包含另一个变量地址的变量。这允许您间接引用另一个变量。例如，在 C 中：

```
// x is an integer variable
int x = 5;
// xpointer is a variable that references (points to) integer variables
int *xpointer;
// We store the address (& operator) of x into xpointer.
xpointer = &x;
// We use the dereferencing operator (*) to say that we want to work with
// the variable that xpointer references
*xpointer = 7;
if (5 == x) {
    // Not true
} else if (7 == x) {
    // True since we used xpointer to modify x
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T16:42:58.460

指针并不像听起来那么难。正如其他人已经说过的那样，它们是保存其他变量地址的变量。假设我想给你指路到我家。我不会给你我房子的照片，或者我房子的比例模型；我只是给你地址。你可以从中推断出你需要的任何东西。

同样，许多语言都区分了值传递和引用传递。从本质上讲，这意味着我每次需要引用它时都会传递整个对象吗？或者，我会直接给出它的地址，以便其他人可以推断出他们需要什么？

大多数现代语言通过找出指针何时有用并为您优化来隐藏这种复杂性。但是，如果您知道自己在做什么，手动指针管理在某些情况下仍然很有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T16:38:11.577

SO中关于这个话题已经有好几次讨论了。您可以通过以下链接找到有关该主题的信息。关于这个主题还有其他几个相关的 SO 讨论，但我认为这些是最相关的。在搜索窗口中搜索“pointers [C++]”（或“pointers [c]”），您还将获得更多信息。

[在 C++ 中我无法掌握指针和类](https://stackoverflow.com/questions/96285/in-c-i-cannot-grasp-pointers-and-classes)

[现代“参考”和传统“指针”有什么区别？](https://stackoverflow.com/questions/92001/what-is-the-difference-between-modern-references-and-traditional-pointers)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-30T16:36:21.657

正如有人已经提到的，指针是一个包含另一个变量地址的变量。

它主要用于创建新对象（在运行时）。

# c# - .NET 中的 ManualResetEvent 和 AutoResetEvent 有什么区别？

> ID：153877
> 
> 赞同：560
> 
> 时间：2008-09-30T16:33:21.510
> 
> 标签：c#, .net, multithreading, autoresetevent, manualresetevent

我已经阅读了这方面的文档，我想我明白了。[`AutoResetEvent`](http://msdn.microsoft.com/en-us/library/system.threading.autoresetevent.aspx)当代码通过时，An会重置`event.WaitOne()`，但 a[`ManualResetEvent`](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx)不会。

它是否正确？

* * *

## 回答 #1

> 赞同：964
> 
> 时间：2008-09-30T17:03:07.443

是的。这就像收费站和门之间的区别。是门`ManualResetEvent`，需要手动关闭（重置）。这`AutoResetEvent`是一个收费站，允许一辆车经过并在下一辆车通过之前自动关闭。

* * *

## 回答 #2

> 赞同：134
> 
> 时间：2008-09-30T18:55:59.093

想象一下，`AutoResetEvent`执行`WaitOne()`并`Reset()`作为单个原子操作。

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2008-09-30T16:59:22.273

简短的回答是肯定的。最重要的区别是 AutoResetEvent 只允许一个等待线程继续。另一方面，ManualResetEvent 将继续允许线程，甚至同时几个线程继续，直到您告诉它停止（重置它）。

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2008-12-04T07:47:25.240

> 摘自 Joseph Albahari 的 C# 3.0 Nutshell 书

[C# 中的线程 - 免费电子书](http://www.albahari.com/threading/)

ManualResetEvent 是 AutoResetEvent 的变体。不同之处在于它不会在 WaitOne 调用允许线程通过后自动重置，因此其功能类似于门：调用 Set 打开门，允许 WaitOne 在门的任意数量的线程通过；调用 Reset 会关闭门，可能会导致等待者排队等待下一次打开。

可以使用布尔“gateOpen”字段（用 volatile 关键字声明）结合“spin-sleeping”来模拟此功能——重复检查标志，然后休眠一小段时间。

ManualResetEvents 有时用于表示特定操作已完成，或者线程已完成初始化并准备好执行工作。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2014-07-20T19:18:45.707

我创建了简单的示例来阐明对`ManualResetEvent`vs的理解`AutoResetEvent`。

`AutoResetEvent`：假设您有 3 个工作线程。如果这些线程中的任何一个将调用`WaitOne()`所有其他 2 个线程，则将停止执行并等待信号。我假设他们正在使用`WaitOne()`. 它像是; 如果我不工作，没有人工作。在第一个示例中，您可以看到

```
autoReset.Set();
Thread.Sleep(1000);
autoReset.Set(); 
```

当您调用时，`Set()`所有线程都将工作并等待信号。1 秒后，我发送第二个信号，它们执行并等待（`WaitOne()`）。想想这些家伙是足球队的球员，如果一个球员说我会等到经理给我打电话，而其他人会等到经理告诉他们继续（`Set()`）

```
public class AutoResetEventSample
{
    private AutoResetEvent autoReset = new AutoResetEvent(false);

    public void RunAll()
    {
        new Thread(Worker1).Start();
        new Thread(Worker2).Start();
        new Thread(Worker3).Start();
        autoReset.Set();
        Thread.Sleep(1000);
        autoReset.Set();
        Console.WriteLine("Main thread reached to end.");
    }

    public void Worker1()
    {
        Console.WriteLine("Entered in worker 1");
        for (int i = 0; i < 5; i++) {
            Console.WriteLine("Worker1 is running {0}", i);
            Thread.Sleep(2000);
            autoReset.WaitOne();
        }
    }
    public void Worker2()
    {
        Console.WriteLine("Entered in worker 2");

        for (int i = 0; i < 5; i++) {
            Console.WriteLine("Worker2 is running {0}", i);
            Thread.Sleep(2000);
            autoReset.WaitOne();
        }
    }
    public void Worker3()
    {
        Console.WriteLine("Entered in worker 3");

        for (int i = 0; i < 5; i++) {
            Console.WriteLine("Worker3 is running {0}", i);
            Thread.Sleep(2000);
            autoReset.WaitOne();
        }
    }
} 
```

在这个例子中你可以清楚地看到，当你第一次点击时`Set()`，它会让所有线程离开，然后在 1 秒后它会向所有线程发出等待的信号！只要您再次设置它们，无论它们是否`WaitOne()`在内部调用，它们都会继续运行，因为您必须手动调用`Reset()`才能将它们全部停止。

```
manualReset.Set();
Thread.Sleep(1000);
manualReset.Reset();
Console.WriteLine("Press to release all threads.");
Console.ReadLine();
manualReset.Set(); 
```

更多的是关于裁判/球员的关系，无论任何球员受伤并等待比赛，其他球员都会继续工作。如果裁判说等待（`Reset()`），那么所有球员都将等到下一个信号。

```
public class ManualResetEventSample
{
    private ManualResetEvent manualReset = new ManualResetEvent(false);

    public void RunAll()
    {
        new Thread(Worker1).Start();
        new Thread(Worker2).Start();
        new Thread(Worker3).Start();
        manualReset.Set();
        Thread.Sleep(1000);
        manualReset.Reset();
        Console.WriteLine("Press to release all threads.");
        Console.ReadLine();
        manualReset.Set();
        Console.WriteLine("Main thread reached to end.");
    }

    public void Worker1()
    {
        Console.WriteLine("Entered in worker 1");
        for (int i = 0; i < 5; i++) {
            Console.WriteLine("Worker1 is running {0}", i);
            Thread.Sleep(2000);
            manualReset.WaitOne();
        }
    }
    public void Worker2()
    {
        Console.WriteLine("Entered in worker 2");

        for (int i = 0; i < 5; i++) {
            Console.WriteLine("Worker2 is running {0}", i);
            Thread.Sleep(2000);
            manualReset.WaitOne();
        }
    }
    public void Worker3()
    {
        Console.WriteLine("Entered in worker 3");

        for (int i = 0; i < 5; i++) {
            Console.WriteLine("Worker3 is running {0}", i);
            Thread.Sleep(2000);
            manualReset.WaitOne();
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-06-23T14:37:00.090

`autoResetEvent.WaitOne()`

类似于

```
try
{
   manualResetEvent.WaitOne();
}
finally
{
   manualResetEvent.Reset();
} 
```

作为原子操作

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2017-04-14T15:02:07.893

好的，通常在同一个线程中添加 2 个答案不是一个好习惯，但我不想编辑/删除我以前的答案，因为它可以以另一种方式提供帮助。

现在，我在下面创建了更全面、更易于理解的运行学习控制台应用程序片段。

只需在两个不同的控制台上运行示例，然后观察行为。您将更清楚地了解幕后发生的事情。

**手动复位事件**

```
using System;
using System.Threading;

namespace ConsoleApplicationDotNetBasics.ThreadingExamples
{
    public class ManualResetEventSample
    {
        private readonly ManualResetEvent _manualReset = new ManualResetEvent(false);

        public void RunAll()
        {
            new Thread(Worker1).Start();
            new Thread(Worker2).Start();
            new Thread(Worker3).Start();
            Console.WriteLine("All Threads Scheduled to RUN!. ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);
            Console.WriteLine("Main Thread is waiting for 15 seconds, observe 3 thread behaviour. All threads run once and stopped. Why? Because they call WaitOne() internally. They will wait until signals arrive, down below.");
            Thread.Sleep(15000);
            Console.WriteLine("1- Main will call ManualResetEvent.Set() in 5 seconds, watch out!");
            Thread.Sleep(5000);
            _manualReset.Set();
            Thread.Sleep(2000);
            Console.WriteLine("2- Main will call ManualResetEvent.Set() in 5 seconds, watch out!");
            Thread.Sleep(5000);
            _manualReset.Set();
            Thread.Sleep(2000);
            Console.WriteLine("3- Main will call ManualResetEvent.Set() in 5 seconds, watch out!");
            Thread.Sleep(5000);
            _manualReset.Set();
            Thread.Sleep(2000);
            Console.WriteLine("4- Main will call ManualResetEvent.Reset() in 5 seconds, watch out!");
            Thread.Sleep(5000);
            _manualReset.Reset();
            Thread.Sleep(2000);
            Console.WriteLine("It ran one more time. Why? Even Reset Sets the state of the event to nonsignaled (false), causing threads to block, this will initial the state, and threads will run again until they WaitOne().");
            Thread.Sleep(10000);
            Console.WriteLine();
            Console.WriteLine("This will go so on. Everytime you call Set(), ManualResetEvent will let ALL threads to run. So if you want synchronization between them, consider using AutoReset event, or simply user TPL (Task Parallel Library).");
            Thread.Sleep(5000);
            Console.WriteLine("Main thread reached to end! ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);

        }

        public void Worker1()
        {
            for (int i = 1; i <= 10; i++)
            {
                Console.WriteLine("Worker1 is running {0}/10\. ThreadId: {1}.", i, Thread.CurrentThread.ManagedThreadId);
                Thread.Sleep(5000);
                // this gets blocked until _autoReset gets signal
                _manualReset.WaitOne();
            }
            Console.WriteLine("Worker1 is DONE. ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);
        }
        public void Worker2()
        {
            for (int i = 1; i <= 10; i++)
            {
                Console.WriteLine("Worker2 is running {0}/10\. ThreadId: {1}.", i, Thread.CurrentThread.ManagedThreadId);
                Thread.Sleep(5000);
                // this gets blocked until _autoReset gets signal
                _manualReset.WaitOne();
            }
            Console.WriteLine("Worker2 is DONE. ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);
        }
        public void Worker3()
        {
            for (int i = 1; i <= 10; i++)
            {
                Console.WriteLine("Worker3 is running {0}/10\. ThreadId: {1}.", i, Thread.CurrentThread.ManagedThreadId);
                Thread.Sleep(5000);
                // this gets blocked until _autoReset gets signal
                _manualReset.WaitOne();
            }
            Console.WriteLine("Worker3 is DONE. ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);
        }
    }

} 
```

[![手动复位事件输出](https://i.stack.imgur.com/tvKU2.png)](https://i.stack.imgur.com/tvKU2.png)

**自动重置事件**

```
using System;
using System.Threading;

namespace ConsoleApplicationDotNetBasics.ThreadingExamples
{
    public class AutoResetEventSample
    {
        private readonly AutoResetEvent _autoReset = new AutoResetEvent(false);

        public void RunAll()
        {
            new Thread(Worker1).Start();
            new Thread(Worker2).Start();
            new Thread(Worker3).Start();
            Console.WriteLine("All Threads Scheduled to RUN!. ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);
            Console.WriteLine("Main Thread is waiting for 15 seconds, observe 3 thread behaviour. All threads run once and stopped. Why? Because they call WaitOne() internally. They will wait until signals arrive, down below.");
            Thread.Sleep(15000);
            Console.WriteLine("1- Main will call AutoResetEvent.Set() in 5 seconds, watch out!");
            Thread.Sleep(5000);
            _autoReset.Set();
            Thread.Sleep(2000);
            Console.WriteLine("2- Main will call AutoResetEvent.Set() in 5 seconds, watch out!");
            Thread.Sleep(5000);
            _autoReset.Set();
            Thread.Sleep(2000);
            Console.WriteLine("3- Main will call AutoResetEvent.Set() in 5 seconds, watch out!");
            Thread.Sleep(5000);
            _autoReset.Set();
            Thread.Sleep(2000);
            Console.WriteLine("4- Main will call AutoResetEvent.Reset() in 5 seconds, watch out!");
            Thread.Sleep(5000);
            _autoReset.Reset();
            Thread.Sleep(2000);
            Console.WriteLine("Nothing happened. Why? Becasuse Reset Sets the state of the event to nonsignaled, causing threads to block. Since they are already blocked, it will not affect anything.");
            Thread.Sleep(10000);
            Console.WriteLine("This will go so on. Everytime you call Set(), AutoResetEvent will let another thread to run. It will make it automatically, so you do not need to worry about thread running order, unless you want it manually!");
            Thread.Sleep(5000);
            Console.WriteLine("Main thread reached to end! ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);

        }

        public void Worker1()
        {
            for (int i = 1; i <= 5; i++)
            {
                Console.WriteLine("Worker1 is running {0}/5\. ThreadId: {1}.", i, Thread.CurrentThread.ManagedThreadId);
                Thread.Sleep(500);
                // this gets blocked until _autoReset gets signal
                _autoReset.WaitOne();
            }
            Console.WriteLine("Worker1 is DONE. ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);
        }
        public void Worker2()
        {
            for (int i = 1; i <= 5; i++)
            {
                Console.WriteLine("Worker2 is running {0}/5\. ThreadId: {1}.", i, Thread.CurrentThread.ManagedThreadId);
                Thread.Sleep(500);
                // this gets blocked until _autoReset gets signal
                _autoReset.WaitOne();
            }
            Console.WriteLine("Worker2 is DONE. ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);
        }
        public void Worker3()
        {
            for (int i = 1; i <= 5; i++)
            {
                Console.WriteLine("Worker3 is running {0}/5\. ThreadId: {1}.", i, Thread.CurrentThread.ManagedThreadId);
                Thread.Sleep(500);
                // this gets blocked until _autoReset gets signal
                _autoReset.WaitOne();
            }
            Console.WriteLine("Worker3 is DONE. ThreadId: {0}", Thread.CurrentThread.ManagedThreadId);
        }
    }

} 
```

[![自动复位事件输出](https://i.stack.imgur.com/hyLp4.png)](https://i.stack.imgur.com/hyLp4.png)

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2016-12-11T10:38:19.783

**AutoResetEvent**在内存中维护一个布尔变量。如果布尔变量为假，则阻塞线程，如果布尔变量为真，则解除线程阻塞。

当我们实例化一个 AutoResetEvent 对象时，我们在构造函数中传递布尔值的默认值。下面是实例化 AutoResetEvent 对象的语法。

```
AutoResetEvent autoResetEvent = new AutoResetEvent(false); 
```

**WaitOne 方法**

该方法阻塞当前线程并等待其他线程的信号。WaitOne 方法将当前线程置于睡眠线程状态。如果 WaitOne 方法收到信号则返回 true，否则返回 false。

```
autoResetEvent.WaitOne(); 
```

WaitOne 方法的第二次重载等待指定的秒数。如果它没有得到任何信号线程继续它的工作。

```
static void ThreadMethod()
{
    while(!autoResetEvent.WaitOne(TimeSpan.FromSeconds(2)))
    {
        Console.WriteLine("Continue");
        Thread.Sleep(TimeSpan.FromSeconds(1));
    }

    Console.WriteLine("Thread got signal");
} 
```

我们通过将 2 秒作为参数传递来调用 WaitOne 方法。在 while 循环中，它等待信号 2 秒，然后继续工作。当线程收到信号时，WaitOne 返回 true 并退出循环并打印“线程收到信号”。

**设置方法**

AutoResetEvent Set 方法将信号发送到等待线程以继续其工作。下面是调用 Set 方法的语法。

```
autoResetEvent.Set(); 
```

* * *

**ManualResetEvent**在内存中维护一个布尔变量。当布尔变量为假时，它会阻塞所有线程，当布尔变量为真时，它会解除对所有线程的阻塞。

当我们实例化一个 ManualResetEvent 时，我们用默认的布尔值初始化它。

```
ManualResetEvent manualResetEvent = new ManualResetEvent(false); 
```

在上面的代码中，我们将 ManualResetEvent 初始化为 false 值，这意味着所有调用 WaitOne 方法的线程都会阻塞，直到某个线程调用 Set() 方法。

如果我们将 ManualResetEvent 初始化为 true 值，那么所有调用 WaitOne 方法的线程都不会阻塞并可以自由地继续进行。

**WaitOne 方法**

该方法阻塞当前线程并等待其他线程的信号。如果接收到信号，则返回 true，否则返回 false。

下面是调用 WaitOne 方法的语法。

```
manualResetEvent.WaitOne(); 
```

在 WaitOne 方法的第二次重载中，我们可以指定到当前线程等待信号的时间间隔。如果在内部时间之内，它没有收到信号，它返回 false 并进入下一行方法。

下面是使用时间间隔调用 WaitOne 方法的语法。

```
bool isSignalled = manualResetEvent.WaitOne(TimeSpan.FromSeconds(5)); 
```

我们在 WaitOne 方法中指定了 5 秒。如果 manualResetEvent 对象在 5 秒内没有收到信号，它会将 isSignalled 变量设置为 false。

设置方法

该方法用于向所有等待线程发送信号。Set() 方法将 ManualResetEvent 对象布尔变量设置为 true。所有等待的线程都被解除阻塞并继续进行。

下面是调用 Set() 方法的语法。

```
manualResetEvent.Set(); 
```

**重置方法**

一旦我们在 ManualResetEvent 对象上调用 Set() 方法，它的布尔值就保持为真。要重置值，我们可以使用 Reset() 方法。Reset 方法将布尔值更改为 false。

下面是调用 Reset 方法的语法。

```
manualResetEvent.Reset(); 
```

如果我们想多次向线程发送信号，我们必须在调用 Set 方法后立即调用 Reset 方法。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-30T17:36:05.150

是的。这是绝对正确的。

您可以将 ManualResetEvent 视为指示状态的一种方式。某些东西打开（设置）或关闭（重置）。具有一定持续时间的事件。任何等待该状态发生的线程都可以继续。

AutoResetEvent 更类似于信号。一枪表明发生了什么事。没有任何持续时间的事件。通常但不一定发生的“事情”很小，需要由单个线程处理 - 因此在单个线程消耗事件后自动重置。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2012-04-20T08:48:18.717

是的，这是正确的。

您可以通过使用这两个来获得一个想法。

如果您需要告诉您已完成某些工作并且等待此操作的其他（线程）现在可以继续，您应该使用 ManualResetEvent。

如果您需要对任何资源进行互斥访问，则应使用 AutoResetEvent。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-04-19T10:29:39.140

如果您想了解 AutoResetEvent 和 ManualResetEvent，您需要了解的不是线程而是中断！

.NET 希望在最遥远的地方实现低级编程。

中断是低级编程中使用的东西，它等于从低电平变为高电平的信号（反之亦然）。发生这种情况时，程序会中断其正常执行并将执行指针移动到处理此*事件*的函数。

发生中断时要做的第一件事是**重置**其状态，因为硬件以这种方式工作：

1.  一个引脚连接到一个信号，硬件监听它的变化（信号可能只有两种状态）。
2.  如果信号发生变化意味着发生了某些事情，并且硬件将**内存变量**置于发生的状态（即使信号再次发生变化，它也会保持这种状态）。
3.  程序注意到变量改变状态并将执行移至处理函数。
4.  这里要做的第一件事，就是能够再次监听这个中断，就是将这个内存变量**重置**为未发生的状态。

这就是 ManualResetEvent 和 AutoResetEvent 之间的区别。
**如果 ManualResetEvent 发生并且我没有重置它，那么下次它发生时我将无法收听它。**

# windows - 如何从命令行向注册表添加多行 REG_SZ 字符串？

> ID：153879
> 
> 赞同：7
> 
> 时间：2008-09-30T16:33:33.053
> 
> 标签：windows, registry, batch-file

作为 Windows 机器上构建设置的一部分，我需要添加一个注册表项，我想从一个简单的批处理文件中完成。

该条目适用于第三方应用程序，因此格式是固定的。

该条目采用 REG_SZ 字符串的形式，但需要包含换行符，即。0xOA 字符作为分隔符。

我遇到了一些问题。

第一次尝试使用 regedit 加载生成的 .reg 文件。这失败了，因为它似乎既不喜欢长字符串也不喜欢带有换行符的字符串。我发现导出工作正常导入失败。我能够测试导出，因为第三方应用程序直接通过 win32 api 添加了类似的条目。

第二次尝试使用命令 REG ADD 但我无论如何都找不到添加换行符我尝试的所有内容都以添加文字字符串结束。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T17:18:04.880

如果您不受脚本语言的限制，您可以在 C# 中使用

```
Registry.CurrentUser.OpenSubKey(@"software\classes\something", true).SetValue("some key", "sometext\nothertext", RegistryValueKind.String); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-11-06T16:22:23.473

您可以使用 .reg 文件将包含回车符 (CR) 和换行符 (LF) 换行符 (EOL) 的多行 REG_SZ 字符串导入注册表，只要您不介意将文本翻译为 UTF-16LE 十六进制编码数据. 要使用此文本导入 REG_SZ：

```
第一行
第二行

```

您可以创建一个名为 MULTILINETEXT.REG 的文件，其中包含以下内容：

```
Windows 注册表编辑器版本 5.00

[HKEY_CURRENT_USER\环境]
"MULTILINETEXT"=hex(1):31,00,73,00,74,00,20,00,4c,00,69,00,6e,00,65,00,0d,00,0a,00,\
32,00,6e,00,64,00,20,00,4c,00,69,00,6e,00,65,00,0d,00,0a,00,\
00,00

```

要将 ASCII 编码为 UTF-16LE，只需在每个 ASCII 代码值之后添加一个空字节。`,00,00`REG_SZ 值必须以 UTF-16LE 表示法中的空字符 ( ) 结尾。

在批处理文件中导入注册表更改`REG.EXE IMPORT MULTILINETEXT.REG`。

该示例使用 Environment 键是因为它方便，而不是因为将此类数据添加到环境变量中特别有用。可以使用 RegEdit 来验证导入的 REG_SZ 数据是否包含 CRLF 字符。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T16:50:16.290

您可以创建一个 VBScript(.vbs) 文件并从批处理文件中调用它，假设您在批处理中执行此注册表更改以外的其他操作。在 vbscript 中，您将看到如下内容：

```
set WSHShell = CreateObject("WScript.Shell")  
WSHShell.RegWrite "HKEY_LOCAL_MACHINE\SOMEKEY", "value", "type" 
```

您应该能够使用 Google 找到可能的类型值。

# ruby-on-rails - 你什么时候不想在 Ruby on Rails 应用程序中使用 memcached？

> ID：153889
> 
> 赞同：4
> 
> 时间：2008-09-30T16:34:38.650
> 
> 标签：ruby-on-rails, ruby, memcached

假设一个 MySQL 数据存储，你什么时候不想在 Ruby on Rails 应用程序中使用 memcached？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T16:42:46.340

如果您的应用程序能够快速处理所有请求，请不要使用 memcached。在编写应用程序时，添加 memcached 会带来额外的心理开销，因此除非您需要，否则不要这样做。

缩放的“[一大难题](http://gettingreal.37signals.com/ch04_Scale_Later.php)”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T17:56:33.057

Memcache 是一个强大的分布式缓存，但对于某些内容来说并不比本地缓存快。缓存应该允许您避免瓶颈，通常是数据库请求和网络请求。如果您可以在本地将整个页面缓存为 HTML，因为它不会经常更改（不是很动态），那么您的 Web 服务器可以比查询 memcache 更快地提供它。如果您的 memcache 服务器与大多数 memcached 服务器一样位于不同的机器上，则尤其如此。

另一方面，我有时会在本地使用 memcache 而不是其他缓存选项，因为我知道有一天我需要将它移到自己的服务器上。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-01T22:39:32.703

memcached 的主要好处是它是一个*分布式*缓存。这意味着您可以生成一次，并从多个服务器的缓存中提供服务（这就是创建 memcached 的原因）。之前的所有答案似乎都忽略了这一点——这让我想知道他们是否曾经必须构建一个高度可扩展的应用程序（这正是 memcached 的用途）

> Danga Interactive 开发了 memcached 来提高 LiveJournal.com 的速度，该网站已经为 100 万用户提供了每天超过 2000 万次动态页面浏览量， **拥有一堆网络服务器和一堆数据库服务器**。memcached 将数据库负载降低到几乎为零，从而为用户提供更快的页面加载时间、更好的资源利用率以及在 memcache 未命中时更快地访问数据库。

（我的粗体字）

所以答案是：如果您的应用程序只可能部署在单个服务器上。

如果您可能使用多个服务器（用于可伸缩性和冗余），那么 memcached （几乎）总是一个好主意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T00:58:35.397

当您想对过期的事物进行细粒度控制时。根据我的测试，memcached 似乎只有大约一秒的时间分辨率。

EG：如果你告诉某个东西在 1 秒后过期，它可能会停留 1 到 2 秒多一点。

# c - 在 C 中打印前导 0

> ID：153890
> 
> 赞同：389
> 
> 时间：2008-09-30T16:34:43.817
> 
> 标签：c, printf

我正在尝试找到一种打印前导的好方法，`0`例如[ZIP Code](https://en.wikipedia.org/wiki/ZIP_Code)。虽然数字将存储为，但有什么好的方法呢？`01001``1001`

我曾想过使用任一`case`语句或`if`找出数字的位数，然后将其转换为`char`带有额外 's 的数组以`0`进行打印，但我不禁认为可能有一种方法可以使用`printf`格式语法来做到这一点这让我望而却步。

* * *

## 回答 #1

> 赞同：638
> 
> 时间：2008-09-30T16:36:18.587

```
printf("%05d", zipCode); 
```

`0`指示您要填充的内容，并显示`5`整数的宽度。

示例 1：如果您使用`"%02d"`（对日期有用），这只会为个数列中的数字填充零。例如，`06`代替`6`.

示例 2：`"%03d"`将为个列中的一个数字填充 2 个零，为十列中的一个数字填充 1 个零。例如，数字 7 填充到`007`和数字 17 填充到`017`。

* * *

## 回答 #2

> 赞同：174
> 
> 时间：2008-09-30T16:39:49.387

正确的解决方案是将邮政编码作为字符串存储在数据库中。尽管它可能看起来像一个数字，但事实并非如此。这是一个代码，每个部分都有意义。

数字是你做算术的东西。邮政编码不是那样。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2008-09-30T16:36:37.103

您在最小字段宽度之前放置一个零：

```
printf("%05d", zipcode); 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-09-30T16:37:38.597

```
sprintf(mystring, "%05d", myInt); 
```

在这里，“05”表示“使用前导零的 5 位数字”。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-09-30T16:37:12.453

如果您在 *nix 机器上：

```
man 3 printf 
```

这将显示一个手册页，类似于：

> 0 该值应为零填充。对于 d、i、o、u、x、X、a、A、e、E、f、F、g 和 G 转换，转换后的值在左侧用零而不是空白填充。如果 0 和 - 标志都出现，则 0 标志被忽略。如果使用数字转换（d、i、o、u、x 和 X）给出精度，则忽略 0 标志。对于其他转换，行为未定义。

尽管问题是针对 C 的，[但此](http://www.cplusplus.com/reference/cstdio/printf/)页面可能会有所帮助。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-09-30T16:42:49.100

邮政编码是一个高度本地化的字段，许多国家的邮政编码中都有字符，例如英国、加拿大。因此，在此示例中，如果您在任何时候要从其他国家/地区运送或获取用户、客户、客户等，您应该使用字符串/varchar 字段来存储它。

但是，在一般情况下，您应该使用推荐的答案 ( `printf("%05d", number);`)。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-30T16:36:36.057

*printf*允许各种格式化选项。

例子：

```
printf("leading zeros %05d", 123); 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2021-02-06T22:32:57.550

有两种方法可以输出带有前导零的数字：

使用`0`标志和宽度说明符：

```
int zipcode = 123;
printf("%05d\n", zipcode);  // Outputs 00123 
```

使用精度说明符：

```
int zipcode = 123;
printf("%.5d\n", zipcode);  // Outputs 00123 
```

它们之间的区别在于对负数的处理：

```
printf("%05d\n", -123);  // Outputs -0123 (pad to 5 characters)
printf("%.5d\n", -123);  // Outputs -00123 (pad to 5 digits) 
```

邮政编码不太可能是负数，所以这无关紧要。

但请注意，邮政编码实际上可能包含字母和破折号，因此它们应存储为字符串。在字符串中包含前导零很简单，因此它以更简单的方式解决了您的问题。

请注意，在上面的两个示例中，`5`宽度或精度值都可以指定为`int`参数：

```
int width = 5;
printf("%0*d\n", width, 123);  // Outputs 00123
printf("%.*d\n", width, 123);  // Outputs 00123 
```

还有一个技巧要知道：精度`0`导致 value 没有输出`0`：

```
printf("|%0d|%0d|\n", 0, 1);   // Outputs |0|1|
printf("|%.0d|%.0d|\n", 0, 1); // Outputs ||1| 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T17:34:26.370

如果您将邮政编码存储为字符串，而不是数字，那么您将为自己省去一大堆麻烦（长期）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-04-19T06:59:59.630

更灵活.. 这是一个打印具有固定宽度和空格填充的右对齐数字行的示例。

```
//---- Header
std::string getFmt ( int wid, long val )
{  
  char buf[64];
  sprintf ( buf, "% *ld", wid, val );
  return buf;
}
#define FMT (getFmt(8,x).c_str())

//---- Put to use
printf ( "      COUNT     USED     FREE\n" );
printf ( "A: %s %s %s\n", FMT(C[0]), FMT(U[0]), FMT(F[0]) );
printf ( "B: %s %s %s\n", FMT(C[1]), FMT(U[1]), FMT(F[1]) );
printf ( "C: %s %s %s\n", FMT(C[2]), FMT(U[2]), FMT(F[2]) );

//-------- Output
      COUNT     USED     FREE
A:      354   148523     3283
B: 54138259 12392759   200391
C:    91239     3281    61423 
```

函数和宏的设计使 printfs 更具可读性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-06-19T14:30:01.000

如果您需要将邮政编码存储在字符数组中`zipcode[]`，您可以使用：

```
snprintf(zipcode, 6, "%05.5d", atoi(zipcode)); 
```

# javascript - 为什么我的 JavaScript 函数有时“未定义”？

> ID：153909
> 
> 赞同：42
> 
> 时间：2008-09-30T16:38:57.377
> 
> 标签：javascript

我调用我的 JavaScript 函数。为什么在定义时*有时会*收到错误“myFunction is not defined *”*？

例如。即使在此示例中，我偶尔也会收到“未定义 copyArray”：

```
function copyArray( pa ) {
    var la = [];
    for (var i=0; i < pa.length; i++)
        la.push( pa[i] );
    return la;
}

Function.prototype.bind = function( po ) {
    var __method = this;
    var __args = [];

    // Sometimes errors -- in practice I inline the function as a workaround.
    __args = copyArray( arguments );

    return function() {
        /* bind logic omitted for brevity */
    }
} 
```

如您所见， copyArray 是在此处定义*的*，因此这与脚本文件加载的顺序无关。

我一直在更难解决的情况下得到这个，其中调用函数位于另一个文件中，*应该*在被调用函数之后加载。但这是我能提出的最简单的情况，而且似乎是同样的问题。

它不会 100% 发生，所以我确实怀疑某种与加载时间相关的问题。但我不知道是什么。

@Hojou：这是问题的一部分。我现在收到此错误的函数本身就是我的 addLoadEvent，它基本上是公共库函数的标准版本。

@James：我明白，函数中没有语法错误。在这种情况下，也会报告语法错误。在这种情况下，我只收到“未定义”错误。

@David：在这种情况下，脚本位于一个外部文件中，该文件使用页面头部的普通 <script src="file.js"></script> 方法引用。

@Douglas：有趣的想法，但如果是这样的话，我们怎么能*自信*地调用用户定义的函数呢？无论如何，我尝试了这个，但没有奏效。

@sk：这项技术已经过跨浏览器测试，基本上是从[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)库复制而来的。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2010-03-21T04:56:55.950

尽管 Chromium 可以很好地处理它，但我没有按照最新的 Firefox for Linux 中的定义来识别这个函数。

在我的情况下发生的事情是`SCRIPT`，在定义有问题的函数的块之前，我有一个前块，如下所示：

```
<SCRIPT src="mycode.js"/> 
```

（也就是说，没有结束标签。）

我不得不通过以下方式重新声明这个块。

```
<SCRIPT src="mycode.js"></SCRIPT> 
```

然后接下来的工作很好......很奇怪吧？

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T16:47:14.033

如果您只是在页面上包含脚本，则不可能发生这种情况。

当 JavaScript 代码开始执行时，无论是在它之前还是之后声明，“copyArray”函数都应该始终可用——除非您使用依赖库动态加载 JavaScript 文件。如果是这样的话，时间安排上就会出现各种各样的问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T16:42:54.637

我的猜测是，在调用该方法时，文档并没有完全加载。在文档就绪事件之后执行您的代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-03T10:48:42.863

[使用JSLint](http://www.jslint.com/)验证您的代码。它通常会发现大量小错误，因此“JSLint 可能会伤害您的感受”的警告非常准确。=)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T16:44:49.983

函数中的语法错误——或者在它上面的代码中——可能会导致它未定义。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T16:54:30.337

如果您要更改内置“函数”对象的原型，则可能会通过修改基本内置对象而遇到浏览器错误或竞争条件。

在多个浏览器中测试它以找出答案。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T18:34:05.883

这并不能解决您最初的问题，但您始终可以将调用替换为`copyArray()`：

```
__args = Array.prototype.slice.call(arguments); 
```

[可从Google](http://www.google.com/search?q=array.prototype.slice.call)获得更多信息。

我已经在以下浏览器中测试了上述内容：IE6、7 和 8B2、Firefox 2.0.0.17 和 3.0.3、Opera 9.52、适用于 Windows 3.1.2 的 Safari 和 Google Chrome（无论在本文发布时的最新版本是什么） ) 它适用于所有浏览器。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-06-18T18:44:48.503

这可能已经更正了，但是......显然firefox有一个缓存问题，这是导致javascript函数无法识别的原因。我真的不知道具体细节，但如果你清除缓存将解决问题（直到你的缓存又满了......不是一个好的解决方案）..我一直在四处寻找Firefox是否有真正的解决方案，但到目前为止还没有......哦不是所有版本，我认为它可能只是在某些 3.6.x 版本中，不确定...

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-08-28T20:39:01.617

通过删除“异步”负载解决：

```
 <script type="text/javascript" src="{% static 'js/my_js_file.js' %}" async></script> 
```

更改为：

```
 <script type="text/javascript" src="{% static 'js/my_js_file.js' %}"></script> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T16:50:05.917

使用匿名函数来保护您的本地符号表。就像是：

```
(function() {
    function copyArray(pa) {
        // Details
    }

    Function.prototype.bind = function ( po ) {
        __args = copyArray( arguments );
    }
})(); 
```

这将创建一个在本地符号表中包含您的函数的闭包，并且当您调用该函数时，您不必依赖它在全局命名空间中是否可用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-30T18:29:58.250

恐怕，当您向 Function 类添加新方法时（通过 prtotyping），您实际上是将其添加到所有声明的函数中，以及您的 copyArray() 中。结果，您的 copyArray() 函数被递归地自引用。即应该存在调用自身的copyArray().bind() 方法。

在这种情况下，某些浏览器可能会阻止您创建此类引用循环并触发“函数未定义”错误。

在这种情况下，内联代码将是更好的解决方案。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-06-17T16:49:12.513

使用框架集时可能会发生这种情况。在一帧中，定义了我的变量和方法。在另一个，他们不是。当使用调试器并看到我的变量已定义，然后在框架内的断点处未定义时，这尤其令人困惑。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-09-19T07:41:02.057

我认为你的javascript代码应该放在标签之间，需要文件加载

# asp.net - 如何从 SQL Server 支持的 ASP.NET 会话状态中获取密钥列表？

> ID：153912
> 
> 赞同：0
> 
> 时间：2008-09-30T16:39:50.887
> 
> 标签：asp.net, session

我正在寻找一种可视化存储在 SQL 服务器中的 ASP.NET 会话状态数据的好方法，最好不要创建一次性的 .aspx 页面。有没有直接从 SQL Server 获取键列表（和序列化数据，如果可能）的好方法？

理想情况下，我想直接对数据库运行一些 T-SQL 命令，以获取为给定会话 ID 存储的会话密钥列表。也很高兴看到每个键的序列化数据。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-30T19:37:59.867

您能否稍微详细说明一下，是否没有对可用的 HttpContext 的引用（您也可以从后端代码中使用它，仅供参考），这会阻止您使用内置的序列化和键字典？

编辑，以响应您的更新。我相信 ASPState 数据库根据需要创建和销毁临时表，它没有可以查询的永久表，看看存储过程，你应该找到一个沿着“TempGetItem”行的，你可以直接使用这个存储过程，或检查其来源以获得更多见解。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-04-04T13:07:56.860

当您使用 sql server 会话模式运行 asp.net 应用程序时，它会创建两个表，dbo.ASPStateTempApplications 和 dbo.ASPStateTempSessions。您可以从第一个表中找到您的应用程序，并使用它从第二个表中查询打开的会话。ASPStateTempSessions 表存储两列 SessionDataShort 和 SessionDataLong。所有会话信息都是二进制的。如果您想再次反序列化它们并查看内容，您需要知道存储在会话中的对象类型。

我最近试过这个，效果很好。事实上，对于复杂的应用程序，值得拥有一些工具来查看和解析会话数据，以确保我们不会存储不需要的对象并将其长时间留在数据库中 - 它有可能减慢速度。

# php - php + unixODBC + DB2 + DESCRIBE = 令牌无效？

> ID：153920
> 
> 赞同：1
> 
> 时间：2008-09-30T16:41:24.640
> 
> 标签：php, db2, ibm-midrange, unixodbc, db2-400

我试图运行的代码：

```
$query = "DESCRIBE TABLE TABLENAME";
$result = odbc_exec($h, $query); 
```

结果：

> PHP 警告：odbc_exec()：SQL 错误：[unixODBC][IBM][iSeries Access ODBC Driver][DB2 UDB]SQL0104 - 令牌 TABLENAME 无效。有效标记：INTO., SQL 状态 37000 in SQLExecDirect in ...

同一连接上的 SELECT、INSERT、UPDATE 或 DELETE 查询没有其他问题。这是语法错误吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T19:34:10.560

DB2 的 iSeries 风格不支持 SQL DESCRIBE 语句。相反，您必须查询系统表：

```
select * from qsys2.columns where table_schema = 'my_schema' and table_name = 'my_table' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T20:32:28.677

> 该语句只能嵌入应用程序中。它是一个不能动态准备的可执行语句。它不能在 Java 中指定。

来自 iSeries DB2 SQL 参考。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T17:48:41.283

对我来说，您似乎需要为语句提供一种返回值“有效令牌：INTO”告诉我的方法。我以前没有使用过 DESCRIBE，但我想它会返回一些东西。

Interactive SQL 不允许使用该命令，因此我无法为您提供更多帮助。

顺便说一句，将 iSeries 标签添加到您的问题中。这样你可能会得到更多的答案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-06T10:57:13.007

如果您只需要列名，请尝试

```
select * from <TABLE> where 0 = 1 
```

我不知道如何获取列类型、索引、键等

# tfs - 我可以查看带有标签的 TFS 文件历史记录吗？

> ID：153928
> 
> 赞同：31
> 
> 时间：2008-09-30T16:43:20.237
> 
> 标签：tfs, labels

我们目前在工作中同时使用 Visual Source Safe 和 Team Foundation Server（VSS 用于旧项目，TFS 用于当前或新项目）。

我们一直在每次构建的源代码控制中使用标签。在 VSS 中，如果您选择查看文件历史记录，您可以包含标签。在 TFS 中，我找不到将标签包含在历史窗口中的选项。

由于支持或管理层问我的最常见问题之一是“我们修复/添加/删除/更改 xxxx 的版本是什么？”，我一直依赖历史中显示的构建标签。

我可以让标签显示在文件历史记录中吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-30T20:05:56.523

在 2008 版的 TFS 中，您不会在文件和文件夹的标准历史记录中看到标签。如果您真的想知道原因 - 请参阅 Brian Harry 的博客文章“[为什么 TFS 标签不像 VSS 标签](http://blogs.msdn.com/bharry/archive/2005/11/18/494439.aspx)”。

要在 Visual Studio 中查找标签，请转到文件、源代码管理、标签、查找标签...从中可以看到该标签中包含哪些文件版本。

团队肯定听说这并不理想，下一个版本的 TFS（Team Foundation Server 2010，代号为“Rosario”）将包括对历史视图的改进，以使标签更容易找到 - 请参阅[http://go.microsoft .com/?linkid=7807943](http://go.microsoft.com/?linkid=7807943)以了解 TFS 2010 中历史视图的改进规范。

顺便说一句 - 我实际上使用 TFS 转移到基于变更集的构建编号，这使得标记的必要性降低。有关详细信息，请参阅[http://www.woodwardweb.com/vsts/changeset_based.html 。](http://www.woodwardweb.com/vsts/changeset_based.html)

希望有帮助，

马丁。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-09-15T14:14:57.423

这个问题一直在扼杀我们。

我发现的最佳解决方案是使用名为 Team Foundation SideKicks 的第三方工具，可在此处免费获得[http://www.attrice.info/cm/tfs/](http://www.attrice.info/cm/tfs/)。

在“History Sidekick”下有一个标签选项卡。您可以突出显示任何文件夹或文件，它会显示放置在该文件夹或文件上的每个标签以及更改集的位置。不幸的是，您无法查看包含标签的文件夹或文件历史记录的完整视图。

在“Label Sidekick”下，您可以突出显示任何特定标签，它可以告诉您标签中有哪些文件夹/文件和变更集。此功能与 Visual Studio 中可用的功能几乎相同，但没有那么有用。

一个警告是需要 TFS 服务器 2008 或更高版本。在 TFS server 2005 上使用该工具非常缓慢并且基本上无法使用。

-ephi

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-09-16T02:30:31.067

[由于 TFS 样式标签的复杂性，这在应用于文件夹时是一个相当困难的问题；根据上面的评论，我假设在文件上搜索标签就足够了]

不幸的是，这是在 tf.exe 或 VS2008 的任何地方都没有公开的 TFS 客户端 API 的极少数边缘案例之一。您必须直接调用 API。请参阅[http://msdn.microsoft.com/en-us/library/bb138967.aspx](http://msdn.microsoft.com/en-us/library/bb138967.aspx) - “versionFilterItem”参数可以满足您的需求。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-04T16:06:10.503

TFS 2010 在任何分支的历史中都有一个非常有用的“标签”视图（而不是“变更集”）。不幸的是，它只显示您选择的分支中的标签，而不是所有子分支/文件夹中的标签。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-25T22:01:51.037

我开始尝试创建自己的 SQL 来执行此操作并直接针对 TFS 数据库本身运行它。这个 SQL 是针对 TFS 2008 运行的。这个小片段将显示所有分支的所有标签和变更集，首先使用最近创建的分支/修改的标签进行排序。开发此功能的下一步将以某种方式遍历变更集和标签，以仅带回我感兴趣的区域（例如“主要”或某些特定分支）。我想如果我创建了可以完成所有这些操作的 SQL，它会很慢，并且没有完整的 GUI，我想深入了解特定文件的历史记录，查看带有该文件的标签等。叹息。

```
select DisplayName, cs.CreationDate, Comment, 'CheckIn' 
from TfsVersionControl.dbo.tbl_Identity i, TfsVersionControl.dbo.tbl_ChangeSet cs 
where cs.ownerid = i.IdentityId
union
select DisplayName, LastModified, Comment, 'Label' 
from TfsVersionControl.dbo.tbl_Identity i, TfsVersionControl.dbo.tbl_Label l 
where l.ownerid = i.IdentityId
order by 2 desc 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-26T14:21:07.540

我以前为此使用过[TFS 分支历史记录。](http://www.codeplex.com/TFSBranchHistory)它不是世界上最好的用户界面，只允许您显示每个文件的历史记录，但它可以完成工作。

# javascript - 如何在 jquery ajax 成功函数中引用调用 dom 元素？

> ID：153934
> 
> 赞同：7
> 
> 时间：2008-09-30T16:45:50.903
> 
> 标签：javascript, jquery

如果基于该元素的 ajax 调用成功，我正在尝试修改该元素的类

```
<script type='text/javascript'>
$("#a.toggle").click(function(e){
    $.ajax({
        url: '/changeItem.php',
        dataType: 'json',
        type: 'POST',
        success: function(data,text){
            if(data.error=='')
            {
                if($(this).hasClass('class1'))
                {
                    $(this).removeClass('class1');
                    $(this).addClass('class2');
                }
                else if($(this).hasClass('class2'))
                {
                    $(this).removeClass('class2');
                    $(this).addClass('class1');
                }
            }
            else(alert(data.error));
        }   
    });
    return false;
});
</script>
<a class="toggle class1" title='toggle-this'>Item</a> 
```

我对这个问题的理解是，在成功函数中，*它*引用了 ajax 对象参数，而不是像在 click 函数的其他位置那样调用 dom 元素。那么，如何引用调用 dom 元素并检查/添加/删除类？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-30T16:49:27.977

您可以将其存储在变量中。例子：

```
$("#a.toggle").click(function(e)
{
   var target = $(this);
   $.ajax({
      url: '/changeItem.php',
      dataType: 'json',
      type: 'POST',
      success: function(data,text)
      {
         if(data.error=='')
         {
            if(target.hasClass('class1'))
            {
               target
                  .removeClass('class1')
                  .addClass('class2');
            }
            else if(target.hasClass('class2'))
            {
               target
                  .removeClass('class2')
                  .addClass('class1');
            }
         }
         else(alert(data.error));
      }       
   });
   return false;
}); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T16:50:46.460

jQuery 将事件的目标以及有关它的一些其他信息传递给您的处理函数。有关这方面的更多信息，请参阅[http://docs.jquery.com/Events_%28Guide%29](http://docs.jquery.com/Events_%28Guide%29)。

在您的代码中，它会像 $(e.target) 一样被引用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-08-22T08:23:22.683

更好地设置ajax参数：`context: this`。例子：

```
 $.ajax({
    url: '/changeItem.php',
    dataType: 'json',
    type: 'POST',
    context: this,
    success: function(data,text){
        if(data.error=='')
        {
            if($(this).hasClass('class1'))
            {
                $(this).removeClass('class1');
                $(this).addClass('class2');
            }
            else if($(this).hasClass('class2'))
            {
                $(this).removeClass('class2');
                $(this).addClass('class1');
            }
        }
        else(alert(data.error));
    }   
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-24T22:41:03.183

我知道它很旧，但您可以使用 click 函数中的 'e' 参数。

# wpf - 切换到 WPF 应用程序的设计视图时导致 Visual Studio 2008 SP1 崩溃的原因

> ID：153942
> 
> 赞同：18
> 
> 时间：2008-09-30T16:48:24.470
> 
> 标签：wpf, visual-studio-2008, powercommands

在开发了没有源代码控制的 WPF 应用程序后，我决定将解决方案添加到 TFS。

这样做之后，每当我在设计视图中打开主 window.xaml 文件时，Visual Studio 就会消失，并且应用程序事件日志中将记录以下事件：

> .NET 运行时版本 2.0.50727.3053 - 致命的执行引擎错误 (7A035E00) (80131506)
> 
> [有关详细信息，请参阅http://go.microsoft.com/fwlink/events.asp](http://go.microsoft.com/fwlink/events.asp)上的帮助和支持中心 。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T16:49:24.310

该问题是由名为“Visual Studio 2008 的电源命令”的 Visual Studio 加载项引起的。

卸载它们并重新启动 Visual Studio 后，xaml 文件的设计视图开始正常工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-12T16:02:37.890

同样的问题，但没有安装电源命令。我能够始终使用的唯一解决方法是在打开任何 xaml 文件之前清理/重建解决方案。如果由于启动时加载 XAML 而无法进入解决方案，请删除 suo.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-21T00:39:18.087

如果您希望保持安装 Visual Studio 2008 的电源命令，请在此处查看此解决方法：

**[PowerCommands 崩溃 VS2008 SP1](http://code.msdn.microsoft.com/Thread/View.aspx?ProjectName=PowerCommands&ThreadId=759)**

但基本上：

> 解决方法是对 devenv.exe.config 文件进行简单修改。
> 
> 这将存在于（64 位系统）C:\Program Files (x86)\Microsoft Visual Studio 9.0\Common7\IDE
> 
> 或（32 位系统）C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE
> 
> 将此 XML 令牌添加到dependentAssembly 列表。他们让我在办公室后添加它，但我不确定这是否重要。

```
<dependentAssembly>
  <assemblyIdentity name="office" publicKeyToken="71e9bce111e9429c" culture="neutral"/>
  <codeBase version="12.0.0.0" href="PrivateAssemblies\Office12\Office.dll"/>
</dependentAssembly>

<!-NEW STUFF-->
<dependentAssembly>
  <assemblyIdentity name="Microsoft.PowerCommands" publicKeyToken="null" culture="neutral"/>

  <!-- For 64-bit systems, uncomment this one
  <codeBase version="1.1.0.0" href="C:\Program Files (x86)\PowerCommands\Microsoft.PowerCommands.dll"/> -->

  <!-- For 32-bit systems, uncomment this one
  <codeBase version="1.1.0.0" href="href="C:\Program Files\PowerCommands\Microsoft.PowerCommands.dll"/> -->

</dependentAssembly> 
```

这对我很有效。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-28T17:43:02.157

我刚刚遇到了一个适合我的情况的答案。使用 ngen 实用程序删除本机图像缓存修复了该问题。我不知道它到底是哪个图像，因为我没有一次通过一个，但它有效并且我能够保留 PowerCommands！

命令是：

```
ngen /delete * 
```

对于我的故事的完整叙述，我已将[其发布在我的博客上](http://palehorse.wordpress.com/2009/04/28/how-i-fixed-visual-studio-crashing-when-opening-xaml-wpf-files/)，包括我发现的有关 ngen 和本机图像缓存的内容。我想我还有很多东西要学，但这是一个开始。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T10:43:33.127

我没有安装 PowerCommands，但遇到了同样的问题。以安全模式启动并删除工具箱中的任何外来选项卡即可解决问题（之后您可以以正常模式启动）。这是导致此错误的许多可能原因之一，因为某些谷歌搜索会告诉您。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-08T09:45:31.563

Microsoft 提供了一个热修复程序：[Microsoft Connect](https://connect.microsoft.com/VisualStudio/Downloads/DownloadDetails.aspx?DownloadID=16827&wa=wsignin1.0)。[我在这个博客](http://karlshifflett.wordpress.com/2009/03/13/clr-hotfix-available-for-visual-studio-2008-rapid-crashing/)上找到了这个链接。

此修复程序为我解决了重新启动后的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-02T17:17:41.543

我有这个问题很长一段时间。我从来没有安装过电源命令，删除 .suo 文件和清理/重建没有帮助。为我解决的问题是关闭工具箱的自动填充。只需转到工具 | 选项 | Windows 窗体设计器，然后底部选项是 AutoToolboxPopulate，我将其设置为 false。然后我将解决方案重新加载到 VS2008 中，我能够在 Xaml 或设计器模式下打开 WPF 文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-07-23T02:36:10.773

我一直在经历这种崩溃。确保您的代码包含您正在编辑的 xaml 的类（默认情况下）

# sql - SQL 语法是否区分大小写？

> ID：153944
> 
> 赞同：224
> 
> 时间：2008-09-30T16:49:04.717
> 
> 标签：sql, case-sensitive

SQL 是否区分大小写。我使用了 MySQL 和 SQL Server，它们似乎都不区分大小写。总是这样吗？标准是否定义区分大小写？

* * *

## 回答 #1

> 赞同：208
> 
> 时间：2008-09-30T16:52:16.083

SQL 关键字不区分大小写（`SELECT`、`FROM`、`WHERE`等），但通常全部大写。但是，在某些设置中，表名和列名区分大小写。MySQL 有一个配置选项来启用/禁用它。通常区分大小写的表名和列名是 Linux MySQL 上的默认值，不区分大小写曾经是 Windows 上的默认值，但现在安装程序在安装过程中询问了这一点。对于 MSSQL，它是数据库排序规则设置的函数。

这是[关于名称区分大小写的 MySQL 页面](http://dev.mysql.com/doc/refman/5.0/en/identifier-case-sensitivity.html)

这是[MSDN 中关于 MSSQL 排序规则的文章](http://msdn.microsoft.com/en-us/library/ms143503(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-30T16:50:34.650

这不是严格意义上的 SQL 语言，但在 SQL Server 中，如果您的数据库排序规则区分大小写，那么所有表名都区分大小写。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2013-11-12T15:27:29.193

[SQL92 规范](http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt)声明标识符可以被引用，也可以不被引用。如果双方都未引用，则它们始终不区分大小写，例如`table_name == TAble_nAmE`.

然而，带引号的标识符是区分大小写的，例如`"table_name" != "TAble_naME"`. 同样基于规范，如果您希望将不带引号的标识符与带引号的标识符进行比较，那么如果不带引号的字符是大写的，则可以认为不带引号和带引号的标识符是相同的，例如`TABLE_NAME == "TABLE_NAME"`，但是`TABLE_NAME != "table_name"`或`TABLE_NAME != "TAble_NaMe"`。

这是规范的相关部分（第 5.2.13 节）：

```
 13)A <regular identifier> and a <delimited identifier> are equiva-
        lent if the <identifier body> of the <regular identifier> (with
        every letter that is a lower-case letter replaced by the equiva-
        lent upper-case letter or letters) and the <delimited identifier
        body> of the <delimited identifier> (with all occurrences of
        <quote> replaced by <quote symbol> and all occurrences of <dou-
        blequote symbol> replaced by <double quote>), considered as
        the repetition of a <character string literal> that specifies a
        <character set specification> of SQL_TEXT and an implementation-
        defined collation that is sensitive to case, compare equally
        according to the comparison rules in Subclause 8.2, "<comparison
        predicate>". 
```

请注意，就像 SQL 标准的其他部分一样，并非所有数据库都完全遵循本节。例如，PostgreSQL 将所有未引用的标识符存储为小写而不是大写，因此`table_name == "table_name"`（这与标准完全相反）。此外，有些数据库始终不区分大小写，或者区分大小写取决于数据库中的某些设置或取决于系统的某些属性，通常是文件系统是否区分大小写。

请注意，某些数据库工具可能会一直发送引用的标识符，因此在您将某些工具生成的查询（例如 Liquibase 或其他数据库迁移工具生成的 CREATE TABLE 查询）与手工查询（例如简单的 JDBC 选择在您的应用程序中）您必须确保案例是一致的，尤其是在带引号和不带引号的标识符不同的数据库上（DB2、PostgreSQL 等）

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-09-30T17:09:13.997

在 Sql Server[中它是一个选项](https://stackoverflow.com/questions/137452/how-do-i-change-sql-server-2005-to-be-case-sensitive)。打开它很糟糕。

我不确定MySql。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-30T16:53:43.643

标识符和保留字不应该区分大小写，尽管许多遵循约定使用大写作为保留字，使用 Pascal 大小写作为标识符。

请参阅[SQL-92](http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt)秒。5.2

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-12-04T14:36:52.887

我的理解是 SQL 标准要求不区分大小写。不过，我不相信任何数据库完全遵循标准。

MySQL 有一个配置设置作为其“严格模式”（使 MySQL 更符合标准的几个设置的抓包）的一部分，用于区分大小写或不敏感的表名。无论此设置如何，列名仍然不区分大小写，尽管我认为它会影响列名的显示方式。我相信此设置是实例范围的，跨越 RDBMS 实例中的所有数据库，尽管我今天正在研究以确认这一点（并希望答案是否定的）。

我喜欢 Oracle 如何更好地处理这个问题。在直接 SQL 中，表名和列名等标识符不区分大小写。但是，如果出于某种原因您确实希望获得显式大小写，则可以将标识符括在双引号中（这在 Oracle SQL 中与用于括起字符串数据的单引号完全不同）。所以：

```
SELECT fieldName
FROM tableName; 
```

将从**tablename**查询**fieldname**，但是

 **```
SELECT "fieldName"
FROM "tableName"; 
```

将从**tableName**查询**fieldName**。

 **我很确定您甚至可以使用这种机制将空格或其他非标准字符插入标识符中。

在这种情况下，如果由于某种原因您发现需要显式大小写的表和列名，那么您可以使用它，但我仍然要高度警告不要这样做。

当我每天使用 Oracle 时，我的约定是在代码中我将所有 Oracle SQL 关键字都用大写字母，所有标识符都用小写字母。在文档中，我会将所有表名和列名都大写。能够做到这一点非常方便和可读（尽管有时在代码中输入这么多大写字母很痛苦——我相信我可以在这里找到一个编辑器功能来提供帮助）。

在我看来，MySQL 在不同平台上对此有所不同是特别糟糕的。我们需要能够在 Windows 上转储数据库并将它们加载到 UNIX 中，如果 Windows 上的安装程序忘记将 RDBMS 置于区分大小写的模式，那么这样做是一场灾难。（公平地说，这是一场灾难的部分原因是我们的编码人员很久以前就做出了错误的决定，即依赖 UNIX 上的 MySQL 区分大小写。）编写 Windows MySQL 安装程序的人使它非常方便，并且类似于 Windows，并且向人们提供一个复选框以说“你想打开严格模式并使 MySQL 更符合标准吗？”真是太好了。但是 MySQL 与标准有如此显着的差异是非常方便的，然后通过在不同平台上转而与自己的事实标准不同，使事情变得更糟。我敢肯定，在不同的 Linux 发行版上，这可能会更加复杂，因为不同发行版的打包程序有时可能会合并他们自己喜欢的 MySQL 配置设置。

[这](https://stackoverflow.com/questions/224298/are-there-benefits-to-a-case-sensitive-database)是另一个讨论在 RDBMS 中是否需要区分大小写的 SO 问题。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-30T16:51:54.040

不，MySQL 不区分大小写，SQL 标准也不区分大小写。将命令写成大写只是一种常见的做法。

现在，如果您在谈论表/列名称，那么它们是，但不是命令本身。

所以

```
SELECT * FROM foo; 
```

是相同的

```
select * from foo; 
```

但不一样

```
select * from FOO; 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-06-20T13:32:25.087

我发现[这篇博](http://www.alberton.info/dbms_identifiers_and_case_sensitivity.html)文很有帮助（我不是作者）。总结（尽管请阅读）：

> ...分隔标识符区分大小写（“table_name”！=“Table_Name”），而未引用的标识符则不区分，并转换为大写（table_name => TABLE_NAME）。

他发现 DB2、Oracle 和 Interbase/Firebird 100% 兼容：

> PostgreSQL ... 将每个未加引号的标识符小写，而不是大写。MySQL ...文件系统依赖。SQLite 和 SQL Server ......表和字段名称的大小写在创建时被保留，但之后它们被完全忽略。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T16:51:22.217

我认为 SQL Server 不区分大小写，至少默认情况下是这样。

当我通过 Management Studio 手动查询时，我总是搞砸大小写，它欣然接受：

```
select cOL1, col2 FrOM taBLeName WheRE ... 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-06T13:09:53.903

SQL 关键字本身不区分大小写。

表、列等的名称区分大小写，这取决于数据库 - 您可能应该假设它们区分大小写，除非您另有说明（在许多数据库中它们不是；在 MySQL 中，表名有时区分大小写，但大多数其他名字不是）。

使用 =、>、< 等比较数据具有大小写意识，这取决于在单个数据库、表甚至相关列上使用的排序规则设置。但是，在数据库中保持排序规则相当一致是正常的。我们有几列需要存储区分大小写的值；他们有一个专门设置的排序规则。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-05-16T00:51:16.113

**两全其美**

这些天你可以只用小写写你所有的 sql 语句，如果你需要格式化它，那么只需安装一个插件来为你做。这仅适用于您的代码编辑器有这些插件可用的情况。 **VSCode**有很多扩展可以做到这一点。

# .net - 开源 .net windows 基于窗体的控件，例如：甘特图、日历和调度程序

> ID：153945
> 
> 赞同：2
> 
> 时间：2008-09-30T16:49:21.220
> 
> 标签：.net, controls, user-interface, toolkit

是否有任何开源或免费的 .net ui 工具包至少包含以下控件之一：

2.  甘特图（类似 ms 项目）
3.  日历（类似谷歌日历或 ms Outlook 2003、2007 等）
4.  调度程序（类似于 Outlook 2007）

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T17:09:02.110

这是来自 CodeProject 的免费甘特图。[http://www.codeproject.com/KB/vb/Gantt_Chart.aspx](http://www.codeproject.com/KB/vb/Gantt_Chart.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-17T19:43:42.567

这是一个日历日视图，如 Outlook

[http://www.codeproject.com/KB/selection/Calendardayview.aspx](http://www.codeproject.com/KB/selection/Calendardayview.aspx)

一点都不坏……

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T21:57:38.927

以下是开源图表库的列表：

[http://csharp-source.net/open-source/charting-and-reporting](http://csharp-source.net/open-source/charting-and-reporting)

# c - GLIBC：调试内存泄漏：如何解释 mtrace() 的输出

> ID：153953
> 
> 赞同：5
> 
> 时间：2008-09-30T16:50:30.813
> 
> 标签：c, memory-leaks, glibc, mtrace

我正在尝试调试内存泄漏问题。我正在使用[mtrace()](http://www.gnu.org/software/libc/manual/html_node/Tracing-malloc.html#Tracing-malloc)来获取 malloc/free/realloc 跟踪。我已经运行了我的 prog，现在有一个巨大的日志文件。到现在为止还挺好。但我在解释文件时遇到问题。看看这些行：

```
@ /usr/java/ibm-java2-x86_64-50/jre/bin/libj9prt23.so:[0x2b270a384a34] + 0x1502570 0x68
@ /usr/java/ibm-java2-x86_64-50/jre/bin/libj9prt23.so:[0x2b270a384a34] + 0x1502620 0x30
@ /usr/java/ibm-java2-x86_64-50/jre/bin/libj9prt23.so:[0x2b270a384a34] + 0x2aaab43a1700 0xa80
@ /usr/java/ibm-java2-x86_64-50/jre/bin/libj9prt23.so:[0x2b270a384a34] + 0x1501460 0xa64 
```

奇怪的是，一个调用（相同的返回地址）负责 4 个分配。

更陌生：

```
@ /usr/java/ibm-java2-x86_64-50/jre/bin/libj9prt23.so:[0x2b270a384a34] + 0x2aaab43a1700 0xa2c
…
@ /usr/java/ibm-java2-x86_64-50/jre/bin/libj9prt23.so:[0x2b270a384a34] + 0x2aaab43a1700 0xa80 
```

在这两行之间，块 0x2aaab43a1700 永远不会被释放。

有谁知道如何解释这个？一次调用如何导致 4 次分配？malloc 怎么会返回一个之前已经分配好的地址呢？

编辑 2008/09/30：分析 GLIBC (mtrace.pl) 提供的 mtrace() 输出的脚本在这里没有任何帮助。它只会说：Alloc 0x2aaab43a1700 重复。但这怎么会发生呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T18:50:17.670

您正在查看 mtrace 的直接输出，这非常令人困惑和违反直觉。幸运的是，有一个 perl 脚本（称为 mtrace，在 glibc-utils 中找到）可以很容易地帮助解析这个输出。

在调试的情况下编译您的构建，然后像这样运行 mtrace：

```
$ gcc -g -o test test.c
$ MALLOC_TRACE=mtrace.out ./test
$ mtrace test mtrace.out

Memory not freed:
-----------------
   Address     Size     Caller
0x094d9378    0x400  at test.c:6 
```

输出应该*更*容易消化。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-03T21:07:33.183

分配内存的函数被多次调用。调用者地址指向执行分配的代码，并且该代码只是运行了多次。

这是 C 语言中的一个示例：

```
void *allocate (void)
{
  return (malloc(1000));
}

int main()
{
  mtrace();
  allocate();
  allocate();
} 
```

mtrace 的输出是：

```
内存未释放：
-----------------
           地址大小调用者
0x0000000000601460 0x3e8 在 0x4004f6
0x0000000000601850 0x3e8 在 0x4004f6

```

注意来电者地址是如何相同的？这就是为什么 mtrace 分析脚本说它们是相同的，因为相同的错误被多次看到，导致多次内存泄漏。

如果可以的话，使用调试标志 (-g) 进行编译会很有帮助：

```
内存未释放：
-----------------
           地址大小调用者
0x0000000000601460 0x3e8 在 /home/andrjohn/development/playground/test.c:6
0x0000000000601850 0x3e8 在 /home/andrjohn/development/playground/test.c:6

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T17:04:52.667

一种可能的解释是同一个函数分配不同的缓冲区大小？strdup 就是一个这样的例子。

对于第二个问题，运行时可能正在分配一些“静态”暂存区，这些暂存区在进程终止之前不会被释放。到那时，操作系统无论如何都会在该过程之后进行清理。

可以这样想：在 Java 中，没有析构函数，也无法保证任何对象都会调用终结。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T17:10:55.897

尝试在 valgrind 下运行您的应用程序。它可能会让您更好地了解实际泄露的内容。

# python - Python GUI 应用程序再分发

> ID：153956
> 
> 赞同：11
> 
> 时间：2008-09-30T16:50:38.440
> 
> 标签：python, user-interface, wxpython, distribution, freeze

我需要开发一个中小型桌面 GUI 应用程序，由于时间限制，最好使用 Python 作为首选语言。

我有哪些 GUI 库选择允许我独立地重新分发我的应用程序，假设用户没有正常的 Python 安装并且显然也没有我正在使用的 GUI 库？

另外，对于每个目标操作系统，我将如何将所有内容打包成*合理大小的二进制文件？*（我的主要目标是 Windows 和 Mac OS X）

*补充：* 我一直在研究 WxPython，但是我发现了很多关于使用 cx_freeze 打包它并获得 30mb+ 二进制文件的恐怖故事，并且没有关于如何*实际*进行打包以及它的可信度的真正建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T17:00:40.337

这可能会有所帮助：

[如何从 Python 程序制作 EXE 文件？](https://stackoverflow.com/questions/49146/what-is-the-best-way-to-make-an-exe-file-from-a-python-program)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T17:03:57.567

[http://wiki.wxpython.org/CreatingStandaloneExecutables](http://wiki.wxpython.org/CreatingStandaloneExecutables)

除非您设法包含 wx 的调试版本，否则它不应该那么大。我似乎记得 python.dll 大约 4Mb，wx 类似。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T17:47:28.023

[Python 有一个名为TKinter](http://wiki.python.org/moin/TkInter)的嵌入式 GUI 工具包，它基于 TCL 编程语言的 Tk 库。它非常基础，不具备您在 Windows 窗体或 GTK 中所期望的所有功能，但如果您必须拥有独立于平台的工具包，我认为没有其他选择，因为您也不想增长那么多二进制文件。

Tkinter 一点也不难使用，因为它没有数百万个小部件/控件和选项，并且是大多数 Python 发行版中包含的默认工具包，至少在 Windows、OSX 和 Linux 上是这样。

[GTK](http://www.gtk.org/)和[QT](http://www.trolltech.com)更漂亮、更强大，但它们有一个很大的缺点：它们很重并且依赖于第三个库，尤其是 GTK，它有很多依赖项，因此很难将其嵌入到您的软件中进行分发。

至于二进制创建，我知道有 py2exe 可以将 python 代码转换为 win32 可执行代码（.exe），但我不确定 OSX 是否有类似的东西。您是否担心人们可以看到源代码，或者只是因为您可以将所有内容捆绑在一个包中？如果您只想捆绑创建独立可执行文件所需的所有内容，则可以轻松创建安装程序：

[在python中创建可分发的](http://docs.python.org/dist/built-dist.html)

这是完成后如何分发软件的指南。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T17:10:12.793

[Windows 的http://Gajim.org](http://Gajim.org)使用 python 和 PyGtk。你可以检查一下，他们是如何做到的。此外，还有用于 GUI 的 PyQt（以及前面提到的 wxpython）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T21:28:06.013

我没有为 Windows 以外的任何平台构建独立应用程序的经验。

那说：

**Tkinter：**与 py2exe 配合得很好。Python Megawidgets（Tkinter 的“扩展库”）也可以正常工作，但它通过动态导入做了一些时髦的事情，因此您需要将所有组件组合成一个大文件“pmw.py”并将其添加到您的项目中（嗯，您还将拥有 pmwblt.py 和 pmwcolor.py)。有关于如何在某处执行此操作的说明（在 py2exe wiki 或 PMW 文档中）。Tix（可以与 Tkinter 一起使用的 Tk 扩展）不适用于 py2exe，或者至少这是我大约四年前的经验。

**wxPython**也适用于 py2exe。我刚刚检查了我拥有的应用程序；整个发行版达到 11MB 左右。其中大部分是 wx DLL 和 .pyd 文件，但我看不出你会如何避免这种情况。如果你的目标是 Windows XP，你需要在你的 setup.py 中包含一个清单，否则它看起来很难看。有关详细信息，请参阅[此电子邮件](http://lists.wxwidgets.org/pipermail/wxpython-users/2007-October/069675.html)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T17:02:15.060

我自己使用过 py2Exe - 它真的很简单（至少对于小型应用程序而言）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T20:29:08.213

我熟悉的组合：wxPython、py2exe、upx

解决您对发行版大小的最后一个担忧的关键是使用[upx](http://upx.sourceforge.net/)压缩 DLL。看起来他们支持 MacOS 可执行文件。首次加载 DLL 时，您将支付初始解压缩费用。

# sharepoint - 以其他用户的身份查看 MOSS 2007 页面 - 无需以该用户身份登录

> ID：153961
> 
> 赞同：9
> 
> 时间：2008-09-30T16:51:04.323
> 
> 标签：sharepoint, moss, target-audience

在 Moss 2007 中，您可以为页面中的每个单独的 Web 部件设置目标受众。有没有办法在不以该用户身份登录的情况下预览页面对另一个用户的外观？我正在寻找的是一种让在网站上具有完全控制/设计权限的人能够预览该网站将如何显示给其他用户的方法。有什么建议么？

我有一些我们的 IS 部门用来预览页面的测试帐户，但是我们不允许非 IS 部门人员使用这些帐户。这些工作人员只能访问他们的一个帐户。因此，如果用户在其中一个页面上的 Web 部件上更改目标受众，现在他们无法预览页面在其他人眼中的外观，只能要求其他人登录并在他们的肩膀上观看。我不能提供测试账户的账户信息，也不能创建新的测试账户。

谢谢！

编辑：我有能力预览。问题是其他完全控制网站的用户无法预览页面。这是一个场景：在我的学区，每所学校都有一个站点。校长可以完全控制他学校的场地。在登录页面上，他希望所有学校公告都可见。但是，有些应该只对教学人员可见，而有些则需要对学生可见。他使用受众群体定位，但无法预览以一眼看出定位是否正确。许多用户不精通计算机，因此事情需要尽可能简单。而且，这只是一种情况，还有其他的情况不按学校划分。有许多用户可以完全控制具有不同要求的站点 - 所以它'

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T22:50:54.753

首先，如果您使用 NT 安全性，我认为不可能有预览功能。也许这是您可以通过表单身份验证做的事情，但我从未使用过它。

关于那个话题。我认为当您在 MOSS/WSS 服务器上开发新功能或集成东西时，您需要一点灵活性。

根据我所看到的，您必须遵循您可以做的事情。它肯定比开发定制解决方案更具成本效益。我假设您使用的是 NT Security。

*   **用户帐户**：请您的域管理员使用专用的用户帐户。
*   **虚拟机**：要求有一些虚拟机能够与该服务器一起玩，并结合测试帐户
*   **沙盒环境**：要求您的 IT 部门创建沙盒 MOSS 环境，以便能够复制您的实际 MOSS 环境并创建自定义用户场景。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T22:48:10.047

编辑：重新阅读我发布的问题后，您希望用户能够预览页面。我认为您将需要考虑编写一个使用模拟加载页面的预览控件。不确定这有多可行，但肯定有人创建了预览功能。对我来说，这听起来像是一个很常见的场景。

旧答案：你能不能启动一个非 MS 浏览器，比如 Firefox，它会提示输入用户名和密码。

然后，您可以清除会话 cookie 以提示以其他人身份登录。

这是我用于 ASP.Net 站点的技术，该站点使用与 SharePoint 类似的方式对域进行身份验证。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T00:11:07.587

仅用于预览目标受众，唯一的方法是创建一个基于 SSP 用户配置文件属性中的属性运行的目标受众。

然后，您可以拥有一个控件，允许编辑器更改存储在他们的配置文件中的值，重新编译配置文件和瞧（对于瞧的一些描述）用户将他们的受众目标值更改为其他值。

这需要相当多的编码和一些想法，用于受众定位的规则。

归根结底，最具成本效益的方法是向您的基础架构人员推回帐户解决方案，该解决方案将允许您拥有一个人们可以用于此功能的“读者”帐户。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T20:38:27.730

或者，您可以创建一个控件/Webpart，该控件/Webpart 连接到站点的[受众](http://msdn.microsoft.com/en-us/library/microsoft.office.server.audience.aspx)并向用户显示受众成员身份（可能来自[GetMembership](http://msdn.microsoft.com/en-us/library/microsoft.office.server.audience.audience_members.aspx?s=1)调用）。这不会预览网站，但它会让您的编辑提前​​了解每个受众中的人。一些可以帮助他们让观众正确的东西。

我们为安全组成员制作了一个类似的 webpart。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-08T06:38:10.550

我认为您可以采取两种方法：

1.  请务必使用测试帐户来预览页面。您可以通过使用 RUNAS 命令 ( [http://technet.microsoft.com/en-us/library/bb490994.aspx](http://technet.microsoft.com/en-us/library/bb490994.aspx) ) 来缓解以其他用户身份登录的“痛苦”。因此，可以只在桌面上创建一个快捷方式，使用另一个帐户的凭据打开浏览器。只有该浏览器实例才能与测试帐户一起使用。
2.  制作要预览的页面的副本（或更多副本），将其存储在安全站点中（例如，仅主体可访问），并调整该页面上 Web 部件的受众目标属性.

# design-patterns - 将算法封装到一个类中

> ID：153974
> 
> 赞同：12
> 
> 时间：2008-09-30T16:55:38.367
> 
> 标签：design-patterns, coding-style, class-design

我想知道将算法封装到一个类中有多常见？更具体地说，不是有许多单独的函数在彼此之间转发公共参数：

```
void f(int common1, int param1, int *out1);
void g(int common1, int common2, int param1, int *out2)
{
  f(common1, param1, ..);
} 
```

将公共参数封装到一个类中，并在构造函数中完成所有工作：

```
struct Algo
{
  int common1;
  int common2;

  Algo(int common1, int common2, int param)
  { // do most of the work }

  void f(int param1, int *out1);
  void g(int param1, int *out2);
}; 
```

不必通过函数参数转发公共参数和中间结果似乎非常实用。但我还没有看到这种“模式”被广泛使用。可能的缺点是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T17:00:37.170

有一种设计模式可以解决这个问题；[它被称为“策略设计模式”——你可以在这里](http://www.dofactory.com/Patterns/PatternStrategy.aspx)找到一些很好的信息。

“策略”的好处在于它允许您定义一系列算法，然后可以互换使用它们，而无需修改使用这些算法的客户端。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T17:06:35.703

这根本不是一个坏策略。事实上，如果你有能力用你的语言（你在 C++ 中这样做）定义某种类型的抽象超类，它为底层功能定义了一个不透明的接口，你可以在运行时交换不同的算法（想想排序算法，例如）。如果您选择的语言具有反射功能，您甚至可以拥有无​​限可扩展的代码，允许加载和使用在编写所述算法的使用者时甚至可能不存在的算法。这也允许您松散地耦合您的其他功能类和算法类，这有助于重构并在处理大型项目时保持您的理智完好无损。

当然，无论何时你开始构建一个复杂的类结构，都会有额外的架构——因此也就是代码——需要构建和维护。但是，在我看来，从长远来看，好处超过了这种轻微的不便。

最后一个建议：*不要*在构造函数中做你的工作。构造函数只能用于将类内部结构初始化为合理的默认值。是的，这可能包括调用其他方法来完成初始化，但初始化*不是*操作。这两者应该是分开的，即使它需要在您的代码中再调用一次来运行您正在寻找的特定算法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T17:08:54.187

您的问题能否更笼统地表述为“当软件的主要思想只是运行算法时，我们如何使用面向对象设计？”

在那种情况下，我认为像您提供的设计是一个很好的第一步，但这些事情通常取决于问题。

我认为一个好的一般设计就像你在那里的一样。. .

```
class InputData {};
class OutputData {};

class TheAlgorithm 
{
private:
     //functions and common data

public:
   TheAlgorithm(InputData);      
   //other functions
   Run();
   ReturnOutputData();
}; 
```

然后，让它与 main() 或您的 GUI 进行交互。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T17:02:38.193

我通常创建一个函子或[函数对象](http://en.wikipedia.org/wiki/Function_object)来封装我的算法。

我通常使用以下模板

```
class MyFunctor {
    public:
       MyFunctor( /* List of Parameters */ );
       bool execute();
    private:
       /* Local storage for parameters and intermediary data structures */
} 
```

然后我以这种方式使用我的函子：

```
 bool success = MyFunctor( /*Parameter*/ ).execute(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T17:07:07.917

也许更好的方法（除非我遗漏了什么）是将算法封装在一个类中并通过方法调用执行它。您可以通过构造函数将所有参数传递给公共属性，也可以创建一个结构体来封装传递给包含算法的类的所有参数。但通常在构造函数中执行这样的事情并不是一个好主意。首先也是最重要的，因为它不直观。

```
public class MyFooConfigurator
{
   public MyFooConfigurator(string Param1, int, Param2) //Etc...
   {
      //Set all the internal properties here
      //Another option would also be to expose public properties that the user could
      //set from outside, or you could create a struct that ecapsulates all the
      //parameters.
      _Param1 = Param1; //etc...
    }

    Public ConfigureFoo()
    {
       If(!FooIsConfigured)
          return;
       Else
          //Process algorithm here.
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T16:59:07.953

如果您需要使用构造函数参数调用这两种方法，那么我会这样做。

如果您永远不需要使用相同的参数调用这两种方法，那么我不会。

# java - 在 ColdFusion 中创建嵌套 Java 类的实例

> ID：153975
> 
> 赞同：4
> 
> 时间：2008-09-30T16:56:47.413
> 
> 标签：java, coldfusion

我正在尝试在 ColdFusion中创建一个实例： [java.awt.geom.Point2D.Double 。](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/geom/Point2D.html)

Point2D.Double 是抽象类 Point2D 内的嵌套类。我尝试使用以下方法实例化该类：

```
<cfset PointClass = createObject("java", "java.awt.geom.Point2D.Double")> 
```

这失败了，因为 ColdFusion 找不到该类。

这`<cfset PointClass = createObject("java", "java.awt.geom.Point2D")>`不起作用，因为 Point2D 是一个抽象类，并且没有可以调用的公共构造函数`PointClass.init(x,y)`。

现在，我使用了我自己的 Point 类来包装 Point2D.Double 类，以便我可以在 ColdFusion 中实例化它。我认为这并不理想，我正在寻找有关如何在 ColdFusion 中直接创建 Point2D.Double 类的想法。

我也在使用 ColdFusion 8。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-30T17:50:16.597

尝试：

```
<cfset PointClass = createObject("java", "java.awt.geom.Point2D$Double")> 
```

对于嵌套类，使用`$`

# windows - Windows 是否有更好的命令提示符？

> ID：153983
> 
> 赞同：32
> 
> 时间：2008-09-30T16:58:50.217
> 
> 标签：windows, command-line, cmd

出于某种原因，Windows 命令提示符是“特殊的”，因为您必须转到属性对话框以水平调整它的大小，而不是像其他所有应用程序一样仅拖动窗口的一角。不出所料，这个功能也进入了 PPP-Powershell —— 有没有办法通过命令提示符替换或 Windows 黑客来解决这个问题？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-30T17:02:52.500

2019 年更新：

*   [微软已经在Github](https://github.com/microsoft/terminal)和[Windows Store](https://www.microsoft.com/en-us/p/windows-terminal-preview/9n0dx20hk701)上发布了终端应用程序，它具有标签、面板、亚克力透明等功能。

2016 年更新：

*   Windows 10 的默认控制台 UI 具有更多功能，包括自由调整大小、透明度等（包括 cmd 和 powershell）
*   我现在使用[ConEmu （](https://code.google.com/p/conemu-maximus5/)[此处](http://www.hanselman.com/blog/ConEmuTheWindowsTerminalConsolePromptWeveBeenWaitingFor.aspx)为演练），它具有许多功能，包括选项卡和拆分窗格。
*   其他选项包括[Cmder](http://cmder.net/)（内置附加工具）和[ConsoleZ](https://chocolatey.org/packages/ConsoleZ)（Console2 的一个分支）。
*   [控制台](http://sourceforge.net/projects/console)似乎不再更新

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-09T16:34:22.233

我不知道这是否是您想要的：调整 Powershell 控制台窗口的大小。如果是这样，我不久前得到了这个：只需输入：**resize**并使用箭头键调整宽度和高度。

```
##
## Author   : Roman Kuzmin
## Synopsis : Resize console window/buffer using arrow keys
##

function Size($w, $h)
{
    New-Object System.Management.Automation.Host.Size($w, $h)
}

function resize()
{
Write-Host '[Arrows] resize  [Esc] exit ...'
$ErrorActionPreference = 'SilentlyContinue'
for($ui = $Host.UI.RawUI;;) {
    $b = $ui.BufferSize
    $w = $ui.WindowSize
    switch($ui.ReadKey(6).VirtualKeyCode) {
        37 {
            $w = Size ($w.width - 1) $w.height
            $ui.WindowSize = $w
            $ui.BufferSize = Size $w.width $b.height
            break
        }
        39 {
            $w = Size ($w.width + 1) $w.height
            $ui.BufferSize = Size $w.width $b.height
            $ui.WindowSize = $w
            break
        }
        38 {
            $ui.WindowSize = Size $w.width ($w.height - 1)
            break
        }
        40 {
            $w = Size $w.width ($w.height + 1)
            if ($w.height -gt $b.height) {
                $ui.BufferSize = Size $b.width $w.height
            }
            $ui.WindowSize = $w
            break
        }
        27 {
            return
        }
    }
  }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T17:05:23.197

如果您不介意安装 cygwin，您可以将它与 xterm 或 rxvt 一起使用。您还可以使用 Bash 作为 shell，而不是更好的 cmd.exe。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T17:06:32.757

这不是您正在寻找的，但我解决它的方法是使用 cygwin 的无根 X-Windows 模式和 XTerms。比起 Windows 的 env，我更喜欢 unix 命令行环境，而且 XTerm 窗口的行为与任何其他窗口一样。

至于直接替换，快速谷歌搜索显示这些：

*   [安慰](http://sourceforge.net/projects/console/)
*   [经济舱](http://www.corion.net/econsole/)

我还没有尝试过，所以我不确定他们是否有你想要的东西，但他们可能值得一试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-08-22T04:00:08.660

PowerShell v2.0 附带一个交互式 shell，称为 PowerShell 集成脚本环境 (ISE)。这不是很棒，但它通常比控制台子系统更好。

**好的**

*   包括一个 PowerShell 脚本编辑器，具有着色功能

*   提示时将着色作为一种类型

*   我可以将多个 PowerShell 会话（包括远程会话）作为选项卡。

*   ISE 支持 PowerShell，因此我可以使用 PowerShell 对其进行操作和扩展。例如，请参阅“IsePack”，它添加了大量功能，包括复制为 HTML。

*   可以轻松缩放文本

*   常规的 Windows 调整大小、光标导航、选择、复制、粘贴、字体等。

**坏的**

*   交互式控制台应用程序阻塞等待输入，从而挂起。

*   检测其标准 IO 是否被重定向的控制台应用程序会认为是这样，因此行为异常。最糟糕的是 TFS 的 tf.exe。例如，'tf submit' 将在没有提示的情况下提交，即使提示是 GUI，而不是 CLI。

*   开箱即用的有限功能。很明显，他们想要制作更丰富的 PowerShell IDE，但没有。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-10-29T03:36:41.783

事后的方式，但在此期间情况有所改善。[ConEmu](http://code.google.com/p/conemu-maximus5/)是高度可配置的，可以水平和垂直调整大小。当窗口调整大小时，它有一些奇怪的（无论如何对我来说）调整字体大小的行为。[这里](https://stackoverflow.com/a/440370/824055)有一些关于它的讨论。Scott Hanselman[写过关于它](http://www.hanselman.com/blog/ConEmuTheWindowsTerminalConsolePromptWeveBeenWaitingFor.aspx)的文章，包括与 FarManager 的集成。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T17:04:09.080

您可能会考虑安装[FAR](http://www.farmanager.com/)。它是一个出色的文本模式文件管理器等等。它也可以通过拖动窗口的角来调整大小:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T06:03:49.133

如果您设置属性“布局/屏幕缓冲区大小/宽度”，则在出现提示时，选择“修改启动此窗口的快捷方式”，它将记住缓冲区宽度。然后，当您启动另一个命令提示符时，它将是例如原来的 80 宽，但您现在可以将其拉伸到您设置缓冲区宽度的任何值。

命令提示符不会在当前窗口宽度处换行，只会在缓冲区宽度处换行。因此，如果您将缓冲区宽度设置为 120，但窗口只有 80 宽，则行将在 120 处换行，您必须滚动才能读取超过 80 的字符。

# sql-server - 如何在 SQLServer 数据库的两个实例之间复制数据记录

> ID：153988
> 
> 赞同：33
> 
> 时间：2008-09-30T17:00:16.827
> 
> 标签：sql-server, database, sql-server-2005, copy, maintenance

我需要将一些记录从我们的 SQLServer 2005 测试服务器复制到我们的实时服务器。这是一个平面查找表，因此无需担心外键或其他参照完整性。

我可以在实时服务器上再次键入记录，但这很烦人。我可以将测试服务器记录和表数据全部导出到 SQL 脚本中并运行它，但我不想覆盖实时系统上存在的记录，只添加它们。

我怎样才能只选择我想要的记录并将它们传输或以其他方式进入实时服务器？我们没有 Sharepoint，我知道这可以让我直接在两个实例之间复制它们。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-30T17:20:40.397

如果您的生产 SQL 服务器和测试 SQL 服务器可以通信，您可以使用 SQL 插入语句进行操作。

首先在您的测试服务器上运行以下命令：

```
Execute sp_addlinkedserver PRODUCTION_SERVER_NAME 
```

然后只需创建插入语句：

```
INSERT INTO [PRODUCTION_SERVER_NAME].DATABASE_NAME.dbo.TABLE_NAME   (Names_of_Columns_to_be_inserted)
SELECT Names_of_Columns_to_be_inserted
FROM TABLE_NAME 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-30T17:06:43.660

我使用 SQL Server Management Studio 并通过右键单击数据库并转到任务>导出来执行导出任务。我认为它适用于服务器和数据库，但我不确定。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T17:03:49.067

SSIS 包最适合进行传输，设置需要几秒钟！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T17:05:01.013

我只会编写 sql 脚本并在另一台服务器上运行以进行快速而肮脏的传输。如果这是您经常做的事情并且您需要设置一种机制，那么类似于旧的数据转换服务 (DTS) 的 SQL Server 集成服务 (SSIS) 就是为这类事情而设计的。您在迷你 Visual Studio 环境中开发解决方案，并且可以构建非常复杂的解决方案来移动和转换数据。

# wxpython - 如何从 wxPython 中的 wx.TextCtrl 控件获取滚动位置/范围

> ID：153989
> 
> 赞同：1
> 
> 时间：2008-09-30T17:00:23.753
> 
> 标签：wxpython, scroll, wxwidgets, textctrl, wx.textctrl

我有一个小日志应用程序（用 wxPython 编写），它从我们正在开发的一些工具包中接收数据，我想在滚动窗口中显示文本。就目前而言，我正在使用 wx.TextCtrl 进行文本显示，但我在滚动行为方面遇到了一些问题。

基本上，我希望滚动条位于窗口底部（即传入数据的末尾），添加更多数据应该向前滚动视图。但是，如果视图向上滚动了一点（即用户正在查看一些有趣的东西，例如错误消息），则应用程序应该只在末尾添加文本而不再滚动。

我目前有两个问题：

1.  我不知道如何检索当前的滚动位置（对 GetScrollPos() 的调用似乎不起作用——它们只返回 0）。
2.  我不知道如何检索滚动条的当前范围（调用 GetScrollRange() 只返回 1）。

我用谷歌搜索了一下，似乎有一些提示表明 GetScrollPos 和 GetScrollRange 不适用于 wx.TextCtrl？有没有其他人在这方面有任何经验？有没有一个很好的简单方法来解决这个问题，或者我将不得不推出我自己的 wx.TextCtrl？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T00:58:02.420

好的，这就是我必须要做的：

```
import wx
from threading import Timer
import time

class Form1(wx.Panel):
    def __init__(self, parent):
        wx.Panel.__init__(self, parent)

        self.logger = wx.TextCtrl(self,5, "",wx.Point(20,20), wx.Size(200,200), \
                wx.TE_MULTILINE |  wx.TE_READONLY)# |  wx.TE_RICH2)

        t = Timer(0.1, self.AddText)
        t.start()

    def AddText(self):
        # Resart the timer
        t = Timer(0.25, self.AddText)
        t.start() 

        # Work out if we're at the end of the file
        currentCaretPosition = self.logger.GetInsertionPoint()
        currentLengthOfText = self.logger.GetLastPosition()
        if currentCaretPosition != currentLengthOfText:
            self.holdingBack = True
        else:
            self.holdingBack = False

        timeStamp = str(time.time())

        # If we're not at the end of the file, we're holding back
        if self.holdingBack:
            print "%s FROZEN"%(timeStamp)
            self.logger.Freeze()
            (currentSelectionStart, currentSelectionEnd) = self.logger.GetSelection()
            self.logger.AppendText(timeStamp+"\n")
            self.logger.SetInsertionPoint(currentCaretPosition)
            self.logger.SetSelection(currentSelectionStart, currentSelectionEnd)
            self.logger.Thaw()
        else:
            print "%s THAWED"%(timeStamp)
            self.logger.AppendText(timeStamp+"\n")

app = wx.PySimpleApp()
frame = wx.Frame(None, size=(550,425))
Form1(frame)
frame.Show(1)
app.MainLoop() 
```

这个简单的演示应用程序几乎可以完美运行。除非用户单击不在文本末尾的行，否则它会整齐地滚动。此后它保持良好状态，因此您可以选择文本（注意：那里仍然存在一个错误，如果您选择向上而不是向下，它会清除您的选择）。

最大的烦恼是，如果我尝试启用“| wx.TE_RICH2”选项，一切都会变得有点像梨形。我真的需要这个来对错误进行语法高亮显示，但是如果我不能启用该选项，我注定要单色 - 嘘！

关于如何阻止富编辑控件滚动的更多想法？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T18:00:19.647

我刚刚测试了一个简单的例子（检查`GetScrollPos(0)`和`GetScrollRange(0)`事件`EVT_TEXT`处理程序`wx.TextCtrl`），它对我来说很好——它们分别返回当前显示行的索引和总行数。

也许问题出在您的 wxPython 版本上？我用了：

```
>>> import wx
>>> wx.version()
'2.8.9.1 (msw-unicode)' 
```

# java - 泛型类型参数，具体扩展类？

> ID：153994
> 
> 赞同：4
> 
> 时间：2008-09-30T17:01:15.670
> 
> 标签：java, generics, design-patterns

我想要一个实现接口的类，它将特定的子类指定为参数。

```
public abstract Task implements TaskStatus<Task> {
  TaskStatus<T> listener;

  protected complete() {
      // ugly, unsafe cast
      callback.complete((T) this);
  }
}

public interface TaskStatus<T> {
   public void complete(T task);
} 
```

但不仅仅是任务，或者，我想保证使用的类型参数是扩展这个的特定类的类型。

所以我想出的最好的是：

```
public abstract Task<T extends Task> implements TaskStatus<T> {
} 
```

你可以通过写来扩展它：

```
public class MyTask extends Task<MyTask> {
} 
```

但这也是有效的：

```
public class MyTask extends Task<SomeOtherTask> {
} 
```

并且回调的调用将因 ClassCastException 而爆炸。那么，这种方法是错误的和被破坏的，还是有一种我错过的正确方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T18:30:45.267

目前尚不清楚您要在`Task`. 但是，如果您`Task<T>`按如下方式定义泛型类：

```
class Task<T extends Task<T>> { ... } 
```

以下两种是可能的：

```
class MyTask extends Task<MyTask> { ... }
class YourTask extends Task<MyTask> { ... } 
```

但禁止以下行为：

```
class MyTask extends Task<String> { ... } 
```

上面的定义`Task`使用了 F 有界多态性，这是一个相当高级的特性。您可以查看研究论文“[面向对象编程的 F-bounded polymorphism](http://www.cs.utexas.edu/~wcook/papers/FBound89/CookFBound89.pdf) ”以获取更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T18:35:42.370

我建议添加一个 getThis ，它应该返回这个适当的类型。当然，子类可能会行为不端，但这总是正确的。您避免的是强制转换和 ClassCastException 的可能性。

```
public abstract class Task<THIS extends Task<THIS>> {
    private TaskStatus<THIS> callback;

    public void setCallback(TaskStatus<THIS> callback) {
        this.callback = callback==null ? NullCallback.INSTANCE : callback;
    }

    protected void complete() {
        // ugly, unsafe cast
        callback.complete(getThis());
    }

    protected abstract THIS getThis();
}

public interface TaskStatus<T/* extends Task<T>*/> {
    void complete(T task);
}

public class MyTask extends Task<MyTask> {
    @Override protected MyTask getThis() {
        return this;
    }
} 
```

这个问题经常出现在建设者身上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T18:35:29.407

我在理解您要通过此实现的目标时遇到了一些麻烦。你能提供更多细节吗？

我对代码的阅读表明您有这些任务将被分类，并且在任务完成后，执行线程将在任务上调用 complete()。此时您要调用回调并将子类对象传递给它。我认为这是问题所在。您正试图将潜在子类的知识放入您的抽象类中，这是一个禁忌。

这也提出了一个问题，如果您可以进行此调用，那么回调将如何处理与超类不同的子类？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T18:36:55.440

如果您在构造函数中强制执行类型 arg，我真的只能看到这个工作。通过。introspection 和 Class.getSuperType() 您可以检查类型 args，并验证类型 arg 是否与此类匹配。

类似于以下内容：

```
assert getClass() == ((ParameterizedType) getSuperType()).getTypeArguments()[0]; 
```

（这是我的想法，检查 JavaDocs 来验证）。

我不确定在您的代码中创建回调的位置。您在顶部省略了它的声明。

另一种方法是删除不安全的演员表，如 atm。我看不到完整的流程来发现为什么你需要不安全的演员表。

# winforms - 在设计 WinForms UI 时尊重 XP 主题

> ID：153996
> 
> 赞同：6
> 
> 时间：2008-09-30T17:01:52.563
> 
> 标签：winforms, user-interface

在设计 WinForms UI 时如何处理不同的 XP 主题？您是否避免硬编码颜色值或只是接受您的 UI 在非标准主题上看起来不好？

例如，我有一个浅蓝色渐变面板，与标准控件背景颜色相比看起来不错，但会与其他自定义主题发生冲突。采取什么好方法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T17:12:21.883

避免使用十六进制颜色和名称为“白色”或“绿色”的颜色。大多数对象的颜色选择器应该能够向您显示名称为“ActiveWindow”或“ForegroundText”的颜色。这些是您想要使用的颜色。它们也可以通过代码获得，并且您希望选择它们，以便名称与它们的使用方式有某种关系。例如，不要仅仅因为您想要黑色背景而将“ForegroundText”设置为背景颜色。如果您有渐变，则使用这些颜色来构建渐变。此外，当主题发生变化时，您可能需要处理一个事件。

那就是*如果*你选择尊重主题。如果您有一个真正的界面，那么您可能想要指定自己的颜色。在这种情况下，*永远不要*使用窗口颜色，因为它们不可靠，你最终可能会得到一些非常丑陋的东西。这意味着您需要更改标准控件中的*所有*默认值，但如果您这样做，您可能仍然拥有自己的控件。

总之，要记住的是，这是全有或全无：要么尊重主题并*始终*使用基于 Windows 小部件元素定义的颜色，要么不使用主题并且*根本不*使用这些颜色。*********`*