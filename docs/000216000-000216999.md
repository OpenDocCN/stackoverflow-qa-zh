# StackOverflow 问答 000216000-000216999

# gcc - gcc error: wrong ELF class: ELFCLASS64

> ID：216000
> 
> 赞同：32
> 
> 时间：2008-10-19T04:19:49.683
> 
> 标签：gcc, makefile

I was trying to compile a program using an external compiled object coreset.o. I wrote the public01.c test file and my functions are in computation.c, both of which compiles. However its failing on linking it together. What might be the problem?

```
gcc -o public01.x public01.o computation.o coreset.o
ld: fatal: file coreset.o: wrong ELF class: ELFCLASS64
ld: fatal: File processing errors. No output written to public01.x
collect2: ld returned 1 exit status 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-19T04:29:31.083

I think that coreset.o was compiled for 64-bit, and you are linking it with a 32-bit computation.o.

You can try to recompile computation.c with the '-m64' flag of [gcc(1)](http://www.manpagez.com/man/1/gcc-3.3/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-19T06:04:39.973

You can specify '-m32' or '-m64' to select the compilation mode.

When dealing with autoconf (configure) scripts, I usually set CC="gcc -m64" (or CC="gcc -m32") in the environment so that everything is compiled with the correct bittiness. At least, usually...people find endless ways to make that not quite work, but my batting average is very high (way over 95%) with it.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-19T04:29:02.160

It turns out the compiler version I was using did not match the compiled version done with the coreset.o.

One was 32bit the other was 64bit. I'll leave this up in case anyone else runs into a similar problem.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-19T04:29:37.700

It looks like the object file was compiled on a 64-bit toolchain, and you're using a 32-bit toolchain. Have you tried recompiling the object file in 32-bit mode?

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-09T21:29:04.583

```
sudo apt-get install ia32-libs 
```

# sql-server - 如何确定 ms sql server 2005 中打开/活动连接的总数

> ID：216007
> 
> 赞同：95
> 
> 时间：2008-10-19T04:27:32.867
> 
> 标签：sql-server, database, sql-server-2005, connection

我的 PHP/MS Sql Server 2005/win 2003 应用程序偶尔会变得非常无响应，内存/cpu 使用率不会达到峰值。如果我尝试从 sql management studio 打开任何新连接，那么它只会挂在打开的连接对话框中。如何确定活动连接的总数 ms sql server 2005

* * *

## 回答 #1

> 赞同：277
> 
> 时间：2008-10-19T04:39:53.170

这显示了每个 DB 的连接数：

```
SELECT 
    DB_NAME(dbid) as DBName, 
    COUNT(dbid) as NumberOfConnections,
    loginame as LoginName
FROM
    sys.sysprocesses
WHERE 
    dbid > 0
GROUP BY 
    dbid, loginame 
```

这给出了总数：

```
SELECT 
    COUNT(dbid) as TotalConnections
FROM
    sys.sysprocesses
WHERE 
    dbid > 0 
```

如果您需要更多详细信息，请运行：

```
sp_who2 'Active' 
```

**注意：**使用的 SQL Server 帐户需要 'sysadmin' 角色（否则它只会显示单行和计数 1 作为结果）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-19T10:47:07.220

正如@jwalkerjr 提到的，您应该在代码中处理连接（如果启用了连接池，它们只会返回到连接池）。执行此操作的规定方法是使用 ' `using`' 语句：

```
// Execute stored proc to read data from repository
using (SqlConnection conn = new SqlConnection(this.connectionString))
{
    using (SqlCommand cmd = conn.CreateCommand())
    {
        cmd.CommandText = "LoadFromRepository";
        cmd.CommandType = CommandType.StoredProcedure;
        cmd.Parameters.AddWithValue("@ID", fileID);

        conn.Open();
        using (SqlDataReader rdr = cmd.ExecuteReader(CommandBehavior.CloseConnection))
        {
            if (rdr.Read())
            {
                filename = SaveToFileSystem(rdr, folderfilepath);
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-01-23T20:35:59.757

使用它来获得每个连接池的准确计数（假设每个用户/主机进程使用相同的连接字符串）

```
SELECT 
DB_NAME(dbid) as DBName, 
COUNT(dbid) as NumberOfConnections,
loginame as LoginName, hostname, hostprocess
FROM
sys.sysprocesses with (nolock)
WHERE 
dbid > 0
GROUP BY 
dbid, loginame, hostname, hostprocess 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-11-14T20:58:02.830

我知道这很旧，但认为更新是个好主意。如果需要准确计数，则可能还应过滤列 ECID。具有并行线程的 SPID 可以在 sysprocesses 中多次显示，过滤 ECID=0 将返回每个 SPID 的主线程。

```
SELECT 
    DB_NAME(dbid) as DBName, 
    COUNT(dbid) as NumberOfConnections,
    loginame as LoginName
FROM
    sys.sysprocesses with (nolock)
WHERE 
    dbid > 0
    and ecid=0
GROUP BY 
    dbid, loginame 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T06:58:29.457

如果您的 PHP 应用程序保持打开许多 SQL Server 连接，那么您可能知道，您的应用程序的数据库代码存在问题。它应该在使用和使用连接池后释放/处理这些连接。在这里查看有关该主题的体面文章...

[http://www.c-sharpcorner.com/UploadFile/dsdaf/ConnPooling07262006093645AM/ConnPooling.aspx](http://www.c-sharpcorner.com/UploadFile/dsdaf/ConnPooling07262006093645AM/ConnPooling.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-12T13:57:04.947

查看[sp_who](http://msdn.microsoft.com/en-us/library/ms174313.aspx)它为您提供了更多详细信息，而不仅仅是查看连接数

在你的情况下，我会做这样的事情

```
 DECLARE @temp TABLE(spid int , ecid int, status varchar(50),
                     loginname varchar(50),   
                     hostname varchar(50),
blk varchar(50), dbname varchar(50), cmd varchar(50), request_id int) 
INSERT INTO @temp  

EXEC sp_who

SELECT COUNT(*) FROM @temp WHERE dbname = 'DB NAME' 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-07-08T06:37:15.107

**基于 MS SQL 知识 - 如何知道打开的 SQL 数据库连接和占用的主机。**

使用下面的查询，您将找到列表数据库、主机名和打开连接总数，基于此您将知道哪个主机占用了 SQL 连接。

```
SELECT DB_NAME(dbid) as DBName, hostname ,COUNT(dbid) as NumberOfConnections
FROM sys.sysprocesses with (nolock) 
WHERE dbid > 0 
and len(hostname) > 0 
--and DB_NAME(dbid)='master' /* Open this line to filter Database by Name */
Group by DB_NAME(dbid),hostname
order by DBName 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-01-11T08:53:19.383

```
SELECT
[DATABASE] = DB_NAME(DBID), 
OPNEDCONNECTIONS =COUNT(DBID),
[USER] =LOGINAME
FROM SYS.SYSPROCESSES
GROUP BY DBID, LOGINAME
ORDER BY DB_NAME(DBID), LOGINAME 
```

# c# - C#：虚拟函数调用比委托调用更快？

> ID：216008
> 
> 赞同：17
> 
> 时间：2008-10-19T04:28:09.403
> 
> 标签：c#, performance, delegates, virtual

它只是发生在我的一个代码设计问题上。比如说，我有一个“模板”方法，它调用一些可能“改变”的函数。一个直观的设计是遵循“模板设计模式”。将更改函数定义为要在子类中覆盖的“虚拟”函数。或者，我可以只使用没有“虚拟”的委托函数。委托函数被注入，因此它们也可以被定制。

最初，我认为第二种“委托”方式会比“虚拟”方式更快，但一些代码片段证明它是不正确的。

在下面的代码中，第一个 DoSomething 方法遵循“模板模式”。它调用虚拟方法 IsTokenChar。第二种 DoSomthing 方法不依赖于虚函数。相反，它有一个传入委托。在我的电脑中，第一个 DoSomthing 总是比第二个快。结果就像 1645:1780。

“虚拟调用”是动态绑定，应该比直接委托调用更耗时，对吧？但结果表明并非如此。

有人可以解释一下吗？

```
using System;
using System.Diagnostics;

class Foo
{
    public virtual bool IsTokenChar(string word)
    {
        return String.IsNullOrEmpty(word);
    }

    // this is a template method
    public int DoSomething(string word)
    {
        int trueCount = 0;
        for (int i = 0; i < repeat; ++i)
        {
            if (IsTokenChar(word))
            {
                ++trueCount;
            }
        }
        return trueCount;
    }

    public int DoSomething(Predicate<string> predicator, string word)
    {
        int trueCount = 0;
        for (int i = 0; i < repeat; ++i)
        {
            if (predicator(word))
            {
                ++trueCount;
            }
        }
        return trueCount;
    }

    private int repeat = 200000000;
}

class Program
{
    static void Main(string[] args)
    {
        Foo f = new Foo();

        {
            Stopwatch sw = Stopwatch.StartNew();
            f.DoSomething(null);
            sw.Stop();
            Console.WriteLine(sw.ElapsedMilliseconds);
        }

        {
            Stopwatch sw = Stopwatch.StartNew();
            f.DoSomething(str => String.IsNullOrEmpty(str), null);
            sw.Stop();
            Console.WriteLine(sw.ElapsedMilliseconds);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-19T06:49:29.913

想想每种情况下需要什么：

**虚拟通话**

*   检查无效性
*   从对象指针导航到类型指针
*   在指令表中查找方法地址
*   （不确定 - 即使 Richter 也没有涵盖这一点）如果方法没有被覆盖，则转到基本类型？递归直到我们找到正确的方法地址。（我不这么认为 - 请参阅底部的编辑。）
*   将原始对象指针压入堆栈（“this”）
*   调用方法

**代表电话**

*   检查无效性
*   从对象指针导航到调用数组（所有委托都可能是多播的）
*   循环遍历数组，并为每次调用：
    *   获取方法地址
    *   确定是否将目标作为第一个参数传递
    *   将参数推入堆栈（可能已经完成 - 不确定）
    *   可选（取决于调用是打开还是关闭）将调用目标推送到堆栈上
    *   调用方法

可能会进行一些优化，以便在单次调用情况下不涉及循环，但即使这样也需要非常快速的检查。

但基本上，委托也涉及到同样多的间接性。鉴于我在虚拟方法调用中不确定的一点，在非常深的类型层次结构中调用未覆盖的虚拟方法可能会更慢......我会试一试并编辑答案。

编辑：我尝试过使用继承层次结构的深度（最多 20 级）、“最派生的覆盖”点和声明的变量类型——它们似乎都没有什么不同。

编辑：我刚刚使用接口（传入）尝试了原始程序 - 最终具有与委托相同的性能。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-06T00:43:51.080

只是想对 john skeet 的回复添加一些更正：

虚拟方法调用不需要进行空值检查（通过硬件陷阱自动处理）。

它也不需要遍历继承链来查找非覆盖方法（这就是虚拟方法表的用途）。

调用时，虚方法调用本质上是一个额外的间接级别。由于查表和随后的函数指针调用，它比普通调用慢。

委托调用还涉及额外的间接级别。

除非您使用 DynamicInvoke 方法执行动态调用，否则对委托的调用不涉及将参数放入数组中。

委托调用涉及调用方法对相关委托类型调用编译器生成的 Invoke 方法。对 predicator(value) 的调用被转换为 predicator.Invoke(value)。

Invoke 方法又由 JIT 实现以调用函数指针（内部存储在委托对象中）。

在您的示例中，您传递的委托应该被实现为编译器生成的静态方法，因为该实现不访问任何实例变量或本地变量，因此需要从堆访问“this”指针应该不是问题。

委托和虚函数调用之间的性能差异应该基本相同，并且您的性能测试表明它们非常接近。

差异可能是由于多播需要额外的检查+分支（如约翰所建议的）。另一个原因可能是 JIT 编译器没有内联 Delegate.Invoke 方法，并且在执行虚拟方法调用时，Delegate.Invoke 的实现不处理参数以及实现。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-19T05:57:50.220

虚拟调用正在取消引用内存中众所周知的偏移量处的两个指针。它实际上不是动态绑定；运行时没有代码来反映元数据以发现正确的方法。编译器根据 this 指针生成几个指令来执行调用。实际上，虚调用是一条 IL 指令。

谓词调用是创建一个匿名类来封装谓词。该类必须被实例化，并且生成了一些代码来实际检查谓词函数指针是否为空。

我建议您查看两者的 IL 构造。只需调用两个 DoSomthing 中的每一个，即可编译上述源代码的简化版本。然后使用 ILDASM 查看每种模式的实际代码是什么。

（而且我相信我会因为没有使用正确的术语而被否决:-)）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-26T01:29:22.047

测试结果值 1000 字： http: [//kennethxu.blogspot.com/2009/05/strong-typed-high-performance_15.html](http://kennethxu.blogspot.com/2009/05/strong-typed-high-performance_15.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T04:40:34.243

由于您没有任何覆盖虚拟方法的方法，因此 JIT 可能能够识别并使用直接调用。

对于这样的事情，通常最好像您所做的那样对其进行测试，而不是尝试猜测性能会是什么。如果您想了解有关委托调用如何工作的更多信息，我建议您阅读 Jeffrey Richter 的优秀书籍“CLR Via C#”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-19T05:27:40.950

我怀疑它解释了你的所有差异，但我脑海中浮现的一件事可能会解释一些差异，那就是虚拟方法调度已经`this`准备好指针了。通过委托调用时`this`，必须从委托中获取指针。

请注意，根据[这篇博客文章](http://www.sturmnet.org/blog/archives/2005/09/01/)，.NET v1.x 中的差异甚至更大。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T05:26:40.423

虚拟覆盖具有某种重定向表或在编译时经过硬编码和完全优化的东西。它是一成不变的，非常快。

代表是动态的，总是会有开销，而且它们似乎也是对象，所以加起来。

您不必担心这些微小的性能差异（除非为军方开发性能关键软件），对于大多数用途而言，良好的代码结构胜过优化。

# php - 拒绝访问 .htaccess 中的 .ini 文件是否安全？

> ID：216019
> 
> 赞同：9
> 
> 时间：2008-10-19T04:39:36.087
> 
> 标签：php, .htaccess

我的 php wab 应用程序中有一个包含敏感信息的 .ini 文件。我使用 .htaccess 文件拒绝访问它：

```
<files my.ini>
  order deny,allow
  deny from all
</files> 
```

我无权访问 htdocs 之外的文件夹，因此无法将 .ini 文件移出可浏览区域。

我的解决方案安全吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-19T07:39:32.230

.htaccess 将阻止来自网络的访问。但是，如果您使用的是共享主机环境，其他用户可能会访问您的 ini。如果它在（虚拟专用）服务器上，并且您是该服务器的唯一用户，那么您是安全的。

在共享主机的情况下，它取决于服务器配置。有关更多信息，请阅读：[共享托管环境中的 PHP 安全性](http://www.hostreview.com/guides/Technical_Support/articles/PHPSecurityinSharedEnvironment.html)

您可以临时安装[PHPShell](http://phpshell.sourceforge.net/)并浏览服务器文件系统以检查您的服务器是否易受攻击。（需要一些命令行知识）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-12-07T19:49:02.307

另一个很好的解决方案也是我个人最喜欢的（尤其是在开发可能不受我严格的 .htaccess 控制的代码时）是保护实际的 .ini 文件。感谢[这里的好心人 - 用户注释： pd at freeze-bits dot de](http://php.net/manual/en/function.parse-ini-file.php)，我所做的是：

```
my.ini -> changes to my.ini.php 
```

my.ini.php 开始：

```
;<?php
;die(); // For further security
;/*
    [category]
    name="value"

;*/ 
```

完美运行！直接访问文件，你看到的只是';' ***它是一个有效的、***可解析的 .ini 文件。什么不喜欢:)

关于实际实施的一些注意事项（如果这算作“过度分享”，请道歉，但可能会节省一些时间）：

1.  这个文件让我的 IDE 非常不安，它一直在尝试自动重新格式化，然后让 PHP 不安。祝福在记事本++上。
2.  不要忘记关闭`;*/`。如果你忽略它，它仍然可以工作，但 PHP 会警告你它即将变得不安。

排序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T05:39:46.700

该文件在 apache 中将不可见。显然，最好的选择是将它放在您网站的根目录之外。如果你不能这样做，.htaccess 文件（或你的 apache 配置中的类似指令）几乎是你唯一的选择。

# visual-studio - GCC 与 Visual Studio？

> ID：216025
> 
> 赞同：60
> 
> 时间：2008-10-19T04:41:14.913
> 
> 标签：visual-studio, visual-studio-2008, visual-c++, gcc, makefile

在 Visual Studio 2008 中使用 GCC 而不是 VC++ 有多难？显然，有些关键字不匹配，有些可能无法突出显示语法（除非您创建了新的语言服务）。

这就是“makefile 项目”的用途吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-19T07:17:04.647

Visual Studio 没有 GCC 插件，例如 Intel C++ 的插件，它允许 Intel 的编译器用作 Visual C++ 的直接替代品。

您可以使用 Makefile 项目，它允许您使用任何您喜欢的外部工具（make、SCons、jam 等）来进行构建。如果您不喜欢 Makefile，您可能需要查看[CMake](http://www.cmake.org)，它允许您从更简单的描述生成 Makefile 或 Visual Studio 项目。这也意味着您不必绑定到 Makefile 或 Visual Studio 项目，而是可以根据需要在它们之间切换。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2010-01-08T03:09:05.400

有关类似讨论，请参阅 MSDN 论坛中的主题**[“使用 gcc 端口使用 Visual Studio 构建程序”](http://social.msdn.microsoft.com/Forums/en-US/Vsexpressvc/thread/c07f416a-3d1d-46d0-95cf-81fe790c461f)**。

您可以使用 makefile 也可以使用[WinGDB](http://www.wingdb.com/docs/pages/wg_intro.htm)进行更好的[集成](http://www.wingdb.com/docs/pages/wg_projects.htm)（包括[调试](http://www.wingdb.com/wgScreenshots.htm)）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-09-18T13:40:33.013

您可以使用[Visual Studio 的 Visual GDB](http://visualgdb.com/)插件来简化 GCC 的工作

# php - 在 PHP 中获取最后添加的数组项的键的最佳方法是什么？

> ID：216030
> 
> 赞同：3
> 
> 时间：2008-10-19T04:50:38.373
> 
> 标签：php, arrays, key

有没有更好的方法来执行以下操作：

```
$array = array('test1', 'test2', 'test3', 'test4', 'test5');
// do a bunch of other stuff, probably a loop
$array[] = 'test6';
end($array);
echo key($array); // gives me 6 
```

这将给出最近添加的数组元素的键。

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-19T05:14:31.587

你也可以这样做：

```
$end = end(array_keys($array)); 
```

但我认为你的方式清楚地表明了你想要做什么，所以你可以做出如下的事情：

```
function array_last_key($array) {
    end($array);
    return key($array);
} 
```

就是这样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T05:15:03.550

PHP中对此没有特殊功能，因此我认为您的方式是最有效的方式。为了便于阅读，您可能希望将其放在一个名为 array_last_key() 的函数中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T06:12:49.550

如果您可以保证您的数组不会有任何非数字键并且您不会删除任何键，那么添加到数组键的最后一个元素将是

```
$last_added = count($array)-1; 
```

如果您确实需要跟踪最新添加的密钥，您可能需要提出一个方案来提供您自己的保证唯一的密钥。这样，您将始终拥有自生成它以来最新添加的密钥。

```
$array = array('test1', 'test2', 'test3', 'test4', 'test5');
// do a bunch of other stuff, probably a loop
$new_key = generate_key();
$array[$new_key] = 'test6';
echo $new_key; // gives me blahblahfoobar123 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T18:05:35.120

简单地说没有。end 和 key 都是大 O(1) 时间。任何其他方式都会减慢您的代码速度并增加复杂性。

# .net - 中等信任下的进程内数据库选项

> ID：216035
> 
> 赞同：2
> 
> 时间：2008-10-19T05:08:24.640
> 
> 标签：.net, asp.net, sql, database, medium-trust

我已经看到了一些用于 .NET 的不同进程内 SQL 数据库（包括来自 Microsoft 的一个），但它们要么在中等信任 (ASP.NET) 下无法工作，要么文档/网站甚至都没有提及。

一般来说，您对进程内数据库有什么经验，您知道在 ASP.NET 的中等信任下工作的任何经验吗？

**更新**：我知道很多东西放在 GAC 中时在中等信任中起作用，它充当一种信任机构。但是，我更喜欢可部署的解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-19T17:21:35.787

试试[VistaDB](http://vistadb.net/)，它在中等信任配置下工作，并且可以部署在应用程序的**bin**文件中。

它还支持 ASP.Net Membership API、100% .Net、加密、使用 SQL Server 语法等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T10:14:38.377

当程序集存储在 GAC 中时，它们中的很多都可以工作（我*知道SQLite 可以）。*

我假设您正在使用某种形式的共享主机来体验 Medium Trust 的困境。大多数提供商都足够了解将二进制文件添加到全局缓存中，因为它们是第三方并且看起来相当有信誉。SQLite 已经很成熟了，所以看起来你不应该要求他们安装木马。

# c - C语言中的函数式编程有哪些工具？

> ID：216037
> 
> 赞同：162
> 
> 时间：2008-10-19T05:12:17.910
> 
> 标签：c, functional-programming

我最近一直在思考如何在 C（*不是*C++）中进行函数式编程。显然，C 是一种过程语言，并不真正支持本机的函数式编程。

是否有任何编译器/语言扩展可以为语言添加一些函数式编程结构？GCC 提供[嵌套函数](http://gcc.gnu.org/onlinedocs/gcc/Nested-Functions.html)作为语言扩展；嵌套函数可以从父栈帧访问变量，但这距离成熟的闭包还有很长的路要走。

例如，我认为在 C 语言中真正有用的一件事是，在需要函数指针的任何地方，您都可以传递 lambda 表达式，创建一个衰减为函数指针的闭包。C++0x 将包含 lambda 表达式（我认为这很棒）；但是，我正在寻找适用于纯 C 的工具。

[编辑] 澄清一下，我并不是要解决 C 中更适合函数式编程的特定问题。如果我想这样做，我只是好奇那里有什么工具。

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2010-07-31T14:31:01.130

可以使用 GCC 的嵌套函数来模拟 lambda 表达式，其实我有一个宏可以帮我做：

```
#define lambda(return_type, function_body) \
  ({ \
    return_type anon_func_name_ function_body \
    anon_func_name_; \
  }) 
```

像这样使用：

```
int (*max)(int, int) = lambda (int, (int x, int y) { return x > y ? x : y; }); 
```

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2013-11-08T23:22:57.760

函数式编程不是关于 lambda，而是关于纯函数。所以下面大致推广功能风格：

1.  只使用函数参数，不要使用全局状态。

2.  尽量减少副作用，即 printf 或任何 IO。返回描述可以执行的 IO 的数据，而不是直接在所有函数中引起副作用。

这可以在纯 c 中实现，不需要魔法。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2008-10-19T18:32:19.403

[FFCALL](http://www.haible.de/bruno/packages-ffcall.html)允许您在 C 中构建闭包——`callback = alloc_callback(&function, data)`返回一个函数指针，这`callback(arg1, ...)`相当于调用`function(data, arg1, ...)`。不过，您将不得不手动处理垃圾收集。

与此相关的是，Apple 的 GCC 分支中已添加了[块；](http://lists.cs.uiuc.edu/pipermail/cfe-dev/2008-August/002670.html)它们不是函数指针，但它们让您可以传递 lambda，同时避免手动为捕获的变量构建和释放存储空间（实际上，发生了一些复制和引用计数，隐藏在一些语法糖和运行时库后面）。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2012-01-02T05:35:36.580

Hartel & Muller 的书，*Functional C*，现在 (2012-01-02) 可以在以下位置找到：[http](http://eprints.eemcs.utwente.nl/1077/) ://eprints.eemcs.utwente.nl/1077/ （有 PDF 版本的链接）。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2017-08-16T17:05:47.007

函数式编程风格的先决条件是一流的函数。如果你容忍下一个，它可以在便携式 C 中模拟：

*   词法范围绑定的手动管理，也就是闭包。
*   手动管理函数变量的生命周期。
*   函数应用程序/调用的替代语法。

```
/* 
 * with constraints desribed above we could have
 * good approximation of FP style in plain C
 */

int increment_int(int x) {
  return x + 1;
}

WRAP_PLAIN_FUNCTION_TO_FIRST_CLASS(increment, increment_int);

map(increment, list(number(0), number(1)); // --> list(1, 2)

/* composition of first class function is also possible */

function_t* computation = compose(
  increment,
  increment,
  increment
);

*(int*) call(computation, number(1)) == 4; 
```

此类代码的运行时可能小到以下

```
struct list_t {
  void* head;
  struct list_t* tail;
};

struct function_t {
   void* (*thunk)(list_t*);
   struct list_t* arguments;
}

void* apply(struct function_t* fn, struct list_t* arguments) {
  return fn->thunk(concat(fn->arguments, arguments));
}

/* expansion of WRAP_PLAIN_FUNCTION_TO_FIRST_CLASS */
void* increment_thunk(struct list_t* arguments) {
  int x_arg = *(int*) arguments->head;
  int value = increment_int(x_arg);
  int* number = malloc(sizeof *number);

  return number ? (*number = value, number) : NULL;
}

struct function_t* increment = &(struct function_t) {
  increment_thunk,
  NULL
};

/* call(increment, number(1)) expands to */
apply(increment, &(struct list_t) { number(1), NULL }); 
```

本质上，我们模仿了第一类函数，闭包表示为一对函数/参数加上一堆宏。完整的代码可以在[这里](https://github.com/viktor-shepel/frunzik)找到。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-19T05:24:49.710

想到的主要事情是代码生成器的使用。您是否愿意用提供函数式编程的不同语言进行编程，然后从中生成 C 代码？

如果这不是一个有吸引力的选择，那么您可以滥用 CPP 来获得成功。宏系统应该让您模拟一些函数式编程思想。我听说 gcc 是以这种方式实现的，但我从未检查过。

C 当然可以使用函数指针传递函数，主要问题是缺少闭包并且类型系统往往会妨碍。您可以探索比 CPP 更强大的宏系统，例如 M4。我想最终，我的建议是真正的 C 不费力气就无法完成任务，但您可以扩展 C 以使其能够完成任务。如果您使用 CPP，则该扩展看起来最像 C，或者您可以转到光谱的另一端并从其他语言生成 C 代码。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-21T14:02:31.693

如果你想实现闭包，你必须熟悉汇编语言和堆栈交换/管理。不建议反对它，只是说这是你必须做的。

不确定您将如何在 C 中处理匿名函数。不过，在冯诺依曼机器上，您可以在 asm 中执行匿名函数。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-03-31T23:16:30.237

我在 C 中进行函数式编程的方法是用 C 编写函数式语言解释器。我将其命名为 Fexl，它是“函数表达式语言”的缩写。

解释器非常小，在启用 -O3 的系统上编译到 68K。它也不是玩具——我将它用于我为我的业务编写的所有新生产代码（基于网络的投资伙伴关系会计。）

现在我编写 C 代码只是为了 (1) 添加一个调用系统例程的内置函数（例如 fork、exec、setrlimit 等），或 (2) 优化一个原本可以用 Fexl 编写的函数（例如 search对于子字符串）。

模块机制基于“上下文”的概念。上下文是一个将符号映射到其定义的函数（用 Fexl 编写）。当您阅读 Fexl 文件时，您可以使用您喜欢的任何上下文来解析它。这允许您创建自定义环境，或在受限制的“沙箱”中运行代码。

[http://fexl.com](http://fexl.com)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-21T06:49:41.677

看看 Hartel & Muller 的书，*Functional C*

[http://www.ub.utwente.nl/webdocs/ctit/1/00000084.pdf](http://www.ub.utwente.nl/webdocs/ctit/1/00000084.pdf)
[http://www.cs.bris.ac.uk/~henkm/f2c/index.html](http://www.cs.bris.ac.uk/~henkm/f2c/index.html)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-11-04T13:42:04.590

[Felix 语言](http://www.felix-lang.org/)编译为 C++ 。如果您不介意 C++，也许这可能是一个垫脚石。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-19T06:02:26.513

好吧，相当多的编程语言是用 C 编写的。其中一些支持作为一等公民的功能，该领域的语言是 ecl（embedabble common lisp IIRC），Gnu Smalltalk（gst）（Smalltalk 有块），然后是库对于“闭包”，例如在 glib2 [http://library.gnome.org/devel/gobject/unstable/chapter-signal.html#closure](http://library.gnome.org/devel/gobject/unstable/chapter-signal.html#closure) 中，它至少接近函数式编程。因此，也许使用其中一些实现来进行函数式编程可能是一种选择。

好吧，或者你可以去学习 Ocaml、Haskell、Mozart/Oz 等；-)

问候

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-10-19T07:54:42.933

你想让 C 函数化，语法或语义是什么？函数式编程的语义当然可以添加到 C 编译器中，但是当你完成时，你基本上已经拥有了现有函数式语言之一的等价物，例如 Scheme、Haskell 等。

只学习直接支持这些语义的那些语言的语法会更好地利用时间。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2009-11-29T22:36:49.737

不了解 C。虽然 Objective-C 中有一些功能特性，OSX 上的 GCC 也支持一些特性，但是我再次建议开始使用函数式语言，上面提到了很多。我个人是从计划开始的，有一些很棒的书，比如 The Little Schemer 可以帮助你做到这一点。

# svn - 如何从 SVN 获取所有未版本化文件的列表？

> ID：216049
> 
> 赞同：80
> 
> 时间：2008-10-19T05:25:29.223
> 
> 标签：svn, version-control

有时您正在开发并决定提交，忘记了您在项目中创建了一些文件。然后几天后，您的伙伴从 Subversion 中获取了您的构建，并抱怨某些文件似乎丢失了。你意识到，啊废话，我忘了添加那些文件！

如何从 Subversion 获取不受版本控制的文件列表，以便我确定我已将所有内容添加到存储库中？

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2008-10-19T05:26:55.057

使用[`svn status`](http://svnbook.red-bean.com/en/1.0/re26.html)命令：

```
svn status | grep ^? 
```

未版本化的文件用 ? 在行的开头。

如果您发现您总是有一些不应该添加到存储库的特定文件（例如，生成的二进制文件），您应该[`svn:ignore`](http://svnbook.red-bean.com/en/1.1/ch07s02.html)在包含目录上设置属性，这样这些文件在使用`svn status`.

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2011-08-29T14:05:13.717

如果某些文件已[`ignore`](http://svnbook.red-bean.com/en/1.0/ch07s02.html#svn-ch-7-sect-2.3.3)添加到其状态，它们将不会显示在`svn status`. 你需要：

```
svn status --no-ignore 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-07-04T12:42:48.607

如果您在 Windows 上运行，则可以使用 PowerShell执行类似于[Greg Hewgill的回答的操作。](https://stackoverflow.com/users/893/greg-hewgill)

```
(svn stat) -match '^\?' 
```

这可以很容易地扩展以查找所有未版本化和忽略的文件并删除它们。

```
(svn stat "--no-ignore") -match '^[I?]' -replace '^.\s+','' | rm 
```

希望这对某人有帮助！

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-11-26T17:05:12.063

或从 Windows 命令行：

```
svn stat | find "?" 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-25T11:00:58.993

您可以使用此命令列出非版本控制文件的所有路径：

```
svn status | awk '/^?/ {print $2}' 
```

第一部分将执行一个`svn status`，然后它将输出重定向到[AWK](http://en.wikipedia.org/wiki/AWK)它将执行简单的过滤器“第一个字符应该是'？'”，然后它将打印第二个参数“这是文件路径”。

`svn status`将永远*不会*打印被忽略的文件。您可以通过使用添加该路径来添加文件或路径

```
svn propset svn:ignore "PATH OR PATERN" 
```

# binaryfiles - 究竟是什么导致二进制文件“乱码”？

> ID：216066
> 
> 赞同：20
> 
> 时间：2008-10-19T05:46:52.287
> 
> 标签：binaryfiles

我还没有找到这个特定问题的答案；也许没有。但我一直在想这件事。

当您在文本编辑器中查看二进制文件时，究竟是什么导致二进制文件显示为“乱码”？加密文件也是如此。文件的二进制值是否试图转换为 ASCII？是否可以将视图转换为显示原始二进制值，即显示构成文件的 1 和 0？

最后，有没有办法确定哪个程序可以正确打开数据文件？很多时候，尤其是在 Windows 中，文件是孤立的，或者与特定程序无关。在文本编辑器中打开它有时会告诉你它属于哪里，但由于乱码，大多数时候不会。如果扩展程序不提供任何信息，您如何确定它属于哪个程序？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-19T05:57:42.730

*   ***Are the binary values of the file trying to be converted into ASCII?***

Yes, that's exactly what's happening. Typically, the binary values of the file also include ASCII control characters that aren't printable, resulting in even more bizarre display in a typical text editor.

*   ***Is it possible to convert the view to display raw binary values, i.e. to show the 1s and 0s that make up the file?***

It depends on your editor. What you want is a "hex editor", rather than a normal text editor. This will show you the raw contents of the file (typically in hexadecimal rather than binary, since the zeros and ones would take up a lot of space and be harder to read).

*   ***Finally, is there a way to determine what program will properly open a data file?***

There is a Linux command-line program called ["file"](http://linux.die.net/man/1/file) that will attempt to analyze the file (typically looking for common header patterns) and tell you what sort of file it is (for example text, or audio, or video, or XML, etc). I'm not sure if there is an equivalent program for Windows. Of course, the output of this program is just a guess, but it can be very useful when you don't know what the format of a file is.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-19T05:58:59.670

A binary file appears as gibberish because the data in it is designed for the machine to read and not for humans. Sadly, some of us get used to interpreting gibberish - albeit with somewhat specialized tools to help see the data better - but most people should not need to know.

Each byte in the file is treated as a character in the current code set (probably CP1252 on Windows). Byte value 65 is 'A', for example; you can find illustrative examples easily on the web. So, the bytes that make up the binary data are displayed according to the code set - as best as the text editor can. It doesn't try to convert the binary - it doesn't know how (only the original program does).

As to how to detect what program created the file - you may be able to do that sometimes, but not easily and reliably. On Unix (or with Cygwin on Windows) the 'file' program may be able to help. This program looks at the first few bytes to try and guess the program.

Encrypted data is supposed to look like gibberish. If it doesn't look like gibberish, then it probably isn't very well encrypted.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-19T05:53:44.610

显示看起来很有趣，因为二进制文件可以包含不可打印的字符。由显示程序用其他字符替换这些字符。

这可以通过使用十六进制编辑器来防止。这样的程序将文件中的每个字节显示为其十六进制值。这为文件提供了一个很好的表格视图，但是对于普通人来说，破译这个视图并不容易，因为我们不习惯以这种方式查看数据。

有几种方法可以找出文件可能属于哪个程序。您可以查看文件的开头，并且通过一些知识，您可能会识别文件类型。有些类型以相同的字符开头（RAR、GIF 等）。对于其他类型，它可能不那么容易。

在 Linux 中，您可以使用“文件”命令来帮助您确定文件类型。可能有适用于 Windows 的程序可以做到这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-19T05:59:39.983

The reason files that are binary display as gibberish when viewed in standard text editors such as notepad is because when displayed with the encodings commonly used by these types of applications (e.g. ASCII of UTF-8) the data is mapped to characters when it is encoded for display, the output of this process generally makes as little sense to humans as the binary data being mapped, ergo the gibberish you see

As previously mentioned these files make more sense when viewed in a different way such as with a hex editor.

Certain file types can be recognized by data present in all files of a given type, for example all executable files (*.exe) begin with the letters MZ

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-19T06:04:06.930

Binary data is often very random. Encrypted data in particular, by definition. Each byte can be represented by one of 256 characters (leaving Unicode out of the equation). ASCII only covers 128 of these, and only 94 of these are actual printable characters. Outside the ASCII range, you have a number of international characters and strange symbols. There are certainly more than 128 of these, so one must specify a codepage to select a specific set of symbols.

Anyway, since binary files can be represented as a very random assortment of familiar and unfamiliar characters, the file will look like gibberish if you open it in an editor.

You could always open a file (binary or text file, there really is no difference) in a hex editor, and look at the raw binary data.

There is no way to tell which program created a specific file. In particular, if the program has encrypted its data, all hope is lost. Otherwise, it is often easy to recognize certain "signatures."

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T05:54:49.400

是的，写字板和记事本以及许多其他文本编辑器假定您使用它打开的任何文件都是文本文件，并且会尝试显示文件中字节表示的 ASCII 字符。

[十六进制编辑器](http://en.wikipedia.org/wiki/Hex_editor)用于查看和编辑二进制文件。它们通常将每个字节显示为一对十六进制数字，而不是“1 和 0”，因为这样更容易阅读。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T05:56:18.163

除了字符编码之类的东西之外，文本编辑器对进入其中的数据做出的假设很少。因此，它将（如您所说）将文件数据读取为 ASCII 并以这种方式显示。由于二进制数据并不总是在字母数字范围内，因此您会胡言乱语。至于显示原始二进制值，您需要像[XVI32](http://www.chmaas.handshake.de/delphi/freeware/xvi32/xvi32.htm)这样的十六进制编辑器。

Binary files often have no context outside of the program that uses them. Some binary formats contain a 4-byte magic sequence at the beginning (for example, Java .class files start with "CAFE"), but to recognize them without their program, you need a mapping of those 4-byte sequences. I believe some Linux distros contain this information for a wide variety of binary formats and will examine the beginning of the file to attempt to identify it. Other than that, there's not much you can do.

# c++ - 从一行解析整数

> ID：216068
> 
> 赞同：3
> 
> 时间：2008-10-19T05:48:48.740
> 
> 标签：c++, string, parsing

我正在解析一个输入文本文件。如果我使用 getline() 一次获取一行输入，有没有一种方法可以搜索字符串以获取整数？我在想类似于 Java 中的 getNextInt() 的东西。

我知道该输入行中必须有 2 个数字；但是，这些值将由一个或多个空格字符分隔，因此我不能只转到特定位置。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-19T18:23:36.113

有几件事需要考虑：
假设您在每行有两个数字，后跟您不关心的文本。

```
while(inFile >> rows >> columns)
{
    // Successfully read rows and columns

    // Now remove the extra stuff on the line you do not want.
    inFile.ignore( std::numeric_limits<std::streamsize>::max(), '\n' );
} 
```

另请注意，如果分隔整数值的唯一因素是“空白”，那么您甚至不需要使用 ignore() 行。

上面的 while() 之所以有效，是因为：运算符 >> 返回一个流对象（引用）。因为流对象在布尔上下文中使用，编译器将尝试将其转换为布尔值，并且流对象具有执行该转换的强制转换运算符（通过在流上调用 good()）。

需要注意的重要一点是**不要**使用该行

```
while(inFile.eof()) 
```

如果你确实使用它，那么你就会陷入最后一行问题的陷阱。如果您已阅读所有数据，则 eof() 仍然是错误的（因为在您尝试阅读过去的 EOF 之前它是不正确的）。所以文件中没有任何数据，但您仍然输入循环体。然后在您的代码中执行 getline() 并失败（没有更多数据），现在设置了 EOF。循环的其余部分将取决于 inLine 的定义方式和位置。

您可以如上所述使用此测试。但是您还必须愿意在使用后测试流是否正常。

```
while(inFile.eof())  // Should probably test good()
{
    getLine(inFile,inputline);
    if(inFile.eof()) // should probably test good()
    {
         break;
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-19T05:52:40.353

如果那里唯一的东西是空格和整数，请尝试以下操作：

```
int i1, i2;
stringstream ss(lineFromGetLine);
ss >> i1 >> i2; 
```

或更简单：

```
int i1, i2;
theFileStream >> i1 >> i2; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T06:01:01.773

这不仅仅是一点点 C-ish，但您可以在 C 字符串表示上使用 sscanf() 。或者您可以使用 strtol() 或亲属 - 也在 C 字符串表示上。

更 C++ 的方式可能会使用字符串流和提取器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T06:12:57.537

我试过：

```
while (!inFile.eof()) {
    getline (inFile,inputLine);
    stringstream ss(inputLine);
    ss >> rows >> columns;
} 
```

我收到以下错误：

“术语不评估为带 1 个参数的函数”在行

ss（输入线）；

编辑：所以你必须在你给它参数的那一刻声明字符串流。更正了上面编辑的代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-24T13:43:58.913

永远不要使用 .eof() 来测试你是否可以阅读，也不要使用 .eof() 来测试之前的阅读是否失败。在某些情况下，这两种方法都会失败，因为：

*   即使没有剩余字符，也不会设置 EOF，如果尚未尝试读取末尾（例如，在最后一行的 getline 之后，如果末尾有换行符）
*   如果读取操作必须在结束后查看下一个字符以确定它应该停止读取（例如，在最后一行的明线之后，如果末尾没有换行符），则即使在成功读取之后也会设置 EOF

一般来说，您应该只在读取失败后使用 .eof() 来检查失败是否是由输入结束引起的。

用于`while (std::getline(...))`循环线。

# apache-flex - 将 Amazon S3 文件托管用于 Flex 模块/swfs 时的安全问题

> ID：216069
> 
> 赞同：0
> 
> 时间：2008-10-19T05:49:53.153
> 
> 标签：apache-flex, security, flash, crossdomain.xml

在使用 Amazon S3 的托管托管 Flex 站点（具有多个模块）时，我会遇到什么样的安全问题？

如果它们是从两个不同的子域加载的，我什至可以在两个不同的 swf 之间进行通信吗？（这些将是模块）

我还不知道我是否会在 S3 上托管所有模块或只是一些。为了测试对服务器负载的影响，只测试托管我们的主 .swf（公共网站）肯定会更容易

我知道用于 web servcies 的 crossdomain.xml - 这也适用于跨域 swf 通信吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T06:06:05.680

您必须授予对 SWF 的安全访问权限，因为它们不是来自同一个域。该方法类似于 web 服务的跨域，不同之处在于您需要放置以下方法调用“ [security.allowDomain](http://livedocs.adobe.com/flash/9.0/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002104.html) ”而不是跨域 XML。

为了让来自不同域的 SWF 检查和修改变量、对象、属性、方法（跨域脚本），您需要调用“security.allowDomain”。

Adobe 文档详细介绍了它。

# javascript - AJAX.Request POST 正文未发送

> ID：216070
> 
> 赞同：1
> 
> 时间：2008-10-19T05:50:53.947
> 
> 标签：javascript, post, prototypejs

我正在尝试创建一个 POST 请求，不幸的是，似乎从未发送过 POST 的正文。

下面是我正在使用的代码。当用户单击链接时调用代码，而不是表单“提交”按钮。它运行没有错误，调用正在调用的 servlet，但是，正如我之前提到的，POST 的主体似乎从未被发送。

我可以验证请求正文永远不会发送，因为我可以访问被调用的 servlet。

我试过用“参数”代替“requestBody”。我也尝试过使用参数字符串 (x=a?y=b)。我还验证了“ckULK”确实包含有效值。

有任何想法吗？

```
new Ajax.Request(sURL,
{
    method: 'POST'
    , contentType: "text/x-json"
    , requestBody: {ulk:ckULK}
    , onFailure:
        function(transport)
        {
            vJSONResp = transport.responseText;
            var JSON = eval( "(" + vJSONResp + ")" );
            updateStatus(JSON.code + ": " + JSON.message);
        } // End onFailure
    , onSuccess: 
        function(transport) 
        {
            if (200 == transport.status)
            {
                vJSONResp = transport.responseText;
            }
            else
            {
                log.value += "\n" + transport.status;
            }
         } // End onSuccess
}); // End Ajax.request 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-19T05:53:42.100

These are the kind of situations where Firebug and Firefox are really helpful. I suggest you install Firebug if you don't have it and check the request that is being sent.

You also definitely need to stick to `parameters` instead of `requestBody`.

This:

```
new Ajax.Request(sURL,
{
    method: 'POST',
    parameters: 'hello=world&test=yes',
    onFailure: function(transport) {
        vJSONResp = transport.responseText;
        var JSON = eval( "(" + vJSONResp + ")" );
        updateStatus(JSON.code + ": " + JSON.message);
    },
    onSuccess: function(transport) {
        if (200 == transport.status) {
            vJSONResp = transport.responseText;
        } else {
            log.value += "\n" + transport.status;
        }
     }
}); 
```

Should definitely work.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T07:42:31.697

Simply pass the data as **`parameters`** to the Ajax Request constructor:

```
new Ajax.Request(url, {
  method: 'POST', 
  parameters: {
    hello: "world", test: "test"
  },
  onSuccess: function(transport){
    var data = transport.responseText.evalJSON();
  }
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-12T08:21:36.033

When I hit this problem the solution was to remove `contentType` from `Ajax.Request` options.

In [answer](https://stackoverflow.com/a/216074/1483) by [Paolo Bergantino](https://stackoverflow.com/users/16417/paolo-bergantino) `contentType` is not defined in `Ajax.Request` options.

From unknown reasons params defined in `parameters` wasn't sent (FF didn't show them and my server saw empty POST body).

One of my coworkers suggested to use `postBody` instead of `parameters` but I didn't try it.

# iphone - UIView 使用 CGAffineTransformMakeScale 缩放到 0

> ID：216076
> 
> 赞同：10
> 
> 时间：2008-10-19T05:54:23.377
> 
> 标签：iphone, objective-c, cocoa-touch

是否可以使用 CGAffineTransformMakeScale 将 UIView 缩小到 0（宽度和高度为 0）？

view.transform = CGAffineTransformMakeScale(0.0f, 0.0f);

为什么这会抛出 " `<Error>: CGAffineTransformInvert: singular matrix.`" 的错误？

*更新：还有另一种将 UIView 缩小到 0 的方法*

```
[UIView beginAnimations:nil context:nil]; 
[UIView setAnimationDuration:0.3]; 
view.frame = CGRectMake(view.center.x, view.center.y, 0, 0);

[UIView commitAnimations]; 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-19T12:59:49.680

很多时候底层框架需要反转你的变换矩阵。矩阵的逆矩阵是某个矩阵 M'，这样矩阵 M 和逆矩阵 M' 的乘积就是识别矩阵 1。

1 = M * M'

零矩阵没有逆矩阵，因此出现错误消息。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-19T11:55:07.753

我不确定是否可以这样做；您将开始遇到除零问题。如果您尝试这样做，您将创建一个如下所示的转换：

```
 `0  0  0
   0  0  0
   0  0  1` 
```

`当应用于任何其他变换时，将产生上述变换。`

 `为什么不直接隐藏视图（如果您想将其缩放到看不见的地方）或将缩放因子设置为 0.001（如果您想将其缩小）？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-23T21:32:43.200

你可以试试：

```
CGAffineTransform transform = myView.transform;
myView.transform = CGAffineTransformScale(transform. 0.0f, 0.0f); 
```

或内联整个事情。

# c# - C#访问内存映射文件

> ID：216083
> 
> 赞同：4
> 
> 时间：2008-10-19T05:58:52.200
> 
> 标签：c#, memory

寻找代码示例以访问 C# 中的内存映射文件

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-11T03:26:15.600

看起来 C# 4.0 将在库中支持 MemoryMappedFile

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-19T06:12:03.670

您可以查看[这篇 CodeProject 文章，该文章显示了一个使用](http://www.codeproject.com/KB/recipes/MemoryMappedGenericArray.aspx)[Winterdom 的 FileMap 库](http://www.winterdom.com/dev/dotnet/index.html)实现 MMF 上的简单数组- 基本上是用于内存映射文件的 Win32 API 的包装器。

警告购买者：1）我没有使用过 FileMap，所以我不能保证它；2) 如果许可条款与您有关，则 FileMap 受 LGPL 保护。

您还可以在[http://pinvoke.net](http://pinvoke.net)上搜索相应 Win32 API 的 P/Invoke 定义并推出您自己的实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-27T15:21:54.233

[http://1code.codeplex.com/wikipage?title=IRPC](http://1code.codeplex.com/wikipage?title=IRPC)

搜索

```
CSFileMappingClient
CSFileMappingServer 
```

# apache - 重新加载 FastCGI 应用程序

> ID：216092
> 
> 赞同：2
> 
> 时间：2008-10-19T06:06:08.283
> 
> 标签：apache, fastcgi, wt

我正在使用 FastCGI 将 C++ 二进制文件（使用[Wt](http://www.webtoolkit.eu/wt)框架编写）公开为 Web 应用程序。但是，在我修改了应用程序并重新编译后，为了让新会话看到更改（活动会话继续使用旧版本直到过期），我必须重新加载 Apache。

是否有可能以不需要重新加载 Apache 的方式配置系统，以使新编译的 FastCGI 应用程序可供用户使用？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T06:20:38.847

引用自常见问题解答：

> 由 mod_fastcgi 启动的应用程序可以使用 FastCgiServer 和/或 FastCgiConfig 的 autoUpdate 参数（请参阅 mod_fastcgi 文档）。这种方法的一个缺点是，mod_fastcgi 将检查每个请求以获取应用程序的新版本。更智能的实现可能会让应用程序本身定期检查（通过处理的请求数或通过的时间）并在存在更新版本的自身（或其库之一）时重新加载。如果一个进程管理器，例如嵌入在 mod_fastcgi 中的那个，负责该进程，简单的退出将导致创建一个新实例。

因此，您要么在配置中启用自动更新，要么您的程序通过您最喜欢的某种机制自行重新加载。

# python - 如何连贯地组织 PyGTK 桌面应用程序的模块？

> ID：216093
> 
> 赞同：8
> 
> 时间：2008-10-19T06:07:28.313
> 
> 标签：python, gtk, module, pygtk, organization

我正在使用 PyGTK 开发一个桌面应用程序，并且似乎遇到了我的文件组织的一些限制。到目前为止，我已经以这种方式构建了我的项目：

*   application.py - 保存主要的应用程序类（大多数功能例程）
*   gui.py - 拥有一个松耦合的 GTK gui 实现。处理信号回调等。
*   command.py - 包含不依赖于应用程序类中数据的命令行自动化功能
*   state.py - 保存状态数据持久性类

到目前为止，这已经很好地发挥了作用，但此时 application.py 开始变得相当长。我查看了许多其他 PyGTK 应用程序，它们似乎有类似的结构问题。在某个时刻，主模块开始变得很长，并且没有明显的方法可以在不牺牲清晰度和面向对象的情况下将代码分成更窄的模块。

我考虑过让 GUI 成为主要模块，并为工具栏例程、菜单例程等设置单独的模块，但那时我相信我将失去 OOP 的大部分好处并最终得到一个一切都引用一切的场景.

我应该只处理一个很长的中央模块，还是有更好的方式来构建项目，这样我就不必过多地依赖类浏览器？

**编辑我**

好的，关于所有 MVC 的东西都采取了这一点。我的代码中确实有一个粗略的 MVC 近似值，但不可否认，通过进一步分离模型和控制器，我可能会获得一些进展。但是，我正在阅读 python-gtkmvc 的文档（顺便说一句，这是一个很棒的发现，感谢您参考它），我的印象是它并不能解决我的问题，而只是形式化它。我的应用程序是一个单一的空地文件，通常是一个窗口。因此，无论我多么严格地定义模块的 MVC 角色，我仍然会让一个控制器模块完成大部分工作，这几乎就是我现在所拥有的。诚然，我对正确的 MVC 实现有点模糊，我会继续研究，但事实并非如此

我应该为窗口的不同部分（工具栏、菜单等）考虑单独的控制器/视图对吗？也许这就是我在这里所缺少的。似乎这就是 S. Lott 在他的第二个要点中所指的内容。

感谢您到目前为止的回复。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-19T07:39:33.587

In the project [Wader](http://wader-project.org) we use [python gtkmvc](http://pygtkmvc.sourceforge.net/), that makes much easier to apply the MVC patterns when using pygtk and glade, you can see the file organization of our project in the [svn repository](http://trac.wader-project.org/browser/trunk/wader):

```
wader/
  cli/
  common/
  contrib/
  gtk/
    controllers/
    models/
    views/
  test/
  utils/ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T06:15:00.607

这可能与 PyGTK 无关，而是一般的代码组织问题。您可能会从应用一些 MVC（模型-视图-控制器）设计模式中受益。例如，请参阅[设计模式](http://en.wikipedia.org/wiki/Design_Patterns)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T12:53:42.110

"holds the primary application class (most functional routines)"

As in singular -- one class?

I'm not surprised that the **One Class Does Everything** design isn't working. It might not be what I'd call object-oriented. It doesn't sound like it follows the typical MVC design pattern if your functionality is piling up in a single class.

What's in this massive class? I suggest that you can probably refactor this into pieces. You have two candidate dimensions for refactoring your application class -- if, indeed, I've guessed right that you've put everything into a single class.

1.  Before doing anything else, refactor into components that parallel the Real World Entities. It's not clear what's in your "state.py" -- wether this is a proper model of real-world entities, or just mappings between persistent storage and some murky data structure in the application. Most likely you'd move processing out of your application and into your model (possibly state.py, possibly a new module that is a proper model.)

    Break your model into pieces. It will help organize the control and view elements. The most common MVC mistake is to put too much in control and nothing in the model.

2.  Later, once your model is doing most of the work, you can look at refactor into components that parallel the GUI presentation. Various top-level frames, for example, should probably have separate cotrol objects. It's not clear what's in "GUI.py" -- this might be a proper view. What appears to be missing is a Control component.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-31T01:31:40.560

Sorry to answer so late. [Kiwi](http://async.com.br/projects/kiwi) seems to me a far better solution than gtkmvc. It is my first dependency for any pygtk project.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T06:41:46.667

Python 2.6 支持[显式相对导入](http://docs.python.org/whatsnew/2.6.html#pep-366-explicit-relative-imports-from-a-main-module)，这使得使用包比以前的版本更容易。我建议您考虑将您的应用程序分解为一个包内的较小模块。您可以像这样组织您的应用程序：

```
myapp/
  application/
  gui/
  command/
  state/ 
```

Where each directory has its own `__init__.py`. You can have a look at any python app or even standard library modules for examples.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T20:15:32.567

So having not heard back regarding my edit to the original question, I have done some more research and the conclusion I seem to be coming to is that *yes*, I should break the interface out into several views, each with its own controller. Python-gtkmvc provides the ability to this by providing a `glade_top_widget_name` parameter to the View constructor. This all seems to make a good deal of sense although it is going to require a large refactoring of my existing codebase which I may or may not be willing to undertake in the near-term (I know, I know, I *should*.) Moreover, I'm left to wonder whether should just have a single Model object (my application is fairly simple--no more than twenty-five state vars) or if I should break it out into multiple models and have to deal with controllers observing multiple models and chaining notifications across them. (Again, I know I really *should* do the latter.) If anyone has any further insight, I still don't really feel like I've gotten an answer to the original question, although I have a direction to head in now.

(Moreover it seems like their ought to be other architectural choices at hand, given that up until now I had not seen a single Python application coded in the MVC style, but then again many Python applications tend to have the exact problem I've described above.)

# php - 一个对象应该实现迭代器还是包含另一个实现迭代器的对象

> ID：216094
> 
> 赞同：5
> 
> 时间：2008-10-19T06:08:26.440
> 
> 标签：php, design-patterns, iterator

我试图了解 SPL 迭代器，我想出了 2 种方法来处理它。我认为第一个版本不那么复杂，但第二个版本有作曲的感觉（我认为）。

我没有看到哪一个比另一个更可取？还是我只是让这件事复杂化了？

以下是我的想法：

该对象实现了一个迭代器：

```
class BoxOfChocolates implements Iterator {

  private $id
  private $name; // e.g. Valentine's Heart Box
  private $maker; // e.g. Hersheys
  private $items; // array

  public function getChocolates() {
    $query = ...
    foreach($rows as $row) {
      $this->_items[] = new Chocolate() ...
    }
  }

  // ... necessary iterator implementation stuff

} 
```

该对象包含一个可迭代的对象：

```
class BoxOfChocolates {

  private $id;
  private $name;
  private $maker;
  private $items; // chocolates object

  public function getChocolates() {
    $this->items = new Chocolates();
    $this->items->getChocolates();
  }

}

class Chocolates implements Iterator {

  private $items;

  public function getChocolates() {
    $query = ...
    foreach($rows as $row) {
      $this->_items[] = new Chocolate() ...
    }
  }

  // ... necessary iterator implementation stuff

} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-19T22:43:43.577

bbxbby，最好的解决方案通常是最简单的。您绝对不会使创建单独的迭代器对象的事情变得过于复杂。事实上，PHP 支持并鼓励这种聚合提供`IteratorAggregate`接口。实现的对象`IteratorAggregate`必须包含`getIterator()`方法返回`Iterator`。这确实是您的`getChocolated()`方法所做的。好处`IteratorAggregate`是您可以将它的对象直接传递给`foreach`循环。使用它时，您的代码可能看起来像这样：

```
class BoxOfChocolates implements IteratorAggregate

    private $chocolates = array();

    public function getIterator() {
        return new ArrayIterator(new ArrayObject($this->chocolates)));
    }

} 
```

然后，在代码的某处：

```
$box = new BoxOfChocolates();
foreach ($box as $chocolate) { ... } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T06:15:59.340

这取决于实际情况。t0 巧克力盒是否包含多个系列？如果是这样，您需要让集合成为成员。

这样想吧。一盒巧克力是一个集合（即PersonList）还是拥有一个集合的东西（即汽车可能拥有它的最后一个所有者的集合）。

我认为这属于第一组

:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-19T06:23:55.580

我也建议第一组，假设您的巧克力隐喻对实际课程非常准确。

一盒巧克力确实是您收集的巧克力，因此想要迭代该盒子中的巧克力是有意义的。添加一个单独的巧克力列表并没有真正增加任何价值，而且似乎只是增加了一个不必要的层。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T11:32:28.890

好吧，我不懂 PHP，所以我不能正确回答这个问题，但我会尝试将它与我知道的领域联系起来。

在 C# 中，有两个接口：IEnumerable 和 IEnumerator。在您的示例中，BoxOfChocolates 将是 Enumerable，Chocolates 将是 Enumerator。

Enumerables 只有一个返回 Enumerator 的方法。枚举器有一个当前项目的概念，以及移动到下一个项目的方法。在大多数情况下，Enumerator 类不是“可见”的。例如，在“foreach(Chocolate item in boxOfChoclates)”这一行中，boxOfChocolates 是一个 Enumerable；Enumerator 对象被 foreach 完全隐藏。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T11:58:29.507

很简单，容器就是实现迭代器的地方。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T12:11:50.637

我认为您应该将集合与迭代器分开。我同意@James Curran 的观点，即集合通常有迭代器——事实上，它们可以有几个。例如，您可能想要一个跳过带有坚果的糖果的迭代器（尽管典型的情况是想要一个颠倒顺序的迭代器）。在这种情况下， next() 方法的含义会发生变化。为了解决这个问题，在包含它们自己的迭代语义的单独类中实现迭代器。在集合中提供方法以获得正确排序的迭代器。这实际上是一个关注点分离的问题。集合不关心用户如何迭代它，这是迭代器的关注点。

# c# - 为 nunit 单元测试搜索文件依赖项

> ID：216100
> 
> 赞同：1
> 
> 时间：2008-10-19T06:16:06.330
> 
> 标签：c#, unit-testing, nunit

我有一个 winforms C# 类，它在内部查找文件.. 为了帮助进行单元测试，我将其更改为从外部传入文件，例如：

字符串文件 = Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location + "TestXML.xml");

Foo = new Foo(文件);

问题是代码可以正常工作，但是在 Nunit 中运行时会出现错误提示“Cant find directory C:\doc & settings\ . . .. testxml.xml

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T06:42:02.923

我会设置一个断点，然后使用即时窗口找出传递给 GetDirectoryName 的内容。这可能不是你想要的。

# linux - 在 RHEL4 中安装 GCC 3.4.6

> ID：216102
> 
> 赞同：2
> 
> 时间：2008-10-19T06:19:42.033
> 
> 标签：linux, gcc, installation, redhat, rhel

我在命令行中执行以下操作：

1) wget [ftp://mirrors.kernel.org/gnu/gcc/gcc-3.4.6/gcc-3.4.6.tar.bz2](ftp://mirrors.kernel.org/gnu/gcc/gcc-3.4.6/gcc-3.4.6.tar.bz2)

2) 焦油 -jxf gcc-3.4.6.tar.bz2

3) cd gcc-3.4.6

4) cd libstdc++-v3

5) ./配置

我收到以下错误：

配置：错误：在 ./../.. 中找不到 install-sh 或 install.sh

在 gcc-3.4.6 目录中实际上有一个“install-sh”文件，但这是当前目录的一个，而不是两个。

配置脚本应该在“./..”中查找“./../..”中的 install-sh ？

怎么了？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T07:13:00.427

1.  wget [ftp://mirrors.kernel.org/gnu/gcc/gcc-3.4.6/gcc-3.4.6.tar.bz2](ftp://mirrors.kernel.org/gnu/gcc/gcc-3.4.6/gcc-3.4.6.tar.bz2)
2.  焦油 -jxf gcc-3.4.6.tar.bz2
3.  cd gcc-3.4.6
4.  。/配置
5.  制作
6.  进行安装

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T07:16:29.250

建议：考虑[将](http://www.gnu.org/software/stow/)自定义安装保存在 /usr/local 中以某种合理的顺序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-19T07:06:30.317

为什么要 cd:ing 进入 libstdc++-v3？我认为正确的方法是从您运行配置的目录中运行“make”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-26T23:44:06.047

以下是我如何构建一个没有配置脚本的不同包：

```
config/autorun.sh
./configure <options>
make
make install 
```

# wcf - 无法使用以下搜索条件找到 X.509 证书：

> ID：216109
> 
> 赞同：3
> 
> 时间：2008-10-19T06:27:52.623
> 
> 标签：wcf, certificate, x509, x509securitytokenmanager

我收到这条消息：

> 无法使用以下搜索条件找到 X.509 证书：StoreName 'My'、StoreLocation 'LocalMachine'、FindType 'FindBySubjectDistinguishedName'、FindValue 'CN=HighBall'。

我的 web.config 设置如下所示；

身份验证设置为...

```
<authentication mode="Windows" /> 
```

为 wsHttpBinging 设置绑定

我的服务行为是这样设置的......

```
<behavior name="HighBall.Services.ServiceVerificationBehavior">
  <serviceAuthorization principalPermissionMode="UseAspNetRoles"
        roleProviderName="HighBallRoleProvider" />
  <serviceMetadata httpGetEnabled="true" />
  <serviceDebug includeExceptionDetailInFaults="true" />
  <serviceCredentials>
    <serviceCertificate findValue="CN=HighBall" />
    <userNameAuthentication userNamePasswordValidationMode="MembershipProvider"
        membershipProviderName="HighBallMembershipProvider" />
  </serviceCredentials>
</behavior> 
```

我试图找出一种方法来验证证书的存储内容、方式和位置，但不确定如何执行此操作。如果有人对此错误消息有任何想法，我将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-19T09:39:01.677

请记住，ASP.NET 作为不同的用户运行。可能需要为其分配对证书的访问权限。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T07:44:24.747

检查有关您询问的工具的另一篇文章。验证您的“我的”存储并检查 CN="HighBall"。我猜你的 CN 不只是“HighBall”，可能它有一个顶级域。我认为查找证书序列号更容易，我认为它比它的规范名称和容易出错的速度更快。

问候，

胜利者

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-13T08:25:26.347

尝试使用证书管理器（带有 MMC）查看已安装的证书。XP 使用说明：[管理计算机证书](http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/sag_cmprocsfind.mspx?mfr=true)，可能与 Vista 和 7 类似。

I was having problems with service unable to find the x509 certificate, but by using the Certificate Manager I found out that "Install PFX" command from Windows Explorer had not installed the certificate at all! This was fixed by importing the certificate from Certificate Manager.

# wcf - 查看 X.509 证书的工具？

> ID：216110
> 
> 赞同：9
> 
> 时间：2008-10-19T06:29:21.247
> 
> 标签：wcf, certificate, x509

有谁知道查看商店名称、商店位置或 X.509 证书值的任何好工具？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-19T11:44:38.460

[Portecle](http://portecle.sourceforge.net/)是跨平台的（用 Java 编写），无需安装，不仅可以读取证书和密钥库，还可以创建、修改、导入/导出等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-19T07:38:40.407

我假设您使用的是 Windows。所以这里是[http://msdn.microsoft.com/en-us/library/aa529278.aspx](http://msdn.microsoft.com/en-us/library/aa529278.aspx)。这是一个很好的工具，但是通过 API 来做这件事并不难，学习 API 是一个很好的练习。

问候，

胜利者

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-01-12T18:41:12.210

Openssl 做得更好并且有更多细节：

openssl x509 -in certificate.crt -text -noout

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T02:37:25.617

此外，不要忘记您可以使用证书 MMC 控制台直接从窗口查看/管理大量任务和信息。

无论出于何种原因，默认情况下它永远不会出现在任何菜单中，但您可以启动 MMC.exe，然后添加证书的管理单元。这对于管理部署到您帐户的证书存储或机器证书存储的证书非常有用（如果您有管理员权限）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-25T16:01:55.360

有关如何使用 Microsoft 管理控制台 (MMC) 证书管理单元管理 X.509 证书的说明，请参阅[如何：使用 MSDN 上的 X.509 证书管理工具。](http://msdn.microsoft.com/en-us/library/ms819944.aspx)

# python - 如何在 Python 中使用递归来反转列表？

> ID：216119
> 
> 赞同：6
> 
> 时间：2008-10-19T06:56:01.867
> 
> 标签：python, list, recursion

我想要一个函数，它将返回它给出的列表的反向 - 使用递归。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-19T07:20:02.970

将列表的第一个元素附加到反向子列表：

```
mylist = [1, 2, 3, 4, 5]
backwards = lambda l: (backwards (l[1:]) + l[:1] if l else []) 
print backwards (mylist) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-19T08:18:43.213

更明确一点：

```
def rev(l):
    if len(l) == 0: return []
    return [l[-1]] + rev(l[:-1]) 
```

* * *

这变成：

```
def rev(l):
    if not l: return []
    return [l[-1]] + rev(l[:-1]) 
```

变成：

```
def rev(l):
    return [l[-1]] + rev(l[:-1]) if l else [] 
```

这与另一个答案相同。

* * *

尾递归/CPS 样式（python 无论如何都不会优化）：

```
def rev(l, k):
    if len(l) == 0: return k([])
    def b(res):
        return k([l[-1]] + res)
    return rev(l[:-1],b)

>>> rev([1, 2, 3, 4, 5], lambda x: x)
[5, 4, 3, 2, 1] 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-19T08:50:19.483

我知道这不是一个有用的答案（尽管这个问题已经得到了回答），但是在任何真实的代码中，请不要这样做。Python 无法优化尾调用，函数调用速度慢并且递归深度固定，因此至少有 3 个原因可以改为迭代。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-19T07:14:33.060

*诀窍是在递归后*加入：

```
向后定义（l）：
  如果不是我：
    返回
  x, y = l[0], l[1:]
  向后返回(y) + [x]

```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-07-18T10:46:29.090

使用分而治之的策略。D&C 算法是递归算法。要使用 D&C 解决这个问题，有两个步骤：

1.  找出基本情况。这应该是最简单的情况。
2.  划分或减少您的问题，直到它成为基本情况。

第 1 步：找出基本情况。你能得到的最简单的清单是什么？如果你得到一个包含 0 或 1 个元素的列表，这很容易总结。

```
if len(l) == 0:  #base case
    return [] 
```

第 2 步：每次递归调用都需要靠近一个空列表

```
recursive(l)    #recursion case 
```

例如

```
l = [1,2,4,6]
def recursive(l):
    if len(l) == 0:
        return []  # base case
    else:
        return [l.pop()] + recursive(l)  # recusrive case

print recursive(l)

>[6,4,2,1] 
```

资料来源：Grokking 算法

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-20T00:11:43.290

这个就地反转。（当然迭代版本会更好，但它必须是递归的，不是吗？）

```
def reverse(l, first=0, last=-1):
    if first >= len(l)/2: return
    l[first], l[last] = l[last], l[first]
    reverse(l, first+1, last-1)

mylist = [1,2,3,4,5]
print mylist
reverse(mylist)
print mylist 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-01-30T04:21:54.567

```
def revList(alist):
    if len(alist) == 1:       
        return alist #base case
    else:
        return revList(alist[1:]) + [alist[0]]

print revList([1,2,3,4])
#prints [4,3,2,1] 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-10-30T06:35:15.400

# 用于反转列表的递归函数。

```
def reverseList(lst):
    #your code here
    if not lst:
        return []
    return [lst[-1]] + reverseList(lst[:-1])

print(reverseList([1, 2, 3, 4, 5])) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-01-20T22:36:52.027

```
def reverse(q):
    if len(q) != 0:
        temp = q.pop(0)
        reverse(q)
        q.append(temp)
    return q 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-03-07T09:56:20.617

看起来更简单：

```
 def reverse (n):
        if not n: return []
        return [n.pop()]+reverse(n) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-19T07:02:44.113

取第一个元素，递归地反转列表的其余部分，并将第一个元素附加到列表的末尾。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-02-28T06:09:27.143

```
def reverseList(listName,newList = None):
if newList == None:
    newList = []
if len(listName)>0:
    newList.append((listName.pop()))
    return reverseList(listName, newList)
else:
    return newList 
```

打印反向列表（[1,2,3,4]）[4,3,2,1]

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-10-11T13:05:51.017

使用可变默认参数和递归：

```
def hello(x,d=[]):
    d.append(x[-1])
    if len(x)<=1:
        s="".join(d)
        print(s)

    else:
        return hello(x[:-1])

hello("word") 
```

# 附加信息

```
x[-1]    # last item in the array
x[-2:]   # last two items in the array
x[:-2]   # everything except the last two items 
```

递归部分是`hello(x[:-1])`它再次调用 hello 函数的地方`x[:-1]`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-10-24T00:42:15.810

这也将反转嵌套列表！

```
A = [1, 2, [31, 32], 4, [51, [521, [12, 25, [4, 78, 45], 456, [444, 111]],522], 53], 6]

def reverseList(L):

    # Empty list
    if len(L) == 0:
        return

    # List with one element
    if len(L) == 1:

        # Check if that's a list
        if isinstance(L[0], list):
            return [reverseList(L[0])]
        else:
            return L

    # List has more elements
    else:
        # Get the reversed version of first list as well as the first element
        return reverseList(L[1:]) + reverseList(L[:1])

print A
print reverseList(A) 
```

[Padmal 的博客](http://padmalblog.blogspot.com/2016/10/algorithm-assignments.html#more)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-13T17:56:04.347

`rev`您可以通过一次交换第一个和最后一个元素并在列表中间递归调用来将递归深度减少一半：

```
lks=[2,7,3,1,9,6,5]
def rev(lks):
    if len(lks)<2:
        return lks
    return [lks[-1]]+rev(lks[1:-1])+[lks[0]]
print(rev(lks)) 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-06-20T14:28:59.550

您正在寻找的答案在函数内部。剩下的只是看看（或者如果你想比较）不同算法所花费的时间。

```
import time
import sys

sys.setrecursionlimit(10**6)

def reverse(ls1):
    if len(ls1) <= 1:
        return ls1
    else:
        ls1[0], ls1[-1] = ls1[-1], ls1[0]
        return [ls1[0]] + reverse(ls1[1:-1]) + [ls1[-1]]

ls = [*range(2000)]
start_time = time.time()
print(reverse(ls))
stop_time = time.time()
print(f"Total time taken: {(stop_time - start_time) * 1000} msec.") 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2016-10-11T13:16:19.467

为什么不：

```
a = [1,2,3,4,5]
a = [a[i] for i in xrange(len(a)-1, -1, -1)] # now a is reversed! 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2020-11-22T17:36:05.050

如果它是一个数字列表，最简单的反转方法就是。这也适用于字符串，但不推荐。

```
l1=[1,2,3,4]
l1 = np.array(l1)
assert l1[::-1]==[4,3,2,1] 
```

如果您不想将其保留为 numpy 数组，则可以将其传递到列表中

```
l1 = [*l1] 
```

再次，我不建议将它用于字符串列表，但如果你真的想的话，你可以这样做。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2021-03-20T18:09:26.583

```
def reverse_array(arr, index):
    if index == len(arr):
        return

    if type(arr[index]) == type([]):
        reverse_array(arr[index], 0)

    current = arr[index]
    reverse_array(arr, index + 1)
    arr[len(arr) - 1 - index] = current
    return arr

if __name__ == '__main__':
    print(reverse_array([[4, 5, 6, [4, 4, [5, 6, 7], 8], 8, 7]], 0)) 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2021-06-01T18:28:28.027

```
def disp_array_reverse(inp, idx=0):
    if idx >= len(inp):
        return
    disp_array_reverse(inp, idx+1)
    print(inp[idx]) 
```

# c++ - C++浅拷贝问题

> ID：216124
> 
> 赞同：5
> 
> 时间：2008-10-19T07:05:43.250
> 
> 标签：c++, memory-management, constructor

假设我有一个带有 int 指针成员变量“i”的结构“s”。我在 s 的默认构造函数中为 i 在堆上分配内存。稍后在代码的其他部分中，我将 s 的实例按值传递给某个函数。我在这里做浅拷贝吗？假设我没有为 s 实现任何复制构造函数或赋值运算符或任何东西......只是默认构造函数。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-19T07:51:24.170

跟进@[don.neufeld.myopenid.com] 所说的话，它不仅是一个浅拷贝，而且（随你选择）内存泄漏或悬空指针。

```
// memory leak (note that the pointer is never deleted)
class A
{
  B *_b;
  public:
  A()
  : _b(new B)
  {
  }
};

// dangling ptr (who deletes the instance?)
class A
{
  B *_b;
  public:
  A()
  ... (same as above)

  ~A()
  {
    delete _b;
  }
}; 
```

为了解决这个问题，有几种方法。

**始终在使用原始内存指针的类中实现复制构造函数和 operator=。**

```
class A
{
  B *_b;
  public:
  A()
  ... (same as above)

  ~A()
  ...

  A(const A &rhs)
  : _b(new B(rhs._b))
  {
  }

  A &operator=(const A &rhs)
  {
    B *b=new B(rhs._b);
    delete _b;
    _b=b;
    return *this;
}; 
```

不用说，这是一个主要的痛苦，并且有很多微妙之处要纠正。我什至不完全确定我是在这里做的，而且我已经做过几次了。不要忘记您必须复制所有成员 - 如果您稍后添加一些新成员，请不要忘记也添加它们！

**Make the copy constructor and operator= private in your class.** This is the "lock the door" solution. It is simple and effective, but sometimes over-protective.

```
class A : public boost::noncopyable
{
  ...
}; 
```

**Never use raw pointers.** This is simple and effective. There are lots of options here:

*   Use string classes instead of raw char pointers
*   Use std::auto_ptr, boost::shared_ptr, boost::scoped_ptr etc

Example:

```
// uses shared_ptr - note that you don't need a copy constructor or op= - 
// shared_ptr uses reference counting so the _b instance is shared and only
// deleted when the last reference is gone - admire the simplicity!
// it is almost exactly the same as the "memory leak" version, but there is no leak
class A
{
  boost::shared_ptr<B> _b;
  public:
  A()
  : _b(new B)
  {
  }
}; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-19T07:10:45.470

是的，这是一个浅拷贝。您现在有两个 s 副本（一个在调用者中，一个在堆栈中作为参数），每个副本都包含指向同一内存块的指针。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T07:48:03.133

您将拥有该`s`结构的两个副本，每个副本都有自己的`i`指针，但两个`i`指针将具有指向内存中相同地址的相同值 - 所以是的，这将是一个浅拷贝。

# sql-server - Sql Server 备份到 UNC

> ID：216130
> 
> 赞同：13
> 
> 时间：2008-10-19T07:11:58.917
> 
> 标签：sql-server, backup

我已经在我的 SQL Server 2005 服务器上创建了一个维护计划。备份应写入另一台服务器。我为此使用了 UNC 路径。运行 SQL 代理作业的用户对另一台服务器具有完全访问权限。它在两台服务器上都是管理员。

问题是该语句失败（当然具有正确的服务器名称）：

> 执行 master.dbo.xp_create_subdir N'\\servername\c$\SqlServerBackup\Test'

我得到的错误是：消息 22048，级别 16，状态 1，行 0 xp_create_subdir() 返回错误 123，“文件名、目录名或卷标语法不正确。”

有谁知道可能是什么问题？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-15T16:00:23.577

在我自己遇到这个问题之后，上述解决方案都不够清楚，我想我会发布一个更清晰的回复。该错误实际上与语法无关 - 它完全与权限有关。这里重要的是，尝试登录以创建目录的是 SQL Server 服务帐户，而不是 SQL Server 代理帐户。您可以检查目标服务器上的事件查看器并查看安全日志以查看来自另一台计算机上的 SQL Server 帐户的失败登录（我的以本地管理员身份运行）。

要解决此问题，请将您的 SQL Server 服务帐户设置为允许写入远程共享的域用户。我本来希望 SQL Server 代理能够使用自己的凭据来执行这些备份操作，但显然不是！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-17T04:02:03.600

SQL 代理实际上并不运行备份，它能够在执行备份的 SQL Server 中执行命令。因此，SQL Server 服务帐户是需要 UNC 共享权限的帐户。

但是，我认为 xp_create_subdir 过程存在实际问题。我将停止使用维护计划，因为我每隔一段时间就会遇到同样的错误。没有权限发生变化，它“通常”有效，但“通常”并没有削减它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-14T03:29:14.110

我在维护计划历史记录中看到了这个错误。

> 操作系统错误3（系统找不到指定的路径。）。BACKUP DATABASE 异常终止。”。可能的失败原因：查询有问题，“ResultSet”属性设置不正确，参数设置不正确，或连接未正确建立。

我尝试运行第一个备份步骤，它在共享上创建目录。我收到拒绝访问错误。

最后，我授予 SQL 代理运行和维护计划成功运行的服务帐户的完全权限。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-24T01:01:02.040

如果您将 SQL Server 和/或 SQL Server 代理服务作为“LocalSystem”运行，但拒绝将 SQL Server 和 SQL Server 代理帐户更改为域帐户，请尝试以下操作：

1.  如果您使用 SQL Server 代理代理帐户/凭据来执行部分任务并使用 SQL 代理进行备份，则在共享和 NTFS 权限下的 UNC 备份目标上，授予完全/修改权限（分别），因为它们确实在在建立连接的过程中或至少在我尝试过的 SQL 备份作业中（至少根据安全日志）有一点。不幸的是，要么没有办法，要么我还没有找到一种方法来使用代理帐户来执行某些 SQL Server 服务任务，而您可以使用纯 SQL 代理任务来完成（如 User55852 和 ZaDDaZ 之前的帖子中所述）。

2.  在共享和 NTFS 权限下的 UNC 备份目标服务器上，将完整/修改权限（分别）授予 SQL 服务器（源服务器）的**计算机**帐户。

* * *

这适用于 SQL 服务作为“LocalSystem”运行但需要访问另一台服务器以删除备份的情况。

*当然，最佳实践表明，对于每个 SQL 服务，它们应该拥有自己的域帐户，并且具有最低权限，而不是添加服务器的计算机帐户，这会暴露比应允许的更多访问共享 - 基本上任何正在执行的操作作为计算机帐户或“LocalSystem”。*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T08:32:26.600

检查运行 SqlAgent 的帐户。通常它 system\NetworkService 蚂蚁在其他计算机上没有访问权限。

给 UNC 路径上的每个人临时写入权限，或者在控制面板/服务中更改用于 SqlAgent 的帐户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T07:17:35.270

是不是服务器名前少了一个双反斜杠？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T02:52:06.337

我已经多次备份到 UNC 的数据。确保这不是与运行 sql server 和 sql agent 的帐户有关的权限问题。我不会像那样备份到隐藏的管理员共享，也许是导致问题的 $。创建一个共享和备份。\server\share**不是**\server\c$\folder

# php - 用于 PHP 的 SQL Builder，是否支持 JOIN？

> ID：216138
> 
> 赞同：4
> 
> 时间：2008-10-19T07:36:26.043
> 
> 标签：php, sql, join, builder, sqlbuilder

你们中是否有人知道一个可以帮助您构建/操作 SQL 查询、支持 JOIN 的库？

如果你有一些东西可以返回一个对象，它有一些查询集，并且仍然能够对其应用 JOIN、子查询等，它会提供很大的灵活性。

我四处搜索，只找到了 SQL Builder，它看起来很基础，不支持连接。这将是一个真正使它有用的主要功能。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-19T07:46:16.960

也许您可以尝试[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)，例如[Propel](http://propel.phpdb.org/trac/)或[Doctrine](http://www.doctrine-project.org/)，它们具有很好的编程查询语言，并且它们会返回代表数据库中行的对象数组...

例如，使用 Doctrine 你可以像这样进行连接：

```
$q = Doctrine_Query::create();
$q->from('User u')
->leftJoin('u.Group g')
->innerJoin('u.Phonenumber p WITH u.id > 3')
->leftJoin('u.Email e');

$users = $q->execute(); 
```

和推进：

```
$c = new Criteria(AuthorPeer::DATABASE_NAME);

$c->addJoin(AuthorPeer::ID, BookPeer::AUTHOR_ID, Criteria::INNER_JOIN);
$c->addJoin(BookPeer::PUBLISHER_ID, PublisherPeer::ID, Criteria::INNER_JOIN);
$c->add(PublisherPeer::NAME, 'Some Name');

$authors = AuthorPeer::doSelect($c); 
```

你可以用这两者做更多的事情......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T16:12:04.397

[Zend Framework](http://framework.zend.com/)的[Zend_Db](http://framework.zend.com/manual/en/zend.db.html)包中的[Zend_Db_Select](http://framework.zend.com/manual/en/zend.db.select.html)可以执行以下操作：

```
// Build this query:
//   SELECT p."product_id", p."product_name", l.*
//   FROM "products" AS p JOIN "line_items" AS l
//     ON p.product_id = l.product_id
$select = $db->select()
    ->from(array('p' => 'products'), array('product_id', 'product_name'))
    ->join(array('l' => 'line_items'), 'p.product_id = l.product_id'); 
```

（来自[示例 11.54。Zend](http://framework.zend.com/manual/en/zend.db.select.html#zend.db.select.building.join)框架手册中的 join() 方法示例）

如果你不喜欢运行一个成熟的 ORM 包，这可能是你要走的路。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-02-06T19:40:03.860

如果您已经在使用 PDO，FluentPDO 看起来不错：[https ://github.com/envms/fluentpdo](https://github.com/envms/fluentpdo)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T12:51:26.327

我强烈推荐 CakePHP。它会根据表之间的关联自动为您创建连接。

假设你正在写博客：

```
app/model/post.php:

class Post extends AppModel {
  var $hasMany = array('Comment');
}

app/controller/posts_controller.php:

function view($id) {
  $this->set('post', $this->Post->read(null, $id));
}

app/views/posts/view.ctp:

<h2><?php echo $post['Post']['title']?></h2>
<p><?php echo $post['Post']['body']; /* Might want Textile/Markdown here */ ?></p>
<h3>Comments</h3>
<?php foreach($post['Comment'] as $comment) { ?>
  <p><?php echo $comment['body']?></p>
  <p class="poster"><?php echo $comment['name']?></p>
<?php } ?> 
```

这就是您查看博客文章所需的全部内容，您的数据库模式已被读取和缓存。只要你保持它与约定一致，你就不必告诉蛋糕任何关于你的桌子是如何设置的。

```
posts:
id INT
body TEXT
created DATETIME

comments:
id INT
body TEXT
name VARCHAR
post_id INT 
```

它具有支持 MySQL、MSSQL、PostgreSQL、SQLite、Oracle 等的适配器。您还可以将 web 服务包装为模型，甚至让它在数据库中的数据和远程数据之间进行连接！这是非常聪明的东西。

希望这可以帮助 ：）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-10T14:12:22.150

来自 PastaPHP 的基于超快 SQLObject 的 IteratorQuery
迭代资源

```
 foreach(_from('users u')
   ->columns("up.email_address AS EmailAddress", "u.user_name AS u.UserName")
   ->left('userprofiles up', _eq('u.id', _var('up.id')))
   ->where(_and()->add(_eq('u.is_active',1)))
   ->limit(0,10)
   ->order("UserName")
   ->execute("myConnection") as $user){

   echo sprintf(
          '<a href="mailto:%s">%s</a><br/>', 
          $user->EmailAdress, 
          $user->UserName
   );
 } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T11:41:09.170

我建议使用 PHP 框架，例如 Symfony，它默认使用 Propel，如果您愿意，可以使用 Doctrine。

CakePHP 也使用 ORM，但我不知道是哪一个。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-10-25T17:59:15.607

这似乎是一个具有复杂连接支持的 SQL 构建器：http: [//laravel.com/docs/queries](http://laravel.com/docs/queries)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-08T16:32:18.080

我使用*phptoolcase 库*中的查询生成器，它使用 pdo 连接器，具有连接支持。

[http://phptoolcase.com/guides/ptc-qb-guide.html](http://phptoolcase.com/guides/ptc-qb-guide.html)

您可以将它与库中的连接管理器一起使用，以非常快速地设置多个数据库连接。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-04-16T02:35:33.367

试试 magsql [https://github.com/maghead/magsql](https://github.com/maghead/magsql)，这是一个用 PHP 编写的为性能而设计的 SQL 构建器，带有连接支持和跨平台 SQL 生成。

目前用在最快的纯 PHP orm "maghead"

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2015-04-28T22:29:19.953

您可以使用 lenkorm，这很容易：

select('contents)->left('categories ON categories.category.id = contents.category_id)->where('content_id = 1')->result();

或者您可以用作：

select('contents)->left('categories->using(categoru_id)->where('content_id = 1')->result();

[从 github 下载](https://github.com/guncebektas/lenkorm)

# python - 智能数独高尔夫

> ID：216141
> 
> 赞同：2
> 
> 时间：2008-10-19T07:38:32.357
> 
> 标签：python, perl, code-golf, sudoku

这个问题的重点是创建最短**且不滥用缓慢**的数独求解器。这被定义为：**当棋盘上有可能只有一位数的点时，不要递归**。

这是迄今为止我在python中最短的：

```
r=range(81)
s=range(1,10)
def R(A):
    bzt={}
    for i in r:
        if A[i]!=0: continue; 
        h={}
        for j in r:
            h[A[j]if(j/9==i/9 or j%9==i%9 or(j/27==i/27)and((j%9/3)==(i%9/3)))else 0]=1
        bzt[9-len(h)]=h,i
    for l,(h,i)in sorted(bzt.items(),key=lambda x:x[0]):
        for j in s:
            if j not in h:
                A[i]=j
                if R(A):return 1
        A[i]=0;return 0
    print A;return 1

R(map(int, "080007095010020000309581000500000300400000006006000007000762409000050020820400060")) 
```

我将最后一行作为 cmd 行输入的一部分，它可以更改为：

```
import sys; R(map(int, sys.argv[1]); 
```

这类似于其他数独高尔夫挑战，只是我想消除不必要的递归。任何语言都可以接受。挑战来了！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T22:54:37.580

我并没有真正做出太大的改变——算法是相同的，但是这里有一些你可以对你的 python 代码进行的进一步的微优化。

*   不需要 !=0, 0 在布尔上下文中为假。

*   a if c else b 如果不需要短路，则比使用 [a,b][c] 更昂贵，因此您可以使用`h[ [0,A[j]][j/9.. rest of boolean condition]`. 更好的是利用您在错误情况下想要 0 的事实，然后乘以布尔值（被视为`0*A[j]`(ie. 0) 或`1*A[j]`(ie. `A[j]`)。

*   您可以省略数字和标识符之间的空格。例如“ `9 or`”->“ `9or`”

*   您可以省略 sorted() 的键。由于您正在对第一个元素进行排序，因此正常排序将有效地产生相同的顺序（除非您依赖于稳定性，它看起来不像）

*   您可以通过省略 .items() 调用来节省几个字节，只需将下一行中的 h,i 分配给 z[l]

*   您只使用 s 一次 - 使用变量没有意义。您还可以通过选择适当的 r 切片来避免使用 range() (r[1:10])

*   `j not in h`可以变成`(j in h)-1`（在整数上下文中依赖 True == 1）

*   **[编辑]**您还可以将第一个 for 循环的 h 构造替换为 dict 构造函数和生成器表达式。这使您可以将逻辑压缩到一行，总共节省 10 个字节。

更一般地说，您可能想考虑更改算法以减少嵌套级别的方法。在 python 中，每个级别都会为每行提供一个额外的字节，这些字节会累积。

这是我到目前为止所得到的（我已经切换到每个缩进 1 个空格，以便您可以准确了解所需字符。目前它的重量为~~288~~ 278，这仍然很大。

```
r=range(81)
def R(A):
 z={} 
 for i in r:
  if 0==A[i]:h=dict((A[j]*(j/9==i/9or j%9==i%9or j/27==i/27and j%9/3==i%9/3),1)for j in r);z[9-len(h)]=h,i
 for l in sorted(z):
  h,i=z[l]
  for j in r[1:10]:
   if(j in h)-1:
    A[i]=j
    if R(A):return A
  A[i]=0;return[]
 return A 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-20T05:12:33.433

```
r=range(81)
def R(A):
 if(0in A)-1:yield A;return
 def H(i):h=set(A[j]for j in r if j/9==i/9or j%9==i%9or j/27==i/27and j%9/3==i%9/3);return len(h),h,i
 l,h,i=max(H(i)for i in r if not A[i])
 for j in r[1:10]:
  if(j in h)-1:
   A[i]=j
   for S in R(A):yield S
  A[i]=0 
```

269 个字符，它会找到所有解决方案。用法（不计入字符数）：

```
sixsol = map(int, "300000080001093000040780003093800012000040000520006790600021040000530900030000051")
for S in R(sixsol):
    print S 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T16:19:42.557

我刚刚在这里修剪了一下python：

```
r=range(81);s=range(1,10)
def R(A):
    z={}
    for i in r:
        if A[i]!=0:continue
        h={}
        for j in r:h[A[j]if j/9==i/9 or j%9==i%9 or j/27==i/27 and j%9/3==i%9/3 else 0]=1
        z[9-len(h)]=h,i
    for l,(h,i)in sorted(z.items(),cmp,lambda x:x[0]):
        for j in s:
            if j not in h:
                A[i]=j
                if R(A):return A
        A[i]=0;return[]
    return A

print R(map(int, "080007095010020000309581000500000300400000006006000007000762409000050020820400060")) 
```

这是一个庞大的 410 个字符，如果不计算空格，则为 250 个。如果你只是把它变成 perl 你无疑会比我的更好！

# language-agnostic - OOP：在哪里停止抽象

> ID：216150
> 
> 赞同：8
> 
> 时间：2008-10-19T07:46:44.307
> 
> 标签：language-agnostic, oop

你在哪里画线以停止抽象并开始编写理智的代码？有大量“企业代码”的示例，例如十几个文件的“FizzBu​​zz”程序……即使是诸如 RTS 游戏之类的简单内容也可以具有以下内容：

```
class Player {} ;/// contains Weapons
class Weapons{} ;/// contains BulletTypes
class BulletType{} ;///contains descriptions of Bullets 
class Bullet{} ;///extends PlaceableObject and RenderableObject which can be placed/drawn respectively
class PlaceableObject{} ;///has x,y,z, coords
class RenderableObject{} ;///an object with a draw() command
class MovingObject{}; ///an object with a move() function 
```

等等......它可以变成一场噩梦。这可以被拉到它的逻辑极端，就像函数式编程可以被拉到一个极端，你可以创建一种只有变量、函数应用程序和匿名函数定义的语言（尽管我必须承认这稍微更优雅）......

关于这个话题有什么明智的建议吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-19T08:21:36.497

1.  **YAGNI（你不需要它）。**不要创建您没有立即使用或没有合理理由的抽象。这样一来，您就有了一件可能变得更复杂的简单事物，而不是您努力使之变得更简单却失败了的复杂事物。
2.  确保抽象是有意义的。如果他们离现实太远，太难证明……算了。
3.  让解决方案感觉自然。继续努力，直到完成为止。那么对于一个不熟悉的人来说，解决方案应该看起来如此明显，以至于他尖叫着“你怎么能以不同的方式做到这一点？”。
4.  **不要试图预测未来。**你不能。如果你尝试涵盖所有 10 种可能的情况，你很快就会发现第 11 种甚至更多，并且由于之前的 10 种，实践中没有遇到过，因此实施起来会更加困难。**使其简单易适应。** 软件需要更改，但易于适应（敏捷性）通常比尝试预先涵盖所有可能的情况要好得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-19T11:52:11.627

也许这个问题应该从**哪里开始抽象**。

您引用的示例是一个经典示例，没有充分考虑对象实际上是什么，因为它们几乎都相同 - 并且可能会更好地表示为单个“游戏对象”。

我还避免按对象属性进行子类化。对于 StaticGameObject 和 DynamicGameObject 可能看起来很合乎逻辑，但可能更好地由容器放置表示 - 即两个列表，一个用于静态对象，一个用于动态，因此允许其他逻辑来定义动作，而不是对象本身负责控制它之外的东西范围。

有时很难计算出你想在一个对象中表示的一组事物所共享的内容——但这是值得的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T09:39:58.587

我相信标准可以从抽象是什么的明确定义中推导出来。

您指的是面向对象编程范式中的抽象，您可以在其中使用三个原则：[“抽象”-“封装”-“信息隐藏或可见性”](https://stackoverflow.com/questions/99688)。

**抽象是选择对象的哪些属性与您的系统相关并且必须完全忽略的过程。**

这意味着，抽象限制与您定义的概念（玩家、武器、子弹……）的*数量无关，而是**您选择放入*这些概念中的内容。

它基本上是*分类*，您将只从一个概念考虑对您需要定义的服务有用的东西。

因此***，开始编写健全代码的一个好标准可能是 API***，正如 eclipse 程序所建议的那样：**[API first](http://www.eclipse.org/eclipse/development/apis/API-First.pdf)**。

事实上，“好的 API 需要设计迭代”，这意味着您在问题中提到的对象列表将被细化，因为所需的 API 本身是细化的。

另外，API 意味着具有明确定义的组件边界和依赖关系（如“核心 - 播放器 - 与 UI - RenderableObject - ”），这意味着您提到的非常详细的列表不能被视为一个长长的无穷无尽的概念列表，但是必须从应用架构中清楚地分组为不同的***功能边界（或功能组件）。***

由于 API 的存在是为了满足客户的需求，因此您将保留这些对象只是因为它们对客户有意义。其他对象应该在“内部”包中，并且永远不要被应用程序的任何其他部分直接引用。

考虑到这一点，[@phjr 的建议](https://stackoverflow.com/questions/216150#216169)非常有意义；）

# php - 如何安全地接受粘贴 PHP 中的代码

> ID：216155
> 
> 赞同：2
> 
> 时间：2008-10-19T07:51:39.413
> 
> 标签：php, validation, embed

我想允许用户通过 HTML 表单粘贴`<embed>`和`<object>`HTML 片段（视频播放器）。服务器端代码是 PHP。如何防止恶意粘贴代码、JavaScript 等？我可以解析粘贴的代码，但我不确定我是否能解释所有变化。有没有更好的办法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-19T07:55:15.117

我不太确定参数`EMBED`和`OBJECT`采用什么参数，因为我从来没有真正处理过将媒体放在页面上（这实际上是一种令人震惊的想法），但我会采用 BB Code 方法并做类似的事情`[embed url="http://www.whatever.com/myvideo.whatever" ...]`然后您可以解析 URL 和其他任何内容，确保它们是合法的并制作您自己的`<EMBED>`标签。

**编辑：**好的，这样的事情应该没问题：

```
$youtube = '<object width="425" height="344"><param name="movie" value="http://www.youtube.com/v/Z75QSExE0jU&hl=en&fs=1"></param> </param><embed src="http://www.youtube.com/v/Z75QSExE0jU&hl=en&fs=1" type="application/x-shockwave-flash" allowfullscreen="true" width="425" height="344"></embed></object>';

$blip = '<embed src="http://blip.tv/play/AZ_iEoaIfA" type="application/x-shockwave-flash" width="640" height="510" allowscriptaccess="always" allowfullscreen="true"></embed>';

preg_match_all("/([A-Za-z]*)\=\"(.+?)\"/", $youtube, $matches1);
preg_match_all("/([A-Za-z]*)\=\"(.+?)\"/", $blip, $matches2);
print '<pre>' . print_r($matches1, true). '</pre>';
print '<pre>' . print_r($matches2, true). '</pre>'; 
```

这将输出：

```
Array
(
[0] => Array
    (
        [0] => width="425"
        [1] => height="344"
        [2] => name="movie"
        [3] => value="http://www.youtube.com/v/Z75QSExE0jU&hl=en&fs=1"
        [4] => src="http://www.youtube.com/v/Z75QSExE0jU&hl=en&fs=1"
        [5] => type="application/x-shockwave-flash"
        [6] => allowfullscreen="true"
        [7] => width="425"
        [8] => height="344"
    )

[1] => Array
    (
        [0] => width
        [1] => height
        [2] => name
        [3] => value
        [4] => src
        [5] => type
        [6] => allowfullscreen
        [7] => width
        [8] => height
    )

[2] => Array
    (
        [0] => 425
        [1] => 344
        [2] => movie
        [3] => http://www.youtube.com/v/Z75QSExE0jU&hl=en&fs=1
        [4] => http://www.youtube.com/v/Z75QSExE0jU&hl=en&fs=1
        [5] => application/x-shockwave-flash
        [6] => true
        [7] => 425
        [8] => 344
    )
)

Array
(
[0] => Array
    (
        [0] => src="http://blip.tv/play/AZ_iEoaIfA"
        [1] => type="application/x-shockwave-flash"
        [2] => width="640"
        [3] => height="510"
        [4] => allowscriptaccess="always"
        [5] => allowfullscreen="true"
    )

[1] => Array
    (
        [0] => src
        [1] => type
        [2] => width
        [3] => height
        [4] => allowscriptaccess
        [5] => allowfullscreen
    )

[2] => Array
    (
        [0] => http://blip.tv/play/AZ_iEoaIfA
        [1] => application/x-shockwave-flash
        [2] => 640
        [3] => 510
        [4] => always
        [5] => true
    )
) 
```

从那时起，它就非常简单了。对于像宽度/高度这样的东西，您可以使用它们来验证它们，[`is_numeric`](http://www.php.net/is_numeric)其余的您可以运行这些值[`htmlentities`](http://www.php.net/htmlentities)并从信息中构建您自己的`<embed>`标签。我很确定这将是安全的。您甚至可以使用来自 blip.tv 的链接制作完整的`<object>`YouTube（我认为它可以在更多地方使用），因为您将拥有所有必需的数据。

我相信您可能会看到来自其他视频共享网站的链接的一些怪癖，但这有望帮助您入门。祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T09:08:44.390

通过扫描输入的 HTML 可靠地检测到恶意代码的机会几乎为零。注入脚本的方法有很多（包括特定于浏览器的格式错误的 HTML），您将无法全部挑选出来。如果大型网络邮件提供商多年后仍在寻找新的漏洞，那么您就不可能做到这一点。

白名单比黑名单好。因此，您可以改为要求输入为 XHTML，并使用标准 XML 解析器对其进行解析。然后遍历 DOM 并检查每个元素和属性是否已知良好，如果一切正常，则序列化回 XHTML，它来自已知良好的 DOM，不应该是格式错误的。支持 Unicode 的适当 XML 解析器还应该免费过滤掉讨厌的“超长 UTF-8 序列”（影响 IE6 和旧 Opera 的安全漏洞）。

但是...如果您允许来自任何域的嵌入/对象，则您已经允许从外部域对您的页面进行完整的脚本访问，因此 HTML 注入是您最不必担心的。Flash 等插件很可能无需任何技巧即可执行 JavaScript。

因此，您应该将对象的来源限制在预先确定的已知良好域中。如果您已经这样做了，那么只允许用户选择视频提供者和剪辑 ID，然后将其转换为该提供者的正确、已知良好的嵌入代码，可能会更容易。例如，如果您使用类似 bbcode 的标记，则让用户包含 YouTube 剪辑的传统方式是 [youtube]Dtzs7DSh[/youtube]。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T08:12:50.603

以下是来自 blip.tv 的粘贴代码示例：

```
<embed src="http://blip.tv/play/AZ_iEoaIfA" type="application/x-shockwave-flash"    
  width="640" height="510" allowscriptaccess="always" allowfullscreen="true"></embed> 
```

以下是您可能从 YouTube 获得的内容的示例：

```
<object width="425" height="344">
  <param name="movie" value="http://www.youtube.com/v/Z75QSExE0jU&hl=en&fs=1"></param>
  <param name="allowFullScreen" value="true"></param>
    <embed src="http://www.youtube.com/v/Z75QSExE0jU&hl=en&fs=1"
      type="application/x-shockwave-flash" allowfullscreen="true"
      width="425" height="344"></embed>
</object> 
```

# javascript - 区分 AJAX 调用/浏览器请求

> ID：216173
> 
> 赞同：13
> 
> 时间：2008-10-19T08:33:54.773
> 
> 标签：javascript, ajax, http-headers, xmlhttprequest

HTTP 请求的标头中是否有任何内容可以让我区分 AJAX 调用和来自给定客户端的直接浏览器请求？无论如何，用户代理字符串通常相同吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-19T08:49:40.730

如果您使用 Prototype、jQuery、Mootools 或 YUI，您应该找到一个**X-Requested-With:XMLHttpRequest**标头，它会为您解决问题。应该可以在其他库中插入您喜欢的任何标题。

在最低级别，给定一个[XMLHttpRequest或 XMLHTTP 对象，您可以使用](http://www.w3.org/TR/XMLHttpRequest)[setRequestHeader](http://www.w3.org/TR/XMLHttpRequest/#setrequestheader)方法设置此标头，如下所示：

```
xmlHttpRequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest'); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T08:48:20.860

经过一些研究，看起来最好的方法是在进行 AJAX 调用时简单地指定一个自定义用户代理字符串，然后在服务器上检查这个自定义用户代理字符串。

# apache - Apache HTTP Server 可以提供动态内容吗？

> ID：216178
> 
> 赞同：1
> 
> 时间：2008-10-19T08:44:39.150
> 
> 标签：apache, tomcat, webserver

Apache HTTP Server 可以只提供静态内容吗？Tomcat 用于服务 Servlets/JSP。Tomcat 能否提供其他动态内容，如 perl、PHP 等？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-19T09:07:47.747

Apache HTTP 服务器 ( [http://httpd.apache.org](http://httpd.apache.org) ) 具有：

*   CGI 支持：[mod_cgi](http://httpd.apache.org/docs/2.0/mod/mod_cgi.html)。这将运行几乎任何动态内容，您甚至可以在 Bash 中编写 CGI。

*   WSGI 支持：[mod_wsgi](http://www.modwsgi.org/)

*   FastCGI 支持：[mod_fcgid](http://fastcgi.coremail.cn/)（CGI，但更高效）

*   Perl 支持：[mod_perl](http://perl.apache.org)

*   PHP 支持：[mod_php](http://www.php.net)

*   Python 支持：[mod_python](http://www.modpython.org/)（推荐使用 mod_wsgi）

*   Ruby 支持：[mod_ruby](http://www.modruby.net)（感谢[David Holm](https://stackoverflow.com/questions/216178/can-apache-http-server-serve-dynamic-content#216205)）

*   通过 Tomcat 等 servlet 容器提供 Java 内容的桥接：[mod_jk](http://tomcat.apache.org/connectors-doc)、[mod_proxy_ajp](http://httpd.apache.org/docs/2.2/mod/mod_proxy_ajp.html)

*   另外，一个 API 来编写你自己的 apache 模块，它可以让你做你想做的事情，这里是一些现有模块的存储库：http: [//modules.apache.org](http://modules.apache.org)

如果您的意思是 Tomcat 可以，它不能在 Java 环境之外，它只是一个 servlet 容器。也就是说，Java 可以执行一些其他脚本语言，因此您可以编写程序以在所有受支持的[脚本引擎](https://scripting.dev.java.net/)中生成内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T09:03:47.583

当然 Apache 能够提供动态内容！mod_perl、mod_php 等是您插入到 Apache 以使他能够为它们提供服务的模块。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-19T09:03:55.197

一句话：是的：P

[mod_perl](http://perl.apache.org/)
[mod_python](http://www.modpython.org/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T09:21:53.630

不要忘记[mod_ruby](http://www.modruby.net/en/)。

# language-agnostic - OOP：何时创建派生类，何时使用条件实现功能？

> ID：216182
> 
> 赞同：6
> 
> 时间：2008-10-19T08:48:51.420
> 
> 标签：language-agnostic, design-patterns, oop

我什么时候应该继续创建派生类，什么时候应该在我的代码中添加条件？例如导弹

```
class Object;
class Projectile : public Object;

class Missile : public Projectile;
class MissileGuided : public Missile; 
```

还是我应该在导弹代码中实现最后一个？

```
void Missile::Update()
{
    if(homing && ObjectExists(Target))
        TurnTowards(Target.Pos)

    Pos += Motion;
} 
```

我认为对于所有更精细的细节，第二个更好，因为你开始得到事物的组合（例如，有些导弹可能不会在雷达上显示，有些可能是可摧毁的，如果原件被摧毁，有些可能会获得新目标或超出范围等）

然而，在某些情况下，对于共享导弹属性的常规射弹也可以这样说（例如，可能是可摧毁的，大型射弹可能会出现在雷达上等）

然后我可以进一步说，射弹与船只共享属性（两者都会移动，碰撞时会造成伤害，可能会在雷达上显示，可能会被摧毁......）

然后一切都像 3 类一样结束：

```
class Entity;
class Object : public Entity;
class Effect : public Entity; 
```

在创建派生类和使用标志或其他东西实现方法中的功能之间划清界限的好点在哪里？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-19T09:04:51.137

您可能需要考虑使用**策略模式**而不是两种方法，并将行为封装在外部类中。然后可以将这些行为注入到 Missile 类中，使其成为 GuidedMissile 或 SpaceRocket 或您需要的任何其他东西。

这样可以避免 Missile 类中逻辑的过度分支，并且您不需要进入与深度继承相关的逻辑复杂性。

维基百科有多种语言的模式使用示例集合： [http ://en.wikipedia.org/wiki/Strategy_pattern](http://en.wikipedia.org/wiki/Strategy_pattern)

```
interface INavigable {
  Course calcCourse (Position current, Destination dest);
}

Class GeoStationaryRocketCPU implements INavigable {
  Course calcCourse (Position current, Destination dest) {
     return dest.getShortestRouteTo (current).getCourse();
  };

}

Class GuidedMissileCPU implements INavigable {
  Course calcCourse (Position current, Destination dest) {
      return dest.getLowestAltRouteTo (current).getCourse();
  };

}

class Missile {
  INavigable CPU;

  void setCPU (INavigable CPU) {
     this.CPU = CPU;
  }

  void fly ()
  {

     ...
     course = this.CPU.calcCourse (pos, dest);
     ...
  }

} 
```

* * *

正如另一位同事所建议的，您也可以考虑使用装饰器模式。只是为了突出几个设计问题，如果你要走这条路，这些问题在你的环境中可能很重要：

1.  要仅替换对象行为的某个方面，您需要装饰整个类。
2.  如果装饰类（比如说导弹）的公共接口被改变（甚至是一些与其导航方面无关的功能），你将不得不改变所有的装饰类（即 GuidedMissile、Rocket、FireworkRocket 等）来传递界面。
3.  在装饰器中，您会期望装饰器会添加功能，而不是替换它。它通过添加调用其函数然后调用基类方法来工作。在上面的场景中，这将导致能够拥有一个装饰 GeoStationaryRocketCPU 的 GuidedMissileCPU——显然这不是你想要的。您希望它选择一种不同的导航策略，而不是将导航策略叠加在一起。

尽管如此，当提供一个现成的不可变的导弹装饰实现时，可能是“解锁”它并实现策略模式的关键，为导弹提供各种所需的行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T10:07:03.243

继承取决于您使用的语言/技术，例如在 C++ 中，您可以从多个类派生一个类，但这种构造在 Java、C#、PHP 等中不可用，而是您有抽象类和接口，我正在尝试就是说，如果您有一个类，例如，您公司的软件将使用多个数据库管理系统，并且您可以为这样的构造设计一组独立的类，您可以通过使用抽象类并实现多态来做到这一点例如：

```
 public abstract class Database
    {
         public virtual void Connect();
         public virtual int GetNumberOfTables();

    } 
```

然后您可以为特定的 SQL Server 或 Oracle 实现派生一个类

```
 public class SQLServerDatabase : Database
    {
           public override void Connect()
           {
                   // SQL Implementation
           }

           public override int GetNumberOfTables()
           {
                 // SQL Implementation
           }  

    }

    public class OracleDatabase : Database
    {
           public override void Connect()
           {
                  // Oracle Implementation
           }

           public override int GetNumberOfTables()
           {
                 // Oracle Implementation
           }  
    } 
```

在这样的构造中，您可以使用继承，但要避免我在上面的示例中看到的类逻辑复杂性。

至于条件，您可以使用它来测试您是否销毁了对象或垃圾收集器将对象设置在终结队列中，使其不再可供您使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-19T10:07:17.767

我认为在这种情况下你应该使用装饰器模式。您添加的每个新功能都是对原始 Missile 类的装饰。例如，您可以创建一个新的装饰导弹类，它可以引导 (GuidedMissile) 并且可以在水下 (UnderwaterMissile) 简单地装饰导弹类。好处是装饰器模式在运行时工作，您不需要构建所有具有静态行为的类，但您可以在运行时组合所需的行为。看看这里： [http ://en.wikipedia.org/wiki/Decorator_pattern](http://en.wikipedia.org/wiki/Decorator_pattern) [http://www.dofactory.com/Patterns/PatternDecorator.aspx](http://www.dofactory.com/Patterns/PatternDecorator.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T11:17:41.417

问问自己，如何更容易：

1.  阅读并理解代码（小项目部分和整个项目）
2.  将来更改代码（在预测未来需求时要非常小心，通常最好不要提前调整代码以适应“可能”的更改）

还有一些非常罕见的情况，类层次结构会严重影响性能。

因此，当它更适合上述标准时，请创建派生类。

# javascript - 当焦点在“内部”时如何更改元素/容器的样式？

> ID：216185
> 
> 赞同：1
> 
> 时间：2008-10-19T08:51:38.480
> 
> 标签：javascript, javascript-framework

假设有这样的代码：

```
<div class="notSelected">
      <label>Name
          <input type="text" name="name" id="name" />
      </label> 
      <div class="description">
          Tell us what's your name to make us able to fake to be your friend 
          when sending you an email.
      </div>
</div> 
```

现在假设我对表单的每个元素都有这样的东西（这只是一个例子）。我想在以下情况下将样式从 notSelected 更改为 Selected：

*   用户关注输入元素
*   用户将鼠标移动到 notSelected div

当他改变焦点时，Selected div 应该再次变为 notSelected。

我想做这样的事情来增加所选 div 的文本大小。无论如何，进行其他更改也可能很酷，所以我更愿意更改类属性。

在 JavaScript 中执行此类操作的最佳方法是什么？有没有什么 JavaScript 框架可以帮助我做这件事？所以很容易添加褪色等效果......

我下载了 MooTools，但是通过快速阅读文档，如果没有任何表单 div 的特定 ID，我没有看到如何做到这一点，但这是我第一次使用它。我使用任何其他框架都没有问题，但如果你推荐一个，请写下我应该特别寻找什么。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-19T12:38:12.237

这个问题还有一个纯 CSS 解决方案。但是，它在 MSIE 6 中不起作用。从技术上讲，它的工作方式类似于 Tomalek 的解决方案，但它不是使用 JavaScript 来切换元素的类，而是使用 CSS 来切换其样式：

```
.selectable { /* basic styles …  */ }
.selectable:hover { /* hover styles … */ }
.selectable:active { /* focus styles … */ } 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-19T09:35:17.237

我建议您查看 jQuery 来完成您的任务。它很容易学习并很快产生很好的效果。但仅您描述的效果，纯 JavaScript 也足够了。

让您的 DIV 始终有一个名为“可选”的类。您可以稍后切换其他 CSS 类。创建一个名为“selected”的 CSS 类并赋予它所需的外观。

```
<div class="selectable">  (=off) vs. <div class="selectable selected"> (=on) 
```

然后将类似这样的内容添加到文档的脚本部分：

```
$(document).ready(function(){

  // handle mouseover and mouseout of the parent div
  $("div.selectable").mouseover(
    function() { 
      $(this).addClass("selected").addClass("mouseIsOver");
    }
  ).mouseout(
    function() { 
      $(this).removeClass("selected").removeClass("mouseIsOver");
    }
  );

  // handle focus and blur of the contained input elememt,
  // unless it has already been selected by mouse move
  $("div.selectable input").focus(
    function() {
      $(this).parents("div.selectable").not(".mouseIsOver").addClass("selected");
    }
  ).blur(
    function() {
      $(this).parents("div.selectable").not(".mouseIsOver").removeClass("selected");
    }
  );
}); 
```

这是未经测试的，因此可能存在故障，但它会让您大致了解从哪里开始。

PS：在鼠标移动时更改文本大小可能不是所有想法中最好的。它会导致重新排列页面布局，这对用户来说很烦人。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T15:46:58.427

**@托马拉克：**

为什么要四次查询 DOM？

一个小的编辑，但一个巨大的速度优势：

```
$("div.selectable").mouseover(function ()
{
    // ...
}).mouseout(function ()
{
    // ...
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T14:55:19.280

这有点不相关，但标签标签不包含输入标签。您为标签标签提供一个“for”属性，该属性对应于输入元素的 ID。例子，

```
<label for="username">Username</label>
<input type="text" name="username" value="Enter your username..." id="username" /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T10:05:38.130

另一个与原始问题无关的答案，但是...... jQuery 还有一种替代语法来执行鼠标悬停/鼠标悬停的事情，称为悬停。

```
$(element).hover(function(){ /* mouseover */ }, function(){ /* mouseout */ }); 
```

例子，

```
$('ul#nav li').hover(function() {
    $(this).addClass('highlight');
}, function() {
    $(this).removeClass('highlight');
}); 
```

对不起那些双美元，我似乎无法弄清楚如何逃避它。

# linux - 升级 GCC 后 MySQL++ 库不起作用

> ID：216197
> 
> 赞同：0
> 
> 时间：2008-10-19T09:10:19.753
> 
> 标签：linux, gcc, mysql++

我正在使用 mysql++ 库并使用 GCC 3.3.4 进行编译。
那个 GCC 版本有一些错误，所以我升级到 GCC 3.4.6。
升级 GCC 后，我重建了 mysql++ 并重新编译了我的程序。但现在我得到一个分段错误错误。

我收到以下消息：

> ./mysqlTest: 符号 `_ZTVSt15basic_stringbufIcSt11char_traitsIcESaIcEE' 在共享对象中有不同的大小，请考虑重新链接。
> 分段故障

有什么我必须重建、重新链接或其他任何东西才能让我的应用程序再次运行的东西吗？
mysql C API怎么样？mysql++ 是它的包装器。
应该重建mysql C API还是什么？

请帮忙，我不知道该怎么办。我需要完成这项工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T09:34:04.260

将 C++ 标准库从 GCC 3.3 升级到 GCC 3.4后，如果您的程序使用它们，则**必须**重新编译所有链接到它的库，同时也直接链接到标准 C++ 库。在你的情况下，考虑到你的后续行动，libdb_cxx-4.2 有问题，所以重建 Berkeley DB 4.2。基本上，mysqlTest 链接到新的 C++ 标准库和 Berkeley DB，但 Berkeley DB 链接到旧的。链接器将从两个库中提取符号，但其中一些库的内联存储类可能已更改，并且 Berkeley DB 会感到困惑。

要检查您使用的库，请`ldd`针对您的二进制文件运行，然后`ldd`针对列表中的每个 C++ 库运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T09:15:52.783

在重建 mysql++ 之前，你“make clean”了吗？

似乎 mysqlTest 程序没有重新编译，并且仍然需要以前的库。

如果你确实做了 make clean （假设 mysqlTest 是包中的一个程序），你在安装新库后是否'ldconfig'？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T09:29:49.200

是的，我在重建之前做了“清理”。
mysqlTest 是我的一个程序。我仍然有我在升级 GCC 之前编译的版本，它工作正常。但是我在升级后编译的那个给出了这个错误。

我也做了 ldconfig，我收到了这条消息：

> ldconfig: /usr/lib/libdb_cxx-4.2.so 不是符号链接

我不知道这是否只是一个警告，或者这是否意味着该过程被中断。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T10:25:43.143

回复 moocha:

我重建了我的应用程序正在使用的其他一些东西，并且我设法制作了一个简单的程序来工作。

不过，我仍然对复杂的程序有一些问题，我正在尝试解决这些问题。

我很确定 libdb_cxx-4.2.so 不是问题，因为我记得前段时间我在运行 ldconfig 时看到了该消息。即便如此，我怎样才能摆脱该错误消息？我经常遇到链接问题，我必须使用 -L 和 -l 手动将参数传递给 gcc

# ssh - 为什么 SSH 远程命令在手动运行时获得的环境变量更少？

> ID：216202
> 
> 赞同：265
> 
> 时间：2008-10-19T09:18:20.143
> 
> 标签：ssh, environment-variables

如果我 ssh 到机器并运行它，我有一个运行良好的命令，但是当我尝试使用远程 ssh 命令运行它时失败，例如：

```
ssh user@IP <command> 
```

在不同环境中使用两种方法比较“env”的输出。当我手动登录机器并运行 env 时，我得到的环境变量比运行时多得多：

```
ssh user@IP "env" 
```

知道为什么吗？

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2008-10-19T09:20:46.877

有不同类型的贝壳。SSH 命令执行外壳是非交互式外壳，而您的普通外壳是登录外壳或交互式外壳。描述如下，来自 man bash：

```
       登录 shell 是其参数的第一个字符
       零是 -，或者以 --login 选项开头。

       交互式外壳是在没有非选项的情况下启动的
       参数并且没有标准输入的 -c 选项
       和错误都连接到终端（如确定
       通过 isatty(3))，或者以 -i 选项开头。PS1 是
       如果 bash 是交互式的，则 set 和 $- 包括 i，允许
       shell 脚本或启动文件来测试这个状态。

       以下段落描述了 bash 如何执行其
       启动文件。如果任何文件存在但不能
       读，bash 报错。波浪号在文件中展开
       名称如下所述的波浪号扩展中的
       扩展部分。

       当 bash 作为交互式登录 shell 调用时，或者作为
       带有 --login 选项的非交互式 shell，它首先
       从文件 /etc/profile 读取并执行命令，如果
       该文件存在。读取该文件后，它会查找
       ~/.bash_profile、~/.bash_login 和 ~/.profile，其中
       命令，并从第一个命令中读取并执行命令
       存在并且可读。--noprofile 选项可以
       在 shell 启动时使用以抑制此行为
       约尔。

       当登录 shell 退出时，bash 读取并执行命令
       从文件 ~/.bash_logout，如果它存在。

       当不是登录 shell 的交互式 shell 是
       启动时，bash 从 ~/.bashrc 读取并执行命令，
       如果该文件存在。这可以通过使用
       --norc 选项。--rcfile 文件选项将强制 bash
       从文件中读取和执行命令，而不是
       〜/ .bashrc。

       当 bash 以非交互方式启动时，运行 shell
       例如，它在脚本中查找变量 BASH_ENV
       环境，如果它出现在那里，它的价值就会扩大，
       并使用扩展值作为要读取的文件名
       并执行。Bash 的行为就像以下命令一样
       被处决：
              如果 [ -n "$BASH_ENV" ]; 然后 。"$BASH_ENV"; 菲
       但 PATH 变量的值不用于搜索
       为文件名。

```

* * *

## 回答 #2

> 赞同：123
> 
> 时间：2009-09-24T15:29:47.880

在运行命令之前获取配置文件怎么样？

`ssh user@host "source /etc/profile; /path/script.sh"`

您可能会发现最好将其更改为`~/.bash_profile`,`~/.bashrc`或其他任何内容。

（如[这里（linuxquestions.org）](http://www.linuxquestions.org/questions/linux-enterprise-47/simple-rsh-issue-621882/?posted=1#post3695616)）

* * *

## 回答 #3

> 赞同：106
> 
> 时间：2012-04-03T12:52:24.620

运行远程 ssh 命令时不加载 Shell 环境。您可以编辑 ssh 环境文件：

```
vi ~/.ssh/environment 
```

它的格式是：

```
VAR1=VALUE1
VAR2=VALUE2 
```

另外，检查选项`sshd`的配置`PermitUserEnvironment=yes`。

* * *

## 回答 #4

> 赞同：69
> 
> 时间：2010-11-13T17:11:16.210

我有类似的问题，但最后我发现 ~/.bashrc 是我所需要的。

但是，在 Ubuntu 中，我不得不注释停止处理 ~/.bashrc 的行：

```
#If not running interactively, don't do anything
[ -z "$PS1" ] && return 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-05T19:13:53.063

我发现解决此问题的一个简单方法是将源 /etc/profile 添加到我试图在目标系统上运行的 script.sh 文件的顶部。在此处的系统上，这导致将 script.sh 所需的环境变量配置为好像从登录 shell 运行一样。

在先前的回复之一中，建议使用 ~/.bashr_profile 等...。我没有花太多时间在这上面，但是问题是，如果你 ssh 到目标系统上的另一个用户，而不是你登录的源系统上的 shell，在我看来，这会导致源系统用户用于~的名称。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-02-15T06:27:13.113

只需在 ~/.bashrc 中检查非交互式 shell 的上方导出您想要的环境变量。

# apache-flex - 调用 removeChild() 时 Flex 中的垃圾收集 - 管理竞争条件

> ID：216203
> 
> 赞同：1
> 
> 时间：2008-10-19T09:20:32.667
> 
> 标签：apache-flex, actionscript, garbage-collection

我在 Flex 中有一个“框架”，它加载和销毁子“部分”，它们是模块类的实例。它们中有很多网络服务和动画，并且是面向公众的网站的一部分。

在我从屏幕上删除一个部分之前，我在实例上调用了一个“hideSection()”接口方法。在这种方法中，我会淡出任何控件，或者如果该部分想要防止自己被关闭，则返回 false。目前它还停止运行任何 Timer 实例。

问题是即使从舞台上移除了部分对象，也可能会有一些未完成的事情发生。例如，我可能会在 effectEnded 触发某些东西的地方运行效果，或者缓慢的 Web 服务请求可能会超时并导致错误弹出。

由于垃圾收集器的工作方式 - 有时该对象对象会更快地被杀死，而其他时候则更晚。一旦某个部分关闭，我会尽量减少发生的坏事。

我想出了以下可能的解决方案。想知道有没有更好的。

*   有一个设置为 true 的 _disposed 属性。在任何可能有不良行为的事件处理程序中（在该部分关闭后）我只想说`if (_disposed) { return; }`.
*   可能还需要实现“IDisposable”接口，例如在 .NET 中。

这真的是我唯一的选择吗 - 或者我可以以某种方式加快垃圾收集。如果效果仍在运行，垃圾收集甚至会发生吗？

我也很好奇是否应该将事物设置为 _null，尤其是计时器。或者，如果没有对它的引用，只需 stop() 一个计时器就足以让它被垃圾收集。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T17:51:19.830

[http://gskinner.com/talks/resource-management/](http://gskinner.com/talks/resource-management/)

this is grand skinner's talk about garbage collection. Around slide 32 he talks about his janitor system. you can read over then and then grab his source files.

also make sure you are familiar with his talk about flash 9's garbage collection: [http://www.gskinner.com/blog/archives/2008/04/failure_to_unlo.html](http://www.gskinner.com/blog/archives/2008/04/failure_to_unlo.html)

specifically look at this part:

> Work-Arounds and Strategies There are four main things you can do to address these issues now:
> 
> 1.  Make sure that you are always removing timer and enterframe event listeners in content you may want to load into a larger application. Also, try to avoid stage listeners where possible, and remove them immediately when you are done with them.
>     
>     
> 2.  Expose a standard API in your SWFs that allows other SWFs to tell it to clean up and stop executing. This way, the loading application can call this method (within a try/catch block) before it unloads any content. I would suggest a .halt() method, backed by a listener for a "halt" event through sharedEvents.
>     
>     
> 3.  You can load content SWFs from a subdomain. This will place it into a security sandbox implicitly.
>     
>     
> 4.  Load content into a div layered over your main application. This isn't a great option, but it addresses almost all of the issues.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T14:25:06.267

您可以在 hideSection() 方法中删除所有活动的事件侦听器。

```
removeEventListener(this, listenerFunction, eventType); 
```

如果您添加了带有[弱引用](http://www.gskinner.com/blog/archives/2006/07/as3_weakly_refe.html)的事件侦听器，并且没有其他对它的引用，那么侦听器的目标应该被垃圾回收。

# user-interface - 文本模式 LCD 显示的用户界面

> ID：216206
> 
> 赞同：4
> 
> 时间：2008-10-19T09:23:29.803
> 
> 标签：user-interface, embedded

有人知道有关此主题的任何资源吗？

我正在为 2x16 LCD 显示器开发嵌入式应用程序。理想情况下，我希望有一个通用（独立于显示器）框架，几乎可以在任何显示器上使用 - 一个或多个段 LED、1x16、2x16 LCD 等。还想了解此类小型显示器的一般指南用户界面。

编辑：我对高级功能感兴趣，如何组织用户界面——菜单、选项和用户输入。我们不在这里讨论 LCD 控制器的问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-19T10:57:29.507

我会为单行界面设计它，使用更多的行会给你更多的空间。

我会选择至少 4 个按钮：

*   菜单
*   向上
*   向下
*   好的

如果您指定线宽（如 16），那么这将适用于 16x2、16x1 和 16 个 7 段显示器......您在设计菜单上的文本时会考虑到这一点。

如果您添加更多按钮，UI 会更有用，我会考虑这些，按优先级排序，但这些不是必需的：

*   左右
*   数字键
*   QWERTY

您将拥有一个主菜单，它将带您进入嵌套的子菜单或操作项。

我举个例子，假设你正在做一个可以在 16x1 或 16x2 上工作的数字时钟。

主屏幕类似于 08:15P SUN101908 当您按菜单键时，它会显示一个菜单（设置时间、设置日期、设置闹钟、设置显示），用 UP&DOWN 移动项目，然后 OK 选择一个项目.

如果您选择“设置时间”，向上和向下箭头将更改小时，确定将接受并移至分钟选择...等。

如果你有一个数字小键盘，使用起来会更简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T09:36:03.070

如果您指的是 2 行 x 16 字符显示器，它们通常是基于像素的，并且将具有集成控制器，因为它们的控制要复杂得多。我过去使用的 2x16 和 4x16 LCD 设备实际上具有半字节宽的接口，并且命令以`<command>[<address>][<data>]`样式发送到设备，有效命令所需的半字节数由命令本身决定。如果您链接到目标设备会有所帮助，因为制造商之间似乎确实没有标准。

对于分段 LED 和 LCD，所谓的七段器件有一个标准布局，该布局从像素管开始。这是显示此细分的图表：

```
 a
  ---
f| g |b
  ---
e|   |c
  ---
   d 
```

另一个问题是您是想直接驱动显示器还是使用控制器 IC。驱动七段 LED 非常容易，因为它们通常有一个共同的阴极或阳极，您只需要能够吸收或提供足够的电流。直接驱动 LCD 稍微复杂一些，因为施加到像素或段的极性必须不断翻转以避免损坏设备。找到具有执行此功能的集成时钟的控制器要容易得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T23:17:34.053

我认为 1x16 和 2x16 LCD 之间的差异如此之大，以至于您不应该努力创建一个可以同时处理两者的 GUI 库 - 就像您不尝试创建一个可以同时处理 CURSES 和 Cocoa 作为后端的 GUI 库一样（好吧，有人这样做了，但这是……错误的）。

由于显示如此之少，您的 GUI 应该是非常面向领域的……也就是说，如果不知道您的领域是什么，我无法告诉您什么是好的概念。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-26T10:12:15.177

显示器的尺寸将对用户界面产生巨大影响。

1 行只够容纳一个单级菜单，尽管我认为即使这样也能推动它。我会将所有功能作为按钮，而显示器仅用于显示数据。

对于多级菜单，2 行就足够了。在菜单模式下，第一行用于指示它们在菜单树中的位置，第二行可用于菜单选择。我不会向菜单推荐很多级别，否则用户会忘记他们在哪里，并且也很难记住菜单树中的内容。在功能模式下，第一行可用于指示所选功能，第二行可用于指示数据。您可以使用按钮的向上向下菜单确定，但我会考虑仍然使用专用于功能的按钮。

4 行适合菜单。与上面的布局类似，额外的行帮助用户记住他们在菜单树中的位置。它可以帮助他们在空间上对其进行可视化。在这种情况下，我会推荐向上向下菜单确定按钮，而不是特定的功能键。特定的功能键有时会使用户对菜单范例感到困惑。

我不会为 1 行或 2 行显示器的数字键盘而烦恼，并完全放弃 QWERTY 键盘。如果您能负担得起将这么多按钮放在前面的空间，那么您应该为用户提供更大的显示！想象一下带有 1 x 16 显示屏的 QWERTY。荒谬的。UI 的复杂性应该反映设备的复杂性。

考虑 Osama 的单线时钟示例。这可以通过两个按钮和无菜单来实现。这些按钮可以称为“设置”和“调整”。

操作将是：

1.  正常 - 显示屏显示时间和日期：08:15P SUN101908
2.  闹钟 - 按“设置” - 显示屏显示闹钟，小时闪烁，按“调整”增加小时，再次按设置更改分钟，再次更改开/关状态。例如：AL：08:00 关闭
3.  再次按“设置”（或按住设置）随着时间的推移会发生同样的事情。在一定时间内不按按钮也会使菜单超时。

数字键盘将是多余的，从工程的角度来看，更多的硬件和更多的成本。这就是为什么闹钟上没有数字键盘的原因。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T20:39:54.590

我不知道为此明确目的而构建的任何“项目”或库。

我建议您采用在屏幕和字段概念上运行的“显示层”代码的方法。屏幕负责“拥有”屏幕上的所有字段，字段负责指定显示的内容、字段影响的变量以及影响字段值的输入法。这些字段还存储指向前和后字段设置/验证函数的任何函数指针。

这样做将帮助您保持相当一致的 UI。代码也将集中在一个地方，因此可能更容易调试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T20:55:55.480

类似任天堂的控制器制作简单，几乎可以用于任何应用程序。您只需要 8 把钥匙；4 个用于方向键，2 个在中间，2 个用于 A 和 B 按钮。创建这种控制器非常简单，对用户来说非常直观。它也是用户可以握在手中的东西，使其比安装的控件更加用户友好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-27T03:03:59.370

SONY 的缓动盘也是一个不错的选择：上/下/按（进入）/按住（退出）。如果 jogdial 模块不可用。然后尝试拆卸鼠标滚轮。

# apache-flex - 判断 Event.COMPLETE 是否已经在 Flex 中触发的最佳方法

> ID：216209
> 
> 赞同：0
> 
> 时间：2008-10-19T09:28:13.603
> 
> 标签：apache-flex, actionscript-3, image

我正在寻找判断 an`<mx:Image>`是否已经触发 'Event.COMPLETE' 事件的最佳方法。如果它已经显示，我想做一些事情，或者如果它还没有附加一个事件处理程序。

就像是 ：

```
if (newBackground.percentLoaded < 100) 
```

或者

```
if (newBackground.content != null) 
```

我最初是这样做`newBackground.content != null`的，但这有一些跨域问题，因为沙盒显然不允许我访问内容！

`percentLoaded < 100`在可能的比赛条件下，我什至有点厌倦了使用。

是的，我很熟悉`showEffect`，但这不是我想要的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T10:43:35.930

我假设您由于某种原因无法`Event.COMPLETE`在图像开始加载之前将事件侦听器附加到图像。如果是这种情况，您总是可以子类化`mx.controls.Image`并添加您自己的属性，`"loadingCompleted"`或者`"complete"`最初`false`设置为`true`在`Event.COMPLETE`事件第一次触发时设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T17:21:21.310

AS3 中的加载程序永远不会出现竞争条件，因为 API 的那部分不是多线程的。只需在加载开始之前添加您的事件侦听器就可以了。如果您使用的是 MXML，那么这一切都由您负责。

如果出于某种原因您无法控制 Image 控件，那么最佳做法是比较 bytesLoaded 和 bytesTotal。

```
// this will not race  
if (myImage.bytesLoaded < myImage.bytesTotal)  
{  
  myImage.addEventListener(Event.COMPLETE, handleImageComplete);  
}  
else  
{  
  // it's already done, do whatever you need to with it...  
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T10:41:08.900

您是否未订阅完整活动。还是进度事件？你用的是装载机吗？我相信在 flex 中，您可以在图像的标记中附加事件处理程序，以至少完成和进度。Progress 将为您提供 totalBytes 和 bytesLoaded。

干杯，安德鲁

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T10:42:08.150

使用事件是最好的方法。如果您遇到事件无法解决问题的情况，则可以监视图像控件的 contentWidth 和 contentHeight 属性。根据文档，“您可以在触发 updateComplete 事件后获取该值。” 加载前的值为NaN。一旦加载内容，它就会变成一个数字。

[http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/mx/controls/Image.html](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/mx/controls/Image.html)

# embedded - 在 STM32 闪存中运行多个应用程序

> ID：216211
> 
> 赞同：5
> 
> 时间：2008-10-19T09:33:01.533
> 
> 标签：embedded, stm32

我想在我的 STM32 闪存中有两个应用程序，一个基本上是引导，另一个是“主”应用程序。我已经想出了如何将它们中的每一个加载到闪存的不同区域，并且在进行内存转储之后，一切看起来都在正确的位置。

因此，当我进行重置时，它会加载引导，此时引导所做的只是跳转到应用程序。调试启动，这一切似乎工作正常。但是，在我跳转到应用程序之后问题就来了，它只执行一条指令（汇编），然后跳回引导。它应该无限期地留在应用程序中。

那么我的问题是，我应该在应用程序中“跳转”到哪里？

似乎有一些潜在的地方，例如中断向量、重置处理程序、应用程序的主要功能。实际上，我已经尝试了所有这些都没有成功。

希望这是有道理的，如果没有，我会更新问题。

感谢您的帮助！理查德

## 更新：

*   我在调试器中玩了一下，并手动将程序计数器更改为应用程序的主程序，这很有魅力，所以它让我觉得我的跳转有问题，为什么程序计数器没有继续运行跳跃后？
*   实际上它似乎是 PSR，“T”在跳转时被重置，如果我在跳转后再次设置它，它会按照我的意愿继续使用应用程序
*   好的找到了一个解决方案，似乎您需要在执行分支时将 PC LSB 设置为 1，否则它会进入“ARM”模式（32 位指令而不是像“拇指”模式中的 16 位指令。相当晦涩的小问题，谢谢分享给大家！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-20T08:31:25.467

确保跳转到 LSB 为 1 的地址。有关说明，请参阅此站点： [https ://www.embedded.com/introduction-to-arm-thumb/](https://www.embedded.com/introduction-to-arm-thumb/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-31T21:58:07.190

You might want to search for the IAP (In-application programmer) it allows you to bootload code from the RS232 psort on the stm32\. I started using and since it provides the source code, it is very simple to modify it for your purposes. basically after a reset you can code the IAP to bootload either from say address 0x08002000 or address 0x08003000\. then all you have to do is set a flag in your application code then say restart and the new application will then run I hope this helps.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-23T08:06:53.587

理查德，

I was trying to do the same thing you succeeded at, but was having problems. I was using the IAR IDE and updated the *.icf file (in the "proj" directory) to put my application at 0x08002000 and loaded a separate project at 0x08000000 that just does a jump to the address at the reset vector at 0x08002004\. The boot code started up and does seem to jump to the application start, but the application failed sometime during the IAR initialization, ending up at an ILLEGAL INSTRUCTION trap.

After single-stepping through the application code, I found that I forgot to set the interrupt vector base address to that of the application's. It was still pointing to 0x08000000 and thus the code went insane. Adding a call to set the vector address before enabling any interrupts solved my problem and is required if you wish to have an application shifted in flash.

Ira.

# deployment - 您如何维护开发代码和生产代码？

> ID：216212
> 
> 赞同：142
> 
> 时间：2008-10-19T09:33:25.073
> 
> 标签：deployment, version-control, continuous-integration, project-management, branching-and-merging

维护代码时要遵循的最佳实践和经验法则是什么？在开发分支中只有生产就绪代码是一种好习惯，还是应该在开发分支中提供未经测试的最新代码？

你们如何维护开发代码和生产代码？

编辑 - 补充问题 - 您的开发团队是否遵循“尽可能提交并且经常即使代码包含次要错误或不完整”协议或“提交-将代码提交到开发分支时只有完美代码”协议？

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2008-10-19T09:54:05.983

2019 年更新：

这些天来，这个问题将在使用 Git 的上下文中看到，并且使用该[分布式](https://stackoverflow.com/a/2563917/6309)开发[工作流程（主要](https://stackoverflow.com/a/2705286/6309)[通过 GitHub](https://github.blog/2018-04-10-ten-years-of-code/)协作）的 10 年显示了一般的最佳实践：

*   `master`是随时可以部署到生产环境中的分支：下一个版本，将一组选定的功能分支合并到`master`.
*   `dev`（或集成分支，或“ `next`”）是为下一个版本选择的功能分支一起测试的分支
*   `maintenance`（或`hot-fix`）分支是当前版本演变/错误修复的分支，[可能合并回`dev`和或`master`](https://stackoverflow.com/a/55077131/6309)

That kind of workflow (where you don't merge `dev` to `master`, but where you merge only feature branch to `dev`, then if selected, to `master`, in order to be able to drop easily feature branches not ready for the next release) is implemented in the Git repo itself, with the **[gitworkflow](https://stackoverflow.com/a/53405887/6309)** (one word, [illustrated here](https://stackoverflow.com/a/44470240/6309)).
See more at [`rocketraman/gitworkflow`](https://github.com/rocketraman/gitworkflow). The history of doing this vs Trunk-Based-Development is noted in the comments and discussions of [this article by Adam Dymitruk](http://dymitruk.com/blog/2012/02/05/branch-per-feature/).

[![https://github.com/rocketraman/gitworkflow/raw/master/docs/images/topicgraduation.png](https://i.stack.imgur.com/wWLrJ.png)](https://i.stack.imgur.com/wWLrJ.png)

^((source: [Gitworkflow: A Task-Oriented Primer](https://github.com/rocketraman/gitworkflow/blob/master/docs/task-oriented-primer.adoc#topic-graduation-to-master)))

Note: in that distributed workflow, you can commit whenever you want and push to a personal branch some WIP (Work In Progress) without issue: you will be able to reorganize (git rebase) your commits before making them part of a feature branch.

* * *

Original answer (Oct. 2008, 10+ years ago)

It all depends of the ***sequential nature of your release management***

First, is everything in your trunk *really for the next release*? You might find out that some of the currently developed functions are:

*   too complicated and still need to be refined
*   not ready in time
*   interesting but not for this next release

In this case, trunk should contain any current development efforts, but a release branch defined early before the next release can serve as ***consolidation branch*** in which only the appropriate code (validated for the next release) is merged, then fixed during the homologation phase, and finally frozen as it goes into production.

When it comes to production code, you also need to manage your *patch branches*, while keeping in mind that:

*   the first set of patches might actually begin before to first release into production (meaning you know you will go into production with some bugs you can not fix in time, but you can initiate work for those bugs in a separate branch)
*   the other patch branches will have the luxury to start from a well-defined production label

When it comes to dev branch, you can have one trunk, unless you have other development efforts you need to make *in parallel* like:

*   massive refactoring
*   testing of a new technical library which might change the way you calls things in other classes
*   beginning of a new release cycle where important architectural changes need to be incorporated.

Now, if your development-release cycle is very sequential, you can just go as the other answers suggest: one trunk and several release branches. That works for small projects where all the development is sure to go into the next release, and can just be frozen and serve as a starting point for release branch, where patches can take place. That is the nominal process, but as soon as you have a more complex project... it is not enough anymore.

* * *

To answer Ville M.'s comment:

*   keep in mind that dev branch does not mean 'one branch per developer' (which would trigger 'merge madness', in that each developer would have to merge the work of other to see/get their work), but one dev branch per development effort.
*   When those efforts need to be merged back into trunk (or any other "main" or release branch you define), this is the work of the developer, *not* - I repeat, NOT - the SC Manager (who would not know how to solve any conflicting merge). The project leader may supervise the merge, meaning make sure it starts/finish on time.
*   whoever you choose for actually doing the merge, the most important is:
    *   to have unit tests and/or assembly environment in which you can deploy/test the result of the merge.
    *   to have defined a tag ***before*** the beginning of the merge in order to be able to get back to previous state if said merge proves itself too complex or rather long to resolve.

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-10-19T11:36:14.920

We use:

*   development branch exclusively

until the project nears completion, or we are creating a milestone version (eg. product demo, presentation version), then we (regularly) branch off our current development branch into the:

*   release branch

No new features go into the release branch. Only important bugs are fixed in the release branch, and the code to fix these bugs is reintegrated into the development branch.

The two-part process with a development and a stable (release) branch makes life a lot easier for us, and i don't believe we could improve any part of it by introducing more branches. Each branch also has it's own build process, meaning every couple minutes a new build process is spawned and so after a code checkin we have a new executable of all build versions and branches within about half an hour.

Occassionally we also have branches for a single developer working on a new and unproved technology, or creating a proof of concept. But generally it's only done if the changes affects many parts of the codebase. This happens in average every 3-4 months and such a branch is usually reintegrated (or scrapped) within a month or two.

Generally i don't like the idea of every developer working in his own branch, because you "skip go and move directly to integration hell". I would strongly advise against it. If you have a common codebase, you should all work in it together. This makes developers more wary about their checkins, and with experience every coder knows which changes are potentially breaking the build and so testing is more rigorous in such cases.

On the check-in early question:

If you require only **PERFECT CODE** to be checked in, then actually nothing should get checked in. No code is perfect, and for the QA to verify and test it, it needs to be in the development branch so a new executable can be built.

For us that means once a feature is complete and tested by the developer it is checked in. It may even be checked in if there are known (non-fatal) bugs, but in that case the people who would be affected by the bug are usually informed. Incomplete and work-in-progress code can also be checked in but only if it doesn't cause any obvious negative effects, like crashes or breaking existing functionality.

Every now and then an unavoidable combined code & data checkin will make the program unusable until the new code has been built. The very least we do is to add a "WAIT FOR BUILD" in the check-in comment and/or send out an e-mail.

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-19T10:43:40.003

For what it's worth, this is how we do it.

Most development is performed in trunk, although experimental features or things that might break the system significantly tend to get their own branch. This works out pretty well as it means every developer always has the latest version of everything in their working copy.

It does mean that it's important to keep trunk in vaguely working order, as it's perfectly possible to completely break it. In practice that doesn't happen often, and is rarely a significant problem.

For a production release, we branch trunk, stop adding new features, and work on bugfixing and testing the branch (regularly merging back into trunk) until it's ready for release. At which point we do a final merge into trunk to make sure everything is in there, and then release.

Maintenance can then be performed on the release branch as necessary, and those fixes can be easily merged back into trunk.

I don't claim this to be a perfect system (and it still has some holes - I don't think our release management is a tight enough process yet), but it works well enough.

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-07-16T12:25:14.730

Why no one still mention this? [A successful Git branching model](http://nvie.com/posts/a-successful-git-branching-model/).

It's for me the ultimate branching model!

If you're project is small, don't use all the time all the different branches (perhaps you could skip feature branches for small features). But otherwise, it's the way to do it!

[![branching model](https://i.stack.imgur.com/3kxwJ.png)](https://i.stack.imgur.com/3kxwJ.png)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-19T11:58:51.160

Development code on branches, Live code tagged on Trunk.

There doesn't need to be a "commit only perfect code" rule - anything that the developer misses should get picked up in four places: the code review, branch testing, regression testing, final QA testing.

Here's a more detailed step-by-step explanation:

1.  Do all development on a branch, committing regularly as you go.
2.  Independent Code Review of changes once all development is complete.
3.  Then pass the branch over to Testing.
4.  Once branch testing complete, merge code into Release Candidate branch.
5.  Release Candidate branch is regression tested after each individual merge.
6.  Final QA and UA Testing performed on RC after all dev branches merged in.
7.  Once QA and UAT are passed, merge release branch into MAIN/TRUNK branch.
8.  Finally, tag the Trunk at that point, and deploy that tag to Live.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-19T09:41:04.840

dev 进入主干（svn 风格）并发布（生产代码）有自己的分支

它是“Branch-by purpose 模型”（[分支模型的重要性](http://www.accurev.com/product/docs/SCMBranchingModels1.pdf)/!\ pdf 中的图 3）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-19T09:42:29.207

我们通过将生产代码（主干）与开发代码（每个开发人员都有自己的分支）完全分离来解决这个问题。

在经过彻底检查（由 QA 和代码审查员）检查之前，不允许将任何代码用于生产代码。

这样就不会混淆哪些代码有效，它始终是主分支。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-19T11:29:57.273

Oh yes - one other thing - we keep non-production code (i.e that which will NEVER be released - e.g. tool scripts, testing utilities) in cvs HEAD. Usually it needs to be clearly marked so nobody "accidentally" releases it.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-19T17:05:05.960

We develop on trunk wich is then branched every two weeks and put into production. Only critical bugs are fixed in branch, the rest can wait another two weeks.

For trunk the only rule is that a commit shouldn't break anything. To manage wip-code and untested code we just add appropriate if statments to make it easy to toggle on and off.

Basically it whould be possible to branch trunk at any time and put it in production.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-19T09:41:11.923

我使用 git，我有 2 个分支：*master*和*maint*

*   主 - 开发代码
*   维护 - 生产代码

当我将代码发布到生产环境时，我标记它并将*master*合并到*maint*分支。*我总是从maint*分支部署。来自开发分支的补丁我将它们挑选到维护分支并部署补丁。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-19T11:28:20.427

We have a "release" branch which contains what's currently on production or will be deployed shortly (already passed most QA)

Each project, or in some cases other unit, has its own branch which is branched from release.

Changes get committed, by the developers on the project, into their project's own branch. Periodically, release is merged back into a development branch.

Once the work packages on the branch are all QA'd (unit test, system test, code review, QA review etc), the branch is merged into the release branch. The new build(s) are built from the release branch, and final validation happens on that version.

The process is basically OK until an issue is discovered after a merge has been done. If a WP gets "stuck" after it's been merged, it holds up everything after it until it's fixed (we can't do another release until the stuck one is released).

* * *

It's also somewhat flexible - a very trivial change could happen directly on the release branch if it was being released on a very short time scale (like 1-2 days or so).

If a change was put directly on to production for some reason (a critical customer-affecting production issue which required an immediate code change to fix), those changes would be put back in BRANCH_RELEASE. That hardly ever happens.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-20T16:03:02.887

It depends on the project. Our web code is checked in pretty consistently, while our application code is only checked in if it compiles. I've noticed that this is pretty similar to how we release things. Web stuff goes up whenever it can while applications hit a hard deadline. I haven't seen a loss of quality in either method though.

# c# - 无法在表中插入记录

> ID：216233
> 
> 赞同：0
> 
> 时间：2008-10-19T09:58:51.620
> 
> 标签：c#, sql, mdf

我编写了一个程序，其中包括从数据库写入和读取。当我运行应用程序并尝试执行写入时，我调用以下方法：

```
public static void AddMessage(string callID, string content)
    {
        string select =
            "INSERT INTO Sporocilo (oznaka_klica, smer, vsebina, prebrano, cas_zapisa) VALUES (@callId, 0, @content, 0, @insertTime)";
        SqlCommand cmd = new SqlCommand(select, conn);
        cmd.Parameters.AddWithValue("callId", callID.ToString());
        cmd.Parameters.AddWithValue("content", content);
        cmd.Parameters.AddWithValue("insertTime", "10.10.2008");
        try
        {
            conn.Open();
            cmd.ExecuteScalar();
        }
        catch(Exception ex)
        {
            string sDummy = ex.ToString();
        }
        finally
        {
            conn.Close();
        }
    } 
```

在方法调用之后，我从表中读取所有记录并在表单中显示它们。可以看到刷新之前插入的记录，但是当我退出应用程序并查看表格时，我看不到记录。

有谁知道什么可能导致这种行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T10:38:08.860

您是否在此之后执行提交？它可能正在运行您的语句，但随后不提交更改并进行隐式回滚。

我认为异常处理看起来很狡猾。除非你能以某种方式实际处理它，否则捕捉东西是没有意义的。框架的顶层是捕获和报告意外异常的地方。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T10:43:04.403

您是否尝试过将 ExecuteScalar 方法的返回值设置为 int，然后对照表检查值？

[执行标量](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlcommand.executescalar.aspx)-

*执行查询，并返回查询返回的结果集中第一行的第一列。其他列或行被忽略*

```
public static int AddMessage(string callID, string content)
    {
        Int32 newProdID = 0
        string select =
            "INSERT INTO Sporocilo (oznaka_klica, smer, vsebina, prebrano, cas_zapisa) VALUES (@callId, 0, @content, 0, @insertTime); SELECT CAST(scope_identity() AS int);";
        SqlCommand cmd = new SqlCommand(select, conn);
        cmd.Parameters.AddWithValue("callId", callID.ToString());
        cmd.Parameters.AddWithValue("content", content);
        cmd.Parameters.AddWithValue("insertTime", "10.10.2008");
        try
        {
            conn.Open();
            newProdID = (Int32)cmd.ExecuteScalar();
        }
        catch(Exception ex)
        {
            string sDummy = ex.ToString();
        }
        finally
        {
            conn.Close();
        }
        return (int)newProdID
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T10:43:30.767

我发现了问题。我修改了自动生成的连接字符串

> connectionString="数据源=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\URSZRDB.mdf;集成安全=True;用户实例=True"

和

> connectionString="数据源=.\SQLEXPRESS;AttachDbFilename=C:\Users\Niko\Documents\Visual Studio 2008\Projects\URSZRWAPChat\URSZRWAPChat\URSZRDB.mdf;集成安全=True;用户实例=True"

现在它可以工作了。

这不是我第一次编写这种程序，到目前为止，一切都很顺利......

# c# - LINQ、多态、元数据映射、继承映射器

> ID：216255
> 
> 赞同：0
> 
> 时间：2008-10-19T10:35:16.120
> 
> 标签：c#, linq, poeaa

我正在写一个小程序。我编写的用于控制每个存储库的接口定义了 Save(IPublicObject) 的方法。我将 LINQ 用于存储库 CRUD 的 SQL 版本。我的问题是这个。我只想有一个接受接口类型的方法。我想考虑如何最好地为我传入的继承类型找到保存操作。

在这本书中，我正在阅读企业应用程序架构的模式。我依靠继承映射。所以我创建了一个派生对象

```
public class ConcretePublicObjectOne : IPublicObject{} 
```

然后我想将它传递给存储库的保存功能。正是在这一点上，我试图思考如何最好地说，好的，我们需要使用“什么？” 保存方法等...

我应该使用注册表，映射类型的配置设置吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T14:39:04.740

对于 LINQ-to-SQL，数据上下文已经为您做了很多映射。因此，我认为泛型可能是实现保存的最佳方式，同时仍然需要考虑您的界面（尽管我不太确定在这种情况下界面为您提供了什么......）。

您可以通过以下方式访问数据上下文的通用方面`GetTable<T>()`：

```
 static void Save<T>(T item)
        where T : class, IPublicObject
    {
        using (DataContext ctx = GetDataContext())
        {
            Table<T> table = ctx.GetTable<T>();
            // for insert...
            table.InsertOnSubmit(item);
            // for update...
            table.Attach(item, true);
            // for delete...
            table.DeleteOnSubmit(item);

            ctx.SubmitChanges();

        }
    } 
```

请注意，类型推断应该意味着您不需要`T`在保存时指定：

```
 Foo foo = new Foo();
    Save(foo); // <Foo> is inferred 
```

这有什么用吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T12:55:37.600

你想要做的是有一个：

```
Repository.Save(publicObject) 
```

以及从 publicObject 调用方法的存储库？

如果这是要求，那么您可以将存储库中的 Save 方法定义为：

```
public class Repository {
    public void Save(IPublicObject publicObject) {
        publicObject.Save();
    }
} 
```

其中 IPublicObject 定义为：

```
public interface IPublicObject {
    void Save();
} 
```

但是使用这种方法，您必须为每个实体定义一个保存方法（例如您的示例中的 ConcretePublicObjectOne）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T07:44:11.850

马克·格拉维尔：

感谢那。正如我所说，尽管我认为使用您的示例我将不得不保留从数据上下文中获得的模型，这种模型将我绑定到 LINQ。

你所做的正是我正在寻找的那种东西。它根据对象找到类型，然后知道要提交哪个操作。使用您的示例，我可以使用匿名类型将转换应用于我的模型以使用该 linq 代码。我有不同的存储 mdeiums，你会看到我需要模型来全面处理。这些模型是自包含的，对它们之外的任何东西一无所知，哈哈。

# c++ - C++ 中是否有最大数组长度限制？

> ID：216259
> 
> 赞同：198
> 
> 时间：2008-10-19T10:39:11.103
> 
> 标签：c++, arrays

C++ 中的数组有最大长度吗？

它是 C++ 限制还是取决于我的机器？可以调整吗？它是否取决于数组的类型？

我可以以某种方式打破这个限制，还是我必须寻找更好的信息存储方式？什么应该是最简单的方法？

我要做的是将 long long int 存储在一个数组上，我在 Linux 环境中工作。我的问题是：如果我需要存储一个 N > 10 位的长整数数组，我该怎么办？

我需要这个，因为我正在为学校编写一些密码算法（例如 p-Pollard），并且遇到了整数和数组长度表示的这堵墙。

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2008-10-19T17:52:43.883

**没有人提到堆栈帧**大小的限制。

有两个地方可以分配内存：

*   在堆上（动态分配的内存）。
    这里的大小限制是可用硬件和操作系统通过使用其他设备来临时存储未使用数据（即将页面移动到硬盘）来模拟空间的能力的**组合**。
*   在堆栈上（本地声明的变量）。
    这里的大小限制是编译器定义的（可能有硬件限制）。如果您阅读编译器文档，您通常可以调整此大小。

因此，如果您动态分配一个数组（限制很大，其他帖子有详细描述。

```
int* a1 = new int[SIZE];  // SIZE limited only by OS/Hardware 
```

或者，如果数组是在堆栈上分配的，那么您会受到堆栈帧大小的限制。**NB**向量和其他容器在堆栈中的存在很小，但通常大部分数据将在堆上。

```
int a2[SIZE]; // SIZE limited by COMPILER to the size of the stack frame 
```

* * *

## 回答 #2

> 赞同：173
> 
> 时间：2008-10-19T10:44:37.880

有两个限制，都不是由 C++ 强制执行的，而是由硬件强制执行的。

第一个限制（永远不应达到）由用于描述数组中索引的大小类型（及其大小）的限制设置。`std::size_t`它由系统可以采用的最大值给出。此数据类型足够大，可以包含任何对象的字节大小

另一个限制是物理内存限制。数组中的对象越大，越早达到此限制，因为内存已满。例如，`vector<int>`给定大小*n*的 a通常占用的内存是类型数组的数倍`vector<char>`（减去一个小的常量值），因为`int`它通常大于`char`。因此，在内存已满之前，a`vector<char>`可能包含比 a 更多的项目。`vector<int>`原始 C 样式数组（如`int[]`和）也同样适用`char[]`。

此外，这个上限可能会受到`allocator`用于构造的类型的影响，`vector`因为 an`allocator`可以自由地以任何它想要的方式管理内存。一个非常奇怪但仍然可以想象的分配器可以以对象的相同实例共享资源的方式共享内存。这样，您可以将大量相同的对象插入到容器中，否则会耗尽所有可用内存。

除此之外，C++ 不强制执行任何限制。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-19T11:54:22.667

从实际而非理论的角度来看，在 32 位 Windows 系统上，单个进程可用的最大内存总量为 2 GB。您可以通过使用具有更多物理内存的 64 位操作系统来打破限制，但是否这样做或寻找替代方案在很大程度上取决于您的目标用户及其预算。您还可以使用[PAE](http://en.wikipedia.org/wiki/Physical_Address_Extension)对其进行一些扩展。

数组的类型非常重要，因为许多编译器的默认结构对齐是 8 字节，如果内存使用是一个问题，这是非常浪费的。如果您使用 Visual C++ 以 Windows 为目标，请查看[#pragma pack](http://msdn.microsoft.com/en-us/library/2e70t5y1%28VS.80%29.aspx)指令作为克服此问题的方法。

要做的另一件事是查看内存压缩技术可能对您有什么帮助，例如稀疏矩阵、动态压缩等……这又是高度依赖于应用程序的。如果您编辑帖子以提供有关数组中实际内容的更多信息，您可能会得到更多有用的答案。

编辑：鉴于您的确切要求的更多信息，您的存储需求似乎在 7.6 GB 和 76 GB 之间未压缩，这将需要一个相当昂贵的 64 位框在 C++ 中作为数组存储在内存中。它提出了一个问题，为什么要将数据存储在内存中，人们假设访问速度并允许随机访问。将此数据存储在数组之外的最佳方式几乎取决于您希望如何访问它。如果您需要随机访问数组成员，对于大多数应用程序来说，往往有一些方法可以对往往同时访问的数据块进行分组。例如，在大型 GIS 和空间数据库中，数据通常按地理区域平铺。在 C++ 编程术语中，您可以覆盖 [] 数组运算符以根据需要从外部存储中获取部分数据。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-09-27T20:28:21.097

与当前所有答案一样烦人的非特定性，它们大多是正确的，但有许多警告，并不总是被提及。要点是，您有两个上限，其中只有一个是实际定义的，所以[YMMV](https://en.wiktionary.org/wiki/your_mileage_may_vary#Phrase)：

### 1\. 编译时间限制

基本上，您的编译器将允许什么。对于 x64 Windows 10 机器上的 Visual C++ 2017，这是我在产生 2GB 限制之前在编译时的最大限制，

```
unsigned __int64 max_ints[255999996]{0}; 
```

如果我这样做，

```
unsigned __int64 max_ints[255999997]{0}; 
```

我会得到：

> `Error C1126 automatic allocation exceeds 2G`

我不确定 2G 与`255999996`/的关系如何`7`。我用谷歌搜索了这两个数字，我能找到的唯一可能相关的是这个 *nix Q&A[关于`dc`](https://unix.stackexchange.com/a/456797/108615). 无论哪种方式，您尝试填充哪种类型的 int 数组似乎都无关紧要，可以分配多少元素。

### 2\. 运行时间限制

您的堆栈和堆有其自身的局限性。这些限制都是根据可用系统资源以及应用程序本身的“重量”程度而变化的值。例如，使用我当前的系统资源，我可以让它运行：

```
int main()
{
    int max_ints[257400]{ 0 };
    return 0;
} 
```

但如果我稍微调整一下...

```
int main()
{
    int max_ints[257500]{ 0 };
    return 0;
} 
```

砰！堆栈溢出！

> `Exception thrown at 0x00007FF7DC6B1B38 in memchk.exe: 0xC00000FD:` `Stack overflow (parameters: 0x0000000000000001, 0x000000AA8DE03000).` `Unhandled exception at 0x00007FF7DC6B1B38 in memchk.exe: 0xC00000FD:` `Stack overflow (parameters: 0x0000000000000001, 0x000000AA8DE03000).`

只是为了详细说明您的应用程序点的全部重量，这很好：

```
int main()
{
    int maxish_ints[257000]{ 0 };
    int more_ints[400]{ 0 };
    return 0;
} 
```

但这导致了堆栈溢出：

```
int main()
{
    int maxish_ints[257000]{ 0 };
    int more_ints[500]{ 0 };
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-19T10:49:57.617

我同意上述观点，如果你用

```
 int myArray[SIZE] 
```

那么 SIZE 受限于整数的大小。但是你总是可以 malloc 一块内存并有一个指向它的指针，只要 malloc 不返回 NULL 就可以。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-05-16T06:57:37.507

总结答案，扩展它们，并直接回答您的问题：

*不，C++ 不对数组的**维度施加任何限制。***

但是由于数组必须存储在内存中的某个位置，因此计算机系统的其他部分施加的与内存相关的限制也适用。**请注意，这些限制与数组的维度**（=元素数量）没有直接关系，而是与其**大小**（=占用的内存量）有关。数组的维度 ( **D** ) 和内存大小 ( **S ) 不同，因为它们与单个元素 (** **E** ) 占用的内存相关：**S** = **D** * **E**。

现在**E**取决于：

*   数组元素的类型（元素可以更小或更大）
*   内存对齐（为了提高性能，将元素放置在某个值的倍数的地址处，这会
    在元素之间引入“浪费空间”（填充）
*   对象静态部分的大小（在面向对象编程中，相同类型对象的静态组件只存储一次，与此类相同类型对象的数量无关）

另请注意，通过在堆栈（作为自动变量`int t[N]`：）或堆（使用`malloc()`/`new`或使用 STL 机制的动态分配）或进程内存的静态部分（如一个静态变量：）`static int t[N]`。即使在堆上分配，您仍然需要堆栈上的少量内存来存储对堆分配的内存块的引用（但这通常可以忽略不计）。

类型的大小对`size_t`程序员没有影响（我假设程序员使用`size_t`类型进行索引，因为它是为它设计的），因为编译器提供者必须将`typedef`其设置为足够大的整数类型，以解决给定平台可能的最大内存量建筑学。

内存大小限制的来源源于

*   进程可用的内存量（对于 32 位应用程序，限制为 2^32 字节，即使在 64 位操作系统内核上也是如此），
*   进程内存的划分（例如，为堆栈或堆设计的进程内存量），
*   物理内存的碎片化（许多分散的小空闲内存碎片不适用于存储一个整体结构），
*   物理内存量，
*   和虚拟内存的数量。

它们不能在应用程序级别“调整”，但您可以自由使用不同的编译器（更改堆栈大小限制），或将您的应用程序移植到 64 位，或将其移植到另一个操作系统，或更改物理/ （虚拟？物理？）机器的虚拟内存配置。

将上述所有因素视为外部干扰并因此视为运行时错误的可能来源，并仔细检查程序代码中与内存分配相关的错误并做出反应并不少见（甚至是可取的）。

*所以最后：虽然 C++ 没有施加任何限制，但在运行代码时，您仍然必须检查与内存相关的不利条件...... :-)*

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-08-08T20:38:02.863

正如许多出色的答案所指出的那样，有很多限制取决于您的 C++ 编译器版本、操作系统和计算机特性。但是，我建议在 Python 上使用以下脚本来检查您机器上的限制。

它使用二进制搜索，并在每次迭代时通过创建尝试创建大小数组的代码来检查中间大小是否可能。该脚本尝试编译它（对不起，这部分仅适用于Linux）并根据成功调整二进制搜索。看看这个：

```
import os

cpp_source = 'int a[{}]; int main() {{ return 0; }}'

def check_if_array_size_compiles(size):
        #  Write to file 1.cpp
        f = open(name='1.cpp', mode='w')
        f.write(cpp_source.format(m))
        f.close()
        #  Attempt to compile
        os.system('g++ 1.cpp 2> errors')
        #  Read the errors files
        errors = open('errors', 'r').read()
        #  Return if there is no errors
        return len(errors) == 0

#  Make a binary search. Try to create array with size m and
#  adjust the r and l border depending on wheather we succeeded
#  or not
l = 0
r = 10 ** 50
while r - l > 1:
        m = (r + l) // 2
        if check_if_array_size_compiles(m):
                l = m
        else:
                r = m

answer = l + check_if_array_size_compiles(r)
print '{} is the maximum avaliable length'.format(answer) 
```

您可以将其保存到您的机器并启动它，它将打印您可以创建的最大尺寸。对于我的机器，它是 2305843009213693951。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-03-10T23:37:49.100

我很惊讶这里没有提到[std::vector的](https://en.cppreference.com/w/cpp/container/vector)[max_size()](https://en.cppreference.com/w/cpp/container/vector/max_size)成员函数。

> *“返回容器由于系统或库实现限制而能够容纳的最大元素数，即最大容器的 std::distance(begin(), end())。”*

我们知道这`std::vector`是作为引擎盖下的动态数组实现的，因此`max_size()`应该非常接近机器上***动态***数组的最大长度的近似值。

以下程序为各种数据类型构建了一个近似最大数组长度的表。

```
#include <iostream>
#include <vector>
#include <string>
#include <limits>

template <typename T>
std::string mx(T e) {
    std::vector<T> v;
    return std::to_string(v.max_size());
}

std::size_t maxColWidth(std::vector<std::string> v) {
    std::size_t maxWidth = 0;

    for (const auto &s: v)
        if (s.length() > maxWidth)
            maxWidth = s.length();

    // Add 2 for space on each side
    return maxWidth + 2;
}

constexpr long double maxStdSize_t = std::numeric_limits<std::size_t>::max();

// cs stands for compared to std::size_t
template <typename T>
std::string cs(T e) {
    std::vector<T> v;
    long double maxSize = v.max_size();
    long double quotient = maxStdSize_t / maxSize;
    return std::to_string(quotient);
}

int main() {
    bool v0 = 0;
    char v1 = 0;

    int8_t v2 = 0;
    int16_t v3 = 0;
    int32_t v4 = 0;
    int64_t v5 = 0;

    uint8_t v6 = 0;
    uint16_t v7 = 0;
    uint32_t v8 = 0;
    uint64_t v9 = 0;

    std::size_t v10 = 0;
    double v11 = 0;
    long double v12 = 0;

    std::vector<std::string> types = {"data types", "bool", "char", "int8_t", "int16_t",
                                      "int32_t", "int64_t", "uint8_t", "uint16_t",
                                      "uint32_t", "uint64_t", "size_t", "double",
                                      "long double"};

    std::vector<std::string> sizes = {"approx max array length", mx(v0), mx(v1), mx(v2),
                                      mx(v3), mx(v4), mx(v5), mx(v6), mx(v7), mx(v8),
                                      mx(v9), mx(v10), mx(v11), mx(v12)};

    std::vector<std::string> quotients = {"max std::size_t / max array size", cs(v0),
                                          cs(v1), cs(v2), cs(v3), cs(v4), cs(v5), cs(v6),
                                          cs(v7), cs(v8), cs(v9), cs(v10), cs(v11), cs(v12)};

    std::size_t max1 = maxColWidth(types);
    std::size_t max2 = maxColWidth(sizes);
    std::size_t max3 = maxColWidth(quotients);

    for (std::size_t i = 0; i < types.size(); ++i) {
        while (types[i].length() < (max1 - 1)) {
            types[i] = " " + types[i];
        }

        types[i] += " ";

        for  (int j = 0; sizes[i].length() < max2; ++j)
            sizes[i] = (j % 2 == 0) ? " " + sizes[i] : sizes[i] + " ";

        for  (int j = 0; quotients[i].length() < max3; ++j)
            quotients[i] = (j % 2 == 0) ? " " + quotients[i] : quotients[i] + " ";

        std::cout << "|" << types[i] << "|" << sizes[i] << "|" << quotients[i] << "|\n";
    }

    std::cout << std::endl;

    std::cout << "N.B. max std::size_t is: " <<
        std::numeric_limits<std::size_t>::max() << std::endl;

    return 0;
} 
```

在我的 macOS（clang 版本 5.0.1）上，我得到以下信息：

```
|  data types | approx max array length | max std::size_t / max array size |
|        bool |   9223372036854775807   |             2.000000             |
|        char |   9223372036854775807   |             2.000000             |
|      int8_t |   9223372036854775807   |             2.000000             |
|     int16_t |   9223372036854775807   |             2.000000             |
|     int32_t |   4611686018427387903   |             4.000000             |
|     int64_t |   2305843009213693951   |             8.000000             |
|     uint8_t |   9223372036854775807   |             2.000000             |
|    uint16_t |   9223372036854775807   |             2.000000             |
|    uint32_t |   4611686018427387903   |             4.000000             |
|    uint64_t |   2305843009213693951   |             8.000000             |
|      size_t |   2305843009213693951   |             8.000000             |
|      double |   2305843009213693951   |             8.000000             |
| long double |   1152921504606846975   |             16.000000            |

N.B. max std::size_t is: 18446744073709551615 
```

在[ideone gcc 8.3](https://ideone.com/18i7M5)上，我得到：

```
|  data types | approx max array length | max std::size_t / max array size |
|        bool |   9223372036854775744   |             2.000000             |
|        char |   18446744073709551615  |             1.000000             |
|      int8_t |   18446744073709551615  |             1.000000             |
|     int16_t |   9223372036854775807   |             2.000000             |
|     int32_t |   4611686018427387903   |             4.000000             |
|     int64_t |   2305843009213693951   |             8.000000             |
|     uint8_t |   18446744073709551615  |             1.000000             |
|    uint16_t |   9223372036854775807   |             2.000000             |
|    uint32_t |   4611686018427387903   |             4.000000             |
|    uint64_t |   2305843009213693951   |             8.000000             |
|      size_t |   2305843009213693951   |             8.000000             |
|      double |   2305843009213693951   |             8.000000             |
| long double |   1152921504606846975   |             16.000000            |

N.B. max std::size_t is: 18446744073709551615 
```

应该注意的是，这是一个理论上的限制，在大多数计算机上，在达到这个限制之前，你的内存就会用完。例如，我们看到对于 type `char`on `gcc`，最大元素数等于 的最大值`std::size_t`。尝试[这个](https://ideone.com/bbm3DA)，我们得到错误：

```
prog.cpp: In function ‘int main()’:
prog.cpp:5:61: error: size of array is too large
  char* a1 = new char[std::numeric_limits<std::size_t>::max()]; 
```

最后，正如@MartinYork 指出的那样，对于静态数组，最大大小受堆栈大小的限制。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-19T12:14:47.337

我认为之前的答案中没有提到一件事。

当人们在他们的设计中使用这些东西时，我总是感觉到重构意义上的“难闻的气味”。

这是一个庞大的数组，从效率和性能的角度来看，这可能不是表示数据的最佳方式。

干杯，

抢

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-12-18T22:43:29.387

如果您必须处理如此大的数据，则需要将其拆分为可管理的块。它不会全部放入任何小型计算机的内存中。您可能可以从磁盘加载一部分数据（任何合理的数据），执行计算和更改，将其存储到磁盘，然后重复直到完成。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-19T17:47:49.807

正如已经指出的那样，数组大小受您的硬件和操作系统（man ulimit）的限制。但是，您的软件可能仅受您的创造力的限制。例如，您可以将“阵列”存储在磁盘上吗？你真的需要很长很长的整数吗？你真的需要一个密集的数组吗？你甚至需要一个数组吗？

一种简单的解决方案是使用 64 位 Linux。即使您的阵列在物理上没有足够的内存，操作系统也会允许您像分配内存一样分配内存，因为您的进程可用的虚拟内存可能比物理内存大得多。如果您确实需要访问阵列中的所有内容，这相当于将其存储在磁盘上。根据您的访问模式，可能有更有效的方法来执行此操作（即：使用 mmap()，或简单地将数据顺序存储在文件中（在这种情况下，32 位 Linux 就足够了））。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-10-25T01:17:00.597

我会通过制作一个二维动态数组来解决这个问题：

```
long long** a = new long long*[x];
for (unsigned i = 0; i < x; i++) a[i] = new long long[y]; 
```

更多关于这里[https://stackoverflow.com/a/936702/3517001](https://stackoverflow.com/a/936702/3517001)

# c# - TryParse：什么更具可读性？

> ID：216278
> 
> 赞同：0
> 
> 时间：2008-10-19T11:06:50.767
> 
> 标签：c#

外出风格：

```
bool result;
if(something.TryParse(val, out result))
{
    DoSomething(result);
} 
```

可空样式：

```
bool? result = something.TryParse2(val);
if(result.HasValue)
{
    DoSomething(result.Value);
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-19T11:13:41.127

TryParse(val, out result) 是.NET框架在int.TryParse、DateTime.TryParse等中建立的成语，想必看过代码的人都会对这个成语不陌生，所以还是要坚持下去，除非你找到一个很好的理由不这样做。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-19T20:00:46.793

我并不是要不友善。但是，当您提议更改一个成熟的习惯用法时，如果您的示例代码不正确，就会破坏信心。

您的第一个示例应该是：

```
something result;
if (something.TryParse(val, out result))
{
   DoSomething(result);
} 
```

或者：

```
bool result;
if (bool.TryParse(value, out result))
{
    DoSomething(result);
} 
```

您的第二个示例应该是：

```
Nullable<something> result = something.TryParse2(val);
if(result.HasValue)
{
    DoSomething(result.Value);
} 
```

或者：

```
bool? result = bool.TryParse2(val);
if (result.HasValue)
{
   DoSomething(result);
} 
```

如果我要为执行您似乎所做的每个值类型实现一个扩展方法*，*`TryParse2`我不会调用它`TryParse2`。现在，如果方法的名称以 开头`Try`，我们希望它返回一个`bool`指示它是成功还是失败的值。创建这种新方法会创建一个期望不再有效的世界。在你驳回这一点之前，想想当你编写不起作用的示例代码时你的想法是什么，以及为什么你如此确定它`result`需要成为一个`bool`.

关于您的提案的另一件事是，它似乎试图解决错误的问题。如果我发现自己写了很多`TryParse`块，我要问的第一个问题不是“我怎样才能用更少的代码行来做到这一点？” 我会问，“为什么我的应用程序中散布着解析代码？” `TryParse`当我复制所有代码时，我的第一直觉是为我真正想要做的事情提出更高级别的抽象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T11:12:27.697

我认为总体而言，样式更具可读性。人们不太熟悉可空类型（只需在此处查看有关它们的问题数量），而且他们对标准库中不存在的 TryParse2 （或者在技术上在 .NET 中调用）更不熟悉。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T11:10:45.597

我可能会使用第二个例子。虽然我认为两者都是完全可以接受的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T11:20:55.763

可空类型具有同一类型的不可为空的 Value 属性。这是您不需要转换可空类型而是使用可空类型的值的地方。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T11:58:26.403

我已经看到了许多应用程序中使用的 out 变量语法。

我个人也很喜欢。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T16:52:23.210

我更喜欢第二个例子，因为它是一种对类型推断更友好的编程风格。拥有 out 参数可防止开发人员对特定调用使用类型推断。

```
 var result = Int32.TryParse("123"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T06:42:05.687

我发现这两个例子都很笨拙。

我会选择 ，`TryParse`因为它是 .NET Framework 中已经存在的习语。

# java - 方向向量的旋转矩阵

> ID：216294
> 
> 赞同：4
> 
> 时间：2008-10-19T11:19:23.520
> 
> 标签：java, math, vector

我已经在互联网上玩了一段时间的一些算法，但我似乎无法让它们工作，所以我在这里抛出这个问题；

我正在尝试从一个点渲染速度矢量线。画线并不困难：只需`velocity.length`在图中插入一条带长度的线。这使线以 y 轴方向的点为中心。我们现在需要在适当的旋转和平移中得到它。

平移向量不难计算：它是速度向量的一半。然而，旋转矩阵对我来说非常难以捉摸。给定一个方向向量`<x, y, z>`，我需要什么矩阵？

**编辑1：**看；如果你不明白这个问题，你可能无法给我答案。

这是我目前拥有的：

```
                    Vector3f 翻译 = 新 Vector3f();
                    平移.scale(1f/2f, body.velocity);

                    Vector3f vec_z = (Vector3f) body.velocity.clone();
                    vec_z.normalize();

                    Vector3f vec_y; // 参考向量，稍后会更正
                    如果（vec_z.x == 0 && vec_z.z == 0）{
                        vec_y = new Vector3f(-vec_z.y, 0f, 0f); // 可以优化
                    } 别的 {
                        vec_y = new Vector3f(0f, 1f, 0f);
                    }
                    Vector3f vec_x = new Vector3f();
                    vec_x.cross(vec_y, vec_z);
                    vec_z.normalize();

                    vec_y.cross(vec_x, vec_z);
                    vec_y.normalize();
                    vec_y.negate();

                    Matrix3f 旋转 = 新 Matrix3f(
                        vec_z.z, vec_z.x, vec_z.y,
                        vec_x.z, vec_x.x, vec_x.y,
                        vec_y.z、vec_y.x、vec_y.y
                    );

                    arrowTransform3D.set（旋转，平移，1f）；
```

根据[这篇文章](http://www.gamedev.net/reference/articles/article665.asp)。是的，我已经尝试过标准旋转矩阵（vec_x.x、vec_y.x 等）但没有奏效。我一直在旋转列和行以查看是否有任何效果。

**编辑2：**

对我评论的粗鲁措辞表示歉意。

So it looks like there were a combination of two errors; one of which House MD pointed out (really bad naming of variables: `vec_z` was actually `vec_y`, and so on), and the other was that I needed to invert the matrix before passing it off to the rendering engine (transposing was close!). So the modified code is:

```
                    Vector3f vec_y = (Vector3f) body.velocity.clone();
                    vec_y.normalize();

                    Vector3f vec_x; // reference vector, will correct later
                    if (vec_y.x == 0 && vec_y.z == 0) {
                        vec_x = new Vector3f(-vec_y.y, 0f, 0f); // could be optimized
                    } else {
                        vec_x = new Vector3f(0f, 1f, 0f);
                    }

                    Vector3f vec_z = new Vector3f();
                    vec_z.cross(vec_x, vec_y);
                    vec_z.normalize();

                    vec_x.cross(vec_z, vec_y);
                    vec_x.normalize();
                    vec_x.negate();

                    Matrix3f rotation = new Matrix3f(
                        vec_x.x, vec_x.y, vec_x.z,
                        vec_y.x, vec_y.y, vec_y.z,
                        vec_z.x, vec_z.y, vec_z.z
                    );
                    rotation.invert();
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T11:25:05.487

[This](http://mathworld.wolfram.com/RotationMatrix.html) should do you

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T11:52:20.707

[Dupe.](https://stackoverflow.com/questions/193918/what-is-the-easiest-way-to-align-the-z-axis-with-a-vector)

> The question there involves getting a rotation to a certain axis, whereas I'm concerned with getting a rotation matrix.

Gee, I wonder if you could turn [convert one to the other](http://www.google.com/search?q=angle+axis+rotation+to+matrix)?

BTW, your current solution of picking an arbitrary y axis and then reorthogonalising should work fine; it looks bugged though, or at least badly written. '`z_vec`' is not a good variable-name for the y-axis. What's with the 'z,x,y' ordering, anyway?

If it still doesn't work, try making random changes until it does - transpose the matrix, negate vectors until you have an even number of sign errors, that kind of thing.

Also your tone of voice comes across as sort-of rude, given that you're asking strangers to spend their time helping you.

# .net - 如何在 .NET 1.1 中压缩文件

> ID：216313
> 
> 赞同：0
> 
> 时间：2008-10-19T11:44:16.447
> 
> 标签：.net, compression

我需要在 .NET 1.1 中以 [*.zip] 格式压缩文件。我不想使用 SharpZip 进行压缩，因为在 .NET 1.1 中运行时出现随机错误“拒绝访问”。

只有当我将程序集放在 GAC 上时，SharptZip 才能正常工作——这在我的项目中不是一个选项。这就是问题。检查这个：[http ://forums.asp.net/p/1139901/1839049.aspx#1839049](http://forums.asp.net/p/1139901/1839049.aspx#1839049)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T13:18:58.163

您可以使用 zip 的命令行工具。例如[7-Zip](http://www.7-zip.org/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T13:20:21.483

您可以获取[zlib](http://www.zlib.net) dll 并使用 .NET 互操作来调用压缩函数（如果我没记错的话，您可以只使用 2 个调用，一个用于库初始化，一个用于压缩数据）。请注意，如果您使用 32 位 zlib dll，您将在 64 位架构上运行问题，反之亦然。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T16:24:51.850

你需要升级！.NET 1.1 现在已经 6 岁了！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-26T10:05:59.153

如果您可以选择使用 J#.Net 库，您应该能够使用其中包含的 java zip api。

[这](http://www.codeproject.com/Articles/18495/Simple-Application-to-Zip-and-UnZip-files-in-C-usi)是一个示例代码。

# java - 检测Webstart是否启动应用程序的最佳方法是什么

> ID：216315
> 
> 赞同：13
> 
> 时间：2008-10-19T11:47:34.180
> 
> 标签：java, java-web-start

正如我在[最近的问题](https://stackoverflow.com/questions/212009/do-i-have-to-explicitly-call-systemexit-in-a-webstart-application)中明确指出的那样，Swing 应用程序在使用 Sun Webstart 启动器运行时需要显式调用 System.exit()（至少从 Java SE 6 开始）。

我想尽可能地限制这种黑客攻击，我正在寻找一种可靠的方法来检测应用程序是否在 Webstart 下运行。现在我正在检查系统属性“webstart.version”的值是否不为空，但我在文档中找不到任何保证该属性应该由未来版本/替代实现设置。

有没有更好的方法（最好是那些不依赖于 webstart API 的方法？）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2013-04-24T19:40:30.617

当您的代码通过 javaws 启动时，会加载 javaws.jar 并且您不想依赖的 JNLP API 类可用。您可以查看 JNLP API 类是否存在，而不是测试不保证存在的系统属性：

```
private boolean isRunningJavaWebStart() {
    boolean hasJNLP = false;
    try {
      Class.forName("javax.jnlp.ServiceManager");
      hasJNLP = true;
    } catch (ClassNotFoundException ex) {
      hasJNLP = false;
    }
    return hasJNLP;
} 
```

这也避免了在编译时需要在类路径中包含 javaws.jar。

或者，您可以切换到使用 javaws.jar 编译并捕获 NoClassDefFoundError ：

```
private boolean isRunningJavaWebStart() {
    try {
        ServiceManager.getServiceNames();
        return ds != null;
    } catch (NoClassDefFoundError e) {
        return false;
    }
} 
```

使用 ServiceManager.lookup(String) 和 UnavailableServiceException 很麻烦，因为它们都是 JNLP API 的一部分。ServiceManager.getServiceNames() 没有记录到抛出。我们专门调用此代码来检查 NoClassDefFoundError。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-19T12:08:25.557

使用 javax.jnlp.ServiceManager 检索 webstart 服务。如果它可用，则您正在 Webstart 下运行。

见[http://download.java.net/jdk7/docs/jre/api/javaws/jnlp/index.html](http://download.java.net/jdk7/docs/jre/api/javaws/jnlp/index.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-19T13:13:56.037

正如您所提到的，如下检查 System 属性可能是最干净的方法：

```
private boolean isRunningJavaWebStart() {
    return System.getProperty("javawebstart.version", null) != null;
} 
```

在生产系统中，我多年来一直使用上述技术。

您还可以尝试检查是否有任何以“jnlpx”开头的属性。但据我所知，这些都不是真正“保证”在那里的。

另一种方法是尝试实例化 Tom 建议的 DownloadService：

```
private boolean isRunningJavaWebStart() {
    try {
        DownloadService ds = (DownloadService) ServiceManager.lookup("javax.jnlp.DownloadService");
        return ds != null;
    } catch (UnavailableServiceException e) {
        return false;
    }
} 
```

当然，这确实有将您的代码耦合到该 API 的缺点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-19T13:38:12.977

除了几年前看它之外，我对 Java web start 没有真正的经验。

当应用程序通过 Java web start 启动时，如何使用您定义的参数启动您的应用程序。

如果您想将参数传递给您的应用程序，您必须使用或元素将它们添加到启动文件（也称为 JNLP 描述符）中。

然后检查是否设置了这些属性。

同样，这是一个我没有为 JWS 编码的建议，它可能并不容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-09T08:36:33.640

您可以检查当前的类加载器是 com.sun.jnlp.JNLPClassLoader（Java 插件 1）还是 sun.plugin2.applet.JNLP2ClassLoader（Java 插件 2）的实例。尽管有“applet”包，使用 JNLP 和 Java 插件 2 的小程序使用另一个类加载器 sun.plugin2.applet.Applet2ClassLoader。它也适用于 OpenJDK。

# php - 在用户生成的 SQL 正则表达式中避免 SQL 注入

> ID：216324
> 
> 赞同：3
> 
> 时间：2008-10-19T11:56:48.730
> 
> 标签：php, mysql, regex, sql-injection

我正在创建一个站点，不幸的是，用户必须提供一个正则表达式才能在 MySQL WHERE 子句中使用。当然，我必须验证用户输入以防止 SQL 注入。该网站是用 PHP 制作的，我使用以下正则表达式来检查我的正则表达式：

```
/^([^\\\\\']|\\\.)*$/ 
```

由于 PHP 处理正则表达式的方式，这是双重转义的。它应该工作的方式是只匹配安全的正则表达式，没有未转义的单引号。但是主要是自学成才，我想知道这是否是一种安全的方法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-19T14:03:33.847

如果使用预处理语句，SQL 注入将是不可能的。您应该始终使用准备好的语句。

尽管关于昂贵的正则表达式，Roborg 提出了一个很好的观点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T12:09:20.780

您应该只通过[mysql_escape_string](http://www.php.net/mysql_escape_string)或[mysql_real_escape_string](http://www.php.net/mysql_real_escape_string)传递字符串。

不过，我会警惕接受任何旧的正则表达式——其中一些可以运行很长时间，并且会占用你的数据库服务器。

从[模式语法](http://us2.php.net/manual/en/regexp.reference.php)：

> 当心包含嵌套不定重复的模式。当应用于不匹配的字符串时，这些可能需要很长时间才能运行。考虑模式片段 (a+)*
> 
> 这可以以 33 种不同的方式匹配“aaaa”，并且随着字符串变长，这个数字会迅速增加。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-19T12:08:22.170

如果只是为了显示这个 reg 表达式，那么大多数程序只是对值进行 Html 编码并存储在数据库中，然后在输出时解码。再次仅用于显示目的，如果您需要使用提交的 reg exp，这将不起作用。

还知道有一种方法，意图注入的人在那里写出 SQL，将其转换为 varbinary 并提交带有我过去遇到过的查询的 base 64 表示形式的 exec 命令。

# sql - 数据库抽象 - 支持多种语法

> ID：216329
> 
> 赞同：1
> 
> 时间：2008-10-19T12:00:47.913
> 
> 标签：sql, database, data-access-layer, database-abstraction

在我正在处理的一个 PHP 项目中，我们需要创建一些 DAL 扩展来支持多个数据库平台。我们遇到的主要缺陷是不同的平台有不同的语法——值得注意的是 MySQL 和 MSSQL 完全不同。

## 什么是最好的解决方案？

以下是我们讨论过的一对：

**基于类的 SQL 构建**

这将涉及创建一个允许您逐位构建 SQL 查询的类。例如：

```
$stmt = new SQL_Stmt('mysql');
$stmt->set_type('select');
$stmt->set_columns('*');
$stmt->set_where(array('id' => 4));
$stmt->set_order('id', 'desc');
$stmt->set_limit(0, 30);
$stmt->exec(); 
```

但是，对于单个查询，它确实涉及很多行。

**SQL 语法重新格式化**

这个选项更简洁——它会读取 SQL 代码并根据输入和输出语言重新格式化它。然而，就解析而言，我可以看到这是一个慢得多的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T12:27:04.817

一种解决方案可能是针对不同平台使用不同的查询集，其 ID 类似于

MySql: GET_USERS = "SELECT * FROM users"

MsSql: GET_USERS = ...

PgSql：GET_USERS = ...

然后在启动时加载所需的查询集并引用

Db::loadQueries(平台):

$users = $db->query(GET_USERS)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T12:39:47.083

这样的方案不会考虑 SQL 提供的所有丰富性，因此最好为每个 DB 的所有表使用代码生成的存储过程。

即使您使用更多数据库模型感知的参数化存储过程（即它们可以连接或感知用户，因此针对每个供应商进行了优化），这仍然是一个很好的方法。我总是将数据库接口层视为向应用程序提供的不仅仅是简单的表，因为这种方法可能会占用大量带宽并且浪费往返。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-19T15:16:34.243

我推荐基于类的 SQL 构建并推荐[Doctrine](http://phpdoctrine.org/)、[Zend_Db](http://framework.zend.com/manual/en/zend.db.html)或[MDB2](http://pear.php.net/package/MDB2)。是的，如果它需要更多的行来编写简单的选择，但至少你可以依赖解析器并且不需要重新发明轮子。

使用任何 DBAL 都需要在速度上进行权衡，而不仅仅是数据库执行，而且您第一次使用其中任何一个时都会比您真正熟悉它时更加痛苦。此外，我几乎 100% 确定生成的代码不是最快的 SQL 查询，但这是我之前所说的权衡。

最后，这取决于您，所以即使我不会这样做，而且这肯定不是不可能的，问题仍然存在，您是否可以通过实施自己的 DBAL 来真正节省时间和资源（从长远来看）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T15:24:43.713

如果您有一组支持它的后端，我同意生成存储过程以形成合同是最好的方法。但是，如果您的后端在存储过程方面的能力有限，则这种方法不起作用，在这种情况下，您构建一个抽象层来实现 SQL 或基于抽象/有限的 sql 语法生成目标特定的 sql。

# c# - Html.ActionLink<> 智能感知问题

> ID：216333
> 
> 赞同：2
> 
> 时间：2008-10-19T12:05:38.060
> 
> 标签：c#, asp.net-mvc, intellisense

例如，当我在键入后使用任何其他强类型 HTML 助手时

```
Html.Actionlink<HomeController>(x=>x. 
```

这会在 HomeController 类具有的方法上弹出智能感知。但是对于上面的示例，这不会发生。只有在插入链接文本（第二个参数）并返回到 lambda 表达式之后，智能感知才能工作。

其他人是否遇到这些问题？

**更新** 此问题仍在 ASP.NET MVC RC 中

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T16:30:56.903

您可能会忘记控制器类型泛型参数：

```
Html.Actionlink<YourControllerType>(x=>x. 
```

这里需要控制器类型，因为视图不耦合到控制器。视图仅与模型耦合。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T22:55:44.150

ASP.NET MVC 不包含强类型操作链接方法。你从哪里得到的方法？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T15:04:20.197

以我的经验，ASPX 页面中的 Intellisense 至少可以说是不稳定的。我经历了与您描述的相同的情况，以及其他不良影响。在某些情况下，Intellisense 完全停止工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T15:06:53.577

在 MVC 之前，对 ASPX 页面智能感知代码的需求并不强烈。我希望 VS 团队在 2010 年能在这方面做更多的工作，但在那之前，至少从我的经历来看，你的问题是正常的。

# matlab - 遍历矩阵列的最佳方法是什么？

> ID：216341
> 
> 赞同：11
> 
> 时间：2008-10-19T12:10:41.903
> 
> 标签：matlab, matrix, enumeration

我想使用 MATLAB 将函数应用于矩阵中的所有列。例如，我希望能够在矩阵的每一列上调用 smooth ，而不是让 smooth 将矩阵视为向量（如果调用 ，这是默认行为`smooth(matrix)`）。

我确信必须有一种更惯用的方法来做到这一点，但我找不到它，所以我定义了一个`map_column`函数：

```
function result = map_column(m, func)
    result = m;
    for col = 1:size(m,2)
        result(:,col) = func(m(:,col));
    end
end 
```

我可以打电话给：

```
smoothed = map_column(input, @(c) (smooth(c, 9))); 
```

这段代码有什么问题吗？我该如何改进它？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-23T18:17:14.143

MATLAB“for”语句实际上循环遍历所提供的任何列 - 通常，这只会产生一系列标量，因为传递给 for 的向量（如上面的示例）是一个行向量。这意味着您可以像这样重写上面的代码：

```
function result = map_column(m, func)
    result = [];
    for m_col = m
      result = horzcat(result, func(m_col));
    end 
```

如果 func 不返回列向量，那么您可以添加类似

```
f = func(m_col);
result = horzcat(result, f(:)); 
```

强制它进入一列。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-09T07:30:35.883

你的解决方案很好。

请注意，horizcat 会对大型矩阵造成很大的性能损失。它使代码为 O(N^2) 而不是 O(N)。对于 100x10,000 矩阵，您的实现在我的机器上需要 2.6 秒，而 horizcat 需要 64.5 秒。对于 100x5000 矩阵，horizcat 实现需要 15.7 秒。

如果您愿意，您可以稍微概括您的函数，使其能够迭代最终维度甚至任意维度（不仅仅是列）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T15:05:52.753

也许您总是可以使用 ' 运算符转换矩阵，然后将结果转换回来。

```
smoothed = smooth(input', 9)'; 
```

这至少适用于 fft 功能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T02:34:02.390

一种在矩阵列之间产生隐式循环的方法是使用 cellfun。也就是说，您必须首先将矩阵转换为单元格数组，每个单元格将容纳一​​列。然后打电话给cellfun。例如：

```
A = randn(10,5); 
```

看到这里我计算了每列的标准偏差。

```
cellfun(@std,mat2cell(A,size(A,1),ones(1,size(A,2))))

ans =
      0.78681       1.1473      0.89789      0.66635       1.3482 
```

当然，MATLAB 中的许多函数已经设置为在用户指示的数组的行或列上工作。当然，std 也是如此，但这是一种测试`cellfun`成功的便捷方法。

```
std(A,[],1)

ans =
      0.78681       1.1473      0.89789      0.66635       1.3482 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T18:11:21.013

如果您正在处理大型矩阵，请不要忘记预先分配结果矩阵。否则，每次添加新行/列时，您的 CPU 将花费大量周期重复重新分配矩阵。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T14:15:31.310

如果这是您的函数的常见用例，那么如果输入不是向量，则让函数自动遍历列可能是个好主意。

这并不能完全解决您的问题，但会简化函数的使用。在这种情况下，输出也应该是一个矩阵。

您还可以使用 将矩阵转换为一长列`m(:,:) = m(:)`。但是，这是否有意义取决于您的功能。

# ruby - 如何最简单地安装和运行 Ramazes Rapaste？

> ID：216343
> 
> 赞同：1
> 
> 时间：2008-10-19T12:11:18.453
> 
> 标签：ruby, ramaze, rapaste

我对 Ruby 和 Ramaze 非常熟悉，但我想为我的管理员提供安装方法，因为他们更熟悉 Tomcat 和标准 Apache 安装。

我先在本地尝试过，结果很长：

```
sudo aptitude install ruby1.8 ruby1.8-dev rubygems1.8 sqlite3

wget http://www.geocities.jp/kosako3/oniguruma/archive/onig-5.8.0.tar.gz

tar zxvf onig-5.8.0.tar.gz

cd onig-5.8.0/

./configure

make

sudo make install

sudo gem install -r --include-dependencies --no-rdoc --no-ri ramaze mongrel sequel sqlite3-ruby ultraviolet

(mongrel 1.1.5 ruby)
(sqlite3-ruby 1.2.4 ruby)
(onigurama 1.1.0 ruby)

cp -r /usr/lib/ruby/gems/1.8/gems/ramaze-2008.06/examples/app/rapaste .

cd rapaste/

vi start.rb
Change the following line (add "java" at position 0)
UV_PRIORITY_NAMES = %w[ java ruby plain_text html css javascript yaml diff ]

ruby start.rb --adapter mongrel --port 7000 
```

有没有更短的方法？我可以在哪里优化？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T15:46:45.137

如果系统中缺少这些库和东西，我看不出如何缩短它。唯一的进一步优化可能是编写某种构建脚本。

# version-control - 在线私人源代码控制系统

> ID：216349
> 
> 赞同：33
> 
> 时间：2008-10-19T12:15:16.340
> 
> 标签：version-control

我正在寻找一个*私人*在线源代码控制系统。基本上我想要的是[Google Code](http://code.google.com/hosting/)或[SourceForge](http://sourceforge.net/)的私有版本。私人的意思是只有我和我邀请的人可以查看源代码。源代码管理中的源代码不应暴露给搜索引擎或其他没有适当查看权限的人。

我更喜欢将源代码保存在其他服务器上，而不是我的机器上。我不想处理所有的数据库维护和备份之类的事情。作为交换，我不介意为此支付每月访问费。

有任何想法吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2011-10-07T01:08:02.210

Atlassian 的 BitBucket 上周刚刚宣布了 Git 存储库。位桶免费允许无限的私人存储库。如果您想要超过 5 个用户，则需要付费。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-19T12:20:49.290

在这里为[Unfuddle投票](http://unfuddle.com/)

免费提供 200mb 和 200mb 内无限（数量）的 git/svn 存储库。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-19T13:13:12.123

Assembla - 用于 Subversion - [www.assembla.com](http://www.assembla.com)。免费颠覆 / Trac

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-10-05T17:08:40.777

我的一个朋友最近告诉我关于[ATLASSIAN](http://www.atlassian.com/software/development-tools.jsp)的[bitbucket](https://bitbucket.org/)

这是一个很棒的，包括他们的免费计划版本。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-19T12:17:30.717

[GitHub](http://github.com/)可以做到这一点（使用付费帐户）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-07-22T19:41:13.797

我知道这个问题已经发布了一段时间。但是，这个怎么样：

如果您是在 Windows 机器上进行开发，请下载 Google Drive 客户端并在本地机器上同步您的 Google Driver 文件夹。在这些同步的文件夹中，创建一个称为存储库或其他东西的文件夹。

然后使用 git，在该文件夹中创建一个裸存储库。或者在 Bazaar，一个没有树的存储库。这将创建一个不包含实际工作文件的存储库，而只保留修订历史。这具有节省磁盘空间以及让您像集中式回购一样从/向其拉取和推入的优势。

由于它位于您的 Google Drive 同步文件夹中，因此它将在 Google Drive 上备份并同步。您可以允许使用电子邮件地址访问您的文件夹。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T12:59:45.767

对于 Subversion，我使用[DevjaVu](http://www.devjavu.com/)。

# xml - 在编辑器中 XML 格式

> ID：216354
> 
> 赞同：1
> 
> 时间：2008-10-19T12:19:31.837
> 
> 标签：xml, formatting, textpad

嗨，任何人都知道在编辑器中格式化 xml 的简单系统。我主要使用文本板，所以这将是我的主要兴趣。我真正要问的是，当我将日志文件中的 xml 字符串或其他内容粘贴到 textpad 中时，我可以使用插件或第三方工具在 textpad 中格式化 xml，使其可读。

编辑：感谢所有建议，但我认为我真正想要的是一种格式化我刚刚粘贴到编辑器中的文本字符串的方法，然后（不保存文档）将其格式化为 xml 字符串例如。缩进。

有什么建议么？

更新：我发现 Editpad pro 允许您编写将当前选定文本作为输入并将其替换为输出的工具。这比文本板允许你做的和我想要的更强大。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T12:49:14.413

有用于文本板的附加组件可以做到这一点。查看[TextPad 语法定义文件](http://www.textpad.com/add-ons/synu2z.html)或[TextPad 附加组件：实用程序](http://www.textpad.com/add-ons/index.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-19T12:53:24.703

我喜欢 Microsoft 用于编辑（或格式化）XML 的免费 XML Notepad。它可以从他们的网站免费下载，但它需要 .NET 运行时。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T12:26:08.283

您可以使用 Visual Studio 来格式化 XML。

只需创建一个新的 XML 文件并粘贴您的文本...完成。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T12:36:11.977

[HTML Tidy](http://tidy.sourceforge.net/)将是最基本的解决方案。它可以在命令行上缩进 XML，也许你最喜欢的编辑器可以执行外部命令，这样你就可以为此创建一个菜单项。

编辑：快速浏览 Google 会发现您实际上*可以*[为 TextPad 制作自定义命令](http://johnbokma.com/textpad/textpad-subversion.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T13:48:41.893

eclipse 有一个很好的 XML 格式化程序

在任何 XML 文件中只需键入

CTRL 换档 f

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-16T01:49:11.423

[http://www.textpad.com/add-ons/index.html](http://www.textpad.com/add-ons/index.html) 下载 XMLTIDY 并按照说明进行操作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T12:24:23.373

Notepad2 在这里很有用。您可以使用它来编辑和突出显示 XML、HTML、Javascript 和许多其他语言。在这里检查：

[http://www.flos-freeware.ch/notepad2.html](http://www.flos-freeware.ch/notepad2.html)

# .net - 网页中的图表

> ID：216360
> 
> 赞同：5
> 
> 时间：2008-10-19T12:22:09.820
> 
> 标签：.net, asp.net, sharepoint, charts, web-applications

我想要完成的是在网页上展示图表。例如，呈现两列表格的 aspx 页面网格视图可以复制并放入 Excel，然后创建图表。我目前使用最多的页面是 ASP.NET 3.0 或带有存储过程的 SharePoint 团队网站。人们对人们如何在网页中进行聊天非常感兴趣。

在此先感谢，卡托

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-19T12:55:55.163

Google Chart API 使将图表嵌入网页变得容易。根本不需要服务器端安装。

[http://code.google.com/apis/chart/](http://code.google.com/apis/chart/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-13T11:42:53.487

.NET 实际上已经发布了他们自己的图表控件，Scott 不久前宣布了它。

[http://weblogs.asp.net/scottgu/archive/2008/11/24/new-asp-net-charting-control-lt-asp-chart-runat-quot-server-quot-gt.aspx](http://weblogs.asp.net/scottgu/archive/2008/11/24/new-asp-net-charting-control-lt-asp-chart-runat-quot-server-quot-gt.aspx)

它们非常好，我相信是从 Dundas 购买的，但我没有这方面的信息，可能完全不真实。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T21:32:28.557

对于sharepoint，可以使用dataview webpart和自定义xslt来渲染[visifire](http://blogs.msdn.com/sharepointdesigner/archive/2008/07/18/dataviews-visifire-silverlight-charting-power.aspx)（或其他基于javascript的图表）来渲染基于sharepoint列表数据或数据库数据的图表

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T12:48:47.393

如果您想直接在网页中显示图表，您可以使用 VML（矢量标记语言）或 SVG（可缩放矢量图形）。IE 支持 VML，而许多其他浏览器都支持 SVG（尽管 IE 可以通过插件显示 SVG）。例如，谷歌地图在 IE 中运行时使用 VML，而在其他浏览器中使用 SVG。

VML 和 SVG 都使用 XML 格式来定义要显示的图表。例如，这是一个 VML 示例

```
<v:shape
    fillcolor="green"
    style="position:relative;top:1;left:1;width:200;height:200"
    path = "m 1,1 l 1,200, 200,200, 200,1 x e">
</v:shape> 
```

这些链接可能会更详细地解释：

[VML](http://msdn.microsoft.com/en-us/library/bb250524(VS.85).aspx)

[SVG](http://en.wikipedia.org/wiki/SVG)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T13:48:32.207

再看看[当前站点](https://stackoverflow.com/users/17877?sort=reputationhistory#sort-top)- 它使用[flot](http://code.google.com/p/flot/)在*JavaScript*中绘制图表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T12:36:06.140

因此，您可能希望将 GridView 导出到 MS Excel，我可以想象它包含一个生成的宏来生成数据图表。你的意思是这样的。或者您只是想将网站中的数据导入到 excel 中？即 CSV 格式很容易完成。对于 Excel 格式，这也是可能的，在我看来很有趣。我想你也可以通过嵌入在生成的 Excel 文件中的 C# tp 来生成宏。

安德鲁

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T12:37:44.890

你可以试试[Roll your own ASP.NET Chart Control](http://www.codeproject.com/KB/custom-controls/webchart.aspx)。不过，它可能有点过时了。

您还可以查看[图表控件](http://www.asp.net/community/control-gallery/browse.aspx?category=7)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-19T13:47:33.707

看看 DojoX

[http://dojotoolkit.org/projects/dojox](http://dojotoolkit.org/projects/dojox)

dojox.charting 提供了许多常见的图表类型——包括折线图、条形图、面积图和饼图

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-19T15:16:38.300

大多数图表解决方案都涉及将 URL 设置为 img 标记，该标记请求将图像绘制为位图的页面。

[http://myserver/drawgraph.aspx](http://myserver/drawgraph.aspx)

在绘制图中，您通常会绘制一个很棒的位图，绘制图表，然后将位图返回到响应中。这就是您自己需要做的所有事情，并且网络上有许多免费和收费的图书馆可以做到这一点。它的问题是选择一个具有满足您的需求/风格的 API 和功能集的库。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-01-12T23:30:19.170

使用微软图表控件。它很容易使用！

这是VS2008的分步说明

[http://parasdoshi1989.wordpress.com/2010/10/03/how-to-include-charts-in-visual-studio-2008-express-edition-using-microsoft-chart-control/](http://parasdoshi1989.wordpress.com/2010/10/03/how-to-include-charts-in-visual-studio-2008-express-edition-using-microsoft-chart-control/)

# c# - 将复杂的条件语句移到代码后面

> ID：216391
> 
> 赞同：1
> 
> 时间：2008-10-19T12:56:46.910
> 
> 标签：c#, asp.net-mvc, code-behind

我只是想知道，如果通过移动复杂的 if else 语句和生成的 html 标记到后面的代码是否违反了一些“MVC”法律？

当面临内联 if else 语句可能变得非常不可读时，这似乎是一个不错的选择。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T05:48:10.383

在你看来有条件并不可怕。我会将它们保留在 ASPX 中，而不是后面的代码中。但是，条件通常表示控制行为。考虑以下 ASPX 代码：

```
<%if (ViewData["something"] == "foo") {%>
     <%=Html.ActionLink("Save", "Save") %> 
<%}%>
<%if (ViewData["somethingElse"] == "bar") {%>
     <%=Html.ActionLink("Delete", "Delete") %> 
<%}%> 
```

这组条件表示控制视图正在处理的行为——即，在错误的位置。此行为不可单元测试。改为考虑：

```
<%foreach (var command in (IList<ICommand>)ViewData["commands"]) {%>
     <%=Html.ActionLink(command) %>
<%}%> 
```

在此示例中，ActionLink 是 HtmlHelper 的自定义扩展，它采用我们自己的 ICommand 规范对象。呈现此视图的控制器操作根据各种条件填充 ViewData["commands"]。换句话说，控制器进行控制。在此操作的单元测试中，我们可以测试在各种条件下会显示正确的命令集。

与快速将一些 IF 放入视图相比，起初这似乎很麻烦。您必须问自己的问题是，“这个 IF 是否代表控制行为，我是否要确保在某些时候不会中断？”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T19:47:34.947

我不喜欢在我的视图中使用类后面的代码。这并不是因为它默认违反了 MVC，而是因为我发现“自然”的方式（至少对我而言）是不同的。

当我面对与纯视图关注点相关的复杂 HTML 标记时，我通常会为类编写扩展方法`HtmlHelper`以隐藏复杂性。因此，我有像`Html.MoneyTextBox()`,`Html.OptionGroup()`和`Html.Pager<T>`.

在其他情况下，当出现复杂情况时，我通常会错过控制器的某些内容。例如，与元素的可见性、只读或启用相关的所有问题通常源于控制器可以提供的东西。在这种情况下，我没有将模型传递给视图，而是创建了一个视图模型，它封装了模型和控制器可以提供的附加信息，以简化 HTML 标记。一个典型的视图模型示例如下：

```
public class CustomerInfo
{
  public Customer Customer { get; set; }
  public bool IsEditable { get; set; }  // e.g. based on current user/role
  public bool NeedFullAddress { get; set; }  // e.g. based on requested action 
  public bool IsEligibleForSomething { get; set; }  // e.g. based on business rule
} 
```

也就是说，后面的代码是视图的一部分，因此如果它更适合您的需求，您可以自由使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T13:52:36.863

我相信只要它是一个渲染代码并且它在“视图”而不是控制器中，那么将它放在代码后面或内联就无关紧要。只要确保你没有在控制器动作中编写这段渲染代码（这样你就真的违反了 MVC 模式）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T16:55:07.963

代码隐藏是视图的一部分——如果您想将内容直接放在 ASPX 中还是放在代码隐藏中，这取决于您。MVC 并不意味着您必须在 ASPX 中编写所有丑陋的代码:)。

# windows-services - windows服务启动超时

> ID：216401
> 
> 赞同：53
> 
> 时间：2008-10-19T13:02:48.600
> 
> 标签：windows-services, timeout, startup

有没有办法为每个服务设置不同的服务启动超时值？我可以使用 ServicesPipeTimeout 注册表项更改它，但它是每台机器（[http://support.microsoft.com/kb/824344](http://support.microsoft.com/kb/824344)）。

目前我唯一想到的就是在不同的线程中执行所有耗时的启动操作。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-05-26T08:28:04.783

我同意 Romulo 关于尽快开始服务的意见。但是，如果您需要时间并且正在使用 .NET Framework 2.0 或更高版本，则可以考虑使用 ServiceBase.RequestAdditionalTime() 方法。

[http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicebase.requestadditionaltime.aspx](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicebase.requestadditionaltime.aspx)

```
protected override void OnStart()
{
    this.RequestAdditionalTime(10000);
    // do your stuff
} 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-10-19T14:44:26.463

最好尽快完成启动服务。所以，在*启动*状态下，只做你绝对需要确认它启动成功的事情；其余的稍后再做。如果*启动*仍然是一个漫长的过程，请定期使用[SetServiceStatus](http://msdn.microsoft.com/en-us/library/ms686241.aspx)通知*服务控制管理器*您尚未完成，因此它不会使您的服务超时。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-05-27T07:00:36.793

只需在另一个线程中做一些耗时的事情

```
 protected override void OnStart(string[] args)
    {
        var task = new Task(() =>
        {
            // Do stuff
        });
        base.OnStart(args);
        task.Start();
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-02T12:23:19.937

我还必须处理一项服务，该服务可能需要几秒钟/几分钟才能有一个良好的开始。当服务启动时，它会尝试连接到 SQL Server。但是，当整个服务器重新启动时，我的服务在 SQL Server 之前启动。（我知道服务依赖性，但由于特定原因它不适用于我的情况......）。我尝试循环尝试 10 次以连接到 SQL Server，但由于超时，Windows 在第二次尝试之前杀死了我的服务。

**我的解决方案**：我在服务的“onStart()”中添加了一个计时器。然后，服务的“onTick()”方法尝试 10 次连接到 SQL Server（其中等待 30 次）。启动时不再超时。

所以基本上，

*   我的服务在 5 秒后开始。
*   服务启动 10 秒后启动计时器。
*   计时器尝试 10 次 [每次等待 30 秒] 以连接到 SQL Server。
*   如果成功，计时器将自行禁用，如果没有（尝试 10 次后），我将停止服务。

请注意解决问题的更优雅的方法，但也许我的解决方案的某些部分可能会帮助与我处于相同情况的任何人，

# php - 为什么 var_dump 一个 Doctrine Objects 会杀死我的 Apache？

> ID：216409
> 
> 赞同：8
> 
> 时间：2008-10-19T13:12:35.663
> 
> 标签：php, doctrine

我有一个非常奇怪的问题，当我尝试`var_dump`（或`print_r`）一个 Doctrine 对象时，我的 Apache 响应一个空白页（200 OK 标题）。我可以`var_dump`使用普通的 php var，例如：

```
$dummy = array("a" => 1, "b" =>2); 
```

它工作正常。但是我不能使用任何 Doctrine 类中的任何对象（例如来自 的结果`$connection->query()`，或者来自我的 Doctrine 对象模型的类的实例）。

有人知道为什么会这样吗？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2011-12-27T15:02:01.260

延迟加载代理总是包含 Doctrine 的 EntityManager 及其所有依赖项的实例。

因此，a`var_dump`可能会转储一个无法渲染和读取的非常大的递归结构。您必须使用`\Doctrine\Common\Util\Debug::dump()`将转储限制为人类可读的级别。请注意，此函数的默认深度设置为 2（它是第二个参数）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-09-26T18:11:01.077

使用类的`toArray`方法`Doctrine_Record`

```
var_dump($doctrine_record->toArray()); 
```

将只显示数据库字段并避免转储完整的 Doctrine 内部（包含自引用/递归 btw）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-19T13:29:22.090

我有时在尝试`print_r()`自引用对象时遇到过这种情况 - 它进入循环并耗尽内存。可能这就是发生在你身上的事情。

尝试增加内存限制 ( `ini_set('memory_limit', '256M');`) 并查看是否可以解决问题。

编辑：我不认为有一个实际的解决方法 - 它是 PHP 的内部`var_dump`/`print_r`不限制递归深度（或者至少没有正确地执行它）。如果您安装[XDebug](http://xdebug.org/)扩展，这可以将内置`var_dump`版本替换为更好地处理递归的版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-10T01:35:48.993

如果您确定对象是 Doctrine_Collection 的实例，则可以使用 toArray。Xdebug 对教条记录没有帮助。

我建议的方法是实现一个自定义递归函数来打印对象，在需要时使用 Doctrine_Record::toArray()

```
function var_dump_improved()
{
   foreach (func_get_args() as $arg) {
       if ($args instanceof Doctrine_Collection) {
          print_r($arg);
       } else if ( $arg instanceof Traversable || is_array($arg) ) {
          // do a foreach and recall var_dump_improved on subelements
       } else if (...) {
          // other types
       } 
   }   
} 
```

使用最大嵌套级别进行调试的一些递归函数在这里

[http://php.net/manual/en/function.var-dump.php](http://php.net/manual/en/function.var-dump.php)

看评论，找“递归”

# c - 在调用它之前确定 realloc() 行为

> ID：216426
> 
> 赞同：6
> 
> 时间：2008-10-19T13:26:52.767
> 
> 标签：c, memory-management

据我了解，当被要求保留更大的内存块时， realloc() 函数将执行以下三种不同的操作之一：

```
`if free contiguous block exists
    grow current block
else if sufficient memory
    allocate new memory
    copy old memory to new
    free old memory
else
    return null` 
```

`增长当前块是一个非常便宜的操作，所以这是我想利用的行为。但是，如果我重新分配内存是因为我想（例如）在现有字符串的开头插入一个字符，我不希望 realloc() 复制内存。我最终将使用 realloc() 复制整个字符串，然后再次手动复制它以释放第一个数组元素。`

 `是否可以确定 realloc() 会做什么？如果是这样，是否有可能以跨平台的方式实现？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-19T14:08:53.350

`realloc()`的行为可能取决于其具体实现。并且基于您的代码将是一个可怕的黑客攻击，至少可以说，它违反了封装。

对于您的具体示例，更好的解决方案是：

1.  查找当前缓冲区的大小
    *   分配一个新的缓冲区（带`malloc()`），大于前一个
    *   将您想要的前缀复制到新缓冲区
    *   将前一个缓冲区中的字符串复制到新缓冲区，从前缀之后开始
    *   释放前一个缓冲区

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T14:47:51.680

如评论中所述，问题中的案例 3（没有记忆）是错误的；`realloc()`如果没有可用内存，将返回 NULL [问题现已修复]。

Steve McConnell 在“代码完成”中指出，如果您在失败`realloc()`时将返回值保存在原始指针的唯一副本中`realloc()`，那么您只是泄漏了内存。那是：

```
void *ptr = malloc(1024);
...
if ((ptr = realloc(ptr, 2048)) == 0)
{
    /* Oops - cannot free original memory allocation any more! */
} 
```

realloc() 的不同实现会表现不同。唯一安全的假设是数据*总是*会被移动——当你 realloc() 内存时你总是会得到一个新地址。

正如其他人指出的那样，如果您对此感到担忧，也许是时候看看您的算法了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T05:39:18.220

将字符串向后存储有帮助吗？

否则......只需 malloc() 比您需要的更多空间，当您用完空间时，复制到新缓冲区。一个简单的技巧是每次将空间加倍；这很有效，因为字符串越大（即复制到新缓冲区所需的时间越多），它需要发生的频率就越低。

使用这种方法，您还可以在缓冲区中右对齐您的字符串，因此很容易将字符添加到开头。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T13:37:14.570

不~~——如果你仔细想想，它是行不通的。在你检查它要做什么和实际做之间，另一个进程可以分配内存。~~ 在多线程应用程序中，这是行不通的。在你检查它要做什么和实际做这件事之间，另一个线程可以分配内存。

如果您担心这类事情，可能是时候查看您正在使用的数据结构，看看是否可以解决问题。根据这些字符串的构造方式，您可以使用设计良好的缓冲区非常有效地完成此操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T13:44:49.423

我认为跨平台的方式是不可能的。 [这](http://www.google.com/codesearch?hl=en&q=show:4f2oPw-25m8:NZvFhxd9P74:55xbVtXJ6eg&sa=N&ct=rd&cs_p=http://freshmeat.net/redir/uclibc/20616/url_bz2/uClibc-0.9.28.1.tar.bz2&cs_f=uClibc-0.9.29/libc/stdlib/malloc/realloc.c)是 ulibc 实现的代码，它可能会为您提供如何以平台相关方式进行操作的线索，实际上最好找到 glibc 源代码，但这个代码位于谷歌搜索之上 :)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T14:46:45.630

如果[obstack](http://www.gnu.org/software/libc/manual/html_node/Obstacks.html#Obstacks)非常适合您的内存分配需求，您可以使用它们[快速增长的](http://www.gnu.org/software/libc/manual/html_node/Extra-Fast-Growing.html#Extra-Fast-Growing)功能。Obstacks 是 glibc 的一个特性，但它们也可以在[libiberty](http://gcc.gnu.org/onlinedocs/libiberty/)库中使用，它是相当可移植的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T06:04:01.057

为什么不在字符串的左侧保留一些空的缓冲区空间，如下所示：

```
char* buf = malloc(1024);
char* start = buf + 1024 - 3;
start[0]='t';
start[1]='o';
start[2]='\0'; 
```

要将“on”添加到字符串的开头以使其成为“onto\0”：

```
start-=2;
if(start < buf) 
  DO_MEMORY_STUFF(start, buf);//time to reallocate!
start[0]='o';
start[1]='n'; 
```

这样，您不必在每次想要在开始时进行插入时都继续复制缓冲区。

如果您必须在开头和结尾都进行插入，则只需在两端分配一些空间即可；显然，中间的插入仍然需要你随机播放元素。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-10-07T03:04:20.603

更好的方法是使用链表。将您的每个数据对象分配在一个页面上，然后分配另一个页面并具有指向它的链接，可以来自上一页或来自索引页面。这样您就知道下一次分配何时失败，并且您永远不需要复制内存。

# embedded - 您如何在嵌入式项目中组织代码？

> ID：216428
> 
> 赞同：15
> 
> 时间：2008-10-19T13:29:57.113
> 
> 标签：embedded, code-organization

高度嵌入（有限的代码和内存大小）项目对代码组织提出了独特的挑战。

我见过很多完全没有组织的项目。（主要是硬件工程师，根据我的经验，他们通常不关心代码的非功能方面。）

但是，我一直在尝试相应地组织我的代码：

1.  硬件特定（驱动程序，初始化）
2.  特定于应用程序（不太可能被重用）
3.  可重复使用，独立于硬件

对于每个模块，我都尝试将目的保持在这三种类型中的一种。

由于嵌入式项目的规模有限和对性能的重视，它经常保持这种组织。

在某些情况下，我当前的项目是在具有 8k 闪存和 256 字节 RAM 的 MSP430 上的有限 DSP 应用程序。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-19T16:04:42.120

我已经在包括 MSP430 在内的各种目标微控制器上编写并维护了多个嵌入式产品（30 多个并且还在增加）。我最成功的“经验法则”是：

*   尽量将通用概念模块化（例如，将驱动程序代码与应用程序代码分开）。- 它使将来更容易维护和重用/移植项目到另一个目标微。
*   不要一开始就担心优化的代码。尝试先解决域的问题，然后再进行优化。-- 你的目标微机可以处理比你想象的更多的“东西”。
*   努力确保可读性。尽管大多数嵌入式项目的开发周期似乎都很短，但这些项目的寿命通常比您预期的要长，并且毫无疑问，另一个开发人员必须使用您的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T02:43:03.470

我试着把它组织起来，就好像我有无限的 RAM 和 ROM，它通常工作得很好。如其他地方所述，在绝对需要之前不要尝试优化它。

如果你能得到一个拥有更多资源的引脚兼容处理器，最好让它在这方面工作，专注于良好的结构和布局，然后在你更好地理解代码时优化尺寸。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T15:25:27.737

我曾研究过具有类似限制的 8 位 PIC 处理器。

你没有的一个限制是你做了多少评论或者你选择给你的方法、变量等命名。好好利用。速度和规模限制有时会胜过组织，但你总是可以解释的。

另一个技巧是将逻辑源文件分解成比您需要的更多的部分，然后通过将它们绑定到`#include`编译单元中来绑定它们。这允许您拥有大量可重用的代码（甚至每个文件一个例程），但可以按您需要的任何顺序组合。这很有用，例如在尝试满足编译单元大小限制时，或者在下一个项目中挑选您需要的常用子例程时。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T03:30:49.207

除非在特殊情况下（见注释），您的代码*组织*不会影响最终产品。（代码的内容显然是另一回事）

因此，考虑到这一点，您应该像组织任何其他项目一样组织您的代码。

话虽如此，以下是相当典型的：

如果这是您以前使用过或将来会使用的处理器，您通常希望保留一个专用的硬件抽象层，以便将来在项目之间共享。通常，此模块将包含诸如管理任何 uart、计时器等的例程之类的项目。

通常维护一组特定于平台的初始化和设置代码是合理的，这些代码执行所有配置和初始化，直到您的主管接管并运行您的应用程序。它还将包括特定于平台的 hal 例程。

执行程序/应用程序可能作为一个单独的模块进行维护。所有硬件特定的代码都应该隐藏在 hal 中（如上所述）。

通过像这样拆分代码，您还可以选择在完全不同的平台上编译和运行您的应用程序作为模拟，只需将硬件特定代码替换为模拟硬件的例程即可。这对于您可能遇到的单元测试和调试以及算法问题很有用。

* * *

异常编译器限制可能导致的异常情况。例如。我遇到了一些编译器，它们期望所有中断服务例程都在单个目标文件中编译。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T10:26:32.847

尽管有点痛苦，但嵌入式 C 库中有些常见的一种组织技术是将每个函数和变量拆分为单独的 C 源文件，然后将生成的 O 文件集合聚合到库文件中。

这样做的动机是，对于大多数普通链接器，链接单元是一个对象，对于每个对象，您要么得到整个对象，要么一个都没有。由于 C 文件和目标文件之间存在 1-1 的关系，因此将每个符号放在它自己的 C 文件中会给每个符号它自己的对象。这反过来又让链接器只拉入实际使用的函数和变量的子集。

这种游戏对于标题完全没有帮助，它们可以很高兴地保留为单个文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-19T14:19:51.113

我曾使用过一些传感器，例如 Tmote Sky，我也看到过糟糕的组织，我不得不承认我对此做出了贡献。无论如何，我会说必须有一些混乱，因为加载过多的模块或过多的程序部分也会（恕我直言）资源消耗，因此请尝试了解低资源上的组织和可用性之间的阈值。

显然这并不意味着让 caos 开始，但例如尝试了解[tinyOS](http://www.tinyos.net/)源代码和应用程​​序的组织，这是我想说的一个想法。

# cookies - 跨域用户追踪

> ID：216430
> 
> 赞同：28
> 
> 时间：2008-10-19T13:30:40.230
> 
> 标签：cookies, cross-domain, user-tracking

我们有几个不同域的网站，我希望能够跟踪用户在这些网站上的活动。

*   显然 cookie 是不可行的，因为它们不跨越域边界。
*   我可以查看 IP 地址和用户代理的组合，但在某些情况下它不起作用。
*   我不想使用 Flash 或其他插件。

有任何想法吗？还是我注定要依赖 IP/User_Agent 组合？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-19T13:36:36.397

您可以指定一个域或子域进行跟踪，并让它提供一个 1x1 像素的图像，您可以将其包含在您想要跟踪的所有页面中。提供带有图像的 cookie，查看跟踪域的服务器日志，瞧。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-03-25T21:57:32.150

此解决方案不需要 JavaScript，即使用户禁用第三方 cookie 也能正常工作。

首先，让我们确保用户代理正在发送 cookie：

`If getCookie("c") == null then setCookie("c", "anyValue")`

然后让请求完成（也就是等待下一个请求）

让我们调用我们的跟踪器 cookie `uaid`。

如果`GET` `http://child.com/any-page`和... `getCookie("c") is not null`_`getCookie("uaid") is null`

重定向到`http://parent.com/give-me-a-uaid?returnTo=http://child.com/any-page`

打开`http://parent.com/give-me-a-uaid`，检查 cookie`uaid`

如果不存在，则创建它并将其添加到响应中。如果存在，获取它的值。

重定向到`http://child.com/any-page?uaid=valueOfParentsUAIDCookie`

Child.com 设置`uaid`cookie`valueOfParentsUAIDCookie`

重定向到`http://child.com/any-page`

当然，您正在**验证输入**，并将**您的重定向 URL 列入白名单**:)

流量：

![方案 A](https://i.stack.imgur.com/vdFAB.png)

![方案 B](https://i.stack.imgur.com/K6PNc.png)

![方案 C](https://i.stack.imgur.com/GU3wZ.png)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-19T14:06:23.183

[此问题与Internet Explorer 上 iFrame 中访问域 Cookie](https://stackoverflow.com/questions/98127/accessing-domain-cookies-within-an-iframe-on-internet-explorer)的问题密切相关。

对于 Internet Explorer，我需要考虑 P3P 策略并设置一个[额外的 P3P HTTP-Header](http://support.microsoft.com/kb/323752/EN-US/)以允许图像跨域设置 cookie。然后我可以使用西蒙的建议。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T14:23:49.593

您可以遵循 Google Analytics 中使用的相同概念。在要跟踪的页面中注入 javascript。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T15:31:55.290

您没有为您的情况提供任何背景 - 只是基本问题。所以很难给出一个明确的答案。但是，这里有一些用于将信息从一个页面传递到另一个页面的技术/机制，无论涉及哪个域。

*   包含指向 1x1 像素透明 gif 图像的超链接（有时称为“信标”）
*   依靠 HTTP 请求标头中的引用信息来识别页面超链接是否打开
*   在指向其他站点的超链接中包含额外参数 - 假设您同时运行两个站点
*   购买[Akamai](http://en.wikipedia.org/wiki/Akamai_Technologies)等公司的服务为您进行用户跟踪
*   如果标准获得批准，将来可能会使用跨域 cookie 机制

哪些技术真正归结为您是否可以将软件放置在用户将访问的所有您感兴趣的站点（服务器）上 - 或者您不能将软件放置在所有站点（服务器）上。

# sharepoint - SharePoint 和 Firefox 3

> ID：216444
> 
> 赞同：7
> 
> 时间：2008-10-19T13:47:55.827
> 
> 标签：sharepoint, firefox, moss, firefox-3

我认为大多数 SharePoint 开发人员和管理员都知道，随着从 Firefox 2 到 Firefox 3 的更改，SharePoint 的某些功能变得不可用。

特别是在 Firefox 3 中添加 Webparts 和使用 PeoplePicker 不再适用。所以我想知道当您的一些用户抱怨必须使用 IE 才能获得与使用相同的功能时您如何处理这个问题火狐 2。

对我来说很明显，不可能使用 Firefox 获得全部功能，但是至少使用 Firefox 3 获得与之前使用 Firefox 2 相同的功能会很棒。

或者是否有任何解决方法可以让 Firefox 3 与 SharePoint 一起正常工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T18:10:51.617

I am using IE Tab: [https://addons.mozilla.org/en-US/firefox/addon/1419](https://addons.mozilla.org/en-US/firefox/addon/1419)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T08:16:34.623

主要问题似乎是这样一个事实，即每当在 SharePoint 操作期间打开弹出窗口时，例如将 web 部件添加到站点，弹出窗口中的信息或数据不会传输到打开弹出窗口的初始窗口向上窗口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T21:16:36.577

它试图运行 Firefox 3 不支持的底层代码是什么？

它只是使用了一个坏代理嗅探器吗？不能处理v3？

我在 v3 中遇到的唯一处理不如 v2 好的是能够在非表单元素上调用 .focus() 。它在 v2 中效果更好，v3 似乎有一些问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T14:10:30.140

[针对 WSS 3.0 和 MOSS 2007 的 Service Pack 2](http://blogs.msdn.com/sharepoint/archive/2009/04/15/service-pack-2-for-microsoft-office-sharepoint-server-2007-and-windows-sharepoint-services-3-0-due-to-ship-april-28th.aspx)的官方公告包含以下文本：

> 此外，在新的服务包中，Internet Explorer 8 将作为一级添加到浏览器支持矩阵中，Firefox 2.0 和**3.0**作为二级添加。

那么也许升级到 SharePoint SP2 可以解决您的问题？有关 SP2 的更多详细信息计划于下周发布。

# c++ - GCC 和 ld 找不到导出的符号……但它们在那里

> ID：216450
> 
> 赞同：3
> 
> 时间：2008-10-19T13:51:35.057
> 
> 标签：c++, linux, g++, shared-libraries

我有一个 C++ 库和一个 C++ 应用程序，试图使用从库中导出的函数和类。该库构建良好，应用程序编译但无法链接。我得到的错误遵循这种形式：

> app-source-file.cpp:(.text+0x2fdb): undefined reference to `lib-namespace::GetStatusStr(int)'

链接器似乎可以很好地解析库中的类，但是自由函数和导出的数据（如余弦查找表）总是会导致上述错误。

我使用的是 Ubuntu 8.04 (Hardy)，它是最新的 Ubuntu 软件包。

链接库的命令是（删除了其他库）：

```
g++ -fPIC -Wall -O3 -shared -Wl,-soname,lib-in-question.so -o ~/project/lib/release/lib-in-question.so 
```

链接应用程序的命令是（删除了其他库）：

```
g++ -fPIC -Wall -O3  -L~/project/lib/release -llib-in-question -o ~/project/release/app-in-question 
```

最后，似乎（据我所知）有问题的符号正在正确导出：

```
nm -D ~/project/lib/release/lib-in-question.so | grep GetStatusStr --> U _ZN3lib-namespace12GetStatusStrEi 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-19T14:12:10.037

nm 输出中 _ZN3lib-namespace12GetStatusStrEi 之前的 U 表明该符号在库中**未定义。**

也许它是在错误的命名空间中定义的：看起来您在 lib-namepace 中调用它，但您可能在另一个名称空间中定义它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T14:45:00.767

已经有一段时间了，但是如果您使用 -l 选项指定一个库，那么您没有跳过 lib 前缀吗？

（为了便于阅读下面的示例，我将名称从“lib-in-question.so”更改为“libfoobar.so”）

```
g++ -fPIC -Wall -O3  -L~/project/lib/release -lfoobar 
```

或者

```
g++ -fPIC -Wall -O3  ~/project/lib/release/libfoobar.so 
```

# .net - 帮助在 Excel PIA 程序集中将 TypeConverters 用于枚举

> ID：216463
> 
> 赞同：0
> 
> 时间：2008-10-19T14:11:30.973
> 
> 标签：.net, excel, pia

我想使用 TypeCoverter 将 PIA 加载到 Excel 中的程序集中的枚举输出区域化。

我可以运行它，它适用于我使用显式引用的程序集创建的测试项目中的程序集，但是在运行已构建为 Excel PIA 的项目时。如果我尝试：_ public enum MyEnum ItemA ItemB end enum

并在代码 myE = MyEnum.ItemA Dim 转换器 As System.ComponentModel.TypeConverter = TypeDescriptor.GetConverter(myE)

在即时窗口中？converter.ToString() 管理“System.ComponentModel.EnumConverter”

而在我的另一个项目中（也是一个强签名的程序集，但直接从一个新创建的存根窗口表单项目中引用），我得到

? 转换器.ToString "ClassLibrary1.LocalizedEnumConverter"

所以看起来 LocalizedEnumConverter 没有绑​​定到枚举 - 有什么想法吗？这是因为 Excel 加载程序集的方式，有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-19T15:00:12.670

类型转换器是否与枚举在同一个 dll 中？TypeDescriptor 必须能够解析类型转换器、UI 类型编辑器等 - 否则它使用简单的默认值。

我没有用 Excel 专门尝试过任何东西，但我想知道它是否不像程序集解析那么简单......

如果有帮助，您可以使用该`AppDomain.AssemblyResolve`事件来自定义程序集加载 - 但这是一个复杂的领域......除非绝对必要，否则我会避免它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T11:06:45.550

经过大量的挖掘，我找到了解决方案，这适用于无法解决加载的程序集：

为大会决议添加一个处理程序：

```
 Dim currentDomain As AppDomain = AppDomain.CurrentDomain
    AddHandler currentDomain.AssemblyResolve, AddressOf AssemblyResolve_EventHandler 
```

然后处理决议：

```
Private Function AssemblyResolve_EventHandler(ByVal sender As Object, ByVal e As System.ResolveEventArgs) As System.Reflection.Assembly
    Dim asm() As System.Reflection.Assembly = System.AppDomain.CurrentDomain.GetAssemblies()

    For i As Integer = 0 To asm.Length
        If asm(i).FullName = e.Name Then
            Return asm(i)
        End If
    Next
    Return Nothing
End Function 
```

# objective-c - 如何替换字符串 [Foo alloc] 与 [[Foo 分配] ]

> ID：216470
> 
> 赞同：0
> 
> 时间：2008-10-19T14:16:13.993
> 
> 标签：objective-c, xcode, keyboard-shortcuts, macros

*   XCode 中是否有为此的快捷键？
*   我可以为此实现一个 Applescript 并在 XCode 中运行它吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T15:43:54.423

您可能可以使用脚本来做到这一点（查看相关的 Xcode 文档）。另请参阅“插入文本宏”菜单项...</p>

但是您可能会发现仅使用自动更正功能更有效。我只需输入“[[F”，然后点击我的自动更正键（我相信绑定到 F5，但我已经更改了它），输入足够的类名以便在自动更正弹出窗口中选择它。点击空格，开始输入 alloc 但让自动更正开始。关闭大括号。开始输入init，再次使用自动更正。

您通常不需要为这种微不足道的事情创建宏/脚本。自动更正、占位符和自动填充功能应该是您真正需要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-21T02:17:17.153

我看到这个问题是前段时间提出的。对于任何偶然发现它的人，当前版本的 Xcode (3.2+) 将在您使用时为您填写左括号（crackity_jones 称之为“自动回填”）。也就是说，如果您键入

```
[Foo alloc]<cursor> 
```

然后继续...

```
[Foo alloc] init<cursor> 
```

...当您键入下一个右括号时，Xcode 将在正确的位置插入相应的左括号：

```
[[Foo alloc] init]<cursor> 
```

试试看。虽然这并没有直接回答原始问题，但它确实解决了需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T20:13:56.330

[Textmate](http://macromates.com/)会自动回填 ['s for you。您还可以在其中构建您的 xcode 项目，以及使用 Objective-c 和其他添加功能的内置包做数以千计的其他有趣的事情。它有一个 30 天的演示，试一试，看看它是否符合您的要求。

# php - Gettext：消息 ID 是英文文本是个好主意吗？

> ID：216478
> 
> 赞同：47
> 
> 时间：2008-10-19T14:28:01.957
> 
> 标签：php, internationalization, gettext

我们正准备将我们的 PHP 网站翻译成各种语言，PHP 中的 gettext 支持看起来是可行的方法。

我看到的所有教程都建议使用英文文本作为消息 ID，即

gettext("你好！")

但这真的是个好主意吗？假设营销人员想要将文本更改为“Hi there, y'all!”。那么您是否不必更新所有语言文件，因为该字符串（实际上是消息 ID）已更改？

拥有某种通用 ID（例如“hello.message”）和英文翻译文件会更好吗？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-23T21:59:16.037

哇，我很惊讶没有人提倡使用英语作为键。我在几个软件项目中使用了这种风格，恕我直言，效果很好。代码可读性很好，如果您更改英文字符串，很明显需要考虑重新翻译该消息（这是一件好事）。

如果您只是更正拼写或进行一些其他绝对不需要翻译的更改，那么在资源文件中更新该字符串的 ID 是一件简单的事情。

也就是说，我目前正在评估是否将这种 I18N 的方式推进到一个新项目中，所以很高兴听到一些关于为什么它可能不是一个好主意的想法。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-09T20:54:42.053

我强烈不同意理查德哈里森的回答，他说这是“唯一的方法”。亲爱的提问者，不要相信说这是唯一方法的答案，因为“唯一方法”不存在。

这是恕我直言与理查兹方法相比具有一些优势的另一种方法：

*   首先使用英文字符串的原始版本作为 Original。
*   不要显示这些原始字符串，但要为英语创建一个翻译文件
*   将原始字符串复制到开头的翻译中

好处：

*   可读代码
*   如果与您的视图显示的不同，您的代码中的文本非常接近
*   如果要更改英文文本，则不要更改原始字符串，而是更改翻译
*   如果您想将同一件事翻译两次，只需编写一个稍微不同的原始字符串或添加“这个和那个的版本”，你仍然有一个完全可读的代码

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-10-19T19:00:07.053

我使用有意义的 ID，例如“ `welcome_back_1`”，这将是“ `welcome back, %1`”等。我总是将英语作为我的“基础”语言，所以在最坏的情况下，当特定语言没有消息 ID 时，我会使用英语。

我不喜欢使用实际的英语短语作为消息 ID，因为如果英语发生变化，ID 也会发生变化。如果您使用一些自动化工具，这可能不会对您产生太大影响，但它让我很困扰。我不喜欢使用简单的代码（比如 msg3975），因为它们没有任何意义，所以阅读代码会更加困难，除非你到处乱扔评论​​。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-19T15:44:20.787

ID 为英语的原因是，如果由于任何原因翻译失败 - 当前语言和令牌的翻译不可用或其他错误，则返回 ID。当然，这假设开发人员正在编写原始英文文本，而不是某些文档人员。

此外，如果英文文本发生变化，那么其他翻译可能需要更新？

在实践中，我们也使用纯 ID 而不是英文文本，但这确实意味着我们必须做很多额外的工作才能默认为英文。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2017-10-16T19:59:58.307

有很多事情要考虑，但回答并不那么容易。

# 使用简单的英语

**优点**

*   易于编写和阅读代码
*   在大多数情况下，即使没有在代码中运行翻译功能，它也能工作

**缺点**

*   参与的程序员也必须是好的文案 :)
*   您需要完全用英语编写正确、精确的文本，即使您需要运行的第一语言是其他语言（例如，我们正在开始使用捷克语进行大量项目，稍后我们会将它们本地化为 EN）。
*   在很多情况下，您需要使用上下文。如果您从一开始就没有这样做，那么以后添加它们需要做很多工作。解释一下：在英语中，一个词可以有多种不同的意思——你需要使用上下文来区分它们——而且并不总是那么容易（order = sort order，或者它可以是采购订单）。
*   在此过程的后期纠正英语可能非常困难。源字符串的更正通常会导致已经翻译的短语丢失。仅仅因为您更正了英语，就将翻译松散为 3 种不同的语言是非常令人沮丧的。

# 使用键

**优点**

*   即使是英语，您也可以使用本地化平台功能。即我们正在使用可爱的 Crowdin 平台。有很多方便的工具 - 或者更确切地说是一个完整的工作流程 - 用于翻译管理：投票选择不同的翻译、翻译历史、词汇表（有助于保持翻译/语言的连贯性）、校对、批准等。使用密钥使这个过程变得很重要更顺畅。

*   发送英文文本进行校对等要容易得多。通常，让文案人员直接修改您的代码不是一个好主意:)

**缺点**

*   更复杂的项目设置。
*   更难使用 %d、%s 等。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-07-31T00:22:22.923

总之不要这样做。

英语中的相同单词/短语通常可以具有多个含义，并且每个含义都具有不同的翻译。

为您的字符串定义助记符 id，并将英语视为另一种语言。

同意其他发帖者的观点，即代码中的 id 数字是代码可读性的噩梦。

前本地化工程师

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-19T14:36:26.010

你不是已经回答了你自己的问题吗？:)

显然，如果您打算支持您的应用程序的 i18n，您应该对所有语言实现一视同仁。如果有人决定需要更改字符串，您可以在所有语言文件中进行类似的更改。带有签入的元数据应将所有语言文件分组到同一个更改中。如果您的“默认”语言处理方式不同，则维护起来会更加困难。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-01-30T11:12:52.810

归根结底，翻译人员应该能够坐下来更改每种语言的文本（以便它们在含义上匹配），而不必让已经完成工作的程序员参与进来。

这让我觉得正确的答案是使用修改后的版本来`gettext`放置这样的字符串

```
_(id, backup_text, context)

_('ABOUT_ME', 'About Me', 'HOMEPAGE') 
```

上下文是可选的

为什么这样？因为您需要使用唯一 ID 而不是可能在其他地方重复的英文文本来识别系统中的文本。

您还应该将备份、id 和上下文保存在代码中的同一位置，以减少差异。

id 也必须是可读的，这带来了同义词和重复使用的问题（即使作为 ids），我们可以像“HOMEPAGE_ABOUT_ME”或“MAIL_LETTER”这样的 ids 前缀，但是

1.  人们一开始就忘记这样做，以后改变它是一个问题
2.  系统可以更灵活地按 id 和 context 进行分组

这就是为什么我还在最后添加了上下文变量

备份文本几乎可以是任何内容，甚至可以是“[ABOUT_ME@HOMEPAGE 文本加载失败，请联系 example@example.com]”

它不适用于当前的 gettext 编辑程序，例如“poedit”，但我认为您可以为翻译定义自定义变量名称，例如“t()”，开头没有下划线。

我知道 gettext 也支持上下文，但它没有很好的文档记录或广泛使用。

PS我不确定执行良好和可扩展代码的最佳变量顺序，因此欢迎提出建议。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-19T16:20:37.877

我什至会说你永远（对于从不的大多数值）想要使用自由文本作为任何东西的键。想象一下，如果 SO 使用查询标题作为此页面的键。如果有人链接到它，然后编辑了标题，则该链接不再有效。

你的问题是相似的，除了你还要负责更新所有的链接......

就像 Douglas Leeder 提到的那样，您可能想要做的是使用英语作为默认（备用）语言，尽管使用英语和另一种语言混合使用的界面非常令人困惑（但也有点有趣）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-12-20T18:55:08.873

除了上述考虑之外，在许多情况下，您希望“键”（msgid）与源文本（英语）不同。例如，在 HTML 视图中，我可能想说 [yyyy] 该锚标记的目的地和标签取决于用户的语言环境。例如，它可能是一个社交网络的链接，在美国它是 Facebook，但在中国它是微博。所以 MsgIds 可能类似于 socialSiteUrl 和 socialSiteLabel。

我使用混合。

对于我认为不会有冲突/变化/奇怪含义的基本字符串，我会让键与英语相同。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-03-27T00:51:26.167

我们使用荷兰语。字符串应该用作者的母语编写；这使得与翻译人员的交流不太容易出错，因为作者可以用他们的母语与他们交流。

# .net - NHibernate 自定义 SQL 对象创建

> ID：216480
> 
> 赞同：3
> 
> 时间：2008-10-19T14:33:22.210
> 
> 标签：.net, sql, nhibernate, orm

稍微简化的示例情况：我有实体 A 和 B，它们是令人难以置信的“重”域对象。从数据库中加载一个非常重要。然后我有一个实体 C，它是一个非常简单的对象，它有一个标签字符串、一个 A 和一个 B——都是惰性的。

我正在做一些低级查询来创建巨大的 C 列表，所以我确切地知道我需要为 CA 和 CB 保存哪些 ID，但我*不想*加载整个对象并将它们设置为属性，因为开销是疯狂的。

相反，我只想将 ID 直接插入到我的 C 实体中，然后仅在需要时才完全加载其上的 A 和 B 属性。

我在文档中看到了`<sql-insert/>`标签，但该部分*真的很*稀疏。

有什么方法可以在 NHibernate 框架内做我想做的事情，还是应该只做原始 SQL？如果可能的话，我试图保持数据库的可移植性，这让我回避了原始选项。似乎必须有一个更好的方法我错过了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T00:15:08.837

我不知道 NHibernate 是否允许这样做（在相同的基础数据上分离对象），但通常我会制作“摘要”对象，这些对象可以上转换为成熟的对象（即使对成熟的对象进行延迟加载）。我通常使用代码生成或手动 ORM 层来执行此操作。

大型集合通常是摘要，然后如果摘要未公开所需的属性或方法，则将它们上转换为完整的对象以供调用或传递等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T14:38:00.203

丹——不确定这是否会在没有测试的情况下工作，但值得一试。我猜你已经有了要添加到 C 中的 ID - 所以将你的关联（我假设是多对一）设置为 insert="false" 和 update="false" （可能是 cascade="none " 也可以使用）。然后创建 A 和 B 实体的“空副本”，将 Id 添加到它们，将它们添加到 C 并尝试保存 C (Session.SaveOrUpdateCopy(C))。希望 NHibernate 不会尝试将新的 A 和 B 对象添加到各自的表中，而只是在 C 表中设置正确的 Id——这样您就不必加载 A 和 B 实体。

不好的部分是，如果您必须保存或更新 A 和 B，则必须直接进行。另一个不好的部分是我没有时间测试这个，所以我不知道它是否会起作用。

# groovy - 如何在 groovy 脚本中枚举所有定义的变量

> ID：216484
> 
> 赞同：20
> 
> 时间：2008-10-19T14:37:38.287
> 
> 标签：groovy, scripting

我有一个 groovy 脚本，运行时上下文中的变量数量未知，如何找到它们并打印每个变量的名称和值？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-19T15:08:23.997

好吧，如果您使用的是简单的脚本（不使用“def”关键字），您定义的变量将存储在绑定中，您可以像这样获取它们：

```
foo = "abc"
bar = "def"

if (true) {
    baz = "ghi"
    this.binding.variables.each {k,v -> println "$k = $v"}
} 
```

印刷：

```
 foo = abc 
    baz = ghi 
    args = {} 
    bar = def 
```

我不知道枚举用“def”关键字定义的变量的简单方法，但我会感兴趣地关注这个问题，看看其他人是否知道如何。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-15T22:23:10.360

实际上，Ted 的答案也适用于“定义”变量。

```
def foo = "abc"
def bar = "def"

如果真实） {
    baz =“吉”
    this.binding.variables.each {k,v -> println "$k = $v"}
}

```

产量

```
baz = ghi
__ = [空，空，空]
foo = abc
_ = 空
酒吧 = 定义

```

我不确定 _-variables 表示什么，但我相信你可以解决它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-12-29T14:21:26.110

Groovy 对象包含方法 - `dump()` [https://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Object.html](https://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Object.html)

```
String  dump()
Generates a detailed dump string of an object showing its class, hashCode and fields. 
```

例子：

```
class MyClass {
    def foo = "abc"
    def bar = "def"
}

println(new MyClass().dump()) 
```

标准输出：`<MyClass@1fa268de foo=abc bar=def>`

# python - 开发网络服务器与生产网络服务器有多接近？

> ID：216489
> 
> 赞同：5
> 
> 时间：2008-10-19T14:45:47.303
> 
> 标签：python, webserver, web-frameworks

大多数 python 框架都会有某种类型的开发网络服务器，它会发出警告，指出它不能用作生产服务器。它们与生产等效物有多大不同？

我还没有完全决定要使用哪个框架，更不用说使用什么生产服务器了，所以我很难将其归结为“将开发服务器 x 与生产服务器 y 进行比较”。话虽如此，让我把问题说得更准确一点：在您过去使用 python 框架的经验中，一旦在开发环境中开发应用程序，您需要花费多少时间让应用程序启动并在生产系统上运行服务器？或者您是否跳过了开发服务器并在更像您将在生产中使用的服务器上开发您的应用程序？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-19T16:36:03.337

考虑到可用资源，较低的环境应尽量与生产环境匹配。这适用于所有开发工作，无论它们是基于 Python 还是基于 Web。实际上，大多数组织都不愿意花这种钱。在这种情况下，尽量使生产环境正下方的环境尽可能接近生产环境。

要记住的一些变​​量是：

*   很多时候，生产中有多台机器（应用服务器、数据库服务器、Web 服务器、负载平衡器、防火墙等）。记住这些。

*   操作系统

*   CPU 数量。从单 CPU 较低的环境迁移到多核生产环境可能会暴露未经测试的多线程问题

*   负载均衡。很多时候较低的环境没有负载平衡。如果您正在跨多个生产应用程序服务器复制会话（例如），您应该尝试在较低的环境中执行相同的操作

*   软件/库版本

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T14:50:57.400

通常，它们在运行应用程序所需的设置方面是相同的，包括环境设置。
但是，客户通常拥有在处理能力和其他硬件资源方面不太强大的开发系统。我已经看到在开发环境中使用它们的虚拟服务器，因为它们通常有多个并行进行的项目，这有助于他们降低成本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T16:50:49.467

我用 django 开发。我们拥有的生产服务器是远程的，因此使用它进行开发很痛苦。因此，起初，我创建了一个 vm 并尝试尽可能地匹配 prod 服务器的环境。在某些时候，vm 被冲洗掉了（由于不相关的事件）。我当时盘点了一下情况，意识到使用定制的 vm 进行开发确实没有充分的理由。由于应用程序可用的资源与 prod 服务器不同，因此无论如何（绝对意义上）对时间查询都没有好处。

也就是说，我现在使用 django 的内置开发服务器和 sqlite 进行开发，使用 apache/wsgi 和 postgresql 进行生产。只要双方都满足 python 依赖项，它就是 100% 兼容的。唯一的潜在问题是编写原始 sql 而不是使用 orm。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T15:06:47.587

理想情况下，开发、测试和生产服务器的逻辑配置应该相同。它们应该具有相同版本的操作系统、Web 服务器和用于运行应用程序的所有其他软件资产。但是，取决于您的环境将裁剪的强度 - 在开发机器上手工复制的图像/脚本等无法通过测试和/或生产。

为了尽量减少这种情况，您可能需要某种可以将您从一个阶段移动到下一个阶段的推送脚本，即 PushVersionDev、PushVesionTest、PushVersionProd。理想情况下，这应该是具有目标服务器参数的相同脚本，这些参数代表您将应用程序移动到各个阶段所需的所有内容。

我会推荐阅读 Theo Schlossnagle 的书[Scalable Internet Architectures](http://astore.amazon.com/possiboutpos-20/detail/067232699X/105-2710068-5490858)以获得更多关于这个问题的想法。

直接回答您的问题....一旦您的应用程序经过测试和实施，投入生产的时间并不是很好 - 部署操作系统、Web 服务器、支持框架（如果它们需要安装、应用程序，您就可以开始了）。从裸机上我看到 linux 服务器上线 1 小时，windows 大约 90 分钟。如果您的操作系统和 Web 服务器运行时间更短……分钟。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T03:38:02.843

您的登台环境应该模仿您的生产环境。开发更像是一个游乐场，对开发环境的控制不应该那么严格。但是，开发环境应该定期从生产环境中刷新（例如，将.prod 数据复制到dev db，关闭dev 上在prod 上关闭的端口等）。

理想情况下，dev、stage 和 prod 都在不同的机器上。单独的机器可以是单独的物理机，也可以是同一物理机上的虚拟机，具体取决于预算/需求。

# c++ - 外部内联做什么？

> ID：216510
> 
> 赞同：102
> 
> 时间：2008-10-19T15:09:27.987
> 
> 标签：c++, c, extern, inline-functions

我知道这`inline`本身就是对编译器的建议，它可能会或可能不会内联函数，它也会产生可链接的目标代码。

我认为这样`static inline`做是一样的（可能是内联的，也可能不是内联的），但在内联时不会产生可链接的目标代码（因为没有其他模块可以链接到它）。

哪里`extern inline`适合图片？

假设我想用一个内联函数替换一个预处理器宏，并要求这个函数被内联（例如，因为它使用`__FILE__`and`__LINE__`宏，应该为调用者而不是这个被调用函数解析）。也就是说，如果函数没有内联，我想查看编译器或链接器错误。这样做`extern inline`吗？（我认为，如果没有，除了坚持使用宏之外，没有其他方法可以实现这种行为。）

C++ 和 C 之间有区别吗？

不同的编译器供应商和版本之间是否存在差异？

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2008-10-19T15:35:07.343

在 K&R C 或 C89 中，内联不是语言的一部分。许多编译器将其作为扩展实现，但没有定义关于它如何工作的语义。GCC 是最先实现内联的，并引入了`inline`、`static inline`和`extern inline`结构；大多数 C99 之前的编译器通常会效仿。

# GNU89：

*   `inline`: 该函数可能是内联的（虽然这只是一个提示）。离线版本始终会发出并在外部可见。因此，您只能在一个编译单元中定义这样的内联，而其他每个编译单元都需要将其视为一个外联函数（否则您将在链接时得到重复的符号）。
*   `extern inline`不会生成外联版本，但可能会调用一个（因此您必须在其他编译单元中定义它。但是，单定义规则适用；外联版本必须具有与inline 在这里提供，以防编译器调用它。
*   `static inline`不会生成外部可见的离线版本，尽管它可能会生成文件静态版本。单一定义规则不适用，因为从来没有发出外部符号，也没有调用一个。

# C99（或 GNU99）：

*   `inline`: 像 GNU89 "extern inline"; 没有发出外部可见的函数，但可能会调用一个函数，因此必须存在
*   `extern inline`: 像 GNU89 "inline": 发出外部可见的代码，所以最多一个翻译单元可以使用它。
*   `static inline`：就像 GNU89 “静态内联”。这是gnu89和c99之间唯一的便携式

# C++：

在任何地方都内联的函数必须在任何地方都内联，并且具有相同的定义。编译器/链接器将整理符号的多个实例。没有`static inline`or的定义`extern inline`，尽管许多编译器都有它们（通常遵循 gnu89 模型）。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-10-19T15:15:57.320

我相信您基于此声明误解了 __FILE__ 和 __LINE__ ：

> 因为它使用应该为调用者解析的 __FILE__ 和 __LINE__ 宏，而不是这个被调用函数

编译有几个阶段，预处理是第一个。__FILE__ 和 __LINE__ 在该阶段被替换。因此，当编译器可以考虑内联函数时，它们已经被替换了。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-19T21:49:24.763

听起来你正试图写这样的东西：

```
inline void printLocation()
{
  cout <<"You're at " __FILE__ ", line number" __LINE__;
}

{
...
  printLocation();
...
  printLocation();
...
  printLocation(); 
```

并希望您每次都能打印出不同的值。正如 Don 所说，您不会，因为 __FILE__ 和 __LINE__ 是由预处理器实现的，但 inline 是由编译器实现的。因此，无论您从哪里调用 printLocation，都会得到相同的结果。

你可以让它工作的**唯一**方法是让 printLocation 成为一个宏。（是的，我知道...）

```
#define PRINT_LOCATION  {cout <<"You're at " __FILE__ ", line number" __LINE__}

...
  PRINT_LOCATION;
...
  PRINT_LOCATION;
... 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-07-08T07:02:06.677

我没有回答“它有什么作用？”，而是回答“我如何让它做我想做的事？” 有 5 种内联，在 GNU C89、标准 C99 和 C++ 中都可用。MSVC 有*一些*（注意我没有测试过 MSVC 代码）

## 总是内联，除非地址被占用

添加`__attribute__((always_inline))`到任何声明，然后使用以下情况之一来处理其地址被占用的可能性。

你可能永远不应该使用它，除非你需要它的语义（例如以某种方式影响程序集，或者使用`alloca`）。编译器通常比你更清楚它是否值得。

MSVC`__forceinline`看起来几乎相同，但显然它拒绝在其他编译器管理得很好的很多常见情况下（例如，当优化关闭时）内联。

## 内联并发出一个弱符号（如 C++，又名“让它工作”）

```
__attribute__((weak))
void foo(void);
inline void foo(void) { ... } 
```

请注意，这会留下一堆相同代码的副本，并且链接器会任意选择一个。

MSVC 在 C 模式下似乎没有完全等价的东西，尽管有一些类似的东西。`__declspec(selectany)`似乎只在谈论数据，所以可能不适用于函数？还有对[弱别名](https://stackoverflow.com/a/11529277/1405588)的链接器支持，但这在这里有效吗？

## 内联，但从不发出任何符号（留下外部引用）

```
__attribute__((gnu_inline))
extern inline void foo(void) { ... } 
```

MSVC`__declspec(dllimport)`与实际定义（否则不寻常）相结合，据说可以做到这一点。

## 总是发出（对于一个 TU，解决前面的问题）

暗示的版本在 C++ 中发出一个弱符号，但在 C 的任一方言中发出一个强符号：

```
void foo(void);
inline void foo(void) { ... } 
```

或者您可以在没有提示的情况下执行此操作，这会在两种语言中发出一个强符号：

```
void foo(void) { ... } 
```

通常，当您提供定义时，您知道您的 TU 是什么语言，并且可能不需要太多内联。

`__declspec(dllexport)`据说MSVC 就是这样做的。

## 在每个 TU 中内联和发射

```
static inline void foo(void) { ... } 
```

* * *

对于除此之外的所有这些`static`，您可以在上面添加一个`void foo(void)`声明。这有助于编写干净的标头的“最佳实践”，然后`#include`使用内联定义创建一个单独的文件。然后，如果使用 C 风格的内联，则`#define`在一个专用 TU 中使用不同的宏来提供外联定义。

不要忘记`extern "C"`是否可以从 C 和 C++ 中使用标头！

* * *

还有一些相关的事情：

## 从不内联

添加`__attribute__((noinline))`到函数的任何声明。

MSVC 有`__declspec(noinline)`，但它被记录为仅适用于成员函数。但是，我已经看到提到可能阻止内联的“安全属性”？

## 如果可能，强制将其他函数内联到这个函数中。

添加`__attribute__((flatten))`到函数的任何声明。

请注意，`noinline`它比这更强大，其定义在编译时未知的函数也是如此。

MSVC 似乎没有等价物。我见过一次提到`[[msvc::forceinline_calls]]`（应用于语句或块），但它不是递归的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-19T21:59:14.040

内联、静态内联和外部内联的情况很复杂，尤其是因为 gcc 和 C99 为它们的行为定义了稍微不同的含义（可能也是 C++）。[您可以在此处](http://www.greenend.org.uk/rjk/2003/03/inline.html)找到有关它们在 C 中的功能的一些有用且详细的信息。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-08-06T21:32:48.457

宏是您的选择，而不是内联函数。宏统治内联函数的罕见情况。请尝试以下操作：我编写了这个“MACRO MAGIC”代码，它应该可以工作！在 gcc/g++ Ubuntu 10.04 上测试

```
//(c) 2012 enthusiasticgeek (LOGGING example for StackOverflow)

#ifdef __cplusplus

#include <cstdio>
#include <cstring>

#else

#include <stdio.h>
#include <string.h>

#endif

//=========== MACRO MAGIC BEGINS ============

//Trim full file path
#define __SFILE__ (strrchr(__FILE__,'/') ? strrchr(__FILE__,'/')+1 : __FILE__ )

#define STRINGIFY_N(x) #x
#define TOSTRING_N(x) STRINGIFY_N(x)
#define _LINE (TOSTRING_N(__LINE__))

#define LOG(x, s...) printf("(%s:%s:%s)"  x "\n" , __SFILE__, __func__, _LINE, ## s);

//=========== MACRO MAGIC ENDS ============

int main (int argc, char** argv) {

  LOG("Greetings StackOverflow! - from enthusiasticgeek\n");

  return 0;
} 
```

**对于多个文件，在单独的头文件中定义这些宏，包括每个 c/cc/cxx/cpp 文件中的相同。**请尽可能使用内联函数或 const 标识符（视情况而定）而不是宏。

# service - 分析 WebMethods 服务？

> ID：216511
> 
> 赞同：0
> 
> 时间：2008-10-19T15:11:49.247
> 
> 标签：service, soa, webmethods

哪些技术可用于分析在 WebMethods Integration Server 中运行的服务？

也就是说，要获得表明哪些部分将从优化中受益最多的数据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-03T15:54:51.600

[从http://www.wrightia.com/serviceprofiler.html](http://www.wrightia.com/serviceprofiler.html)检查“WebMethods 集成服务器的服务分析器”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:33:21.897

你有没有想过尝试[webMUnit](http://webmunit.sourceforge.net)？您可以围绕某些方法调用添加时间记录，以了解执行操作需要多长时间。但是，时间记录本身也会增加开销，所以请记住这一点。

或者可能是内存分析器，例如 YourKit Profiler、JProfiler、JProbe 等？我不确定这些，因为我自己从未使用过它们，但它们可能会帮助你知道什么占用了大量内存等

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-04T23:35:27.630

另一个可以做到这一点的工具是 Green Hat tester，它是一个用于测试 webMethods 的商业工具。如果您在运行测试时使用它的报告功能，则会生成分析信息。

António Abreu 的链接工具是一种更专用的分析工具，并且是最简单的解决方案。

如果您想要一个“开箱即用”的解决方案，您可以为调用的服务打开服务审计并自己做一些工作，但这需要一些手动操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-16T21:03:42.580

您可以在这里找到一种新的 IS 服务监控工具：[Rich Statistics](http://techcommunity.softwareag.com/web/guest/pwiki/-/wiki/Main/RichStatistics+-+how+to+easly+monitor+the+service+activity+on+your+Integration+Server)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T12:21:20.070

我只参与了开发阶段，所以我不知道细节，但是我们的系统经过了重负载测试，并且在此过程中对硬件进行了监控，它实际上给出了一些关于瓶颈的反馈。使用了 JMeter 和 sar。

# vb.net - Linq to SQL中的Sum和Group By？

> ID：216513
> 
> 赞同：18
> 
> 时间：2008-10-19T15:12:41.147
> 
> 标签：vb.net, linq-to-sql

刚刚开始使用 Linq to SQL，所以请原谅新手的问题。我正在尝试在 Linq to SQL (VB.NET) 中重现以下（工作）查询：

```
Select
    f.Title,
    TotalArea = Sum(c.Area)
From Firms f
Left Join Concessions c on c.FirmID = f.FirmID
Group By f.Title
Order by Sum(c.Area) DESC 
```

（一家公司有许多特许权；一个特许权的面积以公顷为单位。我想要一份公司列表，从所有特许权中总面积最大的公司开始。）

我想像这样的东西作为 Linq to SQL 等价物（**伪代码**）

```
From f As Firm In Db.Firms _
Order By f.Concessions.Sum(Area) 
```

……但这是不对的。谁能指出我正确的方向？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-19T15:50:34.583

## 回答

这是正确的 Linq to SQL 等价物

```
From c In Concessions _
Join f In Firms on f.FirmID equals c.FirmID _
Group by f.Title _
Into TotalArea = sum(c.OfficialArea)  _
Order by TotalArea Descending _
Select Title, TotalArea 
```

感谢@CMS 将我指向[LinqPad](http://www.linqpad.net/) - 多么棒的工具。您只需将其指向您的数据库，您就可以开始运行了。不仅包含数百个示例，而且您可以针对包含的实时数据库运行它们。从提供的样本开始，我能够在几分钟内完成上述查询。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-19T15:24:05.760

[在这里](http://msdn.microsoft.com/en-us/vbasic/bb737922.aspx)你可以找到很多关于使用聚合函数和分组的例子，另外我非常推荐你[LinqPad](http://www.linqpad.net/)，它是一个很好的工具来测试你的查询，它是学习 LINQ 的好方法，它预装了 200 个例子。

# inheritance - 面向对象的最佳实践——继承 v 组合 v 接口

> ID：216523
> 
> 赞同：39
> 
> 时间：2008-10-19T15:22:34.170
> 
> 标签：inheritance, oop, composition

我想问一个关于如何处理简单的面向对象设计问题的问题。对于解决这种情况的最佳方法，我有一些自己的想法，但我很想听听 Stack Overflow 社区的一些意见。相关在线文章的链接也值得赞赏。我正在使用 C#，但问题不是特定于语言的。

假设我正在编写一个视频商店应用程序，其数据库有一个`Person`表，其中包含、`PersonId`和`Name`字段。它还有一个表，它有一个链接到 a ，还有一个表也链接到。`DateOfBirth``Address``Staff``PersonId``Customer``PersonId`

一个简单的面向对象的方法是说`Customer`“是” `Person`，因此创建类有点像这样：

```
class Person {
    public int PersonId { get; set; }
    public string Name { get; set; }
    public DateTime DateOfBirth { get; set; }
    public string Address { get; set; }
}

class Customer : Person {
    public int CustomerId { get; set; }
    public DateTime JoinedDate { get; set; }
}

class Staff : Person {
    public int StaffId { get; set; }
    public string JobTitle { get; set; }
} 
```

现在我们可以编写一个函数来向所有客户发送电子邮件：

```
static void SendEmailToCustomers(IEnumerable<Person> everyone) { 
    foreach(Person p in everyone)
        if(p is Customer)
            SendEmail(p);
} 
```

这个系统运行良好，直到我们有一个既是客户又是员工的人。假设我们真的不希望我们的`everyone`列表中有两次相同的人，一次作为 a`Customer`一次作为 a `Staff`，我们是否可以在以下之间做出任意选择：

```
class StaffCustomer : Customer { ... 
```

和

```
class StaffCustomer : Staff { ... 
```

显然只有这两个中的第一个不会破坏该`SendEmailToCustomers`功能。

那你会怎么做？

*   使类具有对 a和类`Person`的可选引用？`StaffDetails``CustomerDetails`
*   创建一个新类，其中包含一个`Person`，加上可选`StaffDetails`和`CustomerDetails`？
*   让所有东西都成为一个接口（例如`IPerson`, `IStaff`, `ICustomer`）并创建三个实现相应接口的类？
*   采取另一种完全不同的方法？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-19T15:34:59.433

马克，这是一个有趣的问题。你会发现很多关于这个的意见。我不相信有一个“正确”的答案。这是一个很好的例子，说明严格的层次对象设计在构建系统后确实会导致问题。

例如，假设您使用“客户”和“员工”类。你部署你的系统，一切都很开心。几周后，有人指出他们既是“员工”又是“客户”，他们没有收到客户的电子邮件。在这种情况下，您需要进行大量代码更改（重新设计，而不是重构）。

我相信，如果您尝试拥有一组派生类来实现人员及其角色的所有排列和组合，那将过于复杂且难以维护。鉴于上述示例非常简单，尤其如此 - 在大多数实际应用中，事情会更加复杂。

对于您在这里的示例，我会选择“采用另一种完全不同的方法”。我将实现 Person 类并在其中包含一个“角色”集合。每个人都可以有一个或多个角色，例如“客户”、“员工”和“供应商”。

这将使在发现新需求时添加角色变得更加容易。例如，您可能只是有一个基本的“角色”类，并从中派生出新的角色。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-19T15:51:32.647

您可能需要考虑使用[Party 和 Accountability 模式](http://martinfowler.com/apsupp/accountability.pdf)

这样，Person 将拥有一个 Accountabilities 的集合，其类型可能是 Customer 或 Staff。

如果您稍后添加更多关系类型，该模型也会更简单。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-19T15:29:04.453

纯粹的方法是：让一切都成为接口。作为实现细节，您可以选择使用任何各种形式的组合或实现继承。由于这些是实现细节，它们对您的公共 API 无关紧要，因此您可以自由选择让您的生活更简单的方法。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-20T09:34:42.670

一个人是一个人，而客户只是一个人可能不时采用的角色。Man 和 Woman 将是继承 Person 的候选人，但 Customer 是一个不同的概念。

Liskov 替换原则说，我们必须能够在引用了基类的情况下使用派生类，而无需知道它。让 Customer 继承 Person 会违反这一点。客户也可能是组织所扮演的角色。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-19T18:18:46.670

让我知道我是否正确理解了 Foredecker 的答案。这是我的代码（在 Python 中；抱歉，我不懂 C#）。唯一的区别是，如果一个人“是客户”，我不会通知某事，如果他的角色之一“对”那件事“感兴趣”，我会这样做。这足够灵活吗？

```
# --------- PERSON ----------------

class Person:
    def __init__(self, personId, name, dateOfBirth, address):
        self.personId = personId
        self.name = name
        self.dateOfBirth = dateOfBirth
        self.address = address
        self.roles = []

    def addRole(self, role):
        self.roles.append(role)

    def interestedIn(self, subject):
        for role in self.roles:
            if role.interestedIn(subject):
                return True
        return False

    def sendEmail(self, email):
        # send the email
        print "Sent email to", self.name

# --------- ROLE ----------------

NEW_DVDS = 1
NEW_SCHEDULE = 2

class Role:
    def __init__(self):
        self.interests = []

    def interestedIn(self, subject):
        return subject in self.interests

class CustomerRole(Role):
    def __init__(self, customerId, joinedDate):
        self.customerId = customerId
        self.joinedDate = joinedDate
        self.interests.append(NEW_DVDS)

class StaffRole(Role):
    def __init__(self, staffId, jobTitle):
        self.staffId = staffId
        self.jobTitle = jobTitle
        self.interests.append(NEW_SCHEDULE)

# --------- NOTIFY STUFF ----------------

def notifyNewDVDs(emailWithTitles):
    for person in persons:
        if person.interestedIn(NEW_DVDS):
            person.sendEmail(emailWithTitles) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-19T16:46:41.597

我会避免“is”检查（Java 中的“instanceof”）。一种解决方案是使用[装饰器模式](http://en.wikipedia.org/wiki/Decorator_pattern)。您可以创建一个装饰 Person 的 EmailablePerson ，其中 EmailablePerson 使用组合来保存 Person 的私有实例并将所有非电子邮件方法委托给 Person 对象。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-19T16:31:45.467

去年我们在大学研究这个问题，我们正在学习埃菲尔，所以我们使用了多重继承。无论如何，Foredecker 角色的替代方案似乎足够灵活。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-19T16:50:35.397

向作为员工的客户发送电子邮件有什么问题？如果他是客户，则可以向他发送电子邮件。我这样想错了吗？为什么要把“每个人”作为您的电子邮件列表？由于我们处理的是“sendEmailToCustomer”方法而不是“sendEmailToEveryone”方法，因此拥有一个客户列表会更好吗？即使您想使用“所有人”列表，您也不能在该列表中允许重复。

如果通过大量重新设计都无法实现这些，我将使用第一个 Foredecker 答案，并且可能您应该为每个人分配一些角色。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-19T18:24:04.380

您的类只是数据结构：它们都没有任何行为，只有 getter 和 setter。继承在这里是不合适的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-22T07:44:12.553

采取另一种完全不同的方法：StaffCustomer 类的问题在于，您的员工可能一开始只是员工，后来成为客户，因此您需要将他们作为员工删除并创建 StaffCustomer 类的新实例。也许在“isCustomer”的 Staff 类中的一个简单的布尔值将允许我们的每个人列表（可能是通过从适当的表中获取所有客户和所有员工而编译的）不获取员工，因为它会知道它已经被包含为客户。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-08-03T17:34:32.073

这里还有一些提示：从“甚至不想这样做”的类别中，这里有一些遇到的不良代码示例：

Finder 方法返回对象

问题：根据找到的出现次数，finder 方法返回一个表示出现次数的数字——或者！如果只找到一个返回实际对象。

不要这样做！这是最糟糕的编码实践之一，它会引入歧义并以某种方式使代码混乱，以至于当不同的开发人员参与进来时，她或他会因为这样做而讨厌你。

解决方案：如果需要这样的 2 个功能：计数和获取实例确实会创建 2 个方法，一个返回计数，一个返回实例，但从来没有一个方法可以双向使用。

问题：一个衍生的不好的做法是，当查找器方法返回找到的一个单一事件时，或者如果找到多个事件，则返回一个事件数组。这种懒惰的编程风格通常由使用前一种的程序员完成。

解决方案：如果只找到一次，我将返回一个长度为 1(one) 的数组，如果找到更多的匹配项，则返回一个长度 >1 的数组。此外，根据应用程序，根本找不到任何事件将返回 null 或长度为 0 的数组。

对接口进行编程并使用协变返回类型

问题：对接口进行编程并在调用代码中使用协变返回类型和强制转换。

解决方案：使用接口中定义的相同超类型来定义应该指向返回值的变量。这使编程保持接口方法和您的代码干净。

超过 1000 行的类是一个潜伏的危险 超过 100 行的方法也是一个潜伏的危险！

问题：一些开发人员在一个类/方法中填充了太多功能，懒得破坏功能——这会导致低内聚甚至高耦合——这与 OOP 中一个非常重要的原则相反！解决方案：避免使用过多的内部/嵌套类——这些类只能根据需要使用，您不必养成使用它们的习惯！使用它们可能会导致更多问题，例如限制继承。注意代码重复！相同或过于相似的代码可能已经存在于某些超类型实现中，或者可能存在于另一个类中。如果它在另一个不是超类型的类中，那么您也违反了内聚规则。注意静态方法——也许你需要一个实用程序类来添加！
更多信息： [http ://centraladvisor.com/it/oop-what-are-the-best-practices-in-oop](http://centraladvisor.com/it/oop-what-are-the-best-practices-in-oop)

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2013-07-16T16:31:47.377

您可能不想为此使用继承。试试这个：

```
class Person {
    public int PersonId { get; set; }
    public string Name { get; set; }
    public DateTime DateOfBirth { get; set; }
    public string Address { get; set; }
}

class Customer{
    public Person PersonInfo;
    public int CustomerId { get; set; }
    public DateTime JoinedDate { get; set; }
}

class Staff {
    public Person PersonInfo;
    public int StaffId { get; set; }
    public string JobTitle { get; set; }
} 
```

# javascript - 将变量从一个 HTML 页面传递到另一个页面的最佳实践是什么？

> ID：216536
> 
> 赞同：6
> 
> 时间：2008-10-19T15:28:40.570
> 
> 标签：javascript, html, grails, dojo

我对 Web 应用程序编程比较陌生，所以我希望这个问题对每个人来说都不是太基础。

我创建了一个 HTML 页面，其 FORM 包含一个 dojox 数据网格 (v1.2)，其中填充了不同杂货项目的描述行。用户选择感兴趣的商品后，点击“提交”按钮。

此时，我可以获取 javascript 函数将项目 ID 号存储为 javascript 变量，但我不知道如何将此 ID 传递到后续的 HTML 页面。

我应该将 ID 作为 URL 查询字符串参数传递吗？还有其他更好的方法吗？

编辑：整个过程就像一个购物车。用户将从网格中选择项目，然后在下一页上，用户将填写一些详细信息，然后结帐。

我还应该提到我正在使用 grails，所以这发生在 GSP 页面中，但目前它只包含 HTML。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-19T18:36:20.083

您可以只使用隐藏的输入字段；作为表单的一部分传输。

```
<html>
  <head>
  </head>
  <body>
    <script type="text/javascript">
      function updateSelectedItemId() {
        document.myForm.selectedItemId.value = 2;
        alert(document.myForm.selectedItemId.value);

       // For you this would place the selected item id in the hidden
       // field in stead of 2, and submit the form in stead of alert
      }
    </script>

    Your grid comes here; it need not be in the form

    <form name="myForm">
      <input type="hidden" name="selectedItemId" value="XXX">
      The submit button must be in the form.
      <input type="button" value="changeSelectedItem" onClick="updateSelectedItemId()">
    </form>
  </body>
</html> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T15:32:07.880

这很好，但更好的是使用一些脚本语言，例如 JSP、PHP、ASP....并且您可以使用简单的 POST 和 GET 方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-19T15:47:08.597

最好的方法（恕我直言）是将其包含在 URL 中

href="http://NewPage.htm?var=value";

encodeUriComponent 一个字符串值

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T15:48:26.723

使用 POST 将变量发送到另一个页面的一种方法是使指向后续页面的链接成为表单上的提交输入，其中 action 属性是您的目标页面。对于您拥有的每个变量，您可以在此表单中使用“隐藏”属性类型的输入，仅使按钮可见。

另一种选择是使用 PHP 之类的东西在页面上动态生成链接，您基本上可以在其中重新填充当前的 GET 查询。

最后，您始终可以将此信息存储在 PHP $_SESSION 数组中，而不必担心通过站点导航不断地传递这些变量。

您的选择将取决于您希望保留相同变量的导航选项的数量。它还取决于您希望后端的安全程度以及您希望向高级网络用户披露的数量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T19:12:45.080

如果您只需要后续页面上的 ID，则可以将 id 作为查询字符串参数传递。

但是有时您需要传递更多信息并将各种参数传递到不同的页面，并且必须为不同的页面维护不同的参数集可能会有点麻烦。在这种情况下，我建议您在表单上保留一个隐藏字段并创建一个参数对象来存储您的每个参数。使用 JSON 序列化参数对象并将其存储在隐藏字段中。将表单发送回服务器。当下一页加载时，反序列化对象并检索您需要的值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T15:50:18.013

假设您仅限于使用 html 页面，我认为最好的方法是将查询字符串上的 id 传递到下一页。从下一页的查询字符串中拉回该值相对容易。如果您需要更隐蔽地传递变量（或者您需要变量持续存在多个页面），您还可以设置一个 cookie 并在下一页检索它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T17:10:40.410

Since you are trying to do this in a Grails application you do have a choice of using Flash scope. This might not make any sense if you want to go directly from one HTML page to the next as the scope would be defined in a controller. If you do not need to do any sort of processing between requests, I'd suggest using a hidden form field to keep it simple.

[http://grails.org/Controllers+-+Controller+Scopes](http://grails.org/Controllers+-+Controller+Scopes)

# c# - 如果有任何格式，我如何格式化为仅包含小数

> ID：216538
> 
> 赞同：16
> 
> 时间：2008-10-19T15:30:41.657
> 
> 标签：c#, .net

如果我只想显示小数（如果它不是整数），那么格式化小数的最佳方法是什么。

例如：

```
decimal amount = 1000M
decimal vat = 12.50M 
```

格式化时我想要：

```
Amount: 1000 (not 1000.0000)
Vat: 12.5 (not 12.50) 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-19T15:40:57.177

```
 decimal one = 1000M;
    decimal two = 12.5M;

    Console.WriteLine(one.ToString("0.##"));
    Console.WriteLine(two.ToString("0.##")); 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-19T17:26:03.173

**更新了 user1676558 的以下评论**

试试这个：

```
decimal one = 1000M;    
decimal two = 12.5M;    
decimal three = 12.567M;    
Console.WriteLine(one.ToString("G"));    
Console.WriteLine(two.ToString("G"));
Console.WriteLine(three.ToString("G")); 
```

对于十进制值，“G”格式说明符的默认精度为 29 位，省略精度时始终使用定点表示法，因此与“0.######## #####################”。

与“0.##”不同，它将显示所有有效的小数位（一个小数不能超过 29 个小数位）。

“G29”格式说明符类似，但如果更紧凑则可以使用科学记数法（请参阅[标准数字格式字符串](https://msdn.microsoft.com/en-us/library/dwhawy9k(v=vs.110).aspx#Anchor_5)）。

因此：

```
decimal d = 0.0000000000000000000012M;
Console.WriteLine(d.ToString("G"));  // Uses fixed-point notation
Console.WriteLine(d.ToString("G29"); // Uses scientific notation 
```

# javascript - 如何唯一标识访问我网站的计算机？

> ID：216542
> 
> 赞同：200
> 
> 时间：2008-10-19T15:34:21.213
> 
> 标签：javascript, cookies, browser

我需要找出一种唯一标识访问我正在创建的网站的每台计算机的方法。有人对如何实现这一目标有任何建议吗？

因为我希望该解决方案适用于所有机器和所有浏览器（在合理范围内），所以我正在尝试使用 javascript 创建一个解决方案。

饼干不会做。

假设计算机没有发生硬件更改，我需要能够基本上创建一个计算机独有且可重复的 guid。我正在考虑的方向是获取网卡的 MAC 和其他此类信息，这些信息将识别访问该网站的机器。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2017-01-10T18:14:54.403

# 介绍

我不知道是否有或曾经有一种方法可以单独使用浏览器来唯一识别机器。主要原因是：

*   您需要将数据保存在用户计算机上。用户可以随时删除这些数据。除非您有办法重新创建对每台机器都是唯一的数据，否则您将陷入困境。
*   验证。您需要防范欺骗、会话劫持等。

即使有办法在不使用 cookie 的情况下跟踪计算机，也总会有绕过它的方法和自动执行此操作的软件。如果您确实需要基于计算机跟踪某些内容，则必须编写本机应用程序（Apple Store / Android Store / Windows Program / 等）。

我可能无法回答您提出的问题，但我可以向您展示如何实施会话跟踪。通过会话跟踪，您尝试跟踪浏览会话而不是访问您网站的计算机。通过跟踪会话，您的数据库架构将如下所示：

```
sesssion:
  sessionID: string
  // Global session data goes here

  computers: [{
     BrowserID: string
     ComputerID: string
     FingerprintID: string
     userID: string
     authToken: string
     ipAddresses: ["203.525....", "203.525...", ...]
     // Computer session data goes here
  }, ...] 
```

基于会话的跟踪的优点：

1.  对于已登录的用户，您始终可以从用户`username`//生成相同的会话 ID `password`。`email`
2.  您仍然可以使用`sessionID`.
3.  即使几个人使用同一台计算机（即网吧），如果他们登录，您也可以分别跟踪他们。

基于会话的跟踪的缺点：

1.  会话是基于浏览器的，而不是基于计算机的。如果用户使用 2 个不同的浏览器，它将导致 2 个不同的会话。如果这是一个问题，您可以在此处停止阅读。
2.  如果用户未登录，会话将过期。如果用户未登录，那么他们将使用访客会话，如果用户删除 cookie 和浏览器缓存，该会话将失效。

# 执行

有很多方法可以实现这一点。我认为我无法涵盖所有​​内容，我只会列出我最喜欢的内容，这将使这是一个**固执己见的答案**。请记住这一点。

## 基本

我将使用所谓的永久 cookie 来跟踪会话。即使用户删除他的 cookie 或更新他的浏览器，这些数据也会自动重新创建。但是，用户删除他们的 cookie 和浏览缓存后，它将无法生存。

为了实现这一点，我将使用浏览器缓存机制 ( [RFC](https://www.rfc-editor.org/rfc/rfc2616#section-13.3) )、WebStorage API ( [MDN](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) ) 和浏览器 cookie（[RFC](https://www.rfc-editor.org/rfc/rfc6265)、[Google Analytics](https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage)）。

## 合法的

为了使用跟踪 ID，您需要将它们添加到您的隐私政策和使用条款中，最好是在子标题**Tracking**下。`document.cookie`我们将在和 上使用以下键`window.localStorage`：

*   **_ga**：谷歌分析数据
*   **__utma** : 谷歌分析跟踪 cookie
*   **sid** : 会话ID

确保在所有使用跟踪的页面上包含指向您的隐私政策和使用条款的链接。

## 我在哪里存储我的会话数据？

您可以将会话数据存储在您的网站数据库或用户计算机上。由于我通常在使用 3rd 方应用程序（Google Analytics / Clicky / 等）的小型站点（超过 10,000 个连续连接）上工作，因此最好将数据存储在客户端计算机上。这具有以下优点：

1.  没有数据库查找/开销/负载/延迟/空间/等。
2.  用户可以随时删除他们的数据，而无需给我写烦人的电子邮件。

和缺点：

1.  必须对数据进行加密/解密和签名/验证，这会在客户端（还不错）和服务器（呸！）上产生 CPU 开销。
2.  当用户删除他们的 cookie 和缓存时，数据将被删除。（这才是我真正想要的）
3.  当用户离线时，数据无法用于分析。（仅针对当前浏览用户的分析）

## 用户界面

*   **BrowserID**：从浏览器用户代理字符串生成的唯一 id。`Browser|BrowserVersion|OS|OSVersion|Processor|MozzilaMajorVersion|GeckoMajorVersion`
*   **ComputerID**：由用户 IP 地址和 HTTPS 会话密钥生成。 `getISP(requestIP)|getHTTPSClientKey()`
*   **FingerPrintID**：基于 JavaScript 的指纹识别，基于修改后的[指纹.js](https://github.com/Valve/fingerprintjs2/)。`FingerPrint.get()`
*   **SessionID**：用户第一次访问站点时生成的随机密钥。`BrowserID|ComputerID|randombytes(256)`
*   **GoogleID**：从`__utma`cookie 生成。`getCookie(__utma).uniqueid`

## 机制

前几天我和女朋友一起看[温迪威廉姆斯的节目](http://www.wendyshow.com)，当主持人建议她的观众每月至少删除一次浏览器历史记录时，我感到非常震惊。删除浏览器历史记录通常有以下效果：

1.  删除访问网站的历史记录。
2.  删除 cookie 和`window.localStorage`(aww man)。

大多数现代浏览器都使这个选项很容易获得，但不要害怕朋友。因为有解决办法。浏览器有一个缓存机制来存储脚本/图像和其他东西。通常即使我们删除了我们的历史记录，这个浏览器缓存仍然存在。我们所需要的只是一种在此处存储数据的方法。有两种方法可以做到这一点。更好的方法是使用 SVG 图像并将我们的数据存储在其标签中。即使使用 Flash 禁用 JavaScript，这种方式仍然可以提取数据。但是，由于这有点复杂，我将演示使用 JSONP 的另一种方法（[维基百科](https://en.wikipedia.org/wiki/JSONP)）

**example.com/assets/js/tracking.js**（实际上是 tracking.php）

```
var now = new Date();
var window.__sid = "SessionID"; // Server generated

setCookie("sid", window.__sid, now.setFullYear(now.getFullYear() + 1, now.getMonth(), now.getDate() - 1));

if( "localStorage" in window ) {
  window.localStorage.setItem("sid", window.__sid);
} 
```

现在我们可以随时获取会话密钥：

`window.__sid || window.localStorage.getItem("sid") || getCookie("sid") || ""`

**如何让 tracking.js 粘在浏览器中？**

我们可以使用[Cache-Control](https://www.rfc-editor.org/rfc/rfc2616#section-14.9)、[Last-Modified](https://www.rfc-editor.org/rfc/rfc2616#section-14.29)和[ETag](https://www.rfc-editor.org/rfc/rfc2616#section-14.19) HTTP 标头来实现这一点。我们可以使用`SessionID`etag 标头的 as 值：

```
setHeaders({
  "ETag": SessionID,
  "Last-Modified": new Date(0).toUTCString(),
  "Cache-Control": "private, max-age=31536000, s-max-age=31536000, must-revalidate"
}) 
```

`Last-Modified`header 告诉浏览器这个文件基本上不会被修改。`Cache-Control`告诉代理和网关不要缓存文档，但告诉浏览器将其缓存 1 年。

下次浏览器请求该文档时，它将发送`If-Modified-Since`和`If-None-Match`标头。我们可以使用这些来返回`304 Not Modified`响应。

**example.com/assets/js/tracking.php**

```
$sid = getHeader("If-None-Match") ?: getHeader("if-none-match") ?: getHeader("IF-NONE-MATCH") ?: ""; 
$ifModifiedSince = hasHeader("If-Modified-Since") ?: hasHeader("if-modified-since") ?: hasHeader("IF-MODIFIED-SINCE");

if( validateSession($sid) ) {
  if( sessionExists($sid) ) {
    continueSession($sid);
    send304();
  } else {
    startSession($sid);
    send304();
  }
} else if( $ifModifiedSince ) {
  send304();
} else {
  startSession();
  send200();
} 
```

现在每次浏览器请求`tracking.js`我们的服务器都会响应`304 Not Modified`结果并强制执行`tracking.js`.

**我还是不明白。给我解释**

假设用户清除了他们的浏览历史并刷新了页面。用户计算机上唯一剩下的就是`tracking.js`浏览器缓存中的副本。当浏览器请求时，它会收到`tracking.js`一个`304 Not Modified`响应，导致它执行`tracking.js`收到的第一个版本。`tracking.js`执行并恢复`SessionID`被删除的。

## 验证

假设 Haxor X 在客户仍处于登录状态时窃取了他们的 cookie。我们如何保护他们？密码学和浏览器指纹来救援。记住我们最初的定义`SessionID`是：

```
BrowserID|ComputerID|randomBytes(256) 
```

我们可以将其更改为：

```
Timestamp|BrowserID|ComputerID|encrypt(randomBytes(256), hk)|sign(Timestamp|BrowserID|ComputerID|randomBytes(256), hk) 
```

哪里`hk = sign(Timestamp|BrowserID|ComputerID, serverKey)`。

现在我们可以验证我们`SessionID`使用以下算法：

```
if( getTimestamp($sid) is older than 1 year ) return false;
if( getBrowserID($sid) !== createBrowserID($_Request, $_Server) ) return false;
if( getComputerID($sid) !== createComputerID($_Request, $_Server) return false;

$hk = sign(getTimestamp($sid) + getBrowserID($sid) + getComputerID($sid), $SERVER["key"]);

if( !verify(getTimestamp($sid) + getBrowserID($sid) + getComputerID($sid) + decrypt(getRandomBytes($sid), hk), getSignature($sid), $hk) ) return false;

return true; 
```

现在，为了让 Haxor 的攻击起作用，他们必须：

1.  有相同`ComputerID`的。这意味着他们必须拥有与受害者相同的 ISP 提供商（Tricky）。这将使我们的受害者有机会在他们自己的国家采取法律行动。Haxor 还必须从受害者（Hard）处获取 HTTPS 会话密钥。
2.  有相同`BrowserID`的。任何人都可以欺骗用户代理字符串（烦人）。
3.  能够自己制造假货`SessionID`（Very Hard）。卷攻击不起作用，因为我们使用时间戳来生成加密/签名密钥，所以基本上它就像为每个会话生成一个新密钥。最重要的是，我们加密了随机字节，所以简单的字典攻击也是不可能的。

我们可以通过转发`GoogleID`和`FingerprintID`（通过 ajax 或隐藏字段）和匹配来改进验证。

```
if( GoogleID != getStoredGoodleID($sid) ) return false;
if( byte_difference(FingerPrintID, getStoredFingerprint($sid) > 10%) return false; 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2010-07-20T07:14:42.807

这些人开发了一种指纹识别方法，可以高度准确地识别用户：

[https://panopticlick.eff.org/static/browser-uniqueness.pdf](https://panopticlick.eff.org/static/browser-uniqueness.pdf)

> 我们通过根据请求传输到网站的版本和配置信息来调查现代 Web 浏览器受“设备指纹识别”影响的程度。[我们实现了一种可能的指纹算法，并从访问我们测试端panopticlick.eff.org](https://panopticlick.eff.org/static/panopticlick.eff.org)的大量浏览器样本中收集了这些指纹 . 我们观察到我们的指纹分布至少包含 18.1 位的熵，这意味着如果我们随机选择一个浏览器，我们最多只能期望 286,777 个其他浏览器中只有一个会共享它的指纹。在支持 Flash 或 Java 的浏览器中，情况更糟，平均浏览器携带至少 18.8 位的识别信息。在我们的样本中，94.2% 的 Flash 或 Java 浏览器是独一无二的。
> 
> 通过观察回访者，我们估计浏览器指纹随时间变化的速度。在我们的样本中，指纹的变化非常迅速，但即使是简单的启发式算法也通常能够猜测指纹何时是先前观察到的浏览器指纹的“升级”版本，猜测正确率为 99.1%，误报率仅为 0.86% .
> 
> 我们讨论了浏览器指纹识别在实践中会造成哪些隐私威胁，以及哪些对策可能适合防止它。在防止指纹识别和某些类型的可调试性之间存在权衡，在当前的浏览器中，这些可调试性非常重视隐私。矛盾的是，如果没有足够数量的人使用反指纹隐私技术，它们可能会弄巧成拙。我们表明，一些隐私措施目前成为这个悖论的牺牲品，但其他隐私措施却没有……

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-10-19T15:42:42.257

如果没有所有者的合作，就不可能识别访问网站的计算机。但是，如果他们允许您，您可以存储一个 cookie 以在机器再次访问您的站点时对其进行识别。关键是，访客在掌控之中；他们可以随时删除 cookie 并以新访问者的身份出现。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-10-19T16:10:14.323

一种可能性是使用[flash cookie](http://yro.slashdot.org/article.pl?sid=08/10/14/1656251&from=rss)：

*   无处不在的可用性（95% 的访问者可能会有闪存）
*   您可以为每个 cookie 存储更多数据（最多 100 KB）
*   跨浏览器共享，因此更有可能唯一标识一台机器
*   清除浏览器 cookie 不会删除 flash cookie。

您需要构建一个小的（隐藏的）Flash 电影来读取和写入它们。

无论您选择何种路线，请确保您的用户选择接受跟踪，否则您将侵犯他们的隐私并成为坏人之一。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2012-05-13T18:29:07.917

您可能想尝试在 evercookie 中设置一个唯一 ID（它可以跨浏览器工作，请参阅他们的常见问题解答）： [http ://samy.pl/evercookie/](http://samy.pl/evercookie/)

还有一家名为 ThreatMetrix 的公司被许多大公司用来解决这个问题： [http](http://threatmetrix.com/our-solutions/solutions-by-product/trustdefender-id/) ://threatmetrix.com/our-solutions/solutions-by-product/trustdefender-id/ 它们非常昂贵，而且有些他们的其他产品不是很好，但他们的设备 ID 运行良好。

最后，有这个 panopticlick 想法的开源 jquery 实现： [https](https://github.com/carlo/jquery-browser-fingerprint) ://github.com/carlo/jquery-browser-fingerprint 现在看起来很不成熟，但可以扩展。

希望能帮助到你！

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2015-06-16T19:22:43.090

有一种称为画布指纹识别的流行方法，在这篇科学文章中有所描述：[The Web Never Forgets: Persistent Tracking Mechanisms in the Wild](https://securehomes.esat.kuleuven.be/~gacar/persistent/the_web_never_forgets.pdf)。一旦你开始寻找它，你会惊讶于它的使用频率。该方法创建了一个唯一的指纹，该指纹对于每个浏览器/硬件组合都是一致的。

本文还回顾了其他持久性跟踪方法，例如 evercookies、重生 http 和 Flash cookie 以及 cookie 同步。

**有关画布指纹识别的更多信息：**

*   [Pixel Perfect：HTML5 中的指纹画布](https://cseweb.ucsd.edu/~hovav/dist/canvas.pdf)
*   [https://en.wikipedia.org/wiki/Canvas_fingerprinting](https://en.wikipedia.org/wiki/Canvas_fingerprinting)

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-10-19T19:57:35.830

您只能通过 HTTP 连接获得少量信息。

1.  IP - 但正如其他人所说，由于 ISP 的动态分配策略，这对于许多（如果不是大多数）互联网用户来说并不是固定的。

2.  用户代理字符串 - 几乎所有浏览器都会在每个请求中发送他们使用的浏览器类型。但是，这可以由用户在当今的许多浏览器中设置。

3.  请求字段的集合 - 每个请求都会发送其他字段，例如支持的编码等。如果在聚合中使用这些字段可以帮助标识用户的机器，但同样取决于浏览器并且可以更改。

4.  Cookies - 设置 cookie 是识别机器的另一种方式，或者更具体地说是机器上的浏览器，但正如其他人所说，这些可以被用户删除或关闭，并且仅适用于浏览器，而不是机器。

因此，正确的回答是，您无法仅通过 HTTP over IP 协议实现您的生活。但是，结合使用 cookie、IP 和 HTTP 请求中的字段，您很有可能猜测它是什么机器。用户倾向于只使用一个浏览器，并且通常来自一台机器，所以这可能相当可靠，但这会因受众而异......技术人员更有可能搞砸这些东西，并使用更多的机器/浏览器。此外，这甚至可以与一些尝试对 IP 进行地理定位并使用该数据相结合。但无论如何，没有任何时候都是正确的解决方案。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-08-28T15:18:13.383

cookie 和非 cookie 方法都存在缺陷。但是，如果您可以原谅 cookie 方法的缺点，这里有一个想法。

如果您已经在您的网站上使用 Google Analytics，那么您无需自己编写代码来跟踪唯一用户。`__utma`如[Google 文档](https://developers.google.com/analytics/resources/concepts/gaConceptsCookies)中所述， Google Analytics 通过 cookie 值为您执行此操作。通过重用此值，您不会创建额外的 cookie 有效负载，这对页面请求具有效率优势。

您可以轻松编写一些代码来访问该值，或使用[此脚本的](http://www.dannytalk.com/read-google-analytics-cookie-script/) `getUniqueId()`功能。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-10-19T15:50:18.640

与之前的解决方案一样，cookie 是一种很好的方法，但请注意它们可以识别**浏览器**。如果我在 Firefox 中访问了一个网站，然后在 Internet Explorer 中访问了一个网站，cookie 将分别为这两种尝试存储。一些用户还禁用了 cookie（但更多的人禁用了 JavaScript）。

要考虑的另一种方法是 IP 和主机名标识（请注意，对于拨号/非静态 IP 用户，这些可能会有所不同，AOL 也使用一揽子 IP）。但是，由于这仅识别网络，因此可能不如 cookie 有效。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-10-28T23:00:14.813

> When i use a machine which has never visited my online banking web site i get asked for additional authentification. then, if i go back a second time to the online banking site i dont get asked the additional authentification...i deleted all cookies in IE and relogged onto my online banking site fully expecting to be asked the authentification questions again. to my surprise i was not asked. doesnt this lead one to believe the bank is doing some kind of pc tagging which doesnt involve cookies?

This is a pretty common type of authentication used by banks.

Say you're accessing your bank website via example-isp.com. The first time you're there, you'll be asked for your password, as well as additional authentication. Once you've passed, the bank knows that user "thatisvaliant" is authenticated to access the site via example-isp.com.

In the future, it won't ask for extra authentication (beyond your password) when you're accessing the site via example-isp.com. If you try to access the bank via another-isp.com, the bank will go through the same routine again.

So to summarize, what the bank's identifying is your ISP and/or netblock, based on your IP address. Obviously not every user at your ISP is you, which is why the bank still asks you for your password.

Have you ever had a credit card company call to verify that things are OK when you use a credit card in a different country? Same concept.

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-10-20T02:40:30.200

除了使用 cookie 的建议之外，唯一可用于询问的全面识别属性集包含在 HTTP 请求标头中。因此，可以使用其中的一些子集为用户代理（即浏览器）创建伪唯一标识符。此外，这些信息中的大部分可能已经默认记录在 Web 服务器软件的所谓“访问日志”中，如果没有，可以轻松配置为这样做。然后，可以开发一个工具来简单地扫描这个日志的内容，创建*指纹*每个请求由 IP 地址和用户代理字符串等组成。可用的数据越多，甚至包括特定 cookie 的内容，都会增加该指纹的唯一性质量。虽然，正如许多其他人已经说过的那样，HTTP 协议并没有做到这一点 100% 万无一失——充其量它只能是一个相当好的指标。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-19T17:32:05.920

Really, what you want to do cannot be done because the protocols do not allow for this. If static IPs were universally used then you might be able to do it. They are not, so you cannot.

If you really want to identify *people*, have them log in.

Since they will probably be moving around to different pages on your web site, you need a way to keep track of them as they move about.

So long as they are logged in, and you are tracking their session within your site via cookies/link-parameters/beacons/whatever, you can be pretty sure that they are using the same computer during that time.

Ultimately, it is incorrect to say this tells you which computer they are using if your users are not using your own local network and do not have static IP addresses.

If what you want to do is being done with the cooperation of the users and there is only one user per cookie and they use a single web browser, just use a cookie.

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2018-03-13T08:49:26.617

您可以使用[指纹js2](https://github.com/Valve/fingerprintjs2)

```
new Fingerprint2().get(function(result, components) {
  console.log(result) // a hash, representing your device fingerprint
  console.log(components) // an array of FP components
  //submit hash and JSON object to the server 
}) 
```

之后，您可以根据现有用户检查所有用户并检查 JSON 相似性，因此即使他们的指纹发生变异，您仍然可以跟踪他们

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-19T16:26:24.743

> 因为我希望该解决方案适用于所有机器和所有浏览器（在合理范围内），所以我正在尝试使用 javascript 创建一个解决方案。

*这难道不是不*使用 javascript的一个很好的理由吗？

正如其他人所说 - cookie 可能是您的最佳选择 - 请注意这些限制。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-20T01:29:20.543

我想结论是我无法以编程方式唯一地识别正在访问我的网站的计算机。

我有以下问题。当我使用一台从未访问过我的网上银行网站的机器时，我会被要求进行额外的身份验证。然后，如果我第二次回到网上银行网站，我不会被要求额外的身份验证。阅读我的问题的答案后，我决定一定是涉及到 cookie。因此，我删除了 IE 中的所有 cookie 并重新登录我的网上银行网站，完全期待再次被问到身份验证问题。令我惊讶的是，我没有被问到。这不会让人相信银行正在做某种不涉及 cookie 的 pc 标记吗？

此外，今天经过大量谷歌搜索后，我发现以下公司声称销售一种解决方案，该解决方案可以唯一识别访问网站的机器。[http://www.the41.com/products.asp](http://www.the41.com/products.asp)。

如果您能进一步澄清我发现的这些相互矛盾的信息，我将不胜感激，我将不胜感激。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-10-19T15:49:37.843

Cookie 对确定唯一身份访问者没有用处。用户可以清除 cookie 并刷新站点 - 然后他再次被归类为新用户。

我认为最好的方法是实现服务器端解决方案（因为您需要在某个地方存储数据）。根据您对此类数据的需求的复杂性，您将需要确定什么被归类为唯一访问。一个明智的方法是允许 IP 地址在第二天返回并获得唯一的访问。一天内来自一个 IP 地址的多次访问不应算作唯一访问。

例如，使用 PHP，获取访问者的 IP 地址并将其存储在文本文件（或 sql 数据库）中是微不足道的。

服务器端解决方案适用于所有机器，因为您将在用户首次加载您的网站时对其进行跟踪。不要使用 javascript，因为它是用于客户端脚本的，而且用户可能在任何情况下都禁用了它。

希望有帮助。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-11-05T19:08:43.727

我会结合使用 cookie 和 flash cookie 来做到这一点。创建一个 GUID 并将其存储在 cookie 中。如果 cookie 不存在，请尝试从 flash cookie 中读取。如果仍未找到，请创建它并将其写入 Flash cookie。这样，您可以跨浏览器共享相同的 GUID。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-19T15:36:56.670

我认为 cookie 可能是您正在寻找的东西；这就是大多数网站唯一识别访问者的方式。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-19T17:18:09.833

Assuming you don't want the user to be in control, you can't. The web doesn't work like that, the best you can hope for is some heuristics.

If it is an option to force your visitor to install some software and use TCPA you may be able to pull something off.

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-02-28T13:24:51.047

我将给出我的想法，从简单到复杂。在以上所有内容中，您都可以创建会话，并且问题本质上转化为将会话与请求匹配。

a）（难度：容易）使用客户端硬件显式存储某种会话ID/哈希（存在相当多的隐私/安全问题，因此请确保您对存储的任何内容进行哈希处理），解决方案包括：

*   饼干存储
*   浏览器存储/webDB/（更奇特的浏览器解决方案）
*   具有将内容存储在文件中的权限的扩展名。

上面的问题是用户可以清空他的缓存以防万一。

b）（难度：中等）基于登录的身份验证。大多数现代 Web 框架都提供了这样的解决方案，其核心思想是让用户自愿识别自己，这很简单，但会增加架构的复杂性。

上述内容具有额外的复杂性，并且基本上是非公开内容。

c）（难度：hard -R&D）基于元数据的识别，（浏览器 ip/语言/浏览器/和其他隐私入侵的东西，所以确保你让你的用户知道，否则你可能会被起诉）不完美的解决方案可能会变得更复杂（a用户以特定频率键入或使用具有特定模式的鼠标？您甚至可以应用 ML 解决方案）。声称的解决方案

最强大的用户甚至不需要明确地识别他。这是对隐私的直接侵犯（参见 GDPR），并不完美，例如。ip可以改变。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2013-05-04T17:04:02.203

我的帖子可能不是一个解决方案，但我可以提供一个示例，该功能已实现。

如果您`www.supertorrents.org`是第一次从您的计算机访问注册页面，那很好。但是，如果您刷新页面或再次打开该页面，则表明您之前访问过该页面。真正的美在这里 - 即使您重新安装 Windows 或其他操作系统，它也能识别。

我在某处读到他们存储 CPU ID。虽然我找不到他们是怎么做到的，但我严重怀疑，他们可能会使用 MAC 地址来做到这一点。

如果我找到*方法*，我一定会分享。

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2016-11-06T13:36:32.777

**一个恶作剧：**

1.  创建 2 个注册页面：

    **第一个注册页面：**无需任何电子邮件或安全检查（仅使用用户名和密码）

    **第二注册页面：**具有高安全级别（电子邮件验证请求和安全图像等）

2.  为了让客户满意，方便注册，默认注册页面应该是**（First Registration Page）**，但在 **（First Registration Page）**有一个隐藏的限制。是IP限制。如果 IP 尝试第二次注册（例如少于 1 小时）而不是显示阻止页面。您可以自动显示**（第二注册页面）** 。

3.  在**（首次注册页面）**中，您可以设置（例如：在 1 小时或 24 小时内阻止来自 1 个 IP 的 2 次尝试）并且在（例如）1 小时后，您可以自动打开来自该 IP 的访问

请注意：（**第一个注册页面）**和**（第二个注册页面）**不应分开页面。你只做了一页。（例如：register.php）并使其在第一 PHP 样式和第二 PHP 样式之间切换变得智能

# linux - 在 Linux 上偶尔会丢弃 SYN 数据包

> ID：216544
> 
> 赞同：0
> 
> 时间：2008-10-19T15:34:56.907
> 
> 标签：linux, networking, iptables

我们正在运行带有 2.6.16 内核的 D​​ebian，并启用了 iptables。系统正在运行一个定制的 HTTP 代理，该代理受到轻微负载（它在其他站点上的相同负载下工作正常）。该系统由 4 台服务器组成，前面是具有虚拟 IP 的负载平衡器，前面是 4 台 ISA 2004 机器的阵列，因此基本拓扑为：

客户端 -> ISA [1-4] -> 负载均衡器 -> 我们的代理 [1-4] -> 互联网

有时，ISA 会向我们发送一个 SYN 数据包，但没有向该数据包发送 SYN-ACK。3秒后会再试，6秒后会再试第三次，之后会报告proxy down，并切换到直连。在此期间，即在这 3 个 SYN 之前、之中和之后，来自同一 ISA 的其他 SYN 会出现并得到成功响应。

其他人报告了一个非常相似的问题（但是没有解决方案）：

所有这些都来自一种名为 CentOS 的 Linux。它的特点是默认启用 iptables。

[http://www.linuxhelpforum.com/showthread.php?t=931912&mode=linear](http://www.linuxhelpforum.com/showthread.php?t=931912&mode=linear) [http://www.centos.org/modules/newbb/viewtopic.php?topic_id=16147](http://www.centos.org/modules/newbb/viewtopic.php?topic_id=16147)

几乎相同：但有点不同： [http ://www.linuxquestions.org/questions/linux-networking-3/tcp-handshake-fails-synack-ignored-by-system.-637171/](http://www.linuxquestions.org/questions/linux-networking-3/tcp-handshake-fails-synack-ignored-by-system.-637171/)

似乎也相关： [http ://groups.google.com/group/comp.os.linux.networking/browse_thread/thread/b1c000e2d65e0034](http://groups.google.com/group/comp.os.linux.networking/browse_thread/thread/b1c000e2d65e0034)

我怀疑 iptables 是罪魁祸首，但欢迎提供任何额外的反馈。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T15:45:06.340

如您发布的第一个链接中所述，查看listen 调用的第二个参数。这是待处理（尚未接受）连接的最大数量。根据listen（2）手册页，如果协议支持重传（TCP支持），当队列满时连接请求将被丢弃（期待稍后重传，如果队列中有足够的空间再次创建连接）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T14:07:02.933

Indeed, the iptables turned out to be the culrpit, with the rule that dropped INVALID packets. We still do not know for sure what made iptables to think those SYNs were invalid (no TIME_WAIT for sure, since we did not have any traffic with the same source ports for at least 30 mins prior to the drops).

# .net - 为什么 MEF 不是 DI/IoC 容器？

> ID：216565
> 
> 赞同：67
> 
> 时间：2008-10-19T15:47:41.280
> 
> 标签：.net, dependency-injection

博客圈和微软自己都说 MEF 不是另一个 IoC 容器。

好吧……但是为什么呢？对我来说似乎是一样的。也许它不如 Unity 或[Castle Windsor](https://en.wikipedia.org/wiki/Castle_Project#Features)好，但它仍然符合定义，不是吗？

为什么 MEF 不像 Unity 或 Castle Windsor 那样是 IoC 容器？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2013-07-05T23:22:04.063

MEF 有**潜力**，但作为 DI 容器，它缺乏：

1.  代码作为配置
2.  自动注册
3.  XML 配置（对我来说不是那么重要）
4.  自定义生命周期
5.  拦截

这些东西非常重要。

对于生活方式，它缺乏：

1.  每张图
2.  Web 请求上下文
3.  线程上下文
4.  会话上下文
5.  汇集
6.  范围
7.  自定义参考

参考： - Mark Seemann 的书“.NET 中的依赖注入”

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-10-05T08:09:09.700

在我的世界里，DI基于三个维度，对象组合、生命周期管理和拦截。这是其他成熟的 DI 容器，如 Unity、Castle Windsor 和 Ninject 所促进的。MEF 仅支持一维，即对象组合。它做得很好，但 MEF 不支持其余两个维度。

# javascript - HTML 表格中的“无限滚动”效果

> ID：216588
> 
> 赞同：10
> 
> 时间：2008-10-19T16:04:45.037
> 
> 标签：javascript, datatable, yui, scroll, dhtml

我在网页中显示滚动数据表。该表有数千个动态行，因此它是从服务器加载的（通过 AJAX）。

用户可以上下滚动，所以我需要**检测用户何时到达滚动条的末尾**（即表格底部的最后一行），以便请求和显示更多数据。

你可以在谷歌阅读器中找到这种效果，当你向下滚动到给定提要中的最后一篇文章时，谷歌请求并以透明的方式显示新文章，但我不知道它们是如何实现的。

顺便说一句，现在我正在使用[YUI 数据表](http://developer.yahoo.com/yui/datatable/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-19T17:26:12.237

谢谢您的回答。这是我的最终工作代码（受 Greg 和[ajaxian.com](http://ajaxian.com/archives/implementing-infinite-scrolling-with-jquery)启发），它使用一些 jQuery 函数并与[YUI DataTable](http://developer.yahoo.com/yui/datatable/)一起使用。

```
$(".yui-dt-bd").scroll(load_more);

function load_more() {              
    if ($(this).scrollend()) {
        alert("SCROLL END REACHED !");
        // TODO load more data
    }
}

$.fn.scrollend = function() {
    return this[0].scrollHeight - this[0].scrollTop - this.height() <= 0;
} 
```

我的下一步是实现我自己的[YUI Paginator](http://developer.yahoo.com/yui/paginator/)以实现与 YUI 组件的完整集成:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T16:23:50.350

我不熟悉您正在使用的特定元素，但为了在全尺寸窗口上实现这一点，您可以执行以下操作：

```
$wnd.onscroll = function() {
    if (($wnd.height - $wnd.scrollTop) < SOME_MARGIN) then doSomething();
}; 
```

scrollTop 本质上是“滚动了多少像素”。我假设将其应用于您正在使用的表将完成这项工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T16:50:20.687

我刚刚搜索了它并找到了这篇文章：[Implementing Dynamic Sc​​roll with Ajax, JavaScript, and XML](http://www.developer.com/design/article.php/3681771)。它看起来像一个彻底的解释。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-22T21:36:23.480

你可以看到它只在[这里](http://www.satyam.com.ar/yui/2.8.0/infinite.html)YUI 工作。与上面建议的一种解决方案相比，滚动条连续移动，位置和大小反映了可视区域的真实大小和位置，当滚动条到达底部时它不会加载下一批。只有当整个记录的最后一个位于查看区域的底部时，滚动条才会到达底部。当然，这只有在您知道有多少条记录时才有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T16:28:20.387

我今天在阅读 Firebug 中的 DOM 属性时注意到一个属性，称为`scrollY`（在 Firebug 中的 DOM 选项卡下转到`content`> `scrollY`），它似乎是在窗口上滚动的剩余像素数量。试试看这是否也是为可滚动元素创建的。然后就可以使用 Yuval 的函数来加载新数据了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T22:58:34.420

伊克。不是无限滚动的忠实粉丝；它打破了人们对 Web 如何工作的一些关键假设。请保证您只会在以下条件下实施它：

1) 你并没有用它来代替一个完美的页面，该页面将所有内容加载到一个漂亮的长表中，并让用户使用 Ctrl-F 在页面内搜索 Fringe 出现的时间。

2）您不打算在每个滚动数据块的底部插入广告。

3) 您正在为盲人和禁用 JavaScript 浏览 Web 的人提供一个有效的后备方案（嘿，又是那个漂亮的长桌）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T11:53:12.560

如果您使用的是 YUI，它有一个[tableScrollEvent](http://developer.yahoo.com/yui/docs/YAHOO.widget.ScrollingDataTable.html#event_tableScrollEvent)会在表格滚动时触发。将此与 dataTable 的 generateRequest 函数相结合，您可以通过观察[tableScrollEvent](http://developer.yahoo.com/yui/docs/YAHOO.widget.ScrollingDataTable.html#event_tableScrollEvent)并在接近数据集末尾时启动请求来实现无限滚动。

YUI 文档没有针对这种情况的具体示例，但确实向您[展示了如何处理](http://developer.yahoo.com/yui/datatable/#data)generateRequest 返回的数据

# asp.net-mvc - Html.BeginForm 和添加属性

> ID：216600
> 
> 赞同：143
> 
> 时间：2008-10-19T16:10:43.027
> 
> 标签：asp.net-mvc

我将如何添加`enctype="multipart/form-data"`到使用生成的表单中`<% Html.BeginForm(); %>`？

* * *

## 回答 #1

> 赞同：257
> 
> 时间：2008-10-19T16:20:13.913

作为 htmlAttributes 的一部分，例如

```
Html.BeginForm(
    action, controller, FormMethod.Post, new { enctype="multipart/form-data"}) 
```

或者，您可以传递`null`操作和控制器以获得与 BeginForm() 相同的默认目标，而无需任何参数：

```
Html.BeginForm(
    null, null, FormMethod.Post, new { enctype="multipart/form-data"}) 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-20T04:15:48.150

您还可以对强类型版本使用以下语法：

```
<% using (Html.BeginForm<SomeController>(x=> x.SomeAction(), 
          FormMethod.Post, 
          new { enctype = "multipart/form-data" })) 
   { %> 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-10-17T15:42:34.363

我知道这很旧，但如果您需要一遍又一遍地创建该表单，您可以创建一个自定义扩展：

```
public static MvcForm BeginMultipartForm(this HtmlHelper htmlHelper)
{
    return htmlHelper.BeginForm(null, null, FormMethod.Post, 
     new Dictionary<string, object>() { { "enctype", "multipart/form-data" } });
} 
```

用法然后就变成了

```
<% using(Html.BeginMultipartForm()) { %> 
```

# mysql - postgreSQL mysql oracle 的区别

> ID：216601
> 
> 赞同：7
> 
> 时间：2008-10-19T16:16:44.967
> 
> 标签：mysql, oracle, postgresql

我必须开始为数据库项目构建架构，但我真的不知道引擎之间的区别。

谁能解释一下这三种引擎各自的优缺点？我们必须选择其中一个，而我真正了解的唯一一件事是：

*   Mysql & Postgres：
    *   是免费的，但不如 oracle
    *   Mysql 作为安全问题（这是真的吗？）
*   甲骨文：
    *   世界上最好的数据库引擎
    *   昂贵的

有人可以清除它们之间的其他差异吗？这是一个预算较低的中/大型（我们正在考虑大约 100 到 200 张桌子）项目，您会选择什么？并且预算更高？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-20T00:46:11.270

几年前我不得不写一个翻译引擎；你给它输入一组 sql，它会翻译成当前连接的引擎的方言。我的引擎适用于 Postgres (AKA PostgreSql)、Ingres、DB2、Informix、Sybase 和 Oracle - 哦，还有 ANTS。坦率地说，Oracle 是我最不喜欢的（更多内容见下文）......不幸的是，mySql 和 SQL Server 不在列表中（当时两者都被认为是严重的 RDBMS - 但时代确实会发生变化）。

不考虑引擎的质量或性能 - 以及制作和恢复备份的难易程度 - 以下是主要的区别领域：

*   数据类型
*   限制
*   残疾人
*   保留字
*   空语义（见下文）
*   引用语义（单引号 '、双引号 " 或两者之一）
*   语句完成语义
*   功能语义
*   日期处理（包括像'now'这样的常量关键字和输入/输出函数格式）
*   是否允许内联注释
*   最大属性长度
*   最大属性数
*   连接语义/安全范式。

无需对所有转换数据感到厌烦，这里有一个数据类型 lvarchar 的示例：

oracle=varchar(%x) sybase=text db2="long varchar" informix=lvarchar postgres=varchar(%x) ants=varchar(%x) ingres=varchar(%x,%y)

在我看来，最重要的是 null 处理。Oracle 静默地将空白输入字符串转换为空值。...很久以前的某个地方，我读到有人写的关于“空的十七个含义”或类似的文章，真正的一点是空值非常有价值，空字符串和空字符串之间的区别是有用且不平凡！我认为甲骨文在这一点上犯了一个巨大的错误。其他人都没有这种行为（我见过）。

我最不喜欢的第二个是 ANTS，因为与所有其他人不同，他们执行了绝对没有其他人做的完美语法的愚蠢规则，虽然他们可能是唯一一家提供完美遵守标准的 DB 公司，但他们也是皇家的痛苦写代码的屁股。

我最喜欢的是 Postgres。它在 _real_world_ 情况下非常快，有很好的支持，并且是开源/免费的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-19T16:28:23.523

不同 SQL 实现之间的差异很大，至少在底层是这样。这块板不足以将它们全部计算在内。

如果你不得不问，你也必须问自己是否能够就此事做出有效和有根据的决定。

[可以在这里找到 MYSQL 和 Postgres 的比较](http://www.wikivs.com/wiki/MySQL_vs_PostgreSQL)

请注意，Oracle 还提供了[Express (XE) 版本](http://www.oracle.com/technology/products/database/xe/index.html)，其功能有所减少，但可以免费使用。另外，如果你一开始的知识很少，你就得自己去学习，我随便选一个，用它开始学习。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-19T16:25:22.530

请参阅维基百科上的比较表：[http](http://en.wikipedia.org/wiki/Comparison_of_object-relational_database_management_systems) ://en.wikipedia.org/wiki/Comparison_of_object-relational_database_management_systems && [http://en.wikipedia.org/wiki/Comparison_of_relational_database_management_systems](http://en.wikipedia.org/wiki/Comparison_of_relational_database_management_systems)

Oracle 可能是也可能不是最好的。它很贵，但这并不意味着最好。

您看过 DB2 吗？赛贝斯？太数据？微软 SQL？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-03T21:08:39.370

我认为对于低预算情况，Oracle 是不可能的。100-200 个表并不大，通常模式中的表数量不是一个规模衡量标准。数据集和吞吐量是。

你可以看看[http://www.mysqlperformanceblog.com/](http://www.mysqlperformanceblog.com/)（以及他们的极品书籍）了解 MySQL 如何处理大型部署。

通常，现在大多数 RDBMS 几乎可以完成您在非常严肃的应用程序中需要的任何事情。

# ruby - 字典 API 或库

> ID：216612
> 
> 赞同：23
> 
> 时间：2008-10-19T16:28:05.457
> 
> 标签：ruby, api, dictionary

有谁知道一个好的字典 API 或 ruby​​ 库来查找单词的定义？

我认为它应该像这样工作：

1.  我打电话给 get_definition(word)
2.  它返回该单词的定义（理想情况下以某种方式轻松格式化定义以供显示。

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-02-05T00:03:03.023

Wordnik.com 有几个单词信息 API，包括定义 API。更多信息在这里：http: [//developer.wordnik.com/](http://developer.wordnik.com/)

[I work for Wordnik. We will have more APIs soon, let us know what you want!]

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-19T16:37:12.273

我昨天发现了一个网络服务。

转到[英国文化协会](http://www.britishcouncil.org/new/)主页并双击任何单词（还不是超链接）。

这应该会打开一个弹出窗口，其中包含剑桥词典的定义。API比较简单（而且*是*公开的API，我昨天查了一下）：

```
http://dictionary.cambridge.org/learnenglish/results.asp?searchword=SEARCH_PHRASE&dict=L 
```

作为参考，这是他们用来在双击时启动它的代码：

```
/* BC double-click pop-up dictionary */
var NS = (navigator.appName == "Netscape" || navigator.product == 'Gecko') ? 1 : 0;
if (NS) document.captureEvents(Event.DBLCLICK);
document.ondblclick = dict;
var dictvar;

function dict() {
    if (NS) {
        t = document.getSelection();
        pass_to_dictionary(t);
    } else {
        t = document.selection.createRange();
        if(document.selection.type == 'Text' && t.text != '') {
            document.selection.empty();
            pass_to_dictionary(t.text);
        }
    }
}

function pass_to_dictionary(text) {
    //alert(text);
    if (text > '') {
        window.open('http://dictionary.cambridge.org/learnenglish/results.asp?searchword='+text+ '&dict=L', 'dict_win', 'width=650,height=400,resizable=yes,scrollbars=yes');
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-19T16:44:35.190

[Ruby-WordNet](http://www.deveiate.org/projects/Ruby-WordNet/)听起来就像您正在寻找的那样：

> Ruby-WordNet 是 WordNet® 词汇数据库的 Ruby 接口。WordNet 是一个在线词汇参考系统，其设计灵感来自当前人类词汇记忆的心理语言学理论。英语名词、动词、形容词和副词被组织成同义词集，每一个代表一个潜在的词汇概念。不同的关系链接同义词集。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T17:07:34.957

还有dictionary.com API的包装器（几年前）

[http://rubyforge.org/snippet/detail.php?type=snippet&id=53](http://rubyforge.org/snippet/detail.php?type=snippet&id=53)

[http://rubyforge.org/snippet/detail.php?type=snippet&id=52](http://rubyforge.org/snippet/detail.php?type=snippet&id=52)

和维基词典

[http://eightpence.com/ninjawords-a-fast-online-dictionary-fast-like-a-ninja/](http://eightpence.com/ninjawords-a-fast-online-dictionary-fast-like-a-ninja/)

# excel - 如何在 Excel 公式中创建包含双引号的字符串？

> ID：216616
> 
> 赞同：340
> 
> 时间：2008-10-19T16:29:42.880
> 
> 标签：excel, excel-formula

如何在 Excel 公式中构造以下字符串：

> 莫里斯“火箭”理查德

如果我使用单引号，这很简单 =`"Maurice 'The Rocket' Richard"`但是双引号呢？

* * *

## 回答 #1

> 赞同：503
> 
> 时间：2008-10-19T16:33:40.843

您是否尝试过使用额外的双引号进行转义？通过转义字符，您是在告诉 Excel 将 " 字符视为文字文本。

```
= "Maurice ""The Rocket"" Richard" 
```

* * *

## 回答 #2

> 赞同：171
> 
> 时间：2008-10-20T13:41:42.500

或者，您可以使用以下`CHAR`功能：

```
= "Maurice " & CHAR(34) & "Rocket" & CHAR(34) & " Richard" 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2012-10-04T23:41:37.430

三个双引号：`" " " x " " "`= `"x"`Excel 将自动更改为一个双引号。例如：

```
=CONCATENATE("""x"""," hi") 
```

=“x”嗨

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-06-21T12:29:00.193

我为此使用了一个函数（如果工作簿已经有 VBA）。

```
Function Quote(inputText As String) As String
  Quote = Chr(34) & inputText & Chr(34)
End Function 
```

这是来自 Sue Mosher 的书“Microsoft Outlook 编程”。那么你的公式将是：

`="Maurice "&Quote("Rocket")&" Richard"`

这类似于[Dave DuPlantis](https://stackoverflow.com/a/218474/190829)发布的内容。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-08-13T16:46:39.713

如果您需要使用 JSON 执行此操作：

```
=CONCATENATE("'{""service"": { ""field"": "&A2&"}}'") 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-07-31T13:32:36.970

使用 chr(34) 代码：

```
 Joe = "Hi there, " & Chr(34) & "Joe" & Chr(34)
    ActiveCell.Value = Joe 
```

结果：

```
 Hi there, "joe" 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-05-18T09:26:45.793

连接`"`为一个单独的单元格：

```
 A |   B   | C | D
1   " | text  | " | =CONCATENATE(A1; B1; C1);

D1 displays "text" 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-08-17T14:22:16.877

这是否适用于使用的宏，`.Formula = "=THEFORMULAFUNCTION("STUFF")"` 所以它会像：这适用于使用的宏吗`.Formula = "=THEFORMULAFUNCTION(CHAR(34) & STUFF & CHAR(34))"`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-03-23T04:41:30.177

返回一个空字符串或长度为零的字符串（例如）以使单元格显示为空白是工作表公式中的常见做法，但在通过 VBA 中的[Range.Formula](https://msdn.microsoft.com/en-us/library/office/ff838835.aspx)或[Range.FormulaR1C1](https://msdn.microsoft.com/en-us/library/bb213527.aspx)属性`""`插入公式时重新创建该选项很笨拙，因为必须将带引号的字符串中的双引号字符加倍。

工作表的本机[TEXT 函数](https://support.office.com/en-us/article/TEXT-function-4B46E545-E612-4C84-AC23-EDFA68007945)可以在不使用引号的情况下产生相同的结果。

```
'formula to insert into C1 - =IF(A1<>"", B1, "")
range("C1").formula = "=IF(A1<>"""", B1, """")"         '<~quote chars doubled up
range("C1").formula = "=IF(A1<>TEXT(,), B1, TEXT(,))"   '<~with TEXT(,) instead 
```

在我看来，使用`TEXT(,)`代替`""`清洁即使是上面那个简单的公式。当用于更复杂的公式时，好处变得越来越显着，例如将空字符串附加到[VLOOKUP](https://support.office.com/en-us/article/vlookup-function-adceda66-30de-4f26-923b-7257939faa65)以避免在查找结果为空白时将零返回到单元格或在不匹配时返回空字符串[IFERROR](https://support.office.com/en-us/article/IFERROR-function-F59BACDC-78BD-4924-91DF-A869D0B08CD5)。

```
'formula to insert into D1 - =IFERROR(VLOOKUP(A1, B:C, 2, FALSE)&"", "")
range("D1").formula = "=IFERROR(VLOOKUP(A1, B:C, 2, FALSE)&"""", """")"
range("D1").formula = "=IFERROR(VLOOKUP(A1, B:C, 2, FALSE)&TEXT(,), TEXT(,))" 
```

通过`TEXT(,)`替换传递空字符串的旧`""`方法，您可能会停止使用算盘来确定公式字符串中的引号字符数量是否正确。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-04-07T12:28:49.613

```
="Maurice "&"""TheRocker"""&" Richard" 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-02-13T17:58:08.693

**VBA 函数**

1) .Formula = "=""THEFORMULAFUNCTION ""&(CHAR(34) & ""STUFF"" & CHAR(34))"

2) .Formula = "THEFORMULAFUNCTION ""STUFF"""

第一种方法使用 vba 在单元格中编写公式，从而得出计算值：

```
 THEFORMULAFUNCTION "STUFF" 
```

第二种方法使用 vba 在单元格中写入一个字符串，从而产生值：

```
 THEFORMULAFUNCTION "STUFF" 
```

**Excel 结果/公式**

1) ="THEFORMULAFUNCTION "&(CHAR(34) & "STUFF" & CHAR(34))

2) 公式函数“东西”

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-07-17T00:36:00.530

还有另一种方法，虽然更多的是“我如何在 Excel 公式中构造以下字符串：”莫里斯“火箭”理查德“”而不是“如何在 Excel 公式中创建包含双引号的字符串？”，这只是使用两个单引号：

[![SO216616 示例](https://i.stack.imgur.com/WCRke.jpg)](https://i.stack.imgur.com/WCRke.jpg)

左侧是从 Excel 工作表中截取的 Calibri，右侧是从 VBA 窗口中截取的片段。在我看来，@YonahW 提到的转义赢得了“放下手”，但两个单引号的输入不超过两个双引号，并且在没有额外击键的情况下，VBA 中的差异相当明显，而在电子表格中可能不明显。

# c# - 带有 Windows 窗体的 WPF - STAThread

> ID：216634
> 
> 赞同：5
> 
> 时间：2008-10-19T16:42:17.910
> 
> 标签：c#, wpf, winforms, sta

我是 WPF 的新手，有几个关于 WPF 和 Windows 窗体集成的问题。

我有一个现有的 Visual C# Windows 窗体应用程序。我想将它与 WPF 窗口集成，该窗口可以在单击按钮时显示。这是不可能的，因为 WPF 期望调用线程是 STAThread，并且默认情况下 WinForm 假定线程是 MTAThread。我尝试使用 STAThread 的单元状态生成一个新线程来调用 WPF UI，但这不起作用。我也尝试使用 Dispatcher.BeginInvoke 方法和 Background Worker，但它们都没有解决问题。

1) 我们可以在不将 Main 标记为 STAThread 的情况下调用 WPF 窗口/控件吗？如果可能的话，谁能指出我正确的方向？2) 如果实现此目的的唯一方法是使主线程成为 STAThread，是否会对应用程序的一般性能/响应能力产生任何影响。

提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-19T16:47:43.280

我认为最简单的解决方案是让您的 WinForms 线程在 STA 中执行。拥有 STA 线程 winforms 应用程序没有任何问题（实际上它通常是默认设置）。

您可以通过将以下行添加到程序的 main 方法来解决此问题：

```
[STAThreadAttribute]
static void Main(string[] args) 
```

# winforms - 使用 C# (.NET 2.0) 在 Windows 窗体上绘制图表

> ID：216641
> 
> 赞同：1
> 
> 时间：2008-10-19T16:45:37.637
> 
> 标签：winforms, .net-2.0, graph

是否有适用于 Windows Forms .NET 2.0 的开源免费图形控件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T16:58:54.100

我使用[ZedGraph](http://zedgraph.org/wiki/index.php?title=Main_Page)已经有一段时间了。您可以生成看起来非常专业的各种类型的图表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T17:08:51.880

我会推荐[nPlot](http://www.nplot.com/)

# python - Group by date in a particular format in SQLAlchemy

> ID：216657
> 
> 赞同：2
> 
> 时间：2008-10-19T16:52:44.160
> 
> 标签：python, sql, sqlalchemy

I have a table called logs which has a datetime field. I want to select the date and count of rows based on a particular date format.

How do I do this using SQLAlchemy?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T16:05:14.910

我不知道通用的 SQLAlchemy 答案。大多数数据库支持某种形式的日期格式，通常通过函数。SQLAlchemy 支持通过 sqlalchemy.sql.func 调用函数。因此，例如，在 Postgres 后端使用 SQLAlchemy 和表 my_table(foo varchar(30), when timestamp) 我可能会做类似的事情

```
my_table = metadata.tables['my_table']
foo = my_table.c['foo']
the_date = func.date_trunc('month', my_table.c['when'])
stmt = select(foo, the_date).group_by(the_date)
engine.execute(stmt) 
```

按截断为月份的日期分组。但请记住，在该示例中， date_trunc() 是 Postgres 日期时间函数。其他数据库会有所不同。你没有提到 underlyig 数据库。如果有一种独立于数据库的方式来做到这一点，我从来没有找到过。在我的情况下，我运行生产和测试 aginst Postgres 和单元测试 aginst SQLite，并在我的单元测试中使用 SQLite 用户定义函数来模拟 Postgress 日期时间函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T18:11:32.287

Does counting yield the same result when you just group by the unformatted datetime column? If so, you could just run the query and use Python date's strftime() method afterwards. i.e.

```
query = select([logs.c.datetime, func.count(logs.c.datetime)]).group_by(logs.c.datetime)
results = session.execute(query).fetchall()
results = [(t[0].strftime("..."), t[1]) for t in results] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T17:50:23.590

I don't know SQLAlchemy, so I could be off-target. However, I think that all you need is:

```
SELECT date_formatter(datetime_field, "format-specification") AS dt_field, COUNT(*)
    FROM logs
    GROUP BY date_formatter(datetime_field, "format-specification")
    ORDER BY 1; 
```

OK, maybe you don't need the ORDER BY, and maybe it would be better to re-specify the date expression. There are likely to be alternatives, such as:

```
SELECT dt_field, COUNT(*)
    FROM (SELECT date_formatter(datetime_field, "format-specification") AS dt_field
              FROM logs) AS necessary
    GROUP BY dt_field
    ORDER BY dt_field; 
```

And so on and so forth. Basically, you format the datetime field and then proceed to do the grouping etc on the formatted value.

# c# - Creating an MJPEG video stream in c#

> ID：216664
> 
> 赞同：28
> 
> 时间：2008-10-19T16:58:38.733
> 
> 标签：c#, video, video-streaming, mjpeg

I have images being sent to my database from a remote video source at about 5 frames per second as JPEG images. I am trying to figure out how to get those images into a video format so I can stream a live video feed to Silverlight.

It seems to make sense to create a MJPEG stream but I'm having a few problems. Firstly I was trying to stream via an HTTP request so I didn't have a deal with sockets but maybe this is breaking my code.

If I try surf to my stream from QT I get a video error, Media player shows the first frame image and Silverlight crashes :)

Here is the code that streams - since I content type used this way can only be sent once I know that it isn't ideal and might be the root cause. All images are coming in via a LINQ2SQL object.

I did already try simply updating the image source of an image control in Silverlight but the flicker isn't acceptable. If Silverlight doesn't support MJPEG then no point even continuing but it looks like it does. I do have access to the h.264 frames coming in but that seemed more complicated via MP4.

```
 Response.Clear();
    Response.ContentType = "multipart/x-mixed-replace; boundary=--myboundary";
    ASCIIEncoding ae = new ASCIIEncoding();
    HCData data = new HCData();
    var videos = (from v in data.Videos
                 select v).Take(50); // sample the first 50 frames
    foreach (Video frame in videos)
    {
        byte[] boundary = ae.GetBytes("\r\n--myboundary\r\nContent-Type: image/jpeg\r\nContent-Length:" + frame.VideoData.ToArray().Length + "\r\n\r\n");
        var mem = new MemoryStream(boundary);
        mem.WriteTo(Response.OutputStream);
        mem = new MemoryStream(frame.VideoData.ToArray());
        mem.WriteTo(Response.OutputStream);
        Response.Flush();
        Thread.Sleep(200);
    } 
```

Thanks!

EDIT: I have the stream working in firefox so if I surf to the page I see video! but nothing else accepts the format. Not IE, SL, Media player - nothing.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T21:59:32.803

我很久以前（3-4 年前）做过 MJPEG，我正在挠头试图记住细节，但我根本记不住。但是，如果可能的话，我建议找到某种网站，它可以流式传输 MJPEG 内容并启动wireshark/ethereal，然后看看你通过网络得到了什么。我的猜测是您缺少一些必需的 HTTP 标头，而 firefox 对此更宽容。

如果您在 Internet 上找不到示例 MJPEG 流，许多网络摄像头都有软件可以为您提供 MJPEG 流。我使用的应用程序是多个安全摄像头的控制台，所以我知道这是所有类型的摄像头的通用实现（如果它们支持 Web 界面）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T10:22:51.870

I'm far from being an expert in MJPEG streaming, but looking at the source of [mjpg-streamer](http://sourceforge.net/projects/mjpg-streamer/) on sourcefourge I think you should send each frame separately, writing the boundary before and after each of them. You should of course not write the content-type in the closing boundary.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T19:48:57.993

关于您的编辑：Firefox 和 Safari 支持 MJPEG。但是，其他应用程序不会，例如 Explorer 或 Silverlight，具体取决于您使用它执行的操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T17:11:18.663

First, write your mjpeg frames out to separate files. You should then be able to open these in Phototshop (this will independently verify that you are parsing the stream correctly). If this fails, by bet is that you have HTTP headers embedded in your image data.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T19:36:57.650

您是否查看过网络上存在的各种网络摄像头设置？他们中的许多人会进行某种低分辨率更新而不会闪烁。您应该能够对这些类型的站点进行逆向工程，以获得解决问题的更多线索。

一些网站创建了一个 GIF 动画，也许这是一个选项，以便用户可以看到过去一分钟左右。

# sql - Emulate MySQL LIMIT clause in Microsoft SQL Server 2000

> ID：216673
> 
> 赞同：39
> 
> 时间：2008-10-19T17:05:16.990
> 
> 标签：sql, mysql, sql-server, zend-framework

When I worked on the [Zend Framework's database component](http://framework.zend.com/manual/en/zend.db.html), we tried to abstract the functionality of the `LIMIT` clause supported by MySQL, PostgreSQL, and SQLite. That is, creating a query could be done this way:

```
$select = $db->select();
$select->from('mytable');
$select->order('somecolumn');
$select->limit(10, 20); 
```

When the database supports `LIMIT`, this produces an SQL query like the following:

```
SELECT * FROM mytable ORDER BY somecolumn LIMIT 10, 20 
```

This was more complex for brands of database that don't support `LIMIT` (that clause is not part of the standard SQL language, by the way). If you can generate row numbers, make the whole query a derived table, and in the outer query use `BETWEEN`. This was the solution for Oracle and IBM DB2\. Microsoft SQL Server 2005 has a similar row-number function, so one can write the query this way:

```
SELECT z2.*
FROM (
    SELECT ROW_NUMBER OVER(ORDER BY id) AS zend_db_rownum, z1.*
    FROM ( ...original SQL query... ) z1
) z2
WHERE z2.zend_db_rownum BETWEEN @offset+1 AND @offset+@count; 
```

However, Microsoft SQL Server 2000 doesn't have the `ROW_NUMBER()` function.

So my question is, can you come up with a way to emulate the `LIMIT` functionality in Microsoft SQL Server 2000, solely using SQL? Without using cursors or T-SQL or a stored procedure. It has to support both arguments for `LIMIT`, both count and offset. Solutions using a temporary table are also not acceptable.

**Edit:**

The most common solution for MS SQL Server 2000 seems to be like the one below, for example to get rows 50 through 75:

```
SELECT TOP 25 *
FROM ( 
  SELECT TOP 75 *
  FROM   table 
  ORDER BY BY field ASC
) a 
ORDER BY field DESC; 
```

However, this doesn't work if the total result set is, say 60 rows. The inner query returns 60 rows because that's in the top 75\. Then the outer query returns rows 35-60, which doesn't fit in the desired "page" of 50-75\. Basically, this solution works unless you need the last "page" of a result set that doesn't happen to be a multiple of the page size.

**Edit:**

Another solution works better, but only if you can assume the result set includes a column that is unique:

```
SELECT TOP n *
FROM tablename
WHERE key NOT IN (
    SELECT TOP x key
    FROM tablename
    ORDER BY key
); 
```

**Conclusion:**

No general-purpose solution seems to exist for emulating `LIMIT` in MS SQL Server 2000\. A good solution exists if you can use the `ROW_NUMBER()` function in MS SQL Server 2005.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-06T04:28:26.350

```
SELECT TOP n *
FROM tablename
WHERE key NOT IN (
    SELECT TOP x key
    FROM tablename
    ORDER BY key
    DESC
); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-23T13:07:47.720

这是另一个仅适用于 Sql Server 2005 和更新版本的解决方案，因为它使用了 except 语句。但无论如何我都会分享它。如果你想得到记录 50 - 75 写：

```
select * from (
    SELECT top 75 COL1, COL2
    FROM MYTABLE order by COL3
) as foo
except
select * from (
    SELECT top 50 COL1, COL2
    FROM MYTABLE order by COL3
) as bar 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-13T10:06:24.557

当您只需要 LIMIT 时，ms sql 具有等效的 TOP 关键字，因此很清楚。当您需要 LIMIT 和 OFFSET 时，您可以尝试之前描述的一些技巧，但它们都会增加一些开销，即订购一种方式，然后订购另一种方式，或者昂贵的 NOT IN 操作。我认为不需要所有这些级联。在我看来，最干净的解决方案是在 SQL 端使用没有偏移量的 TOP，然后使用适当的客户端方法（如 php 中的 mssql_data_seek）查找所需的起始记录。虽然这不是一个纯粹的 SQL 解决方案，但我认为它是最好的解决方案，因为它不会增加任何开销（跳过的记录在您搜索它们时不会在网络上传输，如果这让您担心的话）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-22T17:37:56.973

我会尝试在我的 ORM 中实现它，因为它在那里非常简单。如果它确实需要在 SQL Server 中，那么我会查看 linq to sql 为以下 linq to sql 语句生成的代码，然后从那里开始。实现该代码的 MSFT 工程师多年来一直是 SQL 团队的一员，并且知道自己在做什么。

var 结果 = myDataContext.mytable.Skip(pageIndex * pageSize).Take(pageSize)

# javascript - What is a good and known JavaScript MVC pattern?

> ID：216674
> 
> 赞同：3
> 
> 时间：2008-10-19T17:06:27.410
> 
> 标签：javascript, asp.net-mvc, design-patterns

What is the best way to manage the JavaScript files and the functions/objects context in an ASP.NET MVC app?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-19T17:58:28.893

Google says [http://javascriptmvc.com/](http://javascriptmvc.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T00:49:08.443

If you're looking for something like that, you should definitely check out [MooTools](http://mootools.net/) as they implement classes almost exactly the way you describe. Overall, I've found their approach to be very clean, extensible, and maintainable. For example, here is a class template I use to write all of my classes (note that it uses some MooTools-specific syntax):

```
var className = new Class ({

    Implements: [Events, Options],

    options: {
        option1: 'option1',
        option2: 'option2'
    },

    initialize: function(options){
        this.setOptions(options);
    },

    function1: function(){

    },

    function2: function(){

    }
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T17:13:17.783

I put all my js files in the Content/Js folder. Then add URL helpers that allow me to change this in the future. My code isn't online, but I stole the idea from [Rob Conery MVC Commerce demo](https://mvcsamples.svn.codeplex.com/svn/Commerce.Web/App/Helpers/AppHelper.cs).

Not sure what you mean by "manage...the functions/objects context in ASp.NET MVC app"

I think you're asking how to segment/partition your scripts. You should separate your JS files into separate chunks of functionality.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T17:49:09.600

i'm thinking about a main js file that is responsible for all the calls of js function like:

```
mainApp = function(){

   return {

       init: function(){

       },

       function1: function(){

       }

   };

}; 
```

nut in a way of it fits an mvc app.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T05:10:53.233

yes , but this is not a MooTools unique technique,

this is called [Object literal](http://en.wikipedia.org/wiki/Object_literal) pattern.

i'm looking for a way to manage my ajax app according to the current state od the asp.net mvc

# iphone - 为 iPod Touch 测试 iPhone 游戏的最佳方法是什么？

> ID：216688
> 
> 赞同：1
> 
> 时间：2008-10-19T17:14:49.780
> 
> 标签：iphone, ipod-touch

我为 iPhone 开发了一款游戏……在我的 iPhone 上。当我将其提交给商店时，我将其标记为“仅限 iPhone”。现在我收到电子邮件询问“为什么不使用 iPod touch？”。

顺便说一句，该游戏不使用任何 iPhone 独有的功能。所以...

我想在实际的 iPod Touch 上对其进行测试，以确保它可以正常工作。这真的有必要吗？

如果是这样，开发人员会直接出去购买 iPod touch 进​​行测试吗？哈哈...猜猜这很明显:-p

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T17:22:39.513

只要你没有使用明显的功能，你应该没问题。我开发了一个 iPhone 应用程序，直到它提交到商店前几天我们才进行触摸测试。没有什么需要改变的。

# c# - 构建 Winforms C# 解决方案

> ID：216694
> 
> 赞同：6
> 
> 时间：2008-10-19T17:20:19.207
> 
> 标签：c#, winforms, model-view-controller, mvp, projects

因此，我正在重新组织一个 winforms C# 解决方案，以帮助解耦并使其更清洁、更有条理。该解决方案跟踪小型企业订单等。.

到目前为止，我已将项目分解为

**App.View** - 所有与 GUI 相关的代码
**App.Data** - 只是数据结构和接口。没有其他实现代码
**App.BusinessLogic** - 所有没有 GUI 引用的业务逻辑代码

我有一些课程我不知道它们属于哪里。请让我知道您的想法每个班级应该去哪个项目，或者是否应该为此创建另一个项目。

1.  从数据库中检索用户偏好的类
2.  一个从我们的静态数据服务器检索静态数据并返回数据结果集的类。
3.  降低用户权利的类
4.  存储订单哈希表的模型类
5.  通过电子邮件发送有关用户操作的消息的类

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-19T17:57:10.020

实际上，我认为您与传统的分层架构有些不同。通常，您的应用程序所使用的数据模型将与操作它们的代码一起保存在业务层中。您的数据层将具有持久性框架的数据模型和与该框架交互的代码。我认为这可能是您的课程建议位置与您根据您的评论对它的反应之间产生混淆的根源。

从这个角度来看，任何检索或带来的东西都必然位于您的数据层中——它正在访问持久存储中的数据。它检索到的内容最终会转换为您的业务逻辑操作的业务层对象。事物是概念模型（如订单表）或属于业务层的业务操作。我同意@Adron 的观点，也许对于 (3) 的去向有同样的困惑，这取决于它实际上是什么。

进一步来说：

1.  用户首选项是业务对象，检索它们的是数据层对象。
2.  静态数据映射到业务对象（表或视图或其他东西），访问外部服务器的东西是数据层对象。
3.  用户权利是一个业务对象，检索它的东西是数据层对象。
4.  订单表是一个业务对象
5.  发送电子邮件是一项商业活动，因此向人们发送邮件的东西是一个商业对象

[编辑] 我的（简单）Web 应用程序的通用 3 层架构

数据访问层

这将包括我的 TableAdapters 和强类型 DataTables 和工厂，它们将我的 DataTables 行转换为 pre-LINQ 项目中的业务对象。使用 LINQ 这将包括我的 DataContext 和设计器生成的 LINQ 实体。

业务层

这将包括任何业务逻辑，包括验证和安全性。在 pre-LINQ 中，这些将是我的业务对象和实现应用程序逻辑的任何其他类。使用 LINQ，这些是我的 LINQ 实体的部分类实现，用于实现安全性和验证以及任何其他类来实现业务逻辑。

介绍

这些是我的网络表单——基本上是应用程序的用户界面。我确实在表单中包含了一些验证逻辑作为优化，尽管这些也在 BL 中得到验证。这也将包括任何用户控件。

**注意：**这是逻辑结构。项目结构通常反映了这一点，但在某些情况下，例如与 Web 服务的连接，可能会直接包含在 Web 项目中，即使在逻辑上组件确实在 BL/DAL 中。

**注意：**一旦 ASP.NET MVC 投入生产，我可能会通过 3 层迁移到 MVC。我在 Ruby/Rails 中完成了一些个人项目，我非常喜欢 Web 应用程序的 MVC 范例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T18:42:24.813

You have specified that App.Data should contain only data structures and interfaces, no implementation code, which is fine if you want to do that, but that leaves you with nowhere to put your database access code except in your App.BusinessLogic assembly.

Perhaps you really need to rename App.Data to App.Model (or something similar), and have a new App.DataAccess assembly that talks to the database (perhaps implementing a Repository pattern). Having done that, I would split things up like this:

1.  App.DataAccess
2.  App.DataAccess
3.  App.DataAccess
4.  App.Model
5.  App.BusinessLogic

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T17:22:13.133

我可能会去

1.  数据
2.  数据
3.  数据，虽然我不完全确定班级在做什么
4.  数据
5.  商业逻辑

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T17:28:15.743

1.  -> 应用程序数据
2.  -> 应用程序数据
3.  -> App.BusinessLogic 或 App.Data - 不确定这是什么意思。
4.  -> App.BusinessLogic
5.  -> App.BusinessLogic

# apache - 如何获取当前通过 Apache 服务器上的 HTTP 表单上传的所有文件的状态报告？

> ID：216704
> 
> 赞同：0
> 
> 时间：2008-10-19T17:25:14.033
> 
> 标签：apache, http, file, upload, status

如何获取当前通过基于 HTTP 表单的文件上传到 Apache 服务器上的所有文件的状态报告？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T17:49:09.430

我不相信你可以用 Apache 本身做到这一点。就 Apache 而言，上传看起来只不过是一个 POST。有模块和其他服务器对上传进行特殊处理，所以你可能会有一些运气。在您的应用程序中跟踪它可能会更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T21:11:18.723

查看[SWFUpload](http://swfupload.org/)，它使用 Flash（以一种很好的方式）来帮助管理多个上传。

您可以通过事件监控一组文件的上传数量。

# winforms - 从 powershell 调用 OpenFileDialog

> ID：216710
> 
> 赞同：6
> 
> 时间：2008-10-19T17:32:01.367
> 
> 标签：winforms, powershell

当我运行以下命令时，PowerShell 挂起等待对话框关闭，即使对话框从未显示：

```
[void] [Reflection.Assembly]::LoadWithPartialName( 'System.Windows.Forms' )
$d = New-Object Windows.Forms.OpenFileDialog
$d.ShowDialog( ) 
```

调用`ShowDialog`一个`Windows.Forms.Form`工作正常。我还尝试创建 a`Form`并将其作为父级传递给`$d.ShowDialog`，但结果没有什么不同。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-19T17:57:54.387

我能够复制您的问题并找到解决方法。我不知道为什么会发生这种情况，但它发生在其他人身上。

如果将 ShowHelp 属性设置为 $true，您将正确显示对话框。

例子：

```
[void] [Reflection.Assembly]::LoadWithPartialName( 'System.Windows.Forms' )
$d = New-Object Windows.Forms.OpenFileDialog
$d.ShowHelp = $true
$d.ShowDialog( ) 
```

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T18:22:41.060

在我看来，对话框实际上打开得很好，但它位于 powershell 控制台窗口的后面。不幸的是，它没有显示在任务栏中，因此除非您移动 powershell 窗口或 Alt+Tab，否则没有迹象表明它存在。看来 ShowHelp 解决方法对我没有任何影响。

**编辑**这是一种使用辅助形式想法的方法。基本思想是创建一个新表单，从其 Shown 事件中打开 OpenFileDialog。关键是在打开对话框之前在窗体上调用Activate，使窗体来到最前面并出现对话框。我通过将 Location 设置为屏幕外值将表单移到屏幕外，但您也可以从 Shown 事件内部设置 Form.Visible = $false。

```
[void] [Reflection.Assembly]::LoadWithPartialName( 'System.Windows.Forms' )

$ofn = New-Object System.Windows.Forms.OpenFileDialog

$outer = New-Object System.Windows.Forms.Form
$outer.StartPosition = [Windows.Forms.FormStartPosition] "Manual"
$outer.Location = New-Object System.Drawing.Point -100, -100
$outer.Size = New-Object System.Drawing.Size 10, 10
$outer.add_Shown( { 
   $outer.Activate();
   $ofn.ShowDialog( $outer );
   $outer.Close();
 } )
$outer.ShowDialog() 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-27T09:30:28.633

显然这与多线程单元（MTA）模式有关。它似乎在单线程单元 (-STA) 模式下工作正常。

另请参阅：[您能解释一下 STA 和 MTA 吗？](https://stackoverflow.com/questions/127188/could-you-explain-sta-and-mta)

# makefile - 没有规则来制作目标 consoleio.c

> ID：216716
> 
> 赞同：1
> 
> 时间：2008-10-19T17:38:08.327
> 
> 标签：makefile

在[最近的一期中](https://stackoverflow.com/questions/215933/gcc-compiler-error-on-windows-xp)，我发现 DJGPP 只能接受 DOS 命令行字符限制。为了解决这个限制，我决定尝试编写一个 makefile 来允许我[传递更长的字符串](http://www.delorie.com/djgpp/v2faq/faq16_4.html)。在编写一个makefile并对其进行测试的过程中，我遇到了一个奇怪的错误。生成文件如下：

```
AS  :=  nasm
CC  :=  gcc
LD  :=  ld

TARGET      :=  $(shell basename $(CURDIR))
BUILD       :=  build
SOURCES     :=  source

CFLAGS  :=  -Wall -O -fstrength-reduce -fomit-frame-pointer -finline-functions \
            -nostdinc -fno-builtin -I./include
ASFLAGS :=  -f aout

export OUTPUT   :=  $(CURDIR)/$(TARGET)

CFILES      :=  $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
SFILES      :=  $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))

SOBJS   :=  $(SFILES:.s=.o)
COBJS   :=  $(CFILES:.c=.o)
OBJS    :=  $(SOBJS) $(COBJS)

build   :   $(TARGET).img

$(TARGET).img   :   $(TARGET).bin
    concat.py

$(TARGET).bin   :   $(OBJS)
    $(LD) -T link.ld -o $@ $^

$(SOBJS)    :   %.o :   %.asm
    $(AS) $(ASFLAGS) $< -o $@

$(COBJS)    :   %.o :   %.c
    $(CC) -c $< $(CFLAGS) -o $@ 
```

尝试运行它时，我收到此错误：

```
make: *** 没有规则来制作目标 `consoleio.c'，`consoleio.o' 需要。停止。
```

我不明白为什么它试图为 .c 文件找到规则。据我了解，如果文件在那里，它应该只使用它。如何使 make 不需要 .c 文件的规则？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-19T21:17:31.303

如果没有 VPATH，您正在尝试做的事情将无法工作，并且由于您仍在学习 makefile，因此我会避免使用 VPATH。

该规则正在寻找“consoleio.c”，如果我正确理解您的 makefile 不存在；存在的是“source/consoleio.c”。您可能应该将其更改为“$(SOURCES)/%.c”而不是“%c”。

但是，我没有检查您的语法是否符合该规则。如果不正确，将使用内置的 "%.o: %.c" 规则，这将有同样的问题。

但是，您正在做的方式不是我见过的通常方式。通常的方法是：

*   创建一个隐式规则“%.o: %.c”（或者在你的情况下为“%.o: $(SOURCES)/%.c”）
*   显式列出每个文件的依赖关系：“foo.o: foo.c bar.h baz.h”（没有命令，隐式规则有命令）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T18:20:51.377

让我们尝试一个非评论的答案......

可能性 A：

*   您的 SFILES 宏正在寻找以 ' `.s`' 结尾的文件。
*   您编译 SOBJS 的规则是查找以 ' `.asm`' 结尾的文件。

可能性 B：

*   您对 SOBJS 和 COBJS 的规则是我不认识的符号。
*   根据 GNU Make 手册，您可以将隐式规则编写为：

    %.o : %.c ; *命令*

您似乎有一个依赖于“ `%.o : %.asm`”的目标 $(SOBJS) 列表。我不确定 make 将如何解释它。

就个人而言，我不会相信构建规则中的通配符。我宁愿花时间准确列出构建代码所需的源文件。因此，我并不经常遇到这个问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T07:10:29.793

@CesarB 似乎已经解决了这个问题，我将添加一些观察结果。

1.  我强烈建议不要在构建规则中使用通配符。构建规则应该清楚地定义正在构建的内容，而不是依赖于目录中的文件。

2.  我还建议不要使用 VPATH，除非您 (1) 在单独的构建目录中构建，或者 (2) 将源文件分布在大量目录中。如果您所有的源代码都在一个目录中，那么使用 VPATH 只会让人感到困惑。

3.  := 赋值形式通常仅在已知变量评估需要很长时间时使用，例如使用 $(shell ...) 时。否则，最好使用“=”。

4.  使用“导出”将 OUTDIR 传播到 concat.py（我认为是这样，因为 concat.py 不带任何参数）是一种代码味道。如果可能，请将其作为参数传递。

# iphone - 我需要在 iPod touch 上测试什么（除了实际设备）？

> ID：216717
> 
> 赞同：0
> 
> 时间：2008-10-19T17:39:26.827
> 
> 标签：iphone, ipod-touch

我已经在 iPhone 上测试了我的 iPhone 应用程序。现在我想在 iPod touch 上测试一下。假设我有一个 iPod touch，我还需要什么？

我只是想确保我用于 iPhone 的所有证书和东西也适用于 iPod touch。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T18:00:02.230

证书将按原样正常工作。如果您真的想针对触摸进行测试，我建议您使用 ad-hoc 方法并询问其中一位请求支持的人是否愿意对其进行测试。如果您尚未进行临时分发，则门户中有说明。您可能只需要上传新版本，因为看起来 iTunes Connect 不允许您事后更改支持，可能是为了保持对给定版本的兼容性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T18:33:26.470

您必须创建一个新的配置文件，其中包含 iPhone 和 iPod touch 的设备 ID。但是你的证书会很好。

# c++ - 使用嵌套 C++ 类和枚举的优缺点？

> ID：216748
> 
> 赞同：48
> 
> 时间：2008-10-19T18:05:21.080
> 
> 标签：c++, class, enums, nested

使用嵌套的公共 C++ 类和枚举的优缺点是什么？例如，假设您有一个名为 的类`printer`，并且该类还存储输出托盘上的信息，您可以：

```
class printer
{
public:
    std::string name_;

    enum TYPE
    {
        TYPE_LOCAL,
        TYPE_NETWORK,
    };

    class output_tray
    {
        ...
    };
    ...
};

printer prn;
printer::TYPE type;
printer::output_tray tray; 
```

或者：

```
class printer
{
public:
    std::string name_;
    ...
};

enum PRINTER_TYPE
{
    PRINTER_TYPE_LOCAL,
    PRINTER_TYPE_NETWORK,
};

class output_tray
{
    ...
};

printer prn;
PRINTER_TYPE type;
output_tray tray; 
```

我可以看到嵌套私有枚举/类的好处，但是当涉及到公共枚举/类时，办公室是分开的——它似乎更像是一种风格选择。

那么，你更喜欢哪个，为什么？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-19T18:15:21.590

## 嵌套类

嵌套在类中的类有几个副作用，我通常认为是缺陷（如果不是纯粹的反模式）。

让我们想象下面的代码：

```
class A
{
   public :
      class B { /* etc. */ } ;

   // etc.
} ; 
```

甚至：

```
class A
{
   public :
      class B ;

   // etc.
} ;

class A::B
{
   public :

   // etc.
} ; 
```

所以：

*   **特权访问：** A::B 对 A 的所有成员（方法、变量、符号等）具有特权访问权限，这削弱了封装性
*   **A 的范围是符号查找的候选对象：**来自 B 内部的代码会将A 中的**所有**符号视为符号查找的可能候选对象，这可能会使代码混淆
*   **前向声明：**如果不给出 A 的完整声明，就无法前向声明 A::B
*   **可扩展性：**除非您是 A 的所有者，否则不可能添加另一个类 A::C
*   **代码冗长：**将类放入类只会使标题变大。您仍然可以将其分成多个声明，但无法使用类似命名空间的别名、导入或使用。

作为一个结论，除非例外（例如嵌套类是嵌套类的亲密部分......即使那样......），我认为在普通代码中嵌套类没有任何意义，因为缺陷远远超过感知的优势.

此外，它在不使用 C++ 命名空间的情况下模拟命名空间是一种笨拙的尝试。

在专业方面，您隔离此代码，如果是私有的，则使其无法使用，但来自“外部”类......

## 嵌套枚举

优点：一切。

骗子：没什么。

事实是枚举项会污染全局范围：

```
// collision
enum Value { empty = 7, undefined, defined } ;
enum Glass { empty = 42, half, full } ;

// empty is from Value or Glass? 
```

通过将每个枚举放在不同的命名空间/类中，您可以避免这种冲突：

```
namespace Value { enum type { empty = 7, undefined, defined } ; }
namespace Glass { enum type { empty = 42, half, full } ; }

// Value::type e = Value::empty ;
// Glass::type f = Glass::empty ; 
```

请注意，C++0x 定义了类枚举：

```
enum class Value { empty, undefined, defined } ;
enum class Glass { empty, half, full } ;

// Value e = Value::empty ;
// Glass f = Glass::empty ; 
```

正是针对这类问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-19T18:10:39.557

对于大型项目来说，一个可能成为大问题的缺点是不可能为嵌套类或枚举进行前向声明。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T18:15:32.683

在我看来，如果您永远不会将依赖类用于任何事情，而是使用独立类的实现，那么嵌套类就可以了。

当您想将“内部”类作为一个对象使用时，事情可能会开始变得有点笨拙，您必须开始编写提取器/插入器例程。不是一个漂亮的情况。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-19T18:21:35.447

似乎您应该使用命名空间而不是类来以这种方式对彼此相关的事物进行分组。我在做嵌套类时可以看到的一个缺点是，你最终会得到一个非常大的源文件，当你搜索一个部分时可能很难理解。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-08-31T21:24:14.610

使用嵌套的公共 C++ 类本身没有优点和缺点。只有事实。这些事实是 C++ 标准规定的。关于嵌套公共 C++ 类的事实是优点还是缺点取决于您要解决的特定问题。您给出的示例不允许判断嵌套类是否合适。

关于嵌套类的一个事实是，它们有权访问它们所属的类的所有成员。如果嵌套类不需要这种访问，这是一个缺点。但是如果嵌套类不需要这样的访问，那么它就不应该被声明为嵌套类。在某些情况下，当类*A*想要授予对某些其他类*B*的特权访问权限时。这个问题有三种解决方案

1.  让*B成为**A*的朋友
**   使*B成为**A*的嵌套类**   使*B需要的方法和属性成为**A 的*公共成员。**

 **在这种情况下，违反封装的是#3，因为*A*可以控制他的朋友和他的嵌套类，但不能控制调用他的公共方法或访问他的公共属性的类。

关于嵌套类的另一个事实是，除非您是 A 的所有者，否则*不可能将另一个类**A::C添加为**A*的嵌套类。然而，这是完全合理的，因为嵌套类具有特权访问。如果可以将*A::C添加为**A*的嵌套类，则*A::C*可以欺骗*A*授予对特权信息的访问权限；并且你会违反封装。它与声明基本相同：*****`friend``friend`声明不授予您任何特权，即您的朋友对他人隐瞒；它允许您的朋友访问您对非朋友隐藏的信息。在 C++ 中，称某人为朋友是一种利他行为，而不是自私行为。允许类成为嵌套类也是如此。*****

 ***关于嵌套公共类的其他一些事实：

*   **A 的范围是 B 的符号查找的候选对象**：如果您不想要这个，请让*B成为**A*的朋友，而不是嵌套类。但是，在某些情况下，您确实需要这种符号查找。
*   ***A::B*****不能前向声明**： *A*和*A::B*紧密耦合。能够在不知道*A 的情况下使用**A::B*只会隐藏这个事实。

 *总结一下：如果工具不符合您的需求，请不要责怪工具；责备自己使用该工具；其他人可能有不同的问题，该工具是完美的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-19T20:39:17.603

paercebal 说了所有关于嵌套枚举的内容。

WRT 嵌套类，我对它们的常见且几乎唯一的用例是当我有一个正在操作特定类型资源的类时，我需要一个代表该资源特定内容的数据类。在您的情况下， output_tray 可能是一个很好的例子，但如果该类将具有将从包含类外部调用的任何方法，或者不仅仅是一个数据类，我通常不使用嵌套类。我通常也不嵌套数据类，除非包含的类从未在包含类之外直接引用。

因此，例如，如果我有一个 printer_manipulator 类，它可能有一个用于打印机操作错误的包含类，但打印机本身将是一个非包含类。

希望这可以帮助。:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-03-28T17:05:55.637

请记住，您以后总是可以将嵌套类提升为顶级类，但如果不破坏现有代码，您可能无法做相反的事情。因此，我的建议是先让它成为一个嵌套类，如果它开始成为一个问题，在下一个版本中让它成为一个顶级类。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-19T19:13:34.610

对我来说，把它放在外面的一个很大的缺点是它成为了全局命名空间的一部分。如果枚举或相关类只真正适用于它所在的类，那么它是有道理的。因此，在打印机案例中，包括打印机在内的所有内容都将知道对枚举 PRINTER_TYPE 具有完全访问权限，而实际上并不需要知道它。我不能说我曾经使用过内部类，但是对于枚举，将其保留在内部似乎更合乎逻辑。正如另一位发帖人所指出的，使用命名空间对相似的项目进行分组也是一个好主意，因为阻塞全局命名空间确实是一件坏事。我之前从事过大型项目，仅在全局命名空间上显示一个自动完成列表就需要 20 分钟。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-20T04:35:38.670

我同意那些主张将你的枚举嵌入到一个类中的帖子，但在某些情况下，不这样做更有意义（但请至少把它放在一个命名空间中）。如果多个类使用在不同类中定义的枚举，则这些类直接依赖于其他具体类（拥有该枚举）。这肯定代表了一个设计缺陷，因为该类将负责该枚举以及其他职责。

所以，是的，如果其他代码只使用该枚举直接与该具体类交互，则将枚举嵌入到一个类中。否则，找一个更好的地方来保存枚举，比如命名空间。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-20T04:54:36.793

如果您将枚举放入类或命名空间中，智能感知将能够在您尝试记住枚举名称时为您提供指导。肯定是小事，但有时小事很重要。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-20T18:15:02.107

Visual Studio 2008 似乎无法为嵌套类提供智能感知，因此在我曾经拥有嵌套类的大多数情况下，我已切换到 PIMPL 习惯用法。如果仅由该类使用，我总是将枚举放在类中，或者当多个类使用枚举时，将枚举放在与该类相同的命名空间中的类之外。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-09-11T12:03:46.490

我可以看到嵌套类的一个缺点，即最好使用泛型编程。

如果小类是在大类之外定义的，您可以将大类作为类模板，并将您将来可能需要的任何“小”类与大类一起使用。

泛型编程是一个强大的工具，恕我直言，我们在开发可扩展程序时应该牢记这一点。奇怪，没有人提到这一点。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2013-05-31T10:37:51.800

我遇到的嵌套类的唯一问题是 C++ 不允许我们在嵌套类函数中引用封闭类的对象。我们不能说“Enclosure::this”

（但也许有办法？）

# c# - Can't create xmlns reference to other project in XAML

> ID：216749
> 
> 赞同：6
> 
> 时间：2008-10-19T18:06:02.123
> 
> 标签：c#, .net, wpf, xaml, .net-3.5

I have a WPF project defined like this:

```
MyApp.sln
  MyAppWPF
  MyApp.Domain

```

In one of my xaml files in the MyAppWPF project I'm trying to reference a class defined in MyApp.Domain project. I have a **project reference** in MyAppWPF to MyApp.Domain. I am trying to create the reference like this:

```
<Window x:Class="MyAppWPF.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:MyApp.Domain;assembly=MyApp.Domain"
    Title="Window1" Height="305" Width="485">
    <Window.Resources>
       <local:MyClass x:Key="mine" />
    </Window.Resources>
</Window>

```

I get an error saying the assembly cannot be found, however I can create an instance of the class I want to reference in the code behind, so I know I've got it referenced correctly.

How do I do this? Do I need a strong name, or reference the dll directly instead of using a project reference?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2015-08-12T16:39:41.840

`;assembly=`如果它对任何人有帮助，我可以通过简单地在命名空间声明的末尾添加引用包含项目本身的内容来解决我的问题。例如：

```
xmlns:local="clr-namespace:YourProjectNameSpace;assembly=" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T18:13:20.503

Check if

1.  the fully qualified name for MyClass is MyApp.Domain.MyClass
2.  MyClass has a default public constructor (with no parameters) so that XAML can instantiate it.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T12:31:44.890

能有什么帮助吗？

[Visual Studio 2008 (RTM) WPF 设计器无法加载程序集或依赖项](http://sdolha.spaces.live.com/Blog/cns!4121802308C5AB4E!3591.entry)

我假设您使用的是 Visual Studio 2008。如果您使用的是 Visual Studio 2005，这是代号为“Cider”的 XAML 设计器中的一个已知问题，它包含在“Visual Studio 2005 Extensions for WPF and WCF”中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-02-26T23:10:52.520

`assembly=MyApp.Domain`如果您正在动态编译松散的 XAML，您只需要输入。

如果您最初只是构建一次 XAML，请排除该令牌并直接说`xmlns:local="clr-namespace:MyApp.Domain"`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-07T13:46:44.463

如果 XAML 不是松散的（在程序集 (DLL/EXE) 中编译，
请确保该程序集具有对您正在查找的程序集的引用
（右键单击项目 --> 添加引用...）。

如果 XAML是松散的，请确保它正在寻找的程序集被复制到运行 exe 的同一目录中。

# asp.net - Understanding performance hit of an application role in SQL with ASN.NET

> ID：216758
> 
> 赞同：9
> 
> 时间：2008-10-19T18:11:40.787
> 
> 标签：asp.net, performance, sql-server-2005

I use MS SQL Server 2005 application roles in an application. I execute the `sp_setapprole` to start the SPs role and to finish `sp_unsetapprole.`

"**connection pooling doesn't work**" with application pooling, and there is no way to react on connection "**disconnect event**" (execute `sp_unsetapprole` just before disconnection).

I decide to call `sp_setapprole` at the start of all my SPs and call `sp_unsetapprole` at the end of all SPs.

Have you used SQL application roles? What are your XPs? What about performance hits?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T03:13:34.390

过去我已经推出了自己的“approle”，这并不太难。为每种类型的用户（经理、收银员、职员等）创建一个数据库角色。使用组名（manager_user、caser_user、clerk_user 等）创建一个数据库用户。为您的真实用户创建帐户并将他们置于数据库角色中。通过将他们登录到数据库（打开和关闭连接）、查找表或**最好**的方法来验证您的 asp.net 用户，如果您使用 Windows 身份验证并从 IIS 获取他们的用户名。检查他们在数据库角色中的成员身份，但使用 role_user 登录数据库。您可以通过 role_user 保护数据库对象，用户无需登录，也无权访问任何 sql 对象，您将获得连接池。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-19T18:58:39.583

我以前没有使用过应用程序角色，但从我对性能命中的了解是，在设置应用程序角色后，无法恢复到上一个​​。安全上下文。因此，连接不能在池中重用。仅此一项就是一个巨大的性能。命中迫使您在使用应用角色时三思而后行。

但是，文档说从 SQL Server 2005 开始，有一种方法可以记住从 sp_setapprole 返回的一种 cookie 中的原始安全上下文，然后使用 sp_unsetapprole 恢复到它。所以池应该再次工作。如果我是你，我会比较性能。有几个简单的语句/存储过程。

您有什么理由不在应用程序级别使用标准 ASP.NET 成员资格 API 而不是应用程序角色？

# audio - 如何在三星手机的 Java ME 中播放声音文件？

> ID：216766
> 
> 赞同：0
> 
> 时间：2008-10-19T18:19:56.370
> 
> 标签：audio, java-me, mobile

我想播放的文件格式包括 .wav、.mp3、.midi。

我尝试使用 Wireless Toolkit 类但没有成功。我也尝试过使用作为三星 SDK 一部分的 AudioClip 类；再次与

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T22:05:59.177

如果此设备支持音频/mpeg，您应该能够在您的 midlet 中使用此代码播放 mp3...

这适用于我的诺基亚 symbian 手机

```
// Code starts here put this into midlet run() method

public void run()
{
  try
  {
    InputStream is = getClass().getResourceAsStream("your_audio_file.mp3");
    player = Manager.createPlayer(is,"audio/mpeg");

//  if "audio/mpeg" doesn't work try "audio/mp3"

    player.realize();  
    player.prefetch();
    player.start();
  }
  catch(Exception e)
  {}
} 
```

至于模拟器，我的诺基亚经验是我无法让它模拟 mp3 播放器，但是当我将应用程序放在手机上时它可以工作......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T21:50:28.503

如果没有要查看的源代码，我建议[首先使用无线工具包（来自 http://java.sun.com）](http://java.sun.com)first)。它包含用于 Windows 的标准 J2ME 模拟器和允许您播放 wav 文件的示例代码。假设您可以正常工作，请在您的三星设备上尝试相同的代码（当然，wav 文件的位置可能会发生变化，因此您需要在示例代码中进行微小的修改）。假设可行，请将您的代码与示例代码进行比较。

# php - 我如何使用 php？

> ID：216771
> 
> 赞同：5
> 
> 时间：2008-10-19T18:23:59.797
> 
> 标签：php

我知道这对 PHP 人来说是一个简单的问题，但我不懂语言，只需要在我的页面被点击时从另一个网页做一个简单的“获取”。即向其他页面发出该页面已被点击的信号。

编辑： curl 对我不可用。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-19T18:25:33.817

如果 curl 包装器处于打开状态（默认情况下），您可以使用：

```
file_get_contents('http://www.example.org'); 
```

请注意，这是同步发生的，因此在请求完成之前，您的页面也不会。最好记录对日志文件（或数据库）的访问并偶尔导出数据。或者，您可以在页面完成后执行请求，并将输出发送到客户端。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-19T18:36:50.237

当心`file_get_contents()`和`fopen()`：

> 如果 PHP 已经确定 filename 指定了一个已注册的协议，并且该协议已注册为网络 URL，PHP 将检查以确保启用了 allow_url_fopen。如果它被关闭，PHP 将发出警告并且 fopen 调用将失败。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T18:26:04.987

有很多方法......最简单的是`file_get_contents('http://...');` 其他功能，例如`fopen()`也支持http：流。

如果您需要更多控制，我建议您查看 curl（请参阅 参考资料`curl_init`）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T09:18:04.577

有多种方法可以使用 PHP 发送 GET 请求。如上所述，您可以使用`file_get_contents`,`fopen`或 cURL。

您还可以使用[HTTP 扩展](http://php.net/http)、`fsockopen()`函数或[流](http://php.net/stream_get_contents)通过`fopen`。

我建议检查[一下 WordPress 做](http://trac.wordpress.org/browser/trunk/wp-includes/http.php)了什么，因为它可以处理几乎所有的可能性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T18:25:49.353

你可能想要使用[cURL](http://us3.php.net/manual/en/curl.examples.php)

# geocoding - 地址标准化/更正/地理编码

> ID：216773
> 
> 赞同：9
> 
> 时间：2008-10-19T18:25:01.447
> 
> 标签：geocoding, mailaddress

我的工作地点正在考虑购买第三方工具，用于基于批量的美国和加拿大地址更正，带有地理编码。

*   你用过哪些产品？
*   你喜欢他们什么？
*   你不喜欢他们什么？

请注意，我们是一家 C/C++ Unix 商店。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-19T18:53:16.337

我们使用[Melissa Data](http://www.melissadata.com/)，他们有许多解决方案，包括地理编码和地址规范化。他们有很好的 API，支持也很好。他们的解决方案适用于许多平台和语言，包括 Unix 上的 C 和 C++。不能对他们有任何负面的看法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-01-15T17:56:16.367

我们在办公室使用 Trillium。它们提供了可以合并到项目中的 C# 库。它将接受一个地址并返回一个非常复杂的标准化地址对象，但确实包含地理编码等信息（这对于计算税收很重要）。

# sql - 跳过与 SQL 副本的主键冲突

> ID：216778
> 
> 赞同：1
> 
> 时间：2008-10-19T18:29:23.310
> 
> 标签：sql, database, primary-key

我收集了大量原始数据（大约 3 亿行），其中包含大约 10% 的复制数据。我需要将数据存入数据库。为了性能，我尝试使用 SQL 副本。问题是当我提交数据时，主键异常会阻止任何数据被处理。我可以更改主键的行为，以便简单地忽略或替换冲突数据吗？我真的不在乎这两种方式 - 我只需要每个数据的一个唯一副本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T18:39:03.323

我认为你最好的选择是放弃约束，加载数据，然后清理它并重新应用约束。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T23:17:27.440

使用 select 语句准确地选择要插入的数据，而不会出现重复项。

将其用作 CREATE TABLE XYZ AS SELECT * FROM (query-just-non-dupes) 的基础

您可以查看有关如何选择非重复行的[ASKTOM想法](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:6407993912330)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T18:54:38.673

这就是我正在考虑做的事情，但担心在 3 亿条目数据库中摆脱 3000 万随机放置的行的性能。重复数据也具有空间关系，这就是为什么我想在加载数据时尝试解决问题，而不是在我全部加载后解决问题。

# java - spring + tomcat + axis2 == jax-ws 网络服务？

> ID：216779
> 
> 赞同：5
> 
> 时间：2008-10-19T18:29:52.637
> 
> 标签：java, web-services, spring, tomcat, axis

我正在寻找一个简单的示例/教程，用于使用 spring、axis2 和 tomcat 实现基于 wsdl 定义的 JAX-WS（soap1.1 和 soap1.2）Web 服务。

暗示任何人？

——约纳坦

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T08:03:17.813

在 SOAP 的世界中没有“直截了当”的东西。由于这种野兽的过度工程性质，任何示例和教程都必然会很复杂。

如果您可以选择您的技术，我建议您将轴放在一边，并使用 Tomcat 6 + Java 6 + Metro。[Metro](https://metro.dev.java.net/)是 Sun 最新、最出色的 Java Web 服务 (jax-ws) 堆栈。与 JavaEE 注释相结合，这是一种快速启动 Web 服务的***相对轻松的方式。***

很抱歉没有直接回答这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-08T20:24:07.383

不幸的是，即使是最新版本的 Metro 也存在 tomcat 和 JDK6 的问题，我尝试在我的机器上运行示例应用程序，并记录了我遇到并解决的一些问题。为了其他利益，请在此处查看： [运行 Metro + Tomcat 6 + JDK 6](http://software-wikipedia.blogspot.com/2010/01/trying-to-run-jax-ws-sample-application.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-02T09:24:55.340

NetBeans IDE 是一个很好的起点。在 NB 插件中启用 Axis2 支持。您可以从 WSDL（假设您首先使用合同）和基于 JAX-WS 的 WS 客户端创建基于 JAX-WS 的 Web 服务。如果您不喜欢 NetBeans 生成的内容或其部署策略，您仍然可以在它生成的代码的基础上进行构建

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T18:05:16.450

Axis2 在使用 Jax-WS 时不支持 Spring Web 服务。请参阅此邮件列表帖子：

[http://markmail.org/message/hohdmsupo3r3gltl?q=list:org%2Eapache%2Ews%2Eaxis-user+spring+jax-ws](http://markmail.org/message/hohdmsupo3r3gltl?q=list:org%2Eapache%2Ews%2Eaxis-user+spring+jax-ws)

为此，您需要一个自定义模块将 BeanFactory 添加到 MessageContext 中，然后在您的 Web 服务中检索它。或者您可以编写一个自定义调度程序。

# java - Log4j，将 Web 应用配置为使用相对路径

> ID：216781
> 
> 赞同：80
> 
> 时间：2008-10-19T18:32:01.777
> 
> 标签：java, web-applications, log4j

我有一个必须部署在 Win 或 Linux 机器上的 java webapp。我现在想添加 log4j 进行日志记录，并且我想为日志文件使用相对路径，因为我不想在每次部署时更改文件路径。容器很可能是 Tomcat，但不一定。

这样做的最佳方法是什么？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-10-19T18:58:07.450

Tomcat 设置 catalina.home 系统属性。您可以在 log4j 属性文件中使用它。像这样的东西：

```
log4j.rootCategory=DEBUG,errorfile

log4j.appender.errorfile.File=${catalina.home}/logs/LogFilename.log 
```

在 Debian（包括 Ubuntu）上，`${catalina.home}`将不起作用，因为它指向 /usr/share/tomcat6，它没有指向 /var/log/tomcat6 的链接。这里只使用`${catalina.base}`.

如果您使用另一个容器，请尝试查找类似的系统属性，或定义您自己的。设置系统属性将因平台和容器而异。但是对于 Linux/Unix 上的 Tomcat，我会在 CATALINA_HOME/bin 目录中创建一个 setenv.sh。它将包含：

```
export JAVA_OPTS="-Dcustom.logging.root=/var/log/webapps" 
```

那么你的 log4j.properties 将是：

```
log4j.rootCategory=DEBUG,errorfile

log4j.appender.errorfile.File=${custom.logging.root}/LogFilename.log 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2008-10-20T10:52:18.397

我终于以这种方式完成了。

添加了执行以下操作的 ServletContextListener：

```
public void contextInitialized(ServletContextEvent event) {
    ServletContext context = event.getServletContext();
    System.setProperty("rootPath", context.getRealPath("/"));
} 
```

然后在 log4j.properties 文件中：

```
log4j.appender.file.File=${rootPath}WEB-INF/logs/MyLog.log 
```

通过这种方式，只要您在设置“rootPath”系统属性之前不使用它，Log4j 就会写入正确的文件夹。这意味着您不能从 ServletContextListener 本身使用它，但您应该能够从应用程序的其他任何地方使用它。

它应该适用于每个 Web 容器和操作系统，因为它不依赖于容器特定的系统属性，并且不受操作系统特定路径问题的影响。使用 Tomcat 和 Orion Web 容器以及在 Windows 和 Linux 上进行了测试，到目前为止它运行良好。

你怎么看？

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-26T11:40:15.367

如果你使用 Spring，你可以：

1) 创建一个 log4j 配置文件，例如“/WEB-INF/classes/log4j-myapp.properties” 不要将其命名为“log4j.properties”

例子：

```
log4j.rootLogger=ERROR, stdout, rollingFile

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - <%m>%n

log4j.appender.rollingFile=org.apache.log4j.RollingFileAppender
log4j.appender.rollingFile.File=${myWebapp-instance-root}/WEB-INF/logs/application.log
log4j.appender.rollingFile.MaxFileSize=512KB
log4j.appender.rollingFile.MaxBackupIndex=10
log4j.appender.rollingFile.layout=org.apache.log4j.PatternLayout
log4j.appender.rollingFile.layout.ConversionPattern=%d %p [%c] - %m%n
log4j.appender.rollingFile.Encoding=UTF-8 
```

我们将在第 (3) 点稍后定义“myWebapp-instance-root”

2) 在 web.xml 中指定配置位置：

```
<context-param>
  <param-name>log4jConfigLocation</param-name>
  <param-value>/WEB-INF/classes/log4j-myapp.properties</param-value>
</context-param> 
```

3) 为您的 webapp 的根指定一个**唯一的**变量名称，例如“myWebapp-instance-root”

```
<context-param>
  <param-name>webAppRootKey</param-name>
  <param-value>myWebapp-instance-root</param-value>
</context-param> 
```

4）添加一个Log4jConfigListener：

```
<listener>
  <listener-class>org.springframework.web.util.Log4jConfigListener</listener-class>
</listener> 
```

如果您选择不同的名称，请记住在 log4j-myapp.properties 中也进行更改。

请参阅我的文章（仅限意大利语......但应该可以理解）： [http ://www.megadix.it/content/configurare-path-relativi-log4j-utilizzando-spring](http://www.megadix.it/content/configurare-path-relativi-log4j-utilizzando-spring)

**更新 (2009/08/01)** 我已将我的文章翻译成英文： [http ://www.megadix.it/node/136](http://www.megadix.it/node/136)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-01-05T22:44:07.920

只是对[Iker](https://stackoverflow.com/a/218037/2279200)解决方案的评论。

`ServletContext`是解决您问题的好方法。但我认为这对维护没有好处。大多数时间日志文件都需要保存很长时间。

由于`ServletContext`在已部署文件下制作文件，因此在重新部署服务器时将其删除。我的建议是使用 rootPath 的父文件夹而不是子文件夹。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-20T15:20:39.073

如果您未在 FileAppender 的路径属性中指定根目录，log4j 是否仅使用应用程序根目录？所以你应该能够使用：

log4j.appender.file.File=logs/MyLog.log

自从我完成 Java Web 开发以来已经有一段时间了，但这似乎是最直观的，并且也不会与写入 ${catalina.home}/logs 目录的其他不幸命名的日志发生冲突。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-11-19T16:23:52.153

作为对[https://stackoverflow.com/a/218037/2279200](https://stackoverflow.com/a/218037/2279200)的进一步评论- 如果 Web 应用程序隐式启动其他 ServletContextListener，这可能会中断，这可能会更早被调用并且已经尝试使用 log4j - 在这种情况下，在设置确定日志根目录的属性之前，将读取并解析 log4j 配置 => 日志文件将出现在当前目录下方的某个位置（启动 tomcat 时的当前目录）。

我只能想到以下解决方案： - 将您的 log4j.properties（或 logj4.xml）文件重命名为 log4j 不会自动读取的内容。- 在您的上下文过滤器中，设置属性后，调用 DOM/PropertyConfigurator 帮助程序类以确保读取您的 log4j-.{xml,properties} -重置 log4j 配置（IIRC 有一种方法可以做到这一点）

这有点蛮力，但我认为这是使其防水的唯一方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-12-25T01:01:34.123

我的建议是日志文件应该始终记录在 webApp 的根上下文之上，所以如果我们重新部署 webApp，我们不想覆盖现有的日志文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-04-17T18:55:52.450

如果您使用的是 Maven，我为您提供了一个很好的解决方案：

1.  编辑您的 pom.xml 文件以包含以下行：

    ```
    <profiles>
        <profile>
            <id>linux</id>
            <activation>
                <os>
                    <family>unix</family>
                </os>
            </activation>
            <properties>
                <logDirectory>/var/log/tomcat6</logDirectory>
            </properties>
        </profile>
        <profile>
            <id>windows</id>
            <activation>
                <os>
                    <family>windows</family>
                </os>
            </activation>
            <properties>
                <logDirectory>${catalina.home}/logs</logDirectory>
            </properties>
        </profile>
    </profiles> 
    ```

    在这里，您`logDirectory`专门为操作系统系列定义属性。

2.  使用文件中已定义`logDirectory`的属性`log4j.properties`：

    ```
    log4j.appender.FILE=org.apache.log4j.RollingFileAppender
    log4j.appender.FILE.File=${logDirectory}/mylog.log
    log4j.appender.FILE.MaxFileSize=30MB
    log4j.appender.FILE.MaxBackupIndex=10
    log4j.appender.FILE.layout=org.apache.log4j.PatternLayout
    log4j.appender.FILE.layout.ConversionPattern=%d{ISO8601} [%x] %-5p [%t] [%c{1}] %m%n 
    ```

3.  就是这样！

**PS：**我确信这可以使用 Ant 来实现，但不幸的是我没有足够的经验。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-09-03T15:09:41.043

我的解决方案类似于 Iker Jimenez 的[解决方案](https://stackoverflow.com/a/218037/2369544)，但`System.setProperty(...)`我没有使用`org.apache.log4j.PropertyConfigurator.configure(Properties)`. 为此，我还需要 log4j 无法自行找到它的配置，我手动加载它（Wolfgang Liebich 的[回答](https://stackoverflow.com/a/27021823/2369544)中描述了这两点）。

这适用于 Jetty 和 Tomcat，独立或从 IDE 运行，需要零配置，允许将每个应用程序的日志放在自己的文件夹中，无论容器中有多少应用程序（这是基于 - 的解决方案的[问题](https://stackoverflow.com/questions/216781/log4j-configuring-a-web-app-to-use-a-relative-path#comment4207525_218037)`System`）。这样一来，您还可以将 log4j 配置文件放在 Web 应用程序中的任何位置（例如，在一个项目中，我们将所有配置文件都放在里面`WEB-INF/`）。

细节：

1.  我在类路径中的文件中有我的属性`log4j-no-autoload.properties`（例如，在我的 Maven 项目中，它最初位于 中`src/main/resources`，被打包到中`WEB-INF/classes`），
2.  它的文件追加器配置为例如：

    ```
    log4j.appender.MyAppFileAppender = org.apache.log4j.FileAppender
    log4j.appender.MyAppFileAppender.file = ${webAppRoot}/WEB-INF/logs/my-app.log
    ... 
    ```

3.  而且我有一个这样的上下文监听器（使用 Java 7 的“try-with-resource”语法变得更短）：

    ```
    @WebListener
    public class ContextListener implements ServletContextListener {
        @Override
        public void contextInitialized(final ServletContextEvent event) {
            Properties props = new Properties();
            InputStream strm =
                ContextListener.class.getClassLoader()
                    .getResourceAsStream("log4j-no-autoload.properties");
            try {
                props.load(strm);
            } catch (IOException propsLoadIOE) {
                throw new Error("can't load logging config file", propsLoadIOE);
            } finally {
                try {
                    strm.close();
                } catch (IOException configCloseIOE) {
                    throw new Error("error closing logging config file", configCloseIOE);
                }
            }
            props.put("webAppRoot", event.getServletContext().getRealPath("/"));
            PropertyConfigurator.configure(props);
            // from now on, I can use LoggerFactory.getLogger(...)
        }
        ...
    } 
    ```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-04-17T22:01:25.180

**您可以使用工作目录**指定日志文件的相对路径：

```
appender.file.fileName = ${sys:user.dir}/log/application.log 
```

这独立于 servlet 容器，不需要将自定义变量传递给系统环境。

# java - 使用 Java 中的 sqlite 获取最后插入的 id 的最佳方法是什么？

> ID：216790
> 
> 赞同：14
> 
> 时间：2008-10-19T18:41:02.960
> 
> 标签：java, sqlite, jdbc

使用 Java 中的 sqlite 获取最后插入的 id 的最佳方法是什么？谷歌给了我不同的答案——有人说选择last-insert-rowid；其他人说调用 statement.getGeneratedKeys()。最好的路线是什么？（我只想返回 id，而不是将其用于其他插入或任何东西。）

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-07T14:20:51.877

两种方法都执行完全相同的 SQL 语句，但[`java.sql.Statement.getGeneratedKeys()`](http://java.sun.com/javase/6/docs/api/java/sql/Statement.html#getGeneratedKeys())更易于移植到不同的底层数据库。

使用[`sqlite3_last_insert_rowid()`](http://www.sqlite.org/c3ref/last_insert_rowid.html)C API 函数或[`last_insert_rowid()`](http://www.sqlite.org/lang_corefunc.html)SQL 函数是检索上次插入期间生成的 rowid 的正确方法。

SQLite 支持[SQL 标量函数](http://en.wikipedia.org/wiki/User-defined_function)语法：

```
SELECT function-name(); 
```

因此，如果您无法直接访问 C API，则可以`last_insert_rowid()`通过`SELECT`语句调用标量函数。

如果您查看[SQLiteJDBC](http://www.zentus.com/sqlitejdbc/)实现的[源代码](http://www.google.com/codesearch/p?hl=en#YeZoLeH6dBk/src/org/sqlite/MetaData.java&q=%22select%20last_insert_rowid%22%20metadata.java)（这是您正在使用的吗？），您会发现这正是 JDBC 包装器的作者所做的：

```
ResultSet getGeneratedKeys() throws SQLException {
    if (getGeneratedKeys == null) getGeneratedKeys = conn.prepareStatement(
        "select last_insert_rowid();");
    return getGeneratedKeys.executeQuery();
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-20T02:44:57.333

`getGeneratedKeys()`如果您的 JDBC 驱动程序支持，请使用它。您不想在插入后自己尝试获取密钥。如果您的驱动程序不支持`getGeneratedKeys()`，那么我会在插入之前从键中获取下一个值。

# java - 大O符号作业--代码片段算法分析？

> ID：216796
> 
> 赞同：27
> 
> 时间：2008-10-19T18:52:21.610
> 
> 标签：java, big-o

作为家庭作业，我得到了以下 8 个代码片段来分析并给出运行时间的 Big-Oh 符号。谁能告诉我我是否走在正确的轨道上？

```
//Fragment 1
for(int i = 0; i < n; i++)
    sum++; 
```

我在考虑片段 1 的 O(N)

```
//Fragment 2
for(int i = 0; i < n; i+=2)
    sum++; 
```

片段 2 也是 O(N)

```
//Fragment 3
for(int i = 0; i < n; i++)
    for( int j = 0; j < n; j++)
        sum++; 
```

片段 3 的 O(N^2)

```
//Fragment 4
for(int i = 0; i < n; i+=2)
    sum++;
for(int j = 0; j < n; j++)
    sum++; 
```

片段 4 的 O(N)

```
//Fragment 5
for(int i = 0; i < n; i++)
    for( int j = 0; j < n * n; j++)
        sum++; 
```

片段 5 的 O(N^2) 但 n * n 让我有点失望，所以我不太确定

```
//Fragment 6
for(int i = 0; i < n; i++)
    for( int j = 0; j < i; j++)
        sum++; 
```

片段 6 也是 O(N^2)

```
//Fragment 7
for(int i = 0; i < n; i++)
    for( int j = 0; j < n * n; j++)
        for(int k = 0; k < j; k++)
            sum++; 
```

片段 7 的 O(N^3) 但再次 n * n 让我失望

```
//Fragment 8
for(int i = 1; i < n; i = i * 2)
    sum++; 
```

片段 8 的 O(N)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-19T18:56:31.897

我认为片段 5 是 O(n^3)，类似地片段 7 是 O(n^5)*。对于片段 8，它看起来也像 O(log(n))。

对于 n * n 个问题，你必须执行循环体 n * n 次，所以它是 O(n^2)，然后你将它与其他代码的顺序复合。Fragment 8 实际上将计数器加倍而不是增加它，所以问题越大，你要做的额外工作就越少，所以它是 O(log(n))

***编辑：**片段 7 是 O(n^5)，而不是我之前认为的 O(n^4)。这是因为 j*和 k*都从 1 变为 n * n。抱歉我没有早点发现这个。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-20T18:18:09.307

片段 7 是 O(n^5)，而不是当前接受的评论声称的 O(n^4)。否则，它是正确的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T19:23:07.400

对于案例 8，尝试写出 N 的某些值的迭代次数，看看模式是什么样的......它不是 O(N)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T18:56:40.430

你似乎走在正确的轨道上。关于 N*N，您认为它会产生什么影响？它是 N 的另一个因素，因此它可能是更高的阶数。

只是一个警告，我看到另一篇这样的帖子，它被极低的投票。当心。[这](https://stackoverflow.com/questions/216496/logic-equivalence-question)是帖子。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-14T12:42:29.487

你走在正确的轨道上，但这里有一个关于如何让事情变得更清晰的提示。假设你有一些代码：

```
for(i = 0; i < n; i++) {
   for(j = 0; j < 100; j++){....}
} 
```

对，考虑一下你有不同级别的代码这一事实。在此示例中，到目前为止您只能看到 3 个级别：

1.  从 0-n 开始的外部 for 循环
2.  另一个从 0 到 100 的 for 循环
3.  里面的一些代码，标记为`...`

在任何时候，您都不应该尝试一次性计算所有内容。这是大多数初学者犯某种算术错误的地方。为每个级别单独计算它，然后将它们相乘。

祝你好运！

# asp.net - 将网站/页面嵌入 Silverlight

> ID：216812
> 
> 赞同：7
> 
> 时间：2008-10-19T19:09:45.617
> 
> 标签：asp.net, silverlight

是的，这听起来倒退了。我想在我的 Silverlight 应用程序中创建一个区域或框架来托管我网站的另一个页面。我以前看过它，但我似乎找不到任何例子。

这样我可以使用 SL 控制整个页面布局，但仍然使用现有的 aspx 页面。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T21:00:01.650

是的，它可以做到，而且很容易做到。我计划在博客上介绍我的 HtmlBrowser 控件并发布源代码。基础是确保 Silverlight 控件在启用 isWindowless 参数的情况下托管，然后您可以在运行时通过 HtmlPage 类创建 IFRAME 元素并将 src 属性设置为 HTML 页面位置。有趣的部分是正确调整尺寸，但这并不太难。

在接下来的几天里 关注我的博客[http://craign.net/ ，因为我将发布我的控制。](http://craign.net/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-09T15:04:42.410

使用此技术时是否会出现框架中断代码中断。

# winforms - 从 powershell 调用 FolderBrowserDialog

> ID：216817
> 
> 赞同：3
> 
> 时间：2008-10-19T19:15:00.660
> 
> 标签：winforms, powershell

与[此问题](https://stackoverflow.com/questions/216710/call-openfiledialog-from-powershell)类似，在运行以下代码后，浏览器对话框确实出现了所有正确的按钮，但缺少通常显示可用文件夹的选择区域：

```
[void] [Reflection.Assembly]::LoadWithPartialName( 'System.Windows.Forms' )
$d = New-Object Windows.Forms.FolderBrowserDialog
$d.ShowDialog( ) 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-20T04:34:56.927

不久前我遇到了这个问题，并在 MSDN 论坛上找到了以下 COM 解决方法：

```
$app = new-object -com Shell.Application
$folder = $app.BrowseForFolder(0, "Select Folder", 0, "C:\")
if ($folder.Self.Path -ne "") {write-host "You selected " $folder.Self.Path} 
```

[http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.dotnet.framework.windowsforms.controls&tid=3607557a-43b3-40bf-8276-be00526e0520&p=1](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.dotnet.framework.windowsforms.controls&tid=3607557a-43b3-40bf-8276-be00526e0520&p=1)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-19T19:53:58.350

我相信这是在 MTA 线程中运行的 PowerShell 的问题。您可以在 STA（单线程单元）模式下运行版本 2 的 CTP，它将拉出正确的文件夹选择。它确实将菜单拉到 shell 窗口后面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T22:23:00.187

仅供参考，如果您正在寻找做 Windows 窗体的东西，目前有一种产品可以为 PowerShell（[管理脚本编辑器](http://www.adminscripteditor.com/)）做 Windows 窗体，而 Sapien 正在开发[窗体设计器（在](http://hosted.verticalresponse.com/172892/13e80641d0/176000434/c46cbf224d/)[PowerScripting Podcast](http://powerscripting.wordpress.com/2008/10/12/episode-45-rockin-roundtable/)上宣布），这可能为您的脚本解决其中的一些问题。

# c# - ImageUrl 在使用动态控件的回发时丢失，但文本框保持其价值

> ID：216818
> 
> 赞同：0
> 
> 时间：2008-10-19T19:19:13.817
> 
> 标签：c#, asp.net

我有一个以编程方式添加已定义的用户控件的按钮。我正在重建 Postback 上的每个控件，它们显示得很好。如果我在文本框中输入文本，它会显示得很好，但是我的图像正在丢失它们的 url。知道为什么或如何解决这个问题吗？

我尝试添加 AJAX 更新面板以查看是否有帮助，但没有。

进一步解释 - 我有一个按钮，点击后设置图像的 url - 我也把这个值放在文本框中只是为了看看是否发生同样的事情 - 回发后，我的文本框仍然有值，但图像没有- 我所有的其他 ASP.Net 图像都丢失了它们的图像，并且它们在控件上被定义（即：ImageUrl）

--- 更新 好的，我对我的问题有了更深入的了解——一些解决方案，但仍然存在一个问题。

图像丢失其 url 的原因是因为它们是而不是 ASP.Net 图像 - ASP.Net 在回发时重新创建它们时会记住这些值 - 但是我通过 javascript 更改的主图像失去了它的价值 - 我非常确定这是因为使用 javascript 来更改它，在回发时它会恢复到以前的值......所以对于一个解决方案，我将尝试将它填充到隐藏值中，然后在回发时使用该值来定义 ImageUrl图片...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-19T19:50:06.580

你是正确`<img>`的是一个html控件，`<asp:Image>`而是一个服务器控件。只要服务器控件启用了视图状态，它们就会在回发期间保持其值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T03:10:37.737

您是正确的，通过 JavaScript 更改图像的 URL 不会在回发期间返回它，因为这不是表单值。因此，如果您不将其保存到表单域中，例如您建议的隐藏域，它将永远丢失。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-05-30T05:34:16.693

图片不是表单域。这就是为什么它的价值永远不会发回服务器。

您的 asp:Image 控件在回发期间保留值的原因是因为它们存储在视图状态中（存储在隐藏字段中）。当您单击按钮时，此视图状态将发送回服务器，并且 asp.net 在页面生命周期的早期事件中从视图状态设置图像控件的 ImageUrl 属性。

简而言之，服务器端表单控件值在回发后可用。同样，如果您有普通的 html 表单字段 ( [https://www.w3schools.com/html/html_form_elements.asp](https://www.w3schools.com/html/html_form_elements.asp) )，您将使用 Request.Form 集合获得它的价值。

您正在使用 javascript 设置图像的 src（这显然不是原始视图状态），这就是为什么您没有在回发中获得它的价值。您应该使用 Hidden Field 使用 javascript 设置值，这可以在回发后使用。

# debugging - 调试器如何工作？

> ID：216819
> 
> 赞同：194
> 
> 时间：2008-10-19T19:20:59.367
> 
> 标签：debugging, internals

我一直想知道调试器是如何工作的？特别是可以“附加”到已经运行的可执行文件的那个。我知道编译器将代码转换为机器语言，但是调试器如何“知道”它所附加的内容？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-10-19T19:32:03.167

调试器如何工作的细节将取决于您正在调试的内容以及操作系统是什么。对于 Windows 上的本机调试，您可以在 MSDN 上找到一些详细信息：[Win32 调试 API](http://msdn.microsoft.com/en-us/library/ms809754.aspx)。

用户通过名称或进程 ID 告诉调试器要附加到哪个进程。如果是名称，则调试器将查找进程 ID，并通过系统调用启动调试会话；在 Windows 下，这将是[DebugActiveProcess](http://msdn.microsoft.com/en-us/library/ms679295(VS.85).aspx)。

连接后，调试器将像任何 UI 一样进入事件循环，但不是来自窗口系统的事件，而是操作系统将根据正在调试的进程中发生的情况生成事件——例如发生的异常。请参阅[WaitForDebugEvent](http://msdn.microsoft.com/en-us/library/ms681423(VS.85).aspx)。

调试器能够读取和写入目标进程的虚拟内存，甚至可以通过操作系统提供的 API 调整其寄存器值。请参阅Windows的[调试功能](http://msdn.microsoft.com/en-us/library/ms679303(VS.85).aspx)列表。

调试器能够使用符号文件中的信息将地址转换为源代码中的变量名称和位置。符号文件信息是一组单独的 API，并不是操作系统的核心部分。在 Windows 上，这是通过[Debug Interface Access SDK](http://msdn.microsoft.com/en-us/library/x93ctkx8.aspx)实现的。

如果您正在调试托管环境（.NET、Java 等），该过程通常看起来相似，但细节不同，因为虚拟机环境提供调试 API 而不是底层操作系统。

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2014-02-13T06:30:40.053

据我了解：

对于 x86 上的软件断点，调试器将指令的第一个字节替换为`CC`( [`int3`](http://en.wikipedia.org/wiki/INT_(x86_instruction)#INT_3))。这是[`WriteProcessMemory`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms681674.aspx)在 Windows 上完成的。当 CPU 到达该指令并执行 时[`int3`](http://en.wikipedia.org/wiki/INT_(x86_instruction)#INT_3)，这会导致 CPU 生成调试异常。操作系统接收到这个中断，意识到进程正在被调试，并通知调试器进程该断点被命中。

遇到断点并停止进程后，调试器会在其断点列表中查找，并将 替换为`CC`最初存在的字节。调试器设置[`TF`, 陷阱标志](http://en.wikipedia.org/wiki/Trap_flag)（[`EFLAGS`](http://en.wikipedia.org/wiki/FLAGS_register)通过修改[`CONTEXT`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms679284.aspx)），并继续该过程。[`INT 1`](http://en.wikipedia.org/wiki/BIOS_interrupt_call#Interrupt_table)陷阱标志使 CPU在下一条指令上自动生成单步异常 ( )。

当被调试的进程下一次停止时，调试器再次将断点指令的第一个字节替换为`CC`，然后进程继续。

我不确定这是否正是所有调试器实现的方式，但我编写了一个 Win32 程序，它可以使用这种机制进行自我调试。完全没用，但有教育意义。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-10-19T20:52:26.767

在 Linux 中，调试进程从[ptrace(2)](http://linux.die.net/man/2/ptrace)系统调用开始。 [本文](http://www.linuxjournal.com/article/6100)有一个很棒的教程，介绍了如何使用`ptrace`来实现一些简单的调试结构。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-19T20:41:22.763

如果您使用的是 Windows 操作系统，一个很好的资源将是 John Robbins 的“Debugging Applications for Microsoft .NET and Microsoft Windows”：

*   [http://www.amazon.com/dp/0735615365](https://rads.stackoverflow.com/amzn/click/com/0735615365)

（甚至是旧版本：[“调试应用程序”](https://rads.stackoverflow.com/amzn/click/com/0735608865)）

这本书有一章是关于调试器如何工作的，其中包括几个简单（但工作）调试器的代码。

由于我不熟悉 Unix/Linux 调试的细节，这些东西可能根本不适用于其他操作系统。但我猜想，作为对一个非常复杂的主题的介绍，这些概念——如果不是细节和 API——应该“移植”到大多数操作系统。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2019-05-09T13:29:58.223

我认为这里有两个主要问题需要回答：

**1\. 调试器如何知道发生了异常？**

当正在调试的进程中发生异常时，调试器会在目标进程中定义的任何用户异常处理程序有机会响应异常之前得到操作系统的通知。如果调试器选择不处理此（第一次机会）异常通知，则异常分派序列将继续进行，然后目标线程将有机会处理该异常（如果它愿意）。如果目标进程没有处理 SEH 异常，则向调试器发送另一个调试事件，称为第二次机会通知，以通知它在目标进程中发生了未处理的异常。[来源](https://www.microsoftpressstore.com/articles/article.aspx?p=2201303)

[![在此处输入图像描述](https://i.stack.imgur.com/QiMzM.png)](https://i.stack.imgur.com/QiMzM.png)

* * *

**2\. 调试器如何知道如何在断点处停止？**

简化的[答案](https://eli.thegreenplace.net/2011/01/27/how-debuggers-work-part-2-breakpoints)是：当您在程序中设置断点时，调试器会用 int3 指令替换您的代码，该指令是[软件中断](https://en.wikipedia.org/wiki/INT_(x86_instruction))。作为结果，程序被挂起并调用调试器。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-03-01T23:44:22.563

另一个了解调试的宝贵资源是 Intel CPU 手册（Intel® 64 and IA-32 Architectures Software Developer's Manual）。在第 3A 卷第 16 章中，介绍了调试的硬件支持，例如特殊异常和硬件调试寄存器。以下内容来自该章节：

T (trap) flag, TSS — 当尝试切换到 TSS 中设置了 T 标志的任务时，会生成调试异常 (#DB)。

我不确定 Window 或 Linux 是否使用这个标志，但阅读那一章非常有趣。

希望这可以帮助某人。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-19T19:42:48.950

我的理解是，当你编译一个应用程序或 DLL 文件时，无论它编译成什么都包含代表函数和变量的符号。

当您进行调试构建时，这些符号比发布构建时要详细得多，从而允许调试器为您提供更多信息。当您将调试器附加到进程时，它会查看当前正在访问哪些函数并从这里解析所有可用的调试符号（因为它知道编译文件的内部结构是什么样的，它可以确定内存中可能存在什么，具有整数、浮点数、字符串等的内容）。就像第一张海报所说的那样，这些信息以及这些符号的工作方式很大程度上取决于环境和语言。

# c# - 你可以用什么不同的方式来写这个

> ID：216822
> 
> 赞同：2
> 
> 时间：2008-10-19T19:22:55.887
> 
> 标签：c#, .net

.NET 3.5/C# 3.0 中有一些很酷且令人兴奋的特性，这些特性带来了一些非常有趣的方式来编写完全相同的代码行。

使用上述工具集（以及扩展 .NET 2.0 的东西），可以合理地重写以下代码片段的不同方式是什么？

```
 string uploadDirectory = "c:\\some\\path\\";
        if (Directory.Exists(uploadDirectory)) {
            string[] files = Directory.GetFiles(uploadDirectory);
            foreach (string filename in files) {
                if (File.GetLastWriteTime(filename).AddHours(12) < DateTime.Now) {
                    File.Delete(filename);
                }
            }
        } 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-19T19:26:40.107

拉姆达：

```
if (Directory.Exists(uploadDirectory)) 
  Directory.GetFiles(uploadDirectory)
    .Where(f => File.GetLastWriteTime(file) < DateTime.Now.AddHours(-12))
    .Each(f => File.Delete(f)); 
```

编辑：第二个想法，您可以通过使用 DirectoryInfo 和 FileInfo 而不是静态 File 方法来避免每个文件访问的安全查找：

```
var di = new DirectoryInfo(uploadDirectory);
if (di.Exists()) {
   di.GetFiles()
     .Where(f => f.LastWriteTime < DateTime.Now.AddHours(-12))
     .Each(f=> f.Delete());
} 
```

对于那些缺少自己的每个方法的人：

```
void Each<T>(this IEnumerable e, Action<T> action) {
  foreach (T t in e) {
    action(t);
  }
} 
```

为了让这变得非常疯狂，并适合 C# 3.0 主题，让我们引入一个匿名类型：

```
di.GetFiles().Select(f => new() {
   Delete = f.LastWriteTime < DateTime.Now.AddHours(-12) ? f.Delete : () => { }
}).Delete(); 
```

但这没有任何意义。;)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-19T19:31:47.583

好吧，第一位非常巧妙地映射到 LINQ 查询……但是（故意）在常规 LINQ 中没有 ForEach。不过，我们可以惹恼埃里克并添加一个；-p

所以以下使用 LINQ 和自定义扩展方法 - 但我们可以重写*完全相同的*代码（即相同的 IL）：

*   查询语法（如下）
*   流利的语法 (.Where().Select() ec)
*   显式静态（Enumerable.Where(...)）
*   lambdas vs 匿名方法 vs 命名方法（最后更改 IL）
*   带/不带缩写 (C# 2.0) 委托“新”语法的委托
*   带/不带泛型类型推断的泛型调用（Where() 与 Where<T>()）
*   调用 File.Delete 与调用 x=>File.Delete(x) 等

ETC

```
static void Main()
{
    string uploadDirectory = "c:\\some\\path\\";
    if (Directory.Exists(uploadDirectory))
    {
        var files = from filename in Directory.GetFiles(uploadDirectory)
                  where File.GetLastWriteTime(filename) < DateTime.Now.AddHours(-12)
                  select filename;
        files.ForEach(File.Delete);            
    }
}
static void ForEach<T>(this IEnumerable<T> items, Action<T> action)
{
    foreach (T item in items)
    {
        action(item);
    }
} 
```

我们可以`DateTime`使用 custom 来编写代码`Expression`，但这太过分了……

但是，我怀疑我们是否会用尽编写它的方法；-p

# c++ - 如何修剪 std::string？

> ID：216823
> 
> 赞同：935
> 
> 时间：2008-10-19T19:23:07.320
> 
> 标签：c++, trim, stdstring

我目前正在使用以下代码对`std::strings`我的程序中的所有内容进行右修剪：

```
std::string s;
s.erase(s.find_last_not_of(" \n\r\t")+1); 
```

它工作正常，但我想知道是否有一些最终情况可能会失败？

当然，欢迎使用优雅的替代方案和左修剪解决方案的答案。

* * *

## 回答 #1

> 赞同：769
> 
> 时间：2008-10-20T05:46:38.777

**编辑**自 c++17 以来，标准库的某些部分已被删除。幸运的是，从 c++11 开始，我们有了 lambdas，这是一个更好的解决方案。

```
#include <algorithm> 
#include <cctype>
#include <locale>

// trim from start (in place)
static inline void ltrim(std::string &s) {
    s.erase(s.begin(), std::find_if(s.begin(), s.end(), [](unsigned char ch) {
        return !std::isspace(ch);
    }));
}

// trim from end (in place)
static inline void rtrim(std::string &s) {
    s.erase(std::find_if(s.rbegin(), s.rend(), [](unsigned char ch) {
        return !std::isspace(ch);
    }).base(), s.end());
}

// trim from both ends (in place)
static inline void trim(std::string &s) {
    ltrim(s);
    rtrim(s);
}

// trim from start (copying)
static inline std::string ltrim_copy(std::string s) {
    ltrim(s);
    return s;
}

// trim from end (copying)
static inline std::string rtrim_copy(std::string s) {
    rtrim(s);
    return s;
}

// trim from both ends (copying)
static inline std::string trim_copy(std::string s) {
    trim(s);
    return s;
} 
```

感谢[https://stackoverflow.com/a/44973498/524503](https://stackoverflow.com/a/44973498/524503)提出现代解决方案。

## 原答案：

我倾向于使用这三种中的一种来满足我的修剪需求：

```
#include <algorithm> 
#include <functional> 
#include <cctype>
#include <locale>

// trim from start
static inline std::string &ltrim(std::string &s) {
    s.erase(s.begin(), std::find_if(s.begin(), s.end(),
            std::not1(std::ptr_fun<int, int>(std::isspace))));
    return s;
}

// trim from end
static inline std::string &rtrim(std::string &s) {
    s.erase(std::find_if(s.rbegin(), s.rend(),
            std::not1(std::ptr_fun<int, int>(std::isspace))).base(), s.end());
    return s;
}

// trim from both ends
static inline std::string &trim(std::string &s) {
    return ltrim(rtrim(s));
} 
```

它们是不言自明的并且工作得很好。

**编辑**：顺便说一句，我`std::ptr_fun`在那里帮助消除歧义`std::isspace`，因为实际上有第二个定义支持语言环境。这可能是一个相同的演员，但我更喜欢这个。

**编辑**：解决一些关于通过引用接受参数、修改和返回参数的评论。我同意。我可能更喜欢的实现是两组函数，一组用于就地，另一组用于制作副本。一组更好的例子是：

```
#include <algorithm> 
#include <functional> 
#include <cctype>
#include <locale>

// trim from start (in place)
static inline void ltrim(std::string &s) {
    s.erase(s.begin(), std::find_if(s.begin(), s.end(),
            std::not1(std::ptr_fun<int, int>(std::isspace))));
}

// trim from end (in place)
static inline void rtrim(std::string &s) {
    s.erase(std::find_if(s.rbegin(), s.rend(),
            std::not1(std::ptr_fun<int, int>(std::isspace))).base(), s.end());
}

// trim from both ends (in place)
static inline void trim(std::string &s) {
    ltrim(s);
    rtrim(s);
}

// trim from start (copying)
static inline std::string ltrim_copy(std::string s) {
    ltrim(s);
    return s;
}

// trim from end (copying)
static inline std::string rtrim_copy(std::string s) {
    rtrim(s);
    return s;
}

// trim from both ends (copying)
static inline std::string trim_copy(std::string s) {
    trim(s);
    return s;
} 
```

我保留了上面的原始答案，但为了上下文和保持高票答案仍然可用。

* * *

## 回答 #2

> 赞同：447
> 
> 时间：2008-10-19T19:55:06.820

使用[Boost 的字符串算法](http://www.boost.org/doc/libs/1_58_0/doc/html/string_algo/usage.html#idp424359600)是最简单的：

```
#include <boost/algorithm/string.hpp>

std::string str("hello world! ");
boost::trim_right(str); 
```

`str`现在是`"hello world!"`。还有`trim_left`和`trim`，它修剪两边。

* * *

如果将`_copy`后缀添加到上述任何函数名称，例如`trim_copy`，该函数将返回字符串的修剪副本，而不是通过引用修改它。

如果您`_if`为上述任何函数名称添加后缀，例如`trim_copy_if`，您可以修剪所有满足您的自定义谓词的字符，而不仅仅是空格。

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2014-08-19T14:16:58.527

您正在做的事情很好而且很强大。我已经使用相同的方法很长时间了，但我还没有找到更快的方法：

```
const char* ws = " \t\n\r\f\v";

// trim from end of string (right)
inline std::string& rtrim(std::string& s, const char* t = ws)
{
    s.erase(s.find_last_not_of(t) + 1);
    return s;
}

// trim from beginning of string (left)
inline std::string& ltrim(std::string& s, const char* t = ws)
{
    s.erase(0, s.find_first_not_of(t));
    return s;
}

// trim from both ends of string (right then left)
inline std::string& trim(std::string& s, const char* t = ws)
{
    return ltrim(rtrim(s, t), t);
} 
```

通过提供要修剪的字符，您可以灵活地修剪非空白字符，并且可以高效地仅修剪您想要修剪的字符。

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2008-12-07T19:45:40.250

使用以下代码从`std::strings`( [ideone](http://ideone.com/FcTBRe) ) 中右修剪（尾随）空格和制表符：

```
// trim trailing spaces
size_t endpos = str.find_last_not_of(" \t");
size_t startpos = str.find_first_not_of(" \t");
if( std::string::npos != endpos )
{
    str = str.substr( 0, endpos+1 );
    str = str.substr( startpos );
}
else {
    str.erase(std::remove(std::begin(str), std::end(str), ' '), std::end(str));
} 
```

为了平衡，我也将包含左侧修剪代码（[ideone](http://ideone.com/TdxhZm)）：

```
// trim leading spaces
size_t startpos = str.find_first_not_of(" \t");
if( string::npos != startpos )
{
    str = str.substr( startpos );
} 
```

* * *

## 回答 #5

> 赞同：60
> 
> 时间：2013-07-31T17:03:12.047

派对迟到了，但没关系。现在 C++11 来了，我们有 lambdas 和 auto 变量。所以我的版本，它也处理全空格和空字符串，是：

```
#include <cctype>
#include <string>
#include <algorithm>

inline std::string trim(const std::string &s)
{
   auto wsfront=std::find_if_not(s.begin(),s.end(),[](int c){return std::isspace(c);});
   auto wsback=std::find_if_not(s.rbegin(),s.rend(),[](int c){return std::isspace(c);}).base();
   return (wsback<=wsfront ? std::string() : std::string(wsfront,wsback));
} 
```

我们可以从中创建一个反向迭代器`wsfront`并将其用作第二个中的终止条件，`find_if_not`但这仅在全空白字符串的情况下才有用，而且 gcc 4.8 至少不够聪明，无法推断反向迭代器的类型（`std::string::const_reverse_iterator`) 与`auto`. 我不知道构建反向迭代器有多昂贵，所以这里是 YMMV。通过这种更改，代码如下所示：

```
inline std::string trim(const std::string &s)
{
   auto  wsfront=std::find_if_not(s.begin(),s.end(),[](int c){return std::isspace(c);});
   return std::string(wsfront,std::find_if_not(s.rbegin(),std::string::const_reverse_iterator(wsfront),[](int c){return std::isspace(c);}).base());
} 
```

* * *

## 回答 #6

> 赞同：58
> 
> 时间：2011-06-28T00:47:53.440

试试这个，它对我有用。

```
inline std::string trim(std::string& str)
{
    str.erase(str.find_last_not_of(' ')+1);         //suffixing spaces
    str.erase(0, str.find_first_not_of(' '));       //prefixing spaces
    return str;
} 
```

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2010-07-05T06:37:20.050

我喜欢 tzaman 的解决方案，唯一的问题是它不会修剪仅包含空格的字符串。

要纠正这 1 个缺陷，请在 2 条修剪线之间添加一个 str.clear()

```
std::stringstream trimmer;
trimmer << str;
str.clear();
trimmer >> str; 
```

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2014-02-11T10:15:06.107

[http://ideone.com/nFVtEo](http://ideone.com/nFVtEo)

```
std::string trim(const std::string &s)
{
    std::string::const_iterator it = s.begin();
    while (it != s.end() && isspace(*it))
        it++;

    std::string::const_reverse_iterator rit = s.rbegin();
    while (rit.base() != it && isspace(*rit))
        rit++;

    return std::string(it, rit.base());
} 
```

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2019-01-25T11:13:02.680

使用 C++17，您可以使用[basic_string_view::remove_prefix](https://en.cppreference.com/w/cpp/string/basic_string_view/remove_prefix)和[basic_string_view::remove_suffix](https://en.cppreference.com/w/cpp/string/basic_string_view/remove_suffix)：

```
std::string_view trim(std::string_view s)
{
    s.remove_prefix(std::min(s.find_first_not_of(" \t\r\v\n"), s.size()));
    s.remove_suffix(std::min(s.size() - s.find_last_not_of(" \t\r\v\n") - 1, s.size()));

    return s;
} 
```

一个不错的选择：

```
std::string_view ltrim(std::string_view s)
{
    s.remove_prefix(std::distance(s.cbegin(), std::find_if(s.cbegin(), s.cend(),
         [](int c) {return !std::isspace(c);})));

    return s;
}

std::string_view rtrim(std::string_view s)
{
    s.remove_suffix(std::distance(s.crbegin(), std::find_if(s.crbegin(), s.crend(),
        [](int c) {return !std::isspace(c);})));

    return s;
}

std::string_view trim(std::string_view s)
{
    return ltrim(rtrim(s));
} 
```

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2008-10-19T19:26:43.850

在空字符串的情况下，您的代码假定将 1 添加到`string::npos`0.`string::npos`的类型为`string::size_type`，它是无符号的。因此，您依赖于加法的溢出行为。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2008-10-19T20:47:47.057

[从Cplusplus.com](http://www.cplusplus.com/reference/string/string/find_last_not_of.html)被黑

```
std::string choppa(const std::string &t, const std::string &ws)
{
    std::string str = t;
    size_t found;
    found = str.find_last_not_of(ws);
    if (found != std::string::npos)
        str.erase(found+1);
    else
        str.clear();            // str is all whitespace

    return str;
} 
```

这也适用于 null 情况。:-)

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2015-10-13T10:02:16.440

```
s.erase(0, s.find_first_not_of(" \n\r\t"));                                                                                               
s.erase(s.find_last_not_of(" \n\r\t")+1); 
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2013-05-24T21:11:22.080

我的解决方案基于[@Bill the Lizard 的回答](https://stackoverflow.com/a/347974/1497596)。

请注意，如果输入字符串只包含空格，则这些函数将返回空字符串。

```
const std::string StringUtils::WHITESPACE = " \n\r\t";

std::string StringUtils::Trim(const std::string& s)
{
    return TrimRight(TrimLeft(s));
}

std::string StringUtils::TrimLeft(const std::string& s)
{
    size_t startpos = s.find_first_not_of(StringUtils::WHITESPACE);
    return (startpos == std::string::npos) ? "" : s.substr(startpos);
}

std::string StringUtils::TrimRight(const std::string& s)
{
    size_t endpos = s.find_last_not_of(StringUtils::WHITESPACE);
    return (endpos == std::string::npos) ? "" : s.substr(0, endpos+1);
} 
```

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2015-03-21T17:14:29.993

[我的答案是对这篇文章的最佳答案](https://stackoverflow.com/a/217605/1114073)的改进，它修剪了控制字符和空格（ [ASCII 表](http://www.asciitable.com/)上的 0-32 和 127 ）。

[`std::isgraph`](http://en.cppreference.com/w/cpp/string/byte/isgraph)确定一个字符是否具有图形表示，因此您可以使用它来更改 Evan 的答案，以从字符串的任一侧删除任何没有图形表示的字符。结果是一个更优雅的解决方案：

```
#include <algorithm>
#include <functional>
#include <string>

/**
 * @brief Left Trim
 *
 * Trims whitespace from the left end of the provided std::string
 *
 * @param[out] s The std::string to trim
 *
 * @return The modified std::string&
 */
std::string& ltrim(std::string& s) {
  s.erase(s.begin(), std::find_if(s.begin(), s.end(),
    std::ptr_fun<int, int>(std::isgraph)));
  return s;
}

/**
 * @brief Right Trim
 *
 * Trims whitespace from the right end of the provided std::string
 *
 * @param[out] s The std::string to trim
 *
 * @return The modified std::string&
 */
std::string& rtrim(std::string& s) {
  s.erase(std::find_if(s.rbegin(), s.rend(),
    std::ptr_fun<int, int>(std::isgraph)).base(), s.end());
  return s;
}

/**
 * @brief Trim
 *
 * Trims whitespace from both ends of the provided std::string
 *
 * @param[out] s The std::string to trim
 *
 * @return The modified std::string&
 */
std::string& trim(std::string& s) {
  return ltrim(rtrim(s));
} 
```

**注意：**[`std::iswgraph`](http://en.cppreference.com/w/cpp/string/wide/iswgraph)或者，如果您需要支持宽字符， 您应该能够使用，但您还必须编辑此代码以启用`std::wstring`操作，这是我尚未测试的内容（请参阅参考页面[`std::basic_string`](http://en.cppreference.com/w/cpp/string/basic_string)以探索此选项） .

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2013-08-27T12:11:45.753

C++11 还提供了一个[正则表达式](http://en.cppreference.com/w/cpp/regex)模块，它当然可以用来修剪前导或尾随空格。

也许是这样的：

```
std::string ltrim(const std::string& s)
{
    static const std::regex lws{"^[[:space:]]*", std::regex_constants::extended};
    return std::regex_replace(s, lws, "");
}

std::string rtrim(const std::string& s)
{
    static const std::regex tws{"[[:space:]]*$", std::regex_constants::extended};
    return std::regex_replace(s, tws, "");
}

std::string trim(const std::string& s)
{
    return ltrim(rtrim(s));
} 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2013-11-12T22:56:44.480

这就是我使用的。只需继续从前面删除空间，然后，如果有任何剩余，从后面做同样的事情。

```
void trim(string& s) {
    while(s.compare(0,1," ")==0)
        s.erase(s.begin()); // remove leading whitespaces
    while(s.size()>0 && s.compare(s.size()-1,1," ")==0)
        s.erase(s.end()-1); // remove trailing whitespaces
} 
```

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2015-08-18T11:21:39.923

一种优雅的方式可以像

```
std::string & trim(std::string & str)
{
   return ltrim(rtrim(str));
} 
```

支持功能实现为：

```
std::string & ltrim(std::string & str)
{
  auto it =  std::find_if( str.begin() , str.end() , [](char ch){ return !std::isspace<char>(ch , std::locale::classic() ) ; } );
  str.erase( str.begin() , it);
  return str;   
}

std::string & rtrim(std::string & str)
{
  auto it =  std::find_if( str.rbegin() , str.rend() , [](char ch){ return !std::isspace<char>(ch , std::locale::classic() ) ; } );
  str.erase( it.base() , str.end() );
  return str;   
} 
```

一旦你完成了所有这些，你也可以这样写：

```
std::string trim_copy(std::string const & str)
{
   auto s = str;
   return ltrim(rtrim(s));
} 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2015-01-05T21:21:00.750

对于它的价值，这是一个着眼于性能的修剪实现。它比我见过的许多其他修剪程序要快得多。它不使用迭代器和 std::finds，而是使用原始 c 字符串和索引。它优化了以下特殊情况：大小为 0 的字符串（什么都不做），没有空格的字符串（什么都不做），只有尾随空格的字符串（只是调整字符串的大小），完全是空格的字符串（只是清除字符串） . 最后，在最坏的情况下（带有前导空格的字符串），它会尽最大努力执行有效的副本构造，只执行 1 个副本，然后将那个副本移动到原始字符串的位置。

```
void TrimString(std::string & str)
{ 
    if(str.empty())
        return;

    const auto pStr = str.c_str();

    size_t front = 0;
    while(front < str.length() && std::isspace(int(pStr[front]))) {++front;}

    size_t back = str.length();
    while(back > front && std::isspace(int(pStr[back-1]))) {--back;}

    if(0 == front)
    {
        if(back < str.length())
        {
            str.resize(back - front);
        }
    }
    else if(back <= front)
    {
        str.clear();
    }
    else
    {
        str = std::move(std::string(str.begin()+front, str.begin()+back));
    }
} 
```

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2019-11-08T19:59:33.370

这是使用正则表达式进行修剪的解决方案

```
#include <string>
#include <regex>

string trim(string str){
    return regex_replace(str, regex("(^[ ]+)|([ ]+$)"),"");
} 
```

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2013-11-16T20:10:05.067

我想如果您开始要求修剪字符串的“最佳方法”，我会说一个好的实现将是：

1.  不分配临时字符串
2.  具有就地修剪和复制修剪的重载
3.  可以轻松定制以接受不同的验证序列/逻辑

显然有太多不同的方法可以解决这个问题，这绝对取决于您实际需要什么。但是，C 标准库在 <string.h> 中仍然有一些非常有用的函数，例如 memchr。C 仍然被认为是 IO 的最佳语言是有原因的——它的标准库是纯粹的效率。

```
inline const char* trim_start(const char* str)
{
    while (memchr(" \t\n\r", *str, 4))  ++str;
    return str;
}
inline const char* trim_end(const char* end)
{
    while (memchr(" \t\n\r", end[-1], 4)) --end;
    return end;
}
inline std::string trim(const char* buffer, int len) // trim a buffer (input?)
{
    return std::string(trim_start(buffer), trim_end(buffer + len));
}
inline void trim_inplace(std::string& str)
{
    str.assign(trim_start(str.c_str()),
        trim_end(str.c_str() + str.length()));
}

int main()
{
    char str [] = "\t \nhello\r \t \n";

    string trimmed = trim(str, strlen(str));
    cout << "'" << trimmed << "'" << endl;

    system("pause");
    return 0;
} 
```

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2015-10-14T15:51:25.107

修剪 C++11 实现：

```
static void trim(std::string &s) {
     s.erase(s.begin(), std::find_if_not(s.begin(), s.end(), [](char c){ return std::isspace(c); }));
     s.erase(std::find_if_not(s.rbegin(), s.rend(), [](char c){ return std::isspace(c); }).base(), s.end());
} 
```

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2020-12-22T06:46:35.750

```
str.erase(0, str.find_first_not_of("\t\n\v\f\r ")); // left trim
str.erase(str.find_last_not_of("\t\n\v\f\r ") + 1); // right trim 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2014-05-06T03:24:12.020

为噪音贡献我的解决方案。`trim`默认创建一个新字符串并在`trim_in_place`修改传递给它的字符串时返回修改后的字符串。该`trim`函数支持 c++11 移动语义。

```
#include <string>

// modifies input string, returns input

std::string& trim_left_in_place(std::string& str) {
    size_t i = 0;
    while(i < str.size() && isspace(str[i])) { ++i; };
    return str.erase(0, i);
}

std::string& trim_right_in_place(std::string& str) {
    size_t i = str.size();
    while(i > 0 && isspace(str[i - 1])) { --i; };
    return str.erase(i, str.size());
}

std::string& trim_in_place(std::string& str) {
    return trim_left_in_place(trim_right_in_place(str));
}

// returns newly created strings

std::string trim_right(std::string str) {
    return trim_right_in_place(str);
}

std::string trim_left(std::string str) {
    return trim_left_in_place(str);
}

std::string trim(std::string str) {
    return trim_left_in_place(trim_right_in_place(str));
}

#include <cassert>

int main() {

    std::string s1(" \t\r\n  ");
    std::string s2("  \r\nc");
    std::string s3("c \t");
    std::string s4("  \rc ");

    assert(trim(s1) == "");
    assert(trim(s2) == "c");
    assert(trim(s3) == "c");
    assert(trim(s4) == "c");

    assert(s1 == " \t\r\n  ");
    assert(s2 == "  \r\nc");
    assert(s3 == "c \t");
    assert(s4 == "  \rc ");

    assert(trim_in_place(s1) == "");
    assert(trim_in_place(s2) == "c");
    assert(trim_in_place(s3) == "c");
    assert(trim_in_place(s4) == "c");

    assert(s1 == "");
    assert(s2 == "c");
    assert(s3 == "c");
    assert(s4 == "c");  
} 
```

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2016-01-31T18:54:26.550

[`back()`](http://en.cppreference.com/w/cpp/string/basic_string/back)由于添加了和 ，这可以在 C++11 中更简单地完成[`pop_back()`](http://en.cppreference.com/w/cpp/string/basic_string/pop_back)。

```
while ( !s.empty() && isspace(s.back()) ) s.pop_back(); 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2008-10-19T20:03:35.197

我不确定您的环境是否相同，但在我的环境中，空字符串大小写会导致程序中止。我要么用 if(!s.empty()) 包装那个擦除调用，要么使用前面提到的 Boost。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2010-05-27T07:29:40.497

这是我想出的：

```
std::stringstream trimmer;
trimmer << str;
trimmer >> str; 
```

流提取会自动消除空格，所以这很有效。
如果我自己这么说的话，也很干净优雅。;)

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2016-08-31T14:41:21.593

这是我的版本：

```
size_t beg = s.find_first_not_of(" \r\n");
return (beg == string::npos) ? "" : in.substr(beg, s.find_last_not_of(" \r\n") - beg); 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2016-12-08T12:14:19.880

`std::`对于不习惯到处写，还不熟悉`const`-correctness、`iterator`s、STL等的初学者来说，这是一个易于理解的解决方案`algorithm`……

```
#include <string>
#include <cctype> // for isspace
using namespace std;

// Left trim the given string ("  hello!  " --> "hello!  ")
string left_trim(string str) {
    int numStartSpaces = 0;
    for (int i = 0; i < str.length(); i++) {
        if (!isspace(str[i])) break;
        numStartSpaces++;
    }
    return str.substr(numStartSpaces);
}

// Right trim the given string ("  hello!  " --> "  hello!")
string right_trim(string str) {
    int numEndSpaces = 0;
    for (int i = str.length() - 1; i >= 0; i--) {
        if (!isspace(str[i])) break;
        numEndSpaces++;
    }
    return str.substr(0, str.length() - numEndSpaces);
}

// Left and right trim the given string ("  hello!  " --> "hello!")
string trim(string str) {
    return right_trim(left_trim(str));
} 
```

希望能帮助到你...

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2009-11-24T19:26:07.967

上述方法很棒，但有时您希望将函数组合用于您的例程认为是空白的部分。在这种情况下，使用函子来组合操作可能会变得混乱，所以我更喜欢一个简单的循环，我可以为修剪进行修改。这是一个稍微修改过的修剪函数，它是从 SO 上的 C 版本复制而来的。在此示例中，我正在修剪非字母数字字符。

```
string trim(char const *str)
{
  // Trim leading non-letters
  while(!isalnum(*str)) str++;

  // Trim trailing non-letters
  end = str + strlen(str) - 1;
  while(end > str && !isalnum(*end)) end--;

  return string(str, end+1);
} 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2013-10-03T19:32:58.033

那这个呢...？

```
#include <iostream>
#include <string>
#include <regex>

std::string ltrim( std::string str ) {
    return std::regex_replace( str, std::regex("^\\s+"), std::string("") );
}

std::string rtrim( std::string str ) {
    return std::regex_replace( str, std::regex("\\s+$"), std::string("") );
}

std::string trim( std::string str ) {
    return ltrim( rtrim( str ) );
}

int main() {

    std::string str = "   \t  this is a test string  \n   ";
    std::cout << "-" << trim( str ) << "-\n";
    return 0;

} 
```

注意：我对 C++ 还是比较陌生，所以如果我在这里偏离基地，请原谅我。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2016-03-23T04:40:48.870

这是一个直接的实现。对于这样一个简单的操作，您可能不应该使用任何特殊的构造。内置的 isspace() 函数处理各种形式的白色字符，所以我们应该利用它。您还必须考虑字符串为空或只是一堆空格的特殊情况。向左或向右修剪可以从以下代码派生。

```
string trimSpace(const string &str) {
   if (str.empty()) return str;
   string::size_type i,j;
   i=0;
   while (i<str.size() && isspace(str[i])) ++i;
   if (i == str.size())
      return string(); // empty string
   j = str.size() - 1;
   //while (j>0 && isspace(str[j])) --j; // the j>0 check is not needed
   while (isspace(str[j])) --j
   return str.substr(i, j-i+1);
} 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2010-08-24T17:57:50.290

此版本修剪内部空格和非字母数字：

```
static inline std::string &trimAll(std::string &s)
{   
    if(s.size() == 0)
    {
        return s;
    }

    int val = 0;
    for (int cur = 0; cur < s.size(); cur++)
    {
        if(s[cur] != ' ' && std::isalnum(s[cur]))
        {
            s[val] = s[cur];
            val++;
        }
    }
    s.resize(val);
    return s;
} 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2013-03-27T00:19:48.493

还有另一种选择 - 从两端删除一个或多个字符。

```
string strip(const string& s, const string& chars=" ") {
    size_t begin = 0;
    size_t end = s.size()-1;
    for(; begin < s.size(); begin++)
        if(chars.find_first_of(s[begin]) == string::npos)
            break;
    for(; end > begin; end--)
        if(chars.find_first_of(s[end]) == string::npos)
            break;
    return s.substr(begin, end-begin+1);
} 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2016-03-15T00:11:17.990

由于我想使用 C++ 11 方法更新我的旧 C++ 修剪函数，因此我测试了很多已发布的问题答案。我的结论是我保留了旧的 C++ 解决方案！

它是最快的一个，即使添加更多字符进行检查（例如 \r\n 我看不到 \f\v 的用例）仍然比使用算法的解决方案更快。

```
std::string & trimMe (std::string & str)
{
   // right trim
   while (str.length () > 0 && (str [str.length ()-1] == ' ' || str [str.length ()-1] == '\t'))
      str.erase (str.length ()-1, 1);

   // left trim
   while (str.length () > 0 && (str [0] == ' ' || str [0] == '\t'))
      str.erase (0, 1);
   return str;
} 
```

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2019-09-07T04:27:18.273

好的，这可能不是最快的，但它......很简单。

```
str = "   aaa    ";
int len = str.length();
// rtrim
while(str[len-1] == ' ') { str.erase(--len,1); }
// ltrim
while(str[0] == ' ') { str.erase(0,1); } 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2013-11-28T09:57:33.880

```
std::string trim( std::string && str )
{
    size_t end = str.find_last_not_of( " \n\r\t" );
    if ( end != std::string::npos )
        str.resize( end + 1 );

    size_t start = str.find_first_not_of( " \n\r\t" );
    if ( start != std::string::npos )
        str = str.substr( start );

    return std::move( str );
} 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2014-04-02T15:54:50.353

这有什么好处？（因为这篇文章完全需要另一个答案：）

```
string trimBegin(string str)
{
    string whites = "\t\r\n ";
    int i = 0;
    while (whites.find(str[i++]) != whites::npos);
    str.erase(0, i);
    return str;
} 
```

trimEnd 的情况类似，只是反转极化器，索引。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2016-02-10T16:37:38.233

c++11：

```
int i{};
string s = " h e ll \t\n  o";
string trim = " \n\t";

while ((i = s.find_first_of(trim)) != -1)
    s.erase(i,1);

cout << s; 
```

输出：

```
hello 
```

也适用于空字符串

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2020-02-15T22:35:31.100

接受的答案甚至`Boost`'s 版本对我不起作用，所以我写了以下版本：

```
std::string trim(const std::string& input) {
    std::stringstream string_stream;
    for (const auto character : input) {
        if (!isspace(character)) {
            string_stream << character;
        }
    }

    return string_stream.str();
} 
```

这将从字符串中的任何位置删除任何空白字符并返回字符串的新副本。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2015-10-11T02:39:40.657

我正在使用这个：

```
void trim(string &str){
    int i=0;

    //left trim
    while (isspace(str[i])!=0)
        i++;
    str = str.substr(i,str.length()-i);

    //right trim
    i=str.length()-1;
    while (isspace(str[i])!=0)
        i--;
    str = str.substr(0,i+1);
} 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2020-08-19T22:11:28.813

修剪两端。

```
string trim(const std::string &str){
    string result = "";
    size_t endIndex = str.size();
    while (endIndex > 0 && isblank(str[endIndex-1]))
        endIndex -= 1;
    for (size_t i=0; i<endIndex ; i+=1){
        char ch = str[i];
        if (!isblank(ch) || result.size()>0)
            result += ch;
    }
   return result;
} 
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2018-07-10T22:31:11.690

我知道这是一个非常古老的问题，但我已经在你的代码中添加了几行代码，它会从两端修剪空白。

```
void trim(std::string &line){

    auto val = line.find_last_not_of(" \n\r\t") + 1;

    if(val == line.size() || val == std::string::npos){
        val = line.find_first_not_of(" \n\r\t");
        line = line.substr(val);
    }
    else
        line.erase(val);
} 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2021-01-15T03:53:17.240

穷人的字符串修剪（仅限空格）：

```
std::string trimSpaces(const std::string& str)
{
    int start, len;

    for (start = 0; start < str.size() && str[start] == ' '; start++);
    for (len = str.size() - start; len > 0 && str[start + len - 1] == ' '; len--);

    return str.substr(start, len);
} 
```

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2020-07-15T17:06:51.203

我已经阅读了大部分答案，但没有发现有人使用 istringstream

```
std::string text = "Let me split this into words";

std::istringstream iss(text);
std::vector<std::string> results((std::istream_iterator<std::string>(iss)),
                                 std::istream_iterator<std::string>()); 
```

结果是单词向量，它也可以处理具有内部空格的字符串，希望这会有所帮助。

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2020-08-05T17:46:04.377

为什么不使用 lambda？

```
auto no_space = [](char ch) -> bool {
  return !std::isspace<char>(ch, std::locale::classic());
};
auto ltrim = [](std::string& s) -> std::string& {
  s.erase(s.begin(), std::find_if(s.begin(), s.end(), no_space));
  return s;
};
auto rtrim = [](std::string& s) -> std::string& {
  s.erase(std::find_if(s.rbegin(), s.rend(), no_space).base(), s.end());
  return s;
};
auto trim_copy = [](std::string s) -> std::string& { return ltrim(rtrim(s)); };
auto trim = [](std::string& s) -> std::string& { return ltrim(rtrim(s)); }; 
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2018-09-26T19:31:33.327

以下是一次通过（可能是两次通过）的解决方案。它遍历字符串的空白部分两次，一次遍历非空白部分。

```
void trim(std::string& s) {                                                                                                                                                                                                               
    if (s.empty())                                                                                                                                                                                                                        
        return;                                                                                                                                                                                                                           

    int l = 0, r = s.size()  - 1;                                                                                                                                                                                                         

    while (l < s.size() && std::isspace(s[l++])); // l points to first non-whitespace char.                                                                                                                                               
    while (r >= 0 && std::isspace(s[r--])); // r points to last non-whitespace char.                                                                                                                                                      

    if (l > r)                                                                                                                                                                                                                            
        s = "";                                                                                                                                                                                                                           
    else {                                                                                                                                                                                                                                
        l--;                                                                                                                                                                                                                              
        r++;                                                                                                                                                                                                                              
        int wi = 0;                                                                                                                                                                                                                       
        while (l <= r)                                                                                                                                                                                                                    
            s[wi++] = s[l++];                                                                                                                                                                                                             
        s.erase(wi);                                                                                                                                                                                                                      
    }                                                                                                                                                                                                                                     
    return;                                                                                                                                                                                                                               
} 
```

* * *

## 回答 #47

> 赞同：-1
> 
> 时间：2015-12-06T01:29:40.140

看来我真的迟到了——我不敢相信这是 7 年前问的！

这是我对这个问题的看法。我正在做一个项目，我现在不想经历使用 Boost 的麻烦。

```
std::string trim(std::string str) {
    if(str.length() == 0) return str;

    int beg = 0, end = str.length() - 1;
    while (str[beg] == ' ') {
        beg++;
    }

    while (str[end] == ' ') {
        end--;
    }

    return str.substr(beg, end - beg + 1);
} 
```

此解决方案将从左侧和右侧修剪。

* * *

## 回答 #48

> 赞同：-9
> 
> 时间：2018-07-04T15:47:32.307

太烦人了，我

*   必须谷歌它
*   发现我必须使用火箭科学
*   字符串中没有简单的 trim/toupper 函数

对**我来说**，这是解决它的最快方法：

```
CString tmp(line.c_str());
tmp = tmp.Trim().MakeLower();
string buffer = tmp; 
```

好的，我可以使用 lambda 操作、迭代器和所有东西，这很酷。但我只需要处理一个字符串而不是一个字符......

# performance - 如何在给定算法速度和计算机速度的情况下找到运行时间？

> ID：216825
> 
> 赞同：4
> 
> 时间：2008-10-19T19:23:25.417
> 
> 标签：performance, complexity-theory

我目前正在完成一项处理 Big-O 和运行时间的任务。我向我提出了一个似乎很容易的问题，但我不确定我是否做得正确。其余的问题都相当困难，我觉得我在这里忽略了一些东西。

首先，你有这些东西：算法 A，它的运行时间为 50n^3。计算机 A，每次操作的速度为 1 毫秒。计算机 B，每次操作的速度为 2 毫秒。大小为 300 的实例。

我想知道算法 A 在计算机 A 上解决这个实例需要多长时间，以及在计算机 B 上需要多长时间。

我想要做的是低于 300 的 n，所以你有 50*(300^2) = 4500000。

然后，将第一台计算机乘以 1，第二台计算机乘以 2。

不过，这对我来说很奇怪，因为它说“运行时间”是 50n^3，而不是“操作次数是 50n^3”，所以我觉得我在乘以时间，并且会最终以毫秒平方为单位，这似乎根本不对。

我想知道我是否正确，如果不是，这个问题的实际含义是什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T19:33:35.490

如果您有 O(n^3) 但您在示例中没有使用大 O 表示法，那将没有意义。即如果你有 O(n^3) 你会知道你的算法的复杂性，但你不会知道你所说的确切的操作数量。

相反，它看起来好像为您提供了所执行的操作的确切数量。（即使知道它没有明确说明）。所以用 n 代替是有意义的。

大 O 表示法描述了输入的大小将如何影响您的运行时间或内存使用情况。但是对于 Big O，即使考虑到每个操作的速度，您也无法推断出准确的运行时间。

解释为什么您的答案看起来如此简单（如上所述）也是一种安全的方法。但我敢肯定，即使没有它，你也会得到这个问题的分数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T19:33:35.957

好吧，除了弄清楚在大多数现代计算机上以这种方式需要多长时间是毫无意义的，尽管它可能在嵌入式系统中具有*一定*的意义，但在我看来，你这样做的方式确实是正确的。

如果算法需要 50n^3 次操作来完成某事，其中 n 是要处理的元素数，那么用 300 代替 n 将为您提供要执行的操作数，而不是时间单位。

因此，乘以每次操作的时间，您将获得所需的时间。

在我看来是对的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T19:44:08.730

您的 50*n^3 数据称为“运行时间”，但这是因为用于速度评估的模型假设一台机器具有几个基本操作，其中每个操作都需要 1 个时间单位。

在您的情况下，运行算法需要 50*500^3 时间单位。在计算机 A 上每个时间单位是 1ms，在计算机 B 上是 2ms。

希望这能给单位带来一些意义，
Asaf。

# asp.net - 我可以在 ASP.NET GridView 中将布尔值转换为是/否吗

> ID：216833
> 
> 赞同：69
> 
> 时间：2008-10-19T19:30:26.633
> 
> 标签：asp.net, gridview

我有一个`GridView`带有映射到布尔值的列的 ASP.NET。我想显示“是”/“否”而不是“真”/“假”。好吧，实际上我想要“Ja”/“Nej”（丹麦语）。

这可能吗？

```
<asp:gridview id="GridView1" runat="server" autogeneratecolumns="false">
    <columns>
        ...
        <asp:boundfield headertext="Active" datafield="Active" dataformatstring="{0:Yes/No}" />
        ...
    </columns>
</asp:gridview> 
```

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2008-11-24T19:30:56.337

我将此代码用于VB：

```
<asp:TemplateField HeaderText="Active" SortExpression="Active">
    <ItemTemplate><%#IIf(Boolean.Parse(Eval("Active").ToString()), "Yes", "No")%></ItemTemplate>
</asp:TemplateField> 
```

这应该适用于 C#（未经测试）：

```
<asp:TemplateField HeaderText="Active" SortExpression="Active">
    <ItemTemplate><%# (Boolean.Parse(Eval("Active").ToString())) ? "Yes" : "No" %></ItemTemplate>
</asp:TemplateField> 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-24T20:04:01.637

向您的页面类添加一个方法，如下所示：

```
public string YesNo(bool active) 
{
  return active ? "Yes" : "No";
} 
```

然后在`TemplateField`你`Bind`使用这个方法：

```
<%# YesNo(Active) %> 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-19T19:39:50.237

不 - 但您可以使用模板列：

```
<script runat="server">
  TResult Eval<T, TResult>(string field, Func<T, TResult> converter) {
     object o = DataBinder.Eval(Container.DataItem, field);
     if (converter == null) {
        return (TResult)o;
     }
     return converter((T)o);
  }
</script>

<asp:TemplateField>
  <ItemTemplate>
     <%# Eval<bool, string>("Active", b => b ? "Yes" : "No") %>
  </ItemTemplate>
</asp:TemplateField> 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-10T17:24:47.583

你可以使用 Mixin。

```
/// <summary>
/// Adds "mixins" to the Boolean class.
/// </summary>
public static class BooleanMixins
{
    /// <summary>
    /// Converts the value of this instance to its equivalent string representation (either "Yes" or "No").
    /// </summary>
    /// <param name="boolean"></param>
    /// <returns>string</returns>
    public static string ToYesNoString(this Boolean boolean)
    {
        return boolean ? "Yes" : "No";
    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-19T19:41:34.693

或者你可以`ItemDataBound`在后面的代码中使用事件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-12-08T20:36:08.630

除了我的客户的 db 模式是一个可为空的位（即，允许 True/False/NULL）之外，我的需求与原始海报相同。这是我编写的一些代码，用于显示是/否并处理潜在的空值。

**代码隐藏：**

```
public string ConvertNullableBoolToYesNo(object pBool)
{
    if (pBool != null)
    {
        return (bool)pBool ? "Yes" : "No";
    }
    else
    {
        return "No";
    }
} 
```

**前端：**

```
<%# ConvertNullableBoolToYesNo(Eval("YOUR_FIELD"))%> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-05-14T20:38:26.397

这就是我一直这样做的方式：

```
<ItemTemplate>
  <%# Boolean.Parse(Eval("Active").ToString()) ? "Yes" : "No" %>
</ItemTemplate> 
```

希望有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-20T14:20:17.503

这有效：

```
Protected Sub grid_RowDataBound(sender As Object, e As System.Web.UI.WebControls.GridViewRowEventArgs) Handles grid.RowDataBound
    If e.Row.RowType = DataControlRowType.DataRow Then
        If e.Row.Cells(3).Text = "True" Then
            e.Row.Cells(3).Text = "Si"
        Else
            e.Row.Cells(3).Text = "No"
        End If
    End If
End Sub 
```

`cells(3)`具有布尔字段的列的列在哪里。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-12-12T07:38:02.473

使用 Format()-Function 很容易

```
Format(aBoolean, "YES/NO") 
```

请在此处查找详细信息： [https ://msdn.microsoft.com/en-us/library/aa241719(v=vs.60).aspx](https://msdn.microsoft.com/en-us/library/aa241719(v=vs.60).aspx)

# svn - 小型数据库开发团队的源代码控制系统

> ID：216834
> 
> 赞同：6
> 
> 时间：2008-10-19T19:30:27.227
> 
> 标签：svn, git, version-control, sourcegear-vault

我负责一个小型开发团队，我们主要处理数据库开发。我们目前使用 MS Visual Source Safe 作为我们的源代码控制系统，但它有其局限性，我们正在认真考虑改变。你会选择什么系统？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-19T19:35:44.953

对于一个小团队，SVN 是最好的，以我的经验（我过去使用过 CVS、SVN 和 VSS）。

它功能强大，拥有庞大的用户群，以及 Web 界面等良好的工具。

有些人可能会推荐 git，但我认为这对于你的描述来说太过分了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-19T19:48:39.717

我们的团队使用[Sourcegear](http://www.sourcegear.com/)的[Vault](http://www.sourcegear.com/vault/index.html)，它很像 CVS 或 VSS，只是没有一些皱纹。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-19T19:54:42.280

几个月前，我们的团队 (.NET) 切换到了[Subversion](http://subversion.tigris.org) / [TortoiseSVN](http://tortoisesvn.tigris.org/)、[VisualSVN](http://visualsvn.com)（用于 VisualStudio 集成）和[Trac](http://trac.edgewall.org)。我不能足够推荐这些工具。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-24T19:10:46.597

考虑使用 SVN，从个人经验来看，我会远离 ClearCase。

在我的公司，我们最近开始使用源代码控制来跟踪架构和存储过程中的数据库更改。让我们在 SVN 下跟踪变化，这极大地帮助了我们。遗憾的是，之前 4 年的工作已经丢失，因为在此之前，关于数据库的任何内容都没有受到任何形式的修订控制。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-24T19:02:35.740

我会远离集中式的，分布式版本控制系统提供了更多的灵活性，同时仍然允许集中式的工作方式。

对于更多的技术人员来说，git 可能会更好，毕竟它是由 Linux 内核人员开发的。

Bazaar 或 mercurial 可能更适合那些寻求易用性的人。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-19T19:34:07.237

颠覆，寻找[Visual SVN](http://www.visualsvn.com)，它免费且真正易于使用。

您还可以查看[使用 Subversion (SVN) 的 SQL Server 数据库版本控制](http://www.codeproject.com/KB/database/ScriptDB4Svn.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-24T20:39:26.090

强制执行。

商业软件，它不像SVN那样免费，但它很棒。跨平台、易于使用、GUI、命令行等。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-05-13T11:37:06.137

特别是对于数据库开发，以防万一您使用 MS SQL，我建议您查看 Red Gate 的[SQL 源代码控制](http://www.red-gate.com/products/SQL_Source_Control/index.htm)产品，它可以在 SVN/TFS/VSS/Vault 上工作并有助于源代码控制数据库。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-10T12:23:42.387

不是免费的，但一个非常好的（！）系统是“PlasticSCM”：[http ://www.plasticscm.com/demos/plastic28/index.html](http://www.plasticscm.com/demos/plastic28/index.html)

与分支一起工作，这对于并行开发非常有用（“每个任务模式的分支”）。对于每项任务（票证、错误、问题等），您都创建一个子分支。Plastic 将更新磁盘上的“工作区”，因此所有文件都有正确的版本。您可以根据需要进行尽可能多的更改和签入，因为您在自己的分支中工作，因此如果您签入无法编译的内容，其他人不会遇到麻烦！这很好用！

如果您切换到另一个分支（因为您必须快速修复错误），所有更改都“搁置”在服务器上，当前工作区会自动更新到另一个分支，您可以进行一些更改+签入，切换回您的分支正在处理中，并且所有文件都再次被搁置，因此您可以从以前的位置继续。非常非常棒。

它有一个非常酷的 GUI 客户端，也适用于 MacOS + Linux。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-05-13T11:30:28.067

我相信 SVN + SQL Examiner Suite 是[让您的数据库处于版本控制之下](http://www.sqlaccessories.com/Howto/Version_Control.aspx)的最佳解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-05-13T11:33:12.780

TFS 2010 - 您应该有权为 5 人使用它，否则会有各种便宜的公司优惠。

将其设置在具有虚拟化功能的体面计算机上 - 一个 vm TFS、一个 SQL、一个（可能）构建（仅）。

*   使用 SQL Server 进行源代码控制。

*   集成工作项跟踪

*   可以将持续集成与测试等集成。

*   可以为文档集成共享点。

在 2010 版本中易于设置；）

# c# - 单声道如何工作

> ID：216841
> 
> 赞同：48
> 
> 时间：2008-10-19T19:33:12.307
> 
> 标签：c#, mono

我在带有 .NET 的 Visual Studio 中使用过 C#，并且在 openSUSE Linux 上使用过 Mono，但我并不真正了解它是如何工作的。

如果我在 .NET 上的 Windows 中编写应用程序，这与 Mono 有何关系？我不能在没有 Wine 的情况下在 Linux 上执行一个 Windows .exe 文件，所以它不能帮助我执行在 Windows 中开发的应用程序。

纯粹是为了在 Linux（和其他）上拥有一个等效的 .NET 库来简化跨平台开发吗？例如，如果我是一家企业，想接触 Linux 客户，但真的想使用 .NET，那么 Mono 应该是我的选择吗？还是我还缺少什么？

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2011-03-04T01:09:56.380

这是一个老问题（已经选择了答案），但我不相信这个问题真的得到了很好的回答。

首先，一点背景...

**.NET 是如何工作的？**

传统的 Windows .EXE 文件是一个二进制文件，它表示您的计算机可以理解的一系列机器语言指令，并调用 Win32 API，这些 API 是 Windows 的一部分，提供应用程序可以利用的服务。使用的机器语言非常适合您的计算机类型，Win32 调用使可执行文件非常依赖于 Windows。.NET 可执行文件不是那样的。

重要的是要认识到 .NET 可执行文件（.EXE 文件）实际上不是本机 Windows 应用程序。Windows 本身不了解如何在 .NET 可执行文件中运行代码。你的电脑也不理解。

与 Java 非常相似，.NET 应用程序由一种称为 CIL（通用中间语言）的语言的指令组成，您可以将其视为实际不存在的理想计算机的机器语言。在 .NET 中，这种理想化机器的软件实现称为公共语言运行时 (CLR)。Java 世界中的等价物称为 Java 虚拟机 (JVM)。在 Java 中，CIL 的等价物称为 Java 字节码。CIL 有时称为 MSIL（微软中间语言）。

CIL 设计为在 CLR（理想化机器）上运行，但在其他方面与平台无关，这意味着 CIL 不关心您拥有什么样的计算机或运行什么操作系统。

正如您在要运行 Java 的每个平台上都需要 Java JVM 的本机版本一样，您也需要 CLR 的本机版本来运行 .NET CIL 可执行文件。CLR 是一个本地 Windows 应用程序，就像上面描述的传统 Win32 EXE 文件一样。CLR 本身特定于 Windows 实现和它被设计运行的计算机体系结构。

无论您从哪种 .NET 语言开始（C#、VisualBasic、F#、IronPython、IronRuby、Boo 等），它们都会被编译成 CIL 字节码。您可以轻松地将 CIL 程序“反汇编”成一种易于人类阅读的面向对象的汇编语言形式。您可以自己直接用 CIL 编写程序，但很少有人这样做。

在 Windows 上，CLR 会在您运行可执行文件时即时编译此 CIL 代码（JIT）——就在代码实际运行之前。这意味着 CIL 字节码被转换（编译）为在您的计算机上本地运行的实际机器代码。CLR 的这一部分称为 JIT 编译器，或者通常只是 JIT。

迄今为止，微软已经发布了四个版本的 CLR：1.0、1.1、2.0 和 4.0。如果要运行针对该运行时的 .NET 可执行文件，则需要在计算机上安装正确版本的 CLR。CLR 2.0 支持 .NET 2.0、3.0 和 3.5 应用程序。对于其他版本的 .NET，.NET 版本完全映射到 CLR 版本。

除了 JIT/CLR 之外，.NET 还提供了许多库（程序集），这些库（程序集）构成了 .NET 框架的其余部分，并提供了 .NET 应用程序可以调用的大量功能和服务。这些程序集中的绝大多数都是在 CLR 上运行的纯 CIL 代码。在 Windows 上，还有一些调用 Win32 API。安装 .NET 时，您正在安装 CLR、类库（框架）和一堆开发工具。每个版本的 CLR 通常都需要一整套这些“框架”程序集。.NET 的某些版本（例如 3.0 和 3.5）添加了额外的框架程序集，而不更新 CLR 或与该 CLR 关联的现有程序集。

交付 Windows .EXE 文件的可移植可执行 (PE) 文件格式包含一个标头，该标头描述可执行文件并将该文件标识为 .NET 文件或本机 Win32 文件。当 Windows 尝试运行 .NET 文件时，它会看到此标头并代表您自动调用 CLR。这就是 .NET EXE 文件似乎在 Windows 上本机运行的原因。

**好的，那么 Mono 是如何工作的呢？**

Mono 在 Linux、Mac 和其他平台上实现 CLR。Mono 运行时 (CLR) 是一个本机应用程序，主要用 C 语言编写，并编译为计算机系统的机器语言代码，供其运行。与 Windows 一样，Mono 运行时特定于操作系统和您使用的机器类型。

就像在 Windows 上一样，Mono 运行时 (CLR) 将您的 .NET 可执行文件中的 CIL 字节码即时编译为您的计算机可以理解和执行的本机代码。通过这种方式，.NET 文件对于 Linux 就像对于 Windows 一样“原生”。

要将 Mono 移植到新架构，您需要移植 JIT/CLR。这就像将任何本机应用程序移植到新平台一样。

.NET 代码在 Linux 或 Mac 上运行的好坏实际上只是 CLR 在这些系统上的实现好坏的问题。理论上，Mono CLR 可以在这些系统上执行 .NET 代码，比在 Windows 上执行的 .NET 的 MS 版本要好得多。在实践中，MS 实现通常更优越（尽管并非在所有情况下）。

除了 CLR，Mono 还提供了构成 .NET 框架的大部分其他库（程序集）。就像 Microsoft 版本的 .NET（实际上更是如此）一样，Mono 程序集作为 CIL 字节码提供。这使得从 Mono 获取 *.dll 或 *.exe 文件并在 Windows、Mac 或 Linux 上未经修改地运行它成为可能，因为 CIL 是这些系统上 CLR 实现的“本机”语言。

就像在 Windows 上一样，Mono 支持多个版本的 CLR 和相关的程序集：

Mono 的早期版本（1.2 之前？）仅支持 CLR 1.0 或 1.1。Mono 直到它自己的 2.0 版本才支持 2.0 框架的大部分内容。

直到 2.4 版的 Mono 版本同时支持 CLR 1.1 和 CLR 2.0 应用程序。

从 Mono 2.6 开始，添加了 CLR 4.0，但 CLR 2.0 仍然是默认设置。

从 Mono 2.8 开始，CLR 4.0 成为默认设置，不再支持 CLR 1.1。

Mono 2.10 继续默认使用 CLR 4.0，并且还支持 CLR 2.0。

就像真正的 .NET（但在少数情况下）一样，有一些 Mono 程序集会调用本机库。为了使 System.Drawing 程序集在 Mono 上工作，Mono 团队编写了一个 Linux 程序来模拟 Linux 上 Win32 API 的 GDI+ 部分。这个库被称为“libgdiplus”。如果您从源代码编译 Mono，您会注意到您需要先构建这个“libgdiplus”文件，然后才能构建“mono”。在 Windows 上不需要“libgdiplus”，因为 Win32 API 的 GDI+ 部分已经是 Windows 的一部分。将 Mono 完整移植到新平台还需要移植这个“libgdiplus”库。

在 .NET 库的设计过度受 Windows 设计影响且不适合 Mac 或 Linux 等系统的领域，Mono 团队编写了 .NET 框架的扩展。Mono 扩展也只是 CIL 字节码，通常在 .NET 上运行良好。

与 Windows 不同，Linux 通常不会检测 .NET 可执行文件并默认启动 CLR。用户通常必须通过键入“mono appname.exe”或类似内容直接运行 CLR。这里的“mono”是实现 CLR 的应用程序，“appname.exe”是包含要执行的 .NET 代码的 EXE 文件。

为了让用户更轻松，Mono 应用程序通常包装在一个启动 CLR 的 shell 脚本中。这隐藏了 CLR 就像在 Windows 中一样被使用的事实。当遇到使用 PE 文件格式的文件时，也可以告诉 Linux 启动 CLR。通常不这样做，因为 PE 文件格式也用于本机 Win32 Windows 可执行文件，当然 CLR (Mono) 不支持。

没有技术原因导致 Linux 无法使用 PE 启动器，然后它会根据需要启动理解本地 Windows 代码（如 Wine）或 CLR（Mono）的系统。据我所知，这根本就没有做到。

**来回**

任何坚持“完全托管”代码的 .NET 代码，这意味着它不会调用非 .NET 代码，应该可以在所有平台上的 Mono 上正常工作。我经常在 Linux 和 Mac 上使用从 Windows（我没有代码）编译的 .NET 程序集。

我还可以获取在 Mono 上编译的任何代码并在 Windows 上的 .NET 上运行。例如，我可以为客户提供一些我用 Mono 编译的代码，而不必担心他是在 32 位还是 64 位 Windows 上。当然，客户端确实需要安装正确版本的 .NET（正确的 CLR）。CLR 2.0 已经存在了很长时间，您可以打赌几乎所有 Windows 用户都安装了它。Mono 编译器和其他代码也只是 CIL 可执行文件，因此如果您愿意，它们可以在 Windows 上正常运行。

Mono 兼容性足够好，可以从 .NET 的实际 MS 版本中获取（在合法的情况下）大量实际 Microsoft 代码，如 ASP.NET MVC，并在 Mac 或 Linux 上运行。总的来说，Mono 团队在实现 CLR 和框架的其余部分（类库/程序集）方面做得很好。

**ASP.NET**

在 Windows 上，Internet 信息服务器 (IIS) 知道如何调用 CLR 以将 .NET 作为 Web 应用程序的一部分执行。在 Linux/Mac 上有一个 Apache 模块 (mod_mono)，它提供与 Apache 网络服务器类似的功能。此应用程序是用 C 语言编写的，并且还必须移植到新的体系结构中。

**移植单声道**

这个讨论已经确定了 Mono 的一部分，这些部分构建为“本机”可执行文件，并且必须存在于您要在其上运行 .NET 应用程序的系统上。

*   CLR（包括 JIT 编译器）——通常称为 Mono
*   libgdiplus（适用于本身不支持 GDI+ API 的系统 [只有 Windows 支持]）
*   mod_mono（允许 Apache 为 .NET Web 应用程序调用 CLR）

这三个组件，加上类库，提供了一个 .NET 环境，对于您需要运行的 .NET 可执行文件来说，它看起来是“本机”的。

这就是 Mono 的工作原理。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-19T19:36:45.437

一个 Windows EXE 包含多个“部分”。*简而言之*，.net 代码 (=MSIL) 只是 EXE 的一部分，并且在 EXE 中还有一个“真正的”本机 Windows 部件，用作 .net 框架的某种启动器，然后执行 MSIL。

Mono 将只获取 MSIL 并执行它，而忽略本机 Windows 启动器的内容。

同样，这是一个简化的概述。

*编辑：*我担心我对深层细节的理解不足以提供很多细节（我大致知道 PE Header 是什么，但不是真正的细节），但我发现这些链接很有帮助：

[NET 程序集结构——第二部分](http://xyberangel.blogspot.com/2004/11/net-assembly-structure-part-ii.html)

[.NET Foundations - .NET 程序集结构](http://blog.vuscode.com/malovicn/archive/2007/12/24/net-foundations-net-assembly-structure.aspx)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-19T19:33:56.487

实际上，您可以在 Linux 上使用 Mono 运行 .NET .exe 文件。这不需要 Wine。事实上，Mono 将程序编译为 .exe 文件，该文件可以在 Linux 上与 Mono 一起运行，也可以作为 Windows 上的可执行文件运行。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-19T19:41:16.223

Mono 是 Microsoft 的 .NET CLR（公共语言运行时）的开源实现。这是运行 .NET 程序的一部分，这些程序不是使用本机代码，而是使用 CIL（通用中间语言），一种语言和机器中立的中间语言。运行时获取该中间代码并将其转换为机器代码。

在 Mono 的当前状态下，您可以获取使用 .NET 主要部分 (mscorlib.dll) 的 .NET 程序，并在 Mono 运行的任何地方运行它们，而不仅仅是 Windows。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-19T19:49:25.300

但是正如上面提到的，Mono 是开源的，你不能仅仅相信它将是完整的 .NET 实现，它有一些不起作用的控件，你还必须小心你的应用程序将使用的 P/Invokes ，例如，您的应用程序将在 win32 下与 MCI（多媒体控制器接口）通信。但是我也在使用 mono 编写 GTK# 应用程序，但我也使用了我的 Windows 应用程序，这些应用程序无需任何重新编译就可以运行，正如我们上面的程序员同事提到的那样，也就是说，mono 是 Microsoft .NET 的开源替代品，默认情况下如果您正在构建 WinForms 或 Gtk# 应用程序，mono 将编译并为每个文件创建一个 .exe 程序集，当然，如果您愿意，它将创建一个动态链接库 (DLL)，几乎就像在 .NET 中所做的那样。只是为了建议尝试编写一些 Gtk#（使用 MonoDevelop IDE，它有它的内置 gui 设计器，称为 stetic）。当然，mono 可以很好地替代 Web 服务，您可以在 .NET 上创建它们，也可以在 Apache 上托管它们（因为现在 Linux 托管比 Windows 便宜）Web 服务和其他 asp.net 应用程序将在具有 mod_mono 模块的 apache，该模块必须包含在 apache 中。

有点跑题了，但我只是想从我的经验中告诉你一个先睹为快的情况。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-19T23:20:19.463

您也可以看看 MoMA（如果您的目标是将应用程序从 Win 移植到 Lin）。

> Mono Migration Analyzer (MoMA) 工具可帮助您识别在将 .Net 应用程序移植到 Mono 时可能遇到的问题。它有助于查明特定于平台的调用 (P/Invoke) 和 Mono 项目尚不支持的区域。

[现代艺术博物馆](http://www.mono-project.com/MoMA)

这是一个比较 Mono 和 .NET Framework 3.5 已经实现的 BCL 类型的 webapp

[http://mono.ximian.com/class-status/2.0-vs-3.5/index.html](http://mono.ximian.com/class-status/2.0-vs-3.5/index.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T21:06:24.070

为了进一步 Michael 的回应，我相信您必须在 Mono 上重新编译才能让应用程序在 Mono 运行时上运行。可能存在例外。我只玩过一点 Mono，而且我总是重新编译源代码。我从未尝试直接在 Mono 上运行 .NET 应用程序。

此外，Mono 1.9 应该完全兼容 .NET 2.0。Mono Olive 和 Moonlight 应该添加 .NET 3.0（少 WPF）和 Silverlight 功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-02-17T14:35:58.930

它可能会对您有所帮助，[Mono 的 C# 编译器是如何工作的？](http://www.codeproject.com/Articles/330184/How-does-it-work-in-Mono-s-C-compiler)以及[了解 Mono C# 编译器](https://rads.stackoverflow.com/amzn/click/com/1469929066)一书。

# snmp - 有哪些了解 SNMP MIB 的好资源？

> ID：216861
> 
> 赞同：5
> 
> 时间：2008-10-19T19:45:29.100
> 
> 标签：snmp, mib

我对 SNMP 了解一点，但还不够。我需要开发一个可以读取标准 SNMP MIB 并读取/写入各种属性的应用程序。网络端没有问题，但实际的 MIB 以及它们可能包含的确切内容对我来说是一种魔法。

我相信我应该能够使用 LIBSMI 来“解析”MIB，但我并不真正了解“解析器”的输出是什么，以及如何最好地使用它。

欢迎所有建议...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T23:07:09.567

冒着让你陷入困境的风险，你可能想看看[net-snmp](http://www.net-snmp.org/)。默认安装包含许多标准 mib 及其相关实现。它还包含一个实用程序 (mib2c)，可以从您的 mib 文件生成样板代码。

一旦您通过几个 mib 阅读了自己的方式，您应该可以毫不费力地熟悉 snmp 的工作方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T10:26:43.393

大多数标准 MIB 文档是在 IETF 发布的相应 RFC 中定义的。

[http://www.ietf.org/](http://www.ietf.org/)

请访问此站点以查找更多详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-12-10T19:39:12.413

Muonics [Mib Smithy 用户指南](http://www.muonics.com/Docs/MIBSmithy/UserGuide/)很好地概述了如何构建 MIB，它可以帮助您了解解析的必要元素。

您还应该查看[ASN.1 ITU 规范 X.690](https://www.itu.int/rec/T-REC-X.690-201508-I/en)，因为这是定义 SNMP 的语言。如果您在 SNMP RFC 中搜索 SNMP RFC 中的任何 Bachus-Naur 格式，它也会有所帮助。我将建议您从 RFC3642 和 RFC2252 开始。

# c - #undef-ing 在实践中？

> ID：216865
> 
> 赞同：17
> 
> 时间：2008-10-19T19:47:04.980
> 
> 标签：c, c-preprocessor

我想知道#undef 在 C 中的实际用途。我正在研究 K&R，并且正在处理预处理器。其中大部分是我（或多或少）理解的材料，但第 90 页（第二版）的内容让我印象深刻：

> 名称可以用 未定义`#undef`，通常是为了确保例程确实是函数，而不是宏：
> 
> `#undef getchar`
> 
> `int getchar(void) { ... }`

这是防止某人`#define`使用与您的函数同名的宏的常见做法吗？或者这真的更像是一个在现实中不会发生的样本？（EG，没有人在他的正确，错误或疯狂的头脑中应该重写`getchar()`，所以不应该出现。）有了你自己的函数名，你觉得有必要这样做吗？如果您正在开发一个供其他人使用的库，这种情况会改变吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-20T00:35:39.233

### 它能做什么

如果您阅读 Plauger 的[The Standard C Library](https://smile.amazon.com/dp/0131315099) (1992)，您将看到`<stdio.h>`头文件被允许提供`getchar()`并`getc()`作为类似函数的宏（具有`getc()`多次评估其文件指针参数的特殊权限！）。然而，即使它提供了宏，实现也必须提供执行相同工作的实际函数，主要是为了让您可以访问一个名为`getchar()`or的函数指针`getc()`并将其传递给其他函数。

也就是说，通过这样做：

```
#include <stdio.h>
#undef getchar

extern int some_function(int (*)(void));

int core_function(void)
{
   int c = some_function(getchar);
   return(c);
} 
```

正如所写，这`core_function()`是毫无意义的，但它说明了这一点。`isxxxx()`例如，您也可以对其中的宏执行相同的操作`<ctype.h>`。

通常，您不想这样做 - 您通常不想删除宏定义。但是，当您需要真正的功能时，您可以掌握它。提供库的人可以模拟标准C库的功能，效果很好。

### 很少需要

另请注意，您很少需要使用显式的原因之一`#undef`是您可以通过编写以下代码来调用函数而不是宏：

```
int c = (getchar)(); 
```

因为后面的记号`getchar`不是`(`，它不是类函数宏的调用，所以它一定是函数的引用。同样，上面的第一个示例即使没有`#undef`.

如果您使用宏覆盖实现自己的函数，则可以使用它来获得良好的效果，尽管除非解释，否则可能会有些混乱。

```
/* function.h */
…
extern int function(int c);
extern int other_function(int c, FILE *fp);
#define function(c) other_function(c, stdout);
… 
```

```
/* function.c */

…

/* Provide function despite macro override */
int (function)(int c)
{
    return function(c, stdout);
} 
```

函数定义行不调用宏，因为后面的记号`function`不是`(`。该`return`行确实调用了宏。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-19T20:27:26.503

宏通常用于生成大量代码。它通常是一种非常本地化的用法，并且`#undef`对于特定标头末尾的任何辅助宏都是安全的，以避免名称冲突，因此只有实际生成的代码会被导入其他地方，而用于生成代码的宏不会。

/编辑：作为一个例子，我用它来为我生成结构。以下是实际项目的节选：

```
#define MYLIB_MAKE_PC_PROVIDER(name) \
    struct PcApi##name { \
        many members …
    };

MYLIB_MAKE_PC_PROVIDER(SA)
MYLIB_MAKE_PC_PROVIDER(SSA)
MYLIB_MAKE_PC_PROVIDER(AF)

#undef MYLIB_MAKE_PC_PROVIDER 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-19T20:03:28.190

因为预处理器`#define`都在一个全局命名空间中，所以很容易导致命名空间冲突，尤其是在使用第三方库时。例如，如果您想创建一个名为 的函数`OpenFile`，它可能无法正确编译，因为头文件定义了要映射到或`<windows.h>`的标记（取决于是否定义了）。正确的解决方案是在定义你的函数之前。`OpenFile``OpenFileA``OpenFileW``UNICODE``#undef` `OpenFile`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-19T19:50:44.597

我只在文件中的宏`#included`干扰我的一个函数时使用它（例如，它具有相同的名称）。然后我`#undef`宏，所以我可以使用我自己的功能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T10:19:27.650

虽然我认为 Jonathan Leffler 给了你正确的答案。这是一个非常罕见的情况，我使用#undef。通常宏应该可以在许多函数中重用；这就是为什么您在文件顶部或头文件中定义它的原因。但有时你在函数中有一些重复的代码，可以用宏来缩短。

```
 int foo(int x, int y)
{
#define OUT_OF_RANGE(v, vlower, vupper) \
    if (v < vlower) {v = vlower; goto EXIT;} \
    else if (v > vupper) {v = vupper; goto EXIT;}

    /* do some calcs */
    x += (x + y)/2;
    OUT_OF_RANGE(x, 0, 100);
    y += (x - y)/2;
    OUT_OF_RANGE(y, -10, 50);

    /* do some more calcs and range checks*/
    ...

EXIT:
    /* undefine OUT_OF_RANGE, because we don't need it anymore */
#undef OUT_OF_RANGE
    ...
    return x;
} 
```

为了向读者展示这个宏只在函数内部有用，最后它是未定义的。我不想鼓励任何人使用这种骇人听闻的宏。但是，如果必须，请在最后 #undef 它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-19T20:00:41.050

> 这是防御某人#define-ing 与您的函数同名的宏的常见做法吗？或者这真的更像是一个在现实中不会发生的样本？（EG，没有人在他的正确、错误或疯狂的头脑中应该重写 getchar()，所以它不应该出现。）

两者都有一点。好的代码不需要使用`#undef`，但是有很多不好的代码你必须使用。`#undef`当有人使用像`#define bool int`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-19T20:25:11.157

除了修复宏污染全局命名空间的问题外，另一个用途`#undef`是宏可能需要在不同位置具有不同行为的情况。这不是一个真正常见的场景，但我想到的几个是：

*   `assert`如果您可能希望对代码的某些部分而不是其他部分执行调试，则宏可以在编译单元的中间更改其定义。除了`assert`自身需要被`#undef`'ed 来执行此操作外，还`NDEBUG`需要重新定义宏以重新配置所需的行为`assert`

*   我已经看到了一种用于通过使用宏将变量声明为 来确保只定义一次全局变量的技术`extern`，但是对于使用标头/声明来定义变量的单一情况，宏将被重新定义为空。

类似的东西（我并不是说这一定是一种好技术，只是我在野外见过的一种）：

```
/* globals.h */
/* ------------------------------------------------------ */
#undef GLOBAL
#ifdef DEFINE_GLOBALS
#define GLOBAL
#else
#define GLOBAL extern
#endif

GLOBAL int g_x;
GLOBAL char* g_name;
/* ------------------------------------------------------ */

/* globals.c */
/* ------------------------------------------------------ */
#include "some_master_header_that_happens_to_include_globals.h"

/* define the globals here (and only here) using globals.h */
#define DEFINE_GLOBALS
#include "globals.h"

/* ------------------------------------------------------ */ 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T00:49:09.270

### 如果一个宏可以被定义，那么必须有一个工具来取消定义。

我使用的内存跟踪器定义了自己的新/删除宏来跟踪文件/行信息。这个宏破坏了 SC++L。

```
#pragma push_macro( "new" )
#undef new
#include <vector>
#pragma pop_macro( "new" ) 
```

关于您更具体的问题：命名空间通常在 C 中通过在库函数前面加上标识符来模拟。

盲目地取消定义宏会增加混乱，降低可维护性，并可能破坏依赖原始行为的东西。如果你被迫，至少使用 push/pop 来保留其他地方的原始行为。

# regex - 从字符串中间修剪空格

> ID：216870
> 
> 赞同：11
> 
> 时间：2008-10-19T19:49:43.833
> 
> 标签：regex, parsing

我正在使用以下正则表达式来捕获始终为 50 个字符长的固定宽度“描述”字段：

```
(?.{50}) 
```

我的问题是描述有时包含*很多*空格，例如

```
"FLUID        COMPRESSOR                          " 
```

有人可以提供一个正则表达式：

1.  修剪最后的所有空白
2.  将单词之间的任何空格折叠为**单个空格**

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-19T19:57:18.030

用两个或多个空格代替一个空格：

```
s/  +/ /g 
```

编辑：对于任何空白（不仅仅是空格），如果您使用与 perl 兼容的正则表达式库，则可以使用 \s ，以及出现次数的花括号语法，例如

```
s/\s\s+/ /g 
```

或者

```
s/\s{2,}/ /g 
```

编辑#2：忘记 /g 全局后缀，谢谢 JL

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-20T02:51:12.033

```
str = Regex.Replace(str, " +( |$)", "$1"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T21:10:43.187

Perl 变体：1) s/\s+$//; 2) s/\s+/ /g;

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-07T09:16:41.007

C＃：

只有当你想修剪所有的空白时——在开始、结束和中间。

```
 string x = Regex.Replace(x, @"\s+", " ").Trim(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T19:51:40.257

您要求正则表达式是否有特殊原因？它们可能不是完成这项任务的最佳工具。

像这样的替代品

```
 s/[ \t]+/ /g 
```

应该压缩内部空格（实际上，它也会压缩前导和尾随空格，但听起来这不是问题。），并且

```
s/[ \t]+$/$/ 
```

将处理尾随空格。[我在`sed`这里使用 ish 语法。你没有说你喜欢什么口味。]

* * *

马上，我看不出有一种方法可以用一个表达式来做到这一点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-09T08:11:07.433

由于压缩空白和修剪边缘周围的空白在概念上是不同的操作，我喜欢分两步进行：

```
re.replace("s/\s+/ /g", str.strip()) 
```

不是最有效的，但可读性很强。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-12T23:07:19.243

/(^[\s\t]+|[\s\t]+([\s\t]|$))/g 替换为 $2 (开始|中间/结束)

# apache - 将 cgi 更改为 Fastcgi

> ID：216871
> 
> 赞同：1
> 
> 时间：2008-10-19T19:49:57.797
> 
> 标签：apache, cgi, fastcgi

将 C/C++ cgi 应用程序更改为 Fastcgi 有多可行？这是否只需要更改代码？还是需要更改 apache 服务器的设置？

改变的明显好处是什么？从 cgi 到 Fastcgi 的变化值得这些好处吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T19:58:58.463

切换到 FastCGI 的主要好处是您的应用程序将在后台连续运行，而不是为每个请求启动。如果您的应用程序有很多初始化，您可以通过减少这些时间来大幅提升速度。

这*将*需要重新配置 Apache，但并不复杂。它*应该*需要更改您的应用程序，因为现在每个服务器只有一个实例，而不是每个请求一个实例。您必须自己决定该更改是否可行；这实际上取决于您的代码的结构。

# c - ## 预处理器运算符的应用和要考虑的问题是什么？

> ID：216875
> 
> 赞同：90
> 
> 时间：2008-10-19T19:51:26.110
> 
> 标签：c, c-preprocessor, kernighan-and-ritchie, stringification

正如我之前的许多问题中提到的，我正在通过 K&R 工作，目前正在进入预处理器。更有趣的事情之一——我以前尝试学习 C 时从未知道的事情——是`##`预处理器操作符。根据 K&R：

> 预处理器运算符`##` 提供了一种在宏扩展期间连接实际参数的方法。如果替换文本中的参数与 a 相邻`##`，则将参数替换为实际参数， `##`并删除周围的空白，并重新扫描结果。例如，宏`paste` 连接它的两个参数：
> 
> `#define paste(front, back) front ## back`
> 
> 所以`paste(name, 1)`创建了令牌 `name1`。

有人如何以及为什么会在现实世界中使用它？有哪些实际使用示例，是否有需要考虑的问题？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-10-19T23:49:02.930

`##`使用标记粘贴 (' ') 或字符串化 (' ') 预处理运算符时要注意的一件事`#`是，您必须使用额外的间接级别才能使它们在所有情况下都能正常工作。

如果您不这样做并且传递给令牌粘贴运算符的项目本身就是宏，您将获得可能不是您想要的结果：

```
#include <stdio.h>

#define STRINGIFY2( x) #x
#define STRINGIFY(x) STRINGIFY2(x)
#define PASTE2( a, b) a##b
#define PASTE( a, b) PASTE2( a, b)

#define BAD_PASTE(x,y) x##y
#define BAD_STRINGIFY(x) #x

#define SOME_MACRO function_name

int main() 
{
    printf( "buggy results:\n");
    printf( "%s\n", STRINGIFY( BAD_PASTE( SOME_MACRO, __LINE__)));
    printf( "%s\n", BAD_STRINGIFY( BAD_PASTE( SOME_MACRO, __LINE__)));
    printf( "%s\n", BAD_STRINGIFY( PASTE( SOME_MACRO, __LINE__)));

    printf( "\n" "desired result:\n");
    printf( "%s\n", STRINGIFY( PASTE( SOME_MACRO, __LINE__)));
} 
```

输出：

```
buggy results:
SOME_MACRO__LINE__
BAD_PASTE( SOME_MACRO, __LINE__)
PASTE( SOME_MACRO, __LINE__)

desired result:
function_name21 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-10-19T19:58:51.897

**CrashRpt：使用## 将宏多字节字符串转换为 Unicode**

CrashRpt（崩溃报告库）中一个有趣的用法如下：

```
#define WIDEN2(x) L ## x
#define WIDEN(x) WIDEN2(x)
//Note you need a WIDEN2 so that __DATE__ will evaluate first. 
```

在这里，他们想使用一个两字节的字符串，而不是每字符一个字节的字符串。这可能看起来真的毫无意义，但他们这样做是有充分理由的。

```
 std::wstring BuildDate = std::wstring(WIDEN(__DATE__)) + L" " + WIDEN(__TIME__); 
```

他们将它与另一个宏一起使用，该宏返回带有日期和时间的字符串。

放在`L`a 旁边`__ DATE __`会给你一个编译错误。

* * *

**Windows：对通用 Unicode 或多字节字符串使用 ##**

Windows 使用如下内容：

```
#ifdef  _UNICODE
    #define _T(x)      L ## x
#else
    #define _T(x) x
#endif 
```

并且`_T`在代码中无处不在

* * *

**各种库，用于干净的访问器和修饰符名称：**

我还看到它在代码中用于定义访问器和修饰符：

```
#define MYLIB_ACCESSOR(name) (Get##name)
#define MYLIB_MODIFIER(name) (Set##name) 
```

同样，您可以将相同的方法用于任何其他类型的巧妙名称创建。

* * *

**各种库，使用它一次进行多个变量声明：**

```
#define CREATE_3_VARS(name) name##1, name##2, name##3
int CREATE_3_VARS(myInts);
myInts1 = 13;
myInts2 = 19;
myInts3 = 77; 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-19T21:08:52.130

这是我在升级到新版本的编译器时遇到的一个问题：

**不必要地使用标记粘贴运算符 ( `##`) 是不可移植的，并且可能会生成不需要的空格、警告或错误。**

当令牌粘贴运算符的结果不是有效的预处理器令牌时，令牌粘贴运算符是不必要的并且可能有害。

例如，可以尝试在编译时使用标记粘贴运算符构建字符串文字：

```
#define STRINGIFY(x) #x
#define PLUS(a, b) STRINGIFY(a##+##b)
#define NS(a, b) STRINGIFY(a##::##b)
printf("%s %s\n", PLUS(1,2), NS(std,vector)); 
```

在某些编译器上，这将输出预期结果：

```
1+2 std::vector 
```

在其他编译器上，这将包括不需要的空格：

```
1 + 2 std :: vector 
```

相当现代的 GCC 版本（>=3.3 左右）将无法编译此代码：

```
foo.cpp:16:1: pasting "1" and "+" does not give a valid preprocessing token
foo.cpp:16:1: pasting "+" and "2" does not give a valid preprocessing token
foo.cpp:16:1: pasting "std" and "::" does not give a valid preprocessing token
foo.cpp:16:1: pasting "::" and "vector" does not give a valid preprocessing token 
```

解决方案是在将预处理器标记连接到 C/C++ 运算符时省略标记粘贴运算符：

```
#define STRINGIFY(x) #x
#define PLUS(a, b) STRINGIFY(a+b)
#define NS(a, b) STRINGIFY(a::b)
printf("%s %s\n", PLUS(1,2), NS(std,vector)); 
```

关于连接的[GCC CPP 文档章节](http://gcc.gnu.org/onlinedocs/gcc-4.3.2/cpp/Concatenation.html)有更多关于标记粘贴操作符的有用信息。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-19T20:09:48.163

这在各种情况下都很有用，以免不必要地重复自己。以下是 Emacs 源代码中的示例。我们想从库中加载一些函数。函数“foo”应该分配给`fn_foo`，依此类推。我们定义如下宏：

```
#define LOAD_IMGLIB_FN(lib,func) {                                      \
    fn_##func = (void *) GetProcAddress (lib, #func);                   \
    if (!fn_##func) return 0;                                           \
  } 
```

然后我们可以使用它：

```
LOAD_IMGLIB_FN (library, XpmFreeAttributes);
LOAD_IMGLIB_FN (library, XpmCreateImageFromBuffer);
LOAD_IMGLIB_FN (library, XpmReadFileToImage);
LOAD_IMGLIB_FN (library, XImageFree); 
```

好处是不必同时写`fn_XpmFreeAttributes`和`"XpmFreeAttributes"`（并且有可能拼错其中一个）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-19T22:41:18.310

Stack Overflow 上的前一个问题要求一种平滑的方法来生成枚举常量的字符串表示，而无需大量容易出错的重新输入。

[关联](https://stackoverflow.com/questions/147267/easy-way-to-use-variables-of-enum-types-as-string-in-c#147582)

我对这个问题的回答表明，应用小的预处理器魔法如何让你像这样定义你的枚举（例如）......；

```
ENUM_BEGIN( Color )
  ENUM(RED),
  ENUM(GREEN),
  ENUM(BLUE)
ENUM_END( Color ) 
```

... 宏扩展不仅定义了枚举（在 .h 文件中），而且还定义了匹配的字符串数组（在 .c 文件中）；

```
const char *ColorStringTable[] =
{
  "RED",
  "GREEN",
  "BLUE"
}; 
```

字符串表的名称来自使用## 运算符将宏参数（即颜色）粘贴到StringTable。像这样的应用程序（技巧？）是 # 和 ## 运算符非常宝贵的地方。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-19T20:09:45.540

当您需要将宏参数与其他内容连接时，您可以使用令牌粘贴。

它可用于模板：

```
#define LINKED_LIST(A) struct list##_##A {\
A value; \
struct list##_##A *next; \
}; 
```

在这种情况下 LINKED_LIST(int) 会给你

```
struct list_int {
int value;
struct list_int *next;
}; 
```

同样，您可以编写一个用于列表遍历的函数模板。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-19T20:15:18.137

我在 C 程序中使用它来帮助正确地执行一组方法的原型，这些方法必须符合某种调用约定。在某种程度上，这可以用于直 C 中穷人的面向对象：

```
SCREEN_HANDLER( activeCall ) 
```

扩展到这样的东西：

```
STATUS activeCall_constructor( HANDLE *pInst )
STATUS activeCall_eventHandler( HANDLE *pInst, TOKEN *pEvent );
STATUS activeCall_destructor( HANDLE *pInst ); 
```

当您执行以下操作时，这会强制对所有“派生”对象进行正确的参数化：

```
SCREEN_HANDLER( activeCall )
SCREEN_HANDLER( ringingCall )
SCREEN_HANDLER( heldCall ) 
```

以上在您的头文件等中。如果您甚至碰巧想要更改定义和/或向“对象”添加方法，这对于维护也很有用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-19T20:16:43.467

[SGlib](http://sglib.sourceforge.net)使用## 基本上在C 中伪造模板。因为没有函数重载，所以## 用于将类型名称粘合到生成的函数的名称中。如果我有一个名为 list_t 的列表类型，那么我会得到名为 sglib_list_t_concat 的函数，依此类推。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-19T21:10:19.973

我将它用于嵌入式非标准 C 编译器上的家庭滚动断言：

```
 #define ASSERT(exp) if(!(exp)){ \
                      print_to_rs232("Assert failed: " ## #exp );\
                      while(1){} //Let the watchdog kill us 

```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-19T20:02:51.390

我用它来为宏定义的变量添加自定义前缀。所以像：

```
UNITTEST(test_name) 
```

扩展为：

```
void __testframework_test_name () 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-19T20:15:02.100

主要用途是当您有一个命名约定并且您希望您的宏利用该命名约定时。也许您有几个方法系列：image_create()、image_activate() 和 image_release()，还有 file_create()、file_activate()、file_release() 和 mobile_create()、mobile_activate() 和 mobile_release()。

您可以编写一个宏来处理对象生命周期：

```
#define LIFECYCLE(name, func) (struct name x = name##_create(); name##_activate(x); func(x); name##_release()) 
```

当然，一种“最小版本的对象”并不是唯一适用的命名约定——几乎绝大多数命名约定都使用公共子字符串来形成名称。它可以是函数名（如上）、字段名、变量名或其他任何东西。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-05-20T11:42:30.540

WinCE 中的一项重要用途：

```
#define BITFMASK(bit_position) (((1U << (bit_position ## _WIDTH)) - 1) << (bit_position ## _LEFTSHIFT)) 
```

在定义寄存器位描述时，我们执行以下操作：

```
#define ADDR_LEFTSHIFT                          0

#define ADDR_WIDTH                              7 
```

在使用 BITFMASK 时，只需使用：

```
BITFMASK(ADDR) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-19T20:31:23.923

这对于日志记录非常有用。你可以做：

```
#define LOG(msg) log_msg(__function__, ## msg) 
```

或者，如果您的编译器不支持**function**和**func**：

```
#define LOG(msg) log_msg(__file__, __line__, ## msg) 
```

上面的“函数”记录消息并准确显示哪个函数记录了一条消息。

我的 C++ 语法可能不太正确。

# .net - 强制 .NET webservice 使用本地对象类，而不是代理类

> ID：216884
> 
> 赞同：6
> 
> 时间：2008-10-19T19:55:31.077
> 
> 标签：.net, web-services, class, proxy-classes

我有一个从 Windows 窗体应用程序（都是 .NET，都在同一个解决方案中）调用的 Web 服务，并且我希望我的 Web 服务从项目的​​其他地方返回一个自定义对象 - 这是他们的常见对象两者都共享一个引用，因为它在我的解决方案的第三个项目中。当我调用 web 服务时，它返回一个“Person”对象，但它位于 web 服务的命名空间中，并且它是从 web 服务本身生成的代理类创建的。因此，我无法对其进行操作并将其返回到我的程序，该程序需要一个基于类的共享副本的“Person”对象，而不是来自 web 服务命名空间的代理副本，当我尝试时出现错误将其 CType 为正确的类类型。

如何强制 web 服务使用类的本地副本，而不是代理副本？我的问题在这种情况下有意义吗？如果不是，我会澄清它。

值得注意的是——我已经使用 ByRef 传递所有参数，并使用这些返回值来填充我在返回时创建的对象的副本。这不是最好的方法！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T20:26:49.953

如果您使用 svcutil.exe 生成 WCF 客户端代理，则可以在命令行上使用 /reference 来指定包含公共类的程序集。Svcutil 应该重用该类定义，而不是在服务代理命名空间中生成新的定义。

此外，这仅在您的公共类可序列化并按值传递时才有效（即，它作为数据合同公开，而不是作为服务合同公开）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T20:32:31.017

如果您使用的是 WCF，那么在客户端和消费者之间使用相同的数据协定和服务接口是否相当容易。您可以在生成的代理类中编译并修改它以使用正确的命名空间，或者使用[ChannelFactory](http://msdn.microsoft.com/en-us/library/ms734681.aspx)类为您创建一个动态代理。

第一种解决方案非常脆弱，每次服务接口更改时都会导致您修改代理类。第二种技术效果很好，我们在我之前从事的一个项目中使用过。使用这两种方法中的任何一种，您都需要确保所有调用者继续使用最新版本的接口。

从您描述问题的方式来看，您希望服务和客户端共享同一个实例。由于 WCF 在您向服务发送和从服务发送类型时对它们进行序列化和反序列化，因此您必须做一些更聪明的事情。这是你的意思吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T20:03:31.903

我不确定，但是当您编译 .NET Web 服务时，它会创建一个 DLL 文件，您可以尝试将其用于本地。但是当我构建面向服务的应用程序时，我会在我的解决方案中创建不同的层，例如数据访问层、逻辑层、服务层、UI 层、控制器层，例如在控制器层中，我将执行一种用户身份验证方法，即与数据访问层和逻辑层连接，然后我将在服务层上调用该方法，我也可以在 UI 层上调用它，如果我从 UI 层内调用它，当我想使用它时，它会在本地调用从服务层，我将使用该方法创建一个 Web 方法，该方法将返回一个布尔值或用户名等。

# java - 修复 XML 文件中的错误编码

> ID：216890
> 
> 赞同：4
> 
> 时间：2008-10-19T19:59:08.637
> 
> 标签：java, xml, parsing, encoding, xerces

我们的供应商之一有时会发送标记为 UTF-8 编码文档但包含未包含在 UTF-8 字符集中的字符的 XML 提要。这会导致解析器在遇到这些字符时抛出异常并停止构建 DOM 对象：

```
DocumentBuilder.parse(ByteArrayInputStream bais) 
```

抛出以下异常：

```
org.xml.sax.SAXParseException: Invalid byte 2 of 2-byte UTF-8 sequence. 
```

有没有办法尽早“捕获”这些问题并避免异常（即从流中查找和删除这些字符）？我正在寻找的是错误编码文档的“尽力而为”类型的后备。正确的解决方案显然是从源头上解决问题并确保只交付正确的文档，但是当不可能时，有什么好的方法呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-19T23:31:55.663

如果问题确实是错误的编码（而不是混合编码），您不需要重新编码文档来解析它。只需将其解析为 Reader 而不是 InputStream，dom 解析器将忽略标头：

```
DocumentBuilder.parse(new InpputSource(new InputStreamReader(inputStream, "<real encoding>"))); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T20:49:19.657

您应该手动查看无效文档，看看它们的常见问题是什么。很可能它们实际上是另一种编码（很可能是 windows-1252），然后最好的解决方案是从损坏的系统中获取每个文档并在解析之前将其重新编码为 UTF-8。

另一个可能的原因是混合编码（某些元素的内容在一种编码中，而其他元素的内容在另一种编码中）。那将更难解决。

您还需要一种方法来了解损坏的系统何时得到修复，以便您可以停止使用您的解决方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T01:23:04.207

您应该告诉他们向您发送正确的 UTF-8。如果任何解决方案都无法将坏字符重新编码为有效的 UTF-8，然后将其传递给解析器。这样做的原因是，如果保留了坏字符，那么不同的程序可能会以不同的方式解释任何输出，这可能会导致安全漏洞。

# java - 将 OutputStream 转换为字符串

> ID：216894
> 
> 赞同：633
> 
> 时间：2008-10-19T20:03:23.823
> 
> 标签：java, string, io, stream

将 java.io.OutputStream 的输出通过管道传输到 Java 中的 String 的最佳方法是什么？

说我有方法：

```
 writeToStream(Object o, OutputStream out) 
```

它将某些数据从对象写入给定的流。但是，我想尽可能轻松地将此输出转换为字符串。

我正在考虑编写这样的课程（未经测试）：

```
class StringOutputStream extends OutputStream {

  StringBuilder mBuf;

  public void write(int byte) throws IOException {
    mBuf.append((char) byte);
  }

  public String getString() {
    return mBuf.toString();
  }
} 
```

但是有更好的方法吗？我只想做个测试！

* * *

## 回答 #1

> 赞同：663
> 
> 时间：2008-10-19T20:15:38.930

我会用一个`ByteArrayOutputStream`. 完成后，您可以致电：

```
new String( baos.toByteArray(), codepage ); 
```

或更好：

```
baos.toString( codepage ); 
```

对于`String`构造函数，`codepage`可以是[java.nio.charset.Charset](http://docs.oracle.com/javase/7/docs/api/java/nio/charset/Charset.html)`String`的一个或一个实例。一个可能的值是[java.nio.charset.StandardCharsets.UTF_8](http://docs.oracle.com/javase/7/docs/api/java/nio/charset/StandardCharsets.html#UTF_8)。

该方法`toString()`仅接受 a`String`作为`codepage`参数（支持 Java 8）。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-10-19T20:23:26.997

我喜欢 Apache Commons IO 库。看看它的[ByteArrayOutputStream](https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/output/ByteArrayOutputStream.html)版本，它有一个`toString(String enc)`方法以及`toByteArray()`. 使用像 Commons 项目这样的现有和受信任的组件可以让你的代码更小，更容易扩展和重新利用。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-06-20T20:13:22.413

这很好用

```
OutputStream output = new OutputStream() {
    private StringBuilder string = new StringBuilder();

    @Override
    public void write(int b) throws IOException {
        this.string.append((char) b );
    }

    //Netbeans IDE automatically overrides this toString()
    public String toString() {
        return this.string.toString();
    }
}; 
```

方法调用 =>>`marshaller.marshal( (Object) toWrite , (OutputStream) output);`

然后打印字符串或获取它只是引用“输出”流本身作为示例，将字符串打印到控制台 =>>`System.out.println(output);`

仅供参考：我的方法调用`marshaller.marshal(Object,Outputstream)`用于使用 XML。与本主题无关。

这对于生产使用来说是非常浪费的，转换太多并且有点松散。这只是为了向您证明完全可以创建自定义 OuputStream 并输出字符串。但是只要走 Horcrux7 的方式，只需要两个方法调用就可以了。

世界生活在另一天......

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-03T21:04:55.117

这就是我最终做的事情：

```
Obj.writeToStream(toWrite, os);
try {
    String out = new String(os.toByteArray(), "UTF-8");
    assertTrue(out.contains("testString"));
} catch (UnsupportedEncondingException e) {
    fail("Caught exception: " + e.getMessage());
} 
```

哪里 os 是一个`ByteArrayOutputStream`.

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2020-05-19T05:48:13.223

```
baos.toString(StandardCharsets.UTF_8); 
```

> 通过使用命名字符集解码字节，将缓冲区的内容转换为字符串。

[Java 17 - https://docs.oracle.com/](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/ByteArrayOutputStream.html#toString())

# wpf - 渲染到屏幕外表面时可以使用像素着色器吗？

> ID：216899
> 
> 赞同：2
> 
> 时间：2008-10-19T20:04:42.197
> 
> 标签：wpf, direct3d, pixel-shader

我正在考虑通过新的 D3DImage 将我拥有的一些 D3D 代码与 WPF 集成，如下所述 [：](http://www.codeproject.com/KB/WPF/D3DImage.aspx)

我的问题是：像素着色器在屏幕外表面上工作吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T18:26:11.100

与直接渲染到后台缓冲区相比，渲染到屏幕外表面通常不受限制。将屏幕外表面与 D3DImage 一起使用的唯一限制是它必须是 32 位 RGB/ARGB 格式（取决于您的平台）。除此之外，硬件所提供的一切都由您随意支配。

事实上，大量着色器效果利用屏幕外表面进行多通道或全屏后期处理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-19T20:16:20.397

我不知道 WPF 是否有什么特别之处，但总的来说是的，像素着色器可以在屏幕外的表面上工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-06T13:40:07.037

对于某些效果，需要渲染到不同的表面——例如，在着色器渲染的场景前进行玻璃折射。像素着色器无法访问当前屏幕内容，因此必须首先将视图渲染到缓冲区，然后将其用作折射着色器通道中的纹理，以便它可以从正在计算的像素之外的像素获取背景颜色。

# .net - .Net 中有没有办法以编程方式从现有的 XML 文件生成 DTD？

> ID：216900
> 
> 赞同：3
> 
> 时间：2008-10-19T20:04:50.653
> 
> 标签：.net, xml, code-generation, dtd

我一直在寻找 System.Xml 命名空间，但没有看到任何支持这一点的东西。有谁知道它是否内置在.Net中，还是我必须获得第三方库才能做到这一点？

注意：我希望它像生成 xsd 一样简单，但这不适用于我的具体情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T09:05:02.730

这很容易做到，但很难使它有用。

DTD 是一种语法。生成只生成给定 XML 文件而不生成其他文件的语法是微不足道的。这在实践中当然是没有用的。你可能需要的是创建一个生成“像这个”文件的语法，这是一个很难的 AI 问题。

编辑：这个问题被称为“语法归纳”或“语法推理”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T20:15:48.213

我不确定 DTD，但您可以使用[Xsd.exe](http://msdn.microsoft.com/en-us/library/x6c1kb0s(VS.80).aspx)工具从 xml 文件生成 XSD 文件。它通常位于以下目录中：

C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\Bin\xsd.exe

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T20:59:56.250

嗯，xsd.exe 应该可以给你一个 xsd。对于 dtd 方面，[xmlpad3](http://www.wmhelp.com/xmlpad3.htm)声称能够做到这一点（并且是免费的）。我没试过，所以不能保证。

# excel - 带加权总计的 Excel 条件格式

> ID：216902
> 
> 赞同：2
> 
> 时间：2008-10-19T20:07:20.007
> 
> 标签：excel, formatting

我在 Excel 中的行中有一组值第一行包含每列中每个值对加权总数的贡献程度的权重。现在，我想通过更改其背景在接下来的每一行中标记对加权总数贡献最大的值。我玩过条件格式，但我的 Excel 技能至少可以这么说。那么，我该怎么做呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T06:46:36.787

假设权重在 A1:C1 中，值在 A2:C2 中，输入 =MAX($A$1:$C$1*$A2:$C2)/A$1 作为 A2 的“等于”条件

[替代文字 http://www.vulomedia.com/images/12339ExcelConditionalFormatting.jpg](http://www.vulomedia.com/images/12339ExcelConditionalFormatting.jpg)

换句话说，这个公式是（（值 x 权重）的最大值）/该列的权重。

有经验的 Excel 用户可能会注意到，如果在工作表单元格中输入此公式，则必须将其作为数组公式输入才能给出正确的值。这里的诀窍是，当以条件格式使用公式时，它们总是被视为数组公式。不需要 Ctrl-Shift-Enter。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T02:35:50.443

这就是我认为您正在尝试做的事情：您有一个数字列表（它们恰好是权重，但这并不重要）。您希望最大的数字以不同的方式突出显示。

假设单元格在 A1:A8 范围内。

1.  选择范围 A1:A8。
2.  选择条件格式（格式|条件格式）
3.  输入条件单元格值是/等于/=MAX(A1:A8)
4.  单击格式...按钮并设置图案以影响背景。

（在 Windows 上的 Excel 2003 上测试。）

# asp.net - asp.net web 方法和 wcf 服务有什么区别？

> ID：216931
> 
> 赞同：56
> 
> 时间：2008-10-19T20:34:37.520
> 
> 标签：asp.net, wcf, web-services, asmx

我是 .Net 的新手，不明白其中的区别。有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-19T20:45:36.607

ASP.NET Web 服务是为构建应用程序而开发的，这些应用程序使用基于 HTTP 的简单对象访问协议 (SOAP) 发送和接收消息。

WCF 用于使 .NET Framework 应用程序能够与其他软件实体交换消息。默认情况下使用 SOAP，但消息可以采用任何格式，并且可以使用任何传输协议进行传送。

您可以将 ASP.NET Web 服务视为 WCF 服务的子集。

[这](http://msdn.microsoft.com/en-us/library/aa738737.aspx)是比较两个框架的链接。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-19T21:15:02.570

很容易知道这些差异。

ASP.NET Web 方法被称为 ASMX [因为文件扩展名]（检查 4GuysFromRolla 关于这个，他们有一个[很好的教程](http://aspnet.4guysfromrolla.com/articles/100803-1.aspx)）

该技术使您可以将功能公开为 Web 服务，以便您可以从任何地方连接并使用它。但是......**你不能保护**服务器和客户端之间的数据，你可以清楚地发送大文件并知道发生了什么等等......

[注意] 你可以使用证书来保护对 Web 服务的访问，但这很复杂，但通常在 ASMX 中我们使用用户名/密码。

在 WCF 中，您处于关于 Web 服务的不同世界，这是 .NET 中公开服务的最佳技术（*您能看到区别吗...* **服务**！不是**Web 服务**），WCF 不需要 IIS 来运行，它可以在服务器上作为系统服务运行，使用控制台环境（如命令行）等，所以我们说 WCF 是服务而不是 Web 服务。记住 ASMX 需要 IIS 才能运行。

使用 WCF，您可以使用 SSL 加密通信（要在 ASMX 中执行此操作，您需要使用**WSE** - Web 服务增强功能），您可以安全地发送大文件（要在 ASMX 中执行此操作，您需要使用**MTOM** - 消息传输优化机制）。

您只需更改一行代码即可设置传输首选项，安全性要高得多，等等 :)

希望您对此有一个更好的总体概述，但还有更多。

底线：要公开不需要保护的Web服务，可以使用ASMX，完全没问题，但是如果您需要以某种方式保护通信，请在WCF中进行！

**链接**：[您可以在此处阅读这两种服务之间的一些性能比较](http://geekswithblogs.net/khanna/archive/2006/01/06/65067.aspx)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-19T20:38:49.150

它们是用于编写服务的两种不同框架。WCF 通常更灵活，并为使用的协议、托管服务的方式和各种安全选项提供可配置选项。ASMX 提供基于 SOAP 的服务。[通常 WCF 的性能](http://msdn.microsoft.com/en-us/library/bb310550.aspx)也更高。一般来说，ASMX 更易于使用，并且学习曲线通常较少。

[这](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/99433e4c-8bfb-4dab-b107-eda4f879b03b)是有关该主题的 MSDN 论坛讨论。[以下是ASMX](http://msdn.microsoft.com/en-us/library/aa289507(VS.71).aspx)和[WCF](http://msdn.microsoft.com/en-us/library/ms734712.aspx)的入门页面。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-19T21:18:50.690

除了上述响应之外，还创建了 WCF 以替换 .NET 3.0 及更高版本中的 .NET Remoting。除了 SOAP、REST、POX 等各种格式的 Web 服务（例如 XML 和 JSON），WCF 还提供 MSMQ 和命名管道。如上所述，ASMX 仅提供基于 SOAP 的 XML Web 服务。

对于其他类型的通信协议，您需要深入研究[.NET Remoting 。](http://msdn.microsoft.com/en-us/library/kwdt6w2k(VS.71).aspx)有关其他信息，您应该查看[Pro C# 2008 和 .NET 3.5 Framework](https://rads.stackoverflow.com/amzn/click/com/1590598849)。这是一个很好的资源，您可以从以前的书籍中获得有关 .NET Remoting 和其他替换功能的章节。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-07-18T05:41:55.100

这是一个新的、很大的区别：微软现在认为 ASMX Web 服务是“遗留”技术。请参阅“[使用 ASP.NET 和 XML Web 服务客户端创建的 XML Web 服务](http://msdn.microsoft.com/en-us/library/bb552872.aspx)”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-15T09:43:34.030

网页服务

1.  只能通过 HTTP 访问
2.  它在无状态环境中工作

WCF

WCF 很灵活，因为它的服务可以托管在不同类型的应用程序中。下面列出了托管 WCF 服务的几种常见方案：

*   IIS
*   曾是
*   自托管
*   托管 Windows 服务

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-19T20:45:53.877

它们是两种不同的东西。WCF 是一个更通用的框架，您可以通过它编写一个服务类型组件并以多种方式部署它（甚至作为 Asp.Net Web 服务）。

这是关于此[http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/2d6a7ff2-f15c-4599-a389-a81cfffcc852/的简短主题](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/2d6a7ff2-f15c-4599-a389-a81cfffcc852/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-04-12T08:47:07.367

下面列出了 Web 服务和 WCF 之间的主要区别。

**Web 服务**：Web 服务是一种旨在通过 Internet 与其他应用程序直接交互的应用程序。

1) [WebService] 和 [WebMethod] 属性定义了一个 Web 服务和方法。
2) 它只能通过 HTTP 访问。
3) 托管在 IIS 中。
4) 支持安全服务。
5) 不能是多线程的。
6) 只使用肥皂或 XML。
7) System.Xml.serialization 命名空间用于序列化

**WCF**：Windows Communication Foundation（代号Indigo）是一个用于构建、配置和部署网络分布式服务的编程平台和运行时系统。

1) [ServiceContract] 和 [OperationContract] 属性定义了一个 web 服务和方法。
2) 通过 HTTP、TCP、MSMQ、P2P、命名管道访问
3) 托管在 IIS、自托管、WAS 和 Windows 服务中。
4) 可以通过服务行为类实现多线程。
5) System.Runtime.Serialization 命名空间用于序列化
6) 支持不同类型的绑定，如 BasicHttpBinding、WSHttpBinding、WSDualHttpBinding 等。
7) 支持安全服务、可靠消息传递、事务、AJAX 和 REST 支持

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-21T01:26:36.447

我有同样的问题。

[我发现Microsoft Windows Communication Foundation Step by Step](https://rads.stackoverflow.com/amzn/click/com/0735623368)这本书非常好。

如果你*只是*想使用 WCF 做传统的 web 服务，那么该书的第 1 章将向你展示如何做到这一点（编写服务、测试、部署、使用服务）。

它是为 VS2005 编写的，但我使用的是 vs2008，发现它更容易。

WCF 还有很多其他内容，但这本书是一个好的开始。

# database - 关于 TUDBC 的思考

> ID：216952
> 
> 赞同：3
> 
> 时间：2008-10-19T20:49:38.673
> 
> 标签：database, database-connection

有人用过[TUDBC](http://www.tudbc.org/ "tdbc")吗？这看起来很有趣，但我想知道它对我的调查有多大价值。我很好奇任何人的经历是好是坏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T18:45:37.380

看起来像是寻找问题的解决方案。是的，听起来不错，但我不会使用带有 TUDBC 的 Java。我会坚持使用 JDBC 的“标准”。

# ruby-on-rails - 如何只显示属于某个用户的项目（使用 restful_authentication）？

> ID：216959
> 
> 赞同：4
> 
> 时间：2008-10-19T20:59:29.077
> 
> 标签：ruby-on-rails

我有一个包含用户及其文档的 Web 应用程序。每个用户可以有许多文档：

用户.rb：

```
has_many :documents 
```

文件.rb：

```
belongs_to :user 
```

文档控制器.rb：

```
def index
    @documents = Document.find(:all)
end 
```

我正在使用 restful_authentication 插件。这是我的问题：如何让控制器只显示属于每个用户的文档？现在它显示所有用户的所有文档。

我正在使用最新版本的 Rails。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-19T21:25:41.783

您在 User 类中设置了与 Document 类的关系。这将自动向您的 User 对象添加一个方法，该方法返回与特定用户相关的所有文档的列表：

```
def index
  @documents = @current_user.documents
end 
```

有关其他自动添加的方法，请参阅[文档](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#M001111)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-03-24T16:01:25.213

试试这个：

```
def index
    @documents = Document.where(:user_id => current_user.id)
end 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-20T07:08:43.417

```
def index
  @documents = Document.find(:all, :conditions => {:user_id => session[:user_id]})
end 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-19T21:33:06.903

在 Association Join Models 部分的 rails API 中查看[这里](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#M000530)。

但是请注意，Restful 身份验证不会控制访问，以便将用户限制在他们自己的记录中，特别是使用 RESTful 路由。登录后，他们仍然可以通过在 url 中输入值来查看其他用户的记录。

为此，您可能需要查看[Restful ACL](http://www.railslodge.com/plugins/966-restful-acl)

# php - 确定 PHP 脚本退出位置的最快方法

> ID：216963
> 
> 赞同：13
> 
> 时间：2008-10-19T21:00:51.460
> 
> 标签：php

假设您有一个大型 PHP 项目，突然，当您尝试运行它时，您会得到一个空白页面。脚本终止，您希望尽可能少地找到确切的位置。

是否有工具/程序/命令/IDE 可以在 PHP 脚本终止时告诉您脚本退出的位置？

注意：我无法将自己的帖子标记为“已接受的答案”，因此请查看底部以查看我的解决方案。如果您提出更好的解决方案，我会将您的帖子标记为答案。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-02-25T17:39:36.527

我使用以下代码，不需要特殊的调试环境。请注意，这可能需要很长时间；您可以将刻度数设置得更高 - 这使它更快，但模糊。

```
function shutdown_find_exit()
{
    var_dump($GLOBALS['dbg_stack']);
}
register_shutdown_function('shutdown_find_exit');
function write_dbg_stack()
{
    $GLOBALS['dbg_stack'] = debug_backtrace();
}
register_tick_function('write_dbg_stack');
declare(ticks=1); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-20T00:38:03.020

从 RoBorg 的非工作但仍然正确的答案中得到一些启发，我在开始时使用了以下代码：

```
function shutdown() {
    global $dbg_stack_a;
    print_r($dbg_stack_a);
}
register_shutdown_function('shutdown'); 
```

然后我做了一个全局条件断点（global = breakpoint 在每一行上评估），利用它可以通过 eval() 运行代码的事实，具有以下“条件”：

```
eval('
global $dbg_stack_a, $dbg_stack_b, $dbg_stack_c;
$dbg_stack_a = $dbg_stack_b;
$dbg_stack_b = $dbg_stack_c;
$dbg_stack_c = debug_backtrace();
return false;
') 
```

可能不快，但可以解决问题！使用它，我能够确定引发 die() 的确切文件和行位置。（此示例适用于 NuSphere。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T21:05:05.850

```
grep -n die filename 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T21:06:28.953

不要忘记用 grep 表示“退出”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T21:10:47.180

将此添加到文件顶部：

```
function shutdown()
{
    print_r(debug_backtrace());
}

register_shutdown_function('shutdown'); 
```

见[register_shutdown_function()](http://www.php.net/register_shutdown_function)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-19T21:37:08.797

您可以使用交互式调试器单步执行代码，直到到达退出点。除此之外，我认为你正在寻找`exit|die`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T22:12:14.623

xdebug 有一个很好的跟踪功能，可以让您查看 php 应用程序执行的所有完整跟踪，它应该为您提供退出位置的线索。

但是对于快速而肮脏的解决方案，如上所述的 grep/find 将是正确的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T00:57:11.593

还要检查 Apache error_log 中的 error___logs 是否有“ `memory_limit`”错误。

> 内存限制 >= 10M 警告：（在 php.ini 文件中将此设置为 10M 或更大）

以我的经验，当这种情况发生时，脚本会突然结束而没有任何警告或通知。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-20T01:04:51.763

确保错误显示在您的开发环境（而非生产环境）中。

# python - 如果 Python 对象是“可下标的”，这意味着什么？

> ID：216972
> 
> 赞同：520
> 
> 时间：2008-10-19T21:08:23.520
> 
> 标签：python, terminology

哪些类型的对象属于“可下标”的领域？

* * *

## 回答 #1

> 赞同：490
> 
> 时间：2008-10-19T21:11:05.607

它基本上意味着对象实现了`__getitem__()`方法。换句话说，它描述的是“容器”的对象，这意味着它们包含其他对象。这包括字符串、列表、元组和字典。

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2008-10-19T22:39:47.220

在我的脑海中，以下是唯一可下标的内置插件：

```
string:  "foobar"[3] == "b"
tuple:   (1,2,3,4)[3] == 4
list:    [1,2,3,4][3] == 4
dict:    {"a":1, "b":2, "c":3}["c"] == 3 
```

但是[mipadi 的回答](https://stackoverflow.com/a/216980/8554766)是正确的——任何实现的类`__getitem__`都是可下标的

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-19T22:05:30.393

可编写脚本的对象是记录对其执行的操作的对象，并且可以将它们存储为可以重放的“脚本”。

例如，请参阅：[应用程序脚本框架](https://svn.enthought.com/enthought/browser/AppTools/trunk/docs/source/appscripting/Introduction.rst)

现在，如果 Alistair 不知道他问了什么并且真正的意思是“可订阅”对象（由其他人编辑），那么（正如 mipadi 也回答）这是正确的：

可下标对象是实现`__getitem__`特殊方法的任何对象（想想列表、字典）。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2018-03-31T13:14:17.093

下标在计算中的含义是：“一个符号（名义上写成下标，但实际上通常不写）在程序中单独或与其他人一起使用，以指定数组的元素之一。”

现在，在[@user2194711](https://stackoverflow.com/a/40765305/9134528)给出的简单示例中，我们可以看到附加元素不能成为列表的一部分，原因有两个：-

1）我们并没有真正调用append方法；因为它需要`()`调用它。

2）错误是表示函数或方法不可下标；意味着它们不像列表或序列那样可索引。

现在看到这个：-

```
>>> var = "myString"
>>> def foo(): return 0
... 
>>> var[3]
't'
>>> foo[3]
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: 'function' object is not subscriptable 
```

这意味着没有下标或说元素，`function`就像它们按顺序出现一样；并且我们无法像我们一样访问它们，在`[]`.

还; 正如[米帕迪](https://stackoverflow.com/a/216980/9134528)在回答中所说的那样；它基本上意味着对象实现了`__getitem__()`方法。（如果它是可下标的）。因此产生了错误：

```
arr.append["HI"] 
```

> TypeError：“builtin_function_or_method”对象不可下标

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2016-11-23T13:02:35.987

我有同样的问题。我在做

```
arr = []
arr.append["HI"] 
```

所以使用`[`导致错误。它应该是`arr.append("HI")`

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2019-07-17T06:56:32.440

作为此处较早答案的推论，这通常表明您认为自己有一个列表（或字典，或其他可下标的对象），而实际上却没有。

例如，假设您有一个*应该*返回列表的函数；

```
def gimme_things():
    if something_happens():
        return ['all', 'the', 'things'] 
```

现在，当您调用该函数时，`something_happens()`由于某种原因没有返回`True`值，会发生什么？失败了`if`，所以你失败了；`gimme_things`没有显式地做`return`任何事情——所以事实上，它会隐式地`return None`. 然后这段代码：

```
things = gimme_things()
print("My first thing is {0}".format(things[0])) 
```

将因“`NoneType`对象不可下标”而失败，因为，嗯，`things`是`None`，所以你正在尝试做`None[0]`这没有意义，因为......错误消息所说的内容。

有两种方法可以修复代码中的这个错误——第一种是通过`things`在尝试使用它之前检查它实际上是否有效来避免错误；

```
things = gimme_things()
if things:
    print("My first thing is {0}".format(things[0]))
else:
    print("No things")  # or raise an error, or do nothing, or ... 
```

或等效地捕获`TypeError`异常；

```
things = gimme_things()
try:
    print("My first thing is {0}".format(things[0]))
except TypeError:
    print("No things")  # or raise an error, or do nothing, or ... 
```

另一种是重新设计`gimme_things`，以确保它始终返回一个列表。在这种情况下，这可能是更简单的设计，因为这意味着如果有很多地方存在类似的错误，它们可以保持简单和惯用。

```
def gimme_things():
    if something_happens():
        return ['all', 'the', 'things']
    else:  # make sure we always return a list, no matter what!
        logging.info("Something didn't happen; return empty list")
        return [] 
```

当然，您放入`else:`分支的内容取决于您的用例。也许您应该在失败时引发异常`something_happens()`，以使实际出错的地方更加明显和明确？在您自己的代码中添加异常是让自己确切知道发生故障时发生了什么的重要方法！

（另请注意，后一个修复仍然不能完全修复错误——它阻止你尝试下标`None`，但`things[0]`仍然`IndexError`是`things`一个空列表。如果你有一个`try`，你也可以`except (TypeError, IndexError)`捕获它。）

# asp.net - ASP.NET 键/值列表

> ID：216973
> 
> 赞同：3
> 
> 时间：2008-10-19T21:08:36.390
> 
> 标签：asp.net, c#-3.0

我正在为正在重新设计的大型网站制作自定义 404 页面。客户可能已将大约 40 个高使用率页面添加为书签，而我们的新网站结构将破坏这些书签。

在我的自定义 404 页面上，如果他们尝试通过旧 URL 导航到这些高使用率页面之一，我想提醒他们注意新 URL。所以我在 404 页面上有几个动态控件，一个用于“你想要这个吗？” 类型的对话框，另一个用于“如果就这样去这里（并更新您的书签）”类型的对话框。那是容易的部分。

为了建议一个新的 URL，我正在查看请求的 URL。如果里面有关键词，我会根据它来建议新的 URL，然后我会触发适当的你想要吗……，如果是……关于 404 的建议如上所述的页面。

所以我想将这 40 个键/值对（*关键字/新 URL 对*）存储在一个数据结构中，但我不确定什么是最好的。字典？字典？有什么区别，哪个更合适？

还是我完全走错了路？

谢谢你的时间。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-19T21:17:04.843

我会使用 System.Collections.Generic 命名空间中的 Dictionary<T,T>。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T21:12:02.390

您可以使用 NameValueCollection。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T23:29:09.790

也许这对您的用例来说有点过分了，但我可能会允许每个 Uri 有多个关键字，以及一个相对权重分数。然后，动态地对匹配的关键字进行评分。

```
class UriSuggester {
   private List<SuggestedUri> Uris { get; set; }

   Uri[] GetSuggestions(Uri originalUri) {
      var suggestionHits = new Dictionary<SuggestedUri, int>();
      foreach (var keyword in KeyWords.Parse(originalUri)) {
         // find suggestions matching that keyword
         foreach (var suggestedUri in Uris.Where(u => u.Keywords.Contains(keyword)) {
           // add a hit for keyword match
           suggestionHits[suggestedUri] += 1;
         }
      }
      // order by weight * hits
      return suggestionHits.Keys
        .OrderBy(s => s.Weight * suggestionHits[s])
        .Select(s => s.Uri)
        .ToArray();
   }
}

class SuggestedUri {
   public Uri Suggested { get; set; }
   public int Weight { get; set; }
   public Keyword[] Keywords;
}

class Keyword {
   public string Value { get; set; }
   public static Keyword[] Parse(Uri uri);
   override Equals;
   override GetHashCode;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-19T21:12:04.697

字典就好了。在这种情况下，您是否将其存储为接口类型 IDictionary 或 Dictionary 本身并不重要，因为除了 404 页面本身之外，它不会被过多地传递。

您是否考虑过进行一些 URL 重写以仍然支持旧 URL？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T21:20:45.383

您可以考虑编写自己的类逻辑，然后将其分配给 List 数据结构，如下所示：

```
public class KeyValuesClass
{
    private string a_key;
    private string a_value;

    public KeyValuesClass(string a_key, string a_value)
    {
           this.a_key = a_key;
           this.a_value = a_value;
    }

    public string Key
    {
        get{ return a_key; }
        set { a_key = value; }
    }

    public string Value
    {
        get{ return a_value; }
        set { a_value = value; }
    }

} 
```

代码中的某处

```
List<KeyValuesClass> my_key_value_list = new List<KeyValuesClass>();
my_key_value_list.Add(new KeyValuesClass("key", "value"); 
```

但是您可以将 Dictionary 视为我们上面提到的程序员伙伴 :)

# bash - 在 unix/linux shell 中进行模式匹配时，如何使用反向或负通配符？

> ID：216995
> 
> 赞同：360
> 
> 时间：2008-10-19T21:16:26.483
> 
> 标签：bash, shell, pattern-matching, glob

假设我想复制一个目录的内容，不包括名称中包含“音乐”一词的文件和文件夹。

```
cp [exclude-matches] *Music* /target_directory 
```

应该用什么代替 [exclude-matches] 来实现这一点？

* * *

## 回答 #1

> 赞同：408
> 
> 时间：2008-10-19T21:32:42.253

在 Bash 中，您可以通过启用该`extglob`选项来做到这一点，就像这样（当然，替换`ls`并`cp`添加目标目录）

```
~/foobar> shopt extglob
extglob        off
~/foobar> ls
abar  afoo  bbar  bfoo
~/foobar> ls !(b*)
-bash: !: event not found
~/foobar> shopt -s extglob  # Enables extglob
~/foobar> ls !(b*)
abar  afoo
~/foobar> ls !(a*)
bbar  bfoo
~/foobar> ls !(*foo)
abar  bbar 
```

您可以稍后禁用 extglob

```
shopt -u extglob 
```

* * *

## 回答 #2

> 赞同：247
> 
> 时间：2008-10-20T00:15:43.097

shell 选项在`extglob`命令行中为您提供更强大的模式匹配。

你用 开启它，用`shopt -s extglob`关闭它`shopt -u extglob`。

在您的示例中，您最初会执行以下操作：

```
$ shopt -s extglob
$ cp !(*Music*) /target_directory 
```

完整可用的**扩展**通配符**运算**符是（摘自`man bash`）：

> 如果使用内置 shopt 启用了 extglob shell 选项，则可以识别多个扩展模式匹配运算符。**模式列表是由 | 分隔的一个或多个模式的列表。** 可以使用以下子图案中的一种或多种来形成复合图案：
> 
> *   **?(pattern-list)**
>     匹配给定模式的零次或一次出现
> *   ***(pattern-list)**
>     匹配给定模式的零次或多次出现
> *   **+(pattern-list)**
>     匹配给定模式的一次或多次出现
> *   **@(pattern-list)**
>     匹配给定模式之一
> *   **!(pattern-list)**
>     匹配除给定模式之一之外的任何内容

因此，例如，如果您想列出当前目录中所有不是`.c`或`.h`文件的文件，您可以这样做：

```
$ ls -d !(*@(.c|.h)) 
```

当然，正常的 shell globing 是有效的，所以最后一个例子也可以写成：

```
$ ls -d !(*.[ch]) 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-10-19T21:23:42.913

不在 bash 中（据我所知），但是：

```
cp `ls | grep -v Music` /target_directory 
```

我知道这不完全是您想要的，但它会解决您的示例。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-19T21:40:26.780

如果您想避免使用 exec 命令的 mem 成本，我相信您可以使用 xargs 做得更好。我认为以下是更有效的替代方案

```
find foo -type f ! -name '*Music*' -exec cp {} bar \; # new proc for each exec

find . -maxdepth 1 -name '*Music*' -prune -o -print0 | xargs -0 -i cp {} dest/ 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-03-13T17:59:25.193

我还没有在这里看到的一个技巧，它不使用`extglob`, `find`，或者`grep`将两个文件列表视为集合并使用*“区分”*它们`comm`：

```
comm -23 <(ls) <(ls *Music*) 
```

`comm`比它更可取，`diff`因为它没有多余的东西。

`ls`这将返回集合 1,中*不在*集合 2, 中的所有元素`ls *Music*`。这需要两个集合都按排序顺序才能正常工作。和 glob 扩展没问题`ls`，但如果你使用类似的东西`find`，一定要调用`sort`.

```
comm -23 <(find . | sort) <(find . | grep -i '.jpg' | sort) 
```

潜在有用。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-19T21:32:27.997

您还可以使用一个非常简单的`for`循环：

```
for f in `find . -not -name "*Music*"`
do
    cp $f /target/dir
done 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-11-28T18:36:45.120

在 bash 中`shopt -s extglob`，[`GLOBIGNORE`变量](https://www.gnu.org/software/bash/manual/html_node/Filename-Expansion.html). 它并不是真的更好，但我发现它更容易记住。

一个可能是原始海报想要的示例：

```
GLOBIGNORE="*techno*"; cp *Music* /only_good_music/ 
```

完成后，`unset GLOBIGNORE`就可以`rm *techno*`在源目录中了。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-02-18T09:35:26.347

我个人的偏好是使用 grep 和 while 命令。这允许人们编写功能强大但可读的脚本，以确保您最终完全按照您的意愿行事。另外，通过使用 echo 命令，您可以在执行实际操作之前执行空运行。例如：

```
ls | grep -v "Music" | while read filename
do
echo $filename
done 
```

将打印出您最终要复制的文件。如果列表正确，下一步就是简单地将 echo 命令替换为 copy 命令，如下所示：

```
ls | grep -v "Music" | while read filename
do
cp "$filename" /target_directory
done 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-19T21:23:13.473

可以使用 find 找到一个解决方案。

```
$ mkdir foo bar
$ touch foo/a.txt foo/Music.txt
$ find foo -type f ! -name '*Music*' -exec cp {} bar \;
$ ls bar
a.txt 
```

Find 有很多选项，您可以非常具体地了解包含和排除的内容。

编辑：评论中的亚当指出这是递归的。查找选项 mindepth 和 maxdepth 可用于控制这一点。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-02-28T09:24:39.077

以下作品列出`*.txt`了当前目录中的所有文件，但以数字开头的文件除外。

这适用于`bash`、`dash`和`zsh`所有其他 POSIX 兼容的 shell。

```
for FILE in /some/dir/*.txt; do    # for each *.txt file
    case "${FILE##*/}" in          #   if file basename...
        [0-9]*) continue ;;        #   starts with digit: skip
    esac
    ## otherwise, do stuff with $FILE here
done 
```

1.  在第一行，该模式`/some/dir/*.txt`将导致`for`循环遍历`/some/dir`名称以 . 结尾的所有文件`.txt`。

2.  在第二行中，case 语句用于清除不需要的文件。–`${FILE##*/}`表达式从文件名（此处`/some/dir/`）中删除任何前导目录名称组件，以便模式只能匹配文件的基本名称。（如果您只是根据后缀清除文件名，则可以将其缩短为`$FILE`。）

3.  在第三行中，所有匹配`case`pattern `[0-9]*`) 行的文件都将被跳过（`continue`语句跳转到`for`循环的下一次迭代）。– 如果您愿意，您可以在这里做一些更有趣的事情，例如使用 跳过所有不以字母 (a-z) 开头的文件`[!a-z]*`，或者您可以使用多种模式来跳过多种文件名，例如`[0-9]*|*.bak`跳过两个文件的`.bak`文件，以及不以数字开头的文件。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-02-12T18:06:50.543

这将完全排除“音乐”

```
cp -a ^'Music' /target 
```

this 和 that 用于排除诸如 Music?* 或 *?Music 之类的内容

```
cp -a ^\*?'complete' /target
cp -a ^'complete'?\* /target 
```******``