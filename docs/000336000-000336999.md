# StackOverflow 问答 000336000-000336999

# winforms - 您对 NetAdvantage 或 DXperience 有何体验？

> ID：336004
> 
> 赞同：5
> 
> 时间：2008-12-03T01:33:38.350
> 
> 标签：winforms, infragistics, dxperience, netadvantage

我正在研究它们，虽然我对前任雇主的 NetAdvantage 感到非常满意，但我发现价格点（加上[什么是最好的 winform UI 组件集？](https://stackoverflow.com/questions/37921/what-is-the-best-winform-ui-component-set)）让我犹豫并考虑 DXExperience .

也就是说，我想知道：

*   你在任何一个领域（或理想情况下两者都有）的经验是什么？
*   你愿意把*自己*辛苦赚来的钱花在任何一个上吗？

这是针对 WinForms 的——也是最后一个问题：

*   DXperience 有什么类似于 UltraWinDataGrid 的吗？这个网格太棒了——没有一个合理的竞争对手是一个表演障碍。

**注**：本文无意煽动火焰战争，我感兴趣的是经验和**务实**的建议。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-07-28T13:31:40.460

我们评估了来自 Syncfusion、Infragistics、ComponentOne、Xceed、Janus 和 DevExpress 的库。我们根据其功能集、网格性能和功能以及功能区控制功能决定使用 DevExpress。

比较 Infragistics 和 DevExpress Grid 控件我发现：

*   与 Infragistics 网格相比，DevExpress 网格加载速度更快，处理的数据更多。
    *   25K 行 * 50 列：Infragistics 加载时间为 2000ms，DevExpress 加载时间为 1400ms
    *   50K 行 * 500 列
        *   Infragistics 600ms 首次加载，400ms 后续
        *   DevExpress 1000ms 首次加载，250ms 后续加载
    *   500K 行 * 50 列
        *   Infragistsic 3500ms 首次加载，7000ms 后续加载
        *   DevExpress 2000ms 首次加载，1700ms 后续加载
    *   2M 行 * 10 列
        *   Infragistics 内存不足异常
        *   DevExpress 8500ms 首次加载，10000ms 后续加载

适用于 Windows 窗体的 DevExpress DxGrid 控件非常棒。内联编辑器使用户体验非常好。排序和分组对于开发人员和最终用户来说都易于使用和理解。

总的来说，我对图书馆非常满意。他们的支持非常好。在这个项目的整个生命周期中，我已经提出了 20 多个支持问题，并且每次都得到了很好的回应。

我会把自己的钱花在 DevExpress 控件上。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T02:00:32.663

DevEx Grid很棒，*虽然*我没有使用 UltraWinDataGrid 的经验。

我愿意把自己的钱花在 DevEx 上吗？是的，我确实这样做了——我早在 Delphi 时代就一直在使用他们的东西（维持 Delphi 订阅大约 5 年，现在 .NET 订阅将持续 4 年）。他们得到了极好的支持和非常强大的产品线。

编辑：根据我在[Infragistics 网站](http://www.infragistics.com/dotnet/netadvantage/winforms.aspx)上看到的 NetAdvantage WinGrid 的内容，[DevEx Grid](http://devexpress.com/Products/NET/Controls/WinForms/Grid/)可以做所有这些，甚至更多。您可能习惯的所有过滤、排序、分组和自定义布局内容，以及卡片布局等等。此外，如果您对他们的产品不满意，DevEx 将提供无条件退款保证。

老实说，我不是 DevEx 的骗子，只是一个非常快乐的客户——是的——为他们的东西支付自己的钱 :)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T02:52:36.333

我是一个asp人，我在签约时使用了devexpress。任何套房都有自己的一套你必须学习的陷阱，但总的来说我很高兴。我现在的雇主使用 Telerik，我回顾我的 aspxperience 时间是一个光明的时期。

我确实把自己的钱花在了他们的东西上，我认为这是一个不错的选择。仅他们的电网就极大地帮助我获得了合同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-28T13:01:33.273

我使用 NetAdvantage 大幅前后摆动。控件很好，但过于复杂 - 新控件的学习曲线巨大。它们也不是很有效，并且倾向于生成大量的视图状态数据和 HTML；比我觉得必要的要多得多。他们的控制集多年来一直在发展，老实说，我希望他们重新开始——即使这会迫使我重建我的 webapps 的大部分。

他们的质量控制虽然很糟糕。每个新版本都以恐惧而不是喜悦来迎接新的错误，就像旧错误被修复一样快。例如，他们在 JavaScript 文件中留下了“调试”语句。

我怀疑他们的支持最近被外包了，他们的标准回答是“请生成一个独立的项目来演示错误”，这至少可以说是乏味的。最近花了三个月的时间等待修复。我发现自己通过 Infragistics 拨打的支持电话比所有其他公司加起来都要多。

与此相关，他们的文档似乎对我不起作用。也许我还不够努力。

但是，尽管存在所有负面因素，但控件功能丰富，可以节省自己滚动的时间。多少时间？不再那么确定了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-31T15:46:41.907

NetAdvantage 的网格组件也让我们惊叹不已。不过，从那里开始走下坡路。他们的技术支持似乎对我们想要合并到表格中的“复杂性”（即排序、复选框、菜单等）感到“惊讶”。

解决方案是在他们的咨询服务上花更多的钱来修复他们的代码。在交出更多钱之前，我宁愿咬断我的手。

然而，令人欣慰的是，在我们的经历中，我们并不孤单。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-13T19:38:58.100

我曾与 DevExpress 和 Infragistics 合作，发现 DevExpress 好得多，原因有几个。控件性能更好，看起来更稳定，并且依赖文件对于 DevExpress 来说更轻。我们实际上是从使用 Infragistcs 的旧（.Net v1.5）解决方案中脱离出来的，因为由于需要安装依赖项，维护起来非常困难。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T02:44:42.653

这些证明也很有帮助： http: [//www.componentsource.com/products/dxperience-winforms/reviews.html](http://www.componentsource.com/products/dxperience-winforms/reviews.html)

和

[http://www.componentsource.com/products/netadvantage-net/reviews.html](http://www.componentsource.com/products/netadvantage-net/reviews.html)

但还没决定...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-06-08T14:41:18.203

我对 Infragistics Netadvantage 的体验：

该软件有很多错误，支持无法处理大多数稍微高级的问题。我的很多 Infragistics 问题（这些是 Basics 中的错误！）在 2011 年及更早的时候就已经广为人知了。

我非常后悔没有做足够的研究就购买了该软件。最后，我编写了几个 Workaround 脚本，以便完全能够使用这些控件。支持团队提供的大多数解决方案都处理将控件的属性设置为“关闭”。开箱前的最终解决方案：关闭所有功能...

所以我真的不推荐购买这些控件。

一个不错的选项可能是 AjaxControlToolkit，它不需要任何费用。Infragistics 承诺了很多关于他们的控制，你不会轻易实现。

一个示例：当您在 DropDownBox 中进行过滤并想要单步执行某个结果时，每次进行回发时，当您想要对选择事件做出反应时，这会导致不需要的行为。此外，稍微快一点地遍历元素，第二次或第三次回发就会迷失方向。

使用 AjaxControlToolkit，您从一开始就知道您必须自己完成一些任务，但至少 Basics 不是 Buggy。

目前我们正在调查 Telerik，到目前为止还没有遇到类似的麻烦。

# visual-studio-2008 - 在 VSTS2008 数据库版 GDR RTM 的 SQL2005 数据库项目中设置权限和架构图设计器的便捷设计器在哪里？

> ID：336009
> 
> 赞同：2
> 
> 时间：2008-12-03T01:37:34.410
> 
> 标签：visual-studio-2008, database-project, gdr

我刚刚安装了 Visual Studio Team System Database Edition GDR RTM 的 GDR RTM 版本。

这一切似乎工作得很好，但我似乎必须编辑 XML (Database.sqlpermissions) 以指定 SQL 权限。

我错过了什么吗？

就此而言，模式图工具在哪里？

我了解 GDR 为扩展数据库版组件公开了很多内容，所以我应该等待第三方扩展来提供图表工具和权限设计器吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T02:32:48.867

是的，我认为他们错过了 GDR 的全部要点，至少这个版本是这样。

源代码控制和构建自动化非常好，但数据库开发工作的主要内容是在数据库中构建对象和存储过程，其中许多是使用设计器完成的，因为它比启动 TSQL 更快。由于 GDR 不满足此要求，因此该设计将继续在 Management Studio 中完成。

如果人们使用 Management Studio 来完成他们的实际工作，那么为了让源代码控制保持最新而不断地同步回 VS 模型是一件很痛苦的事情，这意味着它不会始终如一地完成，即使它是它会产生摩擦。

往返开发效果不佳。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-06T22:04:26.287

我一直在寻找一些平面设计师，但当我没有找到时感到很失望。

当我使用它时，它看起来越来越好。我不是图形设计师，而是使用 SQL Server Management Studio 在数据库中设计表格，而不是全部反转为脚本。比我可以直接更改脚本并部署新的数据库版本或继续直接在数据库中进行更改。

往返开发效果很好。

# python - 如何处理有许多窗户的林间空地项目

> ID：336013
> 
> 赞同：7
> 
> 时间：2008-12-03T01:39:50.803
> 
> 标签：python, gtk, pygtk, glade

我正在开发一个 PyGTK/glade 应用程序，它目前有 16 个窗口/对话框，大约 130KB，最终将有大约 25 个窗口/对话框，大约 200KB。目前，我将所有窗口存储在一个整体的空地文件中。当我运行一个窗口时，我称它为...

```
self.wTree = gtk.glade.XML("interface.glade", "WindowXYZ") 
```

我想知道将每个窗口拆分成它自己的空地文件是否是一个更好的主意。而不是一个有 25 个窗口/对话框的林间空地文件，我有 25 个林间空地文件，每个文件有一个窗口/对话框，并像这样调用它：

```
self.wTree = gtk.glade.XML("windowxyz.glade") 
```

你们认为最好的方法是什么？一种方法是否比另一种方法更耗费资源？转到单个林间空地文件的一件好事是命名小部件会更容易。例如，我将所有 OK 按钮命名为“windowxyz_ok”，但我可以将其更改为简单的“ok”。让事情变得更简单。缺点是对不同的窗口进行更改可能不太方便。

我对任何和所有争论持开放态度。谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-04T00:13:52.723

在我的项目中，每个林间空地文件总是有一个窗口。我会为您的项目推荐相同的方法。

以下是两个主要原因：

*   它会更快并且使用更少的内存，因为每次调用 gtk.glade.XML() 都会解析整个事情。当然，您可以传入 root 参数以避免为所有窗口创建小部件树，但您仍然必须*解析*所有 XML，即使您对它不感兴趣。
*   从概念上讲，如果每个窗口有一个顶层，则更容易理解。您只需查看文件名即可轻松知道给定对话框/窗口所在的文件名。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T10:17:28.463

您是否花了一些时间来确定它是否有所作为？

问题是，据我了解，Glade 在解析 XML 文件时总是会创建所有小部件，因此如果您打开 XML 文件并仅读取单个小部件，则会浪费大量资源。

另一个问题是，如果您想拥有该小部件的另一个实例，则需要重新读取该文件。

我之前的做法是将所有只创建一次的小部件（如关于窗口、主窗口等）放入一个 glade 文件，并为需要多次创建的小部件单独的 glade 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T16:49:09.313

我为不同的窗户使用不同的林间空地文件。但我在同一个林间空地文件中保持与窗口相关联的对话框。正如你所说，命名问题很烦人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T21:42:47.880

我有一个带有 2 个窗口的林间空地文件。它的大小约为 450kb，我没有看到使用带有 GTKmm 的 libglademm 有任何减速。

# php - 你能得到一个调用类的变量吗？

> ID：336018
> 
> 赞同：3
> 
> 时间：2008-12-03T01:42:15.697
> 
> 标签：php, oop

我有一个类`Page`，它创建一个`DB`名为的实例`$db`。

在`__construct()`中`Page`，我创建了新`$db`对象并从文件中提取了一堆配置数据。

现在 DB 类有一个`_connectToDB()`（尝试）连接到数据库的方法。

DB类中有没有办法调用父类的配置数组？如果不需要，我不想制作全局变量，也不想两次抓取配置数据。

伪代码可能看起来像这样......

```
$dbUsername = get_calling_class_vars(configArray['dbUserName']); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T02:02:54.140

我发现将所有“重要”对象初始化为接近他们需要知道的任何变量通常更容易。你可以这样尝试：

```
/* Code to get config variables here */
$DB = new DB($config);
/* You might want to delete the database password from $config here */
$Page = new Page($config, $DB); 
```

这样做意味着如果您愿意，还可以对数据库对象进行类型检查：

```
class Page {
    function __construct(array $config, DBClass $db) { }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2017-07-13T10:21:12.513

`static`如果您想在不传递这些变量的情况下共享变量，则可以使用：

```
class page{
    static $configArray = [];
    function doWhatever(){
        $db = new DB();
        $db->connectToDB();
    }
}
class DB{
    function connectToDB(){
        $dbUsername = page::$configArray['dbUserName'];
    }
} 
```

在这种情况下，将这些数据设置为 是有意义的`static`，因为即使您有页面类的多个实例，配置参数也应该始终相同。

无论如何，我认为仅在 DB 类中构造和保留 $configArray 可能会更好。如果你想从外部调用它，你可以使用相同的`static`逻辑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T01:46:23.800

为什么不将配置参数传递给 connectToDb 函数或将配置数据传递给 DB 类的构造函数。

并在目录中回答问题：您对当前上下文中的外部调用上下文一无所知。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T01:55:38.383

请参阅[`debug_backtrace()`](http://php.net/debug_backtrace)以获取有关调用类或对象的信息。

然后查看[反射](http://php.net/manual/en/language.oop5.reflection.php)以获取有关给定类或对象的属性的更多信息。

**编辑：**但是对于它的价值，我还建议传递您需要的特定参数。引用调用者的数据可能构成[内容耦合](http://en.wikipedia.org/wiki/Coupling_(computer_science))。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T01:58:44.227

您可以将子项传递给父项的引用。例如：

```
class Parent {
  function __construct() {
    $this->myChild = new Child($this);
  }
  public function doSomething() {}
}

class Child {
  function __construct(Parent $parent) {
    $parent->doSomething()
  }
} 
```

您可能会觉得这很奇怪，因为您仍在父的构造函数中，因此您的父对象尚未完全构造。但是你仍然可以使用 $this 作为对你自己的引用，即使在构造函数中也是如此。您只需要注意您的孩子不会引用父母中尚未初始化的东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T02:33:44.000

一般来说，没有简单的方法可以做到这一点。但是作为一个一般设计问题，我可以理解为什么要避免使用全局变量，但是在应用程序范围的配置的情况下，对属性进行全局访问是完全合理的。

您可以将配置数据设为全局，也可以将所需的属性传递给 db 对象初始化。

# ruby - 在类中调用类方法

> ID：336024
> 
> 赞同：18
> 
> 时间：2008-12-03T01:46:11.553
> 
> 标签：ruby

我意识到这可能是一个幼稚的问题，但我仍然无法弄清楚如何在 Ruby 类中从另一个方法调用一个方法。

即在 Ruby 中是否可以执行以下操作：

```
class A
   def met1
   end
   def met2
      met1 #call to previously defined method1
   end
end 
```

谢谢，

R M

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-03T01:57:40.923

这些不是类方法，它们是实例方法。在您的示例中，您可以使用该类的实例从met2 调用met1，而不会出现问题：

```
class A
   def met1
     puts "In met1"
   end
   def met2
      met1
   end
end

var1 = A.new
var1.met2 
```

这是使用类方法的等价物，您通过在方法名称前加上其类名称来创建它：

```
class A
   def A.met1
     puts "In met1"
   end
   def A.met2
      met1
   end
end

A.met2 
```

# .net - 使用 DataGridView 中的 DataGridViewComboBoxColumn 将绑定字段的值设置为 NULL

> ID：336035
> 
> 赞同：3
> 
> 时间：2008-12-03T01:54:43.487
> 
> 标签：.net, winforms, data-binding

我在基于查找表的 DataGridView 中有一个 DataGridViewComboBoxColumn。

ValueMember 和 DisplayMember 字段绑定到 DataTable 中的字符串列。所有行都有两个字段的值 - 除了值字段被故意设置为 NULL 的特殊记录。

但是，当我选择此记录时，在绑定到 DataGridView 的 DataTable 中使用空字符串而不是 DBNull.Value。这发生在数据输入时，在数据被推送到数据库之前。

我已经检查了 DataGridViewComboBoxColumn 和 DataGridView 类——似乎没有简单的方法来自定义这种行为。有人知道这是否可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T09:13:35.067

嗯，我确实想出了*一个*解决方案。因为 DataGridView 是数据绑定的，所以我为 DataTable 实现了 ColumnChanging 事件。示例代码：

```
void Schedule_ColumnChanging(object sender, DataColumnChangeEventArgs e)
{
    if 
    ( 
        e.Column.ColumnName == "Site" &&
        e.ProposedValue is string && 
        e.ProposedValue as string == ""
    )
    e.ProposedValue = DBNull.Value;
} 
```

这可以解决问题。虽然我想知道是否有可以在 DataGridView 控件级别实现的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-28T22:13:33.027

我使用类型化的数据集来提供下拉列表的值。从数据库中填充值后，我添加*了另一*行以提供 null 支持。填充数据表的方法的最后几行如下所示......

```
// Fill dt from datatable...
var nullRow = rv.NewRunDropDownEntryRow();
nullRow.SetIDNull();
nullRow.Title = "None";
rv.AddRunDropDownEntryRow(nullRow);
rv.AcceptChanges(); 
```

之后*它就可以工作了*！null 值在下拉列表中显示为“None”，您可以轻松地在绑定行中更新为 null 或从 null 更新。

HTH-理查德

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-15T19:47:23.337

我在数据库中的查找表没有“无”条目。因此，不允许输入“无”。外键约束阻止在包含与查找表对应的 id 的子表中输入“无”。

我的解决方案是在表单加载中手动添加一个包含“无”的行（在 TableAdapter 已经用数据库中的真实行填充表之后）。

```
//' Add a 'None' row to allow the user to un-select a lookup item
//' The insert and update stored procedure translates a 'None' entry to NULL.
Dim newRow As MyLookupDataset.MyTableRow = Me.MyLookupDataset.MyTable.NewMyTableRow
newRow.MyID = "None" 
newRow.MyDesc = "None"
Me.MyLookupDataset.MyTable.Rows.InsertAt(newRow, 0) 
```

我对 TableAdapter 的 Insert 和 Update 语句使用了存储过程。在存储过程中，我吞下了“None”条目——这意味着如果接收到“None”作为过程的参数，我将其替换为 NULL。这允许用户选择“无”，但一旦保存条目将恢复为 NULL。

# asp.net - ASP.NET URL 重写从没有扩展名的 URL 内容进行 DB 查询

> ID：336038
> 
> 赞同：1
> 
> 时间：2008-12-03T01:56:18.523
> 
> 标签：asp.net, iis-6, rewrite, url-rewriting, isapi

我正在尝试创建一个非常简单的 ASP.NET 应用程序，它显示从基于 URL 的数据库中检索到的信息，以类似于 wiki 的方式，但在这种情况下，该站点是只读的。我想要的 URL 示例是：

```
http://www.foo.com/bar 
```

然后，应用程序将使用“bar”作为 SQL 查询参数来显示来自与“bar”匹配的数据库的信息。

我研究了 IIS6 的许多 URL 重写器选项（这将在专用服务器上），但我仍然不确定该应用程序使用哪一个。

为了澄清一下，我只需要从单个`default.aspx`文件运行该站点，但我希望它按上述方式工作。整个站点逻辑将非常简单。

我希望在这方面有更多经验的人可以帮助我——我正在寻找最简单的解决方案来解决这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T02:11:16.653

如果该扩展已注册，IIS6 仅将请求定向到 asp.net 引擎。默认情况下，注册的扩展名是 aspx ascx asmx 等...

如果您不能将数据库查询基于查询字符串参数（例如 foo.com/default.aspx?query=bar），那么您可以在 IIS6 上做的最好的事情就是通配符映射。基本上这意味着每个请求都将被定向到 asp.net（包括图像脚本和样式）。显然这会降低性能。

要启用通配符映射，请在 IIS 管理器中右键单击您的站点，然后转到属性 -> 主目录 -> 配置 -> 底部的映射，单击插入并输入 asp.net isapi dll 的路径（您可以从aspx 扩展名）并取消选中“验证该文件是否存在”。

进行更改后，您将能够请求 foo.com/bar

（另一种方法可能是向 foo.com/default.aspx/bar 发出请求）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-06T04:35:31.873

仅作记录，IIS URL Rewrite 2 支持这一点，您可以安装包含 DB 提供程序的可扩展性示例。仅适用于 IIS 7+。

[http://www.iis.net/download/urlrewrite](http://www.iis.net/download/urlrewrite) http://code.msdn.microsoft.com/rewriteextensibility

# cocoa - Sketch 示例 AppKit 应用程序中的类是如何分成模型/视图/控制器的？

> ID：336039
> 
> 赞同：3
> 
> 时间：2008-12-03T01:57:39.270
> 
> 标签：cocoa, model-view-controller, macos

我对 Sketch 示例 AppKit 应用程序（位于 /Developer/Examples/AppKit/Sketch）中将类定义为模型或视图感到有些困惑。SKTRectangle、SKTCircle 等类被认为是模型类，但它们具有绘图代码。

我的印象是模型应该没有任何视图/绘图代码。

有人可以澄清一下吗？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T04:21:44.423

Sketch 的开发者在自述文件中简要概述了他/她的基本原理：

* * *

**模型-视图-控制器设计**

Sketch的Model层主要是SKTGraphic类及其子类。草图文档由 SKTGraphics 列表组成。SKTGraphics 主要是数据承载类。每个图形都保留了表示任何类型图形所需的所有信息。SKTGraphic 类定义了一组用于修改图形的基元方法，并且一些子类添加了它们自己的新基元。SKTGraphic 类还定义了一些用于修改图形的扩展方法，这些方法是根据图元实现的。

*SKTGraphic 类定义了一组允许它自己绘制的方法。虽然这可能并不严格看起来应该是模型的一部分，但请记住，我们正在建模的是视觉对象的集合。尽管 SKTGraphic 知道如何在视图中呈现自己，但它本身并不是视图。*

* * *

我不知道这是否对您来说是一个令人满意的答案。我对 MVC 的个人经验是，虽然模型、视图和控制器的分离是一件“好事”，但实际上层之间的界限经常变得模糊。我认为为了方便而经常做出设计上的妥协。

特别是对于 Sketch，模型知道如何在视图中绘制自己对我来说很有意义。让每个 SKTGraphic 子类知道如何绘制自己的替代方法是让一个视图类了解每个 SKTGraphic 子类以及如何呈现它。在这种情况下，添加新的 SKTGraphic 子类将需要编辑视图类（可能会在 if/else 或 switch 语句中添加新子句）。使用当前的设计，可以添加一个 SKTGraphic 子类，而无需对视图类进行任何更改即可使事情正常进行。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T02:12:25.790

我不知道您所指的特定示例，但这是我对该设计原因的猜测：

也许**模型（您提到的 SKTRectangle、SKTCircle）知道足以绘制自己**，但不足以实际执行在屏幕上的绘制。屏幕上的绘图由 View 处理，**View 将调用 Models 以了解如何在屏幕上绘制它们**。

通过采用这种方法，视图不必知道如何绘制它可能遇到**的每一个模型——视图只需要知道如何让模型在屏幕上绘制自己**。

我认为这是 MVC 模型和面向对象编程模型之间的权衡——严格按照 MVC 线分开将意味着在添加对其他需要展示的模型。对于面向对象的设计，我们希望模型本身能够在屏幕上绘制自己，并且我们希望视图能够通过接口等工具处理新类型的模型。

# visual-studio - Visual Studio - 在源代码级别显示对函数的所有调用

> ID：336051
> 
> 赞同：15
> 
> 时间：2008-12-03T02:07:59.997
> 
> 标签：visual-studio, function-calls

我想知道是否有任何方法可以在源代码中列出对函数的所有调用，以便在修改该函数时可以看到依赖关系。

我使用的一种方法是在“整个解决方案”中搜索函数名称，但我正在寻找更好的方法。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-03T02:08:59.683

右键单击该调用并选择“查找所有引用”。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-03T02:11:53.763

蛮力方法是更改​​函数名称并重新编译并查看错误。有时我在使用 VS 中的查找引用功能时遇到问题。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-02-22T10:34:54.960

在方法声明上： `Ctrl`+ `K`, `Ctrl`+`T`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T02:19:40.800

使用[NDepend](http://www.ndepend.com/)。它带有一个 VS 插件，可让您即时执行 CQL 查询。请参阅[此屏幕截图](http://www.ndepend.com/Res/NDependBig09.PNG)。

# php - 无需加密即可保护 PHP 代码的最佳解决方案

> ID：336057
> 
> 赞同：76
> 
> 时间：2008-12-03T02:11:30.613
> 
> 标签：php, encryption, obfuscation

首先，我不是在寻找奇迹……我知道 PHP 是如何工作的，并且没有真正的方法可以在不使用加密的情况下向客户端隐藏我的代码。但这伴随着在运行的服务器上安装扩展的成本。

不过，我正在寻找不同的东西......我不想加密我的代码甚至混淆它。有许多没有加密/混淆代码的 PHP 脚本，但它们是商业应用程序。例如，vBulletin 和/或 IP.Board 论坛应用程序。

我只是想知道这些人在他们的应用程序中使用什么方法......

我也愿意接受任何其他建议。

请注意，我是单身人士，不在公司工作。我的产品也很专一，不会卖那么多。我只是想让你们知道，我不能咨询法律专业人士来起诉某人或准备商业许可证。我只是在寻找一种简单的方法来保护我的简单产品，如果确实可能的话，以某种方式......

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-12-03T02:20:26.900

混淆事物只会给您的合法，守法客户带来不便，而会敲诈您的人无论如何都不是您的目标付费客户。（编辑了关于混淆的其他想法）

保护您的软件的另一个建议：创建一个业务模型，其中代码是您产品价值的不完整部分。例如，销售产品许可证以及访问您在网站上管理的某些数据的权限，或者以订阅模式或客户支持许可产品。

设计 EULA 是一个法律问题，而不是编码问题。您可以从阅读您使用的产品和网站的一些 EULA 文本开始。你可能会发现一些有趣的细节！

创建专有许可证非常灵活，并且可能超出了 StackOverflow 的预期范围，因为它并不是严格意义上的编码。

想到的 EULA 的某些部分：

*   如果产品有错误或造成损坏，则限制您的责任。
*   详细说明客户如何使用他们的许可软件、使用多长时间、在多少台机器上、有或没有再分发权等。
*   授予您审核其站点的权利，以便您可以强制执行许可证。
*   如果他们违反 EULA 会发生什么，例如他们失去使用您的软件的特权。

您应该咨询法律专业人士以准备商业 EULA。

**编辑：**如果这个项目不能证明律师的费用是合理的，请查看以下资源：

*   joelonsoftware 上的“ [EULA 建议”](http://discuss.joelonsoftware.com/default.asp?biz.5.293027.14)
*   “[如何编写最终用户许可协议](http://www.avangate.com/articles/eula-software_75.htm)”

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-03T03:04:31.070

你需要考虑你的目标：

1）**您是否试图阻止人们阅读/修改您的代码？** 如果是，您将需要一个混淆/加密工具。我已经成功使用[Zend Guard](http://www.zend.com/en/products/guard/)。

2）**您是否试图防止未经授权重新分发您的代码？** EULA/专有许可证将赋予您阻止这种情况的法律权力，但实际上不会阻止它。密钥/激活方案将允许您主动监控使用情况，但除非您还加密您的代码，否则可以将其删除。Zend Guard 还具有将特定脚本锁定到特定客户机器和/或创建代码的时间限制版本（如果您想要这样做）的功能。

我不熟悉 vBulletin 等，但他们要么需要加密/混淆，要么信任他们的用户做正确的事情。在后一种情况下，他们受到 EULA 的保护，该 EULA 禁止他们认为不受欢迎的行为，以及支持违反 EULA 的法律制度。

如果您不准备/无法采取法律行动来保护您的软件并且您不想加密/混淆，您的选择是 a) 使用 EULA 发布它，以便在需要时拥有合法的选择并希望最好，或者 b) 考虑开源许可证是否更合适，只允许重新分发。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-03T03:08:57.643

我已经有一段时间没有查看 VBulletin 源代码了，但他们在 2003 年左右使用的方法是在代码中嵌入对他们服务器的调用。IIRC，它在一个非常长的代码行上（比如 200-300+ 字符长）并且被分解为几个字符串连接等。

如果你盗版它并没有什么“坏” - 论坛仍然工作 100%。但是您的服务器的 IP 与其他信息一起被记录下来，他们用它来调查并采取法律行动。

您的许可证号已嵌入此呼叫中，因此他们可以轻松跟踪给定许可副本运行的 IP/网站数量。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-08-17T17:59:34.243

如果您无法创建自己托管并通过 Web 访问的“云应用程序”，那么您可以考虑使用虚拟服务器（来自 VMWare、Parallels、Sun 等）创建虚拟设备并安装“lite " 的 Linux 版本。将您的 PHP 代码放在虚拟环境中，然后在他们的服务器上安装虚拟机。确保创建一种防止加载到根目录的方法。当然，这将涉及亲自拜访客户。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T02:17:07.107

[他们根据专有许可](http://en.wikipedia.org/wiki/Software_license#Proprietary_software_licenses)分发他们的软件。法律保护他们的权利并阻止他们的客户重新分配资源，尽管这样做并没有实际困难。

但您可能很清楚，软件产品的版权侵权（盗版）是一种[相当普遍的现象](http://www.nationmaster.com/graph/cri_sof_pir_rat-crime-software-piracy-rate)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-29T17:23:53.377

在我看来是，但以防万一您的 php 代码程序是为独立模型编写的……最好的解决方案是 c）您可以将 php 包装在像 Phalanger（.NET）这样的容器中。众所周知，它与系统紧密绑定，特别是如果您的程序是为 Windows 用户设计的。您只需使用 Windows 编程语言（如 .NET/VB/C# 或您在 .NET prog.lang.family 集中了解的任何内容）制作自己的保护算法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T23:49:57.077

真正保护您的 php 应用程序免受他人侵害的唯一方法是不共享源代码。如果您将代码发布在网上某个地方，或者通过某种媒介将其发送给您的客户，那么除了您之外的其他人可以访问该代码。

您可以为代码的每个副本添加唯一的水印。这样，您就可以将泄漏追溯到单个客户。（但这会对你有帮助吗，因为代码已经超出了你的控制范围？）

我看到的大多数代码都带有许可证，也许还有保修。脚本顶部的一行告诉人们不要更改脚本，也许就足够了。自己; 当我发现非开源代码时，我不会在我的项目中使用它。也许我有点受骗，但我希望人们不要使用我的非 OSS 代码！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-04T03:51:47.737

请参阅我们的[SD PHP 混淆器](http://www.semanticdesigns.com/Products/Obfuscators/PHPObfuscator.jsp)。处理庞大的 PHP 文件系统。对 PHP 服务器没有运行时要求。没有额外的运行时开销。

[编辑 2016 年 5 月] 最近的回答指出 Zend 不处理 PHP5.5。SD PHP 混淆器可以。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-08-01T06:47:46.770

Zend Guard 不支持 php 5.5 并且很容易反转，去[http://www.ioncube.com](http://www.ioncube.com)进行混淆。[http://www.phplicengine.com](http://wwww.phplicengine.com)可以远程或本地许可脚本。

* * *

## 回答 #10

> 赞同：-6
> 
> 时间：2011-03-31T00:51:45.960

所以让我看看，我们想让亚当和夏娃看到树上有一些禁果，我们想要一种方法来阻止他们吃...

有一个拿着火焰剑的天使怎么样？

1.  听起来可能很幼稚，我不知道您的应用程序实际上做了什么，但是广泛使用包含呢？

2.  对于合法用户，是所有应该可见的软件还是部分软件？因为您可以混淆源代码并将其副本提供给合法的

3.  您可以将 php 包装在像 Phalanger (.NET) 这样的容器中

4.  也许您担心外部盗窃，这意味着您的代码在客户使用它时可以在网络上自由可见。这可能值得投资一个便宜的网站托管，每年 50 美元，用他们的代码中的序列号注册您的合法客户，并让您的应用程序定期将信息发布到您的网站。至少，您会检测到代码何时被泄露。您可以在 n 天后自行销毁它，让您有足够的时间联系您的客户并更改序列号。这可能是整个代码中唯一混淆的 include()

# algorithm - 检测两个图像在视觉上是否相同

> ID：336067
> 
> 赞同：38
> 
> 时间：2008-12-03T02:19:48.383
> 
> 标签：algorithm, image, image-processing, hash

有时两个图像文件在文件级别上可能不同，但人们会认为它们在感知上是相同的。鉴于此，现在假设您有一个庞大的图像数据库，并且您想知道人类是否会认为数据库中存在某些图像 X。如果所有图像都有一个感知哈希/指纹，那么可以对图像 X 进行哈希处理，查看它是否在数据库中将是一件简单的事情。

我知道围绕这个问题进行了研究，并且存在一些算法，但是是否有任何工具，例如 UNIX 命令行工具或库，我可以使用它来计算这样的哈希，而无需从头开始实施某些算法？

编辑：来自 findimagedupes 的相关代码，使用 ImageMagick

```
try $image->Sample("160x160!");
try $image->Modulate(saturation=>-100);
try $image->Blur(radius=>3,sigma=>99);
try $image->Normalize();
try $image->Equalize();
try $image->Sample("16x16");
try $image->Threshold();
try $image->Set(magick=>'mono');
($blob) = $image->ImageToBlob(); 
```

编辑：**警告！**ImageMagick $image 对象似乎包含有关读取的图像文件的创建时间的信息。这意味着即使对于同一图像，如果在不同时间检索到的 blob，您获得的 blob 也会有所不同。为确保指纹保持不变，请使用 $image->getImageSignature() 作为最后一步。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-03T02:38:03.353

[findimagedupes](http://www.jhnc.org/findimagedupes/)很不错。例如，您可以运行“findimagedupes -v 指纹图像”来打印“感知散列”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-08-15T18:44:24.210

互相关或相位相关将告诉您图像是否相同，即使存在噪声、退化以及水平或垂直偏移。使用基于 FFT 的方法将使其比问题中描述的算法快得多。

但是，通常的算法不适用于比例或旋转不同的图像。您可以预先旋转或预先缩放它们，但这确实是处理器密集型的。显然，您也可以在对数极坐标空间中进行相关性，它对旋转、平移和缩放都是不变的，但我不太了解细节来解释这一点。

MATLAB 示例：[使用归一化互相关注册图像](http://www.mathworks.com/products/demos/image/cross_correlation/imreg.html)

维基百科称其为“[相位相关](http://en.wikipedia.org/wiki/Phase_correlation)”，并且还描述[了使其具有缩放和旋转不变性](http://en.wikipedia.org/wiki/Image_registration#Spatial_vs._frequency_domain_methods)：

> The method can be extended to determine rotation and scaling differences between two images by first converting the images to log-polar coordinates. Due to properties of the Fourier transform, the rotation and scaling parameters can be determined in a manner invariant to translation.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-03T03:51:53.547

颜色直方图适用于已调整大小、重新采样等的相同图像。
如果你想匹配不同人的同一地标的照片，那就更棘手了——看看 haar 分类器。Opencv 是一个很棒的免费图像处理库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T02:45:50.093

我不知道它背后的算法，但[Microsoft Live Image Search](http://www.live.com/?scope=images)刚刚[添加了](http://googlesystem.blogspot.com/2008/12/find-similar-images-using-live-search.html)此功能。Picasa 还能够识别图像中的人脸，并对看​​起来相似的人脸进行分组。大多数时候，是同一个人。

一些机器学习技术，如支持向量机、神经网络、朴素贝叶斯分类器或贝叶斯网络，最适合这类问题。我已经写了前三个中的一个来对手写数字进行分类，这本质上是图像模式识别。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T03:09:59.717

将图像调整为 1x1 像素...如果它们是精确的，则它们是同一张图片的可能性很小...现在将其调整为 2x2 像素图像，如果所有 4 个像素都是精确的，则它们的概率更大是精确的……然后是 3x3，如果所有 9 个像素都是精确的……很好的机会等等。然后是 4x4，如果所有的 16 个像素都是精确的，……更好的机会。

ETC...

这样做，您可以提高效率...如果 1x1 像素网格偏离很多，为什么还要检查 2x2 网格？等等

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T03:39:07.270

如果您有很多图像，则可以使用颜色直方图来获得图像的粗略接近度，然后再对每个图像进行完整的图像比较（即 O(n^2)）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-03T02:37:29.297

您可以使用 diff 来查看它们是否真的不同。我想它会消除很多无用的比较。然后，对于算法，我将使用概率方法..它们看起来相同的可能性是多少..我会根据每个像素中的 rgb 数量来计算。您还可以找到其他一些指标，例如亮度和类似的东西。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-03T03:17:34.490

有[DPEG](http://www.gotdupes.com/index.cfm?page=3495&pagename=d%60peg%21)，**“The” Duplicate Media Manager**，但它的代码是不开放的。这是一个非常古老的工具——我记得在 2003 年使用它。

# css - CSS：基本布局问题 - 将嵌套元素保持在彼此内部

> ID：336073
> 
> 赞同：5
> 
> 时间：2008-12-03T02:25:40.227
> 
> 标签：css, layout, css-float

我不断发现，如果我在彼此内部嵌套了 div，并且内部的一个是浮动的，那么外部的就不会围绕它展开。

例子：

```
<div style='background-color:red; '>
    asdfasdf
    <div style='float:left; background-color:blue; width:400px; height:400px;'>
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
        asdfasdfasdfasdfasdfasdfasdf<br />
    </div>
    asdfasdf
</div> 
```

我需要对外部 div 做什么以使其覆盖内部 div？IE：把它的边框/背景颜色一直放在它周围？

另外，我在这里遇到的一般原则是什么？如果是这样，我应该查什么才能深入了解它是什么？

谢谢！

**编辑**

大家好，

感谢您的回答，语义上正确和否，以及链接。

尽管我最终会在最后的工作中使用溢出，但我会保留 Ant P 的答案，因为它是第一个真正有效的答案，并且让我摆脱了短期的卡顿，即使它冒犯了语义敏感性。

作为一个长期尝试转向体面的 css 布局的 html hack，我当然可以理解并同情使用语义不正确的 hack 来完成工作，尽管我相信他会在此之后改变这种习惯 =o)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-03T03:58:34.750

您可以使用**溢出来严格使用 CSS:hidden**

```
<div style='background-color:red;overflow:hidden;'>
...
</div> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T08:34:58.640

如果您是喜欢解释的类型（而不仅仅是“这样做”），这里有一些解释几种方法的优秀文章：

[浮标的简单清除](http://www.sitepoint.com/blogs/2005/02/26/simple-clearing-of-floats/)

[如何在没有结构标记的情况下清除浮动](http://www.positioniseverything.net/easyclearing.html)

[清除浮动](http://www.quirksmode.org/css/clearing.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T05:33:57.040

这是关于 SO 的一些 CSS 问题的基本问题，这简直令人震惊。更令人震惊的是，有多少次有人给出了像 Ant P 那样的答案。虽然在技术上是正确的，但在语义上是完全不正确的。忒弥斯是绝对正确的。只需添加`overflow:hidden`到浮动 div 的父级。有时为了让它与 IE 配合得很好，您可能必须指定宽度或高度。这就是它的全部。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T04:04:41.337

如果您只是浮动外部 div，它将扩展以包含嵌套的 div。在布局中组合浮动和非浮动元素通常很麻烦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T15:26:46.187

我无法击败已发布的答案，但我确实有一个很好的技巧可以帮助诊断布局问题而不会搞砸您的标记。

将此部分添加到 CSS 文件的底部，并在不需要时将其注释掉：

```
div
{
   border-width: thin !important;
   border-color: Orange !important;
   border-style: solid !important;
}

label, span, /* whatever else you might want to see */
{
   border-width: thin !important;
   border-color: Blue !important;
   border-style: solid !important;
} 
```

通常我会发现一个实际工作的布局（特别是使用“添加一个`<br>`样式”的布局`clear: both`）实际上不会正确嵌套`<div>`，但有人调整了 CSS 以便它通过巫术来工作。实际上是看边界您的元素有很大帮助，在 CSS 中执行此操作意味着您不必触摸真实标记或主要 CSS 即可打开边框以进行调试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T08:45:15.937

这篇关于[CSS 系统](http://natbat.net/2008/Sep/28/css-systems/)的文章绝对值得一读。正如 Darko Z 所说，看到 Ant P 给出的语义错误答案令人震惊。

# php - PHP mySQL - 何时是断开数据库连接的最佳时间？

> ID：336078
> 
> 赞同：18
> 
> 时间：2008-12-03T02:28:31.610
> 
> 标签：php, mysql

我使用*延迟连接*在我的数据库对象中连接到我的数据库。这基本上意味着它不会调用 mysql_connect() 直到第一个查询被传递给它，然后它随后会跳过重新连接。

现在我在我的数据库类中有一个方法，`disconnectFromDB()`它调用`mysql_close()`和设置了很多`$_connected = FALSE`（所以该`query()`方法将知道再次连接到数据库）。应该在每次查询之后调用（作为私有函数）还是通过对象从外部调用......因为我在想类似的东西（代码只是一个例子）

```
$students = $db->query('SELECT id FROM students');

$teachers = $db->query('SELECT id FROM teachers'); 
```

现在，如果它在每次查询后都关闭，这是否会减慢它的速度，而不是我只是将这一行添加到末尾

```
$db->disconnectFromDB(); 
```

或者我应该只在页面的最后包含上面的那一行？

两者都有哪些优点/缺点？什么在你的情况下最有效？除了稍微损失性能之外，忘记关闭 mySQL 连接真的有什么问题吗？

感谢您花时间回答。

谢谢！

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-03T02:35:20.613

据我所知，除非您使用持久连接，否则您的 MySQL 连接将在页面执行结束时关闭。

因此，您调用 disconnect 将不会增加任何内容，并且由于您执行的是惰性连接，因此如果您或其他开发人员犯了错误并在错误的时间断开连接，可能会导致创建第二个连接。

鉴于此，我只允许我的连接自动关闭。您的页面应该能够快速执行，因此在那么短的时间内保持连接不会导致任何问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-03T02:46:26.393

我刚刚在 PHP 网站上阅读了有关持久连接的评论，知道这可能会很有趣：

> 以下是不使用持久连接的重要原因的回顾：
> 
> *   当你锁定一个表时，通常在连接关闭时它会被解锁，但由于持久连接不会关闭，任何你不小心保持锁定状态的表都将保持锁定状态，解锁它们的唯一方法是等待连接超时或杀死过程。事务也会出现同样的锁定问题。（请参阅下面 2002 年 4 月 23 日和 2003 年 7 月 12 日的评论）
>     
>     
> *   通常在连接关闭时会删除临时表，但由于持久连接不会关闭，所以临时表不是那么临时的。如果您在完成后没有显式删除临时表，则该表将已经存在以供新客户端重用同一连接。设置会话变量也会出现同样的问题。（请参阅下面 2004 年 11 月 19 日和 2006 年 8 月 7 日的评论）
>     
>     
> *   如果 PHP 和 MySQL 在同一台服务器或本地网络上，连接时间可能可以忽略不计，在这种情况下，持久连接没有任何优势。
>     
>     
> *   Apache 不能很好地处理持久连接。当它接收到来自新客户端的请求时，它不会使用已经打开持久连接的可用子节点之一，而是倾向于产生一个新的子节点，然后它必须打开一个新的数据库连接。当您达到最大连接数时，这会导致过多的进程处于休眠状态、浪费资源并导致错误，而且它会破坏持久连接的任何好处。（请参阅下面 2004 年 2 月 3 日的评论，以及 [http://devzone.zend.com/node/view/id/686#fn1](http://devzone.zend.com/node/view/id/686#fn1)的脚注）

（上面的文字不是我写的）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-03T02:47:44.597

不要打扰断开连接。在每个查询之前检查`$_connected`的成本加上实际调用`$db->disconnectFromDB();`关闭的成本最终将比让 PHP 在完成每个页面时关闭连接更昂贵。

**推理：**

1：如果您将连接保持打开状态直到脚本结束：

*   PHP引擎循环通过mysql连接的内部数组
*   PHP 引擎在内部为每个连接调用 mysql_close()

2：如果你自己关闭连接：

*   您必须检查`$_connected`每个查询的值。这意味着 PHP 必须检查变量`$_connected`A) 是否存在 B) 是布尔值并且 C) 是真/假。
*   您必须调用您的“断开连接”函数，而函数调用是 PHP 中更昂贵的操作之一。PHP 必须检查您的函数 A) 是否存在，B) 不是私有/受保护的，以及 C) 您是否为函数提供了足够的参数。它还必须在新的本地范围内创建 $connection 变量的副本。
*   然后您的“断开连接”函数将调用 mysql_close()，这意味着 PHP A) 检查 mysql_close() 是否存在，B) 您是否已向 mysql_close() 和 C) 提供了所有需要的参数，它们是正确的类型（mysql 资源）。

我在这里可能不是 100% 正确，但我相信机会对我有利。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T02:37:48.487

您可能想查看使用持久连接。这里有两个链接可以帮助你

[http://us2.php.net/manual/en/features.persistent-connections.php](http://us2.php.net/manual/en/features.persistent-connections.php)

[http://us2.php.net/manual/en/function.mysql-pconnect.php](http://us2.php.net/manual/en/function.mysql-pconnect.php)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T03:16:03.480

执行的基本单元大概是整个脚本。您首先想要高效且有效地应用资源（即数据库）是整个单个脚本。

然而，PHP、Apache/IIS/无论什么，都有自己的生命；他们能够使用您在脚本生命周期之外打开的连接。这就是持久（或池化）连接的意义所在。

回到你的脚本。事实证明，您有很多机会在执行过程中创造性地使用该连接。

典型的幼稚脚本往往会一次又一次地点击连接，拾取与给定对象/模块/选定选项相关联的本地适当数据碎片。这就是程序方法可以通过打开、请求、接收和关闭来对该连接施加惩罚的地方。（请注意，任何单个查询都将保持活动状态，直到它被显式关闭或脚本结束。请注意，连接和查询根本不是一回事。查询占用表；连接占用......连接（在大多数情况下映射到套接字）。所以你应该意识到在使用两者时适当的经济性。

关于查询的最经济的策略是尽可能少。我会经常尝试构建一个或多或少复杂的连接查询，以带回完整的数据集，而不是将请求分成小块。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-03T03:42:04.770

使用惰性连接可能是一个好主意，因为您可能根本不需要数据库连接来执行某些脚本。

另一方面，一旦它打开，让它保持打开状态，或者在脚本结束时显式关闭它，或者允许 PHP 清理连接——打开连接不会损害任何东西，而且你不希望如果您第二次查询数据库，则会产生不必要的检查和重新建立连接的开销。

# perl - 为什么调用这个函数会改变我的数组？

> ID：336124
> 
> 赞同：4
> 
> 时间：2008-12-03T03:01:53.617
> 
> 标签：perl, arrays, file

每当我读取文件时，Perl 似乎正在杀死我的数组：

```
my @files = ("foo", "bar", "baz");
print "Files: " . join(" ", @files) . "\n";

foreach(@files) {
   print "The file is $_\n";
   func();
}

sub func {
   open(READ, "< test.txt");
   while(<READ>) {
   }
   close READ;
}

print "Files: " . join(" ", @files) . "\n"; 
```

产生：

```
Files: foo bar baz
The file is foo
The file is bar
The file is baz
Files: 
```

但是当我注释掉时`func()`，它给出了我所期望的：

```
Files: foo bar baz
The file is foo
The file is bar
The file is baz
Files: foo bar baz 
```

任何想法为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-03T03:46:44.057

您必须更改`foo`为 localize `$_`，或者不要`$_`在循环中使用。最好的是，两者都做：

```
foreach my $filename (@files) {
    print "The file is $filename\n";
    func();
}

sub func {
    local $_;
    open my $read, '<', 'test.txt' or die "Couldn't open test.txt: $!";
    while(<$read>) {
    }
    close $read or die "Couldn't close file: $!";
} 
```

foreach 循环别名`$_`为文件的当前名称，并`while(<READ>)`分配给`$_`. 可以这么说，这是一个糟糕的魔法组合。

一般来说，除了单线之外，过多地依赖`$_`任何东西都是一个坏主意。

# php - 计算工作日

> ID：336127
> 
> 赞同：107
> 
> 时间：2008-12-03T03:07:45.320
> 
> 标签：php, calendar, date

我需要一种在 PHP 中添加“工作日”的方法。例如，星期五 12/5 + 3 个工作日 = 星期三 12/10。

至少我需要代码来理解周末，但理想情况下它也应该考虑到美国联邦假期。我敢肯定，如有必要，我可以通过蛮力提出解决方案，但我希望那里有更优雅的方法。任何人？

谢谢。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-12-03T03:56:28.000

这是PHP 手册中 date() 函数页面上[用户评论中的一个函数。](http://www.php.net/manual/en/function.date.php#79911)这是对评论中早期功能的改进，增加了对闰年的支持。

输入开始日期和结束日期，以及可能介于两者之间的任何假期的数组，它以整数形式返回工作日：

```
<?php
//The function returns the no. of business days between two dates and it skips the holidays
function getWorkingDays($startDate,$endDate,$holidays){
    // do strtotime calculations just once
    $endDate = strtotime($endDate);
    $startDate = strtotime($startDate);

    //The total number of days between the two dates. We compute the no. of seconds and divide it to 60*60*24
    //We add one to inlude both dates in the interval.
    $days = ($endDate - $startDate) / 86400 + 1;

    $no_full_weeks = floor($days / 7);
    $no_remaining_days = fmod($days, 7);

    //It will return 1 if it's Monday,.. ,7 for Sunday
    $the_first_day_of_week = date("N", $startDate);
    $the_last_day_of_week = date("N", $endDate);

    //---->The two can be equal in leap years when february has 29 days, the equal sign is added here
    //In the first case the whole interval is within a week, in the second case the interval falls in two weeks.
    if ($the_first_day_of_week <= $the_last_day_of_week) {
        if ($the_first_day_of_week <= 6 && 6 <= $the_last_day_of_week) $no_remaining_days--;
        if ($the_first_day_of_week <= 7 && 7 <= $the_last_day_of_week) $no_remaining_days--;
    }
    else {
        // (edit by Tokes to fix an edge case where the start day was a Sunday
        // and the end day was NOT a Saturday)

        // the day of the week for start is later than the day of the week for end
        if ($the_first_day_of_week == 7) {
            // if the start date is a Sunday, then we definitely subtract 1 day
            $no_remaining_days--;

            if ($the_last_day_of_week == 6) {
                // if the end date is a Saturday, then we subtract another day
                $no_remaining_days--;
            }
        }
        else {
            // the start date was a Saturday (or earlier), and the end date was (Mon..Fri)
            // so we skip an entire weekend and subtract 2 days
            $no_remaining_days -= 2;
        }
    }

    //The no. of business days is: (number of weeks between the two dates) * (5 working days) + the remainder
//---->february in none leap years gave a remainder of 0 but still calculated weekends between first and last day, this is one way to fix it
   $workingDays = $no_full_weeks * 5;
    if ($no_remaining_days > 0 )
    {
      $workingDays += $no_remaining_days;
    }

    //We subtract the holidays
    foreach($holidays as $holiday){
        $time_stamp=strtotime($holiday);
        //If the holiday doesn't fall in weekend
        if ($startDate <= $time_stamp && $time_stamp <= $endDate && date("N",$time_stamp) != 6 && date("N",$time_stamp) != 7)
            $workingDays--;
    }

    return $workingDays;
}

//Example:

$holidays=array("2008-12-25","2008-12-26","2009-01-01");

echo getWorkingDays("2008-12-22","2009-01-02",$holidays)
// => will return 7
?> 
```

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2013-10-07T09:38:27.503

获取两个日期之间**没有假期的工作日数：**

### 使用示例：

```
echo number_of_working_days('2013-12-23', '2013-12-29'); 
```

### 输出：

```
3 
```

### 功能：

```
function number_of_working_days($from, $to) {
    $workingDays = [1, 2, 3, 4, 5]; # date format = N (1 = Monday, ...)
    $holidayDays = ['*-12-25', '*-01-01', '2013-12-23']; # variable and fixed holidays

    $from = new DateTime($from);
    $to = new DateTime($to);
    $to->modify('+1 day');
    $interval = new DateInterval('P1D');
    $periods = new DatePeriod($from, $interval, $to);

    $days = 0;
    foreach ($periods as $period) {
        if (!in_array($period->format('N'), $workingDays)) continue;
        if (in_array($period->format('Y-m-d'), $holidayDays)) continue;
        if (in_array($period->format('*-m-d'), $holidayDays)) continue;
        $days++;
    }
    return $days;
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-03T03:35:42.207

[date()](http://us.php.net/manual/en/function.date.php)函数有一些参数应该会有所帮助。如果你检查 date("w") 它会给你一个星期几的数字，从 0 代表星期日到 6 代表星期六。所以..也许像..

```
$busDays = 3;
$day = date("w");
if( $day > 2 && $day <= 5 ) { /* if between Wed and Fri */
  $day += 2; /* add 2 more days for weekend */
}
$day += $busDays; 
```

*这只是一种可能性的粗略示例..*

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-11-29T20:01:52.477

每个州的假期计算都是非标准的。我正在编写一个银行应用程序，我需要一些硬性的业务规则，但仍然只能获得一个粗略的标准。

```
/**
 * National American Holidays
 * @param string $year
 * @return array
 */
public static function getNationalAmericanHolidays($year) {

    //  January 1 - New Year’s Day (Observed)
    //  Calc Last Monday in May - Memorial Day  strtotime("last Monday of May 2011");
    //  July 4 Independence Day
    //  First monday in september - Labor Day strtotime("first Monday of September 2011")
    //  November 11 - Veterans’ Day (Observed)
    //  Fourth Thursday in November Thanksgiving strtotime("fourth Thursday of November 2011");
    //  December 25 - Christmas Day        
    $bankHolidays = array(
          $year . "-01-01" // New Years
        , "". date("Y-m-d",strtotime("last Monday of May " . $year) ) // Memorial Day
        , $year . "-07-04" // Independence Day (corrected)
        , "". date("Y-m-d",strtotime("first Monday of September " . $year) ) // Labor Day
        , $year . "-11-11" // Veterans Day
        , "". date("Y-m-d",strtotime("fourth Thursday of November " . $year) ) // Thanksgiving
        , $year . "-12-25" // XMAS
        );

    return $bankHolidays;
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2014-09-04T05:54:23.390

```
$startDate = new DateTime( '2013-04-01' );    //intialize start date
$endDate = new DateTime( '2013-04-30' );    //initialize end date
$holiday = array('2013-04-11','2013-04-25');  //this is assumed list of holiday
$interval = new DateInterval('P1D');    // set the interval as 1 day
$daterange = new DatePeriod($startDate, $interval ,$endDate);
foreach($daterange as $date){
if($date->format("N") <6 AND !in_array($date->format("Y-m-d"),$holiday))
$result[] = $date->format("Y-m-d");
}
echo "<pre>";print_r($result); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-12-02T01:59:43.150

这是一个将营业日添加到日期的功能

```
 function add_business_days($startdate,$buisnessdays,$holidays,$dateformat){
  $i=1;
  $dayx = strtotime($startdate);
  while($i < $buisnessdays){
   $day = date('N',$dayx);
   $date = date('Y-m-d',$dayx);
   if($day < 6 && !in_array($date,$holidays))$i++;
   $dayx = strtotime($date.' +1 day');
  }
  return date($dateformat,$dayx);
 }

 //Example
 date_default_timezone_set('Europe\London');
 $startdate = '2012-01-08';
 $holidays=array("2012-01-10");
 echo '<p>Start date: '.date('r',strtotime( $startdate));
 echo '<p>'.add_business_days($startdate,7,$holidays,'r'); 
```

另一篇文章提到了 getWorkingDays（来自 php.net 评论并包含在此处），但我认为如果您从周日开始并在工作日结束，它会中断。

使用以下内容（您需要包含上一篇文章中的 getWorkingDays 函数）

```
 date_default_timezone_set('Europe\London');
 //Example:
 $holidays = array('2012-01-10');
 $startDate = '2012-01-08';
 $endDate = '2012-01-13';
 echo getWorkingDays( $startDate,$endDate,$holidays); 
```

给出结果为 5 而不是 4

```
Sun, 08 Jan 2012 00:00:00 +0000 weekend
Mon, 09 Jan 2012 00:00:00 +0000
Tue, 10 Jan 2012 00:00:00 +0000 holiday
Wed, 11 Jan 2012 00:00:00 +0000
Thu, 12 Jan 2012 00:00:00 +0000
Fri, 13 Jan 2012 00:00:00 +0000 
```

以下函数用于生成上述内容。

```
 function get_working_days($startDate,$endDate,$holidays){
      $debug = true;
      $work = 0;
      $nowork = 0;
      $dayx = strtotime($startDate);
      $endx = strtotime($endDate);
      if($debug){
       echo '<h1>get_working_days</h1>';
       echo 'startDate: '.date('r',strtotime( $startDate)).'<br>';
       echo 'endDate: '.date('r',strtotime( $endDate)).'<br>';
       var_dump($holidays);
       echo '<p>Go to work...';
      }
      while($dayx <= $endx){
       $day = date('N',$dayx);
       $date = date('Y-m-d',$dayx);
       if($debug)echo '<br />'.date('r',$dayx).' ';
       if($day > 5 || in_array($date,$holidays)){
        $nowork++;
     if($debug){
      if($day > 5)echo 'weekend';
      else echo 'holiday';
     }
       } else $work++;
       $dayx = strtotime($date.' +1 day');
      }
      if($debug){
      echo '<p>No work: '.$nowork.'<br>';
      echo 'Work: '.$work.'<br>';
      echo 'Work + no work: '.($nowork+$work).'<br>';
      echo 'All seconds / seconds in a day: '.floatval(strtotime($endDate)-strtotime($startDate))/floatval(24*60*60);
      }
      return $work;
     }

    date_default_timezone_set('Europe\London');
     //Example:
     $holidays=array("2012-01-10");
     $startDate = '2012-01-08';
     $endDate = '2012-01-13';
//broken
     echo getWorkingDays( $startDate,$endDate,$holidays);
//works
     echo get_working_days( $startDate,$endDate,$holidays); 
```

带上假期...

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-09-08T13:53:20.610

你可以试试这个更简单的功能。

```
function getWorkingDays($startDate, $endDate)
{
    $begin = strtotime($startDate);
    $end   = strtotime($endDate);
    if ($begin > $end) {

        return 0;
    } else {
        $no_days  = 0;
        while ($begin <= $end) {
            $what_day = date("N", $begin);
            if (!in_array($what_day, [6,7]) ) // 6 and 7 are weekend
                $no_days++;
            $begin += 86400; // +1 day
        };

        return $no_days;
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-10-14T10:34:27.047

我的版本基于@mcgrailm 的工作...进行了调整，因为报告需要在 3 个工作日内进行审核，如果在周末提交，计数将从下周一开始：

```
function business_days_add($start_date, $business_days, $holidays = array()) {
    $current_date = strtotime($start_date);
    $business_days = intval($business_days); // Decrement does not work on strings
    while ($business_days > 0) {
        if (date('N', $current_date) < 6 && !in_array(date('Y-m-d', $current_date), $holidays)) {
            $business_days--;
        }
        if ($business_days > 0) {
            $current_date = strtotime('+1 day', $current_date);
        }
    }
    return $current_date;
} 
```

并根据工作日计算两个日期的差异：

```
function business_days_diff($start_date, $end_date, $holidays = array()) {
    $business_days = 0;
    $current_date = strtotime($start_date);
    $end_date = strtotime($end_date);
    while ($current_date <= $end_date) {
        if (date('N', $current_date) < 6 && !in_array(date('Y-m-d', $current_date), $holidays)) {
            $business_days++;
        }
        if ($current_date <= $end_date) {
            $current_date = strtotime('+1 day', $current_date);
        }
    }
    return $business_days;
} 
```

请注意，使用 86400 或 24*60*60 的每个人，请不要……您的忘记时间从冬季/夏季时间变化，一天不完全是 24 小时。虽然 strtotime('+1 day', $timestamp) 慢了一点，但它更可靠。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-06-19T16:23:17.743

从给定日期增加或减少工作日的功能，这不考虑假期。

```
function dateFromBusinessDays($days, $dateTime=null) {
  $dateTime = is_null($dateTime) ? time() : $dateTime;
  $_day = 0;
  $_direction = $days == 0 ? 0 : intval($days/abs($days));
  $_day_value = (60 * 60 * 24);

  while($_day !== $days) {
    $dateTime += $_direction * $_day_value;

    $_day_w = date("w", $dateTime);
    if ($_day_w > 0 && $_day_w < 6) {
      $_day += $_direction * 1; 
    }
  }

  return $dateTime;
} 
```

像这样使用...

```
echo date("m/d/Y", dateFromBusinessDays(-7));
echo date("m/d/Y", dateFromBusinessDays(3, time() + 3*60*60*24)); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-12-07T23:37:27.507

检测工作时间的蛮力尝试 - 周一至周五上午 8 点至下午 4 点：

```
if (date('N')<6 && date('G')>8 && date('G')<16) {
   // we have a working time (or check for holidays)
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-03-17T06:06:53.143

以下是从给定日期计算工作日的工作代码。

```
<?php
$holiday_date_array = array("2016-01-26", "2016-03-07", "2016-03-24", "2016-03-25", "2016-04-15", "2016-08-15", "2016-09-12", "2016-10-11", "2016-10-31");
$date_required = "2016-03-01";

function increase_date($date_required, $holiday_date_array=array(), $days = 15){
    if(!empty($date_required)){
        $counter_1=0;
        $incremented_date = '';
        for($i=1; $i <= $days; $i++){
            $date = strtotime("+$i day", strtotime($date_required));
            $day_name = date("D", $date);
            $incremented_date = date("Y-m-d", $date);
            if($day_name=='Sat'||$day_name=='Sun'|| in_array($incremented_date ,$holiday_date_array)==true){
                $counter_1+=1;
            }
        }
        if($counter_1 > 0){
            return increase_date($incremented_date, $holiday_date_array, $counter_1);
        }else{
            return $incremented_date;
        }
    }else{
        return 'invalid';
    }
}

echo increase_date($date_required, $holiday_date_array, 15);
?>

//output after adding 15 business working days in 2016-03-01 will be "2016-03-23" 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-08-01T07:34:08.063

这个代码片段很容易计算没有周末和节假日的工作日：

```
function getWorkingDays($startDate,$endDate,$offdays,$holidays){
$endDate = strtotime($endDate);
$startDate = strtotime($startDate);
$days = ($endDate - $startDate) / 86400 + 1;
$counter=0;
for ($i = 1; $i <= $days; $i++) {
    $the_first_day_of_week = date("N", $startDate);
    $startDate+=86400;
if (!in_array($the_first_day_of_week, $offdays) && !in_array(date("Y-m-
d",$startDate), $holidays)) {
$counter++;
}

}   
return $counter;
}
//example to use
$holidays=array("2017-07-03","2017-07-20");
$offdays=array(5,6);//weekend days Monday=1 .... Sunday=7
echo getWorkingDays("2017-01-01","2017-12-31",$offdays,$holidays) 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-12-05T11:21:04.287

这是每天没有 for 循环的另一种解决方案。

```
$from = new DateTime($first_date);
$to = new DateTime($second_date);

$to->modify('+1 day');
$interval = $from->diff($to);
$days = $interval->format('%a');

$extra_days = fmod($days, 7);
$workdays = ( ( $days - $extra_days ) / 7 ) * 5;

$first_day = date('N', strtotime($first_date));
$last_day = date('N', strtotime("1 day", strtotime($second_date)));
$extra = 0;
if($first_day > $last_day) {
   if($first_day == 7) {
       $first_day = 6;
   }

   $extra = (6 - $first_day) + ($last_day - 1);
   if($extra < 0) {
       $extra = $extra * -1;
   }
}
if($last_day > $first_day) {
    $extra = $last_day - $first_day;
}
$days = $workdays + $extra 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-03T03:49:06.563

对于假期，以 date() 可以生成的某种格式创建一个日期数组。例子：

```
// I know, these aren't holidays
$holidays = array(
    'Jan 2',
    'Feb 3',
    'Mar 5',
    'Apr 7',
    // ...
); 
```

然后使用[in_array()](http://php.net/in_array)和[date()](http://php.net/date)函数检查时间戳是否代表假日：

```
$day_of_year = date('M j', $timestamp);
$is_holiday = in_array($day_of_year, $holidays); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-06-29T15:36:01.510

我有同样的需求，我从 bobbin 的第一个例子开始，最后得到了这个

```
 function add_business_days($startdate,$buisnessdays,$holidays=array(),$dateformat){
    $enddate = strtotime($startdate);
    $day = date('N',$enddate);
    while($buisnessdays > 1){
        $enddate = strtotime(date('Y-m-d',$enddate).' +1 day');
        $day = date('N',$enddate);
        if($day < 6 && !in_array($enddate,$holidays))$buisnessdays--;
    }
    return date($dateformat,$enddate);
  } 
```

某人

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-10-07T17:20:04.580

```
<?php
// $today is the UNIX timestamp for today's date
$today = time();
echo "<strong>Today is (ORDER DATE): " . '<font color="red">' . date('l, F j, Y', $today) . "</font></strong><br/><br/>";

//The numerical representation for day of week (Ex. 01 for Monday .... 07 for Sunday
$today_numerical = date("N",$today);

//leadtime_days holds the numeric value for the number of business days 
$leadtime_days = $_POST["leadtime"];

//leadtime is the adjusted date for shipdate
$shipdate = time();

while ($leadtime_days > 0) 
{
 if ($today_numerical != 5 && $today_numerical != 6)
 {
  $shipdate = $shipdate + (60*60*24);
  $today_numerical = date("N",$shipdate);
  $leadtime_days --;
 }
 else
  $shipdate = $shipdate + (60*60*24);
  $today_numerical = date("N",$shipdate);
}

echo '<strong>Estimated Ship date: ' . '<font color="green">' . date('l, F j, Y', $shipdate) . "</font></strong>";
?> 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-03-02T19:02:01.717

变体 1：

```
<?php
/*
 * Does not count current day, the date returned is the last business day
 * Requires PHP 5.1 (Using ISO-8601 week)
 */

function businessDays($timestamp = false, $bDays = 2) {
    if($timestamp === false) $timestamp = time();
    while ($bDays>0) {
        $timestamp += 86400;
        if (date('N', $timestamp)<6) $bDays--;
    }
    return $timestamp;
} 
```

变体 2：

```
<?php
/*
 * Does not count current day, the date returned is a business day 
 * following the last business day
 * Requires PHP 5.1 (Using ISO-8601 week)
 */

function businessDays($timestamp = false, $bDays = 2) {
    if($timestamp === false) $timestamp = time();
    while ($bDays+1>0) {
        $timestamp += 86400;
        if (date('N', $timestamp)<6) $bDays--;
    }
    return $timestamp;
} 
```

变体 3：

```
<?php
/*
 * Does not count current day, the date returned is 
 * a date following the last business day (can be weekend or not. 
 * See above for alternatives)
 * Requires PHP 5.1 (Using ISO-8601 week)
 */

function businessDays($timestamp = false, $bDays = 2) {
    if($timestamp === false) $timestamp = time();
    while ($bDays>0) {
        $timestamp += 86400;
        if (date('N', $timestamp)<6) $bDays--;
    }
    return $timestamp += 86400;
} 
```

通过执行以下操作，可以使用上述的变体来考虑额外的假期。笔记！确保所有时间戳都是一天中的同一时间（即午夜）。

制作一组假期日期（作为unixtimestamps），即：

```
$holidays = array_flip(strtotime('2011-01-01'),strtotime('2011-12-25')); 
```

修改行：

```
if (date('N', $timestamp)<6) $bDays--; 
```

成为 ：

```
if (date('N', $timestamp)<6 && !isset($holidays[$timestamp])) $bDays--; 
```

完毕！

```
<?php
/*
 * Does not count current day, the date returned is the last business day
 * Requires PHP 5.1 (Using ISO-8601 week)
 */

function businessDays($timestamp = false, $bDays = 2) {
    if($timestamp === false) $timestamp = strtotime(date('Y-m-d',time()));
    $holidays = array_flip(strtotime('2011-01-01'),strtotime('2011-12-25'));
    while ($bDays>0) {
        $timestamp += 86400;
        if (date('N', $timestamp)<6 && !isset($holidays[$timestamp])) $bDays--;
    }
    return $timestamp;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-04-07T13:24:03.063

```
<?php 
function AddWorkDays(){
$i = 0;
$d = 5; // Number of days to add

    while($i <= $d) {
    $i++;
        if(date('N', mktime(0, 0, 0, date(m), date(d)+$i, date(Y))) < 5) {
            $d++;
        }
    }
    return date(Y).','.date(m).','.(date(d)+$d);
}
?> 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-03-21T21:50:15.893

这是一个递归解决方案。它可以很容易地修改为仅跟踪并返回最新日期。

```
//  Returns a $numBusDays-sized array of all business dates, 
//  starting from and including $currentDate. 
//  Any date in $holidays will be skipped over.

function getWorkingDays($currentDate, $numBusDays, $holidays = array(), 
  $resultDates = array())
{
  //  exit when we have collected the required number of business days
  if ($numBusDays === 0) {
    return $resultDates;
  }

  //  add current date to return array, if not a weekend or holiday
  $date = date("w", strtotime($currentDate));
  if ( $date != 0  &&  $date != 6  &&  !in_array($currentDate, $holidays) ) {
    $resultDates[] = $currentDate;
    $numBusDays -= 1;
  }

  //  set up the next date to test
  $currentDate = new DateTime("$currentDate + 1 day");
  $currentDate = $currentDate->format('Y-m-d');

  return getWorkingDays($currentDate, $numBusDays, $holidays, $resultDates);
}

//  test
$days = getWorkingDays('2008-12-05', 4);
print_r($days); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-05-31T16:17:17.967

```
date_default_timezone_set('America/New_York');

/** Given a number days out, what day is that when counting by 'business' days
  * get the next business day. by default it looks for next business day
  * ie calling  $date = get_next_busines_day(); on monday will return tuesday
  *             $date = get_next_busines_day(2); on monday will return wednesday
  *             $date = get_next_busines_day(2); on friday will return tuesday
  *
  * @param $number_of_business_days (integer)       how many business days out do you want
  * @param $start_date (string)                     strtotime parseable time value
  * @param $ignore_holidays (boolean)               true/false to ignore holidays
  * @param $return_format (string)                  as specified in php.net/date
 */
function get_next_business_day($number_of_business_days=1,$start_date='today',$ignore_holidays=false,$return_format='m/d/y') {

    // get the start date as a string to time
    $result = strtotime($start_date);

    // now keep adding to today's date until number of business days is 0 and we land on a business day
    while ($number_of_business_days > 0) {
        // add one day to the start date
        $result = strtotime(date('Y-m-d',$result) . " + 1 day");

        // this day counts if it's a weekend and not a holiday, or if we choose to ignore holidays
        if (is_weekday(date('Y-m-d',$result)) && (!(is_holiday(date('Y-m-d',$result))) || $ignore_holidays) ) 
            $number_of_business_days--;

    }

    // when my $number of business days is exausted I have my final date

    return(date($return_format,$result));
}

    function is_weekend($date) {
    // return if this is a weekend date or not.
    return (date('N', strtotime($date)) >= 6);
}

function is_weekday($date) {
    // return if this is a weekend date or not.
    return (date('N', strtotime($date)) < 6);
}

function is_holiday($date) {
    // return if this is a holiday or not.

    // what are my holidays for this year
    $holidays = array("New Year's Day 2011" => "12/31/10",
                        "Good Friday" => "04/06/12",
                        "Memorial Day" => "05/28/12",
                        "Independence Day" => "07/04/12",
                        "Floating Holiday" => "12/31/12",
                        "Labor Day" => "09/03/12",
                        "Thanksgiving Day" => "11/22/12",
                        "Day After Thanksgiving Day" => "11/23/12",
                        "Christmas Eve" => "12/24/12",
                        "Christmas Day" => "12/25/12",
                        "New Year's Day 2012" => "01/02/12",
                        "New Year's Day 2013" => "01/01/13"
                        );

    return(in_array(date('m/d/y', strtotime($date)),$holidays));
}

print get_next_business_day(1) . "\n"; 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2015-05-20T09:47:49.843

**计算两个日期之间的工作日，包括假期和自定义工作周**

答案并不是那么微不足道 - 因此我的建议是使用一个类，您可以在其中配置更多内容，而不是依赖简单的功能（或假设固定的语言环境和文化）。要在一定数量的工作日后获取日期，您将：

1.  需要指定您将在哪些工作日工作（默认为 MON-FRI） - 该类允许您单独启用或禁用每个工作日。
2.  需要知道您需要考虑公共假期（国家和州）是准确的
    *   例如[https://github.com/khatfield/php-HolidayLibrary/blob/master/Holidays.class.php](https://github.com/khatfield/php-HolidayLibrary/blob/master/Holidays.class.php)
    *   或硬编码数据：例如来自[http://www.feiertagskalender.ch/?hl=en](http://www.feiertagskalender.ch/?hl=en)
    *   或支付数据 API [http://www.timeanddate.com/services/api/holiday-api.html](http://www.timeanddate.com/services/api/holiday-api.html)

**功能方法**

```
/**
 * @param days, int
 * @param $format, string: dateformat (if format defined OTHERWISE int: timestamp) 
 * @param start, int: timestamp (mktime) default: time() //now
 * @param $wk, bit[]: flags for each workday (0=SUN, 6=SAT) 1=workday, 0=day off
 * @param $holiday, string[]: list of dates, YYYY-MM-DD, MM-DD 
 */
function working_days($days, $format='', $start=null, $week=[0,1,1,1,1,1,0], $holiday=[])
{
    if(is_null($start)) $start = time();
    if($days <= 0) return $start;
    if(count($week) != 7) trigger_error('workweek must contain bit-flags for 7 days');
    if(array_sum($week) == 0) trigger_error('workweek must contain at least one workday');
    $wd = date('w', $start);//0=sun, 6=sat
    $time = $start;
    while($days)
    {
        if(
        $week[$wd]
        && !in_array(date('Y-m-d', $time), $holiday)
        && !in_array(date('m-d', $time), $holiday)
        ) --$days; //decrement on workdays
        $wd = date('w', $time += 86400); //add one day in seconds
    }
    $time -= 86400;//include today
    return $format ? date($format, $time): $time;
}

//simple usage
$ten_days = working_days(10, 'D F d Y');
echo '<br>ten workingdays (MON-FRI) disregarding holidays: ',$ten_days;

//work on saturdays and add new years day as holiday
$ten_days = working_days(10, 'D F d Y', null, [0,1,1,1,1,1,1], ['01-01']);
echo '<br>ten workingdays (MON-SAT) disregarding holidays: ',$ten_days; 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2016-11-18T10:33:52.353

这是另一种解决方案，它比使用 in_array 检查假期快近 25%：

```
/**
 * Function to calculate the working days between two days, considering holidays.
 * @param string $startDate -- Start date of the range (included), formatted as Y-m-d.
 * @param string $endDate -- End date of the range (included), formatted as Y-m-d.
 * @param array(string) $holidayDates -- OPTIONAL. Array of holidays dates, formatted as Y-m-d. (e.g. array("2016-08-15", "2016-12-25"))
 * @return int -- Number of working days.
 */
function getWorkingDays($startDate, $endDate, $holidayDates=array()){
    $dateRange = new DatePeriod(new DateTime($startDate), new DateInterval('P1D'), (new DateTime($endDate))->modify("+1day"));
    foreach ($dateRange as $dr) { if($dr->format("N")<6){$workingDays[]=$dr->format("Y-m-d");} }
    return count(array_diff($workingDays, $holidayDates));
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-01-19T19:16:46.833

我知道我迟到了，但我使用 Marcos J. Montes 的这套旧函数来计算假期和工作日。他花时间为复活节添加了 1876 年的算法，并添加了美国所有主要的假期。这可以很容易地为其他国家/地区更新。

```
//Usage
$days = 30;
$next_working_date = nextWorkingDay($days, $somedate);

//add date function
function DateAdd($interval, $number, $date) {

    $date_time_array = getdate($date);
    //die(print_r($date_time_array));

    $hours = $date_time_array["hours"];
    $minutes = $date_time_array["minutes"];
    $seconds = $date_time_array["seconds"];
    $month = $date_time_array["mon"];
    $day = $date_time_array["mday"];
    $year = $date_time_array["year"];

    switch ($interval) {

        case "yyyy":
            $year+=$number;
            break;
        case "q":
            $year+=($number*3);
            break;
        case "m":
            $month+=$number;
            break;
        case "y":
        case "d":
        case "w":
            $day+=$number;
            break;
        case "ww":
            $day+=($number*7);
            break;
        case "h":
            $hours+=$number;
            break;
        case "n":
            $minutes+=$number;
            break;
        case "s":
            $seconds+=$number; 
            break;            
    }
    //      echo "day:" . $day;
    $timestamp= mktime($hours,$minutes,$seconds,$month,$day,$year);
    return $timestamp;
}

// the following function get_holiday() is based on the work done by
// Marcos J. Montes
function get_holiday($year, $month, $day_of_week, $week="") {
    if ( (($week != "") && (($week > 5) || ($week < 1))) || ($day_of_week > 6) || ($day_of_week < 0) ) {
        // $day_of_week must be between 0 and 6 (Sun=0, ... Sat=6); $week must be between 1 and 5
        return FALSE;
    } else {
        if (!$week || ($week == "")) {
            $lastday = date("t", mktime(0,0,0,$month,1,$year));
            $temp = (date("w",mktime(0,0,0,$month,$lastday,$year)) - $day_of_week) % 7;
        } else {
            $temp = ($day_of_week - date("w",mktime(0,0,0,$month,1,$year))) % 7;
        }

        if ($temp < 0) {
            $temp += 7;
        }

        if (!$week || ($week == "")) {
            $day = $lastday - $temp;
        } else {
            $day = (7 * $week) - 6 + $temp;
        }
        //echo $year.", ".$month.", ".$day . "<br><br>";
        return format_date($year, $month, $day);
    }
}

function observed_day($year, $month, $day) {
    // sat -> fri & sun -> mon, any exceptions?
    //
    // should check $lastday for bumping forward and $firstday for bumping back,
    // although New Year's & Easter look to be the only holidays that potentially
    // move to a different month, and both are accounted for.

    $dow = date("w", mktime(0, 0, 0, $month, $day, $year));

    if ($dow == 0) {
        $dow = $day + 1;
    } elseif ($dow == 6) {
        if (($month == 1) && ($day == 1)) {    // New Year's on a Saturday
            $year--;
            $month = 12;
            $dow = 31;
        } else {
            $dow = $day - 1;
        }
    } else {
        $dow = $day;
    }

    return format_date($year, $month, $dow);
}

function calculate_easter($y) {
    // In the text below, 'intval($var1/$var2)' represents an integer division neglecting
    // the remainder, while % is division keeping only the remainder. So 30/7=4, and 30%7=2
//
    // This algorithm is from Practical Astronomy With Your Calculator, 2nd Edition by Peter
    // Duffett-Smith. It was originally from Butcher's Ecclesiastical Calendar, published in
    // 1876\. This algorithm has also been published in the 1922 book General Astronomy by
    // Spencer Jones; in The Journal of the British Astronomical Association (Vol.88, page
    // 91, December 1977); and in Astronomical Algorithms (1991) by Jean Meeus. 

    $a = $y%19;
    $b = intval($y/100);
    $c = $y%100;
    $d = intval($b/4);
    $e = $b%4;
    $f = intval(($b+8)/25);
    $g = intval(($b-$f+1)/3);
    $h = (19*$a+$b-$d-$g+15)%30;
    $i = intval($c/4);
    $k = $c%4;
    $l = (32+2*$e+2*$i-$h-$k)%7;
    $m = intval(($a+11*$h+22*$l)/451);
    $p = ($h+$l-7*$m+114)%31;
    $EasterMonth = intval(($h+$l-7*$m+114)/31);    // [3 = March, 4 = April]
    $EasterDay = $p+1;    // (day in Easter Month)

    return format_date($y, $EasterMonth, $EasterDay);
}

function nextWorkingDay($number_days, $start_date = "") {
    $day_counter = 0;
    $intCounter = 0;    

    if ($start_date=="") {
        $today  = mktime(0, 0, 0, date("m")  , date("d"), date("Y"));
    } else {
        $start_time = strtotime($start_date);
        $today  = mktime(0, 0, 0, date("m", $start_time)  , date("d", $start_time), date("Y", $start_time));
    }

    while($day_counter < $number_days) {
        $working_time = DateAdd("d", 1, $today);
        $working_date = date("Y-m-d", $working_date);
        if (!isWeekend($working_date) && !confirm_holiday(date("Y-m-d", strtotime($working_date))) ) {
            $day_counter++;
        }
        $intCounter++;
        $today  = $working_time;
        if ($intCounter > 1000) {
            //just in case out of control?
            break;
        }
    }

    return $working_date;
}
function isWeekend($check_date) {
    return (date("N",  strtotime($check_date)) > 5);
}
function confirm_holiday($somedate="") {
    if ($somedate=="") {
        $somedate = date("Y-m-d");
    }
    $year = date("Y", strtotime($somedate));
    $blnHoliday = false;
    //newyears
    if ($somedate == observed_day($year, 1, 1)) {
        $blnHoliday = true;
    }
    if ($somedate == format_date($year, 1, 1)) {
        $blnHoliday = true;
    }
    if ($somedate == format_date($year, 12, 31)) {
        $blnHoliday = true;
    }
    //Martin Luther King
    if ($somedate == get_holiday($year, 1, 1, 3)) {
        $blnHoliday = true;
    }
    //President's
    if ($somedate == get_holiday($year, 2, 1, 3)) {
        $blnHoliday = true;
    }
    //easter
    if ($somedate == calculate_easter($year)) {
        $blnHoliday = true;
    }
    //Memorial
    if ($somedate == get_holiday($year, 5, 1)) {
        $blnHoliday = true;
    }
    //july4
    if ($somedate == observed_day($year, 7, 4)) {
        $blnHoliday = true;
    }
    //labor
    if ($somedate == get_holiday($year, 9, 1, 1)) {
        $blnHoliday = true;
    }
    //columbus
    if ($somedate == get_holiday($year, 10, 1, 2)) {
        $blnHoliday = true;
    }
    //thanks
    if ($somedate == get_holiday($year, 11, 4, 4)) {
        $blnHoliday = true;
    }
    //xmas
    if ($somedate == format_date($year, 12, 24)) {
        $blnHoliday = true;
    }
    if ($somedate == format_date($year, 12, 25)) {
        $blnHoliday = true;
    }
    return $blnHoliday;
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-04-02T15:36:31.447

函数 get_business_days_forward_from_date($num_days, $start_date='', $rtn_fmt='Ymd') {

```
// $start_date will default to today    

if ($start_date=='') { $start_date = date("Y-m-d"); }

$business_day_ct = 0;

$max_days = 10000 + $num_days;  // to avoid any possibility of an infinite loop

// define holidays, this currently only goes to 2012 because, well, you know... ;-)
// if the world is still here after that, you can find more at
// http://www.opm.gov/Operating_Status_Schedules/fedhol/2013.asp
// always add holidays in order, because the iteration will stop when the holiday is > date being tested

$fed_holidays=array(
    "2010-01-01",
    "2010-01-18",
    "2010-02-15",
    "2010-05-31",
    "2010-07-05",
    "2010-09-06",
    "2010-10-11",
    "2010-11-11",
    "2010-11-25",
    "2010-12-24",

    "2010-12-31",
    "2011-01-17",
    "2011-02-21",
    "2011-05-30",
    "2011-07-04",
    "2011-09-05",
    "2011-10-10",
    "2011-11-11",
    "2011-11-24",
    "2011-12-26",

    "2012-01-02",
    "2012-01-16",
    "2012-02-20",
    "2012-05-28",
    "2012-07-04",
    "2012-09-03",
    "2012-10-08",
    "2012-11-12",
    "2012-11-22",
    "2012-12-25",
    );

$curr_date_ymd = date('Y-m-d', strtotime($start_date));    

for ($x=1;$x<$max_days;$x++)
{
    if (intval($num_days)==intval($business_day_ct)) { return(date($rtn_fmt, strtotime($curr_date_ymd))); }  // date found - return

    // get next day to check

    $curr_date_ymd = date('Y-m-d', (strtotime($start_date)+($x * 86400)));   // add 1 day to the current date

    $is_business_day = 1;

    // check if this is a weekend   1 (for Monday) through 7 (for Sunday)

    if ( intval(date("N",strtotime($curr_date_ymd))) > 5) { $is_business_day = 0; }

    //check for holiday
    foreach($fed_holidays as $holiday)
    {
        if (strtotime($holiday)==strtotime($curr_date_ymd))  // holiday found
        {
            $is_business_day = 0;
            break 1;
        }

        if (strtotime($holiday)>strtotime($curr_date_ymd)) { break 1; }  // past date, stop searching (always add holidays in order)

    }

    $business_day_ct = $business_day_ct + $is_business_day;  // increment if this is a business day

} 

// if we get here, you are hosed
return ("ERROR"); 
```

}

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-01-25T03:17:16.230

我只是让我的函数基于 Bobbin 和 mcgralm 代码工作，添加一些对我来说完美的东西。

```
function add_business_days($startdate,$buisnessdays,$holidays,$dateformat){
    $enddate = strtotime($startdate);
    $day = date('N',$enddate);
    while($buisnessdays > 0){ // compatible with 1 businessday if I'll need it
        $enddate = strtotime(date('Y-m-d',$enddate).' +1 day');
        $day = date('N',$enddate);
        if($day < 6 && !in_array(date('Y-m-d',$enddate),$holidays))$buisnessdays--;
    }
    return date($dateformat,$enddate);
}

// as a parameter in in_array function we should use endate formated to 
// compare correctly with the holidays array. 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2011-02-04T08:20:45.897

add_business_days 有一个小错误。使用现有函数尝试以下操作，输出将是星期六。

开始日期 = 要添加的星期五工作日 = 1 个假期数组 = 添加下一个星期一的日期。

我已经在下面的函数中解决了这个问题。

```
function add_business_days($startdate, $buisnessdays, $holidays = array(), $dateformat = 'Y-m-d'){
$i= 1;
$dayx= strtotime($startdate);
$buisnessdays= ceil($buisnessdays);

while($i < $buisnessdays)
{
    $day= date('N',$dayx);

    $date= date('Y-m-d',$dayx);
    if($day < 6 && !in_array($date,$holidays))
        $i++;

    $dayx= strtotime($date.' +1 day');
}

## If the calculated day falls on a weekend or is a holiday, then add days to the next business day
$day= date('N',$dayx);
$date= date('Y-m-d',$dayx);

while($day >= 6 || in_array($date,$holidays))
{
    $dayx= strtotime($date.' +1 day');
    $day= date('N',$dayx);
    $date= date('Y-m-d',$dayx);
}

return date($dateformat, $dayx);} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-01-14T13:08:46.103

对上面 James Pasta 提供的功能的增强，包括所有联邦假期，并更正了 7 月 4 日（上面计算为 6 月 4 日！），还包括假期名称作为数组键......

/**
* National American Holidays
* @param string $year
* @return array
*/
public static function getNationalAmericanHolidays($year) {

```
//  January 1 - New Year's Day (Observed)
//  Third Monday in January - Birthday of Martin Luther King, Jr.
//  Third Monday in February - Washington’s Birthday / President's Day
//  Last Monday in May - Memorial Day
//  July 4 - Independence Day
//  First Monday in September - Labor Day
//  Second Monday in October - Columbus Day
//  November 11 - Veterans’ Day (Observed)
//  Fourth Thursday in November Thanksgiving Day
//  December 25 - Christmas Day
$bankHolidays = array(
    ['New Years Day'] => $year . "-01-01",
    ['Martin Luther King Jr Birthday'] => "". date("Y-m-d",strtotime("third Monday of January " . $year) ),
    ['Washingtons Birthday'] => "". date("Y-m-d",strtotime("third Monday of February " . $year) ),
    ['Memorial Day'] => "". date("Y-m-d",strtotime("last Monday of May " . $year) ),
    ['Independance Day'] => $year . "-07-04",
    ['Labor Day'] => "". date("Y-m-d",strtotime("first Monday of September " . $year) ),
    ['Columbus Day'] => "". date("Y-m-d",strtotime("second Monday of October " . $year) ),
    ['Veterans Day'] => $year . "-11-11",
    ['Thanksgiving Day'] => "". date("Y-m-d",strtotime("fourth Thursday of November " . $year) ),
    ['Christmas Day'] => $year . "-12-25"
);

return $bankHolidays; 
```

}

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-06-09T03:17:28.527

刚写完一个可用于操作工作日的 API（这些解决方案都不太适合我的情况 :-)；在这里链接到它，以防其他人发现它有用。

〜内特

[计算工作日的 PHP 类](https://stackoverflow.com/questions/17006062/php-class-to-calculate-business-days/17006063#17006063)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2013-07-09T22:50:15.390

感谢 Bobbin、mcgrailm、Tony、James Pasta 和其他一些在这里发帖的人。我编写了自己的函数来将工作日添加到日期，但使用我在这里找到的一些代码对其进行了修改。这将处理周末/节假日的开始日期。这也将处理营业时间。我添加了一些注释并分解了代码以使其更易于阅读。

```
<?php
function count_business_days($date, $days, $holidays) {
    $date = strtotime($date);

    for ($i = 1; $i <= intval($days); $i++) { //Loops each day count

        //First, find the next available weekday because this might be a weekend/holiday
        while (date('N', $date) >= 6 || in_array(date('Y-m-d', $date), $holidays)){
            $date = strtotime(date('Y-m-d',$date).' +1 day');
        }

        //Now that we know we have a business day, add 1 day to it
        $date = strtotime(date('Y-m-d',$date).' +1 day');

        //If this day that was previously added falls on a weekend/holiday, then find the next business day
        while (date('N', $date) >= 6 || in_array(date('Y-m-d', $date), $holidays)){
            $date = strtotime(date('Y-m-d',$date).' +1 day');
        }
    }
    return date('Y-m-d', $date);
}

//Also add in the code from Tony and James Pasta to handle holidays...

function getNationalAmericanHolidays($year) {
$bankHolidays = array(
    'New Years Day' => $year . "-01-01",
    'Martin Luther King Jr Birthday' => "". date("Y-m-d",strtotime("third Monday of January " . $year) ),
    'Washingtons Birthday' => "". date("Y-m-d",strtotime("third Monday of February " . $year) ),
    'Memorial Day' => "". date("Y-m-d",strtotime("last Monday of May " . $year) ),
    'Independance Day' => $year . "-07-04",
    'Labor Day' => "". date("Y-m-d",strtotime("first Monday of September " . $year) ),
    'Columbus Day' => "". date("Y-m-d",strtotime("second Monday of October " . $year) ),
    'Veterans Day' => $year . "-11-11",
    'Thanksgiving Day' => "". date("Y-m-d",strtotime("fourth Thursday of November " . $year) ),
    'Christmas Day' => $year . "-12-25"
);
return $bankHolidays;

}

//Now to call it... since we're working with business days, we should
//also be working with business hours so check if it's after 5 PM
//and go to the next day if necessary.

//Go to next day if after 5 pm (5 pm = 17)
if (date(G) >= 17) {
    $start_date = date("Y-m-d", strtotime("+ 1 day")); //Tomorrow
} else {
    $start_date = date("Y-m-d"); //Today
}

//Get the holidays for the current year and also for the next year
$this_year = getNationalAmericanHolidays(date('Y'));
$next_year = getNationalAmericanHolidays(date('Y', strtotime("+12 months")));
$holidays = array_merge($this_year, $next_year);

//The number of days to count
$days_count = 10;

echo count_business_days($start_date, $days_count, $holidays);

?> 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2013-12-19T15:36:24.500

就个人而言，我认为这是一个更干净、更简洁的解决方案：

```
function onlyWorkDays( $d ) {
    $holidays = array('2013-12-25','2013-12-31','2014-01-01','2014-01-20','2014-02-17','2014-05-26','2014-07-04','2014-09-01','2014-10-13','2014-11-11','2014-11-27','2014-12-25','2014-12-31');
    while (in_array($d->format("Y-m-d"), $holidays)) { // HOLIDAYS
        $d->sub(new DateInterval("P1D"));
    }
    if ($d->format("w") == 6) { // SATURDAY
        $d->sub(new DateInterval("P1D"));
    }
    if ($d->format("w") == 0) { // SUNDAY
        $d->sub(new DateInterval("P2D"));
    }
    return $d;
} 
```

只需将建议的`new`日期发送到此功能。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2014-08-14T13:32:05.833

我刚刚创建了这个函数，它似乎工作得很好：

```
function getBusinessDays($date1, $date2){

    if(!is_numeric($date1)){
        $date1 = strtotime($date1);
    }

    if(!is_numeric($date2)){
        $date2 = strtotime($date2);
    }

    if($date2 < $date1){
        $temp_date = $date1;
        $date1 = $date2;
        $date2 = $temp_date;
        unset($temp_date);
    }

    $diff = $date2 - $date1;

    $days_diff = intval($diff / (3600 * 24));
    $current_day_of_week = intval(date("N", $date1));
    $business_days = 0;

    for($i = 1; $i <= $days_diff; $i++){
        if(!in_array($current_day_of_week, array("Sunday" => 1, "Saturday" => 7))){
            $business_days++;
        }

        $current_day_of_week++;
        if($current_day_of_week > 7){
            $current_day_of_week = 1;
        }
    }

    return $business_days;
}

echo "Business days: " . getBusinessDays("8/15/2014", "8/8/2014"); 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2015-02-02T11:34:25.143

PHPClasses 有一个很好的类，名为[PHP Working Days](http://wktareq.users.phpclasses.org/package/8982-PHP-Calculate-the-total-working-days-between-two-dates.html)。你可以看看这个类。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2019-07-24T06:40:43.397

如果您需要获取两个日期之间的时间，您可以使用[https://github.com/maximnara/business-days-counter](https://github.com/maximnara/business-days-counter)。它很简单，但现在只适用于 laravel`$diffInSeconds = $this->datesCounter->getDifferenceInSeconds(Carbon::create(2019, 1, 1), Carbon::now(), DateCounter::COUNTRY_FR);`

它不计算公共假期和周末，您可以设置工作间隔，例如从 9 到 18 与启动时间或没有。

或者，如果您只需要周末并且使用 Carbon，您可以使用内置功能：

```
$date1 = Carbon::create(2019, 1, 1)->endOfDay();
$date2 = $dt->copy()->startOfDay();
$diff = $date1->diffFiltered(CarbonInterval::minute(), function(Carbon $date) {
   return !$date->isWeekend();
}, $date2, true); 
```

但它会每隔一分钟间隔，对于位间隔可能需要一段时间。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2020-01-25T12:07:37.640

我想你可能想要包括英国假期的列表，所以这里是：

```
<?php

class ProductionDays
{

    private function getHolidays()
    {
        //from https://www.gov.uk/bank-holidays.json
        $holidaysData = '{"england-and-wales":{"division":"england-and-wales","events":[{"title":"New Year’s Day","date":"2015-01-01","notes":"","bunting":true},{"title":"Good Friday","date":"2015-04-03","notes":"","bunting":false},{"title":"Easter Monday","date":"2015-04-06","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2015-05-04","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2015-05-25","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2015-08-31","notes":"","bunting":true},{"title":"Christmas Day","date":"2015-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2015-12-28","notes":"Substitute day","bunting":true},{"title":"New Year’s Day","date":"2016-01-01","notes":"","bunting":true},{"title":"Good Friday","date":"2016-03-25","notes":"","bunting":false},{"title":"Easter Monday","date":"2016-03-28","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2016-05-02","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2016-05-30","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2016-08-29","notes":"","bunting":true},{"title":"Boxing Day","date":"2016-12-26","notes":"","bunting":true},{"title":"Christmas Day","date":"2016-12-27","notes":"Substitute day","bunting":true},{"title":"New Year’s Day","date":"2017-01-02","notes":"Substitute day","bunting":true},{"title":"Good Friday","date":"2017-04-14","notes":"","bunting":false},{"title":"Easter Monday","date":"2017-04-17","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2017-05-01","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2017-05-29","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2017-08-28","notes":"","bunting":true},{"title":"Christmas Day","date":"2017-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2017-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2018-01-01","notes":"","bunting":true},{"title":"Good Friday","date":"2018-03-30","notes":"","bunting":false},{"title":"Easter Monday","date":"2018-04-02","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2018-05-07","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2018-05-28","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2018-08-27","notes":"","bunting":true},{"title":"Christmas Day","date":"2018-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2018-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2019-01-01","notes":"","bunting":true},{"title":"Good Friday","date":"2019-04-19","notes":"","bunting":false},{"title":"Easter Monday","date":"2019-04-22","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2019-05-06","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2019-05-27","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2019-08-26","notes":"","bunting":true},{"title":"Christmas Day","date":"2019-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2019-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2020-01-01","notes":"","bunting":true},{"title":"Good Friday","date":"2020-04-10","notes":"","bunting":false},{"title":"Easter Monday","date":"2020-04-13","notes":"","bunting":true},{"title":"Early May bank holiday (VE day)","date":"2020-05-08","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2020-05-25","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2020-08-31","notes":"","bunting":true},{"title":"Christmas Day","date":"2020-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2020-12-28","notes":"Substitute day","bunting":true},{"title":"New Year’s Day","date":"2021-01-01","notes":"","bunting":true},{"title":"Good Friday","date":"2021-04-02","notes":"","bunting":false},{"title":"Easter Monday","date":"2021-04-05","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2021-05-03","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2021-05-31","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2021-08-30","notes":"","bunting":true},{"title":"Christmas Day","date":"2021-12-27","notes":"Substitute day","bunting":true},{"title":"Boxing Day","date":"2021-12-28","notes":"Substitute day","bunting":true}]},"scotland":{"division":"scotland","events":[{"title":"New Year’s Day","date":"2015-01-01","notes":"","bunting":true},{"title":"2nd January","date":"2015-01-02","notes":"","bunting":true},{"title":"Good Friday","date":"2015-04-03","notes":"","bunting":false},{"title":"Early May bank holiday","date":"2015-05-04","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2015-05-25","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2015-08-03","notes":"","bunting":true},{"title":"St Andrew’s Day","date":"2015-11-30","notes":"","bunting":true},{"title":"Christmas Day","date":"2015-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2015-12-28","notes":"Substitute day","bunting":true},{"title":"New Year’s Day","date":"2016-01-01","notes":"","bunting":true},{"title":"2nd January","date":"2016-01-04","notes":"Substitute day","bunting":true},{"title":"Good Friday","date":"2016-03-25","notes":"","bunting":false},{"title":"Early May bank holiday","date":"2016-05-02","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2016-05-30","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2016-08-01","notes":"","bunting":true},{"title":"St Andrew’s Day","date":"2016-11-30","notes":"","bunting":true},{"title":"Boxing Day","date":"2016-12-26","notes":"","bunting":true},{"title":"Christmas Day","date":"2016-12-27","notes":"Substitute day","bunting":true},{"title":"2nd January","date":"2017-01-02","notes":"","bunting":true},{"title":"New Year’s Day","date":"2017-01-03","notes":"Substitute day","bunting":true},{"title":"Good Friday","date":"2017-04-14","notes":"","bunting":false},{"title":"Early May bank holiday","date":"2017-05-01","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2017-05-29","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2017-08-07","notes":"","bunting":true},{"title":"St Andrew’s Day","date":"2017-11-30","notes":"","bunting":true},{"title":"Christmas Day","date":"2017-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2017-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2018-01-01","notes":"","bunting":true},{"title":"2nd January","date":"2018-01-02","notes":"","bunting":true},{"title":"Good Friday","date":"2018-03-30","notes":"","bunting":false},{"title":"Early May bank holiday","date":"2018-05-07","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2018-05-28","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2018-08-06","notes":"","bunting":true},{"title":"St Andrew’s Day","date":"2018-11-30","notes":"","bunting":true},{"title":"Christmas Day","date":"2018-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2018-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2019-01-01","notes":"","bunting":true},{"title":"2nd January","date":"2019-01-02","notes":"","bunting":true},{"title":"Good Friday","date":"2019-04-19","notes":"","bunting":false},{"title":"Early May bank holiday","date":"2019-05-06","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2019-05-27","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2019-08-05","notes":"","bunting":true},{"title":"St Andrew’s Day","date":"2019-12-02","notes":"Substitute day","bunting":true},{"title":"Christmas Day","date":"2019-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2019-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2020-01-01","notes":"","bunting":true},{"title":"2nd January","date":"2020-01-02","notes":"","bunting":true},{"title":"Good Friday","date":"2020-04-10","notes":"","bunting":false},{"title":"Early May bank holiday (VE day)","date":"2020-05-08","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2020-05-25","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2020-08-03","notes":"","bunting":true},{"title":"St Andrew’s Day","date":"2020-11-30","notes":"","bunting":true},{"title":"Christmas Day","date":"2020-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2020-12-28","notes":"Substitute day","bunting":true},{"title":"New Year’s Day","date":"2021-01-01","notes":"","bunting":true},{"title":"2nd January","date":"2021-01-04","notes":"Substitute day","bunting":true},{"title":"Good Friday","date":"2021-04-02","notes":"","bunting":false},{"title":"Early May bank holiday","date":"2021-05-03","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2021-05-31","notes":"","bunting":true},{"title":"Summer bank holiday","date":"2021-08-02","notes":"","bunting":true},{"title":"St Andrew’s Day","date":"2021-11-30","notes":"","bunting":true},{"title":"Christmas Day","date":"2021-12-27","notes":"Substitute day","bunting":true},{"title":"Boxing Day","date":"2021-12-28","notes":"Substitute day","bunting":true}]},"northern-ireland":{"division":"northern-ireland","events":[{"title":"New Year’s Day","date":"2015-01-01","notes":"","bunting":true},{"title":"St Patrick’s Day","date":"2015-03-17","notes":"","bunting":true},{"title":"Good Friday","date":"2015-04-03","notes":"","bunting":false},{"title":"Easter Monday","date":"2015-04-06","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2015-05-04","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2015-05-25","notes":"","bunting":true},{"title":"Battle of the Boyne (Orangemen’s Day)","date":"2015-07-13","notes":"Substitute day","bunting":false},{"title":"Summer bank holiday","date":"2015-08-31","notes":"","bunting":true},{"title":"Christmas Day","date":"2015-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2015-12-28","notes":"Substitute day","bunting":true},{"title":"New Year’s Day","date":"2016-01-01","notes":"","bunting":true},{"title":"St Patrick’s Day","date":"2016-03-17","notes":"","bunting":true},{"title":"Good Friday","date":"2016-03-25","notes":"","bunting":false},{"title":"Easter Monday","date":"2016-03-28","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2016-05-02","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2016-05-30","notes":"","bunting":true},{"title":"Battle of the Boyne (Orangemen’s Day)","date":"2016-07-12","notes":"","bunting":false},{"title":"Summer bank holiday","date":"2016-08-29","notes":"","bunting":true},{"title":"Boxing Day","date":"2016-12-26","notes":"","bunting":true},{"title":"Christmas Day","date":"2016-12-27","notes":"Substitute day","bunting":true},{"title":"New Year’s Day","date":"2017-01-02","notes":"Substitute day","bunting":true},{"title":"St Patrick’s Day","date":"2017-03-17","notes":"","bunting":true},{"title":"Good Friday","date":"2017-04-14","notes":"","bunting":false},{"title":"Easter Monday","date":"2017-04-17","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2017-05-01","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2017-05-29","notes":"","bunting":true},{"title":"Battle of the Boyne (Orangemen’s Day)","date":"2017-07-12","notes":"","bunting":false},{"title":"Summer bank holiday","date":"2017-08-28","notes":"","bunting":true},{"title":"Christmas Day","date":"2017-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2017-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2018-01-01","notes":"","bunting":true},{"title":"St Patrick’s Day","date":"2018-03-19","notes":"Substitute day","bunting":true},{"title":"Good Friday","date":"2018-03-30","notes":"","bunting":false},{"title":"Easter Monday","date":"2018-04-02","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2018-05-07","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2018-05-28","notes":"","bunting":true},{"title":"Battle of the Boyne (Orangemen’s Day)","date":"2018-07-12","notes":"","bunting":false},{"title":"Summer bank holiday","date":"2018-08-27","notes":"","bunting":true},{"title":"Christmas Day","date":"2018-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2018-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2019-01-01","notes":"","bunting":true},{"title":"St Patrick’s Day","date":"2019-03-18","notes":"Substitute day","bunting":true},{"title":"Good Friday","date":"2019-04-19","notes":"","bunting":false},{"title":"Easter Monday","date":"2019-04-22","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2019-05-06","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2019-05-27","notes":"","bunting":true},{"title":"Battle of the Boyne (Orangemen’s Day)","date":"2019-07-12","notes":"","bunting":false},{"title":"Summer bank holiday","date":"2019-08-26","notes":"","bunting":true},{"title":"Christmas Day","date":"2019-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2019-12-26","notes":"","bunting":true},{"title":"New Year’s Day","date":"2020-01-01","notes":"","bunting":true},{"title":"St Patrick’s Day","date":"2020-03-17","notes":"","bunting":true},{"title":"Good Friday","date":"2020-04-10","notes":"","bunting":false},{"title":"Easter Monday","date":"2020-04-13","notes":"","bunting":true},{"title":"Early May bank holiday (VE day)","date":"2020-05-08","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2020-05-25","notes":"","bunting":true},{"title":"Battle of the Boyne (Orangemen’s Day)","date":"2020-07-13","notes":"Substitute day","bunting":false},{"title":"Summer bank holiday","date":"2020-08-31","notes":"","bunting":true},{"title":"Christmas Day","date":"2020-12-25","notes":"","bunting":true},{"title":"Boxing Day","date":"2020-12-28","notes":"Substitute day","bunting":true},{"title":"New Year’s Day","date":"2021-01-01","notes":"","bunting":true},{"title":"St Patrick’s Day","date":"2021-03-17","notes":"","bunting":true},{"title":"Good Friday","date":"2021-04-02","notes":"","bunting":false},{"title":"Easter Monday","date":"2021-04-05","notes":"","bunting":true},{"title":"Early May bank holiday","date":"2021-05-03","notes":"","bunting":true},{"title":"Spring bank holiday","date":"2021-05-31","notes":"","bunting":true},{"title":"Battle of the Boyne (Orangemen’s Day)","date":"2021-07-12","notes":"","bunting":false},{"title":"Summer bank holiday","date":"2021-08-30","notes":"","bunting":true},{"title":"Christmas Day","date":"2021-12-27","notes":"Substitute day","bunting":true},{"title":"Boxing Day","date":"2021-12-28","notes":"Substitute day","bunting":true}]}}';

        $holidaysArray = json_decode($holidaysData, true);
        $holidays = [];
        foreach ($holidaysArray["england-and-wales"]['events'] as $event) {
            $holidays[] = $event['date'];
        }
        return $holidays;
    }

    public function getWorkingDays($dateFrom, $dateTo)
    {
        $holidays = $this->getHolidays();
        $startDate = new DateTime($dateFrom);
        $endDate = new DateTime($dateTo);
        $interval = new DateInterval('P1D');
        $dateRange = new DatePeriod($startDate, $interval, $endDate);
        $results = [];
        foreach ($dateRange as $date) {
            if ($date->format('N') < 6 && !in_array($date->format('Y-m-d'), $holidays)) {
                $results[] = $date->format("Y-m-d");
            }
        }
        return $results;
    }

}

$dateFrom = '01-01-2020';
$dateTo = '31-01-2020';

$productionDays = new ProductionDays();
$getWorkingDays = $productionDays->getWorkingDays($dateFrom, $dateTo);

echo json_encode($getWorkingDays); 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2020-10-20T21:25:55.423

尽管在撰写本文时这个问题有超过 35 个答案，但是对于这个问题有更好的解决方案。

[@flamingLogos](https://stackoverflow.com/a/336175/3399564)提供了一个基于数学且不包含任何循环的答案。该解决方案的时间复杂度为`Θ(1)`. 然而，它背后的数学非常复杂，尤其是闰年的处理。

[@Glavić](https://stackoverflow.com/a/19221403/3399564)提供了一个简洁而优雅的好解决方案。但它不会在恒定时间内执行计算，因此它可能会产生拒绝服务 (DOS) 攻击，或者如果在 10 年或 100 年这样的大周期内使用，它可能会产生拒绝服务 (DOS) 攻击，或者至少会超时，因为它以 1 天的间隔循环。

所以我提出了一种数学方法，它具有恒定的时间但非常易读。

这个想法是计算有多少天有完整的星期。

```
<?php
function getWorkingHours($start_date, $end_date) {
    // validate input
    if(!validateDate($start_date) || !validateDate($end_date)) return ['error' => 'Invalid Date'];
    if($end_date < $start_date) return ['error' => 'End date must be greater than or equal Start date'];

    //We save timezone and switch to UTC to prevent issues
    $old_timezone = date_default_timezone_get();
    date_default_timezone_set("UTC");

    $startDate = strtotime($start_date);
    $endDate = strtotime($end_date);

    //The total number of days between the two dates. We compute the no. of seconds and divide it to 60*60*24
    //We add one to include both dates in the interval.
    $days = ($endDate - $startDate) / 86400 + 1;
    $no_full_weeks = ceil($days / 7);
    //we get only missing days count to complete full weeks
    //we take modulo 7 in case it was already full weeks
    $no_of_missing_days = (7 - ($days % 7)) % 7;

    $workingDays = $no_full_weeks * 5;
    //Next we remove the working days we added, this loop will have max of 6 iterations.
    for ($i = 1; $i <= $no_of_missing_days; $i++){
        if(date('N', $endDate + $i * 86400) < 6) $workingDays--;
    }

    $holidays = getHolidays(date('Y', $startDate), date('Y', $endDate));

    //We subtract the holidays
    foreach($holidays as $holiday){
        $time_stamp=strtotime($holiday);
        //If the holiday doesn't fall in weekend
        if ($startDate <= $time_stamp && $time_stamp <= $endDate && date("N",$time_stamp) != 6 && date("N",$time_stamp) != 7)
            $workingDays--;
    }

    date_default_timezone_set($old_timezone);
    return ['days' => $workingDays];

} 
```

该函数的输入格式为`Y-m-d`php 格式或`yyyy-mm-dd`一般日期格式。

get holiday 函数将返回从开始年份到结束年份的假期日期数组。

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2012-07-26T19:54:18.073

有一个公式：

```
number_of_days - math_round_down(10 * (number_of_days / (business_days_in_a_week * days_in_a_week))) 
```

多田！你计算工作日数，一个月，一周，任何你想要的。

**math_round_down() 是一个假设的方法，它实现了一个向下舍入的数学函数。**

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2013-05-12T17:03:47.040

[https://github.com/Arbitr108/useful_php](https://github.com/Arbitr108/useful_php)这是一个可以将工作日估计为日历的类。因此，估计后只需将日历期间添加到您需要的日期

# c# - C# 4 和 CLR 兼容性

> ID：336138
> 
> 赞同：2
> 
> 时间：2008-12-03T03:16:18.800
> 
> 标签：c#, .net, clr

版本 4 的所有 C# 新增功能（动态、代码合同等）是否预计将在当前的 .NET CLR 上运行，或者是否也有计划的 .NET 升级？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T03:18:12.337

C# 4 将需要 .NET 4.0 CLR。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T05:12:50.827

那么，.NET 4.0 将需要 CLR 4.0；但是，要回答 C# 4.0 的哪些部分将在 .NET 2.0/3.x 上工作有点困难。我们可以希望 VS2010 仍然是多目标的（可以说我没有 CTP“在我身上”，所以我无法检查......）。但是一些语言特性*似乎*与运行时没有太大的关系（命名参数，一些 COM 更改，例如“ref”） - 所以我想不出一个很好的理由为什么它们在说话时不可用到 .NET 2.0/3.x。不过，我还没有检查。

但是，与 C# 3.0 一样，某些功能*与*运行时相关联 - 特别是`dynamic`.

我需要挖出 CTP 并再玩一次，我想...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T03:22:21.780

您不必等待 4.0 使用代码合同，因为它在 .NET 3.5 上运行，学术预览版的下载链接在[这里](http://research.microsoft.com/contracts/#downloads)。

# java - 使用 maven 构建一个 scala 应用程序（其中混入了 java 源代码）

> ID：336144
> 
> 赞同：63
> 
> 时间：2008-12-03T03:22:04.963
> 
> 标签：java, maven-2, scala

我有一个应用程序，我想混合 Java 和 Scala 源代码（实际上是将 Java 应用程序迁移到 scala - 但一次一点）。

我可以在 IDE 中很好地完成这项工作，非常好。但是我不确定如何使用 maven 来做到这一点 - scalac 可以编译 java 和 scala 交织在一起，但是如何为模块设置 maven？

另外，我的 scala 源是否必须是与 java 不同的文件夹？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-16T03:23:50.337

使用 maven scala 插件，像下面这样的配置将适用于混合 java 和 scala 源的项目（scala 源当然在 /scala 目录中，正如其他人所提到的）。

您可以运行 run mvn compile、test 等...并且一切都会正常工作。非常好（它会首先自动运行 scalac）。

对于一个出色的 IDE，IntelliJ 8 工作得很好：添加 scala 插件，然后添加一个 scala facet，然后调整 scala 的编译设置以首先运行 scalac（如果您与 scala 和 java 源有循环依赖关系，这很重要）。

```
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
<modelVersion>4.0.0</modelVersion>
<groupId>demo</groupId>
<artifactId>scala-java-app</artifactId>
<version>0.0.1-SNAPSHOT</version>
<packaging>jar</packaging>
<name>scala-java-app</name>
<repositories>
    <repository>
        <id>scala-tools.org</id>
        <name>Scala-tools Maven2 Repository</name>
        <url>http://scala-tools.org/repo-releases</url>
    </repository>
</repositories>
<pluginRepositories>
    <pluginRepository>
        <id>scala-tools.org</id>
        <name>Scala-tools Maven2 Repository</name>
        <url>http://scala-tools.org/repo-releases</url>
    </pluginRepository>
</pluginRepositories>
<build>
    <plugins>
        <plugin>
            <groupId>org.scala-tools</groupId>
            <artifactId>maven-scala-plugin</artifactId>
            <executions>

                <execution>
                    <id>compile</id>
                    <goals>
                        <goal>compile</goal>
                    </goals>
                    <phase>compile</phase>
                </execution>
                <execution>
                    <id>test-compile</id>
                    <goals>
                        <goal>testCompile</goal>
                    </goals>
                    <phase>test-compile</phase>
                </execution>
                <execution>
                   <phase>process-resources</phase>
                   <goals>
                     <goal>compile</goal>
                   </goals>
                </execution>
            </executions>
        </plugin>
        <plugin>
            <artifactId>maven-compiler-plugin</artifactId>
            <configuration>
                <source>1.5</source>
                <target>1.5</target>
            </configuration>
        </plugin>
    </plugins>  
</build>
<dependencies>
    <dependency>
        <groupId>org.scala-lang</groupId>
        <artifactId>scala-library</artifactId>
        <version>2.7.2</version>
    </dependency>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>3.8.1</version>
        <scope>test</scope>
    </dependency>
</dependencies> 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-03T04:04:37.937

是的，scala 部分必须在一个单独的模块和`src/main/scala`目录中。Maven 将这样的混合源视为异端。

您可以通过导入[scala maven 插件](http://scala-tools.org/mvnsites/maven-scala-plugin/)来启用 scala 编译。“[使用”](http://scala-tools.org/mvnsites/maven-scala-plugin/usage.html)页面就是一个很好的例子。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-03T07:13:04.233

我曾经问过一个[非常相似的问题](https://stackoverflow.com/questions/174171/including-non-java-sources-in-a-maven-project)，关于如何在 Maven 项目中包含非 Java 代码。答案的要点是在 src 下为每种编程语言创建一个不同的目录，并找到/编写一个 Maven 插件，该插件会知道如何处理每种语言。例如：

```
src/
|-- main
|   |-- bin
|   |-- sh
|   |-- sql
|   |-- scala
|   |-- java
|   `-- resources
|-- site
... 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-08-04T13:48:53.177

查看 Sonatype Maven Cookbook [第 3 章。Scala 和 Maven](http://www.sonatype.com/books/mcookbook/reference/scala.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T09:59:10.107

前段时间，我通过一个用 Scala 编写的 Maven 模块和另一个用 Java 编写的 Maven 模块解决了这个问题。但是由于 Scala 和 Java 可以相互依赖（Java -> Scala -> Java 或其他方式），因此在没有多模块项目的情况下这是非常理想的。

[解决此问题的工作正在进行中，您可以在此处](http://www.nabble.com/-scala-tools--Maven-plugin-for-project-with-mixed-java-and-scala-source-td20806619.html)阅读相关内容，并且很快就会发布新版本的 maven-scala-plugin。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-05-06T13:49:56.690

这是我使用 scala、java 和 mongo db 完成的一个小项目链接（[https://github.com/mebinjacob/mongo-scala-java-maven-poc ）。](https://github.com/mebinjacob/mongo-scala-java-maven-poc)

注意在项目的 pom.xml 中可以指定 scala 文件的源文件夹，它可以与 java 的源文件夹相同，也可以是 src/main/scala 等不同的文件夹。没有要求 scala 类位于单独的 src 文件夹中。我已经尝试过他们两个，他们都工作得很好。我所指的 pom 的片段是

```
 <build>
    <plugins>
        <plugin>
            <groupId>org.scala-tools</groupId>
            <artifactId>maven-scala-plugin</artifactId>
            <executions>
                <execution>
                    <goals>
                        <goal>compile</goal>
                        <goal>testCompile</goal>
                    </goals>
                </execution>
            </executions>
            <configuration>
                <sourceDir>src/main/scala</sourceDir>
                <jvmArgs>
                    <jvmArg>-Xms64m</jvmArg>
                    <jvmArg>-Xmx1024m</jvmArg>
                </jvmArgs>
            </configuration>
        </plugin>
    </plugins>
</build> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-03-21T10:11:17.960

您需要结合多种方法才能自由混合 scala 和 java 类。这个解决方案对我有用：

```
 <properties>
        <maven.compiler.source>1.7</maven.compiler.source>
        <maven.compiler.target>1.7</maven.compiler.target>
        <!-- <encoding>UTF-8</encoding> -->
        <scala.tools.version>2.10</scala.tools.version>
        <scala.version>2.10.3</scala.version>
    </properties>
<build>
        <sourceDirectory>src/main/scala</sourceDirectory>
        <testSourceDirectory>src/test/scala</testSourceDirectory>
        <plugins>
            <plugin>
                <groupId>org.scala-tools</groupId>
                <artifactId>maven-scala-plugin</artifactId>
                <version>2.15.2</version>
                <executions>                    
                    <execution>
                        <id>scala-compile-first</id>
                        <phase>process-resources</phase>
                        <goals>
                            <goal>compile</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>scala-test-compile</id>
                        <phase>process-test-resources</phase>
                        <goals>
                            <goal>testCompile</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>

            <plugin>                
                <groupId>net.alchim31.maven</groupId>
                <artifactId>scala-maven-plugin</artifactId>
                <version>3.1.3</version>
                <executions>
                    <execution>
                        <goals>
                            <goal>compile</goal>
                            <goal>testCompile</goal>
                        </goals>
                        <configuration>
                            <args>
                                <arg>-make:transitive</arg>
                                <arg>-dependencyfile</arg>
                                <arg>${project.build.directory}/.scala_dependencies</arg>
                            </args>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>2.13</version>
                <configuration>
                    <useFile>false</useFile>
                    <disableXmlReport>true</disableXmlReport>               
                    <includes>
                        <include>**/*Test.*</include>
                        <include>**/*Suite.*</include>
                    </includes>
                </configuration>
            </plugin>       
        </plugins>
    </build> 
```

# java - Java TreeMap 排序选项？

> ID：336148
> 
> 赞同：5
> 
> 时间：2008-12-03T03:26:19.387
> 
> 标签：java, binary-tree, red-black-tree

有人告诉我，Java 类 TreeMap 使用了 RB 树的实现。如果是这种情况，如何在 TreeMap 上进行中序、前序和后序树遍历？

或者这是不可能的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T03:45:52.327

使用 Collections 库中实现的 TreeMap 将无法做到这一点。这是Java中[红黑树](https://www.java-tips.org/java-se-tips-100019/24-java-lang/1904-red-black-tree-implementation-in-java.html)的实现，您可以查看。查看这些`printTree()`方法以了解它们如何按排序顺序遍历树。

```
/**
 * Print all items.
 */
public void printTree( ) {
    printTree( header.right );
}

/**
 * Internal method to print a subtree in sorted order.
 * @param t the node that roots the tree.
 */
private void printTree( RedBlackNode t ) {
    if( t != nullNode ) {
        printTree( t.left );
        System.out.println( t.element );
        printTree( t.right );
    }
} 
```

从那里也许您可以编写自己的方法以所有三个顺序遍历树。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T03:35:25.233

AFAIK TreeSet/TreeMap 类实际上并没有公开它们的任何内部结构，只是符合 Set/Map 接口。迭代器只保证按升序排列。

我有点困惑为什么要按顺序扫描这些节点，因为这些树的目标不是表示对象之间的关系（例如，数学公式），而只是存储所有对象并有效地检索它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T21:38:41.553

您至少可以使用迭代器和 for each 循环进行中序遍历：

```
void inOrderWalk(TreeMap<K,V> treeMap) {
   //this will loop through the values in the map in sorted order (inorder traversal)
   for (Map.Entry<K,V> entry : treeMap.entrySet() {
        V value = entry.getValue();
        K key = entry.getKey()
   }
} 
```

但是，其他海报是正确的：Java 没有公开任何树机制，因此在此视图中不可能进行预排序或后排序。

# language-agnostic - 如何将网站从一个网址移动到另一个网址？

> ID：336179
> 
> 赞同：2
> 
> 时间：2008-12-03T04:00:25.527
> 
> 标签：language-agnostic

我有一个托管在 DiscountASP.NET 上的 ASP.NET Web 应用程序，其域名在 GoDaddy 上注册。这个网站运行良好，运行良好，但我讨厌这个域名。

所以现在，我决定购买一个我更喜欢的域名。如何设置它，以便此域名与我的原始应用程序运行相同的 Web 应用程序，但使用新域名而不是旧域名（即我不想重定向到旧网址，我希望一切都在新网址下工作）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T04:13:19.527

这应该很简单。转到新域的主机/注册商，并将其指向与 godaddy url 指向的相同 IP 地址。

您可以让旧 url 和新 url 并存。DNS 服务器只是映射到您的应用程序所在的物理 IP。

如果你一直在调皮并在你的应用程序中使用绝对 urls/目录，你将不得不重写一些代码。一直在念诵咒语……这就是为什么我应该使用相对引用的原因……

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T04:03:50.230

要么移动应用程序文件并创建从旧 URL 到新 URL 的重定向，要么在新 URL 下设置重写以透明地将请求传递给现有 URL。

# python - Python：无效的令牌

> ID：336181
> 
> 赞同：15
> 
> 时间：2008-12-03T04:01:12.937
> 
> 标签：python, octal

你们中的一些人可能认为这是欧拉计划的第 11 号问题。带有网格的问题。

我试图在一个大型多维数组中复制网格，但它给了我一个语法错误，我不知道为什么

```
grid = [ 
[ 08, 02, 22, 97, 38, 15, 00, 40, 00, 75, 04, 05, 07, 78, 52, 12, 50, 77, 91, 08 ],
[ 49, 49, 99, 40, 17, 81, 18, 57, 60, 87, 17, 40, 98, 43, 69, 48, 04, 56, 62, 00 ],
[ 81, 49, 31, 73, 55, 79, 14, 29, 93, 71, 40, 67, 53, 88, 30, 03, 49, 13, 36, 65 ],
... 
```

我得到这个错误：

```
  文件“D:\development\Python\ProjectEuler\p11.py”，第 3 行
    [08、02、22、97、38、15、00、40、00、75、04、05、07、78、52、12、50、77、91、08]，
       ^ 语法错误：无效标记

```

为什么在逗号前抛出错误？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-12-03T04:04:50.870

我认为，当您以 0 开头的文字数字时，它会将其解释为八进制数，而八进制数中不能有“8”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T04:42:41.353

请注意，错误中的“^”符号正好指向错误的列。连同行号，它正好指向数字 8。这可以帮助您了解 Jeremy 的建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T16:14:45.060

只需删除前导零。

第一个零使数字八进制。

# asp.net-mvc - Can I precompile my ASP.NET MVC application?

> ID：336205
> 
> 赞同：13
> 
> 时间：2008-12-03T04:20:39.310
> 
> 标签：asp.net-mvc

I tried to precompile my ASP.NET MVC application and deploy it to an IIS6 box (with wildcard mapping), however I am getting an error with rendering partial views (user controls). Its working fine on my dev machine before precompiling.

The error is:

> Server Error in '/' Application.
> 
> The partial view 'ListGrid' could not
> be found. The following locations were
> searched:
> ~/Views/Initiative/ListGrid.aspx
> ~/Views/Initiative/ListGrid.ascx
> ~/Views/Shared/ListGrid.aspx
> ~/Views/Shared/ListGrid.ascx

I checked Views\Shared for the file and it was not there, which I thought was normal because its precompiled. But just for giggles I put a blank file in that folder names ListGrid.ascx, but then I got this error:

> Server Error in '/' Application.
> 
> The file '/Views/Shared/ListGrid.ascx'
> has not been pre-compiled, and cannot
> be requested.

I googled and searched SO but could not find any similar problems, but had no luck.

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-12-20T21:39:37.127

You can precompile an MVC app by placing this in the post-build actions in project properties:

```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\aspnet_compiler -p "$(ProjectDir)." -v /$(ProjectName) 
```

This takes a little longer than without it, however you get the added ability to detect some errors that would occur at runtime prior to deployment.

Compilation will fail if you have invalid code in your views or are missing views by using this method.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-04T19:45:47.223

Although you can precompile an MVC site the ascx and aspx view files are not in the compiled dll only the .cs files are. You will still need to deploy the .aspx and .ascx view files.

Hope this helps

# regex - 字母数字和下划线的正则表达式

> ID：336210
> 
> 赞同：716
> 
> 时间：2008-12-03T04:25:27.113
> 
> 标签：regex

我想要一个正则表达式来检查字符串是否只包含大小写字母、数字和下划线。

* * *

## 回答 #1

> 赞同：1117
> 
> 时间：2008-12-03T04:33:50.717

*要匹配仅*包含这些字符（或空字符串）的字符串，请尝试

```
"^[a-zA-Z0-9_]*$" 
```

这适用于 .NET 正则表达式，可能也适用于许多其他语言。

分解它：

```
^ : start of string
[ : beginning of character group
a-z : any lowercase letter
A-Z : any uppercase letter
0-9 : any digit
_ : underscore
] : end of character group
* : zero or more of the given characters
$ : end of string 
```

如果您不想允许空字符串，请使用`+`代替`*`.

* * *

正如其他人指出的那样，一些正则表达式语言有`[a-zA-Z0-9_]`. 在 .NET 正则表达式语言中，您可以打开 ECMAScript 行为并`\w`用作简写（yielding`^\w*$`或`^\w+$`）。请注意，在其他语言中，默认情况下在 .NET 中，`\w`范围更广，并且也会匹配其他类型的 Unicode 字符（感谢 Jan 指出这一点）。因此，如果您真的打算**只**匹配这些字符，那么使用显式（更长）形式可能是最好的。

* * *

## 回答 #2

> 赞同：415
> 
> 时间：2008-12-05T05:25:04.043

这里有很多冗长，我强烈反对，所以，我的结论性答案是：

```
/^\w+$/ 
```

`\w`相当于`[A-Za-z0-9_]`，这几乎是你想要的。（除非我们在混合中引入 unicode）

使用`+`量词，您将匹配一个或多个字符。如果您也想接受空字符串，请`*`改用。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2008-12-03T05:08:09.307

您想检查每个字符是否符合您的要求，这就是我们使用的原因：

```
[A-Za-z0-9_] 
```

你甚至可以使用速记版本：

```
\w 
```

这是等效的（在某些正则表达式中，因此请确保在使用之前进行检查）。然后要指示整个字符串必须匹配，请使用：

```
^ 
```

要指示字符串必须以该字符开头，然后使用

```
$ 
```

指示字符串必须以该字符结尾。然后使用

```
\w+ or \w* 
```

表示“1 或更多”，或“0 或更多”。综上所述，我们有：

```
^\w*$ 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2012-06-09T22:53:02.047

虽然它比 更冗长`\w`，但我个人很欣赏完整的 POSIX 字符类名称 ( [http://www.zytrax.com/tech/web/regex.htm#special](http://www.zytrax.com/tech/web/regex.htm#special) ) 的可读性，所以我想说：

```
^[[:alnum:]_]+$ 
```

但是，虽然上述链接中的文档声明`\w`将“匹配 0 - 9、A - Z 和 a - z 范围内的任何字符（相当于 POSIX [:alnum:]）”，但我还没有发现这是真的. `grep -P`反正也不用。如果您使用，则需要明确包含下划线，`[:alnum:]`但如果您使用，则不需要`\w`。您无法轻松击败以下内容：

```
^\w+$ 
```

除了可读性，使用 POSIX 字符类 ( [http://www.regular-expressions.info/posixbrackets.html](http://www.regular-expressions.info/posixbrackets.html) ) 意味着您的正则表达式可以处理非 ASCII 字符串，而基于范围的正则表达式不会这样做，因为它们依赖ASCII 字符的基本顺序可能与其他字符集不同，因此会排除您可能想要捕获的一些非 ASCII 字符（如 –）。

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2008-12-03T04:31:41.267

嗯...问题：它是否需要至少有一个字符？可以是空字符串吗？

```
^[A-Za-z0-9_]+$ 
```

将至少使用一个大写或小写字母数字或下划线。如果它可以是零长度，那么只需将 + 替换为 *

```
^[A-Za-z0-9_]*$ 
```

编辑：

如果需要包含变音符号（例如 cedilla - ç），那么您需要使用与上述相同的单词 character，但包含变音符号：

```
^\w+$ 
```

或者

```
^\w*$ 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2008-12-03T04:31:17.227

怎么样：

```
^([A-Za-z]|[0-9]|_)+$ 
```

...如果你想明确，或者：

```
^\w+$ 
```

...如果您喜欢简洁（Perl 语法）。

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2012-01-31T13:38:39.350

在计算机科学中，字母数字值通常意味着第一个字符不是数字，而是字母或下划线。此后，字符可以是`0-9`、`A-Z`、`a-z`或下划线 ( `_`)。

以下是您将如何执行此操作：

在php下测试：

```
$regex = '/^[A-Za-z_][A-Za-z\d_]*$/' 
```

或者拿这个

```
^[A-Za-z_][A-Za-z\d_]*$ 
```

并将其放在您的开发语言中。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2010-11-12T18:20:07.933

使用前瞻来做“至少一个”的事情。相信我，这要容易得多。

这是一个需要 1-10 个字符的示例，其中至少包含一个数字和一个字母：

```
^(?=.*\d)(?=.*[A-Za-z])[A-Za-z0-9]{1,10}$ 
```

注意：本可以使用 \w 但随后 ECMA/Unicode 考虑开始发挥作用，增加了 \w “单词字符”的字符覆盖率。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2020-06-08T13:33:35.297

这对我有用，在 O'Reilly 的“掌握正则表达式”中找到了这个：

```
/^\w+$/ 
```

解释：

*   ^ 断言字符串开头的位置
    *   \w+ 匹配任何单词字符（等于 [a-zA-Z0-9_]）
    *   “+”量词——匹配一次到无限次，尽可能多次，根据需要回馈（贪婪）
*   $ 断言字符串末尾的位置

验证自己：

```
const regex = /^\w+$/;
const str = `nut_cracker_12`;
let m;

if ((m = regex.exec(str)) !== null) {
    // The result can be accessed through the `m`-variable.
    m.forEach((match, groupIndex) => {
        console.log(`Found match, group ${groupIndex}: ${match}`);
    });
}
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2012-01-11T00:52:41.163

试试我为字符串制作的这些多语言扩展。

IsAlphaNumeric - 字符串必须包含至少 1 个 alpha（Unicode 范围内的字母，在 charSet 中指定）和至少 1 个数字（在 numSet 中指定）。此外，字符串应仅包含字母和数字。

IsAlpha - 字符串应包含至少 1 个 alpha（在指定的语言 charSet 中）并且仅包含 alpha。

IsNumeric - 字符串应包含至少 1 个数字（在指定的语言 numSet 中）并且仅包含数字。

可以指定所需语言的 charSet/numSet 范围。Unicode 范围可在以下链接中找到：

[http://www.ssec.wisc.edu/~tomw/java/unicode.html](http://www.ssec.wisc.edu/~tomw/java/unicode.html)

接口：

```
 public static bool IsAlphaNumeric(this string stringToTest)
    {
        //English
        const string charSet = "a-zA-Z";
        const string numSet = @"0-9";

        //Greek
        //const string charSet = @"\u0388-\u03EF";            
        //const string numSet = @"0-9";

        //Bengali
        //const string charSet = @"\u0985-\u09E3";
        //const string numSet = @"\u09E6-\u09EF";

        //Hindi
        //const string charSet = @"\u0905-\u0963";
        //const string numSet = @"\u0966-\u096F";

        return Regex.Match(stringToTest, @"^(?=[" + numSet + @"]*?[" + charSet + @"]+)(?=[" + charSet + @"]*?[" + numSet + @"]+)[" + charSet + numSet +@"]+$").Success;
    }

    public static bool IsNumeric(this string stringToTest)
    {
        //English
        const string numSet = @"0-9";

        //Hindi
        //const string numSet = @"\u0966-\u096F";

        return Regex.Match(stringToTest, @"^[" + numSet + @"]+$").Success;
    }

    public static bool IsAlpha(this string stringToTest)
    {
        //English
        const string charSet = "a-zA-Z";

        return Regex.Match(stringToTest, @"^[" + charSet + @"]+$").Success;
    } 
```

用法 ：

```
 //English
        string test = "AASD121asf";

        //Greek
        //string test = "Ϡϛβ123";

        //Bengali
        //string test = "শর৩৮";

        //Hindi
        //string test = @"क़लम३७ख़";

        bool isAlphaNum = test.IsAlphaNumeric(); 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-12-03T04:31:51.220

以下正则表达式匹配字母数字字符和下划线：

```
^[a-zA-Z0-9_]+$ 
```

例如，在 Perl 中：

```
#!/usr/bin/perl -w

my $arg1 = $ARGV[0];

# check that the string contains *only* one or more alphanumeric chars or underscores
if ($arg1 !~ /^[a-zA-Z0-9_]+$/) {
  print "Failed.\n";
} else {
    print "Success.\n";
} 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2019-12-24T06:06:18.677

这应该适用于大多数情况。

`/^[\d]*[a-z_][a-z\d_]*$/gi`

我的意思是，

```
abcd       True
abcd12     True
ab12cd     True
12abcd     True

1234       False 
```

### 解释

1.  `^ ... $`- 匹配开始和结束的模式
2.  `[\d]*`- 匹配零个或多个数字
3.  `[a-z_]`- 匹配字母或下划线
4.  `[a-z\d_]*`- 匹配字母或数字或下划线
5.  `/gi`- 跨字符串全局匹配且不区分大小写

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2012-04-03T14:57:40.090

对于那些寻找 unicode 字母数字匹配的人，您可能想要执行以下操作：

```
^[\p{L} \p{Nd}_]+$ 
```

进一步阅读 [http://unicode.org/reports/tr18/](http://unicode.org/reports/tr18/) 和 [http://www.regular-expressions.info/unicode.html](http://www.regular-expressions.info/unicode.html)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2010-06-24T09:25:57.363

对我来说，有一个问题是我想区分字母、数字和字母数字，因此为了确保字母数字字符串包含至少一个字母和至少一个数字，我使用了：

```
^([a-zA-Z_]{1,}\d{1,})+|(\d{1,}[a-zA-Z_]{1,})+$ 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-12-03T04:44:06.577

这是您希望使用量词指定至少 1 个字符且不超过 255 个字符的正则表达式

```
[^a-zA-Z0-9 _]{1,255} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2019-02-08T14:08:05.857

我相信您在比赛中没有使用拉丁字符和 Unicode 字符。例如，如果您需要使用 "ã" 或 "ü" 字符，则使用 "\w" 将不起作用。

或者，您可以使用这种方法：

```
^[A-ZÀ-Ýa-zà-ý0-9_]+$ 
```

希望能帮助到你！

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2021-03-06T12:42:09.250

对于 Java，只允许不区分大小写的字母数字和下划线。

*   ^ 匹配以任意字符开头的字符串
*   [a-zA-Z0-9_]+ 匹配字母数字字符和下划线。
*   $ 匹配以零个或多个字符结尾的字符串。

> ```
> public class RegExTest {
>     public static void main(String[] args) {
>         System.out.println("_C#".matches("^[a-zA-Z0-9_]+$"));
>     }
> } 
> ```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-03T04:33:10.423

要检查整个字符串并且不允许空字符串，请尝试

```
^[A-Za-z0-9_]+$ 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-11-14T15:50:30.300

`^\w*$`适用于以下组合

```
1
123
1av
pRo
av1 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-05-20T13:02:51.253

这对我有用，你可以试试

```
[\\p{Alnum}_] 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-10-13T10:46:00.317

所需格式 允许以下 3 个：

1.  0142171547295
2.  014-2171547295
3.  123abc

不允许其他格式：

```
validatePnrAndTicketNumber(){
    let alphaNumericRegex=/^[a-zA-Z0-9]*$/;
    let numericRegex=/^[0-9]*$/;
    let numericdashRegex=/^(([1-9]{3})\-?([0-9]{10}))$/;
   this.currBookingRefValue = this.requestForm.controls["bookingReference"].value;
   if(this.currBookingRefValue.length == 14 && this.currBookingRefValue.match(numericdashRegex)){
     this.requestForm.controls["bookingReference"].setErrors({'pattern': false});
   }else if(this.currBookingRefValue.length ==6 && this.currBookingRefValue.match(alphaNumericRegex)){
    this.requestForm.controls["bookingReference"].setErrors({'pattern': false});
   }else if(this.currBookingRefValue.length ==13 && this.currBookingRefValue.match(numericRegex) ){
    this.requestForm.controls["bookingReference"].setErrors({'pattern': false});
   }else{
    this.requestForm.controls["bookingReference"].setErrors({'pattern': true});
   }
} 
```

```
<input name="booking_reference" type="text" [class.input-not-empty]="bookingRef.value"
    class="glyph-input form-control floating-label-input" id="bookings_bookingReference"
    value="" maxlength="14" aria-required="true" role="textbox" #bookingRef
    formControlName="bookingReference" (focus)="resetMessageField()" (blur)="validatePnrAndTicketNumber()"/> 
```

# visual-studio - 您最喜欢但不太明显的 Visual Studio 2008 提示和技巧是什么？

> ID：336218
> 
> 赞同：3
> 
> 时间：2008-12-03T04:32:30.033
> 
> 标签：visual-studio

问题的细微差别是 Visual Studio 环境的哪些功能，不是每个人都知道，您已经开始依赖并且您希望其他人知道。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T06:45:52.697

我建议您查看 PDC 2008 的 TL46 会话网络广播：Microsoft Visual C# IDE：提示和技巧。演讲者指出了一些不明显的事情，还谈到了最近发布的免费“快速”版本的 CodeRush 以及它可以做的一些事情。

[http://channel9.msdn.com/pdc2008/TL46/](http://channel9.msdn.com/pdc2008/TL46/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T06:56:50.147

我发现的最佳技巧来自 Sara Ford 的博客 - [Visual Studio (2005-2010) 的隐藏功能？](https://stackoverflow.com/questions/100420/hidden-features-of-visual-studio-2005-2008#100457)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T04:42:25.410

Control+minus : 回到之前的编辑位置。如果您因查找符号声明或搜索字符串而暂时离开编辑位置，这将特别有用。它也适用于文件之间。Control+Shift+减号以相反的方向访问编辑器位置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T04:43:06.067

在调试会话期间拖动源窗口中的当前位置标记以跳过语句或重新执行语句。在调试器中，黄色的“当前语句”箭头是可拖动的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T04:43:49.090

在 C++ 中，一个非常方便的事情是打开“代码定义窗口”。因此，无论您正在编辑什么 .cpp 文件，相应的 .h 窗口都会显示在这个额外的窗口中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-03T04:50:47.140

Ctrl + 。自动显示智能标签，所以 Ctrl +。然后回车将快速打开并使用智能标签值。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-03T05:00:07.280

Ctrl + K + C 注释掉一个选择

Ctrl + K + U 取消注释选择

Ctrl + 。用于智能标签

Ctrl + 空格调出智能感知

我也喜欢使用 prop 和 foreach 代码片段。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-03T06:52:48.550

Ctrl + K + F 格式化选择。
修复了我所有糟糕的缩进混乱。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-30T10:50:50.377

Ctrl + Alt 和鼠标选择允许垂直选择字符。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-03T04:42:44.677

能够卸载项目，然后使用文本编辑器对其进行编辑。为此，您可以右键单击一个项目并选择“卸载项目”，然后右键单击该项目并选择“编辑项目”。有时编辑项目文件的文本比使用 gui 执行操作更快。例如，必须将一长串引用从一个项目复制到另一个项目。编辑完成后，右键单击项目并选择“加载项目”以返回正常的项目视图。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-03T04:50:30.857

使用 将书签留在代码中`Ctrl + K + K`，然后您可以使用 导航到下一个书签，使用 导航到上一个`CTRL + K + N`书签 `CTRL + K + P`。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-03T04:52:10.133

使用 Ctrl+I 进行交互式搜索非常适合快速搜索文件。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-03T06:40:24.363

突出显示 VS 2008 中的所有 using 语句，然后转到 Edit -> IntelliSense -> Organize Usings -> Remove Unused Usings :-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-03T13:58:09.550

安装 R# ;-)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-03T14:06:45.867

Ctrl+K、Ctrl+C 注释掉选定的文本块。Ctrl+K、Ctrl+U 取消注释文本。

无价。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-28T00:52:22.067

Ctrl K + D，格式化代码隐藏和 HTML（缩进等）

这是我最喜欢的新把戏。

另外，我经常使用 ctrl + m + o，这会折叠所有方法。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-12-03T04:43:26.143

使用即时窗口在调试器中以交互方式执行 C# 语句。您可以在调试器的即时窗口中键入语句，它将在当前语句的上下文中执行它们。当然，只有在当前语句的上下文中有意义的语句才会执行。

# php - 如何创建特定对象的数组？

> ID：336225
> 
> 赞同：2
> 
> 时间：2008-12-03T04:38:55.387
> 
> 标签：php, foreach

好吧，我是 PHP 中的 OOP 新手，正在尝试用它编写一个站点。该站点是一个基本的 Flash 游戏站点，并具有跟踪游戏的类别。我的第一步是创建一个基本的 MVC 设置并列出所有类别。问题是我不知道如何创建一个包含所有类别的数组。我可以将它添加到控制器吗？我应该向模型添加新方法吗？告诉我，代码如下。

**index.php**（控制器）

```
<?php
    require_once 'database.php';
    require_once 'models/category.php';

    if (isset($_GET['page']))
    {
    }
    else
    { //display home page
        require_once 'views/home.php';
    }
?> 
```

**模型/category.php**（模型）

```
<?php
    class Category
    {
        private $id,$name;

        function __construct($id)
        {
            $category_query = $database_connection->prepare('SELECT id,name FROM categories WHERE id=?');
            $category_query->execute(array($id));
            $category = $category_query->fetch();

            $this->id = $category['id'];
            $this->name = $category['name'];
        }

        function get_id()
        {
            return $this->id;
        }

        function get_name()
        {
            return $this->name;
        }
    }
?> 
```

**视图/home.php**（视图）

```
List of all categories:
<ul>
<?php foreach ($all_categories as $category) { ?>
    <li><?php echo $category->get_name(); ?> (ID: <?php echo $category->get_id(); ?>)</li>
<?php } ?>
</ul> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T05:04:52.887

很简单，您只是缺少将它们组合在一起的胶水。这通常被描述为“业务逻辑”。您当前拥有的“模型”实际上是您的数据存储层。您的模型需要使用它来向控制器返回它需要提供给视图的内容。

在代码中，您有几种选择。一种方法是让控制器使用您必须组装视图想要使用的数组的数据类。如果没有其他控制器需要这样做，这是最好的。另一种解决方案是添加一些模型代码来做到这一点。这使得其他控制器能够调用相同的模型来获取相同的数据，但是如果您有其他类需要相同的过程，您将重复代码。第三种解决方案是扩展您的数据模型以提供集合视图。然后模型代码成为控制器想要什么样的集合和向数据模型询问它之间的一个简单的转换层。它甚至可能很简单，可以留在控制器中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T05:15:20.557

就像 Staticsan 所说的，有很多地方可以放置它，并且有很多关于它的书籍。我会改变构造函数，这样如果你不给它参数，它就不会查询。然后我会使用一个静态方法，它自己查询所有类别（或某个子集），然后组装一个 Category 对象数组以返回......

可能更好的是编写一个名为 CategoryFactory 的类，它只负责制作和返回这些对象。从那里（或从静态方法工厂）你可以确保你只做一个查询。

MVC 并不是 Web 应用程序架构的全部，Fowler 和 Alur 等人进入了阴暗的细节。

# c# - C#中字符串到日期时间的转换

> ID：336226
> 
> 赞同：7
> 
> 时间：2008-12-03T04:39:25.790
> 
> 标签：c#

愚蠢的问题，但无法理解...我有一个这种格式的字符串 20081119

我有一个 C# 方法将字符串转换为 DateTime 以输入到 SQL Server DB

```
public static DateTime MyDateConversion(string dateAsString)
    {

        return System.DateTime.ParseExact(dateAsString, "yyyyMMdd", System.Globalization.CultureInfo.CurrentCulture);

    } 
```

问题是日期是这样出来的：Date = 19/11/2008 12:00:00 AM，我需要它是 yyyyMMdd 类型的 DateTime，因为我将它映射到一个模式以调用存储过程。

提前谢谢各位。

干杯，骗局

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-03T04:53:44.577

没有“yyyyMMdd 类型的 DateTime”之类的东西；DateTime 只是一个大整数，表示一个纪元中的时间量 - 它没有格式。但这很好，因为无论如何您都应该使用参数化 TSQL - 所以只需添加 DateTime 作为 DbParameter 的值，它将以明确的方式传递给数据库（不要使用字符串连接来构建 TSQL 命令):

```
DbParameter param = cmd.CreateParameter();
param.ParameterName = "@foo";
param.DbType = DbType.DateTime;
param.Value = yourDateTime; // the DateTime returned from .ParseExact
cmd.Parameters.Add(param); 
```

或对于`SqlCommand`：

```
cmd.Parameters.Add("@foo", SqlDbType.DateTime).Value = yourDateTime; 
```

如果您确实需要一个字符串，那么只需将该字符串直接用作 [n][var]char 参数即可。

另外-在这种情况下，要解析日期，我将使用不变的文化（因为格式中没有文化）：

```
DateTime yourDateTime =
            DateTime.ParseExact(dateString, "yyyyMMdd", CultureInfo.InvariantCulture); 
```

从对话中，您似乎还需要从 DateTime 转到字符串，在这种情况下只需将其反转：

```
string dateString = yourDateTime.ToString("yyyyMMdd", CultureInfo.InvariantCulture); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T04:45:35.297

Date Time 是一个类，默认情况下，它的 ToString 格式为 19/11/2008 12:00:00 AM

这是来自[MSDN](http://msdn.microsoft.com/en-us/library/system.datetime.aspx)，它可以帮助你

> 由于日期和时间值的外观取决于文化、国际标准、应用程序要求和个人偏好等因素，DateTime 结构通过其 ToString 方法的重载在格式化日期和时间值方面提供了极大的灵活性。默认的 DateTime.ToString() 方法使用当前区域性的短日期和长时间模式返回日期和时间值的字符串表示形式。下面的示例使用默认的 DateTime.ToString() 方法来显示日期和时间，使用短日期和长时间模式用于 en-US 区域性，即运行示例的计算机上的当前区域性。

因此，您可以将 DateTime 上的 ToString 重载为所需格式，否则将字符串表示直接传递给存储过程

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T16:32:33.433

好的，回到文化问题......当你说：

> 日期是这样出来的：日期 = 19/11/2008 12:00:00 AM

我猜您正在运行 ToString 以查看此结果？ToString 中的格式会因文化而异，默认情况下将使用您当前的文化。

通过这样做，我能够重现您所获得的格式：

```
var dateString = "20081119";
var fr = new System.Globalization.CultureInfo("fr-FR");
var resultingDate =DateTime.ParseExact(dateString,"yyyyMMdd",System.Globalization.CultureInfo.CurrentCulture);
Console.WriteLine(resultingDate.ToString(fr)); 
```

您有一个有效的日期，因此格式无关紧要，但如果确实如此并且您需要以您描述的格式获取它，那么您需要在转换为字符串时对其进行格式化......如果它已经是一个字符串，那么就不需要日期转换了。

我可能误读了你的问题，但我不得不把它弄出来，因为它困扰着我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T06:15:20.387

这将给出您正在寻找的确切结果：

转换（varchar（10），getdate（），112）：日期时间到字符串（YYYYMMDD格式）

转换（日期时间，'20081203'，112）：字符串到日期时间（YYYYMMDD格式）

代码端：

DateTimeFormatInfo fmt = (new CultureInfo("hr-HR")).DateTimeFormat; Console.WriteLine(thisDate.ToString("d", fmt)); // 显示 15.3.2008（根据您的要求使用类似的格式）

或者

date1.ToString("YYYYMMDD",CultureInfo.CreateSpecificCulture("en-US")) date1.ToString("YYYYMMDD");

**[http://msdn.microsoft.com/en-us/library/az4se3k1.aspx](http://msdn.microsoft.com/en-us/library/az4se3k1.aspx)**上的详细信息

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T04:54:43.797

我认为这是由于 CurrentCulture 中设置的文化，不知道那是什么，我不能确定，但​​指定 en-US 对我有用。这是我的代码：

```
var dateString = "20081119";
var enUS = new System.Globalization.CultureInfo("en-US");
var resultingDate = DateTime.ParseExact(dateString,"yyyyMMdd",enUS);
Console.WriteLine(resultingDate.ToString()); 
```

试一试，看看它是否适合你。

# asp.net-mvc - “此安装不支持项目类型”错误

> ID：336235
> 
> 赞同：71
> 
> 时间：2008-12-03T04:44:01.790
> 
> 标签：asp.net-mvc, visual-studio-2008

我已经在 W2k3 操作系统上安装了 VS 2008 SP1。在我安装 ASP.NET MVC beta 并尝试创建 ASP.NET MVC 类型项目后，我收到以下错误。

“此安装不支持项目类型”

让我知道您是否已解决此问题。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-10-15T16:16:28.620

我尝试了这里发布的一些解决方案，但仍然没有乐趣。最后，我在项目文件中将 ProjectTypeGuids 替换为下面的这个，它加载得很好

`<ProjectTypeGuids>{349c5851-65df-11da-9384-00065b846f21};{fae04ec0-301f-11d3-bf4b-00c04f79efbc}</ProjectTypeGuids>`

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-30T05:58:18.850

我在遇到[自己的问题时](http://cantgrokwontgrok.blogspot.com/2009/03/missing-entity-framework-templates-and.html)遇到了一些问题。

简而言之，尝试：

*   以管理员身份运行 Visual Studio 命令提示符。
*   执行：

    ```
    devenv /setup 
    ```

然后它会飞一会儿（VS2008 不会打开），一旦提示返回，启动 VS 并且所有（可能）恢复正常。

当我的 MVC 项目在尝试启动和运行实体框架时搞砸时，我遇到了这个问题:)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-03-31T18:32:09.327

问题是 MVC 2 并不完全向后兼容。Visual Studio 无法打开未安装 MVC 1 的 MVC 1 应用程序。因此，如果您只安装 MVC 1，它可以与 MVC 2 一起安装，您应该没问题。 [http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=53289097-73ce-43bf-b6a6-35e00103cb4b](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=53289097-73ce-43bf-b6a6-35e00103cb4b)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-02-04T10:10:37.303

我对 MVC v1 有同样的问题。原来我没有安装“Visual Web Developer”功能。

这个 SO 用户有[同样的问题](https://stackoverflow.com/questions/1404104/asp-net-mvc-1-0-project-type-is-not-supported-on-visual-studio-2008)。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-10-06T17:31:46.147

我的情况略有不同：我试图打开一个现有的 MVC 3 项目。原来我没有 MVC 3，从[这里](http://www.asp.net/mvc/mvc3)安装它为我解决了这个问题。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-24T15:33:32.183

我从 Visual Studio 2008 安装 DVD 安装了 Visual Web Developer 并解决了问题

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-18T16:18:44.657

Tried to install ASP.NET MVC 1.0\. It works to me.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-07-11T00:33:28.423

ewalshe - 同样的事情对我有用。我知道这是一个旧帖子，只是想把它放在那里给其他人。我在源代码控制（Vault）中有一个现有的解决方案，并且想设置我的家用计算机进行开发。我在家里安装了 Visual Studio 2008，没有以下选项：

C++
Visual Basic
Visual Web 开发人员

当我从源代码管理中删除解决方案时，除了我的 Web 项目之外的所有项目都加载了 - VS 根本无法识别它。使用默认选项进行全新安装并重新启动解决了我的问题。我没有时间也没有意愿真正弄清楚以上哪些是 Web 应用程序项目工作所必需的……也许有人会插话。

〜瑞安

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-03-12T21:10:43.553

在 Windows 7 中，如果您没有以本地“管理员”身份运行并且打开了 UAC，则安装将静默失败。解决方案是禁用 UAC，重新启动，安装应该会成功。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-07T21:38:20.397

我遇到了同样的错误，并在谷歌搜索答案中找到了这个问题。搜索中发现的大多数答案表明，旧的项目类型正在被转移到安装了不同版本的 Visual Studio 的机器上。这些都不适用于我。

我在工作的机器（运行 64 位 Vista）上安装了 VS2008，最近安装了 ASP.NET MVC beta，没有任何问题。

我想在我的 Mac 上复制我的工作环境，所以我将带有 ASP.NET MVC beta 的 VS2008 安装到在 Parallels VM 中运行的 WinXp 安装中。当我使用 ASP.NET MVC Web 应用程序模板创建项目时，出现“此安装不支持项目类型”错误。

我终于通过再次重新安装 VS2008（全新安装，而不是修复）使事情正常进行。这次我选择了默认的安装选项，而不是像往常一样自定义东西。我通常会取消选择 VB、移动设备、办公室和其他非 C# 开发的东西——我的 Mac 上没有太多可用空间。

干净安装 VS2008 后，我更新了 Windows，安装了 VS2008 SP1，最后安装了 ASP.NET MVC beta。

似乎当我自定义 VS2008 安装时，我取消了正确运行 MVC beta 所必需的一些东西。我不知道那是什么东西，我很高兴三天后我可以在家玩 MVC 的东西。

自从您发布问题以来已经一个月了。从那以后你有任何进展吗？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-10-15T21:15:57.017

这可能很明显，但它为我解决了这个问题。在安装 Visual Studio 2008 之前，我已经安装了 ASP.NET MVC。一旦我删除了 MVC 并重新安装，我就不再遇到问题了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-01-12T21:41:35.920

我一直遇到这个问题。运行 devenv /setup 和 devenv /resetskippkgs 对我不起作用。也没有删除项目指南。我安装了 MVC 1.0，它仍然没有工作。然后我安装了 MVC 2.0，这似乎做到了。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-07-20T21:06:13.247

VS2008；64 位机器上的 ASP.NET MVC 2 收到问题：
“此安装不支持项目类型”

解决方案：感谢上面的 Bert Huijben。在开始菜单的 VS install 下，在 VS Tool 文件夹中，运行 VS2008 x64 Cmd Prompt。执行的命令：

```
devenv /setup 
```

...仍然项目出错并且没有打开，然后运行

```
devenv.exe /resetskippkgs 
```

...然后成功！

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-07-25T20:51:02.403

这有时是由运行不支持 MSTest 的 Visual Studio 版本引起的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-01-23T06:44:15.583

安装 ASP.NET MVC 1.0。它对我有用。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-01-10T11:59:38.237

如果您正在尝试运行 MVC 应用程序，请尝试运行`AspNetMVC1.msi`. 它对我有用，所以希望它能解决你的问题。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-05-03T17:58:00.497

我在我的机器上安装了 MVC 2，但仍然收到此错误消息。我安装了 MVC 1，没有 GO。我安装了 Web Developer No GO。我终于卸载了 MVC1 和 MVC2，然后重新安装了 MVC2：[http ://www.microsoft.com/Downloads/en/details.aspx?familyid=C9BA1FE1-3BA8-439A-9E21-DEF90A8615A9&displaylang=en](http://www.microsoft.com/Downloads/en/details.aspx?familyid=C9BA1FE1-3BA8-439A-9E21-DEF90A8615A9&displaylang=en)

重新安装 MVC 2 为我解决了这个问题。希望这对其他人有帮助。

谢谢

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-09-11T16:17:35.550

试过@ryan 和@Rob Cooper 没有高兴地回答。在 Win7 上的 vhd 中运行它。

分区在 Mvc 上，这就是问题所在。不是 100%，但认为问题是我试图打开一个没有最新 Mvc 版本的项目，而新版本有。

临时解决方案是回滚到以前版本的 Mvc。然后，当您满意时，将项目升级到最新的 Mvc，然后再升级机器。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-07-25T20:48:25.853

我不得不重建我的开发虚拟机来解决这个问题。干净安装 FTW。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-01-19T13:51:28.737

当我开始安装 ASP.NET MVC 时意外运行 VS2008 时遇到了这个问题。关闭VS，卸载ASP.NET MVC，然后重新安装，一切正常。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-12-02T17:56:19.340

Vivek Ayer 的解决方案也适用于 MbUnit 项目。此外，只需删除第一个 GUID（而不是将其替换为“{349c5851-65df-11da-9384-00065b846f21}”）即可。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-02-21T19:24:57.467

如果您正在运行 Visual Studio 2010 并且想要打开/创建 MVC 3 解决方案，则必须安装 Visual Studio 的 Visual Web Developer 组件。

如果您在没有自定义的情况下进行了默认安装，则安装此组件。

如果您进行自定义安装并说您只想安装 C# 的东西，您可能没有选中 Visual Web Developer 组件，认为您不需要它。任何 MVC 开发都需要它。只需重新运行您的 VS 设置并确保选择了此组件。

即使没有安装此组件，MVC 3 下载和安装也将正常工作。但是，您将无法打开或创建 MVC 3 解决方案。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-03-27T09:32:19.297

解决这个问题的诀窍是 ProjectTypeGUID，但本文和其他帖子中其他地方列出的 GUIDS 对我不起作用。

最后（这是我的建议），我创建了一个新的 MVC 项目，然后打开 *.vbProj 文件并复制出我在那里找到的 ProjectTypeGUID。当我将这些转换到我遇到问题的项目的 vbproj 文件中时，一切都开始工作了。

就我而言（对于现有的 VS10 VB 项目），正确的 GUID 是：

```
<ProjectTypeGuids>{F85E285D-A4E0-4152-9332-AB1D724D3325};{349c5851-65df-11da-9384-00065b846f21};{F184B08F-C81C-45F6-A57F-5ABD9991F28F}</ProjectTypeGuids> 
```

# php - 如何重定向到（或强制执行）SSL 连接？

> ID：336240
> 
> 赞同：2
> 
> 时间：2008-12-03T04:46:51.643
> 
> 标签：php, zend-framework, ssl

我正在使用 Zend 框架（它的 MVC 部分），并且需要将用户重定向到启用 SSL 的页面或以某种方式从控制器强制 SSL 并且不太明白如何做到这一点？也许有人可以分享知识？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T05:01:48.913

在 Web 服务器级别很容易做到。

在 Apache 中，你会这样做：

```
RewriteEngine On
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T05:03:47.023

查看 PHP 标头手册页，特别是有关 https 处理和重定向的[用户贡献。](http://www.php.net/manual/ro/function.header.php#83448)

# php - 如何强制执行最大数量的分叉子项？

> ID：336250
> 
> 赞同：3
> 
> 时间：2008-12-03T04:54:09.210
> 
> 标签：php, c, fork, process-management

编辑：我已经标记了这个 C，希望得到更多的回应。我感兴趣的更多的是理论而不是特定的语言实现。因此，如果您是 C 编码员，请将以下 PHP 视为伪代码，并随时用 C 编写的答案来回应。

我试图通过让它并行而不是串行执行其任务来加速 PHP CLI 脚本。这些任务彼此完全独立，因此它们开始/完成的顺序无关紧要。

这是原始脚本（请注意，为清楚起见，所有这些示例都被剥离）：

```
<?php

$items = range(0, 100);

function do_stuff_with($item) { echo "$item\n"; }

foreach ($items as $item) {
    do_stuff_with($item);
} 
```

我已经设法使它与如下所示`$items`并行工作：[`pcntl_fork()`](http://php.net/pcntl_fork)

```
<?php

ini_set('max_execution_time', 0); 
ini_set('max_input_time', 0); 
set_time_limit(0);

$items = range(0, 100);

function do_stuff_with($item) { echo "$item\n"; }

$pids = array();
foreach ($items as $item) {
    $pid = pcntl_fork();
    if ($pid == -1) {
        die("couldn't fork()");
    } elseif ($pid > 0) {
        // parent
        $pids[] = $pid;
    } else {
        // child
        do_stuff_with($item);
        exit(0);
    }   
}

foreach ($pids as $pid) {
    pcntl_waitpid($pid, $status);
} 
```

现在我想扩展它，以便一次最多有 10 个孩子活跃。处理这个问题的最佳方法是什么？我尝试了几件事，但运气不佳。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T05:51:40.700

我能想到的最好的办法是将所有任务添加到队列中，启动所需的最大线程数，然后让每个线程从队列中请求任务，执行任务并请求下一个任务。当没有更多任务要做时，不要忘记让线程终止。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T05:57:54.853

分叉是一项昂贵的操作。从外观上看，您真正想要的是多**线程**，而不是多**处理**。不同之处在于线程比进程轻得多，因为线程共享一个虚拟地址空间，但进程具有单独的虚拟地址空间。

我不是 PHP 开发人员，但快速的 Google 搜索显示 PHP 本身不支持多线程，但有一些库可以完成这项工作。

无论如何，一旦你弄清楚如何产生线程，你就应该弄清楚要产生多少线程。为了做到这一点，您需要知道您的应用程序的瓶颈是什么。瓶颈是 CPU、内存还是 I/O？您在评论中指出您是网络绑定的，并且网络是一种 I/O。

如果您受 CPU 限制，那么您将获得与 CPU 内核一样多的并行性；更多线程，您只是在浪费时间进行上下文切换。假设您可以计算出要生成的总线程数，您应该将您的工作分成这么多单元，并让每个线程独立处理一个单元。

如果您受内存限制，那么多线程将无济于事。

由于您受 I/O 限制，因此确定要生成多少线程有点棘手。如果所有工作项的处理时间大致相同且方差非常小，则可以通过测量一个工作项花费的时间来估计要生成的线程数。但是，由于网络数据包往往具有高度可变的延迟，因此不太可能出现这种情况。

一种选择是使用线程池 - 您创建一大堆线程，然后对于要处理的每个项目，您查看池中是否有空闲线程。如果有，则让该线程执行该工作，然后移至下一个项目。否则，您将等待线程可用。选择线程池的大小很重要——太大了，你在浪费时间做不必要的上下文切换。太少了，而且您太频繁地等待线程。

另一种选择是放弃多线程/多处理，而只做异步 I/O。既然您提到您正在使用单核处理器，这可能是最快的选择。您可以使用诸如[`socket_select()`](http://www.php.net/manual/en/function.socket-select.php)测试套接字是否有可用数据之类的功能。如果是，您可以读取数据，否则您将移动到不同的套接字。这需要做更多的簿记工作，但是当数据在另一个套接字上可用时，您可以避免等待数据进入一个套接字。

如果你想避开线程和异步 I/O 并坚持使用多处理，如果每项处理足够昂贵，它仍然是值得的。然后，您可以像这样进行工作划分：

```
$my_process_index = 0;
$pids = array();

// Fork off $max_procs processes
for($i = 0; $i < $max_procs - 1; $i++)
{
  $pid = pcntl_fork();
  if($pid == -1)
  {
    die("couldn't fork()");
  }
  elseif($pid > 0)
  {
    // parent
    $my_process_index++;
    $pids[] = $pid
  }
  else
  {
    // child
    break;
  }
}

// $my_process_index is now an integer in the range [0, $max_procs), unique among all the processes
// Each process will now process 1/$max_procs of the items
for($i = $my_process_index; $i < length($items); $i += $max_procs)
{
  do_stuff_with($items[$i]);
}

if($my_process_index != 0)
{
  exit(0);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T08:09:00.300

没有系统调用来获取子 pid 的列表，但`ps`可以为您完成。

`--ppid`switch 将列出您处理的所有子进程，因此您只需要计算`ps`.

或者，您可以维护自己的计数器，您将`fork()`在信号上递增和递减`SIGCHLD`，假设`ppid`对于分叉处理保持不变。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T05:36:53.163

人 2 设定限制

这将是每个用户，这*可能*是你想要的。

# php - 管理员批准会员的php脚本

> ID：336252
> 
> 赞同：-5
> 
> 时间：2008-12-03T04:54:27.650
> 
> 标签：php

我在 php n mysql 中创建了一个注册页面 n 登录页面 4 个成员。我还创建了一个管理员帐户，现在我想做一些事情，比如如果成员注册，只有在管理员批准时才会添加他。请帮助

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T05:02:52.437

下意识的反应是在 users 表中添加一个布尔列，默认值为 false。然而，最好的路线可能是一个 CHAR(1) 列，默认为 'P' 用于挂起。然后，当管理员做出选择时，他们可以批准（设置为“Y”）或拒绝（设置为“N”），他们不必查看所有内容（只需列出列为 ='P' 的所有用户）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T04:56:23.887

1.  在用户表中引入一个“已批准”列，指示该帐户是否被批准
2.  为管理员提供一个界面，以查看此类帐户的列表并切换其批准状态
3.  更新现有身份验证代码以检查此列并禁止使用“未经批准”的帐户

# sql - Select Unique 和 Select Distinct 的区别

> ID：336268
> 
> 赞同：153
> 
> 时间：2008-12-03T05:05:37.237
> 
> 标签：sql, sql-server

我认为这些是同义词，但我在 Microsoft SQL 中编写了以下内容：

```
Select Unique col from 
     (select col from table1 union select col from table2) alias 
```

它失败了。将其更改为

```
Select Distinct col from 
     (select col from table1 union select col from table2) alias 
```

解决它。有人可以解释吗？

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2008-12-03T08:00:24.823

`SELECT UNIQUE`是 Oracle 的 SQL 风格支持的旧语法。它是 的同义词`SELECT DISTINCT`。

使用`SELECT DISTINCT`是因为这是标准 SQL，并且`SELECT UNIQUE`是非标准的，并且在 Oracle 以外的数据库品牌中`SELECT UNIQUE`可能根本无法识别。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2008-12-03T05:09:26.120

Unique 是 Create Table() 指令中使用的关键字，表示字段将包含唯一数据，通常用于自然键、外键等。

例如：

```
Create Table Employee(   
    Emp_PKey Int Identity(1, 1) Constraint PK_Employee_Emp_PKey Primary Key,  
    Emp_SSN Numeric Not Null Unique,  
    Emp_FName varchar(16),   
    Emp_LName varchar(16) 
) 
```

即某人的社会安全号码可能是您表中的唯一字段，但不一定是主键。

在 Select 语句中使用 Distinct 通知查询，当字段包含可能不唯一的数据时，您只希望返回唯一项。

```
Select Distinct Emp_LName
From Employee 
```

您可能有许多姓氏相同的员工，但您只需要每个不同的姓氏。

显然，如果您要查询的字段包含唯一数据，那么*Distinct*关键字就变得多余了。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-12-03T05:14:34.940

select unique 不是您尝试执行的有效语法

您想使用 select distinct 或 select distinctrow

实际上，您甚至不需要 distinct/distinctrow 尝试做的事情。您可以通过选择适当的联合语句参数来消除重复项。

下面的查询本身只会提供不同的值

```
select col from table1 
union 
select col from table2 
```

如果您确实想要重复，则必须这样做

```
select col from table1 
union all
select col from table2 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-09-15T07:35:53.400

### 仅在 Oracle =>

`SELECT DISTINCT`并`SELECT UNIQUE`以同样的方式行事。虽然 DISTINCT 是 ANSI SQL 标准，但 UNIQUE 是 Oracle 特定的语句。

### 在其他数据库中（例如您的 sql-server）=>

`SELECT UNIQUE`是无效的语法。`UNIQUE`是在列上添加唯一约束的关键字。

[选择不同的](http://psoug.org/definition/DISTINCT.htm)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-06-05T17:39:49.637

1.  **Unique**是旧语法，而**Distinct**是新语法，现在是标准 sql。
2.  **Unique**创建一个约束，即要插入的所有值都必须与其他值不同。如果尝试输入重复值，则可能会出现错误。 **Distinct**会导致在检索数据时删除重复的行。
3.  示例： SELECT **DISTINCT** names FROM student ;

    CREATE TABLE Persons ( Id varchar NOT NULL **UNIQUE** , Name varchar(20) );

# sql - MySQL 与 SQL Server Express

> ID：336275
> 
> 赞同：9
> 
> 时间：2008-12-03T05:10:08.867
> 
> 标签：sql, mysql, sql-server

Sun 最近收购 MySQL 以及随后的错误版本是否扼杀了 MySQL 品牌？

当 MySQL 刚问世时，我全心全意地接受它，因为我曾经是一个贫穷的开发人员，而且所有的 RDBM 都太贵了。我很喜欢 MySQL 以及它们能够与 Oracle 和 SQL Server 竞争。我将 SQL Server Express 的存在归功于最初的 MySQL 团队。我现在几乎所有事情都使用 SQL Server Express 而不是 MySQL。首先，我不喜欢 Sun，其次，SQL Server Express 比 MySQL 更加健壮和“企业级”。

SQL Server Express 的唯一重大限制是 4GB db 大小和缺少代理。我发现大小限制不是问题，因为当数据库接近该大小时，应用程序应该是有利可图的（并且您购买了许可证），或者您应该终止产品。代理问题很好，但并不重要，因为您可以解决它。

似乎对于像我这样的 db simpletons，SQL Server Express 更容易设置和使用，并且更快更稳定。对于大师，他们将使用 PostgresSQL ......

解决：

所以基本上，我们在 stackoverflow 上有一群 SQL Server 粉丝（尽管思想开放）。看来我来对地方了。看到 MySQL 从你欢呼的东西变成你可怜的东西，这很可悲。我希望原公司的创始人尝试新的尝试。我绝对不会评判他们卖给 SUNW - 工作自然是利润驱动的。我希望我们能找到一些不关心利润的人，他们创造了一些像 MySQL 过去那样的产品。否则，MSFT 可能会取消 EXPRESS。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-03T05:38:11.133

与两者一起工作后，我不得不说 MySQL 中的限制和/或错误对我来说是一个很大的障碍......我不喜欢 PHP，虽然我尊重开源社区在这两种技术方面的进步我只是看不出它们组合在一起的优雅。但是不要让我的个人品味影响你对 MySQL 的判断。

我在 SQL Server Express 中完成所有原型设计，并且我的大多数客户都使用成熟的 SQL Server 2005。从一个到另一个的轻松转换对我来说毫无疑问 - 我可以接受我为 SQL Server Express 编写的任何内容和把它直接放进去，不用担心语法可能不同。这两个限制甚至在开发环境中都不会真正妨碍 - 只有当您进入生产环境时，它们才会成为问题。

对我来说，SQL Server 毫无争议地赢得了争论。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-30T14:26:31.840

到目前为止，没有人知道甲骨文会对 MySQL 做什么，甚至不知道甲骨文。

我已经对 MySQL 进行了广泛的测试，并且会说它在性能方面大约是 SQL Server 7.0 级别。如果您只需要 SQL Server 7.0 的性能，那很好

在企业层面根本没有竞争力。如果你看一下围绕 MySQL 5.4 的宣传，它会说“现在支持超过 4 个处理器”。

MySQL 得分高的地方在于它非常便宜，以至于可以进行横向扩展设计，在这种情况下，单个盒子的原始功能根本无关紧要。

MySQL 中有很多遗漏会使 SQL Server 开发人员陷入困境。没有 CHECK 约束，没有索引视图，没有将聚集索引与主键分开。也就是说，它具有大量对 Web 开发人员非常有用的有用功能。

Sun/MySQL 的人对他们的产品非常诚实。他们准确地说出优势和劣势是什么。如果您习惯了一些大供应商的销售策略，这将是一个巨大的冲击。最终，这确实激发了使用该产品的信心，因为您确切地知道会发生什么。我会更早地处理一种说“不要这样做，因为这超出了我们的极限”的产品，而不是说“我们的产品可以治愈癌症”的产品，事实证明它无法治愈简单的宿醉！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T10:43:30.270

两者都运行*后，我认为 SQL Server 总体上是一个比 MySQL 更全功能的产品（尽管我很想听到相反的论点）这一点毫无疑问。

我不会过分担心 MySQL 错误 - 只需运行几个版本即可。

鉴于您有一台 Windows 服务器，我能看到的唯一问题是，如果您最大限度地利用 Express 允许的资源并且需要使用完整的、许可的 SQL Server 2005（或 2008）实例，那么您可能会获得巨额成本。如果您希望扩展到该级别并且买不起许可证，那么现在免费的 DBMS 似乎是明智之举，我也会考虑 PostgreSQL，这可能是一个更好的选择。

*并出于不同的原因喜欢他们，FWIW

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-11-26T20:35:25.640

这是一篇非常古老的文章。现在有了 MySQL 5.7.20，没有理由使用 MS SQL Server 或任何其他商业许可的数据库。六个月前，我们在厌倦了超过 5 万美元的 MS SQL 服务器许可成本后，为我们备受瞩目的金融 .Net 应用程序切换到 MySQL，这是有史以来最好的决定。没有许可成本，MySQL 具有高度可配置性，占用空间小，性能优于 MS SQL 服务器。到目前为止，没有故障，没有问题。复制很容易设置，就像一个魅力。我有没有提到，即使在 32 个核心服务器上运行并拥有 5 个复制服务器也没有钱。MS SQL 服务器每两个核心的成本为 3000 美元（在我们的设置中，这将达到六位数）。白白扔掉这笔钱是愚蠢的。在我们自己的基准测试中，MySQL 的性能优于 MS SQL 服务器。除了免费之外，我们真的很喜欢 MySQL 中易于配置的事件。再有一点，安装 MySQL 只需几分钟，而在新计算机上安装 MS SQL 服务器则需要很长时间。不知道 MS SQL 服务器需要几个小时做什么，而 MySQL zip 文件可以解压缩，两行命令可以在几分钟内配置它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T05:29:26.377

MySQL 仍然很强大，并将继续。

但是请注意，SQL Server Express 在其他方面受到限制；具体来说，CPU 数量和 RAM 使用限制（1 GB）。

我个人更喜欢 SQL Server 而不是 MySQL。使用起来要容易得多。如果您小心的话，为它适当开发的应用程序可以扩展到企业级。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-04T16:28:06.797

我不认为您喜欢 Sun 或 mySQL 的“品牌”会过多地影响您的选择——除非您觉得 mySQL 会被 Sun 淘汰。看看性能、管理和功能。

具有高级功能的 SQL Express 看起来很有趣 - 现在具有报告服务。SQL Express 还需要 Windows 许可证和您可能需要的任何相关许可。

mysql 可以使用[http://jasperforge.org/](http://jasperforge.org/)进行报告。

我更喜欢编写 tsql，但对于任何独立项目，我可能会使用 mysql，因为它可以节省成本，可以转嫁给客户——让我在竞争中脱颖而出。人们喜欢存钱，即使它是利润。

# ruby - Ruby 对象打印格式

> ID：336277
> 
> 赞同：1
> 
> 时间：2008-12-03T05:11:36.820
> 
> 标签：ruby

考虑以下：

```
irb(main):001:0> class A
irb(main):002:1> def initialize
irb(main):003:2> @string = "my string"
irb(main):004:2> end
irb(main):005:1> def to_s
irb(main):006:2> puts @string
irb(main):007:2> end
irb(main):008:1> end
=> nil
irb(main):009:0> a = A.new
=> #<A:0x2ea606c @string="my string">
irb(main):010:0> puts a
my string
#<A:0x2ea606c>
=> nil 
```

当 'puts' 输出字符串 my 时，它是否还附加了对象的引用？

有没有办法摆脱这种行为？我想要输出的只是类'to_s'方法中定义的字符串@string

谢谢，

R M

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T05:29:51.977

你希望你的 to_s 方法只返回@string，而不是 do `puts @string`。

# c# - 如何在单元测试中使用 Mock Objects 并仍然使用代码覆盖率？

> ID：336288
> 
> 赞同：16
> 
> 时间：2008-12-03T05:20:09.780
> 
> 标签：c#, .net, unit-testing, moq, code-coverage

目前我开始将 Mock 对象的概念引入到我的单元测试中。特别是我正在使用 Moq 框架。然而，我注意到的一件事是，我正在使用这个框架测试的类突然显示代码覆盖率为 0%。

现在我明白了，因为我只是在模拟这个类，它本身并没有运行实际的类......但是我如何编写这些测试并让代码覆盖率返回准确的结果？我是否必须编写一组使用 Mocks 的测试和一组直接实例化类。

也许我在没有意识到的情况下做错了什么？

这是我尝试对名为“MyClass”的类进行单元测试的示例：

```
using Moq;
using NUnitFramework;

namespace MyNameSpace
{
    [TestFixture]
    public class MyClassTests
    {

        [Test]
        public void TestGetSomeString()
        {
            const string EXPECTED_STRING = "Some String!";

            Mock<MyClass> myMock = new Mock<MyClass>();
            myMock.Expect(m => m.GetSomeString()).Returns(EXPECTED_STRING);

            string someString = myMock.Object.GetSomeString();

            Assert.AreEqual(EXPECTED_STRING, someString);
            myMock.VerifyAll();

        }

    }

    public class MyClass
    {
        public virtual string GetSomeString()
        {
            return "Hello World!";
        }
    }
} 
```

有谁知道我应该做些什么不同的事情？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-03T05:41:45.527

您没有正确使用您的模拟对象。当您使用模拟对象时，您的意思是在不实际使用真实对象的情况下测试您的代码如何与其他对象交互。请看下面的代码：

```
using Moq;
using NUnitFramework;

namespace MyNameSpace
    {
        [TestFixture]
        public class MyClassTests
        {

            [Test]
            public void TestGetSomeString()
            {
                const string EXPECTED_STRING = "Some String!";

                Mock<IDependance> myMock = new Mock<IDependance>();
                myMock.Expect(m => m.GiveMeAString()).Returns("Hello World");

                MyClass myobject = new MyClass();

                string someString = myobject.GetSomeString(myMock.Object);

                Assert.AreEqual(EXPECTED_STRING, someString);
                myMock.VerifyAll();

            }

        }

        public class MyClass
        {

            public virtual string GetSomeString(IDependance objectThatITalkTo)
            {
                return objectThatITalkTo.GiveMeAString();
            }
        }

        public interface IDependance
        {
            string GiveMeAString();
        }
    } 
```

当您的代码只是返回一个没有任何逻辑的字符串时，它看起来并没有做任何有用的事情。

如果您的`GetSomeString()`方法执行了一些逻辑，这些逻辑可能会根据`IDependdance` . `GiveMeAString()`方法，然后您可以看到您的方法如何处理从`IDependdance`接口发送的不良数据。

就像是：

```
 public virtual string GetSomeString(IDependance objectThatITalkTo)
 {
     if (objectThatITalkTo.GiveMeAString() == "Hello World")
         return "Hi";
     return null;
 } 
```

现在，如果您的测试中有这一行：

```
myMock.Expect(m => m.GiveMeAString()).Returns(null); 
```

你的`GetSomeString()`方法会发生什么？

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-03T05:26:37.163

大错误是嘲笑被测[系统](https://en.wikipedia.org/wiki/System_under_test "被测系统")（SUT），你测试别的东西。您应该只模拟 SUT 依赖项。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-06T02:23:44.473

在您了解这里发生的交互之前，我建议您远离模拟框架。

IMO 最好使用手动创建的测试替身来学习，然后毕业到模拟框架。我的推理：

1.  模拟框架抽象出实际发生的事情；如果您必须显式创建依赖项，则更容易掌握交互，然后在调试器中进行测试。

2.  滥用框架很容易。如果你在学习的时候自己动手，你就更有可能理解不同类型的测试替身之间的差异。如果您直接使用模拟框架，则在需要存根时使用模拟很容易，反之亦然——有很大的不同。

可以这样想：被测试的类是焦点。您创建它的一个实例，调用它的方法，然后断言结果是正确的。如果被测类具有依赖关系（例如，构造函数中需要某些东西），您可以使用 A：真实类或 B：测试替身来满足这些依赖关系。

我们使用测试替身的原因是它隔离了被测类，这意味着您可以以更可控的方式运行它的代码。

例如，如果您有一个包含网络对象的类，则如果您被迫使用具体的网络连接对象，则无法测试拥有类的错误处理例程来检测死连接。相反，您注入一个假连接对象，并告诉它在调用其“SendBytes”方法时抛出异常。

即在每个测试中，被测类的依赖关系是专门为执行一段特定的代码而创建的。

# visual-c++ - vc++ 6.0 串行通信

> ID：336289
> 
> 赞同：0
> 
> 时间：2008-12-03T05:21:22.523
> 
> 标签：visual-c++, visual-c++-6

在 vc++ 中，我使用 MScomm 进行串行通信，我收到了这种格式 02120812550006050.0 的数据，我不知道如何读取它，它是什么格式，开始帧和结束文件，我仍然不知道。

编辑1：

它包含日期时间和数据我怎么能分开这个

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T05:51:33.383

有趣的字符是指示记录开始、记录结束、字段分隔符等内容的标记。在不知道实际协议的情况下，这有点难以分辨。

数据就容易多了。

在 000f 和 0002 标记之间，您有一个日期/时间字段，即 2008 年 12 月 2 日 12:55:00。

在 0002 和 0003 标记之间，它看起来像一个简单的浮点数，可能是美元值或任何东西，这取决于链接另一端的内容。

为了将其分开，我假设您已将其读入某种可变字符数组。只需查找标记并提取它们之间的字段。

日期/时间是固定大小的，并且值可能也是如此（因为它有一个前导 0），所以您可能只使用 memcpy 从缓冲区中提取您需要的信息，null 终止它们，将值转换为漂浮，瞧。

如果它是固定格式，你可以使用类似的东西：

```
static void extract (char *buff, char *date, char *time, float *val) {
    // format is "\x01\x0fDDMMYYhhmmss\x02vvvvvvv\x03\x04"
    char temp[8];
    memcpy (date, buff +  2, 6); date[6] = '\0';
    memcpy (time, buff +  8, 6); time[6] = '\0';
    memcpy (temp, buff + 15, 7); temp[7] = '\0';
    *val = atof (temp);
} 
```

并调用它：

```
char buff[26]; // must be pre-filled before calling extract()
char dt[8];
char tm[8];
float val;
extract (buffer, dt, tm, &val); 
```

如果不是固定格式，您只需要编写代码来检测字段分隔符的位置并提取它们之间的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T05:25:47.990

除非您知道自己在与什么交流以及它如何与您交流，否则您不太可能弄明白。（提示——你可以试着告诉我们）

# voicexml - 如何禁用 VoiceXML 语法？

> ID：336303
> 
> 赞同：2
> 
> 时间：2008-12-03T05:36:17.707
> 
> 标签：voicexml

我正在编写一个[VoiceXML](http://en.wikipedia.org/wiki/VoiceXML)应用程序，其中我们有一个语音语法和一个[DTMF](http://en.wikipedia.org/wiki/DTMF)语法。如果呼叫者是从特别嘈杂的环境中呼叫，我们需要禁用语音语法。有没有办法做到这一点，不涉及将整个表格复制到另一个表格并删除语音语法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-12T15:59:35.703

您正在寻找的可能是`inputmodes`属性：

```
<property name="inputmodes" value="dtmf"/> 
```

这将在禁用语音语法时启用 DTMF 语法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-09T20:04:11.537

您没有提及您正在使用哪个平台，但这很重要，因为这是您在平台之间存在差异的领域之一。

VoiceXMl 2.0 规范的第 [3.1.4][1] 节说 inputmodes="dtmf" 不会取消激活语音语法，只是使它们无法匹配。因此，如果您关闭语音识别语法，您会希望结束指针不允许语音交换，但规范不一定禁止。

除非您可以使用任何特定于平台的扩展，否则您还可以考虑敏感性属性。将其设置为 0 应该会使 ASR 停止收听语音。

如果您的平台支持，您也可以尝试将 bargeintype 属性设置为“hotword”。这不会禁用语音语法，但会降低用户由于与噪音相关的干扰而听不到提示的可能性，这有时足以使应用程序正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-03T13:34:25.633

使用输入模式可以工作，但您仍然需要两种形式。但是，如果您使用 voicexml 2.1 并确保您没有在语法标签中提供输入模块并确保它在语法本身中指定，那么您可以使用 srcexpr 来“关闭”您的语音语法。

假设您这样指定语法：

```
<grammar type="application/srgs+xml" src="/grammars/menu.grxml" />
<grammar type="application/srgs+xml" src="/grammars/menu-dtmf.grxml" /> 
```

您可以通过重复使用 dtmf 版本来禁用语音语法：

```
<grammar type="application/srgs+xml" srcexpr="'/grammars/menu' + (dtmfMode?'-dtmf':'') + '.grxml'" />
<grammar type="application/srgs+xml" src="/grammars/menu-dtmf.grxml" /> 
```

因此，您需要做的就是设置一个名为 dtmfMode 的布尔变量，当您只需要 DTMF 时该变量为真。

# mysql - 如何归档 MySQL 数据库？

> ID：336309
> 
> 赞同：1
> 
> 时间：2008-12-03T05:40:42.237
> 
> 标签：mysql, archive

我有一个要*归档*的 MySQL 数据库。做这个的最好方式是什么？

注意：我*不想*只做一个*备份*。我想以一种我可以在以后获得的方式一次性导出数据以进行长期存储。特别是，我不想被绑定到 MySQL、数据库或任何给定的软件（我真的希望编写一个可以重新读取它的程序，比如几十行 C 或 perl） .

我目前的计划是使用 CSV 引擎将内容转储到表中，然后将其刻录到 DVD。这很好，因为 CSV 可以被许多不同的程序加载。唯一的问题是大部分数据都在 Blob 列中，就像二进制一样，所以我需要解码它是如何编码的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T05:46:20.040

导出为 CSV，使用 Base64 编码对二进制数据进行编码，然后使用 gzip 进行压缩听起来是个不错的方法。不过，我建议您仔细考虑您对 DVD 的选择。多年来，可记录媒体趋于迅速恶化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T05:57:22.640

您可以将整个数据库转储到 .sql 文件中，并使用 VCS 归档每个版本。如果您需要旧版本，可以将其从存储库中导出并从中恢复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-11-12T05:33:41.833

```
mysql> ALTER TABLE arch2 ENGINE='ARCHIVE'; 
```

![在此处输入图像描述](https://i.stack.imgur.com/zdQ41.jpg)

# c# - 维护站点类的最佳实践

> ID：336311
> 
> 赞同：0
> 
> 时间：2008-12-03T05:41:19.443
> 
> 标签：c#, asp.net, session, facade

我正在构建一个 Web 应用程序，它使用一个外部构建的类来处理该站点的大部分工作和规则。大多数页面都需要访问这个类来获取它需要显示的信息。过去我会将这样的类放在会话变量中，因此在需要时可以轻松访问它，而无需不断地重新实例化。

第一个问题，将此类填充到会话变量中是不是一个坏主意（它不是很大）？

第二个问题，如果将站点应用程序层类存储在会话中不是一个坏主意，那么有没有办法可以编写一个集中的方法来将类获取或存储到会话中？我不想在页面获取类之后使用一堆重复的代码页，在那里检查它，如果不是就创建等等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T08:40:18.847

在决定将类存储在何处之前，您必须回答两个问题：

1.  这门课应该活多久？
2.  它应该在什么范围内可见？

回答这两个问题的示例：请求、用户会话、应用程序。

如果这个类是无状态的（没有数据，只有逻辑），那么它可能会存在于应用程序的整个生命周期中。如果这只是每个用户独有的数据（不应在每个请求上重新加载），那么您可以将其直接放入会话并跳过以下段落。

现在，在你决定了生命长度之后，你有几个解决方案。生活方式管理的最佳解决方案是 IoC 容器。更简单的解决方案是抽象存储并使用静态外观，如 Current.MyClass，其中 MyClass 实例存储在请求、会话或应用程序中，具体取决于提供给 Current 的存储。

但是，您不应该在指定的类中实现单例，因为它本身不应该决定您需要多少个实例，并且如果需要，它会限制您替换具有相同接口的另一个类的能力。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T06:12:55.027

在不知道您使用的任何框架的情况下，将一个类放入会话存储中似乎不是一个聪明的主意——它将为每个用户复制一次——除非它具有该用户独有的数据。

我能给出的最好建议是有一个单例类（你可以用谷歌搜索它——它是一种设计模式），然后在那个类中有一个函数，它会返回你需要的类，或者如果没有就创建它还存在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-05T23:30:06.943

是否应该首先将课程存储在会话中尚无定论。对于我提出问题的应用程序，我选择不将课程塞进会话中，这真的没有必要，我很懒惰。制定这种管理会话的方法一直都是值得的，因为它在 Web 开发中困扰了我一段时间。

我的研究结果是编写一个静态类来管理我的会话变量。这个类处理对会话的所有读取和写入，并保持它们都是强类型的，以便我启动。它一直困扰着我在整个地方使用重复的代码来进行会话废话。也减少了拼写错误。

我在此找到了两篇我喜欢的文章，我现在只能找到其中一篇，当我找到另一篇时会包括在内。

第一个是在[Code Project](http://www.codeproject.com/KB/aspnet/session_facade.aspx) 这可能是第二个[链接](http://www.codeproject.com/KB/aspnet/wrapthosesessionvariables.aspx)

该模式简单明了。我还为从 url 查询字符串中获取参数的请求构建了一个类。我也没有理由不将其扩展到 cookie。

这是我第一次使用该模式，我只使用字符串，所以私有方法有点受限，但是可以很容易地更改为使用任何类或原始类型。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Configuration;

namespace BDZipper.Site
{
    /// <summary>
    /// This class maintains all session variables for us instead of handeling them 
    /// individually in the session.  They are also strongly typed.
    /// </summary>
    public static class SessionManager
    {

        # region Private Constants
        // Define string constant for each property.  We use the constant to call the session variable
        // easier not to make mistakes this way.
        // I think for simplicity, we will use the same key string in the web.config AppSettings as
        // we do for the session variable.  This way we can use the same constant for both!
        private const string startDirectory = "StartDirectory";
        private const string currentDirectory = "CurrentDirectory";

        # endregion

        /// <summary>
        /// The starting directory for the application
        /// </summary>
        public static string StartDirectory
        {
            get
            {
                return GetSessionValue(startDirectory, true);
            }
            //set
            //{
            //    HttpContext.Current.Session[startDirectory] = value;
            //}
        }

        public static string CurrentDirectory
        {
            get
            {
                return GetSessionValue(currentDirectory, false);
            }
            set
            {
                HttpContext.Current.Session[currentDirectory] = value;
            }
        }
        //TODO: Update to use any class or type
        /// <summary>
        /// Handles routine of getting values out of session and or AppSettings
        /// </summary>
        /// <param name="SessionVar"></param>
        /// <param name="IsAppSetting"></param>
        /// <returns></returns>
        private static string GetSessionValue(string SessionVar, bool IsAppSetting)
        {
            if (null != HttpContext.Current.Session[SessionVar])
                return (string)HttpContext.Current.Session[SessionVar];
            else if (IsAppSetting)  // Session null with appSetting value
                return ConfigurationManager.AppSettings[SessionVar];
            else
                return "";
        }
    }
} 
```

# ajax - Google 的 AJAX API 提要可以自定义动画吗？

> ID：336326
> 
> 赞同：0
> 
> 时间：2008-12-03T05:56:34.590
> 
> 标签：ajax, rss, google-feed-api

有没有人有任何运气自定义提要动画？理想情况下，我想要一个左右选取框动画。

任何想法将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-14T17:12:28.700

当然。只需使用[scriptaculous或类似的动画 div](http://script.aculo.us/)[将显示](http://code.google.com/apis/ajaxfeeds/documentation/#FEEDCONTROL)您的提要。还可以查看 Google Ajax Feeds 页面上的示例。

# sharepoint - 在 CAML 查询中将 DateTime 格式修剪为 Just Date 格式

> ID：336327
> 
> 赞同：1
> 
> 时间：2008-12-03T05:57:08.070
> 
> 标签：sharepoint, sharepoint-2007, wss

我正在尝试为 SharePoint 2007 环境构建 CAML 查询，以从日历列表中获取项目。要查询具有给定“开始日期”和“结束日期”的项目，日历列表包含日期时间格式的“事件日期”和“结束日期”。我只对日期时间字段的日期部分感兴趣。

如何将日历列表的“EventDate”DateTime 字段修剪为日期并进行比较？

除了 CAML 之外，还有其他方法可以完成这项工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T07:18:53.317

不幸的是，您必须使用 CAML。

你应该能够修剪时间部分......

```
<Where>
   <Gt>
       <FieldRef Name='EventDate' />
       <Value IncludeTimeValue='FALSE' Type='DateTime'>2008-12-03T12:00:00Z</Value>
   </Gt>
</Where> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T13:59:07.207

相反，如果您在代码中使用对象模型，则可以使用 LINQ to SharePoint ( [http://www.codeplex.com/LINQtoSharePoint](http://www.codeplex.com/LINQtoSharePoint) )。

在后台，该项目只是为您创建一个 CAML 查询，但您不必直接使用 CAML。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-23T18:36:13.890

这适用于 ssrs 2005 吗？

2008-12-03T12:00:00Z

# asp.net - 从 ASP.NET 转向 Ruby on Rails

> ID：336329
> 
> 赞同：11
> 
> 时间：2008-12-03T05:57:35.337
> 
> 标签：asp.net, ruby-on-rails

我是过去 5 年的 ASP.NET 开发人员，并且仍然喜欢它。有很多关于 Ruby on Rails 的好声音。我想问社区，作为 ASP.NET Web 开发人员，有什么值得尝试学习 Ruby On Rails 的以下观点。

1.  可扩展性
2.  文档
3.  社区支持
4.  托管解决方案
5.  部署 ETC。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-03T06:41:56.060

我会看一看 ASP.NET MVC。通过这种方式，您可以坚持使用 .NET Framework，但仍然可以从 RoR 中获得一些您可能想要的东西。

ASP.NET MVC 非常轻量级，并且可以通过它提供的一些 API（用于会话的 SQL 存储甚至 Microsoft Velocity）轻松扩展。

ASP.NET MVC 得到了社区的大量支持，因此得到了来自社区和 Microsoft 本身的大量文档和反馈。

很多。查看[http://www.codeplex.com/ASPNET](http://www.codeplex.com/ASPNET)了解更多信息。

好吧，ASP.NET MVC 是可二进制部署的。因此，只要您的主机支持 ASP.NET 3.5，您就不需要其他任何东西。他们不需要以任何方式安装 ASP.NET MVC。因此，如果您愿意，您可以轻松使用共享主机。

使用 ASP.NET MVC 和 Visual Studio 2010 的更改非常容易部署，以便通过“包”更轻松地部署网站。我目前维护 2 个 ASP.NET MVC 站点，并发现它通过 bin-deployment 与常规 ASP.NET WebForms 站点相同。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-03T07:02:18.857

我现在站在你的立场上，因为我在 .NET 中进行了 5 年的商业开发后正在学习 RoR。这是我的两分钱：

1.  可扩展性：我相信 Rails 可以很好地扩展，有很多可用的选项，例如 linux 上的 mongrel 集群。
2.  这比 .NET 上的要差一些。但是社区非常好，你永远不会发现自己在寻找好方法。
3.  见上图（很好）
4.  托管不是问题：许多托管选项可用。
5.  我发现在 Ror 中比在 ASP.NET 中更好地考虑从开发到测试再到生产的过渡。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-09T00:32:24.990

我完全同意乍得的帖子。

我在 Rails 中开发应用程序已经完成了一半，现在我已经完成了一个完整的 360，并且在深入研究 ASP.NET MVC 以完成我的日常工作承诺后重新考虑。

我现在正在更改课程并为我所有的个人项目研究 ASP.NET MVC，我认为现在两者确实具有可比性，因为我认为 MS 已经对 Ruby on Rails 的功能集进行了深入的研究，并确保它们可以非常匹配功能密切。毕竟，如果你将一个项目与 LINQ 2 SQL / EF、ASP.NET MVC 和潜在的动态数据（如果你需要那种东西）结合起来，我真的想不出任何令人信服的理由来选择 Rails 而不是 .NET，但是，我可以选择选择 .NET 而不是 Rails 的理由——毕竟 VS.NET 的丰富调试经验、丰富的智能感知和观察器/快速观察支持以及 ASP.NET MVC 框架支持 Html Action Helpers、Model Binders、支持和鼓励对于单元测试，现在包含 JQuery 和 JSON 结果，您几乎势不可挡。

我想除了托管/许可成本、Ruby 语言偏好和其他个人偏好（例如开源等）之外，这真的是你的选择。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T00:04:50.613

> 1) 可扩展性

Rails 与任何其他 Web 应用程序堆栈一样具有可扩展性。唯一的区别是您的单个服务器可能会过载，并且由于 ruby​​ 运行时的性能较慢，因此需要比在 .NET 中更快地拆分为 2 个服务器。在实践中，这不是问题。

> 2) 文档

微软确实为核心库提供了比 Ruby 或 Rails 更好的文档，但 ruby​​/rails 的文档总体上仍然非常好。我认为 ruby​​/rails 是这里的赢家，因为您始终可以查看所有内容的源代码。再多的文档也不能代替能够实际看到正在发生的事情。

> 3) 社区支持

我对 Rails 的社区支持印象深刻。我不知道那里还能说什么。

> 4) 托管解决方案

自从 phusion 乘客发布以来，现在找到 rails 托管似乎比找到 ASP.net 托管更容易。随着时间的推移，这只会更倾向于 Rails，因为托管公司不必向微软支付版税即可在 Linux 服务器上部署 Rails。

> 5）部署ETC。

Capistrano（最常见的 Rails 部署解决方案）胜过一切。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T06:42:56.057

好吧，我对可伸缩性部分一无所知，但我个人是不久前从 ASP.NET 开始学习 Ruby On Rails 的。我真的很难找到一些好的文档——Rails 网站上的类文档在我看来真的很差，我有一个简单的问题，即你可以在 actionlink 中放入哪些参数。但也许只有我没有找到合适的地方。但我个人认为 ASP.NET 文档比 rails 更好 - 至少买一本书，我认为这是一个好方法。

第 3 号。我很确定，对于 rails 有很好的社区支持，你只需要找到适合你喜欢的合适的论坛或其他媒体 - 也许这就是我做错了。

第 4 点。Rails 有很多托管解决方案，但不如 ASP.NET 或 PHP 那么多。我认为您必须自己研究一下，并找出是否有任何适合您的东西。

5\. Ruby 应该很容易部署，它有一个开发、测试和生产数据库的概念。它使用迁移，因此数据库模式中的更新是无缝的——这非常酷。它是脚本，所以应该是从开发计算机到生产服务器的 xcopy 问题。

您应该选择 Ruby on Rails 的原因是您喜欢 MVC 模式。MVC 模式是天才，当您学习 ruby​​ 时，它是一门很棒的语言。也许潜入 ASP.NET MVC，看看它是什么样的——然后也许转向 Rails。然后你只需要学习一门新语言，而不是同时学习新的架构、框架和语言。

请记住，这是来自一个 ASP.NET 开发人员，他对 Rails 嗤之以鼻，但由于缺乏找到真正好的文档的能力而放弃了，并且总是有一些来自编辑器或 Rails 的奇怪错误 - 但这确实是新手:)

但是如果你有时间，一定要学习它。一些开发人员说我们应该每年学习一门新语言，而 Ruby 是一个很好的候选者。

# visual-studio - 在 Visual Studio 中不使用“添加为链接”拖放 .cs 文件

> ID：336333
> 
> 赞同：4
> 
> 时间：2008-12-03T05:59:37.643
> 
> 标签：visual-studio

将源文件或整个源树拖放到 C# 项目中时，是否可以使用 add-as-link？

目前，将源文件树拖到 C# 项目上会导致 Visual Studio 将所有文件复制到我的解决方案文件下方的镜像树中。

这可以通过添加为链接选项来避免，如下图所示。但是，对于大型树或目录中的某些文件已经是项目的一部分时，它会变得乏味。

[Visual Studio 中添加链接功能的屏幕截图 http://jaapsuter.com/images/add_cs_file.jpg](http://jaapsuter.com/images/add_cs_file.jpg)

我查看了工具->选项，搜索了网络，并在拖放时按住了各种魔术键组合，但无济于事。

我很想编写一个脚本，它只覆盖我的 .cs 文件并在我的 .csproj 文件上运行正则表达式。我知道 NAnt、Premake 和其他解决方案——但我想要一些轻量级的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-12-21T21:47:12.680

虽然已经回答了这个问题，但我想我会提供另一种方法，因为我在确定是否可以在 Visual Studio 中使用拖放而不是繁琐的“添加项目”对话框添加链接文件时发现了这个问题。虽然这里的答案不是我想要的，但我发现自己：

拖放时按住 CTRL+SHIFT，将创建链接文件。此外，仅按住 CTRL 将创建副本，但不会删除源文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-10T17:34:06.670

可能不是您要的，但是一旦我有两个 .NET 应用程序，我想共享很多源文件，所以我将两个 Visual Studio 解决方案**放在同一个目录中**！它确实有效，尽管我想关于这种方法可以说很多......

否则，共享代码最漂亮的方法是将共享代码放在单独的程序集中，尽管如果一开始不是这样编写的话，这需要相当多的额外工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-10T19:23:28.653

如果您没有找到解决方案，您还可以将一个目录手动绑定到您的项目一次，并让项目在加载时自动找到该目录中的所有 .cs 文件。

这可以通过以下方式更改您的 MSBuild 文件轻松完成：

```
<ItemGroup>
  <Compile Include="SomeDirectory\**\*.cs"/>
</ItemGroup> 
```

这将获取 SomeDirectory 中的所有 .cs 文件并将它们包含到项目中。如果经常有很多文件添加到项目中，这将非常有用。但是，它可能会在某些添加无用文件的机器上中断。这就是为什么我只建议在当前工作区中不可编辑的外部项目上使用它。

# c# - C# ASP.NET 3.5 内容配置文件下载问题

> ID：336345
> 
> 赞同：6
> 
> 时间：2008-12-03T06:20:08.413
> 
> 标签：c#, asp.net, content-disposition

我有一个存储一些文档的 sql 数据库。

用户可以登录应用程序，并查看他们的文档列表。

在他们的文档的网格视图中单击链接按钮下载时，我从数据库中获取文件，将其写入文件系统，然后执行此代码。

```
 System.IO.FileInfo file = new System.IO.FileInfo(System.Configuration.ConfigurationManager.AppSettings["UploadPath"] + DocumentName);

    Response.Clear();
    Response.ClearContent();
    Response.ClearHeaders();
    Response.Cookies.Clear();
    Response.Cache.SetCacheability(HttpCacheability.Private);
    Response.CacheControl = "private";
    Response.Charset = System.Text.UTF8Encoding.UTF8.WebName;
    Response.ContentEncoding = System.Text.UTF8Encoding.UTF8;
    Response.AppendHeader("Content-Length", file.Length.ToString());
    Response.AppendHeader("Pragma","cache");
    Response.AppendHeader("Expires", "60");
    Response.ContentType = GetContentType(file.Extension);
    Response.AppendHeader("Content-Disposition",
    "inline; " +
    "filename=\"" + file.Name + "\"; " +
    "size=" + file.Length.ToString() + "; " +
    "creation-date=" + DateTime.Now.ToString("R") + "; " +
    "modification-date=" + DateTime.Now.ToString("R") + "; " +
    "read-date=" + DateTime.Now.ToString("R")); 
```

我的 GetContentType() 方法只为我允许的文件返回适当的文件类型“application/pdf、application/msw0rd 等。

我的问题是，当文件被保存时，它是网页本身，而不是文件系统中的文件。在谷歌浏览器中，它在文件名的末尾添加了一个 .htm 扩展名，我猜是因为它知道这是一个网页？

无论如何，第一步是获取实际文件，而不是他们所在的 HTML 网页副本！

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-03T06:51:29.050

代替

Response.AppendHeader("Content-Disposition", "inline;" + "filename=

采用

Response.AddHeader("content-disposition:", "attachment;filename=

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-03T07:14:25.527

您如何发送文件的实际内容？

我通常使用[Response.TransmitFile](http://msdn.microsoft.com/en-us/library/12s31dhy(VS.80).aspx)方法，它基本上打开文件并将其内容发送到 Response.OutputStream

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T06:29:48.907

您是否尝试将内容处置设置为“附件”而不是“内联”？我相信浏览器会提示用户打开或保存文档。

此外，您通常可以通过使用 BinaryWrite 方法将数据库中的字节流直接写入 Response 对象来绕过文件系统...这也是您可能希望在 ASPX 页面上使用 HTTP 处理程序而不是进行调查的情况，所以您无需担心清除响应等。我过去曾在页面上使用隐藏的 iframe，然后使用 Javascript 将其 src 设置为 HTTP 处理程序，该处理程序将文档 ID 作为参数在查询字符串上。

# javascript - Javascript + IMG 标签 = 内存泄漏。有一个更好的方法吗？

> ID：336348
> 
> 赞同：8
> 
> 时间：2008-12-03T06:23:56.097
> 
> 标签：javascript, jquery, html, ajax, browser

我有一个网页，它使用 jquery 在人们查看事物时接收一些产品信息，然后显示最后看到的产品图像。这是一个 jquery AJAX 回调，看起来很像这样：

```
if(number_of_things_seen > 10) {
  $('#shots li:last-child').remove();
}

$('<li><img src="' + p.ProductImageSmall + '"></li>').prependTo('#shots'); 
```

但是，它似乎泄漏了相当多的内存。从视觉上看，它做了正确的事情，但足迹无限增长。

Safari 的 DOM 检查器显示 DOM 是我所期望的，但它似乎维护了对它显示的每个图像的引用（如在[此屏幕截图](http://skitch.com/dlsspy/7m5k/img-leaks)中所示，以防有人感兴趣）。

我已经添加

```
$('#shots li:last-child img').remove(); 
```

对删除声明没有明显影响。

让浏览器释放这些东西是否需要一些魔法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T20:09:31.973

浏览器因内存泄漏而臭名昭著。听起来问题发生在页面长时间运行时。在内存不足之前刷新页面怎么样？

```
window.setTimeout("location.reload()",1000*60*60);//refresh in an hour 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T06:53:28.250

您可以尝试更改 last-child 的 src 看看是否会有所不同吗？然后，您可以将该元素移动为第一个子元素

```
//not tested

var $list=$('#shots>li');
$list.filter(':last-child').children('img')
.attr('src', p.ProductImageSmall)
.parent()
.insertBefore( $list.eq(0) ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T19:23:29.537

脚印真的有问题吗？

我怀疑只要您留在同一个站点上，Safari 就会缓存所有图像，而您对此无能为力。如果幸运的话，Safari 在达到某个限制后会释放不需要的对象。

这种行为的原因是，Safari 认为这些图像很可能被第二次使用，因此它会缓存它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T08:39:09.770

来自[Mozilla 开发者中心`removeChild()`](https://developer.mozilla.org/en/DOM/element.removeChild)：

> 被移除的子节点仍然存在于内存中，但不再是 DOM 的一部分。您可以稍后通过 oldChild 对象引用在代码中重用已删除的节点。

这是关键 - 重用移除的孩子，而不是重复制作一个新孩子。

```
// I'm sure there is a nicer way to do it in jQuery
if(number_of_things_seen > 10) {
  var shots = document.getElementById("shots");
  var li    = shots.getElementsByTagName("LI");
  var move  = shots.removeChild(li[li.length-1]);
  move.getElementsByTagName("IMG")[0].src = p.ProductImageSmall;
  shots.insertBefore(move, li[0]);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T07:19:56.577

您观察到这种“无限增长”有多久了？如果有的话，垃圾收集器的某些实现不一定会这么快地将内存归还给操作系统。您能否将您正在尝试做的事情提炼成一个真正简单的测试（例如，一遍又一遍地设置图像的 src）w/o ajax 或回调？你/你能用其他浏览器试试这个吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T09:27:35.227

达斯汀，我的代码中的 insertBefore 语句似乎引起了一些问题。如果您看到这个进一步的测试用例，即使我清空最后一个孩子并插入一个新的新 dom 片段，内存使用情况也会保持不变。比上一次尝试表现更好。

[http://pastebin.me/4936519fea2cf](http://pastebin.me/4936519fea2cf)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-02-06T10:56:24.543

正如我最近发现的那样，Firefox 中有一个错误会导致孤立的 IMG 标签泄漏。

这可以通过将图像移动到 CSS 来解决：

```
if(number_of_things_seen > 10) {
  $('#shots li:last-child').remove();
}

$('<li><div style="background-image: url(\'' + p.ProductImageSmall +
     '\'); background-repeat: no-repeat; background-position: center; '+
     ' width: 20px; height: 20px"></div></li>').prependTo('#shots'); 
```

检查这是否解决了您的内存泄漏问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T08:39:35.930

好的，我为此构建了一个测试工具，它随机抓取一个新图像并使用我的替换 src 代码

见[http://pastebin.me/4936458820c43](http://pastebin.me/4936458820c43)

# asp.net - 我需要帮助............示例项目

> ID：336360
> 
> 赞同：-1
> 
> 时间：2008-12-03T06:41:54.810
> 
> 标签：asp.net

谁能给我一个示例 Asp.Net 项目，其中所有面向对象的概念，如类、抽象、多态性、继承和数组列表都已用于我的实践目的。

我是这个平台的新手，我知道上面提到的所有概念，但我不知道在哪里以及如何在 Web 应用程序中使用这些概念。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T06:48:09.900

下载地址：http: [//www.dotnetspider.com/](http://www.dotnetspider.com/)

可用的示例项目有：

1.  课程查找器 - 搜索学院和课程
2.  图书馆管理系统
3.  学生项目 - 个人助理
4.  学术项目 - 地址簿
5.  学校管理系统

# cocoa - 编码 C 结构

> ID：336367
> 
> 赞同：2
> 
> 时间：2008-12-03T06:48:12.880
> 
> 标签：cocoa

我有一个定义如下的结构作为对象的一部分。我正在尝试对其进行编码以与 NSCoder 一起使用，目的是保存以及撤消/重做功能。

```
struct myCol {
    float rd;
    float grn;
    float blu;
    float alp;
} toolColor; 
```

因此，有一些方法可以对例如`-encodeBool:`、`-encodeFloat:`等进行编码`-encodeObject:`。但是如何为结构执行此操作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T06:55:14.877

我认为您应该将 struct myCol 视为内存缓冲区，并通过类似**encodeBytes**函数的方式对其进行编码。缓冲区长度 = 结构的大小

# c# - Image.Save(..) 抛出 GDI+ 异常，因为内存流已关闭

> ID：336387
> 
> 赞同：117
> 
> 时间：2008-12-03T07:04:11.053
> 
> 标签：c#, image, exception, gdi+

我有一些二进制数据，我想保存为图像。当我尝试保存图像时，如果用于创建图像的内存流在保存之前已关闭，则会引发异常。我这样做的原因是因为我正在动态创建图像，因此..我需要使用内存流。

这是代码：

```
[TestMethod]
public void TestMethod1()
{
    // Grab the binary data.
    byte[] data = File.ReadAllBytes("Chick.jpg");

    // Read in the data but do not close, before using the stream.
    Stream originalBinaryDataStream = new MemoryStream(data);
    Bitmap image = new Bitmap(originalBinaryDataStream);
    image.Save(@"c:\test.jpg");
    originalBinaryDataStream.Dispose();

    // Now lets use a nice dispose, etc...
    Bitmap2 image2;
    using (Stream originalBinaryDataStream2 = new MemoryStream(data))
    {
        image2 = new Bitmap(originalBinaryDataStream2);
    }

    image2.Save(@"C:\temp\pewpew.jpg"); // This throws the GDI+ exception.
} 
```

有人对我如何在流关闭的情况下保存图像有任何建议吗？我不能依赖开发人员记住在图像保存后关闭流。事实上，开发人员不知道图像是使用内存流生成的（因为它发生在其他一些代码中，其他地方）。

我真的很困惑:(

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-12-03T07:12:05.967

因为它是一个 MemoryStream，所以你真的*不需要*关闭流——如果你不这样做，不会发生任何不好的事情，尽管很明显，无论如何处理任何一次性的东西都是很好的做法。（有关更多信息，请参阅[此问题](https://stackoverflow.com/questions/234059)。）

但是，您*应该*处理位图 - 这将为您关闭流。基本上，一旦你给 Bitmap 构造函数一个流，它就“拥有”这个流，你不应该关闭它。正如[该构造函数的文档](http://msdn.microsoft.com/en-us/library/z7ha67kw.aspx)所说：

> 您必须在位图的生命周期内保持流打开。

我找不到任何承诺在您处理位图时关闭流的文档，但您应该能够相当容易地验证这一点。

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2012-04-03T21:14:35.657

**GDI+ 中出现一般错误。** 也可能是由于**保存路径不正确**！我花了半天时间才注意到这一点。因此，请确保您已经仔细检查了保存图像的路径。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-10-25T22:06:39.600

或许值得一提的是，如果 C:\Temp 目录不存在，即使你的流仍然存在，它也会抛出这个异常。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-03-31T18:55:04.353

复制位图。您必须在位图的生命周期内保持流打开。

[绘制图像时：System.Runtime.InteropServices.ExternalException：GDI 中发生一般错误](https://stackoverflow.com/questions/1772083/when-drawing-an-image-system-runtime-interopservices-externalexception-a-generi)

```
 public static Image ToImage(this byte[] bytes)
    {
        using (var stream = new MemoryStream(bytes))
        using (var image = Image.FromStream(stream, false, true))
        {
            return new Bitmap(image);
        }
    }

    [Test]
    public void ShouldCreateImageThatCanBeSavedWithoutOpenStream()
    {
        var imageBytes = File.ReadAllBytes("bitmap.bmp");

        var image = imageBytes.ToImage();

        image.Save("output.bmp");
    } 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-03-11T21:24:23.017

我遇到了同样的问题，但实际上原因是应用程序没有在 C 上保存文件的权限。当我更改为“D:\..”时，图片已保存。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-11-19T10:59:40.553

您可以尝试创建另一个位图副本：

```
using (var memoryStream = new MemoryStream())
{
    // write to memory stream here

    memoryStream.Position = 0;
    using (var bitmap = new Bitmap(memoryStream))
    {
        var bitmap2 = new Bitmap(bitmap);
        return bitmap2;
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-01-15T19:40:09.600

当我从 Citrix 尝试时，我发生了这个错误。图像文件夹在服务器中设置为 C:\，我没有权限。将图像文件夹移动到共享驱动器后，错误就消失了。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-02-07T08:07:01.273

GDI+ 中出现一般错误。它可能是由于图像存储路径问题而发生的，我收到此错误是因为我的存储路径太长，我通过首先将图像存储在最短路径中并使用长路径处理技术将其移动到正确位置来解决此问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-02-07T15:16:05.937

我收到了这个错误，因为我正在执行的自动化测试试图将快照存储到一个不存在的文件夹中。创建文件夹后，错误解决

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-02-19T10:33:17.113

一个奇怪的解决方案使我的代码工作。在paint中打开图像并将其另存为具有相同格式（.jpg）的新文件。现在尝试使用这个新文件，它可以工作。它清楚地向您解释了该文件可能以某种方式损坏。仅当您的代码已修复所有其他错误时，这才有帮助

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-03-27T15:31:29.223

当我尝试将图像保存到路径中时，它也出现在我身边

`C:\Program Files (x86)\some_directory`

并且`.exe`没有以管理员身份运行，我希望这也可以帮助遇到同样问题的人。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-12-22T12:27:35.587

`A generic error occurred in GDI+`对我来说，下面的代码在Saves to a 的行上崩溃了`MemoryStream`。该代码在 Web 服务器上运行，我通过停止和启动运行该站点的应用程序池来解决它。

一定是 GDI+ 中的一些内部错误

```
 private static string GetThumbnailImageAsBase64String(string path)
    {
        if (path == null || !File.Exists(path))
        {
            var log = ContainerResolver.Container.GetInstance<ILog>();
            log.Info($"No file was found at path: {path}");
            return null;
        }

        var width = LibraryItemFileSettings.Instance.ThumbnailImageWidth;

        using (var image = Image.FromFile(path))
        {
            using (var thumbnail = image.GetThumbnailImage(width, width * image.Height / image.Width, null, IntPtr.Zero))
            {
                using (var memoryStream = new MemoryStream())
                {
                    thumbnail.Save(memoryStream, ImageFormat.Png); // <= crash here 
                    var bytes = new byte[memoryStream.Length];
                    memoryStream.Position = 0;
                    memoryStream.Read(bytes, 0, bytes.Length);
                    return Convert.ToBase64String(bytes, 0, bytes.Length);
                }
            }
        }
    } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-03-16T08:25:17.883

当我在 WPF 应用程序中尝试简单的图像编辑时遇到了这个错误。

将 Image 元素的 Source 设置为位图可防止文件保存。即使设置 Source=null 似乎也不会释放文件。

现在我只是从不使用图像作为图像元素的来源，所以我可以在编辑后覆盖！

**编辑**

在听说 CacheOption 属性（感谢@Nyerguds）后，我找到了解决方案：因此，我必须在设置后设置 Uri，而不是使用 Bitmap 构造函数`CacheOption` `BitmapCacheOption.OnLoad`。（`Image1`下面是 Wpf`Image`元素）

代替

```
Image1.Source = new BitmapImage(new Uri(filepath)); 
```

采用：

```
var image = new BitmapImage();
image.BeginInit();
image.CreateOptions = BitmapCreateOptions.IgnoreImageCache;
image.CacheOption = BitmapCacheOption.OnLoad;
image.UriSource = new Uri(filepath);
image.EndInit();
Image1.Source = image; 
```

看到这个：[WPF图像缓存](https://stackoverflow.com/q/30164042/1538014)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-07-30T16:24:59.830

试试这个代码：

```
static void Main(string[] args)
{
    byte[] data = null;
    string fullPath = @"c:\testimage.jpg";

    using (MemoryStream ms = new MemoryStream())
    using (Bitmap tmp = (Bitmap)Bitmap.FromFile(fullPath))
    using (Bitmap bm = new Bitmap(tmp))
    {
        bm.SetResolution(96, 96);
        using (EncoderParameters eps = new EncoderParameters(1))
        {   
            eps.Param[0] = new EncoderParameter(System.Drawing.Imaging.Encoder.Quality, 100L);
            bm.Save(ms, GetEncoderInfo("image/jpeg"), eps);
        }

        data = ms.ToArray();
    }

    File.WriteAllBytes(fullPath, data);
}

private static ImageCodecInfo GetEncoderInfo(string mimeType)
{
        ImageCodecInfo[] encoders = ImageCodecInfo.GetImageEncoders();

        for (int j = 0; j < encoders.Length; ++j)
        {
            if (String.Equals(encoders[j].MimeType, mimeType, StringComparison.InvariantCultureIgnoreCase))
                return encoders[j];
        }
    return null;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-02-12T08:10:15.533

我使用图像处理器调整图像大小，有一天我得到“GDI+ 中发生一般错误”异常。

看了一会儿后，我尝试**回收应用程序池**并宾果游戏它可以工作。所以我在这里注意到它，希望它有帮助;）

干杯

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-09-25T05:39:15.043

我今天在服务器上遇到此错误，当时相同的代码在本地和我们的 DEV 服务器上运行良好，但在 PRODUCTION 上却没有。重新启动服务器解决了它。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-03-22T04:17:19.570

```
public static byte[] SetImageToByte(Image img)
    {
        ImageConverter converter = new ImageConverter();
        return (byte[])converter.ConvertTo(img, typeof(byte[]));
    }
public static Bitmap SetByteToImage(byte[] blob)
    {
        MemoryStream mStream = new MemoryStream();
        byte[] pData = blob;
        mStream.Write(pData, 0, Convert.ToInt32(pData.Length));
        Bitmap bm = new Bitmap(mStream, false);
        mStream.Dispose();
        return bm;
    } 
```

# xhtml - 我在 onPageLoad('TableID') 函数中传递了一个 xhtml 标记 ID

> ID：336391
> 
> 赞同：0
> 
> 时间：2008-12-03T07:07:07.663
> 
> 标签：xhtml, onpageloadstring

Javascripts 在`script.js`我在 xhtml 文件中调用的文件中。

但它在我有调用`onpageload`函数说“预期对象”的行抛出错误。

但是，如果我在同一个 XHTML 文件上有脚本，它就可以正常工作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T07:22:18.693

正如[HTML4 脚本规范中](http://www.w3.org/TR/html4/interact/scripts.html#h-18.2.1)所指定的那样，您是否像这样声明您的外部 javascript？

```
<script src="external.js" type="text/javascript"></script> 
```

IE（但其他浏览器也可能）要求您*打开和关闭*脚本标签。
**`script' 元素的结束标签不是可选的**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T07:48:38.577

确保在页面完全加载后调用脚本 - 使用 document.onload 事件处理程序或

```
<body onload=""> 
```

# visual-studio - 在解决方案资源管理器中禁用拖放

> ID：336394
> 
> 赞同：38
> 
> 时间：2008-12-03T07:11:33.643
> 
> 标签：visual-studio, drag-and-drop, projects-and-solutions

有没有办法禁用解决方案资源管理器的拖放功能？你为什么要问？我使用 wacom 数位板已经有好几年了，我很喜欢它。但是，当您在解决方案资源管理器中将它与 TFS 或 AnkhSvn 等源代码控制结合使用时，当您不小心将文件移动到不同的目录时，这将是一场灾难。

我目前将 Visual Studio 设置为在要签出文件时提示，但是当已经签出解决方案/项目文件时，上述问题仍然存在。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-07-14T21:19:02.373

Visual Studio 2010 有一个插件会提示您在解决方案资源管理器中拖放文件：http: [//visualstudiogallery.msdn.microsoft.com/en-us/d491911d-97f3-4cf6-87b0-6a2882120acf](http://visualstudiogallery.msdn.microsoft.com/en-us/d491911d-97f3-4cf6-87b0-6a2882120acf)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-06T13:20:03.070

遗憾的是，无法关闭解决方案资源管理器中的拖放功能。

**编辑：此**[Microsoft 论坛](http://social.microsoft.com/Forums/en-US/csharpide/thread/5c20d208-ac72-4f05-9ad2-de3ac5fd5ac1)线程中的第三个帖子（由 Microsoft 员工）证实了这一点。

**编辑：**从 Microsoft connect 上的这个[条目](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=110852)来看，这看起来也是他们无意改进的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-07-29T10:27:31.383

我看起来他们终于尝试在 2017 社区 (15.7.5) 中启用此功能

工具 -> 选项 -> 项目和解决方案 -> 常规 -> “在将文件移动到新位置之前提示”

我之所以说尝试过，是因为我仍然遇到此设置没有显示对话框的情况，因此从 V15.7.5 开始，它仍然有点问题。

# java - Java 数据库轮询器？

> ID：336405
> 
> 赞同：2
> 
> 时间：2008-12-03T07:18:01.820
> 
> 标签：java

是否有任何用于轮询数据库的 JAVA API。

应该可以

**a)**能够从一个表中获取所有数据。
**b)**每可配置的分钟轮询一次。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T08:13:33.347

原则上 JDBC 与 Timer 类结合应该足以处理您提出的要求。

[Timer API 页面](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Timer.html)描述了如何安排可以定期触发的任务。Java 数据库连接上的[维基百科页面](http://en.wikipedia.org/wiki/Java_Database_Connectivity)包含一个非常好的代码示例，说明如何查询特定表上的所有数据。将这两个项目捆绑在一起应该可以满足您的需求。

有更复杂的方法可以实现你想要的，比如使用 Quartz 作为 Job Scheduler。但是对于这样一个简单的应用程序，我可能会坚持使用内置库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T09:07:57.107

从技术上讲，这就是实体 bean 所做的。

因此，如果您愿意，请在 EJB 容器中运行您的代码 :) 我是半认真的：您可以将其配置为非常轻量级（例如 Tomcat+OpenEJB），并且 ejb 3 不会使您的代码依赖在那个技术上。这样可以避免为此任务编写任何代码。

孙医生：

> 调整只读 bean 的一个重要参数是刷新周期，由部署描述符实体 refresh-period-in-seconds 表示。对于 CMP bean，第一次访问 bean 会加载 bean 的状态。刷新周期后的第一次访问会重新加载数据库中的数据。bean 的所有后续使用都使用新刷新的数据（直到另一个刷新周期过去）。对于 BMP bean，现有事务中的 ejbLoad() 方法使用缓存数据，除非刷新周期已过期（在这种情况下，容器再次调用 ejbLoad()）。
> 
> 此参数使 EJB 组件能够定期刷新它所代表的数据库值的“快照”。如果刷新周期小于或等于 0，则永远不会从数据库刷新 bean（如果没有给出刷新周期，则默认行为）。

# c# - ReadToEnd 后关闭 StreamReader

> ID：336414
> 
> 赞同：7
> 
> 时间：2008-12-03T07:28:12.377
> 
> 标签：c#, .net, file-io

在构造中调用 ReadToEnd 方法后是否可以以某种方式关闭 StreamReader，如下所示：

```
string s = new StreamReader("filename", Encoding.UTF8).ReadToEnd(); 
```

任何具有相同语义的替代优雅构造也将被接受。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-03T07:44:49.303

我认为您真正追求的方法是[File.ReadAllText](http://msdn.microsoft.com/en-us/library/system.io.file.readalltext.aspx)，如果您只是想以尽可能短的代码从文件中读取所有文本。

如果您不指定编码，它将自动使用 UTF-8。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T07:36:03.690

您可以使用*[using](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx)*语句，它会*自动*关闭流：

```
string s = null;    
using ( StreamReader reader = new StreamReader( "filename", Encoding.UTF8 ) { s = reader.ReadToEnd(); } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T07:36:58.490

不，没有，但使用继承 IDisposable 形式的处置对象始终是一个好习惯。如果您不在循环中执行此操作，则会出现内存泄漏

```
string s = string.Empty;
using(StreamReader sr = new StreamReader("filename", Encoding.UTF8))
{
  s = sr.ReadToEnd();
} 
```

# asp.net-mvc - ScottGu 写博客后，ASP.NET MVC 发生了很大变化？

> ID：336415
> 
> 赞同：0
> 
> 时间：2008-12-03T07:29:00.240
> 
> 标签：asp.net-mvc

我正在阅读 ScottGu 关于 ASP.NET MVC 的博客，发现很多代码无法编译或无法按预期工作。

[http://weblogs.asp.net/scottgu/archive/2007/11/13/asp-net-mvc-framework-part-1.aspx](http://weblogs.asp.net/scottgu/archive/2007/11/13/asp-net-mvc-framework-part-1.aspx) [http://weblogs.asp.net/scottgu/archive/2007/12 /03/asp-net-mvc-framework-part-2-url-routing.aspx](http://weblogs.asp.net/scottgu/archive/2007/12/03/asp-net-mvc-framework-part-2-url-routing.aspx)

那么，在他的博客之后，ASP.NET MVC 是否发生了巨大的变化？关于 ASP.NET MVC 的最新在线教程吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T07:35:59.133

该代码基于 asp.net mvc 1.0 Preview2。第 1 版已发布，第 2 版目前处于测试阶段。查看[http://asp.net/mvc](http://asp.net/mvc)上的示例以获取更新的示例

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T07:38:11.343

看看这里：

[http://www.asp.net/mvc/](http://www.asp.net/mvc/)

它发生了很大变化，它于 10 月在洛杉矶的 PDC 上作为新的测试版呈现......

# php - preg_replace 正在替换 $ 符号

> ID：336416
> 
> 赞同：0
> 
> 时间：2008-12-03T07:30:07.633
> 
> 标签：php, regex

我有以下代码将“模板标记”（例如 %POST_TITLE%）替换为名为 $post_title 的变量的内容。

```
function replaceTags( $template, $newtext ) {
    $template = preg_replace( '/%MYTAG%/', $newtext, $template );
    return $template;
} 
```

问题是当 $post_full 中有一个 '$' 时，返回的结果会被删除。例如：

```
$template = "Replace this: %MYTAG";
$newtext = "I earn $1,000,000 a year";

print replaceTags( $template, $newtext );

// RESULT
Replace this: I earn ,000,000 a year"; 
```

我知道这与没有正确转义 $newtext 中的 $1 有关。我曾尝试使用 preg_quote() 但它没有达到预期的效果。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T07:49:24.583

嗯，既然你实际上并没有在那里使用正则表达式，为什么不直接使用`str_replace`？它会更快，你不会有这样的奇怪问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T07:37:02.377

根据[preg_replace 手册](http://theserverpages.com/php/manual/en/function.preg-replace.php)， preg_replace() 将 this( `$1`) 视为**[反向引用](http://www.regular-expressions.info/brackets.html)**。
（而不是preg_replace 手册页的评论中提到的“~~回调语法~~
”。 谢谢[Jan Goyvaerts](https://stackoverflow.com/users/33358/jan-goyvaerts)）。

```
$newtext = preg_replace("!" . '\x24' . "!" , '\\\$' , $newtext ); 
```

应该照顾你的'$'标志

# dataset - 如何以编程方式更改 DataSet SqlCommand CommandText

> ID：336423
> 
> 赞同：0
> 
> 时间：2008-12-03T07:37:22.767
> 
> 标签：dataset, sqlcommand

我有一个带有一堆表的生成数据集。在一个表中，我有一个自定义查询，用于选择 15 岁以上的人。我想在工作程序期间更改此查询，以便查询看起来像“从年龄 > 17 岁的人中选择 *”。现在它看起来像“从年龄 > 15 岁的人中选择 *”。

我只知道这个查询在 DataSet 中的名称是什么。这是GetNotYoungPeople。你能帮我解决这个问题吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-10T10:27:25.443

它可能是[SQLDataAdaptor.SelectCommand的一部分](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldataadapter.selectcommand.aspx)

DataSet 由[SQLDataAdaptor.Fill](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldataadapter.fill.aspx)方法填充，并且本身没有附加查询

# networking - 路由器后面的客户端服务器程序

> ID：336437
> 
> 赞同：0
> 
> 时间：2008-12-03T07:50:23.800
> 
> 标签：networking, udp

我正在尝试运行客户端服务器 UDP 程序。我的两台机器都在不同的网络中。我在路由器中设置了端口转发。

我的服务器有两个 IP 地址：1）外部 200.?.?.? 2) 内部 192.168.0.100

在创建 UDP 服务器时，我需要创建一个绑定到地址的套接字。

我应该将套接字绑定到哪个地址，外部还是内部？

我尝试使用内部地址，但没有从客户端获取任何数据。

建议...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T08:04:56.237

鉴于您说您设置了端口转发，您是否在 UPD 程序中分配了正确的端口？还是您只是将数据发送到 IP 地址？如果您指定外部 IP 地址和端口号，则路由器上的端口转发应将其发送到网络上的相应节点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-06T13:03:28.173

如果您必须绑定到特定地址，那么它将是内部地址，而不是外部地址。

路由器上 NAT 的全部意义在于向外界隐藏您的内部网络寻址方案。路由器的 NAT 算法将负责将任何入站数据包上的目标 IP 地址重写为正确的内部 IP 地址。

它不起作用表明您的端口转发和/或路由器上的防火墙有问题。除了转发规则之外，您还需要设置特定的防火墙规则来允许流量，这种情况并不少见。

# math - 阅读有关神经网络的书籍（并理解它们）所需的先决条件

> ID：336440
> 
> 赞同：34
> 
> 时间：2008-12-03T07:52:16.433
> 
> 标签：math, computer-science, artificial-intelligence, neural-network

我已经尝试学习神经网络一段时间了，我可以在线理解一些基本教程，并且我已经能够通过部分[神经计算 - 简介](https://rads.stackoverflow.com/amzn/click/com/0852742622)，但即使在那里，我也对很多数学，在前几章之后完全超出了我的想象。即便如此，它也是我能找到的最少的“数学”一书。

不是我害怕数学什么的，只是我还没有学会我需要什么，我不确定我到底需要什么。我目前在我当地的大学就读，正在努力赶上我需要进入 Comp 的 MS 的课程。科学程序（我的学士学位是商业/信息。系统。）我还没有走得很远。根据大学的小课程描述，NN 实际上包含在关于模式识别的电气工程课程中（我觉得这门课程是 EE 对我来说很奇怪），其中有一些我不需要进入 MS Comp 的 EE 先决条件. 科学。程序。

我对这个话题非常感兴趣，并且知道我最终想了解更多关于它的信息，问题是，我不知道我首先需要知道什么。以下是我认为我可能需要的主题，但这只是无知的猜测：

*   单变量微积分（我有过 Calc I 和 II，所以我想我已经在这里介绍过了，只是为了完整性而列出）
*   多变量微积分
*   线性代数（我还没有正式接受这个，但实际上可以理解我在维基百科和其他网站上设法了解的许多概念）
*   离散数学（另一个我没有正式学过，但我自己学了一部分
*   图论
*   概率论
*   贝叶斯统计
*   电路设计
*   其他数学？
*   其他计算机科学主题

显然这里也有神经科学的成分，但是当他们谈论应用于神经网络的书籍时，我实际上并没有遇到任何困难，主要是因为它的概念性

简而言之，有人可以列出一条需要真正理解、阅读书籍并最终实现神经网络的半清晰路径吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-22T00:04:23.960

如果您想要了解这本书所需的大学课程列表，这里是：

*   微积分（I、II 和 III）
*   微分方程
*   线性代数
*   统计（或贝叶斯的良好覆盖）

但是，我在没有 Diff 的 NN 类中做得很好。方程。并且只需要查找我还没有研究过的概念。

您可以采用上述黑盒方法，但如果您真的想了解网络的数学和实现，则必须学习。无论您做什么，要完全掌握更高级的网络都将是一个陡峭的学习曲线。您可以先学习上述课程，也可以开始阅读本书并在维基百科上查找您未掌握的所有内容，然后从这些文章中阅读您必须阅读的内容以理解它们，等等。您会发现，无论哪种方式，您最终都会超越最初的偷看，事情会变得更容易。

如果你告诉我们你为什么要学习神经网络，那就太好了。尽管我不是游戏开发人员或电信开发人员，但在我的职业生涯中我还没有发现它们的单一用途。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-03T08:02:04.027

你不能实现“神经网络”——你最终会实现一种特定类型的神经网络（例如感知器）。有许多不同种类的 NN，每一种都更适合某种特定类型的任务，并且每种都使用一些专门针对该特定类型的数学（而不仅仅是数学）概念。例如，玻尔兹曼机器使用统计热力学（由玻尔兹曼创立）的概念。

至于你的问题：没有明确的目标，就没有明确的（甚至不是“半明确”）的道路。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-03T09:08:43.017

我赞同 zvrba 的想法，即您为自己设定了一个明确的目标。几个指导性问题：你想研究神经网络作为生物网络模型还是计算工具？湾。你对他们的学习方面感兴趣吗？联想记忆？信号处理？C。你想了解复杂的理论吗？还是只够写模拟软件？

另外，我会从小事做起：用你最喜欢的编程语言实现一个[感知器。](http://en.wikipedia.org/wiki/Perceptron)数学并没有那么糟糕，它可能会让你专注于你的下一步。使用二进制分类数据集，比如[UCI 的井字游戏残局](http://archive.ics.uci.edu/ml/datasets/Tic-Tac-Toe+Endgame)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-22T00:07:12.410

对于基本的反向传播神经网络，最重要的是：

*   结石

*   线性代数

*   基本统计/概率

如果你只是在寻找更具体的主题（你说你已经学过 Calc，所以我会省略它），如果不一定直接适用于构建神经网络，这里有一些有用的主题：

*   求解线性方程组（您将在线性代数课程中学习）

*   最小二乘回归

*   优化理论

您应该意识到，除了神经网络之外，还有其他几种方法可以用来解决某些问题。

通常，解决问题最困难的方面是确定使用的最佳方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-12-14T05:24:51.383

即使我在 2018 年回答它，但我认为它会帮助很多尝试学习神经网络的新手。在线提供的所有在线课程材料都希望读者具有高度的数学知识或经验。Tariq Rashid 有一本书叫“建立你自己的神经网络”。它希望读者具备高中数学知识。就这样 。在本书的最后，您将能够编写一个程序来读取您的笔迹。

# javascript - 使用 C# 在 ASP.NET 中使用 Ajax 上传文件

> ID：336446
> 
> 赞同：2
> 
> 时间：2008-12-03T07:58:15.140
> 
> 标签：javascript, jquery, ajax

我需要使用 FileUpload 上传图像而不使用回发（使用 Ajax）。我尝试了很多示例。但所有回发即将到来，或者他们正在使用 PHP。谁能帮我在 ASP.Net 中使用 ajax 进行单文件上传或多文件上传用 C#。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T08:15:58.990

SWF上传

[http://demo.swfupload.org/v220beta3/simpledemo/index.php](http://demo.swfupload.org/v220beta3/simpledemo/index.php)

[http://swfupload.org/](http://swfupload.org/)

Javascript 和 Flash，没有回发 :) 并且网站上有可用的 .NET 实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T08:21:01.070

希望您觉得这个有帮助。

[http://aspalliance.com/1442_Building_AJAX_Enabled_File_Uploading_System_with_Progress_Bar_Using_ASPNET_20.all](http://aspalliance.com/1442_Building_AJAX_Enabled_File_Uploading_System_with_Progress_Bar_Using_ASPNET_20.all)

它使用 asp.net 和 ajax。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T08:15:12.580

正如其他人所说，如果没有回发，您将无法完全做到这一点，但您可以在该过程中添加一些不错的 ajax 功能。史蒂夫桑德森在这里写了一个很好的演练：

[http://blog.codeville.net/2008/11/24/jquery-ajax-uploader-plugin-with-progress-bar/](http://blog.codeville.net/2008/11/24/jquery-ajax-uploader-plugin-with-progress-bar/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T08:51:52.787

我个人使用过这个：[Ajax Uploader](http://ajaxuploader.com/) - 请注意不是免费的，但相当不错。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-03-11T22:01:39.057

我也使用[Ajax 上传器](http://ajaxuploader.com)。它非常适合我的项目，它允许您将文件上传到 Web 服务器而无需刷新页面。

这是一个[演示页面](http://ajaxuploader.com/demo/Ajax-based-user-profile.aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T08:04:02.057

没有 ajax 文件上传之类的东西。您看到的组件要么使用 Flash swfupload，要么使用隐藏的 iframe，它们向其发布表单，给人以 ajax 方式发生的印象。有许多插件可以帮助您做到这一点。我最喜欢的是[这个](http://jquery.webunity.nl/)使用 jquery 和 swfupload

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T08:07:57.120

您无法通过 JS 访问文件输入字段的内容。这是出于安全考虑。虽然您可以做的是创建一个 iframe 并从按钮仅提交该 iframe 再次可以包含您的文件输入字段...

这会给 Ajax 文件上传控件的“印象”......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-29T11:22:24.790

正如其他人所说，文件上传需要回发。在任何更新面板中，您应该将文件上传控件注册为脚本管理器的回发控件。此外，您可能会[查看 Telerik 上传控件](http://demos.telerik.com/aspnet-ajax/upload/examples/overview/defaultcs.aspx)以了解它应该是什么。

# mysql - 是否可以合并这些（长）mysql 查询？

> ID：336451
> 
> 赞同：1
> 
> 时间：2008-12-03T07:59:17.167
> 
> 标签：mysql

好吧，我的困境是这样的。我有一个管理页面，用于获取当天提​​交给我的一个网站的摘要。此摘要页面从多个表中提取数据，其中一些存储实际媒体数据，其他存储网站 url、id 和所有者，另一个表存储日常统计数据以计算每个域的输入/输出比率。

这个管理页面有一个主查询，它提取实际的媒体数据，看起来像这样（简化）：

```
SELECT 
    content.con_catid,
    content.con_posttime,
    content.con_url,
    content.con_id,
    content.con_title,
    categories.name, 
    users.username, 
    users.user_id, 
        FROM content
        LEFT JOIN categories 
        ON (content.con_catid = categories.id) 
        LEFT JOIN users
        ON (content.con_poster = users.user_id)  
        WHERE con_status = 0 ORDER BY con_posttime 
```

非常坦率的。然后，这就是它变得混乱的地方。对于它每次循环 mysql_fetch_array 语句（输出每个内容项），我还运行这两个查询：

```
SELECT count(con_id) as pending FROM content WHERE con_poster = '$this_userid' AND con_status = 0

SELECT count(con_id) as approved FROM content WHERE con_poster = '$this_userid' AND con_status = 2 
```

这些获取拥有提交的每个用户的待处理和已批准项目的数量（列在每个提交旁边。

然后是杀手，它增加了页面执行时间，因为它还必须为初始查询的每一行重复。

```
SELECT website_url, 
website_id, 
website_shady, 
COALESCE(sum(dstats_hits),0)+website_in_ballast as total_in, 
COALESCE(sum(dstats_hits_out),0)+website_out_ballast as total_out, 
sum(dstats_hits_out_paid) as total_paid, 
website_in_ballast, 
website_out_ballast 
  FROM websites 
    LEFT JOIN domain_stats ON (websites.website_id = domain_stats.dstats_domid) 
    WHERE website_id IN (SELECT website_id FROM websites WHERE website_userid = $this_userid)
    GROUP BY website_url 
```

有什么办法可以将后三个查询合并到第一个查询中吗？因为现在......如果我在队列中有 100 个项目，那就是 301 个查询（如果包含子查询，则为 401 个），这需要一段时间才能生成页面。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T09:55:48.960

我还没有考虑第三个附加查询，但是对于前两个，您可以执行以下操作：

```
SELECT count(con_id) as pending, con_poster FROM content 
WHERE con_status = 0
GROUP BY con_poster 
```

然后将它们加入到 con_poster 上的第一个查询中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T10:02:49.943

这个功能对我来说很方便，也许它也会帮助你。您可以使用查询作为您的选择之一。

```
SELECT 
    col_1,
    col_2,
    col_3,
    (
        SELECT col_1
        FROM table_2
        WHERE table_2.col_2 = table_1.col_1
    ) as 'col4',
    col_5
FROM
    table_1 
```

完全合法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T10:04:23.063

嗯...第一个查询只是选择内容项，而其他查询选择有关它们的一些统计信息。第一个查询不使用任何聚合函数，而其他所有查询都使用。因此，我可以看到您加入它们的唯一方法是使用子查询。它不会使执行计划变得更好，但它会为您节省几百个查询解析和结果集生成，所以它应该会更快一些。

一个提示 - 中间的两个查询可以像这样连接在一起：

```
SELECT
    count(case when con_status=0 then 1 else null end) as pending,
    count(case when con_status=2 then 1 else null end) as approved
FROM
    content
WHERE
    con_poster = '$this_userid' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T10:11:58.477

为特定的 user_id 再加入一次内容将使您也有可能进行计数。

```
选择
        content.con_catid,
        content.con_posttime,
        content.con_url,
        content.con_id,
        content.con_title,
        类别.名称，
        users.username,
        users.user_id,
        IFNULL(SUM(CASE WHEN c2.con_status = 0 THEN 1 ELSE 0 END), 0) 挂起，
        IFNULL(SUM(CASE WHEN c2.con_status = 2 THEN 1 ELSE 0 END), 0) 已批准
    从内容
    左连接类别
       开（content.con_catid = categories.id）
    左加入用户
       开（content.con_poster = users.user_id）  
    LEFT JOIN content as c2 ON users.user_id = c2.con_poster

    哪里 con_status = 0

    GROUP BY content.con_id
    按 con_posttime 排序

```

这是未经测试的。您可能能够加入内容两次并使用 COUNT(DISTINCT c2.con_id) AS 挂起和 COUNT(DISTINCT c3.con_id) AS 批准，如果 CASE 语句变慢，则在加入中添加 c2.con_status = 0子句（用于待处理的帖子）。

IFNULL 以防万一您没有任何帖子（这永远不会是真的，因为主要内容行将始终存在。如果您不想计算当前帖子，则可以在 JOIN 子句中禁止当前帖子。）

对于最后一个查询，我将为您正在处理的所有用户选择所有信息（保存所有 ID，然后使用 user_id IN() 或子选择来调用它（取决于您如何进行选择）。

然后用代码对数据进行排序和处理。这最大限度地减少了查询的数量。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T10:21:07.757

这是将其变成一个巨大查询的另一种尝试。虽然不知道会多快...

**编辑：**好的，第三次尝试。如果您设置正确的索引，这实际上应该非常快。

```
SELECT 
    content.con_catid,
    content.con_posttime,
    content.con_url,
    content.con_id,
    content.con_title,
    categories.name, 
    users.username, 
    users.user_id, 
    stats1.website_url, 
    websites.website_id, 
    websites.website_shady,
    websites.website_in_ballast, 
    websites.website_out_ballast,
    (SELECT COALESCE(sum(dstats_hits),0)+website.website_in_ballast FROM domain_stats WHERE websites.website_id = domain_stats.dstats_domid) as total_in,
    (SELECT COALESCE(sum(dstats_hits_out),0)+website_out_ballast FROM domain_stats WHERE websites.website_id = domain_stats.dstats_domid) as total_out,
    (SELECT sum(dstats_hits_out_paid) FROM domain_stats WHERE websites.website_id = domain_stats.dstats_domid) as total_paid,
    (SELECT count(c2.con_id) FROM content c2 WHERE c2.con_poster = user.user_id AND con_status = 0) as pending,
    (SELECT count(c2.con_id) FROM content c2 WHERE c2.con_poster = user.user_id AND con_status = 2) as approved
FROM
    content
    LEFT JOIN categories ON (content.con_catid = categories.id) 
    LEFT JOIN users ON (content.con_poster = users.user_id)
    LEFT JOIN websites ON (website_userid=users.user_id)
WHERE
    con_status = 0
ORDER BY
    con_posttime 
```

# ruby-on-rails - 在 Ruby on Rails 中对 RESTful POST 进行功能测试

> ID：336452
> 
> 赞同：7
> 
> 时间：2008-12-03T07:59:29.647
> 
> 标签：ruby-on-rails, ruby, unit-testing, rest, post

我想为我在 Ruby on Rails 应用程序中工作的 RESTful Web 服务编写功能测试。

测试是一个 POST 请求，其中请求的主体是纯 XML 文档而不是表单。有关如何执行此操作的任何指示？我遇到的问题是如何在对 post 方法的调用中指定正文 XML。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-04T03:40:27.783

以下对我有用：

```
@request.env['RAW_POST_DATA'] = MY_XML_STRING
post :create 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T13:33:41.547

您可以通过设置`@request.env['RAW_POST_BODY']`为所需的输入流来做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-13T17:23:26.917

[我在http://de.softuses.com/6051](http://de.softuses.com/6051)找到了以下解决方案

```
message = '<?xml version="1.0" encoding="UTF-8"?>
<tag>content</tag>'

@xml_request_headers ||= {}
@xml_request_headers['HTTP_ACCEPT'] = @xml_request_headers['CONTENT_TYPE'] = 'application/xml'

post '/controller/action.xml', message, @xml_request_headers 
```

我实际上是`@xml_request_headers`在我的`setup`方法中定义的，并且可以在这个文件的所有测试中使用它。`test_helper.rb`如果更多文件需要它，也许将它放在一个好主意。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-03T12:54:24.530

查看[shoulda](http://github.com/thoughtbot/shoulda/tree/master)的“should_be_restful”宏。该宏将很快从 shoulda 中[弃用](http://thoughtbot.lighthouseapp.com/projects/5807/tickets/78-deprecate-should_be_restful)，并且仅在 in [willa](http://github.com/seanhussey/woulda/tree/master) gem 中可用。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-12T13:51:13.477

我刚刚使用 Net:HTTP 编写了一个测试脚本来测试 REST 服务。

# c# - 如何将数据字符串传递给 C# 中以编程方式加载的自定义用户控件

> ID：336453
> 
> 赞同：0
> 
> 时间：2008-12-03T07:59:58.977
> 
> 标签：c#, controls, pass-data

我编写了一个自定义用户控件，它返回一些用户特定的数据。要加载自定义用户控件，我使用以下代码行：

```
UserControl myUC = (UserControl).Load("~/customUserControl.ascx"); 
```

但是我怎样才能`string user`在用户控制里面访问`myUC`呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T08:15:06.403

假设您的自定义用户控件的名称是“MyUserControl”

试试这个代码：

```
MyUserControl myUC = (UserControl).Load("~/customUserControl.ascx") as MyUserControl;
string result = myUC.user; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T08:54:12.500

让我们称您的用户控件为“Bob”

如果您从 Bob 中的 UserControl 继承，那么我想这样做是安全的：

```
Bob b = (Bob).Load("~/customUserControl.ascx"); 
```

对于用户部分，我无法真正遵循您想要做什么，是您创建“Bob”用户控件并且您想在“Bob”用户控件中设置属性还是类中的“用户”其他方式？

对于第一个，您应该在用户控件中创建一个属性。

```
class Bob : UserControl{
public string User { get; set;}
} 
```

然后在创建“Bob”实例后设置它。

```
b.User = theuser; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T08:14:59.553

您需要将加载的控件转换为实际类型并使用其公共属性：

```
MyUserControl myUCTyped = (MyUserControl)myUC;
myUCTyped.ThePublicProperty = "some value"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T09:03:28.253

感谢到目前为止。我的代码和上面写的完全一样：

```
public partial class todo : System.Web.UI.UserControl
{
    private string mysecondteststring;
    public string setValue
    {
        get
        {
            return mysecondteststring;
        }
        set
        {
            mysecondteststring = value;
        }
    }
    protected void Page_Load(object sender, EventArgs e)
    {
        // my code
    }
} 
```

但我无法在我的 Web 服务代码中创建 poll 实例。我忘记了什么吗？

--> 忘记将`Reference`.aspx 页面添加到动态加载用户控件的地方。它现在可以与普通的 .aspx 页面一起使用。示例代码可以在[这里找到](http://cid-5ccba32911d4030f.skydrive.live.com/self.aspx/Programming/dynamically%20add%20custom%20user%20controls.zip)

Does anyone of you know how user controls can be added in Web Services aswell, because the Reference Attribute isn't available there?

# java - 在具有两个计时器的类中，它们是否在两个单独的线程中执行？

> ID：336459
> 
> 赞同：2
> 
> 时间：2008-12-03T08:02:31.107
> 
> 标签：java, timer

在 java 类中，我有两个计时器

```
TimerTask t1 = new TimerTask() {.. }
TimerTask t2 = new TimerTask() { ...} 
```

作为两个单独的线程执行和`t1`执行？`t2`你如何验证它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T08:08:29.193

您需要将每个都`TimeTask`放在 a`Timer`中，这将产生线程。来自 API 手册`Timer`：

> 对应于每个 Timer 对象的是单个后台线程，用于按顺序执行所有计时器的任务。定时器任务应该很快完成。如果一个定时器任务花费了过多的时间来完成，它就会“占用”定时器的任务执行线程。反过来，这可以延迟后续任务的执行，这些任务可能会在（如果）有问题的任务最终完成时“聚集”并快速连续执行。

# java - .NET 相当于现代 Java Web 架构

> ID：336464
> 
> 赞同：5
> 
> 时间：2008-12-03T08:05:59.183
> 
> 标签：java, .net, spring, ado.net, transactions

几乎每个新的 Java-web-project 都使用现代 MVC 框架，例如用于 Web 层的 Struts 或 Spring MVC，用于“服务”/业务逻辑层的 Spring，以及用于持久性的 ORM 映射器（例如 Hibernate）。.NET 中的等价物是什么？

我猜 ASP.NET 用于 Web 层，ADO.NET 用于持久性，但与 Spring 等价的是什么，即用于连接事务和组件等。

我知道 Spring.NET，但我对在 .NET 中构建应用程序的实际方式更感兴趣。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T08:20:21.290

默认方法是重新发明轮子的 ADO.NET/Linq-to-Sql、ASP.NET 和自定义服务层。Microsoft 有用于自动装配的 Unity，但我认为依赖注入在 .NET 世界中还不是主流。

但如果你追求最佳实践，它是用于 UI 的 ASP.NET MVC，用于连接的任何 DI 框架（Castle、Unity、Autofac，...），以及用于持久性的 NHibernate。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T08:12:19.403

像这样的东西？

[http://www.asp.net/mvc/](http://www.asp.net/mvc/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T08:14:06.840

.NET 中没有事实上的数据访问方式。

选项包括：

*   ADO.NET 数据读取器*
*   ADO.NET 数据表*
*   LINQ 到 SQL*
*   休眠
*   ADO.NET 实体框架*
*   类型化数据集*
*   春天.NET
*   CSLA.Net

请注意带有 * 的那些，这些是 Microsoft 本身提供的当前产品。我跳过了那些我不记得如何拼写的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T10:02:54.873

ASP.NET MVC + 更适合您工作的数据访问。

还有许多其他框架、工具和库可以提供帮助，例如 Castle、Ninject、Nunit、NLog 等。

但我相信对您的问题的更好回答是“视情况而定”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T19:45:02.127

实际上，CSLA 不提供任何数据访问。数据访问实现由您决定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T19:55:13.477

请注意，ASP.NET MVC 还不是 RTM，但我们多年来一直在使用 ASP.NET Web 表单（从 .NET 1.0 开始）。

# .net - 在 .Net 中将 Tiff 文件转换为 pdf 的免费工具或库

> ID：336466
> 
> 赞同：5
> 
> 时间：2008-12-03T08:07:19.290
> 
> 标签：.net, asp.net, pdf, tiff

有人知道在 Asp.Net 1.1 中将多页 tiff 转换为 pdf 的免费工具或库吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T01:40:23.993

[PDFSharp](http://pdfsharp.com/PDFsharp/)或 [iTextSharp](http://itextsharp.sourceforge.net/)怎么样？在寻找免费图书馆时，我通常先搜索 sf.net。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T00:57:41.273

使用[ImageMagick](http://www.imagemagick.org/script/index.php)。

```
convert screenshot.tiff screenshot.pdf 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-01T17:33:25.980

[LibTiff.Net 库](https://bitmiracle.com/libtiff/)和[tiff2pdf 实用程序](https://github.com/BitMiracle/libtiff.net/tree/master/Tiff2Pdf)（与库一起提供源代码）可用于将 TIFF 图像转换为 .NET 中的 PDF 文档

该库和实用程序使用 .NET 2.0，但您可能无需修改即可构建 .NET 1.1 版本。该库和实用程序是免费和开源的，它们的代码不使用泛型和 .NET 1.1 中没有的其他东西。

免责声明：我是图书馆的维护者之一。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T09:12:31.090

Persist 软件的 ASPPDFlib.dll 可能会对您有所帮助。[http://www.asppdf.com/download.html](http://www.asppdf.com/download.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T03:26:12.660

查看 PDF Creator [http://www.pdfforge.org/products/pdfcreator](http://www.pdfforge.org/products/pdfcreator)

我知道您可以编写脚本，但我不知道您是否可以通过 ASP.NET 对它执行任何操作。无论哪种方式，看起来都不会伤害。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T05:06:12.340

我以前必须在 asp.net 中执行此操作（实际上是 JPG 到 PDF，但足够接近……）我使用 ImageMagick 并对其进行了处理。我知道它不是本机 c# 代码，但它是免费的，而且运行良好。只需运行这样的命令行：

cmd /c 转换 "c:\blah\original.tiff" "c:\blah\destination.pdf"

我使用 'cmd /c' 的原因是没有它，我会遇到 System.Diagnostics.Process.Start 弄乱参数的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-08-14T09:19:45.087

使用 PdfFoucs dll 只需 4 行代码即可将 PDF 转换为 Image、Word、Text 格式。无需为此安装任何 exe。

MultiTiff 图像中的转换代码：

```
SautinSoft.PdfFocus f = new SautinSoft.PdfFocus();
f.OpenPdf(FilePath);

if (f.PageCount > 0)
{
    f.ToMultipageTiff(FilePath);
} 
```

PDF中有基于homany页面在Tiff Image中转换的代码：

```
SautinSoft.PdfFocus f = new SautinSoft.PdfFocus();
f.OpenPdf(FilePath);

if (f.PageCount > 0)
{
    for (int i = 0; i < f.PageCount; i++)
    {
       f.ImageOptions.Dpi = 200;
       System.Drawing.Bitmap bmp1 = (System.Drawing.Bitmap)f.ToDrawingImage(i + 1);
       bmp1.Save(Server.MapPath("~/FileUpload/") + filename + "_" + (i + 1) + ".tiff");
     }
} 
```

Word中的转换代码：

```
SautinSoft.PdfFocus f = new SautinSoft.PdfFocus();
f.OpenPdf(FilePath);

if (f.PageCount > 0)
{
    f.ToWord(FilePath);
} 
```

只有您需要在应用程序中添加 DLL。sautinsoft 网站上提供试用版和许可版

# c++ - 滚动我自己的异常

> ID：336475
> 
> 赞同：1
> 
> 时间：2008-12-03T08:13:04.707
> 
> 标签：c++, exception

我正在编写一些将引发自定义异常的新代码 - 我想包含一个错误字符串和一个状态代码。哪个类应该是异常派生的？ `std::exception`? `std::runtime_error`? 还有其他需要担心的“问题”吗？我正在考虑以下内容：

```
class MyException : public std::exception(?)
{
public:
    enum Status
    {
        ERROR_FOO,
        ERROR_BAR,
        ...
    };

    MyException(const std::string& error, Status code) :
        error_(error), code_(code)
    {
        ...
    }

    virtual const char* what() const
    {
        return error_.c_str();
    }

    Status code() const
    {
        return code_;
    }
private:
    std::string error_;
    Status code_;
}; 
```

然后在代码中：

```
throw MyException("Ooops!", MyException::ERROR_BAR); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-03T08:56:57.520

Boost 有一个关于[错误和异常](http://www.boost.org/community/error_handling.html)处理的精彩文档，其中讨论了常见的陷阱以及如何正确地从 std::exception(s) 继承。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T08:22:19.023

考虑状态码是否真的合适。创建异常类的层次结构通常更好。这样，调用者可以更好地控制处理哪些异常以及如何处理，并且使接口更简单。

当然，有时状态码仍然是合适的（编译器一直使用它们）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T08:30:58.070

您可以使用任何标准异常类型作为基础，但如果您选择正确的类型，它将真正帮助该类的用户（包括您自己）：

*   如果错误是可以避免的，如果用户更加小心或精确，则使用**logic_error**。
*   如果它是来自系统的用户无法阻止的东西，请使用**runtime_error**。

当然，`invalid_argument, range_error, bad_cast`如果可以更好地描述错误，您也可以使用其他标准派生异常之一（例如 ）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T08:49:10.903

您的异常类不是异常安全的。如果 std::string 的复制构造函数抛出异常，程序将被终止。

```
class MyException : public std::exception
{
public:
    enum Status
    {
        ERROR_FOO,
        ERROR_BAR,
        ...
    };

    MyException(const char* error, Status code) :
        std::exception(error),
        code_(code)
    {
        ...
    }
    ...
private:
    Status code_;
}; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T08:49:31.963

在这方面非常有用的资源是 Marshall Cline 的[C++ FAQ LITE](http://www.parashift.com/c++-faq-lite/)。他有一章关于[异常和错误处理](http://www.parashift.com/c++-faq-lite/exceptions.html)，可能对您有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T17:23:41.473

析构函数和 what() 方法都应该标记为 no throw。
在 MS-Studio 中，它忽略了 throw 限定符并编译得很好，但是为了符合标准和可移植性，您应该将它添加到您的代码中。

```
// What is a no throw operation.
virtual const char* what() const throw ()
{
    return error_.c_str();
} 
```

### 其他的建议：

我不会直接从异常继承。
查看从异常派生的标准异常，看看是否符合要求。

而不是使用错误代码。您可以使用异常类型的层次结构。这样更容易捕捉。

```
class MyException: public std::runtime_error
{  // STUFF  .. Put all the error message stuff here
};

class MyFOO_Exception: public MyException
{  // STUFF
};

class MyBAR_Exception: public MyException
{  // STUFF
} 
```

# apache - 在 Proxy 后面使用 Apache

> ID：336487
> 
> 赞同：0
> 
> 时间：2008-12-03T08:18:15.663
> 
> 标签：apache, proxy

我想在我的本地机器上运行一个 Apache，因为我只能通过 ajaxterm（基于 web 的 ssh 客户端）ssh 进入我的服务器，这让我很头疼。现在我的问题是，我正在运行此服务器，并且必须通过公司代理发送流量，该代理也具有用户身份验证和密码。我有一个 .pac 文件，所以如果我可以告诉 Apache 使用它并在某个地方输入我的密码和用户名，那就太好了。

编辑：

我还想要一个重定向 ProxyPass /ajax [http://website.com](http://website.com)
ProxyPassReverse /ajax [http://website.com](http://website.com)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T08:42:13.790

我不确定我是否正确理解了这个问题，所以让我改述一下：

*   您在本地计算机上运行了 Apache 服务器
*   您通常使用代理连接到互联网
*   这个代理有一个 .pac 配置文件
*   您想从 Internet 访问本地 Apache 服务器
*   我不明白这张图片中 SSH 和 AjaxTerm 做了什么。

首先，这看起来不像是一个编程问题，所以您最好在[Apache 邮件列表中](http://httpd.apache.org/lists.html#http-users)询问它。也就是说，可能存在一些误解。您用于访问 Internet 的代理就是我们所说的“转发代理”，它处理从您公司内部的客户端到您公司外部的服务器的流量。

您需要的是“反向代理”，它处理从公司外部的客户端到公司内部服务器的流量。（请注意，这两个功能可以在同一个代理上配置——一个代理可以同时是反向代理和正向代理）。

您拥有的 .pac 文件是一种配置浏览器以通过代理访问 Internet 的方法。您需要配置代理以将流量转发到您的网络服务器。此配置不会在您的本地 Apache 服务器上完成，而是在代理本身上完成。因此，您必须与此代理的管理员交谈...

# mysql - MySQL SQL 查询分析和查询成本工具和技术

> ID：336495
> 
> 赞同：1
> 
> 时间：2008-12-03T08:24:14.217
> 
> 标签：mysql, profiling

在使用 Microsoft SQL Server 时，我发现 SQL Server Profiler 和 Estimated Execution Plan（在 Management Studio 中可用）在开发和生产系统监控期间优化查询非常有用。

是否有可用于 MySQL 的类似工具（开源或商业）或技术？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T08:43:09.590

您可以使用 获取有关如何执行查询的信息[`EXPLAIN`](http://dev.mysql.com/doc/refman/5.0/en/explain.html)。

例如：

```
EXPLAIN SELECT * FROM foo INNER JOIN bar WHERE foo.index = 1 AND bar.foo_id = foo.id 
```

然后它会告诉您将使用哪些索引，表将按什么顺序连接，它希望从每个表中选择多少行等等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-18T00:19:01.130

正如 RoBorg 建议的那样，您可以使用 EXPLAIN 来显示 MySQL 将如何执行您的查询的详细信息。我发现[这篇文章](http://dev.mysql.com/doc/refman/5.0/en/using-explain.html)更有用，因为它告诉您如何解释结果并改进您的 SQL。

这些关于[查询缓存配置](http://dev.mysql.com/doc/refman/5.0/en/query-cache-configuration.html)和[使用 ALTER TABLE](http://dev.mysql.com/doc/refman/5.0/en/alter-table.html)添加和删除索引的文章也很有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-09-18T14:44:15.747

您也可以查看[http://dev.mysql.com/doc/refman/5.5/en/server-status-variables.html#statvar_Last_query_cost](http://dev.mysql.com/doc/refman/5.5/en/server-status-variables.html#statvar_Last_query_cost)。这将有助于了解查询是否更好，就 CPU 周期或表扫描而言。

```
SHOW STATUS LIKE 'Last_query_cost'; 
```

# java - 您知道哪些用于 Java EE JSP 的标记库，例如 displaytag？

> ID：336502
> 
> 赞同：5
> 
> 时间：2008-12-03T08:27:49.183
> 
> 标签：java, jakarta-ee, tags

您知道哪些用于 Java EE - JSP 的标记库，例如[displaytag](http://displaytag.sourceforge.net/11/)？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T08:59:53.270

在寻找 displaytag 的替代品时，我遇到了[jmesa](http://code.google.com/p/jmesa/)。还没试过，太难了

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-11T03:49:31.293

JMesa 是 eXtremeTable 的继承者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T10:03:11.410

另一种选择是[valuelist](http://valuelist.sourceforge.net/) - 它是 Value List Handler Java EE 模式的相当好的实现，但它的开发似乎以某种方式停滞不前。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-22T13:07:55.637

还有[ExtremeTable](http://code.google.com/p/extremetable/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-31T05:31:23.453

I found [Datatables](http://datatables.net/), which is jquery plugin. It is better than any other grid libraries.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-09T20:37:06.777

还有[jsp数据网格](https://github.com/customweb/jsp-data-grid)库。它允许所有元素（table、td、tr 等）的简单样式。它还与 Hibernate 和 Spring 集成。它还具有 AJAX 模式。

# .net - 使用 .NET 跟踪用户以获取唯一访问者报告的最佳方法？

> ID：336505
> 
> 赞同：2
> 
> 时间：2008-12-03T08:30:28.367
> 
> 标签：.net, cookies, reporting

我通常会使用谷歌分析，因为它是免费且易于实施的，但在这种情况下，我们需要一个内部构建的报告系统。该系统只需要在 .NET 中，因为 JavaScript 不是一个选项。

我的问题是，当您永远无法确定他们是否打开了 cookie 时，您如何跟踪唯一访问者？

我打算通过设置一个带有 GUID 的 cookie 来跟踪它们，然后针对每个页面点击将此 ID 存储在数据库中。问题是，如果他们没有启用 cookie，就不可能知道您是否在每次访问页面时都创建新的 cookie，因为最后一个 cookie 由于它们被禁用而实际上没有被接受。您显然不能使用会话来跟踪它，因为它们在同一条船上。

我想你们中的一些人会说创建几个页面，在用户进入网站之前检查 cookie，但这无济于事，因为用户不会总是从网站上的一个点进入。

谷歌必须设法做到这一点，尽管他们使用 JavaScript。

创建新的跟踪 ID 存在问题的原因是，与应有的情况相比，它会使我的报告失控。假设我有 4 个用户访问，每个用户访问 10 个页面。如果一个用户没有启用 cookie，它会说该网站有 13 个唯一身份访问者。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T09:00:30.117

首先，唯一用户*始终*是一个近似值。没有保证强制使用 cookie 的方法，它们的持久性无论如何也不能完全由您控制，而且 IP 通常代表用户的块（有时是大量的）。这方面的数据质量不好，你只能接受。

[这](http://www.kaushik.net/avinash/2008/07/web-analytics-visitor-tracking-cookies.html)是 cookie 分析的一个很好的入门。

根据我的经验，跟踪 IP 至少提供了一个安全的下限，但您仍在谈论模糊数据。

我知道的所有其他 cookie 替代品都只是暂时的。

其次，“ *JavaScript 不是一个选项*”是什么意思？关闭 JS 会严重限制 ASP.NET 功能（恕我直言），您的选择将更加有限。这是你期待的状态吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T08:42:25.597

当他们/用户使用您的第一页时，我会建议您在您的数据库中通过服务器端代码跟踪用户，例如当他们登录页面时：

借助这个：HttpBrowserCapabilities browser = Request.Browser; 您将获得诸如正在使用哪个浏览器、是否设置了 cookie 等信息……然后根据是否设置了 cookie，您可以操作/跟踪所需的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T09:04:01.000

首先，你永远不会得到 100% 的准确率。时期。话虽如此，您可以做一些事情。

我开始输入如何构建无 cookie 跟踪机制，当我完成一半时，我对自己说：“我自己，ASP.NET 肯定会支持这种开箱即用的东西吗？”。确实：[无 Cookie 会话 ID](http://msdn.microsoft.com/en-us/library/ms178581.aspx#ctl00_rs1_mainContentContainer_ctl91)。这至少可以让您确定哪些请求来自*单个会话*中的特定（尽管仍然是匿名的）用户。

不确定是否可以将其与使用 cookie 混合使用（如果它们可用）（这将产生更好的 URL，并可能让您有机会跨会话跟踪用户），但这可能是一个开始。

# java - 从Java识别蓝牙网络接口？

> ID：336506
> 
> 赞同：1
> 
> 时间：2008-12-03T08:30:30.613
> 
> 标签：java, networking, bluetooth

我需要从 Java 访问蓝牙网络接口。可以通过以下方式访问所有本地网络接口：

```
Enumeration<NetworkInterface> interfaces = NetworkInterface.getNetworkInterfaces(); 
```

这个枚举将包含以太网卡、usb 网络设备等，我需要特别检索蓝牙网络接口。一个不好的解决方案是遍历枚举并解析每个设备的显示名称以获得“蓝牙”，但不确定这是否适用于所有蓝牙接口。有谁知道更好的方法，也许通过某种探测？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T08:53:11.770

我想“最干净的方法”是使用类[LocalDevice](http://www.bluecove.org/apidocs/javax/bluetooth/LocalDevice.html)附带的[JSR 82](http://jcp.org/aboutJava/communityprocess/mrel/jsr082/index2.html) [implementation library](http://weblogs.java.net/blog/brunogh/archive/2007/09/jsr_82_is_not_o_1.html)。

```
LocalDevice.getLocalDevice() 
```

像[BlueCove](http://code.google.com/p/bluecove/)这样的项目可能会成功。

# java - 如何处理 Microsoft Outlook winmail.dat？还有什么惊喜吗？

> ID：336517
> 
> 赞同：7
> 
> 时间：2008-12-03T08:41:45.287
> 
> 标签：java, python, email, jython, winmail.dat

我决定我真的不喜欢微软和他们的方式。请您给我有关如何处理电子邮件中的 winmail.dat 的指示，是否有 jython 库或 java 库可以让我处理这个问题。

我刚刚完成了一个电子邮件处理程序，用 java 5 上的 jython 2.2.1 编写。在最后的负载测试期间，我意识到应该采用标准 MIME 电子邮件格式的附件现在被捆绑在一些破旧的 winmail.dat 中，意味着许多不同的 Outlook 客户端使用这个 winmail.dat 污染互联网，所以这意味着我需要支持 winmail.dat。因此我的程序无法正确处理数据。

请您简要描述一下 winmail.dat 是什么以及为什么它会惹恼我们。

还有什么惊喜可以期待！？到目前为止，我还需要注意什么标准 MIME 电子邮件。盒子里还有其他插孔吗？

非常感谢您的宝贵时间。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T08:59:53.363

在这里阅读：
[http ://en.wikipedia.org/wiki/TNEF](http://en.wikipedia.org/wiki/TNEF)

此处用于解析的包：
[https ://github.com/verdammelt/tnef](https://github.com/verdammelt/tnef)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-06-29T13:07:48.103

主题已关闭，但为了将来的目的：[Apache POI](http://poi.apache.org/)项目（用于 Microsoft 文档的 Java API）正在推出能够解码 TNEF 文件的版本 (3.8)。我对其进行了测试并且工作得很好，甚至是测试版。你可以在[这里](http://poi.apache.org/hmef/index.html)找到它。

与 maven 一起使用（2016 年 6 月 - 当它不再在暂存器中时可能会在以后更改）：

```
 <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-scratchpad</artifactId>
        <version>3.14</version>
    </dependency> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T09:01:25.170

> 请您简要描述一下 winmail.dat 是什么以及为什么它会惹恼我们。

[KB138053](http://support.microsoft.com/kb/138053)

> 当最终用户从 Exchange Windows 或 Outlook 客户端向 Internet 发送邮件时，如果收件人的客户端无法接收 RTF 格式的邮件，则可能会自动将名为 Winmail.dat 的文件附件添加到邮件的末尾。Winmail.dat 文件包含邮件的 Exchange Server RTF 信息，并且可能以二进制文件的形式出现在收件人面前。它对非 Exchange Server 收件人没有用处。

如果您阅读了我进一步引用的 kb，它会提供有关 Exchange 管理员如何能够并且**应该**禁用 RTF 到 Internet 的说明。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T09:01:51.410

所以当我在电子邮件 Content-Type 中看到这个时：“application/ms-tnef”

我用这个： [http ://www.freeutils.net/source/jtnef/](http://www.freeutils.net/source/jtnef/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-05-24T09:45:49.573

只是关于 tinnef 的评论：并非所有名为 winmail.dat 的东西都是普通的 TNEF。从 Outlook 发送的会议邀请不是，因此大多数 TNEF 解码器在这种情况下会失败。
在 Mac OSX 上，我发现“Letter Opener”是少数可以打开此类附件的程序之一。有趣的是，它们还可以包含 rtf 文档。

[http://www.restoroot.org/LetterOpenerPro](http://www.restoroot.org/LetterOpenerPro)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-12-02T20:08:40.517

还有一个纯 Python [tnefparse](https://pypi.org/project/tnefparse/)包。应该可以从 Jython 使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T14:45:16.130

我在 Windows 上使用[wmdecode很幸运。](http://www.biblet.freeserve.co.uk/)当然，它是一个 EXE，而不是一个 java 项目。但是，如果您遇到其他解决方案无法解码的 WINMAIL.DAT 文件，它可能会很有用。

# c# - .NET 中是否有用于通知/警报的库？

> ID：336526
> 
> 赞同：8
> 
> 时间：2008-12-03T08:48:54.570
> 
> 标签：c#, .net, notifications, alerts

我需要设计一个仅用 .Net 编写的通知框架。我想知道是否已经有一些库可用于轻松创建通知规则。

PS：请提供除 SQL Server 通知以外的任何内容。

注意：电子邮件和短信通知中的通知。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T12:20:44.830

我认为值得关注 Windows Live Alerts 等框架：http: [//dev.live.com/alerts/](http://dev.live.com/alerts/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T09:13:56.330

我也在寻找一些解决方案。如果正确理解您，您想要执行也称为“发布/订阅”的操作。这也可以通过称为“企业服务总线”的东西来完成。还有其他方法，如 MSMQ 等。模式和实践中有一些关于使用 WCF 进行发布/订阅和构建 ESB 的文章。

这是一篇讨论使用 WCF 滚动您自己的 ESB 的博客文章：

[http://www.iserviceorientated.com/blog/post/Building+Our+Own+ESB+-+Publish+Subscribe+Part+1.aspx](http://www.iserviceoriented.com/blog/post/Building+Our+Own+ESB+-+Publish+Subscribe+Part+1.aspx)

Juval Löwy 的书：Programming WCF 也有一些关于在 WCF 中进行发布订阅的讨论。

[http://www.amazon.com/Programming-WCF-Services-Juval-Lowy/dp/0596526997](https://rads.stackoverflow.com/amzn/click/com/0596526997)

# algorithm - 欧拉计划问题 214-totients，有意义吗？

> ID：336533
> 
> 赞同：4
> 
> 时间：2008-12-03T08:51:13.583
> 
> 标签：algorithm

我一直在努力[解决这个问题](http://projecteuler.net/index.php?section=problems&id=214)，但我很难理解它：

> 设 φ 为欧拉的总函数，即对于自然数 n，φ(n) 是 k 的个数，1 <= k <= n，其中 gcd(k,n) = 1。
> 
> 通过迭代 φ，每个正整数都会生成一个以 1 结尾的递减数字链。例如，如果我们从 5 开始，则会生成序列 5、4、2、1。以下是长度为 4 的所有链的列表：

```
5,4,2,1
7,6,2,1
8,4,2,1
9,6,2,1
10,4,2,1
12,4,2,1
14,6,2,1
18,6,2,1 
```

> 这些链中只有两个以素数开头，它们的总和是 12。
> 
> 生成长度为 25 的链的所有小于 40000000 的素数之和是多少？

我对此的理解是 φ(5) 是 4, 2, 1 - 即 5 的互质数是 4, 2 和 1 - 但是为什么 3 不在那个列表中呢？至于 8，我会说 4 和 2 不是 8 的互质数...

我想我一定是误解了这个问题......

假设问题的措辞很糟糕，并且 φ(5) 是 4, 3, 2, 1 作为 4 链。我没有找到任何小于 40m 的素数会生成 25 链 - 我找到了一些链24，但它们与非质数有关。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T08:55:05.620

“迭代函数”意味着在它自己的结果上运行函数。如：φ(5) = 4；φ(4) = 2；φ(2) = 1；因此，我们得到了您的 5-4-2-1 链。与所有其他链相同。

# html - 网站上的小字体

> ID：336535
> 
> 赞同：3
> 
> 时间：2008-12-03T08:52:47.387
> 
> 标签：html, css, fonts, typography

我的主要浏览器（FF 和 Chrome）都配置为 12 像素字体。在这两种浏览器中，字体选择器都会显示字体预览，并且它们的大小相同，并且适合阅读网站。我的 IE 不允许我设置字体大小，但似乎默认为比 Chrome 大一点的字体。

在我的个人网站上，我使用 XHTML 和 CSS 并将页面字体指定为“中等”，并将该字体大小用于所有主要文本（“内容”文本）。当我在 IE 7、FF 3 和 Chrome 0.4 中查看该站点时，字体按预期显示并与字体选择器匹配（在 IE 中稍大一点除外）。

**但是**，我访问几乎所有其他网站（Google、StackOverflow、The DailyWTF、CodingHorror、Microsoft、Sourceforge，甚至 W3C 等），它们*都*以微小的微型字体显示——我估计是 5 到 7 像素。

这适用于 3 台不同的计算机，2 台不同的操作系统（Vista 和 XP）和 4 台不同的显示器（笔记本电脑、CRT 和全新的 WS LCD）。

那是怎么回事？我是否忽略了一些我需要知道的关于网站设计的基本知识？还是只是所有这些网站都做了一些愚蠢的事情，比如将字体设置为 50%、0.5 em 或 x-small？为什么网站设计者不能尊重我为内容文本选择的字体（我知道侧边栏和页脚等可能相当小或 x 小）。

我很想认为这只是不知情的网站设计师，但是，见鬼！，这些都是一些大牌网站！

编辑：要清楚，我并不是说使用 em 或 % 是愚蠢的，我想知道为什么许多网站似乎使用了我配置大小的 50%。当然，我配置的大小是我希望在其中看到文本的大小。

编辑：来自 W3C 的 CSS 规范：“下表提供了用于将绝对大小映射到 HTML 标题和绝对字体大小的用户代理指南。***‘中等’值是用户的首选字体大小，并用作参考中间值。*** “ - 强调我的。

* * *

有一个共识是，网站的相对字体大小基于典型的浏览器默认值 16px，这是不幸的，但“这就是生活”。但是其他系统呢？我们可以期望所有浏览器都如此默认吗？

至少我现在明白了这个问题。

在我选择最终答案之前，我想将这个问题暂时搁置一会，看看其他人是否有不同的看法。

* * *

结论：我已将所有浏览器重置为 16px（在我的 125 DPI 机器上为 18px），并将我的网站设置为使用 font-size: 90%。这提供了一个很好的显示尺寸，当然，我最喜欢的所有网站现在都可以阅读了。感谢所有建设性的答案和活泼的来回。

这是一个很棒的社区。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-03T09:02:41.877

大多数浏览器 - 如果不是全部 - 将默认字体大小设置为 16 像素。许多网站也使用相对字体大小。如果您的浏览器的字体大小低于此值，这将导致您出现问题。

考虑一下您的浏览器中默认字体大小为 16 像素的情况。当网站字体为 1.0em 时，将显示为 16px。不过，其他一些文本可能是 0.7em，所以会更小。但是，如果您的默认浏览器字体大小为 12px，则 1.0em 将是 12px，而 0.7em 将无法读取，因为它太小了。

解决方案是将您的默认浏览器字体大小保持为 16 像素，这样您就可以真实地了解其他人在查看您的网站时所看到的内容。哦，使用相对字体大小是最佳实践，而不是错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T09:03:38.957

在大多数现代浏览器中，%age 允许动态呈现。Ctrl- 和 Ctrl+ 是你的朋友。

至少大多数开发人员已经意识到设置固定大小的字体是不好的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T09:52:00.840

我不在乎字体的大小，***只要我能改变它***。这就是我讨厌 Flash 网站的最大原因。不久前，我正在查看某家大公司的招聘页面，字体是 TINY。我的本能反应是按 Ctrl-+（在 Firefox 中），但在 Flash 中呈现的文本无法调整大小！我立即离开了现场。我没有最好的视力，所以我需要能够使小文本变大。

我经常遇到的另一个问题是固定宽度的网站。我使用高分辨率显示器（1600x1200、1280x800 或更高），没有什么比一半以上的屏幕空间空白更让我讨厌的了。更糟糕的是，一些网站，当我把字体变大时，固定宽度并没有变大！有一次，我在将文本放大后尝试阅读一篇文章，每行**三个单词**，右侧有大量空白屏幕空间......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T13:12:20.110

Software Monkey 开始与全世界作战。他完全不同意浏览器呈现字体大小的方式、主要网站以及它们设置字体大小的方式，并试图与该线程的每一张海报进行激烈的争论。

我有一个简单的生活准则。当你认为其他人都错了，你可能就错了。

此外，即使你是对的，与你周围的世界相处往往更聪明，而不是与所有人抗争。

这是一个想法。如果您是一名网页设计师，并且知道超过 99% 的访问者不会修改他们的默认浏览器大小，那么您肯定希望您的网站适合大多数人。这种实用主义解释了当前的情况。

无论如何，祝你在追求中好运。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T09:16:05.780

我在 Chrome 上遇到过这个问题，但不是你所说的那样。然而，有些页面显示的字体非常小，在其他浏览器中看起来还不错。在某些论坛中，每个帖子的字体实际上会变小 - 所以我通常可以阅读第一篇文章，也许是第二篇，但其余的只是像素:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T09:00:49.213

将字体设置为 % 或 em 测量值**并不是**一件愚蠢的事情，实际上它是 W3C 推荐的！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T09:15:15.750

*   使用 css 操作字体大小
*   在 em 中给出字体大小
*   如果字体在不同的浏览器上呈现不同的大小，请为不同的浏览器使用作弊码（例如 # 、 _ ）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T09:21:22.383

回答您的编辑：原因不言而喻。页面的设计者需要传达一组具有不同属性和不同实际字体大小的信息，这是他可以使用的（最早的）排版和布局工具之一。

作为查看者，您可以为自己定义一个舒适的*基线*，但如果设计师希望强调或减轻一段文本的重要性，则取决于他并*为您的利益*。你不应该比 #999 或斜体更嫉妒他 50% 的高度。

所有这一切都取决于设计师是否值得他的盐而不是滥用它，这可能会令人遗憾地发生。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-24T20:59:21.993

我想说，由于每个浏览器都有不同的标准，因此字体的渲染模式也会不同。

# c# - 如果使用了等待句柄，如何显示进度条

> ID：336553
> 
> 赞同：1
> 
> 时间：2008-12-03T09:02:41.750
> 
> 标签：c#, multithreading

在代码的某处，waitHandle 用于执行某些操作。然而，waithandle 的问题是表单在等待某些操作完成时冻结。所以下面的代码不起作用：

```
frmProgressBar.show();
int successOrFail = PerformSynchronousActionUsingWaitHandle();
frmProgressBar.close();
frmMainScreen.show(); 
```

它不起作用，因为 frmProgressBar 会被冻结。我确实需要保留第 1 行、第 3 行和第 4 行，但是如何重写 PerformSynchronousActionUsingWaitHandle() 以使操作仍然同步但显示进度条。我可以通过在不同线程上显示进度条来解决这个问题，但是系统的设计使得这会非常混乱。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T11:46:42.247

您想在线程中运行 PerformSynchronousActionUsingWaitHandle，这样它就不会锁定 ui 线程。

```
 public event EventHandler<WorkCompleteArgs> WorkComplete;
    private void StartClick(object sender, EventArgs e)
    {
        //hook a complete event
        this.WorkComplete += new EventHandler(OnWorkComplete);

        //do start code

        //run the PerformSynchronousActionUsingWaitHandle process in a thread
        Thread thread = new Thread(new ThreadStart(PerformSynchronousActionUsingWaitHandle));
        thread.Start();
    }
    private void OnWorkComplete(object sender, EventArgs e)
    {
        //cross thread
        if (this.InvokeRequired)
        {
            this.BeginInvoke(new EventHandler(OnWorkComplete), new object[] { sender, e });
            return;
        }

        //un hook
        this.WorkComplete -= new EventHandler(OnWorkComplete);

        //do complete code

    }
    private void PerformSynchronousActionUsingWaitHandle()
    {
        Thread.Sleep(1000);
        if (WorkComplete != null)
        {
            //use event args to return the functions result if needed.
            WorkComplete(this, new WorkCompleteArgs(true));
        }
    }

    public class WorkCompleteArgs
    {
         public WorkState {get;private set;}
         public WorkCompleteArgs(bool workState)
         {
             this.WorkState = workState;
         }
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T09:06:21.150

你不能使用 BackgroundWorker 类吗？[http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T09:06:40.620

使用两个不同的线程来处理这个......一个线程用于进度条，一个线程用于 PerformSynchronousActionUsingWaitHandle() .. 希望这在某种程度上有所帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T09:07:13.303

您是否尝试过使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)类？不过，您需要重写执行同步任务的方法。

# java - 这个 Java 错误消息意味着什么？我该如何解决？

> ID：336562
> 
> 赞同：0
> 
> 时间：2008-12-03T09:07:55.407
> 
> 标签：java, soap, axis

尝试与与 SOAP 通信的软件通信时收到此消息？

*   找不到所需的类（javax.activation.DataHandler 和 javax.mail.internet.MimeMultipart）。附件支持被禁用。

我正在使用第三方 API 与 Ardome MAM 系统进行通信。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T09:18:42.530

一个“正常”错误，实际上只是一个警告。如果你真的想使用附件（你可能不会），尝试将activation.jar 添加到应用服务器的类路径中。

# xml - 使用 XSLT 1 根据另一个 xml 过滤 XML

> ID：336572
> 
> 赞同：2
> 
> 时间：2008-12-03T09:14:53.800
> 
> 标签：xml, xslt, filter

我们如何根据另一个 xml 文档过滤一个 xml 文档。我必须删除查找 xml 中不存在的所有元素。输入 xml 和查找 xml 都具有相同的根元素，我们使用的是 XSLT 1.0。

防爆输入

```
<Root>
    <E1 a="1">V1</E1>
    <E2>V2</E2>
    <E3>V3</E3>
    <E5>
       <SE51>SEV1</SE51>    
       <SE52>SEV2</SE52>    
    </E5>
    <E6>
       <SE61>SEV3</SE61>    
       <SE62>SEV4</SE62>    
    </E6>
</Root> 
```

过滤 Xml

```
<Root>
    <E1 a="1"></E1>
    <E2></E2>
    <E5>
       <SE51></SE51>    
       <SE52></SE52>    
    </E5>
</Root> 
```

预期产出

```
<Root>
    <E1 a="1">V1</E1>
    <E2>V2</E2>
    <E5>
       <SE51>SEv1</SE51>    
       <SE52>SEV2</SE52>    
    </E5>
</Root> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T04:40:59.453

这是所需的转换：

```
<xsl:stylesheet 版本="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:z="内联:text.xml"
 排除结果前缀=“z”
 >
    <xsl:output omit-xml-declaration="yes" indent="yes"/>
    <xsl:strip-space elements="*"/>

    <z:过滤器>
        <根>
            <E1 a="1"></E1>
            <E2></E2>
            <E5>
                <SE51></SE51>
                <SE52></SE52>
            </E5>
        </根>
    </z:过滤器>

    <xsl:variable name="vFilter" select=
     "document('')/*/z:filter"/>

    <xsl:模板匹配="/">
      <xsl:apply-templates select="*[name()=name($vFilter/*)]">
        <xsl:with-param name="pFiltNode" select="$vFilter/*"/>
      </xsl:apply-templates>
    </xsl:模板>

    <xsl:template match="*">
      <xsl:param name="pFiltNode"/>

      <xsl:复制>
       <xsl:copy-of select="@*"/>

       <xsl:for-each select="text() | *">
         <xsl:选择>
           <xsl:when test="self::text()">
             <xsl:copy-of select="."/>
           </xsl:when>
           <xsl：否则>
            <xsl:变量名="vFiltNode"
                 select="$pFiltNode/*[name()=name(current())]"/>

            <xsl:apply-templates select="self::node()[$vFiltNode]">
              <xsl:with-param name="pFiltNode" select="$vFiltNode"/>
            </xsl:apply-templates>
           </xsl:否则>
         </xsl:选择>
       </xsl:for-each>
      </xsl:copy>
    </xsl:模板>
</xsl:样式表>

```

当此转换应用于以下 XML 文档时（原始文件加上 `<SE511>SEV11</SE511>`证明**过滤适用于任何级别**：

```
<根>
    <E1 a="1">V1</E1>
    <E2>V2</E2>
    <E3>V3</E3>
    <E5>
        <SE51>SEV1</SE51>
        <SE511>SEV11</SE511>
        <SE52>SEV2</SE52>
    </E5>
    <E6>
        <SE61>SEV3</SE61>
        <SE62>SEV4</SE62>
    </E6>
</根>

```

**产生了想要的结果**：

```
<根>
    <E1 a="1">V1</E1>
    <E2>V2</E2>
    <E3>V3</E3>
    <E5>
        <SE51>SEV1</SE51>
        <SE511>SEV11</SE511>
        <SE52>SEV2</SE52>
    </E5>
    <E6>
        <SE61>SEV3</SE61>
        <SE62>SEV4</SE62>
    </E6>
</根>

```

**请注意此解决方案的以下详细信息**：

1.  模板仅适用于过滤文档中具有匹配节点的元素，也适用于此类元素的所有文本节点。
2.  匹配元素的模板作为参数传递给过滤器文档中的相应节点。
3.  将模板应用于元素子时，会找到其对应的节点并将其作为预期参数传递。

尽情享受吧！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T09:26:03.437

嗯，您是在谈论合并（假设您的过滤器文档是可变的）。有几种可能性会因您实现所有这些的语言而异。您能否提供有关该应用程序的更多信息？

否则，我建议在“xslt +merge”上快速搜索一下，看看那里是否有一些结果抓住了你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T09:35:04.230

根据我过去遇到类似问题时所做的事情，我建议：

*   在 XSLT 中编写一个转换，向其消耗“过滤 XML”并生成一个转换（也在 XSLT 中）。
*   在您的输入上运行生成的 XSLT。

这听起来（并且是）丑陋，但我发现这比在转换输入时尝试即时解释过滤器描述更容易。

# perl - 我可以强制 LWP::UserAgent 接受过期的 SSL 证书吗？

> ID：336575
> 
> 赞同：11
> 
> 时间：2008-12-03T09:15:21.210
> 
> 标签：perl, https, openssl, squid, lwp

我想知道是否可以强制 LWP::UserAgent 接受单个知名服务器的过期 SSL 证书。中间的 Squid 代理使问题稍微复杂化。

我什至设置了一个调试环境，例如：

```
use warnings;
use strict;
use Carp;
use LWP::UserAgent;
use LWP::Debug qw(+);
use HTTP::Cookies;

my $proxy = 'http://proxy.example.net:8118';
my $cookie_jar = HTTP::Cookies->new( file => 'cookies.tmp' );
my $agent = LWP::UserAgent->new;
$agent->proxy( [ 'http' ], $proxy );
$agent->cookie_jar( $cookie_jar );

$ENV{HTTPS_PROXY} = $proxy;
$ENV{HTTPS_DEBUG} = 1;
$ENV{HTTPS_VERSION} = 3;
$ENV{HTTPS_CA_DIR}    = '/etc/ssl/certs';
$ENV{HTTPS_CA_FILE}    = '/etc/ssl/certs/ca-certificates.crt';

$agent->get( 'https://www.example.com/');

exit; 
```

幸运的是，在我想出自己的解决方案之前，这个问题最终在远程服务器上得到了解决，但我希望能够在问题再次出现时有选择地规避问题（在我之前，底层服务已经中断了几个小时）被要求采取行动）。

如果存在这样的解决方案，我更倾向于 LWP::UserAgent 级别的解决方案，而不是基于底层 Crypt::SSLeay 或 openSSL 实现的解决方案，因为我不希望放松其他不相关应用程序的安全性。当然，在我丰富的空闲时间里，我自己仍在寻找这样的解决方案。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-03T20:16:11.890

**更新地址评论**

要绕过*所有*证书检查，您可以将[代理](http://search.cpan.org/~gaas/libwww-perl-6.05/lib/LWP/UserAgent.pm)设置为不验证证书。

```
$agent->ssl_opts(verify_hostname => 0); 
```

代理还将设置向下传递给正在使用的 SSL 套接字实现。例如，[`IO::Socket::SSL`](http://search.cpan.org/~sullr/IO-Socket-SSL-1.962/lib/IO/Socket/SSL.pm)您可以设置`SSL_verify_mode`为`0x00`.

```
$agent->ssl_opts(SSL_verify_mode => 0x00); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-03-20T16:03:26.693

尝试使用覆盖 SSL 证书验证

```
$agent->ssl_opts(verify_hostname => 0,
              SSL_verify_mode => 0x00); 
```

在您执行 https 请求之前。

# java - Hibernate 和 Spring 事务 - 使用私有构造函数/静态工厂方法

> ID：336578
> 
> 赞同：2
> 
> 时间：2008-12-03T09:16:35.157
> 
> 标签：java, hibernate, spring, transactions

我们有一个具有以下 Spring bean 的 Hibernate/Spring 应用程序：

```
<bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager" />
<bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean" /> 
```

在将应用程序连接在一起时，在我们的休眠实体中使用私有构造函数时会出现以下错误：

```
Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: No visible constructors in class 'ourclass' 
```

实体是典型的领域对象，例如员工等。

当将构造函数的可见性修饰符更改为包（或公共）时，应用程序运行良好，实体被存储/加载到数据库中。我们/我们如何使用私有构造函数/静态工厂方法和 Spring/Hibernate 事务管理？

我们使用 Hibernate 注释来映射实体/关系。在 applicationContext.xml 中没有为与问题相关的域类声明任何 bean 定义。它是一个 pojo，应该有一个静态工厂方法和一个私有构造函数。

我们如何让 Hibernate（我猜是 org.springframework.spring-orm.hibernate3 类）使用静态工厂方法而不是构造函数？或者如果必要的话可能让它调用一个私有构造函数？

使用 spring factory-method 配置是有意义的，但实体没有映射为我们的 applicationContext.xml 中的 bean。它们仅使用 @Entity 注释进行注释以实现 Hibernate 持久性。

希望这个编辑能澄清（而不是神秘化）这个问题。:)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-07T19:32:02.897

虽然我没有使用 Spring，但我在一个项目中使用了 Hibernate，该项目具有必须通过工厂方法或通过多个参数构造函数实例化的类。

您可以通过 Interceptor 来做到这一点，它是一个侦听几个关键休眠事件的类，例如何时需要实例化对象或何时加载对象。

要让 Hibernate 使用您自己的方法来实例化对象，请执行以下操作：

```
public class MyInterceptor extends EmptyInterceptor {

    public Object instantiate(String entityName, EntityMode entityMode, Serializable id) {
        if(entityName.equals(Foo.class.getName())
             return Foo.create();
        return null;
    }
} 
```

考虑到它可以通过反射解决并且我在我的项目中没有遇到这个问题（实际上所有类都没有可见的构造函数）。这可能与Spring有关。检查您正在使用的休眠版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T09:22:39.027

你知道属性“工厂方法”吗？您可以让 spring 调用该方法而不是构造函数来实例化 bean。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T15:00:02.480

我不认为你可以让 Hibernate（或任何外部框架）在你的对象上调用私有构造函数，除非它是通过一些 javassist 或 cglib 运行时创建的子类。

如果你想让 Hibernate 调用你的构造函数，你为什么不直接做呢`public`，或者`package`？Hibernate 通过调用默认的无参数构造函数来实例化您的对象。文档说明您的类必须具有默认的无参数构造函数，该构造函数具有包或公共可见性。您的类不能`final`因为 Hibernate 在使用关联时为它们创建代理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T16:48:43.900

[Spring Reference 的第 3.2.3.2 节](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-class)讨论了在 Spring 中实例化 bean 的几种不同方法。

您要么对静态工厂或实例工厂方法感兴趣。所有子部分都很短。看看你是否还有其他问题。

# c++ - 在 C 和 C++ 中，const 指针对指针的含义是什么？

> ID：336585
> 
> 赞同：42
> 
> 时间：2008-12-03T09:18:44.573
> 
> 标签：c++, c, pointers, constants

我知道从右到左阅读声明的经验法则，我很确定我知道发生了什么，直到一位同事告诉我：

```
const MyStructure** ppMyStruct; 
```

表示“ppMyStruct 是**指向（可变） MyStructure 的 const 指针的指针**”（在 C++ 中）。

我原以为这意味着“ppMyStruct 是**指向 const MyStructure 的指针的指针**”。我在 C++ 规范中寻找答案，但显然我不是很擅长...

in 在 C++ 中是什么意思，在 C 中是什么意思？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-03T09:30:48.433

你的同事错了。那是一个（非常量）指针，指向一个（非常量）指向 const MyStructure 的指针。在 C 和 C++ 中。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2008-12-03T09:44:52.353

在这种情况下，工具 cdecl（或 c++decl）可能会有所帮助：

```
 [flolo@titan ~]$ cdecl explain "const struct s** ppMyStruct"
     declare ppMyStruct as pointer to pointer to const struct s 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-12-03T09:55:01.660

你的解释是对的。这是另一种看待它的方式：

```
const MyStructure *      *ppMyStruct;        // ptr --> ptr --> const MyStructure
      MyStructure *const *ppMyStruct;        // ptr --> const ptr --> MyStructure
      MyStructure *      *const ppMyStruct;  // const ptr --> ptr --> MyStructure 
```

这些都是带有一个 const 限定符的指针的所有替代方案。从右到左的规则可用于破译声明（至少在 C++ 中；我不是 C 专家）。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-03T09:45:45.067

你的同事错了，C和C++也是一样。尝试以下操作：

```
typedef struct foo_t {
    int i;
} foo_t;

int main()
{
    foo_t f = {123};
    const foo_t *p = &f;
    const foo_t **pp = &p;
    printf("f.i = %d\n", (*pp)->i);
    (*pp)->i = 888; // error
    p->i = 999;     // error
} 
```

Visual C++ 2008 在最后两行给出以下错误：

```
error C2166: l-value specifies const object
error C2166: l-value specifies const object 
```

GCC 4 说：

```
error: assignment of read-only location '**pp'
error: assignment of read-only location '*p' 
```

G++ 4 说：

```
error: assignment of data-member 'foo_t::i' in read-only structure
error: assignment of data-member 'foo_t::i' in read-only structure 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-03T10:47:50.713

*你*是对的。

[另一个答案](https://stackoverflow.com/questions/180401/c-asterisks-and-pointers#180509)已经指向“[顺时针螺旋规则](http://c-faq.com/decl/spiral.anderson.html)”。我非常喜欢那个——不过有点精致。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-03T13:52:34.990

作为其他评论的推论，不要把'const'放在第一位。它确实属于类型之后。那会立即阐明含义，只需照常阅读 RTL 即可：

```
MyStructure const** ppMyStruct; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-06T04:42:27.423

```
void Foo( int       *       ptr,
          int const *       ptrToConst,
          int       * const constPtr,
          int const * const constPtrToConst )
{
    *ptr = 0; // OK: modifies the pointee
    ptr  = 0; // OK: modifies the pointer

    *ptrToConst = 0; // Error! Cannot modify the pointee
    ptrToConst  = 0; // OK: modifies the pointer

    *constPtr = 0; // OK: modifies the pointee
    constPtr  = 0; // Error! Cannot modify the pointer

    *constPtrToConst = 0; // Error! Cannot modify the pointee
    constPtrToConst  = 0; // Error! Cannot modify the pointer
} 
```

# vb6 - 如何在 VB6 中使用 GNU gettext？

> ID：336586
> 
> 赞同：2
> 
> 时间：2008-12-03T09:19:02.810
> 
> 标签：vb6, localization, internationalization, gettext

我一直在几个私人项目中使用 gettext，现在我想使用 gettext 来翻译 Visual Basic 6 应用程序的字符串。

我检查了 GNU gettext 包，似乎我必须编写一些样板代码才能让它与 VB6 一起使用，我担心我的老板不会允许它。

*   VB6 是否有一些开箱即用的软件包？（像 dxgettext 这样的东西将是一个梦想！）
*   你做过类似的事情吗？
*   甚至可能吗？
*   我从哪说起呢？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T00:31:56.610

请参阅[VB 语言管理器专业版。](http://www.whippleware.com/vblm.htm)

旨在精确地执行您想要的操作 - 提取、翻译和替换 VB6 应用程序中的所有字符串。

惠普尔软件产品工作。

一个警告；Ben Whipple 可能不再积极推销这些产品，因为 VB6 不是主流。获得该软件的副本可能需要一些耐心。

# asp.net-mvc - 为什么不在选择列表中设置 selectedValue 使该值在浏览器中突出显示？

> ID：336588
> 
> 赞同：0
> 
> 时间：2008-12-03T09:19:57.347
> 
> 标签：asp.net-mvc, selectlist

当我这样做时：

```
new SelectList(items, dataValueField, dataTextField, items.First()); 
```

我得到一个选择了该项目的 SelectList（它作为 SelectedValue 插入），但没有突出显示。

我应该怎么做才能获得一个带有列表的下拉列表，在该列表中我提前决定在页面加载时选择什么项目？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T21:06:43.707

假设 dataFieldValue = "Id"，试试这个：

```
new SelectList(items, dataValueField, dataTextField, items.First().Id); 
```

它在寻找价值，而不是物品。

# visual-studio - 用于比较 web.config 文件的工具

> ID：336595
> 
> 赞同：14
> 
> 时间：2008-12-03T09:22:17.327
> 
> 标签：visual-studio, web-config

是否有一个很好的工具可以*专门*比较web.config 文件，以具体查找哪些设置是不同的值，以及哪个文件的设置都没有出现在两者中。

XML 比较应该可以解决问题，否则 XSLT 可能会起作用。那里必须有一个用于 web.config 设置的工具？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2015-11-07T06:41:22.860

[https://github.com/CameronWills/FatAntelope](https://github.com/CameronWills/FatAntelope) 此工具将比较两个 web.config 文件并从差异中生成 web.config 转换。

免责声明：我写的......我想比较两个 web.config 文件并生成一个转换。但是除了标准的文本文件差异工具（WinMerge 等）之外，我找不到任何对 XML 不太有效的帮助。所以我创造了一个:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T09:30:27.950

[BeyondCompare](http://www.scootersoftware.com/moreinfo.php)在许多其他实用程序中

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-03T09:33:16.963

[如果您格式化两个文件， WinMerge](http://winmerge.org/downloads/)将为您提供最好的帮助......您可以在 Visual Studio 本身中格式化，然后在 WinMerge 中进行比较......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T09:38:35.157

根据我的经验，Araxis 合并是比较任何文档的最佳工具：

[http://www.araxis.com/merge/index.html](http://www.araxis.com/merge/index.html)

自己在工作中使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T09:25:04.093

**使用差异**

它会巧妙地指出不同的确切行和文本。

[Diff Utilities](http://www.gnu.org/software/diffutils/diffutils.html)也可用于 Windows。[**在这里下载**。](http://gnuwin32.sourceforge.net/packages/diffutils.htm)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T09:30:44.517

维基百科有一个[文件比较工具的比较](http://en.wikipedia.org/wiki/Comparison_of_file_comparison_tools)。随便挑吧:o)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T09:31:30.727

使用[winmerge](http://winmerge.org/)。

你应该习惯版本控制，推荐使用 subversion 和[tortoisesvn](http://tortoisesvn.tigris.org/)，[ankhsvn](http://ankhsvn.open.collab.net/) 提供从 Visual Studio 访问 svn。

# php - 如何在 PHP 中找到两个字符串之间的最大公共子字符串？

> ID：336605
> 
> 赞同：19
> 
> 时间：2008-12-03T09:25:22.733
> 
> 标签：php, algorithm, string, performance, spam-prevention

是否有一种快速算法可以在两个中找到最大公共子串，`strings`还是 NPComplete 问题？

在 PHP 中，我可以大海捞针：

```
<?php

if (strstr("there is a needle in a haystack", "needle")) {
    echo "found<br>\n";
}
?> 
```

我想我可以在其中一个上循环执行此操作，`strings`但这将非常昂贵！特别是因为我的应用是搜索电子邮件数据库并查找垃圾邮件（即同一个人发送的类似电子邮件）。

有没有人可以扔掉任何 PHP 代码？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T09:33:56.353

similar_text[函数](http://us3.php.net/manual/en/function.similar-text.php)可能是您想要的。

这会计算两个字符串之间的相似度。返回两个字符串中匹配字符的数量

您可能还想看看[levenshtein](http://us3.php.net/manual/en/function.levenshtein.php)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-03T09:31:03.723

> 特别是因为我的应用是搜索电子邮件数据库并查找垃圾邮件（即同一个人发送的类似电子邮件）。

我认为你应该看看贝叶斯垃圾邮件推理算法，不一定是最长的公共子串。

[http://www.devshed.com/c/a/PHP/Implement-Bayesian-inference-using-PHP-Part-1/](http://www.devshed.com/c/a/PHP/Implement-Bayesian-inference-using-PHP-Part-1/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-04-06T12:37:59.817

我刚刚编写了一个函数，用于查找 str1 中存在于 str2 中的最长子字符串

```
public static function getLongestMatchingSubstring($str1, $str2)
{
    $len_1 = strlen($str1);
    $longest = '';
    for($i = 0; $i < $len_1; $i++){
        for($j = $len_1 - $i; $j > 0; $j--){
            $sub = substr($str1, $i, $j);
            if (strpos($str2, $sub) !== false && strlen($sub) > strlen($longest)){
                $longest = $sub;
                break;
            }
        }
    }
    return $longest;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-02-24T19:03:42.533

迟到了，但这里有一种方法可以在字符串数组中找到最大的公共子字符串：

例子：

```
$array = array(
    'PTT757LP4',
    'PTT757A',
    'PCT757B',
    'PCT757LP4EV'
);
echo longest_common_substring($array); // => T757 
```

功能：

```
function longest_common_substring($words) {
    $words = array_map('strtolower', array_map('trim', $words));
    $sort_by_strlen = create_function('$a, $b', 'if (strlen($a) == strlen($b)) { return strcmp($a, $b); } return (strlen($a) < strlen($b)) ? -1 : 1;');
    usort($words, $sort_by_strlen);
    // We have to assume that each string has something in common with the first
    // string (post sort), we just need to figure out what the longest common
    // string is. If any string DOES NOT have something in common with the first
    // string, return false.
    $longest_common_substring = array();
    $shortest_string = str_split(array_shift($words));

    while (sizeof($shortest_string)) {
        array_unshift($longest_common_substring, '');
        foreach ($shortest_string as $ci => $char) {
            foreach ($words as $wi => $word) {
                if (!strstr($word, $longest_common_substring[0] . $char)) {
                    // No match
                    break 2;
                } // if
            } // foreach
            // we found the current char in each word, so add it to the first longest_common_substring element,
            // then start checking again using the next char as well
            $longest_common_substring[0].= $char;
        } // foreach
        // We've finished looping through the entire shortest_string.
        // Remove the first char and start all over. Do this until there are no more
        // chars to search on.
        array_shift($shortest_string);
    }
    // If we made it here then we've run through everything
    usort($longest_common_substring, $sort_by_strlen);
    return array_pop($longest_common_substring);
} 
```

我在我的博客上写了一点：

*   [使用 PHP 查找最长的公共子字符串](http://www.christopherbloom.com/2011/02/24/find-the-longest-common-substring-using-php/)（2011 年 2 月 24 日）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-03T09:28:38.283

从那以后，我找到[了一篇相关的维基百科文章](http://en.wikipedia.org/wiki/Longest_common_substring_problem)。这不是一个 NP 完全问题，它可以使用动态规划算法在 O(mn) 时间内完成。

在 PHP 中，我发现[similar_text](http://us3.php.net/manual/en/function.similar-text.php)函数非常有用。这是一个代码示例，用于检索一系列文本电子邮件并遍历它们并找到彼此之间 90% 相似的电子邮件。**注意：像这样的东西是不可扩展的**：

```
<?php
// Gather all messages by a user into two identical associative arrays
$getMsgsRes = mysql_query(SELECT * FROM email_messages WHERE from = '$someUserID');
while($msgInfo = mysql_fetch_assoc($getMsgsRes))
{
    $msgsInfo1[] = $msgInfo;
    $msgsInfo2[] = $msgInfo;
}

// Loop over msgs and compare each one to every other
foreach ($msgsInfo1 as $msg1)
    foreach ($msgsInfo2 as $msg2)
        similar_text($msg1['msgTxt'],$msg2['msgTxt'],$similarity_pst);
        if ($similarity_pst > 90)
            echo "{$msg1['msgID']} is ${similarity_pst}% to {$msg2['msgID']}\n";
?> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-03T11:30:14.777

请查看Wikibooks上的[算法实现/字符串/最长公共子字符串。](http://en.wikibooks.org/wiki/Algorithm_implementation/Strings/Longest_common_substring#PHP)我还没有测试过 PHP 实现，但它似乎与 Wikipedia 页面上的一般算法相匹配。

# c++ - 在 Visual Studio 中调试多线程程序时“跳过”

> ID：336628
> 
> 赞同：28
> 
> 时间：2008-12-03T09:32:12.160
> 
> 标签：c++, visual-studio, multithreading, debugging, visual-studio-2005

在 Visual Studio（在我的情况下为 2005 年）中调试程序时让我烦恼的一件事是，当我使用“跳过”（通过按`F10`）执行下一行代码时，我经常最终到达特定的代码行与我正在查看的线程完全不同的线程。这意味着我所做的所有背景都丢失了。

我该如何解决这个问题？

如果在更高版本的 Visual Studio 中可以做到这一点，我也想听听。

在下一行代码上设置一个断点，它有条件只为这个线程中断不是我正在寻找的答案，因为它对我有用的工作太多:)

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-18T17:32:43.790

我认为您的问题只有一个答案，您认为这是“工作量太大”。但是，我相信这是因为您以错误的方式进行操作。让我介绍在线程 ID 上添加条件断点的步骤，这些步骤非常简单，但在您了解它们之前并不明显。

1.  在您想要继续调试的正确线程中停止调试器（*我猜这通常是第一个到达那里的线程*）。

2.  进入`$TID`观察窗口。

3.  `$TID == <`*从 Watch Window 添加条件值为 $TID*的断点`>`，
    **示例**：`$TID == 0x000016a0`

4.  继续执行。

`$TID`是 Microsoft 编译器（至少从 Visual Studio 2003 开始​​）的魔术变量，它具有当前线程 ID 的值。它比查看 (FS+0x18)[0x24] 容易得多。=D

话虽如此，您可以通过一些简单的宏获得与调试器的 One-Shot 断点相同的行为。当您跨步时，调试器在幕后设置断点，运行到该断点，然后将其删除。一致的用户界面的关键是在命中**任何**断点时删除这些断点。

以下两个宏为当前线程提供*Step Over*和*Run To Cursor 。*这以与调试器相同的方式完成，在执行后删除断点，无论命中哪个断点。

您将需要分配一个组合键来运行它们。

> ***注意***：一个警告——只有当光标位于您想要跳过的行上时， *Step Over宏才能正常工作。*这是因为它通过光标位置确定当前位置，并简单地将行号加一。您可以用当前执行点的信息替换位置计算，尽管我无法从宏 IDE 中找到该信息。

他们来了，祝你好运！

> **要在 Visual Studio 中使用这些宏：**
> 1\. 打开宏 IDE（从菜单中选择：*Tools->Macros->Macro IDE...*）
> 2\. 添加新代码文件（从菜单中：选择：*Project->添加新项目...*，选择*代码文件*，然后单击*添加*）
> 3\. 粘贴此代码。
> 4\. 保存文件。
> 
> **要在 Visual Studio 中添加用于运行这些宏的组合键：**
> 1\. 打开选项（从菜单中，选择：*工具->选项*）
> 2\. 展开到*环境->键盘*
> 3\. 在*显示包含：的命令中*，键入***宏。***查看所有宏。
> 4\. 选择一个宏，然后单击*按快捷键：*
> 5\. 键入您要使用的组合（*退格删除键入的组合*）
> 6\. 单击*分配*以设置运行所选宏的快捷方式。

```
Imports System
Imports EnvDTE
Imports EnvDTE80
Imports System.Diagnostics

Public Module DebugHelperFunctions

    Sub RunToCursorInMyThread()
        Dim textSelection As EnvDTE.TextSelection
        Dim myThread As EnvDTE.Thread
        Dim bp As EnvDTE.Breakpoint
        Dim bps As EnvDTE.Breakpoints

        ' For Breakpoints.Add()
        Dim FileName As String
        Dim LineNumber As Integer
        Dim ThreadID As String

        ' Get local references for ease of use 
        myThread = DTE.Debugger.CurrentThread
        textSelection = DTE.ActiveDocument.Selection

        LineNumber = textSelection.ActivePoint.Line
        FileName = textSelection.DTE.ActiveDocument.FullName
        ThreadID = myThread.ID

        ' Add a "One-Shot" Breakpoint in current file on current line for current thread
        bps = DTE.Debugger.Breakpoints.Add("", FileName, LineNumber, 1, "$TID == " & ThreadID)

        ' Run to the next stop
        DTE.Debugger.Go(True)

        ' Remove our "One-Shot" Breakpoint
        For Each bp In bps
            bp.Delete()
        Next
    End Sub

    Sub StepOverInMyThread()
        Dim textSelection As EnvDTE.TextSelection
        Dim myThread As EnvDTE.Thread
        Dim bp As EnvDTE.Breakpoint
        Dim bps As EnvDTE.Breakpoints

        ' For Breakpoints.Add()
        Dim FileName As String
        Dim LineNumber As Integer
        Dim ThreadID As String

        ' Get local references for ease of use 
        myThread = DTE.Debugger.CurrentThread
        textSelection = DTE.ActiveDocument.Selection

        LineNumber = textSelection.ActivePoint.Line
        FileName = textSelection.DTE.ActiveDocument.FullName
        ThreadID = myThread.ID
        LineNumber = LineNumber + 1

        ' Add a "One-Shot" Breakpoint in current file on current line for current thread
        bps = DTE.Debugger.Breakpoints.Add("", FileName, LineNumber, 1, "$TID == " & ThreadID)

        ' Run to the next stop
        DTE.Debugger.Go(True)

        ' Remove our "One-Shot" Breakpoint
        For Each bp In bps
            bp.Delete()
        Next
    End Sub

End Module 
```

> **免责声明：我在***Visual Studio 2005*中编写了这些宏。您可能可以在*Visual Studio 2008*中很好地使用它们。它们可能需要针对*Visual Studio 2003*及更早版本进行修改。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-03T09:53:21.867

`Ctrl`您可以使用线程调试窗口 ( ++ `Alt`)冻结不同的线程或切换到另一个线程`H`。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-11-23T07:11:57.377

调试一个特定线程的简单方法是从“线程”窗口冻结所有其他线程。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-02-07T22:58:47.867

[Ctrl+D, T] 或 [Ctrl+Alt+H] - 打开线程窗口（用于监视、冻结和命名线程）

线程窗口允许您选择是否要在 Visual Studio 中显示其他线程的位置。这很好地提醒了我，我正在调试的当前线程并不是唯一在起作用的线程。将鼠标悬停在线程标记上可以获得线程名称和 ID。

更多提示见：[http ://devpinoy.org/blogs/jakelite/archive/2009/01/10/5-tips-on-debugging-multi-threaded-code-in-visual-studio-net.aspx](http://devpinoy.org/blogs/jakelite/archive/2009/01/10/5-tips-on-debugging-multi-threaded-code-in-visual-studio-net.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-09-24T09:08:07.060

显然，Visual Studio 2010 只有`F10`在调试器必须在该线程之前中断时按下，或者如果设置了将在该线程中命中的断点，才会切换到其他线程。

我使用以下代码来测试行为：

```
class Program
{
    static void Main(string[] args)
    {
        var t = new Thread(new ThreadStart(Work));
        t.Start();

        for (int i = 0; i < 20; i++)
        {
            Thread.Sleep(1000);
            Console.WriteLine("............");
        }

        t.Join();
    }

    static void Work()
    {
        for (int i = 0; i < 20; i++)
        {
            Thread.Sleep(1000);
            Console.WriteLine("ZZzzzzzzzzzzzzzz");
        }
    }
} 
```

如果您只是单步执行程序或在`Main()`方法中添加断点，则`F10`只需从主线程执行代码。

如果在`Work()`方法中添加断点，调试器将逐步执行两个线程。

Visual Studio 的这种行为是有道理的，但对我来说这一切似乎都是一个未记录的功能......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-10-28T17:14:11.850

我最近遇到了同样的问题，只调试某个线程。虽然我不会将上述答案视为非常全面和有价值的（并希望我在 2 天前找到它） - 我实施了以下内容来帮助“日常”故障排除。

当在多个线程中运行同一类的多个实例时，这个想法只是一个简单的解决方法——我们的应用程序一直在这样做。

我们使用唯一的 ID 或名称初始化所有类实例，因此我们知道如何或为什么创建实例。然后，当我们需要调试一个特定的实例（即线程）——而不是冻结其他线程时，我们添加以下内容：

```
if (instance.ID == myID)
{
    // Assert BreakPoint
} 
```

在我们的案例中，我们建立了固定的 ID，因此我们知道在遇到问题时要排除故障的 ID。

# c# - 如何使用 .NET 检测 Windows 64 位平台？

> ID：336633
> 
> 赞同：283
> 
> 时间：2008-12-03T09:32:38.960
> 
> 标签：c#, windows, 64-bit, .net-2.0, platform-detection

在[.NET](http://en.wikipedia.org/wiki/.NET_Framework) 2.0 C# 应用程序中，我使用以下代码来检测操作系统平台：

```
string os_platform = System.Environment.OSVersion.Platform.ToString(); 
```

这将返回“Win32NT”。问题是即使在 Windows Vista 64 位上运行时它也会返回“Win32NT”。

有没有其他方法可以知道正确的平台（32 位或 64 位）？

请注意，在 Windows 64 位上作为 32 位应用程序运行时，它还应该检测 64 位。

* * *

## 回答 #1

> 赞同：250
> 
> 时间：2009-12-16T10:58:54.453

.NET 4 在 Environment 类中有两个新属性[Is64BitProcess](http://msdn.microsoft.com/en-us/library/system.environment.is64bitprocess(VS.100).aspx)和[Is64BitOperatingSystem](http://msdn.microsoft.com/en-us/library/system.environment.is64bitoperatingsystem%28VS.100%29.aspx)。有趣的是，如果您使用 Reflector，您会发现它们在 32 位和 64 位版本的 mscorlib 中的实现方式不同。32 位版本为 Is64BitProcess 返回 false，并通过 P/Invoke 为 Is64BitOperatingSystem 调用 IsWow64Process。64 位版本只为两者返回 true。

* * *

## 回答 #2

> 赞同：221
> 
> 时间：2008-12-03T10:15:57.313

**更新：**正如 Joel Coehoorn 和其他人所建议的，从 .NET Framework 4.0 开始，您只需检查`Environment.Is64BitOperatingSystem`.

* * *

如果在 64 位 Windows 上的 32 位 .NET Framework 2.0 中运行，IntPtr.Size 将不会返回正确的值（它将返回 32 位）。

正如微软的 Raymond Chen 所描述的，你必须首先检查是否在 64 位进程中运行（我认为在 .NET 中你可以通过检查 IntPtr.Size 来做到这一点），如果你在 32 位进程中运行，你仍然必须调用 Win API 函数 IsWow64Process。如果返回 true，则您正在 64 位 Windows 上的 32 位进程中运行。

Microsoft 的 Raymond Chen： [如何以编程方式检测您是否在 64 位 Windows 上运行](http://blogs.msdn.com/oldnewthing/archive/2005/02/01/364563.aspx)

我的解决方案：

```
static bool is64BitProcess = (IntPtr.Size == 8);
static bool is64BitOperatingSystem = is64BitProcess || InternalCheckIsWow64();

[DllImport("kernel32.dll", SetLastError = true, CallingConvention = CallingConvention.Winapi)]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool IsWow64Process(
    [In] IntPtr hProcess,
    [Out] out bool wow64Process
);

public static bool InternalCheckIsWow64()
{
    if ((Environment.OSVersion.Version.Major == 5 && Environment.OSVersion.Version.Minor >= 1) ||
        Environment.OSVersion.Version.Major >= 6)
    {
        using (Process p = Process.GetCurrentProcess())
        {
            bool retVal;
            if (!IsWow64Process(p.Handle, out retVal))
            {
                return false;
            }
            return retVal;
        }
    }
    else
    {
        return false;
    }
} 
```

* * *

## 回答 #3

> 赞同：102
> 
> 时间：2012-08-28T23:49:10.223

如果您使用的是[.NET Framework](http://en.wikipedia.org/wiki/.NET_Framework) 4.0，则很简单：

```
Environment.Is64BitOperatingSystem 
```

请参阅*[Environment.Is64BitOperatingSystem 属性](http://msdn.microsoft.com/en-us/library/system.environment.is64bitoperatingsystem.aspx)*(MSDN)。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2009-12-03T14:44:37.457

这只是 Bruno Lopez 上述建议的一个实现，但适用于 Win2k + 所有 WinXP 服务包。只是想我会把它贴出来，这样其他人就不用手动滚动它了。（会作为评论发布，但我是新用户！）

```
[DllImport("kernel32", SetLastError = true, CallingConvention = CallingConvention.Winapi)]
public extern static IntPtr LoadLibrary(string libraryName);

[DllImport("kernel32", SetLastError = true, CallingConvention = CallingConvention.Winapi)]
public extern static IntPtr GetProcAddress(IntPtr hwnd, string procedureName);

private delegate bool IsWow64ProcessDelegate([In] IntPtr handle, [Out] out bool isWow64Process);

public static bool IsOS64Bit()
{
    if (IntPtr.Size == 8 || (IntPtr.Size == 4 && Is32BitProcessOn64BitProcessor()))
    {
        return true;
    }
    else
    {
        return false;
    }
}

private static IsWow64ProcessDelegate GetIsWow64ProcessDelegate()
{
  IntPtr handle = LoadLibrary("kernel32");

  if ( handle != IntPtr.Zero)
  {
    IntPtr fnPtr = GetProcAddress(handle, "IsWow64Process");

    if (fnPtr != IntPtr.Zero)
    {
      return (IsWow64ProcessDelegate)Marshal.GetDelegateForFunctionPointer((IntPtr)fnPtr, typeof(IsWow64ProcessDelegate));
    }
  }

  return null;
}

private static bool Is32BitProcessOn64BitProcessor()
{
  IsWow64ProcessDelegate fnDelegate = GetIsWow64ProcessDelegate();

  if (fnDelegate == null)
  {
    return false;
  }

  bool isWow64;
  bool retVal = fnDelegate.Invoke(Process.GetCurrentProcess().Handle, out isWow64);

  if (retVal == false)
  {
    return false;
  }

  return isWow64;
} 
```

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2009-03-25T13:18:17.847

完整的答案是这样的（取自 stefan-mg、ripper234 和 BobbyShaftoe 的答案）：

```
 [DllImport("kernel32.dll", SetLastError = true, CallingConvention = CallingConvention.Winapi)]
    [return: MarshalAs(UnmanagedType.Bool)]
    public static extern bool IsWow64Process([In] IntPtr hProcess, [Out] out bool lpSystemInfo);

    private bool Is64Bit()
    {
        if (IntPtr.Size == 8 || (IntPtr.Size == 4 && Is32BitProcessOn64BitProcessor()))
        {
            return true;
        }
        else
        {
            return false;
        }
    }

    private bool Is32BitProcessOn64BitProcessor()
    {
        bool retVal;

        IsWow64Process(Process.GetCurrentProcess().Handle, out retVal);

        return retVal;
    } 
```

首先检查您是否处于 64 位进程中。如果不是，请检查 32 位进程是否是 Wow64Process。

* * *

## 回答 #6

> 赞同：43
> 
> 时间：2010-08-15T20:39:43.127

微软为此提供了一个代码示例：

[http://1code.codeplex.com/SourceControl/changeset/view/39074#842775](http://1code.codeplex.com/SourceControl/changeset/view/39074#842775)

它看起来像这样：

```
 /// <summary>
    /// The function determines whether the current operating system is a 
    /// 64-bit operating system.
    /// </summary>
    /// <returns>
    /// The function returns true if the operating system is 64-bit; 
    /// otherwise, it returns false.
    /// </returns>
    public static bool Is64BitOperatingSystem()
    {
        if (IntPtr.Size == 8)  // 64-bit programs run only on Win64
        {
            return true;
        }
        else  // 32-bit programs run on both 32-bit and 64-bit Windows
        {
            // Detect whether the current process is a 32-bit process 
            // running on a 64-bit system.
            bool flag;
            return ((DoesWin32MethodExist("kernel32.dll", "IsWow64Process") &&
                IsWow64Process(GetCurrentProcess(), out flag)) && flag);
        }
    }

    /// <summary>
    /// The function determins whether a method exists in the export 
    /// table of a certain module.
    /// </summary>
    /// <param name="moduleName">The name of the module</param>
    /// <param name="methodName">The name of the method</param>
    /// <returns>
    /// The function returns true if the method specified by methodName 
    /// exists in the export table of the module specified by moduleName.
    /// </returns>
    static bool DoesWin32MethodExist(string moduleName, string methodName)
    {
        IntPtr moduleHandle = GetModuleHandle(moduleName);
        if (moduleHandle == IntPtr.Zero)
        {
            return false;
        }
        return (GetProcAddress(moduleHandle, methodName) != IntPtr.Zero);
    }

    [DllImport("kernel32.dll")]
    static extern IntPtr GetCurrentProcess();

    [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
    static extern IntPtr GetModuleHandle(string moduleName);

    [DllImport("kernel32", CharSet = CharSet.Auto, SetLastError = true)]
    static extern IntPtr GetProcAddress(IntPtr hModule,
        [MarshalAs(UnmanagedType.LPStr)]string procName);

    [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    static extern bool IsWow64Process(IntPtr hProcess, out bool wow64Process); 
```

还有一个 WMI 版本可用（用于测试远程机器）。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2009-06-24T19:38:07.410

您还可以检查`PROCESSOR_ARCHITECTURE`环境变量。

它要么不存在，要么在 32 位 Windows 上设置为“x86”。

```
private int GetOSArchitecture()
{
    string pa = 
        Environment.GetEnvironmentVariable("PROCESSOR_ARCHITECTURE");
    return ((String.IsNullOrEmpty(pa) || 
             String.Compare(pa, 0, "x86", 0, 3, true) == 0) ? 32 : 64);
} 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2014-06-03T02:37:07.057

来自 Chriz Yuen 博客

C# .Net 4.0 引入了两个新的环境属性 Environment.Is64BitOperatingSystem; Environment.Is64BitProcess;

使用这两个属性时请小心。在 Windows 7 64 位机器上测试

```
//Workspace: Target Platform x86
Environment.Is64BitOperatingSystem True
Environment.Is64BitProcess False

//Workspace: Target Platform x64
Environment.Is64BitOperatingSystem True
Environment.Is64BitProcess True

//Workspace: Target Platform Any
Environment.Is64BitOperatingSystem True
Environment.Is64BitProcess True 
```

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2008-12-03T09:38:29.260

最快的方法：

```
if(IntPtr.Size == 8) {
    // 64 bit machine
} else if(IntPtr.Size == 4)  {
    // 32 bit machine
} 
```

***注意：***这是非常直接的，并且仅当程序不强制执行为 32 位进程（例如通过`<Prefer32Bit>true</Prefer32Bit>`项目设置）时，才能在 64 位上正常工作。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2013-04-02T10:04:16.723

试试这个：

```
Environment.Is64BitOperatingSystem

Environment.Is64BitProcess 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2012-03-28T10:08:48.453

@foobar：你说得对，这太容易了；）

在 99% 的情况下，系统管理员背景薄弱的开发人员最终无法意识到微软一直为任何人提供枚举 Windows 的能力。

当涉及到这一点时，系统管理员总是会编写更好、更简单的代码。

尽管如此，需要注意的一点是，构建配置必须是*AnyCPU 才能*让此环境变量在正确的系统上返回正确的值：

```
System.Environment.GetEnvironmentVariable("PROCESSOR_ARCHITECTURE") 
```

这将在 32 位 Windows 上返回“X86”，在 64 位 Windows 上返回“AMD64”。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2015-03-04T22:27:06.373

使用[dotPeek](https://www.jetbrains.com/decompiler/)有助于了解框架实际上是如何做到的。考虑到这一点，这就是我想出的：

```
public static class EnvironmentHelper
{
    [DllImport("kernel32.dll")]
    static extern IntPtr GetCurrentProcess();

    [DllImport("kernel32.dll")]
    static extern IntPtr GetModuleHandle(string moduleName);

    [DllImport("kernel32")]
    static extern IntPtr GetProcAddress(IntPtr hModule, string procName);

    [DllImport("kernel32.dll")]
    static extern bool IsWow64Process(IntPtr hProcess, out bool wow64Process);

    public static bool Is64BitOperatingSystem()
    {
        // Check if this process is natively an x64 process. If it is, it will only run on x64 environments, thus, the environment must be x64.
        if (IntPtr.Size == 8)
            return true;
        // Check if this process is an x86 process running on an x64 environment.
        IntPtr moduleHandle = GetModuleHandle("kernel32");
        if (moduleHandle != IntPtr.Zero)
        {
            IntPtr processAddress = GetProcAddress(moduleHandle, "IsWow64Process");
            if (processAddress != IntPtr.Zero)
            {
                bool result;
                if (IsWow64Process(GetCurrentProcess(), out result) && result)
                    return true;
            }
        }
        // The environment must be an x86 environment.
        return false;
    }
} 
```

示例用法：

```
EnvironmentHelper.Is64BitOperatingSystem(); 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2010-01-13T06:20:40.813

使用这两个环境变量（伪代码）：

```
if (PROCESSOR_ARCHITECTURE = x86 &&
    isDefined(PROCESSOR_ARCHITEW6432) &&
    PROCESSOR_ARCHITEW6432 = AMD64) {

    //64 bit OS
}
else
    if (PROCESSOR_ARCHITECTURE = AMD64) {
        //64 bit OS
    }
    else
        if (PROCESSOR_ARCHITECTURE = x86) {
            //32 bit OS
        } 
```

请参阅博客文章*[HOWTO：检测进程位数](http://blogs.msdn.com/david.wang/archive/2006/03/26/HOWTO-Detect-Process-Bitness.aspx)*。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2016-11-29T09:54:09.907

我在许多操作系统上成功使用了这个检查：

```
private bool Is64BitSystem
{
   get
   {
      return Directory.Exists(Environment.ExpandEnvironmentVariables(@"%windir%\SysWOW64"));
   }
} 
```

无论操作系统的语言如何，此文件夹始终命名为“SysWOW64”。这适用于 .NET Framework 1.1 或更高版本。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-02-02T18:46:05.340

这是基于[http://1code.codeplex.com/SourceControl/changeset/view/39074#842775](http://1code.codeplex.com/SourceControl/changeset/view/39074#842775)上的 Microsoft 代码的解决方案。它使用扩展方法来轻松重用代码。

一些可能的用法如下所示：

```
bool bIs64BitOS = System.Environment.OSVersion.IsWin64BitOS();

bool bIs64BitProc = System.Diagnostics.Process.GetCurrentProcess().Is64BitProc();

//Hosts the extension methods  
public static class OSHelperTools  
{  
    /// <summary>     
    /// The function determines whether the current operating system is a      
    /// 64-bit operating system.     
    /// </summary>     
    /// <returns>     
    /// The function returns true if the operating system is 64-bit;      
    /// otherwise, it returns false.     
    /// </returns>    
    public static bool IsWin64BitOS(this OperatingSystem os)  
    {  
        if (IntPtr.Size == 8)  
        // 64-bit programs run only on Win64           
            return true;   
        else// 32-bit programs run on both 32-bit and 64-bit Windows     
        {   // Detect whether the current process is a 32-bit process                
            // running on a 64-bit system.               
            return Process.GetCurrentProcess().Is64BitProc();  
        }  
    }  

    /// <summary>  
    /// Checks if the process is 64 bit  
    /// </summary>  
    /// <param name="os"></param>  
    /// <returns>  
    /// The function returns true if the process is 64-bit;        
    /// otherwise, it returns false.  
    /// </returns>    
    public static bool Is64BitProc(this System.Diagnostics.Process p)  
    {  
        // 32-bit programs run on both 32-bit and 64-bit Windows           
        // Detect whether the current process is a 32-bit process                
        // running on a 64-bit system.               
        bool result;  
        return ((DoesWin32MethodExist("kernel32.dll", "IsWow64Process") && IsWow64Process(p.Handle, out result)) && result);  
    }  

    /// <summary>     
    /// The function determins whether a method exists in the export      
    /// table of a certain module.     
    /// </summary>     
    /// <param name="moduleName">The name of the module</param>     
    /// <param name="methodName">The name of the method</param>     
    /// <returns>     
    /// The function returns true if the method specified by methodName      
    /// exists in the export table of the module specified by moduleName.     
    /// </returns>       
    static bool DoesWin32MethodExist(string moduleName, string methodName)  
    {  
        IntPtr moduleHandle = GetModuleHandle(moduleName);  
        if (moduleHandle == IntPtr.Zero)  
            return false;    
        return (GetProcAddress(moduleHandle, methodName) != IntPtr.Zero);   
    }  
    [DllImport("kernel32.dll")]  
    static extern IntPtr GetCurrentProcess();  

    [DllImport("kernel32.dll", CharSet = CharSet.Auto)]  
    static extern IntPtr GetModuleHandle(string moduleName);  

    [DllImport("kernel32", CharSet = CharSet.Auto, SetLastError = true)]  
    static extern IntPtr GetProcAddress(IntPtr hModule, [MarshalAs(UnmanagedType.LPStr)]string procName);  

    [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]  
    [return: MarshalAs(UnmanagedType.Bool)]  
    static extern bool IsWow64Process(IntPtr hProcess, out bool wow64Process);  
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2011-09-29T21:26:01.780

我需要这样做，但我还需要能够作为管理员远程执行此操作，无论哪种情况，这对我来说似乎都很好：

```
 public static bool is64bit(String host)
    {
        using (var reg = RegistryKey.OpenRemoteBaseKey(RegistryHive.LocalMachine, host))
        using (var key = reg.OpenSubKey(@"Software\Microsoft\Windows\CurrentVersion\"))
        {
            return key.GetValue("ProgramFilesDir (x86)") !=null;
        }
    } 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-01-15T15:05:06.357

这是 C# 中使用[此页面](http://social.msdn.microsoft.com/forums/en-US/csharpgeneral/thread/24792cdc-2d8e-454b-9c68-31a19892ca53/)中的 DllImport 的直接方法。

```
[DllImport("kernel32.dll", SetLastError = true, CallingConvention = CallingConvention.Winapi)] 
[return: MarshalAs(UnmanagedType.Bool)] 
public static extern bool IsWow64Process([In] IntPtr hProcess, [Out] out bool lpSystemInfo); 

public static bool Is64Bit() 
{ 
    bool retVal; 

    IsWow64Process(Process.GetCurrentProcess().Handle, out retVal); 

    return retVal; 
} 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2011-12-23T23:16:43.650

我正在使用以下代码。*注意：它是为 AnyCPU 项目制作的。*

```
 public static bool Is32bitProcess(Process proc) {
        if (!IsThis64bitProcess()) return true; // We're in 32-bit mode, so all are 32-bit.

        foreach (ProcessModule module in proc.Modules) {
            try {
                string fname = Path.GetFileName(module.FileName).ToLowerInvariant();
                if (fname.Contains("wow64")) {
                    return true;
                }
            } catch {
                // What on earth is going on here?
            }
        }
        return false;
    }

    public static bool Is64bitProcess(Process proc) {
        return !Is32bitProcess(proc);
    }

    public static bool IsThis64bitProcess() {
        return (IntPtr.Size == 8);
    } 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-06-29T20:40:10.723

一切都很好，但这也应该适用于`env`：

```
PROCESSOR_ARCHITECTURE=x86 
```

..

```
PROCESSOR_ARCHITECTURE=AMD64 
```

太容易了，也许;-)

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2012-03-02T18:25:31.897

这是一种[Windows Management Instrumentation](http://en.wikipedia.org/wiki/Windows_Management_Instrumentation) (WMI) 方法：

```
string _osVersion = "";
string _osServicePack = "";
string _osArchitecture = "";

ManagementObjectSearcher searcher = new ManagementObjectSearcher("select * from Win32_OperatingSystem");
ManagementObjectCollection collection = searcher.Get();

foreach (ManagementObject mbo in collection)
{
    _osVersion = mbo.GetPropertyValue("Caption").ToString();
    _osServicePack = string.Format("{0}.{1}", mbo.GetPropertyValue("ServicePackMajorVersion").ToString(), mbo.GetPropertyValue("ServicePackMinorVersion").ToString());

    try
    {
        _osArchitecture = mbo.GetPropertyValue("OSArchitecture").ToString();
    }
    catch
    {
        // OSArchitecture only supported on Windows 7/Windows Server 2008
    }
}

Console.WriteLine("osVersion     : " + _osVersion);
Console.WriteLine("osServicePack : " + _osServicePack);
Console.WriteLine("osArchitecture: " + _osArchitecture);

/////////////////////////////////////////
// Test on Windows 7 64-bit
//
// osVersion     : Microsoft Windows 7 Professional
// osservicePack : 1.0
// osArchitecture: 64-bit

/////////////////////////////////////////
// Test on Windows Server 2008 64-bit
//    --The extra r's come from the registered trademark
//
// osVersion     : Microsoftr Windows Serverr 2008 Standard
// osServicePack : 1.0
// osArchitecture: 64-bit

/////////////////////////////////////////
// Test on Windows Server 2003 32-bit
//    --OSArchitecture property not supported on W2K3
//
// osVersion     : Microsoft(R) Windows(R) Server 2003, Standard Edition
// osServicePack : 2.0
// osArchitecture: 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2012-10-06T10:41:32.293

我发现这是检查系统平台和进程的最佳方法：

```
bool 64BitSystem = Environment.Is64BitOperatingSystem;
bool 64BitProcess = Environment.Is64BitProcess; 
```

第一个属性对于 64 位系统返回 true，对于 32 位系统返回 false。第二个属性对 64 位进程返回 true，对 32 位返回 false。

需要这两个属性是因为您可以在 64 位系统上运行 32 位进程，因此您需要同时检查系统和进程。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-04-22T13:42:15.813

**OSInfo.Bits**

```
using System;
namespace CSharp411
{
    class Program
    {
        static void Main( string[] args )
        {
           Console.WriteLine( "Operation System Information" );
           Console.WriteLine( "----------------------------" );
           Console.WriteLine( "Name = {0}", OSInfo.Name );
           Console.WriteLine( "Edition = {0}", OSInfo.Edition );
           Console.WriteLine( "Service Pack = {0}", OSInfo.ServicePack );
           Console.WriteLine( "Version = {0}", OSInfo.VersionString );
           Console.WriteLine( "Bits = {0}", OSInfo.Bits );
           Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-03-18T11:19:23.217

将以下代码包含到项目中的类中：

```
 [DllImport("kernel32.dll", SetLastError = true, CallingConvention = CallingConvention.Winapi)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool IsWow64Process([In] IntPtr hProcess, [Out] out bool wow64Process);

    public static int GetBit()
    {
        int MethodResult = "";
        try
        {
            int Architecture = 32;

            if ((Environment.OSVersion.Version.Major == 5 && Environment.OSVersion.Version.Minor >= 1) || Environment.OSVersion.Version.Major >= 6)
            {
                using (Process p = Process.GetCurrentProcess())
                {
                    bool Is64Bit;

                    if (IsWow64Process(p.Handle, out Is64Bit))
                    {
                        if (Is64Bit)
                        {
                            Architecture = 64;

                        }

                    }

                }

            }

            MethodResult = Architecture;

        }
        catch //(Exception ex)
        {
            //ex.HandleException();
        }
        return MethodResult;
    } 
```

像这样使用它：

```
string Architecture = "This is a " + GetBit() + "bit machine"; 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2012-04-05T13:07:51.703

使用它来获取已安装的 Windows 体系结构：

```
string getOSArchitecture()
{
    string architectureStr;
    if (Directory.Exists(Environment.GetFolderPath(
                           Environment.SpecialFolder.ProgramFilesX86))) {
        architectureStr ="64-bit";
    }
    else {
        architectureStr = "32-bit";
    }
    return architectureStr;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-11-03T08:35:09.440

鉴于公认的答案非常复杂。有更简单的方法。我的是 alexandrudicu 回答的变体。鉴于 64 位 Windows 在 Program Files (x86) 中安装 32 位应用程序，您可以使用环境变量检查该文件夹是否存在（以弥补不同的本地化）

例如

```
private bool Is64BitSystem
{
   get
   {
      return Directory.Exists(Environment.ExpandEnvironmentVariables(@"%PROGRAMFILES(X86)%"));
   }
} 
```

这对我来说更快更简单。鉴于我还希望根据操作系统版本访问该文件夹下的特定路径。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-02-08T18:08:16.653

This question is for .NET 2.0 but still come up in a google search,这里没有人提到自从.NET标准1.1/.NET核心1.0以来，现在有更好的方法来了解CPU架构：

```
System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture 
```

这理论上应该能够区分 x64 和 Arm64，尽管我自己没有测试过。

请参阅[文档](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.runtimeinformation.processarchitecture)。

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2013-11-27T17:47:04.723

享受 ;-）

```
Function Is64Bit() As Boolean

    Return My.Computer.FileSystem.SpecialDirectories.ProgramFiles.Contains("Program Files (x86)")

End Function 
```

* * *

## 回答 #28

> 赞同：-3
> 
> 时间：2010-09-16T23:59:07.857

看看“C:\Program Files (x86)”是否存在。如果不是，那么您使用的是 32 位操作系统。如果是，则操作系统为 64 位（Windows Vista 或 Windows 7）。看起来很简单……

* * *

## 回答 #29

> 赞同：-4
> 
> 时间：2011-11-11T22:53:56.323

我用：

```
Dim drivelet As String = Application.StartupPath.ToString
If Directory.Exists(drivelet(0) & ":\Program Files (x86)") Then
    MsgBox("64bit")
Else
    MsgBox("32bit")
End if 
```

如果您将应用程序安装在计算机上的不同位置，这将获取启动应用程序的路径。此外，您可以只使用一般`C:\`路径，因为 99.9% 的计算机都安装了`C:\`.

* * *

## 回答 #30

> 赞同：-7
> 
> 时间：2010-09-17T22:46:36.903

我使用以下版本：

```
 public static bool Is64BitSystem()
    {
        if (Directory.Exists(Environment.GetEnvironmentVariable("Program Files (x86)"))) return true;
        else return false;
    } 
```

# asp.net-mvc - 有人向我解释 Html.DropDown 它是最亲爱的朋友 SelectList

> ID：336640
> 
> 赞同：5
> 
> 时间：2008-12-03T09:34:20.313
> 
> 标签：asp.net-mvc, drop-down-menu, selectlist

如果您查看我之前的问题，您可能已经注意到我没有得到 SelectList 和 Html.DropDown()。我觉得有趣的是，我似乎是其中唯一的一个。所以也许我应该尝试改变我的心态，或者也许有一些我不知道的事情会解决这一切。我真的很喜欢整个 MVC 框架，但 SelectList 只是不想适应我的想法。所以这是我的清单：

**选择列表**

*   为什么实例化后无法设置选定的值
*   为什么我不能按项目索引设置 selectedValue
*   为什么 selectedvalue 有时是字符串，有时是我放入其中的类，有时是 ListItem
*   为什么这些项目只能通过 GetItems() 访问
*   为什么 selectedItem 和 listItems 的类型不匹配？
*   为什么您放入列表中的项目转换为 listItem 而 selectedItem 没有？
*   为什么没有使用 GetItems() 方法我不能得到项目的数量

**Html.DropDownList()**

*   为什么模型绑定不能使用它
*   当只有一个选项时，为什么没有默认选择的行为
*   为什么不在源 selectLIst 中制作一个项目 SelectedValue 使其成为标记项目

在 ppl 建议我自己编写之前：
由于这将与 MVC 产品一起提供，因此我宁愿获得基本控件的官方支持，也不愿自己动手并承担随之而来的所有麻烦。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T21:04:01.217

我感觉到你的痛苦。原谅无耻的插件，但您可能会查看[MvcFluentHtml](http://lunaverse.wordpress.com/2008/11/24/mvcfluenthtml-fluent-html-interface-for-ms-mvc/)。您仍然可以使用 SelectList 和 MultiSelectList，但您还有其他几种选择。应该可以与粘合剂一起使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T05:56:53.307

我理解你的大部分问题，奇怪的是，我还没有遇到任何问题！但是，我可能完全按照 MVC 开发人员的意图使用它，并且不需要在框外冒险太多！

但希望对您有所帮助，以下是我如何使用 SelectList 和我设置的属性的示例：

`<%= Html.DropDownList("Module.Status", new SelectList(ViewData.Model.Statuses, "ID", "Name", ((int)ViewData.Model.Module.Status)), new {tabindex = 1, title = "Status"})`%>

在我的控制器操作中，我使用了 ModelBinder（你是说这不起作用？不确定你在那里遇到了什么问题，我的很好。）

```
public ActionResult Save(int? id, [Bind(Prefix = "Module", 
            Include = "Name,Description,Status")] Module module) 
```

然后可以访问状态，在我的例子中是“ `module.Status`”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T22:29:05.627

同样，我对 HTML Helpers 也有过很多误解，但没有比 SelectList 更糟糕的了。要添加到投诉列表中，我想知道为什么 SelectList 不接受（或无法处理） generic `IEnumerable<T>`。同样，您可以将自己的实现组合在一起，但`IEnumerable<T>`会启用很多方便的功能（例如对 LINQ/Entity Framework 的直接支持），我认为应该提供。

MvcFluentHtml（现在是[MvcContrib](http://www.codeplex.com/MVCContrib)的一部分）看起来像是一个不错的补充。

# linq - 将 Linq 与存储过程一起使用

> ID：336649
> 
> 赞同：1
> 
> 时间：2008-12-03T09:39:20.523
> 
> 标签：linq, performance, stored-procedures

我想规划一个数据访问层，我想使用 Linq。我读到 linq 在性能方面存在问题，您可以将存储过程与 linq 一起使用。在规划我的数据访问层时，我应该使用带有 linq 的存储过程吗？对性能很重要吗？我应该什么时候使用它们？我知道存储过程对于安全性至关重要，但 linq 使用类型安全查询，因此存储过程的唯一原因是性能。

谢谢，

暗里

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T09:44:23.400

根据我的阅读，服务器缓存了通过 LinqToSql 生成的查询的执行计划，因此这些查询的执行方式与等效的存储过程大致相同。如果您使用存储过程，那么您将失去使用 LinqToSql 获得的优势，因为您的查询逻辑将保留在数据库中。

有关更多信息，请参阅 Rico Mariani 关于 LinqToSql 性能的[博客系列](http://blogs.msdn.com/ricom/archive/2007/06/22/dlinq-linq-to-sql-performance-part-1.aspx)，以及[这篇博](http://dotnet.org.za/hiltong/archive/2008/02/01/why-use-linq-to-sql-part-1-performance-considerations.aspx)文。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T09:45:14.893

如果您只是编写简单的 CRUD，则存储过程不太可能帮助您提高性能。据我所知，存储过程的执行路径与准备好的语句几乎相同 - 即适当优化和缓存。

当您可以完全在数据库中完成工作时，它们会产生很大的不同，否则会涉及到数据库的多次往返（还有网络流量和延迟）。

您从哪里了解到 LINQ 存在性能问题？我知道一个通​​过预编译查询来解决的特定问题，但除此之外，我认为它基本上没问题......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-14T11:57:27.800

我建议使用 LINQ 或存储过程，但不要同时使用两者 - 没有真正的理由将两者结合起来，而且您不会在性能方面获胜。LINQ 可用于较小规模的 Web 应用程序、较大规模的 Web 应用程序的存储过程或更好的可扩展性

随着网络应用程序在用户数量、服务页面等方面的增长，问题不仅在于性能……它也成为维护问题。如果您的查询随着时间的推移变得更加复杂，那么您的 LINQ 代码可能会成为维护的噩梦。存储过程很好地隐藏在数据库层中。而且......无论任何人说什么，在数据库级别执行的查询总是会执行得更快。

# c# - 如何检测 Windows 64 位的 CPU 速度？

> ID：336654
> 
> 赞同：2
> 
> 时间：2008-12-03T09:43:08.160
> 
> 标签：c#, .net, windows, 64-bit, cpu-speed

我从这里找到了以下代码“[http://www.boyet.com/Articles/CodeFromInternet.html](http://www.boyet.com/Articles/CodeFromInternet.html) "。
它以 GHz 为单位返回 CPU 的速度，但仅适用于 32 位 Windows。

```
using System;
using System.Management;

namespace CpuSpeed
{
    class Program
    {
        static double? GetCpuSpeedInGHz()
        {
            double? GHz = null;
            using (ManagementClass mc = new ManagementClass("Win32_Processor"))
            {
                foreach (ManagementObject mo in mc.GetInstances())
                {
                    GHz = 0.001 * (UInt32) mo.Properties["CurrentClockSpeed"].Value;
                    break;
                }
            }
            return GHz;
        }

        static void Main(string[] args)
        {
            Console.WriteLine("The current CPU speed is {0}", (GetCpuSpeedInGHz() ?? -1.0).ToString());
            Console.ReadLine();
        }
    }
} 
```

我搜索了 64 位管理类，但没有成功。
有没有其他方法可以在 64 位 Windows 下获得 CPU 速度？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T14:42:42.307

下面的代码应该可以解决问题

```
 RegistryKey registrykeyHKLM = Registry.LocalMachine;
  string keyPath = @"HARDWARE\DESCRIPTION\System\CentralProcessor\0";
  RegistryKey registrykeyCPU = registrykeyHKLM.OpenSubKey(keyPath, false);
  string MHz = registrykeyCPU.GetValue("~MHz").ToString();
  string ProcessorNameString = (string)registrykeyCPU.GetValue("ProcessorNameString");
  registrykeyCPU.Close();
  registrykeyHKLM.Close();
  Console.WriteLine("{0} MHz for {1}", MHz, ProcessorNameString); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-17T15:50:58.900

Binoj 提供的答案的更简单版本如下。这将返回 CPU 的最大时钟速度。请注意，如果您想要机器上的总可用周期，您应该将此值乘以`Environment.ProcessorCount`。

```
private float GetCpuClockSpeed()
{
    return (int) Registry.GetValue(@"HKEY_LOCAL_MACHINE\HARDWARE\DESCRIPTION\System\CentralProcessor\0", "~MHz", 0);
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-16T14:54:59.063

我根据 Binoj Antony 的回答使用了以下代码，它返回每个 CPU/核心的速度，而不仅仅是第一个：

```
Microsoft.Win32.RegistryKey registrykeyHKLM = Microsoft.Win32.Registry.LocalMachine;
string cpuPath = @"HARDWARE\DESCRIPTION\System\CentralProcessor";
Microsoft.Win32.RegistryKey registrykeyCPUs = registrykeyHKLM.OpenSubKey(cpuPath, false);
StringBuilder sbCPUDetails = new StringBuilder();
int iCPUCount;
for (iCPUCount = 0; iCPUCount < registrykeyCPUs.SubKeyCount; iCPUCount++)
{
    Microsoft.Win32.RegistryKey registrykeyCPUDetail = registrykeyHKLM.OpenSubKey(cpuPath + "\\" + iCPUCount, false);
    string sMHz = registrykeyCPUDetail.GetValue("~MHz").ToString();
    string sProcessorNameString = registrykeyCPUDetail.GetValue("ProcessorNameString").ToString();
    sbCPUDetails.Append(Environment.NewLine + "\t" + string.Format("CPU{0}: {1} MHz for {2}", new object[] { iCPUCount, sMHz, sProcessorNameString }));
    registrykeyCPUDetail.Close();
}
registrykeyCPUs.Close();
registrykeyHKLM.Close();
sCPUSpeed = iCPUCount++ + " core(s) found:" + sbCPUDetails.ToString(); 
```

随意定制它以满足您的需求。

# c# - 那里最好的 Nunit 测试运行器是什么？

> ID：336655
> 
> 赞同：22
> 
> 时间：2008-12-03T09:43:58.563
> 
> 标签：c#, unit-testing, nunit, test-runner

最近进入测试驱动开发，我正在使用作为 resharper 的一部分提供的 Nunit 测试运行器。它有一些缺点，没有运行测试的捷径，我必须去寻找 Nunit 测试运行器来使用鼠标调用它。它有一个很好的 GUI，并且将结果作为 IDE 的一部分很好地显示出来。

其他人使用什么来针对 .net 项目运行单元测试？我在 Google 上搜索了其他应用程序，包括 MBUnit 和 Nunit.org 的单元测试应用程序，并想知道人们最喜欢的是什么。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-03T09:53:10.790

我一直是 TestDriven.NET 的粉丝，比起使用 ReSharper，我更喜欢它。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-03T10:19:12.313

Resharper 确实有一些缺点......但可以将其配置为做你想做的事......

您可以在 Visual Studio 中配置键盘选项。此外，您可以使用 Resharper 中的单元测试资源管理器来查找所需的测试并将它们添加到当前会话中。我通常会配置一个快捷方式 (Alt+U) 来运行当前会话中的所有测试……这样，在我开发过程中，我可以在几秒钟内运行我需要的所有单元测试。

另请查看：

*   [ReSharper 一次运行项目或解决方案中的所有单元测试](https://stackoverflow.com/questions/334933/resharper-run-all-unit-tests-in-a-project-or-solution-at-once)

*   [ReSharper 的单元测试运行器有快捷键吗？](https://stackoverflow.com/questions/175116/are-there-shortcut-keys-for-resharpers-unit-test-runner)

但是，如果不必手动配置，那就太好了！（是的！我在看你们 Resharper 开发团队！哈哈）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-03T10:33:41.037

我使用 NUnit 附带的单独的 NUnit GUI。不利的一面是您必须使用 alt-tab 来切换它，但我喜欢在我的屏幕上有一个绿色/红色粗条的视觉反馈，并且可以很好地概览树视图中的所有测试。

您可以将其设置为在检测到程序集已更改时重新运行上次测试运行，因此它确实不会减慢您的速度，因为它没有集成到 Visual Studio 中。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-06-28T23:46:38.723

Gallio Icarus 是一个比 nUnit 中包含的更好看的测试运行程序。它运行 nUnit 测试，所以值得一看。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-08-06T09:05:18.953

我曾经使用 TestDriven.Net，恕我直言，这是目前最好的跑步者，但最近[NCrunch](http://www.ncrunch.net/)是我对单元测试的新宠。

NCrunch 在您编写代码时（有选择地）在后台运行您的所有测试。它是 TDDing 的一个很好的工具，几乎可以在代码中断时提供即时反馈。它还提供代码覆盖率数据和性能指标，您无需付出任何努力（但需要您的处理器投入......）。

我仍然使用 TestDriven.Net 进行繁重的集成测试（因为我通常在 NCrunch 中禁用它们）和特定任务，因此使用这两个运行器对于 TDD 从业者来说是一个很好的组合。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-17T16:45:08.960

总的来说，我喜欢 NUnit GUI，但我目前有一些烦恼：

*   运行测试后自动扩展夹具
*   双击测试会清除对等测试的结果

我也非常喜欢 DevExpress Test Runner，但它会在运行测试之前重建我的项目。在小型系统中这不是问题，但是当您有近 60 个项目时，等待时间不短。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T09:51:35.647

Resharper 和我认为有捷径，但是它有一些缺点。就像没有像 TestMatrix 那样的[测试覆盖](http://www.exactmagic.com/products/testmatrix/)。但无论如何，生活并不完美。

顺便说一句，TestMatrix 似乎已经死了。

# ms-access - 查询记录集

> ID：336662
> 
> 赞同：0
> 
> 时间：2008-12-03T09:46:45.093
> 
> 标签：ms-access, recordset

在记录集上进行这样的查询是否有效

rs.open "select * from table where vd=1; update table set vd1 = 1 where vd=2 or vd=3;"

或者有什么问题吗

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T09:49:18.880

它不起作用 - 您必须将它们作为单独的命令执行

大概您已声明`rs`为记录集，因此您可以使用它来返回`SELECT`语句结果。

我会使用 SQL 命令来执行第二条语句。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T03:57:53.940

只能使用单个 SELECT 语句定义记录集（当然，如果它们具有相同的列数，您可以 UNION 多个选择）。

任何操作 SQL（INSERT、UPDATE、DELETE）都不能使用记录集执行，而是使用 .Execute 方法。

如果您使用 ADO，.Execute 也可用于 SELECT（它返回行），但 Jet 的本机数据接口层 DAO 不能 -- .Execute 仅适用于操作查询。这对我来说似乎是明智的，但对我个人而言，ADO 似乎总是在浪费时间。

此外，Jet（Access 默认使用的数据库引擎）不能像许多基于服务器的数据库引擎一样一次执行多个 SQL 语句。对于那些习惯于批处理 SQL 语句的人来说，这并不是一个很大的限制——它只是不同而已。

# java - 在 jvm 中缓存一个 tar 以获得更快的文件 I/O？

> ID：336664
> 
> 赞同：1
> 
> 时间：2008-12-03T09:47:54.997
> 
> 标签：java, jvm, tar, mmap, vfs

我正在开发一个 Java Web 应用程序，该应用程序使用数千个小文件来构建工件以响应请求。我认为如果我们可以将这些文件映射到内存而不是在整个磁盘上运行以一直查找它们，我们的系统可以看到性能改进。

我听说过 linux 中的 mmap，我对这个概念的基本理解是，当从磁盘读取文件时，文件的内容会缓存在内存中的某个位置，以便更快地进行后续访问。我的想法类似于这个想法，除了我想将整个可 mmap 的文件集读入内存，因为我的 Web 应用程序正在初始化以实现最小的请求时间响应。

我的思路的一个方面是，如果将文件全部打包并以某种方式作为虚拟文件系统安装在 JVM 中，我们可能会更快地将文件放入 jvm 内存。就目前而言，我们当前的实现可能需要几分钟才能遍历源文件集并找出磁盘上的所有内容。这是因为我们实际上是在对超过 300,000 个文件进行文件统计。

我找到了可以从 tar 文件中读取信息的 apache VFS 项目，但是我不确定他们的文档中是否可以指定诸如“另外，将整个 tar 读入内存并将其保存在那里..”之类的内容。

我们在这里谈论的是一个多线程环境，该环境服务于通常将一整套 300,000 多个源文件中的大约 100 个不同文件拼凑在一起以做出一个响应的工件。所以无论虚拟文件系统解决方案是什么，它都需要是线程安全的和高性能的。我们在这里只讨论读取文件，没有写入。

此外，我们正在运行具有 32 GB RAM 的 64 位操作系统，我们的 300,000 个文件占用大约 1.5 到 2.5 GB 的空间。我们肯定可以将 2.5 GB 的文件读入内存比 300K 的几 KB 大小的小文件快得多。

感谢您的输入！

*   杰森

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T10:29:59.860

您可以尝试将所有文​​件放在一个 JAR 中并将其放在类路径中。Java 使用一些内置技巧来非常快速地读取 JAR 文件。这也会将所有文件的目录保留在 RAM 中，因此您不必访问磁盘来查找文件（在您开始加载文件之前会发生这种情况）。

JVM 不会一次将整个 JAR 加载到 RAM 中，而且您可能也不希望这样做，因为您的机器会开始交换。但是它将能够非常快速地找到这些片段，因为它将始终保持文件打开，因此，您不会在任何时候打开/关闭文件资源。

此外，由于您一直在使用这个单个文件，因此操作系统可能会将其保留在文件缓存中的时间更长。

最后，您可以尝试压缩 JAR。虽然这听起来可能是个坏主意，但您应该试一试。如果小文件压缩得很好，那么用当前 CPU 解压的时间比从磁盘读取数据的时间要短得多。如果您不必将中间数据保存在任何地方，则可以将未压缩的数据流式传输到客户端，而无需写入文件（这会破坏整个想法）。这样做的缺点是它确实会占用 CPU 周期，如果您的 CPU 很忙（只需使用一些加载工具检查；如果它高于 20%，那么您就会松动），那么您将使整个过程变慢。

也就是说，当您使用 HTTP 协议时，您可以告诉客户端您正在发送压缩数据！这样，您不必解压数据*并且*可以加载非常小的文件。

JAR 解决方案的主要缺点：只要服务器正在运行，您就无法替换 JAR。因此，替换文件意味着您必须重新启动服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T13:09:55.960

如果您需要快速访问 300,000 个文件，您可以使用数据库，而不是关系数据库，而是简单的键值数据库，例如[http://www.space4j.org/](http://www.space4j.org/)。这对您的启动时间没有帮助，但在运行时可能会大大加快速度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T14:29:53.183

您需要的是在**HashTable**中加载所有信息。

使用文件名作为键加载每个文件，将内容作为值，您将能够比您想象的设置更快、更轻松地工作几个数量级。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T10:02:31.023

澄清一下，`[mmap()](http://linux.die.net/man/2/mmap)`在类 Unix 系统中不允许您这样访问文件；它只是使文件的内容在内存中可用，作为内存。您不能用于`open()`进一步打开任何包含的文件。没有所谓的“一`mmap()`组文件”。

难道你不能添加一个最初加载所有“模板”的通道，然后根据简单的东西快速找到它们，比如每个名称上的哈希？这应该可以让你利用你的记忆，并开始对任何模板进行 O(1) 访问。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T10:04:14.810

我认为您仍在考虑使用旧的内存/磁盘模式。

`mmap`在这里无济于事，因为旧的内存/磁盘东西早已不复存在。如果你映射一个文件，内核会给你一个指向一些**虚拟内存**的指针，供你自行决定使用，它**不会**立即将文件加载到**实际内存**中，它会在你请求时这样做文件的一部分，它只会加载您请求的页面。（即一个内存页，通常在 4KB 左右。）

你说那些 300k 的文件，大约需要 1.5GB 到 2.5GB 的磁盘空间。如果有任何机会可以将 2（或更好，4）更多 GB 的 RAM 投入服务器，如果它有足够的 RAM 可以将文件加载到某些磁盘缓存中，那么将磁盘读取内容留给操作系统会**更好**，它会，并且从他们那里，他们上的任何 read() 甚至都不会击中磁盘。（如果您没有使用 noatime 安装卷，它会将 atime 存储在 inode 中。）

如果您尝试读取（）文件，将它们放入内存并从那里提供它们，您现在可以确定它们将始终在**RAM**中而不是在交换中，因为操作系统还有其他事情要做你有几次没有使用的那部分内存。

如果您有足够的 RAM 让操作系统进行磁盘缓存，并且您确实希望加载文件，那么您总是可以编写一个小脚本/程序来遍历您的层次结构并读取所有文件。（不做任何其他事情。）它将让操作系统将它们从磁盘加载到内存磁盘缓存，但是如果操作系统需要内存，您无法知道它们会留在那里。因此，正如我之前所说，您应该让操作系统处理它并为其提供足够的 RAM 来执行此操作。

您应该阅读[varnish](http://varnish.projects.linpro.no/)的[Architect Notes](http://varnish.projects.linpro.no/wiki/ArchitectNotes)，phk 用他自己的话告诉您，为什么您要实现的目标最好留给操作系统，它永远会更好地了解 JVM 内存中有什么，什么是不是。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T10:23:37.703

如果您需要快速访问所有这些文件，您可以将它们加载到内存中，但我不会将它们作为文件加载。我会将这些数据放在某种对象结构中（以最简单的形式，只是一个字符串）。

我要做的是创建一个服务，从您使用的任何参数中将文件作为对象结构返回。然后围绕这个服务实现一些缓存机制。然后就是调整缓存的问题了。如果您确实需要将所有内容加载到内存中，请配置缓存以使用更多内存。如果某些文件的使用量比其他文件多得多，则仅缓存那些文件可能就足够了...

如果我们对您想要达到的目标有更多了解，我们可能会给您更好的回应。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T10:34:13.313

将文件放在 10 个不同的服务器上，而不是直接为请求提供服务，而是向客户端发送 HTTP 重定向（或等效的），并附上他们可以找到所需文件的 URL。这允许分散负载。服务器只响应快速请求，并且（大）下载分布在多台机器上。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T11:00:31.700

如果您使用的是 Linux，我会尝试使用好的旧[RAM 磁盘。](http://www.vanemery.com/Linux/Ramdisk/ramdisk.html)您可以坚持当前的做事方式，并大幅降低 IO 成本。您不受 JVM 内存的约束，仍然可以轻松替换内容。

正如您所说的 VFS：它也有一个[RAM 磁盘提供程序](http://commons.apache.org/vfs/filesystems.html#ram)，但我仍然会首先尝试使用本机 RAM 磁盘方法。

# error-handling - 为什么类中的错误只在运行时被捕获？

> ID：336665
> 
> 赞同：0
> 
> 时间：2008-12-03T09:48:47.260
> 
> 标签：error-handling, vb6, ide

我有一个带有引发错误的方法的 VB6 类：

```
Public Sub DoSomething
  ...
  err.Raise 12345, description:="Error message"
  ...
End Sub 
```

这个方法是从一个表单中调用的：

```
Public Sub ErrTest()
  On Error Goto err1
  obj.DoSomething
  Exit Sub
err1:
  MsgBox err.Description
End Sub 
```

这在运行时工作正常，但在设计时错误处理不起作用。相反，VB6 IDE 显示其标准消息框，我可以从中进入调试模式或结束程序。

为什么会这样？我可以阻止它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T10:43:59.237

在 VB IDE 中，转到工具、选项、常规选项卡、错误捕获框。我猜您将其设置为“在所有错误时中断”，而您可能想要“在未处理的错误时中断”。

你的`Err.Raise`陈述给我一个编译错误；尝试取下牙套。

此外，您可能想使用

```
Err.Raise vbObjectError + 12345, Description:="Error message" 
```

即从 VB 常量 vbObjectError 中偏移您的错误代码，以确保您不会发生冲突。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T19:06:19.437

您还可以通过在代码窗口中单击鼠标右键来更改错误捕获选项。“切换”子菜单提供以下选项：

Break on All Errors
Break on Class Module
Break on Unhandled Errors

我发现这比弹出“选项”对话框要容易得多...

# javascript - 显式脚本结束标记始终转换为自动关闭

> ID：336670
> 
> 赞同：11
> 
> 时间：2008-12-03T09:49:27.633
> 
> 标签：javascript, xslt

我正在使用 xslt 将 xml 转换为 aspx 文件。在 xslt 中，我有一个包含 jquery.js 文件的脚本标记。为了让它与 IE 一起工作，脚本标签必须有一个明确的结束标签。出于某种原因，这不适用于下面的 xslt。

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl"
    xmlns:asp="remove">    
    <xsl:output method="html"/>
    <xsl:template match="/">
        <html xmlns="http://www.w3.org/1999/xhtml">
            <head>
                <title>TEST</title>
                <script type="text/javascript" src="jquery-1.2.6.js"></script> 
```

但是，如果我如下所示更改脚本标记，它就可以工作。

```
 <script type="text/javascript" src="jquery-1.2.6.js">
            // <![CDATA[ // ]]>
        </script> 
```

我以为这`<xsl:output method="html" />`可以解决问题，但它似乎不起作用？

/乔纳斯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T00:34:01.103

如果您自己创建 XmlWriter，则需要将转换的 OutputSettings 传递给 XmlWriter，例如：

```
XmlDocument doc = new XmlDocument();
doc.LoadXml("<book><author>Trudi Canavan</author><title>Voice of the Gods</title></book>");

XslCompiledTransform transform = new XslCompiledTransform();
transform.Load("XSLTFile1.xslt");

StringBuilder output = new StringBuilder();

// Here we pass the output setting to the writer, otherwise the transform
// may be set to Html, but the XmlWriter will be outputting Xml
XmlWriter writer = XmlWriter.Create(output, transform.OutputSettings);

transform.Transform(doc, writer);

Console.WriteLine(output.ToString());
Console.ReadKey(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-11T13:39:21.650

从 XSLT 生成 HTML 时，这是一个很常见的问题。我怀疑问题的根源在于 XSLT 本身就是一个 XML 文档。即使您从作为序列化 XML 的 XSLT 程序开始，当 XSLT 处理器获取它时，它已经被反序列化为“信息集”表示。在 XML 级别，空标签和自封闭标签是等价的；该元素根本没有孩子。这意味着您的 XSLT 处理器可能永远不会看到脚本元素同时具有开始和结束标记的程序版本。

我通常通过使用适当转义的不间断空间来解决这个问题。在任何情况下，您都必须在脚本标签中添加一些内容。

顺便说一句 - 这不是为了让 IE 开心。如果您查看[HTML 规范](http://www.w3.org/TR/1999/REC-html401-19991224/interact/scripts.html#edef-SCRIPT)，您会发现结束标记是必需的。我敢肯定有些人会觉得 IE 正确地实现了它具有讽刺意味。:-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-07-20T15:05:00.867

我在 MSDN 论坛网站上找到了这个答案：

```
<xsl:value-of select="' '"/> 
```

如果您在 xsl 文件的结尾之前添加上述 xslt 代码，它会强制元素具有一些内容（在这种情况下为空格），而不是自行关闭。试过了，它奏效了。

这是它创建的：

```
<script...> </script> 
```

代替

```
<script ... />. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-21T10:16:23.790

考虑这个例子，

```
<Discount>
       <!--<xsl:if test="Discount>0">-->
             <xsl:value-of select="Discount"/>
       <!--</xsl:if>-->
</Discount> 
```

如果我正在为产品打折。我在使用前检查它。它将返回的输出，

```
<Discount>value of the discount</Discount> 
```

但是，如果我这样取消对上述示例的注释，

```
<Discount>
       <xsl:if test="Discount>0">
             <xsl:value-of select="Discount"/>
       </xsl:if>
</Discount> 
```

它会在 xslt 之后返回 o/p as（如果折扣 > 0），

```
<Discount/> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-04T00:38:59.517

这是设计使然，我知道的唯一解决方法是使用自定义`XmlTextWriter`：

```
public class HtmlTextWriter : XmlTextWriter
{
    private readonly string[] fullEndElements = 
        new string[] { "script", "title" };

    private string lastStartElement = null;

    public HtmlTextWriter(TextWriter textWriter)
        : base(textWriter)
    {
    }

    public HtmlTextWriter(string filename, Encoding encoding)
        : base(filename, encoding)
    {
    }

    public HtmlTextWriter(Stream w, Encoding encoding)
        : base(stream, encoding)
    {
    }

    public override void WriteStartElement(string prefix, string localName, string ns)
    {
        lastStartElement = localName;
        base.WriteStartElement(prefix, localName, ns);
    }

    public override void WriteEndElement()
    {
        if (Array.IndexOf(fullEndElements, lastStartElement) > -1)
        {
            base.WriteFullEndElement();
        }
        else
        {
            base.WriteEndElement();
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-10T14:32:08.610

Bart van Delfts 的回答为我指明了正确的方向，所以为这个提示欢呼！

我也遇到了这个问题，使用 [ *javax.xml.transform.Transformer* ] 每当我试图解析一段格式化的 html 时，就我而言： -

`<textarea></textarea>`

节点的最终输出被带入我的jsp：-

```
<textarea/> 
```

这显然搞砸了任何以下代码，因为它被视为 textarea 元素的更多内容。

设置`t.setOutputProperty(javax.xml.transform.OutputKeys.METHOD, "html");`似乎提供了我期望的自动关闭行为。根据我自己的测试，这个属性默认为“xml”，因此很明显，一个下面没有节点的 xml 标记非常适合自动关闭。

无论如何，希望这会有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T09:59:21.370

这当然是针对 MS 的 XSLT 引擎的？多么奇怪。我不能说我在 .NET 1.1 或 2.0 中遇到过这种情况，而且我有许多转换在做完全相同的事情，所以我建议你使用简单的解决方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-09T11:45:23.203

我在脚本结束标记之前使用了注释来解决这个问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-12-07T11:33:30.363

如前所述，将不可见内容放入元素中有一些技巧，但在 xslt 中，您始终可以将准确的输出呈现为文本：

```
<xsl:text disable-output-escaping="yes">
    &lt;script src="jquery-2.0.3.js"&gt;&lt;/script&gt;
</xsl:text> 
```

顺便提一句。我认为 method="html" 也应该可以解决问题，但是您不会像那样渲染 xhtml，例如 br 不会被关闭。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-07-20T14:04:50.073

对于那些使用 Xalan 2.7.0（Java）的人，我遇到了同样的问题。我采用了原始源代码中的 org/apache/xml/serializer/ToStream.java 文件来解决这个问题。如果您指定为 outputProperty：

```
private static Properties XHTML() {
  Properties p = new Properties();
  p.setProperty(OutputKeys.METHOD, "xhtml");
  p.setProperty(OutputKeys.DOCTYPE_PUBLIC,
    "-//W3C//DTD XHTML 1.0 Strict//EN");
  p.setProperty(OutputKeys.DOCTYPE_SYSTEM,
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd");
  p.setProperty(OutputKeys.ENCODING, "UTF-8");
  p.setProperty("{http://xml.apache.org/xalan}indent-amount", "4");
  p.setProperty(OutputKeys.INDENT, "yes");
  p.setProperty(OutputKeys.OMIT_XML_DECLARATION, "no");
  p.setProperty("{http://example.com}selfclosing","no");
  return p;
 } 
```

注意最后一行`selfclosing`。这是在这个更新的 ToStream.java 版本中响应的属性，它将阻止`<div />`和`<script />`标记以及输出`<div></div>`和`<script></script>`标记。它还包括这些例外，即 HTML 标准中指定允许自闭合的例外（即“area”、“base”、“basefont”、“br”、“col”、“frame”、“hr ”、“img”、“输入”、“链接”、“元”、“参数”）。它至少对我有用，现在网页在 IE 中也可以很好地呈现。

新的 ToStream.java 文件可以在[http://bvandelft.ruhosting.nl/ToStream.java](http://bvandelft.ruhosting.nl/ToStream.java)找到，并且 serializer.jar 的预编译版本（与 2.7 一起使用）也可以在相同的 URL 但 serializer.jar （其中包含 ToStream 的编译版本）不允许发布超过 1 个 URL :-p

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-05-04T00:03:54.327

另一个快速技巧是在标签中添加 Javascript 注释：

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">//</script> 
```

这只会在脚本末尾添加一个注释 - 但请注意不要错误地注释掉任何内容！

# javascript - 是否有任何用于检查键盘/鼠标活动的预构建 Javascript？

> ID：336672
> 
> 赞同：1
> 
> 时间：2008-12-03T09:50:36.817
> 
> 标签：javascript, dom-events, keyboard-events, time-tracking, user-activity

我需要一个 Javascript 来监视键盘和鼠标事件以跟踪用户在页面上花费的时间。具体来说，通过键入或用鼠标移动/单击来主动使用页面。

我想我会问是否有人知道一些可能对我有用的东西以节省一些时间。否则，Javascript 和阿司匹林我来了……哈哈

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T10:29:49.517

记录鼠标移动示例：http: [//pure.rednoize.com/movelogger/](http://pure.rednoize.com/movelogger/)

*   关于检测击键的一般信息： [http ://www.quirksmode.org/js/keys.html](http://www.quirksmode.org/js/keys.html)
*   关于鼠标事件的一般信息： [http ://www.quirksmode.org/js/events_mouse.html](http://www.quirksmode.org/js/events_mouse.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T10:24:11.540

从理论上讲，所有 DOM 元素都可以对 onClick、onMouseOver、onKeyPress 等事件做出反应。从整个页面到每个元素。我会从你喜欢的任何 JavaScript 库开始。

# c++ - 在 C++ 上使用带有 LoadLibrary() 方法的库 dll

> ID：336682
> 
> 赞同：1
> 
> 时间：2008-12-03T09:54:11.943
> 
> 标签：c++, winapi

我可以使用 LoadLibrary 方法来导入结构类型的数据吗？请原谅我的英语。谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-03T10:25:04.830

让我假设问题中遗漏了一些事情：

1.  您有一个名为**flubber.dll的动态库**
2.  库导出函数`bool GetFlubber(Flubber* flubber)`。
3.  函数和类型`Flubber`（恰好是一个！）在名为**flubber.h**`struct`的头文件中声明。

 **如果满足这 3 个条件，那么您可以`LoadLibrary`在**flubber.dll**上使用，然后`GetProcAddress`使用`GetFlubber`as proc name，最后您可以`Flubber`在本地声明一个实例并通过`GetFlubber`检索到的 proc 地址将其传递给它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T10:22:47.487

你的意思是把数据放在一个dll中，然后使用LoadLibrary和Getprocaddres来获取指向数据的指针吗？这是可能的，尽管将函数放在 dll 中并让它们返回指向数据的指针更为常见。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T09:59:18.907

嗯……这个问题有点难以理解，恐怕。

在 C++ 中，结构声明就是一个声明。它不会生成你可以在运行时加载的东西，它是一个纯粹的编译时构造，它只是告诉编译器某些东西在内存中的布局、涉及的字段、它们的类型和顺序等等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T10:21:32.527

我假设您使用的是 VC++ 2005。

MS 现在为您提供[延迟加载 Dll 的](http://msdn.microsoft.com/en-us/library/151kt790.aspx).

Visual C++ 链接器现在支持延迟加载 DLL。这使**您**无需使用 Windows SDK 函数**LoadLibrary**和 GetProcAddress 来实现 DLL 延迟加载。

设置延迟负载的步骤。

转到项目->属性->链接器->输入，然后在“延迟加载的 DLL”中指定您的 Dll

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T03:03:58.087

As other responses have suggested it's hard to tell what's being asked here, but I'll throw in a response for another interpretation of the question. I'm not sure if it's "officially supported", but you can have a DLL export a global variable and then dynamically access it via GetProcAddress.

For instance, if a library called foo.dll contains a global of type FOO named g_MyGlobal, then it can export the variable in foo.def. Client code can then call:

```
MyPointer = GetProcAddress(..., "g_MyGlobal"); 
```

and get a "FOO *" pointer to the global.

...but with that said, if you find yourself needing to do this for something other than private testing purposes, you might want to re-think your design. It would probably be much safer and cleaner to hide this global behind an exported function in the DLL.

# wpf - WrapPanel 和第一行

> ID：336686
> 
> 赞同：0
> 
> 时间：2008-12-03T09:55:39.303
> 
> 标签：wpf, wpf-controls

我有包裹在包裹面板中的物品。我想将第一行项目向下移动一些偏移量。

是否可以？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T10:24:49.790

尝试设置 WrapPanel 的 Margin 属性...

Margin="0, 5, 0 ,0" （左、上、右、下）

高温高压

# asp.net - 用于显示 OLAP 多维数据集的免费控件

> ID：336695
> 
> 赞同：3
> 
> 时间：2008-12-03T10:00:32.117
> 
> 标签：asp.net, olap, cubes

是否有一组免费的控件可用于表示 aspx 页面中的 OLAP 多维数据集？类似于 Dundas 的那些，但免费且（如果可能）跨浏览器。

谢谢，卢锡安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-07T12:52:07.790

目前我们使用 JPivot，它实际上是 Java 并且应该托管在应用服务器中，我建议您稍微搜索一下 google，因为对于您想要在某处做的事情，肯定会有一个开源解决方案。

[http://www.freedownloadmanager.org/downloads/olap_viewer_software/](http://www.freedownloadmanager.org/downloads/olap_viewer_software/)可能会有所帮助（谷歌“OLAP Viewers ASP”的第一次点击）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T13:16:33.700

我们在内部编写了一个 Web OLAP 查看器（ASP/HTML/JavaScript），它非常复杂，并且花费了很长时间。用户只是要求更多功能。

有一个 MS Office v10 插件或 ActiveX 控件，您可以在网页上拍打以查看多维数据集....我认为它可以通过 HTTP 工作，但您会在此过程中的某个地方感到悲伤，抱歉。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-04T19:57:58.140

开源[Ranet 库](http://code.google.com/p/ranet-uilibrary-olap/)可能会满足您的需求。它使用 Silverlight 并且是完全可编程的。如果需要，也有商业许可证可用。

# java - 非常不寻常的情况 - 线程被它持有的锁阻塞？

> ID：336696
> 
> 赞同：4
> 
> 时间：2008-12-03T10:00:36.207
> 
> 标签：java, locking

我正在处理的这个 java 程序似乎在启动时挂起，所以我尝试使用 jconsole 来调试问题。事实证明，它正在等待对声明为的方法的调用 -

```
synchronized void stopQuery() 
```

但这是疯狂的部分，“同步”方法的锁已经被为它阻塞的线程持有。在执行 getThreadInfo() MXBean 方法后，我附上了 JConsole 的屏幕截图。

注意 lockOwnerId 和 threadId 是一样的！这怎么可能？

[![替代文字](https://i.stack.imgur.com/TYWk9.png)](https://i.stack.imgur.com/TYWk9.png)

**编辑：**
**[链接](http://placidsystems.com/files/stacktrace.txt)**到这种情况的堆栈跟踪之一。请注意，在查看堆栈跟踪后，可能会出现甚至 'org.eclipse.jdt.internal.ui.text.JavaReconciler' 线程正在尝试锁定同一个 DiskIndex 对象，但如果您查看对象地址，您将看到它实际上是一个不同的 DiskIndex 对象。

**编辑 2：** 我在重现此问题时获得的
**[另一个指向不同堆栈跟踪的链接。](http://placidsystems.com/files/stacktrace2.txt)**将两者进行比较以了解共同点应该会有所帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T18:27:48.007

这看起来像是一个特别讨厌的僵局。如果没有更多信息，很难确定。不过，这是我在没有代码的情况下看到的：

“Text Viewer Hover Presenter”和“Worker-3”之间的对象引用 0x00002aace2276720 可能出现死锁（或至少争用），而“Worker-3”正在锁定引用 0x00002aace2276ad0。

第二个引用似乎是一大堆阻塞线程（特别是“Worker-4”、“Worker-1”和“Worker-0”）的原因。

我的建议是检查 ASTProvider.java 第 450 行（请参阅前两个堆栈跟踪，其中可疑对象锁似乎被持有但似乎没有超过 wait()）。我还建议尝试运行锁定到单核的可执行文件（假设这是一个多核系统）。

看起来值得测试的下一段代码是 SelectionListenerWithASTManager.java 第 153 行（其中引用 0x00002aace2276ad0 被锁定，导致 Workers 阻塞）。

0x00002aace2276720 的储物柜：

```
"Text Viewer Hover Presenter" daemon prio=10 tid=0x00002aad20166400 nid=0x51f4 in Object.wait() [0x000000004254c000..0x000000004254dd90]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    - waiting on <0x00002aace2276720> (a java.lang.Object)
    at java.lang.Object.wait(Object.java:485)
    at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST(ASTProvider.java:450)
    - locked <0x00002aace2276720> (a java.lang.Object)
    at org.eclipse.jdt.ui.SharedASTProvider.getAST(SharedASTProvider.java:129)
    at org.eclipse.jdt.internal.ui.text.java.hover.NLSStringHover.getHoverInfo(NLSStringHover.java:87)
    at org.eclipse.jdt.internal.ui.text.java.hover.AbstractJavaEditorTextHover.getHoverInfo2(AbstractJavaEditorTextHover.java:86)
    at org.eclipse.jdt.internal.ui.text.java.hover.BestMatchHover.getHoverInfo2(BestMatchHover.java:129)
    at org.eclipse.jdt.internal.ui.text.java.hover.JavaEditorTextHoverProxy.getHoverInfo2(JavaEditorTextHoverProxy.java:82)
    at org.eclipse.jface.text.TextViewerHoverManager$4.run(TextViewerHoverManager.java:166)

"Worker-3" prio=10 tid=0x00002aad132c3800 nid=0x5166 in Object.wait() [0x0000000042249000..0x000000004224ab10]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    - waiting on <0x00002aace2276720> (a java.lang.Object)
    at java.lang.Object.wait(Object.java:485)
    at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST(ASTProvider.java:450)
    - locked <0x00002aace2276720> (a java.lang.Object)
    at org.eclipse.jdt.ui.SharedASTProvider.getAST(SharedASTProvider.java:129)
    at org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$PartListenerGroup.calculateASTandInform(SelectionListenerWithASTManager.java:168)
    at org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$3.run(SelectionListenerWithASTManager.java:153)
    - locked <0x00002aace2276ad0> (a java.lang.Object)
    at org.eclipse.core.internal.jobs.Worker.run(Worker.java:55) 
```

在 0x00002aace2276ad0 被阻止

```
"Worker-4" prio=10 tid=0x00002aad132c4000 nid=0x5167 waiting for monitor entry [0x000000004234b000..0x000000004234bc90]
   java.lang.Thread.State: BLOCKED (on object monitor)
    at org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$3.run(SelectionListenerWithASTManager.java:153)
    - waiting to lock <0x00002aace2276ad0> (a java.lang.Object)
    at org.eclipse.core.internal.jobs.Worker.run(Worker.java:55)

"Worker-1" prio=10 tid=0x00002aad12835800 nid=0x5164 waiting for monitor entry [0x0000000041a42000..0x0000000041a42a10]
   java.lang.Thread.State: BLOCKED (on object monitor)
    at org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$3.run(SelectionListenerWithASTManager.java:153)
    - waiting to lock <0x00002aace2276ad0> (a java.lang.Object)
    at org.eclipse.core.internal.jobs.Worker.run(Worker.java:55)

"Worker-0" prio=10 tid=0x00002aad11a0ac00 nid=0x5146 waiting for monitor entry [0x0000000041941000..0x0000000041941d90]
   java.lang.Thread.State: BLOCKED (on object monitor)
    at org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$3.run(SelectionListenerWithASTManager.java:153)
    - waiting to lock <0x00002aace2276ad0> (a java.lang.Object)
    at org.eclipse.core.internal.jobs.Worker.run(Worker.java:55) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T10:02:59.243

不知何故，该方法是递归的吗？也许您在其中使用了一个需要相同方法的对象？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T10:04:37.757

但是同步方法上的锁是可重入的，这意味着如果持有该对象锁的线程试图再次锁定它，它总是会成功。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T10:52:11.670

可能值得尝试死锁检测代码位 -[像这样](http://www.javaspecialists.co.za/archive/newsletter.do?issue=093)。

stopQuery 锁似乎之前没有在堆栈跟踪中获得锁，但是该锁似乎也没有在其他任何地方获得 - 奇怪......

```
"Worker-2" prio=10 tid=0x00002aad1da66400 nid=0x5165 waiting for monitor entry [0x0000000041b43000..0x0000000041b43b90]
   java.lang.Thread.State: BLOCKED (on object monitor)
    at org.eclipse.jdt.internal.core.index.DiskIndex.stopQuery(DiskIndex.java)
    - waiting to lock <0x00002aacdfe83ea8> (a org.eclipse.jdt.internal.core.index.DiskIndex)
    at org.eclipse.jdt.internal.core.index.Index.stopQuery(Index.java:192) 
```

在这个位中有一个持有锁的等待，但那是释放锁，直到它得到一个通知/超时：

```
"Text Viewer Hover Presenter" daemon prio=10 tid=0x00002aad20166400 nid=0x51f4 in Object.wait() [0x000000004254c000..0x000000004254dd90]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    - waiting on <0x00002aace2276720> (a java.lang.Object)
    at java.lang.Object.wait(Object.java:485)
    at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST(ASTProvider.java:450)
    - locked <0x00002aace2276720> (a java.lang.Object)
    at org.eclipse.jdt.ui.SharedASTProvider.getAST(SharedASTProvider.java:129)
    at org.eclipse.jdt.internal.ui.text.java.hover.NLSStringHover.getHoverInfo(NLSStringHover.java:87)
    at org.eclipse.jdt.internal.ui.text.java.hover.AbstractJavaEditorTextHover.getHoverInfo2(AbstractJavaEditorTextHover.java:86)
    at org.eclipse.jdt.internal.ui.text.java.hover.BestMatchHover.getHoverInfo2(BestMatchHover.java:129)
    at org.eclipse.jdt.internal.ui.text.java.hover.JavaEditorTextHoverProxy.getHoverInfo2(JavaEditorTextHoverProxy.java:82)
    at org.eclipse.jface.text.TextViewerHoverManager$4.run(TextViewerHoverManager.java:166) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T10:55:53.393

DiskIndex.java 是否可能没有行信息？我的猜测是，您正在尝试获取完全不同的锁的方法中，但您看不到，因为堆栈跟踪中没有要显示的行信息。

# xcode - Ogre3d 本地引用字符串突然出现

> ID：336708
> 
> 赞同：1
> 
> 时间：2008-12-03T10:04:46.087
> 
> 标签：xcode, macos, ogre3d

我正在基于此设置 [http://www.ogre3d.org/wiki/index.php/SettingUpAnApplication#XCode构建一个 ogre3d 教程](http://www.ogre3d.org/wiki/index.php/SettingUpAnApplication#XCode)

我已按照它所说的所有步骤进行操作。它编译得很完美。

但是在运行时发生了这种情况：

```
*-*-* OGRE Initialising
*-*-* Version 1.6.0 (Shoggoth)
Creating resource group Bootstrap
An exception has occurred: OGRE EXCEPTION(7:InternalErrorException): /Users/fmsf/Chalmers/SimulationEngines/testes/OgreProject/build/Debug/OgreProject.app//Users/fmsf/Chalmers/SimulationEngines/ogr3d/OgreSDK/Samples/Media/packs/OgreCore.zip - error whilst opening archive: Unable to read zip file. in ZipArchive::checkZzipError at /Users/steve/projects/Shoggoth_clean/ogre/Mac/Ogre/../../OgreMain/src/OgreZip.cpp (line 259)
*-*-* OGRE Shutdown 
```

这`/Users/fmsf/...`是我的，但`/Users/steve/projects...`我不知道它来自哪里，因为我查看了配置文件并且在任何地方都找不到它。

任何人都知道如何解决这个问题？这是我第一次使用 ogre，所以我觉得有点失落。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T10:08:58.107

未知文件名可能只是检测错误的代码的编译部分；它指出了一个 C++ 源文件。根据[这个页面](http://www.ogre3d.org/index.php?option=com_content&task=view&id=12&Itemid=129)，Ogre3d 的主要开发者被命名为 Steve Streeting ...

检查存档，它是否可列出（带有`zip -v`）并且看起来很正常？如果是这样，它可能与 Ogre3D 的 zip-reading 代码之间存在某种版本冲突。

# mysql - 我的 MySQL 服务器是哪个版本？

> ID：336712
> 
> 赞同：9
> 
> 时间：2008-12-03T10:06:02.013
> 
> 标签：mysql

确定 MySQL 服务器软件的确切版本号的查询语法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-03T10:08:12.383

您可以使用[`SHOW VARIABLES`](http://dev.mysql.com/doc/refman/5.0/en/show-variables.html)：

`SHOW VARIABLES WHERE Variable_name = 'version';`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T11:10:45.330

选择版本（）；

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T11:40:45.613

命令行：

```
mysql --version 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-22T09:23:30.377

除了已经提到的解决方案之外，如果您`mysql`在 shell 中键入，您可以简单地查看版本。你会得到这样的东西：

```
[nikola@localhost]# mysql
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 386102
Server version: 5.1.61 Source distribution

Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement. 
```

在那里你可以看到版本是打印在行中的`Server version: 5.1.61 Source distribution`。

# java - 用Java读取串口

> ID：336714
> 
> 赞同：9
> 
> 时间：2008-12-03T10:06:40.170
> 
> 标签：java, serial-port

我是Java的初学者。我正在通过串行端口从设备读取数据。我每分钟获取一次数据，但是在数据正确出现之后，第一次读数将达到一半。

我得到的输出是：

> 6050.003120815340006050.003120815350006050.0

正确的输出应该是这样的：

> 03120815340006050.003120815350006050.0

我的代码是：

```
import java.io.*;
import java.util.*; //import gnu.io.*;
import javax.comm.*;

public class SimpleRead implements Runnable, SerialPortEventListener {
    static CommPortIdentifier portId;
    static Enumeration portList;

InputStream inputStream;
SerialPort serialPort;
Thread readThread;
byte[] readBuffer;

public static void main(String[] args) {
    portList = CommPortIdentifier.getPortIdentifiers();
    System.out.println("portList... " + portList);
    while (portList.hasMoreElements()) {
        portId = (CommPortIdentifier) portList.nextElement();
        if (portId.getPortType() == CommPortIdentifier.PORT_SERIAL) {
            System.out.println("port identified is Serial.. "
                    + portId.getPortType());
            if (portId.getName().equals("COM2")) {
                System.out.println("port identified is COM2.. "
                        + portId.getName());
                // if (portId.getName().equals("/dev/term/a")) {
                SimpleRead reader = new SimpleRead();
            } else {
                System.out.println("unable to open port");
            }
        }
    }
}

public SimpleRead() {
    try {
        System.out.println("In SimpleRead() contructor");
        serialPort = (SerialPort) portId.open("SimpleReadApp1111",500);
        System.out.println(" Serial Port.. " + serialPort);
    } catch (PortInUseException e) {
        System.out.println("Port in use Exception");
    }
    try {
        inputStream = serialPort.getInputStream();
        System.out.println(" Input Stream... " + inputStream);
    } catch (IOException e) {
        System.out.println("IO Exception");
    }
    try {
        serialPort.addEventListener(this);

    } catch (TooManyListenersException e) {
        System.out.println("Tooo many Listener exception");
    }
    serialPort.notifyOnDataAvailable(true);
    try {

        serialPort.setSerialPortParams(9600, SerialPort.DATABITS_8,
                SerialPort.STOPBITS_1, SerialPort.PARITY_NONE);

        // no handshaking or other flow control
        serialPort.setFlowControlMode(SerialPort.FLOWCONTROL_NONE);

        // timer on any read of the serial port
        serialPort.enableReceiveTimeout(500);

        System.out.println("................");

    } catch (UnsupportedCommOperationException e) {
        System.out.println("UnSupported comm operation");
    }
    readThread = new Thread(this);
    readThread.start();
}

public void run() {
    try {
        System.out.println("In run() function ");
        Thread.sleep(500);
        // System.out.println();
    } catch (InterruptedException e) {
        System.out.println("Interrupted Exception in run() method");
    }
}

public void serialEvent(SerialPortEvent event) {

    // System.out.println("In Serial Event function().. " + event +
    // event.getEventType());
    switch (event.getEventType()) {
    /*
     * case SerialPortEvent.BI: case SerialPortEvent.OE: case
     * SerialPortEvent.FE: case SerialPortEvent.PE: case SerialPortEvent.CD:
     * case SerialPortEvent.CTS: case SerialPortEvent.DSR: case
     * SerialPortEvent.RI: case SerialPortEvent.OUTPUT_BUFFER_EMPTY: break;
     */
    case SerialPortEvent.DATA_AVAILABLE:
        readBuffer = new byte[8];

        try {

            while (inputStream.available()>0) {

                int numBytes = inputStream.read(readBuffer);
            //   System.out.println("Number of bytes read " + numBytes);
            }

            System.out.print(new String(readBuffer));

        } catch (IOException e) {
            System.out.println("IO Exception in SerialEvent()");
        }
        break;
    }
    // System.out.println();
/*  String one = new String(readBuffer);
    char two = one.charAt(0);
    System.out.println("Character at three: " + two);*/
}

} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T11:09:56.830

使用以下内容：

```
while (inputStream.available()>0) {
  int numBytes = inputStream.read(readBuffer);
  System.out.print(new String(readBuffer));
} 
```

您正在从 while 循环中打印结果。但是循环内的代码可能会运行不止一次，因此会丢失大量数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T10:19:02.657

在读取之前尝试刷新端口的输入缓冲区。否则，如果发送端在程序启动期间（或之前，这可能取决于操作系统）发送了数据，您将获得旧的缓冲数据。

此外，如果可能，请考虑在协议中添加*消息框架*，以便您可以检测到您何时阅读了实际上不是完整消息的内容并将其丢弃。这通常对这类问题非常有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T10:17:50.117

这看起来好像您正在阅读在您开始之前发送的某些消息的其余部分。

尝试在启动程序时读取尽可能多的数据以清除任何硬件缓冲区。之后，开始您的处理。

# ruby-on-rails - 如何测试 Ruby on Rails 功能测试的 JSON 结果？

> ID：336716
> 
> 赞同：76
> 
> 时间：2008-12-03T10:07:30.763
> 
> 标签：ruby-on-rails, json, tdd

如何断言我的[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)请求并测试来自 Ruby on Rails 功能测试的 JSON 输出？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-12-28T06:15:33.147

## 在 Rails >= 5

使用[`ActionDispatch::TestResponse#parsed_body`](https://www.apidock.com/rails/v6.0.0/ActionDispatch/TestResponse/parsed_body).

例子：

```
user = @response.parsed_body
assert_equal "Mike", user['name'] 
```

## 在高达 4.x 的 Rails 中

使用`JSON.parse`，它将字符串作为输入并返回 JSON 表示的 Ruby 哈希。

例子：

```
user = JSON.parse(@response.body)
assert_equal "Mike", user['name'] 
```

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2010-08-20T20:12:18.943

Rails 内置了 JSON 支持：

```
def json_response
    ActiveSupport::JSON.decode @response.body
end 
```

不需要插件

然后你可以做这样的事情：

```
assert_equal "Mike", json_response['name'] 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-08-01T16:47:12.623

如果你使用 RSpec，**json_spec**值得一看

[https://github.com/collectiveidea/json_spec](https://github.com/collectiveidea/json_spec)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-03-20T01:22:27.350

同样对于简短的 JSON 响应，您可以简单地将 JSON 字符串与@response.body 匹配。这避免了不得不依赖另一个宝石。

```
assert_equal '{"total_votes":1}', @response.body 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-12-12T22:41:11.953

在较新版本的 rails 中，您`parsed_body`无需任何工作即可在测试中利用它来访问它。

> 对响应调用 parsed_body 会根据最后一个响应 MIME 类型解析响应正文。
> 
> 开箱即用，仅支持 :json。但是对于您注册的任何自定义 MIME 类型，您可以添加自己的编码器...

[https://api.rubyonrails.org/v5.2.1/classes/ActionDispatch/IntegrationTest.html](https://api.rubyonrails.org/v5.2.1/classes/ActionDispatch/IntegrationTest.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-04-26T07:03:03.240

没有一个答案提供了一种很好的可维护方式来验证 JSON 响应。我觉得这个是最好的：

[https://github.com/ruby-json-schema/json-schema](https://github.com/ruby-json-schema/json-schema)

[它为标准json 模式](http://json-schema.org/)提供了一个很好的实现

您可以编写如下架构：

```
schema = {
    "type"=>"object",
    "required" => ["a"],
    "properties" => {
        "a" => {
            "type" => "integer",
            "default" => 42
        },
        "b" => {
            "type" => "object",
            "properties" => {
                "x" => {
                    "type" => "integer"
                }
            }
        }
    }
} 
```

并像这样使用它：`JSON::Validator.validate(schema, { "a" => 5 })`

根据我的 android 客户端实现验证它的最佳方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-07-12T18:19:44.750

实际上，您可以隐式使用 JSON 模块：

```
assert_equal assigns(:user).to_json, @response.body 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-09-06T18:34:23.100

如前所述，您使用 JSON.parse 来测试 JSON，但执行该断言的位置取决于您如何呈现 JSON。

如果您在控制器中生成 JSON，则在控制器功能测试中解析 JSON（如其他答案所示）。如果您使用[Jbuilder](https://github.com/rails/jbuilder)、[rabl](https://github.com/nesquena/rabl)或其他采用这种方法的 gem 来渲染 JSON，则[在视图单元测试中解析 JSON 而](https://stackoverflow.com/a/25703425/1054831)不是控制器功能测试。单元测试通常执行得更快，更容易编写——例如，您可以在内存中构建模型，而不是在数据库中创建它们。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-01-14T15:17:22.877

您可以将[AssertJson gem](https://github.com/xing/assert_json "AssertJson 宝石")用于一个不错的 DSL，它允许您检查 JSON 响应中应该存在的键和值。

将宝石添加到您的`Gemfile`：

```
group :test do
  gem 'assert_json'
end 
```

这是一个简单的示例，您的功能/控制器测试可能是什么样子（该示例是对他们的[README](https://github.com/xing/assert_json/blob/master/README.md)的改编）：

```
class ExampleControllerTest < ActionController::TestCase
  include AssertJson

  def test_my_action
    get :my_action, :format => 'json'
    # => @response.body= '{"key":[{"inner_key":"value1"}]}'

    assert_json(@response.body) do
      has 'key' do
        has 'inner_key', 'value1'
      end
      has_not 'key_not_included'
    end
  end

end 
```

您只需将`AssertJson`模块包含在您的测试中，并使用`assert_json`可以检查响应中存在和不存在的键和值的块。提示：它在[README](https://github.com/xing/assert_json/blob/master/README.md)中不会立即可见，但要检查一个值（例如，如果您的操作只返回一个字符串数组），您可以这样做

```
 def test_my_action
    get :my_action, :format => 'json'
    # => @response.body= '["value1", "value2"]'

    assert_json(@response.body) do
      has 'value1'
      has 'value2'
      has_not 'value3'
    end
  end 
```

# c# - 从 ASP.NET 调试用户控件

> ID：336721
> 
> 赞同：0
> 
> 时间：2008-12-03T10:10:02.660
> 
> 标签：c#, asp.net, visual-studio, debugging, user-controls

我有一个 ASP.NET (2.0) 站点。我在使用 V Studio 2008 和 IIS 的开发盒上。我有一个单独的用户控件项目，它从 default.aspx 页面中的 javascript 函数中调用。用户控制项目在另一个解决方案中。

应用程序按预期运行。正在调用用户控件，一切都很好。不完全是。

**我无法进入用户控制项目，即调试它。**我可以设置断点，但它们永远不会被困住。我可以在脚本和代码后面调试站点的所有其他区域，没有任何问题。用户控件在 DEBUG 中构建到与 default.aspx 页面相同的位置。

我已经尝试过的事情：在 IE 中启用脚本调试。将用户控制项目添加到同一个网站解决方案 将调试器附加到从 Visual Studio 运行的 IE 实例 在站点上启用调试。在调试模式下构建用户控件并确保 pdb 在同一目录中

下面是一些应该有帮助的示例代码：

default.aspx：（为简洁起见减少）

函数 LoadMethod() { 尝试 { LoadControl.Ping();

```
 }
        catch (e) //if the DLL didn't run assume there is a trust problem.
        {    
        }
    } 
```

当我进入对 LoadControl.Ping 的调用时，调试器只会跳过这行代码。

请仅在您在实践中实际这样做的情况下提供反馈。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T10:36:00.970

*   将用户控件项目添加到要在其中进行调试的解决方案。
*   删除您对用户控件项目的引用
*   然后设置调用项目的引用，为本地用户控件项目

编辑：在第二步删除引用后，您可能还需要进行清理 - 然后检查您的 bin 是否没有用户控件 dll 的副本

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-11T10:18:13.783

这是一个古老的问题，但它仍然在谷歌上搜索，所以这里有一些可能会有所帮助的东西。 [这篇文章](http://weblogs.asp.net/ianrobinson/archive/2008/10/15/creating-dotnetnuke-modules-using-a-web-application-project-wap.aspx)讨论了 dotnetnuke 模块，但我认为这个概念就是您所说的 - 主 Web 项目和包含用户控件的辅助 Web 项目。

博客文章没有提到的事情：一旦您将项目设置为使用 IIS 而不是 webdevwebserver，并设置覆盖 URL，有时您必须做一些额外的事情才能使调试工作。右键单击项目 -> 调试 -> 启动新实例。这似乎是我可以可靠地调试我们的用户控件项目之一的唯一方法。请注意，那个特定的项目已经从 1.1 拖到了 3.5，所以它可能对其他一些事情不满意 :-)

# sql - 从 JUnit 运行 SQL 脚本

> ID：336724
> 
> 赞同：1
> 
> 时间：2008-12-03T10:12:28.613
> 
> 标签：sql, junit

在我正在处理的 JUnit 测试用例的设置方法中，我需要它在每个测试用例之前在我的数据库上运行一个 sql 脚本，然后在之后回滚。

我尝试使用分词器，它将每个 SQL 命令添加到一个批处理中，然后执行它们。但我无法工作。所以我的问题是，JUnit 中是否有一些标准方法可以执行此操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T10:14:53.337

你可以试试[DbUnit](http://dbunit.sourceforge.net/)

> DbUnit 是针对数据库驱动项目的 JUnit 扩展（也可与 Ant 一起使用），其中包括在测试运行之间将您的数据库置于已知状态。这是避免当一个测试用例损坏数据库并导致后续测试失败或加剧损坏时可能发生的无数问题的极好方法。
> 
> DbUnit 能够将您的数据库数据导出和导入 XML 数据集。从 2.0 版开始，当在流模式下使用时，DbUnit 也可以处理非常大的数据集。DbUnit 还可以帮助您验证您的数据库数据是否与预期的一组值匹配。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T07:49:09.747

测试 SQL 语句不是 JUnit 的任务。

您应该创建一个 Mocker（例如[EasyMock](http://easymock.org/)）并隔离连接。所以 mocker 可以模仿 sql 连接及其结果。使用这个模拟对象，您可以检查您的 sql 连接器类是否调用了正确的语句。

如果你想测试 SQL 语句，它的结果等等，你应该使用[DBUnit](http://www.dbunit.org)，正如 Aaron 所说。

# c# - 如何使用 C# 在 SQL Server 数据库中创建视图？

> ID：336731
> 
> 赞同：1
> 
> 时间：2008-12-03T10:16:25.517
> 
> 标签：c#, sql, sql-server, views

如何使用 C# 在 SQL Server 中动态创建视图？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T11:33:40.760

像这样的东西，显然你的连接代码会有所不同（更好）：

```
SqlConnection conn = null;
conn = new SqlConnection("yourConnectionString");
conn.Open();
string strSQLCommand = "CREATE VIEW vw_YourView AS SELECT YOurColumn FROM YourTable";
SqlCommand command = new SqlCommand(strSQLCommand, conn); 
string returnvalue = (string)command.ExecuteScalar(); 
conn.Close(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T10:19:48.133

您可以使用以下代码编写视图查询：

```
query = " Create View [Viewname] Select ...."; 
```

执行查询。

# python - Django FormWizard 和管理应用程序

> ID：336753
> 
> 赞同：3
> 
> 时间：2008-12-03T10:29:08.050
> 
> 标签：python, django, forms

我有一系列需要用户按顺序完成的表单，非常适合 formwizard 应用程序。但是，我也需要管理应用程序，并希望将整个设置设置为触发管理应用程序中的多个表单。

将“表单向导”集成到管理应用程序中是否可能/容易？

如果不是，扩展管理模板是一个可行的选择并手动连接其余部分吗？意见？

更新：我的“问题”有些清晰。

我想使用管理应用程序，因为我认为我只需要基本的模型表单 - 一个可能拆分为多个表单，这将是表单向导的角色。

是）我有的：

表格1：10个yes/no问题（每个yes对应一个需要填写的新表格）
如果勾选yes，则将相应的表格放入formwizard并显示给用户填写。

* * *

然而，建议的选项（模型形式 + 样式）可以解决我猜想的大部分问题 - 并且是看似更简单的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T16:27:26.580

您可以做很多*事情*，但您需要更具体地说明“将表单向导集成到管理应用程序”和“在管理应用程序中触发多个表单”的含义。

其核心的管理应用程序基本上只是一堆库存 ModelForms 的包装器，所以如果您只是使用 ModelForms 构建一个表单向导并在其上添加管理样式，那么您可能已经完成了 80% 的工作。

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2008-12-03T11:59:21.973

您*确实*有源代码，它*是*Python，所以...您可以阅读管理应用程序源代码以查看它有哪些选项。

查看 [http://docs.djangoproject.com/en/dev/ref/contrib/admin/#overriding-admin-templates](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#overriding-admin-templates)。
看来您可以轻松地覆盖模板。他们甚至提供了添加您自己的自定义管理模板的分步说明。

# c# - 从左到右的表达式求值

> ID：336755
> 
> 赞同：6
> 
> 时间：2008-12-03T10:29:20.797
> 
> 标签：c#, language-agnostic, compiler-construction, expression, expression-evaluation

在 C# 中，是否保证表达式从左到右进行评估？

例如：

```
myClass = GetClass();  
if (myClass == null || myClass.Property > 0)  
    continue; 
```

有没有不符合的语言？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-03T10:39:52.803

您实际上指的是一种称为“短路逻辑表达式”的语言功能：

这意味着：当一个逻辑表达式的结果不能再改变时，例如当很明显该表达式无论如何都会计算为“真”或“假”时，表达式的其余部分将不会被计算。

例如，C#、Java 或 JavaScript 可以做到这一点，您可以在这些语言中依赖它（回答您的问题）。

在您的情况下，如果 MyClass 不为空：

*   `MyClass == null`评估为假
*   因为它是一个“或”表达式，第二部分仍然可以改变结果，所以它被评估
*   `myClass.Property > 0`决定最终结果

如果 MyClass 为空：

*   `MyClass == null`评估为真
*   因为它是一个“或”表达式，所以后面的内容无关紧要
*   不再进行评估，最终结果为真

有些语言不会短路逻辑表达式。经典 VB 就是一个示例，如果 MyClass 为空（在 VB 中称为“Nothing”），此处将评估“myClass.Property > 0”并产生错误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-03T10:44:49.407

C# 3.0 规范的第 7.11 节描述了短路：

> 操作 x || y 对应于操作 x | y，除了只有当 x 不为真时才评估 y。

所以，是的，你很好。

至于其他语言——我从不喜欢代表*所有*语言。在 VB.NET 中，您可以使用短路的 OrElse 和 AndAlso，但普通的 Or 和 And 没有。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T10:45:14.290

不过要小心：

如果你有类似的东西

sprintf(buf, "%s %s", func1(&var), func2(&var));

对 var 有副作用，它没有定义（在 C 中，我不确定评估顺序是否在其他语言中定义），执行 func1() 和 func2() 的顺序（这取决于，以什么顺序（左或对）参数被放入堆栈并从那里评估。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T10:37:34.837

评估顺序取决于运算符，在这种情况下，布尔值或 ( `[||](http://msdn.microsoft.com/en-us/library/6373h346(VS.71).aspx)`) 被定义为通常称为[短路的](http://en.wikipedia.org/wiki/Short-circuit_evaluation)东西，以使这样的构造工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T10:46:09.263

我不确定，您真的对订单或短路评估感兴趣吗？

我不是 100% 确定，但据我所知，C# 中的评估顺序始终是相同的（我假设大多数（如果不是全部）.net 语言）。短路评估的工作原理如前面的答案中所述。

但是，在 C# 中，您可以选择不使用简单的运算符（用 & 代替 &&）进行短路。通常您想要短路，但也可能是您想要执行所有评估的情况。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T10:46:40.200

Ada、Visual Basic 和 Pascal 等语言中的和/或运算符不会短路。它们确实提供了额外的运算符来允许该功能，例如 Ada 中的“然后”和“否则”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T11:06:10.003

Python 有短路`or`和`and`运算符。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T11:13:00.100

在 Java 和 Haskell 中 && 和 || 短路也是如此。

有趣的是：在 Haskell 中，语言自然而然地出现了这一点（您可以定义自己的运算符来执行此操作），而在 Java 和 C# 中，它是*特定*于这两个运算符的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-04-13T05:27:23.367

实际上短路是一部分，但您还需要知道语言是否保证对它们进行从左到右的评估。例如 C (ANSI, ISO, C99) 不保证从左到右的评估。在示例代码中，可以在检查 NULL 之前检查 Property 的值，或者同时执行这两项操作……大多数编译器都没有，但是没有什么能阻止它这样做并完全符合规范。它甚至告诉你不要因此编写这样的代码。

# javascript - jquery .html 不适用于脚本

> ID：336756
> 
> 赞同：1
> 
> 时间：2008-12-03T10:29:48.347
> 
> 标签：javascript, jquery, dom

此代码根本不适用于 IE8。FF3 正在执行，但页面是空白的，并且似乎加载没有结束。

我的代码是：

```
$("#leaderBoard").html("<script2 language=\"javascript2\"> document.write('<scr'+'ipt language=\"javascript21.1\">alert(1)</scri'+'pt>'); </script2>".replace(/script2/gi, "script")); 
```

我想让页面加载广告准备就绪。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T14:40:06.967

这适用于我在 FF3 和 IE7 中：

```
$("#leaderBoard").html('<sc'+'ript language="javascript1.1">alert(1);</sc'+'ript>'); 
```

当您在页面加载后使用 document.write 时，它​​会替换整个文档 ( [http://javascript.about.com/library/blwrite.htm](http://javascript.about.com/library/blwrite.htm) )。您基本上用脚本标记替换了您的页面内容，导致它显示为空白。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T10:57:28.417

当您实际上已经拥有 jQuery 时，为什么还要这么麻烦呢？

只需将广告 HTML 加载到排行榜对象中，即可完成。

```
$(document).ready( function() {
  $("#leaderBoard").load("/ad_generator.php");
}); 
```

哪里`ad_generator.php`会根据一些随机化方案生成 HTML 片段。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T22:55:49.277

为什么不尝试使用 jQuery 的 $.getScript(); 功能？

[http://docs.jquery.com/Ajax/jQuery.getScript](http://docs.jquery.com/Ajax/jQuery.getScript)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-01T10:26:38.583

试试这个方法：

```
//////////////////function in page's script section

function aFunction (x) {

    ////script you want to execute

    alert(x);

}

//////////////////////in page's body

var d = $("<div />");
d.ready(function(){aFunction("x");}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T10:54:13.227

尝试将您的代码包装在

```
$(document).ready(function() {
 // your code here
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-12T12:05:37.743

```
document.write() 
```

不适用于 window.onload 事件

试试这个代码

```
 $('.myDiv').html('<script src="path\/to-add\/provider"><\/script>'); 
```

文档末尾附近的某处 *请注意*，您必须转义“/”字符

# c++ - 加载程序如何将 DLL 映射到进程地址空间

> ID：336759
> 
> 赞同：9
> 
> 时间：2008-12-03T10:30:39.513
> 
> 标签：c++, c, dll, loader

我很想知道加载程序如何将 DLL 映射到进程地址空间。loader 是如何做到这一点的。高度赞赏示例。

提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-06-16T17:08:01.980

好的，我在这里假设 Windows 方面的事情。加载 PE 文件时会发生什么，加载程序（包含在 NTDLL 中）将执行以下操作：

1.  使用 DLL 搜索语义（特定于系统和补丁级别）定位每个 DLL，众所周知的 DLL 可以免除此限制
2.  将文件映射到内存 (MMF)，其中页面是写时复制 (CoW)
3.  遍历导入目录并在第 1 点开始（递归地）每个导入。
4.  解决重定位问题，因为代码本身是位置无关代码 (PIC)
5.  (IIRC) 将 EAT 从 RVA（相对虚拟地址）修补到 VA（当前进程内存空间内的虚拟地址）
6.  修补 IAT（导入地址表）以使用进程内存空间中的实际地址引用导入
7.  对于 EXE 的 DLL 调用`DLLMain()`，创建一个其起始地址位于 PE 文件入口点的线程（这也过于简单，因为对于 Win32 进程，实际起始地址在 kernel32.dll 内）

现在，当您编译代码时，它取决于链接器如何引用外部函数。一些链接器创建存根，因此——理论上——尝试检查函数地址是否为 NULL 总是会说它不是 NULL。您必须注意链接器是否以及何时受到影响，这是一个怪癖。其他人直接引用 IAT 条目，在这种情况下，未引用的函数（认为延迟加载的 DLL）地址可以为 NULL，然后 SEH 处理程序将调用延迟加载帮助程序并（尝试）解析函数地址，然后在点它失败了。

上述过程涉及很多繁文缛节，我过于简化了。

**您想知道的要点是，到进程的映射以 MMF 的形式发生**，尽管您可以人为地模仿堆空间的行为。但是，如果您还记得关于 CoW 的观点，那就是 DLL 概念的关键所在。实际上（大部分）DLL 页面的*相同*副本将在加载特定 DLL 的进程之间共享。未共享的页面是我们写入的页面，例如在解决重定位和类似问题时。在这种情况下，每个进程都有一个 - 现在已修改 - 原始页面的副本。

以及关于 DLL 上的 EXE 加壳程序的警告。它们完全击败了我描述的这种 CoW 机制，因为它们在加载 DLL 的进程的堆上为 DLL 的解压缩内容分配空间。因此，虽然实际文件内容仍映射为 MMF 并共享，但解压后的内容对于每个加载 DLL 的进程占用相同数量的内存，而不是共享它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-03T12:07:53.780

您在寻找什么级别的详细信息？在基本层面上，所有动态链接器的工作方式几乎相同：

1.  动态库被编译为可重定位代码（例如，使用相对跳转而不是绝对跳转）。
2.  链接器在应用程序的内存映射中找到一个适当大小的空白空间，并将 DLL 的代码和任何静态数据读取到该空间中。
3.  动态库包含一个到每个导出函数开头的偏移量表，并且在加载时根据加载库的位置使用新的目标地址修补客户端程序中对 DLL 函数的调用。
4.  大多数动态链接器系统都有一些系统用于为特定库设置首选基地址。如果库在其首选地址加载，则可以跳过步骤 2 和 3 中的重定位。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T12:22:27.900

如果你真的感兴趣，你应该阅读[Linkers and Loaders](http://linker.iecc.com/)一书。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T11:50:04.487

假设这是在 Windows 中（DLL 提示），您可能需要阅读 Microsoft 的[运行时动态链接](http://msdn.microsoft.com/en-us/library/ms685090(VS.85).aspx)文档页面。它没有详细*说明*DLL 如何映射到地址空间；我想你不应该需要知道这一点。

# wpf - 通过拖动启用 ListView 多选

> ID：336760
> 
> 赞同：3
> 
> 时间：2008-12-03T10:31:25.957
> 
> 标签：wpf, xaml, listview, multi-select

如何通过拖动在 WPF ListView 中启用多选？

将 SelectionMode 属性设置为 Extended 确实允许使用 Shift 和 Ctrl 进行多选，但不能通过单击和拖动进行多选。将 SelectionMode 属性设置为 Multiple 会给出一个粘性选择，这不是我想要的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-07-18T05:34:17.390

您可以扩展`ListView`并`ListViewItem`实现单击和拖动多选行为。

[此处](https://stackoverflow.com/questions/6364029/drag-select-with-listbox/6728555#6728555)发布了一个非常相似的解决方案。

# asp.net-mvc - Request.Write - 在 Head 标签中执行。[动作 - 模板]

> ID：336768
> 
> 赞同：0
> 
> 时间：2008-12-03T10:36:21.983
> 
> 标签：asp.net-mvc

我使用 BaseUserControl，我有一个方法

```
private string typeName
{
    get { return GetType().FullName; }
}

private object headOne
{
    get { return Context.Items[typeName + "_Head"]; }
    set { Context.Items[typeName + "_Head"] = value; }
}

public void Head(Action template)
{
    if (headOne == null)
    {
        template();
        headOne = "exist";
    }
} 
```

我现在使用它，不复制一个用户控制部分。内部行动我有几个 Request.Write();

```
<% Head(() => { %>

<style>.css {}</style>

<% }); %> 
```

我感兴趣的是，在 Head 标签中执行这个请求很热。现在我没有找到任何方法，没有创建自定义视图引擎。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-03-07T15:37:37.773

也许只是使用 masterPages 来实现您的目的。但你也可以操纵`System.Web.UI.HtmlControls.HtmlHead` [Here is a sample](http://weblogs.asp.net/pscott/archive/2005/08/30/424039.aspx)

# c++ - 如何在被挂起时在 Windows Mobile 上运行代码？

> ID：336771
> 
> 赞同：2
> 
> 时间：2008-12-03T10:39:52.460
> 
> 标签：c++, windows-mobile, suspend

我想在 Windows Mobile PocketPC 正在（或似乎）被挂起时运行一些 C++ 代码。我的意思的一个例子是 HTC Home 插件，它显示（除其他外）一个选项卡，其中 HTC 音频管理器可用于播放 mp3 文件。当我按下开/关按钮时，显示屏变黑，但音频仍在播放。正如预期的那样，唯一可以重新打开的按钮是开/关按钮。

到目前为止，我尝试的是捕获硬件按钮按下（有效）并关闭视频显示（有效）。这种方法不起作用的是，当（意外地）按下设备上的任何键时，视频显示就会打开。我认为这不是 HTC 音频管理器中采用的方法。

我猜测一些低级 API 魔法可以让它工作，或者播放音频的代码在某个中断级别运行，或者设备进入不同的挂起模式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-27T19:52:17.103

我在[xda-developers 论坛](http://forum.xda-developers.com/archive/index.php/t-379366.html)上找到了解释要做什么的源代码，它的工作原理与想象的一样。要点是：

*   将设备设置为在进入“无人值守”模式时发送通知。这是用`PowerPolicyNotify(PPN_UNATTENDEDMODE, TRUE)`
*   对于无人值守模式下您需要的每台设备，请致电`SetPowerRequirement(L"gpd0:", D0, POWER_NAME|POWER_FORCE, NULL, NULL)`；“gpd0:”设备是 GPS 中间驱动程序；用您需要的任何设备替换或复制呼叫，例如“wav1:”用于音频，“dsk1:”用于存储卡或“com1:”用于串行端口 1。
*   使用创建消息队列并请求电源通知`RequestPowerNotifications(hMsgQueue, PBT_POWERINFOCHANGE | PBT_TRANSITION)`
*   每次发送电源通知时，消息队列都会填充一个 type 的结构体`POWER_BROADCAST`。
*   查找`PBT_TRANSITION`消息类型。`pPwrBrodcast->SystemPowerState`然后，当设备关闭时，该字段包含字符串“无人值守”，例如通过用户按下关闭按钮
*   在这个过渡中，只需打电话`SystemIdleTimerReset()`告诉设备不要关闭
*   当转换再次发生时重复
*   关机时，呼叫`PowerPolicyNotify()`离开无人看管模式，释放任何设备`ReleasePowerRequirement()`并停止接收电源通知`StopPowerNotifications()`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T11:01:08.533

首先看看这个[博客条目](http://blogs.msdn.com/windowsmobile/archive/2005/08/10/450186.aspx)，以了解各种电源状态。您基本上需要的是强制 ScreenOff 状态。看看 SetSystemPowerState 函数。

# usb - 从网络浏览器中检测和访问 USB 设备 - 即使用插件

> ID：336774
> 
> 赞同：9
> 
> 时间：2008-12-03T10:40:02.770
> 
> 标签：usb, webpage, detection

是否可以通过插件 - activeX、Java 或 Flex 编写能够检测从 USB 设备通道读取数据流的浏览器插件。

我做了一些研究，但没有找到答案。

[http://support.microsoft.com/kb/832678](http://support.microsoft.com/kb/832678) [http://www.vsj.co.uk/articles/display.asp?id=600](http://www.vsj.co.uk/articles/display.asp?id=600)

检测 USB 驱动器和他的名字 [http://bytes.com/groups/net-vb/379899-detect-usb-drive-his-name](http://bytes.com/groups/net-vb/379899-detect-usb-drive-his-name)

可以在嵌入式 Javascript 中利用 JAVA 来访问 USB 端口吗？ [http://p2p.wrox.com/topic.asp?whichpage=1&TOPIC_ID=70470䴈](http://p2p.wrox.com/topic.asp?whichpage=1&TOPIC_ID=70470&#150792) [http://www.sun.com/download/products.xml?id=43208d3d](http://www.sun.com/download/products.xml?id=43208d3d) [http://www.codeproject.com/ KB/cs/USB_HID.aspx?fid=398968&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=76&select=1993811](http://www.codeproject.com/KB/cs/USB_HID.aspx?fid=398968&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=76&select=1993811) [http://www.icaste.com/jcommusb.htm](http://www.icaste.com/jcommusb.htm)

在 C# 程序中检测 USB 驱动器移除 [http://www.codeproject.com/KB/system/DriveDetector.aspx](http://www.codeproject.com/KB/system/DriveDetector.aspx)

[http://www.dotnet247.com/247referenc...32/164968.aspx](http://www.dotnet247.com/247referenc...32/164968.aspx) [http://www.daniweb.com/forums/thread91049.html](http://www.daniweb.com/forums/thread91049.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T00:55:46.317

暴露本地资源被认为是一种安全风险，不同插件的沙箱环境应该拒绝访问这些资源。

所以我会说你的问题的答案是否定的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T03:22:03.117

我相信它至少可以用 Flash 完成。我使用的是 USB 园艺诊断设备 EasyBloom。他们网站上的 flash 应用程序可以访问我本地笔记本电脑上的设备。

可悲的是，我不知道他们是如何做到的，因为我不做 Flash。:-(

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T17:25:00.760

Flash可以做到。您的用户应该首先允许它。检查此链接： [安全性 Flash 文档](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/system/Security.html)

# c# - C# 中的管道转发

> ID：336775
> 
> 赞同：30
> 
> 时间：2008-12-03T10:41:07.247
> 
> 标签：c#, f#, functional-programming

继续[我](https://stackoverflow.com/questions/308481/writing-the-f-recursive-folder-visitor-in-c-seq-vs-ienumerable)在 C# 中表达 F# 想法的调查，我想要一个管道转发运算符。对于包含在 IEnumerable 中的任何内容，我们已经拥有它，您可以随意使用 .NextFunc()。但是，例如，如果最后有任何类似折叠的缩减，则不能将其结果输入到函数中。

这里有两种扩展方法，我想知道是否有其他人尝试过，以及这是否是个好主意（编辑：现在包含[Earwicker 的 Maybe](http://#337846)）：

```
public static void Pipe<T>(this T val, Action<T> action) where T : class
{ if (val!=null) action(val); }

public static R Pipe<T, R>(this T val, Func<T, R> func) where T : class where R : class
{ return val!=null?func(val):null; } 
```

然后，您可以编写如下内容：

```
Func<string, string[]> readlines = (f) => File.ReadAllLines(f);
Action<string, string> writefile = (f, s) => File.WriteAllText(f, s);

Action<string, string> RemoveLinesContaining = (file, text) =>
    {
        file.Pipe(readlines)
            .Filter(s => !s.Contains(text))
            .Fold((val, sb) => sb.AppendLine(val), new StringBuilder())
            .Pipe((o) => o.ToString())
            .Pipe((s) => writefile(file, s));
    }; 
```

（我知道，Filter == C# 中的 Where 和 Fold==Aggregate，但我想自己动手，我本可以完成 WriteAllLines，但这不是重点）

编辑：根据 Earwicker 的评论进行更正（如果我理解正确的话）。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-03T16:48:16.960

我没有打扰原始管道，但我尝试将所有引用都放入 Maybe monad：

```
public static class ReferenceExtensions
{
    public static TOut IfNotNull<TIn, TOut>(this TIn v, Func<TIn, TOut> f)
                                    where TIn : class 
                                    where TOut: class
    {
        if (v == null)
            return null;

        return f(v);
    }
} 
```

然后假设您有一个对象模型，可以让您按名称查找 RecordCompany，然后在该 RecordCompany 中查找 Band 成员，其中任何一个都可能返回 null，因此这可能会引发 NullReferenceException：

```
var pixiesDrummer = Music.GetCompany("4ad.com")
                         .GetBand("Pixes")
                         .GetMember("David"); 
```

我们可以解决这个问题：

```
var pixiesDrummer = Music.GetCompany("4ad.com")
                         .IfNotNull(rc => rc.GetBand("Pixes"))
                         .IfNotNull(band => band.GetMember("David")); 
```

嘿 presto，如果这些转换中的任何一个返回 null，pixiesDrummer 将为 null。

如果我们可以做操作符重载的扩展方法不是很好吗？

```
public static TOut operator| <TIn, TOut>(TIn v, Func<TIn, TOut> f) 
```

然后我可以像这样将我的转换 lambdas 管道在一起：

```
var pixiesDrummer = Music.GetCompany("4ad.com")     
                     | rc => rc.GetBand("Pixes")
                     | band => band.GetMember("David"); 
```

如果 System.Void 被定义为一种类型并且 Action 真的只是 Func<..., Void>，那不是很好吗？

**更新：** [我在博客上写了一些关于这背后的理论](http://incrediblejourneysintotheknown.blogspot.com/2008/12/maybe-monad-in-c.html)。

**更新 2：**原始问题的替代答案，大致是“您将如何在 C# 中表达 F# 管道转发运算符？”

管道转发是：

```
let (|>) x f = f x 
```

换句话说，它允许您以相反的顺序编写函数及其第一个参数：参数后跟函数。它只是一个有助于提高可读性的句法助手，允许您在任何函数中使用中缀表示法。

这正是 C# 中的扩展方法。没有它们，我们将不得不写：

```
var n = Enumerable.Select(numbers, m => m * 2); 
```

有了它们，我们可以写：

```
var n = numbers.Select(m => m * 2); 
```

（忽略他们还让我们省略类名的事实——这是一个好处，但也可以像在 Java 中一样用于非扩展方法）。

所以 C# 已经以不同的方式解决了同样的问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-08-14T19:04:57.060

因此，对于管道，我认为不希望检查 null 并且不调用管道函数。在许多情况下，函数参数可以很容易地取一个空值并由函数处理。

这是我的实现。我有`Pipe`和`PipeR`。预先警告，`PipeR`不是正确的管道，但仅适用于目标位于相反位置的情况下进行柯里化，因为交替重载允许有限的参数虚假柯里化。

假柯里化的好处是，您可以在提供参数后通过管道输入方法名称，从而产生比使用 ​​lambda 更少的嵌套。

```
new [] { "Joe", "Jane", "Janet" }.Pipe(", ", String.Join) 
```

String.Join 在最后一个位置有 IEnumerable，所以这行得通。

```
"One car red car blue Car".PipeR(@"(\w+)\s+(car)",RegexOptions.IgnoreCase, Regex.IsMatch) 
```

`Regex.IsMatch`目标位于第一个位置，因此`PipeR`有效。

这是我的示例实现：

```
public static TR Pipe<T,TR>(this T target, Func<T, TR> func)
{
    return func(target);
}

public static TR Pipe<T,T1, TR>(this T target, T1 arg1, Func<T1, T, TR> func)
{
    return func(arg1, target);
}

public static TR Pipe<T, T1, T2, TR>(this T target, T1 arg1, T2 arg2, Func<T1, T2, T, TR> func)
{
    return func(arg1, arg2, target);
}

public static TR PipeR<T, T1, TR>(this T target, T1 arg1, Func<T, T1, TR> func)
{
    return func(target, arg1);
}

public static TR PipeR<T, T1, T2, TR>(this T target, T1 arg1, T2 arg2, Func<T, T1, T2, TR> func)
{
    return func(target, arg1, arg2);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T10:53:56.877

虽然这不是一回事，但您可能对我的[Push LINQ](http://msmvps.com/blogs/jon_skeet/archive/2008/01/04/quot-push-quot-linq-revisited-next-attempt-at-an-explanation.aspx)框架感兴趣。基本上，在`IEnumerable<T>`需要相关方从源中提取数据的情况下，Push LINQ 允许您*通过*源推送数据，并且相关方可以订阅与“另一个元素刚刚过去”和“数据已完成”相对应的事件。

Marc Gravell 和我已经实现了大多数标准的 LINQ 查询运算符，这意味着您可以针对数据源编写查询表达式并做一些有趣的事情，例如流式分组、多重聚合等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-09T12:47:24.860

您的 Pipe 方法看起来很像 Thrush Combinator。[我的实现](http://alicebobandmallory.com/articles/2009/10/06/the-thrush-combinator-in-c)非常简单。

```
public static T Into<T>(this T obj, Func<T, T> f)
{ return f(obj); } 
```

# installshield - InstallShield 2009 - SdLogonUserInformation 问题（列表为空。）

> ID：336776
> 
> 赞同：0
> 
> 时间：2008-12-03T10:42:13.627
> 
> 标签：installshield

我需要使用 InstallShield 2009 创建的设置来安装 Windows 服务。该服务需要一个自己的帐户才能运行。需要从设置中创建/选择此帐户。

为此，我添加了相应的登录信息面板对话框：对话框 -> 所有对话框 ->*右键单击*​​ -> 新建对话框...

在新建对话框向导上： *下一步*-> 登录信息面板和关联的子对话框 ->*下一步*->*完成*

但是，当我开始设置并尝试浏览现有用户时，无论我尝试浏览域、用户还是其他任何内容都没有关系，我总是会收到一个消息框

“**列表为空**。”。

详细说明：

*   在登录信息对话框中，我单击*浏览*
*   在 Browse for a user account 对话框中，我单击*browse* for domain or server -> Result: **The list is empty**。

*   在 Browse for a user account 对话框中，我在 Name of server 文本框中输入我所在的服务器的名称，然后单击*浏览*用户名 --> Result: **Server not found**

*   在 Browse for a user account 对话框中，我在 User name 文本框中输入 Administrator，同时在 Name of server 文本框中输入服务器名称，然后单击*OK* --> Result: " **Server not found** "

*   单击*取消*后（返回登录信息对话框），我在用户名文本框中输入 SERVERNAME\Administrator，在密码文本框中输入相应的密码，然后单击*下一步*--> 结果：**找不到服务器**

*   我点击*新信息*

*   我单击*Browse* for the Domain or Server --> Result: **The list is empty**。

*   我单击*浏览*组 - >结果：**找不到服务器**

我该如何解决？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T10:13:09.600

有很多人对这些对话框有问题，Acresso 未能为此提供支持几乎是荒谬的。

然而，解决方案很简单：为了浏览任何东西，比如组或用户，ISNetApi 需要服务器名。要验证或浏览服务器名称，它需要 ComputerBrowser 服务。

猜猜看……默认情况下，Windows Server 2008 上的 ComputerBrowser 服务被禁用（在其他操作系统版本上也是如此）。

如果您真的想启用它，您还需要从网络和共享中心启用打印机和文件共享（因为 ComputerBrowser 服务依赖于它们）。

# c# - 如何从 C# 读取中文文本文件？

> ID：336781
> 
> 赞同：4
> 
> 时间：2008-12-03T10:43:14.573
> 
> 标签：c#, text-files

如何使用 C# 读取中文文本文件，我当前的代码无法显示正确的字符：

```
try
{    
    using (StreamReader sr = new StreamReader(path,System.Text.Encoding.UTF8))
    {
        // This is an arbitrary size for this example.
        string c = null;

        while (sr.Peek() >= 0)
        {
            c = null;
            c = sr.ReadLine();
            Console.WriteLine(c);
        }
    }
}
catch (Exception e)
{
    Console.WriteLine("The process failed: {0}", e.ToString());
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-03T10:48:00.417

您需要为文件使用正确的编码。你知道那个编码是什么吗？它可能是 UTF-16，又名 Encoding.Unicode，或者可能是 Big5 之类的东西。确实，您应该尝试确定而不是猜测。

正如 leppie 的回答所提到的，问题也可能是控制台的功能。为了确定，将字符串的 Unicode 字符值转储为数字。有关更多信息和转储字符串内容的有用方法，请参阅我[关于调试 unicode 问题的文章。](http://www.yoda.arachsys.com/csharp/debuggingunicode.html)

我还将避免使用您当前用于逐行读取文件的代码。相反，使用类似的东西：

```
using (StreamReader sr = new StreamReader(path, appropriateEncoding))
{
    string line;
    while ( (line = sr.ReadLine()) != null)
    {
        // ...
    }
} 
```

调用 Peek() 要求流能够搜索，这可能适用于文件但并非所有流。如果您想要这样做，还请查看[File.ReadAllText](http://msdn.microsoft.com/en-us/library/system.io.file.readalltext.aspx)和[File.ReadAllLines - 它们是非常方便的实用程序方法。](http://msdn.microsoft.com/en-us/library/system.io.file.readalllines.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-08-22T16:18:39.427

如果是简体中文通常是 gb2312，对于繁体中文通常是 Big5：

```
// gb2312 (codepage 936) :
System.Text.Encoding.GetEncoding(936)

// Big5 (codepage 950) :
System.Text.Encoding.GetEncoding(950)
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T10:44:32.997

~~改为使用`Encoding.Unicode`。~~

我认为您需要更改控制台的 OutputEncoding 才能正确显示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-06-12T09:35:28.773

我刚遇到和你一样的问题，现在解决了。我认为主要问题来自 txt 编辑器。当您使用记事本将文本保存为 .txt 格式时，您可以选择底部的编码。默认编码是 ANSI，不支持中文流读取（取决于您的计算机），而 Unicode 适用于中文文本。我希望这能帮到您 ：）

干杯，

罗纳德

# .net - 嵌入 PowerBuilder 时的 COM 控制颜色（颜色）错误/问题

> ID：336799
> 
> 赞同：0
> 
> 时间：2008-12-03T10:48:34.597
> 
> 标签：.net, com, controls, powerbuilder

我们已经构建了一些 .NET 控件，并将它们用作[PowerBuilder](http://en.wikipedia.org/wiki/PowerBuilder)应用程序中的 COM 控件。

它们（大部分）由带有其他控件的控件、我们的其他一些自定义控件、一些来自 DevExpress 的控件组成。我们所有人都继承自一个共同的基础 - 这具有 DevExpress LookAndFeel 控件，以确保我们可以在需要时轻松更改整个应用程序的外观和感觉（我们必须这样做两次！ ）。

所有控件的背景色都设置为系统颜色“控件”，并且当控件嵌入到我们的 .NET 测试表单中时，会以这种颜色正确呈现（Windows 2000 默认为灰色）。

当控件嵌入到 PowerBuilder 中时，它们的渲染不正确，背景颜色显示为白色。

这是 PowerBuilder 错误吗？如果是这样，解决方案是什么？如果不是，我们需要做些什么来纠正这种情况？（同时保持让所有控件与方案匹配的能力，而无需单独设置每个控件的 BackColour）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-18T11:32:42.877

最后，我们将所有控件的 BackColor 设置为“ButtonFace” - 不优雅，但它有效。

通常也不是使用 DefaultLookAndFeel 控件的方法，因为存在各种错误

请参阅： http: [//www.devexpress.com/Support/Center/p/B132331.aspx](http://www.devexpress.com/Support/Center/p/B132331.aspx) [http://www.devexpress.com/Support/Center/KB/p/K18013.aspx](http://www.devexpress.com/Support/Center/KB/p/K18013.aspx)

# c++ - Symbian C++ 的内存管理实践和工具

> ID：336801
> 
> 赞同：2
> 
> 时间：2008-12-03T10:49:24.063
> 
> 标签：c++, memory-management, symbian, s60

我已经差不多完成了我的第一个 Symbian 应用程序，但是在我匆忙的学习中，很少关注内存管理以及推送和清理堆栈？

有人可以向我指出一些在这里使用的最佳实践的方向，也许还有一些最好的泄漏检测/内存分析工具。

例如，如果我在一个函数中抓取一个 TDesC 或 TPtrC16，那么我该如何清理它们是最好的方法，是不是很简单

```
TPtrC16 temp = ...
temp.CleanupClosePushL();
CleanupStack::PopAndDestroy() 
```

..一切？

谢谢，请原谅我，我是一个自认的塞班 n00b。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T19:40:29.013

我过去曾使用[Symbian 的 HookLogger](http://www.newlc.com/Hooklogger-Tracking-leaked-heap.html)来跟踪和调查内存泄漏。这不是最好的，但它确实有帮助。此外，每当您退出应用程序时，堆标记会在内存泄漏的情况下引发 ALLOC 恐慌。这些恐慌提供的信息几乎没有帮助，但它很好地表明某处存在内存泄漏。从那里，您可以使用诸如 HookLogger 之类的工具来缩小泄漏被引入的代码部分。

I mentioned a few Symbian resources [in reply to this thread](https://stackoverflow.com/questions/200441/startup-point-for-symbianembedded-programming-learning#330815). While all those have been most useful for me, I did find the book [Accredited Symbian Developer Primer](http://www.amazon.co.uk/Accredited-Symbian-Developer-Primer-Fundamentals/dp/0470058277) immensely helpful. If you could get your hands on it, I would definitely recommend it. It is a quick read, but it explains the concepts brilliantly, including things about memory management and descriptors.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T11:06:31.813

存储在堆栈中的东西不需要存储在清理堆栈中（除非它们需要特殊处理（R 类等，见下文））

清理堆栈用于在发生离开（认为异常）时删除对象，否则会泄漏内存。

清理堆栈的实际使用是通过静态函数 CleanupStack::PushL(..) 和 CleanupStack::Pop / PopAndDestroy。

一些类，如 RFile，RFs 必须关闭而不是删除，因此对于这些函数，它们的 ::Close 函数被调用，因此您应该使用全局函数 CleanupClosePushL()，而不是在离开时调用对象上的删除运算符，它改为调用类的 ::Close 函数。

要检查代码是否存在内存泄漏，可以使用宏 __UHEAP_MARK; 和 __UHEAP_MARKEND；这将验证这两个调用之间没有任何东西留在堆上。

如果您在 CActive 的::RunL 中的 cleanupstack 上留下任何内容，则活动调度程序将恐慌。

作为一种通用技术，如果您正在调用的函数*可能会*离开（用尾随的“L”表示），那么任何必须删除或关闭（等）的东西都应该添加到清理堆栈中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T14:30:21.277

它需要不到 10 页的篇幅来正确解释您需要了解的有关 Symbian C++ 的 CleanupStack 和内存管理的所有信息。

无耻插件：这本书是专门为你的n00bness水平写的： [http ://www.quickrecipesonsymbianos.com](http://www.quickrecipesonsymbianos.com)

# asp.net - ASP.NET 根据配置以编程方式定义输入验证器

> ID：336804
> 
> 赞同：1
> 
> 时间：2008-12-03T10:52:23.153
> 
> 标签：asp.net, validation

我正在编写一个 ASP.NET 3.5 Web 应用程序。有一个相当**复杂的输入表单**（30 个输入控件 - 文本框、下拉列表...）。

现在，不同的客户在他们的定制应用程序中使用相同的表格，并且某些客户有**不同的必填字段**。

现在，我想**根据配置设置以编程方式创建/激活某些验证器**，例如（我在这里简化）：

```
ControlsToValidateRequiredFields="NameTextBox,AddressTextBox,EmailTextBox" 
```

也许对于第二个客户：

```
ControlsToValidateRequiredFields="NameTextBox,PhoneTextBox" 
```

是否有 ASP.NET 内置方式（或第 3 方控件）来做到这一点？我想避免在页面上定义所有验证器并禁用它们。我可以动态创建验证器并将其附加到现有控件吗？

*注意：我想在客户端进行验证。顺便说一句：我正在使用 ASP.NET Ajax ControlToolkit 的 ValidatorCalloutExtender——但这不是必须的。是的，基于 jQuery 的解决方案就可以了。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T12:58:18.407

PeterBlum.com，这就是关于 3rd 方验证套件的全部内容。功能齐全的客户端和服务器端 api，

# java - ODBC 到 JDBC 数据类型的映射

> ID：336806
> 
> 赞同：2
> 
> 时间：2008-12-03T10:53:58.093
> 
> 标签：java, jdbc, odbc, types

在哪里可以找到有关如何将 ODBC 数据类型映射到 JDBC 的说明？或者也许有人知道哪里可以下载 jdbc-odbc 桥驱动程序的源代码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T12:07:47.167

JDBC-ODBC 桥与 Java 2 SDK 标准版捆绑在一起......

查看 Sun 的常见问题解答 - [http://java.sun.com/products/jdbc/faq.html](http://java.sun.com/products/jdbc/faq.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-06T16:22:51.313

根据[维基百科](http://en.wikipedia.org/wiki/JDBC_driver)，

> Sun 提供了一个 JDBC-ODBC 桥驱动程序。sun.jdbc.odbc.JdbcOdbcDriver。此驱动程序是本机代码而不是 Java，并且是封闭源代码。

但是我已经下载了源码（jdk-6u3-fcs-src-b05-jrl-24_sep_2007.jar），驱动的源码真的在那里：j2se\src\share\classes\sun\jdbc\odbc\JdbcOdbcDriver.java

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-23T13:46:31.567

我偶然发现了 JDBC 到数据库列类型映射的这个页面： [Mapping SQL and Java Types](http://java.sun.com/j2se/1.3/docs/guide/jdbc/getstart/mapping.html#table1)。

但是，我确实注意到该表并未显示 JDBC CLOB 将与 Access 的备注列一起使用。

# asp.net - Server.Transfer 与 Context.RewritePath

> ID：336813
> 
> 赞同：14
> 
> 时间：2008-12-03T10:57:40.897
> 
> 标签：asp.net, url-rewriting

我知道他们都不会更改客户看到的 URL。它们中有什么东西使它们中的一个比另一个更受欢迎吗？
我打算在 Global.asax 的 Application_BeginRequest 中使用它，但也可以在常规的 aspx 页面中使用它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T11:03:10.090

我认为`Context.RewritePath()`是更好的选择。原因：

`Server.Transfer()``ThreadAbortException`每次抛出一个。调用的结果`Response.End()`。

有关更多详细信息，请阅读以下 MS 文章：

*   [如果使用 Response.End、Response.Redirect 或 Server.Transfer，则会发生 ThreadAbortException](http://support.microsoft.com/kb/312629)
*   [MSDN 上的 HttpServerUtility.Transfer 方法](http://msdn.microsoft.com/en-us/library/aa332847.aspx)

**更多信息：**
`Server.Transfer()`不发送 HTTP 302 重定向命令`Response.Redirect()`。

根据[MSDN 上的 HttpContext.RewritePath](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.rewritepath%28VS.71%29.aspx)，`RewritePath()`用于无 cookie 会话状态。

此外，在不同的主题上，`Server.Transfer()`并且`Server.Execute()`非常不同：

`Server.Execute()`在调用它之后立即将控制返回到初始页面。

例如：

```
<div>
    test 1 <br/>
    <% Server.Execute("include.aspx?hello=ok"); %>
    test 2 <br/>
</div> 
```

会输出：

> 测试 1
> *include.aspx?hello=ok*
> 测试 2的内容

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T11:07:36.617

Context.RewritePath 分配内部重写路径并允许请求的 URL 与资源的内部路径不同。RewritePath 用于无 cookie 会话状态。

而 Server.transfer 将为处理一个页面而组装的内容传输到另一个页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T11:18:23.973

为了避免 Server.Transfer 抛出的异常，可以使用 Server.Execute。Server.Transfer 和 Server.Execute 都不会发出 302 HTTP 消息。只有 Response.Redirect 发出此标头并要求浏览器转到新目的地，并声称它已被临时移动。Server.Transfer 和 Server.Execute 都允许您执行不同的页面来服务当前请求。

# c - 为什么是#include 不需要使用 printf()？

> ID：336814
> 
> 赞同：32
> 
> 时间：2008-12-03T10:57:50.303
> 
> 标签：c, include, printf, declaration

会议记录：

```
> type lookma.c
int main() {
  printf("%s", "no stdio.h");
}

> cl lookma.c
Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 14.00.50727.762 for 80x86
Copyright (C) Microsoft Corporation.  All rights reserved.

lookma.c
Microsoft (R) Incremental Linker Version 8.00.50727.762
Copyright (C) Microsoft Corporation.  All rights reserved.

/out:lookma.exe
lookma.obj

> lookma
no stdio.h 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-03T11:01:25.693

您最初标记了这个 C++，但它似乎是一个 C 程序。如果范围内没有原型（例如由于省略#include <stdio.h>），C 将自动为函数提供隐式声明。隐式声明将是：

```
int printf(); 
```

这意味着 printf 是一个返回 int 并且可以接受任意数量的参数的函数。这个原型碰巧适合你的电话。你应该#include <stdio.h>

最后，我应该补充一点，当前的 C 标准（ISO/IEC 9899:1999 或通俗地称为“C99”）**不允许**隐式声明，并且该程序不符合。隐式声明被删除。我相信你的编译器不支持 C99。C++ 还需要正确的原型并且不进行隐式声明。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-12-04T20:37:13.847

在严格合规模式下（这意味着“理论上”），当您调用一个函数时调用未定义的行为（这很糟糕），该函数在范围内没有函数的原型声明，而该函数采用可变数量的参数。这意味着编译器可以对`printf()`没有原型 from`#include <stdio.h>`或等效声明的程序做任何它喜欢的事情。“任何喜欢的东西”包括作为选项之一正常工作；这似乎是您的示例选择的选项。

在实践中，即使没有函数的正式声明，代码也可以在大多数实用编译器中`printf()`正常工作。

正如 qrdl 所指出的，找到该函数是因为 C 编译器与 C 库链接。

请注意，Chris Young 关于 C99 和“隐式 int”的评论是准确的，但关于“变量参数函数必须在范围内具有原型”的规则适用于 C89 和 C99。大多数编译器在默认情况下不能在严格的 C99 兼容模式下工作，因为有太多的代码不会像那样编译。

克里斯·杨评论道：

> 为了澄清，我的评论是关于 C99 删除隐式声明。通过说“隐式 int”，我认为您指的是允许诸如 foo(void); 之类的声明的 C89 功能；表示 int foo(void);，C99 也删除了一些东西。

克里斯当然是正确的。从 C99 标准中删除了两个“隐式声明”功能。该标准的前言将它们列为：

*   删除隐式`int`
*   删除隐式函数声明

我没有足够清楚地思考（因此没有写作）。尽管如此，C89 和 C99 都需要在函数范围内有一个原型，用于接受可变数量参数的函数。

为了显示：

```
extern int pqr();
int main(void)
{
    int i = pqr(1, 3);
    return i;
} 
```

如果没有第一行，这是一个正确的 C89 片段，其中将函数隐式声明为`pqr()`返回整数（带有未指定参数）的函数。如果第一行替换为`extern pqr();`，则这是一个正确的 C89 片段，其中显式声明`pqr()`为返回整数（带有未指定参数）的函数，但返回类型为“隐式`int`”。如所写，该函数被显式声明并具有显式`int`返回类型 - 但它仍然具有未指定的参数。我相信这是有效的 C99 - 尽管不是完全可取的。当然，GCC (3.4.4) 接受它并带有选项 ' `-std=c99 -pedantic`"。理想情况下，函数声明应该包括完整的原型。（并且，如果`pqr()`用省略号定义，*理论上*需要该原型！）

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-03T11:16:45.613

`printf()`位于标准 C 库中，链接器始终将标准库链接到您的可执行文件，因此将找到任何标准函数并且不会出现链接问题。

未能包含适当的标头会导致使用未原型化的函数，这可能会导致问题，因为 C 编译器假定没有原型的函数返回`int`并采用可变数量的参数。所以总是包括标题 - 这是你的安全围栏。

# c# - 如何检测用户控件是否在 IDE、调试模式或已发布的 EXE 中运行？

> ID：336817
> 
> 赞同：8
> 
> 时间：2008-12-03T10:59:15.853
> 
> 标签：c#, ide, user-controls

我有一个正在构建的用户控件。它的目的是向用户显示类的状态。显然，这无关紧要，并且当控件在 IDE 中运行时会减慢速度，就像将它添加到表单时一样。

解决此问题的一种方法是在运行时创建控件并将其添加到窗体的控件集合中。但这似乎并不完美。

有没有办法在控件中设置一个标志，以便它可以根据它的运行方式跳过某些代码部分？

ps 我正在使用 C# 和 VS 2008

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-03T11:04:35.063

```
public static bool IsInRuntimeMode( IComponent component ) {
    bool ret = IsInDesignMode( component );
    return !ret;
}

public static bool IsInDesignMode( IComponent component ) {
    bool ret = false;
    if ( null != component ) {
        ISite site = component.Site;
        if ( null != site ) {
            ret = site.DesignMode;
        }
        else if ( component is System.Windows.Forms.Control ) {
            IComponent parent = ( (System.Windows.Forms.Control)component ).Parent;
            ret = IsInDesignMode( parent );
        }
    }

    return ret;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-03-22T14:02:15.090

我在另一篇文章中找到了这个答案，它似乎更容易并且更适合我的情况。

[从控件的构造函数中检测设计模式](https://stackoverflow.com/questions/1166226/detecting-design-mode-from-a-controls-constructor)

```
using System.ComponentModel;

if (LicenseManager.UsageMode == LicenseUsageMode.Runtime)
{
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-09-29T07:08:52.173

这是我在项目中使用的方法：

```
//use a Property or Field for keeping the info to avoid runtime computation
public static bool NotInDesignMode { get; } = IsNotInDesignMode();
private static bool IsNotInDesignMode()
{
    /*
    File.WriteAllLines(@"D:\1.log", new[]
    {
        LicenseManager.UsageMode.ToString(), //not always reliable, e.g. WPF app in Blend this will return RunTime
        Process.GetCurrentProcess().ProcessName, //filename without extension
        Process.GetCurrentProcess().MainModule.FileName, //full path
        Process.GetCurrentProcess().MainModule.ModuleName, //filename
        Assembly.GetEntryAssembly()?.Location, //null for WinForms app in VS IDE
        Assembly.GetEntryAssembly()?.ToString(), //null for WinForms app in VS IDE
        Assembly.GetExecutingAssembly().Location, //always return your project's output assembly info
        Assembly.GetExecutingAssembly().ToString(), //always return your project's output assembly info
    });
    //*/

    //LicenseManager.UsageMode will return RunTime if LicenseManager.context is not present.
    //So you can not return true by judging it's value is RunTime.
    if (LicenseUsageMode.Designtime == LicenseManager.UsageMode) return false;
    var procName = Process.GetCurrentProcess().ProcessName.ToLower();
    return "devenv" != procName //WinForms app in VS IDE
        && "xdesproc" != procName //WPF app in VS IDE/Blend
        && "blend" != procName //WinForms app in Blend
        //other IDE's process name if you detected by log from above
        ;
} 
```

**注意！！！：**返回的代码 bool 表示**不在**设计模式！

# sdk - ABBYY FineReader 引擎 API 资源

> ID：336822
> 
> 赞同：5
> 
> 时间：2008-12-03T11:00:27.427
> 
> 标签：sdk, finereader, abbyy

是否有人使用 ABBYY FineReader Engine 9.0 API？互联网上几乎没有可用的资源。唯一的事情是与它一起安装的开发人员参考帮助文件。但这还不够。

# sql-server - 有谁知道全文断词器中是否有德语单词列表？

> ID：336826
> 
> 赞同：2
> 
> 时间：2008-12-03T11:01:32.870
> 
> 标签：sql-server, full-text-search, wordbreaker

SQL Server 全文搜索使用特定语言的分词器。

对于德语，这用于打断/拆分单词，包括复合词。但是，似乎并非所有已知的复合词都包含在分词器中。我想知道 Word Breaker 确实知道的单词列表是否可用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T12:39:14.183

在 sql server 2008 中这有效......我放在这里的 language_id 是德语的。我想看同样的东西，但西班牙文。

```
SELECT * FROM sys.fulltext_system_stopwords
WHERE language_id = 1031 
```

编辑：在 sql server 2005 中，单词存储在此处“$SQL_Server_Install_Path\Microsoft SQL Server\MSSQL.1\MSSQL\FTDATA\”，如果编辑干扰词文件，则必须重新填充全文。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T08:28:47.643

答案是没有答案。根据微软的说法，这些词没有被存储——他们使用一个公式来“打破”它们。这永远不会 100% 准确，所以我只能接受这个事实。

# c# - 从主线程调用函数并使其与主线程中的函数并行工作

> ID：336831
> 
> 赞同：1
> 
> 时间：2008-12-03T11:05:42.737
> 
> 标签：c#

我真的非常需要你的帮助来解决我的问题，而且它与上一个问题太接近了。我想使用主线程中的线程调用一个函数。

更多解释，这里是我的代码示例：//请查看从（//-------）开始的代码

```
 // this function is being called from the Form1 class Like this 
    //(this.Load += new System.EventHandler(this.Form1_Load);)

    private void Form1_Load(object sender, EventArgs e)
    {
        Common.MainForm = this;

        ftpServerIP = "74.220.215.77/ASGAQuraan";
        ftpUserID = "sanbouk@asgatech.com";
        ftpPassword = "asga_root";

        iStartConnection = true;
        iGetNarratorData = false;
        iGetNarratorsSuras = false;
        _isExpandedIndecies = new string[10];

        refreshPhons = true;
        count = 0;
        _btnDownload2PC.Enabled = false;
        _btnDownload2Phone.Enabled = false;

        //--------------------------------------------------------------------------------------
        //timer1.Tick() is a function which Gets Data rom Phone
        //Now, GetFromServer, and GetFromPC are 2 functions which i want to them 
        // to work in paralel with Timer1.Tick()
        //So, Fincally i want all 3 function work together with no gabs

         Timer1.Enabled = true;
        Timer1.Start();
        if (InvokeRequired)
        {
            Invoke(new GetFromServerHandler(GetFromServer));
        }
        else
        {
            ServerQuranTreeView.Nodes.Clear();
            GetFromServer();
            GetFromPC();
        }
    } 
```

** 注意：在 GetFromServer 和 GetFromPC 中，我将更新主线程 Form1 (GUI) 中的树，当我尝试使用线程时（线程 _t = new Thread(new ThreadStart(GetFromServer))）出现此错误： " 正在从错误的线程调用对此控件执行的操作。使用 Control.Invoke 或 Control.BeginInvoke 编组到正确的线程以执行此操作。" **

我希望我能很好地解释我的问题。

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T11:11:34.767

您不能从不同的线程对 UI 进行操作 - 但您可以让 GetFromServer 和 GetFromPC在另一个线程上*获取*数据，然后调用 Control.Invoke 以返回 UI 线程以更新树视图。

请参阅[我的线程文章](http://pobox.com/~skeet/csharp/threads/winforms.shtml)，例如在另一个线程中进行后台工作，然后编组返回。这篇文章是在 C#2 之前写的，所以现在它稍微不那么笨重了。您还可以使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)来更轻松地报告进度等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T13:07:04.597

对于仅获取数据然后更新 GUI 并在下次有人调用它之前完成的任何单个操作，请使用 BackgroundWorker。

它是一个为您简化线程编码的类。这样，您只需在一个函数中编写用于获取数据的代码，然后使用一种方法来显示获取的数据。

然后只要要获取数据就调用它。

BackgroundWorker 非常适合任何 GUI 解决方案，您可以在其中单击在后台执行某些操作并随后更新某些内容的按钮。它还支持在获取数据时更新 GUI。

# jquery - 提交按钮上的 onclick 动画仅适用于 FF（不适用于 IE 或 OP）

> ID：336845
> 
> 赞同：0
> 
> 时间：2008-12-03T11:17:19.623
> 
> 标签：jquery, jquery-animate

有人知道为什么下面的代码只在 FF 中有效吗？

```
$(document).ready(function() {
    $('#powerSearchSubmitButton').click(function() {
        startLoad();
    });
});

function startLoad() {
    $('.message').each(function(i) {
        $(this).animate({ opacity: 0 }, 500);           
    });
}; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T22:49:44.687

尝试添加'return false;' 到您的点击功能。[我在我的网站上](http://www.sanchothefat.com/dev/sfhelp/ie-opera-not-running-jquery-animation.html)设置了一个演示，它在 IE6 和 Opera 中运行良好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T08:35:59.090

***更新****

此处示例[http://pastebin.me/4937b07714655](http://pastebin.me/4937b07714655) of 1 选项，即保留​​消息计数并仅在最后一条消息上运行动画回调。

* * *

为什么不从 click 或 event.preventDefault() 返回 false 并在动画回调中提交表单

```
$(document).ready(function() {
    $('#powerSearchSubmitButton').click(function(ev) {
        startLoad();
        ev.preventDefault();
    });
});

function startLoad() {
    var $messages=$('.message');
    var count=$messages.length -1;
    $messages.each(function(i) {
       $(this).animate({ opacity: 0 }, 500, i == count ? submitForm:null);           
    });
};

function submitForm(){
     $('#yourForm').submit();
} 
```

# winapi - Windows系统缓存和大文件

> ID：336849
> 
> 赞同：1
> 
> 时间：2008-12-03T11:19:13.300
> 
> 标签：winapi, filesystems

我的 Windows 系统缓存有问题。示例代码：

```
int main(int argc, char* argv[])
{
    HANDLE file_ = INVALID_HANDLE_VALUE;
    file_ = CreateFile(
                            "test_file.txt",
                            GENERIC_WRITE, 
                            FILE_SHARE_READ, 
                            0, 
                            OPEN_ALWAYS, 
                            FILE_FLAG_SEQUENTIAL_SCAN, 
                            NULL
                            );
    if (file_ == INVALID_HANDLE_VALUE || file_ == NULL)
    {
        std::cout << "CreateFile error " << GetLastError() << std::endl;
        return GetLastError();
    }
    int counter = 0;
    DWORD io_bytes = 0;
    while(true)
    {
        char buffer[0x1000];
        int len = _snprintf_s(buffer, 0x1000, 0xffff, "test message %d\r\n", counter);
        counter++;
        if ( !WriteFile(file_, buffer, len, &io_bytes, NULL) )
        {
            std::cout << "WriteFile error " << GetLastError() << std::endl;
            return GetLastError();
        }
        if (counter > 10000000)
        {
            system("pause");
            return 0;
        }
    }
} 
```

如果您运行此代码并查看系统缓存大小，一切都会好起来的。但是，如果您在该程序运行时打开此文件（test_file.txt）以在某些查看器中读取（例如，总指挥官的 lister 插件），您将看到系统缓存大小正在增长，即使您已经关闭查看器程序。这看起来像内存泄漏。这种行为正常吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T12:17:50.640

Windows 文件缓存将尝试在 RAM 中保留尽可能多的文件。在 Windows NT 中，加载一个非常大的文件可能会触发一个错误。如果文件不适合缓存，它将永远不会被释放，迫使其他所有内容从 RAM 中进入交换文件，直到您的机器不断交换。

但是你的情况更简单。在查看器中打开文件将加载缓存中的文件。由于您仍在编写它，因此缓存项将相应增长。现在您退出查看器，但您仍在写作。Windows应该怎么做？显然，它将文件保存在缓存中。

这不是内存泄漏，除非缓存永远不会缩小。它是否会缩小 a) 当您用完 RAM 或 b) 当您在写入过程中关闭文件时？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T12:45:01.943

当我的系统用完 RAM 缓存并没有缩小时，系统会将所有内容卸载到交换文件中。当我在写入过程中关闭文件时，系统缓存会缩小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T12:55:12.810

如果我是您，我会尝试更好地了解构成任务管理器显示的“系统缓存”编号的内容。

我怀疑这不是您的想法，并且您使用诸如“系统将所有内容卸载到交换文件中”之类的短语特别让我想知道您是否正在尝试将不同系统上的体验移植到 Windows 上。

Mark Russonovich 的书被认为是这类东西的最佳参考。

# visual-studio - 如何清除 VS2008 中错误列表的警告部分？

> ID：336854
> 
> 赞同：13
> 
> 时间：2008-12-03T11:28:29.040
> 
> 标签：visual-studio, visual-studio-2008, wcag

具体来说，一旦我将网站的 WCAG Anaylsis 警告放入我的警告窗口，我就无法摆脱它们，直到我关闭工作室。当在同一个解决方案中构建另一个项目时，他们会留在那里。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-08-02T12:25:47.857

卸载/重新加载项目

我经常遇到无法清除的顽固错误（在带有 MS Ajax Minifier 的 VS2010 错误列表中）。我发现卸载和重新加载项目可以清除错误；**这比关闭和重新打开解决方案更容易**。这不太理想，但是我发现解决 VS2010 和 MS Ajax Minifier 之间的错误交互的最佳解决方案。

错误 1 ​​Microsoft Ajax Minifier 没有写入 Content\ ... .min.css 的权限

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T11:32:59.420

关闭所有打开的文档并重建解决方案以消除这些警告。我在 webprojects 和 WCAG-varnings 上也有这个问题，但是当我进行重建时它们消失了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-03-10T16:05:59.753

我昨天遇到了这个问题，寻找一个简单的答案。虽然关闭解决方案对我有用，然后只重建我想看到警告的解决方案，但我发现执行“清理解决方案”（右键单击解决方案，选择“清理解决方案”）将清除错误列表窗格（包括警告）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-13T22:13:29.990

我知道这是一个旧线程，但遇到了同样的问题。我发现警告会通过执行以下操作消失：

1.  关闭有问题的文件
2.  单击输出选项卡
3.  重建应用程序

现在，当您单击“错误列表”选项卡并查看警告时，它们应该被重置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T12:41:07.160

您可以永久禁用警告：

```
website -> property pages -> accessibility -> uncheck "show warnings" 
```

否则只需关闭所有文件

```
window -> close all documents 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-06-10T03:39:43.990

只需关闭 Visual Studio 并重新打开？

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-03T11:30:01.127

只需单击窗口顶部的“警告”按钮即可隐藏它们。

# javascript - var functionName = function() {} vs function functionName() {}

> ID：336859
> 
> 赞同：7366
> 
> 时间：2008-12-03T11:31:07.473
> 
> 标签：javascript, function, syntax, idioms

I've recently started maintaining someone else's JavaScript code. I'm fixing bugs, adding features and also trying to tidy up the code and make it more consistent.

The previous developer used two ways of declaring functions and I can't work out if there is a reason behind it or not.

The two ways are:

```
var functionOne = function() {
    // Some code
}; 
```

```
function functionTwo() {
    // Some code
} 
```

What are the reasons for using these two different methods and what are the pros and cons of each? Is there anything that can be done with one method that can't be done with the other?

* * *

## 回答 #1

> 赞同：5414
> 
> 时间：2008-12-03T11:37:42.267

The difference is that `functionOne` is a function expression and so only defined when that line is reached, whereas `functionTwo` is a function declaration and is defined as soon as its surrounding function or script is executed (due to [hoisting](http://adripofjavascript.com/blog/drips/variable-and-function-hoisting.html)).

For example, a function expression:

```
// TypeError: functionOne is not a function
functionOne();

var functionOne = function() {
  console.log("Hello!");
};
```

And, a function declaration:

```
// Outputs: "Hello!"
functionTwo();

function functionTwo() {
  console.log("Hello!");
}
```

Historically, function declarations defined within blocks were handled inconsistently between browsers. Strict mode (introduced in ES5) resolved this by scoping function declarations to their enclosing block.

```
'use strict';    
{ // note this block!
  function functionThree() {
    console.log("Hello!");
  }
}
functionThree(); // ReferenceError
```

* * *

## 回答 #2

> 赞同：2048
> 
> 时间：2008-12-03T17:43:35.180

First I want to correct Greg: `function abc(){}` is scoped too — the name `abc` is defined in the scope where this definition is encountered. Example:

```
function xyz(){
  function abc(){};
  // abc is defined here...
}
// ...but not here 
```

Secondly, it is possible to combine both styles:

```
var xyz = function abc(){}; 
```

`xyz` is going to be defined as usual, `abc` is undefined in all browsers but Internet Explorer — do not rely on it being defined. But it will be defined inside its body:

```
var xyz = function abc(){
  // xyz is visible here
  // abc is visible here
}
// xyz is visible here
// abc is undefined here 
```

If you want to alias functions on all browsers, use this kind of declaration:

```
function abc(){};
var xyz = abc; 
```

In this case, both `xyz` and `abc` are aliases of the same object:

```
console.log(xyz === abc); // prints "true" 
```

One compelling reason to use the combined style is the "name" attribute of function objects (**not supported by Internet Explorer**). Basically when you define a function like

```
function abc(){};
console.log(abc.name); // prints "abc" 
```

its name is automatically assigned. But when you define it like

```
var abc = function(){};
console.log(abc.name); // prints "" 
```

its name is empty — we created an anonymous function and assigned it to some variable.

Another good reason to use the combined style is to use a short internal name to refer to itself, while providing a long non-conflicting name for external users:

```
// Assume really.long.external.scoped is {}
really.long.external.scoped.name = function shortcut(n){
  // Let it call itself recursively:
  shortcut(n - 1);
  // ...
  // Let it pass itself as a callback:
  someFunction(shortcut);
  // ...
} 
```

In the example above we can do the same with an external name, but it'll be too unwieldy (and slower).

*(Another way to refer to itself is to use `arguments.callee`, which is still relatively long, and not supported in the strict mode.)*

Deep down, JavaScript treats both statements differently. This is a function declaration:

```
function abc(){} 
```

`abc` here is defined everywhere in the current scope:

```
// We can call it here
abc(); // Works

// Yet, it is defined down there.
function abc(){}

// We can call it again
abc(); // Works 
```

Also, it hoisted through a `return` statement:

```
// We can call it here
abc(); // Works
return;
function abc(){} 
```

This is a function expression:

```
var xyz = function(){}; 
```

`xyz` here is defined from the point of assignment:

```
// We can't call it here
xyz(); // UNDEFINED!!!

// Now it is defined
xyz = function(){}

// We can call it here
xyz(); // works 
```

Function declaration vs. function expression is the real reason why there is a difference demonstrated by Greg.

Fun fact:

```
var xyz = function abc(){};
console.log(xyz.name); // Prints "abc" 
```

Personally, I prefer the "function expression" declaration because this way I can control the visibility. When I define the function like

```
var abc = function(){}; 
```

I know that I defined the function locally. When I define the function like

```
abc = function(){}; 
```

I know that I defined it globally providing that I didn't define `abc` anywhere in the chain of scopes. This style of definition is resilient even when used inside `eval()`. While the definition

```
function abc(){}; 
```

depends on the context and may leave you guessing where it is actually defined, especially in the case of `eval()` — the answer is: It depends on the browser.

* * *

## 回答 #3

> 赞同：706
> 
> 时间：2014-03-04T13:35:48.803

Here's the rundown on the standard forms that create functions: *(Originally written for another question, but adapted after being moved into the canonical question.)*

Terms:

*   **ES5**: [ECMAScript 5th edition](http://ecma-international.org/ecma-262/5.1/), 2009
*   **ES2015**: [ECMAScript 2015](http://www.ecma-international.org/ecma-262/6.0/index.html) (also known as "ES6")

The quick list:

*   Function Declaration

*   "Anonymous" `function` Expression *(which despite the term, sometimes create functions with names)*

*   Named `function` Expression

*   Accessor Function Initializer (ES5+)

*   Arrow Function Expression (ES2015+) *(which, like anonymous function expressions, don't involve an explicit name, and yet can create functions with names)*

*   Method Declaration in Object Initializer (ES2015+)

*   Constructor and Method Declarations in `class` (ES2015+)

### Function Declaration

The first form is a *function declaration*, which looks like this:

```
function x() {
    console.log('x');
} 
```

A function declaration is a *declaration*; it's not a statement or expression. As such, you don't follow it with a `;` (although doing so is harmless).

A function declaration is processed when execution enters the context in which it appears, **before** any step-by-step code is executed. The function it creates is given a proper name (`x` in the example above), and that name is put in the scope in which the declaration appears.

Because it's processed before any step-by-step code in the same context, you can do things like this:

```
x(); // Works even though it's above the declaration
function x() {
    console.log('x');
} 
```

Until ES2015, the spec didn't cover what a JavaScript engine should do if you put a function declaration inside a control structure like `try`, `if`, `switch`, `while`, etc., like this:

```
if (someCondition) {
    function foo() {    // <===== HERE THERE
    }                   // <===== BE DRAGONS
} 
```

And since they're processed *before* step-by-step code is run, it's tricky to know what to do when they're in a control structure.

Although doing this wasn't *specified* until ES2015, it was an *allowable extension* to support function declarations in blocks. Unfortunately (and inevitably), different engines did different things.

As of ES2015, the specification says what to do. In fact, it gives three separate things to do:

1.  If in loose mode *not* on a web browser, the JavaScript engine is supposed to do one thing
2.  If in loose mode on a web browser, the JavaScript engine is supposed to do something else
3.  If in *strict* mode (browser or not), the JavaScript engine is supposed to do yet another thing

The rules for the loose modes are tricky, but in *strict* mode, function declarations in blocks are easy: They're local to the block (they have *block scope*, which is also new in ES2015), and they're hoisted to the top of the block. So:

```
"use strict";
if (someCondition) {
    foo();               // Works just fine
    function foo() {
    }
}
console.log(typeof foo); // "undefined" (`foo` is not in scope here
                         // because it's not in the same block) 
```

### "Anonymous" `function` Expression

The second common form is called an *anonymous function expression*:

```
var y = function () {
    console.log('y');
}; 
```

Like all expressions, it's evaluated when it's reached in the step-by-step execution of the code.

In ES5, the function this creates has no name (it's anonymous). In ES2015, the function is assigned a name if possible by inferring it from context. In the example above, the name would be `y`. Something similar is done when the function is the value of a property initializer. (For details on when this happens and the rules, search for `SetFunctionName` in the [the specification](https://tc39.github.io/ecma262/) — it appears *all over* the place.)

### Named `function` Expression

The third form is a *named function expression* ("NFE"):

```
var z = function w() {
    console.log('zw')
}; 
```

The function this creates has a proper name (`w` in this case). Like all expressions, this is evaluated when it's reached in the step-by-step execution of the code. The name of the function is *not* added to the scope in which the expression appears; the name *is* in scope within the function itself:

```
var z = function w() {
    console.log(typeof w); // "function"
};
console.log(typeof w);     // "undefined" 
```

Note that NFEs have frequently been a source of bugs for JavaScript implementations. IE8 and earlier, for instance, handle NFEs [completely incorrectly](http://blog.niftysnippets.org/2010/09/double-take.html), creating two different functions at two different times. Early versions of Safari had issues as well. The good news is that current versions of browsers (IE9 and up, current Safari) don't have those issues any more. (But as of this writing, sadly, IE8 remains in widespread use, and so using NFEs with code for the web in general is still problematic.)

### Accessor Function Initializer (ES5+)

Sometimes functions can sneak in largely unnoticed; that's the case with *accessor functions*. Here's an example:

```
var obj = {
    value: 0,
    get f() {
        return this.value;
    },
    set f(v) {
        this.value = v;
    }
};
console.log(obj.f);         // 0
console.log(typeof obj.f);  // "number" 
```

Note that when I used the function, I didn't use `()`! That's because it's an *accessor function* for a property. We get and set the property in the normal way, but behind the scenes, the function is called.

You can also create accessor functions with `Object.defineProperty`, `Object.defineProperties`, and the lesser-known second argument to `Object.create`.

### Arrow Function Expression (ES2015+)

ES2015 brings us the *arrow function*. Here's one example:

```
var a = [1, 2, 3];
var b = a.map(n => n * 2);
console.log(b.join(", ")); // 2, 4, 6 
```

See that `n => n * 2` thing hiding in the `map()` call? That's a function.

A couple of things about arrow functions:

1.  They don't have their own `this`. Instead, they *close over* the `this` of the context where they're defined. (They also close over `arguments` and, where relevant, `super`.) This means that the `this` within them is the same as the `this` where they're created, and cannot be changed.

2.  As you'll have noticed with the above, you don't use the keyword `function`; instead, you use `=>`.

The `n => n * 2` example above is one form of them. If you have multiple arguments to pass the function, you use parens:

```
var a = [1, 2, 3];
var b = a.map((n, i) => n * i);
console.log(b.join(", ")); // 0, 2, 6 
```

(Remember that `Array#map` passes the entry as the first argument, and the index as the second.)

In both cases, the body of the function is just an expression; the function's return value will automatically be the result of that expression (you don't use an explicit `return`).

If you're doing more than just a single expression, use `{}` and an explicit `return` (if you need to return a value), as normal:

```
var a = [
  {first: "Joe", last: "Bloggs"},
  {first: "Albert", last: "Bloggs"},
  {first: "Mary", last: "Albright"}
];
a = a.sort((a, b) => {
  var rv = a.last.localeCompare(b.last);
  if (rv === 0) {
    rv = a.first.localeCompare(b.first);
  }
  return rv;
});
console.log(JSON.stringify(a)); 
```

The version without `{ ... }` is called an arrow function with an *expression body* or *concise body*. (Also: A *concise* arrow function.) The one with `{ ... }` defining the body is an arrow function with a *function body*. (Also: A *verbose* arrow function.)

### Method Declaration in Object Initializer (ES2015+)

ES2015 allows a shorter form of declaring a property that references a function called a *method definition*; it looks like this:

```
var o = {
    foo() {
    }
}; 
```

the almost-equivalent in ES5 and earlier would be:

```
var o = {
    foo: function foo() {
    }
}; 
```

the difference (other than verbosity) is that a method can use `super`, but a function cannot. So for instance, if you had an object that defined (say) `valueOf` using method syntax, it could use `super.valueOf()` to get the value `Object.prototype.valueOf` would have returned (before presumably doing something else with it), whereas the ES5 version would have to do `Object.prototype.valueOf.call(this)` instead.

That also means that the method has a reference to the object it was defined on, so if that object is temporary (for instance, you're passing it into `Object.assign` as one of the source objects), method syntax *could* mean that the object is retained in memory when otherwise it could have been garbage collected (if the JavaScript engine doesn't detect that situation and handle it if none of the methods uses `super`).

### Constructor and Method Declarations in `class` (ES2015+)

ES2015 brings us `class` syntax, including declared constructors and methods:

```
class Person {
    constructor(firstName, lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
    }

    getFullName() {
        return this.firstName + " " + this.lastName;
    }
} 
```

There are two function declarations above: One for the constructor, which gets the name `Person`, and one for `getFullName`, which is a function assigned to `Person.prototype`.

* * *

## 回答 #4

> 赞同：164
> 
> 时间：2010-08-08T19:32:11.603

Speaking about the global context, both, the `var` statement and a `FunctionDeclaration` at the end will create a *non-deleteable* property on the global object, but the value of both *can be overwritten*.

The subtle difference between the two ways is that when the [Variable Instantiation](http://bclary.com/2004/11/07/#a-10.1.3) process runs (before the actual code execution) all identifiers declared with `var` will be initialized with `undefined`, and the ones used by the `FunctionDeclaration`'s will be available since that moment, for example:

```
 alert(typeof foo); // 'function', it's already available
 alert(typeof bar); // 'undefined'
 function foo () {}
 var bar = function () {};
 alert(typeof bar); // 'function' 
```

The assignment of the `bar` `FunctionExpression` takes place until runtime.

A global property created by a `FunctionDeclaration` can be overwritten without any problems just like a variable value, e.g.:

```
 function test () {}
 test = null; 
```

Another obvious difference between your two examples is that the first function doesn't have a name, but the second has it, which can be really useful when debugging (i.e. inspecting a call stack).

About your edited first example (`foo = function() { alert('hello!'); };`), it is an undeclared assignment, I would highly encourage you to always use the `var` keyword.

With an assignment, without the `var` statement, if the referenced identifier is not found in the scope chain, it will become a *deleteable* property of the global object.

Also, undeclared assignments throw a `ReferenceError` on ECMAScript 5 under [Strict Mode](http://dmitrysoshnikov.com/ecmascript/es5-chapter-2-strict-mode/).

A must read:

*   [Named function expressions demystified](http://kangax.github.com/nfe/)

**Note**: This answer has been merged from [another question](https://stackoverflow.com/questions/3435709/why-are-functions-in-javascript-set-to-global-variables-instead-of-plain-function), in which the major doubt and misconception from the OP was that identifiers declared with a `FunctionDeclaration`, couldn't be overwritten which is not the case.

* * *

## 回答 #5

> 赞同：138
> 
> 时间：2010-04-20T04:54:49.160

The two code snippets you've posted there will, for almost all purposes, behave the same way.

However, the difference in behaviour is that with the first variant (`var functionOne = function() {}`), that function can only be called after that point in the code.

With the second variant (`function functionTwo()`), the function is available to code that runs above where the function is declared.

This is because with the first variant, the function is assigned to the variable `foo` at run time. In the second, the function is assigned to that identifier, `foo`, at parse time.

**More technical information**

JavaScript has three ways of defining functions.

1.  Your first snippet shows a **function expression**. This involves using the *"function" operator* to create a function - the result of that operator can be stored in any variable or object property. The function expression is powerful that way. The function expression is often called an "anonymous function", because it does not have to have a name,
2.  Your second example is a **function declaration**. This uses the *"function" statement* to create a function. The function is made available at parse time and can be called anywhere in that scope. You can still store it in a variable or object property later.
3.  The third way of defining a function is the **"Function()" constructor**, which is not shown in your original post. It's not recommended to use this as it works the same way as `eval()`, which has its problems.

* * *

## 回答 #6

> 赞同：119
> 
> 时间：2014-08-09T02:45:38.840

A better explanation to [Greg's answer](https://stackoverflow.com/a/336868/2351696)

```
functionTwo();
function functionTwo() {
} 
```

**Why no error? We were always taught that expressions are executed from top to bottom(??)**

## Because:

> Function declarations and variable declarations are always moved (`hoisted`) invisibly to the top of their containing scope by the JavaScript interpreter. Function parameters and language-defined names are, obviously, already there. [ben cherry](http://www.adequatelygood.com/2010/2/JavaScript-Scoping-and-Hoisting)

This means that code like this:

```
functionOne();                  ---------------      var functionOne;
                                | is actually |      functionOne();
var functionOne = function(){   | interpreted |-->
};                              |    like     |      functionOne = function(){
                                ---------------      }; 
```

Notice that the assignment portion of the declarations were not hoisted. Only the name is hoisted.

*But in the case with function declarations, the entire function body will be hoisted as well*:

```
functionTwo();              ---------------      function functionTwo() {
                            | is actually |      };
function functionTwo() {    | interpreted |-->
}                           |    like     |      functionTwo();
                            --------------- 
```

* * *

## 回答 #7

> 赞同：99
> 
> 时间：2011-03-03T19:19:18.113

Other commenters have already covered the semantic difference of the two variants above. I wanted to note a stylistic difference: Only the "assignment" variation can set a property of another object.

I often build JavaScript modules with a pattern like this:

```
(function(){
    var exports = {};

    function privateUtil() {
            ...
    }

    exports.publicUtil = function() {
            ...
    };

    return exports;
})(); 
```

With this pattern, your public functions will all use assignment, while your private functions use declaration.

(Note also that assignment should require a semicolon after the statement, while declaration prohibits it.)

* * *

## 回答 #8

> 赞同：84
> 
> 时间：2013-03-29T13:26:24.443

An illustration of when to prefer the first method to the second one is when you need to avoid overriding a function's previous definitions.

With

```
if (condition){
    function myfunction(){
        // Some code
    }
} 
```

, this definition of `myfunction` will override any previous definition, since it will be done at parse-time.

While

```
if (condition){
    var myfunction = function (){
        // Some code
    }
} 
```

does the correct job of defining `myfunction` only when `condition` is met.

* * *

## 回答 #9

> 赞同：69
> 
> 时间：2010-08-08T19:44:40.373

An important reason is to add one and only one variable as the "Root" of your namespace...

```
var MyNamespace = {}
MyNamespace.foo= function() {

} 
```

or

```
var MyNamespace = {
  foo: function() {
  },
  ...
} 
```

There are many techniques for namespacing. It's become more important with the plethora of JavaScript modules available.

Also see *[How do I declare a namespace in JavaScript?](https://stackoverflow.com/questions/881515/)*

* * *

## 回答 #10

> 赞同：62
> 
> 时间：2016-01-25T14:46:53.683

**[Hoisting](http://www.sitepoint.com/back-to-basics-javascript-hoisting/)** *is the JavaScript interpreter’s action of moving all variable and function declarations to the top of the current scope.*

*However, only the actual declarations are hoisted. by leaving assignments where they are.*

*   variable's/Function's declared inside the page are global can access anywhere in that page.
*   variable's/Functions declared inside the function are having local scope. means they are available/accessed inside the function body (scope), they are not available outside the function body.

**[Variable](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types#Variables)**

*Javascript is called loosely typed language. Which means Javascript variables can hold value of any [Data-Type](https://msdn.microsoft.com/en-us/library/7wkd9z69(v=vs.94).aspx). Javascript automatically takes care of changing the variable-type based on the value/literal provided during runtime.*

```
global_Page = 10;                                               var global_Page;      « undefined
    « Integer literal, Number Type.   -------------------       global_Page = 10;     « Number         
global_Page = 'Yash';                 |   Interpreted   |       global_Page = 'Yash'; « String
    « String literal, String Type.    «       AS        «       global_Page = true;   « Boolean 
var global_Page = true;               |                 |       global_Page = function (){          « function
    « Boolean Type                    -------------------                 var local_functionblock;  « undefined
global_Page = function (){                                                local_functionblock = 777;« Number
    var local_functionblock = 777;                              };  
    // Assigning function as a data.
}; 
```

* * *

**Function**

```
function Identifier_opt ( FormalParameterList_opt ) { 
      FunctionBody | sequence of statements

      « return;  Default undefined
      « return 'some data';
} 
```

*   functions declared inside the page are hoisted to top of the page having global access.
*   functions declared inside the function-block are hoisted to top of the block.
*   Default return value of function is '[undefined](https://javascriptweblog.wordpress.com/2010/08/16/understanding-undefined-and-preventing-referenceerrors/)', [Variable](http://javascript.info/tutorial/variables-and-statements) declaration default value also 'undefined'

    ```
    Scope with respect to function-block global. 
    Scope with respect to page undefined | not available. 
    ```

**Function Declaration**

```
function globalAccess() {                                  function globalAccess() {      
}                                  -------------------     }
globalAccess();                    |                 |     function globalAccess() { « Re-Defined / overridden.
localAccess();                     «   Hoisted  As   «         function localAccess() {
function globalAccess() {          |                 |         }
     localAccess();                -------------------         localAccess(); « function accessed with in globalAccess() only.
     function localAccess() {                              }
     }                                                     globalAccess();
}                                                          localAccess(); « ReferenceError as the function is not defined 
```

**Function Expression**

```
 10;                 « literal
       (10);                « Expression                (10).toString() -> '10'
var a;                      
    a = 10;                 « Expression var              a.toString()  -> '10'
(function invoke() {        « Expression Function
 console.log('Self Invoking');                      (function () {
});                                                               }) () -> 'Self Invoking'

var f; 
    f = function (){        « Expression var Function
    console.log('var Function');                                   f ()  -> 'var Function'
    }; 
```

*Function assigned to variable Example:*

```
(function selfExecuting(){
    console.log('IIFE - Immediately-Invoked Function Expression');
}());

var anonymous = function (){
    console.log('anonymous function Expression');
};

var namedExpression = function for_InternalUSE(fact){
    if(fact === 1){
        return 1;
    }

    var localExpression = function(){
        console.log('Local to the parent Function Scope');
    };
    globalExpression = function(){ 
        console.log('creates a new global variable, then assigned this function.');
    };

    //return; //undefined.
    return fact * for_InternalUSE( fact - 1);   
};

namedExpression();
globalExpression(); 
```

javascript interpreted as

```
var anonymous;
var namedExpression;
var globalExpression;

anonymous = function (){
    console.log('anonymous function Expression');
};

namedExpression = function for_InternalUSE(fact){
    var localExpression;

    if(fact === 1){
        return 1;
    }
    localExpression = function(){
        console.log('Local to the parent Function Scope');
    };
    globalExpression = function(){ 
        console.log('creates a new global variable, then assigned this function.');
    };

    return fact * for_InternalUSE( fact - 1);    // DEFAULT UNDEFINED.
};

namedExpression(10);
globalExpression(); 
```

You can check function declaration, expression test over different browser's using [`jsperf Test Runner`](http://jsperf.com/yashfunctions)

* * *

**[ES5 Constructor Function Classes](https://stackoverflow.com/a/45759444/5081877): Function objects created using Function.prototype.bind**

JavaScript treats functions as first-class objects, so being an object, you can assign properties to a function.

```
function Shape(id) { // Function Declaration
    this.id = id;
};
    // Adding a prototyped method to a function.
    Shape.prototype.getID = function () {
        return this.id;
    };
    Shape.prototype.setID = function ( id ) {
        this.id = id;
    };

var expFn = Shape; // Function Expression

var funObj = new Shape( ); // Function Object
funObj.hasOwnProperty('prototype'); // false
funObj.setID( 10 );
console.log( funObj.getID() ); // 10 
```

* * *

ES6 introduced **Arrow function**: An arrow function expression has a shorter syntax, they are best suited for non-method functions, and they cannot be used as constructors.

> [`ArrowFunction : ArrowParameters => ConciseBody`](http://www.ecma-international.org/ecma-262/6.0/index.html#sec-arrow-function-definitions-static-semantics-early-errors).
> 
> ```
> const fn = (item) => { return item & 1 ? 'Odd' : 'Even'; };
> console.log( fn(2) ); // Even
> console.log( fn(3) ); // Odd 
> ```

* * *

## 回答 #11

> 赞同：48
> 
> 时间：2015-05-01T15:06:55.083

I'm adding my own answer just because everyone else has covered the hoisting part thoroughly.

I've wondered about which way is better for a long while now, and thanks to [http://jsperf.com](http://jsperf.com) now I know :)

![enter image description here](https://i.stack.imgur.com/bCrSm.png)

**Function declarations** are faster, and that's what really matters in web dev right? ;)

* * *

## 回答 #12

> 赞同：42
> 
> 时间：2018-01-15T01:55:57.197

# .

1.  Availability (scope) of the function

The following works because `function add()` is scoped to the nearest block:

```
try {
  console.log("Success: ", add(1, 1));
} catch(e) {
  console.log("ERROR: " + e);
}

function add(a, b){
  return a + b;
}
```

The following does not work because the variable is called before a function value is assigned to the variable `add`.

```
try {
  console.log("Success: ", add(1, 1));
} catch(e) {
  console.log("ERROR: " + e);
}

var add=function(a, b){
  return a + b;
}
```

The above code is identical in functionality to the code below. Note that explicitly assigning `add = undefined` is superfluous because simply doing `var add;` is the exact same as `var add=undefined`.

```
var add = undefined;

try {
  console.log("Success: ", add(1, 1));
} catch(e) {
  console.log("ERROR: " + e);
}

add = function(a, b){
  return a + b;
}
```

The following does not work because `var add=` begins an expression and causes the following `function add()` to be an expression instead of a block. Named functions are only visible to themselves and their surrounding block. As `function add()` is an expression here, it has no surrounding block, so it is only visible to itself.

```
try {
  console.log("Success: ", add(1, 1));
} catch(e) {
  console.log("ERROR: " + e);
}

var add=function add(a, b){
  return a + b;
}
```

2.  *(function)*.name

The name of a function `function thefuncname(){}` is *thefuncname* when it is declared this way.

```
function foobar(a, b){}

console.log(foobar.name);
```

```
var a = function foobar(){};

console.log(a.name);
```

Otherwise, if a function is declared as `function(){}`, the *function*.name is the first variable used to store the function.

```
var a = function(){};
var b = (function(){ return function(){} });

console.log(a.name);
console.log(b.name);
```

If there are no variables set to the function, then the functions name is the empty string (`""`).

```
console.log((function(){}).name === "");
```

Lastly, while the variable the function is assigned to initially sets the name, successive variables set to the function do not change the name.

```
var a = function(){};
var b = a;
var c = b;

console.log(a.name);
console.log(b.name);
console.log(c.name);
```

3.  Performance

In Google's V8 and Firefox's Spidermonkey there might be a few microsecond JIT compilation difference, but ultimately the result is the exact same. To prove this, let's examine the efficiency of JSPerf at micro-benchmarks by comparing the speed of two blank code snippets. The [JSPerf tests are found here](https://jsperf.com/microbenchmark-analysis/1). And, the [jsben.ch tests are found here](http://jsben.ch/Ov6eJ). As you can see, there is a noticeable difference when there should be none. If you are really a performance freak like me, then it might be more worth your while trying to reduce the number of variables and functions in the scope and especially eliminating polymorphism (such as using the same variable to store two different types).

4.  Variable Mutability

When you use the `var` keyword to declare a variable, you can then reassign a different value to the variable like so.

```
(function(){
    "use strict";
    var foobar = function(){}; // initial value
    try {
        foobar = "Hello World!"; // new value
        console.log("[no error]");
    } catch(error) {
        console.log("ERROR: " + error.message);
    }
    console.log(foobar, window.foobar);
})();
```

However, when we use the const-statement, the variable reference becomes immutable. This means that we cannot assign a new value to the variable. Please note, however, that this does not make the contents of the variable immutable: if you do `const arr = []`, then you can still do `arr[10] = "example"`. Only doing something like `arr = "new value"` or `arr = []` would throw an error as seen below.

```
(function(){
    "use strict";
    const foobar = function(){}; // initial value
    try {
        foobar = "Hello World!"; // new value
        console.log("[no error]");
    } catch(error) {
        console.log("ERROR: " + error.message);
    }
    console.log(foobar, window.foobar);
})();
```

Interestingly, if we declare the variable as `function funcName(){}`, then the immutability of the variable is the same as declaring it with `var`.

```
(function(){
    "use strict";
    function foobar(){}; // initial value
    try {
        foobar = "Hello World!"; // new value
        console.log("[no error]");
    } catch(error) {
        console.log("ERROR: " + error.message);
    }
    console.log(foobar, window.foobar);
})();
```

## " "

The "nearest block" is the nearest "function," (including asynchronous functions, generator functions, and asynchronous generator functions). However, interestingly, a `function functionName() {}` behaves like a `var functionName = function() {}` when in a non-closure block to items outside said closure. Observe.

*   Normal `var add=function(){}`

```
try {
  // typeof will simply return "undefined" if the variable does not exist
  if (typeof add !== "undefined") {
    add(1, 1); // just to prove it
    console.log("Not a block");
  }else if(add===undefined){ // this throws an exception if add doesn't exist
    console.log('Behaves like var add=function(a,b){return a+b}');
  }
} catch(e) {
  console.log("Is a block");
}
var add=function(a, b){return a + b}
```

*   Normal `function add(){}`

```
try {
  // typeof will simply return "undefined" if the variable does not exist
  if (typeof add !== "undefined") {
    add(1, 1); // just to prove it
    console.log("Not a block");
  }else if(add===undefined){ // this throws an exception if add doesn't exist
    console.log('Behaves like var add=function(a,b){return a+b}')
  }
} catch(e) {
  console.log("Is a block");
}
function add(a, b){
  return a + b;
}
```

*   Function

```
try {
  // typeof will simply return "undefined" if the variable does not exist
  if (typeof add !== "undefined") {
    add(1, 1); // just to prove it
    console.log("Not a block");
  }else if(add===undefined){ // this throws an exception if add doesn't exist
    console.log('Behaves like var add=function(a,b){return a+b}')
  }
} catch(e) {
  console.log("Is a block");
}
(function () {
    function add(a, b){
      return a + b;
    }
})();
```

*   Statement (such as `if`, `else`, `for`, `while`, `try`/`catch`/`finally`, `switch`, `do`/`while`, `with`)

```
try {
  // typeof will simply return "undefined" if the variable does not exist
  if (typeof add !== "undefined") {
    add(1, 1); // just to prove it
    console.log("Not a block");
  }else if(add===undefined){ // this throws an exception if add doesn't exist
    console.log('Behaves like var add=function(a,b){return a+b}')
  }
} catch(e) {
  console.log("Is a block");
}
{
    function add(a, b){
      return a + b;
    }
}
```

*   Arrow Function with `var add=function()`

```
try {
  // typeof will simply return "undefined" if the variable does not exist
  if (typeof add !== "undefined") {
    add(1, 1); // just to prove it
    console.log("Not a block");
  }else if(add===undefined){ // this throws an exception if add doesn't exist
    console.log('Behaves like var add=function(a,b){return a+b}')
  }
} catch(e) {
  console.log("Is a block");
}
(() => {
    var add=function(a, b){
      return a + b;
    }
})();
```

*   Arrow Function With `function add()`

```
try {
  // typeof will simply return "undefined" if the variable does not exist
  if (typeof add !== "undefined") {
    add(1, 1); // just to prove it
    console.log("Not a block");
  }else if(add===undefined){ // this throws an exception if add doesn't exist
    console.log('Behaves like var add=function(a,b){return a+b}')
  }
} catch(e) {
  console.log("Is a block");
}
(() => {
    function add(a, b){
      return a + b;
    }
})();
```

* * *

## 回答 #13

> 赞同：38
> 
> 时间：2013-02-06T16:29:20.620

A function declaration and a function expression assigned to a variable behave the same once the binding is established.

There is a difference however at *how* and *when* the function object is actually associated with its variable. This difference is due to the mechanism called *variable hoisting* in JavaScript.

Basically, all function declarations and variable declarations are hoisted to the top of the *function* in which the declaration occurs (this is why we say that JavaScript has *function scope*).

*   When a function declaration is hoisted, the function body "follows" so when the function body is evaluated, the variable will immediately be bound to a function object.

*   When a variable declaration is hoisted, the initialization does *not* follow, but is "left behind". The variable is initialized to `undefined` at the start of the function body, and will be *assigned* a value at its original location in the code. (Actually, it will be assigned a value at *every* location where a declaration of a variable with the same name occurs.)

The order of hoisting is also important: function declarations take precedence over variable declarations with the same name, and the last function declaration takes precedence over previous function declarations with the same name.

Some examples...

```
var foo = 1;
function bar() {
  if (!foo) {
    var foo = 10 }
  return foo; }
bar() // 10 
```

Variable `foo` is hoisted to the top of the function, initialized to `undefined`, so that `!foo` is `true`, so `foo` is assigned `10`. The `foo` outside of `bar`'s scope plays no role and is untouched.

```
function f() {
  return a; 
  function a() {return 1}; 
  var a = 4;
  function a() {return 2}}
f()() // 2

function f() {
  return a;
  var a = 4;
  function a() {return 1};
  function a() {return 2}}
f()() // 2 
```

Function declarations take precedence over variable declarations, and the last function declaration "sticks".

```
function f() {
  var a = 4;
  function a() {return 1}; 
  function a() {return 2}; 
  return a; }
f() // 4 
```

In this example `a` is initialized with the function object resulting from evaluating the second function declaration, and then is assigned `4`.

```
var a = 1;
function b() {
  a = 10;
  return;
  function a() {}}
b();
a // 1 
```

Here the function declaration is hoisted first, declaring and initializing variable `a`. Next, this variable is assigned `10`. In other words: the assignment does not assign to outer variable `a`.

* * *

## 回答 #14

> 赞同：36
> 
> 时间：2014-06-05T08:28:44.063

The first example is a function declaration:

```
function abc(){} 
```

The second example is a function expression:

```
var abc = function() {}; 
```

The main difference is how they are hoisted (lifted and declared). In the first example, the whole function declaration is hoisted. In the second example only the var 'abc' is hoisted, its value (the function) will be undefined, and the function itself remains at the position that it is declared.

To put it simply:

```
//this will work
abc(param);
function abc(){}

//this would fail
abc(param);
var abc = function() {} 
```

To study more about this topic I strongly recommend you this [link](http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/#comment-43792)

* * *

## 回答 #15

> 赞同：34
> 
> 时间：2010-01-23T20:32:54.490

In terms of code maintenance cost, named functions are more preferable:

*   Independent from the place where they are declared (but still limited by scope).
*   More resistant to mistakes like conditional initialization (you are still able to override if wanted to).
*   The code becomes more readable by allocating local functions separately of scope functionality. Usually in the scope the functionality goes first, followed by declarations of local functions.
*   In a debugger you will clearly see the function name on the call stack instead of an "anonymous/evaluated" function.

I suspect more PROS for named functions are follow. And what is listed as an advantage of named functions is a disadvantage for anonymous ones.

Historically, anonymous functions appeared from the inability of JavaScript as a language to list members with named functions:

```
{
    member:function() { /* How do I make "this.member" a named function? */
    }
} 
```

* * *

## 回答 #16

> 赞同：31
> 
> 时间：2008-12-18T19:30:42.867

In computer science terms, we talk about anonymous functions and named functions. I think the most important difference is that an anonymous function is not bound to a name, hence the name anonymous function. In JavaScript it is a first class object dynamically declared at runtime.

For more information on anonymous functions and lambda calculus, Wikipedia is a good start: [Anonymous Functions](http://en.wikipedia.org/wiki/Anonymous_function).

* * *

## 回答 #17

> 赞同：30
> 
> 时间：2015-07-21T07:45:37.467

[Greg's Answer](https://stackoverflow.com/a/336868/2730064) is good enough, but I still would like to add something to it that I learned just now watching [Douglas Crockford's](https://en.wikipedia.org/wiki/Douglas_Crockford) videos.

**Function expression:**

```
var foo = function foo() {}; 
```

**Function statement:**

```
function foo() {}; 
```

The function statement is just a shorthand for `var` statement with a `function` value.

So

```
function foo() {}; 
```

expands to

```
var foo = function foo() {}; 
```

Which expands further to:

```
var foo = undefined;
foo = function foo() {}; 
```

And they are both hoisted to the top of the code.

![Screenshot from video](https://i.stack.imgur.com/6TVZL.jpg)

* * *

## 回答 #18

> 赞同：29
> 
> 时间：2012-11-29T11:28:49.407

I use the variable approach in my code for a very specific reason, the theory of which has been covered in an abstract way above, but an example might help some people like me, with limited JavaScript expertise.

I have code that I need to run with 160 independently-designed brandings. Most of the code is in shared files, but branding-specific stuff is in a separate file, one for each branding.

Some brandings require specific functions, and some do not. Sometimes I have to add new functions to do new branding-specific things. I am happy to change the shared coded, but I don't want to have to change all 160 sets of branding files.

By using the variable syntax, I can declare the variable (a function pointer essentially) in the shared code and either assign a trivial stub function, or set to null.

The one or two brandings that need a specific implementation of the function can then define their version of the function and assign this to the variable if they want, and the rest do nothing. I can test for a null function before I execute it in the shared code.

From people's comments above, I gather it may be possible to redefine a static function too, but I think the variable solution is nice and clear.

* * *

## 回答 #19

> 赞同：20
> 
> 时间：2012-08-04T15:24:31.767

[@EugeneLazutkin](https://stackoverflow.com/users/26394/eugene-lazutkin) gives an example where he [names an assigned function to be able to use `shortcut()`](https://stackoverflow.com/a/338053/) as an internal reference to itself. [John Resig](http://ejohn.org/) gives another example - *copying a recursive function assigned to another object* in his [Learning Advanced Javascript](http://ejohn.org/apps/learn/) tutorial. While assigning functions to properties isn't strictly the question here, I recommend actively trying the tutorial out - run the code by clicking the button in the upper right corner, and double click the code to edit to your liking.

Examples from the tutorial: recursive calls in `yell()`:

[Tests fail when the original ninja object is removed.](http://ejohn.org/apps/learn/#13) (page 13)

```
var ninja = { 
  yell: function(n){ 
    return n > 0 ? ninja.yell(n-1) + "a" : "hiy"; 
  } 
}; 
assert( ninja.yell(4) == "hiyaaaa", "A single object isn't too bad, either." ); 

var samurai = { yell: ninja.yell }; 
var ninja = null; 

try { 
  samurai.yell(4); 
} catch(e){ 
  assert( false, "Uh, this isn't good! Where'd ninja.yell go?" ); 
} 
```

[If you name the function that will be called recursively, the tests will pass.](http://ejohn.org/apps/learn/#14) (page 14)

```
var ninja = { 
  yell: function yell(n){ 
    return n > 0 ? yell(n-1) + "a" : "hiy"; 
  } 
}; 
assert( ninja.yell(4) == "hiyaaaa", "Works as we would expect it to!" ); 

var samurai = { yell: ninja.yell }; 
var ninja = {}; 
assert( samurai.yell(4) == "hiyaaaa", "The method correctly calls itself." ); 
```

* * *

## 回答 #20

> 赞同：18
> 
> 时间：2012-10-15T10:42:47.903

Another difference that is not mentioned in the other answers is that if you use the anonymous function

```
var functionOne = function() {
    // Some code
}; 
```

and use that as a constructor as in

```
var one = new functionOne(); 
```

then `one.constructor.name` will not be defined. `Function.name` is non-standard but is supported by Firefox, Chrome, other Webkit-derived browsers and IE 9+.

With

```
function functionTwo() {
    // Some code
}
two = new functionTwo(); 
```

it is possible to retrieve the name of the constructor as a string with `two.constructor.name`.

* * *

## 回答 #21

> 赞同：18
> 
> 时间：2015-09-09T10:30:53.580

I'm listing out the differences below:

1.  A function declaration can be placed anywhere in the code. Even if it is invoked before the definition appears in code, it gets executed as function declaration is committed to memory or in a way it is hoisted up, before any other code in the page starts execution.

    Take a look at the function below:

    ```
    function outerFunction() {
        function foo() {
           return 1;
        }
        return foo();
        function foo() {
           return 2;
        }
    }
    alert(outerFunction()); // Displays 2 
    ```

    This is because, during execution, it looks like:-

    ```
    function foo() {  // The first function declaration is moved to top
        return 1;
    }
    function foo() {  // The second function declaration is moved to top
        return 2;
    }
    function outerFunction() {
        return foo();
    }
    alert(outerFunction()); //So executing from top to bottom,
                            //the last foo() returns 2 which gets displayed 
    ```

    A function expression, if not defined before calling it, will result in an error. Also, here the function definition itself is not moved to the top or committed to memory like in the function declarations. But the variable to which we assign the function gets hoisted up and **undefined** gets assigned to it.

    Same function using function expressions:

    ```
    function outerFunction() {
        var foo = function() {
           return 1;
        }
        return foo();
        var foo = function() {
           return 2;
        }
    }
    alert(outerFunction()); // Displays 1 
    ```

    This is because during execution, it looks like:

    ```
    function outerFunction() {
       var foo = undefined;
       var foo = undefined;

       foo = function() {
          return 1;
       };
       return foo ();
       foo = function() {   // This function expression is not reachable
          return 2;
       };
    }
    alert(outerFunction()); // Displays 1 
    ```

2.  It is not safe to write function declarations in non-function blocks like **if** because they won't be accessible.

    ```
    if (test) {
        function x() { doSomething(); }
    } 
    ```

3.  Named function expression like the one below, may not work in Internet Explorer browsers prior to version 9.

    ```
    var today = function today() {return new Date()} 
    ```

* * *

## 回答 #22

> 赞同：17
> 
> 时间：2013-01-05T18:37:52.810

The first one (function doSomething(x)) should be part of an object notation.

The second one (`var doSomething = function(x){ alert(x);}`) is simply creating an anonymous function and assigning it to a variable, `doSomething`. So doSomething() will call the function.

You may want to know what a *function declaration* and *function expression* is.

A function declaration defines a named function variable without requiring variable assignment. Function declarations occur as standalone constructs and cannot be nested within non-function blocks.

```
function foo() {
    return 3;
} 
```

> ECMA 5 (13.0) defines the syntax as
> function Identifier ( FormalParameterList[opt] ) { FunctionBody }

In above condition the function name is visible within its scope and the scope of its parent (otherwise it would be unreachable).

And in a function expression

A function expression defines a function as a part of a larger expression syntax (typically a variable assignment ). Functions defined via functions expressions can be named or anonymous. Function expressions should not start with “function”.

```
// Anonymous function expression
var a = function() {
    return 3;
}

// Named function expression
var a = function foo() {
    return 3;
}

// Self-invoking function expression
(function foo() {
    alert("hello!");
})(); 
```

> ECMA 5 (13.0) defines the syntax as
> function Identifier[opt] ( FormalParameterList[opt] ) { FunctionBody }

* * *

## 回答 #23

> 赞同：15
> 
> 时间：2013-10-25T16:38:22.447

If you would use those functions to create objects, you would get:

```
var objectOne = new functionOne();
console.log(objectOne.__proto__); // prints "Object {}" because constructor is an anonymous function

var objectTwo = new functionTwo();
console.log(objectTwo.__proto__); // prints "functionTwo {}" because constructor is a named function 
```

* * *

## 回答 #24

> 赞同：14
> 
> 时间：2017-09-28T04:34:23.920

***About performance:***

New versions of `V8` introduced several under-the-hood optimizations and so did `SpiderMonkey`.

There is almost no difference now between expression and declaration.
Function expression [appears to be faster](https://jsperf.com/fdeclaration-vs-fexpression) now.

***Chrome 62.0.3202*** [![Chrome test](https://i.stack.imgur.com/lW91X.png)](https://i.stack.imgur.com/lW91X.png)

***FireFox 55*** [![Firefox test](https://i.stack.imgur.com/po3gG.png)](https://i.stack.imgur.com/po3gG.png)

***Chrome Canary 63.0.3225*** [![Chrome Canary test](https://i.stack.imgur.com/lcPvN.png)](https://i.stack.imgur.com/lcPvN.png)

> `Anonymous` function expressions [appear to have better performance](https://jsperf.com/named-vs-anonymous-expressions) against `Named` function expression.

***Firefox*** [![Firefox named_anonymous](https://i.stack.imgur.com/npaAl.png)](https://i.stack.imgur.com/npaAl.png) ***Chrome Canary*** [![Chrome canary named_anonymous](https://i.stack.imgur.com/6YkeY.png)](https://i.stack.imgur.com/6YkeY.png) ***Chrome*** [![Chrome named_anonymous](https://i.stack.imgur.com/x9H8J.png)](https://i.stack.imgur.com/x9H8J.png)

* * *

## 回答 #25

> 赞同：12
> 
> 时间：2014-10-12T00:58:57.383

In light of the "named functions show up in stack traces" argument, modern JavaScript engines are actually quite capable of representing anonymous functions.

As of this writing, V8, SpiderMonkey, Chakra and Nitro always refer to named functions by their names. They almost always refer to an anonymous function by its identifier if it has one.

SpiderMonkey can figure out the name of an anonymous function returned from another function. The rest can't.

If you really, really wanted your iterator and success callbacks to show up in the trace, you could name those too...

```
[].forEach(function iterator() {}); 
```

But for the most part it's not worth stressing over.

## Harness ([Fiddle](http://jsfiddle.net/us9dg6y8/))

```
'use strict';

var a = function () {
    throw new Error();
},
    b = function b() {
        throw new Error();
    },
    c = function d() {
        throw new Error();
    },
    e = {
        f: a,
        g: b,
        h: c,
        i: function () {
            throw new Error();
        },
        j: function j() {
            throw new Error();
        },
        k: function l() {
            throw new Error();
        }
    },
    m = (function () {
        return function () {
            throw new Error();
        };
    }()),
    n = (function () {
        return function n() {
            throw new Error();
        };
    }()),
    o = (function () {
        return function p() {
            throw new Error();
        };
    }());

console.log([a, b, c].concat(Object.keys(e).reduce(function (values, key) {
    return values.concat(e[key]);
}, [])).concat([m, n, o]).reduce(function (logs, func) {

    try {
        func();
    } catch (error) {
        return logs.concat('func.name: ' + func.name + '\n' +
                           'Trace:\n' +
                           error.stack);
        // Need to manually log the error object in Nitro.
    }

}, []).join('\n\n')); 
```

## V8

```
func.name: 
Trace:
Error
    at a (http://localhost:8000/test.js:4:11)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: b
Trace:
Error
    at b (http://localhost:8000/test.js:7:15)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: d
Trace:
Error
    at d (http://localhost:8000/test.js:10:15)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: 
Trace:
Error
    at a (http://localhost:8000/test.js:4:11)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: b
Trace:
Error
    at b (http://localhost:8000/test.js:7:15)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: d
Trace:
Error
    at d (http://localhost:8000/test.js:10:15)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: 
Trace:
Error
    at e.i (http://localhost:8000/test.js:17:19)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: j
Trace:
Error
    at j (http://localhost:8000/test.js:20:19)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: l
Trace:
Error
    at l (http://localhost:8000/test.js:23:19)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: 
Trace:
Error
    at http://localhost:8000/test.js:28:19
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: n
Trace:
Error
    at n (http://localhost:8000/test.js:33:19)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27

func.name: p
Trace:
Error
    at p (http://localhost:8000/test.js:38:19)
    at http://localhost:8000/test.js:47:9
    at Array.reduce (native)
    at http://localhost:8000/test.js:44:27 test.js:42 
```

## SpiderMonkey

```
func.name: 
Trace:
a@http://localhost:8000/test.js:4:5
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: b
Trace:
b@http://localhost:8000/test.js:7:9
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: d
Trace:
d@http://localhost:8000/test.js:10:9
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: 
Trace:
a@http://localhost:8000/test.js:4:5
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: b
Trace:
b@http://localhost:8000/test.js:7:9
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: d
Trace:
d@http://localhost:8000/test.js:10:9
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: 
Trace:
e.i@http://localhost:8000/test.js:17:13
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: j
Trace:
j@http://localhost:8000/test.js:20:13
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: l
Trace:
l@http://localhost:8000/test.js:23:13
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: 
Trace:
m</<@http://localhost:8000/test.js:28:13
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: n
Trace:
n@http://localhost:8000/test.js:33:13
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1

func.name: p
Trace:
p@http://localhost:8000/test.js:38:13
@http://localhost:8000/test.js:47:9
@http://localhost:8000/test.js:54:1 
```

## Chakra

```
func.name: undefined
Trace:
Error
   at a (http://localhost:8000/test.js:4:5)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at b (http://localhost:8000/test.js:7:9)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at d (http://localhost:8000/test.js:10:9)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at a (http://localhost:8000/test.js:4:5)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at b (http://localhost:8000/test.js:7:9)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at d (http://localhost:8000/test.js:10:9)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at e.i (http://localhost:8000/test.js:17:13)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at j (http://localhost:8000/test.js:20:13)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at l (http://localhost:8000/test.js:23:13)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at Anonymous function (http://localhost:8000/test.js:28:13)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at n (http://localhost:8000/test.js:33:13)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1)

func.name: undefined
Trace:
Error
   at p (http://localhost:8000/test.js:38:13)
   at Anonymous function (http://localhost:8000/test.js:47:9)
   at Global code (http://localhost:8000/test.js:42:1) 
```

## Nitro

```
func.name: 
Trace:
a@http://localhost:8000/test.js:4:22
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: b
Trace:
b@http://localhost:8000/test.js:7:26
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: d
Trace:
d@http://localhost:8000/test.js:10:26
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: 
Trace:
a@http://localhost:8000/test.js:4:22
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: b
Trace:
b@http://localhost:8000/test.js:7:26
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: d
Trace:
d@http://localhost:8000/test.js:10:26
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: 
Trace:
i@http://localhost:8000/test.js:17:30
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: j
Trace:
j@http://localhost:8000/test.js:20:30
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: l
Trace:
l@http://localhost:8000/test.js:23:30
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: 
Trace:
http://localhost:8000/test.js:28:30
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: n
Trace:
n@http://localhost:8000/test.js:33:30
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33

func.name: p
Trace:
p@http://localhost:8000/test.js:38:30
http://localhost:8000/test.js:47:13
reduce@[native code]
global code@http://localhost:8000/test.js:44:33 
```

* * *

## 回答 #26

> 赞同：12
> 
> 时间：2015-12-28T20:18:03.510

Both are different ways of defining a function. The difference is how the browser interprets and loads them into an execution context.

The first case is of function expressions which loads only when the interpreter reaches that line of code. So if you do it like the following, you will get an error that the **functionOne is not a function**.

```
functionOne();
var functionOne = function() {
    // Some code
}; 
```

The reason is that on the first line no value is assigned to functionOne, and hence it is undefined. We are trying to call it as a function, and hence we are getting an error.

On the second line we are assigning the reference of an anonymous function to functionOne.

The second case is of function declarations that loads before any code is executed. So if you do like the following you won't get any error as the declaration loads before code execution.

```
functionOne();
function functionOne() {
   // Some code
} 
```

* * *

## 回答 #27

> 赞同：12
> 
> 时间：2016-08-14T09:13:55.987

In JavaScript there are two ways to create functions:

1.  Function declaration:

    ```
    function fn(){
      console.log("Hello");
    }
    fn(); 
    ```

    This is very basic, self-explanatory, used in many languages and standard across C family of languages. We declared a function defined it and executed it by calling it.

    What you should be knowing is that functions are actually objects in JavaScript; internally we have created an object for above function and given it a name called fn or the reference to the object is stored in fn. Functions are objects in JavaScript; an instance of function is actually an object instance.

2.  Function expression:

    ```
    var fn=function(){
      console.log("Hello");
    }
    fn(); 
    ```

    JavaScript has first-class functions, that is, create a function and assign it to a variable just like you create a string or number and assign it to a variable. Here, the fn variable is assigned to a function. The reason for this concept is functions are objects in JavaScript; fn is pointing to the object instance of the above function. We have initialized a function and assigned it to a variable. It's not executing the function and assigning the result.

Reference: *[JavaScript function declaration syntax: var fn = function() {} vs function fn() {}](http://jkoder.com/javascript-function-declaration-syntax-var-fn-function-vs-function-fn/)*

* * *

## 回答 #28

> 赞同：10
> 
> 时间：2017-05-09T13:56:36.270

They are pretty similar with some small differences, first one is a variable which assigned to an anonymous function (Function Declaration) and second one is the normal way to create a function in JavaScript(Anonymous function Declaration), both has usage, cons and pros:

**1\. Function Expression**

```
var functionOne = function() {
    // Some code
}; 
```

> A Function Expression defines a function as a part of a larger expression syntax (typically a variable assignment ). Functions defined via Functions Expressions can be named or anonymous. Function Expressions must not start with “function” (hence the parentheses around the self invoking example below).

Assign a variable to a function, means no Hoisting, as we know functions in JavaScript can Hoist, means they can be called before they get declared, while variables need to be declared before getting access to them, so means in this case we can not access the function before where it's declared, also it could be a way that you write your functions, for the functions which return another function, this kind of declaration could make sense, also in ECMA6 & above you can assign this to an arrow function which can be used to call anonymous functions, also this way of declaring is a better way to create Constructor functions in JavaScript.

**2\. Function Declaration**

```
function functionTwo() {
    // Some code
} 
```

> A Function Declaration defines a named function variable without requiring variable assignment. Function Declarations occur as standalone constructs and cannot be nested within non-function blocks. It’s helpful to think of them as siblings of Variable Declarations. Just as Variable Declarations must start with “var”, Function Declarations must begin with “function”.

This is the normal way of calling a function in JavaScript, this function can be called before you even declare it as in JavaScript all functions get Hoisted, but if you have 'use strict' this won't Hoist as expected, it's a good way to call all normal functions which are not big in lines and neither are a constructor function.

Also, if you need more info about how hoisting works in JavaScript, visit the link below:

[https://developer.mozilla.org/en-US/docs/Glossary/Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)

* * *

## 回答 #29

> 赞同：8
> 
> 时间：2015-06-24T10:08:07.703

This is just two possible ways of declaring functions, and in the second way, you can use the function before declaration.

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2016-05-10T07:05:46.207

`new Function()` can be used to pass the function's body in a string. And hence this can be used to create dynamic functions. Also passing the script without executing the script.

```
var func = new Function("x", "y", "return x*y;");
function secondFunction(){
   var result;
   result = func(10,20);
   console.log ( result );
}

secondFunction() 
```

* * *

## 回答 #31

> 赞同：7
> 
> 时间：2018-12-17T16:58:55.433

The first function syntax is **Anonymous Function Expression**:

```
var functionOne = function() {
  // do something...
}; 
```

While, the second one is **Function Declaration**:

```
function functionTwo () {
  // do something...
} 
```

The main difference between both is the function name, since **Anonymous Functions** have no name to call.

# Named Functions Vs. Anonymous Functions

Anonymous functions are quick and easy to declare, and many libraries and tools tend to encourage this idiomatic style of code. However, anonymous functions have some **drawbacks**:

*   **Readability:** anonymous functions omit a name which could cause less readable code.

*   **Debugging:** anonymous functions have no name in stack traces, which can make debugging more difficult.

*   **Self-Reference:** what if the function needs to refer to itself, for recursion for example.

## Naming Function Expression

Providing a name for your function expression quite effectively addresses all these drawbacks, and has no tangible downsides. The best practice is to always name your function expressions:

```
setTimeout(function timeHandler() { // <-- look, a name here!
  console.log("I've waited 1 second");
}, 1000); 
```

## Naming IIFEs (Immediate Invoked Function Expression)

```
(function IIFE(str) { // <-- look, always name IIFEs!
  console.log(str); // "Hello!"
})('Hello!'); 
```

For functions assigned to a variable, naming the function, in this case, is not very common and may cause confusion, in this case, the arrow function may be a better choice.

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2018-07-14T22:56:13.837

This is called a Function Expression:

```
var getRectArea = function(width, height) {
    return width * height;
};

console.log("Area of Rectangle: " + getRectArea(3,4));
// This should return the following result in the console: 
// Area of Rectangle: 12 
```

This is called a Function Declaration:

```
var w = 5;
var h = 6;

function RectArea(width, height) {  //declaring the function
  return area = width * height;
}                                   //note you do not need ; after }

RectArea(w,h);                      //calling or executing the function
console.log("Area of Rectangle: " + area);
// This should return the following result in the console: 
// Area of Rectangle: 30 
```

Hope this helps explain what is the difference between Function Expression and Function Declaration and how to use them. Thanks.

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2018-03-08T11:49:32.080

I prefer defining function as variable:

```
let first = function(x){
   return x[0];
} 
```

Instead of:

```
function first(){
    ....
} 
```

Because i can use expressions and decorators when defining the function. For example:

```
let safe = function(f){
  try {f()...}
}
let last = safe(function(x){return x[0]}). 
```

Also with ES6 its much shorter:

```
 let last = x => x[0]
 ...........
 function last(x){
     return x[0];
 }
......

let last = safe(x => x[0]); 
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2018-05-15T00:22:23.217

**Expression in JS**: Something that returns a value
Example: Try out following in chrome console:

```
a = 10
output : 10

(1 + 3)
output = 4 
```

**Declaration/Statement**: Something that does not return a value
Example:

```
if (1 > 2) {
 // do something. 
} 
```

here (1>2) is an expression but the 'if' statament is not. Its not returning anything.

Similarly, we have Function Declaration/Statement vs Function Expression
Lets take an example:

```
// test.js

var a = 10;

// function expression
var fun_expression = function() {
   console.log("Running function Expression");
}

// funciton expression

function fun_declaration() {
   console.log("Running function Statement");
} 
```

**Important:** What happens when JavaScript engines runs the above js file.

*   When this js runs following things will happen:

    1.  Memory will be created variable 'a' and 'fun_expression'. And memory will be created for function statement 'fun_declaration'
    2.  'a' will be assigned 'undefined'. 'fun_expression' will be assigned 'undefined'. 'fun_declaration' will be in the memory in its entirety.
        **Note: Step 1 and 2 above are called 'Execution Context - Creation Phase'**.

Now suppose we update the js to.

```
// test.js

console.log(a)  //output: udefined (No error)
console.log(fun_expression)  // output: undefined (No error)
console.log(fun_expression()) // output: Error. As we trying to invoke undefined. 
console.log(fun_declaration()) // output: running function statement  (As fun_declaration is already hoisted in the memory). 

var a = 10;

// function expression
var fun_expression = function() {
   console.log('Running function expression')
}

// function declaration

function fun_declaration() {
   console.log('running function declaration')
}

console.log(a)   // output: 10
console.log(fun_expression()) //output: Running function expression
console.log(fun_declaration()) //output: running function declaration 
```

The output mentioned above in the comments, should be useful to understand the different between function expression and function statement/declaration.

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2018-10-18T18:57:07.977

One important point to note is :-

let there are two functions :-

```
sum(1,2);

const sum = function(first, second) {
  return first + second;
} 
```

In above case, it will give error that sum is not defined, but

```
sum(1,2);

function sum(first, second) {
  return first + second;
} 
```

This function will not any error as [Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting) will take place in this case.

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2019-06-20T10:06:36.403

## Difference function declaration and function expression:

Javascript has first class functions. This means that they can be treated just like any other variable. Functions can be passed as arguments in a function, be returned from a function, **and can be stored in variables**.

However storing function in a variable (**function expression**) isn't the only way to create a function, this can also be done via a **function declaration**. Here are the key differences:

1.  Function expressions can be anonymous whereas a function declaration must have a name.
2.  Both have a name property which is used to identify the function. A function expression's name property is the name of the variable which it is bound to, whereas the name of a function declaration is simply the given name.
3.  Function declarations are hoisted whereas, function expressions are not. Only the variable is hoisted to have the value of `undefined`.

Here is an example:

```
try {
  functionOne();
} catch (e) {
  console.log('i cant run because im not hoisted');
}

functionTwo();

// function expression, does not get hoisted
let functionOne = function randomName() {
    // Some code
};

// function declaration, gets hoisted
function functionTwo() {
   console.log('I get hoisted');
}

try {
  randomName(); // this isn't the proper name, it is functionOne
} catch (e) {
  console.log('You cant call me with randomName my name is function one');
}
```

:

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2019-01-02T06:50:44.900

Another difference between both function is functionOne can be used as a variable that can hold multiple functions within and functionTwo holds some block of code that gets executed all when called. Please check below :

```
 var functionOne = (function() {
      return {

         sayHello: function(){
                console.log('say hello')

         },
         redirectPage:function(_url){
                window.location.href = _url;
         }

      }
})(); 
```

You have a choice which function to be called. e.g functionOne.sayHello or functionOne. redirectPage. And if you call functionTwo then whole block of code will get executed.

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2020-03-03T08:43:56.080

The `var functionOne = function() {}` defines at run-time and the `function functionTwo() {}` defines at parse-time.

```
// Run-Time function declaration 
functionOne(); // Calling functionOne function here will give an Error
var functionOne = function () {
  // Some code
};

// Parse-Time function declaration 
functionTwo(); // Calling functionTwo function will not give an Error
function functionTwo() {
  // Some code...
} 
```

The explanation between Run-time vs Parse-time [javascript run-time vs parse-time](http://khaidoan.wikidot.com/javascript-difference-between-runtime-and-parse-time)

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2020-09-08T21:39:10.127

You can't use the `.bind()` method on function declarations, but you can on function expressions.

Function declaration:

```
function x() {
  console.log(this)
}.bind('string')

x()
```

Function expression:

```
var x = function() {
  console.log(this)
}.bind('string')

x()
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2021-07-31T14:26:01.623

During a breakpoint in the debugger/DevTools, if you use the format `function functionName() {}` in the console, you can't use `functionName()` in the console subsequently (it says "not defined"), whereas after `var functionName = function() {}`, you can use the function.

See [this question](https://stackoverflow.com/a/68602479/5231110).

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2021-10-21T12:33:27.787

```
try {
  console.log("Success: ", add(1, 1));
} catch(e) {
  console.log("ERROR: " + e);
}

var add=function(a, b){
  return a + b;
}
```

# python - 如何在 Python 中实现 AJAX 的最小服务器？

> ID：336866
> 
> 赞同：39
> 
> 时间：2008-12-03T11:37:28.397
> 
> 标签：python, ajax, user-interface

我想为 Python 程序创建一个非常简单的基于 HTML/AJAX 的 GUI。所以前端是一个通过 AJAX 与程序通信的 HTML 页面。你能给我一个使用 python 的服务器端的最小实现`SimpleHTTPServer.SimpleHTTPRequestHandler`吗？

一个简单的例子是一个文本字段和一个按钮。当按下按钮时，该字段的内容被发送到服务器，然后服务器发回相应的答案。我知道 Python 中有很多强大的解决方案，但我想保持这个非常简单。我已经为这样的服务器找到了一些很好的例子（例如[这里](http://msdl.cs.mcgill.ca/people/julien/04Ajax)），但到目前为止我还没有想出一个真正最小的例子。

如果你想知道我为什么要以这种方式实现 GUI：我对这个应用程序的关注是在一个漂亮的布局中显示大量数据，只需要最少的交互 - 所以使用 HTML+CSS 似乎最方便（而且我已经将其用于非交互式数据显示）。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-03T20:01:15.150

好的，我想我现在可以回答我自己的问题了。这是在服务器上计算数字平方的示例实现。如果有任何改进或误解，请告诉我。

python服务器文件：

```
import threading
import webbrowser
import BaseHTTPServer
import SimpleHTTPServer

FILE = 'frontend.html'
PORT = 8080

class TestHandler(SimpleHTTPServer.SimpleHTTPRequestHandler):
    """The test example handler."""

    def do_POST(self):
        """Handle a post request by returning the square of the number."""
        length = int(self.headers.getheader('content-length'))        
        data_string = self.rfile.read(length)
        try:
            result = int(data_string) ** 2
        except:
            result = 'error'
        self.wfile.write(result)

def open_browser():
    """Start a browser after waiting for half a second."""
    def _open_browser():
        webbrowser.open('http://localhost:%s/%s' % (PORT, FILE))
    thread = threading.Timer(0.5, _open_browser)
    thread.start()

def start_server():
    """Start the server."""
    server_address = ("", PORT)
    server = BaseHTTPServer.HTTPServer(server_address, TestHandler)
    server.serve_forever()

if __name__ == "__main__":
    open_browser()
    start_server() 
```

...和 ​​HTML 文件（我称之为“frontend.html”，不幸的是，该名称也必须出现在 JavaScript 代码中）：

```
<html>
<head>
<title>AJAX test</title>
</head>
<body>
<script type="text/javascript">

function xml_http_post(url, data, callback) {
    var req = false;
    try {
        // Firefox, Opera 8.0+, Safari
        req = new XMLHttpRequest();
    }
    catch (e) {
        // Internet Explorer
        try {
            req = new ActiveXObject("Msxml2.XMLHTTP");
        }
        catch (e) {
            try {
                req = new ActiveXObject("Microsoft.XMLHTTP");
            }
            catch (e) {
                alert("Your browser does not support AJAX!");
                return false;
            }
        }
    }
    req.open("POST", url, true);
    req.onreadystatechange = function() {
        if (req.readyState == 4) {
            callback(req);
        }
    }
    req.send(data);
}

function test_button() {
    var data = document.test_form.test_text.value;           
    xml_http_post("frontend.html", data, test_handle)
}

function test_handle(req) {
    var elem = document.getElementById('test_result')
    elem.innerHTML =  req.responseText
}

</script>

<form name=test_form>
sqr(
<input type="text" name="test_text" value="0" size="4">
) =
<span id="test_result">0</span>
<input type=button onClick="test_button();" value="start" title="start">
</form>

</body>
</html> 
```

当然，对 XML 请求使用[jQuery](http://api.jquery.com/jQuery.ajax/)会方便得多，但为了简单起见，我将保持不变。

最后一个使用 WSGI 的替代实现（不幸的是，如果请求不是 POST，我没有看到一种方法可以退回到标准文件服务处理程序）：

```
import threading
import webbrowser
from wsgiref.simple_server import make_server

FILE = 'frontend.html'
PORT = 8080

def test_app(environ, start_response):
    if environ['REQUEST_METHOD'] == 'POST':
        try:
            request_body_size = int(environ['CONTENT_LENGTH'])
            request_body = environ['wsgi.input'].read(request_body_size)
        except (TypeError, ValueError):
            request_body = "0"
        try:
            response_body = str(int(request_body) ** 2)
        except:
            response_body = "error"
        status = '200 OK'
        headers = [('Content-type', 'text/plain')]
        start_response(status, headers)
        return [response_body]
    else:
        response_body = open(FILE).read()
        status = '200 OK'
        headers = [('Content-type', 'text/html'),
                   ('Content-Length', str(len(response_body)))]
        start_response(status, headers)
        return [response_body]

def open_browser():
    """Start a browser after waiting for half a second."""
    def _open_browser():
        webbrowser.open('http://localhost:%s/%s' % (PORT, FILE))
    thread = threading.Timer(0.5, _open_browser)
    thread.start()

def start_server():
    """Start the server."""
    httpd = make_server("", PORT, test_app)
    httpd.serve_forever()

if __name__ == "__main__":
    open_browser()
    start_server() 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-03T11:50:13.503

使用[WSGI 参考实现](https://docs.python.org/2/library/wsgiref.html#module-wsgiref.simple_server)。从长远来看，你会更快乐。

```
from wsgiref.simple_server import make_server, demo_app

httpd = make_server('', 8000, demo_app)
print "Serving HTTP on port 8000..."

# Respond to requests until process is killed
httpd.serve_forever() 
```

demo_app 比较容易写；它处理您的 Ajax 请求。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-10-25T05:36:06.150

这是基于@nikow 示例的 Python 3 的简单示例

我知道这可能有错误，如果你发现它们，请评论它们是什么。

当您单击运行时，代码会发送字符串“I sent you this message”，python 会以“I got it”响应

html代码

（你将不得不为此使用 js 控制台）

```
<body>
<button id="runButton">Run</button>
<script type="text/javascript">
function xml_http_post(url, data) {
var req = new XMLHttpRequest();
req.open("POST", url, true);
req.onreadystatechange = function() {
    if (req.readyState == 4) {
    console.log(req.responseText);
    }
}
req.send(data);
}

function runbuttonfunc() {
    xml_http_post("frontend.html", "I sent you this message")
}

document.getElementById("runButton").onclick = runbuttonfunc;
</script>
</body> 
```

蟒蛇代码：

```
import http.server

FILE = 'frontend.html'
PORT = 8000

class TestHandler(http.server.SimpleHTTPRequestHandler):
    """The test example handler."""

    def do_POST(self):
        """Handle a post request by returning the square of the number."""
        print(self.headers)
        length = int(self.headers.get_all('content-length')[0])
        print(self.headers.get_all('content-length'))
        data_string = self.rfile.read(length)
        print(data_string)
        self.send_response(200)
        self.send_header("Content-type", "text/plain")
        self.end_headers()
        self.flush_headers()
        self.wfile.write("I got it!".encode())

def start_server():
    """Start the server."""
    server_address = ("", PORT)
    server = http.server.HTTPServer(server_address, TestHandler)
    server.serve_forever()

start_server() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-09-23T20:42:27.617

感谢@nikow 提供了一个非常直观的示例，我试图按照您的示例进行操作，但确实遇到了错误：

（进程：10281）：GLib-CRITICAL **：g_slice_set_config：断言'sys_page_size == 0'失败

我修改了您的代码以满足我的需要。

```
webbrowser.open('file:///home/jon/workspace/webpages/frontend_example/%s' % FILE)
// skipped the port part
httpd = make_server("", 8080, test_app)
// hardcoded it here. 
```

我的 html 文件必须放在网络服务器上吗？我还没有把它放在那里！

# java - 您可以从 EntityListeners 访问 EntityManagers 吗？

> ID：336881
> 
> 赞同：4
> 
> 时间：2008-12-03T11:42:40.163
> 
> 标签：java, jpa, jakarta-ee, entitymanager, entitylisteners

我知道 JSR-000220 Enterprise JavaBeans 3.0 Final Release (persistence) 规范指出：

“一般而言，可移植应用程序不应调用 EntityManager 或 Query 操作、访问其他实体实例或修改生命周期回调方法中的关系。”

这看起来非常严格。我们有一种情况，我们想从 EntityListener 中访问 EntityManager。

在 Jboss/Glassfish 或任何其他应用程序服务器上的侦听器中使用 EntityManager 时，是否有人遇到过任何不利影响/缺陷？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-26T18:11:39.037

事实上，你是对的。JPA 规范说明了这一点，在这种情况下，它建议使用 EJB 侦听器（或非 Java EE 环境中的 Spring AOP）。

我不知道你听众的目的。但只在其中放置诸如日志记录、身份验证和路由之类的横切关注点。例如，Hibernate 参考文档使用侦听器来审核所有对象修改的日志。一旦 EJB 侦听器可以使用实体管理器，它就可以由 EJB 侦听器（或非 Java EE 环境中的 Spring AOP）来完成。Java EE 规范允许它。因此，EJB 侦听器共享其目标 EJB 使用的相同 ENC，并且通过这种方式，也共享相同的持久性上下文（实体管理器）。

如果您愿意，请查看我的个人资料。我有很多与 ORM 相关的问题。

问候，

# c# - 如何比较相同但不受约束的泛型类型的两个元素是否相等？

> ID：336884
> 
> 赞同：10
> 
> 时间：2008-12-03T11:44:41.190
> 
> 标签：c#, generics, class, struct, equals

> **可能重复：**
> [不能将运算符 == 应用于 C# 中的泛型类型吗？](https://stackoverflow.com/questions/390900/cant-operator-be-applied-to-generic-types-in-c)

我有以下泛型类，编译器抱怨“ `Operator '!=' cannot be applied to operands of type 'TValue' and 'TValue'`”（参见[CS0019](http://msdn.microsoft.com/en-us/library/a63h61ky.aspx)）：

```
public class Example<TValue>
{
    private TValue _value;
    public TValue Value
    {
        get { return _value; }
        set
        {
            if (_value != value) // <<-- ERROR
            {
                _value= value;
                OnPropertyChanged("Value");
            }
        }
    }
} 
```

如果我限制`TValue`到`class`，我可以使用`Object.Equals()`. 由于我对结构和类都需要这个，但如果我能避免这种情况，我会很高兴。

所以问题是，我如何比较两个相同但不受约束的泛型类型的元素是否相等？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-03T12:02:00.313

你尝试过这样的事情吗？

```
public class Example<TValue>
{
    private TValue _value;
    public TValue Value
    {
        get { return _value; }
        set
        {

            if (!object.Equals(_value, value))
            {
                _value = value;
                OnPropertyChanged("Value");
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-03T12:47:40.003

三个选项：

*   约束 TValue 实现`IEquatable<TValue>`，然后调用`x.Equals(y)`
*   取另一个类型的参数`IEqualityComparer<TValue>`并使用它
*   用于`EqualityComparer<TValue>.Default`执行比较

当然，您总是可以混合和匹配选项 2 和 3 - 默认为默认比较器，但也允许提供特定的比较器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T11:48:26.330

*   值类型的 Equals()
*   ReferenceEquals() 用于引用类型

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T12:39:28.897

IComparable 是一种选择吗？

```
public class Example<TValue> where TValue: IComparable
{
    private TValue _value;
    public TValue Value
    {
        get { return _value; }
        set
        {

            if (_value.CompareTo(value) != 0)
            {
                _value = value;
                OnPropertyChanged("Value");
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T12:39:28.757

我认为`!=`运算符不能在这里应用，因为在某些情况下它不能使用。例如，`!=`不能用于比较结构，除非比较运算符 ( `==` `!=`) 被重载。

当然，您可以比较语言结构，例如`int != int`，但我不确定这是如何实现的。

所以，因为 TValue 可以是*自定义*结构，所以它不能使用`!=`操作符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-14T10:17:20.043

```
public static bool operator ==(EntityBase<T> entity1, EntityBase<T> entity2)
        {
            if ((object)entity1 == null && (object)entity2 == null)
            {
                return true;
            }

            if ((object)entity1 == null || (object)entity2 == null)
            {
                return false;
            }

            if (Comparer<T>.Default.Compare(entity1.Id, entity2.Id) != 0)
            {
                return false;
            }

            return true;
        } 
```

# linq - Linq to Entities, Table per Type 和 Nullable Foreign Key 关系

> ID：336886
> 
> 赞同：7
> 
> 时间：2008-12-03T11:46:45.850
> 
> 标签：linq, entity-framework, linq-to-entities, table-per-type

我正在将 Linq 用于应用[每个类型](http://msdn.microsoft.com/en-us/data/cc765425.aspx)方法的表的实体。到目前为止，这一直进展顺利。我有以下设置：

*   父表
*   子表（从父表继承）
*   大子表（继承自子表）
*   链接表（外键可为空，到子表）

这是数据库图

![替代文字](https://farm4.static.flickr.com/3246/3079069163_287172fb6c_d.jpg)

在上述视频之后，我将 Table Per Type 方法应用于 Linq to 实体在将上述表添加到模型时创建的默认模式。

在按类型应用表之前：

![替代文字](https://farm4.static.flickr.com/3031/3079069195_f444304873_d.jpg)

在每种类型的表之后：

![替代文字](https://farm4.static.flickr.com/3286/3079069111_a8a336c52e_d.jpg)

然后我编译了项目并得到了你可以在上图中看到的错误。为了解决这个问题，我去了外键链接的映射，我添加了 childid 字段，错误消息正在抱怨。

![替代文字](https://farm4.static.flickr.com/3036/3079904138_67b4ebb058_d.jpg)

然后我重新编译并得到另一个错误：

> 从第 147、176 行开始的片段映射问题：具有不同键的两个实体映射到同一行。确保这两个映射片段不会将具有重叠键的两组实体映射到同一组行。

这就是我现在的重点。问题似乎是“LinkingTable”上的“ChildID”为空。如果我将其设置为不可为空，我不会收到上述错误。

我已将上述步骤中使用的数据库和项目保存到[天空驱动器](http://skkurg.bay.livefilestore.com/y1pTY9oTppW7UIrkJnml3yfFNfoUGR7SQqEBbSEqrDiJlaD4GPKsxLipKLhzEsEZ3T22vHecn2Lc5QyhFF75KMOTg/TablePerType.zip?download)。

有谁知道如何解决这个错误？

戴夫

**这是固定代码（感谢 The Gecko）**

前

```
<AssociationSetMapping Name="FK_LinkingTable_Child"
    TypeName="TablePerTypeModel.FK_LinkingTable_Child" 
    StoreEntitySet="LinkingTable">
    <EndProperty Name="Child">
        <ScalarProperty Name="Id" ColumnName="ChildID" />
    </EndProperty>
    <EndProperty Name="LinkingTable">
        <ScalarProperty Name="LinkTableID" ColumnName="LinkTableID" />
    </EndProperty>
</AssociationSetMapping> 
```

后

```
<AssociationSetMapping Name="FK_LinkingTable_Child"
    TypeName="TablePerTypeModel.FK_LinkingTable_Child" 
    StoreEntitySet="LinkingTable">
    <EndProperty Name="Child">
        <ScalarProperty Name="Id" ColumnName="ChildID" />
    </EndProperty>
    <EndProperty Name="LinkingTable">
        <ScalarProperty Name="LinkTableID" ColumnName="LinkTableID" />
    </EndProperty>
    <Condition ColumnName="ChildID" IsNull="false"/>
</AssociationSetMapping> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T12:45:20.663

尝试更新 EDMX 文件的 Mapping 部分中的 AssociationMapping 节点以包含允许空值的条件。

例如

```
<AssociationSetMapping>
  ...
  <Condition ColumnName="" IsNull="false"/>
</AssociationSetMapping> 
```

# vb.net - 为什么捕获异常只是为了再次抛出它？

> ID：336897
> 
> 赞同：14
> 
> 时间：2008-12-03T11:52:46.883
> 
> 标签：vb.net, web-services, exception, exception-handling

在网络服务中，我看到以下代码：

```
<WebMethod()> _
Public Function dosomething() As Boolean
    Try
        If successful Then
            Return True
        Else
            Return False
        End If
    Catch ex As Exception
        Throw ex
    End Try
End Function 
```

捕获异常并再次抛出它有什么意义？我错过了什么吗？

编辑：感谢您的回答！我认为它是这样的，但不确定我是否可以/是否会在没有任何影响的情况下将它们重构掉。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-12-03T12:02:25.290

**不要这样做。**

如果您绝对需要重新抛出异常，只需使用`throw;`using`throw ex;`擦除堆栈跟踪，这是绝对错误的。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-03T11:55:52.477

我想不出任何理由为功能这样做。但是，如果以前删除了一些错误处理（通常是日志记录），并且开发人员删除了日志处理但没有重组代码以删除冗余的 try/catch，则可能会出现这种情况。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-03T11:58:55.843

可能是调试遗留下来的一些代码（你会在 throw 上设置一个断点，这样你就可以在调试器中检查异常）。如果我想记录异常然后将其传递到链上，我可能会做类似的事情，尽管我可能会将异常包装在另一个带有更有意义（对我的应用程序）错误消息的异常中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-03T12:30:28.447

我可以看到其中使用的架构[（设计模式）](http://blogs.msdn.com/jaredpar/archive/2008/10/20/custom-exceptions-when-should-you-create-them.aspx)之一是处理事务的地方。该函数完成它的工作，失败，catch 块将事务完成到一个已知状态（通常是回滚），然后抛出一个用户定义的异常。

就目前而言，将代码重构为更理智的状态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-06-09T21:13:20.903

不仅 try/catch 毫无意义，IF 也是如此。整个函数可以简化为一行：

```
return successful 
```

在这一点上，为什么要打扰？为什么不只是测试“成功”而不是调用函数呢？

好吧，它是一个 Web 方法，我猜你需要这个函数只是为了给 Ajax 或任何人一个句柄。

（是的，我知道我的答案晚了 7 年。我在搜索完全不相关的东西时偶然发现了这个。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-05-20T12:43:20.940

Monitor 的模式使得这很可能会重新引发错误，因为您需要 finally 来确保调用 Monitor.Exit

[https://msdn.microsoft.com/en-us/library/4tssbxcw(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/4tssbxcw(v=vs.110).aspx)

```
Dim lockObj As New Object()

If Monitor.TryEnter(lockObj) Then
    Try
        ' The critical section.
    Catch
       throw
    Finally
       ' Ensure that the lock is released.
       Monitor.Exit(lockObj)
    End Try
End If 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-08-09T14:25:28.703

来自 Microsoft 的 CodeAnalysis：（CA2200：重新抛出以保留堆栈详细信息）

“一旦抛出异常，它携带的部分信息就是堆栈跟踪。堆栈跟踪是方法调用层次结构的列表，以引发异常的方法开始，以捕获异常的方法结束。如果通过在 throw 语句中指定异常来重新抛出异常，堆栈跟踪在当前方法处重新开始，并且在引发异常的原始方法和当前方法之间的方法调用列表丢失。要保留原始堆栈跟踪有异常的信息，使用 throw 语句而不指定异常。”

```
 Sub CatchAndRethrowImplicitly()
     Try
        ThrowException()
     Catch e As ArithmeticException
        ' Satisfies the rule.
        Throw
     End Try
  End Sub 
```

[https://docs.microsoft.com/en-us/visualstudio/code-quality/ca2200-rethrow-to-preserve-stack-details?view=vs-2019](https://docs.microsoft.com/en-us/visualstudio/code-quality/ca2200-rethrow-to-preserve-stack-details?view=vs-2019)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-02-06T18:48:51.167

这样做有很好的理由，尤其是在全栈/N 层环境中。

在您的类库中尝试/捕获您的代码、记录异常并将其扔回调用应用程序以允许调用者以它想要的方式处理异常是有意义的。

请记住，在全栈环境中，栈应该是独立的，并且不知道彼此的内部功能，同样，它们不应该假设知道栈在其外部想要处理捕获的异常的方式。实时处理异常然后将其传递给调用者是一件非常有帮助的事情。

并且始终只使用“Throw”，而不是“Throw ex”。Throw 将重新抛出句柄异常，保持堆栈完整。

* * *

## 回答 #9

> 赞同：-9
> 
> 时间：2008-12-03T12:13:41.927

如果您想捕获除子类之外的异常，您可能想要这样做。

例如，

```
try {
    // Something stupid
}
catch(RuntimeException e) {
    throw e; //Handle it outside
}
catch (Exception e) {
    // I'm dead
} 
```

# acrobat - AxAcroPDFLib.AxAcroPDF.LoadFile 更改？

> ID：336898
> 
> 赞同：2
> 
> 时间：2008-12-03T11:54:01.233
> 
> 标签：acrobat, axacropdf

我制作了一个 Windows 客户端应用程序，在其中使用 AxAcroPDF 控件在表单上显示 pdf 文件。

在我看来，在我将 Acrobat 阅读器从版本 8 升级到版本 9 后，LoadFile 方法在文件正确打开时返回 true，而版本 8 返回 false。这是一个正确的观察吗？

最好的问候，克里姆森

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-11T18:25:54.897

我意识到这个线程有点老了，但我做了同样的观察，我不得不为 9.0 版本更改我的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-29T14:23:41.953

LoadFile 成功返回 -1，失败返回 0。这可以在[Acrobat 9 的文档中](http://livedocs.adobe.com/acrobat_sdk/9.1/Acrobat9_1_HTMLHelp/IAC_API_OLE_Objects.103.175.html)找到。我找不到版本 8 的在线参考，但我从 Adob​​e 下载了它，它是一样的。你使用什么编程语言？你有一些示例代码吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T17:23:53.043

一点也不！Acrobat 的版本不会影响 AxAcroPDF 控件的工作方式。你必须调试看看会发生什么

# c# - 如何在虚拟模式下异步填充 ListView？

> ID：336901
> 
> 赞同：4
> 
> 时间：2008-12-03T11:55:37.690
> 
> 标签：c#, winforms, listview, asynchronous, virtualmode

我想在列表视图中显示我们数据库中的记录 - 但检索可能需要很长时间。我可以使用 RetrieveVirtualItem 告诉我何时需要新的 ListViewItem，添加一个虚拟项目，然后开始检索；但是当数据库返回记录时我该怎么办？当 ListView 处于 VirtualMode 时，我无法更新 ListView 的 Items 集合。有没有办法告诉 ListView 重新加载项目？或者我可以只保留对 ListViewItem 的引用并填充它吗？如果这些都不起作用，我还能如何在虚拟模式下异步填充 ListView？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-03T15:45:48.817

当 ListView 需要更新时，将调用您的 RetrieveVirtualItem 处理程序。如果您的数据尚不可用并且您不能等待，那么您将不得不创建一个虚拟项目（不处理 RetrieveVirtualItem 将引发异常）。

数据准备好后，您可以使控件无效 - 这将为每个可见项再次调用 RetrieveVirtualItem。作为使整个控件无效的替代方法，您可以使用 ListView 控件的 RedrawItems 方法来控制要重绘的项目，该方法在虚拟和常规模式下工作：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.redrawitems.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.redrawitems.aspx)

如果需要一段时间，听起来可能值得分批下载您的记录。此外，如果您的数据库操作很昂贵，那么值得研究缓存您的 ListItems（您需要处理一个 CacheVirtualItems 事件）：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.cachevirtualitems.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.cachevirtualitems.aspx)

我希望这有帮助。

# windows - Windows 模拟 UNIX atoh() 函数

> ID：336903
> 
> 赞同：4
> 
> 时间：2008-12-03T11:57:25.657
> 
> 标签：windows, mfc

Windows API 或 MFC 中是否有任何类似的`atoh()`功能？

`atoh()`将包含十六进制数字的字符串转换为无符号数字，例如

```
unsigned x = atoh("A"); 
```

操作后 x = 10。

在 Windows 中，我有一个 CString，包含“A”。如何将其转换为 int？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T12:01:24.043

```
long x = strtoul("A", (char **) NULL, 16);
// x will be 10 decimal 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T12:00:36.883

`unsigned long ten = [strtoul("a", NULL, 16)](http://msdn.microsoft.com/en-us/library/5k9xb7x1(VS.80).aspx);`应该处理它，如果你能从 CString 中得到一个普通的旧`char *`-representation。接受的解决方案使用`strtoul()`进行签名转换。

# regex - 匹配两个原子的有效grep方法？

> ID：336909
> 
> 赞同：3
> 
> 时间：2008-12-03T12:01:22.903
> 
> 标签：regex, grep

我正在寻找一种方法来 grep 多个原子，例如“foo”和“bar”。我知道我可以用
`grep 'foo' file | grep 'bar'`
它们来获得它们，但我想知道是否有更有效的方法。任何谷歌搜索似乎都只会抛出基于“或”的搜索结果，而不是“和”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T12:21:46.700

我怀疑你会得到比你选择的更有效的方法。鉴于 grep 可执行文件在第二个副本运行时已经映射到内存中，并且您的正则表达式中没有回溯（与`egrep 'foo.*bar|bar.*foo'`明显的解决方案不同），我认为您将获得的速度很快。

以下是一些示例时序来说明这一点：

```
allan@allan-desktop:~$ time egrep 'foo.*bar|bar.*foo' foobar | wc -l
2000
real 0m0.006s
user 0m0.004s
sys  0m0.004s

allan@allan-desktop:~$ time fgrep 'foo' foobar | fgrep 'bar' | wc -l
2000
real 0m0.039s
user 0m0.000s
sys  0m0.000s

allan@allan-desktop:~$ time egrep 'foo.*bar|bar.*foo' foobar | wc -l
2000
real 0m0.006s
user 0m0.004s
sys  0m0.008s

allan@allan-desktop:~$ time fgrep 'foo' foobar | fgrep 'bar' | wc -l
2000
real 0m0.005s
user 0m0.004s
sys  0m0.004s 
```

从这个公认的小样本中，流水线版本占用的系统和用户 CPU 时间更少，因此效率更高。

输入文件包含 1000 个副本：

```
foo-bar
bar-dgfjhdgjhdgdfgdjghdjghdfg-foo 
```

所以你可以运行自己的测试。

她的同样的测试有 100,000 行输入 - 你可以看到提问者方法更有效：

```
allan@allan-desktop:~$ time egrep 'foo.*bar|bar.*foo' foobar | wc -l
    100000
    real 0m0.135s
    user 0m0.136s
    sys  0m0.012s
allan@allan-desktop:~$ time fgrep 'foo' foobar | fgrep 'bar' | wc -l
    100000
    real 0m0.034s
    user 0m0.048s
    sys  0m0.012s
allan@allan-desktop:~$ time egrep 'foo.*bar|bar.*foo' foobar | wc -l
    100000
    real 0m0.151s
    user 0m0.144s
    sys  0m0.000s
allan@allan-desktop:~$ time fgrep 'foo' foobar | fgrep 'bar' | wc -l
    100000
    real 0m0.046s
    user 0m0.044s
    sys  0m0.012s 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T12:08:14.700

```
egrep '(foo.*bar|bar.*foo)'
# or
grep -E '(foo.*bar|bar.*foo)' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T12:09:24.637

这可能是有效的。:)`grep`由于文件系统级别的缓存，再次加载可能是免费的。并且，假设命中数很小（与输入行数相比），并且大多数包含 'foo' 的行也将成为 'bar' 的命中数，第二个实例`grep`不会有很多做。

# javascript - css页面问题

> ID：336919
> 
> 赞同：0
> 
> 时间：2008-12-03T12:07:59.270
> 
> 标签：javascript, html, css

我在下面粘贴的代码旨在在没有文本的中间 2 个链接上显示图像，然后在重置和第四个链接上返回文本。我只为 span 标签设置了 display:none，但它什么也没做。无论如何，不​​使用框架就可以简单地做我想做的事情吗？

编辑：示例

```
<html>
    <head>
        <style type="text/css">
                .class1{color:#000; background-image:url('1.jpg');}
        .class1 span { display: none;}
                .class2{color:#00f; background-image:url('2.jpg');}
        .class2 span { display: none;}
                .class3{color:#0f0; background-image:url('1.jpg');}
        .class3 span { display: none;}
                .class4{color:#f00;}

        </style>
    </head>
    <body>
        <script type="text/javascript">
                function sbox(divid, classname)
                {
                        document.getElementById(divid).className=classname;
                 }
        </script>
        <div>
        <a href="#" onclick="sbox('div1','class1');return false;">Reset</a><br/>
                <a href="#" onclick="sbox('div1','class2');return false;">try here</a><br/>
                <a href="#" onclick="sbox('div1','class3'); return false;">or here</a><br/>
                <a href="#" onclick="sbox('div1','class4');return false;">or maybe here</a>
        </div>
        <div id="div1" class="class4"><span id="div1_text">Blah blah blah</span></div>
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T12:16:06.587

该`rel`属性应该描述链接与当前文档的关系。它应该具有[此处](http://www.w3.org/TR/html401/types.html#type-links)描述的值之一。DIV 是块级分组元素，而 SPAN 是内联分组元素。SPAN 允许您出于某种目的（常见样式等）将文本和标签组合在一起，而无需更改标记流。

**编辑：**这个问题从我下面改变了，所以上面的内容似乎真的与当前的上下文脱节了。

你需要按照@llandril 说的做，给 DIV 一些大小。我建议给 DIV 提供固定的宽度和高度——无论是始终还是在使用显示图像的类之一时。如果要显示整个内容，请使用背景图像的宽度和高度。你可能还需要给它一些内容，但我不这么认为。

我想这就是 class1 的样子。我没有测试过这个。

```
 /* in case color needs to apply to other elements */
    .class1 { color: #000; }

    div .class1 {
        background-image:url('1.jpg');
        width: 60px;
        height: 30px;
    }

    div .class1 span { display: none;} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T12:22:32.347

div 标签包含一个内容块。span 标签类似，但包含内联内容。不同之处？您可以使用 span 来设置段落内的短语样式，但 div 可以包装该段落并将其与其他段落分开。对于 div，请参见[this](http://www.w3schools.com/tags/tag_DIV.asp) ，对于 spans ，请参见[this 。](http://www.w3schools.com/tags/tag_span.asp)

经过一些评论：这是[从马的嘴里说的：](http://www.w3.org/TR/REC-html40/struct/global.html#h-7.5.4)

> DIV 和 SPAN 元素与 id 和 class 属性一起，提供了一种向文档添加结构的通用机制。这些元素将内容定义为内联 (SPAN) 或块级 (DIV)，但不会对内容强加其他表现形式。因此，作者可以将这些元素与样式表、语言属性等结合使用，以根据自己的需要和品味来定制 HTML。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T12:20:30.947

rel 属性通常不被许多 UA（用户代理）使用，但它指定链接页面与当前页面的关系。

某些伪标准已经出现在这个地方，例如 Mozilla 使用[预取关系](http://simonwillison.net/2002/Oct/17/mozillaPrefetching/)来预加载页面。Google 将 [用于设置？] 它的前几个结果设置为以这种方式预取，因此这些页面应该加载得更快。

其他示例是基于浏览器的导航栏（例如，Opera 有其中之一）带有指向下一个、上一个、内容页面等的链接。这也适用于`<link>`元素

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T12:25:10.983

`rel`也可用于描述其他语义，请参阅[microformats rel 文档](http://microformats.org/wiki/rel)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T13:04:15.540

通常，属性 rel 和 rev 分别描述前向和后向链接。例如，在列表分页中，您可以使用`<a href="..." rel="next">Next</a>`和`<a href="..." rev="prev">Prev</a>`

有关您可以使用的一些值，请参阅[http://www.w3.org/TR/html401/types.html#type-links](http://www.w3.org/TR/html401/types.html#type-links)。

其他人已经解释了 span/div 标签。实际上使用 span 标签的情况并不多，因为您通常可以根据上下文使用短语元素，如`em`, `strong`,等。`code`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T15:18:17.703

DIV 不显示背景图像，因为当您的跨度消失时它没有任何内容。

在 span 之后添加一个不间断空格 ( ) 将为其提供内容。

# jquery - 如果开发人员试图利用 jQuery 的精华，仍然使用 ThickBox 3.1

> ID：336922
> 
> 赞同：0
> 
> 时间：2008-12-03T12:08:31.423
> 
> 标签：jquery, thickbox

这仍然是推荐使用的库吗？厚盒 3.1

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T13:08:46.857

取决于您的具体需求，但就我而言，我对它大多不满意，发现代码写得不好（至少 wrt/ 可用的 jQuery 插件 API），并且不会推荐它。我目前正在测试 nyroModal，虽然它有点偏重，但看起来更有希望。但是YMMV当然...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T16:28:51.053

我一直在使用[BlockUI](http://www.malsup.com/jquery/block/ "块UI")，但其他人似乎喜欢[jqModal](http://dev.iceburg.net/jquery/jqModal/ "jq模态")

# css - 自定义光标图像 CSS

> ID：336925
> 
> 赞同：35
> 
> 时间：2008-12-03T12:09:04.200
> 
> 标签：css, firefox, mouse-cursor

我有许多 heroshot 图像，单击时会弹出模式。我试图让光标在图像上移动时变成放大镜。`magnify.cur`即使 my出现在正确的位置，以下 CSS 似乎也不起作用。

```
a.heroshot img {
  cursor:url(/img/magnify.cur), pointer;
} 
```

有没有人做过类似的事情？如果存在 JavaScript 解决方案，我不介意。

**编辑**：它适用于 Safari，但不适用于 Firefox。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-03T14:23:52.867

您的问题可能是光标 URL 在 Firefox for Mac 中不起作用。

`-moz-zoom-in`您可以通过使用关键字在 Firefox 上获得相同的效果。

```
cursor:url(/img/magnify.cur), -moz-zoom-in, auto; 
```

这将显示 magnify.cur、Mozilla 特定的缩放光标或系统默认光标。使用浏览器支持的列表上的第一个光标。

您还可以查看不同浏览器支持[的光标关键字列表。](http://www.worldtimzone.com/mozilla/testcase/css3cursors.html)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-08T17:12:10.307

这成功了:)

```
a.heroshot img {
cursor:url(/img/layout/backgrounds/moz-zoom.gif), -moz-zoom-in;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-05-30T16:10:14.827

**更新：**现在大多数浏览器都支持放大图标，所以你可以使用这个 CSS：

```
cursor: -webkit-zoom-in;
cursor: -moz-zoom-in;
cursor: zoom-in; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T12:12:10.183

如果用撇号括起来 url 字符串怎么办？

```
a.heroshot img {
cursor:url('/img/magnify.cur'), pointer;
} 
```

另见[http://www.w3schools.com/CSS/pr_class_cursor.asp](http://www.w3schools.com/CSS/pr_class_cursor.asp)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-06-20T21:24:22.607

（基于 Kevin Borders 的回应）

正确的后备顺序如下

```
a.heroshot img {
    cursor: url(/img/zoom_in.png), url(/img/zoom_in.cur), pointer;  
    cursor: url(/img/zoom_in.png), -moz-zoom-in;  
    cursor: url(/img/zoom_in.png), -webkit-zoom-in;
} 
```

测试：Firefox 47、Chrome 51、Opera 36、Edge 13 和 IE11。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-02-28T09:21:34.960

我的侧 url 属性以下列方式为光标工作

```
 #myid{cursor:url('myimage.png') , auto} 
```

但在这里我认为图像大小问题。因为如果我使用 32*32 或以下尺寸，那么这将完美运行。

自定义光标的 URL 的逗号分隔列表。注意：始终在列表末尾指定一个通用游标，以防没有任何 URL 定义的游标可以使用

```
 #myid{cursor:url('myimage.png') , auto}
 #myid{cursor:url('myimage.png') ,url('myimage2.gif') , auto} etc 
```

如果你只放这个，那它就行不通了

```
 #myid{cursor:url('myimage.png')} 
```

# ruby - 为什么在 Ruby 中包含模块的顺序会有所不同？

> ID：336929
> 
> 赞同：1
> 
> 时间：2008-12-03T12:10:49.827
> 
> 标签：ruby, include, module

这个问题最好用一个代码示例来概括：

```
module TestOne
  module Foo
    def foo
      42
    end
  end

  module Bar
    include Foo
  end

  class Quux
    include Bar
  end
end

TestOne::Bar.ancestors # => [TestOne::Bar, TestOne::Foo]
TestOne::Quux.ancestors # => [TestOne::Quux, TestOne::Bar, TestOne::Foo, Object, Kernel]
TestOne::Quux.new.foo # => 42

module TestTwo
  class Quux
  end

  module Bar
  end

  module Foo
    def foo
      42
    end
  end
end

TestTwo::Quux.send :include, TestTwo::Bar
TestTwo::Bar.send :include, TestTwo::Foo

TestTwo::Bar.ancestors # => [TestTwo::Bar, TestTwo::Foo]
TestTwo::Quux.ancestors # => [TestTwo::Quux, TestTwo::Bar, Object, Kernel]
TestTwo::Quux.new.foo # => 
# ~> -:40: undefined method `foo' for #<TestTwo::Quux:0x24054> (NoMethodError) 
```

我认为当你包含一个模块（例如`Bar`在一个类`Foo`中）时，Ruby 存储的所有内容都是`Foo`包含`Bar`. 因此，当您在 Foo 上调用方法时，它会查找`Bar`该方法。

如果那是真的，那么到`TestTwo::Quux.new.foo`被调用的时候，我已经把这个`foo`方法混入了`TestTwo::Bar`，所以它应该可以工作，对吧？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T13:23:09.993

文档说[append_features](http://www.ruby-doc.org/core/classes/Module.html#M001659)（由 include 调用）将方法混合到调用者中。因此，当`TestTwo::Quux`包含时`TestTwo::Bar`，不会将任何方法添加到`TestTwo::Quux`. 下一行将方法添加到`TestTwo::Bar`，但不添加到`TestTwo::Quux`。

# asp.net - 如何在 ASP NET2.0 中实现 OpenID 功能

> ID：336936
> 
> 赞同：1
> 
> 时间：2008-12-03T12:15:38.413
> 
> 标签：asp.net, openid

如何`OpenID`在 ASP NET2.0 中实现功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T12:47:28.147

看起来这里有一些 .NET 选项：[http ://wiki.openid.net/Libraries](http://wiki.openid.net/Libraries)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T18:44:53.853

您还可以使用 RPX [http://rpxnow.com](http://rpxnow.com)。该服务将允许您接受 OpenID、Facebook 和 MySpace。您的应用程序需要能够发出 https 调用，并能够解析 xml 或 json 响应。

# mobile - 在 Symbian S60 移动设备上发起 SIP 呼叫

> ID：336937
> 
> 赞同：2
> 
> 时间：2008-12-03T12:15:57.943
> 
> 标签：mobile, symbian, voip, sip, s60

我正在寻找一种在 S60 Symbian 手机上使用 SIP 堆栈以编程方式启动 VOIP 呼叫的方法。

一些较新的 S60 设备具有内置的 SIP 客户端。是否也可以使用这些设备上的某些 S60 库访问 SIP 堆栈。或者有人知道可以在 S60 上使用的外部 SIP 堆栈吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T08:30:04.773

拨打VoIP电话的API**不需要**特殊的访问权限，您只需下载SDK插件API即可。有关详细信息，请参阅[http://wiki.forum.nokia.com/index.php/Utilizing_Nokia_VoIP_Client](http://wiki.forum.nokia.com/index.php/Utilizing_Nokia_VoIP_Client)。

请注意，某些设备（例如某些 Vodafone N95 变体）具有 SIP 堆栈，但没有附加的 Internet 电话库。在这些设备上，您将无法通过上述链接中详述的 API 进行调用。（互联网电话远不止 SIP - RTP、RTCP、SDP、设备上的音频处理等）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T18:21:53.073

这些 API 需要特殊访问权限，但[这里](http://nds2.content.mosh.nokia.com/entity/6/4452B13D5F854A8DE040050A45306C1B/Developing_3rd_party_VoIP_clients_on_S60_platform_v1_0_en.pdf?c=m&type=6)有一些关于它们的文档。

# php - 没有图像，也没有弹出窗口

> ID：336942
> 
> 赞同：0
> 
> 时间：2008-12-03T12:18:23.680
> 
> 标签：php, javascript, html, ajax

我有一个 ajax 应用程序，它不会显示图像，也不会从存储在文件中的 html 制作弹出窗口。

这是我用于弹出窗口的代码：

```
echo '<script> 
function makewindows(){
child1 = window.open ("about:blank");
child1.document.write(' . json_encode($row2["ARTICLE_DESC"]) . ');
child1.document.close(); 
}
</script>'; 
```

以及生成的 html

```
<script> 
function makewindows(){
child1 = window.open ("about:blank");
child1.document.write("<!-- +++++++++++++++++++++++++ Bitte \u00e4ndern Sie im eigenen Interesse nichts an diesem Code! ++++++++++++++++++++++++ -->\n<!-- +++++++++++++++++++++++++ Das kann massive Fehldarstellungen ihrer Auktion zur Folge haben! +++++++++++++++++++ -->\n<!-- +++++++++++++++++++++++++ ++++++++++++++++++++++++++ Ihr Supreme Team +++++++++++++++++++++++++++++++++++++++++ -->\n");
child1.document.close(); 
}
</script><br />
<b>Notice</b>:  Undefined index:  CATEGORY in <b>C:\Programme\EasyPHP 2.0b1\www\get_auction.php</b> on line <b>39</b><br />
<div id='leftlayer'>
    <strong>Article Number</strong> 220288560247
    <p><strong>Article Name</strong></p> Ed Hardy Herren Shirt Rock & Roll Weiss XXL Neu & OVP
    <p><strong>Subtitle</strong></p> 
    <p><strong>Username</strong></p> fashionticker1
    <p><strong>Total Selling</strong></p> 1
    <p><strong>Total Sold</strong></p> 0
    <p><strong>Category</strong></p> 
    <p><strong>Highest Bidder</strong></p> 0
  </div>
<div class='leftlayer2'>
  <strong>Current Bid</strong> 0.00
  <p><strong>Start Price</strong></p> 49.00
  <p><strong>Buyitnow Price</strong></p> 59.00
  <p><strong>Bid Count</strong></p> 0
  <p><strong>Start Date</strong></p> 1.10.2008 16:22:09
  <p><strong>End Date</strong></p> 6.10.2008 16:22:09
  <p><strong>Original End</strong></p> 6.10.2008 16:22:09
  <p><strong>Auction Type</strong></p> 1
</div>
<div class='leftlayer2'>
    <strong>Private Auction</strong></p> 0
  <p><strong>Paypal Accepted</strong></p> 0
  <p><strong>Auction Watched</strong></p> 0
  <p><strong>Finished</strong></p> 1
  <p><strong>Country</strong></p> 
<br>
<br>
<style ty
  <p><strong>Location</strong></p> float: right;

  <p><strong>Conditions</strong></p> margin: 0px;

</div>
<div class='leftlayer2'>
  <strong>Auction Revised</strong></p> 0
  <p><strong>Cancelled</strong></p> 0
  <p><strong>Shipping to</strong></p> padding:5px; 

  <p><strong>Fee Insertion</strong></p> 0.00
  <p><strong>Fee Final</strong></p> 0.00
  <p><strong>Fee Listing</strong></p> 0.00
  <p><a href='#' onclick='makewindows(); return false;'>Click for full description </a></p>
</div><div id='rightlayer'>Picture Picture
<img src=http://storage.supremeauction.com/flash/ebay2/10/49/76/10497654/13895964e.jpg>
</div> 
```

img src 是一个有效位置，可以在浏览器中正常打开，但不会显示在页面中。我收到一个没有说明任何细节的脚本错误。

编辑：单独调用文件时，而不是作为应用程序的一部分，生成的 html 文件会生成一个链接，该链接会创建一个弹出窗口，但源代码显示没有分配给该窗口：

```
child1.document.write(""); 
```

我对 img src 行进行了更改：

```
<img src='".$lastImg."'> 
```

这导致html返回：

```
<img src=''> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T13:02:37.523

你真的需要 Firefox/Firebug 来帮助调试它。您的脚本错误可能导致页面停止加载，因此您的图像未显示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T14:30:18.110

Your HTML looks invalid - you have:

```
<style ty
  <p><strong>Location</strong></p> float: right;

  <p><strong>Conditions</strong></p> margin: 0px; 
```

Firstly the `<style>` tag is not closed (1\. the opening tag is not even complete and 2\. you don't have a closing tag) - when I look at the HTML using Firefox/Firebug, it is treating the rest of the HTML as being within that tag and therefore not displaying it.

Also you have style declarations like `float: right;` mixed within the HTML and not within a style tag.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T14:11:25.917

If you carry this response through Ajax using innerHTML substitution it won't work. You need to parse the `<script>...</script>` in callback and `eval()` it.

And in general, you should be using some decent PHP framework on server side and Javascript library on client side. Otherwise you will soon start rewriting your program from scratch to clean it up, just to find out that it's hardly any better.

# mysql - MySQL 刷新表 - 当前数据库或每个数据库？

> ID：336946
> 
> 赞同：19
> 
> 时间：2008-12-03T12:21:40.477
> 
> 标签：mysql

MySQL命令是否：

```
FLUSH TABLES; 
```

刷新当前数据库中的每个表，还是服务器上的每个表？

我正在使用 MySQL 5.0 - [文档](http://dev.mysql.com/doc/refman/5.0/en/flush.html)不清楚，尽管它确实提到：

```
FLUSH TABLES WITH READ LOCK; 
```

将为所有数据库这样做。

谢谢。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-04T20:05:48.293

都是数据库。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-04T17:22:56.360

我试图查找这个，但我也找不到权威的答案。

*   我和你一样看了手册。
*   我在 上找到了 MySQL Internals 文档[`FLUSH TABLES`](http://forge.mysql.com/wiki/MySQL_Internals_Algorithms#How_MySQL_Handles_FLUSH_TABLES)，但没有具体说明。
*   我什至阅读了源代码，`mysql_server/sql/sql_base.cc`但无法快速找到答案。

我认为答案是开发人员认为显而易见的事情之一，他们永远不需要说出来。

根据内部文档，MySQL 表缓存包含最近使用的表的列表。没有提到特定于数据库的表缓存，MySQL Server 中似乎只有一个表缓存。

`FLUSH TABLES`被描述为强制关闭所有打开的表（表缓存中的那些）。没有提到这仅限于一个数据库，但您可以在`FLUSH TABLES`. 同样，我假设默认情况下这适用于整个表缓存，因此适用于 MySQL 服务器上具有打开文件的所有数据库。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-04T13:46:35.327

例如，当您只执行 mysql_connect 然后“显示表”时-> mysql_error(): No Database selected

使用“刷新表”没有 mysql_error，所以我认为答案是每个数据库

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-12-16T15:17:14.600

`FLUSH TABLES`对所有数据库都执行此操作，除非您一一指定表。

语法是：

```
FLUSH TABLES tbl_name [, tbl_name] ... 
```

与`READ LOCK`：

```
FLUSH TABLES tbl_name [, tbl_name] ... WITH READ LOCK 
```

并包含数据库中的所有表，您可以获得查询`SHOW TABLES`以显示所选数据库中的所有表。所以通过一些编辑，查询将是这样的：

```
FLUSH TABLES db_name.table_1, 
             db_name.table_2,
             db_name.table_3,
             ... 
```

# javascript - 使用 RegisterStartupScript() 添加的脚本何时执行？

> ID：336948
> 
> 赞同：2
> 
> 时间：2008-12-03T12:22:16.280
> 
> 标签：javascript, .net, dom, dom-events

使用[Page.ClientScript.RegisterStartupScript()](http://msdn.microsoft.com/en-us/library/system.web.ui.clientscriptmanager.registerstartupscript.aspx)添加到页面的脚本何时实际运行？MSDN 声明“当页面完成加载但在`OnLoad`引发页面事件之前”，但这并没有太多细节。

例如，添加的脚本是否可以`RegisterStartupScript`假设 DOM 树已经构建？不同浏览器实现之间的行为是否不同？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T12:41:29.890

启动脚本被添加到标记的底部。因此，它们会在标记加载时自动处理。我猜这的确切实现取决于浏览器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-09T01:36:57.783

执行启动脚本时应该构建 DOM 树。

# asp.net - 如何重定向到同一服务器中的另一个 Web 应用程序？

> ID：336953
> 
> 赞同：1
> 
> 时间：2008-12-03T12:25:20.843
> 
> 标签：asp.net

我在同一台服务器上有两个 Web 应用程序，如下所示：

```
/basedir/app1path/default1.aspx

/basedir/app2path/default2.aspx 
```

如何将表单重定向`default1.aspx`到`default2.aspx`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T12:30:08.540

在代码隐藏中：

```
Response.Redirect("/basedir/app2path/default2.aspx", false); 
```

（`false`防止`ThreadAbortException`被重定向抛出）

还是使用 301 服务器重定向？

# c# - 在数据库中存储类和程序集名称有多糟糕？

> ID：336958
> 
> 赞同：4
> 
> 时间：2008-12-03T12:31:55.963
> 
> 标签：c#, .net, database

**简单来说：**

将程序集名称和类名称存储在数据库中是否可以原谅？它是否打破了数据层的应用程序层以明确了解业务层的内部？

**完整解释：**

我有一个引导程序，它运行存在于单独程序集中的“作业”（从公共基础继承的类）。作业具有存储在数据库中的配置参数，以允许通过 GUI 更改其操作。

为了定位和运行作业，引导程序有一个 app.config 文件，其中包含作业的名称，以及定义它的程序集名称和类名称。

我被要求将程序集名称和类名称移动到数据库中，以便我们可以摆脱 app.config 文件。（给出的理由是将所有配置保存在一个地方 - 数据库。）

但是，引导程序是运行该作业的唯一代码，并且此“配置”信息在部署后将永远不会更改。我认为将这些信息放入数据库会给数据层提供太多关于上面各层的信息，并且会妨碍重构和维护。但是，我知道 Windows Workflow Foundation 正是这样做的，所以我认为这是一种糟糕的做法也许是错误的？

**编辑：**

在回答以下问题时，数据库连接字符串存储在由共享配置框架管理的单独配置文件中。这个框架使得完全删除 app.config 文件在技术上成为可能。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T12:39:02.390

我认为在数据库中存储包括程序集/类名在内的配置信息是完全可以接受的。

我不会认为存储在数据库中的数据是数据层的一部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T12:59:15.267

为了稍微回避这一点，举个例子来证明你的实现是正确的：

当您使用 Windsor 或 Unity 等 IoC 容器时，您将程序集/类名称存储在配置文件中。同样，这不是编译器检查的，因为您可以更改它而无需重新编译代码。它类似于将映射存储在数据库中，唯一改变的是配置的来源。

您可以做的最好的事情（我从您的问题中收集到）是针对抽象基类或接口进行编程，因此您不必依赖反射来获取有关您必须运行的类的信息。这样，您基本上可以创建所有逻辑，并在运行时通过从数据库中读取配置来注入您的依赖项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T12:46:46.603

它没有错，特别是如果您在动态加载情况下使用它。

模型/数据层实际上并不“知道”任何东西，它只是一个存放你想要的任何东西的存储库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T13:11:43.137

计算机是你的奴隶，而不是相反，是的，数据库并没有因为它为它的主人存储一个长字符串而不是一个较短的字符串而承担额外的技术责任。这实际上是我在 2002 年为报告应用程序提出完全相同的事情时提出的论点，只是被“Java 团队”否决（我在会计部门工作，并且赞成使用完全限定的类名在数据库中）。

您需要重点关注的问题应该是现在是否有出色的重构需要完成，以及您期望稍后进行的其他更改和重构是否会使管理数据库变得痛苦。您认为使用二进制文件部署配置文件是一种从根本上更好的部署方法是正确的，因为在不同的人部署更新时保持数据和二进制文件同步从来没有问题。

你的开发人员，所以它是你的电话，不是吗？如果没有，那就太可惜了，但要清楚你的观点是什么，并尝试量化成本（使用诚实的方法），如果你的方式更便宜，你可能会得到你的方式。但是，为此争论要花多少钱？

PS我赞成那个问数据库连接字符串去哪里的人！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-04T01:03:30.983

当然，我对我们应用程序中的菜单就是这样做的。

当程序加载时，它会扫描数据库并按程序可以支持的类名加载菜单项。如果需要更新版本，则会显示一个占位符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-04T01:24:27.730

尽管我没有听说数据库是那个存储库，但我认为这没有问题。

# asp.net - ASP.NET：“必须填写两个字段之一”的自定义客户端验证器？

> ID：336960
> 
> 赞同：4
> 
> 时间：2008-12-03T12:34:17.690
> 
> 标签：asp.net, validation

你能告诉我是否有人实现了一个**自定义验证器来检查两个（或 N 个）**输入字段中的一个是否已填充？

```
 "Insert phone number or email address" 
```

我正在使用 ASP.NET (Ajax) 3.5、ajaxToolkit:ValidatorCalloutExtender（如果有必要，还可以使用 jQuery）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-09-24T09:49:05.657

我刚刚做了这个（需要 jQuery）：

JS：

```
function validatePhoneOrEmail(source, args) {
    if ($("[id$='txtEmail']").val() == "" && $("[id$='txtTel']").val() == "") 
        args.IsValid = false;
    else
        args.IsValid = true;
} 
```

ASP.NET：

```
<asp:CustomValidator runat="server" 
    ClientValidationFunction="validatePhoneOrEmail" 
    ErrorMessage="Please enter a telephone number or email address">
</asp:CustomValidator> 
```

我对此没有任何服务器端验证，但我假设服务器中的类似功能很容易创建。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T12:44:23.940

哦，当然，大约 10 分钟后，我自己找到**[了 Adam Tibi 撰写的这篇代码项目文章 Multiple Fields Validator - An ASP.NET Validation Control](http://www.codeproject.com/KB/validation/MultipleFieldsValidator.aspx)**：

![替代文字](https://www.codeproject.com/KB/validation/MultipleFieldsValidator/MultipleFieldsValidator.gif)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T12:48:06.600

我不是在这里推商业产品的人，但是当涉及到 asp.net 验证时，如果不看一下 peterblum.com，你会对自己造成难以置信的伤害。最好的 asp.net 控件包没有... Hanselmans 接受它们 -

“不是插件，而是对 ASP.NET 验证框架的完全重新构想。有一个学习曲线，但它会改变你编写页面的方式。还可以查看他的 Visual Security Security 和 Peter'sDatePackage。他的文档是传奇。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T14:03:28.743

代码项目也有这个控制（由你真正）： http:
[//www.codeproject.com/KB/validation/AtLeastOneOfValidator.aspx](http://www.codeproject.com/KB/validation/AtLeastOneOfValidator.aspx)

# dll - 将 exe + dll 打包成一个可执行文件（不是 .NET）

> ID：336961
> 
> 赞同：33
> 
> 时间：2008-12-03T12:34:27.097
> 
> 标签：dll

> **可能重复：**
> [如何将 C++ windows dll 合并到 C# 应用程序 exe 中？](https://stackoverflow.com/questions/72264/how-can-a-c-windows-dll-be-merged-into-a-c-sharp-application-exe)

是否有人知道可以将多个 DLL 和 .EXE 打包到一个可执行文件中的程序。我在这里不是在谈论 .NET 案例，而是在谈论一般的 DLL，其中一些是我在 C++ 中生成的，还有一些是我无法控制的外部 DLL。

我的具体案例是一个用py2exe打包的python程序，我想通过打包来“隐藏”另一个DLL。这个问题很笼统。

看过的东西：

*   ILMerge：特定于 .NET
*   [NETZ](http://madebits.com/netz/)：特定于 .NET
*   [UPX](http://upx.sourceforge.net/)：做 DLL 压缩，但不做多个 DLL + EXE 打包
*   [文件连接器](http://www.file-joiner.com/)：

> 几乎明白了。它可以将可执行文件 + 任何内容打包到一个 exe 中，但打开时，它将为每个打包的文件启动默认打开器。因此，如果用户用户 dll 依赖安装，它将启动它（因为这是默认的 dll 打开器）。

也许这是不可能的？

* * *

答案摘要：

DLL 的打开是由操作系统管理的，因此将 DLL 打包成可执行文件意味着在某些时候，它们需要被提取到操作系统可以找到它们的地方。没有灵丹妙药。

所以，我想要的是不可能的。

除非...

我们在操作系统中改变了一些东西。感谢 Conrad 将我指向[ThinInstall](http://www.vmware.com/products/thinapp/overview.html)，它可以虚拟化应用程序和操作系统加载机制。使用 ThinInstall，可以将所有内容打包在一个 exe 中（DLL、注册表设置等）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-04-13T07:10:47.487

看看[BoxedApp](http://boxedapp.com/ "盒装应用")。祝你好运！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T14:30:18.360

看看~~Thinstall~~ [ThinApp](http://www.vmware.com/products/thinapp/overview.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-06-03T00:03:26.740

试试[Powerpacker](http://www.blitzbasic.com/toolbox/toolbox.php?tool=75)。 [Evalaze](https://www.evalaze.de/en/Evalaze-Softwarevirtualisierung-Evalazer/)是另一个免费的虚拟化解决方案。 [Enigma Virtual Box](http://enigmaprotector.com/en/downloads.html)免费版

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-03T14:11:10.380

如果可执行文件静态链接到 DLL，即没有调用`LoadLibrary`，那么我认为没有任何机制可以将 DLL 打包到可执行文件中，因为 DLL 加载是由 OS 应用程序加载器在“main”之前完成的被调用的函数。据我所知，解决这个问题的唯一方法是将exe和dll放入另一个exe中。这个包装 exe 将真正的 exe 和 dll 解包到一个临时文件夹中并启动 exe，当 exe 退出时删除文件。

如果您正在调用`LoadLibrary/Ex`加载 dll，请在调用`LoadLibrary/Ex`.

真正的问题是，该`LoadLibrary`函数在加载库时会修复大量地址，并且仅在从文件加载时才有效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T13:55:41.347

您可以将 DLL 作为二进制资源添加到您的 EXE 中。在启动时，您的 EXE 可以将资源提取到一个临时文件夹中，以及`LoadLibrary()`生成的 DLL。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-02T12:30:03.307

你看过我的廉价实用程序清单吗？

应该有几种便宜（即相当便宜）的工具可以将非网络应用程序的 DLL 链接在一起，例如：

1.) Molebox Pro (eu 100) 2.) BitArt's Fusion ($160) 3.) VB Wrap ($100) 4.) PE Bundle ($30)

此外，在“www.oreans.com”上，您可能会找到一个针对 eu 320 的面向保护的程序包，正如他们声称的那样，它可以将 Win32 或“.Net”文件链接在一起；然而，当我问他们一个特定的场景时，我会使用他们的“XBundler For Win32/.NET”来打包一个“.Net”EXE，然后尝试在Windos 98（没有框架）上运行它，他们说这行不通。:-(

EXE崇拜者

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-23T19:15:23.737

您可以使用 valgrid、thinstall 或 boxedapp.... 我更喜欢后者。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-07T20:31:57.083

MoleBox Pro 完全符合您的要求，但它是共享软件，除非您购买完整版，否则打包的可执行文件将在启动时显示一个对话框，说“此文件由 MoleBox 的试用版打包，请不要分发它”

你可以在这里下载它：[link](http://www.brothersoft.com/molebox-17243.html)

不幸的是，我一直无法找到完全令人满意且免费的解决方案

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-05T06:44:21.363

有人告诉我可以要求共享对象链接到另一个共享对象，从而在 Linux 中将它们组合成一个

但它不适用于 Windows 本机 dll，我遇到的一件事是我们可以使用链接器将所有 objs 链接在一起，而不管它们最初属于哪个项目。当然，他们需要有类似的链接选项。

# python - Python optparse 元变量

> ID：336963
> 
> 赞同：26
> 
> 时间：2008-12-03T12:36:12.023
> 
> 标签：python, optparse

我不确定`optparse`'s`metavar`参数的用途。我看到它到处都在使用，但我看不到它的用途。

有人可以对我说清楚吗？谢谢。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-03T12:48:58.377

正如@Guillaume 所说，它用于生成帮助。如果您想要一个带有参数的选项，例如文件名，您可以将`metavar`参数添加到`add_option`调用中，以便在帮助消息中输出您的首选参数名称/描述符。从[当前的模块文档](http://docs.python.org/library/optparse.html#generating-help)：

```
usage = "usage: %prog [options] arg1 arg2"
parser = OptionParser(usage=usage)
parser.add_option("-f", "--filename",
                  metavar="FILE", help="write output to FILE"), 
```

会产生这样的帮助：

```
usage: <yourscript> [options] arg1 arg2

options:
  -f FILE, --filename=FILE 
```

“-f”和“--filename”之后的“FILE”来自元变量。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-03T12:42:52.977

metavar 似乎用于生成帮助：[http ://www.python.org/doc/2.5.2/lib/optparse-generating-help.html](http://www.python.org/doc/2.5.2/lib/optparse-generating-help.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-07T13:43:56.233

`metavar`是选项后用于在屏幕中打印的变量。通常用于选项是`FILE`或`INT`或`STRING`给用户之后的建议输入。没有`metavar`,将在您添加选项后`optparse`打印值。`dest`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-10T15:37:11.113

metavar 的另一种有意义的用途是使用 'dest' 作为参数查找标记，但使用 metavar 掩盖帮助消息。（例如，有时在使用子解析器时很方便）。（如[S.Lott](https://stackoverflow.com/users/10661/s-lott)的评论所示）。

```
parser.add_argument(
        'my_fancy_tag',
        help='Specify destination',
        metavar='helpful_message'
        ) 
```

或同样

```
parser.add_argument(
        dest='my_fancy_tag',
        help='Specify destination',
        metavar='helpful_message'
        ) 
```

帮助将显示元变量：

```
./parse.py -h usage: parser [-h] destination

positional arguments:   
  helpful_message  Specify destination 
```

但 dest 会将 fancy_tag 存储在命名空间中：

```
./parse.py test 
Namespace(my_fancy_tag='test') 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-11-13T09:55:29.247

现在最好使用[argparse](https://docs.python.org/library/argparse.html)库而不是 optparse。

[这里](https://stackoverflow.com/questions/3217673/why-use-argparse-rather-than-optparse)给出原因。

# javascript - 关于 Javascript 中“未定义”的问题

> ID：336965
> 
> 赞同：1
> 
> 时间：2008-12-03T12:38:55.933
> 
> 标签：javascript

今天我的一位朋友说：

```
if (typeof isoft == "undefined") var isoft = new Object(); 
```

这种代码是大一写的，写的

```
if(!isoft) var isoft = new Object(); 
```

我最初认为肯定有一些区别。但我找不到区别。有没有？还是这两个例子是一样的？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T12:47:25.777

请参阅问题[Javascript，检查变量是否为对象](https://stackoverflow.com/questions/95875/javascript-check-to-see-if-a-variable-is-an-object)，但请注意**Tom Ritter 接受的答案似乎不完整**，请检查他的答案的评论。另请参阅[Rob 的社区回答](https://stackoverflow.com/questions/95875/javascript-check-to-see-if-a-variable-is-an-object#95935)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T17:03:59.050

In the example involving regular objects that you provided there is little difference. However, another typical pattern can be:

```
var radioButtons = document.forms['formName'].elements['radioButtonName'];
if ('undefined' === typeof radioButtons.length) {
    radioButtons = [ radioButtons ];
}
for (var i = 0; i < radioButtons.length; i++) {
    // ...
} 
```

If you used `if (!radioButtons.length)` it would evaluate true when no radio buttons were found (radioButtons.length is 0) and create an array of a single (non-existent) radio button. The same problem can arise if you choose to handle the radio buttons using:

```
if ('undefined' === typeof radioButtons.length) {
    // there is only one
} else {
    // there are many or none
} 
```

There are other examples involving empty strings where `if (!variable)` is probably not recommended and it is better to test against typeof undefined or explicitly test against null.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T12:46:08.447

如果`isoft`应该持有对对象的引用，则两者都做同样的事情。A`!isoft`对所有假值都为真，但对象不能是假值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-02T12:42:18.713

在您的特定示例中，没有显着差异，因为您正在评估 Object 实例，并且对象在转换为 Boolean 时被转换为 Boolean true，而 undefined 和 null 被评估为 Boolean false。但以此为例：

```
function alertSomething(something) {
    //say you wanna show alert only if something is defined.
    //but you do not know if something is going to be an object or
    //a string or a number, so you cannot just do
    //if (!something) return;
    //you have to check if something is defined
    if (typeof something=='undefined') return;
    alert(something);
} 
```

我喜欢走捷径并尽可能节省打字，当然，但你必须知道什么时候走捷径，什么时候不走捷径；）

# soa - 在服务层切换客户端逻辑有错吗？

> ID：336973
> 
> 赞同：2
> 
> 时间：2008-12-03T12:41:25.647
> 
> 标签：soa

我们有两个客户端应用程序（一个 Web 应用程序和一个代理应用程序）访问同一服务上的方法，但要求略有不同。我的团队希望通过将 ApplicationType 参数传递给每个方法来控制服务端的行为——它本质上是一个包含调用客户端应用程序名称的枚举——然后用作数据库查找的键以配置服务客户特定的选项。

这让我感到不安，因为我认为服务不应该真的知道哪个客户正在调用它。有人告诉我，这样做比通过方法调用动态传递大量选项更容易。

客户端应用程序告诉服务他们是谁有什么问题吗？或者传递配置键和一组参数化选项之间真的没有区别吗？

我可以看到的一个直接问题是，如果我们曾经向第三方运行的另一个客户端打开服务，我们必须在本地为他们维护他们的配置设置。目前我们拥有这两个客户端应用程序，所以这不是什么大问题。

你会怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T12:59:02.210

在分层解决方案中，您应该始终将您的层视为类似洋葱的层，并且依赖项应该始终向内而不是向外。

所以你的 GUI/App 层应该依赖于业务逻辑层，业务逻辑层应该依赖于数据访问层，等等。

除非您对客户端（web、win、wpf、cli）进行分类，或者使用客户端配置文件（客户端应用程序可以配置）对其进行概括，否则我永远不会传入调用应用程序的名称，因为这会使业务逻辑层意识到属于并依赖于外层。

我们在谈论什么样的差异，这取决于应用程序的类型？如果您详细说明此处的差异，也许有人可以就解决此问题的其他方法提出一些有用的建议。

但在沿着你描述的道路前进之前，我肯定会寻找其他方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T13:56:57.227

您不能为每个应用程序创建两种不同的服务吗？这两个服务将共享大量代码或调用具有不同参数化的单个内部服务，具体取决于调用的外部服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T13:29:47.313

从设计的角度来看，这与拥有不同配置文件的用户没有什么不同。从安全的角度来看，我希望您的应用程序正在做一些事情来识别自己，以免一个应用程序的用户想出一种方法来调用其他应用程序的逻辑作为黑客攻击。（想象一个 HR 应用程序同时被黑手党和一家银行使用，一个客户可能会对在共享应用程序主机上入侵另一个客户的应用程序感兴趣）

在 .net 中，设计并没有这种感觉，因为凭据存在于线程上（即，当您设置 IIPrincipal 时，该信息在线程上——它与每个方法调用一起进行通信，但不作为参数进行通信。）

也许您正在寻找更优雅的设计是 ApplicationIdentity 属性。您必须编写一个自定义的，我现在不知道框架中有一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-07T03:33:20.440

如果没有一个可靠的例子，这是一个很难讨论的话题。

你有这种感觉是对的。发送客户端类型以更改行为是不正确的。记录日志不是一个坏主意……但仅此而已。

这是我要做的：

*   查看每种方法以了解需要不同的地方以及原因。
*   为不同的用途创建不同的方法。方法名称应该是不言自明的。如果您需要破坏兼容性，您有更多的控制权（假设您没有使用版本控制系统，这对于内部服务来说是多余的）。
*   在某些情况下，请求参数（标志/枚举值）更合适。
*   在某些情况下，了解操作环境更合适（尤其是对于数据安全）。操作环境几乎总是在登录请求期间发送。诸如“有人值守”/“安全”（代理客户端）与“无人值守”/“不安全”（Web 客户端）之类的东西。现在您必须交换会话密钥（HTTP cookie 或应用程序级会话 ID）。如果您需要 100% 无状态，会话显然不起作用——尤其是如果您想在没有会话复制的情况下横向扩展……如果您有这个要求，请在每个请求中发送一个结构。

想想代码中的函数之类的请求。您不会放置一个改变函数行为的魔术参数。您将创建多个函数，每个函数的行为都不同。使用该函数的人决定调用哪个函数。

那么为什么客户端类型如此错误呢？客户端类型本身没有特定含义。它有很多含义，它们可能会随着时间而改变。它只是提供信息，这就是为什么记录它是一件方便的事情。操作环境确实具有特定的含义。

下面是一个需要考虑的场景：如果开发的新客户端类型稍有不同，会破坏与原始请求的兼容性，该怎么办？现在你有两个请求。2 个客户端使用请求 A，1 个客户端使用请求 B。如果您将客户端类型传递给每个请求，则服务器应该适用于所有可能的客户端类型。更难测试和维护！！

# c# - 没有 xsd.exe 的 XML 序列化和架构

> ID：336988
> 
> 赞同：5
> 
> 时间：2008-12-03T12:48:01.127
> 
> 标签：c#, xml-serialization

我使用 XML 序列化来读取我的 Config-POCO。

为了在 Visual Studio 中获得对 XML 文件的智能支持，我需要一个模式文件。我可以使用 xsd.exe mylibrary.dll 创建架构，并且效果很好。

但是如果我将对象序列化到文件系统，我希望始终创建模式。有什么办法不使用 xsd.exe？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-03T17:56:44.607

谢谢，这对我来说是正确的方法。解决方案：

```
XmlReflectionImporter importer = new XmlReflectionImporter();
XmlSchemas schemas = new XmlSchemas();
XmlSchemaExporter exporter = new XmlSchemaExporter(schemas);
Type type = toSerialize.GetType();
XmlTypeMapping map = importer.ImportTypeMapping(type);
exporter.ExportTypeMapping(map);

TextWriter tw = new StreamWriter(fileName + ".xsd");
schemas[0].Write(tw);
tw.Close(); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-10-23T17:58:53.220

Will 上面发布的解决方案效果很好，除了我意识到生成的模式没有反映不同类成员的属性。例如，用序列化提示属性装饰的类（请参见下面的示例）将无法正确呈现。

```
 public class Test
    {
        [XmlAttribute()]
        public string Attribute { get; set; }
        public string Description { get; set; }

        [XmlArray(ElementName = "Customers")]
        [XmlArrayItem(ElementName = "Customer")]
        public List<CustomerClass> blah { get; set; }

    } 
```

为了解决这个问题，我创建了一些帮助函数，它们使用反射来遍历类层次结构、读取属性并填充可以传递到 XmlReflectionImporter 的 XmlAttributeOverrides 对象。

```
 public static void AttachXmlAttributes(XmlAttributeOverrides xao, Type t)
    {
        List<Type> types = new List<Type>();
        AttachXmlAttributes(xao, types, t);
    }

    public static void AttachXmlAttributes(XmlAttributeOverrides xao, List<Type> all, Type t)
    {
        if(all.Contains(t))
            return;
        else
            all.Add(t);

        XmlAttributes list1 = GetAttributeList(t.GetCustomAttributes(false));
        xao.Add(t, list1);

        foreach (var prop in t.GetProperties())
        {
            XmlAttributes list2 = GetAttributeList(prop.GetCustomAttributes(false));
            xao.Add(t, prop.Name, list2);
            AttachXmlAttributes(xao, all, prop.PropertyType);
        }
    }

    private static XmlAttributes GetAttributeList(object[] attributes)
    {
        XmlAttributes list = new XmlAttributes();
        foreach (var attribute in attributes)
        {
            Type type = attribute.GetType();
            if (type.Name == "XmlAttributeAttribute") list.XmlAttribute = (XmlAttributeAttribute)attribute;
            else if (type.Name == "XmlArrayAttribute") list.XmlArray = (XmlArrayAttribute)attribute;
            else if (type.Name == "XmlArrayItemAttribute") list.XmlArrayItems.Add((XmlArrayItemAttribute)attribute);

        }
        return list;
    }
    public static string GetSchema<T>()
    {
        XmlAttributeOverrides xao = new XmlAttributeOverrides();
        AttachXmlAttributes(xao, typeof(T));

        XmlReflectionImporter importer = new XmlReflectionImporter(xao);
        XmlSchemas schemas = new XmlSchemas();
        XmlSchemaExporter exporter = new XmlSchemaExporter(schemas);
        XmlTypeMapping map = importer.ImportTypeMapping(typeof(T));
        exporter.ExportTypeMapping(map);

        using (MemoryStream ms = new MemoryStream())
        {
            schemas[0].Write(ms);
            ms.Position = 0;
            return new StreamReader(ms).ReadToEnd();
        }
    } 
```

希望这对其他人有帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T12:57:51.870

看看[`System.Xml.Serialization.XmlSchemaExporter`](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlschemaexporter(v=vs.110).aspx)班级。我不记得确切的细节，但该命名空间中有足够的功能可以满足您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-08-08T12:23:14.793

对 Matt Murrell 版本的改进：为嵌套属性用户类型（例如 CustomerClass 属性）递归应用 XmlAttributes。

```
private static void AttachXmlAttributes(XmlAttributeOverrides xao, List<Type> all, Type t)
{
    if (all.Contains(t))
    {
        return;
    }
    else
    {
        all.Add(t);
    }

    var list1 = GetAttributeList(t.GetCustomAttributes(false));
    xao.Add(t, list1);

    foreach (var prop in t.GetProperties())
    {
        var propType = prop.PropertyType;
        if (propType.IsGenericType) // is list?
        {
            var args = propType.GetGenericArguments();
            if (args != null && args.Length == 1)
            {                        
                var genType = args[0];
                if (genType.Name.ToLower() != "object")
                {
                    var list2 = GetAttributeList(prop.GetCustomAttributes(false));
                    xao.Add(t, prop.Name, list2);
                    AttachXmlAttributes(xao, all, genType);
                }                        
            }
        }
        else
        {
            var list2 = GetAttributeList(prop.GetCustomAttributes(false));
            xao.Add(t, prop.Name, list2);
            AttachXmlAttributes(xao, all, prop.PropertyType);
        }
    }
}        

private static XmlAttributes GetAttributeList(object[] attributes)
{
    var list = new XmlAttributes();
    foreach (var attr in attributes)
    {
        Type type = attr.GetType();
        switch (type.Name)
        {
            case "XmlAttributeAttribute":
                list.XmlAttribute = (XmlAttributeAttribute)attr;
                break;                    
            case "XmlRootAttribute":
                list.XmlRoot = (XmlRootAttribute)attr;
                break;
            case "XmlElementAttribute":
                list.XmlElements.Add((XmlElementAttribute)attr);
                break;
            case "XmlArrayAttribute":
                list.XmlArray = (XmlArrayAttribute)attr;
                break;
            case "XmlArrayItemAttribute":
                list.XmlArrayItems.Add((XmlArrayItemAttribute)attr);
                break;
        }
    }
    return list;
} 
```

# inversion-of-control - 使用 StructureMap 链接容器

> ID：336990
> 
> 赞同：3
> 
> 时间：2008-12-03T12:48:23.730
> 
> 标签：inversion-of-control, castle-windsor, structuremap

是否可以像在 WindsorContainer.AddChildContainer() 中一样在 StructureMap 中将容器链接在一起？

我想实现拥有 3 个容器级别；- 1 个页面请求级别 - 1 个会话级别 - 1 个应用程序级别

然后将它们链接在一起，因此只有一个实例请求将发送到“基本级别”容器。

容器的层次其实并不重要，只是是否有能力将它们链接在一起。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:15:11.983

这似乎可以解决问题，不确定是否有更好的方法或含义是什么。到目前为止看起来还可以...

```
childContainer.PluginGraph.Registries.ForEach(
  registry => parentContainer.Configure(expression => expression.AddRegistry(registry))
); 
```

其中 parentContainer 和 childContainer 都是 StructureMap.Container

# collections - NameObjectCollectionBase 集合中的 Add 方法的行为如何？

> ID：336991
> 
> 赞同：0
> 
> 时间：2008-12-03T12:48:52.370
> 
> 标签：collections, .net-2.0

为什么**NameObjectCollectionBase上的****Add**方法在索引位置 0 处插入？有没有办法在集合末尾插入新项目？

 **我在.Net 2.0中遇到了这个问题

我不允许更改收藏。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T13:06:08.187

`NameObjectCollectionBase`基于哈希表/字典，因此它本质上是“未排序的”。

我想你正在寻找一个`SortedList`.

更新：如果你不能改变班级，那你就不走运了。请记住，每次添加/插入后，“位置”可能会发生变化。

# java - Java 适合“Web 2.0”应用吗？

> ID：336993
> 
> 赞同：6
> 
> 时间：2008-12-03T12:50:15.880
> 
> 标签：java, web-applications

前几天我和某人聊天，他建议 Rails 和 PHP 是最适合 Web 应用程序的平台，并且要避免使用 Java。我的背景主要是Java，我知道有些人认为它过于冗长和“重量级”，但偶尔会使用（例如LinkedIn）。

所以我想知道是否有人成功地将Java用于最近上线的Web应用程序，无论是使用语言本身（例如使用Stripes / Spring + Hibernate），还是使用动态语言（如JRuby，Groovy）的运行时，Jython）？如果是这样，请分享哪些有效以及您会采取哪些不同的做法。

**一些背景** *（稍后添加）*：Tim O'Reilly 创造了短语“Web 2.0”，这是他的定义：[http ://www.oreillynet.com/lpt/a/6228](http://www.oreillynet.com/lpt/a/6228)

我认为是“发布周期结束”和“轻量级编程模型”，涉及快速迭代和简化部署，Java 可能不太适合。想法？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-03T12:57:47.453

我认为没有针对 Web 2.0 的特定技术。Web 2.0 应用程序背后的主要概念是大部分内容是由它的用户而不是某个特定的人提供的。如果您可以使用 Java 实现这一点，那很好。许多人正在使用免费的技术创建初创公司，因为他们没有资金。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-03T14:14:02.560

有两个完全不同的概念称为“Web 2.0”：

1.  用户生成的内容（通常带有一些“社交网络”）

2.  基于 AJAX 的动态 Web 应用程序

第二个在某种程度上规定了您必须使用的技术（至少是一些 JS，以及（一些）响应中的机器可读内容）。当然，没有什么反对在服务器上使用 Java（或 CGI、Perl 等）。

第一个与技术无关，与您提供的服务本身有关。再次，你可以使用任何你想要的东西。

为什么这两种混合在同一个热水器中？更重要的是：为什么动态语言被认为“更合适”？我猜这只是时间上的巧合，所有三件事（用户生成的内容、AJAX、严肃的动态语言）大致同时成为众人瞩目的焦点，并且每个概念的大多数支持者都在使用另外两个。

简而言之，最好避免使用“web 2.0”等未定义的市场术语，并使用适当的描述。至少在工作时。在向 VC 和 PHB 销售时，请使用任何和所有流行语！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-03T14:01:27.250

当然是的。Java 有一些非常成熟且经过良好测试的框架用于执行 Web 应用程序，包括所谓的 Web 2.0 网站。Hibernate、Spring，甚至 Struts 和 Tiles，甚至是 Plain Old Servlet 都可以。

此外，与 Ruby 相比，Java 非常快（请参阅 Debian 速度测试），这对于处理大量请求的网站非常有用，而 Ajax 确实会增加请求的数量！:)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-03T15:33:27.703

恕我直言，你的朋友都是傻子。Java 是一种丰富的语言，具有令人难以置信的工具支持。你可以用 Java 构建一个很棒的后端，并在前端使用任何你想要的东西。

我花了一段时间才弄清楚在这个答案中要说什么，因为我对这个概念的纯粹疯狂感到震惊。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-03T13:28:08.143

在我工作的地方，我们所有的应用程序都是使用 Java 构建的。它们是 Web 应用程序，在数据端使用休眠或直接 JDBC 构建，并在表示端使用 Struts 或 JSF。除非我们可以访问最新版本（由于我们的 IDE，我们被困在 1.0 上），否则我不会再次使用 JSF，因为我们遇到了很多问题，并被告知它们已在以后的版本中得到修复。至于其余技术，如果您知道如何使用它们，它们就可以正常工作。

一般来说，使用一种你熟悉并且能够胜任工作的语言比使用一种你几乎不知道但可能是这项工作的“最佳”语言来开发会更好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-03T15:10:09.433

“Web 2.0”通常指的是用户界面，而不是支持 webapp 的底层技术。

是什么阻止了基于 Java 的 web 应用程序在 UI 层中完全浮华和 AJAX-y？没有。您将用 Java 编写中间层——无论如何这对用户都是透明的。

我认为给你这个建议的人更关心的是“时髦”和（他们认为是）当前的“热门”——这与你的 UI**标记完全无关。**我不会听他们的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-03T18:54:15.690

美好的一天，我可以再次发布有关[Wicket](http://wicket.apache.org/)的信息！:)

Java 非常适合 Web2.0 应用程序，只要您知道如何使用可用的工具。我刚刚链接的 Apache Wicket 是一个基于 POJO 的 Web 应用程序框架，它以令人难以置信的方式隐藏了所有无聊的服务器-客户端内容，它允许您做任何您能想到的事情。这里的优势在于，由于 Wicket 只是 POJO，因此您可以获得非常快速、迭代和单元测试的代码，其工作方式与浏览器中的预期一样。

要使用 Java 创建 Web2.0 站点，您当然不必使用 Wicket，但我还是推荐它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-03T14:07:21.823

我在工作中使用 Java 构建 Web 应用程序，然后将 PHP 用于我的个人项目。虽然 Java 确实能够完成您可能需要它做的所有事情，但我有时发现它有点麻烦，并且希望我使用的是 PHP（或其他语言，就此而言）。它确实取决于您正在构建的应用程序的类型和大小，但我认为许多人选择 PHP、Ruby 和 Python 来进行个人项目是有充分理由的，即*他们*可以在哪里选择构建 Web 应用程序的语言（而不是他们的上级）。

# database - 哪些数据库系统支持 ENUM 数据类型，哪些不支持？

> ID：336997
> 
> 赞同：13
> 
> 时间：2008-12-03T12:51:35.503
> 
> 标签：database, enums, types, rdbms

跟进这个问题：“[数据库枚举 - 优点和缺点](https://stackoverflow.com/questions/336846/database-enums-pros-and-cons)”，我想知道哪些数据库系统支持枚举数据类型，以及它们如何做的一些细节（例如内部存储的内容，限制是什么，查询语法含义，索引含义，...）。

用例或利弊的讨论应在其他问题中进行。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T13:37:14.083

我知道 MySQL 确实支持 ENUM：

*   数据类型被实现为带有关联字符串的整数值
*   单个枚举最多可以有 65.535 个元素
*   每个字符串都有一个数字等价物，从 1 开始，按照定义的顺序
*   该字段的数值可通过“ `SELECT enum_col+0`”访问
*   在非严格 SQL 模式下，分配不在列表中的值不一定会导致错误，而是分配一个特殊的错误值，数值为 0
*   排序按数字顺序（例如定义顺序）进行，而不是按字符串等效项的字母顺序
*   赋值通过值字符串或索引号工作
*   this：`ENUM('0','1','2')`应该避免，因为`'0'`会有整数值`1`

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-03T13:44:24.973

PostgreSQL 从 8.3 开始支持 ENUM。对于旧版本，您可以使用：

您可以通过执行以下操作来模拟 ENUM：

```
CREATE TABLE persons (
  person_id int not null primary key,
  favourite_colour varchar(255) NOT NULL,
  CHECK (favourite_colour IN ('red', 'blue', 'yellow', 'purple'))
); 
```

您还可以：

```
CREATE TABLE colours (
  colour_id int not null primary key,
  colour varchar(255) not null
)
CREATE TABLE persons (
  person_id int not null primary key,
  favourite_colour_id integer NOT NULL references colours(colour_id),
); 
```

当您了解最喜欢的颜色时，它会让您添加一个连接，但它的优点是您可以简单地通过向颜色表添加一个条目来添加颜色，而不是您不需要每次都更改架构。您还可以为颜色添加属性，例如 HTML 代码或 RVB 值。

您也可以创建自己的类型来执行枚举，但我认为它不会比 varchar 和`CHECK`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-03T12:58:55.517

Oracle 根本不支持 ENUM。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-16T03:57:32.733

AFAIK，IBM DB2 和 IBM Informix Dynamic Server 都不支持 ENUM 类型。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-08T13:26:06.113

与 mat 所说的不同，PostgreSQL[确实支持 ENUM](http://www.postgresql.org/docs/current/interactive/datatype-enum.html)（从 8.3 版开始，最后一个）：

```
essais=> CREATE TYPE rcount AS ENUM (
essais(>   'one',
essais(>   'two',
essais(>   'three'
essais(> );
CREATE TYPE
essais=> 
essais=> CREATE TABLE dummy (id SERIAL, num rcount);
NOTICE:  CREATE TABLE will create implicit sequence "dummy_id_seq" for serial column "dummy.id"
CREATE TABLE
essais=> INSERT INTO dummy (num) VALUES ('one');
INSERT 0 1
essais=> INSERT INTO dummy (num) VALUES ('three');
INSERT 0 1
essais=> INSERT INTO dummy (num) VALUES ('four');
ERROR:  invalid input value for enum rcount: "four"
essais=> 
essais=> SELECT * FROM dummy WHERE num='three';
 id |  num  
----+-------
  2 | three
  4 | three 
```

有些函数[专门用于 enums](http://www.postgresql.org/docs/current/interactive/functions-enum.html)。

索引在枚举类型上工作得很好。

根据手册，实现如下：

> 一个枚举值占用磁盘上的四个字节。枚举值的文本标签的长度受编译到 PostgreSQL 中的 NAMEDATALEN 设置的限制；在标准版本中，这意味着最多 63 个字节。
> 
> 枚举标签区分大小写，因此“快乐”与“快乐”不同。标签中的空格也很重要。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-10T10:51:18.523

MSSQL 不支持 ENUM。

当您使用 Entity Framework 5 时，您可以使用枚举（查看：[Enumeration Support in Entity Framework](http://blogs.msdn.com/b/efdesign/archive/2011/06/29/enumeration-support-in-entity-framework.aspx "实体框架中的枚举支持")和[EF5 Enum Types Walkthrough](http://msdn.microsoft.com/en-us/hh859576 "EF5 枚举类型演练")），但即便如此，这些值仍以 int 形式存储在数据库中。****