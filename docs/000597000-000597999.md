# StackOverflow 问答 000597000-000597999

# .net - 帮助企业图书馆验证结果

> ID：597011
> 
> 赞同：1
> 
> 时间：2009-02-27T22:59:38.823
> 
> 标签：.net, enterprise-library

我正在尝试使用 Entlib 4 的验证块，但我遇到了一个问题，可以清楚地识别验证结果中的无效属性。

在以下示例中，如果 City 属性验证失败，我无法知道它是 HomeAddress 对象的 City 属性还是 WorkAddress 对象。

有没有一种简单的方法可以在不创建自定义验证器等的情况下做到这一点？

任何对我遗漏或不理解的见解将不胜感激。

谢谢你。

```
public class Profile
{
    ...
    [ObjectValidator(Tag = "HomeAddress")]
    public Address HomeAddress { get; set; }

    [ObjectValidator(Tag = "WorkAddress")]
    public Address WorkAddress { get; set; }
}
...
public class Address
{
    ...   
    [StringLengthValidator(1, 10)]
    public string City { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T18:19:40.710

基本上，我创建了一个扩展 ObjectValidator 的自定义验证器，并添加了一个 _PropertyName 字段，该字段被预先添加到验证结果的键中。

所以现在上面描述的例子中的用法是：

```
public class Profile
{
    ...
    [SuiteObjectValidator("HomeAddress")]
    public Address HomeAddress { get; set; }

    [SuiteObjectValidator("WorkAddress")]
    public Address WorkAddress { get; set; }
} 
```

验证器类：

```
public class SuiteObjectValidator : ObjectValidator
{
    private readonly string _PropertyName;

    public SuiteObjectValidator(string propertyName, Type targetType)
        : base(targetType)
    {
        _PropertyName = propertyName;
    }

    protected override void DoValidate(object objectToValidate, object currentTarget, string key,
                                       ValidationResults validationResults)
    {
        var results = new ValidationResults();

        base.DoValidate(objectToValidate, currentTarget, key, results);

        foreach (ValidationResult validationResult in results)
        {
            LogValidationResult(validationResults, validationResult.Message, validationResult.Target,
                                _PropertyName + "." + validationResult.Key);
        }
    }
} 
```

以及必要的属性类：

```
public class SuiteObjectValidatorAttribute : ValidatorAttribute
{
    public SuiteObjectValidatorAttribute()
    {
    }

    public SuiteObjectValidatorAttribute(string propertyName)
    {
        PropertyName = propertyName;
    }

    public string PropertyName { get; set; }

    protected override Validator DoCreateValidator(Type targetType)
    {
        var validator = new SuiteObjectValidator(PropertyName, targetType);
        return validator;
    }
} 
```

# c# - 在 C# 2.0+ 中，是否有必要锁定另一个线程将执行的闭包？

> ID：597012
> 
> 赞同：2
> 
> 时间：2009-02-27T23:00:15.080
> 
> 标签：c#, concurrency

在 C# 2.0+ 中，是否有必要锁定另一个线程将执行的闭包？具体来说，在下面的示例中，是否需要锁定以确保 Maint 线程将其 x 值刷新到共享内存并且线程 t 从共享内存中读取其 x 值？

我认为是，但如果我错了，请参考例如权威（例如，MSDN）文章，说明为什么不这样做。谢谢！

```
delegate void Foo();
public static void Main()
{
  Foo foo = null;
  object guard = new object();
  int x = 1;
  lock (guard)
  {
    foo = () =>
    {
      int temp;
      lock (guard) temp = x;
      Console.WriteLine(temp);
    };
  }
  Thread t = new Thread(() => foo());
  t.Start();
  t.Join();
} 
```

编辑：澄清我想知道 C# 2.0+，也就是说 .NET 2.0+ 更强的内存模型（比 ECMA 335 CLI）有效。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T23:14:34.310

调用任何构造函数在 .NET 内存模型中都有释放语义。（不是在 CLI 内存模型中，而是在 .NET 中。）所以通过调用`Thread`构造函数 - 以及委托构造函数本身 - 我相信你没问题。如果在最终构造函数*之后*将 x 设置为 1，我就不太确定了。（编辑：考虑到后面关于写入的内容，构造函数业务可能更多地与新的*Java*内存模型有关，而不是 .NET。）

事实上，我*怀疑*所有写入*都*具有释放语义（同样，在已实现的 .NET 内存模型中），但并非所有读取都具有获取语义。换句话说，数据将始终*可供*其他线程使用，但可能不会被这些线程*使用*。在这种情况下，新线程不会“拥有”变量的旧值——它不可能在开始之前从逻辑上读取该值，所以你在这方面是安全的。

我可以检查事物的“所有写入”方面——我怀疑 Joe Duffy 的博客或书中有关于它的内容。

编辑：来自“Windows 上的并发编程”P516：

> 更强的 2.0+ 模型的主要区别在于它可以防止商店被重新排序。

我*相信*这就足够了。我*怀疑*Stack Overflow 上很少有人能够肯定地说——我不会完全相信很多不在 MS CLR 或并发团队中的人，除了 Jeff Richter。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T23:01:45.340

除非超过 1 个线程可能同时执行它，否则不需要锁定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T23:18:50.307

你需要两件事：

1.  分配应该是原子的（不会被修改相同数据的另一个线程中断）。
2.  如果当前值已在另一个线程中更改，则线程需要获取当前值。

    1.  在 int 的情况下不需要锁定（请参阅[ECMA 344 C# 规范，查找 atomic](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-334.pdf)）。

    2.  不能通过锁定来保证。使用 volatile 确保这一点（参见同一文档中的 17.4.3.）。

总结：你不需要锁，但你可能需要 volatile。

编辑（见备注）：局部变量（在本例中为 x）上不可能有 volatile。在局部变量上，我不知道有什么可以保证 x 的多次读取（在同一个线程中）将获取在其他线程中所做的更改。在提供的代码中，只有一个读取存在，但我想这是一种简化。

# database-design - 什么标签模式最有效/最有效？

> ID：597016
> 
> 赞同：34
> 
> 时间：2009-02-27T23:00:54.453
> 
> 标签：database-design, tags

[http://tagging.pui.ch/post/37027745720/tags-database-schemas](http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html)

Stackoverflow 的标签处理是迄今为止我见过的最好的。

有谁知道这是否是一种模式模式，我可以从中获得一些想法？

否则，我只是在寻找其他人已成功实施的标签模式的建议。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-28T12:00:49.367

这一切都取决于数据量和内容与标签分布和密度比

如果您的标签分布和密度比（典型的人工生成数据）较低，您可以简单地为数据使用的每个可能的标签集合生成一个唯一的 id 或散列。将“标签集合”ID 与带有这些标签的每个数据实例相关联

这对于许多形式的人类生成的数据来说效果出奇的好

例如 Stackoverflow 有大约 500,000 个问题和大约 20,000 个标签（太多的欺骗标签！）。大多数问题的标签少于五个。在最坏的情况下，您将有 500,000 个“标签集合”ID 要关联，但更现实的是，您将有数千个

您还必须在“标签收集”集合上进行实例跟踪或垃圾收集，因为特定的标签组合不再使用

例如

*   标签：id，标签名
*   TagCollection：id，instanceCount
*   TagCollectionTag：tagCollectionIId，tagId
*   数据：id、title、content、tagCollectionId

如果使用散列（集合的所有标签上的散列），插入标签会很快。否则你必须搜索 TagCollection 和 TagCollectionTag 集合，但这不应该太大

搜索速度很快；在 TagCollectionTag 中搜索包含特定标签集的实例，然后查找具有任何这些 tagCollectionId 的数据行

希望这不会太令人困惑:-)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-27T23:23:32.980

你可以从这个开始： http: [//tagging.pui.ch/post/37027746608/tagsystems-performance-tests](http://tagging.pui.ch/post/37027746608/tagsystems-performance-tests)

在此提到： [Scaling Web Applications and Tagging - Digg, Del.icio.us, StackOverflow](https://stackoverflow.com/questions/551453/scaling-web-applications-and-tagging-digg-del-icio-us-stackoverflow)

# java - Oracle java存储过程中的类解析混淆

> ID：597022
> 
> 赞同：1
> 
> 时间：2009-02-27T23:03:28.817
> 
> 标签：java, oracle, java-stored-procedures, loadjava

我正在尝试在 oracle 中使用第三方 Java 库。该库似乎与我们的 Oracle 10g 服务器托管的相同 1.4 版本的 jvm 兼容，因为它在 Oracle 之外运行良好，所以我觉得我应该能够让它工作。这个库最终发出了基于 SOAP 的 http 请求，当我在 Oracle 中运行时，我得到了类解析错误。

这是显示差异的一行：

```
Class msgfact = Class.forName("com.sun.xml.messaging.saaj.soap.MessageFactoryImpl"); 
```

我尝试使用 loadjava 实用程序将这些库注册到 Oracle 中，我得到了我认为成功的结果：

```
C:\>loadjava -verbose -schema MYUSER -user MYUSER/MYPWD@dbinstance -force saaj-impl.jar

```

看起来一切都已加载，我可以在该列表中看到这个 MessageFactoryImpl 类。但后来我尝试从 Oracle SQL 运行这行代码（在我编写并加载了 loadjava 的另一个类中），这一行抛出 ClassNotFoundException (java.lang.ClassNotFoundException: com/sun/xml/messaging/saaj/soap/MessageFactoryImpl ）。

然后我回去尝试在 loadjava 命令行中添加“-resolve”开关。就像这些 saaj 类正在注册一样，但它们没有正确解析。

我怎样才能成功地将这些 saaj 类导入 Oracle，或者如果由于某种原因 Oracle 已经加载了这些类，我怎样才能说服我自己的代码成功使用现有的类？

FWIW，我已经采取措施确保授予了适当的套接字权限，并且我的代码可以成功地向目标 url 发出通用 http 请求。它只是在使用库的 SOAP 堆栈来实现它时遇到了麻烦。

编辑：这是我的 loadjava 结果示例。这似乎准确地显示了失败的原因，但我很困惑为什么这些特定类在预解决步骤中似乎得到正确处理时没有得到解决。我在这里删除了大约 80% 的文件，但还有其他类显示相同的类解析问题。

```
参数：'-verbose''-schema''MYSCHEMA''-user''MYSCHEMA/MYSCHEMA@actest''-resolve''-force''saaj-impl.jar'
[剪辑]
创建：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/EnvelopeFactory
加载：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/EnvelopeFactory
创建：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/GifDataContentHandler
加载：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/GifDataContentHandler
创建：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/JpegDataContentHandler
加载：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/JpegDataContentHandler
创建：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageFactoryImpl
加载：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageFactoryImpl
创建：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl
加载：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl
[剪辑]
解决： MYSCHEMA.com/sun/xml/messaging/saaj/soap/AttachmentPartImpl 类
解决：类MYSCHEMA.com/sun/xml/messaging/saaj/soap/Envelope
解决：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/EnvelopeFactory
错误：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/EnvelopeFactory
    ORA-29534: 引用的对象 MYSCHEMA.com/sun/xml/messaging/saaj/soap/SOAPPartImpl 无法解析
解决： MYSCHEMA.com/sun/xml/messaging/saaj/soap/GifDataContentHandler 类
解决： MYSCHEMA.com/sun/xml/messaging/saaj/soap/JpegDataContentHandler 类
解决： MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageFactoryImpl 类
错误：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageFactoryImpl
    ORA-29534: 引用的对象 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl 无法解析
错误：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl
    ORA-29534: 引用的对象 MYSCHEMA.com/sun/xml/messaging/saaj/soap/impl/EnvelopeImpl 无法解析
错误：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl$1
    ORA-29534: 引用的对象 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl 无法解析
跳过：类 MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl$2
[剪辑]
以下操作失败
    MYSCHEMA.com/sun/xml/messaging/saaj/soap/EnvelopeFactory 类：分辨率
    MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageFactoryImpl 类：分辨率
    MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl 类：分辨率
    MYSCHEMA.com/sun/xml/messaging/saaj/soap/MessageImpl$1 类：分辨率
[剪辑]
exiting ：处理过程中发生故障

```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-02T16:22:19.347

首先，在 Oracle 外部验证您要查找的类实际上在该 jar 文件中。我希望它是，但检查并没有什么坏处。

然后，我会检查已加载哪些类以及它们是否具有有效状态。

```
SELECT object_name, dbms_java.longname(object_name), status
  FROM user_objects
  WHERE object_type='JAVA CLASS'
  ORDER BY 1 
```

如果有很多类，您可能希望稍微限制这一点，例如：

```
WHERE dbms_java.longname(object_name) LIKE '%MessageFactoryImpl' 
```

如果该类不存在，或者存在错误的包名，则问题出在 loadjava 命令上。

如果该类存在但其状态为 INVALID，则检查 USER_ERRORS 以查看错误是什么。我不记得我是否在 Oracle 中完成了动态类加载，但我记得静态链接会给出错误，暗示一个类在真正存在但有错误时不存在。

**发布 loadjava 输出后的新信息**

loadjava 输出似乎与您在数据库中查找类的尝试不一致。如果它正在加载但未解决，它仍应列出，但状态为 INVALID。

我得到了 JAR，并在一个空模式中自己尝试了它。类加载但按预期无效：

```
dev> select object_name, dbms_java.longname(object_name),status
  2  from user_objects
  3  where object_name like '%MessageFactoryImpl';

OBJECT_NAME
--------------------------------------------------------------------------------
DBMS_JAVA.LONGNAME(OBJECT_NAME)
--------------------------------------------------------------------------------
STATUS
-------
/3e484eb0_MessageFactoryImpl
com/sun/xml/messaging/saaj/soap/MessageFactoryImpl
INVALID 
```

然后我检查了课堂上的错误：

```
dev> alter java class "com/sun/xml/messaging/saaj/soap/MessageFactoryImpl" resolve;
dev> /

Warning: Java altered with compilation errors.

dev> show error
Errors for JAVA CLASS "/3e484eb0_MessageFactoryImpl":

LINE/COL ERROR
-------- -----------------------------------------------------------------
0/0      ORA-29521: referenced name javax/xml/soap/MessageFactory could
         not be found

0/0      ORA-29521: referenced name javax/xml/soap/SOAPMessage could not
         be found

0/0      ORA-29521: referenced name javax/xml/soap/MimeHeaders could not
         be found

0/0      ORA-29521: referenced name javax/xml/soap/SOAPException could not
         be found 
```

（这些错误也将列在 USER_ERRORS 中，假设至少尝试了一次解决。）

很明显，这个类引用了基础 SOAP 库中的类。你也必须加载它——你这样做了吗？

仅供参考，当我编写一些代码来调用 Class.forName() 时，我确实得到了 ClassNotFoundException。这似乎违反直觉，因为类对象确实存在于模式中。但是，从 Oracle 中的类加载器的角度来看，一个无效的类并不真正“存在”。为了使该类有效，Oracle 必须能够解析其对其他类的所有引用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T02:07:54.507

这是您第一次在数据库上执行 Java 吗？这是 hello world 实现，可确保您的 Oracle JVM 正常运行并且您拥有必要的权限。你说“我的数据库模式，所以我可以做任何我想做的事”——并不意味着你有适当的授权。

```
SQL> create or replace and compile java source named "Hello" as 
   public class Hello{ 
      public static String world() { 
         return "Hello World "; 
      } 
   }; 
/ 

Java created. 
```

现在包装函数

```
SQL> create or replace function Hello RETURN VARCHAR2 
     as LANGUAGE JAVA NAME 'Hello.world() return String'; 
     / 

Function created. 
```

现在测试一下

```
SQL> select Hello from dual; 

HELLO 
----------------------------------- 
Hello World 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T02:22:47.447

做这个：

```
try
{
    System.out.println("Class.forName returned: " + 
        Class.forName("com.sun.xml.messaging.saaj.soap.MessageFactoryImpl"));
}
catch(final Throwable ex)
{
    ex.printStackTrace();
    System.exit(1);
} 
```

只是为了 100 和 10% 确定它没有抛出以某种方式被隐藏的异常并且它确实返回 null。如果仍然是这种情况，请告诉我（如果上面的代码有效，但返回 null，这是一个有趣的问题）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T21:55:26.380

尝试# 3 :-)（我不使用 Oracle ......但这是一个很好的调试问题......）

Oracle 中 Class.forName 上的信息有帮助吗？

[http://download.oracle.com/docs/cd/B14117_01/java.101/b12021/appover.htm#i1006547](http://download.oracle.com/docs/cd/B14117_01/java.101/b12021/appover.htm#i1006547)

这表现为 ClassLoader 问题，因此该解决方案与“真实的、非 Oracle”世界中发生的情况相同：-)

编辑...再试一次...

好的，再看一下……以下的输出是什么：

```
System.out.println("vm vendor:     " + System.getProperty("java.vendor"));
System.out.println("vm version:    " + System.getProperty("java.version"));
System.out.println("class version: " + System.getProperty("java.class.version")); 
```

我想知道类文件版本是否存在问题 - 类文件是否具有无法在 Oracle VM 上运行的版本？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T09:41:51.227

类解析和加载是由 VM 处理的复杂操作。规范中描述的这两个操作要使用的算法对 VM 实现者是开放的。我的感觉是，在您的情况下，该解决方案作为操作仅检查类本身的可用性，而稍后在尝试有效加载类时失败（很可能是由于缺少依赖项：加载类时，VM 需要至少解决对其他类的所有直接引用）。您必须确保 Oracle 可以使用所有类，并在 Google 上快速搜索 ORA-29534 会发现很多人都遇到了这个问题（我很确定有人已经弄清楚了）。

./亚历克斯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-08T21:42:22.477

saaj-impl.jar 是 Web Services Developer Pack 的 SAAJ 组件的一部分。它依赖于 SAAJ 附带的其他 JAR，例如，据我所知，它肯定依赖于 saaj-api.jar 和 activation.jar。当然，saaj-api.jar 也必然依赖于许多其他 JAR。

就 JWSDP 1.5 而言，您可以在[JWSDP 1.5 发行说明](http://java.sun.com/webservices/docs/1.5/ReleaseNotes.html)中找到有用的信息。JWSDP 1.6 在 SAAJ 中有不同的 JAR 我还没有发现 JWSDP 2.0 发行说明在这方面特别有用。顺便说一句，JWSDP 2.0 会在类路径中放置不同的 JAR；所以你的问题的范围最终取决于你使用的 saaj-impl.jar 的版本。

以防万一您可能需要它，以下页面中已经提供了一些关于如何将 SOAP 客户端 JAR 加载到 Oracle 数据库中并使用它们的文档。我认为这些与您的库附带的 SAAJ JAR 不同。

*   [从数据库调用 web 服务](http://www.oracle.com/technology/products/jdev/howtos/10g/WS_DBCallout/DBCalloutWS_HowTo.htm)。
*   [如何在 Oracle 数据库中安装 SOAP 客户端堆栈](http://www.oracle.com/technology/sample_code/tech/java/jsp/loadjars.html)。
*   [在数据库中安装 JAR 文件](http://www.oracle.com/technology/products/jdev/howtos/10g/WS_LoadJava/LoadJava_HowTo.html)

# wix - 如何在没有许可证页面的情况下构建最小的 WiX 安装程序 UI？

> ID：597025
> 
> 赞同：77
> 
> 时间：2009-02-27T23:05:05.207
> 
> 标签：wix, installation, wix3

我想使用 WixUI_Minimal 安装程序，但我不想要许可证页面。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2011-02-09T17:31:14.100

我会简单地使用一个已经创建的 WiX UI 并覆盖序列（使其更高，以便它将覆盖以前的设置）：

```
 <Product> 
        ...
        <UI>
            <UIRef Id="WixUI_InstallDir" />

            <!-- Skip license dialog -->
            <Publish Dialog="WelcomeDlg"
                     Control="Next"
                     Event="NewDialog"
                     Value="InstallDirDlg"
                     Order="2">1</Publish>
            <Publish Dialog="InstallDirDlg"
                     Control="Back"
                     Event="NewDialog"
                     Value="WelcomeDlg"
                     Order="2">1</Publish>
        </UI>

        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
        ...
    </Product> 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-02-27T23:21:24.327

关键是制作自定义 UI 并连接不同的页面。请参阅[WixWiki上的页面](https://wixtoolset.org/documentation/)

您想获取[WixUI 最小代码](https://github.com/wixtoolset/wix3/blob/develop/src/ext/UIExtension/wixlib/WixUI_Minimal.wxs)，并对其进行一些修改。您想使用 WelcomeDlg，而不是 WelcomeEulaDlg 欢迎对话框。调整引用，并将 WelcomeDlg 上的 Next 按钮连接到堆栈中的下一个对话框，即 PrepareDlg。

完整代码：

```
 <UI Id="WixUI_Minimal">
    <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
    <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
    <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

    <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
    <Property Id="WixUI_Mode" Value="Minimal" />

    <DialogRef Id="ErrorDlg" />
    <DialogRef Id="FatalError" />
    <DialogRef Id="FilesInUse" />
    <DialogRef Id="MsiRMFilesInUse" />
    <DialogRef Id="PrepareDlg" />
    <DialogRef Id="ProgressDlg" />
    <DialogRef Id="ResumeDlg" />
    <DialogRef Id="UserExit" />

    <!-- This is the welcome dialog you specified-->
    <DialogRef Id="WelcomeDlg" /> 

    <!-- Hook the new welcome dialog to the next one in the stack-->
    <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="PrepareDlg">1</Publish> 

    <Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>

    <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>

    <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>

    <Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
    <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
    <Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg">1</Publish>

    <Property Id="ARPNOMODIFY" Value="1" />
  </UI>

  <UIRef Id="WixUI_Common" /> 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-03-02T23:23:03.313

解决此问题的低技术方法是将属性设置`LicenseAccepted`为`1`并将一些有用的自述文件类型信息放入许可证框中。这意味着用户不必单击该框，您也不必担心创建额外的对话框:)

例子：

```
<Property Id="LicenseAccepted" Value="1"/> 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-04-02T17:36:11.323

请参阅[相关问题的答案](https://stackoverflow.com/a/259685/149060)，[WiX script with only Welcome and Completed 屏幕](https://stackoverflow.com/questions/200743/wix-script-with-only-welcome-and-completed-screens/259685#259685)，以获得最简单的最小 UI：

2.  欢迎Dlg
3.  安装进度
4.  退出对话框

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-06-24T10:09:50.917

@Ran Davidovitz 的回答非常好

但要小心：

```
<Publish Dialog="InstallDirDlg"
         Control="Back"
         Event="NewDialog"
         Value="WelcomeDlg"
         Order="2">1</Publish> 
```

它必须有**Order="2"**，否则它不能工作。

# javascript - 如何对查询字符串进行编码，使其成为javascript中另一个查询字符串的值？

> ID：597028
> 
> 赞同：57
> 
> 时间：2009-02-27T23:06:59.477
> 
> 标签：javascript, encoding, query-string

我有一个 javascript 函数，它作为查询字符串值传递另一个查询字符串。

换句话说，我希望查询字符串是：

```
http://www.somesite.com/?somequery=%3fkey%3dvalue1%2520%26%2520key2%3value3 
```

但是，如果我这样重定向：

```
var url = 'http://www.somesite.com/?somequery=';
url += escape('?key=value1&key2=value2');
window.location = url; 
```

它以`http://www.somesite.com?somequery=?key1=value1&key2=value2`Firefox 和 IE7 的形式结束，这意味着我无法正确解析查询字符串。

我也尝试使用也不起作用的 encodeURIComponent 。

是否有其他功能或黑客强制重定向以保持`somequery`值转义？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-02-27T23:14:33.127

encodeURIComponent 将起作用。（您可能需要也可能不需要前导“？”，具体取决于脚本的预期。）

```
var c= 'd e'
var query= '?a=b&c='+encodeURIComponent(c);
var uri= 'http://www.example.com/script?query='+encodeURIComponent(query);
window.location= uri; 
```

带我去：

> [http://www.example.com/script?query=%3Fa%3Db%26c%3Dd%2520e](http://www.example.com/script?query=%3Fa%3Db%26c%3Dd%2520e)

当您将鼠标悬停在它上面时，它可能会在浏览器的状态栏中显示一次解码，但您最终会出现在正确的位置。

escape/unescape() 对查询参数进行编码是错误的，它会获取 Unicode 字符和加号错误。几乎从来没有一种情况是 escape() 是你真正需要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-06-08T14:01:15.410

本机`escape`方法可以做到这一点。但您也可以创建自定义编码器，例如：

```
function encodeUriSegment(val) {
  return encodeUriQuery(val, true).
             replace(/%26/gi, '&').
             replace(/%3D/gi, '=').
             replace(/%2B/gi, '+');
} 
```

这将替换查询字符串中使用的键。此外，您可以通过添加所需的键值对将其应用于任何其他自定义编码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-02-05T06:23:14.467

```
function downloadFile(){
      var filePath = "C:/Users/HP/Desktop/Project Folder/DemoProject/";

      var fileInfo = "Error_Issue Minor Cosmetic & Major Fatal Issues (Demo_Project) (2017)_GeneratedOn_12_21_2017 21924 AM.xlsx";
      if((filePath != undefined && filePath.length > 0) && (fileName != undefined && fileName.length > 0)){
        var downloadUrl = "../download?fileName="+encodeURIComponent(fileName)+"&filePath="+encodeURIComponent(filePath);
        $window.location = downloadUrl;
      }else{
        alert("Please define a fileName for downloading...");
      }
} 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-02-27T23:12:17.500

```
javascript:alert(escape('?key=value1&key2=value2')); 
```

适合我吗？

# networking - NetXtreme II (BCM 5708) 每秒 UDP 数据包？

> ID：597034
> 
> 赞同：1
> 
> 时间：2009-02-27T23:09:26.180
> 
> 标签：networking, sockets

是否有其他人对此 NIC 在不丢弃任何 UDP 流量的情况下每秒可以接收多少个数据包有任何基准？使用 64 字节 UDP 数据包，我看到大约 100k 数据包/秒直到丢弃。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T23:33:45.217

我已经`dnsperf`在 HP DL785 上使用多个作为数据包生成器和虚拟回显程序进行了测试，其中有四个这样的 NIC，运行 CentOS 5.2

您看到的 100 kpps 数字*大约*是正确的数量级 - 以我的经验，除此之外，内核仅处理来自 NIC 的中断就保持一个内核完全占用。

# c# - 如何将一个图形对象复制到另一个

> ID：597037
> 
> 赞同：4
> 
> 时间：2009-02-27T23:12:10.433
> 
> 标签：c#, .net, vb.net, graphics, gdi+

我正在尝试将一个图形对象的内容复制到另一个，但我唯一能找到的是基于 using `GDI32.DLL`，如果可能的话我宁愿避免使用。

有谁知道如何/是否可以使用托管代码？我不介意答案是在 C# 还是 VB.Net 中。

这是我目前拥有的：

```
Private Sub CopyGraphics()
    Dim srcPic As Graphics = pnl.CreateGraphics

    Dim srcBmp As New Bitmap(pnl.Width, pnl.Height, srcPic)
    Dim srcMem As Graphics = Graphics.FromImage(srcBmp)

    Dim HDC1 As IntPtr = srcPic.GetHdc
    Dim HDC2 As IntPtr = srcMem.GetHdc

    BitBlt(HDC2, 0, 0, pnl.Width, pnl.Height, HDC1, 0, 0, 13369376)

    pnlDraw.BackgroundImage = srcBmp

    'Clean Up code omitted...
End Sub 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T23:32:28.027

严格来说，不可能使用任何方法将 Graphics 对象的内容复制到任何地方，因为 Graphics 对象不包含任何内容。

为什么不用 DrawToBitmap 方法在位图上绘制控件呢？

```
Dim srcBmp As New Bitmap(pnl.Width, pnl.Height)
Dim clip As New Rectangle(New Point(0, 0), pnl.Size)
pnl.DrawToBitmap(srcBmp, clip) 
```

# .net - 什么是 ASP.NET WebForm 的“页面生命周期”？

> ID：597042
> 
> 赞同：23
> 
> 时间：2009-02-27T23:13:37.950
> 
> 标签：.net, asp.net, .net-2.0, webforms, page-lifecycle

我希望对 ASP.NET 页面生命周期有更透彻的了解。我正在构建自定义表单控件，并且发现我在这方面的知识缺乏。

*   是否有任何资源、教程等可以帮助您更好地理解这一领域？*   您是否使用过任何工具来提高您在该领域的知识？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-27T23:17:13.323

我的钉板上有这个。在您使用母版页时很有帮助。

1.  内容页面 PreInit 事件
2.  母版页控件 Init 事件
3.  内容控件初始化事件
4.  母版页初始化事件
5.  内容页面初始化事件
6.  内容页面加载事件
7.  母版页加载事件
8.  母版页控件加载事件
9.  内容页面控件加载事件
10.  内容页面 PreRender 事件
11.  母版页 PreRender 事件
12.  母版页控制 PreRender 事件
13.  内容页面控制 PreRender 事件
14.  母版页控件 Unload 事件
15.  内容页面控件 Unload 事件
16.  母版页卸载事件
17.  内容页面卸载事件

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-27T23:23:57.860

我发现这个图表非常有用。提供有关该部分正在做什么的简要描述... [John-Sheehan ASP.NET 生命周期事件](http://lh4.ggpht.com/realnero/SGs-58G1jKI/AAAAAAAAAto/YgbkErfakOY/s1600-h/life%5B5%5D.jpg)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-27T23:56:47.407

这是“原始”MSDN 概述。不错：

[http://msdn.microsoft.com/en-us/library/ms227435.aspx](http://msdn.microsoft.com/en-us/library/ms227435.aspx)

老实说，你不应该需要我们的帮助来找到这些东西。试试谷歌。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-27T23:14:55.620

该图在确定事件顺序方面特别有用，但没有详细说明它们。

![ASP.NET 页面生命周期](https://i.stack.imgur.com/QlbRI.jpg)

[原始链接](http://web.archive.org/web/20140605132938/http://www.eggheadcafe.com/articles/o_aspnet_page_lifecycle.jpg)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-27T23:34:43.997

这并没有直接回答页面生命周期问题，但它涵盖了全局事件生命周期以及 BeginRequest 和 EndRequest 等事件。很高兴了解这些与 Pages 相关的工作原理。

[https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5771721.html](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5771721.html)

# asp.net - 合并 3 个不同的文件

> ID：597057
> 
> 赞同：0
> 
> 时间：2009-02-27T23:20:04.453
> 
> 标签：asp.net, file, merge

**类似于：**

[https://stackoverflow.com/questions/170309/three-way-merge](https://stackoverflow.com/questions/170309/three-way-merge) [https://stackoverflow.com/questions/460198/best-free-3-way-merge-tool-for-windows](https://stackoverflow.com/questions/460198/best-free-3-way-merge-tool-for-windows)

我正在运行 2 个网站。一个正在运行.net 3.5，另一个没有。在运行 3.5 的站点上，我也有旧版本。现在，我正在浏览 3.5 和 2.0，查看所有差异并尝试确定哪些是特定于升级的，哪些只与网站的设计内容有关。我正在寻找一种方法来比较第一个站点的 2 个版本，寻找差异，然后将这些差异应用到 site1 和 site2 相同的地方。有谁知道 Windows/Linux 中可以做到这一点的任何程序/命令？还是我应该继续手动搜索（有超过 25,000 个差异需要检查）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T23:23:07.520

您需要的是具有三向合并功能的程序。

请参阅[此现有 SO 帖子](https://stackoverflow.com/questions/460198/best-free-3-way-merge-tool-for-windows)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T23:24:47.500

许多差异工具能够进行三向合并（将文件的两个修订版之间的更改合并到第三个修订版中）。参见：[三路合并](https://stackoverflow.com/questions/170309/three-way-merge)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T00:54:09.937

尝试[超越比较](http://gofrom.us/E6W)。

# python - xml.dom.minidom：获取 CDATA 值

> ID：597058
> 
> 赞同：12
> 
> 时间：2009-02-27T23:20:56.340
> 
> 标签：python, xml

我能够获取图像标签中的值（请参阅下面的 XML），但不能获取类别标签。不同之处在于一个是 CDATA 部分，另一个只是一个字符串。任何帮助，将不胜感激。

```
from xml.dom import minidom

xml = """<?xml version="1.0" ?>
<ProductData>
    <ITEM Id="0471195">
        <Category>
            <![CDATA[Homogenizers]]>        
        </Category>
        <Image>
            0471195.jpg
        </Image>
    </ITEM>
    <ITEM Id="0471195">
        <Category>
            <![CDATA[Homogenizers]]>        
        </Category>
        <Image>
            0471196.jpg
        </Image>
    </ITEM>
</ProductData>
"""

bad_xml_item_count = 0
data = {}
xml_data = minidom.parseString(xml).getElementsByTagName('ProductData')
parts = xml_data[0].getElementsByTagName('ITEM')
for p in parts:
    try:
        part_id = p.attributes['Id'].value.strip()
    except(KeyError):
        bad_xml_item_count += 1
        continue
    if not part_id:
        bad_xml_item_count += 1
        continue
    part_image = p.getElementsByTagName('Image')[0].firstChild.nodeValue.strip()
    part_category = p.getElementsByTagName('Category')[0].firstChild.data.strip()
    print '\t'.join([part_id, part_category, part_image]) 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-27T23:40:50.270

> p.getElementsByTagName('Category')[0].firstChild

minidom 不会将 <![CDATA[ 部分展平为纯文本，而是将它们保留为 DOM CDATASection 节点。（可以说它应该，至少是可选的。DOM Level 3 LS 默认将它们展平，因为它的价值，但 minidom 比 DOM L3 旧得多。）

因此 Category 的 firstChild 是一个 Text 节点，表示 <Category> 打开标记和 CDATA 部分的开头之间的空白。它有两个兄弟节点：CDATASection 节点和另一个尾随空白文本节点。

您可能想要的是 Category 的所有子项的文本数据。在 DOM Level 3 Core 中，您只需调用：

```
p.getElementsByTagName('Category')[0].textContent 
```

但 minidom 还不支持。但是，最近的版本确实支持另一种 3 级方法，您可以使用它以更迂回的方式做同样的事情：

```
p.getElementsByTagName('Category')[0].firstChild.wholeText 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-27T23:44:06.877

CDATA 是它自己的节点，所以这里的 Category 元素实际上有三个子节点，一个空白文本节点、CDATA 节点和另一个空白节点。你只是看错了，仅此而已。我看不到任何更明显的查询 CDATA 节点的方法，但您可以像这样将其拉出：

```
[n for n in category.childNodes if n.nodeType==category.CDATA_SECTION_NODE][0] 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-05-27T12:00:47.353

我遇到了类似的问题。我的解决方案与 Ironfroggy 的回答类似，但以更通用的方式实现：

```
for node in parentNode.childNodes:
        if node.nodeType == 4:
            cdataContent = node.data.strip() 
```

CDATA 的节点类型为 4 ( [`CDATA_SECTION_NODE`](https://developer.mozilla.org/en/docs/Web/API/Node/nodeType))

# nginx - 使用 nginx 重写来隐藏或清理 URL？

> ID：597059
> 
> 赞同：3
> 
> 时间：2009-02-27T23:21:14.857
> 
> 标签：nginx, rewrite

问候。

我一直在尝试理解正则表达式和重写，但我是新手。我有一个简单的站点，只有一个目录，我想要的只是将 domain.com/file.php?var=value 重写为 domain.com，确保用户在整个站点导航过程中只会在地址栏中看到 domain.com（即使我开始让网站变得更复杂）。

简单地说，它冻结了 url，虽然如果网站增长，我宁愿做一些“干净的 url”方法，但我仍然在基本 php，我觉得我必须在 http/1.1 上进行 rtfm

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T05:13:26.883

您可以像这样使用 nginx 重写规则：

```
rewrite  ^([^.]*)$  /index.php 
```

发送所有不包含“.”的请求 到您的 index.php 脚本。在你的php脚本中，爆破请求url获取传入的参数，然后调用你想要的php页面：

```
#URL /people/jack_wilson
$url_vars = explode('/',$_SERVER['request_uri']); # array('','people','jack_wilson');
$page = $url_vars[1];
if($page == 'people'){
   $username = $url_vars[2];
   require('people.php'); #handle things from here.
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T23:35:18.897

通常，这种“干净”的 URL 内容通常是通过整个站点的包装框架来完成的。浏览器仅显示该框架的 URL，内容可以是任何内容。

但我实际上并不推荐它，因为用户可能希望将“脏”URL 加入书签。

这种类型的 URL 混淆会降低高级用户的可用性。

不要成为一个混蛋，但我通常只在“艺术”网站上看到这种类型的 URL 混淆，这些网站更关心地址栏的外观而不是网站的可用性。恕我直言，通过增强可用性让您的用户满意是一种更好的长期方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T23:40:01.520

我想冻结 url 是由营销需求驱动的，所以从营销的角度来看，这也是不利的：您的用户将无法通过 IM、电子邮件或 Facebook 将他们喜欢的页面的链接发送给他们的朋友，因此，即使对于最无知的用户，它实际上也会降低您网站的吸引力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T23:53:28.040

我不（有意识地）认为在地址栏中显示 php 变量是安全的（尽管它们无论如何都会显示在某些浏览器的状态栏中......）。理想情况下，用户不会知道该网站在幕后使用的是什么——我正在为初学者配置错误页面。是的，对于美学也是如此。如果我可以重写到 domain.com/foo/bar 我会很高兴；假设 nginx 如果收到这样的请求会处理“转换回丑陋的 URL”，我认为它与位置指令有关。但是拥有 domain.com/file.php?var1=value&var2=value 有点让我烦恼，让我觉得我暴露了太多网站。

不推荐使用框架（尤其是“搜索引擎的 cos”），我正在尝试坚持使用 xhtml 1.1 Strict（到目前为止还不错）。如果内容设计良好，易于导航，无论浏览器选择如何，都可以访问，直观等......我想我可以忍受可爱的 URL :)

我很乐意浏览任何关于良好网页设计技术、php、http/1.1 的 rtfm 材料以及任何让你走“是的！这就是我一直在寻找的东西！” 凌晨 4 点。

谢谢 ：）

[如果我对这个网站的理解正确，这应该是对原始帖子的回复，而不是对答案......对不起]

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-28T05:42:32.693

您还可以查看一个 PHP 框架，例如 Code Igniter，它将为您处理所有 PHP 方面。

[http://codeigniter.com/](http://codeigniter.com/)

# c++ - 扩展一个没有源代码重新编译的抽象基类？

> ID：597063
> 
> 赞同：0
> 
> 时间：2009-02-27T23:22:47.367
> 
> 标签：c++

忽略这一点，我想到了一个涉及标头生成的解决方法。这不是最好的解决方案，但它有效。这个问题理解起来很奇怪。基本上我想调用一个尚未在 lib 或 dll 中声明的虚函数并正常使用它（但它没有实现/空函数）。

我的库中有一个抽象基类。我所有的插件都继承自它，用户插件继承自这个类，他的应用程序使用这个类作为插件指针。我希望该用户能够扩展类并添加他的功能。问题是，我确定如果他添加了一个虚函数并尝试调用它，代码将会崩溃，因为我的对象在其 vtable 中没有额外的数据。我该如何解决这个问题？我想过继承它，但是当第三个用户来玩时，这会导致丑陋的问题。我不希望他进行类型转换以发送扩展功能。

我在想一个 msg 函数，比如 intptr_t sendMsg(enum msgName, void* argv); 但这消除了安全性，我需要对所有内容进行类型转换。什么是最好的解决方案？我宁愿使用 vtables，然后使用 sendMsg 函数。我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T23:34:16.323

我认为您可以使用注册和回调机制

您的插件可以提供抽象基类“Base”和功能

```
Register(Base *); 
```

现在客户端可以调用插件注册功能

```
Register(b); 
```

其中 b 定义为

```
Base *b = new Derived; 
```

其中 Derived 是从 Base 派生的新类

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T01:01:12.073

您是在问是否可以在不重新编译的情况下将虚函数添加到**基**类中？对此的简短回答是“不”。长答案在您的问题中，您必须提供某种通用的“call_func”接口，允许您“动态”调用函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T01:35:55.173

我不是 100% 确定我看到了问题。
如果 user1 派生类型扩展了您的基类（使用更多虚拟方法），那应该没问题（当然您的代码永远不会知道或理解这些新方法，但大概您不会调用它们：

```
class B
{
    virtual void doStuff() { /* Nothing */}
};

// User 1 version:
class U1: public B
{
     virtual void doStuff()
     {
         this->doA();
         this->doB();
     }
     virtual void doA()  {}
     virtual void doB()  {}
};

// User 2 version can extend it differently. 
```

注意：
如果您因为将对象存储在向量中而担心切片，那是一个稍微不同的问题。

```
std::vector<B>   objs;
objs.push_back(U1());

std::for_each(objs.begin(),objs.end(),std::mem_fun_ref(&B::doStuff)); 
```

这里的问题是用户定义的类型 U1 不能复制到向量中，因为向量只包含 B 个对象。这会切掉 U1 中保存的额外数据。

这个问题的解决方案是你需要在向量中保存指针。这当然会导致异常安全的其他问题。所以 boost 有 ptr_vector<> 容器来正确保存对象，但仍然让它们像对象一样使用。

```
 #include <boost/ptr_container/ptr_vector.hpp>

 ......

boost::ptr_vector<B>   objs;
objs.push_back(new U1());

std::for_each(objs.begin(),objs.end(),std::mem_fun_ref(&B::doStuff)); 
```

# jquery - 在 Firefox 中使用 jquery 的 AJAX https POST 请求失败

> ID：597073
> 
> 赞同：3
> 
> 时间：2009-02-27T23:25:16.297
> 
> 标签：jquery, ajax, firefox, firefox-3

我在 HTML 表中有一个简单的记录列表，每行都有一个删除链接。删除链接将 AJAX 发布请求发送到固定 url，如下所示：“ `/delete/record/5`”

`.ajax()`AJAX 请求是在使用 https 的服务器上运行时使用带有 POST 消息的 jquery调用创建的。此调用在 OSX/Windows 架构上的 Firefox 3 中失败。它适用于我测试过的所有其他浏览器（OSX/Windows：Chrome、Safari、IE7。）

这些请求来自一个 https 站点并转到同一个 https 站点。但我认为在这个过程中的某个地方，原始请求以 http 开始，并且我们的服务器上尝试重定向从 http->https 发送它，而 Firefox 拒绝该重定向作为某种类型的伪造。

有没有人有过`.ajax()`使用 Firefox 在 https 网站上进行 JQuery 调用的经验？我注意到一些奇怪的地方，如果请求`?var=xxx`在 URL 中有“”参数，则请求似乎比没有这些变量的请求更频繁地工作。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-28T03:18:58.063

[听起来您收到了 HTTP 411 错误。](http://groups.google.com/group/jquery-en/browse_thread/thread/22828981cf23bdc4). 如果您发送的`POST`请求没有任何`data`.

要解决此问题，请在请求的属性中添加一个空对象 ( `{}`) ：`data`

```
$.ajax({ 
    url: url, 
    type: 'POST', 
    data: {}, // <- set empty data 
    success: function(data, textStatus) { 
        // do something 
    } 
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T23:42:39.157

这似乎不太可能......不是我怀疑你。但我建议下载 Wireshark 并观察你的 HTTP 流量，看看你是否无法隔离问题。您将能够将其他浏览器发送的请求与 FF3 发送的请求进行比较，并查看返回的响应类型。如果确实是 jQuery 在 FF3 中无法正常运行的问题，您也许可以更改一些代码以使其正常运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T23:47:25.247

您可能可以安装 Firefox Live Headers 扩展，它可以让您访问请求/响应中的所有信息。这样你就会发现任何差异。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T00:35:47.173

您的 Firefox 上是否安装了任何插件或 GreaseMonkey 脚本？

我从来没有遇到过 HTTPS 上的 jQuery AJAX 请求问题。如果你还没有的话，我建议你看看[Firebug出现了什么。](http://getfirebug.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T21:33:38.157

我`$.post`通过发送一个空对象作为`data`参数在 Firefox 中工作。注意参数 2 的空括号：

```
$.post(url, {}, function(response){ alert('done'); }, "json"); 
```

# vim - 学习 Vim 有什么好处？

> ID：597077
> 
> 赞同：465
> 
> 时间：2009-02-27T23:27:07.933
> 
> 标签：vim, editor

作为一名程序员，我在键盘上花了很多时间，而且在过去的 12 年里，我或多或少地一直在这样做。如果有什么我在这段时间里从未习惯过的事情，那就是由于一些最常见的代码编辑任务，我在编码时遇到了这些烦人的、几乎是无意识的持续微中断。诸如从不同行（甚至同一行）进行简单复制和粘贴，或从当前位置向上或向下移动 1 或 2 行之类的操作需要输入过多或涉及使用箭头键...当我想进一步移动时更糟糕 - 我最终使用鼠标。现在想象同样的场景，但在笔记本电脑上。

我一直考虑学习 VIM，但掌握它所需的时间总是让我想退后一步。

我想听听那些已经学会它的人，如果它最终成为你不能没有的东西之一。

在工作中，我使用 VS2008、C# 和 R#，它们一起使编辑代码比以往任何时候都更快、更容易，但即便如此，我认为我可以享受完全不用鼠标的乐趣。

甚至没有箭头键。

* * *

## 回答 #1

> 赞同：249
> 
> 时间：2009-02-27T23:31:44.160

我使用 vi 和 vim 也有 20 年了，而且我还在学习新东西。

David Rayner 的[Best of Vim Tips](http://vim.wikia.com/wiki/Best_Vim_Tips)站点是一个很好的列表，尽管一旦您对 vim 有所熟悉，它可能会更有用。

我还想提一下[ViEmu](http://viemu.com)网站，它有一些关于[vi/vim 技巧](http://www.viemu.com/vi_vim_tips.html)的重要信息，尤其是文章[Why, oh WHY, do those nutheads use vi?](http://www.viemu.com/a-why-vi-vim.html) （[存档版本](http://web.archive.org/web/20121010104931/http://www.viemu.com/a-why-vi-vim.html)）

* * *

## 回答 #2

> 赞同：183
> 
> 时间：2009-02-27T23:49:46.613

没有它我还能活吗？容易地。

有用吗？是的。

## 学习的理由

*   vi 保证存在于所有 Unix 系统上，并且也存在于大多数 Linux 系统上。这种广泛的覆盖面使学习变得值得。

*   `sudo`使用 vi 进行编辑要快得多：

    $须藤六

*   此外，GMail 使用 vi-ish 命令来选择和移动电子邮件！

你不必成为大师。

刚学

## 基础：

*   如何从命令模式切换到插入模式`i`
*   如何从插入模式切换到命令模式`Esc`
*   如何在命令模式下向上导航一行`k`
*   如何在命令模式下向下导航一行`j`
*   如何在命令模式下左导航字符`h`
*   如何正确导航字符`l`
*   如何保存文件`:w``Enter`（写入）
*   如何在不保存的情况下退出（在命令模式下）`:q!``Enter`
*   如何撤消`u`
*   如何重做`Ctrl`+`r`
*   您可以结合写入和退出（在命令模式下）：`:wq``Enter`

从那里剩下的只会让你更快。

* * *

## 回答 #3

> 赞同：138
> 
> 时间：2009-02-27T23:31:41.743

跑完[vimtutor](http://linuxcommand.gds.tuwien.ac.at/man_pages/vimtutor1.html)只用了30分钟，对vim已经足够熟悉了。每一秒都是值得的。

* * *

## 回答 #4

> 赞同：69
> 
> 时间：2009-02-28T00:05:55.420

如果您是编辑大量文本的程序员，那么学习 A Serious Text Editor 很重要。您学习哪种严肃文本编辑器并不是非常重要，并且很大程度上取决于您希望在其中进行编辑的环境类型。

原因是这些编辑器经过高度优化，可以执行您将要做的大量任务。例如，考虑在每一行的末尾添加相同的文本位。这在 A Serious Text Editor 中是微不足道的，但在其他方面却非常麻烦。

通常会考虑 vim 的杀手级功能：A）它在您遇到的几乎所有 Unix 上都可用，并且 B）您的手指很少需要离开主行，这意味着您将能够非常非常快速地编辑文本. 即使在编辑大文件时，它通常也非常快速和轻量级。

但是，有很多选择。当然，Emacs 是最常见的示例，如果您真正深入研究它，它不仅仅是一个高级文本编辑器。在使用 vim/gvim 多年之后， 我个人现在是一个非常高兴的[TextMate用户。](http://macromates.com/)

切换到其中任何一个的诀窍是强迫自己按照预期的方式使用它们。例如，在 vim 中，如果您手动执行多步骤过程中的每个步骤，或者如果您使用箭头键或鼠标，那么可能有更好的方法来执行此操作。停止你正在做的事情并查看它。

如果您什么都不做，请学习 vim 和 Emacs 的基本导航控件，因为它们无处不在。例如，您可以在 Mac OS、大多数 Unix shell、Eclipse 等中的任何文本输入字段中使用 Emacs 样式控件。您可以在[Slashdot](http://slashdot.org/index2.pl)上、[gmail上的](https://mail.google.com/)[less](http://unixhelp.ed.ac.uk/CGI/man-cgi?less) (1) 命令中使用 vim 样式控件，等等

玩得开心！

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2010-05-06T13:43:23.573

这*绝对*是值得的。

任何使用过的人都会告诉你一个明显的原因`Vi(m)`，还有两个人们似乎从未提及的原因。

这是显而易见的：

1.  `vi`它无处不在，而且非常强大，只需学习一次，您就可以在几乎任何有键盘的计算机上行使这种能力。

这些是鲜为人知的学习原因`Vim`：

1.  这并不像你想象的那么努力。运行一次[Vim 指导](http://vim.wikia.com/wiki/Tutorial#Vim_tutor)程序（`vimtutor`在 shell 中，或在 Windows 中从开始菜单的 Vim 文件夹中运行它），你就已经走上了获得能力的道路，而且一切都从那里开始走下坡路。`Vim`在不到一周的午餐时间，我达到了可以在工作中使用而不会受到任何明显生产力影响的水平。

2.  这很*有趣*！编辑文本现在对我来说就像一场*游戏。*我积极地享受它——当你想到它时，这很荒谬。

不学习还有两个很好的理由`Vim`：

1.  它会让人上瘾，你会发现自己希望你可以在*所有*`Vim`计算中使用命令，并在你做不到的时候诅咒。幸运的是，至少在某些情况下，有[办法](http://www.corsofamily.net/jcorso/vi/)[解决](https://stackoverflow.com/questions/826208/making-vim-ubiquitous)[这个](http://www.viemu.com/)[问题](http://vimperator.org/)。

**   再说一次，它会让人上瘾，虽然你不会因为实际*使用* `Vim`而失去任何生产力，但你会浪费时间寻找好的技巧来让你的`Vim`体验更好，并阅读 Stack Overflow 上的[Vim 标签](https://stackoverflow.com/questions/tagged/vim)。* 

 ** * *

## 回答 #6

> 赞同：32
> 
> 时间：2009-02-28T03:48:28.833

绝对值得学习 vim 或 emacs。触摸打字也值得学习。在这两种情况下，原因都是一样的：*您的思维不再被将代码显示在屏幕上的机械过程所打断*。

至于如何开始，只需深入了解并开始使用 vim 来处理一切。

PS emacs-vs-vi 的争论是无止境的。我已经使用 emacs 26 年了。如果我今天重新开始，我会学习 vim，因为 (a) 它变得更好，并且 (b) 修饰键少了很多（Ctl-Alt-V，任何人），而且 vim 用户似乎受到的打字伤害要少得多。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2012-01-21T00:39:56.313

通过学习 16 个键的含义，您可以从 vim 中获得良好的功能：`ijkdbw9:q!%s/nN``Esc`. 你可以只用`i:wq``Esc`.

您需要知道的前两个键是：`Esc`带您进入命令模式（您开始的模式），以及`i`带您进入插入模式（正常输入）。

* * *

为了节省你需要

1.  退出打字模式 ( `Esc`)
2.  输入一个冒号`:`
3.  `w`然后输入小写`Enter`

要保存并退出，您需要

1.  退出打字模式 ( `Esc`)
2.  输入一个冒号`:`
3.  `wq`然后输入小写`Enter`

要不保存并强制退出，您需要

1.  退出打字模式 ( `Esc`)
2.  输入一个冒号`:`
3.  `q!`然后输入小写`Enter`

* * *

要了解更多信息，您可以`vimtutor`在命令行运行。这是一堂中等长度、结构合理的课程。

超越`i`和`Esc`：您可以复制或超越某些 MS Word 功能`jkwbd3:%s/nN`。

1.  `b`带你回一个字（`Ctrl`+ `←`）
2.  `w`带你前进一个词（`Ctrl`+ `→`）
3.  `9w`带你前进九字
4.  `db`删除前面的单词 ( `Ctrl`+ `Backspace`)
5.  `d3b`删除前面三个单词
6.  `9j`向下移动 9 行
7.  `/` `ornithopter` `Enter`带您到单词“ornithopter”的下一个实例，然后`n`分别`N`到下一个和上一个出现的“ornithopter”。
8.  `:``%s/confounded/dangfangled/` `Enter`用“dangfangled”代替每个“confounded”（就像`find and replace all`在 MS Word 中一样）

其中任何一个都应该在“命令”模式（`Esc`）下运行，而不是插入模式（`i`）。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2009-02-27T23:35:10.487

我最近切换到 VIM，我认为这是值得的。如果您需要“完成某事”，您可以始终保持插入模式，其中 vim（大部分）就像一个普通的文本编辑器。

我注意到以前不会打扰我的事情，比如伸手去拿方向键，现在感觉不对劲，而且费力。它确实减少了我的手部运动和鼠标的使用，这对人体工程学和生产力都有好处

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2009-02-27T23:41:08.600

这取决于你想用 VIM 做什么。学习它是没有意义的，因为很多人没有它就活不下去。

当我在 UNIX 环境中大量工作时，我离不开它。即使没有在 UNIX 机器上安装 VIM，我至少也可以使用 vi。你总是可以依靠它——即使这台机器不是你的（来自客户的）。

现在我用 C# 编程，主要在 windows 环境下工作。我已经在我的 PC 上安装了 VIM……我不需要它。

评估您是否真的需要 VIM，以及它是否支持您的“工作流程”。试试看。玩它。如果您认为自己需要它，请坚持下去……学习曲线非常陡峭。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2009-02-28T00:05:54.203

我学习 vi 是因为我必须这样做。

我的疯狂老师强迫我们学习使用 AIX 系统的终端用 C 编程。

这是一个真正的痛苦，但值得。

今天，我只使用 vi 进行快速编辑或小程序。

当我必须去做一个项目时，我宁愿使用 IDE。就我而言，IntelliJ idea 非常擅长这项任务，因为我可以在不抓鼠标的情况下编写几个小时的代码。

我不知道 VS2008 有多少快捷方式，但如果它们像 Eclipse 一样容易被发现，我认为你有麻烦去 vi。

如果您不在 IDE 之外编辑代码并且您的 IDE 有很好的快捷方式，那么您最好先学习这些，然后再去学习 vi。

:)

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2009-02-27T23:33:17.277

我已经使用 vi/vim 超过 25 年了。如果你已经知道一些命令行编辑器，那么也许你不需要学习 vi/vim。但是如果你对其他命令行编辑器不是很了解的话，还是值得学习的。毫不费力地在 vi/vim 中高效工作是很容易的。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-03-05T03:02:27.840

我现在几乎只使用 VIM。

我曾经使用 Vim 进行编辑，使用 VS Editor 进行调试。这可能看起来有点疯狂，但我发现 Vi 范式（宏、基于 Home 键的编辑等）极大地提高了我的工作效率，以至于在 VS 中进行编辑非常有趣。

感谢[Viemu](http://www.viemu.com/)，我什至不必再进行切换了。它还不是完美的解决方案（代码完成有时不如原生 vim 优雅，宏录制也不完美），但它比不断来回切换要好得多。

Vim 的学习曲线可能被夸大了。我认为一旦你进入它，它就会非常直观。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2010-01-12T20:59:27.480

我的工作迫使我学习 vim，它很快成为了我的第二天性。现在我的抱怨是关于没有 vim 仿真或插件的 IDE。我确实注意到 esc 键已成为我在 vim 之外的敌人。

我确实在 Visual Studio 中找到了几个 vi 模拟器：

[http://code.google.com/p/vim-visual-studio/](http://code.google.com/p/vim-visual-studio/)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2009-02-27T23:48:49.237

首先，良好的 vi(m) 知识将为您节省在 seige 下的服务器上紧急编辑配置文件的时间。它可以支持滞后的 ssh 连接。

如果您使用符合人体工程学的键盘有效地使用 vim 的输入法，那么除了 vim 的输入法之外的管理工具将是您防御腕管的最佳方法。

了解 vim 要点的最好方法是在家中开始一个临时项目，拔下鼠标并用胶带粘在箭头键上。

并阅读帮助

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-02-27T23:50:07.720

vi/vim 的两个优点：

*   它很轻

*   它安装在几乎每个 *NIX 系统上

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-02-28T11:43:57.990

我在远程计算机上维护一个非常大的 linux 项目。没有选择使用 Eclipse 或类似的基于 GTK 的 IDE。我已经在那里工作了 3 年。我为这个项目设置了我的 vim。而且还在调整。

现在我可以在 Vim 上做任何事情：源代码控制、sql、调试、编译、浏览——非常快速地浏览 1Gb 源代码。

Visual Studio 或 Eclipse 无法处理所有这些。如果我有选择，我不会将 Vim 更改为其他编辑器或 IDE。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-06-01T05:02:14.000

我学习了 Vim。这不是太多的努力。现在我绝对喜欢 ci" ci( cw V:s/from/to/g

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-02-28T00:24:38.463

我会说vim绝对值得学习。去年夏天我选择了它，现在它几乎是我选择的所有编辑器（java 是一个延伸，但在我不需要广泛的分析支持时是可行的）。正如每个人已经确认的那样，它是一个非常有效的工具。[对于它的价值，我只从图形教程](http://www.viemu.com/a_vi_vim_graphical_cheat_sheet_tutorial.html)

中学到了 vim 功能的一小部分（花了一两天），从[这里](http://www.viemu.com/a-why-vi-vim.html)学到了一些零碎的东西（长读），以及搜索和替换功能，我被迷住了。从那以后我学到了一些东西，但是在我的闲暇时光。我会说学习曲线在这一点上趋于平缓，但后来，我非常频繁地使用它，并且被其他人包围，也是。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-02-28T16:18:44.833

我和你的情况一样，作为 Vim 的初学者，我最初发现它有点令人生畏 - 学习曲线似乎很陡峭。从我在短短几个小时内学到的东西来看，我已经觉得没有它我将无法生活。

[以下](http://www.youtube.com/watch?v=c6WCm6z5msk) [是](http://www.youtube.com/watch?v=BPDoI7gflxM)我找到的一些有用的 Vim 截屏链接，可以向您展示它的[功能](http://www.youtube.com/watch?v=J1_CfIb-3X4) [。](http://video.google.co.uk/videoplay?docid=2538831956647446078&ei=y2KpSaTHO5aWiQLapoDVBQ&q=effective+text+editing&hl=en)

Bram Moolenaar（Vim 的仁慈独裁者）在最后一个链接中给出的一个很好的建议是，尝试学习每一个命令和函数是低效的，只要弄清楚你在做什么不是效果很好，想办法让它更有效率，然后养成习惯。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2009-11-23T17:28:23.190

是的，一定要花时间学习至少一点“vi”和“vim”。它旅行得很好。

当您面对您没有安装能力的客户 Unix/Linux/Mac 系统时，您永远不会陷入困境。即使在 Windows 上（如果您有安装功能），“Vim”也是免费且易于安装的。（与纯粹将您的学习曲线投资于 UltraEdit 之类的东西相反，尽管可能无法始终为您提供出色的编辑器......）。

学习 vi 可以让您学习其他工具，如“sed”和一般的正则表达式：通常可以转移的东西。

另外，如果你想成为一个真正的极客，你只需要知道“vi/m”，否则你会看起来像个骗子；-)

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2009-02-27T23:58:29.463

我认为学习vim绝对值得花时间和精力。对我来说，它使键入和浏览文本变得如此高效，很难想象回到 emacs 或 ctrl/shift/alt/meta 键组合。

不要被 vim 的所有花哨功能吓倒。一旦你用得够多，你就会知道哪些命令是你最常使用的，你会知道哪些事情是你可以忘记的。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-02-27T23:59:36.107

仅在 Unix 系统上，Vim 惊人的普遍性，以及 Vi 克隆更惊人的普遍性，就足以让它值得学习。

除此之外，我真的认为整个 Vi 风格的思维让我更有效率。对于一个不习惯命令模式和插入模式等模式的人来说，仅仅为了插入文本就必须进入一个模式似乎有点过分。但是，当一个人使用 Vim 几个月，并且学到了很多技巧和窍门时，Vim 似乎是值得的资产。

当然，对于 Emacs 风格的思维，Emacs 人群也有同样的看法，但我放弃了学习 Emacs，因为 Vim 更简单，并且为我完成了这项工作。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2009-02-28T00:09:16.973

在看到一个对 vi 非常熟练的人四处导航以疯狂快速的剪辑进行编辑后，我学会了喜欢 vi。你真的可以用它快速编码。我喜欢它的另一个原因是，有时我发现在 IDE 中徘徊一段时间后真的会伤到我的手，而 vi 提供了很好的改变。正如其他人所提到的，它几乎总是在 unix 系统上可用，即使在糟糕的连接上也能很好地工作。

我没有看到提到的一件事是知道 vi 在某些圈子中具有“极客信誉”的额外好处。我能想到至少有几个人在看到新程序员启动 nedit 对文件进行一些更改时会发笑。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2009-02-28T05:47:54.647

不要被命令的数量吓到，我没有遇到过最多使用几十个的人。我发现它必不可少，因为当我在考虑代码时，我在考虑文本，而转而考虑鼠标只会让我一团糟。我认为，最大的技巧是一次学习一点，不要犹豫去玩——撤消功能非常适合探索它的行为。

此外，如果您深入了解它，vim 是可编写脚本的。可能性实际上是无穷无尽的。

（是的，所有这些都适用于 emacs ......）

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2009-02-28T05:50:01.663

在我不得不开始使用在 linux 下运行的服务器之前，我对我的 textpad 和 ecplise 世界很满意。需要远程编写脚本和设置配置文件！

一开始很难，但现在我可以轻松设置和调整我的服务器。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2009-02-28T17:00:59.943

您可能想学习 vim，因为您可能对已在使用的编辑器不满意。

你可能想学习 vim，因为很多人说它很酷。看看你对这个问题有多少答案。

我将提供另一个学习 vim 的理由。它以其文档的质量和完整性而闻名。因此，只要您设法在帮助查询中粘贴正确的关键字，您就会在其帮助系统中找到大多数问题的答案。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2009-03-01T13:53:01.057

要快速学习 vi(m)，首先必须了解整个设计。Vim 有一组很棒的光标移动命令，检查一些（X 是一个字符，# 一个数字）：

jk enter arrows 0 $ w W b B ctrolD crtolU ctrolE ctrolY HML fX FX tX TX , ; % gg G n N mX 'X''

还有更多，列举起来会很无聊。其中许多支持命令前的计数，例如 4j 向上移动 4 行。

现在，回到设计，您键入一个命令，如 d 用于删除，然后移动光标，该命令适用于从光标位置到移动结束的一段文本。例如，H 移动到屏幕顶部，dH 删除到屏幕顶部，cH 更改（替换）到屏幕顶部。

这个设计非常强大。它还减少或组织了您需要学习的内容。毫无疑问，第一步是学习一些光标移动命令。说，一开始是 8 或 10。然后你几乎完成了。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2009-03-05T03:13:57.563

恕我直言，学习新东西总是值得的。我建议您打印一份备忘单并强迫自己日复一日地使用它。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2009-05-05T22:23:00.787

Vim 绝对值得学习来部分总结前面所说的这里是主要原因：

*   Vi/Vim 可以在大多数 unix 系统上找到。
*   Vim 让您无需离开键盘即可轻松编写代码。
*   如果您计划在基于 unix 的系统中配置任何内容，那么您可能会编辑相当多的配置文件，因此您需要学习基于终端的编辑器，其中 vim 是最好的编辑器之一（对不起 emacs）。
*   Vim 为几乎所有的操作系​​统编译/预编译了二进制文件。无需发布“我需要 [insert OS] 的 textmate 替代品”，您将拥有 Vim！
*   有很多很好的插件可以添加很多功能，例如编辑器内的 cvs diffs，尽管其中一些需要大量的修补。

另外，如果您发现自己喜欢 Vim 键绑定，还有一些 IDE 在其编辑器中包含用于简单命令的 vim 绑定，例如[Komodo Edit](http://www.activestate.com/komodo_edit)。

如需学习 Vim 的帮助，请尝试在终端中输入“vimtutor”并按照说明进行操作。还有一本书特别好[Hacking Vim](http://www.packtpub.com/Vim/book)

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2009-06-01T04:47:15.843

不，学习 vim 比努力更有价值。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2009-06-01T06:06:03.737

我也推迟了很多年学习 vi 或 vim。事实上，我过去常常取笑那些似乎总是在做手指有氧运动的“vi 家伙”。然后，随着我从 Windows 转向 Linux 作为我的主要操作系统，我不得不更加熟悉 vim。这是一个学习曲线，现在仍然如此。在每天使用 vim 9 年后，我仍然发现自己在学习新的更快的做事方式。我曾经认为的“手指有氧运动”实际上是一种非常有效的提高生产力的方式。与使用 vim 之前相比，我现在可以用更少的时间和精力进行更多的代码开发。而且我确信您知道 vim 可以在几乎所有平台上运行，因此您始终可以在需要时使用它。此外，如果您喜欢 GUI，他们有适用于大多数平台的 GUI 版本。

如果你决定试一试 vim，我强烈推荐 O'Reilly “vi Editor Pocket Reference”一书。它很便宜，如果你只是在学习 vi (vim)，那就太好了。完整的 vim 书籍也不错，但袖珍参考书为您提供了快速高效的所有基础知识。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-03-01T12:33:20.233

是：如果您不使用并且将来不打算使用任何 IDE。即使您使用 IDE，您也会发现自己会回到它做很多事情。在 vim 中，您可以编写脚本，执行复杂的任务，而不是单独编辑 500 行代码，而是使用（略显神秘，但一旦掌握）命令即可。我最初发现它很困难，但后来它对我有很大帮助。即使是最好的 IDE 编辑器也缺乏 vim 的功能。Vim 可以很好地与 CVS、SVN、make、调试器等一起工作。

否：如果您坚持使用 Eclipse 或 Netbeans 等 IDE。或者，如果您发现像 Kate 这样的编辑对您来说已经足够了。事实上，Kate 或 Notepad++ 或 jEdit 具有您可能在 vim 中错过的 GUI 和功能。例如 Kate 的符号查看器或 Notepad++ 的巨大菜单栏。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-03-05T03:21:02.040

亲自，

我发现许多这些终端文本编辑器有时无法使用。我会花时间挑选一个吗？绝对地！我会继续学习一个IDE。当然，最后，它真的归结为偏好。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2010-01-12T20:36:20.723

学习 VIM（我的偏好）或 EMACS 的投资将得到回报。

我建议访问 Derek Wyatt 的网站，浏览 VIM Tutor，并查看 Steve Oualine PDF 书。

与我使用过的其他编辑器相比，Vim 帮助我更快地移动和编辑。我的工作 IDE 在允许人们做的事情上非常有限，并且通常致力于特定的环境。有些任务仍然需要我重新访问 IDE（例如调试器，它是 IDE 的编译部分）。

# c++ - __FILE__、__LINE__ 和 __FUNCTION__ 在 C++ 中的用法

> ID：597078
> 
> 赞同：181
> 
> 时间：2009-02-27T23:27:10.710
> 
> 标签：c++, debugging, logging, c-preprocessor

假设您的 C++ 编译器支持它们，是否有任何特别的理由*不*使用`__FILE__`，`__LINE__`以及`__FUNCTION__`用于日志记录和调试目的？

我主要关心的是向用户提供误导性数据——例如，报告错误的行号或函数作为优化的结果——或者因此导致性能下降。

`__FILE__`基本上，我可以信任`__LINE__`并*始终*`__FUNCTION__`做正确的事吗？

 ** * *

## 回答 #1

> 赞同：214
> 
> 时间：2009-02-27T23:28:58.787

`__FUNCTION__`是非标准的，`__func__`存在于 C99 / C++11 中。其他（`__LINE__`和`__FILE__`）都很好。

它总是会报告正确的文件和行（如果您选择使用`__FUNCTION__`/ ，它会报告功能`__func__`）。优化不是一个因素，因为它是编译时宏扩展；它**永远不会**以任何方式影响性能。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-02-27T23:59:48.150

在极少数情况下，将给出的行更改为其他内容可能很有用`__LINE__`。我已经看到 GNU configure 这样做是为了在一些测试中报告适当的行号，因为它在原始源文件中没有出现的行之间插入了一些巫术。例如：

```
#line 100 
```

将使以下行以`__LINE__`100 开头。您可以选择添加新文件名

```
#line 100 "file.c" 
```

它很少有用。但如果需要，我知道没有其他选择。实际上，也可以使用宏来代替行，它必须导致上述两种形式中的任何一种。使用 boost 预处理器库，您可以将当前行增加 50：

```
#line BOOST_PP_ADD(__LINE__, 50) 
```

我认为提及它很有用，因为您询问了`__LINE__`and的用法`__FILE__`。人们永远不会从 C++ 中得到足够的惊喜 :)

**编辑：** @Jonathan Leffler 在评论中提供了一些更好的用例：

> 对于希望在用户的 C 代码中报告的错误与用户的源文件保持一致的预处理器，使用 #line 非常有用。Yacc、Lex 和（对我来说更熟悉的）ESQL/C 预处理器就是这样做的。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-02-28T13:37:40.070

仅供参考：g++ 提供了非标准的 __PRETTY_FUNCTION__ 宏。直到刚才我还不知道 C99 __func__ （感谢 Evan！）。我想我仍然更喜欢 __PRETTY_FUNCTION__ 当它可用于额外的类范围时。

PS：

```
static string  getScopedClassMethod( string thePrettyFunction )
{
  size_t index = thePrettyFunction . find( "(" );
  if ( index == string::npos )
    return thePrettyFunction;  /* Degenerate case */

  thePrettyFunction . erase( index );

  index = thePrettyFunction . rfind( " " );
  if ( index == string::npos )
    return thePrettyFunction;  /* Degenerate case */

  thePrettyFunction . erase( 0, index + 1 );

  return thePrettyFunction;   /* The scoped class name. */
} 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2020-01-15T09:04:19.750

**C++20`std::source_location`**

C++ 终于添加了一个非宏选项，当 C++20 普及时，它可能会在未来某个时候占据主导地位：

*   [https://en.cppreference.com/w/cpp/utility/source_location](https://en.cppreference.com/w/cpp/utility/source_location)
*   [http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/p1208r5.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/p1208r5.pdf)

文档说：

> constexpr const char* function_name() const noexcept;
> 
> 6 返回：如果此对象表示函数体中的一个位置，则返回一个实现定义的 NTBS，该 NTBS 应对应于函数名称。否则，返回一个空字符串。

其中 NTBS 表示“空终止字节字符串”。

该功能存在于 GCC 11.2 Ubuntu 21.10 和`-std=c++20`. 它不在 GCC 9.1.0 上，带有`g++-9 -std=c++2a`.

[https://en.cppreference.com/w/cpp/utility/source_location](https://en.cppreference.com/w/cpp/utility/source_location)显示用法是：

主文件

```
#include <iostream>
#include <string_view>
#include <source_location>

void log(std::string_view message,
         const std::source_location& location = std::source_location::current()
) {
    std::cout << "info:"
              << location.file_name() << ":"
              << location.line() << ":"
              << location.function_name() << " "
              << message << '\n';
}

int main() {
    log("Hello world!");
} 
```

编译并运行：

```
g++ -std=c++20 -Wall -Wextra -pedantic -o main.out main.cpp
./main.out 
```

输出：

```
info:main.cpp:17:int main() Hello world! 
```

**`__PRETTY_FUNCTION__`对`__FUNCTION__`对`__func__`对`std::source_location::function_name`**

回答于：[__PRETTY_FUNCTION__、__FUNCTION__、__func__ 有什么区别？](https://stackoverflow.com/questions/4384765/whats-the-difference-between-pretty-function-function-func/31163837#31163837)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-27T23:30:38.267

就个人而言，除了调试消息之外，我不愿意将这些用于任何事情。我已经做到了，但我尽量不向客户或最终用户展示这类信息。我的客户不是工程师，有时也不精通计算机。我可能会将此信息记录到控制台，但正如我所说，除了调试版本或内部工具外，我很不情愿。不过，我想这确实取决于您拥有的客户群。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-02-05T05:36:27.373

我一直在使用它们。我唯一担心的是在日志文件中泄露 IP。如果你的函数名真的很好，你可能会让商业秘密更容易被发现。这有点像附带调试符号，只是更难找到东西。在 99.999% 的情况下，不会有什么不好的事情发生。

# c# - 是否有与 /unsafe 标志对应的“预处理器”符号？

> ID：597083
> 
> 赞同：7
> 
> 时间：2009-02-27T23:30:15.397
> 
> 标签：c#, wpf, c-preprocessor, unsafe

我正在处理`WriteableBitmap`C# 中的一个。我目前正在使用不安全的代码块通过`WriteableBitmap.BackBuffer`. 但是，我宁愿不依赖于该`/unsafe`选项，因此我正在考虑改用该选项`WriteableBitmap.WritePixels`。

是否有某种方法可以在“不安全”版本中进行有条件地编译，以便在使用 /unsafe 编译选项时可以使用它，而无需手动集成到我的项目文件中？

简而言之，我正在寻找以下内容：

```
#if UNSAFE
   //my unsafe version
#else
   //the supposedly safe version goes here
#endif 
```

运行时检测也很好；但这意味着我总是需要用 编译*，* `/unsafe`这意味着库代码需要更新项目文件，这不太方便。

基本上，我想在重要的时候保留快速版本，但有一个合理的版本，无论如何都可以工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T00:25:36.903

我建议您使用配置管理器创建一个或多个新配置，例如“Unsafe Debug”和“Unsafe Release”，它们具有现有选项，并选中 Unsafe 并添加 UNSAFE 条件符号。您可以使用 Unsafe 配置，而不是切换 Unsafe 选项。

您还可以让配置更改不安全程序集的输出名称，因此您将拥有两个程序集，例如 Bitmaps.dll 和 Bitmaps.Unsafe.dll，并且程序集的客户端可以通过指定哪个程序集来决定哪个最适合其需求参考。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T23:45:54.487

我建议你用`/unsafe /define:SAFE`. 也许还有另一种我不知道的方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T00:03:33.617

我想你可以试试这个代码

```
#define UNSAFE
#undef UNSAFE // comment this line out if you want to compile the save version 
```

然后您可以使用您在示例中提供的代码。

# java - 可执行的罐子运行非常缓慢

> ID：597098
> 
> 赞同：3
> 
> 时间：2009-02-27T23:35:33.963
> 
> 标签：java, performance, windows-vista, jar, executable-jar

我已经完成了几个项目并将它们打包成 jar 文件，但我注意到我的 jar 文件运行速度比在我的 IDE 中慢得多。

我使用 Eclipse 来编译和运行我的程序。在 Eclipse 中，我一切正常。当我将我的项目打包为一个可运行的 Jar 并通过双击执行它时，一切仍然有效。但是当我有动画时，程序运行*得非常*慢。在 Eclipse 中，我现在获得了大约 2 帧，而不是 Eclipse 中的每秒 30 帧。动画非常拖沓。

有趣的是，当我从命令提示符 ( `java -jar MyCode.jar`) 运行同一个 Jar 时，延迟消失了，我的程序正常运行。

我目前不知道是什么导致了这个问题。我的电脑运行的是 Windows Vista。我正在使用最新版本的 JRE 和 JDK。我的程序包含一个动画，没什么特别的。

谢谢

**解决方案：** 我的计算机上有几个不同版本的 Java，并且使用了不正确的版本。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T00:01:57.223

Windows 自带的 java.exe 版本已经过时了。通过将 .jar 扩展名的关联更改为更新的 JVM，您应该会看到很多改进。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T00:51:53.593

您还可以考虑是否有任何正在运行的防病毒软件影响性能。一些软件将 .jar 文件视为 .zip 档案，并相应地进行扫描。他们的 shell 集成也可以解释双击和命令行之间的区别。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-27T23:40:33.033

可能您已经将双击与一些“坏”的 JVM 版本相关联。

我要做的是使用[SysInternals](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)的 processxp 来查看您的应用程序正在使用什么解释器。可能只是将其更改为与命令行和 Eclipse 相同。

检查并查看两者是否使用相同的 JVM（ProcessXP 中有一个列名命令行，比较该值）

我希望这有帮助。

# eclipse - 如何在 Eclipse 3.4 (Ganymede) 中格式化整个源代码树？

> ID：597104
> 
> 赞同：13
> 
> 时间：2009-02-27T23:40:29.663
> 
> 标签：eclipse

显而易见的事情是：

1.  右键单击要格式化的文件夹。
2.  来源 > 格式

预期结果：
- 目录和子目录中的所有 java 代码都被格式化（使用项目特定的格式化设置）

实际结果：
- 没有一个 java 被格式化。

当我们这样做时，我们如何在 Eclipse 中进行批量清理操作？
在编辑器中，我右键单击 > 源 > 清理，但我一次只能执行一个文件。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-08-25T19:27:24.613

我遇到了同样的问题。我必须切换到打包的资源管理器才能使用格式化程序。在导航器下它不起作用。希望这有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T23:51:48.357

正如[这个线程](http://dev.eclipse.org/newslists/news.eclipse.tools.jdt/msg22969.html)中提到的，这个（格式化文件夹中的所有 Java 源文件）应该从 eclipse3.0 开始工作。

您是否在“错误视图”中看到某种错误消息？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T23:54:23.123

我完全按照您的建议进行了操作，并且完全按照您的建议进行了预期。我选择了来源 | 格式化我的 src 树中的目录并重新格式化其中的所有单元。

编辑： ...使用 3.4.1 Ganymede。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T23:55:17.240

如果您的代码未从源代码管理中签出或不可写，则执行这样的组操作不会将它们签出或使其可写。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-17T10:13:24.653

我在使用 SpringSource Tool Suite 2.5.1 时遇到了同样的问题

*   我正在使用包资源管理器
*   该项目位于已签出的 SVN 存储库中
*   在进度对话框中，我可以看到只有 XML 文件被修改
*   当我按 Ctrl+Shift+F 进入文件时，它会被重新格式化（因此是可写的）但是当我在其文件夹上右键单击 Source > Format 时，没有任何反应

我知道已经 2 年了，但我想知道 @LES2 是否找到了解决方法来纠正这个问题

编辑：好的，尽管我真的像以前写的那样在包资源管理器中，但我的 java 代码仅被解释为文本文件。我重新运行了我的项目的完整存储库签出，并且出现了一个包树（用于包而不是文件夹的方块），使我能够批量格式化 Java 文件。

# eclipse - Eclipse 与 Vim 的无痛集成？

> ID：597117
> 
> 赞同：64
> 
> 时间：2009-02-27T23:47:16.887
> 
> 标签：eclipse, vim, plugins

有没有人设法轻松地将 Vim 集成到 Eclipse 中？我只想在保留通用 Eclipse 界面的同时使用 Vim 作为编辑器。我曾尝试使用 Eclim 插件，但编辑器似乎比工作更频繁地崩溃（该网站表示编辑器替换功能仍处于测试阶段）。

另一方面，是否有与 Eclipse 的功能相匹配的 IDE（主要是与 SVN、ant 等的集成）并且还能够使用 Vim？

我主要将 eclipse 用于 SAS SCL、Java 和 Javascript 编程，并且发现 eclipse 编辑器太“鼠标-y”。

我还想，在一个完美的世界中，使用 vimdiff 作为 SVN 的差异查看器（我们使用 TortoiseSVN），同时在合并等过程中检查差异或冲突。我承认我没有花很多时间试图让这些东西工作。当我的其他团队成员忙于编写他们的代码，完全满足于 Eclipse 所提供的一切时，我对在潜在的疯狂追逐上花费太多时间感到内疚。

编辑：在拼命浏览时发现了这个：[Vim plugin](http://vimplugin.org/)。有使用这个的经验吗？从网站上的声明来看，这听起来很完美。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-06-02T14:16:12.120

我已经使用[Vrapper](http://vrapper.sourceforge.net)大约 2 个月了，效果很好。它安装简单，让生活更轻松。

它没有将 Vim 与 Eclipse 集成，它只是模拟 Vim 的行为，因此您不需要安装 Vim。

编辑：

我在 Eclipse 中[重构方法](http://sourceforge.net/apps/trac/vrapper/ticket/96)时遇到错误（仅在安装 Vrapper 时），所以我停止使用它。

现在我正在使用[ViPlugin](http://www.viplugin.com/viplugin.htm)（非常类似于 vrapper）。它工作得很好（特别是从 2.0 版开始），我推荐它，但它不是免费的（但便宜并且有试用版）

编辑

正如新帖子所提到的，如果我们总是使用重命名对话框来重命名，它可以成为 Varpper 的一种解决方法。

首选项 > Java > 并取消选中“在没有对话框的编辑器中重命名”

[http://sourceforge.net/apps/trac/vrapper/ticket/96](http://sourceforge.net/apps/trac/vrapper/ticket/96)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-28T00:16:55.753

共识似乎总结在**[Wanted: VIM in Eclipse](http://movingparts.net/2008/02/12/wanted-vim-in-eclipse/)**文章中。

eclipse 不存在像样的 Vi 插件，除了不提供宏机制的 viplugin。

![六](https://i.stack.imgur.com/MEOAv.png)

而在[NetBeans 方面](https://blogs.oracle.com/roumen/entry/vi_plug_in_for_netbeans)...... **[jvi](http://jvi.sourceforge.net/)**做了一个杀戮的工作;）

![替代文字](https://i.stack.imgur.com/RLmMq.png)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-06-12T04:39:54.063

哇，就是这个！

[http://vrapper.sourceforge.net/home/](http://vrapper.sourceforge.net/home/)

它几个月前才问世，看起来比其他替代品好得多……而且它是开源的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-04-27T23:15:59.203

我使用[Viable](https://marketplace.eclipse.org/content/viable-vim-eclipse)，它是 Eclipse 的一个新插件，提供 Vi 仿真。它与 vrapper 非常相似，但它与重构的 vrapper 没有相同的问题（如 cysiek10 所述。）

它有一些非常酷的特性，Eclipse 中的其他 Vim 仿真器似乎都没有（尽管 NetBeans 的 jvi 有一些），例如：

*   视觉块模式
*   外部过滤器和命令
*   命令历史
*   窗户裂开（喜欢这个！）

是工资；但是，您可以像 viPlugin 一样免费试用完整版。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-12T04:46:25.887

我从来没有将 vim 集成到任何 IDE 中，无论是 Eclipse、Visual Studio、NetBeans 还是其他的。相反，当卡住使用 IDE 时，我只是让 IDE 启动一个自定义程序：它使用客户端/服务器功能将文件传递到 vim。

即 vim --servername SomeName --remote-{选择如何打开它：拆分或制表符} {extra args like filename and +line#}

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-07-30T02:40:02.553

我刚刚尝试了 Eclim [http://eclim.org/](http://eclim.org/)并发现它非常好。我仍然可以在 Vim 中编辑，并享受 Vim 中 eclipse IDE 的大部分好处（例如更好的全向完成）。

Eclim 最好的一点是我们仍在使用原始的 Vim，因此我可以享受所有现有的好处（我自己的函数、宏等），同时拥有 IDE 提供的额外便利。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-28T00:04:12.913

我尝试了 Eclim，但根本不喜欢它。我最终使用了这个名为“viPlugin”的插件，它实际上运行良好，足以保证每天都使用它。这是 viPlugin 的网站：

[http://www.viplugin.com](http://www.viplugin.com/)

这个插件的最大缺点是它不是免费的。我付了钱，我认为这是值得的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-01T22:09:11.457

[http://vimplugin.org](http://vimplugin.org)，我在周末发现它是最接近完美集成的地方。不幸的是，当我在 IDE 中打开超过 2 个文件时，我的整个工作站都没有响应。而且我什至没有使用编辑器的“新流程”选项。

所以底线似乎还没有像样的集成。虽然有一些很接近。我正在支持 vimplugin 稳定下来，我也会花一些时间（当我不像现在这样占用我雇主的时间时）用 hte 插件玩更多的东西，看看我是否可以让它可用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-28T00:21:30.330

> *...是否有任何 IDE 与 Eclipse 的功能相匹配——主要是与 SVN、ant 等的集成——并且还能够使用 Vim？*

IntelliJ IDEA 有一个非常好的 VI 插件，但我不喜欢它，虽然插件确实有效。

我的问题是我已经养成了使用 IDEA 的习惯，而且这些习惯更难，我的实验没有通过。所以我卸载了插件，而是学习了想法快捷方式。

但是，不是免费的:(

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-05-27T19:00:05.247

Vrapper 做到了。

安装 Vrapper 后，您需要在 Eclipse 设置中删除 CTRL+W 键绑定。否则，当您实际上是指 Backspace 时，它​​会一直关闭编辑器。

它还带有“环绕”和拆分窗口插件。一定要安装那些。

不过，这不是 100% Vim。除了 Vim（doh！），没有什么是 100% Vim。您会发现缺少一些命令（或者您可能没有，这取决于您的“vimy”程度）。但是 vrapper 有一个`:vim`命令，它会打开 Vim 编辑器，其中包含缓冲区中的当前文件，并将光标放在文件中的确切位置。这样您就可以从中断的地方继续编辑。在 Vim 中完成后，只需关闭编辑器，然后返回到 eclipse 编辑器。

我希望这可以帮到你。

# c# - SPGridView 中的分组总计

> ID：597129
> 
> 赞同：4
> 
> 时间：2009-02-27T23:51:57.933
> 
> 标签：c#, .net, sharepoint, spgridview

当我使用 GroupField 属性对 SPGridView 中的项目进行分组时，分组效果很好，但总行数不像标准 SharePoint 列表中那样显示。通常 SharePoint 会在括号中的组旁边显示计数（即组 1 (5)）。有没有办法启用这个功能。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T21:46:27.860

如果您不想使用 javascript，您可以遍历表并计算每个组中的行数。

缺点是您可能需要计算所有行，然后返回并更新每行中的组名。

例如：

```
ID  Value   Group
1   One     GroupA
2   Two     GroupA
3   Three   GroupB
4   Four    GroupB
5   Five    GroupB 
```

2 组 A
3 组 B

```
ID  Value   Group
1   One     GroupA (2)
2   Two     GroupA (2)
3   Three   GroupB (3)
4   Four    GroupB (3)
5   Five    GroupB (3) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T22:56:54.197

Javascript有效！Nat 的建议帮助了我！

请参阅下面的 jquery 示例：

```
$(".ms-gb td:contains('" + groupName + "')")
    .append("<div class='stat'>text</div>") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T02:25:10.560

我快速查看了代码，甚至覆盖 SPGridview 似乎也没有一个简单的“钩子”来覆盖它。

您也许可以创建 Javascript 来执行此操作，但这远非有趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T05:23:34.767

您是否尝试将`DisplayGroupFieldName`属性设置为`True`？

[SPGridView 类文档](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.webcontrols.spgridview.aspx)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-02-17T11:01:49.380

我知道这个问题很老，但无论如何：

```
var rows = document.getElementById("your_table").getElementsByTagName("TR");
for (var i = 0; i < rows.length; i++) {
    if (rows[i].className == 'ms-gb') {
        var count = 0;
        var el = rows[i].nextSibling;
        while (el) {
            if (el.className != 'ms-gb')
                count++;
            else
                break;
            el = el.nextSibling;
        }
        rows[i].children[0].innerHTML += " <span dir='ltr'>(" + count + ")</span>";
       }
    } 
```

如果您想将其应用于整个页面，则可以 drop.getElementById("your_table") 部分，否则将 gridview 放在具有该 ID 的控件中。

# linux - 如何将管道中的中间结果打印到屏幕上？

> ID：597134
> 
> 赞同：1
> 
> 时间：2009-02-27T23:55:38.330
> 
> 标签：linux, bash, shell, tee

我正在尝试计算命令中的行数，并且我还希望看到它们经过的行。我最初的想法是使用`tee`命令：

```
complicated_command | tee - | wc -l 
```

但这只会使使用 GNU 的行数翻倍，`tee`或者将输出复制到`-`Solaris 上命名的文件中。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T00:04:34.580

```
complicated_command | tee /dev/tty | wc -l 
```

但请记住，如果您将其放在脚本中并重定向输出，它不会按照您的预期进行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T23:55:53.197

解决方案是`tee`直接到控制台，而不是`STDOUT`：

```
tty=`tty`
complicated_command | tee $tty | wc -l 
```

# amazon-s3 - EC2 自动化工具/策略？

> ID：597137
> 
> 赞同：6
> 
> 时间：2009-02-27T23:56:54.273
> 
> 标签：amazon-s3, amazon-ec2

您使用哪些工具或策略来实现 EC2 活动的自动化？

我需要能够启动多个 EC2 实例，为其提供各种软件（主要是 Python 包），与 S3 交互（主要是下载数据），并运行各种作业。我将按需和按计划执行此操作。

我正在尝试决定是否应该：

*   创建一个加载了我所有软件的 AMI，或者
*   启动一个普通的 vanilla linux AMI 实例并将我的软件 scp 到它

对于配置和自动化，[Boto](http://code.google.com/p/boto/)看起来相当不错。或者我可以用[Paramiko](http://www.lag.net/paramiko/)写一些东西。推荐任何一个或其他我应该看的东西？

基本上我正在寻找建议/成功案例，让我知道什么对你有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T00:12:55.263

要回答有关选择 AMI 的问题，我想说这取决于您要安装多少软件。

我通过混合方法取得了成功，我在其中构建了一个 AMI 并加载了我的重量级和更稳定的软件。这是需要运行安装程序的东西，或者需要花费大量时间来安装（请记住，如果您每次都在启动过程中重新安装一个软件包，那么您每次都需要为安装付费）。然后，我在配置/启动时上传小型且易失的软件。大多数应用程序代码、数据等都在这个存储桶中。这样，我可以更改我的应用程序而不必接触 AMI。

这种方法的好处：

*   不必为运行相同的软件安装数千次而付费。
*   随着时间的推移，AMI 可以保持相当稳定。
*   可以使用需要干预或GUI交互的软件来安装。

主要缺点：

*   您的 AMI 的操作系统版本会随着时间的推移而变得陈旧。
*   您的 AMI 对于将在其上运行的实例类型/架构可能不灵活。例如，您可以在 32 位操作系统上创建它，从而阻止它在高 CPU 实例类型上运行，反之亦然。因此，您可能会将自己锁定在定价方案中。

我不使用 Python，因此无法评论您引用的任何一个 API。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-12-05T08:50:27.150

AWS 刚刚发布了[Systems Manager](https://aws.amazon.com/ec2/systems-manager/)套件，其中包括一项[自动化服务](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sysman-ami-walkthrough.html)，该服务将（除其他外）处理您[围绕 AMI 的用例](https://www.youtube.com/watch?v=Eal9K0aGLYI&feature=youtu.be)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-03T21:33:12.577

这个问题是前段时间提出的，但我相信我的回答可能对其他用户有用。我相信市场上最好的自动化工具是由云管理平台提供的。例如，它们提供自动扩展、配置软件集成（Chef/Puppet）、数据库复制、dns 管理......

最受欢迎的云管理软件是[Scalr](http://scalr.net)（免责声明：我在那里工作）、RightScale 和 enStratus。[Scalr](http://scalr.net)是开源的，在 Apache 2 许可下发布。

关于您关于 AMI 的具体问题，云管理平台通常会提供预配置的 AMI（在 Scalr，我们称它们为角色）。如果您想在现有实例上创建自己的 AMI，您将能够创建 snpashot 并将它们用作未来实例的模板。

# .net - 从非特定 .NET 应用程序引用特定于平台的库

> ID：597138
> 
> 赞同：4
> 
> 时间：2009-02-27T23:57:39.170
> 
> 标签：.net, c++, visual-studio, cross-platform, platform-specific

我经常需要在我的 C# 应用程序中包含少量本机代码，我倾向于通过 C++/CLI 来完成。通常我只需要使用一个 C++ 库，它没有 .NET 的好替代品；但有时性能也是一个因素。

这是有问题的；这样做意味着添加对特定 x86 或 x64 库的引用。大多数库都支持 64 位和 32 位编译，或者只需要稍作修改即可在 64 位下工作。但是，我只能引用来自特定 C# 项目构建目标的版本*之一。*这意味着我需要为解决方案中的每个项目手动添加几个构建目标。

VS.NET 在这种情况下非常无用：如果将 C++ 库和 C# 库添加到同一个解决方案中，并且 C# 和 C++ 库同时具有 32 位和 64 位目标，则您的解决方案将包含“Any CPU”目标，即“混合平台”目标、x64 目标、x86 目标（C# 称之为 32 位）、win32 目标（C++ 称之为 32 位），也许还有更多；至少有两个版本（发布和调试，除非您添加了更多版本）。

这很快就变得一团糟，而且没有充分的理由。显而易见的行为不应该那么棘手：如果我有一个 C# 项目引用了一个 C++ 项目，那么 64 位版本应该引用 64 位版本应该有点明显，32 位版本也是如此。

最糟糕的是，所有这一切都导致了两个独立但相同的可执行文件：任何 CPU .NET 项目都可以在 32 位和 64 位模式下不加修改地工作，但我还没有找到加载适当平台特定支持的方法库取决于应用程序的启动模式。

总结这次漫长的漫谈：

*   是否可以让在跨平台应用程序上使用 VS 变得不那么痛苦 - 让它在不手持的情况下将适当的引用添加到适当的构建目标？
*   是否有一种简单的方法可以使用特定于平台的引用制作 .NET 可执行文件，该引用可以在 32 位和 64 位模式下运行，并根据需要加载适当的程序集？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-28T05:52:19.677

我的回答是肯定的。一种可能的方法是使用插件架构，所以它的工作原理是这样的，

1.  当您的 C# 应用程序在 x86 上运行时，它会加载 x86 版本的插件。
2.  当它在 x64 上运行时，它会加载 x64 版本。

然后为插件版本准备两个项目。一个配置为针对 x86 进行编译，而另一个配置为针对 x64 进行编译。反过来，x86 插件封装了 C++ 库的 x86 版本，以及 C++ 库的 x64 之上的 x64 版本。

这有点复杂，因为您必须维护两个插件项目文件，而源文件可以共享。

使用插件架构，插件库在运行时加载，因此您有足够的时间来检测现在是在 x86 还是 x64 上，然后决定加载哪个插件。

希望这有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T15:16:31.400

您应该问自己的主要问题是，您是否需要 64 位版本。[有关详细信息，请参阅Scott Hanselman](http://www.hanselman.com/blog/BackToBasics32bitAnd64bitConfusionAroundX86AndX64AndTheNETFrameworkAndCLR.aspx)和[我自己](http://sander.rijken.info/2009/01/23/net-interop-targeting-x86-vs-x64-vs-anycpu/)的博客文章。

如果你真的需要这两个版本，你也可以将 32 位和 64 位库都加载到 GAC 中，这样运行时就可以自动选择正确的一个。

如果您不想 GAC 您的库，您还可以查看[此 StackOverflow 帖子](https://stackoverflow.com/questions/108971/using-side-by-side-assemblies-to-load-the-x64-or-x32-version-of-a-dll)，其中描述了加载正确程序集的方法。不过我不太喜欢这个解决方案，因为它确实需要一个插件模型

# windows - 用于登录 Windows 用户的 API

> ID：597142
> 
> 赞同：4
> 
> 时间：2009-02-28T00:00:15.497
> 
> 标签：windows, security, accounts

我想以交互模式以编程方式登录另一个 Windows 用户。我已经创建了新的 Windows 用户帐户，并且想在没有用户交互的情况下将系统切换到该帐户。

您能否指点我一些 API 命令或 MSDN 页面？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T00:02:56.147

看起来 WTSConnectSession 是正确的方向

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T00:10:16.847

如果您不是在谈论终端服务器会话，那么如果您以该用户身份登录，则需要 LogonUser()，如果您想以已经登录的用户身份执行某些操作，则需要 ImpersonateLoggedOnUser()。两者都可以在 Advapi32.lib 中找到。

# oop - OOD：难以识别对象

> ID：597154
> 
> 赞同：1
> 
> 时间：2009-02-28T00:08:54.273
> 
> 标签：oop

这应该是一个简单的。

假设我正在设计一个非常简单的时钟应用程序。用户输入他的 ID，应用程序会显示他一周的小时数，一天的小时数，然后允许他打卡。知道员工当前是否被打卡是足够聪明的。没有休息、午餐、轮班或任何事情。

所以我有一个员工。我有一个包含多个 EventRecords 的 Timecard。我有一个 Timeclock，它当然可以保持时间，但它也是整个模型的前端（也许）。

Employee 应该有一个 Timecard，还是 Timecard 应该引用一个 Employee？

考勤卡是否应该负责计算当天的小时数等？

Timeclock 是否应该负责实例化Employees 和Timecards 并将它们关联起来？

Timeclock 应该执行punchIn 和punchOut，还是应该由Employee 执行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T00:15:15.023

**只需从最终用户的**角度而不是从程序员的角度回答您自己这些问题。

> *Employee 应该有一个 Timecard，还是 Timecard 应该引用一个 Employee？*

谁拥有时间卡？

> *Timecard 是否应该负责计算当天的小时数等？**

应该是？

> *Timeclock 是否应该负责实例化Employees 和Timecards 并将它们关联起来？*

时钟是否实例化了员工？

> *Timeclock 应该执行punchIn 和punchOut，还是应该由Employee 执行？*

相同的...

首先，你必须分析问题。然后设计解决方案，然后再编写代码。

因此，您应该将每个进程与另一个进程分开。在这里，您似乎正在分析实施，然后进行设计等。

请参阅Steve A. Lowe 的[回答](https://stackoverflow.com/questions/137375/process-to-pass-from-problem-to-code-how-did-you-learn/137598#137598)

一旦你清楚地知道哪个对象负责什么，并且在实施过程中，你可以稍微调整你的设计并在有意义的情况下对其进行调整。

一旦你有更多的经验，这三个过程可能会在你的脑海中发生得非常非常快。但是，你必须要有耐心。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T00:15:16.130

这是一个很好的例子，说明您的 OO 模型基本上应该反映现实世界。

> Employee 应该有一个 Timecard，还是 Timecard 应该引用一个 Employee？

员工应该有一张考勤卡。如果它是实时卡，您将携带它。你不会在时间卡的口袋里。

> 考勤卡是否应该负责计算当天的小时数等？

我不确定你是什么意思。你的意思是计算从退房减去入住的小时数？这可能是您的考勤卡可以做的事情。

> Timeclock 是否应该负责实例化Employees 和Timecards 并将它们关联起来？

大概。“时钟”究竟是什么？当我想到创建员工并将其与考勤卡相关联时，我想的更多是“办公室”。不过，我不确定您的模型的全部范围是什么。

> Timeclock 应该执行punchIn 和punchOut，还是应该由Employee 执行？

你见过时间卡自己进进出出吗？我认为可以肯定地说这是员工的行为。

编辑：正如 TheTXI 所指出的，员工会在考勤卡上调用打孔和打孔方法。但考勤卡本身不负责知道何时打卡或打卡。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-28T00:15:27.817

注意：与大多数建模一样，并不总是有一种方法可以做到这一点。

> Employee 应该有一个 Timecard，还是 Timecard 应该引用一个 Employee？

域会建议员工有一张考勤卡（正如所指出的，随着时间的推移，不仅仅是考勤卡）。

> 考勤卡是否应该负责计算当天的小时数等？

我会让 TimeCardCalculator 负责。

> Timeclock 是否应该负责实例化Employees 和Timecards 并将它们关联起来？

我认为实例化应该由您的应用程序在更高级别完成。

> Timeclock 应该执行punchIn 和punchOut，还是应该由Employee 执行？

时钟。员工在 TimeClock 上调用 PunchIn/PunchOut。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-28T00:21:06.477

是的，这种东西很经典。最简单的事情是应用另一个规则。我最喜欢的是帕纳斯定律：每个对象都“隐藏”了一些可以改变其接口背后的需求的东西。

好的，很清楚 Employee 有一个 TimeCard，它是按时间排序的开始和停止时间列表。

*就域*而言，当您“打卡”时，您所做的就是制作“时间开始”的记录。听起来像“打卡”和“打卡”可能是 TimeCard 方法，如果我们考虑一下，这也隐藏了可能的需求更改（例如，它是数据库中的记录，平面文件中的一行，以及您存储的是本地时间、格林威治标准时间还是 UNIX 时间？）

员工是员工的代表，包含所有员工特定的信息；姓名、地址等

到目前为止，除了作为在外部世界域中打卡和打卡的“实现”之外，还没有明显的需要 TimeClock。

现在，当您构建一个应用程序，但必须从域构建时，现在您需要某种 UI，一种身份验证（确定您想要的员工）并从那里获取员工的 TimeCard 的方法——这表明Employee 的方法。然后，您需要在 UI 中“打卡”和“打卡”的地方。这听起来好像您的 timeClock 很可能是实现中的 View 对象。它需要几个按钮以及您的登录协议是什么。

这里还有一个部分是“业务流程”或“先登录，然后打卡。然后，打卡，然后注销”或类似的东西。有一个控制器；你如何拆分它在某种程度上取决于你如何做 UI。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-28T00:25:04.330

我认为您对这里的物理对象有点过于迷恋了。Employee 可能很适合作为对象，因为它具有身份并且是场景中的参与者，但我不认为 Timecard 或 Timeclock 作为对象的任何好的候选者。Timecard 只是属于员工的 EventRecords 列表，因此您也可以将它们保存在 Employee 对象或集体列表中。Timeclock 什么都不做，只是分发 DateTime.Now...

EventRecord 很好，或者它可能是一个 WorkTime 对象；一对或打卡和打卡时间。如果最后一条记录中没有打卡时间，则员工被打卡。

将时间记录保存在 Employee 对象中或将它们保存在单独的列表中并引用每个 Employee 是一个口味问题。

好吧，当我废弃 Timecard 和 Timeclock 对象时，你的大部分问题都落到了……；）

# php - 在 PHP 中可靠地下载大文件

> ID：597159
> 
> 赞同：27
> 
> 时间：2009-02-28T00:12:21.800
> 
> 标签：php, download

我在服务器上有一个 php 脚本来将文件发送给 recipents：他们得到一个唯一的链接，然后他们可以下载大文件。有时传输出现问题，文件已损坏或永远不会完成。我想知道是否有更好的方法来发送大文件

代码：

```
$f = fopen(DOWNLOAD_DIR.$database[$_REQUEST['fid']]['filePath'], 'r');
while(!feof($f)){
    print fgets($f, 1024);
}
fclose($f); 
```

我见过诸如

```
http_send_file
http_send_data 
```

但我不确定它们是否会起作用。

解决此问题的最佳方法是什么？

问候
欧翼

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2014-02-21T14:19:51.423

分块文件是 PHP 中最快/最简单的方法，如果您不能或不想在[Apache](http://durham.net.au/force-download-large-files-with-php/)或一些[专用脚本上使用](http://phpsnips.com/579/PHP-download-script-for-Large-File-Downloads#.UwdOiWJ5Nfg)[cURL](http://www.phpriot.com/articles/download-with-curl-and-php)等更专业的东西。[`mod-xsendfile`](https://tn123.org/mod_xsendfile/)

```
$filename = $filePath.$filename;

$chunksize = 5 * (1024 * 1024); //5 MB (= 5 242 880 bytes) per one chunk of file.

if(file_exists($filename))
{
    set_time_limit(300);

    $size = intval(sprintf("%u", filesize($filename)));

    header('Content-Type: application/octet-stream');
    header('Content-Transfer-Encoding: binary');
    header('Content-Length: '.$size);
    header('Content-Disposition: attachment;filename="'.basename($filename).'"');

    if($size > $chunksize)
    { 
        $handle = fopen($filename, 'rb'); 

        while (!feof($handle))
        { 
          print(@fread($handle, $chunksize));

          ob_flush();
          flush();
        } 

        fclose($handle); 
    }
    else readfile($path);

    exit;
}
else echo 'File "'.$filename.'" does not exist!'; 
```

从[richnetapps.com/NeedBee](http://www.richnetapps.com/the-right-way-to-handle-file-downloads-in-php/)[移植](http://need-bee.com/b/2011/11/downloading-large-files-in-php/)。_ 在 200 MB 文件上进行了测试`readfile()`，即使最大允许内存限制设置为`1G`，该文件也会死掉，这是下载文件大小的五倍。

顺便说一句：我也在 files 上对此进行了测试`>2GB`，但 PHP 只能先写入`2GB`文件，然后断开连接。与文件相关的函数（fopen、fread、fseek）使用 INT，因此您最终会达到`2GB`. 在这种情况下，上述解决方案（即`mod-xsendfile`）似乎是唯一的选择。

**编辑**：*让自己**100%**将您的文件保存在`utf-8`. 如果您忽略它，下载的文件将被损坏。这是因为此解决方案用于`print`将文件块推送到浏览器。*

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-28T00:32:05.000

如果您要发送真正的大文件并担心这会产生影响，您可以使用 x-sendfile 标头。

来自 SOQ [using-xsendfile-with-apache-php](https://stackoverflow.com/questions/80186/using-xsendfile-with-apache-php)，howto [blog.adaniels.nl：how-i-php-x-sendfile/](https://web.archive.org/web/20171205120512/http://blog.jasny.net/articles/how-i-php-x-sendfile/)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-06T04:49:07.470

最好的解决方案是依赖 lighty 或 apache，但如果在 PHP 中，我会使用[PEAR 的 HTTP_Download](http://pear.php.net/manual/en/package.http.http-download.php)（无需重新发明轮子等），具有一些不错的功能，例如：

*   基本节流机制
*   范围（部分下载和恢复）

请参阅[介绍/使用文档](http://pear.php.net/manual/en/package.http.http-download.intro.php)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-04-04T08:13:10.613

我们一直在几个项目中使用它，到目前为止它工作得很好：

```
/**
 * Copy a file's content to php://output.
 *
 * @param string $filename
 * @return void
 */
protected function _output($filename)
{
    $filesize = filesize($filename);

    $chunksize = 4096;
    if($filesize > $chunksize)
    {
        $srcStream = fopen($filename, 'rb');
        $dstStream = fopen('php://output', 'wb');

        $offset = 0;
        while(!feof($srcStream)) {
            $offset += stream_copy_to_stream($srcStream, $dstStream, $chunksize, $offset);
        }

        fclose($dstStream);
        fclose($srcStream);   
    }
    else 
    {
        // stream_copy_to_stream behaves() strange when filesize > chunksize.
        // Seems to never hit the EOF.
        // On the other handside file_get_contents() is not scalable. 
        // Therefore we only use file_get_contents() on small files.
        echo file_get_contents($filename);
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-28T00:17:57.920

对于下载文件，我能想到的最简单的方法是将文件放在一个临时位置，并为他们提供一个唯一的 URL，他们可以通过常规 HTTP 下载该 URL。

作为生成这些链接的一部分，您还可以删除超过 X 小时的文件。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-11-08T18:40:26.803

创建指向实际文件的符号链接并将下载链接指向符号链接。然后，当用户单击 DL 链接时，他们将从真实文件中下载文件，但从符号链接中命名。创建符号链接需要几毫秒，这比尝试将文件复制到新名称并从那里下载要好。

例如：

```
<?php

// validation code here

$realFile = "Hidden_Zip_File.zip";
$id = "UserID1234";

if ($_COOKIE['authvalid'] == "true") {
    $newFile = sprintf("myzipfile_%s.zip", $id); //creates: myzipfile_UserID1234.zip

    system(sprintf('ln -s %s %s', $realFile, $newFile), $retval);

    if ($retval != 0) {
        die("Error getting download file.");
    }

    $dlLink = "/downloads/hiddenfiles/".$newFile;
}

// rest of code

?>

<a href="<?php echo $dlLink; ?>Download File</a> 
```

这就是我所做的，因为 Go Daddy 在 2 分 30 秒左右后终止了脚本的运行......这可以防止该问题并隐藏实际文件。

然后，您可以设置 CRON 作业以定期删除符号链接....

然后，整个过程会将文件发送到浏览器，它运行多长时间并不重要，因为它不是脚本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-28T01:08:36.893

如果您使用 lighttpd 作为网络服务器，安全下载的替代方法是使用[ModSecDownload](http://redmine.lighttpd.net/projects/lighttpd/wiki/Docs:ModSecDownload)。它需要服务器配置，但您将让网络服务器自己处理下载，而不是 PHP 脚本。

生成下载 URL 看起来像这样（取自文档），当然它只能为授权用户生成：

```
<?php

  $secret = "verysecret";
  $uri_prefix = "/dl/";

  # filename
  # please note file name starts with "/" 
  $f = "/secret-file.txt";

  # current timestamp
  $t = time();

  $t_hex = sprintf("%08x", $t);
  $m = md5($secret.$f.$t_hex);

  # generate link
  printf('<a href="%s%s/%s%s">%s</a>',
         $uri_prefix, $m, $t_hex, $f, $f);
?> 
```

当然，根据文件的大小，使用[Unkwntech](https://stackoverflow.com/questions/597159/sending-large-files-reliably-in-php/597184#597184)`readfile()`提出的方法非常好。并且使用 garrow 提出的[xsendfile](https://stackoverflow.com/questions/597159/sending-large-files-reliably-in-php/597195#597195)是 Apache 也支持的另一个好主意。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-28T00:25:18.977

当我过去这样做时，我使用过这个：

```
set_time_limit(0); //Set the execution time to infinite.
header('Content-Type: application/exe'); //This was for a LARGE exe (680MB) so the content type was application/exe
readfile($fileName); //readfile will stream the file. 
```

这 3 行代码将完成下载的所有工作[readfile()](http://php.net/readfile)会将指定的整个文件流式传输到客户端，并确保设置无限时间限制，否则您可能会在文件完成流式传输之前用完时间。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-08-16T07:57:05.487

```
header("Content-length:".filesize($filename));
header('Content-Type: application/zip'); // ZIP file
header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="downloadpackage.zip"');
header('Content-Transfer-Encoding: binary');
ob_end_clean();
readfile($filename);
exit(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-22T21:39:44.147

我不确定这对于大文件是否是个好主意。如果您的下载脚本的线程一直运行到用户完成下载，并且您正在运行 Apache 之类的东西，那么只有 50 个或更多的并发下载可能会使您的服务器崩溃，因为 Apache 不是为运行大量长时间运行而设计的同时线程。当然我可能是错的，如果 apache 线程以某种方式终止并且下载在下载过程中位于某处的缓冲区中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-11-04T11:55:15.700

我使用了在 readfile 的 php 手册条目的注释中找到的以下代码段：

```
function _readfileChunked($filename, $retbytes=true) {
    $chunksize = 1*(1024*1024); // how many bytes per chunk
    $buffer = '';
    $cnt =0;
    // $handle = fopen($filename, 'rb');
    $handle = fopen($filename, 'rb');
    if ($handle === false) {
        return false;
    }
    while (!feof($handle)) {
        $buffer = fread($handle, $chunksize);
        echo $buffer;
        ob_flush();
        flush();
        if ($retbytes) {
            $cnt += strlen($buffer);
        }
    }
    $status = fclose($handle);
    if ($retbytes && $status) {
        return $cnt; // return num. bytes delivered like readfile() does.
    }
    return $status;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-11-01T11:35:08.300

我有同样的问题，我的问题通过在开始会话之前添加这个解决了 session_cache_limiter('none');

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-11-28T22:38:37.557

这是在具有 256MB 内存限制的服务器上对大小为 200+ MB 的文件进行测试的。

```
header('Content-Type: application/zip');
header("Content-Disposition: attachment; filename=\"$file_name\"");
set_time_limit(0);
$file = @fopen($filePath, "rb");
while(!feof($file)) {
  print(@fread($file, 1024*8));
  ob_flush();
  flush();
} 
```

# php - 使用 FLEX 和 PHP 的 JSON 解析错误

> ID：597161
> 
> 赞同：0
> 
> 时间：2009-02-28T00:14:28.350
> 
> 标签：php, apache-flex, json

我正在使用 JSON 来解析数据并连接到 PHP 文件。我不确定问题出在哪里，因为我是 flex 新手。这是我收到的错误：

```
JSONParseError: Unexpected < encountered
    at com.adobe.serialization.json::JSONTokenizer/parseError()
    at com.adobe.serialization.json::JSONTokenizer/getNextToken()
    at com.adobe.serialization.json::JSONDecoder/nextToken()
    at com.adobe.serialization.json::JSONDecoder()
    at com.adobe.serialization.json::JSON$/decode()
    at DressBuilder2/getPHPData()
    at DressBuilder2/__getData_result()
    at flash.events::EventDispatcher/dispatchEventFunction()
    at flash.events::EventDispatcher/dispatchEvent()
    at mx.rpc.http.mxml::HTTPService/http://www.adobe.com/2006/flex/mx/internal::dispatchRpcEvent()
    at mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::resultHandler()
    at mx.rpc::Responder/result()
    at mx.rpc::AsyncRequest/acknowledge()
    at DirectHTTPMessageResponder/completeHandler()
    at flash.events::EventDispatcher/dispatchEventFunction()
    at flash.events::EventDispatcher/dispatchEvent()
    at flash.net::URLLoader/onComplete() 
```

这是实际的 mxml 代码：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute"  width="535" height="345">
<mx:Script>
<![CDATA[
 import mx.events.DataGridEvent;
 import mx.controls.TextInput;
 import mx.rpc.events.ResultEvent;
 import mx.collections.ArrayCollection;
 import com.adobe.serialization.json.JSON;

 [Bindable]
 private var dataArray:ArrayCollection;

 private function initDataGrid():void
 {
   dataArray = new ArrayCollection();
   getData.send();
 }

 private function getPHPData(event:ResultEvent):void
 {
   var rawArray:Array;
   var rawData:String = String(event.result);
   rawArray = JSON.decode(rawData) as Array;
   dataArray = new ArrayCollection(rawArray);
 }

 private function sendPHPData():void
 {
   var objSend:Object = new Object();
   var dataString:String = JSON.encode(dataArray.toArray());
   dataString = escape(dataString);
   objSend.setTutorials = "true";
   objSend.jsonSendData = dataString;
   sendData.send(objSend);
 }

 private function updatedPHPDataResult(event:ResultEvent):void
 {
   lblStatus.text = String(event.result);
 }

 private function checkRating(event:DataGridEvent):void
 {
   var txtIn:TextInput = TextInput(event.currentTarget.itemEditorInstance);
   var curValue:Number = Number(txtIn.text);
   if(isNaN(curValue) || curValue < 0 || curValue > 10)
   {
     event.preventDefault();
     lblStatus.text = "Please enter a number rating between 0 and 10";
   }
  }
]]>
</mx:Script>
 <mx:HTTPService id="getData" url="http://www.keishalexie.com/imd465/forum.php"
 useProxy="false" method="GET" resultFormat="text"
 result="getPHPData(event)">
<mx:request xmlns="">
  <getTutorials>"true"</getTutorials>
  </mx:request>
</mx:HTTPService>
<mx:HTTPService id="sendData" url="http://www.keishalexie.com/imd465/forum.php"
 useProxy="false" method="GET" resultFormat="text"
 result="updatedPHPDataResult(event)">
</mx:HTTPService>
<mx:Binding source="dgData.dataProvider as ArrayCollection"
 destination="dataArray"/>
<mx:Panel x="0" y="0" width="535" height="345" layout="absolute"
 title="Forum">
  <mx:DataGrid id="dgData" x="10" y="10" width="495" height="241"
   dataProvider="{dataArray}" creationComplete="{initDataGrid()}"
   editable="true" itemEditEnd="{checkRating(event)}">
    <mx:columns>
    <mx:DataGridColumn headerText="Name" dataField="name" editable="false"/>
    <mx:DataGridColumn headerText="Author" dataField="author" width="115"
       editable="false"/>
    <mx:DataGridColumn headerText="Rating" dataField="rating" width="50"
       editable="true" />
  </mx:columns>
  </mx:DataGrid>
 <mx:Button x="10" y="259" label="UpdateDatabase" id="butUpdate"
   click="{sendPHPData()}"/>
   <mx:Label x="140" y="261" id="lblStatus"/>
 </mx:Panel>
 </mx:Application> 
```

这是PHP：

```
<?php
  $USERNAME = '';   //database username
  $PASSWORD = '';    //database password
  $DATABASE = '';   //database name
  $URL = '';        //database location

  if(isset($_GET['getTutorials'])) {
    mysql_connect($URL, $USERNAME, $PASSWORD);
    mysql_select_db($DATABASE) or die('Cannot connect to database.');

    $returnArray = array();

    $query = 'SELECT * FROM Tutorials';
    $result = mysql_query($query);

    while($row = mysql_fetch_assoc($result)) {
      array_push($returnArray, $row);
    }

    mysql_close();
    echo json_encode($returnArray);
  }
  elseif(isset($_GET['setTutorials'])) {
     $jsonString = urldecode($_GET['jsonSendData']);
     $jsonString = str_replace("\\", "", $jsonString);
     $data = json_decode($jsonString, true);

     mysql_connect($URL, $USERNAME, $PASSWORD);
     mysql_select_db($DATABASE) or die('Cannot connect to database.');

     foreach ($data as $tutorialEntry) {
       $query = sprintf(
        'UPDATE Tutorials SET rating = "%s" WHERE id = "%s"',
       mysql_real_escape_string($tutorialEntry['rating']),
       mysql_real_escape_string($tutorialEntry['id']));

       $result = mysql_query($query);

       if(!$result) {
         mysql_close();
         echo mysql_error();
         return;
       }
     }

     mysql_close();
     echo "database updated";
   }
?> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T13:28:09.347

访问[http://www.keishalexie.com/imd465/forum.php?getTutorials=1](http://www.keishalexie.com/imd465/forum.php?getTutorials=1)（这是您的代码所调用的）返回

*致命错误*：调用未定义函数：第 23 行 /homepages/38/d177816689/htdocs/keishalexie/imd465/forum.php 中的 json_encode()

这不是一个 json 文件。

解决问题时，在浏览器中访问[http://www.keishalexie.com/imd465/forum.php?getTutorials=1 。](http://www.keishalexie.com/imd465/forum.php?getTutorials=1)然后，一旦那里看起来不错，就开始处理 FLEX 方面的工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T01:10:12.270

看起来您的 JSON 数据中有一个意外的 <，听起来您正在从服务器获取 html 而不是干净的 JSON。

使用[firebug](http://getfirebug.com)或 http 标头工具来检查来自服务器的响应（或者只是在浏览器中加载 url）并查看响应是什么。

您可能需要在输出 JSON 数据时禁用错误日志记录，或者如果您使用的是模板系统，则在发送 JSON 时不要使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T01:10:39.743

看起来您的 Web 服务器正在抛出 HTML 错误页面。所以，是的.. 记录您尝试解析的 JSON 或在解析之前放置断点，并查看您尝试解析的内容是什么。

# apache-flex - FLEX：使 LineChart DATATIP 约束到垂直轴

> ID：597169
> 
> 赞同：2
> 
> 时间：2009-02-28T00:16:36.190
> 
> 标签：apache-flex, actionscript-3, charts, linechart

在制作折线图时，可以说它用于不同部门的业务销售，水平是天，垂直是美元。当您将鼠标悬停在一条线上时，它会告诉数据提示告诉您该部门的销售额。在那一天。我希望它同时显示所有部门，所以假设您将鼠标悬停在第 3 天，我希望显示第 3 天所有部门的数据提示，以便您可以比较同一天所有销售的值。我将数据提示的 mouseSensitivity 设置为一次显示所有行，但我最终得到了一个部门的第 2 天和另一个不需要的第 3 天。这实际上是作为一个错误发布的，并在此处进行了更好的解释：http: [//bugs.adobe.com/jira/browse/FLEXDMV-1853](http://bugs.adobe.com/jira/browse/FLEXDMV-1853)

我想知道是否有人可以为此提出解决方法？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-08-05T02:27:12.807

我最近遇到了与此类似的问题，并提出了一个也适用于您的问题的解决方案。我有一个步骤 LineChart 并希望在用户悬停在线上的任何位置而不是仅在定义的数据点时显示数据提示。

您可以在此处阅读我为该问题编写的解决方案：[Flex：在 LineChart 中自定义数据提示位置和行为](http://instantdelay.com/2010/08/flex-customizing-data-tip-location-and-behavior-in-a-linechart/)

您必须稍微修改我的解决方案以适应您的问题：

在第 47 行，您可以删除`Math.abs(last.y - mouseLoc.y) < 50`支票。这将数据提示限制在鼠标垂直方向 50 像素以内的行上。

我假设您使用的是默认*分段*折线图，它只是在数据点之间直接绘制线条。您需要修改在给定 x 坐标处计算线值的代码，以使用该图表类型。我已经在第 33-41 行找到了鼠标左侧最近的数据点并将其存储在`last`. 只需获取下一个数据点（将是最靠近鼠标*右侧*的数据点）并使用类似这样的方法来获取鼠标处的值：

```
var slope:Number = (nextPoint.y - last.y) / (nextPoint.x - last.x);
var lineYAtMouse:Number = (slope * (last.x - mouseLoc.x)) + last.y;
var lineValue:Array = line.localToData(new Point(mouseLoc.x, lineYAtMouse)); 
```

然后将第 69 行到第 72 行替换为：

```
hitPoint.x = mouseLoc.x;
hitPoint.y = lineYAtMouse;
hitPoint.xValue = lineValue[0];
hitPoint.yValue = lineValue[1]; 
```

我还没有测试过这些修改，所以可能存在一个或 2 个错误，但总体思路就在那里。我希望也许这对某人仍然有用。这个问题已经很老了。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-17T16:38:47.217

不是答案，而是一个糟糕的选择：

您可以创建自己的 DataTip 渲染器，该渲染器 [ahem] 映射每个点的位置并为那里的每个点绘制提示。

基本上，您将在图表类中复制大量代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-25T23:01:31.120

我有同样的问题，但在柱形图上工作。正在考虑我可以使用 backgroundElements 启用垂直网格线，然后为鼠标悬停添加图表事件侦听器（当鼠标经过垂直网格线时触发）。使用 localX 值，我可以将它与最近的数据点进行比较，也许。

布赖恩

# asp.net - DynamicData 自定义角色/每个表的安全性

> ID：597175
> 
> 赞同：1
> 
> 时间：2009-02-28T00:20:07.993
> 
> 标签：asp.net, security, dynamic-data

我有一个动态数据 ASP.NET 应用程序，要求为某些用户提供表 X、Y 和 Z，而其他用户只提供 X 和 Z。所有这 3 个表都使用标准 ListDetails 页面模板，我们真的希望避免创建x、y 和 z 的自定义页面。处理这种安全性的最佳方法是什么？

我们所有的权限都存储在具有布尔属性的客户用户类中。所以在这个例子中，我们有 CanViewX、CanViewY 和 CanViewZ。

我们不想将表名硬编码到代码中。

**编辑**
我突然意识到这可能需要更多解释，因为它有一个赏金......我们正在使用 DynamicData 框架，我们希望避免为列表、listdetails、编辑等创建客户页面。对于将在站点中访问的每个不同的表。我们有特殊要求会阻止一个用户触摸桌子 A，但他们可以触摸 B 和 C。而其他用户可能只能触摸 A 和 B。

我们正在寻找有关如何处理此问题的建议和解决方案，而无需在代码中的任何位置对表名进行硬编码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T05:52:26.007

您是否尝试过按照此项目中的步骤操作：

[http://csharpbits.notaclue.net/2008/05/introduction-this-project-is-going-to.html](http://csharpbits.notaclue.net/2008/05/introduction-this-project-is-going-to.html)

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T00:34:50.187

C＃：

```
protected void Page_Load(System.Object sender, System.EventArgs e)
{
  ToggleTables();
}

private void ToggleTables()
{
tableXid.Visible = canviewx();
tableYid.Visible = canviewy();
tableZid.Visible = canviewz();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T17:18:53.390

除了前面提到的我的博客中的文章，您还可以查看使用路由处理[程序的 codeplex 上的 Securing Dynamic Data 示例。](http://aspnet.codeplex.com/Release/ProjectReleases.aspx#ReleaseFiles)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-23T16:40:46.553

我想提一下，在新的 Dyanmic Data Preview 3 中，有一个支持基于角色的安全性的新功能 DomainService 请在此处查看 MIX09 中的 David Ebbo 的 Serssion [Microsoft ASP.NET 4.0 Data Access: Patterns for Success with Web Forms MIX09-T47F](http://videos.visitmix.com/MIX09/T47F)

# c++ - Windows GUI C++ 编程

> ID：597182
> 
> 赞同：9
> 
> 时间：2009-02-28T00:24:41.070
> 
> 标签：c++, user-interface, visual-c++

我想使用 Visual Studio 2008 学习 C++ GUI 编程。但我不知道从哪里开始。我在高中学习了 C++，但不是 GUI。我已经做 C# 大约 3 年了，这就是我“学习”GUI 编程的方式。现在我想学习如何在不使用 .NET 框架的情况下编写 GUI，那么我从哪里开始呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-28T00:30:15.533

Charles Petzold 的“Programming Windows 5th Edition”是 Windows 编程的圣经。

[http://www.charlespetzold.com/pw5/](http://www.charlespetzold.com/pw5/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-28T00:31:16.263

既然你说你已经做了大约 3 年的 C# GUI 编程，我假设这意味着 Windows 窗体。一种让你的脚趾浸入水中的方法是记住 WinForms 实际上只是一个面向对象的包装器`user32`。所以加载Reflector，看看一些控件的实现方式。您会看到这些奇怪的消息像Windows`WM_PAINT`一样`WM_KEYDOWN`被发送到`WndProc`各种控件中。在普通的老式 Win32 或 MFC 编程中，同样的事情仍在继续。这样做会让你慢慢剥开洋葱层；您也会更好地了解 Windows 窗体的工作原理。从那里，我建议选择 Petzold 的[Programming Windows](http://www.charlespetzold.com/pw5/)；它很旧，但 Windows 中的本机 API 没有*很多。玩得开心！*

 ** * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-28T00:57:32.397

MFC 现在几乎已经过时了。我建议改用 WTL。

好吧，当有很多好的框架（如 QT 跨平台框架）可用时，仅仅开始用 C++ 为 GUI 编程也不是一个好主意。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-28T00:47:44.040

一些异端观点...

我不推荐 C++ 来编写复杂的 Windows GUI——像 C# 或 Delphi 这样的语言/库组合效率更高。如果你想进入 C++ 编程，我建议使用它来编写某种多线程服务器——一个简单的 Web 服务器对初学者来说就可以了。

如果你真的想了解底层的 Windows API，我认为用 C（而不是 C++）编写一个简单的应用程序（比如笔记本的简化版本）是有道理的。你只想做一次，但在这个过程中你会学到很多东西。

在任何人开始疯狂投反对票之前，让我说我是一名拥有 20 多年经验的 C++ 程序员，并且非常喜欢这门语言。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-28T00:34:59.780

您是否可以使用 Microsoft Foundation Classes 或 MFC 在 VC++ 中编写 GUI？这就是我过去编写 VC++ GUI 的方式。

多年来，有很多关于 MFC 的书籍。我相信他们中的任何一个都会做得很好。您可以在文献中找到参考 ATL，它是 Microsoft 对 STL 的迭代。多年来，MFC 和 ATL 有点合并，所以现在任何 ATL 也适用于 MFC 应用程序。

祝好运并玩得开心点！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-28T01:47:28.187

啊，我知道你的感受，想了解编译编程背后的魔力的老解释语言程序员。好吧，我找不到我用来学习windows编程的教程，但只知道周围有很好的win32教程，所以你不要浪费时间买书。我找到了它：[http](http://www.relisoft.com/win32/index.htm) ://www.relisoft.com/win32/index.htm 最新的教程，相信我。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-08-21T08:56:54.413

截至目前（Windows 8），WinRT，一个全新的 API 已由 Microsoft 带给观众，我对此感到非常兴奋。从未做过 MFC 编程，但看过一些代码示例，它们看起来很怪异 90 年代的 C 风格（现代 C 风格通常更好！）。所以，不打算直接从MFC入手，我想我会从WinRT入手

:)

# encryption - 使用多个密钥进行加密/解密

> ID：597188
> 
> 赞同：143
> 
> 时间：2009-02-28T00:28:23.963
> 
> 标签：encryption, gnupg, encryption-asymmetric

是否可以加密数据，以便可以使用多个不同的密钥对其进行解密？

例子：

> 我已经使用密钥 1 加密了数据，但我希望能够使用密钥 2、3 和 4 进行解密。

这可能吗？

* * *

## 回答 #1

> 赞同：204
> 
> 时间：2009-02-28T00:34:23.760

[GnuPG](http://www.gnupg.org/)在标准中进行多密钥加密。

以下命令将`doc.txt`使用 Alice 的公钥和 Bob 的公钥进行加密。Alice 可以使用她的私钥解密。Bob 也可以使用他的私钥解密。

```
gpg --encrypt --recipient alice@example.com \
    --recipient bob@example.com doc.txt 
```

此功能在标题为“[加密和解密文档](http://www.gnupg.org/gph/en/manual.html#AEN111)”的用户指南部分中有详细说明

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2014-05-18T19:06:55.150

## 是的，这是可能的

是的，可以对多个收件人进行加密。同样，当您认为您可能希望能够阅读您发送给某人的内容并这样做时，*您*需要在收件人列表中，这似乎是合乎逻辑的。

### 命令行

以下是如何通过`gpg`命令行执行此操作（如[David Segonds 的回答](https://stackoverflow.com/a/597200/802365)中所述）：

```
gpg --encrypt \
  --recipient alice@example.com \
  --recipient bob@example.com \
clear-message.txt 
```

### 图形用户界面客户端

您的 GUI 必须提供一种为多人加密的方法

## 机制

有一个关于*信息安全*的问题，[*有多个收件人的 GPG 文件大小？*，解释加密机制](https://security.stackexchange.com/questions/8245/gpg-file-size-with-multiple-recipients)：

> GPG 使用对称密钥对文件进行一次加密，然后放置一个标头标识目标密钥对和对称密钥的加密版本。
> 
> [...] 当加密给多个收件人时，此标头会被多次放置**，为每个收件人提供相同对称密钥的唯一加密版本**。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2015-01-29T04:06:58.137

[GnuPG](https://gnupg.org) and PGP clients in general usually encrypt the actual data with a symmetric key called a "session key". The session key is then encrypted with each "recipient key" (i.e. the ones you specify with -r/--recipient). This is sometimes referred to as a [hybrid cipher](https://www.gnupg.org/gph/en/manual/x209.html). Right now, I believe GnuPG by default uses an 256 bit session keys and AES to encrypt the plaintext data to that AES-256 session key, and your recipient keys are your RSA/DSA/ECDSA/etc. assymetric key in this case.

One reason for doing it this way is that symmetric cryptographic algorithms like AES are generally a lot faster than asymmetric ones like RSA. GnuPG thus only has to encrypt ~256 bits (the session key) with RSA, and can use AES to encrypt the data (as large as you want it to be!) with that session key. Intel machines even have a built in instruction, [AES-NI](http://en.wikipedia.org/wiki/AES_instruction_set), to do some steps of the algorithm in hardware, which makes GnuPG extra snappy at encrypting/decrypting data.

Another reason for doing it this way is that it allows PGP-encrypted documents to be encrypted to multiple parties without having to double the size of the document. Notice that when you specify multiple recipients for an encrypted document (e.g. `gpg -ea -r Alice -r Bob -o ciphertext.asc`), the encrypted document that gets stored (ciphertext.asc) is not 2x as large as if you had just encrypted it to Alice.

See also the `--show-session-key` parameter in the [gpg man page](https://www.gnupg.org/documentation/manpage.html) to be able to decrypt just the session key, for example to allow a third party to decrypt a document that is encrypted to you without having to transfer to them your private key or the plaintext data.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-28T00:31:56.420

是的，这是可能的。谷歌“多方加密”一开始。

AFAIK，尽管没有将它们放入并使用它们的软件包。

——马库斯

PS 对于如何完成它的草图，请考虑这个。加密消息包括：

*   有效载荷，使用一次性密码加密
*   一次性密码本，用 key1 加密
*   一次性密码本，用 key2 加密
*   ...
*   一次性密码本，用 keyN 加密

持有密钥 i 的接收者只需用他们的密钥解密他们的 pad 副本，然后解密有效载荷。

但是，这只是证明它可以完成并且作为实际实现会很*糟糕。*如果可能的话，您应该避免滚动自己的加密。如果你不明白为什么，你*绝对*应该避免滚动你自己的加密。

- - -编辑 - - - - - -

如果我错了，而 Gnu 工具可以做到这一点，请使用它们。但我似乎找不到任何关于如何做到这一点的信息。

* * *

## 回答 #5

> 赞同：-19
> 
> 时间：2011-07-13T09:10:14.133

多个（两个以上）密钥 RSA*可能*是这样的——好吧，我不是数学家，所以这个算法不一定安全，我只是想用它来提供一个想法。

m=p*q*r; p,q,r 是大素数

fi(m)=(p-1) *(q-1)* (r-1)

d==(e1*e2*e3*...*ei)^(-1) (mod fi(m)); e1...ei 是任意数，计算 d 以满足方程

y1==x^e1 (mod m)

y2==y1^e2 (mod m)

y3==y2^e3 (mod m)

...

x==yi^d (mod m)

例如，该算法可用于提高洋葱路由器的速度。

# c# - 关于引用类型的问题

> ID：597192
> 
> 赞同：2
> 
> 时间：2009-02-28T00:31:33.893
> 
> 标签：c#, reference

这取自 Jon Skeet 的优秀个人 C# 站点 ( [http://www.yoda.arachsys.com/csharp/](http://www.yoda.arachsys.com/csharp/) )：

```
StringBuilder first = new StringBuilder();
StringBuilder second = first;
first.Append ("hello");
first = null;
Console.WriteLine (second); 
```

1) 改变 first 的值不会改变 second 的值 -

2) 尽管它们的值仍然是对同一个对象的引用，但是通过第一个变量对对象所做的任何更改都将通过第二个变量可见。

这取自同一个句子。改变值是什么意思？我假设一个变量的值（例如 int x = 4、或 5、或 45 等）。

这是否意味着如果 first 指向另一个兼容的对象，它不会对两个有影响？

该页面上的所有内容都有意义，我认为这只是我对英语的解释的问题。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T00:48:59.310

`first`是对类型对象的引用`StringBuilder`。也就是说，`first`存储一个值，该值可用于引用堆上类型为 的对象`Stringuilder`。`second`是对类型对象的另一个引用`StringBuilder`，其值最初设置为引用所引用的同一对象`first`。

如果你改变`first`你正在做的事情的价值，那就是改变所指对象是什么。也就是说，您使用`first`的是指代不同的对象。这不影响`second`；它的值不受 值变化的影响`first`。（请记住： 和 的值`first`是`second`最初具有相同所指对象的引用。但就像

```
int x = 1;
int y = x;
x = 2; 
```

不会改变 的值`y`，改变 的值`first`不会改变 的值`second`。

另一方面，当`first`和`second`引用同一个对象时，对该对象的任何更改都将通过`first`和可见`second`。

像这样想。假设我创建了一个文本文件`first.html`，其内容是

```
<a href="http://stackoverflow.com">Stack Overflow</a> 
```

我发出命令`copy first.html second.html`。那么两个页面都可以用来引用同一个网页；通过点击链接，我们到达了同一个参照物。如果对 Stack Overflow 主页进行了更改，那么通过`first.html`或访问主页`second.html`将允许我查看这些更改。但是，如果我再将内容更改`first.html`为

```
<a href="http://www.thedailywtf.com>The Daily WTF</a> 
```

那我就不能再用`first.html`Stack Overflow 的主页来指代了。此外，这种变化不会影响`second.html`. 它还是

```
<a href="http://stackoverflow.com>Stack Overflow</a> 
```

将这些文件的内容视为引用类型的值，并将最终目标视为引用对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T00:36:39.217

对象本身的价值和对象的内容的区别并不清楚。

例如，可以通过调用 first 上的方法来更改 second 的内容，如示例中对 Append 的调用。但是，将 first 的值设置为 null 不会将 second 设置为 null。

您可以通过编写此代码并在调试器中单步执行它来轻松地看到这一点。

# delphi - Delphi 2007 没有生成我想发送到我的 Java-WS Web 服务的 XML

> ID：597196
> 
> 赞同：2
> 
> 时间：2009-02-28T00:32:15.997
> 
> 标签：delphi, delphi-2007, java-ws

我有一个 Java Web 服务，我使用 WSDL 导入器从 Delphi 2007 应用程序链接到该服务。设置它是一条[崎岖的道路](https://stackoverflow.com/questions/462171/delphi-2007-not-consuming-jax-ws-web-service-properly)，但我快到了！

我现在遇到的情况是我的数组没有以我的 Java Web 服务可以使用的方式进行序列化。我在 .Net 中编写了相同的应用程序来测试它（它工作正常），我希望生成的 XML 看起来像这样：-

```
<?xml version="1.0"?>
<SOAP-ENV:Envelope
        xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/">
    <SOAP-ENV:Body xmlns:NS2="http://path.to.service">
        <NS1:addActivities xmlns:NS1="http://path.to.service/">
            <login href="#1"/>
            <project xsi:type="xsd:string">PROJ001</project>
            <activities>
                <id xsi:type="xsd:string">DELPHITEST</id>
                <name xsi:type="xsd:string">This is a test</name>
            </activities>
            <activities>
                <id xsi:type="xsd:string">DELPHITEST2</id>
                <name xsi:type="xsd:string">This is another test</name>
            </activities>
        </NS1:addActivities>
        <NS2:login id="1" xsi:type="NS2:login">
            <database xsi:type="xsd:string">My_database</database>
            <password xsi:type="xsd:string">neverUmind</password>
            <username xsi:type="xsd:string">bob</username>
        </NS2:login>
    </SOAP-ENV:Body>
</SOAP-ENV:Envelope> 
```

但是，Delphi 生成的 XML 如下：-

```
<?xml version="1.0"?>
<SOAP-ENV:Envelope 
        xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/">
    <SOAP-ENV:Body xmlns:NS2="http://path.to.service/">
        <NS1:addActivities xmlns:NS1="http://path.to.service/">
            <login href="#1"/>
            <project xsi:type="xsd:string">PROJ001</project>
            <activities xsi:type="SOAP-ENC:Array" 
                    SOAP-ENC:arrayType="NS2:activity[2]">
                <item href="#2"/>
                <item href="#3"/>
            </activities>
        </NS1:addActivities>
        <NS2:login id="1" xsi:type="NS2:login">
            <database xsi:type="xsd:string">My_database</database>
            <password xsi:type="xsd:string">neverUmind</password>
            <username xsi:type="xsd:string">bob</username>
        </NS2:login>
        <NS2:activity id="2" xsi:type="NS2:activity">
            <id xsi:type="xsd:string">DELPHITEST</id>
            <name xsi:type="xsd:string">This is a test</name>
        </NS2:activity>
        <NS2:activity id="3" xsi:type="NS2:activity">
            <id xsi:type="xsd:string">DELPHITEST2</id>
            <name xsi:type="xsd:string">This is another test</name>
        </NS2:activity>
    </SOAP-ENV:Body>
</SOAP-ENV:Envelope> 
```

基本上，我需要 Delphi 停止在活动元素中创建**活动**元素**，**而只需将每个 ID 和名称放在活动元素中（正如 .Net 所做的那样，Java 似乎也期望如此）。

 **我对 InvRegistry.RegisterInvokeOptions 和 RemClassRegistry.RegisterSerializeOptions 感到厌烦，但似乎没有一种组合有效。老实说，我即将为此编写自己的 XML 解析器，因为它需要很长时间才能弄清楚。但是，如果有人对这应该如何工作有任何建议，我将不胜感激。

肯定有人之前通过 Delphi 2007 使用过 Java-WS Web 服务:)

TIA

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T12:16:33.290

Delphi 2007 中的 XMLDocument 组件似乎已损坏。我已经安装了[Alcinoe](http://sourceforge.net/projects/alcinoe)组件，这很有魅力。那只是浪费了一个星期...... grrrr

# python - 在 Python 中将对象转换为子类？

> ID：597199
> 
> 赞同：42
> 
> 时间：2009-02-28T00:34:11.297
> 
> 标签：python

假设我有一个我无法更改的库函数，它产生一个 A 类的对象，并且我创建了一个从 A 继承的 B 类。

使用库函数生成 B 类对象的最直接方法是什么？

编辑-我在评论中被问到更多细节，所以这里是：

PyTables 是一个在 python 中处理分层数据集的包。我最常用的一点是它能够管理部分在磁盘上的数据。它提供了一个仅带有扩展切片的“数组”类型，但我需要选择任意行。Numpy 提供了这种功能——您可以通过提供与您选择的数组长度相同的布尔数组来进行选择。因此，我想继承 Array 来添加这个新功能。

在更抽象的意义上，这是我之前考虑过的一个问题。通常的解决方案就像已经建议的那样 - 有一个 B 的构造函数，它接受一个 A 和其他参数，然后提取 A 的相关位以插入到 B 中。因为这似乎是一个相当基本的问题，我问了看看是否有我不知道的标准解决方案。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-28T01:40:07.473

如果子类的初始化程序可以处理它，或者您编写显式升级程序，则可以这样做。这是一个例子：

```
class A(object):
    def __init__(self):
        self.x = 1

class B(A):
    def __init__(self):
        super(B, self).__init__()
        self._init_B()
    def _init_B(self):
        self.x += 1

a = A()
b = a
b.__class__ = B
b._init_B()

assert b.x == 2 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-28T00:57:05.173

由于库函数返回 A，因此您不能在不更改它的情况下使其返回 B。

您可以做的一件事是编写一个函数来获取 A 实例的字段并将它们复制到新的 B 实例中：

```
class A: # defined by the library
    def __init__(self, field):
        self.field = field

class B(A): # your fancy new class
    def __init__(self, field, field2):
        self.field = field
        self.field2 = field2 # B has some fancy extra stuff

def b_from_a(a_instance, field2):
    """Given an instance of A, return a new instance of B."""
    return B(a_instance.field, field2)

a = A("spam") # this could be your A instance from the library
b = b_from_a(a, "ham") # make a new B which has the data from a

print b.field, b.field2 # prints "spam ham" 
```

编辑：根据您的情况，**组合而不是继承**可能是一个不错的选择；那就是您的 B 类可能只包含 A 的实例而不是继承：

```
class B2: # doesn't have to inherit from A
    def __init__(self, a, field2):
        self._a = a # using composition instead
        self.field2 = field2

    @property
    def field(self): # pass accesses to a
        return self._a.field
    # could provide setter, deleter, etc

a = A("spam")
b = B2(a, "ham")

print b.field, b.field2 # prints "spam ham" 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2015-03-25T13:16:41.660

*如果您知道自己在做什么，您*实际上可以更改`.__class__`对象的属性：

 *```
In [1]: class A(object):
   ...:     def foo(self):
   ...:         return "foo"
   ...:

In [2]: class B(object):
   ...:     def foo(self):
   ...:         return "bar"
   ...:

In [3]: a = A()

In [4]: a.foo()
Out[4]: 'foo'

In [5]: a.__class__
Out[5]: __main__.A

In [6]: a.__class__ = B

In [7]: a.foo()
Out[7]: 'bar' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T00:59:08.507

Monkeypatch 图书馆？

例如，

```
import other_library
other_library.function_or_class_to_replace = new_function 
```

噗，它会返回任何你想要它返回的东西。

Monkeypatch A. **new**返回 B 的实例？

调用 obj = A() 后，将结果更改为 obj. **等级**=B？

# ssh-keys - 设置 SSH 密钥的初学者问题

> ID：597204
> 
> 赞同：0
> 
> 时间：2009-02-28T00:35:45.240
> 
> 标签：ssh-keys

我收到这个错误

```
WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED 
```

错误消息的其余部分与[此处](http://ubuntuforums.org/showthread.php?t=596176)类似。

我的服务器中有 SSH 密钥。我的桌面上有我的私钥。我不确定我应该把它放在哪里。

```
Add correct host key in ~/Users/Sam/.ssh/known_hosts to get rid of this message. 
```

我应该将服务器的公钥添加到文件中吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T00:51:47.213

问题是服务器的公钥已与您的客户端上次连接时使用的公钥不同，这可能表明试图欺骗您连接到以某种方式伪装成您的预期目标的服务器，以便窃取您的凭据或其他一些恶意行为。

如果服务器上的公钥已被显式更改，则该消息也会自然发生，这可能出于多种正当原因而发生 - 在不久的过去，基于 Debian 的 Linux 发行版中存在一个漏洞，许多人需要重新生成密钥，例如。

如果您可以确认您正在连接到预期的目的地，并且您知道任何密钥更改都是合法的，那么您通常可以接受密钥更改。或者，如消息所述，您可以通过替代（安全）通道获取服务器的公钥并更新客户端的本地副本，以便它再次识别服务器的凭据。

如果您不控制服务器，请联系控制服务器的个人或组织，并查明更改是否合法。

您**无需**以任何方式修改您的私钥；*这与您的*密钥对无关。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T01:53:13.633

如果服务器上的密钥确实被更改（即您不是中间人攻击的受害者），最简单的想法是从消息中获取行号（`offending key is in path/known_host:line_number`），删除此行，登录到服务器（并接受密钥）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T00:37:27.107

你的意思是，以编程方式？

可能您可以在此问题中发布的论坛上找到更好的支持：

[https://stackoverflow.com/questions/321618](https://stackoverflow.com/questions/321618)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-07-29T11:18:12.450

我只是遇到了这个错误，我认为这是因为我之前在我的笔记本电脑上使用了另一个 Vagrant 实例来完成我的工作任务，现在该任务已经完成，我正在尝试将 Vagrant 用于我自己的项目，但是旧 Vagrant 实例的公钥仍在我的`known_hosts`文件中。`known_hosts`所以我只是删除了文件中的旧条目`127.0.0.1`并保存了文件，错误就消失了。

# php - 如何将 SQL COUNT 语句的结果存储在 PHP 变量中

> ID：597206
> 
> 赞同：1
> 
> 时间：2009-02-28T00:35:47.267
> 
> 标签：php, mysql

我想获取我的 MySQL 表中的行数并将该数字存储在 php 变量中。这是我正在使用的代码：

```
$size = @mysql_query("SELECT COUNT(*) FROM News"); 
```

$size 最终成为“资源 ID #7”。如何将行数直接放入 $size？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-28T00:41:05.600

mysql_query 返回一个查询资源 id。为了从中获取值，您需要在资源 id 上使用 mysql_fetch_assoc 以将行提取到数组中。

```
$result = mysql_query("SELECT COUNT(*) FROM News");
$row = mysql_fetch_assoc($result);
$size = $row['COUNT(*)']; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T00:38:44.233

您需要调用[mysql_fetch_row](http://us.php.net/manual/en/function.mysql-fetch-row.php)或其[姊妹函数](http://us.php.net/mysql)之一。

```
<?php
// untested
$result = @mysql_query("SELECT COUNT(*) FROM News");
// error handling
$row = mysql_fetch_row($result);
$count = $row[0];
?> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-20T17:56:19.477

尝试以下操作：

```
$size = @mysql_query("SELECT COUNT(*) AS `total` FROM News");
$query = mysql_fetch_array($size);
echo $query['total']; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-28T05:23:22.117

在相关说明中，您可以使用[mysql_num_rows()](http://ca3.php.net/manual/en/function.mysql-num-rows.php)函数从给定查询中获取行数。如果您需要获取数据但还需要知道行数，这将非常方便。

```
<?php
  $result = @mysql_query("SELECT * FROM news");
  $count = @mysql_num_rows($result);
?> 
```

# windows - 使用 xperf 获取符号

> ID：597211
> 
> 赞同：1
> 
> 时间：2009-02-28T00:38:16.170
> 
> 标签：windows, profiling, xperf

我通读了文档并使用了概述的命令，但是由于某种原因，我似乎没有得到任何符号，只是汇总表的函数列中的一系列“未知数”，除了我正在尝试的应用程序的最顶层集调试....我将环境变量设置为 microsoft 服务器和包含应用程序 pdb 的目录。我还确保在调出汇总表之前选择“加载符号”项。

根据我正在阅读的信息，表格在加载符号时应该需要一些时间才能显示，但是对我来说，表格几乎立即显示并且只有 sprite.exe->sprite.exe 中最上面的项目具有函数名称，函数的其他行是空白或“未知”

我正在使用 Vista SP1。

这是我使用的批处理文件。我做了什么会阻止符号被加载的事情吗？

```
REM start profiler
xperf -on PROC_THREAD+LOADER+INTERRUPT+DPC+PROFILE^
 -stackwalk profile -minbuffers 16 -maxbuffers 1024 -flushtimer 0^
 -f tmp.etl
REM run the app we want to profile
sprite.exe
REM stop
xperf -d profile.etl
REM set symbol path
set _NT_SYMBOL_PATH = ^
 C:\Projects\C++\fl lib\bin;^ REM dlls
 C:\Projects\C++\fl lib\samples\bin;^ REM main exe
 SRV*c:\symbols*http://msdl.microsoft.com/download/symbols
REM display profile
xperf profile.etl 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T00:44:21.960

它使用的是什么版本`dbghelp.dll`？在`kernrate`使用`dbghelp.dll`安装在`%SystemRoot%\system32`.

您可能需要将最新版本的 Windows 调试工具复制`dbghelp.dll`到`symsrv.dll`XPerf 可以找到它的目录中。

此外，您需要删除“=”之前的空格，否则您正在定义“ `_NT_SYMBOL_PATH` ”变量（包括名称中的尾随空格）。

在行尾包含注释也不行。诸如“^”之类的行继续字符通常需要是该行的最后一个字符。当我（在 XP 上）运行该语句时，我最终得到“ `_NT_SYMBOL_PATH` ”等于“   `C:\Projects\C++\fl lib\bin; REM dlls`”以及关于下一行的错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T02:19:57.627

尝试设置

```
TRACE_FORMAT_SEARCH_PATH 
```

环境变量。如果这不起作用，您可能必须使用 TracePdb.exe 手动从 PDB 中提取 TMF 文件（或至少使用常规路径而不是 SYM* 路径）。这是迄今为止使用 ETL 跟踪 / XPerf 最烦人的部分

# c++ - 文件指针行为？

> ID：597213
> 
> 赞同：0
> 
> 时间：2009-02-28T00:39:36.807
> 
> 标签：c++, c, file

这是参考我之前提出的问题 -

[在 C/C++ 中声明和使用 FILE * 指针的正确方法是什么？](https://stackoverflow.com/questions/589389/what-is-the-correct-way-to-declare-and-use-a-file-pointer-in-c-c)

```
MyFile.h
char         sMsg[712]      = "";

#define STD_MSG(string) \
fprintf (stderr, string)

#define ERR_MSG(fp, string) \
fprintf (fp, "%s\n", string);\
fflush (fp)

MyFile.C
#include "PdmTestClnt.h"

//---------------------------------------------------------------
// ** Global variables
//---------------------------------------------------------------
FILE * fpErr = NULL;

funcxyz() {
//FILE * fpErr1 = NULL; 
sprintf (sMsg, "************ CHECKING FOR THE CRASH ************. \n");
ERR_MSG (fpErr, sMsg);
//ERR_MSG (fpErr1, sMsg);
}

//========================================================================
// Main
//========================================================================
integer main (integer argc, char ** argv)
{
   //FILE * fpErr = NULL;

   if (!(fpErr = sysFopen (sErrFileName, "a+")))
   {
      sprintf (sMsg,"Error in opening file %s", sErrFileName);
      STD_MSG (sMsg);
   }

     // Log in the error file
     sprintf (sMsg, "Log into the error file. \n");
     ERR_MSG (fpErr, sMsg);

funcxyz();

} 
```

如果文件指针被声明为全局的，它就可以工作。但如果它被声明为本地，则会导致内存故障（核心转储）。

跑了：

惠普 Unix 安腾

aCC 编译器（C++ 编译器）

有人可以解释这种行为吗？

编辑：很抱歉没有编辑问题。我现在了解 printf()/fprintf() 的问题。在我的回答中，我在 Windows 上使用 Dev C++ 编译器展示了 printf()/fprintf() 的结果。但是当我使用 aCC 编译器在 HP Unix 上运行它时，它会完全忽略 %s 并始终正确打印字符串。那么我如何让我的架构师更改它而不向他展示 Unix 上的内存错误呢？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T00:50:31.303

假设本地您的意思是`funcxyz()`取消注释 fpErr1，它会出现段错误，因为您没有打开文件。你不能只`NULL`在那里使用，你希望数据去哪里？

我建议写作`funcxyz`为`fpErr1`参数，例如：

```
funcxyz(FILE *fpErr1) {
   //FILE * fpErr1 = NULL; 
   sprintf (sMsg, "************ CHECKING FOR THE CRASH ************. \n");
   ERR_MSG (fpErr1, sMsg);
   //ERR_MSG (fpErr1, sMsg);
} 
```

然后从 main 调用它，例如：

```
 ...
 funcxyz(fpErr);
 ... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T01:55:34.127

### 不要在标题中定义变量 - 这是一个讨厌的习惯。

从头文件中删除初始化程序`sMsg[]`，并在前面加上' `extern`' - 并在适当的源文件（通常是 MyFile.c，如果头文件是 MyFile.h）中使用初始化程序定义变量。当 MyFile.h 被多个源文件使用时，这真的很重要——如果它只被一个源文件使用，你为什么首先使用头文件？

您的代码还包含“PdmTestClnt.h”而不是 MyFile.h - 我们是否应该假设 MyFile.h 是您要包含的内容？

`funcxyz()`没有返回类型 - 它不会在 C++ 或严格的 C99 编译器下编译。为什么函数格式化成`sMsg`，然后`fprintf()`用来复制字符串？ `fprintf()`可以完成整个工作（然后是一些）。

### 为什么需要全局定义

当你有一个全局变量时，里面的代码`main()`通过调用来初始化它`fopen()`，其他函数可以使用这个初始化的值。这很方便。当你有一个局部变量时，你必须初始化它。这很痛苦，因为您最终会多次打开文件，这会产生许多不必要的副作用 - 使用的文件句柄太多，您也必须关闭它们，并且您可能会一直截断文件中已经存在的输出。为避免这种情况，请将文件指针传递给函数 - 或接受全局是可以的。想一想 - 以某种形式或形式，名称`stdin`，`stdout`并`stderr`指代全局变量。

```
void funcxyz(FILE *fp)
{
    sprintf(sMsg, "************ CHECKING FOR THE CRASH ************. \n");
    ERR_MSG (fpErr, sMsg);
}

int main(int argc, char **argv)
{
    FILE *fpErr = NULL;

    if ((fpErr = sysFopen(sErrFileName, "a+")) != 0)
    {
        sprintf(sMsg,"Error in opening file %s", sErrFileName);
        STD_MSG(sMsg);
    }

    // Log in the error file
    sprintf(sMsg, "Log into the error file. \n");
    ERR_MSG(fpErr, sMsg);

    funcxyz(fpErr);
    return(0);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-28T00:44:03.973

**此信息与问题无关。在我回答之前，我应该更仔细地阅读。=X**

您的问题是您正在`fpErr`将全局范围与本地范围中的一个重叠。例如：

```
int var = 0;

void print_var() {
    printf("print_var: %d\n", var);
}

int main() {
    int var = 42;

    printf("main: %d\n", var);
    print_var();

    return 0;
} 
```

如果你运行代码，输出应该是：

```
main: 42
print_var: 0 
```

在您的情况下，`fpErr`值为`NULL`(0)，因此文件 I/O 函数尝试访问 处的数据`NULL`，这会导致分段错误。

# c# - 有没有一种干净的方法可以在构建时设置 VS 2008 安装项目的属性？

> ID：597216
> 
> 赞同：0
> 
> 时间：2009-02-28T00:42:01.637
> 
> 标签：c#, visual-studio-2008, installation, windows-installer

我有一个带有用于部署的设置项目的 Office 插件项目（使用 VS 2008），我需要以几种不同的风格构建相同的产品。

我正在寻找一种使安装程序资源依赖于构建配置的好方法。每个版本的产品名称、制造商、制造商 url、作者等属性应该不同。此外，安装程序 UI 中显示的图像也会有所不同。

如果可能的话，我想这样做而不为每个不同的 UI 创建一个新项目。我相信这可以使用 ORCAS 工具和构建事件来完成，但这种方法似乎过于复杂和脆弱。

有没有人对这样做的干净方式有任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T13:50:19.167

另一种选择，虽然前面的工作要多一些，但是将设置项目扔出窗口并使用例如 WiX 代替（[http://wix.sf.net](http://wix.sf.net)）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T00:43:55.097

我认为最好的方法是创建手工制作的 NAnt 脚本。

解释：

NAnt 是一个构建工具，除了构建之外还可以执行脚本。通过创建脚本和目标，您可以修改从 SCM 签出的文件，然后命令它们进行构建。查看[官方 NAnt 网站](http://nant.sourceforge.net/)了解更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T03:44:23.460

您可以手动复制 vddproj 文件并使用文本编辑器对其进行编辑。我承认，这不是一个非常强大的解决方案，每次设置内容发生更改时，您都必须重复此步骤。

# c++ - 试图在 C++ 代码中包含 iPhone OpenGLES 标头

> ID：597217
> 
> 赞同：2
> 
> 时间：2009-02-28T00:42:22.773
> 
> 标签：c++, iphone, opengl-es

我有一些 C++ 做 OpenGL 绘图，并试图弄清楚如何包含 opengl 标头，而不会在 obj-c 代码中给我带来数千个错误。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-01T02:28:58.110

我没有收到任何错误。
你在做什么

`#include <OpenGLES/ES1/gl.h>`

?

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T23:58:45.580

您可以将文件另存为 .mm 而不是 .cpp。您仍然可以在其中使用 C++ 函数，但您也可以#import 您需要的各种包含文件，以及在代码中混合 C++ 和 Obj-C。

# jquery - 如何使用 jquery 删除对象/行（发布表单）

> ID：597223
> 
> 赞同：1
> 
> 时间：2009-02-28T00:44:50.927
> 
> 标签：jquery, ruby-on-rails

我有一个模型帖子，用户可以在其中编辑和删除自己的帖子。我的索引页面是一个表格，每个帖子都有几列。其中一个持有删除按钮的表单。有没有关于 jquery 如何使用 rails 提交发布/删除表单的示例？我需要将状态传回给用户。例如。帖子已删除，访问被拒绝等，如果成功则删除该行。

最好的祝福。阿斯比约恩·莫雷尔。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-02T14:23:33.313

如果操作成功，则响应将是成功的（即 200 OK）。如果请求遇到错误，您可以在 jQuery 中添加错误函数：

```
error: function() {
  // the item has not been deleted
  // and we encountered an error
} 
```

然后在你的控制器中，如果你想明确地返回你自己的错误：

```
render :text => 'Could not compute!', :status => :unprocessable_entity 
```

或[任何其他错误](http://www.codyfauser.com/2008/7/4/rails-http-status-code-to-symbol-mapping)。希望这可以帮助。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-02-28T05:05:00.723

您应该查看 link_to_remote 方法；它使用 AJAX——我假设你所说的“JQuery”是什么意思。

我通常会做类似的事情：

```
<%= link_to_remote "Delete", :url => some_path(@object), :method => :delete %> 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-02-28T09:13:36.570

链接到远程。将创建生成帖子表单的内联 Javascript。如果禁用 Javascript，这将不起作用。

我创建了一个标准的 html 表单，它可以在没有 Javascript 的情况下工作，如果启用了 Javascript，我想用 jquery 来增加它的趣味性。

```
<% form_for @post, :html => { :method => 'delete' } do |f| %>
    <%= submit_tag "Delete", :name => "delete" %>
<% end %> 
```

[我昨晚发现了这个 blob](http://brandonaaron.net/blog/2009/02/25/unobtrusive-destroy-links-in-rails-using-jquery)，它几乎涵盖了我想做的事情。我唯一想不通的是我如何从控制器返回错误或成功。

# python - 寻找一个可以从 rapidshare 下载的工作 linux 命令行工具

> ID：597224
> 
> 赞同：0
> 
> 时间：2009-02-28T00:44:51.537
> 
> 标签：python, linux, command-line, download

我想知道是否有人知道一个用于 linux 的工作命令行工具，可以使用 rapidshare 上的高级帐户下载。我见过一个[python 解决方案](http://juanjoalvarez.net/rapidsucker)，它对我不起作用——返回 urllib2 错误消息

```
urlopen error unknown url type: https 
```

而且我对python的了解还不够深入，无法弄清楚原因：可能是最近的RS更改或我的设置有问题。

某人周围的任何其他工具可能正在使用并可以共享链接？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T04:24:13.193

[`wget`](http://www.gnu.org/software/wget/)效果很好。您必须将其指向包含与您的 Rapidshare 帐户相对应的 cookie 的文件（例如，`cookies.txt`在 Firefox 的配置文件目录中）。

```
wget --load-cookies /path/to/cookies.txt http://... 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T03:56:04.383

[`curl`](http://curl.haxx.se/)是一个非常强大的命令行工具，用于从 Web 服务器中提取内容。我不能特别说 RapidShare，但是如果您看到手动下载正在做什么，例如，您可以让 curl 发布相同的表格。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-09-29T10:28:42.613

我喜欢[犁铧](http://code.google.com/p/plowshare/)。
它让你（取决于文件托管）

*   下载
*   上传
*   列表
*   删除

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-24T10:52:38.440

Here's a tutorial for a command line tool to download from rapidshare: [http://fedoracoreproject.blogspot.com/2009/03/linux-command-line-tool-to-download.html](http://fedoracoreproject.blogspot.com/2009/03/linux-command-line-tool-to-download.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-28T00:51:05.530

要让 urllib2 打开 https URL，您需要支持 SSL 的 Python。如何获得它取决于您的发行版。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-30T19:03:40.230

RapidShare 和许多其他服务（MegaUploads、HotFiles 等）的不错的命令行工具。它允许从不同的服务同时传输：

[http://svn.pld-linux.org/cgi-bin/viewsvn/toys/rsget.pl/](http://svn.pld-linux.org/cgi-bin/viewsvn/toys/rsget.pl/)

只需创建带有 URL 列表的文件（# 表示注释），然后启动 rsget.pl list-of-urls 它使用 url 列表监视文件，因此您可以添加/删除链接而无需重新启动脚本（即中断当前传输）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-20T12:51:06.620

如果您不介意使用 Ruby（无论如何它与 Python 非常相似），请查看[rapidshare gem](https://github.com/defkode/rapidshare)（我贡献了，顺便说一句）。

安装：`gem install rapidshare`

简单使用示例：

```
require 'rapidshare'

files_to_download = %w{
  https://rapidshare.com/files/829628035/HornyRhinos.jpg
  https://rapidshare.com/files/3103991314/HappyHippos.jpg
  https://rapidshare.com/files/3882189288/ElegantElephants.jpg
}

rs = Rapidshare::API.new(:login => 'my_login', :password => 'my_password')

files_to_download.each do |file|
  rs.download(file) || puts "ERROR downloading #{file}"    
end 
```

/examples 目录中有一个更高级的[下载客户端。](https://github.com/defkode/rapidshare/blob/master/examples/rsclient.rb)

# python - Python：获取 IPv6 套接字以接收发往子网路由器任播地址的数据包

> ID：597225
> 
> 赞同：5
> 
> 时间：2009-02-28T00:45:31.877
> 
> 标签：python, networking, ipv6

如何获得一个套接字来接收发往 IPv6 子网路由器任播地址的数据包？

我无法找到有关如何执行此操作的任何信息。

绝望中，我尝试使用 socket.setsockopt ，就像加入多播组一样：

```
# 7 is the interface number 
s = socket(AF_INET6, SOCK_DGRAM)
packed_iface_num = struct.pack("I", 7) 
group = inet_pton(AF_INET6, 'fd36:d00d:d00d:47cb::') + packed_iface_num

# socket.error: (22, 'Invalid argument')
s.setsockopt(IPPROTO_IPV6, IPV6_JOIN_GROUP,  group) 
```

并且还使用绑定

```
# socket.error: (99, 'Cannot assign requested address')
s.bind(('fd36:773e:6b4c:47cb::', 9876)) 
```

正如预期的那样，这些都不起作用。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T14:11:59.357

而不是`IPV6_JOIN_GROUP`，尝试传递`IPV6_JOIN_ANYCAST`给您的`s.setsockopt()`代码。不幸的是，Python`socket`模块没有定义它，但您应该能够传递等效的整数。在 Linux[`IPV6_JOIN_ANYCAST`](http://lxr.linux.no/linux+v2.6.28.7/include/linux/in6.h#L181)中是`27`和[`IPV6_LEAVE_ANYCAST`](http://lxr.linux.no/linux+v2.6.28.7/include/linux/in6.h#L182)是`28`. （在 /usr/include/linux/in6.h 中定义）

我能找到的最好的文档来自[描述 Linux 内核任播补丁的 lkml 电子邮件](http://lkml.indiana.edu/hypermail/linux/net/0208.3/0028.html)：

> 加入和离开任播组的应用程序接口是 2 个新的 setsockopt() 调用：IPV6_JOIN_ANYCAST 和 IPV6_LEAVE_ANYCAST。参数与相应的多播操作相同。

愿舞蹈卡梅与你同在！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-27T23:00:50.967

`IPV6_JOIN_ANYCAST`和`IPV6_LEAVE_ANYCAST`socket 选项是非标准的 Linux 主义。

If you'd like your code to be *portable*, then you should probably do it the standard way, i.e. assign the subnet routers anycast address to the appropriate interface, then bind your socket to the wildcard address and discard everything not sent to the subnet router anycast address. Remember, you're not supposed to send packets with the anycast address in the source field, and you can't open a read-only socket in the standard sockets API.

Assigning an interface address should be a privileged operation on any reasonable operating system, and that's the part that isn't going to be standard whatever you do. If you must do that programmatically, then it will mean (on BSD for example) using something like the `SIOCAIFADDR_IN6` code and the `ioctl()` system call. Make sure to set the `IN6_IFF_ANYCAST` flag in the `ifra_flags` field of the interface alias request structure.

# c# - ViewState、UserControl 和 IsPostback

> ID：597226
> 
> 赞同：1
> 
> 时间：2009-02-28T00:46:27.243
> 
> 标签：c#, .net, viewstate

基本上，我有一个下拉列表和一个动态添加的用户控件。用户控件根据在下拉列表中所做的选择加载网格视图。下拉列表不是用户控件的一部分。

现在，问题是，每次用户更改下拉列表中的选择时，我如何模拟（isControlPostback = false）？看起来 ViewState 记得该控件。

在我的用户控件中，我有：

```
protected bool IsUserControlPostBack
{
    get
    {
        return this.ViewState["IsUserControlPostBack"] != null;
    }
}

protected void Page_Load(object sender, EventArgs e)
{
    if (!IsUserControlPostBack)
    {
        ViewState.Add("IsUserControlPostBack", true);
        //load stuff in the grid view and bind it
    }
} 
```

当用户更改下拉列表中的选择时，我有一个 javascript 确认框，并且页面回发。所以下拉列表的 OnSelectedIndexChanged 事件不会被触发。每次所选索引更改时，我都想删除以执行此类操作： ViewState.Remove("IsUserControlPostBack");

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T08:59:33.517

您可以在 prerender 事件中对控件进行更改。当触发此事件时，将执行所有其他操作。或者，您可以在用户控件中执行公共属性，并在设置所需的值时做出适当的反应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T23:16:30.780

您在用户控件中访问的 ViewState 与您在页面上访问的不同。如果您需要您的页面与您的用户控件进行通信，我建议您为此目的在您的用户控件上添加一个公共方法。

> 如果出于某种原因，您更喜欢类似于您的 ViewState 方法的东西，您可以尝试使用 Context.Items。请注意，请求之间不保留 Context.Items。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T04:54:28.287

在 OnLoad 之前的某个时间将控件添加到页面。例如 OnInit。在 OnInit 和 OnLoad 之间，加载视图状态并运行回发事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T20:53:21.363

对于有兴趣知道答案的任何人：我最终在用户控件中实现了一个公共属性，并将控件加载到服务器下拉列表 SelectedIndexChanged 事件而不是 OnInit 中。这消除了显式使用 Viewstate 的需要。

# .net - .net 2.0 IRC 组件

> ID：597237
> 
> 赞同：5
> 
> 时间：2009-02-28T00:51:11.647
> 
> 标签：.net, irc

有人知道一个好的winforms IRC组件吗？我不想要 IRC 应用程序，我希望能够将 IRC 功能添加到现有的 windows 窗体

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T01:01:36.707

你可以看看[这个](http://blogs.microsoft.co.il/blogs/giladlavian/archive/2007/10/07/c-irc-client-api.aspx)和[这个](http://sourceforge.net/projects/smartirc4net/)。您可能需要自己构建 UI 组件，但一个好的 IRC 库将承担大量繁重的任务。

# iphone - 如何在 iPhone 上使用 GNU C Compiler/gcc & Mobile-Terminal 编译简单的 C 文件？

> ID：597255
> 
> 赞同：1
> 
> 时间：2009-02-28T01:03:29.027
> 
> 标签：iphone, c, gcc, compiler-construction, gnu

如何在 iPhone 上使用 GNU C Compiler/gcc & Mobile-Terminal 编译简单的 C 文件？！我需要额外的文件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-04T12:04:11.107

(pH - Pedro Henrique) 有一个不错的 iphone os c/c++ 编译器。查看[http://www.spaziocellulare.com/ispazio/2009/03/29/iphone-os-cc-compiler-cydia/](http://www.spaziocellulare.com/ispazio/2009/03/29/iphone-os-cc-compiler-cydia/) 或在 cydia 中搜索该软件包。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-19T20:52:56.247

是的，您需要从 Cydia 安装额外的软件包：

*   制作
*   iPhone 1.1.1 标头

Cydia 不再提供第二个，但 iPhone SDK 的头文件必须手动插入。

我不确定，但我认为它必须在 ~/var/include 中解压缩（搜索它！）。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-04-19T22:36:43.500

您必须在`/private/var/include`.

# theory - 对程序员更深入地了解 CPU 有何价值？

> ID：597257
> 
> 赞同：5
> 
> 时间：2009-02-28T01:04:16.543
> 
> 标签：theory, cpu

我最近突然想到，我（我认为大多数人）从 Visual Basic 之类的东西开始学习计算机编程。我开始怀疑我们是否先从较低级别开始，如果现在更容易。

作为一个程序员，你认为理解 CPU 的工作原理、基本指令之类的东西有什么价值吗？我的意思是，我们最终不是真的在谈论它吗？

如果我们从 CPU 级别开始并从那里开始教授，我们可能会发现我们可以更容易地理解如何在更高级别上操作它。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-28T01:09:39.683

它是双向的。

例如，很多从较高级别开始的人不知道为什么移位比乘法和除法快得多，或者分支的影响等等。

因此，他们经常编写速度较慢但普通人更容易理解的代码。（请注意，对于某些应用程序，速度更快比易于理解更重要）

了解幕后发生的事情（不同操作需要多少时钟周期，CPU 的管道如何工作，缓存的影响等）的人通常可以编写非常快的代码，但对很多人来说可能很难理解/维护。（这在“优化”没有明显好处的应用程序中尤其困难，可维护性更重要）

就我个人而言，我觉得知道“下面发生了什么”至少让我有能力了解我正在做出的决定的影响。

老实说，在这一点上，我不介意将许多低级细节/优化留给编译器。无论如何，它可能比我做得更好：]

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-28T01:18:11.037

我学到了很多关于低级编程的知识，而且我认为它对我编写的每一段代码都非常有帮助。即使是高级语言也有一些版本，比如基本同步原语（互斥锁/锁、条件、信号量）；他们仍然需要从磁盘或网卡中读取；他们仍然必须将字节从内存中的一个位置复制到另一个位置，依此类推……关键是，您使用的是高级语言这一事实​​并不意味着知道这些东西如何工作是没有用的。如果您了解计算机如何在最低级别运行，那么无论您的平台有多抽象，您都可以始终应用这些知识来编写更高效和/或不易出错的代码。低级操作的知识甚至可以教给你一些你可能永远不会学到的东西——没有比必须实现一个更好的方法来学习如何正确使用诸如互斥锁之类的东西。（好吧，也许这有点夸张，但我希望你明白我的意思）

归根结底，我会说是的，对于所有抽象级别的程序员来说，学习基础知识绝对是一个好主意。但我不认为*开始一定是个好主意*与基本面。众所周知，汇编语言级别的程序很难理解，我认为试图将其强加给编程初学者可能会阻止他/她。我提到了解基本操作将帮助您编写更高效和/或不易出错的代码，但肯定根本没有必要编写代码。所以在我看来，大多数人可能最好从中间的某个地方开始，在那里他们仍然可以在熟悉编码过程的同时抓住熟悉的概念，比如对象。经过在该领域的一些经验，CPU 的东西是公平的游戏;-)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-28T02:20:40.650

我希望我的医生知道我的心脏是如何工作的（但不一定能够进行心脏手术），我希望我的机械师知道我的引擎是如何工作的（但不一定能够制造引擎），我希望我的程序员能够知道 CPU 是如何工作的（但不一定能够构建 CPU，或者用汇编编写企业应用程序。但是，讨论 CPU 缓存或看到一些汇编代码也不应该让他跑到山上）。

我们是专业人士。我们应该知道事情是如何“在幕后”工作的，即使我们通常不在那个层次上工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-28T01:10:11.617

仍然有一个程序员社区确实是这样学习的。

毫无疑问，了解您正在使用的硬件可以让您深入了解如何最好地为该硬件编写代码。话虽如此，我遇到（和编写）的一些最特定于硬件的代码也是可读性和可维护性最低的。

我认为对于一般的编程来说，它并不是非常重要。但是，一旦您进入性能关键领域，就必须具备这项关键技能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-28T01:15:14.863

我认为了解底层架构对任何程序员都是有用的，过多的抽象可能是一件[坏事](https://stackoverflow.com/questions/392397/arrays-whats-the-point)。

我不知道从低级别开始工作是否是一个好主意，因为现代 CPU 非常复杂 - 我学习了 Visual Basic，然后是 Java，但我很高兴我学习了 C 和一些汇编语言，因为它帮助我编写性能关键代码。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-28T02:37:54.120

编程语言是虚拟机。C、C#、Fortran、Basic 等本身就是 CPU，尽管是可移植的。他们说，如果你在 Fortran 上编程，你就是在某种 Fortran 机器上编程。如果您在 C 上编程，那么您是在某种 C 机器上编程。甚至还有一种在硬件级别上实现的语言 LISP。

甚至有一个关于 C 的笑话。 C 编程语言：一种结合了汇编语言的所有优雅和强大功能以及汇编语言的所有可读性和可维护性的语言。

您可以使用诸如 C 或带有不安全选项的 C# 之类的语言到达指针、手动内存操作、指令、函数指针等的每个角落和缝隙。

即使您不深入了解 CPU，您也不会错过任何东西。

但是如果你真的想从你的程序中**榨取性能**，那么了解引擎盖下的内容是真正有价值的，如果程序值得学习 CPU/汇编语言。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-28T01:09:44.067

高级语言旨在将我们从我们正在处理的系统的低级架构中抽象出来。虽然这并不意味着架构信息应该被忽略，但它确实意味着这些信息的价值被削弱了。架构特定的知识确实可以帮助您以不同的方式利用系统，但通常这些方式包括绕过我们的高级语言为我们提供的抽象。这是否是一件好事，我留给你。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-28T01:11:25.387

这是没有一个答案的问题之一。

实际上，不，没有太多用处，除非您正在做一些非常具体的事情（在这种情况下，您会提出一个更具体的问题）。

从理论上讲，这是每个反对者都会使用的论点，是的，知道总是很好（......几乎所有东西）......直到它归结为只有一个和零的编程:)

如果您从最低级别开始，您可能永远不会达到这个“高级”级别——这正是最初编写“高级”语言的原因。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-28T01:18:28.337

“如果我们从 CPU 级别开始并从那里开始教学，我们可能会发现我们可以更轻松地理解如何在更高级别上操作它。”

错误的。

我在 70 年代开始编程，你必须知道硬件是如何工作的，因为你的选择是 Fortran（或 Jovial）与汇编程序。

现在我使用 Java 和 Python——好吧——我真的不知道。我有一台戴尔笔记本电脑、一台 MacBook、一台 iMac 和一台我无法确定的服务器。

这些可能有 Intel 或 PowerPC 处理器，或者——好吧——我认为服务器是 64 位的，但我不知道是哪一种。

对某些处理器了解很多（很多）并没有帮助。对现代处理器一无所知并不妨碍。

软件获取知识。特定的硬件与软件捕获的知识几乎没有关系。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-28T01:56:24.220

它让我对自己正在做的事情更有信心，并让我知道何时应该关注性能或可维护性（在几乎 99% 的情况下，我会选择最后一种 :)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-28T02:25:50.203

我开始使用 Basic 编程（在纸带上！），但我早期职业生涯中最好的经历之一是在嵌入式系统中工作，编写 C 和汇编语言程序，并且经常进行交叉编译。了解硬件的功能、高级语言如何映射到 CPU 等等是非常有帮助的。当您在某种程度上了解硬件时，它肯定会帮助您理解指针、指针算术、数据结构对齐、符号扩展，甚至软件性能和操作系统行为。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-11-23T05:54:54.037

比理解 CPU 设计本身更重要的是理解现代语言下抽象的“12 层蛋糕”。这就是为什么**[Nisan 和 Schocken 的 The Elements of Computing Systems](http://www1.idc.ac.il/tecs/)**是我最喜欢的编程书籍的原因。它会带您“从 NAND 到俄罗斯方块的 12 个步骤”，并附带单元测试，以确保您在芯片级别、ALU 级别、CPU 级别、机器代码级别等一直“履行合同”。

说*封装很重要是*一回事；*如果没有*这 12 层之间的封装，则完全是另一回事。这本书教你如何超越一定的复杂性，人脑不再有效，封装是我们用来管理抽象任务的主要工具。通过用逻辑电路构建 CPU 来构建计算机游戏的过程改变了我的编程方式，因为它教会我思考复杂性和通信之间的不利关系，以及层之间明确的公共合同的至高无上的重要性。

# c# - 什么时候结构是答案？

> ID：597259
> 
> 赞同：35
> 
> 时间：2009-02-28T01:05:47.647
> 
> 标签：c#, performance, raytracing

我正在做一个光线追踪器爱好项目，最初我使用结构体作为我的 Vector 和 Ray 对象，我认为光线追踪器是使用它们的完美情况：你创建了数百万个它们，它们的寿命不会超过一个方法，它们是轻量级的。然而，通过简单地将 Vector 和 Ray 上的“struct”更改为“class”，我获得了非常显着的性能提升。

是什么赋予了？它们都很小（向量 3 个浮点数，射线 2 个向量），不要过度复制。当然，我确实会在需要时将它们传递给方法，但这是不可避免的。那么，在使用结构时会导致性能下降的常见陷阱有哪些？我读过[这篇](http://msdn.microsoft.com/en-us/library/ms973839.aspx)MSDN 文章，内容如下：

> 当您运行此示例时，您会发现结构循环的速度要快几个数量级。但是，当您将它们视为对象时，请注意使用 ValueTypes 是很重要的。这会为您的程序增加额外的装箱和拆箱开销，并且最终可能会比您卡在对象上的成本更高！要查看实际情况，请修改上面的代码以使用 foos 和 bar 数组。您会发现性能或多或少相等。

然而，它已经很老了（2001 年），整个“把它们放在一个数组中导致装箱/拆箱”让我觉得很奇怪。真的吗？但是，我确实预先计算了主光线并将它们放在一个数组中，所以我接受了这篇文章并在需要时计算了主光线，并且从未将它们添加到数组中，但它并没有改变任何东西：类，它仍然快 1.5 倍。

我正在运行 .NET 3.5 SP1，我相信它解决了 struct 方法从未内联的问题，因此也不可能是这样。

所以基本上：任何提示，要考虑的事情以及要避免什么？

编辑：正如一些答案中所建议的，我已经建立了一个测试项目，我尝试将结构作为参考传递。添加两个向量的方法：

```
public static VectorStruct Add(VectorStruct v1, VectorStruct v2)
{
  return new VectorStruct(v1.X + v2.X, v1.Y + v2.Y, v1.Z + v2.Z);
}

public static VectorStruct Add(ref VectorStruct v1, ref VectorStruct v2)
{
  return new VectorStruct(v1.X + v2.X, v1.Y + v2.Y, v1.Z + v2.Z);
}

public static void Add(ref VectorStruct v1, ref VectorStruct v2, out VectorStruct v3)
{
  v3 = new VectorStruct(v1.X + v2.X, v1.Y + v2.Y, v1.Z + v2.Z);
} 
```

对于每个我都有以下基准方法的变体：

```
VectorStruct StructTest()
{
  Stopwatch sw = new Stopwatch();
  sw.Start();
  var v2 = new VectorStruct(0, 0, 0);
  for (int i = 0; i < 100000000; i++)
  {
    var v0 = new VectorStruct(i, i, i);
    var v1 = new VectorStruct(i, i, i);
    v2 = VectorStruct.Add(ref v0, ref v1);
  }
  sw.Stop();
  Console.WriteLine(sw.Elapsed.ToString());
  return v2; // To make sure v2 doesn't get optimized away because it's unused. 
} 
```

一切似乎都表现得几乎相同。它们是否有可能被 JIT 优化为传递此结构的最佳方式？

EDIT2：我必须注意，在我的测试项目中使用结构*比*使用类快大约 50%。为什么这对我的光线追踪器有所不同，我不知道。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-28T15:46:17.000

结构数组将是内存中的单个连续结构，而对象数组（引用类型的实例）中的项需要通过指针单独寻址（即对垃圾收集堆上对象的引用）。因此，如果您一次处理大量项目集合，结构将给您带来性能提升，因为它们需要更少的间接。此外，结构不能被继承，这可能允许编译器进行额外的优化（但这只是一种可能性，取决于编译器）。

但是，结构具有完全不同的赋值语义，也不能被继承。因此，除了给定的性能原因，我通常会在需要时避免使用结构。

* * *

**结构**

由结构（值类型）编码的值数组 v 在内存中如下所示：

vvvv

**班级**

由类（引用类型）编码的值数组 v 如下所示：

公私合营

..v..v...vv。

其中 p 是 this 指针或引用，它指向堆上的实际值 v。这些点表示可能散布在堆上的其他对象。在引用类型的情况下，您需要通过相应的 p 来引用 v，在值类型的情况下，您可以直接通过其在数组中的偏移量来获取值。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-28T04:04:24.410

在何时使用结构的建议中，它说它不应大于 16 字节。您的 Vector 是 12 个字节，接近限制。Ray 有两个 Vector，将其设置为 24 字节，这显然超过了建议的限制。

当一个结构大于 16 字节时，它不能再用一组指令有效地复制，而是使用循环。所以，通过这个“神奇”的限制，当你传递一个结构时，实际上你做的工作比传递一个对象的引用要多得多。这就是为什么即使在分配对象时开销更大，使用类的代码也更快的原因。

Vector 仍然可以是一个结构，但是 Ray 太大而不能作为一个结构很好地工作。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-28T01:12:22.953

在 .NET 泛型之前写的任何关于装箱/拆箱的东西都可以用一粒盐来对待。通用集合类型不再需要对值类型进行装箱和拆箱，这使得在这些情况下使用结构更有价值。

至于您的具体减速 - 我们可能需要查看一些代码。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-28T01:12:51.733

基本上，不要让它们太大，并尽可能通过 ref 传递它们。我以完全相同的方式发现了这一点......通过将我的 Vector 和 Ray 类更改为结构。

随着更多的内存被传递，它必然会导致缓存抖动。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-28T01:17:54.623

我认为关键在于您帖子中的这两个陈述：

> 你创造了数百万个

和

> 当然，我确实在需要时将它们传递给方法

现在，除非您的结构的大小小于或等于 4 个字节（如果您在 64 位系统上，则为 8 个字节），如果您只是传递一个对象引用，那么您在每个方法调用上复制的内容要多得多。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-28T03:12:03.150

我要寻找的第一件事是确保您已明确实现 Equals 和 GetHashCode。未能做到这一点意味着它们中的每一个的运行时实现都会执行一些非常昂贵的操作来比较两个结构实例（在内部它使用反射来确定每个私有字段，然后检查它们是否相等，这会导致大量分配） .

不过，一般来说，您能做的最好的事情是在分析器下运行您的代码并查看慢速部分在哪里。这可能是一次令人大开眼界的体验。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-28T01:40:30.980

您是否对应用程序进行了概要分析？分析是查看实际性能问题所在的唯一可靠方法。有些操作通常在结构上更好/更差，但除非您进行概要分析，否则您只会猜测问题所在。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-17T15:00:26.287

虽然功能相似，但结构通常比类更有效。如果类型作为值类型比引用类型**执行得更好**，则应该定义结构而不是类。

具体来说，结构类型应满足所有这些标准：

*   逻辑上表示单个值
*   实例大小小于 16 字节
*   创建后不会更改
*   不会被强制转换为引用类型

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-28T06:05:38.973

我基本上将结构用于参数对象，从函数返回多条信息，并且......没有别的。不知道是“对”还是“错”，但我就是这样做的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-17T10:13:03.887

我自己的光线追踪器也使用 struct Vectors（虽然不是 Rays），并且将 Vector 更改为类似乎对性能没有任何影响。我目前正在为向量使用三个双打，所以它可能比它应该的要大。不过要注意一件事，这可能很明显，但不适合我，那就是在 Visual Studio 之外运行程序。即使您将其设置为优化的发布版本，如果您在 VS 之外启动 exe，您也可以获得巨大的速度提升。您所做的任何基准测试都应考虑到这一点。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-28T16:14:15.420

如果结构很小，并且一次不存在太多，它应该将它们放在堆栈上（只要它是局部变量而不是类的成员）而不是堆上，这意味着 GC 不t 需要被调用并且内存分配/释放应该几乎是瞬时的。

当将结构作为参数传递给函数时，结构被复制，这不仅意味着更多的分配/解除分配（从堆栈，这几乎是瞬时的，但仍然有开销），而且只是在 2 个副本之间传输数据的开销. 如果您通过引用传递，这不是问题，因为您只是告诉它从哪里读取数据，而不是复制它。

我对此不是 100% 确定的，但我怀疑通过“out”参数返回数组也可能会提高速度，因为堆栈上的内存是为它保留的，不需要作为堆栈复制在函数调用结束时“展开”。

* * *

## 回答 #12

> 赞同：-5
> 
> 时间：2009-02-28T01:26:43.213

您还可以将结构体转换为 Nullable 对象。无法创建自定义类

作为

```
Nullable<MyCustomClass> xxx = new Nullable<MyCustomClass> 
```

结构可以为空的地方

```
Nullable<MyCustomStruct> xxx = new Nullable<MyCustomStruct> 
```

但是您将（显然）失去所有继承功能

# c++ - 如何以编程方式确定 Windows 可执行文件 DLL 依赖项？

> ID：597260
> 
> 赞同：12
> 
> 时间：2009-02-28T01:06:08.270
> 
> 标签：c++, windows, dll, dependencies, executable

如何确定 DLL 的二进制文件取决于使用编程方法？

需要明确的是，我不是试图确定正在运行的 exec 的 DLL 依赖关系，而是任何任意 exec（可能缺少所需的 DLL）的依赖关系。我正在寻找在 C/C++ 应用程序中实现的解决方案。这是我的应用程序在运行时需要完成的事情，第三方应用程序（如依赖）无法完成。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-28T01:43:05.047

看一下[`IMAGE_LOAD_FUNCTION`](http://msdn.microsoft.com/en-us/library/ms680209(VS.85).aspx)API。它将返回一个指向[`LOADED_IMAGE`](http://msdn.microsoft.com/en-us/library/ms680349(VS.85).aspx)结构的指针，您可以使用它来访问 PE 文件的各个部分。

[您可以在此处](http://msdn.microsoft.com/en-us/magazine/bb985992.aspx)和[此处](http://msdn.microsoft.com/en-us/magazine/bb985994.aspx)找到一些描述结构布局方式的文章。[您可以在此处](http://code.msdn.microsoft.com/mag200202Windows/Release/ProjectReleases.aspx?ReleaseId=1908)下载文章的源代码。

我认为这应该为您提供所需的一切。

**更新：**

我刚刚下载了这篇文章的源代码。如果您打开`EXEDUMP.CPP`并查看`DumpImportsSection`它应该有您需要的代码。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-28T01:19:19.253

这是无法确定的。至少不是没有大量的工作。任何二进制文件都可以调用 LoadLibrary 来加载 DLL。即使您要扫描对 LoadLibrary 的所有调用的代码，您也必须确定用于标识库的字符串。追踪字符串在动态内存中的位置将比您想要解决的更难。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-11-22T17:35:50.977

基于[pedump](http://code.msdn.microsoft.com/mag200202Windows/Release/ProjectReleases.aspx?ReleaseId=1908)代码的 76 行代码（不要忘记添加 Imagehlp.lib 作为依赖项）：

```
#include <stdio.h>
#include "windows.h" //DONT REMOVE IT
#include "ImageHlp.h"
#include "stdafx.h"

template <class T> PIMAGE_SECTION_HEADER GetEnclosingSectionHeader(DWORD rva, T* pNTHeader) // 'T' == PIMAGE_NT_HEADERS 
{
    PIMAGE_SECTION_HEADER section = IMAGE_FIRST_SECTION(pNTHeader);
    unsigned i;

    for ( i=0; i < pNTHeader->FileHeader.NumberOfSections; i++, section++ )
    {
        // This 3 line idiocy is because Watcom's linker actually sets the
        // Misc.VirtualSize field to 0\.  (!!! - Retards....!!!)
        DWORD size = section->Misc.VirtualSize;
        if ( 0 == size )
            size = section->SizeOfRawData;

        // Is the RVA within this section?
        if ( (rva >= section->VirtualAddress) && 
             (rva < (section->VirtualAddress + size)))
            return section;
    }

    return 0;
}

template <class T> LPVOID GetPtrFromRVA( DWORD rva, T* pNTHeader, PBYTE imageBase ) // 'T' = PIMAGE_NT_HEADERS 
{
    PIMAGE_SECTION_HEADER pSectionHdr;
    INT delta;

    pSectionHdr = GetEnclosingSectionHeader( rva, pNTHeader );
    if ( !pSectionHdr )
        return 0;

    delta = (INT)(pSectionHdr->VirtualAddress-pSectionHdr->PointerToRawData);
    return (PVOID) ( imageBase + rva - delta );
}

void DumpDllFromPath(wchar_t* path) {
    char name[300];
    wcstombs(name,path,300);

    PLOADED_IMAGE image=ImageLoad(name,0);

    if (image->FileHeader->OptionalHeader.NumberOfRvaAndSizes>=2) {
        PIMAGE_IMPORT_DESCRIPTOR importDesc=
            (PIMAGE_IMPORT_DESCRIPTOR)GetPtrFromRVA(
                image->FileHeader->OptionalHeader.DataDirectory[1].VirtualAddress,
                image->FileHeader,image->MappedAddress);
        while ( 1 )
        {
            // See if we've reached an empty IMAGE_IMPORT_DESCRIPTOR
            if ( (importDesc->TimeDateStamp==0 ) && (importDesc->Name==0) )
                break;

            printf("  %s\n", GetPtrFromRVA(importDesc->Name,
                                           image->FileHeader,
                                           image->MappedAddress) );
            importDesc++;
        }
    }
    ImageUnload(image);

}

//Pass exe or dll as argument 
int _tmain(int argc, _TCHAR* argv[])
{
    DumpDllFromPath(argv[1]);

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T01:46:52.870

简而言之，您需要为可执行文件使用的每个 DLL 扫描 PE 文件的**导入部分**。然后递归定位并扫描每个 dll，直到找到所有依赖项。

当然，应用程序可以将 LoadLibrary 系列函数用于必需或可选功能。这种方法不会检测到。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-08T18:24:38.887

如果您有目标可执行文件，[Dependency Walker可以通过使用配置文件菜单来执行此操作。](http://www.dependencywalker.com/)只需加载可执行文件，告诉它开始分析，它就会列出执行程序时加载的所有模块。

[Dependency Walker 常见问题解答（第一个问题...）](http://www.dependencywalker.com/faq.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-09T10:38:04.750

您可以调用一个 DLL 来为您计算所有这些信息并将答案作为 CStrings 数组传回吗？

[PE 格式的 DLL](http://www.objectmedia.ltd.uk/freeSoftware/peFileDLL.html)可以为您做到这一点。提供源代码，没有 GPL 限制。PE 文件资源管理器是一个使用 DLL 的 GUI 应用程序，也提供源代码（非 GPL）。

# vim - 如何在 VIM 中获得更好的括号匹配/对齐？

> ID：597264
> 
> 赞同：4
> 
> 时间：2009-02-28T01:09:39.323
> 
> 标签：vim

有没有办法让VIM把括号放在正确的缩进中？例如，每当我输入：

```
if (something)
    do something 
```

然后我在“做某事”之后按回车键，让它跳回与 if 语句一致？另外，当我进入插入模式时，我可以让它自动跳转到正确的缩进级别而不是停留在行首吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T01:51:42.797

对于一般的 C 语言，您可以在 .vimrc 中执行此操作

```
set smartindent 
```

然而，vim 可以通过为各种语言启用特定规则来做得更好（并且确实喜欢你要求 C）。要启用它，我有：

```
filetype on
filetype plugin on
filetype indent on 
```

[有关更多详细信息，请在我的 .vimrc](http://www.pixelbeat.org/settings/.vimrc "my .vimrc")中搜索“缩进”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T01:57:39.130

我使用 set cindent，它每次都做正确的事情。

（但我不确定 C/C++ 的“正确的事情”是否就是你要问的。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T01:11:11.987

```
:set si 
```

打开智能缩进。但是，如果这样，您可能必须在单行未加括号后键入 control-D。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T01:19:52.310

添加

```
set smartindent 
```

到你的 .vimrc 文件

# oop - 为新程序员定义 OOP

> ID：597267
> 
> 赞同：15
> 
> 时间：2009-02-28T01:09:55.580
> 
> 标签：oop

在向没有编程背景的人教授第一语言时，尽管我更喜欢 OOP，但我很难定义 OOP，我如何向编程经验很少（或零）的人定义 OOP？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-28T01:16:32.117

您可以尝试类似以下的方法，我从前一段时间在论坛上的帖子中稍微修改了一下：

OOP 最基本的词汇集是类、方法和参数。

类是一组协同工作以完成任务的函数。一个类的实例被认为是一个对象。

方法只是指封装在类中的函数。

参数是传递给函数的变量，该函数指示它如何操作或提供信息以进行处理。

如果您进行一些挖掘，您会发现大量有关设计模式的信息。其中一些可能很有用，尽管我一开始会小心不要过多地进入它们，因为它们可能会让人不知所措。在尝试让自己进入 OOP 思维模式时，您可能会记住两个有用（并且有些过度使用）的首字母缩略词：DRY 和 KISS。

DRY 代表 Don't Repeat Yourself，意思就是这样。如果您编写了一些代码，则不必再重复该特定代码。实际上，这意味着从一开始就进行更抽象的思考和更好的计划。我将很快举一个例子。

KISS 代表 Keep It Simple, Stupid，意味着您应该尝试编写以尽可能简单的方式实现其目标的代码。更简单意味着更少的错误可能性和更容易的维护。在 OOP 的上下文中，这通常意味着确保每个方法或函数只有一个任务。如果你发现一个方法做不止一件事，这通常意味着它可以被重构为几个更小的方法，每个方法专门用于特定的任务。

现在举一个简单的例子（有人可能会想出一个更好的例子，但现在跟我一起去吧）：

假设您需要对两种不同的表单进行编程，一种处理汽车信息，另一种处理卡车信息。

对于汽车，我们需要记录以下信息：

*   颜色
*   马达的尺寸
*   传输类型
*   门数

对于卡车，我们需要：

*   颜色
*   马达的尺寸
*   传输类型
*   驾驶室尺寸
*   牵引能力

在过程式编程中，您将首先编写代码来处理汽车表单，然后再编写用于卡车表单的代码。

使用面向对象编程，您将编写一个名为vehicle 的基类，该类将记录我们需要的卡车和汽车的共同特征。在这种情况下，车辆类别将记录：

*   颜色
*   马达的尺寸
*   传输类型

我们将把这些特征中的每一个都变成一个单独的方法。例如，颜色方法可以将车辆的颜色作为参数并对其进行处理，例如将其存储在数据库中。

接下来，我们将创建另外两个类：卡车和汽车，它们都将继承车辆类的所有方法，并使用它们独有的方法对其进行扩展。

汽车类将有一个名为 numberOfDoors 的方法，而卡车类将有方法 cabSize 和 towingCapacity。

好的，让我们假设我们有一个适用于过程和 OO 编程的工作示例。现在，让我们来看看几个场景。

**场景一**：假设我们突然需要添加一个总线表单，它记录了以下信息：

*   颜色
*   马达的尺寸
*   传输类型
*   乘客人数

*程序*：我们需要重新创建整个表单，重复颜色、引擎尺寸和传输类型的代码。

*OOP*：我们简单地用一个总线类扩展车辆类并添加方法 numberOfPassengers。

**场景 2**：我们的客户没有像以前那样将颜色存储在数据库中，出于某种奇怪的原因，我们的客户希望通过电子邮件将颜色发送给他。

*程序*：我们更改了三种不同的形式：汽车、卡车和公共汽车，以通过电子邮件将颜色发送给客户，而不是将其存储在数据库中。

*OOP*：我们更改了车辆类中的颜色方法，因为汽车、卡车和公共汽车类都扩展（或继承自，换句话说）车辆类，它们会自动更新。

**场景 3**：我们希望从普通汽车转向特定品牌，例如：日产和马自达。

*程序*：我们为每个品牌创建一个新表单，重复通用汽车信息的所有代码，并添加每个品牌特定的代码。

*OOP*：我们使用 nissan 类和 mazda 类扩展汽车类，并为该汽车制造商的每组唯一信息添加方法。

**场景4**：我们在表单的传输类型区域发现了一个错误，需要修复它。

*程序*：我们打开并更新每个表格。

*OOP*：我们在车辆类中修复了transmissionType 方法，并且该更改在从它继承的每个类中持续存在。

从上述场景中可以看出，采用 OOP 风格比过程式编程具有显着优势，尤其是随着规模的增加。考虑一下如果我们还必须为船、摩托车、飞机、卡丁车、ATV、雪地摩托等添加表单，我们将从 OOP 获得的重复代码、灵活性和维护方面的节省。

通过使用单元测试来测试结果，对象和方法也比过程编程更容易测试。

这是否意味着您永远不应该使用过程式编程？不必要。如果你正在做一个模型或概念验证应用程序，你可能没有时间让所有东西都面向对象，所以我认为对原型使用过程编程可能会更好，但最好以OO方式制作生产产品。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-28T01:36:20.977

我使用“弹跳球”的例子。想象一下，你有一个盒子，里面有一个弹跳球。

您可以通过 2 种方式对其进行编程：

一种方法是运行一个循环，跟踪球的当前位置，计算下一个位置，检查碰撞，从当前位置擦除，在新位置绘制它。重复。

另一种方法是让球跟踪自己的位置和方向，并教它计算下一个位置以及如何移动到那里以及如何处理碰撞。然后，运行循环并告诉球不断更新自己。

现在想象你有 100 个球。然后是重球、轻球和爆炸球。这些是具有附加特性的基本球。你还会使用方法1吗？

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-28T01:15:43.473

好吧，您应该使用示例。大多数人理解的一个例子是参考视频游戏。因此，您有怪物对象，而怪物具有某些属性，例如颜色、大小、形状、手臂数量等。然后一些怪物有不同的“能力”，比如喷火，射击枪等等。这些都是愚蠢的例子，但很容易理解。我认为向新手解释比“正方形”、“圆形”等所有这些业务更容易。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-28T01:21:11.807

不要浪费时间“定义” OOP。

只需对所有示例使用 OOP 语言即可。

对象是微不足道的。现实世界充满了物体。

不要“定义”对象。只需显示编程示例，“对象性”就会很明显。

没有编程背景的人不会有基于过程编程的愚蠢期望。

学过COBOL或Basic的人会有问题。

* * *

这部分取决于语言。某些语言使 OOP 变得困难。

例如，在 C++ 中，“类”只是定义性的。它在运行时不作为离散对象存在。

在 Java 和 C++ 中，有些东西是对象，但一些“原始”类型不是对象。

一些语言使 OOP 更容易。

Python 和 Smalltalk 一切都是对象。没有原始类型可以搅浑水。当你用 Python 这样的语言学习 OO 时，对象性是清晰而明显的，因为它无处不在。就像现实世界一样，物体无处不在。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-28T01:16:11.307

我会将其解释为对现实世界信息进行建模的一种方式。有一个常见的类比是使用汽车和车辆来显示类型层次结构。如果你解释正确，我认为大多数人都可以理解它。

或许您应该从解释原始类型开始，然后讨论像结构这样的复合类型，然后展示如何使用继承将这些类型关联为类。

编辑：经过考虑，动物的例子要好得多。请参阅[Explaining OOP without Mentioning Classes](http://www.unfitforprint.com/articles/2005/11/22/explaining-oop-without-mentioning-classes-part-1)和这个关于同一主题的[SO 线程。](https://stackoverflow.com/questions/355796/how-do-you-explain-oo-to-new-programmers)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-28T04:25:40.820

一个运动队。任何时候场/场上的球员都可以根据他们所扮演的位置来指定。但是，整个团队可能有多个成员可以扮演给定位置。

每个位置就像 OO 中的一个类；它指定了一组职责。团队成员是这些类的实例。

剧本中的剧本是模式。每一个都指定了如何通过位置（类）的（实例）交互来实现特定的结果。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-28T01:27:37.643

假设您要描述一个拥有相同属性但可能具有不同名称、颜色或其他外观差异的事物系列。

例如，您想描述一个家庭在车库中拥有的车辆。您感兴趣的每辆汽车都有以下属性：

1.  每辆车的型号和年份是什么？
2.  一辆汽车有多少个轮子？
3.  谁是驾驶给定车辆的人？

在这种情况下，您可能有一组两辆汽车，因此以下情况为真：

```
Vehicle A's Model is a Toyota.
Vehicle A's Year is 2001.
Vehicle A has four Wheels
Vehicle A is driven by Mom, Dad, and Junior

Vehicle B is a Moto Guzzi
Vehicle B was made in 2004
Vehicle B has two wheels
Vehicle B is driven by Dad 
```

在各种语言中，您可能会以以下等效方式非常粗略地引用这两个示例：

```
A = new Vehicle();
A.model = "Toyota";
A.year = 2002;
A.wheelCount = 4;
A.drivers = [ "Mom", "Dad", "Junior" ];

B = new Vehicle();
B.model = "Moto Guzzi";
B.year = 2004;
B.wheelCount = 2;
B.drivers = [ "Dad" ]; 
```

在 OOP 中，您正在封装这些车辆的属性，以便您可以通过它们的特性来描述它们。你的工作是编写代码来获取和设置这些特性的值（以及用这些特性做其他有趣的事情）。

此外，您可以“子类化”，这是在不同上下文中重用对象的一种方式。例如，您可以使用更具体的 Vehicle 对象类型，例如 Car 和 Motorcycle，它们从 Vehicle 的描述中继承其特征：

```
A = new Car();
B = new Motorcycle(); 
```

Car 和 Motorcycle 对象是对车辆的更具体的描述。这两个子类可以有自己的特殊属性。汽车可能有儿童锁，而摩托车通常不需要这样的东西。

您可以说只有 Car 具有 Lock 属性，而不是设置 Vehicle 的 Childproof Lock 属性。这使您的车辆描述更清晰，更易于编写和维护。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-28T01:15:34.583

据我所知，面向对象编程最初意味着你将程序的所有概念组织成对象，然后将所有逻辑流定义为这些对象之间的消息。我认为，要想明白本意，就得学习Smalltalk。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-28T04:57:10.883

这是一个简单的定义。

```
Gun gun = new Gun(new Bullet);
gun.Aim = Appendage.Foot;
gun.PullTrigger(); 
```

;)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-28T02:43:09.443

面向对象的编程语言：

1.  程序中的一切都是事物（对象）。这东西具有解释它的属性（大小、形状、颜色等）
2.  程序员要求事情做事/回答问题：让你的尺寸变大（setSize）或你的尺寸是多少（getSize）

该**事物**仅在您要求（调用方法）时才负责调整其属性。您不能直接检查或更改**事物的**属性。您只能检查或更改**事物**让您看到的属性。因此，**Thing**可以确保正确查看和更改属性。

这可以防止程序员告诉**事物**它的**大小**是**红色**的。如果您直接告诉事物将其尺寸设为红色，则它应该拒绝（红色不是有效尺寸）。此外，它允许事物管理更改其属性的副作用。

假设**事物** **的****originalSize**很大。如果*我*只是将**事物的****大小**更改为**small**，*我*必须记住告诉**事物**它不再是它的**originalSize**。如果我**要求***将*其**大小**更改为**小**，它将将其大小更改为小并将 originalSize 更改为 false。现在，当我问它是否是它的 originalSize 时，它​​会回答“否”。

 *********从本质上讲，这使您可以将数据和功能打包在一起，从而使事情更加模块化/分隔。这使您可以更好地组织代码并更轻松地重用代码。OOP 并不是什么特别的东西，它只是一种更好地组织代码的方法。在初学者级别并不重要，但对大型项目至关重要。在一个对象的函数中，事情通常会像初学者习惯的那样变得更加程序化。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-28T10:26:13.870

*对象*只是具有一堆命名属性的事物。这些属性的值定义了对象的*状态*。对象之间的交互是通过*消息传递*完成的。一条消息由一个名称和一组参数组成。当对象接收到消息时，该消息由对象处理。处理消息可能会导致对象的状态发生变化，并且消息被发送到其他对象。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-28T02:56:36.367

对 OOP 的任何解释都强烈依赖于解释者对概念的解释。我对这个概念的解释是这样的。

现实世界在很大程度上被理解为一组演员。每个参与者都有一组属性和行为。在大多数情况下，一个参与者的属性是根据它的行为来表达的，与它与其他参与者的交互有关。

计算机程序通常是对某些现实世界过程的模拟，因此它通常可以帮助程序员基于参与者-行为-属性模型来构建程序。也就是说，整个程序的每个元素都可以分成代表单个参与者的更小的程序。

当然，你只能做到这一点。并非我们想要建模的所有东西都是单个演员。例如，货币是守恒的，但在许多方面可以无限​​细分。

此外，其他对现实世界建模的方法可能会以更大的抽象为代价提供更严格的正确性保证，例如源自集合论的关系模型。OOP 没有这样的数学基础。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-28T13:13:23.670

它就像倒着拼写的馅饼一样简单。oo的3个基本原则是：

封装继承多态性

向新手展示大多数 oo 编程书籍中的标准绘制形状示例的代码。还使用大量带有全局数据的开关向他们展示非 oo 代码。

他们应该根据两组代码之间的组织差异对 oo 有所了解。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-28T03:13:56.263

真奇怪。**您问的是向对编程一无所知的人教授 OOP，每个人都在回答“如何教授 OOP？”**

答案是，你没有。您如何向从未编程过的人教授**函数式编程？**你没有。你有函数，代码被塞进它们，它们被重用，等等。在 Java 中，你的所有代码都必须在一个类中。什么是班级？首先，它是放置代码的地方。程序从 Main 方法开始。稍后，您可以实例化它，每个类都有自己的方法和属性。然后你谈论静态方法和变量。然后稍后你会谈到多态性和继承。有时他们开始设计自己的 API 并使用 servlet 和持久类或任何最新实现的东西（snervlets？IHibernate？）

**但是，如果您以前从未见过编程，则无需坐下来进行 OOP 大讨论。**仅当您从非 OOP 编程中拯救某人时才需要这样做。只教编程。面向对象编程？还有其他种类吗？是的，但我们今天不教这个，所以我们不用担心。

[打个比方：你去上武术课，他们通常不会花很多时间解释。首先你伸展，他们让你锻炼，然后他们教你一些技巧。如果您有兴趣弄清楚您正在学习哪种武术，请前往图书馆。]

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-02-28T01:23:34.627

无论您向谁解释这一点，都需要先了解基本编程是什么，然后才能了解 OOP 的含义，因为它是编程语言的一个分支。如果他不了解 OOP 的对应物，他将永远无法理解是什么让 OOP 如此特别。所以你的问题有两个部分；如何解释什么是编程语言以及 OOP 与其他编程语言的区别。

向他解释一般编程是什么的最简单方法是将其与数学运算进行比较。您可以通过将编程定义为接受输入并产生输出的许多数学表达式来解释它。您希望详细说明的程度取决于您。

有了这个解释，我们已经完成了基础工作，让他理解 OOP 的含义。现在我们可以将对象定义为一组数学函数和数据。因此，我们不是将逻辑视为全局代码块，而是将这些代码块收集在对象中以收集相关代码片段并获得隔离它们的方法。从这一点开始，您可以解释对象抽象带来的更多优势（例如多态性、松散耦合）。

# javascript - IE7 中的 Element.prototype？

> ID：597268
> 
> 赞同：7
> 
> 时间：2009-02-28T01:10:09.417
> 
> 标签：javascript, dom, internet-explorer-7, extend

我正在尝试扩展所有 dom 元素，以便我可以获取和删除他们的孩子。该功能如下（适用于 FF 和 Chrome）。IE7 中是否有等效的扩展基本 dom 对象？

```
if (!Element.get) {
Element.prototype.get = function(id) {
    for (var i = 0; i < this.childNodes.length; i++) {
        if (this.childNodes[i].id == id) {
            return this.childNodes[i];
        }
        if (this.childNodes[i].childNodes.length) {
            var ret = this.childNodes[i].get(id);
            if (ret != null) {
                return ret;
            }
        }
    }
    return null;
}
}

Element.prototype.removeChildren = function() {
    removeChildren(this);
} 
```

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-08T15:00:05.933

这是一个简单的解决方法，在 99% 的情况下就足够了。它也可以根据您的脚本要求完成：

```
if ( !window.Element ) 
{
    Element = function(){};

    var __createElement = document.createElement;
    document.createElement = function(tagName)
    {
        var element = __createElement(tagName);
        if (element == null) {return null;}
        for(var key in Element.prototype)
                element[key] = Element.prototype[key];
        return element;
    }

    var __getElementById = document.getElementById;
    document.getElementById = function(id)
    {
        var element = __getElementById(id);
        if (element == null) {return null;}
        for(var key in Element.prototype)
                element[key] = Element.prototype[key];
        return element;
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T01:20:05.697

[不会。在 IE8 中](http://msdn.microsoft.com/en-us/library/dd282900(VS.85).aspx)会有一些有限的支持，但在那之前你最好找个地方挂你的函数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-07-14T04:43:00.460

IE没有“Element”设置，所以你不能访问Element的原型来直接添加你的功能。解决方法是重载“createElement”和“getElementById”，让它们返回一个带有修改过的原型的元素和你的函数。

感谢 Simon Uyttendaele 的解决方案！

```
if ( !window.Element )
{
        Element = function(){}

        Element.prototype.yourFunction = function() {
                alert("yourFunction");
        }

        var __createElement = document.createElement;
        document.createElement = function(tagName)
        {
                var element = __createElement(tagName);
                for(var key in Element.prototype)
                        element[key] = Element.prototype[key];
                return element;
        }

        var __getElementById = document.getElementById
        document.getElementById = function(id)
        {
                var element = __getElementById(id);
                for(var key in Element.prototype)
                        element[key] = Element.prototype[key];
                return element;
        }
} 
```

# sql - 强制执行准备好的语句的方法

> ID：597277
> 
> 赞同：2
> 
> 时间：2009-02-28T01:14:16.007
> 
> 标签：sql, prepared-statement

我刚刚（偶然）在我正在从事的项目中发现了另一个愚蠢的根本没有清理的 sql 注入缺陷......我已经厌倦了。
您对如何消除此类不良 sql 语句并在可行的情况下强制执行准备好的语句有任何建议吗？现在我更喜欢这样的解决方案

```
REVOKE DarnInlineDataStatements ON * TO xyz
```

但是由于这似乎不太可能，是否有例如静态代码分析工具来查找这些东西（达到一定的可靠性）？或者还有*什么*你会推荐的？
**编辑**：软技能方法“请不要使用它们，（通常）有更好的方法”在过去似乎效果不佳。因此，我真的更喜欢首先阻止此类查询的东西。不是故意破坏现有代码，而是为了未来的项目，一些“没有这样的查询”解决方案;-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T01:37:12.987

如果将 sql 移动到存储过程，则可以禁用应用程序用户的 SELECT、CREATE、ALTER、UPDATE、DELETE、DROP 等权限，只保留 EXEC 访问权限。这假设 SQL Server，但我确信 Oracle/MySQL 等允许类似的设置。

另请注意，这不能保证准备好的语句：您仍然可以以不安全的方式调用存储过程。但是如果你没有使用很多存储过程，它会找到任何编码不正确的地方，如果你遗漏了任何东西，那么sql注入攻击就很难成功。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T01:20:56.380

你可以在你的代码库中搜索常见的 T-SQL 结构，例如 SELECT、INSERT、UPDATE、DELETE 等。

如果您使用的是 Visual Studio 2008 Team System，则有一个内置的代码分析规则可以检查一些 SQL 问题。否则，有免费的[FxCop](http://www.microsoft.com/downloads/details.aspx?familyid=9AEAA970-F281-4FB0-ABA1-D59D7ED09772&displaylang=en)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T01:22:22.007

如果您已经在使用静态代码分析工具，则可以将其配置为查找某些方法的使用情况，例如在 Java 世界中`Connection.createStatement`而不是`Connection.prepareStatement`.

我认为更好的方法是让团队了解创建具有串联的动态 SQL 的不良影响。您必须将其添加到您的编码标准文档中！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T01:30:30.133

希望在您的软件中轻松找到所有非参数化查询。大多数数据库访问层（如 PHP 的 PDO 或 Perl 的 DBI）在准备查询时的调用与仅执行 SQL 时的调用不同。弄清楚这些调用是什么并搜索代码将为您提供一个良好的开端。如果您使用 Linux，grep 是您的朋友。

从那里修复它们将很容易（我希望）。我不知道项目的大小，但您可能应该将查询放在一个共同的地方，或者基于 Active Record / DataMapper / Table Row Gateway 等共同模式开发一些层。

我认为没有自动执行它的好方法。也许你只需要与你的同事心连心。内联 SQL 不好。故事结局。如果你是领导者，我认为授权将是有序的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-28T05:40:47.083

不要让您的应用程序将代码直接发送到数据库服务器，而是通过中间层发送。它可以轻松解析要发送到数据库的任何内容并对其施加一些约束。例如，强制所有 SQL 代码由**一个**且不超过一个语句组成，如果有多个语句，则要么拒绝它，要么只执行第一个语句。

基本的 SQL 注入攻击涉及如下代码：

```
DECLARE @SQL VARCHAR(4000), @Table VARCHAR(50) 
SET @Table='Employees' -- Imagine this actually comes as a parameter from app
SET @SQL='SELECT * FROM '+@Table
EXEC(@SQL) 
```

攻击者可以传递字符串“systables';UPDATE BankAccount SET Money=Money+10000 WHERE AccountCode=12345;DROP TABLE AuditTrails;” 到数据库 - 它会产生灾难性的影响。

通过让中间层对字符串进行最少的解析，您可以免受这种最简单的 SQL 注入攻击。对于其他人，您可以将它们添加到中间层（它还可以处理结果缓存、带宽限制等）

如果您*需要*从您的应用程序传递多个 SQL 语句，我会说您做错了，应该将该逻辑封装在存储过程中，或者至少在中间层本身。

# python - Python：有效地将大块字节连接成一个大块？

> ID：597289
> 
> 赞同：2
> 
> 时间：2009-02-28T01:18:53.733
> 
> 标签：python, amazon-s3

[我正在尝试对Amazon S3 python 库](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=134)进行陪审，以允许对大文件进行分块处理。现在它执行“self.body = http_response.read()”，因此如果您有一个 3G 文件，您将在对其进行任何控制之前将整个内容读入内存。

我目前的方法是尝试保持库的接口相同，但在读取每个数据块后提供回调。类似于以下内容：

```
data = []
while True:
    chunk = http_response.read(CHUNKSIZE)
    if not chunk:
        break
    if callback:
        callback(chunk)
    data.append(chunk) 
```

现在我需要做类似的事情：

```
self.body = ''.join(data) 
```

*加入*是正确的方法还是有另一种（更好的）方法将所有块放在一起？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T01:24:44.827

''join() 是连接数据块的最佳方法。替代方案归结为重复连接，这是 O(n**2) 由于字符串的不变性和需要在每次连接时创建更多。鉴于，如果与 += 一起使用，这种重复的连接会被最新版本的 CPython 优化为 O(n)，但这种优化只会给它一个粗略的等价于 ''.join() 反正，这明显是 O(n)字节数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T01:52:52.013

嗯 - 你想解决什么问题？我怀疑答案取决于您要对数据做什么。

由于通常您不希望将整个 3Gb 文件存储在内存中，因此我不会将块存储在数组中，而是遍历 http_response 并将其直接写入磁盘，使用普通 write() 在临时或持久文件中适当的文件句柄上的方法。

如果您确实想要内存中的数据的两个副本，那么您的方法将需要至少 6Gb 用于假设的 3Gb 文件，这对于大多数硬件来说可能很重要。我知道数组连接方法很快，但由于这是一个非常受内存限制的过程，也许你想找到一些更好的方法？StringIO ( [http://docs.python.org/library/stringio.html](http://docs.python.org/library/stringio.html) ) 创建可以附加到内存中的字符串对象；纯python，因为它必须使用不可变字符串，所以只在内部使用你的数组连接技巧，但基于c的cStringIO实际上可能会附加到内部的内存缓冲区。我手头没有它的源代码，所以需要检查一下。

如果您确实希望对数据进行某种分析并且确实希望以最小的开销保存在内存中，您可能需要考虑使用 Numeric/NumPy 中的一些字节数组对象作为 StringIO 的替代方案。它们是针对大型数组优化的高性能代码，可能是您需要的。

作为一个有用的示例，对于具有内存高效迭代器友好方法的通用文件处理对象，您可能需要查看 django 文件对象块处理代码： [http ://code.djangoproject.com/browser/django /trunk/django/core/files/base.py](http://code.djangoproject.com/browser/django/trunk/django/core/files/base.py)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T01:21:23.040

在 python3 中，`bytes`对象与 不同`str`，但我不知道为什么会有任何问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T01:24:43.890

`join`如果您确实需要将整个字符串放在一起似乎很好，但是无论如何您最终都会将整个字符串存储在 RAM 中。在这种情况下，我会尝试查看是否有办法处理字符串的每个部分，然后丢弃处理过的部分，因此您一次只需要在内存中保存固定数量的字节。这通常是回调方法的重点。（如果一次只能处理一部分块，请使用缓冲区作为队列来存储未处理的数据。）

# c++ - 函数指针到底指向哪里？

> ID：597292
> 
> 赞同：15
> 
> 时间：2009-02-28T01:19:58.707
> 
> 标签：c++, c, pointers, function-pointers

鉴于所有原始数据类型和对象都分配了内存，直观地很容易想象指向这些类型的指针。

但是函数指针到底指向哪里呢？鉴于指令被转换为机器代码并驻留在内存中，我们是否应该认为它们指向与函数指令的开头相对应的内存位置？

由于非法内存访问，我们面临许多指针错误。当函数指针指向数据存储器而不是指令存储器时是否会发生错误？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-28T01:23:13.863

函数指针也指向内存，唯一的区别是该内存位置有可执行代码而不是数据。

在许多平台上，如果您尝试执行数据（例如常规内存），您将崩溃或导致异常。这称为数据执行保护 - 一种安全措施，可防止应用程序无意中运行可能被恶意软件放置在那里的不可靠代码。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-03-07T16:24:59.300

函数指针包含函数的地址——无论这对给定系统意味着什么。您可以使用它来间接调用函数，您可以分配和比较函数指针值。您还可以将函数指针转换为另一种指向函数的指针类型，依此类推。

编译器实现函数指针最直接的方法是作为函数的内存地址，大多数编译器都是这样做的，但语言标准没有指定。一些系统（我认为 IBM 的 AS/400 就是一个例子）将附加信息存储在函数指针中。只要正确实现所需的语义，编译器就可以将函数指针作为整数索引实现到描述符表中。

无法取消引用函数指针。函数调用需要一个指针，而不是函数名，作为它的前缀表达式；如果您使用函数名称，则该名称将隐式转换为指针（就语言而言；生成的机器代码可能不同）。因此，程序没有可移植的方法来检测函数指针是否实际包含内存地址。

不可移植，给定一个函数`func`，您可以执行以下操作：

```
printf("Address of func is %p\n", (void*)func); 
```

你*可能会*看到一些看起来像人类可读的内存地址表示的东西。但严格来说，函数指针的转换行为`void*`不是由语言定义的，在某些系统上可能不起作用。

您*甚至*可以将函数指针转换为`unsigned char*`并检查函数的机器代码，但这远远超出了 C 标准定义的任何内容。

最好将函数指针视为以某种未指定方式引用特定函数的不透明值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-28T01:24:05.060

这是一个代码指针。它指向函数的地址。基本上和你描述的一样。是的，如果你的指针不指向你所期望的，你就会遇到问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-28T01:26:16.443

函数指针指向[函数](http://www.newty.de/fpt/intro.html)在内存中的地址。

根据通常分配函数指针的方式，如果您让它们指向数据位置，我会感到惊讶。它们通常不会被强制转换，因此不太可能指向除有效函数之外的任何地方。如果您要大量投放它们，那么这可能是个问题。更有可能的是，您传递给函数的数据是错误的。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-02-28T01:25:28.833

好吧，我不确定，但考虑到函数是指令（ADD，SUB，JMP）并且它们每个都有十六进制值，我相信你不会改变函数，而只会改变 JMP 指令（）......

# p2p - 多人游戏的完全/半自治 P2P 网络的可行性如何？

> ID：597303
> 
> 赞同：3
> 
> 时间：2009-02-28T01:24:44.700
> 
> 标签：p2p, bittorrent

我一直在考虑如何创建一个用于玩多人游戏的 P2P 系统（例如 BitTorrent 用于文件）。这个想法是从多人游戏架构中删除传统服务器。我知道启动通信和发送世界更新等可能需要某种服务器，但我对如何减少服务器上的负载和带宽压力很感兴趣。

顺便说一句，这适用于任何规模的游戏，从两人跳棋游戏到 30 多人的 FPS。

我疯了吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-28T02:08:36.577

最大的问题不是带宽或延迟或将更改分布到游戏状态。最大的问题是信任。

如果我告诉你我杀了一个怪物，你如何确认我真的做到了？你如何验证我实际上是 45 级？你如何确认我没有在世界各地传送？请记住，您无法检查服务器的每一个小细节：这就是我们试图避免的！

你需要玩家观察玩家，即使那样他们也可能会一起作弊。我真的怀疑有人会很快设计出值得信赖的 p2p MMO。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T01:54:15.473

我一直在考虑同样的事情。我长期以来一直认为分布式系统应该是*分布式*的，不需要中央控制器。MMO 或类似游戏的问题是每个玩家都应该能够看到相同的“世界”。你最终会遇到一个类似于爱因斯坦的相对论和“同时性”的问题——你离得越远，你对世界的看法就越不同。

一般来说，解决方案是您必须能够将信息传播到您附近的其他客户端——在游戏内空间，不一定是物理空间——足够快，以使所有本地玩家同时显示更新。

我怀疑答案是每个玩家都有一个“服务器”或世界模型，而不是将玩家表示为世界服务器中的向量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-19T11:47:40.840

在你的问题中有很多事情需要考虑：

1) 分布式大师 - 那么谁开始游戏呢？我在哪里可以找到第一个节点？如果每个人都决定同时关闭他们的 P2P 客户端怎么办？世界末日了吗？

2) 分布式规则——谁能确认 102235 中的 77 号玩家在 x,y,z 处杀死了一个怪物？在没有“总司令”的情况下，我看到黑客/作弊的大麻烦......

3) 延迟 - 客户端何时收到所有数据？如果互联网出现故障怎么办？或者在局域网游戏中，如果硬盘死了怎么办——这会让其他人疯狂吗？

我确实相信 P2P 的思想很有趣，但是就像在所有比赛中一样，我相信我们将需要一个能够处理规则的“裁判”，因为当你与“匿名者”比赛时，那么“可以作弊”a很多认为。

我认为某种网格计算可能是做到这一点的方法，但同样，如果网格中的一些掉出来或者渲染世界和发送结果太慢......那么我们整个游戏“滞后”...... . = 对每个人来说都是糟糕的游戏……这已经在许多带有主服务器的 FPS 游戏中看到了。如果网络协议不能很好地处理延迟，那么它会越来越难撞到一个正在跑步的人，或者他们会突然出现在向你开枪。

一个昂贵的解决方案可能是拥有“子服务器”（代理游戏服务器），您可以在其中拥有一些更接近玩家的数据。我相信这需要你访问世界各地的许多服务器群（就像暴雪对 WOW 所做的那样），或者你必须发明某种智能的“P2P 主机”，当带宽达到时，它会将自身升级为“子服务器”足够大，足够多的玩家接近它（总是从它的角度检查滞后......）......现在可以说这是可能的......如果这个子服务器和全球主要游戏循环之间的界限被打破怎么办再次？

大声笑......这可能会继续......这听起来越来越像互联网的一般问题:-)

快乐的编码......！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T01:32:58.597

我当然不是专家，但对我来说这听起来有点疯狂。根据我的经验，由于带宽和性能，您需要专用的游戏服务器。使用 P2P，您将失去这两样东西。在我看来，P2P 有一些好处。其中包括分发文件和研究。但是，这两件事不需要实时数据。如果你有某种大型多人游戏世界，那么你可能会使用 P2P 来分发游戏文件，甚至可以卸载数字运算。

我会说有一些可能性，但它们的数量似乎有限，尽管可能很强大。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-19T12:07:07.697

我认为这在理论上可能是可能的，但还有很长的路要走。

正如在其他帖子中所指出的，仅通过保证对附近的其他玩家进行更新，可以将延迟保持在较低水平。这在分布式游戏中已经做了很多年。

通过让多个节点负责每条数据，可以将数据丢失保持在可容忍的水平。

关于信任问题，有可能有一个协议，一个玩家可以“挑战”另一个玩家来揭露作弊行为。即挑战者将复制其他玩家计算的某些部分并要求比较结果。已经有加密协议可以做这种事情，但我不知道细节或者它们在实践中是否可行。

在我看来，真正的问题是几乎没有理由开发这样的系统。成本会很高并增加复杂性，但游戏体验（产品）不会显着改善。一项省钱的活动必须节省比成本更多的钱才能可行。

# c++ - 为什么这里的子进程不打印任何东西？

> ID：597311
> 
> 赞同：0
> 
> 时间：2009-02-28T01:29:57.997
> 
> 标签：c++, fork, parent-child

假设所有变量之前都已声明过......因为它们已经声明过。子进程不打印任何让我认为它没有被执行的东西。父进程运行良好，尽管它没有获得共享内存。我为这段代码的长度道歉......

```
// create 5 child process
for(int k=0;k<5;k++){

    // fork a child process
    pid = fork();

    // error occured on fork
    if (pid < 0) {
        fprintf(stderr, "Fork Failed");
        return 1;
    }
    // this is what the child process will run
    else if (pid == 0) {
        //create a shared mem segment
        segment_id = shmget(IPC_PRIVATE, size, S_IRUSR | S_IWUSR);

        //attach the shared memory segment
        shared_memory = (char *) shmat(segment_id, NULL, 0);

        printf("this is child");

        double x = 0;
        double sum = 0;

        // Run process that sums the function
        for(int i=0; i<n; i++){
            // get random number in range of x1-x2
            x = rand()%(x2 - x1 + 1) + x1;
            sum = sum + f(x);
        }

        //write output to the shared memory segment
        sprintf(shared_memory, "%f", sum);
        execlp("/bin/ls", "ls", NULL);

     }

    // this is what the parent process will run
    else {

       //print output from shared memory
        printf("\n*%s", shared_memory);

        //detach shared memory
        shmdt(shared_memory);

        //Here we add the shared memory to the array
        // To add together at the end
        // but since I cant get the memory to share
        // the array can't be implemented

        //remove the shared memory segment
        shmctl(segment_id, IPC_RMID, NULL);

        wait(NULL);
    }
} // End of for statement 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-28T01:35:22.163

C 标准输出流在内部缓冲数据。很可能您的“这是孩子”消息正在被缓冲，而缓冲区没有被 execlp 刷新，所以它就消失了。`fflush(stdout);`在 printf 之后尝试一个。顺便说一句，您也应该在 the 之前执行此操作`fork()`，这样子级和父级就不会都尝试写入从 fork 之前缓冲的输出。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-28T01:50:02.767

打印到 stderr 它没有被缓冲。

```
fprintf(stderr,"Plop\n"); 
```

共享内存的东西（segment_id，shared_memory）也没有在父级中初始化（或者如果是，那么它与子级不同）。

此外，当孩子仍在处理时，父母可能会破坏共享内存的东西。父母应该先等待，然后再处理孩子产生的数据。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-28T01:38:10.817

首先摆脱所有共享内存的东西，然后看看子进程是否可以成功地 printf 。

通过该片段的外观，您正在子进程中初始化 shared_memory ，而不是在父进程中。

# c - 相对路径（例如“../include/header.h”）对于标头有什么好处？

> ID：597318
> 
> 赞同：71
> 
> 时间：2009-02-28T01:36:01.243
> 
> 标签：c, include, header

我已经审查了[如何正确使用包含指令](https://stackoverflow.com/questions/464560/how-to-use-include-directive-correctly)和[C++ #include 语义](https://stackoverflow.com/questions/179213/c-include-semantics)的问题，但都没有解决这个问题——当我输入标题时，SO 建议的其他问题也没有......

如果有的话，写作的好处是什么：

```
#include "../include/someheader.h"
#include "../otherdir/another.h" 
```

与仅使用普通文件名相比：

```
#include "someheader.h"
#include "another.h" 
```

或者可能是没有“ `..`”的相对名称：

```
#include "include/someheader.h"
#include "otherdir/another.h" 
```

我看到的问题是：

*   您无法移动标题而不担心哪些源文件包含它。
*   您最终可能会在依赖项和错误报告中获得非常长的标题路径。我今天有一个“ `../dir1/include/../../include/../dir2/../include/header.h`”。

我能看到的唯一优点是，虽然您不需要移动文件，但您可能无需总是使用 ' `-I`' 指令来查找标题，但会失去灵活性，以及​​在 sub-sub 中编译的复杂性-目录等似乎超过了好处。

那么，我是否忽略了一个好处？

* * *

感谢您的投入。我认为共识是使用我忽略的“..”表示法没有任何重大好处。一般来说，我喜欢“somewhere/header.h”表示法；我确实在新项目中使用它。我正在研究的不是新的。

问题之一是存在各种标题集，通常带有前缀，例如`rspqr.h`, `rsabc.h`, `rsdef.h`, `rsxyz.h`。这些都与`rsmp`目录中的代码有关，但有些头文件在其中`rsmp`，有些在中心包含目录中，其中没有子目录等子目录`rsmp`。（并对代码的其他各个区域重复此操作；在多个位置有标头，其他代码位随机需要。）移动内容是一个主要问题，因为多年来代码变得如此复杂。`-I`并且生成文件在提供的选项方面并不一致。总而言之，这是一个几十年来不那么善意的忽视的悲惨故事。在不破坏任何东西的情况下修复这一切将是一项漫长而乏味的工作。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-28T01:42:23.753

我更喜欢路径语法，因为它非常清楚头文件属于哪个名称空间或模块。

```
#include "Physics/Solver.h" 
```

非常自我描述，不需要每个模块将其名称作为头文件的前缀。

不过，我几乎从不使用“..”语法，而是让我的项目包含指定正确的基本位置。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-02-28T03:17:37.503

问题`#include "../include/header.h"`在于它经常会意外工作，然后看似无关的更改会使其稍后停止工作。

例如，考虑以下源布局：

```
./include/header.h
./lib/library.c
./lib/feature/feature.c 
```

假设您正在运行编译器，其包含路径为`-I. -I./lib`. 发生什么了？

*   `./lib/library.c`可以做`#include "../include/header.h"`，这是有道理的。
*   `./lib/feature/feature.c`也可以`#include "../include/header.h"`，虽然没有意义。这是因为编译器将尝试`#include`相对于当前文件位置的指令，如果失败，它将尝试相对于路径`#include`中每个`-I`条目的指令。`#include`

此外，如果您稍后`-I./lib`从`#include`路径中删除，那么您会破坏`./lib/feature/feature.c`.

我发现以下内容更可取：

```
./projectname/include/header.h
./projectname/lib/library.c
./projectname/lib/feature/feature.c 
```

除了 , 我不会添加任何包含路径条目`-I.`，然后两者都`library.c`将`feature.c`使用`#include "projectname/include/header.h"`. 假设“projectname”可能是唯一的，这在大多数情况下不应导致名称冲突或歧义。如果绝对必要，您还可以使用包含路径和/或 make 的`VPATH`功能将项目的物理布局拆分到多个目录中（例如，以适应特定于平台的自动生成代码；当您使用 时，这确实会崩溃`#include "../../somefile.h"`）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2018-09-03T06:19:56.730

`#include ""`在以下情况下，以一个或多个 " " 序列开始指令路径`../`：

*   您想包含一个文件，其与包含文件的搭配是固定的，并且
*   您正在使用 POSIX 系统或 VC++ 构建，并且
*   您希望避免关于将包含哪个文件的歧义。

总是很容易提供一个示例，说明您的代码库在哪里包含错误，并且这随后会导致难以诊断的故障。但是，即使您的项目没有故障，如果您依赖绝对路径来指定相对于彼此定位的文件，它也可能被第三方滥用。

例如，考虑以下项目布局：

```
./your_lib/include/foo/header1.h
./your_lib/include/bar/header2.h
./their_lib/include/bar/header2.h 
```

*your_lib/include/foo/header1.h*应该如何包含*your_lib/include/bar/header2.h*？让我们考虑两个选项：

1.  `#include <bar/header2.h>`

    假设*your_lib/include*和*their_lib/include*都被引用为头文件搜索路径（例如使用 GCC`-I`或`-isystem`选项），那么选择哪个*header2.h*对搜索这两个路径的顺序很敏感。

2.  `#include "../bar/header2.h"`

    编译器将搜索的第一个位置是*your_lib/include/foo/header1.h*的位置，即*your_lib/include/foo/*。它将首先尝试*your_lib/include/foo/../bar/header2.h*，它会减少到*your_lib/include/bar/header2.h*，它会在其中找到正确的文件。根本不会使用标题搜索路径，并且几乎没有歧义的余地。

在这种情况下，出于给出的原因，我强烈推荐选项 2)。

针对其他答案中的一些论点：

*   @andrew-grant[说](https://stackoverflow.com/a/597329/671509)：

    > ...它非常清楚头文件属于哪个名称空间或模块。

    也许。但是相对路径可以解释为“在同一个模块中”。在不同模块中存在多个同名目录的情况下，它们提供了清晰性。

*   @bk1e[说](https://stackoverflow.com/a/597438/671509)：

    > ...它经常会意外工作...

    我认为相对路径只会在非常罕见的情况下偶然起作用，即项目从一开始就被破坏并且可以很容易地修复。经历这样的名称冲突而不导致编译器错误似乎不太可能。一种常见的情况是，依赖项目的文件包含您的一个标头，其中包含您的另一个标头。与该依赖项目隔离编译时，编译您的测试套件应导致“没有此类文件或目录”错误。

*   @singlenegationelimination[说](https://stackoverflow.com/a/597414/671509)

    > ...这不是便携式的，标准不支持它。

    ISO C 标准可能没有指定编译或运行程序的系统的所有细节。这并不意味着它们不受支持，只是标准没有过度指定 C 将运行的平台。（在常见的现代系统上如何解释`""`和解释之间的区别[可能起源](https://stackoverflow.com/a/11576616/671509)于 POSIX 标准。）`<>`

*   @daniel-paull[说](https://stackoverflow.com/a/597393/671509)

    > “..”假设相对位置并且很脆弱

    脆弱如何？想必对这两个文件的搭配很敏感。因此`..`，仅当包含文件的作者控制其位置时，才应（并且始终）使用“”。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-28T03:02:51.470

IANALL，但我认为您不应该将`..`'s 放在实际的 C 或 C++ 源文件中，因为这不是可移植的，并且标准不支持它。这类似于`\`在 Windows 上使用 's。仅当您的编译器无法使用任何其他方法时才这样做。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-28T02:42:34.030

将您的源代码树视为嵌套命名空间，包含路径允许您将目录拉入此命名空间的根目录。那么问题就是为您的代码库形成一个逻辑命名空间，而不管代码在磁盘上是如何组织的。

我会避免这样的路径：

*   `"include/foo/bar.h"`—“包含”似乎不合逻辑且多余
*   `"../foo/bar.h"`—“..”假定相对位置并且很脆弱
*   `"bar.h"`— 除非 bar.h 在当前目录中，否则这会污染全局命名空间并要求歧义。

就个人而言，我倾向于在我的项目中添加如下路径包括路径 - `"..;../..;../../..;../../../.."`。

这允许您对您的 s 应用一种隐藏规则，`#include`并允许在不破坏其他代码的情况下自由移动标题。当然，如果您不小心，这是以引入绑定到错误头文件的风险为代价的，因为非完全限定名称可能（或随着时间的推移变得）模棱两可。

我倾向于`#include`在公共标头中完全限定 s，因此任何使用我的代码的第三方都不需要将 s 添加`"..;../..;../../..;../../../.."`到他们的项目中——这只是为我的私有代码和构建系统提供便利。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-10-13T15:20:41.833

具有相对路径的 Windows 上的另一个问题是 MAX_PATH。这将在例如为 android 交叉编译并且您的路径长度超过 260 时触发编译问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-28T01:41:25.660

因为然后您将文件相对于项目的根目录放置，并且当您将其签入源代码控制并且另一个开发人员将其签出到其本地系统上的不同位置时，事情仍然有效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-05-19T21:10:56.157

为绝对（或“扩展相对”）抛出另一个论点包括路径`#include "./lib/subdir/~/subsubsubsubdir/header.h"`......当处理一个非常大的项目时，可能需要在链接行上有*很多选项。*`"-I./~"`在我当前的项目中，这些选项占用的字符数接近 40k，由于命令行限制而导致错误。

尽管通常我不喜欢这种包含路径风格的明显不灵活，但它可以帮助避免此类问题。例如，静态库可以通过其 API 提供`"#include "lib_api.h"`，所有其他组织都可以与该位置相关*并且*对用户不可见。

# php - Apache 不使用 mod_rewrite.c

> ID：597322
> 
> 赞同：4
> 
> 时间：2009-02-28T01:38:28.880
> 
> 标签：php, apache, debian

所以我只是用 debian、apache 等设置了一个 linode 服务器，现在我正在尝试让我正在开发的应用程序运行，但它需要`mod_rewrite.c`. 所以很自然地，我去了应用程序的目录（如果重要的话，恰好在 PHP 中）并在其中创建了一个 .htaccess ：

```
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php
</IfModule> 
```

所以他们我去了我的域，`example.com/hello`它给了我一个 404 错误，当它应该向我显示 index.php 加载的内容时。有什么理由`mod_rewrite.c`不工作吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-28T01:43:49.100

模块是否在 /etc/apache2/mods-enabled 中启用？

# objective-c - 在 Objective-C 类别中添加 func

> ID：597323
> 
> 赞同：1
> 
> 时间：2009-02-28T01:38:57.240
> 
> 标签：objective-c

我是一个客观的C新手。为什么调用我在类别中创建的函数时会收到警告？

```
#import <stdio.h>
#import <objc/Object.h>

@interface MyObj: NSObject
{
@public
    int  num;
}

-(void) print;
@end

@implementation MyObj;
-(void) print
{
    printf("%d\n", self->num);
}
@end

@implementation MyObj(more)
-(void) quack
{
    printf("Quack\n");
}
@end

int main (int argc, char *argv[])
{
    MyObj  *obj = [[MyObj alloc] init];
    obj->num = 9;
    [obj print];
    [obj quack]; //warning my not respond to quack 
    [obj release]; 
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T01:45:47.333

您需要为 MyObj(more) 声明接口，例如。

```
@interface MyObj(more)
-(void)quack;
@end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T01:56:00.757

只是想指出几件事，因为您提到您是 Obj-C 的新手。

在方法内部，您不需要参考`self->`获取实例变量，因此您的`print`方法可以是：

```
-(void) print
{
    printf("%d\n", num);
} 
```

另请注意，您通常从不直接访问对象方法之外的实例变量（即，您不会这样做`obj->num`——实际上您不经常`->`在 Obj-C 代码中看到运算符）。相反，您应该为属性指定访问器（假设这是 Objective-C 2.0）：

```
// In the interface:
@property (assign) int num;

// In the implementation:
@synthesize num;

// In main:
obj.num = 9; 
```

# ruby-on-rails - 如何验证 Rails 中的日期？

> ID：597328
> 
> 赞同：95
> 
> 时间：2009-02-28T01:42:01.727
> 
> 标签：ruby-on-rails, ruby, validation, date

我想在 Ruby on Rails 中验证我的模型中的日期，但是，当日、月和年值到达我的模型时，它们已经转换为不正确的日期。

例如，如果我在视图中输入 2009 年 2 月 31 日，当我`Model.new(params[:model])`在控制器中使用时，它会将其转换为“2009 年 3 月 3 日”，然后我的模型将其视为有效日期，但它是不正确的。

我希望能够在我的模型中进行此验证。有什么办法可以吗，还是我完全错了？

我发现这个“[日期验证](http://www.ruby-forum.com/topic/53191)”讨论了这个问题，但它从未得到解决。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-02-28T09:14:16.507

我猜您正在使用`date_select`帮助程序生成日期标签。另一种方法是对日、月、年字段使用选择表单助手。像这样（我使用的示例是 created_at 日期字段）：

```
<%= f.select :month, (1..12).to_a, selected: @user.created_at.month %>
<%= f.select :day, (1..31).to_a, selected: @user.created_at.day %>
<%= f.select :year, ((Time.now.year - 20)..Time.now.year).to_a, selected: @user.created_at.year %> 
```

在模型中，您验证日期：

```
attr_accessor :month, :day, :year
validate :validate_created_at

private

def convert_created_at
  begin
    self.created_at = Date.civil(self.year.to_i, self.month.to_i, self.day.to_i)
  rescue ArgumentError
    false
  end
end

def validate_created_at
  errors.add("Created at date", "is invalid.") unless convert_created_at
end 
```

如果您正在寻找插件解决方案，我会检查[validates_timeliness](http://github.com/adzap/validates_timeliness/)插件。它的工作原理是这样的（来自 github 页面）：

```
class Person < ActiveRecord::Base
  validates_date :date_of_birth, on_or_before: lambda { Date.current }
  # or
  validates :date_of_birth, timeliness: { on_or_before: lambda { Date.current }, type: :date }
end 
```

可用的验证方法列表如下：

```
validates_date     - validate value as date
validates_time     - validate value as time only i.e. '12:20pm'
validates_datetime - validate value as a full date and time
validates          - use the :timeliness key and set the type in the hash. 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2010-03-11T15:02:16.807

使用慢性宝石：

```
class MyModel < ActiveRecord::Base
  validate :valid_date?

  def valid_date?
    unless Chronic.parse(from_date)
      errors.add(:from_date, "is missing or invalid")
    end
  end

end 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-08-24T09:35:37.120

如果你想兼容 Rails 3 或 Ruby 1.9，试试[date_validator](http://rubygems.org/gems/date_validator) gem。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-02-09T05:51:18.720

Active Record`_before_type_cast`在类型转换之前为您提供包含原始属性数据的属性。这对于返回带有预类型转换值的错误消息或仅进行类型转换后不可能的验证很有用。

我会回避 Daniel Von Fange 关于覆盖访问器的建议，因为在访问器中进行验证会稍微改变访问器合同。Active Record 有一个专门针对这种情况的特性。用它。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2016-11-30T01:09:49.403

这里有点晚了，但感谢“[如何在 Rails 中验证日期？](https://stackoverflow.com/questions/597328/how-do-i-validate-a-date-in-rails/4941755#4941755) ”我设法编写了这个验证器，希望对某人有用：

在你的里面`model.rb`

```
validate :date_field_must_be_a_date_or_blank

# If your field is called :date_field, use :date_field_before_type_cast
def date_field_must_be_a_date_or_blank
  date_field_before_type_cast.to_date
rescue ArgumentError
  errors.add(:birthday, :invalid)
end 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-28T02:10:44.107

由于您需要在将日期字符串转换为模型中的日期之前对其进行处理，因此我将覆盖该字段的访问器

假设您的日期字段是`published_date`. 将此添加到您的模型对象：

```
def published_date=(value)
    # do sanity checking here
    # then hand it back to rails to convert and store
    self.write_attribute(:published_date, value) 
end 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-04-03T18:41:38.790

这是一个非慢性的答案..

```
class Pimping < ActiveRecord::Base

validate :valid_date?

def valid_date?
  if scheduled_on.present?
    unless scheduled_on.is_a?(Time)
      errors.add(:scheduled_on, "Is an invalid date.")
    end
  end
end 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-04-28T23:56:12.870

您可以像这样验证日期和时间（如果您使用自定义选择，则在控制器中某个可以访问参数的方法中）...

```
# Set parameters
year = params[:date][:year].to_i
month = params[:date][:month].to_i
mday = params[:date][:mday].to_i
hour = params[:date][:hour].to_i
minute = params[:date][:minute].to_i

# Validate date, time and hour
valid_date    = Date.valid_date? year, month, mday
valid_hour    = (0..23).to_a.include? hour
valid_minute  = (0..59).to_a.include? minute
valid_time    = valid_hour && valid_minute

# Check if parameters are valid and generate appropriate date
if valid_date && valid_time
  second = 0
  offset = '0'
  DateTime.civil(year, month, mday, hour, minute, second, offset)
else
  # Some fallback if you want like ...
  DateTime.current.utc
end 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-17T13:20:15.797

我推荐这种方法

```
 validate :birthday_must_be_a_date

  def birthday_must_be_a_date
    birthday&.to_date || errors.add(:birthday, :blank)
  rescue Date::Error
    errors.add(:birthday, :invalid)
  end 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-02-28T03:30:48.063

你试过[`validates_date_time`](https://github.com/nickstenning/validates_date_time)插件吗？

# c# - 在 Python、.Net 或命令行中将 FOSS HTML 转换为 PDF？

> ID：597348
> 
> 赞同：0
> 
> 时间：2009-02-28T01:56:26.917
> 
> 标签：c#, .net, python, html-to-pdf

我尽可能多地使用谷歌，多次检查 stackoverflow，但我找不到可以处理 css的好的**html 到 pdf 转换器。**是否有免费和开源的解决方案（即使用于商业用途）？有很多解决方案，价格范围很广，但我一直在寻找开源和免费的东西。我已经尝试过 PISA for Python，它运行良好，但不是免费用于商业用途。.Net 有什么用吗？我没有成功使用 iTextSharp。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T02:01:12.397

我在几个项目中使用了 wkhtmltopdf。[http://code.google.com/p/wkhtmltopdf/](http://code.google.com/p/wkhtmltopdf/)。它使用支持 Safari 浏览器的 webkit 渲染引擎。您将获得完全最新的渲染，就像使用 CSS 和所有内容的 Web 浏览器一样。

哦，它是开源的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T02:05:04.107

我还没有找到好的 FOSS 解决方案，但我可以说[PrinceXML](http://www.princexml.com/)工作得很好，通过命令行提供了相当多的功能，而且价格非常合理。IIRC，免费版本会在您生成的每个 PDF 中附加一个封面，这对您来说可能会或可能不会成为交易杀手，但您绝对应该检查一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T02:12:59.593

您询问 C#/.NET 的事实让我猜您是在 Windows 平台上，所以这可能不适合您，但我使用[**html2ps**](http://user.it.uu.se/~jan/html2ps.html)和[**ps2pdf**](http://pages.cs.wisc.edu/~ghost/doc/AFPL/6.50/Ps2pdf.htm)取得了不错的成功：

```
#! /bin/sh

TEMPDIR="/tmp"
html2ps -u $1 > $TEMPDIR'temp.ps'
ps2pdf $TEMPDIR'temp.ps' $2 
```

这确实可以处理 CSS（至少到目前为止我所使用的所有 CSS），但如果我没记错的话，关于一些内联样式会有一些限制。

**注意**：我认为这些都可以通过 Cygwin 在 Windows 上使用，如果这对您来说是一个可以接受的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T10:32:41.810

您还可以尝试不同的方法，例如使用虚拟打印机。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-07T04:24:09.267

我使用此处找到的“PISA”xhtml2pdf 工具取得了惊人的成功：[http ://www.xhtml2pdf.com/](http://www.xhtml2pdf.com/)

不要被“xhtml”部分吓到，它接受大范围的 html 输入，并根据 CSS 生成 PDF，包括 CSS 打印扩展。

# c# - 在 Windows Mobile 上的 DataGrid 中更改单元格的字体

> ID：597350
> 
> 赞同：0
> 
> 时间：2009-02-28T01:58:17.617
> 
> 标签：c#, windows-mobile, datagrid, compact-framework

我正在使用 VS 2005 在 C# 中创建一个 Windows Mobile 程序。我需要在网格中显示数据。我可以为 Windows Mobile 找到的唯一网格控件是 DataGrid，因此我在表单上放置了一个。我现在需要更改某些列的宽度以及某些单元格的字体和颜色。我该怎么做呢？

还有用于 Windows Mobile 的更好的控件吗？

谢谢约翰。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T03:13:32.070

我不确定您是否可以更改单个列或单元格的字体。网格有一个属性，可让您设置字体和大小。为了设置列的宽度，我使用了这个方法（它将表格样式添加到网格中）：

```
private void SetColumnWidth(int columnID, int width)
{
    // add table style if first call
    if (this.dataGrid1.TableStyles.Count == 0)
    {
        // Set the DataGridTableStyle.MappingName property
        // to the table in the data source to map to.
        dataGridColumnTableStyle.MappingName = "<name of your table in the DS here>";

        // Add it to the datagrid's TableStyles collection
        this.dataGrid1.TableStyles.Add(dataGridColumnTableStyle);
    }

    // set width
    this.dataGrid1.TableStyles[0].GridColumnStyles[columnID].Width = width;
} 
```

当您想要隐藏绑定 DataTable 中的列但不想显示（然后设置宽度 = 0）时，此方法也很有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T14:13:45.710

您必须进行自定义绘画。CF 团队[在博客上写了如何做到这一点](http://blogs.msdn.com/netcfteam/archive/2006/04/25/583542.aspx)。

# coding-style - 这是一个泄漏的抽象吗？

> ID：597353
> 
> 赞同：0
> 
> 时间：2009-02-28T02:00:14.320
> 
> 标签：coding-style

在中间层上指定一个字段名称是一个泄漏的抽象吗？

我觉得只为每个字段创建一个单独的函数太麻烦了，即使它是代码生成的。

```
 public bool Assortment_IsValueExistingOnOtherRecord(
            Dictionary<string, object> exceptPkColumns,
            string field, object value
            )
        {
            var c = Connect();

            var dt = new DataTable();

            string sanitizedField = field.Replace("'","");

            var daAssortment = new SqlDataAdapter(
               string.Format(
@"SELECT 1 FROM assortment
WHERE 
/* do I violate any good programming practice here? */ [{0}] = @value 
AND NOT (assortment_id = @assortment_id)",  field), c);

            daAssortment.SelectCommand.Parameters.Add("assortment_id", exceptPkColumns["assortment_id"]);
            daAssortment.SelectCommand.Parameters.Add("value", value);
            daAssortment.Fill(dt);

            return dt.Rows.Count == 1;
        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T02:17:25.730

```
[{0}] = @value 
```

只要采取适当的措施，这很好。“消毒”不在这些措施之列。

选项 1：您是否对该领域的提供者有一种隐含的信任，以至于您知道他们永远不会惹您生气？例如，如果您（作为本模块的作者）是该领域的提供者，您可以相信自己。

选项2：您可以进行将请求字段映射到字符串的枚举/查找吗？那么这个代码的“客户端”只能请求枚举中的东西，而你（这个模块的作者）通过将他们请求的枚举值映射到一个已知的字符串来成为字段提供者。

选项3：如果字段随时间变化并且您不想使用枚举锁定，您可以将字符串值发送到数据库中进行确认吗？

```
SELECT name
FROM syscolumns
WHERE name = @name 
```

这会将提供的名称映射到来自数据库且必须安全的已知字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T02:40:29.480

从封装的角度来看，你写的没有错。

但是，正如“David B”所暗示的（他对此有点模糊），您需要注意一些安全问题。

您正在生成的动态 SQL 受到称为“SQL 注入攻击”的影响。例如，想象一下 field 的值是以下字符串：

```
assortment_id] = 0 and assortment_id = 1 
delete from assortment
select 1 from assortment where [assortment_id 
```

这将导致数据库执行 3 个查询：

1.  没有返回任何结果的虚拟选择查询
2.  删除分类表中所有内容的删除查询
3.  真正的选择查询

显然，这可能会导致一些问题。

如果“字段”的值曾经通过以下方式指定：

1.  用户界面字段
2.  网页表单提交
3.  从 Web 服务客户端
4.  从磁盘上的文件加载
5.  或者以您在代码中提供的常量值以外的任何方式

然后，您需要在运行任何查询之前验证数据以确保它是有效的字段值。否则你很容易受到攻击。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T03:15:33.170

使用表达式，您将获得编译时（和 Sql 运行时）的安全性：

```
public bool Assortment_IsValueExistingOnOtherRecord<TValue>(
        Dictionary<string, object> exceptPks,
        Expression<Func<Assortment, TValue>> expression,
        TValue value
        )

    propExp = expression.Body as MemberExpression;
    if (propExp == null) throw new ArgumentException();
    string field = propExp.Member.Name; 

    /* blah, blah */
}

/* Calling code */
bool exists = Assortment_IsValueExistingOnOtherRecord(
                exceptPKs, 
                (a => a.Property1),
                "property1Value"
              ); 
```

使用通用 TValue，您还可以获得与该属性匹配的强类型值 - 避免您的 RDBMS 为您执行的偶尔的脑死亡。

您可以拥有整个 equals 表达式，甚至添加对 < 和 > 的支持 - 但是，您只是将 LINQ 发明为本土 ORM。;)

顺便说一句，exceptPKs 似乎有点奇怪......但也许它在上下文中有意义？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T03:23:03.747

是的。所有抽象都泄漏。

现在，至于安全，如果您不明确相信所有调用者不会搞砸（或试图主动攻击您），您最好拥有所有可能字段的 emum，并根据该列表验证传入参数。

# c# - 将大型 vb6 应用程序移动到 web 或 winforms。你决定！

> ID：597354
> 
> 赞同：2
> 
> 时间：2009-02-28T02:01:06.907
> 
> 标签：c#, asp.net, winforms, desktop-application, vb6-migration

我正在将大型 vb6 应用程序移植到 .NET。当前应用程序是与一组本地访问数据库通信的桌面应用程序。应用程序中有大约 200 个表格和大约 100 个表格。屏幕大多是复杂的。大多数显示主从关系、嵌入式电子表格中的大量行和动态生成的编辑控件。

他们会将其移植到 .NET。我不确定他们是否会想要它基于 Web 或 winforms。对我来说，该应用程序似乎更适合 winforms。值得庆幸的是，无论选择如何，访问数据库都将替换为 sql server。

我使用winforms的原因：

*   更丰富的用户界面。
*   客户端缓存
*   更快的发展。尽管 ASP.NET 比经典 ASP 的生产力高出数光年，但 Winforms 对我来说还是很有效率的。我还是宁愿在winforms中工作。
*   可以显示更多数据并花费更少的时间来管理状态。

我计划将业务/数据层分解为一个单独的库。库中的业务对象将能够被 winforms 或 Web 应用程序使用。

我在想，如果我们先移植到 winforms 并且将 UI 和业务逻辑完全分离，我将能够在以后的 Web 版本中重用业务逻辑。鉴于业务/数据层位于一个单独的库中，没有 UI 依赖项。

最后，这不是我的决定，但我想听听您将大型 Windows 应用程序迁移到 asp.net 的经验。

将大型桌面应用程序迁移到 asp.net 是什么体验？你会如何处理这样的项目？您愿意将此应用程序移植到 winforms 或 asp.net 吗？为什么？

谢谢！史蒂夫

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T02:26:25.863

移植到新的 ASP.Net Web 应用程序的一个主要优点是您将有更多的机会来清理它。

当迁移到 winforms 时，会有很大的诱惑和压力，只需要“逐屏移植”，而如果你使用 web，你将有机会在更基础的层面上进行重构和改进。

我的公司目前正在将一个相当大的旧版 VB6/Access 应用程序移植到 ASP.Net，并且通过 AJAX（现在是 Silverlight），现在可以在 Web 上的 UI 中获得非常高水平的视觉质量和复杂性。从用户访问和部署的角度来看，也有明显的优势。

至于如何处理该项目，我使用迭代方法取得了成功——构建一个薄片（实现单个功能）来证明架构，然后根据优先级和复杂性添加功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T02:30:25.837

我建议您分阶段进行移植，以使过渡更容易。第一阶段是从 VB6 桌面移植到 .NET 桌面（win 形式）。

然后在第二阶段，如果仍然需要，您将全部或部分 .NET 桌面移动到 ASP.NET GUI。

无论 GUI 选择如何，从 VB6 到 .NET 的步骤本身对于团队来说都是相当大的。分阶段的方法将允许您的团队以更类似于当前应用程序的应用程序样式来掌握 .NET。

因此，您将业务逻辑分离为可重用库的目标对于这种分阶段的工作方法很重要。如果您采用这种方法，则您对所使用的 GUI 类型（或类型）具有更大的灵活性。

例如，您可以在 ASP.NET 网站中提供所有更简单的屏幕，并使用包含更复杂屏幕的辅助 WindowsForms 应用程序，用户可以根据需要下载这些屏幕。重要的是，它们都将使用相同的业务逻辑库，它们大多只是同一个应用程序的不同接口。

ASP.NET（或一般的 Web 开发）在处理状态、跨浏览器、html/css 等时需要完全不同的开发人员思维方式。

我最近致力于将大型 Delphi 桌面应用程序移植/迁移到 .NET。目标是使用 ASP.NET，但是这完全失败了，因为现有团队的 Web 开发经验有限，并试图使用 ASP.NET 重新实现桌面应用程序。我想说，与在 Windows 窗体中重新创建屏幕相比，这是一个更大的风险，至少最终结果将是可用的并为最终用户提供一些价值。

虽然 Ajax 和 jQuery 对丰富的 Web GUI 做出了很大的改进，但听起来您现有的应用程序有一些领域，例如数据的电子表格表示，在桌面应用程序中更容易有效地实现。

总而言之，“理想”是将业务逻辑和规则移至 .NET，以便您以后可以简单地“插入”用户界面。这可能说起来容易做起来难，但这是我通常的目标。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T03:31:13.447

我只能说你不应该**重新**开始！在其中一个 StackOverflow 播客中，主题是您是否应该重写应用程序以获得新语言的好处，答案是否定的！Joel Spolsky 给出的例子是 Borland C++ Builder。他们输给了 Microsoft VC++，因为他们从头开始。然后 Jeff Atwood 继续说，尽管 WordPress 是用 PHP 编写的（我认为这不是一种好语言），但总体思路还是成功了。

**要点：**
不要重新开始，因为你失去了在坚实基础上获得的所有经验。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T05:21:04.697

首先，**Winforms 已经死了**。WPF 已经问世将近两年了，为什么有人会用 WinForms 开始一个新的桌面程序，这让我无法理解。为什么要将您的客户从一种非常非常过时的技术 (VB6) 转移到另一种很快就会过时的技术？请不要误会，但除非您必须支持比 XP 更早的 Windows 版本，否则我认为在 2009 年启动 WinForms 项目实际上是不负责任的。以下是与 WPF 相比的缺点：

1.  XAML、WPF 和 Silverlight 是微软的重点。
2.  WPF 在图形方面比 Winforms 强大得多（至少就开发非常丰富的 UI 而言）。
3.  WPF 中的数据绑定是 Winforms 的一大飞跃；它会节省你的时间。
4.  WPF 是稳定的，并且在过去的几个 SP 和版本中已经看到显着的性能提升。
5.  像所有旧的 MS 技术一样，Winforms 迟早会消亡。这显然是现在的旧技术。

现在为 ASP.Net。这听起来像您正在转换的是一个相当简单的内部应用程序。ASP.Net 就是适合这样的事情。虽然 ASP.Net MVC 几乎已完成测试，但它还没有 WPF 反对 WinForms 的反对 ASP.Net 的论据。我们在工作中使用 ASP.Net + jQuery，效果很好。我们也在做 Silverlight，你可以看看。我真的很喜欢在里面工作。如果这是一个内部应用程序，您可能可以指望安装在所有浏览器上的 Silverlight 插件。

现在对于去**WPF vs ASP.Net**的一般优点：

**WPF**

1.  更容易将代码从 VB6 桌面迁移到另一个桌面环境。尽管需要将其转换为 VB.Net 或 C#，但您可能可以节省大量逻辑。您正在从一个有状态的环境转到另一个。ASP.Net 并非如此。
2.  更容易测试（特别是如果您必须支持多个浏览器）。
3.  开发速度可能更快（特别是如果您必须支持多个浏览器）。

**ASP.NET**

1.  比桌面应用程序更容易分发更新（您所做的就是更新您的网络服务器）。
2.  如果创作正确，可以在各种台式机甚至移动设备上使用。
3.  可以通过额外的开发工作来提供桌面应用程序的大部分动态特性。
4.  可用于可能面向公众的未来产品。

祝你的项目好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-28T09:29:38.017

如果您真的想发疯，并且不介意使用最新技术，请查看 ASP.NET 和 Silverlight 3。查看[Mix 09](http://www.visitmix.com)的视频，有一些很好的例子可以解决这个问题。

此外，Silverlight 应用程序可以在浏览器之外运行，因此能够提供桌面体验，但具有在您更新代码等时更新的优点。而且我个人认为 Windows 类型的应用程序（包括 Silverlight）是比基于 Web 的应用程序更适合数据输入（尽管使用 Ajax 确实有帮助）

# python - 如何使用 Python 和 pygame 创建 MS Paint 克隆

> ID：597369
> 
> 赞同：15
> 
> 时间：2009-02-28T02:13:08.673
> 
> 标签：python, mouse, pygame, draw, paint

如我所见，有两种方法可以处理鼠标事件来绘制图片。

第一个是检测鼠标何时移动并画一条线到鼠标所在的位置，如图[所示](http://www.cs.iupui.edu/~aharris/pygame/ch05/paint.py)。但是，这样做的问题是，对于较大的画笔大小，每条不直的“线”之间会出现许多间隙，因为它使用线条的笔触大小来创建粗线。

另一种方法是在鼠标移动时绘制圆圈，如图[所示](http://www.ida.liu.se/~ETE257/timetable/LecturePythonPygame2.html)。这样做的问题是，如果鼠标移动的速度快于计算机检测到鼠标输入的速度，每个圆圈之间就会出现间隙。

这是我的两个问题的屏幕截图：

![http://imgur.com/32DXN.jpg](https://i.stack.imgur.com/7ILzZ.png)

实现像 MS Paint 这样的画笔的最佳方法是什么，画笔大小相当大，线条的笔划没有间隙或每个圆圈之间没有间隙？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-28T02:50:16.167

为什么不两者都做？

在每个端点处画一个圆圈，并在两者之间画一条线。

**编辑**rof，只是无法阻止自己。

实际上，您不想使用`pygame.draw.line`，因为它会作弊。它填充 1 像素宽的行或列（取决于攻角）像素。如果您确实以大致垂直的角度，0 度或 90 度，这不是问题，但在 45 度时，您会注意到一种*串豆*效应。

唯一的解决方案是在每个像素的距离处画一个圆圈。这里...

```
import pygame, random

screen = pygame.display.set_mode((800,600))

draw_on = False
last_pos = (0, 0)
color = (255, 128, 0)
radius = 10

def roundline(srf, color, start, end, radius=1):
    dx = end[0]-start[0]
    dy = end[1]-start[1]
    distance = max(abs(dx), abs(dy))
    for i in range(distance):
        x = int( start[0]+float(i)/distance*dx)
        y = int( start[1]+float(i)/distance*dy)
        pygame.draw.circle(srf, color, (x, y), radius)

try:
    while True:
        e = pygame.event.wait()
        if e.type == pygame.QUIT:
            raise StopIteration
        if e.type == pygame.MOUSEBUTTONDOWN:
            color = (random.randrange(256), random.randrange(256), random.randrange(256))
            pygame.draw.circle(screen, color, e.pos, radius)
            draw_on = True
        if e.type == pygame.MOUSEBUTTONUP:
            draw_on = False
        if e.type == pygame.MOUSEMOTION:
            if draw_on:
                pygame.draw.circle(screen, color, e.pos, radius)
                roundline(screen, color, e.pos, last_pos,  radius)
            last_pos = e.pos
        pygame.display.flip()

except StopIteration:
    pass

pygame.quit() 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-05T16:04:42.680

在每个循环步骤中不进行 blitting 可以提高绘图速度（使用从前一个改编的代码可以消除我机器上的滞后问题）

```
import pygame, random

screen = pygame.display.set_mode((800,600))

draw_on = False
last_pos = (0, 0)
color = (255, 128, 0)
radius = 10

def roundline(srf, color, start, end, radius=1):
    dx = end[0]-start[0]
    dy = end[1]-start[1]
    distance = max(abs(dx), abs(dy))
    for i in range(distance):
        x = int( start[0]+float(i)/distance*dx)
        y = int( start[1]+float(i)/distance*dy)
        pygame.display.update(pygame.draw.circle(srf, color, (x, y), radius))

try:
    while True:
        e = pygame.event.wait()
        if e.type == pygame.QUIT:
            raise StopIteration
        if e.type == pygame.MOUSEBUTTONDOWN:
            color = (random.randrange(256), random.randrange(256), random.randrange(256))
            pygame.draw.circle(screen, color, e.pos, radius)
            draw_on = True
        if e.type == pygame.MOUSEBUTTONUP:
            draw_on = False
        if e.type == pygame.MOUSEMOTION:
            if draw_on:
                pygame.display.update(pygame.draw.circle(screen, color, e.pos, radius))
                roundline(screen, color, e.pos, last_pos,  radius)
            last_pos = e.pos
        #pygame.display.flip()

except StopIteration:
    pass

pygame.quit() 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-04-16T23:31:12.337

对于第一个问题，您需要有一个背景，即使它只是一种颜色。我制作的复制乒乓球游戏也遇到了同样的问题。下面是我做的一个复制画图程序的例子，左键绘制，右键擦除，点击彩色图像选择颜色，向上键清屏：

```
import os
os.environ['SDL_VIDEO_CENTERED'] = '1'
from pygamehelper import *
from pygame import *
from pygame.locals import *
from vec2d import *
from math import e, pi, cos, sin, sqrt
from random import uniform

class Starter(PygameHelper):
    def __init__(self):
        self.w, self.h = 800, 600
        PygameHelper.__init__(self, size=(self.w, self.h), fill=((255,255,255)))

        self.img= pygame.image.load("colors.png")
        self.screen.blit(self.img, (0,0))

        self.drawcolor= (0,0,0)
        self.x= 0

    def update(self):
        pass

    def keyUp(self, key):
        if key==K_UP:
            self.screen.fill((255,255,255))
            self.screen.blit(self.img, (0,0))

    def mouseUp(self, button, pos):
        pass

    def mouseMotion(self, buttons, pos, rel):
        if pos[1]>=172: 
            if buttons[0]==1:
                #pygame.draw.circle(self.screen, (0,0,0), pos, 5)
                pygame.draw.line(self.screen, self.drawcolor, pos, (pos[0]-rel[0], pos[1]-rel[1]),5)                
            if buttons[2]==1:
                pygame.draw.circle(self.screen, (255,255,255), pos, 30)
            if buttons[1]==1:
                #RAINBOW MODE
                color= self.screen.get_at((self.x, 0))
                pygame.draw.line(self.screen, color, pos, (pos[0]-rel[0], pos[1]-rel[1]), 5)

                self.x+= 1
                if self.x>172: self.x=0

        else:
            if pos[0]<172:
                if buttons[0]==1:
                    self.drawcolor= self.screen.get_at(pos)
                    pygame.draw.circle(self.screen, self.drawcolor, (250, 100), 30)

    def draw(self):
        pass
        #self.screen.fill((255,255,255))
        #pygame.draw.circle(self.screen, (0,0,0), (50,100), 20)

s = Starter()
s.mainLoop(40) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-04-27T18:34:56.627

[这是 Matthew示例](https://stackoverflow.com/a/5690387/6220679)的简化版本，遗憾的是它无法运行。

当鼠标移动时，`pygame.MOUSEMOTION`事件被添加到包含位置和相对移动的事件队列中。您可以使用这些来计算先前的位置，然后将两个点传递给`pygame.draw.line`。

`pygame.MOUSEMOTION`事件还有一个`buttons` 属性，您可以使用它来检查当前按下的鼠标按钮。

```
import os
import random

import pygame as pg

class App:

    def __init__(self):
        os.environ['SDL_VIDEO_CENTERED'] = '1'
        pg.init()
        self.w, self.h = 800, 600
        self.screen = pg.display.set_mode((self.w, self.h))
        self.screen.fill(pg.Color('white'))
        self.clock = pg.time.Clock()
        self.drawcolor = (0, 0, 0)

    def mainloop(self):
        while True:
            for event in pg.event.get():
                if event.type == pg.QUIT:
                    return
                elif event.type == pg.MOUSEBUTTONDOWN:
                    if event.button == 2:  # Color picker (middle mouse button).
                        self.drawcolor = self.screen.get_at(pos)
                        # Pick a random color.
                        # self.drawcolor = [random.randrange(256) for _ in range(3)]
                elif event.type == pg.MOUSEMOTION:
                    pos, rel = event.pos, event.rel
                    if event.buttons[0]:  # If the left mouse button is down.
                        # Draw a line from the pos to the previous pos.
                        pg.draw.line(self.screen, self.drawcolor, pos, (pos[0]-rel[0], pos[1]-rel[1]), 5)
                    elif event.buttons[2]:  # If the right mouse button is down.
                        # Erase by drawing a circle.
                        pg.draw.circle(self.screen, (255, 255, 255), pos, 30)

            pg.display.flip()
            self.clock.tick(30)

if __name__ == '__main__':
    app = App()
    app.mainloop()
    pg.quit() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-02-27T23:47:41.137

我制作了一个更有效的圆形功能版本。

```
import pygame as pg,random,math

screen = pg.display.set_mode((800,600))

draw_on = False
last_pos = (0, 0)
color = (255, 128, 0)
radius = 10

def roundline(srf, color, start, end, radius=1):
    pg.display.update([drawline(srf,color,start,end,radius),
                       pg.draw.circle(srf, color, end, radius),
                       pg.draw.circle(srf, color, start, radius)])

def drawline(srf, color,start,end,width):
    v=(start[0]- end[0],start[1]- end[1])
    betrag=width/math.sqrt(v[0]*v[0]+v[1]*v[1])
    v_=(v[1]*betrag,-betrag*v[0])
    return pg.draw.polygon(srf, color,(
            (int(start[0]+v_[0]),int(start[1]+v_[1])),
            (int(start[0]-v_[0]),int(start[1]-v_[1])),
            (int(end[0]-v_[0]),int(end[1]-v_[1])),
            (int(end[0]+v_[0]),int(end[1]+v_[1]))
            ))

try:
    while True:
        e = pg.event.wait()
        if e.type == pg.QUIT:
            raise StopIteration
        elif e.type == pg.MOUSEBUTTONDOWN:
            color = (random.randrange(256), random.randrange(256), random.randrange(256))
            #pg.draw.circle(screen, color, e.pos, radius)
            draw_on = True
            start=e.pos
        elif e.type == pg.MOUSEBUTTONUP:
            draw_on = False
        elif e.type == pg.MOUSEMOTION:
            if draw_on:
                roundline(screen, color, e.pos, last_pos,  radius)
            last_pos = e.pos
        elif e.type == pg.MOUSEWHEEL:
            radius=max(1,radius+e.y)
finally:
    pg.quit() 
```

# google-api - 有人使用 Google Adwords API 吗？

> ID：597371
> 
> 赞同：1
> 
> 时间：2009-02-28T02:16:12.627
> 
> 标签：google-api, google-ads-api

我使用 Google Adwords API 已经有一段时间了，我开始怀疑我做了一个假设。

有谁知道“GetKeywordVariations”是否按相关顺序返回关键字？

将各种关键字及其结果与 Adwords 网站等效项进行比较，我发现了许多差异。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T03:37:36.643

根据[Google API 文档](http://code.google.com/apis/adwords/docs/developer/KeywordToolService.html#getKeywordVariations)：

编辑：（我链接到的页面描述了不止一种方法）：

> 给定一个 SeedKeywords 列表，在 KeywordVariations 的多个列表中返回它们的变体。每个列表代表一种不同的变体。

您使用的是[最新版本的 API](https://stackoverflow.com/questions/518460/google-adwords-api-getkeywordvariations-not-working-properly)吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-06-01T16:24:02.930

以下部分介绍了如何将 API 的结果与 AdWords 网站的结果相匹配。您可以设置许多搜索参数，例如位置、语言等，以帮助他们对齐和匹配结果。

[https://developers.google.com/adwords/api/docs/guides/targeting-idea-service#mapping_to_the_keyword_planner](https://developers.google.com/adwords/api/docs/guides/targeting-idea-service#mapping_to_the_keyword_planner)

> 关于 TargetingIdeaService，我们最常被问到的问题之一是：“为什么 TargetingIdeaService 结果与 Keyword Planner 工具的结果不同？”
> 
> 原因是一个 TargetingIdeaSelector 可以配置多个不同的 SearchParameters，使用不同的 SearchParameters 时返回的结果可能会有很大差异。

它不会以任何特定顺序返回关键字，但它提供搜索量，您可以决定它是否相关：

> 找到了带有文本“toaster braun”、类别 ID（10009、10410、10412、12798、11566）和平均每月搜索量“1900”的关键字创意。

这适用于 v201502。

# php - 关于如何从 cookie 中获取 bbpress/wordpress 用户名/用户 ID 的建议

> ID：597379
> 
> 赞同：3
> 
> 时间：2009-02-28T02:25:12.637
> 
> 标签：php, wordpress, integration, bbpress

我正在尝试集成我的网站以使用 bbpress/wordpress 用户系统。

我所需要的只是能够获取当前在我网站上的人的用户名和/或用户 ID。我真的不需要网站上 bbpress 或 wordpress 的任何其他功能。

如果我可以获取用户的 ID，然后从该 ID 获取用户名的能力将完美满足我的所有需求。

附加信息：我的网站在 PHP5 和 MySQL 上运行，我的 wordpress 和 bbpress 是最新的，并且目前相互集成。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T02:52:41.120

您是否尝试过仅打印 的内容`$_COOKIE`？我的包含以下内容：

```
Array
(
    [wordpress_test_cookie] => WP Cookie check
    [wordpress_logged_in_##########] => ceejayoz|#####|##########]
) 
```

应该很容易解析。

```
foreach($_COOKIE as $key => $value) {
  if(preg_match('@^wordpress_logged_in_@', $key) {
    $cookie = explode('|', $_COOKIE[$key]);
    $username = $cookie[0];
  }
} 
```

# asp.net - asp.net Listview控件中的分页

> ID：597384
> 
> 赞同：2
> 
> 时间：2009-02-28T02:34:42.910
> 
> 标签：asp.net

如何在 Listview 控件中获得分页功能（就像我们在 asp.net gridview 中拥有的那样）？

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-28T02:36:02.533

使用寻呼机控件

看到这个链接：[http ://aspnet.4guysfromrolla.com/articles/021308-1.aspx](http://aspnet.4guysfromrolla.com/articles/021308-1.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-31T07:44:06.193

如果您使用数据源，只需在`<LayoutTemplate>`标签内拖动一个 DataPager 控件。

# ruby - 树顶 SGF 解析

> ID：597385
> 
> 赞同：3
> 
> 时间：2009-02-28T02:35:18.807
> 
> 标签：ruby, parsing, treetop

我目前正在尝试编写 Treetop 语法来解析简单游戏格式文件，并且到目前为止大部分都可以正常工作。但是，有几个问题出现了。

1.  我不确定如何在解析后实际访问 Treetop 生成的结构。
2.  有没有比我的字符规则更好的方法来处理捕获所有字符？
3.  有一种情况是我似乎无法正确写出评论。

    C[player1 [4k\]：嗨 player2 [3k\]：嗨！]

我不知道如何处理带有 [] 的 C[] 节点的嵌套结构。

以下是我目前的进展。

**sgf-grammar.treetop**

```
grammar SgfGrammar
rule node
    '(' chunk* ')' {
        def value
            text_value
        end
    }
end

rule chunk
    ';' property_set* {
        def value
            text_value
        end
    }
end

rule property_set
    property ('[' property_data ']')* / property '[' property_data ']' {
        def value
            text_value
        end
    }
end

rule property_data
    chars '[' (!'\]' . )* '\]' chars / chars / empty {
        def value
            text_value
        end
    }
end

rule property
    [A-Z]+ / [A-Z] {
        def value
            text_value
        end
    }
end

rule chars
    [a-zA-Z0-9_/\-:;|'"\\<>(){}!@#$%^&\*\+\-,\.\?!= \r\n\t]*
end

rule empty
    ''
end
end 
```

而我的测试用例，目前排除了具有上述嵌套括号问题的 C[] 节点：

**例子.rb**

```
require 'rubygems'
require 'treetop'
require 'sgf-grammar'

parser = SgfGrammarParser.new
parser.parse("(;GM[1]FF[4]CA[UTF-8]AP[CGoban:3]ST[2]
RU[Japanese]SZ[19]KM[0.50]TM[1800]OT[5x30 byo-yomi]
PW[stoic]PB[bojo]WR[3k]BR[4k]DT[2008-11-30]RE[B+2.50])") 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T02:58:50.903

1.  该结构以 SyntaxNodes 树的形式返回给您（如果结果为 nil，请检查 parser.failure_reason）。您可以遍历这棵树，或者（这是推荐的）您可以使用执行您想要的功能的函数来扩充它，并且只需在根上调用您的 main 函数。

如果您的意思是“如何从节点函数中访问组件？” 有几种方法。您可以使用 element[x] 表示法或按规则获取它们：

```
rule url_prefix
    protocol "://" host_name {
       def example
           assert element[0] == protocol
           assert element[2] == host_name
           unless protocol.text_value == "http"
               print "#{protocol.text_value} not supported" 
               end
           end
       } 
```

你也可以这样命名它们：

```
rule phone_number
    "(" area_code:( digit digit digit ) ")" ... 
```

然后按名称引用它们。

2.  如果您只想匹配这些字符，您的 chars 规则看起来不错。如果您想匹配*任何*字符，您可以像在正则表达式中一样使用点 (.)。

3.  我不熟悉您尝试解析的语言，但您正在寻找的规则可能类似于：

> ```
> rule comment
>     "C" balanced_square_bracket_string
>     end
> rule balanced_square_bracket_string
>     "[" ( [^\[\]]  / balanced_square_bracket_string )* "]"
>     end 
> ```

第二条规则的中间部分匹配任何不是方括号或带有balanced_square 括号的嵌套字符串的内容。

PS 有一个相当活跃的[谷歌群组](http://groups.google.com/group/treetop-dev)，有在线存档和可搜索的。

# asp.net - asp.net sessionID 在回发时更改？

> ID：597387
> 
> 赞同：7
> 
> 时间：2009-02-28T02:37:43.043
> 
> 标签：asp.net, caching, sessionid

我正在编写一个将对象存储在缓存中的 asp.net 应用程序。当页面第一次加载时，它会检查对象的缓存，如果存在，它将使用该对象。如果对象不存在，它将重新构建它并将其存储在缓存中。由于多个用户可以同时使用这个应用程序，我试图将对象存储在缓存中，缓存键是 SessionID。好吧，我注意到当页面回发时，sessionID 发生了变化，所以我需要使用不同的唯一键。有什么建议么？我正在考虑使用登录人的用户 ID，但这也不是唯一的，因为您可以多次使用相同的 ID 登录。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-28T02:53:39.433

我想我刚刚从 MSDN 找到了我的答案（这是对 2.0、3.5 的更改）：

“当使用基于 cookie 的会话状态时，ASP.NET 在使用 Session 对象之前不会为会话数据分配存储空间。因此，在访问会话对象之前，会为每个页面请求生成一个新的会话 ID。如果您的应用程序需要整个会话的静态会话 ID，您可以在应用程序的 Global.asax 文件中实现 Session_Start 方法并将数据存储在 Session 对象中以修复会话 ID，或者您可以使用应用程序的另一部分中的代码显式将数据存储在 Session 对象中。”

[http://msdn.microsoft.com/en-us/library/system.web.sessionstate.httpsessionstate.sessionid.aspx](http://msdn.microsoft.com/en-us/library/system.web.sessionstate.httpsessionstate.sessionid.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T02:40:46.670

回发时会话 ID 不应更改。asp.net 使用它来做类似的事情。你能提供更多关于这个场景的信息吗？什么类型的数据，为什么/何时尝试“缓存”

**更新 1：**关于每次回帖时的更改，您是否禁用了 cookie？您使用的是哪个版本的 asp.net？

# apache - 如何使用“mod rewrite”将文件夹路径重定向到子域，但没有浏览器重定向？

> ID：597390
> 
> 赞同：3
> 
> 时间：2009-02-28T02:39:27.533
> 
> 标签：apache, mod-rewrite

我有一个文件，我想使用 mod_rewrite 重定向到子域。例如，我想将请求重定向`http://www.mydomain.com/xyz`到子域`xyz.example.com`

我不想向浏览器发送重定向（所以它不知道页面不同）。

顺便提一句。`xyz`是一条 CNAME 记录，指向`www.otherdomain.com.`

另一个例子，只是为了澄清。如果`http://www.mydomain.com/xyz/something`在浏览器中输入，我希望 Apache 返回的内容`http://xyz.mydomain.com/something`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T02:56:05.043

我*认为*这会做你想做的事：

```
Options +FollowSymLinks
RewriteEngine On
RewriteRule ^(.*?)/(.*?)$ http://$1.mydomain.com/$2 
```

就目前而言，它将重定向到子文件夹的每个请求，因此如果您链接子文件夹中的图像或 css，它也会重写这些，如果您只想列出某些可以使用的东西

```
Options +FollowSymLinks
RewriteEngine On
RewriteRule ^(blog|store|other)/(.*?)$ http://$1.mydomain.com/$2 
```

这只会重定向 mydomain.com/blog/ mydomain.com/store/ 和 mydomain.com/other/

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T12:57:41.867

如果两个域都在同一台机器上并且可以通过文件系统访问，那么你应该这样做。例如：

```
RewriteEngine on
RewriteCond %{HTTP_HOST} ^(www\.)?example\.com$
RewriteRule ^([^/]+)/(.*) /absolute/path/to/subdomains/$1/$2 
```

如果不是这种情况，您将需要一个代理：

```
RewriteEngine on
RewriteCond %{HTTP_HOST} ^(www\.)?example\.com$
RewriteRule ^([^/]+)/(.*) http://$1.example.com/$2 [P] 
```

这些示例适用于 .htaccess 文件。如果您想在 httpd.conf 中使用它们，请在`RewriteRule`模式前加上`/`.

# esb - 什么是 ESB，它有什么用处？

> ID：597397
> 
> 赞同：90
> 
> 时间：2009-02-28T02:45:52.773
> 
> 标签：esb

在以前的工作中，有很多关于“企业服务总线”（ESB）的讨论。我阅读了有关它的概念性书籍的部分内容，但从未真正理解您将如何具体实现/集成它。我熟悉 SOA/队列/目录服务/等。但我不明白 ESB 到底是什么。

它是一个具体的东西（服务/服务器/代理/等），你只是以不同的方式将你的所有应用程序连接到它，还是只是一种设计系统的概念性方式？

任何解释或链接到好的例子将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-02-28T03:08:38.257

这是一个相当高级的抽象概念。中心概念是 ESB 提供允许企业在不编写代码的情况下连接其应用程序的中间件和接口。

这可能包括调解不兼容的协议、数据和交互。

一切都通过中央总线的想法为额外的抽象层提供了机会。使用行业标准将其他应用程序、客户端等“插入”到该总线中，这样就可以相对容易地连接具有不同需求的新服务、数据源和客户端。

### 实际实现

就实际实施而言，这是非常大的企业支持业务的领域。虽然它非常流行，但目标是通过与互联网的比较在某种程度上可以理解的理想：

### 与互联网的相似之处

一种具有广泛不同用途和数据的大型通信总线，但都运行标准化协议。

事实上，可以编写一个 HTTP 到 FTP 连接器，它允许浏览器访问 FTP 站点而无需调用 FTP 客户端（现在通常内置在浏览器中）。

### 混搭

混搭展示了一个有趣的实现——从旧金山当局获取一些公交路线数据，从谷歌获取地图，从雅虎获取寿司店的位置以及评级，然后运行一个简单的查询，为您提供最近的寿司店，对其进行加权，以便您成为为了更好的酒吧愿意走得更远一点。

所有完全不同的服务，它们本身不兼容，但使用标准连接器（例如 yahoo 管道）可以将它们拉到一个有凝聚力和有用的整体中。

-亚当

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-03-02T08:37:37.170

免责声明：我为 IBM 工作并就 WebSphere ESB 进行咨询，这是一种旨在用于构建 ESB 的 IBM 产品。以下是我的观点，并不一定反映 IBM 的立场。

不幸的是，ESB 对不同的人来说是不同的东西。

对我来说，ESB 是一种可以插入到 SOA（面向服务的架构）中的任何技术，允许您将不同的系统连接在一起。它经常执行协议转换、消息修改、路由、日志记录、充当安全网关等功能。例如，您可以使用 ESB 将以前只能作为 Web 服务提供的服务公开为基于 JMS 的服务。

在这方面，ESB 实现（或者更准确地说，出售用于构建 ESB 的软件——例如我所咨询的）通常在技术上类似于过去被称为消息传递或队列代理的技术，尽管目的有些不同，因为（正如首字母缩略词所暗示的那样）它以服务为导向，而不是将消息从一个地方移动到另一个地方。这种区别在技术上的重要性是一个见仁见智的问题。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-02-28T03:28:59.753

我对商业 ESB 的体验是，它是一种夸大其词且成本高昂的技术，它所解决的问题与它所解决的问题一样多。ESB 将连接新系统和遗留系统，消息将通过总线传输，并且一切都将能够与其他一切无缝通信。加入一些弹性、编排，你就拥有了一个非常强大的企业应用软件。

当您尝试真正使用它们时，问题就来了，为总线编写、创建消息结构等的开销可能会超过好处。作为一个高成本的项目，ESB 被视为解决所有技术问题的灵丹妙药，它不是，太多时间花在总线上，而不是花在连接的应用程序/数据上。通常情况下，多个竞争标准会在同一个组织中争夺至高无上的地位，从而导致这些系统实际上应该修复的经典技术主导的孤岛。

恕我直言，最好使用创建少量特定接口，通常仅在需要它的系统之间使用 Web 服务。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2015-01-16T11:49:49.403

它基本上是一种设计系统的概念性方法——软件公司试图通过在其上贴上“ESB”标签来向您推销更多产品，而经理们喜欢因为 ESB 从“更高级别”看起来不错。

ESB 基本上是一个带有附加数据模型和结构定义管理的 MOM（面向消息的中间件）。您对该总线上的所有应用程序和适配器都有一个通用数据定义（可以是具有共享 XSD 的 XML）。任何连接的东西都必须发送符合此数据定义的信息。ESB 支持这个公共数据定义的加载、共享和版本控制。将新组件连接到 ESB 时，与将其连接到 MOM 时相比，您可以期待更多的开箱即用“兼容性”。该总线上的每个组件在概念上都被视为“资源”——因此引入了一个额外的抽象来将发送者与接收者分离。

示例：假设您想在标准的面向消息的中间件中连接应用程序 A 和应用程序 B，让我们以 JMS 为例。您与在应用程序 B 上工作的同事交谈，就主题、消息类型和字段达成一致并发送它（伪代码）： sendJms("TRADE.MSFT", {MapMessage trader="pete" price=101.4 vol=100})

如果你在面向服务的架构中做同样的事情，你需要

1.  安装附加软件
2.  学习很多新概念
3.  在 ESB 的管理 gui 中定义新的 Java 组件
4.  实现一些由 ESB 控制的接口
5.  sendJms(getDestination(), {MapMessage trader="pete" price=101.4 vol=100}) - 注意目的地是从 ESB 注入的

第一次可能有点痛苦，但我想你可以习惯它，就像你可以习惯 EJB 一样;-)

您可以说 MOM 系统是“无类型”（动态结构），而 ESB 是“类型”（静态结构）。原始消息传递与 ESB 的权衡类似于其他无类型/有类型的选择：

*   REST 与 SOAP
*   未验证的 XML 与使用 XSD 验证的 XML
*   Groovy 与 Java
*   解释语言与编译语言

对于较小的项目，最好快速散列功能（例如 Groovy 代码），但对于较大的项目，最好有一个调试器（例如 Java），在出现问题时提前得到警告，并在人们提交*之前*有一个标准项目。

因此，如果您的项目有太多人通过签入未经验证的更改来破坏系统 - 转向更多的结构（ESB 而不是 MOM）。如果您的项目无法及时完成足够的事情，请选择更简单、无类型的解决方案。如果两者兼而有之 - 找一个顾问（开个玩笑；-）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-28T03:09:22.250

嗯，这取决于你问谁......很多人会说它是一个“中间件”，它将各种“业务逻辑”连接在一起，从而将编码从这些模块之间的消息传递中解脱出来。我认为这是一个足够笼统的定义，但我敢肯定你已经通过维基百科和诸如此类的东西到达那里。

那些希望拥有伟大的 ESB 来拯救世界的人认为它是最常见的，是做所有事情的中心。大多数 ESB 实现都努力封装我们在业务软件中看到的所有重复性任务。这意味着大多数 ESB 负责数据传输、安全性、日志记录、协议转换、事件系统、通过 Web 服务公开 API 等。

我认为这已经很清楚了……希望对您有所帮助。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-04-18T01:23:09.537

看看我的演讲“ [Spoiled for Choice - How to select the right ESB](http://www.kai-waehner.de/blog/2013/01/23/spoilt-for-choice-how-to-choose-the-right-enterprise-service-bus-esb/) ”。

我解释了何时使用 ESB、集成套件或仅使用集成框架（例如 Apache Camel）。我还讨论了开源 ESB 和专有 ESB 之间的区别。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-28T03:27:39.540

除了您可以从[Wikipedia](http://en.wikipedia.org/wiki/Enterprise_service_bus)获得的标准定义之外。我发现它是一个很好的工具，可以跨多个平台和技术连接一堆遗留系统。它也是构建分布式工作流和状态管理系统（如总账）的好工具。

但是，它的维护和扩展相当昂贵、复杂且不方便，这使得它作为扩展应用程序的通用工具是一个糟糕的技术选择。

# c# - 如何让 Winforms 进度条在 C# 中垂直移动？

> ID：597411
> 
> 赞同：7
> 
> 时间：2009-02-28T02:58:58.703
> 
> 标签：c#, winforms, user-interface, progress-bar

我正在开发 WinForms Jukebox。
我想要一个用于音量控制的垂直 ProgressBar。

有谁知道这是怎么做到的吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-28T03:03:50.470

我不知道我会使用进度条来**控制**音量，但是要**显示**音量级别，您可以使用用户绘制的控件，或者您可以使用背景颜色调整标签的大小（最后一种方法有点笨拙尽管）

无论方向如何，进度条都不意味着接受输入。

如果您真的想**控制**音量，请考虑使用垂直滚动条或[垂直方向](http://msdn.microsoft.com/en-us/library/system.windows.forms.trackbar.orientation.aspx)的轨迹条。

对于它的价值，有[一个关于如何在 MSDN 上创建垂直进度条的讨论](http://social.msdn.microsoft.com/forums/en-US/winforms/thread/60b2493d-c8ff-495d-b845-d114fe456f54/)，他们建议这样做：

```
using System; 
using System.Windows.Forms; 

public class VerticalProgressBar : ProgressBar { 
  protected override CreateParams CreateParams { 
    get { 
      CreateParams cp = base.CreateParams; 
      cp.Style |= 0x04; 
      return cp; 
    } 
  } 
} 
```

它将`PBS_VERTICAL`标志设置在`Style`.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-28T03:08:54.467

为此，您必须使用 ProgressBarRenderer。它记录在[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.progressbarrenderer.aspx)

该文档实际上显示了垂直 ProgressBar 的实现，因此它应该让您轻松。:-)

# wpf - 寻找 DependencyProperty.Register 快捷方式

> ID：597413
> 
> 赞同：4
> 
> 时间：2009-02-28T03:01:36.230
> 
> 标签：wpf, properties, helper

定义 WPF 属性太长：

```
public static readonly DependencyProperty FooProperty = 
  DependencyProperty.Register("Foo", typeof(string), typeof(FooClass), new PropertyMetadata("Foooooo")); 
```

我有一个辅助方法，使它更短一些：

```
public static readonly DependencyProperty FooProperty =
  WpfUtils.Property<string, FooControl>("Foo", "Foooooo"); 
```

代码：

```
public partial class WpfUtils 
{
    public static DependencyProperty Property<T, TClass>(string name) 
    {
        return Property<T, TClass>(name, default(T));
    }

    public static DependencyProperty Property<T, TClass>(string name, T defaultValue) 
    {
        return DependencyProperty.Register(name, typeof(T), typeof(TClass), new PropertyMetadata(defaultValue));
    }
} 
```

周围有更好的帮手吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T19:37:32.220

这是一些代码。这段代码是邪恶的，但我想展示如何在不使用 Cecil 或创建 sourceforge 项目的情况下做到这一点 :-)

要使用它，请致电：

```
public static readonly DependencyProperty FooProperty = D.P(); 
```

代码是：

```
public class D
{
    [MethodImpl(MethodImplOptions.NoInlining)]
    public static DependencyProperty P()
    {
        StackTrace stackTrace = new StackTrace();
        StackFrame oneUp = stackTrace.GetFrame(1);
        MethodBase callingMethod = oneUp.GetMethod();
        if (!(callingMethod is ConstructorInfo))
        {
            throw new InvalidOperationException("This method must be called from a static constructor/initializer");
        }
        byte[] staticConstructorCode = callingMethod.GetMethodBody().GetILAsByteArray();
        int offsetAfterThisCall = oneUp.GetILOffset() + 5;

        while (staticConstructorCode[offsetAfterThisCall] == OpCodes.Nop.Value)
        {
            offsetAfterThisCall++;
        }

        if (staticConstructorCode[offsetAfterThisCall] != OpCodes.Stsfld.Value)
        {
            throw new InvalidOperationException("Unexpected IL");
        }

        int token = BitConverter.ToInt32(staticConstructorCode, offsetAfterThisCall + 1);

        FieldInfo field = callingMethod.Module.ResolveField(token);

        if (!field.Name.EndsWith("Property") || field.FieldType != typeof(DependencyProperty))
        {
            throw new NotSupportedException("The field the return value of this method will be stored in must be named xxxProperty and be of type DependencyProperty");
        }

        string name = field.Name.Substring(0, field.Name.Length - "Property".Length);
        return DependencyProperty.Register(name, callingMethod.DeclaringType.GetProperty(name).PropertyType, callingMethod.DeclaringType);
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-09-04T08:38:51.630

这是我的尝试。它比 Alun Harford 的 IL 阅读方法更安全。

这个助手有以下特点：

*   支持依赖属性和附加属性
*   以类型安全的方式提供属性名称，不带（魔术）字符串（使用表达式树）
*   类型安全的回调支持，带有通用参数

首先，我将展示用法：

```
public class Tester : DependencyObject
{
    public int Foo
    {
        get { return (int)GetValue(FooProperty); }
        set { SetValue(FooProperty, value); }
    }
    public static readonly DependencyProperty FooProperty = 
        For<Tester>.Register(o => o.Foo, 0, onFooChanged);

    private static void onFooChanged(Tester obj, DependencyPropertyChangedEventArgs<int> e)
    {
    }

    public string Attached
    {
        get { return (string)GetValue(AttachedProperty); }
        set { SetValue(AttachedProperty, value); }
    }
    public static readonly DependencyProperty AttachedProperty = 
        For<Tester>.RegisterAttached(o => o.Attached, "default", onAttachedChanged);

    private static void onAttachedChanged(DependencyObject obj, DependencyPropertyChangedEventArgs<string> e)
    {
    }
} 
```

这是实现：

```
public static class For<TOwner>
    where TOwner : DependencyObject
{
    public static DependencyProperty Register<TProperty>(
        Expression<Func<TOwner,TProperty>> property, 
        TProperty defaultValue, 
        Action<TOwner, DependencyPropertyChangedEventArgs<TProperty>> callback)
    {
        return DependencyProperty.Register(
            getName(property),
            typeof(TProperty),
            typeof(TOwner),
            new FrameworkPropertyMetadata(
                defaultValue,
                (o, args) => callback((TOwner)o, new DependencyPropertyChangedEventArgs<TProperty>(args))));
    }

    public static DependencyProperty RegisterAttached<TProperty>(
        Expression<Func<TOwner,TProperty>> property, 
        TProperty defaultValue,
        Action<DependencyObject, DependencyPropertyChangedEventArgs<TProperty>> callback)
    {
        return DependencyProperty.RegisterAttached(
            getName(property),
            typeof(TProperty),
            typeof(TOwner),
            new FrameworkPropertyMetadata(
                defaultValue,
                (o, args) => callback(o, new DependencyPropertyChangedEventArgs<TProperty>(args))));
    }

    private static string getName<T>(Expression<Func<TOwner,T>> property)
    {
        var name = ((MemberExpression)property.Body).Member.Name;
        return name;
    }
}

public struct DependencyPropertyChangedEventArgs<T>
{
    public DependencyPropertyChangedEventArgs(DependencyPropertyChangedEventArgs source)
    {
        m_property = source.Property;
        m_oldValue = (T)source.OldValue;
        m_newValue = (T)source.NewValue;
    }

    private readonly DependencyProperty m_property;
    public DependencyProperty Property { get { return m_property; } }

    private readonly T m_oldValue;
    public T OldValue { get { return m_oldValue; } }

    private readonly T m_newValue;
    public T NewValue { get { return m_newValue; } }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-28T04:42:51.370

我同意依赖属性这么长是一种痛苦。我不使用帮助程序，但 Visual Studio 有一个很棒的内置代码片段，您可以通过键入 wpfdp 来使用它。

这就是我快速填写一堆依赖属性的方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-10T23:02:14.750

对于那些使用 resharper 的人，我使用以下模板

```
//DependencyProperty $PropertyName$
public static readonly DependencyProperty $PropertyName$Property =
      DependencyProperty.Register("$PropertyName$", typeof($PropertyType$), typeof($SelfType$),
      new FrameworkPropertyMetadata($DefaultValue$, $PropertyName$ChangedCallback, $PropertyName$CoerceValue));

public $PropertyType$ $PropertyName${
       set { SetValue($PropertyName$Property, value); }
       get { return ($PropertyType$)GetValue($PropertyName$Property); }
      }

private static void $PropertyName$ChangedCallback(DependencyObject d, DependencyPropertyChangedEventArgs e){

      $SelfType$ owner = d as $SelfType$;
      if(owner!=null){}

      }

 private static object $PropertyName$CoerceValue(DependencyObject d, object value)   {

            $PropertyType$ val = ($PropertyType$)value;
        return value;
      } 
```

我让它只显示可以声明成员的地方我还设置了 $SelfType$ 以扩展为父类型，这里是类名

# c++ - void* 作为未知变量类型

> ID：597436
> 
> 赞同：2
> 
> 时间：2009-02-28T03:17:22.730
> 
> 标签：c++, void

我目前正在使用 C++ 开发精灵引擎。我有一个带有虚函数 init_api 的抽象类 IEngine。这需要一个 void*。

```
 //  Initialise the engines' API
//  api_params - void* to api parameters for initalisation
//  hWnd - window handle
virtual bool init_api( void* api_params, HWND hWnd ) = 0; 
```

然后我有一个 DirectX 实现的引擎类 CEngineDX。然后将 api_params 转换为 D3DPRESENT_PARAMETERS*，因此它可以用于初始化 DirectX。

```
//  Cast api_params to a D3DPRESENT_PARAMETERS
D3DPRESENT_PARAMETERS* presentParams = NULL;
presentParams = reinterpret_cast< D3DPRESENT_PARAMETERS* >( api_params ); 
```

我对这个设置很满意，但如果你愿意，我想让其他程序员对这个“解决方案”有看法。

为回复干杯！

卡尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T03:21:49.240

这是继承层次结构中参数类型变化的一个相对常见的问题；您的子类想要专门化父类中的“api_params”类型。

我认为这没问题，但它类似于 C。我认为更好的解决方案是使`init_api`非虚拟化并在子类中使用正确的类型来实现它。无论如何，该`D3DPRESENT_PARAMETERS`结构很可能只​​对 DirectX 引擎有意义，那么为什么不将它放在它逻辑所属的子类中呢？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T07:32:59.433

好吧，您可以使用模板（您是否不喜欢演员表），但在这种情况下您的层次结构将不得不消失。

```
template<class T>
struct Engine {
   bool init_api(const T& params, HWND hWnd);
};

//specialize for DirectX
template<>
struct Engine <D3DPRESENT_PARAMETERS> {
  bool init_api(const D3DPRESENT_PARAMETERS& params, HWND hWnd) {
    return true;
  }
}; 
```

但是，使用适合大局的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T07:45:19.887

另一种方法是为每个实现提供一个通用头文件和不同的 *.cpp 文件。这样您就可以在项目中仅包含 D3D 或仅包含 OGL 文件。IMO 最好在编译时选择 API，这样您就不会链接两个库。

至于void*，我不是很喜欢。我认为您最好定义自己的类型，然后使用包装器结构/类和 typedef 将它们映射到 API 类型。您可以转发声明这些，并将实际实现放在您的 *.cpp 文件中。

这种方法的另一个好处是您无需为不需要的虚拟功能付费，尽管我意识到虚拟调用的成本非常小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T03:22:03.607

我真的不喜欢这个 API。为什么使用空指针？为什么不将第一个参数设为指针或引用`D3DPRESENT_PARAMETERS`？你知道无论如何它应该是这样的吗？这是更类型安全的。

# windows-vista - 为什么 Vista Sidebar Gadget 不会出现在 Gadget Gallery 中？

> ID：597453
> 
> 赞同：2
> 
> 时间：2009-02-28T03:35:51.780
> 
> 标签：windows-vista, vista64, windows-desktop-gadgets

我想在 Vista 中创建一个侧边栏小工具。我已经按照[本教程学习](http://msdn.microsoft.com/en-us/magazine/cc163370.aspx)了如何创建一个字母。但是，当我转到边栏中的添加小工具时，小工具根本不会显示在小工具库中。

我试过重置侧边栏，删除小工具文件夹旁边的设置文件，确保我的 xml 文件存储为 UTF-8 等。仍然没有。

**注意：**对于那些希望重新标记的人，这*是*与编程相关的。请点击链接查看我在说什么。我正在尝试让一些逐字教程代码正常工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T05:17:12.113

您必须压缩或转换您的小工具并将扩展名重命名为 .gadget 然后您可以将其放入 c:\Users\yourusername\AppData\Local\Microsoft\WindowsSidebar\Gadgets。这应该使它在小工具库中可用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T20:59:49.007

您是否将所有文件放在 %appdata%..\local\Microsoft\Windows Sidebar\Gadgets 的子目录中？不需要将文件放入存档中，它只是在安装过程中将所有内容提取到该目录。

如果您创建了带有 .gadget 扩展名的存档，请确保所有文件都位于该存档的根目录中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T15:54:14.263

如果您从教程中复制 gadget.xml，请确保将“替换为”。还要确保 src="something.html" 指向有效的 html 页面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T11:07:29.797

当您在小工具库中查找您的自定义小工具时，请检查搜索框是否显示“Microsoft Corporation”。

[替代文字 http://www.freeimagehosting.net/uploads/6b6b3e75c7.png](http://www.freeimagehosting.net/uploads/6b6b3e75c7.png)

这是默认设置，只会显示 Microsoft 的小工具，将其更改为“所有小工具”，您应该会看到您的自定义小工具出现：

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-09T19:50:57.307

似乎有一个 settings.htm 文件是强制性的，因为在添加一个之后，我的测试工作了。

# php - 如何在 PHP 中验证 MYSQL 日期？

> ID：597456
> 
> 赞同：9
> 
> 时间：2009-02-28T03:39:00.573
> 
> 标签：php, mysql, date

用户将从 3 个下拉列表（日、月、年）中选择他们的日期。我将在服务器端将它们组合成一个像“2008-12-30”这样的字符串。然后我如何验证以确保该日期的格式/数字正确，等等？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-03-21T10:58:23.220

我个人发现这是确定日期是否**根据格式**和**有效***的*正确而优雅的方法：

 *****   将日期`20111-03-21`视为无效 - 不像`checkdate()`
*   没有可能的 PHP 警告（如果提供了任何一个参数，自然而然） - 与大多数`explode()`解决方案不同
*   与仅使用正则表达式的解决方案不同，考虑闰年
*   完全兼容mysql`DATE`格式（10.03.21同2010-03-21）

这是您可以使用的方法：

```
/**
 * Tests if a string is a valid mysql date.
 *
 * @param   string   date to check
 * @return  boolean
 */
function validateMysqlDate( $date )
{
    return preg_match( '#^(?P<year>\d{2}|\d{4})([- /.])(?P<month>\d{1,2})\2(?P<day>\d{1,2})$#', $date, $matches )
           && checkdate($matches['month'],$matches['day'],$matches['year']);
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-28T03:56:35.803

如果它们是 3 个单独的下拉菜单，则需要将它们验证为三个单独的值。

IE，

*   验证年份列是否为数字，并且在您的应用中有效的年份之间
*   验证月份列是否为数字
*   验证日期列是否为数字
*   使用 checkdate() 验证它们都是有效值

或者，您可以将它们全部转换为整数，将它们组合成一个日期，然后查看生成的日期是否有效。IE，

```
$time = mktime(0, 0, 0, (int)$_POST['month'], (int)$_POST['day'], (int)$_POST['year']);

// in this example, valid values are between jan 1 2000 (server time) and now
// modify as required
if ($time < mktime(0, 0, 0, 1, 1, 2000) || $time > time())
  return 'Invalid!';

$mysqltime = date('Y-m-d', $time);

// now insert $mysqltime into database 
```

这种方法的缺点是它只适用于 Unix 时间戳范围内的日期，即 1970 到 2038 左右。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-12-09T08:29:04.033

**我正在使用这个功能：**

```
<?php 
function validateMysqlDate( $date ){ 
    if (preg_match("/^(\d{4})-(\d{2})-(\d{2}) ([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/", $date, $matches)) { 
        if (checkdate($matches[2], $matches[3], $matches[1])) { 
            return true; 
        } 
    } 
    return false; 
} 

// check it: 
  $a = validateMysqlDate('2012-12-09 09:04:00');
  $b = validateMysqlDate('20122-12-09 09:04:00');
  $c = validateMysqlDate('2012-12_09 09:04:00');
  $d = validateMysqlDate('');
  var_dump( $a );
  var_dump( $b );
  var_dump( $c );
  var_dump( $d ); 
?> 
```

$a 是真的，其他都是假的 - 这是正确的

Raveren 的函数（上图）不会覆盖带有时间戳的有效日期！！！$a 在那里返回 false ！顺便说一句：checkdate() 将为 $b 返回 true，尽管它不是有效的 mysql 日期时间

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-28T03:55:52.607

[您可以使用checkdate](http://us.php.net/manual/en/function.checkdate.php)检查日期是否有效。如果您想确保这些值是数字且长度正确，您可以在构建日期之前执行一些简单的操作，例如~~[is_int](http://us2.php.net/is_int)~~ [ctype_digit](http://ca3.php.net/manual/en/function.ctype-digit.php)和[strlen](http://us2.php.net/manual/en/function.strlen.php)组合。

```
// untested
if( !ctype_digit)( $month ) || strlen( $month ) != 2 ) {
    // handle error
}
// repeat for $day and $year
if ( checkdate( $month, $day, $year ) {
    // do your work
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-14T05:05:01.097

只是有同样的问题。我写了一个简短的函数来检查格式是否正确，以及日期是否真实：

```
function valid_mysql_date($str){
    $date_parts = explode('-',$str);
    if (count($date_parts) != 3) return false;
    if ((strlen($date_parts[0]) != 4) || (!is_numeric($date_parts[0]))) return false;
    if ((strlen($date_parts[1]) != 2) || (!is_numeric($date_parts[1]))) return false;
    if ((strlen($date_parts[2]) != 2) || (!is_numeric($date_parts[2]))) return false;
    if (!checkdate( $date_parts[1], $date_parts[2] , $date_parts[0] )) return false;
    return true;
} 
```

希望能帮助到你。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-28T05:19:30.393

如果您有三个下拉菜单，那么来自下拉菜单的值应该始终是数字，因为您控制与月份关联的值（如下所示）。这将导致得出组合结果有效的结论。

```
<option value="01">January</option> 
```

如果您在下拉菜单中提供帮助条目，例如“选择一个月”，那么您可以将该值设为 0，并确保来自每个下拉框的值大于零。

有人可能会更改 HTML 表单以提供其他值。如果这是一个问题，那么您可以使用 PHP 函数[ctype_digit()](http://ca3.php.net/manual/en/function.ctype-digit.php)来检查提供的每个值是否实际上是一个数字。

如果您担心日期实际上是有效的，请使用[checkdate()](http://ca3.php.net/manual/en/function.checkdate.php)函数。

# iphone - SDL for iPhone 有多成熟？

> ID：597459
> 
> 赞同：22
> 
> 时间：2009-02-28T03:44:42.947
> 
> 标签：iphone, cross-platform, sdl

有一段时间我一直在考虑尝试将我最喜欢的经典 PC 游戏之一，[Ur-Quan Masters](http://sc2.sourceforge.net)（又名[Star Control 2](http://en.wikipedia.org/wiki/Star_control_2)）移植到 iPhone。UQM 的所有图形、声音、输入和其他游戏内容都使用 SDL，而且似乎确实有一个 SDL 到 iPhone 的端口，但在这一点上看起来还不是很成熟。

有没有人测试过 iPhone SDL 端口？效果如何？将这个已经是跨平台代码到 iPhone 的项目，我可以期待什么样的问题？

如果 SDL 不是一个选项，任何人都可以推荐一个替代框架来查看它将弥合 SDL 与 OpenGL ES 和 Core Audio 等本机库之间的差距吗？还是对这些框架进行编码是最佳选择？

**编辑添加：**这是UQM 论坛上关于做 iPhone 移植的[论坛主题的链接。](http://forum.uqm.stack.nl/index.php?topic=4254.0)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-28T11:16:28.163

**更新**
这个答案真的过时了，所以你可以停止投票！

我不再使用 SDL 进行 iPhone 开发，因为它不适合 iPhone 型号。例如，SDL 坚持拥有 main()，音频子系统不知道 AudioSessions，很难了解视图方向的变化等。很高兴看到熟悉的面孔，但最终 SDL 引入的问题多于解决的问题.

**2009 回答**
svn 版本对我来说效果很好。

我遇到了一个问题，那就是`atexit(SDL_Quit)`.

所以我禁用了清理。

加上库名称不明智，但您可以更改它。

对我来说最困难的部分是将我的 SDL 代码移植到 SDL-1.3，并将我的 OpenGL 代码移植到 OpenGLES。

OpenGLES 可以正常工作，加速度计显示为 3 轴操纵杆，声音稳定。

我给 iPhone SDL 4.5 打了 5 颗星。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-02T12:44:17.613

iPhone 端口按预期工作，并且确实有点未完成的感觉。交付时，与 SDK 集成并不容易，这对于某些游戏来说可能没问题，但我认为大多数用户希望今天的游戏更多，比如社交网络连接。

幸运的是，只要稍加努力，您就可以将大部分 iPhone SDK 与 SDL 一起使用。

请在此处查看我的教程，*[弥合差距](http://web.me.com/cannonwc/Site_4/Blog/Archive.html)*。

*[和Simple DirectMedia 层论坛](http://forums.libsdl.org/)*上的博客。

SDL 往往会弄乱表格视图中的触摸事件，但您可以通过运行单独的 cfrunloop 来解决此问题。

性能接近于使用普通的香草[OpenGL](http://en.wikipedia.org/wiki/OpenGL)。

# python - 如何通过 Python 中的多个正则表达式语句简洁地级联

> ID：597476
> 
> 赞同：14
> 
> 时间：2009-02-28T04:06:31.457
> 
> 标签：python, regex, coding-style

我的困境：我正在向我的函数传递一个字符串，然后我需要对其执行许多正则表达式操作。逻辑是如果第一个正则表达式匹配，做一件事。如果不匹配，则检查与第二个匹配并执行其他操作，如果不匹配则检查第三个，依此类推。我可以做这样的事情：

```
if re.match('regex1', string):
    match = re.match('regex1', string)
    # Manipulate match.group(n) and return
elif re.match('regex2', string):
    match = re.match('regex2', string)
    # Do second manipulation
[etc.] 
```

但是，这感觉不必要地冗长，通常在这种情况下，这意味着有一种更好的方法，我要么忽略了，要么还不知道。

有没有人建议更好的方法来做到这一点（从代码外观的角度，内存使用的角度，或两者都更好）？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-28T04:31:57.310

一般来说，在这种情况下，您希望使代码“数据驱动”。也就是把重要的信息放到一个容器里，循环遍历。

在您的情况下，重要的信息是 (string, function) 对。

```
import re

def fun1():
    print('fun1')

def fun2():
    print('fun2')

def fun3():
    print('fun3')

regex_handlers = [
    (r'regex1', fun1),
    (r'regex2', fun2),
    (r'regex3', fun3)
    ]

def example(string):
    for regex, fun in regex_handlers:
        if re.match(regex, string):
            fun()  # call the function
            break

example('regex2') 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-28T05:32:56.023

九月份的类似问题：[如何将这个正则表达式习语从 Perl 翻译成 Python？](https://stackoverflow.com/questions/122277)

在模块中使用全局变量可能不是最好的方法，但将其转换为一个类：

```
import re

class Re(object):
  def __init__(self):
    self.last_match = None
  def match(self,pattern,text):
    self.last_match = re.match(pattern,text)
    return self.last_match
  def search(self,pattern,text):
    self.last_match = re.search(pattern,text)
    return self.last_match

gre = Re()
if gre.match(r'foo',text):
  # do something with gre.last_match
elif gre.match(r'bar',text):
  # do something with gre.last_match
else:
  # do something else 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-02T14:27:29.513

我遇到了和你一样的问题。这是我的解决方案：

```
import re

regexp = {
    'key1': re.compile(r'regexp1'),
    'key2': re.compile(r'regexp2'),
    'key3': re.compile(r'regexp3'),
    # ...
}

def test_all_regexp(string):
    for key, pattern in regexp.items():
        m = pattern.match(string)
        if m:
            # do what you want
            break 
```

[这是从大型结构化文本文件中提取信息](https://stackoverflow.com/questions/481862/extracting-info-from-large-structured-text-files)的答案稍作修改的解决方案

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T04:24:22.070

嗯……你可以用一些东西来**`with`**构造……嗯

```
class rewrapper()
    def __init__(self, pattern, target):
        something

    def __enter__(self):
        something

    def __exit__(self):
        something

 with rewrapper("regex1", string) as match:
    etc

 with rewrapper("regex2", string) as match: 
    and so forth 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-28T04:25:47.480

每个正则表达式的操作是否相似？如果是这样，试试这个：

```
for regex in ('regex1', 'regex2', 'regex3', 'regex4'):
    match = re.match(regex, string)
    if match:
        # Manipulate match.group(n)
        return result 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-28T04:30:40.637

在这里，您的正则表达式和匹配不会重复两次：

```
match = re.match('regex1', string)
if match:
    # do stuff
    return

match = re.match('regex2', string)
if match:
    # do stuff
    return 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-05-28T22:46:01.977

```
class RegexStore(object):
   _searches = None

   def __init__(self, pat_list):
      # build RegEx searches
      self._searches = [(name,re.compile(pat, re.VERBOSE)) for
                        name,pat in pat_list]

   def match( self, text ):
      match_all = ((x,y.match(text)) for x,y in self._searches)
      try:
         return ifilter(op.itemgetter(1), match_all).next()
      except StopIteration, e:
         # instead of 'name', in first arg, return bad 'text' line
         return (text,None) 
```

你可以像这样使用这个类：

```
rs = RegexStore( (('pat1', r'.*STRING1.*'),
                  ('pat2', r'.*STRING2.*')) )
name,match = rs.match( "MY SAMPLE STRING1" )

if name == 'pat1':
   print 'found pat1'
elif name == 'pat2':
   print 'found pat2' 
```

# php - 如何以编程方式获取图像的真实 URL/路径？

> ID：597477
> 
> 赞同：1
> 
> 时间：2009-02-28T04:08:19.143
> 
> 标签：php, url, image

为了澄清标题问题，我有如下代码：

```
<img src='gallery/main.php?g2_view=core.DownloadItem&g2_itemId=8161&g2_serialNumber=2&g2_GALLERYSID=5b24df90ee45f0e01795a3c01a1d634b'> 
```

该文件实际上驻留在我的 webroot 下的文件系统中。PHP中有什么方法可以检索正在服务的图像真实路径，例如：

```
<img src='images/gallery/album1/file1.jpg'> 
```

例如 someFunction( *longURL* ) ==> images/gallery/album1/file1.jpg

谢谢，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T05:01:16.647

鉴于该 url，很容易理解它使用的是`g2_itemId=8161`，这意味着它可能是从数据库中获取图像的路径。

考虑到这一逻辑，您可以查询数据库并以编程方式获取所需的路径。

```
function someFunction($id) {
   // select path_name from g2_items where item_id = $id;
}
someFunction("8161"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-02T16:28:07.447

我很确定，Gallery2（您显然正在使用）对此有一个内部方法 - 至少它在某个地方解决了这个问题。您必须找到那段代码，并且可以直接使用它（如果它是静态方法）或从那里抽象出来。

您可能想在 Gallery2 论坛上提问 - 它甚至可能已经在那里得到了回答。

使用 Google Codesearch，我发现 main.php 似乎已经有执行此操作的代码：

```
$path = GalleryDataCache::getCachePath(
    array('type' => 'fast-download', 'itemId' => $itemId)); 
```

`$path`似乎是一个文件，当包含它时，它可能会提供您需要的变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-03T01:14:20.400

这是使用 Gallery2 API 的方法。我把它写成一个方便的功能。

```
function get_g2_path($id) {
  include("embed.php");
  GalleryEmbed::init();
  list ($ret, $photo) = GalleryCoreApi::loadEntitiesById($id);
  if ($ret) { return null; }
  list ($ret, $path) = $photo->fetchPath();
  if ($ret) { return null; }
  return $path;
}

// Here's an example of how you'd call it:
print get_g2_path(8161); 
```

一些注意事项：

1.  您必须提供 Gallery2 附带的 embed.php 文件的正确路径
2.  您只想在每个请求中调用 GalleryEmbed::init() 一次，因此如果您想调用此函数两次，请将函数的前两行移至其他位置
3.  您可能想通过错误处理做一些更理智的事情

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T04:29:59.950

很明显，在 main.php 中，查询参数被解析为真实路径。只是做你在那里做什么？

如果您需要一些帮助，请发布一些 main.php 代码，我会帮助您。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T16:36:38.657

如果你只是想改变img src url，你可以使用gallery2的[rewrite模块](http://codex.gallery2.org/Gallery2:Modules:rewrite)并rewrite

```
<img src='gallery/main.php?g2_view=core.DownloadItem&g2_itemId=8161&g2_serialNumber=2'> 
```

到

```
<img src='images/gallery/album1/file1.jpg'> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T20:05:39.247

假设这仅使用“位置”重定向，那么您应该能够使用以下功能为您执行此操作

```
function resolve_url($url)
{
    $location = $url;
    $lastlocation = '';

    while ($location != $lastlocation)
    {
        $lastlocation = $location;
        $context = stream_context_create(
            array(
                'method' => 'GET'
            )
        );

        $metadata = stream_get_meta_data(fopen($location, 'rb', false, $context));

        $headers = $metadata['wrapper_data'];

        foreach($headers AS $header)
        {
            if (preg_match("^Location: (.*)", $header, $parts))
            {
                $location = $parts[1];
            }
        }
    }

    return $location;
} 
```

# dns - 我要的域名在“clienthold”；我有可能得到这个名字吗？

> ID：597478
> 
> 赞同：1
> 
> 时间：2009-02-28T04:09:25.490
> 
> 标签：dns, icann

在开始之前，我想这可能与*编程*无关，但我认为它肯定与 Web 编程有关。

我正在为一个启动项目寻找一个域，我注意到它目前处于“clientHold”注册状态。根据我所做的研究，这表明它存在争议，要么是由于所有权争议、付款争议，要么是有人暗示该域被垃圾邮件发送者/诈骗者使用。whois 数据似乎与我看到的其他垃圾邮件发送者详细信息相似，并且至少在很大程度上是匿名的。

该域已在 XIN NET 注册，后者[似乎因支持垃圾邮件域而臭名昭著](http://weblog.infoworld.com/stratdev/archives/2008/06/xin_net_crackdo.html)。我很想联系注册商，但他们的网站版权是 2006 年，我找不到任何合适的联系方式。即便如此，它们可能太大而无法实际处理，而我的中文技能仅限于谷歌翻译。

需要注意的一件事是域的到期日期不是几个月。

**我的问题是：**

*   是否有关于域可以在 clientHold 状态下保存多长时间的规则？
*   “最后更新的”whois 数据是否表明域最初是在什么时候被放置在 clientHold 上的？
*   如果网站被删除，它会进入等待删除状态一段时间还是可能会立即删除？

任何有关这些东西如何工作的细节将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T18:00:24.213

如果你真的想要它，你最好的选择是使用像 godaddy 这样的缺货系统。如果几个月后它仍然不可用，您可以将您的延期交货订单转移到另一个域。

根据我的经验，您很少会看到处于此状态的域可用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-07-16T17:48:40.010

`clientHold`只是意味着域不会解析。

您现在可以在[https://icann.org/epp](https://icann.org/epp)找到针对最终用户量身定制的所有可能状态的说明。大多数情况下都可以，但仅适用于 gTLD。ccTLD 可能使用相同的状态或其他状态，或具有不同的语义，因此这完全取决于您所在的 TLD。

所以回到你的问题：

> 是否有关于域可以在 clientHold 状态下保存多长时间的规则？

No.`clientHold`由当前赞助该域名的注册商控制，并且可能代表最终客户。因此，由于各种原因，域可以永久处于这种状态。也可能`serverHold`有相同的后果，但完全由注册管理机构控制，可在争议或域名没收期间使用。

> “最后更新的”whois 数据是否表明域最初是在什么时候被放置在 clientHold 上的？

也许，也许不是。域上可能有任何其他更新（联系人更改、名称服务器更改等），因此日期确实显示了上次更新，但不知道该更新是什么。

> 如果网站被删除，

这与 无关`clientHold`，除非某些注册商可以在到期时或到期后将域置于此状态，作为最后一次尝试，以引起注册人注意它必须在注册商处续订域，否则将失去它。根据经验，使其暂时无法解决的后果是，一些注册人已经收到了多封关于即将到期的电子邮件通知，他们突然意识到他们确实需要快速采取行动。

有关 gTLD 删除/过期的方式，请参阅[https://archive.icann.org/en/registrars/gtld-lifecycle.jpg](https://archive.icann.org/en/registrars/gtld-lifecycle.jpg)上的 ICANN gTLD 生命周期。 它在 ccTLD 中类似，但不相同，因此再次取决于您所在的 TLD。

> 它会在一段时间内进入待删除状态还是可能会立即删除？

同样，取决于 TLD。但在 gTLD 中`redemptionPeriod`，注册服务机构向注册管理机构发送删除命令之后（通常为 30 天），然后`pendingDelete`（通常为 5 天）在注册管理机构最终从其数据库中真正删除它之前，之后它应该返回一般可用一个新的注册。

# java - 为什么使用 PyStone 进行测试时 Jython 的行为不一致？

> ID：597483
> 
> 赞同：2
> 
> 时间：2009-02-28T04:21:10.503
> 
> 标签：java, python, performance, jython, benchmarking

我最近一直在玩 Jython，并决定用 pystone 做一些快速而肮脏的基准测试。为了获得参考，我首先测试了 cPython 2.6，循环次数越来越多（我认为这可能是相关的，因为 Jython 应该在一段时间后才开始从 JIT 中获利）。

```
(richard garibaldi):/usr/local/src/pybench% python ~/tmp/pystone.py 
Pystone(1.1) time for 50000 passes = 1.04
This machine benchmarks at 48076.9 pystones/second

(richard garibaldi):/usr/local/src/pybench% python ~/tmp/pystone.py 500000 
Pystone(1.1) time for 500000 passes = 10.33
This machine benchmarks at 48402.7 pystones/second

(richard garibaldi):/usr/local/src/pybench% python ~/tmp/pystone.py 1000000 
Pystone(1.1) time for 1000000 passes = 19.6
This machine benchmarks at 51020.4 pystones/second 
```

如您所见，cPython 的行为始终如一：完成测试所需的时间与循环次数成线性增加。知道了这一点，我开始测试 Jython。

```
(richard garibaldi):/usr/local/src/pybench% jython ~/tmp/pystone.py 
Pystone(1.1) time for 50000 passes = 2.29807
This machine benchmarks at 21757.4 pystones/second

(richard garibaldi):/usr/local/src/pybench% jython ~/tmp/pystone.py 500000 
Pystone(1.1) time for 500000 passes = 10.931
This machine benchmarks at 45741.4 pystones/second

(richard garibaldi):/usr/local/src/pybench% jython ~/tmp/pystone.py 1000000
Pystone(1.1) time for 1000000 passes = 107.183
This machine benchmarks at 9329.86 pystones/second 
```

在第一次运行中，与它的 C 兄弟相比，Jython 运行得相当糟糕。当增加循环数时，它开始感觉更好，接近 cPython，就像我最初的假设所预测的那样。请注意，循环的数量增加了 10 倍，但 Jython 仅用了大约 5 倍的时间来完成它们。所以，正如你想象的那样，我期待 Jython 会在最终测试中真正发挥作用。然而，令我非常失望的是，它确实很糟糕：比最初的运行速度慢了两倍多。

您的假设是什么：为什么 Jython 的行为方式如此不一致？可能是 GC 在某个时刻开始了，并且花费了很多时间？我查看了 PyStone 的代码，垃圾收集似乎没有被关闭，但我希望 Java 的 GC 至少和 Python 的一样好......你认为这种减速是永久性的，还是会消失在增加循环次数后的某个时候？Jython 在真正长时间运行的进程中应如何表现？

编辑：不幸的是，`java.lang.OutOfMemoryError`如果我将循环数增加到 200 万，我会得到......

（当然，Jython 仍处于测试阶段，因此在最终版本中应该会变得更好。）

我正在使用 Jython 2.5b1 (trunk:5903:5905, Jan 9 2009, 16:01:29), Java(TM) SE Runtime Environment (build 1.6.0_07-b06-153) 和 Java HotSpot(TM) 64-Bit MacOS X 10.5 上的服务器 VM（内部版本 1.6.0_07-b06-57，混合模式）。

感谢您的回答。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T11:42:32.470

这可能是 jython 2.5b1 中的一个错误。您应该考虑将其报告给 jython 团队。我刚刚使用当前稳定版本的 jython (2.2.1) 在我的 MacBook 上运行了 pystone 基准测试，我得到了缓慢但一致的结果：

```
mo$ ~/Coding/Jython/jython2.2.1/jython pystone.py 50000
Pystone(1.1) time for 50000 passes = 2.365
This machine benchmarks at 21141.6 pystones/second

mo$ ~/Coding/Jython/jython2.2.1/jython pystone.py 500000
Pystone(1.1) time for 500000 passes = 22.246
This machine benchmarks at 22476 pystones/second

mo$ ~/Coding/Jython/jython2.2.1/jython pystone.py 1000000
Pystone(1.1) time for 1000000 passes = 43.94
This machine benchmarks at 22758.3 pystones/second

mo$ java -version
java version "1.5.0_16"
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_16-b06-275)
Java HotSpot(TM) Client VM (build 1.5.0_16-132, mixed mode, sharing) 
```

对我来说，cPython 结果或多或少是相同的。我重新进行了 3 次 eacht 测试，并且一直得到非常相似的结果。

我还尝试给 java 一个更大的初始和最大堆（-Xms256m -Xmx512m），但没有值得注意的结果

但是，将 JVM 设置为 -server（启动速度较慢，长时间运行性能更好，对“交互式”工作不太好）使情况有所改变：

```
mo$ ~/Coding/Jython/jython2.2.1/jython pystone.py 50000
Pystone(1.1) time for 50000 passes = 1.848
This machine benchmarks at 27056.3 pystones/second

mo$ ~/Coding/Jython/jython2.2.1/jython pystone.py 500000
Pystone(1.1) time for 500000 passes = 9.998
This machine benchmarks at 50010 pystones/second

mo$ ~/Coding/Jython/jython2.2.1/jython pystone.py 1000000
Pystone(1.1) time for 1000000 passes = 19.9
This machine benchmarks at 50251.3 pystones/second 
```

我使用 (-server -Xms256m -Xmx512m) 进行了最后一次运行：

```
mo$ ~/Coding/Jython/jython2.2.1/jython pystone.py 5000000
Pystone(1.1) time for 5000000 passes = 108.664
This machine benchmarks at 46013.4 pystones/second 
```

我的猜测是，第一次运行缓慢是由于 VM 启动/JIT 尚未真正启动。较长时间运行的结果或多或少是一致的，并显示了热点/JIT 的影响

也许你可以用更大的堆重新运行你的最后一个测试？要更改 JVM 开关，只需编辑 Jython 安装中的 jython 文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T22:58:52.303

我的笔记本电脑运行 Ubuntu Jaunty 的结果与 JRE 1.6.0_12-b04 相同：

```
nathell@breeze:/usr/lib/python2.5/test$ python pystone.py 500000
Pystone(1.1) 500000 次传递的时间 = 12.98
这台机器的基准测试为 38520.8 pystones/秒

nathell@breeze:/usr/lib/python2.5/test$ python pystone.py 1000000
1000000 次传递的 Pystone(1.1) 时间 = 26.05
这台机器的基准测试为 38387.7 pystones/秒

nathell@breeze:/usr/lib/python2.5/test$ ~/jython/jython pystone.py
Pystone(1.1) 50000 次传递的时间 = 2.47788
这台机器的基准测试为 20178.6 pystones/秒

nathell@breeze:/usr/lib/python2.5/test$ ~/jython/jython pystone.py 500000
Pystone(1.1) 500000 次传递的时间 = 19.7294
这台机器的基准测试为 25342.9 pystones/秒

nathell@breeze:/usr/lib/python2.5/test$ ~/jython/jython pystone.py 1000000
Pystone(1.1) 1000000 次传递的时间 = 38.9272
这台机器的基准测试为 25689 pystones/秒

```

所以也许这毕竟与 JRE 而不是 Jython 版本有关。Armed Bear Common Lisp 项目在 JRE 1.6 的早期版本中遇到的问题也可能暗示了这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T14:41:15.980

对像 JVM 一样复杂的运行时环境进行基准测试是很困难的。即使不包括 JIT 和 GC，运行之间也会有很大的堆、内存布局和缓存变化。

对 Jython 有帮助的一件事是在单个 VM 会话中多次运行基准测试：一次用于预热 JIT，一次或多次单独测量。我做了很多 Jython 基准测试，不幸的是，通常需要 10-50 次尝试才能达到合理的时间

您可以使用一些 JVM 标志来观察 GC 和 JIT 行为，以了解预热期应该多长，但显然您不应该在打开调试标志的情况下进行基准测试。例如：

```
% ./jython -J-XX:+PrintCompilation -J-verbose:gc
  1       java.lang.String::hashCode (60 bytes)
  2       java.lang.String::charAt (33 bytes)
  3       java.lang.String::lastIndexOf (156 bytes)
  4       java.lang.String::indexOf (151 bytes)
[GC 1984K->286K(7616K), 0.0031513 secs] 
```

如果您执行所有这些操作并使用 HotSpot Server VM，您会发现 Jython 在 pystone 上比 CPython 稍快，但这绝不代表 Jython 的总体性能。对于 2.5 版本，Jython 开发人员更加关注正确性而不是性能；在接下来的一年左右以 2.6/2.7/3.0 发布的性能将更加强调。[通过查看我运行的一些微基准](http://freya.cs.uiuc.edu/~njriley/plots.html)（最初源自 PyPy），您可以看到一些痛点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T04:54:15.540

我很确定可以通过调整 JVM 配置来改进结果（JRuby 使用了很多有趣的标志来做到这一点），而且我也很确定可以调整垃圾收集。如果您对这个基准非常感兴趣，这里有一个很好的配置 VM 的资源：[Tuning Garbage Collection](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html)。我还要看看 JRuby 配置。

./亚历克斯

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-02T14:44:58.787

我在 XP_Win32_PC 上的长凳：

```
C:\jython\jython2.5b1>bench "50000"

C:\jython\jython2.5b1>jython Lib\test\pystone.py "50000"
Pystone(1.1) time for 50000 passes = 1.73489
This machine benchmarks at 28820.2 pystones/second

C:\jython\jython2.5b1>bench "100000"

C:\jython\jython2.5b1>jython Lib\test\pystone.py "100000"
Pystone(1.1) time for 100000 passes = 3.36223
This machine benchmarks at 29742.2 pystones/second

C:\jython\jython2.5b1>bench "500000"

C:\jython\jython2.5b1>jython Lib\test\pystone.py "500000"
Pystone(1.1) time for 500000 passes = 15.8116
This machine benchmarks at 31622.3 pystones/second

C:\jython\jython2.5b1>bench "1000000"

C:\jython\jython2.5b1>jython Lib\test\pystone.py "1000000"
Pystone(1.1) time for 1000000 passes = 30.9763
This machine benchmarks at 32282.8 pystones/second

C:\jython\jython2.5b1>jython
Jython 2.5b1 (trunk:5903:5905, Jan 9 2009, 16:01:29)
[Java HotSpot(TM) Client VM (Sun Microsystems Inc.)] on java1.5.0_17 
```

它不是那么快，但是......

没有“特效”

是 java-vm 的“问题”吗？

如果您想了解我在这台旧 Win32-PC 上的基准测试的更多信息，请添加评论

# ruby - 如何在 ruby 中做一个安全的连接路径名？

> ID：597488
> 
> 赞同：219
> 
> 时间：2009-02-28T04:25:49.883
> 
> 标签：ruby

我的 Rails 开发环境是基于 Windows 的，而我的生产环境是基于 Linux 的。

可能会使用 VirtualHost。假设需要在`/public`文件夹中引用一个文件名`File.open('/tmp/abc.txt', 'r')`。

—但在 Windows 中应该是`C:\tmp\abc.txt`. 如何进行正确的路径连接以处理两种不同的环境？

```
prefix_tmp_path = '/tmp/'
filename = "/#{rand(10)}.txt"

fullname = prefix_tmp_path + filename # /tmp//1.txt <- but I don't want a double // 
```

当`prefix_tmp_path = "C:\tmp\"`我得到`C:\tmp\/1.txt`

处理这两种情况的正确方法是什么？

* * *

## 回答 #1

> 赞同：376
> 
> 时间：2009-02-28T04:33:38.773

我推荐使用 File.join

```
>> File.join("path", "to", "join")
=> "path/to/join" 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-02-28T04:39:41.830

需要注意的一件事。Ruby 在包括 Windows 在内的所有平台上都使用“/”作为文件分隔符，因此您实际上不需要使用不同的代码将不同平台上的内容连接在一起。“C:/tmp/1.text”应该可以正常工作。

[File.join()](http://www.ruby-doc.org/core/classes/File.html#M002568)是将路径连接在一起的朋友。

```
prefix_tmp_path = 'C:/tmp'
filename = "#{rand(10)}.txt"
fullname = File.join(prefix_tmp_path, filename) # e.g., C:/tmp/3.txt 
```

# perl - 如何将数字与 bash 或 Perl 中的范围进行比较？

> ID：597497
> 
> 赞同：5
> 
> 时间：2009-02-28T04:34:30.393
> 
> 标签：perl, bash, range

如何编写一个数字与范围的比较脚本？

> 1不在2-5之内

或者

> 3在2-5以内

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-28T05:44:27.993

### 它甚至更好`Perl6`。

链式比较运算符：

```
if( 2 <= $x <= 5 ){
} 
```

智能匹配运算符：

```
if( $x ~~ 2..5 ){
} 
```

路口：

```
if( $x ~~ any 2..5 ){
} 
```

给定/当运算符：

```
given( $x ){
  when 2..5 {
  }
  when 6..10 {
  }
  default{
  }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-28T04:38:20.600

在 Perl 中：

```
if( $x >= lower_limit && $x <= upper_limit ) {
   # $x is in the range
}
else {
   # $x is not in the range
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-28T04:42:47.470

在 bash 中：

```
$ if [[ 1 -gt 2 && 1 -lt 5 ]]; then echo "true"; fi
$ if [[ 3 -gt 2 && 1 -lt 5 ]]; then echo "true"; fi
true 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-01T00:57:59.187

Perl 5.10 中也提供了智能[匹配运算符：](http://perl5maven.com/smart-matching-in-perl-5.10)

```
if ( $x ~~ [2..5] ) {
    # do something
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-21T20:27:36.403

在 Bash 中：

```
x=9; p="\<$x\>"; if [[ $(echo {10..20}) =~ $p ]]; then echo true; else echo false; fi 
```

编辑以正确处理以下评论中所述的条件。

```
rangecheck () { local p="\<$1\>"; if [[ $(echo {10..20}) =~ $p ]]; then echo true; else echo false; fi; }
for x in {9..21}; do rangecheck "$x"; done
false
true
.
.
.
true
false 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-09-06T10:34:49.717

test 版本从`[[`Bash 3.0 开始支持正则表达式。

```
[[ 3 =~ ^[2-5]$ ]]; echo $? # 0 
```

如果输入不是数字，则 test 中的数字比较运算符有时会返回错误：

```
[[ 1a -ge 1 ]]; echo $? # value too great for base (error token is "1a")
[[ '$0' -le 24 ]] # syntax error: operand expected (error token is "$o") 
```

您可以测试输入是否为整数`=~`：

```
x=a23; [[ "$x" =~ ^[0-9]+$ && "$x" -ge 1 && "$x" -le 24 ]]; echo $? # 1
x=-23; [[ "$x" =~ ^-?[0-9]+$ && "$x" -ge -100 && "$x" -le -20 ]]; echo $? # 0 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-02T09:49:50.477

在 perl 中

```
grep {/^$number$/} (1..25); 
```

如果数字在范围内，将为您提供真值，否则为假值。

例如：

```
[dsm@localhost:~]$ perl -le 'print "has `$ARGV[0]`" if grep {/^$ARGV[0]$/} (1..25)' 4
has `4`
[dsm@localhost:~]$ perl -le 'print "has `$ARGV[0]`" if grep {/^$ARGV[0]$/} (1..25)' 456
[dsm@localhost:~]$ 
```

# c# - 为什么我的 C# 应用程序中出现内存不足异常？

> ID：597499
> 
> 赞同：30
> 
> 时间：2009-02-28T04:38:30.023
> 
> 标签：c#, memory-management, out-of-memory

我的内存是 4G 物理内存，但是为什么即使我只创建 1.5G 内存对象，我也会出现内存不足异常。任何想法为什么？（我同时看到，在任务管理器的性能选项卡中，内存没有被完全占用，我也可以在这里输入——所以内存实际上并不低，所以我想我遇到了其他一些内存限制）？

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace TestBigMemoryv1
{
    class MemoryHolderFoo
    {
        static Random seed = new Random();
        public Int32 holder1;
        public Int32 holder2;
        public Int64 holder3;

        public MemoryHolderFoo()
        {
            // prevent from optimized out
            holder1 = (Int32)seed.NextDouble();
            holder2 = (Int32)seed.NextDouble();
            holder3 = (Int64)seed.NextDouble();
        }
    }

    class Program
    {
        static int MemoryThreshold = 1500; //M
        static void Main(string[] args)
        {
            int persize = 16;
            int number = MemoryThreshold * 1000 * 1000/ persize;
            MemoryHolderFoo[] pool = new MemoryHolderFoo[number];
            for (int i = 0; i < number; i++)
            {
                pool[i] = new MemoryHolderFoo();
                if (i % 10000 == 0)
                {
                    Console.Write(".");
                }
            }

            return;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-28T04:42:34.350

在普通的 32 位 Windows 应用程序中，进程只有 2GB 的可寻址内存。这与可用的物理内存量无关。

所以 2GB 可用，但 1.5 是您可以分配的最大值。关键是您的代码不是进程中运行的唯一代码。其他 0.5 GB 可能是 CLR 加上过程中的碎片。

**更新：在 .Net 4.5 的 64 位进程中，如果启用了**[gcAllowVeryLargeObjects](http://msdn.microsoft.com/en-us/library/hh285054%28v=vs.110%29.aspx)设置，您可以拥有大型数组：

> 在 64 位平台上，启用总大小大于 2 GB 的阵列。数组中的最大元素数是 UInt32.MaxValue。

```
<configuration>
  <runtime>
    <gcAllowVeryLargeObjects enabled="true" />
  </runtime>
</configuration> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-28T06:36:55.230

只是对其他要点的补充；如果您想访问大量内存，请考虑 x64 - 但请注意最大**单个**对象大小仍为 2GB。而且由于 x64 中的引用更大，这意味着您实际上获得了*更小*的引用类型的最大数组/列表大小。当然，当您达到该限制时，您可能无论如何都做错了！

其他选项：

*   使用文件
*   使用数据库

（显然两者与进程内内存相比都有性能差异）

* * *

更新：在 4.5 之前的 .NET 版本中，最大对象大小为 2GB。从 4.5 开始，如果启用[了 gcAllowVeryLargeObjects](http://msdn.microsoft.com/en-us/library/hh285054%28v=vs.110%29.aspx) ，您可以分配更大的对象。请注意，限制`string`不受影响，但“数组”也应涵盖“列表”，因为列表由数组支持。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-28T05:02:45.643

只是添加到以前的回复中：您可以超越使用 /3Gb [和可选的 userva] 引导标志引导的系统的 2Gb 限制。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-06-26T13:49:35.100

检查您构建的是 64 位进程，而不是 32 位进程，这是 Visual Studio 的默认编译模式。为此，请右键单击您的项目，属性 -> 构建 -> 平台目标：x64。与任何 32 位进程一样，以 32 位编译的 Visual Studio 应用程序具有 2GB 的虚拟内存限制。

每个进程都有自己的虚拟内存，称为地址空间，它将执行的代码和操作的数据映射到其中。32 位进程使用 32 位虚拟内存地址指针，这为 32 位进程可以寻址的虚拟内存量创建了 4GB (2^32) 的绝对上限。但是，操作系统需要一半（引用自己的代码和数据），为每个进程创建了 2GB 的限制。如果您的 32 位应用程序试图消耗超过 2GB 的地址空间，它将返回“System.OutOfMemory”，即使您计算机的物理内存未满。

64 位进程没有此限制，因为它们使用 64 位指针，因此它们的理论最大地址空间为 16 艾字节 (2^64)。实际上，Windows x64 将进程的虚拟内存限制为 8TB。内存限制问题的解决方案是编译为 64 位。

但是，默认情况下，Visual Studio 中对象的大小仍限制为 2GB。您将能够创建多个组合大小大于 2GB 的数组，但默认情况下您不能创建大于 2GB 的数组。希望，如果您仍想创建大于 2GB 的数组，您可以通过将以下代码添加到 app.config 文件来实现：

```
<configuration>
  <runtime>
    <gcAllowVeryLargeObjects enabled="true" />
  </runtime>
</configuration> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-28T04:56:05.207

正如其他海报所提到的，作为 32 位应用程序，您拥有最大 2Gb 的可寻址内存。不要忘记开销。您正在创建一个包含 9300 万个对象的数组——如果每个对象恰好有 4 个字节的开销，那就是额外的 350Mb 内存。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-07-20T00:35:24.413

还有一件事需要注意；一些 .NET 对象需要“连续”内存。即，如果您尝试分配一个大型数组，系统可能不仅需要在您的进程中有足够的空闲内存，而且还需要所有空闲内存都在一个大块中......不幸的是，进程内存会随着时间的推移而碎片化，所以这可能不可用。

有些对象/数据类型有这个要求，有些则没有......我不记得哪些有，但我似乎记得 StringBuilder 和 MemoryStream 有不同的要求。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-28T04:40:43.590

在 32 位 Windows 操作系统上，单个应用程序可以访问的最大“用户模式”内存为 2GB……假设您有 4GB 内存。

[Windows 服务器上非托管 VC++ 应用程序的内存消耗](https://stackoverflow.com/questions/588882/unmanaged-vc-applications-memory-consumption-on-windows-server)

[http://blogs.technet.com/markrussinovich/archive/2008/07/21/3092070.aspx](http://blogs.technet.com/markrussinovich/archive/2008/07/21/3092070.aspx)

（你问这个很有趣，因为我昨天问了几乎同样的事情......）

# sql - Delete From 语句中带有别名的表变量

> ID：597513
> 
> 赞同：41
> 
> 时间：2009-02-28T04:56:50.667
> 
> 标签：sql, sql-server, alias

我想根据同一个表中其他行的存在从 SQL Server 2000/2005 表变量中删除行（如果存在具有相同日期的非 0 计数行，则删除所有 0 计数行）。这是一个简化的示例，应该只删除首先添加的行：

```
declare @O table (
    Month datetime,
    ACount int NULL
)

insert into @O values ('2009-01-01', 0)
insert into @O values ('2009-01-01', 1)
insert into @O values ('2008-01-01', 1)
insert into @O values ('2007-01-01', 0)

delete from @O o1
where ACount = 0
  and exists (select Month from @O o2 where o1.Month = o2.Month and o2.ACount > 0) 
```

问题是我无法让 SQL 服务器接受表变量的 o1 别名（我认为由于“ `o1.Month = o2.Month`”匹配的字段名称而需要别名）。错误是：

> 消息 102，第 15 级，状态 1，第 11 行
> 
> 'o1' 附近的语法不正确。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-02-28T05:05:40.520

**在FROM**语句之前指定别名含义，您正在从别名表中删除。

```
delete o1
from   @O as o1
where  ACount = 0 
       and exists ( select  Month 
                    from    @O o2 
                    where   o1.Month = o2.Month 
                            and o2.ACount > 0) 
```

**结果**

![替代文字](https://farm4.static.flickr.com/3620/3314919075_55def735e5_o.png)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-28T05:09:18.717

试试这个，它应该可以工作（第一个 FROM 是可选的）：

```
DELETE [FROM] @O
FROM @O o1
where ACount = 0
and exists (select Month from @O o2
      where o1.Month = o2.Month and o2.ACount > 0) 
```

基本原理是：DELETE，正如[这里](http://msdn.microsoft.com/en-us/library/aa258847(SQL.80).aspx "有关 DELETE 语句的 MSDN 文章")所解释的，首先需要一个非别名表，一个可选的 FROM 可以在它之前。之后，如果您需要执行 JOIN、子查询等，您可以在第二个 FROM 中的表上放置别名。

# eclipse - JSP 和 Eclipse 的验证问题

> ID：597516
> 
> 赞同：6
> 
> 时间：2009-02-28T05:00:57.317
> 
> 标签：eclipse, validation, jsp

我在 Eclipse 中有这个简单的 JSP 页面，文件中的第一行是：

然而，Eclipse 在此行之前放置了一个黄色警告图标，并带有以下工具提示消息：

> 在这一行找到多个注释：
> - 行断点：index.jsp [line: 1]
> - 标记 (jsp:directive.page) 应该是一个空元素标记。

有人知道为什么是这样吗？

**更新**：

这是我的完整源脚本。这基本上是当我基于 XHTML 模板创建新的 JSP 文件时 Eclipse 为我生成的模板。我只是稍微修改了内容，让它做一些“使用完整”的事情。

我在带有 Geronimo 2.1 插件的 Ubuntu 8.10 上使用 Eclipse 3.4 (eclipse-jee-ganymede-SR1-linux-gtk.tar.gz)（不过我认为这并不重要）。到目前为止，我使用的每个 Eclipse 版本（3.0 及更高版本）都有同样的问题

```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<jsp:useBean id="datetime" class="java.util.Date" />
<html>
    <head>
        <title>Hello Geronimo</title>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    </head>
    <body>
        <div>
            <h1>Hello Apache Geronimo!!!</h1>on ${datetime}
        </div>
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T12:53:41.567

即使对于 JSP 文件，在编辑器中也会发生 DOM 验证的奇怪之处，在[**错误 248963**](https://bugs.eclipse.org/bugs/show_bug.cgi?id=248963)中报告了另一种情况。
预计将在 WTP 3.0.4 和 Ganymede SR2 中解决。

那么您使用的是什么 Eclipse 和 WTP 版本？

当您在初始 jsp 声明下方添加以下行时，您能否检查是否仍然如此：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
  "http://www.w3.org/TR/html4/loose.dtd"> 
```

如[**错误 257258**](https://bugs.eclipse.org/bugs/show_bug.cgi?id=257258)中所述（也在 WTP 3.0.4 和 Ganymede SR2 中修复）：在 WTP3.0.4 之前，此文档类型足以*不显示*您的警告：

[![替代文字](https://i.stack.imgur.com/s3GVv.png)](https://i.stack.imgur.com/s3GVv.png)
[（来源：[eclipsetotale.com](http://www.eclipsetotale.com/img/art7-editeurJSP.png)）]

# c++ - 你如何构建你的比较函数？

> ID：597532
> 
> 赞同：4
> 
> 时间：2009-02-28T05:10:20.727
> 
> 标签：c++, coding-style, language-features, lexicographic, stdtuple

我经常遇到这种情况，尤其是在 C++ 中进行排序时，我正在比较一系列字段以比较更大的结构。一个简化的例子：

```
struct Car{
    Manufacturer make;
    ModelName model;
    Year year;
};

bool carLessThanComparator( const Car & car1, const Car & car2 ){
    if( car1.make < car2.make ){
        return true;
    }else if( car1.make == car2.make ){
        if( car1.model < car2.model ){
            return true;
        }else if( car1.model == car2.model ){
            if( car1.year < car2.year ){
                return true;
            }
        }
    }

    return false;
} 
```

我本能的方法似乎很麻烦，尤其是对于 3 个以上的领域。您将如何在 C++ 中构建这一系列比较？其他语言是否提供更简洁或更优雅的语法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T05:23:01.430

**好吧，如果您的函数在if**子句中遇到 return，则不需要显式**else**，因为它已经退出了。这可以节省“缩进谷”：

```
bool carLessThanComparator( const Car & car1, const Car & car2 ) {
    if( car1.make < car2.make )
        return true;

    if ( car1.make != car2.make )
        return false;

    if( car1.model < car2.model )
        return true;

    if( car1.model != car2.model )
        return false;

    if( car1.year < car2.year )
        return true;

    return false;
} 
```

我也喜欢 MarkusQ 的 LISPish 短路方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T05:43:43.377

如果这种情况经常发生，您可以将这样的模板放入公共标题中：

```
template<typename T, typename A1, typename A2, typename A3>
bool
do_less_than(
        const typename T& t1,
        const typename T& t2,
        const typename A1 typename T::* a1,
        const typename A2 typename T::* a2,
        const typename A3 typename T::* a3)
{
    if ((t1.*a1) < (t2.*a1)) return true;
    if ((t1.*a1) != (t2.*a1)) return false;
    if ((t1.*a2) < (t2.*a2)) return true;
    if ((t1.*a2) != (t2.*a2)) return false;
    return (t1.*a3) < (t2.*a3);
} 
```

根据需要为不同数量的参数添加其他模板。对于每个小于函数，您可以执行以下操作：

```
bool carLessThanComparator(const Car& car1, const Car& car2)
{
    return do_less_than(car1, car2, &Car::make, &Car::model, &Car::year);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-28T14:52:54.650

就我个人而言，我建议不要像我们在这里推荐的那样使用 != 或 == 运算符 - 这要求参数/成员同时具有 less 和 equal 运算符，只是为了检查包含它们的类 - 仅使用操作员越少就足够了，它将为您节省冗余和将来的潜在缺陷。

我建议你写：

```
bool operator<(const Car &car1, const Car &car2) 
{
    if(car1.make < car2.make)
        return true;
    if(car2.make < car1.make)
        return false;

    if(car1.model < car2.model)
        return true;
    if(car2.model < car1.model)
        return false;

    return car1.year < car2.year;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-03-30T21:25:11.807

我知道这是一个老问题，但对于未来的访问者：现代 C++11 解决方案是使用[**std::tie**](http://en.cppreference.com/w/cpp/utility/tuple/tie)

```
struct Car{
    Manufacturer make;
    ModelName model;
    Year year;
};

bool operator<(Car const& lhs, Car const& rhs)
{
    return std::tie(lhs.make, lhs.model, lhs.year) < std::tie(rhs.make, rhs.model, rhs.year);
} 
```

`std::tie`将 struct 转换为 a`std::tuple`以便上述比较运算符委托给`std::tuple::operator<`. 这反过来对成员编组的顺序进行了字典比较`std::tie`。

词典比较的短路方式与该问题的其他解决方案相同。但是，在 C++ lambda 表达式中动态定义就足够简洁了。对于具有私有数据成员的类，最好在类内部定义为`friend`函数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-28T05:17:42.503

```
bool carLessThanComparator( const Car & car1, const Car & car2 ){
    return (
      ( car1.make  < car2.make  ) or (( car1.make  == car2.make  ) and
      ( car1.model < car2.model ) or (( car1.model == car2.model ) and
      ( car1.year  < car2.year  ) 
      ))); 
```

——马库斯

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-28T05:53:08.190

就个人而言，我会覆盖 ==、<、> 和任何其他需要的运算符。这将清理代码，而不是在比较中，而是在您需要进行比较时。对于实际的比较本身，我会用 Crashworks 所说的类似的方式来写。

```
bool operator<(const Car &car1, const Car &car2) {
    if(car1.make < car2.make)
        return true;
    if(car1.make != car2.make)
        return false;
    if(car1.model < car2.model)
        return true;
    if(car1.model != car2.model)
        return false;
    return car1.year < car2.year;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-02-04T06:19:17.773

我想知道和OP一样的事情，偶然发现了这个问题。阅读答案后，我受到 janm 和 RnR 的启发，编写了一个`lexicographicalMemberCompare`仅`operator<`在比较成员上使用的模板函数。它还使用[boost::tuple](http://www.boost.org/doc/libs/release/libs/tuple)以便您可以指定任意数量的成员。这里是：

```
#include <iostream>
#include <string>
#include <boost/tuple/tuple.hpp>

template <class T, class Cons>
struct LessThan
{
    static bool compare(const T& lhs, const T& rhs, const Cons& cons)
    {
        typedef LessThan<T, typename Cons::tail_type> NextLessThan;
        typename Cons::head_type memberPtr = cons.get_head();
        return lhs.*memberPtr < rhs.*memberPtr ?
            true :
            (rhs.*memberPtr < lhs.*memberPtr  ?
                false :
                NextLessThan::compare(lhs, rhs, cons.get_tail()));
    }
};

template <class T>
struct LessThan<T, class boost::tuples::null_type>
{
    static bool compare(const T& lhs, const T& rhs,
                        const boost::tuples::null_type& cons)
    {
        return false;
    }
};

template <class T, class Tuple>
bool lexicographicalMemberCompare(const T& lhs, const T& rhs,
                                  const Tuple& tuple)
{
    return LessThan<T, typename Tuple::inherited>::compare(lhs, rhs, tuple);
}

struct Car
{
    std::string make;
    std::string model;
    int year;
};

bool carLessThanCompare(const Car& lhs, const Car& rhs)
{
    return lexicographicalMemberCompare(lhs, rhs,
        boost::tuples::make_tuple(&Car::make, &Car::model, &Car::year));
}

int main()
{
    Car car1 = {"Ford", "F150", 2009};
    Car car2 = {"Ford", "Escort", 2009};
    std::cout << carLessThanCompare(car1, car2) << std::endl;
    std::cout << carLessThanCompare(car2, car1) << std::endl;
    return 0;
} 
```

希望这对某人有用。

# memory-management - 现代应用程序消耗大量内存是否合理？

> ID：597534
> 
> 赞同：10
> 
> 时间：2009-02-28T05:11:23.457
> 
> 标签：memory-management

Microsoft Outlook 和 Eclipse IDE 等应用程序占用 RAM，高达 200MB。考虑到几年前我们只有 256MB 的 RAM，现代应用程序可以消耗那么多内存吗？另外，为什么会这样？我们是否认为资源是理所当然的？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-28T18:02:45.130

大多数人的 PC 上都有 1 或 2 GB 的 RAM 是否可以接受？

想一想——虽然你的 200mb 很小，而且考虑到 2Gb 的限制，没有什么可担心的，但其他人也有需要大量 RAM 的应用程序。将它们加在一起，您会发现我拥有的 2Gb 很快就用完了。最终结果 - 您的应用程序看起来很慢、资源匮乏并且需要很长时间才能启动。

我认为人们将开始反抗资源匮乏的应用程序，除非他们获得“内存价值”。您可以看到这种情况开始在服务器上发生，因为虚拟化系统越来越受欢迎——人们抱怨资源需求和相应的服务器成本。

作为一个真实的例子，我曾经在我的旧 512Mb 1.7GHz 机器上使用 VC6 进行编码，一切都很好——我可以打开 4 或 5 个副本以及 Outlook、Word 和 Web 浏览器，并且我的机器响应迅速。

今天我有一个带有 3Gb RAM 的双处理器 2.8Ghz 服务器机箱，但实际上我不能运行超过 2 个 Visual Studio 2008 副本，它们都需要很长时间才能启动（因为所有 RAM 仍然需要复制和设置，以及我们现在拥有的所有其他启动成本），甚至 Word 也需要很长时间才能加载文档。

因此，如果您可以减少内存使用量，您应该这样做。不要认为你可以随意使用任何你想要的臃肿的框架/库/实践而不受惩罚。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T05:27:10.343

[http://en.wikipedia.org/wiki/Moore%27s_law](http://en.wikipedia.org/wiki/Moore%27s_law)

还：

[http://en.wikipedia.org/wiki/Wirth%27s_law](http://en.wikipedia.org/wiki/Wirth%27s_law)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-28T05:41:00.247

您需要考虑几件事。

1/你现在有256M**吗**？我不这么认为——我最小的内存机器是 2G，所以 200M 的应用程序不是什么大问题。

2a /您所说的200M可能不是“真实”内存。它可能只是地址空间，在这种情况下，它可能不会一次全部在物理内存中。当您选择做深奥的事情时，一些位可能只会被拉入物理内存。

2b/ 它也可以在其他进程（例如 DLL）之间共享。这意味着它只能作为一个副本保存在物理内存中，但存在于许多进程的地址空间中。这样，使用量就可以在这些许多进程中摊销。2a 和 2b 都取决于您的 200M 数字实际来自哪里（我不知道，并且运行 Linux，如果没有您告诉我，我不太可能找到 :-)。

3/ 即使是物理内存，现代操作系统也不像旧的 DOS 或 Windows 3.1 - 它们有虚拟内存，可以将应用程序的位分页（数据）或完全丢弃（代码，因为它总是可以重新加载从可执行文件）。虚拟内存使您能够使用比实际物理内存更多的内存。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-28T18:11:44.577

许多现代应用程序将利用更多内存的存在来缓存更多。一些像 firefox 和 SQL server 对他们将使用多少内存有明确的设置。在我看来，不使用可用内存是愚蠢的——如果你的应用程序都在 10MB 左右，而 90% 的物理内存未使用，那么拥有 2GB 的 RAM 又有什么意义。当然，如果您的应用程序确实使用了这样的缓存，最好在页面文件抖动开始时释放该内存，或者允许用户手动限制缓存大小。

您可以通过对 SQL Server 运行适当大小的查询来看到这一点的优势。第一次运行查询时，可能需要 10 秒。但是，当您再次运行该精确查询时，只需要不到一秒钟的时间 - 为什么？查询计划仅在第一次编译并缓存以供以后使用。需要读取的数据库页面第一次仅从磁盘加载 - 第二次，它们仍然缓存在 RAM 中。如果操作正确，用于缓存的内存越多（直到遇到分页），您重新访问数据的速度就越快。您会在大型文档中看到同样的情况（例如在 Word 和 Acrobat 中）——当您滚动到文档的新区域时，速度很慢，但一旦渲染和缓存，速度就会加快。如果内存不够，

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-28T19:17:38.740

如果您能很好地利用 RAM，那么使用它是您的*责任*。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-07-24T11:42:10.950

是的，这是完全正常的。由于 256MB 是正常的，所以也发生了很大的变化……而且不要忘记在那之前 640Kb 应该对每个人都足够了！

现在大多数软件解决方案都是用垃圾收集器构建的：C#、Java、Ruby、Python……每个人都喜欢它们，因为开发当然可以更快，但是有一个小故障。

通过手动或自动内存释放，同一程序可以无内存泄漏。但是，在第二种情况下，内存消耗可能会增加。为什么？在第一种情况下，内存被释放并在某些东西变得无用（垃圾）后立即保持清洁。然而，自动检测它需要时间和计算能力，因此大多数收集器（引用计数除外）等待垃圾积累，以使探索成本值得。你等待的时间越长，你可以用一击的代价扫除更多的垃圾，但是需要更多的内存来积累这些垃圾。如果您尝试不断地强制收集器，您的程序将花费更多时间来探索内存而不是解决您的问题。

您可以完全确定，只要程序员获得更多资源，他们就会使用更重的工具来牺牲它们，以换取更多的自由、抽象和更快的开发。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-28T17:50:43.333

几年前 256 MB 是 PC 的标准，然后 Outlook 消耗大约 30 - 35 MB 左右的内存，大约是可用内存的 10%，现在 PC 有 2 GB 或更多作为标准，Outlook 消耗 200 MB 内存，也就是大约 10%。

第一个结论：随着更多内存可用，应用程序会使用更多内存。

第二个结论：无论您选择什么时间框架，都有真正占用内存的应用程序（如 Outlook）和非常高效的内存应用程序。

第三个结论：应用程序的内存消耗不能随着时间的推移而下降，否则即使在今天，640K 也足够了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-28T19:30:13.233

这完全取决于应用程序。

# c# - 如何从 C# 中的列表框索引中检索文本值

> ID：597537
> 
> 赞同：3
> 
> 时间：2009-02-28T05:14:24.120
> 
> 标签：c#, .net, winforms

listbox1.items[0].tostring();

它是在第 0 个索引处获取项目文本值的命令，但我的表单中有一些列表框，这些列表框是绑定到 sql 数据库表的数据。每当我使用此命令时，它都会给我（System.Data.DataRowView）作为字符串作为输出，无论第 0 个索引处的列表框项的实际文本值如何。请指导

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T05:19:32.280

您可以使用 ListItem 的 Text 属性：

```
string itemText = ListBox1.Items[0].Text; 
```

**更新：** 如果您在 WinForms 中，绑定列表框将返回 DataRowView：

```
DataRowView drv = (DataRowView)ListBox1.Items[0];
string itemText = drv.Row["MyColumn"].ToString(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-07-23T06:10:57.817

`.Text`自 2013 年 7 月 23 日起不再工作

采用`ListBox1.Items[index].ToString();`

# c - 如何使用 win32 API 在时区之间进行转换？

> ID：597554
> 
> 赞同：5
> 
> 时间：2009-02-28T05:29:28.607
> 
> 标签：c, windows, winapi

我有日期字符串，例如*2009-02-28 15:40:05 AEDST*并希望将其转换为 SYSTEMTIME 结构。到目前为止，我有：

```
SYSTEMTIME st;
FILETIME ft;
SecureZeroMemory(&st, sizeof(st));
sscanf_s(contents, "%u-%u-%u %u:%u:%u",
    &st.wYear,
    &st.wMonth,
    &st.wDay,
    &st.wHour,
    &st.wMinute,
    &st.wSecond);
// Timezone correction
SystemTimeToFileTime(&st,  &ft);
LocalFileTimeToFileTime(&ft, &ft);
FileTimeToSystemTime(&ft, &st); 
```

但是我的本地时区不是 AEDST。所以我需要能够在转换为 UTC 时指定时区。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T05:38:45.840

看看这个：

[https://web.archive.org/web/20140205072348/http://weseetips.com:80/2008/05/28/how-to-convert-local-system-time-to-utc-or-gmt/](https://web.archive.org/web/20140205072348/http://weseetips.com:80/2008/05/28/how-to-convert-local-system-time-to-utc-or-gmt/)

```
 // Get the local system time.
 SYSTEMTIME LocalTime = { 0 };
 GetSystemTime( &LocalTime );

 // Get the timezone info.
 TIME_ZONE_INFORMATION TimeZoneInfo;
 GetTimeZoneInformation( &TimeZoneInfo );

 // Convert local time to UTC.
 SYSTEMTIME GmtTime = { 0 };
 TzSpecificLocalTimeToSystemTime( &TimeZoneInfo,
                                  &LocalTime,
                                  &GmtTime );

 // GMT = LocalTime + TimeZoneInfo.Bias
 // TimeZoneInfo.Bias is the difference between local time
 // and GMT in minutes. 

 // Local time expressed in terms of GMT bias.
 float TimeZoneDifference = -( float(TimeZoneInfo.Bias) / 60 );
 CString csLocalTimeInGmt;
 csLocalTimeInGmt.Format( _T("%ld:%ld:%ld + %2.1f Hrs"),
                          GmtTime.wHour,
                          GmtTime.wMinute,
                          GmtTime.wSecond,
                          TimeZoneDifference ); 
```

**问题：如何获得特定时区的 TIME_TIMEZONE_INFORMATION？**

不幸的是，你不能用 win32 API 做到这一点。请参阅[MSDN](http://msdn.microsoft.com/en-us/library/ms725481(VS.85).aspx)和[如何在 Win32 中获取特定的 TIME_ZONE_INFORMATION 结构？](https://stackoverflow.com/questions/466071/how-do-i-get-a-specific-timezoneinformation-struct-in-win32)

您要么需要创建一个空变量并手动填充它，要么使用标准 C 时间库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T05:38:22.063

你看过[`TzSpecificLocalTimeToSystemTime`](http://msdn.microsoft.com/en-us/library/ms725485(VS.85).aspx)Win32 API 吗？

# pinvoke - 使用 [Out] StringBuilder / LPTSTR 和多字节字符的 P/Invoke：乱码文本？

> ID：597558
> 
> 赞同：4
> 
> 时间：2009-02-28T05:32:56.057
> 
> 标签：pinvoke, stringbuilder, multibyte, lptstr

* * *

我正在尝试使用 P/Invoke 从非托管 DLL 中获取字符串（以及其他内容），但无论我尝试什么，该字符串都会出现乱码。

我不是本地 Windows 编码器，所以我不确定字符编码位。DLL 设置为使用“多字节字符集”，我无法更改（因为这会破坏其他项目）。我正在尝试添加一个包装函数来从一些现有的类中提取一些数据。有问题的字符串当前作为 CString 存在，我正在尝试将其复制到 LPTSTR，希望将其放入托管的 StringBuilder 中。

这是我所做的，我认为是最接近正确的（显然，我已经删除了不相关的部分）：

```
// unmanaged function
DLLEXPORT void Test(LPTSTR result)
{
  // eval->result is a CString
  _tcscpy(result, (LPCTSTR)eval->result);
} 
```

* * *

```
// in managed code
[DllImport("Test.dll", CharSet = CharSet.Auto)]
static extern void Test([Out] StringBuilder result); 
```

* * *

```
// using it in managed code
StringBuilder result = new StringBuilder();
Test(result);
// contents in result garbled at this point 
```

* * *

```
// just for comparison, this unmanaged consumer of the same function works
LPTSTR result = new TCHAR[100];
Test(result); 
```

非常感谢任何提示！谢谢！！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T06:14:46.563

一个问题是使用`CharSet.Auto`.

在基于 NT 的系统上，这将假定本地 DLL 中的结果参数将使用 Unicode。将其更改为`CharSet.Ansi`，看看你是否能得到更好的结果。

您还需要调整传入的 StringBuilder 缓冲区的大小：

```
StringBuilder result = new StringBuilder(100); // problem if more than 100 characters are returned 
```

此外 - 本机 C 代码使用 ' `TCHAR`' 类型和宏 - 这意味着它可以为 Unicode 构建。如果这可能发生，它会`CharSet`在`DllImportAtribute`某种程度上使情况复杂化 - 特别是如果您不使用`TestA()`/`TestW()`命名约定进行本机导出。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T05:42:29.833

不要使用 out 参数，因为您没有在 c 函数中分配

```
[DllImport("Test.dll", CharSet = CharSet.Auto)]
static extern void Test(StringBuilder result);

StringBuilder result = new StringBuilder(100);
Test(result); 
```

这应该适合你

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T06:15:35.437

你没有描述你的乱码字符串是什么样的。我怀疑您混淆了一些 MBCS 字符串和 UCS-2 字符串（使用 2 字节 wchar_ts）。如果每隔一个字节为 0，那么您正在查看 UCS-2 字符串（并且可能将其误用作 MBCS 字符串）。如果每隔一个字节*都不*是0，那么您可能正在查看 MBCS 字符串（并且可能将其误用作 Unicode 字符串）。

一般来说，我建议不要使用`TCHAR`s（或`LPTSR`s）。`char`他们使用宏魔法在（1 字节）和（2 字节）之间切换`wchar_t`，取决于是否`_UNICODE`为`#define`d。我更喜欢显式使用`chat`并使`wchar_t`代码意图非常清晰。但是，您将需要调用任何使用`TCHAR`参数的 Win32 API 的 -A 或 -W 形式：例如`MessageBoxA()`，或`MessageBoxW()`代替`MessageBox()`（这是一个检查是否`_UNICODE`为`#define`d 的宏。

然后你应该改变`CharSet = CharSet.Auto`一些东西`CharSet = CharSet.Ansi`（如果调用者和被调用者都使用 MBCS）或`CharSet = CharSet.Unicode`（如果调用者和被调用者都使用 UCS-2 Unicode）。但听起来您的 DLL 使用的是 MBCS，而不是 Unicode。

[pinvoke.net](http://www.pinvoke.net/)是一个很棒的 wiki 参考资料，其中包含许多 Win32 API 的 P/Invoke 函数签名示例：

# zend-studio - Zend Studio for Eclipse——运行/调试 PHP 网页不工作

> ID：597559
> 
> 赞同：0
> 
> 时间：2009-02-28T05:33:52.263
> 
> 标签：zend-studio

我正在为 Eclipse 6.1 使用 Zend Studio。

我已经安装了所有的 AMP 堆栈。

但是，当我在 Zend Studio for Eclipse 中加载 ExampleProject 并右键单击脚本，选择 run as-PHP 网页时，出现“找不到页面”错误。

这是我在Eclipse中设置的，

[http://lh6.ggpht.com/_SDci0Pf3tzU/SajMHPj1-9I/AAAAAAAAEjk/itoOfggAuSs/s400/zend%20debugger%20error.jpg](http://picasaweb.google.com/lh/photo/VZNZSaVP6oG3Bhc7HfwJlQ?feat=embedwebsite)

这就是错误。

[http://lh5.ggpht.com/_SDci0Pf3tzU/SajMHIMoCTI/AAAAAAAAEjs/5Oca5QrVPgE/s400/the%20page%20cant%20be%20found.jpg](http://picasaweb.google.com/lh/photo/y9ALHJE9SKSWINRXuWq0jQ?feat=embedwebsite)

但是，当我作为 PHP 脚本运行时，我根本没有遇到任何错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T05:47:45.567

您的 Apache 正在运行，但似乎 URL 与您的服务器公用文件夹不匹配，并且它给您显示的错误，即 404 Page Not Found。

检查您的项目源文件是否在正确的位置，通常在*htdocs*文件夹中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T13:28:52.853

我已经完全弄清楚了如何在 Zend Studio for Eclipse 中调试 PHP 网页。

这是[链接](http://itscommonsensestupid.blogspot.com/2009/02/how-to-debug-php-file-as-webpage-using.html)。

# java - 如何使用 Apache POI 读取 Java 中的 .DOC 文件以将图像与文本分开？

> ID：597566
> 
> 赞同：5
> 
> 时间：2009-02-28T05:41:40.217
> 
> 标签：java, ms-word, apache-poi

我需要从 Java 中读取包含文本和图像的 Word .doc 文件。我需要识别图像和文本并将它们分成 2 个文件。

我最近听说过“Apache POI”。如何使用 Apache POI 读取 Word .doc 文件？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-28T06:07:22.760

apache 网站上的示例和示例代码非常好。我建议你从那里开始。

[http://poi.apache.org/hwpf/quick-guide.html](http://poi.apache.org/hwpf/quick-guide.html)

> 要获取特定的文本位，首先创建一个 org.apache.poi.hwpf.HWPFDocument。使用 getRange() 获取范围，然后从中获取段落。然后，您可以获得文本和其他属性。

[这里](http://svn.apache.org/viewvc/poi/trunk/src/scratchpad/testcases/org/apache/poi/hwpf/TestHWPFPictures.java?view=log)以提取图像为例。 [这](http://svn.apache.org/viewvc/poi/trunk/src/scratchpad/testcases/org/apache/poi/hwpf/TestHWPFPictures.java?revision=712084&view=markup)是撰写本文时的最新版本。

当然，[Javadocs](http://poi.apache.org/apidocs/index.html)

请注意，根据 POI 网站，

> HWPF 仍处于早期开发阶段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T07:34:22.830

它不是免费的（甚至不是便宜的！），但[Aspose.Words](http://www.aspose.com/)应该能够做到这一点。他们的评估下载将让您玩小文件。

目标文件是否也必须是 Docs？您可以在 Office 中打开文档并将它们保存为 HTML。然后分离变得微不足道。RTF 也是一个可行的选择，但我不推荐一个好的 RTF 解析器。

**编辑说：**我只记得另一个可能的解决方案：[Jacob](http://sourceforge.net/projects/jacob-project/)，但您需要在同一台机器上运行的 Office 实例。它是 Java COM Bridge 的缩写，它允许您调用 Office 中的 COM 库来操作文档。我相信它并不像听起来那么可怕！

# python - 如何使用 Python 创建 Windows 服务

> ID：597572
> 
> 赞同：0
> 
> 时间：2009-02-28T05:47:08.330
> 
> 标签：python, windows, service

我真的需要我的 python 程序作为 Windows 服务运行。我怎样才能做到这一点？

# javascript - 如何在 JavaScript 中克隆对象数组？

> ID：597588
> 
> 赞同：537
> 
> 时间：2009-02-28T05:56:26.920
> 
> 标签：javascript

...每个对象还具有对同一数组中其他对象的引用？

当我第一次想到这个问题时，我只是想到了类似的东西

```
var clonedNodesArray = nodesArray.clone() 
```

将存在并搜索有关如何在 JavaScript 中克隆对象的信息。我确实在 Stack Overflow 上找到[了一个问题](https://stackoverflow.com/questions/122102/what-is-the-most-efficent-way-to-clone-a-javascript-object)（由同样的@JohnResig 回答），他指出使用 jQuery 你可以做到

```
var clonedNodesArray = jQuery.extend({}, nodesArray); 
```

克隆一个对象。不过我试过了，这只复制了数组中对象的引用。所以如果我

```
nodesArray[0].value = "red"
clonedNodesArray[0].value = "green" 
```

nodesArray[0] 和 clonedNodesArray[0] 的值都将变成“绿色”。然后我尝试了

```
var clonedNodesArray = jQuery.extend(true, {}, nodesArray); 
```

它深度复制了一个对象，但我分别从[Firebug](https://en.wikipedia.org/wiki/Firebug_%28software%29)和[Opera Dragonfly收到了“](https://en.wikipedia.org/wiki/Opera_Dragonfly)*递归过多*”和“*控制堆栈溢出*”消息。

你会怎么做？这是不应该做的事情吗？在 JavaScript 中是否有可重用的方法？

* * *

## 回答 #1

> 赞同：665
> 
> 时间：2014-05-05T20:19:51.100

### 使用结构化克隆创建深层副本

在 JavaScript 中深度复制数组的现代方法是使用[结构化克隆](https://developer.mozilla.org/en-US/docs/Web/API/structuredClone)：

```
array2 = structuredClone(array1); 
```

但是，此功能相对较新（Chrome 98、Firefox 94），[目前仅对](https://caniuse.com/?search=structuredClone)大约 40% 的用户可用，因此在没有 polyfill 的情况下尚未准备好投入生产。

作为替代方案，您可以使用以下受良好支持的基于 JSON 的解决方案之一。

### 使用 JSON.parse 创建深层副本

一个通用的解决方案可能无法解决对象数组中所有可能的对象。也就是说，如果您的数组包含具有 JSON 可序列化内容的对象（无函数、无`Number.POSITIVE_INFINITY`等），那么以性能为代价避免循环的一种简单方法是这种纯香草单行解决方案。

```
let clonedArray = JSON.parse(JSON.stringify(nodesArray)) 
```

总结下面的评论，这种方法的主要优点是它还克隆了数组的内容，而不仅仅是数组本身。主要缺点是它只能处理 JSON 可序列化内容的限制，并且它的性能比传播方法慢约 30 倍。

如果数组中有浅对象，并且可以接受 IE6，则更好的方法是使用扩展运算符和 .map 数组运算符。对于两层深度的情况（如下面附录中的数组）：

```
clonedArray = nodesArray.map(a => {return {...a}}) 
```

原因有两个：1）它要快得多（参见下面的基准比较），它还允许数组中的任何有效对象。

*附录：性能量化基于将此对象数组克隆一百万次：

```
 [{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic1.jpg?raw=true', id: '1', isFavorite: false}, {url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic2.jpg?raw=true', id: '2', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic3.jpg?raw=true', id: '3', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic4.jpg?raw=true', id: '4', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic5.jpg?raw=true', id: '5', isFavorite: true},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic6.jpg?raw=true', id: '6', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic7.jpg?raw=true', id: '7', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic8.jpg?raw=true', id: '8', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic9.jpg?raw=true', id: '9', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic10.jpg?raw=true', id: '10', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic11.jpg?raw=true', id: '11', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic12.jpg?raw=true', id: '12', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic13.jpg?raw=true', id: '13', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic14.jpg?raw=true', id: '14', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic15.jpg?raw=true', id: '15', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic16.jpg?raw=true', id: '16', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic17.jpg?raw=true', id: '17', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic18.jpg?raw=true', id: '18', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic19.jpg?raw=true', id: '19', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic20.jpg?raw=true', id: '20', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic21.jpg?raw=true', id: '21', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic22.jpg?raw=true', id: '22', isFavorite: false},{url: 'https://github.com/bobziroll/scrimba-react-bootcamp-images/blob/master/pic23.jpg?raw=true', id: '23', isFavorite: false}] 
```

要么使用：

```
let clonedArray = JSON.parse(JSON.stringify(nodesArray)) 
```

或者：

```
clonedArray = nodesArray.map(a => {return {...a}}) 
```

map/spread 方法每次通过需要 0.000466 毫秒，JSON.parse 和 JSON.stringify 每次通过需要 0.014771 毫秒。*

* * *

## 回答 #2

> 赞同：373
> 
> 时间：2016-10-27T11:16:47.533

[我用Object.assign](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)解决了克隆对象数组的问题

```
const newArray = myArray.map(a => Object.assign({}, a)); 
```

甚至更短的[扩展语法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator)

```
const newArray = myArray.map(a => ({...a})); 
```

* * *

## 回答 #3

> 赞同：157
> 
> 时间：2010-11-09T18:05:42.997

如果您只需要一个浅拷贝，那么一个非常简单的方法是：

```
new_array = old_array.slice(0); 
```

* * *

## 回答 #4

> 赞同：122
> 
> 时间：2009-02-28T08:04:16.783

浅拷贝的问题是所有对象都没有被克隆。虽然对每个对象的引用在每个数组中都是唯一的，但一旦您最终抓住它，您将处理与以前相同的对象。您克隆它的方式没有任何问题...使用 Array.slice() 会产生相同的结果。

您的深层副本出现问题的原因是您最终得到了循环对象引用。Deep 会尽可能深，如果你有一个圆圈，它会无限地继续下去，直到浏览器晕倒。

如果数据结构不能表示为有向无环图，那么我不确定您是否能够找到用于深度克隆的通用方法。循环图提供了许多棘手的极端情况，并且由于它不是一种常见的操作，我怀疑是否有人编写了完整的解决方案（如果它甚至可能 - 它可能不是！但我现在没有时间尝试编写严格的证明。）。[我在这个页面](http://www.greywyvern.com/?post=363)上发现了一些关于这个问题的好评论。

如果您需要具有循环引用的对象数组的深层副本，我相信您将不得不编写自己的方法来处理您的专用数据结构，以便它是一个多遍克隆：

1.  在第一轮，克隆所有不引用数组中其他对象的对象。跟踪每个对象的起源。
2.  在第二轮中，将对象连接在一起。

* * *

## 回答 #5

> 赞同：70
> 
> 时间：2017-01-03T09:03:45.703

如果你只需要一个**浅**克隆，最好的克隆方法如下：

使用`...` [ES6](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_%E2%80%93_ECMAScript_2015)扩展运算符。

这是最简单的例子：

```
var clonedObjArray = [...oldObjArray]; 
```

通过这种方式，我们将数组展开为单独的值，并使用 [] 运算符将其放入一个新数组中。

这是一个更长的示例，显示了它的不同工作方式：

```
let objArray = [ {a:1} , {b:2} ];

let refArray = objArray; // this will just point to the objArray
let clonedArray = [...objArray]; // will clone the array

console.log( "before:" );
console.log( "obj array" , objArray );
console.log( "ref array" , refArray );
console.log( "cloned array" , clonedArray );

objArray[0] = {c:3};

console.log( "after:" );
console.log( "obj array" , objArray ); // [ {c:3} , {b:2} ]
console.log( "ref array" , refArray ); // [ {c:3} , {b:2} ]
console.log( "cloned array" , clonedArray ); // [ {a:1} , {b:2} ]
```

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2012-06-22T18:41:09.880

这对我有用：

```
var clonedArray = $.map(originalArray, function (obj) {
                      return $.extend({}, obj);
                  }); 
```

如果您需要数组中对象的深层副本：

```
var clonedArray = $.map(originalArray, function (obj) {
                      return $.extend(true, {}, obj);
                  }); 
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2010-08-04T20:00:42.187

```
$.evalJSON($.toJSON(origArray)); 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2020-03-04T10:56:17.693

如果要实现深度克隆，请使用*JSON.parse(JSON.stringify(your {} or []))*：

```
const myObj ={
    a: 1,
    b: 2,
    b: 3
}

const deepClone = JSON.parse(JSON.stringify(myObj));
deepClone.a = 12;
console.log("deepClone-----"+myObj.a);
const withOutDeepClone = myObj;
withOutDeepClone.a = 12;
console.log("withOutDeepClone----" + myObj.a);
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2018-04-09T13:15:41.513

[Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map)将从旧数组创建一个新数组（不引用旧数组），在地图内创建一个新对象并迭代[属性](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys)（键）并将旧数组对象的值分配给新对象的相应属性。

这将创建完全相同的对象数组。

```
let newArray = oldArray.map(a => {
               let newObject = {};
               Object.keys(a).forEach(propertyKey => {
                    newObject[propertyKey] = a[propertyKey];
               });
               return newObject;
}); 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2018-07-23T07:43:52.483

[Lodash](https://en.wikipedia.org/wiki/Lodash)具有`cloneDeep`用于这些目的的功能：

```
var objects = [{ 'a': 1 }, { 'b': 2 }];
var deep = _.cloneDeep(objects); 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2010-05-31T08:23:15.190

我可能有一个简单的方法来做到这一点，而不必进行痛苦的递归，也不必知道所讨论对象的所有更精细的细节。使用 jQuery，只需使用 jQuery 将您的对象转换为 JSON `$.toJSON(myObjectArray)`，然后获取您的 JSON 字符串并将其评估回​​一个对象。砰！完成了，完成了！问题解决了。:)

```
var oldObjArray = [{ Something: 'blah', Cool: true }];
var newObjArray = eval($.toJSON(oldObjArray)); 
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2013-12-30T23:59:30.543

我正在回答这个问题，因为对于“在 JavaScript 中克隆对象数组”的问题似乎没有一个简单而明确的解决方案：

```
function deepCopy (arr) {
    var out = [];
    for (var i = 0, len = arr.length; i < len; i++) {
        var item = arr[i];
        var obj = {};
        for (var k in item) {
            obj[k] = item[k];
        }
        out.push(obj);
    }
    return out;
}

// test case

var original = [
    {'a' : 1},
    {'b' : 2}
    ];

var copy = deepCopy(original);

// change value in copy
copy[0]['a'] = 'not 1';

// original[0]['a'] still equals 1 
```

此解决方案迭代数组值，迭代对象键，将后者保存到新对象，并将该新对象推送到新数组。

见[jsfiddle](http://jsfiddle.net/bozdoz/ku43m/)。注意：对于数组**中**的对象来说，简单的`.slice()`or`[].concat()`是不够的。

 *** * *

## 回答 #13

> 赞同：8
> 
> 时间：2017-05-04T03:55:48.690

这种方法非常简单，您可以在不修改原始数组的情况下修改您的克隆。

```
// Original Array
let array = [{name: 'Rafael'}, {name: 'Matheus'}];

// Cloning Array
let clone = array.map(a => {return {...a}})

// Editing the cloned array
clone[1].name = 'Carlos';

console.log('array', array)
// [{name: 'Rafael'}, {name: 'Matheus'}]

console.log('clone', clone)
// [{name: 'Rafael'}, {name: 'Carlos'}]
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-02-28T08:53:02.737

正如 Daniel Lew 所提到的，循环图有一些问题。如果我遇到这个问题，我要么`clone()`向有问题的对象添加特殊方法，要么记住我已经复制了哪些对象。

`copyCount`每次复制代码时，我都会使用一个变量增加 1。复制低于`copyCount`当前复制过程的对象。如果不是，则应该引用已经存在的副本。这使得有必要从原件链接到其副本。

还有一个问题：内存。如果您有从一个对象到另一个对象的此引用，则浏览器很可能无法释放这些对象，因为它们总是从某个地方引用。您必须进行第二次通过，将所有复制引用设置为 Null。（如果你这样做，你不必有 a`copyCount`但一个布尔值`isCopied`就足够了，因为你可以在第二遍中重置该值。）

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2012-12-20T08:33:56.500

jQuery 扩展工作正常。您只需要指定您正在克隆一个数组而不是一个对象（**注意 [] 而不是 {} 作为扩展方法的参数**）：

```
var clonedNodesArray = jQuery.extend([], nodesArray); 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2012-10-28T17:20:23.760

我的做法：

```
var temp = { arr : originalArray };
var obj = $.extend(true, {}, temp);
return obj.arr; 
```

给了我一个很好的、干净的、原始数组的深层克隆——没有一个对象引用回原来的:-)

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-02-28T07:07:44.487

[Array.slice](http://www.devguru.com/Technologies/Ecmascript/Quickref/Slice.html)可用于复制数组或数组的一部分...

这适用于字符串和数字 .. - 更改一个数组中的字符串不会影响另一个数组 - 但对象仍然只是通过引用复制，因此对一个数组中引用对象的更改会对另一个数组产生影响。

这是一个可能对此有用的 JavaScript 撤消管理器示例：[http ://www.ridgway.co.za/archive/2007/11/07/simple-javascript-undo-manager-for-dtos.aspx](http://www.ridgway.co.za/archive/2007/11/07/simple-javascript-undo-manager-for-dtos.aspx)

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2012-01-10T11:21:55.843

忘记 eval()（它是 JavaScript 中被滥用最多的特性，使代码变慢）和 slice(0)（仅适用于简单数据类型）

这对我来说是最好的解决方案：

```
Object.prototype.clone = function() {
  var myObj = (this instanceof Array) ? [] : {};
  for (i in this) {
    if (i != 'clone') {
        if (this[i] && typeof this[i] == "object") {
          myObj[i] = this[i].clone();
        }
        else
          myObj[i] = this[i];
    }
  }
  return myObj;
}; 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2012-06-04T17:46:54.667

我对这个问题感到非常沮丧。显然，当您将通用数组发送到 $.extend 方法时，就会出现问题。因此，为了修复它，我添加了一个小检查，它可以完美地与泛型数组、jQuery 数组和任何对象配合使用。

```
jQuery.extend({
    deepclone: function(objThing) {
        // return jQuery.extend(true, {}, objThing);
        /// Fix for arrays, without this, arrays passed in are returned as OBJECTS! WTF?!?!
        if ( jQuery.isArray(objThing) ) {
            return jQuery.makeArray( jQuery.deepclone($(objThing)) );
        }
        return jQuery.extend(true, {}, objThing);
    },
}); 
```

调用使用：

```
var arrNewArrayClone = jQuery.deepclone(arrOriginalArray);
// Or more simply/commonly
var arrNewArrayClone = $.deepclone(arrOriginalArray); 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2016-10-03T22:38:31.073

这会深度复制数组、对象、null 和其他标量值，并且还深度复制非本机函数上的任何属性（这很不常见但可能）。（为了提高效率，我们不会尝试在数组上复制非数字属性。）

```
function deepClone (item) {
  if (Array.isArray(item)) {
    var newArr = [];
    for (var i = item.length; i-- > 0;) {
      newArr[i] = deepClone(item[i]);
    }
    return newArr;
  }
  if (typeof item === 'function' && !(/\(\) \{ \[native/).test(item.toString())) {
    var obj;
    eval('obj = '+ item.toString());
    for (var k in item) {
      obj[k] = deepClone(item[k]);
    }
    return obj;
  }
  if (item && typeof item === 'object') {
    var obj = {};
    for (var k in item) {
      obj[k] = deepClone(item[k]);
    }
    return obj;
  }
  return item;
} 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2017-08-23T11:08:44.857

我使用新的 ECMAScript 6 [Object.assign](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)方法：

```
let oldObject = [1, 3, 5, "test"];
let newObject = Object.assign({}, oldObject); 
```

此方法的第一个参数是要更新的数组。我们传递一个空对象，因为我们想要一个新对象。

我们也可以使用这种语法，它相同但更短：

```
let newObject = [...oldObject]; 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2019-05-23T05:26:04.277

在 JavaScript 中，数组和对象副本会更改原始值，因此*深层*副本是解决此问题的方法。

**深拷贝意味着实际上创建一个新数组并复制值，因为它发生的任何事情都不会影响原始数组。**

`JSON.parse`并且`JSON.stringify`是*深度*复制的最佳和简单的方法。该`JSON.stringify()`方法将 JavaScript 值转换为`JSON.parse()`JSON 字符串。该方法解析 JSON 字符串，构造字符串描述的 JavaScript 值或对象。

**深度克隆**

```
let a = [{ x:{z:1} , y: 2}];
let b = JSON.parse(JSON.stringify(a));
b[0].x.z=0

console.log(JSON.stringify(a)); //[{"x":{"z":1},"y":2}]
console.log(JSON.stringify(b)); // [{"x":{"z":0},"y":2}] 
```

更多详情：[阅读这里](https://medium.com/@gamshan001/javascript-deep-copy-for-array-and-object-97e3d4bc401a)

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2012-04-02T23:29:22.253

使用 jQuery：

```
var target = [];
$.each(source, function() {target.push($.extend({}, this));}); 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2016-06-16T12:55:42.947

我们可以发明一种简单的递归数组方法来克隆多维数组。虽然嵌套数组中的对象保持对源数组中相应对象的引用，但数组不会。

```
Array.prototype.clone = function(){
  return this.map(e => Array.isArray(e) ? e.clone() : e);
};

var arr = [ 1, 2, 3, 4, [ 1, 2, [ 1, 2, 3 ], 4 , 5], 6 ],
    brr = arr.clone();
brr[4][2][1] = "two";
console.log(JSON.stringify(arr));
console.log(JSON.stringify(brr));
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2021-06-04T07:20:04.140

我正在使用[Vue.js](https://en.wikipedia.org/wiki/Vue.js)，因此数组/对象为 Vue.js 功能附加了其他代码。我尝试了许多给出的答案，但最终我使用了[clone-deep](https://www.npmjs.com/package/clone-deep)。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2013-03-24T20:46:04.893

以下代码将递归地执行[对象和数组的深层复制：](http://james.padolsey.com/javascript/deep-copying-of-objects-and-arrays/)

```
function deepCopy(obj) {
    if (Object.prototype.toString.call(obj) === '[object Array]') {
        var out = [], i = 0, len = obj.length;
        for ( ; i < len; i++ ) {
            out[i] = arguments.callee(obj[i]);
        }
        return out;
    }
    if (typeof obj === 'object') {
        var out = {}, i;
        for ( i in obj ) {
            out[i] = arguments.callee(obj[i]);
        }
        return out;
    }
    return obj;
} 
```

[来源](http://james.padolsey.com/javascript/deep-copying-of-objects-and-arrays/)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2017-03-21T00:54:11.950

在 JavaScript 中进行深度克隆的一些优雅方法：

*   *[类型：对象](https://mootools.net/core/docs/1.6.0/Types/Object)*

*   *[在 JavaScript 中复制对象](https://scotch.io/bar-talk/copying-objects-in-javascript)*

1.  用于克隆对象的普通 JavaScript 方法

2.  巧妙利用 JSON 库深度克隆对象

3.  使用 jQuery 的*$.extend()*函数

4.  使用[Mootools](https://en.wikipedia.org/wiki/MooTools)的*clone()*函数克隆对象

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2019-09-13T10:54:01.443

这是我的解决方案。它适用于对象数组或地图。该解决方案也保留了这些方法。

深拷贝意味着实际上创建一个新数组并复制值，因为它发生的任何事情都不会影响原始数组。

这对我来说是最好的解决方案：

```
deepCopy(inputObj: any) {
    var newObj = inputObj;
    if (inputObj && typeof inputObj === "object") {
        newObj = Object.prototype.toString.call(inputObj) === "[object Array]" ? [] : {};
        for (var i in inputObj) {
            newObj[i] = this.deepCopy(inputObj[i]);
        }

        //For maps
        if(Object.prototype.toString.call(inputObj) === "[object Map]"){
            newObj = new Map;
            inputObj.forEach((v,k) =>{
                newObj.set(k,this.deepCopy(v));
            });
        }
    }
    return newObj;
} 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2019-12-11T18:31:12.120

```
person1 = {
    name: 'Naved',
    last: 'Khan',
    clothes: {
        jens: 5,
        shirts: 10
    }
};

person2 = {
    name: 'Naved',
    last: 'Khan'
};

// first way  shallow copy single lavel copy 
// const person3 = { ...person1 };

// secound way shallow copy single lavel copy
// const person3 = Object.assign({}, person1);

// third  way shallow copy single lavel copy but old 
// const person3 = {};
// for (let key in person1) {
//  person3[key] = person1[key];
// }

// deep copy with array and object best way
const person3 = JSON.parse(JSON.stringify(person1));

    person3.clothes.jens = 20;

console.log(person1);
console.log(person2);
console.log(person3); 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2015-06-04T14:24:02.397

我想我设法编写了一种通用方法，主要使用`Object.create`所有现代浏览器都支持的深度克隆任何 JavaScript 结构。代码是这样的：

```
function deepClone (item) {
  if (Array.isArray(item)) {
    var newArr = [];

    for (var i = item.length; i-- !== 0;) {
      newArr[i] = deepClone(item[i]);
    }

    return newArr;
  }
  else if (typeof item === 'function') {
    eval('var temp = '+ item.toString());
    return temp;
  }
  else if (typeof item === 'object')
    return Object.create(item);
  else
    return item;
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-02-01T16:47:05.613

对于克隆对象，我只是建议 ECMAScript 6 `reduce()`：

```
const newArray = myArray.reduce((array, element) => array.push(Object.assign({}, element)), []); 
```

但坦率地说，我更喜欢[恐龙的答案](https://stackoverflow.com/questions/597588/how-do-you-clone-an-array-of-objects-in-javascript/40283265#40283265)。我只是把这个版本放在这里作为另一种选择，但我个人会按照`map()`dinodsaurus 的建议使用。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2017-02-10T10:18:52.240

如果你有[Underscore.js](https://en.wikipedia.org/wiki/Underscore.js)或[Babel](https://en.wikipedia.org/wiki/Babel_(transcompiler))，这里是深度克隆数组的不同方法的基准。

[https://jsperf.com/object-rest-spread-vs-clone/2](https://jsperf.com/object-rest-spread-vs-clone/2)

看起来 Babel 是最快的。

```
var x = babel({}, obj) 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2018-02-13T19:05:44.570

```
function deepCloneArray(array) {
    return Array.from(Object.create(array));
} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2018-03-18T07:45:36.410

```
var game_popularity = [
     { game: "fruit ninja", popularity: 78 },
     { game: "road runner", popularity: 20 },
     { game: "maze runner", popularity: 40 },
     { game: "ludo", popularity: 75 },
     { game: "temple runner", popularity: 86 }
];
console.log("sorted original array before clonning");
game_popularity.sort((a, b) => a.popularity < b.popularity);
console.log(game_popularity);

console.log("clone using object assign");
const cl2 = game_popularity.map(a => Object.assign({}, a));
cl2[1].game = "clash of titan";
cl2.push({ game: "logan", popularity: 57 });
console.log(cl2);

// Adding new array element doesnt reflect in original array
console.log("clone using concat");
var ph = []
var cl = ph.concat(game_popularity);

// Copied by reference ?
cl[0].game = "rise of civilization";

game_popularity[0].game = 'ping me';
cl.push({ game: "angry bird", popularity: 67 });
console.log(cl);

console.log("clone using ellipses");
var cl3 = [...game_popularity];
cl3.push({ game: "blue whale", popularity: 67 });
cl3[2].game = "harry potter";
console.log(cl3);

console.log("clone using json.parse");
var cl4 = JSON.parse(JSON.stringify(game_popularity));
cl4.push({ game: "home alone", popularity: 87 });
cl4[3].game ="lockhead martin";
console.log(cl4);

console.log("clone using Object.create");
var cl5 = Array.from(Object.create(game_popularity));
cl5.push({ game: "fish ville", popularity: 87 });
cl5[3].game ="veto power";
console.log(cl5);

// Array function
console.log("sorted original array after clonning");
game_popularity.sort((a, b) => a.popularity < b.popularity);
console.log(game_popularity);

console.log("Object.assign deep clone object array");
console.log("json.parse deep clone object array");
console.log("concat does not deep clone object array");
console.log("ellipses does not deep clone object array");
console.log("Object.create does not deep clone object array"); 
```

### 输出

```
sorted original array before clonning
[ { game: 'temple runner', popularity: 86 },
{ game: 'fruit ninja', popularity: 78 },
{ game: 'ludo', popularity: 75 },
{ game: 'maze runner', popularity: 40 },
{ game: 'road runner', popularity: 20 } ]
clone using object assign
[ { game: 'temple runner', popularity: 86 },
{ game: 'clash of titan', popularity: 78 },
{ game: 'ludo', popularity: 75 },
{ game: 'maze runner', popularity: 40 },
{ game: 'road runner', popularity: 20 },
{ game: 'logan', popularity: 57 } ]
clone using concat
[ { game: 'ping me', popularity: 86 },
{ game: 'fruit ninja', popularity: 78 },
{ game: 'ludo', popularity: 75 },
{ game: 'maze runner', popularity: 40 },
{ game: 'road runner', popularity: 20 },
{ game: 'angry bird', popularity: 67 } ]
clone using ellipses
[ { game: 'ping me', popularity: 86 },
{ game: 'fruit ninja', popularity: 78 },
{ game: 'harry potter', popularity: 75 },
{ game: 'maze runner', popularity: 40 },
{ game: 'road runner', popularity: 20 },
{ game: 'blue whale', popularity: 67 } ]
clone using json.parse
[ { game: 'ping me', popularity: 86 },
{ game: 'fruit ninja', popularity: 78 },
{ game: 'harry potter', popularity: 75 },
{ game: 'lockhead martin', popularity: 40 },
{ game: 'road runner', popularity: 20 },
{ game: 'home alone', popularity: 87 } ]
clone using Object.create
[ { game: 'ping me', popularity: 86 },
{ game: 'fruit ninja', popularity: 78 },
{ game: 'harry potter', popularity: 75 },
{ game: 'veto power', popularity: 40 },
{ game: 'road runner', popularity: 20 },
{ game: 'fish ville', popularity: 87 } ]
sorted original array after clonning
[ { game: 'ping me', popularity: 86 },
{ game: 'fruit ninja', popularity: 78 },
{ game: 'harry potter', popularity: 75 },
{ game: 'veto power', popularity: 40 },
{ game: 'road runner', popularity: 20 } ]

Object.assign deep clone object array
json.parse deep clone object array
concat does not deep clone object array
ellipses does not deep clone object array
Object.create does not deep clone object array 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2021-10-07T20:49:26.583

**最简洁的浅拷贝解决方案：**

```
array = array.map(obj => {
    return { ...obj };
}); 
```

这将制作一个完全独立的副本，例如`[{a: 1}, {b: 2}]`，但不是`[{a: {b: 2}}, {b: {a: 1}}]`。

# c# - C# 线程模式 - 这是个好主意吗？

> ID：597590
> 
> 赞同：3
> 
> 时间：2009-02-28T05:57:31.847
> 
> 标签：c#, .net, multithreading

我今天在玩我的一个项目，发现了一个有趣的小片段，鉴于以下模式，您可以安全地清理线程，即使它被强制提前关闭。我的项目是一个网络服务器，它为每个客户端生成一个新线程。我发现这对于从远程端提前终止很有用，但也从本地端（我可以`.Abort()`从我的处理代码内部调用）。

您对此是否有任何问题，或者您会对任何寻求类似方法的人提出任何建议？

测试用例如下：

* * *

```
using System;
using System.Threading;

class Program
{
    static Thread t1 = new Thread(thread1);
    static Thread t2 = new Thread(thread2);

    public static void Main(string[] args)
    {
        t1.Start();
        t2.Start();
        t1.Join();
    }

    public static void thread1() {
        try {
            // Do our work here, for this test just look busy.
            while(true) {
                Thread.Sleep(100);
            }
        } finally {
            Console.WriteLine("We're exiting thread1 cleanly.\n");
            // Do any cleanup that might be needed here.
        }
    }

    public static void thread2() {
        Thread.Sleep(500);
        t1.Abort();
    }
} 
```

作为参考，如果没有 try/finally 块，线程就会像预期的那样死掉。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-28T06:52:47.097

除非整个应用程序停止运行，否则中止另一个线程只是一个坏主意。让您的程序处于未知状态太容易了。中止*自己的*线程有时很有用——`ThreadAbortException`例如，如果你想提前结束响应，ASP.NET 会抛出一个——但这不是一个非常好的设计。

线程的安全清理应该是相互的——应该有一些共享标志*请求*线程关闭。线程应定期检查该标志并适当退出。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-28T06:08:01.213

不幸的是，这是否会“安全地”清理线程无法从一般代码示例中辨别出来。它高度依赖于线程内执行的实际代码。您必须考虑多个问题。每个都代表代码中的一个潜在错误。

1.  如果线程当前在本机代码中，它不会立即尊重 Thread.Abort 调用。它将在本机代码中完成它想做的所有工作，并且在代码返回托管之前不会抛出。在这种情况发生之前，thread2 将挂起。
2.  在 finally 块中未释放的任何本机资源都将在这种情况下泄漏。所有本机资源都应在 finally 块中释放，但并非所有代码都这样做，这是一个需要考虑的问题。
3.  任何未在 finally 块中释放的锁都将保持锁定状态，并可能导致未来的死锁。

目前还有其他一些问题在我脑海中闪过。但希望这将为您的申请提供一些指导。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T18:39:31.730

中止线程通常不是一个好主意。您可以做的是轮询可以从其他线程设置的 stopRequested 标志。下面是一个示例 WorkerThread 类供您参考。有关如何使用它的更多信息，请参阅[http://devpinoy.org/blogs/jakelite/archive/2008/12/20/threading-patterns-the-worker-thread-pattern.aspx](http://devpinoy.org/blogs/jakelite/archive/2008/12/20/threading-patterns-the-worker-thread-pattern.aspx)

```
public abstract class WorkerThreadBase : IDisposable
{
    private Thread _workerThread;
    protected internal ManualResetEvent _stopping;
    protected internal ManualResetEvent _stopped;
    private bool _disposed;
    private bool _disposing;
    private string _name;

    protected WorkerThreadBase()
        : this(null, ThreadPriority.Normal)
    {
    }

    protected WorkerThreadBase(string name)
        : this(name, ThreadPriority.Normal)
    {
    }

    protected WorkerThreadBase(string name,
        ThreadPriority priority)
        : this(name, priority, false)
    {
    }

    protected WorkerThreadBase(string name,
        ThreadPriority priority,
        bool isBackground)
    {
        _disposing = false;
        _disposed = false;
        _stopping = new ManualResetEvent(false);
        _stopped = new ManualResetEvent(false);

        _name = name == null ? GetType().Name : name; ;
        _workerThread = new Thread(threadProc);
        _workerThread.Name = _name;
        _workerThread.Priority = priority;
        _workerThread.IsBackground = isBackground;
    }

    protected bool StopRequested
    {
        get { return _stopping.WaitOne(1, true); }
    }

    protected bool Disposing
    {
        get { return _disposing; }
    }

    protected bool Disposed
    {
        get { return _disposed; }
    }

    public string Name
    {
        get { return _name; }            
    }   

    public void Start()
    {
        ThrowIfDisposedOrDisposing();
        _workerThread.Start();
    }

    public void Stop()
    {
        ThrowIfDisposedOrDisposing();
        _stopping.Set();
        _stopped.WaitOne();
    }

    public void WaitForExit()
    {
        ThrowIfDisposedOrDisposing();            
        _stopped.WaitOne();
    }

    #region IDisposable Members

    public void Dispose()
    {
        dispose(true);
    }

    #endregion

    public static void WaitAll(params WorkerThreadBase[] threads)
    { 
        WaitHandle.WaitAll(
            Array.ConvertAll<WorkerThreadBase, WaitHandle>(
                threads,
                delegate(WorkerThreadBase workerThread)
                { return workerThread._stopped; }));
    }

    public static void WaitAny(params WorkerThreadBase[] threads)
    {
        WaitHandle.WaitAny(
            Array.ConvertAll<WorkerThreadBase, WaitHandle>(
                threads,
                delegate(WorkerThreadBase workerThread)
                { return workerThread._stopped; }));
    }

    protected virtual void Dispose(bool disposing)
    {
        //stop the thread;
        Stop();

        //make sure the thread joins the main thread
        _workerThread.Join(1000);

        //dispose of the waithandles
        DisposeWaitHandle(_stopping);
        DisposeWaitHandle(_stopped);
    }

    protected void ThrowIfDisposedOrDisposing()
    {
        if (_disposing)
        {
            throw new InvalidOperationException(
                Properties.Resources.ERROR_OBJECT_DISPOSING);
        }

        if (_disposed)
        {
            throw new ObjectDisposedException(
                GetType().Name,
                Properties.Resources.ERROR_OBJECT_DISPOSED);
        }
    }

    protected void DisposeWaitHandle(WaitHandle waitHandle)
    {
        if (waitHandle != null)
        {
            waitHandle.Close();
            waitHandle = null;
        }
    }

    protected abstract void Work();

    private void dispose(bool disposing)
    {
        //do nothing if disposed more than once
        if (_disposed)
        {
            return;
        }

        if (disposing)
        {
            _disposing = disposing;

            Dispose(disposing);

            _disposing = false;
            //mark as disposed
            _disposed = true;
        }
    }

    private void threadProc()
    {
        Work();
        _stopped.Set();
    }        
} 
```

# .net - 在我的 WPF 项目安装程序中，如何捆绑 .NET3.5 安装程序？

> ID：597594
> 
> 赞同：2
> 
> 时间：2009-02-28T06:01:02.213
> 
> 标签：.net, wpf, windows, installation

我开发了一些 WPF 项目，但遇到了一个非常严重的问题。如您所知，.Net 3.5 安装很痛苦（巨大且依赖互联网访问）。这是我们发货时的问题。有没有办法只捆绑重新分发部分？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T06:09:32.427

是的，您可以将 3.5 可再发行组件链接到您的应用程序安装程序中。MSDN 上的此页面详细介绍了实现此目标所需的所有工作

[http://msdn.microsoft.com/en-us/library/cc160716.aspx](http://msdn.microsoft.com/en-us/library/cc160716.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T05:25:31.323

哇，我不会那样做的。它会使您的安装程序膨胀，因此已经拥有 3.5 的人将在应用程序下载时受到惩罚。

只需将安装程序设置为需要 3.5 作为先决条件，如果某些用户缺少它，他们只会在安装应用程序期间下载它。

# html - 您如何克服 HTML 表单嵌套限制？

> ID：597596
> 
> 赞同：208
> 
> 时间：2009-02-28T06:01:35.270
> 
> 标签：html, forms, nested

我知道 XHTML 不支持嵌套表单标签，并且我已经在 Stack Overflow 上阅读了有关此主题的其他答案，但我仍然没有找到解决问题的优雅方法。

有人说你不需要它，他们想不出一个场景是需要它的。好吧，就我个人而言，我想不出我不需要它的*场景*。

让我们看一个非常简单的例子：

您正在制作一个博客应用程序，并且您有一个包含一些用于创建新帖子的字段的表单和一个带有“保存”、“删除”、“取消”等“操作”的工具栏。

```
<form
 action="/post/dispatch/too_bad_the_action_url_is_in_the_form_tag_even_though_conceptually_every_submit_button_inside_it_may_need_to_post_to_a_diffent_distinct_url"
method="post">

    <input type="text" name="foo" /> <!-- several of those here -->
    <div id="toolbar">
        <input type="submit" name="save" value="Save" />
        <input type="submit" name="delete" value="Delete" />
        <a href="/home/index">Cancel</a>
    </div>
</form> 
```

*我们的目标是以一种不需要 JavaScript*的方式编写表单，只需要普通的旧 HTML 表单和提交按钮。

由于操作 URL 是在 Form 标记中定义的，而不是在每个单独的提交按钮中，我们唯一的选择是发布到通用 URL，然后启动“if...then...else”来确定按钮的名称已提交。不是很优雅，但我们唯一的选择，因为我们不想依赖 JavaScript。

唯一的问题是按下“删除”，将提交服务器上的所有表单字段，即使此操作唯一需要的是带有 post-id 的隐藏输入。在这个小例子中没什么大不了的，但是我的[LOB](http://en.wikipedia.org/wiki/Line_of_business)应用程序中有数百个（可以这么说）字段和选项卡的表单（由于要求）必须一次性提交所有内容，无论如何这似乎非常低效和浪费。如果支持表单嵌套，我至少可以将“删除”提交按钮包装在它自己的表单中，只有 post-id 字段。

您可能会说“只需将“删除”作为链接而不是提交来实现”。这在很多层面上都是错误的，但最重要的是因为像这里的“删除”这样的副作用操作永远不应该是 GET 请求。

所以我的问题（特别是对于那些说他们不需要嵌套的人）是你做什么？有没有我遗漏的优雅解决方案，或者底线真的是“要么需要 JavaScript，要么提交所有内容”？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2011-12-05T01:53:07.367

我知道这是一个老问题，但 HTML5 提供了几个新选项。

`form`第一种是在标记中将表单与工具栏分开，为删除操作添加另一个表单，并使用该属性将工具栏中的按钮与其各自的表单相关联。

```
<form id="saveForm" action="/post/dispatch/save" method="post">
    <input type="text" name="foo" /> <!-- several of those here -->  
</form>
<form id="deleteForm" action="/post/dispatch/delete" method="post">
    <input type="hidden" value="some_id" />
</form>
<div id="toolbar">
    <input type="submit" name="save" value="Save" form="saveForm" />
    <input type="submit" name="delete" value="Delete" form="deleteForm" />
    <a href="/home/index">Cancel</a>
</div> 
```

此选项非常灵活，但原帖也提到可能需要使用单个表单执行不同的操作。HTML5 再次来拯救。您可以`formaction`在提交按钮上使用该属性，因此同一表单中的不同按钮可以提交到不同的 URL。这个例子只是在表单外部的工具栏上添加了一个克隆方法，但它在表单中嵌套的工作方式相同。

```
<div id="toolbar">
    <input type="submit" name="clone" value="Clone" form="saveForm"
           formaction="/post/dispatch/clone" />
</div> 
```

[http://www.whatwg.org/specs/web-apps/current-work/#attributes-for-form-submission](http://www.whatwg.org/specs/web-apps/current-work/#attributes-for-form-submission)

这些新功能的优势在于它们以声明方式完成所有这些操作，而无需 JavaScript。缺点是旧浏览器不支持它们，因此您必须为旧浏览器做一些 polyfill。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-02-28T06:24:03.703

我将完全按照您的描述实现这一点：将所有内容提交到服务器并执行一个简单的 if/else 来检查单击了哪个按钮。

然后我将实现一个绑定到表单的 onsubmit 事件的 Javascript 调用，该事件将在表单提交之前进行检查，并且仅将相关数据提交到服务器（可能通过页面上的第二个表单，其 ID 需要处理为隐藏的输入，或使用您需要作为 GET 请求传递的数据刷新页面位置，或向服务器执行 Ajax 发布，或...）。

这样，没有 Javascript 的人可以很好地使用表单，但是服务器负载被抵消了，因为有 Javascript 的人只提交了所需的单条数据。让自己专注于只支持一个或另一个确实会不必要地限制您的选择。

或者，如果你在公司防火墙或其他东西后面工作，并且每个人都禁用了 Javascript，你可能想要做两个表单并使用一些 CSS 魔法，让它看起来像删除按钮是第一个表单的一部分。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-28T06:35:23.627

您可以在页面上并排放置表单，但不能嵌套。然后使用 CSS 让所有的按钮排列整齐？

```
<form method="post" action="delete_processing_page">
   <input type="hidden" name="id" value="foo" />
   <input type="submit" value="delete" class="css_makes_me_pretty" />
</form>

<form method="post" action="add_edit_processing_page">
   <input type="text" name="foo1"  />
   <input type="text" name="foo2"  />
   <input type="text" name="foo3"  />
   ...
   <input type="submit" value="post/edit" class="css_makes_me_pretty" />
</form> 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2010-05-13T22:05:37.700

HTML5 有一个“表单所有者”的概念——输入元素的“表单”属性。它允许模拟嵌套表单并解决问题。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2012-12-06T08:29:08.883

有点老话题，但这可能对某人有用：

正如上面提到的那样-您可以使用虚拟表格。前段时间我不得不克服这个问题。起初，我完全忘记了这个 HTML 限制，只是添加了嵌套表单。结果很有趣——我从嵌套中丢失了我的第一个表单。然后，在实际嵌套表单之前简单地添加一个虚拟表单（将从浏览器中删除）被证明是某种“技巧”。

就我而言，它看起来像这样：

```
<form id="Main">
  <form></form> <!--this is the dummy one-->
  <input...><form id="Nested 1> ... </form>
  <input...><form id="Nested 1> ... </form>
  <input...><form id="Nested 1> ... </form>
  <input...><form id="Nested 1> ... </form>
  ......
</form> 
```

适用于 Chrome、Firefox 和 Safari。IE 最多 9 个（不确定大约 10 个）并且 Opera 不检测主窗体中的参数。$_REQUEST 全局为空，无论输入如何。内部形式似乎在任何地方都可以正常工作。

尚未测试此处描述的另一个建议 - 嵌套表单周围的字段集。

**编辑**：框架集不起作用！我只是在其他表单之后添加了主表单（不再有嵌套表单），并使用 jQuery 的“克隆”在按钮单击时复制表单中的输入。为每个克隆的输入添加 .hide() 以保持布局不变，现在它就像一个魅力。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-28T22:44:29.820

我认为杰森是对的。如果您的“删除”操作是一个最小的操作，请将其单独放在一个表单中，并将其与其他按钮对齐，以使界面看起来像一个统一的表单，即使它不是。

或者，当然，重新设计你的界面，让人们完全删除其他地方，这根本不需要他们看到 enormo-form。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-28T06:16:53.627

在没有 javascript 的情况下我会这样做的一种方法是添加一组单选按钮来定义要采取的操作：

*   更新
*   删除
*   任何

然后动作脚本将根据单选按钮集的值采取不同的动作。

另一种方法是按照您的建议在页面上放置两个表单，而不是嵌套。布局可能难以控制：

```
<form name="editform" action="the_action_url" method="post">
   <input type="hidden" name="task" value="update" />
   <input type="text" name="foo" />
   <input type="submit" name="save" value="Save" />
</form>

<form name="delform" action="the_action_url" method="post">
   <input type="hidden" name="task" value="delete" />
   <input type="hidden" name="post_id" value="5" />
   <input type="submit" name="delete" value="Delete" />
</form>

```

使用处理脚本中隐藏的“任务”字段进行适当的分支。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-03-20T11:09:07.327

这个讨论我仍然很感兴趣。原始帖子的背后是 OP 似乎共享的“要求”——即具有向后兼容性的形式。作为在撰写本文时工作有时必须支持回 IE6（以及未来几年）的人，我对此深有感触。

在不推动框架的情况下（所有组织都希望在兼容性/健壮性方面让自己放心，而且我没有将此讨论用作框架的理由），Drupal 对此问题的解决方案很有趣。Drupal 也直接相关，因为该框架长期以来一直有“它应该在没有 Javascript 的情况下工作（仅当你想要）”的政策，即 OP 的问题。

Drupal 使用它相当广泛的*form.inc*函数来查找 triggering_element（是的，这就是代码中的名称）。请参阅[form_builder](https://api.drupal.org/api/drupal/includes!form.inc/function/form_builder/7)的 API 页面上列出的代码的底部 （如果您想深入了解详细信息，建议使用源 - *drupal-x.xx/includes/form.inc*）。构建器使用自动 HTML 属性生成，并且通过它，可以在返回时检测哪个按钮被按下，并采取相应的行动（这些也可以设置为运行单独的进程）。

除了表单构建器，Drupal 将数据“删除”操作拆分为单独的 URL/表单，可能是由于原始帖子中提到的原因。这需要某种搜索/列出步骤（*呻吟*另一种形式！但对用户友好）作为初步。但这具有消除“提交所有内容”问题的优势。带有数据的大表格用于其预期目的，数据创建/更新（甚至是“合并”操作）。

换句话说，解决问题的一种方法是将表单一分为二，然后问题就消失了（HTML 方法也可以通过 POST 更正）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-03-24T05:32:45.210

我的解决方案是让按钮调用 JS 函数，这些函数在主表单之外编写然后提交表单

```
<head>
<script>
function removeMe(A, B){
        document.write('<form name="removeForm" method="POST" action="Delete.php">');
        document.write('<input type="hidden" name="customerID" value="' + A + '">');
        document.write('<input type="hidden" name="productID" value="' + B + '">');
        document.write('</form>');
        document.removeForm.submit();
}
function insertMe(A, B){
        document.write('<form name="insertForm" method="POST" action="Insert.php">');
        document.write('<input type="hidden" name="customerID" value="' + A + '">');
        document.write('<input type="hidden" name="productID" value="' + B + '">');
        document.write('</form>');
        document.insertForm.submit();
}
</script>
</head>

<body>
<form method="POST" action="main_form_purpose_page.php">

<input type="button" name="remove" Value="Remove" onclick="removeMe('$customerID','$productID')">
<input type="button" name="insert" Value="Insert" onclick="insertMe('$customerID','$productID')">

<input type="submit" name="submit" value="Submit">
</form>
</body> 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-02-28T09:26:10.503

如果您真的不想使用多个表单（如 Jason 建议的那样），请使用按钮和 onclick 处理程序。

```
<form id='form' name='form' action='path/to/add/edit/blog' method='post'>
    <textarea name='message' id='message'>Blog message here</textarea>
    <input type='submit' id='save' value='Save'>
</form>
<button id='delete'>Delete</button>
<button id='cancel'>Cancel</button> 
```

然后在 javascript 中（为了方便起见，我在这里使用 jQuery）（即使添加一些 onclick 处理程序有点矫枉过正）

```
$('#delete').click( function() {
   document.location = 'path/to/delete/post/id'; 
});
$('#cancel').click( function() {
   document.location = '/home/index';
}); 
```

我也知道，如果没有 javascript，这将使一半页面无法工作。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2011-03-05T00:21:35.380

使用`iframe`嵌套形式。如果他们需要共享字段，那么......它并不是真正嵌套的。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2011-09-09T07:46:50.223

作为对 Yar 在对他自己的回答的评论中发布的问题的回应，我展示了一些 JavaScript，它将调整 iframe 的大小。对于表单按钮的情况，可以安全地假设 iframe 将位于同一域中。这是我使用的代码。您将不得不为您自己的站点更改数学/常量：

```
function resizeIFrame(frame)
{
    try {
        innerDoc = ('contentDocument' in frame) ? frame.contentDocument : frame.contentWindow.document;
        if('style' in frame) {
            frame.style.width = Math.min(755, Math.ceil(innerDoc.body.scrollWidth)) + 'px';
            frame.style.height = Math.ceil(innerDoc.body.scrollHeight) + 'px';
        } else {
            frame.width = Math.ceil(innerDoc.body.scrollWidth);
            frame.height = Math.ceil(innerDoc.body.scrollHeight);
        }
    } catch(err) {
        window.status = err.message;
    }
} 
```

然后像这样调用它：

```
<iframe ... frameborder="0" onload="if(window.parent && window.parent.resizeIFrame){window.parent.resizeIFrame(this);}"></iframe> 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2012-03-15T18:43:57.703

我只是想出了一个用jquery做的好方法。

```
<form name="mainform">    
    <div id="placeholder">
    <div>
</form>

<form id="nested_form" style="position:absolute">
</form>

<script>
   $(document).ready(function(){
      pos = $('#placeholder').position();
      $('#nested_form')
         .css('left', pos.left.toFixed(0)+'px')
         .css('top', pos.top.toFixed(0)+'px');
   });
</script> 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2012-11-22T13:19:43.600

好吧，如果你提交一个表单，浏览器也会发送一个输入提交名称和值。所以你能做的是

```
<form   
 action="/post/dispatch/too_bad_the_action_url_is_in_the_form_tag_even_though_conceptually_every_submit_button_inside_it_may_need_to_post_to_a_diffent_distinct_url"  
method="post">  

    <input type="text" name="foo" /> <!-- several of those here -->  
    <div id="toolbar">
        <input type="submit" name="action:save" value="Save" />
        <input type="submit" name="action:delete" value="Delete" />
        <input type="submit" name="action:cancel" value="Cancel" />
    </div>
</form> 
```

所以在服务器端你只需寻找以宽度字符串“action:”开头的参数，其余部分告诉你要采取什么行动

因此，当您单击按钮 Save 时，浏览器会向您发送 foo=asd&action:save=Save 之类的信息

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2013-11-23T05:58:46.067

我通过包含一个复选框来解决这个问题，具体取决于这个人想要做什么。然后使用 1 个按钮提交整个表单。

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2011-01-27T13:28:56.133

或者，您可以动态分配表单 action... 可能不是最好的解决方案，但确实可以减轻服务器端逻辑...

```
<form name="frm" method="post">  
    <input type="submit" value="One" onclick="javascript:this.form.action='1.htm'" />  
    <input type="submit" value="Two" onclick="javascript:this.form.action='2.htm'" />  
</form> 
```

# regex - 正则表达式中的语法错误以匹配链接 url

> ID：597608
> 
> 赞同：0
> 
> 时间：2009-02-28T06:11:11.860
> 
> 标签：regex, nemerle

我在一些 nemerle 代码中有以下方法：

```
private static getLinks(text : string) : array[string] {
        def linkrx = Regex(@"<a\shref=['|\"](.*?)['|\"].*?>");
        def m = linkrx.Matches(text);
        mutable txmatches : array[string];
        for (mutable i = 0; i < m.Count; ++i) {
            txmatches[i] = m[i].Value;
        }
        txmatches
    } 
```

问题是编译器出于某种原因试图解析正则表达式语句中的括号并导致程序无法编译。如果我删除@，（我被告知放在那里）我在“\s”上得到一个无效的转义字符错误

下面是编译器输出：

```
NCrawler.n:23:21:23:22: ←[01;31merror←[0m: when parsing this `(' brace group
NCrawler.n:23:38:23:39: ←[01;31merror←[0m: unexpected closing bracket `]'
NCrawler.n:22:57:22:58: ←[01;31merror←[0m: when parsing this `{' brace group
NCrawler.n:23:38:23:39: ←[01;31merror←[0m: unexpected closing bracket `]'
NCrawler.n:8:1:8:2: ←[01;31merror←[0m: when parsing this `{' brace group
NCrawler.n:23:38:23:39: ←[01;31merror←[0m: unexpected closing bracket `]'
NCrawler.n:23:38:23:39: ←[01;31merror←[0m: unexpected closing bracket `]' 
```

（第 23 行是上面带有正则表达式代码的行）

我该怎么办？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T06:22:59.337

我不知道 Nemerle，但似乎使用`@`禁用所有转义，包括`"`.

尝试其中之一：

```
def linkrx = Regex("<a\\shref=['\"](.*?)['\"].*?>");

def linkrx = Regex(@"<a\shref=['""](.*?)['""].*?>");

def linkrx = Regex(@"<a\shref=['\x22](.*?)['\x22].*?>"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T06:37:16.867

我不是 Nemerle 程序员，但我知道你应该始终使用 XML 解析器来处理基于 XML 的数据，而不是正则表达式。

我猜有人已经为 Nemerle 创建了 DOM 或 XPath 库，所以你可以访问

//a[@href] 通过 XPath 或类似 a.href.value 通过 DOM。

例如，当前的正则表达式不喜欢

```
<a class="foo" href="something">bar</a> 
```

我没有测试这个，但它应该更像它

```
/<a\s.+?href=['|\"]([^'\">]+)['|\"].+?>/i 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T06:24:16.837

问题在于引号，而不是括号。在 Nemerle 中，与在 C# 中一样，您使用另一个引号而不是反斜杠来转义引号。

```
@"<a\shref=['""](.*?)['""].*?>" 
```

编辑：还要注意，您不需要方括号内的管道；内容被视为一组字符（或字符范围），其中隐含了 OR。

# configuration - 如何端口转发 MediaTemple 服务器以将端口重定向到目录？

> ID：597616
> 
> 赞同：0
> 
> 时间：2009-02-28T06:17:20.100
> 
> 标签：configuration, mediatemple

我刚刚成为 MediaTemple 虚拟专用服务器的自豪拥有者。我的问题是：如何转发端口以将其重定向到目录？例如，我想将端口`6783`（例如，`http://www.imagreedybastard.com:6783`）重定向到目录`/usr/directories/admin/`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T06:23:35.577

这取决于您的网络服务器。对于 Apache，您可以定义一个新的侦听端口，在该端口上创建一个虚拟主机，并根据需要指向其文档根：

```
# 打开端口
听6783

# 期待虚拟主机请求
名称虚拟主机 *:6783

<虚拟主机 *:6783>
    DocumentRoot /usr/directories/admin
    服务器名称 www.imagereedybastard.com
    ＃ 等等等等等等
</虚拟主机>

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T06:20:18.873

您需要在 VPS 上运行 Web 服务器，例如 Apache 或 Nginx。设置服务器以侦听正确的端口后，您可能还需要配置虚拟机的防火墙以允许对该端口的请求。

关于将其指向正确的目录，您需要设置一个 Apache[`VirtualHost`](http://httpd.apache.org/docs/1.3/vhosts/examples.html)或 Nginx[`server`块](http://wiki.codemongers.com/NginxVirtualHostExample)。

# vhdl - 如何在 VHDL 中实现堆栈/队列等数据结构？

> ID：597617
> 
> 赞同：2
> 
> 时间：2009-02-28T06:19:00.890
> 
> 标签：vhdl

如何在 VHDL 中模拟堆栈或队列的行为？任何指针？

我曾想过使用诸如位的逻辑移位操作之类的东西，但是如何检查堆栈为空的约束或堆栈溢出的情况？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T05:00:12.020

您可以从阅读 Peter Ashenden 的书“The Designer's Guide to VHDL”开始。在第 19 章中，他实现了一个排队网络，并详细解释了如何在 VHDL 上实现队列。您可以在以下网址获取该书的 VHDL 文件：[http ://www.csee.umbc.edu/help/VHDL/ashenden/ch_19/](http://www.csee.umbc.edu/help/VHDL/ashenden/ch_19/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-11T19:50:09.820

如果您使用 VHDL/Verilog 工作，您将需要实现 FIFO。如果这要在实际的 FPGA 中实例化，您将使用 FPGA 中的块 ram 的读写指针对 FIFO 建模。在 OpenCores 上查看一个完善的实现...

[http://opencores.org/project,versatile_fifo](http://opencores.org/project,versatile_fifo)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-21T16:31:15.497

不要实现堆栈。使用 FPGA 供应商的内核。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-01T05:41:22.693

您可以制作一个 RAM 组件并将其用作 FIFO、LIFO 或您想要的各种数据结构。

如果你需要一个堆栈，在制作 RAM 组件后不要使用地址总线，制作一个包含堆栈顶部地址的变量。然后用 POP 减少它（首先将输出发送到数据总线）并用 PUSH 增加它（然后将输入保存到 TOS[栈顶] 变量）。

如果你需要更多，我可以告诉你更多...

# asp.net - asp.net 会员数据库更改未提交

> ID：597623
> 
> 赞同：1
> 
> 时间：2009-02-28T06:22:53.050
> 
> 标签：asp.net, asp.net-membership

当用户注册时，我将 IsApproved 值设置为 false 直到稍后。“批准”后，我将用户设置为 .IsApproved=true。但是，更改不会提交给 db。它确实显示了调试的变化。有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-28T06:31:45.510

尝试：

```
Membership.UpdateUser(user); 
```

...这应该在您设置标志后强制更新用户。

[MSDN 信息](http://msdn.microsoft.com/en-us/library/system.web.security.membership.updateuser.aspx)

# javascript - 了解 JavaScript - 资源

> ID：597630
> 
> 赞同：6
> 
> 时间：2009-02-28T06:25:22.670
> 
> 标签：javascript, video

使用[此处](https://stackoverflow.com/about)描述的 StackOverflow 的微型 Digigit/Blog 功能：

我想发布以下我刚刚看到的谷歌技术谈话视频，我觉得这很有趣。

我一直在理解javascript“自然”时遇到问题。

在这里，Douglas Crockford 描述了[JavaScript 的优秀部分](http://www.youtube.com/watch?v=hQVTIJBZook)

我希望你觉得这个链接有用。

现在是问题部分：

你对 javascript 有什么不满？您是否使用 IDE 进行 javascript 编辑？你认为这个视频有助于理解“好的部分”吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-28T09:08:58.860

JavaScript：不好的部分。

1.  最大的错误是后期错误检测。JavaScript 很乐意让您访问不存在的对象成员，或将错误数量的参数传递给函数，并用“未定义”对象填补空白，除非您故意检查它们（在任何地方都这样做是不切实际的） )，将导致异常或稍后生成意外值。可能在很久以后，导致在实际问题代码附近出现的微妙且难以调试的错误。这些条件应该已经产生了异常，只是 JS 最初没有要引发的异常。'undefined' 是我们现在坚持的快速而肮脏的 hack。

2.  未声明的变量默认为全局范围。这几乎不是您想要的，并且当两个函数都忘记 'var' 并开始欺骗同一个全局时，可能会导致微妙且难以调试的错误。

3.  即使对于基于原型的 OO 语言，构造函数的模型也很奇怪，即使是有经验的用户也会感到困惑。忘记“新”可能会导致微妙且难以调试的错误。虽然您*可以*用它制作一个可通过的类/实例系统，但没有标准，而且人们仍在使用的早期教程中提出的大多数类系统都非常不足，并且混淆了 JavaScript 的实际作用。

4.  缺乏绑定方法。调用“object.method”时访问“object.method”会与“this”中的“object”建立魔法连接，这是完全不直观的，但是将“object.method”作为引用传递会失去连接；没有其他语言以这种方式工作。发生这种情况时，“this”被设置为一个意外的值，但它不是“未定义”或其他会引发异常的东西。相反，所有属性访问最终都在“窗口”上，从而导致稍后出现微妙且难以调试的错误。

5.  没有整数类型。数字看起来像一个，但以各种方式分解（例如，n+1==n 表示足够高的 n）。任何时候 NaN 或 Infinity 潜入（如果您认为自己正在处理整数，那是非常出乎意料的）您不会立即发现；相反，会出现微妙且难以调试的错误。

6.  没有关联数组类型。对象看起来像一个，但在各种意想不到的键下分解。数组不是纯列表。任何时候你使用'for...in'，你都可能掉进了一个陷阱，并且会遇到......是的，微妙的和难以调试的错误。

7.  至少对于脚本语言来说，字符串处理通常很差。String.split(, limit) 和 String.replace() 不会像你想的那样做，导致......你知道的。toString() 的结果通常很差，对调试没有用处。与此同时，我们被一堆垃圾 Netscape 认为可能有用的东西困住了，比如 String.prototype.blink() 和永远损坏的 escape()。耶。

8.  然后是所有浏览器的差异（IE 仍然缺少许多基本对象的基本方法），以及 DOM *......*

9.  最后，即使确实发生了异常，它也会被隐藏起来，因此作者甚至不会意识到有什么问题。结果是大多数网站都充满了错误。在 IE 中打开完整的 JavaScript 错误报告，结果无法使用。

想到新一代程序员正在学习这种 tosh 作为第一语言，我感到害怕。更糟糕的是，他们学习的大多数教程材料（“我的第一个 AEWsome R0LL0VERZ！”）总是鼓励最糟糕的做法。'javascript:' URL，'eval()' 用于所有内容，特定于浏览器的 DOM 访问... oy。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T06:30:38.973

**在我看来，**关于 javascript 的难点在于：****

 **1.  跨浏览器开发/调试问题
2.  跨浏览器 dom/model 问题（事件冒泡等）
3.  缺乏“类”（主观）
4.  浏览器缺乏良好的可靠调试支持

Firebug 对 FireFox 有很大帮助，但我还没有发现任何对 IE 有好处的东西 - 仅仅一个事实就是很难。

从好的方面来说，如果你从头开始构建脚本并理解每一步，它会非常有趣和强大。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T06:44:00.877

[alt text http://oreilly.com/catalog/covers/9780596517748_cat.gif](http://oreilly.com/catalog/covers/9780596517748_cat.gif)   [Javascript the Good Parts](https://rads.stackoverflow.com/amzn/click/com/0596517742)也是一本相当不错的书。

对于 Javascript Firefox+Firebug 和 Notepad++ 是我的 IDE。jQuery（和各种插件）是我的框架。我对 Javascript 最大的抱怨是 IE6

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T07:40:29.667

在使用 JavaScript 时，我最大的抱怨是 DOM 绑定，但这并不是 JavaScript 的错，而是每个浏览器都以自己的方式实现它。在这些方面，IE 是最严重的违规者。

就纯粹的 JavaScript 问题而言，我仍然没有完全理解原型设计，以使我能够充分利用它的力量。但这与其说是抱怨不如说是我个人的失败。作为一门语言，我非常喜欢 JavaScript，我对它的任何抱怨都被它与 DOM 的交互所掩盖。

我大量使用 Firefox + Firebug 进行主要的编码和调试。如果任一浏览器有特定问题，我会使用 Opera 和 Safari 中的调试器。当我需要调试 IE 时，天堂会帮助我。

我在任何可用的文本编辑器中编码并具有语法突出显示。我倾向于使用 YUI 框架，但这只是因为我最了解它；我希望有一天能更多地了解其他框架，并决定哪种框架最适合个人项目。

虽然我还没有看过视频，但我这周刚读了“The Good Parts”。如果视频像书一样，那将非常有帮助。这本书本身很棒，因为它简洁且内容丰富。它进入了一种在谷歌搜索信息时看不到的语言讨论级别，这使人们对整个语言有更好的理解。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-28T08:56:48.483

我真的很喜欢原型设计，感觉它比普通的类要强大得多。

# validation - 在注册时验证电子邮件地址有什么好处？

> ID：597639
> 
> 赞同：6
> 
> 时间：2009-02-28T06:30:12.517
> 
> 标签：validation, web, registration

用户注册后，我会发送一封电子邮件，其中包含一个 guid 链接以单击以验证注册。

它确认电子邮件存在，但这如何帮助打击垃圾邮件发送者？

机器人不能“点击”相同的链接返回网站并同样验证注册吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-28T06:43:02.767

它验证：

*   用户正确输入了他们的电子邮件（因为这是您联系他们的唯一方式，让我们把它做对）
*   电子邮件地址存在
*   它归请求页面的人所有

确实 - 它不会阻止机器人从他们*自己*的电子邮件帐户接受电子邮件，但它会阻止他们从**我的**帐户接受电子邮件......这反过来又让你远离被指控发送垃圾邮件的法律泥潭一些随机的乔。每个人都赢了。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-28T06:36:07.853

它确保用户是电子邮件地址的实际所有者。您不希望他们只输入任何人的电子邮件地址，然后开始将来自您站点的消息通过电子邮件发送给随机的人。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-28T06:33:13.320

你是对的，它并不能阻止垃圾邮件发送者。它所做的只是为尝试使用您的站点/服务/应用程序的用户制造了另一个障碍。那是你真正想要的吗？你应该消除障碍，而不是创造障碍。听起来你正在解决一个你甚至不知道你会遇到或不会遇到的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-28T11:42:30.160

我有一个用户名短的 gmail 帐户，并且经常收到不适合我的电子邮件，通常是密码数据或货件 ID 等敏感信息。发生这种情况是因为有些人根本不知道自己的电子邮件地址。如果有一些电子邮件验证，我就不必遭受这种痛苦，他们的隐私也会得到保护。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T11:32:26.987

这完全取决于您认为您的用户会容忍多少。

如果您经营一家在线商店，您希望尽量减少沿途的路障数量，否则用户可能会在完成购买之前退出。

如果它是一个在线论坛或类似的，那么用户可能愿意经历更多的箍。

如果它是一份免费的在线报纸，需要经过验证的注册才能轻松阅读，那么人们可能只是去别处而不是打扰。

您需要平衡用户将容忍的内容与站点需求和产品。

# version-control - 备份 cvs 存储库的最佳实践？

> ID：597649
> 
> 赞同：4
> 
> 时间：2009-02-28T06:37:22.327
> 
> 标签：version-control, backup, cvs

我们的一些项目仍在 cvs 上。我们目前使用 tar 每晚备份存储库。

问题来了：备份 cvs 存储库的最佳实践？

背景：我们将全国各地的多台服务器合并到一台中央服务器上。组合的呼吸库大小为 14gb。（是的，这很高，很可能是由于许多二进制文件、许多分支和存储库的年龄）。

cvs 存储库的“直接 tar”会产生 ~5gb .tar.gz 文件。从 5gb tar 文件中恢复文件会很麻烦。另外，我们可以快速填满磁带。

完整和增量备份方法（即每周完整备份、每晚增量备份）的效果如何？有哪些开源工具可以很好地解决这个问题？（例如阿曼达，巴库拉）。

谢谢，

账单

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T07:15:20.973

如果您不需要备份历史记录，您可以使用 rsync 在另一台机器上创建您的存储库的备份副本。rsync 在增量模式下工作，因此带宽将仅用于发送更改的文件。

我认为您不需要完整的备份历史记录，因为 VCS 提供了自己的历史记录管理，并且您只需要备份作为故障保护措施。

此外，如果您担心备份存储库的一致状态，您可能希望使用文件系统快照，例如 LVM 可以在 Linux 上生成它们。据我所知，Solaris 的 ZFS 也有快照功能。

当且仅当您在晚上没有人接触您的存储库并且您的 VCS 守护程序在备份期间停止时深度运行备份过程时，您才需要快照:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T07:34:36.013

正如 Darkk 提到的，rsync 可以很好地备份，因为只复制收费的东西。 [Dirvish](http://www.dirvish.org/)是一个不错的基于 rsync 的备份系统。备份运行迅速。恢复非常简单，因为您所要做的就是复制内容。多个版本的备份被有效地存储。

# ruby-on-rails - 在 Rails 中制作表单

> ID：597650
> 
> 赞同：1
> 
> 时间：2009-02-28T06:37:47.537
> 
> 标签：ruby-on-rails, forms, web-applications

到目前为止，我已经为用户构建了一个简单的表单，使用该`form_for`方法环绕我的用户模型。

但是，如果我现在要创建一个不直接映射到任何特定模型的表单，我还应该使用`form_for`吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T06:43:20.100

你可能只是想要[`form_tag`](http://api.rubyonrails.com/classes/ActionView/Helpers/FormTagHelper.html#M001697).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T11:26:59.760

有一些插件可以让你创建一个像模型这样的活动记录，而不必在它后面有一个数据库。我会向您指出一个为您提供此功能的插件，但我不确定哪些仍然与 Rails 2.x 兼容。

如果你要走这条路，你可以创建一个视图模式，像往常一样使用 form_for 并获取所有的验证内容。

我已经将它用于登录表单之类的东西，效果很好。

# javascript - 如何同时使用锚链接和滚动？

> ID：597657
> 
> 赞同：0
> 
> 时间：2009-02-28T06:48:44.237
> 
> 标签：javascript, jquery

再次在这里寻求帮助:)

我有这个网站：sharemyplaylists.com

使用此滚动插件在单击时将用户平滑地带到锚点，这里是代码：

```
// Smooth anchor link script
$(document).ready(function() 
{
   $('a[href*=#]').click(function() 
   {
    if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) 
      {
         var $target = $(this.hash);
         $target = $target.length && $target 
            || $('[name=' + this.hash.slice(1) +']');

         if ($target.length) 
         {
            var targetOffset = $target.offset().top;
            $('html,body')
               .animate({scrollTop: targetOffset}, 1000);
            return false;
         }
      }
   });
}); 

// open panel on click script
$(".btn-slide").click(function()
{
   $("#panel").slideToggle("slow");
   $(this).toggleClass("active"); return false;
}); 
```

无论如何，我还有一个“提交你的播放列表”按钮，它打开顶部面板以在侧边栏中显示一个表单，当我点击它时，它只会打开面板（这意味着我也没有被带到顶部锚点）。这就像 2 位代码是冲突的，只有一个脚本可以工作。关于如何单击侧边栏中的“提交您的播放列表”，将用户带到顶部标题锚点并一键打开面板的任何想法？

干杯，基思

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T07:10:40.937

您应该在单击按钮时将滚动插入到您的功能中，例如：

```
// open panel on click script
$(".btn-slide").click(function()                
{
  // here insert scrolling
  targetOffset = 0; // to scroll
  $('html,body').animate({scrollTop: targetOffset}, 1000);
  // toggle
  $("#panel").slideToggle("slow");
  $(this).toggleClass("active"); return false;
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T07:11:20.373

也许您应该以某种方式停止该事件。在原型中，我会做这样的事情： $('.btn-slide').observe('click', function (e) { $('#panel').slide(); Event.stop(e) ; })

# iphone - 下载的声音文件保存在哪里？

> ID：597658
> 
> 赞同：0
> 
> 时间：2009-02-28T06:48:49.243
> 
> 标签：iphone

当我在 iPhone 中下载声音文件时，它存储在哪个目录中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T21:31:34.050

没有“声音文件目录”。

Safari 无法将文件下载到 iPhone，如果您从代码下载声音文件，您将收到`NSData`对象中的数据。从那里你可以在哪里写文件（或者即使*你*写了一个文件，你也可以使用数据而不保存它）。但是，由于 iPhone 沙箱，您仍然没有太多关于将文件保存在何处的选项。

# queue - 多级队列设计

> ID：597659
> 
> 赞同：2
> 
> 时间：2009-02-28T06:51:11.547
> 
> 标签：queue, message-queue

我正在设计一个系统来处理外部 Web 服务。该服务限制在特定时间段 (T) 内可以发出的请求数。该系统允许对一定数量的请求 (R) 进行批处理。该服务支持一定数量的操作 (O)。

我的代码将处理来自用户的未知数量的请求（此时我真的不知道，可能是每天一个请求，可能是每秒数千个请求，但我需要在假设每秒数千个的情况下构建它）。这些结果将在数据库中缓存一段时间。当数据库记录过期时，系统将需要再次从 Web 服务请求数据。

我只能通过一个IP地址和一个帐户访问Web服务（没有作弊，每种操作类型获得一个帐户，或每种操作类型一台机器）。该系统将（希望）全部在单个服务器上运行。

我正在尝试做的（断断续续思考了几个星期，但没有任何我喜欢的结果）是想出一个系统，其中：

*   重复请求被合并（重复意味着它们具有相同的请求数据）
*   用户请求优先于系统请求
*   可以将系统请求更改为用户请求（数据库更新在队列中，并且用户正在请求相同的数据）
*   如果没有针对特定操作的 R 用户请求，则其余部分取自系统请求
*   用户请求的处理顺序与它们进入的顺序相同（除了一旦处理了用户请求，就会处理相同类型的 R 个请求）。

因此，例如，T 为 1 秒，R 为 3，O 为 2。以下请求进入系统：

```
Request 1,  user,   operation A, data 1
Request 2,  user,   operation A, data 2
Request 3,  user,   operation A, data 1 <- duplicate of request 1
Request 4,  system, operation B, data 3
Request 5,  system, operation A, data 1 <- duplicate of request 3
Request 6,  user,   operation B, data 3 <- duplicate of Request 4
Request 7,  system, operation A, data 4
Request 8,  user,   operation A, data 5
Request 9,  user,   operation A, data 6
Request 10, user,   operation A, data 7
Request 11, user,   operation B, data 8 
```

处理重复项后，您将得到以下信息：

```
Request 1,  user,   operation A, data 1 
Request 2,  user,   operation A, data 2 
Request 4,  user,   operation B, data 3 <- promoted to user from system (msg 6)    
Request 7,  system, operation A, data 4 
Request 8,  user,   operation A, data 5 
Request 9,  user,   operation A, data 6 
Request 10, user,   operation A, data 7 
Request 11, user,   operation B, data 8 
```

请求应按以下顺序处理：

```
T1 Request 1, Request 2, Request 8
T2 Request 4, Request 11
T3 Request 9, Request 10, Request 7 
```

我认为可能会有 3-7 种操作类型。某些操作类型会比其他操作类型有更多的请求。系统请求的数量可能会大于用户请求。

是否有处理此类问题的通用方法？模式还是技术？我是不是想多了（不幸的是，在它启动并运行之前我无法获得使用统计信息，我什至无法合理地猜测它们会是什么）？

我试图避免的主要事情是：

*   让系统请求处理用户请求（系统请求可能会等待数周，用户请求必须尽快处理）
*   在数据缓存在数据库中期间，没有两次发出相同的请求

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T07:37:42.307

我会通过有两个队列来解决这个问题：一个用于用户，一个用于系统请求。将每个队列设计为按字典顺序排列的集合，其中包含（操作类型、数据、到达时间）的元组；这假设您可以定义数据片段的排序。有序集允许通过部分键进行搜索，这样您就可以检查两个队列中的重复请求，并允许将系统提升为用户请求。虽然，我不太了解 T 变量的作用。

# weak-typing - 什么时候应该劝阻弱类型？

> ID：597664
> 
> 赞同：4
> 
> 时间：2009-02-28T07:06:03.787
> 
> 标签：weak-typing

什么时候应该劝阻弱类型？在大型项目中不鼓励使用弱类型吗？如果左侧是像下面这样的强类型，那会是规则的例外吗？

```
 int i = 5
   string sz = i
   sz = sz + "1"
   i  = sz 
```

是否有任何语言支持与上述类似的语法？告诉我更多关于弱类型和相关情况的利弊。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-08T02:44:56.453

我认为您将“弱类型”与“动态类型”混淆了。

术语“弱类型”意味着“非强类型”，这意味着允许内存位置的值与其类型指示的值不同。

C 是弱类型语言的一个例子。它允许编写这样的代码：

```
typedef struct
{
    int x;
    int y;

} FooBar;

FooBar foo;
char * pStr = &foo;
pStr[0] = 'H';
pStr[1] = 'i';
pStr[2] = '\0'; 
```

也就是说，它允许将 FooBar 实例视为一个字符数组。

在强类型语言中，这是不允许的。要么会生成编译器错误，要么会抛出运行时异常，但在任何时候，FooBar 内存地址都不会包含不是有效 FooBar 的数据。

C#、Java、Lisp、Java Script 和 Ruby 是不允许此类事情的语言示例。它们是强类型的。

其中一些语言是“静态类型的”，这意味着变量类型是在编译时分配的，还有一些是“动态类型的”，这意味着变量类型直到运行时才知道。“静态与动态”和“弱与强”是正交问题。例如，Lisp 是一种“强动态类型”语言，而“C”是一种“弱静态类型语言”。

此外，正如其他人所指出的那样，“推断类型”和程序员指定的类型之间存在区别。C# 中的“var”关键字是类型推断的一个示例。然而，它仍然是一个静态类型的构造，因为编译器在编译时推断变量的类型，而不是在运行时。

所以，你的问题真正要问的是：

> 静态类型、动态类型、弱类型、强类型、推断静态类型和用户指定静态类型的相对优缺点是什么。

我在下面提供所有这些的答案：

**静态类型**

**静态类型有 3 个主要好处：**

1.  更好的工具支持
2.  A 减少某些类型错误的可能性
3.  表现

由于静态类型提供的额外信息，在静态类型语言中，诸如智能和重构之类的用户体验和准确性得到了极大的改善。如果您键入“a”。在代码编辑器中并且“a”具有静态类型，那么编译器就知道“。”之后可能合法出现的所有内容。并因此可以向您显示准确的完成列表。在动态类型语言中支持某些场景是可能的，但它们受到的限制要大得多。

此外，在没有编译器错误的程序中，重构工具可以识别使用特定方法、变量或类型的每个地方。在动态类型语言中不可能做到这一点。

第二个好处有点争议。静态类型语言的支持者喜欢这样说。然而，静态类型语言的反对者认为，他们捕获的错误是微不足道的，无论如何他们都会被测试捕获。但是，您确实会预先收到诸如拼写错误的变量或方法名称之类的通知，这会很有帮助。

静态类型语言还可以实现更好的“数据流分析”，当与 Microsoft 的 SAL（或类似工具）之类的东西结合使用时，可以帮助发现潜在的安全问题。

最后，使用静态类型，编译器可以进行更多优化，因此可以生成更快的代码。

**缺点：**

静态类型的主要缺点是它限制了你可以做的事情。您可以使用无法使用静态类型语言编写的动态类型语言编写程序。Ruby on Rails 就是一个很好的例子。

**动态打字**

动态类型的最大优势在于它比静态类型强大得多。你可以用它做很多很酷的事情。

另一个是它需要更少的打字。您不必到处指定类型。

**缺点：**

动态类型有两个主要缺点：

1.  您不会从编译器或 IDE 中获得那么多的“手握”
2.  它不适合关键性能场景。例如，没有人用 Ruby 编写操作系统内核。

**强类型：**

强类型的最大好处是安全性。强制执行强类型通常需要某种类型的运行时支持。如果一个程序可以证明类型安全，那么很多安全问题，比如缓冲区溢出，就会消失。

**弱打字：**

强类型的最大缺点和弱类型的最大好处是性能。

当您可以以任何您喜欢的方式访问内存时，您可以编写更快的代码。例如，数据库只需写出原始字节即可将对象交换到磁盘，而无需求助于“ISerializable”接口之类的东西。一个视频游戏可以通过在一个大缓冲区上运行一个 free 来丢弃与一个级别相关的所有数据，而不是为许多小对象运行析构函数。

能够做这些事情需要弱类型。

**类型推断**

类型推断允许静态类型的许多好处，而不需要太多的类型。

**用户指定类型**

有些人只是不喜欢类型推断，因为他们喜欢明确。这更像是一种风格。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-28T09:35:23.243

弱类型化是一种语言简化的尝试。虽然这是一个有价值的目标，但弱类型是一个糟糕的解决方案。

COM Variants 中使用的弱类型是解决此问题的早期尝试，但它充满了危险，坦率地说，它带来的麻烦多于其价值。即使是忍受各种垃圾的 Visual Basic 程序员也正确地认为这是一个坏主意，并将 Microsoft 的 ETC（扩展类型转换）反向命名为 Evil Type Cast。

不要将推断类型与弱类型混淆。推断类型是在编译时从上下文推断的强类型。一个很好的例子是`var`关键字，在 C# 中用于声明适合接收 LINQ 表达式值的变量。

相比之下，每次计算表达式时都会推断出弱类型。这在问题的示例代码中进行了说明。另一个例子是在 C 中使用无类型指针。非常方便，但也很麻烦。

推断类型解决了与弱类型相同的问题，*但没有*引入与弱类型相关的问题。因此，只要宿主语言可用，它就是一个首选的替代方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T01:34:13.723

他们几乎总是应该气馁。我能想到的唯一类型的代码是需要一些指针巫术的低级代码。

为了回答你的问题，C 支持这样的代码（当然除了没有字符串类型），这听起来像是 PHP 或 Perl 会有的东西（但我可能完全错了）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-03-06T02:10:30.033

"

> 什么时候应该劝阻弱类型？在大型项目中不鼓励使用弱类型吗？如果左侧是像下面这样的强类型，那会是规则的例外吗？
> 
> `int i = 5 string sz = i sz = sz + "1" i = sz`
> 
> 是否有任何语言支持与上述类似的语法？告诉我更多关于弱类型和相关情况的利弊。

"

也许您可以编写自己的库来做到这一点。

在 C++ 中，您可以使用称为“运算符重载”的东西，这意味着您可以将一种类型的变量声明为另一种类型的变量。这就是声明的原因：

```
[std::string str = "Hello World";][1] 
```

具体来说，您将定义一个函数（其中变量的类型是 T 并且 B 是您想要将其设置为的类型）

工作，即使引号之间的任何文本都被解释为字符数组。

```
T& T::operator= ( const B s ); 
```

请注意，这是一个类的成员函数 另请注意，如果您想自由地使用它，您可能希望拥有某种反转此操作的函数 - 类似于

```
B& T::operator= ( const T s); 
```

C++ 足够强大，可以让您创建一个通常为弱类型的对象，但如果您想将其视为纯弱类型，您将只想创建一个可用作任何原语的变量类型，并且只使用以下函数指向无效的指针。相信我，当它可用时，使用强类型编程要容易得多。

我个人更喜欢强类型，因为我不需要担心当我不知道变量是什么意思时会出现的错误。例如，如果我想编写一个函数来与一个人交谈——并且该函数使用了这个人的身高、体重、姓名、孩子的数量等——但是你给了我一个颜色，我会得到一个错误，因为你可以使用非常简单的算法并不能真正确定颜色中的大部分内容。

就弱类型的优点而言，如果您正在编写要在程序中运行的东西（即 Web 浏览器或 UNIX shell），您可能希望习惯于松散类型的编程。JavaScript 和 Shell 脚本是弱类型的。

我建议像汇编语言这样的编程语言是唯一的硬件级弱类型语言之一，但是我见过的汇编语言的风格根据分配的大小为每个变量附加一个类型，即 word、dword、qword .

我希望我给了你一个很好的解释，并没有在你嘴里放任何话。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T07:31:43.727

弱类型本质上不如强类型健壮，因为你没有告诉机器确切地做什么 - 相反机器必须弄清楚你的意思。这通常工作得很好，但通常不清楚结果应该是什么。例如，一个字符串乘以浮点数是什么？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-08T03:39:17.727

> 是否有任何语言支持与上述类似的语法？

Perl 允许您交替处理一些数字和字符串。例如，“5”+“1”会给你 6。这类事情的问题通常是很难避免歧义：“5”+1 应该是“51”还是“6”？Perl 通过为字符串连接使用单独的运算符并为数字加法保留 + 来解决此问题。

其他语言必须弄清楚您是要进行连接还是加法，以及（如果相关）结果将是什么类型或表示形式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-28T10:50:55.543

我进行了 ASP/VBScript 编码并使用没有“选项严格”的遗留代码，这允许弱类型。

这在很多时候都是地狱，尤其是在经验不足的程序员手中。我们得到所有愚蠢的错误需要很长时间才能诊断出来。

其中一个愚蠢的例子是这样的：

```
'Config 
    Dim pass
    pass = "asdasd"

If NOT pass = Request("p") Then
Response.Write "login failed"
REsponse.End()
End If 
```

到目前为止一切顺利，但如果用户将 pass 更改为整数密码，猜猜它不再起作用了，因为 int pass != string pass (from querystring)。我认为它应该可以工作，但*我不记得确切的代码*。

我讨厌弱打字，而不是愚蠢的调试会话，我可以花额外的时间来输入变量的确切类型。

简而言之，根据我的经验，尤其是在大型项目中，尤其是对于没有经验的开发人员来说，这只是麻烦。

# c# - 塞班通过 C#

> ID：597665
> 
> 赞同：2
> 
> 时间：2009-02-28T07:06:15.800
> 
> 标签：c#, mobile

是否可以使用 C# 为 Symbian 构建程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-27T00:07:52.920

答案是肯定的。[如果您使用来自https://www.redfivelabs.com/default.aspx](https://www.redfivelabs.com/default.aspx)的 Net60 应用程序

你必须为此付出代价。我认为没有免费或开源版本

微软和诺基亚还计划[在 Symbian 设备上安装 Silverlight](http://betalabs.nokia.com/apps/silverlight)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T07:18:03.900

一个快速的谷歌告诉我答案是“不”。 [http://www.allaboutsymbian.com/forum/archive/index.php/t-11171.html](http://www.allaboutsymbian.com/forum/archive/index.php/t-11171.html)

显然，有一家名为 AppForge 的公司开发了一种产品，可以将 C# 编译到 Symbian 应用程序中。甲骨文收购它们后，该产品似乎已[失效](http://en.wikipedia.org/wiki/AppForge#Effect_of_insolvency_on_AppForge_CrossFire_Users_And_Possible_Solutions)。

# .net-3.5 - 如何在 C#2 项目中使用 Dotnet 3.5 dll？

> ID：597675
> 
> 赞同：1
> 
> 时间：2009-02-28T07:12:42.680
> 
> 标签：.net-3.5, c#-2.0

我有一个 doet 3.5 dll，我想在我的旧 C#2 项目中使用它，目前我不想升级 C#2 项目。

我在 c#2 项目中添加了 dll 作为参考，一切正常。

当我想使用方法`System.Func<int,int,IEnumerator<string>>`作为参数时出现问题，所以编译器不知道它需要`System.Core`汇编，所以添加`System.Core`汇编就可以解决问题？有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T07:29:15.167

如果您当前的项目依赖于 .NET 2.0，则不应添加对 .NET 3.5 中的任何内容的引用 - 如果您的类库使用 .NET 3.5 中的任何内容，那么如果您将它们中的两个部署到一台只有 .NET 2.0 的机器。

我会强烈考虑以下三个选项之一：

*   将您的 .NET 2.0 应用程序升级到 .NET 3.5（我知道您不想这样做，但如果可以的话，它可能是最好的选择）
*   将您的类库降级为面向 .NET 2.0。（您仍然可以使用许多 C# 3.0 功能，但不能使用 .NET 3.5 类）
*   不要使用 .NET 2.0 应用程序中的 .NET 3.5 库

如果您的 .NET 2.0 应用程序只会部署在 .NET 3.5 机器上，那么您几乎可以摆脱混合和匹配，但您必须确保公共 API 中的*任何内容都不*依赖于 .NET 3.5。在这种情况下，`Func`您可以只声明自己匹配的委托类型，但是到处都这样做是很痛苦的。

# vim - 如何在 Vim 中快速更改变量名？

> ID：597687
> 
> 赞同：110
> 
> 时间：2009-02-28T07:29:54.043
> 
> 标签：vim, variables, refactoring

我正在使用 Vim 阅读大量包含许多单字母变量名的 C 和 Perl 代码。

在我阅读代码的过程中，如果有一些命令可以将变量的名称更改为更有意义的名称，这样我就可以更快地阅读其余部分。

Vim 中是否有一些命令可以让我快速做到这一点？

我不认为正则表达式会起作用，因为：

1.  相同的单字母名称在不同的范围块中可能有不同的用途；和

2.  相同的字母组合可以是另一个更长的变量名、字符串文字或注释的一部分。

有没有已知的解决方案？

* * *

## 回答 #1

> 赞同：226
> 
> 时间：2009-02-28T12:00:19.370

以下是如何重命名当前作用域中定义的变量`{}`。

将光标移动到变量用法。按`gd`。这意味着 - 将光标移动到定义。现在按下`[{`- 这将带您进入范围开始。按`V`- 将打开视觉线选择。按`%`- 将跳转到相反的位置，`}`因此将选择整个范围。按`:s/`- 开始替代命令。 `<C-R>/`- 将插入与变量名称匹配的模式（按 之前您所在的名称`gd`）。 `/newname/gc<CR>`- 将启动搜索并在每次匹配时确认替换。

现在你必须记录一个宏，甚至更好——映射一个键。

这是最终的映射：

```
" For local replace
nnoremap gr gd[{V%::s/<C-R>///gc<left><left><left>

" For global replace
nnoremap gR gD:%s/<C-R>///gc<left><left><left> 
```

把它交给你`.vimrc`或只是执行。按下`gr`局部变量后`:s`，您将进入命令，您只需输入`new_variable_name`并按下`Enter`。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2018-04-16T09:29:17.657

*我知道这是一个老问题，@mykola-golubyev 的方式显然是 OP 问题中特定情况的最佳答案（我假设这是通过混淆代码，您可能有多个具有相同 var 名称的块） ; 但是对于像这样的问题名称，许多从谷歌搜索而来的人可能会寻找一种不太针对情况的方法来重命名 VIM 中的变量——而且这些方法可能更简洁*

我很惊讶没有人这样建议：

> **`*` `:s//`** *新名字* **`/gc`**

这`*`与`gn`- 它搜索光标下单词的下一个出现并成为最后搜索的模式相同，因此当您在替换命令中省略搜索模式时，VIM 假定这是要搜索的模式。

对于少量的 var 副本，一个更快的副本：

> **`*` `cw`** *NEWNAME* **`<esc>`**然后重复**`n.`**其他出现

搜索出现，`cw`是*更改单词*的命令，`n`转到最后一个搜索词的下一次出现并`.`重复最后一个命令（*将单词更改为 NEWNAME*）

（我知道这一切的[功劳归功于 Reddit 上的@doomedbunnies](https://www.reddit.com/r/vim/comments/1zvks1/best_way_to_rename_variable_in_several_spots_in_a/)）

另一个很酷的技巧是：（[感谢@nobe4](https://vi.stackexchange.com/a/8288)）

> **`*` `cgn`** *NEWNAME* **`<esc>`**然后重复**`.`**其他出现

`cgn`是“改变任何结果（查找下一个事件）”。现在这是*最后一个命令*，您不需要`n`转到下一个匹配项，因此再次减少笔画，更重要的是，不需要交替`n`and `.`。但是，很明显，这个有一个缺点，就是没有办法跳过一个事件。

这里有一些好处：

*   没有映射，没有 .vimrc（或 init.vim），因此您可以在遇到的任何 VIM 副本中使用它（例如，在某些 VPS 或您朋友的机器上的快速任务，如果按照您的方式配置 VIM 会破坏“快速”的目的)
*   使用`*`or`gn`进行单词选择非常快——只需一次按键（好吧，比如说 1.5）
*   使用`*`or`gn`确保你没有在其他单词中得到任何匹配，就像这样`:%s/<C-R>//gc`做一样。击败`:%s/\<OLDNAME\>/NEWNAME/gc`手动打字：我个人倾向于忘记使用这些`\<`东西将匹配限制为仅整个单词。
*   不使用范围只会导致一些额外的笔划`n`来跳过不需要的匹配 - 可能甚至比限制范围所需的额外笔划还要少。在正常情况下，无论如何，您的变量很可能在某种程度上本地化到某个代码块。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-28T07:35:52.017

AFAIK，VIM 中没有实际的重构支持。当出于重构的目的进行重命名时，我通常会采取以下预防措施：

1.  限制我使用标记的更改范围。
2.  输入正则表达式时，用 \< 和 > 将名称括起来。这将使其匹配整个单词，从而减少将发生的不正确重命名的类型。
3.  不要进行多行替换以减少错误替换的机会
4.  如果它不是一个小的变化，请仔细查看代码差异。

我的最终变化看起来像这样

```
:'a,'bs/\<foo\>/bar 
```

我很想错，没有针对 VIM 的重构工具，但我还没有看到它。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-11-14T00:35:56.600

把它放在你的 .vimrc

```
" Function to rename the variable under the cursor
function! Rnvar()
  let word_to_replace = expand("<cword>")
  let replacement = input("new name: ")
  execute '%s/\(\W\)' . word_to_replace . '\(\W\)/\1' . replacement . '\2/gc'
endfunction 
```

调用它`:call Rnvar()`

`expand("<cword>")`获取光标下的单词。搜索字符串`%`用于文件范围，`\(\W\)`模式在要替换的单词边界处查找非单词字符，并将它们保存在变量中`\1`，`\2`以便在替换模式中重新插入。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-28T07:35:17.510

您可以在全局搜索和替换中使用“c”修饰符，这会要求您确认每次替换。这需要更长的时间，但它可能适用于非庞大的代码文件：

```
%s/\$var/\$foo/gc 
```

c代表确认。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-28T12:21:59.053

在 c 中，您可以使用 cscope 取得一些进展。它试图理解语法，因此有机会知道字母何时是变量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-28T23:32:01.470

如果这是跨多个文件，您可以考虑查看 sed。使用 find 获取您的文件并使用 xargs 和 sed 进行替换。假设你想在所有匹配 *.c 的文件中用 a_better_name 替换 a，你可以这样做

寻找 。-名称“*.c”| xargs sed -i -e 's/a/a_better_name/g'

请记住，这将替换所有出现的 a，因此您可能需要更健壮的正则表达式。

# sql - 如何在列中设置公式

> ID：597690
> 
> 赞同：1
> 
> 时间：2009-02-28T07:31:53.867
> 
> 标签：sql, sql-server

我在特定字段中设置公式时遇到问题。我使用的 sql 数据库是从->添加新项目->sql 数据库添加的。我有以下字段的订单表：

```
ordernum primary key  
orderdate smalldatetime,  
custemail varchar(50),  
subtotal money,  
salestax money,  
shipping money,  
total AS(subtotal+salestax+shipping) 
```

如何设置这个总计公式，总计字段中没有提到数据类型。

谢谢，
哈比卜

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T10:13:18.177

此示例应说明您希望实现的目标。

```
 create table #table
    (
        ordernum int identity(1,1) primary key,
        orderdate smalldatetime,
        custemail varchar(50),
        subtotal money, 
        salestax money, 
        shipping money, 
        total AS(subtotal+salestax+shipping)
    )

    insert into #table
    (
        orderdate,
        custemail,
        subtotal, 
        salestax, 
        shipping 
    )
    select
        getDate(),
        'some@email.com',
        1.00,
        1.00,
        1.00

    select * from #table

    drop table #table 
```

干杯，约翰

# asp.net - QueryString 的最佳选择是什么

> ID：597700
> 
> 赞同：1
> 
> 时间：2009-02-28T07:37:45.227
> 
> 标签：asp.net, vb.net, query-string, page-lifecycle

我们听说了很多关于使用 QueryStrings 的漏洞和可能的攻击。除此之外，昨天，一个错误让我非常恼火，以至于我决定停止使用 QueryStrings，我传递了类似的东西：

```
Dim url As String = "pageName.aspx?type=3&st=34&am=87&m=9" 
```

我试过了

```
Response.Write(url) 
```

在重定向页面中，它将“类型”打印为 3，然后我在目标页面中尝试了它，它打印了 3,0....我知道这很容易处理，但为什么呢？我的意思是为什么我应该通过 3 并且必须在下一页的加载中检查 3.0 以相应地采取我的行动？？？

那么我们应该使用什么呢？将变量、参数...等传递到下一页的最安全方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T07:45:13.320

您可以使用[Cross-Page Postbacks](http://msdn.microsoft.com/en-us/library/ms178139.aspx)。

还要检查这篇文章：

*   [如何：在 ASP.NET 网页之间传递值](http://msdn.microsoft.com/en-us/library/6c3yckfw.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T07:47:09.447

您可以使用许多选项，其中大多数都需要您构建一个在页面之间传递变量的策略。

在我使用这种策略的大多数项目中，我创建了一个 formVariables 类来保存当前活动的项目。它具有您需要通过查询字符串传递的属性。我在会话中存储这个类。在我的基本页面中，我从会话中读取它。所以在每一页我都得到了这个对象的值。这种方法唯一的缺点是在你完成工作后清理物品。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-17T15:10:31.057

我建议您避免使用 Session 在页面之间传递变量，因为这会破坏 Web 的无状态模型。如果您刚刚在会话中存储了一些与某个页面相关的值，那么用户使用浏览器的后退按钮返回到应该具有不同状态的同一页面，那么您将不会知道它。

它导致读取与用户当前正在查看的页面无关的会话值的可能性——这对最终用户来说可能非常混乱。如果您过于依赖会话过期，您也会遇到会话过期问题。

我个人尽量避免在可能的情况下使用会话，而不是隐藏表单值+可以在回发+导航时读取的查询字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T21:30:18.437

你说：

> 它打印了 3,0....我知道这很容易解决，但为什么呢？我的意思是为什么我要通过 3 并且必须检查 3.0

**“3,0”（三个逗号**哦）和“3.0”（三个**点**哦）是有区别的。您还说您正在“通过类似的*东西*”。

在查询字符串中，如果您在同一个键中传递多个值，它们将用逗号分隔。

由于所有值都作为字符串传递，因此 int "3" 不可能神奇地变成十进制 "3.0"，除非您在请求时对其进行解析。

如果最终结果类似于：

```
pageName.aspx?type=3&st=34&am=87&m=9&type=0 
```

然后当你回读

```
Request.QueryString["type"] 
```

您将获得“3,0”作为该键中以逗号分隔的值列表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T21:45:12.537

在页面之间传递信息的最佳/最安全的方法是使用会话。

```
// On page 1:
this.Session["type"] = 3;

// On Page 2:
int type = (int)this.Session["type"]; 
```

您可以在会话中存储任何类型的对象，并且它存储在服务器端，因此用户不能像查询字符串、视图状态或隐藏字段一样操作它

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-28T10:18:55.837

首先，在 asp .net 中，您可以使用多种策略在页面之间传递值。您也有视图状态，但是视图状态存储的值和使用情况不同，您也可以使用它。会议代替，当然是通过邮寄形式。

如果您的问题是安全性，我建议您创建 2 个用户来访问数据。一个具有只读访问权限的用户，用于访问页面（防止 Sql Inyection ）并验证数据抛出查询字符串。还有一个对您的私有区域具有写访问权限。

对不起，我看不懂的英语。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-28T11:19:21.853

如果您在每个页面加载时都进行了适当的安全检查，那么查询字符串就可以了，恕我直言，这是最灵活的。

它们提供了最大的灵活性，因为页面的入口点不像其他一些选项那样依赖于发送者。您可以从您自己的应用程序中的任何位置调用页面，如果需要，可以通过查询字符串从外部调用页面。它们还可以添加书签并手动修改以进行测试或直接操作。

再次，关键是为查询字符串添加适当的安全性和验证，而不是盲目地处理它。请记住，安全不仅仅是拥有编辑或读取访问权限，具体取决于数据和用户，如果数据由特定用户拥有和私有，他们可能根本无法访问具有这些参数的数据。

我们尝试了各种方法，试图隐藏查询字符串，但最终还是回到了它，因为它更容易操作、调试和管理。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-28T11:25:45.223

我喜欢使用查询字符串，因为我希望用户能够为常见搜索等内容添加书签。例如，如果一个页面可以独立工作，那么我喜欢它能够独立工作。

如果您需要从另一个页面来访问您所在的页面，那么使用会话/跨页面回发很酷，但否则我通常会发现查询字符串是更好的解决方案。

请记住，查询字符串是未经验证的输入，并谨慎对待它们，就像对待任何未经验证的输入一样。

# .net - 封装 Linq to SQL 数据访问的最佳方法是什么？

> ID：597702
> 
> 赞同：5
> 
> 时间：2009-02-28T07:38:36.050
> 
> 标签：.net, linq-to-sql, design-patterns, lambda, expression-trees

我一直在尝试将对象映射封装在项目数据存储库中。也许 EF 会提供所需的抽象级别，但出于多种原因，我目前正在使用 Linq to SQL。以下代码旨在将数据库中的用户作为 ModUser 对象列表返回，其中 ModUser 是存储库公开的 POCO：

```
public List<ModUser> GetUsers() {
    Users.Select(MapUser).ToList();
}

public Expression<Func<User, ModUser>> MapUser {
    get {
        return u => new ModUser() {
            UserId = u.User_Id,
            UserResources = u.Resources(MapResource)
        }
    }
}

public Expression<Func<Resource, ModResource>> MapResource { ... 
```

代码将失败，因为我无法调用 MapResource 表达式，因为我试图从另一个表达式中调用它。我设法通过用 u => new ModResource() 替换“MapResource”来解决这个问题，然后使用 ExpressionVisitor 找到这个占位符节点并将其替换为 MapResource 表达式。

当我尝试使用涉及单个属性的表达式（即 UserResource = MapResource）分配 ModUser 的属性时，我也遇到了类似的问题。通过使用 Expression 类上的方法手动组合所需的表达式，我设法解决了第二个问题。

我确实意识到我可以将上面的代码更改为

```
UserResources = u.Resources(r => MapResource.Compile().Invoke(r)); 
```

但是最终生成的 SQL 查询将需要获取 r 的所有属性，而不仅仅是 MapResouce 所需的属性，因为我们现在正在处理一个函数。此外，如果 MapResouce 需要访问 r 上的更多表，这是不可能的，因为它被用作函数而不是表达式。我可以将 DeferredLoadingEnabled 设置为 true，但这会产生大量单独的查询，而不是修改主查询以加入所需的任何表。

有谁知道这些操作是否会在未来的 .NET 版本中变得更容易，或者我是否以错误的方式解决这个问题？我真的很喜欢 Linq 和 Expression 功能，我只是希望我可以使用更具可读性的代码来使用它们。

**更新**

我想我可能会添加一些示例来说明我如何使表达式更加可组合。它们并不简洁，但它们完成了工作。

```
public Expression<Func<User, ModUser>> MapUser {
    get {
        Expression<Func<User, ModUser>> mapUser = u => new ModUser() {
            UserId = u.User_Id,
            UserResources = u.Resources(r => new ModResource())
        };
        return mapUser.MapResources(this);
    }
}

public Expression<Func<Resource, ModResource>> MapResource { ... }

public static Expression<Func<T0, T1>> MapResources<T0, T1>(this Expression<Func<T0, T1>> exp, DataContext dc) {
    return exp.Visit<MethodCallExpression, Expression<Func<T0, T1>>>(m => {
        if(m.Arguments.Count > 1 && m.Arguments[1].Type == typeof(Func<DataContext.Resource, ModResource>)) { //Find a select statement that has the sub expression as an argument
            //The resource mapping expression will require the Resource object, which is obtained here
            ParameterExpression resourceParam =  ((LambdaExpression)m.Arguments[1]).Parameters[0];
            return Expression.Call(m.Method, m.Arguments[0], //The first argument is the record selection for the 'select' method
                Expression.Lambda<Func<DataContext.Resource, ModResource>>(//Provide the proper mapping expression as the projection for the 'select' method
                     Expression.Invoke(dc.MapResource, resourceParam),
                     resourceParam)
                );
        }
        return m;
    });
} 
```

那我在这里做什么？请注意，在此版本的 MapUser 中，我没有正确创建 ModResource 对象，我只是创建了一个虚拟版本。然后我调用一个表达式访问者方法来查找虚拟调用并将其替换为我最初想要的那个。对我来说，似乎缺少表达式语法，因为我基本上能够构建我最初想要的表达式树，但我必须实际访问树才能做到这一点。以下是我发现的另一种解决方法：

```
public Expression<Func<User, ModUser>> MapUser {
    get {
        Expression<Func<User, ModResource, ModUser>> mapUser = (u, resource) => new ModUser() {
            UserId = u.User_Id,
            UserResource = resource;
        }

        return mapUser.CollapseArgument(MapResource, user => user.MainResource);
    }
}

public Expression<Func<Resource, ModResource>> MapResource { ... }

public static Expression<Func<T0, T3>> CollapseArgument<T0, T1, T2, T3>(this Expression<Func<T0, T1, T3>> exp, Expression<Func<T2, T1>> exp0, Expression<Func<T0, T2>> exp1) {
    var param0 = Expression.Parameter(typeof(T0), "p0");
    var argExp = Expression.Invoke(exp0, Expression.Invoke(exp1, param0));
    return Expression.Lambda<Func<T0, T3>>(
         Expression.Invoke(exp, param0, argExp),
         param0);
} 
```

在第二个示例中，我知道我可以从用户数据中获取资源数据，但我不能“内联”表达式来展示如何执行此操作并将资源数据映射到资源 POCO。但是我可以手动创建一个表达式树，它给出了一个已经映射的资源 POCO 并使用它。然后，我可以创建另一个表达式来显示如何从用户那里获取资源原始数据，并创建一个最终表达式来显示如何将原始资源数据映射到资源 POCO。现在可以想象，我可以将所有这些信息组合到一个表达式树中，以一种“折叠”出资源特定参数的方式，因为我可以从主要用户参数中获取它。这就是上面的代码所做的。

所以我找到了使表达式高度可组合的方法......它只是感觉不干净。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T21:51:00.663

好的，我不得不承认我并没有真正读完 OP 的问题（傻笑），但你知道你可以使用 Linq-to-SQL 属性来装饰任何 POCO 对象吗？您不必使用设计器。

这是我面前打开的代码中的一个随机示例。这是一个名为“Product”的 POCO，它应用了一些属性，使其与 Linq-to-SQL DataContext 交互。

高温高压

```
using System;
using System.Collections.Generic;
using System.Data.Linq;
using System.Data.Linq.Mapping;
using System.Linq;
using System.Web;

namespace Redacted.Site.Models.Store
{
    /// <summary>
    /// A "Product" is a good for purchase at the store.
    /// </summary>
    [Table(Name = "s.products")]
    public partial class Product
    {
        /// <summary>Gets or sets the PK of the object/row.</summary>
        [Column(Name = "id", IsPrimaryKey = true, IsDbGenerated = true, DbType = "INT NOT NULL")]
        public Int32 ID { get; set; }

        /// <summary>Gets or sets the Title.</summary>
        [Column(Name = "title", DbType = "NVARCHAR(500) NOT NULL")]
        public String Title { get; set; }

        /// <summary>Gets or sets the Lede.</summary>
        [Column(Name = "lede", DbType = "NVARCHAR(MAX) NOT NULL")]
        public String Lede { get; set; }

        /// <summary>Gets or sets the Description.</summary>
        [Column(Name = "description", DbType = "NTEXT NOT NULL")]
        public String Description { get; set; }

        /// <summary>Gets or sets the Price.</summary>
        [Column(Name = "price", DbType = "FLOAT NOT NULL")]
        public Double Price { get; set; }

        /// <summary>Gets or sets the FK to the <see cref="Department"/>.</summary>
        [Column(Name = "department_id", DbType = "TINYINT NOT NULL")]
        public Byte DepartmentID { get; set; }

        /// <summary>Gets or sets the date/time the product was released to the store.</summary>
        [Column(Name = "released_on_utc", DbType = "DATETIME NOT NULL")]
        public Int32 ReleasedOnUtc { get; set; }

    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T17:49:03.060

Linq To SQL 支持 POCO 的方式有点不同。

要实现持久性无知，您将使用描述 modUser 如何映射（列、关联等）的映射文件，而不是 LTS 设计器。创建新上下文时，将 XML 映射文件作为 XMLMappingSource 传递给它。

这样，LTS 将从数据库中返回您的对象。

我在这里和那里读到，将您的集合关联属性定义为 IList(of T) 类型的读/写属性足以让 LinqToSQL 为这些集合提供延迟加载，但我没有尝试过，所以我不能保证它.

实体框架在其当前版本中对 POCO 的支持会更糟（就大多数人对 POCO 一词的理解而言，基本上没有）。

所有常见的 LTS 限制都适用于此，因此没有“值对象”映射。如果您想从数据库和 POCO 支持中删除一些更远的东西，那么您需要查看 NHibernate。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T01:44:34.040

我认为如果你想使用 POCO，Linq to SQL 并不是最好的选择。我认为使用 NHibernate 之类的东西可能会好得多。将 Linq to SQL 与 POCO 一起使用意味着您正在数据库之上的数据层（Linq to SQL）之上构建一个层。使用 NHibernate，您将构建所有代码并将其直接映射到数据库。更少的层==更少的代码==更少的工作。

# svn - 进行持续集成时的最佳分支策略？

> ID：597707
> 
> 赞同：103
> 
> 时间：2009-02-28T07:44:15.100
> 
> 标签：svn, version-control, continuous-integration, branch

当您想要进行持续集成时，最好使用的分支策略是什么？

1.  *发布分支：*在主干上开发，为每个发布保留一个分支。
2.  *功能分支：*在单独的分支中开发每个功能，仅在稳定后合并。

将这两种策略一起使用是否有意义？例如，您为每个版本分支，但您也为大型功能分支？这些策略之一是否更适合持续集成？当使用不稳定的主干时，使用持续集成是否有意义？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-17T23:26:27.510

我发现这个话题真的很有趣，因为我在日常工作中严重依赖分支机构。

*   我记得 Mark Shuttleworth 提出了一个模型，即在超越传统 CI 的同时保持主分支的原始状态。我在[这里](http://codicesoftware.blogspot.com/2008/08/4-steps-to-make-version-control-shine.html)发布了它。
*   由于我熟悉 Cruise Control，因此我还在这里写了有关任务分支和 CI[的](http://codicesoftware.blogspot.com/2008/08/building-task-branches-with.html)博客。这是一个分步教程，解释了如何使用[Plastic SCM](http://www.plasticscm.com/)进行操作。
*   最后，我在 Duvall 关于 CI 的书中发现了一些关于 CI（以及可能谈论分支）的主题[也非常有趣](http://codicesoftware.blogspot.com/2008/03/continuous-integration-future.html)。

希望您发现这些链接很有趣。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-03T06:28:12.480

答案取决于您的团队规模、源代码控制质量以及正确合并复杂变更集的能力。例如，在 CVS 或 SVN 等完整的分支源代码控制中，合并可能很困难，使用第一个模型可能会更好，而如果使用 IBM ClearCase 等更复杂的系统并且团队规模更大，则使用第二个模型可能会更好模型或两者的组合。

我个人会分离功能分支模型，其中每个主要功能都在一个单独的分支上开发，每个开发人员完成的每个更改都有任务子分支。随着功能的稳定，它们会合并到主干，您可以保持相当稳定并始终通过所有回归测试。当您接近发布周期结束并且所有功能分支合并时，您将稳定并分支发布系统分支，您只在该分支上进行稳定性错误修复和必要的反向移植，而主干用于下一个版本的开发，您再次使用分支新功能分支。等等。

这种方式主干始终包含最新的代码，但您设法保持它相当稳定，在重大更改和功能合并上创建稳定的标签（标签），功能分支是快速开发的持续集成，并且单个任务子分支可以经常从功能分支刷新，以使每个人都在同步处理相同的功能，同时不影响其他团队处理不同的功能。

同时，您拥有一组发布分支的历史记录，您可以在其中为您的客户提供向后移植、支持和错误修复，无论出于何种原因，这些客户仍使用您产品的先前版本，甚至只是最新发布的版本。与主干一样，您无需在发布分支上设置持续集成，它们会在通过所有回归测试和其他发布质量控制后仔细集成。

如果由于某种原因两个特性相互依赖并且需要相互更改，您可以考虑在同一个特性分支上开发两者，或者要求特性定期将代码的稳定部分合并到主干，然后从中继在中继分支之间交换代码。或者，如果您需要将这两个特性与其他特性隔离开来，您可以创建一个公共分支，将这些特性分支从该分支上分支出来，您可以使用它在特性之间交换代码。

上述模型对于 50 人以下的开发人员和没有稀疏分支和适当合并能力（如 CVS 或 SVN）的源代码控制系统没有多大意义，这只会使整个模型成为设置、管理和集成的噩梦。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-28T07:50:14.667

我个人觉得拥有一个稳定的主干并进行功能分支要干净得多。这样，测试人员和类似人员就可以停留在一个“版本”上并从主干更新以测试代码完整的任何功能。

此外，如果多个开发人员正在开发不同的功能，他们都可以拥有自己的独立分支，然后在完成后合并到主干并发送要测试的功能，而测试人员不必切换到多个分支来测试不同的功能。

作为一个额外的好处，有一定程度的自动集成测试。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-03-21T07:17:47.543

如果您需要维护应用程序的多个版本，发布分支非常有用，甚至是绝对必要的。

功能分支也非常方便，特别是如果一个开发人员需要进行巨大的更改，而其他人仍在发布新版本。

所以对我来说，使用这两种机制是一个非常好的策略。

[来自SVN 书的](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.commonpatterns.html)有趣链接。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-06-27T21:32:48.993

我认为这两种策略都可以用于持续开发，只要您记住每个开发人员每天都致力于主干/主线的关键原则之一。

[http://martinfowler.com/articles/continuousIntegration.html#EveryoneCommitsToTheMainlineEveryDay](http://martinfowler.com/articles/continuousIntegration.html#EveryoneCommitsToTheMainlineEveryDay)

编辑

我一直在阅读[这本](https://rads.stackoverflow.com/amzn/click/com/0321601912)关于 CI 的书，作者建议按发布进行分支是他们首选的分支策略。我不得不同意。使用 CI 时，按功能分支对我来说毫无意义。

我会试着解释为什么我会这样想。假设三个开发人员每个人都有一个分支来开发一个功能。每个功能都需要几天或几周才能完成。为了确保团队持续集成，他们必须每天至少提交一次主分支。一旦他们开始这样做，他们就会失去创建功能分支的好处。他们的更改不再与所有其他开发人员的更改分开。既然如此，何必一开始就创建特征分支呢？

使用发布分支需要更少的分支之间的合并（总是一件好事），确保所有更改尽快集成并且（如果正确完成）确保您的代码库始终准备好发布。按版本分支的不利方面是您必须对更改更加小心。例如，大型重构必须逐步完成，如果您已经集成了下一个版本中不需要的新功能，那么必须使用某种[功能切换](http://martinfowler.com/bliki/FeatureToggle.html)机制将其隐藏。

另一个编辑

关于这个问题有不止一种意见。这是一篇关于使用 CI 进行专业功能分支的博客文章

[http://jamesmckay.net/2011/07/why-does-martin-fowler-not-understand-feature-branches/](http://jamesmckay.net/2011/07/why-does-martin-fowler-not-understand-feature-branches/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-03-21T07:36:17.660

我最近在使用 git 时喜欢上[了这个模型。](http://nvie.com/git-model)尽管您的问题被标记为“svn”，但您仍然可以使用它。

持续集成在某种程度上可以发生在该模型的“开发”分支（或任何你称之为的分支）中，尽管为未来的版本提供长期运行的功能分支不会使它变得如此僵硬，以至于考虑到某处代码发生的每一个变化。问题仍然存在，你是否真的想要那样。[马丁·福勒做到了。](http://martinfowler.com/bliki/FeatureBranch.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-15T23:49:36.613

只要你理解原则，你总是可以重新发明最佳实践。如果您不了解原则，那么最佳实践将使您在由于某些相互冲突的外部要求而崩溃之前走得那么远。

有关 Mainline 模型的最佳介绍，请阅读：[https ://web.archive.org/web/20120304070315/http://oreilly.com/catalog/practicalperforce/chapter/ch07.pdf](https://web.archive.org/web/20120304070315/http://oreilly.com/catalog/practicalperforce/chapter/ch07.pdf)

阅读链接。掌握基础知识后，请阅读以下由 Henrik Kniberg 撰写的文章。它将帮助您将 Mainline 模型与持续集成联系起来。

[http://www.infoq.com/articles/agile-version-control](http://www.infoq.com/articles/agile-version-control)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-03-21T07:34:20.643

持续集成不应成为确定分支策略的任何因素。您的分支方法应根据您的团队、正在开发的系统和您可用的工具来选择。

话说回来 ...

*   没有理由不能在您描述的两种方法中使用 CI
*   这些方法结合起来效果很好
*   两者都没有比另一个“更好”
*   CI 对不稳定的主干完全有意义

所有这些都在您从中获取图表的页面上的第四个问题中得到了回答：http: [//blogs.collab.net/subversion/2007/11/branching-strat/](http://blogs.collab.net/subversion/2007/11/branching-strat/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-06-22T02:17:25.227

当我们开始我们的团队时，我们从最初开发我们即将负责的系统的供应商那里继承了基于发布的策略。它一直有效，直到我们的客户要求不应在一个版本中包含几个已开发的功能（仅供参考~250k 行代码，~2500 个文件，带有 XP SDLC 的 Scrum）。

然后我们开始研究基于特征的分支。这也工作了一段时间——比如 2 个月，直到我们意识到我们的回归测试过程将花费 2 多周的时间，再加上将发布的内容的不确定性，造成了巨大的不便。

当我们决定我们应该拥有 1\. 稳定的主干和 2\. 生产应该包含 ST、UAT 和回归测试的二进制文件（不仅仅是源 - 想想 CC。）

这导致我们设计了一种混合了功能和基于发布的 SC 策略的策略。

所以我们有一个后备箱。每个 sprint 我们都会分支出 sprint 分支（对于非敏捷的人 - 一个 sprint 只是一个有时间限制的开发工作，具有基于复杂性的可变输出。）从 sprint 分支我们创建功能分支并在其中开始并行开发。一旦功能完成并经过系统测试，并且我们收到部署它们的意图，它们就会被合并到 sprint 分支 - 有些可能会跨越多个 sprint，通常是更复杂的。一旦 sprint 接近尾声并且功能完成......我们将 sprint 分支“重命名”为“regression”（这允许 CruiseControl 无需任何重新配置​​即可拾取它），然后在 cc-built 上开始回归/集成测试耳朵。当这一切都完成后，它就会投入生产。

简而言之，基于特性的分支用于开发、系统测试和 UAT 功能。sprint 分支（实际上是发布分支）用于选择性地按需合并功能和集成测试。

现在向社区提出一个问题——我们显然在执行持续集成时遇到了麻烦，因为开发发生在许多分支上以及 CruiseControl 的重新配置开销。有人可以建议和建议吗？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-03-22T01:29:59.907

[持续交付](https://rads.stackoverflow.com/amzn/click/com/0321601912)的作者[Dave Farley](http://www.davefarley.net)将[基于主干的开发 (TBD)](https://trunkbaseddevelopment.com/)称为持续集成 (CI) 和持续交付 (CD) 的基石。他说：

> 任何形式的分支都是与持续集成对立的。

他还说，

> 从单个开发人员的角度来看，功能分支非常好，但从团队的角度来看却不是最佳的。我们都希望能够忽略其他人正在做的事情并继续我们的工作。不幸的是，代码不是那样的。即使在具有漂亮的关注点分离和极好的松散耦合组件的非常好的代码库中，一些更改也会影响系统的其他部分。

[基于主干的开发 (TBD)](https://trunkbaseddevelopment.com/)是将代码更改集成到主干（又名主线、主线）中的做法，每天至少一次 - 最好每天多次。持续集成 (CI) 是一种类似的做法，只是它还涉及使用自动化测试来验证代码更改。最好的分支策略是直接在主干上工作，并通过[Pair-Programming](http://www.extremeprogramming.org/rules/pair.html)执行代码审查。如果由于某种原因您无法配对，或者您只是真的想分支，请确保您的分支是短暂的（少于一天）。

> 我在 Trunk 上工作，我的 GIT 存储库中的“大师”。我承诺在本地掌握并在联网时立即推送到运行 CI 的中央主存储库。而已！

对于大型功能（即需要超过一天时间的功能），请尝试将它们分解成小的逻辑块，这些逻辑块可以集成到主干中而不会破坏软件。您还可以使用[特征标记](https://martinfowler.com/articles/feature-toggles.html)和[抽象分支](https://trunkbaseddevelopment.com/branch-by-abstraction)等技术，这些技术允许您在不影响最终用户的情况下部署不完整的工作。

> 我通过抽象、暗释放和有时特征标志使用分支。我得到的回报是快速、明确的（至少对我的测试质量而言）反馈。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-28T08:01:06.013

在我看来，您希望拥有一组有限的分支，您可以集中精力。由于您想要测试、代码质量指标和许多有趣的东西与构建一起运行，因此拥有太多报告可能会让您错过信息。

何时以及什么分支，通常取决于团队的规模和正在开发的功能的规模。我认为没有黄金法则。确保您使用可以及早/经常获得反馈的策略，其中包括从功能的一开始就涉及质量。质量位意味着随着团队的发展而自动化，如果您为团队正在构建的大型功能集进行分支，那么您也必须在团队中参与质量。

ps 你从哪里得到这些方法参考？- 不觉得这些图表代表所有选项

**更新 1：**扩展为什么我说这不是黄金法则。基本上对于相对较小的团队，我发现最好使用混合方法。如果它很长并且团队的一部分将继续添加较小的功能，则会创建功能分支。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2014-04-01T13:28:09.503

我认为您使用的工具在这里是一个重要因素。

*   如果您使用的是颠覆，请坚持选项 1 并从分支发布。
*   如果您使用的是 GIT，则选项 2 对您很有效。

# ruby-on-rails - 在 MVC 框架的主布局中显示模型数据的最佳方式

> ID：597712
> 
> 赞同：2
> 
> 时间：2009-02-28T07:50:05.447
> 
> 标签：ruby-on-rails, model-view-controller

我有一个简单的 Rails 应用程序，它对所有页面使用主布局。我想在这个布局中有一个显示模型数据的页脚，这样无论你在哪个页面上都可以看到数据。

目前我只有一个控制器，有几个非常简单的视图被渲染到布局中，控制器中没有定义任何操作方法。布局类似于：

```
<div id="footer"><%= controller.get_data %></div> 
```

其中`get_data`，当然，只是从模型中提取数据。这似乎是一种糟糕的方法，因为我无法在不破坏布局的情况下添加更多控制器。

我的问题是：当请求可以由将任何视图呈现到该布局中的任何控制器处理时，从模型中检索要在主布局中显示的数据的最佳方法是什么？get_data 应该在哪里定义，或者有什么更简洁的方法来处理这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T08:58:44.407

你可以这样做：

使用访问器方法定义通用控制器实例变量来存储当前模型类和实例：

```
class ApplicationController
  attr_accessor :current_model_class, :current_model_instance
  helper_method :current_model_class, :current_model_instance
end 
```

特别是控制器为它们分配值（您也可以将它放在一些过滤器之前或之后）：

```
class SomeController < ApplicationController
  def index
    self.current_model_instance = SomeModel.find(params[:id])
    self.current_model_class = SomeModel
  end
end 
```

在将获取布局数据的所有模型中定义相同的类和实例方法：

```
class SomeModel < ActiveRecord::Base
  def self.get_data
    # get class specific data
  end

  def get_data
    # get instance specific data
  end

end 
```

并在您的布局文件中使用它：

```
<div id="footer"><%= current_model_instance.get_data %></div> 
```

或者

```
<div id="footer"><%= current_model_class.get_data %></div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-22T18:17:39.993

您也可以使用 a`before_filter`来执行此操作`ApplicationController`：

```
class ApplicationController < ActionController::Base
   before_filter :set_footer_data

   def set_footer_data
      @footer_data = MyModel.find(params[:id])
   end
end 
```

然后在您的布局中：

```
<div id="footer"><%= @footer_data %> </div> 
```

# vim - Vim 复制粘贴

> ID：597715
> 
> 赞同：5
> 
> 时间：2009-02-28T07:51:34.910
> 
> 标签：vim, replace, copy-paste

我之前的问题似乎有点模棱两可，我重新表述一下：

我有一个这样的文件：

```
copythis abc
replacethis1 xyz
qwerty replacethis2
hasfshd replacethis3 fslfs
And so on... 
```

**注意：** replacethis1、replacethis2、replacethis3、... 可以是任何单词

如何使用最少的 vim 命令将 "replacethis1","re​​placethis2","re​​placethis3",.. 单词替换为 "copythis" 单词。

我可以做的一种方法是通过以下步骤：

1.  使用 'dw' 删除 "replacethis1","re​​placethis2","re​​placethis3",..
2.  使用 'yw' 复制“copythis”
3.  将光标移动到“replacethis1”所在的位置并执行“p”；将光标移动到“replacethis2”所在的位置并执行“p”等等...

在 VIM 中是否有更好的方法（使用较少数量的 vim 命令）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T08:09:02.437

既然你改变了你的问题，我会这样做：

移动到第一个“replacethis1”并键入 cw（更改单词），然后手动键入“copythis”。

移动到下一个“replacethis”，点击 。（重复上一次操作）

移动到下一个“replacethis”，点击 .,

等等等等。

如果“copythis”是一个小词，我认为这是最好的解决方案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T12:31:42.163

需要包含数字，并且每行可能有多个实例：

```
:%s/replacethis\d/copythis/g 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-28T13:10:41.087

鉴于“replacethis[1-3]”可以是任意不相关的词，在全球范围内执行此操作的最快/最简单的方法是：

```
:%s/replacethis1\|replacethis2\|replacethis3/copythis/g 
```

（请注意，您需要使用 \| 使管道充当“或”。否则，vim 将查找文字 | 字符。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T16:29:42.133

我也为此苦苦挣扎了很长时间，我想我只是想出了最干净的方法：

使用最干净的命令将 copythis 放入寄存器 r：

```
/copythis
"rye 
```

然后去replace，用r的内容替换：

```
/replacethis
cw<CTRL-R>r<ESC> 
```

然后你可以只`n.n.n.n.n.n.n.`为其余的，或者如果它们完全不同，只需转到每个的开头并点击`.`

关键是一步替换和粘贴，以便您`.`以后使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T07:56:28.300

```
:%s/copythis/replacethis/g 
```

用replacethis 替换所有出现的copythis。或者您可以指定一系列行号，例如：

```
:8,10 s/copythis/replacethis/g 
```

请注意，最后的 /g 将告诉它替换所有出现的位置。如果你把它关掉，它只会做第一个。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-28T08:09:39.360

1.  创建此映射：

    :map z cwcopythis^[

    （ ^[ 是转义字符，您可以在 vim 中使用 Ctrl+V Ctrl+[ 键入它）

2.  转到要替换的每个单词并按 z

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-28T07:54:40.693

您是否尝试过字符串替换？

```
%s/replacethis/copythis 
```

许多其他参数可以微调替换。深入了解 Vim 帮助以获取更多详细信息。[这里](http://vim.wikia.com/wiki/Search_and_replace)还有一些例子。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-28T07:58:17.390

如果您需要多次执行基本相同的操作-将一行的第一个单词与下一行的第二个单词交换，我说您可以录制一个宏并在需要时调用它

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-10-18T10:58:59.093

您可以重新映射例如`m`在正常模式下的键以删除光标下的单词并粘贴缓冲区：`:nnoremap m "_diwP`。然后您可以复制所需的单词，将光标移动到要替换的单词上的任意位置并键入`m`。

编辑：映射到 m 是一个坏主意，因为它用于标记位置。`;`但是无论如何你都可以使用eg 。

# c# - 多维数组和 C# 中的数组数组有什么区别？

> ID：597720
> 
> 赞同：490
> 
> 时间：2009-02-28T07:55:41.767
> 
> 标签：c#, multidimensional-array, jagged-arrays

C#中`double[,]`的多维数组和数组数组有什么区别？`double[][]`

如果有区别，每个人的最佳用途是什么？

* * *

## 回答 #1

> 赞同：351
> 
> 时间：2009-02-28T08:07:08.977

数组数组（锯齿数组）比多维数组更快，可以更有效地使用。多维数组有更好的语法。

如果您使用锯齿状和多维数组编写一些简单的代码，然后使用 IL 反汇编程序检查编译的程序集，您将看到锯齿状（或一维）数组的存储和检索是简单的 IL 指令，而多维数组的相同操作是方法总是较慢的调用。

考虑以下方法：

```
static void SetElementAt(int[][] array, int i, int j, int value)
{
    array[i][j] = value;
}

static void SetElementAt(int[,] array, int i, int j, int value)
{
    array[i, j] = value;
} 
```

他们的 IL 如下：

```
.method private hidebysig static void  SetElementAt(int32[][] 'array',
                                                    int32 i,
                                                    int32 j,
                                                    int32 'value') cil managed
{
  // Code size       7 (0x7)
  .maxstack  8
  IL_0000:  ldarg.0
  IL_0001:  ldarg.1
  IL_0002:  ldelem.ref
  IL_0003:  ldarg.2
  IL_0004:  ldarg.3
  IL_0005:  stelem.i4
  IL_0006:  ret
} // end of method Program::SetElementAt

.method private hidebysig static void  SetElementAt(int32[0...,0...] 'array',
                                                    int32 i,
                                                    int32 j,
                                                    int32 'value') cil managed
{
  // Code size       10 (0xa)
  .maxstack  8
  IL_0000:  ldarg.0
  IL_0001:  ldarg.1
  IL_0002:  ldarg.2
  IL_0003:  ldarg.3
  IL_0004:  call       instance void int32[0...,0...]::Set(int32,
                                                           int32,
                                                           int32)
  IL_0009:  ret
} // end of method Program::SetElementAt 
```

使用交错数组时，您可以轻松执行行交换和行调整大小等操作。也许在某些情况下使用多维数组会更安全，但即使是 Microsoft FxCop 也告诉您在使用它来分析项目时应该使用锯齿状数组而不是多维数组。

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2009-02-28T09:34:49.377

多维数组创建了一个很好的线性内存布局，而锯齿状数组意味着几个额外的间接级别。

`jagged[3][6]`在锯齿状数组中查找值的`var jagged = new int[10][5]`工作方式如下：查找索引 3 处的元素（这是一个数组）并查找该数组中索引 6 处的元素（这是一个值）。在这种情况下，对于每个维度，都有一个额外的查找（这是一种昂贵的内存访问模式）。

多维数组在内存中线性布局，实际值是通过将索引相乘来找到的。但是，给定数组`var mult = new int[10,30]`，该`Length`多维数组的属性返回元素的总数，即 10 * 30 = 300。

交错数组的`Rank`属性始终为 1，但多维数组可以有任意秩。任何数组的`GetLength`方法都可以用来获取每个维度的长度。对于本例中的多维数组，`mult.GetLength(1)`返回 30。

索引多维数组更快。例如，给定本例中的多维数组`mult[1,7]`= 30 * 1 + 7 = 37，获取该索引 37 处的元素。这是一种更好的内存访问模式，因为只涉及一个内存位置，即数组的基地址。

因此，多维数组分配一个连续的内存块，而锯齿状数组不必是正方形，例如`jagged[1].Length`不必等于`jagged[2].Length`，这对于任何多维数组都是正确的。

### 表现

性能方面，多维数组应该更快。快得多，但由于 CLR 实现非常糟糕，它们不是。

```
 23.084  16.634  15.215  15.489  14.407  13.691  14.695  14.398  14.551  14.252 
 25.782  27.484  25.711  20.844  19.607  20.349  25.861  26.214  19.677  20.171 
  5.050   5.085   6.412   5.225   5.100   5.751   6.650   5.222   6.770   5.305 
```

第一行是锯齿状数组的时序，第二行是多维数组，第三行应该是这样。该程序如下所示，仅供参考，这是在运行单声道时测试的。（Windows 时序有很大不同，主要是由于 CLR 实现的变化）。

在 Windows 上，锯齿状数组的时序要好得多，这与我自己对多维数组查找应该是什么样的解释大致相同，请参见“Single()”。遗憾的是windows JIT编译器真的很笨，不幸的是这使得这些性能讨论变得困难，有太多的不一致之处。

这些是我在 windows 上得到的时间，这里同样处理，第一行是锯齿状数组，第二行是多维数组，第三行是我自己的多维实现，请注意与单声道相比，这在 windows 上慢了多少。

```
 8.438   2.004   8.439   4.362   4.936   4.533   4.751   4.776   4.635   5.864
  7.414  13.196  11.940  11.832  11.675  11.811  11.812  12.964  11.885  11.751
 11.355  10.788  10.527  10.541  10.745  10.723  10.651  10.930  10.639  10.595 
```

源代码：

```
using System;
using System.Diagnostics;
static class ArrayPref
{
    const string Format = "{0,7:0.000} ";
    static void Main()
    {
        Jagged();
        Multi();
        Single();
    }

    static void Jagged()
    {
        const int dim = 100;
        for(var passes = 0; passes < 10; passes++)
        {
            var timer = new Stopwatch();
            timer.Start();
            var jagged = new int[dim][][];
            for(var i = 0; i < dim; i++)
            {
                jagged[i] = new int[dim][];
                for(var j = 0; j < dim; j++)
                {
                    jagged[i][j] = new int[dim];
                    for(var k = 0; k < dim; k++)
                    {
                        jagged[i][j][k] = i * j * k;
                    }
                }
            }
            timer.Stop();
            Console.Write(Format,
                (double)timer.ElapsedTicks/TimeSpan.TicksPerMillisecond);
        }
        Console.WriteLine();
    }

    static void Multi()
    {
        const int dim = 100;
        for(var passes = 0; passes < 10; passes++)
        {
            var timer = new Stopwatch();
            timer.Start();
            var multi = new int[dim,dim,dim];
            for(var i = 0; i < dim; i++)
            {
                for(var j = 0; j < dim; j++)
                {
                    for(var k = 0; k < dim; k++)
                    {
                        multi[i,j,k] = i * j * k;
                    }
                }
            }
            timer.Stop();
            Console.Write(Format,
                (double)timer.ElapsedTicks/TimeSpan.TicksPerMillisecond);
        }
        Console.WriteLine();
    }

    static void Single()
    {
        const int dim = 100;
        for(var passes = 0; passes < 10; passes++)
        {
            var timer = new Stopwatch();
            timer.Start();
            var single = new int[dim*dim*dim];
            for(var i = 0; i < dim; i++)
            {
                for(var j = 0; j < dim; j++)
                {
                    for(var k = 0; k < dim; k++)
                    {
                        single[i*dim*dim+j*dim+k] = i * j * k;
                    }
                }
            }
            timer.Stop();
            Console.Write(Format,
                (double)timer.ElapsedTicks/TimeSpan.TicksPerMillisecond);
        }
        Console.WriteLine();
    }
} 
```

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2009-02-28T08:22:18.380

简单地说，多维数组类似于 DBMS 中的表。
Array of Array（锯齿状数组）让您可以让每个元素保存另一个相同类型的可变长度数组。

因此，如果您确定数据的结构看起来像一个表（固定的行/列），您可以使用多维数组。锯齿状数组是固定元素，每个元素可以容纳一个可变长度的数组

例如伪代码：

```
int[,] data = new int[2,2];
data[0,0] = 1;
data[0,1] = 2;
data[1,0] = 3;
data[1,1] = 4; 
```

将上述内容视为 2x2 表：

> ```
> 1 | 2
> 3 | 4 
> ```

```
int[][] jagged = new int[3][]; 
jagged[0] = new int[4] {  1,  2,  3,  4 }; 
jagged[1] = new int[2] { 11, 12 }; 
jagged[2] = new int[3] { 21, 22, 23 }; 
```

将上述内容视为具有可变列数的每一行：

> ```
>  1 |  2 |  3 | 4
> 11 | 12
> 21 | 22 | 23 
> ```

* * *

## 回答 #4

> 赞同：64
> 
> 时间：2017-07-31T07:46:56.053

更新 .NET 6：

随着 .NET 6 的发布，我认为现在是重新审视这个话题的好时机。我为新的 .NET 重写了测试代码并运行它，要求每个部分至少运行一秒钟。基准测试是在 AMD Ryzen 5600x 上完成的。

结果？情况很复杂。对于较小和较大的阵列（< ~25x25x25 & > ~200x200x200），单阵列似乎性能最高，而锯齿阵列在两者之间速度最快。不幸的是，从我的测试看来，多维是迄今为止最慢的选择。最好的性能是最快选项的两倍。但！这取决于您需要数组的用途，因为在 50^3 立方体上初始化锯齿状数组可能需要更长的时间，初始化时间大约是单维数组的 3 倍。多维只比单维慢一点。

结论？如果您需要快速代码，请在要运行的机器上自行对其进行基准测试。CPU架构可以完成改变每种方法的相对性能。

数字！

```
Method name         Ticks/Iteration     Scaled to the best
Array size 1x1x1 (10,000,000 iterations):
Jagged:             0.15                4.28
Single:             0.035               1
Multi-dimensional:  0.77                22

Array size 10x10x10 (25,000 iterations):
Jagged:             15                  1.67
Single:             9                   1
Multi-dimensional:  56                  6.2

Array size 25x25x25 (25,000 iterations):
Jagged:             157                 1.3
Single:             120                 1
Multi-dimensional:  667                 5.56

Array size 50x50x50 (10,000 iterations):
Jagged:             1,140               1
Single:             2,440               2.14
Multi-dimensional:  5,210               4.57

Array size 100x100x100 (10,000 iterations):
Jagged:             9,800               1
Single:             19,800              2
Multi-dimensional:  41,700              4.25

Array size 200x200x200 (1,000 iterations):
Jagged:             161,622             1
Single:             175,507             1.086
Multi-dimensional:  351,275             2.17

Array size 500x500x500 (100 iterations):
Jagged:             4,057.413           1.5
Single:             2,709,301           1
Multi-dimensional:  5,359,393           1.98 
```

不相信我？自己运行并验证。

注意：恒定大小似乎为锯齿状数组提供了优势，但不足以改变我的基准测试中的顺序。在某些情况下，我测量到使用用户输入的大小来处理锯齿状数组时性能会降低约 7%，单个数组没有差异，而多维数组的差异非常小（约 1% 或更少）。它在锯齿状阵列带头的中间最为突出。

```
 using System.Diagnostics;

const string Format = "{0,7:0.000} ";
const int TotalPasses = 25000;
const int Size = 50;
Stopwatch timer = new();

var functionList = new List<Action> { Jagged, Single, SingleStandard, Multi };

Console.WriteLine("{0,5}{1,20}{2,20}{3,20}{4,20}", "Run", "Ticks", "ms", "Ticks/Instance", "ms/Instance");

foreach (var item in functionList)
{
    var warmup = Test(item);
    var run = Test(item);

    Console.WriteLine($"{item.Method.Name}:");
    PrintResult("warmup", warmup);
    PrintResult("run", run);
    Console.WriteLine();
}

static void PrintResult(string name, long ticks)
{
    Console.WriteLine("{0,10}{1,20}{2,20}{3,20}{4,20}", name, ticks, string.Format(Format, (decimal)ticks / TimeSpan.TicksPerMillisecond), (decimal)ticks / TotalPasses, (decimal)ticks / TotalPasses / TimeSpan.TicksPerMillisecond);
}

long Test(Action func)
{
    timer.Restart();
    func();
    timer.Stop();
    return timer.ElapsedTicks;
}

static void Jagged()
{
    for (var passes = 0; passes < TotalPasses; passes++)
    {
        var jagged = new int[Size][][];
        for (var i = 0; i < Size; i++)
        {
            jagged[i] = new int[Size][];
            for (var j = 0; j < Size; j++)
            {
                jagged[i][j] = new int[Size];
                for (var k = 0; k < Size; k++)
                {
                    jagged[i][j][k] = i * j * k;
                }
            }
        }
    }
}

static void Multi()
{
    for (var passes = 0; passes < TotalPasses; passes++)
    {
        var multi = new int[Size, Size, Size];
        for (var i = 0; i < Size; i++)
        {
            for (var j = 0; j < Size; j++)
            {
                for (var k = 0; k < Size; k++)
                {
                    multi[i, j, k] = i * j * k;
                }
            }
        }
    }
}

static void Single()
{
    for (var passes = 0; passes < TotalPasses; passes++)
    {
        var single = new int[Size * Size * Size];
        for (var i = 0; i < Size; i++)
        {
            int iOffset = i * Size * Size;
            for (var j = 0; j < Size; j++)
            {
                var jOffset = iOffset + j * Size;
                for (var k = 0; k < Size; k++)
                {
                    single[jOffset + k] = i * j * k;
                }
            }
        }
    }
}

static void SingleStandard()
{
    for (var passes = 0; passes < TotalPasses; passes++)
    {
        var single = new int[Size * Size * Size];
        for (var i = 0; i < Size; i++)
        {
            for (var j = 0; j < Size; j++)
            {
                for (var k = 0; k < Size; k++)
                {
                    single[i * Size * Size + j * Size + k] = i * j * k;
                }
            }
        }
    }
} 
```

经验教训：始终在基准测试中包含 CPU，因为它会有所作为。这次做了吗？我不知道，但我怀疑它可能已经。

* * *

原答案：

我想对此进行更新，因为在**.NET Core 中，多维数组比锯齿状数组更快**。我从[John Leidegren](https://stackoverflow.com/a/597790/2422905)运行了测试，这些是 .NET Core 2.0 预览版 2 上的结果。我增加了维度值以使来自后台应用程序的任何可能影响不那么明显。

```
Debug (code optimalization disabled)
Running jagged 
187.232 200.585 219.927 227.765 225.334 222.745 224.036 222.396 219.912 222.737 

Running multi-dimensional  
130.732 151.398 131.763 129.740 129.572 159.948 145.464 131.930 133.117 129.342 

Running single-dimensional  
 91.153 145.657 111.974  96.436 100.015  97.640  94.581 139.658 108.326  92.931 

Release (code optimalization enabled)
Running jagged 
108.503 95.409 128.187 121.877 119.295 118.201 102.321 116.393 125.499 116.459 

Running multi-dimensional 
 62.292  60.627  60.611  60.883  61.167  60.923  62.083  60.932  61.444  62.974 

Running single-dimensional 
 34.974  33.901  34.088  34.659  34.064  34.735  34.919  34.694  35.006  34.796 
```

我调查了拆卸，这就是我发现的

`jagged[i][j][k] = i * j * k;`需要 34 条指令来执行

`multi[i, j, k] = i * j * k;`需要 11 条指令来执行

`single[i * dim * dim + j * dim + k] = i * j * k;`需要 23 条指令来执行

我无法确定为什么一维数组仍然比多维数组快，但我的猜测是它与 CPU 上的一些优化有关

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2013-10-28T16:23:47.340

**前言：**此评论旨在解决[okutane 提供的答案](https://stackoverflow.com/a/597729)，但由于 SO 的愚蠢声誉系统，我无法将其发布在它所属的地方。

由于方法调用而导致一个比另一个慢的断言是不正确的。由于更复杂的边界检查算法，一个比另一个慢。您可以通过查看而不是查看 IL 而是查看已编译的程序集来轻松验证这一点。例如，在我的 4.5 安装中，访问存储在 ecx 指向的二维数组中的元素（通过 edx 中的指针），索引存储在 eax 和 edx 中，如下所示：

```
sub eax,[ecx+10]
cmp eax,[ecx+08]
jae oops //jump to throw out of bounds exception
sub edx,[ecx+14]
cmp edx,[ecx+0C]
jae oops //jump to throw out of bounds exception
imul eax,[ecx+0C]
add eax,edx
lea edx,[ecx+eax*4+18] 
```

在这里，您可以看到方法调用没有开销。由于非零索引的可能性，边界检查非常复杂，这是锯齿状数组不提供的功能。如果我们删除非零情况的 sub、cmp 和 jmps，代码几乎可以解析为`(x*y_max+y)*sizeof(ptr)+sizeof(array_header)`. 这种计算与随机访问元素的任何其他计算一样快（一个乘法可以用移位代替，因为这就是我们选择字节大小为两位的幂的全部原因）。

另一个复杂情况是，在许多情况下，现代编译器会在迭代一维数组时优化元素访问的嵌套边界检查。结果是基本上只是在数组的连续内存上推进一个索引指针的代码。多维数组的简单迭代通常涉及额外的嵌套逻辑层，因此编译器不太可能优化操作。因此，即使访问单个元素的边界检查开销摊销到关于数组维度和大小的恒定运行时，一个简单的测试用例来测量差异可能需要很多倍的时间来执行。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-02-28T20:23:18.223

多维数组是 (n-1) 维矩阵。

`int[,] square = new int[2,2]`方阵也是2x2，立方体`int[,,] cube = new int [3,3,3]`是3x3的方阵。不需要比例性。

锯齿状数组只是数组的数组 - 每个单元格都包含一个数组的数组。

所以MDA是成比例的，JD可能不是！每个单元格可以包含一个任意长度的数组！

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-09-02T21:46:06.637

上面的答案中可能已经提到了这一点，但没有明确提到：使用锯齿状数组，您可以使用它`array[row]`来引用整行数据，但这对于多维数组是不允许的。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-06-16T17:53:40.033

除了其他答案之外，请注意，多维数组被分配为堆上的一个大块对象。这有一些含义：

1.  一些多维数组将在大对象堆 (LOH) 上分配，否则它们的等效锯齿状数组对应物将没有。
2.  GC 需要找到一个连续的空闲内存块来分配多维数组，而锯齿状数组可能能够填补由堆碎片引起的空白......这在 .NET 中通常不是问题，因为压缩，但 LOH 默认情况下不会被压缩（您必须要求它，并且每次需要时都必须要求它）。
3.  如果您只使用锯齿状数组，您将需要在**问题**[`<gcAllowVeryLargeObjects>`](https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/runtime/gcallowverylargeobjects-element)出现之前研究多维数组。

 *** * *

## 回答 #9

> 赞同：3
> 
> 时间：2021-03-13T17:07:34.190

我想我会在未来加入 .NET 5 的一些性能结果，因为这将是每个人从现在开始使用的平台。

这些与[John Leidegren](https://stackoverflow.com/a/597790/6140277)使用的测试相同（2009 年）。

我的结果（.NET 5.0.1）：

```
 Debug:
  (Jagged)
  5.616   4.719   4.778   5.524   4.559   4.508   5.913   6.107   5.839   5.270

  (Multi)
  6.336   7.477   6.124   5.817   6.516   7.098   5.272   6.091  25.034   6.023

  (Single)
  4.688   3.494   4.425   6.176   4.472   4.347   4.976   4.754   3.591   4.403

  Release(code optimizations on):
  (Jagged)
  2.614   2.108   3.541   3.065   2.172   2.936   1.681   1.724   2.622   1.708

  (Multi)
  3.371   4.690   4.502   4.153   3.651   3.637   3.580   3.854   3.841   3.802

  (Single)
  1.934   2.102   2.246   2.061   1.941   1.900   2.172   2.103   1.911   1.911 
```

在 6 核 3.7GHz AMD Ryzen 1600 机器上运行。

看起来性能比仍然大致相同。我想说除非你真的很努力地优化，否则只使用多维数组，因为语法更容易使用。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-02-02T17:56:24.063

我正在解析由 ildasm 生成的 .il 文件，以构建用于进行转换的程序集、类、方法和存储过程的数据库。我遇到了以下内容，这打破了我的解析。

```
.method private hidebysig instance uint32[0...,0...] 
        GenerateWorkingKey(uint8[] key,
                           bool forEncryption) cil managed 
```

Serge Lidin，Apress 出版的 Expert .NET 2.0 IL Assembler 一书于 2006 年出版，第 8 章，原始类型和签名，第 149-150 页进行了解释。

`<type>[]`称为 的向量`<type>`，

`<type>[<bounds> [<bounds>**] ]`被称为数组`<type>`

`**`手段可以重复，`[ ]`手段可选。

例子：让`<type> = int32`。

1)`int32[...,...]`是未定义下界和大小的二维数组

2)`int32[2...5]`是一个下界为 2、大小为 4 的一维数组。

3)`int32[0...,0...]`是一个下界为 0 且大小未定义的二维数组。

汤姆

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-10-12T14:29:32.670

# 锯齿状数组是数组或数组的数组，其中每一行都包含一个自己的数组。

这些数组的长度可以不同于其他行中的长度。

### 声明和分配数组数组

与常规多维数组相比，锯齿状数组的声明的唯一区别是我们不只有一对括号。对于锯齿状数组，我们每个维度都有一对括号。我们以这种方式分配它们：

```
int[][] exampleJaggedArray;
jaggedArray = new int[2][];
jaggedArray[0] = new int[5];
jaggedArray[1] = new int[3];
```

### 初始化数组数组

```
int[][] exampleJaggedArray = {
new int[] {5, 7, 2},
new int[] {10, 20, 40},
new int[] {3, 25}
};
```

### 内存分配

锯齿状数组是引用的聚合。锯齿状数组不直接包含任何数组，而是有指向它们的元素。大小是未知的，这就是为什么 CLR 只保留对内部数组的引用。在我们为交错数组的一个数组元素分配内存后，引用开始指向动态内存中新创建的块。

变量exampleJaggedArray存储在程序的执行栈中，指向动态内存中的一个块，其中包含对内存中其他三个块的三个引用的序列；它们中的每一个都包含一个整数数组——锯齿状数组的元素：

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-06-11T09:36:51.970

使用基于[John Leidegren](https://stackoverflow.com/a/597790/10088007)的测试，我使用 .NET 4.7.2 对结果进行了基准测试，这是与我的目的相关的版本，我认为我可以分享。我最初是从 dotnet core GitHub 存储库中的[这条评论开始的。](https://github.com/dotnet/core/issues/2279#issuecomment-459932410)

似乎随着阵列大小的变化，性能变化很大，至少在我的设置中，1 处理器至强处理器具有 4 物理 8 逻辑。

w = 初始化一个数组，并将 int i * j 放入其中。wr = do w，然后在另一个循环中将 int x 设置为 [i,j]

随着数组大小的增长，多维似乎表现得更好。

| 尺寸 | 读写 | 方法 | 意思是 | 错误 | 标准差 | Gen 0/1k 运算 | Gen 1/1k 运算 | Gen 2/1k 运算 | 分配的内存/操作 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1800*500 | w | 锯齿状 | 2.445 毫秒 | 0.0959 毫秒 | 0.1405 毫秒 | 578.1250 | 281.2500 | 85.9375 | 3.46 MB |
| 1800*500 | w | 多 | 3.079 毫秒 | 0.2419 毫秒 | 0.3621 毫秒 | 269.5313 | 269.5313 | 269.5313 | 3.43 MB |
| 2000*4000 | w | 锯齿状 | 50.29 毫秒 | 3.262 毫秒 | 4.882 毫秒 | 5937.5000 | 3375.0000 | 937.5000 | 30.62 MB |
| 2000*4000 | w | 多 | 26.34 毫秒 | 1.797 毫秒 | 2.690 毫秒 | 218.7500 | 218.7500 | 218.7500 | 30.52 MB |
| 2000*4000 | 写 | 锯齿状 | 55.30 毫秒 | 3.066 毫秒 | 4.589 毫秒 | 5937.5000 | 3375.0000 | 937.5000 | 30.62 MB |
| 2000*4000 | 写 | 多 | 32.23 毫秒 | 2.798 毫秒 | 4.187 毫秒 | 285.7143 | 285.7143 | 285.7143 | 30.52 MB |
| 1000*2000 | 写 | 锯齿状 | 11.18 毫秒 | 0.5397 毫秒 | 0.8078 毫秒 | 1437.5000 | 578.1250 | 234.3750 | 7.69 MB |
| 1000*2000 | 写 | 多 | 6.622 毫秒 | 0.3238 毫秒 | 0.4847 毫秒 | 210.9375 | 210.9375 | 210.9375 | 7.63 MB |

更新：最后两个测试使用 double[,] 而不是 int[,]。考虑到错误，差异似乎很大。对于 int，jagged 与 md 的均值比率在 1.53x 和 1.86x 之间，对于 doubles，它是 1.88x 和 2.42x。

| 尺寸 | 读写 | 方法 | 意思是 | 错误 | 标准差 | Gen 0/1k 运算 | Gen 1/1k 运算 | Gen 2/1k 运算 | 分配的内存/操作 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1000*2000 | 写 | 锯齿状 | 26.83 毫秒 | 1.221 毫秒 | 1.790 毫秒 | 3062.5000 | 1531.2500 | 531.2500 | 15.31 MB |
| 1000*2000 | 写 | 多 | 12.61 毫秒 | 1.018 毫秒 | 1.524 毫秒 | 156.2500 | 156.2500 | 156.2500 | 15.26 MB |

# jquery - 将图像绑定到 dom 元素

> ID：597725
> 
> 赞同：0
> 
> 时间：2009-02-28T08:01:16.743
> 
> 标签：jquery, ajax

我正在尝试为网络摄像头制作更新功能。到目前为止，它所做的是进行 ajax 调用并提供图像的 Url。我在将结果（加载图像后）绑定到 dom 元素（ccam）时遇到了一些问题。

```
function update() {
  $('#loading').show('fast');   

  $.ajax({
    type: 'POST',
    url: 'cam.php',
    data: 'img=<? echo $cam_id; ?>',
    timeout: 2000,
    cache: false,       
    success: function(data) {
      window.setTimeout(update, 20000);
       $('#currcam').hide();   
       $('#daycam').show(); 
       $('#loading').hide('fast');
       $('#ccam')
          .append(img)
          .append(html);
        // now show the image
        $(img).fadeIn();
    }, 
    error: function (XMLHttpRequest, textStatus, errorThrown) {
      $("#loading").html('Timeout contacting server..');
      window.setTimeout(update, 60000);
    }
  });
}

$(document).ready(update); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-28T10:51:36.243

在我回答你的问题之前，请说明这里发生了什么：

```
$('#ccam').append(img).append(html); 
```

`img`var 中有什么，var中有什么`html`？

# mysql - 备份 MySQL 用户

> ID：597732
> 
> 赞同：34
> 
> 时间：2009-02-28T08:09:07.897
> 
> 标签：mysql, database, database-design, migration, backup

如何备份 MySQL 用户及其权限？

像mysqldump这样的东西吗？

我正在寻找类似的东西：

```
mysqldump -d -u root -p MyTable > Schema.sql 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2012-02-23T09:56:13.517

```
mysql -BNe "select concat('\'',user,'\'@\'',host,'\'') from mysql.user where user != 'root'" | \
while read uh; do mysql -BNe "show grants for $uh" | sed 's/$/;/; s/\\\\/\\/g'; done > grants.sql 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2012-09-28T06:19:51.440

您可以使用备份mysql数据库

```
mysqldump -u root -p mysql > mysql.sql 
```

并通过执行恢复mysql数据库

```
 mysql -uroot -p mysql < mysql.sql 
```

别忘了

`FLUSH PRIVILEGES`

恢复转储后。

希望能帮助到你...

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-28T09:10:07.203

到目前为止，我对 MySQL 的体验我没有看到任何可以通过命令行备份用户及其权限的东西。

但是我可以通过备份mysql来备份那些关键数据

```
mysqldump -u root -p mysql > mysql.sql 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2018-06-27T04:54:14.827

Percona 有一个很好的工具。`pt-show-grants`将转储用户及其权限，以便您可以轻松地重新加载它们。

[https://www.percona.com/doc/percona-toolkit/LATEST/pt-show-grants.html](https://www.percona.com/doc/percona-toolkit/LATEST/pt-show-grants.html)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-28T09:22:28.327

用户和权限存储在名为“mysql”的数据库中。您可以使用 mysqldump 备份名为“mysql”的数据库中的表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-09-27T14:50:44.813

对于 mysql 命令行可能非常明显，但对于上面的@spirit 答案，必须在两个 mysql 命令之后添加 -u root -ppassword

> mysql -u root -ppassword -BNe "select concat(''',user,''@'',host,''') from mysql.user where user != 'root'" | 一边读一边读；执行 mysql -u root -ppassword -BNe "显示 $uh 的授权" | sed 's/$/;/; s/\\/\/g'; 完成 > grants.sql;

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-08-08T09:27:24.420

好的做法是使用脚本来备份 MySQL 用户及其权限。看一个：

```
#!/bin/sh

HOSTNAME="localhost"

mysql -h $HOSTNAME -B -N -e "SELECT CONCAT('\'', user,'\'@\'', host, '\'') FROM user WHERE user != 'debian-sys-maint' AND user != 'root' AND user != ''" mysql > mysql_all_users_$HOSTNAME.txt

while read line; do mysql -h $HOSTNAME -B -N -e "SHOW GRANTS FOR $line"; done < mysql_all_users_$HOSTNAME.txt > mysql_all_users_$HOSTNAME.sql

sed -i.bak 's/$/;/' mysql_all_users_$HOSTNAME.sql

rm mysql_all_users_$HOSTNAME.txt
rm mysql_all_users_$HOSTNAME.sql.bak 
```

此脚本的结果将是具有用户和权限的 mysqldump 文件。

PS 如果您的 MySQL 需要密码 - 将`-p`或放在两个位置`-u username -p`之后`mysql -h $HOSTNAME`。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-09-10T21:18:33.703

上面给出的脚本给出了总体思路，但它们效率低下。他们正在分叉/执行 mysql n+1 次。只需两次调用 mysql 即可完成

```
mysql ${logininfo} -B -N -e "SELECT CONCAT('\'',user,'\'@\'',host,'\'') from user where user != 'root'" mysql | \
while read uh
do
   echo "SHOW GRANTS FOR ${uh};"
done | mysql ${logininfo} -B -N | sed -e 's/$/;/' > ${outfile} 
```

如果您不想备份除 root 以外的其他用户，请使用或在第一个 mysql 调用的 where 子句中指定 user != 'whatever' 。

# dll - 使用其他程序员自定义控件

> ID：597737
> 
> 赞同：0
> 
> 时间：2009-02-28T08:11:26.987
> 
> 标签：dll, user-controls, controls, web, custom-server-controls

我正在使用 Scott Mitchell 的 textBox Characters and Words 计数器控件，我从网站[http://www.4guysfromrolla.com/](http://www.4guysfromrolla.com/)下载它并将其解压缩到我的桌面。然后在 VWD Express 2008 中，我在工具箱中创建了一个新选项卡，我从解压缩的文件夹中选择了 *.dll，我使用了控件，一切都很好（尝试一下，我推荐它）但是当我备份我的代码时，复制该站点，并尝试在另一台计算机上运行它，我收到一堆错误，都表明它在我的桌面上寻找 dll 文件，但是当我在我的网站目录中的 bin 文件夹下检查时，dll 就在那里。 ..帮助请...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-28T08:27:22.750

如果查看引用的属性，您可能会发现引用的路径不正确。

我经常发现解决问题的最快方法是用记事本打开项目文件并更正引用的路径。

# svn - SVN 中使用的补丁是什么？

> ID：597739
> 
> 赞同：13
> 
> 时间：2009-02-28T08:15:54.260
> 
> 标签：svn, patch

我猜它允许你“保存”一个合并过程，这样我就可以为一些开源项目创建一个补丁，并提交一个补丁，这样他们就不必自己处理合并？

您何时以及如何在 SVN 中使用补丁？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-28T08:22:51.840

补丁（svn 中的统一差异文件）用于各种情况：

1.  您没有提交访问权限，但您对想要包含的项目进行了一些修改。在这种情况下，您可以根据您的修改创建补丁并将补丁文件发送给具有提交访问权限的人。当然，这并不意味着他们会提交你的补丁，但这会让他们更容易这样做。
2.  你有一些你不想提交的修改。然后，您将补丁文件发送给其他人，以便他们查看您的修改并对其发表评论。

在其他情况下，补丁文件也很有用，但这些都是针对项目的。

如果不使用补丁文件，您将不得不发送所有修改过的文件，这通常会导致更大的 (zip) 文件。

当然，可以将补丁文件应用于已经有自己修改的工作副本——如果您发送整个文件，那些本地修改将被覆盖。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-28T08:23:34.943

补丁供没有直接访问 SVN 存储库的人员使用。他们将其发送给 SVN 用户之一，他/她可能会也可能不会将其合并到 SVN 存储库。

# mysql - 插入日期时出现问题

> ID：597740
> 
> 赞同：0
> 
> 时间：2009-02-28T08:16:24.710
> 
> 标签：mysql

虽然插入日期 mysql 服务器正确使用年和日，但月份默认将 januavary 带入数据库。我正在使用 mysql 服务器版本 5.0.22 我正在通过应用程序插入日期。该应用程序是使用 Springs web mvc 框架和 Hibernate 开发的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T10:29:10.477

你能显示用于将数据插入数据库的 mysql INSERT 语句吗？这将表明它是格式错误的 INSERT 语句还是使用不正确数据的有效语句。

一旦你知道发生了什么，你就可以找出问题的真正所在。我猜这是一个错误的日期解析功能。

另一种可能性是，该软件需要欧洲格式 (dd-mm-yyyy) 的日期并以美国格式 (mm-dd-yyyy) 获取条目，反之亦然。这会导致解析错误。

# xml - 将 Clickonce 与 xml 配置文件一起使用

> ID：597742
> 
> 赞同：0
> 
> 时间：2009-02-28T08:21:07.727
> 
> 标签：xml, clickonce

我有一个要使用 Clickonce 的 Windows 窗体应用程序。

我想为应用程序创建一个自定义 xml 文件。

但是如果我想稍后更改它，即替换它或更新它怎么办。

你会怎么用clickonce做到这一点？

马尔科姆

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-28T09:37:22.693

如果您作为开发人员想要更改 xml 文件，那么您可以发布应用程序的新版本，如果这样配置，您的用户将自动获得更新。

如果用户想要更改它，它就是 PITA，除非您使用设置功能之类的功能并为其提供 GUI。

# java - 音乐转录

> ID：597743
> 
> 赞同：2
> 
> 时间：2009-02-28T08:22:02.793
> 
> 标签：java, fft, onset-detection, audio

我正在做一个复调音乐转录项目。我已经阅读了一些论文并阅读了解释类似任务的文章。我对问题域的许多方面感到非常困惑。希望有人能帮助我。

到目前为止，我已经从给定的 mp3 中获得了解码后的音频数据流。

我知道发病检测是转录的第一步。. 是否有任何可用的 java 库可用于检测发病。

接下来，正如我所读到的，也使用 FFT 来检测基频。

我想知道 FFT 在这些任务中的用途。（我对 FFT 不太熟悉）。是否绝对有必要对发病检测和 F0 检测执行 FFT。如果不是还有什么其他方法。我可以对我拥有的音频流执行 FFT，还是必须执行一些其他操作才能操作这些音频数据。

非常感谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T09:50:39.633

这个领域被称为机器监听。

数字编码音乐的复音转录是机器聆听的圣杯之一。这是一个未解决的问题，也是一个积极研究的领域。子字段包括：

*   发病检测
*   节拍提取（检测度量结构、时间信号等）
*   音高检测（可能在单声道信号上使用自相关和其他方法，但在应用于复杂的复音音乐时是一个未解决的问题）
*   键检测（键签名检测）。

根据项目的性质，您可能会发现探索[SuperCollider](http://supercollider.sf.net "超级对撞机")编程环境很有用。SC 是为此类项目设计的语言，已经拥有大量机器监听插件（ugens），以及用于处理 FFT、音频信号等的综合框架。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-28T08:43:31.480

这个[关于音符开始检测](https://stackoverflow.com/questions/294468/note-onset-detection)的问题包含很多可能对您有用的信息。

这听起来是一个巨大但非常有趣的项目，祝你好运。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-28T08:47:06.510

音乐转录意味着从声音（或音频数据）创建音乐符号。虽然有成就的音乐家，尤其是作曲家能够做到这一点，但使用机器完成这项任务非常困难，据我所知，迄今为止几乎没有成功——主要是学术实验。

基本上，要识别音符，您想知道它们从哪里开始、在哪里结束以及它们的音高。傅里叶变换原则上是将时域（音频数据）转换为频域（音高）的最基本方法。在实践中，乐器会产生很多谐波（泛音），如果我们添加了复音（很多 F0），那就一团糟。

您可以尝试将音频数据的 50 毫秒连续切片馈送到 FFT。这样，您将获得每个切片的频谱，然后检测每个切片中最强的峰值，并根据连续切片之间发生的情况推断节奏。

抱歉，我帮不上什么忙……但我只是想指出，您正在尝试做的事情非常困难，说真的。也许您应该从更简单的事情开始，例如检测单音正弦波旋律。祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-24T14:16:00.653

要检测和弦音乐中旋律的基频，您可以试用 MELODIA vamp 插件（仅限非商业用途）：[http ://mtg.upf.edu/technologies/melodia](http://mtg.upf.edu/technologies/melodia)

如果你想自己实现一个旋律提取算法，你将不得不检查当前最先进的研究，一个很好的起点可能是 MIREX 旋律提取年度评估活动：[http:// www.music-ir.org/mirex/wiki/Audio_Melody_Extraction](http://www.music-ir.org/mirex/wiki/Audio_Melody_Extraction)

那个，或者只是谷歌“旋律提取”；）

# ruby - 如何在另一个类中访问一个类中的实例变量

> ID：597747
> 
> 赞同：0
> 
> 时间：2009-02-28T08:26:16.123
> 
> 标签：ruby, instance-variables

我对Ruby真的很陌生。和新的 - 不到 16 小时，但我的老板给了我一些 Ruby 代码来添加。但是，我发现它是一个巨大的文件，根本不是模块化的，所以我决定清理它。现在我已经将它分解为几个文件/类（一般来说，每个文件 1 个类），我在将它拼凑在一起以使其再次工作时遇到了问题。最初一切都是同一个班级的一部分，所以电话工作，但它看起来很丑，花了一整天的时间才弄明白。我想在未来避免这种情况，因为这段代码在完成之前会变得更大。

我的主要问题如下所示（显然是简化的）：

```
class TestDevice   
   def initialize  
    @loghash = { }  
    ....  
   end  
end   

class Log  
    def self.msg(identifier, level, section, message)  
     ...  
     @loghash[identifier] = { level => { section => message }}  
     ...  
    end  
end  

device = TestDevice.new 
```

之后，它调用其他类方法，这些类方法引用回类 Log 以满足它们的日志记录需求。当然，Log 需要以某种方式访问​​“device.loghash”以将信息记录在该哈希中。但是我不知道如何在将“loghash”的内容传递给每个方法之外实现这一点，以便他们反过来可以传递它，然后将值返回到起始点，然后记录它最后，但这似乎真的很笨拙和尴尬。

我希望我真的只是错过了一些东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T08:44:27.997

要以简单的方式为实例变量创建访问器，请使用`attr_accessor`.

```
class TestDevice   
  attr_accessor :loghash

  def initialize  
    @loghash = { }  
    ....  
  end  
end 
```

您也可以手动定义访问器。

```
class TestDevice
  def loghash
    @loghash
  end
  def loghash=(val)
    @loghash = val
  end
end 
```

这实际上是`attr_accessor`在幕后所做的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T10:38:21.470

将设备对象作为参数传递给 msg 函数怎么样？（我假设您的程序中可以有很多设备，否则您可以使用单例模式）。

```
class TestDevice   
   attr_accessor :loghash

   def initialize  
    @loghash = { }  
    ....  
   end  
end   

class Log  
    def self.msg(device, identifier, level, section, message)  
     ...  
     device.loghash[identifier] = { level => { section => message }}  
     ...  
    end  
end 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T16:40:40.153

所以你需要学习 ruby​​ 作用域的规则。

Ruby 变量具有不同的范围，具体取决于它们的前缀：

*   `$global_variables`以 ,开头，`$`每个人都可以使用。
*   `@instance_variables`以单个 开头`@`，并与 的当前值一起存储`self`。如果两个作用域共享相同的值`self`（例如，它们都是实例方法），那么它们都共享相同的实例变量
*   `@@class_variable`以 ,开头`@@`，并与类一起存储。它们在一个类的所有实例以及该类的所有子类实例之间共享。
*   `Constants`以大写字母开头，并且可能全部大写。像类变量一样，它们与 current 一起存储`self.class`，但它们也会在层次结构中涓涓细流——因此，如果您在模块中定义了一个类，则该类的实例也可以访问该模块的常量。在类之外定义的常量具有全局范围。请注意，常量变量意味着绑定到常量的对象不会改变，而不是对象本身不会改变内部状态。
*   `local_variables`以小写字母开头

[您可以在此处](http://www.ruby-doc.org/docs/ProgrammingRuby/html/language.html#UP)阅读有关范围的更多信息。

`except`局部变量作用域规则主要是标准的——当我们进入模块、类或方法定义时，它们在定义它们的子作用域的所有子作用域中都可用。因此，如果我们从您的答案中查看您的代码

```
class TestDevice   
   attr_accessor :loghash
   def initialize  
    @loghash = { }  
   end  
end   

device = TestDevice.new

class Somethingelse
  def self.something
   device.loghash='something here' # doesn't work
  end
end 
```

在顶层定义的局部变量的范围`device`不包括`Somethingelse.something` 方法定义。所以方法定义中`device`使用的局部变量`Somethingelse.something`是一个不同的（空）变量。如果您希望范围以这种方式工作，您应该使用常量或全局变量。

```
class TestDevice   
   attr_accessor :loghash
   def initialize  
    @loghash = { }  
   end  
end   

DEVICE = TestDevice.new
$has_logged = false

class Somethingelse
  def self.something
   DEVICE.loghash='something here'
   $has_logged = true
  end
end

p DEVICE.loghash  # prints `{}`
p $has_logged     # prints `false`
Somethingelse.something
p DEVICE.loghash  # prints `"something here"`
p $has_logged     # prints `true` 
```

# ruby - 限制 Net::HTTP.request_get 的获取大小

> ID：597757
> 
> 赞同：1
> 
> 时间：2009-02-28T08:47:49.957
> 
> 标签：ruby, http, limit

我想使用 Net:HTTP 从网络服务器获取一些内容，如下所示：

```
url = URI.parse('http://www.example.com/index.html')
res = Net::HTTP.start(url.host, url.port) {|http|
  http.get('/index.html')
}
puts res.body 
```

但我需要将 get 限制在前 5kb 以减少网络流量。我该怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T12:17:36.660

我不确定何时使用 Net::HTTP 但使用 OpenURI 我通常会执行以下操作：

```
require 'open-uri'

resource = open('http://google.com')

resource.read( 5120 ) 
=> # reads first 5120 characters, which i'm assuming would be 5KB. 
```

希望这可以帮助。

# user-interface - 验证应该如何表现

> ID：597758
> 
> 赞同：1
> 
> 时间：2009-02-28T08:48:00.313
> 
> 标签：user-interface, language-agnostic, validation

在非常常见的场景中，您有一个文本框，以及某种限制该文本框上有效条目的验证规则。验证失败应如何影响文本框的内容，尤其是在无效之前输入了有效值的情况下。

示例：想象一个表单，可以输入 0 到 50 之间的数字。用户输入 40。一切都很好。但随后用户进入并将其更改为 59。

显然，恕我直言，应用程序应该尽快通知他他的错误。但是如何处理这些值？我认为应该有一种回到 40 的方法，作为一种回到有效状态的简单方法，但我不确定何时以及如何恢复它：失去焦点？仅在特殊键/按钮按下时？

你怎么看？

编辑：我完全同意前两个答案：自动更改输入是一个坏主意。然而，我想保持“最后一个有效”值可用......也许一个干净的 UnDo 功能可以解决问题？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-28T09:04:12.227

我采用这样的字段验证方法非常简单：

**您不应丢弃用户输入**

如果用户输入的条目无效，请将其标记为 - 但不要更改值。

你背后的原因很简单——一致性。

例如，考虑用于输入日期范围的一对字段，其中“有效”表示开始日期早于结束日期。

现在，用户想要输入一个全新的范围。

如果您的系统立即丢弃无效条目，您会强制用户做出不同的行为。要输入较早的日期范围，必须先输入开始日期；要输入较晚的日期范围，必须先输入最终日期。不友好。

相反，尊重用户的输入——当输入开始日期时，随意将其标记为无效，*但保留该值*。然后，当输入最终日期时，这两个字段现在都有效。

这也是动态显示验证的动机（随着值的变化），但不限制用户在字段之间的移动。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T08:54:47.553

确实取决于您的功能规格，但是回退到以前的正确值听起来像是一个好习惯……对于总是阻塞的阻塞错误。

但是，您真的想在那里阻止您的用户吗？如果在选择选项 b 时有效范围是 0-50，但在选择选项 c 时变为 0-60，该怎么办？用户决定先更改范围值？然后用户会因为失去了她认为完全有效的价值而感到非常沮丧......

在自动恢复用户所做的更改时请记住这一点:) 用户可能犯了一个错误，但也可能是故意做出的更改，因为他将其与他脑海中的另一个更改相关联，但不能同时更改两者在应用程序...

警告该值无效并让 ctrl-Z 取消用户放在那里的东西可能是更明智的默认值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-28T10:17:22.643

@Bevan 你是正义的。

如果你想看看它是多么烦人的例子，打开谷歌分析

当您尝试比较日期时，这种不友好的行为正是 Google Analytics 所做的，它让我**发疯**。

如果您输入的结束日期早于您的开始日期，它会丢弃您的输入，从而强制您按规定的顺序输入信息。

这也意味着小错字可能意味着您被迫重新输入整个日期，这很糟糕。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T11:39:27.047

我同意不更改用户输入的其他答案，您无法判断它可能有什么问题，可能是错字、缺少小数、交换了日/月/年字段等。允许他们执行的撤消选项然而，恢复到以前可能是一个额外的好功能。

我认为的主要项目是： - 在用户通过示例或其他类似指标在表单中输入数据之前，明确有效范围和格式是什么。- 请务必在提交前清楚地指明必填字段。- 限制用户输入验证数据的用户控件 - 日期选择器、旋转控件、仅限数字的控件、文本框上设置的最大长度等 - 在验证失败时明确说明表单上的哪些项目无效和为什么它们无效，而不仅仅是简单的“数据不正确”全局消息，尤其是如果您有一个包含许多字段的长表单可能存在验证问题。

# iphone - 如何防止 UIView 的 drawRect 清除之前 drawRect 调用绘制的路径？

> ID：597760
> 
> 赞同：5
> 
> 时间：2009-02-28T08:54:37.757
> 
> 标签：iphone, cocoa-touch

每次调用 UIView 的 drawRect 时，之前的 drawRect（使用 Core Graphics）绘制的内容都会被清除掉。我怎样才能使之前的 drawRect 调用呈现的路径保持不变，直到我明确清除它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T12:57:26.127

您基本上需要剪辑矩形的“脏”部分，其中已经进行了更改，并且只有这部分会被重新绘制。

```
- (void)setNeedsDisplayInRect:(CGRect)invalidRect 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T22:10:14.823

我自己现在正在与这个问题作斗争。问题是 UIView 上有一个名为“clearsContextBeforeDrawing”的属性，根据文档应该可以解决这个问题，但是根据我的经验，它不能这样工作。

我认为最终的解决方案是分配一个屏幕外缓冲区并在那里完成我的所有绘图，然后在 drawRect 方法中将其传递给 UIView。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T10:19:31.943

我很确定没有办法解决这个问题。这就是 UIView 的设计方式。如果被要求，您的自定义视图应该能够随时绘制其自身的任何部分。这部分是因为视图可以做的不仅仅是出现在屏幕上。例如，它们可以在桌面上打印，甚至在 iPhone 上，您可能希望将视图的内容捕获为位图。

# wpf - WPF：使用旋转方块进行碰撞检测

> ID：597764
> 
> 赞同：3
> 
> 时间：2009-02-28T08:57:42.850
> 
> 标签：wpf, math, rotation, collision-detection

*参考我目前正在构建的[这个编程游戏。](https://stackoverflow.com/questions/505040/developing-a-robocode-type-game-with-net-for-a-school-assignment)*

多亏了[这篇文章](https://stackoverflow.com/questions/581837/wpf-getting-new-coordinates-after-a-rotation)的答案，我现在能够找到矩形所有点的 xy 坐标（即使在旋转时），并且墙壁碰撞检测现在几乎可以完美运行。

现在我需要用机器人自己实现碰撞检测（因为很明显，Arena 中会有不止一个机器人）。

Square-Square Collision Detection (Non-rotated) 在这种情况下无效，因为机器人会以一定角度转动（就像我[在这里](https://stackoverflow.com/questions/581837/wpf-getting-new-coordinates-after-a-rotation)描述的那样）。

**那么在 WPF 中实现这种形式的旋转矩形碰撞检测的最佳方法是什么？**

我想肯定涉及到一些数学，但通常事实证明 WPF 中有一些函数可以为您“计算”这些数学（就像在[这种情况下一样](https://stackoverflow.com/questions/581837/wpf-getting-new-coordinates-after-a-rotation)）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-28T11:37:08.613

## 解决方案

通过使用我发布的作为[上一个问题](https://stackoverflow.com/questions/581837/wpf-getting-new-coordinates-after-a-rotation)的解决方案的方法和称为`IntersectsWith`(from `Rect`) 的 WPF 方法，我能够解决旋转矩形碰撞检测的问题，如下所示：

```
public Rect GetBounds(FrameworkElement of, FrameworkElement from)
{
        // Might throw an exception if of and from are not in the same visual tree
        GeneralTransform transform = of.TransformToVisual(from);

        return transform.TransformBounds(new Rect(0, 0, of.ActualWidth, of.ActualHeight));
}

Vehicle IsBotCollided(IEnumerable<Vehicle> blist)
{
    //currentBounds is of type Rect, which contains the 4 points of the rectangle (even when rotated)
    var currentBounds = GetBounds(BotBody, BattleArena);

    //Then I check if the current bounds intersect with each of the other Bots` bounds that are also in the Arena
    foreach (Vehicle vehicle in blist)
    {
        if(GetBounds(vehicle.BotBody, BattleArena).IntersectsWith(currentBounds))
        {
            return vehicle;
        }
    }
    return null;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T10:05:33.733

我会检查每条线是否有碰撞（所以你最多可以进行 4*4 线碰撞检查，如果两条线发生碰撞，机器人也会这样做，你可以停下来），尽管我确信有更好/更快的方法去做这个。如果矩形可以有不同的大小，您还应该检查较小的是否在另一个内部。

如果您首先检查矩形的旋转 x/y-min/max-value（或者您甚至可以计算机器人周围的两个圆圈并检查它们，这甚至更快），性能可能会略有提高，所以您没有检查线条是否彼此远离。

# javascript - 如何在 JavaScript 中创建抽象基类？

> ID：597769
> 
> 赞同：126
> 
> 时间：2009-02-28T09:06:19.910
> 
> 标签：javascript, oop, abstract

是否可以在 JavaScript 中模拟抽象基类？最优雅的方法是什么？

说，我想做类似的事情： -

```
var cat = new Animal('cat');
var dog = new Animal('dog');

cat.say();
dog.say(); 
```

它应该输出：'bark'，'meow'

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2014-01-19T18:40:17.273

创建抽象类的一种简单方法是：

```
/**
 @constructor
 @abstract
 */
var Animal = function() {
    if (this.constructor === Animal) {
      throw new Error("Can't instantiate abstract class!");
    }
    // Animal initialization...
};

/**
 @abstract
 */
Animal.prototype.say = function() {
    throw new Error("Abstract method!");
} 
```

“`Animal`类”和`say`方法是抽象的。

创建实例会引发错误：

```
new Animal(); // throws 
```

这就是您从中“继承”的方式：

```
var Cat = function() {
    Animal.apply(this, arguments);
    // Cat initialization...
};
Cat.prototype = Object.create(Animal.prototype);
Cat.prototype.constructor = Cat;

Cat.prototype.say = function() {
    console.log('meow');
} 
```

`Dog`看起来很像。

这就是你的场景的结果：

```
var cat = new Cat();
var dog = new Dog();

cat.say();
dog.say(); 
```

[在这里](http://jsfiddle.net/JSeSt/)摆弄（查看控制台输出）。

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2018-01-24T17:10:19.557

## JavaScript 类和继承 (ES6)

根据 ES6，你可以使用 JavaScript 类和继承来完成你所需要的。

> 在 ECMAScript 2015 中引入的 JavaScript 类主要是 JavaScript 现有的基于原型的继承的语法糖。

参考：[https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes)

首先，我们定义我们的抽象类。这个类不能被实例化，但可以扩展。我们还可以定义必须在扩展该类的所有类中实现的函数。

```
/**
 * Abstract Class Animal.
 *
 * @class Animal
 */
class Animal {

  constructor() {
    if (this.constructor == Animal) {
      throw new Error("Abstract classes can't be instantiated.");
    }
  }

  say() {
    throw new Error("Method 'say()' must be implemented.");
  }

  eat() {
    console.log("eating");
  }
} 
```

之后，我们可以创建具体的类。这些类将继承抽象类的所有功能和行为。

```
/**
 * Dog.
 *
 * @class Dog
 * @extends {Animal}
 */
class Dog extends Animal {
  say() {
    console.log("bark");
  }
}

/**
 * Cat.
 *
 * @class Cat
 * @extends {Animal}
 */
class Cat extends Animal {
  say() {
    console.log("meow");
  }
}

/**
 * Horse.
 *
 * @class Horse
 * @extends {Animal}
 */
class Horse extends Animal {} 
```

而结果...

```
// RESULTS

new Dog().eat(); // eating
new Cat().eat(); // eating
new Horse().eat(); // eating

new Dog().say(); // bark
new Cat().say(); // meow
new Horse().say(); // Error: Method say() must be implemented.

new Animal(); // Error: Abstract classes can't be instantiated. 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-02-28T12:50:28.610

你的意思是这样的：

```
function Animal() {
  //Initialization for all Animals
}

//Function and properties shared by all instances of Animal
Animal.prototype.init=function(name){
  this.name=name;
}
Animal.prototype.say=function(){
    alert(this.name + " who is a " + this.type + " says " + this.whattosay);
}
Animal.prototype.type="unknown";

function Cat(name) {
    this.init(name);

    //Make a cat somewhat unique
    var s="";
    for (var i=Math.ceil(Math.random()*7); i>=0; --i) s+="e";
    this.whattosay="Me" + s +"ow";
}
//Function and properties shared by all instances of Cat    
Cat.prototype=new Animal();
Cat.prototype.type="cat";
Cat.prototype.whattosay="meow";

function Dog() {
    //Call init with same arguments as Dog was called with
    this.init.apply(this,arguments);
}

Dog.prototype=new Animal();
Dog.prototype.type="Dog";
Dog.prototype.whattosay="bark";
//Override say.
Dog.prototype.say = function() {
        this.openMouth();
        //Call the original with the exact same arguments
        Animal.prototype.say.apply(this,arguments);
        //or with other arguments
        //Animal.prototype.say.call(this,"some","other","arguments");
        this.closeMouth();
}

Dog.prototype.openMouth=function() {
   //Code
}
Dog.prototype.closeMouth=function() {
   //Code
}

var dog = new Dog("Fido");
var cat1 = new Cat("Dash");
var cat2 = new Cat("Dot");

dog.say(); // Fido the Dog says bark
cat1.say(); //Dash the Cat says M[e]+ow
cat2.say(); //Dot the Cat says M[e]+ow

alert(cat instanceof Cat) // True
alert(cat instanceof Dog) // False
alert(cat instanceof Animal) // True 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-02T13:07:51.937

您可能想查看 Dean Edwards 的基类：[http ://dean.edwards.name/weblog/2006/03/base/](http://dean.edwards.name/weblog/2006/03/base/)

或者，Douglas Crockford 在 JavaScript 中的经典继承上有这个示例/文章：[http ://www.crockford.com/javascript/inheritance.html](http://www.crockford.com/javascript/inheritance.html)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-02-28T11:12:45.210

> 是否可以在 JavaScript 中模拟抽象基类？

当然。有大约一千种方法可以在 JavaScript 中实现类/实例系统。这是一个：

```
// Classes magic. Define a new class with var C= Object.subclass(isabstract),
// add class members to C.prototype,
// provide optional C.prototype._init() method to initialise from constructor args,
// call base class methods using Base.prototype.call(this, ...).
//
Function.prototype.subclass= function(isabstract) {
    if (isabstract) {
        var c= new Function(
            'if (arguments[0]!==Function.prototype.subclass.FLAG) throw(\'Abstract class may not be constructed\'); '
        );
    } else {
        var c= new Function(
            'if (!(this instanceof arguments.callee)) throw(\'Constructor called without "new"\'); '+
            'if (arguments[0]!==Function.prototype.subclass.FLAG && this._init) this._init.apply(this, arguments); '
        );
    }
    if (this!==Object)
        c.prototype= new this(Function.prototype.subclass.FLAG);
    return c;
}
Function.prototype.subclass.FLAG= new Object(); 
```

> var cat = new Animal('cat');

当然，这并不是真正的抽象基类。你的意思是这样的：

```
var Animal= Object.subclass(true); // is abstract
Animal.prototype.say= function() {
    window.alert(this._noise);
};

// concrete classes
var Cat= Animal.subclass();
Cat.prototype._noise= 'meow';
var Dog= Animal.subclass();
Dog.prototype._noise= 'bark';

// usage
var mycat= new Cat();
mycat.say(); // meow!
var mygiraffe= new Animal(); // error! 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2013-09-18T21:04:31.897

```
Animal = function () { throw "abstract class!" }
Animal.prototype.name = "This animal";
Animal.prototype.sound = "...";
Animal.prototype.say = function() {
    console.log( this.name + " says: " + this.sound );
}

Cat = function () {
    this.name = "Cat";
    this.sound = "meow";
}

Dog = function() {
    this.name = "Dog";
    this.sound  = "woof";
}

Cat.prototype = Object.create(Animal.prototype);
Dog.prototype = Object.create(Animal.prototype);

new Cat().say();    //Cat says: meow
new Dog().say();    //Dog says: woof 
new Animal().say(); //Uncaught abstract class! 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-03-07T21:08:05.987

您可能想要强制执行的另一件事是确保您的抽象类没有被实例化。您可以通过定义一个充当 FLAG 设置为抽象类构造函数的函数来做到这一点。然后，这将尝试构造 FLAG，该 FLAG 将调用包含要抛出的异常的构造函数。下面的例子：

```
(function(){

    var FLAG_ABSTRACT = function(__class){

        throw "Error: Trying to instantiate an abstract class:"+__class
    }

    var Class = function (){

        Class.prototype.constructor = new FLAG_ABSTRACT("Class");       
    }

    //will throw exception
    var  foo = new Class();

})() 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-09-19T10:25:28.550

问题很老了，但我创建了一些可能的解决方案，如何创建抽象“类”并阻止创建该类型的对象。

```
//our Abstract class
var Animal=function(){

    this.name="Animal";
    this.fullname=this.name;

    //check if we have abstract paramater in prototype
    if (Object.getPrototypeOf(this).hasOwnProperty("abstract")){

    throw new Error("Can't instantiate abstract class!");

    }

};

//very important - Animal prototype has property abstract
Animal.prototype.abstract=true;

Animal.prototype.hello=function(){

   console.log("Hello from "+this.name);
};

Animal.prototype.fullHello=function(){

   console.log("Hello from "+this.fullname);
};

//first inheritans
var Cat=function(){

	  Animal.call(this);//run constructor of animal

    this.name="Cat";

    this.fullname=this.fullname+" - "+this.name;

};

Cat.prototype=Object.create(Animal.prototype);

//second inheritans
var Tiger=function(){

    Cat.call(this);//run constructor of animal

    this.name="Tiger";

    this.fullname=this.fullname+" - "+this.name;

};

Tiger.prototype=Object.create(Cat.prototype);

//cat can be used
console.log("WE CREATE CAT:");
var cat=new Cat();
cat.hello();
cat.fullHello();

//tiger can be used

console.log("WE CREATE TIGER:");
var tiger=new Tiger();
tiger.hello();
tiger.fullHello();

console.log("WE CREATE ANIMAL ( IT IS ABSTRACT ):");
//animal is abstract, cannot be used - see error in console
var animal=new Animal();
animal=animal.fullHello();
```

如您所见，最后一个对象给了我们错误，这是因为原型中的 Animal 具有 property `abstract`。为了确保它是 Animal 而不是`Animal.prototype`原型链中的东西，我这样做：

```
Object.getPrototypeOf(this).hasOwnProperty("abstract") 
```

所以我检查我最近的原型对象是否有`abstract`属性，只有直接从`Animal`原型创建的对象才会有这个条件为真。函数`hasOwnProperty`只检查当前对象的属性而不是他的原型，所以这让我们 100% 确定属性是在此处声明的，而不是在原型链中。

> 从 Object 继承的每个对象都继承了**hasOwnProperty**方法。该方法可用于判断一个对象是否具有指定属性作为该对象的直接属性；与 in 运算符不同，此方法不检查对象的原型链。更多关于它：

在我的提议中，我们不必像@Jordão 当前的最佳答案一样`constructor`每次都进行更改。`Object.create`

解决方案还可以在层次结构中创建许多抽象类，我们只需要`abstract`在原型中创建属性。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-05-22T17:44:47.080

您可以使用对象原型创建抽象类，一个简单的示例如下：

```
var SampleInterface = {
   addItem : function(item){}  
} 
```

您可以更改或不更改上述方法，这取决于您实施它。如需详细观察，您可能需要访问[此处](http://www.yusufaytas.com/achieving-abstraction-in-javascript/)。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-02-28T09:58:54.667

```
function Animal(type) {
    if (type == "cat") {
        this.__proto__ = Cat.prototype;
    } else if (type == "dog") {
        this.__proto__ = Dog.prototype;
    } else if (type == "fish") {
        this.__proto__ = Fish.prototype;
    }
}
Animal.prototype.say = function() {
    alert("This animal can't speak!");
}

function Cat() {
    // init cat
}
Cat.prototype = new Animal();
Cat.prototype.say = function() {
    alert("Meow!");
}

function Dog() {
    // init dog
}
Dog.prototype = new Animal();
Dog.prototype.say = function() {
    alert("Bark!");
}

function Fish() {
    // init fish
}
Fish.prototype = new Animal();

var newAnimal = new Animal("dog");
newAnimal.say(); 
```

由于`__proto__`它不是标准变量，因此不能保证有效，但至少在 Firefox 和 Safari 中有效。

如果你不明白它是如何工作的，请阅读原型链。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-28T09:13:43.700

Javascript 可以有继承，查看下面的 URL：

[http://www.webreference.com/js/column79/](http://www.webreference.com/js/column79/)

安德鲁

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-04-05T14:03:31.387

在这种情况下，我们可以使用`Factory`设计模式。Javascript 用于`prototype`继承父级的成员。

定义父类构造函数。

```
var Animal = function() {
  this.type = 'animal';
  return this;
}
Animal.prototype.tired = function() {
  console.log('sleeping: zzzZZZ ~');
} 
```

然后创建子类。

```
// These are the child classes
Animal.cat = function() {
  this.type = 'cat';
  this.says = function() {
    console.log('says: meow');
  }
} 
```

然后定义子类构造函数。

```
// Define the child class constructor -- Factory Design Pattern.
Animal.born = function(type) {
  // Inherit all members and methods from parent class,
  // and also keep its own members.
  Animal[type].prototype = new Animal();
  // Square bracket notation can deal with variable object.
  creature = new Animal[type]();
  return creature;
} 
```

测试一下。

```
var timmy = Animal.born('cat');
console.log(timmy.type) // cat
timmy.says(); // meow
timmy.tired(); // zzzZZZ~ 
```

这是完整示例编码的[Codepen 链接](https://codepen.io/eric_tan/pen/OpqxQr)。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-02-01T06:04:10.740

我认为所有这些答案特别是前两个（由[some](https://stackoverflow.com/questions/597769/how-do-i-create-an-abstract-base-class-in-javascript#597984)和[jordão](https://stackoverflow.com/questions/597769/how-do-i-create-an-abstract-base-class-in-javascript#21220964)）用传统的原型基础 JavaScript 概念清楚地回答了这个问题。

`Creational Patterns`现在，由于您希望动物类构造函数根据传递给构造的参数来运行，我认为这与例如[Factory Pattern](http://www.oodesign.com/factory-pattern.html)的基本行为非常相似。

在这里，我做了一个小方法让它以这种方式工作。

```
var Animal = function(type) {
    this.type=type;
    if(type=='dog')
    {
        return new Dog();
    }
    else if(type=="cat")
    {
        return new Cat();
    }
};

Animal.prototype.whoAreYou=function()
{
    console.log("I am a "+this.type);
}

Animal.prototype.say = function(){
    console.log("Not implemented");
};

var Cat =function () {
    Animal.call(this);
    this.type="cat";
};

Cat.prototype=Object.create(Animal.prototype);
Cat.prototype.constructor = Cat;

Cat.prototype.say=function()
{
    console.log("meow");
}

var Dog =function () {
    Animal.call(this);
    this.type="dog";
};

Dog.prototype=Object.create(Animal.prototype);
Dog.prototype.constructor = Dog;

Dog.prototype.say=function()
{
    console.log("bark");
}

var animal=new Animal();

var dog = new Animal('dog');
var cat=new Animal('cat');

animal.whoAreYou(); //I am a undefined
animal.say(); //Not implemented

dog.whoAreYou(); //I am a dog
dog.say(); //bark

cat.whoAreYou(); //I am a cat
cat.say(); //meow
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-11-08T01:10:22.883

```
//Your Abstract class Animal
function Animal(type) {
    this.say = type.say;
}

function catClass() {
    this.say = function () {
        console.log("I am a cat!")
    }
}
function dogClass() {
    this.say = function () {
        console.log("I am a dog!")
    }
}
var cat = new Animal(new catClass());
var dog = new Animal(new dogClass());

cat.say(); //I am a cat!
dog.say(); //I am a dog! 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-03-18T23:09:44.060

```
/****************************************/
/* version 1                            */
/****************************************/

var Animal = function(params) {
    this.say = function()
    {
        console.log(params);
    }
};
var Cat = function() {
    Animal.call(this, "moes");
};

var Dog = function() {
    Animal.call(this, "vewa");
};

var cat = new Cat();
var dog = new Dog();

cat.say();
dog.say();

/****************************************/
/* version 2                            */
/****************************************/

var Cat = function(params) {
    this.say = function()
    {
        console.log(params);
    }
};

var Dog = function(params) {
    this.say = function()
    {
        console.log(params);
    }
};

var Animal = function(type) {
    var obj;

    var factory = function()
    {
        switch(type)
        {
            case "cat":
                obj = new Cat("bark");
                break;
            case "dog":
                obj = new Dog("meow");
                break;
        }
    }

    var init = function()
    {
        factory();
        return obj;
    }

    return init();
};

var cat = new Animal('cat');
var dog = new Animal('dog');

cat.say();
dog.say(); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2022-02-08T18:40:48.507

```
"use strict";

function Abstract (...arg){

    // create abstract constructor
    if(  this.constructor.name === 'Object' || this.constructor === Abstract ) throw { ErrorType : "can't call abstract class with new !" , }

    // ceate abstract method
    Object.defineProperty( this , 'config' , {
        value : function(){
            console.log('config parent')
        }
    });

    // or other 
    return this ;
};

class Home extends Abstract{
    name = '';
    constructor(...arg){
        super(...arg) ; 
    }

    config(){
        // this method not working
        console.log('config child')
    }
}

let y = new Home( "home" , 'dasd');
y.config();
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-02-23T12:09:39.667

如果您想确保您的基类及其成员是严格抽象的，这里有一个基类可以为您执行此操作：

```
class AbstractBase{
    constructor(){}
    checkConstructor(c){
        if(this.constructor!=c) return;
        throw new Error(`Abstract class ${this.constructor.name} cannot be instantiated`);
    }
    throwAbstract(){
        throw new Error(`${this.constructor.name} must implement abstract member`);}    
}

class FooBase extends AbstractBase{
    constructor(){
        super();
        this.checkConstructor(FooBase)}
    doStuff(){this.throwAbstract();}
    doOtherStuff(){this.throwAbstract();}
}

class FooBar extends FooBase{
    constructor(){
        super();}
    doOtherStuff(){/*some code here*/;}
}

var fooBase = new FooBase(); //<- Error: Abstract class FooBase cannot be instantiated
var fooBar = new FooBar(); //<- OK
fooBar.doStuff(); //<- Error: FooBar must implement abstract member
fooBar.doOtherStuff(); //<- OK 
```

严格模式使得无法在 throwAbstract 方法中记录调用者，但错误应该发生在显示堆栈跟踪的调试环境中。

# networking - 通过局域网共享 Adob e Flash Projector (.EXE)

> ID：597771
> 
> 赞同：0
> 
> 时间：2009-02-28T09:07:23.543
> 
> 标签：networking, flash, exe, sharing

即将推出的项目要求将 Flash 投影仪 (.exe) 保存在服务器上，并由多个用户通过网络 (LAN) 访问。将有一个中央访问数据库作为后端。我正在使用第三方 SWF2EXE (SWF Studio) 产品来提供数据库功能。我想知道以这种方式共享 .exe 文件是否实用。我知道这不是典型的客户端-服务器方法，但由于客户端资源不足，我不能使用像 ASP 这样的服务器端平台。如果网络用户同时启动同一个 .exe 对数据库 (mdb) 进行同时读/写，是否可能导致任何崩溃？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-28T09:20:25.633

每台计算机都应该得到一个exe文件的副本，并且应该只有共享的数据库。如果您在 LAN 上并且使用 MS Access，则将 MDB 文件放在共享位置应该没问题。

您可能还想检查 ms 访问数据库的并发用户限制。

安德鲁

# gdb - 大型二进制文件的制表符完成中断

> ID：597777
> 
> 赞同：10
> 
> 时间：2009-02-28T09:15:47.987
> 
> 标签：gdb, readline

如果我在调试大型二进制文件时不小心启动了选项卡完成，gdb 将冻结一段时间扫描符号表（在我的情况下最多 1 分钟）。所以我必须等到整个符号表被扫描。有什么办法可以在 gdb 中中断这个过程吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-11-06T10:28:26.847

gdb Bugzilla 中的选项卡补全仍然存在未解决的错误：

*   [错误 11920 - 选项卡完成可能会在没有任何反馈的情况下停止 cli](https://sourceware.org/bugzilla/show_bug.cgi?id=11920)
*   [错误 15548 - 当完成列表非常大时，将完成限制为预定义的限制](https://sourceware.org/bugzilla/show_bug.cgi?id=15548)

编辑：gdb 7.10.0 有一个默认值为 200的[`max-completions`变量。](https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;a=blob;f=gdb/NEWS#l509)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-28T21:11:35.460

控制 c 应该中断它。你试过吗？

如果它不起作用，您可能需要更新版本的 gdb。

# c++ - 如何应对高频数据？

> ID：597779
> 
> 赞同：3
> 
> 时间：2009-02-28T09:18:43.313
> 
> 标签：c++, winsock

我有一个 C++ 应用程序，它接收股票数据并通过套接字（充当服务器）转发到另一个应用程序。

实际上，该`WSASend`函数在几秒钟后返回错误代码 10055，我发现这是错误消息

“没有可用的缓冲区空间。无法对套接字执行操作，因为系统缺少足够的缓冲区空间或队列已满”。

仅当我在市场交易时间后运行应用程序时才会出现问题，因为我们在几分钟内收到全天数据（大约 130 MB）（我假设这相对较大）我这样做是为了进行稳健性测试。

我尝试使用`setsockopt`函数增加发送缓冲区 SO_SNDBUF 但同样的问题仍然存在。我怎么解决这个问题？这与接收缓冲区有关吗？

发送详情：

对于每条完整的消息，我调用使用重叠套接字的发送方法

编辑：有人可以给出在 C++ 中处理高频数据的一般准则吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T09:44:21.193

如果接收方没有足够快地处理它们的套接字末端，TCP 的流控制将导致内部发送缓冲区填满。从错误消息中可以看出，您正在发送数据，而不考虑 Winsock 堆栈处理数据的速度。如果您能准确说明您是如何发送数据的，那将会很有帮助？您是在等待所有数据到达然后发送一个大块，还是逐个发送？

您是通过非阻塞或重叠套接字发送吗？在任何一种情况下，每次发送后，您可能应该等待套接字处于可以发送更多数据的状态的通知，因为 select()/WaitForMultipleObjects() 表明它可以（对于非阻塞套接字），或者重叠 I/O 完成，表示数据已成功复制到套接字内部发送缓冲区。

您可以重叠发送，即一次排队多个缓冲区 - 这就是重叠 I/O 的用途 - 但您需要仔细考虑锁定大量页面和可能耗尽非分页池的内存影响.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T21:18:57.080

尼克的回答非常中肯。您很可能通过一次启动太多重叠发送来耗尽“锁定页面限制”。理想情况下，您需要将数据缓冲在自己的内存缓冲区中，并且在任何时候只有一组重叠发送待处理。我在这里谈谈我的 IOCP 框架如何让你处理这种情况[http://www.lenholgate.com/blog/2008/07/write-completion-flow-control.html](http://www.lenholgate.com/blog/2008/07/write-completion-flow-control.html)以及相关的 TCP 接收窗口流控制问题在这里[http://www.lenholgate.com/blog/2008/06/data-distribution-servers.html](http://www.lenholgate.com/blog/2008/06/data-distribution-servers.html)和这里[http://www.serverframework.com/asynchronousevents/2011/06/tcp-flow-control-and -asynchronous-writes.html](http://www.serverframework.com/asynchronousevents/2011/06/tcp-flow-control-and-asynchronous-writes.html)。

我的首选解决方案是在任何时候允许可配置数量的待处理重叠发送，一旦超过此限制就开始缓冲数据，然后使用待处理重叠发送的完成来驱动缓冲数据的发送。这使您可以严格控制非分页池的数量和使用的“锁定页面”的数量，并且可以尽可能快地发送大量连接，但仍然可以控制它们使用的资源。

# c# - 沿直线查找随机点

> ID：597788
> 
> 赞同：4
> 
> 时间：2009-02-28T09:27:20.983
> 
> 标签：c#, .net, encryption, geometry

我正在编写一个小程序来帮助拆分密码（请参阅下面的说明）

我有将文本转换为 int 的代码（ text-ascii binary -> dec int）

所以在这种情况下，“测试”这个词将 = 1952805748

现在有趣的部分。（编码密码）

然后我会取 x1 = 1952805748 和 y1 = 0

然后我组成一个随机点，其中 x2 = 7 和 y2 = 142

这将在 x1,y1 和 x2,y2 之间画一条线（使用 Y=mx+B）

我需要如何找到这两个点创建的线上的任何随机点（很好地称之为x3，y3）

如果有人有任何想法，我很想听听他们的意见。我试图找出两个点都是整数的代码（如果我们每个数字后面没有大的小数点，每个人都更容易）

++ 为什么 ++

一般的想法是，如果您必须在两方之间拆分密码，那么一方可能会根据给定的字符串找出密码

如果你使用这种方法，他们会得到一个点，从那个点开始，数学上不可能确定线在哪里与 x (x=? y =0) 相交，所以你可以放心地将一组点交给你的律师还有一份给你的妻子

他们会进行数学运算（将其输入到程序中），然后他们会得到一个数字，该数字将被解码以说出一个密码，该密码可以用您的遗嘱或其他一些您不希望他们访问的敏感文件解密文件现在

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-28T09:57:20.460

其他答案已经解决了您的数学想法，但在加密方面，我*强烈*建议您不要尝试制定自己的加密方案。

如果你想用两个密码加密一些东西，而这两个密码都是必需的，有一个更简单的方法来做到这一点：加密文件两次：

```
Plaintext -> Encrypted1 (with password 1)
Encrypted1 -> Encrypted2 (with password 2) 
```

`Encrypted2`是你存储的。扔掉`Encrypted1`。

要解密，只需`Encrypted2`使用密码 2 解密即可得到`Encrypted1`，然后再解密`Encrypted1`以返回明文。

正如预期的那样，任何一个密码本身都是无用的，并且您不需要制定*任何*加密算法/代码。

编辑：作为一个更简单的解决方案，只需制作一个非常长的密码并给每一方一半的密码。例如，使用密钥“这是一个非常长的密码”加密文件，并给您的宽“这是一个非常”和您的律师“长密码”。显然，您需要适当地选择密码，以便知道其中一半不会对另一半给出任何提示。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-02T19:59:21.057

这种算法实际上被称为“ [Shamir 的秘密共享](http://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing)”，是一种非常好的分割秘密的方法。您可以拆分任意大的秘密，这需要您想要聚集在一起的任意数量的人来恢复秘密。

我建议您稍微概括一下并寻求一个解决方案，让您指定需要 N 个点来求解 N-1 次多项式。您可以使用[拉格朗日多项式](http://en.wikipedia.org/wiki/Lagrange_polynomial)为您解决这个问题。

然而，Wikipedia 上的伪代码仅适用于浮点数，需要稍微修改以用于整数。如果您想要一些想法（并假设它完全有帮助），[请查看我的完整 python 实现。](http://gist.github.com/585345)

它给了我这个输出：

```
1 -- 50383220533284199945706810754936311181214547134666382315016772033813961148457676
2 -- 125723425896904546349739165166331731432281836699962161072279259011758052396215820
3 -- 235794378436564714387676526976517945151880763730707233042654663244625708155520494
'This is my super secret password.' 
```

***编辑：***一年后，我更新了实现以在有限域内工作，这是证明安全所必需的。万岁！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-28T09:40:19.173

如果您的端点是 (x1,y1) 和 (x2,y2) 并且您有一个介于 0 到 1 之间的随机数 r，则沿线的点将是：

```
(x1+(x2-x1)*r,y1+(y2-y1)*r) 
```

使用您给定的端点 (1952805748,0) 和 (7,42) 的随机值 0.5（沿线的一半），您最终得到：

```
(976402877.5,21) 
```

您可以轻松地将其作为中点。如果您需要整数，您可以四舍五入任何坐标。

根据您的评论（转述）：

`I may not have explained this properly: one person would be given (x1,y1) different person would be given (x3,y3). At no point would a person be able to take a single point and figure out where the line crosses x (N,0).`

假设您的 (x1,y1) 是 (1952805748,0)，那么谁知道 x 轴的交点（因为 y = 0）。听起来您想要沿线的两个点都不在 x 轴上。这意味着一方应获得您随机选择的端点 (7,42)，另一方获得您在线上的随机点 (976402877.5,21) - 这些点的 y 值都不应该为零。这可以通过确保随机值在 0.2 到 1.0 而不是 0.0 到 1.0 的范围内来实现（假设您的 y1 始终为 0）。

任何一方都无法计算出与他们的一个坐标相交的 x 轴，但两个坐标的组合将为您提供该信息。

此外，在这种情况下，舍入或纵坐标不适合，您必须将它们映射，例如 (976402877.5,21) 变为 (1952805755,42) [乘以 2，这是最简单的整数比率]。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-28T09:40:18.287

```
//Assume x1, x2, and m, b exist as ints
Random r = new Random();
int x3 = r.Next(Math.Min(x1, x2), Math.Max(x1, x2));
int y3 = m * x3 + b; 
```

基本上，我们在两个 x 之间选择一些 x（保证正确的域，并通过对线性函数的约束，正确的范围）并为 y 求解。不太难。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T06:06:52.173

无需解决某个未知坐标。只需将加密文件插入序列号生成器即可。您已将暴力破解加密的复杂性有效地降低了数倍。不是每个字符都是约 94 个字符中的 1 个（标准键盘上的可键入字符），而是将其减少到 10 分之一（如果允许使用小数，则为 11 分之一）。

我建议不要使用这种方法。正如斯基特所说，只需加密文件两次。

# c# - 如何为 TextBox 实现良好且高效的撤消/重做功能

> ID：597792
> 
> 赞同：33
> 
> 时间：2009-02-28T09:35:54.007
> 
> 标签：c#, undo-redo, memento

我有一个文本框，我想为其实现撤消/重做功能。我[读过](https://stackoverflow.com/questions/434658/textbox-undo-redo-commands)它可能已经有一些轻微的撤消功能，但是它有问题吗？无论如何，我想同时实现撤消和重做功能，只是为了了解您将如何继续执行此操作。

我已经阅读了有关[Memento 模式](http://en.wikipedia.org/wiki/Memento_pattern)的内容，并在 CodeProject上的[通用撤消/重做](http://www.codeproject.com/Articles/18025/Generic-Memento-Pattern-for-Undo-Redo-in-C)示例中查看了一些内容。而且这种模式很有意义。我似乎无法理解如何实现它。以及如何有效地处理`TextBox`.

当然，我可以只存储`textbox.Text`when `TextChanges`，但这会很快占用大量内存，尤其是在`TextBox`包含大量文本的情况下。

所以无论如何，我正在寻找一些关于如何实现一个好的、清晰和有效的方式来实现这个功能的建议。一般而言，尤其是对于 TextBox c",)

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-28T09:41:20.497

.NET`System.ComponentModel`命名空间带有一个`IEditableObject`接口，您也可以使用`INotifyPropertyChanging`和`INotifyPropertyChanged`. MVC 模式还将使您的界面通过事件响应模型中的更改，从而更新或恢复文本框的值。

实际上是*纪念品模式*。

你看过这些吗？ [这](https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.ieditableobject)是一个方法。

一个简单快捷的版本是存储文本框的状态`OnTextChanged`。每个撤消都将返回数组中的最后一个事件。C# 堆栈类型在这里会很方便。您也可以在离开界面后或之后清除状态`Apply`。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-09-14T02:57:18.287

这是一种用最少的代码实现它的方法：（这是带有单个文本框的 win 表单背后的代码）

```
public partial class Form1 : Form
{
    Stack<Func<object>> undoStack = new Stack<Func<object>>(); 
    public Form1()
    {
        InitializeComponent();
    }
    private void textBox_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.KeyCode == Keys.U && Control.ModifierKeys == Keys.Control && undoStack.Count > 0)
            undoStack.Pop()();            
    }
    private void textBox_KeyPress(object sender, KeyPressEventArgs e)
    {            
        if (e.KeyChar != 'u' || Control.ModifierKeys != Keys.Control)
        {
            var textBox = (TextBox)sender;
            undoStack.Push(textBox.Text(textBox.Text));
        }
    }
}
public static class Extensions
{
    public static Func<TextBox> Text(this TextBox textBox, string text)
    {            
        return () => { textBox.Text = text; return textBox; };
    }
} 
```

通过为其他输入类型实现扩展方法，undoStack 可以为整个 UI 提供服务，按顺序撤消所有 UI 操作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-08-24T21:09:02.907

撤消/重做时，我也需要将选择重置为其原始位置。在我的基本且运行良好的代码的底部观看“类扩展”，以尝试只有一个文本框“textBox1”的表单：

```
public partial class Form1 : Form
{
    Stack<Func<object>> undoStack = new Stack<Func<object>>();
    Stack<Func<object>> redoStack = new Stack<Func<object>>();

    public Form1()
    {
        InitializeComponent();
        textBox1.KeyDown += TextBox1_KeyDown;
    }

    private void TextBox1_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.KeyCode == Keys.ControlKey && ModifierKeys == Keys.Control) { }
        else if (e.KeyCode == Keys.U && ModifierKeys == Keys.Control)
        {
            if(undoStack.Count > 0)
            {
                StackPush(sender, redoStack);
                undoStack.Pop()();
            }
        }
        else if (e.KeyCode == Keys.R && ModifierKeys == Keys.Control)
        {
            if(redoStack.Count > 0)
            {
                StackPush(sender, undoStack);
                redoStack.Pop()();
            }
        }
        else
        {
            redoStack.Clear();
            StackPush(sender, undoStack);
        }
    }

    private void StackPush(object sender, Stack<Func<object>> stack)
    {
        TextBox textBox = (TextBox)sender;
        var tBT = textBox.Text(textBox.Text, textBox.SelectionStart);
        stack.Push(tBT);
    }
}

public static class Extensions
{
    public static Func<TextBox> Text(this TextBox textBox, string text, int sel)
    {
        return () => 
        {
            textBox.Text = text;
            textBox.SelectionStart = sel;
            return textBox;
        };
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-04-20T11:56:42.870

可以在这里找到一个好的解决方案：

[为您的应用程序添加撤消/重做或后退/前进功能](http://pradeep1210.wordpress.com/2011/04/09/add-undoredo-or-backforward-functionality-to-your-application/)

[撤消/重做功能文本框（winforms）](http://pradeep1210.wordpress.com/2012/05/07/undoredo-capable-textbox-winforms/ "撤消/重做功能文本框（winforms）")

代码在 VB.NET 中，但您可以轻松地将其转换为 C#，而无需付出太多努力。还提供在线转换器。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-11-13T07:22:29.463

这是我在该主题上找到的最有用的页面，更通用，适用于撤消/重做堆栈上的不同对象类型。

[命令模式](http://www.codeproject.com/Articles/33384/Multilevel-Undo-and-Redo-Implementation-in-C-Part)

当我开始实现它时，我很惊讶它最终变得如此简单和优雅。这对我来说是一场胜利。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-14T03:39:51.247

我会监听一个更改事件，并在它发生时将`diff`先前状态和当前状态推送到堆栈上。差异应该比存储整个文本小得多。此外，您可能不想在每次编辑时将新的撤消状态推送到堆栈中......例如，我会将所有输入集中在一起，直到用户更改光标位置。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-04-16T13:19:06.163

最聪明的方法是使用不可变的持久对象。永远不要对对象进行更改，只创建与旧版本略有不同的新对象。这可以通过仅克隆热路径上的部分树来稍微有效地完成。

我有一个用最少的代码编写的撤消堆栈示例

```
 [Fact]
public void UndoStackSpec()
{
    var stack = new UndoStack<A>(new A(10, null));

    stack.Current().B.Should().Be(null);

    stack.Set(x => x.B, new B(20, null));

    stack.Current().B.Should().NotBe(null);
    stack.Current().B.P.Should().Be(20);

    stack.Undo();

    stack.Current().B.Should().Be(null);

} 
```

其中 A 和 B 作为具有`private setters`所有属性的类，即 `immutable`

```
class A : Immutable
{
    public int P { get; private set; }
    public B B { get; private set; }
    public A(int p, B b)
    {
        P = p;
        B = b;
    }
}

class B : Immutable
{
    public int P { get; private set; }
    public C C { get; private set; }
    public B(int p, C c)
    {
        P = p;
        C = c;
    }
}

class C : Immutable
{
    public int P { get; private set; }
    public C(int p)
    {
        P = p;
    }
} 
```

你可以在这里找到完整的源代码[https://gist.github.com/bradphelan/5395652](https://gist.github.com/bradphelan/5395652)

# sql - 支持将文本块拖入窗口的并排差异程序？

> ID：597794
> 
> 赞同：2
> 
> 时间：2009-02-28T09:38:24.547
> 
> 标签：sql, merge, diff

我正在寻找一个并排的差异程序，例如 la xxdiff 或 DiffMerge，它允许将文本块拖到左侧或右侧窗口中，而不是区分文件。

我正在重构源文件中嵌入的一些 SQL，最好将每个源文件中的 sql 语句拖到 diff 程序中，而不必剪切和粘贴到文件然后对文件进行 diff。

任何线索表示赞赏，mac和linux兼容性的奖金......谢谢！

**更新：winmerge 和其他版本都完美地做到了这一点......再次感谢大家！**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-28T10:41:00.760

[Winmerge](http://winmerge.org/)允许您使用 Alt + Left 和 Alt + Right 将不同的文本块左右移动。

它是免费/开源的，也是整体很棒的工具。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T09:43:10.383

如果您使用超越比较并开始一个新的文本比较，您可以粘贴到窗口中，它会区分您粘贴的内容。不完全是拖放，但实际上是一样的。

无需在文件中包含要区分的内容。我真的推荐无可比拟，这是一个很棒的工具。您可以在以下位置获得试用版：

[http://www.scootersoftware.com/](http://www.scootersoftware.com/)

顺便提一下，它与 linux 兼容，但我只在 Windows 上使用过它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T17:49:06.803

gVim (gvimdiff, vimdiff) 可以做到，虽然不用拖拽，但是用键盘快捷键。

它有很好的文档： http: [//www.vim.org/htmldoc/diff.html](http://www.vim.org/htmldoc/diff.html)

并且也适用于 Windows。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T12:42:50.893

只需使用[Diffuse](http://diffuse.sourceforge.net/)开始一个新的文件比较并将文本粘贴到比较窗格中（如果文本多行，请单击重新对齐按钮）。Diffuse 是免费的，可在 Linux、Mac 和 Windows 上运行。它还具有 SQL 的语法突出显示功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-18T20:03:12.313

我在 Unix、Linux 等上使用 meld [http://meld.sourceforge.net/](http://meld.sourceforge.net/)和 tktiff [http://tkdiff.sourceforge.net/ 。](http://tkdiff.sourceforge.net/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-24T12:11:34.367

Devart 的[dbForge Schema Compare for SQL Server](http://www.devart.com/dbforge/sql/schemacompare/)是一个快速的模式比较和同步工具，具有这样的功能。

# c++ - 如何在 CLI 上打印下标/上标？

> ID：597813
> 
> 赞同：8
> 
> 时间：2009-02-28T10:03:21.927
> 
> 标签：c++, command-line, typography, subscript, superscript

我正在编写一段处理数学变量和索引的代码，我需要在 CLI 上打印下标和上标，是否有（可能是跨平台的）方法来做到这一点？我正在使用香草 C++。

**注意：**我希望这是跨平台的，但是从第一个答案来看，这似乎是不可能的，我在 MacOS 和 Ubuntu Linux（所以 bash）下工作。

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-28T10:10:18.930

由于大多数 CLI 实际上只是终端（主要是相当愚蠢的终端，但有时带有颜色），我做过的唯一跨平台方法是为每个虚拟线路分配多条物理线路，例如：

```
 2
f(x) = x  + log x
               2 
```

它并不理想，但它可能是您在没有 GUI 的情况下所能获得的最佳效果。

跟随您有关您主要感兴趣的平台的额外信息：

至少在 Ubuntu 中，gnome-terminal 默认以 UTF-8 模式运行，因此以下代码显示了如何生成上标和下标：

```
#include <stdio.h>

static char *super[] = {"\xe2\x81\xb0", "\xc2\xb9", "\xc2\xb2",
    "\xc2\xb3", "\xe2\x81\xb4", "\xe2\x81\xb5", "\xe2\x81\xb6",
    "\xe2\x81\xb7", "\xe2\x81\xb8", "\xe2\x81\xb9"};
static char *sub[] = {"\xe2\x82\x80", "\xe2\x82\x81", "\xe2\x82\x82",
    "\xe2\x82\x83", "\xe2\x82\x84", "\xe2\x82\x85", "\xe2\x82\x86",
    "\xe2\x82\x87", "\xe2\x82\x88", "\xe2\x82\x89"};

int main(void) {
    int i;
    printf ("f(x) = x%s + log%sx\n",super[2],sub[2]);
    for (i = 0; i < 10; i++) {
        printf ("x%s x%s ", super[i], sub[i]);
    }
    printf ("y%s%s%s z%s%s\n", super[9], super[9], super[9], sub[7], sub[5]);
    return 0;
} 
```

和char* 数组是数字上标和下标的 Unicode 代码点的 UTF-8 编码（请参阅`super`此处[）](http://en.wikipedia.org/wiki/Unicode_subscripts_and_superscripts)。给定的程序将从上面输出我的公式（一行而不是三行），然后是所有选项的另一条测试行以及一个 y-super-999 和 z-sub-75，这样你就可以看到它们的样子。`sub`

MacOS 似乎没有使用 gnome-terminal 作为终端程序，但[此处](http://betabug.ch/blogs/ch-athens/40)和[此处](http://www.macosxhints.com/article.php?story=20050208053951714)的引用似乎表明标准终端理解 UTF-8（或者您可以下载并安装 gnome-terminal 作为最后的手段）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-28T10:20:52.370

> 我需要在 CLI 上打印下标和上标，有跨平台的方法吗？

只有当你有一个支持 Unicode 的终端时，这远不能保证。Unicode 定义了有限数量的子和上标“兼容字符”，您当然不能在任何旧字母上使用它：

```
₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₒₓ
⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ 
```

即使那样，您仍然依赖于控制台字体中的字形，这也远不能保证。上标 2 和 3 很可能存在，因为它们存在于 ISO-8859-1 中；其他的可能行不通。

# asp.net - 无法将标准工具箱项添加到 Default.aspx

> ID：597817
> 
> 赞同：0
> 
> 时间：2009-02-28T10:06:53.947
> 
> 标签：asp.net

对不起，如果我的问题被问错了，我刚刚开始在 VS2008 中学习 ASP.NET。

我尝试按照网络上的几个教程（例如[http://msdn.microsoft.com/en-us/library/aa730880(VS.80).aspx#wapp_topic5](http://msdn.microsoft.com/en-us/library/aa730880(VS.80).aspx#wapp_topic5)）来创建一个网页：

*   创建新的 Web 应用程序
*   切换到 Default.aspx，设计模式
*   从页面上的标准工具箱中拖放标签

如果我从标准工具箱类别中选择标签，我不能将它放在页面上。我现在不知道该做什么，因为我完全按照所有教程中的内容进行操作。我错过了什么吗？

我只能将从 HTML 类别中挑选的项目放置在工具箱中。

谢谢，彼得

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T12:03:14.387

我找到了解决方案，所以我会回答自己：

问题是我的一个目录被命名为“C#”，而“#”字符导致了所有问题。我无法添加控件，也无法在 ScarletGarden 建议的设计模式下看到手动添加的控件。换句话说，'#' 不能在解决方案路径中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T10:30:59.117

有时设计模式会混乱。我通常使用源模式。

同时，这也可能是 VS.NET 2008 部署问题。

以源代码模式打开您的 default.aspx 页面，并将代码粘贴到您的表单元素中。

```
<asp:Label ID="Label1" runat="server" Text="Label"></asp:Label> 
```

然后尝试切换设计模式你能看到标签吗？

你能改变它的属性吗？

当你运行它时你会看到什么？

并在 Visual Studio.NET 中转到“**帮助/关于 Microsoft Visual Studio** ”，你能看到**Microsoft Visual Web Developer**

如果所有这些问题的答案都是否定的，我认为您应该再次部署 Visual Studio 的 Microsoft Visual Web Developer 功能。

希望这可以帮助。

# c - GCC/C如何隐藏控制台窗口？

> ID：597818
> 
> 赞同：12
> 
> 时间：2009-02-28T10:09:38.573
> 
> 标签：c, windows, gcc, console

****C 新手警报**** 如何编译 C 应用程序以使其运行而不在 Windows 上显示控制台窗口？我正在使用 Windows XP 和 GCC 3.4.5（mingw-vista special r3）。我已经对此进行了详尽的谷歌搜索，并提出了以下内容，根据我所阅读的内容，听起来应该可以解决问题，但在我的系统上却没有：

```
#include <windows.h>
#include <stdlib.h>

int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)
{
    system("start notepad.exe");
} 
```

我也尝试将“-mwindows”参数传递给 GCC 无济于事。代码示例会启动记事本，但仍会显示命令提示符。

编辑：FWIW 我也尝试过将 ShellExecute 作为 system() 的替代品，尽管此时我什至很乐意让一个带有空 main() 或 WinMain() 的应用程序工作。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-28T10:26:25.507

保留 -mwindows 标志并使用它：

```
#include <windows.h>
#include <process.h>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)
{
    execl("c:\\winnt\\system32\\notepad.exe", 0);
    // or: execlp("notepad.exe", 0);
} 
```

注意：您需要`execl()`调用的完整路径，但不是那个`execlp()`。

**编辑：**简要解释为什么这样做 - 使用 system() 启动一个 shell（如 cmd.exe）来执行产生控制台窗口的命令。使用 execl 不会。

# c# - Delegate.CreateDelegate vs DynamicMethod vs Expression

> ID：597819
> 
> 赞同：26
> 
> 时间：2009-02-28T10:09:44.750
> 
> 标签：c#, .net, reflection, dynamic, delegates

关于[让反射飞起来和探索代表](http://msmvps.com/blogs/jon_skeet/archive/2008/08/09/making-reflection-fly-and-exploring-delegates.aspx)的问题......

如果我需要为`Func<T, TResult>`动态加载类型的方法创建委托，我可能会使用 (1) `Delegate.CreateDelegate`(2) `DynamicMethod`(3)`Expression`树。

假设一组动态加载的类型/方法在应用程序启动时通过配置反映一次，并在应用程序的整个生命周期中使用（启动性能不是问题，内存也不是问题），委托被缓存并分派到强类型的方式。这些委托是并发访问的热路径。

您更喜欢哪种动态绑定方法，为什么？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-28T14:20:51.950

如果它们实际上是您拥有的现有方法`MethodInfo`，并且它们具有正确的签名，那么我会说`Delegate.CreateDelegate`这是正确的方法 - 它完全按照您的意愿行事，没有大惊小怪。`DynamicMethod`如果我需要构建一个委托来执行一些尚未在方法中捕获的逻辑，我会使用或表达式树。

表达式树（IMO，我没有`DynamicMethod`在愤怒中使用过）比 更容易使用`DynamicMethod`，但它们受到更多限制 - 基本上它们只能表示单个表达式（当然可以调用另一种方法）。`DynamicMethod`给你很大的灵活性，但你需要很好地理解 IL。

这有帮助吗？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-28T22:38:42.657

通过 Ayende 的博客，我得到了这个有趣的链接，它展示了你可以用动态方法做的事情。作为一个例子，这很容易理解：
[Accelerating Enum-Based Dictionaries with Generic EnumComparer](http://www.codeproject.com/KB/cs/EnumComparer.aspx)

**更新**

应该注意的是，在 WinRT 的世界中，`Reflection.Emit`是不可用的 - 一些信息可以在[这里找到](http://geekswithblogs.net/mbrit/archive/2012/06/05/say-goodbye-to-system.reflection.emit-any-dynamic-proxy-generation-in-winrt.aspx)

# linq-to-sql - 从 Linq To SQL 中的泛型类映射继承

> ID：597821
> 
> 赞同：0
> 
> 时间：2009-02-28T10:10:45.577
> 
> 标签：linq-to-sql, generics, orm

我正在尝试使用 Linq to SQL 将我的继承层次结构映射到 DB：继承是这样的，类是 POCO，没有任何 LINQ to SQL 属性：

```
public interface IStage
{ ... }

public abstract class SimpleStage<T> : IStage where T : Process
{ ... }

public class ConcreteStage : SimpleStage<ConcreteProcess>
{ ... } 
```

这是映射：

```
<Database Name="NNN" xmlns="http://schemas.microsoft.com/linqtosql/mapping/2007">
  <Table Name="dbo.Stage" Member="Stage">
    <Type Name="BusinessLogic.Domain.IStage">
      <Column Name="ID" Member="ID" DbType="Int NOT NULL IDENTITY" IsPrimaryKey="true" IsDbGenerated="true" AutoSync="OnInsert" />
      <Column Name="StageType" Member="StageType" IsDiscriminator="true" />
      <Type Name="BusinessLogic.Domain.SimpleStage" IsInheritanceDefault="true">
        <Type Name="BusinessLogic.Domain.ConcreteStage" IsInheritanceDefault="true" InheritanceCode="1"/>
      </Type>
    </Type>
  </Table>
</Database> 
```

在运行时出现错误：未处理 System.InvalidOperationException 消息 =“映射问题：找不到类型映射 'BusinessLogic.Domain.SimpleStage' 的运行时类型。”

在映射文件中指定 SimpleStage 和 SimpleStage<T> 都没有帮助 - 运行时不断产生不同类型的错误。

DC是这样创建的：

```
StreamReader sr = new StreamReader(@"MappingFile.map");
XmlMappingSource mapping = XmlMappingSource.FromStream(sr.BaseStream);
DataContext dc = new DataContext(@"connection string", mapping); 
```

如果 Linq to SQL 不支持这一点，请您建议一些其他的 ORM，它支持。提前致谢，

问候！

克塞尼亚

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T15:15:38.197

在我查看了我的泛型类的 IL 之后，我自己找到了答案。在 IL 中，它的名字看起来像 SimpleStage`1<...> 所以我写的时候映射文件的问题已经解决了

```
<Type Name="BusinessLogic.Domain.SimpleStage`1" ... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T10:30:48.773

您是否添加了对文件的引用，并且您是否使用 using 语句导入了引用？或者使用完全限定的类名？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T11:59:27.733

我认为这是因为 SimpleStage 中的泛型类型 T：它无法在内部生成 SimpleStage 的映射查找表，因为 T 是泛型的。

# mercurial - 对于小型开源项目，您会推荐什么 Mercurial DVCS 托管？

> ID：597822
> 
> 赞同：9
> 
> 时间：2009-02-28T10:11:31.657
> 
> 标签：mercurial, hosting, dvcs

我正在为一个小型开源项目寻找免费的 Mercurial 托管。
如果您曾经使用过这样的服务，谁在做托管，您会推荐他们吗？

我知道 SF.net 可以**[设置](http://www.selenic.com/mercurial/wiki/index.cgi/MercurialOnSourceforge)**为托管 HG 存储库，但看起来很麻烦（因为有一个大的、已知的、不太可能很快停止的服务）。

Mercurial 的官方文档中也有[免费的 HG 主机列表](http://www.selenic.com/mercurial/wiki/index.cgi/MercurialHosting)，但我想听听那些真正对此感到沮丧和肮脏的人 :-)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-28T10:21:47.250

[更新] **[Bitbucket 停止托管 Mercurial](https://bitbucket.org/blog/sunsetting-mercurial-support-in-bitbucket)。**

[BitBucket](http://bitbucket.org/)无疑是最受欢迎的。我已经试验了一段时间，然后我跳进了 git。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T13:21:59.103

我将 Bitbucket 用于一堆开源项目，并且对它也很满意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-13T13:24:26.487

[sourceforge.net](http://www.sourceforge.net)刚刚添加了 Mercurial、Bazaar 和 Git 支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-30T19:37:14.867

最初提出此问题时并非如此，但自 2010 年 1 月以来，Microsoft 的[CodePlex](http://www.codeplex.com/)也可以托管 Mercurial 存储库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T17:07:49.440

您是否考虑过使用[Project Kenai](http://kenai.com/)？我有一个帐户，但没有在那里托管任何项目，所以我无法评论服务质量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-13T13:00:04.097

对于小的代码示例，如果您不需要 wiki 和其他东西，您可以尝试[http://freehg.org](http://freehg.org)否则您应该给[http://www.sharesource.org](http://www.sharesource.org)一个机会。或者只是使用 Mercurial，例如使用集成的网络服务器将您的源分散发布给其他开发人员：)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-14T18:47:19.740

Bitbucket 是迄今为止我遇到的最好的主机。

服务快速而坚如磐石，工作人员非常快速地解决您可能遇到的任何问题。

# opengl - EeePC 上的多点触控鼠标手势

> ID：597827
> 
> 赞同：1
> 
> 时间：2009-02-28T10:19:13.277
> 
> 标签：opengl, multi-touch, eeepc

我有一台运行 Ubuntu Intrepid Ibex 的 EeePC 900。触摸板内置了一些简单的多点触控手势——例如通过用两根手指而不是一根手指拖动来滚动。

如何在 OpenGL/C 应用程序中检测多点触控事件？

EeePC 900 上的触摸板是否能够处理旋转和缩放手势？

* * *

[MPX 示例](http://wearables.unisa.edu.au/mpx/?q=xi2_sample)返回 with`Only found one master pointer.`并且建议的`xinput --create-master "ImPS/2 Logitech Wheel Mouse"`内容未被 xinput 识别。那么多点触控滚动行为是内置在较低级别的吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-28T11:02:07.043

我没有 EeePC，但是您可能想查看[MPX](http://wearables.unisa.edu.au/mpx/) API 以访问 X 中的多个指针。如果您正在寻找通用的多点触控框架，Google Code 上有[一些](http://code.google.com/search/#q=multitouch)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T17:28:45.237

（在我的 Eee 1000 上） xev 显示两指滚动手势正在变成按钮 4 和 5 的点击。三指轻敲刚刚变成按钮 3。我认为 pad 不支持任何其他操作。所以看起来垫硬件只是产生点击，就好像它是滚轮鼠标一样。

# asp.net - Northwind 入门套件

> ID：597830
> 
> 赞同：2
> 
> 时间：2009-02-28T10:24:07.073
> 
> 标签：asp.net, visual-studio-2008, sql-server-2008, adventureworks

Codeplex 的 Northwind Starter Kit 是一个很好的起点，可以更好地了解如何以最佳方式构建 ASP.NET 应用程序吗？

AdventureWorks 数据库示例有类似的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T10:43:27.167

Northwind 数据库是 SQL Server 2000 的最佳示例数据库。

谈 SQL Server 2005，AdventureWorks 比 Northwind 好。由于 SQL Server 2005 的分析和报告服务的新功能很少，Northwind 并不是最好的数据库。

MSDN Book On Line (BOL) 在他们的所有示例中都使用了 AdventureWorks，如果对 AdventureWorks 架构有正确的理解，就可以很容易地跟进。

但是，SQL Server Compact Edition 使用 Northwind 作为示例数据库。所以根据你的版本决定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T11:32:37.237

AdventureWorks 数据库是我比较喜欢的一种，因为它有很多高级场景，并且用于 SQL Server 分析服务的示例。分析服务是MS商业智能平台，它需要有大量的数据来解释场景。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-30T03:02:19.697

NSF 不仅仅是一个数据库示例，它还包含分层（领域驱动）的 .net 示例，以帮助开发人员了解各种设计原则（OOD、SOLID）的实际实现，以及这些设计原则通常如何通过跨领域的设计模式应用多层。因此，查看 NSF 不仅仅是 Northwind 数据库。

# gwt - 你知道在哪里下载 GWT 组件和小部件吗？

> ID：597843
> 
> 赞同：1
> 
> 时间：2009-02-28T10:38:33.793
> 
> 标签：gwt

你知道在哪里下载 GWT 组件和小部件吗？

谢谢。

顺便说一句，我需要将 GWT 组件和小部件放在我的项目中的什么位置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T21:09:06.693

这里只是几个地方：

[http://gwt-widget.sourceforge.net/](http://gwt-widget.sourceforge.net/)

[http://code.google.com/p/gwt-ext/](http://code.google.com/p/gwt-ext/)

就放置它们的位置而言，您通常只需将 jar 文件添加到构建过程的类路径中，然后在要使用它们的任何 .gwt.xml 文件中放置一个继承行，例如小部件库：

```
<inherits name="org.gwtwidgets.WidgetLibrary" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T00:19:16.287

在回顾了 GWT 小部件之后，我们将重点放在

[SmartGWT](http://code.google.com/p/smartgwt/)

[外部GWT](http://extjs.com/products/gxt/)

Ext-GWT 看起来像最终的候选人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T10:22:50.747

我主要看了三个 GWT 组件库：

*   GWT-分机： http: [//gwt-ext.com/](http://gwt-ext.com/)
*   分机-GWT：[http ://extjs.com/](http://extjs.com/)
*   SmartGWT：[http](http://code.google.com/p/smartgwt/) ://code.google.com/p/smartgwt/ （带有链接的谷歌代码页）

就小部件而言，这些库似乎非常相似，但当然底层 API 是不同的。所有这三个库都基于现有的 JavaScript 组件库：用于 GWT-Ext 和 Ext-GWT 的 Ext JS，以及用于 SmartGWT 的 SmartClient。因此，我认为您可以说这些库是现有 JavaScript 库的 GWT 包装器。

对我来说，选择其中一个库的主要因素不是底层技术，而是它们的许可模型。GWT-Ext 似乎是一个可靠且流行的组件库，但是它锁定了 Ext JS 2.0.2，这是 LGPL 下 Ext JS 的最后一个版本。较新版本的 Ext JS 库在 GPL 或商业许可下可用。Ext-GWT 来自 Ext JS 的开发者，并遵循相同的双重许可选项。SmartGWT 可在 LGPL 和商业许可下使用。如果您不介意商业许可，那么 Ext-GWT 和 SmartGWT 在许可方面可能都是可行的替代方案。否则，使用 LGPL 的 SmartGWT 对我来说似乎更有吸引力。

就可用小部件而言，GWT-Ext 领先于 SmartGWT，但 SmartGWT 似乎正在快速追赶。在编码方面我更喜欢 SmartGWT。我没有使用 Ext-GWT 的经验，所以我不知道。

# reporting-services - CRM 4.0 中的报告输出导出文件名问题

> ID：597844
> 
> 赞同：0
> 
> 时间：2009-02-28T10:40:06.520
> 
> 标签：reporting-services, report, dynamics-crm, dynamics-crm-4

我们最近将 CRM 系统从 3.0 升级到了 4.0。从此我们

我们的报告有问题。

每当我们将报告导出为 excel 格式时，在

CRM 4.0 的名称为一些“GUID”.xls。不只是文件名，工作表

contianing 输出也有 GUID 作为名称。这适用于其他

格式也（输出文件名包含 GUID）。

我可以将重命名文件另存为其他内容。但是我们有订阅

在我们的大多数报告中，将报告的 excel 输出发送到一组

人的。

如果我可以将报告上传到，而不是从 CRM 4.0 上传 RDL

其他一些SSRS文件夹并提供链接，它将起作用。但我们不想做

它。

谁能帮我这个？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-01T14:16:20.733

不确定，但可以尝试[为 Excel 创建自定义渲染扩展](http://msdn.microsoft.com/en-us/magazine/cc163840.aspx)。更改文章中的 Render 方法，因为它是由[这条评论](http://ronaldlemmen.blogspot.com/2009/01/mail-merge-alternative-reports.html?showComment=1234565160000#c9152533341321037223)提出的，唯一的区别是 - 使用 excel 格式：

```
public bool Render(Report report, 
  NameValueCollection reportServerParameters, 
  NameValueCollection deviceInfo, NameValueCollection clientCapabilities, 
  EvaluateHeaderFooterExpressions evaluateHeaderFooterExpressions, 
  CreateAndRegisterStream createAndRegisterStream)
{
    string strUri = string.Empty;
    strUri += 
      "http://localhost/Reports/Reserved.ReportViewerWebControl.axd";
    strUri += "?ReportSession=" + reportServerParameters["SessionID"];
    // Here you can check the name of report provided to viewer for export. 
    // If it's incorrect, you may extend method to set the right name.
    strUri += "&FileName=" + report.Name;  
    strUri += "&ControlId=" + Guid.Empty;
    strUri += "&Culture=" + 
      CultureInfo.CurrentCulture.LCID.ToString(
        CultureInfo.InvariantCulture);
    strUri += "&UICulture=" + 
      CultureInfo.CurrentUICulture.LCID.ToString(
        CultureInfo.InvariantCulture);
    strUri += "&ReportStack=1";
    strUri += "&OpType=Export";
    strUri += "&ContentDisposition=OnlyHtmlInline";
    strUri += "&Format=MHTML";
    Stream outputStream = null;
    StreamWriter streamWriter = null;
    try
    {
        //Output to Excel
        outputStream = createAndRegisterStream(report.Name, "xls",
          System.Text.Encoding.UTF8,
        "application/vnd.ms-excel", true, StreamOper.CreateAndRegister);
        streamWriter = new StreamWriter(outputStream);
        //Input
        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(strUri);
        //Credentials
        request.Credentials = System.Net.CredentialCache.DefaultCredentials;
        //Output
        HttpWebResponse response = (HttpWebResponse)request.GetResponse();
        //Input
        Stream inputStream = response.GetResponseStream();
        StreamReader streamReader = 
          new StreamReader(response.GetResponseStream());
        //Read/Write
        streamWriter.Write(streamReader.ReadToEnd());
    }
    finally
    {
        if (streamWriter != null)
        {
            streamWriter.Flush();
        }
    }
    return false;
} 
```

您可以将此渲染器添加为新的自定义扩展（然后您必须更改订阅格式）或替换现有的 excel 扩展 - 请参阅[在配置文件中指定渲染扩展参数](http://msdn.microsoft.com/en-us/library/ms156281(SQL.90).aspx)

# ruby-on-rails - GET 或 POST，使用哪种方法提交表单？

> ID：597846
> 
> 赞同：4
> 
> 时间：2009-02-28T10:43:24.233
> 
> 标签：ruby-on-rails, http, forms, webforms

我正在为我的 Ruby on Rails 应用程序编写一个 Web 表单。该表单有一个文本字段、一些复选框、一组单选按钮和两个文本框。

使用 GET 而不是 POST 的优缺点是什么，反之亦然。我一直认为您应该使用 GET 来检索表单并使用 POST 来提交，但我刚刚了解到您可以同时使用这两种方法。它真的有区别吗？干杯。

```
<% form_tag({ :action => "create" }, :method => "get") do %> 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-28T10:50:56.307

GET 请求总是添加到 URL 中，而 POST 与请求的正文一起提交。正如您所注意到的，两者都可用于检索和发送数据，但有一些区别：

1.  由于 GET 与 URL 一起发送，因此您的大小被限制为查询字符串的最大长度。这因浏览器而异，但通常至少约为 2000 个字符（在现代浏览器上）。这通常使得它不适合发送大文本字段（例如电子邮件）。

2.  由于 GET 命令在查询字符串中公开，因此用户可以轻松修改

3.  由于 GET 命令在查询字符串中，它确实使用户更容易为特定页面添加书签，假设您的页面将使用存储的一些状态变量。

4.  POST 通常更适合发送数据，因为它适合请求的性质，主要是由于上述限制。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-28T10:47:41.010

HTML 规范在技术上将两者之间的区别定义为“GET”意味着表单数据将被编码（通过浏览器）到 URL，而“POST”意味着表单数据将出现在消息正文中。

但是使用建议是，当表单处理是“幂等的”时，应该使用“GET”方法，并且仅在这些情况下。作为简化，我们可以说“GET”基本上只是为了获取（检索）数据，而“POST”可能涉及任何事情，比如存储或更新数据，或订购产品，或发送电子邮件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T10:49:46.230

取决于你是否是语义的。如果您正在制作基于 HTML 的 API，则 GET 和 POST 都具有内在意义。但一般来说，GET用于获取数据，POST用于提交数据。

最大的区别是 GET 将所有数据放在 URL 中（可以限制大小），而 POST 将其作为 HTTP 请求的数据部分发送。如果您允许使用 GET 请求输入数据，那么您也会使许多 Web 漏洞利用变得更加容易，例如 CSRF。有人可以为易受攻击的表单的操作（例如，密码更改表单？）创建一个预先填写的链接，将其发送给单击它并在不知不觉中更改密码的毫无戒心的用户。

此外，如果用户刷新进行数据输入的 GET 页面（如果您不小心，这会导致重复输入），则没有浏览器会警告用户，但是在 POST 上，大多数浏览器会显示警告。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T10:56:05.547

我认为其他答案涵盖了主要内容。我也想添加这一点。将 GET 用于关键数据（例如通过 GET 请求发送密码）将比 POST 暴露更多密码，因为它将存储在浏览器的历史缓存、代理缓存、服务器日志等中。

# c++ - 我可以有一个跨平台跨技术的解决方案吗？

> ID：597849
> 
> 赞同：3
> 
> 时间：2009-02-28T10:46:31.513
> 
> 标签：c++, soap, rpc, xml-rpc

我们有一个旧应用程序，它有一个可以从其他应用程序调用的*FORTRAN API。*一段时间后，他们为*FORTRAN API 构建了一个**(C)*包装器。然后我现在正在为*C* API构建一个带有少量数据处理的*c++包装器。*

 *****所以我在想什么是构建可以从任何编程语言调用的 API 的最佳方式。**

现在我打算从我的 c++ API 中构建 RPC 服务器。然后任何使用任何编程语言的客户端都可以调用它。

我发现**XML-RPC**是一个很好的方法。但它需要**HTTP 服务器**进行连接。

问题是调用我们API的应用程序是桌面应用程序。而且我发现XML-RPC不能操作*复杂的对象*。

**SOAP**是一个好的解决方案吗？客户端可以轻松实现吗？

**那么适合我的情况的最佳技术解决方案是什么？我应该使用哪种技术？**

*评论*：我没有更改 Fortran API 和 C API 的权限。而且我需要 c++ API，因为我正在向其中添加新方法，并增强代码以便用户可以轻松调用这些方法。

此致，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T20:16:42.093

最好的方法是不要管它，只使用 C API。*几乎所有编程语言都可以直接调用 C API*，因此没有理由创建包装器，除非特定语言的编程模型以不同的方式更有意义。

为了澄清我的意思，看看 GTK+。它是一个 C API，几乎可以在任何语言中使用。包装器存在于为 GTK+ API 提供纯 OOP 方法的面向对象语言中，因为在给定 API 领域的情况下，它对这些语言有意义。

**对象化界面对您的应用程序有意义吗？**如果没有，*就没*有理由费心制作 C++ 包装器。

至于 RPC，为什么一个简单的带有共享内存的消息传递接口就不够用了？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T11:35:13.657

任何体面的语言都有一个外来函数 API。直接调用 Fortran 函数即可。编译器文档将告诉您如何 - 在共享库中调用 Fortran 与在共享库中调用 C 非常相似，除了不同的编译器可能会将函数名规范化为小写或不使用小写，或者可能添加下划线。一些 FFI 可能需要一些 C 包装代码（例如 Java），但许多 FFI 可以只使用函数名称和参数类型以及要加载的库的名称。

如果做不到这一点，您可以实现 Fortran 的流式接口（读取和写入标准输出），然后将输入通过管道传输到它 - 我在将交互式 ISPF Fortran 应用程序快速移植到 PC 时已经做到了这一点。

* * *

由于您想公开 C++ API 和扩展而不是 Fortran API，因此请查看[SWIG](http://www.swig.org/)，它可以自动执行各种语言的流程，只要 C++ 不太复杂。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T13:32:05.373

SOAP、XML-RPC 等通常用于计算机之间的通信，这是您想要的吗？或者这一切都只是在一台计算机上运行？

如果它只是在一台计算机上，只需坚持使用 C API，大多数系统都可以使用它

如果您将 C API 建模为 REST 样式的服务，那么您还可以为无法使用 C API 但只有一个系统可记录的应用程序提供 HTTP 服务

# database - 古老、未知的存储系统需要帮助

> ID：597851
> 
> 赞同：2
> 
> 时间：2009-02-28T10:48:34.690
> 
> 标签：database, dos, legacy, file-format, flat-file

大家早，

我已经告诉客户我可以将他们的一些旧数据从基于 DOS 的系统迁移到我为他们开发的新系统中。但是我说，没有真正查看在旧系统中存储数据的文件 - 我只是认为快速谷歌会为我解决所有问题......我错了！

无论如何，这个程序有一个文件夹，里面有数百个......以及 800 个文件，有各种文件扩展名，.ave、.bak、.brw、.dat、.001、.002....、.007、.dbf、 .dbe 和 .his。

.Bak 显然不是 SQL 备份文件。

有没有人有任何使用这些文件类型的编程经验，他们可能会指出我以某种方式读取和提取数据的方向？

我不能提及程序名称，因为我认为原始开发人员不会允许这样做......

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-28T10:54:08.560

我敢打赌 .dbf 文件是[DBase 格式](http://www.clicketyclick.dk/databases/xbase/format/index.html)，这非常简单。其中的内容可能会为其他人提供线索。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-28T13:22:47.767

unix“文件”实用程序可用于通过“幻数”识别许多文件类型。它检查文件的内容并将其与数千种已知格式进行比较。如果文件是任何一种通用格式，这可能会为您节省大量工作。

如果它们不是通用格式，它可能会让您追逐红鲱鱼。就拿它的建议，建议。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-28T13:15:25.787

可以是任何东西。最好是用[十六进制编辑器](http://www.chmaas.handshake.de/delphi/freeware/xvi32/xvi32.htm)打开，看看你能看到什么

大多数旧系统使用基本 ISAM，每个表有一个文件，其中包含一组固定长度的数据记录。其他文件可能是索引

由于您只需要数据而不是索引，因此只需查找具有重复数据模式的文件（它通常看起来像十六进制编辑器屏幕上的漂亮模式）

当您找到包含数据的文件时，请尝试查找已知记录，例如“史密斯先生”，看看您是否可以计算出其他字段。整数通常是逐字节的，日期通常是编码的，从已知开始日期算起的天数，钱可能是 BCD

如果您看到一个强模式，那么很可能每条记录都是固定长度的。文件上可能会有一个标题块，比如 128 或 256 字节，然后是固定长度的记录

许多旧系统是用 COBOL 编写的。网上有很多关于 cobol 格式的信息，有些公司甚至出售 COBOL ODBC 驱动程序！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-28T14:07:58.157

[作为对Greg](https://stackoverflow.com/questions/597851/help-required-with-ancient-unknown-storage-system/597856#597856)和[Dmitriy](https://stackoverflow.com/questions/597851/help-required-with-ancient-unknown-storage-system/597867#597867)建议的站点的补充，还有位于[http://www.wotsit.org](http://www.wotsit.org)的文件格式存储库（“它的格式是什么？”）。

如果这没有帮助，一个好的十六进制编辑器（带有转储显示）是你的朋友......我总是发现阅读和识别许多文件格式是多么容易令人惊讶。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-28T11:04:09.223

我认为 Greg 对 .dbf 文件的看法是正确的。您应该尝试使用[http://fileext.com](http://filext.com)和[http://dotwhat.net](http://dotwhat.net)等网站查找有关其他文件格式的一些信息。.bak 文件通常是另一个具有相同名称但扩展名不同的文件的副本。例如，可能有 database.dbf 文件和 database.bak 文件及其备份。您应该询问（如果可能的话）使用您客户的文件的应用程序的任何详细信息/文档/源代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-28T11:16:48.427

回到 DOS 时代，程序员过去常常按照他们认为合适的方式编写自己的文件扩展名。DBF 很可能是一个易于阅读的 DBase 文件，而 .BAK 可能是其他重要文件之一的备份，或者只是文本编辑器留下的备份。

对于剩下的文件，我要做的第一件事是通过在文本编辑器中打开它们来检查它们是否是可读的 ASCII 格式。

如果这不能给您带来好的结果，请尝试在二进制编辑器中打开它们，该编辑器并排显示十六进制和 ASCII，控制字符为空白。寻找可能对应于记录字段的重复模式。例如，假设 .HIS 类似于订单历史文件，它可能包含嵌入的产品代码或名称。如果是这种情况，请计算这些字段之间的字节数。如果它是一个常规数字，您可能有一个扁平的二进制记录文件。最好通过在应用程序中打开文件、在给定记录中查找值并在二进制文件中搜索相应值来解码。费时费力，而且很麻烦，但是一旦掌握了窍门，就足够了。

快乐黑客！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-28T16:01:24.547

.DBF 是 dBASE 或早期 FoxPro 数据库。

Btrieve 使用 .DAT，DOS 使用 IIRC Paradox。

.DBE 和 .00x 文件可能是与 .DAT 文件相关的临时文件或索引文件。

.DBF 很简单。它们将使用 MS Access 或 Excel（无论如何是 2007 之前的 Office 版本）或使用 ADO 或 ODBC 打开。

如果 .DAT 文件确实是 Btrieve，那么您将处于一个受伤的世界。它们是一团糟，即使您可以获得正确版本的数据字典和 Btrieve 结构的副本。（到过那里，完成了，在我完成之前把 T 恤穿坏了。）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-28T14:27:16.597

正如其他人所建议的那样，如果您无法弄清楚这些文件是什么并且 dbf 可能是 Dbase，我推荐使用十六进制编辑器。

BAK 似乎是一个备份文件。我认为 *.001、*.002 等可能是备份的一部分。它们的大小都一样吗？也许备份被分解成更小的部分，以便可以放入可移动媒体？

最后，把它当作人生的一课。在发送该工作说明书之前，如果客户要求您将数据从系统 A 导入系统 B，请始终要求提供示例架构和示例数据和示例文件。很多时候，看似直截了当的事情变成了噩梦。

祝你好运！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-28T15:29:45.013

请务必使用文件上的修改日期作为线索，如果 .001、.002 等都具有相似的时间戳，可能与 .BAK 一起，它们可能是备份的一部分。此外，您可以（在某种程度上安全地）忽略目录中的一些旧内容。寻找 .BAT 文件并尝试剖析它们。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-01T05:03:00.487

一个提示，如果 .dbf 文件是 DBase、FoxPro 或使用该格式的其他产品之一。然后您可以使用 ODBC 读取它们。我的系统仍然有 .dbf 的 ODBC 驱动程序（Vista，带有 VS 2008 - 它是如何到达那里的，我必须寻找它，但我猜是 MDAC Microsoft Data Access 把它放在那里）。因此，如果 ODBC 驱动程序将读取 .dbf 文件，您可能不会有一个“无所事事的世界”。

我似乎记得（对 20 多年前的 DBase III 修补有点信心）DBase 使用 .001、.002、... 文件作为备忘录（大文本）字段。

祝你好运试图挽救数据。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-01T06:11:00.403

DBF 格式相当普遍。

其他文件令人费解。我猜你要么正在处理旧的 BTrieve 文件（坏），要么（希望）有一些构思不当的备份方案的结果，其中有人将他的数据库备份到同一目录而不是硬盘驱动器中如果你可以忽略这些。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-01T17:55:30.600

它现在是 Pervasive 的一部分，但几年前我使用 Data Junction 将数据从许多文件类型迁移到其他文件类型。看看，除非你想写一个解析器。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-25T13:34:35.500

.dat 也可以是旧的 Clarion 2.1 文件...它也可以在 ISAM 基础上使用，带有键/索引文件

# c++ - 友谊是在 C++ 中继承的吗？

> ID：597857
> 
> 赞同：14
> 
> 时间：2009-02-28T10:54:10.637
> 
> 标签：c++, inheritance, friend, access-control

假设我有一`Base`堂课：

```
class Base {
    friend SomeOtherClass;
}; 
```

还有另一个（不同的）类继承自`Base`：

```
class AnotherClass : public Base {} 
```

友谊也是遗传的吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-28T10:57:04.293

原则上，派生类继承基类的每个成员，除了：

```
* its constructor and its destructor
* its operator=() members
* its friends 
```

所以不行。朋友不是遗传的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-28T10:59:20.733

不，不是。

**编辑：**引用 C++ 标准，第 11.4/8 节

> 友谊既不是遗传的，也不是传递的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-28T10:57:06.103

不，不是，如此处所述：http: [//www.parashift.com/c++-faq-lite/friends.html#faq-14.4](http://www.parashift.com/c++-faq-lite/friends.html#faq-14.4)

# stored-procedures - 如何在合并语句中使用过程参数

> ID：597862
> 
> 赞同：1
> 
> 时间：2009-02-28T10:59:31.760
> 
> 标签：stored-procedures, plsql, parameters, upsert

我正在创建一个使用合并语句（upsert）更新/插入表的过程。现在我遇到了一个问题：使用过程参数我必须执行此 upsert。

过程 xyz( a in table.a%type,b in table.b%type,....) 是一些局部变量；开始使用 source_table 合并到 target_table -**而不是源表，我必须** 在匹配时在（表中主键的条件）上使用过程参数，然后在不匹配时更新表，然后插入表；结束 xyz；那么如何在合并语句中使用过程参数而不是源表？或建议我查询以获取过程参数并将其用作源表值。

请帮帮我。提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2017-04-20T20:59:15.887

我知道我迟到了八年，但我认为我正在尝试做一些与你正在做的事情类似的事情，但尝试根据传递给存储过程的参数进行 Upsert，该存储过程在成功时返回一个空字符串并且返回我的 VB 代码时出现错误。下面是我的所有代码以及解释我做了什么以及为什么这样做的注释。让我知道这是否对您或其他任何人有帮助。这是我第一次回复帖子。

```
PROCEDURE UpsertTSJobData(ActivitySeq_in IN NUMBER,
  Owner_in In VARCHAR2,
  NumTrailers_in IN NUMBER,
  ReleaseFormReceived_in IN NUMBER,
  Response_out OUT VARCHAR2) AS

  err_num NUMBER;
  err_msg VARCHAR2(4000);

  BEGIN
    --This top line essentially does a "SELECT *" from the named table
    --and looks for a match based on the "ON" statement below
    MERGE INTO glob1app.GFS_TS_JOBDATA_TAB tsj
    --This select statement is used for the INSERT when no match
    --is found and the UPDATE when a match is found.
    --It creates a "pseudo-table"
    USING (
      SELECT ActivitySeq_in AS ActSeq,
        Owner_in As Owner,
        NumTrailers_in As NumTrailers,
        ReleaseFormReceived_in As ReleaseFormReceived
        FROM DUAL) input
    --This ON statement is what we're doing the match on to find
    --matching records. This decides whether it will be an
    --INSERT or an UPDATE
    ON (tsj.Activity_seq = ActivitySeq_in)
    WHEN MATCHED THEN
      --Here we UPDATE based on the passed in input table
      UPDATE
        SET OWNER = input.owner,
          NUMTRAILERS = input.NumTrailers,
          RELEASEFORMRECEIVED = input.releaseformreceived
    WHEN NOT MATCHED THEN
      --Here we INSERT based on the passed in input table
      INSERT (
        ACTIVITY_SEQ,
        OWNER,
        NUMTRAILERS,
        RELEASEFORMRECEIVED
        )
      VALUES (
        input.actseq,
        input.owner,
        input.numtrailers,
        input.releaseformreceived
    );

    Response_out := '';

    EXCEPTION
      WHEN OTHERS THEN
        err_num := SQLCODE;
        err_msg := SUBSTR(SQLERRM, 1, 3900);
        Response_out := TO_CHAR (err_num) || ': ' || err_msg;
  END; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T11:38:17.317

可能像

```
DECLARE V_EXISTS NUMBER;
BEGIN SELECT COUNT(*) INTO V_EXISTS FROM TARGET_TABLE WHERE PK_ID = :ID;

    IF V_EXISTS  > 0 THEN
        -- UPDATE
    ELSE
        -- INSERT
    END IF;
END; 
```

此外，您可以尝试使用所谓的临时表（从 DUAL 中选择）

```
CREATE TABLE TEST (N NUMBER(2), NAME VARCHAR2(20), ADRESS VARCHAR2(100));
INSERT INTO TEST VALUES(1, 'Name1', 'Adress1');
INSERT INTO TEST VALUES(2, 'Name2', 'Adress2');
INSERT INTO TEST VALUES(3, 'Name3', 'Adress3');
SELECT * FROM TEST;
-- test update
MERGE INTO TEST trg
USING (SELECT 1 AS N, 'NameUpdated' AS NAME, 
  'AdressUpdated' AS ADRESS FROM Dual )  src                
ON ( src.N = trg.N )
WHEN MATCHED THEN
    UPDATE 
    SET trg.NAME = src.NAME,
        trg.ADRESS = src.ADRESS
WHEN NOT MATCHED THEN
    INSERT VALUES (src.N, src.NAME, src.ADRESS);
SELECT * FROM TEST;
-- test insert
MERGE INTO TEST trg
USING (SELECT 34 AS N, 'NameInserted' AS NAME, 
  'AdressInserted' AS ADRESS FROM Dual )  src                
ON ( src.N = trg.N )
WHEN MATCHED THEN
    UPDATE 
    SET trg.NAME = src.NAME,
        trg.ADRESS = src.ADRESS
WHEN NOT MATCHED THEN
    INSERT VALUES (src.N, src.NAME, src.ADRESS);
SELECT * FROM TEST;
DROP TABLE TEST; 
```

看[这里](http://www.experts-exchange.com/Database/Oracle/Q_20647073.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T11:40:40.650

很难从您那里确切地说出您的问题是什么，但我认为您希望合并到（或合并到）的表是动态的。在这种情况下，您应该使用[DBMS_SQL](http://www.psoug.org/reference/dbms_sql.html)包来创建动态 SQL

# php - 如何在 PHP 中对日期数组进行排序

> ID：597863
> 
> 赞同：20
> 
> 时间：2009-02-28T11:00:48.733
> 
> 标签：php, arrays, arraylist, associative-array, sorting

我有一个这种格式的数组：

```
Array
(
    [0] => Array
        (
            [28th February, 2009] => 'bla'
        )

    [1] => Array
        (
            [19th March, 2009] => 'bla'
        )

    [2] => Array
        (
            [5th April, 2009] => 'bla'
        )

    [3] => Array
        (
            [19th April, 2009] => 'bla'
        )

    [4] => Array
        (
            [2nd May, 2009] => 'bla'
        )

) 
```

我想按日期的升序（基于月、日和年）对它们进行排序。最好的方法是什么？

最初，电子邮件是以 MySQL 日期格式获取的，所以我可以让数组处于这种状态：

```
Array
[
    ['2008-02-28']='some text',
    ['2008-03-06']='some text'
] 
```

也许当它采用这种格式时，我可以遍历它们，删除所有`'-'`（连字符）标记，以便它们保留为整数，使用`array_sort()`它们对它们进行排序并再次循环它们以对它们进行排序？如果有另一种方式，我会更喜欢每个用户用这个做 3 个循环。

谢谢。

编辑：我也可以这样做：

```
$array[$index]=array('human'=>'28 Feb, 2009',
                   'db'=>'20080228',
                   'description'=>'Some text here'); 
```

但是使用这个，是否有任何方法可以仅基于“db”元素对数组进行排序？

编辑 2：更新了初始 var_dump

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-02-28T11:07:45.720

使用 ISO ( `yyyy-mm-dd`) 格式而不是“english”格式，然后只需使用该[`ksort`](http://www.php.net/manual/en/function.ksort.php)函数以正确的顺序获取它们。

无需删除连字符，`ksort`将对字符串键进行字母数字比较，并且`yyyy-mm-dd`格式工作得很好，因为词汇顺序与实际日期顺序相同。

**编辑**我看到你现在已经纠正了你的问题，表明你实际上有一个数组数组，并且排序键在子数组中。在这种情况下，您应该`uksort`按照其他地方的建议使用，但我建议您根据 DB 格式的日期进行自己的编辑和排序，而不是通过解析人类​​可读的格式：

```
function cmp($a, $b)
{
    global $array;
    return strcmp($array[$a]['db'], $array[$b]['db']);
}

uksort($array, 'cmp'); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-12-23T03:22:12.060

实际上，使用这个：

```
usort($array, "cmp");

function cmp($a, $b){ 
    return strcmp($b['db'], $a['db']); 
} 
```

:)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-08T10:40:37.110

```
function cmp($a, $b) {    
    global $array;    
    return strcmp($array[$a]['db'], $array[$b]['db']); 
}    
uksort($array, 'cmp'); 
```

我认为最好使用`usort()`function 而不是`uksort()`，因为有时您根本无法使用全局变量，而且无论如何使用全局变量也不是一个好习惯。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-02-08T16:09:41.833

您也可以使用匿名函数。

```
// Sort in chronological order.
usort($array, function($a, $b) {
  return strcmp($a['db'], $b['db']);
}); 
```

# com - 获取 ASP 中的 Com 对象列表

> ID：597871
> 
> 赞同：2
> 
> 时间：2009-02-28T11:08:53.550
> 
> 标签：com, command-line

我手头的一项任务要求我将 ASP 应用程序从一台服务器移动到另一台服务器。为此，我需要两个命令行工具之类的东西来了解以下信息。

1.  获取此 asp 项目中使用的 com 对象列表。
2.  获取我现有服务器中已注册 com 对象的列表。

任何的想法 ？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T11:16:02.877

快速搜索“CreateObject”应该找出所有从 ASP 页面中的 VBScript 创建的 COM 对象。您还应该检查 global.asa 中的任何对象标记，这是 COM 对象实例化的另一种方式。如果您还有服务器端 Javascript，那么您还应该寻找“ActiveXObject”。

我希望您可以使用 grep 等命令行工具提取此信息，但除非您在不同的设置上一遍又一遍地执行此操作，否则在 VS.NET 或类似[Agent Ransack](http://www.mythicsoft.com/agentransack/)之类的东西中执行此操作几乎肯定会更快。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T14:39:37.940

正如@andynormancx 所建议的，在您的代码中搜索适当的调用：

*   创建对象
*   获取对象
*   global.asa 中的对象标签
*   ActiveXObject（来自 javascript）

您可以使用 WMI 对象来获取现有服务器上所有 COM 对象的列表。这可能不会很有用，但可能会在您的新服务器上执行此操作，然后在两者之间进行差异以识别可能重要的差异。获取对象列表的示例脚本在[这里](http://www.winscripter.com/WSH/COM/321.aspx)：

# linq - LINQ 多个 where 子句

> ID：597873
> 
> 赞同：11
> 
> 时间：2009-02-28T11:14:51.803
> 
> 标签：linq, where-clause

我有一个课程表，我需要根据在搜索框中输入的关键字进行搜索。这是一个示例查询：

```
SELECT * FROM Courses WHERE 
Title LIKE '%word%' OR Title LIKE '%excel%' OR 
Contents LIKE '%word%' OR Contents LIKE '%excel%' 
```

如何在 LINQ 中转换它，其中 LINQ 会根据每个关键字动态生成 W​​HERE 语句。

我尝试使用 PredicateBuilder，只要该字段是 VARCHAR，它就可以正常工作。对于“TEXT”字段，不会生成引号，从而导致编译器给出错误消息。这是 PredicateBuilder 生成的 SQL

```
SELECT [t0].[CoursesID], [t0].[Title], [t0].[Contents], [t0].[Active], 
FROM [dbo].[Courses] AS [t0]
WHERE ([t0].[Title] LIKE '%word%') OR ([t0].[Contents] LIKE %word%) OR 
([t0].Title] LIKE '%excel%') OR ([t0].[Contents] LIKE %excel%) 
```

请注意，作为数据库中的文本字段的“内容”字段没有单引号。

有没有简单的方法来构建 WHERE 语句并将其附加到查询中？有谁知道没有 PredicateBuilder 我怎么能做到这一点？

提前致谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-28T11:56:52.420

由于您正在使用 LINQ，我想您正在使用 LINQ-to-SQL 数据上下文，对吧？我没有备用的 DataContext 来测试这个，但这应该会给你一些想法。

我不知道它是否适用于数据上下文，但其中大多数都是非常基本的东西（链接 OR 运算符和包含方法调用），因此当查询转换为 SQL 时它不应该引起问题。

首先，我创建一个自定义函数来构建我的谓词：

```
Func<string, Func<DataItem, bool>> buildKeywordPredicate =
    keyword =>
        x => x.Title.Contains(keyword)
            || x.Contents.Contains(keyword); 
```

这是一个函数，它接受一个字符串关键字，然后返回另一个函数，该函数接受一个 DataItem 并根据关键字检查它。

基本上，如果你传入“Stack”，你会得到一个谓词：`x => x.Title.Contains("Stack") || x.Contents.Contains("Stack")`.

接下来，由于有许多可能的关键字，并且您需要使用 OR 操作将其链接起来，因此我创建了另一个辅助函数来将 2 个谓词与 OR 链接在一起

```
Func<Func<DataItem,bool>, Func<DataItem, bool>, Func<DataItem, bool>> buildOrPredicate =
    (pred1, pred2) =>
        x => pred1(x) || pred2(x); 
```

此函数接受 2 个谓词，然后用 OR 操作将它们连接起来。

有了这两个函数，我就可以像这样构建我的 where 谓词：

```
foreach (var word in keywords) {            
    filter = filter == null
        ? buildKeywordPredicate(word)
        : buildOrPredicate(filter, buildKeywordPredicate(word));
} 
```

循环内的第一行基本上检查过滤器是否为空。如果是，那么我们需要为我们构建一个简单的关键字过滤器。

否则，如果过滤器不为空，我们需要使用 OR 操作链接现有过滤器，因此我们将现有过滤器和新关键字过滤器传递给 buildOrPredicate 来做到这一点。

然后我们现在可以创建查询的 WHERE 部分：

```
var result = data.Where(filter); 
```

传入我们刚刚构建的复杂谓词。

我不知道这是否与使用 PredicateBuilder 不同，但由于我们将查询转换推迟到 LINQ-to-SQL 引擎，所以应该没有任何问题。

但正如我所说，我还没有针对真实的数据上下文对其进行测试，所以如果有任何问题，您可以在评论中写下。

**这是我为测试而构建的控制台应用程序：http: [//pastebin.com/feb8cc1e](http://pastebin.com/feb8cc1e)**

希望这可以帮助！

* * *

**编辑：**对于涉及正确利用 LINQ 中的表达式树的更通用和可重用的版本，请查看 Thomas Petricek 的博客文章：[http ://tomasp.net/articles/dynamic-linq-queries.aspx](http://tomasp.net/articles/dynamic-linq-queries.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T11:55:32.843

由于谓词构建器不知道调用 Contains 方法的属性的 DB 类型，我想这可能是 linq to sql 内部的问题。您是否尝试过使用普通查询（不是使用谓词生成器）和包含包含的 TEXT 列？

# javascript - JavaScript shell - 有什么区别

> ID：597876
> 
> 赞同：4
> 
> 时间：2009-02-28T11:15:34.563
> 
> 标签：javascript

[https://developer.mozilla.org/en/JavaScript_shells](https://developer.mozilla.org/en/JavaScript_shells)列出了很多 shell。他们之间有什么可以选择的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T16:48:41.157

我总是使用 firebug 中的命令行工具来测试代码片段，多行代码有一个“更大的命令行”选项，所以一定要启用它。CTRL+SHIFT+L 是打开命令行面板的快捷键。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T15:50:51.803

[Rhino Shell](https://developer.mozilla.org/en/Rhino_Shell)不在列表中，但非常酷，如果您想编写业务逻辑和探索数据。

# c# - C# 会话管理

> ID：597880
> 
> 赞同：0
> 
> 时间：2009-02-28T11:17:06.883
> 
> 标签：c#, web-services, authentication, logout

我正在使用 C# Webservice 注销用户。我正在使用 formsauthentication.signout 。

我通过 JQuery 传递这个 web 服务调用。如何让用户重定向到登录页面？我尝试了 window.location = "login.aspx"，它可以工作，但是如果我在安全区域中输入另一个页面，它会再次打开。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-06T00:06:35.777

您确定 FormsAuthentication.SignOut() 正在运行吗？（调试以确保它被 Web 服务命中。）

您还应该在成功调用 Web 服务后，在您的 jQuery 处理程序中手动清除客户端上的身份验证 cookie。

# performance - 如何实现线程注释？

> ID：597882
> 
> 赞同：33
> 
> 时间：2009-02-28T11:22:10.240
> 
> 标签：performance, database-design, comments, query-optimization, table-structure

我正在开发一个可以支持线程注释的 Web 应用程序。我需要能够根据收到的票数重新排列评论。[（与reddit](http://www.reddit.com/)中线程评论的工作方式相同）

我很想听听 SO 社区关于如何做到这一点的意见。

我应该如何设计**评论**表？这是我现在使用的结构：

```
Comment
    id
    parent_post
    parent_comment
    author
    points 
```

应该对这个结构做哪些改变？

我应该如何从该表中获取详细信息以便以正确的方式显示它们？（欢迎以任何语言实现。我只是想知道如何以最好的方式做到这一点）

在实现此功能以减少 CPU/数据库的负载时，我需要注意哪些事项？

提前致谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-28T11:51:34.820

在数据库中存储树是一个有许多不同解决方案的主题。这取决于您是否还想检索子层次结构（因此项目 X 的​​所有子项），或者您是否只想获取整个层次结构集并使用字典以 O(n) 的方式在内存中构建树。

您的表格的优势在于，您可以通过过滤父帖子，一次性获取帖子的所有评论。当您以教科书/幼稚的方式定义评论的父级时，您必须在内存中构建树（见下文）。如果要从数据库中获取树，则需要另一种存储树的方法：请参阅我对基于预计算的方法的描述： [http ://www.llblgen.com/tinyforum/GotoMessage.aspx?MessageID =17746&ThreadID=3208](http://www.llblgen.com/tinyforum/GotoMessage.aspx?MessageID=17746&ThreadID=3208) 或[使用此处 CELKO 描述的平衡树](http://groups-beta.google.com/group/microsoft.public.sqlserver.programming/browse_frm/thread/a0971b548a1daa06/d94afd1d56858df4?q=tree)：

或另一种方法： [http ://www.sqlteam.com/article/more-trees-hierarchies-in-sql](http://www.sqlteam.com/article/more-trees-hierarchies-in-sql)

如果您在内存中获取层次结构中的所有内容并在那里构建树，由于查询非常简单，因此效率会更高： select .. from Comment where ParentPost = @id ORDER BY ParentComment ASC

在该查询之后，您只需 1 个字典在内存中构建树，该字典跟踪元组 CommentID - Comment。您现在遍历结果集并动态构建树：遇到的每条评论，您都可以在字典中查找其父评论，然后将当前处理的评论也存储在该字典中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-02T15:52:44.130

还要考虑几件事...

1) 当您根据排名或日期说“排序类似于 reddit”时，您是指顶级还是整个事情？

2）当你删除一个节点时，分支会发生什么？你重新养育他们吗？在我的实现中，我认为编辑器将决定——要么隐藏节点并将其与可见的子节点一起显示为“评论隐藏”，要么隐藏评论及其子节点，或者核对整个树。重新养育应该很容易（只需将孩子的父母设置为被删除的父母），但是涉及整个树的任何事情似乎都很难在数据库中实现。

我一直在研究 PostgreSQL 的[ltree](http://www.sai.msu.su/~megera/postgres/gist/ltree/)模块。它应该使涉及部分树的数据库操作更快一些。它基本上可以让您在表中设置一个字段，如下所示：

```
ltreetest=# select path from test where path <@ 'Top.Science';
                path                
------------------------------------
 Top.Science
 Top.Science.Astronomy
 Top.Science.Astronomy.Astrophysics
 Top.Science.Astronomy.Cosmology 
```

但是，它本身并不能确保任何类型的引用完整性。换句话说，您可以拥有“Top.Science.Astronomy”的记录，而无需“Top.Science”或“Top”的记录。但它确实让你做的是这样的事情：

```
-- hide the children of Top.Science
UPDATE test SET hide_me=true WHERE path @> 'Top.Science'; 
```

或者

```
-- nuke the cosmology branch
DELETE FROM test WHERE path @> 'Top.Science.Cosmology'; 
```

如果结合使用存储过程的传统“comment_id”/“parent_id”方法，我认为您可以两全其美。您可以使用您的“路径”快速遍历数据库中的评论树，并仍然通过“comment_id”/“parent_id”确保引用完整性。我正在设想类似的东西：

```
CREATE TABLE comments (
comment_id SERIAL PRIMARY KEY,
parent_comment_id int REFERENCES comments(comment_id) ON UPDATE CASCADE ON DELETE CASCADE,
thread_id int NOT NULL  REFERENCES threads(thread_id) ON UPDATE CASCADE ON DELETE CASCADE,
path ltree NOT NULL,
comment_body text NOT NULL,
hide boolean not null default false
); 
```

评论的路径字符串看起来像

```
<thread_id>.<parent_id_#1>.<parent_id_#2>.<parent_id_#3>.<my_comment_id> 
```

因此，comment_id 为“1”的线程“102”的根注释将具有以下路径：

`102.1`

而comment_id 为“3”的孩子将是：

`102.1.3`

“3”的一些孩子的 ID 为“31”和“54”将是：

```
102.1.3.31
102.1.3.54 
```

要隐藏节点“3”及其子节点，您可以发出以下命令：

```
UPDATE comments SET hide=true WHERE path @> '102.1.3'; 
```

我不知道——它可能会增加不必要的开销。另外，我不知道 ltree 的维护情况如何。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-28T12:50:14.523

您当前的设计基本上适用于小型层次结构（少于千项）

如果您想获取某个级别或深度，请在您的结构中添加一个“级别”项目并将其作为保存的一部分进行计算

如果性能是一个问题，请使用不错的缓存

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-28T13:16:12.680

我会在上面的表格中添加以下新字段：

*   thread_id：附加到特定对象的所有注释的标识符

*   date：评论日期（允许按顺序获取评论）

*   rank：评论排名（允许通过排名获取评论顺序）

使用这些字段，您将能够：

1.  在单个操作中获取线程中的所有评论
2.  按日期或排名对线程中的评论进行排序

不幸的是，如果您想保留接近 SQL 标准的查询数据库，则必须在内存中重新创建树。一些数据库为分层数据提供特殊查询（fe Oracle）

./亚历克斯

# c# - 从 SQL 2005 中的存储过程返回的值是否有大小限制？

> ID：597884
> 
> 赞同：0
> 
> 时间：2009-02-28T11:26:55.067
> 
> 标签：c#, sql-server, sql-server-2005

我正在尝试使用 For Xml 从 SQL Server 2005 返回 Xml 值。从 SQL Server 返回的 xml 大小是否有任何限制？

我将使用 ExecuteXmlReader 来获取我的 C# 代码中的值。

此外，XmlReader 中可以保存的数据是否有任何限制？

有什么想法吗...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T12:20:24.140

没有*实际*限制，但您通常返回 nvarchar(MAX) 的等价物，因此您可能会遇到约 20 亿个字符的限制（由于可用地址空间有限，可能要少得多）。

但是，您需要担心不小的限制，例如 32KB 的 SQL 语句限制。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T05:03:07.617

从技术上讲，存在 1 Gig 的限制，因为 XML 数据类型基于 NVARCHAR(MAX) 数据类型。但是，如果您有一个 1 Gig XML 文档，则需要考虑将其缩小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T20:34:11.480

确保使用以下代码：

```
while(xmlReader.Read()){ 
...
} 
```

否则，如果您的 XML 文档太大而无法放入一条记录，您最终可能会得到无效的 XML。今天，SQL Server 会将它分布在多条记录中，...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T11:40:38.217

不，没有限制。但应该很明显，如果返回数兆字节的数据，数据检索的速度就会受到影响。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-28T12:27:56.137

对于 SQL 2005 和 .Net 2.0，Microsoft 不会发布限制，但实际上大型结果集可能会因“内存不足”错误等而失败

对于 XML 给 DB 服务器带来了额外的负载，您确定在应用程序服务器或客户端上将原始数据处理成 XML 不是更好吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-23T18:33:42.320

如果您在 SQL Server Management Studio 中查看结果，则可以选择设置它可以显示多少数据，默认情况下只有 2MB。

要更改它，请遵循以下路径：
工具 > 选项 > 查询结果 > SQL Server > 网格结果 > 检索到的最大字符数

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-09-16T20:40:33.027

SQL Server -> XML，然后 C# 将文本转换为 XML。那里效率不高。

拉回数据正常。使用数据阅读器。然后你可以把它变成可翻译的格式。这些数据的消费者是什么？他们真的需要 XML 吗？他们需要定期转储数据吗？

或者，您可以使用 DataSet。您可能在这里有一个很好的数据集案例。您可以将其保存为 XML 并保存或发送。DataSet 旨在保存一堆表数据。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-09-17T11:00:59.310

如果返回的字符数超过该字符数，则会出现异常“发生意外的文件结尾”，因此可以使用以下代码防止出现这种情况：

```
 using(XmlReader reader = command.ExecuteXmlReader())
            {
                XmlDocument xmlDocument = new XmlDocument();

                while (reader.Read())
                {
                    xmlDocument.Load(reader);
                }

                return xmlDocument;
            } 
```

# unit-testing - NUnit（或 NUnitLite）和 .NET CF 的“入门”问题

> ID：597886
> 
> 赞同：4
> 
> 时间：2009-02-28T11:28:15.063
> 
> 标签：unit-testing, compact-framework, nunit

我有一个现有的 VS 2005 Std .NET Compact Framework 应用程序，我想对其进行一些主要的重构。目前没有单元测试，但我想在弄乱代码之前添加它。我没有单元测试的实际经验，即使我知道这个理论（只是从来没有真正实现它；我知道：真丢脸:-)） 以下是我目前正在思考的一些问题：

a) 作为初学者，我应该使用 NUnit 还是 NUnitLite（声称更容易使用）？

b) 我的目标应该是在移动设备上还是在桌面上运行测试（当然，特定于设备的代码除外）？目前桌面看起来更有吸引力，尤其是在自动化构建中包含测试......

c) 我要测试的类通常如何包含在测试项目中？我的应用程序是一个 .EXE 文件，即我不能像测试项目中的 .DLL 程序集一样引用它（或者我可以吗？从来没有尝试过这个......）。我检查了各种 NUnit 教程，但没有发现任何提及，或者一个教程建议将我要测试的类复制并粘贴到测试项目中（yuk！）。我应该链接到我的测试项目中的原始源代码文件吗？私有方法或对其他类的依赖呢？

d) 我应该开始修改我的原始代码以实现更好的可测试性，例如公开私有方法、解耦等吗？这有点像在能够测试之前进行重构，这对我来说听起来不太好......或者在开始时根本不接触原始代码是更好的做法，即使这意味着更少的代码覆盖等？

e) 我应该研究大多数人使用的任何其他工具或插件吗？

在此先感谢您的任何答案（如果仅针对上述一项或多项内容，我也很感激答案）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-28T13:08:35.163

首先，我会推荐你​​一本关于单元测试的好书：[Pragmatic Unit Testing in C#](http://www.pragprog.com/titles/utc2/pragmatic-unit-testing-in-c-with-nunit)。

它将向您介绍 NUnit，但更重要的是，作者通常会为您提供很多如何编写**好的**单元测试的建议。xUnit 测试框架不是很复杂，您会很快适应它们的 API/工作流程。具有挑战性的是识别边界条件、减少耦合和设计可测试性的实际过程。它以电子书 (PDF) 或印刷版的形式提供。

关于你的实际问题（本书也会给你一些答案）：

*   @a）我没有使用 NUnit lite 的经验，因此在这一点上我不能给你任何建议。
*   @b）单元测试在它们的依赖方面应该是非常本地化的。您的目标是测试彼此独立的类，因此无需先将其部署在移动设备上。您不会运行完整的应用程序，只需单独测试组件。因此，我建议使用您的台式机作为单元测试环境的目标。你也会得到更好的周转时间。
*   @c）您必须引用包含要在测试项目中测试的类的程序集。测试项目本身就是一个程序集 (DLL)。测试运行程序执行此程序集并使用存储的元信息来运行包含的测试用例。
*   @d）这在很大程度上取决于您的软件的状态和设计。但总的来说，我会使用分而治之的策略：在类之间引入接口并开始逐步重构。在开始更改实现之前编写单元测试。接口使合约保持正常运行，但您可以在必要时更改底层实现。不要仅仅为了使它们可测试而公开私有方法。私有方法是类的内部助手，支持公共方法完成工作。由于您测试了您的公共方法，您将断言您的私有方法做正确的事情。
*   @e) Visual Studio 的一个有用插件是[TestDriven.Net](http://www.testdriven.net/)。它允许您直接从 IDE 运行 NUnit 测试，而无需更改为 NUnit 的 GUI 或控制台运行程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T13:23:02.260

@c）我没有尝试过，但我认为 VisualStudio 可以让您将测试程序集中的项目引用添加到您的实际代码程序集中，即使它是一个 exe。

至于私有方法等，一般我不测试私有方法。理论上，所有私有的东西都应该被公共或内部方法使用，所以测试那些应该间接测试私有。

不过，我确实测试了公共和内部。我发现非常有用的一件事是[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)属性：

```
[assembly:InternalsVisibleTo("MyTestAssembly")] 
```

您可以使用它使一个组件的内部对另一个组件可见。我使用此属性将内部结构暴露给我的测试程序集，以便它可以直接引用它们。

# apache-flex - 如何将子项添加到 LegendItem？

> ID：597894
> 
> 赞同：0
> 
> 时间：2009-02-28T11:36:06.883
> 
> 标签：apache-flex, charts, legend

我正在尝试向图表图例中的 LegendItem 对象添加标签，但没有取得多大成功。我扩展了 LegendItem 类，我制作的类的构造函数如下。问题是您看到我尝试添加的标签没有出现在图例项中。它在那里（我可以用 getChildByName 找到它），但由于某种原因它是不可见的。

是否有一些特殊的方法可以将对象添加到自定义图例项？谢谢。

```
public function LegendItemExtended() {
    super();
    someText = new Label();
    someText.name = "label";
    someText.text = "hi";
    addChild(someText);
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T13:17:15.377

您忘记输入宽度和高度：D，例如：

```
someText.width = 200;
someText.height = 200; 
```

并尝试在此函数中添加您的标签：

```
override protected function createChildren():void 
```

我希望这会有所帮助。

# css - 为什么超过 96 的 dpi 设置会搞砸我的网站？

> ID：597902
> 
> 赞同：2
> 
> 时间：2009-02-28T11:41:34.530
> 
> 标签：css, dpi

我注意到，当 dpi 设置为高于 96 到喜欢 120 时，我的网站在使用 Firefox 或 IE7 时会变得混乱。CSS基本上打破了。有人知道怎么修这个东西吗？

[链接到网站](http://www.iaddesignandstudio.com)

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T11:56:46.460

该站点使用固定大小的布局，但混合了单位`px`和`pt`. 更改屏幕的 dpi 时，这些单位的相对大小会发生变化，即站点被设计破坏了。

你应该做什么：

*   不`pt`用于屏幕布局 -`pt`仅用于打印
*   阅读液体布局和相关单位`em`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T11:56:04.153

如果用户调整了他们的 Windows DPI 设置，没有真正的修复可以*防止任何事情发生。*将 Windows 更改为“大字体”模式，或将其设置为默认值以外的 DPI 设置，会影响 IE 中的所有布局。

但是，这绝不应该导致网站大规模中断。可能由于值的四舍五入，一些事情会稍微错位。

当字体大小更改时，您所指向的站点确实会严重损坏 - 例如，更改浏览器中的默认字体（或将 Firefox 设置为“仅缩放文本”）。按钮中的文本完全离开按钮并开始悬停在其他地方。

看起来，至少对于顶部的按钮来说，造成这种情况的主要原因是整行按钮是单个背景图像，其中的文本是浮动元素，仅在给定的字体大小下才与背景图像匹配- 对它们的大小和位置进行任何调整，它们都会与背景不符。

设计时，始终更改缩放设置（在 IE7 和 Firefox 中）和字体大小（例如在 Firefox 中使用“仅缩放文本”），并确保那些确实改变大小的东西不会破坏网站。在某些情况下，“pt”中指定的内容会缩放，而“px”中指定的内容不会。

*你怎么能解决它*

很明显，您已将所有内容设计为以像素为单位的特定大小，包括标题和所有按钮/选项卡。如果您想这样做，请将标头 DIV 声明为 position: relative，并使用像素值（相对于包含 div）将 H1、H2 和 UL 绝对定位在其中。从 DIV 中删除边距、填充等以简化。使用像素指定 LI 元素的宽度、高度和上边距。

*我会做什么*

通常情况下，我会构建这样的东西以使其具有灵活性，因此如果由于某种原因一个人在他们的浏览器上启用了非常大的字体，它会很好地处理它。这对于您的背景图像来说实际上是不可能的，因为它们是专门为一个给定的尺寸构建的。所以我会在标题上有一个可重复的背景，我会分别为每个按钮做每个背景。显然，这将是更多的工作。

# python - 监视文件/目录的内容？

> ID：597903
> 
> 赞同：61
> 
> 时间：2009-02-28T11:42:09.100
> 
> 标签：python, file, cross-platform, filesystems, monitoring

我在找一个跨平台的文件监控python包？我知道可以使用 pywin32 监视 Windows 上的文件，并且有一些包可以在 Linux/Unix 上运行，但是有人知道跨平台的吗？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2010-11-19T10:42:54.140

我正在开发一个 MIT 许可的库，它可以帮助 Python 程序尽可能便携地监视文件系统事件。我正在努力消除一些差异。目前高度 alpha 版本：

在这里查看：http: [//github.com/gorakhargosh/watchdog/](http://github.com/gorakhargosh/watchdog/)

欢迎补丁和贡献。

希望能帮助到你。=) 干杯。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-02-28T12:27:13.267

对于基于 Unix/Linux 的系统，您应该使用[File Alteration Monitor Python 绑定](http://sourceforge.net/projects/python-fam/)到[libfam](http://oss.sgi.com/projects/fam/)。

对于基于 Windows 的系统，您应该绑定到 Win32 API[`FindFirstChangeNotification`](http://msdn.microsoft.com/en-us/library/aa364417%28VS.85%29.aspx)和相关函数。

至于跨平台方式，我不知道有没有好的跨平台方式。我认为最好自己构建一个模块，该模块在检测到它是什么操作系统后，可以在使用上述两种方法之一的任一操作系统上运行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-28T11:55:34.107

我找到了这个链接，它谈到了你的问题。尽管它并没有真正提供解决方案/库，但我认为它会有所帮助。 [http://www.stepthreeprofit.com/2008/06/cross-platform-monitoring-of-filesystem.html](http://www.stepthreeprofit.com/2008/06/cross-platform-monitoring-of-filesystem.html)

我不认为有一个跨平台的，所以你可能想推出自己的。

我在这方面缺乏经验，所以我不太确定。我希望这有帮助。

**请注意**
，我的立场已得到纠正，正如 Adam Bernier 在评论中向我指出的那样，cygwin 上提供了 gamin。您可能想研究 cygwin 上的其他选项（如果存在）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-06T03:50:55.247

另请查看此选项：

[http://pypi.python.org/pypi/watchdog](http://pypi.python.org/pypi/watchdog)

与 Windows 和 OS X 上的跨平台应用程序一起使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T13:46:09.927

Linux 上最简单的方法是使用 inotifywait（假设您的内核足够新）。您不需要任何特殊绑定，可以自定义 inotifywait 以按照您想要的任何方式在标准输出上打印输出行。看看[这个问题](https://stackoverflow.com/questions/420143/making-git-auto-commit)就是一个很好的例子。

# javascript - 打开网页并使用 JavaScript 解析它

> ID：597907
> 
> 赞同：32
> 
> 时间：2009-02-28T11:46:05.783
> 
> 标签：javascript, regex, parsing, webpage

我知道 JavaScript 可以在新窗口中打开链接，但是是否可以打开网页而不在窗口中打开或向用户显示？我想要做的是解析该网页的一些文本并将其用作变量。

**如果没有**服务器端语言的任何帮助，这可能吗？如果是这样，请给我一个可以实现这一目标的方向。

谢谢大家

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-28T11:51:46.613

您可以使用[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)对象来执行此操作。这是一个简单的例子

```
var req = new XMLHttpRequest();  
req.open('GET', 'http://www.mydomain.com/', false);   
req.send(null);  
if(req.status == 200)  
   dump(req.responseText); 
```

加载后，您可以通过在 req.responseText 成员上 使用[javascript 正则表达式来执行解析/抓取。](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/RegExp)

## 更多详情...

在实践中，您需要做更多的工作才能以跨平台方式获取 XMLHttpRequest 对象，例如：

```
var ua = navigator.userAgent.toLowerCase();
if (!window.ActiveXObject)
  req = new XMLHttpRequest();
else if (ua.indexOf('msie 5') == -1)
  req = new ActiveXObject("Msxml2.XMLHTTP");
else
  req = new ActiveXObject("Microsoft.XMLHTTP"); 
```

## 或者使用图书馆...

或者，您可以省去所有的麻烦，只需使用[jQuery](http://docs.jquery.com/Ajax)或[Prototype](http://www.prototypejs.org/api/ajax)之类的库来为您处理这个问题。

## 同源政策可能会咬你...

请注意，由于[同源策略](http://www.w3.org/TR/XMLHttpRequest/#same-origin)，您请求的页面必须与发出请求的页面来自同一域。如果要请求远程页面，则必须通过服务器端脚本代理该页面。

另一种可能的解决方法是使用 Flash 发出请求，如果目标站点使用适当配置的 crossdomain.xml 文件授予权限，它确实允许跨域请求。

这是一篇关于同源策略主题的好文章：

*   [同源策略第 1 部分：为什么我们会被 XSS 和 XSRF/CSRF 之类的东西卡住](http://taossa.com/index.php/2007/02/08/same-origin-policy/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2015-10-07T08:14:15.177

无论 Origin 是一个开源库，它允许您使用纯 Javascript 进行抓取。它还解决了“同域起源”问题。 [http://www.whateverorigin.org/](http://www.whateverorigin.org/)

```
$.getJSON('http://whateverorigin.org/get?url=' + encodeURIComponent('http://google.com') + '&callback=?', function(data){
    alert(data.contents);
}); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-28T11:53:05.517

您可以在 iframe 中打开新窗口：

[http://www.w3schools.com/TAGS/tag_iframe.asp](http://www.w3schools.com/TAGS/tag_iframe.asp)

尽管请注意，如果您打开的站点来自不同的 URL，则 Javascript 访问会受到限制。这是为了防止跨站点脚本攻击：

[http://en.wikipedia.org/wiki/Cross-site_scripting](http://en.wikipedia.org/wiki/Cross-site_scripting)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-10-09T02:53:50.727

您可以尝试使用 fetch 它的回调

```
fetch('https://api.codetabs.com/v1/proxy?quest=google.com').then((response) => response.text()).then((text) => console.log(text)); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-28T11:53:11.943

您将使用 AJAX。这将对相关 URL 发出 Get 请求并返回响应 HTML。Jquery 使这非常容易，例如

```
$.get("test.php"); 
```

[http://docs.jquery.com/Ajax](http://docs.jquery.com/Ajax)

安德鲁

# iphone - 尝试使用 MPMoviePlayer 时出现链接器错误

> ID：597911
> 
> 赞同：2
> 
> 时间：2009-02-28T11:51:15.880
> 
> 标签：iphone, xcode, linker

在全新安装 Xcode 3.1.2 时，我正在尝试使用 iPhone MoviePlayer，如[http://developer.apple.com/iphone/library/codinghowtos/AudioAndVideo/index.html#INITIATE_VIDEO_PLAYBACK_IN_MY_CODE上的示例代码所示](http://developer.apple.com/iphone/library/codinghowtos/AudioAndVideo/index.html#INITIATE_VIDEO_PLAYBACK_IN_MY_CODE)

但是，当我尝试 build-n-go 时，Xcode 会报告以下链接器错误：

```
使用配置“Debug”构建项目“EOY”的目标“EOY”——（2 个错误）
        cd /Users/ed/dev/EOY
    setenv MACOSX_DEPLOYMENT_TARGET 10.5
    setenv PATH "/Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin:/Developer/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin"
    /Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin/gcc-4.0 -arch i386 -isysroot /Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator2.2.1.sdk -L/Users/ed/dev/ EOY/build/Debug-iphonesimulator -F/Users/ed/dev/EOY/build/Debug-iphonesimulator -filelist /Users/ed/dev/EOY/build/EOY.build/Debug-iphonesimulator/EOY.build/Objects- normal/i386/EOY.LinkFileList -mmacosx-version-min=10.5 -framework Foundation -framework UIKit -framework CoreGraphics -o /Users/ed/dev/EOY/build/Debug-iphonesimulator/EOY.app/EOY
未定义的符号：
  “.objc_class_name_MPMoviePlayerController”，引用自：
      MediaSupport.o 中的文字指针@__OBJC@__cls_refs@MPMoviePlayerController
  “_MPMoviePlayerPlaybackDidFinishNotification”，引用自：
      MediaSupport.o 中的 _MPMoviePlayerPlaybackDidFinishNotification$non_lazy_ptr
ld：未找到符号
collect2: ld 返回 1 个退出状态
          “.objc_class_name_MPMoviePlayerController”，引用自：
              MediaSupport.o 中的文字指针@__OBJC@__cls_refs@MPMoviePlayerController
          “_MPMoviePlayerPlaybackDidFinishNotification”，引用自：
              MediaSupport.o 中的 _MPMoviePlayerPlaybackDidFinishNotification$non_lazy_ptr
        ld：未找到符号
        collect2: ld 返回 1 个退出状态
构建失败（2 个错误）
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-10-08T06:27:28.417

没错。另一种方法是通过选择 TARGETS->Build Phases->Link Binary with Libraries 将 MediaPlayer 添加到项目目标（此处添加 MediaPlayer）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T20:14:15.720

是的，如果您的代码调用了一个框架，您必须将该框架添加到您的目标并链接到它。

确保框架是“相对于当前 SDK”（选择框架 > 获取信息 > 常规选项卡），以便在为设备构建时，它链接到设备的版本，而不是模拟器的版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T11:56:36.257

发现了问题。我还没有阅读所有文档，但其中有很多......

无论如何，我通过拖动目录来解决这个问题

`/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator2.2.1.sdk/System/Library/Frameworks/MediaPlayer.framework/`

进入 XCode 中的 Frameworks 文件夹，然后在导入对话框中单击确定。

# .net - 设置动态数据生成的数据网格的宽度（实体框架，在.net中）

> ID：597916
> 
> 赞同：0
> 
> 时间：2009-02-28T11:53:46.420
> 
> 标签：.net, entity-framework, width, dynamic-data

我正在使用动态数据从表中生成可编辑的数据网格，但是，我无法设置表/网格的宽度。

有人可以指点我一篇文章/或建议我怎么做吗？

提前致谢。

问候。库鲁。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T15:59:09.957

样式应用于 DynamicData 使用 CSS 生成的页面。默认情况下，List.aspx 页面模板上的 GridView 具有 CssClass="gridview"。该类在默认的 Site.css 文件中定义了很多样式。包括这个：

```
table.gridview { width: 100%; } 
```

您可以在此处更改宽度值以在使用此类的任何地方进行全局更改（可能不是您要查找的内容）。如果您只想更改一个实体/页面的宽度，您可能应该为该实体创建一个自定义页面。

脚步

1.  在 ~/DynamicData/CustomPages 目录中创建一个与实体的 EntitySet/Collection 同名的新文件夹（例如： ~/DynamicData/CustomPages/Employees 用于 Employee 实体）
2.  将 List.aspx 页面从 ~/DynamicData/PageTemplates 目录复制到您刚刚创建的新目录中。（可能需要调整 CodeBehind/aspx 文件的命名空间）
3.  使用自定义 CSS 类（或显式在 .aspx 文件中）更改页面上 GidView 的宽度。

更多信息：[http ://www.asp.net/learn/3.5-SP1/video-445.aspx](http://www.asp.net/learn/3.5-SP1/video-445.aspx)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-28T17:31:58.027

您可以使用动态数据控件名称的语法在 HTML 上添加 CSS，但这必须是用作控件 ID 的确切名称。

例如，如果您的名为 grid1 的动态数据网格位于名为 panel1 的面板内，则 ID 将为：“panel1_grid1”。CSS 将是：

```
TABLE#panel1_grid1
{
   width: 600px;
} 
```

可以在此处找到 Javascript 中的示例解决方法：

[http://forums.asp.net/t/1270184.aspx](http://forums.asp.net/t/1270184.aspx)

# xslt - XML到表，如何将上下文节点的位置（）获取到指定的祖先

> ID：597924
> 
> 赞同：1
> 
> 时间：2009-02-28T11:56:38.067
> 
> 标签：xslt

我有这样的xml：

```
<A1>
  <B1>
    <C1>
    <C2>
    <C3>
  </B1>
  <B2>
    <C4>
    <C5>
    <C6>
  </B2>
</A1>
<A2>
  <B3>
    <C7>
    <C8>
    <C9>
  </B3>
  <B4>
    <C10>
    <C11>
    <C12>
  </B4>
</A2> 
```

我需要将其转换为带有嵌套行的表：

```
<table border="yes">
<tr>
  <td>A1</td>
  <td>B1</td>
  <td>C1</td>
</tr>
<tr>
  <td></td>
  <td></td>
  <td>C2</td>
</tr>
<tr>
 <td></td>
 <td></td>
 <td>C3</td>
</tr>
<tr>
 <td></td>
 <td>B2</td>
 <td>C3</td>
</tr>
<tr>
 <td></td>
 <td></td>
 <td>C4</td>
</tr> 
```

A 和 B 仅在它们是新的时才出现（不在每一行中重复）；

我正在尝试使用 position()

```
<xsl:template match="c">
 <tr>
  <td>
   <xsl:if test="IT IS THE FIRST C IN A">
     <xsl:value-of select="ancestor::A"/>
   </xsl:if>
  </td>
  <td>
   <xsl:if test="position(1)">
   <xsl:value-of select="parent"/>
   </xsl:if>
  </td>
  <td>
    <xsl:value-of select="."/>
  </td>
 </tr>
</xsl:template> 
```

看来我们应该为祖先效仿 position() 。是否有任何数量的嵌套行的通用解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T13:00:16.073

您可能需要以下内容（如果我正确理解了您的问题）：

```
<xsl:template match="C">
 <tr>
  <td>
   <xsl:if test="generate-id(ancestor::A/descendant::C[1]) = generate-id(.)">
     <xsl:value-of select="ancestor::A"/>
   </xsl:if>
  </td>
  <td>
   <xsl:if test="not(previous-sibling::C)">
     <xsl:value-of select=".."/>
   </xsl:if>
  </td>
  <td>
    <xsl:value-of select="."/>
  </td>
 </tr>
</xsl:template>

<xsl:template match="/">
  <xsl:apply-templates select="descendant::C"/>
</xsl:template> 
```

编辑：您也可以使用

```
not(previous-sibling::C) and not(../previous-sibling::B) 
```

作为第一个测试（而不是使用`generate-id()`）。

# java - 如何在 Linux 中打开命令终端？

> ID：597927
> 
> 赞同：7
> 
> 时间：2009-02-28T11:56:58.363
> 
> 标签：java, linux, terminal

我想使用 Java 代码在 Linux 机器上打开终端（命令提示符）。我知道如何在 windows 中打开命令提示符。以下代码我在 windows 中使用过

```
String command= "cmd c/start cmd.exe"
Runtime rt = Runtime.getRuntime();
Process pr = rt.exec(command); 
```

我在 Linux 中需要同样的东西。

感谢您的回答。我也想运行一个 sh 脚本。

以下代码是否有效。

```
String command= "usr/bin/xterm myshell.sh";
Runtime rt = Runtime.getRuntime();
Process pr = rt.exec(command); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-28T12:22:14.963

在 Linux 中，有许多**终端仿真器**允许您与各种**shell**交互。每个 shell 基本上都是一个理解 Linux 命令的命令解释器（我想 GNU 和 Unix 命令更正确......）。终端仿真器为 shell 和其他一些使用命令提示符的工具提供了一个界面（窗口）。要打开终端窗口，您只需像这样修改命令字符串：-

```
import java.io.*;

class TerminalLauncher
{
    public static void main(String args[]) throws IOException
    {
        String command= "/usr/bin/xterm"; 
        Runtime rt = Runtime.getRuntime();  
        Process pr = rt.exec(command);
    }
} 
```

我所做的基本假设是您想要打开**xterm**，它几乎可以在任何系统上使用（当然安装了 X）。您可能想要打开另一个终端仿真器，例如 rxvt、eterm、aterm、gnome-terminal 或 konsole。命令字符串也可以修改为使用不同的 shell，如**zsh**。如果您选择的终端不存在，我建议您捕获异常并通过要求用户安装它来处理它。更好的解决方案是接受用户首选 shell 的命令行参数，或者使用用户可以更改的配置文件以使您的脚本打开他/她选择的 shell。

**注意**
1\. 正如其他人已经指出的那样，xterm（或您选择的任何其他终端）可能不在指定的路径（/usr/bin/...）中，甚至可能没有安装，因此您可能必须使用一些花哨的命令字符串（例如：在启动之前通过 grep 流水线查找以获取 xterm 的路径），这不是一个好主意。我认为最好的方法是让用户配置整个事情。

2.我得到了关于这个答案的评论（ypnos），建议我避免使用绝对路径，而是依赖于 PATH 环境变量中的命令。我不得不说我同意。在这种情况下，命令字符串应该是 -

```
String command = "xterm" 
```

一定要看评论，因为它也指出了使用 find 的问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T12:02:05.310

Linux 上没有单一的标准“终端”命令——可用的命令取决于存在的 GUI（即 KDE 或 Gnome 等）。

您*应该*能够依靠`xterm`在场，但在不是选择终端的现代 Linux 变体上：

```
String command= "/usr/bin/xterm";
Runtime rt = Runtime.getRuntime();
Process pr = rt.exec(command); 
```

当然，“xterm”可能不在那个特定的路径中......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-28T12:05:03.257

在 Gnome 下，它是`gnome-terminal`.

在 KDE 下，它是`konsole`.

或者您可以使用更通用的终端程序`xterm`。

您可能希望在大多数情况下使用选项，因此请查找您想要的手册页。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-09T16:33:12.480

**xterm**很可能在大多数基于 Linux 的操作系统上可用，如果存在，将在路径变量中找到。

因此，您将需要执行以下操作：

```
try {
    Runtime r = Runtime.getRuntime();
    String myScript = .....
    String[] cmdArray = {"xterm", "-e", myScript + " ; le_exec"};
    r.exec(cmdArray).waitFor();
} catch (InterruptedException ex){
    ex.printStackTrace();
} catch (IOException ex) {
    ex.printStackTrace();
} 
```

**-e**选项可用于调用脚本或其他程序，例如：javac。在这种情况下，您将进行如下分配：myScript = "javac"。

`" ; le_exec"`如果您不希望窗口在执行后立即关闭，您将需要该部分，否则将其丢弃。分号用于分隔命令，而 le_exec 只是一个等待用户按 Enter 键的简单脚本。

但是，如果您的脚本需要参数，那么您需要将 String myScript 替换为字符串数组。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T12:03:06.523

实际上没有“the”终端。你真正想要的是外壳。大多数 Linux 使用 BaSH 作为 shell，但为了安全起见，您应该将自己限制在 /bin/sh

编辑：嗯，我可能误解了这个问题。如果您想要一个交互式终端，您应该考虑使用为此提供组件的工具包。

Edit2：也许您的需求可以通过 VTE 来满足，它是一个用于嵌入终端的 GTK+ 组件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-28T12:55:56.443

我认为如果您的应用程序将打开用户的默认终端应用程序会很好。

不幸的是，似乎没有通用的方法来确定它。

在我看来，最可取的解决方案是（只要你能打开东西就停下来）：

*   尝试重新识别用户的桌面环境并确定它是默认的终端应用程序。[你可以在这里](http://lists.freedesktop.org/archives/xdg/2006-October/007019.html)读到一些关于它的东西。
*   检查环境变量 $TERM
*   询问用户她的偏好并将其保存在配置文件中。

找出用户的桌面环境和它的默认终端对于您的目的来说可能太复杂了，所以我会使用最后两个选项。您可以使用如下代码从 $TERM 运行应用程序：

```
String command = System.getenv().get("TERM");
Runtime rt = Runtime.getRuntime();
Process pr = rt.exec(command); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-01T01:20:25.763

因为你必须假设你对运行它的系统几乎一无所知，所以我想说最小的公分母是：

字符串命令 = "/bin/sh";

*   甚至更“有保证”——

字符串命令=“sh”；

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-28T12:32:35.580

我肯定会提供一种简单的方法来在可以轻松编辑的地方配置所需终端的路径。例如，可能在配置 XML 文件中。

不同的发行版会将其保存在不同的位置，因此最好检查您所针对的平台的每个发行版文档（并记录如何更改它）。

“/usr/bin/xterm”应该在大多数机器上，但我不一定会在农场上打赌。

# loops - 如何像这样在Windbg中编写一个循环？

> ID：597928
> 
> 赞同：5
> 
> 时间：2009-02-28T11:58:27.923
> 
> 标签：loops, windbg

我有一个名为 Foo 的类型，它有一个名为 length 的字段。我想在 Windbg 中编写一个循环语句，它将转储托管堆中所有类型为 Foo 的对象实例的长度字段？

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T04:21:24.783

这是一个我没有测试过的脚本，但可能对你有用。我基于 Tess 的脚本[为 ASP.net 转储堆上的所有会话变量。](http://blogs.msdn.com/tess/archive/2007/09/18/debugging-script-dumping-out-asp-net-session-contents.aspx)

```
r @$t0=0;

$$ Loop to get all foo's
.foreach (CurrentFoo {!dumpheap -type George.George2.Foo -short}){
    $$ Increment # of Foo's
    r @$t0 = @$t0+1

    .printf "Length:\t%d\n", poi(${CurrentFoo}+0xc);
}
.printf "Number of Foo's: %d\n\n\n\n\n\n\n\n\n", @$t0; 
```

解决这个问题的技巧是计算长度属性从主 Foo 引用偏移的字节数，并用正确的偏移字节数替换 printf 行中的“0xc”。

你应该能够通过在你的一个 Foo 上做一个 !dumpobject 并查看它的结构来做到这一点。

希望有帮助。

# c# - 从数据库中的数据生成 XML 的最佳方法是什么？

> ID：597941
> 
> 赞同：0
> 
> 时间：2009-02-28T12:05:44.473
> 
> 标签：c#, xml, sql-server-2005, performance

如果我有数千条分层记录要从数据库中获取并生成 xml，那么以良好的性能和更少的 CPU 利用率来实现它的最佳方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-28T12:53:35.420

您可以使用 SQL Server 2005 直接输出 XML

```
FOR XML 
```

> 查询的结果以 XML 文档的形式返回。必须与三个 RAW、AUTO 和 EXPLICIT 选项之一一起使用

```
RAW 
```

> 结果集中的每一行都是一个 XML 元素，具有一个通用标识符作为元素标记

```
AUTO 
```

> 结果以简单的嵌套 XML 树形式返回。将为 SELECT 子句中的每个表字段生成一个元素

```
EXPLICIT 
```

> 明确指定生成的 XML 树的形状。查询必须以特定方式编写，以便指定有关嵌套的附加信息

```
XMLDATA 
```

> 返回架构，但不将根元素添加到结果中

```
ELEMENTS 
```

> 指定将列作为子元素返回给表元素。如果未指定，它们将被映射为属性

使用同时生成内联 XSD 架构

```
XMLSCHEMA 
```

您可以使用处理记录中的空值

```
XSINIL 
```

您还可以以二进制形式返回数据。

您可能想在[MSDN 上查看 SQL Server 2005 中的 XML 支持](http://msdn.microsoft.com/en-us/library/ms345117.aspx)，了解 XQuery、XML 数据类型等技术。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T12:56:11.123

这取决于 - 如果您的应用程序和数据库服务器位于不同的机器上，那么您需要指定要减少负载的 CPU。如果您的数据库已经加载，您最好在应用程序服务器上进行 XML 转换，否则继续使用 SQL Server FOR XML 功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T12:32:50.337

Oracle 有这方面的工具，所以我猜 SQL-Server 也有，但你需要一个模式。就我个人而言，我使用我身边的一个 php 脚本，但对于需要定制的大东西是另一回事。

# ruby - 用于正则表达式匹配的 xpath 表达式？

> ID：597944
> 
> 赞同：12
> 
> 时间：2009-02-28T12:06:40.227
> 
> 标签：ruby, regex, xpath

我想在具有特定模式的 html 文档中搜索 div id。我想在正则表达式中匹配这个模式：

```
foo_([[:digit:]]{1.8}) 
```

使用 xpath。上述模式的 xpath 等效项是什么？

我被困住了`//div[@id="foo_`，然后呢？如果有人可以继续为其合法表达。

**编辑**

对不起，我想我必须详细说明。其实不是`foo_`，是`post_message_`

顺便说一句，我使用 mechanize/nokogiri ( ruby​​ )

这是片段：

```
html_doc = Nokogiri::HTML(open(myfile))
message_div =  html_doc.xpath('//div[substring(@id,13) = "post_message_" and substring-after(@id, "post_message_") => 0 and substring-after(@id, "post_message_") <= 99999999]') 
```

还是失败了。错误信息：

> 无法计算表达式“ `//div[substring(@id,13) = "post_message_" and substring-after(@id, "post_message_") => 0 and substring-after(@id, "post_message_") <= 99999999]`”（Nokogiri::XML::XPath::SyntaxError）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-28T12:21:22.610

这个怎么样（更新）：

XPath 1.0：

```
"//div[substring-before(@id, '_') = 'foo' 
       and substring-after(@id, '_') >= 0 
       and substring-after(@id, '_') <= 99999999]" 
```

编辑＃2：OP对问题进行了更改。以下更精简的 XPath 1.0 表达式对我有用：

```
"//div[substring(@id, 1, 13) = 'post_message_' 
       and substring(@id, 14) >= 0 
       and substring(@id, 14) <= 99999999]" 
```

XPath 2.0 有一个方便的[`matches()`功能](http://www.w3.org/TR/xpath-functions/#func-matches)：

```
"//div[matches(@id, '^foo_\d{1,8}$')]" 
```

除了更好的可移植性之外，我希望数值表达式（XPath 1.0 风格）比正则表达式测试执行得更好，尽管这只有在处理大型数据集时才会变得明显。

* * *

答案的原始版本：

```
"//div[substring-before(@id, '_') = 'foo' 
       and number(substring-after(@id, '_')) = substring-after(@id, '_') 
       and number(substring-after(@id, '_')) &gt;= 0 
       and number(substring-after(@id, '_')) &lt;= 99999999]" 
```

该`number()`函数的使用是不必要的，因为数学比较运算符隐式地将其参数强制转换为数字，任何非数字都将变为`NaN`并且大于/小于测试将失败。

我还删除了尖括号的编码，因为这是 XML 要求，而不是 XPath 要求。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-28T19:38:32.217

正如已经指出的那样，在[**XPath 2.0**](http://www.w3.org/TR/xslt20/)中，最好将其标准正则表达式功能与类似函数的[**`matches()`**](http://www.w3.org/TR/xpath-functions/#func-matches)函数一起使用。

**一种可能的[XPath 1.0](http://www.w3.org/TR/xpath)解决方案**：

```
//div[starts-with(@id, 'post_message_')
    and
      string-length(@id) = 21
    and
      translate(substring-after(@id, 'post_message_'), 
                '0123456789', 
                ''
                )
     =
      ''
      ] 
```

**请注意以下几点**：

1.  使用标准的 XPath 函数[**`starts-with()`**](http://www.w3.org/TR/xpath#function-starts-with)。

2.  使用标准的 XPath 函数[**`string-length()`**](http://www.w3.org/TR/xpath#function-string-length)。

3.  使用标准的 XPath 函数[**`substring-after()`**](http://www.w3.org/TR/xpath#function-substring-after)。

4.  使用标准的 XPath 函数**[`translate()`](http://www.w3.org/TR/xpath#function-translate)**。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-28T12:26:49.587

或者使用 xpath 函数匹配（字符串，模式）。

```
 <xsl:if test="matches(name(.),'foo_')"> 
```

不幸的是，它不是正则表达式，但它可能就足够了，除非你有其他不需要的 foo_ 标签，然后我猜你可以添加更多的“if”检查来剔除它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-02T17:03:28.193

[Nikkou](https://github.com/tombenner/nikkou)使这变得非常简单易读：

```
doc.search('div').attr_matches('id', /post_message_\d{1,8}/) 
```

# php - 如何将 ByteArray（来自 Flash）和一些表单数据发送到 php？

> ID：597947
> 
> 赞同：10
> 
> 时间：2009-02-28T12:14:40.583
> 
> 标签：php, flash, actionscript-3, input, jpeg

我在这里有一个用 Flash AS3 制作的素描板：http: [//henryjones.us/articles/using-the-as3-jpeg-encoder](http://henryjones.us/articles/using-the-as3-jpeg-encoder)

我想用 php 将 jpg 和一些来自 html 表单字段的数据发送到服务器。有没有办法在按下提交按钮时强制 Flash 电影传送图像文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-28T22:12:35.333

这有点棘手：您可以通过以下两种方式之一进行操作：

Arthem 在另一个帖子中发布了这个：

> 这对我有很大帮助： [http ://www.quietless.com/kitchen/upload-bitmapdata-snapshot-to-server-in-as3/](http://www.quietless.com/kitchen/upload-bitmapdata-snapshot-to-server-in-as3/)
> 
> 您需要修改 URLRequestWrapper 以在需要的地方插入字段名和文件名。这是我所做的：
> 
> bytes = '内容配置：表单数据；name="' + $fieldName + '"; 文件名="';
> 
> 它对标头进行了最多的格式化，因此服务器可以将其理解为文件上传。
> 
> 顺便说一句，如果您有 BitmapData，您可能需要先将其编码为 JPEG 或 PNG。

我通常使用这个解决方案：

我没有使用 imageshack API，但您可能想尝试使用 adobe 的 JPGEncoder 类 - 这是一个传递用户名和 JPG 字节数组的快速示例，它非常简单。

```
private function savePicToServer(bmpData:BitmapData):void
{
    var jpgEncoder:JPGEncoder = new JPGEncoder(85);
    var jpgStream:ByteArray = jpgEncoder.encode(bmpData);

    var loader:URLLoader = new URLLoader();
        configureListeners(loader);

    var header:URLRequestHeader = new URLRequestHeader("Content-type", "application/octet-stream");
    var request:URLRequest = new URLRequest(ModelLocator.BASE_URL + ModelLocator.UPLOAD_URL + "?user=" + ModelLocator.getInstance().username);
    request.requestHeaders.push(header);
    request.method = URLRequestMethod.POST;
    request.data = jpgStream;
    loader.load(request);
} 
```

请注意，变量作为查询字符串的一部分传递。你不能像几个人建议的那样使用 URLVariables，因为 URLVariables 将存储在请求的 data 属性中，我们已经使用它来传递 byteArray。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-07T02:55:42.930

我想将 Flash 的加密授权代码连同 JPG 图像一起发送到 PHP。在获取变量中发布它是不合适的，所以我以这种方式解决了它。大多数代码是阶段快照的实际收集，但只是其中的特定区域。与此处相关的部分是使用 writeMultiByte 将加密密码附加到 jpb 图像信息的末尾。然后，我使用获取变量 url 字符串发送此密码的长度，以便 PHP 知道显示很多内容以切断结尾。

```
var stage_snapshot:BitmapData = new BitmapData(600, 120);
var myRectangle:Rectangle = new Rectangle(0, 0, 600, 120);
var myMatrix:Matrix = new Matrix();
var translateMatrix:Matrix = new Matrix();
translateMatrix.translate(-101, -33);
myMatrix.concat(translateMatrix);
stage_snapshot.draw(stage,myMatrix,null,null,myRectangle);
trace ("creating JPGEncoder");
// Setup the JPGEncoder, run the algorithm on the BitmapData, and retrieve the ByteArray
var encoded_jpg:JPGEncoder = new JPGEncoder(100);
var jpg_binary:ByteArray = new ByteArray();
jpg_binary = encoded_jpg.encode(stage_snapshot);
var pw = cryptoSalt.encrypt("mysecretpassword");
**var pwLength = pw.length;
jpg_binary.writeMultiByte(pw,"us-ascii");**
trace ("stage snapshot taken");
var header:URLRequestHeader = new URLRequestHeader ("Content-type", "application/octet-stream");
var request:URLRequest = new URLRequest("savejpg.php?length1=" + pwLength);
request.requestHeaders.push(header);
request.method = URLRequestMethod.POST;
request.data = jpg_binary;
var loader:URLLoader = new URLLoader();
trace ("sending pic to php");
loader.load(request);
loader.addEventListener(Event.COMPLETE,finishSave); 
```

接收PHP：

```
$pwlength = $_GET['length1'];
$jpg = $GLOBALS["HTTP_RAW_POST_DATA"];
$pw = substr($jpg, - $pwlength);
$jpg = substr($jpg,0,strlen($jpg) - $pwlength);
$filename = 'uploads/test.jpg';
file_put_contents($filename, $jpg);
file_put_contents("uploads/pw.txt",$pw); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T12:20:56.043

您可以使用[HTTPService](http://livedocs.adobe.com/flex/3/langref/mx/rpc/http/mxml/HTTPService.html)发送数据。[这是](http://livedocs.adobe.com/flex/3/html/help.html?content=data_access_2.html)一个教程排序介绍。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T02:24:36.407

如果您不使用 flex，请尝试使用 URLLoader && URLrequest，将您的数据作为 POST 变量传递。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-03T15:46:30.157

你可以使用 AMFPHP 或 Zend AMF，我刚刚完成了一个这样的项目，我的产品允许用户更改产品配色方案，然后将 ByteArray 数据和其他 AS3 对象直接输出到 PHP，并插入 MySQL，你可以[看到我的项目](http://www.jhstudio.com.au/hoops/buy.php)和[AMFPHP](http://amfphp.sourceforge.net/)

所有PNG透明图片均由Flash生成，并发送到AMFPHP，PHP在服务器上生成PNG文件。

# windows - 从我的应用程序发送消息 Ctrl+Alt+Del

> ID：597959
> 
> 赞同：2
> 
> 时间：2009-02-28T12:26:11.727
> 
> 标签：windows, winapi, mfc

我想编写一个小实用程序`MFC`，将`Ctrl`++`Alt`消息`Del`发送到操作系统。任何人都可以帮助我如何实现这一目标？我试过：

```
::PostMessage(HWND_BROADCAST, WM_HOTKEY, 0, MAKELONG( MOD_CONTROL | MOD_ALT, VK_DELETE)); 
```

但这不起作用。

我想发送`Ctrl`++`Alt`而`Del`不是调用`TaskMgr.exe`. 此外，它适用于我的本地操作系统（Windows XP Service Pack 2）。基本上我想使用这个应用程序来锁定我的机器并安排一些操作以及锁定。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T12:51:24.817

这不是您可以模拟的击键。它被称为“安全注意序列”。**以下是从远程桌面**调用它的方法（XP+ 解决方案）：

```
include <shldisp.h>

IShellDispatch4 *pShell;

CoInitialize(NULL);

HRESULT hr = CoCreateInstance(CLSID_Shell, NULL, CLSCTX_INPROC_SERVER,
IID_IShellDispatch, (void**)&pShell);

if(SUCCEEDED(hr))
pShell->WindowsSecurity();

CoUninitialize(); 
```

从本地桌面调用它的唯一解决方案是使用 SASLib。这不是公开的。向 saslib@microsoft.com 写便条以请求它。

编辑：等等！你想锁定机器？只需调用[LockWorkStation()](http://msdn.microsoft.com/en-us/library/aa376875%28VS.85%29.aspx)！单击链接以获取有关头文件、lib 文件等所有其他详细信息的更多信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-28T12:34:59.817

由于 VNC 可以让您对远程系统执行此操作，因此它必须是可能的。如果我是你，我会通过[源代码搜索到 UltraVNC](http://sourceforge.net/project/showfiles.php?group_id=63887&package_id=60914)。然后我会在这里发布答案:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-28T12:37:26.427

您需要发送 control+alt+delete 还是只想调出任务管理器？

如果您只需要调出任务管理器，您只需运行 \Windows\System32\taskmgr.exe

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-06T16:27:02.867

我知道这是一个老问题，但我在这里发布我的解决方案，以防有人寻找解决方案到达这里。第 1 部分和第 2 部分文章解释了 Winlogon 如何注册 CAD 序列并提供有关如何使用它的代码示例。

*   [发送适用于 Windows XP 的 CAD 和解锁工作站 - 第 1 部分](http://www.remkoweijnen.nl/blog/2008/12/13/locking-a-workstation-part-1/)（免费）
*   [发送适用于 Windows XP 的 CAD 和解锁工作站 - 第 2 部分](http://www.remkoweijnen.nl/blog/2008/12/23/locking-a-workstation-part-2/)（免费）
*   [SasLibEx for Vista 和更高版本](http://www.simulatesas.com/blog/tag/saslibex/)（对不起，这不是免费的）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-28T12:36:37.910

只要求机器关闭或注销不是更容易吗？那个组合键真的不是个好主意吗？您可以发送这些消息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T14:08:21.877

你不能启动一个屏幕保护程序，它会为你处理锁定吗？我现在没有可用的 Windows 机器，但我记得可以像这样锁定工作站。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-07-09T05:33:40.067

调用[`SendSAS`](https://msdn.microsoft.com/en-us/library/windows/desktop/dd979761.aspx)函数来实现这一点。

# apache - 尝试显示没有 html 扩展名的 url 时出现奇怪的 apache 行为

> ID：597970
> 
> 赞同：3
> 
> 时间：2009-02-28T12:36:48.347
> 
> 标签：apache, mod-rewrite, seo

当您请求它时，我有一个可以轻松访问的网址：

```
    http://example.com/2005/01/example.html

    或者

    http://example.com/2005/01/example

```

（我实际上不知道为什么没有扩展它可以工作。相反，它应该返回通常的 404 错误。）

但是，当我尝试访问以下网址时：

```
    http://example.com/2005/01/example/
    （注意尾部斜杠）

```

我收到 404 Not found 错误，但请求的 url 打印为：

```
    http://example.com/2005/01/example.html/

```

因此，似乎“.html”部分是由 apache 自动添加的。

我的问题是：如何禁用此行为？我需要这样做，因为我想添加 mod_rewrite 规则来隐藏 html 扩展名，以便我可以访问该 url：

```
    http://example.com/2005/01/example/

```

我的 apache 在 Ubuntu 8.10 上是 2.2.9。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-28T12:42:20.517

[`MultiViews`](http://httpd.apache.org/docs/2.2/content-negotiation.html#multiviews)可能导致此行为。尝试禁用它：

```
Options -MultiViews 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T12:43:26.987

example.html 是位于目录路径 2005/01 中的实际文件吗？似乎 mod_rewrite 已经处于活动状态。如果您在服务器上使用博客或内容管理系统，那么它可能已经对您的网址进行了处理。

# asp.net - Web 开发 .NET 最佳实践

> ID：597971
> 
> 赞同：5
> 
> 时间：2009-02-28T12:37:13.400
> 
> 标签：asp.net

是否有其他示例项目，例如 Northwind Starters 工具包，向您展示 ASP.NET 开发架构中的“最佳实践”（层、单元测试、模拟数据、o/r 映射工具……）？

或者链接到好的和清晰的资源或文档？（MSDN 是一个很好的参考，但不如教程好）

*   是否有解决 Visual Studio2008 和/或 AdventureWorks 数据库的示例项目？

谢谢，列文卡登

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-28T12:40:21.940

查看此示例应用程序：[DinnerNow.Net](http://www.dinnernow.net/)

> DinnerNow 是一个虚构的市场，顾客可以在其中从当地餐馆订购食物，然后送到家中或办公室。此示例旨在演示如何使用几种新的 Microsoft 技术开发连接的应用程序。
> 
> 该演示使用了多种技术，包括：IIS7、ASP.NET Ajax Extensions、LINQ、Windows Communication Foundation、Windows Workflow Foundation、Windows Presentation Foundation、Windows PowerShell 和 .NET Compact Framework。

* * *

这里还有一个链接到多个使用 Asp.Net 和相关 Web 开发技术的[示例项目和入门工具包](http://www.asp.net/community/projects/)

* * *

这里还有一些链接可以让你阅读：

*   [生产 ASP.NET 应用程序的 10 大最佳实践](http://daptivate.com/archive/2008/02/12/top-10-best-practices-for-production-asp-net-applications.aspx)
*   [高性能应用程序的 ASP.NET 最佳实践](http://www.codeproject.com/KB/aspnet/ASPNET_Best_Practices.aspx)
*   [ASP.NET 最佳实践](http://www.thomscontent.com/posts/aspbest/aspbest.zip)（PPT 演示）
*   [ASP.NET 的最佳实践资源](http://www.odetocode.com/Resources/171.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T12:55:27.410

除了[Microsoft ASP.NET Starter Kits 之外](http://www.asp.net/community/projects/)，这里还有两个重要的开源 ASP.NET 应用程序可供检查：

[点网核弹](http://www.dotnetnuke.com/)

[博客引擎.NET](http://www.dotnetblogengine.net/)

这里还有 Microsoft 的 Patterns'n Practices 团队的[.NET 应用程序架构：设计应用程序和服务](http://msdn.microsoft.com/en-us/library/ms954595.aspx)。.NET 应用程序非常有用的指南。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T13:01:02.873

Microsoft 拥有大量示例项目、白皮书等，涵盖[各种主题](http://social.msdn.microsoft.com/Search/en-US/?query=Best%20Practices&ac=3)的最佳实践。其中许多都专注于[ASP.NET](http://social.msdn.microsoft.com/Search/en-US/?query=asp.net%20best%20practices&ac=1)，但您可能希望直接访问[MS 最佳实践中心](http://msdn.microsoft.com/en-us/practices/default.aspx)。他们还出版了一本涵盖该主题的书，但它已经很老了，我不会再推荐它了。

当然，您可能想直接访问源代码以获取编码最佳实践的*整体*方法，为此我推荐 Martin 和 Martin 的[C# 中的敏捷原则、模式和实践](https://rads.stackoverflow.com/amzn/click/com/0131857258)。我刚刚完成了 Robert Martin 的[Clean Code](https://rads.stackoverflow.com/amzn/click/com/0132350882)，虽然相当多的内容是显而易见的，但它写得很好，有大量的例子，并且帮助我在编码方法中变得更加“工匠”。

最后一件事是，我认为好的单元测试是任何开发人员的基本“最佳实践”之一。我推荐Hunt 和 Thomas 的[Pragmatic Unit Testing](https://rads.stackoverflow.com/amzn/click/com/0977616673)。

那应该让你去！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T14:08:33.117

我会推荐 Omar Al Zabir 的书[Building a Web 2.0 Portal with ASP.NET 3.5](https://rads.stackoverflow.com/amzn/click/com/0596510500)。[他关于 ASP.NET Ajax 和 .NET 3.5](http://msmvps.com/blogs/omar/)
的博客也很有价值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T14:09:40.010

如果您有一个现有的项目，那么您可以尝试[FxCop](http://www.microsoft.com/downloads/details.aspx?familyid=9AEAA970-F281-4FB0-ABA1-D59D7ED09772&displaylang=en)。它是静态代码分析器（这意味着您向他提供已编译的程序集），它会检查大量规则和 Microsoft 设计指南错误。

# css - 如何使用 css 制作边框布局？

> ID：597972
> 
> 赞同：10
> 
> 时间：2009-02-28T12:37:17.360
> 
> 标签：css, layout

我想为 web 应用程序创建一个边框布局，其中有一个固定大小的页眉、页脚、侧边栏，以及扩展以填充剩余空间的主要中心内容。

把它想象成你的浏览器，工具栏和状态栏的大小是固定的，侧边栏可以改变大小，但中心的网站会扩展以填充剩余的大小。

为了澄清，我想以像素为单位指定整个设计的高度，例如`600px`. 然后我希望侧边栏和中心`<div>`标签向下扩展以填充可用空间，即使它们的内容不足以填充空间。

在这里也可以使用网络浏览器的类比。即使您在浏览器中查看的页面不高于浏览器窗口，浏览器也不会调整大小。

有没有办法用 CSS 做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-06-20T18:55:50.270

```
div { border : 1px solid #d3d3e3 }

#north    { margin:0;  padding:1em;  }        
#south    { margin:0;  padding:1em;  }        
#east     { margin:0;  padding:1em;  width:6em; height:22em; float:left; margin-right:1.1em }        
#west     { margin:0;  padding:1em;  width:6em; height:22em; float:right; margin-left:1.1em }        
#center   { margin:0;  padding:1em;  padding-bottom:0em; }        
#center:after    { content:' '; clear:both; display:block; height:0; overflow:hidden }

<div id="north">North</div >
<div id="east">East</div>
<div id="west">West</div>
<div id="center">Center</div>
<div id="south">South</div> 
```

直播链接：http: [//jsfiddle.net/marrok/dGw6K/2/](http://jsfiddle.net/marrok/dGw6K/2/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2017-08-03T15:10:45.307

CSS 表格布局可以很好地处理这个问题。

```
.borderLayout {
  display: table;  
  width: 100%
}

.borderLayout .top {
    display: table-row;
}

.borderLayout .left {
    display: table-cell;
    vertical-align: middle;
    width: 10%;
  }

.borderLayout .center {
    display: table-cell;
    vertical-align: middle;
}

.borderLayout .right {
    display: table-cell;
    vertical-align: middle;
    width: 10%;
  }

.borderLayout .bottom {
    display: table-row; 
} 
```

[JSFiddle](https://jsfiddle.net/9sus36gd/1/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-22T01:50:59.537

尝试使用 flexbox，与 firefox 和 webkit 一起使用

[http://www.html5rocks.com/en/tutorials/flexbox/quick/](http://www.html5rocks.com/en/tutorials/flexbox/quick/)

当前的实现没有更新，但已经足够好了

但是你可以用表格来做这个（类似于弹性盒）

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T14:49:27.527

您提到的方法听起来像是页脚棒的工作-这已经很老了，但仍然很有魅力...[蓝衣人-footerStickAlt](http://www.themaninblue.com/writing/perspective/2005/08/29/)

[类似的问题在这里。](https://stackoverflow.com/questions/436165/css-floating-footer/448845#448845)

我敢肯定，如果您在该问题和其中链接的问题中使用相同的标准来运行搜索，您会想出更多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-02-18T01:56:01.413

我无法找到对我有用的这个问题的答案，所以我尝试了各种尝试。这是我设法使用 flexbox 组合起来的一个简单解决方案。

```
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style>

/*div { border : 1px solid #d3d3e3 }*/

html { height: 100%; }
body { height: 100%; }

.borderLayout {
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  width: 100%;
  height: 100%;
}

.borderLayout .top {
  width: 100%;
}

.borderLayout .middle {
  flex-grow: 1;
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  width: 100%;
}

.borderLayout .middle .side {
}

.borderLayout .middle .center {
  vertical-align: middle;
  flex-grow: 1;
}

.borderLayout .bottom {
    width: 100%;
}

</style>
</head>
<body>
    <div class="borderLayout" style="width: 100%; height: 100%; background-color: cyan;" >
        <div class="top" id="north" style="height: 150px; background-color: red;">North</div >
        <div class="middle" style="background-color: magenta;" >
            <div class="side borderLayout" id="west" style="width: 10%; background-color: yellow;">
                <div class="top" style="height: 100px; background-color: #FF8000;">West 1</div>
                <div class="middle">West 2</div>
                <div class="bottom"  style="height: 75px; background-color: #FF8080;">West 3</div>
            </div>
            <div class="center" id="center" style="background-color: white;">Center</div>
            <div class="side" id="east" style="width: 20%; background-color: green;">East</div>
        </div>
        <div class="bottom" id="south" style="height: 50px; background-color: blue;">South</div>
    </div>
</body>
</html> 
```

# sql-server - 在 SQL Server 中使用架构的最佳实践 (2008)

> ID：597976
> 
> 赞同：9
> 
> 时间：2009-02-28T12:41:13.110
> 
> 标签：sql-server, schema

我可以在 AdventureWorks 数据库中看到不同的模式用于对表进行分组。为什么要这样做（安全性，...？），我能找到最佳实践吗？

谢谢，列文卡登

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-01T14:52:02.240

作为商业智能的经理，我们依靠模式进行逻辑分组和管理安全性。以下是我们如何使用模式的一些案例：

**逻辑组织**

1.  我们有一个由 SSIS 包加载的通用数据库，仅用于在加载操作数据存储 (ODS) 之前暂存数据。在这个数据库中，除了模式之外，所有对象的结构（表名、列名、数据类型、可空性等）都与它们的原始源相同。我们使用模式来指示表的原始源系统。在极少数情况下，两个不同的数据库具有相同名称的表，并且架构允许我们继续在暂存数据库中使用原始名称。

2.  在我们的 BI 服务器上的每个数据库中，每个团队成员都有一个 test_username 模式。当我们在数据库中创建测试对象时，这可以很容易地跟踪谁创建了对象。由于每个人都知道谁做了什么，因此以后清除测试对象也变得容易得多。坦率地说，只要知道我们制作了它通常就足以知道它可以安全地删除，尤其是当我们不记得我们何时或为什么制作它时！

3.  在我们的数据控制器数据库中，我们依靠模式来区分报告、etl 和通用资源之间的不同类型的流程。

4.  在我们的星型模式数据仓库中，所有对象都分为维度模式和事实模式。

5.  当我们将数据推送到其他部门服务器时，我们使他们服务器上的所有 BI 对象都使用架构 bi。即使它不在我们的服务器上，这也使得了解双向加载和维护表变得非常容易。如果目标服务器不是 2008/2005 SQL Server 机器，那么我们在表前加上 bi_。

当它归结为它时，我们会在任何时候使用模式进行逻辑组织，我们会在对象上附加前缀或后缀以帮助在没有模式的情况下组织它。话虽如此，在某些情况下，我们不在 BI 服务器上使用模式。在我们的 WorkingDB 中，一切都是 dbo。我们的 WorkingDB 与 TempDB 一样用于创建临时表，但这些表是我们知道每次 ETL 流程运行时都会创建的临时表。WorkingDB 的特殊属性是我们从不备份数据库，并且所有使用数据库的 ETL 进程必须能够在没有表的情况下从头开始重新创建它们的对象。在这种情况下，我们觉得使用模式并没有增加任何组织价值，因为我们实际上并没有使用临时 ETL 过程之外的对象。

**安全**

1.  由于我们是一个 BI 小组，我们通常不会构建和支持我们自己的应用程序。我们几乎只使用其他人的应用程序，并将数据从他们的后端数据库带到我们的服务器。但是，我们确实有一个名为 bi_applications 的数据库，它是各种小型 CRUD 应用程序的后端。这些应用程序通常是我们提供给业务的数据输入表单，以便它们可以捕获我们原本必须在 BI 中维护的数据。这是一种将生产应用程序中的数据获取到 BI 中的方法，同时我们等待我们的低优先级应用程序增强功能在未来的开发列表中收集灰尘。每个应用程序都有一个单独的模式，用于更新基础表的应用程序帐户只能访问关联模式的对象。

2.  在少数情况下，我让高级用户可以直接访问我们的表或存储过程。我们依靠结合使用模式和角色来保护对象。我们授予架构权限，并将用户添加到角色中。这使我们能够轻松了解哪些对象由谁使用，而无需深入研究角色来弄清楚。

简而言之，当我们可能考虑将对象分离到它们自己的数据库中并且当我们期望 BI 之外的应用程序或用户访问我们的数据库时，我们出于安全目的使用模式。

尽管这些对于应用程序开发人员来说不是最佳业务实践，但我希望我的双向用例可以帮助您思考在业务结束时使用模式的一些方法。

# javascript - 如何发现 LocalConnection 连接名称？

> ID：597981
> 
> 赞同：0
> 
> 时间：2009-02-28T12:46:12.240
> 
> 标签：javascript, apache-flex, actionscript-3, air

我正在开发一个 Adob​​e Air 应用程序，它应该使用`LocalConnection`.

我以前从未使用`LocalConnection`过，但是根据我从在线参考中了解到的情况，我需要在发送方和接收方上指定相同的连接名称。

由于我无权访问此组件源代码，我如何才能知道我应该使用什么连接名称？

我确实可以访问一些使用相同 SWF 的 JavaScript 文件，但由于我没有使用 JavaScript 的经验，我不知道从哪里开始寻找。我能从那里弄清楚一些事情吗？

...还是我错过了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T16:53:27.260

无法从 ActionScript 查询它是什么`connectionName`。原因是它会打开无数的安全漏洞。如果您想与之交谈的 SWF 文档中提到了这一点，请查看。

至少可以说，整个 LocalConnection 业务虽然并不困难，但由于文档不稳定这一事实而变得复杂。而且非常非常混乱。在尝试做任何事情之前，您应该非常仔细地阅读它。我在那里烧伤了我的手指。

首先检查一下：

*   AIR 应用程序与 SWF 是否在不同的计算机上？否则你就不走运了。因为：

    > LocalConnection 对象只能在同一客户端计算机上运行的文件之间进行通信 [...]

*   SWF 是否有 LocalConnection 对象？如果没有，那你就不走运了。

*   您的 AIR 应用程序（假设它是被调用者，并调用 SWF 上的某些方法 X）也需要有一个 LocalConnection 对象。而且，它必须调用`connect()`才能连接到 SWF。
*   您最好的选择是采用[文档](http://livedocs.adobe.com/flex/3/langref/flash/net/LocalConnection.html)中提到的最后一种方法，（也是最通用的）即**不同的域具有不可预测的域名**。此外，要开始允许任何和每个域，请使用：`allowDomain(*);`
*   如果另一个 SWF 也是 AIR 应用程序，则您必须在连接名称前添加应用程序 ID。

现在，尽你最大的努力，让我们知道你在哪里卡住了。祝你好运！

# sql - 如何在查询中使用过程参数

> ID：597982
> 
> 赞同：0
> 
> 时间：2009-02-28T12:47:23.983
> 
> 标签：sql, oracle, merge, upsert

如何使用查询访问同一过程中的过程参数
，例如：请参阅此过程

```
procedure game(left in tab.left%type,right in tab.right%type,...)  
is  
--some local variables  
begin  
merge into tgt_table
using subquery --(here is what i need to use the parameters)  
on some condition  
when matched then  
update the tgt table  
when not matched then  
insert the table;  
end game; 
```

在上述过程和合并语句中，我需要一个查询，以便它使用参数值作为表引用，并根据给定的条件使用这些值更新或插入到表中。

请帮帮我。提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-02T11:49:58.910

如果您的参数定义要使用的表，您将需要使用动态 SQL - 例如：

```
procedure game(left in tab.left%type,right in tab.right%type,...)  
is  
    --some local variables  
    l_sql long;
begin  
    l_sql := 'merge into tgt_table'
             || ' using ' || left
             || ' on some condition'  
             || ' when matched then'  
             || ' update ' || right
             || ' when not matched then'  
             || ' insert the table';  
    execute immediate l_sql;
end game; 
```

但是，您还有很多工作要做，因为条件、更新和插入子句都需要根据正在使用的表进行更改。我不相信这种采购实际上会特别有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T13:01:34.073

请阅读[http://download.oracle.com/docs/cd/B14117_01/appdev.101/b10807/06_ora.htm#sthref777](http://download.oracle.com/docs/cd/B14117_01/appdev.101/b10807/06_ora.htm#sthref777)

# objective-c - 文档和 Nib 文件：Apple 所说的“文档”是什么意思？

> ID：597998
> 
> 赞同：2
> 
> 时间：2009-02-28T13:01:46.663
> 
> 标签：objective-c, cocoa

我不明白“文档”一词是如何在 Objective-C 和可可中使用的。当我构建一个应用程序时，为什么我有一个“文档”？这对我来说毫无意义。我可以有一个像图像编辑器这样的应用程序，其中我可以同时打开 100 张图像。那么每个图像都是一个文档并且有自己的 Nib 文件？有人可以用人类可以理解的方式解释这个术语吗？我认为最好有很多例子。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-28T13:27:58.333

从我[古老但仍然主要相关的 Cocoa NSFAQ](http://www.oofile.com.au/adsother/CocoaDevFAQ.html#A18)（不那么常见问题解答）：

**Q18** 为什么我想要一个 Document 子类？

**A18** 因为您有一个中央数据模型，它需要一个对象来管理它。

更详细地说，不要总是认为 Document==File。大多数 Mac 应用程序中的概念文档可能确实映射到磁盘上的单个文件，但也通常是中心对象（经典 MVC 设计中的模型）。

如果您使用的是数据库，则 Document 可能会管理数据库连接，甚至最终保存为保持该连接的文件。

对于您的照片库，文档可能是单一的，仅包含一些设置，或者您可能有多个文档对应于不同的布局和过滤器来确定哪些照片是可见的。

如果您想这样做，没有理由不能打开多个文档甚至数百个文档 - 文档是一种向视图提供数据的方式，如果您愿意，您可以拥有数百个实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T13:06:32.563

基于文档，就 Xcode 模板而言，本质上意味着 NSDocument 子类。NSDocument 和 NSDocumentController 提供了一个抽象，可以更简单地支持多个文档。

你是对的，你可以在没有 NSDocument 的情况下手动编码。但是，NSDocument 确实让它变得更容易一些。****************************