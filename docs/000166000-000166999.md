# StackOverflow 问答 000166000-000166999

# c++ - 用于缓存和内存总线性能的工具或代码

> ID：166004
> 
> 赞同：3
> 
> 时间：2008-10-03T07:33:20.503
> 
> 标签：c++, visual-studio, profiler

我在使用 C++/VistualStudio/WindowsXP 编写的软件的多核 (8+) 架构上面临性能问题。

突然我意识到我不知道我的 L1 和 L2 缓存以及 CPU->to->内存带宽的性能。

我已经测试了几种工具（包括 VTune、Glowcode 等），但是在多核架构中的负载测试时它们都失败了（这正是我需要它们的原因！）。

您能否推荐任何其他在绘制图表方面不太花哨但至少可以给我一些关于我的缓存/内存性能的指示，或者可以建议代码片段来手动检测我的应用程序的工具？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T17:00:31.653

您确定这是您的性能问题的根源吗？如果没有，最好先看看其他的东西。

这里有一篇关于多线程编程的好文章，以及它的各种隐藏[问题](http://www.gotw.ca/publications/concurrency-ddj.htm)。也许这会有所帮助？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-21T20:04:19.377

您可以使用硬件计数器来测量 L1 和 L2 未命中率；但是，我不太确定在 Windows 平台上使用哪个库包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T17:10:48.747

也许[Memtest86+](http://www.memtest.org/)是您正在寻找的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T17:32:17.003

我相信 EVEREST 测试套件会检查您的内存/cpu/缓存性能。你可能想看看这个网站。[Lavalys 的珠穆朗玛峰页面](http://www.lavalys.com/products/eapm.php?ps=UE&lang=en)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-29T12:28:22.077

你试过[缓存研磨](http://wwwcdf.pd.infn.it/valgrind/cg_main.html)吗？当然，它是一个模拟器，但它仍然可以让你捕捉到大部分真正的问题。

# java - Need assistance with accelerating a GOval object (making a Breakout game)

> ID：166015
> 
> 赞同：0
> 
> 时间：2008-10-03T07:40:11.577
> 
> 标签：java

Hey peoples, I've been studying Java for a couple of weeks, and have decided to produce my own version of Breakout. The game is working fine, apart from the method which is supposed to modify the ball (GOval) speed based on the speed of the paddle (GRect). Anyway, this is the method:

```
private double paddleVelocity(){
            double paddleTracker=(paddleXTracker+paddleXTrackerTwo+paddleXTrackerThree)/3; //get the average x-coordinate for the paddle
            if(loopCounter>3){ //if the game has been through the loop more than three times (to ensure three x-coordinates have been stored)
                paddleVelocity=(paddle.getX()-paddleTracker)/50; //set paddleVelocity to the current paddle x-coordinate minus the average of the previous three paddle x-coordinates (which therefore finds the velocity and direction)
            }else{
                paddleVelocity=(paddle.getX()-paddleXTracker)/50; //takes the previous paddle x-coordinate and subtracts it from the current x-coordinate (which therefore finds the velocity and direction)
            }

            return (paddleVelocity);
        } 
```

And this is the method that calls it:

```
 private void detectCollisionPaddle(){;
                double ballY = ball.getY()+(BALL_RADIUS*2);
                if(paddle.getY()<=ballY && ball.getX()+BALL_RADIUS>=paddle.getX() && ball.getX()+BALL_RADIUS/2<=(paddle.getX()+PADDLE_WIDTH)){ //a mess of code which ensures the ball is within the bounds of the paddle
                    yVel=-yVel; //make the ball bounce off
                    bounceClip.play(); //play the bounce clip
                    xVel=xVel+paddleVelocity(); //increase the velocity of the ball in the direction and speed of the paddle
} } 
```

The instance variables include:

```
private int loopCounter; //how many loops of the game code have been executed
private double paddleVelocity; //velocity of the paddle
private double paddleXTracker = 1; //value of the x-coordinate of the paddle one loop previous
private double paddleXTrackerTwo; //value of the x-coordinate of the paddle two loops previous
private double paddleXTrackerThree; //value of the x-coordinate of the paddle three loops previous
private double yVel = -1; //y velocity of the ball
private double xVel = 1; //x velocity of the ball 
```

Basically I want paddleVelocity to grab three consecutive x-coordinates of the paddle, and compare them to the current position (paddle.getX()). This allows me to determine the speed and direction that the user has moved the paddle. I then return the result (paddleVelocity) which is supposed to add to the current velocity of the ball (xVel). However, this doesn't seem to function properly. When the call for paddleVelocity() is removed, the code works perfectly (albeit without acceleration). So I know there's an issue with the paddleVelocity method. It seems to be biased to the right side. Perhaps you guys can help, afterall, this is my first serious attempt at programming. Here's the game atm: [http://cyb3rglitch.com/games/Glitchout_0.1/](http://cyb3rglitch.com/games/Glitchout_0.1/)

Yes, the bricks don't break yet. :P Cheers!

EDIT: To make it easier, here's all the code in its messy glory:

```
/*
 * File: Breakout.java
 * -------------------
 * Name: Vito Cassisi
 */

import acm.graphics.*;
import acm.program.*;
import acm.util.*;

import java.applet.*;
import java.awt.*;
import java.awt.event.*;

public class Breakout extends GraphicsProgram {

/** Width and height of application window in pixels */
    public static final int APPLICATION_WIDTH = 400;
    public static final int APPLICATION_HEIGHT = 600;

/** Dimensions of game board (usually the same) */
    private static final int WIDTH = APPLICATION_WIDTH;
    private static final int HEIGHT = APPLICATION_HEIGHT;

/** Dimensions of the paddle */
    private static final int PADDLE_WIDTH = 60;
    private static final int PADDLE_HEIGHT = 10;

/** Offset of the paddle up from the bottom */
    private static final int PADDLE_Y_OFFSET = 30;

/** Number of bricks per row */
    private static final int NBRICKS_PER_ROW = 10;

/** Number of rows of bricks */
    private static final int NBRICK_ROWS = 10;

/** Separation between bricks */
    private static final int BRICK_SEP = 4;

/** Width of a brick */
    private static final int BRICK_WIDTH =
      (WIDTH - (NBRICKS_PER_ROW - 1) * BRICK_SEP) / NBRICKS_PER_ROW;

/** Height of a brick */
    private static final int BRICK_HEIGHT = 8;

/** Radius of the ball in pixels */
    private static final int BALL_RADIUS = 10;

/**Ball speed in milliseonds*/
    private static final int DELAY = 10;

/** Offset of the top brick row from the top */
    private static final int BRICK_Y_OFFSET = 70;

/** Number of turns */
    private static final int NTURNS = 3;

    private static final int COUNTDOWN = 200;

    private GOval ball;
    private GRect paddle;
    private GRect block;
    private GLabel life;
    private GLabel countDown;
    private GObject getObject;
    AudioClip bounceClip = MediaTools.loadAudioClip("bounce.au");

/* Method: run() */
/** Runs the Breakout program. */
    public void run() {
        drawBlocks();
        drawPaddle();
        drawBall();
        drawLife();
        addMouseListeners();

        while(!lose) {
            detectCollisionWall();
            detectCollisionBlock();
            detectCollisionPaddle();
            decelerate();
            assignPaddleTrackers();
            pause(DELAY);
            loopCounter++;
        }
        GLabel youLose = new GLabel("You lose!",APPLICATION_WIDTH/2,APPLICATION_HEIGHT/2);
        youLose.setLocation((getWidth()-youLose.getWidth())/2, (getHeight()-youLose.getAscent())/2);
        add(youLose);
    }   
        private void drawBlocks(){
        /**Draw as many rows as defined in the constant 'NBRICKS_PER_ROW'*/ 
            for(int i = 0;i<NBRICK_ROWS;i++){
                blockX=(APPLICATION_WIDTH-((BRICK_WIDTH+BRICK_SEP)*NBRICKS_PER_ROW))/2; //center the blocks horizontally
                drawRow(); //draw the row
                blockY+=BRICK_HEIGHT+BRICK_SEP; //move the row down
            }
        }

        private void drawRow(){
        /**Draw as many bricks as defined in the constant 'NBRICKS_PER_ROW'*/   
            for(int i = 0;i<NBRICKS_PER_ROW;i++){
                block = new GRect(blockX,blockY,BRICK_WIDTH,BRICK_HEIGHT); //initialise the blocks
                add(block); //draw the blocks
                blockX+=BRICK_WIDTH+BRICK_SEP; //move x co-ordinate across
            }
        }

        private void drawPaddle(){
            paddle = new GRect((APPLICATION_WIDTH-PADDLE_WIDTH)/2,(APPLICATION_HEIGHT-PADDLE_Y_OFFSET-PADDLE_HEIGHT),PADDLE_WIDTH, PADDLE_HEIGHT);
            add(paddle);
        }

        private void drawBall(){
            double diameter = BALL_RADIUS*2;
            ball = new GOval((APPLICATION_WIDTH-diameter)/2,APPLICATION_HEIGHT-PADDLE_Y_OFFSET-PADDLE_HEIGHT*2-diameter,diameter,diameter);
            add(ball);
        }

        private void moveBall(){

            ball.move(xVel, yVel);
        }

        private void detectCollisionWall(){
            if(ball.getY()+(BALL_RADIUS*2)<getHeight() && ball.getY()>0 && ball.getX()+(BALL_RADIUS*2)<getWidth() && ball.getX()>0){
                moveBall();
            }
            if(ball.getY()+(BALL_RADIUS*2)>getHeight()){
                yVel=-yVel;
                turnsLeft--;
                testForLose();
                bounceClip.play();
            }
            if(ball.getY()<0){
                yVel=-yVel;
                bounceClip.play();
            }
            if(ball.getX()+(BALL_RADIUS*2)>=getWidth()){
                xVel=-xVel;
                bounceClip.play();
            }
            if(ball.getX()<=0){
                xVel=-xVel;
                bounceClip.play();
            }
            moveBall();
        }

        private void testForLose(){
            if(turnsLeft==0){
                lose=true;
                life.setLabel("You have "+turnsLeft+" lives!");
                return;
            }
            life.setLabel("You have "+turnsLeft+" lives!");
            remove(ball);
            drawBall();
            xVel=1;
            yVel=-1;
            drawCountDown();
        }

        private void drawCountDown(){
            GLabel countDown = new GLabel("",APPLICATION_WIDTH/2,APPLICATION_HEIGHT/2);
            for(int i=3;i>0;i--){
                countDown.setLabel("Respawn in: "+i);
                countDown.setLocation((getWidth()-countDown.getWidth())/2, (getHeight()-countDown.getAscent())/2);
                add(countDown);
                pause(COUNTDOWN);
            }
            countDown.setLabel("Go");
            countDown.setLocation((getWidth()-countDown.getWidth())/2, (getHeight()-countDown.getAscent())/2);
            pause(COUNTDOWN);
            remove(countDown);
        }

        private void drawLife(){
            life = new GLabel("You have "+turnsLeft+" lives!", APPLICATION_WIDTH/2,15);
            life.setLocation((getWidth()-life.getWidth())/2, 20);
            add(life);
        }

        private void detectCollisionBlock(){
            GObject collisionObject = detectObject(ball, BALL_RADIUS*2, BALL_RADIUS*2);
            if(collisionObject==block){
                remove(collisionObject);
                yVel=-yVel;
            }
        }

        private double paddleVelocity(){
            double paddleTracker=(paddleXTracker+paddleXTrackerTwo+paddleXTrackerThree)/3;
            if(loopCounter>3){
                paddleVelocity=(paddle.getX()-paddleTracker)/50;
                //paddleXTracker=paddle.getX();
            }else{
                paddleVelocity=(paddle.getX()-paddleXTracker)/50;
            }

            return (paddleVelocity);
        }

        private void detectCollisionPaddle(){;
            double ballY = ball.getY()+(BALL_RADIUS*2);
            //double ballX = ball.getX()+(BALL_RADIUS*2);
            /*if(ball.getY()+BALL_RADIUS*2>=paddle.getY() && ball.getX()+BALL_RADIUS*2>=paddle.getX() && ball.getX()<=paddle.getX()){
                ball.setLocation(ball.getX(),paddle.getY()-BALL_RADIUS*2-1);
            }*/
            if(paddle.getY()<=ballY && ball.getX()+BALL_RADIUS>=paddle.getX() && ball.getX()+BALL_RADIUS/2<=(paddle.getX()+PADDLE_WIDTH)){
                yVel=-yVel;
                bounceClip.play();
                xVel=xVel+paddleVelocity();
            /*
            int x = 4;
            int center = PADDLE_WIDTH/2;
            double parts=center/x;
            int location=0;
            if(ball.getX()+BALL_RADIUS*2>paddle.getX()&& ball.getX()<paddle.getX()+PADDLE_WIDTH){
            for(int i = 0;i<x;i++){
                if (ball.getX()<center+paddle.getX() && ball.getX()>(parts*i)+paddle.getX()){

                }else{
                    location = i;
                    break;  
                }

            }
            xVel=x/location;
            }
            }
            //

            if(ball.getX()+BALL_RADIUS<paddle.getX()+PADDLE_WIDTH/4){
                if(xVel!=1){
                    if(xVel<0)
                    {
                        xVel=xVel-1;
                    }else{
                        xVel=-xVel-1;
                    }
                }
            }
            if (ball.getX()>paddle.getX()+(PADDLE_WIDTH-PADDLE_WIDTH/4)){
                if(xVel>0){
                    xVel=xVel+1;
                }else{
                    xVel=-xVel+1;
                }
            }
            if (ball.getX()<paddle.getX()+(PADDLE_WIDTH-PADDLE_WIDTH/4) && ball.getX()+BALL_RADIUS>paddle.getX()+PADDLE_WIDTH/4){
                if(xVel>1){
                    xVel=xVel-1;
                }
                if(xVel<-1){
                    xVel=xVel+1;
                }
            }
            */
            }

        }

        public void mouseMoved(MouseEvent e){
            paddle.move((e.getX()-paddle.getX()-PADDLE_WIDTH/2),0);
        }

        /*Passes in an object to be checked, i.e. the ball, and asks for it's height and width. It returns the object if one is present, otherwise it retuns null.**/
        private GObject detectObject(GObject object, int width, int height){
            double right = object.getX()+width;
            double bottom = object.getY()+height;
            getObject = getElementAt(object.getX(),object.getY());

            if(getObject==null){
                getObject = getElementAt(right,object.getY());
            }else{
                return getObject;
            }

            if(getObject==null){
                getObject = getElementAt(object.getX(),bottom);
            }else{
                return getObject;
            }

            if(getObject==null){
                getObject = getElementAt(right,bottom);
            }else{
                return getObject;
            }

            if(getObject==null){
            return null;
            }else{
                return getObject;
            }

        }

        private void decelerate(){
            if(xVel<-1){
                xVel=xVel+0.01;
            }
            if(xVel>1){
                xVel=xVel-0.01;
            }
        }

        private void assignPaddleTrackers(){
            paddleXTrackerThree=paddleXTrackerTwo;
            paddleXTrackerTwo=paddleXTrackerThree;
            paddleXTracker=paddle.getX();
        }

    private int loopCounter;
    private double paddleVelocity;
    private double paddleXTracker = 1;
    private double paddleXTrackerTwo;
    private double paddleXTrackerThree;
    private double yVel = -1;
    private double xVel = 1;
    private int turnsLeft = NTURNS;
    private int blockY = BRICK_Y_OFFSET;
    private int blockX = 0;
    private static boolean lose = false;
    private RandomGenerator rgen = RandomGenerator.getInstance();

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T07:47:45.180

I can't see where you are setting `paddleXTracker` and friends when paddle velocity is updated. So here are some possible fixes:

1.  You are not updating the past values continuously, only once at the start.
2.  you never updated the `paddleXTrackerTwo` and `paddleXTrackerThree` values so the average is to the left (due to divide by 3), if origin is on the left (likely).

Both of these would account for the right bias you are seeing.

Further, you appear to be doing an adhoc version of [moving average](http://en.wikipedia.org/wiki/Moving_average). There are other variations which maybe more suited to what you are trying to do.

## edit

Now that your full code is available, I can't see what is wrong. I can only suggest you employ debugging techniques, such as printing out the `paddle*Tracker*` while the game is running to see what values are coming out, and whether or not they are as expected.

## edit 2

Just to make this answer an answer, as per our OOB discussion, your assign tracker function is wrong, and is not updating `paddleXTrackerTwo` with `paddleXTracker`.

# security - ASP Classic 有自己的安全框架还是使用 IIS 的安全框架？

> ID：166023
> 
> 赞同：1
> 
> 时间：2008-10-03T07:47:19.503
> 
> 标签：security, asp-classic

我支持一个仍然使用混合 ASP.NET 和[ASP Classic](http://en.wikipedia.org/wiki/Active_Server_Pages)的站点。用户在访问某些 ASP Classic 页面时收到“您未获得授权”错误页面。我检查了她的活动目录帐户，她可以访问所述站点中的其他页面。它可以归因于经典的 ASP 或 IIS 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T10:41:37.323

ASP Classic 是一个非常简单的框架。我无法想象它有自己的安全框架（我假设这意味着用户身份验证等），除非它被编程到应用程序本身中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T13:36:57.897

ASP 完全依赖于底层 IIS 和操作系统的安全性。它没有自己的。在 ASP`Request.ServerVariables("AUTH_USER")`中，当连接通过身份验证时，您可以访问等，但这是由 IIS 完成的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T13:51:45.263

您可以通过在 IIS 中进行一些更改来强制 ASP 使用 ASP.NET 身份验证，以便 ASP 文件使用 aspnet_isapi.dll 就像 asp.net 页面一样。

Scott Guthrie 发表了一篇关于此[提示/技巧的文章：Integrating ASP.NET Security with Classic ASP and Non-ASP.NET URLs](http://weblogs.asp.net/scottgu/archive/2007/03/04/tip-trick-integrating-asp-net-security-with-classic-asp-and-non-asp-net-urls.aspx)

一旦你做出这个改变，经典的 asp 页面就可以像使用标准 asp.net 安全功能的 asp.net 页面一样受到保护。

# clickonce - 查找正在运行的 clickonce 部署的单实例应用程序？

> ID：166025
> 
> 赞同：4
> 
> 时间：2008-10-03T07:50:04.003
> 
> 标签：clickonce, single-instance

我目前正面临我的单实例 clickonce 部署应用程序的问题，也许有人对此有一个好主意。

我的应用程序由一个 Web 应用程序调用，该应用程序将参数传递给这个 exe。现在的问题是，如果应用程序已经在运行，则需要相当长的时间，直到新实例启动，参数移交给正在运行的实例，然后关闭（打开 URL，检查更新，.. .)。

那么有没有办法检测到有一个正在运行的实例，而不引入一个新的小应用程序，这个检测呢？

目标是减少第二次，第三次，...调用需要将参数获取到正在运行的实例的时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T09:15:26.687

当您设置部署设置时，您可以告诉 VS 只让应用程序每隔 x 时间更新一次（每天一次、每周一次等）。您还可以告诉它启动应用程序并在后台更新。我认为这两种方法都可以自行解决您的问题。

这些设置位于“发布”选项卡上的“项目设置”中。单击“安装模式和设置”部分中的“更新”按钮并设置适当的设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-06T06:52:26.543

不，它不是后台应用程序。Web 应用程序和 Winforms 应用程序正在使用类似的数据库子集。我尽量不详细说明，因为这对问题并不重要，但要更清楚：用户正在使用 Web 应用程序为我们的业务案例创建元数据，而使用 Winforms 应用程序的用户正在做他们的具体工作。

因此，通过此链接，可以创建一组新的元数据，并在“工作应用程序”中交叉检查结果。

所以有2个具体的场景：

1.  Winforms-App 未在客户端上运行：当用户单击单击一次的开始菜单条目或 Web 应用程序中的链接时，一切都应该按照现在的方式完成（通过更新检查，... ）。所以这个场景对我有用。

2.  Winforms-App 正在客户端上运行：正在运行的实例应尽快显示新的元数据集，无需任何单击一次更新检查或其他任何操作。在这种情况下，我试图绕过“单击一次启动应用程序”对话框弹出，新应用程序实例正在启动，新实例正在将参数传递给正在运行的实例并自行关闭。所以我寻找一个解决方案，我实现了这一点，而不是创建一个新的小 exe，它被 web 应用程序所知道，它可以完成工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T04:14:55.817

这似乎是 Click-Once 技术的一个有趣用途。我的印象是 Click-Once 非常适合将*客户端* 应用程序分发到企业内的*多台*最终用户机器。

在此处描述的情况下，这是一个由 Web 服务器应用程序使用的后台应用程序——我希望它只安装在企业中的几台服务器上。

我的问题是：

*   如果 Web 应用程序可以检测到参数，您的 Web 应用程序将如何将参数传递给正在运行的实例？（例如 .NET 远程处理？）
*   您通过 Click-Once（而不是 Windows 安装程序）分发此后台应用程序的原因是什么？

了解这一点可能有助于解决您的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T10:04:33.750

我想我没有说清楚，我想要实现什么。

我想要做的是，如果有一个实例正在运行，直接访问这个实例，而不启动 clickonce url。我正在寻找一个解决方案，我不必编写一个小程序（也必须部署它，...），它检查应用程序是否正在运行，如果是，则交出参数，如果不启动点击一次网址。

后台更新并不是一个真正的选择，因为这个“连接到应用程序”屏幕仍然存在并且会消耗时间，而且每个用户每次都在运行最新版本的应用程序是必须的。

# sql-server - 处理大型数据库

> ID：166028
> 
> 赞同：13
> 
> 时间：2008-10-03T07:51:25.467
> 
> 标签：sql-server, database, performance, database-design, query-optimization

我在一个网络项目（asp.net）中工作了大约六个月。最终产品即将上线。该项目使用 SQL Server 作为数据库。我们已经对一些大量数据进行了性能测试，结果表明当数据变得太大时性能会下降，比如 200 万行（超时问题、延迟响应等）。起初我们使用完全规范化的数据库，但现在由于性能问题（以减少连接），我们对其进行了部分规范化。首先，这是正确的决定吗？另外，当数据量变得非常大时，可能的解决方案是什么，没有。未来客户增加？

我想进一步补充：

*   200 万行是实体表，解决关系的表具有更大的行。
*   当 data + no 时性能下降。的用户增加。
*   在识别出大量使用的查询后进行非规范化。
*   我们还使用了大量的 xml 列和 xquery。这可能是原因吗？
*   有点跑题了，我项目中的一些人说动态 sql 查询比存储过程方法更快。他们已经进行了某种性能测试来证明他们的观点。我认为恰恰相反。一些频繁使用的查询是动态创建的，而其他大多数查询都封装在存储过程中。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-03T09:25:49.850

在事物的方案中，几百万行并不是一个特别大的数据库。

假设我们谈论的是 OLTP 数据库，那么在没有首先确定瓶颈的根本原因的情况下进行非规范化是一个**非常非常糟糕的主意**。

您需要做的第一件事是在一个有代表性的时间段内分析您的查询工作负载，以确定大部分工作在哪里完成（例如，如果您使用的是 SQL Server，则使用 SQL Profiler）。查看查询执行的逻辑读取次数乘以执行的次数。一旦您确定了前十个性能最差的查询，您需要详细检查查询执行计划。

我将在这里四处走动（因为通常是这种情况），但如果您的问题不是，我会感到惊讶

1.  昂贵查询的“正确”覆盖索引缺失
2.  配置不当或在指定的磁盘子系统下

此[SO 答案](https://stackoverflow.com/questions/257906/ms-sql-server-2008-how-can-i-log-and-find-the-most-expensive-queries#257944)描述了如何分析以查找工作负载中性能最差的查询。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-03T11:08:27.177

> 正如那句老话所说：“正常化，直到它受伤，非正常化，直到它起作用”。

我喜欢这个！这通常是不能再接受的事情。我可以想象，`DBASEIII`有时您一次不能打开超过 4 个表（除非更改一些 AUTOEXEC.BAT 参数并重新启动计算机，啊啊！...），对非规范化有一些兴趣。

但现在我看到这种解决方案类似于等待海啸给草坪浇水的园丁。请使用可用的喷壶（SQL 分析器）。

并且不要忘记，每次您对数据库的一部分进行非规范化时，您进一步适应它的能力就会降低，因为代码中的错误风险会增加，从而使整个系统越来越不可持续。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-03T09:07:07.280

200 万行通常不是一个非常大的数据库，具体取决于您存储的信息类型。通常，当性能下降时，您应该验证您的索引策略。SQL Server 数据库引擎优化顾问可能会提供帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-03T09:11:23.387

可能有一百万个原因；使用 SQL Profiler 和 Query 分析器来确定您的查询*为什么*会变慢，然后再走“模式更改”之路。您需要做的就是创建几个索引并安排“更新统计信息”……但正如我所说，Profiler 和 Query Analyzer 是找出正在发生的事情的最佳工具。 .

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-26T14:34:37.383

我认为最好保持你的 OLTP 类型数据非规范化，以防止你的核心数据被“污染”。那会在路上咬你。

如果瓶颈是由于报告或只读需求，我个人认为除了规范化的“生产”表之外，非规范化报告表没有问题；创建一个流程以汇总到您需要使查询快速的任何级别。一个简单的 SP 或夜间进程，定期汇总和非规范化仅以只读方式使用的表，通常可以对用户体验产生巨大影响。

毕竟，如果没有人愿意使用您的系统，因为它太慢了，拥有一组理论上干净、完全规范化的数据有什么好处呢？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T09:07:45.453

> 起初我们使用完全规范化的数据库，但现在由于性能问题（以减少连接），我们对其进行了部分规范化。

正如那句老话所说：“正常化，直到它受伤，非正常化，直到它起作用”。

在大型、重度使用的数据库中看到一定程度的非规范化以提高性能是很常见的，所以我现在不会太担心它，只要你的性能仍然是你想要的地方并且你的代码可以管理“非规范化”字段不会变得过于繁重。

> 当数据量变得非常大时，可能的解决方案是什么？未来客户增加？

对您的应用程序的域了解不多，很难说您如何应对未来的挑战，但是将最近使用的和旧的数据拆分到单独的表中是在高流量数据库中相当常见的方法 - 如果您的 95% 的用户是查询他们过去 30/45 天的数据，拥有一个“live_data”表，其中包含最近 60 天的数据，以及一个用于旧数据的“old_data”，可以帮助您提高性能。

一个好主意是确保您设置了广泛的性能监控，以便您可以在数据和负载增加时测量数据库的性能。如果您发现性能明显下降，可能是时候重新访问您的索引了！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-03T09:07:52.273

那可能不是正确的决定。识别所有数据库交互并独立分析它们，然后找到有问题的交互并制定策略以最大限度地提高性能。同时打开数据库上的审计日志并挖掘它们可能会提供更好的优化点。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-04T00:32:56.623

*   首先确保您的数据库相当健康，如果可能，在其上运行 DBCC DBREINDEX，如果您无法承受性能损失，则运行 DBCC INDEXDEFRAG 并更新统计信息。

*   以合理的采样时间运行 Profiler，足以捕获大多数典型功能，但过滤持续时间大于 10 秒的时间，你不关心只需要几毫秒的事情，甚至不看那些.

*   现在您有了运行时间最长的查询，调整它们的鼻涕；获取出现最多的那些，查看查询分析器中的执行计划，花一些时间来理解它们，在必要的地方添加索引以加快检索速度

*   查看创建覆盖索引；如果需要更改应用程序，如果它正在执行 SELECT * FROM... 当它只需要 SELECT LASTNAME, FIRSTNAME....

*   重复分析器采样，持续时间为 5 秒、3 秒等，直到性能达到您的预期。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-08T17:44:39.317

有趣...这里有很多答案..

rdbms / os 版本是 64 位的吗？

在我看来，性能下降了几倍。部分原因肯定是由于索引。您是否考虑过以与数据存储方式一致的方式对某些表进行分区？意思是，根据数据的输入方式（基于顺序）创建分区。由于大多数索引都是静态的，因此这将为您带来很多性能提升。

另一个问题是 xml 数据。你在使用 xml 索引吗？来自在线书籍 (2008) “使用主 XML 索引，支持以下类型的二级索引：PATH、VALUE 和 PROPERTY。”

最后，系统目前是否设计为运行/执行大量动态 sql？如果是这样，您将从记忆的角度出发，因为计划需要生成、重新生成并且很少重新执行。我称之为记忆搅动或记忆颠簸。

高温高压

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-04T19:28:58.937

在分析了索引和查询之后，您可能只想使用更多硬件。更多的公羊演出可能会奏效。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-03T12:23:59.760

首先，正如许多其他人所说，几百万行并不大。我正在处理的当前应用程序有几个表，所有表都有超过一亿行，其中所有行都已标准化。

我们确实遇到了一些性能不佳的问题，但这是由于使用了默认的表统计设置造成的。相对于表的总大小插入少量记录，即将一百万条记录插入包含 100+ 百万条记录的表中不会导致表统计信息的自动更新，因此我们会得到表现不佳的查询计划作为生成的串行查询而不是并行查询。

至于非规范化是否是正确的决定，取决于您的架构。您是否必须定期执行深度查询，即大量连接以获取您经常需要访问的数据，如果是这样，那么部分去规范化可能是一种前进的方式。

**但在** 您检查索引和表统计策略之前不要这样做。
检查您是否使用了合理、结构良好的查询，并且您的联接格式正确。检查您的查询计划，您的查询实际上是按照您期望的方式解析的。

正如其他人所说，SQL Profiler/Database Engine Tuning Advisor 实际上做得很好。

对我来说，非规范化通常在我要做的事情列表的底部附近。

如果您仍然遇到问题，请检查您的服务器软件和硬件设置。

*   您的数据库和日志文件是否使用不同的控制器在不同的物理磁盘上？
*   它有足够的内存吗？
*   日志文件是否设置为自动增长？如果是这样，自动增长限制是否会降低，即它是否经常增长。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-03T11:37:08.227

我们一直尝试使用尽可能接近“现实世界”的数据库进行开发。这样你就可以避免很多像这样的陷阱，因为如果他的连接在调试过程中一直超时，任何老开发人员都会发疯。调试 Sql 性能问题 IMO 的最佳方法是 Mitch Wheat 建议的；profile 以查找有问题的脚本并从它们开始。优化脚本可以带您走得很远，然后您需要查看索引。还要确保你的 Sql Server 有足够的马力，尤其是 IO（磁盘）很重要。不要忘记；缓存为王。内存便宜；买多点。:)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-03T13:50:57.167

你做任何有效的事都是对的。
...只要您意识到以后可能要付出代价。听起来你无论如何都在考虑这个问题。

检查事项：

### 死锁

*   所有进程都以相同的顺序访问表吗？

### 缓慢

*   是否有任何查询进行表扫描？
    *   检查大型连接（超过 4 个表）
    *   检查你的不足

请参阅我关于一般性能提示的其他帖子：

*   [您如何针对特定查询优化表？](https://stackoverflow.com/questions/137226/how-do-you-optimize-tables-for-specific-queries#138949)
*   [最喜欢的性能调优技巧](https://stackoverflow.com/questions/18783/sql-what-are-your-favorite-performance-tricks#103176)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-04-22T13:48:23.587

几百万条记录对于 SQL Server 来说是一个很小的数据库。它可以处理具有大量连接的 TB 级数据，毫不费力。您可能有设计问题或写得很糟糕的查询。

在您上线之前进行性能测试的荣誉。在您投入生产数月或数年之后，修复这些东西要困难得多。

你所做的可能是一个糟糕的选择。如果进行非规范化，则需要设置触发器以确保数据保持同步。是你做的吗？它增加了多少插入和更新时间？

我的第一个猜测是您没有在外键上放置索引。

关于可能出错的其他猜测包括过度使用以下内容：相关子查询标量函数视图调用视图游标 EAV 表缺乏 sargability 使用 select *

糟糕的表格设计也可能导致难以获得良好的性能。例如，如果您的表太宽，访问它们会变慢。如果您经常将数据转换为另一种数据类型以使用它，那么您将其存储不正确，这将始终对系统造成拖累。

动态 SQl 可能比存储过程更快，但可能不会。对于性能，这里没有一个正确的答案。对于内部安全性（您不必在表级别设置权限）和易于更改数据库，存储过程更好。

您需要运行探查器并确定最慢的查询是什么。还要查看所有经常运行的查询。每天运行数千次查询时，一个小小的改变就可以带来巨大的回报。

你还应该去买一些关于性能调优的书。这些将帮助您完成整个过程，因为性能问题可能是由于许多原因造成的：数据库设计、查询设计、硬件索引等。

没有一种快速修复方法，如果您不保持数据完整性，随机非规范化会给您带来更多麻烦。

# java - “值语义”和“指针语义”是什么意思？

> ID：166033
> 
> 赞同：22
> 
> 时间：2008-10-03T09:04:08.083
> 
> 标签：java, c++, terminology, semantics

“值语义”是什么意思，“隐式指针语义”是什么意思？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-03T09:08:20.650

Java 对对象类型使用隐式指针语义，对基元使用值语义。

值语义意味着您直接处理值并传递副本。这里的重点是，当您拥有价值时，您可以相信它不会在您背后改变。

使用指针语义，你没有值，你有一个“地址”。其他人可以改变那里的东西，你不知道。

C++ 中的指针语义：

```
void foo(Bar * b) ...
... b->bar() ... 
```

你需要一个 * 来请求指针语义和 -> 来调用指针上的方法。

Java中的隐式指针语义：

```
void foo(Bar b) ...
... b.bar() ... 
```

由于您无法选择使用值语义，因此不需要 * 也不需要 -> 和 . 之间的区别，因此是隐含的。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-03T09:11:47.617

基本上，值语义意味着将一个值分配给另一个值会创建一个副本：

```
int x = 1;
int y = x;
x = 2; // y remains the same! 
```

一个特殊情况是传递参数的函数调用：

```
void f(int x) {
    x = 5;
}

int a = 1;
f(a);
// a is still 1 
```

对于 Java 和 C++，这实际上是相同的。但是，Java 只知道一些基本类型，其中包括`int`、和`double`，以及以这种方式运行的枚举。所有其他类型都使用引用语义，这意味着将一个值分配给另一个实际上是重定向指针而不是复制底层值：`boolean``char`

```
class Foo {
    int x;

    public Foo(int x) { this.x = x; }
}

Foo a = new Foo(42);
Foo b = a; // b and a share the same instance!
a.x = 32;
//b.x is now also changed. 
```

然而，有一些警告。例如，许多引用类型 ( `String`, `Integer`...) 实际上是不可变的。它们的值不能更改，对它们的任何分配都会覆盖旧值。

此外，参数仍然按值传递。这意味着传递给函数的对象的值可以更改，但其引用不能：

```
void f(Foo foo) {
    foo.x = 42;
}

void g(Foo foo) {
    foo = new Foo(42);
}

Foo a = new Foo(23);
f(a);
// a.x is now 42!

Foo b = new Foo(1);
g(b);
// b remains unchanged! 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T09:10:04.203

Java 用于`implicit pointer semantics`变量*访问*（您不能直接编辑引用，它会自动（隐式）解析为访问时的对象）并且还用于`Pass-by-Value semantics`方法*参数传递*。

阅读[Java 应用程序中的按值传递语义](http://web.archive.org/web/20070526204705/http://www.ibm.com:80/developerworks/java/library/j-passbyval)：

> 在 Java 应用程序中，当对象引用是方法的参数时，您传递的是引用的副本（按值传递），而不是引用本身。请注意，调用方法的对象引用和副本指向同一个对象。这是一个重要的区别。Java 应用程序在传递不同类型的参数时没有什么不同，就像 C++ 一样。Java 应用程序按值传递所有参数，因此无论类型如何，都会复制所有参数。

简而言之：Java 中的所有参数都是按值传递的。但这并不意味着对象被复制（就像 PHP4 中的默认值一样），而是对该对象的引用被复制。

[您将看到有关Java 应用程序中按值传递语义的](http://web.archive.org/web/20070526204705/http://www.ibm.com:80/developerworks/java/library/j-passbyval)所有解释和深入示例

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T09:13:00.203

Java 是按值传递的。C++ 可以同时使用值和引用语义。

[http://javadude.com/articles/passbyvalue.htm](http://javadude.com/articles/passbyvalue.htm)

# python - 在批处理文件中休眠

> ID：166044
> 
> 赞同：158
> 
> 时间：2008-10-03T09:10:29.023
> 
> 标签：python, batch-file

在编写批处理文件以在 Windows 机器上自动执行某些操作时，我需要暂停其执行几秒钟（通常在测试/等待循环中，等待进程启动）。当时，我能找到的最佳解决方案是使用 ping （我不骗你）来达到预期的效果。我在[这里](http://malektips.com/dos0017.html)找到了一个更好的文章，它描述了一个可调用的“wait.bat”，实现如下：

```
@ping 127.0.0.1 -n 2 -w 1000 > nul
@ping 127.0.0.1 -n %1% -w 1000> nul 
```

然后，您可以在自己的批处理文件中包含对 wait.bat 的调用，并传入休眠的秒数。

[显然，Windows 2003 Resource Kit 提供了一个类似 Unix 的 sleep 命令](http://malektips.com/xp_dos_0002.html)（终于！）。与此同时，对于我们这些仍在使用 Windows XP、Windows 2000 或（可悲的）[Windows NT](http://en.wikipedia.org/wiki/Windows_NT)的人，有没有更好的方法？

[我在接受的答案](https://stackoverflow.com/questions/166044/sleeping-in-a-dos-batch-file#166290)中修改了`sleep.py`脚本，因此如果命令行上没有传递任何参数，则默认为一秒：

```
import time, sys

time.sleep(float(sys.argv[1]) if len(sys.argv) > 1 else 1) 
```

* * *

## 回答 #1

> 赞同：236
> 
> 时间：2011-03-30T08:38:43.610

该[`timeout`](http://technet.microsoft.com/en-us/library/cc754891.aspx)命令从 Windows Vista 开始可用：

```
c:\> timeout /?

TIMEOUT [/T] timeout [/NOBREAK]

Description:
    This utility accepts a timeout parameter to wait for the specified
    time period (in seconds) or until any key is pressed. It also
    accepts a parameter to ignore the key press.

Parameter List:
    /T        timeout       Specifies the number of seconds to wait.
                            Valid range is -1 to 99999 seconds.

    /NOBREAK                Ignore key presses and wait specified time.

    /?                      Displays this help message.

NOTE: A timeout value of -1 means to wait indefinitely for a key press.

Examples:
    TIMEOUT /?
    TIMEOUT /T 10
    TIMEOUT /T 300 /NOBREAK
    TIMEOUT /T -1 
```

注意：它不适用于输入重定向 - 简单的示例：

```
C:\>echo 1 | timeout /t 1 /nobreak
ERROR: Input redirection is not supported, exiting the process immediately. 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-07-28T00:20:12.243

`ping`当我不能（或不想）添加更多可执行文件或安装任何其他软件时，使用概述的方法是我的做法。

您应该 ping 不存在的东西，并使用`-w`标志使其在这段时间后失败，而不是 ping 存在的东西*（*如本地主机）`-n`次。这使您可以处理不到一秒的时间，而且我认为它稍微准确一些。

例如

（测试没有采取 1.1.1.1）

```
ECHO Waiting 15 seconds

PING 1.1.1.1 -n 1 -w 15000 > NUL
  or
PING -n 15 -w 1000 127.1 >NUL 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-03T10:42:19.897

# 更新

从 Windows Vista 及更高版本可用的命令应该是使用的`timeout`命令，如该问题的另一个[答案](https://stackoverflow.com/a/5483958/6899)中所述。下面是一个*旧*答案。

### 旧答案

如果您安装了 Python，或者不介意安装它（它也有其他用途：），只需创建以下**sleep.py**脚本并将其添加到 PATH 中的某个位置：

```
import time, sys

time.sleep(float(sys.argv[1])) 
```

如果您有这样的需要，它将允许亚秒级的暂停（例如，1.5 秒、0.1 秒等）。如果您想将其称为`sleep`而不是`sleep.py`，则可以将`.PY`扩展名添加到 PATHEXT 环境变量中。在 Windows XP 上，您可以在以下位置进行编辑：

我的电脑→属性（菜单）→高级（选项卡）→环境变量（按钮）→系统变量（框架）

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-03T09:15:39.260

`SLEEP.exe`包含在大多数资源工具包中，例如[Windows Server 2003 资源工具包](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en)，它也可以安装在 Windows XP 上。

```
Usage:  sleep      time-to-sleep-in-seconds
        sleep [-m] time-to-sleep-in-milliseconds
        sleep [-c] commited-memory ratio (1%-100%) 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2011-07-24T10:10:43.117

我不同意我在这里找到的答案。

我完全基于 Windows XP 功能使用以下方法对批处理文件进行延迟：

延迟.BAT：

```
@ECHO OFF
REM DELAY seconds

REM GET ENDING SECOND
FOR /F "TOKENS=1-3 DELIMS=:." %%A IN ("%TIME%") DO SET /A H=%%A, M=1%%B%%100, S=1%%C%%100, ENDING=(H*60+M)*60+S+%1

REM WAIT FOR SUCH A SECOND
:WAIT
FOR /F "TOKENS=1-3 DELIMS=:." %%A IN ("%TIME%") DO SET /A H=%%A, M=1%%B%%100, S=1%%C%%100, CURRENT=(H*60+M)*60+S
IF %CURRENT% LSS %ENDING% GOTO WAIT 
```

您还可以在计算中插入日期，以便在延迟间隔超过午夜时该方法也有效。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-10-03T09:35:43.543

我遇到了类似的问题，但我只是敲开了一个非常短的 C++ 控制台应用程序来做同样的事情。只需运行*MySleep.exe 1000* - 可能比下载/安装整个资源包更容易。

```
#include <tchar.h>
#include <stdio.h>
#include "Windows.h"

int _tmain(int argc, _TCHAR* argv[])
{
    if (argc == 2)
    {
        _tprintf(_T("Sleeping for %s ms\n"), argv[1]);
        Sleep(_tstoi(argv[1]));
    }
    else
    {
        _tprintf(_T("Wrong number of arguments.\n"));
    }
    return 0;
} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-08-20T08:28:55.757

您可以使用 ping：

```
ping 127.0.0.1 -n 11 -w 1000 >nul: 2>nul: 
```

它将等待 10 秒。

您必须使用 11 的原因是因为第一个 ping 会立即消失，而不是在一秒钟后。该数字应始终比您要等待的秒数多一。

请记住，目的`-w`不是控制发送数据包的频率，而是确保在出现网络问题时等待不*超过*一段时间。如果您 p​​ing 127.0.0.1 不太可能有问题，所以这可能没有实际意义。

该`ping`命令本身通常会每秒发送一个数据包。这实际上并没有记录在 Windows 文档中，但它似乎遵循与 Linux 版本相同的规则（记录在哪里）。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-11-28T01:29:47.380

在 Server Fault 上，[有人问了一个类似的问题](https://serverfault.com/questions/38318/better-way-to-wait-a-few-seconds-in-a-bat-file)，解决方案是：

```
choice /d y /t 5 > nul 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2009-11-28T02:00:40.420

您可以使用 Windows *cscript WSH*层和这个*wait.js* JavaScript 文件：

```
if (WScript.Arguments.Count() == 1)
    WScript.Sleep(WScript.Arguments(0)*1000);
else
    WScript.Echo("Usage: cscript wait.js seconds"); 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2011-03-25T21:04:54.050

根据您的兼容性需求，可以使用`ping`：

```
ping -n <numberofseconds+1> localhost >nul 2>&1 
```

例如等待 5 秒，使用

```
ping -n 6 localhost >nul 2>&1 
```

或在 Windows 7 或更高版本上使用`timeout`：

```
timeout 6 >nul 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2014-02-21T17:24:23.267

使用 ping 有更好的睡眠方式。您需要 ping 一个不存在的地址，因此您可以指定毫秒精度的超时。幸运的是，这样的地址是在标准 (RFC 3330) 中定义的，它是`192.0.2.x`. 这不是虚构的，它确实是一个不存在的唯一目的的地址。需要明确的是，这甚至适用于本地网络。

> 192.0.2.0/24 - 此块被分配为“TEST-NET”，用于文档和示例代码。在供应商和协议文档中，它通常与域名 example.com 或 example.net 结合使用。此块内的地址不应出现在公共互联网上。

要休眠 123 毫秒，请使用**`ping 192.0.2.1 -n 1 -w 123 >nul`**

更新：根据评论，还有`127.255.255.255`.

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2013-05-29T00:03:40.610

如果您的系统上有[PowerShell](http://en.wikipedia.org/wiki/Windows_PowerShell)，则只需执行以下命令：

```
powershell -command "Start-Sleep -s 1" 
```

* * *

编辑：从[我对类似线程的回答中](https://stackoverflow.com/a/16803409/114200)，人们提出了一个问题，即与您尝试等待的时间相比，powershell 启动所需的时间很重要。如果等待时间的准确性很重要（即不能接受一两秒的额外延迟），您可以使用这种方法：

```
powershell -command "$sleepUntil = [DateTime]::Parse('%date% %time%').AddSeconds(5); $sleepDuration = $sleepUntil.Subtract((get-date)).TotalMilliseconds; start-sleep -m $sleepDuration" 
```

这需要发出 windows 命令的时间，并且 powershell 脚本会休眠到该时间后的 5 秒。因此，只要 powershell 的启动时间少于您的睡眠持续时间，这种方法就可以工作（在我的机器上大约需要 600 毫秒）。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2014-06-03T18:55:46.113

```
timeout /t <seconds> <options> 
```

例如，要让脚本执行不可中断的 2 秒等待：

```
timeout /t 2 /nobreak >NUL 
```

这意味着脚本将在继续之前等待 2 秒。

默认情况下，击键会中断超时，因此`/nobreak`如果您不希望用户能够中断（取消）等待，请使用该开关。此外，超时将提供每秒通知，以通知用户还需要等待多长时间；这可以通过将命令传递到`NUL`.

**编辑：**正如[@martineau](https://stackoverflow.com/users/355230/martineau) [在评论中指出的那样](https://stackoverflow.com/questions/166044/sleeping-in-a-batch-file#comment37041186_24022832)，该`timeout`命令仅适用于 Windows 7 及更高版本。此外，该`ping`命令使用的处理器时间比`timeout`. 不过，我仍然相信`timeout`尽可能使用，因为它比`ping`“hack”更具可读性。[在这里](https://ss64.com/nt/timeout.html)阅读更多。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2011-03-25T19:35:09.460

只需将其放在您想要等待的批处理文件中。

```
@ping 127.0.0.1 -n 11 -w 1000 > null 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-10-03T09:13:05.803

[资源工具包](https://en.wikipedia.org/wiki/Resource_Kit)一直包含此内容。至少从 Windows 2000 开始。

此外，Cygwin 软件包有一个`sleep`- plop 将其放入您的 PATH 并包括`cygwin.dll`（或任何它的名称）和要走的路！

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2013-01-18T17:35:21.017

在记事本中，写：

```
@echo off
set /a WAITTIME=%1+1
PING 127.0.0.1 -n %WAITTIME% > nul
goto:eof 
```

现在在文件夹 C:\WINDOWS\System32 中另存为 wait.bat，然后当你想等待时，使用：

```
CALL WAIT.bat <whole number of seconds without quotes> 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-10-03T10:08:15.957

[ping](http://en.wikipedia.org/wiki/Ping_%28networking_utility%29)的用法很好，只要你只是想“稍等一下”。这是因为您依赖于下面的其他功能，例如您的网络工作以及在 127.0.0.1 上没有任何响应的事实。;-) 也许它不太可能失败，但也不是不可能......

如果您想确保您正在等待指定的时间，您应该使用该`sleep`功能（它还有一个优点是它不使用 CPU 电源或等待网络准备好）。

找到一个已经生成的可执行文件用于睡眠是最方便的方法。只需将其放入您的 Windows 文件夹或标准路径的任何其他部分，它就始终可用。

否则，如果您有一个编译环境，您可以轻松地自己制作一个。该`Sleep`功能在 中可用`kernel32.dll`，因此您只需要使用该功能即可。:-) 对于 VB / VBA，在源代码的开头声明以下内容以声明睡眠功能：

```
private Declare Sub Sleep Lib "kernel32" Alias "Sleep" (byval dwMilliseconds as Long) 
```

对于 C#：

```
[DllImport("kernel32.dll")]
static extern void Sleep(uint dwMilliseconds); 
```

您可以在*[睡眠功能](http://msdn.microsoft.com/en-us/library/ms686298%28VS.85%29.aspx)*(MSDN) 中找到有关此功能（自 Windows 2000 起可用）的更多信息。

在标准 C 中，`sleep()`包含在标准库中，在 Microsoft 的 Visual Studio C 中，函数名为`Sleep()`，如果我没记错的话。;-) 这两个参数以秒为单位，而不是像前两个声明那样以毫秒为单位。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-07-07T14:39:09.053

我一直在使用这个 C# 睡眠程序。如果 C# 是您的首选语言，对您来说可能会更方便：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace sleep
{
    class Program
    {
        static void Main(string[] args)
        {
            if (args.Length == 1)
            {
                double time = Double.Parse(args[0]);
                Thread.Sleep((int)(time*1000));
            }
            else
            {
                Console.WriteLine("Usage: sleep <seconds>\nExample: sleep 10");
            }
        }
    }
} 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-07-29T18:12:24.757

比 Python 解决方案更轻量级的是 Perl 单行。

要休眠 7 秒，请将其放入 BAT 脚本中：

```
perl -e "sleep 7" 
```

该解决方案仅提供一秒的分辨率。

如果您需要更高的分辨率，请使用 CPAN 的 Time::HiRes 模块。它提供了`usleep()`哪些以微秒为单位休眠，`nanosleep()`哪些以纳秒为单位休眠（这两个函数都只接受整数参数）。请参阅堆栈溢出问题*[如何在 Perl 中休眠一毫秒？](https://stackoverflow.com/questions/896904)*了解更多详情。

我已经使用[ActivePerl](https://en.wikipedia.org/wiki/ActivePerl)很多年了。它很容易安装。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-01-29T02:30:37.333

我喜欢[Aacini 的回应](https://stackoverflow.com/a/6806192/2020158)。我添加到它来处理这一天，还使它能够处理[厘秒](http://en.wikipedia.org/wiki/Centisecond "厘秒")（`%TIME%`输出`H:MM:SS.CC`）：

```
:delay
SET DELAYINPUT=%1
SET /A DAYS=DELAYINPUT/8640000
SET /A DELAYINPUT=DELAYINPUT-(DAYS*864000)

::Get ending centisecond (10 milliseconds)
FOR /F "tokens=1-4 delims=:." %%A IN ("%TIME%") DO SET /A H=%%A, M=1%%B%%100, S=1%%C%%100, X=1%%D%%100, ENDING=((H*60+M)*60+S)*100+X+DELAYINPUT
SET /A DAYS=DAYS+ENDING/8640000
SET /A ENDING=ENDING-(DAYS*864000)

::Wait for such a centisecond
:delay_wait
FOR /F "tokens=1-4 delims=:." %%A IN ("%TIME%") DO SET /A H=%%A, M=1%%B%%100, S=1%%C%%100, X=1%%D%%100, CURRENT=((H*60+M)*60+S)*100+X
IF DEFINED LASTCURRENT IF %CURRENT% LSS %LASTCURRENT% SET /A DAYS=DAYS-1
SET LASTCURRENT=%CURRENT%
IF %CURRENT% LSS %ENDING% GOTO delay_wait
IF %DAYS% GTR 0 GOTO delay_wait
GOTO :EOF 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2012-01-08T05:39:12.237

或命令行 Python，例如 6 秒半：

```
python -c "import time;time.sleep(6.5)" 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2014-02-05T19:30:27.417

适用于 Windows 2000 之后的所有 Windows 版本的最佳解决方案是：

```
timeout numbersofseconds /nobreak > nul 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-06-23T00:47:06.710

有很多方法可以在 cmd/batch中完成“*睡眠”：*

我最喜欢的一个：

```
TIMEOUT /NOBREAK 5 >NUL 2>NUL 
```

这将使控制台停止 5 秒钟，没有任何输出。

最常被使用：

```
ping localhost -n 5 >NUL 2>NUL 
```

这将尝试建立`localhost`5 次连接。由于它托管在您的计算机上，因此它将始终到达主机，因此每秒它都会尝试新的每秒。该`-n`标志指示脚本将尝试连接多少次。在本例中为 5，因此它将持续 5 秒。

最后一个的变种：

```
ping 1.1.1.1 -n 5 >nul 
```

在此脚本中，与上一个脚本相比存在一些差异。这不会尝试调用`localhost`. 相反，它会尝试连接到`1.1.1.1`一个非常快速的网站。**仅当您有活动的互联网连接时，**该操作才会持续 5 秒。**否则它将持续大约 15 来完成该动作**。我不推荐使用这种方法。

```
ping 127.0.0.1 -n 5 >nul 
```

这与示例 2（最常用）完全相同。此外，您还可以使用：

```
ping [::1] -n 5 >nul 
```

相反，它使用 IPv6 的`localhost`版本。

有很多方法可以执行此操作。但是，对于 Windows Vista 及更高版本，我更喜欢方法 1，而对于早期版本的操作系统，我更喜欢最常用的方法（方法 2）。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2011-04-28T17:15:08.887

我对这个印象深刻：

[http://www.computerhope.com/batch.htm#02](http://www.computerhope.com/batch.htm#02)

```
choice /n /c y /d y /t 5 > NUL 
```

从技术上讲，您是在告诉`choice`命令只接受 y。它默认为 y，在 5 秒内完成，不绘制任何提示，并将它所说的任何内容转储到 NUL（如 Linux 上的空终端）。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2014-01-21T08:28:47.237

您还可以使用 .vbs 文件来执行特定的超时：

下面的代码创建 .vbs 文件。把它放在你的 rbatch 代码的顶部附近：

```
echo WScript.sleep WScript.Arguments(0) >"%cd%\sleeper.vbs" 
```

下面的代码然后打开 .vbs 并指定等待多长时间：

```
start /WAIT "" "%cd%\sleeper.vbs" "1000" 
```

在上面的代码中，“1000”是发送到.vbs文件的延时值，以毫秒为单位，例如1000 ms = 1 s。您可以将此部分更改为您想要的任意长度。

完成后，下面的代码将删除 .vbs 文件。将其放在批处理文件的末尾：

```
del /f /q "%cd%\sleeper.vbs" 
```

这是所有代码，因此很容易复制：

```
echo WScript.sleep WScript.Arguments(0) >"%cd%\sleeper.vbs"
start /WAIT "" "%cd%\sleeper.vbs" "1000"
del /f /q "%cd%\sleeper.vbs" 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2017-02-01T14:09:37.267

pathping.exe 可以睡不到一秒。

```
@echo off
setlocal EnableDelayedExpansion 
echo !TIME! & pathping localhost -n -q 1 -p %~1 2>&1 > nul & echo !TIME! 
```

.

```
> sleep 10
17:01:33,57
17:01:33,60

> sleep 20
17:03:56,54
17:03:56,58

> sleep 50
17:04:30,80
17:04:30,87

> sleep 100
17:07:06,12
17:07:06,25

> sleep 200
17:07:08,42
17:07:08,64

> sleep 500
17:07:11,05
17:07:11,57

> sleep 800
17:07:18,98
17:07:19,81

> sleep 1000
17:07:22,61
17:07:23,62

> sleep 1500
17:07:27,55
17:07:29,06 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2019-12-28T14:56:05.343

只是为了好玩，如果你安装了 Node.js，你可以使用

```
node -e 'setTimeout(a => a, 5000)' 
```

睡5秒。它适用于带有 Node v12.14.0 的 Mac。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-09-05T19:58:32.283

您可以通过将 PAUSE 消息放在标题栏中来获得幻想：

```
@ECHO off
SET TITLETEXT=Sleep
TITLE %TITLETEXT%
CALL :sleep 5
GOTO :END
:: Function Section
:sleep ARG
ECHO Pausing...
FOR /l %%a in (%~1,-1,1) DO (TITLE Script %TITLETEXT% -- time left^
 %%as&PING.exe -n 2 -w 1000 127.1>NUL)
EXIT /B 0
:: End of script
:END
pause
::this is EOF 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-01-08T11:50:43.363

从 Windows Vista 开始，您有[TIMEOUT](http://ss64.com/nt/timeout.html)和[SLEEP](http://ss64.com/nt/sleep.html)命令，但要在 Windows XP 或 Windows Server 2003 上使用它们，您需要[Windows Server 2003 资源工具包](http://www.microsoft.com/en-us/download/details.aspx?id=17657)。

[在这里](http://www.robvanderwoude.com/wait.php)，您对睡眠替代方案有一个很好的概述（ping 方法是最流行的，因为它适用于每台 Windows 机器），但是（至少）有一个没有提到（ab）使用[`W32TM`](https://ss64.com/nt/w32tm.html)（时间服务）命令：

```
w32tm /stripchart /computer:localhost /period:1 /dataonly /samples:N  >nul 2>&1 
```

您应该将 N 替换为您要暂停的秒数。此外，它可以在没有先决条件的情况下在每个 Windows 系统上运行。

也可以使用 Typeperf：

```
typeperf "\System\Processor Queue Length" -si N -sc 1 >nul 
```

使用 mshta 和 javascript（可以在一秒钟内用于睡眠）：

```
start "" /wait /min /realtime mshta "javascript:setTimeout(function(){close();},5000)" 
```

这应该更精确（等待一秒钟） - 自编译可执行文件依赖于`.net`：

```
@if (@X)==(@Y) @end /* JScript comment
@echo off
setlocal
::del %~n0.exe /q /f
::
:: For precision better call this like
:: call waitMS 500
:: in order to skip compilation in case there's already built .exe
:: as without pointed extension first the .exe will be called due to the ordering in PATEXT variable
::
::
for /f "tokens=* delims=" %%v in ('dir /b /s /a:-d  /o:-n "%SystemRoot%\Microsoft.NET\Framework\*jsc.exe"') do (
   set "jsc=%%v"
)

if not exist "%~n0.exe" (
    "%jsc%" /nologo /w:0 /out:"%~n0.exe" "%~dpsfnx0"
)

%~n0.exe %*

endlocal & exit /b %errorlevel%

*/

import System;
import System.Threading;

var arguments:String[] = Environment.GetCommandLineArgs();
function printHelp(){
    Console.WriteLine(arguments[0]+" N");
    Console.WriteLine(" N - milliseconds to wait");
    Environment.Exit(0);    
}

if(arguments.length<2){
    printHelp();
}

try{
    var wait:Int32=Int32.Parse(arguments[1]);
    System.Threading.Thread.Sleep(wait);
}catch(err){
    Console.WriteLine('Invalid Number passed');
    Environment.Exit(1);
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2014-01-29T14:01:10.200

这在 Windows XP SP3 和 Windows 7 上进行了测试，并使用 CScript。我放置了一些安全卫士以避免 del "" 提示。（`/q`会很危险）

等待一秒钟：

> 睡眠或延迟执行 1000

等待 500 毫秒，然后运行以下内容：

```
sleepOrDelayExecution 500 dir \ /s 
```

### sleepOrDelayExecution.bat：

```
@echo off
if "%1" == "" goto end
if NOT %1 GTR 0 goto end
setlocal
set sleepfn="%temp%\sleep%random%.vbs"
echo WScript.Sleep(%1) >%sleepfn%
if NOT %sleepfn% == "" if NOT EXIST %sleepfn% goto end
cscript %sleepfn% >nul
if NOT %sleepfn% == "" if EXIST %sleepfn% del %sleepfn%
for /f "usebackq tokens=1*" %%i in (`echo %*`) DO @ set params=%%j
%params%
:end 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2018-11-13T01:23:20.090

由于其他人建议使用 3rd 方程序（Python、Perl、自定义应用程序等），另一种选择是适用于 Windows 的 GNU CoreUtils，可在[http://gnuwin32.sourceforge.net/packages/coreutils.htm](http://gnuwin32.sourceforge.net/packages/coreutils.htm)获得。

2个部署选项：

1.  安装完整的软件包（其中将包括全套 CoreUtils、依赖项、文档等）。
2.  仅安装“sleep.exe”二进制文件和必要的依赖项（使用depends.exe 获取依赖项）。

部署 CoreUtils 的一个好处是，您还将获得许多其他有助于脚本编写的程序（Windows 批处理还有很多不足之处）。

* * *

## 回答 #32

> 赞同：-2
> 
> 时间：2014-07-28T07:51:43.573

```
ping -n X 127.0.0.1 > nul 
```

将 X 替换为秒数 + 1。

例如，如果您要等待 10 秒，请将 X 替换为 11。要等待 5 秒，请使用 6。

阅读较早的答案几毫秒。

# java - 如果我没有与我关联的域，我应该如何命名包？

> ID：166051
> 
> 赞同：35
> 
> 时间：2008-10-03T09:12:58.470
> 
> 标签：java, namespaces, packages

因此，大多数 Java 资源在谈到包时都会提到`com.yourcompany.project`设置。但是，我不在公司工作，也没有网站。是否有任何通用的命名约定？一个电子邮件地址，也许？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-03T09:22:22.743

使用像“bernard”这样的顶级域名或其他独特的域名。重要的部分是域是唯一的，这样可以避免冲突，而不是从真正的 Internet 顶级域开始，如 org 或 com。例如

```
import java.util.*;
import bernard.myProject.*;
import org.apache.commons.lang.*; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-04T01:01:44.367

如果您创建一个开源项目，您可以在 Sourceforge 注册它并使用 net.sourceforge.myproject。这在许多 Java 项目中很常见。一个例子是 PMD [http://pmd.sourceforge.net/](http://pmd.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T09:45:29.373

[在网上](http://c2.com/ppr/wiki/JavaIdioms/JavaPackageNames.html)找到的关于这个主题的好建议：*“用你的电子邮件地址开始你的包名，颠倒过来。[...]或者，将你的代码托管在一个可以为你提供他们域的一部分的站点上。”*

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-03T10:42:54.547

为什么不注册一个域？

它们相当便宜，这样做可以保证您不会与其他任何人发生冲突（或者至少让您感到满意，即如果确实发生冲突，则必须由其他人重写他们的代码）。

要么注册你自己的名字，要么试着编一个你以后可以用作业务基础的名字。

*   `bernard.surname.net`
*   `madeupname.net`

这将使您每年花费不到 10 英镑。

就个人而言，我会选择虚构的名称方法，因为它可能看起来更专业（除非你选择一些非常奇怪的东西）。

另一个优势是许多域都带有电子邮件功能，为您提供比 bernard.surname@hotmail.com 更好的电子邮件地址。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-03T23:51:59.233

请注意，“反向域名”只是一个约定：很有用，因为如果每个人都遵守它，它肯定会避免冲突，但您不必遵循它。

**只需选择一个您可以合理确定没有其他人会使用并且没有被任何人注册为商标的名称**- 因为这是您实际上可能陷入法律麻烦的一种方式。

这意味着使用您正在使用的免费服务的某种“子域”实际上是一个相当糟糕的主意，例如 deviantart 或 dyndns 或免费邮件服务！因为这些域中的大多数（如果不是全部）都是商标术语，并且如果您的项目得到广泛分发，则可能被视为违反商标。仅仅因为他们允许您将该名称用作电子邮件地址（或其他）并不意味着您可以将其用于其他任何用途 - 事实上，他们的 EULA 几乎可以肯定地将使用限制在一个目的上。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-03T10:56:00.713

您还可以做的是通过 DynDns（或等效项之一）之类的服务注册一个域（实际上是一个子域），然后使用该域名。您将是唯一的控制器，它是**免费**且易于维护的。他们目前有 88 个顶级域名可供选择（2008 年 10 月）。 [dyndns](http://www.dyndns.com/) [动态 dns 服务](http://www.dyndns.com/services/dns/dyndns/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-04T05:35:18.197

当我没有命名空间时，对于我自己的个人工作，我会选择一些简单的东西，比如`org.<myname>.*`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-10T03:59:50.820

我曾在几家不同的公司工作，他们编写了内部 Java 类。通常他们只是`com.blah.blah.blah`不考虑其背后是否有实际的域名。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-03T23:21:42.923

恕我直言，最好不依赖任何外部信息，例如托管服务提供商或公司（它可以发布到开源社区），因为包级别的重构并不是很理想，尤其是在框架和库的情况下。我建议仔细且明确地选择您的项目名称，然后使用 org.<project name> 作为根包。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-04T00:11:49.467

许多人拥有自己的网站和相对独特的名称（或登录名）。

如果您的名字是 Bernard Something，您可能拥有 BernardSomething.com，使 com.bernardsomething.xxxx（或 com.bsomething.xxx）成为个人代码的合法包名恕我直言。

话虽如此，如果您的项目名称是唯一的，您可能希望在此之后命名包。

当然，如果您还没有拥有域名，请在您的名字后获取域名！

# c# - Visual Studio 2008 中的 C# 结构突出显示

> ID：166067
> 
> 赞同：5
> 
> 时间：2008-10-03T09:20:18.020
> 
> 标签：c#, visual-studio

我正在寻找可以在 C# 代码编辑器中启用结构突出显示（代码块中的**垂直行）的 VS2008 加载项。**

我试用了 CodeRush，虽然结构突出显示很棒，但我对 CodeRush 中的所有其他内容感到恼火。无论我在选项中禁用了多少，我都无法完全摆脱它。

所以我正在寻找另一个能够突出显示结构并且（理想情况下）没有别的插件。知道吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-03T09:23:06.283

在浏览[ViEmu](http://viemu.com)网站时，我看到了[Codekana](http://codekana.com)产品，它看起来可以满足您的需求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T09:40:06.450

[SlickEdit 免费小工具](http://www.slickedit.com/content/view/441)中的缩进指南是您正在寻找的吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T10:47:10.323

我也在使用 JetBrains resharper 来处理这个问题（[http://www.jetbrains.com/resharper/](http://www.jetbrains.com/resharper/)），并发现它是完成更多任务的好工具。

如果您只需要突出显示，那可能是您的情况

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T10:48:50.900

ReSharper (www.jetbrains.com) 可以勾勒出一个范围。如果范围对于编辑器来说太大，当光标停留在右花括号/括号上时，它会显示范围的第一行（标题）。

# sap-ase - 如何将存储过程中的数据获取到临时表中？

> ID：166080
> 
> 赞同：15
> 
> 时间：2008-10-03T09:29:46.113
> 
> 标签：sap-ase

我正在研究 sybase ASE 15。正在寻找这样的东西

```
Select * into #tmp exec my_stp; 
```

my_stp 返回 10 个数据行，每行有两列。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-06T19:34:31.217

In ASE 15 I believe you can use functions, but they're not going to help with multirow datasets.

If your stored proc is returning data with a "select col1,col2 from somewhere" then there's no way of grabbing that data, it just flows back to the client.

What you can do is insert the data directly into the temp table. This can be a little tricky as if you create the temp table within the sproc it is deleted once the sproc finishes running and you don't get to see the contents. The trick for this is to create the temp table outside of the sproc, but to reference it from the sproc. The hard bit here is that every time you recreate the sproc you must create the temp table, or you'll get "table not found" errors.

```
 --You must use this whole script to recreate the sproc    
    create table #mine
    (col1 varchar(3),
    col2 varchar(3))
    go
    create procedure my_stp
    as
    insert into #mine values("aaa","aaa")
    insert into #mine values("bbb","bbb")
    insert into #mine values("ccc","ccc")
    insert into #mine values("ccc","ccc")
    go
    drop table #mine
    go 
```

The to run the code:

```
 create table #mine
(col1 varchar(3),
col2 varchar(3))
go

exec my_stp
go

select * from #mine
drop table #mine
go 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-04-06T16:50:32.770

我刚遇到这个问题，迟到总比没有好...

这是可行的，但在对接中是一个巨大的痛苦，涉及一个 Sybase“[代理表](http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.infocenter.dc36272.1550/html/commands/X35636.htm)”，它是另一个本地或远程对象（表、过程、视图）的代表。以下适用于 12.5，较新的版本希望有更好的方法。

假设您有一个存储过程定义为：

```
create procedure mydb.mylogin.sp_extractSomething (
@timestamp datetime) as
select column_a, column_b
    from sometable
    where timestamp = @timestamp 
```

首先切换到 tempdb：

```
use tempdb 
```

然后创建一个代理表，其中列与结果集匹配：

```
create existing table myproxy_extractSomething (
column_a int not null, -- make sure that the types match up exactly!
column_b varchar(20) not null,
_timestamp datetime null,
primary key (column_a)) external procedure at "loopback.mydb.mylogin.sp_extractSomething" 
```

注意事项：

*   “loopback”是 localhost 的 Sybase 等价物，但您可以将其替换为在服务器的 sysservers 表中注册的任何服务器。
*   当 Sybase 执行存储过程时，_timestamp 参数被转换为 @timestamp，并且所有像这样声明的参数列都必须定义为 null。

然后，您可以从您自己的数据库中像这样从表中选择：

```
declare @myTimestamp datetime
set @myTimestamp = getdate()

select * 
from tempdb..myproxy_extractSomething
where _timestamp = @myTimestamp 
```

这很简单。然后插入临时表，首先创建它：

```
create table #myTempExtract (
    column_a int not null, -- again, make sure that the types match up exactly
    column_b varchar(20) not null,
    primary key (column_a)
) 
```

并结合：

```
insert into #myTempExtract (column_a, column_b)
select column_a, column_b
    from tempdb..myproxy_extractSomething
    where _timestamp = @myTimestamp 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2014-08-30T07:14:16.233

如果 my_stp 通过计算来自不同表的值来填充数据，您可以创建一个与 my_stp 完全相同的等效视图。

```
CREATE VIEW My_view
 AS
/*
  My_stp body
*/

Then select data from view 
SELECT *  INTO #x FROM my_view 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-03T10:03:39.227

不确定 Sybase，但在 SQL Server 中应该可以：

插入 #tmp (col1,col2,col3...) exec my_stp

# c++ - #define TRACE(...) 在 C++ 中不起作用

> ID：166083
> 
> 赞同：2
> 
> 时间：2008-10-03T09:30:34.287
> 
> 标签：c++

我有以下预处理器神器：

```
#ifndef NDEBUG
#define TRACE printf
#else
#define TRACE(...)
#endif 
```

使用示例是：

```
TRACE("TRACE: some parameter = %i\n", param); 
```

在 C 中，当我构建调试和发布版本时，一切都运行良好，但在 C++ 编译器中会发出以下内容：

警告：宏参数名称中的字符无效

错误：“#define”中的参数列表标点错误

并将这些警告和错误指向“TRACE(...)”指令。

如何正确地用 C++ 编写它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T09:47:42.677

`#define TRACE false ||`

这会将 TRACE(x,y,z) 变为 false || (x,y,z)。由于 x,y 和 z 将是表达式，因此 (x,y,z) 的计算结果为 z（逗号运算符）。z 必须是内置类型（合法地传递给 printf 样式的函数），因此它应该在 || 的右侧有效。它不会被评估，但它必须是一个合法的表达式（例如，你不能引用只存在于 DEBUG 构建中的类成员）

Vararg 宏是 C99 的发明，它们不在 C++98 中，但很可能在 C++0x 中

[编辑] - 使用 || 保证不评价

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T09:32:26.293

你可以这样做：

```
inline void TRACE(...) {} 
```

# .net - Windows Mobile 开发的最佳可用在线资源是什么？

> ID：166084
> 
> 赞同：2
> 
> 时间：2008-10-03T09:30:54.207
> 
> 标签：.net, windows-mobile

什么是最好的在线资源。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T10:28:03.077

[Coding4Fun](http://blogs.msdn.com/coding4fun/)有一些关于 Windows Mobile 设备的教程。他们中的大多数都涉及很多内容，分布在多个帖子中，并且涵盖了 Windows Mobile 开发的不同方面。顾名思义，大多数应用程序都是关于小游戏和黑客的，而不是你可以在纯商业环境中使用的任何东西

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T09:48:13.970

我只是简单地玩过 Mobile Framework，但一个好的开始是[Windows Mobile 开发人员中心](http://msdn.microsoft.com/en-us/windowsmobile/default.aspx)

[另外值得一看CodePlex](http://www.codeplex.com/Project/ProjectDirectory.aspx?TagName=windows%20mobile)上的一些示例开源项目。Microsoft 在每次培训活动中都鼓励人们使用它，根据我的经验，您至少可以在标准 .Net 中找到一些有趣的项目。我想这同样适用于移动

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T11:23:51.440

我刚买了一部新的智能手机（WinMo 6 Pro），正在考虑开发它。不幸的是，对于原生 Window Mobile 开发，似乎确实缺乏清晰简洁的指南/文档/教程/书籍。

目前我找到的最好的资源是 MSDN，可惜我发现它太痛苦了。

我现在明白为什么 Palm 拥有如此活跃的开发社区、良好的参考资料、一些免费工具和简单的代码/API。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T11:42:52.637

这取决于 - 您打算使用 Compact Framework 还是使用 Embedded C++（本机应用程序）构建软件？

用于编写非托管应用程序的在线资源似乎并不多，但有一些关于 Compact Framework 开发的内容。

我能回忆起的第一个体面的指导是 2006 年，来自模式和实践团队 - 移动客户端软件工厂。我自己没有使用过它（我所有的移动应用程序工作都是在 Visual Studio 中完成的，没有使用其他软件），但我认识一些成功使用它的人。

似乎 Patterns and Practices 将他们的 Smart Client Guidance 移动到 codeplex [，](http://www.codeplex.com/smartclient)他们已将 Mobile Client Software Factory 更新到[2008 年 4 月](http://www.microsoft.com/downloads/details.aspx?FamilyId=3BE112CC-B2C1-4215-9330-9C8CF9BCC6FA&displaylang=en)的版本，支持 Visual Studio 2008。

当然还有 Windows Mobile 6 SDK。我认为最新的 SDK 可以[从这里](http://www.microsoft.com/downloads/details.aspx?familyid=06111A3A-A651-4745-88EF-3D48091A390B)获得。

# c# - 什么是 C++ std::pair 的 C# 模拟？

> ID：166089
> 
> 赞同：319
> 
> 时间：2008-10-03T09:33:06.980
> 
> 标签：c#, .net, data-structures, std-pair, base-class-library

我很感兴趣：C#`std::pair`在 C++ 中的类比是什么？我找到了`System.Web.UI.Pair`类，但我更喜欢基于模板的东西。

谢谢！

* * *

## 回答 #1

> 赞同：357
> 
> 时间：2008-10-03T09:35:49.407

元组从.NET4.0[开始可用](http://msdn.microsoft.com/en-us/library/system.tuple(v=vs.110).aspx)并支持泛型：

```
Tuple<string, int> t = new Tuple<string, int>("Hello", 4); 
```

* * *

在以前的版本中，您可以使用`System.Collections.Generic.KeyValuePair<K, V>`以下解决方案：

```
public class Pair<T, U> {
    public Pair() {
    }

    public Pair(T first, U second) {
        this.First = first;
        this.Second = second;
    }

    public T First { get; set; }
    public U Second { get; set; }
}; 
```

并像这样使用它：

```
Pair<String, int> pair = new Pair<String, int>("test", 2);
Console.WriteLine(pair.First);
Console.WriteLine(pair.Second); 
```

这输出：

```
test
2 
```

甚至这个链对：

```
Pair<Pair<String, int>, bool> pair = new Pair<Pair<String, int>, bool>();
pair.First = new Pair<String, int>();
pair.First.First = "test";
pair.First.Second = 12;
pair.Second = true;

Console.WriteLine(pair.First.First);
Console.WriteLine(pair.First.Second);
Console.WriteLine(pair.Second); 
```

输出：

```
test
12
true 
```

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2009-08-04T08:53:21.117

`System.Web.UI`包含`Pair`该类，因为它在 ASP.NET 1.1 中被大量用作内部 ViewState 结构。

**2017 年 8 月更新：** C# 7.0 / .NET Framework 4.7 提供了一种语法来使用结构声明具有命名项的元组[`System.ValueTuple`](https://msdn.microsoft.com/en-us/library/system.valuetuple.aspx)。

```
//explicit Item typing
(string Message, int SomeNumber) t = ("Hello", 4);
//or using implicit typing 
var t = (Message:"Hello", SomeNumber:4);

Console.WriteLine("{0} {1}", t.Message, t.SomeNumber); 
```

有关更多语法示例，请参阅[MSDN](https://msdn.microsoft.com/en-us/magazine/mt493248.aspx)。

**2012 年 6 月更新：** [`Tuples`](http://msdn.microsoft.com/en-us/library/system.tuple.aspx)自 4.0 版以来一直是 .NET 的一部分。

这是[一篇较早的文章，描述了 .NET4.0 中的包含](http://msdn.microsoft.com/en-us/magazine/dd942829.aspx)和对泛型的支持：

```
Tuple<string, int> t = new Tuple<string, int>("Hello", 4); 
```

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-10-03T09:37:55.877

不幸的是，没有。您可以`System.Collections.Generic.KeyValuePair<K, V>`在许多情况下使用。

或者，您可以使用匿名类型来处理元组，至少在本地：

```
var x = new { First = "x", Second = 42 }; 
```

最后一种选择是创建一个自己的类。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-08-04T08:58:57.143

C# 从 4.0 版开始就有[元组](http://msdn.microsoft.com/en-us/library/system.tuple.aspx)。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-01-14T10:57:05.987

有些答案似乎是错误的，

1.  您不能使用字典如何存储对 (a,b) 和 (a,c)。对概念不应与键和值的关联查找混淆
2.  上面的很多代码似乎都是可疑的

这是我的双人课

```
public class Pair<X, Y>
{
    private X _x;
    private Y _y;

    public Pair(X first, Y second)
    {
        _x = first;
        _y = second;
    }

    public X first { get { return _x; } }

    public Y second { get { return _y; } }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj == this)
            return true;
        Pair<X, Y> other = obj as Pair<X, Y>;
        if (other == null)
            return false;

        return
            (((first == null) && (other.first == null))
                || ((first != null) && first.Equals(other.first)))
              &&
            (((second == null) && (other.second == null))
                || ((second != null) && second.Equals(other.second)));
    }

    public override int GetHashCode()
    {
        int hashcode = 0;
        if (first != null)
            hashcode += first.GetHashCode();
        if (second != null)
            hashcode += second.GetHashCode();

        return hashcode;
    }
} 
```

这是一些测试代码：

```
[TestClass]
public class PairTest
{
    [TestMethod]
    public void pairTest()
    {
        string s = "abc";
        Pair<int, string> foo = new Pair<int, string>(10, s);
        Pair<int, string> bar = new Pair<int, string>(10, s);
        Pair<int, string> qux = new Pair<int, string>(20, s);
        Pair<int, int> aaa = new Pair<int, int>(10, 20);

        Assert.IsTrue(10 == foo.first);
        Assert.AreEqual(s, foo.second);
        Assert.AreEqual(foo, bar);
        Assert.IsTrue(foo.GetHashCode() == bar.GetHashCode());
        Assert.IsFalse(foo.Equals(qux));
        Assert.IsFalse(foo.Equals(null));
        Assert.IsFalse(foo.Equals(aaa));

        Pair<string, string> s1 = new Pair<string, string>("a", "b");
        Pair<string, string> s2 = new Pair<string, string>(null, "b");
        Pair<string, string> s3 = new Pair<string, string>("a", null);
        Pair<string, string> s4 = new Pair<string, string>(null, null);
        Assert.IsFalse(s1.Equals(s2));
        Assert.IsFalse(s1.Equals(s3));
        Assert.IsFalse(s1.Equals(s4));
        Assert.IsFalse(s2.Equals(s1));
        Assert.IsFalse(s3.Equals(s1));
        Assert.IsFalse(s2.Equals(s3));
        Assert.IsFalse(s4.Equals(s1));
        Assert.IsFalse(s1.Equals(s4));
    }
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-03T09:36:37.783

如果是关于字典之类的，您正在寻找 System.Collections.Generic.KeyValuePair<TKey, TValue>。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-04-26T11:04:20.363

除了自定义类或 .Net 4.0 元组之外，从 C# 7.0 开始，还有一个名为 ValueTuple 的新功能，它是一种可以在这种情况下使用的结构。而不是写：

```
Tuple<string, int> t = new Tuple<string, int>("Hello", 4); 
```

and access values through `t.Item1` and `t.Item2`, you can simply do it like that:

```
(string message, int count) = ("Hello", 4); 
```

or even:

```
(var message, var count) = ("Hello", 4); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-29T23:41:59.073

我创建了一个元组的 C# 实现，它通常解决了两个到五个值之间的问题 -[这是博客文章](http://shadowcoding.blogspot.com/2008/12/tuples.html)，其中包含到源的链接。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-03T09:38:33.240

根据您想要完成的任务，您可能想尝试[KeyValuePair](http://msdn.microsoft.com/en-us/library/5tbh8a42.aspx)。

您无法更改条目的键这一事实当然可以通过简单地用 KeyValuePair 的新实例替换整个条目来纠正。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-14T17:02:26.093

我刚刚在快速谷歌后问了同样的问题，我发现.NET 中有一个对类，除了它在 System.Web.UI 中 ^ ~ ^ ([http://msdn.microsoft.com/en-us/library/system.web.ui.pair.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.pair.aspx)）天知道他们为什么把它放在那里而不是集合框架

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-03-10T16:14:13.830

从 .NET 4.0 开始，你有`System.Tuple<T1, T2>`课：

```
// pair is implicitly typed local variable (method scope)
var pair = System.Tuple.Create("Current century", 21); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-03-03T07:21:33.050

我通常将`Tuple`类扩展为我自己的通用包装器，如下所示：

```
public class Statistic<T> : Tuple<string, T>
{
    public Statistic(string name, T value) : base(name, value) { }
    public string Name { get { return this.Item1; } }
    public T Value { get { return this.Item2; } }
} 
```

并像这样使用它：

```
public class StatSummary{
      public Statistic<double> NetProfit { get; set; }
      public Statistic<int> NumberOfTrades { get; set; }

      public StatSummary(double totalNetProfit, int numberOfTrades)
      {
          this.TotalNetProfit = new Statistic<double>("Total Net Profit", totalNetProfit);
          this.NumberOfTrades = new Statistic<int>("Number of Trades", numberOfTrades);
      }
}

StatSummary summary = new StatSummary(750.50, 30);
Console.WriteLine("Name: " + summary.NetProfit.Name + "    Value: " + summary.NetProfit.Value);
Console.WriteLine("Name: " + summary.NumberOfTrades.Value + "    Value: " + summary.NumberOfTrades.Value); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-10-23T18:15:45.883

为了使上述工作（我需要一对作为字典的键）。我不得不补充：

```
 public override Boolean Equals(Object o)
    {
        Pair<T, U> that = o as Pair<T, U>;
        if (that == null)
            return false;
        else
            return this.First.Equals(that.First) && this.Second.Equals(that.Second);
    } 
```

一旦我这样做了，我还添加了

```
 public override Int32 GetHashCode()
    {
        return First.GetHashCode() ^ Second.GetHashCode();
    } 
```

抑制编译器警告。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-11-19T01:56:24.263

PowerCollections 库（以前可从 Wintellect 获得，但现在托管在 Codeplex @ [http://powercollections.codeplex.com](http://powercollections.codeplex.com)上）具有通用的 Pair 结构。

# .net - 如何克隆 .NET 解决方案？

> ID：166099
> 
> 赞同：12
> 
> 时间：2008-10-03T09:37:55.503
> 
> 标签：.net, visual-studio

启动新的 .NET 项目总是需要一些工作。您必须创建解决方案，为不同的层（域、DAL、Web、测试）添加项目，设置参考、解决方案结构、复制 javascript 文件、css 模板和母版页等。

我想要的是**一种克隆任何给定解决方案的简单方法**。

如果您使用复制/粘贴，问题是您需要重新命名命名空间、程序集名称、解决方案名称、GUID 等。

有没有办法自动化这个？

这样的事情会很棒：

```
solutionclone.exe --solution=c:\code\abc\template.sln --to=c:\code\xyz --newname=MySolution 
```

我知道 Visual Studio 有项目模板，但我没有看到解决方案模板。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-07-29T09:28:19.423

I have created a small application for this. It works just like the previously mentioned Solutionclone app, except that it is both a command line application as well as a WPF application.

Cloney copies a source folder to a target one, without any Git or Svn integration. It will also replace the old namespace everywhere (in file names as well as within files) with the new namespace (the name of the target folder) and exclude certain files (e.g. *.suo, *.user, *.vssscc) and folders (e.g. .git, .svn).

You can grab the source code or download an executable at [https://github.com/danielsaidi/cloney](https://github.com/danielsaidi/cloney).

Cloney can also be added to the Windows Explorer context menu, which makes it possible to clone .NET solutions by just right-clicking the .sln file.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T09:53:00.870

正如您已经发现的那样：复制 .sln 文件并确保路径/向导匹配。

因为 .sln`text/plain`只是使用您最喜欢的脚本语言来编写克隆器脚本。

也许这是学习 Python/Ruby/Perl/ [Windows Script Host的好时机](http://en.wikipedia.org/wiki/Windows_Script_Host)

[MSDN 解决方案 (.sln) 文件定义](http://msdn.microsoft.com/en-us/library/bb165951.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T11:47:17.260

查看 CodePlex 上的[Tree Surgeon](http://www.codeplex.com/treesurgeon/ "树外科医生")，它为您创建了一个开发树。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-28T05:00:47.820

旧帖子，我知道，但我最近需要这样做，虽然有几个本土工具可以做到这一点，但我想要更轻量级的东西，我可以随心所欲地折腾。因为我喜欢用 python 来编写解释语言脚本，所以我在 python 中编写了一个单文件工具来完成这项工作。它唯一的依赖是python3和chardet2。

[https://gist.github.com/4159114](https://gist.github.com/4159114)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-11-28T05:08:10.443

您可以使用多项目模板来获得类似行为的解决方案。文件夹结构将稍微偏离将所有项目放入 .sln 文件以下的级别。

您还可以实现自定义 IWizard 以获得完全控制。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T11:19:12.583

我相信[Guidance Automation Toolkit](http://www.microsoft.com/downloads/details.aspx?familyid=B91066B3-D1D6-4990-A45F-34CF8DBDC60C&displaylang=en)允许您这样做，但可能不是一种“简单”的方式。

我和你有同样的问题，打算“现在很快”详细看看。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-27T09:46:00.790

可能你应该检查**Warmup**开源项目。[在http://devlicious.com/blogs/rob_reynolds/archive/2010/02/01/warmup-getting-started.aspx](http://devlicious.com/blogs/rob_reynolds/archive/2010/02/01/warmup-getting-started.aspx)上找到简要说明。

**恕我直言， Warmup**方法的优点是它可以直接从 SVN 或 GIT 克隆整个树的解决方案。

笔记！我没有亲自使用过，但计划在下一个项目中尝试一下。如果您使用它，请发表评论。

# c++ - 函数返回另一个函数的返回值

> ID：166113
> 
> 赞同：7
> 
> 时间：2008-10-03T09:44:31.120
> 
> 标签：c++, function, vector, return-value

如果我想调用`Bar()`而不是`Foo()`，是否会`Bar()`返回 Foo() 返回的副本（额外开销），还是返回`Foo()`放置在临时堆栈上的相同对象？

```
vector<int> Foo(){  
    vector<int> result;  
    result.push_back(1);  
    return result;  
}  
vector<int> Bar(){  
    return Foo();  
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-03T09:45:59.137

两者都可能发生。但是，大多数编译器不会在您优化后立即进行复制。

您的代码表明应该有一个副本。但是，允许编译器删除不改变语义和程序的任何副本。

注意：这就是为什么你永远不应该有一个除了正确复制之外做任何事情的复制构造函数，因为你永远无法确定复制是否会真正完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T09:45:23.087

通常它会返回返回的`vector<int>`. 然而，这在很大程度上取决于编译器所做的优化。请参阅以下讨论。

**调试构建**

```
vector<int> Foo(){  
004118D0  push        ebp  
004118D1  mov         ebp,esp 
004118D3  push        0FFFFFFFFh 
004118D5  push        offset __ehhandler$?Foo@@YA?AV?$vector@HV?$allocator@H@std@@@std@@XZ (419207h) 
004118DA  mov         eax,dword ptr fs:[00000000h] 
004118E0  push        eax  
004118E1  sub         esp,0F4h 
004118E7  push        ebx  
004118E8  push        esi  
004118E9  push        edi  
004118EA  lea         edi,[ebp-100h] 
004118F0  mov         ecx,3Dh 
004118F5  mov         eax,0CCCCCCCCh 
004118FA  rep stos    dword ptr es:[edi] 
004118FC  mov         eax,dword ptr [___security_cookie (41E098h)] 
00411901  xor         eax,ebp 
00411903  push        eax  
00411904  lea         eax,[ebp-0Ch] 
00411907  mov         dword ptr fs:[00000000h],eax 
0041190D  mov         dword ptr [ebp-0F0h],0 
    vector<int> result;  
00411917  lea         ecx,[ebp-24h] 
0041191A  call        std::vector<int,std::allocator<int> >::vector<int,std::allocator<int> > (411050h) 
0041191F  mov         dword ptr [ebp-4],1 
    result.push_back(1);  
00411926  mov         dword ptr [ebp-0FCh],1 
00411930  lea         eax,[ebp-0FCh] 
00411936  push        eax  
00411937  lea         ecx,[ebp-24h] 
0041193A  call        std::vector<int,std::allocator<int> >::push_back (41144Ch) 
    return result;  
0041193F  lea         eax,[ebp-24h] 
00411942  push        eax  
00411943  mov         ecx,dword ptr [ebp+8] 
00411946  call        std::vector<int,std::allocator<int> >::vector<int,std::allocator<int> > (41104Bh) 
0041194B  mov         ecx,dword ptr [ebp-0F0h] 
00411951  or          ecx,1 
00411954  mov         dword ptr [ebp-0F0h],ecx 
0041195A  mov         byte ptr [ebp-4],0 
0041195E  lea         ecx,[ebp-24h] 
00411961  call        std::vector<int,std::allocator<int> >::~vector<int,std::allocator<int> > (411415h) 
00411966  mov         eax,dword ptr [ebp+8] 
} 
```

在这里我们可以看到`vector<int> result;`在堆栈上创建了一个新对象`[ebp-24h]`

```
00411917  lea         ecx,[ebp-24h] 
0041191A  call        std::vector<int,std::allocator<int> >::vector<int,std::allocator<int> > (411050h) 
```

当我们`return result;`在调用者分配的存储空间中创建一个新副本时`[ebp+8]`

```
00411943  mov         ecx,dword ptr [ebp+8] 
00411946  call        std::vector<int,std::allocator<int> >::vector<int,std::allocator<int> > (41104Bh) 
```

`vector<int> result`并且为局部参数调用析构函数`[ebp-24h]`

```
0041195E  lea         ecx,[ebp-24h] 
00411961  call        std::vector<int,std::allocator<int> >::~vector<int,std::allocator<int> > (411415h) 
```

**发布构建**

```
vector<int> Foo(){  
00401110  push        0FFFFFFFFh 
00401112  push        offset __ehhandler$?Foo@@YA?AV?$vector@HV?$allocator@H@std@@@std@@XZ (401F89h) 
00401117  mov         eax,dword ptr fs:[00000000h] 
0040111D  push        eax  
0040111E  sub         esp,14h 
00401121  push        esi  
00401122  mov         eax,dword ptr [___security_cookie (403018h)] 
00401127  xor         eax,esp 
00401129  push        eax  
0040112A  lea         eax,[esp+1Ch] 
0040112E  mov         dword ptr fs:[00000000h],eax 
00401134  mov         esi,dword ptr [esp+2Ch] 
00401138  xor         eax,eax 
0040113A  mov         dword ptr [esp+8],eax 
    vector<int> result;  
0040113E  mov         dword ptr [esi+4],eax 
00401141  mov         dword ptr [esi+8],eax 
00401144  mov         dword ptr [esi+0Ch],eax 
    result.push_back(1);  
    return result;  
00401147  push        eax  
00401148  mov         dword ptr [esp+28h],eax 
0040114C  mov         ecx,1 
00401151  push        esi  
00401152  lea         eax,[esp+14h] 
00401156  mov         dword ptr [esp+10h],ecx 
0040115A  mov         dword ptr [esp+14h],ecx 
0040115E  push        eax  
0040115F  lea         ecx,[esp+1Ch] 
00401163  push        ecx  
00401164  mov         eax,esi 
00401166  call        std::vector<int,std::allocator<int> >::insert (401200h) 
0040116B  mov         eax,esi 
}  
0040116D  mov         ecx,dword ptr [esp+1Ch] 
00401171  mov         dword ptr fs:[0],ecx 
00401178  pop         ecx  
00401179  pop         esi  
0040117A  add         esp,20h 
0040117D  ret 
```

该行`vector<int> result`不调用向量分配器，因为它是在调用站点完成的`Bar`。优化不会复制 Foo 的结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T09:50:22.000

这是 NRVO 的一个小例子——名称返回值优化（在这种情况下用词不当，因为没有名称）。Stan Lippman写了[一篇博客文章](http://blogs.msdn.com/slippman/archive/2004/02/03/66739.aspx)，很好地解释了所涉及的机制。

# .net - .NET 设计课程？

> ID：166121
> 
> 赞同：4
> 
> 时间：2008-10-03T09:46:59.493
> 
> 标签：.net

有没有一门课程可以帮助非 OO 程序员如何在 .NET 中进行良好的开发？我的意思不仅仅是语法和如何设计一个类以及类之间的关系，而是如何将解决方案组织到项目中（命名，每个项目放什么）什么方法更适合访问数据（数据对象，远程处理，ORM ) 如何设计带有数据绑定的表单，如何验证，如果我们想稍后进行单元测试，为什么使用接口很重要等等。我想学习的东西太多了！但我只能找到参考书，或者一些通用的 XP 或敏捷实践。我有很多非常好的书籍（head first design patterns、head first C#、The Art of Agile Development、Code Complete、The Pragmatic Programmer series（颠覆、单元测试和接口编程），但他们没有

我找到了[http://www.learnvisualstudio.net](http://www.learnvisualstudio.net)、 [https://www.microsoftelearning.com](https://www.microsoftelearning.com)和[http://www.franklins.net](http://www.franklins.net)但它们并没有真正提供以可维护的方式发展的**策略**，它们只是显示我可以使用的工具。我也关注一些非常好的博客和网站，但我只能得到一些零碎的东西。

您是如何学习如何开发中型应用程序的？你能推荐任何好的网络课程吗？视频教程？博客？电子书？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T10:22:55.350

您可以通过查看真实代码来了解这一点。我喜欢做的一件事是阅读好的开源代码。尝试查看做得很好的 NUnit 源代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T01:25:30.083

Have a look at the [patterns & practices Application Architecture Guide 2.0 (Beta 2 Release)](http://www.codeplex.com/AppArchGuide) on Codeplex. The [patterns & practices division of Microsoft](http://msdn.microsoft.com/en-us/practices/default.aspx) also has guidelines for naming etc.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T10:53:09.173

是的，如前所述，前往[CodePlex](http://www.codeplex.com)并查看那里的各种开源项目，看看它们是如何设置的。对于 LOB 应用程序，可能值得查看 Rocky Lhokta 的[CSLA](http://www.lhotka.net/Default.aspx)业务对象框架。这有一本随附的书和项目供您查看。[或者，您可以查看Alt.Net](http://altdotnet.org) [people](http://altnetpedia.com/)是否有任何操作。

# c++ - C++：多线程和引用对象

> ID：166125
> 
> 赞同：7
> 
> 时间：2008-10-03T09:47:55.793
> 
> 标签：c++, multithreading, refcounting

我目前正在尝试将单线程程序传递给多线程。该软件大量使用“refCounted”对象，这导致了多线程中的一些问题。我正在寻找一些设计模式或可能解决我的问题的东西。

主要问题是线程之间的对象删除，通常删除只会减少引用计数，当 refcount 等于 0 时，则删除对象。这在单线程程序中运行良好，并且可以通过复制大对象来提高性能。

但是，在多线程中，两个线程可能希望同时删除同一个对象，因为该对象受互斥锁保护，只有一个线程删除该对象并阻止另一个。但是当它释放互斥锁时，另一个线程继续执行无效（释放的对象），这会导致内存损坏。

这是此类 RefCountedObject 的示例

```
class RefCountedObject
{
public:
RefCountedObject()
:   _refCount( new U32(1) )
{}

RefCountedObject( const RefCountedObject& obj )
:   _refCount( obj._refCount )
{
    ACE_Guard< ACE_Mutex > guard( _refCountMutex );
    ++(*_refCount);
}

~RefCountedObject()
{
    Destroy();
}

RefCountedObject& operator=( const RefCountedObject& obj )
{
    if( this != &obj )
    {
        Destroy();
        ACE_Guard< ACE_Mutex > guard( _refCountMutex );
        _refCount = obj._refCount;
        ++(*_refCount);
    }

    return *this;
}

private:
    void Destroy()
    {
        ACE_Guard< ACE_Mutex > guard( _refCountMutex );  // thread2 are waiting here
        --(*_refCount);         // This cause a free memory write by the thread2
        if( 0 == *_refCount )
            delete _refCount;
    }

private:
    mutable U32* _refCount;
    mutable ACE_Mutex _refCountMutex; // BAD: this mutex only protect the refCount pointer, not the refCount itself
}; 
```

假设两个线程要删除同一个 RefCountedObject，都在 ~RefCountedObject 中并调用 Destroy()，第一个线程已锁定互斥体，另一个正在等待。在第一个线程删除对象后，第二个线程将继续执行并导致空闲内存写入。

任何人都有类似问题的经验并找到了解决方案？

* * *

感谢大家的帮助，我意识到我的错误：互斥锁只保护 refCount 指针，而不是 refCount 本身！我创建了一个受互斥保护的 RefCount 类。互斥锁现在在所有 refCounted 对象之间共享。

现在一切正常。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T10:24:12.023

如果计数是对象的一部分，那么如果一个线程可能试图*增加*引用计数而另一个线程试图删除*最后一个*引用，那么您就会遇到一个固有的问题。每个指向对象的全局可访问指针的引用计数都需要一个额外的值，因此如果你有一个指针，你总是可以安全地增加引用计数。

一种选择是使用`boost::shared_ptr` [（参见文档）](http://www.boost.org/doc/libs/1_36_0/libs/smart_ptr/shared_ptr.htm)。在访问指向共享对象的全局指针时，您可以使用自由函数`atomic_load`、和（文档中明显没有这些函数）来确保适当的保护。一旦您的线程获得了对特定对象的引用，您就可以使用普通的非原子函数来访问它。`atomic_store``atomic_exchange``atomic_compare_exchange``shared_ptr`

另一种选择是使用 Joe Seigh 的[atomic_ptr_plus 项目中的 atomic ref-counted pointer](http://atomic-ptr-plus.sourceforge.net/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T09:54:12.943

当然，每个线程只需要正确管理引用计数......也就是说，如果 ThreadA 和 ThreadB 都与 Obj1 一起工作，那么 ThreadA 和 ThreadB 都应该拥有对该对象的引用，并且当它们完成时都应该调用 release目的。

在单线程应用程序中，您可能会创建一个引用计数对象，然后您对该对象进行处理并最终调用 release。在多线程程序中，您将创建对象，然后将其传递给您的线程（无论如何您都这样做）。在将对象传递给线程之前，您应该在对象上调用 AddRef() 以赋予线程自己的引用计数。分配对象的线程然后可以调用释放，因为它已经完成了对象。使用该对象的线程将在完成后调用 release，当最后一个引用被释放时，该对象将被清理。

请注意，您不希望在线程本身上运行的代码在对象上调用 AddRef()，因为在您调度的线程之前，在对象上创建线程调用 release 之间存在竞争条件以获得机会运行并调用 AddRef()。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T10:25:29.760

稍微考虑一下您的问题...您的意思是您有 1 个对象（如果 refcount 为 1），但 2 个线程都在其上调用 delete()。我认为这才是你真正的问题所在。

解决此问题的另一种方法是，如果您想要一个可以在线程之间安全重用的线程对象，则在释放内部内存之前检查引用计数是否大于 1。目前你释放它，然后检查 refcount 是否为 0。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T15:39:11.443

这不是答案，只是一点建议。在这种情况下，在你开始修复任何东西之前，请确保你可以可靠地复制这些问题。有时这很简单，就像在循环中运行单元测试一段时间一样。有时在你的程序中加入一些聪明的睡眠来强制竞争条件是有帮助的。

参考计数问题往往会持续存在，因此从长远来看，对测试工具的投资将获得回报。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T09:57:19.380

您在线程之间共享的任何对象都应使用互斥锁进行保护，这同样适用于引用计数*句柄*！这意味着您永远不会从两个线程中删除对象的最后一个句柄。您可能会同时删除恰好指向一个对象的两个不同句柄。

在 Windows 中，您可以使用 InterlockedDecrement。这确保了两个减量之一将返回 0。只有该线程将删除引用计数的对象。

任何其他线程也不能复制两个句柄之一。根据常见的 MT 规则，一个线程可能不会删除另一个线程仍在使用的对象，这也扩展到 refcount 句柄。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T10:02:58.247

一种解决方案是使引用计数器成为原子值，以便每个并发调用destroy 可以安全地进行，实际上只发生1 次删除，另一种只是减少原子引用计数。

英特尔线程构建模块库 (TBB) 提供原子值。

此外，`ACE_Atomic_Op`模板中的 ACE 库也是如此。

Boost 库提供了一个引用计数智能指针库，它已经实现了这一点。

[http://www.dre.vanderbilt.edu/Doxygen/Current/html/ace/a00029.html](http://www.dre.vanderbilt.edu/Doxygen/Current/html/ace/a00029.html) [http://www.boost.org/doc/libs/release/libs/smart_ptr/shared_ptr.htm](http://www.boost.org/doc/libs/release/libs/smart_ptr/shared_ptr.htm)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T10:11:42.143

我相信沿着这条线的东西会解决你的问题：

```
`private:
    void Destroy()
    {

        ACE_Guard< ACE_Mutex > guard( _refCountMutex );  // thread2 are waiting here
        if (_refCount != 0) {
            --(*_refCount);         // This cause a free memory write by the thread2
            if( 0 == *_refCount ) {
                delete _refCount;
                _refcount = 0;
            }
        }
    }
private:
    mutable U32* _refCount;
    mutable ACE_Mutex _refCountMutex;`
```

# javascript - 防止 YUI 中关键侦听器的默认行为

> ID：166127
> 
> 赞同：4
> 
> 时间：2008-10-03T09:48:20.863
> 
> 标签：javascript, firefox, yui

我有一个网页，我想将 Ctrl+N 重新映射到不同的行为。我按照 YUI 的注册键侦听器的示例并调用了我的函数，但 Firefox 仍然创建一个新的浏览器窗口。事情似乎在 IE7 上运行良好。如何阻止新窗口显示？

例子：

```
var kl2 = new YAHOO.util.KeyListener(document, { ctrl:true, keys:78 },
             {fn:function(event) {
                     YAHOO.util.Event.stopEvent(event); // Doesn't help
                     alert('Click');}});
kl2.enable(); 
```

可以删除默认行为。Google Docs 会覆盖 Ctrl+S 来保存您的文档，而不是打开 Firefox 的保存对话框。我用 Ctrl+S 尝试了上面的例子，但 Firefox 的保存对话框仍然弹出。由于谷歌可以阻止保存对话框出现，我确信有一种方法可以阻止大多数默认键盘快捷键。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-24T15:09:25.913

诀窍是'fn'功能很糟糕。

通过实验，您可以看到 fn 的函数类型有两个参数。第一个参数实际上包含事件的类型。第二个包含......这很奇怪：一个包含索引 0 处的代码点和索引 1 处的实际事件对象的数组。

所以稍微改变一下你的代码，它*应该*看起来像这样：

```
function callback(type, args)
{
    var event = args[1]; // the actual event object
    alert('Click');

    // like stopEvent, but the event still propogates to other YUI handlers
    YAHOO.util.Event.preventDefault(event);
}
var kl2 = new YAHOO.util.KeyListener(document, { ctrl:true, keys:78 }, {fn:callback});
kl2.enable(); 
```

此外，出于对 lisp 的喜爱，请勿在代码中使用原始代码点。使用 'N'.charCodeAt(0) 而不是 "78"。或者把它包装成一个函数

```
function ord(char)
{
    return char.charCodeAt(0);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T11:15:38.520

我只是在这里猜测，但我不认为它可以做到。

如果可能，那绝对不应该。通用键盘快捷键是您不应该乱用的东西。下一步是什么？钩住窗口关闭按钮以打开一个新窗口...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T23:49:42.823

使用 YUI 的事件工具，您可以尝试使用[stopEvent](http://developer.yahoo.com/yui/docs/YAHOO.util.Event.html#method_stopEvent)方法：

但是，由于大多数用户习惯于在浏览器中执行特定操作的按键（在您的示例中为新窗口），因此我总是避免发生冲突，这实际上意味着我不使用任何元键或控制键。

我只是单独使用字母，在你有文本输入框之前这很好，所以这个建议对你来说可能不太有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T10:24:24.570

尽管覆盖默认浏览器快捷方式并非易事，但在某些情况下，这样做是值得的，因为它使应用程序具有更专业的外观。看看这个脚本：

[http://www.openjs.com/scripts/events/keyboard_shortcuts/index.php#disable_in_input](http://www.openjs.com/scripts/events/keyboard_shortcuts/index.php#disable_in_input)

事实证明对我来说很好用..

# ip - IPv6地址的文本表示的最大长度？

> ID：166132
> 
> 赞同：507
> 
> 时间：2008-10-03T09:51:51.870
> 
> 标签：ip, ip-address, ipv6

我想将`$_SERVER["REMOTE_ADDR"]`PHP 返回的数据存储到 DB 字段中，非常简单的任务，真的。问题是我找不到有关IPv6 地址**文本表示**的最大长度的任何适当信息，这是网络服务器通过`$_SERVER["REMOTE_ADDR"]`.

我对将文本表示形式转换为通常编码地址的 128 位不感兴趣，我只想知道最多需要多少个字符来存储`$_SERVER["REMOTE_ADDR"]`.

* * *

## 回答 #1

> 赞同：712
> 
> 时间：2008-10-03T09:59:21.637

**45 个字符**。

您可能希望一个地址是

```
0000:0000:0000:0000:0000:0000:0000:0000 
```

> 8 * 4 + 7 = 39

8组4位数，中间7位数`:`。

但是，如果您有一个[IPv4 映射的 IPv6 地址](https://www.rfc-editor.org/rfc/rfc4291#section-2.5.5.2)，则最后两组可以用 10 为基数写入，用 分隔`.`，例如。`[::ffff:192.168.100.228]`. 完整地写出来：

```
0000:0000:0000:0000:0000:ffff:192.168.100.228 
```

> (6 * 4 + 5) + 1 + (4 * 3 + 3) = 29 + 1 + 15 = **45**

请注意，这是一个输入/显示约定——它仍然是一个 128 位地址，并且为了存储，最好将原始冒号分隔格式标准化，即`[0000:0000:0000:0000:0000:ffff:c0a8:64e4]`上面的地址。

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2013-12-09T14:43:13.027

在 Linux 上，请参阅常量`INET6_ADDRSTRLEN`（包括`<arpa/inet.h>`，请参阅`man inet_ntop`）。在我的系统上（标题“in.h”）：

```
#define INET6_ADDRSTRLEN 46 
```

正如我所相信的，最后一个字符用于终止 NULL，因此最大长度为 45，就像其他答案一样。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-03T09:56:32.970

回答了我自己的问题：

> IPv6 地址通常写成八组，每组四个十六进制数字，其中每组由冒号 (:) 分隔。

所以最多 39 个字符。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2017-03-05T06:49:13.067

如前所述，标准 ipv6 地址最多 45 个字符，但 ipv6 地址也可以包含一个结尾 %，后跟一个“范围”或“区域”字符串，它没有固定长度，但通常是一个小的正整数或网络接口名称，所以实际上它可以大于 45 个字符。网络接口名称通常是“eth0”、“eth1”、“wlan0”，因此选择 50 作为限制可能就足够了。linux 中的[最大接口名称长度为 15 个字符](https://stackoverflow.com/questions/24932172/what-length-can-a-network-interface-name-have)，因此选择 60 字节将覆盖 linux 上异常长的接口名称。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2013-12-08T09:30:13.970

我认为此链接中的@Deepak 答案更接近正确答案。[客户端 IP 地址的最大长度](https://stackoverflow.com/questions/1076714/max-length-for-client-ip-address)。所以正确的大小是 45 而不是 39。有时我们会尝试搜索字段大小，但如果我们准备足够的存储大小似乎会更好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-02-17T09:28:24.183

注意某些标头，例如`HTTP_X_FORWARDED_FOR`似乎包含单个 IP 地址的标头。它们实际上可能包含多个地址（我假设是一系列代理）。

它们似乎是用[逗号分隔](http://www.jamescrowley.co.uk/2007/06/19/gotcha-http-x-forwarded-for-returns-multiple-ip-addresses/)的——总共可能超过 45 个字符——所以在存储到数据库之前检查一下。

# php - 什么更快；包括另一个文件或在 PHP 中查询 MySQL 数据库？

> ID：166134
> 
> 赞同：8
> 
> 时间：2008-10-03T09:52:01.403
> 
> 标签：php, mysql, performance, include

在 PHP 中，这更快；使用`include('somefile.php')`或通过简单`SELECT`查询来查询 MySQL 数据库以获得相同的信息？

例如，假设您有一个 JavaScript 自动完成搜索字段，需要 3,000 个词来匹配。`include`使用简单`SELECT`查询从另一个文件中读取这些术语或从 MySQL 数据库中读取它们是否更快？

**编辑：**这是假设我要包含的数据库和文件与我的代码位于同一台本地计算机上。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-03T10:19:13.097

这取决于。如果您的文件本地存储在您的服务器中，并且数据库安装在另一台机器上，那么包含该文件的速度更快。

Buuuuut，因为这取决于您的系统，这可能不是真的。我建议你制作一个 PHP 测试脚本并从命令行运行 100 次，然后通过 HTTP 重复测试（使用 cURL）

例子：

**使用_include.php**

```
<?php

  start = microtime(true);

  include( 'somefile.php' );

  echo microtime(true)-start;

?> 
```

**使用_myphp.php**

```
<?php

  start = microtime(true);

  __put_here_your_mysql_statements_to_retrieve_the_file__

  echo microtime(true)-start;

?> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T11:01:24.320

包含一个文件应该几乎总是更快。如果您的数据库在另一台机器上（例如在共享主机中）或在多服务器设置中，则查找将不得不进行额外的跳跃。

然而，在实践中，差异可能并不重要。如果列表是动态的，那么将其存储在 MySQL 中将使您的生活更轻松。静态列表（例如国家或州）可以存储在 PHP 包含中。如果列表很短（几百个条目）并且经常使用，您可以将其直接加载到 JavaScript 中并取消 AJAX。

如果您要走 MySQL 路线并且担心速度，请使用缓存。

```
$query = $_GET['query'];
$key = 'query' . $query;
if (!$results = apc_fetch($key))
{ 
    $statement = $db->prepare("SELECT name FROM list WHERE name LIKE :query");
    $statement->bindValue(':query', "$query%");
    $statement->execute();
    $results = $statement->fetchAll();
    apc_store($key, $results);
}

echo json_encode($results); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T10:42:49.443

时间上的差异更多地取决于系统设计，而不是我敢说的底层技术。MySQL结果和文件都可以缓存在内存中，性能差异很小，可以忽略不计。

相反，我会问自己在维护方面会有什么不同。你有可能改变数据吗？如果没有，只需将其弹出一个普通文件即可。您是否可能经常更改内容的某些部分？如果是这样，数据库更容易操作。数据的结构也是如此，如果需要“重组”，也许把它放在数据库中更有效？

所以：做你认为对你和代码和数据的未来维护者最方便的事情。:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-03T10:02:32.833

很难/不可能给出准确的答案，因为有太多未知变量 - 如果文件系统安装在位于世界另一端的[NFS上怎么办？](http://en.wikipedia.org/wiki/Network_file_system)或者你在内存中有整个 MySQL 数据库。数据库的大小也应该考虑在内。

但是，更确切地说，**一个安全的猜测是 MySQL 更快**，给定良好的索引、良好的数据库结构/规范化以及不太花哨/复杂的查询。I/O 操作总是很昂贵（读取：慢），而如前所述，整个数据集已经被 MySQL 缓存在内存中。

此外，我想你想对那些包含的文件进行进一步的字符串操作，这让事情变得更加麻烦——我相信 MySQL 的字符串搜索算法比你在 PHP 中想出的优化得更好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T10:29:59.750

如果这是您要定期获取的内容，则可能值得预取数据（从磁盘或数据库，无关紧要）并让您的脚本从内存缓存（如 memcached）中提取数据。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T16:00:51.197

我最近遇到了这个问题。我在 mysql 中有一些数据，我正在查询每个页面请求。对于我的数据集，编写固定记录长度的文件比使用 MySQL 更快。

对我来说，有几个不同的因素使文件比 MySQL 更快：

1.  文件很小——文本数据不到 100kb
2.  我是随机挑选而不是搜索——索引没有区别
3.  连接时间——当服务器负载很高时，打开文件并读取它比连接到数据库要快。尤其如此，因为操作系统将文件缓存在内存中

底线是我对它进行了基准测试并比较了结果。对于我的工作量，文件系统更快。我怀疑如果我的数据集不断增长，那将会改变。我将密切关注性能，并准备在未来改变它的工作方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T09:58:43.213

绝对包括，只要文件不是太大并且最终使用太多内存，在这种情况下建议使用数据库

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-03T10:03:00.040

从文件中将原始数据读入脚本通常比从数据库中读取要快。

但是，听起来您想查询该数据以找到匹配项以返回到 javascript。在这种情况下，您可能会发现 MySQL 对数据的实际查询/搜索会更快（尤其是在正确索引的情况下等），因为这是数据库擅长的。

读取大文件的可扩展性也较低，因为在脚本执行时您将使用大量服务器内存。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-03T14:28:53.847

为什么不两种方式都做，看看哪个更快？这两种解决方案都很简单。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-03T14:36:33.317

如果您希望以后的术语数量会变得更大，那么最好使用带有[全文搜索](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html)字段的 MySQL。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-03T16:21:18.393

如果您使用 APC 或 Xcache 等 PHP 字节码缓存，包含文件可能会更快。如果您使用 PHP 并且想要性能，那么绝对需要字节码缓存。

听起来您正在考虑在包含的 PHP 脚本中保留静态数据，以避免访问数据库。你基本上是在做一个基本的缓存。这可以正常工作，只要您有某种方式在数据发生更改时刷新该文件。您可能还想了解 MySQL 查询缓存，以便更快地对静态数据进行 SQL 查询。或者 Memcached 用于将静态数据保存在内存中。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-10-03T09:56:31.363

我完全不知道，但在我使用 MySQL 的意见中，即使可以更慢，如果内容是动态的，也可以使用。但我很确定它会更快，对于大内容，使用包含。

# vb6 - 学习VB6

> ID：166138
> 
> 赞同：5
> 
> 时间：2008-10-03T09:54:31.740
> 
> 标签：vb6

我正在从 Java 开发转移到 MSFT 环境。该应用程序目前是用 VB6 编写的，虽然它将来会转到 VB.NET/C#，但我现在需要找到一种方法来获取 VB6。有人告诉我它很旧，这些天不会有关于它的书。

有小费吗？网站？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-03T10:01:16.890

最好的提示是……跑！;-)

不，那里仍然有大量的 vb 网站，而且您应该仍然可以为 VB6 获取大量二手书，几乎没有。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-14T15:35:32.373

有大量书籍，由于技术太旧，您可能可以很便宜地买到它们。例如，我刚刚在 1998 年以不到 3 美元的价格在亚马逊上买了一些 3 英寸厚的精装书。

此外，鉴于它的寿命，网络上有大量的参考资料随着时间的推移而积累起来。

VB6别被人吓到了，和现代开发平台相比，它有点原始，但如果没有完成工作，它不会被如此广泛地使用。也就是说，请使用更现代的开发工具，除非由于本文中其他人给出的原因您别无选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T10:26:08.760

恕我直言，从 Java 到 VB6 的步骤并没有那么大……如果您安装了 Visual Studio 和随附的 MSDN 库，那么您就有了一个很好的起点。查看一些代码，将光标放在一个函数上，然后按 F1。与更高版本不同，VB6 附带的“在线”文档确实很有帮助。;-) Visual Studio 中的自动完成功能也非常有用。我发现 Eclipse for Java 中的内联完成更有帮助。

Visual Basic 设计的优点之一是它被设计成人类可读的（用 if-then-else 代替括号等）。当然，这归结为单个开发人员也可以在那里编写易于理解且注释良好的代码......一个很好的起点是找到一个解释VB6中不同数据类型如何工作的指南。简单数据类型和对象之间的区别。以及如何将这些作为参数传递给函数：“ByVal”与“ByRef”。我认为这是 VB6 初学者最大的“危险”之一。一旦你了解它，这很容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T20:26:39.473

正如之前的海报所说，在线 vb6 有大量的帮助，而且在亚马逊上非常便宜。Francesco Balana 的书“Programming Visual Basic 6.0”是我推荐的最佳书籍。它在某些方面已经够难了，但值得付出努力，因为他提供的信息会让你对这个主题有更深入的理解，而不是“傻瓜”类型的书。他还撰写了我认为被认为是 .net Visual Basic 上最好的书籍之一，并且可能是从 vb6 迁移到 vb.net 以及其中的陷阱方面最重要的专家。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T09:58:08.130

我相信你可以得到一些关于它的书。如果亚马逊没有，试试 Ebay？

不过，这是一种简单的语言——你应该不会有太多的麻烦！总是有 MSDN 文档。

我遇到了相反的问题：我在 VB 中有一些旧应用程序，需要更新其中一个，但找不到安装媒体！

# .net - DataTable.Clear 和 DataTable.Rows.Clear 之间有区别吗？

> ID：166159
> 
> 赞同：7
> 
> 时间：2008-10-03T09:59:38.610
> 
> 标签：.net

[我记得在DataTable类上直接调用的某些方法/属性与](http://msdn.microsoft.com/en-us/library/system.data.datatable(VS.71).aspx)[DataTable.Rows](http://msdn.microsoft.com/en-us/library/system.data.datatable.rows(VS.71).aspx)属性上同名的方法/属性之间存在差异。（可能是我阅读本文的 RowCount/Count 属性。）不同之处在于其中一个忽略[DataRow.RowState](http://msdn.microsoft.com/en-us/library/system.data.datarow.rowstate(VS.71).aspx)，而其他尊重/使用它。

在这种特殊情况下，我想知道[DataTable.Clear](http://msdn.microsoft.com/en-us/library/system.data.datatable.clear(VS.71).aspx)和[DataTable.Rows.Clear](http://msdn.microsoft.com/en-us/library/system.data.datarowcollection.clear(VS.71).aspx)之间的区别。我可以想象其中一个实际上删除了所有行，而另一个只是将它们标记为已删除。

所以我的问题是，**这两种 Clear 方法之间是否有区别，如果有，有什么区别？**

（哦，这是针对 .NET 1.1 btw 的，以防语义从一个版本更改为另一个版本。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T16:58:50.063

在 .Net 1.1 中，`DataRowCollection.Clear`调用`DataTable.Clear`

但是，在 .Net 2.0 中，情况有所不同。如果我正确理解源，`DataTable.Clear`将清除未附加的行（使用创建`DataTable.NewRow`），而 DataRowCollection.Clear 不会。

区别在于`RecordManager.Clear`（以下来源，来自 v3.5 SP 0 的[.Net 参考源](http://referencesource.microsoft.com/netframework.aspx)）；`clearAll`仅当从 调用时才为真`DataTable.Clear`。

```
 internal void Clear(bool clearAll) { 
        if (clearAll) {
            for(int record = 0; record < recordCapacity; ++record) { 
                rows[record] = null;
            }
            int count = table.columnCollection.Count;
            for(int i = 0; i < count; ++i) { 
                //

                DataColumn column = table.columnCollection[i]; 
                for(int record = 0; record < recordCapacity; ++record) {
                    column.FreeRecord(record); 
                }
            }
            lastFreeRecord = 0;
            freeRecordList.Clear(); 
        }
        else { // just clear attached rows 
            freeRecordList.Capacity = freeRecordList.Count + table.Rows.Count; 
            for(int record = 0; record < recordCapacity; ++record) {
                if (rows[record]!= null && rows[record].rowID != -1) { 
                    int tempRecord = record;
                    FreeRecord(ref tempRecord);
                }
            } 
        }
    } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-03T11:09:15.723

我现在在 .NET 1.1/VS2003 中测试了不同的方法，看来 Matt Hamilton 是对的。

*   DataTable.Clear 和 DataTable.Rows.Clear 似乎在我测试的两件事上表现相同：都删除所有行（它们没有将它们标记为已删除，它们确实将它们从表中删除），并且都没有删除列的表。
*   DataTable.Reset 清除行和列。
*   DataTable.Rows.Count 确实包括已删除的行。（这可能是 1.1 特定的）
*   foreach 迭代已删除的行。（我很确定在 2.0 中会跳过已删除的行。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T10:08:26.847

`datatable.clear`AFAIK和之间的主要区别在于`datatable.rows.clear`清除`datatable.clear`行和列。因此，如果您想保留表结构（即列），请使用`datatable.rows.clear`. 如果您想从头开始，请使用`datatable.clear`，甚至`datatable.reset`直接回到开头。

`datatable.reset`实际上是从`datatable.clear`. 如果应用了任何违反的约束，则使用`datatable.clear`将失败，但使用`datatable.reset`将摆脱自创建数据表以来已放置的任何内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-03T10:28:03.733

我不相信 DataTable.Clear 会清除列。此代码将“1”写入标准输出：

```
var d = new DataTable();
d.Columns.Add("Hello", typeof(string));
d.Clear();
Console.WriteLine(d.Columns.Count); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T12:54:19.187

它们之间没有区别。DataRowCollection.Clear() 调用 Table.Clear()

Table.Clear() 检查表是否可以被清除（约束可以防止这种情况），删除行并重建任何索引。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-01-25T06:17:26.943

在下面做，它工作得很好....

```
DataRow[] d_row = dt_result.Select("isfor_report='True'");
DataTable dt = dt_result.Clone();                
foreach (DataRow dr in d_row)
{
     dt.ImportRow(dr);
}
gv_view_result.DataSource = dt;
gv_view_result.DataBind(); 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-10-03T10:34:38.570

两者都做同样的事情。一个只是从 Collections 类继承的方法。而 Table.Clear() 只是调用该方法。

# html - 如何缩放 iframe 的内容？

> ID：166160
> 
> 赞同：274
> 
> 时间：2008-10-03T10:00:08.970
> 
> 标签：html, css, dom

如何在我的网站页面中缩放 iframe 的内容（在我的示例中是 HTML 页面，而不是弹出窗口）？

例如，我想以原始大小的 80% 显示 iframe 中出现的内容。

* * *

## 回答 #1

> 赞同：242
> 
> 时间：2010-06-28T10:32:31.210

如果您将 CSS 更改为：[Kip 的解决方案应该可以在 Opera 和 Safari 上运行：](https://stackoverflow.com/questions/166160/how-can-i-scale-the-content-of-iframe/2224816#2224816)

```
<style>
    #wrap { width: 600px; height: 390px; padding: 0; overflow: hidden; }
    #frame { width: 800px; height: 520px; border: 1px solid black; }
    #frame {
        -ms-zoom: 0.75;
        -moz-transform: scale(0.75);
        -moz-transform-origin: 0 0;
        -o-transform: scale(0.75);
        -o-transform-origin: 0 0;
        -webkit-transform: scale(0.75);
        -webkit-transform-origin: 0 0;
    }
</style> 
```

您可能还想在 #frame 上指定 overflow: hidden 以防止滚动条。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2010-02-08T20:55:54.210

我找到了一个适用于 IE 和 Firefox 的解决方案（至少在当前版本上）。在 Safari/Chrome 上，iframe 被调整为原始大小的 75%，但 iframe 中的内容根本没有缩放。在 Opera 中，这似乎不起作用。这感觉有点深奥，所以如果有更好的方法，我会欢迎提出建议。

```
<style>
#wrap { width: 600px; height: 390px; padding: 0; overflow: hidden; }
#frame { width: 800px; height: 520px; border: 1px solid black; }
#frame { zoom: 0.75; -moz-transform: scale(0.75); -moz-transform-origin: 0 0; }
</style>

...

<p>Some text before the frame</p>
<div id="wrap">
<iframe id="frame" src="test2.html"></iframe>
</div>
<p>Some text after the frame</p>
</body> 
```

注意：我必须使用`wrap`Firefox 的元素。出于某种原因，在 Firefox 中，当您将对象缩小 75% 时，出于布局原因，它仍然使用图像的原始大小。（尝试从上面的示例代码中删除 div ，你就会明白我的意思了。）

我从[这个问题](https://stackoverflow.com/questions/1156278/css-how-to-scale-entire-web-page-with-css/1156526#1156526)中找到了一些。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2013-03-23T21:30:57.380

经过几个小时的努力，试图让它在 IE8、9 和 10 中工作，这对我有用。

自 2014 年 1 月 7 日起，这个精简的 CSS 可在 FF 26、Chrome 32、Opera 18 和 IE9 -11 中运行：

```
.wrap
{
    width: 320px;
    height: 192px;
    padding: 0;
    overflow: hidden;
}

.frame
{
    width: 1280px;
    height: 786px;
    border: 0;

    -ms-transform: scale(0.25);
    -moz-transform: scale(0.25);
    -o-transform: scale(0.25);
    -webkit-transform: scale(0.25);
    transform: scale(0.25);

    -ms-transform-origin: 0 0;
    -moz-transform-origin: 0 0;
    -o-transform-origin: 0 0;
    -webkit-transform-origin: 0 0;
    transform-origin: 0 0;
} 
```

对于 IE8，设置宽度/高度以匹配 iframe，并将 -ms-zoom 添加到 .wrap 容器 div：

```
.wrap
{
    width: 1280px; /* same size as frame */
    height: 768px;
    -ms-zoom: 0.25; /* for IE 8 ONLY */
} 
```

只需使用您最喜欢的浏览器嗅探方法来有条件地包含适当的 CSS，请参阅[Is there a way to do browser specific conditional CSS inside a *.css file?](https://stackoverflow.com/questions/639999/is-there-a-way-to-do-browser-specific-conditional-css-inside-a-css-file) 一些想法。

IE7 是一个失败的原因，因为 -ms-zoom 直到 IE8 才存在。

这是我测试的实际 HTML：

```
<div class="wrap">
   <iframe class="frame" src="http://time.is"></iframe>
</div>
<div class="wrap">
    <iframe class="frame" src="http://apple.com"></iframe>
</div> 
```

[http://jsfiddle.net/esassaman/PnWFY/](http://jsfiddle.net/esassaman/PnWFY/)

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2018-01-28T20:27:41.893

我刚刚测试过，对我来说，其他解决方案都不起作用。我只是简单地尝试了一下，它在 Firefox 和 Chrome 上运行良好，正如我所预料的那样：

```
<div class='wrap'>
    <iframe ...></iframe>
</div> 
```

和CSS：

```
.wrap {
    width: 640px;
    height: 480px;
    overflow: hidden;
}

iframe {
    width: 76.92% !important;
    height: 76.92% !important;
    -webkit-transform: scale(1.3);
    transform: scale(1.3);
    -webkit-transform-origin: 0 0;
    transform-origin: 0 0;
} 
```

这会将所有内容缩放 23.08%，相当于原始版本比嵌入式版本大 30%。（当然需要相应地调整宽度/高度百分比（1/scale_factor）。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2012-11-14T14:12:19.670

您不需要使用附加标签包装 iframe。只需确保将 iframe 的宽度和高度增加与缩小 iframe 相同的量即可。

例如将 iframe 内容缩放到 80%：

```
#frame { /* Example size! */
    height: 400px; /* original height */
    width: 100%; /* original width */
}
#frame {
    height: 500px; /* new height (400 * (1/0.8) ) */
    width: 125%; /* new width (100 * (1/0.8) )*/

    transform: scale(0.8); 
    transform-origin: 0 0;
} 
```

基本上，要获得相同大小的 iframe，您需要缩放尺寸。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2011-09-21T18:39:44.207

对[lxs 的回答](https://stackoverflow.com/questions/166160/how-can-i-scale-the-content-of-iframe/3131624#3131624)的跟进：我注意到一个问题，即同时拥有`zoom`和`--webkit-transform`标签似乎会通过双重缩放效果混淆 Chrome（版本 15.0.874.15）。`zoom`我能够通过替换为`-ms-zoom`（仅针对 IE）来解决这个问题，让 Chrome 只使用`--webkit-transform`标签，这样就解决了问题。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-09-25T17:41:09.220

以为我会使用上面给出的大部分内容来分享我的想法。我没有检查过 Chrome，但据我所知，它适用于 IE、Firefox 和 Safari。

此示例中的具体偏移量和缩放因子适用于在 iframe 中为 Facebook 选项卡（810 像素宽度）缩小和居中两个网站。

使用的两个站点是 wordpress 站点和 ning 网络。我对 html 不是很好，所以这可能会做得更好，但结果似乎不错。

```
<style>
    #wrap { width: 1620px; height: 3500px; padding: 0; position:relative; left:-100px; top:0px; overflow: hidden; }
    #frame { width: 1620px; height: 3500px; position:relative; left:-65px; top:0px; }
    #frame { -ms-zoom: 0.7; -moz-transform: scale(0.7); -moz-transform-origin: 0px 0; -o-transform: scale(0.7); -o-transform-origin: 0 0; -webkit-transform: scale(0.7); -webkit-transform-origin: 0 0; }
</style>
<div id="wrap">
    <iframe id="frame" src="http://www.example.com"></iframe>
</div> 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-03T11:01:26.503

html{zoom:0.4;} ?-)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2014-02-11T19:49:10.533

如果您希望 iframe 及其内容在窗口调整大小时缩放，您可以将以下内容设置为窗口的 resize 事件以及 iframe 的 onload 事件。

```
function()
{
    var _wrapWidth=$('#wrap').width();
    var _frameWidth=$($('#frame')[0].contentDocument).width();

    if(!this.contentLoaded)
      this.initialWidth=_frameWidth;
    this.contentLoaded=true;
    var frame=$('#frame')[0];

    var percent=_wrapWidth/this.initialWidth;

    frame.style.width=100.0/percent+"%";
    frame.style.height=100.0/percent+"%";

    frame.style.zoom=percent;
    frame.style.webkitTransform='scale('+percent+')';
    frame.style.webkitTransformOrigin='top left';
    frame.style.MozTransform='scale('+percent+')';
    frame.style.MozTransformOrigin='top left';
    frame.style.oTransform='scale('+percent+')';
    frame.style.oTransformOrigin='top left';
  }; 
```

这将使 iframe 及其内容缩放到 wrap div 的 100% 宽度（或您想要的任何百分比）。作为额外的好处，您不必将框架的 css 设置为硬编码值，因为它们都是动态设置的，您只需要担心包装 div 的显示方式。

我已经对此进行了测试，它适用于 chrome、IE11 和 firefox。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-05T04:57:19.677

我认为您可以通过使用 javascript 计算所需的高度和宽度（通过 document.body.clientWidth 等）然后将 iframe 注入到您的 HTML 中，如下所示：

```
var element = document.getElementById("myid");
element.innerHTML += "<iframe src='http://www.google.com' height='200' width='" + document.body.clientWidth * 0.8 + "'/>";

```

我没有在 IE6 中对此进行测试，但它似乎适用于好的 :)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-08-14T19:33:10.673

For those of you having trouble getting this to work in IE, it is helpful to use `-ms-zoom` as suggested below and use the zoom function on the `#wrap` div, not the `iframe` id. In my experience, with the `zoom` function trying to scale the iframe div of `#frame`, it would scale the iframe size and not the content within it (which is what you're going for).

Looks like this. Works for me on IE8, Chrome and FF.

```
#wrap {
  overflow: hidden;
  position: relative;
  width:800px;
  height:850px;
  -ms-zoom: 0.75;
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2012-12-14T14:34:55.063

这是我在宽度为 890px 的页面上的解决方案

```
#frame { 
overflow: hidden;
position: relative;
width:1044px;
height:1600px;
-ms-zoom: 0.85;
-moz-transform: scale(0.85);
-moz-transform-origin: 0px 0;
-o-transform: scale(0.85);
-o-transform-origin: 0 0;
-webkit-transform: scale(0.85);
-webkit-transform-origin: 0 0; 

} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-11-24T19:35:36.903

只要#wrap 中的数字是#frame 乘以比例因子，#wrap #frame 解决方案就可以正常工作。它仅显示缩小框架的那部分。您可以在此处看到它缩小网站并将其放入类似 pinterest 的形式（使用 woodmark jQuery 插件）：

[http://www.genautica.com/sandbox/woodmark-index.html](http://www.genautica.com/sandbox/woodmark-index.html)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-03-14T10:00:00.053

所以可能不是最好的解决方案，但似乎工作正常。

```
<IFRAME ID=myframe SRC=.... ></IFRAME>

<SCRIPT>
    window.onload = function(){document.getElementById('myframe').contentWindow.document.body.style = 'zoom:50%;';};
</SCRIPT> 
```

显然不是试图修复父母，只是用一点javascript将“zoom：50％”样式添加到孩子的身体。

也许可以设置“HTML”元素的样式，但没有尝试过。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-03T13:44:33.093

如果您的 html 使用 css 进行样式设置，您可能可以链接不同大小的不同样式表。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-03T10:37:29.470

我不认为 HTML 有这样的功能。我能想象的唯一能解决问题的就是做一些服务器端处理。也许您可以获取要服务的网页的图像快照，在服务器上对其进行缩放并将其提供给客户端。然而，这将是一个非交互式页面。（也许图像地图可以有链接，但仍然。）

另一个想法是拥有一个可以改变 HTML 的服务器端组件。有点像 Firefox 2.0 的缩放功能。这当然不是完美的缩放，但总比没有好。

除此之外，我没有想法。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-01-31T16:53:50.403

这些解决方案在 Flexbox 和 iFrame 100% 时无法正常工作（模糊），但如果 iframe 使用 rem em 或百分比单位，那么有一个看起来很棒的解决方案：

```
 window.onload = function(){
    let ifElem = document.getElementById("iframe-id");
    ifElem.contentWindow.document.documentElement.style.fontSize="80%";
  } 
```

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2008-10-03T10:41:37.573

如前所述，我怀疑你能做到。
也许您可以通过设置 style 至少缩放文本本身`font-size: 80%;`。
未经测试，不确定它是否有效，并且不会调整框或图像的大小。

# c# - 如何转换列表 to Hashtable in C#? I have a list of objects, each containing an Id, Code and Description. I need to convert this list into a Hashtable, using Description as the key and Id as the 问问题 Sam Wessel 问问题 2008-10-03T10:04:30.457 20248 次 This question shows research effort; it is useful and clear 18 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. I have a list of objects, each containing an Id, Code and Description. I need to convert this list into a Hashtable, using Description as the key and Id as the value. This is so the Hashtable can then be serialised to JSON. Is there a way to convert from List<Object> to Hashtable without writing a loop to go through each item in the list? If you have access to Linq, you can use the ToDictionary function. c#listhashtable 4 4 回答 4 This answer is useful 32 Let's assume that your List contains objects of type Foo (with an int Id and a string Description). You can use Linq to turn that list into a Dictionary like this: var dict = myList.Cast<Foo>().ToDictionary(o => o.Description, o => o.Id); 于 2008-10-03T10:13:52.047 回答 This answer is useful 5 如果您有权访问 Linq，则可以使用ToDictionary函数。 于 2008-10-03T10:12:43.297 回答 This answer is useful 0 theList.ForEach(delegate(theObject obj) { dic.Add(obj.Id, obj.Description); }); 于 2008-10-03T10:31:43.460 回答 This answer is useful -1 Also look at the System.Collections.ObjectModel.KeyedCollection<TKey, TItem>. It seems like a better match for what you want to do. 于 2008-10-03T12:58:40.533 回答 Related 3 php - Modx revo 检查成员组返回一个数组，如何将其转换为字符串以用于查询？ 1 c# - PDFCreator的程序控制 4 algorithm - 给定一个随机顺序的整数数组，您必须找到最小交换次数才能将其转换为循环排序数组 1 java - 向警报对话框添加第三个按钮会使应用程序崩溃 1 sql - excel 2010 vba。sql查询列'like' vlookup 4 c++ - 如何在没有数学函数（arctan）的情况下计算点和org（0,0）之间的快速路径角度（最接近八个提供值之一）？ 1 .htaccess - .htaccess 重写规则将所有从子文件夹重定向到另一个文件夹 2 java - 自 java 7 以来，JFileChooser 对按 Enter 没有反应 3 paypal - 贝宝沙盒登录 3 javascript - 如何将这种日期时间 2013-03-12T22:15:40+08:00 格式化为“2012 年 3 月 12 日 02:15:40 UTC”？ Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：166174
> 
> 赞同：18
> 
> 时间：
> 
> 标签：c#, list, hashtable

I have a list of objects, each containing an Id, Code and Description.

I need to convert this list into a Hashtable, using **Description** as the key and **Id** as the value.

This is so the Hashtable can then be serialised to JSON.

Is there a way to convert from List<Object> to Hashtable without writing a loop to go through each item in the list?

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-03T10:13:52.047

Let's assume that your List contains objects of type Foo (with an int Id and a string Description).

You can use Linq to turn that list into a Dictionary like this:

```
var dict = myList.Cast<Foo>().ToDictionary(o => o.Description, o => o.Id); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-03T10:12:43.297

如果您有权访问 Linq，则可以使用[ToDictionary](http://msdn.microsoft.com/en-us/library/bb549277.aspx)函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T10:31:43.460

```
theList.ForEach(delegate(theObject obj) { dic.Add(obj.Id, obj.Description); }); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-03T12:58:40.533

Also look at the `System.Collections.ObjectModel.KeyedCollection<TKey, TItem>`. It seems like a better match for what you want to do.

# sharepoint - 在 Sharepoint 中搜索日期元标记

> ID：166178
> 
> 赞同：5
> 
> 时间：2008-10-03T10:06:05.820
> 
> 标签：sharepoint, search

我目前正在考虑从 Sharepoint 索引一个 ASP 网站，我需要复制用户熟悉的旧“高级搜索”模式。为了做到这一点，我需要从网页中索引一些元标记。这很容易完成，对于文本字段，我也可以在搜索中使用它们。但是对于日期元标记，例如“过期”或“已发布”，我遇到了一些问题。问题基本上是元标记被抓取为“文本”，但我需要 Sharepoint 将它们解析为日期时间。我在[TechNet](https://forums.microsoft.com/TechNet/ShowPost.aspx?PostID=2614064&SiteID=17)上看到过一些帖子要求相同，但没有答案。

[1](https://forums.microsoft.com/TechNet/ShowPost.aspx?PostID=2614064&SiteID=17)：[https](https://forums.microsoft.com/TechNet/ShowPost.aspx?PostID=2614064&SiteID=17) ://forums.microsoft.com/TechNet/ShowPost.aspx?PostID=2614064&SiteID=17 TechNet

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-03T15:35:37.870

你没有做错任何事，这就是产品的工作原理。补充一下前面所说的，定制并不容易。

解决此问题的正确方法是为 HTML 创建自定义协议处理程序。这是一个自定义 COM 对象，它实现了一些接口。MOSS 2007 SDK 有一个协议处理程序参考。

当我们这样做时，我们创建了一个 ini 文件，这样我们就可以定义我们希望 META 字段被抓取的类型（String、Int、DateTime）。然后，当您添加自定义属性时，所有内容都已正确解析。然后，您可以像往常一样使用自定义属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T19:35:02.077

内置在搜索中的网络爬虫是初级的，您将无法轻松扩展它以包含元标记。据称您可以编写自己的协议处理程序并在自己的内容源中抓取 ASP 页面；据称这行得通。我认为实际上没有人编写自己的协议处理程序。

您会对 SharePoint 爬虫提供的功能感到失望，这就是为什么官方论坛上也没有答案的原因——因为真正的答案是“不能轻易做到，抱歉”。

您可以通过编写一个自定义 Web 服务（基于 ASMX 或 WCF）来破解某些东西，该服务本身会爬取 ASP 页面的元标记。从那里，您可以将 Web 服务结果拉入可搜索的 BDC，然后在搜索结果/BDC 数据中，您可以获得指向原始页面的链接。它就像一个 Rube Goldberg 设备，我知道，但是相信我，当我说它比弄清楚如何编写协议处理程序更容易时。

# java - 比 Sun WTK 更好的预验证器

> ID：166179
> 
> 赞同：1
> 
> 时间：2008-10-03T10:06:31.717
> 
> 标签：java, java-me, preverify

我目前正在使用 sun 预验证器来预验证我的 MIDlet。我发现它可能有点慢，没有给出任何体面的错误消息，并且只能作为 windows exe 使用。

有没有更好的预验证器可以跨平台工作（特别是linux）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T10:23:51.930

Proguard 可以预先验证 jar 文件。我想你可以禁用混淆，如果你不想要它，只需用它进行预验证。

它是一个 java 应用程序，所以它也应该在 Linux 上运行。

[http://proguard.sourceforge.net/manual/examples.html#microedition](http://proguard.sourceforge.net/manual/examples.html#microedition)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T12:05:04.993

实际上还有一个 Linux 版本的 WTK（来自 Sun），我每天都在 Ubuntu 上使用它。无法真正评论速度。

关于`Proguard`预验证 - 由于某些原因，这对我来说在某些罐子上不起作用，我无法弄清楚原因。使用 WTK 模拟器运行“预验证”jar 会引发预验证错误。

# sql - SQL 2005 另一个基础之间的外键

> ID：166185
> 
> 赞同：2
> 
> 时间：2008-10-03T10:07:45.007
> 
> 标签：sql, sql-server-2005, foreign-keys, between

是否可以在数据库表中为 SQL 2005 中另一个数据库中的表列创建外键？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T10:13:03.967

不。如果您需要跨数据库引用完整性，唯一的方法是使用触发器。

# python - 如何从 wxPython 应用程序中捕获所有异常？

> ID：166198
> 
> 赞同：6
> 
> 时间：2008-10-03T10:11:16.403
> 
> 标签：python, exception, error-handling, wxwidgets, error-reporting

我正在为我们正在开发的一些工具包编写一个小调试应用程序，我想将它推广给一些用户，看看他们是否会引发任何崩溃。有谁知道一种有效包装 wxPython 应用程序以捕获任何和所有会导致应用程序崩溃的未处理异常的方法？

理想情况下，我想捕获所有输出（不仅仅是错误）并将其记录到文件中。任何未处理的异常都应该记录到当前文件，然后允许异常照常传递（即记录过程应该是透明的）。

我确信以前一定有人做过类似的事情，但我没有设法通过谷歌找到任何看起来有用的东西。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-10T05:30:47.487

对于异常处理，假设您的日志文件作为日志打开：

```
import sys
import traceback

def excepthook(type, value, tb):
    message = 'Uncaught exception:\n'
    message += ''.join(traceback.format_exception(type, value, tb))
    log.write(message)

sys.excepthook = excepthook 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-03T10:30:07.440

对于记录标准输出，您可以使用标准输出包装器，例如这个：

```
from __future__ import with_statement

class OutWrapper(object):
    def __init__(self, realOutput, logFileName):
        self._realOutput = realOutput
        self._logFileName = logFileName

    def _log(self, text):
        with open(self._logFileName, 'a') as logFile:
            logFile.write(text)

    def write(self, text):
        self._log(text)
        self._realOutput.write(text) 
```

然后，您必须在您的主 Python 文件（运行所有内容的文件）中对其进行初始化：

```
import sys    
sys.stdout = OutWrapper(sys.stdout, r'c:\temp\log.txt') 
```

至于记录异常，最简单的做法是将`MainLoop`wx.App 的方法包装在 try..except 中，然后提取异常信息，以某种方式保存，然后通过 重新引发异常`raise`，例如：

```
try:
    app.MainLoop()
except:
    exc_info = sys.exc_info()
    saveExcInfo(exc_info) # this method you have to write yourself
    raise 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T21:33:00.687

您可以使用

> sys.excepthook

（见[Python 文档](http://docs.python.org/library/sys.html#sys.excepthook)）

并为其分配一些自定义对象，这将捕获代码中未捕获的所有异常。然后，您可以将任何消息记录到您希望的任何文件中，连同回溯，并对异常做任何您喜欢的事情（重新引发它，显示错误消息并允许用户继续使用您的应用程序等）。

至于记录标准输出——对我来说最好的方法是写一些类似于 DzinX 的 OutWrapper 的东西。

如果您处于调试阶段，请考虑在每个条目后刷新日志文件。这会极大地损害性能，但如果您设法在某些底层 C 代码中造成段错误，您的日志不会误导您。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T10:17:48.840

有多种方式。您可以在 wxApplication::OnInit 中放置一个 try..catch 块，但是，这并不总是适用于 Gtk。

一个不错的选择是覆盖 wxApplication 派生类中的 Application::HandleEvent，并编写如下代码：

```
void Application::HandleEvent(wxEvtHandler* handler, wxEventFunction func, wxEvent& event) const
{
    try
    {
        wxAppConsole::HandleEvent(handler, func, event);
    }
    catch (const std::exception& e)
    {
        wxMessageBox(std2wx(e.what()), _("Unhandled Error"),
            wxOK | wxICON_ERROR, wxGetTopLevelParent(wxGetActiveWindow()));
    }
} 
```

这是一个 C++ 示例，但您肯定可以轻松转换为 Python。

# excel - 如何将 DB2 日期时间字符串转换为 Excel 日期

> ID：166210
> 
> 赞同：2
> 
> 时间：2008-10-03T10:16:50.120
> 
> 标签：excel, vba

我会定期从 DB/2 数据库中提取日期和时间戳，格式如下：

```
2002-01-15-00.00.00.000000
2008-01-05-12.36.05.190000
9999-12-31-24.00.00.000000 
```

有没有比用子字符串分解更简单的方法将其转换为 Excel 日期格式？

```
DB2date = DateValue(Left(a, 4) + "/" + Mid(a, 6, 2) + "/" + Mid(a, 9, 2)) 
```

感谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T10:32:16.237

不清楚您是在谈论公式函数还是 VBA 函数。

## 公式函数

不要使用 DateValue 函数，它需要一个字符串；使用 Date 函数，它需要数字年、月、日：

```
=DATE(INT(LEFT(A1,4)),INT(MID(A1,6,2)),INT(MID(A1,9,2))) 
```

假设日期字符串在 A1 中。

## VBA 函数

与上面类似的计算，只需使用**DateSerial**函数代替：

```
dt= DateSerial(Int(Left$(dt$, 4), Int(Mid$(dt$, 6, 2)), Int(Mid$(dt$, 9, 2))) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T10:19:41.300

如果你真的愿意的话，我相信你可以用 Regex 做点什么。但它不会有任何“更好”，可能更糟。

如果你能原谅一点 C#（我已经很多年没有接触过 VB，所以我不再知道函数调用了）你也可以这样做：

```
DB2string = "2002-01-15-00.00.00.000000";
DB2date = DateValue(DB2string.SubString(0, 10).Replace('-', '/')); 
```

但同样，你并没有真正获得任何东西。你能举例说明你当前的代码会在哪里中断吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T10:41:01.007

在 VBA 中，`dateValue()`可以将字符串的第一部分转换为日期：

```
? dateValue("2002-01-15")

    15/01/2002 
```

因此，为您获取它的正确方法是

```
? dateValue(left("2002-01-15-00.00.00.000000",10)) 
```

只要 DB2 始终为您提供“YYYY-MM-DD”日期，这将始终为您提供正确的答案。结果的格式（dd/mm/yy、mm-ddd-yyyy 等）将取决于您计算机的本地设置/单元格的特定设置。

如果你想提取字符串的“时间”部分，这个`timeValue()`函数最终会完成这项工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T15:44:27.470

如果您想包含时间信息，您还有更多工作要做；DateValue 丢弃它。
TimeValue 可以将时间部分评估为秒，因此您可以添加它们：

```
= DateValue(Mid(a, 1, 10)) + TimeValue(Mid(a, 12, 8)) 
```

但是您的示例数据存在另一个问题：它同时具有时间值“00.00.00”和“24.00.00”。
第二个阻塞了 TimeValue 函数，因此您需要针对特殊情况编写代码。

# architecture - 小团队的软件开发流程

> ID：166212
> 
> 赞同：25
> 
> 时间：2008-10-03T10:17:17.453
> 
> 标签：architecture, project-management

我在这里可能是个例外，但我从未在一个拥有超过三个开发人员和/或五个人的团队中工作过。我们仍然可以设法完成工作（不知何故）。

是否有适合这种“极端”场景的软件开发过程？而且，如果你作为一个独立的程序员工作，你是否可以适应你的日常生活，使其更可预测、更连贯、更有记录，并且仍然可以完成工作？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-03T10:26:23.987

[敏捷方法](http://en.wikipedia.org/wiki/Agile_software_development)是一个很好的起点，因为恕我直言，它们更适合小团体。

至于保持你的个人工作节奏，我推荐一种基于 TODO 列表的方法和一些工具，如[Task2Gather](http://www.task2gather.com/)。您可能还想查看[GTD](http://en.wikipedia.org/wiki/Getting_Things_Done)。

即使是我的团队，我也永远不会放弃的事情：

*   源版本控制
*   备份
*   去做
*   单元测试/ [TDD](http://babilsenior.blogspot.com/2008/10/test-driven-development1-eng.html)
*   代码文档
*   重构/代码审查

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-28T21:15:10.783

让强大的[SecretGeeek](http://www.secretgeek.net)教你[如何成为一个独立的程序员](http://www.secretgeek.net/howtobeaprogrammer.asp)。享受 ：）

```
 intellisense 
        ||
        \/
       code >>> compile >>>>> run >>>> success >>>> profit ;-)
        /\         ||          ||         
        ^^         \/          \/
        ^^      errors       errors 
        ^^          \\       //
        ^^           \\     //
        ^^             google
        ^^              ||
        \\              \/
         \<<<<<<<  copy N paste 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-28T21:26:05.407

# [TODO 驱动开发](http://www.secretgeek.net/howtobeaprogrammer.asp)

[来自SecretGeek](http://www.secretgeek.net)的*严肃*建议。

设置您的开发环境或编辑器以自动列出所有带有 TODO 标记的行 - Visual Studio 默认执行此操作。

## 第1步

*   编写类或方法大纲（即“Public Class ...”或“Public Sub...”，内部没有代码。）
*   包括粗略的逻辑
*   添加带有“TODO：”的伪代码
*   只写*非常*琐碎的代码——其他的只要添加一个 TODO

## 第2步

*   重复步骤 1，直到整个应用程序被粗略完成
*   你现在有一个“TODO”任务的大列表
*   检查完整性（宽度）
*   看看可以删除什么。
*   查看可以简化的内容（例如，两个相似的待办事项注释：它们可以相同吗？

## 第 3 步

*   将 TODO 替换为对不存在的类、方法等的调用……（对于测试驱动开发，为这些方法/类中的每一个创建详尽的测试）

## 第4步

*   通过以下方式一次修复一个编译错误：
    *   编写类、方法等的外壳，
    *   随时添加 TODO: 伪代码。
    *   （如果时间紧迫，还可以在适当的地方添加“HACK：”评论和解释）
    *   在适当的情况下，将 TODO 替换为所需的琐碎代码

## 第 5 步

*   重复步骤 4，直到没有编译错误。
*   如果还有 TODO，则返回第 3 步。

*（还有很多事先计划、纸质原型设计、客户会议、讨论、拖延、数据库设计、喝咖啡、sprocs 和 crud-sproc 调用的代码生成、可重用 DAL 的导入、PAG 块使用、去 PAG !、文件签署前的来回辩论、争论、深夜、沮丧、与朋友聊天、筛选电子邮件、在 visio 中刮擦、打印出来并堆成一堆、寻找订书钉、捕捉公共汽车，做背部和颈部伸展等，但为了简单起见，这些都被忽略了......）*

[（又是 MarkJ）有点像Code Complete](http://www.cc2e.com)中的伪代码编程过程。[我们都同意](https://stackoverflow.com/questions/1711/what-is-the-single-most-influential-book-every-programmer-should-read)每个人都应该阅读 Code Complete，对吧？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-03T10:30:59.250

大多数敏捷方法都适合您的个人资料。

目前最受欢迎的是[SCRUM](http://en.wikipedia.org/wiki/Scrum_(development))。它是为小团队的生产力而设计的，它的粉丝声称开发时间比传统的瀑布方法要快 5-10 倍。

如果您想开始阅读，我推荐[Headfirst Software Development书](http://headfirstlabs.com/books/hfsd/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-03T10:43:40.330

我会推荐[Crystal Clear](http://www.agilekiwi.com/crystal_clear.htm)方法

七大属性

*   使用时间盒迭代的频繁交付/集成
*   反思改进、批评修正
*   通过办公室组织和开放渠道进行渗透（被动）知识获取和交流
*   人身安全，坦诚相待，对法庭批评有信心
*   保持专注，明确任务，工作重点，限制工作量
*   访问专家用户、快速、高质量的反馈
*   通常的敏捷东西：自动化测试、CM、持续集成

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-10-20T08:49:51.993

开发流程基本上是为大型团队创建的，以避免可能的混乱。如果您尝试自己完成大型项目，那么无论您使用哪种开发流程，您都将失败，因为您需要大量的人员才能及时完成所需的工作。

如果您从事小型项目，那么任何敏捷方法都应该这样做。GTD 不是方法，它是一种想要的方法。这就像我为我的大脑过程申请专利一样。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-20T10:05:55.287

不是直接回答您的问题，但史蒂夫·麦康奈尔 (Steve McConnell)十多年前写了一篇名为[“少即是多”的文章，探讨了为什么小型团队更有效率。](http://www.stevemcconnell.com/articles/art06.htm)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-20T10:10:18.433

持续集成是我一直尝试在我工作的团队中建立的第一件事，因为我相信它是良好开发实践的基础，即经常集成、自动构建/发布、自我测试构建，任何人都可以轻松获得最新信息。

在此处阅读更多信息： [http ://martinfowler.com/articles/continuousIntegration.html](http://martinfowler.com/articles/continuousIntegration.html)

# ruby-on-rails - 带有连接的 Rails named_scopes

> ID：166217
> 
> 赞同：20
> 
> 时间：2008-10-03T10:20:41.017
> 
> 标签：ruby-on-rails, ruby, activerecord, named-scope

我正在尝试创建一个使用连接的 named_scope，但虽然生成的 SQL 看起来正确，但结果是垃圾。例如：

```
class Clip < ActiveRecord::Base      
  named_scope :visible, {
    :joins => "INNER JOIN series ON series.id = clips.owner_id INNER JOIN shows on shows.id = series.show_id", 
    :conditions=>"shows.visible = 1 AND clips.owner_type = 'Series' "
  } 
```

（一个剪辑属于一个系列，一个系列属于一个节目，一个节目可以是可见的或不可见的）。

Clip.all 可以：

```
SELECT * FROM `clips` 
```

Clip.visible.all 会：

```
SELECT * FROM `clips` INNER JOIN series ON series.id = clips.owner_id INNER JOIN shows on shows.id = series.show_id WHERE (shows.visible = 1 AND clips.owner_type = 'Series' ) 
```

这看起来没问题。但是生成的剪辑模型数组包含一个 ID 不在数据库中的剪辑 - 它取而代之的是一个节目 ID。我哪里错了？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-03T10:56:23.723

问题是“SELECT *” - 查询按顺序从剪辑、系列和节目中提取所有列。每个表都有一个 id 列，并导致结果中命名列之间的冲突。拉回的最后一个 id 列（从节目中）覆盖了您想要的那个。您应该在 :joins 中使用 :select 选项，例如：

```
named_scope :visible, {
  :select => "episodes.*",
  :joins => "INNER JOIN series ON series.id = clips.owner_id INNER JOIN shows on shows.id = series.show_id", 
  :conditions=>"shows.visible = 1 AND clips.owner_type = 'Series' "
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-03T10:32:51.960

这是一个错误：

[http://rails.lighthouseapp.com/projects/8994/tickets/1077-chaining-scopes-with-duplicate-joins-causes-alias-problem](http://rails.lighthouseapp.com/projects/8994/tickets/1077-chaining-scopes-with-duplicate-joins-causes-alias-problem)

# eclipse - 恢复 Eclipse subversion 项目连接

> ID：166220
> 
> 赞同：100
> 
> 时间：2008-10-03T10:21:32.653
> 
> 标签：eclipse, svn

我有一个 subversion 项目，我正在使用 Eclipse 进行开发。我从 Eclipse 内部的 svn 存储库中进行了原始签出。几个星期以来一切都很好，然后由于某种未知的原因，Eclipse（特别是：Ganymede 中的 subclipse）不再将我的项目识别为受 svn 控制。团队上下文菜单仅显示基本的“应用补丁”/“共享此项目”菜单选项。在 shell 中，我仍然可以使用 svn 命令行工具更新项目，所以我知道 svn 凭据仍然有效。在同一个 Eclipse 副本中的 subversion 下的其他项目仍然可以工作。

我意识到我可以删除本地副本并再次检查它，但我宁愿了解出了什么问题 - 解决问题，而不是掩盖症状。Eclipse 在哪里存储关于哪些项目受版本控制的知识？我查看了`.project`文件和`.settings`目录，但没有看到任何明显提及 svn nature 或类似内容的内容，即使在仍在正常工作的项目中也是如此。

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2008-10-03T10:42:38.650

如果您使用 sublipse 作为您的 SVN 提供程序，我建议您执行以下操作

Team -> Share project 通常足以连接元数据。

（也就是说，假设 .svn 文件仍然存在，如果您可以在命令行上工作，它们似乎仍然存在）。

希望这有助于为什么会发生这种情况我不知道

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-01-27T18:53:58.897

我找到了一种简单的方法，只需重新导入项目

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-07-26T19:31:51.387

只是做团队-> 共享项目（根据@Paul Whelan 提供的这个问题的答案）对我不起作用。共享项目向导的行为就像该项目尚未在 SVN 中一样（即使我的项目存在 .svn 文件夹）。

我最终通过卸载 Subversive 和 JavaHL 附加组件（通过帮助 | 关于 Eclipse | 安装详细信息按钮 | 已安装的软件选项卡 | 卸载...）解决了这个问题，然后重新安装了 Subversive。在重新启动 Eclipse 后出现提示时，我选择安装 SVNKit 连接器而不是 JavaHL 连接器。

完成之后，当我再次尝试 Team -> Share Project... 时，Eclipse 正确识别出我的项目已经存在于 SVN 中，并成功恢复了连接。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-28T00:52:20.890

附录：事实证明，当我在公司 vpn 之外启动 Eclipse 时，我的问题就出现了，工作空间中的一个项目连接到 vpn 内的 svn 存储库。幸运的是，将 Eclipse svn 插件从 subversive 切换到 subclipse 确实解决了这个问题。

伊恩

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-09-22T15:56:38.233

从 Eclipse 中，我关闭了项目并重新打开，从而解决了问题。我工作区中所有项目的所有 SVN 链接都回来了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-08-09T10:17:47.937

我有同样的问题，这个论坛帮助我找到了正确的答案。

我之前的项目是使用 subclipse 配置的。新的日食具有颠覆性。

安装 subclipse 帮助我找回了团队下的 svn 选项！

希望它可以帮助别人。

问候

安舒普拉特克

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-03T22:15:11.377

不知道你在哪个平台上，不知道你的问题是不是和我的类似。但是，我最近（实际上在两个不同的平台上！）遇到了对 Subversive 的更新（或者可能是 Eclipse 本身，不清楚）导致连接器不再加载的问题。没有连接器，Subversive 无法连接到项目。但是 Eclipse 不会因此将您锁定在项目之外，它只会删除与 SVN 相关的功能。

查看 Errors 视图，它是 Eclipse 的各种错误（未找到类异常等）的日志，并查看是否有任何与 Subversive 组件相关的行。不幸的是，我不能真正推荐一个解决方案——在我的 Mac OSX 平台上，重新安装 Subversive 核心元素和连接器就足够了。在我的 Linux 机器上（可能是由于操作系统升级）我不得不完全重新安装 Eclipse，因为我已经积累了太多的垃圾，无法完全调查它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-12-19T23:34:41.820

在带有 Subversive 的 Juno 版本中，我做了：

*   File/Import 会弹出 Import 弹出窗口。
*   从那里，选择工作区中的常规/现有项目。
*   在下一个窗格中，选择根目录。然后它将显示所有子目录。默认情况下，它们都将被选中。
*   取消选择您不想要的那些。

然后它将“导入”您现有的目录，可以就地使用它们已经位于您的工作区目录中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-11-25T15:13:59.393

在我的情况下也是如此： .svn 目录在那里，但我的项目不支持 svn 操作。

经过一番戳戳，结果发现，在强制退出 Eclipse 后，颠覆性插件就消失了。

解决方案是（重新）安装颠覆性的，现在一切都很好了。

干杯诉

更新：我已经将 eclipse 切换到一个没有安装插件的新版本，这就是我必须从头开始安装它的原因。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-02-20T10:20:29.473

我可以可靠地重现这个问题——它发生在通过运行“签出为 Maven 项目...”而不是在包含 POM 本身的文件夹上而是在父目录（例如“主干”）上签出某些 Maven 项目时。在这种情况下，Subclipse 毫无怨言地签出项目，将其放在具有占位符名称的工作区目录中，例如`maven.1424425443350`. *在*这个目录中，它会创建一个名为 Maven 工件的子目录。这会混淆 Subclipse 和 Subversion：正如我们所见，Subclipse 会立即忘记项目处于版本控制之下，如果您`svn status`从目录中的命令行调用`maven.1424425443350`，它会告诉您该目录处于版本控制之下，但是所有版本控制的文件都丢失了。

如果这是导致 Subclipse 忘记其 SVN 连接的原因，则其他答案中提出的解决方法都不起作用。相反，唯一的解决方案是删除项目并再次签出，这次确保签出是在包含 POM 的目录而不是更高级别的目录上执行的。

一个更好的整体解决方案是让 Subclipse 拒绝在不包含 POM 的目录上运行“签出为 Maven 项目...”，或者通过搜索 Maven 项目的子目录来更好地处理无论如何尝试这样做的情况。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-03-27T08:09:33.610

这对我有用：右键单击-> TortoiseSVN -> 设置-> 图标覆盖属性，选择**外壳**作为状态缓存。单击确定，刷新页面。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-04-14T13:41:46.787

我同时使用了两个 SVNKit 实现（1.7.x 和 1.8.x）和 SVN 存储库版本（1.8.x）。

结果，**团队 -> 共享项目...**总是要求提交消息。显然，使用了与 SVN 1.8.x 不兼容的 SVNKit 1.7.x。

删除 SVNKit 1.7.x 后，eclipse 使用了唯一可用的正确 SVNKit 版本 1.8.x，一切都按预期工作。

# javascript - 如何使用 jQuery 异步上传文件？

> ID：166221
> 
> 赞同：3073
> 
> 时间：2008-10-03T10:22:17.347
> 
> 标签：javascript, jquery, ajax, asynchronous, xmlhttprequest

我想用 jQuery 异步上传文件。

```
$(document).ready(function () {
    $("#uploadbutton").click(function () {
        var filename = $("#file").val();

        $.ajax({
            type: "POST",
            url: "addFile.do",
            enctype: 'multipart/form-data',
            data: {
                file: filename
            },
            success: function () {
                alert("Data Uploaded: ");
            }
        });
    });
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<span>File</span>
<input type="file" id="file" name="file" size="10"/>
<input id="uploadbutton" type="button" value="Upload"/>
```

我只获取文件名，而不是上传文件。我能做些什么来解决这个问题？

* * *

## 回答 #1

> 赞同：2590
> 
> 时间：2012-01-06T13:34:48.380

使用[HTML5](http://en.wikipedia.org/wiki/HTML5)，您可以使用 Ajax 和 jQuery 进行文件上传。不仅如此，您还可以进行文件验证（名称、大小和 MIME 类型）或使用 HTML5 进度标记（或 div）处理进度事件。最近我不得不制作一个文件上传器，但我不想使用[Flash](http://en.wikipedia.org/wiki/Adobe_Flash)、Iframe 或插件，经过一番研究，我想出了解决方案。

的HTML：

```
<form enctype="multipart/form-data">
    <input name="file" type="file" />
    <input type="button" value="Upload" />
</form>
<progress></progress> 
```

首先，您可以根据需要进行一些验证。例如，在`.on('change')`文件的情况下：

```
$(':file').on('change', function () {
  var file = this.files[0];

  if (file.size > 1024) {
    alert('max upload size is 1k');
  }

  // Also see .name, .type
}); 
```

现在`$.ajax()`点击按钮提交：

```
$(':button').on('click', function () {
  $.ajax({
    // Your server script to process the upload
    url: 'upload.php',
    type: 'POST',

    // Form data
    data: new FormData($('form')[0]),

    // Tell jQuery not to process data or worry about content-type
    // You *must* include these options!
    cache: false,
    contentType: false,
    processData: false,

    // Custom XMLHttpRequest
    xhr: function () {
      var myXhr = $.ajaxSettings.xhr();
      if (myXhr.upload) {
        // For handling the progress of the upload
        myXhr.upload.addEventListener('progress', function (e) {
          if (e.lengthComputable) {
            $('progress').attr({
              value: e.loaded,
              max: e.total,
            });
          }
        }, false);
      }
      return myXhr;
    }
  });
}); 
```

如您所见，使用 HTML5（和一些研究）文件上传不仅变得可能而且超级容易。尝试使用[Google Chrome](http://en.wikipedia.org/wiki/Google_Chrome)，因为示例的某些 HTML5 组件并非在每个浏览器中都可用。

* * *

## 回答 #2

> 赞同：293
> 
> 时间：2008-10-03T10:41:31.320

## 2019 年更新：这*仍然*取决于*您的*人口统计使用的浏览器。

`file`使用“新”HTML5 API要了解的重要一点是，[直到 IE 10 才支持](http://caniuse.com/fileapi)它。如果您瞄准的特定市场对旧版本 Windows 的倾向高于平均水平，您可能无法访问它。

截至 2017 年，大约 5% 的浏览器是 IE 6、7、8 或 9 之一。如果你进入一家大公司（例如，这是一个 B2B 工具或你提供的培训工具），这个数字可能会飙升。2016 年，我与一家公司打交道，他们 60% 以上的机器都使用 IE8。

到本次编辑时是 2019 年，距离我最初的回答已经过去了将近 11 年。IE9 及更低版本的*全球*使用率在 1% 左右，但仍有较高使用率的集群。

重要的一点是——不管是什么功能——**检查*你的*用户使用**什么浏览器。如果你不这样做，你将快速而痛苦地学到为什么“为我工作”在交付给客户时不够好。[caniuse](https://caniuse.com/)是一个有用的工具，但请注意他们从哪里获得人口统计数据。它们可能与您的不一致。这从来没有比企业环境更真实。

我在 2008 年的回答如下。

* * *

但是，有一些可行的非 JS 文件上传方法。您可以在页面上创建一个 iframe（使用 CSS 隐藏），然后将表单定位到该 iframe。主页不需要移动。

这是一个“真实”的帖子，所以它不是完全互动的。如果您需要状态，则需要在服务器端进行处理。这取决于您的服务器。[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)有更好的机制。PHP plain 失败，但您可以使用[Perl](http://en.wikipedia.org/wiki/Perl)或 Apache 修改来解决它。

如果您需要上传多个文件，最好一次上传一个文件（以克服最大文件上传限制）。将第一个表单发布到 iframe，使用上述方法监视其进度，完成后，将第二个表单发布到 iframe，依此类推。

或者使用 Java/Flash 解决方案。他们可以更灵活地处理他们的帖子......

* * *

## 回答 #3

> 赞同：116
> 
> 时间：2008-11-21T16:38:06.750

为此，我建议使用[Fine Uploader插件。](http://fineuploader.com/demos.html)您的`JavaScript`代码将是：

```
$(document).ready(function() {
  $("#uploadbutton").jsupload({
    action: "addFile.do",
    onComplete: function(response){
      alert( "server response: " + response);
    }
  });
}); 
```

* * *

## 回答 #4

> 赞同：105
> 
> 时间：2008-10-03T10:36:38.677

注意：此答案已过时，现在可以使用 XHR 上传文件。

* * *

您不能使用[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest) (Ajax) 上传文件。您可以使用 iframe 或 Flash 模拟效果。优秀的[jQuery 表单插件](http://malsup.com/jquery/form/)，通过 iframe 发布您的文件以获得效果。

* * *

## 回答 #5

> 赞同：103
> 
> 时间：2014-08-25T14:17:29.217

为未来的读者总结。

# 异步文件上传

## 使用 HTML5

如果支持[FormData](https://developer.mozilla.org/en-US/docs/Web/Guide/Using_FormData_Objects)和[File API](https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications)（都是 HTML5 功能） ，您可以使用 jQuery 上传文件**。**`$.ajax()`

您也可以[在没有 FormData](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Submitting_forms_and_uploading_files)的情况下发送文件，但无论哪种方式，文件 API 都必须存在才能以可以使用*XMLHttpRequest* (Ajax) 发送文件的方式处理文件。

```
$.ajax({
  url: 'file/destination.html', 
  type: 'POST',
  data: new FormData($('#formWithFiles')[0]), // The form with the file inputs.
  processData: false,
  contentType: false                    // Using FormData, no need to process data.
}).done(function(){
  console.log("Success: Files sent!");
}).fail(function(){
  console.log("An error occurred, the files couldn't be sent!");
}); 
```

有关快速、纯 JavaScript（**无 jQuery**）的示例，请参阅“[使用 FormData 对象发送文件](https://developer.mozilla.org/en-US/docs/Web/Guide/Using_FormData_Objects#Sending_files_using_a_FormData_object)”。

## 倒退

当不支持 HTML5（没有*File API*）时，唯一的其他纯 JavaScript 解决方案（没有*Flash*或任何其他浏览器插件）是**隐藏 iframe技术，它允许在不使用***XMLHttpRequest*对象的情况下模拟异步请求。

它包括使用文件输入将 iframe 设置为表单的目标。当用户提交请求并上传文件时，响应显示在 iframe 内，而不是重新呈现主页。隐藏 iframe 使整个过程对用户透明并模拟异步请求。

如果处理得当，它几乎可以在任何浏览器上运行，但它有一些关于如何从 iframe 获取响应的警告。

在这种情况下，您可能更喜欢使用像[Bifröst](//github.com/matiasgagliano/bifrost)这样的包装器插件，它使用*iframe 技术*，但也提供[jQuery Ajax 传输](//api.jquery.com/jQuery.ajaxTransport)，允许使用以下方法**发送文件**`$.ajax()`：

```
$.ajax({
  url: 'file/destination.html', 
  type: 'POST',
  // Set the transport to use (iframe means to use Bifröst)
  // and the expected data type (json in this case).
  dataType: 'iframe json',                                
  fileInputs: $('input[type="file"]'),  // The file inputs containing the files to send.
  data: { msg: 'Some extra data you might need.'}
}).done(function(){
  console.log("Success: Files sent!");
}).fail(function(){
  console.log("An error occurred, the files couldn't be sent!");
}); 
```

## 插件

[Bifröst](//github.com/matiasgagliano/bifrost)只是一个小型包装器，它为 jQuery 的 ajax 方法添加了回退支持，但是前面提到的许多插件（如[jQuery Form Plugin](//malsup.com/jquery/form/)或[jQuery File Upload](//github.com/blueimp/jQuery-File-Upload)）包括从 HTML5 到不同回退的整个堆栈以及一些有用的功能来简化流程。根据您的需要和要求，您可能需要考虑裸实现或其中任何一个插件。

* * *

## 回答 #6

> 赞同：86
> 
> 时间：2011-07-29T00:34:20.920

这个[AJAX 文件上传 jQuery 插件](https://github.com/jfeldstein/jQuery.AjaxFileUpload.js)在某些地方上传文件，并将响应传递给回调，仅此而已。

*   它不依赖于特定的 HTML，只需给它一个`<input type="file">`
*   它不需要您的服务器以任何特定方式响应
*   使用多少文件或它们在页面上的位置都没有关系

-- 少用 --

```
$('#one-specific-file').ajaxfileupload({
  'action': '/upload.php'
}); 
```

——或多于——

```
$('input[type="file"]').ajaxfileupload({
  'action': '/upload.php',
  'params': {
    'extra': 'info'
  },
  'onComplete': function(response) {
    console.log('custom handler for file:');
    alert(JSON.stringify(response));
  },
  'onStart': function() {
    if(weWantedTo) return false; // cancels upload
  },
  'onCancel': function() {
    console.log('no file selected');
  }
}); 
```

* * *

## 回答 #7

> 赞同：63
> 
> 时间：2013-01-25T11:03:28.370

我一直在使用下面的脚本来上传恰好可以正常工作的图像。

# HTML

```
<input id="file" type="file" name="file"/>
<div id="response"></div> 
```

# JavaScript

```
jQuery('document').ready(function(){
    var input = document.getElementById("file");
    var formdata = false;
    if (window.FormData) {
        formdata = new FormData();
    }
    input.addEventListener("change", function (evt) {
        var i = 0, len = this.files.length, img, reader, file;

        for ( ; i < len; i++ ) {
            file = this.files[i];

            if (!!file.type.match(/image.*/)) {
                if ( window.FileReader ) {
                    reader = new FileReader();
                    reader.onloadend = function (e) {
                        //showUploadedItem(e.target.result, file.fileName);
                    };
                    reader.readAsDataURL(file);
                }

                if (formdata) {
                    formdata.append("image", file);
                    formdata.append("extra",'extra-data');
                }

                if (formdata) {
                    jQuery('div#response').html('<br /><img src="ajax-loader.gif"/>');

                    jQuery.ajax({
                        url: "upload.php",
                        type: "POST",
                        data: formdata,
                        processData: false,
                        contentType: false,
                        success: function (res) {
                         jQuery('div#response').html("Successfully uploaded");
                        }
                    });
                }
            }
            else
            {
                alert('Not a vaild image!');
            }
        }

    }, false);
}); 
```

# 解释

我使用响应`div`来显示上传动画和上传完成后的响应。

最好的部分是您可以在使用此脚本时随文件发送额外的数据，例如 ids 等。`extra-data`我已经在脚本中提到了它。

在 PHP 级别，这将像正常的文件上传一样工作。额外数据可以作为`$_POST`数据检索。

在这里，您没有使用插件和东西。您可以根据需要更改代码。您不是在这里盲目编码。这是任何 jQuery 文件上传的核心功能。实际上是Javascript。

* * *

## 回答 #8

> 赞同：53
> 
> 时间：2013-02-17T09:34:41.950

你可以很容易地在 vanilla JavaScript 中做到这一点。这是我当前项目的一个片段：

```
var xhr = new XMLHttpRequest();
xhr.upload.onprogress = function(e) {
    var percent = (e.position/ e.totalSize);
    // Render a pretty progress bar
};
xhr.onreadystatechange = function(e) {
    if(this.readyState === 4) {
        // Handle file upload complete
    }
};
xhr.open('POST', '/upload', true);
xhr.setRequestHeader('X-FileName',file.name); // Pass the filename along
xhr.send(file); 
```

* * *

## 回答 #9

> 赞同：48
> 
> 时间：2014-08-08T02:59:30.590

您可以简单地使用 jQuery 上传`.ajax()`。

HTML：

```
<form id="upload-form">
    <div>
        <label for="file">File:</label>
        <input type="file" id="file" name="file" />
        <progress class="progress" value="0" max="100"></progress>
    </div>
    <hr />
    <input type="submit" value="Submit" />
</form> 
```

CSS

```
.progress { display: none; } 
```

Javascript：

```
$(document).ready(function(ev) {
    $("#upload-form").on('submit', (function(ev) {
        ev.preventDefault();
        $.ajax({
            xhr: function() {
                var progress = $('.progress'),
                    xhr = $.ajaxSettings.xhr();

                progress.show();

                xhr.upload.onprogress = function(ev) {
                    if (ev.lengthComputable) {
                        var percentComplete = parseInt((ev.loaded / ev.total) * 100);
                        progress.val(percentComplete);
                        if (percentComplete === 100) {
                            progress.hide().val(0);
                        }
                    }
                };

                return xhr;
            },
            url: 'upload.php',
            type: 'POST',
            data: new FormData(this),
            contentType: false,
            cache: false,
            processData: false,
            success: function(data, status, xhr) {
                // ...
            },
            error: function(xhr, status, error) {
                // ...
            }
       });
    }));
}); 
```

* * *

## 回答 #10

> 赞同：45
> 
> 时间：2014-06-26T04:43:12.280

我过去做过的最简单和最可靠的方法是简单地将隐藏的 iFrame 标记与您的表单一起定位 - 然后它将在 iframe 内提交而无需重新加载页面。

也就是说，如果您不想使用插件、JavaScript 或 HTML 以外的任何其他形式的“魔法”。当然，你可以将它与 JavaScript 或你有什么结合起来......

```
<form target="iframe" action="" method="post" enctype="multipart/form-data">
    <input name="file" type="file" />
    <input type="button" value="Upload" />
</form>

<iframe name="iframe" id="iframe" style="display:none" ></iframe> 
```

您还可以读取 iframe 的内容以`onLoad`了解服务器错误或成功响应，然后将其输出给用户。

**Chrome、iFrame 和 onLoad**

*-注意-如果您对如何在上传/下载时设置 UI 阻止程序感兴趣，您只需要继续阅读*

目前，Chrome 在用于传输文件时不会触发 iframe 的 onLoad 事件。Firefox、IE 和 Edge 都会触发文件传输的 onload 事件。

我发现适用于 Chrome 的唯一解决方案是使用 cookie。

基本上在开始上传/下载时做到这一点：

*   [Client Side] 启动一个间隔来寻找cookie的存在
*   [服务器端] 对文件数据做任何你想做的事
*   [服务器端] 为客户端间隔设置 cookie
*   [客户端] Interval 看到 cookie 并像 onLoad 事件一样使用它。例如，您可以启动 UI 阻止程序，然后 onLoad（或在制作 cookie 时）删除 UI 阻止程序。

为此使用 cookie 很难看，但它确实有效。

我在下载时为 Chrome 制作了一个 jQuery 插件来处理这个问题，你可以在这里找到

[https://github.com/ArtisticPhoenix/jQuery-Plugins/blob/master/iDownloader.js](https://github.com/ArtisticPhoenix/jQuery-Plugins/blob/master/iDownloader.js)

同样的基本原则也适用于上传。

使用下载器（显然包括 JS）

```
 $('body').iDownloader({
     "onComplete" : function(){
          $('#uiBlocker').css('display', 'none'); //hide ui blocker on complete
     }
 });

 $('somebuttion').click( function(){
      $('#uiBlocker').css('display', 'block'); //block the UI
      $('body').iDownloader('download', 'htttp://example.com/location/of/download');
 }); 
```

在服务器端，就在传输文件数据之前，创建 cookie

```
 setcookie('iDownloader', true, time() + 30, "/"); 
```

插件会看到cookie，然后触发`onComplete`回调。

* * *

## 回答 #11

> 赞同：33
> 
> 时间：2009-08-13T22:44:39.223

[我已经在 Rails 环境中编写了这个](http://www.williambharding.com/blog/rails/rails-ajax-image-uploading-made-simple-with-jquery/)。如果你使用轻量级的 jQuery-form 插件，它只有大约五行 JavaScript。

挑战在于让 AJAX 上传工作，因为标准`remote_form_for`不理解多部分表单提交。它不会发送 Rails 通过 AJAX 请求返回的文件数据。

这就是 jQuery-form 插件发挥作用的地方。

这是它的 Rails 代码：

```
<% remote_form_for(:image_form, 
                   :url => { :controller => "blogs", :action => :create_asset }, 
                   :html => { :method => :post, 
                              :id => 'uploadForm', :multipart => true }) 
                                                                        do |f| %>
 Upload a file: <%= f.file_field :uploaded_data %>
<% end %> 
```

这是相关的 JavaScript：

```
$('#uploadForm input').change(function(){
 $(this).parent().ajaxSubmit({
  beforeSubmit: function(a,f,o) {
   o.dataType = 'json';
  },
  complete: function(XMLHttpRequest, textStatus) {
   // XMLHttpRequest.responseText will contain the URL of the uploaded image.
   // Put it in an image element you create, or do with it what you will.
   // For example, if you have an image elemtn with id "my_image", then
   //  $('#my_image').attr('src', XMLHttpRequest.responseText);
   // Will set that image tag to display the uploaded image.
  },
 });
}); 
```

这是 Rails 控制器动作，非常普通：

```
 @image = Image.new(params[:image_form])
 @image.save
 render :text => @image.public_filename 
```

在过去的几周里，我一直在用 Bloggity 使用它，它的工作就像一个冠军。

* * *

## 回答 #12

> 赞同：33
> 
> 时间：2013-06-26T01:12:21.447

Simple Ajax Uploader 是另一种选择：

[https://github.com/LPology/Simple-Ajax-Uploader](https://github.com/LPology/Simple-Ajax-Uploader)

*   跨浏览器 -- 适用于 IE7+、Firefox、Chrome、Safari、Opera
*   支持多个并发上传——即使在非 HTML5 浏览器中
*   没有 Flash 或外部 CSS——只有一个 5Kb Javascript 文件
*   对完全跨浏览器进度条的可选内置支持（使用 PHP 的 APC 扩展）
*   灵活且高度可定制——使用任何元素作为上传按钮，设置自己的进度指示器
*   不需要表格，只需提供一个元素作为上传按钮
*   MIT 许可证——在商业项目中免费使用

示例用法：

```
var uploader = new ss.SimpleUpload({
    button: $('#uploadBtn'), // upload button
    url: '/uploadhandler', // URL of server-side upload handler
    name: 'userfile', // parameter name of the uploaded file
    onSubmit: function() {
        this.setProgressBar( $('#progressBar') ); // designate elem as our progress bar
    },
    onComplete: function(file, response) {
        // do whatever after upload is finished
    }
}); 
```

* * *

## 回答 #13

> 赞同：32
> 
> 时间：2008-10-18T19:30:50.720

我发现的一个解决方案是让`<form>`目标隐藏 iFrame。然后 iFrame 可以运行 JS 向用户显示它已完成（在页面加载时）。

* * *

## 回答 #14

> 赞同：28
> 
> 时间：2016-03-30T16:48:31.517

这只是如何上传文件的另一种解决方案（**没有任何插件**）

使用简单的**Javascript**和**AJAX**（带进度条）

**HTML 部分**

```
<form id="upload_form" enctype="multipart/form-data" method="post">
    <input type="file" name="file1" id="file1"><br>
    <input type="button" value="Upload File" onclick="uploadFile()">
    <progress id="progressBar" value="0" max="100" style="width:300px;"></progress>
    <h3 id="status"></h3>
    <p id="loaded_n_total"></p>
</form> 
```

**JS部分**

```
function _(el){
    return document.getElementById(el);
}
function uploadFile(){
    var file = _("file1").files[0];
    // alert(file.name+" | "+file.size+" | "+file.type);
    var formdata = new FormData();
    formdata.append("file1", file);
    var ajax = new XMLHttpRequest();
    ajax.upload.addEventListener("progress", progressHandler, false);
    ajax.addEventListener("load", completeHandler, false);
    ajax.addEventListener("error", errorHandler, false);
    ajax.addEventListener("abort", abortHandler, false);
    ajax.open("POST", "file_upload_parser.php");
    ajax.send(formdata);
}
function progressHandler(event){
    _("loaded_n_total").innerHTML = "Uploaded "+event.loaded+" bytes of "+event.total;
    var percent = (event.loaded / event.total) * 100;
    _("progressBar").value = Math.round(percent);
    _("status").innerHTML = Math.round(percent)+"% uploaded... please wait";
}
function completeHandler(event){
    _("status").innerHTML = event.target.responseText;
    _("progressBar").value = 0;
}
function errorHandler(event){
    _("status").innerHTML = "Upload Failed";
}
function abortHandler(event){
    _("status").innerHTML = "Upload Aborted";
} 
```

**PHP部分**

```
<?php
$fileName = $_FILES["file1"]["name"]; // The file name
$fileTmpLoc = $_FILES["file1"]["tmp_name"]; // File in the PHP tmp folder
$fileType = $_FILES["file1"]["type"]; // The type of file it is
$fileSize = $_FILES["file1"]["size"]; // File size in bytes
$fileErrorMsg = $_FILES["file1"]["error"]; // 0 for false... and 1 for true
if (!$fileTmpLoc) { // if file not chosen
    echo "ERROR: Please browse for a file before clicking the upload button.";
    exit();
}
if(move_uploaded_file($fileTmpLoc, "test_uploads/$fileName")){ // assuming the directory name 'test_uploads'
    echo "$fileName upload is complete";
} else {
    echo "move_uploaded_file function failed";
}
?> 
```

[**这是示例应用程序**](https://github.com/SiddharthaChowdhury/Async-File-Upload-using-PHP-Javascript-AJAX)

* * *

## 回答 #15

> 赞同：26
> 
> 时间：2013-06-16T09:49:29.407

jQuery [Uploadify](http://www.uploadify.com/download/)是我之前用来上传文件的另一个好插件。JavaScript 代码很简单，如下所示：代码。但是，新版本无法在 Internet Explorer 中运行。

```
$('#file_upload').uploadify({
    'swf': '/public/js/uploadify.swf',
    'uploader': '/Upload.ashx?formGuid=' + $('#formGuid').val(),
    'cancelImg': '/public/images/uploadify-cancel.png',
    'multi': true,
    'onQueueComplete': function (queueData) {
        // ...
    },
    'onUploadStart': function (file) {
        // ...
    }
}); 
```

我做了很多搜索，我找到了另一种上传文件的解决方案，无需任何插件，仅使用 ajax。解决方案如下：

```
$(document).ready(function () {
    $('#btn_Upload').live('click', AjaxFileUpload);
});

function AjaxFileUpload() {
    var fileInput = document.getElementById("#Uploader");
    var file = fileInput.files[0];
    var fd = new FormData();
    fd.append("files", file);
    var xhr = new XMLHttpRequest();
    xhr.open("POST", 'Uploader.ashx');
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
             alert('success');
        }
        else if (uploadResult == 'success')
            alert('error');
    };
    xhr.send(fd);
} 
```

* * *

## 回答 #16

> 赞同：19
> 
> 时间：2015-07-28T13:39:10.987

```
var formData=new FormData();
formData.append("fieldname","value");
formData.append("image",$('[name="filename"]')[0].files[0]);

$.ajax({
    url:"page.php",
    data:formData,
    type: 'POST',
    dataType:"JSON",
    cache: false,
    contentType: false,
    processData: false,
    success:function(data){ }
}); 
```

You can use form data to post all your values including images.

* * *

## 回答 #17

> 赞同：18
> 
> 时间：2018-08-17T11:47:19.373

**没有 Jquery**的现代方法是使用当用户选择文件时返回的[FileList](https://developer.mozilla.org/en-US/docs/Web/API/FileList)对象`<input type="file">`，然后使用[Fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)发布包裹在[FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData)对象周围的 FileList。

```
// The input DOM element // <input type="file">
const inputElement = document.querySelector('input[type=file]');

// Listen for a file submit from user
inputElement.addEventListener('change', () => {
    const data = new FormData();
    data.append('file', inputElement.files[0]);
    data.append('imageName', 'flower');

    // You can then post it to your server.
    // Fetch can accept an object of type FormData on its  body
    fetch('/uploadImage', {
        method: 'POST',
        body: data
    });
}); 
```

* * *

## 回答 #18

> 赞同：15
> 
> 时间：2014-06-23T08:18:49.660

要使用 Jquery 异步上传文件，请使用以下步骤：

**第 1 步**在您的项目中打开 Nuget 管理器并添加包（jquery 文件上传（只需要在搜索框中写入它就会出现并安装它。））网址：[https ://github.com/blueimp/jQuery-File-上传](https://github.com/blueimp/jQuery-File-Upload)

**步骤 2**在 HTML 文件中添加以下脚本，这些脚本已经通过运行上述包添加到项目中：

> jquery.ui.widget.js
> 
> jquery.iframe-transport.js
> 
> jquery.fileupload.js

**步骤 3** 按照以下代码编写文件上传控件：

```
<input id="upload" name="upload" type="file" /> 
```

**第4步** 编写一个js方法作为uploadFile如下：

```
 function uploadFile(element) {

            $(element).fileupload({

                dataType: 'json',
                url: '../DocumentUpload/upload',
                autoUpload: true,
                add: function (e, data) {           
                  // write code for implementing, while selecting a file. 
                  // data represents the file data. 
                  //below code triggers the action in mvc controller
                  data.formData =
                                    {
                                     files: data.files[0]
                                    };
                  data.submit();
                },
                done: function (e, data) {          
                   // after file uploaded
                },
                progress: function (e, data) {

                   // progress
                },
                fail: function (e, data) {

                   //fail operation
                },
                stop: function () {

                  code for cancel operation
                }
            });

        }; 
```

**步骤 5**在准备好的函数调用元素文件上传以启动流程，如下所示：

```
$(document).ready(function()
{
    uploadFile($('#upload'));

}); 
```

**步骤 6**编写 MVC 控制器和操作，如下所示：

```
public class DocumentUploadController : Controller
    {       

        [System.Web.Mvc.HttpPost]
        public JsonResult upload(ICollection<HttpPostedFileBase> files)
        {
            bool result = false;

            if (files != null || files.Count > 0)
            {
                try
                {
                    foreach (HttpPostedFileBase file in files)
                    {
                        if (file.ContentLength == 0)
                            throw new Exception("Zero length file!");                       
                        else 
                            //code for saving a file

                    }
                }
                catch (Exception)
                {
                    result = false;
                }
            }

            return new JsonResult()
                {
                    Data=result
                };

        }

    } 
```

* * *

## 回答 #19

> 赞同：11
> 
> 时间：2016-07-19T05:18:34.047

[**您可以在此处**](http://whats-online.info/science-and-tutorials/30/select-preview-rename-and-upload-image-using-jquery-Ajax/)查看带有工作演示的已解决解决方案，它允许您预览表单文件并将其提交到服务器。对于您的情况，您需要使用[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)来方便文件上传到服务器：

```
<from action="" id="formContent" method="post" enctype="multipart/form-data">
    <span>File</span>
    <input type="file" id="file" name="file" size="10"/>
    <input id="uploadbutton" type="button" value="Upload"/>
</form> 
```

提交的数据是一个表单数据。在您的 jQuery 上，使用表单提交功能而不是单击按钮来提交表单文件，如下所示。

```
$(document).ready(function () {
   $("#formContent").submit(function(e){

     e.preventDefault();
     var formdata = new FormData(this);

 $.ajax({
     url: "ajax_upload_image.php",
     type: "POST",
     data: formdata,
     mimeTypes:"multipart/form-data",
     contentType: false,
     cache: false,
     processData: false,
     success: function(){

     alert("successfully submitted");

     });
   });
}); 
```

[查看更多详情](http://whats-online.info/science-and-tutorials/30/select-preview-rename-and-upload-image-using-jquery-Ajax/)

* * *

## 回答 #20

> 赞同：11
> 
> 时间：2016-10-14T07:17:46.247

示例：如果您使用 jQuery，您可以轻松上传文件。这是一个小巧而强大的 jQuery 插件，[http://jquery.malsup.com/form/](http://jquery.malsup.com/form/)。

### 例子

```
var $bar   = $('.ProgressBar');
$('.Form').ajaxForm({
  dataType: 'json',

  beforeSend: function(xhr) {
    var percentVal = '0%';
    $bar.width(percentVal);
  },

  uploadProgress: function(event, position, total, percentComplete) {
    var percentVal = percentComplete + '%';
    $bar.width(percentVal)
  },

  success: function(response) {
    // Response
  }
}); 
```

**我希望它会有所帮助**

* * *

## 回答 #21

> 赞同：10
> 
> 时间：2014-05-12T10:10:03.493

您可以使用

```
$(function() {
    $("#file_upload_1").uploadify({
        height        : 30,
        swf           : '/uploadify/uploadify.swf',
        uploader      : '/uploadify/uploadify.php',
        width         : 120
    });
}); 
```

[演示](http://www.uploadify.com/demos/)

* * *

## 回答 #22

> 赞同：9
> 
> 时间：2014-06-23T18:50:47.483

使用 |HTML5 的[readAsDataURL()](https://developer.mozilla.org/en-US/docs/Web/API/FileReader#readAsDataURL%28%29)或[一些 base64 编码器](http://scotch.io/quick-tips/js/how-to-encode-and-decode-strings-with-base64-in-javascript)将文件转换为 base64 。 [在这里提琴](http://jsfiddle.net/eliseosoto/JHQnk/)

```
var reader = new FileReader();

        reader.onload = function(readerEvt) {
            var binaryString = readerEvt.target.result;
            document.getElementById("base64textarea").value = btoa(binaryString);
        };

        reader.readAsBinaryString(file); 
```

然后检索：

```
window.open("data:application/octet-stream;base64," + base64); 
```

* * *

## 回答 #23

> 赞同：9
> 
> 时间：2015-11-03T20:47:25.147

这是我的解决方案。

```
<form enctype="multipart/form-data">    

    <div class="form-group">
        <label class="control-label col-md-2" for="apta_Description">Description</label>
        <div class="col-md-10">
            <input class="form-control text-box single-line" id="apta_Description" name="apta_Description" type="text" value="">
        </div>
    </div>

    <input name="file" type="file" />
    <input type="button" value="Upload" />
</form> 
```

和js

```
<script>

    $(':button').click(function () {
        var formData = new FormData($('form')[0]);
        $.ajax({
            url: '@Url.Action("Save", "Home")',  
            type: 'POST',                
            success: completeHandler,
            data: formData,
            cache: false,
            contentType: false,
            processData: false
        });
    });    

    function completeHandler() {
        alert(":)");
    }    
</script> 
```

控制器

```
[HttpPost]
public ActionResult Save(string apta_Description, HttpPostedFileBase file)
{
    [...]
} 
```

* * *

## 回答 #24

> 赞同：9
> 
> 时间：2018-11-14T12:42:19.587

您可以在使用 XMLHttpRequest（不依赖 flash 和 iframe）进行异步上传时传递附加参数和文件名。将附加参数值附加到 FormData 并发送上传请求。

* * *

```
var formData = new FormData();
formData.append('parameter1', 'value1');
formData.append('parameter2', 'value2'); 
formData.append('file', $('input[type=file]')[0].files[0]);

$.ajax({
    url: 'post back url',
    data: formData,
// other attributes of AJAX
}); 
```

* * *

此外，Syncfusion JavaScript UI 文件上传为这种场景提供了解决方案，只需使用事件参数。您可以在此处找到文档，并[在此处找到有关此控件的更多详细信息，在](https://ej2.syncfusion.com/documentation/uploader/how-to/#add-additional-data-on-upload)[此处](https://www.syncfusion.com/javascript-ui-controls/file-upload)输入链接描述

* * *

## 回答 #25

> 赞同：8
> 
> 时间：2015-07-08T17:59:34.517

在此处 异步查找*处理文件的上传过程：* [https ://developer.mozilla.org/en-US/docs/Using_files_from_web_applications](https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications)

来自链接的示例

```
<?php
if (isset($_FILES['myFile'])) {
    // Example:
    move_uploaded_file($_FILES['myFile']['tmp_name'], "uploads/" . $_FILES['myFile']['name']);
    exit;
}
?><!DOCTYPE html>
<html>
<head>
    <title>dnd binary upload</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript">
        function sendFile(file) {
            var uri = "/index.php";
            var xhr = new XMLHttpRequest();
            var fd = new FormData();

            xhr.open("POST", uri, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    // Handle response.
                    alert(xhr.responseText); // handle response.
                }
            };
            fd.append('myFile', file);
            // Initiate a multipart/form-data upload
            xhr.send(fd);
        }

        window.onload = function() {
            var dropzone = document.getElementById("dropzone");
            dropzone.ondragover = dropzone.ondragenter = function(event) {
                event.stopPropagation();
                event.preventDefault();
            }

            dropzone.ondrop = function(event) {
                event.stopPropagation();
                event.preventDefault();

                var filesArray = event.dataTransfer.files;
                for (var i=0; i<filesArray.length; i++) {
                    sendFile(filesArray[i]);
                }
            }
        }
    </script>
</head>
<body>
    <div>
        <div id="dropzone" style="margin:30px; width:500px; height:300px; border:1px dotted grey;">Drag & drop your file here...</div>
    </div>
</body>
</html> 
```

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2018-05-21T10:14:35.197

您可以通过 JavaScript使用**更新的** [Fetch API 。](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch)像这样：

```
function uploadButtonCLicked(){
    var input = document.querySelector('input[type="file"]')

    fetch('/url', {
      method: 'POST',
      body: input.files[0]
    }).then(res => res.json())   // you can do something with response
      .catch(error => console.error('Error:', error))
      .then(response => console.log('Success:', response));
} 
```

**优点：所有现代浏览器都原生****支持**Fetch API ，因此您无需导入任何内容。另外，请注意 fetch() 返回一个[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)，然后使用`.then(..code to handle response..)`异步处理该 Promise。

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2018-03-12T12:32:13.013

使用**HTML5**和**JavaScript**，上传异步非常容易，我与您的 html 一起创建上传逻辑，这并不能完全工作，因为它需要 api，但演示它是如何工作的，如果您`/upload`从网站的根目录调用端点，这段代码应该适合你：

```
const asyncFileUpload = () => {
  const fileInput = document.getElementById("file");
  const file = fileInput.files[0];
  const uri = "/upload";
  const xhr = new XMLHttpRequest();
  xhr.upload.onprogress = e => {
    const percentage = e.loaded / e.total;
    console.log(percentage);
  };
  xhr.onreadystatechange = e => {
    if (xhr.readyState === 4 && xhr.status === 200) {
      console.log("file uploaded");
    }
  };
  xhr.open("POST", uri, true);
  xhr.setRequestHeader("X-FileName", file.name);
  xhr.send(file);
}
```

```
<form>
  <span>File</span>
  <input type="file" id="file" name="file" size="10" />
  <input onclick="asyncFileUpload()" id="upload" type="button" value="Upload" />
</form>
```

还有一些关于 XMLHttpReques 的更多信息：

> **XMLHttpRequest 对象**
> 
> 所有现代浏览器都支持 XMLHttpRequest 对象。XMLHttpRequest 对象可用于在后台与 Web 服务器交换数据。这意味着可以更新网页的部分内容，而无需重新加载整个页面。

> **创建一个 XMLHttpRequest 对象**
> 
> 所有现代浏览器（Chrome、Firefox、IE7+、Edge、Safari、Opera）都有一个内置的 XMLHttpRequest 对象。
> 
> 创建 XMLHttpRequest 对象的语法：
> 
> 变量 = 新 XMLHttpRequest();

> **跨域访问**
> 
> 出于安全原因，现代浏览器不允许跨域访问。
> 
> 这意味着网页和它尝试加载的 XML 文件必须位于同一台服务器上。
> 
> W3Schools 上的示例都打开了位于 W3Schools 域中的 XML 文件。
> 
> 如果您想在您自己的网页之一上使用上面的示例，您加载的 XML 文件必须位于您自己的服务器上。

[有关更多详细信息，您可以在此处](https://www.w3schools.com/js/js_ajax_http.asp)继续阅读...

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2018-08-29T19:51:59.220

您可以使用 JavaScript 或 jQuery 进行异步多文件上传，而无需使用任何插件。您还可以在进度控件中显示文件上传的实时进度。我遇到了 2 个不错的链接 -

1.  [带有进度条的基于 ASP.NET Web 表单的多文件上传功能](http://www.yogihosting.com/multi-file-upload-with-progress-bar-in-asp-net/)
2.  [用 jQuery 制作的基于 ASP.NET MVC 的多文件上传](http://www.yogihosting.com/jquery-file-upload/)

服务器端语言是 C#，但您可以进行一些修改以使其与 PHP 等其他语言一起使用。

**文件上传 ASP.NET Core MVC：**

在 html 中查看创建文件上传控件：

```
<form method="post" asp-action="Add" enctype="multipart/form-data">
    <input type="file" multiple name="mediaUpload" />
    <button type="submit">Submit</button>
</form> 
```

现在在您的控制器中创建操作方法：

```
[HttpPost]
public async Task<IActionResult> Add(IFormFile[] mediaUpload)
{
    //looping through all the files
    foreach (IFormFile file in mediaUpload)
    {
        //saving the files
        string path = Path.Combine(hostingEnvironment.WebRootPath, "some-folder-path"); 
        using (var stream = new FileStream(path, FileMode.Create))
        {
            await file.CopyToAsync(stream);
        }
    }
} 
```

hostingEnvironment 变量属于 IHostingEnvironment 类型，可以使用依赖注入将其注入控制器，例如：

```
private IHostingEnvironment hostingEnvironment;
public MediaController(IHostingEnvironment environment)
{
    hostingEnvironment = environment;
} 
```

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2018-12-21T09:00:10.703

你也可以考虑使用类似[https://uppy.io](https://uppy.io)的东西。

它可以在不离开页面的情况下上传文件，并提供一些好处，如拖放、在浏览器崩溃/不稳定的网络时恢复上传以及从 Instagram 等导入。它是开源的，不依赖于 jQuery/React/Angular/Vue，但可以与它一起使用。免责声明：作为它的创造者，我有偏见；）

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2018-10-05T10:45:28.950

对于 PHP，请查找[https://developer.hyvor.com/php/image-upload-ajax-php-mysql](https://developer.hyvor.com/php/image-upload-ajax-php-mysql)

**HTML**

```
<html>
<head>
    <title>Image Upload with AJAX, PHP and MYSQL</title>
</head>
<body>
<form onsubmit="submitForm(event);">
    <input type="file" name="image" id="image-selecter" accept="image/*">
    <input type="submit" name="submit" value="Upload Image">
</form>
<div id="uploading-text" style="display:none;">Uploading...</div>
<img id="preview">
</body>
</html> 
```

**JAVASCRIPT**

```
var previewImage = document.getElementById("preview"),  
    uploadingText = document.getElementById("uploading-text");

function submitForm(event) {
    // prevent default form submission
    event.preventDefault();
    uploadImage();
}

function uploadImage() {
    var imageSelecter = document.getElementById("image-selecter"),
        file = imageSelecter.files[0];
    if (!file) 
        return alert("Please select a file");
    // clear the previous image
    previewImage.removeAttribute("src");
    // show uploading text
    uploadingText.style.display = "block";
    // create form data and append the file
    var formData = new FormData();
    formData.append("image", file);
    // do the ajax part
    var ajax = new XMLHttpRequest();
    ajax.onreadystatechange = function() {
        if (this.readyState === 4 && this.status === 200) {
            var json = JSON.parse(this.responseText);
            if (!json || json.status !== true) 
                return uploadError(json.error);

            showImage(json.url);
        }
    }
    ajax.open("POST", "upload.php", true);
    ajax.send(formData); // send the form data
} 
```

**PHP**

```
<?php
$host = 'localhost';
$user = 'user';
$password = 'password';
$database = 'database';
$mysqli = new mysqli($host, $user, $password, $database);

 try {
    if (empty($_FILES['image'])) {
        throw new Exception('Image file is missing');
    }
    $image = $_FILES['image'];
    // check INI error
    if ($image['error'] !== 0) {
        if ($image['error'] === 1) 
            throw new Exception('Max upload size exceeded');

        throw new Exception('Image uploading error: INI Error');
    }
    // check if the file exists
    if (!file_exists($image['tmp_name']))
        throw new Exception('Image file is missing in the server');
    $maxFileSize = 2 * 10e6; // in bytes
    if ($image['size'] > $maxFileSize)
        throw new Exception('Max size limit exceeded'); 
    // check if uploaded file is an image
    $imageData = getimagesize($image['tmp_name']);
    if (!$imageData) 
        throw new Exception('Invalid image');
    $mimeType = $imageData['mime'];
    // validate mime type
    $allowedMimeTypes = ['image/jpeg', 'image/png', 'image/gif'];
    if (!in_array($mimeType, $allowedMimeTypes)) 
        throw new Exception('Only JPEG, PNG and GIFs are allowed');

    // nice! it's a valid image
    // get file extension (ex: jpg, png) not (.jpg)
    $fileExtention = strtolower(pathinfo($image['name'] ,PATHINFO_EXTENSION));
    // create random name for your image
    $fileName = round(microtime(true)) . mt_rand() . '.' . $fileExtention; // anyfilename.jpg
    // Create the path starting from DOCUMENT ROOT of your website
    $path = '/examples/image-upload/images/' . $fileName;
    // file path in the computer - where to save it 
    $destination = $_SERVER['DOCUMENT_ROOT'] . $path;

    if (!move_uploaded_file($image['tmp_name'], $destination))
        throw new Exception('Error in moving the uploaded file');

    // create the url
    $protocol = stripos($_SERVER['SERVER_PROTOCOL'],'https') === true ? 'https://' : 'http://';
    $domain = $protocol . $_SERVER['SERVER_NAME'];
    $url = $domain . $path;
    $stmt = $mysqli -> prepare('INSERT INTO image_uploads (url) VALUES (?)');
    if (
        $stmt &&
        $stmt -> bind_param('s', $url) &&
        $stmt -> execute()
    ) {
        exit(
            json_encode(
                array(
                    'status' => true,
                    'url' => $url
                )
            )
        );
    } else 
        throw new Exception('Error in saving into the database');

} catch (Exception $e) {
    exit(json_encode(
        array (
            'status' => false,
            'error' => $e -> getMessage()
        )
    ));
} 
```

* * *

## 回答 #31

> 赞同：5
> 
> 时间：2019-07-05T10:31:57.160

尝试

```
async function saveFile() 
{
    let formData = new FormData();           
    formData.append("file", file.files[0]);
    await fetch('addFile.do', {method: "POST", body: formData});    
    alert("Data Uploaded: ");
}
```

```
<span>File</span>
<input type="file" id="file" name="file" size="10"/>
<input type="button" value="Upload" onclick="saveFile()"/>
```

由`content-type='multipart/form-data'`浏览器自动设置，文件名也自动添加到`filename`FormData 参数中（并且服务器可以轻松读取）。这是带有错误处理和 json 添加的更发达的示例

```
async function saveFile(inp) 
{
    let user = { name:'john', age:34 };
    let formData = new FormData();
    let photo = inp.files[0];      

    formData.append("photo", photo);
    formData.append("user", JSON.stringify(user));  

    try {
       let r = await fetch('/upload/image', {method: "POST", body: formData}); 
       console.log('HTTP response code:',r.status); 
       alert('success');
    } catch(e) {
       console.log('Huston we have problem...:', e);
    }

}
```

```
<input type="file" onchange="saveFile(this)" >
<br><br>
Before selecting the file Open chrome console > network tab to see the request details.
<br><br>
<small>Because in this example we send request to https://stacksnippets.net/upload/image the response code will be 404 ofcourse...</small>
```

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2018-02-21T14:41:37.837

这是一个老问题，但仍然没有答案正确答案，所以：

你试过[jQuery-File-Upload](https://github.com/blueimp/jQuery-File-Upload/wiki/Submit-files-asynchronously)吗？

这是上面链接中的一个示例，它可能会解决您的问题：

```
$('#fileupload').fileupload({
    add: function (e, data) {
        var that = this;
        $.getJSON('/example/url', function (result) {
            data.formData = result; // e.g. {id: 123}
            $.blueimp.fileupload.prototype
                .options.add.call(that, e, data);
        });
    } 
}); 
```

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2019-04-08T12:14:53.650

您可以使用以下代码。

```
async: false(true) 
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2020-02-28T15:06:49.697

如果使用哪些 ajax 的 promises 并检查文件是否有效并且保存在您的后端，那么您可以在用户浏览您的页面时在前面使用一些动画。

您甚至可以使用递归方法使其并行上传或堆叠

# virtual-server - 无法在 Virtual Server 2005 上合并撤消磁盘

> ID：166226
> 
> 赞同：0
> 
> 时间：2008-10-03T10:24:42.007
> 
> 标签：virtual-server

错误消息：“虚拟服务器无法提交在“”的当前会话期间所做的更改。此问题的可能原因是父虚拟硬盘无法打开以进行读/写，或者它可能正在使用中，或者用户已没有读/写/修改权限。撤消磁盘中的数据被保留。

我可以启动该虚拟机，对其进行操作，它会被保存，但是当我尝试覆盖撤消磁盘时，我会收到此消息。**如何检查我是否具有覆盖撤消磁盘所需的权限？**当然我是先关掉虚拟机，然后尝试用那种方式发起“Merge Undo Disks”操作，所以我不认为虚拟硬盘被锁定了。

更新：可以重命名虚拟硬盘文件，因此没有锁定该文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-04T12:58:40.340

曾经也看过这个。

这是一个感谢[Kurt Guenther](http://home.infusionblogs.com/kguenther/archive/2006/06/20/virtual-server-undo-disks-i-am-never-going-to-use-you-again-cant-merge-disks-parent-disk-is-a-part-of-a-saved-state.aspx)的解决方案。

1.  将撤消磁盘重命名为 *.vhd。这将它们变成了虚拟服务器眼中的虚拟驱动器。
2.  单击虚拟服务器的虚拟磁盘部分中的检查选项。应该有一个选项可以合并磁盘。
3.  选择要合并的新磁盘。如果您尝试合并到原始父级，虚拟服务器只会再次给您上述错误。
4.  取出新合并的虚拟磁盘并在虚拟机中替换它（即替换之前无法合并的父级）。

在开始此过程之前，请确保您有足够的磁盘空间。

# user-interface - Tcl/Tk 例子？

> ID：166231
> 
> 赞同：12
> 
> 时间：2008-10-03T10:25:17.827
> 
> 标签：user-interface, scripting, tcl, tk

[Tcl/Tk](http://en.wikipedia.org/wiki/Tcl)是编写小型 GUI 脚本的简单方法。

任何人都可以举一个带有*按钮*和*文本*小部件的好例子。当按下按钮时，应该执行一个 shell 命令并将输出通过管道传输到*文本*小部件。

如果您有其他漂亮且干净的有用任务示例，请也添加它们。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-05T14:27:23.613

这是使用文件事件的更完整示例。这将一直自动滚动。出于可用性目的，您可能只想在文本底部可见时自动滚动（即：如果用户没有移动滚动条），但我将把它作为练习留给读者，以保持这个已经很长的例子从得到任何时间。

```
package require Tk

proc main {} {
    if {[lsearch -exact [font names] TkDefaultFont] == -1} {
        # older versions of Tk don't define this font, so pick something
        # suitable
        font create TkDefaultFont -family Helvetica -size 12
    }
    # in 8.5 we can use {*} but this will work in earlier versions
    eval font create TkBoldFont [font actual TkDefaultFont] -weight bold

    buildUI
}

proc buildUI {} {
    frame .toolbar
    scrollbar .vsb -command [list .t yview]
    text .t \
        -width 80 -height 20 \
        -yscrollcommand [list .vsb set] \
        -highlightthickness 0
    .t tag configure command -font TkBoldFont
    .t tag configure error   -font TkDefaultFont -foreground firebrick
    .t tag configure output  -font TkDefaultFont -foreground black

    grid .toolbar -sticky nsew
    grid .t .vsb  -sticky nsew
    grid rowconfigure . 1 -weight 1
    grid columnconfigure . 0 -weight 1

    set i 0
    foreach {label command} {
        date     {date} 
        uptime   {uptime} 
        ls       {ls -l}
    } {
        button .b$i -text $label -command [list runCommand $command]
        pack .b$i -in .toolbar -side left
        incr i
    }
}

proc output {type text} {
    .t configure -state normal
    .t insert end $text $type "\n"
    .t see end
    .t configure -state disabled
}

proc runCommand {cmd} {
    output command $cmd
    set f [open "| $cmd" r]
    fconfigure $f -blocking false
    fileevent $f readable  [list handleFileEvent $f]
}

proc closePipe {f} {
    # turn blocking on so we can catch any errors
    fconfigure $f -blocking true
    if {[catch {close $f} err]} {
        output error $err
    }
}

proc handleFileEvent {f} {
    set status [catch { gets $f line } result]
    if { $status != 0 } {
        # unexpected error
        output error $result
        closePipe $f

    } elseif { $result >= 0 } {
        # we got some output
        output normal $line

    } elseif { [eof $f] } {
        # End of file
        closePipe $f

    } elseif { [fblocked $f] } {
        # Read blocked, so do nothing
    }
}

main 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T13:50:11.867

一些建议：

要将输出附加到**文本**小部件，而不是指定第 999999 行，您可以使用索引**end**，它指的是最后一个换行符之后的位置。例如，

```
.main insert end "$x\n" 
```

要在命令输出时滚动文本，请使用**see**命令。例如，在附加到 .main 文本小部件之后

```
.main see end 
```

您可能还需要考虑使用**fileevent**命令异步获取命令输出。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T10:30:22.043

我可以开始...请提出改进​​建议。即我希望它在命令输出时滚动

```
#!/usr/bin/wish

proc push_button {} {
    put_text
    .main see end
}

proc put_text {} {
  set f [ open "| date" r]
  while {[gets $f x] >= 0} {
    .main insert end "$x\n"    
  }
  catch {close $f}
}

button .but -text "Push Me" -command "push_button"
text .main -relief sunken -bd 2 -yscrollcommand ".scroll set"
scrollbar .scroll -command ".main yview"

pack .but
pack .main -side left -fill y
pack .scroll -side right -fill y 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-28T10:27:13.993

[wiki.tcl.tk](http://wiki.tcl.tk/)是各种[示例的好网站](http://wiki.tcl.tk/1291)

# sql-server-2005 - 如何从 bat 文件远程运行 DTSX 包？

> ID：166239
> 
> 赞同：3
> 
> 时间：2008-10-03T10:27:32.203
> 
> 标签：sql-server-2005, ssis

我正在尝试使用以下命令从 bat 文件远程运行 DTSX 包：

```
DTEXEC /DTS "\File System\MY_PACKAGE_NAME" /SERVER MY_SERVER_NAME /MAXCONCURRENT " -1 " /CHECKPOINTING OFF  /REPORTING V 
```

这在本地工作正常，但远程失败（我在我指向的机器上拥有管理员权限，并且我也有 SQL 权限）我收到超时错误（登录超时已过期）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T13:39:49.733

这是非常有可能的，而且非常容易。不需要存储过程、SQL 代理、Web 或 .NET 开发。我很惊讶微软从未提出过这个建议：

1.  在 SQL Server 上安排任务以运行 DTSX 包。禁用它，这样它就不会运行，直到您从远程 PC 手动执行它。
2.  使用以下命令从 PC 执行任务：

> schtasks /run /tn MyTask [/s MySQLServer [/u [domain]user /p password]] /?

注意：如果您不喜欢暴露密码，请使用“PSEXEC”命令执行“schtasks”命令（从[http://technet.microsoft.com/en-us/sysinternals/bb897553 下载免费且功能强大的工具。 aspx](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-04T19:00:09.960

经过一番研究，似乎无法远程运行 DTEXEC（它需要在本地运行 - 不支持远程执行）。

为了克服这一限制，似乎广泛实施了以下方法：

1.  设置 SQL 作业以运行 DTSX 包
2.  设置存储过程来运行作业
3.  在 BAT 文件（远程执行）中使用 isql 命令行在相关 SQL 实例上运行存储过程（使用 SQL 凭据而不是机器凭据）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T21:58:27.423

SSIS 还在托管服务器上公开了一个 Web 服务。您可以通过代码，查询机器以获取包，通过数据库或文件系统运行包，并通过您喜欢的任何编程平台以编程方式添加/修改包的变量。

话虽如此，您还可以设置您的网络服务来调用包含您的“DETEXEC”命令的本地批处理文件。

# nsis - 如何在 NSIS 安装脚本中创建一个常量数组？

> ID：166256
> 
> 赞同：1
> 
> 时间：2008-10-03T10:33:06.827
> 
> 标签：nsis

我有大量的 NSIS 安装脚本（.nsi 文件），它们简单地定义了一堆常量，然后主安装程序逻辑驻留在每个安装程序通用的包含文件（.nsh）中。其中一个包含文件如下所示：

```
!ifdef ABC_SUBFOLDER
    RMDir /r "$ABCPath\Data\${ABC_SUBFOLDER}"
    SetOutPath "$ABCPath\Data\${ABC_SUBFOLDER}"
    File /r "${LOCAL_FOLDER}\ABC\${ABC_SUBFOLDER}\*.*"
!endif

!ifdef ABC_SUBFOLDER2
    RMDir /r "$ABCPath\Data\${ABC_SUBFOLDER2}"
    SetOutPath "$ABCPath\Data\${ABC_SUBFOLDER2}"
    File /r "${LOCAL_FOLDER2}\ABC\${ABC_SUBFOLDER2}\*.*"
!endif

!ifdef ABC_SUBFOLDER3
    RMDir /r "$ABCPath\Data\${ABC_SUBFOLDER3}"
    SetOutPath "$ABCPath\Data\${ABC_SUBFOLDER3}"
    File /r "${LOCAL_FOLDER3}\ABC\${ABC_SUBFOLDER3}\*.*"
!endif 
```

...等等最多 15 个子文件夹，这些子文件夹可能会或可能不会在顶级 .nsi 文件中定义。我的问题是，每次我需要增加要支持的子文件夹的数量时，NSIS 中是否有更好的语法来实现这一点而无需剪切和粘贴？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T10:40:38.433

您可以使用 ${${VAR}} 根据另一个变量的值访问不同的变量。例如

```
RMDir /r "$ABCPath\Data\${ABC_SUBFOLDER${FOLDERNUMBER}}" 
```

# c# - 如何在全局程序集缓存中配置程序集？

> ID：166258
> 
> 赞同：0
> 
> 时间：2008-10-03T10:34:02.550
> 
> 标签：c#, gac

有没有办法在 GAC 中配置程序集？我想使用 System.Configuration 向我的程序集添加自定义配置。

默尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T11:24:14.150

如果我正确理解你的问题，不，没有办法做到这一点。

程序集使用加载它的应用程序的配置文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T01:15:25.443

在标准 .NET 框架中没有简单的方法可以做到这一点。如果您使用[企业库](http://www.microsoft.com/downloads/details.aspx?familyid=90DE37E0-7B42-4044-99BE-F8ECFBBC5B65&displaylang=en "企业库4.0下载")配置组件，FileConfigurationSource 类将允许您将配置文件定位到另一个位置。还有一种偷偷摸摸的方法可以使用标准 ConfigurationManager 的 OpenExeConfiguraion 方法来执行此操作。我在我的博客上写了一篇名为[为配置对象创建虚拟目标](http://underground.infovark.com/2008/08/13/creating-dummy-targets-for-configuration-objects/)的文章，描述了它是如何完成的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T13:25:04.037

根据您尝试实现的场景，您可以将 App.config 文件作为嵌入式资源包含在内，并在需要时提取到磁盘上的某个位置并使用针对[此问题](https://stackoverflow.com/questions/163803/how-do-i-select-a-net-application-configuration-file-from-a-command-line-parame)的建议进行加载。

*显然，这消除了在不重新编译的情况下实际更改*配置的能力，因此有点违背了目的。

另一种选择可能是将配置文件安装到`Application Data`or`Common Application Data`文件夹中，并使用与上述相同的技术。

# oracle - 带有 OraOLE DB 提供程序的 Oracle 即时客户端？

> ID：166270
> 
> 赞同：4
> 
> 时间：2008-10-03T10:37:09.940
> 
> 标签：oracle, oledb, driver

是否可以将 oracle 即时客户端用于使用 oraoledb 驱动程序连接到 oracle 9i DB 的应用程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T01:11:20.070

我不相信。Instant [Client 常见问题解答](http://www.oracle.com/technology/tech/oci/instantclient/ic-faq.html#A3661)指出

> Instant Client 可以用来做什么？Instant Client 可用于运行您的 OCI、OCCI、Pro *C、JDBC 和 ODBC 应用程序，而无需安装完整的 Oracle 客户端。此外，Instant Client 还支持 SQL* Plus。从 Instant Client 10.2 开始，还可以使用 Instant Client SDK 下载为 OCI 和 OCCI 开发应用程序。

OLE DB 明显不在该列表中。现在，您可能会使用 Microsoft OLE DB 到 ODBC 提供程序以及 Instant Client 和 ODBC，但是向软件添加额外的层从来都不是很有趣。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2018-04-20T17:01:58.493

我认为这是可能的。查找[Oracle 数据访问组件 (ODAC)](http://www.oracle.com/technetwork/database/windows/downloads/utilsoft-087491.html)。我已经下载了*ODAC XCopy 版本*，然后：

1.  解压到某个 tmp 文件夹
2.  以管理员身份打开cmd
3.  运行 install.bat （我已经运行了`install oledb c:\oracle\odac_12_1 odac true`：）

尽管在这个脚本上，命令`regsvr32`（`oraoledb12.dll`在我的例子中注册 ）没有工作。但是在脚本工作后运行这个命令。还要检查 PATH 变量，因为脚本只能在提示会话中更改它。

现在我可以使用*OraOLEDB.Oracle 提供程序*和*Oracle Instant Client*连接到 Oracle DB 。

# silverlight - 动态禁用 EventTrigger\Storyboard

> ID：166295
> 
> 赞同：1
> 
> 时间：2008-10-03T10:43:10.630
> 
> 标签：silverlight

```
<Grid.Triggers>
    <EventTrigger RoutedEvent="Border.Loaded">
            <EventTrigger.Actions >
                    <BeginStoryboard>
                            <Storyboard x:Name="MyStoryboard"    AutoReverse="True" RepeatBehavior="Forever">
                                  <ColorAnimationUsingKeyFrames    BeginTime="00:00:00"  Storyboard.TargetName="border" Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)">
                                       <SplineColorKeyFrame KeyTime="00:00:01" Value="#FFFAFAFA"/>
                                  </ColorAnimationUsingKeyFrames>
                            </Storyboard>
                    </BeginStoryboard>
            </EventTrigger.Actions>
    </EventTrigger>
</Grid.Triggers> 
```

如何动态启用\禁用此事件触发器\动画。我在想我可以绑定到 IValueConverter 并禁用情节提要，但似乎没有任何合适的属性可以绑定？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T11:44:42.897

Silverlight 目前唯一可用的触发器是“已加载”，对于所有其他事件，您必须编写一些代码。要使用这种技术，Storyboards 应该放在 Resources 部分而不是 Triggers 中，并且您将从代码中调用 Storyboard 上的 Begin()。

如果您正在对控件进行模板化，那么就有所谓的转换，它可以让您根据控件事件启动情节提要，例如 MouseOver。这由 Visual State Manager 处理：

[http://timheuer.com/blog/archive/2008/06/04/silverlight-introduces-visual-state-manager-vsm.aspx](http://timheuer.com/blog/archive/2008/06/04/silverlight-introduces-visual-state-manager-vsm.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T00:10:38.080

您无法使用 Silverlight 中的触发器执行您所要求的操作。没有办法在触发器中有条件。您可以连接 Loaded 事件，在那里检查您的条件，如果满足，则启动情节提要。但是，不存在仅 XAML 的等效项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T11:59:07.550

我并不是真的在寻找基于事件关闭的动画。我想根据我绑定的业务对象的属性来做这件事吗？我希望有像 Storyboard.Enabled = False 之类的东西！？！？！

# sdk - JDK和Java SDK的区别

> ID：166298
> 
> 赞同：89
> 
> 时间：2008-10-03T10:44:22.937
> 
> 标签：sdk, java

这两个术语之间有什么实质性区别吗？我了解 JDK 代表 Java Development Kit，它是 SDK（软件开发工具包）的子集。但是指定Java SDK，应该和JDK一样。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-10-03T10:48:45.047

从这个[维基百科条目](http://en.wikipedia.org/wiki/Java_Development_Kit#Ambiguity_between_a_JDK_and_an_SDK)：

> JDK 是广义上松散定义为软件开发工具包 (SDK) 的子集。在最近发布的 Java SE、EE 和 ME 的描述中，Sun 承认根据他们的术语，JDK 构成了负责编写和运行 Java 程序的 SDK 的子集。SDK 的其余部分由额外的软件组成，例如应用程序服务器、调试器和文档。

“额外软件”似乎是 Glassfish、MySQL 和 NetBeans。[此页面](http://java.sun.com/javaee/downloads/index.jsp)比较了您可以为 Java EE SDK 获得的各种包。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2014-06-13T15:14:53.867

是的，SDK 和 JDK 之间是有区别的。大多数人忘记了Java平台不仅用于开发Java语言程序。JVM 还支持一些其他语言。因此，明确地说，SDK 是通用的软件捆绑包，支持使用各种语言（如 Clojure、Groovy、Scala、JRuby 等）创建软件。JDK 是用 Java 语言开发软件的特定捆绑包，包含所有 Java 标准 API。（我希望我解释得很好，因为我实际上不会说英语）

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2016-03-22T12:44:09.733

JDK 是 Java 的 SDK。

SDK 代表“软件开发工具包”，一种开发人员工具，使人们能够更轻松、更有效、更高效地编写代码。SDK 适用于各种语言。它们提供了大量的 API（应用程序编程接口），使程序员的工作变得轻松。

[![在此处输入图像描述](https://i.stack.imgur.com/TO6NR.png)](https://i.stack.imgur.com/TO6NR.png)

Java 的 SDK 称为 JDK，即 Java 开发工具包。因此，通过说 SDK for Java，您实际上是指 JDK。

假设您是 Java 新手，您会遇到另一个术语 - JRE，Java Runtime Environment 的首字母缩写。当您尝试运行用 Java 编写的软件程序时，您需要 JRE。

Java 是一种独立于平台的语言。JRE 运行 JVM，即 Java 虚拟机，使您能够在 JVM 可用的任何平台上运行软件。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-03-17T13:11:31.073

取自 Java EE 6 SDK Installer，显示了 SDK 6 除了 JDK 还包含哪些内容：

![SDK 6 包含什么，除了 JDK](https://i.stack.imgur.com/gdLWY.png)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-03T10:47:32.227

孙只是喜欢无缘无故地更改事物的名称。查看 SunOS/Solaris 的三种不同编号方案，或 Java 的两种编号方案。是 Java 1.6、Java 2 版本 6 还是 Java 6？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-11-09T08:10:14.003

JDK（Java 开发工具包）是一个 SDK（软件开发工具包）。

它用于在 Java 上构建软件/应用程序，当然它包括 JRE（Java 运行时版）来执行该软件。如果您只想执行 Java 应用程序，只需下载 JRE。

顺便说一句，Java EE（企业版）包含“带有方法（功能）”的类包库，用于为 WEB 环境和 Java ME（微型版）构建移动设备的应用程序。如果您对它（Java ME）感兴趣，我建议您看看 Google 的 Android DevKit 和 API。

看看这里：它会解释更多.. [http://www.oracle.com/technetwork/java/archive-139210.html](http://www.oracle.com/technetwork/java/archive-139210.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-04-09T07:34:59.043

**JDK 附带了一组用于开发和运行 Java 程序的工具**，

它们包括：

1.  appletviewer（用于查看 Java 小程序）

2.  javac (Java 编译器)

3.  java（Java 解释器）

4.  javap（Java反汇编程序）

5.  javah（用于 C 头文件）

6.  javadoc（用于创建 HTML 文档）

7.  jdb (Java 调试器)

**然而，SDK 附带了许多其他工具，包括 JDK 中可用的工具。**

[http://parvindersingh.webs.com/apps/forums/topics/show/8853125-solved-java-difference-between-jdk-and-sdk-](http://parvindersingh.webs.com/apps/forums/topics/show/8853125-solved-java-difference-between-jdk-and-sdk-)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-03T10:47:03.163

JDK 和 Java SDK 之间没有区别。两者的意思是一样的。我认为从 JDK 转换到 Java SDK 是 Sun 的公关决定。我认为它现在回到 JDK。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-01-10T08:01:39.170

在我看来，Java 中的 JDK 和 SDK 没有区别。我们可以在它们中找到所有的开发工具和设施。它只是 sun 提供的别名。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-02-15T13:13:38.157

这个问题的最佳示例，SDK - 软件开发工具包 - 例如：Netbeans JDK - Java 开发工具包。（这是 Java 编译器）。没有 JDK，我们无法在 SDK 中运行 java 程序。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-12-06T12:58:49.427

没有区别。

Java 软件开发工具包 (Java SDK) 曾经被称为 Java 开发工具包 (JDK)，在 Sun 的营销部门对“tm”和术语感到疯狂之前。出于政治原因和理智，他们将有意义的名称 (jdk) 和版本 (1.2 / 1.3 / 1.4 1.5 / 1.6) 称为“工程”术语。营销术语是“Java2 平台”（又名 jdk 1.2 到 1.4）或 Java5（又名 jdk 1.5）或 Java6（又名 jdk1.6）。光是想想就头疼。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-03T10:47:01.340

我最初的猜测是 Java SDK 用于构建 JVM，而 JDK 用于构建 JVM 应用*程序*。

编辑：虽然目前这看起来不正确。Sun 正在对 JVM 进行开源（也许他们现在已经完成了），所以如果我的答案确实正确，我不会太惊讶……但目前，SDK 和 JDK 是一回事。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-04-26T10:45:49.853

我认为 jdk 具有某些可以与特定框架一起使用的功能。好吧，将其作为一个整体称为 SDK。

像 Android 或 Blackberry 一样，它们都使用 java 及其框架。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-03-06T14:30:31.817

*   **JDK**是您需要的`write a java program`。

*   **JRE**是您需要的`run a java program`。

*   由于JDK `contains`JRE 可以下载JDK 来编写和运行java 程序。

*   JRE 包含**JVM**，只要 JVM 安装在该操作系统上，Java 程序就可以在任何平台上运行（无需为其他平台重新编写或重新编译代码）。这就是为什么 Java 被称为

> `Write Once(compile once) run anywhere.(WORA)`

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-10-03T11:08:03.620

有两种产品JavaSE 和JavaEE。EE是允许Web应用程序开发和运行的Web应用程序/企业版。SE 是纯 Java 产品，其中没有 EE 细节，但它是 EE 的一个子集。SE 有两种类型，JDK 和 JRE。

有一个很大的区别可能并不明显，我不确定它是否适用于所有操作系统，但是在 Windows 下，JRE 没有服务器 HotSpot JVM，只有客户端，JDK 两者都有，而且就我知道所有其他操作系统都有 JDK 和 JRE。真正的区别是JDK包含Java编译器，即JDK允许您从源代码编译和运行Java，而JRE只允许运行Java字节码，即已经编译的Source。是的，较新的版本捆绑了许多额外的组件，例如 NetBeans 编辑器环境和 Java 内存数据库 (derby/cloudscape)，但这些都是可选的。

# jquery - jQuery slideToggle 左右跳跃

> ID：166299
> 
> 赞同：11
> 
> 时间：2008-10-03T10:44:28.473
> 
> 标签：jquery

我在网站上使用 jQuery slideToggle 函数来显示有关某事的“更多信息”。当我触发幻灯片时，内容逐渐显示出来，但位于右侧约 100 像素，直到动画结束时突然跳转到正确的位置。反过来说，内容在开始“隐藏”动画之前会以相同的量跳跃，然后逐渐隐藏。

出现在 IE7/8、FF、Chrome 上。

关于如何解决这个问题的任何想法？

提前致谢。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-04T08:33:44.233

我找到了解决方法，但我仍然不确定细节。似乎当jQuery添加'overflow：hidden'样式时，附近浮动元素的效果发生了变化。解决方法是在 slideToggle 的 div 上放置一个永久的“溢出：隐藏”，以及一个负边距来平衡效果。

我很惊讶更改溢出值对布局有这样的影响，但是你有它......

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-03T14:50:01.713

这只是在黑暗中拍摄，但是如果该函数正在操纵元素的高度 css 属性，则根据[此站点](http://jqueryfordesigners.com/animation-jump-quick-tip/)，您必须在 css 中分离填充和 display:none 以防止其跳跃

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-09-15T18:54:20.180

通过添加到切换的 div 来解决：

```
overflow: hidden; position: relative; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-05T18:01:31.310

您的文档是否包含任何 DOCTYPE 声明？没有它，某些浏览器会以“quirck”模式呈现页面，这并不总是会导致您期望的结果..

看[这里](http://www.communitymx.com/content/article.cfm?cid=85fee)

为确保您的页面按预期呈现，请将以下声明添加到页面顶部（即 html 标记之前）。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-06-23T17:34:31.423

设置要滑动的组件的高度/宽度可修复一个导致“跳跃”的错误，使用类似 ( [reference](http://api.jquery.com/slideToggle/#comment-76397516) ) 的行：

```
$('#slider').css('height', $('#slider').height() + 'px'); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-12T23:47:01.973

我有这个完全相同的问题，但只有当隐藏元素是`<div>`. 我尝试了此页面上的所有内容，但唯一有效的是使用`overflow:hidden;`.

但是使用的问题`overflow:hidden;`是段落元素创建的上下间距突然被删除，从而使布局变得丑陋。

我将隐藏元素从 a 更改`<div>`为 a`<p>`并删除了`overflow:hidden;`... 它在没有弄乱布局的情况下工作，并且跳跃问题没有返回。

**编辑：**

在一个新网站上，我决定使用隐藏`<div>`，我发现了一些关于这个问题的事情......

1) 当`div`包含`p`或`ul`类似时发生跳跃。

2) 当`div`仅包含文本、`a`链接和/或图像时，没有跳跃动画。

3）从隐藏的元素中删除所有边距和填充`div`可以解决问题。可以添加换行符之类的其他内容来弥补填充和边距的不足......虽然不理想，但动画再次变得流畅。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-06-20T20:39:53.153

我遇到了同样的问题`.slideToggle`，BenAdler 是对的。将您想要切换的所有内容放在一个 div 中，并将 div 的样式设置为包含`overflow:hidden`and的内容`position: relative`。之后它会正常工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-03T14:52:19.180

尝试弄乱元素的定位/显示/浮动方式。我遇到过类似的问题，这些问题通过使用这些设置得到了解决。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-16T15:21:49.203

我遇到了同样的错误，通过使用 `position: relative; width: 709px;` 固定宽度定位元素解决了这个问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-12-14T04:21:50.910

你可以使用这样的结构：

```
<div class="details">
    <div class="hidden"> [your toggled info] </div>
</div> 
```

在你的 CSS 中

```
.details{
    position:relative;
}
.hidden{
    display:none;
} 
```

我想就是这样。

您的 jquery 调用必须是：

```
$('.hidden').slideToggle("slow"); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-07-19T13:06:08.260

只是为了分享一个对我有用的解决方案。

我正在为我正在处理的网站使用响应式布局，并且基本上在我的布局中的一个列上使用slidetoggle，上面唯一有效的解决方案是为我的内容设置固定宽度 - 但是由于列宽是动态的，这是对我来说不是解决方案。

将我想要切换的内容包装起来`<div>`，然后在新的内容上使用滑动切换`div`似乎可以解决问题。尝试添加`position:relative`到您尝试滑动切换的原始元素。

是的，这确实增加了可怕的不必要的标记，但这是我让它工作的唯一方法。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-06-19T20:25:44.887

添加 CSS3 转换/转换属性总是解决了我使用 slideToggle 的任何跳跃问题......示例：

```
-webkit-transform-origin: top;
-moz-transform-origin: top;
-ms-transform-origin: top;
-o-transform-origin: top;
transform-origin: top;

-webkit-transition: transform 0.26s ease;
-moz-transition: transform 0.26s ease;
-ms-transition: transform 0.26s ease;
-o-transition: transform 0.26s ease;
transition: transform 0.26s ease;
transition: -webkit-transform 0.26s ease; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-08-25T21:09:39.903

这是一个旧问题，但在具有更多要求的工作解决方案之下仍然存在类似的问题。

[http://jsfiddle.net/bfnGu/7/](http://jsfiddle.net/bfnGu/7/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-10-25T14:31:02.597

意外地，我认为最容易使用的解决方案是使用动画填充/边距顶部/底部向 jQuery 添加自定义函数。

```
//this function is to avoid slideToggle jQuery jump bug.
$.fn.slideShow = function(time,easing) { return $(this).animate({height:'show','margin-top':'show','margin-bottom':'show','padding-top':'show','padding-bottom':'show',opacity:1},time,easing); }
$.fn.slideHide = function(time,easing) {return $(this).animate({height:'hide','margin-top':'hide','margin-bottom':'hide','padding-top':'hide','padding-bottom':'hide',opacity:0},time,easing);  } 
```

和用法示例：

```
$(this).slideShow(320,'easeOutQuart');
$(this).slideHide(320,'easeOutQuart'); 
```

我的示例动画不透明度切换图，您可以根据需要对其进行修改。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-02-20T01:05:31.957

唯一对我有帮助的：给内容滚动一个宽度。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-02-28T11:26:05.843

有同样的问题，发现问题可能别人有它。

如果你有 min-height -> 比你有 slideToggle 的问题

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-12-13T10:46:07.180

我有同样的问题，但溢出：隐藏和位置：相对没有效果。我将 margin-bottom: -10px 放在正在切换的元素上，它解决了这个问题。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-02-12T10:42:09.400

在切换的元素内使用浮动元素时，我遇到了这个问题。针对切换元素设置 100% 的宽度为我解决了这个问题。如果你想使用填充，那么你也可以将 box-sizing 设置为 border-box。

相对定位不是必需的，但您可能希望使用溢出：隐藏来清除浮动元素。

# .net - .Net 本地化问题

> ID：166309
> 
> 赞同：1
> 
> 时间：2008-10-03T10:47:53.803
> 
> 标签：.net, excel, localization, vsto

我目前正在使用 VSTO（最新版本 + sp1）和 .Net 3.5 构建 Excel 2007 加载项

该代码仅使用 Top 和 Left 属性获取图表的位置并将其存储在 XML 文件中。

我面临的问题是，当使用 Vista Ultimate + Excel 2007 + 英语环境生成 xml 时，代码可以完美运行。当我将其移至 Windows Server 2003 + Excel 2007 + French 环境时，当我尝试设置 Top 和 Left 属性时它会崩溃。此外，它总是为服务器机器上的两个值返回 4。

我曾尝试使用区域和语言设置，但到目前为止它没有改变任何东西。

我还尝试将值存储为整数，而不是 VSTO 对象返回的浮点值。

如果有人知道可能出了什么问题，请指出我正确的方向。

一旦我追踪了更多内容，我将进行编辑...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T14:12:44.970

我不确定这是否有帮助，但您可能想查看 System.Xml.XmlConvert 类。此类将允许您将数据类型序列化为与区域无关的字符串值。当您在另一台机器上提取 xml 时，您可以使用同一类将值转换回适当的数据类型，它将假定当前环境的文化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T10:57:51.630

您需要发布有关您正在做什么以及您看到的错误的更多信息。可能您需要使用 CultureInfo.InvariantCulture 而不是默认的 CultureInfo.CurrentCulture 来格式化/解析数值。

# sql - SQL 查询返回一个表，其中每一行代表给定范围内的日期

> ID：166321
> 
> 赞同：0
> 
> 时间：2008-10-03T10:54:32.057
> 
> 标签：sql, mysql

是否可以创建一个 SQL 查询，该查询将返回一列，其中包含给定日期范围内的日期（例如，从去年到今天的所有日期）。例如

```
dat
----
2007-10-01
2007-10-02
2007-10-03
2007-10-04
... 
```

我想知道这是否可以替代创建一个包含所有预先计算的日期的表。

**更新：**我需要 MYSQL 的解决方案。在这种情况下，我对任何其他数据库都不感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T11:01:31.870

AFAIK 你不能用一个 SQL 查询来做到这一点。但是，以下代码块将完成这项工作。

目前在 Transact-SQL（用于 SQL Server）中。我不知道这如何转化为 MySQL。

```
DECLARE @start datetime
DECLARE @end datetime
DECLARE @results TABLE
(
   val datetime not null
)
set @start = '2008-10-01'
set @end = getdate()
while @start < @end
begin
    insert into @results values(@start)
    SELECT @start = DATEADD (d, 1, @start)
end
select val from @results 
```

这输出：

```
2008-10-01 00:00:00.000
2008-10-02 00:00:00.000
2008-10-03 00:00:00.000 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T16:06:59.937

我现在手头没有 MySQL 实例，但看看这是否可行。根据需要替换参数。我为示例硬编码了 2007-01-01。

问候。

```
SELECT
    ADDDATE('2007-01-01' INTERVAL SeqValue DAY) DateValue
FROM
(
SELECT
    (HUNDREDS.SeqValue + TENS.SeqValue + ONES.SeqValue) SeqValue
FROM
    (
    SELECT 0  SeqValue
    UNION ALL
    SELECT 1 SeqValue
    UNION ALL
    SELECT 2 SeqValue
    UNION ALL
    SELECT 3 SeqValue
    UNION ALL
    SELECT 4 SeqValue
    UNION ALL
    SELECT 5 SeqValue
    UNION ALL
    SELECT 6 SeqValue
    UNION ALL
    SELECT 7 SeqValue
    UNION ALL
    SELECT 8 SeqValue
    UNION ALL
    SELECT 9 SeqValue
    ) ONES
CROSS JOIN
    (
    SELECT 0 SeqValue
    UNION ALL
    SELECT 10 SeqValue
    UNION ALL
    SELECT 20 SeqValue
    UNION ALL
    SELECT 30 SeqValue
    UNION ALL
    SELECT 40 SeqValue
    UNION ALL
    SELECT 50 SeqValue
    UNION ALL
    SELECT 60 SeqValue
    UNION ALL
    SELECT 70 SeqValue
    UNION ALL
    SELECT 80 SeqValue
    UNION ALL
    SELECT 90 SeqValue
    ) TENS
CROSS JOIN
    (
    SELECT 0 SeqValue
    UNION ALL
    SELECT 100 SeqValue
    UNION ALL
    SELECT 200 SeqValue
    UNION ALL
    SELECT 300 SeqValue
    UNION ALL
    SELECT 400 SeqValue
    UNION ALL
    SELECT 500 SeqValue
    UNION ALL
    SELECT 600 SeqValue
    UNION ALL
    SELECT 700 SeqValue
    UNION ALL
    SELECT 800 SeqValue
    UNION ALL
    SELECT 900 SeqValue
    ) HUNDREDS
) SEQ
WHERE
    SEQ.SeqValue < = 366 AND
    ADDDATE('2007-01-01' INTERVAL SeqValue DAY) < ADDDATE('2007-01-01' INTERVAL 1 YEAR)
ORDER BY
    ADDDATE('2007-01-01' INTERVAL SeqValue DAY) ASC 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T12:49:49.990

在 CTE 之前，人们会使用一个标准的预加载整数表（在实用程序表中通常有几千个，请参阅[这篇文章](http://web.archive.org/web/20150411042510/http://sqlserver2000.databases.aspfaq.com/why-should-i-consider-using-an-auxiliary-numbers-table.html)）并在必要时加入它。这将在 mysql 中为您工作：

```
CREATE TABLE dbo.Numbers 
( 
    Number INT IDENTITY(1,1) PRIMARY KEY CLUSTERED 
) 

WHILE COALESCE(SCOPE_IDENTITY(), 0) <= 1024 
BEGIN 
    INSERT dbo.Numbers DEFAULT VALUES 
END

SELECT DATEADD(dd, Number, DATEADD(dd, 0, DATEDIFF(dd, 0, DATEADD(yy, -1, GETDATE())))) AS Date
FROM Numbers
WHERE Number BETWEEN 0 AND 366 
```

在 SQL Server 2005 中，您可以使用公用表表达式和递归：

```
WITH DateRange(Date) AS
(
    SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, DATEADD(yy, -1, GETDATE()))) AS Date
    UNION ALL
    SELECT DATEADD(day, 1, Date) AS Date
    FROM DateRange
    WHERE Date <= GETDATE()
)
SELECT Date 
FROM DateRange
OPTION (MAXRECURSION 366) 
```

# java - 在 webapp 中获取当前的 svn 版本

> ID：166322
> 
> 赞同：9
> 
> 时间：2008-10-03T10:54:52.493
> 
> 标签：java, svn, web-applications, revision

在 java webapp 中显示/使用修订号的最佳方式是什么？

我们只是使用 ant 来构建我们的 .war 档案，没有 buildserver 之类的。我希望有某种 $ref 可以写入资源文件，但这仅在提交相关文件时更新。我需要它全球。

你会推荐什么？更新某些文件的提交后触发器？自定义蚂蚁脚本？有没有更简单的方法来做到这一点？或者最好有我自己的独立于svn的版本号。

编辑：很好的建议！非常感谢您的回答！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T21:16:17.487

我们使用以下 ant 任务将 svn 版本包含在 jar 的属性中，以及正在使用的其他包的版本

```
<target name="package" depends="compile" description="Package up the project as a jar">
<!-- Create the subversion version string -->
<exec executable="svnversion" failifexecutionfails="no" outputproperty="version">
  <arg value="."/> 
  <arg value="-n"/>
</exec>
<!-- Create the time stamp -->
<tstamp>
  <format property="timeAndDate" pattern="HH:mm d-MMMM-yyyy"/>
</tstamp>

<jar destfile="simfraserv.jar">
  <manifest>
    <attribute name="Built-By"                value="${user.name} on ${time.date}" />
    <attribute name="Implementation-Version"  value="${svn.version}" />
    <attribute name="Implementation-Java"     value="${java.vendor} ${java.version}" />
    <attribute name="Implementation-Build-OS" value="${os.name} ${os.arch} ${os.version}" />
    <attribute name="JVM-Version"             value="${common.sourcelevel}+" />        
  </manifest>
  <fileset dir="bin">
    <include name="**/*.class"/>
  </fileset>
  <fileset dir="src">
    <include name="**"/>
  </fileset>
</jar>
</target> 
```

然后你可以像这样在你的 webapp 中访问它

```
String version = this.getClass().getPackage().getImplementationVersion(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-07-11T16:34:37.783

如果您使用的是 ant，您可以定义此任务：

```
 <target name="version">
<exec executable="svn" output="svninfo.xml" failonerror="true">
  <arg line="info --xml" />
</exec>
<xmlproperty file="svninfo.xml" collapseattributes="true" />
<echo message="SVN Revision: ${info.entry.commit.revision}"/>
<property name="revision" value="${info.entry.commit.revision}" />
</target> 
```

和你想要的修订值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T14:19:02.463

**有几个 Ant 任务可以为您完成这项工作。**

来自 tigris 的[SvnAnt 任务是最古老的。](http://subclipse.tigris.org/svnant.html)

文档在[这里](http://subclipse.tigris.org/svnant/svn.html#info)- 特别是查看`info`将 Subversion 存储库的修订号公开为它调用的 Ant 属性的元素`rev`。您可以使用正常的 Ant 替换机制将此值写入资源文件。

有人还在谷歌代码托管上提出了一个类似[（更简单）的任务](http://code.google.com/p/svntask/)——虽然从未使用过，所以无法发表评论。

如果您的构建中已经有 Ant，那么这两种方法对我来说都是最简洁的方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T10:56:22.053

看到[这个线程](https://stackoverflow.com/questions/111436/how-can-i-get-the-svn-revision-number-in-php)。

该线程中我最喜欢的只是`$Id:$`在您想要修订 ID 的代码中转储。当您进行导出时，SVN 将使用真实数据填充它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T11:15:50.283

如果您使用的是 Windows，您可以查看 Tortoise 附带的 SubWCRev.exe。

它给出了当前的存储库修订，并将 $WCREV$ 替换为说，您可以将其作为上下文参数包含在您的 web.xml 中，然后从那里获取它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T05:12:58.617

在打包 webapp 之前，运行 svn info 并将输出重定向到 WEB-INF/classes 中的某个文件。当 webapp 启动时，解析这个文件并将它隐藏在 servlet 上下文或类似的地方。在每一页的页脚，显示这个版本——如果你使用的是 Tiles 或 SiteMesh 之类的东西，这个改变只需要在一个文件中完成。

Maven 用户可以尝试 maven-buildnumber 插件。

# visual-studio - Microsoft 对在 Visual Studio 2005 中使用 WCF 的官方立场是什么？

> ID：166324
> 
> 赞同：0
> 
> 时间：2008-10-03T10:55:49.200
> 
> 标签：visual-studio, wcf

昨晚我注意到 Visual Studio 2005 的 WCF 扩展在他们的网站上不再可用。我读到他们希望人们将 Visual Studio 2008 用于 WCF/WF/WPF。

他们有没有就此发表过官方声明？

编辑：

我已经有了 VS2005 的 CTP3。我想知道微软的**官方**立场是什么。是的，我已经阅读了主题和博客。如果只需要一篇博客文章就可以使其正式化，那就这样吧。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T05:51:57.320

我遇到了同样的问题......我需要使用 Visual Studio 2005 中的 WCF，而当我安装 VS2008 时，WCF 扩展就消失了。我用谷歌搜索了很多，我发现了一个能够在 Visual Studio 2005 或 2008 中使用 WCF 的技巧。

您必须从 VS2005 命令提示符运行以下命令：***msiexec /i vsextwfx.msi WRC_INSTALLED_OVERRIDE=1***

有关更多信息，请查看我在这里写的关于它的帖子：http: [//sgomez.blogspot.com/2008/08/visual-studio-2005-extensions-for-wcf.html](http://sgomez.blogspot.com/2008/08/visual-studio-2005-extensions-for-wcf.html)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-03T11:37:55.807

除了为 MS Visual Studio 2008 发布的 CTP 之外，从来没有其他任何东西

根据[此](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3695753&SiteID=1)线程 MS 希望您移至 Visual Studio 2008。

这篇[博](http://blogs.msdn.com/acangialosi/archive/2008/06/27/vs-2005-extensions-for-net-framework-3-0-wpf-wcf-ctp-is-coming-off-the-ms-download-center.aspx)文证实了这一点。

您仍然可以从第三方服务器下载[Visual Studio 2005 的 CTP3](http://www.download.com/The-Visual-Studio-2005-extensions-for-NET-Framework-3-0-WCF-WPF-November-2006-CTP/3000-10253_4-10727672.htm)

# c# - 参数化 Sql 查询

> ID：166330
> 
> 赞同：2
> 
> 时间：2008-10-03T10:56:54.970
> 
> 标签：c#, .net, sql-server-2005, ado.net

这是我这些天正在破解的坚果

我正在处理的应用程序对 SQL 进行了一些高级处理。其中一项操作根据集合中的项目名称从不同的表中选择有关当前上下文中对象的各种元数据。为此，执行了一系列“select...from...where...in()”，为了防止恶意SQL代码，使用Sql参数构造“in()”子句的内容。

但是，当用于构造“in()”子句的项目集合大于 2100 个项目时，由于 Sql Server 限制每个查询最多 2100 个 Sql 参数，这将失败。

我现在尝试的一种方法是创建一个#temp 表来存储所有项目名称，然后在原始查询中加入该表，而不是使用“where in()”。这让我对如何使用存储在 .NET 代码中的数组中的项目名称来填充表感到头疼。当然，必须有一些批量方法来插入所有内容，而不是为每个项目发出单独的“插入”？

除此之外，我对解决此问题的替代方法非常感兴趣。

非常感谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T11:03:54.767

一种可能的解决方法是使用查询 XML 的功能，只需将“in”的所有数据作为 xml 列发送，然后加入该列。

可以使用相同的方法来填充您的临时表，但话又说回来，为什么不直接使用它。

这是一个应该说明的简短示例：

```
declare @wanted xml
set @wanted = '<ids><id>1</id><id>2</id></ids>'
select * 
from (select 1 Id union all select 3) SourceTable 
where Id in(select Id.value('.', 'int') from @wanted.nodes('/ids/id') as Foo(Id)) 
```

只需在您的应用程序中构建 xml 并将其作为参数传递。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T11:00:45.540

Hrm，在不了解上下文以及有关数据以及您如何使用结果和性能问题的更多信息的情况下，我将尝试提出替代方案。你可以分成多个查询吗？像现在一样做同样的事情，但不是构建一个包含 2100+ 个项目的查询，而是构建两个每个包含 1050 个的查询，然后合并结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T11:04:37.683

预防恶意 SQL 代码： > 使用存储过程。

是的，SQL Server 2005 有一个批量插入：http: [//msdn.microsoft.com/en-us/library/ms188365.aspx](http://msdn.microsoft.com/en-us/library/ms188365.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T11:20:37.090

您可以使用 .NET 2.0 引入的 SqlBulkCopy 类。它实际上非常易于使用。看看这个：

[http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T11:11:46.860

对于批量更新问题：查看其中包含数据表的数据适配器。您可以设置一个参数，允许您批量插入/更新表中的项目，并且您可以选择批量中的项目数 [MSDN文章](http://msdn.microsoft.com/en-us/library/kbbwt18a(VS.80).aspx)

您似乎应该仔细研究业务问题或领域，以确定更好的方法来过滤查询中的项目。IN() 子句可能不是您执行此操作的最佳方式。在您的情况下，添加数据类别或过滤器而不是要包含的大量项目可能会更好。在不了解业务问题/背景的情况下，很难说。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T11:23:06.617

好的，我不确定这对您有多好或性能如何，但这是我过去用来实现类似功能的一些代码：

```
 CREATE FUNCTION [dbo].[Split](
    @list ntext
)
RETURNS @tbl TABLE (listpos int IDENTITY(1, 1) NOT NULL,
                          number  int NOT NULL) 
AS
BEGIN
    DECLARE @pos      int,
            @textpos  int,
            @chunklen smallint,
            @str      nvarchar(4000),
            @tmpstr   nvarchar(4000),
            @leftover nvarchar(4000)

    SET @textpos = 1
    SET @leftover = ''
    WHILE @textpos <= datalength(@list) / 2
    BEGIN
       SET @chunklen = 4000 - datalength(@leftover) / 2
       SET @tmpstr = ltrim(@leftover + substring(@list, @textpos, @chunklen))
       SET @textpos = @textpos + @chunklen

       SET @pos = charindex(',', @tmpstr)
       WHILE @pos > 0
       BEGIN
          SET @str = substring(@tmpstr, 1, @pos - 1)
          INSERT @tbl (number) VALUES(convert(int, @str))
          SET @tmpstr = ltrim(substring(@tmpstr, @pos + 1, len(@tmpstr)))
          SET @pos = charindex(',', @tmpstr)
       END

       SET @leftover = @tmpstr
    END

    IF ltrim(rtrim(@leftover)) <> ''
       INSERT @tbl (number) VALUES(convert(int, @leftover))

    RETURN
END 
```

然后在您的其他存储过程中，您可以传入以逗号分隔的 ID 字符串，例如：

```
select a.number from split('1,2,3') a inner join myothertable b on a.number = b.ID 
```

就像我说的那样，这可能真的很糟糕，因为它包含很多字符串操作，我不记得我从哪里得到这个函数......但它在那里可供挑选......

我想如果你真的不需要索引原始字符串，你也可以去掉填充 listpos 列的位。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T13:48:25.363

SQL Server 2008 将具有表参数。这就是你想要的锤子。

# python - 如何构建和部署 Python Web 应用程序

> ID：166334
> 
> 赞同：18
> 
> 时间：2008-10-03T10:57:44.470
> 
> 标签：python, deployment

我有一个由几个 Python 包组成的 Python Web 应用程序。将其构建和部署到服务器的最佳方法是什么？

目前我正在使用 Capistrano 部署软件包，使用 bash 将软件包安装到 virtualenv 中，并使用 puppet 配置服务器，但我想使用更多基于 Python 的解决方案。

我一直在研究 zc.buildout，但我不清楚我可以/应该使用它做什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-05-06T09:25:44.897

取决于您的基础架构是什么。我们只是使用 debian 包和 buildbot 来制作它们。

在其他设置中，我使用[Fabric](http://docs.fabfile.org/)脚本。至于格式，我只是使用 tbz2 文件，但我听说有人只是在部署鸡蛋。

我强烈建议进行适当的构建并让 BuildBot/Hudson 构建软件包，因为使用 SCM 会达到目的并鼓励不良做法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T02:52:37.917

[摊铺机](http://www.blueskyonmars.com/projects/paver/)是一个用于 python 的 rake/make 工作。我不知道这是否是您要寻找的东西，仍然没有找到任何与 puppet for python 等效的东西...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T02:51:42.083

[pyinstall](http://pypi.python.org/pypi/pyinstall)看起来对您来说应该是一个更简单的解决方案。至少就打包 python 的东西并在 virtualenv 中安装而言。我不知道进行服务器配置的pythonic方法......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-05T04:08:58.387

我使用 Mercurial 作为我的 SCM 系统，也用于部署。这只是从另一个克隆存储库的问题，然后拉/更新或获取将使其更新。

我使用了几个存储库实例——一个在开发服务器上，一个（或多个，取决于具体情况）在我的本地机器上，一个在生产服务器上，以及一个可用于更大互联网的“主”存储库（尽管只有通过 SSH）。

它唯一不做的就是在数据库发生更改时自动更新数据库，但是使用传入的钩子我也可以这样做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T13:17:07.127

SCons 会做你想做的事吗？

[http://www.scons.org/](http://www.scons.org/)

# ads - 将广告插入网络应用程序的有效方法是什么？AdSense 适合吗？

> ID：166339
> 
> 赞同：11
> 
> 时间：2008-10-03T10:59:52.217
> 
> 标签：ads, adsense

由于网络应用程序的内容是动态生成的，因此 AdSense 似乎不会生成相关广告。

有没有办法提高 AdSense 广告与网络应用程序的相关性？

是否有可能为第三方应用程序实现类似 Gmail 的广告功能？

有没有比谷歌更好的网络应用广告提供商？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-09T23:39:22.237

当然可以在动态页面上获得相关的 AdSense 广告。只是因为我们称某些网站为“动态”（= 我们即时生成内容），这并不意味着 AdSense 无法抓取它。这完全取决于您网站上的 URL 是如何构建的，以及您如何访问页面。

以下是 AdSense 如何在某个页面上发布广告的简化顺序：

1.  用户输入一些查询/点击链接/访问动态页面所需的任何内容
2.  浏览器将请求发送到服务器并获取包含一些动态内容的页面
3.  该页面嵌入的 AdSense javascript 会调用 AdSense clawler，并请求他访问该页面的 URL
4.  爬虫获取此 URL，抓取页面，对其进行分析以匹配并显示相关广告（在大多数情况下，它之前已经抓取过它，因此它会从索引中获取适当的广告）。

所以要获取相关广告，必须确保 AdSense 爬虫获取到用户打开的相同 URL，并且该 URL 必须指向相同的内容。只要您避免：

*   带有使用会话 ID 的 URL 的 pagew，（例如 www.yoursite.com/index.php?pageid=123&sessionid=64875684756）
*   使用相同 URL 时内容随时间变化的页面
*   需要登录的页面，并将其内容修改为用户配置文件
*   使用 POST 发送表单的页面

    检查来自 google 支持的[此链接以了解更多信息。](https://www.google.com/adsense/support/bin/answer.py?answer=20763&topic=8437)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T14:48:33.380

有许多特定于利基市场的广告网络可用，或大型网络中的渠道，如 TribalFusion。例如，我的公司[Lake Quincy Media](http://lakequincy.com/), 专门为 Microsoft 开发人员提供广告。因此，如果您在我们的某个网站上查看有关继承的文章，您将不会发现通常的 Google 广告会建议您更新遗嘱并找到一位优秀的律师来讨论如何将您的财富转移给您的继承人。您会找到 Resharper 和 Visual Studio 等工具的广告，或者可能是某些组件或技术招聘广告。这里的关键是该网站可用的整个广告池都已被狭隘地定位到该网站所服务的特定利基市场。这允许有针对性的广告，而无需索引内容并尝试使用关键字来“猜测”可能的目标。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T11:24:41.527

不，这不太合适。如您所知，AdSense 是基于页面内容的，除非您的网站非常专注于一个广告利基市场，否则很少会定位到正确的广告。

如果您运行一个获得数百万浏览量的大型网络应用程序，那么您也许可以私下通过 Google 解决一些问题。否则，您将看到其他最好的产品提供什么。

[Chitika](http://chitika.com/)确实有能力让您指定要从哪些细分市场展示广告……但他们的广告费率甚至广告质量都不如谷歌。周围看看。有成千上万的广告提供商，我相信您会找到适合您模式的。

...但目前不是谷歌。

# java - 关于用于压缩文件的免费库的建议

> ID：166340
> 
> 赞同：75
> 
> 时间：2008-10-03T11:00:26.133
> 
> 标签：java, encryption, zip

我需要对文件进行压缩和密码保护。有没有一个好的（免费）图书馆？

这需要由第三方打开，因此密码保护需要使用标准工具。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2011-11-06T14:09:29.493

您可以尝试[Zip4j](http://www.lingala.net/zip4j/)，这是一个用于处理 zip 文件的纯 java 库。它支持PKWare和AES加密方法的加密/解密。

主要特点：

*   从 Zip 文件中创建、添加、提取、更新、删除文件
*   读/写受密码保护的 Zip 文件
*   支持 AES 128/256 加密
*   支持标准 Zip 加密
*   支持 Zip64 格式
*   支持 Store (No Compression) 和 Deflate 压缩方式
*   从拆分 Zip 文件中创建或提取文件（例如：z01、z02、...zip）
*   支持 Unicode 文件名
*   进度监视器

执照：

*   Zip4j 在[Apache 许可证下发布，版本 2.0](http://www.apache.org/licenses/LICENSE-2.0)。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-03-25T15:05:49.853

2020 年更新：现在还有其他选择，尤其是[Zip4J](http://www.lingala.net/zip4j/)。

* * *

经过大量搜索，我找到了三种方法：

一套免费提供的源代码，适用于单个文件 zip。但是，没有许可证。用法是 AesZipOutputStream.zipAndEcrypt(...)。 [http://merkert.de/de/info/zipaes/src.zip](http://merkert.de/de/info/zipaes/src.zip) ( [https://forums.oracle.com/forums/thread.jspa?threadID=1526137](https://forums.oracle.com/forums/thread.jspa?threadID=1526137) )

更新：此代码现已获得 Apache 许可并在[https://github.com/mobsandgeeks/winzipaes发布（从](https://github.com/mobsandgeeks/winzipaes)[Google 代码](http://code.google.com/p/winzipaes/)的原始主页导出）。它对我有用（zip 中的一个文件），并且很好地填补了 Java 开源库中的一个漏洞。

商业产品（撰写本文时为 500 美元）。我无法验证这是否有效，因为他们的试用许可方法很复杂。它也是一个移植的 .NET 应用程序： [http ://www.nsoftware.com/ipworks/zip/default.aspx](http://www.nsoftware.com/ipworks/zip/default.aspx)

商业产品（撰写本文时为 290 美元）。仅适用于 Wnidows，因为它使用 dll： [http ://www.example-code.com/java/zip.asp](http://www.example-code.com/java/zip.asp)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-04T02:49:30.560

这不是答案，但在评估潜在解决方案时要牢记这一点。

关于 zip 加密的一件非常重要的事情：

有几种类型的 zip 加密。旧的类型（原始 zip 标准的一部分）根本不值得打扰（它可以在不到 10 分钟的时间内通过应用程序轻松在线破解）。

如果您正在对 zip 文件进行任何类型的加密，请务必使用其中一种强加密标准（我相信 WinZip 的 128 位和 256 位 AES 标准得到最好的支持）。以下是[技术规格](http://www.winzip.com/aes_info.htm)- 我们在开发自己的 Java 加密 zip 系统时使用了它（无法提供源代码 - 抱歉 - 仅供内部使用）

唯一比没有加密更糟糕的是认为你有加密并且错了:-)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-03T11:26:03.070

7-Zip 可以选择在其命令行模式下添加密码。也许你可以执行它来得到这个结果（它也有很好的压缩比）。

缺点：外部过程，难以移植（即使 7-Zip 本身是可移植的），不确定分发许可证。

请注意，InfoZip 的 Zip 实用程序也非常便携，也支持密码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-11-24T08:28:09.367

您也可以尝试 TrueZip。有关功能，请参阅以下链接： [https ://christian-schlichtherle.bitbucket.io/truezip/](https://christian-schlichtherle.bitbucket.io/truezip/)

TrueZip 的继任者可以在这里找到： [https ://christian-schlichtherle.bitbucket.io/truevfs/](https://christian-schlichtherle.bitbucket.io/truevfs/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-10-24T18:35:46.000

这是一个使用 winzipaes 1.0.1 的示例。请注意，这只是一个要点，我还没有完全按照这种形式测试过这段代码。

```
import de.idyl.winzipaes.AesZipFileEncrypter;
import de.idyl.winzipaes.impl.AESEncrypterBC;

File aNewZipFile = new File("/tmp/foo.zip");
File existingUnzippedFile = new File("/tmp/src.txt");

// We use the bouncy castle encrypter, as opposed to the JCA encrypter
AESEncrypterBC encrypter = new AESEncrypterBC();
encrypter.init("my-password", 0);  // The 0 is keySize, it is ignored for AESEncrypterBC

AesZipFileEncrypter zipEncrypter = new AesZipFileEncrypter(aNewZipFile, encrypter);
zipEncrypter.add(existingUnzippedFile, "src.txt", "my-password"); 

// remember to close the zipEncrypter
zipEncrypter.close(); 
```

您可以在 Mac 上使用 Winzip (v9+) 或 7za（即 7zip）解压缩“/tmp/foo.zip”，使用密码“my-password”。

注意：我不清楚为什么需要在上面的代码中指定两次密码。我不知道如果你在这两个地方使用不同的密码会发生什么。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-03T11:32:02.217

如果您提供更好的使用场景，那么还有其他选择。

1.  您是否需要使用可以处理 zip 密码的标准 Zip 工具打开 zip？
2.  与之前相同的问题，您是否要将此 zip 传递给必须打开 zip 的外部实体？
3.  它只是内部的，您只想保护 zip 的内容吗？

对于 3，您可以只使用 java 将 zip 的流内容加密为普通文件，最好将文件扩展名更改为 .ezip 或类似的文件。

对于 1 和 2，您可以使用上述的[chillkat](http://www.chilkatsoft.com/java-zip.asp)解决方案或等效方案。但是请注意，chillkat 不是纯 Java 解决方案，它使用 JNI。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-03T12:08:57.950

附加信息：我用谷歌搜索了更多，确实，这是一个很常见的问题，而且似乎没有免费的解决方案（还没有？）。

现在，Zip 加密的标准算法已经很好地定义了：请参阅 PKWARE 的.ZIP 文件格式[应用说明](http://www.pkware.com/support/zip-application-note "应用说明")。它似乎是对加密流进行的加密。如果有人想编码它......

现在，我想知道为什么 Sun 没有将它包含在它的库中？缺乏标准？专利/法律问题？太弱了无法使用？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-03T11:06:06.573

> 有没有一个好的（免费）图书馆？

java.util.zip 将执行压缩，但不会执行密码。不，我不知道有什么免费的。我见过[的最便宜的开发者席位是 150 美元。](http://www.chilkatsoft.com/java-zip.asp)

# ruby - 如何使用 Ruby 编写 shell 脚本？

> ID：166347
> 
> 赞同：168
> 
> 时间：2008-10-03T11:03:06.720
> 
> 标签：ruby, shell, scripting

我有一些我想做的简单的 shell 脚本任务

例如：从与某个正则表达式匹配的文件列表中选择工作目录中的文件。

我知道我可以使用标准的 bash 和 grep 来做这种事情，但是我很高兴能够破解可以在 windows 和 linux 中运行的快速脚本，而不必记住一堆命令行程序和标志等。

我试图做到这一点，但最终对我应该从哪里获取信息（例如对当前目录的引用）感到困惑

所以问题是我需要知道 Ruby 库的哪些部分来编写 ruby​​ shell 脚本？

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2008-10-03T13:30:59.110

默认情况下，您已经可以访问[Dir](http://www.ruby-doc.org/core/classes/Dir.html)和[File](http://www.ruby-doc.org/core/classes/File.html)，它们本身就非常有用。

```
Dir['*.rb'] #basic globs
Dir['**/*.rb'] #** == any depth of directory, including current dir.
#=> array of relative names

File.expand_path('~/file.txt') #=> "/User/mat/file.txt"
File.dirname('dir/file.txt') #=> 'dir'
File.basename('dir/file.txt') #=> 'file.txt'
File.join('a', 'bunch', 'of', 'strings') #=> 'a/bunch/of/strings'

__FILE__ #=> the name of the current file 
```

标准库中也有用的是[FileUtils](http://www.ruby-doc.org/stdlib/libdoc/fileutils/rdoc/index.html)

```
require 'fileutils' #I know, no underscore is not ruby-like
include FileUtils
# Gives you access (without prepending by 'FileUtils.') to
cd(dir, options)
cd(dir, options) {|dir| .... }
pwd()
mkdir(dir, options)
mkdir(list, options)
mkdir_p(dir, options)
mkdir_p(list, options)
rmdir(dir, options)
rmdir(list, options)
ln(old, new, options)
ln(list, destdir, options)
ln_s(old, new, options)
ln_s(list, destdir, options)
ln_sf(src, dest, options)
cp(src, dest, options)
cp(list, dir, options)
cp_r(src, dest, options)
cp_r(list, dir, options)
mv(src, dest, options)
mv(list, dir, options)
rm(list, options)
rm_r(list, options)
rm_rf(list, options)
install(src, dest, mode = <src's>, options)
chmod(mode, list, options)
chmod_R(mode, list, options)
chown(user, group, list, options)
chown_R(user, group, list, options)
touch(list, options) 
```

这是相当不错的

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2008-10-03T11:41:04.480

正如其他人已经说过的那样，您的第一行应该是

```
#!/usr/bin/env ruby 
```

而且您还必须使其可执行：（在外壳中）

```
chmod +x test.rb 
```

然后遵循 ruby​​ 代码。如果你打开一个文件

```
File.open("file", "r") do |io|
    # do something with io
end 
```

该文件在您`pwd`在 shell 中获得的当前目录中打开。

脚本的路径也很容易获得。随着`$0`您获得 shell 的第一个参数，它是脚本的相对路径。绝对路径可以这样确定：

```
#!/usr/bin/env ruby
require 'pathname'
p Pathname.new($0).realpath() 
```

对于文件系统操作，我几乎总是使用 Pathname。这是许多其他文件系统相关类的包装器。也很有用：目录、文件...

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2009-11-27T05:52:03.483

这是其他答案中缺少的重要内容：命令行参数通过 ARGV（全局）数组暴露给您的 Ruby shell 脚本。

因此，如果您有一个名为 my_shell_script 的脚本：

```
#!/usr/bin/env ruby
puts "I was passed: "
ARGV.each do |value|
  puts value
end 
```

...使其可执行（正如其他人所提到的）：

```
chmod u+x my_shell_script 
```

并这样称呼它：

```
> ./my_shell_script one two three four five 
```

你会得到这个：

```
I was passed: 
one
two
three
four
five 
```

这些参数与文件名扩展很好地配合使用：

```
./my_shell_script *

I was passed: 
a_file_in_the_current_directory
another_file    
my_shell_script
the_last_file 
```

其中大部分仅适用于 UNIX（Linux、Mac OS X），但您可以在 Windows 中执行类似（尽管不太方便）的操作。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2010-03-06T13:29:15.493

这里有很多好的建议，所以我想再补充一点。

1.  反引号（或反引号）使您可以更轻松地编写一些脚本。考虑

    ```
    puts `find . | grep -i lib` 
    ```

2.  如果您在获取反引号输出时遇到问题，则这些内容将变为标准错误而不是标准输出。[使用这个建议](http://www.weheartcode.com/2007/09/14/capturing-stderr-with-ruby-backticks/comment-page-1/#comment-30518)

    ```
    out = `git status 2>&1` 
    ```

3.  反引号做字符串插值：

    ```
    blah = 'lib'
    `touch #{blah}` 
    ```

4.  [你也可以在 Ruby 中使用管道](http://compileyouidontevenknowyou.blogspot.com/2010/02/how-to-pipe-in-ruby.html)。这是我博客的链接，但它链接回这里，所以没关系:) 关于这个主题可能有更高级的东西。

5.  正如其他人所指出的，如果您想认真一点，那么 Rush：不仅可以作为 shell 替代品（这对我来说有点太滑稽了），而且还可以[作为您在 shell 脚本和程序中使用的库。](http://rush.heroku.com/handbook/library)

* * *

在 Mac 上，在 Ruby 中使用 Applescript 以获得更多功能。这是我的`shell_here`脚本：

```
#!/usr/bin/env ruby
`env | pbcopy` 
cmd =  %Q@tell app "Terminal" to do script "$(paste_env)"@
puts cmd

`osascript -e "${cmd}"` 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-10-03T12:42:06.650

去为自己获取一份[使用 Ruby 编写日常脚本](http://www.pragprog.com/titles/bmsft/everyday-scripting-with-ruby)的副本。它有很多关于如何做你想做的事情的有用提示。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-03T11:14:23.110

假设您编写`script.rb`脚本。放：

```
#!/usr/bin/env ruby 
```

作为第一行并做一个`chmod +x script.rb`

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-10-05T09:29:29.003

这也可能有帮助：[http ://rush.heroku.com/](http://rush.heroku.com/)

我用的不多，但看起来很酷

从网站：

> rush 是使用纯 Ruby 语法的 unix shell（bash、zsh 等）的替代品。grep 遍历文件、查找和终止进程、复制文件 - 您在 shell 中所做的一切，现在都在 Ruby 中

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-03-19T07:59:46.080

当您想编写更复杂的 ruby​​ 脚本时，这些工具可能会有所帮助：

例如：

*   [thor](http://github.com/wycats/thor)（一个脚本框架）

*   [gli](http://davetron5000.github.com/gli/)（类似 git 的界面）

*   [美沙酮](https://github.com/davetron5000/methadone)（用于创建简单工具）

它们让您快速开始编写自己的脚本，尤其是“命令行应用程序”。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-03T11:07:18.613

“我如何编写 ruby​​”有点超出 SO 的范围。

但是要将这些 ruby​​ 脚本转换为可执行脚本，请将其作为 ruby​​ 脚本的第一行：

```
#!/path/to/ruby 
```

然后使文件可执行：

```
chmod a+x myscript.rb 
```

你走了。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2016-12-01T17:10:47.727

当使用 Ruby 作为 shell 脚本时，上面的答案很有趣并且非常有用。对我来说，我不使用 Ruby 作为我的日常语言，我更喜欢仅使用 ruby​​ 作为流控制，并且仍然使用 bash 来完成任务。

一些辅助函数可用于测试执行结果

```
#!/usr/bin/env ruby
module ShellHelper
  def test(command)
    `#{command} 2> /dev/null`
    $?.success?
  end

  def execute(command, raise_on_error = true)
    result = `#{command}`
    raise "execute command failed\n" if (not $?.success?) and raise_on_error
    return $?.success?
  end

  def print_exit(message)
    print "#{message}\n"
    exit
  end

  module_function :execute, :print_exit, :test
end 
```

使用 helper，ruby 脚本可以与 bash 类似：

```
#!/usr/bin/env ruby
require './shell_helper'
include ShellHelper

print_exit "config already exists" if test "ls config"

things.each do |thing|
  next if not test "ls #{thing}/config"
  execute "cp -fr #{thing}/config_template config/#{thing}"
end 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-03T11:37:45.357

把它放在你 script.rb 的开头

```
#!/usr/bin/env ruby 
```

然后将其标记为可执行文件：

```
chmod +x script.rb 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-03T12:18:29.397

在 ruby​​ 中，常量`__FILE__`将始终为您提供正在运行的脚本的路径。

在 Linux 上，`/usr/bin/env`你的朋友是：

```
#! /usr/bin/env ruby
# Extension of this script does not matter as long
# as it is executable (chmod +x)
puts File.expand_path(__FILE__) 
```

在 Windows 上，这取决于 .rb 文件是否与 ruby​​ 相关联。如果他们是：

```
# This script filename must end with .rb
puts File.expand_path(__FILE__) 
```

如果不是，您必须在它们上显式调用 ruby​​，我使用中间 .cmd 文件：

my_script.cmd：

```
@ruby %~dp0\my_script.rb 
```

my_script.rb：

```
puts File.expand_path(__FILE__) 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-08-30T18:22:13.897

[webmat](https://stackoverflow.com/users/6349/webmat)的答案是完美的。我只是想给你指出一个补充。如果你必须为你的脚本处理很多命令行参数，你应该使用[optparse](http://ruby-doc.org/stdlib-1.9.3/libdoc/optparse/rdoc/OptionParser.html)。它很简单，可以极大地帮助您。

# asp.net - 使用软件负载平衡与硬件负载平衡器的经验？

> ID：166349
> 
> 赞同：5
> 
> 时间：2008-10-03T11:04:17.903
> 
> 标签：asp.net, scalability, web-farm

我目前在日常工作中负责的 ASP.NET 应用程序在单个服务器内的扩展能力方面已经达到了极限。显然，我们正在努力将会话移出进程和测试并希望部署日期临近。我想借鉴人们在 Windows 中使用内置负载平衡与设备解决方案（例如 Baracudda、Coyote Point、F5 等）的经验。您是否从一个开始并转向另一个，为什么？

提前感谢的想法和建议...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T14:38:14.233

一些想法

*   WLBS 通常“足够好”，可以让您开始使用 NLB。然而，就像任何伟大的工程师一样——你需要“衡量才能知道”
*   它不仅与扩大规模有关，还与软冗余或硬冗余有关。我们经常在虚拟机之间进行 NLB，只是为了给我们提供软冗余。
*   NLB 同样适用于后端网络和前端网络
*   加紧硬件加速会给您带来新的运营成本。新培训专业支持、升级等
*   寻找比 NLB 更多的硬件加速，例如 DDoS 保护、SSL、压缩、缓存、内容切换、连接聚合、缓冲。
*   教育 Devs 和 Ops SE 的硬件加速优势，一个伟大的设计可以融合网络运营和应用程序开发之间的界限。
*   它自己的硬件缓冲通过减少我们的 GC 时间使我们的 ASP.NET 快了大约 30%。
*   内容切换可以让您透明地合并或迁移不同的系统。我们使用这种技术将 MSDN 和 MSDN2 平台合并到一个 url 空间中。
*   会话粘性是一把双刃剑 - 谨慎使用 - 再次无法替代良好的工程 - 测量和测试*一切*

我们在我们的网络中同时使用 WLBS 和 NLB - 成本经常推动对话。将两者都视为工具箱中的工具，了解它们的细微差别、成本模型等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T14:46:13.623

我在负载平衡解决方案方面有一些经验，但这实际上取决于您的网络和软件的设计方式，哪个是您的最佳解决方案。

就我遇到的解决方案而言：

Windows 中的内置负载平衡适用于大多数情况，但您需要确保您的应用程序能够正确处理会话（如果它们不具有粘性）。等等

我使用过 F5 产品，主要用作缓存解决方案，但它们对我们来说过于复杂。我们目前正在取消它们，因为开发人员没有正确使用它们，因为它们太复杂了。（请注意，这些是相当古老的 F5 产品。）

我们目前正在试用 Foundry 的硬件负载均衡器，我们可能会选择它们，因为它们非常适合我们的网络架构。（这很复杂。）。

所以我想说，如果您想要一个简单的解决方案，请在 Windows 中使用负载平衡（如果您的应用程序可以正常工作。）。

如果不使用更复杂的东西。

无论您使用哪种负载均衡器，都会使您的架构变得更加复杂。因此，请仔细计划和测试。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T05:11:08.560

设置一个 apache mod_proxy 集群。 [http://www.howtoforge.com/high_availability_loadbalanced_apache_cluster](http://www.howtoforge.com/high_availability_loadbalanced_apache_cluster)

比你想象的更容易，而且价格只是其中的一小部分

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-12T15:41:02.423

F5 自带 SSL 加速芯片。使用应用程序服务器的 SSL 加密和解密（它非常占用 CPU）会使它们减慢实际请求的处理速度。一般来说，SSL 流量在 F5 处终止，正常的 http 流量被发送到应用程序服务器。这在负载平衡器上称为 SSL 卸载。由于 F5 使用芯片（硬件）进行 SSL 加密和解密，它比普通加密和解密时间快 30 到 40 倍。

# java - 计算吞吐量

> ID：166354
> 
> 赞同：4
> 
> 时间：2008-10-03T11:06:13.187
> 
> 标签：java, performance

我有以下场景。我正在尝试计算 java 的 XSLT 转换器的吞吐量。我有 10 个线程，每个迭代 1000 次。线程的任务是读取 XML 和 XSLT 文件并将其转换并写入新文件。

我想计算TPS。你能建议计算TPS的方法吗？

谢谢并恭祝安康，

斯里尼瓦斯。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T14:10:00.220

好吧，您想在开始时启动一个计时器，并在所有线程完成时停止它。这给了你经过的时间=结束时间-开始时间。事务 = 10 个线程 * 1000 次迭代 = 10000。TPS = 10000 / 已用时间。

进行这种计时的最简单方法是使用 CyclicBarrier。这是使用 CyclicBarrier 作为计时器的屏障动作的好文章（参见最后一个示例）：

*   [http://tech.puredanger.com/2007/11/11/thread-coord/](http://tech.puredanger.com/2007/11/11/thread-coord/)

我的最后一个警告是，像这样的基准测试充满了危险。一些建议：

*   运行超过 1000 次迭代。您需要让热点预热。最好让测试运行至少 10 分钟。
*   不要打折 GC 时间。您需要了解您使用的 GC 以及它的暂停时间如何影响您的结果。运行 -verbose:gc 至少几次是非常有价值的。有关更多信息，请参见此处：http: [//java.sun.com/developer/technicalArticles/Programming/GCPortal/](http://java.sun.com/developer/technicalArticles/Programming/GCPortal/)
*   在同一过程中运行多次重复，直到看到可重复的结果。
*   进行多次运行，直到您相信数字是一致的。

# c++ - OpenGL 编码（尤其是 wrt 面向对象）有哪些最佳实践？

> ID：166356
> 
> 赞同：53
> 
> 时间：2008-10-03T11:07:08.567
> 
> 标签：c++, opengl, oop

这个学期，我在大学修了一门计算机图形学课程。目前，我们开始研究一些更高级的东西，比如高度图、平均法线、曲面细分等。

我来自面向对象的背景，所以我试图将我们所做的一切都放入可重用的类中。我在创建相机类方面取得了很大的成功，因为它主要取决于对 gluLookAt() 的一次调用，它几乎独立于 OpenGL 状态机的其余部分。

但是，我在其他方面遇到了一些麻烦。使用对象来表示基元对我来说并不是真正的成功。这是因为实际的渲染调用依赖于许多外部事物，例如当前绑定的纹理等。如果您突然想从特定类的表面法线更改为顶点法线，则会导致严重的头痛。

我开始怀疑 OO 原则是否适用于 OpenGL 编码。至少，我认为我应该让我的课程不那么细化。

堆栈溢出社区对此有何看法？OpenGL 编码的最佳实践是什么？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-10-03T12:28:22.967

最实用的方法似乎是忽略大部分不直接适用的 OpenGL 功能（或者速度很慢，或者没有硬件加速，或者不再适合硬件）。

OOP 与否，要渲染一些场景，这些是您通常拥有的各种类型和实体：

**几何**（网格）。大多数情况下，这是一个顶点数组和索引数组（即每个三角形三个索引，也称为“三角形列表”）。顶点可以是某种任意格式（例如，只有 float3 位置；float3 位置 + float3 normal；float3 位置 + float3 normal + float2 texcoord；等等）。因此，要定义一个几何图形，您需要：

*   定义它的顶点格式（可以是位掩码，格式列表中的枚举；...），
*   具有顶点数组，其组件交错（“交错数组”）
*   有三角形数组。

如果您在 OOP 领域，您可以将此类称为*Mesh*。

**材料- 定义如何***渲染*某些几何图形的东西。例如，在最简单的情况下，这可以是对象的颜色。或者是否应该应用照明。或者对象是否应该进行 alpha 混合。或要使用的纹理（或纹理列表）。或要使用的顶点/片段着色器。等等，可能性是无穷无尽的。首先将*您需要*的东西放入材料中。在 OOP 领域，该类可以称为（惊喜！）*Material*。

**场景**- 你有几何图形，材料集合，时间来定义场景中的内容。在一个简单的情况下，场景中的每个对象可以通过以下方式定义： - 它使用什么几何体（指向网格的指针）， - 它应该如何渲染（指向材质的指针）， - 它的位置。这可以是 4x4 变换矩阵，或 4x3 变换矩阵，或向量（位置）、四元数（方向）和另一个向量（比例）。让我们称其为OOP 领域中的*节点。*

**相机**。好吧，相机只不过是“它的放置位置”（同样，一个 4x4 或 4x3 矩阵，或位置和方向），加上一些投影参数（视野、纵横比……）。

所以基本上就是这样！您有一个场景，它是一堆引用网格和材质的节点，并且您有一个定义查看器位置的相机。

现在，将实际的 OpenGL 调用放在哪里只是一个设计问题。我会说，不要将 OpenGL 调用放入 Node 或 Mesh 或 Material 类中。相反，制作类似*OpenGLRenderer*的东西，它可以遍历场景并发出所有调用。或者，更好的是，制作独立于 OpenGL 的遍历场景的东西，并将较低级别的调用放入依赖于 OpenGL 的类中。

所以是的，以上所有内容都与平台无关。这么下去，你会发现glRotate、glTranslate、gluLookAt和朋友们都挺没用的。您已经拥有所有矩阵，只需将它们传递给 OpenGL。无论如何，这就是真实游戏/应用程序中大多数*真实代码的工作方式。*

当然，上述内容可能会因更复杂的要求而变得复杂。特别是，材料可能非常复杂。网格通常需要支持许多不同的顶点格式（例如，为了提高效率而打包法线）。场景节点可能需要按层次结构组织（这很容易 - 只需向节点添加父/子指针）。蒙皮网格和动画通常会增加复杂性。等等。

但主要思想很简单：有几何，有材质，场景中有物体。然后一小段代码就可以渲染它们。

在 OpenGL 的情况下，设置网格很可能会创建/激活/修改 VBO 对象。在渲染任何节点之前，需要设置矩阵。设置材质会触及大部分剩余的 OpenGL 状态（混合、纹理、照明、组合器、着色器……）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T12:53:02.403

**对象变换**

避免依赖 OpenGL 进行转换。通常，教程会教您如何使用转换矩阵堆栈。我不建议使用这种方法，因为您以后可能需要一些只能通过此堆栈访问的矩阵，并且使用它的时间很长，因为 GPU 总线设计为从 CPU 到 GPU 的速度很快，但不是其他方式。

**主对象**

3D 场景通常被认为是对象树，以便了解对象依赖关系。关于这棵树的根应该是什么，对象列表或主对象存在争议。

我建议使用主对象。虽然它没有图形表示，但它会更简单，因为您将能够更有效地使用递归。

**解耦场景管理器和渲染器**

I disagree with @ejac that you should have a method on each object doing OpenGL calls. Having a separate Renderer class browsing your scene and doing all the OpenGL calls will help you decouple your scene logic and OpenGL code.

This is adds some design difficulty but will give you more flexibility if you ever have to change from OpenGL to DirectX or anything else API related.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T12:39:45.253

一种标准技术是通过在 glPushAttrib/glPopAttrib 范围内对某些默认 OpenGL 状态进行所有更改来隔离对象对渲染状态的影响。在 C++ 中定义一个类，其构造函数包含

```
 glPushAttrib(GL_ALL_ATTRIB_BITS);
  glPushClientAttrib(GL_CLIENT_ALL_ATTRIB_BITS); 
```

和析构函数包含

```
 glPopClientAttrib();
  glPopAttrib(); 
```

并使用类 RAII 样式来包装任何与 OpenGL 状态混淆的代码。只要您遵循该模式，每个对象的渲染方法都会获得“干净的石板”，并且无需担心将每个可能修改过的 openGL 状态位都设置为它需要的状态。

作为优化，通常您会在应用程序启动时将 OpenGL 状态设置为尽可能接近一切所需的状态；这最大限度地减少了需要在推送范围内进行的调用次数。

坏消息是这些电话并不便宜。我从来没有真正调查过你每秒可以逃脱多少；当然足以在复杂场景中使用。最重要的是，一旦设置好状态，就尝试充分利用它们。如果你有一群兽人要渲染，用不同的着色器、纹理等来渲染盔甲和皮肤，不要迭代所有的兽人渲染盔甲/皮肤/盔甲/皮肤/...；确保您为盔甲设置了一次状态并渲染所有兽人的盔甲，然后设置为渲染所有皮肤。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-05T01:31:21.527

if you do want to *roll your own* the above answers work well enough. A lot of the principles that are mentioned are implemented in most of the open source graphics engines. [Scenegraphs](http://en.wikipedia.org/wiki/Scene_graph) are one method to move away from the direct mode opengl drawing.

[OpenScenegraph](http://www.openscenegraph.org/) is one Open Source app that gives you a large (maybe too large) library of tools for doing OO 3D graphics, there are a lot of other out there.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T11:58:27.440

我通常有一个 drawOpenGl() 函数，每个可以渲染的类都包含它的 opengl 调用。该函数从渲染循环中调用。该类包含其 opengl 函数调用所需的所有信息，例如。关于位置和方向，因此它可以进行自己的转换。

当对象相互依赖时，例如。它们构成一个更大对象的一部分，然后将这些类组合到代表该对象的另一个类中。它有自己的 drawOpenGL() 函数，该函数调用其子级的所有 drawOpenGL() 函数，因此您可以使用 push- 和 popmatrix 进行周围的位置/方向调用。

已经有一段时间了，但我想纹理可能会出现类似的情况。

如果你想在表面法线或顶点法线之间切换，那么让对象记住它的一个或另一个，并在需要时为 drawOpenGL() 调用的每个场合提供 2 个私有函数。当然还有其他更优雅的解决方案（例如使用策略设计模式或其他东西），但据我了解你的问题，这个可以工作

# c# - 编写泛型类来处理内置类型

> ID：166360
> 
> 赞同：2
> 
> 时间：2008-10-03T11:09:10.997
> 
> 标签：c#, .net, generics, oop

也许不太实用，但仍然很有趣。

有一些关于矩阵乘法的抽象问题，我很快就为整数实现了一个矩阵，然后测试了我的假设。

在这里我注意到，如果我偶尔想将它与十进制或双精度一起使用，那么仅 int 矩阵并不好。当然，我*可以*尝试将 all 转换为 double，但这并不方便。

继续假设我们可以拥有一堆可以相加和相乘的对象——为什么不在我的矩阵中使用它们呢？

因此，在考虑它是一个 Matrix 类之后，我现在面临无法使用泛型 T 的问题，我需要它来支持一些可以加法和乘法的接口。

问题是我可以在我的类中覆盖运算符，但我无法引入支持运算符的接口。而且我有一个内置类型的运算符，但仍然没有它们的接口。

考虑到您不想复制工人阶级主体，在这种情况下您会怎么做？包装器和隐式转换对我没有多大帮助，我对一个漂亮的解决方案很感兴趣。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T11:12:29.307

为此，您需要通用数学。幸运的是[我已经做到了](http://www.yoda.arachsys.com/csharp/genericoperators.html)。用法类似于此“复杂”（即 x+iy）[示例](http://csharpindepth.com/ViewNote.aspx?NoteID=50)。Operator 类现在是[MiscUtil](http://www.yoda.arachsys.com/csharp/miscutil/)的一部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T19:33:38.427

好吧，有一种技术含量较低的方法可以做到这一点。您不能为“int”或“double”添加新接口。但是您可以为一个对象声明一个接口，该接口可以乘以和添加某些泛型类型的值。然后你可以为你需要的所有类型实现接口：

```
public interface ICalculator<T>
{

   T Add(T x, T y);
   T Multiply(T x, T y);

}

public class MatrixMultiplier<T>
{

  public MatrixMultiplier(ICalculator<T> calculator) { ... }

}

public class IntCalculator : ICalculator<int>
{

  public int Add(int x, int y)
  {
    return x + y;
  }

  public int Multiply(int x, int y)
  {
    return x * y;
  }

} 
```

# vb.net - 你能在VB9中控制一个变量的类型是动态的还是静态的？

> ID：166363
> 
> 赞同：4
> 
> 时间：2008-10-03T11:09:57.893
> 
> 标签：vb.net, types, syntax

我想使用 VB9，但不确定使用什么语法来表示我希望像在 C# 中那样静态键入变量：

```
var foo = new Whatever(); 
```

在以前的 VB 版本中：

```
Dim foo = New Whatever() 
```

创建了一个动态类型的变量。

有没有一种方法可以在不实际在 VB9 中编写类型的情况下获得静态类型？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T11:12:08.183

`Option`是的，您可以通过每个文件开头或项目设置中的指令来控制此行为：

```
Option Strict Off

' The following is dynamically typed: '
Dim x = "Hello" 
```

* * *

```
Option Strict On
Option Infer On

' This is statically typed: '
Dim x = "Hello" 
```

最好将*所有*`Option Strict On`项目设置为默认值（可以在选项对话框中完成）。这保证了与 C# 中相同的键入行为。然后，如果您需要动态类型，您可以使用上述指令在每个文件的基础上选择性地禁用该设置。

 *# python - Django、mod_python、apache 和古怪的会话

> ID：166364
> 
> 赞同：2
> 
> 时间：2008-10-03T11:10:04.053
> 
> 标签：python, django, apache, session, mod-python

我在 Linux 机器上的 Apache 上通过 mod_python 运行 Django。我有一个自定义身份验证后端，以及需要对所有页面进行身份验证的中间件，静态内容除外。

我的问题是登录后，我仍然会时不时地随机进入登录屏幕。在我看来，每个 apache 进程都有自己的 python 进程，而 python 进程又拥有自己的内部结构。因此，只要我得到与登录相同的流程的服务，一切都很好而且花花公子。但是，如果我的请求由不同的 apache 进程提供服务，我将不再通过身份验证。

我检查了我用 FireBug 发送的 HTTP 标头，它们每次都是相同的，即。同样的饼干。

这是一个已知问题吗？是否有解决方法/修复？

编辑：我有一个显示大量生成图像的页面。有些关闭这些将不会显示。这是因为他们太落后于认证中间件，所以他们会随机放一个登录图像。但是，刷新此页面足够多次，它最终会起作用，这意味着所有进程都会识别我的会话。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T12:15:14.397

您对 Apache 处理进程的方式是正确的，有时您会得到另一个进程的服务。当您对您的网站进行更改时，您可以看到这一点；新流程将接受更改，但旧流程将为您提供旧站点。要获得一致性，您必须重新启动 Apache。

假设重新启动不能解决问题，我猜这是“自定义身份验证后端”中的一些东西，将部分身份验证存储在内存中（这对于 Web 服务器来说效果不佳）。我会尝试`MaxRequestsPerChild`在您的 Apache 配置中设置为 1 并查看您是否仍然获得登录屏幕。如果你这样做了，有些东西被存储在内存中，也许模型没有被保存？

希望有帮助！

PS 只是出于好奇，您为什么要使用自定义身份验证后端和中间件来确保用户登录？似乎 Django 的 contrib.auth 和 @login_required 会更容易......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T21:12:26.017

如果您使用一些全局变量来保存自定义身份验证会话的数据，则需要将其更改为使用文件、数据库或 memcached。如上所述，mod_python 启动的进程很少，它们之间没有共享内存。

我建议为此使用 memcached，还可以使用 cookie 存储会话 ID 或将其作为 GET 参数传递，以便稍后您可以轻松地从缓存中提取会话数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T04:00:50.227

我强烈建议您不要将 MaxRequestsPerChild 设置为 1，因为这会导致大量开销，因为每个进程都会被杀死并随每个请求重新生成。

您使用的是 apaches preform MPM 还是 worker MPM？

看看[http://docs.djangoproject.com/en/dev/howto/deployment/modpython/?from=olddocs](http://docs.djangoproject.com/en/dev/howto/deployment/modpython/?from=olddocs)可能会给你一些帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T12:04:32.920

您有标准的数据库驱动会话吗？设置中是否启用缓存？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-12T10:53:25.387

如何确保 Apache 重启（或停止和启动）后会话不被清除？

因为当我升级我的源代码并重新启动 Apache 时，我刷新了网页，我必须再次登录。会话丢失。

会话存储在 Memcache 中。不知道它是如何以及为什么被清除的。如何保留会话以便用户在 apache 重启后无需登录？

# ruby-on-rails - 您为 Rails 应用程序使用哪些部署目录（部署到 debian 机器）？

> ID：166370
> 
> 赞同：10
> 
> 时间：2008-10-03T11:12:38.370
> 
> 标签：ruby-on-rails, ruby, linux, deployment, mongrel

我想知道 Rails 应用程序的最佳部署目录是什么？一些开发人员使用目录，例如`/u/apps/#{appname}`. 使用代替或其他操作系统默认目录时有**什么优势吗？**`/u/apps/#{appname}``/var/www/#{appname}`

显然，我想选择具有最佳安全属性和最少摩擦的目录来设置服务器环境。

您如何部署 Rails 应用程序？为什么要使用特定目录？你觉得这真的很重要吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T12:53:29.513

正如其他人所说，将应用程序保存在哪里真的无关紧要 - 重要的是您对此保持一致，因此无论您在哪个服务器上，这只是一个通常的情况地点。

我认为人们使用 /u/apps/#{appname} 的唯一原因是它是 Capistrano 的默认设置 - 当然，我这样做似乎很奇怪。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T22:57:02.417

[FHS](http://www.pathname.com/fhs/pub/fhs-2.3.html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM)标准会建议`/srv/www/#{appname}`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T11:30:40.393

我倾向于为我运行和安装的每个 Rails 应用程序创建一个专用用户，并将该用户添加到`www-data`组中。所以，我倾向于有`/home/mephisto/www`，`/home/warehouse/www`等等。

我这样做纯粹是为了组织，我认为这并不重要。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-03T11:33:45.753

我使用 Ubuntu 并部署在 /var/rails/appname 下（下面是来自 Capistrano 的 /releases 和 /current）。

我这样做是为了在应用程序类型之间进行一点区分：rails、php、static、...

只要您正确设置权限和所有权，我认为这并不重要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-04T23:28:59.480

像其他海报一样，我认为你应该把它们放在感觉最自然的地方。`man hier`如果您想了解标准 UNIX 层次结构中的目录适用于哪些目录，请阅读。我喜欢把东西放在合乎逻辑的地方`/var`

另一个非常重要的考虑因素是，您永远不应该将 Rails 应用程序目录放在`RAILS_ROOT`Web 上可以访问的地方。因此，将整个 Rails 应用程序粘贴在常规站点的子目录中是一个很大的禁忌。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T13:58:21.143

我使用的基于 CPanel 的共享主机帐户似乎更喜欢 /home/etc/rails_apps/...

我认为这是相当随意的——只要它们不在您的公共 html 目录中。

# functional-programming - 高度可变域中的不可变功能对象

> ID：166379
> 
> 赞同：25
> 
> 时间：2008-10-03T11:16:26.850
> 
> 标签：functional-programming, immutability

我目前正在利用 Scala 的业余时间学习函数式编程，并且我有一个空闲的新手问题。

在执行诸如计算 Haar 小波变换之类的操作时，我可以看到拥有不可变对象的优雅——即当由对象表示的数据本身没有改变时。

但是我看到一个博客，其中有人在演示不变性时以一个小游戏为例。如果一个生物对象受到伤害，它不会改变它的状态——它返回一个具有新生命值和一个新的“仇恨 X”标志的新生物对象。但如果我们要设计类似 MMORPG 的东西，魔兽世界会这样说。一百名玩家在战场上……可能有数千种攻击和增益/减益法术效果以不同的方式影响他们。是否仍然可以用完全不可变的对象来设计系统？在我看来，每个“滴答”都会有一大群新实例。为了获得当前有效的对象实例，所有客户端都必须不断地通过某种中央“游戏世界”对象，或者？

函数式编程是否适用于此，或者这是“最好的工作的最佳工具，在这里可能不是一成不变的”？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-16T10:12:02.203

> 在我看来，每个“滴答”都会有一大群新实例。

确实如此。我有一个 Haskell 应用程序，它读取市场数据馈送（在 6 小时交易日的过程中，大约有 500 万条消息，用于我们感兴趣的数据）并维护各种事物的“当前状态”，例如工具的最新买卖价格和数量，我们的模型与市场的匹配程度等。在分析模式下针对记录的提要模拟该程序的运行并观察它的分配和接近 288 的 GC 是相当可怕的在运行的前 500 秒内存在 TB（或接近我机器 RAM 大小的 50,000 倍）。（如果没有分析，这个数字会高得多，因为分析不仅会减慢应用程序的速度，而且还会迫使它全部在一个内核上运行。）

但请记住，纯语言实现中的垃圾收集器针对这种行为进行了优化。我对我的应用程序的整体速度感到非常满意，而且我认为它的要求相当高，因为我们必须每秒从市场提要中解析数百条消息，进行一些相当广泛的计算来构建我们的模型，并使用它模型生成订单以尽快去交易所。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-03T13:48:40.417

通常在函数式编程中，您不会有 C++ 风格的构造函数。然后，即使从概念上讲，您一直在创建对象，但这并不意味着编译器必须编写代码来分配新对象，因为它不会影响程序的行为。由于数据是不可变的，编译器可以查看您刚刚指定的值以及传递给函数的值。

然后，编译器*可以*创建非常紧凑的编译代码，只在需要时计算特定对象中的字段。效果如何取决于您使用的编译器的质量。然而，干净的函数式编程代码告诉编译器的代码比类似程序的 C 编译器所能假设的要多得多，因此一个好的编译器*可能会*生成比您预期的更好的代码。

所以，至少在理论上，没有理由担心。函数式编程实现可以像面向对象的堆分配实现一样扩展。在实践中，您需要了解您正在使用的语言实现的质量。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T12:59:40.610

MMORPG*已经*是不变性的一个例子。由于游戏分布在服务器和游戏玩家的系统中，因此绝对没有中央“游戏世界”对象。因此，通过网络发送的任何对象都是不可变的——因为它不会被接收者更改。相反，如果有一个新对象或消息，则会作为响应发送一个新对象或消息。

我从来没有写过分布式游戏，所以我不知道它们是如何实现的，但我怀疑对象的更新要么在本地计算，要么作为差异通过网络发送。

例如，您正在玩​​命令与征服。你的猛犸坦克正处于就绪模式，守卫着你的基地。你的对手带着一辆轻型坦克接近来探索你的基地。你的猛犸坦克射击并击中对手的坦克，造成伤害。

这个游戏非常简单，所以我怀疑很多东西都是尽可能在本地计算的。假设两个玩家的计算机最初在游戏状态方面是同步的。然后你的对手点击将他的轻型坦克移动到你的基地。一条消息（不可变）通过网络发送给您。由于移动坦克的算法（可能）是确定性的，因此您的命令与征服副本可以在屏幕上移动对手的坦克，从而更新您的游戏状态（可以是不可变的或可变的）。当轻型坦克进入你的猛犸坦克射程时，你的坦克就会开火。在服务器上生成一个随机值（在这种情况下，任意选择一台计算机作为服务器）来确定击球是否击中对手。假设坦克被击中并且必须更新对手的坦克，只有差异——坦克的新装甲等级已降至 22%——通过网络发送以同步两个玩家的游戏。此消息是不可变的。

玩家计算机上代表坦克的对象是可变的还是不可变的都无关紧要；它可以以任何一种方式实现。每个玩家不会直接改变其他玩家的游戏状态。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-03T13:27:27.560

关于不变性需要注意的一点是（如果实施得当）它使对象创建相对轻量级。如果一个字段是不可变的，那么它可以在实例之间共享。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-03T13:41:37.093

在设计一个函数式程序时，重要的是要考虑，就像你所说的那样，不可变对象会有一些开销。同样重要的是要记住，通过让 MMORPG 程序中的对象是不可变的，它本质上将更具可扩展性。因此，对设备的初始投资可能会更高，但随着事情的发展，您将能够扩展到您的玩家群。

另一个需要考虑的重要事情是，现在最强大的机器每个 cpu 有 6 个内核。考虑一台双 CPU 机器，每台机器有 6 个内核。这 12 个内核中的一个可以进行垃圾收集，因此拆除大量对象的开销可以通过应用程序轻松扩展到其他 11 个内核来抵消。

另请记住，并非每个对象（及其子对象）都需要在副本上完全重建。当对象被“复制”时，任何未更改的引用类型都只会采用单个引用分配。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-04T13:50:17.980

不要考虑在线级别的对象创建。例如，函数式语言的优化运行时在替换对象和现有结构的实际 do 突变时可能能够“作弊”，如果它不知道将引用原始结构并且新结构完全替换它。想想尾递归优化，但应用于对象状态。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-02-22T09:47:34.620

我今天发现了一个博客，它完全解决了我在这篇文章中提出的问题：

[http://prog21.dadgum.com/23.html](http://prog21.dadgum.com/23.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-03T11:25:17.143

就像编程中的几乎所有工具一样，不可变对象很强大，但在错误的情况下很危险。我认为游戏示例不是一个很好的示例，或者至少非常做作。

Eric Lippert 有一些关于不变性主题的有趣[帖子](http://blogs.msdn.com/ericlippert/archive/tags/Immutability/default.aspx)，读起来很有趣。

# java - 在 java ee 5 中检索已定义角色的列表

> ID：166411
> 
> 赞同：2
> 
> 时间：2008-10-03T11:29:33.827
> 
> 标签：java, security, jakarta-ee

我想知道是否可以检索 java 代码中 web.xml 文件中定义的安全角色的完整列表？如果是这样怎么做？

我知道“isUserInRole”方法，但我也想处理请求角色但未在 web.xml 文件中定义（或拼写不同）的情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T14:29:19.353

据我所知，在 Servlet API 中无法做到这一点。但是，您可以直接解析 web.xml 并自己提取值。我在下面使用了 dom4j，但你可以使用任何你喜欢的 XML 处理东西：

```
protected List<String> getSecurityRoles() {
    List<String> roles = new ArrayList<String>();
    ServletContext sc = this.getServletContext();
    InputStream is = sc.getResourceAsStream("/WEB-INF/web.xml");

    try {
        SAXReader reader = new SAXReader();
        Document doc = reader.read(is);

        Element webApp = doc.getRootElement();

        // Type safety warning:  dom4j doesn't use generics
        List<Element> roleElements = webApp.elements("security-role");
        for (Element roleEl : roleElements) {
            roles.add(roleEl.element("role-name").getText());
        }
    } catch (DocumentException e) {
        e.printStackTrace();
    }

    return roles;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-03-17T10:52:08.343

这是使用更新的 DOM API 的 Ian 答案的版本：

```
private List<String> readRoles() {
    List<String> roles = new ArrayList<>();
    InputStream is = getServletContext().getResourceAsStream("/WEB-INF/web.xml");

    try {
        DocumentBuilder builder = DocumentBuilderFactory.newInstance().newDocumentBuilder();
        Document doc = builder.parse(new InputSource(is));

        NodeList securityRoles = doc.getDocumentElement().getElementsByTagName("security-role");
        for (int i = 0; i < securityRoles.getLength(); i++) {
            Node n = securityRoles.item(i);
            if (n.getNodeType() == Node.ELEMENT_NODE) {
                NodeList roleNames = ((Element) n).getElementsByTagName("role-name");
                roles.add(roleNames.item(0).getTextContent().trim()); // lets's assume that <role-name> is always present
            }
        }
    } catch (ParserConfigurationException | SAXException | IOException e) {
        throw new IllegalStateException("Exception while reading security roles from web.xml", e);
    } finally {
        if (is != null) {
            try {
                is.close();
            } catch (IOException e) {
                logger.warn("Exception while closing stream", e);
            }
        }
    }

    return roles;
} 
```

# .net - 如何在下拉样式控件中处理多项选择？

> ID：166417
> 
> 赞同：7
> 
> 时间：2008-10-03T11:31:38.427
> 
> 标签：.net, winforms, user-interface, controls

我有一个带有视图的 WinForms 应用程序，其中用户从组合框中的预定义时间跨度列表中选择一个时间跨度，它的 DropDownStyle 属性设置为 DropDownList。

现在，要求发生了变化。用户将需要能够从时间跨度列表中进行多项选择。

是否可以在 ComboBox 中进行多项选择？当 ComboBox 折叠时，您如何呈现这些选项？不要忘记可用性方面。

是否存在可以满足我的用户需求的其他控件（内置或第 3 方，最好是某种下拉菜单）？

**更新：**误导性标题...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-03T11:45:47.670

我同意@Thomas Owens 在可用性方面的观点。如果您选择多个项目，那么用户应该能够看到所有被选中的项目。也许一个选中的列表框可以解决这个问题。

如果您仍然对使用下拉类型的控件感兴趣，请查看 DevExpress 编辑器工具包。我刚刚浏览了他们的演示，有一个名为**[PopupContainerEdit](http://devexpress.com/Products/NET/Controls/WinForms/Editors/editors/PopupContainerEdit.xml)**的控件，它允许您弹出带有复选框的项目列表。当弹出窗口折叠时，您始终可以将项目显示为逗号分隔的列表。（尽管如果列表比框长，这可能无法使用）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-03T11:36:20.117

即使有可能，我也会建议更改输入类型。当我看到一个下拉框时，我想我必须选择一个。选择多个选项的能力（甚至如何）可能会让您的用户望而却步。从可用性的角度来看，标准列表框可能更合适。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T11:39:11.217

如果不编写一堆自定义代码，我认为它不可能开箱即用。

我不得不同意 Thomas，除了甚至建议可能使用选中列表框，因为 imo，比列表框更清楚的是要进行多项选择（并且您不需要帮助文本说多选，使用 ctrl）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T11:44:09.793

我会改用 CheckedListBox。它使多项选择可视化，您可以选择多个条目。 [这](http://msdn.microsoft.com/en-us/library/system.windows.forms.checkedlistbox.aspx)是该课程的 Microsoft 链接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T11:41:01.377

Windows.Forms.ComboBox 不能提供多选。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T11:46:31.927

您正在寻找[ListBox](http://msdn.microsoft.com/en-us/library/system.windows.forms.listbox.aspx)。

# apache - httpd 和 hsphere 下 CentOS 上的 mod_python

> ID：166418
> 
> 赞同：0
> 
> 时间：2008-10-03T11:31:59.797
> 
> 标签：apache, mod-python, centos5

我已经要求我们的托管服务提供商将 mod_python 添加到我们的 httpd 服务器。服务器似乎在一个 hsphere 集群中，他们似乎使用 yum 来管理它。他报告缺少一些依赖项，我不太明白这是怎么发生的。

版本（这与我得到的一样多）：CentOS 5 apache - 2（但他不确定确切的版本） mod_python - 3.3.1 numpy - 1.1.1 scipy - 0.6.0 yum - 3.2.8 hsphere - 3.1补丁1

他报告的错误如下：

```
yum install mod_python
...
Package mod_python.i386 0:3.2.8-3.1 set to be updated
Processing Dependency: httpd >- 2.0.40 for package: mod_python
Processing Dependency: httpd-mmn = 20051115 for package: mod_python
Finished Dependency Resolution
Error: Missing Dependency: httpd >= 2.0.40 is needed by package mod_python
Error: Missing Dependency: httpd-mmn = 20051115 is needed by package mod_python 
```

作为一名 UNIX 管理员，我对此只有一个天真的猜测，但该消息似乎表明 httpd 和 mod_python 之间存在版本不匹配，而不是完全缺少依赖项。

所以我的问题是，我应该问/告诉管理员做什么？

上面的组件组合有什么明显的错误吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-05T01:14:47.387

我们在 CentOS 上的 Apache 2.2 上运行了 mod_python 3.3（忘记了版本）。我们所做的只是下载 tar.gz（来自[http://httpd.apache.org/modules/python-download.cgi](http://httpd.apache.org/modules/python-download.cgi)），解压...

```
$ ./configure --with-apxs=/usr/local/apache2/bin/apxs
$ ./make
$ su
$ make install 
```

一切正常。我们不能使用 yum，所以一切都是从源代码构建的。我的建议是尝试从源代码构建。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T09:17:10.237

也遇到同样的问题

--> 运行事务检查 ---> 包 mod_python.i386 0:3.2.8-3.1 设置为更新 --> 处理依赖：httpd >= 2.0.40 for package: mod_python --> 处理依赖：httpd-mmn = 20051115 for package: mod_python --> Finished Dependency Resolution Error: Missing Dependency: httpd >= 2.0.40 is needed by package mod_python Error: Missing Dependency: httpd-mmn = 20051115 is required by package mod_python

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T18:15:57.720

我的第一反应是`yum update apache`（或只是`yum update`）。

然后尝试`yum install mod_python`.

# printing - 如何构建一个用于打印的网页，这样它就不会在页面上严重拆分？

> ID：166424
> 
> 赞同：7
> 
> 时间：2008-10-03T11:34:39.823
> 
> 标签：printing, page-break

我有一个生成长报告的 Web 应用程序，我需要打印它。如果我只是打印页面，它将在物理页面的末尾中断。如何计算在网页中的中断位置，以便页面在打印时与物理页面对齐？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-03T11:46:59.430

我们有一个系统可以打印出选定订单的发票，其中放置了一个

```
<br style="page-break-before:always;"> 
```

每张发票之间。这意味着每张发票都会进入一个新页面。

使用打印样式表也是一个好习惯

```
<link rel="stylesheet" href="print.css" type="text/css" media="print" /> 
```

它可以隐藏/显示页面的相关区域。当有人想要实际页面内容时，没有必要打印出 leftnav 链接等。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-03T11:39:38.860

*   [分页媒体](http://www.w3.org/TR/CSS2/page.html)
*   [打印参考](http://www.w3schools.com/CSS/css_ref_print.asp)
    *   [分页后](http://www.w3schools.com/CSS/pr_print_pageba.asp)( [MDN](https://developer.mozilla.org/en/CSS/page-break-after) )
    *   [分页前](http://www.w3schools.com/CSS/pr_print_pagebb.asp)( [MDN](https://developer.mozilla.org/en/CSS/page-break-before) )
    *   [内部分页](http://www.w3schools.com/CSS/pr_print_pagebi.asp)符( [MDN](https://developer.mozilla.org/en/CSS/page-break-inside) )

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T11:41:42.373

我通常避免一起打印网页 (HTML)。如果需要格式化打印，我会生成 PDF 或 CSV/电子表格格式供我的客户以他们想要的任何方式打印。

我通常生成供全球使用的打印件，这意味着所有类型的设置都因工作场所而异（例如纸张尺寸：Legal、Letter、A4 等）。我发现这是一项太大的任务，无法保证任何地方的审美输出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T11:44:41.963

有一个 css 属性可以尝试确保分页符的位置。您可以为元素指定规则`page-break-before: always`或 page-break-after: always` 以指示中断应该在元素之前还是之后。这对跨浏览器的支持很差，我不会依赖它。有关详细信息，请参阅[http://www.w3schools.com/CSS/pr_print_pageba.asp 。](http://www.w3schools.com/CSS/pr_print_pageba.asp)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T11:42:25.913

要么使用 CSS[`page-break-before/after`](http://www.w3schools.com/Css/css_ref_print.asp)

其他方法：

*   使用[JasperReports](http://jasperforge.org/plugins/project/project_home.php?group_id=102)并将数据加载到报告中，而不是 html 页面
*   使用带有 XSL 的[Apache FOP](http://xmlgraphics.apache.org/fop/)将您的 HTML（或原始数据）转换为 FOP，然后再转换为 PDF

这两种方法都相当广泛，所以如果你不想花一些精力，最好直接跳到另一个答案....

# c# - NHibernate 多对多关系表中的附加字段

> ID：166426
> 
> 赞同：3
> 
> 时间：2008-10-03T11:35:36.967
> 
> 标签：c#, .net, nhibernate

当我与 nhibernate 具有多对多关系并让 nhibernate 生成我的数据库模式时，它会添加一个包含相关实体主键的附加表。是否可以为此添加其他字段并访问它们，而不必手动使用 sql 进行麻烦？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-03T11:45:22.210

我不认为那是可能的。如果您说关系具有某种状态而不是本质上它本身就是一个对象，应该这样对待（映射）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T13:06:20.143

同意贾斯珀。在这种情况下，您要建模的不是关系，而是实体本身，与其他两个实体有 1-N 和 N-1 个关系。

并不是 NHibernate 无法处理它，而是您根本无法对其建模。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-11T17:05:33.623

在这种情况下，您将如何在新实体的映射文件中构建（充当两个初始表之间的桥梁）？在我的例子中，这个链接表有两个外键（int），每个初始表一个外键，加上一些其他字段（startDate，endDate）

问题是，在我的新实体中，我没有这两个外键的属性。我只有一个属性是外键指向的实体类型。

# python - 清除列表

> ID：166431
> 
> 赞同：8
> 
> 时间：2008-10-03T11:37:23.110
> 
> 标签：python, memory-management, refactoring, list

我发现我无法清除列表很烦人。在这个例子中：

```
a = []
a.append(1)
a.append(2)

a = [] 
```

我第二次将 a 初始化为一个空白列表，它创建了一个列表的新实例，它在内存中的不同位置，所以我不能用它来引用第一个，更不用说它效率低下。

我可以看到保留相同指针的唯一方法是执行以下操作：

```
for i in range(len(a)):
    a.pop() 
```

不过，这似乎很冗长，有没有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-03T11:40:52.297

您正在寻找：

```
del L[:] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T11:45:20.073

我不确定你为什么担心你在内存中引用一个新的空列表而不是同一个“指针”。

你的另一个列表迟早会被收集起来，使用高级垃圾收集语言工作的一大好处是你通常不需要担心这样的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-07-26T09:59:59.980

***这可以帮助你::)***

```
L[:] = [] 
```

# design-patterns - Log4Net Wrapper 类会是什么样子？

> ID：166438
> 
> 赞同：56
> 
> 时间：2008-10-03T11:39:24.213
> 
> 标签：design-patterns, log4net

我一直在寻找 .net (c#) 的日志记录框架，并在阅读了 stackoverflow 上的几个问答线程后决定试一试 log4net。我看到人们一遍又一遍地提到他们使用 log4net 的包装类，我想知道那会是什么样子。

我将我的代码分成不同的项目（数据访问/业务/webservice/..）。log4net 包装器类会是什么样子？包装类是否需要包含在所有项目中？我应该将它作为一个单独的项目一起构建吗？

包装器应该是单例类吗？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-03T11:49:54.603

本质上，您创建了一个接口，然后是该接口的具体实现，它直接包装了 Log4net 的类和方法。可以通过创建包装这些系统的其他类和方法的更具体的类来包装其他日志记录系统。最后，使用工厂根据配置设置或代码行更改创建包装器的实例。（注意：您可以使用诸如[StructureMap之类](http://structuremap.sourceforge.net/Default.htm)[的控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)容器变得更加灵活和复杂。）

```
public interface ILogger
{
    void Debug(object message);
    bool IsDebugEnabled { get; }

    // continue for all methods like Error, Fatal ...
}

public class Log4NetWrapper : ILogger
{
    private readonly log4net.ILog _logger;

    public Log4NetWrapper(Type type)
    {
        _logger = log4net.LogManager.GetLogger(type);
    }

    public void Debug(object message)
    {
        _logger.Debug(message);
    }

    public bool IsDebugEnabled
    {
        get { return _logger.IsDebugEnabled; }
    }

    // complete ILogger interface implementation
}

public static class LogManager
{
    public static ILogger GetLogger(Type type)
    {
        // if configuration file says log4net...
        return new Log4NetWrapper(type);
        // if it says Joe's Logger...
        // return new JoesLoggerWrapper(type);
    }
} 
```

以及在您的类中使用此代码的示例（声明为静态只读字段）：

```
private static readonly ILogger _logger =
    LogManager.GetLogger(MethodBase.GetCurrentMethod().DeclaringType); 
```

您可以使用以下方法获得相同的性能更友好的效果：

```
private static readonly ILogger _logger = 
    LogManager.GetLogger(typeof(YourTypeName)); 
```

前一个示例被认为更易于维护。

您不希望创建一个 Singleton 来处理所有日志记录，因为 Log4Net 记录调用类型；让每种类型都使用自己的记录器，而不是只在日志文件中查看报告所有消息的单一类型，它会更加清晰和有用。

因为您的实现应该是相当可重用的（您组织中的其他项目），您可以将其作为自己的程序集，或者最好将其包含在您自己的个人/组织的框架/实用程序程序集中。不要在每个业务/数据/UI 程序集中单独重新声明类，这是不可维护的。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-26T02:52:23.027

假设您要使用类似[cfeduke 上面的答案](https://stackoverflow.com/questions/166438/what-would-a-log4net-wrapper-class-look-like/166477#166477)，您还可以`LogManager`像这样添加重载：

```
public static ILogger GetLogger()
{
    var stack = new StackTrace();
    var frame = stack.GetFrame(1);
    return new Log4NetWrapper(frame.GetMethod().DeclaringType);
} 
```

这样，您现在可以在代码中使用：

```
private static readonly ILogger _logger = LogManager.GetLogger(); 
```

而不是其中任何一个：

```
private static readonly ILogger _logger =
    LogManager.GetLogger(MethodBase.GetCurrentMethod().DeclaringType);
private static readonly ILogger _logger = 
    LogManager.GetLogger(typeof(YourTypeName)); 
```

这实际上等效于第一个替代方案（即使用 的替代方案`MethodBase.GetCurrentMethod().DeclaringType`），只是简单一点。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-03T12:30:30.387

您打算从为 log4net 编写包装器中获得什么好处。我建议先熟悉 log4net 类，然后再围绕它们编写包装器。cfeduke 关于如何编写所述包装器的回答是正确的，但除非您需要向他的示例添加实际功能，否则包装器只会成功减慢日志记录过程并为未来的维护者增加复杂性。当 .Net 中可用的重构工具使此类更改变得超级容易时，尤其如此。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-02-02T22:23:00.907

我已经成功地将 log4net 依赖项隔离到一个项目中。如果您打算这样做，这是我的包装类的样子：

```
using System;

namespace Framework.Logging
{
    public class Logger
    {
        private readonly log4net.ILog _log;

        public Logger()
        {
            _log = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);
        }

        public Logger(string name)
        {
            _log = log4net.LogManager.GetLogger(name);
        }

        public Logger(Type type)
        {
            _log = log4net.LogManager.GetLogger(type);
        }

        public void Debug(object message, Exception ex = null)
        {
            if (_log.IsDebugEnabled)
            {
                if (ex == null)
                {
                    _log.Debug(message);
                }
                else
                {
                    _log.Debug(message, ex);
                }
            }
        }

        public void Info(object message, Exception ex = null)
        {
            if (_log.IsInfoEnabled)
            {
                if (ex == null)
                {
                    _log.Info(message);
                }
                else
                {
                    _log.Info(message, ex);
                }
            }
        }

        public void Warn(object message, Exception ex = null)
        {
            if (_log.IsWarnEnabled)
            {
                if (ex == null)
                {
                    _log.Warn(message);
                }
                else
                {
                    _log.Warn(message, ex);
                }
            }
        }

        public void Error(object message, Exception ex = null)
        {
            if (_log.IsErrorEnabled)
            {
                if (ex == null)
                {
                    _log.Error(message);
                }
                else
                {
                    _log.Error(message, ex);
                }
            }
        }

        public void Fatal(object message, Exception ex = null)
        {
            if (_log.IsFatalEnabled)
            {
                if (ex == null)
                {
                    _log.Fatal(message);
                }
                else
                {
                    _log.Fatal(message, ex);
                }
            }
        }
    }
} 
```

并且不要忘记在`AssemblyInfo.cs`接口项目中添加这个（花了我几个小时才找到这个）

```
[assembly: log4net.Config.XmlConfigurator(Watch = true, ConfigFile = "log4net.config")] 
```

并将您的 log4net 配置 xml 放入`log4net.config`文件中，将其设置为`Content`，`Copy Always`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-07-15T11:17:50.433

有一些框架，如[WPF 的 Prism 库，](https://msdn.microsoft.com/en-us/library/ff648465.aspx)可以促进对您选择的日志框架使用[外观。](https://en.wikipedia.org/wiki/Facade_pattern)

这是一个使用[log4net](https://logging.apache.org/log4net/)的示例：

```
using System;
using log4net;
using log4net.Core;
using Prism.Logging;

public class Log4NetLoggerFacade : ILoggerFacade
{
    private static readonly ILog Log4NetLog = LogManager.GetLogger(typeof (Log4NetLoggerFacade));

    public void Log(string message, Category category, Priority priority)
    {
        switch (category)
        {
            case Category.Debug:
                Log4NetLog.Logger.Log(typeof(Log4NetLoggerFacade), Level.Debug, message, null);
                break;
            case Category.Exception:
                Log4NetLog.Logger.Log(typeof(Log4NetLoggerFacade), Level.Error, message, null);
                break;
            case Category.Info:
                Log4NetLog.Logger.Log(typeof(Log4NetLoggerFacade), Level.Info, message, null);
                break;
            case Category.Warn:
                Log4NetLog.Logger.Log(typeof(Log4NetLoggerFacade), Level.Warn, message, null);
                break;
            default:
                throw new ArgumentOutOfRangeException(nameof(category), category, null);
        }
    }
} 
```

请注意，通过指定 ，[`callerStackBoundaryDeclaringType`](https://logging.apache.org/log4net/release/sdk/html/M_log4net_Core_ILogger_Log_1.htm)您仍然可以获得发出日志记录请求的调用者的类名。您需要做的就是`%C %M`在您的转换模式中包含：

```
<layout type="log4net.Layout.PatternLayout">
    <conversionPattern value="%date [%thread] %-5level %C.%M - %message%newline" />
</layout> 
```

但是，正如[文档](https://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html)警告的那样，生成调用者类信息的速度很慢，因此必须明智地使用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T11:45:47.873

我的理解是，log4net 的包装类将是一个静态类，负责从 app.config/web.config 或通过代码（例如与 NUnit 集成）初始化日志对象。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T11:45:49.743

log4net 包装器的一个可能用途可能是通过反射获取调用类和方法的类，以了解您的日志记录条目发生的位置。至少我经常使用这个。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-17T09:02:38.963

Alconja，我喜欢你使用堆栈跟踪跳回调用方法的想法。我正在考虑进一步封装调用，不仅要检索记录器对象，还要执行实际执行记录。我想要的是一个通过从使用的特定实现中抽象来处理日志记录的静态类。IE

```
LoggingService.LogError("my error message"); 
```

这样，如果我以后决定使用另一个日志系统，我只需要更改静态类的内部结构。

所以我用你的想法使用堆栈跟踪来获取调用对象：

```
public static class LoggingService
{
    private static ILog GetLogger()
    {    
        var stack = new StackTrace();    
        var frame = stack.GetFrame(2);    
        return log4net.LogManager.GetLogger(frame.GetMethod().DeclaringType);
    }

    public static void LogError(string message)
    {
        ILog logger = GetLogger();
        if (logger.IsErrorEnabled)
            logger.Error(message);
    }
    ...
} 
```

有人看到这种方法有问题吗？

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2010-12-06T19:39:20.817

我知道这个答案已经晚了，但它可能会在未来帮助某人。

听起来您想要 XQuiSoft Logging 为您提供的编程 API。您不必使用 XQuiSoft 指定您想要的记录器。就这么简单：

Log.Write(Level.Verbose, "source", "category", "your message here");

然后通过配置，您可以按来源、类别、级别或任何其他自定义过滤器将消息定向到不同的位置（文件、电子邮件等）。

有关介绍，请参阅[本文](http://www.codeproject.com/KB/cs/XQuiSoftLoggingIntro.aspx)。

# c# - System.IO.ReadAllxxx / WriteAllxxx 方法的性能

> ID：166452
> 
> 赞同：2
> 
> 时间：2008-10-03T11:43:05.117
> 
> 标签：c#, .net, performance, file-io, .net-3.0

System.IO.File.ReadAllxxx / WriteAllxxx 方法与 Web 上的 StreamReader / StremWriter 类是否有任何性能比较。您认为在 .net 3.0 中读取/写入文本文件的最佳方式（从性能角度来看）是什么？

当我检查**[System.IO.File 类的 MSDN 页面时](http://msdn.microsoft.com/en-us/library/system.io.file.aspx)**，在示例代码中 MS 使用 StreamReader / StreamWriter 进行文件操作。是否有任何具体原因避免使用 File.ReadAllxxx / WriteAllxxx 方法，即使它们看起来更容易理解？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T12:07:12.727

如果您打算支持加载/保存非常大的文件，您可能不想使用 File.ReadAllxxx / WriteAllxxx。

换句话说，对于您打算在编辑**千兆字节**大小的文件时保持可用的编辑器，您需要一些带有 StreamReader/StreamWriter 和搜索的设计，因此您只加载文件中可见的部分。

对于没有这些（罕见）要求的任何事情，我会说采取简单的方法并使用 File.ReadAllxxx / WriteAllxxx。它们只是在内部使用与您手动编码相同的 StreamReader/Writer 模式，正如 aku 所示。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T11:52:14.163

File.ReadAllText 和类似方法在内部使用 StreamReader/Writers，因此性能应该与您自己执行的任何操作相当。

我会说尽可能使用 File.XXX 方法，它使您的代码 a) 更易于阅读 b) 不太可能包含错误（在您自己编写的任何 impl 中）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T12:13:58.877

除非您正在执行某些操作，例如将多行匹配的正则表达式应用于文本文件，否则您通常希望避免 ReadAll/WriteAll。以更小更易于管理的块来做事几乎总能带来更好的性能。

例如，从数据库中读取表格并将其发送到客户端的 Web 浏览器应该在小集合中完成，这利用了小型网络消息的性质并减少了处理计算机内存的使用。没有理由在 Web 服务器的内存中缓冲 10,000 条记录并一次全部转储。文件系统也是如此。如果您关心许多少量数据的写入性能 - 例如底层文件系统中用于分配空间的内容以及开销是什么 - 您可能会发现这些文章很有启发性：

[Windows 文件缓存使用情况](http://dotnetperls.com/Content/Windows-File-Cache.aspx)

[文件读取基准](http://dotnetperls.com/Content/File-Read-Benchmarks.aspx)

澄清：如果您正在执行 ReadAll 后跟 String.Split('\r') 以获取文件中所有行的数组，并使用 for 循环处理每一行代码，这通常会导致更糟性能比逐行读取文件并在每一行上执行您的过程。这不是一个硬性规定——如果您有一些处理需要花费大量时间，通常最好尽快释放系统资源（文件句柄）。然而，在写入文件方面，将任何转换过程的结果（例如在大型项目列表上调用 ToString() ）每个项目转储几乎总是比将其缓冲在内存中更好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T06:33:32.847

这篇[MSR](http://research.microsoft.com/apps/pubs/default.aspx?id=64538) (Microsoft Research) 论文是一个好的开始，他们还记录了许多点工具，例如 IOSpeed、FragDisk 等……您可以在您的环境中使用和测试这些工具。

您还可以阅读有关如何最大化顺序 IO的[更新报告/演示文稿。](http://research.microsoft.com/en-us/um/siliconvalley/projects/sequentialio/)非常有趣的东西，因为他们揭穿了“移动 HD 磁头是最耗时的操作”的神话，他们还完整记录了他们的测试环境和相关配置，包括主板、raid 控制器和几乎所有相关信息，供您复制他们的工作。一些亮点是 Opteron / XEON 是如何匹配的，但他们随后还将它们与疯狂\炒作的 NEC Itanium（32 或 64 proc 或其他东西）进行了比较。从这里的第二个链接，您可以找到更多关于如何测试和评估高吞吐量场景和需求的资源。

在同一研究主题中的其他一些 MSR 论文涉及关于在哪里最大化您的支出的指导（例如 RAM、CPU、磁盘 Spindals ......等）以适应您的使用模式......所有这些都非常简洁。

然而，其中一些已经过时了，但通常较旧的 API 无论如何都是更快/低级的；）

我目前使用 C#、C++/CLI、本机代码和位图缓存 (rtl*bitmap) 的组合在专用的应用服务器上推送数十万 TPS。

小心;

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T12:38:02.900

其他人已经解释了性能，所以我不会添加它，但是我会补充一点，当辅助方法不可用时，MSDN 代码示例很可能是在 .NET 2.0 之前编写的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T12:05:27.817

@Fredrik Kalseth 是对的。File.ReadXXX 方法只是 StreamReader 类的方便包装器。

例如这里是[File.ReadAllText的一个实现](http://msdn.microsoft.com/en-us/library/system.io.file.readalltext.aspx)

```
public static string ReadAllText(string path, Encoding encoding)
{
    using (StreamReader reader = new StreamReader(path, encoding))
    {
        return reader.ReadToEnd();
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-04T03:44:05.940

此链接具有读取 50+K 行的基准，并表明流式阅读器的速度大约快 40%。

[http://dotnetperls.com/Content/File-Handling.aspx](http://dotnetperls.com/Content/File-Handling.aspx)

# maven-2 - 如何在没有 svn:externals 的情况下使用 Maven 模块？

> ID：166472
> 
> 赞同：1
> 
> 时间：2008-10-03T11:47:04.173
> 
> 标签：maven-2, build-automation

我从来没有完全理解我将如何/为什么要使用 Maven 模块（反应堆构建）。

我们有数十个库，我们在产品之间以及库之间共享（作为依赖项）。如果我们要切换到使它们成为 Maven 模块，我们将如何在 SVN 和我们的工作副本中进行设置？

Maven 模块真的需要是子文件夹吗？它们是否也需要成为 SVN 存储库中的子文件夹？

假设您只需要工作副本中的子文件夹，我想`svn:externals`可以使“util”库同时成为多个项目的模块。但是我读过很多关于使用的坏事，`svn:externals`因为没有什么可以阻止你修改外部代码，但它没有被跟踪。

有什么建议么？我错过了模块上的船吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T13:12:02.393

不......只有当子项目集成到父项目以创建更大的工件时，才应使用模块化项目，因此示例可能是企业项目，其中您的模块包含 EJB（服务器和客户端）、WAR、然后将它们组合成一个 EAR 文件。这种模块化只是为了方便起见，如果愿意，可以跳过。

在可重用库的情况下，使它们成为独立项目并将它们部署到共享存储库。然后必须在使用它们的项目中将它们作为依赖项引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T21:54:49.907

我想这是颠覆的问题。这会迫使您创建用于分支的文件夹结构。其他版本控制系统允许在文件夹结构中不可见的情况下进行分支，这样可以更轻松地创建 Maven 模块。

我使用了一个包含 250 多个模块的产品，它们驻留在“逻辑”maven 模块中，仅表示一个功能区域。例如“CoreService”、“Utilities”和“Applications”。我们很高兴为此使用 maven 模块，因为我们可以确保所有 CoreServices 都使用某个版本的某个依赖项，并且所有应用程序都将某个 aspectJ 库编织到其中。

**但是，对于您的解决方案：**

subversion 中有一个功能可以让模块找到它的父级**`relativePath`**，它是标签中的一个`parent`标签。将子项目放在其父文件夹中的唯一原因是为了在构建父项目时可以将它们放入反应器中。子项目仍然可以单独构建（和安装）。

在 subersion 1.5 中还增强了对`svn:externals`允许相对 URL:s 的支持，在这种情况下也应该派上用场。

- 祝你好运，如果你找到解决方案，请在这里报告！

# c++ - msbuild：在命令行中设置特定的预处理器#define

> ID：166474
> 
> 赞同：27
> 
> 时间：2008-10-03T11:47:24.717
> 
> 标签：c++, visual-studio, msbuild

在 C++ 文件中，我有这样的代码：

```
#if ACTIVATE
#   pragma message( "Activated" )
#else
#   pragma message( "Not Activated")
#endif 
```

我想使用 msbuild 命令行将此 ACTIVE 定义设置为 1。

它尝试了这个，但它不起作用：

```
msbuild /p:DefineConstants="ACTIVATE=1" 
```

任何的想法？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2013-01-07T23:51:08.660

我参加聚会有点晚了（只有 4 年左右），但我只需要在一个项目中解决这个问题，并在寻找解决方案时偶然发现了这个问题。我们的解决方案是使用带有`/D`定义的环境变量，并结合 Visual Studio 中的“附加选项”框。

1.  在 Visual Studio 中，将环境变量宏 , 添加`$(ExternalCompilerOptions)`到项目选项->C/C++->命令行下的附加选项（记住调试和发布配置）
2.  在调用 msbuild 之前设置环境变量。使用`/D`编译器选项来定义你的宏

```
 c:\> set ExternalCompilerOptions=/DFOO /DBAR 
    c:\> msbuild 
```

项目 #1 在 vcxproj 文件中最终看起来像这样：

```
 <ClCompile>
      <AdditionalOptions>$(ExternalCompilerOptions) ... </AdditionalOptions>
    </ClCompile> 
```

这适用于 VS 2010。我们从各种构建脚本驱动 msbuild，因此环境变量 ugliness 被隐藏了一点。`/DACTIVATE=1`请注意，当您需要将定义设置为特定值 ( )时，我没有测试这是否有效。我认为它会起作用，但我担心那里有多个'='。

H^2

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-03T12:22:52.557

C++ 项目（和解决方案）尚未（还？）集成到 MSBuild 环境中。作为构建过程的一部分，将调用[VCBuild 任务](http://msdn.microsoft.com/en-us/library/8xcy2245.aspx)，它只是[vcbuild.exe](http://msdn.microsoft.com/en-us/library/hw9dzw3c.aspx)的包装器。

你可以 ：

*   为您的解决方案创建一个特定的配置`ACTIVATE=1`，并使用[devenv.exe](http://msdn.microsoft.com/en-us/library/xee0c8y7.aspx)（使用[/ProjectConfig](http://msdn.microsoft.com/en-us/library/abtk353z.aspx)开关）对其进行编译。
*   创建您自己的目标文件以包装您自己对[VCBuild 任务](http://msdn.microsoft.com/en-us/library/8xcy2245.aspx)的调用（请参阅 Override 参数）...
*   ~~使用 vcbuild.exe 而不是 msbuild.exe。~~（vcbuild.exe 似乎没有等效的 Override 参数）。

请注意，除非您稍微调整项目文件，否则您的解决方案也不适用于 C# 项目。作为参考，我将这样做：

*   在调用之前添加以下代码`<Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />`：

```
<PropertyGroup Condition=" '$(MyConstants)' != '' ">
  <DefineConstants>$(DefineConstants);$(MyConstants)</DefineConstants>
</属性组>
```

*   像这样调用 MSBuild：

```
msbuild /p:MyConstants="ACTIVATE=1"
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-03T12:03:28.413

我想你想要：

```
/p:DefineConstants=ACTIVATE 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-04-01T15:23:24.127

如果您需要定义一些常量（不仅仅是`true`/ `false`），您可以通过以下方式进行：

在命令行上：

```
MSBuild /p:MyDefine=MyValue 
```

在 vcxproj 文件中（在`<ClCompile>`; 和/或部分`<ResourceCompile>`，取决于您需要它的位置）：

```
<PreprocessorDefinitions>MY_DEFINE=$(MyDefine);$(PreprocessorDefinitions)</PreprocessorDefinitions> 
```

请注意，如果您未`/p:MyDefine=MyValue`在调用中指定，`MSBuild`则空字符串将分配给`MY_DEFINE`宏。如果你觉得没问题，就是这样。如果没有，请继续阅读。

**如果未指定相应的 MSBuild 参数，如何使宏未定义**

要使`MY_DEFINE`宏未定义而不是空字符串，您可以使用以下技巧：

```
<ClCompile>
  ....
  <PreprocessorDefinitions>_DEBUG;_CONSOLE;OTHER_UNCONDITIONAL_MACROS;%(PreprocessorDefinitions)</PreprocessorDefinitions>
  <PreprocessorDefinitions Condition="'$(MyDefine)'!=''">MY_DEFINE=$(MyDefine);%(PreprocessorDefinitions)</PreprocessorDefinitions>
  ....
</ClCompile> 
```

首先`PreprocessorDefinitions`定义无条件宏。第二个在非空字符串时`PreprocessorDefinitions`另外定义`MY_DEFINE`宏。`MyDefine`您可以通过将以下代码放入您的 cpp 文件来对此进行测试：

```
#define STRINGIZE2(x) #x
#define STRINGIZE(x) STRINGIZE2(x)

#ifndef MY_DEFINE
#pragma message("MY_DEFINE is not defined.")
#else
#pragma message("MY_DEFINE is defined to: [" STRINGIZE(MY_DEFINE) "]")
#endif 
```

并运行：

```
> MSBuild SandBox.sln /p:Configuration=Debug /p:MyDefine=test /t:Rebuild
...
MY_DEFINE is defined to: [test]
...

> MSBuild SandBox.sln /p:Configuration=Debug /p:MyDefine= /t:Rebuild
...
MY_DEFINE is not defined.
...

> MSBuild SandBox.sln /p:Configuration=Debug /t:Rebuild
...
MY_DEFINE is not defined.
... 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2018-04-03T12:45:38.303

**使用 CL 环境变量定义预处理器宏**

在调用 MSBUILD 之前，只需使用 '/D' 选项设置环境变量 'CL'，如下所示：

`set CL=/DACTIVATE`定义激活

您可以使用“#”符号替换“=”符号

`set CL=/DACTIVATE#1`将定义 ACTIVATE=1

然后拨打 MSBUILD

More documentation on the CL Environment Variables can be found at: [https://msdn.microsoft.com/en-us/library/kezkeayy(v=vs.140).aspx](https://msdn.microsoft.com/en-us/library/kezkeayy(v=vs.140).aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-03-05T17:01:10.733

回答这么老的问题也许是个坏主意，但最近我用谷歌搜索了一个类似的问题，发现了这个话题。我为一些构建系统编写了一个 cmd 脚本，我成功地找到了解决方案。我把它留在这里留给后代（：

根据@acemtp 的问题，我的解决方案如下所示：

```
@echo off

:: it is considered that Visual Studio tools are in the PATH
if "%1"=="USE_ACTIVATE_MACRO" (
    :: if parameter USE_ACTIVATE_MACRO is passed to script
    :: the macro ACTIVATE will be defined for the project
    set CL=/DACTIVATE#1
)
call msbuild /t:Rebuild /p:Configuration=Release 
```

UPD：我尝试使用`set CL=/DACTIVATE=1`，它也有效，但[官方文档](https://msdn.microsoft.com/en-us/library/hhzbb5c8(v=vs.120).aspx)建议使用**数字符号**

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-20T00:04:26.410

我也需要这样做——需要能够构建我的应用程序的两个不同版本，并希望能够使用 VCBUILD 编写构建脚本。VCBUILD 确实有 /override 命令行开关，但我不确定它是否可用于修改 #define 符号，然后可以使用 #if 条件编译对其进行测试。

我想出的解决方案是编写一个简单的实用程序来创建一个头文件，该文件根据环境变量的状态#defined 符号并从预构建步骤运行该实用程序。在每次执行 VCBUILD 步骤之前，脚本会设置环境变量并“接触”应用程序中的文件以确保执行预构建步骤。

是的，这是一个丑陋的黑客，但这是我能想到的最好的！

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-07-03T11:25:00.677

对于 VS2010 及更高版本，请[在此处](https://stackoverflow.com/a/17446623/128384)查看我的答案，以获取不需要修改原始项目文件的解决方案。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2017-08-23T10:23:20.653

正如@bigh_29 所提到的，使用环境变量来定义或取消定义预处理器。

他建议取消定义预处理器的方法实际上是**/U** ACTIVATE。

这样，任何匹配 ACTIVATE 的预处理器都将被否定，并且编译器不会通过您的 #if ACTIVATE #endif 附件。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-10-03T12:07:15.333

应该是：

```
#ifdef ACTIVATE
#   pragma message( "Activated" )
#else
#   pragma message( "Not Activated")
#endif 
```

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2008-10-07T10:48:53.913

答案是：你不能

# php - PHP - 自定义错误处理。重定向的 404 被 AVG Anti-Virus 劫持。如何停止？

> ID：166482
> 
> 赞同：1
> 
> 时间：2008-10-03T11:54:30.930
> 
> 标签：php, http-headers, http-status-code-404, antivirus

我有一个网站，它使用 PHP/Apache 中的自定义 404 错误处理来显示特定页面。
例如[http://metachat.org/recent](http://metachat.org/recent)

我觉得这是一种不好的做法，但这是我继承的代码......

尽管该页面在大多数浏览器上都能正确显示，但我遇到了 AVG Anti-Virus 劫持页面并将其重定向到非现场 404 页面的情况。

我试图在 PHP 中使用 header 命令强制一个标题（状态：200 OK），但是如果我对页面执行 curl -I，我会得到以下内容......

```
HTTP/1.1 404 Not Found
Date: Fri, 03 Oct 2008 11:43:01 GMT
Server: Apache/2.0.54 (Debian GNU/Linux) DAV/2 SVN/1.1.4 PHP/4.3.10-16 mod_ssl/2
.0.54 OpenSSL/0.9.7e
X-Powered-By: PHP/4.3.10-16
Status: 200 OK
Content-Type: text/html 
```

我猜第一行是 AVG 为其强制重定向设置的陷阱。如果不重写软件以使用 Mod_rewrite（我不太了解），我如何（在 PHP 中）在显示此页面时停止在标题中发送“HTTP:/1/1 404 Not Found”行？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T11:59:34.053

除了使用 URL 重写 (mod_rewrite) 或创建丢失的页面之外，别无他法。发生的事情是客户端请求一个不存在的页面。Apache 配置为在出现 404 错误时提供特殊页面，但它仍会发送 404 状态代码，然后 AVG 会捕获它。

因此，您可以执行以下操作：

```
RewriteEngine On
RewriteCond %{REQUEST_URI} !-f
RewriteCond %{REQUEST_URI} !-d
RewriteRule (.*) index.php?missing_content=$1 
```

这将使用 missing_content 查询字符串参数中的 URL 路径将不存在的所有内容（因此会给出 404）重写到您的 index.php

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T12:00:07.873

如果您得到的是*页面未找到*错误，**请不要**让它发送状态 200 OK。请。

这是人们出于任何原因所做的最烦人的“技巧”之一。如果用户请求的页面不存在，请告诉他以及他的浏览器。对于搜索引擎，否则将抓取/缓存您的自定义错误页面，认为这是实际响应。

如果有人安装了一些显示其他内容而不是您的 404 的软件，这是他自己的问题，不要试图与之抗争，使您的服务对浏览器撒谎:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-20T11:50:51.523

如果内容非常小，某些浏览器不会显示 404 页面的内容。如果有更大的页面内容，他们会显示它。此规则因浏览器而异。尝试向您的 404 页面添加更多内容，看看是否有帮助。

# svn - 检测 .bat 中的 svn 变化

> ID：166491
> 
> 赞同：9
> 
> 时间：2008-10-03T11:58:02.123
> 
> 标签：svn

我有一个 .bat 并且在 .bat 内部，如果 svn 存储库中有一些修改（例如，编译），我想执行一个特殊代码。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-03T12:51:34.387

对于 Win 2000 及更高版本，这会将 svn status 命令的最后输出行分配给 svnOut 变量，然后测试该变量是否包含任何内容：

```
@echo off
set svnOut=
set svnDir=C:Your\path\to\svn\dir\to\check
for /F "tokens=*" %%I in ('svn status %svnDir%') do set svnOut=%%I

if "%svnOut%"==""  (
    echo No changes
) else (
    echo Changed files!
) 
```

为什么会有这样的一行

```
set svnOut= 
```

你必须弄清楚自己。;-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T15:14:53.240

好的，我在 Tooony 的帮助下找到的解决方案：

```
set vHEAD = 0
set vBASE = 0

set svnDir=<path to local svn directory>

for /F "tokens=1,2" %%I in ('svn info -r HEAD %svnDir%') do if "%%I"=="Revision:" set vHEAD=%%J
for /F "tokens=1,2" %%I in ('svn info -r BASE %svnDir%') do if "%%I"=="Revision:" set vBASE=%%J

if "%vBASE%"=="%vHEAD%"  (
    echo No changes
) else (
    echo Changed files!
) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T22:06:38.680

让您的 .bat 执行`svnversion`（如果您使用 Subversion）或`SvnWCRev.exe`（如果您使用 TortoiseSVN）针对您的工作副本的最顶层。

如果您的工作副本已被修改，则两者都会输出。

`svnversion`将“M”附加到其输出。 `SvnWCRev.exe`将打印 WC 已修改的一行文本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T12:05:31.657

你希望这是被动的吗？或者，按需？

对于响应式，请参阅[hooks](http://svnbook.red-bean.com/en/1.0/svn-book.html#svn-ch-5-sect-2.1)。该脚本必须根据其用途命名：**pre-commit.bat**，**post-commit.bat**。脚本被称为：**[script] [repos-path] [revision-number]**

对于，按需：

*   工作副本
    *   **svn日志**
    *   **svn st**
    *   **svn 差异**
    *   **svn proplist**
*   存储库
    *   **svnlook作者**
    *   **svnlook 变了**
    *   **svnlook 日期**
    *   **svnlook 差异**
    *   **svnlook历史**

* * *

例子：

```
svn st "C:\path\to\working\directory\" >> C:\path\to\working\project.log 
```

每次运行 BAT 时，它都会将**st**输出添加到**project.log**。根据需要进行调整。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-11-29T20:28:51.347

此版本基于@tooony，但检查服务器而不是客户端的更新。

```
@echo off
set svnOut=

rem Check svn server status of current working directory repository and see if first or second token is an *
for /F "tokens=1" %%I in ('svn status --show-updates') do if "%%I"=="*" set svnOut=%%I
rem echo "%svnOut%"

if "%svnOut%"==""  (
    echo No changes
) else (
    echo Changed files!
) 
```

# windows - 如何用另一个 .exe 包装对 .exe（带参数）的调用？

> ID：166493
> 
> 赞同：1
> 
> 时间：2008-10-03T11:59:03.977
> 
> 标签：windows, batch-file, executable

我有一个 Windows 可执行文件（比如`program.exe`），我想为用户提供 2 个启动器，它们将向它传递不同的参数。

```
program.exe -a
program.exe -b 
```

我可以使用 2 个批处理文件轻松完成此操作，但我宁愿为用户提供 2 个 .exe 文件，因为它们更有可能在不编辑的情况下被正确使用。

有没有一种简单的方法来创建这样的可执行文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T12:10:06.607

为什么要创建新的可执行文件？为什么不创建桌面快捷方式来启动单个 exe。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T12:37:58.470

如果您拥有应用程序的源代码，则可以根据可执行文件的名称更改其行为。这并不难 - 主要看 argv[0] 并在此基础上更改选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T12:04:41.720

你可以试试这个：[http ://www.abyssmedia.com/quickbfc/](http://www.abyssmedia.com/quickbfc/)

如果你想要一些非常非常小的东西，你可能需要制作自己的 Pascal/C 程序。我建议使用 Pascal，因为有一个非常[好的免费编译器](http://www.freepascal.org/)可以生成非常小的 .EXE，而无需使用经过调整的库（这将是这种情况下*唯一*的C 缺点）。

干杯。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T12:05:03.840

不确定它是否正是您要尝试做的，但请检查[可能](https://stackoverflow.com/questions/130664/combining-two-executables)的解决方案。

这回答了标题中的问题，至于您在这里写的内容，为什么不只解析参数并根据它们在一个可执行文件中具有两个功能？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-03T12:03:42.580

如果您使用的是 .Net，您可以从另一个应用程序或批处理文件中读取作为参数显示的信息。它是框架的一部分。这是VB.NET

For Each Arg As String In Environment.GetCommandLineArgs() //处理参数 Next Arg

# c - Windows 中的 UTF-8

> ID：166503
> 
> 赞同：26
> 
> 时间：2008-10-03T12:02:32.940
> 
> 标签：c, windows, winapi, unicode, utf-8

如何在 C Windows 程序中将代码页设置为 UTF-8？

我有一个使用 fopen 打开文件的第三方库。我可以使用 wcstombs 将我的 Unicode 文件名转换为当前代码页，但是如果用户的文件名包含代码页之外的字符，那么这会中断。

理想情况下，我只需调用 _setmbcp(65001) 将代码页设置为 UTF-8，但是 _setmbcp 的 MSDN 文档指出不支持 UTF-8。

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-03T14:32:08.643

不幸的是，没有办法使 Unicode 成为 Windows 中的当前代码页。和常量是伪代码页，仅用于`CP_UTF7`MultiByteToWideChar[和](http://msdn.microsoft.com/en-us/library/ms776413(VS.85).aspx)WideCharToMultiByte[转换](http://msdn.microsoft.com/en-us/library/ms776420(VS.85).aspx)函数，就像 Ben 提到的那样。`CP_UTF8`

您的问题类似于 fstream C++ 类的问题。fstream 构造函数只接受`char*`名称，因此无法打开具有真正 Unicode 名称的文件。VC 提供的唯一解决方案是 hack：单独打开文件，然后将句柄设置为流对象。当然，恐怕这不是您的选择，因为第三方库可能不接受句柄。

我能想到的唯一解决方案是创建一个具有非 Unicode 名称的临时文件，该文件与原始文件硬链接，并将其用作参数。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-03T13:42:05.143

所有 Windows API 都以 UTF-16 进行思考，因此最好在库周围编写一个包装器，以便在边界处进行转换。

奇怪的是，Windows 认为 UTF-8 是用于转换目的的代码页，因此您使用与在代码页之间进行转换相同的 API：

```
std::wstring Utf8ToUtf16(const char* u8string)
{
    int wcharcount = strlen(u8string);
    wchar_t *tempWstr = new wchar_t[wcharcount];
    MultiByteToWideChar(CP_UTF8, 0, u8string, -1, tempWstr, wcharcount);
    wstring w(tempWstr);
    delete [] tempWstr;
    return w;
} 
```

以及类似形式的东西可以转换回来。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2018-05-07T14:57:25.977

2018 年更新：Windows 10 分两步使“65001”代码页减少了“伪”：

1.  `conhost`更改：适用于 Linux 的 Windows 子系统对其控制台使用代码页 65001。也可以从 WSL开始运行`chcp 65001`。`cmd.exe`（它导致了一些[相当愚蠢的 Python 错误](https://github.com/Microsoft/WSL/issues/2009)。）
2.  全功能语言环境：自 build 17035 以来的 Windows[允许将 UTF-8 设置为语言环境代码页](https://twitter.com/matarillo/status/931050853347110912)。这可从 2018 年 4 月的更新中获得。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2011-01-06T18:26:14.860

使用 cygwin（默认提供 UTF-8 语言环境），或为 Windows 编写您自己的 libc hack，执行必要的 UTF-8 到 UTF-16 转换并包装非标准`_wfopen`等函数。

# python - 使用 Python 的 stdlib 查找本地 IP 地址

> ID：166506
> 
> 赞同：640
> 
> 时间：2008-10-03T12:03:36.963
> 
> 标签：python

如何在 Python 平台中仅使用标准库独立查找本地 IP 地址（即 192.168.xx 或 10.0.xx）？

* * *

## 回答 #1

> 赞同：558
> 
> 时间：2008-10-03T12:35:13.857

我刚刚发现了这个，但它似乎有点骇人听闻，但是他们说在 *nix 上尝试过，而我在 windows 上做过，并且有效。

```
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect(("8.8.8.8", 80))
print(s.getsockname()[0])
s.close() 
```

这假设您可以访问 Internet，并且没有本地代理。

* * *

## 回答 #2

> 赞同：522
> 
> 时间：2008-10-03T12:06:50.653

```
import socket
socket.gethostbyname(socket.gethostname()) 
```

这并不总是有效（返回`127.0.0.1`主机名在`/etc/hosts`as中的机器`127.0.0.1`），gimel 显示的是缓和，请`socket.getfqdn()`改用。当然，您的机器需要一个可解析的主机名。

* * *

## 回答 #3

> 赞同：379
> 
> 时间：2015-03-09T20:02:27.627

**此方法返回本地机器上的“主要”IP（具有默认路由的机器）**。

*   根本不需要可路由的网络访问或任何连接。
*   即使所有接口都从网络中拔出，也可以工作。
*   不需要甚至尝试去*其他任何地方*。
*   适用于 NAT、公共、私有、外部和内部 IP
*   没有外部依赖的纯 Python 2（或 3）。
*   适用于 Linux、Windows 和 OSX。

Python 3 或 2：

```
import socket
def get_ip():
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    s.settimeout(0)
    try:
        # doesn't even have to be reachable
        s.connect(('10.255.255.255', 1))
        IP = s.getsockname()[0]
    except Exception:
        IP = '127.0.0.1'
    finally:
        s.close()
    return IP 
```

这将返回一个作为主 IP 的 IP（具有默认路由的 IP）。如果您需要将所有 IP 附加到所有接口（包括本地主机等），请参阅类似[此答案](https://stackoverflow.com/questions/166506/finding-local-ip-addresses-using-pythons-stdlib/24564613#24564613)的内容。

如果您在家里的 wifi 盒子等 NAT 防火墙后面，那么这将不会显示您的公共 NAT IP，而是显示您在本地网络上的私有 IP，该 IP 具有到本地 WIFI 路由器的默认路由；获取您的wifi路由器的外部IP要么需要在那个盒子上运行它，要么连接到可以反映IP的外部服务，例如whatismyip.com/whatismyipaddress.com......但这与原始问题完全不同。:)

* * *

## 回答 #4

> 赞同：158
> 
> 时间：2009-08-12T17:20:38.530

**作为别名`myip`：**

```
alias myip="python -c 'import socket; print([l for l in ([ip for ip in socket.gethostbyname_ex(socket.gethostname())[2] if not ip.startswith(\"127.\")][:1], [[(s.connect((\"8.8.8.8\", 53)), s.getsockname()[0], s.close()) for s in [socket.socket(socket.AF_INET, socket.SOCK_DGRAM)]][0][1]]) if l][0][0])'" 
```

*   与 Python 2.x、Python 3.x、现代和旧的 Linux 发行版、OSX/macOS 和 Windows 一起正常工作，以查找当前的 IPv4 地址。
*   对于具有多个 IP 地址、IPv6、未配置 IP 地址或无法访问 Internet 的机器，将不会返回正确的结果。
*   据报道，这不适用于最新版本的 macOS。

**注意**：如果您打算在 Python 程序中使用类似的东西，正确的方法是使用支持 IPv6 的 Python 模块。

* * *

**与上面相同，但只有 Python 代码：**

```
import socket
print([l for l in ([ip for ip in socket.gethostbyname_ex(socket.gethostname())[2] if not ip.startswith("127.")][:1], [[(s.connect(('8.8.8.8', 53)), s.getsockname()[0], s.close()) for s in [socket.socket(socket.AF_INET, socket.SOCK_DGRAM)]][0][1]]) if l][0][0]) 
```

*   如果没有配置 IP 地址，这将引发异常。

* * *

**也可以在没有 Internet 连接的 LAN 上运行的版本：**

```
import socket
print((([ip for ip in socket.gethostbyname_ex(socket.gethostname())[2] if not ip.startswith("127.")] or [[(s.connect(("8.8.8.8", 53)), s.getsockname()[0], s.close()) for s in [socket.socket(socket.AF_INET, socket.SOCK_DGRAM)]][0][1]]) + ["no IP found"])[0]) 
```

（感谢[@ccpizza](https://stackoverflow.com/users/191246/ccpizza)）

* * *

**背景**：

使用`socket.gethostbyname(socket.gethostname())`在这里不起作用，因为我使用的其中一台计算机`/etc/hosts`具有重复的条目和对自身的引用。`socket.gethostbyname()`只返回最后一个条目`/etc/hosts`。

这是我最初的尝试，它清除了所有以以下开头的地址`"127."`：

```
import socket
print([ip for ip in socket.gethostbyname_ex(socket.gethostname())[2] if not ip.startswith("127.")][:1]) 
```

这适用于 Linux 和 Windows 上的 Python 2 和 3，但不能处理多个网络设备或 IPv6。但是，它在最近的 Linux 发行版上停止工作，所以我尝试了这种替代技术。它尝试在`8.8.8.8`以下端口连接到 Google DNS 服务器`53`：

```
import socket
print([(s.connect(('8.8.8.8', 53)), s.getsockname()[0], s.close()) for s in [socket.socket(socket.AF_INET, socket.SOCK_DGRAM)]][0][1]) 
```

然后，我将上述两种技术组合成一个可以在任何地方都可以使用的单行代码，并`myip`在此答案的顶部创建了别名和 Python 代码段。

随着 IPv6 的日益普及，对于具有多个网络接口的服务器，使用第三方 Python 模块查找 IP 地址可能比此处列出的任何方法都更加健壮和可靠。

* * *

## 回答 #5

> 赞同：96
> 
> 时间：2008-10-03T12:35:42.890

您可以使用[netifaces](http://pypi.python.org/pypi/netifaces)模块。只需输入：

```
pip install netifaces 
```

在您的命令外壳中，它将自行安装在默认的 Python 安装中。

然后你可以像这样使用它：

```
from netifaces import interfaces, ifaddresses, AF_INET
for ifaceName in interfaces():
    addresses = [i['addr'] for i in ifaddresses(ifaceName).setdefault(AF_INET, [{'addr':'No IP addr'}] )]
    print '%s: %s' % (ifaceName, ', '.join(addresses)) 
```

在我的电脑上打印：

```
{45639BDC-1050-46E0-9BE9-075C30DE1FBC}：192.168.0.100
{D43A468B-F3AE-4BF9-9391-4863A4500583}：10.5.9.207
```

该模块的作者声称它应该可以在 Windows、UNIX 和 Mac OS X 上运行。

* * *

## 回答 #6

> 赞同：50
> 
> 时间：2011-06-23T11:07:11.460

**套接字 API 方法**

见[https://stackoverflow.com/a/28950776/711085](https://stackoverflow.com/a/28950776/711085)

缺点：

*   *不是跨平台的。*
*   需要更多后备代码，与互联网上特定地址的存在相关
*   如果您在 NAT 后面，这也不起作用
*   可能会创建一个 UDP 连接，而不是独立于（通常是 ISP 的）DNS 可用性（有关使用 8.8.8.8 等想法的其他答案：Google 的（巧合的是 DNS）服务器）
*   确保将目标地址设置为 UNREACHABLE，例如指定保证不使用的数字 IP 地址。不要使用类似 fakesubdomain.google.com 或 somefakewebsite.com 的域；您仍然会向该方发送垃圾邮件（现在或将来），并且在此过程中也会向您自己的网络盒发送垃圾邮件。

* * *

**反射器法**

（请注意，这并不能回答 OP 关于本地 IP 地址的问题，例如 192.168 ...；它为您提供了您的公共 IP 地址，根据用例，这可能更可取。）

您可以查询一些站点，例如 whatismyip.com（但使用 API），例如：

```
from urllib.request import urlopen
import re
def getPublicIp():
    data = str(urlopen('http://checkip.dyndns.com/').read())
    # data = '<html><head><title>Current IP Check</title></head><body>Current IP Address: 65.96.168.198</body></html>\r\n'

    return re.compile(r'Address: (\d+\.\d+\.\d+\.\d+)').search(data).group(1) 
```

或者如果使用 python2：

```
from urllib import urlopen
import re
def getPublicIp():
    data = str(urlopen('http://checkip.dyndns.com/').read())
    # data = '<html><head><title>Current IP Check</title></head><body>Current IP Address: 65.96.168.198</body></html>\r\n'

    return re.compile(r'Address: (\d+\.\d+\.\d+\.\d+)').search(data).group(1) 
```

好处：

*   这种方法的一个优点是它是跨平台的
*   它在丑陋的 NAT 后面工作（例如你的家庭路由器）。

缺点（和解决方法）：

*   要求该网站正常运行，格式不变（几乎肯定不会），并且您的 DNS 服务器正常工作。如果出现故障，还可以通过查询其他第三方 IP 地址反射器来缓解此问题。
*   如果您不查询多个反射器（以防止受损的反射器告诉您您的地址不是），或者您不使用 HTTPS（以防止中间人攻击假装），则可能的攻击向量成为服务器）

* * *

*编辑*：虽然最初我认为这些方法真的很糟糕（除非你使用许多后备，否则多年后代码可能无关紧要），但它确实提出了“什么是互联网？”的问题。一台计算机可能有许多接口指向许多不同的网络。有关该主题的更详尽描述，请 google for`gateways and routes`. 计算机可能能够通过内部网关访问内部网络，或者通过例如路由器上的网关访问万维网（通常是这种情况）。OP 询问的本地 IP 地址仅针对单个链路层进行了明确定义，因此您必须指定（“是网卡，还是我们正在谈论的以太网电缆？”） . 提出的这个问题可能有多个非唯一的答案。然而，万维网上的全球 IP 地址可能是明确定义的（在没有大量网络碎片的情况下）：可能是通过可以访问 TLD 的网关的返回路径。

* * *

## 回答 #7

> 赞同：50
> 
> 时间：2014-09-15T14:43:47.350

如果计算机有通往 Internet 的路由，即使 /etc/hosts 设置不正确，它也*始终可以获取首选的本地 IP 地址。*

```
import socket

s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect(('8.8.8.8', 1))  # connect() for UDP doesn't send packets
local_ip_address = s.getsockname()[0] 
```

* * *

## 回答 #8

> 赞同：39
> 
> 时间：2012-02-13T20:52:31.653

在 Linux 上：

```
>>> import socket, struct, fcntl
>>> sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
>>> sockfd = sock.fileno()
>>> SIOCGIFADDR = 0x8915
>>>
>>> def get_ip(iface = 'eth0'):
...     ifreq = struct.pack('16sH14s', iface, socket.AF_INET, '\x00'*14)
...     try:
...         res = fcntl.ioctl(sockfd, SIOCGIFADDR, ifreq)
...     except:
...         return None
...     ip = struct.unpack('16sH2x4s8x', res)[2]
...     return socket.inet_ntoa(ip)
... 
>>> get_ip('eth0')
'10.80.40.234'
>>> 
```

* * *

## 回答 #9

> 赞同：28
> 
> 时间：2009-12-22T17:07:58.410

我使用以下模块：

```
#!/usr/bin/python
# module for getting the lan ip address of the computer

import os
import socket

if os.name != "nt":
    import fcntl
    import struct
    def get_interface_ip(ifname):
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        return socket.inet_ntoa(fcntl.ioctl(
                s.fileno(),
                0x8915,  # SIOCGIFADDR
                struct.pack('256s', bytes(ifname[:15], 'utf-8'))
                # Python 2.7: remove the second argument for the bytes call
            )[20:24])

def get_lan_ip():
    ip = socket.gethostbyname(socket.gethostname())
    if ip.startswith("127.") and os.name != "nt":
        interfaces = ["eth0","eth1","eth2","wlan0","wlan1","wifi0","ath0","ath1","ppp0"]
        for ifname in interfaces:
            try:
                ip = get_interface_ip(ifname)
                break;
            except IOError:
                pass
    return ip 
```

使用 windows 和 linux 进行测试（并且不需要额外的模块），旨在用于在单个基于 IPv4 的 LAN 中的系统上。

接口名称的固定列表不适用于最近的 linux 版本，这些版本采用了关于可预测接口名称的 systemd v197 更改，正如[Alexander](https://stackoverflow.com/questions/166506/finding-local-ip-addresses-using-pythons-stdlib/1947766?noredirect=1#comment35654143_1947766)指出的那样。在这种情况下，您需要手动将列表替换为系统上的接口名称，或者使用其他解决方案，例如[netifaces](http://alastairs-place.net/projects/netifaces/)。

* * *

## 回答 #10

> 赞同：24
> 
> 时间：2008-10-03T13:54:11.513

**[仅限 Windows]**如果您不想使用外部软件包并且不想依赖外部 Internet 服务器，这可能会有所帮助。这是我在[Google 代码搜索](http://www.google.com/codesearch?hl=en&lr=&q=getMACAddrWin&sbtn=Search)中找到并修改为返回所需信息的代码示例：

```
def getIPAddresses():
    from ctypes import Structure, windll, sizeof
    from ctypes import POINTER, byref
    from ctypes import c_ulong, c_uint, c_ubyte, c_char
    MAX_ADAPTER_DESCRIPTION_LENGTH = 128
    MAX_ADAPTER_NAME_LENGTH = 256
    MAX_ADAPTER_ADDRESS_LENGTH = 8
    class IP_ADDR_STRING(Structure):
        pass
    LP_IP_ADDR_STRING = POINTER(IP_ADDR_STRING)
    IP_ADDR_STRING._fields_ = [
        ("next", LP_IP_ADDR_STRING),
        ("ipAddress", c_char * 16),
        ("ipMask", c_char * 16),
        ("context", c_ulong)]
    class IP_ADAPTER_INFO (Structure):
        pass
    LP_IP_ADAPTER_INFO = POINTER(IP_ADAPTER_INFO)
    IP_ADAPTER_INFO._fields_ = [
        ("next", LP_IP_ADAPTER_INFO),
        ("comboIndex", c_ulong),
        ("adapterName", c_char * (MAX_ADAPTER_NAME_LENGTH + 4)),
        ("description", c_char * (MAX_ADAPTER_DESCRIPTION_LENGTH + 4)),
        ("addressLength", c_uint),
        ("address", c_ubyte * MAX_ADAPTER_ADDRESS_LENGTH),
        ("index", c_ulong),
        ("type", c_uint),
        ("dhcpEnabled", c_uint),
        ("currentIpAddress", LP_IP_ADDR_STRING),
        ("ipAddressList", IP_ADDR_STRING),
        ("gatewayList", IP_ADDR_STRING),
        ("dhcpServer", IP_ADDR_STRING),
        ("haveWins", c_uint),
        ("primaryWinsServer", IP_ADDR_STRING),
        ("secondaryWinsServer", IP_ADDR_STRING),
        ("leaseObtained", c_ulong),
        ("leaseExpires", c_ulong)]
    GetAdaptersInfo = windll.iphlpapi.GetAdaptersInfo
    GetAdaptersInfo.restype = c_ulong
    GetAdaptersInfo.argtypes = [LP_IP_ADAPTER_INFO, POINTER(c_ulong)]
    adapterList = (IP_ADAPTER_INFO * 10)()
    buflen = c_ulong(sizeof(adapterList))
    rc = GetAdaptersInfo(byref(adapterList[0]), byref(buflen))
    if rc == 0:
        for a in adapterList:
            adNode = a.ipAddressList
            while True:
                ipAddr = adNode.ipAddress
                if ipAddr:
                    yield ipAddr
                adNode = adNode.next
                if not adNode:
                    break 
```

用法：

```
>>> for addr in getIPAddresses():
>>>    print addr
192.168.0.100
10.5.9.207 
```

由于它依赖于`windll`，这仅适用于 Windows。

* * *

## 回答 #11

> 赞同：23
> 
> 时间：2010-07-05T04:45:47.777

我在我的 ubuntu 机器上使用它：

```
import commands
commands.getoutput("/sbin/ifconfig").split("\n")[1].split()[1][5:] 
```

这行不通。

* * *

## 回答 #12

> 赞同：20
> 
> 时间：2014-05-23T06:30:58.767

忍者的答案的变化。这应该适用于任何允许 UDP 广播并且不需要访问 LAN 或 Internet 上的地址的 LAN。

```
import socket
def getNetworkIp():
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    s.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)
    s.connect(('<broadcast>', 0))
    return s.getsockname()[0]

print (getNetworkIp()) 
```

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2015-01-05T22:03:07.517

一个我不相信的版本已经发布了。我在 Ubuntu 12.04 上使用 python 2.7 进行了测试。

在以下位置找到此解决方案：[http ://code.activestate.com/recipes/439094-get-the-ip-address-associated-with-a-network-inter/](http://code.activestate.com/recipes/439094-get-the-ip-address-associated-with-a-network-inter/)

```
import socket
import fcntl
import struct

def get_ip_address(ifname):
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    return socket.inet_ntoa(fcntl.ioctl(
        s.fileno(),
        0x8915,  # SIOCGIFADDR
        struct.pack('256s', ifname[:15])
    )[20:24]) 
```

示例结果：

```
>>> get_ip_address('eth0')
'38.113.228.130' 
```

* * *

## 回答 #14

> 赞同：17
> 
> 时间：2014-07-03T23:19:34.190

在 Debian（经过测试）上，我怀疑大多数 Linux 的..

```
import commands

RetMyIP = commands.getoutput("hostname -I") 
```

在 MS Windows 上（已测试）

```
import socket

socket.gethostbyname(socket.gethostname()) 
```

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2013-12-20T18:41:48.090

这是 UnkwnTech 答案的一个变体——它提供了一个`get_local_addr()`函数，该函数返回主机的主 LAN ip 地址。我发布它是因为这增加了许多东西：ipv6 支持、错误处理、忽略 localhost/linklocal 地址，并使用 TESTNET 地址 (rfc5737) 连接。

```
# imports
import errno
import socket
import logging

# localhost prefixes
_local_networks = ("127.", "0:0:0:0:0:0:0:1")

# ignore these prefixes -- localhost, unspecified, and link-local
_ignored_networks = _local_networks + ("0.", "0:0:0:0:0:0:0:0", "169.254.", "fe80:")

def detect_family(addr):
    if "." in addr:
        assert ":" not in addr
        return socket.AF_INET
    elif ":" in addr:
        return socket.AF_INET6
    else:
        raise ValueError("invalid ipv4/6 address: %r" % addr)

def expand_addr(addr):
    """convert address into canonical expanded form --
    no leading zeroes in groups, and for ipv6: lowercase hex, no collapsed groups.
    """
    family = detect_family(addr)
    addr = socket.inet_ntop(family, socket.inet_pton(family, addr))
    if "::" in addr:
        count = 8-addr.count(":")
        addr = addr.replace("::", (":0" * count) + ":")
        if addr.startswith(":"):
            addr = "0" + addr
    return addr

def _get_local_addr(family, remote):
    try:
        s = socket.socket(family, socket.SOCK_DGRAM)
        try:
            s.connect((remote, 9))
            return s.getsockname()[0]
        finally:
            s.close()
    except socket.error:
        # log.info("trapped error connecting to %r via %r", remote, family, exc_info=True)
        return None

def get_local_addr(remote=None, ipv6=True):
    """get LAN address of host

    :param remote:
        return  LAN address that host would use to access that specific remote address.
        by default, returns address it would use to access the public internet.

    :param ipv6:
        by default, attempts to find an ipv6 address first.
        if set to False, only checks ipv4.

    :returns:
        primary LAN address for host, or ``None`` if couldn't be determined.
    """
    if remote:
        family = detect_family(remote)
        local = _get_local_addr(family, remote)
        if not local:
            return None
        if family == socket.AF_INET6:
            # expand zero groups so the startswith() test works.
            local = expand_addr(local)
        if local.startswith(_local_networks):
            # border case where remote addr belongs to host
            return local
    else:
        # NOTE: the two addresses used here are TESTNET addresses,
        #       which should never exist in the real world.
        if ipv6:
            local = _get_local_addr(socket.AF_INET6, "2001:db8::1234")
            # expand zero groups so the startswith() test works.
            if local:
                local = expand_addr(local)
        else:
            local = None
        if not local:
            local = _get_local_addr(socket.AF_INET, "192.0.2.123")
            if not local:
                return None
    if local.startswith(_ignored_networks):
        return None
    return local 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2008-10-03T12:07:00.887

恐怕除了连接到另一台计算机并让它向您发送您的 IP 地址之外，没有任何独立于平台的好的方法可以做到这一点。例如： [findmyipaddress](http://www.findmyipaddress.info/locateipaddresses.html)。请注意，如果您需要一个位于 NAT 后面的 IP 地址，除非您要连接的计算机也在 NAT 后面，否则这将不起作用。

这是一种适用于 Linux 的解决方案： [获取与网络接口关联的 IP 地址](http://code.activestate.com/recipes/439094/)。

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2009-12-30T15:51:21.940

仅供参考，我可以验证该方法：

```
import socket
addr = socket.gethostbyname(socket.gethostname()) 
```

适用于 OS X (10.6,10.5)、Windows XP 和管理良好的 RHEL 部门服务器。它不适用于一个非常小的 CentOS 虚拟机，我只是对它进行了一些内核黑客攻击。因此，对于这种情况，您只需检查 127.0.0.1 地址，在这种情况下执行以下操作：

```
if addr == "127.0.0.1":
     import commands
     output = commands.getoutput("/sbin/ifconfig")
     addr = parseaddress(output) 
```

然后从输出中解析 ip 地址。需要注意的是 ifconfig 默认不在普通用户的 PATH 中，这就是我在命令中给出完整路径的原因。我希望这有帮助。

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2011-06-13T07:21:56.367

通过命令行工具产生“干净”输出的一种简单方法：

```
import commands
ips = commands.getoutput("/sbin/ifconfig | grep -i \"inet\" | grep -iv \"inet6\" | " +
                         "awk {'print $2'} | sed -ne 's/addr\:/ /p'")
print ips 
```

它将显示系统上的所有 IPv4 地址。

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2019-07-25T07:36:08.223

对于 linux，您可以像这样使用`check_output`系统`hostname -I`命令：

```
from subprocess import check_output
check_output(['hostname', '-I']) 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2012-04-27T12:14:01.983

这将适用于大多数 linux 机器：

```
import socket, subprocess, re
def get_ipv4_address():
    """
    Returns IP address(es) of current machine.
    :return:
    """
    p = subprocess.Popen(["ifconfig"], stdout=subprocess.PIPE)
    ifc_resp = p.communicate()
    patt = re.compile(r'inet\s*\w*\S*:\s*(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})')
    resp = patt.findall(ifc_resp[0])
    print resp

get_ipv4_address() 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2012-06-12T08:15:13.267

这个答案是我个人尝试解决获取局域网IP的问题，因为`socket.gethostbyname(socket.gethostname())`也返回了127.0.0.1。此方法不需要 Internet，只需 LAN 连接。代码适用于 Python 3.x，但可以轻松转换为 2.x。使用 UDP 广播：

```
import select
import socket
import threading
from queue import Queue, Empty

def get_local_ip():
        def udp_listening_server():
            s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
            s.bind(('<broadcast>', 8888))
            s.setblocking(0)
            while True:
                result = select.select([s],[],[])
                msg, address = result[0][0].recvfrom(1024)
                msg = str(msg, 'UTF-8')
                if msg == 'What is my LAN IP address?':
                    break
            queue.put(address)

        queue = Queue()
        thread = threading.Thread(target=udp_listening_server)
        thread.queue = queue
        thread.start()
        s2 = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s2.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)
        waiting = True
        while waiting:
            s2.sendto(bytes('What is my LAN IP address?', 'UTF-8'), ('<broadcast>', 8888))
            try:
                address = queue.get(False)
            except Empty:
                pass
            else:
                waiting = False
        return address[0]

if __name__ == '__main__':
    print(get_local_ip()) 
```

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2013-05-07T06:54:33.570

```
import socket
[i[4][0] for i in socket.getaddrinfo(socket.gethostname(), None)] 
```

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2018-03-14T04:45:53.323

如果您正在寻找与您的 localhost IP 地址不同的 IPV4 地址`127.0.0.1`，这里有一段简洁的 Python 代码：

```
import subprocess
address = subprocess.check_output(['hostname', '-s', '-I'])
address = address.decode('utf-8') 
address=address[:-1] 
```

也可以写成一行：

```
address = subprocess.check_output(['hostname', '-s', '-I']).decode('utf-8')[:-1] 
```

即使你`localhost`输入`/etc/hostname`，代码仍然会给出你的本地 IP 地址。

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2011-06-23T11:04:19.887

`127.0.1.1` *是*您的真实 IP 地址。更一般地说，一台计算机可以有任意数量的 IP 地址。您可以为专用网络过滤它们 - 127.0.0.0/8、10.0.0.0/8、172.16.0.0/12 和 192.168.0.0/16。

但是，没有跨平台的方式来获取所有 IP 地址。在 Linux 上，您可以使用[`SIOCGIFCONF`](http://linux.die.net/man/7/netdevice)ioctl。

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2012-04-30T00:32:34.327

使用 IP 命令并返回 IPv4 和 IPv6 地址的命令版本的轻微改进：

```
import commands,re,socket

#A generator that returns stripped lines of output from "ip address show"
iplines=(line.strip() for line in commands.getoutput("ip address show").split('\n'))

#Turn that into a list of IPv4 and IPv6 address/mask strings
addresses1=reduce(lambda a,v:a+v,(re.findall(r"inet ([\d.]+/\d+)",line)+re.findall(r"inet6 ([\:\da-f]+/\d+)",line) for line in iplines))
#addresses1 now looks like ['127.0.0.1/8', '::1/128', '10.160.114.60/23', 'fe80::1031:3fff:fe00:6dce/64']

#Get a list of IPv4 addresses as (IPstring,subnetsize) tuples
ipv4s=[(ip,int(subnet)) for ip,subnet in (addr.split('/') for addr in addresses1 if '.' in addr)]
#ipv4s now looks like [('127.0.0.1', 8), ('10.160.114.60', 23)]

#Get IPv6 addresses
ipv6s=[(ip,int(subnet)) for ip,subnet in (addr.split('/') for addr in addresses1 if ':' in addr)] 
```

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2013-11-28T21:37:56.073

那么您可以在 GNU/Linux 上使用命令“ip route”来了解您当前的 IP 地址。

这显示了路由器/调制解调器上运行的 DHCP 服务器为接口提供的 IP。通常“192.168.1.1/24”是本地网络的IP，其中“24”表示DHCP服务器在掩码范围内给出的可能IP地址范围。

这是一个示例：请注意，PyNotify 只是为了说明我的观点而添加的，根本不需要

```
#! /usr/bin/env python

import sys , pynotify

if sys.version_info[1] != 7:
   raise RuntimeError('Python 2.7 And Above Only')       

from subprocess import check_output # Available on Python 2.7+ | N/A 

IP = check_output(['ip', 'route'])
Split_Result = IP.split()

# print Split_Result[2] # Remove "#" to enable

pynotify.init("image")
notify = pynotify.Notification("Ip", "Server Running At:" + Split_Result[2] , "/home/User/wireless.png")    
notify.show() 
```

这样做的好处是您不需要指定网络接口。这在运行套接字服务器时非常有用

您可以使用 easy_install 甚至 Pip 安装 PyNotify：

```
easy_install py-notify 
```

或者

```
pip install py-notify 
```

或在 python 脚本/解释器中

```
from pip import main

main(['install', 'py-notify']) 
```

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2016-06-03T15:48:32.710

要获取 IP 地址，您可以直接在**python**中使用*shell 命令*：

 **```
import socket, subprocess

def get_ip_and_hostname():
    hostname =  socket.gethostname()

    shell_cmd = "ifconfig | awk '/inet addr/{print substr($2,6)}'"
    proc = subprocess.Popen([shell_cmd], stdout=subprocess.PIPE, shell=True)
    (out, err) = proc.communicate()

    ip_list = out.split('\n')
    ip = ip_list[0]

    for _ip in ip_list:
        try:
            if _ip != "127.0.0.1" and _ip.split(".")[3] != "1":
                ip = _ip
        except:
            pass
    return ip, hostname

ip_addr, hostname = get_ip_and_hostname() 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2011-02-24T23:31:49.510

对于 *nix 系统上的 IP 地址列表，

```
import subprocess
co = subprocess.Popen(['ifconfig'], stdout = subprocess.PIPE)
ifconfig = co.stdout.read()
ip_regex = re.compile('((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-4]|2[0-5][0-9]|[01]?[0-9][0-9]?))')
[match[0] for match in ip_regex.findall(ifconfig, re.MULTILINE)] 
```

虽然这个答案有点晚了，但我认为其他人可能会觉得它很有用:-)

PS：它也会返回广播地址和网络掩码。

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2013-08-30T23:09:13.870

注意：这不是使用标准库，但很简单。

$ pip 安装 pif

```
from pif import get_public_ip
get_public_ip() 
```

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2014-06-11T19:47:26.740

netifaces 可通过 pip 和 easy_install 获得。（我知道，它不在基地，但值得安装。）

netifaces 确实有一些跨平台的奇怪之处：

*   可能并不总是包含 localhost/loop-back 接口 (Cygwin)。
*   地址按协议（例如，IPv4、IPv6）列出，协议按接口列出。在某些系统 (Linux) 上，每个协议-接口对都有自己的关联接口（使用 interface_name:n 表示法），而在其他系统 (Windows) 上，单个接口将具有每个协议的地址列表。在这两种情况下都有一个协议列表，但它可能只包含一个元素。

这是一些可以使用的 netifaces 代码：

```
import netifaces

PROTO = netifaces.AF_INET   # We want only IPv4, for now at least

# Get list of network interfaces
# Note: Can't filter for 'lo' here because Windows lacks it.
ifaces = netifaces.interfaces()

# Get all addresses (of all kinds) for each interface
if_addrs = [netifaces.ifaddresses(iface) for iface in ifaces]

# Filter for the desired address type
if_inet_addrs = [addr[PROTO] for addr in if_addrs if PROTO in addr]

iface_addrs = [s['addr'] for a in if_inet_addrs for s in a if 'addr' in s]
# Can filter for '127.0.0.1' here. 
```

上面的代码没有将地址映射回其接口名称（对于动态生成 ebtables/iptables 规则很有用）。因此，这是一个将上述信息与接口名称一起保存在元组中的版本：

```
import netifaces

PROTO = netifaces.AF_INET   # We want only IPv4, for now at least

# Get list of network interfaces
ifaces = netifaces.interfaces()

# Get addresses for each interface
if_addrs = [(netifaces.ifaddresses(iface), iface) for iface in ifaces]

# Filter for only IPv4 addresses
if_inet_addrs = [(tup[0][PROTO], tup[1]) for tup in if_addrs if PROTO in tup[0]]

iface_addrs = [(s['addr'], tup[1]) for tup in if_inet_addrs for s in tup[0] if 'addr' in s] 
```

而且，不，我不喜欢列表推导。这就是我现在大脑的工作方式。

以下代码段将全部打印出来：

```
from __future__ import print_function  # For 2.x folks
from pprint import pprint as pp

print('\nifaces = ', end='')
pp(ifaces)

print('\nif_addrs = ', end='')
pp(if_addrs)

print('\nif_inet_addrs = ', end='')
pp(if_inet_addrs)

print('\niface_addrs = ', end='')
pp(iface_addrs) 
```

享受！

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2016-04-06T08:51:58.557

使用新引入的 asyncio 包的 Python 3.4 版本。

```
async get_local_ip():
    loop = asyncio.get_event_loop()
    transport, protocol = await loop.create_datagram_endpoint(
        asyncio.DatagramProtocol,
        remote_addr=('8.8.8.8', 80))
    result = transport.get_extra_info('sockname')[0])
    transport.close()
    return result 
```

这是基于 UnkwnTech 的[出色回答](https://stackoverflow.com/a/166589/554283)。

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2017-12-28T09:19:20.767

```
import netifaces as ni 

ni.ifaddresses('eth0')
ip = ni.ifaddresses('eth0')[ni.AF_INET][0]['addr']
print(ip) 
```

这将返回您在 Ubuntu 系统以及 MacOS 中的 IP 地址。输出将是系统 IP 地址，就像我的 IP：192.168.1.10。

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2012-04-26T00:32:06.003

我必须解决“弄清楚一个 IP 地址是否是本地的”这个问题，我的第一个想法是建立一个本地 IP 列表，然后与之匹配。这就是导致我提出这个问题的原因。但是，我后来意识到有一种更直接的方法可以做到这一点：尝试绑定该 IP 并查看它是否有效。

```
_local_ip_cache = []
_nonlocal_ip_cache = []
def ip_islocal(ip):
    if ip in _local_ip_cache:
        return True
    if ip in _nonlocal_ip_cache:
        return False
    s = socket.socket()
    try:
        try:
            s.bind((ip, 0))
        except socket.error, e:
            if e.args[0] == errno.EADDRNOTAVAIL:
                _nonlocal_ip_cache.append(ip)
                return False
            else:
                raise
    finally:
        s.close()
    _local_ip_cache.append(ip)
    return True 
```

我知道这并不能直接回答这个问题，但这应该对任何试图解决相关问题并且遵循相同思路的人有所帮助。这具有成为跨平台解决方案的优势（我认为）。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2012-04-17T13:21:38.650

好的，所以这是 Windows 特定的，需要安装 [python WMI 模块](http://timgolden.me.uk/python/wmi/index.html)，但它似乎比不断尝试调用外部服务器要少得多。这只是另一种选择，因为已经有很多好的选择，但它可能非常适合您的项目。

```
Import WMI

def getlocalip():
    local = wmi.WMI()
    for interface in local.Win32_NetworkAdapterConfiguration(IPEnabled=1):
        for ip_address in interface.IPAddress:
            if ip_address != '0.0.0.0':
                localip = ip_address
    return localip

>>>getlocalip()
u'xxx.xxx.xxx.xxx'
>>> 
```

顺便说一句，WMI 非常强大……如果您正在对窗口机器进行任何远程管理，您绝对应该检查一下它可以做什么。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2012-06-08T09:42:20.943

```
import socket
socket.gethostbyname(socket.getfqdn()) 
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2015-04-28T23:18:41.697

这不是 Pythonic，但它可以在 Windows 上可靠地工作。

```
def getWinIP(version = 'IPv4'):
    import subprocess
    if version not in ['IPv4', 'IPv6']:
        print 'error - protocol version must be "IPv4" or "IPv6"'
        return None
    ipconfig = subprocess.check_output('ipconfig')
    my_ip = []
    for line in ipconfig.split('\n'):
        if 'Address' in line and version in line:
            my_ip.append(line.split(' : ')[1].strip())
    return my_ip

print getWinIP() 
```

是的，这是一个 hack，但有时我不想对操作系统进行第二次猜测，而是继续使用内置和工作的东西。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2011-06-23T11:02:21.777

您提到的一台机器可以有多个网络接口（包括本地环回 127.0.0.1）。就操作系统而言，它也是一个“真实IP地址”。

如果您想跟踪所有接口，请查看以下 Puthon 包：[http ://alastairs-place.net/netifaces/](http://alastairs-place.net/netifaces/)

如果您从主机文件中省略环回条目，我认为您可以避免让 gethostbyname 返回 127.0.0.1 。（待验证）。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2017-06-16T04:57:28.067

```
from netifaces import interfaces, ifaddresses, AF_INET
iplist = [ifaddresses(face)[AF_INET][0]["addr"] for face in interfaces() if AF_INET in ifaddresses(face)]
print(iplist)
['10.8.0.2', '192.168.1.10', '127.0.0.1'] 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2019-04-24T07:55:36.363

先前答案的另一个变体可以保存到名为的可执行脚本中`my-ip-to`：

```
#!/usr/bin/env python

import sys, socket

if len(sys.argv) > 1:
    for remote_host in sys.argv[1:]:
        # determine local host ip by outgoing test to another host
        # use port 9 (discard protocol - RFC 863) over UDP4
        with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as s:
            s.connect((remote_host, 9))
            my_ip = s.getsockname()[0]
            print(my_ip, flush=True)
else:
    import platform

    my_name = platform.node()
    my_ip = socket.gethostbyname(my_name)
    print(my_ip) 
```

它需要任意数量的远程主机，并打印出本地 ip 以一一访问它们：

```
$ my-ip-to z.cn g.cn localhost
192.168.11.102
192.168.11.102
127.0.0.1
$ 
```

并在没有给出 arg 时打印最佳选择。

```
$ my-ip-to
192.168.11.102 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2019-04-25T21:22:39.537

对于 linux 环境，读取 /proc/net/tcp，第二个（本地地址）和第三个（远程地址）将以 hexa 格式给出 IP。

提示：如果第二列归零（00000000:0000），那么它是一个监听端口:)

[https://github.com/romol0s/python/blob/master/general/functions/getTcpListenIpsByPort.py](https://github.com/romol0s/python/blob/master/general/functions/getTcpListenIpsByPort.py)

[https://www.kernel.org/doc/Documentation/networking/proc_net_tcp.txt](https://www.kernel.org/doc/Documentation/networking/proc_net_tcp.txt)

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2020-12-03T17:05:23.497

## Windows 解决方案，要么接受，要么离开。

在当前活动的 wlan[无线 LAN] 上仅获取自身 ip，即（wifi 路由器或网络交换机）上的计算机 ip。

注意：它不是设备的公共 ip，不涉及任何外部请求或包或公共 api。

核心思想是在 linux 上解析`shell command: ipconfig`, 或 ifconfig 的输出。我们正在使用 subprocess 来获取输出。

```
def wlan_ip():
    import subprocess
    result=subprocess.run('ipconfig',stdout=subprocess.PIPE,text=True).stdout.lower()
    scan=0
    for i in result.split('\n'):
        if 'wireless' in i: #use "wireless" or wireless adapters and "ethernet" for wired connections
            scan=1
        if scan:
            if 'ipv4' in i:
                return i.split(':')[1].strip()
print(wlan_ip()) 
```

## 这是 CMD:'ipconfig' 之后发生的事情：

我们得到这个输出，我们使用子进程输出在 python 中捕获它。

> C:\用户\戴尔>ipconfig

```
Wireless LAN adapter Wi-Fi:

   Connection-specific DNS Suffix  . :
   Link-local IPv6 Address . . . . . : fe80::f485:4a6a:e7d5:1b1c%4
   IPv4 Address. . . . . . . . . . . : 192.168.0.131
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.0.1 
```

我们在 python 中解析了字符串，以选择当前网络上无线适配器的 ip 的方式。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2021-09-28T22:31:33.167

您可以在具有实用程序的现代 *NIX 系统上轻松执行此操作，方法`iproute2`是调用它，`subprocess.run()`因为您可以使用开关以 JSON 格式输出，`-j`然后使用`json.loads()`模块和方法将其转换为 python 数据结构。以下代码显示第一个非环回 IP 地址。

```
import subprocess
import json

ip = json.loads(subprocess.run('ip -j a'.split(),capture_output=True).stdout.decode())[1]['addr_info'][0]['local'] 

print(ip) 
```

或者，如果您有多个 IP，并且想要找到用于连接到特定目的地的 IP，您可以`ip -j route get 8.8.8.8`像这样使用：

```
import subprocess 
import json 

ip = json.loads(subprocess.run('ip -j route get 8.8.8.8'.split(),capture_output=True).stdout.decode())[0]['prefsrc']

print(ip) 
```

如果您要查找所有 IP 地址，您可以遍历返回的字典列表`ip -j a`

```
import subprocess
import json

list_of_dicts = json.loads(subprocess.run('ip -j a'.split(),capture_output=True).stdout.decode())

for interface in list_of_dicts:
    try:print(f"Interface: {interface['ifname']:10} IP: {interface['addr_info'][0]['local']}")
    except:pass 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2022-02-21T01:20:30.647

您可以查看`whatismyip`模块中的代码来执行此操作。它在 Python 3 标准库之外没有依赖项。它连接到公共 STUN 服务器和 what-is-my-ip 网站以查找 IPv4 或 IPv6 地址。跑`pip install whatismyip`

例子：

```
>>> import whatismyip
>>> whatismyip.amionline()
True
>>> whatismyip.whatismyip()  # Prefers IPv4 addresses, but can return either IPv4 or IPv6.
'69.89.31.226'
>>> whatismyip.whatismyipv4()
'69.89.31.226'
>>> whatismyip.whatismyipv6()
'2345:0425:2CA1:0000:0000:0567:5673:23b5' 
```

我已经在此处修改了模块中的代码，因此您可以复制/粘贴它：

```
import urllib.request

IP_WEBSITES = (
           'https://ipinfo.io/ip',
           'https://ipecho.net/plain',
           'https://api.ipify.org',
           'https://ipaddr.site',
           'https://icanhazip.com',
           'https://ident.me',
           'https://curlmyip.net',
           )

def getIp():
    for ipWebsite in IP_WEBSITES:
        try:
            response = urllib.request.urlopen(ipWebsite)

            charsets = response.info().get_charsets()
            if len(charsets) == 0 or charsets[0] is None:
                charset = 'utf-8'  # Use utf-8 by default
            else:
                charset = charsets[0]

            userIp = response.read().decode(charset).strip()

            return userIp
        except:
            pass  # Network error, just continue on to next website.

    # Either all of the websites are down or returned invalid response
    # (unlikely) or you are disconnected from the internet.
    return None

print(getIp()) 
```

* * *

## 回答 #44

> 赞同：-1
> 
> 时间：2020-02-03T23:55:42.700

pyroute2 是一个很棒的库，它不仅可以用来获取 IP 地址，还可以用来获取网关信息和其他有用的信息。以下代码可以获取任意接口的ipv4地址。

```
from pyroute2 import IPRoute
ip = IPRoute()

def get_ipv4_address(intf):
    return dict(ip.get_addr(label=intf)[0]['attrs'])['IFA_LOCAL']

print(get_ipv4_address('eth0')) 
```

* * *

## 回答 #45

> 赞同：-2
> 
> 时间：2013-12-01T14:02:04.597

简单又甜美！

```
def getip():

    import socket
    hostname= socket.gethostname()
    ip=socket.gethostbyname(hostname)

    return(ip) 
```

* * *

## 回答 #46

> 赞同：-2
> 
> 时间：2016-12-06T18:12:37.927

这与以前发布的答案非常相似，但我找不到任何使用这种调用的答案。这是我用于 ipv4 的。对于 ipv6 更改“。” 到“：”中

```
import socket
print next(i[4][0] for i in socket.getaddrinfo(
    socket.gethostname(), 80) if '127.' not in i[4][0] and '.' in i[4][0]);" 
```

* * *

## 回答 #47

> 赞同：-3
> 
> 时间：2016-08-07T13:49:21.077

我决定使用**ipfy**的服务和/或 API ：[https](https://www.ipify.org) ://www.ipify.org 。

```
#!/usr/bin/env python3
from urllib.request import urlopen

def public_ip():
    data = urlopen('https://api.ipify.org').read()
    return str(data, encoding='utf-8')

print(public_ip()) 
```

也可以*JSON*和*JSONP*格式获取响应。

Github 上有一个**ipify** [Python 库](https://github.com/rdegges/python-ipify) 。

* * *

## 回答 #48

> 赞同：-3
> 
> 时间：2017-07-20T18:37:03.163

```
import socket
print(socket.gethostbyname(socket.getfqdn())) 
```

* * *

## 回答 #49

> 赞同：-3
> 
> 时间：2021-07-14T13:19:17.643

@fatal_error 解决方案应该是公认的答案！这是他在 nodejs 中的解决方案的实现，以防人们需要它：

```
const dgram = require('dgram');

async function get_local_ip() {
    const s = new dgram.createSocket('udp4');
    return new Promise((resolve, reject) => {
        try {
            s.connect(1, '8.8.8.8', function () {
                const ip = s.address();
                s.close();
                resolve(ip.address)
            });
        } catch (e) {
            console.error(e);
            s.close();
            reject(e);
        }
    })
} 
```

# unix - Unix shell 事件？

> ID：166508
> 
> 赞同：0
> 
> 时间：2008-10-03T12:04:31.440
> 
> 标签：unix, shell, passwords, prompt

有什么方法可以让我在不使用外部二进制文件的情况下在 unix shell 中要求时回显密码？显示密码提示时触发的简单功能

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T12:05:38.050

你知道[期望](http://expect.nist.gov/)吗？

也许这属于“外部二进制文件”类别，但如果是这样，那么您的问题需要澄清。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T14:56:31.000

简短的回答：没有。

稍微长一点的答案：通常的 shell、sh、ksh、csh、tcsh、bash 没有任何钩子供您挂起操作（好的，所以 bash2 具有上下文相关的制表符补全）。

* * *

另一方面。shell 只是一个程序。你可以更换它。如果你真的能说出你想做什么，你可以破解现有的 shell 或编写一个新的 shell 来获得所需的行为......

# sql-server-2005 - SQL Server 2005 计算列结果来自另一个表字段值的聚合

> ID：166518
> 
> 赞同：5
> 
> 时间：2008-10-03T12:05:41.077
> 
> 标签：sql-server-2005, tsql, aggregate-functions, calculated-columns

抱歉，问题标题太长了。

我想我在这个上输了，但机会不大。

是否可以将表中的计算字段的计算作为应用于另一个表中的字段的聚合函数的结果。

IE

你有一张叫做“杯子”的桌子，它有一个叫做“颜色”的孩子（这让我的英国头疼，但供应商来自美国，你要做什么？）而这反过来又有一个孩子叫做“尺寸'。每个表都有一个称为已售出的字段。

每卖出一个特定颜色和尺寸的杯子，size.sold 就会增加 1。

您希望 color.sold 是 SUM size.sold WHERE size.colorid = color.colorid 的聚合

您希望 mug.sold 是 SUM color.sold WHERE color.mugid = mug.mugid 的集合

有没有办法让 mug.sold 和 color.sold 自己解决问题，或者我将不得不使用触发器？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-03T12:23:13.773

您不能让计算列直接引用不同的表，但可以让它引用用户定义的函数。这是实现此类解决方案示例的链接。

[http://www.sqlservercentral.com/articles/User-Defined+functions/complexcomputedcolumns/2397/](http://www.sqlservercentral.com/articles/User-Defined+functions/complexcomputedcolumns/2397/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T12:22:23.027

不，这是不可能的。计算列只能从同一行上其他字段的值派生。要计算另一个表的聚合，您需要创建一个视图。

如果您的应用程序需要显示统计信息，请询问以下问题：

1.  真的有必要实时显示吗？如果是这样，为什么？如果确实需要这样做，那么您将不得不使用触发器来更新表。 [这](http://en.wikipedia.org/wiki/Denormalization)链接到关于非规范化的简短维基百科文章。触发器将影响表更新的写入性能，并依赖于触发器处于活动状态。
2.  如果仅出于报告目的需要，您可以在视图或报告中进行计算。
3.  如果有必要支持频繁的临时报告，您可能会进入数据集市和隔夜 ETL 流程的领域。

# .net - NetworkStream.DataAvailable 是否看到缓冲数据？

> ID：166530
> 
> 赞同：6
> 
> 时间：2008-10-03T12:10:51.347
> 
> 标签：.net, stream, networkstream

NetworkStream.DataAvailable 是否知道发送方的发送缓冲区是否为空？或者它只是简单地表明接收器的读缓冲区是否有数据？我的假设是后者...

具体来说，对于一些涉及正在进行的会话的套接字工作，我目前使用长度前缀，以便接收者确切知道当前批次中有多少数据；但是，我收到了一个 .patch，建议我改用 NetworkStream.DataAvailable。我担心的是，这只会告诉我接收者得到了什么——而不是发送者最初发送的——但我不是套接字专家。

我错了吗？或者长度前缀是要走的路？

（请注意，在流关闭之前，我不能简单地 Read()，因为在同一个连接上发送了多个批次，并且将每个批次视为单独的至关重要；如果我在一个批次中读取太多（即使它被缓冲并丢弃）然后对话将中断）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T15:22:51.023

连接的一侧不会知道另一侧的发送缓冲区是否为空。

`DataAvailable`只表示是否有传入数据要读取。您可以在 之前使用它`Read()`，但它本身并不能为您提供所需的信息。它不会告诉您每批的开始和结束。

我之前已经对来回对话进行了编码，并且在数据中使用了长度前缀。我所做的是编写辅助函数来读取确切数量的字节（一次块），仅此而已。

流中批次长度值的唯一替代方法是通过某种方式检查传入数据并识别批次的开始和结束。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T17:06:44.230

如果您需要知道接收者何时收到特定消息的所有数据，那么您肯定需要长度前缀。

我通常会定义一个与此类似的结构，它会出现在我发送的任何二进制消息的前面。

```
struct Header
{
  int packetIdentifier;
  int protocolVersion;
  int messageType;
  int payloadSize;
} 
```

标识符可让您确定您是否拥有协议类型的有效消息。该版本允许您修改您的协议。消息类型是消息的类型（即：CommsOnline）。有效负载大小是消息正文的大小。

# c++ - 在内存限制的嵌入式系统中使用 boost

> ID：166542
> 
> 赞同：11
> 
> 时间：2008-10-03T12:18:57.103
> 
> 标签：c++, boost, embedded, windows-ce

我们正在使用 c++ 开发在嵌入式系统上的 Windows CE 4 中运行的应用程序。

我们的限制之一是应用程序使用的所有内存**只能在启动**期间分配。我们编写了很多只使用预分配内存而不是分配新内存的容器和算法。

您认为在这些情况下我们可以使用 boost 库而不是我们自己的容器吗？

欢迎任何意见和/或建议！

非常感谢，

网卡

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-04T04:49:41.237

**我们将 boost 用于嵌入式系统**。借助 boost，您可以**选择**使用的内容。我们 在所有项目中使用**`smart_ptr`**和。**我们为廉价手机****`boost::bind`**编写软件。如果 Windows CE 可以在您的硬件上运行，我希望**部分 boost**将适用。boost 的某些部分没有分配，您可能会发现它们很有用。

 ****我会根据您的要求进行**挑选。**

就像您使用的任何东西一样，您需要知道成本。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-03T12:32:31.943

您可以为容器编写自己的分配器，该分配器从固定大小的静态缓冲区进行分配。根据容器的使用模式，分配器可以像递增指针一样简单（例如，当您只在应用程序启动时将内容插入容器一次，并且不连续添加/删除元素时。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T15:16:43.723

用 Boost 容器替换你的容器不是一个好主意。制作适当的自定义分配器的工作不会那么糟糕，但是您会违反“在启动时分配”规则的精神。这条规则背后的想法（根据我的经验）通常是为了确保您不必在运行时处理内存不足类型的情况。这样做的目的是确保您一开始就拥有您可能需要的所有内存，这样以后系统的任何部分都不会出现内存不足的情况。

如果您将 Boost 容器与自定义分配器一起使用，您将突然不得不处理容器从中分配的池可能变空的可能性，从而消除了“启动时分配”规则的目的。

在内存设备有限的情况下，我会避免使用任何比静态分配数组更复杂的容器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T15:30:18.933

Boost 是一组库。其中一些专注于模板元编程。那些甚至在运行时不使用任何内存。但你的问题似乎是关于更换你的容器。除了使用自定义分配器之外，我怀疑这是可能的。但即便如此，您很可能会使用普通的 STL 容器而不是 boost。Boost 只为那些还没有包含 TR1 的编译器提供 TR1 容器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T15:42:14.697

不要使用升压。

它是一个大库，您的基本内存分配要求与库设计者的要求大不相同。

即使您可以使用自定义分配器根据您的要求使当前版本的 Boost 工作，它也可能会因新版本的 Boost 而中断。

尽管有一些有用的想法，但请随意查看 Boost 源代码，但根据需要使用您自己的实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-06-14T22:59:31.807

我现在正在研究这个——我想使用循环缓冲区、无锁容器和异步 I/O，而不是分配动态内存，我更喜欢使用内存池。

到目前为止我看到的最大问题是它[`shared_ptr`](http://www.boost.org/doc/libs/1_64_0/libs/smart_ptr/shared_ptr.htm)在很多地方都使用过，没有简单的方法可以用[`intrusive_ptr`](http://www.boost.org/doc/libs/1_64_0/libs/smart_ptr/intrusive_ptr.html). 由于`shared_ptr`分配动态内存来跟踪引用计数，因此我不能在嵌入式系统中使用它。

解决这个问题看起来可行，但需要做很多工作——我必须扩展任何包含 a 的类的模板规范，`shared_ptr`以便可以根据需要更改共享指针的特定类型`intrusive_ptr`。所以现在我必须考虑这将是多少工作，以及编写我自己需要的 Boost 功能版本的工作量。不是一个令人愉快的地方。

我希望有人指出我为什么错了。

# windows - 重用编辑控件作为命令窗口

> ID：166544
> 
> 赞同：0
> 
> 时间：2008-10-03T12:19:55.527
> 
> 标签：windows, winapi, visual-c++, mfc

这是一个 GUI 应用程序（实际上是 MFC）。我需要一个能够显示如下提示的命令窗口：

> 最喜欢的色情明星的名字：

用户应该能够在提示后输入文本，如下所示：

> 最喜欢的色情明星的名字：**Raven Riley**

但我需要防止用户将光标移动到提示区域。还应防止用户退格进入提示符，以防止出现以下情况：

> **Rrraven Rrrileeey Ruuuulez！！！**最喜欢的色情明星的名字：

还需要控制文本选择等等。最后，我只检索用户输入的文本（减去提示文本）应该没有问题。

从头开始创建自己的窗口类（即从CWnd 继承）会更好还是应该重用Windows EDIT 控件（即从CEdit 继承）？

在 AutoCAD 和 Visual Studio（在调试模式下）中可以看到类似的命令窗口。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T12:36:15.663

我认为你最好创建一个 CEdit 的子类并限制过滤按键。我想困难的部分是不让用户将插入符号移动到提示区域，但是您可能可以编写一些代码来确保插入符号总是被发送回它所属的位置（输入部分）。

无论如何，如果您真的非常想实现自己的控件（毕竟这并不难），我建议您阅读 Jacob Navia 的“技术文档”，了解他如何构建 LCC 编译器和环境。实际上，这些文档似乎不再在线，但我相信您可以通过他的电子邮件 (jacob@jacob.remcomp.fr) 获得它们。

**编辑**：我更喜欢你之前的例子。保持优雅，大声笑:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T12:55:23.037

我有一个非常相似的要求，并且完全按照 davidg 的建议做了；子类化编辑控件并过滤按键。这实际上是使用 Qt 而不是 MFC，但原理完全相同。

您需要记住过滤诸如 home 以及 left 和 backspace 之类的键。我只是检查了移动是否会将插入符号移动到提示符中，以及它是否确实忽略了按键。

要注意的另一件事是粘贴多行文本，您必须选择是仅粘贴第一行还是所有行，在第一行之后的所有行上添加提示。当对控件进行子类化时，您会得到很多无法完全按照您想要的方式工作的行为。

# python - 在 Python 中查找面向公众的 IP 地址？

> ID：166545
> 
> 赞同：21
> 
> 时间：2008-10-03T12:20:07.117
> 
> 标签：python, ip-address

如何在 Python 中为我的网络找到面向公众的 IP？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-03T12:22:07.410

这将获取您的远程 IP 地址

```
import urllib
ip = urllib.urlopen('http://automation.whatismyip.com/n09230945.asp').read() 
```

如果您不想依赖其他人，则只需上传类似以下 PHP 脚本的内容：

```
<?php echo $_SERVER['REMOTE_ADDR']; ?> 
```

并在 Python 中更改 URL，或者如果您更喜欢 ASP：

```
<%
Dim UserIPAddress
UserIPAddress = Request.ServerVariables("REMOTE_ADDR")
%> 
```

注意：我不知道 ASP，但我认为在这里可能会有用，所以我用谷歌搜索。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2016-07-18T12:23:19.677

[https://api.ipify.org/?format=json](https://api.ipify.org/?format=json)非常简单

只需运行即可解析`requests.get("https://api.ipify.org/?format=json").json()['ip']`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-03T12:25:55.593

whatismyip.org 更好......它只是将 ip 作为纯文本扔回，没有多余的废话。

```
import urllib
ip = urllib.urlopen('http://whatismyip.org').read() 
```

但是，是的，如果不依赖网络本身之外的东西，就不可能轻易做到这一点。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-11-29T08:44:59.323

```
import requests
r = requests.get(r'http://jsonip.com')
# r = requests.get(r'https://ifconfig.co/json')
ip= r.json()['ip']
print('Your IP is {}'.format(ip)) 
```

[参考](http://blog.tankorsmash.com/?p=340)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-04-30T16:10:35.870

如果您不介意脏话，请尝试：

[http://wtfismyip.com/json](http://wtfismyip.com/json)

正如其他人所展示的那样，将它绑定在通常的 urllib 东西中。

还有：

[http://www.networksecuritytoolkit.org/nst/tools/ip.php](http://www.networksecuritytoolkit.org/nst/tools/ip.php)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-04-04T15:20:27.213

```
import urllib2
text = urllib2.urlopen('http://www.whatismyip.org').read()
urlRE=re.findall('[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}',text)
urlRE        

['146.148.123.123'] 
```

尝试将您可以找到的任何“findmyipsite”放入列表中并遍历它们以进行比较。这个似乎运作良好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-07-18T21:07:25.763

这很简单

```
>>> import urllib
>>> urllib.urlopen('http://icanhazip.com/').read().strip('\n')
'xx.xx.xx.xx' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-02-11T00:34:38.807

您还可以使用 DNS，它在某些情况下可能比 http 方法更可靠：

```
#!/usr/bin/env python3

import dns.resolver

resolver1_opendns_ip = False
resolver = dns.resolver.Resolver()
opendns_result = resolver.resolve("resolver1.opendns.com", "A")
for record in opendns_result:
    resolver1_opendns_ip = record.to_text()

if resolver1_opendns_ip:
    resolver.nameservers = [resolver1_opendns_ip]
    myip_result = resolver.resolve("myip.opendns.com", "A")
    for record in myip_result:
        print(f"Your external ip is {record.to_text()}") 
```

这是python的等价物`dig +short -4 myip.opendns.com @resolver1.opendns.com`

# coding-style - 在 IF 块中放什么，在 ELSE 块中放什么？

> ID：166550
> 
> 赞同：12
> 
> 时间：2008-10-03T12:21:24.337
> 
> 标签：coding-style, function-exit

这是一个较小的风格问题，但您添加到代码中的每一点可读性都很重要。

所以，如果你有：

```
if (condition) then
{
   // do stuff
}
else
{
   // do other stuff
} 
```

你如何决定是这样还是这样更好：

```
 if (!condition) then
   {
     // do other stuff
   {
   else
   {
     // do stuff
   } 
```

我的启发是：

1.  保持条件积极（阅读时减少心理计算）
2.  将最常见的路径放入第一个块

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-03T12:26:13.063

我更喜欢把最常见的路径放在第一位，而且我坚信减少嵌套，所以我会尽可能中断、继续或返回而不是 elsing。我通常更喜欢针对正面条件进行测试，或者将 [和名称] 负面条件反转为正面。

```
if (condition)
    return;

DoSomething(); 
```

我发现，通过大幅减少 else 的使用，我的代码更具可读性和可维护性，当我必须使用 else 时，它​​几乎总是一个更结构化的 switch 语句的绝佳候选者。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T12:55:46.483

两个（矛盾的）教科书引述：

> 将 if/else 的最短子句放在最上面

——Allen Holub，“足够的绳子射中自己的脚”，第 52 页

> 将普通情况放在 if 之后而不是 else 之后

——史蒂夫·麦康奈尔，“代码完成，第 2 版。”，p356

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T12:24:42.630

我更喜欢第一个。条件应该尽可能简单，并且应该相当明显，哪个更简单 out of condition 和 !condition

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-03T12:28:36.850

这取决于你的流量。对于许多功能，我将使用前置条件：

```
bool MyFunc(variable) {
    if (variable != something_i_want)
        return false;

    // a large block of code
    // ...
    return true;
} 
```

如果我需要在每种情况下*都*做某事，我会使用一种`if (positive_clause) {} else {}`格式。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-03T12:31:24.177

如果代码是为了检查错误情况，我更喜欢把那个代码放在第一位，然后是“成功”的代码；从概念上讲，这将函数调用及其错误检查代码保持在一起，这对我来说很有意义，因为它们是相关的。例如：

```
 if (!some_function_that_could_fail())
  {
     // Error handling code
  }
  else
  {
     // Success code
  } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-03T12:31:58.670

我同意 Oli 在可能的情况下使用积极的 if 子句。

请永远不要这样做：

```
if (somePositiveCondition)
else {
    //stuff
} 
```

我曾经在我工作的一个地方经常看到这种情况，并且曾经想知道其中一位编码员是否不明白如何不工作......

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-03T13:02:50.353

当我查看数据验证时，我尝试将我的条件设为“白名单”——也就是说，我测试我将接受的内容：

```
if DataIsGood() then
   DoMyNormalStuff
else
   TakeEvasiveAction 
```

而不是反过来，它往往会退化为：

```
if SomeErrorTest then
  TakeSomeEvasiveAction
else if SomeOtherErrorCondition then
  CorrectMoreStupidUserProblems
else if YetAnotherErrorThatNoOneThoughtOf then
  DoMoreErrorHandling
else
  DoMyNormalStuff 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-03T12:39:22.930

我知道这并不完全是您要寻找的，但是……许多开发人员使用“保护子句”，即尽快脱离方法的否定“if”语句。那时，真的没有“其他”。

例子：

```
if (blah == false)
{
    return; // perhaps with a message
}

// do rest of code here... 
```

那里有一些铁杆 c/c++/assembly 家伙会告诉你，你正在破坏你的 CPU ！！！（在许多情况下，处理器倾向于“真”语句并尝试“预取”接下来要做的事情......所以理论上任何“假”条件都会刷新管道并且会慢几微秒）。

在我看来，我们正处于“更好”（更易于理解）的代码在几微秒的 CPU 时间中胜出的地步。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-03T12:47:51.007

我认为对于单个变量，not 运算符足够简单，并且命名问题开始变得更加相关。

永远不要将变量命名为 not_X，如果需要，请使用词库并找到相反的词。我见过很多糟糕的代码，比如

```
if (not_dead) {
} else {
} 
```

而不是显而易见的

```
if (alive) {
} else {
} 
```

然后你可以理智地使用（非常可读，无需反转代码块）

```
if (!alive) {
} else {
} 
```

如果我们谈论更多变量，我认为最好的规则是简化条件。一段时间后，项目往往会遇到以下情况：

```
if (dead || (!dead && sleeping)) {
} else {
} 
```

这转化为

```
if (dead || sleeping) {
} else {
} 
```

始终注意条件是什么样的以及如何简化它们。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-03T12:57:45.763

软件是知识获取。您正在编码某人关于如何做某事的知识。

该软件应该适合问题的“自然”。如有疑问，请询问其他人，看看人们实际所说和所做的。

“常见”情况是什么都不做的情况呢？然后怎样呢

```
if( common ) {
    // pass
}
else {
    // great big block of exception-handling folderol
} 
```

或者你这样做？

```
if( ! common ) {
    // great big block of except-handling folderol
} 
```

“总是积极的”规则并不是你首先想要的。您想查看更多类似以下的规则。

1.  总是自然的——它应该读起来像英语（或者你组织中的任何通用语言。）
2.  在可能的情况下，首先是常见情况——所以它们看起来很常见。
3.  尽可能使用正逻辑；否定逻辑可以用在通常这样说的地方，或者常见的情况是什么都不做的地方。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-03T13:01:57.470

如果两条路径中的一条很短（1 到 10 行左右），而另一条则更长，我遵循[这里提到的 Holub 规则](https://stackoverflow.com/questions/166550/what-to-put-in-the-if-block-and-what-to-put-in-the-else-block#166687)，并将较短的一段代码放在 if.xml 中。这使得在查看代码时更容易在一个屏幕上查看 if/else 流程。

如果那是不可能的，那么我构造使条件尽可能简单。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-03T12:29:54.820

对我来说，这取决于条件，例如：

```
if (!PreserveData.Checked)
{  resetfields();} 
```

我倾向于用我想要的逻辑与自己交谈，并将其编码为我脑海中的小声音。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-03T13:05:13.407

您通常可以在不切换 if / else 块的情况下使条件为正。

改变

```
 if (!widget.enabled()) {
     // more common 
   } else {
     // less common 
   } 
```

到

```
 if (widget.disabled()) {
     // more common 
   } else {
     // less common
   } 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-03T13:33:26.813

Intel Pentium 分支预测为“if”情况预取指令。如果它改为跟随“else”分支：它会刷新指令流水线，导致停顿。

如果您非常关心性能：将最可能的结果放在“if”子句中。

我个人把它写成

```
if (expected)
{
   //expected path
}
else
{
   //fallback other odd case
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-03T14:05:57.543

如果您同时具有真假条件，那么我会选择肯定条件 - 这可以减少混淆，并且总的来说我相信您的代码更易于阅读。

另一方面，如果您使用 Perl 之类的语言，特别是如果您的错误条件是错误条件或最常见的条件，则可以使用“除非”结构，它执行代码块，除非条件为真（即 if 的反面）：

```
unless ($foo) {
    $bar;
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-31T09:54:29.653

首先，让我们先把最好避免使用“else”的情况放在一边（我希望每个人都同意这种情况确实存在，确定这种情况可能应该是一个单独的话题）。

所以，让我们假设必须有一个“else”子句。

我认为可读性/可理解性至少强加了三个关键要求或规则，不幸的是，它们经常相互竞争：

1.  第一个块（“if”块）越短，就越容易掌握整个“if-else”结构。当“if”块足够长时，很容易忽略“else”块的存在。

2.  当“if”和“else”路径在逻辑上不对称时（例如“正常处理”与“错误处理”），在**独立**的“if-else”构造中，哪条路径是第一条路径和第二条路径并不重要. 然而，当有**多个**“if-else”结构彼此靠近时（包括嵌套），并且当所有这些“if-else”结构具有相同类型的不对称性时 - 安排这些不对称路径非常重要始终如一。

    同样，它可以是“如果……正常路径……否则……异常路径”，也可以是“如果……异常路径……否则……正常路径”，但不应该是这两种变体的混合。

    在所有其他条件相同的情况下，对大多数人来说，将正常路径放在首位可能更自然（我认为这更多的是关于心理学而不是美学:-)。

3.  以否定开头的表达式通常比不以否定开头的表达式可读性/可理解性差。

所以，我们有这三个相互竞争的要求/规则，真正的问题是：它们中的哪一个比其他的更重要。对于 Allen Holub 来说，第 1 条规则可能是最重要的一条。对于史蒂夫·麦康奈尔来说——这是规则#2。但我不认为你真的可以只选择这些规则中的一个作为单一的quideline。

我敢打赌，您已经猜到了我个人的优先事项（从我订购上述规则的方式来看：-）。

我的理由很简单：

*   第 1 条规则是无条件的，无法规避。如果其中一个块太长以至于它跑出屏幕 - 它必须成为“其他”块。（不，仅仅为了减少“if”或“else”块中的行数而机械地创建函数/方法并不是一个好主意！我假设每个块已经具有**逻辑上合理**的最小行数。 )

*   规则 #2 涉及很多条件：多个“if-else”结构，都具有相同类型的不对称性，等等。所以它在很多情况下并不适用。

    另外，我经常观察到以下有趣的现象：当第 2 条规则适用并且使用得当时，它实际上与第 1 条规则并不冲突！例如，每当我有一堆“正常与异常”不对称的“if-else”语句时，所有“异常”路径都比“正常”路径短（反之亦然）。我无法解释这种现象，但我认为这只是代码组织良好的标志。换句话说，每当我看到规则#1 和#2 发生冲突的情况时，我就会开始寻找“代码异味”，而且我经常会找到一些；重构之后 - tada！在规则 #1 和规则 #2 之间选择不再痛苦，:-)

*   最后，规则#3 的范围最小，因此最不重要。

    此外，正如其他同事在此提到的，使用此规则“作弊”通常很容易（例如，写“if(disabled),,”而不是“if(!enabled)...”）。

我希望有人能对这个作品有所了解...

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-03T12:32:36.717

作为一般规则，如果一个明显大于另一个，我将较大的一个作为`if`块。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-03T12:32:46.047

1.  把公共路径放在第一位
2.  化消极为积极（`!full == empty`）

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-03T12:54:13.443

如果您必须有多个出口点，请将它们放在第一位并明确：

```
if TerminatingCondition1 then
  Exit
if TerminatingCondition2 then
  Exit 
```

现在我们可以使用通常的东西进行处理：

```
if NormalThing then
  DoNormalThing
else
  DoAbnormalThing 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-03T13:40:34.037

我总是把最有可能的放在第一位。

在 Perl 中，我有一个额外的控制结构来帮助解决这个问题。如果的倒数。

```
unless (alive) {
     go_to_heaven;
} else {
     say "MEDIC";
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-03T14:50:28.093

您应该始终将最可能的情况放在首位。除了更具可读性之外，它还更快。这也适用于 switch 语句。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-03T15:38:16.500

当谈到我如何设置 if 语句时，我很可怕。基本上，我根据我正在寻找的内容进行设置，这导致一切都不同。

if (userinput = null){
explodeViolently();
} else {
实际做事；
}

或者类似

if (1+1=2) {
do stuff;
} 其他 {
爆炸暴力（）；
}

if/else 语句的哪个部分实际上为我做事是我的一个坏习惯。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2012-07-16T13:54:35.943

我通常把肯定的结果（所以方法）放在开头，所以：

```
if(condition)
{
doSomething();
}
else
{
System.out.println("condition not true")
} 
```

但是，如果要使用的方法条件必须为假，我会这样做：

```
if(!condition)
{
doSomething();
}
else
{
System.out.println("condition true");
} 
```

# database-design - 一个好的数据库建模工具？

> ID：166557
> 
> 赞同：33
> 
> 时间：2008-10-03T12:23:13.227
> 
> 标签：database-design

你们能推荐我一个好的数据库建模工具吗？主要针对 SQL Server...

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-03T12:28:02.343

如果是用于 SQL Server，我喜欢 SQL Server Management Studio 的 DB Diagram。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-03T12:35:21.953

如果你的雇主付钱，[ER Studio](http://www.embarcadero.com/products/erstudio/)就太棒了。我不知道没有它其他人如何运作。它很容易让我的工作效率提高 50%。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T12:29:28.720

[StarUML](http://staruml.sourceforge.net/en/index.php)有一个允许创建实体关系图的模块。但是，我从未将它用于此目的，所以我不知道它有多好，但我确实喜欢用于 UML 图的 StarUML。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-03T12:30:52.337

有趣的是，我发现：

[万维网 SQL 设计器](http://ondras.zarovi.cz/sql/)

在紧要关头有用。我也是他的[Instant SQL Formatter](http://www.wangz.net/cgi-bin/pp/gsqlparser/sqlpp/sqlformat.tpl)的粉丝，尽管“即时”他的意思是“不是 T-SQL”，所以你必须稍微手动编辑 Profiler 记录的语句才能充分使用他的系统。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-03T12:37:05.787

我衷心推荐[Sparx Enterprise Architect](http://www.sparxsystems.com.au/products/ea/index.html)。

或者，适用于企业架构师的 Visio 运行良好，您可以将它与 Visual Studio 结合使用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-03T12:38:14.537

在我看来，ERwin Data Modeler 是企业数据库建模的最佳工具。我已经用过很多次了，它很棒。请参阅：[http ://www.ca.com/us/products/product.aspx?id=260](http://www.ca.com/us/products/product.aspx?id=260)

它有点贵，但值得。您也可以免费试用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-03-26T08:58:36.857

我试过 Navicat 数据建模器。这是迄今为止我发现的最好的数据建模工具。它有一个免费版本。

免费版本可在以下位置找到：[Navicat 数据建模器](http://www.navicat.com/en/products/navicat_datamodeler/modeler_overview.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-03T12:26:50.660

如果您的意思是绘制实体关系图，那么我建议使用 Visio。它甚至会从图表构建您的数据库。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-03T12:37:15.990

为 MySQL尝试[http://www.fabforce.net/dbdesigner4/](http://www.fabforce.net/dbdesigner4/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-03T12:38:14.897

我也倾向于使用 SQL Server Management Studio 来快速做一些事情，但是当我在做实际的实现或更高级的事情时，我使用[EMS Sql Manager](http://www.sqlmanager.net/en/products/mssql/manager)。它是一个相当不错的工具，具有比 Sql Management Studio 更高级和更多的功能。你可以把它想象成 MS SQL 管理工作室。虽然需要一些时间来适应 UI，但仍然足够直截了当。如果你得到他们[所有产品的包裹，](http://www.sqlmanager.net/en/products/studio/mssql)你也会得到很多很棒的实用程序。

如果它只是绘制图表，我将使用 Visio。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-03T12:38:22.150

一段时间以来，我一直在使用曾经被称为“Case Studio”的东西并取得了巨大的成功。它现在被称为“ [Toad Data Modeller](http://www.casestudio.com/) ”。

它是有报酬的，但相当不错，至少值得一试。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-03T12:38:37.953

就我个人而言，我一直很喜欢[Dia](http://live.gnome.org/Dia)，它无处不在、便携、易于使用，并且支持除了 ER/UML 之外的一大堆其他图表，因此我可以使用它为非技术人员制作图表。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-18T16:48:55.353

[来自http://www.modelright.com](http://www.modelright.com)的ModelRight非常适合物理建模。对 Oracle、MySQL、SQL Server 等的出色支持。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-03T12:56:50.523

我非常成功地使用铅笔和纸来记录最初的实体和关系。如果与其他人一起设计特别好，您不会被 GUI 界面、鼠标移动、正确的背景渐变等分心。然后您可以将其转换为 Visio 或 Dia 或生成 SQL Schema 和的 UML 工具你的对象模型...

通常在这段时间之后，限制意味着您最终会使用 TOAD 或您选择的 DB 工具来获取表、索引、外键和以直接 SQL 或使用它们的表设计器工具实现的东西。变化将不可避免地出现在下游，所以不要花太长时间准确地了解事情，只要把结构弄好就行了。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-19T16:51:48.297

[您可以使用GraphViz](http://www.graphviz.org/)记录绘制 ERD 。这不会跟踪/组织您的元数据，生成您的 DDL 或其他任何事情 - 但它会给您一个实体关系图，您可以轻松地编辑/更新。

它将为您处理图表的所有布局/安排细节。它在这方面做得很好。它是一种声明性的图表绘制语言。非常简单易学。只需要使用文本编辑器即可。许多应用程序也在幕后使用它的能力来生成他们的图表。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-21T12:32:37.787

我第二个 Embarcadero ERStudio。不便宜但功能强大，多平台且非常易于使用。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-21T12:38:55.623

好吧，如果您使用的是 SQL Server，正如我在其他帖子中提到的那样，Visio 可能会非常适合您。您可能已经拥有它，或者您的 IT 商店已经拥有它，因此成本可以忽略不计，它可以导入现有数据库，或者如果您从头开始构建，则可以将其导出到指定的 SQL Server。

我已经使用了好几次并且对结果很满意。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-22T11:02:51.910

[ModelRight](http://www.modelright.com/)是最好的工具——尤其是为了钱。

# validation - HTTP 响应拆分

> ID：166565
> 
> 赞同：1
> 
> 时间：2008-10-03T12:26:33.610
> 
> 标签：validation, response, split

我正在尝试处理这种可能的漏洞，并想知道最好的方法是什么？我应该使用 apache 的 common-validator 并创建一个已知允许符号列表并使用它吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T12:33:11.380

来自[维基百科文章](http://en.wikipedia.org/wiki/HTTP_response_splitting)：

> 通用解决方案是在包含到 HTTP 标头（例如 Location 或 Set-Cookie）之前对字符串进行 URL 编码。
> 
> 清理的典型示例包括强制转换为整数或积极的正则表达式替换。值得注意的是，虽然这不是 PHP 特有的问题，但 PHP 解释器从 4.4.2 和 5.1.2 版本开始就包含针对这种攻击的保护。

**编辑**

> 我将 jsp 与 java 操作联系在一起！

似乎没有针对此攻击向量的任何基于 JSP 的保护 - 网络上的许多描述假设为 asp 或 php，但[此链接](http://www.webappsec.org/projects/threat/classes/http_response_splitting.shtml)描述了一种相当平台中立的方法来解决问题（jsp 用作其中的一个附带示例）。

基本上，您的第一步是识别潜在危险字符（CR、LF 等），然后将其删除。恐怕这与您希望的一样强大的解决方案！

> **解决方案**
> 
> 验证输入。在将数据嵌入任何 HTTP 响应标头之前删除 CR 和 LF（以及所有其他危险字符），尤其是在设置 cookie 和重定向时。可以使用第三方产品来防御 CR/LF 注入，并在应用程序部署之前测试此类安全漏洞的存在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T12:37:08.050

[使用 PHP](http://en.wikipedia.org/wiki/HTTP_response_splitting)吗？;)

根据 Wikipedia 和 PHP CHANGELOG，PHP 在 PHP4 自 4.4.2 起和 PHP5 自 5.1.2 起具有针对它的保护。

* * *

只是略读了一遍——但是，[这可能会有所帮助](http://www.ddj.com/security/184405766)。他的示例是用 JSP 编写的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T12:38:09.360

好的，在读取字符串时，很好地转换为 int 并没有多大用处，在从浏览器接收输入的每个操作中也使用正则表达式可能会很混乱，我正在寻找一个更强大的解决方案

# flash - Flash IDE - 在库中查找符号

> ID：166575
> 
> 赞同：0
> 
> 时间：2008-10-03T12:29:37.223
> 
> 标签：flash, ide

我继承了一个 Flash 项目（我的第一个），该项目在库中有许多现有符号。它们被组织在一个大型复杂的文件夹层次结构中。通常，我会在 actionscript 代码中找到对符号的引用，但在库中找不到该符号。“查找”功能仅搜索符号的实例。如果不存在，是否可以在库中找到符号而无需手动检查每个文件夹？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-03T12:36:11.327

这会很有帮助 [http://www.gskinner.com/products/panelpack1/gSearch.php](http://www.gskinner.com/products/panelpack1/gSearch.php)

# java - java 日期格式与 xquery xs:date 格式不兼容，如何解决？

> ID：166600
> 
> 赞同：3
> 
> 时间：2008-10-03T12:37:35.427
> 
> 标签：java, date, time, xquery

在 java 中，当使用 SimpleDateFormat 和模式时：

```
yyyy-MM-dd'T'HH:mm:ss.SSSZ 
```

日期输出为：

```
"2002-02-01T18:18:42.703-0700" 
```

在 xquery 中，当使用 xs:dateTime 函数时，它给出了错误：

```
"Invalid lexical value [err:FORG0001]" 
```

与上述日期。为了让 xquery 正确解析，日期需要如下所示：

```
"2002-02-01T18:18:42.703-07:00" - node the ':' 3rd position from end of string 
```

它基于 ISO 8601，而 Java 日期基于 RFC 822 标准。

我希望能够轻松地在 Java 中指定时区，以便它以 xquery 想要的方式输出。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T14:37:28.540

好的，链接到论坛帖子DID帮助，谢谢。但是，我确实找到了一个更简单的解决方案，其中包括以下内容：

1) 使用 Apache commons.lang java 库
2) 使用以下 java 代码：

```
//NOTE: ZZ on end is not compatible with jdk, but allows for formatting  
//dates like so (note the : 3rd from last spot, which is iso8601 standard):  
//date=2008-10-03T10:29:40.046-04:00  
private static final String DATE_FORMAT_8601 = "yyyy-MM-dd'T'HH:mm:ss.SSSZZ";  
DateFormatUtils.format(new Date(), DATE_FORMAT_8601) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T15:27:10.280

好吧，我确实遇到了一个问题 - 在我看来（我可能是错的）没有任何方法可以将 DateUtils（来自 apache commons lang）创建的 ISO 字符串转换回日期！
IE。apache commons 将按照我想要的方式对其进行格式化，但不会再次将其转换回日期

所以，我切换到 JodaTime，因为它基于 ISO8601，所以它更容易 - 这是代码：

```
public static void main(String[] args) {
    Date date = new Date();  
    DateTime dateTime = new DateTime(date);  
    DateTimeFormatter fmt = ISODateTimeFormat.dateTime();  
    String dateString = fmt.print(dateTime);  
    System.out.println("dateString=" + dateString);  
    DateTime dt = fmt.parseDateTime(dateString);  
    System.out.println("converted date=" + dt.toDate());  
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-29T20:15:46.873

关于 commons.lang.java 的伟大发现！您甚至可以通过执行以下操作来避免创建自己的格式字符串：

```
DateFormatUtils.ISO_DATETIME_TIME_ZONE_FORMAT.format(new Date()); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T13:03:56.250

尝试这个：

```
static public String formatISO8601(Calendar cal) {
MessageFormat format = new MessageFormat("{0,time}{1,number,+00;-00}:{2,number,00}");

DateFormat df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss");
df.setTimeZone(cal.getTimeZone());
format.setFormat(0, df);

long zoneOff = cal.get(Calendar.ZONE_OFFSET) + cal.get(Calendar.DST_OFFSET) / 60000L;
int zoneHrs = (int) (zoneOff / 60L);
int zoneMins = (int) (zoneOff % 60L);
if (zoneMins < 0)
    zoneMins = -zoneMins;

return (format.format(new Object[] { cal.getTime(), new Integer(zoneHrs), new Integer(zoneMins) }));
} 
```

# apache - 如何在不访问命令行的情况下找到正在运行的 Apache 版本？

> ID：166607
> 
> 赞同：77
> 
> 时间：2008-10-03T12:38:30.713
> 
> 标签：apache

我需要找到一个对版本进行编码的文件，或者找到一种在网络上轮询它的方式，以便它显示它的版本。虽然我可以通过 FTP 浏览安装位置，但服务器运行在不会为我提供命令行访问权限的主机上。

我已经尝试过 HEAD 并且没有报告版本号。

如果我尝试丢失页面来获取 404，它会被拦截，并返回一个没有服务器信息的股票页面。我想这表明服务器正在硬化。

还是没有靠近...

我按照建议放置了一个 PHP 文件，但我无法浏览它，也无法确定加载它的 URL 路径。无论如何，我都会收到大量拒绝访问的消息和相同的库存 404 页面。知道服务器受到非常强大的保护，我感到很欣慰。

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2008-10-03T12:40:31.757

# 方法

连接到主机上的80端口并发送

```
HEAD / HTTP/1.0 
```

这需要后跟回车+换行两次

你会得到这样的东西

```
HTTP/1.1 200 OK
Date: Fri, 03 Oct 2008 12:39:43 GMT
Server: Apache/2.2.9 (Ubuntu) DAV/2 SVN/1.5.0 PHP/5.2.6-1ubuntu4 with Suhosin-Patch mod_perl/2.0.4 Perl/v5.10.0
Last-Modified: Thu, 02 Aug 2007 20:50:09 GMT
ETag: "438118-197-436bd96872240"
Accept-Ranges: bytes
Content-Length: 407
Connection: close
Content-Type: text/html; charset=UTF-8 
```

然后，您可以从 Server: 标头中提取 apache 版本

# 您可以使用的典型工具

您可以使用完整安装 Perl 的[LWP](http://search.cpan.org/%7Egaas/libwww-perl-5.816/lib/LWP.pm)库的 HEAD 实用程序，例如

```
HEAD http://your.webserver.com/ 
```

或者，使用[curl](http://curl.haxx.se/)实用程序，例如

```
 curl --head http://your.webserver.com/ 
```

您还可以使用浏览器扩展来查看服务器标头，例如[Live HTTP Headers](https://addons.mozilla.org/en-US/firefox/addon/3829)或Firefox 的[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)，或IE的[Fiddler](http://www.fiddlertool.com/fiddler/)

# 卡在 Windows 上？

最后。如果您在 Windows 上，并且没有其他可用的东西，请打开命令提示符（开始菜单-> 运行，键入“cmd”并按回车键），然后键入

```
telnet your.webserver.com 80 
```

然后输入（小心，你的字符不会被回显）

```
HEAD / HTTP/1.0 
```

按两次回车，您将看到服务器标头。

# 其他方法

正如 cfeduke 和 Veynom 所提到的，可以将服务器设置为在 Server: 标头中返回有限的信息。尝试将 PHP 脚本上传到您的主机

```
<?php phpinfo() ?> 
```

使用 Web 浏览器请求该页面，您应该会看到那里报告的 Apache 版本。

您也可以尝试使用[PHPShell](http://phpshell.sourceforge.net/)进行探索，尝试类似的命令

```
/usr/sbin/apache2 -V 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2012-08-24T13:32:08.630

`httpd -v`将为您提供在您的服务器上运行的 Apache 版本（如果您有 SSH/shell 访问权限）。

输出应该是这样的：

```
Server version: Apache/2.2.3
Server built:   Oct 20 2011 17:00:12 
```

正如建议的那样，您也可以这样做`apachectl -v`，这将为您提供相同的输出，但会受到更多 Linux 风格的支持。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-03T12:48:54.250

很少有人将加固的 HTTP 服务器配置为不提供任何服务器信息或误导性的服务器信息。在这些情况下，如果服务器启用了 PHP，您可以添加：

```
<?php phpinfo(); ?> 
```

在一个文件中并浏览到它并查找

```
_SERVER["SERVER_SOFTWARE"] 
```

入口。这很容易受到同样缺乏信息/误导的影响，尽管我想它不会经常改变，因为这种方法首先需要访问机器来创建 PHP 文件。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-03T13:12:58.617

警告，一些 Apache 服务器在使用 HEAD 时并不总是发送它们的版本号，就像在这种情况下：

```
HTTP/1.1 200 OK
Date: Fri, 03 Oct 2008 13:09:45 GMT
Server: Apache
X-Powered-By: PHP/5.2.6RC4-pl0-gentoo
Set-Cookie: PHPSESSID=a97a60f86539b5502ad1109f6759585c; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Connection: close
Content-Type: text/html

Connection to host lost. 
```

如果确实安装了 PHP，只需使用 php info 命令：

```
<?php phpinfo(); ?> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-03T13:23:04.337

Apache 服务器给出的版本信息级别可以通过其配置中的 ServerTokens 设置进行配置。

我相信还有一个设置可以控制版本是否出现在服务器错误页面中，尽管我不记得它是什么。如果您没有直接访问服务器的权限，并且服务器管理员有能力并且不希望您知道他们正在运行的版本...我认为您可能是[SOL](https://en.wiktionary.org/wiki/SOL#Adjective)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T12:42:07.917

Telnet 到主机的 80 端口。

类型：

```
get / http1.1
::enter::
::enter:: 
```

这是一种 HTTP 请求，但它是无效的，所以它给你的 500 错误可能会给你你想要的信息。最后的空白行很重要，否则它似乎会挂起。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T12:44:17.567

如果他们启用了错误页面，您可以转到一个不存在的页面并查看 404 页面的底部。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-03T12:45:05.787

在默认安装中，调用一个不存在的页面，最后会出现版本错误：

> **找不到对象！**
> 
> 在此服务器上找不到请求的 URL。如果您手动输入了 URL，请检查您的拼写并重试。
> 如果您认为这是服务器错误，请联系网站管理员。
> 错误 404
> localhost
> 10/03/08 14:41:45
> Apache/2.2.8 (Win32) DAV/2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_autoindex_color PHP/5.2.5

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-03T13:25:46.720

你最好的选择是通过 PHP：来自客户端的所有版本请求都不能被信任，因为你的 Apache 可以配置为 ServerTokens Prod 和 ServerSignature Off。见：[http ://www.petefreitag.com/item/419.cfm](http://www.petefreitag.com/item/419.cfm)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-05-24T04:00:22.280

只需使用以下内容 - 字符串应该已经存在：

```
<?php
   if(isset($_SERVER['SERVER_SOFTWARE'])){
      echo $_SERVER['SERVER_SOFTWARE'];
   }
?> 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2015-08-17T08:24:51.890

使用这个 PHP 脚本：

```
 $version = apache_get_version();
    echo "$version\n"; 
```

Se *[apache_get_version](http://php.net/manual/en/function.apache-get-version.php)*。

# php - 我可以在类变量中添加一个没有赋值的 PHP 数组键吗？

> ID：166615
> 
> 赞同：2
> 
> 时间：2008-10-03T12:39:53.863
> 
> 标签：php, arrays, cakephp

我目前正在学习[IBM 关于 CakePHP 的教程](http://www-128.ibm.com/developerworks/edu/os-dw-os-php-cake1.html)

有一次我遇到了这段代码：

```
<?php
class Dealer extends AppModel {
    var $name = 'Dealer';
    var $hasMany = array (
        'Product' => array(
            'className' => 'Product',
            'conditions'=>, // is this allowed?
            'order'=>, // same thing here
            'foreignKey'=>'dealer_id'
        )
    );
}
?> 
```

当我运行它时，我收到以下错误消息：“第 7 行 /Applications/MAMP/htdocs/cakephp/app/models/product.php 中的解析错误：语法错误，意外'，'”

我是 PHP 的 n00b，所以我的问题是：是否允许使用没有赋值的键创建数组？有没有人玩过这个 tut 并知道发生了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-03T12:42:58.507

分配值 null 而不是遗漏任何内容。手册[说](http://php.net/isset)

> 如果测试已设置为 NULL 的变量，isset() 将返回 FALSE

```
<?php
class Dealer extends AppModel
{
var $name = 'Dealer';
var $hasMany = array ('Product' => array(
'className' => 'Product',
'conditions'=> null,
'order'=> null,
'foreignKey'=>'dealer_id')
);
}
?> 
```

这工作正常。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T12:42:47.617

这是合法的，但据我所知，您必须通过为其分配 null 来明确地说它是“空的”，

```
$hasMany = array ('Product' => array(
'className' => 'Product',
'conditions'=> null, // is this allowed?
'order'=> null, // same thing here
'foreignKey'=>'dealer_id')); 
```

您给出的示例听起来非常错误，并且可能不应该工作，因为它不是。

# c++ - 通过 https 发布时出现“CURLE_OUT_OF_MEMORY”错误

> ID：166617
> 
> 赞同：5
> 
> 时间：2008-10-03T12:40:14.237
> 
> 标签：c++, curl, https, openssl

我正在尝试编写一个使用 libCurl 将肥皂请求发布到安全 Web 服务的应用程序。此 Windows 应用程序是针对 libCurl 版本 7.19.0 构建的，而 libCurl 版本又是针对 openssl-0.9.8i 构建的。相关curl相关代码如下：

> ```
> 文件 *input_file = fopen(current->post_file_name.c_str(), "rb");
> 文件 *output_file = fopen(current->results_file_name.c_str(), "wb");
> 如果（输入文件 && 输出文件）
> {
>     结构 curl_slist *header_opts = 0;
>     CURLcode rcd;
> 
>     header_opts = curl_slist_append(header_opts, "内容类型: application/soap+xml; charset=utf8");
>     curl_easy_reset(curl_handle);
>     curl_easy_setopt(curl_handle, CURLOPT_NOPROGRESS, 1);
>     curl_easy_setopt(curl_handle, CURLOPT_WRITEDATA, output_file);
>     curl_easy_setopt(curl_handle, CURLOPT_READDATA, input_file);
>     curl_easy_setopt(curl_handle, CURLOPT_URL, fs_service_url);
>     curl_easy_setopt(curl_handle, CURLOPT_POST, 1);
>     curl_easy_setopt(curl_handle, CURLOPT_HTTPHEADER, header_opts);
>     rcd = curl_easy_perform(curl_handle);
>     如果（rcd！= 0）
>     {
>         当前->curl_result = rcd;
>         当前->curl_error = curl_easy_strerror(rcd);
>     }
>     curl_slist_free_all(header_opts);
> }
> 
> ```

当我尝试执行 URL 时，curl 返回一个 CURLE_OUT_OF_MEMORY 错误，这似乎与分配 SSL 上下文失败有关。以前有没有其他人遇到过这个问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-04-07T11:26:24.007

我有同样的问题，只是想添加注释，而不是直接调用 OpenSsl 导出 SSL_library_init 它可以通过将标志 CURL_GLOBAL_SSL 添加到 curl_global_init 来[修复](http://curl.haxx.se/libcurl/c/curl_global_init.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T12:58:37.710

经过进一步调查，我发现这个错误是由于调用 SSL_library_init() 初始化 openSSL 库失败造成的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-05-19T08:08:30.490

如[本答案](https://stackoverflow.com/a/37295100/363437)所述，升级到 Ubuntu 16.04 后我遇到了相同的症状。解决方案是像这样使用 TLS。

```
curl_easy_setopt(curl_, CURLOPT_SSLVERSION, CURL_SSLVERSION_TLSv1_2)); 
```

显然 SSLv3在 Ubuntu 16.04 上[被禁用。](https://launchpad.net/ubuntu/+source/openssl/1.0.2g-1ubuntu1)

# php - PHP utf8 问题

> ID：166623
> 
> 赞同：3
> 
> 时间：2008-10-03T12:41:56.277
> 
> 标签：php, utf-8

将带有挪威字符的数组与 utf8 字符进行比较时，我遇到了一些问题。

除了特殊的挪威字符（æ、ø、å）之外的所有字符都可以正常工作。

```
function isNorwegianChar($Char)
{
    $aNorwegianChars = array('a', 'A', 'b', 'B', 'c', 'C', 'd', 'D', 'e', 'E', 'f', 'F', 'g', 'G', 'h', 'H', 'i', 'I', 'j', 'J', 'k', 'K', 'l', 'L', 'm', 'M', 'n', 'N', 'o', 'O', 'p', 'P', 'q', 'Q', 'r', 'R', 's', 'S', 't', 'T', 'u', 'U', 'v', 'V', 'w', 'W', 'x', 'X', 'y', 'Y', 'z', 'Z', 'æ', 'Æ', 'ø', 'Ø', 'å', 'Å', '=', '(', ')', ' ', '-');
    $iArrayLength = count($aNorwegianChars);

    for($iCount = 0; $iCount < $iArrayLength; $iCount++)
    {
        if($aNorwegianChars[$iCount] == $Char)
        {
            return true;
        }
    }

    return false;

} 
```

如果有人对我能做什么有任何想法，请告诉我。

**更新：**

需要这个的原因是我正在尝试解析一个文本文件，其中包含挪威语和中文单词的行，比如字典。我想将该行拆分为字符串，一个包含挪威语单词，一个包含中文。这稍后将被插入到数据库中。示例行：

impulsiv 形变的</p>

imø动动，反对，</tåp>

imøtekomme 动 符合

alkoholmisbruker(名脂质人)

alkoholpåvirket 形受酒精影响的

alkotest 名呼吸性血液循环测试</p>

alkymi(st) 名炼金术（名炼金术士）

all, alt, alle, 形 全部, 所有

正如你所看到的，单词之间可能有空格，所以我不能使用像explode这样简单的东西来区分中文和挪威语单词。我所做的是使用 isNorwegianChar 并遍历该行，直到找到一个不在数组中的字符。

问题是 æ、ø 和 å 没有作为挪威字符返回，它认为中文单词已经开始。

这是代码：

```
 //Open file.
$rFile = fopen("norsk-kinesisk.txt", "r");

// Loop through the file.
$Count = 0;
while(!feof($rFile))
{
    if(40== $Count)
    {
        break;
    }

    $sLine = fgets($rFile);

    if(0 == $Count)
    {
        $sLine = mb_substr($sLine, 3);
    }

    $iLineLength        = strlen($sLine);
    $bChineseHasStarted = false;
    $sNorwegianWord     = '';
    $sChineseWord       = '';
    for($iCount2 = 0; $iCount2 < $iLineLength; $iCount2++)
    {
        $char = mb_substr($sLine, $iCount2, 1);

        if(($bChineseHasStarted === false) && (false == isNorwegianChar($char)))
        {
            $bChineseHasStarted = true;
        }

        if(false === $bChineseHasStarted)
        {
            $sNorwegianWord .= $char;
        }
        else
        {
            $sChineseWord .= $char;
        }

        //echo $char;
    }

    $sNorwegianWord = trim($sNorwegianWord);
    $sChineseWord = trim($sChineseWord);

    $Count++;
}

fclose($rFile); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T12:45:54.100

首先，如果没有其他人回答，我稍后会使用 UTF-8，像你一样迭代是搜索数组的一种非常糟糕的方式。PHP为此提供了内置函数：

[http://fr.php.net/array_search](http://fr.php.net/array_search)

因此，您可能想尝试一下，看看它是否有助于解决您的问题。还要确保您正在编写的 PHP 文件也以 UTF-8 编码！

**更新：**

试试下面的代码，它在我的服务器上工作得很好。如果它不起作用，请检查 PHP 是否默认配置为使用 UTF-8，或者添加必要的 ini_set 调用。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head><title>norvegian utf-8 test</title>
<meta http-equiv="Content-type" value="text/html; charset=UTF-8" />
</head>

<body>

<?php

function isSpecial($char) {
    $special_chars = array("æ", "ø", "å", "か");
    return (array_search($char, $special_chars) !== false);
}

if (isset($_REQUEST["char"])) {
    echo $_REQUEST["char"].(isSpecial($_REQUEST["char"])?" (true)":" (false)");
}

?>

<form  method="POST" accept-charset="UTF-8">
<input type="text" name="char">
<input type="submit" value="submit">
</form>

</body>
</html> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T12:54:14.630

如果您的 PHP 脚本文件具有 ANSI 编码，而不是 UTF-8，那么在字节级别上，这些挪威字符将不同于它们以 UTF-8 编码时的样子。由于 PHP 是一种字节处理语言，而不是文本处理语言，因此它会适当地比较字节序列并得出它们不匹配的结论。

要解决此问题，您可以确保您的 PHP 脚本与您要比较的字符集具有相同的编码，或者您可以使用 iconv 或 mbstring 库转换为适当的字符集。

另外，如果您还没有阅读它，请阅读：[http ://www.joelonsoftware.com/articles/Unicode.html](http://www.joelonsoftware.com/articles/Unicode.html)

**更新：**
您要考虑的另一点是确保您传递给此函数的内容是您认为的内容。如果您使用数组索引运算符一次遍历一个字符串，它将不起作用，因为您的 UTF-8 字符串可能使用两个字节（两个数组索引位置）来存储一个字符。mbstring 中有一些函数可以根据字符位置而不是字节位置从字符串中复制文本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T15:43:05.023

我终于弄明白了。这可能不是一个好方法，但它确实有效。

看起来我正在使用的数组与输入字符的字符集不同。我通过制作一个包含所有数组元素的字符串来解决这个问题，然后使用 mb_strpos 搜索字符。因此，对代码的唯一更改是 isNorwegianChar 函数。新函数如下所示：

```
function isNorwegianChar($Char)
{
    $sNorwegianChars = "'aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZæÆøØåÅ=() -,";

    if(mb_strpos($sNorwegianChars, $Char))
    {
        return true;
    }
    else
    {
        return false;
    }
} 
```

感谢所有的帮助！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T13:01:44.803

尝试使用 utf8 编码和解码的函数。可能有帮助

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T12:50:57.740

查看是否安装了 mbstring 扩展

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T12:56:10.850

据我所知，如果您可以访问网络服务器，最好的办法是安装 mbstring ( [http://www.php.net/manual/en/ref.mbstring.php ) 扩展。](http://www.php.net/manual/en/ref.mbstring.php)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-05T17:57:15.283

由于问题是将挪威语单词与中文单词分开，您为什么不使用明确的字形来这样做（我个人喜欢“¶”），而不是依靠算法？

impulsiv¶形波动的</p>

然后使用[mb-split](http://fr.php.net/manual/en/function.mb-split.php)或[mb-substr](http://fr.php.net/manual/en/function.mb-substr.php)与[mb-strpos](http://fr.php.net/manual/en/function.mb-strpos.php)结合使用。

如果您需要输出字符串，您可以轻松地将其替换为空格！

遗憾的是，PHP 中的 PCRE 不允许我们将 \p 与[脚本名称](http://regexkit.sourceforge.net/Documentation/pcre/pcresyntax.html#SEC6)一起使用。

（在[regexp.reference](http://fr.php.net/manual/en/regexp.reference.php)的 §“Unicode 字符属性”中查找“InMusicalSymbols”，以了解我的意思）

# c++ - 如何在 C++ 中重复一个字符串可变次数？

> ID：166630
> 
> 赞同：158
> 
> 时间：2008-10-03T12:43:04.590
> 
> 标签：c++

我想在 C++ 中字符串的开头插入“n”个空格（或任何字符串）。有没有使用 std::strings 或 char* 字符串的直接方法？

例如，在 Python 中你可以简单地做

```
>>> "." * 5 + "lolcat"
'.....lolcat' 
```

* * *

## 回答 #1

> 赞同：236
> 
> 时间：2008-10-03T12:48:10.117

在重复单个字符的特殊情况下，您可以使用[`std::string(size_type count, CharT ch)`](http://www.cppreference.com/wiki/string/string_constructors)：

```
std::string(5, '.') + "lolcat" 
```

这不能用于重复多字符串。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-10-03T16:43:34.900

没有直接的惯用方法可以在 C++ 中重复字符串，相当于Python中的*****运算符或Perl 中的**x运算符。**如果您重复单个字符，则双参数构造函数（如先前答案所建议的那样）效果很好：

```
std::string(5, '.') 
```

这是一个人为的示例，说明如何使用 ostringstream 将字符串重复 n 次：

```
#include <sstream>

std::string repeat(int n) {
    std::ostringstream os;
    for(int i = 0; i < n; i++)
        os << "repeat";
    return os.str();
} 
```

根据实现的不同，这可能比简单地连接字符串 n 次更有效。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-03T13:42:02.600

使用 string::insert 的一种形式：

```
std::string str("lolcat");
str.insert(0, 5, '.'); 
```

这将在字符串的开头（位置 0）插入“.....”（五个点）。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2010-07-07T09:50:45.567

我知道这是一个老问题，但我想做同样的事情并找到了我认为更简单的解决方案。看来 cout 具有内置于 cout.fill() 的此功能，请参阅链接以获取“完整”说明

[http://www.java-samples.com/showtutorial.php?tutorialid=458](http://www.java-samples.com/showtutorial.php?tutorialid=458)

```
cout.width(11);
cout.fill('.');
cout << "lolcat" << endl; 
```

输出

```
.....lolcat 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2018-04-10T01:12:01.783

就 OP 提供的示例而言，std::string 的 ctor 就足够了：`std::string(5, '.')`. 但是，如果有人正在寻找重复 std::string 多次的函数：

```
std::string repeat(const std::string& input, unsigned num)
{
    std::string ret;
    ret.reserve(input.size() * num);
    while (num--)
        ret += input;
    return ret;
} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2015-12-16T20:39:21.333

正如 Commodore Jaeger 所暗示的那样，我认为其他任何答案都不能真正回答这个问题。问题询问如何重复一个字符串，而不是一个字符。

虽然 Commodore 给出的答案是正确的，但效率很低。这是一个更快的实现，其想法是通过首先以指数方式增长字符串来最小化复制操作和内存分配：

```
#include <string>
#include <cstddef>

std::string repeat(std::string str, const std::size_t n)
{
    if (n == 0) {
        str.clear();
        str.shrink_to_fit();
        return str;
    } else if (n == 1 || str.empty()) {
        return str;
    }
    const auto period = str.size();
    if (period == 1) {
        str.append(n - 1, str.front());
        return str;
    }
    str.reserve(period * n);
    std::size_t m {2};
    for (; m < n; m *= 2) str += str;
    str.append(str.c_str(), (n - (m / 2)) * period);
    return str;
} 
```

我们还可以定义一个`operator*`更接近 Python 版本的东西：

```
#include <utility>

std::string operator*(std::string str, std::size_t n)
{
    return repeat(std::move(str), n);
} 
```

在我的机器上，这比 Commodore 给出的实现快大约 10 倍，比简单的*“追加 n - 1 次”*解决方案快大约 2 倍。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-03T12:53:17.423

您应该编写自己的流操纵器

*   [http://www.two-sdg.demon.co.uk/curbralan/papers/WritingStreamManipulators.html](http://www.two-sdg.demon.co.uk/curbralan/papers/WritingStreamManipulators.html)

```
cout << multi(5) << "whatever" << "lolcat"; 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2018-04-02T14:51:58.230

您可以使用 C++ 函数来执行此操作：

```
 std::string repeat(const std::string& input, size_t num)
 {
    std::ostringstream os;
    std::fill_n(std::ostream_iterator<std::string>(os), num, input);
    return os.str();
 } 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-11-19T20:53:37.660

`repeated`这是字符串“abc” 3次的示例：

```
#include <iostream>
#include <sstream>
#include <algorithm>
#include <string>
#include <iterator>

using namespace std;

int main() {
    ostringstream repeated;
    fill_n(ostream_iterator<string>(repeated), 3, string("abc"));
    cout << "repeated: " << repeated.str() << endl;  // repeated: abcabcabc
    return 0;
} 
```

# security - 支付网关 API 登录和交易密钥会造成什么样的损害？

> ID：166639
> 
> 赞同：3
> 
> 时间：2008-10-03T12:45:44.430
> 
> 标签：security, payment-gateway, credit-card, authorize.net

目前，我正在招聘一名 Web 开发人员，他将在一个处理信用卡的网站上工作。虽然他没有登录支付网关 UI 的凭据，但他可以访问 API 登录和交易密钥，因为它嵌入在应用程序的代码中。

我想了解与使用该信息可能造成的损害类型有关的所有“假设”情景。显然，他可以处理信用卡，但钱会进入网站所有者的银行账户，所以我不确定这会造成多大的损失。谁能想到任何其他可能的情况？

更新：正在使用的支付网关是 Authorize.net。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T13:02:29.513

他们真的需要访问您的生产站点吗？

不要将密钥存储在代码中、将其存储在生产数据库或生产服务器上的文件中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T01:15:25.587

这里有一些很好的答案，我只想补充一点，您可能会遇到 PCI 问题。
PCI-DSS 特别规定了职责分离、生产环境与开发/测试的隔离、保护加密密钥免受任何不需要它的人的影响，等等。正如@Matthew Watson 所说，重新考虑这一点，不要向开发人员授予生产访问权限。

顺便说一句，如果他可以直接访问 API，您如何确保“钱进入网站所有者的银行账户”？更不用说访问所有信用卡数据了......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T12:55:24.800

如果开发人员可以访问原始信用卡号码，这可能会成为一个更大的问题，因为您的网站可能与欺诈活动相关联，假设开发人员是一个坏苹果。（他们可以将帐号、CCV、到期日期重定向到另一个站点，尽管这应该可以通过网络工具和全面的代码审查来发现。）

API 是否执行“$1.00”收费（或“$X.XX”）来验证信用卡是否可以收取一定金额（从而将结果返回给调用者，例如“yes”或“no”） ? 如果是这样，它可用于自动验证在 Internet 上交易的信用卡帐号，滥用此类系统可能会导致您反悔。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T12:55:42.210

对于我使用过的任何网关，支付处理器都会将 API 密钥与商家网站的特定 IP 或 IP 范围相关联。话虽如此，除非有问题的恶意（？）代码与商家在同一台服务器上执行 - 在这方面不应该有任何安全问题。

如果您的商家网站不是这种情况，请联系他们并询问这是否可行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T12:56:01.723

支付网关是否允许冲销费用？如果是这样，则可能会发生许多骗局。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T12:56:04.890

网站是否处理退款？将来会不会？

如果我们谈论的是恶意使用，那么如果进行了大量未经授权的购买，网站所有者可能会受到调查。如果对所有者进行调查，这对**您**有何影响？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T12:56:53.160

根据您的描述，该开发人员似乎可以访问客户卡的详细信息，在这种情况下，客户的隐私可能会受到损害。您可以考虑适当地措辞合同以确保涵盖该角度。

然而，主要的一点是，如果你正在处理一个敏感的项目/信息，你最好找到你可以信任的人。聘请一家软件公司来完成这项工作可能会在以后为您节省一些睡眠时间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-27T13:51:06.233

首先，最好不要以纯文本形式存储此类信息。通常人们将其视为信用卡号码的二手知识（遗憾的是，仅出于法律原因），但您不希望其他人查看数据库/源代码访问权限的任何类型的私人数据都应加密。您应该将帐户信息以加密良好的格式存储在某处，并且您应该为您的开发人员提供一个测试帐户，以便在他们的开发工作站上使用。这样，即使是加密信息，也只有拥有服务器访问权限的人才能看到。

这样，您可以在开发人员的工作站上拥有一个数据库，并将测试帐户的 API 信息存储（希望加密）在其本地数据库中，但是当代码镜像到生产服务器时，它仍将使用存储在其上的实时、真实网关信息生产服务器的数据库，无需额外的代码/配置。

话虽如此，我认为具有 API 身份验证细节的程序员不能做太多事情。无论哪种方式，都不值得冒险——在我看来。

希望这有帮助。

PS：如果确实发生了不好的事情，在您采取预防措施以确保它不会再次发生之后，您可以随时在 authorize.net 的 Web 界面中生成一个新密钥。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-12-28T20:56:37.650

在 Authorize.Net 的特定情况下，他们将无法对自己的信用卡进行信用，因为 Authorize.Net 仅允许对过去六个月内通过他们执行的交易进行此操作。如果您被授予未关联退款的例外情况，则允许的唯一例外情况。如果您为此签署了适当的文书，并且有人拥有您的 API 登录名和交易密钥，则可以处理他们自己信用卡的信用。你抓住这一点的唯一方法是仔细监控你的陈述。

为了帮助缓解这种情况，您应该在他们为您执行的工作完成后立即更改您的事务密钥。这将使他们拥有的密钥在 24 小时后失效。

# c++ - 对 for 构造中的第二个表达式使用 size() 总是不好的吗？

> ID：166641
> 
> 赞同：8
> 
> 时间：2008-10-03T12:47:23.303
> 
> 标签：c++

在下面的示例中，我是否应该期望`values.size()`每次循环都会调用它？`vectorSize`在这种情况下，引入一个临时变量可能是有意义的。或者现代编译器是否应该能够通过识别向量大小不能改变来优化调用。

```
double sumVector(const std::vector<double>& values) {
    double sum = 0.0;
    for (size_t ii = 0; ii < values.size(); ++ii) {
        sum += values.at(ii);
    }
} 
```

请注意，我不在乎是否有更有效的方法来对向量的内容求和，这个问题只是关于在 for 构造中使用 size() 。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-03T13:39:26.147

这是一种使其明确的方法 - size() 仅被调用一次。

```
for (size_t ii = 0, count = values.size();  ii < count;  ++ii) 
```

**编辑：**我被要求实际回答这个问题，所以这是我最好的选择。

编译器通常不会优化函数调用，因为它不知道从一次调用到下一次调用是否会获得不同的返回值。如果循环内有无法预测副作用的操作，它也不会优化。内联函数可能会有所作为，但没有任何保证。局部变量更容易让编译器优化。

有些人会称之为过早优化，我同意在少数情况下您会注意到速度差异。但是，如果它不会使代码更难理解，为什么不将其视为最佳实践并采用它呢？肯定伤不起。

PS我在仔细阅读[Benoit的](https://stackoverflow.com/questions/166641/is-using-size-for-the-2nd-expression-in-a-for-construct-always-bad#166654)答案之前写了这个，我相信我们完全同意。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-03T12:50:13.687

这完全取决于向量的大小实现是什么，编译器的积极程度以及它是否侦听/使用内联指令。

我会更具防御性并引入临时性，因为您无法保证编译器的效率。

当然，如果这个例程被调用一次或两次并且向量很小，那真的没关系。

如果它会被调用数千次，那么我会使用临时的。

有些人可能称之为过早的优化，但我倾向于不同意这种评估。
当您尝试优化代码时，您并没有投入时间或以性能的名义混淆代码。

我很难考虑什么是重构是优化。但最终，这就是“你说番茄，我说番茄”……

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-03T12:54:38.513

从“for”结构中的 size() 开始，直到您需要优化速度。

如果太慢，想办法让它更快，比如使用临时变量来保存大小的结果。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-03T16:47:38.043

无论优化设置如何，将 .size() 调用放在第二个表达式*中最多*与在 for 循环之前概述 .size() 调用一样高效。那是：

```
size_t size = values.size();
for (size_t ii = 0; ii < size; ++ii) {
    sum += values.at(ii)
} 
```

将始终表现至少与以下内容一样好，甚至更好：

```
for (size_t ii = 0; ii < values.size(); ++ii) {
    sum += values.at(ii);
} 
```

实际上，这可能无关紧要，因为概述 .size() 调用是一种常见的编译器优化。但是，我确实发现第二个版本更易于阅读。

不过，我发现这更容易：

```
double sum = std::accumulate(values.begin(), values.end(), 0); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-03T12:59:27.053

值得注意的是，即使您处理数百万个项目，开销也可以忽略不计。

在任何情况下，这都应该使用迭代器来编写——因为访问特定示例可能会有更多开销。

编译器真的没有办法假设 size() 不会改变 - 因为它可以做..

如果迭代的顺序不重要，那么您总是可以将其编写为更有效的方式。

```
for (int i=v.size()-1; i>=0 ;i--)
{
   ...
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-03T14:00:08.913

这不是问题的一部分，但您为什么`at`在代码中使用代替下标运算符`[]`？

意义在于`at`确保不会发生对无效索引的操作。但是，在您的循环中永远不会出现这种情况，因为您从代码中*知道*索引将是什么（总是假设单线程）。

即使*您*的代码包含逻辑错误，导致您访问无效元素，`at`在这个地方也是无用的，因为您不期望结果异常，因此您不处理它（或者您是否将*所有*循环都包含在`try`块？）。

这里的使用`at`具有误导性，因为它告诉读者您（作为程序员）不知道索引将具有什么值——这显然是错误的。

我同意 Curro 的观点，这是使用迭代器的典型案例。虽然这更冗长（至少如果你不使用像[Boost.Foreach](http://engineering.meta-comm.com/resources/cs-win32_metacomm/doc/html/foreach.html)这样的结构），它也更具表现力和安全性。

Boost.Foreach 将允许您编写如下代码：

```
double sum = 0.0;
foreach (double d, values)
    sum += d; 
```

该操作安全、高效、简短、易读。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-03T15:23:58.947

根本没关系。.at() 的性能开销非常大（它包含一个条件抛出语句），以至于非优化版本将大部分时间都花在那里。一个足够聪明以消除条件抛出的优化编译器必然会发现 size() 不会改变。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-03T12:53:53.930

我同意贝努瓦的观点。引入一个新变量，尤其是一个 int 甚至是一个 short 将比每次调用它都有更大的好处。

如果循环变得足够大以至于可能影响性能，那就少了一件值得担心的事情。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-03T12:53:57.517

来自 std::vector 的 size 方法应该由编译器内联，这意味着对 size() 的每次调用都被它的实际主体替换（有关内联的更多信息，请参阅[为什么我应该使用内联代码问题）。](https://stackoverflow.com/questions/132738/why-should-i-ever-use-inline-code)由于在大多数实现中 size() 基本上计算 end() 和 begin() 之间的差异（也应该内联），因此您不必太担心性能损失。

此外，如果我没记错的话，一些编译器足够“聪明”，可以在 for 构造的第二部分检测表达式的常量性，并生成只对表达式求值一次的代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-03T12:55:47.670

如果您将向量的大小保存在一个临时变量中，您将独立于编译器。

我的猜测是，大多数编译器都会以某种方式优化代码，size() 只会被调用一次。但是使用临时变量会给你一个保证， size() 只会被调用一次！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-03T13:14:21.033

编译器将不知道 .size() 的值是否在调用之间发生变化，因此它不会进行任何优化。我知道您刚刚询问了 .size() 的使用，但无论如何您都应该使用迭代器。

```
std::vector<double>::const_iterator iter = values.begin();
for(; iter != values.end(); ++iter)
{
    // use the iterator here to access the value.
} 
```

在这种情况下，对 .end() 的调用类似于您使用 .size() 公开的问题。如果您知道循环不会在向量中执行任何使迭代器无效的操作，则可以在进入循环之前将迭代器初始化为 .end() 位置并将其用作边界。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-03T13:36:13.733

在这种情况下，使用迭代器会更干净——在某些情况下甚至更快。对容器只有一次调用——如果有任何剩余，则让迭代器持有指向向量成员的指针，否则为 null。

然后当然`for`可以成为 a`while`并且根本不需要临时变量 - 您甚至可以将迭代器传递给 sumVector 函数而不是 const 引用/值。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-03T13:36:35.230

始终按照您的意思在第一次编写代码。如果您正在从零迭代向量到 size()，请这样写。不要将 size() 调用优化为临时变量，除非您已将调用分析为程序中需要优化的瓶颈。

一个好的编译器很可能能够优化对 size() 的调用，特别是考虑到向量被声明为 const。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-04T03:04:07.037

如果您使用的`size()`是 O(n)（如`std::list`）而不是 O(1)（如`std::vector`）的容器，则不会使用索引遍历该容器。您将改用迭代器。

无论如何，如果循环的主体是如此微不足道以至于重新计算`std::vector::size()`很重要，那么可能有一种更有效（但可能特定于平台）的方式来进行计算，不管它是什么。如果循环体很重要，那么`std::vector::size()`每次重新计算都不太重要。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-04T16:51:28.940

*   如果您在 for 循环中修改向量（添加或删除元素），则不应使用临时变量，因为这可能会导致错误。
*   如果您没有在 for 循环中修改向量大小，那么我会一直使用临时变量来存储大小（这将使您的代码独立于 vector::size 的实现细节。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-03T13:51:38.087

大多数，甚至可能是所有的 size() 标准实现都将由编译器内联到相当于临时或最多指针解引用的内容。

但是，您永远无法确定。内联与这些东西一样隐藏，并且第 3 方容器可能具有虚拟函数表 - 这意味着您可能不会内联。

然而，严重的是，使用临时变量会略微降低可读性，几乎可以肯定没有任何好处。如果分析表明它是富有成效的，那么只优化到一个临时的。如果您在各处进行这些微优化，您的代码可能会变得不可读，甚至对您自己来说也是如此。

顺便说一句，没有编译器会将 size() 优化为分配给临时的调用之一。C++ 中几乎没有 const 的保证。编译器不能冒险假设 size() 将为整个循环返回相同的值。例如。另一个线程可以在循环迭代之间更改向量。

# nant - 如何让一些 NAnt 任务安静下来？

> ID：166658
> 
> 赞同：2
> 
> 时间：2008-10-03T12:50:52.517
> 
> 标签：nant

我正在使用[MailLogger](http://nant.sourceforge.net/release/0.85-rc2/help/fundamentals/listeners.html#MailLogger)发送有关发布失败/成功的消息。我想让邮件正文简单易读。如何抑制某些特定任务的输出？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T13:00:28.237

如果您使用 -quiet 开关调用 nant 会不会太简单？

编辑：对于您感兴趣的输出任务，您可以将详细属性设置为 true。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T13:31:25.973

另一种选择是使用 xmllogger 而不是 maillogger，以输出一个 xml 文件，然后可以使用 xslt 样式表对其进行处理。使用样式表过滤掉不需要的信息。如果您希望将其邮寄到您的收件箱，您可以使用 nant 的邮件任务并将转换后的文件作为附件包含在内，或者如果您将其转换为 txt/html，您也可以使用它来填充正文。

# modeling - 基于代理的建模资源

> ID：166661
> 
> 赞同：10
> 
> 时间：2008-10-03T12:51:18.317
> 
> 标签：modeling, toolkit, agent-based-modeling, multi-agent

我想知道基于代理的建模存在哪些类型的工具包、语言、库，它们的优缺点是什么？

我想到的一些例子是 [Swarm](http://www.swarm.org)、[Repast](http://repast.sourceforge.net/)和[MASS](http://www.aitia.hu/services_and_products/simulation_systems/mass)。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-08-27T02:54:53.103

我发现 2009 年 6 月的一项调查回答了您的问题：

基于代理的建模和仿真工具的调查

金。RJ艾伦

> **抽象的**
> 基于代理的建模和仿真是一种基于离散事件仿真的计算要求高的技术，起源于遗传算法。它是模拟动态复杂系统和观察“紧急”行为的强大技术。ABMS 最常见的用途是社会模拟和优化问题，例如交通流和供应链。我们将研究计算科学和工程中的其他用途。ABMS 已经适应在新的架构上运行，例如 GPGPU（例如使用 CUDA 的 nVidia）。阿贡国家实验室在 Exascale ABMS 上有一个网站，并在 SciDAC 计划的资助下在 IBM BlueGene 上运行模型。我们计划在 2009 年夏天组织一次关于 ABMS 方法和应用的研讨会。关键词基于代理的建模，考古学

[http://epubs.cclrc.ac.uk/bitstream/3637/ABMS.pdf](http://epubs.cclrc.ac.uk/bitstream/3637/ABMS.pdf)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T22:18:28.050

我也推荐[NetLogo](http://ccl.northwestern.edu/netlogo/)。它是一种基于 logo（基于 Lisp）的 IDE+环境+编程语言，可让您非常快速地构建多智能体模型。我发现我可以在几个小时内从研究文章中重现（模拟）算法，而其他库需要数周才能实现的算法。

您可以在[此页面上查看我的一些模型。](http://jmvidal.cse.sc.edu/netlogomas/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T13:23:28.237

我在 OSCON 2008 上被介绍给了[Dramatis](http://dramatis.mischance.net/)，它是一个基于代理的 Ruby 和 Python 框架。作者 (Steven Parkes) 在他的博客中有一些参考资料，并且正在运行一个与语言无关的[Actors 讨论列表](http://groups.google.com/group/dramatis)。

[erights.org 上的这个页面](http://www.erights.org/history/actors.html)有很多参考资料，我认为是介绍和探索 Actors 消息传递模型的核心论文。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-18T16:29:50.167

你还应该看看[Madkit 和 Turtlekit](http://www.madkit.org)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-16T12:06:25.017

维基百科中也有一个很好的链接：

[http://en.wikipedia.org/wiki/Comparison_of_agent-based_modeling_software](http://en.wikipedia.org/wiki/Comparison_of_agent-based_modeling_software)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-17T22:26:21.110

在建模方面，看看 FAML，一种面向代理的建模语言。这是一篇非常学术的论文，但根据您的兴趣，它可能会有所帮助：http: //ieeexplore.ieee.org/xpl/freepre_abs_all.jsp?isnumber=4359463&arnumber= [4967615](http://ieeexplore.ieee.org/xpl/freepre_abs_all.jsp?isnumber=4359463&arnumber=4967615)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-03-27T09:06:57.520

我知道这是一个旧线程，但我认为添加一些额外的信息不会有什么坏处。有一个很棒的[新网站，专门用于基于代理的建模](http://www.agent-based-models.com/blog/)。该站点包含论文、教程、工具、资源和研究人员在多个领域从事基于代理的建模的链接。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-05-24T12:13:47.517

旧线程，但为了完整起见，还有可用于 ABM的[Anylogic](http://www.anylogic.com/)和[pyabm 。](https://pypi.python.org/pypi/pyabm/0.3.1)

我有在多种环境/语言中编写基于代理的模型的经验。我的看法是，如果你想实现一个相对简单的模型，使用 Netlogo。也可以将 Netlogo 用于重型模型（我已经成功地做到了），但在某些时候，像 java/python/c++ 这样的编程语言的灵活性超过了 Netlogo 中可用的本机方法的便利性，尤其是当性能成为主要问题时。

就餐变得有点臃肿。如果您是一位经验丰富的程序员，那么开始构建 ABM 真正需要的是安排事件和绘制随机数的能力。其余的（定义代理/环境及其行为）您可以自己制作。在管理模型中的对象时，请使用您习惯的常规数据结构（数组/哈希/树等）。为此，我正在开发一个非常轻量级的 Java 库，称为“ABMUtils”（在 github 上），它实现了一个调度程序并包装了一个随机数生成器。这处于早期开发阶段，但我希望在未来几个月内充实（保持简单）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-12-03T22:48:16.800

如果您是进化经济学家，您还可以查看[模拟开发实验室 (LSD)](http://www.labsimdev.org/)。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-11-04T23:08:29.547

PHP 和 Java 开发人员应该看看[KATO](http://kato.sourceforge.net/kato.html)。

# delphi - 从 Delphi 2009 图像列表中提取 PNG 图像

> ID：166676
> 
> 赞同：3
> 
> 时间：2008-10-03T12:54:16.457
> 
> 标签：delphi, png, delphi-2009, imagelist

Delphi 2009 的 TImageList 通过在 imagelist 编辑器中添加 PNG 图像来支持它们。有没有办法从 TImagelist 中提取 TPngImage 并保留 alpha 通道？

我想要做的实际上是从一个 TImageList 中提取图像，制作它们的禁用版本，然后将它们添加到另一个 TImageList。在此操作期间，我当然想保留 PNG 图像的 alpha 通道。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T14:42:57.060

我用 Delphi 2006 做了类似的事情。

TImageList 包含一个受保护的方法 GetImages。可以使用“受保护的错误”访问它

```
type
  TGetImageImageList = class (TImageList) // Please use a better name!
  end; 
```

您可以将图像列表投射到 TGetImageImageList 以获取 GetImages。

```
begin
  TGetImageList(ImageList).GetImages(index, bitmap, mask);
end; 
```

位图包含位图，而掩码是确定透明部分的黑白位图。

您现在可以更改位图并将其存储使用：

```
function Add(Image, Mask: TBitmap): Integer; 
```

我希望这能给你足够的指导来进一步探索。

# xml - 用于业务文档交换（发票、采购订单等）的最佳标准是什么？

> ID：166692
> 
> 赞同：4
> 
> 时间：2008-10-03T12:56:29.883
> 
> 标签：xml, interop, x12, invoice, purchase-order

如果我需要在系统之间实现业务文档的发送和接收（发票、采购订单、汇款通知等），您会推荐什么标准来实现最佳互操作，为什么？它可以是 XML 或其他。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-04T21:18:25.283

[UBL](http://docs.oasis-open.org/ubl/os-UBL-2.0/UBL-2.0.html)（通用商务语言）是这方面的最新尝试，由 OASIS 管理。问题是商业文档互操作的圣杯确实还有很长的路要走，如果有的话。这就是存在像 Biztalk 这样的产品的原因。Biztalk 的主要目的是将文档采用一个合作伙伴的格式并将其转换为您的格式，反之亦然。

即使像 ANSI X12 和 Edifact 这样的巨大标准也存在问题，因为即使两个合作伙伴使用商定的标准交换文档，通常在文档的使用方式上也存在足够的差异，因此需要自定义编码来处理它们。

我的建议是公开一种简洁且易于理解的 XML 格式，该格式非常符合您的业务需求，并让您的合作伙伴使用他们目前与其他合作伙伴一起使用的任何方法来处理您的文档。尝试遵循行业标准将需要更多的工作，并且可能带来的好处很少。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-09T19:22:13.960

我会看（按此顺序）：

*   行业特定格式。如果您有一个同质的交易群体，永远是您的最佳选择。
*   如果您想要具有既定标准的 XML 解决方案，请使用 cXML 或 XCBL。
*   X12 如果您有无限的时间、金钱和愿意合作的伙伴。
*   仅当您有标准之外的要求或要传输的数据量如此之少以至于该标准会使您的文档过于膨胀时，才可以自定义 XML。

当然，这一切都取决于问题域。我会思考这些问题：

1.  您所在的行业有特定格式或法规要求吗？例如，是否有您订购的气体的化学成分等详细信息？是否有需要特殊订单或处理的危险材料？
2.  您的行业是否已经有特定格式或者您需要通用格式？化学/天然气、零售、大型石油、航空公司、金融服务和许多其他公司已经建立了格式，有时还建立了网络。
3.  您是否与有采购申请的企业采购员合作？如果是这样，我会看一下处理 PunchOut 标准的 cXML 或 XCBL，它使采购系统能够从在线目录中订购。
4.  您的合作伙伴的成熟度如何？EDI 古老而强大，但真的很难理解。刚接触这个过程的人更喜欢基于 XML 的格式。
5.  你在市场上的位置是什么？你能为你的合作伙伴制定一个标准，还是他们会为你规定一个格式？在这种情况下，您是否需要采用多个标准？他们之间谁来翻译？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T13:04:29.697

标准为 X12。差不多就是这样。请参阅 Wikipedia 上的[EDI](http://en.wikipedia.org/wiki/Electronic_Data_Interchange)页面。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-03T18:39:17.943

[ebXML](http://www.ebxml.org/)标准不仅涵盖文档格式，还涵盖业务实体之间的流程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T13:02:46.500

有各种标准可以做到这一点，比如 SWIFT - TSU Bolereo Twist

然而，没有一个标准被业界完全采用/接受，因此它们不会是互操作的。另一种方法是使用文档流管理系统，您可以在其中扫描所有文档并将其存储为图像，并围绕发送和接收这些文档构建工作流程。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-03T13:03:04.970

PDF - 每个人都有它，它的跨平台，它可以处理任何文档类型。但是，如果您想对其进行编辑，那就不好了。

# macos - 是否可以使用键盘快捷键在 OSX Terminal.app 中选择特定选项卡？

> ID：166695
> 
> 赞同：19
> 
> 时间：2008-10-03T12:56:57.433
> 
> 标签：macos, keyboard-shortcuts, terminal, osx-leopard

我知道我可以使用 cmd+{ 或 cmd+} 循环浏览我的选项卡，但是否可以在 Leopards 的 Terminal.app 中选择特定选项卡（即 iTerm 中的第三个选项卡的 cmd+3）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T18:51:34.840

这是一个选项。[终端中的选项卡切换](http://ciaranwal.sh/2007/12/10/tab-switching-in-terminal "终端中的选项卡切换")

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-05T02:15:36.447

*是的，您使用 Command-1、Command-2 等。在“**窗口**”菜单下查看，您会看到列出的窗口及其对应的快捷方式。（“三叶草”是 Command 键的符号 - 也称为 Apple 键。）*

我很抱歉 - 错过了你第一次提到 Tabs 的事实。我认为除了 Cmd-{ 和 } 之外，没有任何其他键盘快捷键可以在选项卡之间切换。也许如果这很重要，首先不要将它们分组？将它们作为单独的窗口？

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-06-04T21:07:43.687

如果您真的需要那么多标签，我强烈建议您使用[GNU Screen 。](http://www.gnu.org/software/screen/)我有一个特殊的 .screenrc 文件，可以让生活更轻松，只需将以下内容放在您的主目录中的一个名为的文件中`.screenrc`：

```
defscrollback 1024
hardstatus on
hardstatus alwayslastline
hardstatus string "%{.bW}%-w%{.rW}%n %t%{-}%+w %=%{..G} %H %{..Y} %m/%d %C%a " 
```

此外，在启动屏幕时，我运行`screen -c ~/.screenrc.programming`如下所示：

```
source $HOME/.screenrc

screen -t World
screen -t Server
screen -t Console
screen -t Command
screen -t Editor
screen -t MySQL 
```

这将打开一堆“标签”，您可以使用`Ctrl-A,n`和`Ctrl-A,p`或`Ctrl-A`后跟数字直接切换到一个。

# sql-server - 如何在 SQL Server 和 NHibernate 之间组合级联更新/删除？

> ID：166708
> 
> 赞同：1
> 
> 时间：2008-10-03T12:59:52.810
> 
> 标签：sql-server, nhibernate, entity-relationship, database-relations

我正在编写一个带有手工制作的域模型（类）和手工制作的数据模型（表/关系）的应用程序，并让 NHibernate 负责映射。

最好是告诉数据库执行级联更新或删除还是告诉 NHibernate 这样做（cascade="all-delete-orphan"）？可以同时设置它们吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T13:40:26.470

我更愿意让 NHibernate 为我做这件事。它更容易设置并且运行良好。

cascade: all-delete-orphan 是在没有触发器的情况下无法在 SQL 中执行的操作，所以还有另一个原因

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-18T01:00:30.230

> 可以同时设置它们吗？

我想如果你尝试，你可能会得到 NHibernate 的抱怨，因为它的大部分操作都会检查行数以确保插入/更新/删除预期的行数。

正如 Ben 所说，让 NHibernate 来做这件事。

最终，NHibernate（以及一般的 ORM）让您将数据库视为一种存储和检索机制。您仍然想创建约束、主键、外键和索引，但 ORM 无论如何都应该遵守这些规则。与任何数据访问场景一样，如果您发现自己在数据库中创建了复杂的约束，请记住这些规则必须在您的应用程序中重复。

# ios - 如何在顶部状态栏中显示加载指示器

> ID：166712
> 
> 赞同：121
> 
> 时间：2008-10-03T13:00:50.343
> 
> 标签：ios, cocoa-touch

我注意到一些应用程序，如 Safari 和 Mail，在访问网络时会在状态栏（手机最顶部的栏）中显示加载指示器。有没有办法在 SDK 应用程序中做同样的事情，或者这是 Apple 唯一的事情？

* * *

## 回答 #1

> 赞同：214
> 
> 时间：2008-10-03T13:06:14.293

它在 UIApplication 中：

**对于目标 C：**

开始：

```
[UIApplication sharedApplication].networkActivityIndicatorVisible = YES; 
```

结尾：

```
[UIApplication sharedApplication].networkActivityIndicatorVisible = NO; 
```

**对于迅速：**

开始

```
UIApplication.shared.isNetworkActivityIndicatorVisible = true 
```

结尾

```
UIApplication.shared.isNetworkActivityIndicatorVisible = false 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-11-17T18:51:08.110

我发现以下宏非常有用！

```
#define ShowNetworkActivityIndicator() [UIApplication sharedApplication].networkActivityIndicatorVisible = YES
#define HideNetworkActivityIndicator() [UIApplication sharedApplication].networkActivityIndicatorVisible = NO 
```

所以你可以在你的应用程序中调用`ShowNetworkActivityIndicator();`或调用`HideNetworkActivityIndicator();`（当然，只要包含标题！）。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2012-11-16T08:18:36.703

我写了一个单例，它通过记录正在发生的事情来解决多个连接的问题（以避免在连接返回但另一个连接仍然处于活动状态时删除状态）：

头文件：

```
#import <Foundation/Foundation.h>

@interface RMActivityIndicator : NSObject

-(void)increaseActivity;
-(void)decreaseActivity;
-(void)noActivity;

+(RMActivityIndicator *)sharedManager;

@end 
```

和实施：

```
#import "RMActivityIndicator.h"

@interface RMActivityIndicator ()

@property(nonatomic,assign) unsigned int activityCounter;

@end

@implementation RMActivityIndicator

- (id)init
{
    self = [super init];
    if (self) {
        self.activityCounter = 0;
    }
    return self;
}

    -(void)increaseActivity{
        @synchronized(self) {
             self.activityCounter++;
        }
        [self updateActivity];
    }
-(void)decreaseActivity{
    @synchronized(self) {
           if (self.activityCounter>0) self.activityCounter--;
    }
    [self updateActivity];
}
-(void)noActivity{
    self.activityCounter = 0;
    [self updateActivity];
}

-(void)updateActivity{
    UIApplication* app = [UIApplication sharedApplication];
    app.networkActivityIndicatorVisible = (self.activityCounter>0);
}

#pragma mark -
#pragma mark Singleton instance

+(RMActivityIndicator *)sharedManager {
    static dispatch_once_t pred;
    static RMActivityIndicator *shared = nil;

    dispatch_once(&pred, ^{
        shared = [[RMActivityIndicator alloc] init];
    });
    return shared;
}

@end 
```

例子：

```
 [[RMActivityIndicator sharedManager]increaseActivity];
    [NSURLConnection sendAsynchronousRequest:urlRequest queue:self.networkReceiveProcessQueue completionHandler:^(NSURLResponse *response, NSData *data, NSError *error)
    {
        [[RMActivityIndicator sharedManager]decreaseActivity];
    } 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2012-11-29T10:33:09.343

执行此操作的单行代码：

```
[UIApplication sharedApplication].networkActivityIndicatorVisible = YES; 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2019-06-21T04:55:43.340

状态栏网络活动指示器在**iOS 13**中已弃用。

使用`UIApplication.shared.isNetworkActivityIndicatorVisible = true`将不再起作用。

弃用消息说：

> 如果需要，请在您的应用中提供自定义网络活动 UI。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-02-17T05:59:48.493

完成网络呼叫后，您还需要注意隐藏活动指示器。

如果你使用`AFNetworking`，那么你不需要做太多事情。

在类中进行以下更改`AppDelegate`：

1.  进口`AFNetworking/AFNetworkActivityIndicatorManager.h`

2.  把这个放进去`didFinishLaunchingWithOptions:`

`[[AFNetworkActivityIndicatorManager sharedManager] setEnabled:YES]`

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-03-13T19:49:42.730

确保您在主线程上运行它也可能会有所帮助，因为它与 UI 相关。

```
dispatch_async(dispatch_get_main_queue(), ^{
    [[UIApplication sharedApplication] setNetworkActivityIndicatorVisible:YES];
}); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-11-08T02:45:33.523

正如许多人所说，iPhone X 没有网络活动指示器，可能还有其他带有缺口的新 iPhone。

我遇到了这个由 Ortwin Gentz，FutureTap 编写的令人难以置信的库： [https ://github.com/futuretap/FTLinearActivityIndi​​cator](https://github.com/futuretap/FTLinearActivityIndicator)

它将指示器放回 iPhone X 最初发布时的位置，许多人会记得 Knight Rider 类型的指示器。

该库可用于 Swift 4.2，因此您需要更改 Swift 语言设置，如下所述： [Type 'NSAttributedStringKey' (aka 'NSString') has no member 'font'](https://stackoverflow.com/questions/46520306/type-nsattributedstringkey-aka-nsstring-has-no-member-font)

# .net - 无法序列化控件上的属性

> ID：166718
> 
> 赞同：2
> 
> 时间：2008-10-03T13:02:17.827
> 
> 标签：.net, vb.net, serialization

**背景**

我正在尝试创建我在 VB.NET 中创建的业务对象的副本。我已经实现了 ICloneable 接口，并且在 Clone 函数中，我通过使用 BinaryFormatter 对其进行序列化来创建对象的副本，然后直接反序列化回从函数返回的另一个对象。

我尝试序列化的类与该类中包含的子对象一起标记为“可序列化”。

我已经通过编写类似于以下的代码测试了克隆方法的工作原理：

```
Dim obj as New Sheep()
Dim dolly as Sheep = obj.Clone() 
```

此时一切正常。

**问题**

我有一个继承自第 3 方控件的自定义 Windows 窗体控件。这个自定义控件基本上包含我想要克隆的对象（因为这个对象最终提供给第 3 方控件）。

我想在 windows 窗体控件中创建对象的克隆，以便我可以允许用户操作属性，同时可以选择取消更改并将对象恢复到更改之前的状态。我想在用户开始进行更改之前获取对象的副本并保留它，以便在他们按取消时准备好它。

我的想法是按照以下内容编写代码：

```
Dim copy as Sheep = MyControl.Sheep.Clone() 
```

然后允许用户操作`MyControl.Sheep`. 但是，当我尝试这样做时，克隆方法会引发异常，说明：

*程序集“My_Assembly_Info_Here”中的类型“MyControl”未标记为可序列化*

在我调用`BinaryFormatter.Serialize(stream,Me)`.

我尝试创建一个`MyControl`返回对象副本的方法，并首先分配`MyControl.Sheep`给另一个变量，然后克隆该变量，但似乎没有任何效果。但是，直接创建对象的新实例并克隆它可以正常工作！

知道我哪里出错了吗？

**解决方案**

马克的回答帮助我指出了正确的方向。 [Rocky Lhotka 的这篇](http://www.lhotka.net/WeBlog/CommentView.aspx?guid=776f44e8-aaec-4845-b649-e0d840e6de2c)博客文章解释了这个问题以及如何解决它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T13:35:08.400

你有 UI 订阅的事件吗？一个 {Foo}Changed 事件，如果是数据绑定，或者可能是 INotifyPropertyChanged？您可能必须将事件支持字段标记为 [NonSerialized] （或者属性在 VB 中看起来 - 我是 C# 人......）。如果您正在使用类似字段的事件（即没有添加/删除的缩写语法），那么用 [field: NonSerialized] 标记整个事件（同样，转换为 VB）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T13:14:18.473

一个明显的问题，但你确定你的 Sheep 对象没有对 MyControl 的引用吗？它是一个对象还是一个列表或任何东西？如果是这种情况，这就是阻止您克隆业务对象的原因。

更有可能的候选者是**.Parent**或**.Tag**属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T13:35:46.887

在第三方库中，如果某些内容未标记为可序列化，则出于充分的理由*不应*对其进行序列化，但通常它不可序列化，因为开发人员只是没有包含它。您可以使用反射来复制控件的公共属性，并在取消时将其状态返回到您的反射版本。这种方法对性能有影响，但因为您在 UI 层工作，我想这不会太担心。此方法不保证无错误；公共属性不一定代表一个类的整个状态，设置一些属性可能会产生副作用（它们不应该，但你没有编写代码，所以要么 ILDasm 看看，要么希望最好）。

此外，并非所有类型的属性都是可序列化的，在这种情况下，您需要通过手动为这些类型（可能还有这些类型的属性）编写序列化例程来更进一步。

```
using System;
using System.Collections.Generic;
using System.Linq;

namespace ConsoleApplication1
{
    public class NonSerializableSheep
    {
        public NonSerializableSheep() { }

        public string Name { get; set; }
        public int Id { get; set; }
        // public read only properties can create a problem
        // with this approach if another property or (worse)
        // a group of properties sets it
        public int Legs { get; private set; }

        public override string ToString()
        {
            return String.Format("{0} ({1})", Name, Id);
        }
    }

    public static class GhettoSerializer
    {
        // you could make this a factory method if your type
        // has a constructor that appeals to you (i.e. default 
        // parameterless constructor)
        public static void Initialize<T>(T instance, IDictionary<string, object> values)
        {
            var props = typeof(T).GetProperties();

            // my approach does nothing to handle rare properties with array indexers
            var matches = props.Join(
                values,
                pi => pi.Name,
                kvp => kvp.Key,
                (property, kvp) =>
                    new {
                        Set = new Action<object,object,object[]>(property.SetValue), 
                        kvp.Value
                    }
            );

            foreach (var match in matches)
                match.Set(instance, match.Value, null);
        }
        public static IDictionary<string, object> Serialize<T>(T instance)
        {
            var props = typeof(T).GetProperties();

            var ret = new Dictionary<string, object>();

            foreach (var property in props)
            {
                if (!property.CanWrite || !property.CanRead)
                    continue;
                ret.Add(property.Name, property.GetValue(instance, null));
            }

            return ret;
        }
    }

    public class Program
    {
        public static void Main()
        {
            var nss = new NonSerializableSheep
            {
                Name = "Dolly",
                Id = 12
            };

            Console.WriteLine(nss);

            var bag = GhettoSerializer.Serialize(nss);

            // a factory deserializer eliminates the additional
            // declarative step
            var nssCopy = new NonSerializableSheep();
            GhettoSerializer.Initialize(nssCopy, bag);

            Console.WriteLine(nssCopy);

            Console.ReadLine();

        }
    }
} 
```

# sql-server - 在 Microsoft SQL Server Management Studio 2005 中，您如何找到一个表位于哪个数据库中，您知道哪个数据库的名称（例如 dbo.mytable1）？

> ID：166722
> 
> 赞同：1
> 
> 时间：2008-10-03T13:03:00.993
> 
> 标签：sql-server, database, sql-server-2005

我知道我要查找的表的名称。我正在使用 Microsoft SQL Server Management Studio 2005，我想搜索我在工作室中连接的数据库服务器中的所有数据库。这可能吗？我需要查询系统表吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T13:24:38.017

您可以使用 sp_MSforeacheachdb。

sp_MSforeachdb 'IF EXISTS(SELECT * FROM sys.tables WHERE [Name] = ''TableName'') PRINT ''?''';

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T18:51:25.623

如上所述，但使用系统功能而不是系统表

```
EXEC sp_MSForEachDB 'USE [?] IF OBJECT_ID(''dbo.mytable'') IS NOT NULL PRINT ''?''' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T13:32:22.400

使用大师

DECLARE @db_name varchar(128) DECLARE @DbID int DECLARE @sql_string nvarchar(4000) DECLARE @TableName varchar(30)

选择@TableName = ''

设置不计数

创建表 [#tblDatabaseName] ( [DbName] [varchar] (128) NOT NULL , [TableName] [varchar] (128) NOT NULL )

声明 db_cursor 游标 forward_only 为

```
SELECT  name, DbID 
FROM    master..sysdatabases
WHERE   name NOT IN ('northwind', 'pubs')
AND     (status & 32) <> 32        --loading.
AND (status & 64) <> 64        --pre recovery.
AND (status & 128) <> 128      --recovering.
AND (status & 256) <> 256      --not recovered.
AND (status & 512) <> 512      --Offline
AND (status & 32768) <> 32768  --emergency mode.
AND     DbID > 4 
```

打开 db_cursor

从 db_cursor 获取 next 到 @db_name, @DbID

而@@FETCH_STATUS = 0 开始

```
set @sql_string = ''
+'  Insert into #tblDatabaseName '
+'  select  ''' + @db_name + ''' as ''DbName'',  '
+'          o.name as ''TableName''  '
+'  from               [' + @db_name + ']..sysobjects   o with(nolock)  '
+'  where   o.name like ''' + @TableName + '''  ' 

execute sp_executesql @sql_string

fetch next from db_cursor into @db_name, @DbID 
```

结尾

解除分配 db_cursor

从 #tblDatabaseName 中选择 *

删除表 #tblDatabaseName

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T13:43:02.583

sp_MSForEachDB 是一个未记录的过程，可以为您执行此操作。输出输出有点困难，所以我把它留给你。

```
EXEC sp_MSForEachDB 'USE [?] IF EXISTS(SELECT * FROM Sys.Objects WHERE Type = ''U'' AND Name = ''Product'') PRINT ''?''' 
```

# multithreading - 您使用哪些并行编程 API？

> ID：166729
> 
> 赞同：16
> 
> 时间：2008-10-03T13:04:47.667
> 
> 标签：multithreading, pthreads, parallel-processing, openmp

考虑到当今多核和多处理硬件的巨大重要性，试图了解人们目前实际上是如何编写并行代码的。对我来说，主要的范式似乎是 pthreads（POSIX 线程），它在 Linux 上是原生的，在 Windows 上可用。HPC 人倾向于使用 OpenMP 或 MPI，但在 StackOverflow 上似乎没有很多。还是您依赖 Java 线程、Windows 线程 API 等而不是可移植标准？在您看来，进行并行编程的推荐方法是什么？

或者您是否在使用更奇特的东西，例如 Erlang、CUDA、RapidMind、CodePlay、Oz，甚至亲爱的老 Occam？

澄清：我正在寻找非常便携且适用于各种主机架构上的平台（例如 Linux、各种 unix）的解决方案。Windows 是一种极少的支持很好的案例。所以 C# 和 .net 在这里真的太狭窄了，CLR 是一项很酷的技术，但他们能否为 Linux 主机发布它，以便它像 JVM、Python、Erlang 或任何其他可移植语言一样普遍。

C++ 或基于 JVM：可能是 C++，因为 JVM 倾向于隐藏性能。

MPI：我同意即使是 HPC 人员也认为它是一个难以使用的工具——但对于在 128000 个处理器上运行，它是解决 map/reduce 不适用的问题的唯一可扩展解决方案。不过，消息传递非常优雅，因为它是唯一一种似乎可以很好地扩展到本地内存/AMP、共享内存/SMP、分布式运行时环境的编程风格。

一个有趣的新竞争者是[MCAPI](http://www.multicore-association.org/workgroup/comapi.php)。但我认为还没有人有时间对此进行任何实践经验。

所以总的来说，情况似乎是有很多我不知道的有趣的微软项目，而 Windows API 或 pthreads 是实践中最常见的实现。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-21T14:42:36.310

MPI 并不像大多数人想象的那么难。如今，我认为多范式方法最适合并行和分布式应用程序。使用 MPI 进行节点间通信和同步，使用 OpenMP 或 PThreads 进行更精细的并行化。想想每台机器的 MPI，以及每个内核的 OpenMP 或 PThreads。这似乎比在不久的将来为每个内核生成一个新的 MPI Proc 更好一些。

也许对于现在的双核或四核来说，为机器上的每个内核生成一个 proc 不会有那么多开销，但是随着我们接近每台机器越来越多的内核，而缓存和芯片内存没有那么多扩展，使用共享内存模型会更合适。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-03T13:42:03.973

我会推荐[OpenMP](http://www.cilk.com/multicore-blog/?Tag=OpenMP)。Microsoft 已将其放入 Visual C++ 2005 编译器中，因此它得到了很好的支持，除了使用 /omp 指令进行编译外，您无需执行任何操作。

它使用简单，但显然它并不能为您做所有事情，但什么也做不了。我使用它来运行并行循环，通常没有任何麻烦，对于更复杂的事情我倾向于自己滚动（例如，我有很多年前的代码，我剪切、粘贴和修改）。

你可以试试[Cilk++](http://www.cilk.com/multicore-blog/bid/6630/Threads-Ace-Meets-Cilk)，它看起来不错，并且有一本电子书[“如何在多核软件革命中生存”](http://www.cilk.com/multicore-e-book/)。

这两种系统都试图并行化串行代码 - 即采用 for 循环以尽可能简单的方式同时在所有内核上运行它。它们往往不是通用线程库。（例如，一篇[研究论文](http://iwomp.univ-reims.fr/cd/papers/WSL06.pdf)(pdf) 描述了在 openMP 中实现的不同类型线程池的性能，并建议应该向其中添加 2 个新操作——yield 和 sleep。我认为他们在那里有点遗漏了 OpenMP 的意义）

正如您提到的 OpenMP，我假设您在谈论本机 C++，而不是 C# 或 .NET。

此外，如果 HPC 人员（我认为他们是这类领域的专家）似乎正在使用 OpenMP 或 MPI，那么这就是您应该使用的，而不是 SO 的读者群！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T13:08:18.673

我们已经开始研究 Microsoft 的[并行扩展](http://msdn.microsoft.com/en-us/concurrency/default.aspx)- 它尚未发布，但肯定显示出潜力。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-03T13:10:39.650

我使用[ACE](http://www.dre.vanderbilt.edu/Doxygen/Stable/ace/index.html)允许开发人员在任何平台上使用 POSIX（或 windows）风格的线程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-03T13:16:10.607

[Parallel FX Library (PFX)](http://en.wikipedia.org/wiki/Parallel_FX_Library) - 由 Microsoft Research 和 Microsoft CLR 团队合作开发的托管并发库，用于包含在 .NET Framework 的未来版本中。它由两部分组成：并行 LINQ (PLINQ) 和任务并行库 (TPL)。它还包含一组协调数据结构 (CDS) - 一组用于同步和协调并发任务执行的数据结构。该库于 2007 年 11 月 29 日作为 CTP 发布，并于 2007 年 12 月和 2008 年 6 月再次更新。

虽然没有太多经验...

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-05T01:37:52.840

更多[数据并行 Haskell](http://www.haskell.org/haskellwiki/GHC/Data_Parallel_Haskell)会很好，但即使没有它，GHC>6.6 也有一些令人印象深刻的能力，可以通过[Control.Parallel](http://www.haskell.org/ghc/docs/latest/html/libraries/parallel/Control-Parallel.html) [.Strategies](http://www.haskell.org/ghc/docs/latest/html/libraries/parallel/Control-Parallel-Strategies.html)轻松并行化算法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-03T14:45:02.440

请注意，这里的答案不会是“实际使用”的统计代表性答案。我已经看到许多“X 很好”的答案。

我个人在许多项目中都使用过 Windows 线程。我见过的另一个广泛使用的 API 是 pthreads。在 HPC 方面，MPI 仍然受到使用它的人的重视，但`<subjective>`我没有——它结合了 C++ 的所有优雅和 Javascript 的性能。它之所以存在，是因为没有像样的选择。一方面它会输给紧密耦合的 NUMA 机器，另一方面会输给 Google 风格的 map-reduce。`</subjective>`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-19T09:15:22.203

[开放 CL](http://www.khronos.org/opencl/)怎么样？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-19T09:27:39.010

很大程度上取决于您的环境。

对于佩林老 C，没有什么比 POSIX 更好的了。

对于 C++，有一个来自 BOOST.ORG 的免费的非常好的线程库。

Java 只使用本机 Java 线程。

除了线程之外，您还可以查看其他实现并行性的方法，例如将应用程序划分为客户端和服务器进程以及使用异步消息传递进行通信。如果做得好，这可以扩展到数十台服务器上的数千名用户。

还值得提醒的是，如果您使用的是 Windows MFC、Gnome 或 Qt 窗口环境，那么您将自动处于多线程环境中。如果您使用的是 Apache ISS 或 J2EE，那么您的应用程序已经在多线程多进程环境中运行。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-03T13:31:00.297

对于 .Net，我使用[RetLang](http://code.google.com/p/retlang/)取得了巨大成功。对于 JVM，[Scale](http://www.scala-lang.org/)很棒。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-18T15:06:51.977

我编写的大多数并发程序都是在[Ada](http://en.wikibooks.org/wiki/Ada_Programming)中编写的，它完全支持该语言的原生并行性。这样做的好处之一是您的并行代码可以移植到任何带有 Ada 编译器的系统。不需要特殊的库。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-05T02:19:10.870

我维护了一个并发链接博客，随着时间的推移已经涵盖了其中的一些内容（并将继续这样做）：

[http://concurrency.tumblr.com](http://concurrency.tumblr.com)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-09T07:31:32.140

pycuda ......没有什么比 25000 个活动线程 :) [warp 计划与记分板]。cuda 2 支持流，所以我不确定 streamit 会带来什么。CUDA Matlab 扩展看起来很整洁，[PLUTO](http://www.cse.ohio-state.edu/~bondhugu/pluto/)和来自 MIT 的即将到来的 PetaBricks 也是如此。

至于其他人，python的线程是缺乏的；MPI 等很复杂，我没有集群，但我想它们实现了它们的目的；在进入线程公寓之前，我停止了 c# 编程（可能是件好事）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-09T07:37:39.130

它本身不是*并行的，也没有分布式模型，但是您可以使用 Clojure 在 JVM 上编写高度并发的代码。*随后，您将获得大量可用的 Java 库。您必须在 clojure 之上实现自己的并行算法，但这应该相对容易。我重复一遍，它还没有*分布式*模型。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-30T16:39:29.593

[glibc 库http://library.gnome.org/devel/glib/stable/glib-Threads.html](http://library.gnome.org/devel/glib/stable/glib-Threads.html)中的 gthreads编译为 pthreads，因此您不会失去任何性能。它们还为您提供了非常强大的线程池和线程之间的消息队列。我已经成功使用了好几次，并且对可用的功能非常满意。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-27T17:16:36.433

我经常使用 OpenMP 主要是因为它的简单性、可移植性和灵活性。它支持多种语言，甚至是全能的 C++/Cli :)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-19T09:24:27.940

到目前为止我只知道 Java，那里的多线程支持对我来说效果很好..

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-04-04T06:13:04.697

我使用 open cl。我认为它比 mpi 更容易使用。我以前也使用 mpi 作为我的并行和分布式计算课程的要求，但我认为你必须做太多的体力劳动。我要开始了几天后在CUDA中工作。CUDA与open cl非常相似，但问题是CUDA仅适用于nvidia产品。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-03T14:47:42.810

+1 为 PLINQ

Win32 线程、线程池和光纤、同步对象

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-18T14:58:28.970

我使用 MPI 并且非常喜欢它。它确实迫使您考虑内存层次结构，但根据我的经验，考虑这些事情对于高性能仍然很重要。在许多情况下，MPI 可以在很大程度上隐藏在特定领域的并行对象后面（例如，用于求解线性和非线性方程的 PETSc）。

# vb.net - 初学者：将 byte() 转换/复制到 single() 中的最快方法

> ID：166739
> 
> 赞同：0
> 
> 时间：2008-10-03T13:06:57.460
> 
> 标签：vb.net, byte, casting, ctype

我有一个作为 directx 声音捕获结果返回的 byte() 数组，但对于我程序的其他部分，我想将结果视为 single()。逐项递减数组是最快的方法还是有一种聪明的方法？

得到它的代码是

```
CType(Me._applicationBuffer.Read(Me._nextCaptureOffset, GetType(Byte), LockFlag.None, LockSize), Byte()) 
```

它创建了字节数组，Ctype 可以处理 single 吗？（注意，我想不出办法！）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T11:13:25.270

```
public float[] ByteArrayToFloatArray(byte[] byteArray)
{
    float[] floatArray = new float[byteArray.Length / 4];
    for (int i = 0; i < floatArray.Length; i++)
    {
        floatArray[i] = BitConverter.ToSingle(byteArray, i * 4);
    }
    return floatArray;
} 
```

最快的方法（就性能而言，而不是写入所需的时间）可能是使用[CopyMemory](http://www.codeproject.com/KB/vb/netcopymemorysample.aspx) API 调用。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-03T13:09:54.270

尝试

```
float f = BitConverter.ToSingle(bytearray, 0); 
```

在VB中（我认为）：

```
Dim single s;
s = BitConverter.ToSingle(bytearray, 0); 
```

# simulation - 机器人模拟环境

> ID：166742
> 
> 赞同：14
> 
> 时间：2008-10-03T13:07:22.310
> 
> 标签：simulation, environment, robotics

我想列出一个出色的机器人模拟环境，包括它们的优点和缺点。我知道的一些例子是[Webots](http://www.cyberbotics.com/)和[Player/Stage](http://playerstage.sourceforge.net/)。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-06T05:51:31.880

[ROS](http://www.ros.org)将可视化您的机器人以及您从中记录的任何数据。

要检查的包裹将`rviz`和`nav_view`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T13:19:27.667

这让我想起了这个[简短](http://www.spiderland.org/node/2598)的项目。

> *breve 是一个免费的开源软件包，可以轻松构建多智能体系统和人工生命的 3D 模拟。*

还有一个维基页面列出了[机器人模拟器](http://en.wikipedia.org/wiki/Robotics_simulator)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T13:30:17.757

[微软机器人工作室/微软机器人开发者工作室 2008](http://msdn.microsoft.com/en-us/robotics/default.aspx)

另请阅读MSDN 杂志上的[这篇](http://msdn.microsoft.com/en-us/magazine/cc546547.aspx)文章

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-03-14T05:58:15.383

这完全取决于你想对模拟做什么。我做有腿机器人模拟，我的视角不同于移动机器人，但是......

如果您对动力学感兴趣，那么最古老但最难使用的一种是 sd/fast。最初制造它的公司被一家大型 cad 装备收购。您可以尝试前往：[http](http://www.sdfast.com/)
://www.sdfast.com/ 这会花费您一些钱，但我相信模拟的准确性。没有接触或碰撞模型，所以你必须自己动手。我用它来模拟两足动物、游泳鱼等。也没有可视化。因此，它适用于铁杆程序员。但是，它在我们这些老人中很受尊重。

人们使用 OpenDynamics 引擎[http://www.ode.org/](http://www.ode.org/)进行“更轻松”的模拟。它带有一个积分器和一个原始的可视化包。有 python 绑定（python 万岁！）。

摩擦模型的构建......是......没有很好的记录。而且没有意义。此外，模拟可能会无缘无故地突然“分崩离析”。模拟可能准确也可能不准确。

现在，MapleSoft（在美丽的加拿大滑铁卢）推出了 maplesim。它会让你花掉一些钱，但这是我喜欢它的地方：

它不仅仅是机器人技术。你几乎可以做任何事情。我相信您可以模拟汽车、齿轮、发动机上的悬挂系统……我认为它甚至可以与电路模拟接口。因此，如果您正在构建高性能产品，那么 MapleSim 是一个强有力的竞争者。转到 www.maplesoft.com 并搜索它。

他们非常乐意为您提供 30 天的评估副本。

当然，你可以回家酿造。您可以使用 maple 或 mathematica 等符号计算程序求解大多数简单机器人的 Lagrange-Euler 运动方程。编辑：不能优雅地在 Maple 中做某些衍生物。我不得不求助于黑客。

但是，请注意速度问题。

最后，对于更具生物学动机的工作，您可能需要查看 opensim（不要与 OpenSimulator 混淆）。

编辑：OpenSim 与 SD/Fast 共享一个团队成员。

还有很多其他专门的模拟器。但是，要小心。

总之，这里是面向机器人工作的模拟器的评估标准：

(1) 你有什么样的碰撞模型？如果是非常刚性的弹性碰撞，则在碰撞期间您可能会遇到数值稳定性问题（2）可视化-您可以添加不同的地形等。（3）方便的图形构建工具，因此您不必编码然后查看-你得到什么。处理复杂的系统（比如一个完整的人形机器人）很难在你的脑海中思考。

(4) 底层仿真算法的复杂度是多少。如果是 O(N) 那就太好了。但它可能是 O(N^4) ，就像直接拉格朗日欧拉推导的情况一样……那么无论你的机器有多快，你的系统都无法扩展。

(5) 它有多准确，你在乎吗？(6) 它是否帮助您集成传感器。对于移动机器人，您需要具有“机器人眼睛视图”（7）如果它进行可视化，您是否可以在物体移动时自动跟随它，还是必须四处追赶？

希望有帮助！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-03T13:26:16.343

它不像 Webots 那样令人印象深刻，但[RobotBasic](http://www.robotbasic.org/)是免费的、易于学习的，并且对于制作简单的机器人运动算法的原型很有用。您还可以从 IDE 编写 BasicStamp。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-18T10:10:19.313

我一直在针对[SimSpark](http://simspark.sourceforge.net/wiki/index.php/Main_Page)进行编程。[它是RoboCup 3D 模拟足球联赛](http://en.wikipedia.org/wiki/RoboCup_3D_Soccer_Simulation_League)背后的开源模拟引擎。

它可以针对不同的模拟进行扩展。您可以使用 C++、Ruby 和/或 RSG（Ruby 场景图）文件插入自己的传感器、执行器和模型。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-28T07:45:27.963

ABB 有一个名为 RobotStudio 的解决方案，用于模拟他们的大型工业机器人。我不认为它是免费的，我猜你不会从中获得很多乐趣，但它令人印象深刻。[这是一个关于它的页面](http://www.abb.com/product/seitp327/78fb236cae7e605dc1256f1e002a892c.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-27T12:57:57.740

我一直在使用 Carmen [http://carmen.sourceforge.net/](http://carmen.sourceforge.net/)并发现它很有用。

Carmen 的缺点之一是所有方面的文档，我认为该网页有点过时且不足。所以我喜欢听取其他有与 Carmen 合作经验的人的意见，或与 Carmen 打交道的学生报告/项目。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-09-20T05:33:22.057

你可以找到一个很好的模拟环境列表[http://www.intorobotics.com/robotics-simulation-softwares-with-3d-modeling-and-programming-support/](http://www.intorobotics.com/robotics-simulation-softwares-with-3d-modeling-and-programming-support/)

MRDS 是最好的之一，而且它是免费的。LabView 也很适合在机器人中使用

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-05-25T12:57:52.313

National Instruments 的[LabView](http://www.ni.com/labview/)是用于开发测量、测试和控制系统的图形编程环境。它可以用于 SolidWorks 的 3D 控制[模拟](http://cnx.org/content/m12977/latest/)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-09-04T13:12:25.883

MRDS 是免费的，是机器人最好的仿真环境之一。也可以使用 Workspace，如果您想要完整的[机器人仿真软件列表，请查看此链接](http://www.smashingrobotics.com/most-advanced-and-used-robotics-simulation-software/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-10-20T22:23:41.203

[Trik Studio](http://robots.qreal.ru/)有一个漂亮而清晰的 2D 模型模拟器，以及它们的可视化和文本编程环境。他们还将很快支持基于[Morse](http://www.openrobots.org/wiki/morse/)模拟器的 3D 建模工具。它也是免费和开源的，并具有多语言界面。

# .net - 运行 Mono 的最佳 Linux 发行版

> ID：166744
> 
> 赞同：24
> 
> 时间：2008-10-03T13:07:44.260
> 
> 标签：.net, linux, mono

我是一名 .Net 开发人员，想研究在 Mono 上构建和运行我们的框架。

如果最初的项目成功，我会很高兴地投资于操作系统学习曲线，但现在我想专注于让事情启动和运行并查看代码是否正常工作。

假设我对 Linux 知之甚少，但我是一位经验丰富的开发人员，那么最好的发行版是什么？我可以期望多快（几小时/几天/几周？）实现这一目标？

**到目前为止的一些反馈**（谢谢大家的回答）：决定使用 CentOS，但这也是因为这适合我想要移植到 Mono 的 .Net 代码的特定实现。唯一的问题是我需要转至版本 4 以进行 Mono 的开箱即用安装

在一些帮助下，我已经能够做到这一点，我能够运行编译并开始解决移植问题。这花了几个小时——最大的学习曲线是围绕驱动 Linux。

20081231：找到以下关于在 ubuntu 上运行单声道的文章：[http ://www.ddj.com/windows/212201484](http://www.ddj.com/windows/212201484)

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-05T22:18:34.223

我为 Novell 工作，所以我将推荐 OpenSUSE 作为用于 Mono 的发行版。

当您使用 OpenSUSE 时，您不仅会获得 Mono，而且还有数百个开源库和基于 .NET 的应用程序，我们已经移植并通过我们的更新系统提供这些应用程序。

此外，许多预览功能都可以作为可以安装在 OpenSUSE 上的软件包提供。其他分布在上述两个方面往往落后。

此外，OpenSUSE 越多，我们就能获得更多资金来继续改进 Mono。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-03T13:41:01.510

Mono 下载页面对他们首选的发行版给出了相当大的提示：

[http://www.go-mono.com/mono-downloads/download.html](http://www.go-mono.com/mono-downloads/download.html)

还有一个“不支持的发行版”页面：

[http://www.mono-project.com/Other_Downloads](http://www.mono-project.com/Other_Downloads)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T13:09:07.847

可能是 Novell (SuSE)，因为他们资助 mono 项目并支付核心开发人员的费用，他们很有可能使用 Novell 工作站进行初始编码。

不过，这真的不应该有多大关系。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-03T14:39:27.850

为了尽快开始，[Mono 的下载页面](http://www.go-mono.com/mono-downloads/download.html)上有一个 VMWare 映像。它预装了 Mono 及其所有工具，包括一个正在运行的 ASP.Net 服务器。您可以从这里开始，然后迁移到您选择的任何发行版（如果您继续前进）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T13:09:54.223

如果您是 linux 初学者，我将从 Ubuntu Linux Server 开始；几周前，我在 Gentoo 服务器上安装了 Mono，只是为了发现它无法运行预编译的 ASP.net 站点 :') 请注意，Linux 不是为 .NET 设计的。您应该能够在一两天内设置服务器，配置 Mono 工作可能需要一些时间......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T13:10:05.987

使用 Linux MINT - 最完整的发行版之一。此外，它具有出色的包管理和出色的启动配置。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-03T13:11:09.587

它与 suse 很好地集成在一起。但在 Ubuntu 上也很有效，而且 ubuntu 似乎更能吸引 linux 新手。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-03T13:17:44.583

就像其他人所说的那样，Novell 与 Mono 有直接联系，但我认为 Mono 体验在大品牌（Suse、Ubuntu、Redhat ......）之间不会有很大差异。

您是否对获得易于启动和运行的东西更感兴趣，或者是否有计划在未来的某个时候将其部署到生产中？如果是前者，我个人的偏好是 Ubuntu，但如果是后者，那么这对你来说更像是一个问题，哪个会更好地与你现有的基础设施集成，并提供你正在寻找的那种支持，等等.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-03T13:47:08.033

如果您想避免操作系统学习曲线，请选择面向桌面的发行版之一，例如[Ubuntu](http://www.ubuntu.com/)或 Fedora。任何一个“大”的都有单声道包。如果您想尝试特定（尤其是开发）版本，无论如何您都必须进行手动安装。

还要避免在真实硬件上运行它：-) [VirtualBox](http://www.virtualbox.org/)是一个很棒的免费虚拟化解决方案，如果您不关心双启动、主启动记录和硬件故障，它可以真正消除测试软件的麻烦。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-12T15:36:23.287

我已经使用 Ubuntu 进行 Mono 开发有一段时间了，我发现它非常令人满意，除了使用 mod_xsp 设置 Apache 以使 Web 部分正常工作有点困难。MonoDevelop 中带有 Stetic UI 的 GTK# 还是不错的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-11-17T10:19:39.187

至于运行单声道，就我的 ASP.NET 而言，我更喜欢 arch linux（非常流行的滚动发行版，我在桌面上使用的发行版）用于开发测试服务器和 ubuntu（或 fedora）用于生产。

我已经开始在 Set/2010 上使用 linux 作为我的主要桌面解决方案，作为高级 .NET 开发人员，我知道我对它感觉很舒服，我不是专家，但我已经管理了大部分所需的任务来完成使用我自己的技能（和很多谷歌搜索：D）工作。

同时，在开发方面，我仍然使用 Windows 7 VM 来运行有史以来最好的 IDE VS2010。MonoDevelop 变得越来越酷，但非常不稳定，缺乏很多 Web 开发功能。

了解一个新的操作系统是件好事。我应该使用最适合的方式来完成这项工作：linux、windows 等。

# database-design - 我应该有一个专用的主键字段吗？

> ID：166750
> 
> 赞同：19
> 
> 时间：2008-10-03T13:08:36.707
> 
> 标签：database-design, primary-key

我正在设计一个供 Web 应用程序使用的小型 SQL 数据库。

假设一个特定的表有一个名称字段，不允许任何两行具有相同的值。但是，用户将能够随时更改名称字段。

此表中的主键将用作其他表中的外键。因此，如果将 Name 字段用作主键，则任何更改都需要传播到其他表。另一方面，唯一性要求将被自动处理。

我的直觉是添加一个整数字段作为主键，它可以由数据库自动填充。拥有这个领域有什么意义还是浪费时间？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-03T13:10:29.700

出于您提到的原因，我自己会使用生成的 PK。此外，按整数索引和比较比按字符串比较快。您也可以在名称字段上放置唯一索引，而无需将其设为主键。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-03T13:23:28.300

您所描述的称为*代理键*。详细答案请参见[Wikipedia 文章](http://en.wikipedia.org/wiki/Surrogate_key)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-03T13:33:33.367

尽管在整数列上搜索和加入会更快（正如许多人所指出的那样），但从一开始就不加入会更快。通过存储[自然键](http://en.wikipedia.org/wiki/Natural_key)，您通常可以消除连接的需要。

对于小型数据库，对外键引用的 CASCADE 更新不会对性能产生太大影响，除非它们非常频繁地更改。

话虽如此，在这种情况下，您可能应该使用整数或 GUID 作为[代理键](http://en.wikipedia.org/wiki/Surrogate_key)。可按设计更新的主键不是最好的主意，除非您的应用程序有非常令人信服的商业理由要求名称唯一，否则您将不可避免地发生冲突。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-03T13:17:24.223

是的 - 根据经验，每张桌子总是如此。

您绝对不应该将可更改字段用作主键，并且在绝大多数情况下，您不希望将具有任何其他用途的字段用作主键。

这是 db 模式的基本良好实践。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-03T13:17:51.057

从性能的角度来看，拥有一个整数主键总是一件好事。使用整数主键，您的所有关系都会更有效率。例如，JOIN 会更快（[SQL Server](http://en.wikipedia.org/wiki/Microsoft_SQL_Server)）。

它还将允许您将来修改数据库。很多时候，您有一个唯一的名称列，但后来发现它根本不是唯一的名称。

现在，您也可以通过在其上设置索引来强制列*Name的唯一性。*

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-03T13:22:04.607

我会使用自动生成的 ID 字段作为主键。基于整数 ID 的表比文本更容易连接。此外，如果字段*Name*经常更新，如果它是主键，数据库将面临更频繁地更新该字段索引的压力。

如果字段*名称*始终是唯一的，您仍应在数据库中将其标记为唯一。但是，通常会有两个相同名称的可能性（在您的情况下可能不是现在，但可能在将来），所以我不推荐它。

使用 ID 的另一个优点是如果您需要对数据库进行报告。如果您有一个针对给定名称集的报告，即使名称可能发生变化，报告上的 ID 过滤器也会保持一致。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-03T13:31:11.607

如果你生活在理论数学家的稀有圈子里（就像 C.Date 一样，因为所有数据值都是已知且正确的），那么主键可以从识别您所指的理想化柏拉图实体的数据组件（即姓名+生日+出生地点+父母的姓名），但在混乱的现实世界中可以识别您的现实世界实体的“合成密钥”数据库的上下文是一种更实用的做事方式。（并且可以为空的字段可能非常有用。拿那个吧，关系设计理论的人！）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-03T13:31:31.403

记录的主键必须是唯一且**永久**的。如果一个记录自然有一个满足这两个条件的简单键，那么就使用它。但是，它们并不经常出现。对于人员记录，此人的姓名既不是唯一的也不是永久的，因此您几乎必须使用自动增量。

自然键起作用的一个地方是代码表，例如，将状态值映射到其描述的表。给“Active”一个主键 1，给“Delay”一个主键 2 等没有什么意义。当给“Active”一个主键“ACT”一样容易时；“延迟”、“DLY”；“等待”、“HLD”等。

另请注意，有人说您应该在字符串上使用整数，因为它们比较快。不是真的。比较两个 4 字节字符字段的时间与比较两个 4 字节整数字段的时间完全相同。更长的字符串当然会花费更长的时间，但是如果您保持代码简短，则没有区别。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-03T14:07:32.080

如果您的 name 列将发生变化，那么它并不是一个很好的主键候选者。主键应定义表的唯一行。如果它可以改变它并没有真正做到这一点。在不了解您的系统的更多细节的情况下，我不能说，但这可能是使用代理键的好时机。

我还将添加它以消除对所有主键使用自动递增整数的神话。使用它们并不总是能提高性能。事实上，很多时候情况恰恰相反。如果您有一个自动递增的列，这意味着系统中的每个 INSERT 现在都有生成新值的额外开销。

此外，正如 Mark 指出的那样，如果您有一系列相关的表，则在所有表上都有代理 ID，要从一个表到另一个表，您可能必须将所有这些表连接在一起以遍历它们。使用自然主键通常不是这种情况。用整数连接 6 个表通常比用字符串连接 2 个表要慢。

当您在所有表上都有自动递增的 ID 时，您也经常失去执行基于集合的操作的能力。您现在必须在游标或其他循环中一次插入一个父行，而不是在父表中插入 1000 行，然后在子表中插入 5000 行，以便获取生成的 ID，以便您可以分配它们给相关的孩子。我已经看到一个 30 秒的过程变成了一个 20 分钟的过程，因为有人坚持在数据库中的所有表上使用自动递增的 ID。

最后（至少出于我在这里列出的原因 - 当然还有其他原因），在所有表上使用自动递增 ID 会导致设计不佳。当设计人员不再需要考虑表的自然键可能是什么时，通常会导致错误的重复数据最终出现在数据中。您可以尝试避免唯一索引的问题，但根据我的经验，开发人员和设计人员不会付出额外的努力，并且在使用他们的新系统一年后，他们发现数据是一团糟，因为数据库没有通过自然键对数据进行适当的约束。

使用代理键当然是有时间的，但在所有表上盲目地使用它们几乎总是一个错误。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-03T13:16:12.073

每一行的主键必须是*唯一的。*auto_increment Integer 是一个非常好的主意，如果您对填充主键没有其他想法，那么这是最好的方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-03-01T10:48:27.170

除了所说的，***考虑***使用 UUID 作为 PK。它将允许您创建跨多个数据库的唯一键。

如果您需要将数据与其他数据库导出/合并，那么数据将始终保持唯一，并且可以轻松维护关系。

# c# - C# 编译器数字文字

> ID：166752
> 
> 赞同：36
> 
> 时间：2008-10-03T13:09:27.737
> 
> 标签：c#, compiler-construction

有谁知道 C# 编译器数字文字修饰符的完整列表？

默认情况下，声明 '0' 使其成为 Int32 和 '0.0' 使其成为 'Double'。我可以在末尾使用文字修饰符“f”来确保将某些内容视为“单一”。比如像这样...

```
var x = 0;    // x is Int32
var y = 0f;   // y is Single 
```

我可以使用哪些其他修饰符？是否有一个强制加倍，​​十进制，UInt32？我试着用谷歌搜索，但找不到任何东西。也许我的术语是错误的，所以这解释了为什么我会出现空白。非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-10-03T13:11:21.350

```
var y = 0f; // y is single
var z = 0d; // z is double
var r = 0m; // r is decimal
var i = 0U; // i is unsigned int
var j = 0L; // j is long (note capital L for clarity)
var k = 0UL; // k is unsigned long (note capital L for clarity) 
```

来自[C# 规范](https://stackoverflow.com/questions/127776/where-can-you-find-the-c-language-specifications)2.4.4.2 整数文字和 2.4.4.3 实数文字。请注意，为了清楚起见，L 和 UL 是首选的，而不是[Jon Skeet](https://stackoverflow.com/users/22656/jon-skeet)推荐的小写变体。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-03T13:21:33.437

如果您不想记住它们，那么编译器也接受用于相同目的的强制转换（您可以检查 IL 效果是否相同 - 即编译器而不是运行时进行强制转换）。借用前面的例子：

```
 var y = (float)0; // y is single
    var z = (double)0; // z is double
    var r = (decimal)0; // r is decimal
    var i = (uint)0; // i is unsigned int
    var j = (long)0; // j is long
    var k = (ulong)0; // k is unsigned long 
```

为了记录，我同意“var”在这里是一个糟糕的选择；我很乐意将 var 用于 SortedDictionary<SomeLongType, SomeOtherLongType>，但对于“int”，它只是懒惰......

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-03T13:17:03.057

您可能想从[查看 C# 语言规范](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)开始。大多数类型都在其中列出，并有一个后缀：

*   L = 长
*   F = 浮动
*   U = 单位
*   乌龙[有点不同](http://msdn.microsoft.com/en-us/library/t98873t4(VS.71).aspx)
*   m = 十进制（钱）
*   D = 双

当然，如果您停止使用*var* ，那么您就可以解决整个问题，并且您的代码变得更具可读性（好吧，这是主观的，但是对于这样的事情，其他人更具可读性：

```
var x = 0; //whats x?
float x = 0; //oh, it's a float
byte x = 0; // or not! 
```

# sctp - 为什么端点必须管理在 SCTP 拥塞控制中发送和接收的 TSN 发送和接收的字节之间的转换？

> ID：166757
> 
> 赞同：0
> 
> 时间：2008-10-03T13:10:07.280
> 
> 标签：sctp, congestion-control

如 RFC 3286 中所述：

“...端点必须管理发送和接收的字节以及发送和接收的 TSN 之间的转换，因为 TSN 是按块而不是按字节”。

这对拥塞控制算法有何影响？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T23:43:50.620

有两个原因： 1\. 实用上，RFC 3286 引用[RFC 2581](http://www.faqs.org/rfcs/rfc2581.html)进行大部分的拥塞控制，它以字节为单位工作。2\. 实际上，这是一个更有力的理由，需要在每一端分配一个缓冲区，并且这些缓冲区很难根据 TSN（块）来定义，因为它们的大小是可变的。这要么意味着过度分配缓冲区中的空间，例如 64K * TSN，要么使用动态分配的列表。前者浪费空间，后者相对较慢。

这是否回答了您的问题，还是与您的上一个问题更相关？

# view - 将视图与流进行比较

> ID：166764
> 
> 赞同：0
> 
> 时间：2008-10-03T13:12:00.273
> 
> 标签：view, stream, compare, clearcase

我使用 ClearCase。我有一个快照视图。有没有办法将此视图与流进行比较以查找更改的文件？

在 TortoiseSVN 中，这被称为“检查修改”，它显示了本地副本和我们在 repo 中的所有差异。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T13:55:51.340

我不确定 Clear Case 自己的可能性，但您始终可以查看该流并将您的原始视图与使用任何文件/文件夹比较工具创建的视图进行比较。为此，我使用[Araxis Merge](http://www.araxis.com/merge/index.html)。还有一个开源工具：[WinMerge](http://sourceforge.net/projects/winmerge/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T15:40:08.023

您是否尝试过“[版本树](http://publib.boulder.ibm.com/infocenter/cchelp/v7r0m1/topic/com.ibm.rational.clearcase.doc/topics/u_ccvtree.htm)”功能？

# sifr - 在 nyroModal 灯箱中使用 sIFR

> ID：166768
> 
> 赞同：0
> 
> 时间：2008-10-03T13:12:21.693
> 
> 标签：sifr, lightbox, nyromodal

我在 nyroModal 灯箱中弹出的页面中使用 sIFR，但是当页面显示时，没有显示 sIFR 对象。我需要做什么才能让他们展示？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T16:18:09.883

我们的想法是使用来自 nyroModal 的 endShowContent 回调来对您的文本进行 sIFR。

```
$.fn.nyroModal.settings.endShowContent = function(elts, settings) {
    $('YOUR SELECTOR', elts.content).media(function(el, options) {
        // What you need to do
    });
}; 
```

希望它会有所帮助。如果您仍然遇到问题，请在 google 代码页上发布您的问题：[http ://code.google.com/p/nyromodal/](http://code.google.com/p/nyromodal/)

# firefox - 如何使用 IFRAME 将 Firefox 2 兼容扩展更新到 Firefox 3？

> ID：166772
> 
> 赞同：2
> 
> 时间：2008-10-03T13:14:04.230
> 
> 标签：firefox, xul

我正在尝试更新为工作中的某些任务创建的自定义 firefox 扩展。基本上，它是一个侧边栏，可出于各种目的在 iframe 中拉出我们的一个网页。迁移到 Firefox 3 时，iframe 根本不会出现。

下面是一个 XUL 文件的示例，其中包含特定于扩展程序的代码，包括 iframe，目前只是尝试加载 google，但它不会与任何东西一起使用。我在网上找不到任何提及 FF3 中会导致这种情况的变化。任何建议，将不胜感激。

```
<?xml version="1.0"?>
<?xml-stylesheet href="chrome://customsidebar/skin/customsidebar.css" type="text/css"?>

<overlay id="customsidebar-Main" xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
  <script type="application/x-javascript" src="chrome://customsidebar/content/customsidebar.js"/>

  <vbox flex="1">
    <toolbar>
      <vbox>
        <hbox id="customsidebar_TopToolbarRow">
          <toolbarbutton label="Refresh" id="customsidebar_Refresh" oncommand="customsidebar_Refresh()" />
        </hbox>
        <hbox>
          <label control="customsidebar_StatusBox" value="Log"/>
          <textbox id="customsidebar_StatusBox" multiline="true" rows="1" wrap="off"  />
        </hbox>
      </vbox>
    </toolbar>

    <iframe id="customsidebar_Iframe" src="http://www.google.com" />
  </vbox>
</overlay> 
```

这是覆盖 XUL 文件

```
<?xml version="1.0"?>
<overlay id="CustomSidebar-Overlay"
         xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

    <menupopup id="viewSidebarMenu">
        <menuitem observes="viewCustomSidebar" />
    </menupopup>

  <broadcasterset id="mainBroadcasterSet">
    <broadcaster id="viewCustomSidebar"
      autoCheck="false"
      label="CustomSidebar"
      type="checkbox" group="sidebar"
      sidebarurl="chrome://customersidebar/content/customersidebarMain.xul"
      sidebartitle="CustomSidebar"
      oncommand="toggleSidebar('viewCustomSidebar');"/>
  </broadcasterset>

</overlay> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T18:11:48.263

1.  在 iframe 上设置 flex="1"
2.  The XUL code for sidebar is not an overlay, it's a document loaded inside an iframe (look at the Firefox main window in the DOM inspector). So the root element should be <page>, not <overlay>. This, combined with the flex="1", should make the page display.
3.  You usually want to put type="content" or type="content-primary" on the iframe. Definitely so if you load untrusted pages in it.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T13:34:46.047

我会尝试在 iframe 上设置 flex="1" 。如果这不起作用，也许可以尝试使用[浏览器](http://developer.mozilla.org/en/XUL/browser)元素而不是 iframe。

# visual-studio - 您如何管理由多个开发人员更改的源代码控制中的 .vcproj 文件？

> ID：166796
> 
> 赞同：8
> 
> 时间：2008-10-03T13:18:24.987
> 
> 标签：visual-studio, svn, merge

我们使用 Subversion 作为我们的源代码控制系统，并将 VisualStudio 项目文件 (vcproj) 存储在源代码控制系统中，我认为这是正常的。在 Subversion 中，我们不使用任何形式的文件锁定，因此如果两个开发人员同时在同一个项目上工作，并且都向项目中添加文件或更改设置，那么第二个提交的人必须合并更改。

您如何合并这些更改？

vcproj 文件只是文本文件，因此可以手动编辑它们，但它们不太适合手动编辑，尤其是初级开发人员。

我能想到的方法是

*   从 svn 获取最新版本并手动重新添加所有本地更改
*   手动编辑文件以解决自动合并的任何冲突
*   实施某种形式的锁定方案以防止同时更改
*   在开发人员之间达成协议，这样他们就不会同时进行更改

目前我们正在使用手动重新添加所有更改的第一个选项，但这很耗时，我想知道是否有更好的方法。

对于源文件，自动合并功能大部分时间都有效，我们不会遇到很多冲突。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T13:22:44.213

我发现选项 2（手动编辑文件）通常效果很好，只要您使用好的差异工具（我使用[WinMerge](http://www.winmerge.org/)）。我遇到的主要问题是 Visual Studio 有时会重新排序文件。但是，如果你有一个好的 diff/merge 工具，那么它应该能够区分更改的内容和移动的内容。这可以有很大帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-10-23T05:41:49.997

您可能会发现[Project: Merge](http://www.projectmerge.com/index.php)或[Tools for SLN 文件](http://slntools.codeplex.com/)很有用

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T13:26:43.003

这是一个棘手的问题，我认为是 Visual Studio 体系结构的一个弱点。我们找到的方法是根本没有源代码控制中的项目文件，并有一个处理配置设置的构建脚本。

替代方案非常混乱，我们无法保证开发人员之间的构建或环境一致。这导致了大量的下游集成问题，最终我们采取了从源代码控制中删除项目文件的严厉步骤。

开发人员的环境仍然可能会出现偏差，但是当他们尝试自己构建东西时就会出现这种情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T13:43:54.217

在这里使用 TFS，但我认为这没有什么不同。
我们也不锁定，有时还要处理合并项目文件。我从来没有发现它是那么复杂或很大的问题。我们很少遇到无法自动合并的问题，手动合并过程非常简单。

对此只有一个警告：经常检查！如果您对项目结构进行了重大更改并且没有立即将它们签入，那么这些更改可能会开始加剧以后合并的复杂性。如果我对项目结构进行重大更改，我通常会提醒每个人。我会要求他们都检查他们当前的工作，然后自己处理合并。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-05T22:12:28.117

我最近发现了这个：http: [//www.codeproject.com/KB/macros/vcproj_formatter.aspx](http://www.codeproject.com/KB/macros/vcproj_formatter.aspx) 如果您在 vcproj 文件及其修改版本上运行此工具，那么您可以轻松地将它们与您喜欢的文本合并一起合并工具，此外，结果是一个更紧凑漂亮的 vcproj 文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T00:02:50.663

选项 1 和 2 不是相互排斥的 - 如果开发人员是初级水平，让他们使用选项 1（重新获取项目文件并重新进行更改），如果这对他们来说更舒服的话。对于更高级的开发人员，选项 2（使用合并工具进行合并）非常好。

我认为这是目前没有灵丹妙药的情况 - 有时合并是一种痛苦。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-03T13:23:35.397

我们使用差异工具 ( [WinMerge](http://www.winmerge.org/) ) 来合并更改。项目文件（大部分）是非常直接的 XML。不过，这里的关键是，合并时绝不应该有任何意外，因为良好的沟通是有效源代码控制的基石的一部分。

只要人们进行交流，同时*对项目进行更改是完全可以的。*

# visual-studio - Windows 窗体设计器：无法加载文件或程序集

> ID：166802
> 
> 赞同：50
> 
> 时间：2008-10-03T13:19:57.573
> 
> 标签：visual-studio, windows-forms-designer

有没有人遇到过尝试在 Visual Studio .NET 中的 Windows 窗体上“查看设计器”导致错误：**“无法加载文件或程序集......”**？

在这种情况下，有问题的程序集是`XYZ.dll`。我设法通过添加`XYZ.dll`及其对我项目引用的所有引用（即使我的项目不直接依赖于它们）并重建整个解决方案来解决此问题。然而，在那之后，我从我的项目中删除了所有这些引用，重新构建，它仍然有效。

另一条信息是我使用**Resharper 2.5**。其他人指出，可能是 Resharper 做了一些影子复制。下次发生这种情况时，我会调查一下。有没有人了解为什么首先会发生此错误，以及可能的“正确”修复方法？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-03T13:32:26.037

我们有同样的问题。某些 Form/UserControl 类无法在设计器中查看，Visual Studio 会导致各种异常。

有一个典型的原因：在初始化期间（在构造函数中或在 Load 事件中或之前）中，设计的组件之一引发了未处理的异常。

不仅在这种情况下，您还可以运行另一个 Visual Studio 实例，打开/创建一些独立项目，转到菜单 -> 调试 -> 附加到进程 ... -> 使用有问题的设计器选择 devenv.exe 进程的实例。然后按**Ctrl+Alt+E**，应显示“例外”窗口。在异常类别中检查“抛出”。

现在与设计师一起激活视觉工作室并尝试查看设计师。如果将抛出异常，您将看到调用堆栈（可能还有源代码，如果从您的代码中抛出异常）和其他有关抛出异常的典型信息。这些信息可能非常有用。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2011-10-21T19:59:24.247

这是一个似乎仍然没有答案的老问题，无论是在这里还是在更广泛的论坛池中，大多数建议都与无情的清理>重建或关闭>清理文件夹>重新打开或重新启动机器有关。我目前还没有一个可靠的答案，尽管已经对此进行了一些研究，并认为我可以分享。总而言之，当设计控件或表单时，所有设计器文件都复制到一个位置，旧文件可以存在的另一个位置，并且描述了在设计器生成错误页面之前捕获所有设计器异常的方法。

似乎有两种情况，无法加载或找不到程序集。第一个是由于文件无法复制到设计人员要求的位置，第二个是遗留的过时文件。

如上所述，当项目无法直接引用其引用的引用及其引用所需的所有引用时，文件可能无法复制，递归地向下到框架。这可以通过仔细跟踪所有参考及其家属来缓解，确保所有参考都得到考虑。

Visual Studio 设计器使用特定位置缓存 dll 以供其在设计器中使用，与项目的源 /bin 文件夹隔离：

视窗XP：

**C:\Documents and Settings\[用户名]\Local Settings\Application Data\Microsoft\VisualStudio\10.0\ProjectAssemblies**

Windows 7的：

**C:\Users\[用户名]\AppData\Local\Microsoft\VisualStudio\10.0\ProjectAssemblies**

在此位置，已编译的程序集被复制到*动态*创建的文件夹中，每个程序集一个文件夹。检查此位置上的程序集版本日期，它似乎是最新的，在 Visual Studio 退出时被删除。当使用新编译的文件查看设计器时，会复制所有程序集。为每个设计者将每个组件的新副本制作到此位置，因此该位置可以保存每个组件的多个相同副本。

然而，存在另一个位置可以复制程序集，并且是程序集搜索序列的一部分，显然在 ProjectAssemblies 文件夹之前，并且位于：

**C:\Program Files\Microsoft Visual Studio 10.0\Common7\IDE**

我不知道程序集如何或何时复制到此位置，但这种情况并不常见，因此到达此处的文件很快就会成为过时引用的来源。当设计者因*“加载文件或程序集失败”*错误而失败时，设计者寻求的版本是仅由该位置的程序集引用的版本。

这是通过在第一个上使用第二个 Visual Studio 实例调试发现的，加载了所有 .net 符号，并且所有已知的异常都在抛出时中断，而不是在未处理时中断。这允许第二个实例拦截已处理的设计器异常并显示该文件位置。这是我使用的设计器错误的结果输出：

```
=== Pre-bind state information ===
LOG: User = **************
LOG: DisplayName = ***********, Version=1.0.4275.22699, Culture=neutral, PublicKeyToken=null
 (Fully-specified)
LOG: Appbase = file:///C:/Program Files/Microsoft Visual Studio 10.0/Common7/IDE/
LOG: Initial PrivatePath = NULL
Calling assembly : ***********, Version=1.0.4275.22699, Culture=neutral, PublicKeyToken=null.
===
LOG: This bind starts in default load context.
LOG: Using application configuration file: C:\Program Files\Microsoft Visual Studio 10.0\Common7\IDE\devenv.exe.Config
LOG: Using host configuration file: 
LOG: Using machine configuration file from C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\config\machine.config.
LOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).
LOG: The same bind was seen before, and was failed with hr = 0x80070002. 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2013-02-15T04:18:54.357

删除解决方案中所有项目的所有 bin 和 obj 目录。同时删除 C:\Users<User>\AppData\Local\Microsoft\VisualStudio\9.0\ProjectAssemblies 中的文件夹。VS2008 使用 9.0，VS2010 使用 10.0 等。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2016-06-29T19:16:24.660

在这个问题上挣扎了几个小时。以下是我学到的：**检查 DLL THE DESIGNER 尝试加载的是否为 64 位 DLL**。

事实证明，现在对我来说很明显，VS 是一个 32 位应用程序，因此 VS 设计器——惊喜！惊喜！也是一个 32 位应用程序，所以如果你有一个 UserControl 或其他 WinForms 控件引用了一个 64 位 DLL -**这是一个很大的 NO-NO，这将导致你的表单不在 VS Designer 中呈现并生成无法加载文件或程序集错误**。所以你应该做的第一件事是确保设计者抱怨的 DLL**不是**64 位 DLL。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-12T21:35:58.910

使用 VS 2005，我遇到了同样的问题。我执行了 Chien 在他原来的问题中列出的步骤，但是直到我关闭 VS 并重新打开解决方案之前它仍然没有用。现在设计器视图看起来不错。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-11-23T07:00:14.587

我想这个问题的发生有不同的原因，但我想我还是会分享我的案例。我希望有人能找到他们项目进展的线索。

我的问题是因为 Visual Studio（C# 项目）找不到托管的 c++ dll 并将其复制到 J Collins 帖子中提到的位置 => 设计器找不到文件。我注意到它没有与其他 DLL:s 一起复制到那里，并发现它有一个不同/非标准的输出目录。将此更改为标准使 Visual Studio 执行复制。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-03T13:27:24.110

我在 VS2005 上经常遇到这种情况，特别是在向 winform 添加自定义控件时。通常我只需要重建，不需要添加额外的引用，或者关闭并重新打开 VS。

没有明显的原因，只有 VS 错误。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-04-03T15:24:45.787

我有一个类似的问题。

就我而言，我有一个基本表单，它引用了混合模式 dll 中的一个类（c++ 托管包装器到非托管库）。我的派生表单没有正确加载，出现上述相同的错误。

但是，以下解决了该问题：http: [//support.microsoft.com/kb/967050](http://support.microsoft.com/kb/967050)

1.  为 Win32 构建混合模式项目和 ui 项目。由于 VS 是 32 位的，它无法加载 x64 非托管代码：
2.  清除 ProjectAssemblies 文件夹（需要先关闭 VS）

当您重新打开 VS 时，设计器加载没有问题。请注意，默认情况下，C# 项目编译为在 Windows x64 上编译为 x64 的任何 CPU。

希望这可以帮助某人。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-04-04T19:51:38.607

我在 c++/cli 项目中遇到了这个问题。

正如其他人所提到的，显然 Windows 窗体设计器在呈现之前实例化了您的窗体/用户控件的某个版本。

如果表单设计器由于某种原因无法实例化该类，它将失败。所以我所做的就是注释掉有问题的用户控件的构造函数，并重建我的项目。

这让我可以再次使用表单设计器。

当然，您可以使用此方法选择性地注释掉构造函数的某些部分，直到识别出使表单设计器阻塞的部分，并在可能的情况下对其进行修复。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-09-01T06:54:19.937

我正在使用 VS2005 和 VS2013 并看到同样的问题。我的项目工作中的一些 Visual Studio 表单设计器和其他的不会在设计模式下打开。在错误页面出现之前，一些打开尝试甚至使 Visual Studio 崩溃，并说：

> 为了防止在加载设计器之前可能丢失数据，必须解决以下错误：

一个观察：
如果表单中有继承的组件，设计者可能会停止工作

观察的伪代码示例：

```
...
using System.Windows.Forms; // UserControl

namespace MyNamespace
{
    public class MyForm : Form
    {
        public MyForm()
        {
            InitializeComponent();
            ...
        }

        private void InitializeComponent()
        {
            //this.ctrl = new MyNamespace.MyCtrl(); // Inherited class
            this.ctrl = new System.Windows.Forms.UserControl();
            ...
        }

        //private MyNamespace.MyCtrl myCtrl;        // Inherited class
        private UserControl ctrl;
    }

    public class MyCtrl : UserControl
    {
        ...
    }
} 
```

在非伪代码实现中，我把继承的组件注释掉了`MyCtrl`，`MyForm`改用基类`UserControl`。*Visual Studio 表单设计器*再次开始工作！

如何在 C# 中编写一个正确的*Visual Studio Form Designer* -interacting、继承组件类超出了我的范围。但是，这个观察结果可能是一个线索，有人可以解决这个问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-01-11T17:32:14.193

I have found, with problems like this, and many others, the problem tends revolve around the .NET framework installation. Lots of times, like during a system crash, files can become corrupted esp. if you have virtual memory turned off. When files in the C:\WINDOWS\Microsoft.NET folder get corrupted, they don't work the way they should, since there are alot of these files, errors dont always happen. Some parts of a file might be ok and load, then others dont. Over the years I have found keeping a FULL backup of the Microsoft.NET folder in an archive that has some type of corruption protection works well for me. You would not believe the number of things that corrupted .NET files cause to go wrong. Just about every aspect of the IDE depends on parts of it as well as many other features. Of course, if you dont have a backup you should UNINSTALL ALL NET FRAMEWORK INSTALLATIONS (don't repair because this does not guarentee files being rewritten -- the files might pass checksum and length checks but still be corrupt). After uninstalling, reboot the system, ensure that the entire Microsoft.NET folder is deleted, if not, delete it yourself (I had to do this, some files still get left behind). Once this is done, reinstall the NET framework, depending on your OS, you might not be able to get rid of the whole thing. But with windows XP I know you can, i havent tested this on newer OSes youre on your own for that one as far as testing goes. I started out by installing 2.0, then 3.5 SP1, and so on, depending on which Visual Studio you are using. I stick with 2008 because its the fastest for me and still has support for some of the newer stuff like WPF, tr1, etc... hope this helps you an anyone else with .NET woes, the error messages are often misleading but for me 99% of the time it is Microsoft.NET file corruption.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-12T15:17:57.697

I concur with the Resharper comment. I'm running 4.1\. I disabled it, restart VS2008, and tried the "Convert to Web Application" again, and it worked.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-10-24T12:47:00.610

我遇到了同样的问题。我从项目中删除了引用并再次添加，一切正常（查看 ptoject 文件，我看到引用定义已更改，例如，添加了“SpecificVersion”标签并设置为“false”）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-08-20T23:19:47.050

我在 VS2005 的 Window Forms、ASP.NET 和 Compact Framework 项目中看到了这种情况。我正在构建的项目依赖于我的解决方案中的另一个程序集，但抱怨它在尝试生成设计器文件时无法加载它。

我不确定确切的原因，但这有时会在我们提高程序集的版本号后发生。由于某种原因，Visual Studio 不会将此程序集视为“新”，并且不会将新版本放入当前项目的 bin/ 文件夹中。大多数时候它确实如此。

删除带有设计器错误的项目的 bin/ 文件夹（以及 obj/ 文件夹），然后重新构建，似乎可以让伤害消失。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-06-05T21:33:20.813

对于将来遇到此问题并一直向下滚动搜索的任何人：Delete ComponentModelCache in Appdata/Local/Microsoft/VisualStudio/..

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-08-25T07:20:38.043

为了让你的From回来。首先转到 Visual Studio 2008 命令提示符。

类型`devenv /resetsettings`
类型`devenv /resetSkippkgs`

1.  在解决方案资源管理器中单击“显示所有文件”
2.  现在通过双击打开 Form1.vb，然后单击 + 将其展开。
3.  打开 Form1.Designer.vb
4.  您可以在编辑器窗口 (IDE) 中看到这两个选项卡。
5.  现在右键单击选项卡“Form1.vb”并保存
6.  同样右键单击选项卡 Form1.vb [Design] 并保存它
7.  重新构建您的项目。
8.  重新启动 Visual Studio。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-03-10T11:12:08.327

我已经多次遇到这个问题。大多数时候都`clean+rebuild`有效（有时与 Visual Studio 的重新启动相结合）。

两次`clean+rebuild`没有工作是：

**问题 #1**

在我遇到的一种情况下，它与 C# 和 VB.NET 有关。

我的表单中有几个用户控件没有加载到设计器中。用户控件在 C# 中。它们中的大多数都在同一个命名空间下，但很少有部分命名空间的字母大小写不匹配。

*例如：*

```
userContorl1 was in myapp.mynamespace1, and 
userControl2 was in myapp.myNamespace1 
```

对于 C#，它们是不同的命名空间，因为 C# 区分大小写。但是 VB.NET 不区分大小写。我得到的错误是在尝试加载 myapp.mynamespace.userControl2 时。苦苦挣扎了半天，发现报错信息中的命名空间，在用户控件中更正，使它们都和'myapp.myNamespace1'一样，中提琴设计器在`clean+rebuild`.

**问题 #2**

我的表单（未打开）有很多用户控件。其中一个控件具有枚举类型的属性。这个枚举是在一个泛型类中定义的。设计器为此用户控件生成的代码类似于：

```
myUserControl1.SomeType = somenamespace.SomeGenericClass(of Date).SomeEnum 
```

我在打开设计师时遇到的错误是：

> 无法加载类型 somenamespace.SomeGenericClass[System.Date]+SomeEnum

我将枚举移到了课堂之外，并将设计器代码替换为：

```
myUserControl1.SomeType = somenamespace.SomeEnum 
```

设计师打开了。:)

我希望这对某人有所帮助。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-06-25T17:52:46.823

我尝试了上述许多与删除文件、重新构建、重新启动等有关的建议。我的问题是它无法加载解决方案中一些项目使用的实用程序程序集。另一个项目有共同的控制。因此，Form1 引用了 ControlsAssembly1 引用了 UtilityAssembly1。.resx 文件具有 UtilityAssembly1 中类型的属性。我删除了包含这些类型的资源。尝试再次打开表单（由于缺少资源而出现空引用异常），点击忽略并继续，我的问题得到了解决。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-03-29T08:05:36.327

我遇到过这个问题。我做了上面所说的，但没有任何意义。然后我将程序集添加到引用中。重建项目。关闭了 Visual Studio。然后重新打开屏幕，设计器正常出现。

问候，

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-07-01T14:29:09.307

只是为了插话。当我的其他项目打开并引用它时，我构建了我的 UserControl 的新版本。当我回去查看引用用户控件的表单中的设计器时，它说它找不到特定版本的.dll。

我试图从工具箱中删除对控件的引用，但没有成功。代码可以编译得很好，但设计者不会在没有错误的情况下显示。

以上方法都试过了，还是不行。

表单的 .res 文件有一些 XML：

```
<data name="EventBar1.EventCheckedSubscriptions" mimetype="application/x-microsoft.net.object.binary.base64">
    <value>
        AAEAAAD/////AQAAAAAAAAAMAgAAAJoBbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1u
        ZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0sIG1zY29ybGliLCBWZXJzaW9u
        PTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQUB
        AAAANlN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3RgMVtbU3lzdGVtLkV2ZW50SGFuZGxlcgMA
        AAAGX2l0ZW1zBV9zaXplCF92ZXJzaW9uAwAAFVN5c3RlbS5FdmVudEhhbmRsZXJbXQgIAgAAAAkDAAAA
        AAAAAAAAAAAHAwAAAAABAAAAAAAAAAMTU3lzdGVtLkV2ZW50SGFuZGxlcgs=
</value>
  </data>
  <data name="EventBar1.EventLengthSubscriptions" mimetype="application/x-microsoft.net.object.binary.base64">
    <value>
        AAEAAAD/////AQAAAAAAAAAMAgAAAJoBbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1u
        ZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0sIG1zY29ybGliLCBWZXJzaW9u
        PTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQUB
        AAAANlN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3RgMVtbU3lzdGVtLkV2ZW50SGFuZGxlcgMA
        AAAGX2l0ZW1zBV9zaXplCF92ZXJzaW9uAwAAFVN5c3RlbS5FdmVudEhhbmRsZXJbXQgIAgAAAAkDAAAA
        AAAAAAAAAAAHAwAAAAABAAAAAAAAAAMTU3lzdGVtLkV2ZW50SGFuZGxlcgs=
</value>
  </data>
  <data name="EventBar1.EventLengthTypes" mimetype="application/x-microsoft.net.object.binary.base64">
    <value>
        AAEAAAD/////AQAAAAAAAAAMAgAAAKABY3RybENhbGVuZGFyU2lkZUJhciwgVmVyc2lvbj0xLjAuNzEy
        MS4yMTIzNCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1udWxsXV0sIG1zY29ybGliLCBW
        ZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0
        ZTA4OQwDAAAAUWN0cmxDYWxlbmRhclNpZGVCYXIsIFZlcnNpb249MS4wLjcxMjEuMjEyMzQsIEN1bHR1
        cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAT1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5l
        cmljLkxpc3RgMVtbY3RybENhbGVuZGFyU2lkZUJhci5FdmVudEJhcitFdmVudExlbmd0aFR5cGUDAAAA
        Bl9pdGVtcwVfc2l6ZQhfdmVyc2lvbgQAAC5jdHJsQ2FsZW5kYXJTaWRlQmFyLkV2ZW50QmFyK0V2ZW50
        TGVuZ3RoVHlwZVtdAwAAAAgIAgAAAAkEAAAAAAAAAAAAAAAHBAAAAAABAAAAAAAAAAQsY3RybENhbGVu
        ZGFyU2lkZUJhci5FdmVudEJhcitFdmVudExlbmd0aFR5cGUDAAAACw==
</value>
  </data>
  <data name="EventBar1.EventSettingsSubscriptions" mimetype="application/x-microsoft.net.object.binary.base64">
    <value>
        AAEAAAD/////AQAAAAAAAAAMAgAAAJoBbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1u
        ZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0sIG1zY29ybGliLCBWZXJzaW9u
        PTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQUB
        AAAANlN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3RgMVtbU3lzdGVtLkV2ZW50SGFuZGxlcgMA
        AAAGX2l0ZW1zBV9zaXplCF92ZXJzaW9uAwAAFVN5c3RlbS5FdmVudEhhbmRsZXJbXQgIAgAAAAkDAAAA
        AAAAAAAAAAAHAwAAAAABAAAAAAAAAAMTU3lzdGVtLkV2ZW50SGFuZGxlcgs=
</value>
  </data> 
```

我从 .res 文件中删除了它，一切都很好。在我尝试这个之前，我确实备份了整个文件夹！

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2016-03-31T18:24:59.170

我会说这个线程中的回复对我有所帮助，但并没有完全确定我的自定义用户控件中发生的事情。

在我的特殊情况下，我有许多帮助类库来执行诸如在我的控件上设置样式、后台日志记录以及执行我一直在做的例行事情的通用帮助类。

在出现错误的情况下，我正在使用其中一些其他库**静态**方法来执行日志记录。这是一个例子：

`try { _InitializeStuff(); } catch (Exception ex) { Logger.Instance.Log("Couldn't instantiate: " + ex.Messsage); }`

我在我的用户控件的构造函数、加载和属性集方法中做到了这一点......设计者不能总是建立它的静​​态方法调用的路径，所以设计者会失败。

我尝试在它周围放置 DesignMode 检查，但问题不在运行时 - 它是设计时，并且无法构建链接。我唯一的选择是在我的自定义用户控件的以下位置删除对我的静态帮助程序类的所有引用：

*   构造函数
*   加载
*   属性访问器

不幸的是，尝试使用辅助 IDE 进行调试并使用 Attach to Process对我**不起作用**。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2016-07-01T15:17:02.287

还要确保您在表单或控件中具有使用控件的库的**using声明。**一旦设计者知道它，它就会在 Form.designer.cs 文件中的对象引用中写入完整的命名空间。

# java - Java：新手式继承问题

> ID：166823
> 
> 赞同：3
> 
> 时间：2008-10-03T13:24:07.347
> 
> 标签：java, inheritance, types, derived-class, base-class

假设我有一个基类 B 和一个派生类 D。我希望在我的基类中有一个方法 foo()，它返回一个实例类型的新对象。因此，例如，如果我调用 B.foo() 它返回一个 B 类型的对象，而如果我调用 D.foo() 它返回一个 D 类型的对象；同时，实现仅驻留在基类 B 中。

这可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T13:30:24.387

只要每个类都有一个默认构造函数：

```
 public B instance() throws Exception {
        return getClass().newInstance();
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T14:33:13.870

不。使“foo”方法抽象。

```
abstract class B {
    public abstract B foo();
} 
```

或者通过基类构造函数接收一个抽象工厂：

```
abstract class B {
    private final BFactory factory;
    protected B(BFactory factory) {
        this.factory = factory;
    }
    public B foo() {
        return factory.create();
    }
}
interface BFactory {
    B create();
} 
```

添加协变返回类型和泛型来品尝。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T13:31:33.790

我认为这可能使用反射来完成，即在你的超类中你有：

```
public ClassName getFoo() throws InstantiationException, IllegalAccessException
{
    return getClass().newInstance();
} 
```

其中 ClassName 是您的基类的名称。

不过，您必须将它投射到任何您想使用它的地方……我不确定这是否真的是一个很好的解决方案！

**编辑：** newInstance() 类型方法通常是静态的，当然您不会知道使用静态方法的子类的类型是什么。

我认为没有任何方法可以让*静态*方法（动态）创建子类的实例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T13:34:05.377

好吧，我可能会离开，但我会假设因为“this”总是指当前对象，你可以做类似的事情

```
public B foo() {
    return this.getClass().newInstance();
} 
```

或类似的规定？如果你创建一个 D 的实例然后调用 d.foo() 你应该得到一个作为 B 返回的 D 的实例。你可以将它作为一个普通的 Object 返回，但我认为在这个实例中你应该尽可能具体。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T13:45:32.157

除了我认为如果你想实现这一点可能存在设计缺陷之外，你可以尝试以下方法。

在您的问题中，您正在使用静态（类）方法，B.foo()，D.foo()，这不能使用继承来完成，因为静态方法不具有动态特性，它们不参与查找系统。所以你没有足够的类型信息。

如果您使用的是成员函数 foo()，则可以具有以下构造：

```
public class B {
    public B foo()
    throws IllegalAccessException, InstantiationException {
        return this.getClass().newInstance();
    }
}

public class D  extends B{    
}

public class Test {
    public static final void main(String[] args)
    {
        try {
            System.out.println((new B()).foo());
            System.out.println((new D()).foo());
        } catch (IllegalAccessException e) {
            e.printStackTrace();  
        } catch (InstantiationException e) {
            e.printStackTrace();  
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T13:48:20.060

正如其他答案所说，如果每个子类中都有一个无参数构造函数（确保捕获 InstantiationException 和 IllegalAccessException），则可以使用 getClass().newInstance() 。

如果任何构造函数需要参数，您可以使用反射或（在我看来更可取）定义一个类似 getNewInstance() 的方法，您可以仅在需要时在子类中覆盖该方法。

例如

```
Thing foo() {
    Thing th = getNewInstance();
    // do some stuff with th
    return th;
}

Thing getNewInstance() {
    return getClass().newInstance();
} 
```

然后 getNewInstance() 只有在你真的需要时才能被覆盖，对于没有默认构造函数的子类。

```
Thing getNewInstance() {
    return new BigThing(10, ThingSize.METRES);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T13:37:49.333

@里克

好吧，真正的问题是我有一个抽象基类 Thing。Thing 有一个名为 getNextThing() 的方法，它返回一个新的 Thing 实例。

然后，我有许多子类，如 BigThing、LittleThing、SomethingThing，我不想为每个子类重写 getNextThing() 方法。这似乎很浪费，因为他们都做同样的事情......

我的方法不正确吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-03T13:43:22.300

我不确定你为什么要尝试做你真正想做的事情。提供更多上下文可能会让我们为您提供更多帮助。

```
public class B <X extends B>{

public X foo() throws InstantiationException, IllegalAccessException{
    return (X)this.getClass().newInstance();
}
}        
public class C extends B<C>{        

} 
```

让我给你这个建议。教授 CS 课程的方式往往是教授迷恋继承，但还没有弄清楚作文。我认为您可能正在寻找的是构图。因此，与其在 Thing 本身上调用 getNextThing，不如考虑让 Thing 实现[Iterable](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Iterable.html)

这意味着您只需要编写一个可以封装获取下一事物的逻辑的[迭代器](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Iterator.html)，因为它似乎不适合您的继承模型。这样做的另一个优点是您可以从中获得一些不错的句法设备（增强了循环理解）。

# visual-studio-2008 - 为什么“找不到引用的组件'X'”。被视为警告？

> ID：166831
> 
> 赞同：0
> 
> 时间：2008-10-03T13:26:09.793
> 
> 标签：visual-studio-2008, reference, warnings

我想知道，到底为什么...... VS 团队是否认为没有找到项目参考是一件不重要的事情？

找不到引用的组件“X”。应该被认为是一个错误......仅此而已。

**有没有办法（不打开“将所有警告视为错误”）将此警告作为VS2008中的错误？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T13:32:53.740

该警告来自项目系统，而不是编译器。项目系统不知道在编译代码时是否实际需要该引用。我遇到过几种情况（都涉及多个平台和条件编译），在这些情况下，当您可能不得不将每个配置拆分为一个文件时，此功能允许您维护单个项目文件。

有一个“将警告视为错误”的选项——您应该能够在项目配置屏幕中找到它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T13:38:51.403

为什么你认为它应该是任何错误？如果您实际上在程序集中使用了任何东西，那么您会在使用它时遇到错误。到目前为止，你所说的只是“我*可能*需要这个文件”，而 VS 正在回应“好吧，我希望你不要，因为我找不到它”。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-08-06T08:28:15.300

这个警告引起了我的注意。

我有一个包含六个配置的项目 - 每个配置使用特定引用 DLL 的不同版本，因此引用是有条件的（通过破解项目文件，因为我无法通过 VS GUI 找到方法）。

尽管存在于磁盘上，但未用于当前配置的五个引用始终在 GUI 中以感叹号显示，并显示此警告（似乎没有警告 ID）。

我希望能够“修复”Visual Studio，以便它可以确定由于当前正在构建的配置，此引用可能存在也可能不存在（即使它存在）是无关紧要的。

说真的，有时微软的迟钝把我逼疯了。

# oracle - 在 Live 系统中分离 Demo 数据

> ID：166836
> 
> 赞同：1
> 
> 时间：2008-10-03T13:26:44.080
> 
> 标签：oracle

如果我们暂时搁置将演示数据放入实时系统的对与错（这是一个完全独立的讨论！），我们会被要求在我们的实时系统中存储一些演示数据，以便在没有烟雾+镜子的出现（例如，我们想使用相同的登录页面）

因为我确信这是许多其他人必须面临的挑战 - 我很想知道人们设计了哪些方法来分离这些数据，这样它就不会妨碍他们系统上的日常操作?

正如我上面提到的，我知道这可能不是最佳实践。:-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T13:30:47.380

您是否可以将数据分离到一个新的数据库中，然后将您的连接字符串（它们不是硬编码的，对吗？对吧？）重定向到演示数据库。这样，实时数据不会受到污染，并且您的代码看起来相同。我们实际上以这种方式做了一个三层部署系统，我们在其中进行本地开发，部署到每隔几个月有实时数据快照的 QC 环境，然后在测试完成后部署到实时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T13:42:21.677

FWIW，我们正在考虑使用 Oracle 的行级安全/虚拟私有数据库功能将演示数据与其他数据分开。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T13:30:52.340

我经常在某些类型的实时系统上看到它。例如，超市的销售点系统：收银员接受生产销售点终端的培训。

关键是要仔细识别测试或训练数据。我不会说对于如何在数据库中对此建模有任何明确的最佳实践——它将是特定于应用程序的。

您确实必须仔细定义测试/培训场景所涵盖的范围。例如，您不希望培训/测试事务出现在生产报告中（但您可能希望能够使用此数据创建报告以用于培训/测试目的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T19:27:11.277

完全不同意乔。无论实施如何，Oracle 都有一个工具可以做到这一点。在我阅读您的答案之前，我会说 VPD ......但这可能会对生产产生影响。

记住查询中的每个表都从

```
SELECT * FROM tableA 
```

到

```
SELECT * FROM (SELECT * FROM tableA WHERE Data_quality = 'PROD' <or however you do it> 
```

每张桌子都有一个政策......

因此，假设您的测试数据必须跨越每个表，那么每个表都必须有一个策略，并且每个表都将在 SQL 开始工作之前进行过滤。

您甚至可以向用户隐藏该列。如果您这样做，您将需要巧妙地编写策略。您必须根据插入数据的方式创建该值，并将列公开给某些管理员帐户以进行维护。

# sql-server - XML 添加超链接

> ID：166841
> 
> 赞同：0
> 
> 时间：2008-10-03T13:28:37.820
> 
> 标签：sql-server, xml, sql-server-2005, schema, hyperlink

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T13:30:57.893

我猜你没有正确编码 < 和 > 字符。您需要使用 < 和>

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T14:19:12.290

对于更高级的 html 构建，您可能需要使用 xsl:element 标签：

```
 <xsl:element name="a">
    <xsl:attribute name="href">http://www.stackoverflow.com</xsl:attribute>
    Click here
  </xsl:element> 
```

渲染

```
<a href="http://www.stackoverflow.com">Click here</a> 
```

这样做的好处是任何“名称”属性或内部文本的值都可以计算 xsl 值。

# vb.net - 易于更新应用程序的架构

> ID：166843
> 
> 赞同：1
> 
> 时间：2008-10-03T13:28:58.647
> 
> 标签：vb.net, architecture, vb6

我有一个系统可以将计算应用于一组数字（具体细节并不相关）。系统用户可以应用许多计算集，并且经常添加新集。目前，当需要将一组新的计算添加到系统中时，它们会添加到代码库中并发布新版本的系统。我希望能够在系统中添加新的计算集，而不必发布一个全新的版本，并且让这些新的计算自动对系统用户可见。目前，为每组计算创建一个新函数，并将包含适当函数名称的记录添加到系统表中。这些记录对系统用户可见（函数名称当然是别名！）然后从列表中选择它们。

这是我继承的一个 VB6/Access 应用程序，目前正在用 VB.NET 和 SQL Server 重写。

有人对如何最好地做到这一点有任何建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T13:33:32.443

由于您在.Net 中重做，只需将计算放入插件中即可。使用反射在运行时加载和检查这些程序集并向用户呈现函数。

Divil 有一篇关于编写基于插件的应用程序的好文章（但现在相当老了）。它会帮助你：[http](http://divil.co.uk/net/articles/plugins/plugins.asp) ://divil.co.uk/net/articles/plugins/plugins.asp （+它在VB.Net中）

如果你这样做，你所要做的就是将一个 dll 放到正确的目录中，它就可以工作了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T13:44:33.843

如果您使用的是一组标准的数学函数，则可以使用允许用户在文本框中编写自己的数学函数。

然后使用语法解析器，例如：[TinyPG on CodeProject](http://www.codeproject.com/KB/recipes/TinyPG.aspx)

有了这个，您可以将表达式分解为：[Reverse Polish Notation](http://en.wikipedia.org/wiki/Reverse_Polish_Notation)
这可以很容易地从数据库中的 varchar 字段中存储和调用。

设置完成后，您无需重新发布应用程序，除非您需要添加新的数学功能。

# .net - 如何在.NET 中等待另一个进程的状态？

> ID：166844
> 
> 赞同：3
> 
> 时间：2008-10-03T13:29:24.870
> 
> 标签：.net, synchronization, process

我正在.NET 中进行集成测试项目。测试框架可执行文件启动服务，然后需要等待服务完成操作。

exe等待服务完成其任务的最佳方法是什么（服务本身不会在任务完成后退出）？

两个进程都可以访问同一个数据库，所以我首先想到的是一个记录服务状态的简单表。一旦收到完成的信号，exe 就可以停止等待并完成其任务。其他方法？

让我重申一下，服务一旦完成其任务，将保持在运行/内存状态，因此等待它退出是行不通的。;-)

此外，这纯粹是出于集成测试的目的，永远不会投入生产，所以“简单”是有效的词。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T13:45:55.680

您可以`Semaphore`在命令行上将名称传递给服务（或通过其他机制，如*硬编码*），然后`Release()`通过调用`WaitOne()`您的 exe 来等待服务。

应用代码：

```
Semaphore s = new Semaphore(1, 1, "MyNamedSemaphore");
// start service, passing the string "MyNamedSemaphore"
s.WaitOne(); // will wait for Release() in service 
```

服务代码：

```
// perform the initial task
// find semaphore name (i.e. from Environment.CommandLine)
Semaphore s = new Semaphore(1, 1, semaphoreName); // will use existing kernel object
s.Release(); // WaitOne in exe will complete 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T13:37:21.080

WMI 调用应该可以满足您的需求。您可以捕捉开始/结束的事件并从那里做您需要做的事情。（感谢 Chris Lively 向我展示了这个）

[http://weblogs.asp.net/whaggard/archive/2006/02/11/438006.aspx](http://weblogs.asp.net/whaggard/archive/2006/02/11/438006.aspx)

或者，您可以使用 System.Diagnostics.Processes 命名空间来查询一个特定的活动进程，并循环直到该进程被杀死。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T13:50:47.997

可以修改服务代码吗？

如果是这样，请使用内核事件对象 - 服务可以创建一个，您的应用程序可以等待它发出信号，并且服务可以在完成时发出信号。您必须为事件命名才能跨进程使用，但这很简单。该服务甚至可以在存在事件代码的情况下继续运行，除非他们尝试创建具有相同名称的事件，否则不会有人注意到。（或者，您的 testapp 可以创建事件，然后服务可以尝试打开它，这取决于哪个先启动。如果成功，它可以执行其触发，否则它照常工作）。

提示：您需要一个自动重置事件，它会立即“翻转”其状态并触发所有等待线程。

我不确定 .NET 例程，但您需要 Win32 CreateEvent、SetEvent 和 WaitForSingleObject。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T13:36:45.433

您可以使用 IPC 频道：[https ://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6143016.html](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6143016.html)

或者可能是两种远程处理方式：http: [//www.codeproject.com/KB/IP/TwoWayRemoting.aspx](http://www.codeproject.com/KB/IP/TwoWayRemoting.aspx)

数据库路线很*简单*，但不一定是最好的。

# c# - C# preg_replace？

> ID：166855
> 
> 赞同：2
> 
> 时间：2008-10-03T13:30:59.127
> 
> 标签：c#, .net, .net-2.0, preg-replace

C# 中的 PHP preg_replace 是什么？

我有一个字符串数组，我想用另一个字符串数组替换它。这是 PHP 中的一个示例。在不使用 .Replace("old","new") 的情况下，如何在 C# 中执行类似的操作。

```
$patterns[0] = '/=C0/';
$patterns[1] = '/=E9/';
$patterns[2] = '/=C9/';

$replacements[0] = 'à';
$replacements[1] = 'é';
$replacements[2] = 'é';
return preg_replace($patterns, $replacements, $text); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-03T13:44:22.750

真正的男人使用正则表达式，但如果需要，这里有一个扩展方法，可以将它添加到 String 中：

```
public static class ExtensionMethods
{
    public static String PregReplace(this String input, string[] pattern, string[] replacements)
    {
        if (replacements.Length != pattern.Length)
            throw new ArgumentException("Replacement and Pattern Arrays must be balanced");

        for (var i = 0; i < pattern.Length; i++)
        {
            input = Regex.Replace(input, pattern[i], replacements[i]);                
        }

        return input;
    }
} 
```

你像这样使用它：

```
 class Program
    {
        static void Main(string[] args)
        {
            String[] pattern = new String[4];
            String[] replacement = new String[4];

            pattern[0] = "Quick";
            pattern[1] = "Fox";
            pattern[2] = "Jumped";
            pattern[3] = "Lazy";

            replacement[0] = "Slow";            
            replacement[1] = "Turtle";
            replacement[2] = "Crawled";
            replacement[3] = "Dead";

            String DemoText = "The Quick Brown Fox Jumped Over the Lazy Dog";

            Console.WriteLine(DemoText.PregReplace(pattern, replacement));
        }        
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T13:44:23.953

您可以使用 .Select()（在 .NET 3.5 和 C# 3 中）来简化将函数应用于集合成员的过程。

```
stringsList.Select( s => replacementsList.Select( r => s.Replace(s,r) ) ); 
```

您不需要正则表达式支持，您只需要一种简单的方法来迭代数组。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T15:00:10.773

```
public static class StringManipulation
{
    public static string PregReplace(string input, string[] pattern, string[] replacements)
    {
        if (replacements.Length != pattern.Length)
            throw new ArgumentException("Replacement and Pattern Arrays must be balanced");

        for (int i = 0; i < pattern.Length; i++)
        {
            input = Regex.Replace(input, pattern[i], replacements[i]);                
        }

        return input;
    }
} 
```

这是我将使用的。Jonathan Holland 的一些代码，但不是在 C#3.5 中，而是在 C#2.0 中:)

谢谢大家。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-03T13:36:40.457

您正在寻找`System.Text.RegularExpressions`；

```
using System.Text.RegularExpressions;

Regex r = new Regex("=C0");
string output = r.Replace(text); 
```

要以您的方式获得 PHP 的数组行为，您需要多个 `Regex 实例

但是，在您的示例中，.Replace(old, new) 会为您提供更好的服务，它比编译状态机要快得多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T14:24:06.867

**编辑：呃，我刚刚意识到这个问题是针对 2.0 的，但如果你确实可以访问 3.5，我会留下它。**

只是对 Linq 的另一种看法。现在我使用 List<Char> 而不是 Char[] 但这只是为了让它看起来更干净一些。数组上没有 IndexOf 方法，但 List 上有一个。为什么我需要这个？好吧，从我的猜测来看，替换列表和要替换的列表之间没有直接关联。只是索引。

所以考虑到这一点，你可以用 Char[] 来做这件事。但是当你看到 IndexOf 方法时，你必须在它之前添加一个 .ToList() 。

像这样： someArray.ToList().IndexOf

```
  字符串文本；
  List<Char> patternsToReplace;
  List<Char> patternsToUse;

  patternsToReplace = new List<Char>();
  patternsToReplace.Add('a');
  patternsToReplace.Add('c');
  patternsToUse = new List<Char>();
  patternsToUse.Add('X');
  patternsToUse.Add('Z');

  text = "这是一个可以替换的东西";

  var allAsAndCs = text.ToCharArray()
                 。选择
                 (
                   currentItem => patternsToReplace.Contains(currentItem)
                     ? patternsToUse[patternsToReplace.IndexOf(currentItem)]
                     ：当前项目
                 )
                 .ToArray();

  文本 = 新字符串（allAsAndCs）；

```

这只是将文本转换为字符数组，通过每一个进行选择。如果当前字符不在替换列表中，则按原样发回字符。如果它在替换列表中，则返回替换字符列表相同索引中的字符。最后一件事是从字符数组创建一个字符串。

```
  使用系统；
  使用 System.Collections.Generic；
  使用 System.Linq；

```

# windows - 放置应用程序数据的最佳位置？

> ID：166876
> 
> 赞同：7
> 
> 时间：2008-10-03T13:33:49.917
> 
> 标签：windows, windows-vista, windows-xp, filesystems

> **可能重复：**
> [VS2008 安装项目：共享（由所有用户）应用程序数据文件？](https://stackoverflow.com/questions/76760/vs2008-setup-project-shared-by-all-users-application-data-files)

请有人建议放置一些应由所有用户访问和编辑的应用程序数据的最佳位置（路径）是什么。

这是考虑到 Windows XP 和 Windows Vista，我希望上述路径的任何文件的更改都不会触发 UAC！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T13:39:56.847

普通 Win API：[SHGetFolderPath](http://msdn.microsoft.com/en-us/library/bb762181.aspx)文件夹`CSIDL_COMMON_APPDATA`类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T13:35:34.517

```
Environment.GetFolderPath(Environment.SpecialFolder.CommonApplicationData) 
```

应解析为 C:\Documents and Settings\All Users\Application Data\

从那里，创建子文件夹，例如 MyCompany\MyApp

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T13:36:15.590

[VS2008 安装项目：共享（由所有用户）应用程序数据文件？](https://stackoverflow.com/questions/76760/vs2008-setup-project-shared-by-all-users-application-data-files)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-31T11:06:01.780

> 如果您使用的是 .NET，Application.CommonAppDataPath 应该可以工作。还要确保为您的应用程序关闭虚拟化

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T13:37:38.363

%ALLUSERSPROFILE%\Application Data\App
这可能是所有用户无需提升权限即可访问的唯一目录。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T13:38:06.337

如果您使用的是 .NET，Application.CommonAppDataPath 应该可以工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-03T13:41:43.693

如果用户不打算直接修改数据，只会由应用程序修改，那么IsolatedStorage怎么样 - [http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx](http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-10T13:39:00.983

Checkers 提供了在 C 或 C++ 中执行此操作的重要线索。所以我投票给了他的答案。

以下是他遗漏的细节：

```
// assumes
// company is a pointer to a character sting containing company name
// appname is a pointer to a character string containing application name
// fname   is a pointer to a character string cintaining name of file to be created

#include <shlobj.h>   // for SHGetFolderPath
#include <direct.h>   // for _mkdir

char path[MAX_PATH];
SHGetFolderPath(NULL,CSIDL_COMMON_APPDATA,NULL,NULL,path);
strcat(path,"/");
strcat(path,company);
_mkdir(path);
strcat(path,"/");
strcat(path,appname);
_mkdir(path);
strcat(path,"/");
strcat(path,fname);

// path is now a character string which can passed to fopen 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-31T11:09:01.337

您也可以将其放入数据库中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-20T17:12:52.257

对于 Vista 及更高版本，MS 似乎正在推动使用[SHGetKnownFolderPath()](http://msdn.microsoft.com/en-us/library/windows/desktop/bb762188%28v=vs.85%29.aspx)而不是[SHGetFolderPath()](http://msdn.microsoft.com/en-us/library/windows/desktop/bb762181%28v=vs.85%29.aspx)。[从KNOWNFOLDERIDs 列表中](http://msdn.microsoft.com/en-us/library/windows/desktop/dd378457%28v=vs.85%29.aspx)选择要请求的文件夹。根据此处的答案，您想要的等价物可能是`FOLDERID_ProgramData`. 我意识到这个问题已经很老了，但我想出于存档目的..

# arrays - 数组与链表

> ID：166884
> 
> 赞同：211
> 
> 时间：2008-10-03T13:35:53.110
> 
> 标签：arrays, data-structures, linked-list, language-agnostic

为什么有人要在数组上使用链表？

毫无疑问，对链表进行编码比使用数组需要更多的工作，而且人们可能想知道什么是额外努力的合理性。

我认为在链表中插入新元素是微不足道的，但它是数组中的一项主要工作。使用链表存储一组数据与将其存储在数组中相比，还有其他优势吗？

这个问题不是[这个](https://stackoverflow.com/questions/322715/when-to-use-linkedlist-over-arraylist)问题的重复，因为另一个问题是专门询问一个特定的 Java 类，而这个问题是关于一般数据结构的。

* * *

## 回答 #1

> 赞同：188
> 
> 时间：2008-10-03T13:59:08.167

另一个很好的理由是链表非常适合高效的多线程实现。这样做的原因是更改往往是本地的 - 仅影响在数据结构的本地部分插入和删除的一两个指针。因此，您可以让许多线程在同一个链表上工作。更重要的是，可以使用 CAS 类型的操作创建无锁版本并完全避免重量级锁。

使用链表，迭代器也可以在修改发生时遍历链表。在修改不会发生冲突的乐观情况下，迭代器可以继续进行而不会发生争用。

对于数组，任何修改数组大小的更改都可能需要锁定数组的大部分，事实上，在整个数组没有全局锁定的情况下很少这样做，因此修改成为停止世界事务。

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2008-10-03T13:40:05.723

*   在链表中存储不同大小的数据更容易。数组假定每个元素的大小完全相同。
*   正如您所提到的，链表更容易有机地增长。数组的大小需要提前知道，或者在需要增长时重新创建。
*   洗牌一个链表只是改变什么指向什么的问题。洗牌数组更复杂和/或占用更多内存。
*   只要您的迭代都发生在“foreach”上下文中，您就不会在迭代中失去任何性能。

* * *

## 回答 #3

> 赞同：134
> 
> 时间：2008-10-03T13:48:54.380

维基百科有很好的关于差异的部分。

> 与数组相比，链表有几个优点。元素可以无限期地插入到链表中，而数组最终会填满或需要调整大小，如果内存碎片化，甚至可能无法进行这种昂贵的操作。类似地，从其中删除了许多元素的数组可能会变得浪费地为空或需要变得更小。
> 
> 另一方面，数组允许随机访问，而链表只允许顺序访问元素。实际上，单链表只能在一个方向上遍历。这使得链表不适用于通过索引快速查找元素很有用的应用程序，例如堆排序。由于引用和数据缓存的局部性，对数组的顺序访问也比在许多机器上的链表上更快。链表几乎没有从缓存中获得任何好处。
> 
> 链表的另一个缺点是引用需要额外的存储空间，这通常使得它们对于诸如字符或布尔值之类的小数据项的列表是不切实际的。它也可能很慢，并且使用幼稚的分配器，浪费，为每个新元素单独分配内存，通常使用内存池解决问题。

[http://en.wikipedia.org/wiki/Linked_list](http://en.wikipedia.org/wiki/Linked_list)

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2008-10-03T15:33:47.523

我将添加另一个 - 列表可以充当[纯粹的函数](http://en.wikipedia.org/wiki/Purely_functional#Linked_lists)式数据结构。

例如，您可以让完全不同的列表共享相同的结尾部分

```
a = (1 2 3 4, ....)
b = (4 3 2 1 1 2 3 4 ...)
c = (3 4 ...) 
```

IE：

```
b = 4 -> 3 -> 2 -> 1 -> a
c = a.next.next 
```

无需将指向的数据复制`a`到`b`and`c`中。

这就是为什么它们在使用不可变变量的函数式语言中如此受欢迎的原因——`prepend`并且`tail`操作可以自由发生而无需复制原始数据——当您将数据视为不可变时，这是非常重要的特性。

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2008-10-03T13:39:11.107

除了插入到列表中间更容易 - 从链表中间删除也比数组更容易。

但坦率地说，我从未使用过链表。每当我需要快速插入和删除时，我也需要快速查找，所以我使用了 HashSet 或 Dictionary。

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2008-10-03T13:45:44.230

合并两个链表（尤其是两个双向链表）比合并两个数组要快得多（假设合并是破坏性的）。前者需要 O(1)，后者需要 O(n)。

**编辑：**为了澄清，我的意思是无序意义上的“合并”，而不是合并排序。也许“连接”会是一个更好的词。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2009-11-01T06:17:32.690

一个广为人知的反对 ArrayList 和反对 LinkedList 的论点是**LinkedList 在调试时不舒服**。维护开发人员花在理解程序上的时间，例如发现错误，增加了，恕我直言，有时不能证明企业应用程序中性能改进的纳秒或内存消耗的字节数是合理的。有时（嗯，当然这取决于应用程序的类型），最好浪费几个字节，但有一个更易于维护或更容易理解的应用程序。

例如，在 Java 环境中并使用 Eclipse 调试器，调试 ArrayList 将显示一个非常容易理解的结构：

```
arrayList   ArrayList<String>
  elementData   Object[]
    [0] Object  "Foo"
    [1] Object  "Foo"
    [2] Object  "Foo"
    [3] Object  "Foo"
    [4] Object  "Foo"
    ... 
```

另一方面，查看 LinkedList 的内容并查找特定对象变成了点击展开树的噩梦，更不用说过滤掉 LinkedList 内部所需的认知开销了：

```
linkedList  LinkedList<String>
    header  LinkedList$Entry<E>
        element E
        next    LinkedList$Entry<E>
            element E   "Foo"
            next    LinkedList$Entry<E>
                element E   "Foo"
                next    LinkedList$Entry<E>
                    element E   "Foo"
                    next    LinkedList$Entry<E>
                    previous    LinkedList$Entry<E>
                    ...
                previous    LinkedList$Entry<E>
            previous    LinkedList$Entry<E>
        previous    LinkedList$Entry<E> 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2008-10-03T13:51:34.077

首先，在 C++ 中，链表不应该比数组更麻烦。您可以将[std::list](http://www.sgi.com/tech/stl/List.html)或[boost 指针列表](http://www.boost.org/doc/libs/release/libs/ptr_container/doc/ptr_list.html)用于链表。链表与数组的关键问题是指针和可怕的随机访问所需的额外空间。如果你应该使用链表

*   您不需要随机访问数据
*   您将添加/删除元素，尤其是在列表中间

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2010-10-30T10:57:19.910

对我来说是这样的，

1.  使用权

    *   **链表**只允许顺序访问元素。因此算法复杂度为 O(n)
    *   **数组**允许随机访问其元素，因此复杂度为 O(1)
2.  贮存

    *   **链接列表**需要额外的存储空间来存储引用。这使得它们对于诸如字符或布尔值之类的小数据项列表是不切实际的。
    *   **数组**不需要额外的存储来指向下一个数据项。每个元素都可以通过索引访问。
3.  尺寸

    *   **链表**的大小本质上是动态的。
    *   **数组**的大小仅限于声明。
4.  插入/删除

    *   **可以在链表中**无限地 插入和删除元素。
    *   **在数组**中插入/删除值非常昂贵。它需要重新分配内存。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2008-10-03T13:53:43.403

两件事情：

> 毫无疑问，对链表进行编码比使用数组需要更多的工作，他想知道如何证明额外的努力是合理的。

使用 C++ 时切勿编写链表。只需使用 STL。实现的难度绝不应该成为选择一种数据结构而不是另一种的理由，因为大多数数据结构已经实现了。

至于数组和链表之间的实际区别，对我来说最重要的是您计划如何使用该结构。我将使用术语向量，因为这是 C++ 中可调整大小数组的术语。

对链表进行索引很慢，因为您必须遍历列表才能找到给定的索引，而向量在内存中是连续的，您可以使用指针数学到达那里。

附加到链表的末尾或开头很容易，因为您只需更新一个链接，在向量中您可能需要调整大小并复制内容。

从列表中删除项目很容易，因为您只需断开一对链接，然后将它们重新连接在一起。从向量中删除一个项目可能更快或更慢，这取决于您是否关心订单。将最后一个项目交换到您要删除的项目之上会更快，而在它向下移动之后的所有内容会更慢但保留顺序。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2008-10-03T13:40:22.540

Eric Lippert 最近发表了一篇关于应该保守使用数组的原因之一的[帖子。](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-10-03T13:43:13.953

快速插入和删除确实是链表的最佳论据。如果您的结构动态增长并且不需要对任何元素进行恒定时间访问（例如动态堆栈和队列），那么链表是一个不错的选择。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2008-10-03T13:39:24.057

这是一个快速的：删除项目更快。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2008-10-03T13:41:56.313

除了从列表中间添加和删除之外，我更喜欢链表，因为它们可以动态增长和收缩。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2008-10-03T13:46:02.560

当集合不断增长和缩小时，链表特别有用。例如，很难想象尝试使用数组来实现一个队列（添加到末尾，从前面删除）——您将把所有的时间都花在向下移动上。另一方面，它对于链表来说是微不足道的。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2008-10-03T13:51:01.847

再也没有人编写自己的链表了。那会很愚蠢。使用链表需要更多代码的前提是错误的。

这些天来，建立一个链接列表只是学生的一个练习，以便他们能够理解这个概念。相反，每个人都使用预先构建的列表。在 C++ 中，根据我们问题中的描述，这可能意味着一个 stl 向量 ( `#include <vector>`)。

因此，选择链表与数组*完全*是权衡每个结构的不同特征与您的应用程序的需求相关。克服额外的编程负担对决策的影响应该为零。

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2012-12-26T22:40:44.000

数组与链表：

1.  数组内存分配有时会因为内存碎片而失败。
2.  数组中的缓存更好，因为所有元素都分配了连续的内存空间。
3.  编码比数组更复杂。
4.  与数组不同，链表没有大小限制
5.  链表中的插入/删除速度更快，数组中的访问速度更快。
6.  从多线程的角度来看，链表更好。

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2008-10-03T13:51:18.947

这实际上是一个效率问题，在链表中插入、删除或移动（不是简单地交换）元素的开销是最小的，即操作本身是 O(1)，而数组是 O(n)。如果您对数据列表进行大量操作，这可能会产生重大影响。您根据您将如何操作它们来选择您的数据类型，并为您使用的算法选择最有效的。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2008-10-03T14:08:35.387

数组在项目的确切数量已知的情况下是有意义的，在按索引搜索的情况下是有意义的。例如，如果我想在给定时刻存储视频输出的确切状态而不进行压缩，我可能会使用大小为 [1024][768] 的数组。这将为我提供我所需要的确切信息，并且获取给定像素的值的列表会慢得多。在数组没有意义的地方，通常有比列表更好的数据类型来有效地处理数据。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2009-08-30T13:57:42.960

由于数组本质上是静态的，因此内存分配等所有操作仅在编译时发生。所以处理器必须在其运行时付出更少的努力。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2010-07-26T04:40:43.243

假设您有一个有序集，您还想通过添加和删除元素来修改它。此外，您需要能够保留对元素的引用，以便以后可以获取上一个或下一个元素。例如，待办事项列表或书中的一组段落。

首先我们应该注意，如果您想保留对集合本身之外的对象的引用，您最终可能会将指针存储在数组中，而不是存储对象本身。否则，您将无法插入数组 - 如果对象嵌入到数组中，它们将在插入期间移动，并且指向它们的任何指针都将变为无效。数组索引也是如此。

正如您自己所指出的，您的第一个问题是插入 - 链表允许在 O(1) 中插入，但数组通常需要 O(n)。这个问题可以部分克服——可以创建一个数据结构，提供类似数组的按序访问接口，其中读取和写入在最坏的情况下都是对数的。

您的第二个也是更严重的问题是，给定一个元素找到下一个元素是 O(n)。如果集合没有被修改，你可以保留元素的索引作为引用而不是指针，从而使 find-next 成为 O(1) 操作，但你所拥有的只是一个指向对象本身的指针，没有办法确定其在数组中的当前索引，而不是通过扫描整个“数组”。这对于数组来说是一个无法克服的问题——即使你可以优化插入，也无法优化 find-next 类型的操作。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2010-08-29T11:42:10.373

在数组中，您有权在 O(1) 时间内访问任何元素。因此它适用于二进制搜索快速排序等操作。另一方面，链表适用于插入删除，因为它在 O(1) 时间内。两者都有优点和缺点，并且更喜欢一个而不是另一个归结为您想要实现的内容。

-- 更大的问题是我们能否将两者混合使用。类似于 python 和 perl 实现为列表的东西。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2013-08-30T19:31:15.743

链表

当涉及到插入时，它更可取！基本上它的作用是处理指针

1 -> 3 -> 4

插入 (2)

1............3......4
......2

最后

1 -> 2 -> 3 -> 4

从 2 点到 3 的一个箭头和从 1 点到 2 的箭头

简单的！

但是从数组

| 1 | 3 | 4 |

插入 (2) | 1 | 3 | | 4 | | 1 | | 3 | 4 | | 1 | 2 | 3 | 4 |

好吧，任何人都可以想象其中的区别！仅针对 4 个索引，我们执行 3 个步骤

如果数组长度是一百万呢？阵列有效吗？答案是不！:)

删除也是一样！在链表中，我们可以简单地使用指针并在对象类中使元素和下一个无效！但是对于数组，我们需要执行 shiftLeft()

希望有帮助！:)

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2015-07-29T06:01:31.740

Linked List 比数组更需要维护，它还需要额外的内存存储所有这些点都是一致的。但是有一些事情是数组无法做到的。在许多情况下，假设您想要一个长度为 10^9 的数组，您无法获得它，因为必须在那里获得一个连续的内存位置。链接列表可能是这里的救星。

假设你想用数据存储多个东西，那么它们可以很容易地在链表中扩展。

STL 容器通常在幕后实现链表。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2019-10-12T09:06:05.840

**1-**链表是一种动态数据结构，因此它可以通过分配和释放内存在运行时增长和缩小。所以不需要给出链表的初始大小。节点的插入和删除真的很容易。

**2-**链表的大小可以在运行时增加或减少，因此没有内存浪费。在数组的情况下，有很多内存浪费，比如如果我们声明一个大小为 10 的数组并在其中只存储 6 个元素，则浪费了 4 个元素的空间。链表中没有这样的问题，因为只有在需要时才分配内存。

**3-**使用链表可以轻松实现堆栈和队列等数据结构。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2008-10-03T14:09:26.163

使用链表的唯一原因是插入元素很容易（也可以删除）。

缺点可能是指针占用大量空间。

关于那个编码更难：通常你不需要代码链表（或只需要一次）它们包含在 [STL](http://www.cplusplus.com/reference/stl/)中 ，如果你仍然必须这样做，它并不那么复杂。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-10-27T06:59:00.290

我也认为链接列表比数组更好。因为我们在链表中遍历而不是在数组中遍历

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2012-06-20T17:45:30.193

根据您的语言，可以考虑以下一些缺点和优点：

*C 编程语言*：使用链表（通常通过结构指针）时，必须特别注意确保您没有泄漏内存。如前所述，链表很容易洗牌，因为所做的只是改变指针，但我们会记住释放所有东西吗？

*Java*：Java 具有自动垃圾收集功能，因此内存泄漏不会成为问题，但对高级程序员隐藏的是链表的实现细节。诸如从列表中间删除一个节点之类的方法比该语言的某些用户所期望的要复杂得多。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2015-07-09T21:01:19.517

为什么在数组上使用链表？正如一些人已经说过的，插入和删除的速度更快。

但也许我们不必忍受两者的限制，同时获得两者的最佳……嗯？

对于数组删除，您可以使用“已删除”字节来表示已删除行的事实，因此不再需要重新组织数组。为了减轻插入或快速更改数据的负担，请为此使用链表。然后在引用它们时，让你的逻辑先搜索一个，然后再搜索另一个。因此，结合使用它们可以为您带来两全其美的效果。

如果你有一个非常大的数组，你可以将它与另一个小得多的数组或链表结合起来，其中较小的一个包含 20、50、100 个最近使用的项目。如果需要的不在较短的链表或数组中，则转到大数组。如果在那里找到，您可以将其添加到较小的链表/数组中，假设“最近使用的东西最有可能被重复使用”（是的，可能会从列表中碰撞最近最少使用的项目）。这在许多情况下都是正确的，并且解决了我必须在 .ASP 安全权限检查模块中解决的问题，轻松、优雅和令人印象深刻的速度。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2016-09-28T05:35:22.550

虽然你们中的许多人都谈到了链表与数组的主要 adv./dis，但大多数比较是一个比另一个更好/更差的比较。例如。您可以在数组中进行随机访问，但在链表等中则不可能。但是，这是假设链接列表和数组将应用于类似的应用程序中。然而，正确的答案应该是在特定的应用程序部署中链接列表如何优于数组，反之亦然。假设你想实现一个字典应用程序，你会用什么？数组：嗯，它可以通过二进制搜索和其他搜索算法轻松检索......但让我们想想链接列表如何更好......假设你想在字典中搜索“Blob”。有一个 A->B->C->D----> 的链接列表是否有意义

```
A -> B -> C -> ...Z
|    |    |
|    |    [Cat, Cave]
|    [Banana, Blob]
[Adam, Apple] 
```

现在是上述方法更好还是 [Adam,Apple,Banana,Blob,Cat,Cave] 的平面数组？甚至可以使用 array 吗？所以链接列表的一个主要优点是你可以让一个元素不仅指向下一个元素，还可以指向其他链接列表/数组/堆/或任何其他内存位置。数组是一个平坦的连续内存，它被分割成它要存储的元素的块大小。另一方面，链接列表是一块非连续的内存单元（可以是任何大小并且可以存储任何东西）并指向每个其他你想要的方式。同样，假设您正在制作 USB 驱动器。现在您希望将文件保存为任何数组还是链接列表？我想你明白我的意思了:)

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2017-12-07T13:44:50.037

> 为什么有人要在数组上使用链表？

这只是一个原因 - 如果您需要链表数据结构并且您使用的编程语言不支持指针。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2019-05-12T11:53:20.780

除了插入和删除方便之外，链表的内存表示方式与数组不同。链表中的元素数量没有限制，而在数组中，您必须指定元素的总数。检查[这篇](https://computer-fundamentals.com/difference-between-linked-list-and-array/)文章。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2011-09-05T17:16:47.727

使用链接列表的人必须阅读。人们会再次爱上阵列。它讨论了乱序执行、硬件预取、内存延迟等。

[http://www.futurechips.org/thoughts-for-researchers/quick-post-linked-lists.html](http://www.futurechips.org/thoughts-for-researchers/quick-post-linked-lists.html)

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2019-03-14T12:11:17.110

数组和链表的区别在于数组是基于索引的数据结构，每个元素都与索引相关联，而链表是使用引用的数据结构，每个节点都引用另一个节点。在数组中大小是固定的，而在链接列表中大小是不固定的。

# java - 不同构建配置文件的不同依赖项

> ID：166895
> 
> 赞同：125
> 
> 时间：2008-10-03T13:37:42.920
> 
> 标签：java, maven-2, build-process, dependencies

对于不同的配置文件，maven pom.xml 文件中是否可以有一组不同的依赖项？

例如

```
mvn -P debug
mvn -P release 
```

我想在一个配置文件中选择一个不同的依赖 jar 文件，该文件具有相同的类名和相同接口的不同实现。

* * *

## 回答 #1

> 赞同：192
> 
> 时间：2008-10-03T14:57:41.277

引用[Maven 文档](http://maven.apache.org/pom.html#Profiles)：

> 配置文件元素包含可选的激活（配置文件触发器）和如果该配置文件已被激活则要对 POM 进行的更改集。例如，为测试环境构建的项目可能指向与最终部署不同的数据库。*或者，可以根据使用的 JDK 版本从不同的存储库中提取依赖项*。

（重点是我的）

只需将配置文件的依赖项放在`release`配置文件声明本身中，并对`debug`.

```
<个人资料>
    <个人资料>
        <id>调试</id>
        …
        <依赖项>
            <依赖>…</依赖>
        </依赖>
        …
    </profile>
    <个人资料>
        <id>发布</id>
        …
        <依赖项>
            <依赖>…</依赖>
        </依赖>
        …
    </profile>
</profiles>

```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-21T06:10:02.483

您的 groupId、artifactId 应该在您的配置文件中标记为属性，您可以将依赖项移动到通用部分。

# jsf - 在 JSF 中格式化双精度

> ID：166897
> 
> 赞同：11
> 
> 时间：2008-10-03T13:37:52.873
> 
> 标签：jsf, formatting, decimal

我有一个与此处发现的问题类似的问题：[JSF selectItem label formatting](https://stackoverflow.com/questions/86531/jsf-selectitem-label-formatting)。

我想要做的是接受一个双精度值作为我的值并用两位小数显示。这可以通过简单的方式完成吗？

我尝试过使用，但这似乎适用于发送到服务器的 inputText 的值，而不是输入字段中的初始值。

到目前为止我的代码：

```
<h:inputText id="december" value="#{budgetMB.december}" onchange="setDirty()" styleClass="StandardBlack">
    <f:convertNumber maxFractionDigits="2" groupingUsed="false" />
</h:inputText> 
```

编辑：上面的代码确实有效。我被 JDeveloper 愚弄了，即使我对项目进行了显式重建并重新启动了嵌入式 OC4J 服务器，它也没有更新 jsp 页面。但是，重新启动计算机后，一切都很好。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-03T17:53:15.290

如果我没有误解您的要求，我可以在渲染视图期间实现输入框中值的格式化：

```
<h:inputText id="text1" value="#{...}">
    <f:convertNumber pattern="#,###,##0.00"/>
</h:inputText> 
```

我在供应商品牌的 Eclipse 中使用标准面孔组件，所以我假设该`pattern`属性是标准 JSF 的一部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T19:15:10.617

如果您要尝试在屏幕上更改输入文本字段的值（以更正用户输入），您可能应该考虑使用 JSF ajax 框架之一，例如[Rich Faces](http://livedemo.exadel.com/richfaces-demo/richfaces/support.jsf?c=support&tab=usage)。

一个可能的示例如下所示：

```
<h:inputText id="december" value="#{budgetMB.december}" styleClass="StandardBlack">
  <f:convertNumber maxFractionDigits="2" groupingUsed="false" />
  <a4j:support event="onblur" reRender="december" />
</h:inputText> 
```

我没有对此进行测试，但我认为它可能会起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-12T04:41:58.690

看来您实际上是在格式化货币。已经存在一个特定的格式化程序来处理您可以分配许多选项的货币：

```
<f:convertNumber type="currency" /> 
```

这个标签的一些有趣的属性是：`locale`、`currencyCode`、`integerOnly`和。`currencySymbol``pattern`

# php - 如何让 Selenium 在 Linux 上与 PHP/Firefox3 一起工作

> ID：166941
> 
> 赞同：6
> 
> 时间：2008-10-03T13:44:24.687
> 
> 标签：php, testing, selenium, firefox-3

我试图让[Selenium RC](http://selenium-rc.openqa.org/tutorial.html)在 Linux 上使用 PHP/Apache 与 Firefox 3 一起工作，但我遇到了问题。这是我所做的：

*   我已经安装了 Firefox Selenium-IDE 扩展。
*   在 Web 服务器上（在我的情况下，它实际上是运行 Firefox 的同一台机器），我已经启动了 Selenium 服务器：java -jar selenium-server.jar -interactive
*   我有一个 PHP 脚本如下：

PHP：

```
require_once 'Testing/Selenium.php';

$browser = new Testing_Selenium("*custom /usr/lib/firefox-3.0.3/firefox", "https://www.example.com");
$browser->start(); 
```

当我运行 PHP 脚本时，它会启动一个新的 Firefox 选项卡，但**我收到以下错误消息**：

```
The requested URL /selenium-server/core/RemoteRunner.html was not found on this server. 
```

我在 Firefox 2 上取得了更大的成功（通过使用`"*firefox"`而不是`"*custom"`但不想在我当前的项目中使用它。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-03T21:24:12.293

我不确定回答您自己的问题的礼仪......但是通过反复试验的方式进行了试验，这就是我设法让 Selenium 在 Ubuntu 上与 PHP/Firefox3 一起工作的方法。

1.  我下载了 RC 并将 php 客户端目录复制到 /usr/share/php 作为“Selenium”
2.  我导航到下载中的 Selenium Server 目录，并使用`java -jar selenium-server.jar`
3.  我创建了一个新的 Firefox 配置文件（通过运行 firefox -ProfileManager）。我将新的配置文件称为“Selenium”
4.  在该配置文件中，我编辑 Firefox 网络首选项以通过 localhost 端口 4444 代理所有协议。
5.  我创建了我的 php 脚本并使用以下命令运行它：

    `php -d include_path=".:/usr/share/php:/usr/share/php/Selenium/PEAR" test.php`

我在下面列出了我的（基本、非 PHPUnit、非 OO）第一个测试脚本以供参考。

```
require_once 'Testing/Selenium.php';

$oSelenium = new Testing_Selenium(
    "*custom /usr/lib/firefox-3.0.3/firefox -P Selenium",
    "https://www.example.com");
$oSelenium->start();

$oSelenium->open("/");

if (!$oSelenium->isElementPresent("id=login_button")) {
        $oSelenium->click("logout");
        $oSelenium->waitForPageToLoad(10000);
        if (!$oSelenium->isElementPresent("id=login_button")) {
                echo "Failed to log out\n\n";
                exit;
        }
}

$oSelenium->type("login", "my_username");
$oSelenium->type("password", "my_password");
$oSelenium->click("login_button");
$oSelenium->waitForPageToLoad(10000);

$oSelenium->click("top_nav_campaigns");

$oSelenium->stop(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-07T08:10:34.243

我使用 phpunit、selenium RC php api 来运行我的测试用例。我的测试用例看起来像

```
 1235$Deepan@Newton~/selenium/ide_scripts$
cat mytest.php
 'FF on linux',
      'browser' => '*firefox',
      'host'    => '10.211.55.8',
      'port'    => 4444,
      'timeout' => 30000,
    ),
    array(
      'name'    => 'FF on windows',
      'browser' => '*firefox',
      'host'    => '10.211.55.5',
      'port'    => 4444,
      'timeout' => 30000,
    ),
     */
    array(
      'name'    => 'Google Chrome on windows',
      'browser' => '*googlechrome',
      'host'    => '10.211.55.5',
      'port'    => 4444,
      'timeout' => 30000,
    ),
    /*
    array(
      'name'    => 'IE on windows',
      'browser' => '*iexplore',
      'host'    => '10.211.55.5',
      'port'    => 4444,
      'timeout' => 30000,
    ),
    array(
      'name'    => 'Safari on MacOS X',
      'browser' => '*safari',
      'host'    => 'localhost',
      'port'    => 4444,
      'timeout' => 30000,
    ),
    array(
      'name'    => 'Firefox on MacOS X',
      'browser' => '*chrome',
      'host'    => 'localhost',
      'port'    => 4444,
      'timeout' => 30000,
    ),
     */
    array(
      'name'    => 'Google Chrome on MacOS X',
      'browser' => '*googlechrome',
      'host'    => 'localhost',
      'port'    => 4444,
      'timeout' => 30000,
    )
  );

  protected function setUp()
  {
    //$this->setBrowser("*chrome");
    $this->setBrowserUrl("http://www.facebook.com/");
  }

  public function testMyTestCase()
  {
    $this->open("/index.php?lh=94730c649368393b6954cb9fc0802e0a&eu=iKjrC7Q2aC-8tcU7PVLilg");
    $this->type("email", "myemail@domain.com");
    $this->type("pass", "mypassword");
    $this->click("persistent");
    $this->click("//input[@type='submit']");
    $this->waitForPageToLoad("30000");
    sleep(10);
    $this->open("http://apps.facebook.com/myapp/");
    sleep(4);
    $this->click("link=Play");
    $this->waitForPageToLoad("30000");
    sleep(4);
    $this->click("navAccountLink");
    sleep(4);
    $this->click("link=Logout");
    $this->waitForPageToLoad("30000");
    sleep(4);
  }
}
?>
1332$Deepan@Newton~/selenium/ide_scripts$
phpunit mytest.php 
```

这将连接到在虚拟机中运行的浏览器

# php - 在 PHP 中调用 Python

> ID：166944
> 
> 赞同：85
> 
> 时间：2008-10-03T13:44:41.003
> 
> 标签：php, python

我有一个我最近编写的 Python 脚本，我使用带有一些选项的命令行调用它。我现在想要一个非常薄的 Web 界面来在我的 Mac 上本地调用这个脚本。

我不想经历在我的 Mac 上安装 mod_python 或 mod_wsgi 的小麻烦，所以我只想从 PHP 中执行 system() 或 popen() 来调用 Python 脚本。

有更好的想法吗？提前致谢！

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-10-03T14:40:12.107

根据您在做什么，[system()](http://php.net/manual/en/function.system.php)或[popen()](http://php.net/manual/en/function.popen.php)可能是完美的。如果 Python 脚本没有输出，或者您希望 Python 脚本的输出直接进入浏览器，请使用 system()。如果要将数据写入 Python 脚本的标准输入，或者从 php.ini 中的 Python 脚本的标准输出读取数据，请使用 popen()。popen() 只会让你读或写，但不能两者兼而有之。如果您想要两者，请查看[proc_open()](http://us.php.net/manual/en/function.proc-open.php)，但是在程序之间进行双向通信时，您需要小心避免死锁，每个程序都在等待另一个程序做某事。

如果您想将用户提供的数据传递给 Python 脚本，那么需要注意的重要事项是命令注入。如果您不小心，您的用户可能会向您发送数据，例如“; evilcommand ;” 并使您的程序违背您的意愿执行任意命令。

[escapeshellarg()](http://www.php.net/manual/en/function.escapeshellarg.php)和[escapeshellcmd()](http://www.php.net/manual/en/function.escapeshellcmd.php)可以帮助解决这个问题，但我个人喜欢删除所有不是已知好字符的东西，使用类似的东西

```
preg_replace('/[^a-zA-Z0-9]/', '', $str) 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2013-09-20T16:01:27.250

反引号运算符还允许您使用与上述类似的语法运行 python 脚本

在名为 python.py 的 python 文件中：

```
hello = "hello"
world = "world"
print hello + " " + world 
```

在名为 python.php 的 php 文件中：

```
$python = `python python.py`;
echo $python; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-07-22T15:33:38.360

您可以通过 php 运行 python 脚本，并在浏览器上输出。

基本上你必须这样调用python脚本：

```
$command = "python /path/to/python_script.py 2>&1";
$pid = popen( $command,"r");
while( !feof( $pid ) )
{
 echo fread($pid, 256);
 flush();
 ob_flush();
 usleep(100000);
}
pclose($pid); 
```

注意：如果您在 python 代码中运行任何 time.sleep()，它不会在浏览器上输出结果。

有关完整代码的工作，请访问[如何从 php 执行 python 脚本并在浏览器上显示输出](http://blog.idealmind.com.br/php/how-to-execute-python-script-from-php-and-show-output-on-browser/ "如何从 php 执行 python 脚本并在浏览器上显示输出")

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-03T14:40:38.690

我一直在为快速而肮脏的脚本做这种事情。拥有一个仅使用 system/popen 调用一些外部程序的 CGI 或 PHP 脚本是很常见的。

如果您的网络服务器对整个互联网开放，请格外小心。在这种情况下，请务必清理您的 GET/POST 输入，以免攻击者在您的计算机上运行任意命令。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-11-01T07:57:06.097

您的 call_python_file.php 应如下所示：

```
<?php
    $item='Everything is awesome!!';
    $tmp = exec("py.py $item");
    echo $tmp;
?> 
```

这将执行 python 脚本并将结果输出到浏览器。在您的 python 脚本中， (sys.argv[1:]) 变量将引入您的所有参数。要将 argv 显示为您的 php 从何处提取的字符串，因此如果您想做一个文本区域：

```
import sys

list1 = ' '.join(sys.argv[1:])

def main():
  print list1

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-10-30T19:00:01.297

上述方法似乎很复杂。以我的方法作为参考。

我有这两个文件

> 运行.php
> 
> mkdir.py

在这里，我创建了一个包含 GO 按钮的 html 页面。每当您按下此按钮时，将在您提到的路径的目录中创建一个新文件夹。

> 运行.php

```
<html>
 <body>
  <head>
   <title>
     run
   </title>
  </head>

   <form method="post">

    <input type="submit" value="GO" name="GO">
   </form>
 </body>
</html>

<?php
    if(isset($_POST['GO']))
    {
        shell_exec("python /var/www/html/lab/mkdir.py");
        echo"success";
    }
?> 
```

> mkdir.py

```
#!/usr/bin/env python    
import os    
os.makedirs("thisfolder"); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-08-09T13:49:27.177

请注意，如果您使用的是虚拟环境（如在共享主机中），那么您必须调整到 python 的路径，例如：`/home/user/mypython/bin/python ./cgi-bin/test.py`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-23T12:47:28.310

如此简单您可以使用 [phpy - php 库][1] php 文件

```
<?php
  require_once "vendor/autoload.php";

  use app\core\App;

  $app = new App();
  $python = $app->python;
  $output = $python->set(your python path)->send(data..)->gen();
  var_dump($ouput); 
```

蟒蛇文件：

```
import include.library.phpy as phpy
print(phpy.get_data(number of data , first = 1 , two =2 ...)) 
```

您还可以在 github 页面 [1] 中查看示例：[https ://github.com/Raeen123/phpy](https://github.com/Raeen123/phpy)

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2016-06-16T23:03:45.307

如果要在 PHP 中执行 Python 脚本，则必须在 php 脚本中执行以下命令：

```
exec('your script python.py') 
```

# c# - WinDbg 不间断地向控制台输出字符

> ID：166945
> 
> 赞同：0
> 
> 时间：2008-10-03T13:44:43.700
> 
> 标签：c#, .net, windbg

我正在开发一个 POS 应用程序，目前在大约 200 个位置使用 .Net 2.0、WCF 和 SyncFusion 组件作为 GUI。

两天前，我们在一个新位置安装了该应用程序，并且该应用程序一直在遭受突然终止。

该应用程序有一个事件和异常的运行日志，所以如果它发生了什么事，日志中总会有一些东西。在这种情况下，日志被简单地切断。我们在其他地方也遇到过类似的情况，但它们非常罕见，而且发生的次数不超过一两次，因此我们无法捕获调试转储。

该位置的计算机的硬件设置略有不同，包括 LPT 输出上的分离器，用于打印到 POS 打印机和在视频监视器上显示输出。

不过，在这个位置，它大约每 1.5 小时发生一次。我尝试打开 WinDbg 并附加到进程，但奇怪的是，在有调试输出的区域，我看到了我的应用程序生成的跟踪消息，但还有一个不间断的字符流，具体来说，“ b0" 重复。

我的问题是我不明白那个“b0”是从哪里来的，它是什么意思。我怀疑它可能是分离器，但我要到星期天才能测试它。

希望有人会知道如何解决这个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T03:12:18.000

听起来您在应用程序中遇到了一个非托管异常，它可能会绕过您尝试执行的任何日志记录。

在这种情况下，我设置 cdb 以在崩溃时生成完整的 MiniDump，然后运行带有 SOS 扩展的 WinDbg 来分析转储。

来自 MSDN 博客 ( [http://blogs.msdn.com/pfedev/](http://blogs.msdn.com/pfedev/) )：

从 Debugging Tools for Windows 目录运行此命令：

```
C:\debuggers> cdb -iaec "-c \".dump /u /ma c:\dumps\av.dmp;q\"" 
```

这会将 CDB 调试器配置为 AeDebug 注册表项崩溃的默认处理程序。您可以通过浏览注册表项来验证设置：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AeDebug 
```

并查看这两个值：

值名称：自动值数据：1

值名称：调试器 值数据：“c:\debuggers\cdb.exe” -p %ld -e %ld -g -c “.dump /ma /uc:\av.dmp;q”</p>

# c# - 发布 COM 组件

> ID：166962
> 
> 赞同：5
> 
> 时间：2008-10-03T13:48:27.970
> 
> 标签：c#, .net, outlook, add-in, pia

当您不再需要通过调用 Marshal.ReleaseComObject(..) 时，是否真的有必要从 Office PIA 释放 COM 组件？

我在网上找到了关于这个主题的各种相互矛盾的建议。在我看来，由于 Outlook PIA 总是返回对其接口的新引用作为其方法的返回值，因此没有必要显式释放它。我对吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T14:19:17.330

PIA 是 .NET 互操作包装器。这意味着在对象的析构函数（或 Dispose - 我不记得了）会自动处理它的引用计数。诀窍是在执行垃圾收集器之前不会释放一些引用。这取决于 COM 对象实例化的内容。例如，打开数据库游标的 COM 对象将使这些游标在内存中保持活动状态，直到这些游标上的引用计数被释放。使用 .NET/COM 互操作，在垃圾收集器执行或使用 Marshal.ReleaseComObject（或 FinalReleaseComObject）显式释放引用之前，不会释放引用。

我个人没有使用过 Microsoft Office PIA，但在大多数情况下，您不必*显*式发布引用。只有当您的应用程序开始锁定其他资源或崩溃时，您才应该开始怀疑悬空引用。

**编辑：**如果您遇到确实需要清理 COM/Interop 对象的情况，请使用 Marshal.FinalReleaseComObject - 它将引用计数一直为零，而不是仅仅减一 - 并将对象引用设置为 null。如果您*真的*想要安全，您可以显式强制垃圾收集 (GC.Collect)，但要小心不要过于频繁地执行 GC，因为它确实会引起明显的性能损失。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T15:47:16.700

通常，使用 Microsoft Office，您确实需要明确发布您的引用，这可以分两个阶段安全地完成：

(1) 首先通过调用 GC.Collect() 和 GC.WaitForPendingFinalizers() 释放所有不持有命名对象变量的次要对象。（如果涉及的对象可能具有终结器，例如在使用 Visual Studio Tools for Office (VSTO) 时，您需要调用它两次。）

(2) 然后通过在每个对象上调用 Marshall.FinalReleaseComObject() 显式释放您持有命名变量的对象。

就是这样。:-)

我[在上一篇文章](https://stackoverflow.com/questions/158706/how-to-properly-clean-up-excel-interop-objects-in-c#159419)中更详细地讨论了这一点，以及一个代码示例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-03T21:14:35.780

对于 VS 2010，请参阅[Marshal.ReleaseComObject 被认为是危险](http://www.infoq.com/news/2010/03/ReleaseComObject-Dangerous)的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T13:53:06.883

[这里](http://www.codeproject.com/KB/COM/safecomwrapper.aspx)有一些使用托管包装器的好做法..值得一试..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T13:55:24.617

也许这只是我的迷信，但我决定通过 Marshal.ReleaseComObject() 明确发布 Office PIA，因为当我的应用程序崩溃时，对 Excel 和 Word 的引用保持打开状态。我没有深入挖掘原因（愚蠢的截止日期），但将它们作为我班级的处置模式的一部分发布解决了这个问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T14:57:50.823

如果您希望 Office 应用程序的实例退出，您确实需要这样做，如[本文](https://stackoverflow.com/questions/158706/how-to-properly-clean-up-excel-interop-objects-in-c#159000)所述。

除了最简单的情况外，很难在所有情况下都做到这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T18:30:25.247

我的经验表明您必须这样做，否则（至少是 Outlook）应用程序可能根本不会关闭。

但这会打开另一个蠕虫罐，因为看起来 RCW 是每个进程的，因此您可以破坏其他一些插件，这些插件恰好具有对同一对象的引用。

我在[这里](https://stackoverflow.com/questions/159313/runtime-callable-wrapper-rcw-scope-process-or-application-domain)发布了一个相关的问题，但我仍然没有明确的答案。一旦我知道更多，我会编辑这篇文章。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-04T05:23:24.353

关于 .Net/COM 互操作有一个简单的规则 - 如有疑问，请始终使用 Release()。:-)

# visual-studio - 您是如何选择 Visual Studio 生产力插件的？

> ID：166987
> 
> 赞同：4
> 
> 时间：2008-10-03T13:52:40.377
> 
> 标签：visual-studio, code-analysis, add-on

我正在为我的开发团队评估 Visual Studio 生产力插件，其中包括一些对 C# 非常陌生的人和一些非常有经验的人。我们不使用 VB.NET。我个人喜欢 ReSharper，但在我提出我个人喜欢的建议之前，我想了解一些关于使用不同插件的意见和理由。

考虑到 ReSharper、CodeRush 和 Visual Assist 之间的选择，您选择了哪一个，为什么？

为了讨论，您一次运行多个插件吗？或者不在此列表中？你对这些插件有什么看法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T14:02:29.017

由于我们使用 C++ 进行开发，因此 Visual Assist 是我们的最佳选择。ReSharper 仅适用于 C#、VB 和 XML。Refactor++ 很不错，但它确实会在代码中的每一次重大更改时将 VS 挂起几分钟。我们也尝试了不同的其他工具，但它们都不支持 C++。CodeRush 对我来说是新的，我会在这个周末评估它（谢谢）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T14:05:48.743

我个人尝试了几个，但我的偏好是两个：

1：[TestDriven.NET——](http://testdriven.net/)用于简单测试；我倾向于将它与 Team Coverage 一起使用，它可以让我直接在编辑器中查看覆盖率，即使测试是基于 NUnit（不是 MSTest）的。

2：一个小插件，让我可以像 IDE 一样对文件进行分组 - 比手动编辑 csproj (DependentUpon IIRC) 更简单。从[这里开始](http://www.kooriyoo.com/VSCommands/)，但是这里有一个（未链接的）更新的 msi [，](http://www.kooriyoo.com/VSCommands/Files/VSCommands(v1.2).msi)它更好地支持选择哪个文件是父文件（选择“组项目”时按住 [Ctrl]）

我从来没有发现我需要 ReSharper 等，但有一天我应该再试一次......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T20:12:19.830

我下载了 resharper 和 coderush 试用版。最初，我更喜欢 coderush。它看起来更精致，更稳定。但最终我还是选择了 resharper。主要是因为单元测试集成。

我真的不明白为什么你必须为你的开发团队选择。在我上一家公司，每个人都使用他们喜欢的工具。我们都使用 VS 2005 和 2008（取决于项目）和 svn 进行版本控制，只要每个人都使用相同的编码标准，我们就没有太多问题。标准化在一定程度上是好的，但让您的开发人员选择他们想要使用的工具可能是一个好主意。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-05-31T08:53:50.983

我在日常编码中使用**VSCommands**。我向 VS 添加了很棒的新功能并且是免费的 :) ( [visual studio 画廊链接](http://visualstudiogallery.msdn.microsoft.com/en-us/d491911d-97f3-4cf6-87b0-6a2882120acf))

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-03T15:39:11.770

我也选择了[VisualAssist X](http://www.wholetomato.com/)，因为我使用的是原生 C++，所以像[ReSharper](http://www.jetbrains.com/resharper/)这样的工具对我没有帮助。我的决定是基于我认识和尊重的其他专业开发人员的意见以及我使用试用版的成功经验。

[CodeRush](http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/)支持 C++，但我直到现在才知道它。从我所见，它看起来类似于 VisualAssist X。我会尝试它们。

顺便说一句：如果我是你，我一次只会安装其中一个工具。我不知道你是否*需*要这样做，但如果他们有一些意想不到的互动，我不会感到惊讶。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T20:06:18.720

我推荐带有 VS 2008 的 ReSharper 4.0。它确实提供了最好的重构命令。

ReSharper 4.0 自测试版以来确实得到了改进。但是，我听说 CodeRush 有更好的模板模型。就个人而言，我宁愿拥有一个强大的重构工具而不是模板工具。

我建议使用 ReSharper 4.0

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-03T20:17:32.847

这里的开发团队中几乎每个人都安装了 ReSharper，但是有很多关于它减慢 Visual Studio 的抱怨。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-28T11:54:13.860

我选择了重构！Pro 大约在几年前，因为当时它支持 C#、VB、ASP.NET（现在支持 JavaScript 和 C++）。我使用所有这些语言。ReSharper 当时只支持 C#。VisualAssist 可能只是 C++。加上当时我在做VB。选择了重构！那么我现在对它的 UI 范例感到满意，因此可能不会很快切换。我现在也在使用 CodeRush Xpress，因为我现在买不起完整的 CodeRush。（早在 2005 年，我在客户端工作时曾短暂尝试过 ReSharper。）

# java - Java表模型设计

> ID：166996
> 
> 赞同：1
> 
> 时间：2008-10-03T13:55:19.390
> 
> 标签：java, model

我有一个创建修改项目表的表类。我想使用表格模型在 JTable 中显示这些项目。对我来说，表格模型属于我的 GUI 包，但表格需要表格模型才能触发更改，表格模型需要表格类才能显示它，所以我不能将两者分开。如果您需要这样做，您使用的类结构是什么？还是我的思维有流动性并且它们属于同一个包？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T17:19:29.307

A`TableModel`是一个*适配器*。我总是将表模型编写为扩展`AbstractTableModel`并将其作为我的 GUI 面板类的私有内部类。您只需填写几个方法：`getRowCount`,`getColumnCount`和`getValueAt`

你的 GUI 类应该可以访问一些*控制器*，它可以从中填写这些信息。当您的控制器发现数据更新时，它应该通知您的 GUI 类，然后该类可以调用`AbstractTableModel.fireTableDataChanged`或其他适当的方法。

**永远不要**使用`DefaultTableModel`该类，因为您必须使表模型的数据与控制器的数据保持同步。`JTable`正如我所说，表模型是一个适配器，它以一种可以理解的方式呈现控制器的数据

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T14:14:02.050

对我来说，tablemodel 是小部件的一部分，即 GUI。我不会依赖我的业务逻辑类中的 javax.swing 包。

因此，您将使用适配器或其他机制从业务层加载您的表模型，但这种分离程度可能很有用。

该决定还取决于项目的规模，并且可能比这复杂得多。例如，查看[jgoodies 绑定](http://www.jgoodies.com/)框架和文档以获得更抽象的案例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T14:18:18.300

模型是保存数据的位。它应该像此类模型一样维护和触发侦听器。

现在您可能需要模型中的某种委托来转换数据或调整类型。因此，您将数据保存在与 javax.swing.table 无关的模型对象中。然后实现一个委托给你的底层模型的 TableModel。使用该 TableModel 创建一个 JTable，但不引用底层模型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T02:40:17.567

我强烈建议任何从事重要表格或列表驱动开发的人看看[Glazed Lists](http://publicobject.com/glazedlists/) - 我已经编写自定义 TableModel 和 CellRenderers 多年，与 JGoodies 绑定等......我大约一年前偶然发现了 GL，以及我的开发从未如此 - Glazed Lists 方法令人震惊。

GL 有两个特点使其成为基于列表的数据绑定和处理的首选框架：

1.  非常非常容易做你想做的正常事情
2.  使您可以做您可能想做的非常非常困难的事情

看看你是否没有印象。我强烈建议先玩示例应用程序，然后观看一些屏幕截图，这些屏幕将引导您完成实际的编码过程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T13:58:48.573

表模型不需要知道它放入的表的任何信息。我​​将表模型放在模型包中，将表放在视图包中。控制器负责向模型包询问模型，向视图包询问表格，并在表格中设置该模型。*******