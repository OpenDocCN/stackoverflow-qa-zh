# StackOverflow 问答 000170000-000170999

# html - FCKeditor 与 TinyMCE 和 XHTML 合规性

> ID：170001
> 
> 赞同：5
> 
> 时间：2008-10-04T08:40:37.607
> 
> 标签：html, tinymce, fckeditor, richtextediting

我对 FCKeditor 与 TinyMCE 以及两者是否符合 XHTML 的（简短）意见。

为了与 stackoverflow 的精神保持一致，如果有人已经表达了您的观点，请点赞。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-06T20:16:19.323

TinyMCE 产生绝对的垃圾。FCK 产生的垃圾更少，但也可能与浏览器内置的样式冲突（默认情况下，FCK 样式带有标签而不是样式属性，例如 <strong> 而不是 <span style="font-weight: bold;">，但是命中Safari 中的 cmd-b 会产生后者，而 FCK 将不知道它，因此允许您嵌套样式无效，并且不允许您使用 FCK 功能来反转内置功能）。

两者都在 IE 中产生垃圾，但那是因为 IE 的 DOM 很疯狂。

例如：[http ://annevankesteren.nl/2005/07/contenteditable](http://annevankesteren.nl/2005/07/contenteditable)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-06T20:06:54.630

根据我的经验，FCKEditor 确实会生成符合 XHTML 的代码，但根据您使用的浏览器，该代码会略有不同。大多数情况下，这与 enter 键产生中断或段落有关，我认为它可能是可配置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T19:42:09.110

Afaik，它们都允许浏览器弄乱它们生成的代码，这不会导致 XHTML 兼容。

[XStandard](http://xstandard.com/)是我所知道的唯一能够生成符合 XHTML 的代码的富 Web 编辑器，但不幸的是，它需要客户端安装，这将它排除在真正的 Web 内容之外。

# javascript - 如何在 JavaScript 中仅删除父元素而不删除其子元素？

> ID：170004
> 
> 赞同：97
> 
> 时间：2008-10-04T08:46:37.577
> 
> 标签：javascript, dom

比方说：

```
<div>
  pre text
  <div class="remove-just-this">
    <p>child foo</p>
    <p>child bar</p>
    nested text
  </div>
  post text
</div> 
```

对此：

```
<div>
  pre text
  <p>child foo</p>
  <p>child bar</p>
  nested text
  post text
</div> 
```

我一直在想办法使用 Mootools、jQuery 甚至（原始）JavaScript，但不知道如何做到这一点。

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2008-10-04T09:37:35.073

使用[jQuery](http://jquery.com/)你可以这样做：

```
var cnt = $(".remove-just-this").contents();
$(".remove-just-this").replaceWith(cnt); 
```

文档的快速链接：

*   [内容](http://docs.jquery.com/Traversing/contents)（）：*jQuery*
*   [替换](http://docs.jquery.com/Manipulation/replaceWith)（*内容*：[*字符串*|*元素*| *jQuery* ]）：*jQuery*

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-04T12:11:36.527

独立于库的方法是在删除之前插入要删除的元素的所有子节点（隐式将它们从旧位置删除）：

```
while (nodeToBeRemoved.firstChild)
{
    nodeToBeRemoved.parentNode.insertBefore(nodeToBeRemoved.firstChild,
                                            nodeToBeRemoved);
}

nodeToBeRemoved.parentNode.removeChild(nodeToBeRemoved); 
```

这会将所有子节点以正确的顺序移动到正确的位置。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-10-06T22:07:00.533

您应该确保对 DOM 执行此操作，而不是`innerHTML`（如果使用 jk 提供的 jQuery 解决方案，请确保它移动 DOM 节点而不是`innerHTML`在内部使用），以便保留事件处理程序之类的东西。

我的答案很像 insin 的，但对于大型结构会表现更好（单独附加每个节点可能会对重绘产生负担，其中必须为每个节点重新应用 CSS `appendChild`；使用 a `DocumentFragment`，这只会发生一次，因为它直到它之后才可见孩子都被附加，它被添加到文档中）。

```
var fragment = document.createDocumentFragment();
while(element.firstChild) {
    fragment.appendChild(element.firstChild);
}
element.parentNode.replaceChild(fragment, element); 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2011-10-19T13:55:19.220

```
 $('.remove-just-this > *').unwrap() 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2016-04-01T16:22:00.603

更优雅的方式是

```
$('.remove-just-this').contents().unwrap(); 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2017-08-13T18:56:29.577

使用现代 JS！

```
const node = document.getElementsByClassName('.remove-just-this')[0];
node.replaceWith(...node.childNodes); // or node.children, if you don't want textNodes 
```

`oldNode.replaceWith(newNode)`是有效的 ES5

`...array`是扩展运算符，将每个数组元素作为参数传递

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2019-03-11T13:54:07.293

将 div 替换为其内容：

```
const wrapper = document.querySelector('.remove-just-this');
wrapper.outerHTML = wrapper.innerHTML;
```

```
<div>
  pre text
  <div class="remove-just-this">
    <p>child foo</p>
    <p>child bar</p>
    nested text
  </div>
  post text
</div>
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-04T11:06:24.923

无论您使用哪个库，都必须先克隆内部 div，然后再从 DOM 中删除外部 div。然后你必须将克隆的内部 div 添加到 DOM 中外部 div 所在的位置。所以步骤是：

1.  在变量中保存对外部 div 父级的引用
2.  将内部 div 复制到另一个变量。这可以通过`innerHTML`将内部 div 保存到变量以快速而肮脏的方式完成，或者您可以逐个节点递归地复制内部树。
3.  以外部 div 作为参数调用`removeChild`外部 div 的父级。
4.  将复制的内部内容插入到正确位置的外部 div 的父级中。

一些图书馆会为你做部分或全部，但类似上面的事情会在幕后发生。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-22T21:30:13.130

而且，由于您也尝试过 mootools，因此这里是 mootools 中的解决方案。

```
var children = $('remove-just-this').getChildren();
children.replaces($('remove-just-this'); 
```

请注意，这完全未经测试，但我之前使用过 mootools，它应该可以工作。

[http://mootools.net/docs/Element/Element#Element:getChildren](http://mootools.net/docs/Element/Element#Element:getChildren)

[http://mootools.net/docs/Element/Element#Element:replaces](http://mootools.net/docs/Element/Element#Element:replaces)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-02-17T13:14:49.207

在处理重要的 DOM 时，我一直在寻找**性能方面的最佳答案。**

eyelidlessness 的回答是指出使用 javascript 的性能是最好的。

我已经对 5,000 行和 400,000 个字符进行了以下执行时间测试，其中要删除的部分内部具有复杂的 DOM 组合。在使用 javascript 时，出于方便的原因，我使用 ID 而不是类。

**使用 $.unwrap()**

```
$('#remove-just-this').contents().unwrap(); 
```

> 201.237 毫秒

**使用 $.replaceWith()**

```
var cnt = $("#remove-just-this").contents();
$("#remove-just-this").replaceWith(cnt); 
```

> 156.983 毫秒

**在 JavaScript 中使用 DocumentFragment**

```
var element = document.getElementById('remove-just-this');
var fragment = document.createDocumentFragment();
while(element.firstChild) {
    fragment.appendChild(element.firstChild);
}
element.parentNode.replaceChild(fragment, element); 
```

> 147.211 毫秒

**结论**

性能方面，即使在相对较大的 DOM 结构上，使用 jQuery 和 javascript 之间的差异也不大。出人意料`$.unwrap()`地比`$.replaceWith()`. 测试是使用 jQuery 1.12.4 完成的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-04-24T11:57:45.450

如果您想在睡衣中做同样的事情，这就是它的完成方式。效果很好（感谢眼睑）。多亏了这一点，我已经能够制作一个适当的富文本编辑器，它可以正确地处理样式而不会弄乱。

```
def remove_node(doc, element):
    """ removes a specific node, adding its children in its place
    """
    fragment = doc.createDocumentFragment()
    while element.firstChild:
        fragment.appendChild(element.firstChild)

    parent = element.parentNode
    parent.insertBefore(fragment, element)
    parent.removeChild(element) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-05-15T12:11:36.993

如果您正在处理多行，就像在我的用例中那样，您可能最好使用以下几行：

```
 $(".card_row").each(function(){
        var cnt = $(this).contents();
        $(this).replaceWith(cnt);
    }); 
```

# protection - 请评论这个简单的软件保护架构

> ID：170006
> 
> 赞同：2
> 
> 时间：2008-10-04T08:48:17.450
> 
> 标签：protection, drm

我被要求为我们的产品实施许可模式。它们是非常昂贵的产品，客户很少，分布在世界各地，基本上每个人都有一个设计环境（安装在单个 Windows 机器上的 Windows 应用程序，每个客户有 1 到 150 个客户端机器）和一个托管生产环境的 Web 服务器（每位客户 1 到 8 台机器）。我们的产品已获得服务器使用许可，因此客户可以使用任意数量的客户端；我们决定不许可服务器部分（因为它受 SLA 协议约束），而只许可客户端，因为一段时间后无法使用客户端，系统基本上变得无用。

我们的基本假设是客户是“足够诚实的”，如果没有适当地获得过期许可证，我们只想介绍停止客户端设计环境。

我评估了不同的许可产品，它们太贵或太难管理，所以我想出了这个简单的解决方案：

*   许可证将是一个简单的签名 XML 文件，使用 w3c 的标准 XML 签名功能签名，使用将通过 USB 密钥提供给管理部门的私钥；如果他们丢失了副本，那么许可模式将失败，但这将是他们的错
*   客户端将在启动时打开许可证文件并使用嵌入在二进制文件中的公钥检查其有效性
*   如果许可 XML 有效并且其中的数据（到期日期和产品名称）与设计人员的工作相比是正确的；如果没有，将显示适当的消息

关于可能的问题或如何改进方案的任何想法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-04T09:12:42.097

只要有足够的兴趣，我还没有看到一个在几周内没有被打破的许可计划。您的计划看起来非常好（尽管可以肯定，如果有人真的想要，他们会破坏它）。

无论你做什么，你都应该听从 Eric Sink 的[建议](http://www.ericsink.com/bos/Transparency.html)：

> 目标应该只是“让诚实的人保持诚实”。如果我们走得更远，只会发生两件事：
> 
> 1.  我们打了一场我们无法赢得的战斗。想作弊的人会成功。
> 2.  我们让产品更难使用，从而伤害了我们产品的诚实用户。

由于您正在为为企业使用而设计的程序实施许可方案，因此您可以更简单，只需在客户端上保留某种 id 和到期日期以及简单的签名，并在许可到期或签名失败时拒绝启动. 打破它并不难，但没有许可计划，如果您认为您的客户是诚实的，这将绰绰有余。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T09:14:38.007

从您的问题中，您的计划如何运作并不完全清楚。客户端软件的每个实例是否都有不同的密钥？许可证的有效期是多久？每个客户有不同的密钥吗？许可证是如何支付的？如何更新许可证？

如果您试图控制客户端代码的使用次数，那么只有上面的第一个会这样做。

归根结底，在您似乎居住的世界上，我怀疑您将不得不相信没有公然侵犯您的许可证的行为。大多数体面的组织（听起来像您的客户）都有责任不侵权，如果他们违反许可协议，可能会导致严重后果。他们也会定期接受审核，您可能有一些法定权利去检查他们的使用情况（如果没有，您应该将其写入您的许可协议）。

如果 USB 密钥的内容进入网络，对您来说变得非常危险。在这方面，任何使用公开密钥的方案都容易受到故意泄露秘密的影响。

我敢肯定有很多关于这个主题的文献，所以可能值得你继续研究。

顺便说一句，我不确定您在中间部分对服务器许可的 SLA 的引用。许可和 SLA 非常不同。许可证是客户的义务，而 SLA 是您的义务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T12:30:44.660

如果你给他们私钥，是什么阻止他们创建更多签名的 XML 文件而不是从你那里购买额外的许可证？还是网站许可证？如果是后者，是什么阻止他们为其他人/网站创建许可证？

通常，开发许可方案使用 MAC 地址和/或硬盘序列号将许可与特定机器绑定，或者有时仅使用激活密钥（通常只是硬件信息的哈希）

并且通常使用您保密的私钥完成编码，并使用公钥验证许可证；客户永远不会拥有私钥，否则他们可以（如果愿意的话）生成自己的许可证

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T08:04:46.817

我同意 Steven A. Lowe 的观点（我没有 15 名声望，所以我不能投票给他）。

这似乎也太复杂了。你想让它牢不可破吗？你不能。任何有足够动力的大师都会找到解决方法。

有时简单的许可方案效果最好：

我建议管理员将一个简单的加密文件放在客户可以访问的地方——它将包含客户名称和到期日期。您在所有打印的报告中使用文件中的客户名称（这是大多数[PHB](http://en.wikipedia.org/wiki/Pointy-Haired_Boss)关心的，这样他们就不会使用打印其他人姓名的许可证）。

# agile - 你对完成的 Scrum 定义

> ID：170009
> 
> 赞同：24
> 
> 时间：2008-10-04T08:52:42.683
> 
> 标签：agile, scrum

虽然 Scrum 在理论上很容易，但在实践中却很难，我想听听你对完成的定义；即您的产品必须经过哪些关口（单元测试、代码覆盖率 > 80%、代码审查、负载测试、perf.test、功能测试等）才能将产品标记为“完成”

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-05T22:31:45.180

我们 TargetProcess 对用户故事使用完成的以下定义：

1.  已创建短规范
2.  已实施/已创建单元测试
3.  已创建验收测试
4.  100% 通过验收测试
5.  产品负责人演示通过
6.  已知错误已修复

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-04T11:39:33.797

我会说这取决于你的团队来决定。与产品负责人交谈。理想情况下，当故事处于生产阶段并被使用时。但是，故事开发完成和上线之间存在时间差。很难追踪一个故事的发展时间。

在我的团队中，我们对完成的定义是，当开发人员完成一个故事，并向团队的其他成员（测试人员、产品负责人）“展示并讲述”时，如果每个人都满意，它就会进入颠覆主干。

进一步的测试是从主干自动构建完成的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T12:42:15.230

在完美世界中，产品在每次迭代结束时都应处于可发货状态。

现在这实际上取决于你的产品、你的市场、你的客户，而且可能是不可能的。

如果您无法做到这一点，则适用下一个计划范围：发布。整个团队应决定交付产品所需的内容并进行相应的计划。

这里有帮助的是在任务级别定义“完成”。在这里定义完成要简单得多：当您可以开始另一项任务时，一项任务就完成了：一切都经过测试、集成。团队可以定义这种状态：记录、审查、包含在自动构建中、没有已知问题、由现场客户接受......

让你的所有任务真正“完成”，让所有旅行积压项目（或用户故事，无论你怎么称呼它们）真正“完成”，允许在每次迭代中“完成”，这有助于将产品保持在可交付或可部署的状态。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T09:33:20.323

[ScrumAlliance 网站上有Mitch Lacey](http://www.scrumalliance.org/articles/107-how-do-we-know-when-we-are-done)、[Dhaval Panchal](http://www.scrumalliance.org/articles/105)和[Mayank Gupta](http://www.scrumalliance.org/articles/106-definition-of-done-a-reference)撰写的三篇不错的文章。

* * *

**编辑：**基本上重点是*完成是由团队在逐个项目的基础上定义的*。基本需要是就定义达成一致，而不是定义是什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-16T18:01:18.027

一切将使您的“稳定期”（即代码冻结和发布给客户端之间所需的工作）更短的事情。

# php - 在 PHP 中，如果不使用浏览器，将创建一个会话

> ID：170019
> 
> 赞同：7
> 
> 时间：2008-10-04T09:09:28.407
> 
> 标签：php, session, browser

我有一个依赖于请求之间的某些状态信息的 API。作为代码的一个简单的第一个版本，我只是使用 PHP 会话来存储状态信息，而不是更高级的东西（APC、memcache、DB）。在我在网络浏览器中进行的初始测试中，一切都运行良好。但是，当客户端尝试通过非浏览器方法（例如 Curl 或 wget）进行连接时，似乎没有保留状态信息。

只有在浏览器请求页面时才会创建 PHP 会话吗？我明确地使用 session_start() 开始会话，并使用 session_name() 预先命名它。

**一个补充说明**。我了解到我遇到的主要问题之一是我正在命名会话而不是通过 session_id($id); 设置会话 ID；我使用 session_name() 的目的是检索之前创建的同一会话，正确的方法是设置 session_id 而不是 session_name。

似乎会话信息将保留在服务器上，如下所述（谢谢）。但要保持这一点，您必须传递会话 id，或者，在我的情况下，任何其他可以唯一标识用户的 id。将此 id 用作 session_id，您的会话将按预期运行。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-04T09:17:55.970

**会话 Cookie**

请记住，HTTP 是**无状态**的，因此在您的服务器上跟踪会话，但**客户端**必须在每个请求中识别自己。当您声明 session_start() 时，**您的浏览器通常会设置一个 cookie**（“PHP 会话 ID”），然后通过在每个请求中发送 cookie 值来标识自己。当使用带有会话值的请求调用脚本时， session_start() 函数将尝试查找会话。为了向自己证明这一点，请注意，当您清除 cookie 时会话会终止。如果 cookie 是“会话”cookie（临时的），即使您退出浏览器，许多会话也会终止。您提到您正在为会话命名。查看您的浏览器 cookie 并查看是否可以找到具有相同名称的 cookie。

所有这一切都是说 cookie 在您的会话中发挥着积极作用，因此如果**客户端不支持 cookie**，那么您将无法按照当前的方式进行会话.. 至少对于那些替代客户。将在服务器上创建一个会话；问题是客户是否参与。

如果 cookie 不是您的客户端的选项，您将不得不找到**另一种方法**将会话id 传递给服务器。例如，这可以在**查询字符串**中完成，尽管以这种方式发送会话 id 被认为不那么私密。

```
mysite.com?PHPSESSID=10alksdjfq9e 
```

具体如何做到这一点可能会因您的 PHP 版本而异，但它基本上只是一个配置。如果设置了正确的运行时选项，PHP 将透明地将会话 ID 作为查询参数添加到页面上的链接（当然，仅限同源）。[您可以在PHP 网站](http://us2.php.net/manual/en/session.idpassing.php)上找到设置的详细信息。

**旁注：**多年前，这是尝试实现会话时的常见问题。Cookie 较新，许多人出于所谓的安全问题而关闭了浏览器中的 cookie 支持。

**旁注：** *@Uberfuzzy*提出了一个很好的观点——实际上可以使用带有 curl 或 wget 的会话。问题是它的自动化程度较低。用户可能会将标头值转储到文件中并在将来的请求中使用这些值。curl 有一些“cookie 意识”标志，可以让您更轻松地处理这个问题，但您仍然必须明确地这样做。再说一次，你可以利用它来发挥你的优势。如果 curl 在您的替代客户端上可用，那么您可以使用 cookie 感知标志合理地自己拨打电话。请参阅[卷曲手册](http://curl.netmirror.org/docs/manual.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T10:50:46.267

如果您调用 session_start()，那么如果客户端不在现有会话中，则会创建一个会话。如果客户端不支持（或配置为忽略）用于维护会话的 cookie 或查询字符串机制，则会在每个请求上创建一个新会话。

这可能会使您的会话存储机制因未使用的会话而膨胀。

如果您觉得这可能是个问题，那么最好只在会话中存储一些内容（例如，用户登录或机器人不太可能做的其他事情）时调用 session_start()。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T18:00:04.980

*只有在浏览器请求页面时才会创建 PHP 会话吗？*

**简短的回答**：是的。会话是专门为利用浏览器功能解决 HTTP 无状态问题而创建的。APC、memcached、DB 等无关紧要。这些只是会话的存储方法，并且会遇到同样的问题。

**更长的答案**：创建会话的概念是为了说明 HTTP 是一种无状态协议这一事实，事实证明，状态对于各种软件应用程序非常重要。

实现会话的最常见方式是使用 cookie。PHP 在 cookie 中发送会话 ID，浏览器将带有会话 ID 的 cookie 发送回。此 ID 在服务器上用于查找您在会话中存储的任何信息。PHP 能够在 URL 的末尾包含和读取会话 ID，**但这**假设用户将通过单击包含生成的会话 ID 的链接导航到您的站点/应用程序上的页面。

在您的特定情况下，可以将 cookie 与 curl（可能还有 wget）一起使用。Curl**是**一个网络浏览器，只是一个没有 GUI 的浏览器。如果它是您正在使用的命令行 curl 程序（而不是 C 库、PHP 扩展等），请阅读以下选项

```
-b/--cookie
-c/--cookie-jar
-j/--junk-session-cookies 
```

# sql-server - 哪些因素会降低 SQL Server 2000 作业的性能？

> ID：170021
> 
> 赞同：1
> 
> 时间：2008-10-04T09:10:19.543
> 
> 标签：sql-server, performance

我们目前正在运行一个 SQL 作业，每天晚上 10 点归档数据。然而，最终用户抱怨从晚上 10 点到 12 点，页面显示超时错误。

这是作业的伪代码

```
while @jobArchive = 1 and @countProcecessedItem < @maxItem
     exec ArchiveItems @countProcecessedItem out
     if error occured
          set @jobArchive = 0
     delay '00:10' 
```

ArchiveItems 存储过程抓取 30 天前创建的前 100 个项目，在另一个数据库中处理和归档它们，并删除原始表中的项目，包括与其相关的其他表。最后将@countProcecessedItem 设置为处理的项目数。ArchiveItems 还创建和删除它用来保存一些记录的临时表。

**注意：**如果我提供的信息不完整，请回复，如果可能，我很乐意添加更多信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T09:20:21.567

唯一不清楚的是 ArchiveItems 是否也从数据库中删除或不删除数据。在 SQL Server 中删除行是一项非常昂贵的操作，会导致数据库上出现大量锁定条件，并且可能会出现表和数据库锁定，这通常会导致超时。
如果您要删除数据，您可以做的是：

*   在相关行上设置一个“逻辑”删除标志，并在您执行读取数据的查询中考虑它
*   批量执行删除。我发现（在我的应用程序中）在每个事务中删除大约 250 行可以提供更快的操作，比以单独的方式发出 250 删除命令花费的时间要少得多

希望这会有所帮助，但是从 SQL Server 归档和删除数据是一项非常艰巨的工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T11:23:58.323

当 ArchiveItems 进程正在删除 100 条记录时，它正在锁定表。确保您有索引以使删除快速运行；在该时间范围内运行 Profiler 会话并查看需要多长时间。如果它正在执行表扫描或索引扫描以查找记录，您可能需要在日期字段上添加索引。

在最终用户方面，您可以在查询中添加 READUNCOMMITTED 或 NOLOCK 提示；这允许查询在删除发生时运行，但有可能返回即将被删除的记录。

还要考虑工作的不同时间范围；找到用户活动最少的时间，或者在维护窗口中每月只归档一次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T15:27:39.170

正如另一张海报提到的，缓慢的 DELETE 通常是由于没有合适的索引，或者需要重建合适的索引造成的。

在 DELETE 期间，锁升级 ROW -> PAGE -> TABLE 的情况并不少见。您可以通过以下方式减少锁定

*   添加 ROWLOCK 提示（但请注意它可能会消耗更多内存）

*   随机化被删除的行（降低锁升级的可能性）

*   最简单：在 ArchiveItems 中添加一个简短的 WAITFOR

    WHILE someCondition BEGIN

    删除一些行

    -- 给其他进程一个机会... WAITFOR DELAY '000:00:00.250'

    结尾

如果删除是在其他活动发生期间发生的，并且您希望保持数据的完整性，我不会使用 NOLOCK 提示。

# c# - 您将如何简化进入和退出 ReaderWriterLock？

> ID：170028
> 
> 赞同：11
> 
> 时间：2008-10-04T09:16:16.427
> 
> 标签：c#, .net, vb.net, parallel-processing, readerwriterlock

这对我来说似乎很吵。五行开销实在是太多了。

```
m_Lock.EnterReadLock()
Try
    Return m_List.Count
Finally
    m_Lock.ExitReadLock()
End Try 
```

那你怎么会这么简单？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-04T09:24:22.527

我也是这么想的，但是在 C# 中；-p

```
using System;
using System.Threading;

class Program
{
    static void Main()
    {
        ReaderWriterLockSlim sync = new ReaderWriterLockSlim();

        using (sync.Read())
        {
           // etc    
        }
    }

}
public static class ReaderWriterExt
{
    sealed class ReadLockToken : IDisposable
    {
        private ReaderWriterLockSlim sync;
        public ReadLockToken(ReaderWriterLockSlim sync)
        {
            this.sync = sync;
            sync.EnterReadLock();
        }
        public void Dispose()
        {
            if (sync != null)
            {
                sync.ExitReadLock();
                sync = null;
            }
        }
    }
    public static IDisposable Read(this ReaderWriterLockSlim obj)
    {
        return new ReadLockToken(obj);
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-08-04T14:24:12.787

到目前为止发布的所有解决方案都存在死锁的风险。像这样的使用块：

```
ReaderWriterLockSlim sync = new ReaderWriterLockSlim();
using (sync.Read())
{
  // Do stuff
} 
```

被转换成这样的东西：

```
ReaderWriterLockSlim sync = new ReaderWriterLockSlim();
IDisposable d = sync.Read();
try
{
  // Do stuff
}
finally
{
  d.Dispose();
} 
```

这意味着在 sync.Read() 和 try 块之间可能会发生 ThreadAbortException（或类似情况）。当这种情况发生时，finally 块永远不会被调用，并且锁永远不会被释放！

有关更多信息和更好的实现，请参阅： [Deadlock with ReaderWriterLockSlim and other lock objects](http://web.archive.org/web/20120323190453/http://www.nobletech.co.uk/Articles/ReaderWriterLockMgr.aspx)。简而言之，更好的实现归结为将锁移动到`try`块中，如下所示：

```
ReaderWriterLockSlim myLock = new ReaderWriterLockSlim();
try
{
    myLock.EnterReadLock();
    // Do stuff
}
finally
{
    // Release the lock
    myLock.ExitReadLock();
} 
```

像接受的答案中的包装[类](https://social.msdn.microsoft.com/Forums/pt-BR/60fa5522-4ac2-4395-9d5f-d001fdce09fd/thread-safe-classe-gerente-de-readerwriterlockslim-erro-de-compilacao?forum=vscsharppt)将是：

```
 /// <summary>
  /// Manager for a lock object that acquires and releases the lock in a manner
  /// that avoids the common problem of deadlock within the using block
  /// initialisation.
  /// </summary>
  /// <remarks>
  /// This manager object is, by design, not itself thread-safe.
  /// </remarks>
  public sealed class ReaderWriterLockMgr : IDisposable
  {
    /// <summary>
    /// Local reference to the lock object managed
    /// </summary>
    private ReaderWriterLockSlim _readerWriterLock = null;

    private enum LockTypes { None, Read, Write, Upgradeable }
    /// <summary>
    /// The type of lock acquired by this manager
    /// </summary>
    private LockTypes _enteredLockType = LockTypes.None;

    /// <summary>
    /// Manager object construction that does not acquire any lock
    /// </summary>
    /// <param name="ReaderWriterLock">The lock object to manage</param>
    public ReaderWriterLockMgr(ReaderWriterLockSlim ReaderWriterLock)
    {
      if (ReaderWriterLock == null)
        throw new ArgumentNullException("ReaderWriterLock");
      _readerWriterLock = ReaderWriterLock;
    }

    /// <summary>
    /// Call EnterReadLock on the managed lock
    /// </summary>
    public void EnterReadLock()
    {
      if (_readerWriterLock == null)
        throw new ObjectDisposedException(GetType().FullName);
      if (_enteredLockType != LockTypes.None)
        throw new InvalidOperationException("Create a new ReaderWriterLockMgr for each state you wish to enter");
      // Allow exceptions by the Enter* call to propogate
      // and prevent updating of _enteredLockType
      _readerWriterLock.EnterReadLock();
      _enteredLockType = LockTypes.Read;
    }

    /// <summary>
    /// Call EnterWriteLock on the managed lock
    /// </summary>
    public void EnterWriteLock()
    {
      if (_readerWriterLock == null)
        throw new ObjectDisposedException(GetType().FullName);
      if (_enteredLockType != LockTypes.None)
        throw new InvalidOperationException("Create a new ReaderWriterLockMgr for each state you wish to enter");
      // Allow exceptions by the Enter* call to propogate
      // and prevent updating of _enteredLockType
      _readerWriterLock.EnterWriteLock();
      _enteredLockType = LockTypes.Write;
    }

    /// <summary>
    /// Call EnterUpgradeableReadLock on the managed lock
    /// </summary>
    public void EnterUpgradeableReadLock()
    {
      if (_readerWriterLock == null)
        throw new ObjectDisposedException(GetType().FullName);
      if (_enteredLockType != LockTypes.None)
        throw new InvalidOperationException("Create a new ReaderWriterLockMgr for each state you wish to enter");
      // Allow exceptions by the Enter* call to propogate
      // and prevent updating of _enteredLockType
      _readerWriterLock.EnterUpgradeableReadLock();
      _enteredLockType = LockTypes.Upgradeable;
    }

    /// <summary>
    /// Exit the lock, allowing re-entry later on whilst this manager is in scope
    /// </summary>
    /// <returns>Whether the lock was previously held</returns>
    public bool ExitLock()
    {
      switch (_enteredLockType)
      {
        case LockTypes.Read:
          _readerWriterLock.ExitReadLock();
          _enteredLockType = LockTypes.None;
          return true;
        case LockTypes.Write:
          _readerWriterLock.ExitWriteLock();
          _enteredLockType = LockTypes.None;
          return true;
        case LockTypes.Upgradeable:
          _readerWriterLock.ExitUpgradeableReadLock();
          _enteredLockType = LockTypes.None;
          return true;
      }
      return false;
    }

    /// <summary>
    /// Dispose of the lock manager, releasing any lock held
    /// </summary>
    public void Dispose()
    {
      if (_readerWriterLock != null)
      {
        ExitLock();
        // Tidy up managed resources
        // Release reference to the lock so that it gets garbage collected
        // when there are no more references to it
        _readerWriterLock = null;
        // Call GC.SupressFinalize to take this object off the finalization
        // queue and prevent finalization code for this object from
        // executing a second time.
        GC.SuppressFinalize(this);
      }
    }

    protected ~ReaderWriterLockMgr()
    {
      if (_readerWriterLock != null)
        ExitLock();
      // Leave references to managed resources so that the garbage collector can follow them
    }
  } 
```

用法如下：

```
ReaderWriterLockSlim myLock = new ReaderWriterLockSlim();

using (ReaderWriterLockMgr lockMgr = new ReaderWriterLockMgr(myLock))
{
    lockMgr.EnterReadLock();
    // Do stuff
} 
```

此外，来自[Joe Duffy 的博客](http://web.archive.org/web/20120113121354/http://www.bluebytesoftware.com/blog/PermaLink,guid,c4ea3d6d-190a-48f8-a677-44a438d8386b.aspx)

> 其次，锁对异步异常（如线程中止和内存不足）不可靠。如果其中一种发生在锁定方法之一的中间，则锁定状态可能会损坏，从而导致后续死锁、未处理的异常，并且（可悲的是）由于内部使用自旋锁而导致 100% 的 CPU 挂钩。因此，如果您要在经常使用线程中止或尝试在硬 OOM 中生存的环境中运行代码，您将不会对这种锁感到满意。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T14:06:55.180

这不是我的发明，但它确实使头发少了一点灰白。

```
internal static class ReaderWriteLockExtensions
{
    private struct Disposable : IDisposable
    {
        private readonly Action m_action;
        private Sentinel m_sentinel;

        public Disposable(Action action)
        {
            m_action = action;
            m_sentinel = new Sentinel();
        }

        public void Dispose()
        {
            m_action();
            GC.SuppressFinalize(m_sentinel);
        }
    }

    private class Sentinel
    {
        ~Sentinel()
        {
            throw new InvalidOperationException("Lock not properly disposed.");
        }
    }

    public static IDisposable AcquireReadLock(this ReaderWriterLockSlim lock)
    {
        lock.EnterReadLock();
        return new Disposable(lock.ExitReadLock);
    }

    public static IDisposable AcquireUpgradableReadLock(this ReaderWriterLockSlim lock)
    {
        lock.EnterUpgradeableReadLock();
        return new Disposable(lock.ExitUpgradeableReadLock);
    }

    public static IDisposable AcquireWriteLock(this ReaderWriterLockSlim lock)
    {
        lock.EnterWriteLock();
        return new Disposable(lock.ExitWriteLock);
    }
} 
```

**如何使用：**

```
using (m_lock.AcquireReadLock())
{
    // Do stuff
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T09:18:44.160

我最终这样做了，但我仍然对我的设计中更好的方法或缺陷持开放态度。

```
Using m_Lock.ReadSection
    Return m_List.Count
End Using 
```

这使用此扩展方法/类：

```
<Extension()> Public Function ReadSection(ByVal lock As ReaderWriterLockSlim) As ReadWrapper
    Return New ReadWrapper(lock)
End Function

Public NotInheritable Class ReadWrapper
    Implements IDisposable

    Private m_Lock As ReaderWriterLockSlim
    Public Sub New(ByVal lock As ReaderWriterLockSlim)
        m_Lock = lock
        m_Lock.EnterReadLock()
    End Sub
    Public Sub Dispose() Implements IDisposable.Dispose
        m_Lock.ExitReadLock()
    End Sub

End Class 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-18T23:47:05.333

由于锁的目的是保护某些内存，我认为将内存包装在“锁定”对象中会很有用，并且只能通过各种锁令牌访问它（如[Mark](https://stackoverflow.com/questions/170028/how-would-you-simplfy-entering-and-exiting-a-readerwriterlock#170040)所述）：

```
// Stores a private List<T>, only accessible through lock tokens
//  returned by Read, Write, and UpgradableRead.
var lockedList = new LockedList<T>( ); 
```

```
using( var r = lockedList.Read( ) ) {
  foreach( T item in r.Reader )
    ...
} 
```

```
using( var w = lockedList.Write( ) ) {
  w.Writer.Add( new T( ) );
} 
```

```
T t = ...;
using( var u = lockedList.UpgradableRead( ) ) {
  if( !u.Reader.Contains( t ) )
    using( var w = u.Upgrade( ) )
      w.Writer.Add( t );
} 
```

现在访问内部列表的唯一方法是调用适当的访问器。

这特别适用于`List<T>`，因为它已经有了`ReadOnlyCollection<T>`包装器。对于其他类型，您始终可以创建一个`Locked<T,T>`，但是您会失去良好的可读/可写类型区别。

一项改进可能是将`R`and`W`类型定义为一次性包装器本身，这将防止（无意的）错误，例如：

```
List<T> list;
using( var w = lockedList.Write( ) )
  list = w.Writable;

//BAD: "locked" object leaked outside of lock scope
list.MakeChangesWithoutHoldingLock( ); 
```

但是，这会使`Locked`使用变得更加复杂，并且当前版本确实为您提供了与手动锁定共享成员时相同的保护。

* * *

```
sealed class LockedList<T> : Locked<List<T>, ReadOnlyCollection<T>> {
  public LockedList( )
    : base( new List<T>( ), list => list.AsReadOnly( ) )
  { }
}

public class Locked<W, R> where W : class where R : class {
  private readonly LockerState state_;
  public Locked( W writer, R reader ) { this.state_ = new LockerState( reader, writer ); }
  public Locked( W writer, Func<W, R> getReader ) : this( writer, getReader( writer ) ) { }

  public IReadable Read( ) { return new Readable( this.state_ ); }
  public IWritable Write( ) { return new Writable( this.state_ ); }
  public IUpgradable UpgradableRead( ) { return new Upgradable( this.state_ ); }

  public interface IReadable : IDisposable { R Reader { get; } }
  public interface IWritable : IDisposable { W Writer { get; } }
  public interface IUpgradable : IReadable { IWritable Upgrade( );}

  #region Private Implementation Details
  sealed class LockerState {
    public readonly R Reader;
    public readonly W Writer;
    public readonly ReaderWriterLockSlim Sync;

    public LockerState( R reader, W writer ) {
      Debug.Assert( reader != null && writer != null );
      this.Reader = reader;
      this.Writer = writer;
      this.Sync = new ReaderWriterLockSlim( );
    }
  }

  abstract class Accessor : IDisposable {
    private LockerState state_;
    protected LockerState State { get { return this.state_; } }
    protected Accessor( LockerState state ) {
      Debug.Assert( state != null );
      this.Acquire( state.Sync );
      this.state_ = state;
    }

    protected abstract void Acquire( ReaderWriterLockSlim sync );
    protected abstract void Release( ReaderWriterLockSlim sync );

    public void Dispose( ) {
      if( this.state_ != null ) {
        var sync = this.state_.Sync;
        this.state_ = null;
        this.Release( sync );
      }
    }
  }

  class Readable : Accessor, IReadable {
    public Readable( LockerState state ) : base( state ) { }
    public R Reader { get { return this.State.Reader; } }
    protected override void Acquire( ReaderWriterLockSlim sync ) { sync.EnterReadLock( ); }
    protected override void Release( ReaderWriterLockSlim sync ) { sync.ExitReadLock( ); }
  }

  sealed class Writable : Accessor, IWritable {
    public Writable( LockerState state ) : base( state ) { }
    public W Writer { get { return this.State.Writer; } }
    protected override void Acquire( ReaderWriterLockSlim sync ) { sync.EnterWriteLock( ); }
    protected override void Release( ReaderWriterLockSlim sync ) { sync.ExitWriteLock( ); }
  }

  sealed class Upgradable : Readable, IUpgradable {
    public Upgradable( LockerState state ) : base( state ) { }
    public IWritable Upgrade( ) { return new Writable( this.State ); }
    protected override void Acquire( ReaderWriterLockSlim sync ) { sync.EnterUpgradeableReadLock( ); }
    protected override void Release( ReaderWriterLockSlim sync ) { sync.ExitUpgradeableReadLock( ); }
  }
  #endregion
} 
```

# php - PHP 的好转折库？

> ID：170033
> 
> 赞同：6
> 
> 时间：2008-10-04T09:19:06.140
> 
> 标签：php, frameworks, inflection

我正在为 PHP 寻找一个好的变形（或者，一个可以将复数转换为单数，反之亦然的库 - 这是一种变形）库，它可能是某些当前框架的一部分，也可能是唯一的独立库我的要求是它与 MIT 许可证兼容。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-04T09:27:25.857

[您会在CakePHP](http://www.cakephp.org)附带的示例中找到一个很好的示例：

[Cake/Utility/Inflector.php](http://api20.cakephp.org/view_source/inflector/)

它是框架的一部分，并且获得了 MIT 许可。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T09:25:25.363

Code Igniter 中包含一个，您可以[检查一下它](http://codeigniter.com/user_guide/helpers/inflector_helper.html)是否满足您的需求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-20T15:53:40.413

我[在 php actionscript 和 ROR 中使用了这个改进的复数](http://kuwamoto.org/2007/12/17/improved-pluralizing-in-php-actionscript-and-ror/)。它是使用 MIT 许可证发布的，并且不是框架的一部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T09:03:33.067

[http://solarphp.com/class/Solar_Inflect](http://solarphp.com/class/Solar_Inflect)

# c++ - 体面的 Windows 分析器？

> ID：170036
> 
> 赞同：24
> 
> 时间：2008-10-04T09:20:16.667
> 
> 标签：c++, windows, performance, profiling

Windows 是否有任何像样的采样（例如非仪器）分析器可用？最好是类似于 MacOS 上的 Shark 的东西，尽管我愿意接受我将不得不为 Windows 上的这种分析器付费。

我已经在 VS Team Suite 中尝试过探查器，并没有给我留下太深刻的印象，我想知道是否还有其他好的探查器。

[编辑：Erk，我忘了说这是针对 C/C++，而不是 .NET - 抱歉有任何混淆]

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-04T10:58:08.170

对于 Windows，请查看随 Windows SDK 提供的免费[Xperf](http://blogs.msdn.com/pigscanfly/archive/2008/02/09/xperf-a-new-tool-in-the-windows-sdk.aspx)。它使用采样配置文件，具有一些有用的 UI，并且不需要检测。对于跟踪性能问题非常有用。您可以回答以下问题：

谁使用的 CPU 最多？使用调用堆栈深入到函数名称。

谁分配的内存最多？

未完成的内存分配（泄漏）

谁做的注册表查询最多？

磁盘写入？等等

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-07-06T19:57:44.893

我知道我在问这个问题几个月后添加了我的答案，但我想我会指出一个体面的开源分析器：[Very Sleepy](http://www.codersnotes.com/sleepy/)。

它没有前面提到的其他一些分析器所做的功能计数，但它是一个非常受人尊敬的采样分析器，在大多数情况下都可以很好地工作。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-04T09:38:43.900

[英特尔 VTune](http://www.intel.com/cd/software/products/asmo-na/eng/239144.htm)很好，而且是非仪表化的。我们评估了一大堆适用于 Windows 的分析器，这是处理驱动程序代码的最佳选择（尽管它也处理非托管用户级代码）。一个特别的优势是它读取所有英特尔处理器性能计数器，因此您可以很好地了解您的代码运行缓慢的原因，并且对于将预取指令放入我们的代码和整理数据布局以与缓存线，以及缓存线在多核系统中失效的方式。

它是商业的，我不得不说它不是世界上最简单的用户界面。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-31T21:56:35.147

AMD 的 CodeAnalyst[在这里](http://developer.amd.com/tools-and-sdks/archive/amd-codeanalyst-performance-analyzer/codeanalyst-performance-analyzer-for-windows/)**免费**

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-04T22:12:32.663

我们同时使用 VTune 和 AQTime，我可以保证两者。哪个最适合您取决于您​​的需求。两者都有免费试用版 - 我建议您试一试。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-05T08:42:29.520

[Windows 驱动程序工具包包括一个名为](http://www.microsoft.com/whdc/DevTools/WDK/WDKpkg.mspx)[“kernrate”](http://msdn.microsoft.com/en-us/library/aa469207.aspx)的非仪器用户/内核采样分析器。它似乎对分析多进程应用程序、大部分时间在内核中的应用程序和设备驱动程序（当然）很有用。[KrView (Kernrate Viewer)](http://www.microsoft.com/whdc/system/sysperf/krview.mspx)和[Windows Server 2003 资源工具包工具](http://www.microsoft.com/downloads/details.aspx?displaylang=en&familyid=9D467A69-57FF-4AE7-96EE-B18C4790CFFD)包中也提供了它。

Kernrate 适用于 Windows 2000 及更高版本（与需要 Vista / Server 2008 的 Xperf 不同）。它是基于命令行的，文档中有一些令人生畏的选项列表。我不确定它是否可以记录调用堆栈或只是程序计数器。如果您使用符号服务器，请确保将最新版本放在同一目录中，`dbghelp.dll`以防止它使用安装在.`symsrv.dll``kernrate.exe``dbghelp.dll``%SystemRoot%\system32`

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-04T11:33:32.780

大约两年前，我在一个相当大的项目中尝试过英特尔的 vtune。当时它是一个检测分析器，我花了很长时间来检测我试图分析的 DLL，以至于一个小时后我最终失去了耐心。

我取得了相当大的成功并且我强烈推荐的一个工具是[AQTime](http://www.automatedqa.com/products/aqtime/)。它不仅提供了出色的性能分析资源，而且还提供了非常好的内存分析，这对我跟踪内存泄漏有很大帮助。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-04-20T17:09:15.093

[Luke Stackwalker](http://lukestackwalker.sourceforge.net/)似乎很有希望——它没有我想要的那么完美，但它是开源的，它确实做了一些看起来非常接近@Mike Dunlavey 一直说我们应该做的事情。（当然，它会尝试将其全部归结为 Mike 厌倦的通常无用的调用图，但以源作为我们的盟友来解决这个问题应该不会太难。）

据我所知，它甚至似乎计算了在内核中等待的时间......

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-10-04T09:23:57.020

我不确定什么是非仪器分析器，但我可以说对于 .NET，我喜欢 RedGate 的 ANTS Profiler。第 3 版在易用性方面优于 MS 版，第 4 版允许任意时间片，让 MS 看起来像个笑话。

# delphi - 公寓之间的 ActiveX 事件

> ID：170038
> 
> 赞同：0
> 
> 时间：2008-10-04T09:22:52.187
> 
> 标签：delphi, events, com, activex

环境：VS2008 (ATL)，Borland Developer Studio 2006。

大家好。我在处理 ActiveX 控件事件时遇到了一些问题。

以下是我的应用架构的简要说明：

有一个包含 STA ActiveX 控件（又名控件）和 MTA COM 对象（又名对象）的 inproc COM 服务器。

下面是控制和对象接口的 IDL 定义：

```
[
    object,
    uuid(2338CCAF-BBAF-4E29-929B-A67285B1E772),
    dual,
    nonextensible,
    pointer_default(unique)
]
interface IObject : IDispatch{
    [id(1)] HRESULT DoWork(void);
};

[
    object,
    uuid(1A0A1DA2-E33B-4DF4-99A9-9EAEF2281E7D),
    dual,
    nonextensible,
    pointer_default(unique)
]
interface IControl : IDispatch{
};

[
    uuid(BC27FABD-2794-4F9C-B3BD-C0C0628741FA),
    version(1.0),
    helpstring("AVRep 1.0 Type Library")
]

library ActiveXLib
{
    importlib("stdole2.tlb");
    [
        uuid(4B5575A7-E0FF-49B5-AE10-0D980CF49EB3)
    ]
    dispinterface _IControlEvents
    {
        properties:
        methods:
            [id(1)] HRESULT SomeEvent([in] IObject* obj);
        };
    [
        uuid(7C44F19E-6B71-434B-96F6-E29A3C66C794),
        control
    ]
    coclass Control
    {
        [default] interface IControl;
        [default, source] dispinterface _IControlEvents;
    };
    [
        uuid(17BDFAC0-DF21-4474-BCFF-846FE0075D68)
    ]
    coclass Object
    {
        [default] interface IObject;
    };
}; 
```

客户端是一个 Delphi 应用程序，窗体上带有 ActiveX 控件，它创建 MTA 对象并调用其 DoWork 方法

```
var
  mta : IObject;
begin
  mta := CreateOleObject('ActiveXLib.Object.1') as IObject;
  mta.DoWork();
end; 
```

此方法直接调用 ActiveX 控件类的 Fire_SomeEvent 方法，并将“this”作为参数传递（指向 IObject 接口的指针）。Delphi 代码成功接收事件，但是当它尝试访问任何 IObject 方法或属性（为简单起见未在 idl 中显示）时，在 oleaut32.dll 中发生访问冲突。

一个重要的注意事项 - 我使用 ATLCPImplMT 类来实现从不同线程触发的事件（有关详细信息，请参阅[http://support.microsoft.com/kb/280512](http://support.microsoft.com/kb/280512)）。此实现允许在事件触发时切换公寓（从对象的 MTA 公寓到 STA Delphi 形式的公寓）。我建议这个问题与不正确的事件参数封送处理有关，因为当使用标准 ATLCPImpl 类时一切正常。

跨公寓活动是否有任何限制？也许需要一些特殊的 Delphi 环境设置才能正确使用 activex 对象......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T19:11:34.943

您是在访问与事件处理程序在同一线程中创建的对象，还是在主线程中创建的 COM 对象？如果您在事件处理程序中与创建对象的线程不在同一个线程上下文中，则当您尝试访问 COM 对象时可能会遇到访问冲突。

一个快速修复解决方法可以是从事件处理程序向主线程发布消息，并让主线程在主线程上下文中访问 COM 对象，而不是直接在 COM 事件处理程序中访问。

线程和 COM 并不比没有 COM 的线程复杂。

# c# - 您将如何简单地 Monitor.TryEnter

> ID：170051
> 
> 赞同：2
> 
> 时间：2008-10-04T09:34:18.450
> 
> 标签：c#, .net, vb.net, parallel-processing

我试图让事情变得更简单。这是我的代码：

```
 If Threading.Monitor.TryEnter(syncRoot) Then
        Try
            'do something
        Finally
            Threading.Monitor.Exit(syncRoot)
        End Try
    Else
        'do something else
    End If 
```

就噪音而言，这甚至比 ReaderWriterLock 还要糟糕。我可以使用 C# 或 VB，因此适用于任何一个的答案都将受到欢迎。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T10:31:55.510

使用委托？

例如

```
public bool TryEnter(object lockObject, Action work) 
{
    if (Monitor.TryEnter(lockObject)) 
    {
       try 
       {
          work();
       }
       finally 
       {
           Monitor.Exit(lockObject);
       }        
       return true;
     }

     return false;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T09:37:04.340

[这与您的上](https://stackoverflow.com/questions/170028/how-would-you-simplfy-entering-and-exiting-a-readerwriterlock)一篇文章非常相似，我希望得到类似的答案。唯一显着的区别是，如果超时失败，您可能会从您的方法中返回“null” - 然后不会调用“Dispose()”，您可以轻松检查该值：

```
using(var token = GetLock(syncLock, timeout)) {
  if(token != null) { ... }
} 
```

唯一真正的故障是您不一定要向“对象”（甚至“T where T : class”）添加扩展方法......

[Jon Skeet](https://stackoverflow.com/users/22656/jon-skeet)过去曾研究过这一点——[值得一看](http://www.yoda.arachsys.com/csharp/miscutil/usage/locking.html)。

# silverlight - 有没有办法对从 ItemsControl 的 ItemTemplate 生成的 RadioButtons 进行分组

> ID：170061
> 
> 赞同：4
> 
> 时间：2008-10-04T09:43:35.607
> 
> 标签：silverlight, xaml

```
 <DataTemplate x:Key="Genre_DataTemplate">
        <RadioButton GroupName="One" Content="{Binding...
 </DataTemplate> 
```

上面的代码是我的 ItemsControl 的 ItemTemplate，我希望所有实例化的 Radiobuttons 的行为都应该像在一个组中一样，我知道原因是因为生成的 RadioButtons 在视觉树中不相邻。

将它们组合在一起的任何解决方案或解决方法？GroupName 属性在这里也没有任何作用。

[更新] 我正在 Silverlight 中尝试这个

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T21:10:54.377

问题是 RadioButton.GroupName 行为依赖于逻辑树来找到一个共同的祖先并有效地将其用于树的该部分，但 silverlight 的 ItemsControl 不维护逻辑树。这意味着，在您的示例中，RadioButton 的 Parent 属性始终为 null

我建立了一个简单的附加行为来解决这个问题。可在此处获得：[http ://www.dragonshed.org/blog/2009/03/08/radiobuttons-in-a-datatemplate-in-silverlight/](http://www.dragonshed.org/blog/2009/03/08/radiobuttons-in-a-datatemplate-in-silverlight/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-04T16:54:05.287

我认为问题出在控制树的其他地方。你能发布更多细节吗？

这是一个按预期工作的示例 xaml 代码：

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
 <Grid>
    <Grid.Resources>
       <XmlDataProvider x:Key="flickrdata" Source="http://api.flickr.com/services/feeds/photos_public.gne?tags=flower&amp;lang=en-us&amp;format=rss_200">
          <XmlDataProvider.XmlNamespaceManager>
             <XmlNamespaceMappingCollection>
                <XmlNamespaceMapping Prefix="media" Uri="http://search.yahoo.com/mrss/"/>
             </XmlNamespaceMappingCollection>
          </XmlDataProvider.XmlNamespaceManager>
       </XmlDataProvider>
       <DataTemplate x:Key="itemTemplate">
        <RadioButton GroupName="One">
          <Image Width="75" Height="75" Source="{Binding Mode=OneWay, XPath=media:thumbnail/@url}"/>
        </RadioButton>
       </DataTemplate>
       <ControlTemplate x:Key="controlTemplate" TargetType="{x:Type ItemsControl}">
          <WrapPanel IsItemsHost="True" Orientation="Horizontal"/>
       </ControlTemplate>
    </Grid.Resources>
    <ItemsControl
       Width="375"
       ItemsSource="{Binding Mode=Default, Source={StaticResource flickrdata}, XPath=/rss/channel/item}"
       ItemTemplate="{StaticResource itemTemplate}"
       Template="{StaticResource controlTemplate}">
    </ItemsControl>
 </Grid>

</Page> 
```

PS：为了分组到工作元素，单选按钮应该具有相同的父级（就像它们通常从 ItemsControl 生成时一样）

# asp.net - 哪些实用程序可以提供每页的数据库点击次数/持续时间？

> ID：170064
> 
> 赞同：0
> 
> 时间：2008-10-04T09:47:25.350
> 
> 标签：asp.net, sql-server, profiler

SQL Server Profiler 非常适合分析 Web 应用程序的 SQL Server 性能。但是，当我测试我的 web 应用程序时，我想要一个**每页**的数据库点击次数/持续时间的摘要。

有人知道任何实用程序可以为您提供此类信息吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T14:10:00.560

如果你想要每页的持续时间，我会推荐谷歌分析。

如果您想要数据库命中的摘要（即，您在一页加载期间运行三个过程，因此您希望显示三个），那么我建议您将审计代码添加到您的存储过程中。

或者（虽然在处理方面成本更高）您可以打开 SQL Profiler 或 SQL Trace，然后以这种方式跟踪数据库命中以对它们执行统计分析。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T20:51:07.053

我建议设置一个将用于所有站点的数据访问例程。

这个例程/类/或任何你喜欢的可以登录数据库或日志中的所有“命中”、它们的持续时间、错误（是任何）、超时等。

如果您正确编程，您将能够知道有多少 DB 命中/页面加载，avg(DBHit) + 您将免费获得“最长的 SProc，最短，更频繁地调用”。

这样做的积极方面是您不需要修改任何存储的过程，并且您可以在访问数据库时拥有一个不错的小“包装器”。

对于“每页持续时间”，如果您使用谷歌分析，您将无法将信息与您在数据库服务器上获得的信息合并回来。所以我建议记录对数据库中页面的每次访问。

然后你可以推断出 Page1.StartTime = getdate(), Page1.EndTime = (page2.Starttime-1 or session.log_off_time) 例如。[这有点基本，但根据您的环境，您可以改进它]。

# vba - 在 Excel VBA 中使用 New 关键字和调用 CreateObject 有什么区别？

> ID：170070
> 
> 赞同：11
> 
> 时间：2008-10-04T09:59:56.620
> 
> 标签：vba, excel, binding, com

我应该使用什么标准来决定是否编写这样的 VBA 代码：

```
Set xmlDocument = New MSXML2.DOMDocument 
```

或像这样：

```
Set xmlDocument = CreateObject("MSXML2.DOMDocument") 
```

?

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-04T10:22:50.880

只要变量没有被键入为对象

```
Dim xmlDocument as MSXML2.DOMDocument
Set xmlDocument = CreateObject("MSXML2.DOMDocument") 
```

是相同的

```
Dim xmlDocument as MSXML2.DOMDocument
Set xmlDocument = New MSXML2.DOMDocument 
```

两者都使用早期绑定。然而

```
Dim xmlDocument as Object
Set xmlDocument = CreateObject("MSXML2.DOMDocument") 
```

使用后期绑定。[请参阅此处](http://support.microsoft.com/kb/245115)的MSDN 。

在创建外部提供的对象时，New 运算符、将变量声明为 New 和使用 CreateObject 函数之间没有区别。

New 要求引用类型库。而 CreateObject 使用注册表。

CreateObject 可用于在远程机器上创建对象。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-06-21T00:52:23.243

您应该始终使用

`Set xmlDocument = CreateObject("MSXML2.DOMDocument")`

**这与绑定问题无关。只有声明决定了绑定。**

使用`CreateObject`独占将更容易在早期绑定和后期绑定之间切换，因为您只需更改声明行。

换句话说，如果你这样写：

`Dim xmlDocument As MSXML2.DOMDocument
Set xmlDocument = CreateObject("MSXML2.DOMDocument")`

然后，要切换到后期绑定，您只需要更改第一行 (to `As Object`)。

如果你这样写：

`Dim xmlDocument As MSXML2.DOMDocument
Set xmlDocument = New MSXML2.DOMDocument`

那么当你切换到后期绑定时，你必须改变这两行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T10:12:46.920

对于前者，您需要在应用程序中引用类型库。它通常会使用早期绑定（假设您将变量声明为 MSXML2.DOMDocument 而不是 Object，您可能会这样做），因此通常会更快并为您提供智能感知支持。

后者可用于使用其 ProgId 创建对象的实例，而无需类型库。通常，您将使用后期绑定。

如果你有一个类型库，通常最好使用“As New”，并从早期绑定中受益。

# sql - SQL Server 2005 将变量设置为选择查询的结果

> ID：170078
> 
> 赞同：44
> 
> 时间：2008-10-04T10:13:22.287
> 
> 标签：sql, sql-server, sql-server-2005

如何在不使用存储过程的情况下将变量设置为选择查询的结果？

* * *

我想做类似的事情：OOdate DATETIME

```
SET OOdate = Select OO.Date 
FROM OLAP.OutageHours as OO
WHERE OO.OutageID = 1 
```

然后我想在这个查询中使用 OOdate：

```
SELECT COUNT(FF.HALID) from Outages.FaultsInOutages as OFIO
INNER join Faults.Faults as FF ON FF.HALID = OFIO.HALID
WHERE CONVERT(VARCHAR(10),OO.Date,126) = CONVERT(VARCHAR(10),FF.FaultDate,126)) 
AND
OFIO.OutageID = 1 
```

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-10-04T10:26:02.463

你可以使用类似的东西

```
SET @cnt = (SELECT COUNT(*) FROM User) 
```

或者

```
SELECT @cnt = (COUNT(*) FROM User) 
```

为此，SELECT 必须返回单个列和单个结果，并且 SELECT 语句必须在括号中。

**编辑**：你有没有尝试过这样的事情？

```
DECLARE @OOdate DATETIME

SET @OOdate = Select OO.Date from OLAP.OutageHours as OO where OO.OutageID = 1

Select COUNT(FF.HALID) 
from Outages.FaultsInOutages as OFIO 
inner join Faults.Faults as FF 
    ON FF.HALID = OFIO.HALID 
WHERE @OODate = FF.FaultDate
    AND OFIO.OutageID = 1 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-10-05T15:41:21.297

-- Sql Server 2005 管理工作室

```
 use Master
go
DECLARE @MyVar bigint
SET @myvar = (SELECT count(*) FROM spt_values);
SELECT @myvar 
结果：2346（在我的数据库中）

```

--**注意：** @myvar = @Myvar

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T10:23:30.860

你可以使用：

```
declare @foo as nvarchar(25)

select @foo = 'bar'

select @foo 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T19:04:43.790

您也可以将第一个 SELECT 放在子查询中。由于大多数优化器无论如何都会将其折叠成一个常数，因此不应该对性能造成影响。

顺便说一句，由于您使用的是这样的谓词：

```
CONVERT(...) = CONVERT(...) 
```

该谓词表达式无法正确优化或在 CONVERT() 函数引用的列上使用索引。

这是使原始查询更好的一种方法：

```
DECLARE @ooDate datetime
SELECT @ooDate = OO.Date FROM OLAP.OutageHours AS OO where OO.OutageID = 1

SELECT 
  COUNT(FF.HALID)
FROM
  Outages.FaultsInOutages AS OFIO 
  INNER JOIN Faults.Faults as FF ON 
    FF.HALID = OFIO.HALID 
WHERE
  FF.FaultDate >= @ooDate AND
  FF.FaultDate < DATEADD(day, 1, @ooDate) AND
  OFIO.OutageID = 1 
```

此版本可以利用涉及 FaultDate 的索引，并达到相同的目标。

在这里，重写为使用子查询来避免变量声明和随后的 SELECT。

```
SELECT 
  COUNT(FF.HALID)
FROM
  Outages.FaultsInOutages AS OFIO 
  INNER JOIN Faults.Faults as FF ON 
    FF.HALID = OFIO.HALID 
WHERE
  CONVERT(varchar(10), FF.FaultDate, 126) = (SELECT CONVERT(varchar(10), OO.Date, 126) FROM OLAP.OutageHours AS OO where OO.OutageID = 1) AND
  OFIO.OutageID = 1 
```

请注意，由于在 FF.FaultDate 上使用了 CONVERT()，此方法与原始方法具有相同的索引使用问题。这可以通过添加子查询两次来解决，但在这种情况下，使用变量方法会更好。最后一个版本仅用于演示。

问候。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-11-14T13:25:40.033

这将适用于原始问题：

```
DECLARE @Result INT;
SELECT @Result = COUNT(*)
FROM  TableName
WHERE Condition 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-04T10:21:26.730

你到底是什么意思？是否要将查询结果重用于其他查询？

在这种情况下，你为什么不结合两个查询，通过在第一个查询的结果中进行第二个查询搜索`(SELECT xxx in (SELECT yyy...)`

# axapta - 如何在 Axapta 3.0 中创建 X++ 批处理作业？

> ID：170088
> 
> 赞同：4
> 
> 时间：2008-10-04T10:25:12.277
> 
> 标签：axapta, x++

我想在 X++ 中为 Microsoft Axapta 3.0 (Dynamics AX) 创建一个批处理作业。

如何创建一个执行像这样的 X++ 函数的作业？

```
static void ExternalDataRead(Args _args)
{
...
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-05T03:10:36.007

这是在 AX 中创建批处理作业所需的最低要求：

通过创建一个扩展`RunBaseBatch`类的新类来创建批处理作业：

```
class MyBatchJob extends RunBaseBatch
{
} 
```

实现抽象方法`pack()`：

```
public container pack()
{
    return connull();
} 
```

实现抽象方法`unpack()`：

```
public boolean unpack(container packedClass)
{
    return true;
} 
```

`run()`用您要执行的代码覆盖该方法：

```
public void run()
{
    ;
    ...
    info("MyBatchJob completed");
} 
```

向您的类添加一个静态`main`方法以创建您的类的实例并调用标准`RunBaseBatch`对话框：

```
static void main(Args _args)
{
    MyBatchJob myBatchJob = new MyBatchJob();
    ;
    if(myBatchJob.prompt())
    {
        myBatchJob.run();
    }
} 
```

如果您希望批处理作业在批处理列表中有描述，请在`description`您的类中添加一个静态方法：

```
server client static public ClassDescription description()
{
    return "My batch job";
} 
```

# gdb - 将 gdb 添加到 MinGW

> ID：170097
> 
> 赞同：27
> 
> 时间：2008-10-04T10:35:46.593
> 
> 标签：gdb, mingw

我去了[http://sourceforge.net/project/showfiles.php?group_id=2435](http://sourceforge.net/project/showfiles.php?group_id=2435)，下载了 MinGW 5.1.4 的自动 MinGW 安装程序，同时下载了 GNU Source-Level Debugger Release Candidate：GDB 6.8- 3\. 然后我将 MinGW 基础工具安装到 C:\MinGW。到目前为止没有问题。

但是，当我开始安装 gdb 调试器时，它有很多文件和文件夹，它们的名称与已安装的某些文件和文件夹的名称相同，但文件与已安装的文件和文件夹不同。例如 C:\MinGW\include\bfd.h 是 171 KB，但 gdb-6.8-mingw-3\include\bfd.h 是 184 KB。

如何在不破坏已安装内容的情况下将 gdb 添加到 MinGW？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2014-09-02T17:13:13.300

在命令提示符下，我浏览到 C:\MinGW\bin 并运行：

```
mingw-get.exe install gdb 
```

那为我修好了。不确定这是否重要，但我的路径中有 C:\MinGW\bin（我想我可能不需要浏览到 C:\MinGW\bin）。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-04T11:20:33.883

[项目文件页面](http://sourceforge.net/project/showfiles.php?group_id=2435&package_id=20507)上的*当前版本*(5.2.1) 版本的 gdb一直对我有用。下载的是一个独立的.exe，你不需要其他任何东西。

但我敢打赌 6.8 包中的 .exe 也可以工作。我会尝试只使用 .exe，然后如果有问题，请尝试从 6.8 包中提取其他文件。（尽管这可能会导致 MinGW 安装的其余部分出现问题。）

更新：似乎有一个 7.something 版本。我还没有彻底测试它，但它似乎工作，即使使用 gcc 3。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T11:52:09.170

获取[Wascana 桌面开发人员](http://wascana.sourceforge.net/)。它将 MinGW、gcc、Eclipse 和 gdb 组合在一个包中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T12:03:41.860

您可以使用 gdb tarball 中的（较新的）文件安全地覆盖使用 MinGW 预打包的文件。您也可以选择不覆盖它们——只需确保选择其中任意一组，即避免混合旧包和新包中的文件。

无论如何，大多数有问题的文件可能与您并不真正相关。例如，属于 libbfd 库的文件不是 gdb 日常操作所必需的，如果您想扩展调试器或自己编写调试工具，则使用它们。

无论如何，在解压新版本之前备份 mingw 目录。这很容易，因为 MinGW 在该目录中是自包含的。这样，如果出现任何故障，您只需删除目录并从备份中恢复即可。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-11-07T11:36:05.360

通常在 windows 中安装 gdb，你必须有 2 种安装方式：

1) 使用由某些提供商从 GNU gdb 构建和编译的现成二进制文件（易于安装）

*   使用从以下 URL 提供的 TDM-GCC 二进制文件，其中包括 gcc 编译器和 gdb 调试器。 [http://tdm-gcc.tdragon.net/](http://tdm-gcc.tdragon.net/)
*   使用已经编译和构建了 GNU GDB 的 Equation 包。 [http://www.equation.com/servlet/equation.cmd?fa=gdb](http://www.equation.com/servlet/equation.cmd?fa=gdb)

2）使用最小的mingw或cygwin包，然后在其中安装gdb。

*   安装已经提供 GDB 的 mingw 或 cygwin
*   打开 cygwin 或 mingw 终端，只需键入以下内容以确保它已安装

    $ gdb --版本

    1.  提示：如果您没有找到 gdb 安装，只需打开 cygwin 或 mingw 软件包安装程序并确保您已经检查了 gdb
    2.  提示：获取和安装[OHRRPGCE](http://hamsterrepublic.com/ohrrpgce/nightly/ohrrpgce-wip-directx-sdl-debug.zip)的调试版本提供了有关崩溃的有用信息。
*   从 cygwin 或 mingw 终端，使用以下 c:\mingw\bin\gdb.exe program_to_debug.exe 启动 gdb

参考：[http ://rpg.hamsterrepublic.com/ohrrpgce/GDB_on_Windows](http://rpg.hamsterrepublic.com/ohrrpgce/GDB_on_Windows)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-20T16:09:44.650

[TDM GCC/MinGW32 构建](http://www.tdragon.net/recentgcc/)安装程序包括 gdb 。它是 gcc 4.4.x，包含基本 Windows 开发所需的所有核心二进制包，并且被广泛使用，没有任何异常问题。

# .net - 基于业务逻辑屏蔽网络资源的策略是什么

> ID：170115
> 
> 赞同：0
> 
> 时间：2008-10-04T10:52:28.183
> 
> 标签：.net, asp.net, security

我有一个场景，我不确定我的方法是否是最好的，我将不胜感激反馈/建议。

场景：我有一堆基于 Flash (swf) 的“模块”，它们托管在我的 aspnet 应用程序中。每个闪存在文件系统上都有自己的目录，其中包含闪存的资产。考虑这个简化的站点结构：

*/webapp/index.aspx
/webapp/flash/flash1/flash.swf
/webapp/flash/flash1/someimage.jpg
/webapp/flash/flash1/someclip.mp3
/webapp/flash/flash2/flash.swf
/webapp/flash /flash2/someimage.jpg
/webapp/flash/flash2/someclip.mp3*

等等

其中命名约定是*/webapp/flash/flash[ID]/*

我想实现一种安全机制来检查是否应允许用户访问*子文件夹“[ID]”中的文件及其内容。

**在此处根据存储在 SQL 数据库中的信息插入业务逻辑*

我正在考虑编写一个 HttpModule 来做类似的事情

```
ProcessRequest(){
    if(Request.RawUrl.Contains("/webapp/flash") && !userHasValidLicenseForModule(1)){
        Redirect("login.aspx");    
    }
} 
```

但是有一个缺点是 HttpModule 仅适用于映射到 aspnet（在 IIS6 中）的文件扩展名。这意味着我必须将所有可能的扩展映射到该过程（.mp3、.jpg 等），这是我宁愿避免的。

我也在考虑改用 HttpHandler，但 Flash 文件需要能够使用相对 URL 链接到它的资源。（所以不喜欢像 /webapp/getprotectedstuff.ashx?file=flash1234/flash.swf 这样的代理模式）

将 Flash 文件和资产完全存储在 Web 根目录之外可能更明智。也许还有其他我没有想到的策略。

使用 aspnet 安全性并编写自定义会员提供程序？

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T11:01:37.650

您是否考虑过在 swf 加载后通过对服务器的 HTTP 请求简单地验证资源访问？

在我工作的地方，我们通过 flash 向用户提供在线培训，但不是验证 HTTP 请求本身，而是允许先加载 swf，然后向服务器发出请求，以验证用户是否应该有权访问 swf，并且他们是从我们的网站内而不是从其他位置访问 swf。

如果验证的任何步骤失败（它无法在必要的位置找到身份验证文件，或者用户没有有效的会话或无权访问特定的培训），那么他们会在 flash 中收到错误并且没有任何重要的内容加载。

另请注意，如果您确实决定要严格限制对文件的访问，以便它们只能由应该有权访问的人加载，那么我可能会建议使用您的第二个选项，将文件存储在一个单独的、非-public 位置，然后使用处理程序脚本加载 swf。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-05T01:28:35.590

为什么不使用 ISAPI 过滤器？
好的，不要回答这个问题 - 有很多原因;-)。但说真的，如果你有开发能力，你可能要考虑这条路线。

否则，如果你有一个简短的、封闭的扩展列表，你必须处理（GIF、JPG、MP3），那么 HTTP 模块确实看起来更好。如果它很长，或者是开放式的，我会同意并放弃。

如果适用，您可能想要研究的另一个选项是基于角色的 NTFS 访问列表。如果这适合，它可能是最简单和最干净的方法。

# sql - 在存储过程中使用 Case 语句而不是 If 语句的好处？

> ID：170130
> 
> 赞同：1
> 
> 时间：2008-10-04T11:01:40.083
> 
> 标签：sql, sql-server, stored-procedures

嗨，当使用 IF 语句或选择使用 CASE 语句时，存储过程的执行速度有什么优缺点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T11:09:18.977

`IF`如果可以避免，我尽量不使用s，因为它们`IF`是非事务`BEGIN... END`性的，即您通常不能保证`IF`.

例如，我假设您的意思是`CASE`在 SQL 中使用语句`SELECT`。如果使用是为了避免`IF`然后，请务必这样做。

SQL 的黄金法则是：*让服务器弄清楚如何做事，告诉服务器你想要什么*。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T11:18:38.893

不要担心 case 和 IF 语句之间的速度差异。因为您正在处理数据库，所以从磁盘写入或读取所需的时间将比 CPU 通过 IF 或 Case 分支所需的时间相形见绌。相反，您应该专注于使您的代码更具可读性和可维护性。

# wix - 如何使用 WiX 将交互式用户添加到本地化 Windows 中的目录？

> ID：170140
> 
> 赞同：4
> 
> 时间：2008-10-04T11:05:33.600
> 
> 标签：wix, windows-installer

如何添加瑞典互动用户，

```
NT INSTANS\INTERAKTIV 
```

或英语互动用户，

```
NT AUTHORITY\INTERACTIVE 
```

或任何其他对程序文件夹的 ACL 具有**写入**权限的本地化用户组？

这个问题实际上是“我如何使用**secureObject** ”吗？我无法使用**LockPermissions 表**，因为我不知道继承已被删除。**secureObject**权限似乎需要**CreateDirectory**而不是**Directory** ...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T17:57:24.283

在最近发布的 Wix 中，您可以通过属性检索常用内置用户名和组名的本地化名称。例如，`WIX_ACCOUNT_NETWORKSERVICE`包含网络服务帐户的本地化名称。不幸的是，截至 3.0.4513`NT AUTHORITY\INTERACTIVE`不在其中。

存在为许多内置用户和组名称创建属性的示例 MSI 自定义操作。 [在这里得到它](http://www.installsite.org/files/iswi/SIDLookup.zip)。将 CA 添加到您的 Wix 安装程序并在安装执行序列的早期安排它。

获得本地化帐户名称后，添加 PermissionEx 元素以修改目录的 ACL。例如：

```
<Directory ...>
   <Component ...>
      <CreateFolder>
         <PermissionEx User="[SID_INTERACTIVE]" .../>
      </CreateFolder>
   </Component ...>
</Directory ...> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T11:59:22.183

无法将这两个帐户名称添加到 ACL，因为它们是一个且相同的*。*您看到的名称对应于一个 SID，并且该 SID 在英语和瑞典语本地化中是相同的。在 INTERACTIVE 组的情况下，该 SID 是`S-1-5-4`。

我很久没有关注 WiX，但我希望必须有一种方法可以为 ACL 指定 SID 而不是帐户名称。除非绝对无法避免，否则您永远不应依赖知名帐户的帐户名称。以下是供参考[的知名 SID 列表。](http://www.siao2.com/2008/06/24/8639579.aspx)

编辑：[这篇文章](http://social.msdn.microsoft.com/Forums/en-US/vssetup/thread/39d9e905-2b35-4ce9-a544-4564f6b5a376/)似乎为您的问题提供了一个解决方案，使用自定义操作将 SID 转换为帐户名称 - 显然 WiX 不支持将 SID 用于 Permission 或 PermissionEx 对象。

这里是微软知识库[Q243330](http://support.microsoft.com/default.aspx?scid=kb;EN-US;Q243330)中更权威的知名 SID 列表。

# installation - 如何使用自定义操作在 WiX 中运行脚本 - 最简单的示例？

> ID：170144
> 
> 赞同：13
> 
> 时间：2008-10-04T11:09:05.933
> 
> 标签：installation, wix, windows-installer

新手 WiX 问题：我该怎么做
1\. 将一次性 shell 脚本与安装程序一起复制到 temp 中，
例如

```
 <Binary Id='permissions.cmd' src='permissions.cmd'/> 
```

2\. 在安装结束时找到并运行该脚本。
例如

```
<CustomAction Id='SetFolderPermissions' BinaryKey='permissions.cmd' 
    ExeCommand='permissions.cmd' Return='ignore'/>  

<InstallExecuteSequence>
    <Custom Action="SetFolderPermissions" Sequence='1'/>
</InstallExecuteSequence> 
```

我认为我至少有三个问题：

*   我找不到**permissions.cmd**来运行它 - 我需要**[TEMPDIR]permissions.cmd**还是什么？
*   在安装程序之前，我的**序列**来得太早了。
*   我需要**cmd /c permissions.cmd**在这里某处，可能在**ExeCommand**附近？

在此示例中， **permissions.cmd**使用**cacls.exe**将具有写入权限的交互式用户添加到**%ProgramFiles%\Vendor** ACL。我也可以使用**secureObject** - 这个问题是**[“如何将交互式用户添加到本地化Windows 中的目录”？](https://stackoverflow.com/questions/170140/how-do-i-add-the-interactive-user-to-a-directory-in-a-localized-windows)**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-06T20:15:23.607

这是一个工作示例（用于设置权限，而不是用于运行脚本）：

```
<Directory Id="TARGETDIR" Name="SourceDir">
  <Directory Id="ProgramFilesFolder" Name="PFiles">
    <Directory Id="BaseDir" Name="MyCo">
      <Directory Id="INSTALLDIR" Name="MyApp" LongName="MyProd">

        <!-- Create the folder, so that ACLs can be set to NetworkService -->
        <Component Id="TheDestFolder" Guid="{333374B0-FFFF-4F9F-8CB1-D9737F658D51}"
                   DiskId="1"  KeyPath="yes">
          <CreateFolder Directory="INSTALLDIR">
            <Permission User="NetworkService"
                        Extended="yes"
                        Delete="yes"
                        GenericAll="yes">
            </Permission>
          </CreateFolder>
        </Component>

      </Directory>
    </Directory>
  </Directory>
</Directory> 
```

请注意，这是在 Permission 标签中使用 'Extended="Yes"'，因此它使用的是 SecureObjects 表和自定义操作，而不是 LockPermissions 表（请参阅[WiX 文档中的 Permission Element](http://wix.sourceforge.net/manual-wix2/wix_xsd_permission.htm)）。在此示例中，SecureObjects 应用于 MyProd 目录的权限由子目录继承，而使用 LockPermissions 时则不是这种情况。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-04T14:23:56.493

我发现博客文章*[从 MSI 到 WiX，第 5 部分 - 自定义操作：介绍](http://blogs.technet.com/alexshev/archive/2008/02/21/from-msi-to-wix-part-5-custom-actions.aspx)*在我想了解 WiX 中的自定义操作时很有帮助。

*[您还可以在CustomAction 元素](http://wix.sourceforge.net/manual-wix2/wix_xsd_customaction.htm)*中找到 CustomAction 的定义及其属性。

你需要做这样的事情

```
<CustomAction Id="CallCmd" Value="[SystemFolder]cmd.exe" />
<CustomAction Id="RunCmd"  ExeCommand="/c permission.cmd" />
<InstallExecuteSequence>
    <Custom Action="CallCmd" After="InstallInitialize" />
    <Custom Action="RunCmd" After="CallCmd" />
</InstallExecuteSequence> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T23:03:24.943

[您可以尝试使用Permission 元素](http://www.wixwiki.com/index.php?title=Permission_Element)作为 CreateFolder 元素的子元素，而不是运行自定义操作，例如：

```
<CreateFolder>
  <Permission User='INTERACTIVE' GenericRead='yes' GenericWrite='yes' 
              GenericExecute='yes' Delete='yes' DeleteChild='yes' />
  <Permission User='Administrators' GenericAll='yes' />
</CreateFolder> 
```

> 这会覆盖还是仅编辑文件夹的 ACL？

根据[MSDN 文档](http://msdn.microsoft.com/en-us/library/aa369774(VS.85).aspx)，它覆盖：

> LockPermissions 表中列出的每个文件、注册表项或目录都会收到一个明确的安全描述符，无论它是否替换现有对象。

我刚刚通过在 Windows 2000 上运行测试安装确认了这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T14:04:44.453

你有一个如何使用它的例子吗？我的意思是，是否使用嵌套*在*我要更改其 ACL 的目录下的**CreateFolder ？**还是我先单独使用**CreateFolder ？**以下是否接近？

 ***```
<Wix xmlns="http://schemas.microsoft.com/wix/2003/01/wi">
<Fragment>
  <DirectoryRef Id="TARGETDIR">
    <Directory Id='ProgramFilesFolder' Name='PFiles'>
      <Directory Id="directory0" Name="MyApp" LongName="My Application">
        <Component Id="component0" DiskId="1" Guid="AABBCCDD-EEFF-1122-3344-556677889900">

          <CreateFolder>
            <Permission User='INTERACTIVE' 
              GenericRead='yes' 
              GenericWrite='yes' 
              GenericExecute='yes' 
              Delete='yes' 
              DeleteChild='yes' />
            <Permission User='Administrators' GenericAll='yes' />
          </CreateFolder>

          <File Id="file0" Name="myapp.exe" Vital="yes" Source="myapp.exe">
            <Shortcut Id="StartMenuIcon" Directory="ProgramMenuFolder" Name="MyApp" LongName="My Application" />
          </File>
        </Component>
      <Directory Id="directory1" Name="SubDir" LongName="Sub Directory 1">
        <Component Id="component1" DiskId="1" Guid="A9B4D6FD-B67A-40b1-B518-A39F1D145FF8">
          etc...
          etc...
          etc...
        </Component>
      </Directory>
    </Directory>
  </DirectoryRef>
</Fragment> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T06:57:19.117

大多数人倾向于避开 lockPermissions 表，因为它不是附加的，这意味着它将覆盖您当前的权限（从托管环境的角度来看，这很糟糕）。我建议您使用支持[ACL](https://en.wikipedia.org/wiki/Access_control_list)继承的工具，例如 SUBINACL 或 SETACL 或众多 ACL 工具之一。

关于您之前的帖子失败的原因，有几个原因。您可以在四个位置放置自定义操作 (CA)：UI、立即、延迟和提交/回滚。

您需要您的 CA 在延迟序列中设置权限，因为文件直到延迟序列的中途才会出现。因此，之前的任何事情都会失败。

1.  您的设置立即生效（因此会失败）
2.  您的设置顺序为 1（无法推迟，因此会失败）

您需要添加一个属性`Execute="Deferred"`并将序列从“1”更改为：

```
<Custom Action="CallCmd" Execute="Deferred" Before="InstallFinalize" /> 
```

这将确保在安装文件之后，但在延迟阶段（所需位置）结束之前完成。

我还建议您直接调用 EXE 文件，而不是从批处理文件中调用。安装程序服务将直接在您需要的上下文中启动和 EXE 文件。使用批处理文件将在正确的上下文中启动批处理文件，并可能在执行时将上下文丢失给不想要的帐户。

# registration - 防止用户启动多个帐户？

> ID：170152
> 
> 赞同：36
> 
> 时间：2008-10-04T11:12:10.170
> 
> 标签：registration, accounts, user-identification

我知道，到头来，做不到。

但是，有哪些选择：

  a) 限制人员创建多个帐户的选项，
  b) 增加检测多个帐户/人的机会

对于类似博客的 Web 服务？
（人们可以注册自己的博客）

**更新：**
我认为“限制选项”已经得到很好的回答。（没有可靠的方法，但我们可以提高标准）
但是，我仍然想知道还有哪些其他方法可以检测多个帐户？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-04T12:03:04.297

我假设你在谈论免费服务？我想不出任何既没有严重的缺点，也不会轻易被击败的方法。像设置 cookie、要求唯一的电子邮件地址这样的事情很容易被打败。

要求唯一的 IP 地址并非万无一失，但在某种程度上可能会起作用，直到您拥有大量用户并收到代理背后的人的投诉。

最好的方法是收费或要求人们提供某种个人信息，例如您验证的真实姓名/电话/地址，或 CC 号码，但这是侵入性的（同样，您可能只需要愿意提供的认真用户这种信息）。

我想我会转过头来问“你为什么不想让人们拥有多个帐户？”

无论您的根本原因是什么，都可能有一些其他的方法来缓解，即如果您担心大量孤立的博客，您可以扫描一段时间的不活动并禁用它们，或者至少安排它们让人类查看。如果您担心垃圾博客，您可以定期扫描所有博客内容以查找垃圾内容。如果您担心机器人并使用一些通用软件（如 WordPress），请更改表单变量的名称，否则会保护您的表单免受机器人的侵害。

一定要考虑其他解决问题的方法，因为如果它是像 Blogger 这样的典型免费服务，您将无法阻止人们注册多个帐户。

至于检测一个人的多个帐户，您需要做的第一件事是有一个日志文件存储每个用户登录的完整数据（用户名、时间戳、IP、用户代理等），然后您可以稍后对其进行分析。我将列出一些需要注意的事项，但仅通过仔细研究日志文件，您可能会发现其他模式。要寻找的一些想法是：

*   设置跟踪cookie（即随机哈希）并在登录时记录其值，从相同的cookie值中查找多个登录
*   来自相同 IP 地址/用户代理组合的登录
*   仅从相同 IP 地址登录（不如前两个项目符号可靠）
*   具有来自免费网络邮件服务（Gmail 等）的电子邮件地址的帐户
*   具有相同密码的帐户

如果您担心垃圾博客，您可以尝试对博客内容进行一些分析，即提取所有`<a href>`s 并查找博客之间的相关性。您可以通过诸如 SpamAssassin 之类的内容运行博客内容本身，或者以其他方式过滤诸如“伟哥”和“劳力士”之类的垃圾信息。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-04T11:27:51.667

我认为最好的方法是取消创建多个帐户的激励措施。

您是否以任何方式限制用户？可以通过创建多个帐户（轻松）克服这些限制吗？如果是这样，那么也许您应该考虑取消这些限制。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-04T11:33:44.603

您可以在创建帐户之前向用户发送 SMS 消息进行验证。由于人们无法像获得电子邮件地址那样容易地获得手机号码，因此这可能会奏效。有些人可能可以获得两个或三个帐户，但不是无限数量。有许多服务可以让您以编程方式发送 SMS 消息，包括[Gizmo SMS](http://gizmosms.com/)、[Text4Free](http://www.text4free.net/)和[TxtDrop](http://www.txtdrop.com/)。

当然，这需要用户有手机，并且愿意为你提供号码。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-02-15T11:14:42.373

您可以设置一个跨浏览器 cookie，例如[http://samy.pl/evercookie/（flash](http://samy.pl/evercookie/) cookie） 浏览器 cookie 删除不能删除它们永远保持 4，您可以跨浏览器读取 cookie。如果用户使用同一台计算机，它是最终的解决方案。如果有超过 1 台计算机，IP 地址是您找出的唯一方法，但（在我的情况下）有时 2 个真实的人在同一个房子里用 2 台计算机登录 2 我的网站

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-04T11:42:06.833

要求用户使用信用卡注册。您无需向该卡收取任何费用，您只需检查该卡是否有效即可。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-07-24T19:29:16.800

我认为另一个方向是让“大男孩”去做。

[http://oauth.net/](http://oauth.net/)

将您网站的身份验证卸载到知名的第三方，如 Google 或 Facebook。它不会防止重复帐户，但很高兴认为最新的垃圾邮件预防和诸如此类的东西会自动为您实施。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-04T11:23:01.490

你不能也不应该。您不是在与现实世界的人打交道，而是在与帐户打交道，因此请将它们视为具有平等生存权的抽象实体。

我可以即时想象的一些选项：

--电子邮件地址只有一个帐户。但我可以创建不止一封电子邮件......或使用 Mailinator。

-- 冗长乏味的验证程序。但这会阻止用户注册

-- 将 IP 绑定到帐户并阻止（暂时？）该 IP 创建另一个帐户。但是具有相同网关的两个不同用户将被阻止...

-- 使用cookies。但是用户可以删除它们。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-05T02:00:13.187

我在现实生活中见过的最难破解的方法是使用单独的硬件介质进行确认（通过 SMS 发送确认码用于公共服务，或邮寄 RSA 令牌以获得更敏感的东西，如 Intranet 访问），或要求提供具有财务约束力的身份证明，例如银行帐号（Paypal 向您的帐户存入几美分，金额总和就是您的密码）或有效的信用卡号。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-04T11:17:13.920

一种常见的选择是通过他们的电子邮件验证人的身份。实际上让他们回复发送到他们帐户的电子邮件。一些网站更进一步，不允许来自 yahoo、g-mail、hotmail 等域的地址......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-01-15T15:28:15.003

I think, as many people have mentioned above, one of the best ways is to verify mobile numbers and that's what I wanted to use in teh first place, if it wasnt so damn expensive ...

I have found this site [here](https://www.cognalys.com/) and I think it can be used for this purpose but I havent tested it myself, but it seems pretty modern and cheap

# javascript - 如何在 IE 中调试 JavaScript？

> ID：170164
> 
> 赞同：10
> 
> 时间：2008-10-04T11:22:47.170
> 
> 标签：javascript, internet-explorer

有没有比 MS 脚本编辑器更好的调试 JavaScript 的方法？我正在寻找类似 Firebug 的东西。不过，Firebug Lite 不提供此功能。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-04T11:26:10.610

使用 Visual Studio 2008。

Nikhilk 的 Web 开发助手和 Internet Explorer 开发工具栏 ( [http://www.microsoft.com/en-us/download/details.aspx?id=18359](http://www.microsoft.com/en-us/download/details.aspx?id=18359) ) 都很有用。虽然它们不如 FireBug :-(

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-04T11:47:44.747

虽然不是严格的调试器，但这些对您的武器库来说是有用的工具

*   [http://www.debugbar.com/](http://www.debugbar.com/)
*   [http://projects.nikhilk.net/WebDevHelper/](http://projects.nikhilk.net/WebDevHelper/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T11:47:25.560

我用过 IE WebDeveloper。它不是免费的，也没有 Firebug 好用，但它为我完成了工作。[http://www.ieinspector.com/dominspector/index.html](http://www.ieinspector.com/dominspector/index.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T12:57:06.667

IE 上下文中唯一的其他 JavaScript 调试器是 Visual Studio，但它会花费您。您在使用脚本调试器时遇到了什么问题，导致您认为您需要更好的调试器？

我怀疑您所追求的不是专门用于调试 JavaScript 而是分析已被 JavaScript 修改的 HTML DOM 以及监视与服务器的对话的附加功能。

[我发现IE 开发者工具栏](http://www.microsoft.com/en-us/download/details.aspx?id=18359)和[Fiddler](http://www.telerik.com/fiddler)一样对于调试 Web 应用程序特别有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-04T18:25:49.827

我会尝试去[DebugBar](http://www.my-debugbar.com/wiki/)。它不如 Firebug 好，但它对 javascript 调试非常有用......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-19T14:55:14.787

有一篇[博客文章](http://notetodogself.blogspot.com/2008/08/debug-javascript-in-ie.html)介绍了大多数在 IE 中调试 javascript 的已知方法，并各有优缺点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-04-16T18:28:04.993

伟大的文章 mkoryak

我在这篇链接的文章 [http://www.berniecode.com/blog/2007/03/08/how-to-debug-javascript-with-visual-web-developer-express/中使用了 Visual Studio Web Developer](http://www.berniecode.com/blog/2007/03/08/how-to-debug-javascript-with-visual-web-developer-express/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-04T18:10:52.040

您可以免费下载[Microsoft Visual Web Developer 2008 Express Edition](http://www.microsoft.com/express/vwd/)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-06-12T06:33:04.143

在较新版本的 Internet Explorer（我猜是 10.0+）中集成了开发人员工具。

那里的[调试器面板](https://msdn.microsoft.com/de-de/library/bg182326%28v=vs.85%29#Tool__Debugger___STRG_3_)允许您像在 Firebug、Firefox DevTools 或 Chrome DevTools 中一样调试 JavaScript。

# jquery - jQuery 模板引擎

> ID：170168
> 
> 赞同：205
> 
> 时间：2008-10-04T11:25:10.223
> 
> 标签：jquery, templates, jsrender

我正在寻找一个模板引擎来使用客户端。我一直在尝试一些像 jsRepeater 和 jQuery 模板。虽然它们在 FireFox 中似乎工作正常，但在 IE7 中，当归结为呈现 HTML 表格时，它们似乎都崩溃了。

我还查看了 MicrosoftAjaxTemplates.js （来自[http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=16766](http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=16766)），但事实证明也有同样的问题。

关于使用其他模板引擎的任何建议？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-10-15T03:01:45.010

查看 Rick Strahl 的帖子[Client Templating with jQuery](http://www.west-wind.com/weblog/posts/509108.aspx)。他探索了 jTemplates，但随后为 John Resig 的[微模板解决方案](http://ejohn.org/blog/javascript-micro-templating/)提供了一个更好的案例，甚至对其进行了一些改进。很好的比较，大量的样本。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2010-07-16T15:47:20.183

刚刚对此进行了一些研究，我将使用[jquery-tmpl](http://github.com/jquery/jquery-tmpl)。为什么？

1.  这是约翰·雷西格写的。
2.  它将由核心 jQuery 团队作为“官方”插件维护。 **编辑：jQuery 团队已弃用此插件。**
3.  它在简单性和功能性之间取得了完美的平衡。
4.  它有一个非常干净和深思熟虑的语法。
5.  它默认为 HTML 编码。
6.  它具有高度可扩展性。

更多信息：http: [//forum.jquery.com/topic/template-syntax](http://forum.jquery.com/topic/templating-syntax)

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-08-17T10:27:09.917

jQote：[http ://aefxx.com/jquery-plugins/jqote/](http://aefxx.com/jquery-plugins/jqote/)

有人拿了 Resig 的微模板解决方案，打包成一个 jQuery 插件。

在 Resig 发布他自己的（如果他发布他自己的）之前，我将一直使用它。

感谢您的提示，ewbi。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-08-07T07:13:10.197

[jQuery纳米](http://github.com/trix/nano)：

> ### 模板引擎
> 
> ***基本用法***
> 
> 假设您有以下 JSON 响应：
> 
> ```
> data = {
>   user: {
>     login: "tomek",
>     first_name: "Thomas",
>     last_name: "Mazur",
>     account: {
>       status: "active",
>       expires_at: "2009-12-31"
>     }
>   }
> } 
> ```
> 
> 你（们）能做到：
> 
> ```
> nano("<p>Hello {user.first_name} {user.last_name}! Your account is <strong>{user.account.status}</strong></p>", data) 
> ```
> 
> 你准备好了字符串：
> 
> ```
> <p>Hello Thomas Mazur! Your account is <strong>active</strong></p> 
> ```
> 
> 测试页面...

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2010-10-07T15:41:14.177

jQuery-tmpl 将在 jQuery 1.5 开始的 jQuery 核心中：

[http://blog.jquery.com/2010/10/04/new-official-jquery-plugins-provide-templating-data-linking-and-globalization/](http://blog.jquery.com/2010/10/04/new-official-jquery-plugins-provide-templating-data-linking-and-globalization/)

官方文档在这里：

[http://api.jquery.com/category/plugins/templates/](http://api.jquery.com/category/plugins/templates/)

* * *

编辑：它已被排除在 jQuery 1.5 之外，现在将由 jQuery UI 团队进行协调，因为它将成为即将到来的 jQuery UI Grid 的依赖项。

[http://blog.jquery.it/2011/04/16/official-plugins-a-change-in-the-roadmap/](http://blog.jquery.it/2011/04/16/official-plugins-a-change-in-the-roadmap/)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-10-04T13:33:24.940

不确定它如何处理您的特定问题，但也有[PURE](http://beebole.com/pure/index.html)模板引擎。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-02-29T03:30:37.340

这取决于您如何定义“最佳”，请参阅我关于该主题[的帖子](http://www.quora.com/What-is-the-best-JavaScript-templating-framework-and-why/answer/Eran-Medan)

如果您寻找**最快**的，这里有一个不错的[基准](http://jsperf.com/dom-vs-innerhtml-based-templating/350)，似乎[DoT](https://github.com/olado/doT)获胜，而其他所有人都落后了

如果您正在寻找最**官方**的JQuery 插件，这是我发现的

**第一部分：jQuery 模板**

测试版，[临时官方的](http://weblogs.asp.net/scottgu/archive/2010/10/04/jquery-templates-data-link-and-globalization-accepted-as-official-jquery-plugins.aspx)JQuery 模板插件是这个 [http://api.jquery.com/category/plugins/templates/](http://api.jquery.com/category/plugins/templates/)

但显然，不久前它决定将其保留在 Beta 中......

> 注意：jQuery 团队决定不让这个插件超过 beta。它不再被积极开发或维护。文档暂时保留在这里（供参考），直到准备好合适的替换模板插件。

**第二部分：下一步**

新的[路线图](http://blog.jquery.com/2011/04/16/official-plugins-a-change-in-the-roadmap/)似乎针对一组新的插件，**JSRender**（独立于 DOM 甚至 JQuery 模板渲染引擎）和**JSViews**，它们具有一些很好的数据绑定和观察者/可观察模式实现

这是有关该主题的博客文章

[http://www.borismoore.com/2011/10/jquery-templates-and-jsviews-roadmap.html](http://www.borismoore.com/2011/10/jquery-templates-and-jsviews-roadmap.html)

这是最新的来源

*   JSViews [https://github.com/BorisMoore/jsviews](https://github.com/BorisMoore/jsviews)
*   JSRender [https://github.com/BorisMoore/jsrender](https://github.com/BorisMoore/jsrender)

其他资源

*   关于该主题的精彩演示[http://www.slideshare.net/BorisMoore/jsviews-next-generation-jquery-templates](http://www.slideshare.net/BorisMoore/jsviews-next-generation-jquery-templates)

*   工作演示：[http ://borismoore.github.com/jsviews/demos/index.html](http://borismoore.github.com/jsviews/demos/index.html)

请注意，它甚至还不是测试版，只是一个路线图项目，但似乎是成为模板和 UI 绑定的官方 JQuery/JQueryUI 扩展的不错选择

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-11-08T22:04:32.627

只做傻子^^

```
// LighTest TPL
$.tpl = function(tpl, val) {
    for (var p in val)
        tpl = tpl.replace(new RegExp('({'+p+'})', 'g'), val[p] || '');
    return tpl;
};
// Routine...
var dataObj = [{id:1, title:'toto'}, {id:2, title:'tutu'}],
    tplHtml = '<div>N°{id} - {title}</div>',
    newHtml    = '';
$.each(dataObj, function(i, val) {
     newHtml += $.tpl(tplHtml, val);
});
var $newHtml = $(newHtml).appendTo('body'); 
```

[http://jsfiddle.net/molokoloco/w8xSx/](http://jsfiddle.net/molokoloco/w8xSx/) ;)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-04T13:40:11.073

这不是特定于 jsquery 的，但这是 google 作为开源发布的基于 JS 的模板库：

[http://code.google.com/p/google-jstemplate/](http://code.google.com/p/google-jstemplate/)

这允许使用 DOM 元素作为模板，并且是可重入的（因为模板渲染的输出仍然是可以使用不同数据模型重新渲染的模板）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-07-29T04:43:37.643

其他人指出了 jquery-tmpl，我赞成这些答案。但一定要看看 github forks。

那里有重要的修复和有趣的功能。 [http://github.com/jquery/jquery-tmpl/network](http://github.com/jquery/jquery-tmpl/network)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-18T14:35:38.573

John Resig 在他的博客上发布了一个。[http://ejohn.org/blog/javascript-micro-template/](http://ejohn.org/blog/javascript-micro-templating/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-19T03:53:05.010

如果您在 .NET Framework 2.0/3.5 中工作，您应该查看由 http://JsonFx.net 实现的[JBST](http://jsonfx.net/download/#ajax)。它有一个客户端模板解决方案，该解决方案具有熟悉的 JSP/ASP 语法，但在构建时为紧凑的可缓存模板进行了预编译，这些模板不需要在运行时进行解析。它适用于 jQuery 和其他 JavaScript 库，因为模板本身被编译为纯 JavaScript。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-04-28T21:21:20.897

我正在使用 jtemplates jquery 插件，但性能真的很差。我切换到了性能更好的 trimpath ( [http://code.google.com/p/trimpath/wiki/JavaScriptTemplates )。](http://code.google.com/p/trimpath/wiki/JavaScriptTemplates)我没有注意到 IE7 或 FF 有任何问题。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-03-29T21:54:04.667

对于非常轻松的工作，jquery-tmpl 就足够了，但在某些情况下，它要求数据知道如何格式化自己（坏事！）。

如果您正在寻找功能更全的模板插件，我建议您使用[Orange-J](http://code.google.com/p/orange-j/)。它的灵感来自 Freemarker。它支持 if、else、循环对象和数组、内联 javascript，包括模板中的模板，并具有出色的输出格式选项（maxlen、wordboundary、htmlentities 等）。

哦，还有简单的语法。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-03-23T20:21:03.897

您可能需要考虑一下如何设计模板。

许多列出的模板解决方案（jQote、jquery-tmpl、jTemplates）的一个问题是它们要求您在 HTML 中插入非 HTML，这在 HTML 工具中或在与 HTML 设计人员的开发过程中可能会很痛苦. 我个人不喜欢这种方法的感觉，尽管它有其优点和缺点。

还有一类模板方法使用普通的 HTML，但允许您使用元素属性、CSS 类或外部映射来指示数据绑定。

[Knockout](http://knockoutjs.com/documentation/introduction.html)是这种方法的一个很好的例子，但我自己没有使用它，所以我将它留给投票来决定其他人是否喜欢它。至少在我有时间多玩它之前。

列为另一个答案的[PURE是这种方法的另一个例子。](http://beebole.com/pure/)

作为参考，您还可以查看[chain.js](https://github.com/raid-ox/chain.js/wiki/)，但自最初发布以来似乎没有太多更新。有关它的更多背景信息，请参见[http://javascriptly.com/2008/08/a-better-javascript-template-engine/](http://javascriptly.com/2008/08/a-better-javascript-template-engine/)。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-01-21T11:16:20.473

[Dropbox](http://www.dropbox.com)在网站上使用[John Resig 的模板引擎。](http://ejohn.org/blog/javascript-micro-templating/)他们稍作修改，您可以在Dropbox的这个[js 文件中进行检查。](https://dt8kf6553cww8.cloudfront.net/static/javascript/compiled/dropbox-mini-vflpTfE9D.js)在此文件中搜索 tmpl，您将获得模板引擎的代码。

谢谢。希望它对某人有用。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-05-30T12:37:56.200

我目前正在使用多 HTML 模板框架。这个框架使得在你的 DOM 中导入模板化数据变得更加容易。也很棒的 MVC 建模。

[http://www.enfusion-framework.org/](http://www.enfusion-framework.org/) （看看样本！）

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2010-11-04T21:41:44.687

beebole 还重写了 PURE - jquery 纯 html 模板 - [https://github.com/mpapis/jquery-pure-templates](https://github.com/mpapis/jquery-pure-templates)

它应该允许更多的自动渲染，主要使用 jquery 选择器，更重要的是它不需要将花哨的东西放入 HTML。

# javascript - 循环遍历jQuery中的元素

> ID：170180
> 
> 赞同：27
> 
> 时间：2008-10-04T11:39:25.497
> 
> 标签：javascript, jquery

我想遍历 HTML 表单的元素，并将 <input> 字段的值存储在一个对象中。但是，以下代码不起作用：

```
function config() {
    $("#frmMain").children().map(function() {
        var child = $("this");
        if (child.is(":checkbox"))
            this[child.attr("name")] = child.attr("checked");
        if (child.is(":radio, checked"))
            this[child.attr("name")] = child.val();
        if (child.is(":text"))
            this[child.attr("name")] = child.val();
        return null;
    }); 
```

以下（受jobscry的回答启发）也没有：

```
function config() {
    $("#frmMain").children().each(function() {
        var child = $("this");
        alert(child.length);
        if (child.is(":checkbox")) {
            this[child.attr("name")] = child.attr("checked");
        }
        if (child.is(":radio, checked"))
            this[child.attr("name")] = child.val();
        if (child.is(":text"))
            this[child.attr("name")] = child.val();
    });
} 
```

警报总是显示`child.length == 0`。手动选择元素有效：

```

>>> $("#frmMain").children()
对象长度=42
>>> $("#frmMain").children().filter(":checkbox")
对象长度=3

```

有关如何正确执行循环的任何提示？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-04T12:26:30.443

不要认为你需要引用这个：

```
var child = $("this"); 
```

尝试：

```
var child = $(this); 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-04T11:52:11.433

jQuery 有一个出色的函数来遍历一组元素： [.each()](http://docs.jquery.com/Core/each)

```
$('#formId').children().each(
    function(){
        //access to form element via $(this)
    }
); 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-04T12:38:27.313

根据您对每个孩子的需求（如果您希望通过 AJAX 将其发布到某个地方），您可以这样做......

```
$("#formID").serialize() 
```

它会自动为您创建一个包含所有值的字符串。

至于循环对象，你也可以这样做。

```
$.each($("input, select, textarea"), function(i,v) {
    var theTag = v.tagName;
    var theElement = $(v);
    var theValue = theElement.val();
}); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-04T18:06:40.537

我以前使用过以下内容：

```
var my_form = $('#form-id');
var data = {};

$('input:not([type=checkbox]), input[type=checkbox]:selected, select, textarea', my_form).each(
    function() {
        var name = $(this).attr('name');
        var val = $(this).val();

        if (!data.hasOwnProperty(name)) {
            data[name] = new Array;
        }

        data[name].push(val);
    }
); 
```

这只是从内存中写入的，因此可能包含错误，但这应该会生成一个名为的对象`data`，其中包含所有输入的值。

请注意，您必须以特殊方式处理复选框，以避免获取未选中复选框的值。无线电输入可能也是如此。

还要注意使用数组来存储值，对于一个输入名称，您可能有来自多个输入的值（特别是复选框）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-08T21:20:25.573

如果你想使用 each 函数，它应该是这样的：

```
$('#formId').children().each( 
  function(){
    //access to form element via $(this)
  }
); 
```

只需将关闭的花括号切换为关闭括号即可。感谢您指出，jobscry，您为我节省了一些时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-16T05:10:54.883

对我来说，所有这些都不起作用。对我有用的是非常简单的事情：

```
$("#formID input[type=text]").each(function() {
alert($(this).val());
}); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-03-26T20:13:40.583

这是循环访问仅访问表单元素的表单的最简单方法。在每个函数中，您可以检查并构建您想要的任何内容。构建对象时请注意，您需要在每个函数之外声明它。

编辑 [JSFIDDLE](http://jsfiddle.net/UDD7E/6/)

以下将起作用

```
$('form[name=formName]').find('input, textarea, select').each(function() {
    alert($(this).attr('name'));
}); 
```

# .net - 使用 SqlCommand + 参数将数据库值设置为 null

> ID：170186
> 
> 赞同：32
> 
> 时间：2008-10-04T11:44:39.467
> 
> 标签：.net, sql

[我今天之前在这个答案（单击](https://stackoverflow.com/questions/169359/improving-code-readability-for-sql-commands#169369)）中被教导如何在.NET 中的 SQL 查询中设置参数。

使用带值的参数很好，但是当我尝试将数据库中的字段设置为 null 时，我不成功。该方法认为我没有设置有效参数或没有指定参数。

例如

```
Dim dc As New SqlCommand("UPDATE Activities SET [Limit] = @Limit WHERE [Activity] = @Activity", cn)

If actLimit.ToLower() = "unlimited" Then
    ' It's not nulling :(
    dc.Parameters.Add(New SqlParameter("Limit", Nothing))
Else
    dc.Parameters.Add(New SqlParameter("Limit", ProtectAgainstXSS(actLimit)))
End If 
```

有什么我想念的吗？我做错了吗？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-10-04T11:58:18.563

你想要[DBNull](http://msdn.microsoft.com/en-us/library/system.dbnull.aspx) .Value。

在我共享的 DAL 代码中，我使用了一个辅助方法：

```
 foreach (IDataParameter param in cmd.Parameters)
    {
        if (param.Value == null) param.Value = DBNull.Value;
    } 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-04-03T19:50:59.547

我使用了一种`SqlParameterCollection`扩展方法，该方法允许我添加具有可为空值的参数。它负责转换`null`为`DBNull`. （对不起，我对 VB 不太熟悉。）

```
public static class ExtensionMethods
{
    public static SqlParameter AddWithNullable<T>(this SqlParameterCollection parms,
            string parameterName, T? nullable) where T : struct
    {
        if (nullable.HasValue)
            return parms.AddWithValue(parameterName, nullable.Value);
        else
            return parms.AddWithValue(parameterName, DBNull.Value);
    }
} 
```

用法：

```
string? optionalName = "Bozo";
cmd.Parameters.AddWithNullable("@Name", optionalName); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T11:49:41.810

尝试将其设置为`DbNull.Value`.

# java - Java Web 应用程序的最小目录结构和 ant 构建文件内容

> ID：170192
> 
> 赞同：5
> 
> 时间：2008-10-04T11:48:56.023
> 
> 标签：java, ant, wicket

Java Web 应用程序的最小常规目录结构是什么？我需要在`build.xml`文件中放入什么才能让 ant 构建它并制作 WAR 文件？

我的目标是在不使用 IDE 的情况下将 Wicket 应用程序部署到 Tomcat。我只想用 ant 和我最喜欢的文本编辑器来做。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-04T12:19:01.660

也许不是最简约的，但 Tomcat 项目有一个[应用程序开发人员指南](http://tomcat.apache.org/tomcat-7.0-doc/appdev/index.html)，其中包含[有关源代码布局的部分](http://tomcat.apache.org/tomcat-7.0-doc/appdev/source.html)和[示例 build.xml](http://tomcat.apache.org/tomcat-7.0-doc/appdev/build.xml.txt)

此外，如果您正在开始一个新项目，您可能需要查看 Maven。使用 Maven，您无需编写自己的构建脚本，而是遵循标准布局来做事，然后 Maven 会解决所有其他问题。它还管理依赖项，包括它自己的依赖项。不过，学习曲线有点陡峭。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T12:18:24.077

我们的看起来像这样：

```
web/
web/WEB-INF/   (sometimes we use a conf/ dir at the top level but this is minimal)
src/
lib/ 
```

build.xml 有三个目标：

*   jsp：将所有内容从 web/ 复制到 tomcat webapp 文件夹，从 lib/ 复制到 WEB-INF/lib
*   compile：将 src/ 中的所有内容编译到 webapp 中的 WEB-INF/classes
*   war：运行编译，jsp，然后将tomcat webapp的内容压缩到warfile中

这种结构有点非正式，您可以通过为 warfile 设置单独的构建目录和/或单独的编译目录等来更简洁地做到这一点。有些人不喜欢直接部署到 webapp 而不是直接部署到 webapp 的想法首先建立战争。但是为了让一些东西快速启动并运行，上面会做得很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T17:59:38.337

你应该看看maven。这真的很复杂，但是构建一个war文件很简单，并且有插件可以将war部署到tomcat。

# apache-flex - 如何让 Flash 不在舞台上渲染对象？

> ID：170203
> 
> 赞同：0
> 
> 时间：2008-10-04T11:58:10.437
> 
> 标签：apache-flex, flash, actionscript-3, optimization

这个讨论从[这里](https://stackoverflow.com/questions/155084/flash-rendering-optimisation-tips-and-tricks)开始，但我认为有一个明确的答案会很好......

因此，假设您在舞台上有 MovieClip（或用于 Flex 观众的 UIComponent） - 您必须做些什么才能不让它让用户看不到对象，但也让 AVM2 甚至不考虑因素它在为用户渲染舞台的时候？

我一直认为答案是设置`visible = false`，但有一个论点是该对象必须放置在舞台的边界之外（就像`x = 2000`这似乎是一个 hack IMO）。有谁知道真正的答案？

**编辑：**我想需要让 flash 不渲染该项目将有助于提高性能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T07:06:06.000

正如其他答案所指出的那样，不再需要在舞台外移动剪辑的“hack”。但是，如果性能很重要，那么设置`visible = false;`并不是**一件**明智的事情。作为显示列表的一部分但设置为不可见的剪辑，如果您有足够多的剪辑，它们仍然会产生显着的渲染开销。如果使用 将它们从播放列表中删除`removeChild()`，它们不会产生渲染开销（尽管它们仍会占用内存）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T12:19:07.993

该 hack 适用于 Flash 8 (Actionscript 2) 或更低版本。随着对 Actionscript 3 和 Flex 2/3 设置的升级，可见属性就足够了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T05:31:00.747

是的，正如设计所说，只需将其从显示列表中删除：

```
var s:MovieClip = new MovieClip();
s.lineStyle(1, 0xFFFFFF);
addChild(s);//shows in moviea 
removeChild(s);//removes from display list, but you still have a reference to it 
```

我还没有测试过，但它应该给你一个大致的想法。

麦克风

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T16:41:51.317

如果您使用 Flex 及其容器布局系统，当您不想显示某些内容时，该类中的[includeInLayout](http://livedocs.adobe.com/flex/3/langref/mx/core/IUIComponent.html#includeInLayout)属性也很有用：它指定在测量布局时是否考虑组件。`UIComponent`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-05T05:44:41.017

将其从显示列表中完全删除（removeChild()、removeChildAt() 等）。只要您实际上没有将 MovieClip 的引用设置为“null”，它仍然会保留在内存中，并且可以在您再次需要时重新添加到显示列表中（addChild()、atChildAt() 等.)

# .net - 如何提高垃圾回收性能？

> ID：170207
> 
> 赞同：9
> 
> 时间：2008-10-04T12:00:22.367
> 
> 标签：.net, optimization, compact-framework, embedded, garbage-collection

可以使用哪些优化模式来提高垃圾收集器的性能？

我问的原因是我使用 Compact Framework 做了很多嵌入式软件。在慢速设备上，垃圾收集可能会成为一个问题，我想减少垃圾收集器启动的时间，当它启动时，我希望它更快地完成。我还可以看到，使用垃圾收集器而不是反对它可以帮助改进任何 .NET 或 Java 应用程序，尤其是重型 Web 应用程序。

这是我的一些想法，但我没有做过任何基准测试。

*   重用临时类/数组（减少分配计数）
*   将活动对象的数量保持在最低限度（更快的收集）
*   尝试使用结构而不是类

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-06T21:58:57.540

关键是要了解 CF GC 是如何进行分配的。它是一个简单的标记和清除、非分代 GC，具有特定的算法来触发 GC，以及在收集后什么会导致压缩和/或倾斜。在应用程序级别几乎无法控制 GC（唯一可用的方法是收集，它的使用非常有限，因为无论如何您都无法强制压缩）。

对象重用是一个好的开始，但简单地保持对象数量较少可能是最好的工具之一，因为任何收集操作都必须遍历所有根。保持步行距离是一个好主意。如果压缩正在杀死你，那么防止段碎片将有所帮助。大于 64k 的对象在这方面可能会有所帮助，因为它们有自己的段，并且与较小的对象区别对待。

To really understand how the CF GC works, I'd recommend watching the [MSDN Webcast on CF memory management](http://msevents.microsoft.com/CUI/WebCastEventDetails.aspx?culture=en-US&EventID=1032318791&CountryCode=US).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-04T14:31:24.293

最重要的一个方面是最小化分配率。每当分配一个对象时，它就需要稍后进行 GC。现在当然，如果对象*很小*或*寿命*很短，它将被钉在年轻代中（假设 GC 是分代的）。大型对象倾向于直接进入终身领域。但是完全避免收集会更好。

此外，如果您可以将东西扔到堆栈上，您将享受到更少的 GC 压力。您可以尝试玩弄 GC 选项，但我认为使用分配分析器会更好地帮助您，这样您就可以找到导致问题的地方。

应该注意的是标准库和框架的重量。你包裹几个对象，它会很快填满。请记住，每当 GC 堆上发生某些事情时，它通常会为 GC 簿记使用更多空间。因此，您单独分配的 1000 个指针比相同指针的数组/向量大得多，因为后者可以共享 GC 簿记。另一方面，后者可能会活得更久。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T12:05:26.630

一个重要的事实是尽可能缩短对象的生命周期。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T12:07:17.500

结构与类问题是一个复杂的问题……例如，您可能很容易最终使用*更多*的堆栈空间。而且您当然不想要可变结构。但其他点似乎是明智的，只要你不弯曲设计以适应它。

**[编辑]**另一个常见的问题是字符串连接；如果您在循环中进行连接，请使用 StringBuilder，它将删除**很多**中间字符串。可能是 GC 忙于收集所有废弃的字符串？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-04T12:24:24.173

另一种选择是在应用程序的非高峰时间使用 GC.Collect() 手动收集垃圾（假设这在 CF 中可用）。这可以减少稍后在您的应用程序中清理所需的对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T12:52:57.223

[我在Rotor 2.0](http://www.microsoft.com/downloads/details.aspx?familyid=3a1c93fa-7462-47d0-8e56-8dd34c6292f0&displaylang=en)上听到了[.NET Rocks](http://www.dotnetrocks.com/default.aspx?showNum=360)节目。如果你真的是铁杆，你可以下载Rotor，调整源代码，然后使用你自己修改过的垃圾收集器。

无论如何，该播客有一些关于 GC 的重要信息。我强烈推荐听一下。

# ruby - Ruby中哈希成语的哈希？

> ID：170223
> 
> 赞同：34
> 
> 时间：2008-10-04T12:10:07.510
> 
> 标签：ruby, idioms, hash-of-hashes

在 Ruby 中创建散列的散列允许方便的二维（或更多）维查找。但是，插入时必须始终检查第一个索引是否已存在于哈希中。例如：

```
h = Hash.new
h['x'] = Hash.new if not h.key?('x')
h['x']['y'] = value_to_insert 
```

最好在自动创建新哈希的情况下执行以下操作：

```
h = Hash.new
h['x']['y'] = value_to_insert 
```

同样，在查找第一个索引不存在的值时，如果返回 nil 而不是接收未定义的“[]”错误方法会更好。

```
looked_up_value = h['w']['z'] 
```

可以创建一个具有此行为的 Hash 包装类，但是否存在用于完成此任务的 Ruby 习语？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-04T12:16:03.567

您可以向[`Hash.new`](http://www.ruby-doc.org/core/classes/Hash.html#M002868)函数传递一个块，该块被执行以产生默认值，以防查询的值尚不存在：

```
h = Hash.new { |h, k| h[k] = Hash.new } 
```

当然，这可以递归地完成。有[一篇文章解释了细节](https://web.archive.org/web/20090331170758/http://blog.inquirylabs.com/2006/09/20/ruby-hashes-of-arbitrary-depth/)。

为了完整起见，这里是文章中任意深度哈希的解决方案：

```
hash = Hash.new(&(p = lambda{|h, k| h[k] = Hash.new(&p)})) 
```

最初提出这个解决方案的人是[Kent Sibilev](https://twitter.com/datanoise)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-11T04:24:11.143

所谓的自动复活，既是福也是祸。问题可能在于，如果您在定义之前“查看”一个值，您会被插槽中的这个空哈希卡住，您需要稍后将其修剪掉。

如果您不介意一点无政府状态，您总是可以插入或等于样式声明，这将允许您在查询时构造预期的结构：

```
((h ||= { })['w'] ||= { })['z'] 
```

# ruby-on-rails - 尝试从 2.0.1 更新 ruby gem 时出错

> ID：170267
> 
> 赞同：1
> 
> 时间：2008-10-04T12:37:28.517
> 
> 标签：ruby-on-rails, rubygems

我正在尝试在 Mac 上设置自己来学习 Ruby on Rails，但是我似乎遇到了一些问题。如果我尝试运行 ./script/server 等命令，我会得到以下信息：

> Rails 需要 RubyGems >= 0.9.4（你有 0.9.2）。请`gem update --system`再试一次。

当我运行“gem update..”时，我得到了这个：

> 正在更新 RubyGems... 尝试远程更新 ruby​​gems-update 错误：执行 gem 时 ... (Errno::EACCES) 权限被拒绝 - /opt/local/lib/ruby/gems/1.8/cache/rubygems-update-1.3。 0.宝石

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-04T13:15:24.447

知道了。

须藤宝石更新--系统

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-08-07T03:15:03.747

从 El Capitan 开始，Apple`/usr/bin`出于安全原因阻止用户应用程序进行修改。所以最好在推荐的文件夹中安装/更新 ruby​​gems `/usr/local/bin`，：

```
sudo gem update -n /usr/local/bin --system 
```

（建议取自[https://stackoverflow.com/a/39928447/1033581](https://stackoverflow.com/a/39928447/1033581)）

# c# - 具有“专门”构造函数的 C# 泛型类

> ID：170272
> 
> 赞同：4
> 
> 时间：2008-10-04T12:40:03.020
> 
> 标签：c#, generics

我有一个像下面这样的类：

```
public class DropDownControl<T, Key, Value> : BaseControl
    where Key: IComparable
{
    private IEnumerable<T> mEnumerator;
    private Func<T, Key> mGetKey;
    private Func<T, Value> mGetValue;
    private Func<Key, bool> mIsKeyInCollection;

    public DropDownControl(string name, IEnumerable<T> enumerator, Func<T, Key> getKey, Func<T, Value> getValue, Func<Key, bool> isKeyInCollection)
        : base(name)
    {
        mEnumerator = enumerator;
        mGetKey = getKey;
        mGetValue = getValue;

        mIsKeyInCollection = isKeyInCollection;
    } 
```

我想为字典添加一个便利功能（因为它们自己有效地支持所有操作）。

但问题是这样的构造函数只会指定 Key 和 Value 而不是直接指定 T，而 T 只是 KeyValuePair。有没有办法告诉编译器这个构造函数 T 是 KeyValuePair，比如：

```
public DropDownControl<KeyValuePair<Key, Value>>(string name, IDictionary<Key, Value> dict) { ... } 
```

目前我使用静态 Create 函数作为解决方法，但我更希望直接构造函数。

```
public static DropDownControl<KeyValuePair<DKey, DValue>, DKey, DValue> Create<DKey, DValue>(string name, IDictionary<DKey, DValue> dictionary)
            where DKey: IComparable
        {
            return new DropDownControl<KeyValuePair<DKey, DValue>, DKey, DValue>(name, dictionary, kvp => kvp.Key, kvp => kvp.Value, key => dictionary.ContainsKey(key));
        } 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-04T12:47:17.547

不，基本上。非泛型类中的静态方法（例如 DropDownControl [no <>]）是最好的方法，因为您应该能够在调用 Create() 时使用类型推断 - 即

```
var control = DropDownControl.Create(name, dictionary); 
```

C# 3.0 通过“var”（在此非常欢迎）和大大改进的泛型类型推断规则来提供帮助。在某些（更一般的）情况下，另一个类似的选项是扩展方法，但是从字典创建非常特定的控件的扩展方法感觉不是很自然——我会使用非扩展方法。

就像是：

```
public static class DropDownControl
{
    public static DropDownControl<KeyValuePair<TKey,TValue>, TKey, TValue>
            Create<TKey,TValue>(IDictionary<TKey, TValue> value, string name)
    where TKey : IComparable
    {
        return new DropDownControl<KeyValuePair<TKey, TValue>, TKey, TValue>
            (name, value, pair => pair.Key, pair => pair.Value,
            key => value.ContainsKey(key)
        );
    }
} 
```

另一种选择是继承，但我不太喜欢它......

```
public class DropDownControl<TKey, TValue> :
    DropDownControl<KeyValuePair<TKey, TValue>, TKey, TValue>
    where TKey : IComparable
{
    public DropDownControl(IDictionary<TKey, TValue> lookup, string name)
        : base(name, lookup, pair => pair.Key, pair => pair.Value,
            key => lookup.ContainsKey(key)) { }
} 
```

这增加了复杂性并降低了您的灵活性......我不会这样做......

总的来说，听起来您*只想*使用 IDictionary<,> - 我想知道您是否不能简化控制以仅使用它，并强制非字典调用者将自己包装在 IDictionary<,> 外观中？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-08-20T15:57:05.970

如果`T`将始终`KeyValuePair<TKey,TValue>`存在，则根本不需要它是泛型类型参数。只需在您使用的任何地方使用实际类型`T`。

否则，如果类型有时可能必须是其他东西，我建议您可能应该有一个具有相同类型`DropDownControl<TKey, TValue> : BaseControl`的受保护字段`Helper`的基本类型，以及几乎所有方法的虚拟实现，这些方法只是在 ; 上调用它们的对应物`Helper`。在其中定义了一个派生类`HeldAs<TPair>`，该类使用“真实”实现覆盖所有方法。

for 的构造函数`DropDownControl<TKey,TValue>`将构造一个新实例`DropDownControl<TKey,TValue>.HeldAs<KeyValuePair<TKey,TValue>>`并将对该实例的引用存储在`Helper`. 然后外部代码可以保存类型的引用`DropDownControl<TKey,TValue>`并使用它们，而不必知道或关心键和值是如何保存的。需要创建以不同方式存储事物并使用不同方法提取键和值的代码可以调用的构造`DropDownControl<TKey,TValue>.HeldAs<actualStorageType>`函数，传递可以`actualStorageType`适当转换为键或值的函数。

如果`DropDownControl<TKey,TValue>`期望 的任何方法通过`this`，则 的构造函数`DropDownControl<TKey,TValue>.HeldAs<TStorage>`应设置`Helper`为自身，但基类型的构造函数在构造派生类型实例后，应将派生实例的`Helper`引用设置为自身（基类包装）。然后应该通过的方法`this`应该通过`Helper`。这将确保当一个派生类实例纯粹是为了被包装而构建时，外部世界将永远不会收到对该派生实例的引用，而是会始终看到包装器。

# python - 使用 Python 在 Mac 上开发 USB 驱动程序

> ID：170278
> 
> 赞同：4
> 
> 时间：2008-10-04T12:45:46.533
> 
> 标签：python, macos, usb, drivers

我想在 Mac 上用 Python 编写一个驱动程序来与我的 Suunto t3 手表对话。我的日常工作是用 C# 做基本的 Web 工作，所以我对 Python 和在 Mac 上开发的熟悉程度有限。

您能否建议如何开始进行一般的驱动程序开发，然后更具体地在 Mac 上进行。即如何轻松查看正在传输到设备的数据？我已经启动并运行了 Python 2.5 (MacPorts)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-04T14:20:31.507

Mac 已经拥有支持 USB 的底层基础设施，因此您需要一个可以利用它的 Python 库。对于任何需要串行支持的 Python 项目，无论是 USB、RS-232 还是 GPIB，我都推荐 SourceForge 的 PyVisa 库。请参阅[http://pyvisa.sourceforge.net/](http://pyvisa.sourceforge.net/)。

如果您的设备没有 VISA 驱动程序，则必须直接处理 USB 系统。您可以为此使用 SourceForge 上的另一个库：http: [//pyusb.berlios.de/](http://pyusb.berlios.de/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-04T13:55:06.287

如果手表支持[标准 USB 设备类规范](http://www.usb.org/developers/devclass_docs#approved)，例如 HID 或串行通信，则可能已经在操作系统中内置了 Macintosh 驱动程序。否则，您将不得不从以下三个来源之一获取有关用于与其通信的供应商命令的信息：制造商；对 Windows 驱动程序使用的协议进行逆向工程；或者来自已经对协议进行逆向工程以支持 Linux 或 BSD 上的设备的其他人。

USB 是一种基于数据包的总线，了解各种事务类型非常重要。阅读[USB 规范](http://www.usb.org/developers/docs/)是一个很好的起点。

您可以使用 USB 总线分析器查看正在将哪些数据传输到设备，这对于业余爱好者来说是一个昂贵的提议，但大多数从事 USB 开发的企业都可以做到。例如，[催化剂征服](http://www.getcatalyst.com/product-conquest.html)是 1199 美元。另一家成熟的制造商是[LeCroy（原 CATC）](http://www.lecroy.com/tm/products/ProtocolAnalyzers/usb.asp?menuid=67)。还有一些软件 USB 分析器可以连接到操作系统的 USB 堆栈，但它们不会显示总线上的所有流量，并且可能不那么可靠。

我不是 Mac 专家，所以对这段话持保留态度：Apple 有一个名为[I/O Kit](http://developer.apple.com/referencelibrary/GettingStarted/GS_HardwareDrivers/index.html)的驱动程序开发工具包，它显然要求你用 C++ 编写驱动程序，除非他们也有某种用户模式驱动程序框架。如果你用 Python 编写它，它可能更像是一个 Python 库，可以连接到其他人（Apple 的？）通用 USB 驱动程序。

# delphi - Delphi 2009 Ribbon Controls - 玻璃框架

> ID：170282
> 
> 赞同：4
> 
> 时间：2008-10-04T12:48:47.760
> 
> 标签：delphi, delphi-2009, vcl, ribbon, aero-glass

我已经开始在 Delphi 2009 中使用新的内置功能区控件并使用自定义框架，因此应用程序按钮和迷你工具栏向上滑动到窗口框架上，但我想知道在 Vista 上它是否应该使用玻璃效果，如Office 2007 可以，如果可以，我将如何启用此设置。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-04T18:30:39.223

不幸的是，功能区控件的 CodeGear 实现似乎与玻璃框架不兼容。关于它绘制方式的某些东西会禁用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-12T20:14:03.250

你可以试试这个[http://www.bilsen.com/windowsribbon/index.shtml](http://www.bilsen.com/windowsribbon/index.shtml)

它与 Native Ribbon 框架接口并且运行良好。

# cocoa - 在 Mac OS X 中更改声音（或其他）系统偏好设置

> ID：170294
> 
> 赞同：5
> 
> 时间：2008-10-04T12:58:09.363
> 
> 标签：cocoa, macos, scripting, applescript

我希望能够在 Mac OS X 中切换声音输出源而无需任何 GUI 交互。

有一些工具可以控制声音输出，例如[SoundSource](http://rogueamoeba.com/freebies/)和一个[用于打开首选项对话框的 applescript](http://www.macosxhints.com/article.php?story=20050614171126634)。

我正在寻找的是可以立即切换偏好的东西，比如[SoundSource](http://rogueamoeba.com/freebies/)，但它必须是可编写脚本的。目标是一键在我的数字和模拟输出之间切换。我有一个[帮助应用程序](http://www.blacktree.com/?quicksilver)，它将在一个按键上启动一个程序或 applescript。我现在需要的只是无需任何用户交互即可快速切换声源的applescript 或应用程序。

如果需要的话，我愿意编写一些 Objective-C，但我几乎是 Cocoa 开发的新手。

您是否有一键式解决方案，或者可以为我指出一个关于从 Cocoa 应用程序或命令行控制声音系统首选项的好教程？

**编辑**：我创建了一个命令行应用程序来做到这一点。您可以在[http://code.google.com/p/switchaudio-osx/downloads](http://code.google.com/p/switchaudio-osx/downloads)下载它。源代码也可以在项目站点上找到。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-08T03:03:46.737

我创建了一个命令行应用程序来做到这一点。

您可以在[http://code.google.com/p/switchaudio-osx/downloads](http://code.google.com/p/switchaudio-osx/downloads)下载它。源代码也可以在项目站点上找到。

**更新**（2014 年 12 月）：代码现在托管在 github 上——https: [//github.com/deweller/switchaudio-osx](https://github.com/deweller/switchaudio-osx)。在优胜美地工作得很好。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-04T19:20:54.380

不要从偏好的角度来考虑它；这类事情没有集中的系统偏好框架。我相信您需要做的是使用 Core Audio 来设置(using )的`kAudioHardwarePropertyDefaultOutputDevice`和 `kAudioHardwarePropertyDefaultSystemOutputDevice`属性。`AudioSystemObject``AudioHardwareSetProperty()`

# tdd - “代码覆盖”与“代码测试”？

> ID：170297
> 
> 赞同：2
> 
> 时间：2008-10-04T13:00:43.743
> 
> 标签：tdd, code-coverage

将我当前的代码项目转换为 TDD，我注意到了一些事情。

```
class Foo {
    public event EventHandler Test;

    public void SomeFunction() {
        //snip...
        Test(this, new EventArgs());
    }
} 
```

在测试此代码并依靠代码覆盖工具来确定您是否有足够的测试时，我可以看到两种危险。

*   您应该测试`Test`事件是否被触发。如果您忘记了这一点，仅代码覆盖工具不会告诉您。
*   我马上就到另一个。

为此，我在启动函数中添加了一个事件处理程序，使其看起来像这样：

```
Foo test;
int eventCount;

[Startup] public void Init() {
    test = new Foo();
    // snip...
    eventCount = 0;
    test.Test += MyHandler;
}

void MyHandler(object sender, EventArgs e) { eventCount++; } 
```

现在我可以简单地检查`eventCount`一下我的事件被调用了多少次，如果它被调用了。漂亮整齐。直到现在，我们才发现了一个永远不会被任何测试发现的阴险小错误：即，`SomeFunction()`在尝试调用事件之前不检查事件是否有任何处理程序。这将导致 null 取消引用，这将永远不会被我们的任何测试捕获，因为它们都默认附加了一个事件处理程序。但同样，代码覆盖率工具仍会报告完全覆盖率。

这只是我手头的“真实世界示例”，但我突然想到，即使您的代码 100%“覆盖”，也可能会漏掉更多此类错误，但这仍然不能转化为 100% 测试. 在编写测试时，我们是否应该对这种工具报告的覆盖率持保留态度？是否有其他类型的工具可以捕捉这些漏洞？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-04T13:15:10.797

我不会说“半信半疑”（代码覆盖率有很多实用性），而是引用我自己的话

> TDD 和代码覆盖率不是灵丹妙药：
> 
> · 即使有 100% 的块覆盖率，在选择执行哪些块的条件中仍然会出现错误。
> 
> · 即使100%的块覆盖+100%的圆弧覆盖，直线代码仍然会出现错误。
> 
> · 即使有 100% 的块覆盖率 + 100% 的弧线覆盖率 + 100% 无错误的至少一条路径的直线代码，仍然会有输入数据以表现出更多错误的方式执行路径/循环.

（从[这里](http://www.myspace.com/lorgonblog/blog/306380867?Mytoken=799A2828-11C7-4E3D-B241B066447F8E8E89782153)）

虽然可能有一些工具可以提供改进，但我认为代码覆盖率只是确保产品质量的整体测试策略的一部分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T14:12:53.300

<100% 的代码覆盖率是不好的，但并不意味着 100% 的代码覆盖率是好的。这是一个必要但不充分的条件，应该这样对待。

另请注意，代码覆盖率和路径覆盖率之间存在差异：

```
void bar(Foo f) {
    if (f.isGreen()) accountForGreenness();
    if (f.isBig()) accountForBigness();
    finishBar(f);
} 
```

如果您将一个大的绿色 Foo 作为测试用例传递到该代码中，您将获得 100% 的代码覆盖率。但就你所知，一个大的红色 Foo 会导致系统崩溃，因为 accountForBigness 错误地假设某个指针是非空的，只有 accountForGreenness 才将它设为非空。您没有 100% 的路径覆盖，因为您没有覆盖跳过对 accountForGreenness 的调用而不是对 accountForBigness 的调用的路径。

也有可能在没有 100% 路径覆盖的情况下获得 100% 的分支覆盖。在上面的代码中，一个带有绿色大 Foo 的调用和一个带有红色小 Foo 的调用给出了前者，但仍然没有捕捉到大的红色错误。

并不是说这个例子是有史以来最好的 OO 设计，而是很少看到代码覆盖意味着路径覆盖的代码。即使它在您的代码中暗示了这一点，也并不意味着您的程序可能会使用库或系统中的所有代码或所有路径。原则上，您需要 100% 覆盖程序的所有可能状态才能做到这一点（因此请确保例如在任何情况下，您都不会使用无效参数调用导致库或系统中的错误捕获代码，否则无法获得)，这通常是不可行的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T13:05:09.960

> 在编写测试时，我们是否应该对这种工具报告的覆盖率持保留态度？

绝对地。覆盖率工具仅告诉您代码中实际*运行*的行数比例。它没有说明这些行的*测试*有多彻底。有些代码行只需要测试一次或两次，但有些代码需要在广泛的输入范围内进行测试。覆盖工具无法区分。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T13:09:21.963

此外，如果测试驱动程序只是在没有关于结果正确性的有意义断言的情况下执行代码，那么 100% 的测试覆盖率本身并没有多大意义。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T13:12:27.603

覆盖率仅在识别根本没有经过测试的代码时才真正有用。它并没有告诉您太多有关已涵盖的代码的信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T14:01:50.640

是的，这是“线路覆盖”和“路径覆盖”之间的主要区别。在实践中，您无法真正衡量代码路径覆盖率。就像静态编译时间检查、单元测试和静态分析一样——行覆盖只是您寻求高质量代码的另一种工具。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-04T14:23:57.413

测试是绝对必要的。也必须保持一致的是实施。

如果您以未在测试中的方式实现某些东西……那么问题可能就在那里发生。

当您测试的数据与将要流经您的应用程序的数据无关时，也可能会出现问题。

所以是的，代码覆盖率是必要的。但不如真人进行的真实测试。

# msbuild - 从 MSBuild 查看项目依赖项

> ID：170327
> 
> 赞同：8
> 
> 时间：2008-10-04T13:29:13.560
> 
> 标签：msbuild

是否有一种模式、某种开关或编程方式可以让 MSBuild 显示或输出给定构建文件的计算依赖项？

**一些背景**- 我有一个大型项目需要拆分以加快构建时间，并希望将缓慢变化的基础架构代码删除到它自己的发布区域。并非所有信息都包含在构建文件本身中，因为某些子项目由它们的 vcproj 或 csproj 文件引用。

我真的很想看看 MSBuild 认为需要做什么（或者更坏的情况 [rebuild all] 并且可能是一个 make），而无需实际进行重建。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-04T17:10:06.533

[MSBuild Profiler](http://www.codeplex.com/msbuildprofiler)项目应该能够帮助您了解构建所花费的时间。它不直接显示依赖关系。不管有没有构建依赖，仅仅分析构建可能会提供一些洞察力并帮助加快进程。

我刚刚遇到了这个应用程序，但我自己还没有使用它，[依赖可视化](http://www.codeplex.com/dependencyvisualizer)工具看起来刚刚添加了与 MSBuild 兼容的项目文件。之前也有过关于这样做的帖子，但没有代码（参见[A](http://weblogs.asp.net/nunitaddin/archive/2004/09/18/231141.aspx)，[B](http://blogs.msdn.com/msbuild/archive/2005/11/14/492653.aspx)）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-09T09:11:45.087

虽然很久以前我问过最初的问题，但我已经在工作中继续前进，并且令人惊讶地遇到了同样的需求。在这种情况下，我在追求工具方面取得了更大的成功，并发现了[Microsoft Build Sidekick](http://www.attrice.info/msbuild/index.htm)，它提供：

*   看法
*   编辑
*   建造
*   调试

Microsoft Visual Studio© 2005、2008 和 2010 项目文件。

除了我尚未使用的调试和日志记录功能外，它还有一个图表模式，您可以在其中选择“目标”，它会显示所有相关的目标和其中的步骤。显然，在逐步完成构建过程（调试）时可以查看此图！

# sql - 在存储过程中执行存储过程

> ID：170328
> 
> 赞同：48
> 
> 时间：2008-10-04T13:29:18.100
> 
> 标签：sql, sql-server, tsql, stored-procedures, sql-server-2005

我想在存储过程中执行存储过程，例如

```
EXEC SP1

BEGIN

EXEC SP2
END 
```

但我只想在完成运行`SP1`后`SP2`完成，所以我需要找到一种方法`SP1`来等待`SP2`结束前完成`SP1`。

`SP2`正在执行，`SP1`所以我有类似的东西：

```
CREATE PROCEDURE SP1
AS
BEGIN

EXECUTE SP2

END 
```

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-04T13:50:13.423

T-SQL 不是异步的，所以你真的别无选择，只能等到 SP2 结束。幸运的是，这就是你想要的。

```
CREATE PROCEDURE SP1 AS
   EXEC SP2
   PRINT 'Done' 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-04T13:48:10.497

这是我们的一个存储过程的示例，它在其中执行多个存储过程：

```
ALTER PROCEDURE [dbo].[AssetLibrary_AssetDelete]
(
    @AssetID AS uniqueidentifier
)
AS

SET NOCOUNT ON

SET TRANSACTION ISOLATION LEVEL READ COMMITTED

EXEC AssetLibrary_AssetDeleteAttributes @AssetID
EXEC AssetLibrary_AssetDeleteComponents @AssetID
EXEC AssetLibrary_AssetDeleteAgreements @AssetID
EXEC AssetLibrary_AssetDeleteMaintenance @AssetID

DELETE FROM
    AssetLibrary_Asset
WHERE
    AssetLibrary_Asset.AssetID = @AssetID

RETURN (@@ERROR) 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-10-16T11:56:14.597

我们根据需要使用内联存储过程。例如，我们必须在查询中使用具有不同值的不同相同参数。

```
Create Proc SP1
(
 @ID int,
 @Name varchar(40)
 -- etc parameter list, If you don't have any parameter then no need to pass.
 )

  AS
  BEGIN

  -- Here we have some opereations

 -- If there is any Error Before Executing SP2 then SP will stop executing.

  Exec SP2 @ID,@Name,@SomeID OUTPUT 

 -- ,etc some other parameter also we can use OutPut parameters like 

 -- @SomeID is useful for some other operations for condition checking insertion etc.

 -- If you have any Error in you SP2 then also it will stop executing.

 -- If you want to do any other operation after executing SP2 that we can do here.

END 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-04T13:34:42.583

这就是它的工作方式存储过程按顺序运行，你不需要开始像

```
exec dbo.sp1
exec dbo.sp2 
```

# python - Django 信号与覆盖保存方法

> ID：170337
> 
> 赞同：102
> 
> 时间：2008-10-04T13:37:12.000
> 
> 标签：python, django, django-models, django-signals

我很难解决这个问题。现在我有一些看起来像这样的模型：

```
 def Review(models.Model)
    ...fields...
    overall_score = models.FloatField(blank=True)

def Score(models.Model)
    review = models.ForeignKey(Review)
    question = models.TextField()
    grade = models.IntegerField() 
```

一个评论有几个“分数”，overall_score 是分数的平均值。保存评论或分数时，我需要重新计算总分平均值。现在我正在使用覆盖的保存方法。使用 Django 的信号调度器有什么好处吗？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-10-05T08:38:39.653

保存/删除信号通常在您需要进行更改的情况下是有利的，这些更改不完全特定于所讨论的模型，或者可以应用于具有共同点的模型，或者可以配置为跨模型使用。

重写`save`方法中的一项常见任务是从模型中的某些文本字段自动生成 slug。这是一个示例，如果您需要为多个模型实现它，将受益于使用`pre_save`信号，其中信号处理程序可以获取 slug 字段的名称和生成 slug 的字段名称。一旦你有了类似的东西，你放置的任何增强功能也将适用于所有模型——例如，查找你要为有问题的模型类型添加的 slug，以确保唯一性。

可重用应用程序通常受益于信号的使用——如果它们提供的功能可以应用于任何模型，它们通常（除非它是不可避免的）不希望用户必须直接修改他们的模型才能从中受益。

例如，使用[django-mptt](https://github.com/django-mptt/django-mptt/)，我使用`pre_save`信号来管理一组字段，这些字段描述了即将创建或更新的模型的树结构，以及`pre_delete`用于删除被删除对象及其整个树结构细节的信号它之前的对象的子树，它们被删除。由于使用了信号，用户不必在他们的模型上添加或修改`save`或`delete`方法来为他们完成这种管理，他们只需要让 django-mptt 知道他们想要管理哪些模型。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2016-03-09T10:10:16.497

您询问：

*使用 Django 的信号调度器有什么好处吗？*

我在 django 文档中找到了这个：

> 批量操作不调用重写的模型方法
> 
> 请注意，当使用 QuerySet 批量删除对象或作为级联删除的结果时，不一定会调用对象的 delete() 方法。为确保执行自定义删除逻辑，您可以使用 pre_delete 和/或 post_delete 信号。
> 
> 不幸的是，在批量创建或更新对象时没有解决方法，因为没有调用 save()、pre_save 和 post_save。

来自：[覆盖预定义的模型方法](https://docs.djangoproject.com/en/dev/topics/db/models/#overriding-predefined-model-methods)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T13:55:25.427

如果您将使用信号，您将能够在每次保存相关分数模型时更新评论分数。但是，如果不需要这样的功能，我看不出有任何理由将其放入信号中，那是与模型相关的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T15:21:21.230

这是一种非规范化。看看这个[漂亮的解决方案](http://groups.google.com/group/django-developers/msg/248e53722acab49e)。就地组合字段定义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-09-11T09:19:21.340

来自 Django 文档的关于批量删除（对象`.delete()`方法`QuerySet`）的小补充：

> 请记住，只要有可能，这将纯粹在 SQL 中执行，因此在此过程中不一定会调用单个对象实例的 delete() 方法。如果您在模型类上提供了自定义 delete() 方法并希望确保调用它，则需要“手动”删除该模型的实例（例如，通过迭代 QuerySet 并在每个对象单独）而不是使用 QuerySet 的批量 delete() 方法。

[https://docs.djangoproject.com/en/1.11/topics/db/queries/#deleting-objects](https://docs.djangoproject.com/en/1.11/topics/db/queries/#deleting-objects)

和批量更新（对象`.update()`方法`QuerySet`）：

> 最后，请意识到 update() 在 SQL 级别进行更新，因此不会在模型上调用任何 save() 方法，也不会发出 pre_save 或 post_save 信号（这是调用 Model.save( ））。如果您想为具有自定义 save() 方法的模型更新一堆记录，请遍历它们并调用 save()

[https://docs.djangoproject.com/en/2.1/ref/models/querysets/#update](https://docs.djangoproject.com/en/2.1/ref/models/querysets/#update)

# database - Sequential Guid 相对于标准 Guid 有哪些性能改进？

> ID：170346
> 
> 赞同：69
> 
> 时间：2008-10-04T13:43:39.507
> 
> 标签：database, primary-key, guid

当用作数据库内的主键时，是否有人测量过 Sequential Guid 与 Standard Guid 的性能？

* * *

我不认为需要唯一的密钥是可猜测的，从 Web UI 或其他部分传递它们本身似乎是一种不好的做法，如果您有安全问题，我看不到如何使用 guid 可以改进事情（如果这是问题，请使用使用框架的适当加密功能的真实随机数生成器）。
我的方法涵盖了其他项目，可以从代码生成顺序 guid，而无需访问数据库（也适用于 Windows），并且它在时间和空间上是独一无二的。
是的，提出问题的目的是为了回答它，为那些选择 Guid 进行 PK 的人们提供一种提高数据库使用率的方法（在我的例子中，它允许客户在无需更改服务器的情况下维持更高的工作量）。

似乎安全问题很多，在这种情况下不要使用顺序 Guid，或者更好的是，对 PK 使用标准 Guid，这些 Guid 从您的 UI 来回传递，而顺序 guid 用于其他所有内容。与往常一样，没有绝对的真理，我也编辑了主要答案以反映这一点。

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2008-10-04T13:52:51.390

**GUID 与顺序 GUID**

一种典型的模式是使用 Guid 作为表的 PK，但是，正如其他讨论中提到的（请参阅[GUID / UUID 数据库键的优点和缺点](https://stackoverflow.com/questions/45399/advantages-and-disadvantages-of-guid-uuid-database-keys)），存在一些性能问题。

这是一个典型的 Guid 序列

f3818d69-2552-40b7-a403-01a6db4552f7
7ce31615-fafb-42c4-b317-40d21a6a3c60
94732fc7-768e-4cf2-9107-f0953f6795a5

这类数据的问题是：<
-

*   广泛的价值分布
*   几乎随机的
*   索引使用非常非常非常糟糕
*   很多叶子在移动
*   几乎每个 PK 都需要至少在一个非聚集索引上
*   Oracle 和 SQL Server 都出现问题

一种可能的解决方案是使用按如下方式生成的顺序 Guid：

cc6466f7-1066-11dd-acb6-005056c00008
cc6466f8-1066-11dd-acb6-005056c00008
cc6466f9-1066-11dd-acb6-005056c00008

如何从 C# 代码生成它们：

```
[DllImport("rpcrt4.dll", SetLastError = true)]
static extern int UuidCreateSequential(out Guid guid);

public static Guid SequentialGuid()
{
    const int RPC_S_OK = 0;
    Guid g;
    if (UuidCreateSequential(out g) != RPC_S_OK)
        return Guid.NewGuid();
    else
        return g;
} 
```

好处

*   更好地使用索引
*   允许使用集群键（在 NLB 场景中验证）
*   更少的磁盘使用量
*   以最低成本提高 20-25% 的性能

**现实生活测量：** 场景：

*   在 SQL Server 上存储为 UniqueIdentifier 类型的 Guid
*   在 Oracle 上存储为 CHAR(36) 的 Guid
*   大量插入操作，在单个事务中批量处理
*   从 1 到 100 次插入，具体取决于表
*   一些表 > 1000 万行

实验室测试 - SQL Server

VS2008 测试，10 个并发用户，无思考时间，基准过程，600 次批量插入叶表
*标准 Guid*
Avg。处理持续时间：**10.5**秒
平均。第二次请求：**54.6**
平均。响应。时间：**0.26**

*Sequential Guid*
Avg。过程持续时间：**4.6**秒
平均。第二次请求：**87.1**
平均。响应。时间：*Oracle 上的***0.12** 结果（对不起，用于测试的不同工具）1.327.613 在具有 Guid PK*标准 Guid*的表上插入，**0.02**秒。每个插入的经过时间，**2.861**秒。CPU 时间，总计

 ********31.049**秒。经过 的

*顺序指导*，**0.00**秒。每个插入的经过时间，**1.142**秒。CPU 时间，总共**3.667**秒。elapsed

DB 文件顺序读取等待时间从62.415 秒的**640**万个等待事件**变为****11.063**秒的**120**万个等待事件。 重要的是要看到所有顺序 guid 都可以猜到，所以如果安全是一个问题，使用它们不是一个好主意，仍然使用标准 guid。 **简而言之...如果您将 Guid 用作 PK，则每次不从 UI 来回传递它们时都使用顺序 guid，它们将加快操作并且不需要任何成本来实现。********

 ********* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-10-04T15:36:59.230

我可能在这里遗漏了一些东西（如果我有，请随时纠正我），但我看不到将顺序 GUID/UUID 用于主键的好处很小。

在自动递增整数上使用 GUID 或 UUID的**要点**是：

*   它们可以在任何地方创建**而无需**联系数据库
*   它们是在您的应用程序中完全唯一的标识符（在 UUID 的情况下，是普遍唯一的）
*   给定一个标识符，除了暴力破解一个*巨大*的键空间之外，没有办法猜测下一个或前一个（甚至*任何*其他有效的标识符） 。

 *不幸的是，使用你的建议，你失去了*所有*这些东西。

所以，是的。您使 GUID 变得更好。但是在这个过程中，你已经抛弃了几乎所有首先使用它们的理由。

如果您**真的**想提高性能，请使用标准的自动递增整数主键。这提供了您描述的所有好处（以及更多），同时在几乎所有方面都比“顺序指南”更好。

这很可能会被遗忘，因为它没有专门回答你的问题（这显然是精心设计的，所以你可以立即自己回答），但我觉得这是一个更重要的问题。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-06-25T08:06:54.103

正如 massimogentilini 已经说过的，使用 UuidCreateSequential（在代码中生成 guid 时）可以提高性能。但是似乎缺少一个事实：SQL Server（至少 Microsoft SQL 2005 / 2008）使用相同的功能，但是：Guid 的比较/排序在 .NET 和 SQL Server 上不同，这仍然会导致更多 IO，因为不会正确订购指南。为了生成正确排序的 sql server（排序）的 guid，您必须执行以下操作（请参阅[比较](http://msdn.microsoft.com/en-us/library/ms254976(VS.100).aspx)详细信息）：

```
[System.Runtime.InteropServices.DllImport("rpcrt4.dll", SetLastError = true)]
static extern int UuidCreateSequential(byte[] buffer);

static Guid NewSequentialGuid() {

    byte[] raw = new byte[16];
    if (UuidCreateSequential(raw) != 0)
        throw new System.ComponentModel.Win32Exception(System.Runtime.InteropServices.Marshal.GetLastWin32Error());

    byte[] fix = new byte[16];

    // reverse 0..3
    fix[0x0] = raw[0x3];
    fix[0x1] = raw[0x2];
    fix[0x2] = raw[0x1];
    fix[0x3] = raw[0x0];

    // reverse 4 & 5
    fix[0x4] = raw[0x5];
    fix[0x5] = raw[0x4];

    // reverse 6 & 7
    fix[0x6] = raw[0x7];
    fix[0x7] = raw[0x6];

    // all other are unchanged
    fix[0x8] = raw[0x8];
    fix[0x9] = raw[0x9];
    fix[0xA] = raw[0xA];
    fix[0xB] = raw[0xB];
    fix[0xC] = raw[0xC];
    fix[0xD] = raw[0xD];
    fix[0xE] = raw[0xE];
    fix[0xF] = raw[0xF];

    return new Guid(fix);
} 
```

或[此链接](http://msdn.microsoft.com/en-us/library/system.data.sqltypes.sqlguid%28VS.71%29.aspx)或[此链接](http://blogs.msdn.com/sqlprogrammability/archive/2006/03/23/559061.aspx)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-02-18T05:01:44.940

见这篇文章：（[http://www.shirmanov.com/2010/05/generating-newsequentialid-compatible.html](http://www.shirmanov.com/2010/05/generating-newsequentialid-compatible.html)）

即使 MSSql 使用相同的函数来生成 NewSequencialIds ( UuidCreateSequential(out Guid guid) )，MSSQL 也会反转第 3 和第 4 字节模式，这与在代码中使用此函数时得到的结果不同。Shirmanov 展示了如何获得与 MSSQL 完全相同的结果。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-04T15:46:26.107

查看Jimmy Nilsson 的[COMB](http://www.informit.com/articles/article.aspx?p=25862)：一种 GUID，其中许多位已替换为类似时间戳的值。这意味着 COMB 可以排序，并且当用作主键时，在插入新值时会减少索引页面拆分。

[可以使用唯一标识符 (GUID) 作为主键吗？](http://mitch-wheat.blogspot.com.au/2011/08/sql-server-is-it-ok-to-use.html)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-04T15:59:44.943

如果您*需要*`NEWSEQUENTIALID()`使用顺序 GUId，SQL Server 2005 可以使用该功能为您生成它们。

**然而**，由于 GUId 的基本用法是生成无法猜测的密钥（或备用密钥）（例如，为了避免人们在 GET 上传递猜测的密钥），我看不出它们有多适用，因为它们很容易被猜到。

来自[MSDN](http://msdn.microsoft.com/en-us/library/ms189786.aspx)：

> **重要提示：**
> 如果担心隐私问题，请勿使用此功能。可以猜测下一个生成的 GUID 的值，因此可以访问与该 GUID 关联的数据。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-09-26T21:54:29.620

好的，我自己在设计和制作上终于走到了这一步。

我生成了一个 COMB_GUID，其中高 32 位基于 Unix 时间的第 33 位到第 1 位，以毫秒为单位。因此，每 2 毫秒有 93 位随机性，高位的翻转每 106 年发生一次。COMB_GUID（或类型 4 UUID）的实际物理表示是 128 位的 base64 编码版本，即 22 个字符的字符串。

在 postgres 中插入时，完全随机的 UUID 和 COMB _GUID 之间的速度比对 COMB_GUID 有利。COMB_GUID在我的硬件上经过多次测试快**2**倍，用于一百万条记录测试。记录包含 id（22 个字符）、一个字符串字段（110 个字符）、一个双精度和一个 INT。

在 ElasticSearch 中，两者在索引方面没有明显区别。我仍将使用 COMB_GUIDS 以防内容进入链中任何位置的 BTREE 索引，因为内容与时间相关，或者可以在 id 字段上进行预排序，使其**与**时间相关且部分顺序，它将加快速度。

非常有趣。制作 COMB_GUID 的 Java 代码如下。

```
import java.util.Arrays;
import java.util.UUID;
import java.util.Base64; //Only avail in Java 8+
import java.util.Date;

import java.nio.ByteBuffer; 

    private ByteBuffer babuffer = ByteBuffer.allocate( (Long.SIZE/8)*2 );
private Base64.Encoder encoder = Base64.getUrlEncoder();
public  String createId() {
    UUID uuid = java.util.UUID.randomUUID();
        return uuid2base64( uuid );
}

    public String uuid2base64(UUID uuid){ 

        Date date= new Date();
        int intFor32bits;
        synchronized(this){
        babuffer.putLong(0,uuid.getLeastSignificantBits() );
        babuffer.putLong(8,uuid.getMostSignificantBits() );

                long time=date.getTime();
        time=time >> 1; // makes it every 2 milliseconds
                intFor32bits = (int) time; // rolls over every 106 yers + 1 month from epoch
                babuffer.putInt( 0, intFor32bits);

    }
        //does this cause a memory leak?
        return encoder.encodeToString( babuffer.array() );
    } 
```

}

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-11-01T20:42:52.320

我使用实体框架混淆了 Guid（集群和非集群）、顺序 Guid 和 int（身份/自动增量）之间的区别。与具有身份的 int 相比，Sequential Guid 的速度惊人地快。[Sequential Guid 的结果和代码在这里](https://www.siepman.nl/blog/id-sequential-guid-comb-vs-int-identity-using-entity-framework)。

# python - 如何在 apache 下从 mod_python 写入日志？

> ID：170353
> 
> 赞同：2
> 
> 时间：2008-10-04T13:46:06.913
> 
> 标签：python, apache, logging

我似乎只能通过 stderr 写入 Apache 错误日志。任何人都知道我可以从我的 python web 项目中使用的更结构化的日志架构，比如 commons？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-02-07T13:39:14.667

在过去的四年里，这种情况一定发生了变化。如果您遇到这个问题并想要这样做，那么您可以通过请求对象来完成，即

```
def handler(req) :
  req.log_error('Hello apache') 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-04T18:16:55.633

目前没有任何对 mod_python 日志记录到 Apache 的内置支持。如果你真的想在 Apache 日志中工作，你可以查看这个线程（确保你获得了发布代码的第二个版本，而不是第一个）：

*   [http://www.dojoforum.com/node/13239](http://www.dojoforum.com/node/13239)
*   [http://www.modpython.org/pipermail/mod_python/2005-October/019295.html](http://www.modpython.org/pipermail/mod_python/2005-October/019295.html)

如果您只是想使用更结构化的日志记录系统，Blair 提到的 Python 标准日志记录模块功能非常完整。除了 Blair 链接的 Python.org 文档之外，以下是 onLamp 模块功能的更深入了解：

*   [http://www.onlamp.com/pub/a/python/2005/06/02/logging.html](http://www.onlamp.com/pub/a/python/2005/06/02/logging.html)

对于快速示例用法：

*   [http://hackmap.blogspot.com/2007/06/note-to-self-using-python-logging.html](http://hackmap.blogspot.com/2007/06/note-to-self-using-python-logging.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T13:54:49.373

我过去曾在（非网络）项目中使用过内置的[Python 日志记录模块，并取得了成功——它也应该在网络托管的环境中工作。](http://www.python.org/doc/2.5.2/lib/module-logging.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T16:19:16.960

我同意 Blair Conrad 关于 Python 日志记录模块的帖子。然而，标准日志处理程序有时会丢弃消息。值得使用 logging 模块的 SocketHandler 并构建一个接收器来监听消息并将它们写入文件。

这是我的：[示例 SocketHandler 接收器](http://www.djangosnippets.org/snippets/1116/)。

# vba - 如何在 Excel 工作簿中检测用户不活动

> ID：170355
> 
> 赞同：2
> 
> 时间：2008-10-04T13:46:27.583
> 
> 标签：vba, excel, timer, user-inactivity

在一段时间不活动（隐藏/保护某些工作表）后，我想在 Excel 工作簿宏中执行操作。实现这一目标的最佳/最简单方法是什么？

Í假设我会`Application.OnTime`定期检查用户是否处于活动状态。但是我应该处理哪些事件来查看用户是否“活跃”（即对工作簿做了什么 - 任何事情）？

澄清：我想检测*所有*活动，而不仅仅是变化。即包括鼠标点击、选择、复制、使用键盘导航、更改工作表、...

我假设当代表用户活动的 UI 事件发生时，我将设置一个变量：

```
LastActivityTime = Now 
```

并且运行的宏`Application.OnTime`将检查此变量以查看用户最近是否处于活动状态。`SheetChange`我需要处理哪些事件（除了）来设置这个变量？我有点希望会有事件`KeyUp`，`MouseUp`这两个可能就足够了。

更新：我已经通过处理`Workbook_SheetActivate`,`Workbook_SheetSelectionChange`和`Workbook_WindowActivate`. 实际上，这可能就足够了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-25T11:17:01.033

我通过处理 Workbook_SheetActivate、Workbook_SheetSelectionChange 和 Workbook_WindowActivate 实现了这一点。实际上，这可能就足够了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T14:16:14.260

我只能看到两种解决方案——要么处理 Application 对象具有的每个单个事件，要么使用[GetLastInputInfo](http://msdn.microsoft.com/en-us/library/ms646302.aspx)函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T14:00:40.503

一种简单的方法是将工作簿的内容与您上次检查的内容进行比较。我相信将此与 Application.OnTime 结合使用将解决您的问题。

# xml - tomcat 5.5 是否以相同的方式处理 .jsp 和 .jspx 文件？

> ID：170377
> 
> 赞同：2
> 
> 时间：2008-10-04T14:02:17.190
> 
> 标签：xml, tomcat, jspx

我正在开发一个 java web 应用程序，试图对 xml 友好并使用 jspx/xml 语法编写我的 jsp 文件。我花了几个小时剖析示例和配置文件，发现使用新语法的 tomcat 5.5 文件应该以 .jspx 结尾，否则 tomcat 不会翻译标记库和东西。

两个文件扩展名都映射到 tomcat 配置文件中的同一个 servlet，所以我认为我的 .jsp 文件一切正常。我错过了什么吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T00:59:39.267

servlet 的其他配置可能会影响行为。我没有尝试过，但假设您可以覆盖 *.jsp 的一些默认配置以使用 *.jspx 的配置。

尝试为***.jsp添加****jsp-property-group**定义，并将**is-xml**设置为 true：

 ****```
<jsp-property-group>
  <url-pattern>*.jsp</url-pattern>
  <is-xml>true</is-xml>
</jsp-property-group> 
```

[有关配置属性组的一些信息](http://www.onjava.com/pub/a/onjava/2003/12/03/JSP2part2.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T13:12:37.430

不能轻易放弃，我在[Java5 EE 教程](http://java.sun.com/javaee/5/docs/tutorial/doc/bnajq.html)中找到了这个解释，

> 尽管 jsp:root 元素不是必需的，但在以下情况下它仍然很有用：
> 
> *   当您想要将文档标识为 JSP 容器的 JSP 文档而无需向部署描述符添加任何配置属性或使用 .jspx 扩展名命名文档时

所以我想我应该更仔细地阅读文档:-)

# c++ - 为什么线程函数需要声明为'__cdecl'？

> ID：170380
> 
> 赞同：6
> 
> 时间：2008-10-04T14:05:20.087
> 
> 标签：c++, multithreading, mfc, boost

演示如何使用 MFC 创建线程的示例代码将线程函数声明为静态和`__cdecl`. 为什么需要后者？Boost 线程不关心这个约定，所以它只是一个不合时宜的东西吗？

例如（MFC）：

```
static __cdecl UINT MyFunc(LPVOID pParam)
{
...
}

CWinThread* pThread = AfxBeginThread(MyFunc, ...); 
```

而提升：

```
static void func()
{
...
}

boost::thread t;
t.create(&func); 
```

（代码示例可能不是 100% 正确，因为我离 IDE 还很远）。

__cdecl 的意义何在？创建线程时它有什么帮助？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-04T14:11:59.527

__cdecl 告诉编译器使用 C 调用约定（与 stdcall、fastcall 或您的编译器支持的任何其他调用约定相反）。我相信，VC++ 默认使用 stdcall。

调用约定会影响诸如参数如何被压入堆栈（或寄存器，在 fastcall 的情况下）以及谁将参数从堆栈中弹出（调用者或被调用者）之类的事情。

在升压的情况下。我相信它使用模板专业化来找出适当的函数类型和调用约定。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T14:15:54.480

查看原型[`AfxBeginThread()`](http://msdn.microsoft.com/en-us/library/s3w9x78e(VS.80).aspx)：

```
CWinThread* AfxBeginThread(
   AFX_THREADPROC pfnThreadProc,
   LPVOID pParam,
   int nPriority = THREAD_PRIORITY_NORMAL,
   UINT nStackSize = 0,
   DWORD dwCreateFlags = 0,
   LPSECURITY_ATTRIBUTES lpSecurityAttrs = NULL 
); 
```

`AFX_THREADPROC`是`UINT(AFX_CDECL*)(LPVOID)`. 当您将函数传递给 时`AfxBeginThread()`，它必须匹配该原型，包括调用约定。

[`__cdecl`](http://msdn.microsoft.com/en-us/library/zkwh89ks.aspx)和[`__stdcall`](http://msdn.microsoft.com/en-us/library/zxk0tw93.aspx)（以及`__fastcall`和）上的 MSDN 页面`__thiscall`解释了每种调用约定的优缺点。

构造[`boost::thread`](http://www.boost.org/doc/libs/1_36_0/doc/html/thread/thread_management.html#thread.thread_management.thread)函数使用模板允许您传递函数指针或可调用函数对象，因此它没有与 MFC 相同的限制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T14:10:53.850

因为您的线程将由为您管理它的运行时函数调用，并且该函数期望它是这样的。Boost 以不同的方式设计了它。

在线程函数的开头放置一个断点并在调用它时查看堆栈，您将看到调用您的运行时函数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T16:17:53.953

默认情况下，C/C++ 编译器使用 C 调用约定（首先将最右边的参数推入堆栈），因为它允许使用具有可变参数编号的函数作为 printf。

Pascal 调用约定（又名“fastcall”）首先推送最左边的参数。尽管您需要使用一些技巧，但这会更快，尽管您可能会使用简单的可变参数函数（我在某处读到它们仍然可能，但您需要使用一些技巧）。

由于使用 Pascal 约定带来的速度，Win32 和 MacOS API 在默认情况下都使用该调用约定，除非在某些情况下。

如果该函数只有一个参数，理论上使用任一调用约定都是合法的，尽管编译器可能会强制使用相同的调用约定来避免任何问题。

boost 库的设计着眼于可移植性，因此它们应该不知道特定编译器正在使用哪种调用者约定。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-17T22:19:50.600

真正的答案与 windows 如何在内部调用线程 proc 例程有关，它期望函数遵守特定的调用约定，在这种情况下是宏 WINAPI，根据我的系统定义为：

```
#define WINAPI      __stdcall 
```

这意味着被调用的函数负责清理堆栈。boost::thread 能够支持任意函数的原因是它传递了一个指向函数对象的指针，该指针用于调用 thread::create 函数到 CreateThread。与线程关联的 threadproc 只是简单地调用函数对象上的 operator()。

因此，MFC 需要 __cdecl 的原因与它在内部调用传递给 AfxBeginThread 调用的函数的方式有关。除非他们计划允许可变参数，否则没有充分的理由这样做......

# c# - C# 中快速傅里叶变换 (FFT) 的实现

> ID：170394
> 
> 赞同：76
> 
> 时间：2008-10-04T14:12:19.573
> 
> 标签：c#, signal-processing, fft

在哪里可以找到免费、非常快速且可靠的 C# 中 FFT 实现？

那可以用在一个产品上吗？或者有什么限制吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-04-06T12:34:04.293

做 AForge 的那个人做得相当不错，但这不是商业质量。从中学习很好，但你可以看出他也在学习，所以他有一些非常严重的错误，比如假设图像的大小而不是使用每个像素的正确位数。

我不是要打他，我尊重他学习所有这些并告诉我们如何去做。我认为他现在是博士，或者至少他即将成为博士，所以他真的很聪明，只是不是一个商业可用的图书馆。

在处理傅里叶变换和复杂图像/数字时，Math.Net 库有其自身的怪异之处。就像，如果我没记错的话，它会以人类可见的格式输出傅立叶变换，如果您想查看变换的图片，这对人类来说很好，但是当您期望数据处于特定状态时，它就不是很好了格式（正常格式）。我可能弄错了，但我只记得有一些奇怪之处，所以我实际上去了他们用于傅里叶东西的原始代码，它工作得更好。（ExocortexDSP v1.2 [http://www.exocortex.org/dsp/](http://www.exocortex.org/dsp/)）

在处理来自 FFT 的数据时，Math.net 还有一些我不喜欢的其他古怪之处，我不记得它是什么我只知道从 ExoCortex DSP 库中获得我想要的东西要容易得多。我不是数学家或工程师。对那些人来说，这可能很有意义。

所以！我使用从 Math.Net 所基于的 ExoCortex 提取的 FFT 代码，没有其他任何东西，而且效果很好。

最后，我知道它不是 C#，但我已经开始考虑使用 FFTW ( [http://www.fftw.org/](http://www.fftw.org/) )。这个人已经做了一个 C# 包装器，所以我打算检查一下，但还没有真正使用它。( [http://www.sdss.jhu.edu/~tamas/bytes/fftwcsharp.html](http://www.sdss.jhu.edu/~tamas/bytes/fftwcsharp.html) )

哦！我不知道你这样做是为了学校还是工作，但不管怎样，iTunes 大学的斯坦福教授都会提供一个很棒的免费系列讲座。

[https://podcasts.apple.com/us/podcast/the-fourier-transforms-and-its-applications/id384232849](https://podcasts.apple.com/us/podcast/the-fourier-transforms-and-its-applications/id384232849)

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-04T14:23:09.193

[AForge.net](http://code.google.com/p/aforge/)是一个免费（开源）库，支持快速傅里叶变换。（参见 Sources/Imaging/ [ComplexImage.cs](https://github.com/andrewkirillov/AForge.NET/blob/master/Sources/Imaging/ComplexImage.cs)的用法，Sources/Math/ [FourierTransform.cs](https://github.com/andrewkirillov/AForge.NET/blob/master/Sources/Math/FourierTransform.cs)的实现）

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-13T16:29:21.863

Math.NET 的[Iridium 库](http://iridium.mathdotnet.com)提供了一个快速、定期更新的数学相关函数集合，包括 FFT。它在 LGPL 下获得许可，因此您可以在商业产品中自由使用它。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-10-19T07:04:51.890

我看到这是一个旧线程，但值得一提的是，这是我在 2010 年编写的一个免费（MIT 许可证）1-D power-of-2-length-only C# FFT implementation。

我没有将它的性能与其他 C# FFT 实现进行比较。我写它主要是为了比较 Flash/ActionScript 和 Silverlight/C# 的性能。后者要快得多，至少对于数字运算来说是这样。

```
/**
 * Performs an in-place complex FFT.
 *
 * Released under the MIT License
 *
 * Copyright (c) 2010 Gerald T. Beauregard
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 */
public class FFT2
{
    // Element for linked list in which we store the
    // input/output data. We use a linked list because
    // for sequential access it's faster than array index.
    class FFTElement
    {
        public double re = 0.0;     // Real component
        public double im = 0.0;     // Imaginary component
        public FFTElement next;     // Next element in linked list
        public uint revTgt;         // Target position post bit-reversal
    }

    private uint m_logN = 0;        // log2 of FFT size
    private uint m_N = 0;           // FFT size
    private FFTElement[] m_X;       // Vector of linked list elements

    /**
     *
     */
    public FFT2()
    {
    }

    /**
     * Initialize class to perform FFT of specified size.
     *
     * @param   logN    Log2 of FFT length. e.g. for 512 pt FFT, logN = 9.
     */
    public void init(
        uint logN )
    {
        m_logN = logN;
        m_N = (uint)(1 << (int)m_logN);

        // Allocate elements for linked list of complex numbers.
        m_X = new FFTElement[m_N];
        for (uint k = 0; k < m_N; k++)
            m_X[k] = new FFTElement();

        // Set up "next" pointers.
        for (uint k = 0; k < m_N-1; k++)
            m_X[k].next = m_X[k+1];

        // Specify target for bit reversal re-ordering.
        for (uint k = 0; k < m_N; k++ )
            m_X[k].revTgt = BitReverse(k,logN);
    }

    /**
     * Performs in-place complex FFT.
     *
     * @param   xRe     Real part of input/output
     * @param   xIm     Imaginary part of input/output
     * @param   inverse If true, do an inverse FFT
     */
    public void run(
        double[] xRe,
        double[] xIm,
        bool inverse = false )
    {
        uint numFlies = m_N >> 1;   // Number of butterflies per sub-FFT
        uint span = m_N >> 1;       // Width of the butterfly
        uint spacing = m_N;         // Distance between start of sub-FFTs
        uint wIndexStep = 1;        // Increment for twiddle table index

        // Copy data into linked complex number objects
        // If it's an IFFT, we divide by N while we're at it
        FFTElement x = m_X[0];
        uint k = 0;
        double scale = inverse ? 1.0/m_N : 1.0;
        while (x != null)
        {
            x.re = scale*xRe[k];
            x.im = scale*xIm[k];
            x = x.next;
            k++;
        }

        // For each stage of the FFT
        for (uint stage = 0; stage < m_logN; stage++)
        {
            // Compute a multiplier factor for the "twiddle factors".
            // The twiddle factors are complex unit vectors spaced at
            // regular angular intervals. The angle by which the twiddle
            // factor advances depends on the FFT stage. In many FFT
            // implementations the twiddle factors are cached, but because
            // array lookup is relatively slow in C#, it's just
            // as fast to compute them on the fly.
            double wAngleInc = wIndexStep * 2.0*Math.PI/m_N;
            if (inverse == false)
                wAngleInc *= -1;
            double wMulRe = Math.Cos(wAngleInc);
            double wMulIm = Math.Sin(wAngleInc);

            for (uint start = 0; start < m_N; start += spacing)
            {
                FFTElement xTop = m_X[start];
                FFTElement xBot = m_X[start+span];

                double wRe = 1.0;
                double wIm = 0.0;

                // For each butterfly in this stage
                for (uint flyCount = 0; flyCount < numFlies; ++flyCount)
                {
                    // Get the top & bottom values
                    double xTopRe = xTop.re;
                    double xTopIm = xTop.im;
                    double xBotRe = xBot.re;
                    double xBotIm = xBot.im;

                    // Top branch of butterfly has addition
                    xTop.re = xTopRe + xBotRe;
                    xTop.im = xTopIm + xBotIm;

                    // Bottom branch of butterly has subtraction,
                    // followed by multiplication by twiddle factor
                    xBotRe = xTopRe - xBotRe;
                    xBotIm = xTopIm - xBotIm;
                    xBot.re = xBotRe*wRe - xBotIm*wIm;
                    xBot.im = xBotRe*wIm + xBotIm*wRe;

                    // Advance butterfly to next top & bottom positions
                    xTop = xTop.next;
                    xBot = xBot.next;

                    // Update the twiddle factor, via complex multiply
                    // by unit vector with the appropriate angle
                    // (wRe + j wIm) = (wRe + j wIm) x (wMulRe + j wMulIm)
                    double tRe = wRe;
                    wRe = wRe*wMulRe - wIm*wMulIm;
                    wIm = tRe*wMulIm + wIm*wMulRe;
                }
            }

            numFlies >>= 1;     // Divide by 2 by right shift
            span >>= 1;
            spacing >>= 1;
            wIndexStep <<= 1;   // Multiply by 2 by left shift
        }

        // The algorithm leaves the result in a scrambled order.
        // Unscramble while copying values from the complex
        // linked list elements back to the input/output vectors.
        x = m_X[0];
        while (x != null)
        {
            uint target = x.revTgt;
            xRe[target] = x.re;
            xIm[target] = x.im;
            x = x.next;
        }
    }

    /**
     * Do bit reversal of specified number of places of an int
     * For example, 1101 bit-reversed is 1011
     *
     * @param   x       Number to be bit-reverse.
     * @param   numBits Number of bits in the number.
     */
    private uint BitReverse(
        uint x,
        uint numBits)
    {
        uint y = 0;
        for (uint i = 0; i < numBits; i++)
        {
            y <<= 1;
            y |= x & 0x0001;
            x >>= 1;
        }
        return y;
    } 
```

}

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-04T14:23:38.333

[http://www.exocortex.org/dsp/](http://www.exocortex.org/dsp/)是一个带有 FFT 算法的开源 C# 数学库。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-11-12T16:51:14.010

这是另一个；Ooura FFT 的 C# 端口。它相当快。该软件包还包括重叠/添加卷积和一些其他 DSP 的东西，在 MIT 许可下。

[https://github.com/hughpyle/inguz-DSPUtil/blob/master/Fourier.cs](https://github.com/hughpyle/inguz-DSPUtil/blob/master/Fourier.cs)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-01-29T16:37:46.427

一个老问题，但它仍然出现在谷歌搜索结果中......

可以在以下位置找到一个非常不受限制的 MIT 许可 C#/.NET 库，

[https://www.codeproject.com/articles/1107480/dsplib-fft-dft-fourier-transform-library-for-net](https://www.codeproject.com/articles/1107480/dsplib-fft-dft-fourier-transform-library-for-net)

这个库速度很快，因为它在多个内核上并行线程，并且非常完整并且可以使用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-01-31T18:10:47.290

Numerical Recipes 网站 (http://www.nr.com/) 有一个 FFT，如果您不介意输入的话。我正在开展一个项目，将 Labview 程序转换为 C# 2008、.NET 3.5 以获取数据和然后看频谱。不幸的是，Math.Net 使用了最新的 .NET 框架，所以我不能使用那个 FFT。我尝试了 Exocortex 之一 - 它有效，但结果与 Labview 结果相匹配，而且我不知道足够的 FFT 理论来了解导致问题的原因。所以我在数字食谱网站上尝试了 FFT，它奏效了！我还能够对 Labview 低旁瓣窗口进行编程（并且必须引入比例因子）。

您可以在他们的网站上以访客身份阅读数字食谱书的章节，但这本书非常有用，我强烈建议购买它。即使您最终使用 Math.NET FFT。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-11-06T05:34:21.030

对于针对英特尔处理器调整的多线程实现，我会查看英特尔的 MKL 库。它不是免费的，但价格实惠（不到 100 美元）而且速度极快——但您需要通过 P/Invokes 将其称为 C dll。Exocortex 项目在 6 年前停止开发，所以如果这是一个重要项目，我会小心使用它。

# maven-2 - Maven：缺少：org.apache.maven.wagon:wagon-ftp:jar:1.0-rc1-SNAPSHOT

> ID：170395
> 
> 赞同：0
> 
> 时间：2008-10-04T14:12:41.337
> 
> 标签：maven-2

我是 Maven 新手，所以我可能会遗漏一些明显的东西，但是我有一个 Maven 项目，当我尝试“mvn package”这个项目时它失败了

```
ERROR BUILD ERROR INFO
------------------------------------------------------------------------  [INFO] Failed to resolve artifact.

Missing:
----------  1) org.apache.maven.wagon:wagon-ftp:jar:1.0-rc1-SNAPSHOT

  Try downloading the file manually from the project website.

  Then, install it using the command:
      mvn install:install-file -DgroupId=org.apache.maven.wagon -DartifactId=wagon-ftp -Dversion=1.0-rc1-SNAPSHOT -Dpackaging=ja r -Dfile=/path/to/file

  Alternatively, if you host your own repository you can deploy the file there:
      mvn deploy:deploy-file -DgroupId=org.apache.maven.wagon -DartifactId=wagon-ftp -Dversion=1.0-rc1-SNAPSHOT -Dpackaging=jar
-Dfile=/path/to/file -Durl=[url] -DrepositoryId=[id]

  Path to dependency:
        1) com.cgs:domain:jar:1.0-SNAPSHOT
        2) org.apache.maven.wagon:wagon-ftp:jar:1.0-rc1-SNAPSHOT

---------- 
1 required artifact is missing.

    for artifact:   com.cgs:domain:jar:1.0-SNAPSHOT

    from the specified remote repositories:   ibiblio.org (http://mirrors.ibiblio.org/pub/mirrors/maven2) 
```

我不明白的第一件事是它需要1.0-rc1-SNAPSHOT的版本。[该项目的网站](http://maven.apache.org/wagon/wagon-providers/wagon-ftp/project-info.html)说当前版本是 1.0- *beta* -5。我想[beta在RC*之前*](http://en.wikipedia.org/wiki/Software_release_life_cycle)。

无论如何，我已经尝试下载最新的 wagon-ftp JAR（1.0 beta 6 jar）并根据错误消息中的说明进行部署。但你猜怎么着，这给了我同样的错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T14:15:20.270

我刚刚在输入这个问题的结尾时找到了解决方案。

问题是我从失败的项目 POM 所在的*同一目录*运行“mvn install:install-file” 。当我从另一个没有 pom.xml 的目录运行它时，它安装得很好。

# ruby - 使用 _details 方法单击链接时，Scrubyt 给出 404 错误

> ID：170405
> 
> 赞同：1
> 
> 时间：2008-10-04T14:17:43.073
> 
> 标签：ruby, scrubyt

这可能与我之前的两个问题类似 - 请参阅[此处](https://stackoverflow.com/questions/169934/any-scrubyt-command-that-clicks-a-link-returns-a-403-forbidden-error)和[此处，](https://stackoverflow.com/questions/168868/how-to-get-next-page-link-with-scrubyt)但我正在尝试使用 _detail 命令自动单击链接，以便我可以抓取每个事件的详细信息页面。

我正在使用的代码是：

```
require 'rubygems'
require 'scrubyt'

nuffield_data = Scrubyt::Extractor.define do
  fetch 'http://www.nuffieldtheatre.co.uk/cn/events/event_listings.php'

  event do
    title 'The Coast of Mayo'
    link_url
    event_detail do
      dates "1-4 October"
      times "7:30pm"
    end
  end

  next_page "Next Page", :limit => 20
end

  nuffield_data.to_xml.write($stdout,1) 
```

有没有办法打印出使用 event_detail 试图访问的 URL？该错误似乎没有给我给出 404 的 URL。

**更新：**我认为该链接可能是一个相对链接——这会导致问题吗？任何想法如何处理？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T22:56:48.580

```
 sudo gem install ruby-debug

This will give you access to a nice ruby debugger, start the debugger by altering your script:

    require 'rubygems'
    require 'ruby-debug'
    Debugger.start
    Debugger.settings[:autoeval] = true if Debugger.respond_to?(:settings)

    require 'scrubyt'

    nuffield_data = Scrubyt::Extractor.define do
      fetch 'http://www.nuffieldtheatre.co.uk/cn/events/event_listings.php'

      event do
        title 'The Coast of Mayo'
        link_url
        event_detail do
          dates "1-4 October"
          times "7:30pm"
        end
      end

      next_page "Next Page", :limit => 2

    end

    nuffield_data.to_xml.write($stdout,1)

Then find out where scrubyt is throwing an exception - in this case:

    /Library/Ruby/Gems/1.8/gems/scrubyt-0.3.4/lib/scrubyt/core/navigation/fetch_action.rb:52:in `fetch'

Find the scrubyt gem on your system, and add a rescue clause to the method in question so that the end of the method looks like this:

      if @@current_doc_protocol == 'file'
        @@hpricot_doc = Hpricot(PreFilterDocument.br_to_newline(open(@@current_doc_url).read))
      else
        @@hpricot_doc = Hpricot(PreFilterDocument.br_to_newline(@@mechanize_doc.body))
        store_host_name(self.get_current_doc_url)   # in case we're on a new host
      end
    rescue
      debugger
      self # the self is here because debugger doesn't like being at the end of a method
    end 
```

现在再次运行脚本，当引发异常时，您应该被放入调试器中。只需尝试在调试提示中键入此内容，即可查看有问题的 URL 是什么：

```
@@current_doc_url 
```

如果您想检查发生了什么，您还可以在该方法的任何位置添加调试器语句 - 例如，您可能希望在此方法的第 51 行和第 52 行之间添加一个调试器语句，以检查被调用的 url 如何更改以及为什么。

这基本上就是我如何找出你之前问题的答案。

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-15T13:02:06.897

我对相对链接有同样的问题并像这样修复它......你必须将 :resolve 参数设置为正确的基本 url

```
 event do
    title 'The Coast of Mayo'
    link_url
    event_detail :resolve => 'http://www.nuffieldtheatre.co.uk/cn/events' do
      dates "1-4 October"
      times "7:30pm"
    end
  end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T20:19:40.813

抱歉，我不知道为什么它会为零 - 每次我运行它都会返回一个 url - self.fetch 方法需要一个 URL，您应该能够作为局部变量 doc_url 访问该 URL。如果这返回 nil 也可能您应该发布包含调试器调用的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-06T08:07:44.863

我试图访问 doc_url 但这似乎也返回 nil。当我可以访问我的服务器时（当天晚些时候），我将发布带有调试位的代码。

# javascript - 你知道什么可能导致 JavaScript 中的内存泄漏吗？

> ID：170415
> 
> 赞同：23
> 
> 时间：2008-10-04T14:23:37.727
> 
> 标签：javascript, memory-leaks

你知道什么可能导致 JavaScript 中的内存泄漏吗？我对浏览器感兴趣：IE 7、FireFox 3、Safari 3

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-04T14:41:15.787

有一篇关于[**JavaScript 和内存泄漏**](http://www.javascriptkit.com/javatutors/closuresleak/index.shtml)的好文章。它没有具体介绍浏览器，而是描述了内存泄漏和 JavaScript 的整个问题。

*   [JavaScript 和内存泄漏](http://www.javascriptkit.com/javatutors/closuresleak/index.shtml)
*   [介绍关闭](http://www.javascriptkit.com/javatutors/closuresleak/index2.shtml)
*   [更多泄漏模式](http://www.javascriptkit.com/javatutors/closuresleak/index3.shtml)
*   [结论](http://www.javascriptkit.com/javatutors/closuresleak/index4.shtml)

我认为在为公众开发网站时，尽可能不针对浏览器进行优化是一种更好的方法。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-04T14:43:34.440

这是 IE 中的经典内存泄漏：-

```
function body_onload()
{
    var elem = document.getElementById('someElementId');
    // do stuff with elem
    elem.onclick = function() {
        //Some code that doesn't need the elem variable
    }
 } 
```

在此代码运行后，存在循环引用，因为元素具有分配其 onclick 事件的函数，该函数引用范围对象，而范围对象又持有对元素的引用。

someElement->onclick->function-scope->elem->someElement

在 IE DOM 元素中，Javascript GC 无法清理基于 COM 的引用计数对象。

在上面的代码中添加最后一行会清理它：-

```
var elem = null; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T14:30:04.297

一般来说; 循环引用是许多问题的原因。我记得 IE 6（不确定它是否适用于 7）在使用 XMLHTTP 时泄漏非常严重......一旦完成修复，就设置 onreadystatechange = null。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T15:01:59.287

您正在处理 2 种对象（和 2 个垃圾收集器），javascript 和 DOM 对象，它们可以相互引用（循环引用），然后即使页面卸载，GC 也无法处理其所有对象。这是一个很好的描述：

[http://getben.com/archive/2006/05/30/Resolving-JavaScript-Memory-Leaks.aspx](http://getben.com/archive/2006/05/30/Resolving-JavaScript-Memory-Leaks.aspx)

[http://www.josh-davis.org/2007/04/11/javascript-built-in-listeners-and-memory-leaks/](http://www.josh-davis.org/2007/04/11/javascript-built-in-listeners-and-memory-leaks/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-04T14:48:53.197

您可以查看[此](http://msdn.microsoft.com/en-us/library/bb250448(VS.85).aspx)MSDN 文章以了解 Internet Explorer 内存泄漏模式。还有一些用于检测内存泄漏的工具：

*   [筛](http://home.wanadoo.nl/jsrosman/)
*   [JavaScript 内存泄漏检测器](http://blogs.msdn.com/gpde/pages/javascript-memory-leak-detector.aspx)
*   [泄漏监视器 FireFox 插件](https://addons.mozilla.org/en-US/firefox/addon/2490)

# registry - HowTo：解析 UninstallString reg 条目

> ID：170420
> 
> 赞同：5
> 
> 时间：2008-10-04T14:25:39.547
> 
> 标签：registry, uninstallstring

In`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\`是我机器中已安装程序的列表（至少其中大部分）。在那里，有一个名为 UninstallString 的字符串值，它包含您需要运行才能卸载程序的内容。
问题不是每个安装程序都会写入相同类型的信息，但 Windows 知道如何解析该字符串以运行卸载程序。
我的问题是：有人知道如何解析那个字符串吗？这意味着它可能得到什么值？如果没有，我在哪里可以找到那种信息？我用谷歌搜索没有运气，我想我不是在寻找正确的条款。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T15:15:13.253

查看[MSDN 中的此链接，解释安装/卸载程序](http://msdn.microsoft.com/en-us/library/ms954376.aspx)，特别是第 6 项“正确支持添加/删除程序”。

作为那里表格的摘录：

```
   键名 | 键类型 | 描述
卸载路径 | REG_EXPAND_SZ | 应用程序卸载程序的完整路径

```

尽管它说的是“完整路径”，但如果程序在，很多应用程序似乎都会缩短它`$PATH`，尤其是像`msiexec.exe`.

# python - 性能：Python 3.x 与 Python 2.x

> ID：170426
> 
> 赞同：24
> 
> 时间：2008-10-04T14:28:20.947
> 
> 标签：python, performance, python-3.x, python-2.x

关于性能问题，Python 3 与 Python 2.x 相比如何？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-04T16:29:03.977

在官方基准上，3.0 比 2.5 慢。来自[“Python 3.0 的新特性”](http://docs.python.org/3.0/whatsnew/3.0.html#performance)：

> 3.0 泛化的最终结果是 Python 3.0 运行 pystone 基准的速度比 Python 2.5 慢 10% 左右。最可能的最大原因是删除了小整数的特殊情况。有改进的余地，但会在3.0发布之后发生！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-04T15:29:37.547

我会说任何差异都将是微不足道的。例如，遍历一个列表将是完全相同的。

Python 3 背后的想法是清理语言语法本身 - 删除模棱两可的东西`except Exception1, Exception2`，清理标准模块（没有 urllib、urllib2、httplib 等）。

确实没有太多可以提高它的性能，虽然我想像垃圾收集和内存管理代码这样的东西会有一些调整，但这不会是“哇，我的数据库统计生成代码完成了一半时间！” 改进——这是你通过改进代码而不是语言得到的！

真的，语言的性能是无关紧要的——所有解释语言基本上都以相同的速度运行。为什么我发现 Python “更快”是所有内置模块和易于编写的语法 -在 Python3*中已经*改进了一些东西，所以我猜从这些方面来说，是的，python3 的性能优于 python2.x。 .

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-27T16:32:06.297

IO 库已经完全重新设计，新的实现是纯 Python 的。虽然这是一项功能改进，但目前速度要慢得多。用 C 重写大部分新系统的工作正在进行中。有关详细信息，请参阅[这些](http://bugs.python.org/issue4533) [错误](http://bugs.python.org/issue4561) [报告](http://bugs.python.org/issue4565)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-04T18:28:55.233

我认为最终进行这种比较还为时过早。等到它退出测试版后再对其进行基准测试。解释器可能会在发布之前得到极大的改进，但总的来说，我认为对于大多数用途来说，性能是相当的，如果你正在运行一个真正注重速度的应用程序，python 真的是正确的语言吗？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-04T18:23:50.610

除非有某种新 VM 的计划（我还没有听说过任何这样的计划），否则有理由相信，从长远来看，Py3K 的性能将至少渐近地等于 2.5

这可能需要几个月的时间，但最终会发生，因为 Py3k 的新特性中没有任何东西天生就性能较差。

总而言之，我认为没有地方担心它。也不希望有某种重大改进。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T16:02:15.607

如果它现在更快，我不知道，但我不得不期待它最终会是因为新的性能工作将在那里发生，而不是所有这些都将被向后移植。

# sql - 存储过程未在另一个存储过程中执行

> ID：170440
> 
> 赞同：3
> 
> 时间：2008-10-04T14:37:14.033
> 
> 标签：sql, sql-server, sql-server-2005, stored-procedures

我发现执行 SP1 时，SP2 不会从 SP1 内执行。

SP1的结构如下：

```
ALTER PROCEDURE SP1 AS BEGIN

Declare c1 cursor....

open c1 fetch next from c1 ...

while @@fetch_status = 0 Begin

...

Fetch Next from c1 end

close c1

deallocate c1

exec sp2

end 
```

* * *

如果在 SQL Server 2005 管理工作室的“输出窗口”中打印，我看不到任何 PRINT 语句输出，因为“输出窗口”为空。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T14:46:28.570

What happens if you run the Stored Procedure code as a single query? If you put a `PRINT` statement before and after the exec, do you see both outputs?

*   If you do, then the stored procedure must have been executed. Probably it's not doing what you would like.
*   If you don't see any print output, then there's something wrong in the cycle
*   If you don't see the second output but you see the first, there's something wrong in the second Stored Procedure.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T19:48:26.380

我不确定它是否对您有帮助，但根据我的经验，最常见的原因是：

1.  `sp2`获取一些使其`null`值的参数 - 即您从字符串构建它的名称，其中之一是`null`.
2.  `sp2`里面有一些条件，没有一个是真的，所以`sp2`根本不执行任何代码——即参数之一是 type `varchar`，你传递 value `VALUE`，在里面检查它，但传递给的真实值`sp2`是`V`（因为没有 varchar 长度定义）。
3.  `sp2`从参数之一构建查询，`null`整个查询也变成`null`了。

如果您在调用`PRINT` *之前*和*之后*`sp2`放置，您会看到任何输出吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T14:52:01.500

您可以使用@@error 来查看执行上一条语句时是否有错误。

# search-engine - 有人用 .NET 实现了 Endeca 吗？你会推荐 Endeca 还是 FAST？

> ID：170442
> 
> 赞同：1
> 
> 时间：2008-10-04T14:39:10.830
> 
> 标签：search-engine, performance, endeca

您会为 Commerce 网站推荐哪个搜索引擎？

我们的目录中有数百万种产品，我们希望它尽可能快。

我们还希望确保通过搜索引擎驱动的营销将快速有效。

你有什么意见？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-24T19:44:45.950

这只是你问题的一半答案。我已经将它用于 Java 而不是 .NET。据说Fast是更好的搜索引擎。我不知道。然而，对于 Commerce，Endeca 被认为是最好的。我已经将它与 5Mil 的目录一起使用。产品和查询非常非常快。如果您在最终解决方案中使用 .NET 或 Java，则搜索引擎保持不变。而要使用什么搜索引擎也不容易回答。这一切都取决于您想要/可以花费什么。我在 Endeca 的经历非常积极。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-15T16:21:00.200

我们已经在几个 .NET 电子商务网站上使用了 Endeca，当然我认为与 SQL Server 相比，它可以让我们更快地进行全文搜索，并且几乎不需要编码，但是 Endeca 过于复杂，它花费了我们大量的时间来更新和配置。它的查询能力非常有限，当我们习惯使用 SQL 查询时，它缺乏灵活性。

我将通过将 Lucene.Net 用于搜索部分来减少对 Endeca 的依赖。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T18:24:16.860

我参与了 Endeca 的几个 .NET 实现，并且每次都很开心。Endeca 相对于 FAST 的最大优势在于实施的成本和时间。

我的建议是记录您的要求并发送 RFP。确保在 RFP 中包含以下内容：

*   提议的解决方案的演示（确保他们在演示中清楚地解释了提议成本中包含哪些功能以及哪些功能需要额外付费）。

*   在您使用的相同商务软件之上实施此解决方案的现有客户示例。

*   软件许可成本（您需要提供有关您在商业目录中的记录数量的详细信息，因为两家公司都以此为基础定价）

*   可用模块/插件及其各自成本的详细列表。

*   实施成本。

*   实施时间表。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T06:55:35.070

Endeca 是我个人认为最好的商业产品。我们一直将它用于我们数百万的目录数据。

或者你可以试试 Lucene.NET

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-11T17:56:34.773

在购买 Endeca 之前要考虑的一件事是，Oracle 通过服务器中的物理 CPU 许可产品。因此，如果您正在考虑将 Endeca 服务器虚拟化为 VCE 或其他刀片虚拟化服务器，则您必须为设备中的所有 CPU 刀片支付许可证费用，即使您只为 Endeca 使用其中一个刀片也是如此。这使得 Endeca 仅适用于物理服务器安装，这完全是因为 Oracle 许可问题。

# encoding - 理论：“词汇编码”

> ID：170452
> 
> 赞同：4
> 
> 时间：2008-10-04T14:48:06.927
> 
> 标签：encoding, theory, nlp, linguistics

**我使用术语“词法编码”是因为我没有更好的词法编码。**

与字母相反，单词可以说是交流的基本单位。Unicode 尝试为所有已知字母的每个字母分配一个数值。对一种语言来说是字母，对另一种语言来说是字形。目前，Unicode 5.1 为这些 Glyphs 分配了超过 100,000 个值。在现代英语中使用的大约 180,000 个单词中，据说使用大约 2,000 个单词的词汇，您应该能够进行一般性的交谈。“词汇编码”将对每个单词而不是每个字母进行编码，并将它们封装在一个句子中。

```
// An simplified example of a "Lexical Encoding"
String sentence = "How are you today?";
int[] sentence = { 93, 22, 14, 330, QUERY }; 
```

在这个例子中，String 中的每个 Token 都被编码为一个 Integer。这里的编码方案只是简单地根据单词使用的广义统​​计排名分配一个int值，并为问号分配一个常数。

最终，一个单词同时具有拼写和含义。任何“词汇编码”都会保留整个句子的含义和意图，而不是特定于语言的。一个英文句子将被编码为[“……语言中立的原子意义元素……”](https://stackoverflow.com/questions/170452/linguistics-lexical-encoding#174249)，然后可以将其重构为具有结构化句法形式和语法结构的任何语言。

“词法编码”技术的其他例子是什么？

* * *

如果您对单词使用统计数据的来源感兴趣：
[http ://www.wordcount.org](http://www.wordcount.org)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T14:56:51.030

这个问题比编程更影响语言学，但是对于高度合成的语言（具有由多个组合词素组成的单词），尝试“编号”所有可能的单词可能是一个非常复杂的问题，而不是像这样的语言至少有些孤立的英语，或者像中文这样高度分析的语言。

也就是说，在某些语言中，单词可能不容易根据其组成字形进行分解和计数。

这篇关于[隔离语言](http://en.wikipedia.org/wiki/Isolating_language)的维基百科文章可能有助于解释这个问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-04T17:03:22.380

为自己发明一个很容易。将每个单词转换为规范的字节流（例如，小写分解的 UCS32），然后将其散列为整数。32 位可能就足够了，但如果不是，那么 64 位肯定会。

在你给你一个刻薄的答案之前，请考虑一下 Unicode 的目的只是为每个字形分配一个唯一的标识符。不是对它们进行排名、排序或分组，而只是将每一个映射到每个人都同意的唯一标识符上。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-06T11:30:39.307

他们是这个想法的几个主要问题。在大多数语言中，单词的含义以及与含义相关联的单词变化非常迅速。

在单词的含义发生变化之前，您将很快为一个单词分配一个数字。例如，“同性恋”这个词过去只表示“快乐”或“快乐”，但现在主要用于表示同性恋。另一个例子是语素“thank you”，它最初来自德语“danke”，只有一个词。另一个例子是“Good bye”，它是“God bless you”的缩写。

另一个问题是，即使在任何时间点对一个词进行快照，该词的含义和用法也会存在争议，即使在同一省内也是如此。在编写字典时，负责为一个单词争论的学者并不少见。

简而言之，您将无法使用现有语言来做到这一点。您将不得不考虑为此目的发明一种自己的语言，或者使用已经发明的相当静态的语言，例如国际语或世界语。然而，即使这些也不能完美地用于在标准词典中定义静态语素。

即使在中文中，字符到含义的映射很粗略，它仍然行不通。许多字符会根据上下文以及哪些字符在它们之前或后缀来改变它们的含义。

当您尝试在语言之间进行翻译时，问题最严重。英语中可能有一个词，可以在各种情况下使用，但不能直接用于另一种语言。这方面的一个例子是“免费”。在西班牙语中，可以使用“libre”（在语音中表示“免费”）或“gratis”（在啤酒中表示“免费”）（使用错误的词代替“free”看起来很有趣）。

还有一些词更难理解，比如韩语中的beautiful这个词；说一个女孩子漂亮，就会有好几个人选；但是当称食物美丽时，除非你的意思是食物好看，否则还有其他几个完全不同的候选人。

归根结底，尽管我们在英语中只使用了大约 20 万个单词，但我们的词汇量实际上在某些方面更大，因为我们为同一个单词分配了许多不同的含义。同样的问题也适用于世界语和国际语，以及对对话有意义的所有其他语言。人类语言不是一个定义明确的、润滑良好的机器。因此，尽管您可以创建这样一个词典，其中每个“单词”都有其独特的含义，但对于使用当前技术的机器将任何人类语言翻译成您的特殊标准化词典来说，这将是非常困难的，而且几乎是不可能的。

这就是为什么机器翻译仍然很糟糕，并且会持续很长一段时间。如果你能做得更好（我希望你能），那么你可能应该考虑用某种奖学金和/或大学/政府资助来做这件事，努力攻读博士学位；或者干脆赚一大笔钱，不管怎样让你的船保持蒸汽。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T17:11:16.047

系统将如何处理名词的复数或动词的变位？这些每个都有自己的“Unicode”值吗？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-04T17:25:55.970

作为一个翻译方案，如果没有更多的工作，这可能是行不通的。您想认为您可以为每个单词分配一个数字，然后将其机械地翻译成另一种语言。实际上，语言存在多个单词拼写相同的问题“风把她的头发吹回来”与“给你的手表上发条”。

对于传输文本，您可能每种语言都有一个字母表，它会很好地工作，尽管我想知道与使用可变长度字典（如 ZIP 使用）相比，您会在那里获得什么。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-06T13:19:27.230

这是一个有趣的问题，但我怀疑你是出于错误的原因问这个问题。您是否认为这种“词汇”Unicode 可以让您将句子分解为与语言无关的原子意义元素，然后能够用其他具体语言重新构建它们？作为实现通用翻译器的一种手段，也许？

即使您可以使用“lexical unicode”对一个英文句子进行编码和存储，也不能指望阅读它并神奇地将其翻译成中文，从而保持其含义不变。

但是，您对 Unicode 的类比非常有用。

请记住，Unicode 虽然是“通用”代码，但并不体现相关字符的发音、含义或用法。每个代码点指的是特定语言中的特定字形（或者更确切地说是一组语言使用的脚本）。它在字形的视觉表示级别（在样式、格式和字体的范围内）是基本的。拉丁字母“A”的 Unicode 代码点就是这样。它是拉丁字母“A”。它不能自动呈现为阿拉伯字母 Alif (ﺍ) 或印度语 (Devnagari) 字母 'A' (अ)。

保持 Unicode 类比，您的词汇 Unicode 将具有每种语言中每个单词（单词形式）的代码点。Unicode 具有特定脚本的代码点范围。您的词汇 Unicode 必须为每种语言提供一系列代码。不同语言中的不同单词，即使它们具有相同的含义（同义词），也必须具有不同的代码点。具有不同含义或不同发音（同音异义词）的同一个词必须具有不同的代码点。

在 Unicode 中，对于某些语言（但不是全部），同一字符根据其在单词中的位置而具有不同的形状 - 例如在希伯来语和阿拉伯语中，字形的形状在单词的末尾发生变化 - 然后它有不同的代码点。同样，在您的 Lexical Unicode 中，如果一个单词根据其在句子中的位置而具有不同的形式，则它可能需要自己的代码点。

想出英语语言代码点的最简单方法可能是将您的系统基于牛津英语词典的特定版本，并按顺序为每个单词分配一个唯一代码。您必须为同一个词的每个不同含义使用不同的代码，并且您必须为不同的形式使用不同的代码 - 例如，如果同一个词可以用作名词和动词，那么您将需要两个代码

然后，您必须对要包含的每种其他语言执行相同的操作 - 使用该语言最权威的词典。

很有可能，这种练习付出的努力多于它的价值。如果您决定包含世界上所有现存的语言，以及一些历史悠久的死语言和一些虚构的语言——就像 Unicode 所做的那样——你最终会得到一个非常大的代码空间，以至于你的代码必须非常宽才能容纳它。您不会在压缩方面获得任何收益 - 以原始语言表示为字符串的句子可能会比以代码表示的相同句子占用更少的空间。

PS对于那些说这是一项不可能完成的任务的人来说，因为词义发生了变化，我不认为这是一个问题。用 Unicode 类比，字母的用法已经发生了变化（诚然，没有单词的含义那么快），但 Unicode 并不关心在中世纪曾经像 'y' 一样发音的 'th'。Unicode 有一个 't'、'h' 和 'y' 的代码点，它们各自服务于它们的目的。

PPS 实际上，Unicode 有点担心 'oe' 也是 'œ' 或者 'ss' 可以用德语写成 'ß'

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-10T17:11:09.120

这是一个有趣的小练习，但我强烈建议您将其视为对自然语言类型和标记之间差异概念的介绍。

类型是代表所有实例的单词的单个实例。标记是单词每个实例的单个计数。让我用下面的例子来解释一下：

“约翰去了面包店。他买了面包。”

以下是此示例的一些频率计数，计数表示令牌的数量：

```
John: 1
went: 1
to: 1
the: 2
store: 1
he: 1
bought: 1
bread: 2 
```

请注意，“the”被计算了两次——“the”有两个标记。但是，请注意，虽然有十个词，但这些词频对中只有八个。单词被分解为类型并与其标记计数配对。

类型和标记在统计 NLP 中很有用。另一方面，我会注意“词法编码”。这是对 NLP 更老式方法的延续，预编程和理性主义比比皆是。我什至不知道任何实际为单词分配特定“地址”的统计 MT。单词之间有太多的关系，一方面，构建任何一种经过深思熟虑的数字本体，如果我们只是将数字扔给单词来对它们进行分类，我们应该考虑诸如内存管理和分配速度之类的事情.

我建议查看用 Python 编写的自然语言工具包 NLTK，以更广泛地介绍 NLP 及其实际用途。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-06T12:12:49.703

实际上，你只需要大约 600 个单词即可获得一半体面的词汇。

# c# - 如何将多个表读入数据集中？

> ID：170455
> 
> 赞同：4
> 
> 时间：2008-10-04T14:49:24.023
> 
> 标签：c#, ado.net, dataset

我有一个返回多个表的存储过程。如何执行和读取两个表？

我有这样的事情：

```
 SqlConnection conn = new SqlConnection(CONNECTION_STRING);
SqlCommand cmd = new SqlCommand("sp_mult_tables",conn);
cmd.CommandType = CommandType.StoredProcedure);

IDataReader rdr = cmd.ExecuteReader(); 

```

我不确定如何阅读它...处理此类查询的最佳方法是什么，我猜我应该将数据读入 DataSet？最好的方法是如何做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-04T14:53:46.870

改编自[MSDN](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldataadapter(VS.71).aspx)：

```
using (SqlConnection conn = new SqlConnection(connection))
{
    SqlDataAdapter adapter = new SqlDataAdapter();
    adapter.SelectCommand = new SqlCommand(query, conn);
    adapter.Fill(dataset);
    return dataset;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T14:51:05.063

如果要将结果读入 DataSet，最好使用 DataAdapter。

但是使用 DataReader，首先遍历第一个结果集，然后调用 NextResult 前进到第二个结果集。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T14:53:27.620

读者将按照返回的顺序处理结果集；处理完第一个结果集后，调用 rdr.NextResult() 设置下一个结果集

另请注意，表适配器将在填充时自动将所有结果集读入数据集中的表中，但数据表将无类型并命名为 Table1、Table2 等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T06:52:34.613

*** 读取所有 Excel 工作表名称并将多个工作表添加到单个数据集中，表名作为工作表名称。***

'全局变量

将 excelSheetNames 调暗为 String()

Dim DtSet As System.Data.DataSet = New DataSet()

Private Sub btnLoadData_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) 处理 btnLoadData.Click

将 MyConnection 调暗为 OleDbConnection

Dim da As System.Data.OleDb.OleDbDataAdapter

将 i 调暗为整数

MyConnection = 新 System.Data.OleDb.OleDbConnection("provider=Microsoft.Jet.OLEDB.4.0;

数据源=SStatus.xls;扩展属性=""Excel 8.0;HDR=NO;IMEX=1""")

'以下方法获取全局数组 excelSheetNames 中的所有 Excel 工作表名称

GetExcelSheetNames("SStatus.xls")

```
 For Each str As String In excelSheetNames
            da = New OleDbDataAdapter("select * from [" & str & "]", MyConnection)
            da.Fill(DtSet, excelSheetNames(i))
            i += 1
        Next           
        DataGridView1.DataSource = DtSet.Tables(0)          

End Sub 
```

公共函数 GetExcelSheetNames(ByVal excelFileName As String)

```
 Dim con As OleDbConnection = Nothing

    Dim dt As DataTable = Nothing

    Dim conStr As String = ("Provider=Microsoft.Jet.OLEDB.4.0;" & "Data Source=") + excelFileName & ";Extended Properties=Excel 8.0;"

    con = New OleDbConnection(conStr)
    con.Open()
    dt = con.GetOleDbSchemaTable(OleDbSchemaGuid.Tables, Nothing)
    excelSheetNames = New String(dt.Rows.Count - 1) {}
    Dim i As Integer = 0

    For Each row As DataRow In dt.Rows
        excelSheetNames(i) = row("TABLE_NAME").ToString()
        i += 1
    Next
End Function 
```

# concurrency - 应用程序对象和并发问题

> ID：170458
> 
> 赞同：2
> 
> 时间：2008-10-04T14:51:40.227
> 
> 标签：concurrency, asp-classic, locking

[在一些像这样](http://www.4guysfromrolla.com/webtech/050900-1.shtml)的asp 教程中，我观察到以下模式：

> 应用程序锁
> 
> '对应用程序对象做一些事情
> 
> 应用程序.解锁

但是，由于网页可以有多个实例，因此存在明显的并发问题。所以我的问题如下：

如果一个页面在对象已经被锁定时试图锁定怎么办？

有没有办法检测应用程序对象是否被锁定？

只在未锁定的应用程序对象上工作会更好还是会产生其他后果？

如果只有一个动作涉及应用程序对象怎么办？〜在这种情况下有理由锁定/解锁吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T16:39:58.277

从[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms525184.aspx)：

该`Lock`方法**阻止其他客户端**修改存储在应用程序对象中的变量，确保**一次只有一个客户端**可以更改或访问应用程序变量。

如果您**不显式调用**该方法，则服务器会在 .asp 文件**结束或超时**`Application.Unlock`时解锁锁定的 Application 对象。

 **应用程序对象上的锁定会持续很短的时间，因为当页面完成处理或超时时应用程序对象被解锁。

如果一个页面锁定了应用程序对象，而第二个页面尝试执行相同操作，而第一个页面仍处于锁定状态，则第二个页面将等待第一个页面完成，或者直到`Server.ScriptTimeout`达到限制。

一个例子：

```
<%@ Language="VBScript" %> 
<% 
   Application.Lock  
   Application("PageCalls") = Application("PageCalls") + 1  
   Application("LastCall") = Now()  
   Application.Unlock  
%>  

This page has been called <%= Application("PageCalls") %> times. 
```

在上面的示例中，该`Lock`方法**一次阻止多个客户端访问变量 PageCalls**。如果应用程序没有被锁定，两个客户端可以同时尝试增加变量 PageCalls。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T15:12:21.027

如果您使用解锁的应用程序对象会有后果。例如，如果您想实现一个全局计数器：-

```
Application("myCounter") = Application("myCounter") + 1 
```

上面的代码有时会算错。此代码读取、添加和分配。如果两个线程尝试同时执行此操作，它们可能会读取相同的值，然后写入相同的值，将 myCounter 递增 1 而不是 2。

需要的是确保第二个线程在第二个线程写入之前无法读取 myCounter。因此这是更好的： -

```
Application.Lock

Application("myCounter") = Application("myCounter") + 1

Application.Unlock 
```

当然，如果锁被持有很长时间，特别是如果应用程序有其他用途不受持有锁的代码影响，那么就会出现并发问题。

因此，您应该避免需要长时间锁定应用程序的设计。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T14:56:27.660

如果一个页面试图锁定已经锁定的 Application 对象，它将一直等到持有锁定的页面释放它。这通常会很快（ASP 代码通常应该只持有足够长的时间来访问存储在应用程序中的共享对象）。

# performance - 是否有经典 asp 的缓存脚本？

> ID：170465
> 
> 赞同：4
> 
> 时间：2008-10-04T14:54:13.717
> 
> 标签：performance, caching, asp-classic

PHP 有许多操作码缓存，据我了解，它们是处理应用程序缓存方面的脚本。经典asp有类似的东西吗，尤其是不需要组件安装的东西？

关于 IIS 缓存行为，从阅读[here](http://lb1.www.ms.akadns.net/technet/prodtechnol/WindowsServer2003/Library/IIS/a9171159-c801-4705-b8a9-9eecf58a892f.mspx?mfr=true)看来，该行为与某种预编译步骤有关，而不是与完成的页面有关。如果我错了，请纠正我

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T15:24:27.963

到目前为止，查看您对此处答案的评论以及对问题的编辑，您似乎对缓存感到有些困惑。

我们可以谈论两种类型的缓存。

*   操作码或模板缓存
*   输出缓存

**操作码或模板缓存**是在将纯文本文件的原始脚本文件转换为可由脚本引擎执行的内存操作码集时发生的缓存。PHP 有一些额外的工具，允许在随后请求脚本文件时重复使用这样的一组操作码。类似地，ASP 在内存和磁盘上保留一个“已编译”操作码的缓存，以便它可以为同一脚本的后续请求提供服务，而无需再次执行整个解析过程。

**输出缓存**是发送到响应缓冲区的脚本生成的输出被缓存的地方，以便对相同 URL（以及可能匹配其他标头）的后续请求根本不会重新运行脚本，而是重新发送先前缓存的输出.

ASP 没有输出缓存功能，而 ASP.NET 有。我对 PHP 或其正常平台不够熟悉，无法评论是否可以使用这样的工具。

您可以在 IIS 管理器 (IIS6) 中配置 ASP 的“操作码”缓存（称为模板缓存）打开网站节点上的属性窗口，转到主目录选项卡并单击配置...，然后选择缓存选项选项卡。默认情况下，500 个“编译”页面将缓存在内存中，2000 个将缓存在磁盘上。

在对此答案的原始版本的评论中，您似乎在询问由 IIS 托管的 PHP 是否也会从模板缓存中受益。这将取决于如何将 PHP 添加到平台中。

我对 PHP 几乎一无所知，但我想它只是另一个 dll，IIS 脚本映射将扩展名为 PHP 的文件映射到。在这种情况下，它不会从 ASP 模板缓存中受益。

以下可能是虚构的，但只是为了完善图片：-

另一个不太可能的可能性是，如果 PHP 以某种方式添加为 ASP 脚本语言。在这种情况下，带有 PHP 扩展名的文件将被映射到 ASP.DLL，并且文件将包含 <%@ language="PHP" 或应用程序配置中的默认语言将设置为 PHP。在这种不太可能的设置中，ASP 将构建一个将被缓存的模板，但是该模板是否包含“编译”操作码等取决于 PHP。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T16:28:03.810

这取决于您所说的“缓存”是什么意思。

在 IIS 6.0 中有模板缓存，如下[所述](http://lb1.www.ms.akadns.net/technet/prodtechnol/WindowsServer2003/Library/IIS/a9171159-c801-4705-b8a9-9eecf58a892f.mspx?mfr=true)（MS Windows 2003 TechCenter）：

*“ASP 处理包含 ASP 脚本的模板或模板文件。ASP 将这些模板存储在模板缓存中，然后为后续的客户端请求提供缓存的模板。缓存 ASP 模板增强了性能和可伸缩性，因为缓存的模板不会在每次被编译时都被编译。叫了。”*

您可以[在此处找到缓存的其他区别](http://www.asp101.com/articles/john/server_side_caching/index.asp)。

[这篇关于使用数据缓存提高 ASP 性能](http://authors.aspalliance.com/brettb/ASPDataCaching.asp)的文章介绍了一种简单的数据缓存机制：

*“不幸的是，经典 ASP 中没有内置缓存系统，但通过使用 Application 对象来存储数据很容易构建。因此，本文中描述的技术可用于为升级的旧网站带来有用的性能增强数据库或将代码移植到 ASP.NET 不是一个可行的选择。”*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T21:19:42.970

也许这个类可以帮助你缓存一些东西。

[http://www.webdevbros.net/2006/11/18/cache-object-for-classic-asp/](http://www.webdevbros.net/2006/11/18/cache-object-for-classic-asp/)

它不需要任何已安装的组件，并使用应用程序对象作为存储。因此，所有访问者都使用相同的缓存。您可以将它用于以下场景，例如：缓存繁重的 SQL 查询，...

# sql-server - 创建 SQL Server ODBC 数据源的最简单、最易于维护的方法是什么？

> ID：170466
> 
> 赞同：3
> 
> 时间：2008-10-04T14:54:13.950
> 
> 标签：sql-server, odbc, datasource, dsn

我需要一种创建 SQL Server ODBC 数据源的编程方式。我可以通过直接访问注册表来做到这一点。如果可以通过可用的（SQL Server/Windows）API 来防止注册表项或值因更新的 SQL Server 驱动程序而发生更改，那就更好了。

**接受的答案 注意：**使用 SQLConfigDataSource 从注册表项等详细信息中抽象代码，因此更加健壮。然而，我希望 SQL Server 会使用更高级别的函数来包装它，该函数采用强类型属性（而不是分隔字符串）并通过驱动程序公开它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-04T15:15:21.117

SQLConfigDataSource() 完成这项工作。

[MSDN 文章](http://msdn.microsoft.com/en-us/library/ck4z6wwt.aspx?ppud=4)

以防万一这是一个VB6示例：

```
Const ODBC_ADD_DSN = 1 'user data source
Const ODBC_ADD_SYS_DSN = 4 'system data source

Private Declare Function SQLConfigDataSource Lib "ODBCCP32.DLL" (ByVal
hwndParent As Long, ByVal fRequest As Long, ByVal lpszDriver As String, ByVal
lpszAttributes As String) As Long

strDriver = "SQL Server"
strAttributes = "DSN=Sample" & Chr$(0) _
& "Database=Northwind" & Chr$(0) _
& "Description= Sample Data Source" & Chr$(0) _
& "Server=(local)" & Chr$(0) _
& "Trusted_Connection=No" & Chr$(0)

SQLConfigDataSource(0, ODBC_ADD_SYS_DSN, strDriver, strAttributes) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T07:19:22.310

对于 VB.NET，可以这样做：

为“DLLImport”导入：

```
Imports System.Runtime.InteropServices 
```

SQLConfigDataSource 声明：

```
<DllImport("ODBCCP32.DLL")> Shared Function SQLConfigDataSource _
(ByVal hwndParent As Integer, ByVal fRequest As Integer, _
    ByVal lpszDriver As String, _
    ByVal lpszAttributes As String) As Boolean
End Function 
```

示例用法：

```
Const ODBC_ADD_DSN = 1 'User data source
Const ODBC_ADD_SYS_DSN = 4 'System data source

Public Function CreateSqlServerDataSource
    Dim strDriver As String : strDriver = "SQL Server"
    Dim strAttributes As String : strAttributes = _
        "DSN=Sample" & Chr(0) & _
        "Database=Northwind" & Chr(0) & _
        "Description= Sample Data Source" & Chr(0) & _
        "Server=(local)" & Chr(0) & _
        "Trusted_Connection=No" & Chr(0)

    SQLConfigDataSource(0, ODBC_ADD_SYS_DSN, strDriver, strAttributes)
End Function 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T15:08:14.530

我会使用位于您的 system32 文件夹中的 odbcad32.exe。

这会将您的 odbc 数据源添加到正确的位置，不会受到任何补丁的影响。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T15:13:04.177

要直接在注册表中执行此操作，您可以将字符串值添加到：

```
HKLM\SOFTWARE\Microsoft\ODBC\ODBC.INI\ODBC Data Sources 
```

添加系统 DSN，或：

```
HKCU\Software\ODBC\ODBC.INI\ODBC Data Sources 
```

添加用户 DSN。

值的名称是您要创建的数据源的名称，数据必须是“SQL Server”。

在与注册表中的“ODBC 数据源”相同的级别上，使用您要创建的数据源的名称创建一个键。

该键需要以下字符串值：

```
Database     - Name of default database to which to connect
Description  - A description of the Data Source
Driver       - C:\WINDOWS\system32\SQLSRV32.dll
LastUser     - Name of a database user (e.g. sa)
Server       - Hostname of machine on which database resides 
```

例如，使用命令行中的 reg.exe 应用程序添加名为“ExampleDSN”的用户数据源：

```
reg add "HKCU\Software\ODBC\ODBC.INI\ODBC Data Sources" 
    /v ExampleDSN /t REG_SZ /d "SQL Server"
reg add HKCU\Software\ODBC\ExampleDSN 
    /v Database /t REG_SZ /d ExampleDSN
reg add HKCU\Software\ODBC\ExampleDSN 
    /v Description /t REG_SZ /d "An Example Data Source"
reg add HKCU\Software\ODBC\ExampleDSN
    /v Driver /t REG_SZ /d "C:\WINDOWS\system32\SQLSRV32.DLL"
reg add HKCU\Software\ODBC\ExampleDSN
    /v LastUser /t REG_SZ /d sa
reg add HKCU\Software\ODBC\ExampleDSN
    /v Server /t REG_SZ /d localhost 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T23:17:07.863

使用 C# 的示例：

（详细的 SQL Server 参数参考[http://msdn.microsoft.com/en-us/library/aa177860.aspx](http://msdn.microsoft.com/en-us/library/aa177860.aspx)）

```
using System.Runtime.InteropServices; 

        private enum RequestFlags : int
        {

            ODBC_ADD_DSN = 1,
            ODBC_CONFIG_DSN = 2,
            ODBC_REMOVE_DSN = 3,
            ODBC_ADD_SYS_DSN = 4,
            ODBC_CONFIG_SYS_DSN = 5,
            ODBC_REMOVE_SYS_DSN = 6,
            ODBC_REMOVE_DEFAULT_DSN = 7

        }

        [DllImport("ODBCCP32.DLL", CharSet = CharSet.Unicode, SetLastError = true)]
        private static extern bool SQLConfigDataSource(UInt32 hwndParent, RequestFlags  fRequest, 
                                 string lpszDriver, string lpszAttributes);

        public static void CreateDSN()
        {

            string strDrivername = "SQL Server";
            string strConfig =  "DSN=StackOverflow\0" +
                                   "Database=Northwind\0" +
                                   "Description=StackOverflow Sample\0" +
                                   "Server=(local)\0" +
                                   "Trusted_Connection=No\0";

            bool success = SQLConfigDataSource(0, RequestFlags.ODBC_ADD_SYS_DSN, strDrivername, strConfig);

        } 
```

# c - makefiles - 一次编译所有 c 文件

> ID：170467
> 
> 赞同：61
> 
> 时间：2008-10-04T14:56:26.363
> 
> 标签：c, makefile

我想尝试 GCC 整个程序优化。为此，我必须一次将所有 C 文件传递​​给编译器前端。但是，我使用 makefile 来自动化我的构建过程，而且我不是 makefile 魔术方面的专家。

如果我想只使用一次对 GCC 的调用来编译（甚至可能是链接），我应该如何修改 makefile？

供参考 - 我的 makefile 如下所示：

```
LIBS  = -lkernel32 -luser32 -lgdi32 -lopengl32
CFLAGS = -Wall

OBJ = 64bitmath.o    \
      monotone.o     \
      node_sort.o    \
      planesweep.o   \
      triangulate.o  \
      prim_combine.o \
      welding.o      \
      test.o         \
      main.o

%.o : %.c
    gcc -c $(CFLAGS) $< -o $@

test: $(OBJ)
    gcc -o $@ $^ $(CFLAGS) $(LIBS) 
```

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-10-04T15:00:58.617

```
LIBS  = -lkernel32 -luser32 -lgdi32 -lopengl32
CFLAGS = -Wall

# Should be equivalent to your list of C files, if you don't build selectively
SRC=$(wildcard *.c)

test: $(SRC)
    gcc -o $@ $^ $(CFLAGS) $(LIBS) 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2010-11-02T03:47:52.503

```
SRCS=$(wildcard *.c)

OBJS=$(SRCS:.c=.o)

all: $(OBJS) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-02-03T13:15:49.400

您需要去掉后缀规则 (%.o: %.c) 以支持大爆炸规则。像这样的东西：

```
LIBS  = -lkernel32 -luser32 -lgdi32 -lopengl32
CFLAGS = -Wall

OBJ = 64bitmath.o    \
      monotone.o     \
      node_sort.o    \
      planesweep.o   \
      triangulate.o  \
      prim_combine.o \
      welding.o      \
      test.o         \
      main.o

SRCS = $(OBJ:%.o=%.c)

test: $(SRCS)
    gcc -o $@  $(CFLAGS) $(LIBS) $(SRCS) 
```

如果您要试验 GCC 的整个程序优化，请确保在上面的 CFLAGS 中添加适当的标志。

在阅读这些标志的文档时，我也看到了有关链接时间优化的注释；你也应该调查这些。

# php - HTML 数据经过十六进制处理后超出字段长度

> ID：170479
> 
> 赞同：1
> 
> 时间：2008-10-04T15:07:19.493
> 
> 标签：php, html, validation

问题是您无法告诉用户该字段中允许有多少个字符，因为转义值比未转义值具有更多字符。

我看到了一些解决方案，但没有一个看起来很好：

*   每个字段一个白名单*（工作量太大，并不能完全解决问题）*
*   每个字段一个黑名单*（同上）*
*   使用即使所有字符都被转义*（坏）也可以保存数据的字段长度*
*   取消数据库字段的大小上限*（更糟）*
*   保存十六进制未转义的数据并将责任完全传递给输出过滤*（不是很好）*
*   让用户猜测最大尺寸*（最差）*

还有其他选择吗？这种情况是否有“最佳实践”？

示例代码：

```
$string = 'javascript:alert("hello!");';
echo strlen($string);
// outputs 27
$escaped_string = filter_var('javascript:alert("hello!");', FILTER_SANITIZE_ENCODED);
echo strlen($escaped_string);
// outputs 41 
```

如果数据库字段的长度是 40，则转义数据将不适合。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-04T15:50:51.450

不要围绕数据库构建应用程序 - 为应用程序构建数据库！

首先设计您希望界面如何为用户工作，计算出可接受的最长字段长度，然后使用它。

一般来说，在存储到数据库之前不要转义 - 将原始数据存储在数据库中并格式化以供显示。如果要输出多次，则存储处理后的版本。

请记住，磁盘空间相对便宜——不要浪费精力尝试使您的数据库紧凑。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T15:19:29.437

对这里的上下文做出一些疯狂的假设：

*   如果该字段可以容纳 32 个字符，即 32 个未转义字符
*   让用户输入 32 个字符
*   escape/unescape 不是用户的问题
*   为什么这是一个问题？
    *   如果这是表单数据输入，则无关紧要，并且
    *   如果您出于某种原因转义数据并将其传回，则在存储之前将其转义

没有进一步的上下文，看起来您正在解决一个实际上并不存在或不需要存在的问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T15:25:07.960

这是一个有趣的问题。

我认为如果您因为消毒而将任何责任分配给他们，那么解决方案将是一个问题。如果他们负责猜测最大长度，那么他们很可能会放弃并选择其他东西（并且不明白为什么他们的输入无效）。

这是我的想法：将数据库字段设置为输入大小的 150%。这个额外的大小用作十六进制清理空间的“填充”，向用户和验证器显示的最大大小是实际所需的大小。因此，如果您在清理之前检查输入长度，并且它低于 66% 的长度限制，那么您的清理数据*应该*是好的。如果它们超过缓冲区的额外 34% 字段空间，那么输入可能不应该被接受。

唯一的麻烦是您的数据库表会更大。如果您想避免这种情况，那么您总是可以只转义 SQL 敏感字符并处理输出中的所有其他内容。

**编辑：**鉴于你的例子，我认为你逃避太多了。要么对输出使用较小范围的清理`HTMLSpecialChars()`，要么使您的数据库字段达到其当前大小的 200%。如果你问我，那就太臃肿了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T15:25:09.287

*   为什么允许用户输入转义字符？
*   如果您确实需要允许显式转义字符，则在检查转义字符*之前插入转义字符*

如果它仍然以某种方式被编码，你几乎**不应该对任何字符串做任何重要的工作。**先解码，*然后*做你的工作。

我发现有些人倾向于`addSlashes()`过早使用转义函数（或 PHP 中的任何函数），或者太晚解码内容（如删除 HTML 实体）。*首先*解码，做你的事情，*然后*应用你需要存储/输出/等的任何编码。

# asp.net - 内存不足 - 无限循环 - ASP.NET AJAX 框架

> ID：170483
> 
> 赞同：5
> 
> 时间：2008-10-04T15:11:31.013
> 
> 标签：asp.net, asp.net-ajax

我们在 .NET 3.5 SP1 上运行。

最近，在 IE 中，我们的一些用户开始偶尔出现“内存不足”错误。这不会一直发生。我设法复制了几次，我发现来自 AjaxControlToolkit.Common.Common.js 文件的这段代码导致了无限循环：AjaxControlToolkit.TextBoxWrapper.registerClass('AjaxControlToolkit.TextBoxWrapper', Sys.UI.Behavior) ;AjaxControlToolkit.TextBoxWrapper.validatorGetValue = function(id) { var control = $get(id);if (control && control.AjaxControlToolkitTextBoxWrapper) { return control.AjaxControlToolkitTextBoxWrapper.get_Value();} return AjaxControlToolkit.TextBoxWrapper._originalValidatorGetValue(id); }

最后一行（调用_originalValidatorGetValue）基本上一遍又一遍地回调这个确切的函数，因为control.AjaxControlToolkitTextBoxWrapper 是未定义的。

在它上面定义的函数是 AjaxControlToolkit.TextBoxWrapper.get_Wrapper(control)，如果它不存在，可以用来创建包装器，但我不觉得我想改变框架，如果我是只有在野外见过这种虫子的人。

该错误并不总是发生。当加载的第一个 URL 包含 AJAX 历史记录点时，似乎会发生这种情况。如果您打开一个页面并使用它，导致添加历史记录点，它可以正常工作。但是如果你将 URL 复制粘贴到另一个浏览器窗口中，你就会遇到这个问题。

因此，我的猜测是我对没有正确设置包装器的历史控制做错了。即便如此，那里似乎有一个无限循环。

有什么想法/线索吗？

我在 Microsoft Connect 上填写了错误报告。在填写并测试各种场景时，我注意到它在本地运行良好，但在远程运行不佳。比较我的生产/开发环境，我注意到 CombineScripts 在本地是错误的。将其部署到我的生产服务器似乎已经解决了这个问题。

[https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=373171](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=373171)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-09-03T09:41:21.810

如果你从 ScriptManager 中删除 LoadScriptsBeforeUI='false'，这个问题就解决了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T16:15:28.217

您可能希望在[Microsoft Connect](http://connect.microsoft.com/feedback/default.aspx?SiteID=210)上发布错误报告。

# sql - MySQL 中的 OR 非空约束

> ID：170492
> 
> 赞同：12
> 
> 时间：2008-10-04T15:14:28.653
> 
> 标签：sql, mysql, null

在 MySQL 中创建非 NULL 约束以使 fieldA 和 fieldB 不能都为 NULL 的最佳方法是什么。我不在乎任何一个本身是否为 NULL，只要另一个字段具有非 NULL 值即可。如果它们都具有非 NULL 值，那就更好了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-05T00:12:41.577

这不是直接回答您的问题，而是一些附加信息。

在处理多个列并检查是否全部为空或一个不为空时，我通常使用`COALESCE()`- 如果列表增长，它会简短、易读且易于维护：

```
COALESCE(a, b, c, d) IS NULL -- True if all are NULL

COALESCE(a, b, c, d) IS NOT NULL -- True if any one is not null 
```

这可以在您的触发器中使用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-04T17:35:47.277

@Sklivvz：使用 MySQL 5.0.51a 进行测试，我发现它解析了 CHECK 约束，但没有强制执行。我可以插入 (NULL, NULL) 而没有错误。测试了 MyISAM 和 InnoDB。随后使用 SHOW CREATE TABLE 表明 CHECK 约束不在表定义中，即使我在定义表时没有给出错误。

这与[MySQL 手册](http://dev.mysql.com/doc/refman/5.0/en/create-table.html)相匹配：“CHECK 子句已解析，但被所有存储引擎忽略。”

因此对于 MySQL，您必须使用触发器来强制执行此规则。唯一的问题是 MySQL 触发器无法引发错误或中止 INSERT 操作。您可以在触发器中导致错误的一件事是将 NOT NULL 列设置为 NULL。

```
CREATE TABLE foo (
  FieldA INT,
  FieldB INT,
  FieldA_or_FieldB TINYINT NOT NULL;
);

DELIMITER //
CREATE TRIGGER FieldABNotNull BEFORE INSERT ON foo
FOR EACH ROW BEGIN
  IF (NEW.FieldA IS NULL AND NEW.FieldB IS NULL) THEN
    SET NEW.FieldA_or_FieldB = NULL;
  ELSE
    SET NEW.FieldA_or_FieldB = 1;
  END IF;
END//

INSERT INTO foo (FieldA, FieldB) VALUES (NULL, 10); -- OK
INSERT INTO foo (FieldA, FieldB) VALUES (10, NULL); -- OK
INSERT INTO foo (FieldA, FieldB) VALUES (NULL, NULL); -- gives error 
```

您还需要一个类似的触发器 BEFORE UPDATE。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-02-27T22:39:29.470

MySQL 5.5 引入了[SIGNAL](http://dev.mysql.com/doc/refman/5.5/en/signal.html)，因此我们不再需要 Bill Karwin 答案中的额外列。Bill 指出您还需要一个更新触发器，所以我也将其包括在内。

```
CREATE TABLE foo (
  FieldA INT,
  FieldB INT
);

DELIMITER //
CREATE TRIGGER InsertFieldABNotNull BEFORE INSERT ON foo
FOR EACH ROW BEGIN
  IF (NEW.FieldA IS NULL AND NEW.FieldB IS NULL) THEN
    SIGNAL SQLSTATE '45000'
    SET MESSAGE_TEXT = '\'FieldA\' and \'FieldB\' cannot both be null';
  END IF;
END//
CREATE TRIGGER UpdateFieldABNotNull BEFORE UPDATE ON foo
FOR EACH ROW BEGIN
  IF (NEW.FieldA IS NULL AND NEW.FieldB IS NULL) THEN
    SIGNAL SQLSTATE '45000'
    SET MESSAGE_TEXT = '\'FieldA\' and \'FieldB\' cannot both be null';
  END IF;
END//
DELIMITER ;

INSERT INTO foo (FieldA, FieldB) VALUES (NULL, 10); -- OK
INSERT INTO foo (FieldA, FieldB) VALUES (10, NULL); -- OK
INSERT INTO foo (FieldA, FieldB) VALUES (NULL, NULL); -- gives error
UPDATE foo SET FieldA = NULL; -- gives error 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-04T15:38:51.880

这是此类约束的标准语法，但 MySQL 之后很高兴地忽略了该约束

```
ALTER TABLE `generic` 
ADD CONSTRAINT myConstraint 
CHECK (
  `FieldA` IS NOT NULL OR 
  `FieldB` IS NOT NULL
) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-04T15:31:24.453

我在 SQL Server 中做过类似的事情，我不确定它是否可以直接在 MySQL 中工作，但是：

```
ALTER TABLE tableName ADD CONSTRAINT constraintName CHECK ( (fieldA IS NOT NULL) OR (fieldB IS NOT NULL) ); 
```

至少我相信这是语法。

但是，请记住，您不能跨表创建检查约束，您只能检查一个表中的列。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-12-21T15:14:32.477

我使用带有**COALESCE ... NOT NULL的****GENERATED ALWAYS**列来完成此操作：

 **```
DROP TABLE IF EXISTS `error`;

CREATE TABLE IF NOT EXISTS `error` (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    left_id BIGINT UNSIGNED NULL,
    right_id BIGINT UNSIGNED NULL,
    left_or_right_id BIGINT UNSIGNED GENERATED ALWAYS AS (COALESCE(left_id, right_id)) NOT NULL,
    when_occurred TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    message_text LONGTEXT NOT NULL,
    INDEX id_index (id),
    INDEX when_occurred_index (when_occurred),
    INDEX left_id_index (left_id),
    INDEX right_id_index (right_id)
);

INSERT INTO `error` (left_id, right_id, message_text) VALUES (1, 1, 'Some random text.');  -- Ok.
INSERT INTO `error` (left_id, right_id, message_text) VALUES (null, 1, 'Some random text.'); -- Ok.
INSERT INTO `error` (left_id, right_id, message_text) VALUES (1, null, 'Some random text.'); -- Ok.
INSERT INTO `error` (left_id, right_id, message_text) VALUES (null, null, 'Some random text.'); -- ER_BAD_NULL_ERROR: Column 'left_or_right_id' cannot be null 
```

在 MySQL 版本 8.0.22 上

# orm - 实现关系代数的语言特性

> ID：170500
> 
> 赞同：9
> 
> 时间：2008-10-04T15:20:46.783
> 
> 标签：orm, scala, dsl, type-systems, database-relations

我一直在尝试在 Scala 中编码一个关系代数（据我所知，它是最先进的类型系统之一），但似乎没有找到一种方法来达到我想要的位置。

由于我对编程语言设计的学术领域没有那么丰富的经验，所以我真的不知道要寻找什么功能。

那么，实现静态验证的关系代数需要哪些语言特性，哪些语言具有这些特性呢？

一些要求： 元组是一个函数，将名称从一组静态定义的元组有效名称映射到名称指定类型的值。让我们将此名称类型称为设置域。

关系是一组具有相同域的元组，因此任何元组的范围在集合中都是唯一的

到目前为止，模型可以很容易地在 Scala 中建模

```
trait Tuple
trait Relation[T<Tuple] extends Set[T] 
```

Tuple 中的 vals、vars 和 defs 是上面定义的名称类型集。但是元组中不应该有两个同名的定义。vars 和 impure defs 也应该受到限制。

现在是棘手的部分：

两个关系的连接是一种关系，其中元组的域是来自操作数元组的域的并集。这样只保留它们域的交集具有相同范围的元组。

```
def join(r1:Relation[T1],r2:Relation[T2]):Relation[T1 with T2] 
```

应该做的伎俩。

关系的投影是一个关系，其中元组的域是操作数元组域的子集。

```
def project[T2](r:Relation[T],?1):Relation[T2>:T] 
```

这是我不确定是否有可能找到解决方案的地方。你怎么看？定义项目需要哪些语言特性？

上面暗示的是 API 必须是可用的。层层叠叠的样板是不可接受的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T17:04:32.190

What your asking for is to be able to structurally define a type as the *difference* of two other types (the original relation and the projection definition). I honestly can't think of any language which would allow you to do that. Types can be structurally cumulative (`A with B`) since `A with B` is a structural sub-type of both `A` and `B`. However, if you think about it, a type operation `A less B` would actually be a *supertype* of `A`, rather than a sub-type. You're asking for an arbitrary, contravariant typing relation on naturally covariant types. It hasn't even been proven that sort of thing is sound with nominal existential types, much less structural declaration-point types.

I've worked on this sort of modeling before, and the route I took was to constraint projections to one of three domains: `P` == `T`, `P` == `{F} where F in T`, `P` == `{$_1} where $_1 anonymous`. The first is where the projection is equivalent to the input type, meaning it is a no-op (`SELECT *`). The second is saying that the projection is a single field contained within the input type. The third is the tricky one. It is saying that you are allowing the declaration of some anonymous type `$_1` which has no *static* relationship to the input type. Presumably it will consist of fields which delegate to the input type, but we can't enforce that. This is roughly the strategy that LINQ takes.

Sorry I couldn't be more helpful. I wish it were possible to do what you're asking, it would open up a lot of very neat possibilities.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T21:42:46.980

我想我已经决定只使用正常的设施来收集项目部分的地图。客户端只需指定一个功能`[T<:Tuple](t:T) => P`

使用一些java技巧来获取PI类应该能够使用反射来实现查询逻辑。

对于连接，我可能会使用 DynamicProxy 来实现映射功能。

作为奖励，我也许可以让 API 与 Scalas 特殊的 for 语法一起使用。

# expert-system - 框架专家系统

> ID：170529
> 
> 赞同：1
> 
> 时间：2008-10-04T15:33:59.800
> 
> 标签：expert-system

编写一个简单的基于框架的专家系统的最佳方法是什么，该系统确定对象是否与某个组相关？这是大学智能系统课程的一种实验室工作。或者是否有任何开源项目来研究它的实现？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T16:29:55.583

我们使用了[LPA 的 Flex](http://www.lpa.co.uk/flx.htm)，它是一个位于 win-prolog 之上的工具包。它确实基于框架的专家系统，并且他们有一个教育计划。

# sql - 重置@@FETCH_STATUS 存储过程

> ID：170536
> 
> 赞同：0
> 
> 时间：2008-10-04T15:40:56.947
> 
> 标签：sql, sql-server, stored-procedures, sql-server-2005, database-cursor

如何`@@FETCH_STATUS`在存储过程中重置变量或将其设置为 0？

此外，您可以将 FETCH_STATUS 绑定到特定游标吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2014-06-05T05:43:40.600

我能够重现[`@@FETCH_STATUS`](http://msdn.microsoft.com/en-us/library/ms187308.aspx)您描述的问题，这是一次您`DECLARE`a`CURSOR`并通过调用`FETCH NEXT`直到您的`@@FETCH_STATUS = -1`.
然后，即使您`CLOSE`和`DEALLOCATE`您的光标，如果您将其`CURSOR`回调`@@FETCH_STATUS = -1`，并且如果您基于 的循环条件`@@FETCH_STATUS <> -1`，您的循环也永远不会执行。

我的解决方案是基本上告诉`CURSOR`返回到`FIRST`，将`@@FETCH_STATUS`返回更改为`0`，然后退出。请注意，当您声明它时，必须通过在名称后`CURSOR`添加关键字来启用滚动。`SCROLL``CURSOR`

这是一个例子。我使用了 orderitems（人们下订单的项目）表中的三列来创建我的光标：

```
USE transact_Sales;

GO

DECLARE @isOrderNumber INT;
DECLARE @isOrderTotal MONEY;
DECLARE test SCROLL CURSOR
FOR
SELECT Oi.order_num, SUM(Oi.quantity@item_price) FROM orderitems AS Oi GROUP BY order_num;

OPEN test;

WHILE @@FETCH_STATUS = 0
BEGIN 
FETCH NEXT FROM test INTO @isOrderNumber, @isOrderTotal
PRINT CAST(@isOrderNumber AS VARCHAR(20)) + ' '
     +CAST(@isOrderTotal AS VARCHAR(20)) + ' '
     +CAST(@@FETCH_STATUS AS VARCHAR(5))
END
FETCH FIRST FROM test INTO @isOrderNumber, @isOrderTotal

CLOSE test;
DEALLOCATE test; 
```

这些是结果：

```
20005 149.87 0  
20006 55.00 0  
20007 1000.00 0  
20008 125.00 0  
20009 38.47 0  
20009 38.47 -1 
```

光标可以反复运行，每次都会产生相同的结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T15:44:59.153

您可以通过读取不在表格末尾的游标来重置它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-14T03:42:26.327

您需要关闭游标，然后再次打开游标。

```
DECLARE @IDs int
DECLARE MyCursor CURSOR FOR(SELECT ID FROM Table)
OPEN MyCursor
FETCH NEXT FROM MyCursor INTO @IDs
WHILE @@FETCH_STATUS=0
BEGIN
    --Do your work(First loop)
FETCH NEXT FROM MyCursor INTO @IDs
END
CLOSE MyCursor
--Run the cursor again
OPEN MyCursor
FETCH NEXT FROM MyCursorINTO @IDs
WHILE @@FETCH_STATUS=0
BEGIN
    --Other work (Second loop)
    FETCH NEXT FROM MyCursor INTO @IDs
END
CLOSE MyCursor
DEALLOCATE MyCursor 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-15T18:44:41.960

我知道一个旧线程，但在其他地方找到的对我有用的答案是：

```
WHILE (1 = 1) 
BEGIN
    FETCH NEXT FROM mycursor INTO @somevar
    IF (@@FETCH_STATUS <> 0) BREAK
    -- do stuff here
END 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T16:04:31.563

你不能：

> @@FETCH_STATUS (Transact-SQL)
> 
> 返回针对连接当前打开的**任何游标发出****的最后一个游标**FETCH 语句的状态。

 **所以基本上它没有绑定到任何游标。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T22:40:01.293

通常，您在 FETCH 之后*立即*有一个 @@FETCH_STATUS ，那么您为什么要重置它呢？

如果您不立即评估，请尝试将其结果存储在临时变量中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-16T17:57:16.373

我认为需要重置光标。我正在使用游标进行一些测试，并且我一直返回 @@fetch_status = -1，即使在我编写了关闭和释放到我正在测试的游标的代码之后。

发生的事情是我在逻辑测试后在另一个过程中打开了一个全局游标，并且在遍历它之后从未关闭过该游标。

所以 Fetch 看到了那个游标的@@Fetch_status。

关闭你的游标，释放你的游标。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-10-11T14:22:43.720

如果你想打破光标你可以使用[BREAK](http://msdn.microsoft.com/en-us/library/ms181271.aspx)
但这只是将函数从 0 替换为 1。

```
fetch next
While @@fetch_Status = 0
begin

if (my condition)
 break
fetch next ;

end 
```

# java - Java：将对象保存在文本文件中？有现成的解决方案吗？

> ID：170554
> 
> 赞同：7
> 
> 时间：2008-10-04T15:56:09.257
> 
> 标签：java, object, store, flat-file

我想保存我在程序中生成的对象。重新启动后，应用程序应自动加载数组中的所有对象。我想将它们写入文件并在重新启动后解析它们。还有其他比手工更聪明的可能性吗？谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-04T15:58:20.280

是的，您正在寻找的概念称为序列化。[Sun这里](http://java.sun.com/developer/technicalArticles/Programming/serialization/)有一个很好的教程。

这个想法是你想要持久化的类必须实现 Serializable 接口。之后，您使用 java.io.ObjectOutputStream.writeObject() 将对象写入文件并使用 java.io.ObjectInputStream.readObject() 将其读回。

你不能序列化所有东西，因为有些东西序列化没有意义，但你可以解决它们。这是一个引用：

> Java序列化的基本机制使用起来很简单，但是还有一些东西需要了解。如前所述，只有标记为 Serializable 的对象才能被持久化。java.lang.Object 类不实现该接口。因此，并非Java中的所有对象都可以自动持久化。好消息是它们中的大多数——比如 AWT 和 Swing GUI 组件、字符串和数组——都是可序列化的。
> 
> 另一方面，某些系统级类，如 Thread、OutputStream 及其子类和 Socket 是不可序列化的。确实，如果它们是，那将没有任何意义。例如，在我的 JVM 中运行的线程将使用我系统的内存。坚持它并试图在你的 JVM 中运行它根本没有意义。关于 java.lang.Object 未实现 Serializable 接口的另一个重要点是，您创建的任何仅扩展 Object（而没有其他可序列化类）的类都是不可序列化的，除非您自己实现该接口（如前面的示例所做的那样）。
> 
> 这种情况提出了一个问题：如果我们有一个包含 Thread 实例的类怎么办？在那种情况下，我们可以持久化这种类型的对象吗？答案是肯定的，只要我们通过将我们类的 Thread 对象标记为瞬态来告诉序列化机制我们的意图。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T17:13:34.980

您可以使用*Berkeley DB* `PersistentMap`类将 ( `Serializable`) 对象保存在`Map`实现（缓存）中，该实现（缓存）将它们保存到文件中。它使用起来非常简单，意味着您不必担心将什么保存在哪里。

序列化需要注意的三点：

1.  您将如何应对架构更改（即更改您的类所包含的数据 - 例如添加一个新字段）
2.  如果您的文件损坏了怎么办？取决于您的程序存储需要的可靠性，这将影响您对如何保存对象隐含包含的数据的决定。请记住，您始终可以使用**MySQL**等关系数据库，然后将这些数据转换为您的对象
3.  您是否需要能够查看或查询程序*之外*的数据？如果您想回答一些简单的问题，例如“有多少对象具有属性 X？”，该怎么办？如果您使用过（关系）数据库，则很容易做到；如果您已将内容序列化为文件，那就不那么容易了！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T17:13:25.027

您可能想查看 Effective Java 了解有关序列化的一些问题。这些通常是高级的，但如果此功能是您应用的核心部分，您需要提前了解它们。

示例包括安全问题、继承，以及最重要的是公开“冻结”API 并实现它的潜力（例如，跨软件版本）。同样，这些都是先进的，不应该阻止你本身。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T18:14:30.863

java.io.Object[Input/Output]Stream 是您需要查看的两个类。
您希望保存到文件的任何类都需要实现 java.io.Serializable 接口。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-06T03:29:55.703

您可能还想考虑使用 XML 编码，在我看来，这似乎比序列化更持久。使用`java.beans.XMLEncoder/XMLDecoder`类。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-06T15:16:35.340

我没用过，但谷歌代码最近发布了[protobuf 。](http://code.google.com/p/protobuf/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-24T20:57:05.050

我同意 mjlee 的观点，即[来自 Google 的 Protocol Buffers](http://code.google.com/apis/protocolbuffers/docs/overview.html)是一种比原始序列化方式更好的存储对象方式。看看，你会喜欢的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-12-13T23:54:38.443

我想知道为什么没有人提到[JSON](http://en.wikipedia.org/wiki/JSON)，例如[Jackson JSON 序列化](http://wiki.fasterxml.com/JacksonInFiveMinutes)器。

# database - 使用临时备份表时保持一致性

> ID：170556
> 
> 赞同：1
> 
> 时间：2008-10-04T15:57:00.440
> 
> 标签：database

这与接受的答案有关[What's your #1 way to be care with a live database](https://stackoverflow.com/questions/168486/whats-your-1-way-to-be-careful-with-a-live-database)？

假设您为备份目的创建了一个临时表并在原始表中进行了更改。这些更改破坏了系统，您想要恢复备份。与此同时，原始表中的一些其他记录也发生了变化（它是一个实时数据库）。现在如果您恢复备份，系统将处于不一致的状态。

解决这个问题的最佳方法是什么

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T16:12:49.190

我不认为这是可取的，在将表投入生产之前我会更加努力地测试，但假设它无论如何都会发生，你有两个选择：

1.- 创建一个 ON INSERT 触发器，它使用插入到新表中的行更新临时备份表，按摩数据以适应旧表

或者

2.- 像这样找出数据中的差异

```
SELECT * FROM faultyTable 
EXCEPT 
SELECT * FROM backupTable 
```

当然，您必须将要选择的列调整为公共子集。EXCEPT 有时也被称为 MINUS。

之后，您可以将差异插入备份表并恢复组合。表的关系越多，这就越难……根据用于恢复表的方式，您可能会删除相关数据，因此您也必须选择它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T16:20:44.213

我通常会

```
BEGIN TRANSACTION

-- SQL CODE 
```

最后，如果一切正常，请执行我的 SELECT 之类的操作

```
COMMIT 
```

除此以外

```
ROLLBACK 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-06T08:13:00.967

您的数据库可能会提供此功能。例如在 Oracle 中：

```
Export (Your options) consistent = y 
```

当然，在生产在线环境中进行一致备份会对系统造成性能损失。

# python - 大多数库何时兼容 Python 3？

> ID：170563
> 
> 赞同：13
> 
> 时间：2008-10-04T16:00:05.143
> 
> 标签：python, python-3.x

有谁知道“几乎所有”广泛使用的 Python 库与 Python 3.0 一起使用需要多长时间？

我打算在 2.X 上停留一段时间，因为我不想开始移植东西，然后发现我已经依赖的某些库或我可能开始使用的新库不适用于 py3k。

我的理解是，py3k beta 过程是专门为给图书馆开发人员时间来转移他们的东西而制定的。这一直在发生吗？

我正在谈论的各种库的示例是 PIL、numpy/scipy、SQLAlchemy、BeautifulSoup、CherryPy...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-04T16:32:40.493

您列出的示例可能会很快被移植，因为它们被广泛使用。

如果 BeautifulSoup 需要一个多月的时间，我会感到惊讶（事实上，我很惊讶它还没有使用 py3k 测试版进行移植），像 numpy 这样更复杂的东西可能需要更长的时间，特别是因为 2to3 仅适用于 python源代码，而不是 C 模块..

很难一概而论——有些模块可能永远不会被移植，有些可能需要几天时间，有些可能需要几年时间。最终可能会出现以下情况：“我没有将我的库移植到 Python3，没有人在使用它！”/“我没有将我的项目移植到 Python3，还没有更新任何库！ ”，但我希望不会！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T17:37:45.603

实际上，对您的问题的回答取决于许多不同的人（Python std lib 之外的所有库的维护者）的行为，我认为没有人可以为您的问题提供*可靠*的答案。

也就是说，你已经有了一些答案，而且你会得到更多。不过，我们同意一件事：根据经验，我通常建议不要立即将重要项目（主要与工作相关）移植到新的开发技术（Python 3、.Net 3.x 等），直到这样您的答案已经得到解答，并且许多最初的错误已得到解决。

不过，对于宠物或测试项目，我全力以赴进行更新和试验。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T17:20:24.670

Some comments I saw in the CherryPy repository is that some of the changes to the sockets module are going to require an extensive reworking of the logic. I expect CherryPy will be slower than some of the other projects to get ported to 3.0.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-05T14:02:10.060

迁移计划中的总体思路是停留在 2.x 上，然后慢慢将代码更改为 3.x。你**至少有**1.5 年的时间来担心它。当然还有先有鸡还是先有蛋的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-02T12:48:58.683

我记得 Adrian（django 的 BFDL）说 Guido 给了他们 5 年的移植时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-02T16:42:57.287

一旦有人花一些时间进行移植，您提到的库就会被移植。

在 NumPy/SciPy 的特定情况下，大部分代码是作为 C 扩展编写的。没有用于 C 扩展的 2to3 工具，因此将代码移植到 cPython3 C 扩展需要使用的格式需要大量的工时。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-05-31T15:03:41.063

截至 2013 年 5 月 1 日，您提到的所有库现在都支持 Python 3：

*   PIL，作为[一个名为 Pillow 的分支](https://pypi.python.org/pypi/Pillow/2.0.0)（最初的 PIL 项目自 2009 年以来未更新）
*   [NumPy 和 SciPy](https://pypi.python.org/pypi/scipy)
*   [SQL炼金术](http://docs.sqlalchemy.org/en/rel_0_8/intro.html#supported-platforms)
*   [美丽汤](https://pypi.python.org/pypi/beautifulsoup4)
*   [樱桃派](https://bitbucket.org/cherrypy/cherrypy/issue/773/make-a-python-3000-version-of-cp)

移植工作一直在逐步进行；最近移植了一些主要的库，例如 Django。

# ms-access - 操作必须使用可更新查询。（错误 3073）Microsoft Access

> ID：170578
> 
> 赞同：23
> 
> 时间：2008-10-04T16:08:05.440
> 
> 标签：ms-access

在某些 Microsoft Access 查询中，我收到以下消息：操作必须使用可更新查询。（错误 3073）。我通过使用临时表来解决它，但我想知道是否有更好的方法。所有涉及的表都有一个主键。这是代码：

```
UPDATE CLOG SET CLOG.NEXTDUE = (
    SELECT H1.paidthru 
    FROM CTRHIST as H1
    WHERE H1.ACCT = clog.ACCT AND
    H1.SEQNO = (
        SELECT MAX(SEQNO) 
        FROM CTRHIST 
        WHERE CTRHIST.ACCT = Clog.ACCT AND 
        CTRHIST.AMTPAID > 0 AND
        CTRHIST.DATEPAID < CLOG.UPDATED_ON
    )
)
WHERE CLOG.NEXTDUE IS NULL; 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-04T21:12:12.813

从 Jet 4 开始，所有与汇总数据的 SQL 语句有连接的查询都将不可更新。您没有使用 JOIN，但 WHERE 子句完全等同于连接，因此 Jet 查询优化器以与处理连接相同的方式处理它。

如果没有临时表，恐怕你会很不走运，尽管也许有人比我有更多的 Jet SQL 知识，但我能想出一个解决方法。

顺便说一句，它可能在 Jet 3.5 (Access 97) 中是可更新的，因为大量查询是可更新的，然后在升级到 Jet 4 时变得不可更新。

--

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-05-10T00:07:39.740

我有一个类似的问题，以下查询不起作用；

```
update tbl_Lot_Valuation_Details as LVD
set LVD.LGAName = (select LGA.LGA_NAME from tbl_Prop_LGA as LGA where LGA.LGA_CODE = LVD.LGCode)
where LVD.LGAName is null;

update tbl_LOT_VALUATION_DETAILS inner join tbl_prop_LGA on tbl_LOT_VALUATION_DETAILS.LGCode = tbl_prop_LGA.LGA_CODE 
set tbl_LOT_VALUATION_DETAILS.LGAName = [tbl_Prop_LGA].[LGA_NAME]
where tbl_LOT_VALUATION_DETAILS.LGAName is null; 
```

但是使用 DLookup 解决了这个问题；

```
update tbl_Lot_Valuation_Details as LVD
set LVD.LGAName = dlookup("LGA_NAME", "tbl_Prop_LGA", "LGA_CODE="+LVD.LGCode)
where LVD.LGAName is null; 
```

该解决方案最初是在[https://stackoverflow.com/questions/537161/sql-update-woes-in-ms-access-operation-must-use-an-updateable-query提出的](https://stackoverflow.com/questions/537161/sql-update-woes-in-ms-access-operation-must-use-an-updateable-query.)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T21:02:25.593

问题肯定与（在这种情况下） max() 函数的使用有关。连接期间使用的任何聚合函数（例如，从连接表中检索最大值或最小值或平均值）都会导致错误。这同样适用于使用子查询而不是连接（如在原始代码中）。

这是令人难以置信的烦人（而且不合理！），因为这是一件相当普遍的事情。我还必须使用临时表来解决它（使用插入语句将聚合值拉入临时表，然后使用更新加入该表，然后删除临时表）。

格伦

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-12-06T09:54:47.300

代码中没有错误。但是由于以下原因引发了错误。

```
 - Please check weather you have given Read-write permission to MS-Access database file.

 - The Database file where it is stored (say in Folder1) is read-only..? 
```

假设您将数据库（MS-Access 文件）存储在只读文件夹中，而在运行您的应用程序时，连接并未强制完全打开。因此，更改文件权限/其包含文件夹权限，就像在`C:\Program files`所有大多数 C 驱动器文件中设置**为只读**一样，因此更改此权限可以解决此问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-02-25T17:40:34.810

我知道我的答案晚了 7 年，但无论如何这是我的建议：

当 Access 抱怨包含 JOIN 的 UPDATE 查询时，只需保存查询，并将`RecordsetType`属性设置为`Dynaset (Inconsistent Updates)`.

这有时会允许 UPDATE 工作。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2022-01-05T13:09:14.183

十三年后，我面临同样的问题。DISTINCTROW 没有解决我的问题，但 dlookup 解决了。

我需要从聚合查询中更新表。据我了解，MS Access 始终假定要更新表和聚合查询之间的分离是一对多的，即使在查询中保证了唯一记录。

dlookup的用途是：

```
DLOOKUP(Field, SetOfRecords, Criteria) 
```

**Field**：一个字符串，标识从中检索数据的字段。

**SetOfRecords**：一个字符串，用于标识从中检索字段的记录集，可以是表名或（保存的）查询名（不需要参数）。

**Criteria**：用于限制执行DLookup函数的数据范围的字符串，相当于SQL表达式中的WHERE子句，没有WHERE字样。

**评论**

如果多个字段符合条件，则 DLookup 函数返回第一个匹配项。您应该指定标准，以确保 DLookup 函数返回的字段值是唯一的。

对我有用的查询是：

```
UPDATE tblTarifaDeCorretagem 
   SET tblTarifaDeCorretagem.ValorCorretagem = 
    [tblTarifaDeCorretagem].[TarifaParteFixa]+
    DLookUp(
     "[ParteVariável]",
     "cstParteVariavelPorOrdem",
     "[IdTarifaDeCorretagem] = " & [tblTarifaDeCorretagem].[IdTarifaDeCorretagem]
    ); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-12-19T19:56:25.640

我会尝试在 Access 中构建 UPDATE 查询。我有一个我自己写的 UPDATE 查询

```
UPDATE TABLE1
SET Field1 = 
(SELECT Table2.Field2
 FROM Table2
 WHERE Table2.UniqueIDColumn = Table1.UniqueIDColumn) 
```

该查询给了我您所看到的错误。虽然这适用于我的 SQL Server，但就像前面提到的答案一样，Access UPDATE 语法不是标准语法。但是，当我使用 Access 的查询向导（它使用 JOIN 语法）重建它时，它运行良好。通常我只是让 UPDATE 查询成为使用非 JET 语法的直通方式，但我加入的其中一个表是本地 Access 表。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-01-15T22:25:51.067

当正在更新的表没有唯一的 MS-ACCESS 键时，会发生这种情况。（不管 SQL 模式）。

在创建指向 SQL 表的 MS-Access 链接时，系统会要求您在链接时指定索引（键）。如果这样做不正确，或者根本没有这样做，则针对链接表的查询是不可更新的

将 SQL 表链接到 Access 时，请确保当 Access 提示您输入索引（键）时，您使用的正是 SQL 用来避免问题的方法，尽管指定任何唯一键是 Access 更新表所需的全部内容。

如果您不是最初链接表的人，请从 MS-ACCESS 中删除链接表（链接只会被删除）并重新链接它并正确指定密钥，一切都会正常工作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-17T15:44:41.213

（聚会有点晚了……）

我过去解决这个问题的三种方法是：

1.  在打开的表单上引用文本框
2.  总和
3.  查找

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-07-09T04:39:04.113

我遇到过同样的问题。

我的解决方案是首先从不可更新的查询中创建一个表，然后从一个表到另一个表进行更新，这样就可以了。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-03-12T16:26:54.233

您始终可以在 VBA 中编写类似更新的代码。我也遇到了这个问题，我的解决方法是使用所有连接进行选择查询，该查询具有我正在寻找能够更新的所有数据，使其成为记录集并重复运行更新查询作为更新查询仅更新表，仅搜索您要查找的条件

```
 Dim updatingItems As Recordset
    Dim clientName As String
    Dim tableID As String
    Set updatingItems = CurrentDb.OpenRecordset("*insert SELECT SQL here*");", dbOpenDynaset)
    Do Until updatingItems .EOF
        clientName = updatingItems .Fields("strName")
        tableID = updatingItems .Fields("ID")
        DoCmd.RunSQL "UPDATE *ONLY TABLE TO UPDATE* SET *TABLE*.strClientName= '" & clientName & "' WHERE (((*TABLE*.ID)=" & tableID & "))"
        updatingItems.MoveNext
    Loop 
```

我每天只对大约 60 条记录执行此操作，对数千条记录执行此操作可能需要更长的时间，因为查询从头到尾运行了多次，而不仅仅是选择一个整体组并进行更改。您可能需要在 tableID 的引号周围使用 ' '，因为它是一个字符串，但我很确定这对我有用。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-08-04T08:29:16.333

我用一个简单的 INSERT 语句失败了。**通过使用“以管理员身份运行”**访问权限启动应用程序来修复。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-04-24T23:16:23.310

MS Access - 在更新查询中加入表......如何使其可更新

1.  在设计视图中打开查询
2.  单击链接黑白表/视图一次
3.  在“属性”窗口中，将“唯一记录”的值更改为“是”</li>
4.  将查询保存为更新查询并运行它。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-06T07:49:42.917

本质上，虽然您的 SQL 看起来非常合理，但 Jet 从未支持`UPDATE`. *相反，它使用非常*有限的自己的专有语法（又不同于 SQL Server 的专有`UPDATE`语法） 。通常，“操作必须使用可更新查询”的唯一解决方法是非常痛苦的。认真考虑切换到功能更强大的 SQL 产品。

 *有关您的特定问题和一些可能的解决方法的更多详细信息，请参阅[基于总计查询失败的更新查询](http://support.microsoft.com/default.aspx?scid=kb;en-us;116142&Produc)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-02T00:53:33.440

在我将连接字段设为两个连接表中的唯一索引之前，我一直收到相同的错误。只有这样查询才变得可更新。

菲利普·斯蒂利亚诺斯

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-05-16T08:20:57.553

我一直收到同样的错误，但所有 SQL 在 Access 中执行*得很好*。

当我修改了AccessFile的**权限时。**

问题解决了！！

我给“**网络服务**”帐户完全控制权限，这个帐户如果用于**IIS**

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-08-15T14:30:12.017

当我收到此错误时，可能是因为我的 UPDATE 语法错误，但在我修复更新查询后，我再次遇到同样的错误......所以我去了`ODBC Data Source Administrator`，发现我的连接是只读的。在我将连接进行读写并重新连接后，它工作得很好。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-01-07T15:26:15.813

今天在我的 MS-Access 2003 中，ODBC 表格指向带有 sa 密码的 SQL Server 2000，给了我同样的错误。
我在 SQL Server 数据库中的表上定义了一个主键，问题就消失了。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-01-17T18:48:37.127

这里还有另一种情况适用。已从 Visual Source Safe 中签出的文件（对于仍在使用它的任何人）未在“查看”选项或“签出”中提供“可写性”的文件也将收到此错误消息。

解决方案是从 Source Safe 重新获取文件并应用可写性设置。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-05-05T17:55:57.570

要进一步回答 DRUA 在他/她的回答中提到的内容......

我在 Access 2007 中开发我的数据库。我的用户正在使用 access 2007 运行时。他们具有对 database_Front（前端）文件夹的读取权限，以及对 database_Back 文件夹的读/写权限。

在推出新数据库时，用户没有遵循将前端复制到计算机的完整说明，而是创建了一个快捷方式。通过快捷方式运行前端将创建一个条件，即由于文件写入限制，查询不可更新。

将前端复制到他们的文档文件夹可以解决问题。

是的，当用户必须获得前端的更新版本时，这会使事情变得复杂，但至少查询可以正常工作，而不必求助于临时表等。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-10-21T10:36:29.150

检查您的数据库（数据库权限）并给予完全权限

转到数据库文件夹->右键单击属性->安全->编辑->给予完全控制和开始菜单->运行->键入“uac”使其关闭（如果它很高）

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2016-11-30T00:17:20.657

iDevlop 上面给出的答案对我有用。请注意，我无法在更新查询中找到 RecordsetType 属性。但是，我能够通过将我的查询更改为选择查询、将该属性设置为 iDevlop 所指出的然后将我的查询更改为更新查询来找到该属性。这行得通，不需要临时表。

我希望这只是对 iDevlop 发布的内容的评论，以便它从他的解决方案中流出，但我没有足够高的分数。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-05-05T09:07:44.903

我通过添加“DISTINCTROW”解决了这个问题

所以这里就是

```
UPDATE DISTINCTROW CLOG SET CLOG.NEXTDUE 
```

# c# - 对于这个项目来说，从 C# 2.0 到 C# 3.0 的过渡值得吗？

> ID：170584
> 
> 赞同：17
> 
> 时间：2008-10-04T16:10:34.110
> 
> 标签：c#, .net, project-management, code-migration

我在 Stack Overflow 上读过一些人已经将 C#2.0 转换为 C#3，但这真的值得吗？

~~我有一个项目在进入维护阶段之前完成了 75%。我问自己是否值得切换到 C#3.0？~~

### 更新：

该项目现在将有一个 Web 界面，因此在进入维护阶段之前，我们必须开发 Web 部件（所有这些都是为了内部目的使用 Windows 窗体完成的）。大多数部分将被重用（后端）。过去很多人都说不值得，因为已经75%了……但现在你还觉得不值得吗？

### 最后做了什么

最后，由于我们正在使用 Web 界面继续该项目，我们将在新的一年更新到 3.5。谢谢大家的所有意见。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-04T16:38:40.993

**澄清**
C# 3.5 不存在。有 C#1.0、C#2.0 和 C#3.0。

然后是 .NET 1.0、.NET 1.1、.NET 2.0、.NET 3.0 和 .NET 3.5。

我们不应该混淆这两者。

**C# 3.0 与 C#2.0**
现在，C#3.0 值得一试吗？我想说，随着扩展方法和 Lambda 表达式的存在，答案是肯定的。仅这两个功能就更容易阅读和更快地编写代码。将其添加到自动实现的属性、LINQ 和部分方法中，C#3.0 表明自己是一个有利的举措。

但是，迁移现有项目不一定有好处。在决定迁移现有工作之前，您必须权衡利弊，尤其是在引入新错误和不稳定性方面。对于新项目，我会说从 C#3.0 开始。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-04T16:14:00.623

不，我建议不要。我建议仅在新项目上启动 3.5，除非另有特定原因。仅重新编译不会从 3.5 中获得任何好处，因为您的代码已经编写（或至少 75%）。

如果以后需要迁移到 3.5，可以轻松搞定。当然，您将拥有 2.0 风格的代码，但已经完成了。

*   保守一点，除非你需要，否则不要做某事。
*   一个应用程序在 C#2.0 中占 75%，在 C#3.0 中占 25%，这并不是一个好维护的野兽。100% 的 C#2.0 应用程序当然更易于维护。

当您要开始一个新项目时，请务必切换！新框架版本很有意思，强烈推荐switch。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-04T16:13:22.310

在这个阶段是否有任何你非常想要的 C# 3.5 功能？:)

如果是 LINQ，您可以尝试[LINQBridge](http://www.albahari.com/nutshell/linqbridge.aspx)。使用 Studio 的多目标和 LINQBridge，您将能够使用 C# 3.0 编译器的全部功能编写本地（LINQ to Objects）查询，但您的程序将只需要框架 2.0。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-04T16:14:52.180

我认为这很大程度上取决于你的个人风格。恕我直言，C# 3.5 的最佳特性真正归结为以下几点

1.  Lambda 表达式
2.  LINQ
3.  扩展方法

我的 OO 代码仍然看起来有点面向功能。因此，我认为 3.5 是一个巨大的好处，绝对值得升级。

更好的是可以使用 3.5 编译器来降低 CLR 2.0 的目标。这允许您使用新框架基于 2.0 安装（相对于 3.0/3.5 安装）进行部署。如果您愿意将适当的类型添加到您的程序中，上述所有操作都可以在这种情况下完成。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-04T21:07:42.043

在我看来，没有充分的理由不切换到 3.5。

真正的杀手级功能是您可以在使用所有新语言功能的同时继续针对运行时的旧版本（2.0+）。因此，您可以使用新的 lambda 表达式、扩展方法、匿名类型和所有其他好东西。如果您的客户仍然主要使用 2.0 框架，您可以继续针对较早的运行时。

（如果您必须针对早期的运行时版本，请不要使用 3.5 框架中的任何*类。）*

就我个人而言，我认为如果你正在做一个桌面 GUI 应用程序，你最好的选择是使用 3.0 或 3.5 框架，因为 WPF 是我曾经使用过的最好的用户界面库（从长远来看）。

另一方面，如果您已经在 WinForms 中编写了大部分 GUI，那么您可能会对 3.5 框架感兴趣，该框架允许（有限）混合 WinForms 和 WPF GUI 元素。您可以保留您已经完成的工作，但在任何有意义的地方都可以使用 WPF 控件添加一些不错的功能。

3.5 框架的另一个方便的特性是“Collection Initializers”。看一下这个：

```
var myDictionary = new Dictionary<String, String> {
   { "key-1", "value-1" },
   { "key-2", "value-2" },
   { "key-3", "value-3" },
}; 
```

整齐吧？

如果它更像 JSON，我会更喜欢它。但无论如何它都是非常方便的功能。

您可以为 2.0 运行时的任何事件定位该代码！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-04T16:14:18.580

如果您的项目接近完成，您可能不会从 3.5 的新功能中受益。对于新项目，当然值得一看。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-04T16:15:50.870

这实际上取决于项目、它的目标对象以及它的作用。

可以肯定地猜测 .NET Framework 2.0 在比 3.5 版更多的计算机上。

此外，您是否需要从 .NET 3.5 获得 2.0 中不可用的东西（例如 LINQ）？如果您正在处理大量查询和数据，我会切换。但同样，这取决于客户以及您是否打算在可预见的将来维护此应用程序。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-08T23:13:47.793

从技术的角度来看，这都是框架版本 2，而且实现起来非常简单。2.0、3.0 和 3.5 的区别只是[额外的库代码](http://blogs.msdn.com/mohammadakif/archive/2006/12/03/net-3-0-different-versions-of-the-net-framework.aspx)和一些编译器语法糖。

这不像你需要改变任何东西；通过定位框架 3.5，您有更多选择。

从您的团队的角度来看：是的，这是值得的。没有人愿意在旧代码库上工作。当您处于开发的热潮中时，您不妨利用最新的稳定技术。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-08T23:44:00.977

这真的取决于你需要做什么。如果您的项目需要 Lambda 表达式，您可以在其中使用清晰的语法查询对象，那么您应该查看 3.0。

我目前正在阅读Jon Skeet 的[C# In Depth](https://rads.stackoverflow.com/amzn/click/com/1933988363)，他采用在 C# 1.15 中布置解决方案的方法，然后改进解决方案以描述您在 2.0 和 3.0 中获得的新的有用功能。这种类型的进展将是回答您的问题的完美方式。这本书读起来也很好，所以我发现我很快就读完了。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-29T17:30:01.373

您必须权衡成本与收益。您没有提供有关您的项目的足够信息，无法让我们在这里为您提供建议，但请考虑：

*   转换成本非常小。C# 3.0 几乎完全向后兼容 2.0 并在框架 2.0 上运行
*   如果编码几乎完成，收益也很小，但从长远来看*可能会*增长。例如，您将来可能必须实现的新功能可能会使用 Linq 更容易实现。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-01T02:12:42.313

我已经进行了多次转换。主要是因为 lambda 表达式的清晰语法使代码更容易理解（无论如何对我来说）。

我确实使用了[ReSharper](http://en.wikipedia.org/wiki/ReSharper)，这使得使用新的 3.5 功能变得轻而易举，因为 ReSharper 的重构建议中出现了很多。使用这样的工具使这种过渡变得更加容易。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-04T16:21:34.367

3.5 建立在 2.0 之上，所以直接跳到 3.5 没有问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-04T18:09:08.533

我会...没有任何伤害，您可以从新功能中获得一些好处

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-11-01T01:38:59.480

我不明白你们所有人说的不要这样做。.NET 2.0 是当前 (CLR) 运行时。.NET 3.0 和 .NET 3.5 都在 2.0 运行时上运行。迁移到 .NET 3.5 以获取 C# 3.0 功能实际上就是更改项目属性中的单个下拉列表的问题。（好的，如果您使用一些 3.5 功能（如 LINQ 等），请将 3.5 运行时部署到您的目标机器。如果安装 3.5 是一个问题，那么这不是一个简单的答案。）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-29T17:23:00.733

除非您有充分的理由这样做，否则我不会更改任何内容；即有一个你不能在2.0 中解决的错误。

在项目的这么晚升级框架可能会导致一些您目前确实不需要的问题。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-21T13:07:40.620

如果您对项目有扩展，现在切换到最新版本的 .NET 可能是件好事，否则我不会。

# java - Java的UNIX套接字实现？

> ID：170600
> 
> 赞同：49
> 
> 时间：2008-10-04T16:18:37.430
> 
> 标签：java, unix, jdbc, unix-socket

我意识到，由于 UNIX 套接字是特定于平台的，因此必须涉及一些非 Java 代码。具体来说，我们有兴趣使用 JDBC 连接到仅启用了 UNIX 域套接字的 MySQL 实例。

它看起来不支持，但从我读过的内容来看，*如果*我们能找到一个体面的 Java UNIX 套接字实现，那么至少应该可以为基于 UNIX 套接字的 JDBC 编写一个 SocketFactory。

有没有人试过这个？有谁知道这样的实现？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-04T16:46:07.860

查看 JUDS 库。它是一个 Java Unix 域套接字库...

[https://github.com/mcfunley/juds](https://github.com/mcfunley/juds)

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-09-09T06:07:36.490

您可以使用 junixsocket：[https ://github.com/kohlschutter/junixsocket](https://github.com/kohlschutter/junixsocket)

它已经提供了通过 Unix 套接字从 Java (Connector/J) 连接到 MySQL 的代码。

与其他实现相比的一大优势是 junixsocket 使用标准的 Java Socket API。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-10-21T15:40:23.887

[MariaDB JDBC 驱动程序](https://mariadb.com/kb/en/mariadb/about-mariadb-connector-j)现在支持这一点并且与 MySQL JDBC 驱动程序兼容。

使用 JDBC url，如：

`jdbc:mariadb://localhost:3306/revmgt?localSocket=/var/run/mysqld/mysqld.sock`

值得注意的是，该库需要包含 JNA 库，因为它使用 JNA 访问本机 unix 域套接字。它在我的测试中运行良好。我看到了从卸载到本机代码的 CPU 绑定 Java 进程的速度改进。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-03-18T12:25:54.440

由于在另一个答案中提到的原始[kohlschutter/junixsocket](https://github.com/kohlschutter/junixsocket)似乎已死，您可以查看它的分叉。

尤其是**[fiken/junixsocket](https://github.com/fiken/junixsocket)**看起来很有希望。例如，它的作者通过[pgjdbc](https://github.com/pgjdbc/pgjdbc)添加了对使用 unix 套接字连接到 PostgreSQL 的支持。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-04T16:29:39.623

查看 JNA 库。它是纯 Java 和 JNI 本机代码之间的中转站

[https://github.com/twall/jna/](https://github.com/twall/jna/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2021-05-14T10:13:25.887

[从 Java 16 开始，Java 通过SocketChannel](https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/nio/channels/SocketChannel.html)和[ServerSocketChannel](https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/nio/channels/ServerSocketChannel.html) API原生支持 Unix 域套接字 。

[您可以在此处的](https://docs.oracle.com/en/java/javase/16/core/internet-protocol-and-unix-domain-sockets-nio-example.html)[JEP380](https://inside.java/2021/02/03/jep380-unix-domain-sockets-channels/)提案和实施示例中找到有关它的更多信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-01-03T16:50:47.900

[JNR 项目（它是](https://github.com/jnr)[panama 项目](http://openjdk.java.net/projects/panama/)的松散基础）有一个[unix 套接字](https://github.com/jnr/jnr-unixsocket)实现。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-05-13T02:52:28.483

在 Internet 上进行的一些搜索发现了以下看起来很有用的库：

[http://www.nfrese.net/software/gnu_net_local/overview.html](http://www.nfrese.net/software/gnu_net_local/overview.html)

[回程链接](http://web.archive.org/web/20080820110115/http://www.nfrese.net/software/gnu_net_local/doc/javadoc/index.html)

编写套接字工厂应该很容易。完成此操作后，您可以将其传递给您的司机[THUSLY](http://mysql.telepac.pt/doc/refman/5.0/en/mxj-driver-launched.html) .( [Wayback Link](http://web.archive.org/web/20080820110115/http://www.nfrese.net/software/gnu_net_local/doc/javadoc/index.html) )。

```
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;

import com.mysql.management.driverlaunched.ServerLauncherSocketFactory;

public class ConnectorMXJTestExample {
    public static void main(String[] args) throws Exception {
        String hostColonPort = "localhost:3336";

        String driver = com.mysql.jdbc.Driver.class.getName();
        String url = "jdbc:mysql://" + hostColonPort + "/" + "?"
                + "socketFactory="
                + ServerLauncherSocketFactory.class.getName();
        String userName = "root";
        String password = "";

        Class.forName(driver);
        Connection conn = null;
        try {
            conn = DriverManager.getConnection(url, userName, password);
            Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery("SELECT VERSION()");
            rs.next();
            String version = rs.getString(1);
            rs.close();
            stmt.close();

            System.out.println("------------------------");
            System.out.println(version);
            System.out.println("------------------------");
        } finally {
            try {
                conn.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
            ServerLauncherSocketFactory.shutdown(hostColonPort);
        }
    }
} 
```

# objective-c - Objective-C 整洁

> ID：170601
> 
> 赞同：15
> 
> 时间：2008-10-04T16:20:00.360
> 
> 标签：objective-c, cocoa, xcode

我有一个格式有些混乱的 Objective-C 代码库。有没有办法让 Xcode 重新格式化整个项目以符合编码标准（即正确缩进、空格和制表符等）？是否有其他工具可以完成此任务？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-04T16:44:02.060

[去壳： http](http://uncrustify.sourceforge.net/) ://uncrustify.sourceforge.net/

> C、C++、C#、ObjectiveC、D、Java、Pawn 和 VLA 的源代码美化器

如果你想要更简单的东西，你可以通过简单地去除所有的空白/换行符，并在 上添加一个新的换行符`;` `{` `}`，并手动重新缩进代码来获得一些方法。它不会接近完美布局的代码，并且重新缩进对大代码来说可能是一种痛苦，但它会是一致的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-04T19:09:18.693

一个简单但有限的解决方案是 Xcode 中的 Edit->Format->Re-Indent，它将应用您当前的缩进设置（Xcode->Preferences...->Indentation）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-04T16:36:17.363

根据这篇[博](http://blog.neontology.com/posts/2007/01/05/beautiful-c-in-textmate)文，[bcpp](http://dickey.his.com/bcpp/bcpp.html)与 Objective-C 一起工作。

此外，工具缩进可能会对您有所帮助。它的目标是纯 C，但有无数的选项可以提供帮助。我不知道它是否默认出现在 OS X 上。

```
NAME
       indent - changes the appearance of a C program by inserting or deleting
       whitespace.

SYNOPSIS
       indent [options] [input-files]

       indent [options] [single-input-file] [-o output-file]

       indent --version

DESCRIPTION
       This man page is generated from the file indent.texinfo.  This is  Ediâ
       tion  of "The indent Manual", for Indent Version , last updated .

       The  indent  program  can  be used to make code easier to read.  It can
       also convert from one style of writing C to another.

       indent understands a substantial amount about the syntax of C,  but  it
       also attempts to cope with incomplete and misformed syntax. 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-04T19:20:19.983

来自 Xcode：

1）更改缩进首选项以匹配您想要的。

2）选择要处理的文件并全选（cmd-A）

3) 左移 (cmd-[) 几次，直到所有行都在窗口的左边缘。

4）使用重新缩进选择（从编辑->格式->或从右键单击上下文菜单）

一次只能处理一个文件，而不是整个项目。也只处理缩进。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-28T21:53:57.217

在修补了多个外部格式化程序和弱的内部 xcode 格式化程序之后，我终于解决了 uncrustify。Uncrustify 具有相当好的 Objective-C 支持，可以作为用户脚本轻松地与 xcode 集成，并为 xcode 原生支持的几乎所有语言提供集中式格式化程序。

uncrustify 的最大障碍是令人生畏的配置文件。我的建议是，采用提供的示例配置之一（ben2.cfg 非常好），合并到 objc.cfg 示例中，并根据需要进行调整。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-02T21:20:45.547

在不同的上下文中使用 uncrustify 的一种方法是

[http://universalindent.sourceforge.net/](http://universalindent.sourceforge.net/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-09-13T17:41:08.997

“GTMXcodePlugin”（又名*Google Toolbox For Mac Xcode 插件*）的唯一功能 - 通过有效且安全地修剪空格，在整理 Objective-c 代码方面做得很好。

> [GTM Xcode 4 插件](http://code.google.com/p/google-toolbox-for-mac/wiki/GTMXcodePlugin)目前仅在“编辑”菜单末尾添加“清理空白”菜单项，以从文本文件中删除不必要的行尾空白。希望我们能尽快添加更多功能。它仅针对 Xcode 4.2 进行了测试。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-05-31T16:30:27.887

在撰写本文时，最新、最好的方法是[SpaceCommander](https://github.com/square/spacecommander)。它基于 clang，并具有许多其他简洁的功能，并且在撰写本文时一直在维护和活跃。

# security - 资源列表授权的最佳实践是什么？

> ID：170606
> 
> 赞同：5
> 
> 时间：2008-10-04T16:22:32.463
> 
> 标签：security, authorization

发布和/或协作应用程序通常涉及共享对资源的访问。在门户中，用户可能被授予对某些内容的访问权限作为组的成员或由于明确的访问权限。完整的内容集可以包括公共内容、群组成员内容和私人用户内容。或者，对于协作应用程序，我们可能希望将资源作为工作流程的一部分传递或共享文档的保管以进行编辑。

由于大多数应用程序将这些资源存储在数据库中，因此您通常会创建查询，例如“获取我可以编辑的所有文档”或“获取我可以看到的所有内容”。其中“可以编辑”和“可以查看”是用户的权限。

我有两个问题：

1.  检索资源后，对用户进行授权非常容易，但是如何有效地对可用资源列表执行授权呢？和，

2.  这种授权可以脱离应用的核心吗？也许进入一个单独的服务？分离后，您如何过滤诸如“获取所有我可以看到的标题为 [SomeSearchTerm] 的文档”之类的查询？在我看来，您的单独系统将不得不复制大量参考数据。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T02:27:30.193

您可能有兴趣阅读[Steffen Bartsch 的这篇文章](http://steffenbartsch.com/blog/2008/08/rails-authorization-plugins/ "Rails 授权插件")。它总结了 Ruby on Rails 的所有授权插件，我相信它会帮助您找到解决方案（虽然本文是关于 Rails 插件的，但这些概念很容易在 Rails 之外导出）。

Steffen 还构建了自己的插件，称为“声明式授权”，它似乎符合您的需求，恕我直言：

*   一方面，您定义**角色**（例如“访客”、“管理员”……）。您的**用户**与这些角色相关联（以多对多关系）。您将这些角色映射到**权限**（同样是多对多关系）。每个特权都链接到给定的**上下文**。例如，角色“*访问者*”可能具有“*阅读文档*”的权限。在本例中，“ *read* ”是权限，它应用于“ *documents* ”上下文。
    *   注意：在 Steffen 的插件中，您可以定义角色的层次结构。例如，您可能希望“ *global_admin* ”角色包括“ *document_admin* ”角色，以及“ *comment_admin* ”角色等。
    *   您还可以定义权限层次结构：例如，“*管理*”权限可以包括“*读取*”、“*更新*”、“*添加*”和“*删除*”权限。
*   另一方面，您根据**权限**和**上下文**而不是角色来编写应用程序的思维方式。例如，显示文档的动作应该只检查用户是否具有在“*文档”上下文中“**阅读*”的权限（无需检查用户是否具有“*访问者*”角色或任何其他角色）。这极大地简化了您的代码，因为大多数授权逻辑都在其他地方提取（甚至可能由其他人定义）。

 **用户角色的定义和应用程序级权限的定义之间的这种分离保证了您的代码不会在每次定义新角色时发生变化。例如，以下是控制器中访问控制的简单程度：

```
class DocumentController [...]
  filter_access_to :display, :require => :read
  def display
    ...
  end
end 
```

在视图内部：

```
<html> [...]
  <% permitted_to?(:create, :documents) do %>
  <%= link_to 'New', new_document_path %>
  <% end %>
</html> 
```

Steffen 的插件还允许对象级（即行级）访问控制。例如，您可能想要定义一个角色，如“ *document_author* ”，并赋予它“documents”的“ *manage* *”*权限，但**前提**是用户是文档的作者。该规则的声明可能如下所示：

 ***```
role :document_author do
  has_permission.on :documents do
    to :manage
    if_attribute :author => is {user}
  end
end 
```

这里的所有都是它的！您现在可以像这样获取允许用户更新的所有文档：

```
Document.with_permissions_to(:update) 
```

由于“*管理*”权限包括“*更新*”权限，这将返回作者为当前用户的文档列表。

当然，并非每个应用程序都需要这种级别的灵活性……但您可能需要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T16:36:47.643

I generally have a schema like this

Users −−∈ UserDocuments ∋−− Documents

Then I create a view "ProfiledDocuments"

```
SELECT <fields> 
FROM Documents d 
INNER JOIN UserDocuments ud on ud.DocumentId = d.Id 
INNER JOIN Users u ON u.Id = ud.UserId 
```

Then run the search queries on ProfiledDocuments always using a UserId filter. With appropriate indexes it works well enough.

If you need more complex permissions, you can do it with an extra field in the UserDocuments many to many table which specifies the kind of permission.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T00:48:09.167

尽管您的问题非常详尽，但实际上缺少一些上下文。
什么定义了用户有权访问的文档？用户只能编辑他的“自己的”文件吗？这里有基于角色的机制吗？它是否更面向 MAC（即用户可以看到一定程度的安全性）？数据是否有定义属性（例如部门）？

所有这些问题加在一起可能会提供更好的画面，并提供更具体的答案。

如果文档由特定用户“拥有”，则非常简单 - 为文档设置一个“所有者”字段。然后，查询用户拥有的所有文档。
同样，如果您可以预先定义具有访问权限的命名用户（或角色）列表，您可以查询文档、授权用户/角色列表和用户（或他的角色）之间的连接列表。
如果用户根据其部门（或其他类似文档的属性）获得权限，您可以对其进行查询。
同样，您可以查询安全级别等于或低于用户权限的所有文档。如果这是动态工作流，则每个文档通常都应标有其当前状态和/或下一个预期步骤；哪些用户可以执行下一步只是另一个特权/角色（与上述相同）。
然后，当然，你会想要在所有这些和公共文件之间做一个 UNION ALL ......

顺便说一句，如果我没有说清楚，这不是一个简单的问题 - 帮自己一个忙，找到预先构建的基础设施来为你做这件事。即使以简化您的授权模式为代价。

# build - How do I compile to x64 binary from a x86 platform running VS2008 Pro?

> ID：170616
> 
> 赞同：3
> 
> 时间：2008-10-04T16:35:52.967
> 
> 标签：build, x86, 64-bit, executable, binary-compatibility

I am trying to compile my apps (which uses 3rd party libraries) for the x64 platform. However selecting x64 from Build Configuration Manager from my VS2008 Pro doesn't seem to work. The binary does get created but my client wasn't able to get it to run on x64\.

I wonder if the 3rd party DLLs could be the cause. Anyone has any idea on this?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T16:39:19.917

Do you have x64 versions of the third party libraries? If not you are out of luck. A process must either be fully x86 or x64, you can't mix and match libraries. If the libraries are DLLs then you still need the export libraries from an x64 build.

In what way does selecting the x64 configuration in VS not work?

**Updated:** If your app is .NET and architecture neutral, then it will be loaded as 64 bit on 64 bit OS'es. However, if it relies on 32 bit DLLs then this will fail at run time. You can force your exe to always load 32 bit using the [corflags](http://msdn.microsoft.com/en-us/library/ms164699(VS.80).aspx) utility.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T11:31:05.967

设法查明问题的根源。这是源代码混淆工具（Intellilock 1.1.0.4）中的设置（加密 IL 代码）之一，导致二进制文件无法在 x64 环境中运行。

禁用此设置可解决此问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T18:54:32.920

正如罗伯·沃克所说。您可以通过在 x64 机器上使用 SysInternals 的“depends”程序来了解更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T13:31:01.463

我的应用程序没有安装程序。我以 .NET2.0 作为先决条件将其创建为“便携式应用程序”。

我已向供应商发布了相同的请求。如果他们有 x64 位，仍在等待他们恢复。

与此同时，我正在购买 x64 Vista 的副本以亲自测试它。我不能牺牲我的用户来为我测试这个。一旦我有新的更新，我会保持这个线程发布。

谢谢。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T19:13:12.820

“从我的 VS2008 Pro 的构建配置管理器中选择 x64 似乎不起作用”
我不确定您为什么会得到二进制文件，但请记住默认情况下未安装 x64 工具。返回并重新运行 VC2008 安装程序，进行自定义安装，并在树的 VC++ 位下，确保选中 64 位编译器的复选框。如果不是，请检查并运行安装。然后尝试你的构建。

您确实需要 3rd 方 dll 的 64 位版本，并且您确实需要正确获取所有包含和 lib 路径以及正确的输出文件夹，但安装该工具是第一步。

# windows - 如何找到 Windows 的安装时间和日期？

> ID：170617
> 
> 赞同：149
> 
> 时间：2008-10-04T16:36:15.850
> 
> 标签：windows, installation

这听起来有点像一个疯狂的问题，但我如何才能（希望通过 API/注册表项）找出 Windows 的安装时间和日期？

到目前为止，我能想到的最好的办法是查看 C:\Windows 中的各种文件并尝试猜测......但这并不是一个很好的解决方案。

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-10-04T16:46:54.690

## TLDR

**重要说明**如果 Windows 是使用磁盘映像*“安装”的，这两种方法都会失败。*

**如果 windows 尚未升级到新的主要版本（例如 windows 10 到 windows 11），则**方法 1有效。**您执行该命令`systeminfo`并查找以“原始安装日期”开头的行（或您当地语言的类似内容）。您可以通过查询 WMI 和查看注册表来获得相同的版本。如果 Windows 升级到新的主要版本，不幸的是，此方法会为您提供新主要版本的安装日期。这是一个通过从 PowerShell 运行 systeminfo 检查版本的示例：**

 **```
systeminfo | sls "original" 
```

**方法 2**即使在重大更新之后，这似乎也能正常工作。`system.ini`您可以通过检查似乎保持不变的文件的创建时间来获得安装日期。例如使用 PowerShell：

```
 (Get-Item "C:\Windows\system.ini").CreationTime 
```

## 细节

另一个符合“**[代码挑战](https://stackoverflow.com/questions/172184)**”的问题：这里有一些源代码可执行文件来回答这个问题，但它们并不完整。
你会找到一个任何人都可以在他/她的计算机上执行的 vb 脚本，并获得预期的结果吗？

* * *

```
systeminfo|find /i "original" 
```

会给你实际的日期......而不是秒数;）

但是（**警告**），正如[Salman A](https://stackoverflow.com/users/87015/salman-a)和[AutoMattTick](https://stackoverflow.com/users/3343110/automatttick)[在 2021 年的评论](https://stackoverflow.com/questions/170617/how-do-i-find-the-install-time-and-date-of-windows/170634#comment122406606_170634)中所指出的那样

> 如果 Windows 更新到较新版本，这似乎给出了**重新安装 Windows 的日期**。

* * *

正如[Sammy](https://stackoverflow.com/users/1656624/sammy) [评论](https://stackoverflow.com/questions/170617/how-do-i-find-the-install-time-and-date-of-windows/170634#comment30361382_170634)的那样，`find /i "install"`提供的超出了您的需要。
这只有在语言环境是英语时才有效：它需要匹配语言。
对于瑞典语，这将是“ `ursprungligt`”和“ `ursprüngliches`”对于德语。

[Andy Gauge](https://stackoverflow.com/users/5586783/andy-gauge)在[评论](https://stackoverflow.com/questions/170617/how-do-i-find-the-install-time-and-date-of-windows/170634#comment119648719_170634)中提出：

> 剃掉 5 个字符
> 
> ```
> systeminfo|find "Original" 
> ```

* * *

在 Windows [PowerShell](http://en.wikipedia.org/wiki/Windows_PowerShell)脚本中，您只需键入：

```
PS > $os = get-wmiobject win32_operatingsystem
PS > $os.ConvertToDateTime($os.InstallDate) -f "MM/dd/yyyy" 
```

通过使用 WMI（[Windows 管理规范](http://en.wikipedia.org/wiki/Windows_Management_Instrumentation)）

如果不使用 WMI，则必须阅读然后转换注册表值：

```
PS > $path = 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion'
PS > $id = get-itemproperty -path $path -name InstallDate
PS > $d = get-date -year 1970 -month 1 -day 1 -hour 0 -minute 0 -second 0
## add to hours (GMT offset)
## to get the timezone offset programatically:
## get-date -f zz
PS > ($d.AddSeconds($id.InstallDate)).ToLocalTime().AddHours((get-date -f zz)) -f "MM/dd/yyyy" 
```

这篇文章的其余部分为您提供了访问相同信息的其他方法。选择你的毒药；）

* * *

在 VB.Net 中会给出类似的东西：

```
Dim dtmInstallDate As DateTime
Dim oSearcher As New ManagementObjectSearcher("SELECT * FROM Win32_OperatingSystem")
For Each oMgmtObj As ManagementObject In oSearcher.Get
    dtmInstallDate =
        ManagementDateTimeConverter.ToDateTime(CStr(oMgmtO bj("InstallDate")))
Next 
```

* * *

在[Autoit](http://www.autoitscript.com/autoit3/)（一种 Windows 脚本语言）中，这将是：

```
;Windows Install Date
;
$readreg = RegRead("HKLM\SOFTWARE\MICROSOFT\WINDOWS NT\CURRENTVERSION\", "InstallDate")
$sNewDate = _DateAdd( 's',$readreg, "1970/01/01 00:00:00")
MsgBox( 4096, "", "Date: " & $sNewDate )
Exit 
```

* * *

在 Delphy 7 中，这将是：

```
Function GetInstallDate: String;
Var
  di: longint;
  buf: Array [ 0..3 ] Of byte;
Begin
  Result := 'Unknown';
  With TRegistry.Create Do
  Begin
    RootKey := HKEY_LOCAL_MACHINE;
    LazyWrite := True;
    OpenKey ( '\SOFTWARE\Microsoft\Windows NT\CurrentVersion', False );
    di := readbinarydata ( 'InstallDate', buf, sizeof ( buf ) );
//    Result := DateTimeToStr ( FileDateToDateTime ( buf [ 0 ] + buf [ 1 ] * 256 + buf [ 2 ] * 65535 + buf [ 3 ] * 16777216 ) );
showMessage(inttostr(di));
    Free;
  End;
End; 
```

* * *

作为替代方案，[CoastN](https://stackoverflow.com/users/5507748/coastn)[在评论中](https://stackoverflow.com/questions/170617/how-do-i-find-the-install-time-and-date-of-windows/170634?noredirect=1#comment103723162_170634)提出：

> 由于**`system.ini-file`**在典型的 Windows 部署中保持不变，您实际上可以使用以下 oneliner 获取安装日期：
> 
> ```
> (PowerShell): (Get-Item "C:\Windows\system.ini").CreationTime 
> ```

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2008-10-04T16:43:16.897

在`regedit.exe`去：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\InstallDate 
```

它以自 1970 年 1 月 1 日以来的秒数给出。（注意：对于 Windows 10，此日期将是安装最后一个功能更新的时间，而不是原始安装日期。）

要将该数字转换为可读的日期/时间，只需将十进制值粘贴到此[Unix 时间转换在线工具](http://www.onlineconversion.com/unix_time.htm)的“UNIX 时间戳：”字段中。

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2017-06-14T08:31:33.573

我们在这里有足够的答案，但我想投入我的 5 美分。

我在之前安装的基础上安装了 Windows 10`10/30/2015`和 Creators Update `04/14/2017`。我之前的答案中描述的所有方法都给了我创作者更新安装的日期。

[![原始安装日期](https://i.stack.imgur.com/G9JCJ.png)](https://i.stack.imgur.com/G9JCJ.png)

我设法找到了几个文件的创建日期与我的 Windows 10 的真实（干净）安装日期相匹配：

*   在`C:\Windows`

[![几个 C:\Windows 文件](https://i.stack.imgur.com/iIt5u.png)](https://i.stack.imgur.com/iIt5u.png)

*   在`C:\`

[![几个 C:\ 文件](https://i.stack.imgur.com/QkRWp.png)](https://i.stack.imgur.com/QkRWp.png)

* * *

顺便说一句，在 C:\ 和 C:\windows 中获取 10 个最旧（通过创建）文件的简单方法是在管理 powershell 会话上运行这两个命令：

```
dir -Force C:\ | sort -Property creationtime  | select -Property name, creationtime -First 10
dir -Force C:\windows | sort -Property creationtime  | select -Property name, creationtime -First 10 
```

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2012-11-23T18:28:20.683

打开命令提示符，输入“ **systeminfo** ”并回车。您的系统可能需要几分钟才能获取信息。在结果页面中，您将找到“系统安装日期”条目。那是windows安装的日期。此过程适用于 XP、Win7 和 win8。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2011-04-28T12:14:38.533

如何找出 Windows 7 安装日期/时间：

只是看到这个...

*   开始 > 输入 CMD
*   输入系统信息

就是这样; 然后您可以看到有关您的机器的所有信息；非常简单的方法

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2014-01-09T01:55:02.453

想知道您的 PC 的操作系统安装日期吗？这是查找您的 PC 操作系统安装（或上次升级）的日期和时间的快速简便的方法。

打开命令提示符（开始->运行->键入cmd->回车）并运行以下命令

系统信息 | 查找 /i "安装日期"

几秒钟后，您将看到安装日期

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2014-07-10T21:13:37.763

在 Powershell 中运行命令：

```
systeminfo | Select-String "Install Date:" 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2017-11-16T18:12:57.603

Windows 10 操作系统还有另一个注册表子项，这个在 SYSTEM 配置单元文件中：

```
Computer\HKEY_LOCAL_MACHINE\SYSTEM\Setup\ 
```

此处的安装日期信息是原始计算机操作系统的安装日期/时间。它还会告诉您更新开始的时间，即

```
 Computer\HKEY_LOCAL_MACHINE\SYSTEM\Setup\Source OS (Updated on xxxxxx)." 
```

这当然可能不是更新结束的时候，用户可能会在提示时选择关闭而不是重新启动，等等......

更新实际上可以在不同的一天完成，并且

```
Computer\HKEY_LOCAL_MACHINE\SYSTEM\Setup\Source OS (Updated on xxxxxx)" 
```

将反映开始更新的日期/时间。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-06-06T16:47:21.930

我发现 c:\pagefile.sys 的创建日期在大多数情况下都非常可靠。使用此命令可以轻松获取它（假设 Windows 安装在 C: 上）：

```
dir /as /t:c c:\pagefile.sys 
```

“/as”指定“系统文件”，否则将找不到。'/t:c' 将时间字段设置为显示'creation'。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2017-04-07T17:48:18.787

HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\InstallDate 和 systeminfo.exe 产生**[错误的日​​期](http://metadataconsulting.blogspot.ca/2017/04/How-to-get-the-most-accurate-Windows-Install-Date-time-zone-adjusted.html)**。

UNIX 时间戳的[定义](https://en.wikipedia.org/wiki/Unix_time)与时区无关。UNIX 时间戳定义为自 1970 年 1 月 1 日星期四 00:00:00 协调世界时 (UTC) 以来经过的秒数，不包括闰秒。

换句话说，如果您将计算机安装在华盛顿州西雅图并搬到纽约，那么 HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\InstallDate 将不会反映这一点。这是**错误的日期**，它不存储最初安装计算机的时区。

这样做的效果是，**如果您在运行此程序时更改时区，日期将是错误的。您必须重新运行可执行文件，以便它考虑时区更改。**

但是您可以从 WMI [Win32_Registry](https://msdn.microsoft.com/en-us/library/aa394378%28v=vs.85%29.aspx)类中获取时区信息。

根据 Microsoft TechNet[文章](https://technet.microsoft.com/en-us/library/ee198928.aspx)“使用 WMI 处理日期和时间”，InstallDate 采用 UTC 格式 (yyyymmddHHMMSS.xxxxxx±UUU)，其中 xxxxxx 是毫秒，±UUU 是与格林威治标准时间不同的分钟数。

```
 private static string RegistryInstallDate()
    {

        DateTime InstallDate = new DateTime(1970, 1, 1, 0, 0, 0);  //NOT a unix timestamp 99% of online solutions incorrect identify this as!!!! 
        ManagementObjectSearcher searcher = new ManagementObjectSearcher("SELECT * FROM Win32_Registry");

        foreach (ManagementObject wmi_Windows in searcher.Get())
        {
            try
            {
                ///CultureInfo ci = CultureInfo.InvariantCulture;
                string installdate = wmi_Windows["InstallDate"].ToString(); 

                //InstallDate is in the UTC format (yyyymmddHHMMSS.xxxxxx±UUU) where critically
                // 
                // xxxxxx is milliseconds and       
                // ±UUU   is number of minutes different from Greenwich Mean Time. 

                if (installdate.Length==25)
                {
                    string yyyymmddHHMMSS = installdate.Split('.')[0];
                    string xxxxxxsUUU = installdate.Split('.')[1];      //±=s for sign

                    int year  = int.Parse(yyyymmddHHMMSS.Substring(0, 4));
                    int month = int.Parse(yyyymmddHHMMSS.Substring(4, 2));
                    int date  = int.Parse(yyyymmddHHMMSS.Substring(4 + 2, 2));
                    int hour  = int.Parse(yyyymmddHHMMSS.Substring(4 + 2 + 2, 2));
                    int mins  = int.Parse(yyyymmddHHMMSS.Substring(4 + 2 + 2 + 2,  2));
                    int secs  = int.Parse(yyyymmddHHMMSS.Substring(4 + 2 + 2 + 2 + 2, 2));
                    int msecs = int.Parse(xxxxxxsUUU.Substring(0, 6));

                    double UTCoffsetinMins = double.Parse(xxxxxxsUUU.Substring(6, 4));
                    TimeSpan UTCoffset = TimeSpan.FromMinutes(UTCoffsetinMins);

                    InstallDate = new DateTime(year, month, date, hour, mins, secs, msecs) + UTCoffset; 

                }
                break;
            }
            catch (Exception)
            {
                InstallDate = DateTime.Now; 
            }
        }
        return String.Format("{0:ddd d-MMM-yyyy h:mm:ss tt}", InstallDate);      
    } 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-08-10T00:55:47.260

使用 WMIC 确定 Windows 安装日期

wmic os 获取安装日期

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-10-16T13:38:33.600

来自 PowerShell 的非常简单的方法：

```
(Get-CimInstance -Class Win32_OperatingSystem).InstallDate 
```

摘自：[https ://www.sysadmit.com/2019/10/windows-cuando-fue-instalado.html](https://www.sysadmit.com/2019/10/windows-cuando-fue-instalado.html)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-04-23T21:23:29.250

使用规范。它在操作系统部分显示安装日期。 [http://www.piriform.com/speccy](http://www.piriform.com/speccy)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-08-23T18:16:53.940

您还可以检查系统驱动器中的任何文件夹，例如“Windows”和“程序文件”。右键单击文件夹，单击属性并在常规选项卡下检查文件夹的创建日期。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-11-14T13:40:43.233

在 RunCommand**`"MSINFO32"`**中写入并按 Enter 它将显示与系统相关的所有信息

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-08-25T15:00:04.427

您可以简单地检查 Windows 文件夹的创建日期（右键单击它并检查属性）:)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-11-17T14:41:45.060

在尝试了各种方法后，我认为系统卷的NTFS卷创建时间可能是最好的代理。虽然有工具可以检查这一点（请参阅[此链接](https://gist.github.com/grawity/1596864)），但我想要一种没有额外实用程序的方法。**我确定了“C:\System Volume Information”**的创建日期，它似乎在各种情况下都检查过了。

获取它的一行 PowerShell 是：

```
([DateTime](Get-Item -Force 'C:\System Volume Information\').CreationTime).ToString('MM/dd/yyyy') 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-01-17T02:58:24.493

按`WindowsKey`+`R`并输入`cmd`

在命令窗口中输入：

```
systeminfo | find /i "Original" 
```

*（对于旧版本的 Windows，请以全部大写字母键入“ORIGINAL”）。*

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-09-18T16:53:00.927

您可以使用 PowerShell 执行此操作：

```
Get-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\' -Name InstallDate |
    Select-Object -Property @{n='InstallDate';e={[DateTime]::new(1970,1,1,0,0,0,0,'UTC').AddSeconds($_.InstallDate).ToLocalTime()}} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-09-30T23:07:43.167

试试这个 powershell 命令：

```
Get-ChildItem -Path HKLM:\System\Setup\Source* | 
 ForEach-Object {Get-ItemProperty -Path Registry::$_} | 
     Select-Object ProductName, ReleaseID, CurrentBuild, @{n="Install Date"; e={([DateTime]'1/1/1970').AddSeconds($_.InstallDate)}} | 
         Sort-Object "Install Date" 
```

# javascript - Javascript图像调整大小

> ID：170624
> 
> 赞同：49
> 
> 时间：2008-10-04T16:39:31.553
> 
> 标签：javascript, internet-explorer-6, image-manipulation

有谁知道如何使用 JavaScript 按比例调整图像大小？

我试图通过添加属性`height`和动态修改 DOM `width`，但似乎在 IE6 上不起作用。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-04T16:47:26.577

要按比例修改图像，只需更改宽度/高度 css 属性之一，将另一个设置为自动。

```
image.style.width = '50%'
image.style.height = 'auto' 
```

这将确保其纵横比保持不变。

请记住，浏览器倾向于*很好*地调整图像大小 - 您可能会发现调整大小的图像看起来很糟糕。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-04T17:15:22.467

好的，它解决了，这是我的最终代码

```
if($(this).width() > $(this).height()) { 
 $(this).css('width',MaxPreviewDimension+'px');
 $(this).css('height','auto');
} else {
 $(this).css('height',MaxPreviewDimension+'px');
 $(this).css('width','auto');
} 
```

多谢你们

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-10-20T04:16:28.420

我在这里[回答](https://stackoverflow.com/a/14731922/382536)了这个问题：[如何按比例调整图像大小/保持纵横比？](https://stackoverflow.com/questions/3971841/how-to-resize-images-proportionally-keeping-the-aspect-ratio/14731922#14731922). 我在这里复制它是因为我真的认为这是一种非常可靠的方法:)

```
 /**
  * Conserve aspect ratio of the original region. Useful when shrinking/enlarging
  * images to fit into a certain area.
  *
  * @param {Number} srcWidth width of source image
  * @param {Number} srcHeight height of source image
  * @param {Number} maxWidth maximum available width
  * @param {Number} maxHeight maximum available height
  * @return {Object} { width, height }
  */
function calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight) {

    var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);

    return { width: srcWidth*ratio, height: srcHeight*ratio };
 } 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-04T16:44:52.667

与其修改图像的高度和宽度属性，不如尝试修改 CSS 高度和宽度。

```
myimg = document.getElementById('myimg');
myimg.style.height = "50px";
myimg.style.width = "50px"; 
```

一个常见的“陷阱”是高度和宽度样式是包含单位的字符串，例如上面示例中的“px”。

编辑 - 我认为直接设置高度和宽度而不是使用 style.height 和 style.width 应该可行。它还具有已经具有原始尺寸的优点。你能发布一些你的代码吗？您确定您处于标准模式而不是怪癖模式吗？

这应该有效：

```
myimg = document.getElementById('myimg');
myimg.height = myimg.height * 2;
myimg.width = myimg.width * 2; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-04T16:52:47.457

尝试了以下代码，在 WinXP Pro SP3 上的 IE6 上运行良好。

```
function Resize(imgId)
{
  var img = document.getElementById(imgId);
  var w = img.width, h = img.height;
  w /= 2; h /= 2;
  img.width = w; img.height = h;
} 
```

在 FF3 和 Opera 9.26 中也可以。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-12-18T17:21:27.433

示例：如何使用百分比调整大小

```
<head>
    <script type="text/javascript">
        var CreateNewImage = function (url, value) {
            var img = new Image;
            img.src = url;
            img.width = img.width * (1 + (value / 100));
            img.height = img.height * (1 + (value / 100));

            var container = document.getElementById ("container");
            container.appendChild (img);
        }
    </script>
</head>
<body>
    <button onclick="CreateNewImage ('http://www.medellin.gov.co/transito/images_jq/imagen5.jpg', 40);">Zoom +40%</button>
    <button onclick="CreateNewImage ('http://www.medellin.gov.co/transito/images_jq/imagen5.jpg', 60);">Zoom +50%</button>
    <div id="container"></div>
</body> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-03-28T14:29:51.913

这适用于所有情况。

```
function resizeImg(imgId) {
    var img = document.getElementById(imgId);
    var $img = $(img);
    var maxWidth = 110;
    var maxHeight = 100;
    var width = img.width;
    var height = img.height;
    var aspectW = width / maxWidth;
    var aspectH = height / maxHeight;

    if (aspectW > 1 || aspectH > 1) {
        if (aspectW > aspectH) {
            $img.width(maxWidth);
            $img.height(height / aspectW);
        }
        else {
            $img.height(maxHeight);
            $img.width(width / aspectH);
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-03-15T21:13:00.650

你不必用 Javascript 来做。您可以创建一个 CSS 类并将其应用于您的标签。

```
.preview_image{
        width: 300px;
    height: auto;
    border: 0px;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-03-08T21:34:21.767

使用 jQuery

```
var scale=0.5;

minWidth=50;
minHeight=100;

if($("#id img").width()*scale>minWidth && $("#id img").height()*scale >minHeight)
{
    $("#id img").width($("#id img").width()*scale);
    $("#id img").height($("#id img").height()*scale);
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-01-19T07:27:34.967

试试这个..

```
<html>
<body>
<head>
<script type="text/javascript">
function splitString()
{
var myDimen=document.getElementById("dimen").value;
var splitDimen = myDimen.split("*");
document.getElementById("myImage").width=splitDimen[0];
document.getElementById("myImage").height=splitDimen[1];
}
</script>
</head>

<h2>Norwegian Mountain Trip</h2>
<img border="0" id="myImage" src="..." alt="Pulpit rock" width="304" height="228" /><br>
<input type="text" id="dimen" name="dimension" />
<input type="submit" value="Submit" Onclick ="splitString()"/>

</body>
</html> 
```

在文本框中按照您的意愿给出尺寸，格式为 50*60。点击提交。您将获得调整大小的图像。用你的图片路径代替图片标签中的点。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-23T16:06:43.207

```
function resize_image(image, w, h) {

    if (typeof(image) != 'object') image = document.getElementById(image);

    if (w == null || w == undefined)
        w = (h / image.clientHeight) * image.clientWidth;

    if (h == null || h == undefined)
        h = (w / image.clientWidth) * image.clientHeight;

    image.style['height'] = h + 'px';
    image.style['width'] = w + 'px';
    return;
} 
```

只需将 img DOM 元素或图像元素的 id 以及新的宽度和高度传递给它。

或者您可以仅传递宽度或仅传递高度（如果仅传递高度，则将宽度传递为空或未定义），它将调整大小保持纵横比

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-07-08T16:19:09.917

在 javascript 中调整图像大小：

```
$(window).load(function() {
mitad();doble();
});
function mitad(){ 

    imag0.width=imag0.width/2;
    imag0.height=imag0.height/2;

    }
function doble(){ 
  imag0.width=imag0.width*2; 
  imag0.height=imag0.height*2;} 
```

imag0 是图像的名称：

```
 <img src="xxx.jpg" name="imag0"> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-07-01T08:16:38.510

这是我的封面填充解决方案（类似于 background-size:cover，但它支持旧的 IE 浏览器）

```
<div class="imgContainer" style="height:100px; width:500px; overflow:hidden; background-color: black">
    <img src="http://dev.isaacsonwebdevelopment.com/sites/development/files/views-slideshow-settings-jquery-cycle-custom-options-message.png" id="imgCat">
</div>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.3.min.js"></script>
<script>
    $(window).load(function() {
        var heightRate =$("#imgCat").height() / $("#imgCat").parent(".imgContainer").height();
        var widthRate = $("#imgCat").width() / $("#imgCat").parent(".imgContainer").width();

        if (window.console) {
            console.log($("#imgCat").height());
            console.log(heightRate);
            console.log(widthRate);
            console.log(heightRate > widthRate);
        }
        if (heightRate <= widthRate) {
            $("#imgCat").height($("#imgCat").parent(".imgContainer").height());
        } else {
            $("#imgCat").width($("#imgCat").parent(".imgContainer").width());
        }
    });
</script> 
```

# java - Eclipse plugin manifest problem - empty package inconsistency between mac and PC

> ID：170635
> 
> 赞同：0
> 
> 时间：2008-10-04T16:47:15.643
> 
> 标签：java, eclipse, plugins, manifest

I am developing a collection of plugins on Eclipse 3.4 (official) on both mac and a PC.

At present (I'm aware it is not the best practice) some of my common plugins export all of their packages.

The problem is this: many of the listed packages are empty because subpackages are not, for example: prefix.core may be empty while prefix.core.model may not be.

Even though I use the same manifest file, having the empty packages listed on one platform raises an error in the manifest file on the other platform. If I omit the packages in that platform, then when I come to the other platform I'm told that the plugin does not export everything.

Any idea what is going on? I have no idea why there would be differences between the PC and the Mac on a non-UI related issue. The only significant difference is that the mac is running Java 5 (still not Eclipse for Java 6) while the PC is running Java 6, but the manifests should have nothing to do with it.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T19:19:29.420

如果您要跨多台机器和平台开发插件，那么使用相同版本的 JVM 通常是一个好习惯。

如果您要在 PC 上构建插件并希望它们在 Mac 上运行，您应该在 Java 5 上进行标准化。您可以通过转到 Window->Preferences->Installed JREs 轻松安装和添加额外的 JRE 到 Eclipse。如果您不希望 PC Java 编码的其余部分使用 5，您甚至可以配置每个项目和启动配置使用的 JRE。

如果这也解决了您的清单问题，我不会感到惊讶。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T15:03:15.053

问题可能是插件开发首选项中设置的错误/警告级别。可能是您在两台机器上都有不同的设置，这会产生问题。

在 Preferences -> Plug-in Development -> Compilers 下，有几个关于不同问题的错误和警告级别的选项，例如对不存在的资源的引用。您可能会发现有什么不同吗？

# database - 为什么面向对象的数据库还没有成功（还）？

> ID：170649
> 
> 赞同：20
> 
> 时间：2008-10-04T17:06:03.373
> 
> 标签：database, orm, rdbms, object-oriented-database

这就是问题所在。只给出一个你认为为什么 OODB 失败或者为什么现在许多系统仍然使用关系数据库的原因。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-04T17:13:46.463

主要原因是SQL。能够在应用程序之外的其他上下文中使用数据库中的数据是非常有用的，并且通常对于对象数据库，数据以不容易查询的格式存储。例如，使用关系数据库，数据可以成为数据仓库的一部分，或者只是由系统管理员查询等。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-04T17:21:10.067

我们可以回答不止一次吗？另一个原因是关系数据库在数学上有坚实的基础：从关系的定义，一直到范式，理论都是坚如磐石的。确实，关系模型不能很好地映射到 OO，但恕我直言，该模型的好处和稳定性超过了映射问题。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-04T17:39:57.283

我认为这是因为“对象数据库”正在解决（几乎）没有人真正遇到的问题。对于对象图的简单持久性，大多数 OO 环境中内置的序列化“足够好”。如果您想对数据的子集进行复杂的操作，那么关系数据库和 SQL 是完美的选择。

除了一些边缘应用程序（不能保存在内存中的巨大对象图，但关系不能很好地简化以供 RDBMS 使用）之外，确实不需要这些工具。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-04T17:22:48.893

仅仅因为 OODB 不是主流，我们仍然应该考虑他们已经取得的成功。Cache 和 Zope 都被广泛使用（相对而言），但按照某些标准会被认为是成功的。

也许 OODB 没有显着占据主导地位的最大原因是混合对象关系系统的成功，这些系统从 OODB 中占据了大部分潜在市场份额：PostgreSQL 和 Informix。

我知道这并不能直接回答这个问题，但我认为它是等式的一部分。但总的来说，我认为支持关系数据库的势头和根深蒂固的思维过程使人们很难转换。目前，DB 专业几乎只接受过关系理论方面的培训，这使得您的 DB 专业人员对避免 OODB 非常感兴趣，而学术界几乎专门为从业者教授关系理论方面的 DB 理论。

在大型企业 DBA 和主流教授和课程以及开发人员以外的人员准备好管理 OODB 之前，我觉得无论从开发方面有多好，都不太可能看到大众吸引力。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-06T04:12:21.937

嗯，很奇怪不是吗？作为面向对象分析和设计的顶峰，对领域驱动设计的推动如此之大，并且有企业模式可以利用 ORM 系统来持久化我们的对象。对我来说，如果您的应用程序设计本质上是面向对象且以领域为中心的，那么 OODB 将极大地有益于您的应用程序，这对我来说完全有意义。

除了围绕成熟度和采用的问题之外，从哲学的角度来看，OODB 似乎是有益的或 OO 应用程序。不必为初学者维护该映射层；）

但是看，如果您不进行域驱动设计并将对象用作数据对象并且像您的存储过程一样，那么您就不会真正得到它；）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-04T17:45:03.047

RDBM（建立在强大的理论基础上，在市场上存在的时间要长得多，在许多情况下可以比 OODB 更忠实地建模数据，比 OODB 可以被更多的 DBA 使用）。这是关系元组形式的原因之一。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-04T17:18:05.563

如果我可以放大 Phil 的观点：SQL 的标准化。OODB 曾尝试过诸如 OQL 之类的查询语言，但它们似乎从未遵循真正的标准。查询语言的质量也令人怀疑，可以说是由于缺乏标准化。标准促进竞争，从而产生质量。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-28T02:50:43.170

原因之一是数据库是关于数据的，而对象是关于结构和算法的。一旦获取数据并将其嵌入类中，您就可以在静态结构中描述关系和操作。另一方面，数据库是将数据解构为一堆原子表实例，这些原子表可以重新组装成不同的结构（通常带有类），而不会干扰原子的完整性。

数据库有点类似于六边形。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-04T17:18:07.653

那，还有 o/r-mappers。通过它们，与真正的 OO-DB 的差异变得更小，而上述好处仍然有效。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-05-10T23:22:43.107

昂贵的技术决策不是由具有技术知识的人做出的。使用关系数据库的公司雇佣了很多人，他们感到受到 OODB 的威胁，因此会避免了解它们。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-04T19:04:44.880

我认为有两个哲学原因。

首先，人们传统上倾向于将持久性与实际功能分开。一旦你把一个对象的“生命”从它身上剥离出来，并主要为了持久性而保留它，它就变成了一个记录，然后就有一种将它视为“没有生命”的数据对象的趋势。

此后，当人们想到大量非常相似的事物时，他们开始将它们视为表格而不是对象。

我认为 O/R 的区别开始消失。例如，我使用 hibernate 将非常复杂的类层次结构转储到 MySQL 数据库中。但是，我不会为我的项目编写性能关键的东西，所以我确信它没有有效地完成。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-10-30T22:16:54.153

OODB 采用缓慢的原因主要基于使关系 SQL 数据库更流行和/或更合适的几个关键因素。虽然纯面向对象的数据库现在处于克服关系模型的许多缺点的状态，但仍然缺少一些关键部分。

一方面，他们往往缺乏对中央数据库管理的支持，尽管这正在迅速在各种产品中得到纠正。

第二个原因是很少有系统实现标准查询语言，而是依赖编程语言或专门的查询语言来检索和操作存储中的数据。如果他们必须在程序员习惯于基于 NoSQL 的解决方案的完全不同的思维方式之上学习一种新的查询语言，那么这对许多人来说是一个阻碍。最重要的是，大多数基于 SQL/关系的数据库现在都支持面向对象的设计，此外，我们还有像 ORM 这样的包装器，许多人使用这些包装器来“绕过”关系数据库在所选编程语言中不易使用的问题。

但这些问题大多存在于企业环境中。作为小型设备中的嵌入式数据库、网站存储以及航空航天等领域，它们已经变得非常流行，并且在许多情况下完全取代了对常规关系数据库的需求。

谁知道未来会怎样？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-02-18T19:21:07.930

大多数语言提供的序列化使您可以展平对象属性，从而轻松地将它们存储到 RDBMS 中，并且类似地检索对象并不是一个大问题。仍然缺乏广泛而坚实的基础，这阻碍了OODBMS的使用得以实施。

我目前正在考虑将其作为我的硕士论文项目，为 OODBMS 提供一个通用框架，该框架支持现在 RDBMS 中常用的几乎所有组件，从而提供非线性结构化 DBMS。在学习期间，我遇到了一个名为 db4o 的项目，它是一种仅将 OODBMS 用于 Java 和 .net 的方法（已实现），因此这可能是所有类型的平台和语言缺乏通用性的另一个原因。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2011-06-15T11:39:23.500

我认为这是因为像甲骨文这样的大公司一直在投资关系数据库，而面向对象的运动正在获得动力……如果甲骨文/微软大举投资，它们可能会成为主流……这似乎不太可能，因为他们没有没有充分的理由这样做……它会简化许多程序员的生活……但是“让程序员的生活更简单”对他们来说并不是一个很好的商业目标！

# .net - Windows 窗体应用程序中的富文本

> ID：170650
> 
> 赞同：4
> 
> 时间：2008-10-04T17:06:30.423
> 
> 标签：.net, wpf, winforms

我想更新 Windows 窗体应用程序以提供以下功能：

*   拼写检查
*   有限的文本格式：粗体、斜体、项目符号列表

理想情况下，格式化文本可以以纯文本方式访问，以便通过不支持格式化的工具进行报告，但也可以在呈现文本时为支持 HTML 标记的工具呈现为 HTML。

在我看来，WPF RichTextBox 将提供此功能。合并它的最佳方法是什么？您会建议其他替代方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T17:31:02.277

您可以为 Window Forms RichTextBox 添加/创建一个插入式拼写检查器。

一个准备就绪的带有拼写检查的[richtextbox](http://www.c-sharpcorner.com/UploadFile/scottlysle/SpellCheckCC05152007084528AM/SpellCheckCC.aspx)自定义控件。一个可以轻松集成的[拼写检查](http://www.codeproject.com/KB/string/netspell.aspx)应用程序

[这里](http://www.c-sharpcorner.com/UploadFile/mahesh/WPFRichTextBox09072008194855PM/WPFRichTextBox.aspx)还有一篇关于将 WPF RichTextBox 添加到您的应用程序以及让拼写检查工作的文章。（需要 .NET 3.0+）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-06T07:10:47.053

我~~还没有检查~~它是否可以在 RichTextBox 中工作，但它应该......尝试以下附加属性

```
<TextBox SpellCheck.IsEnabled="True" /> 
```

[在此处](http://dotnet.org.za/rudi/archive/2007/11/01/spell-check-in-wpf-text-controls.aspx)阅读有关此的更多信息

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T17:09:13.040

Windows 窗体也有一个 RichTextBox。如果您在 Windows 窗体应用程序中，则合并它比合并 WPF 控件更容易。

# ruby - Ruby/QT 的库错误

> ID：170653
> 
> 赞同：3
> 
> 时间：2008-10-04T17:07:31.203
> 
> 标签：ruby, qt, qt4, kde4

尝试创建`QtRuby`应用程序时，出现以下错误：

```
/usr/lib64/ruby/site_ruby/1.8/Qt/qtruby4.rb:2144: [BUG] Segmentation fault
ruby 1.8.6 (2008-03-03) [x86_64-linux] 
```

我正在运行带有和`64-bit`的 Novell OpenSUSE 11 版本`DKE4``Qt`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T17:08:26.223

问题在于：需要'Qt'

由于 64 位库，您需要使用：

需要'korundum4'

参考：[http ://www.sheepguardingllama.com/?p=2661](http://www.sheepguardingllama.com/?p=2661)

# mysql - 我可以在我的网站前面放置一个缓存服务器吗？

> ID：170660
> 
> 赞同：4
> 
> 时间：2008-10-04T17:10:42.240
> 
> 标签：mysql, database, apache, caching

我有一个使用 apache httpd 作为服务器和 mysql 作为后端的网站。它发布了一个“当天的想法”，该想法非常受欢迎，以至于服务器由于请求的数量而崩溃。既然请求的是同一个页面（思想一天只变一次），是否可以在我的主服务器前面放一个缓存服务器，这样当不同客户端发出相同请求时，缓存服务器返回该页面无需访问数据库？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-04T19:28:40.713

对于变化缓慢的页面，缓存肯定会降低 CPU 使用率；但在您的极端情况下，页面每天更改一次，并且完全可以预测，使用简单快速的静态文件服务器（[lighthttp](http://www.lighttpd.net/)，[nginx](http://nginx.net/)等）和 cron 作业来改变您的“想法”会容易得多白天”每晚。

事实上，很多非交互式网页都可以这样完成：定期从数据库或任何其他来源重建 html 文件，并使用简单、快速的静态 Web 服务器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T17:14:10.253

绝对地。有许多产品可以很好地解决这个问题。Apache 本身可以配置为以这种方式运行，但如果您在 Linux 或 UNIX 上，Squid 是更好的选择，因为它是专门为完成这项工作而设计的。

在 Windows 上，MS 一直提供可以执行此功能的缓存/代理产品。目前这是 ISA Server 2006。虽然这对于这种类型的应用程序来说太过分了。

[鱿鱼](http://www.squid-cache.org/)是我的推荐。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T17:23:00.233

是的。您正在谈论反向代理（或“http 加速器”，这是对同一事物的不精确术语）。它可以*非常*有效，并且非常多的高吞吐量站点使用该技术。

正确的关键要素是与缓存相关的 HTTP 标头。所以我强烈推荐阅读HTTP RFC（实际上可以做到）。如果您没有正确获取标题，您可能会产生很小的影响，甚至可能会出现安全问题（如果个性化页面被缓存并呈现给错误的人）。

另外：您可能必须将页面拆分为多个部分，以获得最佳缓存效果。示例：如果您坚持在页面的角落放置一个时钟，将当前服务器时间精确到秒，那么整个页面只能缓存一秒。所以 1) 放弃愚蠢的时钟，或者 2) 让它由客户端脚本生成 - 或者 3) 让客户端脚本从一个特殊的 URL 中拉出页面的特定部分，然后只输出一个小的不断变化的, 不可缓存的 HTML 片段。

我曾经使用 Squid 作为大型网站的反向代理。如今，如果我要再做一次，我会尝试[Varnish](http://varnish.projects.linpro.no/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T19:59:17.767

我肯定会推荐 Javier 的解决方案，它是最简单、最强大且最容易维护的。只是不要忘记在未来 24 小时内发送正确的 Expires 标头并正确设置 ETag。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-04T23:42:03.760

如果您的“当天思考”页面除了每天一次之外从未改变，那么简单的事情就是每天启动一次类似的东西

wget [http://your_site/your_page.php](http://your_site/your_page.php) -O /var/www/your_site_directory/your_page.html

（并将此页面的链接从 your_page.php 更改为 your_page.html）

然后，您将减少 apache 服务器和 SQL 服务器的负载...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T17:23:41.497

您也可以尝试[memcached](http://www.danga.com/memcached/)。这就是我的公司使用的，我认为 LiveJournal 也使用它。它缓存数据库请求并严重影响数据库访问。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-04T23:57:12.013

我完全同意[Javier 的建议](https://stackoverflow.com/questions/170660/can-i-put-a-caching-server-in-front-of-my-web-site#170893)（生成静态网页）。我只想补充一点以澄清一下：

将静态文件存储为“.html”，而不是“.php”或用于从数据库中提取数据的任何语言。使用静态文件比启动解析器或可执行文件要快得多**。**静态文件（HTML、GIF、...）只是在脚本、CGI 和所有其他东西被启动、解析、执行和其他任何东西时被传递到网络......这将需要比**真正的**静态文件更多的服务器资源。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-05T00:03:57.257

静态文件只是将 I/O 作为开销。缓存在内存中的对象很棒，但您仍然需要管理这些对象的开销，并且在大量使用时，这变得很棘手。因此静态文件的易用性和美观性。

另一个好处是您可以让不属于 Web 服务器线程的进程执行更新和维护。如果您更新服务锁，您将不会锁定您的 Web 服务器。

# java - 你如何在 Java 中设计一个好的 permgen 空间字符串？

> ID：170663
> 
> 赞同：1
> 
> 时间：2008-10-04T17:12:24.123
> 
> 标签：java, jvm, permgen

我想知道您将如何在 Java 中设计一个好的 permgen 空间字符串。根据我的研究和理解，我想出了以下几点：

例子：`JAVA_OPTS='-Xmx512m -XX:MaxPermSize=256m -server -Djava.awt.headless=true'`

抱歉，当我第一次发布问题时，示例没有粘贴......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-04T18:28:43.300

我对这个问题也有点不清楚，但如果你的意思是什么是用于最大 permgen 大小的好数字，这将取决于你的应用程序和加载的类/方法的数量。为了帮助确定它们，您可以使用其典型和最密集的用例运行您的应用程序，并使用 JConsole 并查看您的应用程序最终使用什么。

[JConsole](http://java.sun.com/developer/technicalArticles/J2SE/jconsole.html)可以显示所有堆和永久代空间，因此您可以通过这种方式确定 MaxPermSize 所需的数量。由于它是类+方法数据，它将取决于您的应用程序加载了多少类，而不是多少实例。请注意，它也与堆大小分开（事实上，JConsole 将内存使用分类为非堆内存使用）。在我链接的 JConsole 页面上，见图 5。它是最右侧的非堆，可以单击。

在 Java 6 中，应用程序将允许来自 JConsole 的连接，无需额外配置。在 Java 5 中，您可能需要设置一些标志。它包含在 JDK 中。

作为参考，对于加载了大约 10,000 个类的应用程序，我们的 MaxPermSize 为 96m

# c# - 用于从字符串安全转换的辅助函数

> ID：170665
> 
> 赞同：10
> 
> 时间：2008-10-04T17:13:21.253
> 
> 标签：c#, vb6, type-conversion

回到 VB6，我编写了一些函数，让我无需关心字符串的 null 和 '' 、数字的 null 和 0 等之间的区别。在编码时，没有什么比添加特殊情况更能降低我的工作效率了处理可能导致一些不相关错误的数据的代码；9999/10000 如果我用作数字的东西是空的，那么我真的把它当作 0。

我现在在 C# 中，VB6 和 C# 2005 之间的区别非常广泛......所以我真的不知道从哪里开始编写我的新辅助函数集，或者我什至是否需要这样做.

因此，我需要编写一个函数来接受字符串、数据库字段、请求表单/查询字段、???，然后尽其所能将其转换为 Double，并将其返回给调用过程.

我还需要为短裤、int16、int32、long 以及我可能关心的所有其他东西执行此操作。

然后我会为字符串做这个。和日期。

这是值得追求的吗？我可以使用框架或 C# 中的某些内容吗？我真的想要一些可以让我在调用其他函数时使用内联数据，而不必创建临时变量等的东西。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-04T17:41:41.883

内置了许多转换功能。但是...我不确定他们中的任何一个都完全按照您的意愿行事。通常，.NET 方法在传递无效输入时会谨慎行事，并引发异常。

幸运的是，您可以轻松地编写一个实用方法来将数值、空字符串或空字符串的字符串表示形式转换为任何输出类型：

```
public static T SafeConvert<T>(string s, T defaultValue)
{
    if ( string.IsNullOrEmpty(s) )
        return defaultValue;
    return (T)Convert.ChangeType(s, typeof(T));
} 
```

采用：

```
SafeConvert(null, 0.0) == 0.0;
SafeConvert("", 0.0) == 0.0;
SafeConvert("0", 0.0) == 0.0; 
```

此泛型方法从第二个参数的类型中获取其返回类型，当传递的字符串为 null 或空时，将其用作默认值。通过`0`，你会得到一个`In32`背部。通过`0L`，`Int64`。等等...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-04T17:35:08.493

在 C# 中，大多数数据类型都不可为空（数字、日期等），只有字符串可以为空。如果您从数据库中获取数据，那么您可能会使用[Nullable](http://msdn.microsoft.com/en-us/library/b3h38hb0.aspx)或其语法糖化版本、int?、double?、DateTime? 等。

所有可空对象都有[一个方法](http://msdn.microsoft.com/en-us/library/58x571cw.aspx)可以让您获取它们的实际值，如果它们为空，则可以使用默认值。这应该可以帮助您避免创建这些函数。

至于字符串，你有 String.IsNullOrEmpty(str) 函数。

如果您想要一些特殊的不可用功能，您还可以[添加扩展方法。](http://msdn.microsoft.com/en-us/library/bb383977.aspx)请注意，扩展方法可以应用于空值，只要您在代码中处理它。例如：

```
public static string ValueOrDefault(this string str) 
{
     if (String.IsNullOrEmpty(str)) return MY_DEFAULT_VALUE;
     else return str;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T17:37:15.073

.NET 库中有一个名为 Convert 的类。它具有允许您从任何基本类型和一些常见类（如 DateTime）转换为所需的任何功能的功能。

它基本上像 Convert.ToInt32(val);

编辑：我真的需要学会阅读所有的单词。没有担心 null ......有一个操作员。你可以使用?? 检查 null 并提供默认值，以便可能工作。

您可能还想查看 LINQ，它为您处理了很多此类映射。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-11-21T04:08:22.520

我认为它类似于@Shog9。我只是添加了一个 try catch 来处理用户异常输入。我发送要转换输入的类型并将输入作为对象。

```
public static class SafeConverter
{
   public static T SafeConvert<T>(object input, T defaultValue)
   {
       if (input == null)
          return defaultValue; //default(T);

       T result;
       try
       {
           result = (T)Convert.ChangeType(input.ToString(), typeof(T));
       }
       catch
       {
          result = defaultValue; //default(T);
       }
       return result;
   }
} 
```

现在像下面这样称呼他们

```
SafeConverter.SafeConvert<ushort>(null, 0);
SafeConverter.SafeConvert<ushort>("", 0);
SafeConverter.SafeConvert<ushort>("null", 0);
SafeConverter.SafeConvert<ushort>("-1", 0);
SafeConverter.SafeConvert<ushort>("6", 0);
SafeConverter.SafeConvert<ushort>(-1, 0);
SafeConverter.SafeConvert<ushort>(0, 0);
SafeConverter.SafeConvert<ushort>(1, 0);
SafeConverter.SafeConvert<ushort>(9, 0); 
```

# c++ - What is the best open XML parser for C++?

> ID：170686
> 
> 赞同：250
> 
> 时间：2008-10-04T17:21:35.340
> 
> 标签：c++, xml, open-source

I am looking for a simple, clean, correct XML parser to use in my C++ project. Should I write my own?

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-10-04T19:49:20.970

[**RapidXML**](http://rapidxml.sourceforge.net/)怎么样？RapidXML 是一个用 C++ 编写的非常快速和小型的 XML DOM 解析器。它主要针对嵌入式环境、计算机游戏或任何其他可用内存或 CPU 处理能力非常宝贵的应用程序。RapidXML 在 Boost Software License 下获得许可，其源代码可免费获得。

**特征**

*   解析速度（包括 DOM 树构建）接近在相同数据上执行的 strlen 函数的速度。
*   在现代 CPU（截至 2008 年）上，解析器吞吐量约为每秒 10 亿个字符。请参阅在线手册中的性能部分。
*   代码和创建的 DOM 树的内存占用小。
*   仅包含标头的实现，简化了集成过程。
*   简单的许可证，几乎可以用于任何目的，包括商业和非商业目的，没有任何义务。
*   支持 UTF-8 和部分 UTF-16、UTF-32 编码。
*   除了非常小的 C++ 标准库子集之外，没有依赖项的可移植源代码。
*   这个子集非常小，如果不希望使用标准库，可以很容易地手动模拟。

**限制**

*   解析器忽略 DOCTYPE 声明。
*   不支持 XML 命名空间。
*   解析器不检查字符有效性。
*   解析器的接口不符合 DOM 规范。
*   解析器不检查属性唯一性。

来源：[wikipedia.org ://Rapidxml](http://en.wikipedia.org/wiki/Rapidxml)

* * *

根据您的使用情况，您可能会使用 XML 数据绑定？[**CodeSynthesis XSD**](http://www.codesynthesis.com/products/xsd/)是由 Code Synthesis 开发的用于 C++ 的 XML 数据绑定编译器，并在 GNU GPL 和专有许可下获得双重许可。给定一个 XML 实例规范（XML Schema），它会生成代表给定词汇表以及解析和序列化代码的 C++ 类。

CodeSynthesis XSD 的独特功能之一是它支持两种不同的 XML Schema 到 C++ 的映射：内存中 C++/Tree 和面向流的 C++/Parser。C++/Tree 映射是具有树状内存数据结构的传统映射。C++/Parser 是一种新的、类似 SAX 的映射，它将存储在 XML 实例文档中的信息表示为特定于词汇表的解析事件的层次结构。与 C++/Tree 相比，C++/Parser 映射允许处理不适合内存的大型 XML 文档、执行面向流的处理或使用现有的内存中表示。

来源：[wikipedia.org://CodeSynthesis XSD](http://en.wikipedia.org/wiki/CodeSynthesis_XSD)

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2010-08-01T03:27:40.743

[pugixml](https://github.com/zeux/pugixml "pugixml") - 用于 C++ 的轻量级、简单和快速的 XML 解析器非常小（与 RapidXML 相当），非常快（与 RapidXML 相当），非常易于使用（比 RapidXML**更好**）。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2008-10-04T17:22:55.897

Try TinyXML.

[http://sourceforge.net/projects/tinyxml](http://sourceforge.net/projects/tinyxml)

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-04T18:27:22.040

[TiCPP](http://code.google.com/p/ticpp/)是 TinyXML 的“更多 c++”版本。

> 'TiCPP' 是官方名称 TinyXML++ 的缩写。[它是 TinyXML ( http://www.grinninglizard.com/tinyxml/](http://www.grinninglizard.com/tinyxml/) )的全新接口，它使用了许多 C++ 优势。模板、异常和更好的错误处理。它在 doxygen 中也有完整的记录。这真的很酷，因为这个版本让您可以像以前一样使用微小的接口，或者您可以选择使用新的“ticpp”类。您需要做的就是定义 TIXML_USE_TICPP。它已经在 VC 6.0、VC 7.0、VC 7.1、VC 8.0、MinGW gcc 3.4.5 和 Linux GNU gcc 3+ 中进行了测试

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2010-08-18T09:55:15.687

试试这个： http: [//www.applied-mathematics.net/tools/xmlParser.html](http://www.applied-mathematics.net/tools/xmlParser.html)
它比 RapidXML 或 PUGXML 更容易和更快。
TinyXML 是“简单解析器”中最差的。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-04T19:48:09.303

如果您担心效率/内存管理（它往往会分配*很多*小块），请不要使用 TinyXML。我个人最喜欢的是[RapidXML](http://rapidxml.sourceforge.net/)。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2010-05-12T19:23:11.380

[gSOAP](http://sourceforge.net/projects/gsoap2 "gSOAP")怎么样？它是开源的，在 GPL 许可下免费提供。尽管名称如此，gSOAP 工具包是一个通用的 XML 数据绑定工具，它允许您将 C 和 C++ 数据自动绑定到 XML。无需使用 XML 解析器 API，只需让它为您读取/写入 XML 格式的数据。如果你真的需要一个超级简单的 C++ XML 解析器，那么 gSOAP 可能是一个矫枉过正的选择。但对于其他所有方面，自 2001 年引入 gSOAP 以来，它在许多工业应用中都表现良好。

以下是功能的简要列表：

*   便携：Windows、Linux、Mac OS X、Unix、VxWorks、Symbian、Palm OS、WinCE等。
*   占用空间小：73KB 代码和不到 2K 的数据来实现 XML Web 服务客户端应用程序（没有 DOM 来限制内存使用）。
*   快：不要相信其他工具所说的，真正的速度应该**用**I/O 来衡量。对于 gSOAP，它有超过 3000 条 TCP/IP 上的往返 XML 消息。XML 解析开销可以忽略不计，因为它是在进行（反）序列化时对输入/输出进行简单的线性扫描。
*   XML 支持：XML 模式 (XSD) 导入/导出、WSDL 导入/导出、XML 命名空间、XML 规范化、带附件的 XML (MIME)、DOM 的可选使用、生成带有缩进的 XML 的许多选项、使用 UTF8 字符串等。
*   XML 验证：部分和全部（选项）
*   WS 支持：WS-Security、WS-ReliableMessaging、WS-Addressing、WS-Policy、WS-SecurityPolicy 等。
*   调试：集成内存管理与泄漏检测、日志记录。
*   API：无需学习 API，只需“soap”引擎上下文初始化，然后使用读/写接口来处理您的数据，以及“soap”引擎上下文销毁。

例如：

```
class Address
{ 
  std::string name;
  std::vector<LONG64> number;
  time_t date;
}; 
```

然后在上面的类声明上运行“soapcpp2”，生成`Address`XML读写器，例如：`soap_read_Address``soap_write_Address`

```
Address *a = new Address();
a = ...;
soap ctx = soap_new();
soap_write_Address(ctx, a);
soap_end(ctx);
soap_free(ctx);` 
```

这会生成`Address a`对象的 XML 表示。通过使用 XML 命名空间详细信息（此处未显示）注释头文件声明，这些工具还生成模式。这是一个简单的例子。gSOAP 工具可以处理非常广泛的 C 和 C++ 数据类型，包括基于指针的链接结构甚至（循环）图（而不仅仅是树）。

希望这可以帮助。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-10-04T17:30:15.960

TinyXML 最适合简单的 XML 工作，但如果您需要更多功能，请尝试 apache 项目中的 Xerces。转到下一页以了解有关其功能的更多信息。

[http://xerces.apache.org/xerces-c/](http://xerces.apache.org/xerces-c/)

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2010-09-09T11:45:13.633

我是 C++**新手**，在此页面上尝试了几个不同的建议后，我必须说我最喜欢[pugixml](http://code.google.com/p/pugixml/)。它具有易于理解的文档和我一直在寻找的高级 API。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-10-04T18:49:23.493

TinyXML，还有 Boost.PropertyTree。后者不满足所有官方要求，但非常简单。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-10-04T17:59:51.347

我喜欢 Gnome xml 解析器。它是开源的（MIT 许可证，因此您可以在商业产品中使用它）、速度快并且具有基于 DOM 和 SAX 的接口。

[http://xmlsoft.org/](http://xmlsoft.org/)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-04T17:27:05.453

Try [TinyXML](http://sourceforge.net/projects/tinyxml) or [IrrXML](http://www.ambiera.com/irrxml/)...Both are lightweight XML parsers ( I'd suggest you to use TinyXML, anyway ).

# c# - 实体框架的行级安全性

> ID：170689
> 
> 赞同：11
> 
> 时间：2008-10-04T17:22:53.650
> 
> 标签：c#, database, security, entity-framework, row-level-security

我一直在尝试考虑如何使用实体框架实现行级安全性。这个想法是有一个数据库不可知的手段，它将提供方法来限制来自 ObjectContext 的行。

我最初的一些想法涉及修改由 EDMGEN 工具创建的部分类，这提供了一些有限的支持。用户仍然可以通过使用他们自己的 eSQL 语句和 QueryObject 来绕过这个解决方案。

我一直在寻找一个存在于数据库提供者之上的综合解决方案，以便它保持不可知论。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-08T13:24:21.790

当然你可以做到。要做的重要事情是阻止对对象上下文的直接访问（防止用户构建自己的 ObjectQuery），而是为客户端提供一个更窄的网关来访问和改变实体。我们使用[Entity Repository 模式](http://www.martinfowler.com/eaaCatalog/repository.html)来做到这一点。你可以找到一个[](http://codeinsanity.com/archive/2008/08/11/the-repository-pattern.aspx "The Repository Pattern...">此博客文章中实体框架的此模式的示例实现</a>。同样，关键是阻止对对象上下文的访问。请注意，对象上下文类是部分的。所以你应该能够阻止")

[但是，有一些微妙之处需要考虑。如果您通过存储库模式在某个实体类型上实现行级视图安全性，那么您必须考虑客户端可以访问相同实体的其他方式。例如，通过导航关系。您可能需要将其中一些关系设为私有，您可以在模型中执行此操作。您还可以选择](http://codeinsanity.com/archive/2008/08/11/the-repository-pattern.aspx "The Repository Pattern...">此博客文章中实体框架的此模式的示例实现</a>。同样，关键是阻止对对象上下文的访问。请注意，对象上下文类是部分的。所以你应该能够阻止")为加载/保存实体[指定自定义查询或存储过程。](http://msmvps.com/blogs/matthieu/archive/2008/10/01/ef-how-to-do-a-recursive-include.aspx "EF：如何进行递归包含？")存储过程往往是特定于数据库服务器的，但可以以通用方式编写 SQL。

虽然我不同意实体框架无法做到这一点，但我同意“在数据库服务器上执行”评论，因为您应该实施[深度防御](http://en.wikipedia.org/wiki/Defense_in_Depth_(computing))。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T18:30:21.720

您添加安全性的地方实际上取决于您要保护的对象。

例如，如果您要保护网站，那么在上下文级别添加过滤就足够了，因为在这种情况下，“用户”在网站上。他们别无选择，只能通过您的上下文，因为您将完全根据上下文编写应用程序。

就您而言，听起来您要保护的“用户”是开发人员。这要困难得多。如果开发人员无权对数据库本身进行修改，那么您必须将安全性置于数据库级别。再多的 eSQL 访问都无法绕过数据库说“不”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T01:49:25.983

根据定义，您要实现的目标是不可能的。

如果底层数据库应用程序（SQL Server、Oracle 等）没有显式处理安全性，那么 SQL Management Studio 等标准工具将直接超越它。

您可以做的最好的事情是仅当应用程序的用户无法通过其他机制访问数据库时才强制执行行级安全性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-15T12:22:51.377

您可能会发现这篇文章很有用：

[http://msdn.microsoft.com/en-us/magazine/ff898427.aspx](http://msdn.microsoft.com/en-us/magazine/ff898427.aspx)

“拒绝表访问实体框架而不引起叛变”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-12T14:45:53.743

我找到了一种使用 Postgres 和名为[Veil](http://veil.projects.pgfoundry.org/curdocs/)的扩展的方法。它实际上适用于（设计用于）`Views`用于所有操作（选择、更新、删除、插入）并验证`WHERE`子句中的权限。但是，Veil 只是添加了有效管理内存中权限信息的数学运算，而不是每次都查询它。因此，使用 Veil，尽管您直接连接到 DBMS，但您只获得了行级访问权限。

我在某些方面用面纱修改了我的风格，例如，我开始使用`Triggers`而不是`Views`应用权限限制。

我建议您研究此解决方案并尝试在此处应用其逻辑。

即：您进行`select * from table`查询并得到您想要的内容（行级发言）。

# php - PHP $_GET problems with www.example.com/folder/file?id=2 type URLs

> ID：170697
> 
> 赞同：2
> 
> 时间：2008-10-04T17:24:19.437
> 
> 标签：php, mod-rewrite

I'm changing my site to show friendly URLs like this:

```
www.example.com/folder/topic 
```

Works fine!

But when I add a parameter to the URL:

```
www.example.com/folder/topic?page=2 
```

`$_GET` stops working. It doesn't recognise the parameter at all. Am I missing something? The parameter worked fine before using full URLs.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-04T17:33:09.543

如果这是一个 mod_rewrite 问题，听起来像是，您可以将`[QSA]`标志添加到您的 mod_rewrite 规则中，以将查询字符串附加到重写的 URL 而不是将其丢弃。

您的规则最终将如下所示：

`RewriteRule from to [QSA]`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T17:29:43.263

If you are using mod_rewrite then it is your rules that are broken. Either the query string is not being passed, or the mod_rewrite is discarding everything past **/topic**.

Try adding a rule that you can do: **www.example.com/folder/topic/2**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T17:32:46.830

如果你想让你的 PHP URL “友好”，你需要使用 Apache 的 mod_rewrite 之类的东西。谷歌诸如“apache mod_write 友好的 url”之类的东西，你会得到很多关于这个主题的文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T17:34:40.057

> 我正在更改我的网站以显示友好的 URL

您是使用[mod_rewrite](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)还是通过重新组织文件结构来执行此操作？如果是前者，您的规则可能需要调整。

如果是文件重组，当你进入时你会得到`print_r($_GET)`什么`www.example.com/folder/topic?page=2`？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T17:49:45.907

MrZebra 的答案是正确的。它将允许您像在 URL 末尾那样继续使用查询字符串，并且您不必以一种或另一种方式预期它的存在。

# svn - 主持还是不主持？

> ID：170726
> 
> 赞同：7
> 
> 时间：2008-10-04T17:39:03.963
> 
> 标签：svn, hosting

为 Subversion 存储库使用托管服务提供商与在内部维护它的优缺点是什么？我确信在易于设置和使用方面有好处。最好让其他人确保我们的代码得到正确备份。

但是，Visual SVN 服务器的设置非常简单，我们已经有一组预先建立的服务器，由另一个部门维护并定期备份。话虽如此，使用托管服务与自己维护服务相比有哪些优点和缺点？

交叉链接：

*   [什么是一些体面的 ISP 托管 Subversion](https://stackoverflow.com/questions/99743/what-are-some-decent-isps-that-host-subversion)
*   [Subversion 存储库应该在哪里](https://stackoverflow.com/questions/140090/where-should-a-subversion-repository-be)
*   [我应该为我的个人项目使用软件托管解决方案吗](https://stackoverflow.com/questions/33513/should-i-use-a-software-hosting-solution-for-my-personal-projects)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-04T17:55:12.573

这是我对这个问题的个人经验。在此之前，我运行自己的 SVN 服务器 2 年多，CVS 2 年多。SVN 管理起来很简单，但随着时间的推移，我的代码越来越多地进入存储库。我真的拥有从大学到今天我写过的所有东西（当然不包括工作项目）。

我真的很烦恼，因为我一生的工作都坐在家里的某个随机服务器上。5年的代码是相当多的。有时我会变得偏执到足以运行备份并带一张CD去工作并将它扔在桌子上。但坦率地说，备份之间的时间很短。

自托管服务器也存在安全问题。我非常勤奋地安装更新（debian 非常容易使用）。但随着时间的推移，我发现我管理服务器的时间越来越少。

最终，我研究了一些供应商并尝试使用 wush.net。你将无法让我回到自我托管。Wush.net 是一个令人难以置信的主机。我已经使用它们 2-3 年了，在那段时间里，有一个（是的）实例我无法获得我的来源。他们每晚都会进行异地备份，因此我对代码的安全性感到满意。并且不再需要管理，我有更多的时间来实际完成一些编码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T17:50:20.303

如果您已经拥有适当的基础架构，并且对您托管、备份和提供对存储库的可访问性的能力充满信心，那么我会说自己托管 SVN 是可行的方法。这使您可以相对无限地增长并完全控制您的来源。

如果您的主要移动开发人员数量很少，那么使用托管提供商的成本和限制可能会让您更加方便。但这适用于极少数公司。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T19:06:26.297

您的 SVN 存储库有多重要？

重要？

然后，您不想将它信任给承诺定期备份它的主机。做主机很容易，你租一台服务器，你就是主机，所以它吸引了很多不太商业化的供应商，而且你通常无法分辨好坏，直到坏的那个出去业务，您突然无法连接或联系他们以获取这些备份，并且他们的主机关闭了您的服务器，因为他们没有收到付款并且不会与您交谈，因为他们与您没有业务关系。

因此，如果您确实使用主机，请确保这些备份定期进入您的手中，并且您可以从中恢复。任何更少的东西都只是盲目相信你总能得到他们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T17:44:01.270

之前的几个 SO 线程已经讨论过这个问题：

[托管 Subversion 的一些体面的 ISP 有哪些](https://stackoverflow.com/questions/99743/what-are-some-decent-isps-that-host-subversion) [Subversion 存储库应该在哪里 我](https://stackoverflow.com/questions/140090/where-should-a-subversion-repository-be) [应该为我的个人项目使用软件托管解决方案](https://stackoverflow.com/questions/33513/should-i-use-a-software-hosting-solution-for-my-personal-projects)

我敢肯定我见过更多的人，但我现在找不到他们。

# php - 使用 MVC 和 OO PHP 会话的最佳方式

> ID：170730
> 
> 赞同：2
> 
> 时间：2008-10-04T17:40:37.470
> 
> 标签：php, oop, session

我一直在使用会话、MVC 设计和面向对象的 PHP。我应该在哪里保存或检索会话中的数据？我想从方法中检索它，所以我不必将数据传递给方法。最佳做法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T18:59:45.187

我通常把它放在控制器中。这是有道理的。控制器决定发生什么以及为什么不让它决定是否允许人们执行请求的操作。通常，您在 MVC 系统中有多个控制器。例如。BaseController（抽象 - 通用），NonSessionController 扩展 BaseController（例如：用于静态页面），SessionController 扩展 BaseController（这里主要会话处理 - 这可能是抽象的）。例如，如果您有不同的用户类型，您可能希望对这个控制器进行多态化，例如：AdminController、UserController 等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-04T20:30:57.017

[就个人而言，我是Zend_Session](http://framework.zend.com/manual/en/zend.session.html#zend.session.introduction)包装类的忠实粉丝。我更喜欢以面向对象的风格处理数据，使用包装器的命名空间优势是一个巨大的优势。

你觉得这些中哪一个更好看？

```
$_SESSION['Zend_Auth']['user'] = "myusername"; 
```

或者

```
$authNamespace = new Zend_Session_Namespace('Zend_Auth');
$authNamespace->user = "myusername"; 
```

我更喜欢使用访问器给你的外观。

**注意：**在 MVC 系统中，无论您选择哪种方法，您都应该始终在控制器中获取/设置会话数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T17:46:41.653

我已经尝试了几种方法，包括使用静态包装类来处理它，但我总是回到只使用超全局数组本身。我仍然使用包装器进行身份验证检查和其他重复性任务，但最终，使用库存设置对我来说更容易且不那么冗长。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T18:01:58.457

我认为这取决于检索数据的使用范围，如果它仅在方法内部使用，那么为什么应该在外部检索它，并且会话始终在超全局变量中可用，最好仅在需要时对其进行本地化.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T19:00:28.243

我不会打扰会话包装器。你不会获得足够的收益来承受这些限制。通过超全局允许您使用任何类型的（希望是理智的）您想要的数据结构。我的会话数据总是以 2 级或更多级别的数组数据结束，这太繁琐而无法通过会话包装器进行管理。

超全局甚至不限制您让 PHP 使用[保存处理程序](http://us2.php.net/manual/en/function.session-set-save-handler.php)将会话数据存储在数据库中，这对于可伸缩性非常有利。

# ruby-on-rails - 是时候试试merb了吗？

> ID：170734
> 
> 赞同：4
> 
> 时间：2008-10-04T17:43:59.083
> 
> 标签：ruby-on-rails, ruby, merb

随着 Merb 1.0 的快速临近，我想知道 Merb/Rails 用户推荐什么？

是时候尝试 Merb 了吗？当您从 Rails 切换到 Merb 时，对您有什么不利之处？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-05T13:18:25.000

是的。

缺点：

*   缺乏文档，尽管这正在变得更好（对某些人来说并不是真正的问题，因为代码有很好的文档记录）。
*   Rails 插件，Merb 使用 Gems，并没有全部被移植（最常用的都有）
*   直接移植 Rails 应用程序，不会利用 Merb 中的一些很酷的功能（加上语法不同的地方）

但是，优点：

*   更快和线程安全（如果使用 DM 或 Sequel 则具有额外的优势，因为它们也是线程安全的）
*   模块化（可以选择您需要的东西以及您最喜欢的 ORM、JS Lib、模板语言）
*   少魔法
*   适合新建项目或公开您的 API
*   Merb 有一个稳定的 API（1.0 几周后发布）

总的来说，如果您对 Rails 感到满意，那么切换到 Merb 一点也不难。我个人更喜欢 Merb 而不是 Rails，因为它采用了更多的 Ruby 约定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T05:00:36.643

我一直在等待 1.0 版本，以便 API 被冻结。跟上 Merb 的变化有点困难（尽管我只能为自己说话，这是在 0.9.x 版本之前的 pre-merb-core/更多天）并弄清楚为什么会出现问题。

如果一切按计划进行，Merb 1.0*将*很快在 MerbCamp（10 月 11 日至 12 日）发布。因此，如果我对 Merb 完全陌生，我会等到那时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T18:04:51.007

每个人，包括来自 Merb Core 团队的许多人都被建议等待 1.0。但是，如果您完全好奇，请抓住最新的 Gem 并开始玩弄。只是不要期望将其投入生产并推迟任何生产工作，直到 1.0 发布。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T18:39:18.210

最大的缺点是弄清楚 Merb 和 Rails 之间的不同之处。最大的好处是，当我在 Merb IRC 或邮件列表上寻求帮助时，我得到了帮助，而不是受到侮辱——这与 Rails 不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T18:59:41.413

垃圾邮件过滤服务[Defensio](http://defensio.com/)已经在 Merb 上运行了几个月。Merb 似乎对他们很有效 :-)

免责声明（即使我不想向您推销任何东西）：我过去曾在 Defensio 工作过。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T22:56:31.590

我认为现在使用 Merb 是安全的，因为他们几乎冻结了 API。我最近使用 Merb（以及 0.9.7 版左右）重建了我的博客，它就像一个冠军。我将不得不进行一些调整以将其升级到 1.0 API，但我预计不会做太多工作。我说去吧。美宝不错。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T14:55:40.553

大约一个月过去了，现在 Merb 已经[达到 1.0 了](http://merbist.com/2008/11/09/merb-1-0-released/)，是的，终于到了尝试 Merb 的时候了，如果你是更保守的那类人，你会觉得舒服:)

# language-agnostic - 您实际成功地使用了哪些技术来提高代码覆盖率？

> ID：170751
> 
> 赞同：5
> 
> 时间：2008-10-04T17:51:24.140
> 
> 标签：language-agnostic, code-coverage

我经常使用 TDD 实现 100% 的库覆盖率，但并非总是如此，而且似乎总是有部分应用程序未测试和未发现。
然后有些情况下，您从测试很少且覆盖率很少的遗留代码开始。

请说出您的情况以及至少*改善了*覆盖范围的有效方法。
我假设您在单元测试期间测量覆盖率，但如果您正在使用其他技术。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T17:54:44.883

删除代码。

这并不刻薄，但实际上很严重。每当我看到最少量的代码重复甚至无法执行的代码时，我都会将其删除。这增加了覆盖范围并提高了可维护性。

我应该注意到，这更适用于增加旧代码库与新代码库的覆盖率。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T18:02:34.787

我假设你读过“[代码覆盖与代码测试](https://stackoverflow.com/questions/170297/code-covered-vs-code-tested)”，对吧？

如该问题所述，

> 即使有 100% 的块覆盖率 + 100% 的弧线覆盖率 + 100% 无错误的至少一条路径直线代码，仍然会有输入数据以表现出更多错误的方式执行路径/循环。

现在，我使用基于 EMMA 的[eclemma ，该代码覆盖工具解释了为什么 100% 代码并不总是可能的：因为](http://www.eclemma.org/)**[部分覆盖的行](http://emma.sourceforge.net/faq.html#q.fractional.examples)**是由于：

*   同一行上的隐式分支。
*   共享构造函数代码。
*   由于 finally 块的隐式分支。
*   由于隐藏的 Class.forName() 导致的隐式分支。

因此，所有这 4 种情况都可能是重构的良好候选者，从而导致更好的代码覆盖率。

现在，我同意弗兰克克鲁格的回答。一些未涵盖的代码也可能表明要进行一些重构，包括一些要实际删除的代码；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T17:55:45.457

我们使用 Perl，所以[Devel::Cover](http://search.cpan.org/dist/Devel-Cover/)对我们非常有用。在单元测试期间显示每个语句的覆盖率、分支覆盖率和条件覆盖率，以及 POD 覆盖率等内容。我们使用易于识别的 HTML 输出，绿色表示“100%”，黄色和红色表示较低的覆盖率。

**编辑：**稍微扩展一下：

*   如果条件覆盖不完整，请检查相互依赖的条件。如果存在，请重构。如果不是，您应该能够扩展您的测试以达到所有条件。
*   如果条件和分支覆盖看起来完整但语句覆盖不完整，那么您要么写错了条件（例如，总是在您不打算这样做时从子程序中提前返回），或者您有可以安全删除的额外代码.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T18:02:21.433

对我从事的项目影响最大的两件事是：

1.  定期“提醒”开发团队实际实施单元测试，并审查如何编写有效的测试。
2.  生成整体测试覆盖率报告，并在开发经理之间传播。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T18:16:23.077

[FIT 测试](http://en.wikipedia.org/wiki/Framework_for_Integrated_Tests)提高了我们的代码覆盖率。这很棒，因为它是一种完全不同的策略。

背景：我们混合了旧代码和新代码。我们尝试尽可能多地对新内容进行单元/集成测试，但是因为我们正在迁移到 Hibernate/Postgres 并且远离 OODB，所以测试遗留代码没有多大意义。

对于那些不知道的人，FIT 是一种从用户角度测试软件的方法。本质上，您可以在 HTML 表格中指定所需的行为：表格指定针对软件的操作和所需的结果。我们的团队编写“粘合代码”（又名 FIT 测试），将操作映射到针对代码的调用。请注意，与单元测试相比，这些测试在“从空间”的视图中运行。

使用这种方法，我们将代码覆盖率提高了几个百分点。另一个好处是这些测试将跨版本进行桥接：它们将测试旧代码，然后再测试新代码。即，在某种意义上，它们用作回归测试。

# c# - 我在哪里可以找到 C# 3 的深入指南？

> ID：170772
> 
> 赞同：16
> 
> 时间：2008-10-04T18:07:13.563
> 
> 标签：c#, documentation, c#-3.0

似乎 C# 3 在我没有注意到的情况下击中了我，你们能告诉我关于 C# 3 的深度指南吗？从 lambda 到 linq，再到该语言第三版引入的所有其他内容。

印刷书籍会很好，但在线指南会更好！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-04T18:13:11.897

[ScottGu](http://weblogs.asp.net/scottgu/default.aspx)在 C# 3 上有一些很棒的帖子：

*   [C# ?? 空合并运算符（并将其与 LINQ 一起使用）](http://weblogs.asp.net/scottgu/archive/2007/09/20/the-new-c-null-coalescing-operator-and-using-it-with-linq.aspx)
*   [LINQ to SQL：第 8 部分](http://weblogs.asp.net/scottgu/archive/2007/08/27/linq-to-sql-part-8-executing-custom-sql-expressions.aspx)（这是一个 8 部分系列，查看文章顶部的前 7 部分的链接）
*   [自动属性、对象初始化器和集合初始化器](http://weblogs.asp.net/scottgu/archive/2007/03/08/new-c-orcas-language-features-automatic-properties-object-initializers-and-collection-initializers.aspx)
*   [扩展方法](http://weblogs.asp.net/scottgu/archive/2007/03/13/new-orcas-language-feature-extension-methods.aspx)
*   [Lambda 表达式](http://weblogs.asp.net/scottgu/archive/2007/04/08/new-orcas-language-feature-lambda-expressions.aspx)
*   [查询语法](http://weblogs.asp.net/scottgu/archive/2007/04/21/new-orcas-language-feature-query-syntax.aspx)
*   [匿名类型](http://weblogs.asp.net/scottgu/archive/2007/05/15/new-orcas-language-feature-anonymous-types.aspx?CommentPosted=true)

一些更有用的链接：

*   [MSDN：C# 3.0 概述](http://msdn.microsoft.com/en-us/library/bb308966.aspx)
*   [David Hayden：C# 3.0 教程和示例](http://davidhayden.com/blog/dave/archive/2006/11/30/CSharpTutorialsAndExamples.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-04T18:11:19.233

那里有一些高质量的博客。

我最喜欢的一些：[Eric Lippert](http://blogs.msdn.com/ericlippert/archive/tags/Lambda+Expressions/default.aspx)，[Eric White](http://blogs.msdn.com/ericwhite/pages/FP-Tutorial.aspx)，[Scott Gu](http://weblogs.asp.net/scottgu/archive/tags/LINQ/default.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-04T18:36:59.070

有人告诉我这是一本好书[C# in Depth](https://rads.stackoverflow.com/amzn/click/com/1933988363)。

MS 培训套件[Visual Studio 2008 和 .NET Framework 3.5 培训套件](http://www.microsoft.com/downloadS/details.aspx?familyid=8BDAA836-0BBA-4393-94DB-6C3C4A0C98A1&displaylang=en)和[.NET Framework 3.5 增强培训套件](http://www.microsoft.com/downloads/details.aspx?FamilyID=355c80e9-fde0-4812-98b5-8a03f5874e96&displaylang=en)

频道 9[演示文稿\视频](http://channel9.msdn.com/posts/DavidAiken/VS2008-Training-Kit-Whats-new-in-C-30/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-04T20:10:26.777

到目前为止，我已经阅读了 Jon Skeet 的“C# In Depth”的前 4 章，并且会推荐这本书。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-04T20:58:41.127

只是对 C# 的另一项深度推荐；它不仅会全面解释 C# 3.0 - 而且还会显着提高您对 C# 2.0 的理解 - 例如，迭代器块或捕获的变量的许多更细微的细微差别。

绝对值得一读。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-04T18:09:19.657

[http://msdn.microsoft.com/en-us/library/bb308966.aspx](http://msdn.microsoft.com/en-us/library/bb308966.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-04T19:35:08.750

如果您正在寻找一些死树参考，我推荐 Pro C# 2008 和 Andrew Troelsen 的 .NET 3.5 平台。

[http://www.amazon.co.uk/gp/reader/1590598849/ref=sib_rdr_toc?ie=UTF8&p=S006&j=0#reader-page](http://www.amazon.co.uk/gp/reader/1590598849/ref=sib_rdr_toc?ie=UTF8&p=S006&j=0#reader-page)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-04T20:26:12.207

我发现[C# 3.0 in a Nutshell](https://rads.stackoverflow.com/amzn/click/com/0596527578)非常有用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-04T18:32:11.657

我发现[Pro LINQ: Language Integrated Query in C# 2008](https://rads.stackoverflow.com/amzn/click/com/1590597893)对此非常有帮助。它有一章涵盖了 3 中的所有新语言特性，当然本书的其余部分将深入探讨 LINQ。我会极力推荐它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-04T19:38:00.430

[C# 3 规范](http://download.microsoft.com/download/3/8/8/388e7205-bc10-4226-b2a8-75351c669b09/CSharp%20Language%20Specification.doc)给出了该语言的完整描述，但是这可能对您的需要*来说过于*详细。

# configuration - CruiseControl.net 在 Vista x64 上失败并出现 HTTP 错误 500

> ID：170777
> 
> 赞同：2
> 
> 时间：2008-10-04T18:10:20.107
> 
> 标签：configuration, windows-vista, cruisecontrol.net

我在我的 Vista x64 开发机器上安装了 CruiseControl.net（来自 CruiseControl.NET-1.4-Setup.exe 安装程序）。服务器部分运行良好；但是，webdashboard 部分不起作用。

当我尝试打开[http://localhost/ccnet](http://localhost/ccnet)时看到的第一条错误消息是关于无法在集成管道模式下运行的问题。很容易固定。我打开了 IIS7 管理面板并将 ccnet 应用程序更改为使用“Classic .NET App Pool”应用程序池。

但是，当我尝试连接时，我现在得到一个持久的 HTTP 错误 500。我在 webdashboard 文件夹上设置了 NTFS 权限，希望这可能是文件权限问题。没有喜悦。

经过一番挖掘和反复试验，我发现了一组似乎可以解决问题的步骤。我将在此之后立即发布后续答案，但想在 stackoverflow 上分享这一点，希望它可以帮助其他人。另外，如果有更好的配置解决方案，我会全力以赴:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T18:18:19.983

这是我得到的 HTTP 500 错误转储的顶部：

> HTTP 错误 500.0 - 内部服务器错误
> 
> 说明：由于发生内部服务器错误，无法显示该页面。
> 
> 错误代码：0x800700c1
> 
> 通知：ExecuteRequestHandler
> 
> 模块：IsapiModule
> 
> 请求的 URL：[http://localhost/ccnet/default.aspx](http://localhost/ccnet/default.aspx)
> 
> 物理路径：C:\Program Files (x86)\CruiseControl.NET\webdashboard\default.aspx
> 
> 登录用户：匿名
> 
> 登录方式：匿名
> 
> 处理程序：AboMapperCustom-80778
> 
> 最可能的原因：
> 
> IIS 收到请求；但是，在处理请求期间发生了内部错误。此错误的根本原因取决于处理请求的模块以及发生此错误时工作进程中发生的情况。IIS 无法访问网站或应用程序的 web.config 文件。如果 NTFS 权限设置不正确，可能会发生这种情况。IIS 无法处理网站或应用程序的配置。经过身份验证的用户没有使用此 DLL 的权限。请求映射到托管处理程序，但未安装 .NET 可扩展性功能。

为我解决这个问题的关键是 Handler 线。出于某种原因，ccnet Web 应用程序配置了两个争夺对 *.aspx 的控制权的处理程序。来自 Thoughtworks 的真正处理程序是在 web.config 文件中设置的。但是，当我打开 ccnet 应用程序的 IIS7 控制面板的 Handler Mappings 部分时，我看到已经创建了另一个名为 AboMapperCustom-80778 的处理程序并设置为查找 *.aspx。

我右键单击处理程序并选择“删除”。之后，ccnet 应用程序开始对我运行良好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T18:15:54.153

这篇文章似乎表明使用 IIS 和 64 位操作系统可能会出现许多问题。查看链接以获取解决问题的一些想法：[http ://blog.danbartels.com/archive/2005/05/18/662.aspx](http://blog.danbartels.com/archive/2005/05/18/662.aspx)

# wcf - 如何序列化 SettingsContext 和 SettingsPropertyCollection

> ID：170786
> 
> 赞同：0
> 
> 时间：2008-10-04T18:15:22.047
> 
> 标签：wcf, serialization, profile-provider

在实现自己的配置文件提供程序时，我需要序列化`System.Configuration.SettingsContext`​​和类型。`System.Configuration.SettingsPropertyCollection`关于如何以最简单的方式进行操作的任何建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T14:01:19.283

你有两个选择：

创建具有 DataContract 属性的 DTO，并在调用服务时从非数据合同对象“转换”到 DTO 并再次返回。这将利用 Data Contract 序列化程序，并且您的服务正常运行。如果您使用这些对象中的大量字段，这可能会很乏味（如果可能，我会尝试将使用的字段限制为仅您知道您将需要的字段）

在发送/返回它们的调用上使用 XML 序列化程序。XML 序列化器比 Data Contract 序列化器慢一点，但提供了对数据如何序列化的更多控制。您的客户不会看到（或关心）差异。网上有很多关于如何做到这一点的例子（比如这个：http: [//msdn.microsoft.com/en-us/library/ms733901.aspx](http://msdn.microsoft.com/en-us/library/ms733901.aspx)），所以我不会在这里重复。:) 不过也不太难。

祝你好运

# windows - 我如何知道 Windows 是否刚刚从 BSOD 中恢复？

> ID：170787
> 
> 赞同：4
> 
> 时间：2008-10-04T18:15:47.430
> 
> 标签：windows, wmi, bsod

来自[http://support.microsoft.com/kb/317277](http://support.microsoft.com/kb/317277)：如果 Windows XP 由于严重错误而重新启动，Windows 错误报告工具会提示您...

*我的*应用程序如何知道“Windows XP 由于严重错误而重新启动”？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-04T18:36:23.753

注意：这是一个**[代码挑战的好问题](https://stackoverflow.com/questions/172184)**

以下是一些可执行代码，但您可以随意添加其他语言的其他解决方案：

* * *

正常运行时间可能是一个很好的指示：

```
net stats workstation | find /i "since" 
```

现在将这些信息与读取 Windows 事件日志的方法联系起来，例如在 PowerShell 中：

```
Get-EventLog -list | Where-Object {$_.logdisplayname -eq "System"} 
```

并查找最后的“保存转储”消息

正如[Michael Petrotta](https://stackoverflow.com/users/23897/michael-petrotta) [所说](https://stackoverflow.com/a/170815/6309)，[WMI](http://msdn.microsoft.com/en-us/library/aa389290(VS.85).aspx)是检索该信息的好方法。

根据更新时间，您可以进行如下查询：

```
Set colEvents = objWMIService.ExecQuery _
    ("Select * from Win32_NTLogEvent Where LogFile = 'System' AND
    TimeWritten >= '" _
    & dtmStartDate & "' and TimeWritten < '" & dtmEndDate & "'") 
```

轻松发现带有“ `Save Dump`”消息的事件日志，确认崩溃。

更多在[`Win32_NTLogEvent`Class](http://msdn2.microsoft.com/En-US/library/aa394226.aspx) WMI 类中。

* * *

实际上，这篇 Microsoft 文章**[Querying the Event Log for Stop Events](http://www.microsoft.com/technet/scriptcenter/guide/sas_cpm_klll.mspx?mfr=true)**确实为您提供了它（完整请求）：

```
strComputer = "."
Set objWMIService = GetObject("winmgmts:" _
     & "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
Set colLoggedEvents = objWMIService.ExecQuery _
     ("SELECT * FROM Win32_NTLogEvent WHERE Logfile = 'System'" _
     & " AND SourceName = 'Save Dump'")
For Each objEvent in colLoggedEvents
    Wscript.Echo "Event date: " & objEvent.TimeGenerated
    Wscript.Echo "Description: " & objEvent.Message
Next 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-04T18:38:54.230

在事件日志中报告由 BSOD 导致的重新启动。使用您喜欢的语言的库来搜索日志以查找错误。例如，在 .NET 中，您需要查看 System.Diagnostics.EventLog 类。WMI 可能会提供一种更灵活的方式来搜索日志。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T18:18:07.253

如果转储文件生成已启用（或者更确切地说，由于默认情况下已启用，则未禁用），您可以查找具有最近创建时间的内存或内核转储文件。

# c# - 如何在自定义控件的属性网格中获取 OpenFileDialog？

> ID：170791
> 
> 赞同：12
> 
> 时间：2008-10-04T18:16:54.573
> 
> 标签：c#, .net, controls, propertygrid

我正在创建一个 .net 自定义控件，它应该能够加载多个文本文件。我有一个名为 ListFiles 的公共属性，其中设置了这些属性：

```
 [Browsable(true), Category("Configuration"), Description("List of Files to Load")]
public string ListFiles
  {
     get { return m_oList; }
     set { m_oList = value; }
  } 
```

根据对象的类型（字符串，字符串 []，列表，...），属性网格将允许用户输入一些数据。我的目标是在我的组件的属性网格中有一个过滤的 openfiledialog这将使用户能够选择多个文件并将其作为数组或字符串（或其他东西......）返回。

Sooo ...这是我的问题：**如何在自定义控件的属性网格中获取 OpenFileDialog？**

非常感谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-03-03T17:13:26.103

您可以使用内置的 UITypeEditor。它被称为[FileNameEditor](http://msdn.microsoft.com/en-us/library/system.windows.forms.design.filenameeditor.aspx)

```
[EditorAttribute(typeof(System.Windows.Forms.Design.FileNameEditor), typeof(System.Drawing.Design.UITypeEditor))]

public string SomeFilePath
{
 get;
 set;
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-04T18:32:39.487

您可以通过添加[UITypeEditor](http://msdn.microsoft.com/en-us/library/ms171839.aspx)来做到这一点。

[这是一个 UITypeEditor 的示例](http://web.archive.org/web/20090218231316/http://www.winterdom.com/weblog/2006/08/23/ACustomUITypeEditorForActivityProperties.aspx)，它为您提供了用于选择文件名的 OpenFileDialog。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-05-09T16:55:49.627

这是自定义文件对话框的另一个示例：

**自定义文件编辑器.cs**

```
using System.Windows.Forms;
using System.Windows.Forms.Design;

namespace YourNameSpace
{
    class CustomFileBrowser : FileNameEditor
    {
        protected override void InitializeDialog(OpenFileDialog openFileDialog)
        {
            base.InitializeDialog(openFileDialog);
            openFileDialog.Title = "Select Project File : ";
            openFileDialog.Filter = "Project File (*.proj)|*.proj"; ;
        }
    }

} 
```

**用法 ：**

```
 [Category("Settings"), DisplayName("Project File:")]
            [EditorAttribute(typeof(CustomFileBrowser), typeof(System.Drawing.Design.UITypeEditor))]
            public string Project_File { get; set; } 
```

# c# - .NET WCSF 作为基于门户网站的 UI 堆栈选择？

> ID：170799
> 
> 赞同：3
> 
> 时间：2008-10-04T18:26:33.960
> 
> 标签：c#, .net-3.5, wcsf

我们正在建立一个显示新闻标题和新闻的网站。最初它将是一个公共站点，但会演变为包括门户内容，如个性化网页。

该网站还需要围绕正在显示的新闻故事构建 web 2.0 功能，并且需要具有可扩展性和高度可定制性，允许业务更改定义故事的模板并根据业务逻辑使用不同的模板等。

核心业务逻辑正在使用 Windows 工作流和 Windows 通信基础构建，我们现在正在寻找合适的 UI 堆栈，WCSF 是一个不错的选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T02:48:44.490

WCSF 可能是一个不错的选择，但可能与您列出的可能的功能需求无关。

在我看来，WCSF 所做的最好的事情是它建立在 Model-View-Presenter-[Controller] 模式上，它使您可以分离视图和演示者之间的关注点（就像 MVC 一样）......但是在同时，这并不是许多 .net 用户习惯的“页面控制”模型的完全范式转变。这意味着您仍然可以像以前一样使用许多第三方控件，例如 Telerik 或 Infragistics（使用 MVC 更具挑战性）。

因为 MVP 模式使用依赖注入容器 (ObjectBuilder) 和控制反转，所以您可以获得一种非常好的方式来编写没有 Web 上下文的单元测试（易于模拟对象）。该容器还支持服务定位，因此您可以轻松编写将被共享的 WCSF 服务（WCF 和/或 WSSF 非常适合这里）。

从程序的角度来看，它是高度模块化的，并且具有许多可扩展性点。

话虽如此……听起来您正在寻找更多的模板、个性化、动态框架。在这种情况下，您可以查看 WSS/SharePoint，因为它可以让您在开箱即用的领域进一步深入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T16:50:52.963

我使用 wcsf，对此我很满意。

我也想拥有整个模板/动态内容。不过，我将对其进行编程。

MVC 是一种范式转变，它会让我很难做我想做的事——部分原因是该框架仍处于测试阶段。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T23:34:36.977

我们在一个新项目中使用 WCSF，到目前为止，它确实帮助我们快速交付高质量的工作。当我们使用 SCRUM 作为敏捷方法时，它确实帮助了我们。因此，依赖注入模式为我们提供的灵活性非常棒。我们一开始有一些白发，即开发人员开始购买 WCSF 并绕过他们的学习曲线，但现在它真的为我们带来了红利

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T20:57:07.503

WCSF + (WSSF | WCF) 是很好的平台。我们在 WCSF 方面有积极的经验（但我不得不说，只在作为前端的小项目中）。支持 AJAX。

[您可以在http://websf.codeplex.com/Thread/List.aspx](http://websf.codeplex.com/Thread/List.aspx)上找到有关性能或架构理念的有价值的讨论。

# c - 使用 SetParent 将 HWND 嵌入到外部进程中

> ID：170800
> 
> 赞同：17
> 
> 时间：2008-10-04T18:26:43.833
> 
> 标签：c, winapi

**我正在尝试使用SetParent**函数将我的进程中的一个窗口嵌入到外部进程的窗口中，并且遇到了一些我希望有人能帮助我解决的问题。首先，这是我目前将窗口嵌入应用程序的概述：

```
HWND myWindow; //Handle to my application window
HWND externalWindow; //Handle to external application window

SetParent(myWindow,externalWindow);

//Remove WS_POPUP style and add WS_CHILD style
DWORD style = GetWindowLong(myWindow,GWL_STYLE);
style = style & ~(WS_POPUP);
style = style | WS_CHILD;
SetWindowLong(myWindow,GWL_STYLE,style); 
```

此代码有效，我的窗口出现在其他应用程序中，但引入了以下问题：

*   当我的窗口获得输入焦点时，外部进程的主应用程序窗口失去焦点（即标题栏改变颜色）
*   当我的窗口有焦点时，主应用程序的键盘快捷键命令不起作用

有人知道解决方法吗？我希望我的窗口被视为主应用程序的另一个子窗口。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-02T22:41:08.870

好吧，我终于找到了我的问题的答案。

要解决主应用程序失去焦点的问题，您需要使用**AttachThreadInput**函数将嵌入式窗口线程附加到主应用程序线程。

此外，可以使用**TranslateAccelerator**函数响应 WM_KEYDOWN 消息，以确保触发主应用程序的加速器消息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-08-16T22:15:41.610

我不确定您是否在将近三年后仍然对这个话题感兴趣。我正在开发一个类似的应用程序。我的解决方案是在调用 SetParent 之前修改窗口样式。使用此解决方案，我不必调用 AttachThreadInput。

但是，从外部进程托管子窗口的一个主要问题是，如果外部进程在响应用户键盘或鼠标输入时挂起，则主应用程序也会冻结。主应用程序中的消息循环仍在运行。但是，它不再接收用户输入事件。因此，它看起来好像是挂着的。我相信这是 AttachThreadInput 的直接结果，因为两个线程的输入事件现在是同步的。如果其中一个被阻止，则两个都被阻止。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-07-06T13:52:10.647

我遇到了同样的问题，仔细阅读 MSDN 文档后，我发现它很容易解决。

您应该在调用 setParent**之前**删除 WS_POPUP 并添加 WS_CHILD

它在 MSDN 中说明：

出于兼容性原因，SetParent 不会修改正在更改其父级的窗口的 WS_CHILD 或 WS_POPUP 窗口样式。因此，如果 hWndNewParent 为 NULL，还应在调用 SetParent 后清除 WS_CHILD 位并设置 WS_POPUP 样式。**相反，如果 hWndNewParent 不为 NULL 并且该窗口以前是桌面的子窗口，则应在调用 SetParent 之前清除 WS_POPUP 样式并设置 WS_CHILD 样式。**

[https://msdn.microsoft.com/en-us/library/windows/desktop/ms633541(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/ms633541(v=vs.85).aspx)

# ruby-on-rails - Ruby stdlib 和 Rails stdlib 中的日期类不同

> ID：170824
> 
> 赞同：3
> 
> 时间：2008-10-04T18:44:49.180
> 
> 标签：ruby-on-rails, ruby, date

我想在我的 rails 应用程序中使用 Date::ABBR_MONTHS 常量。[我在http://www.ruby-doc.org/stdlib/](http://www.ruby-doc.org/stdlib/)看到了 Ruby stdlib 文档，它似乎没有这个常数。然而，这个常数在[http://stdlib.rubyonrails.org/](http://stdlib.rubyonrails.org/)

这两个库有什么区别？

这个常量在我的 unix 部署机器上运行，但在我的 windows 开发机器上运行。任何人都可以解释发生了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T22:45:47.743

`ABBR_MONTHS`是 ActiveSupport 给你的东西，它只是添加到 Date 类中。第一个库用于 ruby​​，第二个库用于 ruby​​ on rails。由于 Rails 版本不同，该常量可能无法正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T13:38:58.860

ABBR_MONTHS 由 ActiveSupport 添加到日期。

Rails 实际上是一组宝石。ActiveSupport 的作用主要是为 Ruby 语言和其他不可知的工具（如 Inflector 和创建 Time 实例的 2.days 方式等）添加细节。

因此，如果您出于某种原因在您的 rails 应用程序之外需要这种功能，那么您很幸运：

```
require 'rubygems' #If not already done
require 'activesupport'
puts Date::Format::ABBR_MONTHS.inspect
#=> {"oct"=>10, "jul"=>7, "jan"=>1, "dec"=>12, "jun"=>6, "apr"=>4, "feb"=>2, "may"=>5, "sep"=>9, "aug"=>8, "mar"=>3, "nov"=>11} 
```

# wcf - 如何序列化 System.Configuration.SettingsProperty

> ID：170825
> 
> 赞同：1
> 
> 时间：2008-10-04T18:44:55.560
> 
> 标签：wcf, serialization, profile-provider

我需要通过 WCF 序列化 System.Configuration.SettingsProperty 和 System.Configuration.SettingsPropertyValue 类对象。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T20:09:11.913

使用您自己的课程是合理的选择。如果需要，您还可以使用 VS 设计器设置。

VS 设计器将属性设置保存在[ApplicationSettingsBase](http://msdn.microsoft.com/en-us/library/system.configuration.applicationsettingsbase.aspx)类中。默认情况下，这些属性被序列化/反序列化为每个用户的 XML 文件。因为 WCF 服务没有用户上下文，所以这不起作用。您可以通过使用自定义[SettingsProvider](http://msdn.microsoft.com/en-us/library/system.configuration.settingsprovider.aspx)来覆盖此行为，这样可以很容易地将属性保留在您想要的任何位置。只需将`SettingsProvider`属性添加到 VS 生成的`Settings`类中：

```
[SettingsProvider(typeof(CustomSettingsProvider))]
internal sealed partial class Settings { 
   ...
} 
```

[RegistrySettingsProvider](http://msdn.microsoft.com/en-us/library/ms181001.aspx)就是一个很好的例子。

编辑：我最初阅读您的问题时认为您是在询问如何在 WCF 服务中保留设置。我现在看到您想通过 WCF 传递设置。SettingsProvider 类也可用于此目的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T18:59:57.247

我猜您之所以问是因为您无法返回 SettingProperty 列表。我会自己创建一个可序列化的类并在那里加载属性。

# .net - 真的有人使用代码访问安全来保护他们的程序集和/或方法吗？

> ID：170844
> 
> 赞同：4
> 
> 时间：2008-10-04T18:57:44.100
> 
> 标签：.net, security, code-access-security

在我看来，大多数开发人员完全忽略了这个功能。人们更喜欢将安全异常作为依赖标准 Windows 角色和权限的通用异常来处理，而不是学习使用 CAS 方法来增强安全性——可能是因为 CAS 在其逻辑和命名方面相当混乱。

任何人都可以建议任何一般的经验法则/最佳实践，以干净的方式以最佳方式使用 CAS 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T00:18:24.263

是和不是。

不幸的是，你是对的——开发人员很少使用 CAS，更不用说充分利用它了。在极少数情况下，我会看到他们实际上这样做（好吧，实际上不是程序员，而是组织强迫他们......）

除了用于允许用户限制从 Internet 下载的程序集（例如）——尽管这很少部署在 Silverlight 之外——我还看到了 CAS 的两个主要用途。
首先是一般政策限制，通常是使用 CAS 弄湿您的脚的最简单方法（尤其是因为 VS 可以为您自动生成政策文件）。当敏感企业（例如银行）对必须安全的系统进行第三方定制开发时，我（很少）看到这种情况。这可以通过对他们不知道他们的程序员正在做什么增加额外的限制来使他们受益。
其次是非常具体的链接需求，在（同样罕见的）情况下，您有一个模块以相对较高的权限运行，并且只希望特定程序集调用您的模块。例如，就在上周，我有一个客户端将一个模块写入 ActiveDirectory，并希望限制仅从特定系统对该功能的访问。

当然，CAS 比这要大得多，但这确实是两个最好的起点。作为一般规则，这当然适用于一切，不要仅仅因为它在那里就决定使用它，除非它满足你的需求。政策是最简单的，也是最有意义的提前实施。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T21:12:27.557

另请参阅[此讨论](https://stackoverflow.com/questions/169951/using-the-net-framework-security-system)。

由于大量代码（可能太多）在完全信任的情况下运行，因此问题变得更加严重。然后完成的唯一检查是诸如 PrincipalPermissionAttribute 检查之类的检查——其余的大部分都被简单地绕过了。所以在很多情况下没有多大意义！除非您正在加载外部（不受信任的）文件[因此需要 CAS]，否则在许多情况下它根本不会增加很多（是的，有很多例外）。

CAS 对于在沙箱中运行的客户端（例如从 Internet 下载）更有用。Sliverlight 将这一点发挥到了极致，与常规 .NET 相比，它具有更严格的规则（尤其是在反射方面）。

# .net - 解析 T-SQL 以参数化查询

> ID：170850
> 
> 赞同：2
> 
> 时间：2008-10-04T19:00:17.417
> 
> 标签：.net, sql-server, parsing

我目前正在处理的应用程序会生成大量 SQL 内联查询。然后将所有生成的 SQL 移交给数据库执行类。我想为数据执行类编写一个解析服务，它将接受这样的查询：

```
SELECT field1, field2, field3 FROM tablename WHERE foo=1 AND bar="baz" 
```

并把它变成这样的东西：

```
SELECT field1, field2, field3 FROM tablename WHERE foo=@p1 AND bar=@p2 blah blah blah 
```

在 c# 或 vb.net 中已经写过任何可以为我完成此任务的东西吗？这是为这个项目重构 DAL 之前的一个权宜之计。

**更新：**伙计们，我有一个从经典 ASP 移植到 ASP.NET 的巨大应用程序，其中包含数千行内联 SQL。唯一的优点是所有生成的 sql 都交给了数据执行类。我想在执行之前捕获 sql 并动态参数化它们作为重写整个应用程序的权宜之计。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T19:11:15.243

不要这样做。这工作量太大了。此外，这种方法存在大量安全风险。

至少查看 Command 对象和参数化查询。

[这是一个小教程。](http://www.csharp-station.com/Tutorials/AdoDotNet/Lesson06.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-06T01:16:58.623

现在重构。

如果您认为这一抽象层能够更快、更容易地进入，那您就是在自欺欺人。在内心深处，你知道这会增加项目的风险和不确定性，但你想用灵丹妙药解决 SQL 注入问题或任何你正在解决的问题。

在您编写这个新的解析子系统和对系统进行回归测试时，您可能会用调用数据库上相对较少的代码生成和测试的 SP 来替换所有内联代码。另外，你可以一块一块地做。

为什么要构建一段难以调试且与您希望最终架构看起来不完全一致的重要一次性代码？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T19:56:12.140

我会建议使用命令参数来做你想做的事。任何类型的 SQL 查询字符串解析都只是要求有人与您一起玩 SQL 注入游戏。示例代码如下。参数集合很容易以正常方式操作

```
command.CommandText = "SELECT * FROM table WHERE key_field='?'"
command.Parameters.Append command.CreateParameter(, 8, , , "value") '8 is adBSTR value
set rsTemp = command.Execute 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T20:23:15.143

o 认为你的任务太光荣了......你应该创建一个非常强大的解析器......我认为开始重写应用程序、查找生成查询的点和重构代码会更好、更容易。

好锁！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T21:36:39.317

我只能想到动态参数化查询会带来的一个好处：它将减少您的应用程序当前对 SQL 注入攻击的脆弱性。在其他所有方面，您可能希望的最好结果是这个假设的动态解析器​​/解释器不会破坏任何东西。

即使您不必自己编写这样的东西（我敢打赌您确实这样做了），将其引入生产系统也是一个相当大的风险，特别是因为它是一种权宜之计，在您重构应用程序时将被丢弃。SQL 注入攻击的风险是否足以证明这一点？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T21:49:35.220

您是否考虑过在旧代码上运行替换正则表达式？如果当前的内联 SQL 都遵循相同的值（或者几乎所有这些都可以，您可以在您最喜欢的编辑器中修复其余部分）。

# java - 模拟 java.util.Scanner 的用户输入

> ID：170854
> 
> 赞同：1
> 
> 时间：2008-10-04T19:02:59.753
> 
> 标签：java, input, java.util.scanner

我正在用 Java 编写游戏，我希望用户能够从命令行和我的 GUI 提供输入。目前，我使用这种方法来获取输入：

```
 static String getInput(){
        System.out.println("Your move:");
        Scanner sc = new Scanner(System.in);
        return sc.nextLine();
    } 
```

我想继续使用它，但也让 mousePressed 事件模拟用户实际输入他们的输入。它的解决方案效率不高，但在我的应用程序中很有意义。所以问题是：如何模拟用户从代码端输入 System.in？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T23:34:52.090

*这是可能的 - System.in*最简单的替代品是[PipedInputStream](http://java.sun.com/javase/6/docs/api/java/io/PipedInputStream.html)。这必须连接到从另一个线程（在本例中为 Swing 线程）写入的[PipedOutputStream](http://java.sun.com/javase/6/docs/api/java/io/PipedOutputStream.html)。

```
public class GameInput {

    private Scanner scanner;

    /**CLI constructor*/
    public GameInput() {
        scanner = new Scanner(System.in);
    }

    /**GUI constructor*/
    public GameInput(PipedOutputStream out) throws IOException {
        InputStream in = new PipedInputStream(out);
        scanner = new Scanner(in);
    }

    public String getInput() {
        return scanner.nextLine();
    }

    public static void main(String[] args) throws IOException {
        GameInput gameInput;

        PipedOutputStream output = new PipedOutputStream();
        final PrintWriter writer = new PrintWriter(output);
        gameInput = new GameInput(output);

        final JTextField textField = new JTextField(30);
        final JButton button = new JButton("OK");
        button.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                String data = textField.getText();
                writer.println(data);
                writer.flush();
            }
        });

        JFrame frame = new JFrame();
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.getContentPane().setLayout(new FlowLayout());
        frame.getContentPane().add(textField);
        frame.getContentPane().add(button);
        frame.pack();
        frame.setVisible(true);

        String data = gameInput.getInput();
        System.out.println("Input=" + data);
        System.exit(0);
    }

} 
```

但是，重新考虑您的游戏逻辑以在 GUI 模式下完全切断流可能会更好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T19:11:09.453

我曾经制作了一个可以通过命令行或使用 GUI 运行的应用程序。
我这样做的方法是定义一个接口（名为 IODevice），它定义了以下方法：

*   公共字符串 getInput();*   公共无效显示输出（字符串输出）；

然后我有两个实现这个接口的类——一个使用主机的终端（就像你现在所做的那样），一个使用 JTextArea（输出）/JOptionPane（输入）。

也许您可以做类似的事情 - 要更改使用的输入设备，只需更改 IODevice 的实例。

希望这有点用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T19:17:14.107

老实说，在重新阅读您的问题后，我不确定您想要什么。

无论如何，也许您需要检查 java.lang.System.setIn(InputStream in) 方法。这将允许您更改用于从终端读取输入的阅读器（即将其从实际终端更改为您喜欢的任何内容）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T19:18:29.050

假设您有许多与给定示例类似的操作，您可能会考虑 Richie_W 描述的接口方法，但为每个操作创建一个例程，而不是通用的“输入/输出”方法。

例如：

```
public interface IGameInteraction
{
    public String askForMove( String prompt );
    public boolean askAreYouSure( String prompt );
} 
```

你的命令行实现很清晰；现在，您的 GUI 实现可以为每个逻辑操作使用适当的对话框，而不仅仅是一个实际上只是命令行版本的文本区域。

此外，这更容易编写单元测试，因为在您的测试中，您可以以任何方式存根这些例程。

# visual-studio - 有没有办法最大化 Visual Studio 中的当前选项卡？

> ID：170866
> 
> 赞同：12
> 
> 时间：2008-10-04T19:10:16.243
> 
> 标签：visual-studio, visual-studio-2008, ide, fullscreen

当我的屏幕空间有限时（例如，从笔记本电脑远程桌面），我有时需要使用 Visual Studio。 **能够使当前选定的代码选项卡最大化以在有限的时间内占据整个屏幕，这将非常有用。**

那可能吗？有键盘快捷键吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-04T19:11:58.533

查看->全屏（Shift + Alt + Enter）

那样有用吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T19:13:35.050

我使用 Shift-Alt-Enter 来激活全屏模式。

# c# - 由于不区分大小写的 URL 和默认值，如何避免 ASP.NET MVC 中的重复内容？

> ID：170900
> 
> 赞同：24
> 
> 时间：2008-10-04T19:32:09.460
> 
> 标签：c#, asp.net, asp.net-mvc, razor

> **编辑**：现在我需要真正解决这个问题，我做了更多调查并想出了一些减少重复内容的方法。我在我的博客上发布了详细的代码示例：[Reducing Duplicate Content with ASP.NET MVC](http://blog.dantup.me.uk/2009/04/reducing-duplicate-content-with-aspnet.html)

第一篇文章 - 如果我把它标记错或标记得很差，那就放轻松：P

在 Microsoft 的新 ASP.NET MVC 框架中，似乎有两件事可能会导致您的内容在多个 URL 上提供（Google 会对此进行惩罚并将导致您的 PageRank 在它们之间拆分）：

*   不区分大小写的 URL
*   默认网址

您可以设置默认控制器/操作来为您的域根目录的请求提供服务。假设我们选择 HomeController/Index。我们最终得到以下提供相同内容的 URL：

*   mydomain.com/
*   mydomain.com/Home/Index

现在，如果人们开始链接到这两个，那么 PageRank 将被拆分。谷歌还会认为它重复内容并惩罚其中之一以避免结果重复。

最重要的是，这些 URL 不区分大小写，因此我们实际上也为这些 URL 获得了相同的内容：

*   mydomain.com/Home/Index
*   mydomain.com/home/index
*   mydomain.com/Home/index
*   mydomain.com/home/Index
*   （名单还在继续）

所以，问题是......我如何避免这些处罚？我想：

*   将默认操作的所有请求（301 状态）重定向到相同的 url
*   所有 URL 都区分大小写

可能的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-04T20:57:29.117

我也在做这个。在这点上，我显然会听从 ScottGu 的意见。不过，我也谦虚地提供了我对这个问题的解决方案。

将以下代码添加到**global.asax**：

```
protected void Application_BeginRequest(Object sender, EventArgs e)
{
    // If upper case letters are found in the URL, redirect to lower case URL.
    if (Regex.IsMatch(HttpContext.Current.Request.Url.ToString(), @"[A-Z]") == true)
    {
        string LowercaseURL = HttpContext.Current.Request.Url.ToString().ToLower();

        Response.Clear();
        Response.Status = "301 Moved Permanently";
        Response.AddHeader("Location",LowercaseURL);
        Response.End();
    }
} 
```

一个很好的问题！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-04T20:35:44.153

除了在这里发帖外，我还给 ScottGu 发了电子邮件，看看他是否有很好的回应。他提供了一个为路由添加约束的示例，因此您只能响应小写 url：

```
public class LowercaseConstraint : IRouteConstraint
{
    public bool Match(HttpContextBase httpContext, Route route,
            string parameterName, RouteValueDictionary values,
            RouteDirection routeDirection)
    {
        string value = (string)values[parameterName];

        return Equals(value, value.ToLower());
    } 
```

在注册路由方法中：

```
public static void RegisterRoutes(RouteCollection routes)
{
    routes.IgnoreRoute("{resource}.axd/{*pathInfo}");

    routes.MapRoute(
        "Default",                                              // Route name
        "{controller}/{action}/{id}",                           // URL with parameters
        new { controller = "home", action = "index", id = "" },
        new { controller = new LowercaseConstraint(), action = new LowercaseConstraint() }
    );
} 
```

这是一个开始，但希望能够从 Html.ActionLink 和 RedirectToAction 等方法更改链接的生成以匹配。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-12-22T09:16:22.333

撞！

**MVC 5**现在支持仅生成小写 url 和常见的尾随斜杠策略。

```
 public static void RegisterRoutes(RouteCollection routes)
    {
        routes.LowercaseUrls = true;
        routes.AppendTrailingSlash = false;
     } 
```

同样在我的应用程序中，以避免不同域/IP/字母大小写等上的重复内容......

> [http://yourdomain.com/en](http://yourdomain.com/en)
> 
> [https://yourClientIdAt.YourHostingPacket.com/](https://yourClientIdAt.YourHostingPacket.com/)

我倾向于基于**PrimaryDomain** - **Protocol** - **Controller** - **Language** - **Action生成规范 Url**

```
public static String GetCanonicalUrl(RouteData route,String host,string protocol)
{
    //These rely on the convention that all your links will be lowercase! 
    string actionName = route.Values["action"].ToString().ToLower();
    string controllerName = route.Values["controller"].ToString().ToLower();
    //If your app is multilanguage and your route contains a language parameter then lowercase it also to prevent EN/en/ etc....
    //string language = route.Values["language"].ToString().ToLower();
    return String.Format("{0}://{1}/{2}/{3}/{4}", protocol, host, language, controllerName, actionName);
} 
```

然后，如果当前请求 url 不匹配，您可以使用**@Gabe Sumner 的答案重定向到您操作的规范 url。**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-06-22T20:31:40.457

我相信对此有更好的答案。如果您在页面标题中放置一个规范链接，例如：

```
<link rel="canonical" href="http://mydomain.com/Home/Index"/> 
```

然后谷歌只在他们的结果中显示规范页面，更重要的是，谷歌的所有优点都没有受到惩罚。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-11-06T06:55:40.873

和你一样，[我也有同样的问题](https://stackoverflow.com/q/13022221/17027)；除了我不愿意接受全小写的 URL 限制，也不喜欢这种`canonical`方法（嗯，它很好，但不是单独的）。

我找不到解决方案，所以我们[编写并开源](https://github.com/NeoSmart/web/)了一个[重定向类](https://github.com/NeoSmart/web/blob/master/Web%20Toolkit/Seo.cs)。

使用它很简单：控制器类中的每个 GET 方法只需要在开头添加这一行：

```
Seo.SeoRedirect(this); 
```

SEO 重写类自动使用 C# 5.0 的 Caller Info 属性来完成繁重的工作，使上面的代码严格地复制和粘贴。

正如我在链接的 SO Q&A 中提到的那样，我正在研究一种将其转换为属性的方法，但现在，它可以完成工作。

该代码将强制 URL 使用一种情况。大小写将与控制器方法的名称相同 - 您可以选择是否要全部大写、全部小写或两者混合（CamelCase 适用于 URL）。它将针对不区分大小写的匹配发出 301 重定向，并将结果缓存在内存中以获得最佳性能。它还将重定向尾随反斜杠（对索引列表强制执行，否则强制执行）并删除通过默认方法名称访问的重复内容（`Index`在股票 ASP.NET MVC 应用程序中）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-01-26T03:11:14.777

我真的不知道 8 年后你会有什么感觉，但是现在 ASP MVC 5 支持属性路由，以便于记住路由并解决 SEO 友好站点的重复内容问题

只需添加 routes.MapMvcAttributeRoutes(); 在您的 RouteConfig 中，然后为每个操作定义一个且唯一的路由，例如

```
 [Route("~/")]
    public ActionResult Index(int? page)
    {
        var query = from p in db.Posts orderby p.post_date descending select p;
        var pageNumber = page ?? 1;
        ViewData["Posts"] = query.ToPagedList(pageNumber, 7);         
        return View();
    }
    [Route("about")]
    public ActionResult About()
    {
        return View();
    }
    [Route("contact")]
    public ActionResult Contact()
    {
        return View();
    }
    [Route("team")]
    public ActionResult Team()
    {
        return View();
    }
    [Route("services")]
    public ActionResult Services()
    {
        return View();
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-08-03T06:26:12.720

基于 Gabe Sumner 的回答，但没有 JS、图像和其他内容的重定向。仅适用于控制器操作。这个想法是当我们已经知道它的路线时，稍后在管道中进行重定向。为此，我们可以使用 ActionFilter。

```
public class RedirectFilterAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        var url = filterContext.HttpContext.Request.Url;
        var urlWithoutQuery = url.GetLeftPart(UriPartial.Path);
        if (Regex.IsMatch(urlWithoutQuery, @"[A-Z]"))
        {
            string lowercaseURL = urlWithoutQuery.ToString().ToLower() + url.Query;
            filterContext.Result = new RedirectResult(lowercaseURL, permanent: true);
        }

        base.OnActionExecuting(filterContext);
    }
} 
```

请注意，上面的过滤器不会重定向或更改查询字符串的大小写。

然后通过将 ActionFilter 添加到 GlobalFilterCollection 将其全局绑定到所有操作。

```
filters.Add(new RedirectFilterAttribute()); 
```

最好在 RouteCollection 上仍将 LowercaseUrls 属性设置为 true。

# c# - 在事件声明中添加匿名空委托有缺点吗？

> ID：170907
> 
> 赞同：82
> 
> 时间：2008-10-04T19:41:15.103
> 
> 标签：c#, coding-style, delegates, events, idioms

我已经看到一些关于这个成语的提及（包括[在 SO 上](https://stackoverflow.com/questions/9033/hidden-features-of-c#9282)）：

```
// Deliberately empty subscriber
public event EventHandler AskQuestion = delegate {}; 
```

好处很明显 - 它避免了在引发事件之前检查 null 的需要。

**但是，我很想知道是否有任何缺点。** 例如，它是否被广泛使用并且足够透明以至于不会引起维护头痛？空事件订阅者调用是否有明显的性能影响？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-19T18:27:45.263

与其引入性能开销，不如[使用扩展方法](https://stackoverflow.com/questions/248072/evil-use-of-extension-methods)来缓解这两个问题：

```
public static void Raise(this EventHandler handler, object sender, EventArgs e)
{
    if(handler != null)
    {
        handler(sender, e);
    }
} 
```

定义后，您无需再次进行空事件检查：

```
// Works, even for null events.
MyButtonClick.Raise(this, EventArgs.Empty); 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-10-04T23:56:31.890

对于**大量使用事件并且对性能至关重要的**系统，您肯定希望至少*考虑*不这样做。使用空委托引发事件的成本大约是首先使用空检查引发事件的成本的两倍。

以下是在我的机器上运行基准测试的一些数据：

```
For 50000000 iterations . . .
No null check (empty delegate attached): 530ms
With null check (no delegates attached): 249ms
With null check (with delegate attached): 452ms 
```

这是我用来获取这些数字的代码：

```
using System;
using System.Diagnostics;

namespace ConsoleApplication1
{
    class Program
    {
        public event EventHandler<EventArgs> EventWithDelegate = delegate { };
        public event EventHandler<EventArgs> EventWithoutDelegate;

        static void Main(string[] args)
        {
            //warm up
            new Program().DoTimings(false);
            //do it for real
            new Program().DoTimings(true);

            Console.WriteLine("Done");
            Console.ReadKey();
        }

        private void DoTimings(bool output)
        {
            const int iterations = 50000000;

            if (output)
            {
                Console.WriteLine("For {0} iterations . . .", iterations);
            }

            //with anonymous delegate attached to avoid null checks
            var stopWatch = Stopwatch.StartNew();

            for (var i = 0; i < iterations; ++i)
            {
                RaiseWithAnonDelegate();
            }

            stopWatch.Stop();

            if (output)
            {
                Console.WriteLine("No null check (empty delegate attached): {0}ms", stopWatch.ElapsedMilliseconds);
            }

            //without any delegates attached (null check required)
            stopWatch = Stopwatch.StartNew();

            for (var i = 0; i < iterations; ++i)
            {
                RaiseWithoutAnonDelegate();
            }

            stopWatch.Stop();

            if (output)
            {
                Console.WriteLine("With null check (no delegates attached): {0}ms", stopWatch.ElapsedMilliseconds);
            }

            //attach delegate
            EventWithoutDelegate += delegate { };

            //with delegate attached (null check still performed)
            stopWatch = Stopwatch.StartNew();

            for (var i = 0; i < iterations; ++i)
            {
                RaiseWithoutAnonDelegate();
            }

            stopWatch.Stop();

            if (output)
            {
                Console.WriteLine("With null check (with delegate attached): {0}ms", stopWatch.ElapsedMilliseconds);
            }
        }

        private void RaiseWithAnonDelegate()
        {
            EventWithDelegate(this, EventArgs.Empty);
        }

        private void RaiseWithoutAnonDelegate()
        {
            var handler = EventWithoutDelegate;

            if (handler != null)
            {
                handler(this, EventArgs.Empty);
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2008-10-04T19:53:48.183

唯一的缺点是非常轻微的性能损失，因为您调用了额外的空委托。除此之外，没有维护费用或其他缺点。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-04T20:54:51.353

如果您正在执行 /lot/，您可能希望拥有一个可重复使用的单个静态/共享空委托，只是为了减少委托实例的数量。请注意，编译器无论如何都会缓存每个事件的这个委托（在静态字段中），因此每个事件定义只有一个委托实例，所以它不是一个*巨大*的节省 - 但也许值得。

当然，每个类中的每个实例字段仍将占用相同的空间。

IE

```
internal static class Foo
{
    internal static readonly EventHandler EmptyEvent = delegate { };
}
public class Bar
{
    public event EventHandler SomeEvent = Foo.EmptyEvent;
} 
```

除此之外，似乎还不错。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-05T04:55:44.917

我的理解是空委托是线程安全的，而空检查不是。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-08-10T18:23:23.570

除了可能的一些极端情况外，没有什么有意义的性能损失可谈。

但是请注意，这个技巧在 C# 6.0 中变得不那么相关了，因为该语言提供了一种替代语法来调用可能为 null 的委托：

```
delegateThatCouldBeNull?.Invoke(this, value); 
```

上面，空条件运算符`?.`结合了空值检查和条件调用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-05T05:41:17.973

我会说这有点危险，因为它会诱使您执行以下操作：

```
MyEvent(this, EventArgs.Empty); 
```

如果客户端抛出异常，服务器会随之处理。

那么，也许你会这样做：

```
try
{
  MyEvent(this, EventArgs.Empty);
}
catch
{
} 
```

但是，如果您有多个订阅者并且一个订阅者抛出异常，那么其他订阅者会发生什么？

为此，我一直在使用一些静态辅助方法来执行 null 检查并吞下来自订户端的任何异常（这是来自 idesign）。

```
// Usage
EventHelper.Fire(MyEvent, this, EventArgs.Empty);

public static void Fire(EventHandler del, object sender, EventArgs e)
{
    UnsafeFire(del, sender, e);
}
private static void UnsafeFire(Delegate del, params object[] args)
{
    if (del == null)
    {
        return;
    }
    Delegate[] delegates = del.GetInvocationList();

    foreach (Delegate sink in delegates)
    {
        try
        {
            sink.DynamicInvoke(args);
        }
        catch
        { }
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-30T19:17:52.203

可以定义一个简单的扩展方法来封装检查事件处理程序是否为空的常规方法，而不是“空委托”方法。它在[此处](http://kohari.org/2009/02/07/eventhandler-extension-method/)和[此处](https://stackoverflow.com/questions/340610/create-empty-c-event-handlers-automatically)进行了描述。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2010-10-23T08:56:05.150

到目前为止，这个问题的答案漏掉了一件事：**避免检查空值是很危险的**。

```
public class X
{
    public delegate void MyDelegate();
    public MyDelegate MyFunnyCallback = delegate() { }

    public void DoSomething()
    {
        MyFunnyCallback();
    }
}

X x = new X();

x.MyFunnyCallback = delegate() { Console.WriteLine("Howdie"); }

x.DoSomething(); // works fine

// .. re-init x
x.MyFunnyCallback = null;

// .. continue
x.DoSomething(); // crashes with an exception 
```

问题是：你永远不知道谁会以何种方式使用你的代码。您永远不知道，如果在某些年份的代码错误修复期间，事件/处理程序设置为 null。

总是，写 if 检查。

希望有帮助；）

ps：感谢性能计算。

pps：将其从事件案例编辑到回调示例。感谢您的反馈......我在没有 Visual Studio 的情况下“编码”了示例，并将我想到的示例调整为一个事件。对困惑感到抱歉。

ppps：不知道它是否仍然适合线程......但我认为这是一个重要的原则。另请检查[stackflow的另一个线程](https://stackoverflow.com/questions/292820/how-to-correctly-unregister-an-event-handler)

# c++ - 为 WinSocks 和 *nix 创建一个非阻塞套接字

> ID：170909
> 
> 赞同：6
> 
> 时间：2008-10-04T19:45:29.637
> 
> 标签：c++, c, asynchronous, sockets, nonblocking

在 C/C++ 中，如何在 WinSocks 和 *nix 中将阻塞套接字转换为非阻塞套接字；这样 select() 才能正常工作。您可以将预处理器用于特定于平台的代码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-04T20:05:10.063

在 Linux 上：

```
fcntl(fd, F_SETFL, O_NONBLOCK); 
```

[窗户](http://msdn.microsoft.com/en-us/library/ms738573.aspx)：

```
u_long on = 1;
ioctlsocket(fd, FIONBIO, &on); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-05T02:24:59.407

select() 应该在*阻塞*套接字上工作。它在 read() 立即返回时返回，非阻塞套接字总是如此。

# svn - apache颠覆中的SVNAutoversioning指令重要吗？

> ID：170913
> 
> 赞同：0
> 
> 时间：2008-10-04T19:49:58.067
> 
> 标签：svn, apache, auto-versioning

如果是，为什么？我知道设置它会导致更多数量的自动提交的修订。有更多的自动提交是好事吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T20:37:57.627

您可以打开它以提供 WebDav 映射，大多数操作系统可以将网络映射到 http(s):// URL。

如果 SVNAutoversioning 关闭，则无法将文件保存到这些映射中。

# list - 替换 Common Lisp 列表中的项目？

> ID：170931
> 
> 赞同：25
> 
> 时间：2008-10-04T20:08:43.973
> 
> 标签：list, lisp, replace, common-lisp

我有一个事物列表（我称之为 L）、一个索引（N）和一个新事物（NEW）。如果我想用 NEW 替换 L 在 N 的东西，最好的方法是什么？我是否应该将子列表增加到 N 并从 N 到列表末尾，然后使用列表将第一部分 NEW 和最后一部分的新列表粘合在一起？还是有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-04T21:01:53.537

```
(setf (nth N L) NEW) 
```

应该做的伎俩。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-04T20:28:37.863

你打算多久做一次；如果你真的想要一个数组，你应该使用一个[数组](http://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node158.html)。否则，是的，创建一个由前 N 个元素、新元素和尾部的副本组成的新列表的函数就可以了。我不知道有什么内置的，但我有一段时间没有用 Lisp 编程了。

这是 Scheme 中的一个解决方案（因为我知道它比 Common Lisp 更好，并且有一个解释器来检查我的工作）：

```
(define (replace-nth list n elem)
  (cond
    ((null? list) ())
    ((eq? n 0) (cons elem (cdr list)))
    (#t (cons (car list) (replace-nth (cdr list) (- n 1) elem))))) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-05T15:07:21.240

```
(setf (nth N L) T) 
```

如果您要做的是“破坏性”修改，即实际更改现有列表，则这是最清晰，最简洁，最快的方法。它不分配任何新内存。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-05T15:30:15.063

我只是尝试修复 hazzen 的代码：

```
(define (replace-nth list n elem)
  (cond 
    ((null? list) ())
    ((eq? n 0) (cons elem list))
    (#t (cons(car list) (replace-nth (cdr list) (- n 1) elem)))))

> (replace-nth (list 3 2 9 2) 2 8)
(3 2 8 9 2) 
```

此代码在列表中插入了新元素。如果我们想替换一个元素：

```
(define (replace-nth list n elem)
  (cond 
    ((null? list) ())
    ((eq? n 0) (cons elem (cdr list)))
    (#t (cons(car list) (replace-nth (cdr list) (- n 1) elem)))))

> (replace-nth (list 3 2 9 2) 2 8)
(3 2 8 2) 
```

0 <= n <= 长度（列表）- 1

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-05T02:32:51.340

hazzen 的建议很好（使用数组），因为您可能想做很多这些破坏性的更新，而列表在随机访问时效率很低。最简单的方法

```
(setq A (make-array 5) :initial-contents '(4 3 0 2 1))
(setf (elt 2 A) 'not-a-number) 
```

其中 A 是一个数组（尽管`elt`适用于任何序列）。

*   [定义，以及的`elt`例子`setf`](http://www.lispworks.com/documentation/HyperSpec/Body/f_elt.htm)。
*   [定义和`make-array`例子](http://www.lispworks.com/documentation/HyperSpec/Body/f_mk_ar.htm)

但是，如果您*必须*具备功能，那就是

1.  您想保留旧列表和新列表
2.  您希望新旧共享尽可能多的内存。

然后你应该使用与 hazzen 代码等效的 Common Lisp：

```
(defun replace1 (list n elem)
  (cond
    ((null list) ())
    ((= n 0) (cons elem list))
    (t (cons (car list) (replace1 (cdr list) (1- n) elem))))) 
```

这看起来很慢，因为它确实很慢，这可能就是它没有包含在标准中的原因。

hazzen 的代码是 Scheme 版本，有用的是你正在使用的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-09T04:37:20.947

使用 [REPLACE][1] （我使用 X 而不是你的 T 因为 T 是 Lisp 中的真实值）：

```
(replace L (list X) :start1 N) 
```

[1]：[http](http://www.lispworks.com/documentation/HyperSpec/Body/f_replac.htm) ://www.lispworks.com/documentation/HyperSpec/Body/f_replac.htm替换

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-04T20:27:04.950

听起来你想要 rplaca 或替换。请参阅[http://www.lispworks.com/documentation/HyperSpec/Body/f_rplaca.htm](http://www.lispworks.com/documentation/HyperSpec/Body/f_rplaca.htm)或[http://www.lispworks.com/documentation/HyperSpec/Body/f_replac.htm#replace](http://www.lispworks.com/documentation/HyperSpec/Body/f_replac.htm#replace)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-02-09T10:10:58.183

很快你就可以用 JS 在[list-replace上做到这一点](http://list-replace.info)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-05T04:42:45.370

正如其他人所指出的，显而易见的解决方案很慢并且使用内存。如果可能，您应该尝试推迟替换元素，直到您需要对列表执行另一个元素操作，例如`(loop for x in list do ...)`.

这样，您将摊销掉 consing（内存）和迭代（cpu）。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2011-02-08T00:25:42.603

```
(defun replace-nth-from-list  (list n elem)  
      (cond  
        ((null list) ())  
        (t (append (subseq list 0 n) elem (subseq list (+ 1 n)(length list)))))) 
```

# javascript - 使用 John Resig 的 Processing.js 是否合理？

> ID：170937
> 
> 赞同：9
> 
> 时间：2008-10-04T20:17:06.717
> 
> 标签：javascript, graphics, canvas

我正在考虑制作一个使用相当密集的 JavaScript/canvas 的网站，并且我一直在研究[Processing.js](http://ejohn.org/blog/processingjs/)，在我看来，它会使操作画布变得更加容易。有谁知道我**不应该**使用 Processing.js 的任何原因吗？我知道旧的浏览器将无法使用它，但现在没关系。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T20:33:24.033

如果您对它在 IE7 中不起作用感到满意，那就去吧。我已经让它在 Firefox 3 中工作。这是一种将 Silverlight/Flash 效果带到您的页面的巧妙方法。

我的预感是，像 Processing.js 这样的库将在快速路径上进行更改或升级，因此请准备好在它们运行时运行并跟上新功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T01:41:47.483

如前所述，Processing.js（包括 IE8 beta）不支持 IE。与仅使用画布相比，我还发现 processing.js 在性能方面有点慢（特别是如果您使用处理语言解析字符串，而不是使用 javascript API）。

我个人更喜欢 canvas API 而不是处理包装器，因为它给了我更多的控制权。例如：

处理 line() 函数是这样实现的（大致）：

```
function line (x1, y1, x2, y2) {
  context.beginPath();
  context.moveTo(x1, y1);
  context.lineTo(x2, y2);
  context.closePath();
  context.stroke();
}; 
```

你会像这样使用它（假设你使用的是 javascript-exposed API）：

```
var p = Processing("canvas")
p.stroke(255)

////Draw lines...///
p.line(0,0,10,10)
p.line(10,10,20,10)
//...and so on
p.line(100,100,200,200)
////End lines//// 
```

请注意，每个 line() 调用都必须打开和关闭一个新路径，而使用 canvas API，您可以在单个 beginPath/endPath 块中绘制所有线条，从而显着提高性能：

```
context.strokeStyle = "#fff";
context.beginPath();

////Draw lines...///
context.moveTo(0, 0);
context.lineTo(10, 10);
context.lineTo(20, 10);
//...so on
context.lineTo(200, 200);
////End lines...///

context.closePath();
context.stroke(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T01:36:01.473

它不会简化画布上的绘图。如果您使用画布，它的作用是简化动画任务。如果您正在制作动画并且不关心完整的浏览器支持，请使用 Processing.js。如果您不制作动画（例如，如果您正在制作图表或圆角），则不要添加 Processing.js 的开销。

无论哪种方式，我都建议您学习如何直接使用画布 API。了解 canvas api，尤其是转换，即使您使用的是 Processing.js，也会对您有很大帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T21:32:46.050

我会说改用Flash。安装 Flash 的浏览器数量超过了使用 processing.js 的浏览器数量。此外，与使用 JavaScript 相比，您将从 Flash 中获得更好的性能（至少目前，虽然有一些项目正在加快 JS 的速度，但仍有一点距离）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-02-28T17:56:54.200

尝试新的 javascript 实现 p5js [p5js.org](http://p5js.org)

哦，针对Leo的回答，你其实不用在处理或者p5js中使用*line*函数，有单独的*beingShape*和*beingPath*函数，类似于canvas api。

# php - HTTP 请求被视为超时的默认时间是多少？

> ID：170938
> 
> 赞同：3
> 
> 时间：2008-10-04T20:19:59.067
> 
> 标签：php, http, timeout

对于 PHP，HTTP 请求被视为超时的默认时间是多少？

我正在使用 PECL HTTP 扩展来发出 HTTP 请求。我可以在发出请求时设置超时限制，但是如果没有明确指定，我想知道默认值是什么。

我已经通过 PHP 手册进行了搜索，但无济于事。我希望得到证据支持的答案，例如相关手册页的链接，而不是推测性建议。

我很想知道默认超时*实际上*不仅仅是它*可能*是什么。我可以猜测它可能*是*30 秒，因为这似乎是一个合理的值，但是我找不到任何可以证实或否认这一点的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T20:23:29.560

我很确定您正在寻找的是[default_socket_timeout](http://www.php.net/manual/en/filesystem.configuration.php#ini.default-socket-timeout) php.ini 选项。看起来默认值为 60 秒。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-01-26T11:52:15.463

仅供将来参考：[http ://svn.php.net/viewvc/pecl/http/trunk/http_request_api.c?view=markup](http://svn.php.net/viewvc/pecl/http/trunk/http_request_api.c?view=markup)

如果我理解正确，默认的超时选项值为：

*   *超时*= `CURLOPT_TIMEOUT_MS`| `CURLOPT_TIMEOUT`= 0（表示“无限期等待”）
*   *连接超时*= `CURLOPT_CONNECTTIMEOUT_MS`| `CURLOPT_CONNECTTIMEOUT`= 3
*   *dns_cache_timeout* = `CURLOPT_DNS_CACHE_TIMEOUT`= 60

# hardware - 如何指定您的软件需要的硬件？

> ID：170939
> 
> 赞同：1
> 
> 时间：2008-10-04T20:21:32.823
> 
> 标签：hardware

这是我现在面临的一个问题。我需要指定将运行我的软件的硬件。问题是：项目还没有完成，我需要它在“真实”条件下运行才能继续，我无法在家里复制；我可以在家里测试的东西几乎不会刮伤它们。我们没有太多钱可以花（这是大学里的一项研究）。感觉像是第22条。

在没有模拟准确工作条件的方法的情况下，如何获得所需设置的良好近似值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T20:42:12.813

如果您需要在比您自己的机器规格更少的机器上测试您的设置，那么您可以使用虚拟 pc 设置来测试它，并不断减少虚拟 pc 设置，直到您的软件停止充分运行。

如果反过来，那么我认为，正如保罗所说，这是一个乞讨或借贷的情况，直到你得到你需要的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T20:24:56.467

难道你不能乞求、借用或窃取你能得到的最大硬件，然后一旦它处于那些“真实”条件下，就开始通过硬件更改（移除内存、降频）或软件（运行其他消耗资源的程序）来降低容量内存或 CPU 周期），直到您发现它无法正常工作，然后指定满足或超过这些条件的最低硬件级别？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-28T16:00:48.770

不知道为什么今天这会出现在我的列表顶部，但请允许我也建议：

租亚马逊 | “听起来足够大”的 RackSpace 云实例并在其上试用您的应用程序。你可以得到你想要的任何硬件规模的一个很好的近似值——如果你在 PC 类型的硬件范围内谈论，而不是，“我认为我们需要几个 Cray 在这里......”< /p>

# xml - 找出来自 RSS 提要的新数据，并与数据库中已有的条目进行比较。然后将新条目放入数据库中。如何？

> ID：170950
> 
> 赞同：1
> 
> 时间：2008-10-04T20:31:50.010
> 
> 标签：xml, rss

假设我有一个数据库和一个 RSS 提要。我必须找出来自 RSS 提要的新数据是什么，这些数据还没有在数据库中。你将如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T20:39:17.187

如何为每个 RSS 项目生成一个哈希码或一些唯一标识符，然后将其存储在数据库中？然后，您只需为新 RSS 中的每个项目生成哈希码，并对照数据库进行检查。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T20:47:35.190

首先，您必须唯一标识每个项目。这是有问题的，因为有些站点使用该`guid`元素而有些站点不使用，并且对于某些项目，该`link`元素永远不会更改，而对于某些项目却会。我认为一般的经验法则是，如果一个项目有一个`guid`你用它作为键，否则你使用`link`作为键和希望。

一旦您确定了一个项目的键，您可以（可能）通过检查`pubDate`元素来确定您正在查看的项目是否已更新，如果故事更新，则应该更新该元素。

这种方法可以处理大多数情况，但与 RSS 相关的所有事情一样，如果提要提供者行为不正确，它就会崩溃。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T20:37:19.063

大多数 RSS 提要对每个故事都有一个日期 - 因此，进行查询以从数据库中提取最新故事的日期，从 RSS 提要中提取所有最新故事，并比较日期。

这还取决于这是否适用于一个特定的提要，或者您是否正在编写适用于许多提要的内容。如果它应该适用于所有提要，请使用其中一种散列方法；创建标题和日期的哈希并将其用作唯一标识符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T20:34:19.770

从 rss 提要中特定项目的唯一字段中提取。然后检查该项目是否已经在数据库中。在循环中运行此逻辑。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T20:40:11.770

顺便提几个建议：

*   对提要中的每个项目执行校验和，将结果存储在数据库中。将数据库中的结果与来自 RSS 源的每个新文件/流进行比较。
*   哈希标题。每个项目的日期和时间并存储在数据库中。与每个刷新的 RSS 流进行比较。

# ruby - 如何找到我的 Ruby 程序在哪个操作系统上运行？

> ID：170956
> 
> 赞同：92
> 
> 时间：2008-10-04T20:36:40.593
> 
> 标签：ruby, operating-system

我希望我的 Ruby 程序在 Mac 上和在 Windows 上做不同的事情。如何找出我的程序在哪个系统上运行？

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2008-10-04T21:17:49.323

使用`RUBY_PLATFORM`常量，并可选择将其包装在模块中以使其更友好：

```
module OS
  def OS.windows?
    (/cygwin|mswin|mingw|bccwin|wince|emx/ =~ RUBY_PLATFORM) != nil
  end

  def OS.mac?
   (/darwin/ =~ RUBY_PLATFORM) != nil
  end

  def OS.unix?
    !OS.windows?
  end

  def OS.linux?
    OS.unix? and not OS.mac?
  end

  def OS.jruby?
    RUBY_ENGINE == 'jruby'
  end
end 
```

它并不完美，但适用于我进行开发的平台，并且很容易扩展。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2013-10-16T18:29:08.377

（警告：阅读@Peter Wagenet 的评论）我喜欢这个，大多数人使用 ruby​​gems [，](http://rubygems.rubyforge.org/rubygems-update/Gem/Platform.html)它可靠，是跨平台的

```
irb(main):001:0> Gem::Platform.local
=> #<Gem::Platform:0x151ea14 @cpu="x86", @os="mingw32", @version=nil>
irb(main):002:0> Gem::Platform.local.os
=> "mingw32" 
```

**更新**与[“更新！添加！如今的 Rubygems...”](https://stackoverflow.com/questions/170956/how-can-i-find-which-operating-system-my-ruby-program-is-running-on/40946277#40946277)结合使用，以减轻何时`Gem::Platform.local.os == 'java'`

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-04T20:41:57.993

任何一个

```
irb(main):002:0> require 'rbconfig'
=> true
irb(main):003:0> Config::CONFIG["arch"]
=> "i686-linux" 
```

或者

```
irb(main):004:0> RUBY_PLATFORM
=> "i686-linux" 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-01-13T02:28:00.447

我有第二个答案，为战斗添加更多选项。 [os ruby​​gem](http://rubygems.org/gems/os)和他们的[github 页面](https://github.com/rdp/os)有一个相关的项目列表。

```
需要“操作系统”

>> OS.windows？
=> true # 还是 OS.doze？

>> 操作系统.bits
=> 32

>> OS.java？
=> true # 如果你在 jruby 中运行。还有 OS.jruby？

>> OS.ruby_bin
=> "c:\ruby18\bin\ruby.exe" # 或者 "/usr/local/bin/ruby" 或者什么不是

>> OS.posix？
=> false # 对于 linux、os x、cygwin 为 true

>> OS.mac？# 还是 OS.osx？还是 OS.x？
=> 假的

```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-05T00:18:39.740

**试试 Launchy gem** ( `gem install launchy`)：

```
require 'launchy'
Launchy::Application.new.host_os_family # => :windows, :darwin, :nix, or :cygwin 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-10-17T15:22:08.743

```
require 'rbconfig'
include Config

case CONFIG['host_os']
  when /mswin|windows/i
    # Windows
  when /linux|arch/i
    # Linux
  when /sunos|solaris/i
    # Solaris
  when /darwin/i
    #MAC OS X
  else
    # whatever
end 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-12-03T09:31:50.633

**更新！添加！**Rubygems 现在随[`Gem.win_platform?`](https://github.com/rubygems/rubygems/blob/f68cdada86721d3adf4e8c106d277f99d2067cd6/lib/rubygems.rb#L1065-L1072).

[Rubygems repo 中的示例用法](https://github.com/rubygems/rubygems/search?utf8=%E2%9C%93&q=win_platform%3F)，以及这个，为了清楚起见：

```
def self.ant_script
  Gem.win_platform? ? 'ant.bat' : 'ant'
end 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-03-14T17:54:25.997

对于大多数 Ruby 安装中已经为您处理过的易于访问的东西，我推荐这些：

1.  `Gem::Platform.local.os`#=> 例如。“mingw32”、“java”、“linux”、“cygwin”、“aix”、“dalvik”（[代码](https://github.com/rubygems/rubygems/blob/f68cdada86721d3adf4e8c106d277f99d2067cd6/lib/rubygems/platform.rb#L79..L103)）
2.  `Gem.win_platform?`#=> 例如。真假（[代码](https://github.com/rubygems/rubygems/blob/f68cdada86721d3adf4e8c106d277f99d2067cd6/lib/rubygems.rb#L1065-L1072)）

这些以及我所知道的所有其他平台检查脚本都是基于解释这些基础变量：

1.  `RbConfig::CONFIG["host_os"]`#=> 例如。“linux-gnu” （[代码](https://github.com/ruby/ruby/blob/e4f46eabab70bfcde67f0032a902433d11afc166/tool/mkconfig.rb)[1、2](https://github.com/ruby/ruby/blob/bd8cb9f5d268881a49819a1996d3dffdb951168e/win32/Makefile.sub#L962)）
2.  `RbConfig::CONFIG["arch"]`#=> 例如。“i686-linux”、“i386-linux-gnu”（[编译 Ruby 解释器时作为参数](https://github.com/ruby/ruby/blob/e4f46eabab70bfcde67f0032a902433d11afc166/tool/mkconfig.rb#L13)传递）
3.  `RUBY_PLATFORM`#=> 例如。"i386-linux-gnu", "darwin" -*注意这在 JRuby 中返回 "java"！*（[代码](https://github.com/ruby/ruby/blob/842272540886ff1da58e690907b08f2811a86607/version.c#L63)）
    *   这些都是 Windows 变体：`/cygwin|mswin|mingw|bccwin|wince|emx/`
4.  `RUBY_ENGINE`#=> 例如。“红宝石”，“红宝石”

如果您不介意依赖关系并且想要更用户友好的东西，则可以使用库。具体来说，**[OS](https://github.com/rdp/os)**提供了类似`OS.mac?`or的方法`OS.posix?`。**[Platform](https://github.com/kraigstrong/platform)**可以很好地区分各种 Unix 平台。`Platform::IMPL`将返回，例如。：linux，：freebsd，：netbsd，：hpux。**[sys-uname](https://github.com/djberg96/sys-uname)**和**[sysinfo](https://github.com/delano/sysinfo/blob/master/lib/sysinfo.rb#L16)**类似。**[utilinfo](https://github.com/ArunSahadeo/utilinfo)**非常基础，在 Windows、Mac 和 Linux 之外的任何系统上都会失败。

如果您想要具有特定系统详细信息的更高级库，例如不同的 Linux 发行版，请参阅我对[Detecting Linux distribution in Ruby](https://stackoverflow.com/a/55087176/5389585)的回答。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-01-19T16:09:43.047

到目前为止，我们使用以下代码做得很好

```
 def self.windows?
    return File.exist? "c:/WINDOWS" if RUBY_PLATFORM == 'java'
    RUBY_PLATFORM =~ /mingw32/ || RUBY_PLATFORM =~ /mswin32/
  end

  def self.linux?
    return File.exist? "/usr" if RUBY_PLATFORM == 'java'
    RUBY_PLATFORM =~ /linux/
  end

  def self.os
    return :linux if self.linux?
    return :windows if self.windows?
    nil
  end 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-02-11T17:44:49.547

`os`在为 IMGKit 加载不同的二进制文件时使用gem

```
# frozen_string_literal: true
IMGKit.configure do |config|
  if OS.linux? && OS.host_cpu == "x86_64"
    config.wkhtmltoimage =
      Rails.root.join("bin", "wkhtmltoimage-linux-amd64").to_s
  elsif OS.mac? && OS.host_cpu == "x86_64"
    config.wkhtmltoimage =
      Rails.root.join("bin", "wkhtmltoimage-macos-amd64").to_s
  else
    puts OS.report
    abort "You need to add a binary for wkhtmltoimage for your OS and CPU"
  end
end 
```

* * *

## 回答 #11

> 赞同：-7
> 
> 时间：2013-09-27T09:40:34.843

当我只需要知道它是 Windows 还是类 Unix 操作系统时，通常就足够了

```
is_unix = is_win = false
File::SEPARATOR == '/' ? is_unix = true : is_win = true 
```

# git - 用 Git 处理 CRLF（回车、换行）的策略是什么？

> ID：170961
> 
> 赞同：650
> 
> 时间：2008-10-04T20:39:28.013
> 
> 标签：git, cross-platform, newline, eol

我尝试使用以 CRLF 结尾的行提交文件，但失败了。

我花了一整天的时间在我的 Windows 电脑上尝试不同的策略，几乎被吸引停止尝试使用 Git 而是尝试[Mercurial](http://en.wikipedia.org/wiki/Mercurial)。

如何正确处理 CRLF 行尾？

* * *

## 回答 #1

> 赞同：811
> 
> 时间：2012-06-01T18:56:35.800

问了这个问题快四年了，我终于找到**了一个让我完全满意的答案**！

请参阅**github:help**[处理行尾](https://help.github.com/articles/dealing-with-line-endings/)的指南中 的详细信息。

> Git 允许您直接使用文件中 的[text 属性](http://git-scm.com/docs/gitattributes#_checking-out_and_checking-in)**`.gitattributes`**为 repo 设置行结束属性。该文件被提交到 repo 并覆盖`core.autocrlf`设置，允许您确保所有用户的行为一致，而不管他们的 git 设置如何。

因此

> 这样做的好处是您的终端配置现在随您的存储库一起传输，您无需担心协作者是否具有正确的全局设置。

这是一个**`.gitattributes`**文件的例子

```
# Auto detect text files and perform LF normalization
*        text=auto

*.cs     text diff=csharp
*.java   text diff=java
*.html   text diff=html
*.css    text
*.js     text
*.sql    text

*.csproj text merge=union
*.sln    text merge=union eol=crlf

*.docx   diff=astextplain
*.DOCX   diff=astextplain

# absolute paths are ok, as are globs
/**/postinst* text eol=lf

# paths that don't start with / are treated relative to the .gitattributes folder
relative/path/*.txt text eol=lf 
```

对于最流行的编程语言，有一个方便[的即用型 .gitattributes 文件集合。](https://github.com/Danimoth/gitattributes)帮助您入门很有用。

一旦你创建或调整了你的**`.gitattributes`**，你应该执行一次一劳永逸的[行尾重新规范化](https://help.github.com/articles/dealing-with-line-endings/#refreshing-a-repository-after-changing-line-endings)。

请注意，在您在应用中打开项目的 Git 存储库后， [GitHub 桌面](https://desktop.github.com)应用可以建议和创建文件。**`.gitattributes`**要尝试这样做，请单击齿轮图标（在右上角）> 存储库设置 ...> 行尾和属性。您将被要求添加推荐的**`.gitattributes`**内容，如果您同意，该应用程序还将对您的存储库中的所有文件执行规范化。

最后，请[注意行尾](http://adaptivepatchwork.com/2012/03/01/mind-the-end-of-your-line/)文章提供了更多背景信息，并解释了 Git 在手头的问题上是如何演变的。我认为这是*必读*的。

您的团队中可能有用户使用 EGit 或 JGit（Eclipse 和 TeamCity 等工具使用它们）来提交他们的更改。然后你不走运，正如@gatinueta 在这个答案的评论中解释的那样：

> 如果您的团队中有使用 Egit 或 JGit 的人，此设置将无法完全满足您的要求，因为这些工具只会忽略 .gitattributes 并愉快地签入 CRLF 文件[https://bugs.eclipse.org/bugs/show_bug.cgi?编号=342372](https://bugs.eclipse.org/bugs/show_bug.cgi?id=342372)

一个技巧可能是让他们在另一个客户端中提交他们的更改，比如[SourceTree](http://www.sourcetreeapp.com)。那时，我们的团队在许多用例中更喜欢使用该工具而不是 Eclipse 的 EGit。

谁说软件很简单？：-/

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2008-10-04T20:42:06.417

不要转换行尾。解释数据不是 VCS 的工作——只是存储和版本化它。无论如何，每个现代文本编辑器都可以读取这两种行尾。

* * *

## 回答 #3

> 赞同：83
> 
> 时间：2009-07-10T22:36:55.893

**`autocrlf=input`除非您真的知道自己在做什么，否则您几乎总是想要。**

下面的一些附加上下文：

> `core.autocrlf=true`如果你喜欢 DOS 结尾或者`core.autocrlf=input`你喜欢 unix-newlines ，它应该是。在这两种情况下，您的 Git 存储库都将只有 LF，这是正确的。唯一的论点`core.autocrlf=false`是自动启发式可能会错误地将某些二进制文件检测为文本，然后您的图块将被损坏。因此， `core.safecrlf`引入了选项以在发生不可逆转的变化时警告用户。事实上，不可逆转的更改有两种可能性——文本文件中的混合行尾，在这种规范化中是可取的，所以可以忽略这个警告，或者（非常不可能）Git 错误地将你的二进制文件检测为文本。然后你需要使用属性告诉Git这个文件是二进制的。

上述段落最初是从 gmane.org 上的一个线程中提取的，但此后它已被删除。

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2012-06-26T01:18:10.747

在混合环境（Microsoft + Linux + Mac）中**获得一致**的行尾的两种替代策略：

# A. 全局[所有存储库设置](https://help.github.com/articles/dealing-with-line-endings#platform-all)

1.  **全部转换[为一种格式](https://stackoverflow.com/questions/7068179/convert-line-endlings-for-whole-directory-tree-git)**

    ```
    find . -type f -not -path "./.git/*" -exec dos2unix {} \;
    git commit -a -m 'dos2unix conversion' 
    ```

2.  **在 Linux/UNIX 或MS Windows（存储库或全局）上设置`core.autocrlf`为`input``true`**

    ```
    git config --global core.autocrlf input 
    ```

3.  （可选）设置`core.safecrlf`为`true`（停止）或`warn`（唱歌：）以添加额外的保护比较，如果反向换行符转换会导致相同的文件

    ```
    git config --global core.safecrlf true 
    ```

# B. 或[按存储库设置](http://git-scm.com/docs/gitattributes#_end-of-line_conversion)

1.  **全部转换[为一种格式](https://stackoverflow.com/questions/7068179/convert-line-endlings-for-whole-directory-tree-git)**

    ```
    find . -type f -not -path "./.git/*" -exec dos2unix {} \;
    git commit -a -m 'dos2unix conversion' 
    ```

2.  **将`.gitattributes`文件添加到您的存储库**

    ```
    echo "* text=auto" > .gitattributes
    git add .gitattributes
    git commit -m 'adding .gitattributes for unified line-ending' 
    ```

不要担心你的二进制文件——Git 应该对它们足够聪明。

* * *

[有关 safecrlf/autocrlf 变量的更多信息](http://git-scm.com/docs/git-config#_variables)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2017-09-21T15:17:27.433

### --- 更新 3 ---（与更新 2 不冲突）

考虑到 windows 用户更喜欢处理`CRLF`而 linux/mac 用户更喜欢处理`LF`文本文件的情况。**从存储库维护者**的角度提供答案：

对我来说，**最好的策略**（要解决的问题更少）是：将**所有文本文件**保存在**`LF`git repo**中，即使您正在处理仅限 Windows 的项目。然后**让客户自由地**使用他们偏好的**行尾样式**，前提是他们在暂存文件以进行提交时选择了一个尊重您的策略的`core.autocrlf`属性值**（LF on repo） 。**

**分期**是许多人在试图**了解****换行策略**如何工作时感到困惑的地方。`core.autocrlf`在选择正确的财产价值之前，必须了解以下几点：

*   添加文本文件以进行提交（**暂存**它）就像将文件复制到具有**转换的行尾**的子目录内**的另一个位置**（取决于您的客户端配置中的值）。所有这些都是在**本地完成的。**`.git/`**`core.autocrlf`**
*****   设置`core.autocrlf`就像提供问题的**答案（在所有操作系统上完全相同的问题）：** “应该 git-client:
    *   **一种。** *从远程签出（拉出）repo 更改时将 LF 转换为 CRLF*吗？
    *   **湾。** *添加文件以提交时将CRLF转换为LF？*"*   可能的答案（值）是：
    *   `false:`“***以上都不****做”***，**
    ***   `input:`“*只做**b*** ”*   `true`: "*做**a 和 b*** "*   请注意，没有“*只做一个*”******

 ******幸运的是**

*   git 客户端默认值（windows: `core.autocrlf: true`, linux/mac: `core.autocrlf: false`）将与**LF-only-repo**策略兼容。
    **含义**：默认情况下，Windows 客户端将在签出存储库时转换为 CRLF，并在添加提交时转换为 LF。默认情况下，Linux 客户端不会进行任何转换。从理论上讲，这使您的 repo 仅保留。

**很遗憾：**

*   可能有不尊重 git`core.autocrlf`值的 GUI 客户端
*   可能有些人不使用价值来尊重您的 lf-repo 策略。例如，他们使用`core.autocrlf=false`并添加带有 CRLF 的文件以进行提交。

**要检测上述客户端提交的 ASAP 非 lf 文本文件，**您可以按照 --- update 2 ---: ( `git grep -I --files-with-matches --perl-regexp '\r' HEAD`，在使用：`--with-libpcre`标志​​编译的客户端上)中的描述进行操作

**这里有一个问题：**。我作为 repo 维护者保留一个`git.autocrlf=input`，以便我可以通过再次添加它们来修复任何错误提交的文件以进行提交。我提供了一个提交文本：“修复错误提交的文件”。

就事论事而言`.gitattributes`。我不指望它，因为有更多的ui客户端不理解它。我只用它来为文本和二进制文件提供提示，并可能标记一些应该在任何地方都保持相同行尾的特殊文件：

```
*.java          text !eol # Don't do auto-detection. Treat as text (don't set any eol rule. use client's)
*.jpg           -text     # Don't do auto-detection. Treat as binary
*.sh            text eol=lf # Don't do auto-detection. Treat as text. Checkout and add with eol=lf
*.bat           text eol=crlf # Treat as text. Checkout and add with eol=crlf 
```

### 问题：但是为什么我们对换行处理策略感兴趣呢？

**回答：**为避免**单个字母更改提交，显示为 5000 行更改**，因为执行更改的客户端在添加提交之前将完整文件从 crlf 自动转换为 lf（或相反）。当涉及**解决冲突**时，这可能会**相当痛苦**。或者在某些情况下它可能是不合理冲突的原因。

 *** * *

### --- 更新 2 ---

git 客户端的默认设置在大多数情况下都会起作用。即使您只有 Windows 客户端、Linux 客户端或两者都有。这些都是：

*   **windows：** `core.autocrlf=true`表示结帐时将行转换为 CRLF，添加文件时将行转换为 LF。
*   **linux：** `core.autocrlf=input`意味着不要在结帐时转换行（不需要，因为文件预计会使用 LF 提交），并在添加文件时将行转换为 LF（如果需要）。( ***-- update3 --*** : 似乎这是`false`默认设置，但又没问题)

该属性可以在不同的范围内设置。我建议明确设置`--global`范围，以避免最后描述的一些 IDE 问题。

```
git config core.autocrlf
git config --global core.autocrlf
git config --system core.autocrlf
git config --local core.autocrlf
git config --show-origin core.autocrlf 
```

另外，我强烈**反对****在 Windows 上** 使用`git config --global core.autocrlf false`（如果您只有 Windows 客户端） ，这与[git 文档](https://git-scm.com/book/en/v2/Customizing-Git-Git-Configuration#_code_core_autocrlf_code)**中的建议相反** 。设置为 false 将在 repo 中提交带有 CRLF 的文件。但是真的没有理由。您永远不知道是否需要与 linux 用户共享项目。另外，对于每个加入项目而不是使用默认值的客户来说，这是一个额外的步骤。

现在对于某些特殊情况下的文件（例如`*.bat` `*.sh`），您可以使用 LF 或 CRLF 检出它们`.gitattributes`

总结一下我的**最佳实践**是：

*   确保在 git repo 上使用 LF 提交每个非二进制文件（默认行为）。
*   使用此命令确保没有使用 CRLF 提交任何文件：（`git grep -I --files-with-matches --perl-regexp '\r' HEAD`注意**：**在 windows 客户端上仅在使用in编译时才通过`git-bash`和在 linux 客户端上工作）。`--with-libpcre``./configure`
*   如果您通过执行上述命令找到任何此类文件，请更正它们。这涉及（至少在linux上）：
    *   设置`core.autocrlf=input`( **--- 更新 3 --** )
    *   更改文件
    *   还原更改（文件仍显示为已更改）
    *   提交它
*   仅使用最低限度`.gitattributes`
*   指示用户`core.autocrlf`将上述设置为其默认值。
*   不要指望 100% 的存在`.gitattributes`。IDE 的 git-clients 可能会忽略它们或区别对待它们。

如前所述，可以在 git 属性中添加一些内容：

```
# Always checkout with LF
*.sh            text eol=lf
# Always checkout with CRLF
*.bat           text eol=crlf 
```

我认为其他一些安全选项可以`.gitattributes`代替对二进制文件使用自动检测：

*   `-text`（例如 for `*.zip`or `*.jpg`files：不会被视为文本。因此不会尝试行尾转换。通过转换程序可以实现差异）
*   `text !eol`（例如 for `*.java`, `*.html`: 被视为文本，但未设置 eol 样式首选项。因此使用客户端设置。）
*   `-text -diff -merge`（例如`*.hugefile`：不被视为文本。没有差异/合并可能）

### --- 以前的更新 ---

错误提交文件的客户端的一个**痛苦示例：**

**netbeans 8.2**（在 Windows 上）将错误地提交所有带有**CRLF 的文本文件，除非**您已**明确**设置**`core.autocrlf`为 global**。这与标准的 git 客户端行为相矛盾，并在以后更新/合并时导致很多问题。这就是使某些 **文件看起来不同**（尽管它们不是）的原因**，即使您恢复**.
即使您已将正确添加`.gitattributes`到项目中，netbeans 中也会发生相同的行为。

在提交后使用以下命令，至少可以帮助您及早检测您的 git repo 是否存在行尾问题：`git grep -I --files-with-matches --perl-regexp '\r' HEAD`

~~我花了几个小时想出最好的使用方法`.gitattributes`，最终意识到我不能指望它。
不幸的是，只要存在基于 JGit 的编辑器（无法`.gitattributes`正确处理），安全的解决方案就是在任何地方强制使用 LF，即使在编辑器级别也是如此。~~

使用以下`anti-CRLF`消毒剂。

~~*   windows/linux客户端： `core.autocrlf=input`

    *   承诺`.gitattributes`： `* text=auto eol=lf`~~ 
*   ~~已提交`.editorconfig`（[http://editorconfig.org/](http://editorconfig.org/)），这是一种标准化格式，与编辑器插件相结合：

    ~~*   [https://github.com/editorconfig/](https://github.com/editorconfig/)~~
    *   ~~[https://github.com/welovecoding/editorconfig-netbeans/](https://github.com/welovecoding/editorconfig-netbeans/)~~~~ 

 ~~* * *

## 回答 #6

> 赞同：11
> 
> 时间：2011-03-16T03:10:52.540

`core.autocrlf=false`当我在[Visual Studio 2010](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2010)项目中签出所有文件时，使用会阻止所有文件被标记为已更新。开发团队的另外两名成员也使用 Windows 系统，因此混合环境没有发挥作用，但存储库附带的默认设置始终将所有文件标记为克隆后立即更新。

我想底线是找到适合您环境的 CRLF 设置。特别是因为在我们的 Linux 机器上的许多其他存储库中，设置`autocrlf = true`会产生更好的结果。

20 多年过去了，我们仍在处理操作系统之间的行尾差异……可悲。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-10-05T03:50:12.263

尝试将`core.autocrlf`配置选项设置为`true`. 也看看这个`core.safecrlf`选项。

实际上，听起来`core.safecrlf`可能已经在您的存储库中设置了，因为（强调我的）：

> 如果 core.autocrlf 的当前设置不是这种情况，*git 将拒绝该文件*。

如果是这种情况，那么您可能需要检查您的文本编辑器是否配置为一致地使用行尾。如果文本文件包含 LF 和 CRLF 行尾的混合，您可能会遇到问题。

最后，我觉得在 Windows 上简单地“使用你给定的”和使用 LF 终止行的建议会导致比它解决的问题更多的问题。Git 有上述选项可以尝试以合理的方式处理行尾，因此使用它们是有意义的。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2016-02-14T23:02:41.947

*这是与Mac*或*Linux*用户共享代码的*Windows*和*Visual Studio*用户的两个选项。有关详细说明，请阅读[gitattributes 手册](http://git-scm.com/docs/gitattributes)。

 **# * 文字=自动

在您的回购`.gitattributes`文件中添加：

```
*   text=auto 
```

这将规范化`LF`repo 中所有行结尾的文件。

并且根据您的操作系统（`core.eol`设置），工作树中的文件将被标准化`LF`为基于 Unix 的系统或`CRLF`Windows 系统。

这是[Microsoft .NET](https://github.com/dotnet/corefx/)存储库使用的配置。

例子：

```
Hello\r\nWorld 
```

将在 repo 中标准化为：

```
Hello\nWorld 
```

结帐时，Windows 中的工作树将转换为：

```
Hello\r\nWorld 
```

在结帐时，Mac 中的工作树将保留为：

```
Hello\nWorld 
```

> 注意：如果您的 repo 已经包含未规范化的`git status`文件，下次您对它们进行任何更改时，这些文件将显示为已完全修改，并且其他用户稍后合并他们的更改可能会很痛苦。有关更多信息，请参阅[更改行尾后刷新存储库](https://help.github.com/articles/dealing-with-line-endings/#refreshing-a-repository-after-changing-line-endings)。

# core.autocrlf = true

如果文件`text`中未指定`.gitattributes`，Git 使用`core.autocrlf`配置变量来确定是否应该转换文件。

对于 Windows 用户，`git config --global core.autocrlf true`这是一个不错的选择，因为：

*   文件**仅在添加**到 repo时才标准化为`LF`行尾。如果 repo 中有未规范化的文件，此设置将不会触及它们。
***   所有文本文件都转换为`CRLF`工作目录中的行尾。**

 **这种方法的问题在于：

*   如果您是 Windows 用户`autocrlf = input`，您将看到一堆带有`LF`行尾的文件。对团队的其他成员来说不是危险，因为您的提交仍将使用`LF`行尾进行标准化。
*   如果您是 Windows 用户`core.autocrlf = false`，您会看到一堆带有`LF`行尾的文件，并且您可以将带有`CRLF`行尾的文件引入 repo。
*   大多数 Mac 用户使用`autocrlf = input`并可能获取带有`CRLF`文件结尾的文件，可能来自带有`core.autocrlf = false`.

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-03-20T15:21:31.623

这只是一个**解决**方法：

在正常情况下，使用 git 附带的解决方案。这些在大多数情况下都很好用。**如果您通过设置.gitattributes**在基于 Windows 和 Unix 的系统上共享开发，则强制使用 LF 。

在我的例子中，有超过 10 个程序员在 Windows 中开发一个项目。这个项目是用 CRLF 签入的，**没有强制到 LF 的选项。**

一些设置是在我的机器内部编写的，对 LF 格式没有任何影响；因此，在每次小文件更改时，一些文件都会全局更改为 LF。

我的解决方案：

**Windows-Machines：** 让一切保持原样。什么都不在乎，因为您是默认的 Windows '孤狼'开发人员，您必须像这样处理：“世界上没有其他系统，是吗？”

**Unix机器**

1.  将以下行添加到配置`[alias]`部分。此命令列出所有已更改（即修改/新）的文件：

    ```
    lc = "!f() { git status --porcelain \
                 | egrep -r \"^(\?| ).\*\\(.[a-zA-Z])*\" \
                 | cut -c 4- ; }; f " 
    ```

2.  将所有这些**更改**的文件转换为 dos 格式：

    ```
    unix2dos $(git lc) 
    ```

3.  可选...

    1.  为这个动作创建一个 git[钩子](http://git-scm.com/book/en/Customizing-Git-Git-Hooks)来自动化这个过程

    2.  使用参数并包含它并修改`grep`函数以仅匹配特定的文件名，例如：

        ```
        ... | egrep -r "^(\?| ).*\.(txt|conf)" | ... 
        ```

    3.  随意使用额外的快捷方式使其更加方便：

        ```
        c2dos = "!f() { unix2dos $(git lc) ; }; f " 
        ```

        ...并通过键入来触发转换后的东西

        ```
        git c2dos 
        ```

# nhibernate - session.Merge 和 session.SaveOrUpdate 有什么区别？

> ID：170962
> 
> 赞同：88
> 
> 时间：2008-10-04T20:40:10.197
> 
> 标签：nhibernate, session

我有时注意到我的父/子对象或多对多关系，我需要调用`SaveOrUpdate`or `Merge`。通常，当我需要调用时`SaveOrUpdate`，我调用的异常`Merge`与未首先保存的瞬态对象有关。

请说明两者的区别。

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2008-10-04T21:20:09.290

这来自第[10.7 节。](http://docs.jboss.org/hibernate/orm/3.3/reference/en/html/objectstate.html)Hibernate 参考文档的[自动状态检测：](http://docs.jboss.org/hibernate/orm/3.3/reference/en/html/objectstate.html)

> saveOrUpdate() 执行以下操作：
> 
> *   如果对象已在此会话中持久存在，则不执行任何操作
> *   如果与会话关联的另一个对象具有相同的标识符，则抛出异常
> *   如果对象没有标识符属性，则保存（）它
> *   如果对象的标识符具有分配给新实例化对象的值，则保存（）它
> *   如果对象是版本化的（通过 <version> 或 <timestamp>），并且 version 属性值与分配给新实例化对象的值相同，则 save() 它
> *   否则更新（）对象
> 
> 和 merge() 非常不同：
> 
> *   如果存在与当前会话关联的具有相同标识符的持久实例，则将给定对象的状态复制到持久实例上
> *   如果当前没有与会话关联的持久化实例，尝试从数据库中加载它，或者创建一个新的持久化实例
> *   返回持久实例
> *   给定的实例没有与会话关联，它保持分离

如果您尝试更新在某一时刻与会话分离的对象，则应使用 Merge()，特别是如果当前与会话关联的那些对象可能存在持久实例。否则，在这种情况下使用 SaveOrUpdate() 会导致异常。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-04T21:23:14.023

据我了解，`merge()`将获取一个可能与当前会话无关的对象，并将其状态（属性值等）复制到与当前会话关联的对象*（*具有相同的 PK 值/标识符，课程）。

`saveOrUpdate()`将根据给定对象的标识值在您的会话上调用**Save**或**Update 。**

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-04-05T11:38:37.747

`SaveOrUpdateCopy()`现在已弃用 NHibernate 3.1。`Merge()`应改为使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-04-20T09:13:07.237

```
** Update()** 
```

:- 如果您确定会话不包含具有相同标识符的已持久实例，则使用 update 将数据保存在休眠状态

```
** Merge()** 
```

:-如果您想在不知道会话状态的情况下随时保存修改，请在休眠中使用 merge()。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-17T21:23:55.913

我发现[这个](http://www.roseindia.net/hibernate/hibernate4/org_hibernate_nonuniqueobjectexception.shtml)链接很好地解释了这种类型的异常：

对我有用的是以下内容：

1.  在映射 Myclass.hbm.xml 文件中，设置`cascade="merge"`
2.  `SaveOrUpdate`在将子/从属对象分配给父对象之前首先将其分配给父对象。
3.  `SaveOrUpdate`父对象。

然而，这种解决方案有局限性。即，您必须注意保存您的孩子/依赖对象，而不是让 hibernate 为您做这件事。

如果有人有更好的解决方案，我想看看。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2016-03-06T18:24:54.647

```
@Entity
@Table(name="emp")
public class Employee implements Serializable {
    private static final long serialVersionUID = 1L;
    @Id
    @GeneratedValue(strategy=GenerationType.AUTO)
    @Column(name="emp_id")
    private int id;
    @Column(name="emp_name")
    private String name;
    @Column(name="salary")
    private int Salary;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getSalary() {
        return Salary;
    }

    public void setSalary(int salary) {
        this.Salary = salary;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }
}

public enum HibernateUtil {
    INSTANCE;
    HibernateUtil(){
        buildSessionFactory();
    }
    private SessionFactory sessionFactory=null;

    public SessionFactory getSessionFactory() {
        return sessionFactory;
    }

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.sessionFactory = sessionFactory;
    }

    private  void buildSessionFactory() {
        Configuration configuration = new Configuration();

        configuration.addAnnotatedClass (TestRefresh_Merge.Employee.class);
        configuration.setProperty("connection.driver_class","com.mysql.jdbc.Driver");
        configuration.setProperty("hibernate.connection.url", "jdbc:mysql://localhost:3306/hibernate");                                
        configuration.setProperty("hibernate.connection.username", "root");     
        configuration.setProperty("hibernate.connection.password", "root");
        configuration.setProperty("dialect", "org.hibernate.dialect.MySQLDialect");
        configuration.setProperty("hibernate.hbm2ddl.auto", "update");
        configuration.setProperty("hibernate.show_sql", "true");
        configuration.setProperty(" hibernate.connection.pool_size", "10");
        /* configuration.setProperty(" hibernate.cache.use_second_level_cache", "true");
         configuration.setProperty(" hibernate.cache.use_query_cache", "true");
         configuration.setProperty(" cache.provider_class", "org.hibernate.cache.EhCacheProvider");
         configuration.setProperty("hibernate.cache.region.factory_class" ,"org.hibernate.cache.ehcache.EhCacheRegionFactory");
        */
        // configuration
        StandardServiceRegistryBuilder builder = new StandardServiceRegistryBuilder().applySettings(configuration.getProperties());
           sessionFactory = configuration.buildSessionFactory(builder.build());
           setSessionFactory(sessionFactory);
    }

    public  static SessionFactory getSessionFactoryInstance(){
        return INSTANCE.getSessionFactory();
    }
} 

public class Main {
    public static void main(String[] args) {
        HibernateUtil util=HibernateUtil.INSTANCE;
        SessionFactory factory=util.getSessionFactory();
        //save(factory); 
        retrieve(factory);
    }

     private static void retrieve(SessionFactory factory) {
        Session sessionOne=factory.openSession();

        Employee employee=(Employee)sessionOne.get(Employee.class, 5);

        sessionOne.close(); // detached Entity

        employee.setName("Deepak1");

        Session sessionTwo=factory.openSession();

        Employee employee1=(Employee)sessionTwo.get(Employee.class, 5);
        sessionTwo.beginTransaction();
        sessionTwo.saveOrUpdate(employee); // it will throw exception

        //sessionTwo.merge(employee); // it will work

        sessionTwo.getTransaction().commit();

        sessionTwo.close();

    }

    private static void save(SessionFactory factory) {
        Session sessionOne=factory.openSession();
        Employee emp=new Employee();
        emp.setName("Abhi");
        emp.setSalary(10000);
        sessionOne.beginTransaction();
        try{

            sessionOne.save(emp);
            sessionOne.getTransaction().commit();
        }catch(Exception e){
            e.printStackTrace();
        }finally{
            sessionOne.close();
        }

    }
} 
```

# sql - 一对一的数据库关系？

> ID：170964
> 
> 赞同：5
> 
> 时间：2008-10-04T20:40:48.073
> 
> 标签：sql, mysql, database, one-to-one

在空闲时间，我开始编写一个带有数据库后端的小型多人游戏。我希望将玩家登录信息与游戏中的其他信息（库存、统计数据和状态）区分开来，一位朋友提出这可能不是最好的主意。

把所有东西放在一张桌子上会更好吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-05T08:52:18.470

从忽略性能开始，并尽可能创建最合乎逻辑且易于理解的数据库设计。如果玩家和游戏对象（剑？棋子？）在概念上是不同的东西，那么将它们放在不同的表中。如果玩家可以携带东西，则在引用“玩家”表的“东西”表中放置一个外键。等等。

然后，当你有成百上千的玩家和数以千计的东西时，玩家在游戏中跑来跑去，做一些需要数据库搜索的事情，那么，如果你添加适当的索引，你的设计*仍然*足够快。

当然，如果您计划同时拥有数千名玩家，每个人每秒都在清点自己的东西，或者可能会进行其他一些巨大的数据库搜索负载（搜索图形引擎渲染的每一帧？），那么您将需要考虑表现。但在这种情况下，一个典型的基于磁盘的关系数据库无论如何都不够快，无论您如何设计表。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-04T20:52:36.583

关系数据库在集合上工作，数据库查询在那里不提供（“未找到”）或更多结果。关系数据库并不打算通过执行查询（在关系上）总是提供一个结果。

说我想提一下，也有现实生活;-)。一对一的关系*可能*是有意义的，即如果表的列数达到临界水平，则拆分该表可能会更快。但这种情况确实很少见。

如果您真的不需要拆分表格，请不要这样做。至少我假设在您的情况下，您必须对两个表进行选择才能获取所有数据。这可能比将所有内容存储在一张表中要慢。通过这样做，您的编程逻辑至少会变得不那么可读。

**伊迪丝说**： 关于规范化的评论：嗯，我从来没有见过一个数据库规范化到它的最大值，没有人真的推荐它作为一个选项。无论如何，如果您不完全知道以后是否会规范任何列（即放入其他表中），那么使用一个表而不是“表”-一对一-“其他表”也更容易做到这一点"

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-06T03:04:06.147

是否保留

> 玩家登录信息 [独立] 与其他游戏信息（库存、统计数据和状态）

通常是标准化的问题。您可能想快速查看维基百科（[第三范式](http://en.wikipedia.org/wiki/Third_normal_form)，[非规范化](http://en.wikipedia.org/wiki/Denormalization)）定义。是否将它们分成多个表取决于存储的数据。扩展您的问题将使这一点变得具体。我们要存储的数据是：

*   用户名：允许用户登录系统的唯一名称
*   passwd：密码：与保证用户唯一的用户名相关联
*   电子邮件：用户的电子邮件地址；所以游戏可以在用户最近没有玩的时候“戳”用户
*   角色：可能是角色的单独游戏名称
*   状态：当前活跃的玩家和/或角色
*   生命值：角色的示例统计信息

我们可以将其存储为单个表或多个表。

**单表示例**

如果玩家在这个游戏世界中只有一个角色，那么一张桌子可能是合适的。例如，

```
CREATE TABLE players(
  id         INTEGER NOT NULL,
  username   VARCHAR2(32) NOT NULL,
  password   VARCHAR2(32) NOT NULL,
  email      VARCHAR2(160),
  character  VARCHAR2(32) NOT NULL,
  status     VARCHAR2(32),
  hitpoints  INTEGER,

  CONSTRAINT pk_players PRIMARY KEY (uid)
); 
```

这将允许您通过对玩家表的单个查询来找到有关玩家的所有相关信息。

**多表示例**

但是，如果您想允许单个玩家拥有多个不同的角色，您可能希望将此数据拆分到两个不同的表格中。例如，您可能会执行以下操作：

```
-- track information on the player
CREATE TABLE players(
  id         INTEGER NOT NULL,
  username   VARCHAR2(32) NOT NULL,
  password   VARCHAR2(32) NOT NULL,
  email      VARCHAR2(160),

  CONSTRAINT pk_players PRIMARY KEY (id)
);

-- track information on the character
CREATE TABLE characters(
  id         INTEGER NOT NULL,
  player_id  INTEGER NOT NULL,
  character  VARCHAR2(32) NOT NULL,
  status     VARCHAR2(32),
  hitpoints  INTEGER,

  CONSTRAINT pk_characters PRIMARY KEY (id)
);
-- foreign key reference
ALTER TABLE characters
  ADD CONSTRAINT characters__players
  FOREIGN KEY (player_id) REFERENCES players (id); 
```

在查看玩家和角色的信息时，这种格式确实需要连接；但是，它使更新记录不太可能导致不一致。后一种说法通常在提倡使用多个表时使用。例如，如果您有一个玩家 (LotRFan) 有两个字符 (gollum, frodo) 的单表格式，您的用户名、密码、电子邮件字段将重复。如果玩家想更改他的电子邮件/密码，您需要修改这两条记录。如果只修改了一条记录，则该表将变得不一致。但是，如果 LotRFan 想在多表格式中更改他的密码，则表中的单行会被更新。

**其他注意事项**

使用单表还是多表取决于底层数据。这里没有描述但在其他答案中注意到的是优化通常需要两个表并将它们组合成一个表。

同样有趣的是了解将要进行的更改的类型。例如，如果您选择为可能有多个角色的玩家使用单个表格，并希望通过增加玩家表格中的字段来跟踪玩家发出的命令总数；这将导致在单个表示例中更新更多行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-04T20:47:06.093

无论如何，库存是一种多对一的关系，因此可能值得拥有自己的表（至少在其外键上建立索引）。

您可能还希望将每个用户的个人内容与公共内容（即其他人可以看到的内容）分开。这可能会提供更好的缓存命中率，因为很多人会看到您的公共属性，但只有您看到您的个人属性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-04T21:23:00.267

1-1 关系只是垂直分割。没有其他的。如果您出于某种原因不会将所有数据存储在同一个表中（例如跨多个服务器进行分区等），请执行此操作

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-05T01:58:47.027

如您所见，对此的普遍共识是“视情况而定”。正如@Campbell 和其他人所提到的，性能/查询优化很容易浮现在脑海中。

但我认为对于您正在构建的那种特定于应用程序的数据库，最好从考虑整体应用程序设计开始。对于特定于应用程序的数据库（与设计用于许多应用程序或报告工具的数据库相反），“理想”数据模型可能是最能映射到应用程序代码中实现的域模型的数据模型。

您可能不会将您的设计称为[MVC](http://en.wikipedia.org/wiki/Model-view-controller)，而且我不知道您使用的是什么语言，但我希望您有一些代码或类可以用逻辑模型包装数据访问。你如何看待这个级别的应用程序设计是我认为你的数据库应该如何构建的最佳*指标*。

一般来说，这意味着域对象到数据库表的一对一映射是最好的起点。

我认为最好用例子来说明我的意思：

## 案例一：一堂课/一桌

您认为是**Player**类。Player.authenticate、Player.logged_in?、Player.status、Player.hi_score、Player.gold_credits。只要所有这些都是针对单个用户的操作，或者代表用户的单值属性，那么从逻辑应用程序设计的角度来看，单个表应该是您的起点。单班（玩家），单桌（玩家）。

## 案例2：多类/一个或多个表

也许我不喜欢瑞士军刀**Player**类的设计，但更喜欢从**User**、**Inventory**、**Scoreboard**和**Account**的角度来考虑。User.authenticate、User.logged_in?、User->account.status、Scoreboard.hi_score(User)、User->account.gold_credits。

我这样做可能是因为我认为在域模型中分离这些概念将使我的代码更清晰、更容易编写。在这种情况下，最好的起点是将域类直接映射到各个表：用户、库存、分数、帐户等。

## 让“理想”变得实用

我在上面漏掉了一些词来表明域对象到表的一对一映射是*理想的、合乎逻辑*的设计。

这是我首选的起点。试图变得太聪明——比如将多个类映射回一个表——往往只会招致我希望避免的麻烦（尤其是死锁和并发问题）。

但这并不总是故事的结局。有一些实际考虑可能意味着需要单独的活动来优化物理数据模型，例如并发/锁定问题？行大小变得太大？索引开销？查询性能等

但是在考虑性能时要小心：仅仅因为它可能是一张表中的一行，可能并不意味着它只查询一次即可获得整行。我想多用户游戏场景可能涉及在不同时间获取不同玩家信息的一系列调用，并且玩家总是想要可能非常动态的“当前值”。这可能会转化为每次只对表中的几列进行多次调用（在这种情况下，多表设计可能比单表设计更快）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-06T03:17:07.803

我建议将它们分开。不是出于任何数据库原因，而是出于开发原因。

当您编写玩家登录模块时，您不想考虑任何游戏信息。反之亦然。如果表是不同的，则维护关注点分离会更容易。

这归结为这样一个事实，即您的游戏信息模块与玩家登录表没有任何关系。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-04T20:43:46.523

在这种情况下，最好将其放在一个表中，因为您的查询性能会更好。

当存在重复数据元素时，您真的只想使用下一个表，您应该通过规范化来减少数据存储开销。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-04T23:00:49.430

我建议您将每种记录类型保存在自己的表中。

玩家登录是一种记录。库存是另一个。他们不应该共享一个表格，因为大多数信息都没有共享。通过分离不相关的信息来保持表格简单。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-01T14:13:32.170

我同意[Thomas Padron-McCarthy 的回答](https://stackoverflow.com/questions/170964/one-to-one-database-relation#171718)：

解决成千上万同时用户的情况不是您的问题。让人们玩你的游戏是个问题。从最简单的设计开始 - 完成游戏、工作、可玩且易于扩展。如果游戏起飞，那么你就会去规范化。

还值得一提的是，可以将索引视为包含更窄数据视图的单独表。

人们已经能够推断出暴雪为魔兽世界使用的设计。似乎玩家正在进行的任务与角色一起存储。例如：

```
CREATE TABLE Players (
   PlayerID int,
   PlayerName varchar(50),
   ...
   Quest1ID int,
   Quest2ID int,
   Quest3ID int,
   ...
   Quest10ID int,
   ...
) 
```

最初您最多可以进行 10 个任务，后来扩展到 25 个，例如：

```
CREATE TABLE Players (
   PlayerID int,
   PlayerName varchar(50),
   ...
   Quest1ID int,
   Quest2ID int,
   Quest3ID int,
   ...
   Quest25ID int,
   ...
) 
```

这与拆分设计相反：

```
CREATE TABLE Players (
   PlayerID int,
   PlayerName varchar(50),
   ...
)

CREATE TABLE PlayerQuests (
   PlayerID int,
   QuestID int
) 
```

后者在概念上更容易处理，并且它允许任意数量的任务。另一方面，您必须加入 Players 和 PlayerQuests 才能获得所有这些信息。

# javascript - 使用 jQuery 从 JavaScript 对象中添加选项的最佳方法是什么？

> ID：170986
> 
> 赞同：1449
> 
> 时间：2008-10-04T20:58:46.400
> 
> 标签：javascript, jquery, html-select

`<select>`使用 jQuery 从 JavaScript 对象添加选项的最佳方法是什么？

我正在寻找不需要插件的东西，但我也会对那里的插件感兴趣。

这就是我所做的：

```
selectValues = { "1": "test 1", "2": "test 2" };

for (key in selectValues) {
  if (typeof (selectValues[key] == 'string') {
    $('#mySelect').append('<option value="' + key + '">' + selectValues[key] + '</option>');
  }
} 
```

**一个干净/简单的解决方案：**

[这是matdumsa 的](https://stackoverflow.com/questions/170986/what-is-the-best-way-to-add-options-to-a-select-from-an-array-with-jquery/171007#171007)清理和简化版本：

```
$.each(selectValues, function(key, value) {
     $('#mySelect')
          .append($('<option>', { value : key })
          .text(value));
}); 
```

与 matdumsa 相比的更改：(1) 删除了 append() 中选项的关闭标记，(2) 将属性/属性作为 append() 的第二个参数移动到映射中。

* * *

## 回答 #1

> 赞同：1448
> 
> 时间：2008-10-04T21:12:02.037

与其他答案相同，采用 jQuery 方式：

```
$.each(selectValues, function(key, value) {   
     $('#mySelect')
         .append($("<option></option>")
                    .attr("value", key)
                    .text(value)); 
}); 
```

* * *

## 回答 #2

> 赞同：285
> 
> 时间：2009-11-05T19:42:53.570

```
var output = [];

$.each(selectValues, function(key, value)
{
  output.push('<option value="'+ key +'">'+ value +'</option>');
});

$('#mySelect').html(output.join('')); 
```

这样，您只需“触摸 DOM”一次。

~~我不确定最新行是否可以转换为 $('#mySelect').html(output.join('')) 因为我不知道 jQuery 内部（也许它在 html()方法）~~

* * *

## 回答 #3

> 赞同：210
> 
> 时间：2010-07-01T07:00:13.693

这稍微更快更干净。

```
var selectValues = {
  "1": "test 1",
  "2": "test 2"
};
var $mySelect = $('#mySelect');
//
$.each(selectValues, function(key, value) {
  var $option = $("<option/>", {
    value: key,
    text: value
  });
  $mySelect.append($option);
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<select id="mySelect"></select>
```

* * *

## 回答 #4

> 赞同：106
> 
> 时间：2011-05-31T22:52:36.163

### jQuery

```
var list = $("#selectList");
$.each(items, function(index, item) {
  list.append(new Option(item.text, item.value));
}); 
```

### 香草 JavaScript

```
var list = document.getElementById("selectList");
for(var i in items) {
  list.add(new Option(items[i].text, items[i].value));
} 
```

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2008-10-05T15:49:09.440

如果您不必支持旧的 IE 版本，使用[`Option`构造函数](https://developer.mozilla.org/en-US/docs/Web/API/HTMLOptionElement/Option)显然是要走的路，[一个可读且高效的解决方案](https://stackoverflow.com/a/57634509/1026)：

```
$(new Option('myText', 'val')).appendTo('#mySelect'); 
```

它在功能上等同于，但比：

```
$("<option></option>").attr("value", "val").text("myText")).appendTo('#mySelect'); 
```

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2009-12-21T15:50:52.233

这看起来更好，提供了可读性，但比其他方法慢。

```
$.each(selectData, function(i, option)
{
    $("<option/>").val(option.id).text(option.title).appendTo("#selectBox");
}); 
```

如果你想要速度，最快（经过测试！）的方法是这样，使用数组，而不是字符串连接，并且只使用一个附加调用。

```
auxArr = [];
$.each(selectData, function(i, option)
{
    auxArr[i] = "<option value='" + option.id + "'>" + option.title + "</option>";
});

$('#selectBox').append(auxArr.join('')); 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2013-04-17T11:29:16.297

对较旧的[@joshperry 答案](https://stackoverflow.com/revisions/3841556/2)的改进：

似乎普通的**.append**也可以按预期工作，

```
$("#mySelect").append(
  $.map(selectValues, function(v,k){

    return $("<option>").val(k).text(v);
  })
); 
```

或更短，

```
$("#mySelect").append(
  $.map(selectValues, (v,k) => $("<option>").val(k).text(v))
  // $.map(selectValues, (v,k) => new Option(v, k)) // using plain JS
); 
```

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2013-10-11T17:20:06.917

所有这些答案似乎都不必要地复杂。所有你需要的是：

```
var options = $('#mySelect').get(0).options;
$.each(selectValues, function(key, value) {
        options[options.length] = new Option(value, key);
}); 
```

那是完全跨浏览器兼容的。

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2009-11-09T06:29:54.280

```
 var output = [];
 var length = data.length;
 for(var i = 0; i < length; i++)
 {
    output[i++] = '<option value="' + data[i].start + '">' + data[i].start + '</option>';
 }

 $('#choose_schedule').get(0).innerHTML = output.join(''); 
```

我已经进行了一些测试，我相信这可以最快地完成这项工作。:P

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2011-09-16T13:22:45.537

请注意...我在 Android 2.2（Cyanogen 7.0.1）手机（T-Mobile G2）上使用带有 PhoneGap 1.0.0 的 jQuery Mobile 1.0b2，并且根本无法使用 .append() 方法。我必须使用 .html() 如下：

```
var options;
$.each(data, function(index, object) {
    options += '<option value="' + object.id + '">' + object.stop + '</option>';
});

$('#selectMenu').html(options); 
```

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2010-07-08T05:00:35.373

有一种使用[Microsoft Templating 方法](http://wiki.github.com/nje/jquery/jquery-templates-proposal)的方法，目前正在提议将其包含到 jQuery 核心中。使用模板功能更强大，因此对于最简单的场景，它可能不是最佳选择。有关更多详细信息，请参阅 Scott Gu 的文章概述了这些功能。

首先包含模板 js 文件，可从[github](http://github.com/jquery/jquery-tmpl)获得。

```
<script src="Scripts/jquery.tmpl.js" type="text/javascript" /> 
```

接下来设置模板

```
<script id="templateOptionItem" type="text/html">
    <option value=\'{{= Value}}\'>{{= Text}}</option>
</script> 
```

然后使用您的数据调用 .render() 方法

```
var someData = [
    { Text: "one", Value: "1" },
    { Text: "two", Value: "2" },
    { Text: "three", Value: "3"}];

$("#templateOptionItem").render(someData).appendTo("#mySelect"); 
```

我已经[在博客](http://blog.nick.josevski.com/2010/07/08/using-jquery-templates-to-appendto-an-option-on-a-select-list-via-render/)中更详细地介绍了这种方法。

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2008-10-05T04:52:12.950

我做了这样的事情，[通过 Ajax 加载一个下拉项](http://www.chazzuka.com/blog/?p=206)。上面的响应也是可以接受的，但是尽可能少地修改 DOM 以获得更好的性能总是好的。

因此，与其在循环中添加每个项目，不如在循环中收集项目并在完成后附加它。

```
$(data).each(function(){
    ... Collect items
}) 
```

附加它，

```
$('#select_id').append(items); 
```

甚至更好

```
$('#select_id').html(items); 
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2010-02-05T11:56:17.370

```
function populateDropdown(select, data) {   
    select.html('');   
    $.each(data, function(id, option) {   
        select.append($('<option></option>').val(option.value).html(option.name));   
    });          
} 
```

它适用于 jQuery 1.4.1。

有关使用 ASP.NET MVC 和 jQuery 使用动态列表的完整文章，请访问：

[使用 MVC 和 jQuery 的动态选择列表](http://www.codecapers.com/post/Dynamic-Select-Lists-with-MVC-and-jQuery.aspx)

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2010-03-25T15:04:40.253

简单的方法是：

```
$('#SelectId').html("<option value='0'>select</option><option value='1'>Laguna</option>"); 
```

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2010-10-01T17:22:21.300

大多数其他答案都使用该`each`函数来迭代`selectValues`. 这需要为每个元素调用 append ，并且在单独添加每个元素时触发重排。

将这个答案更新为更惯用的功能方法（使用现代 JS）可以形成`append`只调用一次，并`option`使用[map](http://api.jquery.com/jQuery.map/)和`Option`元素构造函数创建元素数组。

使用`Option`DOM 元素应该减少函数调用开销，因为`option`元素在创建后不需要更新，并且 jQuery 的解析逻辑不需要运行。

```
$('mySelect').append($.map(selectValues, (k, v) => new Option(k, v))) 
```

如果您创建一个新的选项对象的工厂实用程序函数，这可以进一步简化：

```
const newoption = (...args) => new Option(...args) 
```

然后可以直接提供给`map`：

```
$('mySelect').append($.map(selectValues, newoption)) 
```

**以前的配方**

因为`append`还允许将值作为可变数量的参数传递，所以我们可以预先创建`option`元素列表[映射](http://api.jquery.com/jQuery.map/)并将它们作为参数附加到单个调用中，使用`apply`.

```
$.fn.append.apply($('mySelect'), $.map(selectValues, (k, v) => $("<option/>").val(k).text(v))); 
```

看起来在更高版本的 jQuery 中，`append`也接受一个数组参数，这可以稍微简化：

```
$('mySelect').append($.map(selectValues, (k, v) => $("<option/>").val(k).text(v))) 
```

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2012-09-21T09:27:00.960

Chrome (jQuery 1.7.1) 中的这个解决方案存在排序问题（Chrome 按名称/编号对对象属性进行排序？）所以为了保持顺序（是的，这是对象滥用），我改变了这个：

```
optionValues0 = {"4321": "option 1", "1234": "option 2"}; 
```

对此

```
optionValues0 = {"1": {id: "4321", value: "option 1"}, "2": {id: "1234", value: "option 2"}}; 
```

然后 $.each 看起来像：

```
$.each(optionValues0, function(order, object) {
  key = object.id;
  value = object.value;
  $('#mySelect').append($('<option>', { value : key }).text(value));
}); 
```

* * *

## 回答 #17

> 赞同：9
> 
> 时间：2016-02-03T16:21:21.407

我建议不要在任何地方重复相同的代码，而是编写自己的 jQuery 函数，例如：

```
jQuery.fn.addOption = function (key, value) {
    $(this).append($('<option>', { value: key }).text(value));
}; 
```

然后添加一个选项只需执行以下操作：

```
$('select').addOption('0', 'None'); 
```

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2010-07-21T16:14:14.247

您可以使用以下代码迭代您的 json 数组

`$('<option/>').attr("value","someValue").text("Option1").appendTo("#my-select-id");`

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2014-09-08T08:47:53.770

1.  `$.each`比`for`循环慢
2.  每次，DOM 选择都不是循环中的最佳实践`$("#mySelect").append();`

所以最好的解决方案如下

如果 JSON 数据`resp`是

```
[
    {"id":"0001", "name":"Mr. P"},
    {"id":"0003", "name":"Mr. Q"},
    {"id":"0054", "name":"Mr. R"},
    {"id":"0061", "name":"Mr. S"}
] 
```

用它作为

```
var option = "";
for (i=0; i<resp.length; i++) {
    option += "<option value='" + resp[i].id + "'>" + resp[i].name + "</option>";
}
$('#mySelect').html(option); 
```

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2010-12-24T16:23:44.287

可以在这里找到一个 jQuery 插件：[Auto-populating Select Boxes using jQuery & AJAX](http://remysharp.com/2007/01/20/auto-populating-select-boxes-using-jquery-ajax/)。

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2012-08-09T19:08:56.547

这就是我对二维数组所做的：第一列是第 i 项，添加`innerHTML`到`<option>`. 第二列是record_id i，添加`value`到`<option>`：

1.  PHP

    ```
    $items = $dal->get_new_items(); // Gets data from the database
    $items_arr = array();
    $i = 0;
    foreach ($items as $item)
    {
        $first_name = $item->first_name;
        $last_name = $item->last_name;
        $date = $item->date;
        $show = $first_name . " " . $last_name . ", " . $date;
        $request_id = $request->request_id;
        $items_arr[0][$i] = $show;
        $items_arr[1][$i] = $request_id;
        $i++;
    }

    echo json_encode($items_arr); 
    ```

2.  JavaScript/Ajax

    ```
     function ddl_items() {
                if (window.XMLHttpRequest) {
                    // Code for Internet Explorer 7+, Firefox, Chrome, Opera, and Safari
                    xmlhttp=new XMLHttpRequest();
                }
                else{
                    // Code for Internet Explorer 6 and Internet Explorer 5
                    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                }

                xmlhttp.onreadystatechange=function() {
                if (xmlhttp.readyState==4 && xmlhttp.status==200) {
                    var arr = JSON.parse(xmlhttp.responseText);
                    var lstbx = document.getElementById('my_listbox');

                    for (var i=0; i<arr.length; i++) {
                        var option = new Option(arr[0][i], arr[1][i]);
                        lstbx.options.add(option);
                    }
                }
            };

            xmlhttp.open("GET", "Code/get_items.php?dummy_time=" + new Date().getTime() + "", true);
            xmlhttp.send();
        }
    } 
    ```

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2012-11-26T16:38:58.177

尽管之前的答案都是有效的答案 - 最好先将所有这些附加到 documentFragmnet，然后将该文档片段作为元素附加到...

请参阅[John Resig 对此事的看法](http://ejohn.org/blog/dom-documentfragments/)......

类似于以下内容：

```
var frag = document.createDocumentFragment();

for(item in data.Events)
{
    var option = document.createElement("option");

    option.setAttribute("value", data.Events[item].Key);
    option.innerText = data.Events[item].Value;

    frag.appendChild(option);
}
eventDrop.empty();
eventDrop.append(frag); 
```

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2013-04-25T21:59:06.693

还有另一种方法：

```
var options = [];    
$.each(selectValues, function(key, value) {
    options.push($("<option/>", {
        value: key,
        text: value
    }));
});
$('#mySelect').append(options); 
```

* * *

## 回答 #24

> 赞同：7
> 
> 时间：2013-10-02T17:16:31.027

```
if (data.length != 0) {
    var opts = "";
    for (i in data)
        opts += "<option value='"+data[i][value]+"'>"+data[i][text]+"</option>";

    $("#myselect").empty().append(opts);
} 
```

这在第一次构建一个巨大的字符串之后只操作一次 DOM。

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2012-08-06T17:47:35.067

我发现这很简单而且效果很好。

```
for (var i = 0; i < array.length; i++) {
    $('#clientsList').append($("<option></option>").text(array[i].ClientName).val(array[i].ID));
}; 
```

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2016-07-30T10:43:29.287

JSON 格式：

```
[{
    "org_name": "Asset Management"
}, {
    "org_name": "Debt Equity Foreign services"
}, {
    "org_name": "Credit Services"
}] 
```

以及用于在 Ajax 成功时将值填充到 Dropdown 的 jQuery 代码：

```
success: function(json) {
    var options = [];
    $('#org_category').html('');  // Set the Dropdown as Blank before new Data
    options.push('<option>-- Select Category --</option>');
    $.each(JSON.parse(json), function(i, item) {
        options.push($('<option/>',
        {
           value: item.org_name, text: item.org_name
        }));
    });
    $('#org_category').append(options);  // Set the Values to Dropdown
} 
```

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2017-07-10T18:24:54.020

使用 $.map() 函数，您可以以更优雅的方式执行此操作：

```
$('#mySelect').html( $.map(selectValues, function(val, key){
    return '<option value="' + val + '">'+ key + '</option>';
}).join('')); 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2018-03-29T16:03:33.667

```
<!DOCTYPE html>
<html lang="en">
<head>
  <title>append selectbox using jquery</title>
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script type="text/javascript">
    function setprice(){
        var selectValues = { "1": "test 1", "2": "test 2" };
        $.each(selectValues, function(key, value) {   
     $('#mySelect')
         .append($("<option></option>")
                    .attr("value",key)
                    .text(value)); 
});

    }
  </script>
</head>
<body onload="setprice();">

      <select class="form-control" id="mySelect">
    <option>1</option>
    <option>2</option>
    <option>3</option>
    <option>4</option>
  </select>

</body>
</html> 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2015-10-08T03:06:42.320

我将两个最佳答案组合成一个很好的答案。

```
var outputConcatenation = [];

$.each(selectValues, function(i, item) {   
     outputConcatenation.push($("<option></option>").attr("value", item.key).attr("data-customdata", item.customdata).text(item.text).prop("outerHTML"));
});

$("#myselect").html(outputConcatenation.join('')); 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2017-10-30T13:27:38.210

```
$.each(selectValues, function(key, value) {
    $('#mySelect').append($("<option/>", {
        value: key, text: value
    }));
}); 
```

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2018-04-11T05:35:43.000

将您的 HTML 选择 ID 设置为下面的行。在这里`mySelect`用作选择元素的 id。

```
 var options = $("#mySelect"); 
```

然后获取在这种情况下是 selectValues 的对象，并将其设置为每个循环的 jquery。它将相应地使用对象的值和文本，并将其附加到选项选择中，如下所示。

```
$.each(selectValues, function(val, text) {
            options.append(
             $('<option></option>').val(val).html(text)
          );
      }); 
```

这将在选择下拉列表时将文本显示为选项列表，并且一旦选择了文本，将使用所选文本的值。

例如。

“1”：“测试 1”，“2”：“测试 2”，

落下，

显示名称：测试 1 -> 值为 1 显示名称：测试 2 -> 值为 2

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2018-09-06T05:20:04.187

实际上，为了获得更好的性能，最好单独制作选项列表并附加到选择id。

```
var options = [];
$.each(selectValues, function(key, value) {
    options.push ($('<option>', { value : key })
          .text(value));
});
 $('#mySelect').append(options); 
```

[http://learn.jquery.com/performance/append-outside-loop/](http://learn.jquery.com/performance/append-outside-loop/)

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2018-08-06T14:09:36.680

我决定插话一点。

1.  处理先前选择的选项；一些浏览器在我们追加时搞砸了
2.  只用附加击打 DOM 一次
3.  在添加更多选项的同时处理`multiple`财产
4.  展示如何使用对象
5.  展示如何使用对象数组进行映射

```
// objects as value/desc
let selectValues = {
  "1": "test 1",
  "2": "test 2",
  "3": "test 3",
  "4": "test Four"
};
//use div here as using "select" mucks up the original selected value in "mySelect"
let opts = $("<div />");
let opt = {};
$.each(selectValues, function(value, desc) {
  opts.append($('<option />').prop("value", value).text(desc));
});
opts.find("option").appendTo('#mySelect');

// array of objects called "options" in an object
let selectValuesNew = {
  options: [{
      value: "1",
      description: "2test 1"
    },
    {
      value: "2",
      description: "2test 2",
      selected: true
    },
    {
      value: "3",
      description: "2test 3"
    },
    {
      value: "4",
      description: "2test Four"
    }
  ]
};

//use div here as using "select" mucks up the original selected value
let opts2 = $("<div />");
let opt2 = {}; //only append after adding all options
$.map(selectValuesNew.options, function(val, index) {
  opts2.append($('<option />')
    .prop("value", val.value)
    .prop("selected", val.selected)
    .text(val.description));
});
opts2.find("option").appendTo('#mySelectNew');
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<select id="mySelect">
  <option value="" selected="selected">empty</option>
</select>

<select id="mySelectNew" multiple="multiple">
  <option value="" selected="selected">2empty</option>
</select>
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2019-01-17T20:15:31.647

由于 JQuery`append`可以将数组作为参数，我很惊讶没有人建议使用`map`

```
$('#the_select').append(['a','b','c'].map(x => $('<option>').text(x))); 
```

或者`reduce`

```
['a','b','c'].reduce((s,x) => s.append($('<option>').text(x)), $('#the_select')); 
```

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2020-02-27T11:31:59.457

获取对象键以获取对象值。使用 map() 添加新选项。

```
const selectValues = {
  "1": "test 1",
  "2": "test 2"
}
const selectTest = document.getElementById('selectTest')
Object.keys(selectValues).map(key => selectTest.add(new Option(selectValues[key], key)))
```

```
<select id="selectTest"></select>
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2020-08-25T20:09:18.640

# 纯JS

在纯 JS 中添加下一个选项来选择更容易更直接

```
mySelect.innerHTML+= `<option value="${key}">${value}</option>`; 
```

```
let selectValues = { "1": "test 1", "2": "test 2" };

for(let key in selectValues) { 
  mySelect.innerHTML+= `<option value="${key}">${selectValues[key]}</option>`;
}
```

```
<select id="mySelect">
  <option value="0" selected="selected">test 0</option>
</select>
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2021-10-22T05:44:29.907

```
 $.each(response, function (index,value) {
                        $('#unit')
                            .append($("<option></option>")
                                .attr("value", value.id)
                                .text(value.title));
                    }); 
```

# c++ - 如何从 HTML 页面获取字符集

> ID：170988
> 
> 赞同：0
> 
> 时间：2008-10-04T20:59:18.287
> 
> 标签：c++, html, linux, character-encoding, content-encoding

我正在尝试在任何 HTML 元标记中获取 charset 属性。（即。`< meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >`）有没有办法在linux下的C++中做到这一点。我使用 HTML tidy 作为解析器，但我无法让该属性返回与 us-ascii 不同的任何内容（即使编码是 utf-8）
这是我得到的输出：*.*4 节点：元
名称attr: http-equiv
值 attr: 内容类型
名称 attr: 内容
值 attr: text/html; charset=us-ascii

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T21:34:02.613

根据 Vinko Vrsalovic 的要求，这里是得到该结果的代码：
void dumpNode( TidyNode tnod, int indent )
{
   TidyNode child;

   for (child = tidyGetChild(tnod); child; child = tidyGetNext(child) )
   {
      ctmbstr name;
      switch ( tidyNodeGetType(child) )
     {
       case TidyNode_Root: name = "Root"; 休息;
       case TidyNode_DocType: name = "DOCTYPE"; 休息;
       case TidyNode_Comment: name = "Comment"; 休息;
       case TidyNode_ProcIns: name = "处理指令"; 休息;
       case TidyNode_Text: name = "Text"; 休息;
       case TidyNode_CDATA: name = "CDATA"; 休息;
       case TidyNode_Section: name = "XML Section"; 休息;
       case TidyNode_Asp: name = "ASP"; 休息;
       case TidyNode_Jste: name = "JSTE"; 休息;
       case TidyNode_Php: name = "PHP"; 休息;
       case TidyNode_XmlDecl: name = "XML 声明"; 休息;

       案例 TidyNode_Start：
       案例 TidyNode_End：
       案例 TidyNode_StartEnd：
       默认值：

       TidyAttr att = tidyAttrFirst(child);
       while (att)
       {
         std::cout < <"名称属性：" << tidyAttrName(att) << std::endl;
        std::cout<<"值属性："<< tidyAttrValue(att) << std::endl;
         att = tidyAttrNext(att);
       }
      打破;
      }
      断言（名称！= NULL）；
      printf("%d*.*%d%sNode: %s\n", indent, indent, " ", name );
      转储节点（孩子，缩进+ 4）；
     }
}
void dumpHtml( TidyDoc tdoc)
{
      dumpNode( tidyGetHtml(tdoc),0 );
}

int main(int argc, char **argv) {
      std::string toReturn("");
      TidyBuffer 输出；
      TidyBuffer 错误；
      int rc = -1;
      布尔确定；

      tidyBufInit(&output);
      tidyBufInit(&errbuf);

      TidyDoc tdoc = tidyCreate();
      ok = tidyOptSetBool(tdoc, TidyXhtmlOut, 是的); // 转换为 XHTML
      if ( ok )
           rc = tidySetErrorBuffer( tdoc, &errbuf ); // 捕获诊断
      if ( rc >= 0 )
           rc = tidyParseFile(tdoc, "fuebuena.html"); // 解析输入
      if ( rc >= 0 )
           rc = tidyCleanAndRepair( tdoc ); // 整理一下！
      if (rc >= 0)
           dumpHtml(tdoc);

      返回0；
}

# javascript - 用 jQuery 删除表格行的最佳方法是什么？

> ID：170997
> 
> 赞同：334
> 
> 时间：2008-10-04T21:04:08.947
> 
> 标签：javascript, jquery, html-table

用 jQuery 删除表格行的最佳方法是什么？

* * *

## 回答 #1

> 赞同：470
> 
> 时间：2008-10-04T21:11:49.897

你是对的：

```
$('#myTableRow').remove(); 
```

如果您的行有 ，这很好用`id`，例如：

```
<tr id="myTableRow"><td>blah</td></tr> 
```

如果你没有`id`，你可以使用任何 jQuery[过多的选择器](http://docs.jquery.com/Selectors)。

* * *

## 回答 #2

> 赞同：131
> 
> 时间：2008-10-05T01:07:26.473

```
$('#myTable tr').click(function(){
    $(this).remove();
    return false;
}); 
```

甚至更好的

```
$("#MyTable").on("click", "#DeleteButton", function() {
   $(this).closest("tr").remove();
}); 
```

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2009-03-29T04:58:14.883

假设您在表格中的数据单元格中有一个按钮/链接，这样的事情就可以解决问题......

```
$(".delete").live('click', function(event) {
    $(this).parent().parent().remove();
}); 
```

这将删除单击的按钮/链接的父级的父级。您需要使用 parent() 因为它是一个 jQuery 对象，而不是普通的 DOM 对象，并且您需要使用 parent() 两次，因为按钮位于数据单元格内，该单元格位于一行内......这是您要删除的内容。$(this) 是被点击的按钮，所以只要有这样的东西只会删除按钮：

```
$(this).remove(); 
```

虽然这将删除数据单元格：

```
 $(this).parent().remove(); 
```

如果您想简单地单击行上的任意位置以将其删除，则类似这样的操作会起作用。您可以轻松地修改它以提示用户或仅在双击时工作：

```
$(".delete").live('click', function(event) {
    $(this).parent().remove();
}); 
```

希望这会有所帮助......我自己在这方面有点挣扎。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2009-11-24T09:56:26.563

您可以使用：

```
$($(this).closest("tr")) 
```

用于查找元素的父表行。

它比 parent().parent() 更优雅，这是我开始做的，很快就发现了我的方法的错误。

--编辑 -- 有人指出问题是关于删除行...

```
$($(this).closest("tr")).remove() 
```

如下所述，您可以简单地执行以下操作：

```
$(this).closest('tr').remove(); 
```

类似的代码片段可用于许多操作，例如在多个元素上触发事件。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2010-01-11T05:20:01.237

容易..试试这个

```
$("table td img.delete").click(function () {
    $(this).parent().parent().parent().fadeTo(400, 0, function () { 
        $(this).remove();
    });
    return false;
}); 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-04T21:04:56.480

以下是否可以接受：

```
$('#myTableRow').remove(); 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-05-02T10:02:49.157

您所要做的就是从表格中删除表格行 ( `<tr>`) 标记。例如，这里是从表中删除最后一行的代码：

> `$('#myTable tr:last').remove();`

*上面的代码取自[**这篇 jQuery Howto 帖子**](http://jquery-howto.blogspot.com/2009/05/remove-bottom-table-row-using-jquery.html)。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-10-04T21:48:55.113

```
function removeRow(row) {
    $(row).remove();
}

<tr onmousedown="removeRow(this)"><td>Foo</td></tr> 
```

也许这样的事情也可以工作？我没有尝试用“this”做一些事情，所以我不知道它是否有效。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2010-10-30T22:21:21.433

试试这个尺寸

```
$(this).parents('tr').first().remove(); 
```

完整清单：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.4.3.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
        $('.deleteRowButton').click(DeleteRow);
      });

    function DeleteRow()
    {
      $(this).parents('tr').first().remove();
    }
  </script>
</head>
<body>
  <table>
    <tr><td>foo</td>
     <td><a class="deleteRowButton">delete row</a></td></tr>
    <tr><td>bar bar</td>
     <td><a class="deleteRowButton">delete row</a></td></tr>
    <tr><td>bazmati</td>
     <td><a class="deleteRowButton">delete row</a></td></tr>
  </table>
</body>
</html> 
```

[看到它在行动](https://jsfiddle.net/Lxa30tpp/)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-05-20T23:57:32.743

另一个来自`empty()`：

```
$(this).closest('tr').empty(); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-01-11T20:46:04.330

如果您要删除的行可能会更改，您可以使用它。只需将此函数传递给您要删除的行#。

```
function removeMyRow(docRowCount){
   $('table tr').eq(docRowCount).remove();
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-05-06T12:44:45.877

如果你有这样的 HTML

```
<tr>
 <td><span class="spanUser" userid="123"></span></td>
 <td><span class="spanUser" userid="123"></span></td>
</tr> 
```

哪里`userid="123"`是您可以在构建表时动态填充的自定义属性，

你可以使用类似的东西

```
 $(".spanUser").live("click", function () {

        var span = $(this);   
        var userid = $(this).attr('userid');

        var currentURL = window.location.protocol + '//' + window.location.host;
        var url = currentURL + "/Account/DeleteUser/" + userid;

        $.post(url, function (data) {
          if (data) {
                   var tdTAG = span.parent(); // GET PARENT OF SPAN TAG
                   var trTAG = tdTAG.parent(); // GET PARENT OF TD TAG
                   trTAG.remove(); // DELETE TR TAG == DELETE AN ENTIRE TABLE ROW 
             } else {
                alert('Sorry, there is some error.');
            }
        }); 

     }); 
```

因此，在这种情况下，您不知道`TR`标签的类别或 ID，但无论如何您都可以将其删除。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-11T14:41:35.473

```
$('tr').click(function()
 {
  $(this).remove();
 }); 
```

我想你会尝试上面的代码，因为它工作，但我不知道为什么它工作一段时间然后整个表被删除。我也试图通过单击该行来删除该行。但找不到确切的答案。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-08-19T12:55:30.583

我很欣赏这是一篇旧帖子，但我也想做同样的事情，发现接受的答案对我不起作用。假设 JQuery 自编写以来一直在继续。

无论如何，我发现以下内容对我有用：

```
$('#resultstbl tr[id=nameoftr]').remove(); 
```

不确定这是否对任何人有帮助。我上面的示例是一个更大函数的一部分，因此没有将它包装在事件侦听器中。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-10-06T08:12:40.993

id 现在不是一个好的选择器。您可以在行上定义一些属性。您可以将它们用作选择器。

```
<tr category="petshop" type="fish"><td>little fish</td></tr>
<tr category="petshop" type="dog"><td>little dog</td></tr>
<tr category="toys" type="lego"><td>lego starwars</td></tr> 
```

你可以使用一个函数来选择这样的行（ES6）：

```
const rowRemover = (category,type)=>{
   $(`tr[category=${category}][type=${type}]`).remove();
}

rowRemover('petshop','fish'); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-05-30T17:35:19.187

如果您使用的是引导表

将此代码段添加到您的 bootstrap_table.js

```
BootstrapTable.prototype.removeRow = function (params) {
    if (!params.hasOwnProperty('index')) {
        return;
    }

    var len = this.options.data.length;

    if ((params.index > len) || (params.index < 0)){
        return;
    }

    this.options.data.splice(params.index, 1);

    if (len === this.options.data.length) {
        return;
    }

    this.initSearch();
    this.initPagination();
    this.initBody(true);
}; 
```

然后在你的`var allowedMethods = [`

添加`'removeRow'`

最后你可以使用`$("#your-table").bootstrapTable('removeRow',{index:1});`

[这篇文章的学分](https://github.com/wenzhixin/bootstrap-table/issues/453)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-11-05T08:23:53.747

从表中删除行的最简单方法：

1.  使用其唯一 ID 删除表行。
2.  根据该行的顺序/索引删除。例如：删除第三或第五行。

例如：

```
 <table id='myTable' border='1'>
    <tr id='tr1'><td>Row1</td></tr>
    <tr id='tr2'><td>Row2</td></tr>
    <tr id='tr3'><td>Row3</td></tr>
    <tr id='tr4'><td>Row4</td></tr>
    <tr id='tr5'><td>Row5</td></tr>
  </table>

//======REMOVE TABLE ROW=========
//1\. remove spesific row using its ID
$('#tr1').remove();

//2\. remove spesific row using its order or index.
//row index started from 0-n. Row1 index is 0, Row2 index is 1 and so on.
$('#myTable').find('tr:eq(2)').remove();//removing Row3 
```****~~************************************