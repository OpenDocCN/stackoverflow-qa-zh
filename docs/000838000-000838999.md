# StackOverflow 问答 000838000-000838999

# java - 素数计算的最短代码

> ID：838004
> 
> 赞同：3
> 
> 时间：2009-05-08T02:37:57.350
> 
> 标签：java, primes, code-golf

我学校的计算机科学系报纸（称为[自述](http://img.abakus.no/readme-pdf/readme0903_tilweb.pdf)文件，挪威语，第 19 页）举办了一场有趣的比赛，为以下问题编写尽可能短的 Java 代码。

> 取一个整数（作为字符串数组的第一个条目中的字符串，因为 Java main 方法只接受一个字符串数组）作为参数，并首先写出该数字以下的所有素数，然后写出所有不是素数。最短的代码获胜！

作为答案，我将发布赢得比赛的最短 Java 代码。我想知道 Stack Overflow 社区是否可以制作更短的代码如果你懂挪威语，你会发现如果你这样做了，你可能会赢得一瓶香槟，但不幸的是，比赛的最后提交日期已经结束。

你会如何解决这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T03:12:00.060

在您将标题更改为“Java”之前，我已经在 Haskell 中这样做了。由于这是一个社区 wiki，所以无论如何都在这里。

```
primes n = 
let sieve (p:xs) = p : sieve [x | x<-xs, x `mod` p /= 0] in 
let primes = takeWhile (<n) $ sieve [2..] in 
([0..n] \\ primes, primes)

*Main> primes 20
([0,1,4,6,8,9,10,12,14,15,16,18,20],[2,3,5,7,11,13,17,19]) 
```

**（编辑：）**缩短名称并删除空格使其成为 79 个字符：

```
p n=let s(p:xs)=p:s[x|x<-xs,x`mod`p/=0];r=takeWhile(<n)$s[2..]in(r,[0..n-1]\\r) 
```

在这里，结果对的顺序也被交换，并`n-1`按照规范使用。

使用次优的试验划分使其减少到**50 个字符**：

```
p n=partition(\k->all((>0).rem k)[2..k-1])[2..n-1] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T02:40:12.883

赢得比赛的 Java 代码（153 字节无空格，此处包含空格以方便阅读）：

```
class F {
   public static void main(String[] a) {
      for (int i, j, k = 2; k-- > 0;)
         for (i = 1; i++ < new Long(a[0]);) {
            for (j = i; i % --j > 0;)
               ;
            if (k > 0 ? j < 2 : j > 1)
               System.out.println(i);
         }
      }
   } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-09T15:49:32.380

只是为了好玩，这是[以前 Haskell 答案的 Java 版本。](https://stackoverflow.com/questions/838004/shortest-java-code-for-prime-calculation/838072#838072)给定足够的堆，该程序终止所有参数。

```
import fj.data.Natural;
import fj.data.Stream;
import static fj.data.Stream.*;
import static fj.pre.Ord.naturalOrd;
import fj.pre.Show;
import static fj.pre.Show.streamShow;
import static fj.pre.Show.naturalShow;
import static fj.data.Natural.ZERO;
import static fj.data.Natural.natural;
import fj.P1;
import fj.F;
import static fj.data.Enumerator.naturalEnumerator;

import java.math.BigInteger;

public class Primes2
  {public static Stream<Natural> sieve(final Stream<Natural> xs)
    {return cons(xs.head(), new P1<Stream<Natural>>()
      {public Stream<Natural> _1()
        {return sieve(xs.tail()._1().filter(new F<Natural, Boolean>()
          {public Boolean f(final Natural x)
            {return !naturalOrd.eq(x.mod(xs.head()), ZERO);}}));}});}

  public static Stream<Natural> primes(final Natural n)
    {return sieve(forever(naturalEnumerator, natural(2).some()))
            .takeWhile(naturalOrd.isLessThan(n));}

  public static void main(final String[] a)
    {final Natural n = natural(new BigInteger(a[0])).some();
     final Show<Stream<Natural>> s = streamShow(naturalShow);
     s.println(primes(n));
     s.println(range(naturalEnumerator, ZERO, n)
               .minus(naturalOrd.equal(), primes(n)));}
} 
```

[fj 包来自这里。](http://code.google.com/p/functionaljava)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-10T09:04:51.843

我在 Ruby 中的尝试。93 个字符。

```
def s n
(a=(2..n).to_a).each{|n|a.reject!{|k|k%n==0&&k/n!=1}}
p[[1]+a,(2..n).to_a-a]
end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-04-24T16:05:04.807

如果你想要一个 js 代码：n 是最大值（62 个字符）

```
 for(i=1; i<n;i++)
    {
        for(f = j= 2;j<i && f;)
            f = i%j++
        if(f) console.log(i)
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-12-10T10:34:44.797

## Python，65 个字符

```
print[i for i in range(2,input())if all(i%j for j in range(2,i))] 
```

用法：

```
>>> print[i for i in range(2,input())if all(i%j for j in range(2,i))]
70
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67]
>>> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-02-17T13:50:26.290

一个易于理解和智能的代码可能是这样的：

```
public class test3 {
    public static void main(String[] args) {
        for (int i = 2; i <= 100; i++) {
            int count = 0;
            for (int j = i / 2; j >= 2; j--) {
                if (i % j == 0)
                    count = count + 1;
            }
            if (count == 0)
                System.out.println(i);
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-02-18T19:38:51.367

为了完整起见，还有两个 Haskell 定义。原型

```
primes = map head . scanl (\\) [2..] . map (\p -> [p, p+p..]) $ primes
         where
         (\\) = Data.List.Ordered.minus 
```

以及简洁的绝对冠军，

```
nubBy (((>1).).gcd) [2..]           -- (((>1).).gcd) meaning (\a b -> gcd a b > 1) 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2012-03-24T22:33:43.653

133 个字符 :-)

```
class F {

    public static void main(String[] z) {

        l:
        for (int a=1,b; a < z; a += 2) {

            for (b = 2; b < a; b++)
                if (a % b == 0) 
                    continue l;
            System.out.println(a);
        }
    }
} 
```

# vb.net - DataGridView 和 DataSource：有什么方法可以轻松地显示由外键链接的字段？

> ID：838016
> 
> 赞同：1
> 
> 时间：2009-05-08T02:44:45.243
> 
> 标签：vb.net, visual-studio-2005, datagridview, foreign-keys, datasource

我在 VB.NET 中有一个三层 Windows Forms DB 应用程序。我正在使用 VS 2005。

我想在 DataGridView 的表中显示记录。通过将 DataSource 绑定到与 DB 类对话的业务类，我已经可以按原样显示记录：

```
Dim assetList as List(Of Asset)
assetList = DB_Asset.GetAssetListOrderByID_Asset 
AssetDataGridView.DataSource = assetList 
```

“资产”是我的业务类，“DB_Asset”是我的数据库类，它查询数据库以返回资产列表。

现在，Asset 有这样的成员：

```
Private m_ID_Asset As Integer
Private m_CategoryID As Integer
Private m_CustodianID As Integer
Private m_ManufacturerID As Integer
Private m_SignedOutToID As Integer
Private m_DefaultLocationID As Integer
Private m_CurrentLocationID As Integer
Private m_DateAcquired As Date
Private m_DateEntered As Date
Private m_EnteredByID As Integer 
```

m_ID_Asset 包含 DB 中 Asset 表的主键，m_XXXXXXXXXID 形式的所有其他内容包含 DB 中另一个表的外键。

所以基本上我现在得到的是有很多数字的行。这正是资产表中的内容：

```
ID_Asset  CategoryID  CustodianID  ManufacturerID  SignedOutToID
   1           17          23            14              5 
```

我想知道的是是否有一种简单的方法来显示我用所有这些外键链接到的文本字段：

```
ID_Asset  CategoryName  CustodianName  Manufacturer  SignedOutTo
   1       Soda - Diet      John       Coca-Cola        Fred 
```

这里有经验的人有什么技巧吗？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T03:08:46.637

如果您有一个 List(Of Asset)，那么您基本上只需更改您的查询 DB_Asset.GetAssetListOrderByID_Asset，这样您就可以在那里进行所需的连接并将该属性中的值分配给assetList。

您可能希望将 m_CustomerName As String 之类的内容添加到您的 Asset 类中，以及您将要检索的任何其他内容，以便您可以放置​​数据。

如果您无法更改您的资产类，您可能希望在它周围包装一些东西，以便在绑定之前为您获取所有这些字符串。

# usb - 使用 libhid 读写 USB 时

> ID：838021
> 
> 赞同：3
> 
> 时间：2009-05-08T02:46:45.427
> 
> 标签：usb, libusb

我想使用用户空间库在 Linux 中写入和读取 USB HID 设备的响应。谷歌搜索了一会儿，我发现 libhid 将是一个解决问题的方法。

所以，当我使用`hid_interrupt_write`and `hid_interrupt_read`来发送和接收数据时，出现了这个错误：

```
error submitting URB: No such file or directory 
```

但是当我尝试使用`hid_set_output_report`和`hid_get_input_report`读写设备时，出现了这个错误：

```
error sending control message: Connection timed out. 
```

和

```
error submitting URB: No such file or directory 
```

而且，我不确定如何获取 Usage_Path。

谁能帮我解决这个问题？有什么建议么？

这是我的源代码及其执行时的结果：

```
#include <hid.h>
#include <stdio.h>
#include <string.h>

#define EP_HID_IN             0x81
#define EP_HID_OUT            0x02
#define PACKET_INT_LEN            8

char command[8];
char answer[8];

const int PATHLEN = 2;
int const PATH_IN[2] = { 0xffff0001, 0xffff0003 };
int const PATH_OUT[2] = {0xffff0001, 0xffff0005 };

const int SEND_PACKET_LEN = 8;
const int RECV_PACKET_LEN = 8;

bool match_serial_number(struct usb_dev_handle* usbdev, void* custom, unsigned int len)
{
  bool ret;
  char* buffer = (char*)malloc(len);
  usb_get_string_simple(usbdev, usb_device(usbdev)->descriptor.iSerialNumber,
      buffer, len);
  ret = strncmp(buffer, (char*)custom, len) == 0;
  free(buffer);
  return ret;
}

int main(void)
{
  HIDInterface* hid;
  hid_return ret;
  int i = 0;

  HIDInterfaceMatcher matcher = { 0x03eb, 0x4b4e, NULL, NULL, 0 };

  /* see include/debug.h for possible values */
  hid_set_debug(HID_DEBUG_ALL);
  hid_set_debug_stream(stderr);
  /* passed directly to libusb */
  hid_set_usb_debug(1);

  ret = hid_init();
  if (ret != HID_RET_SUCCESS) {
    fprintf(stderr, "hid_init failed with return code %d\n", ret);
    return 1;
  }

  hid = hid_new_HIDInterface();
  if (hid == 0) {
    fprintf(stderr, "hid_new_HIDInterface() failed, out of memory?\n");
    return 1;
  }

  ret = hid_force_open(hid, 0, &matcher, 3);
  if (ret != HID_RET_SUCCESS) {
    fprintf(stderr, "hid_force_open failed with return code %d\n", ret);
    return 1;
  }

  ret = hid_write_identification(stdout, hid);
  if (ret != HID_RET_SUCCESS) {
    fprintf(stderr, "hid_write_identification failed with return code %d\n", ret);
    return 1;
  }

  ret = hid_dump_tree(stdout, hid);
  if (ret != HID_RET_SUCCESS) {
    fprintf(stderr, "hid_dump_tree failed with return code %d\n", ret);
    return 1;
  }

   // Set command,
    command[0] = 0x03;
       command[1] = 0x01;     
       command[2] = 0x31;
       command[3] = 0x31;           
       command[4] = 0x04;
       command[5] = 0x00;
       command[6] = 0x00;
       command[7] = 0x00;
/*

  ret = hid_set_output_report(hid, PATH_IN, PATHLEN, command, SEND_PACKET_LEN);
  if (ret != HID_RET_SUCCESS) {
    fprintf(stderr, "hid_set_output_report failed with return code %d\n", ret);
  }
  ret = hid_get_input_report(hid, PATH_OUT, PATHLEN, answer, RECV_PACKET_LEN);
      if (ret != HID_RET_SUCCESS) {
        fprintf(stderr, "hid_get_input_report failed with return code %d\n", ret);
      }
   */
  ret = hid_interrupt_write(hid, EP_HID_OUT, command, PACKET_INT_LEN, 20);
  if (ret < 0) {
      printf("error in interrupt write\n");
      return 1;
      }
    printf("Reading interrupt\n");
    ret = hid_interrupt_read(hid, EP_HID_IN, answer, PACKET_INT_LEN, 4);
    if(ret < 0) {
     printf("error interrupt read\n");
    return 1;
    }

    printf("Interrupt Transfer Loop Test Result:\n");
    for(i = 0;i < PACKET_INT_LEN; i++) {
        if(i%8 == 0)
        printf("\n");
        printf("%02x; ",command[i]);
    }
    printf("\n");
    printf("\n");
    for(i = 0;i < PACKET_INT_LEN; i++) {
        if(i%8 == 0)
        printf("\n");
        printf("%02x; ",answer[i]);
    }
    printf("\n");
    printf("\n");

  ret = hid_close(hid);
  if (ret != HID_RET_SUCCESS) {
    fprintf(stderr, "hid_close failed with return code %d\n", ret);
    return 1;
  }

  hid_delete_HIDInterface(&hid);

  ret = hid_cleanup();
  if (ret != HID_RET_SUCCESS) {
    fprintf(stderr, "hid_cleanup failed with return code %d\n", ret);
    return 1;
  }

  return 0;
} 
```

结果：

```
# ./test_libhid
usb_set_debug: Setting debugging level to 1 (on)
 NOTICE: hid_init(): libhid 0.2.15+20060325.0.0 is being initialized.
  TRACE: hid_init(): initialising USB subsystem...
usb_os_init: Found USB VFS at /dev/bus/usb

...
...
device identification of HIDInterface 002/009[0]:
  dev_handle:    0x09a52098
  device:        0x09a55068
  location:      002/009
  manufacturer:  ATMEL
  product:       Firmware Demo
  TRACE: hid_reset_parser(): resetting the HID parser for USB device 002/009[0]...
  TRACE: hid_dump_tree(): iterating the parse tree for USB device 002/009[0]...
parse tree of HIDInterface 002/009[0]:
  path: 0xffff0001.0xffff0002; type: 0x80
  path: 0xffff0001.0xffff0003; type: 0x80
  path: 0xffff0001.0x00000000; type: 0x80
  path: 0xffff0001.0x00000000; type: 0x80
  path: 0xffff0001.0x00000000; type: 0x80
  path: 0xffff0001.0x00000000; type: 0x80
  path: 0xffff0001.0x00000000; type: 0x80
  path: 0xffff0001.0x00000000; type: 0x80
  path: 0xffff0001.0xffff0004; type: 0x90
  path: 0xffff0001.0xffff0005; type: 0x90
  path: 0xffff0001.0x00000000; type: 0x90
  path: 0xffff0001.0x00000000; type: 0x90
  path: 0xffff0001.0x00000000; type: 0x90
  path: 0xffff0001.0x00000000; type: 0x90
  path: 0xffff0001.0x00000000; type: 0x90
  path: 0xffff0001.0x00000000; type: 0x90
  path: 0xffff0001.0xffff0006; type: 0xb0
  path: 0xffff0001.0xffff0007; type: 0xb0
  path: 0xffff0001.0x00000000; type: 0xb0
  path: 0xffff0001.0x00000000; type: 0xb0
  TRACE: hid_reset_parser(): resetting the HID parser for USB device 002/009[0]...
  TRACE: hid_set_output_report(): looking up report ID...
  TRACE: hid_prepare_parse_path(): preparing search path of depth 2 for parse tree of USB device 002/009[0]...
  TRACE: hid_prepare_parse_path(): search path prepared for parse tree of USB device 002/009[0].
 NOTICE: hid_find_object(): found requested item.
  TRACE: hid_set_output_report(): sending report ID 0x00 (length: 8) to USB device 002/009[0]...
WARNING: hid_set_output_report(): failed to send report to USB device 002/009[0]:error sending control message: Connection timed out.
hid_set_output_report failed with return code 19
Reading interrupt
  TRACE: hid_interrupt_read(): retrieving interrupt report from device 002/009[0] ...
WARNING: hid_interrupt_read(): failed to get interrupt read from device 002/009[0]: error submitting URB: No such file or directory
Interrupt Transfer Loop Test Result:

03; 01; 31; 31; 04; 00; 00; 00;

00; 00; 00; 00; 00; 00; 00; 00;

  TRACE: hid_close(): closing USB device 002/009[0]...
  TRACE: hid_close(): closing handle of USB device 002/009[0]...
 NOTICE: hid_close(): successfully closed USB device 002/009[0].
  TRACE: hid_reset_parser(): resetting the HID parser for USB device 002/009[0]...
  TRACE: hid_close(): freeing memory allocated for HID parser...
  TRACE: hid_close(): resetting HIDInterface...
 NOTICE: hid_cleanup(): successfully deinitialised HID library. 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-07-08T15:20:28.397

libhid 建立在 libusb 之上。老实说，libusb 是一个更好的库。它使来回通信变得非常容易。实际上，如果您有兴趣，我可以给您发送一个读取和写入 HID 设备的示例程序。

Libhid 需要更多的努力，而且文档更糟糕。

当然，无论哪种方式，您都必须确保写入正确的设备（通过检查产品和供应商 ID），如果使用 libhid，还必须将正确的数据包发送到正确的路径。（有三个路径：输入、输出和特征）。

我真的建议使用 libusb。

# svn - 使用 TortoiseSVN 从工作与家庭 + VPN 访问 svn repo

> ID：838024
> 
> 赞同：0
> 
> 时间：2009-05-08T02:48:02.380
> 
> 标签：svn, version-control, tortoisesvn, visualsvn-server

我得到了另一个 SO 帖子中描述的相同[错误](https://stackoverflow.com/questions/111543/tortoisesvn-error-options-of-https-could-not-connect-to-server)。不同之处在于，当我在不需要 VPN 连接到网络的情况下工作时，一切正常。但是当我尝试从家里访问相同的 SVN 存储库时，我收到以下错误：

> TortoiseSVN 错误：“'https://...' 的选项无法连接到服务器 (...)”</p>

直到最近当我升级到最新的 TortoiseSVN 和 VisualSVN 版本时，这才成为问题。我还应该提到，在升级时我将 Chrome 设置为我的默认浏览器，但不确定这是否与它有关。

我感觉到将 TortoiseSVN 恢复到以前的版本并将我的默认浏览器切换回 IE，但我仍然无法从家里连接到 repo。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-09-04T06:16:00.240

由于您是通过 Apache httpd 通过 Subversion 连接的，因此您可以打开浏览器并输入您要检查的 https:// URL。这将消除您端的 Subversion 客户端，并让您知道问题是否与客户端有关。

如果您无法通过浏览器访问 URL，则问题出在连接或服务器端。如果您可以从工作中访问相同的 URL，则问题出在连接上。

如果问题出在您的连接上，您必须与您的 IT 部门讨论该问题。您可以通过 VPN 通过浏览器访问任何其他内部网站吗？它只是这个特定的服务器吗？HTTPS 使用端口 443 而不是默认端口 80。很可能您的 IT 部门在*[安全过载](http://www.nytimes.com/2010/05/20/technology/personaltech/20pogue-email.html)*的情况下决定阻止除端口 80 之外的几乎所有端口。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T03:10:35.837

您可以通过浏览器访问 svn 存储库吗？以及测试应该告诉您是否有任何证书问题需要处理的连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T03:30:37.690

*   您是否已验证您工作的 VPN 是否将您连接到公司网络内？
*   你能做任何你可以在工作中做的事情，比如访问内部服务器上的文件共享或访问开发服务器吗？

*   导航到 VisualSVN URL 时，请提供来自您的 IE/FF 的确切错误。

好的，因此您无法通过浏览器访问 SVN 存储库，这会将问题缩小到网络配置（代理服务器、防火墙）或服务器仅允许从特定 IP 地址访问。

*   您能否通过 RDP 连接到工作场所的服务器并验证通过浏览器访问 HTTPS 站点是否成功？如果失败，您能否验证 VisualSVN 是否正在运行？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T04:11:51.947

您可能只需要设置代理。升级 Tortoise 版本会取消设置代理，并且更改浏览器会在浏览器端执行相同的操作。当我忘记设置代理时，我通过 vpn 得到同样的错误。

# flash - Flash 播放 SWF，视频正常声音在第 4 场景中加速

> ID：838026
> 
> 赞同：0
> 
> 时间：2009-05-08T02:50:39.707
> 
> 标签：flash, audio, flash-cs4, overlap

当我将每个单独的场景作为 SWF 播放时，所有声音都正确同步，但是当我在场景 4 中播放整个动画时，声音播放得太早并且速度也加快了大约 2 倍正常速度。我该如何解决这个问题?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T02:55:03.317

如果您解释如何设置 Flash 文件会有所帮助，因为在时间轴上，您可以通过多种不同方式将声音添加到图层，流式传输就是其中之一。因此，例如，如果您将视频锁定到帧并且您的声音正在流式传输，那么它们很可能很快就会不同步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T05:29:27.860

对于我的每个声音，我在时间线的其余部分上方都有一个单独的层，带有一个开始和停止按钮，我试图流式传输它，而该类别中的另一个选项我不记得了。如果有帮助，这也适用于 CS4 和动作脚本 3。我可以有哪些不同的方法

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-21T20:30:21.057

在每个场景开始时使用 ActionScript 播放您将添加到库中并导出到 ActionScript 的声音。

# c - K&R：字符指针数组

> ID：838030
> 
> 赞同：5
> 
> 时间：2009-05-08T02:52:24.647
> 
> 标签：c, arrays, pointers, kernighan-and-ritchie

在第 页。109 的 K&R，我们看到：

```
void writelines(char *lineptr[], int nlines)
{
  while (nlines -- > 0) printf("%s\n", *lineptr++);
} 
```

我对 *lineptr++ 究竟做了什么感到困惑。据我了解，printf 需要一个 char 指针，因此我们使用 *lineptr 提供它。然后我们将 lineptr 增加到数组中的下一个 char 指针？这不是违法的吗？

在第 99 页，K&R 写道：“数组名称不是变量；像 a=pa [其中 a 是数组，pa 是指向数组的指针] 和 a++ 这样的结构是非法的。”

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T03:21:06.030

继续阅读！在 p 的最底部。99

> 作为函数定义中的形参，
> 
> ```
>  char s[]; 
> ```
> 
> 和
> 
> ```
>  char *s; 
> ```
> 
> 是等价的；我们更喜欢后者，因为它更明确地说参数是一个指针。

即，您永远不能将数组（不是变量）传递给函数。如果你声明的函数看起来像一个数组，它实际上是一个指针（它*是*一个变量）。这是有道理的。函数参数不是变量会很奇怪——每次调用函数时它都可以有不同的值，所以它肯定不是常量！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T02:57:37.520

`lineptr`不是真正的数组；它是指向指针的指针。请注意，后增量运算符`++`的优先级高于取消引用运算符`*`，因此发生的情况`lineptr++`是：

1.  `lineptr`递增以指向数组中的下一个元素
2.  的结果`lineptr++`是 的旧值`lineptr`，即指向数组中当前元素的指针
3.  `*lineptr++`取消引用，所以它是数组中当前元素的值

因此，while 循环遍历数组中的所有元素`lineptr`（每个元素都是 a `char*`）并将它们打印出来。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-08T02:58:18.830

可能更容易想象`*lineptr++`如下：

```
*(lineptr++) 
```

在那里，指向`char*`s 数组的指针被移动到数组的下一个元素，即从`lineptr[0]`，我们移动到`lineptr[1]`。（由于指针的后缀增量，指针的增量发生在取消引用之后。）

所以基本上，会发生以下事情：

1.  `lineptr[0]`（类型`char*`）通过延迟检索。
2.  指针递增到数组的下一个元素。（通过指针上的后缀增量`lineptr`。）
3.  指针现在指向`lineptr[1]`，再次从步骤 1 重复该过程。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-08T06:42:10.523

Adam Rosenfield 选择的答案是错误的。coobird的答案也是如此。出于这个原因，我对这两个答案都投了反对票。

Adam Markowitz 的解释`*lineptr++`是正确的，但他没有回答主要问题这是否是合法的 C99 代码。只有 Tom Future 能做到；不幸的是，他没有解释`*lineptr++`。我给他们每人一分。

所以简而言之，`lineptr`是一个变量，可以作为指针进行操作。因此，增加指针是合法的。

`lineptr`是指向字符序列的指针序列的指针。换句话说，它是指向字符串数组的第一个字符串的指针。根据代码，我们可以假设字符串是空（'\0'）终止的字符序列。 `nlines`是数组中的字符串数。

while 测试表达式是`nlines-- > 0`. `nlines--`是后减量（因为`--`在变量的右侧）。因此，它在执行测试**之后**执行，无论测试结果如何，在任何情况下都是如此。

因此，如果`nlines`作为参数给出的值是`0`，则首先执行测试并返回`false`; 循环中的指令不被执行。请注意，因为`nlines`无论如何都会递减，所以`nlines`after`while`循环的值将是`-1`.

如果`nlines == 1`，则测试将返回`true`并`nlines`递减；循环中的指令将执行一次。请注意，在执行这些指令时， 的`nlines`值为`0`。再次执行测试时，我们又回到了`nlines == 0`.

该`printf`指令使用`*lineptr++`表达式。它是指针的后增量（`++`位于变量的右侧）。这意味着首先计算表达式，并在使用**后**执行增量。所以在第一次执行时`printf`会收到字符串数组第一个元素的副本，它是指向字符串第一个字符的指针。`lineptr`只有在那之后才增加。下次`printf`执行时，`lineptr`点在第二个元素上，并在打印第二个字符串时移动到第三个。这是有道理的，因为我们显然想要打印第一个字符串。如果 Adam Rosenfield 是对的，第一个字符串会被跳过，最后我们会尝试打印超出最后一个字符串的字符串，这显然是一件坏事。

因此，该`printf`指令是以下两个指令的简明形式

```
printf("%s\n", *lineptr);
++lineptr; // or lineptr++, which is equivalent but not as good. lineptr += 1; is ok too. 
```

请注意，根据经验，当前置增量和后置增量的作用相同时，出于性能原因，前置增量更可取。编译器会小心为您切换它。嗯，大多数时候。只要有可能，对预操作员自己最好，所以总是使用它。一旦您在 C++ 中实现了后自增和预自增，原因就会变得更加明确。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-10-13T14:19:27.640

我认为上面的答案都没有回答这个问题，也就是说，为什么`lineptr`数组的名称而不是变量的名称可以像 K&R 中那样递增，即使是 chmike 最赞成的答案也只能说明关联性运营商，但仍然错过了问题的重点。

我认为这个问题的答案在于这个定义：

> 对出现在表达式中的数组 T 类型对象的引用衰减（除了三个例外）成指向其第一个元素的指针；结果指针的类型是指向 T 的指针。

也就是说，`lineptr`这里不再是数组的名字了`lineptr`，已经衰减成指针了。

参考：

1.  [http://c-faq.com/aryptr/aryptrequiv.html](http://c-faq.com/aryptr/aryptrequiv.html)
2.  [在 C 中通过引用传递数组](https://stackoverflow.com/questions/19646512/passing-an-array-by-reference-in-c)

# asp.net - 团队中的网站开发

> ID：838046
> 
> 赞同：2
> 
> 时间：2009-05-08T02:58:45.663
> 
> 标签：asp.net, windows

我正在与其他 4 人一起在 Asp.net 网站上工作。我们遇到的问题是我们需要什么样的硬件设置才能实现团队开发？我们有四台独立的台式计算机，我们还需要哪些其他硬件？还有哪些其他开发软件适合此类开发？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T04:16:06.380

Embarcadero 开发者网络 ( [http://edn.embarcadero.com](http://edn.embarcadero.com) ) 的预算极低，我们使用自己的 PC 作为开发环境。目前有 3 个主要开发人员，包括我自己。

因为我的团队成员是远程的，所以我们还有用于开发和调试的虚拟机与我们的实时服务器位于同一个数据中心。沟通至关重要，为此我们非常依赖 Skype ( [http://www.skype.com/](http://www.skype.com/) )。

对于源代码管理，我们使用免费的开源[http://subversion.tigris.org/](http://subversion.tigris.org/)。[TortoiseSVN（ http://tortoisesvn.net/](http://tortoisesvn.net/)）是一个很好的 SVN 通用 Windows 客户端。SVN 的一个优秀的 Visual Studio 插件是[http://ankhsvn.open.collab.net/](http://ankhsvn.open.collab.net/)。

对于单元测试，我们使用 NUnit ( [http://nunit.com](http://nunit.com) ) 进行 .NET 测试。我们使用 DUnit ( [http://dunit.sourceforge.net/](http://dunit.sourceforge.net/) ) 进行 Delphi 代码测试。

在部署之前，拥有一个不是开发机器的登台/测试服务器来部署您打算在现场部署之前发布的内容非常重要。这是确保您将所需的一切部署到实时服务器的唯一可靠方法。

对于负载平衡环境中的部署，Robocopy（有关更多信息，请参见[http://en.wikipedia.org/wiki/Robocopy](http://en.wikipedia.org/wiki/Robocopy)）是一个非常有用的工具，可确保您的实时服务器镜像您的“登台”服务器。我们有一个“全部完成”批处理文件，它 1) 从 Subversion 中提取最新版本，2) 合并并最小化我们的 CSS 和 JavaScript（使用我编写的工具，我将在某天发布，以及 JS 打包工具来自 fckeditor 的人），3）将我们的模板、css、图像、脚本等的最新版本部署到实时服务器。

至于我们的服务器，我们使用的是 Windows Server 2003。标准版可能足以满足您的需求。尽管我们有数百万用户，但我们的大多数 Web 服务器在 2GB 的 RAM 中运行良好。我们使用较多的服务器有 4GB 的 RAM。几乎每个 Web 应用程序都负载平衡到至少 2 台相同的服务器上。我们的 Web 应用程序服务器主要是 VM，但我们的数据库服务器始终是具有不同 RAM 要求的专用机器。VM 无法为您提供数据库所需的性能。

我们还主要使用 InterBase ( [http://www.embarcadero.com/products/interbase/](http://www.embarcadero.com/products/interbase/) ) 和 Blackfish SQL ( [http://www.embarcadero.com/products/blackfish_sql/](http://www.embarcadero.com/products/blackfish_sql/) ) 作为我们的数据库，但大多数以 MS 为中心的商店会更喜欢一些 MS SQL 的味道。

我们编写了自己的监控解决方案来监控构成 EDN 的数据库、Web 响应和 Web 服务，但您可能会发现像 Nagios ( [http://www.nagios.org/](http://www.nagios.org/) ) 这样的工具可以方便地监控您的实时服务器。

然后，您还需要一个问题跟踪系统，例如 Jira ( [http://www.atlassian.com/software/jira/](http://www.atlassian.com/software/jira/) ) FogBugz ( [http://www.fogcreek.com/FogBUGZ/)、BugZilla](http://www.fogcreek.com/FogBUGZ/) ( [http://www .bugzilla.org/](http://www.bugzilla.org/) )，Trac ( [http://trac.edgewall.org/](http://trac.edgewall.org/) )，可以与 Subversion 或其他东西一起使用。EDN 团队使用 QualityCentral ( [http://qc.embarcadero.com](http://qc.embarcadero.com) )，但这是其他人无法使用的本土解决方案。

高温高压

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T03:03:23.733

您需要某种形式的源代码控制，可以存储在其中一个桌面（不理想）或另一台服务器上。

除此之外，这种开发通常会让每个开发人员在他们自己的机器上复制环境。

在某些时候，最好能够将该代码放到服务器上并构建它以用于测试和验证目的。如果您缺少硬件，这可能是桌面之一。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T04:04:32.040

我主要与位于新西兰、加拿大、美国和以色列的团队一起进行 ASP.NET 开发，因此我有很多在团队环境中有效工作的经验。基于此经验，这是我的团队发展必备品清单：

*   一个版本控制系统，允许您存储和管理源代码的多个修订版。为此，我们使用[Subversion](http://subversion.tigris.org)，但任何体面的 VCS 就足够了。除了源代码之外，我们还将它用于共享文档以及我们的应用程序使用的工具和库。
*   与团队沟通的有效方式。由于我们广泛的地理分布，我们在此方面严重依赖[Skype](http://www.skype.com/)，同时使用群聊和电话会议。
*   允许轻松构建所有共享库和应用程序的构建过程。理想情况下，这应该通过计划的构建运行来自动化，以验证 VCS 中源的完整性。有很多工具可以帮助解决这个问题（例如[MSBuild](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)、[NAnt](http://nant.sourceforge.net/)）。由于我们的项目跨越了许多不同的开发环境和语言（包括 Visual Studio、Delphi、Java、PHP），我们发现使用批处理文件来控制这个过程非常适合我们的需求。如果您使用测试驱动的开发方法（或者完全遵循 TDD，或者使用适合您的开发风格的变体），还建议在这个计划的构建过程中运行您的单元测试。
*   一个项目管理、任务和问题跟踪系统。我们目前正在为此使用[Jira 。](http://www.atlassian.com/software/jira/)
*   用于共享信息的易于更新的存储库，例如内部 wiki。为此，我们使用了一个内部编写的内容管理系统（实际上与驱动[Embarcadero 开发者网络](http://edn.embarcadero.com)的系统相同:-)）。

至于硬件要求，这在很大程度上取决于您的实际开发要求和预算。我可能会建议至少为您的 VCS 配备一个专用服务器。您也可以将它加倍作为您的构建机器，尽管您可能也需要一个专用的机器。

也可能需要一台或六台专用测试机和数据库服务器，但根据预算，这些功能可以酌情共享。虚拟化也可能是一种在保持良好的功能分离的同时最大限度地减少硬件支出的有效方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T03:03:29.270

您所描述的听起来不像是通过硬件解决的问题，而是通过通信和定义的过程（[敏捷软件开发](http://en.wikipedia.org/wiki/Agile_software_development)是一种方法）。源代码管理软件，例如[bazaar](http://bazaar-vcs.org)、[git](http://git-scm.com/)、[mercurial](http://www.selenic.com/mercurial/wiki/)或[subversion](http://subversion.tigris.org/)可能很有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T03:04:10.017

你在使用 Visual Studio Team System 吗？

我会推荐某种源代码存储库，并且很可能是构建服务器（VSTS 提供的功能）。

当然，除了 VSTS，还有其他选择，包括免费的开源解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T03:08:51.083

对于五人以下的团队，如果您拥有 MSDN 许可证，则可以免费使用 Team Foundation Server 工作组版 :-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-08T03:25:09.607

我刚刚完成了一个大型（6 个月的项目）ASP.NET Web 应用程序，该应用程序是与其他 4 人使用 Visual Studio 2008、Team Foundation Server 和 SQL Server 2008 开发的，我对这个组合非常满意。

在 Team Foundation Server 之前，我们使用 Visual Source Safe 进行源代码控制。我不能告诉你 TFS 比 VSS 有什么改进。

我最喜欢的一些功能是：

*   与 Visual Studio 无缝集成
*   文件控制
*   项目管理解决方案，例如“工作项”功能
*   能够“搁置”您正在研究的内容以尝试不同的想法

除了这三个，我们不需要*任何*其他软件。我们设置了几个数据库实例，一个用于开发，一个用于生产测试。我们的数据库是在 Visual Studio 中作为数据库项目开发的，一旦我们准备好进行生产测试，就可以非常轻松地进行部署。它还使得在两个测试数据库之间进行模式比较和更新变得容易。

就硬件而言，我们有一台用于 TFS 的服务器和一台用于应用程序测试的服务器。我相信你可以将两者结合起来。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T03:06:45.143

如果有人有一个额外的盒子，我会推荐 SubVersion ...应该让你的提交、签到等事情变得容易

# smalltalk - 何时使用 Seaside 组件，何时使用简单的渲染对象？

> ID：838048
> 
> 赞同：17
> 
> 时间：2009-05-08T02:59:33.867
> 
> 标签：smalltalk, squeak, seaside

我最近一直在 Seaside+Squeak 中开发一个 Web 应用程序，并发现它是一次美妙的体验。Seaside 确实比其他所有框架都遥遥无期，我觉得我好像在更高层次的抽象上工作（在其他框架让你处理的 HTTP 请求/响应周期和 HTML 模板之上）。

也就是说，我对 Seaside 组件有点困惑。我最近不得不在一个组件上显示一个对象列表（类似于 stackoverflow 的首页）。起初我将每个对象都设为一个组件（WAComponent 的子类），但事实证明这非常浪费，而且我必须在父组件中动态设置#children 才能使其正常工作。然后我尝试让它们呈现对象（不是 WAComponent 子类的对象，并使用 renderOn: 而不是 renderContentOn: 进行呈现，就像组件一样）。这行得通，但现在他们不能再像组件那样访问会话对象中的全局状态（使用#session）。然后我发现了“WACurrentSession 值”，它使任何对象都可以访问当前的 Seaside 会话对象。我现在能够让它们渲染对象。此外，

除了需要呼叫/应答或回溯状态之外，还有哪些其他原因需要使用组件而不是渲染对象？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-08T08:05:52.553

对于 Seaside 新用户来说，这是一个常见的困惑点。我们已经努力在 Seaside 2.9（目前处于 Alpha 阶段）中更清楚地说明这一点，但我将在这里尝试专注于 2.8，因为这听起来像是您正在使用的。

首先，您不需要使用组件来访问会话是正确的。Seaside 2.9`#session`升级到一个新类`WAObject`，几乎所有 Seaside 对象（包括组件）都可以访问它，但您现在绝对可以`WACurrentSession`在 2.8 中引用自己。

组件在 2.8 中大致提供以下功能：

1.  `#renderContentOn:`使用您在其中指定的任何渲染器类的实例调用`#rendererClass`（而不是在要求您的对象渲染自身时使用的任何渲染器）
2.  一个钩子 ( `#updateUrl:`) 允许更新渲染器用来生成链接的 URL
3.  挂钩 ( `#updateRoot:`, `#style`, `#script`) 允许更新 HTML 文档的 HEAD 部分
4.  成为应用程序根的能力
5.  钩子 ( `#updateStates:`, `#states`) 使状态回溯更容易
6.  一个钩子 ( `#initialRequest:`) 允许根据导致创建 Session 的请求进行初始化
7.  一个工具 ( `#children`) 确保你下面的所有组件也将调用上面的钩子
8.  添加装饰品的能力
9.  显示/接听/呼叫的能力（使用装饰品）
10.  一些方便的方法（`#inform:`,`#isolate:`等）

如果您不需要上述任何一项，则不需要组件。如果您需要上述任何一项，那么您几乎确实需要一个组件，除非您想在自己的类上实现等效的功能。

最简单的衡量标准可能是：如果您打算在 HTTP 请求之间保留对象，则它应该是一个组件；如果您打算丢弃对象并在每次渲染过程中创建它，则可能不需要。如果您想像一个显示博客页面的应用程序，您可能会有用于菜单、博客卷、博客正文、每条评论等的组件。您可能需要考虑阅读博客的标记和生成其 HTML，以便您可以支持不同的标记或不同的渲染器，并且评论组件可以支持相同的标记。这可以通过一个非组件类来完成，该类实现`#renderOn:`并可以根据需要由其他组件创建和使用。

`WAPresenter`Seaside 2.9 目前通过具体化并`WAPainter`作为其超类引入来拆分上述功能。上面的 1-3`WAPainter`和 4-7都实现了，`WAPresenter`因此您可以根据需要选择要子类化的内容。它还从 WAPresenter 和 WAComponent 中删除了许多方法，以使最终用户更容易理解它们。

希望有帮助。

# apache-flex - 如何在 Flex 项目中创建/使用主题

> ID：838061
> 
> 赞同：0
> 
> 时间：2009-05-08T03:06:48.717
> 
> 标签：apache-flex, actionscript-3

我刚开始使用 Flex，虽然我使用 Actionscript2 已经有几年了，但我仍然对 Actionscript3 有所了解。过去一周我一直在研究 Flex，但无法弄清楚这一点。

我正在寻找最好的方法（或“一种”方法），让我和其他从事这个项目的人能够轻松地为视频播放器创建新主题。我展示了两个视频，并且需要能够重新定位它们，设置它们的样式，添加图像和其他任何东西，真的。我不希望创建一个完整的模板引擎，但如果我可以为每个模板创建一个单独的文件/文件夹，那将完全是我的一天。

我想象有一个解决方案，其中我将在 src/templates/ 中有一个文件夹，在该文件夹中我将有 view.mxml，其中包含显示视频所需的所有内容。然后，我将能够添加其他文件，例如图像等，以使该模板看起来应有的样子。

应该使用哪个模板应该由主视频文件中的变量定义。这将在播放时提供给 swf 文件，或者由加载外部配置文件的视频提供（但这不是我的问题的一部分：）。

所以，简而言之；如何在 src 中包含一个或两个子文件夹中的 mxml 文件，以及如何以可以通过变量选择我希望包含的文件的方式执行此操作。

提前非常感谢！

-戴夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T05:57:09.710

您会惊讶于 Flex 应用程序可以在多大程度上通过样式改变其外观。查看以下项目：

[http://www.fillcolors.com/](http://www.fillcolors.com/)

如果您仍然需要更大的灵活性，您可以拥有一个具有多个视图的应用程序，每个视图对应您要显示的每个主题。在 Flex 中执行此操作的一种简单方法是使用 ViewStack 组件，该组件基本上是分层视图显示，在给定时间仅显示一个。

作为一个非常简单的例子，你可以有一些类似的东西：

```
<mx:ViewStack selectedIndex="{currentIndex}">
     <themes:CustomTheme1/>
     <themes:CustomTheme2/>
     <themes:CustomTheme3/>
</mx:ViewStack> 
```

在这里，currentIndex 是绑定到 ViewStack 的变量，确定三个子项中的哪一个当前可见，每个子项代表一个自定义 MXML 组件（在您的例子中，一个主题）。

回复评论：

是的，上面的示例正是为了做到这一点而设计的，但它实际上不是 Flex 的特性，而是 AS3 的特性。CustomThemeX 组件使用**主题**命名空间定位。命名空间在父组件根标签中定义。在这个例子中，父组件是一个 Canvas 组件：

```
<mx:Canvas xmlns:themes="themes"> 
```

这告诉编译器在应用程序的主题子文件夹中查找这些自定义组件；换句话说，src/themes 文件夹，其中包含 CustomThemeX 组件。

如果上一段对您来说不是很有意义，我建议您拿起一本书/阅读有关 AS3/Flex 的文档，并了解更多有关 AS3 和面向对象编程的一些核心概念的信息。我希望我能提供更多帮助，但是这个问题开始变得有点过于宽泛了。我希望你明白。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T04:41:32.717

我不是 Flex 方面的专家。但是我在[gotoAndLearn.com](http://www.gotoandlearn.com)上看到了有关 Flex 皮肤的教程。也许这个 kan 给了你一些提示：[Flex 简介：第 3 部分](http://www.gotoandlearn.com/play?id=101)

# ruby-on-rails - Rails SequencedHash 源文件

> ID：838062
> 
> 赞同：0
> 
> 时间：2009-05-08T03:08:06.590
> 
> 标签：ruby-on-rails, ruby

我正在测试基于 Rails 1.2.6（我知道它已经过时）的 AlumniOnRails（[http://rubyforge.org/frs/?group_id=2959&release_id=17170](http://rubyforge.org/frs/?group_id=2959&release_id=17170)）并设法启动它，安装所需的 gem，创建并迁移了数据，大多数基本的校友功能都已启动，但其中一个损坏的部分似乎缺少一个库，但经过几次合理的搜索后我似乎无法找到它。

记录器显示*没有要加载的此类文件 - collections/sequenced_hash*在控制器中有一行代码为*require 'collections/sequenced_hash*，这很明显缺少*sequence_hash*库。

在 Google 上进行的一些搜索显示了一些参考，其中一个最接近的指针是[http://collections.rubyforge.org/classes/SequencedHash.html](http://collections.rubyforge.org/classes/SequencedHash.html)但不幸的是源链接已失效。有没有人保留这种旧文件或将我指向它所在的某个地方？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T09:17:50.790

有人在 ruby​​ 论坛上回答了这个问题，它可以工作：

> **gem 安装集合**

# c# - 覆盖图像文件（位图）

> ID：838063
> 
> 赞同：1
> 
> 时间：2009-05-08T03:08:17.260
> 
> 标签：c#, bitmap, save

您好我正在尝试将位图图像保存在基本图像编辑器程序中。

这是代码：

```
 // then save it
        ImageBoxInApp.Image.Save(filename); 
```

**[编辑]**我用这个打开图像

```
openFileDialog1.Title = "Select an Image";
        openFileDialog1.Filter = "All Files|*.*|Windows Bitmaps|*.bmp|JPEG Files|*.jpg";
        if (openFileDialog1.ShowDialog() == DialogResult.OK)
        {
            filename = openFileDialog1.FileName;
            Image img = System.Drawing.Image.FromFile(filename); 
```

所以当我尝试这个时，我会收到一个`Generic GDI+ error`. 所以我找到了一个[解决方案](http://support.microsoft.com/kb/312119)，它看起来像这样：

```
 // Delete existing file first
        System.IO.File.Delete(filename);
        // then save it
        ImageBoxInApp.Image.Save(filename); 
```

但是当我尝试这样做时，我收到另一个错误，说我正在删除的文件当前是打开的。这是因为这是我要编辑的文件。

如何在不实际关闭应用程序的情况下“关闭”文件？还是有替代解决方案？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T03:24:55.210

如果没有看到有关如何加载文件的一些上下文，很难说，但这里有一些建议：

1.  保存前，将现有图像复制到新图像中，关闭原图，执行删除，然后保存副本。
2.  将文件保存为随机文件名，删除原始文件，将随机命名的文件重命名为原始名称。
3.  将文件加载到内存流中并使用内存中的副本来初始化图像。

在大多数情况下，我个人会选择选项#3。请务必在使用完图像后将其丢弃 - 最好将其包装在 using ( ) 块中。

# ruby - 如果浮点组件不是 .00 sprintf/printf，则仅显示小数点

> ID：838064
> 
> 赞同：41
> 
> 时间：2009-05-08T03:08:21.100
> 
> 标签：ruby, floating-point, printf

我非常格式化浮点数，但如果没有相关的浮点数，我希望它显示为整数。

IE

*   1.20 -> 1.2x
*   1.78 -> 1.78 倍
*   0.80 -> 0.8x
*   2.00 -> 2x

我可以通过一些正则表达式来实现这一点，但想知道是否有一种`sprintf`-only 方法可以做到这一点？

我在红宝石中相当懒惰地这样做：

```
("%0.2fx" % (factor / 100.0)).gsub(/\.?0+x$/,'x') 
```

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-05-08T03:40:17.840

您想使用`%g`而不是`%f`：

```
"%gx" % (factor / 100.00) 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2012-03-08T22:04:21.870

您可以像这样混合和匹配 %g 和 %f ：

```
"%g" % ("%.2f" % number) 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2013-09-03T12:26:28.460

如果您使用的是 rails，您可以使用 rails 的 NumberHelper 方法： [http ://api.rubyonrails.org/classes/ActionView/Helpers/NumberHelper.html](http://api.rubyonrails.org/classes/ActionView/Helpers/NumberHelper.html)

```
number_with_precision(13.001, precision: 2, strip_insignificant_zeros: true)
# => 13
number_with_precision(13.005, precision: 2, strip_insignificant_zeros: true)
# => 13.01 
```

小心，因为在这种情况下，精度意味着小数点后的所有数字。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-10-02T14:15:11.967

我结束了

```
price = price.round(precision)
price = price % 1 == 0 ? price.to_i : price.to_f 
```

这样你甚至可以得到数字而不是字符串

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-08-23T13:43:25.080

我刚遇到这个，上面的修复没有用，但我想出了这个，它对我有用：

```
def format_data(data_element)
    # if the number is an in, dont show trailing zeros
    if data_element.to_i == data_element
         return "%i" % data_element
    else
    # otherwise show 2 decimals
        return "%.2f" % data_element
    end
end 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-05-30T17:15:54.567

这是另一种方式：

```
decimal_precision = 2
"%.#{x.truncate.to_s.size + decimal_precision}g" % x 
```

或者作为一个不错的单线：

```
"%.#{x.truncate.to_s.size + 2}g" % x 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-05-15T13:14:16.813

轻松使用 Rails：[http ://api.rubyonrails.org/classes/ActionView/Helpers/NumberHelper.html#method-i-number_with_precision](http://api.rubyonrails.org/classes/ActionView/Helpers/NumberHelper.html#method-i-number_with_precision)

```
number_with_precision(value, precision: 2, significant: false, strip_insignificant_zeros: true) 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2014-01-15T23:35:12.897

我正在寻找一个函数来截断（不是近似的）Ruby on Rails 中的浮点数或十进制数，我想出了以下解决方案来做到这一点：

你们可以在控制台中尝试，例如：

```
>> a=8.88
>> (Integer(a*10))*0.10
>> 8.8 
```

我希望它可以帮助某人。:-)

# django - 在 django 管理中如何避免写冲突？

> ID：838067
> 
> 赞同：2
> 
> 时间：2009-05-08T03:09:13.593
> 
> 标签：django, django-admin

假设有两个（或多个）django 管理员读取了一条数据库记录，然后更改并保存它。没有数据库问题，但是一些管理员会惊讶于他们写的记录被覆盖了。

这个问题有没有解决过？一种方法是有一个明确的“正在编辑”按钮，它在记录中设置一个标志。如果另一个管理员阅读了相同的记录，然后单击他的“正在编辑”，他将被警告说有一个先前的编辑正在进行中。或者可以在记录中添加一个字段，该字段在保存记录时递增。如果该字段与读取记录时不同，则会警告管理员该记录在读取后已被其他人更改。

是否有本地 django 方式来处理这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T14:25:14.287

Django 管理员没有实现任何开箱即用的写冲突保护。自己添加并不难。就个人而言，我会采用“版本号字段”的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T02:26:39.097

通常，这是您想要了解数据库的事务隔离功能的地方，因为这就是它拥有它们的原因。

如果您真的不想这样做，那么在应用程序层存在各种模式来执行此操作，但没有规范的方法来做到这一点——有些人设置了一种“最后访问”时间戳并拒绝允许在在此之后的某个时期，其他人设置版本号等。

# browser - 为什么 google.com 在黑莓和 phonegap 与黑莓和浏览器上看起来不同

> ID：838069
> 
> 赞同：3
> 
> 时间：2009-05-08T03:09:39.223
> 
> 标签：browser, blackberry, touchscreen, cordova, rim-4.7

我很想在黑莓风暴（9530模拟器）上启动并运行phonegap。我一直在使用 BB 的内置浏览器测试我的 webapp，它看起来还不错，但是一旦我尝试从 phonegap 中查看一些代码，它就完全有点问题了，即使我将 phonegap 指向相同的 url（我没有'还没有达到在设备上本地运行代码的地步）。

我在谷歌上尝试了一个测试用例并得到了类似的结果。见下文。我怀疑我在这里遗漏了一些基本的东西。我本来希望两个图像几乎相同。

浏览器 [http://www.eleganttechnologies.com/outside/ImgDeviceBB9530WebGoogle.jpg](http://www.eleganttechnologies.com/outside/ImgDeviceBB9530WebGoogle.jpg)

Phonegap [http://www.eleganttechnologies.com/outside/ImgDeviceBB9530PgGoogle.jpg](http://www.eleganttechnologies.com/outside/ImgDeviceBB9530PgGoogle.jpg)

[更新]为了了解正在发生的事情，我针对 W3 移动网络酸性测试运行了浏览器和嵌入式浏览器 (phonegap)：http: [//www.w3.org/2008/06/mobile-test/](http://www.w3.org/2008/06/mobile-test/) 我肯定会注意到两者之间的差异，但我还不知道“为什么”和“如何解决”。

Acid 通过内置浏览器 [（来源：][[eleganttechnologies.com](http://www.eleganttechnologies.com/outside/ImgDeviceBb9530WebAcid.jpg)][）] 顺便说一句 - 我今天早些时候运行了这个，比刚才多了几个绿色方块。[![](https://i.stack.imgur.com/NywUw.jpg)](https://i.stack.imgur.com/NywUw.jpg)

通过浏览器嵌入 phonegap 的酸 [http://www.eleganttechnologies.com/outside/ImgDeviceBb9530PgAcid.jpg](http://www.eleganttechnologies.com/outside/ImgDeviceBb9530PgAcid.jpg)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T14:11:01.043

免责声明：我对phonegap一无所知，但有一个很好的理论。默认情况下，BlackBerry 上的嵌入式浏览器控件使用比 BlackBerry 浏览器本身更旧版本的呈现引擎。

在去年的 BlackBerry 开发者大会上，对此进行了讨论，并且有一个未记录的选项可以使用更新的渲染引擎。\

选项 ID 为 17000（是的，一个幻数，可能会更改，使用风险自负等），应设置为 true。不确定如何通过 phonegap 传递此选项（我不熟悉该工具包），但使用 BlackBerry API 类似于：

```
BrowserContent content;
...
content.getRenderingOptions().setProperty(RenderingOptions.CORE_OPTIONS_GUID, 17000, true); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T03:30:53.090

我不知道您正在使用的浏览器的具体情况，但我知道大多数大型网站都会检测您的操作系统 + 浏览器组合来决定向您显示哪些 HTML。

如果 Google 看到不同的用户代理，您可能会获得 HTML 的通用移动版本，而不是您为内置浏览器获得的黑莓特定 HTML。

如果您可以访问 Web 服务器，请尝试使用两种浏览器设置来访问它，并查看日志文件中是否有任何差异。这可能会告诉你一些有趣的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T04:50:17.953

正如我们在您的酸测试中看到的那样......

一个浏览器（内置浏览器）正确报告为 BlackBerry9530，而另一个（phonegap）未显示用户代理 [“Testing with .”]。在这种情况下，Google 为您提供其主页的默认视图，而当您将自己报告为 BlackBerry 设备时，您将获得 BlackBerry 特定的呈现。

从事物的声音来看，使用 phonegap 正在删除默认的用户代理（很可能是因为它无法识别您的设备）。由于 phonegap 是开源的，最好的办法是进入那里，调试它并找出当 http 请求离开设备并从那里跟踪它时用户代理会发生什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T03:23:09.987

也许一种浏览器具有另一种浏览器没有的功能？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-27T12:47:08.707

嗯。通过查看屏幕截图，我会说第二页可能缺少一些资源。它可能缺少一些图像、脚本和 CSS 文件，这将解释不同的 l&f。知道黑莓浏览器字段 API 是如何工作的，我猜想使用 BrowserField 的实现没有正确完成。只是我的猜测。除此之外，当浏览器字段被初始化时，调用者需要通过启用适当的浏览器功能来正确配置它——脚本、样式等。同样，API 是以一种非常奇怪的方式完成的，我曾经让自己陷入这个陷阱. 设置选项时，您不能只创建一个掩码（如 CSS | WML | SCRIPT）并进行一次调用。选项是数字的，我相信是不重叠的——但您仍然需要调用 API 来独立设置每个选项。

此外，BrowserField 资源的异步加载方式也需要时间来理解。

只是我的 0.02 美元。

# php - 在 ZF 中渲染 Form 元素时如何删除 dd 和 dt html 元素？

> ID：838074
> 
> 赞同：12
> 
> 时间：2009-05-08T03:12:45.660
> 
> 标签：php, zend-framework, zend-form

我在我的视图中呈现 Zend_Form_Element_Select。

```
$t=new Zend_Form_Element_Select(....);
...
...
echo $t->render(); 
```

我得到了正确的下拉菜单和选项，但我也得到了选择元素

```
<dt> </dt>
<dd>[elm]</dd> 
```

如何删除该装饰器？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-08T09:04:51.490

你有更多的可能性：相关手册：

[http://framework.zend.com/manual/en/zend.form.elements.html#zend.form.elements.decorators](http://framework.zend.com/manual/en/zend.form.elements.html#zend.form.elements.decorators)

第二个是删除你不需要的装饰器

```
$t->removeDecorator('Errors');
$t->removeDecorator('HtmlTag');
$t->removeDecorator('Label'); 
```

第三个（可能是最适合你的）是只设置你需要的装饰器。下面的代码将只设置视图助手装饰器，所以不会有标签，没有错误信息，也没有 html 标签

```
$t->setDecorators(array(
    array('ViewHelper'),
)); 
```

关于装饰器的非常好的文章在这里：

[http://devzone.zend.com/article/3450](http://devzone.zend.com/article/3450)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-01T18:43:04.603

这为我做到了：

`$el->setDecorators(array( 'ViewHelper', 'Errors', 'Label'
));`

# sql-server - 获取值在列中的位置

> ID：838075
> 
> 赞同：0
> 
> 时间：2009-05-08T03:12:57.967
> 
> 标签：sql-server, sql-server-2005

如何获取给定值在表格列中的位置。我需要获取列号。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-02T08:42:13.590

一种选择是从 syscolumns 中为您的表 [ `select [name],[colid] from dbo.syscolumns where [id] = object_id('tablename')`] 查询 ColID 列。请注意，我不确定这是否保证是连续的，或者如果删除一列是否会出现间隙。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T03:47:27.277

在伪代码中：

*   对于结果集中的每个通过列的列集合。
*   找到值时，记下索引号

这仅假设一行。

您不能在 T-SQL 中执行此操作：只能使用 .net 或 Java 等客户端语言

# algorithm - 平面图中的小循环查找

> ID：838076
> 
> 赞同：9
> 
> 时间：2009-05-08T03:13:29.637
> 
> 标签：algorithm, language-agnostic, graph-theory, planar-graph

我有一个几何无向[平面图](http://en.wikipedia.org/wiki/Planar_graph)，即每个节点都有一个位置并且没有两条边交叉的图，我想找到所有没有边交叉的循环。

这个问题有什么好的解决方案吗？

* * *

我打算做的是一种`A*`类似的解决方案：

*   将最小堆中的每条边作为路径插入
*   使用每个选项扩展最短路径
*   剔除循环回到起点以外的路径（可能不需要）
*   剔除将是第三个使用给定边缘的路径

有没有人看到这个问题？它甚至会起作用吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-08T03:26:52.723

我的第一直觉是使用类似于[墙跟随](http://en.wikipedia.org/wiki/Maze_solving_algorithm)迷宫求解器的方法。本质上，遵循边，并始终从顶点中取出最右边的边。使用此方法遇到的任何循环都将成为面的边界。您必须跟踪您在哪个方向上遍历了哪些边。一旦您在两个方向上遍历了一条边，您就已经确定了它所分离的面。在两个方向上遍历所有边后，您将通过边界识别所有面。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T03:26:14.440

正如您所说的那样，“交叉边缘”通常被称为[和弦](http://mathworld.wolfram.com/CycleChord.html)。因此，您的问题是找到所有无弦循环。

[这篇论文](http://portal.acm.org/citation.cfm?id=1346685)看起来可能会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T03:45:46.407

一个简单的方法是简单地出去枚举每张脸。原理很简单：

*   我们为每个边维护“α-visited”和“β-visited”标志，并为每个这样的标志维护一对未访问边的双向链表。'α' 和​​ 'β' 划分应对应于与所讨论的边缘对应的线上的平面划分；哪边是α，哪边是β是任意的。
*   对于每个顶点 V：
    *   对于每对相邻的边 E = (V_1, V), E'=(V_2, V) （即按角度排序，取相邻对，以及first+last）：
    *   确定 V_2 位于 E（S=α 或 β）的哪一侧 S。
    *   走瓷砖，从 V 开始，使用 E 的 S 面，如下所述：

走瓷砖由以下方式执行：

*   让 V = V_init
*   环形：
    *   V_next = E 的不是 V 的顶点
    *   E' = 从 V_next 到 E 的相邻边，位于 E 的当前侧
    *   S' = E' 中包含 V 的一侧
    *   如果V_next = V，我们找到了一个循环；记录我们在途中经过的所有边，并将这些边对标记为已访问。
    *   如果 E' = E（只有一条边），那么我们已经走到了死胡同；中止这次步行
    *   否则，让 V = V_next，E = E'，S = S' 并继续。

我希望这是有道理的；它可能需要一些图表来解释......

# python - 在谷歌应用引擎中使用子域

> ID：838078
> 
> 赞同：19
> 
> 时间：2009-05-08T03:15:08.570
> 
> 标签：python, google-app-engine, subdomain

如何在谷歌应用引擎（python）中使用子域。

我想获得第一个域部分并采取一些行动（处理程序）。

**示例：**
     product.example.com -> 将其发送给产品处理程序
     user.example.com -> 将其发送给用户处理程序

实际上，使用虚拟路径我有这个代码：

```
 application = webapp.WSGIApplication(
    [('/', IndexHandler),
     ('/product/(.*)', ProductHandler),
     ('/user/(.*)', UserHandler)
  ] 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-08T08:05:53.117

WSGIApplication 不能基于域进行路由。相反，您需要为每个子域创建一个单独的应用程序，如下所示：

```
applications = {
  'product.example.com': webapp.WSGIApplication([
    ('/', IndexHandler),
    ('/(.*)', ProductHandler)]),
  'user.example.com': webapp.WSGIApplication([
    ('/', IndexHandler),
    ('/(.*)', UserHandler)]),
}

def main():
  run_wsgi_app(applications[os.environ['HTTP_HOST']])

if __name__ == '__main__':
  main() 
```

或者，您可以编写自己的 WSGIApplication 子类，它知道如何处理多个主机。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-30T17:28:58.663

我喜欢尼克的想法，但我有一个稍微不同的问题。我想匹配一个特定的子域来处理它有点不同，但所有其他子域应该处理相同。所以这是我的例子。

```
import os

def main():
   if (os.environ['HTTP_HOST'] == "sub.example.com"):
      application = webapp.WSGIApplication([('/(.*)', OtherMainHandler)], debug=True)
   else:
      application = webapp.WSGIApplication([('/', MainHandler),], debug=True)

   run_wsgi_app(application)

if __name__ == '__main__':
   main() 
```

# parameter-passing - 什么是“按名称传递”，它是如何工作的？

> ID：838079
> 
> 赞同：44
> 
> 时间：2009-05-08T03:16:06.040
> 
> 标签：parameter-passing, pass-by-name, language-history, algol

我已经检查了 Wikipedia 并在 Google 上搜索过，但我仍然无法理解名称传递在 ALGOL 60 中的工作原理。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-05-08T03:27:03.097

[我在Pass-By-Name Parameter Passing](http://www.cs.sfu.ca/~cameron/Teaching/383/PassByName.html)找到了一个很好的解释。本质上，在将实际参数文本替换到函数体中之后，函数体在调用时被解释。从这个意义上说，评估方法类似于 C 预处理器宏的评估方法。

通过将实际参数代入函数体，函数体既可以读取也可以写入给定的参数。从这个意义上说，评估方法类似于传递引用。不同之处在于，由于使用 pass-by-name 参数是在函数内部*计算*的，所以参数如`a[i]`取决于`i`函数内部的当前值，而不是引用`a[i]`函数调用之前的值。

我在上面链接的页面有更多示例说明传递名称既有用又危险的地方。通过名称传递实现的技术如今在很大程度上被其他更安全的技术所取代，例如传递引用和 lambda 函数。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-08T03:42:26.120

我假设您的意思是 ALGOL 60 中的按名称呼叫。

Call-by-name 与 call-by-reference 类似，您可以更改传入参数的值。它与按引用调用的不同之处在于，在调用过程之前*不对*参数进行评估，而是延迟评估。也就是说，仅在实际使用参数时才对其进行评估。

例如，假设我们有一个过程`f(x, y)`并且我们通过它并且`i`最初等于。如果设置为然后评估，它将看到该值（而通过引用调用或按值调用它仍然会看到）。这是因为表达式在被评估之前不会被评估。`i/2``i``10``f``x``42``y``21``5``i/2``y`

在许多方面，这似乎表现为参数的文字文本替换（通过重命名以避免名称冲突）。然而，在实践中，这是使用“thunk”（基本上是闭包）来实现传入表达式的。

[Jensen 设备](http://en.wikipedia.org/wiki/Jensen%27s_Device)上的 Wikipedia 文章展示了一些使用名称调用的有趣示例。这是其中之一：

> ```
> real procedure Sum(k, l, u, ak)
>      value l, u;
>      integer k, l, u;
>      real ak;
>      comment k and ak are passed by name;
>  begin
>      real s;
>      s := 0;
>      for k := l step 1 until u do
>          s := s + ak;
>      Sum := s
>  end; 
> ```
> 
> 在该过程中，索引变量`k`和求和项`ak`按名称传递。按名称调用使过程能够在执行 for 循环期间更改索引变量的值。按名称调用还会导致`ak`在循环的每次迭代期间重新评估参数。通常，`ak`将取决于变化（副作用） `k`。
> 
> 例如，计算实数数组前 100 项之和的代码`V[]`是：
> 
> ```
> Sum(i, 1, 100, V[i]). 
> ```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T03:40:31.567

对于未来的人：

John C. Mitchell 的《编程语言概念》也很有帮助。

> **按名称传递**. 回想起来，也许 Algol 60 最奇怪的功能是使用传递名称。在 pass-by-name 中，过程调用的结果与将形参替换到过程主体中的结果相同。通过复制过程并替换形式参数来定义过程调用结果的规则称为 Algol 60 复制规则。尽管复制规则适用于纯函数程序，如 lambda 演算中的 β 减少所示，但与形式参数的副作用的交互有点奇怪。下面是一个示例程序，展示了一种称为 Jensen 设备的技术：将表达式及其包含的变量传递给过程，以便过程可以使用一个参数来更改另一个参数引用的位置：
> 
> * * *
> 
> ```
>  begin integer i;
>         integer procedure sum(i, j);
>             integer i, j;
>                 comment parameters passed by name;
>             begin integer sm; sm := 0;
>                 for i := 1 step 1 until 100 do sm := sm + j;
>                 sum := sm
>             end;
>         print(sum(i, i*10 ))
>  end 
> ```

* * *

> 在这个程序中，过程 sum(i,j) 在 i 从 1 到 100 时将 j 的值相加。如果你看一下代码，你会意识到这个过程是没有意义的，除非改变 i 会导致j的值；否则，程序只计算 100*j。在此处显示的调用 sum(i, i*10) 中，当 i 从 1 变为 100 时，过程体 sum 中的 for 循环将 i*10 的值相加。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-01-01T17:59:35.547

其实，点名，不仅仅是一种历史奇闻。您可以在 Windows 批处理文件（以及无数其他脚本语言）中进行名称调用。了解它是如何工作的，以及如何在编程中有效地使用它可以为问题提供巧妙的解决方案。我知道它只是传递字符串以供以后扩展，但可以对其进行操作以产生与按名称调用类似的效果。

```
call :assign x 1
exit /b
:assign
setlocal enabledelayedexpansion
(endlocal
:: Argument 1 is the name of the variable
set %1=%2
)
exit /b 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-15T07:59:14.220

您可以以变量的符号形式传递“名称”，这样可以同时更新和访问它。例如，假设您想将类型为 int 的变量 x 增加三倍：

```
start double(x);
real x;
begin
x : = x * 3
end; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T03:40:45.110

[Flatlander 在这里](http://hestia.typepad.com/flatlander/2009/01/scala-for-c-programmers-part-3-pass-by-name.html)有一个关于它如何在 Scala 中工作的启发性示例。假设你想实现*while*：

> ```
> def mywhile(condition: => Boolean)(body: => Unit): Unit =
>   if (condition) {
>     body
>     mywhile(condition)(body)
>   } 
> ```
> 
> 我们可以这样称呼它：
> 
> ```
> var i = 0
> mywhile (i < 10) {
>   println(i)
>   i += 1
> } 
> ```

Scala 不是 Algol 60，但它也许能提供一些启示。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-09-11T23:07:27.837

ALGOL 专为数学算法而设计。我喜欢 summation 函数作为按名称调用的示例。

抱歉，我的 ALGOL 有点生疏，语法可能不正确。

```
.FUNCTION SUM(var,from,to,function)
.BEGIN
  .REAL sum =0;
  .FOR var = from .TO to .DO sum = sum + function;
  return sum;
.END 
```

你可以使用 sum 之类的

```
 Y = sum(x,1,4,sum(y,3,8,x+y)); 
```

在上面的内部 sum(y,3,8,x+y) 将生成一个未命名的函数以传递给外部 sum 调用。变量 x 和 y 不是按值传递，而是按名称传递。在变量的情况下，按名称调用相当于在 C 中按地址引用调用。涉及递归时会有点混乱。

借用了 ALGOL 机器。它们有 48 位字存储器和 3 个标志位。标志位通过 ALGOL 的名称实现了校准。它是一个堆栈机器，所以当函数被加​​载到堆栈上时，名称 fag 的调用会导致它被调用。当表达式用作参数时，编译器会生成未命名的函数。变量将是一个简单的间接引用。写入函数会发生错误。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-10-17T20:33:56.713

我知道我加入俱乐部很晚，这不一定是一个答案，但我确实想补充一件事，可以帮助澄清一点。我一直认为 Algol pass-by-name 与 C++ 预处理器指令（特别是宏）在编译期间用实际代码段替换某些函数/变量的名称时类似的过程。pass-by-name 实质上是将形参的名字替换为实参，然后执行。我从来没有用 Algol 写过，但我听说 pass-by-name 将与 C++ 的 pass-by-reference 具有相同的结果。

# regex - Apache mod 重写简单重定向

> ID：838080
> 
> 赞同：2
> 
> 时间：2009-05-08T03:16:31.063
> 
> 标签：regex, apache, mod-rewrite

我希望对我的网站的请求按如下方式工作：

[http://example.com/](http://example.com/)会在不显示 index.php 的情况下提取 index.php 文件（当前默认行为）

[http://example.com/foo.php](http://example.com/foo.php)会按预期拉出 foo.php

[http://example.com/blerg](http://example.com/blerg)将重定向到[http://example.com/bar.php?code=blerg](http://example.com/bar.php?code=blerg)

我现在有以下重写规则

```
 RewriteRule ^/(.*\.(php|html|htm|css|jpg))$ /$1 [NC,L]
    RewriteRule ^/(.*)$ /bar.php?code=$1 [NC,L] 
```

这几乎可以工作，除了[http://example.com/](http://example.com/)拉起 bar.php 而不是 index.php

理想情况下，我不必在第一条规则中包含所有可能的文件扩展名，我宁愿它只检测它是否是实际文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T03:35:03.203

不完全是你所要求的我意识到，但我经常在 .htaccess 中使用它：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php 
```

..将任何不是实际文件或目录的内容发送到 index.php，然后包含解释 URL 字符串中内容的逻辑。

例如

```
$url_array = split('/', $_SERVER['REQUEST_URI']);
array_shift($url_array); // remove first value as it's empty 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T14:34:01.893

找到了一个可行的解决方案

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^/([^.]+)$ /bar.php?code=$1 [QSA,L] 
```

```
http://example.com/ 正确指向 index.php（不显示 index.php）
http://example.com/abc 指向 bar.php?code=abc
http://example.com/foo.php 运行正常。

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T03:20:16.360

假设这是在 .htaccess 而不是 apache conf 文件中，则在重写规则的第一部分前面没有 /。所以如果你想映射：

[http://example.com/blah.jpg](http://example.com/blah.jpg)

你做：

```
RewriteRule ^blah\.jpg$ /some_other_file.jpg [L] 
```

注意缺少前导 / 和句点 (.) 的转义，否则它匹配任何字符（例如，没有它，规则将匹配 blahxjpg）。

此外，如果您要重定向其他目录的内容，您可能会发现客户端或服务器放置了一个尾部斜杠。为了处理它，我通常只是这样做::

```
RewriteRule ^directory/?$ /some_other_directory/index.php [L] 
```

或类似的。

最后一点涉及：

```
RewriteRule ^/(.*)$ /bar.php?code=$1 [NC,L] 
```

基本上改成：

```
RewriteRule ^/?(.*)$ /bar.php?code=$1 [NC,L] 
```

我想它会解决的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T03:21:33.813

在第二条规则前面使用 RewriteCond 指令，以便它只匹配您想要的 URL，例如：

```
RewriteCond %{REQUEST_URI} ^/blerg$
RewriteRule ... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T03:25:50.013

添加拦截[http://example.com/](http://example.com/)请求并阻止最后一条规则运行的规则：

```
RewriteRule ^/(.*\.(php|html|htm|css|jpg))$ /$1 [NC,L]
RewriteRule ^/$ /index.php [L]
RewriteRule ^/(.*)$ /bar.php?code=$1 [NC,L] 
```

我通常也会在我的规则中添加 QSA（“查询字符串附加”）：[QSA,L]。

此规则集强制对不存在文件的请求通过处理程序脚本：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+)$ /handler.php?request=$1 [QSA,L] 
```

# linux - 如何在没有浏览器的情况下运行 SWF（在 linux 服务器上）？

> ID：838085
> 
> 赞同：14
> 
> 时间：2009-05-08T03:19:33.520
> 
> 标签：linux, flash

我有一个连接到远程闪存服务器并接收一些数据的 swf 文件。出于安全原因，我不能让这个 swf 文件在网络上可访问，所以我不能使用浏览器来运行它。有没有办法从命令提示符（在 linux 下）在服务器端运行它？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-08T15:07:45.013

您可以使用`Xvfb`或`Xfake`运行不与真实硬件接口的 X 服务器。如果它们在您的发行版中不可用，您可以从 Xorg xserver 源构建它们。

（或使用 MarkR 的`Xvnc`建议。）

`flashplayer`Adobe 插件曾经附带一个名为or的独立可执行文件`gflashplayer`，可在浏览器之外使用。我认为它仍然存在，但在开发人员包中，或类似的东西。

如果您使用的是免费的 Flash 实现，Gnash 和 Swfdec 都分别带有独立`gnash`和`swfdec`可执行文件。

这从`Xvfb`显示 :20 开始（只需确保选择一个未使用的数字；正常显示从 开始`:0`，`ssh`X 转发通常分配`:10`和向上，我已经看到一些`Xvnc`设置从 开始`:90`），并在其中运行`gnash`：

```
startx /usr/bin/gnash http://url.to/flash.swf -- /usr/bin/Xvfb :20 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-30T12:48:54.257

如果您使用 ubuntu ，请键入`sudo apt-get install xvfb`，然后从 adobe 下载 flashplayer，然后像这样尝试，效果很好：

```
xvfb-run ./flashplayer test.swf 
```

或者如果你使用windows，你可以双击服务器上的swf，它现在正在运行，与其他服务器通信，只需将此swf作为服务器的一部分，计算值并返回，swf永远运行循环，因为它是一个服务器

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T03:22:53.047

您可以使 SWF Web 可访问并使用 .htaccess 文件保护目录。

有关详细信息，请参阅[Apache .htaccess 教程](http://httpd.apache.org/docs/1.3/howto/htaccess.html)。

您也可以尝试使用 ffplay (ffplay -fs somefile.swf) 来运行 swf。

已编辑：看起来 ffplay 使用 SDL，因此可能不需要 X。

但我认为这不会安装在您的服务器上。YMMV

更新：不要让无 GUI 阻止您做任何事情，如果您使用 SSH，请查看这篇文章如何将您的 X 显示器导出到本地工作站。[试图通过 SSH 建立隧道 X](http://www.linuxquestions.org/questions/linux-software-2/trying-to-tunnel-x-over-ssh-468135/?s=2e20e2a3b6981d2aabdd7a2c51b10ce4)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T03:35:34.373

土坯空气？

主要问题是命令提示符，而不是“网络可访问性”。如果您可以运行 FireFox，我相信您可以通过文件系统路径加载文件。如果可以在命令行上运行 SWF 内容，我会感到非常惊讶。我的意思是，原则上这不是不可能的，只是SWF的重点通常是显示一些闪烁和跳跃的垃圾，所以没有人费心编写命令行工具来运行它......

PS。我假设您知道您可以在 Linux 服务器上运行 FireFox，对吧？（整个 X Windows 的东西？）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T09:56:45.250

您可以轻松（ish）编写一个实现 netscape 插件接口以直接与 Flash 交互的 C 程序。那会奏效。

但是，它可能仍然需要 X 服务器来执行此操作 - 您可以使用 XVnc 或其他东西来无头运行。

不平凡，但会工作。

您的要求听起来有点奇怪——也许用其他语言重写 Flash 组件会是一种更易于维护的设计。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T10:02:36.983

Adobe 的 Ichabod 可能会解决您的问题，但我似乎无法找到任何信息，无论它是否可供公众使用，还是仅供搜索提供商使用。[只是像ReadWriteWeb](http://www.readwriteweb.com/archives/adobe_ichabod_flash_ajax.php)上的一篇文章的回声室。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-07-01T11:09:28.770

最好的方法是通过 Wine 安装“Macromedia Flash Player MX”。它将与“Macromedia Flash Player”一起安装 Macromedia MX。现在只需转到您的 swf 文件并将其默认应用程序更改为“Macromedia Flash Player”（不是 Macromedia MX )

# asp.net - Sharepoint 中的 Ajax 实现

> ID：838093
> 
> 赞同：1
> 
> 时间：2009-05-08T03:22:54.480
> 
> 标签：asp.net, ajax, sharepoint

我试图在我的共享点站点中实现 ajax。我正在关注这个博客..

[http://sharepoint.microsoft.com/blogs/mike/Lists/Posts/Post.aspx?ID=3](http://sharepoint.microsoft.com/blogs/mike/Lists/Posts/Post.aspx?ID=3)

我对默认的 webconfig 文件进行了更改。但是当我使用共享点设计器将脚本管理器保留在我的共享点母版页中时，它会显示错误，因为不允许使用脚本管理器。谁能帮我在sharepoint站点中实现ajax。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T03:31:29.703

我相信这适用于使用 Visual Studio 而不是 SharePoint Designer 开发的页面。

Microsoft AJAX 组件是围绕具有一些客户端功能的服务器端代码设计的——即您必须开发需要代码隐藏文件的服务器端代码。

虽然可以修改 web.config 并允许在设计师编辑的页面中使用脚本块，但我不推荐这样做。对于 Ajax 功能，当您只能更改客户端脚本时，最好使用 jQuery，它没有服务器端依赖项。

# java - 设置 JTable 列的原型值（用于自动宽度计算）

> ID：838095
> 
> 赞同：4
> 
> 时间：2009-05-08T03:23:22.967
> 
> 标签：java, swing, jtable, column-width

要么这不存在，要么我没有正确思考/搜索，因为它已经晚了......

我想根据我期望（或知道）存在于特定列中的最大字符串的原型值在 Swing 中设置 JTable 列宽。我不知道像素数，因为我在编译时不一定知道字体。

有没有办法为列宽设置原型值，就像行高一样？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-03-28T08:38:48.403

您可以尝试以下代码：

```
/**
 * Sets the preferred width of the columns of a table from prototypes
 * @param table the target table
 * @param prototypes an array of prototypes, {@code null} values will be ignored
 * @param setMaxWidth {@code true} if the maximum column width should also be set
 */
public static void setWidthFromPrototype(JTable table, Object[] prototypes, boolean setMaxWidth) {
if (prototypes.length != table.getColumnCount())
  throw new IllegalArgumentException("The prototypes array should contain exactly one element per table column");
for (int i = 0; i < prototypes.length; i++) {
    if (prototypes[i] != null) {
        Component proto = table.getCellRenderer(0,i)
                .getTableCellRendererComponent(table, prototypes[i], false, false, 0, i);
        int prefWidth = (int) proto.getPreferredSize().getWidth() + 1;
        table.getColumnModel().getColumn(i).setPreferredWidth(prefWidth);
        if (setMaxWidth)
            table.getColumnModel().getColumn(i).setMaxWidth(prefWidth);
    }
}
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-09T13:10:09.253

您是否尝试过在运行时创建 JLabel 并使用它的大小来调整表格的大小？

```
// create a label that will be using the run-time font
JLabel prototypeLabel = new JLabel("Not Applicable")

// get the labels preferred sizes
int preferredWidth = prototypeLabel.getPreferredSize().getWidth();
int preferredHeight = prototypeLabel.getPreferredSize().getHeight();

// set the sizes of the table's row and columns
myTable.setRowHeight(preferredHeight);

for(TableColumn column : myTable.getColumnModel.getColumns()){
   column.setPreferredWidth(preferredWidth);        
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-28T12:04:53.613

[SwingX](http://swingx.java.net)扩展的 JXTable/Column 支持为初始列宽大小设置原型，您可以在创建列之后执行此操作

```
for(int col = 0; ....) {
    table.getColumnExt(col).setPrototypeValue(myPrototype[col]
} 
```

或者通过实现一个自定义 ColumnFactory 来配置创建时的列

```
ColumnFactory factory = new ColumnFactory() {
    @Override
    protected void configureTableColumn(TableModel model, TableColumnExt columnExt) {
        super(...);
        columnExt.setPrototypeValue(myPrototype[columnExt.getModelIndex()];
    }
}
table.setColumnFactory(factory);
table.setModel(myModel); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-13T22:33:16.430

不要创建标签，而是从 TableCellRenderer 获取实际组件并测试其大小：

```
// create the component that will be used to render the cell
Comp prototype = table.getDefaultRenderer(model.getColumnClass(i)).getTableCellRendererComponent(table, "Not Applicable", false, false, 0, i);

// get the labels preferred sizes
int preferredWidth = comp.getPreferredSize().getWidth();
int preferredHeight = comp.getPreferredSize().getHeight(); 
```

这是一个单列示例，您需要重复此操作以获取每列的大小（并设置它）。有关此示例，请参见[http://www.exampledepot.com/egs/javax.swing.table/PackCol.html 。](http://www.exampledepot.com/egs/javax.swing.table/PackCol.html)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-08T04:29:47.410

如果您在编译时不知道字体，那么任何 JTable 列的宽度总是未知的。作为健全性检查，打开一个文本文档并使用不同的字体，同时保持点大小不变。所写内容的长度因字体而异，但高度不会。

JTable 行的高度应该能够针对任何字体大小（以磅为单位）确定，因为它是[定义的标准](http://en.wikipedia.org/wiki/Point_(typography))。不过，考虑到 JTable 可能会在单元格之间留出一点间距，这可能需要进行一些试验。

如果您在编译时不能保证字体大小和字体本身，那么我对其他人提出的答案很感兴趣:)

# c# - 通过打开的整数位进行枚举的最快方法

> ID：838097
> 
> 赞同：7
> 
> 时间：2009-05-08T03:23:50.627
> 
> 标签：c#, performance, optimization, bit-manipulation

枚举整数并返回打开的每个位的**指数的最快方法是什么？**看过一个使用 << 的例子和另一个使用 Math.Pow 的例子。想知道是否还有其他真正快速的东西。

谢谢。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-08T06:09:08.810

*最快*的方法？查找表几乎总是最快的方法。构建一个包含 40 亿个条目的 int[][] 数组，每个 int 一个，其中包含所需数字的数组。当然，初始化表需要一些时间，但查找速度会非常快。

我注意到你没有足够精确地说明“最快”的含义，让任何人都可以真正回答这个问题。这是否意味着包括启动时间在内的最快摊销时间，或假设启动成本可以忽略的边际查找时间？我的解决方案草图假设后者。

显然，具有 20 亿字节地址空间的 32 位机器将没有足够的地址空间来存储 300 亿字节的数组。给自己买一台 64 位机器。如果您希望它快速运行，您至少还需要安装那么多物理内存——否则分页会杀死您。

我当然希望您在每次查找时节省的几纳秒值得购买所有额外的硬件。或者，也许您*实际上并不*想要*最快*的方式？

:-)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-08T03:34:10.570

我想位移将是最快的。未经测试，但我认为以下应该很快（至少与 IEnumerables 一样快）。

```
IEnumerable<int> GetExponents(Int32 value)
{
    for(int i=0; i<32; i++)
    {
        if(value & 1)
            yield return i;
        value >>= 1;
    }
} 
```

如果您希望它更快，您可以考虑返回 a `List<int>`。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-09T07:52:56.530

`IEnumerable`不会执行。本主题部分示例的优化：

第一个（最快 - 10M 运行 2.35 秒，范围 1..10M）：

```
static uint[] MulDeBruijnBitPos = new uint[32] 
{
  0, 1, 28, 2, 29, 14, 24, 3, 30, 22, 20, 15, 25, 17, 4, 8, 
  31, 27, 13, 23, 21, 19, 16, 7, 26, 12, 18, 6, 11, 5, 10, 9
};

static uint[] GetExponents(uint value)
{
    uint[] data = new uint[32];
    int enabledBitCounter = 0;

    while (value != 0)
    {
        uint m = (value & (0 - value));
        value ^= m;
        data[enabledBitCounter++] = MulDeBruijnBitPos[(m * (uint)0x077CB531U) >> 27];
    }

    Array.Resize<uint>(ref data, enabledBitCounter);
    return data;
} 
```

另一个版本（第二快 - 10M 运行 3 秒，范围 1..10M）：

```
static uint[] GetExponents(uint value)
{
    uint[] data = new uint[32];
    int enabledBitCounter = 0;

    for (uint i = 0; value > 0; ++i)
    {
        if ((value & 1) == 1)
            data[enabledBitCounter++] = i;
        value >>= 1;
    }

    Array.Resize<uint>(ref data, enabledBitCounter);
    return data;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-08T03:48:31.923

一个字节的位值的查找数组应该接近您在安全 C# 代码中可以做到的最快速度。将 4 个字节中的每一个从整数中移出（必要时转换为 uint）并索引到数组中。

查找数组的元素可以是指数数组，或者，根据您对位所做的操作，可能是有效的委托。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-08T10:21:52.697

只是为了好玩，这里有一个使用 LINQ 的单行代码。

`yield`这当然不是最快的方法，尽管它与使用和迭代器块的其他答案相差不远。

```
int test = 42;

// returns 1, 3, 5
//   2^1 + 2^3 + 2^5
// =   2 +   8 +  32
// = 42
var exponents = Enumerable.Range(0, 32).Where(x => ((test >> x) & 1) == 1); 
```

对于更快的解决方案，我可能会返回一个普通的集合而不是使用迭代器块。像这样的东西：

```
int test = 2458217;

// returns 0, 3, 5, 6, 9, 15, 16, 18, 21
//   2^0 + 2^3 + 2^5 + 2^6 + 2^9 +  2^15 +  2^16 +   2^18 +    2^21
// =   1 +   8 +  32 +  64 + 512 + 32768 + 65536 + 262144 + 2097152
// = 2458217
var exponents = GetExponents(test);

// ...

public static List<int> GetExponents(int source)
{
    List<int> result = new List<int>(32);

    for (int i = 0; i < 32; i++)
    {
        if (((source >> i) & 1) == 1)
        {
            result.Add(i);
        }
    }

    return result;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-08T04:14:51.720

给定输入的什么分布最快？如果通常只设置一个位，那么这可能比循环查找设置位更快。

从接受的寻找[最低有效位位置的](https://stackoverflow.com/questions/757059/position-of-least-significant-bit-that-is-set/757266#757266)答案（取自[Bit Twiddling Hacks](http://graphics.stanford.edu/~seander/bithacks.html)）中，该解决方案循环，查找、清除并返回每个连续最低有效位的位置。

```
 static int[] MulDeBruijnBitPos = new int[32] 
    {
      0, 1, 28, 2, 29, 14, 24, 3, 30, 22, 20, 15, 25, 17, 4, 8, 
      31, 27, 13, 23, 21, 19, 16, 7, 26, 12, 18, 6, 11, 5, 10, 9
    };

    static IEnumerable<int> GetExponents(UInt32 v)
    {
        UInt32 m;

        while( v != 0 ) {
          m = (v & (UInt32) (-v));
          yield return MulDeBruijnBitPos[((UInt32) (m * 0x077CB531U)) >> 27];
          v ^= m;
        }
    } 
```

它仅循环与设置的位相同的次数。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-08T03:29:58.520

我猜位移 (<<) 是最快的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-10T21:48:27.030

如果你不会被一点 C++ 呛到：

```
 void func(int i, int& n, int a[]){
  n = 0;
  if (i < 0) a[n++] = 31;
  i <<= 1;
  if (i < 0) a[n++] = 30;
  i <<= 1;
  if (i < 0) a[n++] = 29;
  i <<= 1;

  ...

  if (i < 0) a[n++] = 0;
} 
```

# c++ - CListControl 选择 (MFC)

> ID：838098
> 
> 赞同：0
> 
> 时间：2009-05-08T03:23:59.627
> 
> 标签：c++, visual-studio, mfc, clistctrl

在 MFC 的 CListCtrl 的报表视图中，如何检测当前是否没有突出显示的选择？

使用 GetFirstSelectedItemPosition 不起作用，因为如果之前选择了一个项目，然后单击列表控件上的其他位置，GetFirstSelectedItemPosition 仍然报告最后选择的位置而不是 NULL，但是，所述位置不再突出显示。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T03:34:50.410

你试过了`CListCtrl::GetSelectedCount`吗？

# ruby-on-rails - 何时在 Rails 视图中使用 @ 以及何时使用符号？

> ID：838109
> 
> 赞同：5
> 
> 时间：2009-05-08T03:28:13.627
> 
> 标签：ruby-on-rails, instance-variables, symbols, presentation-layer

```
 <% form_tag(:action=>'update', :id=>@album.id) do %>

  Title: <%= text_field(:album, :title)  %><br>
  Artist: <%= text_field(:album, :artist)  %><br>
  Genre: <%= text_field(:album, :genre)  %><br>
  Release Date: <%= datetime_select(:album, :release_date, :start_year=>1960) %><br>

  <%= submit_tag("Update") %>

  <% end %> 
```

在上面的例子中，我不得不在 form_tag 中说@album.id，但在 text_field 中我不得不说：album。我一直在我的观点中混淆这些，并且从来不知道是使用@符号还是符号。是否有一个简单的规则可以明确何时使用什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-08T04:38:33.223

我要在这里切线一会儿，但请耐心等待。

首先，我建议您使用[RESTful 路由](http://guides.rubyonrails.org/routing.html)，因为这可以让您访问 Rails 的一些更好的方法和操作，例如：

```
form_for(@album) do |f| 
```

`#new_record?`并让它根据该对象的状态确定您想去的地方。

其次，随着新`form_for`的到位，您将能够通过执行以下操作来干燥您的观点：

```
<%= f.text_field :title %> 
```

代替：

```
<%= text_field :album, :title %> 
```

最后解释一下为什么在 Rails 中变量之前定义有 @ 符号，也称为“实例变量”：

当您在 Rails 中定义一个实例变量时，它在该实例中可用于整个请求，其中“实例”是被调用以执行所有渲染`ActionController`等`ActionView`的方法链。将其定义为实例变量将使其在您的控制器、您在控制器中定义它后调用的任何方法、您的助手、您的视图以及从您的控制器、助手或视图呈现的部分中可用。

基本上，它适用于整个请求，但在您的模型中无法访问。

其他变量规范是类变量 ( `@@some_useful_thing = 1`) 和全局变量 ( `$some_other_useful_thing = 1`) 和常量 ( `ALL_IN_UP_CASE = 1`)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T03:32:33.273

变量名前的@符号指的是当前类中的一个实例变量。:（冒号）前缀创建一个符号。在您的示例中，将实例变量`@album.id`的 id 发送到，允许从数据库中读取该对象并使用来自该对象的适当数据填充表单字段。您在方法中传递的符号用于访问它从数据库创建的对象的特定属性。然后它将这些属性的值放入它生成的文本字段中。`@album``form_tag``form_tag``text_field``form_tag`

# c# - 倾斜传感器可与 Google 地球配合使用

> ID：838112
> 
> 赞同：1
> 
> 时间：2009-05-08T03:30:29.330
> 
> 标签：c#, microcontroller, google-earth

我正在使用微控制器并尝试使用倾斜传感器来控制谷歌地球图像的平移和旋转。我已经将倾斜传感器连接到 C# 代码，并且可以从中获取数据。我将使用 C# 导航谷歌地球的相关功能是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-23T02:13:40.460

您可以查看我整理的这个开源控制库，它将 Google 地球插件集成到托管代码中。

[http://code.google.com/p/winforms-geplugin-control-library/](http://code.google.com/p/winforms-geplugin-control-library/)

用于导航的标准 Api 对象是 KmlLookAt 和 KmlCamera： [http://code.google.com/apis/earth/documentation/reference/interface_kml_look_at.html](http://code.google.com/apis/earth/documentation/reference/interface_kml_look_at.html) [http://code.google.com/apis/earth/documentation/reference /interface_kml_camera.html](http://code.google.com/apis/earth/documentation/reference/interface_kml_camera.html)

（仅供参考，我一直在使用 Wiring IO 板做类似的事情！）

# c# - 'ref' 关键字和 AppDomains

> ID：838117
> 
> 赞同：7
> 
> 时间：2009-05-08T03:31:28.627
> 
> 标签：c#, remoting

当我开始使用 C# 时，我不确定如何准确地处理引用（它们是否按值传递等）。我错误地认为在传递将由被调用方法修改的对象时需要'ref'关键字。

然后在阅读了这样的线程之后[，](https://stackoverflow.com/questions/186891/why-use-ref-keyword-when-passing-an-object)我意识到只有当你需要更改实际的引用/指针本身时才需要'ref'。

但是今天我在通过远程调用传递参数时遇到了一个问题，实际上需要 ref 来修改对象的内容。当没有 ref 传递时，对象原样返回。有人告诉我添加 ref 关键字，但我争论了一段时间，只有当您更改指针本身时才需要，而不是指向的内容。

我在网上搜索过，只能找到一个简要讨论它的[页面](http://www.ondotnet.com/pub/a/dotnet/2002/11/25/copying.html?page=3)。这是一个已知问题吗？有人能指出一些关于它的文档吗？在我看来，我现在必须对任何通过远程调用修改的参数使用 ref。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T03:44:50.107

添加“ref”可能有帮助，也可能没有帮助。这完全取决于特定编组器实现的智能性。例如，如果您调用一个 Web 服务，那么再多的“引用”也无济于事——函数的参数根本不会通过网络传回。唯一从服务返回的是函数的返回值。在处理远程处理时，您必须了解（至少在某种程度上）事情的实际工作方式——参数需要序列化并通过某种“线路”发送到被调用方，在另一端反序列化，工作由服务器执行，并将结果序列化并发回给您。这些结果是否包括对您首先传递的参数的更改更多地取决于具体的远程实现，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T03:43:59.407

我想知道你为什么说“参考/指针”？这些术语之间有很大的不同。看，指针只是一个地址，比如说一个 int。

另一方面，引用只不过是某物的别名。在 C++ 方面：

```
int x;
int& y = x; 
```

从这里开始，无论 x 发生什么，y 发生什么，反之亦然，它们都被“永远”绑定。

同样，在 C++ 中，传递引用：

```
void foo(int& y);
int main(){
    int x = 0;
    foo(x);
} 
```

这意味着 y 只是 foo 范围内 x 的另一个名称（别名）。这就是 ref 在 C# 中的含义。

# sharepoint - SharePoint 上的开发与 Lotus Connections 上的开发

> ID：838119
> 
> 赞同：1
> 
> 时间：2009-05-08T03:31:31.107
> 
> 标签：sharepoint, lotus, ibm-connections

我在 SharePoint 和 Lotus Connections 之间进行选择，我希望大师给我一些建议。我想要的功能是，门户/内容管理/工作流程/各种沟通方式（IM/音频/视频/多方会议），最好有个人博客或团队博客。

我要考虑的另一个关键问题是扩展平台（SharePoint 或 Connections）以实现/自定义我上面提到的功能的灵活性/易用性。

欢迎任何建议或参考文件。

EDIT1：有没有人有任何好的出版文件可以参考？

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-10T02:37:32.320

根据您的功能列表，您想要的 Lotus 产品不是 Connections，而是 Quickr。我也有偏见，并且对 Sharepoint 或 Connections 没有直接经验，但您应该查看： http: [//migratenotes.wordpress.com/](http://migratenotes.wordpress.com/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-19T03:43:15.257

此处是另一位 SharePoint 管理员（意味着没有使用 Lotus 产品的经验），但作为 SharePoint 之前另一个平台的管理员，我可以就我们切换的原因以及我们所看到的 SP 平台的一些优势提供一些想法。可能适用于您的情况，也可能不适用于您的情况。

1.  与其他 MS 产品集成。我在以 MS 为中心的环境中工作，我们刚刚升级到 Exchange 2007 和 Office 2007。这 3 个平台之间的集成程度对推动用户采用非常有帮助。特别是从 Word 创建和签入文档的能力 - 直接到 SP 文档库等。如果您使用的是旧版本的 Office，集成仍然存在，但它不是很干净。MS 在其网站上有一篇论文，其中概述了与 SP 2007 和不同版本的 Office 的功能差异。

2.  在您的帖子中，您提到了 IM / 视频等 - 只是为了澄清 - SharePoint 不提供此功能 - 但它确实与提供的 MS 产品 - Office Communication Server 很好地集成在一起。这是一个非常强大的工具，它提供聊天、共享桌面、基于 IP 的视频和音频会议 - 并且对于 SP - 存在感知。这意味着，如果您深入到文档库 - 并看到我写的或刚刚更新的白皮书 - 我的名字将是一个小点，它将显示绿色（可用）黄色（空闲）红色（忙碌）以及给你发电子邮件、发短信、设置应用程序等选项。这促进了合作的数量，确实帮助了我们的团队。我对您的白皮书、提案等有疑问，我看到您在线，我可以立即联系您。很酷。

3.  与其他平台的连接。我们以前的文档管理系统非常小众 - 将多功能打印机/扫描仪连接到 is 并将文档直接扫描到系统中的想法是不存在的。但是，使用 SP，它是一个标准，您几乎可以连接到那里的任何系统。

4.  可扩展性。在我们的旧平台上，我们必须专门针对该系统培训开发人员。在大多数情况下，我们最终聘请了外部顾问来开发和维护这个不便宜的平台。使用 SP，我们想做的 85% 都是开箱即用的，或者没有可用的编码。对于请求的真正定制的一小部分，我们的 .Net 开发人员可以处理它（因为代码库是相同的）这意味着我们可以更有效地管理资源并在内部进行全部开发。

这些是我想到的一些事情。就您要求的文档而言 - MS 在他们的网站上确实有一些非常好的白皮书，其中记录了公司从其他系统迁移、节省成本等方面的经验。那里有一些宣传 - 但也有一些很好的信息。我的理解是，SharePoint 是 MS 增长最快的应用程序——他们投入了大量资金来使其成为一个强大的平台。它现在是第 3 版 - 4 版将在年底前发布 - 所以它也正在变成一个非常成熟的平台。

这至少给了你硬币的一面。希望您能对 Lotus 有所了解。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-20T04:21:51.627

我还没有编制一份文件清单来支持我的回复——只是与您有关的是我从利基产品转向另一个主流产品的经历。所以我的回应是更多的个人意见和经验——而不是事实或有记录的研究。希望我提出了一些你以前没有考虑过的问题。

在处理单词问题时。可以创建使用 Word 文档模板作为新文档基础的文档库。

所以 - 假设我的公司在 Word 中定义了一个提案模板。此模板对要使用的字体有预设定义，首页有我的公司标志，有标准的法律免责声明页面，说明提案仅在收到后 48 小时内有效，标准表格或网格，其中产品编号、描述，数量和价格等。

现在，我的公司要求所有提案都基于此模板。并且所有提案都存储在 SharePoint 上的 Pursuits 库中。

所以我可以做两件事之一。我可以将此模板分发给所有销售人员及其助理。让他们将其安装在本地计算机上，当他们需要编写提案时，根据该提案在 Word 中创建一个新文档，并相信他们会将其上传到 Pursuits 库。当我对模板进行更改时，我会制作它们，并且必须向使用它的每个人发送一个新的、更新的模板，希望他们能够正确安装它等等。

或者...

我可以创建 Pursuits 库 - 并将提案模板上传到该库，因为模板是新文档的基础。这样做，当需要编写新提案时，您将导航到库，单击库工具栏中的 [新建]，然后将基于该模板创建一个新文档。提案完成，作为保存过程的一部分，提案会自动上传到 Pursuits 库中。

如果我对模板进行了更改或更新，我会制作它，然后将新的 teamplate 版本上传到 SharePoint - 确保在该库中创建新提案的每个人都将使用新模板。

同样的场景也适用于其他办公产品的标准模板。事实上，我们有一个标准的 Powerpoint 模板，带有版权、标准字体、公司品牌和预定义的颜色 - 使用相同的场景。如果有人想要制作一个新的 powerpoint 演示文稿 - 从文档库中加载的模板开始，确保他们保持我们的品牌要求。

另一个集成 SP 的示例带有 Office 应用程序 - 当您创建电子邮件，然后将文档附加到其中时 - Outlook 将为您提供发送附件的选项，或者只是将文件链接放置在电子邮件 - 因此收件人可以直接访问文件所在的 SharePoint 上的相应站点。

我们的电子邮件负载已显着下降，并且 - 由于链接的工作方式 - 当您单击它时，您始终可以确保获得最新版本的文档。不再对您的电子邮件进行分类 - 试图通过电子邮件的发送日期强加版本控制。

现在，这仅适用于所有收件人都是内部员工的情况。如果您正在向客户发送电子邮件，他们可能无权通过包含的链接访问您的 Intranet。

希望有帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T03:53:15.313

作为一名 SharePoint 顾问，我可能有点偏颇，但我会选择 SharePoint——它有很多开箱即用的功能，而且开发实践也变得相当成熟。

我还要指出，我已经看到很多组织从 Notes 迁移到 SharePoint - 它在技术方面无关紧要，但在未来可能很重要。

最终，平台的选择并不像你用它做什么那么重要，特别是在基础设施和开发实践方面。我见过一些组织得很糟糕的 SharePoint 系统，但如果一开始就考虑周全，这些问题总是可以避免的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-02-07T05:12:20.037

这完全取决于您的要求。如果您的要求更多的是社交协作而不是文档管理和工作流程（开发也是），那么您应该使用连接。我是一名共享点架构师，但我看到了我的 IBM 顾问提供的连接演示。它更像是一个完全为您的组织定制的“facebook”。社交协作功能更多的是相互联系，但文档管理、工作流等其他功能是 SharwPOint 的更好工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-11T23:49:34.153

哦，来吧！问题太简单了。当然是 SharePoint！你有一个完整的 C# 服务器代码来支持你和 HTML5 或 Silverlight 一些高级客户端的东西。除此之外，还有一个完整的框架。业界接受。C# 甚至是多平台的。但是 Lotus Connections 呢？一些小型的专有解决方案可能在几年后甚至可能没人能记住。

# c# - 更新 Lucene 索引时出现异常

> ID：838123
> 
> 赞同：4
> 
> 时间：2009-05-08T03:33:53.567
> 
> 标签：c#, lucene, lucene.net

我是 Lucene 搜索 API 的新手。更新 Lucene 索引时，我不断收到以下异常...为什么会出现此错误以及如何避免它？

```
System.IO.IOException: Lock obtain timed out: SimpleFSLock@C:\Indexes\write.lock
   at Lucene.Net.Store.Lock.Obtain(Int64 lockWaitTimeout)
   at Lucene.Net.Index.IndexWriter.Init(Directory d, Analyzer a, Boolean create, Boolean closeDir)
   at Lucene.Net.Index.IndexWriter.Init(String path, Analyzer a, Boolean create)
   at Lucene.Net.Index.IndexWriter..ctor(String path, Analyzer a, Boolean create) 
```

谢谢阅读。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-08T06:51:00.020

Lucene 在以写模式打开索引时创建锁定文件。当您完全关闭索引时，此锁定文件将被删除。在写入索引时，如果程序在没有关闭 lucene IndexWriter 的情况下退出，下次尝试写入时会出现此异常。如果您从索引目录中删除锁定文件，您将不会看到此异常。

您可以选择使用[FSDirectory.setDisableLocks(false)](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/store/FSDirectory.html#setDisableLocks(boolean))禁用锁定，但这是不可取的，因为错误会被静默忽略。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T14:38:32.680

我认为，如果索引写入花费的时间超过超时值，并且在锁定到期后和索引写入完成之前出现另一个索引写入，您也可能会收到此错误 - 至少看起来这是正在发生的事情。

当我开始接近单个 Windows 目录中最大文件数的 50% 左右时，我开始遇到同样的问题。这减慢了写入速度，足以导致问题。(Win2k3)

我相信你可以重新编译Lucene来改变超时值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-24T06:00:43.727

尝试以下操作：

```
try
{
    writer = new IndexWriter(directory, new StandardAnalyzer(), IndexWriter.MaxFieldLength.UNLIMITED);
}
catch (LockObtainFailedException ex)
{
    DirectoryInfo indexDirInfo = new DirectoryInfo(directory);
    FSDirectory indexFSDir = FSDirectory.Open(indexDirInfo, new Lucene.Net.Store.SimpleFSLockFactory(indexDirInfo));
    IndexWriter.Unlock(indexFSDir);
    writer = new IndexWriter(directory, new StandardAnalyzer(), IndexWriter.MaxFieldLength.UNLIMITED);
} 
```

# nhibernate - 如何使用 NHibernate 将类保存到单个列

> ID：838132
> 
> 赞同：2
> 
> 时间：2009-05-08T03:37:08.830
> 
> 标签：nhibernate, serialization

我希望使用 NHibernate 将对象持久化到单个列。我想将传入的数据序列化为一列，然后在传出时对其进行反序列化。这可以是二进制或 xml。我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T08:12:29.963

如果类未映射，则序列化是默认设置。您可以（应该）明确表示：

```
<property name="MyProperty" type="Serializeable" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T03:48:57.007

创建一个将实现序列化/反序列化的属性，将该属性映射到 HBM 中所需的列。看起来很简单......诀窍在哪里？:)

# javascript - Jquery根据浏览器大小/调整大小更改高度

> ID：838137
> 
> 赞同：43
> 
> 时间：2009-05-08T03:40:09.353
> 
> 标签：javascript, jquery, browser, screen

我想知道是否有办法确定浏览器的高度/宽度。我想要做的是在浏览器大小为 1024x768 时将 div 的高度设置为 500px，而对于任何更低的值，我想将其设置为 400px。

提前致谢

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-05-08T03:47:32.860

如果您使用的是 jQuery 1.2 或更新版本，您可以简单地使用这些：

```
$(window).width();
$(document).width();
$(window).height();
$(document).height(); 
```

从那里决定元素的高度是一件简单的事情。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-05-08T04:00:39.587

```
$(function(){
    $(window).resize(function(){
        var h = $(window).height();
        var w = $(window).width();
        $("#elementToResize").css('height',(h < 768 || w < 1024) ? 500 : 400);
    });
}); 
```

滚动条等会影响窗口大小，因此您可能需要调整到所需的大小。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-07-27T08:09:02.367

基于 Chad 的回答，您还希望将该函数添加到 onload 事件中，以确保在页面加载时也调整它的大小。

```
jQuery.event.add(window, "load", resizeFrame);
jQuery.event.add(window, "resize", resizeFrame);

function resizeFrame() 
{
    var h = $(window).height();
    var w = $(window).width();
    $("#elementToResize").css('height',(h < 768 || w < 1024) ? 500 : 400);
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-09-03T12:53:43.787

请注意，Jquery 1.8.0 有一个错误，$(window).height() 返回所有文档高度！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-06T15:15:27.623

感觉支票应该不一样

新：h < 768 || w < 1024

# java - 从servlet打印，为什么这不起作用

> ID：838140
> 
> 赞同：0
> 
> 时间：2009-05-08T03:40:39.400
> 
> 标签：java, html, servlets, printing

我想从 servlet 打印。我相信我有正确的语法。但我在 Eclipse 中收到“删除这些令牌”的消息。

```
 PrintWriter out = response.getWriter(); 
    out.println("<html><head><title>Woohoo</title></head><body>\n" + 

            "<form id="report_form" name="report_form" method="post" action="AgReportServlet">\n"+
            "<table border="0" cellspacing="0" cellpadding="8">\n"+
                "<tr>\n"+
                "   <td><label>Start Date<br />\n"+
                "   <select name="start_date" id="start_date">\n"+
                "       <option value="2000">2000</option>\n" +
                "       <option value="2001">2001</option>\n" +
                "       <option value="2002">2002</option>\n" +
                "       <option value="2003">2003</option>\n" +
                "       <option value="2004">2004</option>\n" +
                "   </select> </label></td>\n"+
                "   <td>End Date<br />\n"+
                "   <select name="end_date" id="end_date">\n"+
                "       <option value="2000">2000</option>\n"+
                "       <option value="2001">2001</option>\n"+
                "       <option value="2002">2002</option>\n"+
                "       <option value="2003">2003</option>\n"+
                "       <option value="2004">2004</option>\n"+
                "   </select></td>\n"+
                "   <td><label>Agricultural Zone<br />\n"+
                "   <select name="ag_zone" id="ag_zone">\n"+
                "       <option value="1">Zone 1</option>\n"+
                "       <option value="2">Zone 2</option>\n"+
                "       <option value="3">Zone 3</option>\n"+
                "       <option value="4">Zone 4</option>\n"+
                "       <option value="5">Zone 5</option>\n"+
                "   </select> </label></td>\n"+
                "   <td><label>Locality<br />\n"+
                "   <select name="locality" id="locality">\n"+
                "       <option value="here">There</option>\n"+
                "       <option value="there">There</option>\n"+
                "   </select> </label></td>\n"+
                "   <td><label><br />\n"+
                "   <input type="submit" name="submit" id="submit" value="Submit" /> </label></td>\n"+
                "</tr>\n"+
        "   </table>\n"+
        "   </form>\n"+
        "</body>\n"+
        "</html>"
            );
    out.flush();
    out.close(); 
```

堆栈跟踪如下： java.lang.Error: 未解决的编译问题：
标记上的语法错误，删除这些标记 标记
上的语法错误，删除这些标记 标记
上的语法错误，删除这些标记 表达式的类型必须是数组类型，但它解析为
令牌“2000”上的字符串语法错误，[预期
表达式的类型必须是数组类型，但它解析为
令牌“2001”上的字符串语法错误，[预期
表达式的类型必须是一个数组类型，但它解析为
令牌“2002”上的字符串语法错误，[预期
表达式的类型必须是数组类型，但它解析为字符串
标记 "2003" 上的语法错误，[ 预期
表达式的类型必须是数组类型，但它解析为字符串
标记 "2004" 上的语法错误，[ 预期
标记上的语法错误，删除这些标记
表达式的类型必须是一个数组类型，但它解析为
令牌“2000”上的字符串语法错误，[预期
表达式的类型必须是数组类型，但它解析为
令牌“2001”上的字符串语法错误，[预期
表达式的类型必须是数组类型，但解析为字符串
标记“2002”上的语法错误，[ 预期
表达式的类型必须是数组类型，但解析为字符串
标记“2003”的语法错误，[ 预期
表达式的类型必须是数组类型，但它解析为字符串

等等等等

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T03:42:54.323

您在字符串中添加双引号，例如：

```
"<form id="report_form"... 
```

你需要逃避它们：

```
"<form id=\"report_form\"... 
```

或在 HTML 中使用单引号：

```
"<form id='report_form'... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T13:30:15.510

是的，这不是你想做的。改用[Freemarker](http://freemarker.org/)。

# php - 如何在我的网站上使用谷歌地图？

> ID：838142
> 
> 赞同：1
> 
> 时间：2009-05-08T03:41:40.677
> 
> 标签：php, google-maps

我试图找到链接或文档以了解如何在我的网站上使用谷歌地图。我正在使用 php。我需要这个代码。尽管我尝试了很多寻找，但可能是我尝试的方式不正确。任何人都可以建议我可以找到谷歌地图使用代码的链接。

提前致谢.........

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T03:48:47.477

Google 地图的 Hello world（来自 API 参考）：

```
<!DOCTYPE html "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Maps JavaScript API Example</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=abcdefg&sensor=true_or_false"
            type="text/javascript"></script>
    <script type="text/javascript">

    function initialize() {
      if (GBrowserIsCompatible()) {
        var map = new GMap2(document.getElementById("map_canvas"));
        map.setCenter(new GLatLng(37.4419, -122.1419), 13);
        map.setUIToDefault();
      }
    }

    </script>
  </head>
  <body onload="initialize()" onunload="GUnload()">
    <div id="map_canvas" style="width: 500px; height: 300px"></div>
  </body>
</html> 
```

因此，您可以将其直接粘贴到 PHP 文件中以开始使用。一旦你有了这个工作，你就可以开始将你的服务器端内容添加到生成的文件中，或者可能从一个单独的 PHP 文件中获取一些 XML 来填充地图。

这里有很多很好的例子：

[http://code.google.com/apis/maps/documentation/examples/index.html](http://code.google.com/apis/maps/documentation/examples/index.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T03:43:50.640

我将从这里开始：[Google Maps API](http://code.google.com/apis/maps/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-08T19:10:18.693

如果您使用的是 PHP，那么您肯定可以从使用新的[PHPGoogleMapAPI](http://code.google.com/p/php-google-map-api)类之类的类中受益——它也刚刚更新为使用 Google Maps JS API 的 V3。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T08:29:30.517

大多数 google api（以及大多数其他 web-api）都可以通过 javascript 或 flex 而不是 php 更好地处理

我建议你然后专注于js :)

# iphone-sdk-3.0 - iPhone 3.0 SDK，如何在 2.2.1 设备上测试？

> ID：838154
> 
> 赞同：1
> 
> 时间：2009-05-08T03:45:41.820
> 
> 标签：iphone-sdk-3.0

我刚刚安装了最新的 iPhone SDK 3.0。在下拉概览中将活动 SDK 选择为 Simulator 3.0 后，“目标”字段不再显示 2.2.1 SDK，默认为 3.0，导致我无法在 2.2.1 设备上进行测试。

我应该采取什么措施来解决这个问题？即使在目标属性中，我的基础 SDK 仍然显示为设备 2.2.1。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T03:50:47.033

您不能在运行 3.0 以外的任何设备的设备上运行为 3.0 编译的 iPhone 应用程序，因为它与 2.2.1 不向后兼容。您需要升级您的设备才能在其上运行 3.0 应用程序。

更具体到 SDK 的最新版本，发行说明中有一个条目说明此版本不允许您针对除 3.0 SDK 之外的任何 SDK 进行编译。我相信允许您这样做的最后一个版本是 3.0b2。如果要使用 2.2.1 SDK 进行编译，则需要回滚到该版本或更早版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-23T06:53:56.807

您可能需要的设置是项目信息窗口部署部分底部的“iPhone OS 部署目标”。

您可以将“Base SDK”设置保留为 3.0，并将“部署目标”设置为早期版本，如 2.2.1。

在中搜索“定位较早的 iPhone OS 版本”

[https://web.archive.org/web/20100901153956/https://developer.apple.com/iphone/library/documentation/Xcode/Conceptual/iphone_development/120-Running_Applications/running_applications.html](https://web.archive.org/web/20100901153956/https://developer.apple.com/iphone/library/documentation/Xcode/Conceptual/iphone_development/120-Running_Applications/running_applications.html)

然后由您来确保您的应用程序不会尝试在 OS 2.2 设备上使用 OS 3.0 功能。（使用对任何仅适用于 OS 3.0 的框架的弱引用，在执行仅适用于某些版本的操作之前检查操作系统版本等）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-08T09:11:07.530

右键单击您的项目并选择“获取信息”。然后从“Base SDK for All Configuration”中选择“iPhone Device 2.2.1”，选项将再次可用。

*   捷兹达克斯

* * *

# php - 如何在 Kohana 中将 tld.com/bures/oceanfront 转换为 tld.com/articles/view/bures/oceanfront？

> ID：838161
> 
> 赞同：0
> 
> 时间：2009-05-08T03:47:35.980
> 
> 标签：php, kohana

我正在使用 Kohana 2.3.2

我网站上的大多数（如果不是全部）链接都是指向文章的。

我的控制器名为 Articles，我有一个名为 View 的方法。我不想在所有链接前加上 /articles/view/，所以我想设置一个默认控制器来处理所有文件。

我已经研究过使用默认路由器，这使得 tld.com 使用 Articles 控制器。但是，当我尝试访问 /bure/oceanfront/ 之类的内容时，我得到了 Kohana 的 404 错误。

我看过[这篇文章](http://learn.kohanaphp.com/2008/08/22/serving-static-pages/)，但我认为它已经过时了，因为给出的例子总是错误的（另请参阅指出这一点的评论）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T04:07:26.120

这正在工作：

```
Event::add('system.post_routing' ,'call_fallback_page');

function call_fallback_page() {
        Router::$controller = 'Articles';
        Router::$method = 'index';
        Router::$controller_path = APPPATH.'controllers/articles.php';
} 
```

源自问题中的教程。

# asp.net-mvc - 让共享主机上的 mvc 工作

> ID：838166
> 
> 赞同：1
> 
> 时间：2009-05-08T03:48:53.590
> 
> 标签：asp.net-mvc, hosting

关于如何让我的 asp.net mvc 网站在运行 asp.net 3.5 但可能不是 IIS 7 的网络主机上工作的任何想法？（我认为他们可能在 IIS 6 上）

我在 Crystal Tech 上，我的主页显示得很好，但所有其他请求都给我一个 404 page not found 错误。

注意：我已经按照这些说明进行操作，但仍然无法正常工作

[http://haacked.com/archive/2008/11/03/bin-deploy-aspnetmvc.aspx](http://haacked.com/archive/2008/11/03/bin-deploy-aspnetmvc.aspx)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T03:56:40.297

你试过这个吗？

[http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx](http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx)

我遇到了同样的问题——我试图修复它，但认为花时间在后台服务器上运行是不值得的。最后，我更容易迁移到运行 Windows Server 2008 和 IIS7 的主机。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T03:58:00.963

如果您确实有 IIS7，那么您可以选择在集成模式和管道模式之间切换 IIS7。尝试在控制面板中切换到其他模式。这对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T06:28:27.797

我通过在路由表中所有路由的末尾添加一个 .aspx 来修复它（“/{Controller}/{Action}/{id}.aspx”）。您可以添加 asp.net 处理的任何扩展名（如 .mspx、.ashx、...） 修复它而不添加任何扩展名的唯一方法是要求您的主机这样做，或者使用 IIS7 将您的主机更改为另一个

# sql - 在星型模式表设计中包含关系有什么好处？

> ID：838169
> 
> 赞同：2
> 
> 时间：2009-05-08T03:51:12.713
> 
> 标签：sql, ssis, business-intelligence, star-schema

我正在为当前使用 SQL Server、SSIS 和 SSAS 的数据仓库设计 Fact 和 Dimension 表。将维度和事实表之间的关系编程到 SQL 中是否会真正受益？还是在创建多维数据集时手动定义关系更好？

如果我对将数据插入表中没有任何限制并因此省略了关系，那么加载和转换数据似乎更容易。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T04:20:45.340

我将“编程关系”解释为将外键约束放在表上。

不，在数据仓库中，您不应该对事实表施加主键或外键约束。

您提到了一些问题，另一个问题是这些约束在插入行时会产生性能开销，这将使 ETL 过程更加昂贵。

对于只有事务数据库设计经验的人来说，这可能与他们所学和经历的一切背道而驰。外键约束对于您有多个进程同时修改数据的数据库至关重要。尽管开发人员尽了最大的努力，但两个进程以某种方式搞砸数据的风险是肯定的。约束是一个至关重要的安全网。

在维度模型中，数据库仅由一个 ETL 过程填充，并且以高度受控的方式填充。这显着降低了数据损坏的风险，以至于限制的额外成本不值得。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-06T13:26:46.767

我认为我们需要有 FK 约束，因为 DW 的更新“大部分”是受控制的，但并非总是如此。例如，在出现任何数据问题等情况下会发生手动数据修复。[理想情况下，这一定不会发生，但是.... :)]

为确保密钥不会影响性能，我们可以在加载之前禁用它们并再次启用它们。这可以让我们确信数据是正确的，并消除加载期间的任何性能问题。要记住的另一件事是，处理时间并不是大多数数据仓库的主要限制因素。

如果您考虑修复潜在数据完整性问题所需的时间，那么 FK 是非常值得的。

# nhibernate - 使用 NHibernate 查询

> ID：838172
> 
> 赞同：7
> 
> 时间：2009-05-08T03:54:42.830
> 
> 标签：nhibernate, hql, nhibernate-criteria

我是 NHibernate 的新手，我正在尝试学习如何查询我的数据。

下面是配置xml。仅显示配方。

我希望能够从输入的关键字和成分名称的成分中按配方标题查询食谱。

例如，您可以输入“pasta wine”。

这是我尝试过的，但给了我一个错误。

```
 hql = "from Recipe r " +
    "left join r.Images " +
    "inner join r.User " +
    "inner join r.Ingredients i " +
    "where i.IngredientName Like '%pasta%' OR i.IngredientName Like '%wine%' OR r.RecipeTitle Like '%pasta' OR r.RecipeTitle Like '%wine%'"; 
```

我也想急切地加载收藏。

我要查询对吗？我需要能够根据我的搜索条件构建查询字符串。这在 SQL 中对我来说很容易。

马尔科姆

```
 <class name="Recipe" table="Recipes" xmlns="urn:nhibernate-mapping-2.2">
    <id name="RecipeID" type="Int32" column="RecipeID">
      <generator class="identity" />
    </id>
    <property name="RecipeTitle" type="String">
      <column name="RecipeTitle" />
    </property>
    <property name="Completed" type="Boolean">
      <column name="Completed" />
    </property>
    <property name="ModifiedOn" type="DateTime">
      <column name="ModifiedOn" />
    </property>
    <property name="Rating" type="Double">
      <column name="Rating" />
    </property>
    <property name="PrepTime" type="Int32">
      <column name="PrepTime" />
    </property>
    <property name="CookTime" type="Int32">
      <column name="CookTime" />
    </property>
    <property name="Method" type="String">
      <column name="Method" />
    </property>
    <bag name="Images" inverse="true" cascade="all">
      <key column="RecipeID" />
      <one-to-many class="OurRecipes.Domain.RecipeImage, OurRecipes.Domain, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
    </bag>
    <many-to-one name="Category" column="CategoryID" />
    <bag name="Comments" inverse="true" cascade="all">
      <key column="RecipeID" />
      <one-to-many class="OurRecipes.Domain.Comment, OurRecipes.Domain, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
    </bag>
    <many-to-one name="User" column="EnteredByID" />
    <bag name="Ingredients" inverse="true" cascade="all">
      <key column="RecipeID" />
      <one-to-many class="OurRecipes.Domain.Ingredient, OurRecipes.Domain, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
    </bag>
  </class> 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-08T08:31:28.327

要构建动态查询，我会使用条件 API。这使得动态查询更加稳定，因为您不需要字符串操作来构建它。

```
ICriteria query = Session.CreateCriteria(typeof(Recipe), "r")
  .CreateCriteria("Ingredients", "i", JoinType.InnerJoin)
  .Add(
    Expression.Disjunction() // OR
      .Add(Expression.Like("i.IngredientName", "%pasta%"))
      .Add(Expression.Like("i.IngredientName", "%wine%"))
      .Add(Expression.Like("r.RecipeTitle", "%pasta%"))
      .Add(Expression.Like("r.RecipeTitle", "%wine%")));

List<Recipe> result = query.List<Recipe>(); 
```

**编辑：**

对于急切加载，您可以设置获取模式：

```
ICriteria query = Session.CreateCriteria(typeof(Recipe), "r")
  .SetFetchMode("Images", FetchMode.Join)
  .SetFetchMode("Comments", FetchMode.Join)
  .SetFetchMode("Ingredients", FetchMode.Join) 
```

**但我不会这样做，**因为你得到的结果乘以图像、评论和成分的数量。因此，如果您有 4 张图片、2 条评论和 12 种成分，您将获得 96 次您的食谱。您没有认识到这一点，因为 NHibernate 将这些东西重新组合在一起，但它会在应用程序和数据库之间产生流量。所以最好让 NHibernate 用单独的查询来加载它。

* * *

**再进行一次编辑**以显示动态查询组合。

```
// filter arguments, all are optional and should be omitted if null
List<string> keywords;
TimeSpan? minCookingTime;
TimeSpan? maxCookingTime;
int? minRating;
int? maxRating;

ICriteria query = Session.CreateCriteria(typeof(Recipe), "r");

if (keyword != null)
{
  // optional join
  query.CreateCriteria("Ingredients", "i", JoinType.InnerJoin);

  // add keyword search on ingredientName and RecipeTitle
  var disjunction = Expression.Disjunction();
  foreach (string keyword in keywords)
  {
    string pattern = String.Format("%{0}%", keyword);
    disjunction
      .Add(Expression.Like("i.IngredientName", pattern))
      .Add(Expression.Like("r.RecipeTitle", pattern)); 
  }
  query.Add(disjunction)
}

if (minCookingTime != null)
{
  query.Add(Expression.Ge(r.CookingTime, minCookingTime.Value));
}
if (maxCookingTime != null)
{
  query.Add(Expression.Le(r.CookingTime, maxCookingTime.Value));
}

if (minRating != null)
{
  query.Add(Expression.Ge(r.Rating, minRating.Value));
}
if (maxRating != null)
{
  query.Add(Expression.Le(r.Rating, maxRating.Value));
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T11:43:54.867

Stefan 和 Sathish 的示例都将 % 运算符连接到 SQL 中。这是不必要的，因为 Restrictions.Like（nhib 2.0+）和 Expression.Like（v2.0 之前）有 3 个带有 MatchMode 的参数版本。

```
Disjunction keywordsCriteria = Restrictions.Disjunction();
foreach (var keyword in keywords)
{
    keywordsCriteria.Add(Restrictions.Like("i.IngredientName", keyword, MatchMode.Anywhere));
    keywordsCriteria.Add(Restrictions.Like("r.RecipeTitle", keyword, MatchMode.Anywhere));
} 
```

NHibernate Search 也提供全文查询。有关详细信息，请参阅[Ayende 的示例。](http://ayende.com/Blog/archive/2009/05/03/nhibernate-search-again.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T18:46:10.213

这是带有动态关键字的上述条件

```
string searchQuery = "wine pasta";

ICriteria query = Session.CreateCriteria(typeof(Recipe), "r")
                    .CreateCriteria("Ingredients", "i", JoinType.InnerJoin)
                    .SetFetchMode("Images", FetchMode.Join)
                    .SetFetchMode("Comments", FetchMode.Join)
                    .SetFetchMode("Ingredients", FetchMode.Join)
                    .SetResultTransformer(new DistinctRootEntityResultTransformer());

var keywords = searchQuery.Split(' ');

Disjunction keywordsCriteria = Restrictions.Disjunction();
foreach (var keyword in keywords)
{
    keywordsCriteria.Add(Restrictions.Like("i.IngredientName", string.Format("%{0}%", keyword)));
    keywordsCriteria.Add(Restrictions.Like("r.RecipeTitle", string.Format("%{0}%", keyword)));
}

query.Add(keywordsCriteria);

List<Recipe> result = query.List<Recipe>(); 
```

# view - CouchDB 视图：created_at 大于传递的值

> ID：838175
> 
> 赞同：3
> 
> 时间：2009-05-08T03:55:53.403
> 
> 标签：view, couchdb, mapreduce

我正在尝试编写一个 couchdb 视图，该视图采用可排序格式的 created_at 时间戳（2009/05/07 21:40:17 +0000）并返回所有具有更大 created_at 值的文档。

我专门使用 couch_foo 但如果我能弄清楚如何编写视图，我可以在蒲团或 couch_foo 模型中创建它，而不是让 couch_foo 为我做。

如果可能的话，我已经四处搜索，无法弄清楚地图/减少来做到这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-07-01T13:44:52.460

在我完全理解视图的工作原理之前，我最初遇到了这种问题。

理解的关键是视图仅针对文档的每个（修订）运行一次。换句话说，当您查询视图时，您不会运行该函数，您只需查找该函数运行时的结果。因此，无法将任何用户提交的参数传递到视图中。

那么如何将视图中的值与用户提交的值进行比较呢？秘诀是将该字段作为 map 函数中的键发出，并依靠让 couchdb 按键排序。

您的地图功能将类似于

```
"map" : "function(doc) { emit(doc.created_at, doc); }" 
```

你会像这样查询它：

```
http://localhost:5984/db/_design/ddoc/_view/view?startkey=%222009/05/07%2021:40:17 +0000%22 
```

我冒昧地对 url 中的引号和空格进行了 uriEncoding，以便它可以按原样使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T05:08:49.640

您想编写一个视图，以该格式创建时间戳字段的键，然后使用`startkey`参数对其进行查询。

所以视图看起来像：

```
"map" : "function(doc) { emit(doc.timestamp_field, doc) }" 
```

您的网址将类似于：

```
http://mysever/database/_design/mydoc/_view/myview?startkey="2009/05/07 21:40:17 +0000" 
```

[Wiki](http://wiki.apache.org/couchdb/)上的[HTTP 视图 API](http://wiki.apache.org/couchdb/HTTP_view_API)页面有更多信息。您也可以考虑[用户邮件列表](http://couchdb.apache.org/community/lists.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-31T22:45:04.963

请注意，couchdb 仅适用于 json 值。如果存储在 couchdb 中的文档的时区与您的 startkey 的时区不同，则查询可能会失败。

# java - 学习试接

> ID：838177
> 
> 赞同：3
> 
> 时间：2009-05-08T03:56:46.053
> 
> 标签：java, exception-handling, try-catch

我是Java初学者，请多多包涵

```
static int load = 100;
static int greet;

public void loadDeduct(int cLoad, int c){
    int balance;
    balance = cLoad - 7;
    System.out.println("Your balance: " + balance);
}

public void loadDeduct(int tLoad){
    int balance;
    balance = tLoad - 1;
    System.out.println("Your balance is: " + balance);
}

public static void main (String [] args){
    int choice;
    Scanner scan = new Scanner(System.in);

    System.out.println("I'm a cellphone, what do you want to do?");
    System.out.println("Press 1 to send SMS / Press 2 to Call");

    choice = scan.nextInt();

    CellphoneLoad N95 = new CellphoneLoad();

    if (choice == 1){
        N95.loadDeduct(load);
    }else if (choice == 2){
        N95.loadDeduct(load, greet);
    }else{
        System.out.println("Invalid Option!!!");
    } 
```

如何用这个程序实现异常处理？我不太确定如何使用 catch 块，因为我们还没有被告知整个异常的事情。这只是我们被要求做的一个练习。我想用 try-catch 块替换 if else 语句......这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T04:17:37.127

Java 中要考虑的一个重要原则是异常有两种类型： 1\. 运行时 2\. 类型化/显式（因为没有更好的词）

当出现编程错误时应该抛出运行时异常，并且通常不应捕获它们，除非您在顶层捕获以报告错误。

类型化/显式异常在方法调用上被修饰并且应该存在以便调用者可以对它们采取一些行动。

在上面的代码的情况下，没有一个地方感觉应该使用异常处理。

正如帕特里克指出的那样，您通常不希望使用异常来进行流控制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T04:16:58.703

该[`Scanner.nextInt()`](http://java.sun.com/javase/6/docs/api/java/util/Scanner.html#nextInt())方法可以抛出一些异常。API Specifications 的链接页面列出了可以抛出的三个异常。

例如，如果输入了一个非整数值，例如`"one"`代替`1`，`InputMismatchException`则可以抛出 an。

通常，a`try-catch`用于捕获异常，如下面的代码所示：

```
try
{
    Integer.parseInt("one");      // Statement that can cause an exception.
}
catch (NumberFormatException e)   // Specify which exception to catch.
{
    // Code to handle the NumberFormatException.
} 
```

有关异常的更多信息，请参见[课程：](http://java.sun.com/docs/books/tutorial/essential/exceptions/)[Java 教程的](http://java.sun.com/docs/books/tutorial/index.html)异常。特别是，[捕获和处理异常](http://java.sun.com/docs/books/tutorial/essential/exceptions/handling.html)部分可能很有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T04:18:14.677

在这段代码中添加异常不会增加太多价值。我能想到的是这样的：

```
public static void main (String [] args){

.....

try{
 handleUserChoice(choice);//new method
}
catch(InvalidChoiceException e){
 System.out.println("Invalid Option!!!");
}
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T04:02:56.490

使用异常进行流控制并不理想。从您的代码中不清楚可能会引发哪些异常。也许你可以详细说明一下。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T04:04:48.670

您的代码中唯一可能引发异常的部分是调用：

```
scan.nextInt(); 
```

根据 JavaDocs，这可能会引发以下可能的异常：

*   InputMismatchException（如果下一个标记与 Integer 正则表达式不匹配，或者超出范围）
*   NoSuchElementException（如果输入已用尽）
*   IllegalStateException（如果此扫描仪已关闭）

所以如果你想让你的代码考虑到这些异常被抛出的可能性，你应该像这样重写它：

```
try {
    choice = scan.nextInt();
} 
catch (InputMismatchException e) {
  System.out.println(e.getMessage());
}
catch (NoSuchElementException e) {
  System.out.println(e.getMessage());
}
catch (IllegalStateException e) {
  System.out.println(e.getMessage());
} 
```

通常，您希望您的“捕获”块从特定的或很可能发生在性质上不太可能/更一般的开始。

您还可以“抛出”异常，以便发生异常的任何方法都不会处理它 - 调用该异常导致方法的方法必须处理它（或再次抛出它等，直到它到达Java 运行时）。

如果您要替换的是“if”语句，我建议使用“switch”语句：

```
switch (choice) {
    case 1:  N95.loadDeduct(load);
             break;
    case 2:  N95.loadDeduct(load, greet);
             break;
    default: System.out.println("Invalid Option!!!");
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T04:08:40.767

我看不出有任何理由使用异常而不是 if-else 块。您可以尝试使用 switch 语句，它看起来会更好。

您应该使用异常来处理方法 loadDeduct 中可能发生的错误。然后你会用 try-catch 块包围调用 N95.loadDeduct 的行，以写出如果 loadDeduct 出错会发生什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T04:02:20.783

这真的很简单。首先确定您想要异常的位置。库代码可能会抛出异常，也可以抛出自己的异常。然后使用 try .. catch 来处理它。这是一个简单的“你好，世界”的例子：

```
public class TryTry {

    public void doIt() throws Exception {
       System.err.println("In the doIt method.");
       throw new Exception("Hello there!");
    }

    public static void main(String[] argv){
       TryTry t = new TryTry();
       // here we'll catch it.
       try {
           System.err.println("About to call doIt().");
          t.doIt();
       } catch (Exception e) {  // e now has your exception object
          System.err.println("In the exception handler.");
          System.err.println("Exception says: "+ e);
       }
    }
} 
```

throw 的作用是构造该异常对象并将其向上发送到堆栈，直到它被捕获。为了捕捉它，你用 包围可能抛出它的代码`tr { ... }`，并用 处理异常`catch`。

结果如下：

```
javac TryTry.java && java TryTry
即将调用 doIt()。
在 doIt 方法中。
在异常处理程序中。
异常说：java.lang.Exception：你好！

```

# sharepoint - 在 MOSS 2007 中找不到 ajax 扩展

> ID：838178
> 
> 赞同：1
> 
> 时间：2009-05-08T03:57:25.723
> 
> 标签：sharepoint

我在这里有两个问题：

1）我正在尝试在sharepoint中实现AJAX。我已经修改了 web.config，如下所示：

[http://sharepoint.microsoft.com/blogs/mike/Lists/Posts/Post.aspx?ID=3](http://sharepoint.microsoft.com/blogs/mike/Lists/Posts/Post.aspx?ID=3)

但我仍然收到以下错误：

未知的服务器标记“asp:ScriptManager”。在 System.Web.UI.TagPrefixTagNameToTypeMapper.System.Web.UI.ITagNameToTypeMapper.GetControlType(String tagName, IDictionary attribs) 在 System.Web.UI.MainTagNameToTypeMapper.GetControlType2(String tagName, IDictionary attribs, Boolean fAllowHtmlTags) 在 System.Web。 UI.MainTagNameToTypeMapper.GetControlType(String tagName, IDictionary attribs, Boolean fAllowHtmlTags)

2）其次，我正在尝试在sharepoint中实现adrotator。我已经尝试安装 SPAdrotator，但是当我在“查询”部分中将图像库名称作为源时，我无法显示图像。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T04:13:24.390

对于第 1 点：

您是否已将此程序集添加到 GAC？：System.Web.Extensions，Version=1.0.61025.0，Culture=neutral，PublicKeyToken=31bf3856ad364e35

问题是它找不到 scriptmanager 类，它告诉我程序集没有正确安装。如果它位于 SharePoint 网站的 bin 目录中，则需要从 WSS_Minimal 默认值更改信任级别（不推荐）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T04:15:26.257

您使用的是 .NET 2.0 还是 3.5？为 2.0 下载的扩展与 3.5 中包含的扩展非常相似，但 web.config 中的引用会有所不同。

获得正确细节的最简单方法是在 Visual Studio 中创建一个新的 ajax 项目，并从为您创建的 web.config 中复制位。

2 可能应该作为一个单独的问题发布，但它可能与内部名称和显示名称有关。

# c# - 使用 C#.net 的语音记录 (winmm.dll)

> ID：838190
> 
> 赞同：5
> 
> 时间：2009-05-08T04:05:35.283
> 
> 标签：c#, activex

我的要求是构建一个实用程序，可以录制语音（通过麦克风）并将 .wav 文件作为桌面和 Web 应用程序保存在磁盘上。对于特定用户，所以我选择了 activeX 技术，因为我没有找到任何其他更好的方法（也许你知道并可以指导我......非常受欢迎）

我使用了winmm.dll（又名媒体控制接口（MCI）），它工作得很好，但在特定的计算机上，比如当我在vista上运行它时，它工作正常，在win server 2008上，但在windows 2003和xp上它不工作。 . 只是工作是否有任何先决条件.. 需要在那里或我应该做些什么才能使其在其他风格的 Windows 上工作。

如果 some1 建议使用一些示例代码来记录/保存/播放示例，我不介意使用 DirectSound :)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T04:45:18.060

实际上没有错误，没有例外，甚至没有输出我正在创建的 wav 文件，而它在 vista 和 2k8 上运行良好，但在以前的版本上运行良好。

m 使用默认声卡没有明确设置

使用以下代码

```
[DllImport("winmm.dll", EntryPoint = "mciSendStringA", CharSet = CharSet.Ansi, SetLastError = true, ExactSpelling = true)]
private static extern int mciSendString(string lpstrCommand, string lpstrReturnString, int uReturnLength, int hwndCallback); 
```

记录

```
mciSendString("open new Type waveaudio Alias recsound", "", 0, 0);
mciSendString("record recsound", "", 0, 0); 
```

停止并保存

```
mciSendString(@"save recsound " + OuputFolderName + FileName + ".wav", "", 0, 0);
mciSendString("close recsound ", "", 0, 0); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T04:24:03.383

我会使用 DirectShow 来捕获音频。由于您在问题中添加了 C# 标记，因此我建议使用[DirectShow.NET library](http://directshownet.sourceforge.net/)。确保您还下载了[示例](http://sourceforge.net/project/showfiles.php?group%5Fid=136334&package%5Fid=188409&release%5Fid=529095)并查看 Capture 文件夹中的 PlayCap 和 CapWMV 示例。您可能还想查看 CodeProject 上的[音频捕获文章](http://www.codeproject.com/KB/audio-video/cac.aspx)。

至于为什么某些操作系统版本可以工作，您是否在这些系统上确认音频输入可以与其他程序一起工作？您是允许用户选择音频设备还是仅使用默认音频设备？您收到错误消息还是没有音频？根据这个[论坛](http://www.directorforum.de/showthread.php?t=44632)，请确保将文件名用双引号括起来。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-10T23:54:16.957

如果您仍在寻找 .net 库，请看这里：

[http://windowsmedianet.sourceforge.net/index.html](http://windowsmedianet.sourceforge.net/index.html)

和这里

[http://www.tapiex.com/ToneDecoder.Net.htm](http://www.tapiex.com/ToneDecoder.Net.htm)

第一个是在 LGPL 许可下，第二个是商业组件套件。

# iphone - 视频 API iphone

> ID：838196
> 
> 赞同：1
> 
> 时间：2009-05-08T04:10:03.480
> 
> 标签：iphone, video

我想播放从网络流式传输的 H.264 视频。播放视频 iphone 提供了媒体播放器 API。有谁知道用于解码和播放单个视频帧的任何记录或未记录的 API？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T13:38:50.887

是实时视频还是点播？

如果现场直播，唯一的方法是使用带有 MediaPlayer 的 iPhone OS 3。看看苹果的讨论组有一些有趣的线程。

# php - PHP Jabber 集成

> ID：838203
> 
> 赞同：4
> 
> 时间：2009-05-08T04:14:13.657
> 
> 标签：php, xmpp

我想知道如何集成 jabber 而不是使用我的 AJAX 轮询脚本。我偶然发现了以下内容：[http ://code.google.com/p/xmpphp/](http://code.google.com/p/xmpphp/)

它让我可以访问一个 jabber 服务器，但没有告诉我如何去做。我的意思是例如

$payloads = $conn->processUntil(array('message', 'presence', 'end_stream', 'session_start'));

我可以使用一组固定的命令吗？是否有一些网站用非常简单的术语解释了 jabber 工作流程？

非常感谢您的宝贵时间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T17:03:03.533

我一直想知道与 XMPP 一起玩的技术，一直在看：

*   [Strophe](http://code.stanziq.com/strophe/)
*   [波什](http://xmpp.org/tech/bosh.shtml)

可以在以下位置看到该技术的示例：

*   [下载.io](http://drop.io)
*   [国际象棋](http://www.chesspark.com)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T16:53:16.210

这两个文档页面似乎相当易读：

1.  [核](http://xmpp.org/rfcs/rfc3920.html)
2.  [即时消息和状态](http://xmpp.org/rfcs/rfc3921.html)

* * *

此外，您可能已经对 xmpphp 投入了大量资金，但如果没有，您可能想看看[**Phurple**](http://sourceforge.net/projects/phurple)。它使您可以从 PHP访问[libpurple](http://developer.pidgin.im/wiki/WhatIsLibpurple)库（[Pidgin的代码库）。](http://pidgin.im/)

从项目页面：

> 这个 libpurple PHP 绑定，它定义了一组内部类，提供了直接从 PHP 使用 aol 和 icq (oscar)、yahoo、msn、jabber、irc 和更多协议的可能性。用 PHP 编写您自己的 IM 聊天客户端，就像 PHP 启用它一样简单。

# controls - 重写标准控件，如编辑、组合等？

> ID：838204
> 
> 赞同：1
> 
> 时间：2009-05-08T04:14:41.940
> 
> 标签：controls, combobox, edit

我有一个自定义控件：它是托管代码，它是 System.Windows.Forms.Control 的子类。

我想将编辑框、选择列表、组合框、单选按钮等添加到此控件上的位置。一个简单的方法是简单地将这些类的实例添加到 Controls 集合中，以便它们成为子控件。

将它们添加为子控件可能会产生一些微妙的问题，例如：

*   [IE 6 在菜单上选择控件（组合框）](https://stackoverflow.com/questions/552326/ie-6-select-controlscombo-box-over-menu)

*   我的控件上有滚动条，它似乎可以滚动控件的内容（内容大于控件本身）；当子控件靠近屏幕边缘时，我想半显示（即剪辑）该子控件（即使其一半位于物理屏幕边缘之外），但真正的子控件不能位于其父级边界之外。

*   *还有其他潜在问题吗？*

当我使用 IE7 显示包含组合框等的[http://www.tizag.com/htmlT/htmlselect.php](http://www.tizag.com/htmlT/htmlselect.php)（例如），然后当我使用 Spy++ 监视 IE7 时，我只看到一个没有子级的窗口/控件实例（其类名为“Internet Explorer_Server”）。

我猜这意味着在 IE7 中，呈现组合框的功能内置于 IE7 控件本身，并且 IE7 不使用标准控件作为子控件。

问题：

*   将标准控件作为自定义控件的子控件重用，还是在自定义控件本身内重新实现标准控件的功能更好？
*   您是否有任何与这两种情况相关的警告（警告）要分享？
*   如果我想在自定义控件中重新实现标准控件的功能，您是否知道我可以重用的任何现有代码（实现此功能）？

如果这样的代码已经存在，我不知道如何搜索它（我的搜索发现，例如，所有者绘制的组合框和标准组合框的扩展）：也许很少有人从头开始重新实现标准控件？

* * *

**编辑**

我发现了一个半相关的问题：[How to render a control to look like ComboBox with Visual Styles enabled？](https://stackoverflow.com/questions/2874/how-to-render-a-control-to-look-like-combobox-with-visual-styles-enabled)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T04:21:32.670

是的，Internet Explorer 使用 Windows 主题 API 绘制控件。您也可以使用 System.Windows.Forms.VisualStyles 命名空间中定义的类型来执行此操作。

IE 团队这样做是为了避免在屏幕上有这么多控件，每个都接收窗口消息，同时在屏幕上出现性能问题。例如，查看这个 StackOverflow.com 页面，我看到 30-40 个链接标签控件、10 个左右的按钮、20+ 个标签等。

需要注意的是，Zune 软件是 .NET 托管代码，也使用自定义控件；如果您尝试在任何控件上使用 Spy++，您会发现它们不是真正的 Win32 控件。您可以使用 Zune 软件上的 Reflector 来查看他们在做什么。如果我没记错的话，他们正在使用 Zune 软件中包含的自定义托管 UI 框架。

至于从头开始重写这些控件，我认为还有很多工作要做。这听起来比实际上要容易。

# java - how to check if a char is passed as an int

> ID：838211
> 
> 赞同：1
> 
> 时间：2009-05-08T04:16:25.490
> 
> 标签：java

Is it possible to check if a char has been passed into a method that requires an int? For example, if you have some function foo(int bar) and someone uses that function like foo('t'), are you able to find out that a char was inputted and not an int? I know that the char is converted into an int but I am trying to limit anything other than pure integers getting through the function.

Cheers

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-08T04:21:47.647

No, it's impossible because Java itself upgrades the `char` to an `int` if it can.

You could make an overload of your function that takes a `char` parameter instead of an `int` which might throw an exception, but that won't stop anyone from casting the `char` to an `int` and calling the `int` version.

There is absolutely no difference at all between the character constant `'A'` cast to an integer and the integer 65, so it would be completely impossible to distinguish the cases.

**Update from Pax:**

I would argue that explicit casting is NOT passing a `char`, it's the caller converting a `char` to an `int` then passing the `int`. This solution catches the inadvertent passing of a `char`.

Pinching someone's code from another answer, that would be:

```
public class Test {
    private static void someMethod(char c) throws Exception {
        throw new Exception("I don't think so, matey!");
    }
    private static void someMethod(int i) {
        System.out.println(i);
    }
    public static void main(String[] args) throws Exception {
        someMethod(100);
        someMethod('d');
    }
} 
```

This results in:

```
100
Exception in thread "main" java.lang.Exception: I don't think so, matey!
    at Test.someMethod(Test.java:4)
    at Test.main(Test.java:13) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-08T04:28:57.723

You can use Integer instead of int.

```
void foo(Integer bar) { } 
```

If you try to invoke foo('A') you will get a compiler error.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T05:17:34.377

> I am trying to limit anything other than pure integers getting through the function.

You're having a little bit of a conceptual mismatch with Java. A `char` in Java is just a number; the fact that you use the type `char` instead of the type `int` is because you want a number that is 16 bits instead of 32 bits.

A `char` is just a number that goes from 0 to 65535\. An `int` is just a number that goes from –2,147,483,648 to 2,147,483,647.

Now, I understand that you want to prevent people from calling your method with nonsensical things like `foo('t')`. However, as soon as your program is compiled, Java actually transforms this call to `foo(116)`.

In effect, someone calling your method with a character as the parameter is as silly as calling your method with an arbitrary number. If you are stuck in such a situation, consider these possibilities:

*   Do some characters yield an invalid input to your method?

    *For example, you want a brightness value between 0 and 255, and `setBrightness('Δ')` is actually `setBrightness(916)`.*

    Throw an exception - you should be doing this anyway!

*   Do you want a character representing a numerical value to be parsed?

    *For example, you want a brightness value between 0 and 9, and `setBrightness('5')` should actually be `setBrightness(5)`.*

    Parse the character as a String.

_

```
char a = '5';
String a_s = String.valueOf(a);
int a_i = Integer.parseInt(a_s);
setBrightness(a_i) 
```

*   Does the method do everything properly, but passing a character as a parameter is silly?

    *For example, you want a brightness value between 0 and 1,000,000, and `setBrightness('q')` just rubs you the wrong way.*

    Leave it alone. Calling `setBrightness('q')` is bad form, but that's the problem of the other coder. Don't do it yourself though! You'll kick yourself later when you're digging through a Unicode table trying to figure out what you meant at the time.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-08T04:35:47.193

The casting of `char` to `int` will occur at compile-time, so it won't be possible to determine whether a `char` was passed in, or an `int` was passed in.

In order to illustrate, let's examine the source code and the resulting bytecode of a program which has a `someMethod(int)` which is called by passing an `char` and `int`:

Source code:

```
class CharIntCast
{
    private static void someMethod(int i)
    {
    }

    public static void main(String[] args)
    {
        someMethod(100);
        someMethod('d');
    }
} 
```

Bytecode:

```
Compiled from "CharIntCast.java"
class CharIntCast extends java.lang.Object{
CharIntCast();
  Code:
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object."<init>":()V
   4:   return

private static void someMethod(int);
  Code:
   0:   return

public static void main(java.lang.String[]);
  Code:
   0:   bipush  100
   2:   invokestatic    #2; //Method someMethod:(I)V
   5:   bipush  100
   7:   invokestatic    #2; //Method someMethod:(I)V
   10:  return

} 
```

As can be seen in the bytecode, both the values `100` and `'d'` are already handled as an integer when it is pushed onto the stack by the `bipush` instruction before making a call to the `someMethod`.

Therefore, at runtime, it won't be possible to find out whether the method argument was either an `int` or `char`, as the casting is performed by the compiler.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T04:17:29.217

I don't think so.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T04:27:09.180

Unless your integers are confined to a range that is outside the range of a char, then you cannot do this since you cannot tell whether a value 64 is an int or a char.

# programming-languages - 为什么大多数编程语言对 4 的平方根只给出一个答案？

> ID：838214
> 
> 赞同：15
> 
> 时间：2009-05-08T04:17:31.650
> 
> 标签：programming-languages, history, return-value, sqrt, square-root

大多数编程语言都会给出`2`平方根的答案`4`。但是，有两个答案：`2`和`-2`。是否有任何特殊原因，历史原因或其他原因，为什么通常只给出一个答案？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-05-08T04:23:31.043

因为：

*   在数学中，除非另有说明，否则 √<i>x 通常指的是*x* [ [http://mathworld.wolfram.com/SquareRoot.html]](http://mathworld.wolfram.com/SquareRoot.html])的主（即正）根。
*   某些语言无法返回多个值。
*   由于您可以只应用否定，因此返回两者将是多余的。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-08T04:26:54.513

如果平方根方法返回两个值，那么这两个值中的一个实际上总是会被丢弃。除了在额外的返回值上浪费内存和复杂性之外，它几乎不会被使用。每个人都知道您可以将返回的答案乘以`-1`并获得另一个根。

我希望只有数学语言会在这里返回多个值，可能是数组或矩阵。但是对于大多数通用编程语言，按照您的建议进行操作的收益和成本都可以忽略不计。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-08T04:24:18.607

一些想法：

*   从历史上看，函数被定义为返回*单个值*的过程。

*   定义一个像这样返回*多个值*的干净函数会很繁琐（使用原始编程结构） 。

*   规则总是有*例外*：

    *   例如 0 只有一个*根*(0)。
    *   *您不能取负数*的平方根（除非语言支持复数）。在不支持虚数或复数系统的语言中，这可以被视为异常（如“除以 0”）。
*   *推导出*2 个平方根通常很简单（只需否定函数返回的值）。*如果他们的域*依赖于处理正 (+) 和负 (-) 根，这可能是 sqrt() 函数的调用者的练习。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-05-08T04:22:08.083

返回一个数字比返回两个数字更容易。大多数工程决策都是以这种方式做出的。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-06-26T19:31:57.090

有许多函数只能从 2 个或更多可能性中返回 1 个答案。例如反正切。1 的反正切返回为 45 度，但也可以是 225 甚至 405。与生活和编程中的许多事情一样，我们知道并且可以依赖一个约定。平方根函数返回正值就是其中之一。我们，程序员，要记住还有其他解决方案，并在代码中需要时对它们采取行动。

顺便说一句，在处理运动学和逆运动学方程时，这是机器人技术中的一个常见问题，其中存在对应于笛卡尔位置的链接位置的多个解。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-05-08T04:29:32.557

在数学中，按照惯例，除非您明确说明，否则始终假定您想要某事物的正平方根。四的平方根实际上是二。如果你想要否定的答案，在前面放一个否定的符号。如果你想要两者，请加上加号或减号。如果没有这个约定，就不可能写出方程式；即使他们确实在前面放了一个符号，您也永远不会知道他们的意图（例如，因为它可能是负平方根的负数）。此外，如果运算符开始返回两个值，您将如何编写任何涉及数学的计算机代码？它会破坏一切。

这个约定的不幸例外是在求解变量时。在以下等式中：

x^2 = 4

你别无选择，只能考虑 X 的两个可能值。如果你取两边的平方根，你会得到 x = 2 但现在你必须输入加号或减号以确保你没有错过任何可能的解决方案. 另外，请记住，在这种情况下，从技术上讲，X 可以是正数或负数，而不是四的平方根。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-08T04:21:33.200

因为多个返回类型实现起来很烦人。如果您真的需要另一个结果，那么将结果乘以 -1 是不是很容易？

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-06-23T22:50:06.163

因为大多数程序员只*想要*一个答案。

如果调用者需要，很容易从正值生成负值。对于大多数代码，调用者只使用正值。

* * *

但是，现在很容易以多种语言返回两个值。在 JavaScript 中：

```
var sqrts=function(x) {
  var s=Math.sqrt(x);
  if (s>0) {
    return [s,-s];
  } else {
    return [0];
  }
} 
```

只要调用者知道遍历返回的数组，你就是黄金。

```
>sqrts(2)
[1.4142135623730951, -1.4142135623730951] 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-08T04:54:45.680

我认为因为该函数被称为“sqrt”，如果你想要多个根，你将不得不调用函数“sqrts”，它不存在，所以你不能这样做。

更严肃的答案是您提出了一个更大问题的特定实例。许多方程和通常的反函数（包括 sqrt）有多种可能的解，例如 arcsin 等，而这些通常是一个问题。例如，对于 arcsin，是否应该返回无限数量的答案？例如，参见有关[分支削减](http://en.wikipedia.org/wiki/Branch_point)的讨论。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-08-03T12:29:59.683

因为它在历史上被定义为{{引用需要}}作为给出已知表面正方形边长的函数。在这种情况下，长度是积极的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-08T04:21:02.860

你总是可以知道另一个数字是什么，所以也许没有必要同时返回它们。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-08T04:31:08.950

这可能是因为当人们使用计算器计算平方根时，他们只想要正值。

更进一步，问为什么你的计算器不允许你取负数的平方根。使用虚数是可能的，但普通用户对此的使用绝对为零。

[关于虚数。](http://en.wikipedia.org/wiki/Imaginary_number)

# php - PHP：按其值的长度对数组进行排序？

> ID：838227
> 
> 赞同：64
> 
> 时间：2009-05-08T04:22:11.420
> 
> 标签：php, arrays

我做了一个字谜机器，我有一系列积极的匹配。问题是它们的顺序不同，我希望能够对数组进行排序，以便最长的数组值首先出现。

有人对如何做到这一点有任何想法吗？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2009-05-08T04:28:29.270

使用[http://us2.php.net/manual/en/function.usort.php](http://us2.php.net/manual/en/function.usort.php)

使用此自定义功能

```
function sort($a,$b){
    return strlen($b)-strlen($a);
}

usort($array,'sort'); 
```

如果您想保留旧索引，请使用 uasort，如果您不关心，请使用 usort。

另外，我相信我的版本更好，因为 usort 是一种不稳定的排序。

```
$array = array("bbbbb", "dog", "cat", "aaa", "aaaa");
// mine
[0] => bbbbb
[1] => aaaa
[2] => aaa
[3] => cat
[4] => dog

// others
[0] => bbbbb
[1] => aaaa
[2] => dog
[3] => aaa
[4] => cat 
```

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2011-12-19T12:51:24.497

如果你想用 PHP 5.3 的方式来做，你可能想创建这样的东西：

```
usort($array, function($a, $b) {
    return strlen($b) - strlen($a);
}); 
```

这样你就不会污染你的全局命名空间。

但是只有当你需要它在你的源代码中的一个地方来保持东西干燥时才这样做。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2015-11-23T09:39:37.907

PHP7 即将到来。在 PHP7 中，您可以使用[Spaceship Operator](https://wiki.php.net/rfc/combined-comparison-operator.)。

```
usort($array, function($a, $b) {
    return strlen($b) <=> strlen($a);
}); 
```

希望这对您将来有所帮助。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-05-08T04:26:07.510

```
function sortByLength($a,$b){
  if($a == $b) return 0;
  return (strlen($a) > strlen($b) ? -1 : 1);
}
usort($array,'sortByLength'); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2020-02-15T16:48:39.037

降序：

```
$array = ['aa', 'bb', 'c', 'ccc', 'a', 'ertre'];

usort($array, function($a, $b){
   return strlen($a) < strlen($b);
});

var_export($array);

// Output
array (
  0 => 'ertre',
  1 => 'ccc',
  2 => 'aa',
  3 => 'bb',
  4 => 'c',
  5 => 'a',
) 
```

升序：

```
$array = ['aa', 'bb', 'c', 'ccc', 'a', 'ertre'];

usort($array, function($a, $b){
   return strlen($a) > strlen($b);
});

// Output
array (
  0 => 'c',
  1 => 'a',
  2 => 'aa',
  3 => 'bb',
  4 => 'ccc',
  5 => 'ertre',
) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-05T11:20:47.023

制作一个`strlen`由 oyur 数组元素组成的数组，并将`multisort`其与您的数组一起制作。

```
foreach($Yourarray as $c=>$key) {               
    $key['maxlen'] = strlen($key);  
    $sort_numcie[] = $key['maxlen'];
}

array_multisort($sort_numcie, $Yourarray); 
```

这肯定会奏效。我相信！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-09-17T12:05:45.013

除了接受的答案之外，**按升序或降序按**长度对数组进行排序：

```
function strlen_compare($a,$b){
    if(function_exists('mb_strlen')){
         return mb_strlen($b) - mb_strlen($a);
    }
    else{
         return strlen($b) - strlen($a);
    }
}

function strlen_array_sort($array,$order='dsc'){
    usort($array,'strlen_compare');
    if($order=='asc'){
        $array=array_reverse($array);
    }
    return $array;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-10-25T12:35:50.857

```
array_multisort(array_map('count', $arr), SORT_DESC, $arr); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-01-01T01:06:27.713

这是使用 spaceship 运算符的一种方法（需要 PHP 7.0）：

```
$arr = ['apple','pear','oranges','banana'];
usort($arr, function ($a, $b) { return (strlen($a) <=> strlen($b)); });
print_r($arr); 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-09-16T22:12:21.197

这是我过去做过的一种方式。

```
// Here's the sorting...
$array = array_combine($words, array_map('strlen', $words));
arsort($array); 
```

* * *

## 回答 #11

> 赞同：-8
> 
> 时间：2011-11-06T15:17:16.137

这很简单。

```
function LSort(a,b){return a.length-b.length;}

var YourArray=[[1,2,3,4,5,6], ['a','b'], ['X','Y','Z'], ['I','Love','You'], ['good man']];

YourArray.sort(Lsort); 
```

结果：

```
['good man'] Length=1
['a','b'] Length=3
['X','Y','Z'] Length=3
['I','Love','You'] Length=3
[1,2,3,4,5,6] Length=6 
```

# architecture - 三层架构和 LINQ to Entities

> ID：838236
> 
> 赞同：2
> 
> 时间：2009-05-08T04:27:45.277
> 
> 标签：architecture, linq-to-entities, 3-tier

几年来，我一直在使用三层架构（表示层、逻辑层和数据层）来编写应用程序。通常，我使用 .netTiers 等工具来生成数据层和部分逻辑层。一切都定义明确，我喜欢它。

我现在受限于使用 LINQ to Entites（似乎 LINQ to SQL 已被微软放弃），我真的很困惑。在我看来，LINQ to Entites 生成的代码是我几乎无法控制的逻辑和数据层的混合体。此外，我真的不喜欢我必须使用生成的类（实体...）这一事实。

最后，您能否分享一下您使用 LINQ to Entities 的经验和最佳实践？知道我如何仍然拥有定义明确的三层架构吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T15:18:41.050

Ian Cooper 撰写了关于使用 Linq2Sql 构建应用程序的优秀系列文章：

*   [第 1 部分 简介](http://codebetter.com/blogs/ian_cooper/archive/2007/11/29/architecting-linq-to-sql-applications-part-1.aspx)
*   [第 2 部分分层架构](http://codebetter.com/blogs/ian_cooper/archive/2007/11/30/architecting-linq-to-sql-applications-part-2.aspx)
*   [第 3 部分 DAO 和存储库](http://codebetter.com/blogs/ian_cooper/archive/2007/12/02/architecting-linq-to-sql-applications-part-3.aspx)
*   [第 4 部分 动态查询](http://codebetter.com/blogs/ian_cooper/archive/2007/12/04/architecting-linq-to-sql-applications-part-4.aspx)
*   [第 5 部分](http://codebetter.com/blogs/ian_cooper/archive/2008/02/17/architecting-linq-to-sql-applications-part-5.aspx)
*   [第 6 部分使用 XML 文件而不是属性进行映射](http://codebetter.com/blogs/ian_cooper/archive/2008/03/09/previous-architecting-linq-to-sql-applications-part-5.aspx)
*   [第 7 部分](http://codebetter.com/blogs/ian_cooper/archive/2008/03/09/architecting-linq-to-sql-applications-part-7.aspx)
*   [第 8 部分](http://codebetter.com/blogs/ian_cooper/archive/2008/04/06/architecting-linq-to-sql-applications-part-8.aspx)
*   [第 9 部分](http://codebetter.com/blogs/ian_cooper/archive/2008/06/28/architecting-linq-to-sql-part-9.aspx)
*   [第 10 部分](http://codebetter.com/blogs/ian_cooper/archive/2008/07/01/architecting-linq-to-sql-part-10.aspx)

希望你能找到你需要的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T15:24:45.473

L2S没有死，但是基本完成了。它是 Linq 的一个实现（Sql Adapter）。Linq 是一种语言功能，将随着 .net 版本的发布而继续扩展。

Linq 之所以美丽，是因为它的简洁性。我是其中之一，除了其他提供者（如 MySql、Firebird 等）之外，我真的不希望他们把它搞砸。

# c++ - 如何在 GDI+ C++ 中克隆一个solidbrush

> ID：838238
> 
> 赞同：1
> 
> 时间：2009-05-08T04:28:10.847
> 
> 标签：c++, gdi+, clone

我正在使用 gdi+ 和 c++。我有一个关于 SolidBrush 的问题。如何克隆 SolidBrush？

```
SolidBrush* oldBrush xxx;
Brush* newBrush = oldBrush->Clone(); 
```

我发现 newBrush 是一个画笔对象。这意味着如果我使用`dynamic_cast<SolidBrush>(newBursh)`，我将永远得到 NULL。

我看了gdi+ SolidBrush 的.h 文件，好像使用了Brush 的虚拟克隆方法，它没有覆盖它！

为什么？

感谢您的解决方案，但我还有一个问题？为什么 SolidBrush 不实现克隆方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T04:46:28.570

`Brush`能做的都`SolidBrush`可以。`SolidBrush`只是一种创建`Brush`纯色的便捷方式。

[这是从MSDN](http://msdn.microsoft.com/en-us/library/ms536273(VS.85).aspx)上的这个示例派生的示例：

```
SolidBrush solidBrush(Color(255,255,0,0));
Brush *clone = solidBrush.Clone(); 
```

然后，您可以继续使用`clone`任何其他画笔，它的行为将与`solidBrush`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-17T05:04:52.203

> 为什么 SolidBrush 不实现克隆方法？

`SolidBrush``clone`从 Brush继承方法。再次实施它`SolidBrush`是多余的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-08T04:44:22.023

您可以简单地使用 SolidBrush 的颜色属性，它将被克隆。它是一个 SolidBrush，因此，无论如何，唯一重要的是颜色。

像这样的东西应该工作：

`Brush* newBrush = new Brush(oldBrush->Color);`

 `# sql-server - 寻找顶级销售人员

> ID：838240
> 
> 赞同：3
> 
> 时间：2009-05-08T04:28:31.267
> 
> 标签：sql-server

我想找到 Top 和 botton 10% 的销售人员。如何使用 SQL 2005 或 2008 做到这一点？

```
DECLARE @Sales TABLE 
(
SalesPersonID varchar(10), TotalSales int
)

INSERT @Sales
SELECT 1, 200 UNION ALL
SELECT 2, 300 UNION ALL
SELECT 7, 300 UNION ALL
SELECT 4, 100 UNION ALL
SELECT 5, 600 UNION ALL
SELECT 5, 600 UNION ALL
SELECT 2, 200 UNION ALL
SELECT 5, 620 UNION ALL
SELECT 4, 611 UNION ALL
SELECT 3, 650 UNION ALL
SELECT 7, 611 UNION ALL
SELECT 9, 650 UNION ALL
SELECT 3, 555 UNION ALL
SELECT 9, 755 UNION ALL
SELECT 8, 650 UNION ALL
SELECT 3, 620 UNION ALL
SELECT 5, 633 UNION ALL
SELECT 6, 720 
GO 
```

另外，如果我添加部门，那么我如何编写相同的查询来查找每个部门的前 10% 和后 10%？我希望这两个查询。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T04:38:07.280

前10名 ％

```
select top 10 percent SalesPersonID, sum(TotalSales)
  from Sales
 order by sum(TotalSales)
 group by SalesPersonID 
```

底部 10 %

```
select top 10 percent SalesPersonID, sum(TotalSales)
  from Sales
 order by sum(TotalSales) desc
 group by SalesPersonID 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T04:34:23.077

```
--Top 10%
SELECT TOP 10 PERCENT SalesPersonID, SUM(TotalSales) FROM @Sales
GROUP BY SalesPersonID
ORDER BY SUM(TotalSales) ASC

--Bottom 10%
SELECT TOP 10 PERCENT SalesPersonID, SUM(TotalSales) FROM @Sales
GROUP BY SalesPersonID
ORDER BY SUM(TotalSales) DESC 
```

例如，如果您添加了列 Department varchar(20)：

```
--By Dept
SELECT TOP 10 PERCENT Department, SUM(TotalSales) FROM @Sales
GROUP BY Department
ORDER BY SUM(TotalSales) ASC/DESC //(Whichever one you want) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T14:04:00.267

cte版本：

```
DECLARE @Sales TABLE (SalesPersonID varchar(10), TotalSales int)INSERT @Sales
SELECT 1, 200 UNION ALL
SELECT 2, 300 UNION ALL
SELECT 7, 300 UNION ALL
SELECT 4, 100 UNION ALL
SELECT 5, 600 UNION ALL
SELECT 5, 600 UNION ALL
SELECT 2, 200 UNION ALL
SELECT 5, 620 UNION ALL
SELECT 4, 611 UNION ALL
SELECT 3, 650 UNION ALL
SELECT 7, 611 UNION ALL
SELECT 9, 650 UNION ALL
SELECT 3, 555 UNION ALL
SELECT 9, 755 UNION ALL
SELECT 8, 650 UNION ALL
SELECT 3, 620 UNION ALL
SELECT 5, 633 UNION ALL
SELECT 6, 720 

;with a as
(
    select SalesPersonID, sum(TotalSales) as Total
    from @Sales
    group by SalesPersonID
)
select coalesce(a.SalesPersonID, b.SalesPersonID) as SalesPersonID, coalesce(a.Total,b.Total) as Total
from a a
    full outer join a b
        on a.SalesPersonID=b.SalesPersonID
where a.SalesPersonID in (select top 10 percent SalesPersonID from a order by Total desc)
    or b.SalesPersonID in (select top 10 percent SalesPersonID from a order by Total)
order by a.Total desc 
```

# .net - 具有空值的日期的 XML 反序列化

> ID：838246
> 
> 赞同：8
> 
> 时间：2009-05-08T04:33:32.407
> 
> 标签：.net, xml, serialization

我从一个供应商那里得到一个 xml 文件，其中有一些“空”日期，如下所示：

```
<UpdatedOn/>
<DeletedOn/> 
```

通过进行常规反序列化，它失败了：

> 内部异常：System.FormatException：字符串未被识别为有效的 DateTime。

任何想法如何处理这个？

我的字段已被标记为默认值`DateTime`：

```
[System.Xml.Serialization.XmlElementAttribute(DataType="date")]
[System.ComponentModel.DefaultValueAttribute(typeof(System.DateTime), "1901-01-01")]
public System.DateTime UpdateOn{...} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-08T04:51:56.217

我假设 xml 实际上类似于`<UpdatedOn/>`/ `<DeletedOn/>`？即空元素。

当涉及非标准格式时，一个有效的技巧是引入您自己的 shim 属性：

```
[Serializable]
public class Foo {
    [XmlIgnore]
    public DateTime Bar { get; set; }

    [Browsable(false), EditorBrowsable(EditorBrowsableState.Never)]
    [XmlElement("Bar")]
    public string BarTransport {
        get {
            return Bar == DateTime.MinValue ? "" : XmlConvert.ToString(Bar);
        }
        set {
            Bar = string.IsNullOrEmpty(value) ? DateTime.MinValue
                : XmlConvert.ToDateTime(value);
        }
    }
} 
```

在这里，在序列化期间不使用`Foo.Bar`属性（实际的）；`DateTime`相反，该`Foo.BarTransport`属性在`Bar`元素下序列化 - 但具有特殊规则。您可以替换`DateTime.MinValue`为任何其他要视为空白/默认值的值。

请注意，如果您根本不想发送`Bar`元素，则可以编写 a `public bool ShouldSerializeBarTransport()`，`XmlSerializer`它将检查 - 如果您 return `false`，它将不会被写入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-01T12:52:40.313

尝试更改`<UpdatedOn/>`to `<UpdatedOn xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />`，您可以反序列化 XML。

# sql-server - SQL Server 2008 页面/行压缩思路

> ID：838255
> 
> 赞同：14
> 
> 时间：2009-05-08T04:35:46.740
> 
> 标签：sql-server, performance, sql-server-2008, compression

这里的其他人在他们的数据集的页面或行级别上玩过[SQL Server 2008 压缩吗？](http://msdn.microsoft.com/en-us/library/cc280449.aspx "MSDN SQL Server 2008 压缩")您对速度和磁盘空间性能的印象如何？

有没有人见过压缩明显损害性能？

在我们一直在玩的一些巨大的事实表上，我们注意到压缩可以在表及其索引上产生非常有益的查询速度差异。它还节省了大量磁盘空间（某些数据约为 50%）。相对于处理器，我们的硬件设置严重受磁盘/ io 限制，到目前为止，压缩对我们来说似乎是一个非常容易的性能胜利。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-08T06:40:10.607

老问题，但根据经验，一个简单的经验法则是：

*   对于非 BLOB 数据行存储*页面*压缩率在 3 到 4 倍之间
*   对于非 BLOB 数据，列存储压缩率在 9 到 11 倍之间

* * *

林奇乳木果的文章现在似乎落后于登录....

Linchi Shea 就这个话题发表了一些有趣的文章：

*   [SQL Server 2008 页面压缩：真实数据库的压缩率](http://sqlblog.com/blogs/linchi_shea/archive/2008/05/11/sql-server-2008-page-compression-compression-ratios-from-real-world-databases.aspx)

*   [SQL Server 2008 数据压缩：数据分布的影响](http://sqlblog.com/blogs/linchi_shea/archive/2008/06/20/sql-server-2008-data-compression-impact-of-data-distribution.aspx)

*   [SQL Server 2008 页面压缩：对表扫描的性能影响](http://sqlblog.com/blogs/linchi_shea/archive/2008/05/16/sql-server-2008-page-compression-performance-impact-on-table-scans.aspx)

*   [SQL Server 2008 页面压缩：对插入的性能影响](http://sqlblog.com/blogs/linchi_shea/archive/2008/05/12/sql-server-2008-page-compression-performance-impact-on-inserts.aspx)

*   [SQL Server 2008 页面压缩：使用多个处理器](http://sqlblog.com/blogs/linchi_shea/archive/2008/05/05/sql-server-2008-page-compression-using-multiple-processors.aspx)

这可能也很有趣：

*   [使用 SQL Server 2008 进行数据仓库的最佳实践](http://msdn.microsoft.com/en-us/library/cc719165.aspx)

[SQL Server 存储引擎博客](http://blogs.msdn.com/sqlserverstorageengine/)也有一些关于压缩的有趣文章。

# vim - 如何同时操作更多的 Emacs 缓冲区？

> ID：838258
> 
> 赞同：5
> 
> 时间：2009-05-08T04:36:39.017
> 
> 标签：vim, emacs, buffer

我正在寻找与`:bufdo`Emacs 中的 Vim 命令等效的功能。`:bufdo`接受一个参数 - 另一个命令 - 并在所有打开的缓冲区上执行该命令。我还没有在 Emacs 中找到类似的功能。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-08T05:26:21.593

根据您的命令是什么，您可以执行以下操作：

```
M-: (mapc (lambda (b) (set-buffer b) (*command*)) (buffer-list)) 
```

但是，我有一种感觉，你想要一些不那么轻率的东西。看看[键盘宏](http://www.gnu.org/software/emacs/manual/html_node/emacs/Keyboard-Macros.html)。即，决定你想做什么：

```
C-x ( <do-your-command> C-x )
M-: (mapc (lambda (b) (set-buffer b) (kmacro-end-and-call-macro)) (buffer-list)) 
```

如果您经常使用它，您可能希望将最后一部分定义为一个函数：

```
(defun bufdo ()
   "execute last macro on all buffers, ala bufdo from vi"
   (interactive)
   (mapc (lambda (b) 
            (with-current-buffer b
              (kmacro-end-and-call-macro)))
         (buffer-list))) 
```

注意：代码未经测试

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T07:37:36.880

您还可以签[出 ibuffer](http://www.emacswiki.org/emacs/IbufferMode)，它允许您标记您喜欢操作的缓冲区`m`，然后您可以在其上执行某些操作`E`。其他常见操作也可用，例如`query-replace`on `Q`。只需查看菜单或模式说明 ( `C-h m`)。

[顺便说一句， dired](http://www.emacswiki.org/emacs/DiredMode)也可能发生类似的事情，尽管它似乎没有给你`eval`命令。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T05:29:37.187

看一下缓冲区列表（函数）。它返回所有打开的缓冲区（BUFFER 对象）的列表。有关将它与 mapcar 一起使用的简单示例，请参阅[手册](http://www.gnu.org/software/emacs/elisp/html_node/The-Buffer-List.html)（它对列表的每个元素进行操作，并累积结果）。您可能还会发现 set-buffer，它以编程方式从 Emacs Lisp 设置当前缓冲区，很有用。

# c# - 处理windows应用程序的结束进程

> ID：838261
> 
> 赞同：11
> 
> 时间：2009-05-08T04:38:04.393
> 
> 标签：c#, .net, event-handling

是否可以在同一个 Windows 应用程序本身内捕获 Windows 应用程序的任务管理器结束进程？我正在使用 C# 2.0 win 应用程序，我想在结束进程发生时进行一些数据库处理（将数据库中的标志从“Y”更改为“N”）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-10T00:41:38.570

不，不可能挂钩操作系统结束进程的决定。请注意，这不是由任务管理器完成的，结束进程是内核的责任。

您需要在这里做两件事：

1.  将事件处理程序连接到告诉应用程序退出的普通用户界面消息。使用这些事件来持久化数据、释放资源，或者以其他方式干净地退出。
2.  酌情处理异常以捕获错误并在可能的情况下清理和保存数据。

这是 Raymond 博客的三个链接，解释了为什么你不能按照你的要求去做。

*   [为什么不能捕获 TerminateProcess？](http://blogs.msdn.com/oldnewthing/archive/2004/07/22/191123.aspx)
*   [为什么某些进程在被杀死后仍留在任务管理器中？](http://blogs.msdn.com/oldnewthing/archive/2004/07/23/192531.aspx)
*   [程序和用户之间的军备竞赛](http://blogs.msdn.com/oldnewthing/archive/2004/02/16/73780.aspx)

[另外，我在这里](https://stackoverflow.com/questions/501523/c-deallocate-resources-on-process-termination)解决了一个类似的 StackOverflow 问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-12T15:40:07.810

稍微不同的方法怎么样：

让您的应用程序在运行时每隔一段时间更新一个日期时间字段，例如 LastPollDate，并有一个单独的字段，例如设置为 N 的“AppTerminatedNormally”，如果您收到表单关闭事件，则更改为 Y。

如果应用程序通过任务管理器被杀死，日期将不再更新，并且您的 AppTerminatedNormally 仍然是 no。

这样，您可以运行查询来查找 LastPollDate 早于 10 分钟且 AppTerminatedNormally 为 N 的所有行，并且您将拥有所有异常终止的会话。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-12T18:31:19.373

你们都会对这篇文章吐口水，但是这里……

您试图在错误的级别解决问题（即，当内核杀死应用程序时，在您的应用程序中运行代码）。真正的问题在于确保数据库正确反映其客户端应用程序的存在（或不存在）。

要解决这个问题，请避免让应用程序在用户交互之间处于“不一致状态”。换句话说，不要启动无法快速提交的事务，不要将数据写入文件，使文件处于半写或不可读状态，不要将应用程序外部的资源保持不一致用户交互之外的状态。换句话说，如果您的应用程序不忙于响应事件处理程序，它应该准备好立即关闭。

如果您遵循上述做法，您会发现在终止之前需要“快速清理”的场景非常少。在用户单击“确定”或“保存”等的交互之外，编写良好的应用程序应该能够在立即终止后幸存下来，而不会对其数据存储造成任何持久的损害或损坏。

如果您绝对必须在退出时在数据库中设置一个标志（这听起来是用于检测用户是否登录的典型模式），那么请考虑以下任一替代方案：

1.  定期（可能每 30 秒一次）在数据库中插入/更新类似时间戳的字段，以指示应用程序最近在线的时间。其他应用程序可以检查这些时间戳以确定另一个应用程序最近多久在线......如果该值在最后 30 秒内，则其他应用程序仍然在线。

2.  正如 Woodhenge 正确建议的那样，创建一个单独的进程（最好是一个服务）来监控主应用程序的状态。Windows 服务可以配置为在服务失败时自动重新启动。然后，此监视过程将向数据库发出时间戳。

请注意，上述两个建议都解决了真正的问题（检测应用程序是否正在访问数据库），而不会使数据库处于“不一致状态”（当应用程序实际死机时，上述标志为“Y”并且该标志应该是“N”）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-23T11:27:59.810

如果您的目标是 Windows Vista（或更高版本），您可能对 RegisterApplicationRecoveryCallback API 感兴趣...

[http://msdn.microsoft.com/en-us/library/aa373345.aspx](http://msdn.microsoft.com/en-us/library/aa373345.aspx)

它允许您在应用程序中指定一个回调例程，该例程将在进程即将崩溃时调用。注意它仅用于崩溃，如果进程被故意杀死，则不会自动调用。

您可以从 C# 调用/调用此 API（我已经做到了），但请记住，当您的回调被调用时，您的应用程序已经处于非常糟糕的状态，您可以对内存状态做出很少的假设. 如果您有任何要在此例程中使用的内存中数据，我会将其放在一个非常一般范围内的静态数据中，以便您在回调例程时有最大可能不会“整理”它运行。

还有一些其他有趣的 API，与此相关，允许您在失败后自动重新启动应用程序等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T05:00:11.953

您可以做的是获取进程 ID 并监视进程，您可以使用 HasExited 属性检查进程是否已结束。下面是一个快速的VB代码（对不起，我现在没有VS。这是我在另一个论坛上写的）

```
Public Class Form1
    Dim p As ProcessStartInfo
    Dim process As Process
    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        p = New ProcessStartInfo("iexplore.exe")
        process = process.Start(p)
    End Sub

    Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click
        MsgBox(process.Id)
        If process.HasExited Then
            MsgBox("yes")
        Else
            MsgBox("no")
        End If
    End Sub
End Class 
```

上面的代码启动 Internetexplorer，按钮检查进程是否结束。您可以使用类似的进程来获取所有正在运行的进程并使用 processID。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-09T02:37:56.740

我认为这不可能从应用程序中完成。End Task 的目的是立即停止进程。这不允许执行任何清理代码。

Shoban 指出了另一种实现目标的方法。另一个应用程序或服务需要寻找主进程。当其他进程找不到主进程时，您可以在此时进行数据库处理。

# statistics - 如何制作 voronoi 树形图？

> ID：838265
> 
> 赞同：2
> 
> 时间：2009-05-08T04:38:48.963
> 
> 标签：statistics, voronoi, treemaps

我想为统计数据制作 voronoi 树图，例如 ![替代文字](https://codezine.jp/static/images/article/3516/09.png) [新闻摄影](http://newsgraphy.com/)

你知道我如何在 Perl、PHP、Ruby 或 Python 中做到这一点吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T04:53:30.253

[数学::几何::Voronoi](http://search.cpan.org/perldoc?Math::Geometry::Voronoi)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T13:58:09.187

Python 的漂亮演示和图形：http: [//home.scarlet.be/zoetrope/voronoi/](http://home.scarlet.be/zoetrope/voronoi/)（[存档副本在 wayback](http://web.archive.org/web/20100110083040/http://home.scarlet.be/zoetrope/voronoi/)）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-26T12:06:36.093

刚找到这个页面。在将 Benjamin Dittes 的 C# 版本的 Steven Fortune 算法翻译成 Javascript 之后，我一直在使用 Javascript/canvas 开发 Voronoi 演示小程序（可在 Code Project 中获得，请参阅“用 C# 实现的 Fortune 的 Voronoi 算法”）。这是包含 Javascript 中 Fortune 的 Voronoi 算法的页面： [http://www.raymondhill.net/voronoi/voronoi.php](http://www.raymondhill.net/voronoi/voronoi.php) 这是第一次迭代，我计划进一步调整它以更好地适应 Javascript。希望这可以帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-30T08:15:34.900

另一个 Python 答案似乎指向了一个**仅限栅格**的解决方案。我也有兴趣解决这个问题（在 Python 中），我认为以下脚本可以形成一个可用的起点：

[http://www.oxfish.com/python/voronoi.py](http://www.oxfish.com/python/voronoi.py)

（[回程存档副本](http://web.archive.org/web/20100531065334/http://www.oxfish.com/python/voronoi.py)）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-05-15T13:20:23.253

首先，线条并不奇怪：这是因为这不是普通的 Voronoi 细分，而是面积加权 Voronoi (AWT) 细分，甚至可能是质心 Voronoi 细分 (CVT)。话虽如此，为了使 Voronoi 区域（多边形）具有显着不同的区域（这将反映数据的某些属性），您需要 AWT（最好实现为 CVT 以保持多边形的良好纵横比）；普通的 Voronoi 算法（如上面某些人所建议的）将无法为您提供帮助。可能没有可用的直接解决方案，尤其是对于脚本语言，因为 AWT 的迭代更新步骤导致的计算复杂性非常高。您应该查看有关“Voronoi Treemaps”和“Dynamic Voronoi Treemaps”的工作 巴尔泽等人。和 Sud 等人。了解算法，然后自己实现它（你需要的一切都在他们的论文中）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T06:56:35.793

James Tauber 正在编写一个使用 JavaScript 和[Fortune 算法](http://en.wikipedia.org/wiki/Fortune%27s_algorithm)`canvas`在元素中绘制 Voronoi 图的教程： [Voronoi Canvas Tutorial](http://jtauber.com/blog/2008/11/27/voronoi_canvas_tutorial_part_i/)

它还没有完成（他在第 4 部分中的第 3 部分），但我认为已经足够完成它了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-07-26T12:02:08.507

[Macrofocus TreeMap](http://www.treemap.com/)的最新版本 (2.0)具有 Voronoi 算法作为选项等。

# objective-c - 如何在 tableView:viewForFooterInSection 中添加 UIButton 或 UISwitch

> ID：838266
> 
> 赞同：6
> 
> 时间：2009-05-08T04:38:49.073
> 
> 标签：objective-c, iphone, cocoa-touch, uitableview, uikit

我试图了解如何将带有 UISwitch 或其他控制器的标签添加到分段 tableView 中的页脚（或页眉）。任何帮助将不胜感激。先感谢您！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T06:40:16.317

好的，在搜索和工作之后，我完成了以下操作：

```
// Need to refactor so that the label is Public Sharing and Priviate Sharing and the actions work for each switch
- (UIView *) tableView: (UITableView *) tableView
viewForFooterInSection: (NSInteger) section
{
  if (section == 0 || section == 1) {
    CGRect screenRect = [[UIScreen mainScreen] applicationFrame];
    UIView* footerView = [[[UIView alloc] initWithFrame:CGRectMake(0, 0, screenRect.size.width, 44.0)] autorelease];
    footerView.autoresizesSubviews = YES;
    footerView.autoresizingMask = UIViewAutoresizingFlexibleWidth;
    footerView.userInteractionEnabled = YES;

    footerView.hidden = NO;
    footerView.multipleTouchEnabled = NO;
    footerView.opaque = NO;
    footerView.contentMode = UIViewContentModeScaleToFill;

    // Add the label
    UILabel*    footerLabel = [[UILabel alloc] initWithFrame:CGRectMake(150.0, -5.0, 120.0, 45.0)];
    footerLabel.backgroundColor = [UIColor clearColor];
    footerLabel.opaque = NO;
    footerLabel.text = @"Sharing";
    footerLabel.textColor = [UIColor tableHeaderAndFooterColor];
    footerLabel.highlightedTextColor = [UIColor tableHeaderAndFooterColor];
    footerLabel.font = [UIFont boldSystemFontOfSize:17];
    footerLabel.shadowColor = [UIColor whiteColor];
    footerLabel.shadowOffset = CGSizeMake(0.0, 1.0);
    [footerView addSubview: footerLabel];

    [footerLabel release];  

    // Add the switch
    UISwitch* footerSwitch = [[UISwitch alloc] initWithFrame:CGRectMake(215.0, 5, 80.0, 45.0)];
    [footerView addSubview: footerSwitch];

    // Return the footerView
    return footerView;
  }
  else return nil;
}
// Need to call to pad the footer height otherwise the footer collapses
- (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section {
  switch (section) {
    case 0:
    case 1:
      return 40.0;
    default:
      return 0.0;
  }
} 
```

我希望这是正确的，如果这对其他人有帮助，请投票。干杯!

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-16T02:34:45.120

我认为你需要自动释放 uiview-

# ruby-on-rails - 为什么我从 Flash 上传到 Rails & attachment_fu 不起作用（它与内容类型有关）？

> ID：838268
> 
> 赞同：1
> 
> 时间：2009-05-08T04:39:50.630
> 
> 标签：ruby-on-rails, ruby, flash, content-type, attachment-fu

我正在尝试将文件从 flash 小部件上传到我的 rails 应用程序，该应用程序使用 attachment_fu 来处理上传的图像。我使用 Flash 上传，因为它可以轻松选择和上传多个文件。`save!`但是，当 rails 控制器尝试调用新创建的 ActiveRecord 对象时，我收到此错误：

```
ActiveRecord::RecordInvalid (Validation failed: Content type is not included in the list):
    /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.0.2/lib/active_record/validations.rb:946:in `save_without_transactions!'
    /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.0.2/lib/active_record/transactions.rb:112:in `save!'
    /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.0.2/lib/active_record/connection_adapters/abstract/database_statements.rb:66:in `transaction'
    /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.0.2/lib/active_record/transactions.rb:80:in `transaction'
    /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.0.2/lib/active_record/transactions.rb:100:in `transaction'
    /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.0.2/lib/active_record/transactions.rb:112:in `save!'
    /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.0.2/lib/active_record/transactions.rb:120:in `rollback_active_record_state!'
    /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.0.2/lib/active_record/transactions.rb:112:in `save!'
    /app/controllers/photos_controller.rb:13:in `create'
    /usr/local/lib/ruby/gems/1.8/gems/actionpack-2.0.2/lib/action_controller/base.rb:1158:in `send'
    /usr/local/lib/ruby/gems/1.8/gems/actionpack-2.0.2/lib/action_controller/base.rb:1158:in `perform_action_without_filters'
    /usr/local/lib/ruby/gems/1.8/gems/actionpack-2.0.2/lib/action_controller/filters.rb:697:in `call_filters'
    /usr/local/lib/ruby/gems/1.8/gems/actionpack-2.0.2/lib/action_controller/filters.rb:689:in `perform_action_without_benchmark'
    /usr/local/lib/ruby/gems/1.8/gems/actionpack-2.0.2/lib/action_controller/benchmarking.rb:68:in `perform_action_without_rescue' 
```

因此，似乎没有正确发送内容类型。事实上，Flash 发送的内容类型是`application/octet-stream`，我希望它是`image/png`（对于这个特定的测试用例）。

我执行上传的 ActionScript 3.0 代码如下所示：

```
var request:URLRequest = new URLRequest(paramObj.serverUrl + "/albums/" + paramObj.albumId + "/photos");
var variables:URLVariables = new URLVariables();
variables["photo[title]"] = file.name;
variables["authenticity_token"] = paramObj.authenticity_token;
variables["commit"] = "Upload Photo";
request.data = variables;
request.method = URLRequestMethod.POST;
file.upload(request, 'photo[uploaded_data]'); 
```

表单参数都存在于您期望从常规浏览器上传中获得的 Flash 上传中。运行数据包嗅探器后，我能看到的唯一真正区别是内容类型不同。

该模型使用 attachment_fu，如下所示：

```
class Photo < ActiveRecord::Base
  belongs_to :album

  has_attachment :content_type => :image, 
                 :storage => :file_system, 
                 :max_size => 10.megabytes, 
                 :thumbnails => { 
                   :thumb  => '100x100>',  
                   :large  => '800x600>', 
                 } 

  validates_as_attachment
end 
```

那么，如何修复 flash 发送的内容类型呢？而且，为什么 attachment_fu 信任浏览器发送的内容类型，而不是使用[幻数](http://en.wikipedia.org/wiki/Magic_number_(programming)#Magic_numbers_in_files)或其他东西自行确定？

我注意到，如果我删除`:content_type => :image`或`validates_as_attachment`，或者如果我将控制器更改为 call `save(false)`，则会创建对象，但 attachment_fu 不会完成调整图像大小的工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T15:25:23.707

不幸的是，Flash 上传总是以内容类型“application/octet-stream”发送。可能最简单的解决方法是使用[mimetype_fu](http://code.google.com/p/mimetype-fu/)在 before_validation 回调中猜测 mimetype。 [Paperclip](http://thoughtbot.com/projects/paperclip)内置了此功能。

另一种选择是覆盖 is_image? 使用您的图像处理器来实际确定文件是否是图像（例如，在 rmagick 中，您可以打开它并查看它是否有任何图层）。这绝对是一个资源密集型解决方案，但它确保您接受所有可以处理的文件，而不是其他文件。

# javascript - IE 中的 javascript void(0) 问题

> ID：838275
> 
> 赞同：3
> 
> 时间：2009-05-08T04:45:04.813
> 
> 标签：javascript, internet-explorer

你好，

我正在使用 asp.net 开发一个网页。

我在我的网页中使用了一些链接。为此，我使用了一些这样的代码。

```
<a href="javascript:void(0);" onclick="javascript:ChangeLoc('TEST','');">Test</a> 
```

并在`ChangeLoc()`我写`__doPostBack`事件的方法中。

这在我机器上安装的 IE7 中运行良好。但在另一台机器的 IE6 中它不会调用该`__doPostBack`事件。

**编辑**

当我更改 href 中的 void(0) 时，它工作正常。

我想知道这是 IE 的错误还是 JavaScript 的问题。

```
function ChangeLoc( param, arg )
{
     __doPostBack ( param, arg )
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-08T04:56:06.270

当您单击一个元素时，href 和 onclick 都会被触发，您正在使用 void() 覆盖 onclick 事件

改成

```
<a href="#" onclick="ChangeLoc();return false">test</a> 
```

或使用 jQuery。

```
$(function(){
  $("#linkId").click(function(event){
      ChangeLoc();
      event.preventDefault();
  });
}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T04:51:37.293

你有错误吗？如果是这样，您在 IE6 中遇到什么错误？您可以发布 ChangeLoc() 的代码吗？另外，尝试将标记更改为以下内容，看看是否得到相同的结果：

```
<a href="#" onclick="ChangeLoc(); return false;">Test</a> 
```

**编辑：**从 onclick 中删除了 'javascript:'

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T07:30:35.353

您还可以使用不显眼的 javascript 语法：

```
<a href="index.html" id="chngLink">test</a>

<script type="text/javascript">
document.getElementById("chngLink").onclick = function(e) {
    if (e && e.preventDefault) {
        e.preventDefault();
    }
    ChangeLoc('TEST','');
    return false;
};
</script> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-08T05:28:38.173

`<a>`对javascript函数调用使用-element不好。使用样式`<span onclick="my_function()" class="looks_like_hyperlink">...</span>`

# c++ - 需要将字符串存储为一些快速数据结构中对象的 id

> ID：838290
> 
> 赞同：-1
> 
> 时间：2009-05-08T04:53:26.540
> 
> 标签：c++, c, algorithm, hash, map

我正在为 Web 服务器实现会话存储。键是字符串，存储的对象是指针。我尝试使用地图，但需要更快的东西。我查找对象的频率是插入的 5-20 倍。

我尝试使用哈希映射但失败了。我觉得我有更多的限制而不是更多的空闲时间。

我在 Linux 下编写 c/c++。我不想承诺提升，因为我的网络服务器将比提升更长寿。:)

这是一个高度相关的问题，因为硬件（ssd 磁盘）正在迅速变化。正确的解决方案不会在 2 年内出现。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T04:58:37.013

我打算建议一个`map`，但我看到你已经排除了这个。

> 我尝试使用地图，但需要更快的东西。

这些是[维基百科页面](http://en.wikipedia.org/wiki/Map_(C%2B%2B_container))提供的 std::map 性能界限：

*   搜索一个元素需要 O(log n) 时间
*   插入一个新元素需要 O(log n) 时间
*   递增/递减迭代器需要 O(log n) 时间
*   遍历地图的每个元素需要 O(n) 时间
*   删除单个地图元素需要 O(log n) 时间
*   复制整个地图需要 O(n log n) 时间。

您如何衡量并确定地图没有为您充分优化？您看到的任何瓶颈很可能存在于代码的其他部分，并且 a`map`完全足够了。

除了最严格的可扩展性要求之外，上述界限似乎都可以满足。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T05:08:52.837

将使用的数据结构类型将由您要访问的数据决定。你应该问的一些问题：

1.  会话存储中将有多少项目？50？10万？10000000000？
2.  商店中的每个项目有多大（字节大小）？
3.  键使用什么样的字符串输入？ASCII-7？UTF-8？UCS2？...

哈希表通常在查找方面表现得非常好。您可以通过自己编写它们来极大地优化它们以提高速度（是的，您可以调整表格的大小）。使用哈希表提高性能的建议：

1.  选择一个好的哈希函数！这将最好在您的哈希表中均匀分布，并且计算时间不会很长（这将取决于键输入的格式）。
2.  确保如果您使用的桶的长度不超过 6。如果您确实超过 6 个桶，那么您的哈希函数可能分布不够均匀。< 3 的桶长度是优选的。
3.  注意你如何分配你的对象。如果可能的话，尝试在内存中彼此靠近分配它们以利用引用的局部性。如果需要，请编写自己的子分配器/堆管理器。还要保持对齐边界以获得更好的访问速度（对齐取决于处理器/总线，因此您必须确定是否要针对特定​​的处理器类型）。

BTrees 也非常好，总体上表现良好。（有人可以在此处插入有关 btree 的信息）。

我建议查看您存储的数据并确保数据尽可能小。根据需要使用短裤、无符号字符、位字段。还有其他其他方法可以提高性能，例如在分配结构的同时在结构的末尾分配字符串数据。IE

```
struct foo {
  int a;
  char my_string[0]; // allocate an instance of foo to be 
                     // sizeof(int) + sizeof(your string data) etc
} 
```

您可能还会发现实现自己的字符串比较例程实际上可以显着提高性能，但这取决于您的输入数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T04:56:59.280

可以自己制作。但是你不应该对 boost 或 std::tr1::unordered_map 有任何问题。

对于较少数量的元素，三元树可能比散列图更快。

# sharepoint - SharePoint：用户上次访问后添加/更新的查询列表项

> ID：838295
> 
> 赞同：0
> 
> 时间：2009-05-08T04:55:46.880
> 
> 标签：sharepoint, list

我们需要获取用户上次访问后添加/更新的项目。
我们需要来自同一网站下 3 个单独列表的信息。
有关如何完成此操作的指针将非常有帮助（SharePoint 是否为此提供了任何 API）。

亲切的问候，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T05:34:06.553

按修改日期过滤很简单，尽管方法取决于视图的类型——棘手的部分是获取上次登录时间——你可能需要一些自定义代码来保存它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T05:39:15.620

蛮力将在每个版本上运行 foreach，直到您达到用户上次登录日期之前的版本，然后在每个列表项上执行此操作，然后在每个列表上再次执行此操作。您可以通过查看版本之间的更改来了解哪些字段以这种方式更改。您可以通过仅查询自用户上次登录以来修改日期的项目来缩小要执行此操作的项目集

至于查找用户上次登录，对不起，我可以为此提出任何建议。我以前没有找过它。

# .net - 使用 WCF 的 WebGet 属性时如何捕获 HTTP 错误？

> ID：838297
> 
> 赞同：1
> 
> 时间：2009-05-08T04:56:08.267
> 
> 标签：.net, wcf, http, rest

我正在使用 [WebGet] 属性来查询 Web 服务器上的 REST API。每隔一段时间（因为 API 仍在开发中），我会以 HTTP/500 错误的形式返回 HTML 文档，而不是我想要的 XML。

这是我的操作合同的一个例子：

```
[WebGet(UriTemplate = "search/?api_key={key}&query={query}",
   BodyStyle = WebMessageBodyStyle.Bare)]
[OperationContract]
XElement Find(string key, string query); 
```

...这就是我所说的：

```
var factory = new WebChannelFactory<IFooFinder>(
    new Uri("http://api.example.com"));
var channel = factory.CreateChannel();
var results = channel.Find(myApiKey, "foo"); 
```

如果发生错误，“结果”最终会成为包含此 XML 的 XElement：

```
<html>
    <head></head>
    <body>
        500 Internal Server Error
    </body>
</html> 
```

有没有办法在返回 XML 之前捕获 500 错误，并让通道抛出异常之类的？还是我每次都必须检查结果变量以确保我期望的 XML 在那里？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T05:16:26.393

不，您不能真正抛出异常或 SOAP 错误，因为您真正拥有的只是 HTTP。因此，如果您的服务失败，它可以将其传达回 HTTP 客户端的唯一方法是通过 HTTP 状态代码。

您可以尝试使代码更有意义，例如不要总是返回 500，而是将其拆分为更多细节，或者您可以包含更多描述性错误消息（至少对于开发和测试而言）以提示您出了什么问题.

但基本机制是：你只使用 HTTP 来获取 GET，你只有 HTTP 来返回状态和错误代码。

马克

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T12:49:35.000

如果您将服务器上的状态代码设置为错误代码，那么我希望客户端将其映射到异常。我知道如果 System.Net.HttpWebRequest 获得 400 或 500 系列状态代码，它会在客户端上引发 WebException。

在服务器端，如果您不想在每个服务实现方法中添加 try catch 块，那么您将不得不替换 System.ServiceModel.Web 提供的标准错误处理程序。

我有通过创建一个新的派生 WebHttpBehaviour 并重载 AddServerErrorHandlers 来防止应用默认错误处理程序的代码。然后，您需要添加错误处理程序，该处理程序将通过在实现 IServiceBehavior 的新行为中使用 ApplyDispatchBehavior 来设置状态代码。

可能有更简单的方法。在 WCF 中似乎有 1001 种剥同一只猫的方法。

# sql-server - sqlserver 在连接关闭后保持连接活动多长时间？

> ID：838302
> 
> 赞同：2
> 
> 时间：2009-05-08T04:59:15.310
> 
> 标签：sql-server, connection

在 asp.net/Sqlserver 项目中，我们使用 ado.net（sql 身份验证）创建连接，我们看到有很多处于“睡眠”、“等待命令”状态的活动连接的行为

代码执行以下操作 - 从通用函数获取连接、更新数据库、提交事务、关闭和处置事务、关闭连接。

1）在 sqlserver 2008 中，当我们的程序运行一段时间（它每隔几秒更新一次数据库），活动连接数急剧增加，sqlserver 开始拒绝新连接（因为默认连接数为 100） 2）在 sqlserver 2005 中，我们看到连接被重用并且工作正常。我们的最大连接数不超过 15-20。

我们在 2008 年从 MSFT 发现了一个问题并传达给了客户。 [https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=383517](https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=383517) - 谈论 2008 年没有立即释放关闭的连接。

在客户端，我们在 sql2005 中也看到了同样的问题。

我的问题是，当 .net 程序在连接上调用 close() 时，sqlserver 保持它活动多长时间？

非常感谢任何提示

问候阿南德

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T08:07:06.013

连接将进入池。如果它们没有从那里重用，并且连接数量增加，那么您肯定没有正确清理它们。将`using`块用于任何一次性类型（也包括事务、命令等）。

要清除连接池，您可以调用此静态方法：

```
SqlConnection.ClearAllPools(); 
```

这应该删除所有连接并且*不在*池中使用。其他的还在使用中。

# fortran - Fortran 90 种参数

> ID：838310
> 
> 赞同：46
> 
> 时间：2009-05-08T05:03:08.343
> 
> 标签：fortran

我无法理解 Fortran 90 的`kind`参数。据我所知，它不能确定变量的精度（即浮点数或双精度），也不能确定变量的类型。

那么，它决定了什么，它到底是为了什么？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-05-13T05:41:35.457

变量的种类是一个整数标签，它告诉编译器它应该使用它支持的种类。

请注意，尽管KIND 参数*通常*与存储在该 KIND 变量中的字节数相同，但Fortran 标准*并不要求*它。

也就是说，在很多系统上，

```
REAl(KIND=4) :: xs   ! 4 byte ieee float
REAl(KIND=8) :: xd   ! 8 byte ieee float
REAl(KIND=16) :: xq   ! 16 byte ieee float 
```

但可能有编译器，例如：

```
REAL(KIND=1) :: XS   ! 4 BYTE FLOAT
REAL(KIND=2) :: XD   ! 8 BYTE FLOAT
REAL(KIND=3) :: XQ   ! 16 BYTE FLOAT 
```

对于整数和逻辑类型也是如此。

（如果我去挖掘，我可能会找到示例。搜索 usenet 组 comp.lang.fortran`kind`以查找示例。关于 Fortran 的最有见地的讨论发生在那里，一些经验丰富的人做出了贡献。）

所以，如果你不能指望一个特定的类型值在不同的平台上给你相同的数据表示，你会怎么做？这就是内在功能`SELECTED_REAL_KIND`和`SELECTED_INT_KIND`用途。基本上，你告诉函数你需要能够表示什么样的数字，它会返回你需要使用的那种。

我通常使用这些类型，因为它们通常给我 4 字节和 8 字节实数：

```
!--! specific precisions, usually same as real and double precision
integer, parameter :: r6 = selected_real_kind(6) 
integer, parameter :: r15 = selected_real_kind(15) 
```

所以我可能随后将一个变量声明为：

```
real(kind=r15) :: xd 
```

请注意，这可能会导致您使用混合语言程序时出现问题，并且您需要绝对指定变量占用的字节数。如果您需要确定，有查询内在函数会告诉您每种类型，您可以从中推断出变量的内存占用、其精度、指数范围等。或者，您可以恢复为非标准但司空见惯的`real*4`, `real*8`etc 声明风格。

当您开始使用新的编译器时，有必要查看编译器特定的类型值，以便了解您正在处理的内容。在网上搜索`kindfinder.f90`一个方便的程序，它会告诉你编译器可用的种类。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2015-05-26T15:16:03.777

我建议使用 Fortran 2008 及更高版本；`INT8, INT16, INT32, INT64, REAL32, REAL64, REAL128`. 这是通过调用`ISO_FORTRAN_ENV`Fortran 2003 及更高版本来完成的。种类参数提供了不一致的方式来确保您始终获得适当数量的位表示

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-05-24T20:40:16.360

只是扩展其他（非常好的）答案，特别是[Andrej Panjkov](https://stackoverflow.com/a/856243/2938526)的答案：

> 变量的种类是一个整数标签，它告诉编译器它应该使用它支持的种类。

确切地。即使对于所有**数字内在**类型，KIND 参数用于指定“*处理器上数字表示和行为的模型*”（来自标准第 16.5 节的词），实际上意味着它们的位模型，这不是 KIND 参数可能代表的唯一内容。

类型的 KIND 参数是其性质、模型或行为的**任何变化**，可供程序员在编译时选择。例如，对于固有字符类型，kind 参数表示处理器上可用的字符集（ASCII、UCS-4、...）。

你甚至可以在你定义的派生类型上定义你自己的模型/行为变体（从 Fortran 2003 之后）。您可以创建一个 Transform Matrix 类型，并为 2D 空间（其中基础数组为 3x3）和 KIND=3 的 3D 空间（具有 4x4 基础数组）提供 KIND=2 的版本。请记住，非固有类型没有自动类型转换。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T20:30:08.857

From the *Portland Group Fortran Reference*, the `KIND` parameter "specifies a precision for intrinsic data types." Thus, in the declaration

```
real(kind=4) :: float32
real(kind=8) :: float64 
```

the variable `float64` declared as an 8-byte real (the old Fortran `DOUBLE PRECISION`) and the variable `float32` is declared as a 4-byte real (the old Fortran `REAL`).

This is nice because it allows you to fix the precision for your variables independent of the compiler and machine you are running on. If you are running a computation that requires more precision that the traditional IEEE-single-precision real (which, if you're taking a numerical analysis class, is very probable), but declare your variable as `real :: myVar`, you'll be fine if the compiler is set to default all `real` values to double-precision, but changing the compiler options or moving your code to a different machine with different default sizes for `real` and `integer` variables will lead to some possibly nasty surprises (e.g. your iterative matrix solver blows up).

Fortran also includes some functions that will help pick a `KIND` parameter to be what you need - `SELECTED_INT_KIND` and `SELECTED_REAL_KIND` - but if you are just learning I wouldn't worry about those at this point.

Since you mentioned that you're learning Fortran as part of a class, you should also see this question on [Fortran resources](https://stackoverflow.com/questions/723851/fortran-90-resources) and maybe look at the reference manuals from the compiler suite that you are using (e.g. Portland Group or Intel) - these are usually freely available.

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2021-07-23T07:53:24.453

kind 的用途之一可能是确保对于不同的机器或操作系统，它们真正使用相同的精度并且结果应该相同。所以代码是可移植的。例如，

```
integer, parameter :: r8 = selected_real_kind(15,9) 
real(kind=r8) :: a 
```

现在这个变量 a 始终是 r8 类型，这是一个真正的“双精度”（因此它在电子计算机上占用 64 位内存），无论代码在什么机器/操作系统上运行。

此外，因此您可以编写如下内容，

```
a = 1.0_r8 
```

这个 _r8 确保将 1.0 转换为 r8 类型。

* * *

## 回答 #6

> 赞同：-8
> 
> 时间：2019-05-23T00:29:39.297

总结其他答案： kind 参数指定了固有数据类型（例如整数和实数）的存储大小（因此间接地指定了精度）。

但是，现在推荐的方法不是在源代码中指定变量的种类值，而是使用编译器选项来指定我们想要的精度。例如，我们在代码中编写：`real :: abc`然后使用编译选项`-fdefault-real-8`（对于 gfortran）指定一个 8 字节浮点数来编译代码。对于 ifort，对应的选项是`-r8`。

更新：

似乎这里的 Fortran 专家强烈反对上述推荐的方式。尽管如此，我仍然认为上述方法是一种很好的做法，有助于减少在 Fortran 代码中引入错误的机会，因为它保证您在整个程序中使用相同的种类值（您确实需要使用不同的代码不同部分的种类值很少），从而避免了函数调用中虚拟参数和实际参数之间种类值不匹配的常见错误。

# sql-server - 通过电子邮件（作为附件）发送信息路径表单以供 SQL Server 2005 解析？

> ID：838315
> 
> 赞同：2
> 
> 时间：2009-05-08T05:07:36.023
> 
> 标签：sql-server, infopath

只看一个新项目的需求，我想确保这个用例是合理的：

*   用户在其 PC 上本地填写 InfoPath (2003) 表单
*   InfoPath 表单中标题为“提交”的按钮会显示一个新的 Outlook (2003) 电子邮件，并附有 infopath 表单。用户按下发送并将电子邮件发送到交换邮箱。
*   sql server 定期检查此邮箱，下载任何新提交并附上 infopath 表单
*   sql server 解析附件和 infopath 表单中的字段。

SQL Server 是否能够以这种方式解析邮件附件？这种方法有什么注意事项吗？

使用 Outlook 作为提交技术的吸引力在于，如果用户处于脱机状态，则其处理过程是相同的。然后，Outlook 将在它们重新联机时自动同步。用户必须通过某种方式离线填写表格，“提交”它们，然后在下次上线时自动与服务器同步。

编辑：澄清一下，我不是在寻找一种从服务器->客户端缓存表单数据的方法。我正在寻找缓存完成的表格。构建单独的应用程序以在客户端缓存已完成的报告不是一种选择。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T04:21:12.643

我不会使用您上面概述的方法。在我看来，有几种方法比让 SQL Server 查看 Exchange 邮箱更可取。您提出的要点和重要要求是允许 InfoPath 表单在脱机模式下工作。我会将项目的“离线模式”和“数据传输”部分视为两个不同且独立的部分：1）表单和数据应存储在客户端上，直到可以连接到 Internet 和 2）一旦连接可用，表单和数据应传输到服务器。

您可以将 InfoPath 表单设置为直接提交到 SQL Server 并完全绕过 Exchange“中间人”。设计表单时 InfoPath 中的设置非常简单：1) 为连接启用“提交数据”，2) 配置提交选项。本文详细[介绍](http://office.microsoft.com/en-us/infopath/HP101070601033.aspx)了如何执行此操作。此外，您与 SQL Server 的连接可以设置为离线使用，如[本文所述](http://office.microsoft.com/en-us/infopath/HA102117391033.aspx)。这种方法唯一需要注意的是，您可能需要更改数据库模式以支持它。

另一种方法是让您的 InfoPath 表单提交到 SQL Server 2005 HTTP 端点。InfoPath 客户端只是一个美化的 XML 编辑器，而 HTTP 端点基本上是 Web 服务的不同名称。您在 HTTP 端点将表单数据接收到临时表中，其中数据存储为 XML，然后您可以从该临时区域解析该数据。您仍然必须设置 InfoPath 连接以供离线使用。这种方法的主要警告是微软将在 SQL Server 2008 中弃用 HTTP 端点，转而支持 WCF。

我想建议的另一种方法是使用 WCF 本身从 InfoPath 客户端接收 XML 表单数据。这种方法需要您在设计时将表单的数据源连接到您的 WCF Web 服务，然后还要设置表单以供离线使用。

我希望这对您有用，至少可以为您指明正确的方向。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T15:53:44.967

更高版本的 SQL Server 能够在其中运行 .NET 代码，因此您可以从 SQL Server 轮询邮箱并处理 InfoPath 表单。但是，我不确定我会这样做。

考虑编写一个可以完成这项工作的 Windows 服务可能会更好。Windows 服务将启动，检查“服务帐户”的邮箱，阅读邮件，提取附件，处理 xml，并最终将数据写入 SQL。如果发生业务规则或验证错误，它还可以用确认或错误来响应该邮件。

我不确定我是否会将上述所有逻辑都放入 SQL 中 - 一方面，我怀疑您的帐户有问题（必须让帐户 SQL 在能够访问 Exchange 邮箱帐户下运行）。

您的里程可能会有所不同，您应该对此进行原型设计以确定最适合您的方式，但我会尝试将使用 Exchange 的代码作为“工作队列”与 SQL 分开，并且只将处理写入数据的代码放入SQL 中的表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-17T20:32:52.010

我见过类似的项目，它们在客户端使用 Express 版本，将信息路径（或应用程序数据）保存在 Express 中并使用 Service Broker 传递到中心，因为 SSB 与邮件的保证传递语义。这为您提供了一个更容易向 IT 销售的全 SQL 解决方案，并且您不需要在服务器上进行轮询。此外，您不必处理 MIME 解析，所有这些都是直接的 XML 处理。但这并不适合胆小的人，让 SSB 启动并运行是一项挑战。如果您决定使用邮件传递，可以说外部服务将更容易构建、调试和故障排除。您应该回答一些更精细的问题：- 您将如何保持邮件出列操作和表写入操作的一致性？您的组件必须将 Exchange 读取/删除和 SQL 插入到一个分布式事务中。- 您的逻辑是否准备好处理出现故障的 infopath 文档？邮件传输绝对不能保证交付顺序，因此您可能会在“订单创建”文档之前看到“订单删除”文档 - 您将如何检测丢失的文档（不是通过邮件交付）？您是否要实现发送者序列号并最终在邮件之上重新发明 TCP？- 您的处理是否允许并行处理相关文档？如果线程 1 接收到 doc 1，线程 2 从同一个发送者那里接收到 doc 2，并且 doc 2 与 doc 1 相关联（即指同一个业务交易），数据库写入会发生什么？它会死锁，它会失去更新，会回滚吗？

前面桥下有很多龙……

# linux - 如何在不使用 lsof 或 netstat 的情况下将网络连接绑定到 PID？

> ID：838317
> 
> 赞同：9
> 
> 时间：2009-05-08T05:08:28.173
> 
> 标签：linux, networking, solaris, pid

有没有办法在不分叉到 lsof 或 netstat 的情况下将网络连接绑定到 PID（进程 ID）？

目前 lsof 用于轮询哪些连接属于哪个进程 ID。但是 lsof 或 netstat 在繁忙的主机上可能会非常昂贵，并且希望避免使用这些工具。

是否有类似于 /proc/$pid 的地方可以查找此信息？我通过检查 /proc/net 知道网络连接是什么，但无法弄清楚如何将其与 pid 联系起来。在 /proc/$pid 中，似乎没有任何网络信息。

目标主机是 Linux 2.4 和 Solaris 8 到 10。如果可能的话，Perl 中的解决方案，但我愿意做 C/C++。

**补充说明：**

我想强调这里的目标是将网络连接绑定到 PID。获得其中一个是微不足道的，但是以低成本的方式将两者结合起来似乎很困难。感谢您到目前为止的答案！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T06:11:43.903

我不知道您需要多久进行一次轮询，或者您所说的“昂贵”是什么意思，但是两者都有正确的选项`netstat`并且`lsof`运行速度比默认配置快得多。
例子：

```
netstat -ltn 
```

仅显示**l** istening **t** **cp**套接字，并省略默认打开的（慢）名称分辨率。

```
lsof -b -n -i4tcp:80 
```

省略所有**b**锁定操作、名称解析，并将选择限制为端口 80 上的 IPv4 tcp 套接字**。**

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-22T21:47:00.263

在 Solaris 上，您可以使用它`pfiles(1)`来执行此操作：

```
# ps -fp 308 
     UID   PID  PPID   C    STIME TTY         TIME CMD
    root   308   255   0 22:44:07 ?           0:00 /usr/lib/ssh/sshd
# pfiles 308 | egrep 'S_IFSOCK|sockname: '
   6: S_IFSOCK mode:0666 dev:326,0 ino:3255 uid:0 gid:0 size:0
        sockname: AF_INET 192.168.1.30  port: 22 
```

对于 Linux，这更复杂（可怕）：

```
# pgrep sshd
3155
# ls -l /proc/3155/fd | fgrep socket
lrwx------ 1 root root 64 May 22 23:04 3 -> socket:[7529]
# fgrep 7529 /proc/3155/net/tcp 
   6: 00000000:0016 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 7529 1 f5baa8a0 300 0 0 2 -1 
```

`00000000:0016`是`0.0.0.0:22`。这是来自的等效输出`netstat -a`：

```
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T05:40:34.853

你为什么不看一下*netstat*的源代码，看看它是如何获取信息的？它是开源的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T05:56:21.100

对于 Linux，查看`/proc/net`目录（例如，`cat /proc/net/tcp`列出您的 tcp 连接）。不确定 Solaris。

更多信息[在这里](http://www.linuxdevcenter.com/pub/a/linux/2000/11/16/LinuxAdmin.html)。

我猜 netstat 基本上使用了完全相同的信息，所以我不知道你是否能够加快速度。请务必尝试使用 netstat '-an' 标志以不实时将 ip 地址解析为主机名（因为由于 dns 查询，这可能需要很多时间）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T06:04:58.430

最简单的做法是

```
strace -f netstat -na 
```

在 Linux 上（我不了解 Solaris）。这将为您提供所有系统调用的日志。这是很多输出，其中一些是相关的。查看它正在打开的 /proc 文件系统中的文件。这应该会引导您了解 netstat 是如何做到的。不雅地，ltrace 将允许您通过 c 库做同样的事情。在这种情况下对您没有用，但在其他情况下可能很有用。

如果不清楚，请查看源代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-30T04:08:35.803

看看这些彻底探索可用选项的答案：

*   [如何获取与打开它们的应用程序关联的端口？](https://stackoverflow.com/questions/3306138/how-i-can-get-ports-assosiated-to-aplication-that-oppened-them/3308198#3308198)
*   [如何像“netstat -p”一样做，但更快？](https://stackoverflow.com/questions/4056850/how-to-do-like-netstat-p-but-faster/4057150#4057150)

# asp.net - 如何保持 AppDomain 中的 ASP.NET 程序集处于活动状态？

> ID：838318
> 
> 赞同：50
> 
> 时间：2009-05-08T05:08:28.750
> 
> 标签：asp.net, iis, assemblies, appdomain, application-pool

**场景：**我有一个使用 Web 部署项目部署的 n 层企业 ASP.NET 应用程序。所有层都生成由 ASP.NET 应用程序使用的独立程序集。

**问题：**当我运行应用程序时。部署后第一次需要花费大量时间将依赖程序集加载到内存中。但是一旦加载了它的快速照明应用程序。如果没有用户访问该应用程序，IIS 会从内存中卸载程序集，当用户尝试在以后的实例上访问该应用程序时，它会再次加载所有程序集，加载时间与加载时间相同第一次这样做。

**我正在寻找一种解决方案，使我能够将我的程序集持久地加载到内存中，从而覆盖程序集对内存驻留的易失性。**

或任何其他让我的用户愉快地使用解决上述问题的应用程序的解决方案。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-05-08T05:23:23.460

在**IIS 6**中，转到 Application Pools 部分，然后在托管相关 ASP.NET 应用程序的池上右键单击 > Properties。转到性能选项卡并取消选中“空闲后关闭工作进程：”

在**IIS 7**中，转到“连接”窗格并找到“应用程序池”，然后为托管应用程序的池选择“高级设置”。找到“空闲超时”属性并将其设置为“0”（这将禁用它）。

默认值为 20 分钟不活动。通过取消选中该框，一旦您的[AppDomain](http://www.odetocode.com/articles/305.aspx)被[工作进程](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/29f53968-0115-451f-b26d-5ad58d87b5d1.mspx?mfr=true)加载，它将永远不会死亡（除非您杀死进程或其他东西）。默认情况下，IIS 会在进程达到某个限制（例如内存上限）时[回收该进程](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/24e3c22e-79a9-4f07-a407-dbd0e7f35432.mspx?mfr=true)，但它也会启动一个新进程并“逐步处理”所有传入请求，直到旧请求未被使用，以最大程度地减少中断。

我还编写了一个小的 c# 类，它可以[让您的 ASP.NET 应用程序](http://www.rexmorgan.net/journal/fixing_aspnet_ldquokeep)在正常情况下保持活跃（[备用存档版本）。](http://web.archive.org/web/20100213092317/http://www.rexmorgan.net/journal/fixing_aspnet_ldquokeep)由于它在应用程序中运行，显然它不能阻止 IIS 或其他任何东西显式杀死进程，但它会保持应用程序“热”，例如应用程序永远不会空闲足够长的时间让 IIS 决定关闭它.

如果您无法直接控制您的 IIS 配置（例如共享主机），那么最好的办法是让一个小型应用程序在单独的系统上运行 - 例如，永远在线的工作站 - 每 x 分钟访问您的站点以保持应用程序池超时。没什么特别的——一个简单的[WebRequest](http://msdn.microsoft.com/en-us/library/system.net.webrequest.aspx)和一个控制台应用程序中的 while() 循环就可以了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-07-18T16:38:34.757

One of the advantages of ASP .net is the posibility to create static (shared) instances of objects.

To avoid the necessity of an external process you can create an static timer in (per example) global.asax which calls for a page on the domain with a simple WebRequest. On this way the site keeps alive himself until a manual reset of the pool is done.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-03T04:30:05.803

I wrote a little C# console application that keeps my 4 sites alive every 10 mins via windows task scheduler. Life is once again good. We do not run the app from 2-5am just so the serves can do any cleanups of memory, if it even matters. for our sites there is rarely anyone on at those hours anyway.

# ruby-on-rails - Ruby on Rails：链接更新数据库

> ID：838332
> 
> 赞同：1
> 
> 时间：2009-05-08T05:14:54.993
> 
> 标签：ruby-on-rails, ruby

简单的 RoR 问题...我正在学习 ROR 并正在制作一个简单的投票应用程序。候选人列在表格中，并在他们的名字旁边有赞成/反对的链接。我正在努力做到这一点，所以用户所做的就是单击链接，更新投票计数，并将它们重定向到初始页面。我没有使用脚手架。由于某种原因，此操作没有做任何接近我想要的事情：

```
def upvote
  @name = Name.find(params[:id])
  @name[:votes] += 1
  respond_to do |format|
    if @name.update_attributes(params[:name])
      flash[:notice] = 'Candidate was upvoted'
      format.html = { redirect_to :action => "index" }
      format.xml = { head :ok }
    else
      format.html = { render :action => "index" }
      format.xml = { render :xml => @name.errors, :status => :unprocessable_entity }
    end
  end
end 
```

我确实有视图中的链接调用正确的操作，但它正在尝试调用：show。

请不要太严厉地评价我lol...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T05:25:02.003

该`update_attributes`方法通常用于从表单 POST 设置 ActiveRecord 对象的字段。这些字段将作为散列找到`params[:name]`，例如`params[:name][:votes]`.

如果您单击链接来调用该`upvote`方法，那么您只是在执行 GET 请求。您需要做的就是调用`@name.save`保存记录。

```
def upvote
  @name = Name.find(params[:id])
  @name[:votes] += 1
  respond_to do |format|
    if @name.save
      flash[:notice] = 'Candidate was upvoted'
      format.html = { redirect_to :action => "index" }
      format.xml = { head :ok }
    else
      format.html = { render :action => "index" }
      format.xml = { render :xml => @name.errors, :status => :unprocessable_entity }
    end
  end
end 
```

**编辑：**从评论中，我们还确定路由设置不正确，并且`link_to`视图中的代码需要包含`@name.id`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T06:58:55.600

通常映射到显示的 RESTful URL 是：

```
my_resource/id 
```

所以，例如，

```
candidates/1 
```

只是猜测，我敢打赌，如果你查看 config/routes.rb，你会发现类似：

```
map.resources :candidates 
```

其中 my_resource 是您的控制器的名称。如果您要使用这种路由，那么资源如何提供支持？在这种情况下，自定义方法似乎很明智，因此：

```
map.resources :candidates, :collection => { :upvote => :post } 
```

如果你跑

```
rake routes | grep candidate 
```

之前和之后，您可以看到添加了什么。希望这可以帮助。

# sql - 如何从 C 程序执行 sql 语句？

> ID：838341
> 
> 赞同：2
> 
> 时间：2009-05-08T05:18:23.843
> 
> 标签：sql, c, stored-procedures

如何从 C 程序执行 SQL 语句。例如我想显示的输出

`select * from EMP`

来自 ac 程序。我需要使用存储过程吗？我需要任何库文件吗？我的 C 编译器是 Tiny C Compiler，我目前正在使用 SQL Server Studio 2005。还邀请了 Unix/AIX 平台 + GCC 的建议。

提前致谢..

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T05:35:22.447

对于 *ix 和 Windows 以及所有（重要的）数据库服务器，旧但可靠的解决方案是[ODBC](http://en.wikipedia.org/wiki/ODBC)。我推荐[Easysoft 教程](http://www.easysoft.com/developer/languages/c/odbc_tutorial.html)。据此[，](http://itknowledgeexchange.techtarget.com/itanswers/setting-the-odbc-in-sql-server-2005/)您可能必须从 CD 手动安装 SQL Server ODBC 驱动程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-11-13T03:07:34.393

使用 C，您可能需要使用 Microsoft ODBC API： http: [//msdn.microsoft.com/en-us/library/ms714562 (v=VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms714562(v=VS.85).aspx)

我在我的[CSQLBinding](http://networkdls.com/Software/View/CSQLBinding/)类中大量使用它，其中包含大量使用示例。除了封装类（显然只适用于 C++）之外，所有功能都与普通 C 完全兼容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T14:58:14.443

从 C 程序访问数据库有两种主要方法。正如 Matthew Flaschen 已经提到的，使用更广泛的一种是 ODBC（有时称为 CLI）。这可能是在 Windows 上用于 SQL Server 的最明智的方法。其他 DBMS 也有其他类似的接口——著名的 OCI for Oracle。

另一种机制称为嵌入式 SQL，例如 IBM Informix ESQL/C（IBM Informix ClientSDK 的一部分）等产品。在这些系统中，有一个预编译器可以接受以下语句：

```
EXEC SQL CREATE TABLE x (y INTEGER NOT NULL); 
```

并安排正确的接口调用。显然，对于输入和输出变量，这可以节省一些工作 - 预编译器生成代码来处理 ODBC 等需要您显式编码的变量列表等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-13T04:58:54.937

我现在正在使用我[在这个问题中解释的以下方法。](https://stackoverflow.com/questions/1259462/is-it-a-good-way-to-use-system-for-database-scripts-from-c)它满足了我的要求。

# algorithm - 寻找附近点的算法？

> ID：838344
> 
> 赞同：22
> 
> 时间：2009-05-08T05:20:01.283
> 
> 标签：algorithm, gis, partitioning, distance, linear-algebra

给定一组具有 x,y 坐标的数百万个点，选择什么算法可以快速找到距某个位置最近的 1000 个点？这里的“快速”是指家用计算机上大约 100 毫秒。

蛮力意味着进行数百万次乘法然后对它们进行排序。虽然即使是一个简单的 Python 应用程序也可以在不到一分钟的时间内完成，但对于交互式应用程序来说仍然太长了。

这些点的边界框是已知的，因此可以将空间划分为一个简单的网格。然而，这些点的分布有些不均匀，所以我怀疑大多数网格方块会是空的，然后突然其中一些会包含大部分点。

编辑：不一定要准确，实际上可能非常不准确。例如，如果前 1000 名实际上只是前 2000 名中的一些随机点，那将不是什么大问题。

编辑：点集很少改变。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-08T05:27:06.977

使用[四叉树](http://en.wikipedia.org/wiki/Quadtree)怎么样？

您将区域划分为矩形，如果区域的点密度低，则矩形很大，如果区域的点密度高，则矩形会很小。您递归地将每个矩形细分为四个子矩形，直到矩形足够小或包含足够少的点。

然后，您可以开始查看该位置附近矩形中的点，然后向外移动，直到找到 1000 个点。

用于此的代码可能会有些复杂，所以也许您应该先尝试使用简单的网格，看看它是否足够快。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-08T05:34:40.483

四叉树很好，但[BSP 树](http://en.wikipedia.org/wiki/Bsp_tree)保证在 O(log n) 时间内运行。我认为四叉树需要有限的边界体积，并且在某些退化的情况下四叉树会惨遭失败，例如当大量点占据相同相对较小的空间时。

话虽如此，四叉树可以说更容易实现，并且在大多数常见情况下非常有效。这是 UPS 在其路由算法中使用的，因为它的缺点在实践中不会造成重大问题，可能是因为城市往往分布在感兴趣的区域上。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-08T06:24:26.883

您想使用四叉树或 RTree 之类的结构。这些是多维索引结构。

关键是使用良好的“空间填充曲线”，这有助于定义点的接近度。一个简单的空间填充曲线是 Zorder，但您会更感兴趣的是类似希尔伯特曲线的东西。

[http://en.wikipedia.org/wiki/Space_filling_curve](http://en.wikipedia.org/wiki/Space_filling_curve)

我不知道这些东西的任何预打包实现。我最近在 2 维中实现了我自己的 RTree，它只支持批量加载和搜索（通过提供的边界框）。

这里的一个缺点是您的点必须包含在有限区域中。知道有空间填充曲线适用于非有限空间，但我对它们一无所知。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-08T06:42:39.307

除了 QuadTree 和 BSP 树建议之外，您还应该查找[最近邻搜索](http://en.wikipedia.org/wiki/Nearest_neighbor_search)。算法的选择取决于您添加到基础数据集的频率。如果您经常添加和删除，那么树解决方案会更好。如果数据更加静态，则最近邻搜索和 voronoi 图可以更快并且可以更好地扩展。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T06:41:26.080

如果点集很少变化，您还可以考虑使用 voronoi 图。我不确定这是否有助于更快地找到第*一个*点，但它应该可以更容易地找到接下来的 999 个点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T05:50:03.707

我假设这些点在数据库或一些可搜索的索引位置？如果是这样，它应该很快。从给定点，您可以在 x 和 y 轴上有一个范围并获取该范围内的所有位置（即指定最左上角 x(a) 和 y(b) 以及最右下角 x(c) 和 y (d))。

然后查询其中 y >= b AND y <= d AND x >= a AND x <=c 的点。假设您在 x 和 y 坐标上分别有索引，这将很快。（假设原点是左上角的 0,0）。

然后，您可以将此范围增加（或减少，如果结果很大）z，直到结果集中的点数 >= 1000。通过一些试运行，您应该能够得出标准偏差和其他统计数字将帮助您确定要开始的矩形的大小。你的程序也可以根据它得到的结果来调整它自己。

一旦你有了粗略的数据集，它就可以通过非常简单的数学计算出每个点与源点之间的距离。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-21T04:02:49.963

我知道如果你想要真正快速的结果，我知道它不是最快的，因为我从谷歌找到了这篇文章，我想我会添加我不久前以存储过程的形式使用的 SQL 解决方案。它查找靠近 a 坐标的位置并按距离返回它们。

我希望它可以帮助某人:)

```
CREATE PROCEDURE [dbo].[getstores] @lat float,  @lng float AS
DECLARE @radius float, @DegToRad float
SET @DegToRad = 57.29577951
SET @radius = 25000
SELECT TOP 10
    name
    ,sto_lat
    ,sto_lng
    ,postcode
    ,ROUND((ACOS((SIN(@lat/57.2958) * SIN(sto_lat/@DegToRad)) +(COS(@lat/@DegToRad) * COS(sto_lat/@DegToRad) *COS(sto_lng/@DegToRad - @lng/@DegToRad))))* 6387.7, 2) AS distance
FROM store
WHERE (sto_lat >= @lat - (@radius/111))
And (sto_lat <= @lat + (@radius/111))
AND (sto_lng >= @lng - (@radius/111))
AND (sto_lng <= @lng + (@radius/111))
AND (
     ISNUMERIC(sto_lat) = 1
    AND
    ISNUMERIC(sto_lat) = 1
)
ORDER BY distance 
```

注意：我已经说过这不是解决**这个问题**的最佳解决方案，可能只是对于像我这样在谷歌上发现这个问题的人

# c++ - 如何减少具有相同名称但不同类型的数据成员的类的代码重复？

> ID：838345
> 
> 赞同：2
> 
> 时间：2009-05-08T05:20:18.770
> 
> 标签：c++, class-design

我在设计这样的课程时遇到了麻烦

```
class C1 {
public:
  void foo();
}

class C2 {
public:
  void foo();
} 
```

C1 和 C2 具有相同的方法 foo()，

```
class Derived1 : public Base {
public:
  void Update() {
    member.foo();
  }
private:    
  C1 member;
}

class Derived2 : public Base {
public:
  void Update() {
    member.foo(); 
  }
private:    
  C2 member;
} 
```

两个 Derived 类的 Update() 完全相同，但成员的类型不同。所以我必须为每个新的派生类复制更新实现。

这是减少这种代码重复的一种方法吗？我只提出了一个带有宏的解决方案。我认为有一种更优雅的方法可以用模板解决这个问题，但我想不通..

**编辑：** 非常感谢大家，但我想我错过了一些东西..

1.我用的是c++

2.实际上每个 Derived 类有大约 5 个成员，它们都提供 foo() 方法并且派生自同一个基类。我的情况是我已经编写了一个（很长的）Update() 方法，它可以在每个派生类中工作而无需任何修改。所以我只是将这个 Update() 复制并粘贴到每个新类的 Update() 中，这会导致可怕的代码重复。我想知道是否有一种方法不需要我过多地重写 Update() 并且可以减少重复。

再次感谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T05:27:56.333

这正是类模板所设计的那种应用程序。它们允许类中的函数对不同的数据类型进行操作，而无需复制算法和逻辑。

[这个 Wikipedia 页面](http://en.wikipedia.org/wiki/Template_(programming))将为您提供编程中模板的一个很好的概述。

以下是帮助您入门的基本思路：

```
template  <class T>
class CTemplateBase
{
public:
    void Update()
    {
        member.foo();
    }
private:
    T member; // Generic type
}

class CDerived1 : public CTemplateBase<C1>
{
    // No common algorithms required here
}

class CDerived2 : public CTemplateBase<C2>
{
    // No common algorithms required here
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T05:27:34.167

如果您可以控制 C1 和 C2，则可以定义一个基类或抽象基类，并在基类或第三个辅助类中处理它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T05:29:11.573

将方法移动到父类：

```
class IFooable {
public:
  virtual void foo() = 0;
}

class C1 : IFooable {
public:
  void foo();
}

class C2 : IFooable {
public:
  void foo();
}

class Base {
public:
  void Update() {
    member->foo(); 
  }
private:    
  IFooable* member
}

class Derived1 : public Base {
  Derived1 () : member(new C1()) {}
  ~Derived1 () { delete member; }
}

class Derived2 : public Base {
  Derived2 () : member(new C2()) {}
  ~Derived2 () { delete member; }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T05:34:18.097

如果您的 Drived1 和 Derived2 除了成员的类型（C1 和 C2）是相同的，那么您可以考虑使用单个类 Derived 和一个模板。（如果我的语法不正确，请原谅我的语法，我是 C# dev :D）

```
template <class T>
class Derived : public Base {
public:
  void Update() {
    member.foo();
  }
private:    
  T member;
} 
```

上面几行的东西。

# mysql - MySQL删除一些外键

> ID：838354
> 
> 赞同：217
> 
> 时间：2009-05-08T05:25:54.607
> 
> 标签：mysql, foreign-keys, constraints, mysql-error-1025

我有一个表，它的主键用于其他几个表，并且有几个外键到其他表。

```
CREATE TABLE location (
   locationID INT NOT NULL AUTO_INCREMENT PRIMARY KEY
   ...
) ENGINE = InnoDB;

CREATE TABLE assignment (
   assignmentID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
   locationID INT NOT NULL,
   FOREIGN KEY locationIDX (locationID) REFERENCES location (locationID)
   ...
) ENGINE = InnoDB;

CREATE TABLE assignmentStuff (
   ...
   assignmentID INT NOT NULL,
   FOREIGN KEY assignmentIDX (assignmentID) REFERENCES assignment (assignmentID)
) ENGINE = InnoDB; 
```

问题是，当我尝试删除其中一个外键列（即 locationIDX）时，它会给我一个错误。

> “错误 1025 (HY000)：重命名错误”

如何在不出现此错误的情况下删除上面分配表中的列？

* * *

## 回答 #1

> 赞同：506
> 
> 时间：2009-05-08T05:54:54.117

正如[这里](http://bugs.mysql.com/bug.php?id=14347)所解释的，似乎*外键*约束必须通过**约束名称**而不是*索引*名称来删除。

语法是：

```
ALTER TABLE footable DROP FOREIGN KEY fooconstraint; 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-05-08T05:50:20.727

外键用于确保数据完整性，因此只要列是外键的一部分，就不能删除它。您需要先放下钥匙。

我认为以下查询会做到这一点：

```
ALTER TABLE assignmentStuff DROP FOREIGN KEY assignmentIDX; 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2016-01-03T08:42:31.117

正如上面每个人所说，您可以轻松删除 FK。但是，我只是注意到在某些时候可能有必要删除 KEY 本身。如果您有任何错误消息要创建另一个索引，例如最后一个索引，我的意思是使用相同的名称，删除与该索引相关的所有内容会很有用。

```
ALTER TABLE your_table_with_fk
  drop FOREIGN KEY name_of_your_fk_from_show_create_table_command_result,
  drop KEY the_same_name_as_above 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2017-01-22T03:26:40.457

检查什么是 CONSTRAINT 名称和 FOREIGN KEY 名称：

```
SHOW CREATE TABLE table_name; 
```

删除 CONSTRAINT 名称和 FOREIGN KEY 名称：

```
ALTER TABLE table_name
  DROP FOREIGN KEY the_name_after_CONSTRAINT,
  DROP KEY the_name_after_FOREIGN_KEY; 
```

希望这可以帮助！

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2019-10-16T08:04:12.730

嘿，我按照上面的一些顺序，找到了一些解决方案。

```
SHOW CREATE TABLE footable; 
```

您将获得 FK 约束名称，例如

```
ProjectsInfo_ibfk_1 
```

现在您需要删除此约束。通过更改表命令

```
alter table ProjectsInfo drop foreign key ProjectsInfo_ibfk_1; 
```

然后删除表格列，

```
alter table ProjectsInfo drop column clientId; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-05-05T10:10:36.243

这是一种删除外键约束的方法，它会起作用。更改表`location`。`location_id` 删除外键`location_ibfk_1`；

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-08-09T10:20:52.677

如果您的表使用 InnoDB 引擎，您通常会收到此错误。在这种情况下，您必须删除外键，然后执行更改表并删除列。

但棘手的部分是您不能使用列名删除外键，而是必须找到用于索引它的名称。要找到它，请发出以下选择：

显示创建表区域；这应该会显示一行，在左上角单击 + 选项，单击全文 raio 按钮，然后单击 go。您将获得索引的名称，如下所示：

CONSTRAINT region_ibfk_1 FOREIGN KEY (country_id) REFERENCES country (id) ON DELETE NO ACTION ON UPDATE NO ACTION 现在只需发出：

更改表区域删除外键 region_ibfk_1；

或者

更简单地输入：- alter table TableName drop foreign key **TableName_ibfk_1** ;

记住唯一的事情是在你的表名之后添加 **_ibfk_1** 来制作这样的：- TableName **_ibfk_1**

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T05:49:49.090

您不能删除外键列，因为它是从表中引用的`assignmentStuff`。所以你应该先去掉外键约束`assignmentStuff.assignmentIDX`。

[这里](https://stackoverflow.com/questions/160233/what-does-mysql-error-1025-hy000-error-on-rename-of-foo-errorno-150-mean)已经提出了一个类似的问题。也可以[在这里](http://www.xaprb.com/blog/2006/08/22/mysqls-error-1025-explained/)查看更多信息。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-10-24T14:32:32.503

试试这个：

```
alter table Documents drop
  FK__Documents__Custo__2A4B4B5E 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-07-31T02:05:33.463

第1步：`show create table vendor_locations;`

第2步：`ALTER TABLE vendor_locations drop foreign key vendor_locations_ibfk_1;`

它对我有用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-04-02T06:06:18.923

首先需要通过此查询获取实际的约束名称

```
SHOW CREATE TABLE TABLE_NAME 
```

此查询将导致外键名称的约束，现在下面的查询将删除它。

```
ALTER TABLE TABLE_NAME DROP FOREIGN KEY COLUMN_NAME_ibfk_1 
```

上面约束名称中的最后一个数字取决于表中有多少外键

# special-characters - 在 DOS 中键入波浪号 ~ 字符

> ID：838371
> 
> 赞同：1
> 
> 时间：2009-05-08T05:29:54.613
> 
> 标签：special-characters, dos, tilde

在我的 DOS 提示符中，我必须输入波浪号 ( `~`) 字符才能打开任何文件。

由于某种原因，它不会出现在 DOS 框/提示中。

是否有任何形式的 Ctrl 快捷键可以让我输入`~`字符？

不过，只有 DOS 提示符无法识别该键才是最让我兴奋的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T05:33:15.963

按住 Alt 键并在数字小键盘上键入 0126（零一二六）。那就是那个字符的ascii值。

GWBasic:

```
10 a$="~"
20 ? asc(a$)
run
126 
```

在 DOS 中，您需要以其他符号所需的 0 + 值开头，并且它仅适用于数字键盘。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-23T20:36:36.367

在西班牙语键盘上，您可以按“ **Alt Gr** ”和“ **4** ”。

该组合键将在任何地方写入*波浪号*，包括命令行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-12-18T18:01:14.437

我在我的多混音系统中键入了 SHIFT 和“向数字 1 左侧的键”以产生一个波浪号 ~。

（这确实有效。实际键盘是 de-sg，但多仿真环境在命令窗口中的行为类似于 DOS 或 WinPE 美国键盘。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-23T20:16:58.887

尝试复制/粘贴它怎么样？

1.  开始->运行->charmap
2.  选择〜字符并点击选择然后复制
3.  打开提示窗口并去 Alt+Space 然后编辑->粘贴

# gnu-screen - 无法在屏幕中有效使用拆分

> ID：838372
> 
> 赞同：1
> 
> 时间：2009-05-08T05:30:02.477
> 
> 标签：gnu-screen

我在 Cs 的 Emacs 中搜索了 Screen 的信息手册，但没有成功。我无法一次搜索所有节点。

我可以创建一个拆分

```
C-a S 
```

在屏幕中，在它们之间移动

```
C-a TAB 
```

并关闭它们

```
C-a X 
```

但是，我无法在它们上启动任何东西。我现在在两个拆分中有两个相同的窗口。

我想在其他拆分中开始一个新会话，就像在 Vim 中一样

```
:args newFile 
```

**您如何在第二次拆分中开始新的会话？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T05:40:14.400

`C-a c`创建一个新窗口（并立即切换到该窗口）
`C-a w`以列出窗口
`C-a`和窗口编号以切换窗口。

您可以使用[screenrc](http://www.softpanorama.org/Utilities/Screen/screenrc_examples.shtml)文件更改默认键绑定，但我认为您不能将多个命令绑定到单个按键。

但是，如果您正在使用一组常见的屏幕，则默认情况下，您可以从这些已经打开的屏幕开始（并运行您想要的任何程序）。查看 dotfiles 上的[screenrc](http://dotfiles.org/.screenrc)以获得一些很棒的提示。

一个简单的 ~/.screenrc 用于让屏幕自动打开几个会话（拆分如下）

```
screen -t vim vim
split
focus down
startup_message off
screen -t home 
```

这将打开两个分屏会话，第一个命名为 vim（运行 vim），第二个命名为 home，只是在正常的 shell 提示符下等待。

您可以将不同的 screenrc 文件`screen -c nameOfYourScreenRC`与`screen -c gdbscreenrc`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T07:16:17.820

`C-a c`将在当前拆分中创建一个新的屏幕窗口。

您也可以在屏幕中执行命令，方法是键入`C-a :`，然后键入命令，然后 Enter。然后你可以做一些类似于你所描述的事情：

```
:screen vi look-a-new-screen-window-started-with-vi.txt 
```

此外，由于您可能习惯了 Vim 的窗口移动键，请尝试将 绑定`C-a j`到向下移动到下一个拆分并向`C-a k`上移动到上一个拆分，就像 Vim 的`C-w j`和`C-w k`. 在你的`.screenrc`：

```
bind j focus down
bind k focus up 
```

* * *

当我分享屏幕内容时，这里有一个方便的地方可以添加到您的 screenrc 中，以便在底部为您提供一个漂亮的状态栏，显示您的所有屏幕窗口，并突出显示当前窗口：

```
hardstatus alwayslastline "%{k}%-w%{.kY}%n %t%{-}%+w %= %H: %l %d/%m %c" 
```

用 重命名窗口`C-a A`。

# c++ - 使用索引向量重新排序向量

> ID：838384
> 
> 赞同：41
> 
> 时间：2009-05-08T05:35:51.027
> 
> 标签：c++, algorithm, vector, stl

我想重新排序向量中的项目，使用另一个向量来指定顺序：

```
char   A[]     = { 'a', 'b', 'c' };
size_t ORDER[] = { 1, 0, 2 };

vector<char>   vA(A, A + sizeof(A) / sizeof(*A));
vector<size_t> vOrder(ORDER, ORDER + sizeof(ORDER) / sizeof(*ORDER));

reorder_naive(vA, vOrder);

// A is now { 'b', 'a', 'c' } 
```

以下是需要复制向量的低效实现：

```
void reorder_naive(vector<char>& vA, const vector<size_t>& vOrder)  
{   
    assert(vA.size() == vOrder.size());  
    vector vCopy = vA; // Can we avoid this?  
    for(int i = 0; i < vOrder.size(); ++i)  
        vA[i] = vCopy[ vOrder[i] ];  
} 
```

有没有更有效的方法，例如，使用 swap()？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-08-12T18:26:27.713

This algorithm is based on chmike's, but the vector of reorder indices is `const`. This function agrees with his for all 11! permutations of [0..10]. The complexity is O(N^2), taking N as the size of the input, or more precisely, the size of the largest [orbit](https://mathworld.wolfram.com/GroupOrbit.html).

See below for an optimized O(N) solution which modifies the input.

```
template< class T >
void reorder(vector<T> &v, vector<size_t> const &order )  {   
    for ( int s = 1, d; s < order.size(); ++ s ) {
        for ( d = order[s]; d < s; d = order[d] ) ;
        if ( d == s ) while ( d = order[d], d != s ) swap( v[s], v[d] );
    }
} 
```

Here's an STL style version which I put a bit more effort into. It's about 47% faster (that is, almost twice as fast over [0..10]!) because it does all the swaps as early as possible and then returns. The reorder vector consists of a number of orbits, and each orbit is reordered upon reaching its first member. It's faster when the last few elements do not contain an orbit.

```
template< typename order_iterator, typename value_iterator >
void reorder( order_iterator order_begin, order_iterator order_end, value_iterator v )  {   
    typedef typename std::iterator_traits< value_iterator >::value_type value_t;
    typedef typename std::iterator_traits< order_iterator >::value_type index_t;
    typedef typename std::iterator_traits< order_iterator >::difference_type diff_t;

    diff_t remaining = order_end - 1 - order_begin;
    for ( index_t s = index_t(), d; remaining > 0; ++ s ) {
        for ( d = order_begin[s]; d > s; d = order_begin[d] ) ;
        if ( d == s ) {
            -- remaining;
            value_t temp = v[s];
            while ( d = order_begin[d], d != s ) {
                swap( temp, v[d] );
                -- remaining;
            }
            v[s] = temp;
        }
    }
} 
```

* * *

And finally, just to answer the question once and for all, a variant which does destroy the reorder vector (filling it with -1's). For permutations of [0..10], It's about 16% faster than the preceding version. Because overwriting the input enables dynamic programming, it is O(N), asymptotically faster for some cases with longer sequences.

```
template< typename order_iterator, typename value_iterator >
void reorder_destructive( order_iterator order_begin, order_iterator order_end, value_iterator v )  {
    typedef typename std::iterator_traits< value_iterator >::value_type value_t;
    typedef typename std::iterator_traits< order_iterator >::value_type index_t;
    typedef typename std::iterator_traits< order_iterator >::difference_type diff_t;

    diff_t remaining = order_end - 1 - order_begin;
    for ( index_t s = index_t(); remaining > 0; ++ s ) {
        index_t d = order_begin[s];
        if ( d == (diff_t) -1 ) continue;
        -- remaining;
        value_t temp = v[s];
        for ( index_t d2; d != s; d = d2 ) {
            swap( temp, v[d] );
            swap( order_begin[d], d2 = (diff_t) -1 );
            -- remaining;
        }
        v[s] = temp;
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-08T08:26:51.537

# In-place reordering of vector

Warning: there is an ambiguity about the semantic what the ordering-indices mean. Both are answered here

## move elements of vector to the position of the indices

Interactive version [here](https://techiedelight.com/compiler/?f-4U).

```
#include <iostream>
#include <vector>
#include <assert.h>

using namespace std;

void REORDER(vector<double>& vA, vector<size_t>& vOrder)  
{   
    assert(vA.size() == vOrder.size());

    // for all elements to put in place
    for( int i = 0; i < vA.size() - 1; ++i )
    { 
        // while the element i is not yet in place 
        while( i != vOrder[i] )
        {
            // swap it with the element at its final place
            int alt = vOrder[i];
            swap( vA[i], vA[alt] );
            swap( vOrder[i], vOrder[alt] );
        }
    }
}

int main()
{
    std::vector<double> vec {7, 5, 9, 6};
    std::vector<size_t> inds {1, 3,  0, 2};
    REORDER(vec, inds);
    for (size_t vv = 0; vv < vec.size(); ++vv)
    {
        std::cout << vec[vv] << std::endl;
    }
    return 0;
} 
```

**output**

```
9
7
6
5 
```

note that you can save one test because if n-1 elements are in place the last nth element is certainly in place.

On exit vA and vOrder are properly ordered.

This algorithm performs at most n-1 swapping because each swap moves the element to its final position. And we'll have to do at most 2N tests on vOrder.

## draw the elements of vector from the position of the indices

Try it interactively [here](https://techiedelight.com/compiler/?m1y1).

```
#include <iostream>
#include <vector>
#include <assert.h>

template<typename T>
void reorder(std::vector<T>& vec, std::vector<size_t> vOrder)
{
    assert(vec.size() == vOrder.size());

    for( size_t vv = 0; vv < vec.size() - 1; ++vv )
    {
            if (vOrder[vv] == vv)
            {
                continue;
            }
            size_t oo;
            for(oo = vv + 1; oo < vOrder.size(); ++oo)
            {
                if (vOrder[oo] == vv)
                {
                    break;
                }
            }
            std::swap( vec[vv], vec[vOrder[vv]] );
            std::swap( vOrder[vv], vOrder[oo] );
    }
}

int main()
{
    std::vector<double> vec {7, 5, 9, 6};
    std::vector<size_t> inds {1, 3,  0, 2};
    reorder(vec, inds);
    for (size_t vv = 0; vv < vec.size(); ++vv)
    {
        std::cout << vec[vv] << std::endl;
    }
    return 0;
} 
```

**Output**

```
5
6
7
9 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-03-04T21:22:59.567

It appears to me that vOrder contains a set of indexes in the desired order (for example the output of sorting by index). The code example here follows the "cycles" in vOrder, where following a sub-set (could be all of vOrder) of indexes will cycle through the sub-set, ending back at the first index of the sub-set.

Wiki article on "cycles"

[https://en.wikipedia.org/wiki/Cyclic_permutation](https://en.wikipedia.org/wiki/Cyclic_permutation)

In the following example, every swap places at least one element in it's proper place. This code example effectively reorders vA according to vOrder, while "unordering" or "unpermuting" vOrder back to its original state (0 :: n-1). If vA contained the values 0 through n-1 in order, then after reorder, vA would end up where vOrder started.

```
template <class T>
void reorder(vector<T>& vA, vector<size_t>& vOrder)  
{   
    assert(vA.size() == vOrder.size());

    // for all elements to put in place
    for( size_t i = 0; i < vA.size(); ++i )
    { 
        // while vOrder[i] is not yet in place 
        // every swap places at least one element in it's proper place
        while(       vOrder[i] !=   vOrder[vOrder[i]] )
        {
            swap( vA[vOrder[i]], vA[vOrder[vOrder[i]]] );
            swap(    vOrder[i],     vOrder[vOrder[i]] );
        }
    }
} 
```

* * *

This can also be implemented a bit more efficiently using moves instead swaps. A temp object is needed to hold an element during the moves. Example C code, reorders A[] according to indexes in I[], also sorts I[] :

```
void reorder(int *A, int *I, int n)
{    
int i, j, k;
int tA;
    /* reorder A according to I */
    /* every move puts an element into place */
    /* time complexity is O(n) */
    for(i = 0; i < n; i++){
        if(i != I[i]){
            tA = A[i];
            j = i;
            while(i != (k = I[j])){
                A[j] = A[k];
                I[j] = j;
                j = k;
            }
            A[j] = tA;
            I[j] = j;
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-08T06:43:39.287

如果可以修改 ORDER 数组，那么对 ORDER 向量进行排序并在每个排序操作中交换相应值向量元素的实现就可以解决问题，我认为。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T07:41:01.117

Never prematurely optimize. Meassure and then determine where you need to optimize and what. You can end with complex code that is hard to maintain and bug-prone in many places where performance is not an issue.

With that being said, do not early pessimize. Without changing the code you can remove half of your copies:

```
 template <typename T>
    void reorder( std::vector<T> & data, std::vector<std::size_t> const & order )
    {
       std::vector<T> tmp;         // create an empty vector
       tmp.reserve( data.size() ); // ensure memory and avoid moves in the vector
       for ( std::size_t i = 0; i < order.size(); ++i ) {
          tmp.push_back( data[order[i]] );
       }
       data.swap( tmp );          // swap vector contents
    } 
```

This code creates and empty (big enough) vector in which a single copy is performed in-order. At the end, the ordered and original vectors are swapped. This will reduce the copies, but still requires extra memory.

If you want to perform the moves in-place, a simple algorithm could be:

```
template <typename T>
void reorder( std::vector<T> & data, std::vector<std::size_t> const & order )
{
   for ( std::size_t i = 0; i < order.size(); ++i ) {
      std::size_t original = order[i];
      while ( i < original )  {
         original = order[original];
      }
      std::swap( data[i], data[original] );
   }
} 
```

This code should be checked and debugged. In plain words the algorithm in each step positions the element at the i-th position. First we determine where the original element for that position is now placed in the data vector. If the original position has already been touched by the algorithm (it is before the i-th position) then the original element was swapped to order[original] position. Then again, that element can already have been moved...

This algorithm is roughly O(N^2) in the number of integer operations and thus is theoretically worse in performance time as compare to the initial O(N) algorithm. But it can compensate if the N^2 swap operations (worst case) cost less than the N copy operations or if you are really constrained by memory footprint.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-09-26T21:27:27.233

It's an interesting intellectual exercise to do the reorder with O(1) space requirement but in 99.9% of the cases the simpler answer will perform to your needs:

```
void permute(vector<T>& values, const vector<size_t>& indices)  
{   
    vector<T> out;
    out.reserve(indices.size());
    for(size_t index: indices)
    {
        assert(0 <= index && index < values.size());
        out.push_back(std::move(values[index]));
    }
    values = std::move(out);
} 
```

Beyond memory requirements, the only way I can think of this being slower would be due to the memory of `out` being in a different cache page than that of `values` and `indices`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-07-25T00:19:15.880

# A survey of existing answers

You ask if there is "a more efficient way". But what do you mean by efficient and what are your requirements?

Potatoswatter's [answer](https://stackoverflow.com/a/1267878/752843) works in *O(N²)* time with *O(1)* additional space and *doesn't* mutate the reordering vector.

[chmike](https://stackoverflow.com/a/838789/752843) and [rcgldr](https://stackoverflow.com/a/22183350/752843) give answers which use *O(N)* time with *O(1)* additional space, but they achieve this by mutating the reordering vector.

Your original answer allocates new space and then copies data into it while [Tim MB](https://stackoverflow.com/a/46436111/752843) suggests using move semantics. However, moving still requires a place to move things to and an object like an `std::string` has both a length variable and a pointer. In other words, a move-based solution requires `O(N)` allocations for any objects and `O(1)` allocations for the new vector itself. I explain why this is important below.

# Preserving the reordering vector

We might want that reordering vector! Sorting costs *O(N log N)*. But, if you know you'll be sorting several vectors in the same way, such as in a [Structure of Arrays (SoA)](https://en.wikipedia.org/wiki/AoS_and_SoA) context, you can sort once and then reuse the results. This can save a lot of time.

You might also want to sort and then unsort data. Having the reordering vector allows you to do this. A use case here is for performing genomic sequencing on GPUs where maximal speed efficiency is obtained by having sequences of similar lengths processed in batches. We cannot rely on the user providing sequences in this order so we sort and then unsort.

So, what if we want the best of all worlds: *O(N)* processing without the *costs* of additional allocation but also without mutating our ordering vector (which we might, after all, want to reuse)? To find that world, we need to ask:

# Why is extra space bad?

There are two reasons you might not want to allocate additional space.

The first is that you don't have much space to work with. This can occur in two situations: you're on an embedded device with limited memory. Usually this means you're working with small datasets, so the *O(N²)* solution is probably fine here. But it can also happen when you are working with *really* large datasets. In this case *O(N²)* is unacceptable and you have to use one of the *O(N)* mutating solutions.

The other reason extra space is bad is because **allocation is expensive**. For smaller datasets it can cost more than the actual computation. Thus, one way to achieve efficiency is to eliminate allocation.

# Outline

When we mutate the ordering vector we are doing so as a way to indicate whether elements are in their permuted positions. Rather than doing this, we could use a bit-vector to indicate that same information. However, if we allocate the bit vector each time that would be expensive.

Instead, we could clear the bit vector each time by resetting it to zero. However, that incurs an additional *O(N)* cost per function use.

Rather, we can store a "version" value in a vector and increment this on each function use. This gives us *O(1)* access, *O(1)* clear, and an amoritzed allocation cost. This works similarly to a [persistent data structure](https://en.wikipedia.org/wiki/Persistent_data_structure). The downside is that if we use an ordering function too often the version counter needs to be reset, though the *O(N)* cost of doing so is amortized.

This raises the question: what is the optimal data type for the version vector? A bit-vector maximizes cache utilization but requires a full *O(N)* reset after each use. A 64-bit data type probably never needs to be reset, but has poor cache utilization. Experimenting is the best way to figure this out.

# Two types of permutations

We can view an ordering vector as having two senses: forward and backward. In the forward sense, the vector tell us where elements go to. In the backward sense, the vector tells us where elements are coming from. Since the ordering vector is implicitly a linked list, the backward sense requires `O(N)` additional space, but, again, we can amortize the allocation cost. Applying the two senses sequentially brings us back to our original ordering.

# Performance

Running single-threaded on my "Intel(R) Xeon(R) E-2176M CPU @ 2.70GHz", the following code takes about 0.81ms per reordering for sequences 32,767 elements long.

# Code

Fully commented code for both senses with tests:

```
#include <algorithm>
#include <cassert>
#include <random>
#include <stack>
#include <stdexcept>
#include <vector>

///@brief Reorder a vector by moving its elements to indices indicted by another 
///       vector. Takes O(N) time and O(N) space. Allocations are amoritzed.
///
///@param[in,out] values   Vector to be reordered
///@param[in]     ordering A permutation of the vector
///@param[in,out] visited  A black-box vector to be reused between calls and
///                        shared with with `backward_reorder()`
template<class ValueType, class OrderingType, class ProgressType>
void forward_reorder(
  std::vector<ValueType>          &values,
  const std::vector<OrderingType> &ordering,
  std::vector<ProgressType>       &visited
){
  if(ordering.size()!=values.size()){
    throw std::runtime_error("ordering and values must be the same size!");
  }

  //Size the visited vector appropriately. Since vectors don't shrink, this will
  //shortly become large enough to handle most of the inputs. The vector is 1
  //larger than necessary because the first element is special.
  if(visited.empty() || visited.size()-1<values.size());
    visited.resize(values.size()+1);

  //If the visitation indicator becomes too large, we reset everything. This is
  //O(N) expensive, but unlikely to occur in most use cases if an appropriate
  //data type is chosen for the visited vector. For instance, an unsigned 32-bit
  //integer provides ~4B uses before it needs to be reset. We subtract one below
  //to avoid having to think too much about off-by-one errors. Note that
  //choosing the biggest data type possible is not necessarily a good idea!
  //Smaller data types will have better cache utilization.
  if(visited.at(0)==std::numeric_limits<ProgressType>::max()-1)
    std::fill(visited.begin(), visited.end(), 0);

  //We increment the stored visited indicator and make a note of the result. Any
  //value in the visited vector less than `visited_indicator` has not been
  //visited.
  const auto visited_indicator = ++visited.at(0);

  //For doing an early exit if we get everything in place
  auto remaining = values.size();

  //For all elements that need to be placed
  for(size_t s=0;s<ordering.size() && remaining>0;s++){
    assert(visited[s+1]<=visited_indicator);

    //Ignore already-visited elements
    if(visited[s+1]==visited_indicator)
      continue;

    //Don't rearrange if we don't have to
    if(s==visited[s])
      continue;

    //Follow this cycle, putting elements in their places until we get back
    //around. Use move semantics for speed.
    auto temp = std::move(values[s]);
    auto i = s;
    for(;s!=(size_t)ordering[i];i=ordering[i],--remaining){
      std::swap(temp, values[ordering[i]]);
      visited[i+1] = visited_indicator;
    }
    std::swap(temp, values[s]);
    visited[i+1] = visited_indicator;
  }
}

///@brief Reorder a vector by moving its elements to indices indicted by another 
///       vector. Takes O(2N) time and O(2N) space. Allocations are amoritzed.
///
///@param[in,out] values   Vector to be reordered
///@param[in]     ordering A permutation of the vector
///@param[in,out] visited  A black-box vector to be reused between calls and
///                        shared with with `forward_reorder()`
template<class ValueType, class OrderingType, class ProgressType>
void backward_reorder(
  std::vector<ValueType>          &values,
  const std::vector<OrderingType> &ordering,
  std::vector<ProgressType>       &visited
){
  //The orderings form a linked list. We need O(N) memory to reverse a linked
  //list. We use `thread_local` so that the function is reentrant.
  thread_local std::stack<OrderingType> stack;

  if(ordering.size()!=values.size()){
    throw std::runtime_error("ordering and values must be the same size!");
  }

  //Size the visited vector appropriately. Since vectors don't shrink, this will
  //shortly become large enough to handle most of the inputs. The vector is 1
  //larger than necessary because the first element is special.
  if(visited.empty() || visited.size()-1<values.size());
    visited.resize(values.size()+1);

  //If the visitation indicator becomes too large, we reset everything. This is
  //O(N) expensive, but unlikely to occur in most use cases if an appropriate
  //data type is chosen for the visited vector. For instance, an unsigned 32-bit
  //integer provides ~4B uses before it needs to be reset. We subtract one below
  //to avoid having to think too much about off-by-one errors. Note that
  //choosing the biggest data type possible is not necessarily a good idea!
  //Smaller data types will have better cache utilization.
  if(visited.at(0)==std::numeric_limits<ProgressType>::max()-1)
    std::fill(visited.begin(), visited.end(), 0);

  //We increment the stored visited indicator and make a note of the result. Any
  //value in the visited vector less than `visited_indicator` has not been
  //visited.  
  const auto visited_indicator = ++visited.at(0);

  //For doing an early exit if we get everything in place
  auto remaining = values.size();

  //For all elements that need to be placed
  for(size_t s=0;s<ordering.size() && remaining>0;s++){
    assert(visited[s+1]<=visited_indicator);

    //Ignore already-visited elements
    if(visited[s+1]==visited_indicator)
      continue;

    //Don't rearrange if we don't have to
    if(s==visited[s])
      continue;

    //The orderings form a linked list. We need to follow that list to its end
    //in order to reverse it.
    stack.emplace(s);
    for(auto i=s;s!=(size_t)ordering[i];i=ordering[i]){
      stack.emplace(ordering[i]);
    }

    //Now we follow the linked list in reverse to its beginning, putting
    //elements in their places. Use move semantics for speed.
    auto temp = std::move(values[s]);
    while(!stack.empty()){
      std::swap(temp, values[stack.top()]);
      visited[stack.top()+1] = visited_indicator;
      stack.pop();
      --remaining;
    }
    visited[s+1] = visited_indicator;
  }
}

int main(){
  std::mt19937 gen;
  std::uniform_int_distribution<short> value_dist(0,std::numeric_limits<short>::max());
  std::uniform_int_distribution<short> len_dist  (0,std::numeric_limits<short>::max());
  std::vector<short> data;
  std::vector<short> ordering;
  std::vector<short> original;

  std::vector<size_t> progress;

  for(int i=0;i<1000;i++){
    const int len = len_dist(gen);
    data.clear();
    ordering.clear();
    for(int i=0;i<len;i++){
      data.push_back(value_dist(gen));
      ordering.push_back(i);
    }

    original = data;

    std::shuffle(ordering.begin(), ordering.end(), gen);

    forward_reorder(data, ordering, progress);

    assert(original!=data);

    backward_reorder(data, ordering, progress);

    assert(original==data);
  }  
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T06:04:26.760

我猜你可以递归地做 - 像这样（未经检查，但它给出了这个想法）：

```
// Recursive function
template<typename T>
void REORDER(int oldPosition, vector<T>& vA, 
             const vector<int>& vecNewOrder, vector<bool>& vecVisited)
{
    // Keep a record of the value currently in that position,
    // as well as the position we're moving it to.
    // But don't move it yet, or we'll overwrite whatever's at the next
    // position. Instead, we first move what's at the next position.
    // To guard against loops, we look at vecVisited, and set it to true
    // once we've visited a position.
    T oldVal = vA[oldPosition];
    int newPos = vecNewOrder[oldPosition];
    if (vecVisited[oldPosition])
    {
        // We've hit a loop. Set it and return.
        vA[newPosition] = oldVal;
        return;
    }
    // Guard against loops:
    vecVisited[oldPosition] = true;

    // Recursively re-order the next item in the sequence.
    REORDER(newPos, vA, vecNewOrder, vecVisited);

    // And, after we've set this new value, 
    vA[newPosition] = oldVal;
}

// The "main" function
template<typename T>
void REORDER(vector<T>& vA, const vector<int>& newOrder)
{
    // Initialise vecVisited with false values
    vector<bool> vecVisited(vA.size(), false);

    for (int x = 0; x < vA.size(); x++)
    {
        REORDER(x, vA, newOrder, vecVisited);
    }
} 
```

当然，你确实有 vecVisited 的开销。对这种方法的想法，有人吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-08T06:40:30.450

你的代码坏了。您不能分配给`vA`并且需要使用模板参数。

```
vector<char> REORDER(const vector<char>& vA, const vector<size_t>& vOrder)  
{   
    assert(vA.size() == vOrder.size());  
    vector<char> vCopy(vA.size()); 
    for(int i = 0; i < vOrder.size(); ++i)  
        vCopy[i] = vA[ vOrder[i] ];  
    return vA;
} 
```

上面的效率稍微高一点。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-08T06:49:06.780

To iterate through the vector is O(n) operation. Its sorta hard to beat that.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-01-27T10:39:37.590

It is not clear by the title and the question if the vector should be ordered with the same steps it takes to order vOrder or if vOrder already contains the indexes of the desired order. The first interpretation has already a satisfying answer (see chmike and Potatoswatter), I add some thoughts about the latter. If the creation and/or copy cost of object T is relevant

```
template <typename T>
void reorder( std::vector<T> & data, std::vector<std::size_t> & order )
{
 std::size_t i,j,k;
  for(i = 0; i < order.size() - 1; ++i) {
    j = order[i];
    if(j != i) {
      for(k = i + 1; order[k] != i; ++k);
      std::swap(order[i],order[k]);
      std::swap(data[i],data[j]);
    }
  }
} 
```

If the creation cost of your object is small and memory is not a concern (see dribeas):

```
template <typename T>
void reorder( std::vector<T> & data, std::vector<std::size_t> const & order )
{
 std::vector<T> tmp;         // create an empty vector
 tmp.reserve( data.size() ); // ensure memory and avoid moves in the vector
 for ( std::size_t i = 0; i < order.size(); ++i ) {
  tmp.push_back( data[order[i]] );
 }
 data.swap( tmp );          // swap vector contents
} 
```

Note that the two pieces of code in dribeas answer do different things.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-08-04T17:05:42.220

I was trying to use @Potatoswatter's solution to sort multiple vectors by a third one and got really confused by output from using the above functions on a vector of indices output from Armadillo's `sort_index`. To switch from a vector output from `sort_index` (the `arma_inds` vector below) to one that can be used with @Potatoswatter's solution (`new_inds` below), you can do the following:

```
vector<int> new_inds(arma_inds.size());
for (int i = 0; i < new_inds.size(); i++) new_inds[arma_inds[i]] = i; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-08-20T17:42:24.487

I came up with this solution which has the *space complexity* of `O(max_val - min_val + 1)`, but it can be integrated with `std::sort` and benefits from `std::sort`'s `O(n log n)` decent *time complexity*.

```
std::vector<int32_t> dense_vec = {1, 2, 3};
std::vector<int32_t> order = {1, 0, 2};

int32_t max_val = *std::max_element(dense_vec.begin(), dense_vec.end());
std::vector<int32_t> sparse_vec(max_val + 1);

int32_t i = 0;
for(int32_t j: dense_vec)
{
    sparse_vec[j] = order[i];
    i++;
}

std::sort(dense_vec.begin(), dense_vec.end(),
    [&sparse_vec](int32_t i1, int32_t i2) {return sparse_vec[i1] < sparse_vec[i2];}); 
```

The following assumptions made while writing this code:

*   Vector values start from zero.
*   Vector does not contain repeated values.
*   We have enough memory to sacrifice in order to use `std::sort`

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-05-08T06:54:25.940

This should avoid copying the vector:

```
void REORDER(vector<char>& vA, const vector<size_t>& vOrder)  
{   
    assert(vA.size() == vOrder.size()); 
    for(int i = 0; i < vOrder.size(); ++i)
        if (i < vOrder[i])
            swap(vA[i], vA[vOrder[i]]);
} 
```

# client - SVN 错误：“1”和“3”之间的预期 fs 格式；找到格式“4”

> ID：838392
> 
> 赞同：20
> 
> 时间：2009-05-08T05:41:30.373
> 
> 标签：client, version, svn

这就是我所做的，我已将 svnserve 作为服务安装，并使用**net start svn service**命令启动它。我输入了**svn ls svn://localhost**来测试服务，但它返回了本文标题中所述的错误。

我在电脑上输入**svn --version**和**svnserve --version**找出版本号，客户端和服务器版本是一样的，1.5.6版。我猜这个错误是由于服务器和客户端的不同版本而出现的。

当我在 cmd 中使用**svnserve --daemon --root**命令启动服务器时，错误仍然出现。

为什么会出现错误？谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-08T05:48:56.003

您使用哪个 Subverson 工具来创建存储库？TortoiseSVN？您的 TortoiseSVN 可能是更新的 1.6.x 版本，然后是 1.5 命令行客户端和 svnserve，因此 svnserve 1.5.x 不能为 1.6.x 存储库提供服务。

在我使用 svnadmin 1.6.1 创建的 fsfs 存储库中，db/format 文件包含

```
$ cat repos/db/format 
4
layout sharded 1000 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-04-14T05:52:19.043

我有同样的问题，但我用不同的方法解决了它

问题主要是 db/format 文件，它期望“2”最好的检查方法是打开文件

```
$ vi db/format 
```

如果你得到这个

```
4
layout sharded 1000 
```

然后你应该改变他们说

```
2 
```

最好也检查一下你当前的文件

```
$ vi db/current 
```

如果你只得到这个（例如 0 表示修订号 0）

```
0 
```

然后你应该把它们改成只说（例如 0 表示修订号附加 "nx" 和 "2" ）

```
0 nx 2 
```

最后还要检查 revs 和 revprops 的目录结构是否已分片或看起来像这样

```
db/revs/0/0 
```

将其更改为非文件夹结构

```
db/revs/0 
```

注意：修订文件（例如 0）就在 revs 目录中，不应再有其他文件夹

revprops 更改也是如此

```
db/revprops/0/0 
```

到

```
db/revprops/0 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-05T02:18:33.477

我删除了我的旧存储库并使用命令行创建一个新存储库 -> svnadmin create C:\SvnRepository

*旧存储库是通过右键单击文件夹并单击“在此处创建存储库”创建的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T00:12:12.170

我安装了（Collabnet 安装）SVN 1.5.5，它在 TortoiseSVN 1.6.1 上运行良好。将 SVN 升级到 1.6.2 后，当我尝试通过 Trac 访问它时，我遇到了同样的错误（“1”和“3”之间的预期 fs 格式；找到格式“4”）。这为布莱尔的回答增添了可信度。我会告诉你我如何让它再次运行。

更新：布莱尔的回答也对我有用：消息说旧版本的 SVN 正在尝试访问存储库，所以找到它并删除它。对我来说，具体情况是该错误仅在我使用 Trac 时发生，因此我使用我能找到的最新安装程序 (svn-python-)在 Windows ( [http://trac.edgewall.org/wiki/TracOnWindows](http://trac.edgewall.org/wiki/TracOnWindows) ) 1.6.1.win32-py2.5.exe) 并从 Python 站点包文件夹中删除旧鸡蛋。重新启动并重新同步后，我再次启动并运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-17T06:22:45.570

Zend Studio (8.x) 的最新版本有一个 SVN 工具，它给出了关于查找格式 4 的相同错误，但需要格式 1-3。我使用 CollabNet SVN（大约一年前）创建了我的存储库，但无法从 Zend Studio 中打开该存储库。

我认为最好的解决方案（至少对于我想使用 Zend Studio 而不是与之抗争的情况）是使用旧版本的 SVN 重新创建您的存储库。SVN 1.3 for Windows 的 URL 是：

[http://subversion.tigris.org/files/documents/15/32856/svn-1.3.2-setup.exe](http://subversion.tigris.org/files/documents/15/32856/svn-1.3.2-setup.exe)

安装后，确保在新安装的 1.3 版目录中执行 svnadmin.exe 和 svn.exe，以防您已经安装了 CollabNet SVN（默认安装目录为 c:/csvn）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-27T03:11:28.400

确保您使用的是正确的 svnadmin。例如，如果您安装了 VisualSVN，则需要使用位于安装目录 bin 文件夹中的 svnadmin。我已经安装了 SVN 的命令行版本......当我使用这个版本的 svnadmin 工具时，我得到了同样的错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-14T11:14:24.310

谢谢，乔。我同时安装了 CollabNet SVN 服务器和 VisualSVN，并且一直出错，直到我确定我使用的是 VisualSVN 附带的 svnadmin 版本（我曾用它来创建存储库）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-09-23T12:14:47.070

我可以通过更新服务器上的 Subversion 来解决这个问题。我还对 db 文件进行了调整。然后我将所有备份推送到服务器上作为覆盖。我实际上（在 Windows 上）在本地进行了结帐，然后在创建该 repo 时生成的文件，我编辑了数据库，然后抓取所有文件并将它们推送到服务器上的 SVN。

这似乎成功了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-06T08:37:24.750

好吧，我也面临同样的问题。只需打开您创建的 svn 远程文件夹。在您的 db 文件夹中，您有格式文件。只是更换没有。与 1\. 如果它不起作用，请尝试 2​​ 和 3。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-08-18T14:48:55.537

如果您使用的是 VisualSVN 服务器，请确保您的命令如下所示

示例命令：C:\Program Files\VisualSVN Server\bin>svnadmin dump c:\repo > c:\backup\svnbacku p.dump

# clipboard - 无法在屏幕中使用 X 剪贴板

> ID：838394
> 
> 赞同：1
> 
> 时间：2009-05-08T05:43:10.557
> 
> 标签：clipboard, gnu-screen

我在第 117 页的 Unix Power Tools 中阅读了以下代码

```
 *VT100.Translations: #override\
     Button1 <Btn3Down>: select-end(primary,CUT_BUFFER0,CLIPBOARD)\n\
     !Shift <Btn2Up>: insert-selection(CLIPBOARD)\n\
     ~Shift ~Ctrl ~Meta <Btn2Up>: insert-selection(primary,CUT_BUFFER0) 
```

我还没有看到上述代码的任何效果。

**如何在**没有鼠标的情况下在 Screen 中使用 X 剪贴板？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-23T02:56:42.743

使用鼠标。左键拖动选择，通常鼠标中键粘贴，但某些终端可能不同（PuTTY 使用右键单击）。如果您只有两个按钮，请同时单击它们（鼠标左键 + 鼠标右键）。

回复下面的评论（“你可以不用鼠标吗？”）：

```
ctrl-insert : copy

shift-insert : paste

shift-delete : cut

shift-ctrl-C : copy

shift-ctrl-V : paste 
```

并非所有应用程序都支持最后三个（尽管 Konsole 支持）。事实上，大多数控制台应用程序不允许您在打印文本后删除它。

至于在没有鼠标的情况下选择文本，我不确定是否有通用机制。它可能是终端和/或特定于应用程序的（即，vim 有自己的用于标记和复制文本的键 - 但仅限于 vim 内）。您可以通过鼠标仿真来做到这一点，但我相信这将是一个痛苦的过程。

您不能在终端中使用传统的 Mac/Windows 快捷方式，因为它们在这些操作系统存在之前很久就被保留用于不同的操作（即 Ctrl-C 终止正在运行的进程）。

> 我正在尝试在 X 中使用 Ctrl-C

X 不直接处理这些操作，它们由应用程序处理。这就是为什么像 Firefox 或 Gedit 这样的现代 GUI 程序支持 Ctrl-C 进行复制但终端和命令行程序通常不支持的原因。正如我所说，这是既定约定中的冲突，而 Ctrl-C for kill 则首先出现。

顺便说一句，如果它让你发疯，你可以做一些键重新映射，但是当你使用不同的机器时，你会学习坏习惯。最好只是习惯它或在 GUI 应用程序中进行大部分编辑。

[更多信息](http://www.jwz.org/doc/x-cut-and-paste.html)

**编辑**：对于 Mac，这可能会有所帮助：[MacOSX-to-Konsole](http://www.nabble.com/Copy-paste-from-mac-os-X-to-Konsole.-td20378040.html)或[This](http://forums.macosxhints.com/archive/index.php/t-29962.html)或[This](http://www.commandlinefu.com/commands/view/751/mac-os-x-copy-and-paste-things-to-and-from-the-clipboard-from-the-shell)。看起来您需要在 Mac 键盘上将 Ctrl 替换为 Command 。似乎终端 mac 控制台有一个用于复制粘贴的右键单击上下文菜单，所以要按照传统方式进行操作，我需要安装不同的控制台程序或更改终端中的某些设置。

# c# - Stream zip 文件 MVC.NET 开始流式传输

> ID：838397
> 
> 赞同：6
> 
> 时间：2009-05-08T05:46:40.877
> 
> 标签：c#, asp.net-mvc

我正在尝试创建一种方法，该方法在用户下载它时不断流式传输 zip 文件（这样就不会浪费流式传输）

我添加了一个 thread.sleep 来模拟延迟

```
public override void ExecuteResult(ControllerContext context) {
    HttpResponseBase response = context.HttpContext.Response;

    response.Clear();
    response.ClearContent();
    response.ClearHeaders();
    response.Cookies.Clear();
    response.ContentType = ContentType;
    response.ContentEncoding = Encoding.Default;
    response.AddHeader("Content-Type", ContentType);
    context.HttpContext.Response.AddHeader("Content-Disposition", 
                            String.Format("attachment; filename={0}", 
                            this.DownloadName));
    int ind = 0;
    using (ZipOutputStream zipOStream = 
                new ZipOutputStream(context.HttpContext.Response.OutputStream))
    {
        foreach (var file in FilesToZip)
        {
            ZipEntry entry = new ZipEntry(FilesToZipNames[ind++]);
            zipOStream.PutNextEntry(entry);
            Thread.Sleep(1000);
            zipOStream.Write(file, 0, file.Length);
            zipOStream.Flush();
        }
        zipOStream.Finish();
    }    
    response.OutputStream.Flush();
} 
```

似乎在所有文件都被压缩之前，zip 不会开始流式传输。有没有办法连续流？也许有不同的图书馆？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-08T06:59:48.203

假设 zip 格式是流媒体的一部分，你的问题是你的响应默认被缓冲。如果将[HttpResponseBase.BufferOutput](http://msdn.microsoft.com/en-us/library/system.web.httpresponsebase.bufferoutput(loband).aspx)设置为 false，它应该立即开始流式传输。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T06:44:02.983

我认为您可能需要刷新输出流而不是 zipostream 才能查看到 http 的任何输出。所以 response.OutputStream.Flush() 在这种情况下会出现在你的循环中。不确定它是否真的能解决你的问题。

# c - 在 C 中实现 HashMap

> ID：838404
> 
> 赞同：53
> 
> 时间：2009-05-08T05:50:11.117
> 
> 标签：c, data-structures, hashmap

如何像 C++ STL 中那样从头开始在 C 中创建 Hashmap？

将考虑哪些参数以及如何测试哈希图？例如，在您可以说您的哈希图已完成之前，您将运行的基准测试用例是什么？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-05-08T05:55:41.213

好吧，如果您了解它们背​​后的基础知识，那应该不会太难。

通常，您会创建一个名为“buckets”的数组，其中包含键和值，以及用于创建链接列表的可选指针。

当您使用键访问哈希表时，您使用自定义哈希函数处理该键，该函数将返回一个整数。然后你取结果的模数，这就是你的数组索引或“桶”的位置。然后你用存储的密钥检查未散列的密钥，如果匹配，那么你找到了正确的位置。

否则，您就发生了“冲突”，必须爬过链表并比较键，直到匹配为止。（注意一些实现使用二叉树而不是链表来解决冲突）。

查看这个快速哈希表实现：

[https://attractivechaos.wordpress.com/2009/09/29/khash-h/](https://attractivechaos.wordpress.com/2009/09/29/khash-h/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T05:52:48.410

最佳方法取决于预期的密钥分布和冲突次数。如果预计碰撞相对较少，则使用哪种方法实际上并不重要。如果预计会有很多冲突，那么使用哪一个取决于重新散列或探测与操作可扩展桶数据结构的成本。

但这里是[C 中 An Hashmap Implementation 的源代码示例](https://web.archive.org/web/20160329102146/http://elliottback.com/wp/hashmap-implementation-in-c/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-11-11T10:50:19.887

hashmap 的主要目标是存储数据集并使用唯一键对其进行近乎恒定的时间查找。有两种常见的 hashmap 实现方式：

*   单独的链接：一个带有一组桶（链表）的链接
*   开放式寻址：分配有额外空间的单个数组，因此可以通过将条目放在相邻的插槽中来解决索引冲突。

如果 hashmap 可能具有较差的散列函数，不希望为可能未使用的插槽预分配存储空间，或者条目可能具有可变大小，则单独链接是可取的。即使负载因子超过 1.0，这种类型的 hashmap 也可以继续相对有效地运行。显然，每个条目都需要额外的内存来存储链表指针。

当负载因子保持在某个阈值以下（通常约为 0.7）并使用相当好的散列函数时，使用开放寻址的散列图具有潜在的性能优势。这是因为它们避免了潜在的缓存未命中和与链表相关的许多小内存分配，并在一个连续的、预先分配的数组中执行所有操作。迭代所有元素也更便宜。问题是使用开放寻址的哈希图必须重新分配到更大的大小并重新哈希以保持理想的负载因子，否则它们将面临显着的性能损失。它们的负载系数不可能超过 1.0。

创建哈希图时要评估的一些关键性能指标包括：

*   最大负载系数
*   插入时的平均碰撞次数
*   冲突的分布：不均匀分布（聚类）可能表明散列函数不佳。
*   各种操作的相对时间：放置、获取、删除现有和不存在的条目。

这是我制作的一个灵活的 hashmap 实现。我使用开放寻址和线性探测来解决冲突。

[https://github.com/DavidLeeds/hashmap](https://github.com/DavidLeeds/hashmap)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T06:32:21.937

除了简单的溢出条目链接列表之外，还有其他机制来处理溢出，例如浪费大量内存。

使用哪种机制取决于您是否可以选择散列函数并可能选择多个（例如实现双散列以处理冲突）；如果您希望经常添加项目，或者地图在填充后是静态的；您是否打算删除项目；...

实现这一点的最佳方法是首先考虑所有这些参数，然后不要自己编写代码，而是选择一个成熟的现有实现。谷歌有一些很好的实现——例如[http://code.google.com/p/google-sparsehash/](http://code.google.com/p/google-sparsehash/)

# subsonic - 如何在 SubSonic 中使用“一对多”关系

> ID：838410
> 
> 赞同：1
> 
> 时间：2009-05-08T05:54:31.463
> 
> 标签：subsonic, foreign-key-relationship

*   有什么方法可以告诉 SubSonic 关系（只有外键？或其他方法）？
*   如果我有（例如）一个包含相关团队成员的团队对象

    ** 我如何访问和更新团队中的团队成员

    ** 如何更新团队成员？保存团队对象是否会保存团队成员更改

    ** 如何将成员添加到团队中？我是否只是创建一个新成员，将团队 ID 分配给外键并保存？还是有更面向对象的方式（例如team.Add(teamMember)）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T06:55:20.493

Subsonic 代码生成将读取表中的外键关系并在表类中创建所需的辅助方法。Northwind Product 类与 OrderDetail 类具有 PrimaryKey 关系。Subsonic 生成方法

公共 Northwind.OrderDetailCollection OrderDetails()

将 OrderDetail 行作为 OrderDetailCollection 获取。这是一个 BindingList，您可以根据需要进行更改，并调用 SaveAll() 来保存列表。没有深度保存，因此保存 Product 不会保存相关的 OrderDetail 行。

```
[Test]
public void Demo_Product_OrderDetails()
{
    Product product = new Product(3); // Read an existing row.
    OrderDetailCollection orderDetails = product.OrderDetails();
    Assert.IsTrue(orderDetails.Count == 12);
    foreach(OrderDetail orderDetail in orderDetails)
    {
        orderDetail.Discount -= 0; // Do something meaningful.
    }
    OrderDetail newDetail = new OrderDetail();
    newDetail.ProductID = 3;
    newDetail.OrderID = 10248;
    newDetail.UnitPrice = 7.00m;
    newDetail.Discount = 0.10f;
    newDetail.Quantity = 12;
    orderDetails.Add(newDetail);
    orderDetails.SaveAll();

    orderDetails = product.OrderDetails();
    Assert.IsTrue(orderDetails.Count == 13);

    OrderDetail.Destroy(newDetail.OrderID);

    orderDetails = product.OrderDetails();
    Assert.IsTrue(orderDetails.Count == 12);

} 
```

# windows - 更改正在运行的进程的设置

> ID：838414
> 
> 赞同：0
> 
> 时间：2009-05-08T05:55:58.187
> 
> 标签：windows, winapi, dll, process, operating-system

我注意到当一个进程第一次启动时，它只静态读取一些系统参数信息并保持它直到终止

意思是，

如果对进程已经读取的系统参数进行了一些修改，它们将在进程重新启动之前反映。

例如启动记事本并输入';' 键盘上的键。现在将语言工具栏中的输入语言更改为西班牙语。现在再次按下键';'。尽管输入语言已更改为西班牙语，但按键仍然是英语（如按“;”键所示）。

理想情况下按';' 输入语言更改为西班牙语后，我们应该注意到“ñ”。

当我们**重新启动**记事本时，我们注意到';' 结果为“ñ”，这意味着需要重新启动记事本进程才能生效。

是否有某种方式不需要重新启动进程以反映输入法的变化？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T06:46:10.950

如果一个进程愿意，它可以监听各种系统范围设置的更改通知。这个[`wm_SettingChange`](http://msdn.microsoft.com/en-us/library/ms725497.aspx)消息浮现在脑海。

如果还没有被写入，那么尝试进行*其他一些流程荣誉设置更改是愚蠢的差事。*如果一个程序尚未侦听更改通知并对其采取行动，则您无法使其采取不同的行动。

记事本可能不是一个很好的例子。这是一个非常简单的程序，因此它不一定涵盖一个好的 Windows 程序应该包含的所有细节。

您为完善您的问题而给出的“答案”谈到了使用[`SystemParametersInfo`](http://msdn.microsoft.com/en-us/library/ms724947.aspx). 当您调用该函数时，它将广播`wm_SettingChange`消息。要收到更改通知，其他程序需要侦听该消息；以与您在编程环境中侦听任何其他窗口消息相同的方式执行此操作。

当您收到该消息时，`wParam`参数将是`spi_GetDefaultInputLang`or `spi_SetDefaultInputLang`; 我不知道是哪个。这就是您调用`SystemParametersInfo`以找出设置的新值的提示。根据我刚刚在[“语言、区域设置和键盘布局”](http://msdn.microsoft.com/en-us/library/ms646267.aspx#_win32_Languages_Locales_and_Keyboard_Layouts)中读到的内容，您应该[`ActivateKeyboardLayout`](http://msdn.microsoft.com/en-us/library/ms646289.aspx)使用`HKL`从中获得的值进行调用`SystemParametersInfo`。

更改默认输入语言的进程不能强制其他进程使用它。在他们选择自己更改输入语言之前，他们将继续使用开始运行时的任何语言。*这就是默认*设置和*当前*设置之间的区别。

# c# - 如何在数据网格（Windows Mobile）中标记一行？

> ID：838421
> 
> 赞同：0
> 
> 时间：2009-05-08T05:59:46.100
> 
> 标签：c#, windows-mobile

我如何运行任何查询，并标记我在 Datagrid 中找到的第一行？

我在[Windows Mobile](http://en.wikipedia.org/wiki/Windows_Mobile)、.NET FrameWork 3.5 上工作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T14:19:18.967

For #1, take a look at Ilya Tumanov's [example of custom formatting data in the DataGrid](http://blogs.msdn.com/netcfteam/archive/2006/04/25/583542.aspx). He does custom painting of cells in it, which is how you would achieve highlighting.

# c++ - 为什么循环摘要在 gprof 的调用图输出中没有任何调用者？

> ID：838425
> 
> 赞同：2
> 
> 时间：2009-05-08T06:01:14.880
> 
> 标签：c++, profiling, gprof, call-graph

我使用 GNU gprof 2.15.94.0.2.2 对我的 C++ 程序进行分析，该程序的调用周期很大。[正如gprof 的文档所示](http://www.cs.utah.edu/dept/old/texinfo/as/gprof.html#SEC10)，我希望在调用图输出中看到如下所示的内容：

```
index  % time    self  children called     name
----------------------------------------
                 1.77        0    1/1        main [2]
[3]     91.71    1.77        0    1+5    <cycle 1 as a whole> [3]
                 1.02        0    3          b <cycle 1> [4]
                 0.75        0    2          a <cycle 1> [5]
                    0        0    6/6        c [6]
---------------------------------------- 
```

但是，我`<cycle as a whole>`的所有条目都没有列出任何来电者。他们都是这样的：

```
index  % time    self  children called             name
----------------------------------------------
[8]     65.6    259.55  5342.63  9334767+60122608 <cycle 2 as a whole> [8]
                133.28  2051.45  12043564+74015448    foo <cycle 2> [14]
                18.90   976.38   2379645              bar <cycle 2> [21]
...                                                                      
----------------------------------------------- 
```

由于我的周期非常大，因此很难在一个周期中通过单个函数跟踪调用者。

谁能告诉我为什么输出中缺少循环调用者，以及如何让它们出现？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-24T16:34:45.737

您的应用程序是否使用多线程？gprof 根本不适用于线程。否则，您很可能在 gprof 中遇到了错误。它充满了漏洞并且已经过时。最好使用 oprofile 或 valgrind 之类的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-23T19:32:16.793

我打算将其称为 gprof 中的错误。我设置了一个相互递归函数的简单示例，并得到了与您完全相同的行为。我有功能：

```
int a(int n){return b(n);}
int b(int n){return c(n);}
int c(int n){return (n==0)?n:a(n-1);} 
```

和一个主要（）：

```
for(int j=0; j <1000; ++j)
  for(int i=0; i < 10; ++i)
     cout << a(i); 
```

我尝试用以下命令替换对 a() 的调用：

```
int d(int n){return a(n);} 
```

希望 gprof 能够比来自 main() 的调用更好地注册从 d() 对循环的调用，但我得到了相同的结果。

我还用 printf() 替换了 cout 并制作了一个 C 程序，结果与没有为循环列出调用者的结果相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-23T19:45:42.257

这是您主要关心的问题，还是您有更大的目标，例如尝试找到可以优化的东西？通常，这就是人们使用**gprof**的原因。

[**gprof**就是这样，但你可以做得更好。](https://stackoverflow.com/questions/1777556/alternatives-to-gprof/1779343#1779343)

# c - Borland C下编译

> ID：838430
> 
> 赞同：0
> 
> 时间：2009-05-08T06:03:12.880
> 
> 标签：c, turbo-c

当我将编译器指定为 Borland C 时，我的源代码不会被编译。当编译器被选为 Microsoft Visual Express 时，它会被编译。一旦它在 Microsoft Visual Express 下编译，只有到那时，它才会在 Borland C 下编译。为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T06:21:01.900

我想知道他们是否使用可互换的对象格式？

如果是这样，也许您正在使用 Microsoft 特定的扩展。你可以在MS下编译，这会生成一堆目标文件。然后你在 Borland 下编译，它实际上并没有编译（因此不会对 MS 特定的扩展名产生误解）——它只是链接，因为目标文件已经存在。

# php - 以每个用户为基础存储多个问题投票结果的最佳方式？

> ID：838436
> 
> 赞同：2
> 
> 时间：2009-05-08T06:05:41.593
> 
> 标签：php, mysql

我有一个有五个 1-5 星评级的民意调查，我需要为每个用户单独存储这些值。是否有类似于位域的方法可以存储这些枚举值（每个评级为 1、2、3、4 或 5）并轻松提取它们？

目前我最好的选择是存储一个序列化的 PHP 数组，但这会占用一些空间。或者，创建 5 列，我也不希望这样做（浪费空间）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T08:14:05.280

好吧，无论你做什么，绝对不要通过为每个可能的答案创建一个列来进行非规范化。如果您使用的是数据库，最灵活的方法是将您的数据存储在这样的地方

```
table polls
poll_id
description

table poll_questions
question_id
poll_id (foreign key to polls)
question_text

table question_answers
answer_id
question_id (foreign key to poll_questions)
answer_text

table user_answers
id
user_id (foreign key to users)
answer_id (foreign key to question_answers) 
```

最容易维护，但不是最快的，因为您可能需要进行连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T06:24:31.113

我对此的第一个想法是使用和存储这样的值：

```
$a="15540"; 
```

用户没有回答最后一个问题。$a[0] 是第一个投票的值，即：1。

也许不是最快但很简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T14:23:00.737

考虑到这是一项民意调查，您将希望在某个时候获得一些统计数据。

您可以将答案平面存储在 a中，`CHAR(5)`或者`VARCHAR(5)`在这种情况下，您将使用 [MySQL 字符串函数](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html)来获取单个答案值。如果您不需要在数据库中计算统计信息，那么只需选择字符串。在 PHP 中，您可以像访问带方括号的数组元素一样访问字符串元素。`$answers = "42133"; $first_answer = $answers[0]; $second_answer = $answers[1];`等等。`$answers = $first_answer . $second_answer . $third`您可以通过连接... 或内爆数组来构建答案字符串`$answers = implode($answer_array);`

一种更简单的方法是像 Artem 建议的那样规范化数据库。

# java - 堆栈数组

> ID：838439
> 
> 赞同：5
> 
> 时间：2009-05-08T06:07:11.527
> 
> 标签：java, eclipse, arrays, generics

是否可以创建一个堆栈数组而不必在堆栈出来时进行投射？当我执行以下操作时，Eclipse 会警告我无法创建一个通用的 Stack 数组：

```
Stack<Card>[] cards = new Stack<Card>[52]; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-08T06:31:29.100

*Joshua Bloch 在Effective Java, Second Edition*中出色地描述了这个问题。[查看 Google 图书搜索的相关部分](http://books.google.com.au/books?id=ka2VUBqHiWkC&pg=PA119&lpg=PA119&dq=bloch+java+generics+arrays&source=bl&ots=yXGgPkq6U4&sig=BtDKify8aUyUE-I_xXxr76ABFzM&hl=en&ei=ldADSqDyBsqrtgefuOWKBw&sa=X&oi=book_result&ct=result&resnum=5)。

他提供的建议是更喜欢列表而不是数组。您的代码可能类似于：

```
List<Stack<Card>> cards = new ArrayList<Stack<Card>>(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T09:09:53.070

```
Stack<Card>[] decks = new Stack[9];       // Declare
Card c = decks[5].pop();                  // This compiles - java 'knows' the type
Integer i = decks[4].pop();               // This will not compile 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T06:17:25.467

您可以执行以下操作，但这会给您一个编译器“未经检查”的警告。

```
Stack<Card>[] cards = (Stack<Card>[]) new Stack[52]; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T06:17:19.523

为什么你仍然使用数组？

它是一种低级编程结构。

如果您不想打扰初始化，请使用`List`or`Set`代替（例如）。`org.apache.commons.collections.list.LazyList`

或者至少

`Arrays.asList(new Stack[52])`将数组包装到列表中。

我无论如何都无法重现 jour 错误 .. :( 可能是因为设置了不同的警告/错误级别。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T06:13:03.450

好吧，数组不需要是泛型的，因为他总是这样定义的。为什么你认为你必须投？我认为日食在这里有些困惑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T06:22:28.997

这与类型擦除有关。基本上，泛型类型仅在编译时存在，在运行时不存在

请查看[此论坛帖子](http://www.velocityreviews.com/forums/t368874-why-cant-i-create-a-generic-array.html)以获得更好的解释。

# nhibernate - 使用 ASP.NET 缓存对象的 NHibernate 2.0.1.GA 缓存提供程序

> ID：838440
> 
> 赞同：0
> 
> 时间：2009-05-08T06:07:32.587
> 
> 标签：nhibernate

我已将我的应用程序从 NHibernate 1.2.1 迁移到 NHibernate 2.0.1。现在我收到错误“编译时出现版本冲突错误”。它表明该应用程序仍在使用 NHibernate V1，但我通过删除旧 dll 并在应用程序引用中添加了新 dll 来更改版本。

我唯一没有改变的是 NHibernate.Caches.SysCache.SysCacheProvider 并且它仍然指向旧版本“1.0.1”。

我怎么能迁移这个，请帮助我

-Gunasekaran 桑班丹

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T07:30:29.767

NHibernate.Caches is part of the [contrib package](http://sourceforge.net/project/showfiles.php?group_id=216446). You need to download the latest version and update your assembly.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-23T20:18:44.363

您可以使用应用程序配置文件或 webconfig 文件中提供的 Assembly 重定向，如下所示 `<runtime> <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1"> <dependentAssembly> <assemblyIdentity name="NHibernate" publicKeyToken="AA95F207798DFDB4" culture="neutral"/> <bindingRedirect oldVersion="0.0.0.0-2.1.0.2001" newVersion="2.1.0.1002"/> </dependentAssembly> </assemblyBinding> </runtime>`

# semantic-web - 为什么我在 protege4 中看不到查询结果？

> ID：838447
> 
> 赞同：0
> 
> 时间：2009-05-08T06:12:11.377
> 
> 标签：semantic-web, owl, protege4

我知道这可能是一个愚蠢的问题，但我不知道答案:)

我正在使用[protege4](http://protege.stanford.edu/download/registered.html)我构建了我的本体，当我尝试从 protege4 中的 DL 查询点击使用 DL Query 时，它执行得很好并且我得到了结果。

但是，当我单击“添加到本体”将我的查询添加到本体时，它会添加它但没有任何查询结果！！！为什么没有查询结果？怎么看？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T08:28:33.513

首先是一些术语：

*   每个**OWL 本体**都是一**组 OWL 公理**。
*   每个**DL-Query**都是一个**OWL 类表达式**。
*   每个**DL-Query 结果**都是一**组 OWL 实体**。

您只能将公理添加到本体。您不能将类表达式或实体集添加到 OWL 本体。

“添加到本体”按钮似乎在查询（即类表达式）和命名类（由用户给出）的基础上创建了一个新的*EquivalentClasses* -公理，然后将这个公理断言到活动本体中，即

```
EquivalentClasses(new_name query) 
```

（在我的 Protege 4 版本中，我并没有完全让它像这样工作，但这样的功能是有意义的。）

当前的 OWL2 规范没有说明如何在本体中存储类表达式和查询结果。从文件加载本体后，每次都必须从头开始指定和计算这些。

# firefox - 无法在 Firefox 中使用 Screen 的剪贴板

> ID：838453
> 
> 赞同：0
> 
> 时间：2009-05-08T06:16:47.230
> 
> 标签：firefox, clipboard, gnu-screen

我没有设法让我的 pbcopy/pbpaste 在 Screen 中工作，如此[处](https://stackoverflow.com/questions/816302/unable-to-pbcopy-xsel-inside-screen)所述。

我的目标是通过在 Firefox 中安装 Screen 剪贴板来解决这个问题。它的粘贴通过以下命令在终端中起作用，但在 Firefox 中不起作用

```
C-a ] 
```

**如何在 Firefox 中使用 Screen 的剪贴板？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T07:03:31.563

这是一个使用屏幕缓冲区写入命令的解决方案，并且`pbcopy`：

*   [将 GNU 屏幕缓冲区复制到 Leopard 剪贴板](http://www.samsarin.com/blog/2008/10/18/copying-gnu-screen-buffer-to-leopard-clipboard/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T07:06:10.810

屏幕的剪贴板（正确称为粘贴缓冲区）仅在该屏幕实例内工作。这就是它的设计目的。

复制粘贴到 FireFox 的最佳方式是使用终端程序的复制机制。

# ruby-on-rails - 脚手架在控制器定义中不再有效吗？

> ID：838456
> 
> 赞同：2
> 
> 时间：2009-05-08T06:18:01.813
> 
> 标签：ruby-on-rails, controller, scaffolding

```
class AdminController < ApplicationController

  scaffold :album

end 
```

在 Rails 1.1.6 教程中，我被指示将代码“scaffold :album”放在我的管理控制器中。这是一个包含名为“Album”的模型的音乐应用程序。

**这产生了一个错误，指出脚手架不是有效的方法**。

这是最新版本的 Rails 中已弃用/过时的语法吗？

我期待这会为我的专辑模型生成所有适当的通用 CRUD 脚手架。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T06:34:41.353

该`scaffold`方法在 Rails 2 中已弃用。请参阅[为什么 Ruby on Rails 弃用了脚手架方法](https://stackoverflow.com/questions/526891/why-did-ruby-on-rails-deprecate-the-scaffold-method)

# java - Java 异常与 C++ 异常

> ID：838460
> 
> 赞同：9
> 
> 时间：2009-05-08T06:21:21.463
> 
> 标签：java, c++, exception

异常存储在哪里？堆栈，堆。如何为异常分配和释放内存？现在，如果您有多个需要处理的异常，是否会创建所有这些异常的对象？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T06:27:56.143

我会假设异常内存的分配方式与所有其他对象（在堆上）的分配方式相同。

这曾经是一个问题，因为那时您无法为 OutOfMemoryError 分配内存，这就是为什么在[Java 1.6 之前没有堆栈跟踪](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4753347)的原因。现在他们也为堆栈跟踪预分配空间。

如果您想知道在抛出异常时*对异常的引用*存储在哪里，JVM 会在内部保留引用，同时展开调用堆栈以查找异常处理程序，然后由谁获取引用（在其堆栈帧上，就像任何其他局部变量）。

不能同时抛出两个异常（在同一个线程上）。它们可以嵌套，但是您只有一个引用嵌套异常的“活动”异常。

当对异常的所有引用都消失时（例如，在异常处理程序完成后），异常会像其他所有内容一样被垃圾收集。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T06:54:05.410

对于 C++，它没有定义存储异常的位置，但大多数编译器使用特殊的堆栈。对于有人之前写的Java，它们存储在堆上。

由于异常是 C++ 和 Java 中的对象，因此它们在特定语言中作为对象进行分配和释放。

在两种语言中，每个线程始终只有一个异常活动。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T06:33:47.940

有关异常的最完整信息，我们可以直接访问源代码：[Chapter 11: Exceptions](http://java.sun.com/docs/books/jls/second_edition/html/exceptions.doc.html#44153) of [The Java Language Specification, Second Edition](http://java.sun.com/docs/books/jls/second_edition/html/jTOC.doc.html)。

异常确实是对象。它们是 的子类`Throwable`：

> 每个异常都由 Throwable 类或其子类之一的实例表示；这样的对象可用于将信息从发生异常的点传送到捕获它的处理程序。

因此，可以安全地假设，与`Object`Java 中的任何其他内容一样，它将在堆上分配。

就拥有多个`Exception`对象而言，情况可能并非如此，因为一旦发生异常，Java 虚拟机将开始寻找异常处理程序。

> 在抛出异常的过程中，Java 虚拟机会突然将所有在当前线程中已经开始但尚未完成执行的表达式、语句、方法和构造函数调用、初始化器和字段初始化表达式一个一个地完成。这个过程一直持续到找到一个处理程序，该处理程序通过命名异常的类或异常类的超类来指示它处理该特定异常。

有关如何在运行时处理异常的更多信息，[第 11.3 节处理异常](http://java.sun.com/docs/books/jls/second_edition/html/exceptions.doc.html#44153)有详细信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T06:28:53.927

Java 中的异常是对象，因此它们存储在堆中。

当抛出异常时，JVM 在代码中寻找匹配的异常处理程序。即使存在可能引发的多个异常，这也适用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T06:29:35.110

> 异常存储在哪里？堆栈，堆。如何为异常分配和释放内存？

在这方面，例外是与任何其他对象一样的对象。通过 分配在堆上`new`，由垃圾收集器释放。

> 现在，如果您有多个需要处理的异常，是否会创建所有这些异常的对象？

不知道你是什么意思。它们是通过创建`new`的，一次一个。当您使用异常链接时，周围可能不止一个 - 实际上没有什么可以阻止您创建数千个异常并将它们放在某个地方的 List 中 - 这没有多大意义。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T19:25:58.900

在 Java 中，Exception 扩展了 Throwable，后者扩展了 Object。即从内存的角度来看，它就像任何其他对象一样。

在 Java 7 中建议可以使用转义分析将局部变量放置在堆栈上，以查找堆栈变量的候选者。但是，异常通常从方法抛出给调用者（或其调用者等），因此将异常放在堆栈上并不是很有用。

# javascript - 你知道 1024 Overriding a function error on flex (flash) in action script 3 吗？

> ID：838461
> 
> 赞同：0
> 
> 时间：2009-05-08T06:22:10.277
> 
> 标签：javascript, apache-flex, flash, actionscript-3, air

在我的项目中，我使用了以下功能

```
 public function createIconMenu():NativeMenu{
        var iconMenu:NativeMenu = new NativeMenu();
iconMenu.addItem(new NativeMenuItem("", true));//Separator
        if(NativeApplication.supportsSystemTrayIcon){
            iconMenu.addItem(showCommand);
            showCommand.addEventListener(Event.SELECT, onShowCommand);      
            iconMenu.addItem(new NativeMenuItem("", true));//Separator      
            var exitCommand: NativeMenuItem = iconMenu.addItem(new NativeMenuItem("Exit"));
            exitCommand.addEventListener(Event.SELECT, exit);   
        }       

            return iconMenu;
    }

    public function exit(event:Event):void{
        NativeApplication.nativeApplication.exit();
    } 
```

但在此公共函数退出显示错误，如 1024：覆盖未标记为覆盖的函数。

我做错了什么代码？. 你能解释一下吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T06:32:52.463

将函数重命名为`exit`其他名称。这与系统提供的全局命名空间中的另一个函数发生冲突，用户无法覆盖该函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-06T21:31:29.920

Reset.addEventListener(MouseEvent.CLICK, play);

函数播放（事件：鼠标事件）：无效 { gotoAndPlay(1); }

这个简单的代码我遇到了同样的问题

# c# - 为什么在 C# 中使用 Encoding.ASCII != ASCIIEncoding.Default？

> ID：838474
> 
> 赞同：2
> 
> 时间：2009-05-08T06:29:25.187
> 
> 标签：c#, encoding, character-encoding

为什么 Encoding.ASCII != ASCIIEncoding.Default 在 C# 中？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-08T06:40:05.850

这是因为`ASCIIEncoding`派生自`Encoding`，其中`Default`定义为：

```
/// <summary>  
/// Gets an encoding for the operating  
/// system's current ANSI code page.  
/// </summary>  
public static System.Text.Encoding Default
{ get; } 
```

所以`ASCIIEndcoding.Default`实际上返回操作系统的默认 ANSI 编码。

# postgresql - 在 Postgres 中添加 current_timestamp 和 days 列的总和

> ID：838478
> 
> 赞同：3
> 
> 时间：2009-05-08T06:32:15.070
> 
> 标签：postgresql, timestamp

我想通过将天数添加到当前时间来更新列。在伪语法中它将是：

```
UPDATE foo
SET time = current_timestamp + days::integer 
```

days 是同一张表中的一列。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T06:44:13.920

```
select now() + cast('1 day' as interval) * 3 -- example: 3 days 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T07:02:30.303

```
create function add_days_to_timestamp(t timestamptz, d int) 
returns timestamptz
as
$$
begin
    return t + interval '1' day * d;
end; 
$$ language 'plpgsql';

create operator + (leftarg = timestamptz, rightarg = int, 
         procedure = add_days_to_timestamp); 
```

现在这将起作用：

```
update foo set time = current_timestamp + 3 /* day variable here, 
or a column from your table */ 
```

**笔记：**

出于某种原因，在 Postgres 中内置了将整数添加到日期，这将起作用：

```
select current_timestamp::date + 3 -- but only a date 
```

这不会（除非您定义自己的运算符，见上文）：

```
select current_timestamp + 3 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-01-09T21:59:14.673

没有时区的计算日期时间戳；

```
calculatedDate := current_timestamp + interval '1' day * days_count; 
```

# design-patterns - 关于设计模式的速成课程有什么建议吗？

> ID：838484
> 
> 赞同：21
> 
> 时间：2009-05-08T06:35:29.870
> 
> 标签：design-patterns

我将为我公司的开发人员提供有关设计模式的速成课程（在最近遇到了一些可怕的代码之后）。

我想说的最重要的事情之一是它们在长期和短期内都节省了时间（他们确实这样做了！）——因为这里的开发人员面临着相当多的时间压力。总而言之，我需要展示每天的好处——能让他们早点回家的东西。

告诉他们这可能意味着更少的错误可能不会打到家里。我需要会沉入水中的东西。

我可能会做三到四次，每次一小时。你们对接触/做什么有什么建议吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-08T06:44:27.617

[Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)将是一个很好的起点。它涵盖了主流的设计模式。

[重构为模式](https://rads.stackoverflow.com/amzn/click/com/0321213351)也可能很有趣。

如果你不能为每个开发者都买一本书，那就买几本，然后四处传播。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-06-23T15:24:26.853

在我看来，任何教育课程的良好开场幻灯片是：

1.  我们为什么在这里？（在哪里确定了对这门课程的需求？）
2.  我期望学到什么？
3.  谁应该参加这门课程？（目标学生、先决条件等是什么？）
4.  我什么时候可以应用我学到的东西？
5.  对您的期望（参与、作业、测试、参加的最低课程等）

对于设计模式，我可以期待一些可视化工具或“[工作辅助工具](https://learningforward.org/docs/jsd-spring-1999/champion202.pdf)”。

我会遵循类似于[Elements of Reusable Object-Oriented Software](https://rads.stackoverflow.com/amzn/click/com/0201633612)一书的结构：

1.  UML – 类图概述
2.  OOP——抽象、封装、多态、继承
3.  内聚和耦合
4.  什么是设计模式？– 模式名称、问题、解决方案、后果
5.  为什么设计模式这么难学？
6.  为什么要使用设计模式？
7.  如何选择设计模式？
8.  如何使用设计模式？
9.  用示例涵盖各种[GoF](http://dofactory.com/Patterns/Patterns.aspx)设计模式——在应用设计模式之前展示代码示例，以及它是如何处理的，就像[Vince Huston](http://www.vincehuston.org)在他的[示例](http://www.vincehuston.org/dp/state.html)中所做的那样。
10.  结论

如前所述，设计模式确实是想法，因此在教学时必须传达想法。如果他们了解设计模式的问题、解决方案和后果，那么他们将比试图将模式强加到代码中要好得多（这将成为一场噩梦）。识别可以应用的位置和模式（如果有的话）是真正的目标。Huston 的示例非常适合向班级展示代码示例，并查看他们是否可以识别出改进它的模式。希望这可以帮助。

[Head First Design Patterns](https://www.oreilly.com/library/view/head-first-design/0596007124/)也是一个很好的参考。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-08T06:45:04.447

模式很难先学习。那时我经常阅读[GoF 的书。](http://en.wikipedia.org/wiki/Design_Patterns_(book))每年都会有另一种模式进入我的脑海。所以我唯一的建议是，你最多选择两种模式，并举出许多例子来解决什么问题。

复合是每个人都知道的东西。在这一点上，您可以解释说知道它具有您可以使用和交流的名称可能很重要。模式的重要之处在于，它可以让其他人轻松识别您的意图。这个小名字很有帮助。

我个人发现模板方法模式在基于 OO 的开发中非常适合处理。它与 OOP 应该如何发生非常接近，以至于它也可能具有改进编码风格的好处。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-08T06:49:18.807

大多数书籍用来解释模式的方法与我希望看到的完全相反。他们采用一种模式，描述先决条件和什么不是，然后给你一个例子。我更愿意提出具体问题，并讨论替代方案。最突出的就是“模式”——只有到那时才引入它。

选择 a) 简单且 b) 最有可能在您的代码中使用的模式。单例很容易学习（因为它们不涉及主题/对象）。另一个有趣的是观察者模式。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-08T06:57:05.853

对于课程提供者来说，您处于一个独特的位置：您了解开发人员并且您知道他们正在使用的代码。

一种可能的方法是查看一些可怕的代码，然后按照“我们如何才能改进它？碰巧有一种称为观察者的设计模式......”。

这最终可能是[设计模式](https://rads.stackoverflow.com/amzn/click/com/0201633612)和[重构](https://rads.stackoverflow.com/amzn/click/com/0201485672)的混合。但这可能是合适的，因为您正试图联系使用现有代码库的开发人员。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-08T07:34:30.163

学习模式的问题是您必须有足够的软件经验才能在您编写或维护的代码中看到模式（通常未命名）。如果你从来没有写过观察者，那么阅读模式的描述并不容易理解。

我并不是说您不应该阅读有关模式的内容。但请注意，一个人欣赏模式的能力受到一个人缺乏经验的限制。

模式的另一个问题，以及您将遇到的问题，是它们不存在。至少它们的存在比“软件”的存在还要少。模式是想法和概念。它们不是可运行的代码。可运行的代码可以实现一个模式，但反过来不存在。你不能只在代码中输入“singleton”，然后突然就出现了一个单例。没有一种语言可以突然添加“访问者”属性来实现访问者模式。有各种语言的最佳实践和模式示例，但它们不是你可以放在库中然后调用的东西。

所以你真正想做的是教授一些最佳实践，这些实践的核心涉及识别和使用模式。观察力是一项非常难以教授的技能（对于所有形式的观察）。

模式的第三个问题是它们实际上并不是程序员的领域。它们被正式称为设计模式是有原因的。它们是最恰当的设计时构造。当然，您可以使用模式来帮助重构现有代码。但总的来说，设计模式是简化设计讨论的行话。这也是为什么没有任何单例代码库的原因。使用单例是一种编写代码的方法，而不是代码本身。

综上所述，尝试对您的程序员进行有关设计模式的教育并没有什么坏处。让程序员思考是一件好事，如果他们中只有一个人对模式的理解不只是表面上的理解，那么你可能会领先于游戏。祝你好运。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-08T08:08:26.573

看看这个网站： http: [//www.dofactory.com/Patterns/Patterns.aspx](http://www.dofactory.com/Patterns/Patterns.aspx) 它专注于许多类型的创建、结构和行为模式，并给出了结构、真实世界和 .net 优化代码的示例。希望这可以帮助

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-01-09T11:08:22.520

这是来自 Nettuts+ 的教程：[设计模式初学者指南](http://net.tutsplus.com/articles/general/a-beginners-guide-to-design-patterns/)

很容易理解。非常适合开始设计模式。

本教程清楚地解释了：

> *   为什么设计模式很重要
> *   何时以及为什么应该使用它们
> *   在 PHP 中为每种模式提供示例

本教程中解释了以下设计模式：

> *   策略模式
> *   适配器模式
> *   工厂方法模式
> *   装饰图案
> *   单例模式

# c# - 如何使.NET应用程序通过代理访问互联网

> ID：838486
> 
> 赞同：1
> 
> 时间：2009-05-08T06:36:13.393
> 
> 标签：c#

我有一个 dll，它将从互联网上检索某些信息。我从我的包装应用程序中调用这个 dll。但 dll 无法访问互联网，因为它位于公司代理后面。有什么方法可以让我在包装应用程序中进行身份验证（例如，通过提供输入代理用户名和密码的界面），以便 dll 可以访问互联网。

已编辑:: 我正在访问接受用户名和密码登录的谷歌数据 API dll。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T06:39:48.313

您是否控制 DLL 中的代码？DLL 如何请求信息？.NET 对 WebClient 和 HttpWebRequest 等事物当然有代理处理，但您需要提供有关情况的更多信息。

编辑：不幸的是，我在 GData API 中看不到任何公开代理属性的内容。

您可以尝试使用设置默认代理[`GlobalProxySelection.Select`](http://msdn.microsoft.com/en-us/library/system.net.globalproxyselection.select.aspx)。如果这不起作用，请告诉我，我会尝试在内部征求建议。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T06:41:11.273

您可以将您的或对象的`Proxy`属性分配给应用了所需设置的对象。它基本上工作如下：`WebRequest``WebClient``WebProxy`

```
WebRequest request = WebRequest.Create("http://www.mysite.com"); 
request.Proxy = new WebProxy("127.0.0.1", 8080); 
```

您还可以`Credentials`使用`WebProxy`.

请参阅 MSDN 上与[WebProxy 类](http://msdn.microsoft.com/en-us/library/system.net.webproxy.aspx)相关的示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-31T00:35:33.110

GDATA Api 使用您的全局 IE 代理，尝试使用包装应用程序中所需的注册表项设置您的 IE 全局代理，GData api 将自动获取它。

# java - 可视化 Java 项目

> ID：838499
> 
> 赞同：4
> 
> 时间：2009-05-08T06:40:42.040
> 
> 标签：java, android

我的任务是将大型 Java 代码库移植到 Android 平台。该项目广泛使用 Android 不支持的 AWT。

我正在寻找一种工具，可以让我可视化项目中的所有类。我希望能够看到类之间的所有关系，以便我可以很好地了解从哪里开始移植。

如果您有任何有助于完成这项任务的建议，我想听听。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T08:26:54.530

我几乎每天都使用 Structure101 来可视化和理解我们的代码库。一个很棒的工具，价格也很合理。

这个问题之前在 StackOverflow 上已经被多次触及，这里有一些链接：

*   [是否有一些工具可以可视化 java 类层次结构和关系？](https://stackoverflow.com/questions/43344/is-there-some-tool-to-visualize-java-class-heirarchies-and-relations)
*   [用Java可视化代码流的工具？](https://stackoverflow.com/questions/153414/tool-to-visualize-code-flow-in-java)
*   [从 Java 代码生成 UML 的推荐 Eclipse 插件](https://stackoverflow.com/questions/51786/recommended-eclipse-plugins-to-generate-uml-from-java-code)
*   [用于 Java/Eclipse 的好的免费 UML 工具？](https://stackoverflow.com/questions/390438/good-free-uml-tool-for-java-eclipse)

IntelliJ IDEA 还有一些工具可以提供帮助，例如 IDEA 8 中的 Graphical Navigator 和[Code Navigator plugin](http://plugins.intellij.net/plugin/?id=3202)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T06:54:30.323

Netbeans 有一个好的逆向工程工具，它可以输出大量的 UML。我已经有一段时间没有使用它了，但是当我使用它时，它有点小车。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T19:23:55.940

有一个名为 Creole 的 Eclipse 插件，您也可以尝试。[http://www.thechiselgroup.com/creole](http://www.thechiselgroup.com/creole)

# c++ - 在使用 C++ 编程时，我应该如何在 win32 中创建子窗口？

> ID：838511
> 
> 赞同：4
> 
> 时间：2009-05-08T06:44:36.477
> 
> 标签：c++, windows, winapi

我是 C++ 以及 Windows 编程的新手。

我使用 msdn`CreateWindow()`函数创建了一个窗口

哪个工作正常..现在我想创建一个子窗口...父窗口应该控制子窗口...

任何有助于有关此的示例代码。

提前致谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T06:51:35.353

粗略地说，在您希望创建子代的父代处理程序中，您调用`CreateWindow`，将父代的窗口作为- 传入`hwndParent`- 可能您还想在子代上设置某些样式，例如`WS_CHILD`. 您与子窗口的交互取决于您创建的窗口的类型。某些窗口（例如按钮）被设计为子窗口，因此它们会发送大量通知消息，因此您可以设置您的父窗口来监听这些通知消息。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T06:52:06.380

如果您可以获得副本 ，我强烈建议您阅读[Charles Petzold 的“Programming Windows”。](http://www.charlespetzold.com/pw5/index.html)

否则，要回答您的问题，请在创建子窗口时将父窗口的句柄作为父窗口（使用 CreateWindow 或[CreateWindowEx](http://msdn.microsoft.com/en-us/library/ms632680(VS.85).aspx)）：

```
HWND CreateWindowEx
(      
    DWORD dwExStyle,
    LPCTSTR lpClassName,
    LPCTSTR lpWindowName,
    DWORD dwStyle,
    int x,
    int y,
    int nWidth,
    int nHeight,
    HWND hWndParent,      /// pass the parent window handle here
    HMENU hMenu,
    HINSTANCE hInstance,
    LPVOID lpParam
); 
```

..正如 1800 Info 所说，也许还设置了 WS_CHILD 样式（更多信息[Window Style](http://msdn.microsoft.com/en-us/library/ms632600(VS.85).aspx)在这里）。这只是基本的管道，真的..

当你说“控制子窗口......”时，你能更具体一点吗？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2018-03-16T18:11:05.903

现在是 2018 年.. 对此进行一些复古工作我发现**SetParent()**派上用场，以确保子窗口保留在父级的客户区域内.. 在 SetParent() 之前，子级不需要注册为孩子。在 CreateWindowEx 中，父句柄起初可以为 NULL。不需要样式 WS_CHILD，但是**WS_CLIPSIBLINGS**很方便，它可以避免闪烁。

这是我创建子窗口的代码：

```
 HWND hwnd = CreateWindowExA(0, "WindowOfDLL", ctitle, WS_SIZEBOX | WS_CLIPSIBLINGS, CW_USEDEFAULT, CW_USEDEFAULT, 400, 300, NULL, hMenu, inj_hModule, NULL);
    SetParent(hwnd, hwndparent);
    ShowWindow(hwnd, SW_SHOWNORMAL); 
```

我还没有看到 Win10 中的线程问题。下面的每个子窗口都是在管理程序集的 DLL 中创建的。创建子窗口时，DLL 向程序集添加一个新成员并启动一个线程，该线程将为子窗口提供服务并在其初始化时执行上述代码。

[![带有 WS_CLIPCHILDREN 的父窗口](https://i.stack.imgur.com/1xGch.png)](https://i.stack.imgur.com/1xGch.png)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-18T11:58:40.140

```
"could you post more of your code " 
```

@BradB 你是对的.. 我们的答案都不是很具体，这是老东西，很难在一篇文章中放置一个完整的框架。阅读 RobS 建议的书，我会说......并且......看看 Visual Studio 和更现代的方法来*设计*“子窗口”，如 Winforms、WPF 和 Universal！

这是我的一些遗留代码，只是准备工作，让它成为一个 CHILD 窗口。您必须自己填写的事件等。

```
 BOOL RegisterDLLWindowClass(LPCWSTR s)
    {
      WNDCLASSEX wc;
      wc.hInstance = NULL; // inj_hModule;
      wc.lpszClassName = s;
      wc.lpfnWndProc = DLLWindowProc;
      wc.style = CS_DBLCLKS;
      wc.cbSize = sizeof(WNDCLASSEX);
      wc.hIcon = LoadIcon(NULL, IDI_APPLICATION);
      wc.hIconSm = LoadIcon(NULL, IDI_APPLICATION);
      wc.hCursor = LoadCursor(NULL, IDC_ARROW);
      wc.lpszMenuName = NULL;
      wc.cbClsExtra = 0;
      wc.cbWndExtra = 0;
      wc.hbrBackground = (HBRUSH)COLOR_BACKGROUND;
      if (!RegisterClassEx(&wc))
        return 0;
    }

    HMENU CreateDLLWindowMenu()
        {
          WriteLine("Create menu");
          HMENU hMenu;
          hMenu = CreateMenu();
          HMENU hMenuPopup;
          if (hMenu == NULL)
            return FALSE;
          hMenuPopup = CreatePopupMenu();
          AppendMenu(hMenuPopup, MF_STRING, MYMENU_FILTERSOFF, TEXT("Off"));
          AppendMenu(hMenuPopup, MF_STRING, MYMENU_CANNY, TEXT("Canny"));
          AppendMenu(hMenuPopup, MF_STRING, MYMENU_SOBEL, TEXT("Sobel"));
          AppendMenu(hMenuPopup, MF_STRING, MYMENU_THRESHOLD, TEXT("Threshold"));
          AppendMenu(hMenuPopup, MF_STRING, MYMENU_DILATE, TEXT("Dilate"));
          AppendMenu(hMenuPopup, MF_STRING, MYMENU_HARRIS, TEXT("Harris"));
          CheckMenuItem(hMenuPopup, 0, MF_BYPOSITION | MF_CHECKED);

          AppendMenuW(hMenu, MF_POPUP, (UINT_PTR)hMenuPopup, TEXT("Filter"));

          HMENU hMenuPopup2 = CreatePopupMenu();
          AppendMenu(hMenuPopup2, MF_STRING, MYMENU_SAMPLE1, TEXT("Change parameter"));
          AppendMenu(hMenu, MF_POPUP, (UINT_PTR)hMenuPopup2, TEXT("Test"));
          return hMenu;
        }

    void WINAPI CreateAWindow(PassedToDLL *lpParam, DWORD dwStyle)
        {   
          if (nInstances == 0) RegisterDLLWindowClass((LPCWSTR)L"WindowOfDLL");
          HMENU hMenu = CreateDLLWindowMenu();
          nInstances++;
          CommonInfo[nInstances - 1] = lpParam;
          int i = 20 + 4 * (rand() % 10);
          lpParam->p = NewPanningStruct();
          lpParam->hWndChild = CreateWindowEx(0, L"WindowOfDLL", lpParam->title,
                dwStyle,
                i, i, 800, 550, lpParam->hWndParent, hMenu, NULL, NULL);
          if (wcslen(lpParam->filename) > 0)
          {
            LoadBitmapFromBMPFileW(lpParam->hWndChild, lpParam->filename, &(lpParam->hBmp),
                &(lpParam->hPalette));
          } 
        } 
```

# html - 自动 HTML 简化工具？

> ID：838512
> 
> 赞同：5
> 
> 时间：2009-05-08T06:44:36.540
> 
> 标签：html

每当我看到一个可以被其他人分享的问题，并且有一个实施起来很有趣的解决方案时，它通常已经被证明已经解决了。我认为在我深入编码之前最好停下来做一个搜索。

情况如下：您可以将办公文档的各个部分复制并粘贴到 Visual Studio HTML 编辑器中。问题是，它创建的 HTML 文本如下所示：

```
<tr style="mso-yfti-irow:0;mso-yfti-firstrow:yes">
                <td style="border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;
   padding:0cm 5.4pt 0cm 5.4pt" valign="top">
                    <p align="left" class="MsoNormal" 
                        style="text-align:left;tab-stops:center 216.0pt right 432.0pt">
                        <b style="mso-bidi-font-weight:normal"><span lang="EN-US">ID<o:p></o:p></span></b></p>
                </td>
                <td style="border:solid windowtext 1.0pt;border-left:none;
   mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
   padding:0cm 5.4pt 0cm 5.4pt" valign="top"> 
```

对于机器来说很好，但这并不是人类可读的。我敢打赌，这可以通过找到重复的样式并从中创建 CSS 类来解决。计算机程序可以很容易地做到这一点。

我可以运行这个程序，然后我会得到看起来很漂亮、易于维护的 HTML，就像我的 Word 文档一样。

（是的，我知道我可以编辑我的 Word 文档，然后将其复制并粘贴到 HTML 中，或者将其保存为 HTML 文件。但这与事后手动编辑它不同） .

无论如何，有人知道这样做的程序吗？

* * *

（后来编辑）我发现我问的问题是这个问题的[副本](https://stackoverflow.com/questions/458249/tools-to-reduce-generated-html-size)。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T06:50:33.360

[HTML Tidy](http://tidy.sourceforge.net/)做到了！它还与常用文本编辑器（如 Notepad++ 或 UltraEdit）集成，并提供清理 Office Web 标记的选项。您需要将[`word-2000`布尔标志设置为 true](http://tidy.sourceforge.net/docs/Overview.html#word2000)

[此外，Jeff Atwood 在博客中讨论了这个问题，并在本文中](http://www.codinghorror.com/blog/archives/000485.html)介绍了他自己的 C# 2.0 解决方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T06:51:01.440

我会尝试使用 HTML Tidy：[http](http://tidy.sourceforge.net/) ://tidy.sourceforge.net/ ，另一种选择是将您的 word 文档粘贴到 TinyMCE 中，然后保存您的 HTML。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T09:31:49.070

您可能需要认真考虑将粘贴为纯文本作为您的简化工具。权衡重新应用标记需要多长时间......您可能会发现它没有您想象的那么痛苦。

# java - 什么是 JDBC 中的连接？

> ID：838518
> 
> 赞同：11
> 
> 时间：2009-05-08T06:48:53.567
> 
> 标签：java, networking, jdbc, tcp, connection

什么是 JDBC 中的连接对象？这个连接是如何维护的（我的意思是它是一个网络连接）？它们是 TCP/IP 连接吗？为什么每次都创建一个 Connection 是一项昂贵的操作？为什么这些连接在一段时间后变得陈旧，我需要刷新池？为什么我不能使用一个连接来执行多个查询？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-08T06:52:18.220

这些连接是 TCP/IP 连接。为了不必每次创建新连接时都产生开销，连接池会动态扩展和收缩。您可以将一个连接用于多个查询。我认为您的意思是您将其释放到池中。如果这样做，您可能会从池中恢复相同的连接。在这种情况下，您是否执行一个或多个查询都没关系

连接的成本是连接需要一些时间。并且数据库为每个连接准备一些东西，比如会话等。每次都必须这样做。由于多种原因，连接变得陈旧。最突出的是介于两者之间的防火墙。连接问题可能会导致连接重置或简单的超时

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T08:20:45.280

要添加到其他答案：

是的，您可以为多个查询重复使用相同的连接。这甚至是可取的，因为创建新连接非常昂贵。

您甚至可以同时执行多个查询。您只需为每个查询使用一个新的 java.sql.Statement/PreparedStatement 实例。语句是 JDBC 用来跟踪正在进行的查询的，因此每个并行查询都需要自己的语句。不过，您可以并且应该为连续查询重用语句。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T08:08:25.870

您的问题的答案是它们是实现定义的。JDBC 连接是公开方法的接口。幕后发生的事情可以是提供界面的任何事情。例如，考虑用于支持 java 存储过程的 Oracle 内部 JDBC 驱动程序。同时查询不仅是可能的，它们或多或少是不可避免的，因为对新连接的每个请求都返回一个也是唯一的连接对象。我不确定它是否在内部使用 TCP/IP，但我对此表示怀疑。

因此，您不应该在不清楚您正在使用的 JDBC 实现的情况下假设实现细节。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T09:18:19.290

因为我还不能发表评论，所以发布答案只是为了评论 Vinegar 的答案，setAutoCommit() 在返回池连接时返回默认状态的情况不是强制性行为，不应视为理所当然，也应视为关闭语句和结果集；您可以阅读它应该关闭，但如果您不关闭它们，它们将在关闭连接时自动关闭。不要想当然，因为它会占用您在某些版本的 jdbc 驱动程序上的资源。

我们在 AS400 上的 DB2 数据库上遇到了严重的问题，需要事务隔离的人正在调用 connection.setAutoCommit(false) 并且在完成工作后他们在没有 connection.setAutoCommit(old_state) 的情况下将这种连接返回到池 (JNDI)，所以当另一个线程得到这个连接时从池中，插入和更新没有提交，很长一段时间没有人能弄清楚为什么......

# java - IdentityHashMap 的用例

> ID：838528
> 
> 赞同：61
> 
> 时间：2009-05-08T06:51:39.097
> 
> 标签：java

谁能告诉我的重要用例是`IdentityHashMap`什么？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-05-08T07:05:12.933

每当您希望您的密钥不被比较`equals`而是由您比较时，`==`您将使用 IdentityHashMap。如果您要进行大量引用处理，这可能非常有用，但仅限于非常特殊的情况。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-05-08T07:09:22.300

[文件](http://java.sun.com/javase/6/docs/api/java/util/IdentityHashMap.html)说：

> 此类的典型用途是保留拓扑的对象图转换，例如序列化或深度复制。要执行这样的转换，程序必须维护一个“节点表”来跟踪所有已处理的对象引用。节点表不能等同于不同的对象，即使它们碰巧相等。此类的另一个典型用途是维护代理对象。例如，调试工具可能希望为被调试程序中的每个对象维护一个代理对象。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-10-21T04:16:54.113

您可以使用 IdentityHashMap 的一种情况是您的键是 Class 对象。这比获取的 HashMap 快 33%！它也可能使用更少的内存。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2014-10-17T08:40:40.513

**如果**您可以确保用作键的对象*当且仅当*它们的引用相等时，您也可以将其`IdentityHashMap`用作*通用映射。*

 ***有什么收获？显然，与使用or之类的实现相比，它会*更快*并且使用更少的内存。`HashMap``TreeMap`

* * *

**实际上，这种情况有很多。例如：**

*   `Enum`s。尽管对于枚举，还有更好的选择：[`EnumMap`](http://docs.oracle.com/javase/8/docs/api/java/util/EnumMap.html)
*   `Class`对象。它们也可以通过参考进行比较。
*   实习生`String`_ 通过将它们指定为*文字*或调用`String.intern()`它们。
*   缓存实例。一些类提供其实例的缓存。例如从 javadoc 中引用[`Integer.valueOf(int)`](http://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html#valueOf-int-)：

    > 此方法将始终缓存 -128 到 127 范围内的值，包括...

*   某些库/框架将只管理一个特定类型的实例，例如 Spring bean。
*   单例类型。*如果您使用使用单例*模式构建的类型的实例，您还可以确保（最多）一个实例存在于它们中，因此引用相等测试将有资格进行相等测试。
*   您明确注意仅使用相同的引用来访问用于将值放入映射中的值的任何其他类型。

* * *

**为了证明最后一点：**

```
Map<Object, String> m = new IdentityHashMap<>();

// Any keys, we keep their references
Object[] keys = { "strkey", new Object(), new Integer(1234567) };

for (int i = 0; i < keys.length; i++)
    m.put(keys[i], "Key #" + i);

// We query values from map by the same references:
for (Object key : keys)
    System.out.println(key + ": " + m.get(key)); 
```

输出将如预期的那样（因为我们使用相同的`Object`引用来查询地图中的值）：

```
strkey: Key #0
java.lang.Object@1c29bfd: Key #1
1234567: Key #2 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-10-21T17:08:48.053

HashMap 每次添加对象时都会创建 Entry 对象，当你有很多对象时，这会给 GC 带来很大的压力。在具有 1,000 个或更多对象的 HashMap 中，您最终将使用 CPU 的很大一部分，只是让 GC 清理条目（在诸如寻路或其他创建然后清理的一次性集合的情况下）。IdentityHashMap 没有这个问题，因此最终会明显更快。

在此处查看基准：[http ://www.javagaming.org/index.php/topic,21395.0/topicseen.html](https://web.archive.org/web/20101014202852/http://www.javagaming.org/index.php/topic,21395.0/topicseen.html)

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-10-15T15:53:05.123

这是我的一个实践经验：

与大基数的 HashMap 相比，IdentityHashMap 留下的内存占用要小得多。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-12-29T12:57:00.417

一种重要的情况是您正在处理引用类型（而不是值）并且您确实想要正确的结果。恶意对象可以被覆盖`hashCode`，并且`equals`方法会引起各种恶作剧。不幸的是，它没有像应有的那样经常使用。如果您正在处理的接口类型不覆盖`hashCode`and `equals`，您通常应该选择`IdentityHashMap`.

# c - 总线错误与分段错误

> ID：838540
> 
> 赞同：40
> 
> 时间：2009-05-08T06:56:41.813
> 
> 标签：c, segmentation-fault, bus-error, sigbus

总线错误和分段错误之间的区别？是否会发生程序第一次出现段错误并停止而第二次出现总线错误并退出的情况？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-05-08T07:06:19.700

在我使用过的大多数架构上，区别在于：

*   当您访问您不打算访问的内存时（例如，在您的地址空间之外），会导致 SEGV。
*   SIGBUS 是由于 CPU 的对齐问题引起的（例如，尝试从不是 4 的倍数的地址中读取 long）。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-05-08T16:04:50.147

`SIGBUS`[`mmap()`](http://linux.die.net/man/2/mmap)如果您是一个文件并尝试访问超出文件末尾的映射缓冲区的一部分，以及空间不足等错误情况，也会引发此问题。如果您使用 注册信号处理程序[`sigaction()`](http://linux.die.net/man/2/sigaction)并设置`SA_SIGINFO`，则可以让您的程序检查错误的内存地址并仅处理内存映射文件错误。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-08T07:04:34.277

例如，当您的程序尝试执行硬件总线不支持的操作时，可能会导致总线错误。例如，在[SPARC](http://en.wikipedia.org/wiki/SPARC)上，尝试从奇数地址读取多字节值（例如 int，32 位）会产生总线错误。

例如，当您执行违反分段规则的访问时，即尝试读取或写入您不拥有的内存时，就会发生分段错误。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-08T16:03:08.437

将您的问题（可能不正确）解释为“我间歇性地获得 SIGSEGV 或 SIGBUS，为什么它不一致？”，值得注意的是，C 或 C++ 标准不保证用指针做狡猾的事情会导致段错误；这只是“未定义的行为”，作为我曾经说过的教授，这意味着它可能会导致鳄鱼从地板上出现并吃掉你。

因此，您的情况可能是您有两个错误，其中第一个错误*有时会*导致 SIGSEGV，而第二个错误（如果没有发生段错误并且程序仍在运行）会导致 SIGBUS。

我建议您使用调试器逐步完成，并注意鳄鱼。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-08T07:03:46.853

我假设您正在谈论Posix 定义的`SIGSEGV`and信号。`SIGBUS`

`SIGSEGV`当程序引用无效地址时发生。`SIGBUS`是实现定义的硬件故障。这两个信号的默认操作是终止程序。

程序可以捕捉到这些信号，甚至可以忽略它们。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2018-06-17T21:13:38.883

> 程序第一次出现段错误并停止，第二次可能出现总线错误并退出，是否会发生这种情况？

是的，即使对于一个相同的错误：这是一个来自 macOS 的严重但简单的示例，它可以通过数组边界之外的索引以确定性的方式产生分段错误 (SIGSEGV) 和总线错误 (SIGBUS)。上面提到的未对齐访问不是 macOS 的问题。（这个例子不会导致任何 SIGBUS，如果它在调试器中运行，`lldb`在我的例子中！）

bus_segv.c：

```
#include <stdlib.h>

char array[10];

int main(int argc, char *argv[]) {
    return array[atol(argv[1])];
} 
```

该示例从命令行获取一个整数，该整数用作数组的索引。这些是一些不会导致任何信号的索引值（甚至在数组之外）。（给出的所有值都取决于标准段/节大小。我使用 clang-902.0.39.1 在 High Sierra macOS 10.13.5、i5-4288U CPU @ 2.60GHz 上生成二进制文件。）

高于 77791 和低于 -4128 的索引将导致分段错误 (SIGSEGV)。24544 将导致总线错误 (SIGBUS)。这里是完整的地图：

```
$ ./bus_segv -4129
Segmentation fault: 11
$ ./bus_segv -4128
...
$ ./bus_segv 24543
$ ./bus_segv 24544
Bus error: 10
...
$ ./bus_segv 28639
Bus error: 10
$ ./bus_segv 28640
...
$ ./bus_segv 45023
$ ./bus_segv 45024
Bus error: 10
...
$ ./bus_segv 53215
Bus error: 10
$ ./bus_segv 53216
...
$ ./bus_segv 69599
$ ./bus_segv 69600
Bus error: 10
...
$ ./bus_segv 73695
Bus error: 10
$ ./bus_segv 73696
...
$ ./bus_segv 77791
$ ./bus_segv 77792
Segmentation fault: 11 
```

如果您查看反汇编代码，您会发现存在总线错误的范围的边界并不像索引显示的那样奇怪：

$ otool -tv bus_segv

```
bus_segv:
(__TEXT,__text) section
_main:
0000000100000f60    pushq   %rbp
0000000100000f61    movq    %rsp, %rbp
0000000100000f64    subq    $0x10, %rsp
0000000100000f68    movl    $0x0, -0x4(%rbp)
0000000100000f6f    movl    %edi, -0x8(%rbp)
0000000100000f72    movq    %rsi, -0x10(%rbp)
0000000100000f76    movq    -0x10(%rbp), %rsi
0000000100000f7a    movq    0x8(%rsi), %rdi
0000000100000f7e    callq   0x100000f94 ## symbol stub for: _atol
0000000100000f83    leaq    0x96(%rip), %rsi
0000000100000f8a    movsbl  (%rsi,%rax), %eax
0000000100000f8e    addq    $0x10, %rsp
0000000100000f92    popq    %rbp    
0000000100000f93    retq 
```

通过`leaq 0x96(%rip), %rsi`， rsi 成为数组起始地址的（PC 相对确定的）地址：

```
rsi = 0x100000f8a + 0x96 = 0x100001020
rsi - 4128 = 0x100000000 (below segmentation fault)
rsi + 24544 = 0x100007000 (here and above bus error)
rsi + 28640 = 0x100008000 (below bus error)
rsi + 45024 = 0x10000c000 (here and above bus error)
rsi + 53216 = 0x10000e000 (below bus error)
rsi + 69600 = 0x100012000 (here and above bus error)
rsi + 73696 = 0x100013000 (below bus error)
rsi + 77792 = 0x100014000 (here and above segmentation fault) 
```

`lldb`可能会设置具有不同页面限制的过程。我无法在调试会话中重现任何总线错误。因此，调试器可能是解决总线错误吐出二进制文件的一种解决方法。

安德烈亚斯

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-08T15:25:27.433

这将是[什么是总线错误？](https://stackoverflow.com/questions/212466/what-is-a-bus-error)，如果不是因为

> 是否会发生程序第一次出现段错误并停止而第二次出现总线错误并退出的情况？

问题的一部分。您应该能够使用此处找到的信息自己回答这个问题。

* * *

> 精神错乱：一遍又一遍地做同样的事情，却期待不同的结果。
> - 艾尔伯特爱因斯坦

* * *

当然，从字面上理解这个问题......

```
#include <signal.h>
#include <stdlib.h>
#include <time.h>
#include <unistd.h>
int main() {
    srand(time(NULL));
    if (rand() % 2)
        kill(getpid(), SIGBUS);
    else
        kill(getpid(), SIGSEGV);
    return 0;
} 
```

Tada，一个程序可以在一次运行时出现分段错误并在另一次运行时出现总线错误退出。

# html - div垂直滚动条显示

> ID：838545
> 
> 赞同：98
> 
> 时间：2009-05-08T06:59:32.807
> 
> 标签：html, css

我想知道如何永久显示 div 的垂直条（如果没有滚动，则显示为灰色）类似于我们的常规条。基本上我试图将整个网站放在一个 div 中（如 gmail/facebook），所以如果页面不够长，整个页面会因为缺少垂直滚动条而移动。

我需要解决这个问题。我试过溢出-y：滚动。但它似乎根本不起作用。

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2009-05-08T07:16:59.440

你测试的是什么浏览器？

你设置了什么 DOCType？

你究竟是如何声明你的 CSS 的？

你确定你没有错过`;`之前/之后的`overflow-y: scroll`？

我刚刚在 IE7 和 Firefox 中测试了以下内容，它工作正常

```
<!-- Scroll bar present but disabled when less content -->
<div style="width: 200px; height: 100px; overflow-y: scroll;">
  test
</div>

<!-- Scroll bar present and enabled when more contents -->        
<div style="width: 200px; height: 100px; overflow-y: scroll;">
  test<br />
  test<br />
  test<br />
  test<br />
  test<br />
  test<br />
  test<br />
  test<br />
  test<br />
  test<br />
</div>
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-05-08T07:15:32.567

你试过`overflow-y:auto`吗？这不是您想要的，因为滚动条只会在需要时出现。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2015-03-25T01:40:14.960

**Always ：**如果您总是想要垂直滚动条，请使用`overflow-y: scroll;`

[jsFiddle：](http://jsfiddle.net/xEy9E/275/)

```
<div style="overflow-y: scroll;">
......
</div> 
```

**需要时**：如果您只需要在需要时垂直滚动条，请使用 `overflow-y: auto;`（在这种情况下您需要指定高度）

[jsFiddle：](http://jsfiddle.net/xEy9E/273/)

```
<div style="overflow-y: auto; height:150px; ">
....
</div> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-08-12T23:01:48.107

在反应...

```
<div className='p-4 mb-4' style={{overflowY:'scroll',height:'350px'}}>
    {msgx.map((m,index)=>{
        return(
            <Items m={m} key={index} i={index}/>
        )
    })}
</div> 
```

# delphi - Delphi：在 OnBeforePost 事件中取消 TDataSet.Post

> ID：838546
> 
> 赞同：15
> 
> 时间：2009-05-08T06:59:41.013
> 
> 标签：delphi, delphi-7, tdataset

在我们的主数据输入屏幕上，我们在 OnBeforePost 事件中有一个确定/取消对话框。

*   *好的*，让事情顺其自然
*   *立即*取消*`Dataset.Cancel;`*

 *它完成了它的意图，回滚任何更改并将数据集置于浏览模式。

这对大多数客户来说都很好，但我们被问到是否可以将其更改为

*   *Cancel*，Abort the Post 并保持在编辑模式，并保留当前的更改。

如果他们想取消，可以使用取消按钮。

查看源代码`procedure TDataSet.Post;`似乎不可能以这种方式使用该事件。

有人对可以做到这一点的方式有任何想法吗？

跟进：这就是我现在选择的处理方式

```
case MessageDlg('Save Changes?', mtWarning, [mbYes, mbNo, mbAbort], 0) of
  mrYes: ;
  mrNo: Dataset.Cancel;
  mrAbort: Abort;
  mrNone: Abort;
end; 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-08T07:02:36.480

调用该方法`Abort`（从 unit `System`，如果我没记错的话）会引发一个静默`EAbort`异常，它只会取消当前操作。那应该行得通。

（顺便说一句：这种取消数据库操作的方法在帮助系统的深处也被描述为实现此目的的“正常”方法——这就是我最初获得这种技术的地方）。

# ruby-on-rails - Sending messages between users

> ID：838554
> 
> 赞同：2
> 
> 时间：2009-05-08T07:04:13.700
> 
> 标签：ruby-on-rails, ruby

I am building an application and it needs to have a feature whereby one user can send another user a message. The system can be the most basic type available in rails and that would suit me fine.

Any ideas on how to go about this?

Thanks.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T07:35:09.507

表结构如下：

```
Users
name,pwd

Messages
title,body

UserMessages
user_id,message_id 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T07:41:34.420

你为什么不使用acts_as_messageable插件：[http](http://www.philsergi.com/2007/10/actsasmessageable-plugin-released_04.html) ://www.philsergi.com/2007/10/actsasmessageable-plugin-released_04.html ？

同样，还有其他的插件进行身份验证（restful authentication）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T17:34:01.587

所以我已经实现了数据库表，现在需要在我的系统周围传递数据，这让我觉得很麻烦。当用户在我的表单上单击“发送消息到”时，我需要它来携带用户正在查看的配置文件的 ID。我认为这会做到这一点：

```
<%= link_to "Message", :action => 'message', :id => @user.id %> 
```

现在这会将我正在寻找消息操作的人员 ID 传递给消息操作（我知道 @user.id 应该可以工作，因为我使用 @user.detail 在该页面上查看有关用户的其他详细信息）

然后我的控制器应该会收到该@user.id，这是我的控制器：

```
def message
    @reciever = User.find_by_id(params[:id])
end 
```

在我看来，我想显示接收者 ID，所以我认为

```
<label>Send Message To: <%= render :text => @reciever.id %></label> 
```

就足够了。

有任何想法吗？

# c# - 按百分比递增、递减

> ID：838558
> 
> 赞同：6
> 
> 时间：2009-05-08T07:04:43.950
> 
> 标签：c#, math

我将尝试用代码以最好的方式解释这个问题：

```
double power = 5000;
//picked up 5 power ups, now need to increase power by 10% per powerup
power += 5 * (power * .10);

//later on...ran into 5 power downs need to decrease power back to initial hp
power -= 5 * (power * .10);//7500 - 3750 -- doesn't work 
```

所以我需要的是一个可扩展的解决方案，它只使用计数就可以恢复到原始值。有任何想法吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-08T07:09:59.117

最好的方法是使用函数。它不必看起来完全像这样，但是：

```
class Whatever
{

    private double basePower = 5000;

    public int numPowerUps = 5;

    public double GetActualPower()
    {
        return basePower + (numPowerUps * basePower * 0.1);
    }
} 
```

当它们用完时，只需将 numPowerUps 改回 0。这样一来，它看起来整洁了很多。

顺便说一句：
它不起作用的原因是因为添加然后减去百分比不起作用。例如：

```
1\. What is 10% of 100?    --> 10
2\. Add that to the 100    --> 110
3\. What is 10% of 110?    --> 11
4\. Subtract that from 110 --> 99 
```

您将始终获得原始价值的 99%。如果你真的想走捷径，你可以这样做：

```
1\. What is 10% of 100?    --> 10
2\. Add that to the 100    --> 110
3\. What is (100/11) = 9.09090909...% of 110?    --> 10
4\. Subtract that from 110 --> 100 
```

但是，您可能容易受到浮点错误的影响。这样做的功能方式不仅更整洁、更清晰，而且可能更不容易出错。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T07:19:43.227

要反转 %age 增加，您必须*除以*原始 %age，而不是*减去*。

IE：

```
100 + 5% = 100 * 1.05 = 105 
```

扭转它：

```
105 / 1.05 = 100 
```

更常见的“5% 折扣”公式将为您提供：

```
105 - 5% = (105 * 0.95) = 99.75 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T07:21:36.357

开机：

```
power <- power * (1 + count * percent);
eg: 5000 * (1 + 5 * 0.1)
    5000 * 1.5
    7500 
```

要关闭电源：

```
power <- power / (1 + count * percent)
eg: 7500 / (1 + 5 * 0.1)
    7500 / 1.5
    5000 
```

让我们举一个更复杂的例子，17 次能量提升，每次提升 3% 到初始 1234 能量：

```
 1234 * (1 + 17 * 0.3)
= 1234 * (1 + 5.1)
= 1234 * 6.1
= 7527.4

  7527.4 / (1 + 17 * 0.3)
= 7527.4 / (1 + 5.1)
= 7527.4 / 6.1
= 1234 
```

当你这样写出来时，它实际上看起来很简单。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T07:15:20.973

这不起作用，因为这两个百分比不是取自同一个数字。它们取自同一个变量，但不是同一个数字。

第一次`power * 0.10`是 500，5*500=2500 所以功率是 5000+2500=7500。现在，功率是`power * 0.10`7500，750 也是。5*750 = 3750 和 7500-3750=3750，而不是像你一开始的 5000。

显然，您想要的并不是真正降低/降低当前功率的百分比。也许最好设置一个基本功率（比如说 5000）和一个实际功率。然后当你在/减少时，你使用`actualPower = actualPower + 5*0.1*basePower;`什么的。或者你只是接受五次加电后的五次断电不会让你回到初始马力。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T07:09:02.487

我会怀疑你所说的“不起作用”的意思是 for 的值`power`最终并不完全是`3750`.

这是由于[浮点舍入误差造成的](http://en.wikipedia.org/wiki/Floating_point#Accuracy_problems)，因为[浮点](http://en.wikipedia.org/wiki/Floating_point)值如`double`和`float`不能表示为精确值。

如果需要精确值，那么使用`decimal`or`int`将是更好的解决方案，因为它们旨在处理精确值。

**编辑**这里的实际问题不是浮点舍入错误，而是[Smashery 的回答](https://stackoverflow.com/questions/838558/increment-decrement-by-percentage/838571#838571)中提到的问题。

# c# - Uploading file with c# ftp methods results in webexception. Problem disappears after program restart

> ID：838562
> 
> 赞同：3
> 
> 时间：2009-05-08T07:05:53.493
> 
> 标签：c#, ftp

I have following problem: I'm using C# ftp methods to automate sending files to FTP servers. The program is constantly running, checking predefined directories. If it finds files in a directory, it is supposed to upload them to a defined ftp server. There are about 80 directories and most of the time the program has something to do. Everything works fine, except from the following scenario:

1.  The file is being uploaded.
2.  An error occurs while uploading: the remote host is down, the quota is exceeded or something similar.
3.  An attempt is made to upload the file once again and the error occurs once again.
4.  An attempt is made to upload file for the third, fourth, ... time and then this line of code:

    Stream requestStream = ftpRequest.GetRequestStream();

throws WebException with status: Undefined, and description: the time limit for this operation has been reached (or something similar - I had to translate this from polish). While this WebException is being thrown, ftp request to other servers (files from different directories) succeed, so it looks like there is only problem with connection to this one ftp server.

It all results in no further attempt to upload file being successful. Uploading this file through other ftp client is, however, possible. When I restart the program, everything runs smoothly. Should I somehow manually release ftp resource? I'm using KeepAlive property of FtpWebRequest set to true..

I would very appreciate if someone could shed some light on this problem.

Edited:

I followed David's hint and found the place where I didn't call Close() method on the requestStream, I fixed it, but the problem reoccurred.

I will paste some code then. Here is part of the method, that uploads the file to the server. If it fails, another attempt is being made, something like:

```
while (retryCounter++ < retryNumber)
{
  //upload file,
  //if succeeded, break
} 
```

inside while-block there is:

```
FtpWebRequest ftpRequest = (FtpWebRequest)WebRequest.Create(remoteFileName);
ftpRequest.UseBinary = true;
ftpRequest.UsePassive = true;
ftpRequest.Credentials = new NetworkCredential(UserName, Password);
ftpRequest.ReadWriteTimeout = SendTimeout;
ftpRequest.Timeout = ConnectTimeout;
ftpRequest.KeepAlive = true;
ftpRequest.Proxy = null;
ftpRequest.Method = WebRequestMethods.Ftp.UploadFile;

Stream requestStream = null;

try
{

  using (MemoryStream fileStream = new MemoryStream(localFile))
  {
    byte[] buffer = new byte[BufferSize];

    int readCount = fileStream.Read(buffer, 0, BufferSize);
    int bytesSentCounter = 0;

     while (readCount > 0)
     {
         requestStream.Write(buffer, 0, readCount);
         bytesSentCounter += readCount;

         readCount = fileStream.Read(buffer, 0, BufferSize);
         System.Threading.Thread.Sleep(100);

     }
}

requestStream.Close();
requestStream = null;

FtpWebResponse response = (FtpWebResponse)ftpRequest.GetResponse();
FtpStatusCode code = response.StatusCode;
string description = response.StatusDescription;
response.Close();

_logger.Information("Upload file result : status code {0}, status description {1}", code, description);

if (code == FtpStatusCode.ClosingData)
{
    _logger.Information("File {0} uploaded successfully", localFileName);
}  
else
{
    _logger.Error("Uploading file {0} did not succeed. Status code is {1}, description  {2}", localFileName, code, description);
}

}   
catch (WebException ex)
{

    if (requestStream != null)
        requestStream.Close();

    ftpRequest.Abort();

    FtpStatusCode code = ((FtpWebResponse)ex.Response).StatusCode;
    string description = ((FtpWebResponse)ex.Response).StatusDescription;

   _logger.Error("A connection to the ftp server could not be established. Status code: {0}, description: {1} Exception: {2}. Retrying...", code, description, ex.ToString()); 
```

}

So, again the scenario is following:
1\. The file is being uploaded and System.Net.Sockets.SocketException occurrs.
2\. Another attempt is being made and System.Net.Sockets.SocketException reoccurs.
3\. Always before I call the uploadfile method, I check whether the remote server is up and everything is ok by trying to list the remote directory. And from now, by calling ftpRequest.GetResponse() (where ftpRequest.Method is WebRequestMethods.Ftp.ListDirectory) I get WebException with status: Undefined, and description: the time limit for this operation has been reached. When I restart the application, the problem disappears.

I can find no other place where the streams are not released properly, and have no idea what to do next..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T07:12:27.610

Are you sure you're closing the stream correctly and thus release all underlying resources properly?

If not, this might be the cause of your problem, when you hit a limit (e.g. open sockets) after repeated failures.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-06T10:47:13.550

您需要确保将 Stream.Close()、Request.Close() 和 Response.Close() 放在 finally 块中，否则只要出现错误，它们就会被跳过。请记住，在处理诸如通过网络之类的外部资源时，您需要对错误进行编程，因为它们肯定会在某个时候出现。

```
尝试
{
    在这里处理...
}
最后
{
     requestStream.Close();
     请求流=空；
}

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T07:29:09.257

One possible source of error that I've run into is creating a new "NetworkCredential" over and over again. Then you'll get an exception after awhile.

# json - 调用 SQL Server Endpoint Web 服务

> ID：838574
> 
> 赞同：1
> 
> 时间：2009-05-08T07:11:34.947
> 
> 标签：json, soap, endpoints

我了解 SQL Server 端点使用 SOAP 返回数据。有谁知道他们是否可以返回 JSON 数据？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T07:25:55.007

本机 HTTP 端点只能返回 SOAP 消息。

`FORMAT = NONE`但是，如果您在`FOR SOAP`声明部分指定，则可以关闭 SOAP 信封的生成。您可以使用它为您自己的存储过程提供一个 HTTP 包装器，其中包含 JSON 格式的 SQL 服务器数据（有关您的过程必须满足的非常具体的要求的详细描述，请参阅[在线书籍）。](http://technet.microsoft.com/en-us/library/ms181591.aspx)

您应该知道本机端点[在 SQL 2008 中已弃用](http://technet.microsoft.com/en-us/library/cc280436.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T07:24:53.197

[不，不幸的是他们不支持 JSON](http://www.simple-talk.com/sql/database-administration/sql-server-endpoints-soup-to-nuts/)。

# database-design - Represent three way database functional dependency in 5th normal form

> ID：838575
> 
> 赞同：0
> 
> 时间：2009-05-08T07:11:39.627
> 
> 标签：database-design, relational-database, database-normalization, functional-dependencies

Is it possible to represent a composite key functional dependency of a non key column in fifth normal form?

I have three tables,

```
users
----------
id
name

events
----------
id
name

events_users
---------------------------
id
user_id
event_id
participation_type (ENUM) 
```

As I know, the 5th normal form needs the tables to be represented in its own small entity. So i guess the participation_type in events_users table cannot be called a 5th normal form?

Can anyone suggest me a better solution?

The problem is, I've been using the DataMapper library of CodeIgniter where each table need to exist independently, ie 5th normal form.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T07:27:17.590

As far as I can tell, the example you give is already in [Fifth Normal Form](http://en.wikipedia.org/wiki/5NF).

You have so few columns in the tables that I can't see any other way to arrange them!

As far as I can tell, 'participation_type' does not break any NF rules because there are no other columns semantically related to it.

**edit in response to comment:** Perhaps as you suggest this is some other problem with Datamapper/Codeigniter that is not related to 5NF.

If you cannot add fields into the user_events table that it generates, then perhaps you need to pre-empt it and create another entity, lets call it 'Attendance' (or whatever makes sense in your model). Attendance will have these fields:

```
Attendance
----------
id
participation_type (ENUM)

```

Then tell Datamapper that Attendance is related to both Users and Events, and it will generate (or ask you to generate, or whatever) two linking tables:

```
user_attendance
---------------
id
user_id
attendance_id

event_attendance
----------------
id
event_id
attendance_id

```

If you do something along those lines, then you will have an Attendance entity that you can add fields to.

Disclaimer: I dont know anything about Datamapper, I'm just reading between the lines here

# asp.net - upload to ftp asp.net

> ID：838584
> 
> 赞同：5
> 
> 时间：2009-05-08T07:14:42.427
> 
> 标签：asp.net, upload, ftp, file-upload

Is it possible to upload a file directly into an ftp account folder with ASP.NET ?

E.g. I click on browse, select a file to upload and when I click "upload" button, It should save it directly to the folder on another web server located at somewhere else other then the server that is being used to upload.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T07:35:57.977

据我了解您的问题，您想将文件上传到另一台远程服务器（所以它不是与您的网络服务器位于同一网络上的另一台服务器）？在这种情况下，您可以做几件不同的事情。最简单的方法可能是首先将常规文件上传到您的服务器，然后让您的服务器通过 FTP 将文件发送到另一个远程服务器：

```
string fileName = Path.Combine("<path on your server", FileUpload1.FileName);
FileUpload1.SaveAs(fileName);
using(System.Net.WebClient webClient = new System.Net.WebClient())
{
    webClient.UploadFile(
        New Uri("ftp://remoteserver/remotepath/" + FileUpload1.FileName), 
        localFile);
} 
```

...或者它可以一步完成：

```
using(System.Net.WebClient webClient = new System.Net.WebClient())
{
    webClient.UploadData(
        New Uri("ftp://remoteserver/remotepath/" + FileUpload1.FileName), 
        FileUpload1.FileBytes);
} 
```

（我没有尝试这段代码，所以其中可能有一些错误......）

更新：我注意到我错误地假设 WebClient 的 UploadXXX 方法是静态的......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T07:36:53.013

您可以使用`WebClient`该类将上传的文件存储到 FTP（无需将其作为文件保存在服务器上）。像这样的东西：

```
string name = Path.GetFileName(UploadControl.FileName);
byte[] data = UploadControl.FileBytes;

using (WebClient client = new WebClient()) {
   client.UploadData("ftp://my.ftp.server.com/myfolder/" + name, data);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-08-18T18:41:25.843

```
 /// <summary>
    /// Example call : if (FtpUpload(FileUploadControl1, "ftp.my.com/somePathDir", @"user", "pass!", "domain"))
    /// </summary>
    /// <param name="file"></param>
    /// <param name="ftpServer"></param>
    /// <param name="username"></param>
    /// <param name="ftpPass"></param>
    /// <returns></returns>
    private bool FtpUpload(FileUpload file, string ftpServer, string username, string ftpPass, string domainName = "")
    {
        // ftp://domain\user:password@ftpserver/url-path
        // If you are a member of a domain, then "ftp://domain-name\username:password@url-path" may fail because the backslash (\) is sent in as a literal character and Internet Explorer incorrectly looks for a file instead of parsing a Web address. Changing the backslash (\) in the domain-name\username to domainname%5Cusername works correctly.

        try
        {
            string ftpAddres;
            if (domainName != string.Empty)
                ftpAddres = "ftp://" + domainName + @"%5C" + username + ":" + ftpPass + "@" + ftpServer + "/" + file.FileName;
            else
                ftpAddres = "ftp://" + username + ":" + ftpPass + "@" + ftpServer + "/" + file.FileName;

            using (var webClient = new System.Net.WebClient())
            {
                webClient.UploadData(new Uri(ftpAddres), file.FileBytes);
            }

        }
        catch (Exception e)
        {
            throw new Exception(e.Message, e);
        }
        return true;
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T07:26:26.923

You cannot upload it to an FTP directly from your HTML form. However, you can upload it to your ASP.NET application and then upload it to the FTP from there using [FtpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest(loband).aspx).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T07:22:56.150

**EDIT**

First off the `@` sign is there to flag the string as a literal. it saves you having to escape characters like backslashes. e.g.

```
string path = "Z:\\Path\\To\\File.txt";
string path = @"Z:\Path\To\File.txt"; 
```

Secondly, if you only have FTP Access to the other server, then you can take, the `FileUpload.FileBytes` Property of the FileUpload control. That will give you a `byte[]` of the file contents.

From this you use the `System.Net.FtpWebRequest` & `System.Net.FtpWebResponse` to upload your file to the FTP Account.

Theres some sample code here in VB.NET but it should be easy enough for you to figure out

[http://www.programmingforums.org/thread15954.html](http://www.programmingforums.org/thread15954.html)

**ORIG**

The file upload control will provide you with the File on your webserver.

It would be up to you, to copy/save that file then from the webserver to whatever server you're FTP is hosted on.

Do you have a UNC Path/Mapped Drive shared out on your other server that you can save to.

The FileUpload Control has a `.SaveAs()` method so it's just a simple matter of

```
if (FileUpload1.HasFile)
try
{
    FileUpload1.SaveAs(@"Z:\Path\On\Other\Server\" + FileUpload1.FileName);
} 
```

# java - 如何从 Java 中的操作系统读取“列表分隔符”？

> ID：838590
> 
> 赞同：8
> 
> 时间：2009-05-08T07:17:37.723
> 
> 标签：java, csv, operating-system, regional, list-separator

我正在用 Java 编写一个 CSV 导出器，它应该尊重用户的自定义设置，尤其是用作分隔符的“列表分隔符”。

在 Windows 中，可以在

```
Control Panel -> Regional and Language Options -> Regional Options -> Customize 
```

我不了解其他操作系统，但我很确定您也可以在其他操作系统上更改它。

将此自定义设置从操作系统导入 Java 的最佳方法是什么？我在 Eclipse RCP 环境中，所以如果有可用的东西，我可能会使用与 RCP 相关的解决方案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T08:03:41.483

在不求助于特定于平台的解决方案的情况下，我认为最好的方法是允许用户*在您自己的应用程序*中指定他们对列表分隔符的偏好。在首选项面板、导出对话框中或通过可选的命令行参数。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T09:54:15.163

从[这个答案](https://stackoverflow.com/questions/838590/how-to-read-list-separator-from-os-in-java/838718#838718)的评论：

> 阅读特定于操作系统的设置是我*必须*满足的需求。

那么如果 Windows 以外的操作系统*没有*这样的设置呢？

我建议您从 Windows 上的注册表中读取它（如此[处](https://stackoverflow.com/questions/838590/how-to-read-list-separator-from-os-in-java/838641#838641)所述）：[Read/write to Windows Registry using Java](https://stackoverflow.com/questions/62289/read-write-to-windows-registry-using-java)。在其他平台上只使用一个好的默认值，也许，至少在 Unix 上，还支持通过自定义环境变量（您记录良好）配置它：[我的 java 代码如何读取操作系统环境变量？](https://stackoverflow.com/questions/461018/how-can-my-java-code-read-os-environment-variables).

当然，我的直觉认为操作系统普遍没有（系统范围或用户特定的）“列表分隔符”设置可能是错误的，但我对此表示怀疑。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-11-29T11:45:24.687

除了在应用程序中为用户提供您自己的选项之外，您还可以尝试猜测列表分隔符是什么。

我查看了 Windows 中的一些语言环境，发现列表分隔符是“;” 或者 ”，”。我听说在某个不起眼的地方还有另一个角色，但我自己没有见过。因此，如果您可以使您的代码同时处理“；” 和 "," 作为列表分隔符，那么您可能会涵盖大多数情况。

此外，看起来当“，”用作小数分隔符时，“，”从未用作列表分隔符。我想这是否则数字将无法在列表中区分：1,2,3,4 可能是 1.2, 3.4 或 1, 2.3 在这些情况下“;” 用作列表分隔符。不幸的是，相反的情况并非如此。阿拉伯语有“。” 作为十进制符号和“;” 作为列表分隔符。

所以我认为可以合理安全地遵循的规则是：

```
if (decimalSeparator == ',') 
    then listSeparator = ';'
else if (decimalSeparator == '.') 
    then listSeparator = new char[] {';', ','} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T10:16:13.253

出于好奇，我搜索了一些主题，确实 Java 似乎没有开箱即用的这个概念。

[语言环境演示](http://www.inter-locale.com/LocalesDemo.jsp "语言环境演示")提供了一个相当完整的语言环境设置列表，并且没有列表分隔符。

我看到一个[论坛问题](http://www.coderanch.com/t/325093/Java-General-advanced/java/get-List-Separator-local-system "如何获取本地系统的列表分隔符（一般 Java ...")涉及 sun.text.resources 包，它是私有的且已弃用。您不会找到对该包的很多其他引用，看起来它位于 jre/lib/ext/localedata.jar 中，尽管我最近的这个副本主要列出了亚洲语言环境。

上述建议是合理的，或者您可以研究并使用每个区域设置的私人列表。我可能会看看 IBM 的 ICU 库（我认为是 C 语言），它似乎有一个相当大的语言环境设置列表。据介绍[，](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4807540 "错误 ID：4807540 DateFormat 对于斯洛文尼亚语区域设置无效") ICU本身的信息来源于一个ISO标准，应该作为主要的信息提供者进行研究。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-12-16T15:35:07.697

我遇到了同样的问题，还发现唯一合适的解决方案是为用户提供一种方法来指定“选择的分隔符”。

但是，如果这是不可能的，就像我的情况一样，我可以得到的最接近跨平台、跨语言环境的支持如下：

*   使用 DecimalFormatSymbols 猜测您需要使用的分隔符
*   在 CSV 的开头添加一行，例如“sep=”（不带引号），这应该指定您刚刚猜到的列表分隔符

至少在大多数情况下（我测试过的情况），这将强制 Excel 使用该分隔符，即使您“猜错了”并且至少会提供更多的兼容性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-11-20T03:46:12.223

好吧，我认为这是一个严肃的话题！

问题是在 Windows 中，有 Excel。许多程序必须与之交互。Excel 使用列表分隔符区域设置（单元格分隔）。

基本问题是“逗号分隔值”在美国（西班牙语（美国））和英语之外不起作用，因为您不能使用与小数分隔符相同的列表分隔符。因此，美国和英语以外的世界（包括（应该）遵循北约语言环境、十进制逗号等和 ISO 措施的美国军队）使用`;`列表分隔符来分隔电子表格中的单元格，而不是将其与十进制逗号混淆。

所以一般来说，列表分隔符的区域设置 Windows 设置`;`除了英语或美国列表分隔符是`,`.

Excel 有其美国/英语 CSV 的不便之处，特别是；在默认的美国和英语设置中，相同的字符`,`是千位分隔符，而 Excel 会发疯（单元格在使用它的情况下导入 CSV）。跳过千位分隔符（当它与列表分隔符相同时） Excel 不识别货币单元格并将它们作为文本。我们必须在美国和英国环境中使用的东西，否则在世界范围内它可以正常工作（使用`;`）。

有趣的事情（有趣的想法）是 Windows 中的 Java 是否支持具有 Win32 库访问权限的 NDK？因为在 Win32 中你调用

```
GetLocaleInfoEx(LOCALE_NAME_USER_DEFAULT, LOCALE_SLIST, pwListSeparator, 4); 
```

我找不到获取列表分隔符的 Java 解决方案？

**我的建议是使用硬编码的一般规则，将列表分隔符设置为`;`小数点分隔符，`,`否则将列表分隔符设置为`,`**如果在 Win32 等语言环境方法或设置中找不到另一个字符。如果千位分隔符与列表分隔符相同，则删除（不要使用）千位分隔符。

**还是使用选项卡式文本文件？**唯一的不便是 Windows 默认使用 ShellExecute(0, 0, pwFileName, 0, 0, SW_SHOW); 在 .csv 文件上打开 Excel，在 .txt 文件上打开记事本。

值得注意的是Java中存在小数分隔符和千位分隔符，我猜应该使用：

```
import java.text.DecimalFormatSymbols;
new DecimalFormatSymbols().getDecimalSeparator();
new DecimalFormatSymbols().getGroupingSeparator(); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-08T07:38:48.127

对于 Windows，它存储在注册表中：

```
"HKEY_CURRENT_USER\\Control Panel\\International" 
```

所以你可以使用这样的东西

```
private void setDelimiterProperties(String delimiter) {
    Properties p = new Properties();
    String key = "HKEY_CURRENT_USER\\Control Panel\\International\\sList";
    p.setProperty(key, delimiter);
} 
```

# blackberry - 错误：类型 Class 不是通用的；它不能用参数参数化

> ID：838591
> 
> 赞同：1
> 
> 时间：2009-05-08T07:17:40.313
> 
> 标签：blackberry, java-me

我正在为 Eclipse 使用 Blackberry 插件。默认 jre 设置为 1.6 我收到以下错误，这不允许我编译我的 .java 文件：

Class 类型不是通用的；它不能用参数参数化

请帮忙。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T07:24:54.557

J2ME 项目的类必须编译为与 1.3 版兼容。=> 没有泛型、枚举、扩展......

但它应该解决你的问题:)

# sql - What are the steps followed by sql engine to execute the query..??

> ID：838610
> 
> 赞同：9
> 
> 时间：2009-05-08T07:27:25.767
> 
> 标签：sql, inner-join, internal

My question is not how to use inner join in sql. I know about how it matches between table a and table b.

I'd like to ask how is the internal working of inner working. What algorithm it involves? What happens internally when joining multiple tables?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T07:38:39.483

有不同的算法，取决于数据库服务器、索引和数据顺序（集群 PK）、计算值是否连接等。

查看大多数 SQL 系统可以为查询创建的查询计划，它应该让您了解它的作用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T07:39:48.263

在 MS Sql 中，根据表（它们的大小、可用的索引类型等），在不同情况下将使用不同的连接算法。我想其他数据库引擎也使用各种算法。

Ms Sql 使用的主要连接类型有：
- 嵌套循环连接
- 合并连接
- 哈希连接

您可以在此页面上阅读有关它们的更多信息：[Msdn -Advanced Query Tuning Concepts](http://msdn.microsoft.com/en-us/library/ms191426.aspx)

如果您让 SQL 显示查询的“执行计划”，您将能够看到在不同情况下使用的连接类型。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T07:40:33.957

这取决于您使用的数据库、您要加入的数据库（大/小、顺序/随机、索引/非索引等）。

例如，SQL Server 有几种不同的连接算法；循环连接、合并连接、散列连接。使用哪一个由优化器在制定执行计划时确定。有时它会做出错误判断，然后您可以通过使用连接提示来强制执行特定的连接算法。

您可能会发现以下 MSDN 页面很有趣：
[http://msdn.microsoft.com/en-us/library/ms191318.aspx](http://msdn.microsoft.com/en-us/library/ms191318.aspx)（循环）
[http://msdn.microsoft.com/en-us/library/ms189313.aspx](http://msdn.microsoft.com/en-us/library/ms189313.aspx)（哈希）
[http://msdn.microsoft.com/en-us/library/ms190967.aspx](http://msdn.microsoft.com/en-us/library/ms190967.aspx)（合并）
[http://msdn.microsoft.com/en-us/library/ms173815.aspx](http://msdn.microsoft.com/en-us/library/ms173815.aspx)（提示）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T07:35:08.603

在这种情况下，您应该看到如何在 b-tree 中保存数据，我认为您会理解 JOIN 算法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T07:42:48.770

全基于集合论，已经有一段时间了。尽量不要在任何时候链接太多的表，似乎所有的扫描都消耗了数据库资源。索引有助于提高性能，查看一些 sql 站点并搜索优化 sql 查询以获得一些见解。SQL Management Studio 具有一些通常很有趣的内置执行计划实用程序，尤其是对于大型复杂查询。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T07:51:27.190

优化器将（或应该）选择最快的连接算法。

然而，有两种不同的确定什么是快的：

1.  您测量返回**所有**连接行所需的时间。
2.  您测量返回**第一个**连接行所需的时间。

如果您想尽快返回所有行，优化器通常会选择散列连接或合并连接。如果您想尽快返回前几行，优化器将选择嵌套循环连接。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-05-08T07:39:08.560

它创建两个表的笛卡尔积，然后从中选择行。阅读有关数据库的 Korth 书籍。

# php - 我设置管理面板的方式好吗？

> ID：838611
> 
> 赞同：0
> 
> 时间：2009-05-08T07:27:49.993
> 
> 标签：php

所以基本上，[这](http://github.com/a2h/Ze-Very-Flat-Pancaek-CMS/blob/1630d6337d93fd7cc7612020ac136fb3edef8b00/trunk/zvfpcms/admin/admin.php)就是我所拥有的。

但这是一个好习惯吗？由于 admin.php 文件越来越大，我开始拆分它。

但是，我有点担心我最终可能会处理多少个文件，以及在可能需要对所有文件进行更新的情况下使用的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T07:57:45.367

我有类似的想法开发自己的 CMS 引擎。最终，我最终得到了与您所做的基本相同的解决方案，但使用 Smarty，用于逻辑表示分离。

但是现在经过一段时间后，我有了不同的更好的解决方案。利用[命令模式](http://en.wikipedia.org/wiki/Command_pattern)。您需要将代码分成不同的类，而不是像您所做的那样在文件中。您必须建立所有类都将实现的命令接口。这样，您的管理页面将充当[前端控制器](http://en.wikipedia.org/wiki/Front_Controller_pattern)（另一种设计模式）。

Front Controler 的职责是从您的页面收集所有输入，在您的情况下是 $_GET["action"] ，根据此操作，您将必须实例化 Command 对象，并且在此 switch 语句之后您将调用 $command->execute (); 这将执行包含在您的 Command 类中的代码。

对于您的示例，您将拥有：EditPageCommand、DeletePageCommand、NewPageCommand 等。

避免文件中的代码分离。尝试对所有事物都使用类并学习模式。;)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T07:42:16.493

在 php 中使用类，尝试将项目拆分为逻辑模块。然后，您无需对所有文件进行手动更新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T07:36:36.993

IMO 将大文件拆分成几个更小、更模块化的文件总是一个好主意。

但是，查看您的代码，我会使用 HTML 模板引擎，以免混淆逻辑和表示。看看[聪明](http://www.smarty.net)的。

# c# - Query with SUM using SubSonic

> ID：838613
> 
> 赞同：1
> 
> 时间：2009-05-08T07:27:59.383
> 
> 标签：c#, subsonic, sum

I'm new to Subsonic, I want to ask how to query with SUM?

I know how to query for where condition such as below:

```
Query qryCurOpcode = Station.CreateQuery()
    .WHERE("PRODLINE=PIECERATE_prodline")
    .AND("STATIONID=STNID")
    .AND("SHIFT=PIECERATE_shift");

IDataReader rdrCurOpcode = qryCurOpcode.ExecuteReader();

while (rdrCurOpcode.Read())
{
    PIECERATE_CurOpcode = rdrCurOpcode[Station.Columns.Curopcode].ToString();
} 
```

but how to how to query with SUM?

Thanks! Halim

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T07:59:59.870

这是一种方法：

```
int sum = (int)new Query("Station").GetSum("Shift"); 
```

您可以从以下获得更多示例： [SubSonic Aggregate Queries](http://subsonicproject.com/docs/Simple_Aggregate_Queries)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T15:17:02.120

如果您想使用 sum 之类的聚合，那么最好的方法是使用 Subsonic 的聚合 :)。有关示例的完整列表，请查看[SubSonicProject](http://subsonicproject.com/querying/aggregate-queries/)

以下是直接取自上面链接的一些示例。

```
 double result = new
    Select(Aggregate.Avg("UnitPrice"))
    .From(Product.Schema)
    .ExecuteScalar<double>();

 IDataReader reader = new
    Select(Aggregate.GroupBy("ProductID"), Aggregate.Avg("UnitPrice"))
    .From("Order Details")
    .Where(Aggregate.Avg("UnitPrice"))
    .IsGreaterThan(50)
    .ExecuteReader(); 
```

# java - 将javabean初始化为随机值的方法

> ID：838616
> 
> 赞同：5
> 
> 时间：2009-05-08T07:29:09.600
> 
> 标签：java, random, javabeans

我正在寻找一些实用程序类/代码，它们将采用 java bean 并将其所有值初始化为随机值。它可以通过反射来完成，因为一些库已经创建了 toString() 或 equals() 方法。例如，在开发 UI 以获取一些数据时很有用。

其他可能的好东西：

1.  也递归地初始化非原始或简单（字符串，日期）成员
2.  初始化 bean 的集合
3.  也许给一些方法来限制生成的值，例如我们可以给出范围的数字，字符串正则表达式或通配符......

有人知道这样的事情吗？谢谢

编辑：解决...让 Apocalisp 的样本正常工作，这绝对是我想要的。恕我直言，它有一些缺点：

*   该库的范围比该用途大得多，但这对我来说不是问题
*   除非您花一些时间来研究整个事物，否则要了解如何为您的对象构建 Arbitrary 是相当复杂的。这是一个缺点。
*   我猜它可能更简洁，但这也很好。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2016-04-19T18:59:34.930

看看 Easy Random：[https](https://github.com/j-easy/easy-random) ://github.com/j-easy/easy-random 。

它允许您使用随机数据填充 Java 对象图。

免责声明：我是该库的作者

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-09T16:10:54.027

虽然我确实注意到这篇文章可能有点老了，但我只是碰巧有同样的必要性，而且所提出的解决方案似乎都不能很好地解决它，所以我做了一些快速而肮脏的 15 分钟不完全- 用于生成随机填充 bean 的通用实用程序方法，这对于碰巧遇到类似问题的其他人可能有用也可能没有用：

```
import java.beans.PropertyDescriptor;
import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Date;
import java.util.Random;

import org.springframework.beans.BeanUtils;

public class RandomBeanUtil {

    public static <T> Collection<T> generateTestData(Class<T> clazz, int quantity) {
        Collection<T> list = new ArrayList<T>();

        PropertyDescriptor[] descriptors = BeanUtils.getPropertyDescriptors(clazz);
        Random rand = new Random();

        Calendar cal = Calendar.getInstance();
        cal.set(Calendar.HOUR, 0);
        cal.set(Calendar.MINUTE, 0);
        cal.set(Calendar.SECOND, 0);
        cal.set(Calendar.MILLISECOND, 0);

        try {
            for (int i = 0; i != quantity; i++) {
                    T o = clazz.newInstance();

                    for (PropertyDescriptor descriptor : descriptors) {
                        Class<?> type = descriptor.getPropertyType();
                        if (String.class.isAssignableFrom(type)) {
                            descriptor.getWriteMethod().invoke(o, String.valueOf(new char[]{
                                    (char)('A' + rand.nextInt(26)), (char)('a' + rand.nextInt(26)) }));
                        } else if (Date.class.isAssignableFrom(type)) {
                            cal.add(Calendar.DATE, rand.nextInt(60) - 30);
                            descriptor.getWriteMethod().invoke(o, cal.getTime());
                        } else if (BigDecimal.class.isAssignableFrom(type)) {
                            descriptor.getWriteMethod().invoke(o, 
                                    new BigDecimal(rand.nextDouble() * 500).setScale(2, RoundingMode.HALF_UP));
                        }
                    }

                    list.add(o);
            }       
        } catch (Exception e) {
            // TODO: Improve exception handling
            throw new RuntimeException("Error while generating the bean collection", e);
        }

        return list;
    }

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T13:20:09.357

看看[Reductio 库中的 Gen 类](http://functionaljava.googlecode.com/svn/artifacts/2.19/javadoc/fj/test/Gen.html)。这是用于生成或多或少任何类型的[任意值的高度可配置框架的一部分。](http://functionaljava.googlecode.com/svn/artifacts/2.19/javadoc/fj/test/Arbitrary.html)提供了原始类型和大多数 Java 集合类的生成器。您应该能够`Arbitrary`相当轻松地为您的类创建实例。

**编辑**这是示例，已更正：

```
import static fj.test.Arbitrary.*;
import static fj.Function.*;

static final Arbitrary<Person> personArbitrary =
  arbitrary(arbInteger.gen.bind(arbString.gen, arbBoolean.gen,
      curry(new F3<Integer, String, Boolean, Person>() {
        public Person f(final Integer age, final String name, final Boolean male)
          {return new Person(age, name, male);}}))); 
```

然后像这样生成一个“大小 100”的任意人。即，它的名称最多为 100 个字符。

```
Person p = personArbitrary.gen.gen(100, Rand.standard); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T13:04:05.497

我没有适合你的库，但如果你有一个随机生成器，那么这个类可能会派上用场：

```
public class BeanMethodIterator implements Iterable<Method> {

    private static final int MODIFIER_FILTER = (Modifier.PUBLIC | Modifier.STATIC);
    private static final int MODIFIER_EXPECTED = Modifier.PUBLIC;

    /**
     * Indicator to filter getter or setter methods. 
     */
    public enum Filter {

        /** Only getter methods. */
        GETTERS(new Transform<Method, Boolean>(){
            public Boolean transform(Method input) {
                return (input.getName().startsWith("get") || 
                        input.getName().startsWith("is")) 
                    &&  input.getParameterTypes().length == 0;
            };
        }),

        /** Only setter methods. */
        SETTTERS(new Transform<Method, Boolean>(){
            public Boolean transform(Method input) {
                return input.getName().startsWith("set") && 
                    input.getParameterTypes().length == 1;
            };
        }),

        /** Getter and setter methods. */
        BOTH(new Transform<Method, Boolean>(){
            public Boolean transform(Method input) {
                return Filter.SETTTERS.condition.transform(input) || 
                    Filter.GETTERS.condition.transform(input);
            };
        });

        private Transform<Method, Boolean> condition;

        private Filter(Transform<Method, Boolean> condition) {
            this.condition = condition;
        }

    };

    /**
     * Iterate parent methods also?
     */
    public enum Scope {
        PARENTS_ALSO() {
            @Override
            protected Method[] getMethods(Class<?> c) {
                return c.getMethods();
            };
        },
        THIS_CLASS_ONLY() {
            @Override
            protected Method[] getMethods(Class<?> c) {
                return c.getDeclaredMethods();
            }
        };

        protected abstract Method[] getMethods(Class<?> c);
    }

    private final Filter filter;
    private final Scope scope;
    private final Class<?> theClass;

    /**
     * Constructor. 
     *
     * @param theClass
     * @param what
     */
    public BeanMethodIterator(Class<?> theClass, Filter what, Scope scope) {
        this.filter = what;
        this.theClass = theClass;
        this.scope = scope;
    }

    /**
     * Constructor. 
     */
    public BeanMethodIterator(Class<?> theClass) {
        this(theClass, Filter.BOTH, Scope.PARENTS_ALSO);
    }

    /**
     * Tells if a method is public
     * @param method
     * @return
     */
    private static boolean isPublic(Method method) {
        return (method.getModifiers() & MODIFIER_FILTER) == MODIFIER_EXPECTED; 
    }

    /**
     * {@inheritDoc}
     * @see java.lang.Iterable#iterator()
     */
    public Iterator<Method> iterator() {
        final Method[] methods = this.scope.getMethods(this.theClass);        

        return new Iterator<Method>() {
            int index = 0;

            public boolean hasNext() {
                while (index < methods.length) {
                    if (isPublic(methods[index]) && filter.condition.transform(methods[index]))
                        return true;
                    index++;
                }
                return false;
            }

            public Method next() {
                if (!hasNext())
                    throw new NoSuchElementException();
                return methods[index++];
            }

            public void remove() {
                throw new UnsupportedOperationException();
            }

        };
    }

    public static void main(String[] args) {
        for (Method m: new BeanMethodIterator(Date.class, Filter.GETTERS, Scope.THIS_CLASS_ONLY)) {
            System.out.println(m.getName());
        }
    }

}

/**
 * Represents a function that takes one input and returns a transformation of that input value i.e.
 * a transformation. The name Transform is used because it is shorter.
 * 
 * @author Hannes de Jager
 * @since 01 Sep 2008
 */
interface Transform<I, O> {

    /**
     * Invokes the function, performing the transformation, to produce an interpreted value.
     * 
     * @param input the input value.
     * @return The computed result.
     */
    public O transform(I input);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T13:34:22.350

Apache Commons BeanUtils ([http://commons.apache.org/beanutils](http://commons.apache.org/beanutils)）可能对你有用。没有任何可以*开箱即用的*实用程序，但我想所有的构建块都在那里，即访问属性、随机生成器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-26T20:02:32.890

[您可以使用InPUT](http://feldob.github.io/InPUT/)开源库做您想做的事情。它使用基于 XML 描述符的范围定义，而不是代码内定义。InPUT 使用方法和构造函数注入，支持任意初始化深度的复杂对象结构。[示例](https://github.com/feldob/InPUT#example-java)和[教程](https://github.com/feldob/InPUT/wiki/Tutorials)可用。

# java - 如何在 ant 中获取系统用户（在 eclipse 中）？

> ID：838617
> 
> 赞同：12
> 
> 时间：2009-05-08T07:30:20.703
> 
> 标签：java, eclipse, ant

如何在我的 ant 构建文件中访问系统用户的名称（eclipse 也用于 javadoc 作者标签）？

我试图在我的 java 应用程序中显示有关当前程序版本的一些信息。我决定使用[jreleaseinfo](http://jreleaseinfo.sourceforge.net/)将变量从我的 ant 构建脚本传递给我的 java 类（在窗口中显示它们）。使用[svnant](http://subclipse.tigris.org/svnant.html)，我什至能够从我的 build.xml 中的 svn 访问最新的修订号和构建日期。

现在：我需要做的最后一件事是展示是谁制作了这个版本！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-08T07:46:50.463

这将在任何地方工作。它使用 java 系统属性**user.name**。

```
<property environment="env" />
<echo message="user: ${user.name}" /> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T07:49:50.500

`user.name`可以使用：

```
<echo>User is: ${user.name}</echo> 
```

结果是：

```
[echo] User is: coobird 
```

# c# - 字段中的 Excel XML 换行符

> ID：838620
> 
> 赞同：0
> 
> 时间：2009-05-08T07:30:40.390
> 
> 标签：c#, xml, excel

我正在尝试使用 2003 XML 功能“Cheese\nBread”将以下字符串输出到 Excel 中的单元格，目前它忽略了换行符。

如果我创建一个具有所需效果的文件，那么我会得到以下输出

```
<Cell ss:StyleID="s62"><Data ss:Type="String">Cheese&#10;Monkey</Data></Cell> 
```

好的，所以我尝试做...

```
text.Replace('\n',(char)10); 
```

或 text.Replace("\n","");

无济于事，第一个没有任何用处，第二个 XmlWriter 只是用 & 转义它，这真的很有帮助。

任何想法，也许是 .NET XmlWriter 上的设置？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-05-18T13:59:24.220

我必须将以下内容添加到我的 XML 定义中（在“工作簿”元素中）：

```
<Styles>
  <Style ss:ID="sMultiLine">
    <Alignment ss:Vertical="Bottom" ss:WrapText="1"/>
  </Style>
</Styles> 
```

然后，在“Cell”元素中，添加适当的匹配样式：

```
<Cell ss:StyleID="sMultiLine"> 
```

我实际上添加了一个小的 XSLT 调整，以便只有在检测到内容中的换行符时才会显示值：

```
<xsl:if test="contains(.,'#10;')">
      <xsl:attribute name="ss:StyleID">sMultiLine</xsl:attribute>
</xsl:if> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T07:35:19.163

尝试`xml:space="preserve"`在`Data`元素上设置：

```
<Cell ss:StyleID="s62"><Data ss:Type="String" xml:space="preserve">Cheese
Monkey</Data></Cell> 
```

# asp.net - Addressing properties of a Shockwave Flash object (MultiPowUpload) in JavaScript

> ID：838621
> 
> 赞同：0
> 
> 时间：2009-05-08T07:32:09.017
> 
> 标签：asp.net, javascript, flash, shockwave

Please pardon the dumb newbie question; I've only been programming Javascript for about 24 hours... :)

I have managed (with some outside help) to embed a shockwave flash object into my page - specifically [MultiPowUpload 2.1](http://www.element-it.com/MultiPowUpload.aspx). It's appearing nicely on the page and seems to be functioning correctly; we can take that part as read.

Now I'm trying to do some more advanced stuff in JavaScript - I have a button, and in the `onClick()` code I have the following:

```
var swf = document.getElementById("FlashFilesUpload1");
var itemsCount = swf.filesCount;
alert("items: "+itemsCount); 
```

But the alert statement tells me "items: undefined". It does the same if I set `itemsCount` to `swf.nonExistentProperty` - everything is "undefined". But from what I read in the [documentation](http://www.element-it.com/OnlineHelpMulti/index.html), there definitely is a `filesCount` property. I tried accessing all the other properties and methods of this swf object, and none of them work, except for `toString()`, which returns "HTMLObjectElement".

I am obviously addressing this object incorrectly - but what am I doing wrong?

* * *

## Clarification

In response to [@brianpeiris](https://stackoverflow.com/questions/838621/addressing-properties-of-a-shockwave-flash-object-multipowupload-in-javascript/838754#838754): I am doing this quite differently from the page at the [link you suggested](http://www.element-it.com/Examples/MultiPowUpload/AdvancedHTMLinterface.html). I didn't do this with any great knowledge, I'm just really acting like a monkey, trying to copy other people's code that works, then tweak it so it does what I want... so don't assume I know anything, however obvious - remember, I've only been doing JavaScript for about a day now!

So here's the code for the control itself:

```
 <object id="FlashFilesUpload1" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0"
          classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" viewastext>
          <!-- Replace symbols " with the &quot; at all parameters values and 
    symbols "&" with the "%26" at URL values or &amp; at other values!
    The same parameters values should be set for EMBED object below. -->
          <param name="FlashVars" value="uploadButtonVisible=false&uploadUrl=../ReceiveBulkCases.aspx" />
          <param name="BGColor" value="#F8F6E6" />
          <param name="Movie" value="ClientSideControls/ElementITMultiPowUpload2.1.swf" />
          <param name="Src" value="ClientSideControls/ElementITMultiPowUpload2.1.swf" />
          <param name="WMode" value="Window" />
          <param name="Play" value="-1" />
          <param name="Loop" value="-1" />
          <param name="Quality" value="High" />
          <param name="SAlign" value="" />
          <param name="Menu" value="-1" />
          <param name="Base" value="" />
          <param name="AllowScriptAccess" value="always" />
          <param name="Scale" value="ShowAll" />
          <param name="DeviceFont" value="0" />
          <param name="EmbedMovie" value="0" />
          <param name="SWRemote" value="" />
          <param name="MovieData" value="" />
          <param name="SeamlessTabbing" value="1" />
          <param name="Profile" value="0" />
          <param name="ProfileAddress" value="" />
          <param name="ProfilePort" value="0" />
          <!-- Embed for Netscape,Mozilla/FireFox browsers support. Flashvars parameters are the same.-->
          <!-- Replace symbols " with the &quot; at all parameters values and symbols "&" with the "%26" at URL values or &amp; at other values! -->
          <embed bgcolor="#F8F6E6" id="EmbedFlashFilesUpload" src="ClientSideControls/ElementITMultiPowUpload2.1.swf"
            quality="high" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash"
            type="application/x-shockwave-flash" width="450" height="350" flashvars="uploadButtonVisible=false&uploadUrl=../ReceiveBulkCases.aspx">
</embed>
        </object> 
```

As you see it's embedded in the HTML as an `object`, unlike the reference you gave, where they do some other trick using script to get it onto the page.

BTW, when I tried it their way (not very hard, I grant you), I didn't manage to get the control even to appear on my page!

Thanks for your help... much appreciated

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T08:14:41.143

**编辑：**我想我终于想通了！您只需将 设置`useExternalInterfaces`为`Yes`。

所以在你的代码中你会改变

```
<param 
  name="FlashVars"
  value="uploadButtonVisible=false&uploadUrl=../ReceiveBulkCases.aspx" /> 
```

至

```
<param 
  name="FlashVars"
  value="uploadButtonVisible=false&uploadUrl=../ReceiveBulkCases.aspx&useExternalInterface=Yes" /> 
```

并对`<embed>`标签做同样的事情。

如果您访问[演示站点](http://www.element-it.com/Examples/MultiPowUpload/AdvancedHTMLinterface.html)并在 Firebug 中运行以下代码，它会`0`在您选择文件之前返回，并在您选择文件后返回正确的计数。此外，如果您检查来源，您会看到该`useExternalInterface`选项设置为`Yes`

```
alert(document.getElementById('MultiPowUpload').filesCount()); 
```

**PS**你应该考虑使用 MultiPowUpload 中包含的 SWFObject 脚本。它使您可以轻松设置和更改变量，而不必担心跨浏览器问题，并且它还可以为没有闪存的用户优雅地降级。

* * *

**进一步编辑** 回答您的评论：是的，我已经`filesCount`在我的机器上工作了。

我忘记提到的一件事是，您可能正在尝试`filesCount`在 Flash 控件完全加载之前进行检索。

以下是我正在使用的代码。我完全复制了您的代码并添加了`useExternalInterface`设置以及我自己的 javascript。

请注意，我的 javascript 代码使用该函数`filesCount`每 500 毫秒重复检查一次。`setInterval`

```
<object id="FlashFilesUpload1" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0"
  classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" viewastext>
  <!-- Replace symbols " with the &quot; at all parameters values and
  symbols "&" with the "%26" at URL values or &amp; at other values!
  The same parameters values should be set for EMBED object below. -->
  <param name="FlashVars" value="uploadButtonVisible=false&uploadUrl=../ReceiveBulkCases.aspx&useExternalInterface=Yes" />
  <param name="BGColor" value="#F8F6E6" />
  <param name="Movie" value="ClientSideControls/ElementITMultiPowUpload2.1.swf" />
  <param name="Src" value="ClientSideControls/ElementITMultiPowUpload2.1.swf" />
  <param name="WMode" value="Window" />
  <param name="Play" value="-1" />
  <param name="Loop" value="-1" />
  <param name="Quality" value="High" />
  <param name="SAlign" value="" />
  <param name="Menu" value="-1" />
  <param name="Base" value="" />
  <param name="AllowScriptAccess" value="always" />
  <param name="Scale" value="ShowAll" />
  <param name="DeviceFont" value="0" />
  <param name="EmbedMovie" value="0" />
  <param name="SWRemote" value="" />
  <param name="MovieData" value="" />
  <param name="SeamlessTabbing" value="1" />
  <param name="Profile" value="0" />
  <param name="ProfileAddress" value="" />
  <param name="ProfilePort" value="0" />
  <!-- Embed for Netscape,Mozilla/FireFox browsers support. Flashvars parameters are the same.-->
  <!-- Replace symbols " with the &quot; at all parameters values and symbols "&" with the "%26" at URL values or &amp; at other values! -->
  <embed bgcolor="#F8F6E6" id="EmbedFlashFilesUpload" src="ClientSideControls/ElementITMultiPowUpload2.1.swf"
    quality="high" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash"
    type="application/x-shockwave-flash" width="450" height="350" flashvars="uploadButtonVisible=false&uploadUrl=../ReceiveBulkCases.aspx&useExternalInterface=Yes">
  </embed>
</object>

<script>
  function updateMessage() {
    var message = (new Date()).toLocaleTimeString() + ': ';

    try {
      var objectElement = document.getElementsByTagName('object')[0];
      var embedElement = document.getElementsByTagName('embed')[0];

      if (objectElement.filesCount) {
        message += 'We are in IE ' + objectElement.filesCount();
      }
      else if (embedElement.filesCount) {
        message += 'We are in Firefox ' + embedElement.filesCount();
      }
      else {
        message += "The flash object is not loaded or useExternalInterface is not set to 'Yes'";
      }
    }
    catch (exp) {
      message += 'An error occurred';
    }
    document.getElementById('message').innerHTML = message;
  }

  // Update the message every 500 milliseconds
  setInterval(updateMessage, 500);
</script> 
```

# asp.net - 枚举和开关盒

> ID：838629
> 
> 赞同：3
> 
> 时间：2009-05-08T07:34:37.980
> 
> 标签：asp.net, enums, switch-statement, case

嗨，我正在使用带有开关的枚举转换为字符串，但它不起作用。它给出了编译错误：无法将类型“userControl_commontop.UserType”隐式转换为“字符串”

代码是：

```
private void CommonTopChangesnew(string usertype)
{

    switch (usertype.Trim().ToUpper())
    {
        case UserType.NORMAL :
            hlkSAD.Enabled = false;
            hlkMRTQuery.Enabled = false;
            hlkReqViewer.Enabled = false;
            hlkSendnotif.Enabled = false;
            break;
        case UserType.POWER :
            hlkSAD.Enabled = false;
            hlkReqViewer.Enabled = false;
            hlkSendnotif.Enabled = false;
            break;
    }
}

enum UserType
{
    NORMAL,
    POWER,
    ADMINISTRATOR
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T07:38:51.887

枚举不是字符串，正如常量`const int MY_VALUE = 1;`不是字符串一样。

您应该将字符串更改为枚举：

```
switch ((UserType)Enum.Parse(usertype, typeof(UserType))) {
  ...
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T07:39:01.603

你应该试试这个：

```
enum UserType
{
  NORMAL,
  POWER,
  ADMINISTRATOR
}

private void CommonTopChangesnew(string usertype)
{
  switch ((UserType)Enum.Parse(typeof(UserType), usertype, true))
  {
    case UserType.NORMAL:
      hlkSAD.Enabled = false;
      hlkMRTQuery.Enabled = false;
      hlkReqViewer.Enabled = false;
      hlkSendnotif.Enabled = false;
      break;
    case UserType.POWER:
      hlkSAD.Enabled = false;
      hlkReqViewer.Enabled = false;
      hlkSendnotif.Enabled = false;
      break;
  }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-08T07:44:34.990

您可以使用此函数将 userType 参数转换为枚举值：

```
object Enum.Parse(System.Type enumType, string value, bool ignoreCase); 
```

作为

```
UserType utEnum =  Enum.Parse(UserType, userType, true); 
```

然后您可以将您的 switch 语句称为：

```
switch (utEnum)
    { ... } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T07:40:20.603

您的函数接受字符串类型的参数，然后使用相同的参数来比较属于 Enum 的类型。冲突就在这里。

您的功能应该是：

```
private void CommonTopChangesnew(UserType usertype)
{

  switch (usertype)
  {
    case UserType.NORMAL :
      hlkSAD.Enabled = false;
      hlkMRTQuery.Enabled = false;
      hlkReqViewer.Enabled = false;
      hlkSendnotif.Enabled = false;
      break;
    case UserType.POWER :
      hlkSAD.Enabled = false;
      hlkReqViewer.Enabled = false;
      hlkSendnotif.Enabled = false;
      break;
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T07:41:44.780

您不能将字符串与枚举进行比较。

您应该将 Enum 传递给您的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T07:42:47.740

选项 1：更改您的 CommonTopChangesnew 以接受 UserType 枚举作为参数

或者

选项 2：使用 Enum.Parse 将您的字符串转换为开关块中的 UserType 枚举：

(UserType)Enum.Parse(typeof(UserType), usertype)

# c++ - 当有符号/无符号不匹配时会发生什么转换？

> ID：838639
> 
> 赞同：4
> 
> 时间：2009-05-08T07:38:11.373
> 
> 标签：c++, casting, warnings

当编译器发现有符号/无符号不匹配时，它会采取什么行动？有符号数是否转换为无符号数，反之亦然？为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T08:04:31.073

如果操作数是整数并且存在无符号值，则完成到无符号的转换。例如：

```
-1 > (unsigned int)1 // as -1 will be converted to 2^nbits-1 
```

转换 int->unsigned int 为：n>=0 -> n; n<0 -> n (mod 2^nbits)，例如 -1 到 2^nbits-1

转换 unsigned int->int 为：n <= INT_MAX -> n; n > INT_MAX -> 实现定义

> 如果目标类型是无符号的，则结果值是与源整数一致的最小无符号整数（模 2^n，其中 n 是用于表示无符号类型的位数）。
> 
> 如果目标类型是有符号的，则如果它可以在目标类型（和位域宽度）中表示，则该值不变；否则，该值是实现定义的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T08:08:48.863

我不认为 C++ 偏离了 C 处理有符号/无符号转换的方式：

> `unsigned`当涉及操作数时，转换规则更加复杂。问题是有符号值和无符号值之间的比较取决于机器，因为它们取决于各种整数类型的大小。(K&R)

要考虑的一个重要因素是其中一种类型是否为`long`整数，因为这会影响整数提升。例如，如果将 a 与 a`long int`进行比较`unsigned int`，并且 a`long int`可以表示 a 的所有值`unsigned int`，`unsigned int`则将转换为 a `long int`。（否则，它们都只是转换为`unsigned long int`.）

但是，在大多数情况下，如果编译器发现不匹配，它应该将有符号整数转换为无符号整数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T07:47:15.033

它可能是特定于编译器的。如果您查看问题“[我应该禁用 C 编译器有符号/无符号不匹配警告吗？](https://stackoverflow.com/questions/515803/should-i-disable-the-c-compiler-signed-unsigned-mismatch-warning) ”您会看到在“litb”的情况下，有符号变量“提升”为无符号值。

无论如何，一旦一个变量达到某个值（即设置了[最高有效位](http://en.wikipedia.org/wiki/Most_significant_bit)），编译器就没有“正确”的方法来处理这种情况。所以，如果你有这样的警告，一定要摆脱它；）

# python - Python字典深拷贝

> ID：838642
> 
> 赞同：21
> 
> 时间：2009-05-08T07:38:49.110
> 
> 标签：python, dictionary, deep-copy

我想知道 deepcopy 在以下情况下究竟是如何工作的：

```
from copy import deepcopy

def copyExample:
    self.myDict = {}
    firstPosition = "First"
    firstPositionContent = ["first", "primero"]
    secondPosition = "Second"
    secondPositionContent = ["second"]
    self.myDict[firstPosition] = firstPositionContent 
    self.myDict[secondPosition] = secondPositionContent
    return deepcopy(self.myDict)

def addExample(self):
    copy =  self.copyExample()
    copy["Second"].add("segundo") 
```

它是否返回对我在字典中的列表的引用？或者它是否按我的预期工作并将每个列表复制到具有不同参考的新列表中？

我知道什么是深拷贝（因此无需解释深拷贝和浅拷贝之间的区别），但我想知道它是否像我期望的那样工作，因此在我使用`addExample()`.

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-08T07:49:17.400

该[文档](http://docs.python.org/library/copy.html)清楚地表明您正在获得新副本，而不是参考。Deepcopy 为内置类型创建深层副本，但有各种例外情况，您可以向用户定义的对象添加自定义复制操作，以获得对它们的深层复制支持。如果您不确定，那么这就是单元测试的目的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-02-20T09:51:02.043

我知道它没有回答你的问题，但我认为这对于关注这个问题的人来说是值得注意的。

如果您要复制的数据本质上很简单，那么 deepcopy 可能会有点矫枉过正。本质上很简单，我的意思是您的数据是否可以表示为 Json。让我用代码来说明：

我使用[http://www.json-generator.com/](http://www.json-generator.com/)来获取一些示例 json 数据。

```
def deepCopyList(inp):
    for vl in inp:
        if isinstance(vl, list):
            yield list(deepCopyList(vl))
        elif isinstance(vl, dict):
            yield deepCopyDict(vl)

def deepCopyDict(inp):
    outp = inp.copy()
    for ky, vl in outp.iteritems():
        if isinstance(vl, dict):
            outp[ky] = deepCopyDict(vl)      
        elif isinstance(vl, list):
            outp[ky] = list(deepCopyList(vl))  
    return outp

def simpleDeepCopy(inp):
    if isinstance(inp, dict):
        return deepCopyDict(inp)
    elif isinstance(inp, list):
        return deepCopyList(inp)
    else:
        return inp

if __name__ == '__main__':
    import simplejson as json
    import time
    from copy import deepcopy
    fl = open('sample.json', 'r')
    sample = json.load(fl)
    start = time.time()
    for _ in xrange(10000):
        tmp = simpleDeepCopy(sample)
    end = time.time()
    print 'simpleDeepCopy: ' + str(end - start)
    start = time.time()
    for _ in xrange(10000):
        tmp = deepcopy(sample)
    end = time.time()
    print 'copy.deepcopy: ' + str(end - start) 
```

输出：

```
simpleDeepCopy: 0.0132050514221
copy.deepcopy: 2.66142916679

simpleDeepCopy: 0.0128579139709
copy.deepcopy: 2.60736298561 
```

# windows - 选择引导操作系统的编程方式？

> ID：838651
> 
> 赞同：0
> 
> 时间：2009-05-08T07:40:45.780
> 
> 标签：windows, boot

我正在设置一个测试平台，我正在测试跨多个 Windows 操作系统的设备连接。我无法在 VM 中执行此操作（无法虚拟化对设备的访问），因此我有一个多引导系统。我有一个脚本来自动化这个过程，但我希望它继续完成，选择下一个操作系统来启动并运行它的测试。

一个问题是 XP/2K3 使用 boot.ini 而 Vista 和更高版本使用 BCDEdit。我可以手动拥有两个脚本……每个 XP/2K3 一个来编辑 boot.ini。然后是用于 Vista 系统的 BCDEdit。不过，我讨厌必须对每一个都进行硬编码，尤其是如果我必须根据测试条件更改顺序和/或关闭某些操作系统。

BCDEdit 还使用 GUID 作为其条目，这意味着在不同的机器上进行设置意味着确定接下来要转到哪个 GUID。

有什么想法或提示吗？是否有任何实用程序可以帮助自动执行此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-13T22:09:39.783

我假设您的各种风格的 Windows 位于不同的分区上。[使用 Ubuntu LiveCD 安装 GRUB](http://www.howtogeek.com/howto/ubuntu/reinstall-ubuntu-grub-bootloader-after-windows-wipes-it-out/)并编写多个配置文件，每个配置文件都选择一个操作系统作为默认值。为 /boot 创建一个 HD 分区，并将 GRUB 配置存储在同一位置。

您的每个 Windows 分区都需要安装[Ext2 IFS 驱动程序](http://www.fs-driver.org/)，并将您之前创建的 EXT2 分区安装为 z: 或其他东西。然后您的测试脚本可以执行以下操作：

```
mountvol z: %bootvolname%
copy /y boot_to_vista_64.lst z:\boot\grub\menu.lst
shutdown -r -f -t 0 
```

`%bootvolname%`有点复杂，并且是特定于操作系统的。您需要将它与每个操作系统分区一起存储，并且您可以`mountvol z: /l`在该操作系统运行时通过这样做来获取它。

# language-features - Programming features missing in C++ and Java

> ID：838663
> 
> 赞同：0
> 
> 时间：2009-05-08T07:44:19.627
> 
> 标签：language-features

What are the programming features that are missing in C++ and Java ?

For eg. You can't do recursive programming in QBasic ? You can't dynamically allocate memory in QBasic.

What would be the good to have features in C++, Java.

I think Lisp Programmers will be able to add a few.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T07:45:50.603

I miss lambda expressions.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T07:51:13.073

I think this is a very subjective question. From a theoretical point of view there's nothing "missing" in Java because you can do everything you want to from the perspective of the outcome as an application.

As with QBasic - recursion may not be possible but that doesn't prevent you from changing your recursive algorithm to an iterative algorithm. Programming language theory tells us that you can do this with every recursive problem. So there's also nothing missing here.

I think what you mean are features that are "nice to have" - and here everyone has to decide for himself. I'd even say there are features in the language which would have been "nice not to have" such as static imports - but again this is my subjective opinion...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-30T15:35:05.260

This answer deals only with C++

Things I miss from the syntax, or the standard library:

1.  RegExp as part of the standard library
2.  Threads as part of the standard library
3.  Pointer to member methods (not objects!)
4.  Properties would be nice (I have seen codes that emulate this via C++ preprocessor... note an nice looking code).
5.  Some lower level networking API (sockets!), and higher level API (give me this file from this ftp, submit "this" to this site via POST).

This is the list of things I would like to see, but I assume other people will disagree with me.

1.  Memory garbage collector is nice.
2.  A n interface for a GUI toolkit - let MSVC map it to win32, and on Linux... (good question!)
3.  A stable ABI. In C it's a standard - but on C++ we are still missing a few decades. I want also stable ABI between compilers - I want to compile one library in MinGW, the other with CL and all should work.

This is the list of things I want to see, but I know they will not get away:

1.  Compatibility with C. Really, it's a myth right now. `using namespace std` killed it.
2.  Include, headers. Most of the information is already available in the DLL/so/a/"library", do we really need to keep this bad decision from 30 years ago? If needed the compilers should keep information in the binaries.
3.  The need for Makefiles - the compiler should be smart enough to know what to do with this code, from the code itself. Pascal is doing it quite good. I think also D.
4.  (I might be wrong, please correct me) The official standard openly and freely available for viewing. Why should I pay for the official papers? Do I need to do it for HTTP? UTF8? Unicode?

# c# - 在 FCKEditor 中上传文件时权限被拒绝错误

> ID：838665
> 
> 赞同：0
> 
> 时间：2009-05-08T07:44:56.440
> 
> 标签：c#, asp.net, iis, iis-7, fckeditor

我最近将我的 asp.net 应用程序从 windows 2003 / IIS 6 移到了 windows IIS7。没有其他更改，但现在 fckeditor 的文件上传不再起作用。任何人都知道我在这里犯的明显错误。:)

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T08:21:41.970

最可能的问题是需要更新目标文件夹的权限。检查以确保 IUSR 对上传目录具有创建/写入权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-05T18:43:00.560

也许这会有所帮助。

我也无法让它工作。我设置了所有权限。通过调试，我发现frmupload.html对isapi.dll没有执行权限。

在 IIS 7.0 中，我转到左侧的网站并突出显示它。然后在右窗格中，我单击了处理程序映射。我在顶部注意到 isapi 和 cgi 在顶部被禁用。

我往下看，看到了所有启用的处理程序。我还注意到 *.html 没有一个，但 *.html 有一个。无论如何，我右键单击下方窗格中启用的处理程序所在的任何位置，我得到了一个快捷菜单。编辑功能权限是您要单击的选项。然后你会看到读取、脚本和执行的复选框。我注意到未检查执行，所以我检查了它。

现在 ISAPI 和 CGI​​ 已在列表中启用。我尝试使用 FCKeditor 上传，它工作正常。只需确保将正确的文件类型上传到正确的区域，否则您可能会收到无效文件或无效文件类型消息。

但是，我注意到我不断收到一个新错误。SYS 在我的网页上是未定义的错误消息。它是一个 javascript 错误，通常在找不到某些内容时发生。如果您在谷歌上搜索，您可能会收到此错误消息，有很多原因。在这种情况下，这是因为我使用 Vista IIS7.0 启用了具有执行权限的 ISAPI。它进入了我的配置文件，并为启用执行权限进行了正确的设置更改，但是它删除了我所有的处理程序设置！！！！

我备份了我的 webconfig 并手动读取了设置。我认为手动编辑 webconfig 文件而不是让 IIS7 这样做可能会更好，因为它会这样做，但它可能会删除您的一些设置。

这是我在 VISTA IIS7 Web 服务器上的 webconfig 文件的一部分，之前和之后：

## WebConfig 之前：在 VISTA IIS 7.0 web.config 中启用 cgi 和 isapi 上的执行

```
<!-- 
    The system.webServer section is required for running ASP.NET AJAX under Internet
    Information Services 7.0\.  It is not necessary for previous version of IIS.
-->
<system.webServer>
    <validation validateIntegratedModeConfiguration="false"/>
    <modules>
        <remove name="ScriptModule"/>
        <add name="ScriptModule" preCondition="managedHandler" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
    </modules>
    <handlers>
        <remove name="WebServiceHandlerFactory-Integrated"/>
        <remove name="ScriptHandlerFactory"/>
        <remove name="ScriptHandlerFactoryAppServices"/>
        <remove name="ScriptResource"/>
        <add name="ScriptHandlerFactory" verb="*" path="*.asmx" preCondition="integratedMode" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
        <add name="ScriptHandlerFactoryAppServices" verb="*" path="*_AppService.axd" preCondition="integratedMode" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
        <add name="ScriptResource" preCondition="integratedMode" verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
    </handlers>
</system.webServer>
<runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
        <dependentAssembly>
            <assemblyIdentity name="System.Web.Extensions" publicKeyToken="31bf3856ad364e35"/>
            <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0"/>
        </dependentAssembly>
        <dependentAssembly>
            <assemblyIdentity name="System.Web.Extensions.Design" publicKeyToken="31bf3856ad364e35"/>
            <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0"/>
        </dependentAssembly>
    </assemblyBinding>
</runtime> 
```

之后：注意

## 添加，我所有的处理程序都消失了。我刚读了它们，它起作用了。

```
<!-- 
    The system.webServer section is required for running ASP.NET AJAX under Internet
    Information Services 7.0\.  It is not necessary for previous version of IIS.
-->
<system.webServer>
    <validation validateIntegratedModeConfiguration="false" />
    <modules>
        <remove name="ScriptModule" />
        <add name="ScriptModule" preCondition="managedHandler" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
    </modules>
    <handlers accessPolicy="Read, Execute, Script">
    </handlers>
</system.webServer>
<runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
        <dependentAssembly>
            <assemblyIdentity name="System.Web.Extensions" publicKeyToken="31bf3856ad364e35" />
            <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0" />
        </dependentAssembly>
        <dependentAssembly>
            <assemblyIdentity name="System.Web.Extensions.Design" publicKeyToken="31bf3856ad364e35" />
            <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0" />
        </dependentAssembly>
    </assemblyBinding>
</runtime> 
```

* * *

我在开发机器 VISTA 上，所以我没有考虑打开 Execute 的任何安全问题。希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T08:29:02.200

就像 Sohnee 所说的最可能的权限一样，还要确保“上传”文件夹确实存在于您的“公共”文件夹中（我不确定它在 ASP 中的位置）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T10:11:48.100

确保 asp.net 和 iisuser_machinename 用户将拥有权限。

# c++ - 有没有办法禁止转换为 C++ 中非常量的子类？

> ID：838670
> 
> 赞同：0
> 
> 时间：2009-05-08T07:48:25.777
> 
> 标签：c++, inheritance, constants

这是一个完整的例子。我想通过只允许将 B 转换为 const A 来禁止从从 B 转换到 A 的对象中使用 A::set。怎么做？（我不能使用虚函数）

```
#include <iostream>
#include <cassert>

using namespace std;

class A {
public:
  int  get() const { return i_; }
  void set(int i) { i_ = i; }
protected:
  int i_;
};

class B : public A {
public:
  int  ok() const { return A::get() == copy_i_; }
  void set(int i) { A::set(i); copy_i_ = i; }
protected:
  int copy_i_;
};

void test2() {
  A a;
  a.set(3); // ok here
  cout << a.get() << endl;

  B b;
  b.set(5);
  A& aa = b;
  assert(b.ok());
  aa.set(3); // not ok here
  assert(b.ok()); // fail-here
}

int main() {
  test2();
  return 0;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T08:41:22.733

您可以将继承设为私有并在 B 中提供一个成员函数来使用而不是强制转换。

```
const A& B::convert_to_A() const { return *this; } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T07:57:21.390

为什么要铸造？使 void A::set(int i) protected 将适用于您的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T08:13:45.937

没有必要禁止非常量强制转换。您可以使用[模板方法设计模式](http://en.wikipedia.org/wiki/Template_method_pattern)来解决您的问题。

```
#include "stdafx.h"
#include <iostream>
#include <cassert>

using namespace std;

class A {
public:
  int  get() const { return i_; }
  void set(int i) { assert(i_ = i); copy_i();}

protected:
  int i_;
  virtual void copy_i(){};
};

class B : public A {
public:
  int  ok() const { return A::get() == copy_i_; }
protected:
  int copy_i_;
  void copy_i(){copy_i_ = i_; }
};

void test2() {
  B b;
  b.set(5);
  A& a = b;
  assert(b.ok());
  a.set(3);
  assert(b.ok()); // success!
}

int main() {
  test2();
  return 0;
} 
```

# .net - 互操作问题 - - 不同操作系统架构的不同 C# 结构

> ID：838671
> 
> 赞同：1
> 
> 时间：2009-05-08T07:49:11.813
> 
> 标签：.net, interop

我有一个 C++ 结构，我必须从我的 C# 代码互操作它。

我将我的 C# 代码编译为与平台无关的 dll，这意味着我可以在不同的平台（**32 位或 64 位——没关系**）上使用相同的 C# dll，而我为不同的平台以不同的方式分发 C++。

问题是我必须互操作的 C++ 结构似乎适用于不同的 C# 定义。在 64 位操作系统中，以下结构有效：

```
 [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
    public struct MayDay_CONTEXT
    {
        public System.UInt32  dwIndex;      //previously was int
        public System.UInt32 dwVersion;     //previously was int        
        public System.UInt64 hLock;         //previously was int
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = 12)]
        public byte[] reserve;
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = 56)]
        public byte[] bAtr;
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = 8)]
        public byte[] bID;
        public uint dwAtrLen;
    } 
```

但在 32 位操作系统中，以下结构有效：

```
 [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
    public struct MayDay_CONTEXT
    {
        public int  dwIndex;        //previously was int
        public int dwVersion;       //previously was int        
        public int hLock;           //previously was int
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = 12)]
        public byte[] reserve;
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = 56)]
        public byte[] bAtr;
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = 8)]
        public byte[] bID;
        public uint dwAtrLen;
    } 
```

无论如何在运行时设置结构成员的类型？我知道我需要一种鸭子打字来做到这一点，但也许有更好的解决方案......有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T07:51:39.593

`IntPtr`(for `hLock`) 会起作用吗？否则，您可能必须在源代码中使用#if 定义... - 即

```
#if X86
     ..
#else
     ..
#endif 
```

并在您的 32 位版本中定义`X86`符号（没有内置任何东西）

# algorithm - 寻找相等的子图

> ID：838672
> 
> 赞同：0
> 
> 时间：2009-05-08T07:49:16.133
> 
> 标签：algorithm, graph-theory

鉴于：

*   有向图
*   节点有标签
*   同一个标签可以出现多次
*   边缘没有标签

我想找到一组最大的（连接的）子图，它们在考虑节点标签的情况下是相等的。

该图可能很大（数百万个节点）有没有人知道一个有效的解决方案？

我正在寻找算法，最好是 Java 实现。

更新：因为这个问题很可能是 NP 完全的。我也会对产生近似解的算法感兴趣。

这似乎至少很接近： [频繁子图](http://www.borgelt.net/papers/mlg_07.pdf)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T19:23:55.973

I strongly suspect that's NP-hard.

Even if all the labels are the same that's at least as hard as graph isomorphism. (Join the two graphs together as a single disconnected graph; are the largest equal subgraphs the two original graphs?)

If identical labels are relatively rare it might be tractable.

# c++ - 抛出析构函数，内存损坏？

> ID：838674
> 
> 赞同：2
> 
> 时间：2009-05-08T07:49:46.930
> 
> 标签：c++, exception, destructor

我们有一个类，其语义行为如下：-

```
struct Sample
{
  ~Sample() throw() 
  {
    throw 0;
  }
};

void f ()
{
  try
  {
    delete new Sample;
  }
  catch (...){
  }
} 
```

我知道在 dtors 中抛出异常是邪恶的；但是放弃第 3 方库资源会引发异常（但可以立即重新获取，这很奇怪！）。还有一个资源池，比如 Sample 类的数组/容器。因此，有两种情况需要考虑：动态分配对象的销毁和动态分配的对象数组的销毁。

目前，只有在使用数组版本（池）时，应用程序才会在不同的执行点随机崩溃。我们认为这是由于内存损坏，但为什么非池化版本有效？

分配的内存会发生什么？它是未定义的行为吗？在数组的情况下会发生什么？数组的所有元素（比如第一个元素的 dtor 是否抛出）的 dtors（至少，不是内存）是否被调用？

提前致谢，

EDIT-1：好吧，我们将其追踪到一些未调用的数组元素的 dtors。但是分配的内存似乎没有问题......以下是SC22-N-4411.pdf的第5.3.5.7节）

```
If the value of the operand of the delete-expression is not a null pointer value, the delete-expression will
call a deallocation function (3.7.4.2). Otherwise, it is unspecified whether the deallocation function will be
called. [ Note: The deallocation function is called regardless of whether the destructor for the object or some
element of the array throws an exception. —end note ] 
```

<\截图>

在这种情况下，看起来内存总是被释放。我对标准的解释正确吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T08:26:25.080

在这种情况下可能会发生两件事：

*   调用终止（）
*   未定义的行为

在这两种情况下都不能保证释放动态分配的内存（除非应用程序终止当然会将所有资源返回给操作系统）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T08:06:13.690

如果 dtor 由于另一个异常而在堆栈被展开时抛出异常，C++ 将终止您的应用程序。

由于几乎不可能确定在什么情况下调用 dtor，因此标准规则是**永远不要**从 dtor 中抛出异常。

如果您的第 3 方库抛出异常，请将其捕获到您的 dtor 中，记录它，或将其状态保存到某个静态缓存中，您可以“稍后”将其拾取，但不要让它逃出您的 dtor。

这样做，然后查看您的对象集合是否有效，这可能会导致您的崩溃。

**更新**

不幸的是，我不是规范律师，更喜欢[渔人之友](http://en.wikipedia.org/wiki/Fisherman's_Friend)的“吸一口”的方法。

我会编写一个带有类的小应用程序，该类从堆中分配一个兆。在一个循环中，创建一个类数组，让类 dtor 抛出一个异常，并在循环结束时抛出一个 catch 异常（导致堆栈展开并调用类数组的 dtor）并观察它看到你的虚拟机使用率飙升（我很确定它会）。

对不起，我不能给你章节，但这是我的“信念”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T15:14:41.827

既然您在评论中询问章节和经文：

15.2:3 有一个注释，说：

“如果在堆栈展开期间调用的析构函数以异常终止退出，则调用（15.5.1）。因此析构函数通常应捕获异常，而不是让它们传播出析构函数”

据我所知，在那里说“一般”的唯一理由是，可以非常仔细地编写一个程序，这样析构函数可以抛出的任何对象都不会作为堆栈展开的一部分被删除。但在普通项目中，这比“析构函数不能抛出”更难执行。

15.5.1 和 2 说：

“在以下情况下...... - 当堆栈展开（15.2）期间对象的破坏使用异常退出时......`void terminate()`被调用”。

15.5.1 中的 terminate() 还有一些其他条件，这些条件建议您可能不想抛出其他东西：异常的复制构造函数、atexit 处理程序和`unexpected`. 但是例如，复制构造函数失败的最可能原因是内存不足，例如在 linux 上可能会出现段错误，而不是无论如何抛出异常。在这种情况下 terminate() 似乎并没有那么糟糕。

*在这种情况下，看起来内存总是被释放。我对标准的解释正确吗？*

在我看来，被删除对象的内存总是被释放。它并不意味着它通过指针拥有并在其析构函数中释放的任何内存都被释放，特别是如果它是一个数组并且因此有几个析构函数可以调用。

哦，是的，你相信你的第三方库是异常安全的吗？免费期间的异常是否有可能使库处于其作者没有预料到的状态，并且崩溃是因为这个？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T08:07:24.907

1）从析构函数抛出异常是不好的，因为如果正在处理异常并且发生另一个异常，应用程序将退出。因此，如果在异常处理期间您的应用程序清除了对象（例如，在每个对象上调用析构函数）并且其中一个析构函数抛出另一个异常，则应用程序将退出。

2）我认为当容器中的其他元素抛出异常时，不会自动调用析构函数。如果在容器的析构函数中抛出异常，那么其余元素肯定不会被清理，因为应用程序将在处理异常时展开堆栈。

编写析构函数的标准方式应该是这样的：

```
A::~A()
{
   try {
         // some cleanup code
   }
   catch (...) {} // Too bad we will never know something went wrong but application will not crash
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T08:23:21.903

析构函数绝不能抛出异常，它会导致未定义的行为，也可能导致内存泄漏。让我们考虑以下示例

```
T* p = new T[10];
delete[] p; 
```

那么，如果 T 抛出析构函数，new[] 和 delete[] 将如何反应？

让我们首先考虑构造都顺利进行，然后在 delete[] 期间抛出第四个左右的析构函数。delete[] 可以选择传播异常，这将导致留在数组中的所有其他 T 对象丢失，不可检索，因此不可破坏。它也无法“捕获”异常，因为这样 delete 将不再是异常中性的。

其次，假设其中一个构造函数抛出。假设第 6 个构造函数抛出异常。在堆栈展开期间，必须解构到目前为止已构建的所有对象。所以调用了第 5、4、3 等等析构函数。如果第四个或第三个析构函数抛出另一个异常会发生什么？它应该被吸收还是传播？

对此没有答案，因此该主题会导致未定义的行为。

正如我在第一个示例中所述，也可能导致内存泄漏。

# javascript - 如何确保至少选中一个复选框？

> ID：838677
> 
> 赞同：3
> 
> 时间：2009-05-08T07:49:53.793
> 
> 标签：javascript

我正在使用其值来自数据库的复选框。它的名字是一样的，但名字是这样的：

```
<input type="checkbox" id="chkBankServices" name="<%=bs.getServiceID()%>">
<%=bs.getServiceDesc()%> 
```

通过这个我从数据库中获取值。现在我必须验证至少应该选择一个复选框..

如果有人可以帮助我，我将感谢你。如果我给这样的javascript代码：

```
var services = document.getElementsById( 'chkBankServices' );
if(!(services[0].checked) && 
   !(services[1].checked) && 
   !(services[2].checked) && 
   !(services[3].checked) && 
   !(services[4].checked) && 
   !(services[5].checked) && 
   !(services[6].checked) &&
   !(services[7].checked) && 
   !(services[8].checked))
{ 
    alert( "Please select at least one service to submit." );
    return false;
} 
```

它没有发出任何警报消息。有什么不对吗。请帮助我...提前谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T07:58:39.577

在 jQuery 中：

```
 alert(  $("#chkBankServices input[type=checkbox]:checked").length > 0 ); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T07:56:49.313

尝试这个：

```
var services = document.getElementById( 'chkBankServices' );
var checkboxes = services.getElementsByTagName('input');
var checked = false;
for (var i=0,i0=checkboxes.length;i<i0;i++)
if (checkboxes[i].type.toLowerCase()=="checkbox")
{
    if (checkboxes[i].checked) checked = true;
} 
```

接着：

```
if (!checked)
{
    alert('Not checked');
    return false;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T07:57:52.527

没有 getElementsById 方法，因为应该只有一个具有给定 id 的元素。也许您打算使用[getElementsByName](https://developer.mozilla.org/en/DOM/document.getElementsByName)？这允许返回多个元素。

由于这确实是一个客户端问题，如果您可以发布生成的 HTML 的示例，这将有所帮助，我们可以为您提供进一步的指导。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T07:54:21.693

您是否检查了渲染的源以确保您的复选框被赋予了预期的名称？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T07:58:47.530

我不知道这是否会帮助您解决特定问题，但是如果您避免使用大量 if 块并改用循环，您的代码会更容易阅读：

```
var checked = false;
for(var i=0;i<services.length;i++){
  if(services[i].checked){
    checked = true;
  }
}
if(!checked){
    alert( "Please select at least one service to submit." );
    return false;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T08:14:35.450

查看您的代码，我打赌您在某种中继器中拥有该复选框，并且正在创建多个具有相同 ID 的复选框，这是无效的 html。我会将它包装在 div/span 或类似下面的 id 中：

```
 if (!isSomethingChecked()) {
    alert( "Please select at least one service to submit." );
    return false;
 }

  function isSomethingChecked() {
    var parent = document.getElementById("chkBankServices");
    for (var child in parent.childNodes) {
        var node = parent.childNodes[child];
        if (node && node.tagName === "INPUT" && node.checked) {
            return true;
        }
    }
    return false;
 } 
```

我假设 HTML 看起来像：

```
<div id="chkBankServices">
    <input type="checkbox" id="Checkbox1" />
    <input type="checkbox" id="Checkbox2" checked="checked"/>
    <input type="checkbox" id="Checkbox3" checked="checked"/>
    <input type="checkbox" id="Checkbox4" />
    <input type="checkbox" id="Checkbox5" />
    <input type="checkbox" id="Checkbox6" />
    <input type="checkbox" id="Checkbox7" />
</div> 
```

# c# - C#中数据网格的行数和列数

> ID：838679
> 
> 赞同：8
> 
> 时间：2009-05-08T07:49:57.630
> 
> 标签：c#, datagrid

考虑我有一个数据网格，我需要找到数据网格中的行数和列数。我怎样才能在 C# 中做到这一点？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-08T07:53:45.360

该`DataGrid.Items`属性返回一个`DataGridItemCollection`表示`DataGridItems`DataGrid 中的 。

每个`DataGridItem`都代表呈现表中的单行。此外，还`DataGridItem`公开了一个`Cells`表示编号的属性。呈现的表格中的表格单元（换句话说，列）。

```
int rowCount = myGrid.Items.Count;

// Get the no. of columns in the first row.
int colCount = myGrid.Items[0].Cells.Count; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T07:54:05.203

DataGrids 代表实际的 DataItems。

```
DataGrid dg = new DataGrid();

dg.Items.Count; //Number of Items...i.e. Rows;
dg.Items[0].Cells.Count; //Number of columns for that Items 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T08:31:00.123

首先，回答你的问题：

```
DataGrid dataGrid = new DataGrid();
int rowCount = dataGrid.BindingContext[dataGrid.DataSource].Count; 
```

或者，如果您确定 DataSource 的类型：

```
int rowCount = ((DataTable)this.dataGrid.DataSource).Rows.Count;
int columnCount = ((DataTable)this.dataGrid.DataSource).Columns.Count;

((DataTable)this.dataGrid.DataSource).Columns.Count; 
```

其次，我要补充的是，a`System.Windows.Forms.DataGrid`是一个显示小部件控件，而不是一个记录容器。没有`DataGrid.Rows.Count`属性或类似的东西可以找出列数。您需要做的是查看 DataGrid 后面的`DataSource`属性，在大多数情况下，该属性是 a`DataTable`并从那里获取您需要的信息。

# apache-flex - Flex/Flash 如何释放内存？

> ID：838686
> 
> 赞同：1
> 
> 时间：2009-05-08T07:52:04.990
> 
> 标签：apache-flex, flash, user-interface

在 Flash 中释放内存的最佳方法是什么？它有垃圾收集器吗？如何调用该 GC ？如何使对象适用于垃圾收集？

我有一个显示很多图表的网站。我观察到当我们显示这些图表时 IE 使用的内存继续增加，有时达到 500 Mb 左右。我总是将未使用的对象重新初始化为 NULL。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T08:16:05.447

AS3 有一个内置的 GC。可以说，关于其工作原理的最佳资源是 Grant Skinner 关于该主题的文章：

[http://www.gskinner.com/blog/archives/2006/06/as3_resource_ma.html](http://www.gskinner.com/blog/archives/2006/06/as3_resource_ma.html)

您可以使用 Flex 分析器（仅限 Flex Pro）来了解垃圾收集的工作原理。分析器显示内存中当前有哪些对象，并且可以选择在单击按钮时强制进行垃圾收集，从而更容易确定哪些对象在给定时间有资格进行垃圾收集。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T14:15:04.233

仅将对象引用设置为 NULL 并不总是足够的。如果您创建了引用该对象的任何事件侦听器（或者如果该对象本身已注册为侦听器），那么它仍将在某处被引用。

避免听众出现此类问题的一种方法是使用弱引用。addEventListener 接受一个可选参数，让您告诉它使用弱引用。如果除了弱引用事件侦听器（或其他弱引用）之外没有引用对象，这将允许对象被垃圾回收。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T20:00:23.780

In many cases you can free Flex objects from the heap but the Flash VM won't give the memory back to the OS. Thus you have to code to a memory "plateu".

[http://www.craftymind.com/2008/04/09/kick-starting-the-garbage-collector-in-actionscript-3-with-air/](http://www.craftymind.com/2008/04/09/kick-starting-the-garbage-collector-in-actionscript-3-with-air/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T13:54:27.717

我可以给您的一个提示是在不再需要事件侦听器时删除它们 - 例如，如果您正在调用 WebService 来检索一些静态数据，并使用 ResultEvent 侦听器，一旦处理了该事件侦听器，请调用 removeEventListener 以释放增加它正在使用的内存。还有许多其他技巧可用于处理内存使用。

# iphone - 如何在不使用界面生成器的情况下将视图与控制器分离

> ID：838694
> 
> 赞同：1
> 
> 时间：2009-05-08T07:54:43.517
> 
> 标签：iphone, model-view-controller, xib

我想在不使用 xib 文件的情况下以编程方式创建 UI 元素。我发现的所有示例（UICatalog，...）都是直接在控制器方法中创建 UI 元素。跟上 MVC 模式并将视图与控制器分开的最佳实践是什么？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T07:58:49.623

如果我正确理解了这个问题，您所要做的就是创建一个单独的视图类来负责创建 UI 元素。然后在控制器类中，您只需创建视图类的实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T12:58:01.470

zoul 的回答是正确的。为了帮助您做到这一点，这些工具可以将 XIB 转换为与创建视图相同的 Objective-C 代码：

[http://arstechnica.com/apple/guides/2009/04/iphone-dev-convert-xib-files-to-objective-c.ars](http://arstechnica.com/apple/guides/2009/04/iphone-dev-convert-xib-files-to-objective-c.ars)

# iphone - iPhone如何抑制电话拨号器屏幕

> ID：838697
> 
> 赞同：0
> 
> 时间：2009-05-08T07:56:48.067
> 
> 标签：iphone, objective-c, cocoa-touch

我正在编写一个使用“tel”协议拨打电话号码的应用程序。拨打标准 iPhone 拨号器屏幕时会弹出。有什么方法可以抑制这个屏幕吗？或者让这个屏幕设备方向感知？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T08:02:05.870

我认为不可能隐藏屏幕，因为这将使应用程序能够在用户甚至不知道的情况下拨打电话。不过，没有检查文档。

至于方向，不确定，但我不这么认为。但是你打电话的时候不是竖着用的吗？

# oracle - 使用 proxool 和 oracle 在 Tomcat 中的热部署问题

> ID：838699
> 
> 赞同：0
> 
> 时间：2009-05-08T07:56:56.803
> 
> 标签：oracle, tomcat, proxool

我对 Tomcat 中的 proxool 和 oracle 驱动程序有疑问。

我使用的 web 应用程序包含一个 webservice jar 文件，它使用 metro 和一个 servlet 来初始化/启动 proxool 池。proxool 池配置了 oracle 连接。当服务被调用时，它从池中获取一个连接，执行一个语句并返回。之后我关闭服务方法中的结果集、语句和连接。

当我现在尝试热取消部署 Web 应用程序时，servlet 通过 ProxoolFacade.shutdown(); 停止 proxool 池；在它的破坏方法中。

问题是，热卸载无法完成，因为无法从提取的 Web 应用程序的文件夹中删除 Oracle 驱动程序 ojdbc5.jar。

尝试使用 SQL 服务器数据库和 jtds 驱动程序进行相同的操作，它不会出现此问题。

使用的版本：Apache Tomcat 6.0.18 Oracle 11g JDBC 驱动程序 11.1.0.6.0 Proxool 0.9.1

有人有想法吗？

问候蒂莫

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T09:30:11.273

您必须将 Oracle 驱动程序添加到 Tomcat 实例并[使用 Oracle 数据源配置 Tomcat JNDI](http://tomcat.apache.org/tomcat-5.5-doc/jndi-resources-howto.html)。

这样，当应用程序终止时，驱动程序将保持活动状态，并且 Tomcat 将控制数据库连接的池。您的问题的原因是一些数据库驱动程序“挂钩”到虚拟机中。这意味着 Tomcat 在重新部署期间无法卸载类——周围仍然有引用。

我什至建议尝试将 proxool 移动到 Tomcat 服务器中，并让 Tomcat 为您管理池。即使您泄漏连接，这也会使热部署更快、更可靠。

# wpf - 如何更改 WPF 中的输入法？

> ID：838701
> 
> 赞同：-2
> 
> 时间：2009-05-08T07:57:36.380
> 
> 标签：wpf, input

我想插入西班牙语或德语键盘，并且希望 WPF 应用程序中的文本框能够识别德语或西班牙语字符。

这可以通过通过区域设置更改系统的区域设置并选择西班牙语或德语键盘作为 IME 来实现。但我需要以编程方式而不是手动更改系统的语言环境。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T09:55:58.890

只是在黑暗中拍摄，但 TextBox 有一个**语言**属性。

```
<TextBox Language="{Binding}"> 
```

[http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.language.aspx](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.language.aspx)

因此，您可以将该属性绑定到代码中的语言环境属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-12T10:06:49.843

您可以使用以下语句以编程方式更改键盘语言

```
InputLanguageManager.SetInputLanguage(this, new CultureInfo("en-US"));
                    (Or)
  InputLanguageManager.SetInputLanguage(this, CultureInfo.CreateSpecificCulture("en-US")); 
```

在这里您可以使用任何语言代码而不是 en-US

# sql-server - sql服务代理功能问题

> ID：838704
> 
> 赞同：0
> 
> 时间：2009-05-08T07:58:09.373
> 
> 标签：sql-server, message-queue, messages, service-broker

我是一名刚起步的 Web 开发人员，正在从事一个雄心勃勃的 Web 应用程序项目。

所以在做了一些研究之后，我发现了 SQL Service Broker。这似乎是我可以使用的东西，但我不确定。由于学习它需要有人投入大量时间，因此我想确保它符合我的需求。

我需要实现一个网站用户可以向网站提交文本的系统。该消息流必须是冗余的并以 FIFO 方式处理，在流的另一端，另一组用户处理消息。

现在，最后一组用户中的一个正在阅读的消息应该被锁定，这样其他人就不能同时阅读它。然后用户可以决定是否处理该消息。只有当他决定处理该消息时，才能将其从队列中删除。如果他决定不想处理该消息，则应将该消息放回队列中（在队列的末尾，或至少具有最高优先级），以便另一个用户可以阅读并决定.

这是我可以用 SQL Service Broker 实现的吗？我在错误的轨道上吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T14:49:28.287

IMO，Service Broker 的最佳用途是以松散耦合的方式连接到独立的应用程序。我的意思是，以这种方式绑定的系统可以通过一组相互同意的消息类型进行通信。例如，这与一个应用程序直接操作另一个应用程序的数据库形成对比。

根据您所说，我会将其实现为一个简单的表，例如：创建一个带有身份 PK、分配标志和您的自定义列的消息表。每当操作员想要获取最后一条消息时，获取 Allocation = 'N' 的最低 PK 值并将 Allocation 更新为 'Y'。这在一个单一的交易中。当/如果操作决定将消息返回到队列，只需将其 AllocationFlag 设置为“N”并返回。

这只是一个例子。在这种情况下，数据库为您提供一致性、高负载性能等。

在屏幕后面，您提交给 SSB 的所有数据都以表格的形式存储和操作，因此没有理由让它比数据库解决方案更快。

# java - 将 Java 项目转换为动态 Web 项目

> ID：838707
> 
> 赞同：25
> 
> 时间：2009-05-08T07:58:48.530
> 
> 标签：java, eclipse, ganymede

我正在使用 Eclipse Ganymede 创建一个 Web 应用程序，但该项目目前只是一个标准的 Java 项目。我想将它转换为动态 Web 项目，我需要帮助。

我收到了有关编辑 .project 文件的建议，但是当我重新启动 Eclipse 时，它​​拒绝打开声称文件已损坏的项目。项目属性中也没有方面管理选项。

有什么建议么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-11-23T17:35:00.323

虽然这个问题已经得到解答，但我想说我设法通过更改项目方面 Properties-> Project Facet 将我的项目转换为 Web 项目，并且刚刚检查了 Dynamic Web Module

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-08T08:33:01.910

好。我会*告诉*你为什么，伙计们。这是因为很多这些指南错过了一些基本的东西。

1.  是的，您需要更改 .project 文件以添加一些缺少的性质和构建器（创建一个新的动态 Web 项目并检查创建的 .project 文件以查看缺少的内容）。

2.  您还需要将内容添加到 .settings 文件夹。它将丢失两个或三个文件，其中一个是关键的 xml 文件。它们都是它理解你赋予它的新本性所必需的。

计算机的 Huzzah。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-08-17T14:22:33.140

当您无法通过“Project Facets”添加“Dynamic Web Module”时，请确保您解锁并禁用“Utility Module”，因为它们是互斥的。

在我发现这一点之前，我已经花了很长时间（重新）编辑原始 .project 文件（根据前面提到的站点）。它可能是在我弄乱我的 Maven 配置时设置的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-03T12:07:07.457

在 eclipse 中不显示在服务器上运行选项。

我找到的解决方案是“检查项目属性/项目构面/动态 Web 模块”。为此，我们需要解锁实用程序模块，然后检查动态 Web 模块。

但是，实用程序模块也是 Java EE 应用程序所必需的。那么如何同时选择 Utility 和 Dynamic Web Module 以使其成为 Dynamic Web Project 以便我们可以获得 Run On server 选项。

注意：我已经在 .project 文件和 .settings 文件夹中复制了必要的东西。

# c# - 在内存中保存大型可编辑文档的最佳方法

> ID：838712
> 
> 赞同：5
> 
> 时间：2009-05-08T08:01:43.640
> 
> 标签：c#, algorithm, data-structures, string, document

我需要在内存中保存一个文档的表示，并且正在寻找最有效的方法来做到这一点。

假设

*   文档可能非常大，最大为 100MB。
*   文档通常会保持不变——（即我不想做不必要的前期处理）。
*   文档中的更改通常会非常接近（即，当用户键入时）。
*   应该可以快速应用更改（无需复制整个文档）
*   将根据偏移量和新/删除的文本（而不是行/列）应用更改。
*   在 C# 中工作

目前的考虑

*   将数据存储为字符串。易于编码，快速设置，更新非常慢。
*   行数组，比较容易编码，设置速度较慢（因为我们必须将字符串解析为行），更新速度更快（因为我们可以轻松插入删除行，但查找偏移量需要对行长度求和）。

这种事情必须有大量的标准算法（它不是一百万英里的磁盘分配和碎片）。

谢谢你的想法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T08:26:29.383

我建议将文件分成块。加载时所有块的长度相同，但如果用户编辑这些块，每个块的长度可能会改变。如果用户在前面插入一个字节，这可以避免移动 100 兆字节的数据。

要管理这些块，只需将它们 - 连同每个块的偏移量 - 放入一个列表中。如果用户修改了一个块的长度，你必须只更新这个块之后的偏移量。要查找偏移量，您可以使用二进制搜索。

**文件大小：** 100 MiB
**块大小：** 16 kiB
**块：6400**

**使用二分查找查找偏移量（最坏情况）：** 13 步
**修改块（最坏情况）：**复制 16384 字节数据并更新 6400 块偏移量
**修改块（平均情况）：**复制 8192 字节数据并更新 3200 块偏移量

16 kiB 块大小只是一个随机示例 - 您可以通过选择块大小来平衡操作成本，可能基于文件大小和操作概率。做一些简单的数学运算将产生最佳的块大小。

加载会非常快，因为您加载固定大小的块，并且保存也应该表现良好，因为您将必须编写几千块而不是几百万行。您可以通过仅按需加载块来优化加载，并且可以通过仅保存所有更改的块（内容或偏移量）来优化保存。

最后，实施也不会太难。您可以只使用`StringBuilder`该类来表示一个块。但是这种解决方案不适用于长度与块大小相当或更大的非常长的行，因为您将不得不加载许多块并仅显示一小部分，其余部分位于窗口的左侧或右侧。我假设在这种情况下您将不得不使用二维分区模型。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T10:10:46.357

Good Math, Bad Math 不久前写了[一篇关于绳索和间隙缓冲区](http://scienceblogs.com/goodmath/2009/02/gap_buffers_or_why_bother_with_1.php)的优秀文章，详细介绍了在文本编辑器中表示文本文件的标准方法，甚至为了实现的简单性和性能进行了比较。简而言之：间隙缓冲区 - 一个大字符数组，在光标当前位置之后有一个空白部分 - 是您最简单和最好的选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-21T16:37:27.917

您可能会发现这篇论文很有用——[文本序列的数据结构，](http://www.cs.unm.edu/~crowley/papers/sds.pdf)它描述并通过实验分析了一些标准算法，并比较了 [除其他外] 间隙缓冲区和片段表。

FWIW，它得出的结论是整体表略好一些；虽然 net.wisdom 似乎更喜欢间隙缓冲区。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T08:08:30.550

我建议您看一下[内存映射文件](http://en.wikipedia.org/wiki/Memory_mapped_file)（MMF）。

一些指示：

[内存映射文件 .NET](https://stackoverflow.com/questions/357170/memory-mapped-files-net)

[http://msdn.microsoft.com/en-us/library/ms810613.aspx](http://msdn.microsoft.com/en-us/library/ms810613.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T09:41:39.873

如果您不打算进行太多编辑，我会使用 b 树或跳过行列表或更大的块。

您没有太多额外的成本来确定加载时的行尾，因为无论如何您都必须在加载时访问每个字符。

您可以毫不费力地在节点内移动线条。

每个节点中文本的总长度存储在节点中，并且更改传播到父节点。

每行由一个数据数组表示，以及起始索引、长度和容量。换行符/回车符不放在数据数组中。断线等常用操作只需要修改对数组的引用即可；如果超出容量，编辑行需要副本。编辑该行时，每行可能会临时使用类似的结构，因此您不必在每次按键时都执行复制。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T08:16:37.957

在我的脑海中，我会认为索引链表对于这类事情会相当有效，除非你有一些*很*长的行。

链接列表将为您提供一种有效的方式来存储数据并在用户编辑时添加或删除行。索引允许您快速跳转到文件中的特定点。这种想法也很适合撤消/重做类型的操作，因为将编辑分类为小的原子操作应该相当容易。

不过，我同意 crisb 的观点，最好先让一些简单的工作，然后看看它是否真的*很*慢。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-08T08:13:10.367

从您的描述中，听起来很像您的文档只是未格式化的文本-因此字符串生成器就可以了。

如果它是一个格式化的文档，我会倾向于使用 MS Word API 或类似的，只是将您的文档处理卸载到它们 - 会为您节省大量时间，因为文档解析通常是一个痛苦的 a** ：- )

我不会太担心性能 - 听起来很像你还没有实现一个，所以你也不知道你的应用程序的其余部分有什么性能特征 - 可能是你不能当你真正开始分析它时，实际上可以在内存中保存多个文档。

# qt - 有没有一种简单的方法来自定义 QProgressBar？

> ID：838714
> 
> 赞同：2
> 
> 时间：2009-05-08T08:02:20.330
> 
> 标签：qt, qprogressbar

我想要一个以点结尾的 QProgressBar （宽度大于线的宽度）。我必须覆盖什么，或者我必须设置什么属性/属性才能达到这种效果？

编辑：这是我希望它看起来如何的图片：

[图片 http://www.freeimagehosting.net/uploads/48ea9662cd.png](http://www.freeimagehosting.net/uploads/48ea9662cd.png)

我必须从哪里开始？我应该怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T11:04:00.877

子类 QProgressBar，将点作为 QLabel 添加到类中，然后在 QLabel 上使用 setPixmap()。您将需要为您的小部件重载paintEvent() 以将点移动到正确的位置。

# zend-framework - 如何处理控制器名称的本地化？

> ID：838717
> 
> 赞同：4
> 
> 时间：2009-05-08T08:03:06.443
> 
> 标签：zend-framework, localization

我运行一个网站，其中重要的是拥有需要本地化的良好且简单的 URL。

英文版示例：example.com/car/?type=fiat

瑞典语版本示例：example.se/bil/?typ=fiat（bil 是瑞典语中的汽车）

当然，我想处理来自同一个代码库的所有这些 URL。处理这个问题的最佳方法是什么？

我应该设置几个控制器（CarController、BilController）还是有一种“更简洁”的方式来处理本地化的控制器名称？

BR尼克拉斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T09:55:03.057

不要那样做。曾经。

微软是一家非常强大、资源丰富的大公司，它使用 Excel 进行了尝试。在 Excel 的英文版本中，您可以`IF()`在公式中使用。在德语版本中，它是`WENN()`. 在法语中，它是`QUAND()`，我想。在日本，大概是`ば()`。现在想象一下来自日本的人给我发了一张 Excel 表格……有两种选择：

1.  “对不起，我无法打开这个文件”
2.  即时翻译所有名称

做#2 似乎很简单......直到你遇到一个使用相同字母但在两种语言中具有不同含义的单词。例如“见”。在英语中意为“看”，在德语中意为“湖”。由于您不了解世界上所有的语言，因此您没有机会在为时已晚之前弄清楚您将遇到哪些冲突。

另外，你怎么知道使用哪个名字？从浏览器中的语言？还是您讨厌偶尔使用瑞典主站点的国际客户？你如何处理亚洲语言？网址会`server/%E6%AC%80%E6/?%AD%81%E6%AB=fiat`吗？

不。做。那。曾经。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T10:35:41.790

根据域重写 URL 怎么样？这样，Zend 框架将只获取英文名称，而 URL 可以使用本地化名称。

# c++ - C++ 迭代器被认为是有害的？

> ID：838721
> 
> 赞同：50
> 
> 时间：2009-05-08T08:05:32.320
> 
> 标签：c++, iterator, language-design

在今天的 Boost 库会议上， 《现代 C++ 设计和 Loki C++ 库》一书的作者[Andrei Alexandrescu](http://en.wikipedia.org/wiki/Andrei_Alexandrescu)发表了题为“Iterators Must Go”（[视频](https://archive.org/details/AndreiAlexandrescuKeynoteBoostcon2009)、[幻灯片](http://accu.org/content/conf2009/AndreiAlexandrescu_iterators-must-go.pdf)）的演讲，讲述了为什么迭代器不好，他有一个更好的解决方案。

我试图阅读演示幻灯片，但我无法从中得到太多。

1.  迭代器不好吗？
2.  他的替补真的更好吗？
3.  C++ 实现者会接受他的想法吗？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-08T09:24:05.097

首先，回答您的问题：

1.  不。事实上，我[在其他地方](https://stackoverflow.com/questions/296/should-i-learn-c/22362#22362)争论过迭代器是计算机科学中最重要/最基础的概念。我（不像安德烈）也认为迭代器是*直观*的。
2.  是的，当然，但这不应该让人感到意外。
3.  唔。看看[Boost.Range](http://www.boost.org/doc/libs/1_38_0/libs/range/index.html)和 C++0x ——他们还没有吗？

Andrei 在这里的重大贡献只是说：完全放弃迭代器的概念，将范围不仅视为一种方便的包装器，而且是一种核心构造。其他语言已经做到了这一点（Andrei 的大部分概念只是呼应 .NET 的 LINQ 或 Python 的迭代器），但它们都只提供*输出范围*。Andrei 主张不同类型的范围，就像传统的迭代器类别一样。

从这个角度来看，他开始嘲笑这些迭代器类别的任意性是很奇怪的。

我也认为他的例子已经过时了，尤其是他的文件复制：是的，迭代器变体是对 1975 年代码的**巨大**改进。它将具有复杂中断条件的循环减少为*一条*语句。他在这里真正遇到的问题只是语法。好吧，对不起：我们在这里谈论的是 C++——*当然*语法很丑。是的，在这里使用范围*是*一种改进——但只是在语法上。

我也认为 Andrei 的`find`实施已经结束。他真正定义的是`DropUntil`来自 LINQ 的操作（命名很难！）。该`find`操作实际上应该返回一个或零个元素（或迭代器！）。在我看来，在这里避开迭代器没有帮助，因为我们可能想直接修改值而不是复制它。在这里返回一个元素范围只会增加开销而没有好处。这样做安德烈的方式是不好的，因为方法的名称是错误的和误导性的。

也就是说，我几乎在所有方面都同意安德烈。迭代器虽然是我在计算机科学中的宠物概念，但肯定是一个很大的语法负担，许多范围（尤其是无限生成器）可以（并且应该）在没有它们的情况下方便地实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T08:21:49.317

我同意他的观点，迭代器大多不如范围，我不知道“更好的东西”是否会被采纳。

“好是最好的敌人”在这里非常重要，就像往常一样。迭代器很有用而且根深蒂固，所以很难知道像范围这样更好的东西是否可以在合理的时间内取代它们。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T09:49:37.157

1.  我们大多数人在众所周知的习语中简单地使用它们，例如在 for 循环中迭代 std::vector。开发人员阅读它并知道发生了什么。在我们日常的编码生活中，迭代器没有好坏之分，它们只是“完成工作的东西”。
2.  可能是。
3.  我不这么认为。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-08T10:44:25.963

安德烈有时会有点挑衅。迭代器是一个合理的概念，并且在位的意义上是非常基础的。但是就像 C++ 中的大多数位不是布尔值，而是较大类型的一部分，大多数迭代器应该在高级别的地方处理。Andrei 是正确的，这样做的适当级别是范围对象。但并非所有范围都正确公开为迭代器范围，如 istream_iterator 哨兵所示。这只是创建人工结束迭代器的技巧。不过，我认为他的想法不会被实现所采纳。C++1x 将与 C99 一样重要。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-08T09:31:56.903

C++0x 已经迈出了第一步：

*   右值引用解决了将容器视为范围的一些问题
*   范围已添加到核心库中，包括范围概念

在不丢失任何迭代器功能的情况下过渡到范围（想想迭代器类别、常量和右值的所有组合）是很困难的，尤其是当您尝试考虑无限和可变范围时。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-01-25T23:59:05.397

1.  不，它们还不错，实际上它们是非常聪明的主意。但是，它们并不理想，迭代器的概念还有改进的空间。

2.  它用迭代器解决了许多现实生活中的问题。例如，在许多情况下，从单个容器中查询两个单独的对象（迭代器）然后将它们作为两个单独的对象传递给算法是很乏味的（也容易出错）。为什么不传递单个对象？甚至`std::pair<iterator, iterator>`会产生一个更容易操作的粗略范围——一个对象，而不是两个。另外，考虑一下也是个好主意`a range is an iterator`。这实际上是安德烈所建议的。[顺便说一句， Boost.Range](http://www.boost.org/doc/libs/release/libs/range/index.html)已经解决了其中一些问题。

3.  我希望它会发生，但这不会是一场革命，而是进化。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-08T09:27:47.460

我认为我们应该在迭代器旁边使用范围，即我们应该选择进化方式，而不是革命方式。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-12T06:53:35.487

Andrei 不是在尝试为 D 语言做一些隐藏的营销（目前他正在使用它）......？

Andrei 说容器没问题，但迭代器丑陋、不直观、容易出错且危险，难以实现（最后一个似乎相当真实......）我们在 C++ 中有什么......指针? 它们不丑/.../危险吗？但我们很高兴地拥抱了他们并和他们一起生活。

哪一个写起来更直观：

```
for(auto i=foo.begin();i!=foo.end();++i)
    bar(*i); 
```

或者

```
for (auto r=foo.all(); !foo.empty(); foo.popFront())
        bar(r.front()); 
```

迭代器的概念可以用范围和其他想法来补充，但我认为它们有自己的位置，不会被取代。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-08T08:37:56.907

1.  有时
2.  大概
3.  不太可能，至少在很多年内都不会

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-08T13:21:10.557

像任何 API 或函数一样，如果滥用会产生许多难以识别的问题。迭代器已在许多项目中使用，但始终根据其特性保持必要的注意。在使用它之前应该充分了解它们的局限性。如果用户正确，迭代器会非常有用。
这个问题是相关的：
[有没有办法检查迭代器是否有效？](https://stackoverflow.com/questions/436013/is-there-any-way-to-check-if-an-iterator-is-valid)
[我应该更喜欢迭代器而不是 const_iterators 吗？](https://stackoverflow.com/questions/765257/should-i-prefer-iterators-over-constiterators)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-08T18:49:26.897

我不同意安德烈和康拉德以及我自己:-)

最基本的概念是接口而不是迭代器，这在今天任何人所做的任何工作中都很明显（这都是关于跨库、跨语言、跨编译器、跨操作系统、跨平台，你可以跨名字它 ：-）

迭代器或范围（除了源代码级别的使用）都提供了一个干净简单、非侵入性或侵入性、非共享或共享、非唯一或唯一的：指针！指向类型数据的干净指针简单地说是通用的，您可以使数据可变或不可变以及许多其他事情。所有接口只是对它的另一个间接级别，同时仍然对各种机器和编译器友好，而且更安全，将迭代器和范围使用归为实现细节。

在那个程度上 IEnumerable 和 IQueryable 做了一半“正确的事情” TM，但它们的迭代概念显然不如你可以用 STL 做的事情，保留控制等等（但是，他们有更好的元数据因此是一个更好、更清洁的模型）。有了接口，您可以构建您想要并满足的任何抽象，很可能是相反的，但本质上是不费吹灰之力的：最佳的、运行时或编译时中性的数据表示和代码（对于算法、编译器和虚拟机来说是必不可少的） .

甚至可以针对“动态”/组件系统将其优化到“运行时”内联（screw HotSpot VM:-).. 在这个程度上，到 1975 年的进展是微乎其微的，因为巨大的互操作行业工作量很明显（它无处不在你看，包括这个网站，它对专有和开放技术的使用等；在计算机科学理想主义中，如果它不应该存在这种类型的接口“工作”）..

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-08T08:29:37.380

我认为 C++ 实现者将全力以赴为 C++0x 提供完整的工作支持，而无需实现新的非标准范式。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-08T10:54:53.070

我可以从该演示文稿中看到的唯一论点是无法定义范围，而 c++0x“声明范围”提案似乎在某种程度上消除了这个问题。也许它不应该是关于是否应该/不应该使用迭代器的争论，但更多的是应该/不应该在什么情况下使用它们？

# php - 处理不存在的操作？

> ID：838723
> 
> 赞同：0
> 
> 时间：2009-05-08T08:05:42.600
> 
> 标签：php, zend-framework

在 Zend 框架中处理不存在的动作的最佳方法是什么？

根据控制器，我希望能够以不同的方式处理请求。

BR尼克拉斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T12:38:57.193

将此功能添加到您的控制器类

```
public function __call($method, $args){

    if ('Action' == substr($method, -6) && $method != 'indexAction') {
        // If the action method was not found, forward to the index action
        return $this->_forward('index');
    }

    // all other methods throw an exception
    throw new Exception('Invalid method "' . $method . '" called', 500);
} 
```

在这种情况下，缺少的操作将被转发到索引操作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-09T00:22:44.383

这在[http://framework.zend.com/manual/en/zend.controller.action.html#zend.controller.action.subclassing.example-call中有解释](http://framework.zend.com/manual/en/zend.controller.action.html#zend.controller.action.subclassing.example-call)

# ios - 如何在 iOS 上扫描条形码？

> ID：838724
> 
> 赞同：190
> 
> 时间：2009-05-08T08:05:48.263
> 
> 标签：ios, swift, iphone, cocoa-touch, barcode

如何在 iPhone 和/或 iPad 上简单地扫描条形码？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-05-14T10:43:32.893

我们为 iPhone 制作了“条形码”应用程序。它可以解码二维码。源代码可从[zxing 项目](http://code.google.com/p/zxing)获得；具体来说，你想看看[iPhone 客户端](http://code.google.com/p/zxing/source/browse/#svn/trunk/iphone)和[核心库的部分 C++ 端口](http://code.google.com/p/zxing/source/browse/#svn/trunk/cpp)。该端口有点旧，大约从 Java 代码的 0.9 版本开始，但应该仍然可以正常工作。

如果您需要扫描其他格式，例如 1D 格式，您可以继续将此项目中的 Java 代码移植到 C++。

编辑：`iphone`项目中的条码和代码在 2014 年初左右停用。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2013-10-14T08:32:18.323

随着发布`iOS7`您不再需要使用外部框架或库。**带有 AVFoundation 的 iOS 生态系统现在完全支持扫描**几乎所有代码，从 QR over EAN 到 UPC。

只需查看[技术说明](https://developer.apple.com/library/ios/technotes/tn2325/_index.html)和 AVFoundation 编程指南。`AVMetadataObjectTypeQRCode`是你的朋友。

这是一个很好的**教程**，一步一步地展示它： [iPhone QR码扫描库iOS7](http://www.ama-dev.com/iphone-qr-code-library-ios-7/)

只是一个关于如何设置它的小例子：

```
#pragma mark -
#pragma mark AVFoundationScanSetup

- (void) setupScanner;
{
    self.device = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];

    self.input = [AVCaptureDeviceInput deviceInputWithDevice:self.device error:nil];

    self.session = [[AVCaptureSession alloc] init];

    self.output = [[AVCaptureMetadataOutput alloc] init];
    [self.session addOutput:self.output];
    [self.session addInput:self.input];

    [self.output setMetadataObjectsDelegate:self queue:dispatch_get_main_queue()];
    self.output.metadataObjectTypes = @[AVMetadataObjectTypeQRCode];

    self.preview = [AVCaptureVideoPreviewLayer layerWithSession:self.session];
    self.preview.videoGravity = AVLayerVideoGravityResizeAspectFill;
    self.preview.frame = CGRectMake(0, 0, self.view.frame.size.width, self.view.frame.size.height);

    AVCaptureConnection *con = self.preview.connection;

    con.videoOrientation = AVCaptureVideoOrientationLandscapeLeft;

    [self.view.layer insertSublayer:self.preview atIndex:0];
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-11-19T09:11:24.327

有两个主要的库：

*   [ZXing](http://code.google.com/p/zxing/)一个用 Java 编写的库，然后移植到 Objective C / C++（仅限二维码）。TheLevelUp 已经完成了另一个到 ObjC 的移植：[ZXingObjC](https://github.com/TheLevelUp/ZXingObjC)

*   [ZBar](http://zbar.sourceforge.net)一个用于读取条形码的开源软件，基于 C。

根据我的实验，**ZBar 比 ZXing 准确和快速**得多，至少在 iPhone 上是这样。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-05-14T12:23:51.493

**您可以在下面找到另一个使用Swift 4**和**Xcode 9**的原生 iOS 解决方案。`AVFoundation`此解决方案中使用的本机框架。

第一部分是一个子类，`UIViewController`它具有相关的设置和处理函数`AVCaptureSession`。

```
import UIKit
import AVFoundation

class BarCodeScannerViewController: UIViewController {

    let captureSession = AVCaptureSession()
    var videoPreviewLayer: AVCaptureVideoPreviewLayer!
    var initialized = false

    let barCodeTypes = [AVMetadataObject.ObjectType.upce,
                        AVMetadataObject.ObjectType.code39,
                        AVMetadataObject.ObjectType.code39Mod43,
                        AVMetadataObject.ObjectType.code93,
                        AVMetadataObject.ObjectType.code128,
                        AVMetadataObject.ObjectType.ean8,
                        AVMetadataObject.ObjectType.ean13,
                        AVMetadataObject.ObjectType.aztec,
                        AVMetadataObject.ObjectType.pdf417,
                        AVMetadataObject.ObjectType.itf14,
                        AVMetadataObject.ObjectType.dataMatrix,
                        AVMetadataObject.ObjectType.interleaved2of5,
                        AVMetadataObject.ObjectType.qr]

    override func viewDidAppear(_ animated: Bool) {
        super.viewDidAppear(animated)
        setupCapture()
        // set observer for UIApplicationWillEnterForeground, so we know when to start the capture session again
        NotificationCenter.default.addObserver(self,
                                           selector: #selector(willEnterForeground),
                                           name: .UIApplicationWillEnterForeground,
                                           object: nil)
    }

    override func viewWillDisappear(_ animated: Bool) {
        super.viewWillDisappear(animated)
        // this view is no longer topmost in the app, so we don't need a callback if we return to the app.
        NotificationCenter.default.removeObserver(self,
                                              name: .UIApplicationWillEnterForeground,
                                              object: nil)
    }

    // This is called when we return from another app to the scanner view
    @objc func willEnterForeground() {
        setupCapture()
    }

    func setupCapture() {
        var success = false
        var accessDenied = false
        var accessRequested = false

        let authorizationStatus = AVCaptureDevice.authorizationStatus(for: .video)
        if authorizationStatus == .notDetermined {
            // permission dialog not yet presented, request authorization
            accessRequested = true
            AVCaptureDevice.requestAccess(for: .video,
                                      completionHandler: { (granted:Bool) -> Void in
                                          self.setupCapture();
            })
            return
        }
        if authorizationStatus == .restricted || authorizationStatus == .denied {
            accessDenied = true
        }
        if initialized {
            success = true
        } else {
            let deviceDiscoverySession = AVCaptureDevice.DiscoverySession(deviceTypes: [.builtInWideAngleCamera,
                                                                                        .builtInTelephotoCamera,
                                                                                        .builtInDualCamera],
                                                                          mediaType: .video,
                                                                          position: .unspecified)

            if let captureDevice = deviceDiscoverySession.devices.first {
                do {
                    let videoInput = try AVCaptureDeviceInput(device: captureDevice)
                    captureSession.addInput(videoInput)
                    success = true
                } catch {
                    NSLog("Cannot construct capture device input")
                }
            } else {
                NSLog("Cannot get capture device")
            }
        }
        if success {
            DispatchQueue.global().async {
                self.captureSession.startRunning()
                DispatchQueue.main.async {
                    let captureMetadataOutput = AVCaptureMetadataOutput()
                    self.captureSession.addOutput(captureMetadataOutput)
                    let newSerialQueue = DispatchQueue(label: "barCodeScannerQueue") // in iOS 11 you can use main queue
                    captureMetadataOutput.setMetadataObjectsDelegate(self, queue: newSerialQueue)
                    captureMetadataOutput.metadataObjectTypes = self.barCodeTypes
                    self.videoPreviewLayer = AVCaptureVideoPreviewLayer(session: self.captureSession)
                    self.videoPreviewLayer.videoGravity = .resizeAspectFill
                    self.videoPreviewLayer.frame = self.view.layer.bounds
                    self.view.layer.addSublayer(self.videoPreviewLayer)
                } 
            }
            initialized = true
        } else {
            // Only show a dialog if we have not just asked the user for permission to use the camera.  Asking permission
            // sends its own dialog to th user
            if !accessRequested {
                // Generic message if we cannot figure out why we cannot establish a camera session
                var message = "Cannot access camera to scan bar codes"
                #if (arch(i386) || arch(x86_64)) && (!os(macOS))
                    message = "You are running on the simulator, which does not hae a camera device.  Try this on a real iOS device."
                #endif
                if accessDenied {
                    message = "You have denied this app permission to access to the camera.  Please go to settings and enable camera access permission to be able to scan bar codes"
                }
                let alertPrompt = UIAlertController(title: "Cannot access camera", message: message, preferredStyle: .alert)
                let confirmAction = UIAlertAction(title: "OK", style: .default, handler: { (action) -> Void in
                    self.navigationController?.popViewController(animated: true)
                })
                alertPrompt.addAction(confirmAction)
                self.present(alertPrompt, animated: true, completion: nil)
            }
        }
    }

    func handleCapturedOutput(metadataObjects: [AVMetadataObject]) {
        if metadataObjects.count == 0 {
            return
        }

        guard let metadataObject = metadataObjects.first as? AVMetadataMachineReadableCodeObject else {
            return
        }

        if barCodeTypes.contains(metadataObject.type) {
            if let metaDataString = metadataObject.stringValue {
                captureSession.stopRunning()
                displayResult(code: metaDataString)
                return
            }
        }
    }

    func displayResult(code: String) {
        let alertPrompt = UIAlertController(title: "Bar code detected", message: code, preferredStyle: .alert)
        if let url = URL(string: code) {
            let confirmAction = UIAlertAction(title: "Launch URL", style: .default, handler: { (action) -> Void in
                UIApplication.shared.open(url, options: [:], completionHandler: { (result) in
                    if result {
                        NSLog("opened url")
                    } else {
                        let alertPrompt = UIAlertController(title: "Cannot open url", message: nil, preferredStyle: .alert)
                        let confirmAction = UIAlertAction(title: "OK", style: .default, handler: { (action) -> Void in
                        })
                        alertPrompt.addAction(confirmAction)
                        self.present(alertPrompt, animated: true, completion: {
                            self.setupCapture()
                        })
                    }
                })        
            })
            alertPrompt.addAction(confirmAction)
        }
        let cancelAction = UIAlertAction(title: "Cancel", style: .cancel, handler: { (action) -> Void in
            self.setupCapture()
        })
        alertPrompt.addAction(cancelAction)
        present(alertPrompt, animated: true, completion: nil)
    }

} 
```

第二部分是我们捕获捕获输出的`UIViewController`子类的扩展。`AVCaptureMetadataOutputObjectsDelegate`

```
extension BarCodeScannerViewController: AVCaptureMetadataOutputObjectsDelegate {

    func metadataOutput(_ output: AVCaptureMetadataOutput, didOutput metadataObjects: [AVMetadataObject], from connection: AVCaptureConnection) {
        handleCapturedOutput(metadataObjects: metadataObjects)
    }

} 
```

**Swift 4.2 更新**

`.UIApplicationWillEnterForeground`变化为`UIApplication.willEnterForegroundNotification`.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-09-25T11:49:36.737

如果对 iPad 2 或 iPod Touch 的支持对您的应用程序很重要，我会选择可以解码模糊图像中的条码的条码扫描器 SDK，例如我们的适用于 iOS 和 Android 的[Scandit 条码扫描器 SDK](http://www.scandit.com)。解码模糊的条形码图像在配备自动对焦摄像头的手机上也很有帮助，因为用户不必等待自动对焦启动。

Scandit 提供免费的社区价格计划，还有一个产品 API，可以轻松将条形码编号转换为产品名称。

（免责声明：我是 Scandit 的联合创始人）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-12-07T04:12:01.600

iPhone 相机的问题在于，第一批型号（其中有大量使用中）有一个定焦相机，无法在 2 英尺以下的距离内对焦。图像模糊且失真，如果从更远的距离拍摄，则条形码中的细节/信息不足。

一些公司开发了 iPhone 应用程序，可以通过使用先进的去模糊技术来适应这种情况。您可以在 Apple 应用商店中找到这些应用程序：pic2shop、RedLaser 和 ShopSavvy。所有的公司都宣布他们也有 SDK 可用——一些是免费的或非常优惠的条款，请查看那个。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-06-06T10:21:20.290

使用**Swift 5**，它既简单又超级快！！

你只需要添加可可豆荚“BarcodeScanner”这里是完整的代码

```
source 'https://github.com/CocoaPods/Specs.git' 
platform :ios, '12.0' 
target 'Simple BarcodeScanner' 
do   
pod 'BarcodeScanner' 
end 
```

确保在您的 .plist 文件中添加相机权限

```
<key>NSCameraUsageDescription</key>
<string>Camera usage description</string> 
```

并以这种方式在您的 ViewController 中添加 Scanner 和处理结果

```
import UIKit
import BarcodeScanner

class ViewController: UIViewController, BarcodeScannerCodeDelegate, BarcodeScannerErrorDelegate, BarcodeScannerDismissalDelegate {

    override func viewDidLoad() {
        super.viewDidLoad()

        let viewController = BarcodeScannerViewController()
        viewController.codeDelegate = self
        viewController.errorDelegate = self
        viewController.dismissalDelegate = self

        present(viewController, animated: true, completion: nil)
    }

    func scanner(_ controller: BarcodeScannerViewController, didCaptureCode code: String, type: String) {
        print("Product's Bar code is :", code)
        controller.dismiss(animated: true, completion: nil)
    }

    func scanner(_ controller: BarcodeScannerViewController, didReceiveError error: Error) {
        print(error)
    }

    func scannerDidDismiss(_ controller: BarcodeScannerViewController) {
        controller.dismiss(animated: true, completion: nil)
    }
} 
```

仍然有任何问题或挑战，[请在此处查看示例应用程序以及完整的源代码](https://github.com/RamdhanChoudhary/A-Simple-iOS-App-for-Barcode-Reader-in-Swift)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-05-02T08:42:57.377

这是简单的代码：

```
func scanbarcode()
{
    view.backgroundColor = UIColor.blackColor()
    captureSession = AVCaptureSession()

    let videoCaptureDevice = AVCaptureDevice.defaultDeviceWithMediaType(AVMediaTypeVideo)
    let videoInput: AVCaptureDeviceInput

    do {
        videoInput = try AVCaptureDeviceInput(device: videoCaptureDevice)
    } catch {
        return
    }

    if (captureSession.canAddInput(videoInput)) {
        captureSession.addInput(videoInput)
    } else {
        failed();
        return;
    }

    let metadataOutput = AVCaptureMetadataOutput()

    if (captureSession.canAddOutput(metadataOutput)) {
        captureSession.addOutput(metadataOutput)

        metadataOutput.setMetadataObjectsDelegate(self, queue: dispatch_get_main_queue())
        metadataOutput.metadataObjectTypes = [AVMetadataObjectTypeEAN8Code, AVMetadataObjectTypeEAN13Code, AVMetadataObjectTypePDF417Code]
    } else {
        failed()
        return
    }

    previewLayer = AVCaptureVideoPreviewLayer(session: captureSession);
    previewLayer.frame = view.layer.bounds;
    previewLayer.videoGravity = AVLayerVideoGravityResizeAspectFill;
    view.layer.addSublayer(previewLayer);
    view.addSubview(closeBtn)
    view.addSubview(backimg)

    captureSession.startRunning();

}
override func didReceiveMemoryWarning() {
    super.didReceiveMemoryWarning()
    // Dispose of any resources that can be recreated.
}

func failed() {
    let ac = UIAlertController(title: "Scanning not supported", message: "Your device does not support scanning a code from an item. Please use a device with a camera.", preferredStyle: .Alert)
    ac.addAction(UIAlertAction(title: "OK", style: .Default, handler: nil))
    presentViewController(ac, animated: true, completion: nil)
    captureSession = nil
}

override func viewWillAppear(animated: Bool) {
    super.viewWillAppear(animated)

    if (captureSession?.running == false) {
        captureSession.startRunning();
    }
}

override func viewWillDisappear(animated: Bool) {
    super.viewWillDisappear(animated)

    if (captureSession?.running == true) {
        captureSession.stopRunning();
    }
}

func captureOutput(captureOutput: AVCaptureOutput!, didOutputMetadataObjects metadataObjects: [AnyObject]!, fromConnection connection: AVCaptureConnection!) {
    captureSession.stopRunning()

    if let metadataObject = metadataObjects.first {
        let readableObject = metadataObject as! AVMetadataMachineReadableCodeObject;

        AudioServicesPlaySystemSound(SystemSoundID(kSystemSoundID_Vibrate))
        foundCode(readableObject.stringValue);
    }

   // dismissViewControllerAnimated(true, completion: nil)
}

func foundCode(code: String) {
    var createAccountErrorAlert: UIAlertView = UIAlertView()
    createAccountErrorAlert.delegate = self
    createAccountErrorAlert.title = "Alert"
    createAccountErrorAlert.message = code
    createAccountErrorAlert.addButtonWithTitle("ok")
    createAccountErrorAlert.addButtonWithTitle("Retry")
    createAccountErrorAlert.show()
    NSUserDefaults.standardUserDefaults().setObject(code, forKey: "barcode")
    NSUserDefaults.standardUserDefaults().synchronize()
    ItemBarcode = code
    print(code)
}

override func prefersStatusBarHidden() -> Bool {
    return true
}

override func supportedInterfaceOrientations() -> UIInterfaceOrientationMask {
    return .Portrait
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-10-17T01:48:24.657

我相信这可以使用 AVFramework 来完成，这是执行此操作的示例代码

```
import UIKit
import AVFoundation

class ViewController: UIViewController, AVCaptureMetadataOutputObjectsDelegate
{

    @IBOutlet weak var lblQRCodeResult: UILabel!
    @IBOutlet weak var lblQRCodeLabel: UILabel!

    var objCaptureSession:AVCaptureSession?
    var objCaptureVideoPreviewLayer:AVCaptureVideoPreviewLayer?
    var vwQRCode:UIView?

    override func viewDidLoad() {
        super.viewDidLoad()
        self.configureVideoCapture()
        self.addVideoPreviewLayer()
        self.initializeQRView()
    }

    func configureVideoCapture() {
        let objCaptureDevice = AVCaptureDevice.defaultDeviceWithMediaType(AVMediaTypeVideo)
        var error:NSError?
        let objCaptureDeviceInput: AnyObject!
        do {
            objCaptureDeviceInput = try AVCaptureDeviceInput(device: objCaptureDevice) as AVCaptureDeviceInput

        } catch let error1 as NSError {
            error = error1
            objCaptureDeviceInput = nil
        }
        objCaptureSession = AVCaptureSession()
        objCaptureSession?.addInput(objCaptureDeviceInput as! AVCaptureInput)
        let objCaptureMetadataOutput = AVCaptureMetadataOutput()
        objCaptureSession?.addOutput(objCaptureMetadataOutput)
        objCaptureMetadataOutput.setMetadataObjectsDelegate(self, queue: dispatch_get_main_queue())
        objCaptureMetadataOutput.metadataObjectTypes = [AVMetadataObjectTypeQRCode]
    }

    func addVideoPreviewLayer() {
        objCaptureVideoPreviewLayer = AVCaptureVideoPreviewLayer(session: objCaptureSession)
        objCaptureVideoPreviewLayer?.videoGravity = AVLayerVideoGravityResizeAspectFill
        objCaptureVideoPreviewLayer?.frame = view.layer.bounds
        self.view.layer.addSublayer(objCaptureVideoPreviewLayer!)
        objCaptureSession?.startRunning()
        self.view.bringSubviewToFront(lblQRCodeResult)
        self.view.bringSubviewToFront(lblQRCodeLabel)
    }

    func initializeQRView() {
        vwQRCode = UIView()
        vwQRCode?.layer.borderColor = UIColor.redColor().CGColor
        vwQRCode?.layer.borderWidth = 5
        self.view.addSubview(vwQRCode!)
        self.view.bringSubviewToFront(vwQRCode!)
    }

    func captureOutput(captureOutput: AVCaptureOutput!, didOutputMetadataObjects metadataObjects: [AnyObject]!, fromConnection connection: AVCaptureConnection!) {
        if metadataObjects == nil || metadataObjects.count == 0 {
            vwQRCode?.frame = CGRectZero
            lblQRCodeResult.text = "QR Code wans't found"
            return
        }
        let objMetadataMachineReadableCodeObject = metadataObjects[0] as! AVMetadataMachineReadableCodeObject
        if objMetadataMachineReadableCodeObject.type == AVMetadataObjectTypeQRCode {
            let objBarCode = objCaptureVideoPreviewLayer?.transformedMetadataObjectForMetadataObject(objMetadataMachineReadableCodeObject as AVMetadataMachineReadableCodeObject) as! AVMetadataMachineReadableCodeObject
            vwQRCode?.frame = objBarCode.bounds;
            if objMetadataMachineReadableCodeObject.stringValue != nil {
                lblQRCodeResult.text = objMetadataMachineReadableCodeObject.stringValue
            }
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-05-17T16:25:36.310

如果您正在使用 Swift 4 为 iOS >10.2 进行开发，那么您可以尝试我的解决方案。我把[这个](https://www.appcoda.com/qr-code-reader-swift/)和[这个](https://www.appcoda.com/barcode-reader-swift/)教程混在一起，想出了一个 ViewController，它可以扫描二维码并将`print()`其输出。我的 UI 中还有一个开关来切换相机灯，这也可能会有所帮助。目前我只在 iPhone SE 上进行了测试，如果它不适用于较新的 iPhone，请告诉我。

干得好：

```
import UIKit
import AVFoundation

class QRCodeScanner: UIViewController, AVCaptureMetadataOutputObjectsDelegate {

    let captureSession: AVCaptureSession = AVCaptureSession()
    var videoPreviewLayer: AVCaptureVideoPreviewLayer?
    let qrCodeFrameView: UIView = UIView()
    var captureDevice: AVCaptureDevice?

    override func viewDidLoad() {
        // Get the back-facing camera for capturing videos
        let deviceDiscoverySession = AVCaptureDevice.DiscoverySession(deviceTypes: [.builtInWideAngleCamera, .builtInDualCamera], mediaType: AVMediaType.video, position: .back)

        captureDevice = deviceDiscoverySession.devices.first
        if captureDevice == nil {
            print("Failed to get the camera device")
            return
        }

        do {
            // Get an instance of the AVCaptureDeviceInput class using the previous device object.
            let input = try AVCaptureDeviceInput(device: captureDevice!)

            // Set the input device on the capture session.
            captureSession.addInput(input)

            // Initialize a AVCaptureMetadataOutput object and set it as the output device to the capture session.
            let captureMetadataOutput = AVCaptureMetadataOutput()
            captureSession.addOutput(captureMetadataOutput)

            // Set delegate and use the default dispatch queue to execute the call back
            captureMetadataOutput.setMetadataObjectsDelegate(self, queue: DispatchQueue.main)
            captureMetadataOutput.metadataObjectTypes = [AVMetadataObject.ObjectType.qr]

            // Initialize the video preview layer and add it as a sublayer to the viewPreview view's layer.

            videoPreviewLayer = AVCaptureVideoPreviewLayer(session: captureSession)

            if let videoPreviewLayer = videoPreviewLayer {
                videoPreviewLayer.videoGravity = AVLayerVideoGravity.resizeAspectFill
                videoPreviewLayer.frame = view.layer.bounds
                view.layer.addSublayer(videoPreviewLayer)

                // Start video capture.
                captureSession.startRunning()

                if let hasFlash = captureDevice?.hasFlash, let hasTorch = captureDevice?.hasTorch {
                    if hasFlash && hasTorch {
                        view.bringSubview(toFront: bottomBar)
                        try captureDevice?.lockForConfiguration()
                    }
                }
            }

            // QR Code Overlay
            qrCodeFrameView.layer.borderColor = UIColor.green.cgColor
            qrCodeFrameView.layer.borderWidth = 2
            view.addSubview(qrCodeFrameView)
            view.bringSubview(toFront: qrCodeFrameView)

        } catch {
            // If any error occurs, simply print it out and don't continue any more.
            print("Error: \(error)")
            return
        }
    }

    // MARK: Buttons and Switch

    @IBAction func switchFlashChanged(_ sender: UISwitch) {
        do {
            if sender.isOn {
                captureDevice?.torchMode = .on
            } else {
                captureDevice?.torchMode = .off
            }
        }
    }

    // MARK: AVCaptureMetadataOutputObjectsDelegate

    func metadataOutput(_ output: AVCaptureMetadataOutput, didOutput metadataObjects: [AVMetadataObject], from connection: AVCaptureConnection) {

        // Check if the metadataObjects array is not nil and it contains at least one object.
        if metadataObjects.count == 0 {
            qrCodeFrameView.frame = CGRect.zero
            return
        }

        // Get the metadata object.
        let metadataObj = metadataObjects[0] as! AVMetadataMachineReadableCodeObject

        if metadataObj.type == AVMetadataObject.ObjectType.qr {
            // If the found metadata is equal to the QR code metadata then update the status label's text and set the bounds
            let barCodeObject = videoPreviewLayer?.transformedMetadataObject(for: metadataObj)
            qrCodeFrameView.frame = barCodeObject!.bounds

            print("QR Code: \(metadataObj.stringValue)")
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-06-22T12:16:31.793

您可以检查 ZBarSDK 以读取 QR 码和 ECN/ISBN 码，它很容易集成尝试以下代码。

```
- (void)scanBarcodeWithZBarScanner
  {
// ADD: present a barcode reader that scans from the camera feed
ZBarReaderViewController *reader = [ZBarReaderViewController new];
reader.readerDelegate = self;
reader.supportedOrientationsMask = ZBarOrientationMaskAll;

ZBarImageScanner *scanner = reader.scanner;
// TODO: (optional) additional reader configuration here

// EXAMPLE: disable rarely used I2/5 to improve performance
 [scanner setSymbology: ZBAR_I25
               config: ZBAR_CFG_ENABLE
                   to: 0];

//Get the return value from controller
[reader setReturnBlock:^(BOOL value) {

} 
```

在 didFinishPickingMediaWithInfo 我们得到条形码值。

```
 - (void) imagePickerController: (UIImagePickerController*) reader
   didFinishPickingMediaWithInfo: (NSDictionary*) info
   {
    // ADD: get the decode results
    id<NSFastEnumeration> results =
    [info objectForKey: ZBarReaderControllerResults];
    ZBarSymbol *symbol = nil;
    for(symbol in results)
    // EXAMPLE: just grab the first barcode
    break;

    // EXAMPLE: do something useful with the barcode data
    barcodeValue = symbol.data;

    // EXAMPLE: do something useful with the barcode image
    barcodeImage =   [info objectForKey:UIImagePickerControllerOriginalImage];
    [_barcodeIV setImage:barcodeImage];

    //set the values for to TextFields
    [self setBarcodeValue:YES];

    // ADD: dismiss the controller (NB dismiss from the *reader*!)
    [reader dismissViewControllerAnimated:YES completion:nil];
   } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-12-03T14:02:09.927

最简单的方法是使用可以改进的最小 UI 的 3rd 方框架。检查[QRCodeScanner83](https://github.com/seriyvolk83/QRCodeScanner)

您可以简单地使用以下代码（查看有关如何在情节提要中创建视图控制器的文档）：

```
import QRCodeScanner83

guard let vc = UIStoryboard(name: "Main", bundle: nil).instantiateViewController(identifier: "CodeScannerViewController") as? CodeScannerViewController else {
    return
}
vc.callbackCodeScanned = { code in
    print("SCANNED CODE: \(code)")
    vc.dismiss(animated: true, completion: nil)
}
self.present(vc, animated: true, completion: nil) 
```

# java - 简单但反复出现的命名问题

> ID：838735
> 
> 赞同：1
> 
> 时间：2009-05-08T08:09:03.357
> 
> 标签：java, naming-conventions, readability

假设我们有一个方法：

```
 public String wishes(Date birthday) { 
          String birthayDateString = convertToString(birthay);

  ...

  } 
```

我想知道现在称为“birthayDateString”的字符串的最佳名称是什么。此字符串表示转换为文本的日期。我不能把它命名为“生日”，因为这个名字已经被使用了。将其命名为“birthdayString”或“birthdayDateString”是否违反了一些命名约定的良好实践规则？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T08:11:44.630

这实际上看起来不错。

我个人更喜欢`birthdayStr`- 简短而中肯 - 使其既有意义又简洁。

产量：

```
 public String wishes(Date birthday) { 
      String birthdayStr = convertToString(birthday);
      // whatever
  } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T08:13:24.767

不，我认为您没有违反任何“最佳实践”标准。在这种情况下，我经常使用变量名，例如`birthdayText`or `birthdayStr`。

不过，总的来说，我尽量使变量名有意义——如果有命名冲突，我不会自动添加“Str”或“Text”。但在这种情况下，它只是日期的字符串表示，所以我会说它足够有意义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T08:13:29.260

随心所欲地称呼它。

变量名称仅在当前方法块的范围内（如果您的代码正确分解/封装，它应该相当小）。

就我个人而言，`birthdayStr`为了清楚起见，我会选择这种特定的方法。]

我还将那些 MethodNames 大写为`Wishes`和`ConvertToString`

# startup - 无法在 Zsh 中禁用启动消息

> ID：838737
> 
> 赞同：0
> 
> 时间：2009-05-08T08:10:27.363
> 
> 标签：startup, zsh

当我启动我的 Zsh 时，我得到以下信息。

```
Usage: prompt <options>
Options:
    -c              Show currently selected theme and parameters
    -l              List currently available prompt themes
    -p [<themes>]   Preview given themes (defaults to all)
    -h [<theme>]    Display help (for given theme)
    -s <theme>      Set and save theme
    <theme>         Switch to new theme immediately (changes not saved) 
```

它似乎是由某个主题文件设置的，因为[这里](http://www.opensource.apple.com/source/zsh/zsh-48/zsh/Functions/Prompts/promptinit)有相同的文本。

**如何在 Zsh 中禁用通知？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T08:14:35.310

这不是启动消息。`prompt`这是在不带参数或错误参数的情况下使用命令时显示的错误/默认帮助消息。找出你在哪里使用它，然后修复/删除它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T08:43:50.153

您需要搜索 zsh 在启动时加载的文件，这是[他们文档中的列表](http://zsh.dotsrc.org/Guide/zshguide02.html#l9)

查找配置错误的提示命令行并尝试将其注释掉或更好地修复它。

# flash - 检测 Flash 何时加载远程项目

> ID：838759
> 
> 赞同：0
> 
> 时间：2009-05-08T08:16:38.660
> 
> 标签：flash, external-dependencies

我有一个 Flash 播放器，它可以从其他站点上的 Flash 文件中加载一些附加功能……例如，site1 上的主 Flash 播放器，但它显示的动画实际上位于 site2 上。

如何检测主 Flash 播放器何时（何地）获取信息？

我可以以某种方式跟踪网络流量以查看这种情况吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T09:27:05.947

我设法使用名为“Wireshark”的产品来运行网络捕获，并在结果跟踪中找到了 HTTP GET 请求。如果您知道自己在做什么，您可能可以更好地过滤结果 - 但幸运的是，颜色编码以亮绿色突出显示了我需要的内容，这让我不必搜索它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-09T23:48:12.457

您可以使用 wireshark 过滤器。只需过滤 http 流量。您还可以使用它来跟踪 tcp 对话并查看实际请求的 ascii 版本。

# algorithm - 从 3D 点云进行表面重建的鲁棒算法？

> ID：838761
> 
> 赞同：76
> 
> 时间：2009-05-08T08:17:13.027
> 
> 标签：algorithm, 3d, computational-geometry

我试图弄清楚有哪些算法可以从 3D 范围数据进行表面重建。乍一看，*Ball pivoting algorithm* ( **BPA** ) 和*Poisson 曲面重建*似乎是更成熟的方法？

*   除了 BPA 和泊松曲面重建算法，该领域还有哪些成熟的、更稳健的算法？
*   推荐的研究出版物？
*   有可用的源代码吗？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-05-26T20:16:08.130

我已经面临这个困境几个月了，并进行了详尽的研究。

# 算法

主要有两类算法：计算几何和隐式曲面。

## 计算几何

它们将网格拟合到现有点上。

该组中最著名的算法可能是[powercrust](http://www.cs.ucdavis.edu/~amenta/pubs/sm.pdf)，因为它在理论上是完善的——它保证了不透水的网格。

Ball Pivoting is patented by IBM. Also, it is not suitable for pointclouds with varying point density.

## Implicit functions

One fits implicit functions on the pointcloud, then uses a marching-cube-like algorithm to extract the zero-set of the function into a mesh.

Methods in this category differ mainly by the different implicit functions used.

[Poisson](http://www.cs.jhu.edu/~misha/MyPapers/ISVC09.pdf), [Hoppe's](http://research.microsoft.com/en-us/um/people/hoppe/proj/thesis/), and [MPU](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.8.2916) are the most famous algorithms in this category. If you are new to the topic, i recommend to read Hoppe's thesis, it is very explanatory.

The algorithms of this category usually can be implemented so that they are able to process huge inputs very efficiently, and one can scale their quality<->speed trade-off. They are not disturbed by noise, varying point-density, holes. A disadvantage of them is that they require consistently oriented surface normals at the input points.

# Implementations

You will find small number of free implementations. However it depends on whether You are going to integrate it into free software (in this case GPL license is acceptable for You) or into a commercial software (in this case You need a more liberal license). The latter is very rare.

One is in [VTK](http://www.vtk.org/). I suspect it to be difficult to integrate (no documentation is available for free), it has a strange, over-complicated architecture, and is not designed for high-performance applications. Also has some limitations for the allowed input pointclouds.

Take a look at [this](http://www.cs.jhu.edu/~misha/Code/PoissonRecon/) Poisson implementation, and after that share your experience about it with me please.

Also: [here](http://www.cs.jhu.edu/~misha/Code/) are a few high-performance algorithms, with surface reconstruction among them.

CGAL is a famous 3d library, but it is free only for free projects. [Meshlab](http://meshlab.sourceforge.net/) is a famous application with GPL.

Also (Added August 2013): The library [PCL](http://pointclouds.org) has a [module](http://docs.pointclouds.org/trunk/group__surface.html) dedicated to surface reconstruction and is in active development (and is part of Google's Summer of Code). The surface module contains a number of different algorithms for reconstruction. PCL also [has the ability](http://pointclouds.org/documentation/tutorials/normal_estimation.php) to estimate surface normals, incase you do not have them provided with your point data, this functionality can be found in the features [module](http://docs.pointclouds.org/trunk/group__features.html). PCL is released under the terms of the BSD license and is open source software, it is free for commercial and research use.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-01-02T02:40:12.757

If you want make some direct experiments with various surface reconstruction algorithms you should try **[MeshLab](http://meshlab.sourceforge.net)**, the mesh-processing system, it is open source and it contains implementations of many of the previously cited surface reconstruction algorithms, like:

*   Poisson Surface Recon
*   a couple of MLS based approach,
*   a ball pivoting implementation
*   a variant of the Curless volume based approach
*   Delaunay based techniques (Alpha shapes and Voronoi filtering)
*   tools for computing normals from scattered point sets
*   and many other tools for comparing/measuring/cleaning/simplifying the resulting meshes.

Sources are protected by GPL, so you could not use them in a commercial closed source project, but it is very important to get the right feeling about the properties of the various surface reconstruction algorithms (how sensitive to noise they are, the speed, the robustness to outliers, how they preserve fine details etc etc) before starting to implement one of them.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-11T05:03:13.513

您可能会开始查看该领域的一些最新工作 - 目前例如Gianmauro Cuccuru、Enrico Gobbetti、Fabio Marton、Renato Pajarola 和 Ruggero Pintus[对点采样表面的快速低内存流式 MLS 重建。](http://www.crs4.it/vic/cgi-bin/bib-page.cgi?id='Cuccuru:2009:FLM')它的引文可以让你快速浏览文献。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-28T13:49:08.430

While not a mesh representation, an ex-colleague recommended me this link to source code for a Thin Plate Spline method:

[Link](http://elonen.iki.fi/code/tpsdemo/index.html)

Anyone tried it?

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-08T08:20:07.370

不确定它是否完全适合您的情况，因为您省略了它似乎很奇怪，但是在这种情况下通常会提到[行进立方体。](http://en.wikipedia.org/wiki/Marching_cubes)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-01-25T22:56:04.363

As I had this problem too, I did develop and implement my own point cloud crust algorithm. The sources, as well as the documentation, can be found on github.com: [https://github.com/meixxi/PointCloudCrust](https://github.com/meixxi/PointCloudCrust). The algorithm is implemented in Java.

Maybe, this can help you. You can find also a short python script on the page which illustrates how to use the library. Have fun!

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-09-13T13:18:40.397

[Here](https://github.com/Microsoft/Mesh-processing-library) on GitHub, is a open source [Mesh Processing Library](https://rawgit.com/Microsoft/Mesh-processing-library/master/README.html) in C++ by [Dr. Hugues Hoppe](http://hhoppe.com/), in which the surface reconstruction program **Recon** is a good option for your problem...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-09-19T20:44:43.420

There is [3D Delaunay tool by Geometric Tools](https://www.geometrictools.com/Samples/Geometrics.html#Delaunay3D). This tool is used DirecX and OpenGL. Unfortunately, you may need buy a book to see actual example code of the library. You still read the code and figure out.

Matlab also introduced a surface reconstruction tool using Delaunay, [delaunayTriangulation class](http://www.mathworks.com/help/matlab/ref/delaunay.html).

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-08T17:14:43.083

您可能对[Alpha Shapes](http://biogeometry.duke.edu/software/alphashapes/index.html)感兴趣。

# c# - 使用 Windows 服务作为调度服务

> ID：838764
> 
> 赞同：1
> 
> 时间：2009-05-08T08:19:29.260
> 
> 标签：c#, windows-services, scheduled-tasks, scheduling

我有一个客户提出的这个问题，根据期间的类型，每天或每两周运行一些数据库脚本。他们定义了“忙碌”时期和“安静”时期。他们正在为他们的应用程序使用共享主机，并且他们无法将 SQL Server 作业添加到他们的数据库中。

我想要做的是创建一个 Windows 服务，它可以使用配置文件进行配置，包含不同的时期及其间隔。此服务正在检查当前时间和日期与配置文件中的预定时间段，一旦时间间隔匹配，将执行 sql server 存储过程

我的问题：有没有更好的方法可以在没有 sql server 的情况下进行这种调度，或者您知道是否已经存在现有的、更通用（免费）的解决方案？

[编辑] ~~我不能使用 Windows 任务调度程序，因为它们的安静期是在冬天，而它们的繁忙期是在夏天。使用任务计划程序，我必须每年手动修改两次计划任务。这就是我和我的客户现在想要的。~~ [/编辑]

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T08:24:13.773

您可以在需要时使用 Windows 的“计划任务”功能来启动某些控制台应用程序。

如果您想创建自己的调度解决方案，那么我建议您查看[Quartz.NET](http://quartznet.sourceforge.net/)，它提供与 Windows 任务调度程序相同的灵活性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T23:02:20.177

为什么不使用任务调度器，然后每次你的应用程序启动时，它都会检查它自己的调度以确定它是否需要做某事。

因此，您可以使用任务调度程序每 15 分钟启动一次应用程序。当您的应用程序启动时，它使用它自己的配置文件来确定它是否需要做某事。

您还可以使用它来让您的应用程序停止任何当前正在运行的应用程序版本，以终止任何长时间运行的任务！

# authentication - 来自已安装应用程序的 OpenID 身份验证

> ID：838765
> 
> 赞同：3
> 
> 时间：2009-05-08T08:19:48.230
> 
> 标签：authentication, java-me, openid, oauth

我目前正在计划一个新的网络项目。客户端将使用常规的 Web 浏览器进行连接，如果是常规的支持 Java 的手机，则使用 j2me 客户端。我真的很想使用 OpenID 身份验证。如果是普通的网络浏览器，事情就很简单了。但是，我真的不确定已安装的应用程序（例如安装在移动设备上的 j2me 客户端） - 通过在特定 OpenID 提供商的网页上输入用户名/密码来执行常规 OpenID 身份验证 - 这是一个很大的限制：)

有没有人处理过这种情况？是否可以为使用来自移动 j2me 客户端的 OpenID 的站点创建身份验证机制？

目前，我想到的解决方案是希望通过手机连接的用户在进行身份验证后从服务器网站下载必要的 j2me 应用程序（常规浏览器身份验证）。移动客户端应用程序可以在服务器上动态组装，其中嵌入了与特定登录 OpenID 用户相关联的 SSL 证书。之后，j2me 客户端可以在不输入任何用户名/密码的情况下向服务器进行身份验证。将存储在服务器上的数据不是那么敏感 - 考虑到手机盗窃等情况。

有人可以提出更好的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T18:28:47.633

对于您正在做的事情，IMO 的最佳解决方案是将 OAuth 与 OpenID 结合使用。您在 RP 使用 OpenID 很好。但是对于需要访问该网站的已安装应用程序，他们应该使用 OAuth 来获得授权。流程将像这样工作：

1.  用户在他们的设备上安装应用程序
2.  在安装期间或首次启动时，该应用程序有一个“授权我”按钮。
3.  用户按下按钮，网络浏览器会弹出客户端应用程序需要从中访问数据的网站。
4.  用户使用其 OpenID 登录该站点
5.  网站现在询问“您要授权客户端应用程序 X 吗？”
6.  用户说是并关闭浏览器。
7.  客户端应用程序重新出现并说“谢谢”。现在拥有访问用户数据所需的 OAuth 令牌，而无需用户再次登录。

# debugging - 您如何对“在我的机器上工作”场景进行故障排除

> ID：838770
> 
> 赞同：7
> 
> 时间：2009-05-08T08:20:47.993
> 
> 标签：debugging, remote-debugging

很多时候，当您向开发人员报告错误时，他会说“它可以在我的系统上运行”，尽管它是一个浏览器应用程序。你如何解决这个问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-08T08:24:26.753

## 从培训/流程的角度来看：

培训你的团队，让他们知道“在我的机器上工作”不是越狱的回应。

有一个[自动构建服务器](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)。

进行自动化测试部署。

您的开发人员必须知道“工作”被定义为“在测试服务器上工作”，而不仅仅是他们的机器。

## 从测试/调试的角度来看：

需要向开发人员展示导致错误发生的一系列操作。

您可能想要捕获显示错误的屏幕截图，或者可能想要捕获视频（使用诸如[Camtasia](http://www.techsmith.com/camtasia.asp)之类的工具）。人们可能很不擅长描述他们在系统上执行的导致错误出现的操作顺序，因此您可以捕获的有关错误以及如何复制自身的信息越多越好。

## 从开发/环境的角度来看：

如果确实有一个错误出现在一个环境中而不是开发人员的环境中，那么找出它是在没有开发环境中出现，还是仅在您的一个开发人员的环境中出现。

从那时起，尝试减少两种环境之间的差异，以便您的开发人员可以在他的机器上看到问题。

或者，您可以另辟蹊径，尝试在生产（非开发）环境中调试问题。

这些实现细节因平台而异。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T08:28:47.477

您需要向开发人员提供尽可能多的信息。即使是你认为不相关的东西。

我数不清有多少次我报告了一个问题，也无法重复，后来才发现一条用户最初没有包含的信息，但却是解开谜题的关键。

您还需要不接受该答案并说“您的设置和我的设置之间肯定有些不同，*我们*能做些什么来解决它”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T08:26:14.017

我们通过在本地开发之上建立一个在设置、硬件等方面尽可能接近生产系统的开发环境来解决这个问题。因此，生产环境中发生的几乎所有问题都可以在即使无法在本地开发人员机器上复制该开发系统。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T08:28:26.320

这是我从团队中遇到的一个常见的逃避现实的反驳。我的回答通常是：“你知道，你的系统不是生产服务器，而这正是它需要工作的地方”。换句话说，这个借口根本不可接受。

我还向他们指出了可能性：

一种。本地系统和服务器之间存在配置差异。

湾。功能的某些依赖项不会在服务器上更新。

C。他们还没有清除浏览器缓存。

d。我将问题复制到暂存服务器上并向他们演示。

e. ...等等，视情况而定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T08:24:20.310

尝试尽可能地重新创建发现错误系统的用户：从服务器配置到机器配置，包括浏览器和操作系统等。在发布之前，您可能应该有几个不同的设置来测试您的应用程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T08:27:18.913

IE Tester 是进行此类故障排除的好工具。如果您需要测试大量浏览器，那么像 Virtual PC 这样的虚拟机是您最好的选择，因此您可以在测试服务器上设置许多客户端。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T08:30:31.823

啊，是的……书中最古老的借口。

假设开发人员和测试人员都在同一台服务器上进行测试，我会尝试通过确定开发人员机器和测试人员机器之间的区别来隔离错误。可能是小问题，例如 Flash 版本、浏览器差异或忘记清除浏览器缓存

我还建议在专用测试服务器上使用自动化测试框架和测试应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T08:48:13.123

作为最终用户，您无能为力，但作为开发人员，您可以通过在系统中包含大量登录来避免很多这些问题 - 用户会想到的差异只是您已经测试过的简单事情，但良好的日志记录可以让您准确了解系统发生故障时发生的情况。我发现了很多不可能以这种方式发生的错误。

# artificial-intelligence - 从街景图像中提取监控摄像头位置

> ID：838782
> 
> 赞同：2
> 
> 时间：2009-05-08T08:25:19.323
> 
> 标签：artificial-intelligence, machine-learning, image-recognition, photogrammetry

与[我之前的问题](http://stackoverflow.com:80/questions/834352/database-of-surveillance-camera-locations)相关，是否有一些现实的机会通过计算机视觉算法从谷歌街景图片中提取监控摄像头位置？我不是这方面的专家。但它应该比人脸检测等更容易。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T09:05:21.817

我认为你错了，它比人脸​​识别更容易解决（尽管我怀疑你的意思是人脸检测）。

考虑到面部的形状相当规则，通常在特定配置下有两只眼睛、鼻子和嘴巴，而一个制造商的监控摄像头看起来与另一个制造商的监控摄像头不同，并且从不同的角度看起来也不同。

对于人脸，如果您看不到该人的脸，则您对此不感兴趣，但在您的场景中，您有兴趣检测相机，无论它与您的相对位置如何。

虽然并非不可能（即人类可以做到！）但我认为计算机科学还不能胜任这项任务......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-20T01:45:25.880

这听起来像是亚马逊的[Mechanical Turk](https://www.mturk.com/mturk/welcome)被发明出来的一类问题。我不相信图像处理或图像识别算法在我们目前的理解和硬件/软件能力范围内。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-20T01:42:32.580

我绝对同意 Rob 的观点，即提取相机位置将比人脸检测（甚至识别）更困难。

对您的问题采取不同的方法怎么样：如何找到**拍摄**监控图像的摄像机的位置。

有标准的（如果复杂的）[摄影测量](http://www.geodetic.com/Whatis.htm)技术可以使用来自多个相机或单个相机的多个角度的照片来映射对象的 2D 或 3D 坐标。您正在寻找的是我以前从未见过的“反向摄影测量”，但这个有趣的[法律轶事](http://libraries.maine.edu/Spatial/gisweb/spatdb/acsm/ac94011.html)表明它是可行的。

# java - 为 Liferay 开发 portlet 的限制/缺点

> ID：838786
> 
> 赞同：30
> 
> 时间：2009-05-08T08:26:28.743
> 
> 标签：java, portlet, liferay, portal

我正在考虑将应用程序开发为 portlet，以集成到 Liferay 门户中。与使用 Spring 框架开发普通 Web 应用程序相比，开发此类应用程序是否有任何明显的缺点或限制？

Liferay 似乎要求所有内容都作为portlet 添加。我考虑的另一个选择是仅将 Liferay 用于应用程序的某些部分，并添加到其他自开发内容的外部链接，作为普通 Web 应用程序开发。但是，这将需要多种用户身份验证机制以及 Liferay 和其他 Web 应用程序之间的某种跨站点身份验证。

最好的方法是什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-11T17:48:38.063

（免责声明：我是 Liferay 的开发人员之一）

我认为这两种选择都很好，具体取决于您的需求。如果您以前有开发独立 Web 应用程序的经验，但没有开发 portlet 的经验，那么选择前者会让您更快地开始。缺点是您必须实现自己的用户和权限系统，并且无法利用 Liferay 提供的门户服务。如果您决定使用此替代方案，请注意您可以将常规 WAR 文件部署到 Liferay，它会自动创建一个使用 iframe 显示您的应用程序的简单 portlet。这将允许您将独立应用程序与 Portlet 一起放在 Liferay 的页面中。

当您开始利用 Liferay 提供的门户服务时，为 Liferay 开发一个 portlet 开始获得回报。从开发一个portlet 开始，您可以忘记开发您自己的用户系统并使用Liferay 提供的系统（它非常强大）。您还可以使用其他服务，例如权限、评论、标记、分类、数据范围等，这将使您能够在更短的时间内开发出相当完整的应用程序。缺点是第一次你必须学习一些新东西，但第二次你会走得更快。

我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-05-14T22:59:00.223

我已经使用 Liferay 大约 2 年了，用于内部应用程序。在我们第一次发布之前，我们在整个开发周期中多次进行了相同的讨论。我们不得不和Liferay打了几次，有时是因为我们自己缺乏知识，有时是因为portlet环境，有时是因为Liferay。

如果您想要从门户获得的多个应用程序的布局选项，那么您当然应该使用 Liferay。如果您正在编写单个应用程序，那么我可能不会使用 Liferay。我认为一些 Liferay 和一些不是 Liferay 的混合是迄今为止最糟糕的选择。

我们可能没有充分利用 Liferay 的功能，但如果这是您的第一个 Liferay 应用程序，那么由于学习曲线，您很可能也不会。我们最初希望为应用程序的不同方面提供许多不同的 portlet，但由于在开发过程中（JSR-286 之前）缺乏良好的 portlet 间通信机制，我们最终编写了一个应用程序。既然我们最终上了那条船，我希望我们没有 Liferay，因为我们真正使用的只是一些用户管理功能。

我们使用 JSF 和 facelets（对我们来说都是新技术，所以痛苦可能是自找的），虽然我们已经做得更好了，但似乎我们必须跳过一些障碍才能让它工作在 portlet 中正确；在常规 Web 应用程序环境中不会发生的事情。对于许多框架来说，portlet 支持似乎是事后才想到的。这显然不是 Liferay 特有的，它只是在 portlet 环境中工作的副产品。

在使用 Spring MVC、Struts、Faces、Wicket 等的 web 应用程序中，您将对所有内容有更多的控制权，但也需要负责实现更多的东西。

在 portlet 中，您将受到 JSR-168 和/或 JSR-286 条款的约束。门户容器将为您提供一些功能，例如用户身份验证，但是 IMO，用于用户身份验证的整个门户太重了。我看到门户的强大之处在于允许用户自定义他们对多个应用程序的视图，而不是呈现单个应用程序。

您应该查看与 portlet 相关的规范，看看它是否符合您的需要。

[http://developers.sun.com/portalserver/reference/techart/jsr168/](http://developers.sun.com/portalserver/reference/techart/jsr168/)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-11-13T08:04:36.677

Liferay 是一个非常强大的系统，有许多现成可用的服务和应用程序，但最大的缺点是缺乏文档。只看代码不可能知道一切，所以在我看来，如果你没有专业知识，就不要选择 Liferay。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-16T06:45:04.353

Liferay 和 portlet 通常非常适合特定类别的应用程序。如果您在 IT 部门工作并且需要为多个部门或由多个部门组合应用程序，那么 Portlet 将是您的最佳选择。从理论上讲，您可以从不同的供应商那里引入 portlet，它们将在同一个环境中和谐相处。

但是，如果您正在构建的应用程序属于以下任何一种

1) 完全由单个团队创建 2) 具有单一的需求来源 3) 具有不是 portlet 容器中可用功能的子集的需求。4) 有一个不愿意生活在门户样式应用程序范围内的图形设计师。

然后坚持使用像 Spring 这样的东西将是要走的路。

Spring 及其许多子项目提供了许多由 portlet 提供的共享服务和基础设施，但它们是以开放和更灵活的方式提供的。你可以挑选你想要的。

Portlet 在身份验证和授权、导航和布局方面为您做出许多设计决策。如果您为应用程序制定的计划超出了这些决定，您将花费大量时间创建变通方法来尝试让它做您想做的事情。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-12-09T07:15:21.827

每个人，请不要把它当作拖钓/燃烧。这是我认为 Liferay 社区应该解决的问题，每个想使用 Liferay 的人都应该知道。

缺点：没有文档。甚至没有什么像 Hibernate 的文档那样遥不可及。只是一个空的javadock（代码中没有评论），论坛和旧版本书籍中的一些回答问题（无用）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-08T09:46:17.010

我一直认为像 Liferay 这样的门户应该被视为类似于共享基础架构。它们提供了访问应用程序、共享服务（例如身份验证）和标准部署方式的通用方式，但以性能为代价。

如果您打算在门户中部署的不仅仅是这个应用程序，那么是的，这可能是合适的，因为您无需再次开发这些共享服务即可节省时间/成本。后续应用程序的外观和行为将与此类似。

但是，如果这是唯一要部署的应用程序，那么门户网站的开销并不值得，您最好使用普通的 Web 应用程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-14T10:56:32.957

Liferay 具有 CMS 功能，可以与 Alfresco 等外部 CMS 平台集成。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-07T20:54:01.203

伙计，看看这个解决方案 Netbeans IDE + PoralPack3.0 plugin + Liferay 5.2 bundle。这里的 Portal Pack 通过为 service.xml 文件提供一个很好的 GUI 编辑器来帮助您，您可以在其中定义实体或数据库结构，并且可以从同一个 GUI 生成可以在您的 portlet 中使用的服务代码。

有关更多信息，请查看以下给出的链接： [http ://www.liferay.com/web/satyaranjan/blog/-/blogs/portal-pack-:-write-database-portlet-using-service-builder-plug-in](http://www.liferay.com/web/satyaranjan/blog/-/blogs/portal-pack-:-write-database-portlet-using-service-builder-plug-in)

# iphone - 检测文本上的手指触摸

> ID：838793
> 
> 赞同：1
> 
> 时间：2009-05-08T08:27:25.077
> 
> 标签：iphone, objective-c, cocoa-touch

我想用手指触摸来阅读屏幕上显示的字符串，这意味着当我的手指在屏幕上显示的文本上移动时，手指下方的文本应该会突出显示。有没有办法使用 UITextView 或任何其他类来做到这一点。我还想从已经录制了句子的声音文件中播放与该单词相关的声音。如果有人知道，请回复。提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-29T14:46:54.550

我想出了一个方便的技巧来做到这一点。在 drawRect 中，模仿 UITextView 将绘制的文本，但实际上并不绘制文本。将字体设置为 Helvetica 17-point，唯一的半棘手部分是处理自动换行。您已经有了要显示的文本，您可以通过调用 sizeWithFont 来获取该默认字体中每个单词的大小。然后保存每个单词的矩形，当用户触摸视图时，找出存储的哪些矩形包含触摸点。要测试和校准几何图形（行距等），请自己用不同的颜色绘制文本。当你得到它以便你只能看到一种字体颜色时，你就完美了。

如果有人想要，我可以发布我的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T14:16:14.387

所以这是两个问题。

要知道您的手指在文本中指向的位置，您需要知道 UITextView 在哪里布置了字符。这不是 UITextView 被记录支持的东西，所以接下来是自己绘制文本。[这个关于嵌入自定义字体](https://stackoverflow.com/questions/360751/can-i-embed-a-custom-font-in-an-iphone-application)的stackoverflow 问题有一些链接，甚至还有一些可以解决问题的代码。您需要添加的是跟踪字符的前进，以便准确了解每个字符的渲染位置（或者您甚至可以使用其他核心图形功能来获取每个字符的精确边界框）。

显然，一旦您知道点击了哪个字符，您也知道它所属的单词。如果句子被完整记录和单个单词记录，您可能会获得最佳质量，以便您可以在需要时播放。[关于播放从互联网加载的声音的](https://stackoverflow.com/questions/293929/speakhere-sample-cant-play-sound-which-loads-from-internet)另一个 stackoverflow 问题有一些与加载和播放音频相关的链接和片段。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T00:37:47.787

我正在编写的 iPhone 文本编辑器中执行此操作。出于多种原因，我将 UIView 子类化以绘制文本（而不是 UITextView），并且我必须实现类似的东西来提供像文本视图一样的可移动光标。我所做的是使用固定宽度的字体（准确的说是 Courier），然后我将触摸的 x 坐标除以字符的宽度，然后将答案四舍五入。这给你一个字符索引。

但是，如果可能，请找到一种无需自己绘制文本的方法（如果文本是用户输入的或实际上不是硬编码的），因为 Apple 在其 UITextView 类中提供了很多难以复制的功能：编辑、光标、自动换行、滚动等。

如果您无法从子类 UITextView 中获取触摸事件，则可能有可能将透明视图/图层放在文本顶部并从中获取触摸事件，那么您只需要找到一种方法即可这可以打开和关闭以进行编辑。

凯尔

# php - 试图弄清楚如何使这个评级系统发挥作用

> ID：838808
> 
> 赞同：0
> 
> 时间：2009-05-08T08:31:40.247
> 
> 标签：php, jquery

我正在使用[此页面](http://php.scripts.psu.edu/rja171/widgets/rating.php)上的脚本。

我下载了页面上找到的整个包，并将 url 修改为 php 文件，如下所示：

```
$('#rate').rating('output.php', {maxvalue:5}); 
```

在 output.php 我有这个。该页面的作者说该帖子将调用评级。所以这就是我使用帖子评分的原因。

```
<?php
if(isset($_POST['rating'])) { 
    header("Location: http://www.google.com");
}
?> 
```

但是当我运行页面并选择几颗星时，什么也没有发生。我之所以做标头位置是因为我想看看它是否有效。但这对我不起作用。你们知道我做错了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T08:38:01.493

你期望它做什么？通过执行 google.com 的标头位置，您实际上是重定向 AJAX 请求，而不是进行呼叫的用户的浏览器。您可以只打印“test”并使用[Firebug](http://getfirebug.com/)检查请求是否已发出并返回文本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T08:38:38.310

您正在发送一个 ajax 请求。所以你的浏览器不会重定向。你可以使用[firebug](http://getfirebug.com/)一个 firefox 插件。您可以在那里检查您的 ajax 请求，以及它们在控制台选项卡上返回的内容。

另外，您使用的是[jquery](http://jquery.com/)，请确保您的 javascript 是正确的！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T08:42:57.440

如上所述，使用 Firebug 出色的调试控制台来检查您得到的响应。验证 ajax 请求的正确方法是检查超全局服务器数组中的 HTTP_X_REQUESTED_WITH 键是否包含**XMLHttpRequest**。即，你可以这样做：

```
<?php
function isAjaxRequest(){
  return isset($_SERVER['HTTP_X_REQUESTED_WITH']) && $_SERVER['HTTP_X_REQUESTED_WITH'] == 'XMLHttpRequest';
}

if(isAjaxRequest(){
  echo 'Hello, Ajax!';
}
else exit;
?> 
```

最好的，克里斯蒂安

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T09:10:08.233

你怎么知道没有任何工作？下载 Firebug，[http](http://getfirebug.net) ://getfirebug.ne​​t ，转到“NET”选项卡并执行您的 ajax 请求。然后检查你得到什么样的回应。您还必须处理从评级脚本中获得的数据！您只得到 javascript 位，服务器端编码由您决定！你可以做一个'RATING' post 变量的var_dump，然后用Firebug 调试它。祝你好运！

# sql - linq 匹配带有边界的单词

> ID：838809
> 
> 赞同：1
> 
> 时间：2009-05-08T08:32:04.660
> 
> 标签：sql, linq

假设我的数据库中有一个 nvarchar 字段，看起来像这样

```
1, "abc abccc dabc"
2, "abccc dabc"
3, "abccc abc dabc" 
```

我需要一个选择 LINQ 查询，该查询将匹配单词“abc”，边界不是字符串的一部分

在这种情况下，只有第 1 行和第 3 行会匹配

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T08:44:43.583

```
from row in table.AsEnumerable()
where row.Foo.Split(new char[] {' ', '\t'}, StringSplitOptions.None)
    .Contains("abc")
select row 
```

包含对 的调用很重要`AsEnumerable`，这意味着查询在客户端执行，否则（我很确定）`Where`子句不会成功转换为 SQL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T08:43:05.507

也许像这样的正则表达式（nb - 未编译或测试）：

```
var matches = from a in yourCollection
         where Regex.Match(a.field, ".*\sabc\s.*")
         select a; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T08:50:28.750

```
datacontext.Table.Where(
         e => Regex.Match(e.field, @"(.*?[\s\t]|^)abc([\s\t].*?|$)")
); 
```

或者

```
datacontext.Table.Where(
         e => e.Split(' ', '\t').Contains("abc");
); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T14:16:16.650

为了提高效率，您希望在服务器上进行尽可能多的过滤，然后在客户端上进行其余的过滤。您不能在服务器上使用 Regex（SQL Server 不支持它），因此解决方案是首先使用 LIKE 类型的搜索（通过调用 .Contains），然后在客户端使用 Regex 来进一步细化结果：

```
db.MyTable
  .Where (t => t.MyField.Contains ("abc"))
  .AsEnumerable()    // Executes locally from this point on
  .Where (t => Regex.IsMatch (t.MyField, @"\babc\b")) 
```

这可确保您仅从 SQL Server 检索不包含字母“abc”的行（无论它们是否是词边界匹配），并在客户端使用正则表达式进一步限制结果集，以便仅包含在单词边界上的匹配项。

# gtk - 如何获取 gtktreeview 标头的高度？

> ID：838811
> 
> 赞同：1
> 
> 时间：2009-05-08T08:32:24.440
> 
> 标签：gtk, gtkmm, gtktreeview

我查看了 gtk 源代码，标题高度是私有的。我已经尝试了一些东西，但它没有按预期工作（heightWithHeader 是 1？！）

```
Glib::RefPtr<Gdk::Window> pWindow = treeView.get_bin_window();

treeView.set_headers_visible(true);
pWindow->get_size(width, heightWithHeader);

treeView.set_headers_visible(false);

pWindow->get_size(width, heightWithoutHeader);

r_treeView.set_headers_visible(true);

returnValue = heightWithHeader - heightWithoutHeader; 
```

你能帮我解决我的代码或修复我的代码吗？

**更新：**我必须调整树视图的高度以显示固定数量的行。我通过将容器（滚动窗口）的大小调整为 headerHeight + numberRowsToDisplay * heightOfRow 来做到这一点。

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-05-08T08:35:07.053

您的代码不起作用的原因很可能是您“太不耐烦了”，没有给 GTK+ 时间在使标题再次不可见之前重新绘制小部件。

当您进行需要重绘的调用时，GTK+ 不会立即绘制。相反，重绘是排队的，然后从 GTK+ 主循环中一次性完成。这样，按顺序对小部件进行两次更改不会导致两次重绘，而只会导致一次。

这有点 hack，但您可以尝试“经典”GTK+ 事件刷新技巧，方法是在打开标题后插入这样的循环：

```
while(gtk_events_pending())
  gtk_main_iteration(); 
```

只要在 GTK+ 的队列中有事件（上面提到的绘图更改是内部事件），这就会简单地循环，并刷新它们，然后将控制权交还给您。不过，这很可能会导致一些视觉闪烁。

# sql - 如何将 nvarchar 转换为时间，而不是日期时间？

> ID：838814
> 
> 赞同：1
> 
> 时间：2009-05-08T08:33:24.813
> 
> 标签：sql, sql-server, sql-server-2005

```
DECLARE @DateNow smalldatetime
SET @DateNow='12:30'
select @DateNow
-------------------------------------OR--------------------------------------
select CAST( '12:30' as datetime )
```

* * *

结果：1900-01-01 12:30:00.000（我不想要这个）

但是我需要时间格式而不是字符串而不是日期时间的结果？

结果：12:30（我想要这个）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-08T10:57:17.103

就像 José 所说，您可以使用 CONVERT 将日期时间显示为日期。MSDN 列出了所有[可能的格式](https://docs.microsoft.com/en-us/sql/t-sql/functions/cast-and-convert-transact-sql)。例如格式 8 是 hh:mi:ss：

```
 select convert(varchar(32),getdate(),8)
 12:51:21 
```

现在，您可以通过指定更少的字符来缩短秒数：

```
 select convert(varchar(5),getdate(),8)
 12:51 
```

另一种常用的格式是121，yyyy-mm-dd hh:mi:ss.mmm(24h)：

```
 select convert(varchar(32),getdate(),121)
 2009-05-08 12:51:21.987 
```

您可以在哪里选择时间部分，例如：

```
 select substring(convert(varchar(32),getdate(),121),12,5)
 12:51 
```

或者结合字符串技巧：

```
 select right(convert(varchar(16),getdate(),121),5)
 12:51 
```

正确的？正确的！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-08T08:58:06.720

SQL Server 2008 中有一个[TIME](http://www.sqlteam.com/article/using-the-time-data-type-in-sql-server-2008)类型，但在以前的版本中，您可以将其表示为 varchar 以进行显示。

这是您可以以所需格式检索 DATETIME 字段的时间部分的方法。

```
DECLARE @DateNow smalldatetime
SET @DateNow = GETDATE() -- 2009-05-08 12:58:02.680

SELECT CONVERT(CHAR(5), @DateNow, 8) 
-- this returns the time portion as 12:58 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T08:39:47.700

您可以使用[转换](http://msdn.microsoft.com/en-us/library/ms187928.aspx "兑换")功能。

顺便说一句，SQL Server 中没有“TIME”数据类型。因此，转换后的结果将始终是一个字符串。

`<`编辑：SQL Server 版本SQL Server 2008中没有“TIME”数据类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T10:00:55.040

**如果**您需要比较、添加和/或减去时间（仅）值，请考虑使用 INT 存储“TIME”值，然后在显示结果时将其转换为 CHAR 的可能性。

# php - symfony 框架的数据库关系问题 - 无法为未定义的表获取 TableMap

> ID：838815
> 
> 赞同：0
> 
> 时间：2009-05-08T08:33:39.693
> 
> 标签：php, database, frameworks, symfony1, foreign-key-relationship

目前正在使用通过 PEAR 获得的最新版本的 symfony 开发应用程序。这是我的确切架构配置

```
propel:

 user:
  id:
  name:     { type: varchar(255), required: true }
  level:    { type: integer, required: true, default: 1 }
  created_at:    

 post:
  id:
  title:     { type: varchar(255), required: true }
  post:      { type: longvarchar, required: true }
  user_id:   
  created_at:
  updated_at:

 comment:
  id:
  relation:  integer
  comment:   { type: varchar(300), required: true }
  nick:      { type: varchar(100), required: true }
  created_at:
  updated_at: 
```

清醒的你可能已经注意到 post 中的 user_id 是用户的外键。根据明确的指南；[quote title=Quote:]（以_id结尾的列被认为是外键，根据列名的第一部分自动确定相关表）。[/quote]

每当我尝试构建过滤器或表单（构建过滤器/构建表单/构建全部）时，我都会收到以下错误消息。

```
>> propel    generating form classes
  -----> Cannot fetch TableMap for undefined table: user.  Make sure you have the static MapBuilder registration code after your peer stub class definition. <------
[?php
/**
 * Post form base class.
 *
 * @package    ##PROJECT_NAME##
 * @subpackage form
 * @author     ##AUTHOR_NAME##
 * @version    SVN: $Id: sfPropelFormGeneratedTemplate.php 16976 2009-04-04 12:47:44Z fabien $
 */
class BasePostForm extends BaseFormPropel
{
  public function setup()
  {
    $this->setWidgets(array(
      'id'         => new sfWidgetFormInputHidden(),
      'title'      => new sfWidgetFormInput(),
      'post'       => new sfWidgetFormTextarea(),
      'user_id'    => new sfWidgetFormPropelChoice( 
```

我也尝试在我的架构中定义 foreignTable 和 foreignReference，但没有运气。这是一个新的 symfony 项目，只是为了调试这个错误而创建的。我尝试为我的表使用单数和复数名称。我做错了什么，或者这是一个严重的错误？感谢任何输入，这让我发疯！

我在 symfony 的官方社区有一个论坛帖子，在这里：http: [//forum.symfony-project.org/index.php/m/77979/](http://forum.symfony-project.org/index.php/m/77979/) - 有一些建议（比如我如何忘记使用波浪号以及“ user" 是一个预定义的类，但问题仍然**解决**[编辑] 到现在。

**一个免费的网络拥抱、主要道具和免费航天飞机，送给想出解决方案的强大灵魂！**（免责声明：实际上没有免费的航天飞机）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T09:54:45.397

**更新：问题已解决！**...经过无数小时的回溯和调试。

该问题是由在 propel.ini 中手动编码的 TABLE 前缀引起的，如下所示：

; 自定义表前缀
propel.tablePrefix = mindmonkey_

与 schema.yml 和 propel.ini 或类似的东西没有通信，所以一切都出错了。我由此得出的结论是：忘记前缀，只需为每个项目使用专用模式......我只是将前缀用作习惯，总是这样做 - 但除非特别指示这样做，否则永远不会再这样做！

# c# - 从 C# 应用程序调用 C++ 代码或移植它？

> ID：838816
> 
> 赞同：5
> 
> 时间：2009-05-08T08:33:52.673
> 
> 标签：c#, c++, dll, port

我最近一直在努力解决在 C# 中实现不佳[的算法](http://en.wikipedia.org/wiki/Levenberg-Marquardt_algorithm)（即开发人员被拖到另一个项目中并且未能充分记录他所做的事情）。

我找到了一个替代方案（来自数字配方），它可以工作但用 C++ 编写。所以我想可能最安全的方法是将 C++ 包装在一个 DLL 中。

请记住，当涉及到 C# 时我仍然有点绿色并且从未尝试过从头开始制作 DLL，这听起来像一个合理的方法（如果是这样，有没有人尝试过这个/得到任何建议）？还是我应该全力以赴，尝试将 C++ 例程移植到 C# 中？

**编辑**- 我不是在寻找任何人为我做出决定，但如果有人对任何一条路线有任何经验，我很想听听他们的意见以及应该避免的任何令人讨厌的陷阱。例如，将数据列表从 C# 传递到 C++ STL 向量有多讨厌？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T08:46:20.163

我尝试从 c# 代码链接到 c-dll，结果非常好，即使我在环境之间发送数据时遇到了一些问题。否则，该过程非常简单。您来回发送的数据（数量和频率）越多，程序运行的速度就越慢，但您可能已经自己弄清楚了这一点。

主要缺点是每次发生变化或有人发现错误时，都要维护 c#-c 胶水代码（接口代码）。

这里有一些代码可以帮助您入门：

```
using System.Runtime.InteropServices;
    class myDllCaller {

       //call to function in the dll returning an int
      [DllImport("MyFavorite.dll")]
      private static extern int dllFunction(//list of parameters to function);

    public static void Main() {
    int rerult = dllFunction();

    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T08:43:58.780

如果 C# 版本 Mitch 引用的许可证不适合您的目的，您可以使用托管 C++ 包装器，它可以重用和包装您拥有的 C 代码，但您的托管应用程序仍然可以作为本机 .Net 看到部件。我过去曾使用这种方法来使用没有自己的本机 .Net API 的库的 C API，并发现它在两者之间编组数据相对轻松。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T08:36:47.393

这取决于你的目标是什么。

如果要拥有一个有效的应用程序，我会权衡这两种方法的成本和收益，并选择最具成本效益的方法。

如果是为了改进你的 C#，那么一定要重写 C。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T08:38:43.397

...或者您可以从[这里](http://www.alglib.net/optimization/levenbergmarquardt.php)下载已经用 C# 实现的代码。

# sql-server - SQLServer 死锁

> ID：838824
> 
> 赞同：6
> 
> 时间：2009-05-08T08:37:27.593
> 
> 标签：sql-server, spring, jdbc, transactions, deadlock

我有一个 Java 应用程序，它在数据库上执行多个并发 CRUD 操作。我正在添加对 SQLServer 的支持，但在并发删除期间遇到死锁问题。经过一些调查，问题似乎是由于特定表上的锁升级。

为了修复它，我决定使用 UPDLOCK 提示对有问题的表进行所有读取以“更新”，这样就可以避免死锁。但是，我仍然看到了问题。我在 SQLServer 中启用了跟踪，并在 SQLServer 日志中发现了以下死锁跟踪：

遇到死锁....打印死锁信息等待图

节点：1 密钥：5：72057594042384384（54048e7b3828）CleanCnt：3 模式：X 标志：0x0 授权列表 1：所有者：0x03D08C40 模式：X Flg：0x0 参考：0 寿命：02000000 SPID：62 ECID：0 XactLockInfo：0x04834274 SPID： 62 ECID：0 语句类型：DELETE 行号：1 输入缓冲区：语言事件：(@P0 nvarchar(4000))delete from part_data where part_id = @P0 请求者：ResType:LockOwner Stype:'OR'Xdes:0x04B511C8 模式： U SPID:60 BatchID:0 ECID:0 TaskProxy:(0x058BE378) Value:0x3d08500 Cost:(0/1296)

节点：2

KEY: 5:72057594042384384 (f903d6d6e0ac) CleanCnt:2 Mode:X Flags: 0x0 Grant List 0: Owner:0x03D088A0 Mode: X Flg:0x0 Ref:0 Life:02000000 SPID:60 ECID:0 XactLockInfo:0x04B511EC SPID:60 ECID: 0 语句类型：DELETE 行号：1 输入缓冲区：语言事件：(@P0 nvarchar(4000))delete from part_data where part_id = @P0 请求者：ResType:LockOwner Stype:'OR'Xdes:0x04834250 模式：U SPID： 62 BatchID：0 ECID：0 TaskProxy：（0x047BA378） 值：0x3d089e0 成本：（0/4588）

受害者资源所有者：ResType：LockOwner Stype：'OR'Xdes：0x04B511C8 模式：U SPID：60 BatchID：0 ECID：0 TaskProxy：（0x058BE378）值：0x3d08500 成本：（0/1296）

SQLServer 探查器将此显示为两个客户端持有更新 (U) 锁并试图升级为独占 (X) 锁。我读过的 SQLServer 文档说，在给定时间，只有一个客户端可以在表上拥有 (U) 锁，所以我想知道为什么我会看到跟踪中显示的情况。

该跟踪中引用的数据库对象是外键上的索引。如果有解决此类问题经验的人可以提供建议，那将是一个很大的帮助。

谢谢，布拉德。

编辑按要求添加了死锁图xml：

```
<deadlock-list>
 <deadlock victim="process989018">
  <process-list>
   <process id="process6aa7a8" taskpriority="0" logused="4844" waitresource="KEY: 5:72057594042384384 (5504bdfb7529)" waittime="9859" ownerId="613553" transactionname="implicit_transaction" lasttranstarted="2009-05-08T11:52:39.137" XDES="0x5fcbc30" lockMode="U" schedulerid="1" kpid="3516" status="suspended" spid="59" sbid="0" ecid="0" priority="0" transcount="2" lastbatchstarted="2009-05-08T11:52:39.183" lastbatchcompleted="2009-05-08T11:52:39.183" clientapp="jTDS" hostname="LOIRE" hostpid="123" loginname="sa" isolationlevel="read committed (2)" xactid="613553" currentdb="5" lockTimeout="4294967295" clientoption1="671088672" clientoption2="128058">
    <executionStack>
     <frame procname="adhoc" line="1" stmtstart="40" sqlhandle="0x0200000007c76c39efdd8317c6fa7b611b4fd958f05cfcf4">
delete from part_data where part_id =  @P0     </frame>
    </executionStack>
    <inputbuf>(@P0 nvarchar(4000))delete from part_data where part_id = @P0</inputbuf>
   </process>
   <process id="process989018" taskpriority="0" logused="1528" waitresource="KEY: 5:72057594042384384 (5e0405cb0377)" waittime="1250" ownerId="613558" transactionname="implicit_transaction" lasttranstarted="2009-05-08T11:52:39.183" XDES="0x48318f0" lockMode="U" schedulerid="2" kpid="2692" status="suspended" spid="60" sbid="0" ecid="0" priority="0" transcount="2" lastbatchstarted="2009-05-08T11:52:39.183" lastbatchcompleted="2009-05-08T11:52:39.183" clientapp="jTDS" hostname="LOIRE" hostpid="123" loginname="sa" isolationlevel="read committed (2)" xactid="613558" currentdb="5" lockTimeout="4294967295" clientoption1="671088672" clientoption2="128058">
    <executionStack>
     <frame procname="adhoc" line="1" stmtstart="40" sqlhandle="0x0200000007c76c39efdd8317c6fa7b611b4fd958f05cfcf4">
delete from part_data where part_id =  @P0     </frame>
    </executionStack>
    <inputbuf>(@P0 nvarchar(4000))delete from part_data where part_id =  @P0</inputbuf>
   </process>
  </process-list>
  <resource-list>
   <keylock hobtid="72057594042384384" dbid="5" objectname="MESSAGESTOREDB61.dbo.part_data" indexname="idx_part_data_part_id" id="lock3cab740" mode="X" associatedObjectId="72057594042384384">
    <owner-list>
     <owner id="process6aa7a8" mode="X"/>
    </owner-list>
    <waiter-list>
     <waiter id="process989018" mode="U" requestType="wait"/>
    </waiter-list>
   </keylock>
   <keylock hobtid="72057594042384384" dbid="5" objectname="MESSAGESTOREDB61.dbo.part_data" indexname="idx_part_data_part_id" id="lock3cad340" mode="X" associatedObjectId="72057594042384384">
    <owner-list>
     <owner id="process989018" mode="X"/>
    </owner-list>
    <waiter-list>
     <waiter id="process6aa7a8" mode="U" requestType="wait"/>
    </waiter-list>
   </keylock>
  </resource-list>
 </deadlock>
</deadlock-list> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-11T12:48:41.457

欢迎来到可怕。

上次我遇到这样的情况是因为更新或删除无法找到一个好的索引来帮助它隔离它正在影响的行。这导致了不稳定的锁定升级，因为它使用非覆盖索引来修改定位记录。

因此，如果您可以隔离一些查询，请检查它们的 sql 并查看您是否无法尝试提供一些覆盖索引。

覆盖索引是包含特定 where 子句中所有字段的索引。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T13:37:10.533

SQLServer 上的死锁几乎总是源于单个线程尝试使用两个连接和两个事务进行写入和读取的事实。如果您想完成这项工作，请使用 ONE 连接在单个线程中执行所有操作，并绝对确保您确实在重新使用该连接。这可能是由于您的应用程序中的分层您在事务期间意外使用不同的连接进行读取，这使得读取等待其他代码（使用另一个连接）完成，因为读取永远不会完成，因此永远不会发生。

示例（伪步骤）

开始反式

*   将数据（例如 INSERT、UPDATE）写入表 Foo
*   *使用不同的*连接死锁从 Foo 读取一些数据（触发表扫描），因为读取永远不会完成，因此永远不会提交事务

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-05T23:44:12.570

首先不要使用提示，通常 SQL Server 最好自己留下。

其次，验证您没有真正的死锁（但死锁外观可以暗示这种情况发生的频率要低得多）。

第三，正如有人建议的那样，检查您是否有一些缓慢的查询并对其进行调整。

根据我的经验**，每次**客户报告死锁情况时，都会发生这种情况，因为运行缓慢的查询会升级，而从来没有真正的死锁，调整查询或添加特定索引**总是**可以解决问题。

我看不出您在谈论哪个版本的 SQL Server，但每个后续版本都比前一个版本具有更好的死锁管理，并且 SQL Server 2000 在这个主题中特别讨厌。

问候
马西莫

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T13:07:00.560

我假设你运行了类似的东西：DBCC TRACEON(1222,-1)”和/或“DBCC TRACEON(1204,-1)。我发现 SQLServer 日志中的死锁跟踪很难阅读。您确定这是升级到独占 (X) 锁的尝试吗？

尝试在分析器中运行跟踪（选择空白模板），选择“死锁图事件”，然后在出现的新选项卡（事件提取设置）上，保存每个（选中“分别保存死锁 XML 事件”）自己的文件。在 xml 查看器中打开这个文件，很容易知道发生了什么。每个进程都包含在内，带有过程/触发器/等调用的执行堆栈等，所有锁也都在其中。我很难相信 col=@value 的两个 DELETE 导致了问题，看看执行堆栈，是否有触发器或其他事情发生？

查看文件的“资源列表”部分，它将显示导致死锁的每个进程正在锁定和持有的内容。弄清楚如何不锁定其中之一，死锁将得到解决。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-20T18:36:01.037

> ...我决定使用 UPDLOCK 提示对有问题的表进行所有读取以“进行更新”，这样就可以避免死锁...
> 
> ...是的，声明了一个事务，以确保在出现错误时删除整个对象图或保持原样。事务中没有其他数据库操作，在事务启动之前完成了一些读取，但其中没有......

我不确定我是否理解在事务之外升级读锁的原因，我认为这只会加剧问题。我的经验是，先发制人地指定锁定提示弊大于利。

话虽如此...

听起来您正在尝试删除每个事务中的多行，并且正在发生死锁，因为 SQL 正在升级每个事务的表上的锁定级别。请记住，在 SQL Server 行中，键范围和页面锁都立即升级为表锁。如果您有多个事务删除多行，他们将尝试升级并且您将遇到死锁。

如果您有很多用户，但尝试在您的删除语句中指定 TABLOCK 提示并查看问题是否消失，这将降低性能。

还可以查看 SQL 语句的执行计划，了解锁升级是如何发生的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-27T14:54:09.637

多年前，我在一张以每天超过 10 亿笔交易为目标的桌子上遇到了同样的问题。

我们有四个 tomcat 服务来处理一个网站的查询。有时，两个不同的服务试图处理相同的查询，当网站流量最低时出现。第一个查询的删除操作锁定了 IX，同时执行的第二个查询也在做同样的事情。

我们通过创建一个缓冲表来处理这个问题。删除操作存储在该表中。每秒钟，一个 sql 作业读取该表以删除标记为“待删除”的行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-11-30T09:24:37.130

First of all it is two delete statements. These two SPIDs are executing the same statement

`delete from part_data where part_id = @P0`

and probably they wont be trying to delete the same record. Here deadlock happens because SQLServer cannot identify the row/rows from the table `part_data` using column `part_id` and it is locking other records also.

So you have two options

1.  Make `part_id` its primary key (if possible)

    or

2.  Alter the statement as follows. (Assuming that there is a primary key)

    `Select primary_key into #temp From part_data where part_id = @p0`

    -- you will get the primary key of those records that are to be deleted

    `delete a from part_data a join #temp b on a.primary_key = b.primary_key`

-- You can delete those record which are to be deleted without locking other records

# wpf - 如何在 WPF 中获取顶部对象（窗口或页面）？

> ID：838825
> 
> 赞同：34
> 
> 时间：2009-05-08T08:37:43.040
> 
> 标签：wpf, wpf-controls

在我的自定义 WPF 控件中，我想获得一个包含窗口或页面。当控件位于窗口应用程序中时，Window.GetWindow() 方法工作正常，但当它位于浏览器的 XBAP 应用程序中时，它返回浏览器窗口而不是页面。

有没有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2013-05-01T20:27:50.970

这对我有用：

```
Window parentWindow = Window.GetWindow(this); 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2010-08-11T21:52:23.407

```
var parent = VisualTreeHelper.GetParent(this);
while (!(parent is Page))
{
    parent = VisualTreeHelper.GetParent(parent);
}
(parent as Page).DoStuff(); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-08T13:58:38.750

您可以使用 VisualTreeHelper 类来检索顶级控件：

```
DependencyObject GetTopLevelControl(DependencyObject control)
{
    DependencyObject tmp = control;
    DependencyObject parent = null;
    while((tmp = VisualTreeHelper.GetParent(tmp)) != null)
    {
        parent = tmp;
    }
    return parent;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-02T20:47:55.900

我认为最好的方法是

```
var obj = VisualTreeHelper.GetParent((DependencyObject)Content); 
```

# php - APC 不推荐用于生产？

> ID：838827
> 
> 赞同：2
> 
> 时间：2009-05-08T08:37:52.477
> 
> 标签：php, apache, caching, apc

我的 VPS 开始出现问题，无法在所有网站上提供页面。它只是显示一个空白页面，或者提供下载 php 文件（幸运的是代码不在下载文件中:)）。服务器仍在运行，但这似乎是 PHP 的问题，因为我可以登录 WHM。

如果我重新启动了 apache，这些站点将再次运行。

在与服务器支持人员交谈后，他们告诉我这是 APC 扩展女巫的问题，他们认为这是旧的，不推荐用于生产服务器。所以他们暂时删除了它，看看是否会继续出现同样的失败。

我还没有在任何地方读到 APC 可能存在一些问题或者它并不总是推荐使用，恰恰相反......人们总是说要始终使用它。

APC 扩展是通过 ssh 安装的，并且是最新版本。

**编辑：** 他们也不推荐 MemCache 并说更可靠的扩展是 eAccelerator

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-08T08:42:08.223

Um APC 是当前的技术，几乎是任何高性能 PHP 站点的必备工具。

不仅如此，它还将在 PHP 6 中作为**标准**发布（而不是像现在这样的可选模块）。

我不知道您的问题是什么，但不是 APC 过时或技术过时。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T09:07:40.220

我自己运行了几台服务器，唯一一次遇到 APC 问题是在尝试与 Zend Optimizer 同时运行它时。它们不能一起工作，所以如果我必须使用优化器（比如某些商业、第三方代码需要它），我会运行 eAccelerator 而不是 APC。在性能方面，实际上是 6 个，6 个，但我真的怀疑 APC 是这里的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-08T18:28:57.337

补充一点，memcached 只有在您运行多个需要访问共享数据缓存的服务器时才会让您受益匪浅。Memcached 不像 APC/eAccelerator/Xcache/etc 那样做操作码缓存。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-25T21:36:32.960

问题与 APC 无关。如果 APC 有问题，它要么出现在您的 php 日志文件中，要么在您调整 APC 之前您根本无法访问您的网站。问题更可能与 apache 本身有关。我之前在空白页面上遇到过与您相同的问题，这与 mod_security 播放并阻止发送看起来“可疑”的页面有关。此外，apache 中的内存使用很适合在负载下杀死服务器。我也曾使用过一个 web 主机，它编译 apache 时出现内存泄漏，所以每 X 次请求（比如 100,000 个）服务器就会崩溃！最烦人。

您的网络主机听起来不是最有能力的，因为他们给出了一些不好的建议，很可能是基于无知。

APC 应该在生产中使用（在生产中关闭 mstat 检查，但在开发中打开）。您可以通过加载随附的 apc 状态文件来获取有关您的 apc 设置的更多统计信息，并且您会得到一个不错的页面，如下所示：[http ://drupal.org/files/images/APC%20Status-1.png](http://drupal.org/files/images/APC%20Status-1.png)

Memcache 被大量使用，因为它也是分布式的！这样的用途如下：

1.  APC 是最快的，因为它与 php 最接近，但仅适用于执行 PHP 本身的同一台服务器，因此它的使用仅限于该范围。主要用作操作码缓存。

2.  Memcache 就像一个非常快速的数据库，分布在作为一个单元工作的许多计算机上。然而，停电会抹去很多！因此，为什么它们被大量用于从持久数据库中删除压力。Facebook 和许多其他网站有数百台运行 memcache 的服务器。

我的建议是找一个了解 PHP 的网络主机。与网络主机战斗是关于谁对谁错的艰苦工作......直到你找到一个好的;）

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-08T08:44:34.690

在我看来，他们正在推销一种可能有推荐回扣的产品。

我运行自己的服务器（有一段时间），我从来没有遇到过这个问题，MemCache 没有任何**重大**问题。

# xaml - 如何让 ListBox ItemTemplate 水平拉伸 ListBox 的整个宽度？

> ID：838828
> 
> 赞同：375
> 
> 时间：2009-05-08T08:37:56.843
> 
> 标签：xaml, listboxitem

我想让 ListItems 用它们的橙色背景扩展 Listbox 的整个宽度。

目前，它们仅与 FirstName + LastName 一样宽。

我已经将每个元素都设置为：Horizo​​ntalAlignment="Stretch"。

我希望 ListboxItems 的背景随着用户拉伸列表框而扩展，所以我不想输入绝对值。

**我该怎么做才能使 ListBoxItems 的背景颜色填充 ListBox 的宽度？**

```
<Window x:Class="TestListBoxSelectedItemStyle.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:TestListBoxSelectedItemStyle"
    Title="Window1" Height="300" Width="300">

    <Window.Resources>
        <local:CustomerViewModel x:Key="TheDataProvider"/>

        <DataTemplate x:Key="CustomerItemTemplate">
            <Border CornerRadius="5" Background="Orange" HorizontalAlignment="Stretch" Padding="5" Margin="3">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Width="Auto">
                    <TextBlock HorizontalAlignment="Stretch">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="{}{0} {1}">
                            <Binding Path="FirstName"/>
                            <Binding Path="LastName"/>
                        </MultiBinding>
                    </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
            </Border>
        </DataTemplate>

    </Window.Resources>

    <Grid>
        <ListBox ItemsSource="{Binding Path=GetAllCustomers, Source={StaticResource TheDataProvider}}"
                 ItemTemplate="{StaticResource CustomerItemTemplate}"/>
    </Grid>
</Window> 
```

* * *

## 回答 #1

> 赞同：661
> 
> 时间：2010-05-27T19:30:46.520

我在[这里找到了另一个解决方案](https://stackoverflow.com/questions/746190/silverlight-3-listbox-datatemplate-horizontalalignment)，因为我遇到了两个帖子......

这是来自迈尔斯的回答：

```
<ListBox.ItemContainerStyle> 
    <Style TargetType="ListBoxItem"> 
        <Setter Property="HorizontalContentAlignment" Value="Stretch"></Setter> 
    </Style> 
</ListBox.ItemContainerStyle> 
```

这对我有用。

* * *

## 回答 #2

> 赞同：503
> 
> 时间：2009-05-08T08:44:12.617

我确定这是重复的，但我找不到具有相同答案的问题。

添加`HorizontalContentAlignment="Stretch"`到您的列表框。这应该够了吧。请注意自动完成，因为它很容易`HorizontalAlignment`出错。

* * *

## 回答 #3

> 赞同：78
> 
> 时间：2012-08-23T16:44:00.010

如果您的项目比**更宽**`ListBox`，这里的其他答案将无济于事：`ItemTemplate`仍然比`ListBox`.

对我有用的解决方法是禁用水平滚动条，显然，它还告诉所有这些项目的容器保持与列表框一样宽。

因此，获得与列表框一样宽的列表框项目的组合修复，无论它们更小并且需要拉伸，还是更宽并且需要换行，如下所示：

```
<ListBox HorizontalContentAlignment="Stretch" 
         ScrollViewer.HorizontalScrollBarVisibility="Disabled"> 
```

（[滚动条创意的学分](https://stackoverflow.com/a/9156695/33080)）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-08T22:53:16.947

由于边框仅用于视觉外观，您可以将其放入 ListBoxItem 的 ControlTemplate 并在那里修改属性。在 ItemTemplate 中，您只能放置 StackPanel 和 TextBlock。这样，代码也保持干净，因为控件的外观将通过 ControlTemplate 控制，而要显示的数据将通过 DataTemplate 控制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-17T13:02:43.263

`HorizontalAlignment="Stretch"`对我来说，解决方法是在`ItemsPresenter`内部设置属性`ScrollViewe`..

希望这可以帮助某人...

```
<Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListBox">
                    <ScrollViewer x:Name="ScrollViewer" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Foreground="{TemplateBinding Foreground}" Padding="{TemplateBinding Padding}" HorizontalAlignment="Stretch">
                        <ItemsPresenter  Height="252" HorizontalAlignment="Stretch"/>
                    </ScrollViewer>
                </ControlTemplate>
            </Setter.Value>
        </Setter> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-10-17T10:33:18.797

我也遇到了同样的问题，作为一种快速解决方法，我使用 blend 来确定添加了多少填充。就我而言，它是 12，所以我使用负边距来摆脱它。现在一切都可以正确居中

# php - 使用 vprintf 进行廉价的 php 模板？

> ID：838843
> 
> 赞同：2
> 
> 时间：2009-05-08T08:41:38.863
> 
> 标签：php, function, templates, templating

好的，所以 printf/sprint/vprintf 都接受某种类型说明符语法 %[num][type]。（[http://us2.php.net/sprintf](http://us2.php.net/sprintf)参见示例 3 和 4）其中 num 是类型的索引。

示例： vprintf('编号 %1$d 字符串 %2$s。字符串 %2$s, 编号 %1$d',array(1,"no"));

是的，它是有限的......而且您需要维护索引。但它是该语言的原生语言并且（我认为）速度很快。

我只是想知道这将是多么有用，就像这样的第二阶段：[http](http://www.techfounder.net/2008/11/18/oo-php-templating/) ://www.techfounder.net/2008/11/18/oo-php-templating/ 。

（如果有人知道 printf/vprintf 的速度，那将不胜感激）

我正在谈论的完整示例：

前端页面.php：

> `<html>`
> 
> `<head>`
> 
> `<title> %1$s </title>`
> 
> `</head>`
> 
> `<body>`
> 
> `Hello %2$s! You have reached page: %1$s!`
> 
> `</body>`
> 
> `</html>`

不管什么.php：

> `ob_start();`
> 
> `include frontpage.php;`
> 
> `$ob_output = ob_get_clean();`
> 
> `vprintf($ob_output,"Page Title","Bob");`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T09:10:07.813

如果您想要廉价的 PHP 模板，请使用带有 PHP 表达式块的单独文件。可以使用`printf`-style 格式字符串制作模板系统，但我可以看到这种方法存在两个主要问题：速度和可读性。这些`printf`函数旨在用于较短的字符串，虽然我手头没有任何统计数据，但我认为可以肯定地说，在一个表示页面正文的大字符串上运行 a`sprintf()`或 a`vprintf()`将比仅使用 PHP 表达式块慢在一个文件中。

这导致了下一个问题：可读性。比较这两个 HTML 模板：

```
<html>
<head>
   <title>%s</title>
</head>
<body>
<div id="main">
    <h1>%s</h1>
    <p>%s</p>
</div>
<div id="other">
    <p>%s</p>
</div>
<p id="footer">
    %s. Took %.2f seconds to generate.
</p>
</body>
</html> 
```

和

```
<html>
<head>
   <title><?= $title ?></title>
</head>
<body>
<div id="main">
    <h1><?= $header ?></h1>
    <p><?= $body_text ?></p>
</div>
<div id="other">
    <p><?= $misc_info ?></p>
</div>
<p id="footer">
    <?= $copyright ?>. Took <?= $load_time ?> seconds to generate.
</p>
</body>
</html> 
```

或者，假设我决定使用带有索引参数的格式字符串。说，像这样：

```
<h1>%1$s</h1>
<p>%2$s</p>
<span id="blah">%3$s</p>
<p>%4$s</p>
<p>%5$s</p> 
```

现在，如果我想改变顺序怎么办？

```
<h1>%1$s</h1>
<p>%3$s</p>
<span id="blah">%5$s</p>
<p>%4$s</p>
<p>%2$s</p> 
```

这些显然是人为的，但请考虑从长远来看如何维护`printf`模板。

因此，一般来说，如果您想要快速而简单的 PHP 模板，请使用包含 PHP 表达式块的模板文件。这些`printf`函数在处理较小的字符串格式化任务方面要好得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T15:18:33.927

我一般有两个文件：

*   某种控制器（recipes.controller.php 重写为 /recipes/123）
*   控制器的许多视图之一 (recipes.view.html)

我只是在控制器内完成所有逻辑/数据库工作，然后在最后包含适当的视图。视图可以访问控制器中的所有变量，因此我已经创建了 $title、$ingredients[] 等内容。我不太确定为什么人们让它比这更复杂。这很容易遵循。

视图文件基本上看起来像这样：

```
<html>
<head>
<title><?=$title ?></title>
</head>
etc... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T15:19:41.723

PHP 的创建者 Rasmus Lerdorf 更喜欢将他的变量包含在如下内容中：

```
 <select class="f" name="cat" id="f_cat" size="1">
      <option selected>Category</option>
<?php foreach($categories as $cat) echo <<<EOB
      <option value="{$cat}">{$cat}</option>

EOB;
?> 
```

作为参考，`<<<EOB`through`EOB;`是一个[heredoc](http://us3.php.net/manual/en/language.types.string.php#language.types.string.syntax.heredoc)。

资料来源：Rasmus Lerdorf[的无框架 PHP MVC 框架](http://toys.lerdorf.com/archives/38-The-no-framework-PHP-MVC-framework.html)

# php - 无法从 jQuery 获取发布的数组

> ID：838845
> 
> 赞同：0
> 
> 时间：2009-05-08T08:42:28.957
> 
> 标签：php, jquery, ajax, post

我正在尝试使用 jQuery post 方法发布一组数组，但我无法获取数组的值。如何获取已发送的数组的值？如果有人可以帮助我，我将不胜感激......

这是我所做的：

```
 $(document).ready( function()
        {
            $("#submit_info").click (
                function()
                {
                    var batchArr= new Array();
                    batchArr=arrPush('batch');
                    var facultyArr= new Array();
                    facultyArr=arrPush('faculty');
                    var levelArr= new Array();
                    levelArr=arrPush('level');
                    var sectionArr= new Array();
                    sectionArr=arrPush('section');
                    var shiftArr= new Array();
                    shiftArr=arrPush('shift');

                    $.post("server_side/college_info_insert.php",{
                            batchArr:batchArr,
                            facultyArr:facultyArr,
                            levelArr:levelArr,
                            sectionArr:sectionArr,
                            shiftArr:shiftArr
                        }, function(data)
                        {
                            alert(data);
                        });
                }
            );

            function arrPush(opt)
            {
                var Arr= new Array();
                Arr.push($("#"+opt+"_1").val());
                var count= $("#"+opt).val();
                var i=0;
                for(i;i<=count;i++)
                {
                    if(i==0)
                    {
                        Arr.push($("#txt"+opt).val());
                    }
                    else
                    {
                        Arr.push($("#txt"+opt+i).val());
                    }
                }
                return Arr;
            }
        }
    ); 
```

如何在下一页“college_info_insert.php”中获取数组值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-11T09:14:51.090

好的，所以这实际上是一个非常普遍的问题。尚不清楚您不能将数组按原样从 javascript 发送到 PHP 并使其被识别。

问题是 PHP 不知道如何从 POST 请求中读取多个值 - 通常这样的事情需要 PHP 作者使用括号，例如：`varname[]`.

所以，基本上你必须将变量作为字符串发送。使用 JSON，您甚至可以使用单个变量名将复杂的对象作为字符串发送到 PHP。通常你会使用 JSON.stringify 或类似的东西——但如果你有一个简单的数组，你甚至可能不需要它。

这是使用 jquery 和 $.post 找到的问题/解决方案的完整示例：

假设您有一个文件*myurl.php*：

```
<?php
print_r($_POST);
?> 
```

在一个单独的文件（或控制台）中，您尝试：

```
var myarray = Array('some','elements','etc');
var mydata = {postvar1: 'string', postvar2: myarray};
$.post('myurl.php', mydata, function(response) { 
    alert("response: " + response);
}); 
```

**这不行！** 结果是 postvar2 只包含“等”。

解决方案是将数组强制转换为可以从 PHP 解码的 JSON 字符串。

```
var myarray = Array('some','elements','etc');
var json_array = $.map(myarray,function(n) {
    return '"'+n+'"';
});
var mydata = {postvar1: 'string', postvar2: '['+json_array+']' };
$.post('myurl.php', mydata, function(response) { 
    alert("response: " + response);
}); 
```

在 PHP 方面，您现在必须使用：`json_decode($_POST['myarray']);`将结果放入正确的数组中。

请注意，此示例假定数组中有非常简单的字符串或数字。如果您有复杂的对象，您将需要使用 JSON.stringify 函数来处理额外的引号、转义特殊字符等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T08:57:59.760

不确定我是否理解这个问题，但不会像这样工作

```
if (isset($_POST['batchArr'])) {
   $batchArr = $_POST['batchArr'];
   // Then populate your html here e.g
   echo $batchArr[0]; 
```

}

# c# - 多个委托，附加，一个失败

> ID：838852
> 
> 赞同：3
> 
> 时间：2009-05-08T08:44:25.177
> 
> 标签：c#, .net, delegates

我有一个场景，其中我有多个委托附加到事件（多播委托）。

调用这些方法/委托（如果有的话）的顺序是什么？？？

如果委托附加的方法之一引发异常。

1.  事件是否会进一步停止处理......？？？
2.  其余的附加方法会继续吗……？？？

我不清楚如何处理这种情况。

非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T08:50:54.863

是的，引发异常的事件处理程序将停止进一步执行，并且异常将传播调用堆栈。这意味着*不会*调用任何后续事件处理程序。如果您想保证在引发事件的类中调用每个事件处理程序，那么您需要遍历 中的每个委托`MulticastDelegate`并在 try-catch 块中单独调用它。当然，简单的解决方案就是在处理程序中捕获任何可能的错误，我想说这在大多数情况下是可取的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T04:43:15.183

多播委托中的方法可以按任意顺序调用。（通常，它们按照添加到委托的顺序被调用。但这并不总是正确的。）因此，程序员不应该依赖于调用顺序。

您需要使用 delegatename.GetInvocationList() 遍历多播委托中的所有方法，并在循环内使用 try catch 块来捕获异常并继续下一个方法调用。

请参阅这篇[文章](http://msdn.microsoft.com/en-us/vcsharp/bb508935.aspx)，了解如何确保在少数情况下调用其余方法。

# c# - 域策略对象

> ID：838858
> 
> 赞同：1
> 
> 时间：2009-05-08T08:46:09.557
> 
> 标签：c#, active-directory

我正在尝试检查 AD 中的锁定帐户。在一些代码片段中，例如[http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/5e0fadc2-f27b-48f6-a6ac-644e12256c67/](http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/5e0fadc2-f27b-48f6-a6ac-644e12256c67/)，代码使用的是 DomainPolicy 对象，如：

```
DirectoryContext context;
  DirectoryEntry root;
  DomainPolicy policy;

  public Lockout(string domainName)
  {
    this.context = new DirectoryContext(
      DirectoryContextType.Domain,
      domainName
      );

    //get our current domain policy
    Domain domain = Domain.GetDomain(this.context);

    this.root = domain.GetDirectoryEntry();
    this.policy = new DomainPolicy(this.root);      
  } 
```

我正在使用 C#3.0 和 .NET 框架 3.5，但我似乎找不到 DomainPolicy 对象，它在哪里？我看过了，它似乎是 HostSecurityManager 的只读属性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T08:59:09.493

这是[此处](http://www.informit.com/articles/article.aspx?p=474649&seqNum=3)描述的自定义类。它不是框架的一部分。

# windows - 使用批处理脚本最小化或关闭程序

> ID：838862
> 
> 赞同：0
> 
> 时间：2009-05-08T08:47:57.087
> 
> 标签：windows, batch-file

我正在编写一个批处理脚本，用于处理我（和一些同事）Windows 启动中的一些任务。需要发生的主要事情是默认启动一些对大型企业环境有影响的进程。他们干扰了我们的工作，所以我们必须杀了他们……我知道这很愚蠢，但那不是重点。这是无法改变的，我们必须做出应得的。

我考虑在脚本中添加一些更有用的功能，比如启动某些程序等等。这一切都很好，但我遇到的问题是 OUClient 不会开始最小化。它不会打开一个窗口（因此它在某种程度上被最小化）但它仍然出现在 alt-tab 列表中，当我手动最小化或关闭它时它不会出现。这是脚本：

```
@echo off
C:
cd "C:\Program Files\SysInternals\"

pskill flxps12.exe
pskill flxps17.exe

start /minimized "" "C:\Program Files\Osiris Data\OUClient\OUClient.exe"
start "Outlook" "C:\Program Files\Microsoft Office\OFFICE11\OUTLOOK.EXE"
start "Explorer" "C:\Program Files\Internet Explorer\iexplore.exe"

cls
@exit 
```

所以问题是：**如何使 OUClient 在启动后最小化，甚至更好地靠近**系统托盘（就像您单击右上角的红色 x 一样）。

我们在 Windows XP SP2 上运行它。

**编辑：**除 OUClient 上的 /minimize 外，一切正常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T09:05:50.287

没有办法直接从批处理文件中执行此操作，但您可以编写一个小帮助程序，它会[找到一个窗口](http://msdn.microsoft.com/en-us/library/ms633499.aspx)，然后使用[ShowWindow](http://msdn.microsoft.com/en-us/library/ms633548.aspx)将其最小化。不幸的是，这似乎并不容易从 VBScript 中获得，这会使这变得更容易一些。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T08:52:56.107

`minimized`开关有一个正斜杠，而不是一个反斜杠。

我不知道 OUClient 是否会尊重这一点，但它应该。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-08T08:53:34.967

你看过 TASKKILL 命令吗？一个基本的例子是

> TASKKILL /IM /F iexplore.exe

（是的，谁不想杀死 iexplore？;-)）

最好的。

# php - 使用 http-header 强制下载字符串

> ID：838864
> 
> 赞同：2
> 
> 时间：2009-05-08T08:48:13.513
> 
> 标签：php, string, http-headers

我的功能有问题。我的函数的目的是强制下载一个字符串。真正发生的是字符串被输出到屏幕而不是下载。

这是我的功能：

```
function arrayToCSV($vectorDados, $cabecalho)
{
    $arr = array();
    $arr=$vectorDados;

    $csv = $cabecalho . "\n";
    foreach($arr as $row) {
        $csv .=$row[0] . "  " .  $row[1] . "    ". $row[2] . "  " .$row[3] . "  \n";
    }
    $filename = "emails_".date("Y-m-d_H-i",time());

    header ("Content-Type: application/octet-stream");
    header ("Content-disposition: attachment; filename=".$filename.".csv");
    print $csv;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T09:44:47.200

问题不在于功能。

通过将[ob_start()](http://br.php.net/manual/en/function.ob-start.php)添加到主代码中，现在我可以下载我的字符串了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T08:50:15.693

尝试使用大写 D 的 Content-Disposition。

（内容类型可能是 text/csv）

# wpf-controls - 在 WPF 的嵌套列表视图中应用样式

> ID：838868
> 
> 赞同：0
> 
> 时间：2009-05-08T08:48:42.123
> 
> 标签：wpf-controls

我在列表视图中有一个 listivew，我正在显示主详细信息类型的关系。

我可以将父 listviewitem 的行颜色应用于子 listviewitem 吗？

请回复..

谢谢

沙拉特

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T10:17:04.547

Found the solution

Background="{Binding Background, RelativeSource={RelativeSource FindAncestor, AncestorType=ListViewItem}}"

Thanks

Sharath

# php - 从 PHP 调用外部 shell 脚本并向其发送一些输入

> ID：838870
> 
> 赞同：1
> 
> 时间：2009-05-08T08:49:06.757
> 
> 标签：php, shell

我的目标是从 PHP 程序调用 shell 脚本，然后等待几秒钟向它发送一些终止密钥（我不能简单地杀死它，因为我想测试终止阶段的正确执行）。

这是我想要的一个例子：

```
system( "RUNMYSCRIPT.sh" );  // Launch the script and return immediately.
sleep( 10 );                 // Wait.
exec( "q" );                 // Send a termination key to the previous script? 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T09:00:58.350

您需要使用[proc_open()](http://php.net/manual/en/function.proc-open.php)才能与您的进程进行通信。您的示例将像这样工作：

```
// How to connect to the process
$descriptorspec = array(
   0 => array("pipe", "r"),
   1 => array("pipe", "w")
);

// Create connection
$process = proc_open("RUNMYSCRIPT.sh", $descriptorspec, $pipes);
if (!is_resource($process)) {
    die ('Could not execute RUNMYSCRIPT');
}

// Sleep & send something to it:
sleep(10);
fwrite($pipes[0], 'q');

// You can read the output through the handle $pipes[1].
// Reading 1 byte looks like this:
$result = fread($pipes[1], 1);

// Close the connection to the process
// This most likely causes the process to stop, depending on its signal handlers
proc_close($process); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T09:03:01.560

您不能简单地将按键事件发送到这样的外部应用程序。[可以使用proc_open()](http://www.php.net/manual/en/function.proc-open.php)而不是 system()来写入外部 shell 脚本的标准输入，但大多数 shell 脚本直接监听击键而不是观察标准输入。

你可以做的是使用信号。几乎所有的 shell 应用程序都会响应 SIGTERM 和 SIGHUP 等信号。也可以使用 shell 脚本来捕获和处理这些信号。如果你使用 proc_open() 来启动你的 shell 脚本，那么你可以使用[proc_terminate()](http://www.php.net/manual/en/function.proc-terminate.php)来发送一个 SIGTERM 信号。

# html - 用嵌入的视频替换图像

> ID：838878
> 
> 赞同：4
> 
> 时间：2009-05-08T08:52:07.373
> 
> 标签：html, image, video, webpage, video-embedding

您好我正在尝试修改网页以使其加载速度更快。由于我嵌入了一些视频（blip.tv，但如果有帮助可以将其更改为 youtube），我想知道您是否可以在视频应该放置的位置加载图像，然后单击将图像替换为视频并开始播放（无需重新加载整页）。我想我以前见过这个，但再也找不到它了！现在我使用的嵌入代码是：

```
<object data="http://blip.tv/play/gYMo_vAmAA" type="application/x-shockwave-flash" height="500" width="600"><param name="src" value="http://blip.tv/play/gYMo_vAmAA"><param name="allowfullscreen" value="true"></object> 
```

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T09:12:54.780

又快又脏：您可以在某处将嵌入代码设置为全局变量：

```
<script type="text/javascript">
    var embedCode = '<object data="http://blip.tv/play/gYMo_vAmAA" type="application/x-shockwave-flash" height="500" width="600"><param name="src" value="http://blip.tv/play/gYMo_vAmAA"><param name="allowfullscreen" value="true"></object>'
</script> 
```

然后把图片放到一个容器的div中，替换容器的innerHTML onclick：

```
<div id="videocontainer">
    <img src="yourimage.jpg" onclick="document.getElementById('videocontainer').innerHTML = embedCode;" height="500" width="600" />
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T09:29:27.923

有一个名为 SWFObject 的 Google 代码项目，非常适合您的需要。这是一个用于加载 Flash 的跨浏览器 javascript 库 - 例如，当有人单击图像时，您可以使用它用 Flash 视频替换您的图像。

# jquery - 如何使用jQuery选择html页面中第一个表的第一行？

> ID：838880
> 
> 赞同：20
> 
> 时间：2009-05-08T08:52:58.680
> 
> 标签：jquery, css-selectors

假设如果我的 HTML 页面中有多个表（没有它们的 'id' 属性），那么如何使用 jQuery 选择器选择第一个表的第一行或任何特定表？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-08T08:55:28.097

```
$("table:first > tr:first") 
```

或者

```
$("table:first").find("tr:first") 
```

或者

```
$("table:first").children("tr:first") 
```

或者

```
$("table").eq(0).children("tr").eq(0) 
```

所以，如果我理解后续问题......

```
$("table:eq(1) tr:has(table:eq(2))") 
```

转换为：如果 tr 有第三张表，则在第二张表中获取任何 tr

或者

```
$("table").eq(1).children("tr:has(table:eq(2))") 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T10:30:06.140

Something you can use to select the nth row in the nth table:

```
$("table:eq(n) tr:eq(n)") 
```

with n being the zero based index of the table or tr.

Example:

```
$("table:eq(2) tr:eq(4)") 
```

gets the 5th row of the 3rd table.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-21T10:27:30.300

@svinto 的回答绝对是完成此任务的最短、最快和最简单的方法。如果您*真的*关心性能（例如，在任意复杂*的 for*循环中选择），这很可能会更快一点：

```
$('tr').eq(0) 
```

如果你不需要*只*使用jQuery 选择器并且实际上需要 DOM`<TR>`元素，你可以使用：

```
$('table')[0].rows[0] 
```

或者：

```
$('tr')[0] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T09:59:58.583

使用 jQuery 的`eq()`方法，您可以指定要获取的元素的索引。
这将选择在 DOM 中找到的第二个表的第一行

```
$('table:eq(1) tr:first') 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T10:12:14.933

```
$("tr:first"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T09:50:18.043

[虽然不是 jQuery 特定的，但我在这个w3c 选择器页面上](http://www.w3.org/TR/css3-selectors/#structural-pseudos)被介绍了 dom 选择器。它非常详细，但充满了复杂的例子。

# vb.net - 异常处理差异问题

> ID：838881
> 
> 赞同：0
> 
> 时间：2009-05-08T08:53:11.880
> 
> 标签：vb.net, exception, exception-handling

可以捕获一个异常并抛出一个新异常，它将第一个异常包装为内部异常：

[http://msdn.microsoft.com/en-us/library/system.exception.innerexception(VS.71).aspx](http://msdn.microsoft.com/en-us/library/system.exception.innerexception(VS.71).aspx)

另外，如果我调用一个函数并且它抛出了某个错误，但我捕获了它，调用代码的捕获处理程序会执行吗？如果是这样，并且它是更高的异常类型，这不是包装异常吗？

例如，我可以抛出 IndexOutOfRange 类型的异常 ex，记录它但重新抛出，捕获更高的异常并执行某些操作，或者我可以抛出一个新异常并包装一个内部异常，例如：

throw new MyException("一些错误", ex.InnerException)

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T08:59:01.397

1.  是的，你可以抛出一个包装第一个函数的异常

2.  另外，如果我调用一个函数并且它抛出了某个错误，但我捕获了它，调用代码的捕获处理程序会执行吗？

不。

3.  如果是这样，并且它是更高的异常类型，这不是包装异常吗？我不太明白这个，但它看起来像原始意义上的 Wrapper 一词。

# shell - 在自动备份脚本中处理登录

> ID：838885
> 
> 赞同：2
> 
> 时间：2009-05-08T08:54:13.327
> 
> 标签：shell, mercurial, login, backup, dvcs

我需要编写一个 shell 脚本来安排每天运行以使用 mercurial 备份目录。我已经完成了大部分用例，除了我可以找到一种在脚本运行时进行自动登录的方法。

```
for REPOSITORY in $@ 
do
    cd $REPOSITORY

    # commit the changes
    hg commit -A -m "Commit changes `date`"

    # push the changes to the remote repository
    if hg push 
    then
        logger hg push success
    else
        logger hg push failure
    fi
done 
```

发出 hg push 命令后会显示登录提示。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-24T15:18:49.907

我同意您应该为非交互式登录配置备份脚本。一种方法是[使用 SSH 密钥](http://hgbook.red-bean.com/read/collaborating-with-other-people.html#sec:collab:ssh)，更简单的解决方案是将密码直接包含在 URL 中。

Mercurial 1.3 使在配置文件中包含 HTTP 密码变得更加容易。我现在有一个

```
[auth]
bb.prefix = https://bitbucket.org/mg/
bb.username = mg
bb.password = pw 
```

我的配置文件中的部分。这意味着您可以避免将密码存储在多个文件中，而只专注于保护一个文件。

事实上，我正在使用另一个新功能来避免输入密码`~/.hgrc`，因为我可能想向其他人展示该文件。相反，我有

```
%include .hgauth 
```

在上面的部分中`~/.hgrc`，我一个人可以阅读。`~/.hgauth``[auth]`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T09:13:13.937

Mercurial 允许您将用户名和密码放入存储库 URL：

```
hg push http://username:password@hg.myco.com/repo 
```

如果您不想将 URL 放在命令行上，您可以编辑[`hgrc`](http://www.selenic.com/mercurial/hgrc.5.html)本地存储库的文件并将用户名和密码放在`default-push`URL 中：

```
default-push = http://username:password@hg.myco.com/repo 
```

这意味着任何人`hg push`都将使用`hgrc`文件中指定的用户名。

# java - 用于 Java 持久性的 JPA 或 Hibernate？

> ID：838890
> 
> 赞同：13
> 
> 时间：2009-05-08T08:55:27.240
> 
> 标签：java, hibernate, jpa, persistence

我正在研究 Java、.NET 和 Groovy 中企业应用程序的开发。对于每个平台，我们将尝试实现一个简单的 SOAP Web 服务有多难。我们将使用最常用的工具和库来尽可能准确地研究现实世界。

对此，在使用 Hibernate 进行持久化时，是使用新的 JPA（Java Persistence API）还是使用 JPA 出现之前存在的 Hibernate 自定义 API 会更好地反映现实世界？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-08T09:36:28.967

您可能已经知道，从 3.2 开始，Hibernate 已通过 JPA 认证。您可以轻松地将 Hibernate 用作您的 JPA 提供程序，而无需使用任何 Hibernate 的“自定义”API。

我建议使用 Hibernate 作为提供者的直接 JPA。并使用注释而不是 XML（更好）。

然后，当您需要一些额外的东西时，您总能获得 Hibernate Session。例如，我经常发现我需要这样做才能将集合作为参数 (setParameterList) 传递给查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-09T00:16:18.297

你问问题的措辞很有趣

> *新的*JPA ...或*普通的旧*Hibernate

听起来一个已经永远存在，另一个刚刚被释放。当然这不是真的。JPA 不仅受到 Hibernate 的影响，还受到 TopLink 和 J2EE 实体 bean 的影响。对 JSR 220 草案的第一次引用是从 2003 年开始的——新的怎么样？如果您将 JPA 与 Hibernate 一起使用，您仍然可以使用 Hibernate，并且可以免费应用 Hibernate 拥有的任何专有扩展。

因此，您可以选择：使用专有 API 或使用等效的已建立和标准 API...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-12T18:26:56.297

你可以坚持使用纯 JPA 规范，以防万一你想换掉 Hibernate，但你可能会发现在某些时候你永远不会换掉它，而且你已经错过了所有非常棒的 Hibernate 特有的特性。

我建议直接使用 Hibernate，正如 Damo 建议的那样，使用注释而不是 XML。确保你对 Hibernate 带来的“魔力”有一个深刻的理解。如果您不小心，您可能真的会破坏数据库。例如，有一个 n+1 查询问题，具体取决于您如何进行 @OneToOne 连接：

[Hibernate OneToOne 自动join fetching（解决n+1问题）](https://stackoverflow.com/questions/7025583/hibernate-onetoone-automatic-join-fetching-resolving-n1-problem)

我还建议使用嵌入式数据库对您的 Hibernate 查询进行单元/集成测试，并观察生成的 SQL 以确保它看起来像您手写的内容。

# c# - C#，从引用的项目中访问类

> ID：838892
> 
> 赞同：2
> 
> 时间：2009-05-08T08:55:41.903
> 
> 标签：c#, design-patterns, inheritance, types, reference

在 C# 中，我正在开发几个具有一些标准功能的 Windows 服务，因此我将所有这些通用功能放入一个单独的引用实用程序项目中。

我有一种情况，我需要使用 Activator.CreateInstance 从实用程序项目创建驻留在我的 Windows 服务项目中的业务类实例。

我的实用程序项目知道 Type.GetType 调用的命名空间和类名，但类型始终为 null，当我考虑它时，它将无法从它引用的项目中获取类型，或者可以它？

简而言之：

项目 A 引用实用程序项目。
Utility Project 想要从 Project A 创建类，它知道命名空间和类名。

是否有我应该遵循的设计模式或方法来实现此功能？或者这看起来像不，不，我应该重构？

感谢您的关注

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T09:04:26.313

正如 Jon 指出的那样，您可以使用反射解决循环引用问题，但我建议重新考虑设计并重构它。两个建议。

*   使用接口对 A 和 B 进行十进制。（首选解决方案）
*   将 A 和 B 需要的部分移动到 C 中，并仅从 A 和 B 中引用 C。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T08:57:31.930

如果要`Type.GetType`查找既不在其中`mscorlib`也不在调用程序集中的类型，则需要指定完全限定的程序集名称（包括版本等，如果它是强命名的）。

例如：

```
// Prints nothing
Console.WriteLine(Type.GetType("System.Linq.Enumerable"));
// Prints the type name (i.e. it finds it)
Console.WriteLine(Type.GetType("System.Linq.Enumerable, System.Core, "
     + "Version=3.5.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089")); 
```

或者，您能否在实用程序项目中将此作为通用方法，并让调用者将类型指定为类型参数？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T09:03:56.737

您可以查看依赖注入/ioc 容器。

例如，在实用程序库中创建一个接口并在 Windows 服务的特定类中实现该接口。然后将实例传递给实用程序类。这样，实用程序库对 Windows 服务一无所知。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T08:58:11.010

听起来像一个循环引用问题！你可能需要重构！

# iphone - 我的 NSDateFormatter 仅适用于 iPhone 模拟器

> ID：838893
> 
> 赞同：2
> 
> 时间：2009-05-08T08:56:03.480
> 
> 标签：iphone, objective-c, cocoa, date

我使用 NSDateFormatter 在模拟器中运行良好，但是当我在 iPhone 中运行它时我得到一个 nil。我硬编码了日期以确保格式，但无论如何它都失败了。

```
NSString *strPubDate = @"Fri, 8 May 2009 08:08:35 GMT";
NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];
[dateFormatter setFormatterBehavior:NSDateFormatterBehavior10_4];
[dateFormatter setDateFormat:@"EEE, d MMM yyyy HH:mm:ss Z"];

NSDate *myDate = [dateFormatter dateFromString:strPubDate]; 
```

我在 iPhone 上尝试了不同的区域设置、语言等。知道出了什么问题吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-10-02T12:52:19.847

此代码似乎可以针对“GMT”标签正常工作。

```
NSString *strPubDate = @"Fri, 8 May 2009 08:08:35 GMT";
NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];
[dateFormatter setDateFormat:@"EEE, d MMM yyyy HH:mm:ss zzzz"];
NSDate *myDate = [dateFormatter dateFromString:strPubDate]; 
```

[RFC822 日期和时间规范](http://asg.web.cmu.edu/rfc/rfc822.html#sec-5)使用了一些“区域”标签，我找到了正确的符号来解析[iPhone NSDateFormatter 的“GMT”标签格式字符串](http://www.stepcase.com/blog/2008/12/02/format-string-for-the-iphone-nsdateformatter/)

*   z~zzz：（特定 GMT 时区缩写）
*   zzzz：（特定 GMT 时区名称）
*   Z：+0000（RFC 822 时区

感谢你的帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T09:07:40.487

如果您需要使用特定的日期格式，您可能希望“手动”解析它，而不是使用`NSDateFormatter`. 它的行为确实会根据语言环境等发生变化，并且存在一些错误，特别是当您的字符串中有时区时。

话虽如此，找出问题所在的一种选择可能是使用该`getObjectValue:forString:range:error:`方法而不是`dateFromString:`. 通过这种方式，您可以获得一个`NSError`（理论上）可以告诉您问题所在的对象。

顺便说一句，你不需要这`NSDateFormatterBehavior10_4`条线。iPhone OS 仅支持 10.4+ 选项，但如果您在模拟器中使用“旧”样式，则不会出现任何错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-07T19:43:28.303

我最近也有这个问题（iOS5）。我还需要设置`NSDateFormatter`在设备上工作的语言环境。没有这个，`[dateFormatServer dateFromString:dateServer]`返回null。

```
NSString *dateServer = @"Fri, 8 May 2009 08:08:35 GMT";

NSDateFormatter *dateFormatServer = [[NSDateFormatter alloc] init];
[dateFormatServer setDateFormat:@"EEE, d MMM yyyy HH:mm:ss zzzz"];

NSLocale *locale = [[NSLocale alloc] initWithLocaleIdentifier:@"en_GB"];
[dateFormatServer setLocale:locale];
[locale release];

NSDate * date = [dateFormatServer dateFromString:dateServer]; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T13:59:01.387

没有什么特别突出的，但是为了帮助调试它，您可以尝试为 NSDateFormatter 提供一个日期对象，并查看生成的字符串是否与您尝试解析的字符串有任何细微差别。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T14:27:50.023

当我解析一个结尾带有“GMT”的日期字符串时，我使用了“zzz”格式，而不是“Z”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-28T21:50:38.787

我支持 Manuel Spuhler 关于手动解析的建议——不是我最喜欢的选项，但 Objective-C 的选项太复杂了（并且缺乏错误报告——任何错误都会吐出`nil`，没有错误提示）。

对我有用的一件事是使用 C`strptime`来解耦日期，然后将其重构为一个`NSDate`对象。例如，下面的代码将接收到的字符串接收为“星期一，2009 年 9 月 28 日 18:13:50 UTC”，并将其转换为适应本地时间的 UTC 时间的 NSDate 对象：

```
 struct tm time;
    strptime([currentStringValue UTF8String], "%A, %d-%b-%y %H:%M:%S %z", &time);   
    NSDate* myDate = [NSDate dateWithString:
        [NSString stringWithFormat:@"%04d-%02d-%02d %02d:%02d:%02d +0000",
            time.tm_year+1900, time.tm_mon+1, time.tm_mday,
            time.tm_hour, time.tm_min, time.tm_sec]
    ]; 
```

（可以通过添加其他`struct tm`参数而不是 +0000 固定时区来处理其他区域，有关详细信息，请参见[wikipedia 上的 time.h 条目](http://en.wikipedia.org/wiki/Time.h)）：

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-16T14:19:52.183

strptime 也救了我。

```
struct tm time;
if (strptime([modDateString UTF8String], "%A, %d %b %Y %H:%M:%S", &time)) {
            NSString *rDate=[NSString stringWithFormat:@"%04d-%02d-%02d %02d:%02d:%02d +0000",
                             time.tm_year+1900, time.tm_mon+1, time.tm_mday,
                             time.tm_hour, time.tm_min, time.tm_sec]; 
```

此代码适用于 HTTP 日期，例如 Thu, 15 Apr 2010 13:53:56 GMT 和 Fri, 8 May 2009 08:08:35 GMT，这是原始问题

# java - 使用代理的懒惰一对一不起作用

> ID：838894
> 
> 赞同：3
> 
> 时间：2009-05-08T08:56:18.703
> 
> 标签：java, hibernate, proxy, lazy-loading, one-to-one

我在经销商和卖家之间建立了一对一的关系，应该懒惰地使用代理。对于定义外键的一方（卖方，引用经销商），这很好用。但从另一方面来说它不起作用——卖家总是急切地加载。我按照[“关于延迟加载的一些解释”](https://www.hibernate.org/162.html)`constrained="true"`中的描述进行设置，但这并没有帮助。

以下是使用的映射：

```
<class name="Role" table="PER_PERSROLE" abstract="true">
    <id column="OID" type="long">
        <generator class="native" />
    </id>
    <discriminator column="SUBTYPE" type="string" />
</class>

<subclass name="Dealer" extends="Role" discriminator-value="DEAL">
    <property name="gpNr" column="GP_NR" type="string" />
    <one-to-one name="seller" property-ref="dealer" lazy="proxy" constrained="true"
        outer-join="false" />
</subclass>

<subclass name="Seller" extends="Role" discriminator-value="SELL">
    <many-to-one name="dealer" column="SELLER_DEALEROID" lazy="proxy"
        outer-join="false" />
</subclass> 
```

两个类都驻留在一张表中是否有问题？我看到严格来说，关系不受数据库的限制（它不能使用这个模型），但是域模型总是需要两个实体，应用程序可以确保这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-11T18:14:05.403

我认为您链接到的页面解释得最好，尽管我不确定为什么它建议设置`constrained="true"`. 如果您在数据库级别考虑它，Hibernate 无法在不访问数据库的情况下判断给定属性（经销商的卖家）是否应该为空（它需要执行 a`SELECT ... WHERE OID=:sellerOrDealerId`以查看是否返回任何行）。当它访问数据库时，它也可能会获取该行的其余部分。从关联的另一端（卖方的经销商）来看，没有这样的问题，因为它已经获取了行（以及`SELLER_DEALEROID`列）。

我确实遇到过类似的事情，并且能够通过使关联成为非可选（错误，不可为空）来解决它

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-22T22:45:17.790

我猜你正在加载 session.get(id)？您是否尝试过使用 HQL 查询加载实例？这将允许您在查询中指定急切或延迟加载的关系。

高温高压

# sql-server - 在 NHibernate 查询中获取“周围”行

> ID：838895
> 
> 赞同：0
> 
> 时间：2009-05-08T08:56:25.897
> 
> 标签：sql-server, nhibernate, sqlite, hql

我正在寻找一种在给定主键和排序顺序的情况下检索 NHibernate 查询中的“周围”行的方法？

例如，我有一个包含日志条目的表，我想显示带有主键 4242 的条目和前 5 个条目以及以下 5 个按日期排序的条目（日期和主键之间没有直接关系）。这样的查询应该总共返回 11 行（只要我们不靠近任何一端）。

日志条目表可能很大，不可能全部检索出来。

是否有可以在 NHibernate 中使用的行号这样的概念？底层数据库将是 SQlite 或 Microsoft SQL Server。

**编辑**添加示例

想象如下数据：

```
Id   Time
4237 10:00
4238 10:00
1236 10:01
1237 10:01
1238 10:02
4239 10:03
4240 10:04
4241 10:04
4242 10:04   <-- requested "center" row
4243 10:04
4244 10:05
4245 10:06
4246 10:07
4247 10:08 
```

当请求主键为 4242 的条目时，我们应该得到行 1237、1238 和 4239 到 4247。顺序是按时间，ID。

是否可以在单个查询中检索条目（显然可以包括子查询）？时间是一个非唯一的列，因此多个条目具有相同的值，在此示例中，不可能以使其唯一的方式更改分辨率！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T09:10:14.600

“日期和主键之间没有直接关系”是指主键不是按顺序排列的吗？

然后我会这样做：

```
Item middleItem = Session.Get(id);

IList<Item> previousFiveItems = Session.CreateCriteria((typeof(Item))
  .Add(Expression.Le("Time", middleItem.Time))
  .AddOrder(Order.Desc("Time"))
  .SetMaxResults(5);

IList<Item> nextFiveItems = Session.CreateCriteria((typeof(Item))
  .Add(Expression.Gt("Time", middleItem.Time))
  .AddOrder(Order.Asc("Time"))
  .SetMaxResults(5); 
```

存在同时拥有多个项目的风险。

* * *

**编辑**

现在应该可以了。

```
Item middleItem = Session.Get(id);

IList<Item> previousFiveItems = Session.CreateCriteria((typeof(Item))
  .Add(Expression.Le("Time", middleItem.Time)) // less or equal
  .Add(Expression.Not(Expression.IdEq(middleItem.id))) // but not the middle
  .AddOrder(Order.Desc("Time"))
  .SetMaxResults(5);

IList<Item> nextFiveItems = Session.CreateCriteria((typeof(Item))
  .Add(Expression.Gt("Time", middleItem.Time))  // greater 
  .AddOrder(Order.Asc("Time"))
  .SetMaxResults(5); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T09:11:04.427

使用 NHibernate 的 Criteria API 应该相对容易：

```
List<LogEntry> logEntries = session.CreateCriteria(typeof(LogEntry))
.Add(Expression.InG<int>(Projections.Property("Id"), listOfIds))
.AddOrder(Order.Desc("EntryDate"))
.List<LogEntry>(); 
```

在这里，您`listOfIds`只是一个强类型整数列表，表示您要检索的条目的 id（整数 4242-5 到 4242+5 ）。

当然，您也可以添加`Expressions`让您检索大于 4242-5 且小于 4242+5 的 Id。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T15:17:33.600

Stefan 的解决方案确实有效，但使用单个选择和嵌套子查询存在更好的方法：

```
ICriteria crit = NHibernateSession.CreateCriteria(typeof(Item));

        DetachedCriteria dcMiddleTime =
            DetachedCriteria.For(typeof(Item)).SetProjection(Property.ForName("Time"))
            .Add(Restrictions.Eq("Id", id));

        DetachedCriteria dcAfterTime =
            DetachedCriteria.For(typeof(Item)).SetMaxResults(5).SetProjection(Property.ForName("Id"))
            .Add(Subqueries.PropertyGt("Time", dcMiddleTime));
        DetachedCriteria dcBeforeTime =
            DetachedCriteria.For(typeof(Item)).SetMaxResults(5).SetProjection(Property.ForName("Id"))
                .Add(Subqueries.PropertyLt("Time", dcMiddleTime));

        crit.AddOrder(Order.Asc("Time"));
        crit.Add(Restrictions.Eq("Id", id) || Subqueries.PropertyIn("Id", dcAfterTime) ||
                 Subqueries.PropertyIn("Id", dcBeforeTime));

        return crit.List<Item>(); 
```

这是 NHibernate 2.0 语法，但同样适用于早期版本，而不是使用表达式的限制。

我已经在测试应用程序上对此进行了测试，它可以像宣传的那样工作

# java - 在 Swing 应用程序中嵌入范围有限的 Java 代码编辑器？

> ID：838899
> 
> 赞同：5
> 
> 时间：2009-05-08T08:57:11.260
> 
> 标签：java, eclipse, swing, ide

这就是我想做的。我想将代码对象存储在我的休眠驱动的 java swing 应用程序中。我希望允许用户创建可以在有限范围内影响数据的代码对象，例如在只能访问该成员类的成员的函数中。我什至真的很想有一个完整的小i​​de（虽然缩小了所有不相关的隐藏），这将允许自动完成并有一个按钮来编译和检查，然后把所有东西都包装好，这样我就可以放弃了我的数据库中的东西并安排它的执行。

任何人都有一个好主意，知道一个好的组件或方法来使用 eclipse 或类似的东西来实现这一点，而无需自己推出解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-09T19:48:15.560

您可以使用 Eclipse RCP 编辑器，它有很多可重用的功能。例如文本突出显示、配对结构突出显示、文本悬停、完成辅助等。它更强大，但更重。RCP 不仅是编辑器...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T19:06:11.630

为了实现代码高亮和一些*简单的*自动完成功能，值得研究一下[jsyntaxpane](http://code.google.com/p/jsyntaxpane/)组件。

它非常简单易用，但您不会从中获得编译功能。

# asp.net - 在 vb.net 中调用 javascript

> ID：838901
> 
> 赞同：0
> 
> 时间：2009-05-08T08:57:23.913
> 
> 标签：asp.net, javascript, vb.net

我`onclick`在ASP.NET源代码的事件中调用了一个javascript，如下：

```
onclick='open popuplistitems("ct100$contentplaceholder..........") 
```

你能告诉我如何在 vb.net 中做同样的事情吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T09:21:15.570

您可以将调用添加到控件的属性。

例子：

在表单设计器中创建标签。

在 Webform1 的构造函数中或在 Page_Load 方法中：

`Label.Attributes.Add("onclick", "javascript:window.alert('done by vb')")`

在运行时，单击标签将执行 javascript 调用。

# asp.net - 你如何阻止 RadioButtonList 标签文本在按钮下换行

> ID：838904
> 
> 赞同：27
> 
> 时间：2009-05-08T08:57:48.887
> 
> 标签：asp.net, layout, webforms

我有一个单选按钮列表，其中一些标签很长，所以它们会换行，第二行出现在单选按钮下方。理想情况下，我希望文本从第一行的第一个字符开始的第二行开始换行。

关于如何做的任何想法？还是我必须为此制作自己的基于列表的控件？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-08T09:39:19.223

这个 CSS 实际上可以解决问题：

```
<style type="text/css">
 table.radioWithProperWrap input
 {    
      float: left;
 }

 table.radioWithProperWrap label
 {    
      margin-left: 25px;
      display: block;
 }
</style>
<asp:RadioButtonList runat="server" CssClass="radioWithProperWrap" ....> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T09:08:44.883

您可以使用单选按钮和单独的标签并设置该标签的[AssociatedControlID](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.label.associatedcontrolid.aspx "关联控件ID")属性。

```
<table>
    <tr>
        <td>
            <asp:RadioButton runat="server" ID="rdo" />
        </td>
        <td>
            <asp:Label runat="server" ID="lbl" Text="Radio Text" AssociatedControlID="rdo" />
        </td>
    </tr>
</table> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-06T19:02:15.717

我知道这在游戏中有点晚了，但这对我有用：

```
 table.NoWrapRadio td
    {
        white-space:nowrap;
    } 
```

当我使用所选回答者的方法时，包装问题得到了解决，但它使单选按钮呈现比标签低的 vew 像素。我正在使用 IE9 兼容模式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-05-06T19:29:18.000

如果有人无法让选定的答案起作用：它仅在您的 RadioButtonList 使用`RepeatLayout="Table"`而不是`RepeatLayout="Flow"`. 我花了一分钟才明白这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-19T16:03:44.303

尝试负文本缩进样式 -20px 适用于 IE8

# sql-server - SQL Server 中的简单计算

> ID：838909
> 
> 赞同：1
> 
> 时间：2009-05-08T08:58:28.840
> 
> 标签：sql-server, database, tsql

我的数据库中有一个`distance`字段，用于存储在特定路线上行驶的距离。我需要选择所有距离字段，将它们加在一起，然后从我的存储过程中返回结果。

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T09:03:00.000

像这样的东西：

```
CREATE PROCEDURE SumDistances
AS
BEGIN
    SELECT SUM(Distance)
    FROM MyTable
END 
```

# java - Java JFrame 问题

> ID：838914
> 
> 赞同：-2
> 
> 时间：2009-05-08T09:00:52.640
> 
> 标签：java, user-interface, swing

我想知道是否有人可以帮助我使用 NetBeans....
我只需要一条建议。
这就是问题所在：
当我创建一个新的 Java 桌面应用程序时，我可以设法从创建的骨架类中“调用”另一个 Frame Form 类。但是当我创建另一个类并使用 Swing gui 编辑器编辑它的设计时，我无法从任何其他类中实例化该类......
例如，如果我这样做：

```
new JFrame(); 
```

我不知道该类是否已实例化，因为我没有从应用程序获得任何视觉反馈（JFrame 没有出现......）。

也许这是一个愚蠢的问题，答案很简单......但我真的需要弄清楚......

先感谢您。

**编辑：**
澄清：`JFrame`是我*自己的*课。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T09:20:19.753

> 你看... JFrame 是我的课.... 我只是给它起了一个很普通的名字哈哈...

给您的类赋予与 Java API 类相同的名称并不是一个好主意——这非常令人困惑。

使用 Matisse（NetBean 的表单设计器）的首选方法是创建 JPanel 而不是 JFrame——这提高了可测试性。然后，您将创建一个小的 main 方法来实际创建 JFrame。

这是一个例子。假设您在 Matisse 中创建了一个名为 MyPanel 的面板，其中包含您的所有组件。您可以使用以下 main 启动应用程序：

```
public class AppMain {
    public static void main(String[] args) {
        javax.swing.JFrame frame = new javax.swing.JFrame("Title");
        frame.add(new MyPanel());
        frame.pack();
        frame.setVisible(true);
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T09:03:55.970

新的 JFrame().setVisible(true) ？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T09:08:10.453

您必须先将 JFrame 添加到某物，然后才能看到它。

```
JFrame jf = new JFrame();
panelYouWantToAddFrameTo.add(jf); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-27T02:26:56.947

而不是仅仅使用 new JFrame(); 您可以将其定义为 JFrame f 或您想命名的任何内容 = new JFrame();

然后你可以使用 f.setVisible(true); new JFrame() 只能创建一个空的JFrame 请反馈

# c++ - 编译器如何解决无限引用循环？

> ID：838917
> 
> 赞同：2
> 
> 时间：2009-05-08T09:02:08.597
> 
> 标签：c++

```
// edited by Neil Butterworth to conserve vertical space
#include <stdio.h>

struct A;
struct B;

A& GetAInstance();
B& GetBInstance();

struct A {  
    A() {
        printf( "A\n" );
    }
    ~A() {
        printf( "~A\n" );
        B& b = GetBInstance();
    }
};

struct B {
    B() {
        printf( "B\n" );
    }

    ~B() {
        printf( "~B\n" );
        A& a = GetAInstance();
    }
}; 

A& GetAInstance() {
    static A a;
    return a;
}

B& GetBInstance() {
    static B b;
    return b;
}

int main( ) {
    A a;
} 
```

考虑上述情况。我希望这会导致无限引用循环，从而导致程序无法退出静态反初始化，但程序运行良好，打印输出如下：

```
 A
  ~A
  B
  ~B
  A
  ~A 
```

这是出乎意料的。

编译器如何处理这种情况？它使用什么算法来解决无限递归？还是我误解了一些基本的东西？这是否在标准中的某个地方定义为未定义？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T09:07:31.687

编译器有效地存储 a`bool`以`static`记住它是否已被初始化。

这是顺序：

内部主要：

*   构造`A`
*   破坏`A`
*   *   构造`static B`

静电清理：

*   破坏`static B`
*   *   构造`static A`
    *   破坏`static A`

标准中的 3.6.3/1 规定它应该以这种方式工作，即使`static`在这种情况下在清理期间构建 a 也是如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T09:12:59.367

这种行为可能是因为您使用的是静态实例。编译器肯定会处理静态变量的状态，以避免执行多次初始化/反初始化。

# java - 从 XML 文档动态生成 Java 类

> ID：838925
> 
> 赞同：5
> 
> 时间：2009-05-08T09:04:10.510
> 
> 标签：java, xml, reflection

考虑这种情况：我有一个名为 person.xml 的 XML 文件，其中包含以下数据。

```
<person>
    <name>MrFoo</name>
    <age>28</age>
</person> 
```

如果我想将此 XML 读入 Java 对象，我将创建一个名为 PersonBean 的 Java bean（带有属性的 getter/setter）：

```
class Person{
    String name;
    int age;
} 
```

我可以使用任何 API 来读取 XML 和填充 Java Bean。

但这里真正的问题是，假设如果 XML 文件的结构发生变化，即如果在 XML 文件中添加了新属性“电子邮件”，那么我还必须修改 Java Bean 以添加新属性。但是，即使 XML 结构发生变化，我也想避免更改 Java 代码。

所以，我想要做的是，我正在创建另一个名为 PersonStructure.xml 的 XML 文件，其内容为：

```
<class name="Person">
  <attributes>
      <attribute>
          <name>personName</name>
          <type>java.lang.String</type>
      </attribute>
      ... and it goes like this...
   </attribute>
</class> 
```

是否可以读取 PersonStructure.XML 文件并将其转换为 Person.Java 类文件？我尝试做的方法是正确的，还是有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T09:12:44.140

虽然这并不是您想要做的，但您应该看看 JAXB。它可以从 Schema 定义中生成一组 Java 类。您的 PersonStructure.xml 文件看起来很像具有不同语法的 XSD，因此您可以重用 JAXB。

[https://jaxb.dev.java.net/](https://jaxb.dev.java.net/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T09:15:51.370

对 Java 不是很熟悉（我主要是 .NET 人），但常识适用：在动态生成的 bean 中实际上很少使用（除非您将它们绑定到某个控件，在这种情况下，数组`Object`s 就可以了正好）。

更合乎逻辑的是从这个 XML 定义中对 Java bean 进行代码生成，这可以使用[XSLT](http://en.wikipedia.org/wiki/XSLT)来完成。

PS。不要试图用 XML 制作编程语言。如果你这样做，地狱肯定会崩溃。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-21T15:37:21.087

我正在以某种方式或多或少地遇到相同的问题（我需要将 Java 中的数据转换为 POM.xml 文件），其中一件事对我不起作用，但可能对你有用的是 XStream 库，它将 java 类转换为 xml，你应该看看：

[http://x-stream.github.io/](http://x-stream.github.io/)

无论如何，我与他们有关，只是一个随机寻找自己答案的人。如果您对如何使用这个库有任何疑问，您应该尝试与他们联系。希望它能解决你的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-19T05:16:02.860

由于您想容纳可能的新字段，因此 Map 比类对您更有用。

用你的例子来说明，而不是这个：

```
Person person = getPersonFromSomewhere();
System.out.printf("%s was %d years old\n", person.name, person.age);
person.age++; // happy birthday! 
```

...你会这样做：

```
Map<String, Object> person = getPersonFromSomewhere();
System.out.printf("%s was %d years old\n", person.get("name"), person.get("age"));
int currentAge = (Integer) person.get("age"); // real code would sanitise the value first
person.put("age", currentAge + 1); // happy birthday! 
```

是的，这意味着更多的代码和更少的错误检查（编译器不会告诉你是否拼错了'name'并且没有类型检查），但它会做你想做的事。考虑到最佳实践是编写 getter 和 setter 代码，而不是直接访问成员字段，在现实生活中无论如何你都会编写更多代码。

如果您决定走这条路，请参阅[此问题](https://stackoverflow.com/questions/1537207/how-to-convert-xml-to-java-util-map-and-vice-versa)以了解如何在 XML 之间进行转换。

# java - 命名：为什么命名常量在 C++/Java 中必须全部大写？

> ID：838929
> 
> 赞同：43
> 
> 时间：2009-05-08T09:05:20.647
> 
> 标签：java, c++, naming-conventions

我知道，对于 C++ 和 Java，这是一个完善的命名约定，常量应该全部大写，用下划线分隔单词。像这样（Java 示例）：

```
public final static Color BACKGROUND_COLOR = Color.WHITE;
public final static Color TEXT_COLOR = Color.BLACK; 
```

这个命名约定很容易理解和遵循，但我问自己，为什么选择这个命名约定而不是变量的正常命名约定：

```
public final static Color backgroundColor = COLOR.WHITE;
public final static Color textColor = COLOR.BLACK; 
```

似乎没有必要改变常量的外观。如果我们想给它们赋值，编译器无论如何都会阻止它。实际上它会产生问题，如果稍后将常量更改为适当的变量（例如，因为颜色可以配置）。

那么将命名常量全部大写的最终原因是什么？历史原因？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-05-08T09:16:40.823

我认为这不是技术问题，而是心理问题。命名约定不是供编译器处理的（计算机并不真正介意名称），而是供正在浏览代码的程序员以尽可能少的努力获得尽可能多的信息。

使用不同的命名约定清楚地告诉读者您正在阅读的内容是在编译时已修复的内容，您无需通过代码来确定值的位置和方式。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-08T09:19:18.070

如果我知道某事是一个常数，我可以多次引用它并且知道它不会改变。换句话说，我知道：

```
Color black = Colors.BLACK;
foo(black);
foo(black); 
```

是相同的：

```
foo(Colors.BLACK);
foo(Colors.BLACK); 
```

有时知道这很有用。我个人更喜欢 .NET 命名约定，即对常量（和方法）使用 Pascal 大小写：

```
Foo(Colors.Black);
Foo(Colors.Black); 
```

我不是大喊大叫的案例的忠实粉丝......但我确实喜欢常量显然是常量。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-05-08T09:12:57.557

我可以想象，最初，在 C 时代，人们会使用预处理器象征性地实现“常量”：

```
typedef unsigned int Color;
#define BACKGROUND_COLOR 0xffffff 
```

这样的“常量”只是美化的文字，因此它们的行为不像变量。例如，您不能获取这样一个“常量”的地址：

```
Color *p = &BACKGROUND_COLOR; // Breaks! 
```

出于这个原因，让它们“脱颖而出”是有意义的，因为它们实际上不仅仅是“你无法改变的变量”。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-05-08T09:44:34.860

我相信在 C++ 中，这是从使用预处理器到#define 常量值的日子延续下来的约定。那时，这样做是为了避免预处理器践踏您的源代码，因为 C 函数和变量名称的通常约定会使它们混合大小写或小写。

从 C++ 的角度来看，我会说将常量全部大写是个坏主意。因此，我不得不调试多个构建问题 - 请记住，C++ 预处理器对名称空间和命名范围一无所知，并且会很乐意替换它认为合适的内容，即使它相当不合适。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2017-10-25T17:43:50.477

> 不要仅仅因为常量曾经是宏就将 ALL_CAPS 用于常量。

C++ Core Guidelines 中的这[句话](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#es9-avoid-all_caps-names)总结了一切。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-01-18T22:24:59.183

In C (and then C++), symbols that were defined with the preprocessor `#define` directive were written all in caps as a loud signal to developers that the code was not as it seemed and to not treat as a normal symbol. Constants did not initially exist in K&R C (although `const` was brought back from C++ later) so developers used `#define` instead, hence the caps.

For some reason, this got twisted into Java as "constants are caps", hence the current misguided (IMO) convention.

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-02-19T11:27:31.450

我认为大写常量是 C 的不良遗产。背后的逻辑与使用下划线作为私有成员的前缀时相同。这是已经用 Java 关键字表达的技术内容，例如`private`or，在常量的情况下，`static final`.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-11-11T01:10:59.910

基本上，当人们爱上 C 并且 C++ 和 Java 是新的或尚未创建的时候，人们使用所有大写的预处理器常量名称，以表明它们实际上不是变量。

```
#define INT_CONST 4
#define STRING_CONST "Yello."
#define FLOAT_CONST 3.6122448 
```

考虑到这是在 C 中定义真正常量的唯一真正方法（`const`如果您知道如何更改变量，仍然可以更改变量），像这样的预处理器常量只是被视为常量，因此全大写名称的含义从一般而言，将预处理器常量转换为简单的常量。然后这延续到后来的语言中，成为标准的“consts = capitals”实践。

然而，其他语言有自己的首选风格（例如，C# 和 .NET 更喜欢 PascalCase），因此如果有首选风格，通常最好使用首选风格。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-08T09:14:02.157

使用大写常量，长公式更容易阅读，您不必猜测哪个元素可以变化，哪个元素不能变化。这当然只是一个约定，但很有帮助。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-08T09:20:22.187

这是您的开发工具无法以方便的方式发现标识符的属性的一种解决方法。

很像匈牙利符号。

当您的 IDE 变得更好时，您将不需要任何命名约定，而是需要指定名称是关于标识符含义的全面信息。

即使这样也可能会发展：为什么不创建一个编程系统，您只需创建标识符，并向其添加属性，如“简要描述”、“类型”，......当工具到达时，可以方便地做到这一点，我'米。“[有意编程](http://en.wikipedia.org/wiki/Intentional_programming)”是一个提示。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-08T09:12:00.257

可能你是对的。计算机和编译器（尤其是）没有今天那么快。

Joel Spolsky 在[他的一篇文章](http://www.joelonsoftware.com/articles/fog0000000023.html)中提到，他对新版 Turbo Pascal 的编译时间印象深刻。

我记得在 PC XT 10MHz 上的 Turbo Pascal 5.0 中编译不太大的程序 (10-20KLOC) 大约需要 20 分钟...

我想等待编译来检测错误是不可接受的。

像这样的约定有助于避免在编译中断期间出现错误和浪费时间。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-05-20T20:35:42.070

实际上，大多数 C++ 命名指南（包括 ISO、Boost、Sutter & Stroustrup 和 Google）都强烈反对使用全部大写的命名常量。这是因为宏也使用全部大写，并且它们可能会散布在头文件中，可能会产生奇怪的行为。无论如何，人们仍然使用所有大写字母，因为他们从旧的 C/K&R 或旧的遗留代码中学习。但是，在现代 C++ 新代码中，您应该避免将所有大写字母用于除宏之外的任何内容。

我对为什么所有大写都存在的最喜欢的理论是，在非常旧的机器上，代码是使用数字键盘直接输入机器代码的。当汇编语言出现时，它只使用全部大写，因为当时的键盘没有标准化，并且一些键盘受到限制，例如，使用相同的数字键盘输入字母，就像在功能手机中一样。然后这被带到了许多早期的语言中，比如 BASIC，它是所有的一切。当实际终端变得可用并且键盘开始变得标准化时，人们开始毫无保留地使用混合大小写，并且所有大写都保留用于与函数和变量相比很少发生的东西，例如常量。

大多数 C++ 指南现在都同意使用“k”作为常量的前缀，后跟带有下划线或 CamelCase 的名称。我个人更喜欢 kCameCase，因为它可以轻松区分以 under_scores 命名的变量。

```
const float kFixedRadius = 3.141; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-08T09:41:35.273

在编程时，创建人类可以理解的代码很重要。有命名约定有助于做到这一点。这在查看不是您编写的代码时最好，并且使代码更易于维护，因为它很容易与常量和变量区分开来。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-08T19:38:00.697

编码转换是为了提高可读性。您不必使用字母。例如，Java 允许使用 $ 符号。

```
public final static Color $$ = COLOR.WHITE;
public final static Color $_ = COLOR.BLACK; 
```

您也可以为变量编号，但这并不意味着它是一个好主意。;)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-01-13T21:22:06.423

**这纯粹是为了帮助程序员一目了然地了解他或她正在看什么。**知道使用了一个常量是有帮助的，这样无论您如何引用它，该值都不会改变。

关于事物的编译器方面并没有真正的理由。命名约定纯粹是约定，而不是真正的技术限制。

# sql-server - 在 Reporting Services 中导出 PDF

> ID：838937
> 
> 赞同：6
> 
> 时间：2009-05-08T09:08:45.133
> 
> 标签：sql-server, reporting-services

有谁知道在导出后以 PDF 显示时是否可以更改报告的页面大小/比例？

我们遇到的问题是我们的一个用户在表格中创建了一个包含大量列的报告，然后表格运行到报告的下一页。我们已将 Business Intelligence Studio 中的页面设置更改为横向，然后在 PDF 中以横向呈现报告。但是，当我将页面设置更改为 A3 时，这并不能解决问题。是否可以通过这种方式调整大小/缩放，或者是否有更好的方法我不知道。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T18:22:25.893

是的。您需要手动导出，并在渲染过程中指定设备信息。

以下是 PDF 渲染可能的 DeviceInfo 数据：

[http://msdn.microsoft.com/en-us/library/ms154682.aspx](http://msdn.microsoft.com/en-us/library/ms154682.aspx)

现在，导出到 PDF 方法将像这样完成：

```
 Private Sub ReportCommandExportToPDF()
    Dim warnings As Warning() = Nothing
    Dim streamids As String() = Nothing
    Dim mimeType As String = Nothing
    Dim encoding As String = Nothing
    Dim extension As String = Nothing
    Dim bytes As Byte()
    Dim deviceInf as String = Nothing

    deviceInf = "<DeviceInfo><MarginLeft>0.2</MarginLeft></DeviceInfo>"

    bytes = ReportViewer1.LocalReport.Render("PDF", deviceInf, mimeType, encoding, extension, streamids, warnings)
      Dim fs As New FileStream("File.pdf", FileMode.Create)
      fs.Write(bytes, 0, bytes.Length)
      fs.Close()

  End Sub 
```

# sharepoint - Sharepoint 2007：开发人员需要知道什么？

> ID：838938
> 
> 赞同：3
> 
> 时间：2009-05-08T09:09:17.423
> 
> 标签：sharepoint, moss

我曾使用 Sharepoint 2007，作为开发人员，这是一场噩梦。由于这项技术，我在 1 个月后离开了实习。

我认为所有开发人员都会和我有相似的想法，但[这个问题](https://stackoverflow.com/questions/832465/how-good-bad-is-sharepoint-programming)教会了我不同的想法。开发人员似乎可以说“我喜欢 Sharepoint”。也许他们已经陷入了疯狂。

我不是在询问可以在书中轻松找到的有关 Sharepoint 的信息，而是我想知道您对 Sharepoint 2007 开发有哪些战争故事或个人轶事？

也许以这种方式格式化您的回复：

问题：要解决哪些“应该”容易做到但不容易做到的问题。

解决方案：解决问题的解决方案或讨厌的技巧。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T08:07:16.267

以下是一些基本但令人沮丧的问题：

**问题：**您不能使用 wiki 页面的标题作为对另一个列表的查找。

**解决方案：**在列表上创建一个文本字段，您可以使用相同的信息手动完成该文本字段并将其用作查找。

**问题：**使用 Office 2003 的用户无法直接在 SharePoint 网站上编辑 PDF 文档（不是打印错误；需要 Office 2007 才能在 SharePoint 上编辑 PDF 文档）。

**解决方案：**下载文件，在本地进行编辑，然后将其上传到原始文件上。

**问题：**除非已应用配额，否则无法查看网站集使用的数据量。

**解决方案：**应用一个配额模板，即使它只是一个非常大的模板。

非常高兴被证明是错误的！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T09:19:07.293

问题：“加入”来自多个列表的数据（尤其是使用不同的字段） 解决方案：查找字段在少数情况下可能会有所帮助，但大多数时候您必须以编程方式加入列表项。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T14:44:16.577

可能需要几本百科全书大小的书才能回答这个问题。这只是我脑海中的一对。

*工作流程：*

**问题：**使用 SharePoint Designer 创建工作流后，您希望将工作流复制或移动到不同的列表。

**解决方案：**复制并粘贴工作流的 XML 配置文件。然后查找所有旧列表的 GUID 并将其替换为新列表的 GUID。

*使用 Enterprise Search SQL (ESSQL) 进行搜索*

**问题：**您最多只能查询 64 个字符的字段。

**解决方案：**使用 CAML 直接查询项目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T14:54:07.557

**问题：**您希望将内容类型基于另一种内容类型。

**解决方案：**指定一个长度为 200 个十六进制字符的 ID。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-04T15:34:15.153

**问题：**对摘要链接列表的编辑在保存和发布页面之间丢失。

**解决方案：**添加重复的webpart并应用更改，发布后删除原始的。

* * *

**问题：**用户想要为列表、页面等定义唯一的权限，但也会让彼此完全控制

**解决方案**取消权限并创建一个工作流以请求中断继承，该工作流以具有完全控制权的用户身份运行

* * *

该列表将继续下去..如果您对sharepoint有所了解，请查看我的问题..

另外我也算是一个热爱sharepoint的人，但纯粹是概念。似乎这样一个大型应用程序的“软”实现注定会遇到麻烦。

# windows - 如何在 Windows 上以编程方式从转储文件中获取堆栈跟踪

> ID：838947
> 
> 赞同：1
> 
> 时间：2009-05-08T09:12:04.593
> 
> 标签：windows, debugging, stack-trace

我想以编程方式从用户转储文件中检索堆栈跟踪。在已知位置有这个用户转储，我想从中提取堆栈跟踪并将其放入纯文本文件中 - 有没有办法做到这一点？

注意：我可以手动完成 - 打开 windbg 并输入“k”命令 - 但正如我之前提到的，我想以编程方式执行此操作。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T11:33:43.193

您应该检查[windbg](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx) sdk 子文件夹，其中包含有关如何以编程方式使用 dbgeng.dll 的示例。
代码示例：

```
 PSTR g_DumpFile;
 PSTR g_ImagePath;
 PSTR g_SymbolPath;

 ULONG64 g_TraceFrom[3];

 IDebugClient* g_Client;
 IDebugControl* g_Control;
 IDebugSymbols* g_Symbols;

  void CreateInterfaces(void)
  {
    HRESULT Status;

    // Start things off by getting an initial interface from
    // the engine.  This can be any engine interface but is
    // generally IDebugClient as the client interface is
    // where sessions are started.
    if ((Status = DebugCreate(__uuidof(IDebugClient),
                              (void**)&g_Client)) != S_OK)
    {
        Exit(1, "DebugCreate failed, 0x%X\n", Status);
    }

    // Query for some other interfaces that we'll need.
    if ((Status = g_Client->QueryInterface(__uuidof(IDebugControl),
                                           (void**)&g_Control)) != S_OK ||
        (Status = g_Client->QueryInterface(__uuidof(IDebugSymbols),
                                           (void**)&g_Symbols)) != S_OK)
    {
        Exit(1, "QueryInterface failed, 0x%X\n", Status);
    }
 }

 void
 DumpStack(void)
 {
    HRESULT Status;
    PDEBUG_STACK_FRAME Frames = NULL;
    int Count = 50;

    printf("\nFirst %d frames of the call stack:\n", Count);

    if (g_TraceFrom[0] || g_TraceFrom[1] || g_TraceFrom[2])
    {
        ULONG Filled;

        Frames = new DEBUG_STACK_FRAME[Count];
        if (Frames == NULL)
        {
            Exit(1, "Unable to allocate stack frames\n");
        }

        if ((Status = g_Control->
             GetStackTrace(g_TraceFrom[0], g_TraceFrom[1], g_TraceFrom[2],
                           Frames, Count, &Filled)) != S_OK)
        {
            Exit(1, "GetStackTrace failed, 0x%X\n", Status);
        }

        Count = Filled;
    }

    // Print the call stack.
    if ((Status = g_Control->
         OutputStackTrace(DEBUG_OUTCTL_ALL_CLIENTS, Frames,
                          Count, DEBUG_STACK_SOURCE_LINE |
                          DEBUG_STACK_FRAME_ADDRESSES |
                          DEBUG_STACK_COLUMN_NAMES |
                          DEBUG_STACK_FRAME_NUMBERS)) != S_OK)
    {
        Exit(1, "OutputStackTrace failed, 0x%X\n", Status);
    }

    delete[] Frames;
 }

 void __cdecl main(int Argc, __in_ecount(Argc) char** Argv)
 {
    CreateInterfaces();

    ParseCommandLine(Argc, Argv);

    ApplyCommandLineArguments();

    DumpStack();

    Exit(0, NULL);
 } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T10:24:23.720

几年前，我在 DDJ 上写了一篇关于在 C/C++ 中使用 Windows 和 Unix/Linux 转储堆栈的文章。它不使用cordump，但它会将堆栈帧写入日志文件、内部错误或操作系统确定应用程序故障时。

也许它可以帮助你：

见[http://www.ddj.com/architect/185300443](http://www.ddj.com/architect/185300443)

# c# - 使用 IHTMLDocuments 1、2、3 和 4

> ID：838948
> 
> 赞同：3
> 
> 时间：2009-05-08T09:12:12.487
> 
> 标签：c#, ihtmldocument

我在当前项目中使用网络浏览器，目前我在设计模式下使用它以使其可编辑等。我目前使用的代码是：

```
WebBrowser.Document.DomDocument as IHTMLDocument2 
```

IHTMLDocument2、3 或 4 实际上是什么？我还发现，在识别文档中的当前选择范围时，range.text.replace 方法的工作方式与 string.replace 不同。

谁能向我解释一下 IHTMLDocuments 和 IHTMLTxtRange 的基本功能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T09:33:55.993

IHTMLDocument 是一个接口，它本质上是一个“牢不可破”的契约，表示实现它的对象将提供什么。

在迁移到新版本的代码时更改界面会破坏该合同，进而破坏依赖该合同的代码。

假设您创建：

```
public interface IMyInterface {
      public int Property1 { get;  set; }
} 
```

一年后，您需要添加 Property2，但您无法更改界面。因此，一种解决方法是创建：

```
public interface IMyInterface2 {
    public int Property2 { get;set; }
} 
```

然后使用您正在实施 IMyInterface 的旧类：

```
public class MyObject : IMyInterface, IMyInterface2 {
    public int Property1 { get {} set {} }
    public int Property2 { get {} set {} }
} 
```

这样您就不会破坏旧合同，但可以在代码中使用新接口，例如：

```
if (obj is IMyInterface) {
   Console.WriteLine(((IMyInterface)obj).Property1);

   if (obj is IMyInterface2) {
      //more
   }
} 
```

这就是微软所做的。IHTMLDocument 所在的 mshtml 库是一个 COM 库，COM 严重依赖接口。因此，随着库的发展，微软添加了越来越多的接口来公开更新的功能/代码。

IHTMLTxtRange 是更常用的[TextRange](http://msdn.microsoft.com/en-us/library/ms535872(VS.85).aspx)对象的接口。它公开了一系列用于解析文本“片段”或“范围”的功能。

[http://www.webreference.com/js/column12/trmethods.html](http://www.webreference.com/js/column12/trmethods.html)

# wpf - 如何在 ViewModel 中呈现（视图）模型的集合

> ID：838950
> 
> 赞同：11
> 
> 时间：2009-05-08T09:12:50.943
> 
> 标签：wpf, collections, mvvm, viewmodel

我对 C#/WPF 的 MVVM 设计有疑问。我看过几个演示应用程序，但它们并没有真正解决我的问题。我的应用程序由包含其他对象的对象组成。很像亲子关系。

我现在的问题是：

*   children 属性是否必须是 ViewModel
*   如果是这样，我如何创建新的父对象，其中包含通过 ViewModels的**现有子对象？**

我有以下情况：

```
class Child {
    string Name;
}

class ChildVM {
    Child _child;
    string Name{return _child.Name;}
}

class Parent {
    string Name;
    List<Child> children;
}

class ParentVM{
    Parent _parent;

    string Name{return _parent.Name;}
    List<ChildVM> children {get;set;}

    ParentVM(Parent p){_parent = p;}
}

void CreateANewParent(){
    List<ChildVM> children = new List<ChildVM>(){new ChildVM(new Child()),...};
    ParentVM parent = new ParentVM(new Parent());
    foreach(ChildVM child in children)
        parent.children.Add(child);
} 
```

这里的问题是，ParentVM 包含 ChildVM，但实际的 Parent（位于 ParentVM 内部）没有 ChildVM 对象包含的 Child 对象。我也不认为复制子对象是一个好主意，因为它会导致冗余，并且在我的应用程序上下文中，也不需要/不可能创建新的子对象。

我还考虑了以下类设计：

```
class ParentVM {
    Parent _parent;

    string Name{return _parent.Name;}
    List<Child> children {get{return _parent.Children;}}
} 
```

但是，这意味着如果我想操作 ParentVM 的 Child 对象，我将直接对 Model 进行操作。

另一方面，我可以简单地将 (Model) Parent 留空并使用 ParentVM 在数据库中创建一个新的 Parent。但这是处理问题的好方法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-05-21T02:51:09.377

实际上，执行此操作的正确方法是当您第一次创建 ParentVM 时，遍历传入的 Parent 的子项，为每个子项创建一个 ChildVM，然后将这些 ChildVM 对象添加到 ParentVM 的 ChildVMs 属性。（有些人只会称该属性为“Children”，但我个人喜欢明确它是 ChildVM 的集合，而不是 Child 对象的集合。只需添加“VM”后缀即可非常清楚。

然后，您还必须收听实际 Parent's Children 集合的更改通知，并相应地更新您的 ChildVMs 集合。

这样，您就有了一个具有 Parent->Children->Child 的模型和一个 ParentVM->ChildVMs->ChildVM 的 ViewModel，我相信这正是您想要的。

现在我也相信您应该能够直接从 ParentVM 公开 Parent 以及直接从 ChildVM 公开 Child，因为您的 UI 可能绑定到这些项目的各种属性，例如上面的 Name 属性。然而，MV-VM 纯粹主义者会说永远不要这样做，说 UI 永远不应该知道模型，因为如果模型改变，你必须改变 UI。我的论点是，如果模型发生变化，出于完全相同的原因，您无论如何都必须更改 ViewModel。唯一的节省是如果有多个视图都共享相同的 ViewModel，因为您只需要在一个地方更改它，但实际上，像“名称”这样的东西不会将它的“名称”从模型更改为ViewModel 所以在这些情况下，无论如何它都是非论点。

另外，通过“纯粹”方式执行它会产生性能开销，因为您不能像上面对 Name 所做的那样简单地委托给模型项，因为视图永远不会知道模型生成的任何更改Name 属性，除非您还在 VM 中添加了所有额外的更改通知，这意味着您现在在模型中有一个更改通知，其唯一目的是触发*第二个*VM 中的更改通知，然后通知 UI。纯的？是的。性能侵入？您敢打赌，尤其是在进行大量更改并且您正在使用 INotifyPropertyChanged 接口时，因为这意味着您必须在更改处理程序中进行字符串比较以检测和委托所有这些更改！但是，如果您直接绑定到 ParentVM.Parent.Name 属性，您将已经收到来自模型的更改通知以通知 UI，并且您还可以让您的 VM 保持清洁以处理仅特定于 VM 或 View 的内容。

然而，我从不做的是在模型中放置任何仅供查看的信息。这对我来说就是 ViewModel 的用途。因此，例如，如果孩子们有一个基于枚举或其他什么的特定颜色，对我来说，这就是 ChildVM 中的东西，而不是模型本身，如果模型中有任何属性决定该颜色，比如该枚举的属性，在这种情况下，是的，我会从 ChildVM 内的模型连接更改通知。（说实话，我什至可以直接通过 UI 中的颜色转换器来完成它，仍然绑定到模型的枚举。这真的是一个个案。）

高温下，

标记

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T07:03:53.183

好的，我从 .NET 论坛获得了一些帮助和建议：我将通过在 ViewModel 中为模型提供 Get-Method 来解决问题。因此，如果我使用现有的 ChildVM 创建一个新的 Parent，我只需返回 ChildVM 内的 Child 引用并将它们分配给我的新 Parent。

# c# - 插件使用自己的 app.config

> ID：838964
> 
> 赞同：12
> 
> 时间：2009-05-08T09:16:42.133
> 
> 标签：c#, plugins, settings, app-config

在一些人的帮助下，我终于设法构建了一个插件架构的工作解决方案，但现在出现了一个新问题。

我的托管应用程序将它的 app.config 文件用于执行程序集（这是一个 Windows 服务）的一些默认值。

每个插件都应该能够从单独的插件设置文件中加载它自己的设置，因为主机不应该知道插件设置。在插件项目中，我还添加了一个 app.config 文件（带有一些设置和一个连接字符串），以便我可以实例化 Properties.Settings 类并在插件代码中使用它的属性。

问题是当我更改插件的 app.config 中的设置（构建为 plugin.dll.config）时，我看不到插件本身的这些更改，它仍然使用设计时设置。

有没有办法在每个插件中加载 app.config 设置，以便生成的 Properties.Settings 类可以工作？如果没有，是否有另一种方法可以将基于 app.config 的设置文件加载到插件中？我计划在 IPlugin 界面中添加一个 LoadConfiguration 方法，这样每个插件都会加载它自己的设置。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T09:30:36.280

您正在针对 app.config 的体系结构工作。每个可执行文件（EXE，而不是 DLL）都有一个 app.config 文件。可执行文件启动，创建其 AppDomain，然后加载 MyApp.exe.config。您可以在 Visual Studio 中随意添加 app.config 对象，但 DLL 会忽略它们。我认为您想要做的是从 dll.config 手动复制 XML 并将其粘贴到应用程序级别的 app.config 中。（我确信有一种方法可以使用 TeamBuild 或类似的方法自动执行此操作。）然后，您的 Properties.Settings 类将可以使用覆盖的值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-19T08:57:27.027

我更喜欢构建和使用 IConfigManager 类型的插件。它的工作是抽象配置的存储方式。您通过依赖注入收到它的一个实例。这样，IConfigManager 实现可以从多个 .config 文件、网络、数据库或任何其他来源加载设置。我还使用它来提供基于用户、机器和/或应用程序的默认值——它可以被用户覆盖，例如背景颜色、字体等。

此方法的其他优点是可以在所有插件中以一致的方式保留设置 - 无需插件关心，您的插件存储其设置的位置可以透明地更改（从 .config 到其他），最后，IConfigManager 可以在单元测试期间被模拟以模拟不同的情况。

我希望这会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T09:25:37.323

像[ConfigurationManager.OpenMappedExeConfiguration](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.openmappedexeconfiguration.aspx)这样的东西在这里有帮助吗？您可以创建一个从特定文件读取值的配置对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-12T14:23:19.410

我是埃里克的同事。由于他将在接下来的几周内度过一个当之无愧的假期，因此我将详细说明这个问题。

在我们的插件中，我们使用多个 WCF 服务客户端实例。这些服务的巧妙之处在于它们带有 app.config 部分，您可以使用这些部分来配置行为、服务类型、安全性等。

现在，当我们加载插件时，配置中缺少这些部分，因此无法找到正确的端点。当然，我们可以在代码中设置它们，但这会破坏在需要时设置其他配置选项的能力。例如，我们可能想要实现 ws-security。

所以我们需要一种方法来加载这些配置，以便插件可以在那里读取相应的设置。我们当然可以将所有配置合并为一个，但这种方式消除了“仅插件”方法，因为您必须在安装插件的同时管理配置。

我想创建一个小工具，它将“主”配置与放置在项目子目录中的所有配置合并，并用那个替换 .exe.config 文件。我认为这可行，但我想知道 .NET 是否没有提供更好的选择。多个 AppDomain 不是一个可行的方法，因为插件必须相互交互（提供者/消费者模型），我们不想仅仅因为这个问题而切换到远程处理。

更新：我通过使用 ConfigurationManager 打开现有配置以读取 appSettings 解决了大多数问题。至于 WCF 客户端；您可以为服务器和客户端加载端点/绑定配置，如下所示：[http ://weblogs.asp.net/cibrax/archive/2007/10/19/loading-the-wcf-configuration-from-different-files-on -the-client-side.aspx](http://weblogs.asp.net/cibrax/archive/2007/10/19/loading-the-wcf-configuration-from-different-files-on-the-client-side.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-14T16:44:21.617

您可以让每个插件读取它自己的 ConfigurationSection，然后在主配置文件中使用 ConfigSource 设置指向外部文件。（有关更多信息，请参阅此[链接）](https://stackoverflow.com/questions/480538/use-xml-includes-or-config-references-in-app-config-to-include-other-config-files)

您不会完全避免在主 app.config 文件中包含插件配置信息，但至少插件特定设置位于单独的文件中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-24T23:59:51.060

我通常更喜欢通过创建一个专用的 Xml 文件来避免整个 app.config 混乱，主机在该文件中也使用插件的设置进行处理。Xml 看起来像这样：

```
<root>
    <Settings>
        Here's where anything specific to the app goes.
    </Settings>
    <plugins>
        <plugin type="mylibrary.myclass">
            Here I let the plugin serialize itself however it wants to.
        </plugin>
    </plugins>
</root> 
```

然后托管应用程序从*type*属性创建插件并测试该类是否实现**ISerializable**；如果是这样，那么插件将自行反序列化。将插件与应用程序的设置内联有点吓人，但是如果您将插件的 Xml 子字符串加载到新的**XmlReader**中，那么您不必担心插件会因在 Xml 字符串中读取过多而出现错误。

# c# - Java IdentityHashMap 的 C# 等价物

> ID：838965
> 
> 赞同：13
> 
> 时间：2009-05-08T09:17:22.117
> 
> 标签：c#, java, dictionary, hashmap

据我所知，C# 中没有直接的等价物。我目前的想法是使用带有自定义 IEqualityComparer 的 Dictionary 来检查引用是否相等。

然而，这似乎失去了通过散列获得的优势。有没有办法从每个不同的对象中获取一个单独的哈希码？或者这是不可能的，我应该使用其他方法？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-08T09:24:04.970

您可以非虚拟地使用[`RuntimeHelpers.GetHashCode(object)`](http://msdn.microsoft.com/en-us/library/11tbk3h9.aspx)which 调用- 这相当于Java 中的调用。我想这就是你所追求的。因此，您只需将其用于散列和相等性。`object.GetHashCode()``System.identityHashcode``IEqualityComparer``object.ReferenceEquals`

# eclipse - Eclipse：模拟测试平台

> ID：838976
> 
> 赞同：2
> 
> 时间：2009-05-08T09:21:35.040
> 
> 标签：eclipse, eclipse-plugin, eclipse-pde, infinitest

我正在开发一个 Eclipse 插件并对其进行测试。有些是常规的 JUnit 测试，有些是 PDE 测试（即需要启动一个 eclipse 实例才能访问 eclipse 内部）。

我想知道通过为平台创建模拟对象来尝试将一些 PDE 测试转变为常规测试是否是个好主意。这将是很多工作，但我认为这会节省时间，因为测试会运行得更快，而且我们还可以使用 [Infinitest](http://infinitest.org)进行更多测试。

如果有任何反馈，我将不胜感激，这样我就可以决定如何进行。

提前致谢！

最好的问候，弗拉德

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T10:24:30.380

这将是很多工作，因为您无法重用大部分原始代码（其中充斥着大量`private final static`运行时数据，您无法摆脱也无法访问它）。

我建议试一试。如果它看起来完全可行，您可以实现插件所需的内容，然后将结果交给 Eclipse 社区进行扩展。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-17T16:49:33.740

也许这有帮助：

[http://blog.srvme.de/2010/12/10/mock-eclipse-ifile/](http://blog.srvme.de/2010/12/10/mock-eclipse-ifile/)

# mysql - 如何检查mysql数据库是否存在

> ID：838978
> 
> 赞同：336
> 
> 时间：2009-05-08T09:22:14.163
> 
> 标签：mysql, database, exists

建立连接后是否可以检查（MySQL）数据库是否存在。

我知道如何检查数据库中是否存在表，但我需要检查数据库是否存在。如果不是，我必须调用另一段代码来创建它并填充它。

我知道这一切听起来有些不雅 - 这是一个快速而肮脏的应用程序。

* * *

## 回答 #1

> 赞同：519
> 
> 时间：2009-05-08T09:26:54.653

```
SELECT SCHEMA_NAME
  FROM INFORMATION_SCHEMA.SCHEMATA
 WHERE SCHEMA_NAME = 'DBName' 
```

如果您只需要知道数据库是否存在，以便在尝试创建它时不会出错，只需使用（从[这里](http://forums.mysql.com/read.php?101,213455,213496)）：

```
CREATE DATABASE IF NOT EXISTS DBName; 
```

* * *

## 回答 #2

> 赞同：145
> 
> 时间：2012-06-17T10:15:51.430

检查数据库是否存在的一种简单方法是：

```
SHOW DATABASES LIKE 'dbname'; 
```

如果名称为“dbname”的数据库不存在，则会得到一个空集。如果它确实存在，你会得到一排。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2012-03-27T21:43:35.323

从 shell 像 bash

```
if [[ ! -z "`mysql -qfsBe "SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME='db'" 2>&1`" ]];
then
  echo "DATABASE ALREADY EXISTS"
else
  echo "DATABASE DOES NOT EXIST"
fi 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-05-08T09:26:27.133

如果您正在寻找 php 脚本，请参见下文。

```
$link = mysql_connect('localhost', 'mysql_user', 'mysql_password');
if (!$link) {
  die('Not connected : ' . mysql_error());
}

// make foo the current db
$db_selected = mysql_select_db('foo', $link);
if (!$db_selected) {
  die ('Cannot use foo : ' . mysql_error());
} 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2017-04-10T12:04:07.333

一个非常简单的 BASH-one-liner：

```
mysqlshow | grep dbname 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2012-09-14T15:48:48.483

这是一个用于检查数据库是否存在的 bash 函数：

```
function does_db_exist {
  local db="${1}"

  local output=$(mysql -s -N -e "SELECT schema_name FROM information_schema.schemata WHERE schema_name = '${db}'" information_schema)
  if [[ -z "${output}" ]]; then
    return 1 # does not exist
  else
    return 0 # exists
  fi
} 
```

另一种选择是尝试使用数据库。请注意，这也会检查权限：

```
if mysql "${db}" >/dev/null 2>&1 </dev/null
then
  echo "${db} exists (and I have permission to access it)"
else
  echo "${db} does not exist (or I do not have permission to access it)"
fi 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2014-12-12T10:47:01.440

检查 PHP 中是否存在数据库的好方法是：

```
$mysql = mysql_connect("<your host>", "root", "");

if (mysql_select_db($mysql, '<your db name>')) {
    echo "Database exists";
} else {
    echo "Database does not exist";
} 
```

这是我一直使用的方法。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2016-07-20T12:57:42.427

对于那些将 php 与 mysqli 一起使用的人，这是我的解决方案。我知道答案已经得到解答，但我认为将答案作为 mysqli 准备好的语句也会有所帮助。

```
$db = new mysqli('localhost',username,password);
$database="somedatabase";
$query="SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME=?";
$stmt = $db->prepare($query);
$stmt->bind_param('s',$database);
$stmt->execute();
$stmt->bind_result($data);
if($stmt->fetch())
{
    echo "Database exists.";
}
else
{
    echo"Database does not exist!!!";
}
$stmt->close(); 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-11-11T11:49:09.253

使用 bash：

```
if [ "`mysql -u'USER' -p'PASSWORD' -se'USE $DATABASE_NAME;' 2>&1`" == "" ]; then
    echo $DATABASE_NAME exist
else
    echo $DATABASE_NAME doesn't exist
fi 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2015-01-03T23:16:22.083

```
CREATE SCHEMA IF NOT EXISTS `demodb` DEFAULT CHARACTER SET utf8 ; 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2013-03-23T03:45:16.087

```
SELECT IF('database_name' IN(SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA), 1, 0) AS found; 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2018-07-03T00:59:50.370

使用此脚本，您可以获得是或否数据库存在，如果它不存在，它不会抛出异常。

```
SELECT 
    IF(EXISTS( SELECT 
                SCHEMA_NAME
            FROM
                INFORMATION_SCHEMA.SCHEMATA
            WHERE
                SCHEMA_NAME = 'DbName'),
        'Yes',
        'No')  as exist 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-01-12T22:32:42.993

这是我在 bash 脚本中执行此操作的方式：

```
#!/bin/sh

DATABASE_USER=*****
DATABASE_PWD=*****
DATABASE_NAME=my_database

if mysql -u$DATABASE_USER -p$DATABASE_PWD -e "use $DATABASE_NAME";
then
echo "Database $DATABASE_NAME already exists. Exiting."
exit
else
echo Create database
mysql -u$DATABASE_USER -p$DATABASE_PWD -e "CREATE DATABASE $DATABASE_NAME"
fi 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2020-04-17T13:57:03.397

**使用 like 语句检查是否存在时要小心！**

如果在一系列不幸事件中您的变量最终为空，并且您最终执行以下操作：

```
SHOW DATABASES like '' -- dangerous! 
```

它将返回**所有**数据库，从而告诉调用脚本它存在，因为返回了一些行。

使用**“=”**等号来测试是否存在是更安全和更好的做法。

测试存在的正确和安全的方法应该是：

```
SHOW DATABASES WHERE `database` = 'xxxxx' -- safe way to test for existence 
```

请注意，您必须用反引号包装列名数据库，在这种情况下它不能使用宽松的语法。

这样，如果创建变量 'xxxxx' 的代码返回空白，则 SHOW DATABASES 不会返回所有数据库，而是返回一个空集。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-10-02T15:57:32.080

冗长而复杂（但请耐心等待！），这是我创建的一个类系统，用于检查数据库是否存在并创建所需的表：

```
<?php
class Table
{
    public static function Script()
    {
        return "
            CREATE TABLE IF NOT EXISTS `users` ( `id` INT NOT NULL PRIMARY KEY AUTO_INCREMENT );

        ";
    }
}

class Install
{
    #region Private constructor
    private static $link;
    private function __construct()
    {
        static::$link = new mysqli();
        static::$link->real_connect("localhost", "username", "password");
    }
    #endregion

    #region Instantiator
    private static $instance;
    public static function Instance()
    {
        static::$instance = (null === static::$instance ? new self() : static::$instance);
        return static::$instance;
    }
    #endregion

    #region Start Install
    private static $installed;
    public function Start()
    {
        var_dump(static::$installed);
        if (!static::$installed)
        {
            if (!static::$link->select_db("en"))
            {
                static::$link->query("CREATE DATABASE `en`;")? $die = false: $die = true;
                if ($die)
                    return false;
                static::$link->select_db("en");
            }
            else
            {
                static::$link->select_db("en");          
            }
            return static::$installed = static::DatabaseMade();  
        }
        else
        {
            return static::$installed;
        }
    }
    #endregion

    #region Table creator
    private static function CreateTables()
    {
        $tablescript = Table::Script();
        return static::$link->multi_query($tablescript) ? true : false;
    }
    #endregion

    private static function DatabaseMade()
    {
        $created = static::CreateTables();
        if ($created)
        {
            static::$installed = true;
        }
        else
        {
            static::$installed = false;
        }
        return $created;
    }
} 
```

在这种情况下，您可以用`en`您喜欢的任何数据库名称替换数据库名称，也可以将创建者脚本更改为任何内容，并且（希望！）它不会破坏它。如果有人可以改进这一点，请告诉我！

**注意**
如果您不使用带有 PHP 工具的 Visual Studio，请不要担心这些区域，它们是用于代码折叠的：P

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-02-16T08:04:22.067

导轨代码：

```
ruby-1.9.2-p290 :099 > ActiveRecord::Base.connection.execute("USE INFORMATION_SCHEMA")

ruby-1.9.2-p290 :099 > ActiveRecord::Base.connection.execute("SELECT SCHEMA_NAME FROM         INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = 'entos_development'").to_a
SQL (0.2ms) SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME =               'entos_development'
=> [["entos_development"]] 
ruby-1.9.2-p290 :100 > ActiveRecord::Base.connection.execute("SELECT SCHEMA_NAME FROM              INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = 'entos_development1'").to_a
SQL (0.3ms) SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME =            'entos_development1'
=> [] 
```

=> entos_development 存在，entos_development1 不存在

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-02-26T23:09:38.343

```
IF EXISTS (SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = N'YourDatabaseName')
BEGIN    
    -- Database exists, so do your stuff here.
END 
```

如果您使用的是 MSSQL 而不是 MySQL，请参阅[类似线程的此答案](https://stackoverflow.com/questions/679000/how-to-check-if-a-database-exists-in-sql-server)。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-06-07T18:59:05.750

我只使用以下查询：

```
"USE 'DBname'" 
```

然后检查结果是否为 FALSE。否则，可能会出现拒绝访问错误，但我不知道。因此，在涉及特权的情况下，可以使用：

```
"SHOW DATABASES LIKE 'DBname'" 
```

如前所述。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-03-04T11:36:40.497

另一个 php 解决方案，但使用 PDO：

```
<?php
try {
   $pdo = new PDO('mysql:host=localhost;dbname=dbname', 'root', 'password', [ PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION ]);
   echo 'table dbname exists...';
}
catch (PDOException $e) {
   die('dbname not found...');
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-09-15T05:06:53.027

以下解决方案对我有用：

```
mysql -u${MYSQL_USER} -p${MYSQL_PASSWORD} \
-s -N -e "SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME='${MYSQL_DATABASE}'" 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-03-10T10:19:00.010

Golang 解决方案

> 创建一个测试包并添加：

```
import "database/sql"

// testing database creation
func TestCreate(t *testing.T){
    Createdb("*Testdb") // This just calls the **sql.DB obect *Testdb 
    db,err := sql.Open("mysql", "root:root@tcp(127.0.0.1:3306)/*Testdb")
    if err != nil{
        panic(err)
    }
    defer db.Close()
    _, err = db.Exec("USE *Testdb")
    if err != nil{
        t.Error("Database not Created")
    }

} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-01-06T15:26:34.093

当您没有足够的权限查看数据库时，使用`INFORMATION_SCHEMA`or是不可靠的。`show databases`当您无权访问它时，似乎该数据库不存在。然后创建将失败。进行更精确检查的另一种方法是使用 use 命令的输出，即使我不知道这种方法有多可靠（未来版本/其他语言中的文本输出更改......）所以请注意。

```
CHECK=$(mysql -sNe "use DB_NAME" 2>&1)
if [ $? -eq 0 ]; then
  # database exists and is accessible
elif [ ! -z "$(echo $CHECK | grep 'Unknown database')" ]; then
  # database does not exist
elif [ ! -z "$(echo $CHECK | grep 'Access denied')" ]; then
  # cannot tell if database exists (not enough permissions)"
else
  # unexpected output
fi 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-10-28T11:03:14.513

```
SELECT COUNT(*) FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = 'DbName' 
```

1 - 存在，0 - 不存在

# vim - 无法匹配 Vim 中的一个或多个空格

> ID：838979
> 
> 赞同：58
> 
> 时间：2009-05-08T09:22:16.020
> 
> 标签：vim

我想在 Vim 的行首匹配空格

**我想做的伪代码**

```
^( )* 
```

我从手册中知道以下内容

```
notation        meaning             equivalent  decimal value(s)        
-----------------------------------------------------------------------

<Space>         space                            32     *space* 
```

我不确定如何使用十进制值 32。

**如何在 Vim 中匹配一个或多个空格？**

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2009-05-08T10:29:09.120

打字

```
/^ \+ 
```

在命令模式下将匹配一行开头的一个或多个空格字符。

打字

```
/^\s\+ 
```

在命令模式下，将匹配一行开头的一个或多个空白字符（制表符等以及空格）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-08T09:46:43.887

`hlsearch`顺便说一句，如果您使用该选项并且输入后整个文本都会亮起，请不要感到惊讶`/ *`- 而不仅仅是空格。那是因为零空格可以匹配任何地方！

因此，匹配零个或多个任何东西只有在与其他东西结合使用时才有用。

澄清问题后补充：

要匹配行首的一个或多个空格，请执行以下操作：

```
/^\s\+ 
```

看：

```
:help whitespace
:help /\+ 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-08T09:27:18.350

如果我理解正确..

`/ *`将匹配 0 个或多个空格

`/ {0,n}`将匹配 0 到 n 个空格（其中 n 是一个数字）

要匹配从行首开始的 1 个或多个空格：

```
/^ \+ 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-08T10:01:53.943

Vim 中行首的空格：

```
/^  * 
```

那是：

*   `'/'`搜索。
*   `'^'`为线的开始。
*   `' '`至少一个空间。
*   `' *'`之后的零个或多个空格。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-08T09:38:00.490

如果您要匹配任何类型的空格（无论是空格还是制表符），以下正则表达式都适用

```
^[\s]* 
```

`^`匹配行的开头
`[\s]`/`[\t]`匹配空格或制表符（两者似乎都有效，尽管根据你应该使用的vim文档`[\s]`
`*`提供重复，0或更多。

当然使用`/`其他人提到的搜索。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T10:00:45.070

您快到了。您不需要 ( )。正则表达式是 just `"^ *"`，在 Vim 中您使用 / 进行搜索，因此您可以输入`/^ *`

请注意，这在*每一*行都匹配，因为每一行都以零个或多个空格开头！那么，你真的打算这样做吗？如果您的意思是“一个或多个空格”，则需要替换`*`为`\+`（在大多数正则表达式语言中，它是`+`，但`+`在 vim 中被转义）。所以，`/^ \+`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T09:35:42.493

`/ *`匹配零个或多个空格。

例子：

`/foo *bar`将匹配`foobar`, `foo bar`, foo bar `,`etcetera`。

请注意，如果您想在示例中使用括号，则需要使用`\\`. Vim 表达式不是标准的 Perl 正则表达式，也不是 POSIX 正则表达式。你的例子是：

```
\\( \\)* 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T10:11:25.280

要匹配行首的空格或制表符，您还可以使用：`^\s*`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-08T10:13:09.173

我认为你真的可以做的是匹配空格直到某种非空格字符，对吧？试试这个：

```
^\(\+\)
```

或者，对于任何类型的空格：

```
^\(\s\+\)
```

在 Vim 正则表达式 (, ) 和 + 需要转义。此外，如果您打算使用反向引用，则语法是 \1（例如第一组），而不是像 Perl 那样的 $1。

# javascript - 通过javascript进行日期验证

> ID：838983
> 
> 赞同：0
> 
> 时间：2009-05-08T09:23:52.570
> 
> 标签：javascript, validation

请帮我解决我的问题。我在javascript中遇到了一个问题。我的问题是我必须使用日期验证。我有两个日期字段，我在两个日期字段上都进行了验证，但问题是它在一个日期字段上工作，而不是在另一个日期字段上工作。喜欢：

### javascript代码

```
function ValidateDate(DateFrom,DateTo)
{
  var SDate = document.checkbookrequest.txtDateFrom.value;
  var EDate = document.checkbookrequest.txtDateTo.value;
//variables for date from.
//In dob1 i am taking the date which the user is giving 
//and split it into mm/dd/yyyy to compare with current date
    var dob1=document.checkbookrequest.txtDateFrom.value;
    var arr1 = dob1.split("/");
    var m1= arr1[0];
    var d1 = arr1[1];
    var y1 = arr1[2];
//variables for date from.
//In dob i am taking the date which the user is giving 
//and split it into mm/dd/yyyy to compare with current date
    var dob=document.checkbookrequest.txtDateTo.value;
    var arr = dob.split("/");
    var m= arr[0];
    var d = arr[1];
    var y = arr[2];

//these variable for checking the datefiels should not be blank
    var endDate = new Date(EDate);
    var startDate= new Date(SDate);

    if(SDate != '' && EDate != '' && startDate > endDate)
    {

      alert(" Date To must be greater than or equal to Date From.");
      document.checkbookrequest.txtDateTo.value = "";
      document.checkbookrequest.txtDateTo.focus();
      return false;
    }
    else if(SDate == '')
    {
      alert("Please enter Date From");
      document.checkbookrequest.txtDateFrom.focus();
      return false;
    }
    else if(EDate == '')
    {
      alert("Please enter Date To");
      document.checkbookrequest.txtDateTo.focus();
      return false;
    }

//this is to chck the from date
    else if (EDate != "")
    {
      currentdate = new Date();
      a=currentdate.getMonth()+1;
      b=currentdate.getDate();
      c=currentdate.getFullYear();
      if((d==b)&&(m==a)&&(y==c))
    {
      alert('Please Enter valid Date Of Birth');
      return false;
    }
      else if ((d>b)&&(m==a)&&(y==c))
    {
      alert('Please Enter valid Date Of Birth');
      return false;
    }
    else if (y<=c-100)
    {
      alert('Please Enter valid Date Of Birth');
      return false;
    }
    else{
      document.checkbookrequest.cmd.value='btnSearch';
      document.checkbookrequest.submit();
    }
 }

//this is to chck the to date
    else if (SDate != "")
    {
      currentdate = new Date();
      a=currentdate.getMonth()+1;
      b=currentdate.getDate();
      c=currentdate.getFullYear();
      if((d1==b)&&(m1==a)&&(y1==c))
      {
        alert('Please Enter valid Date Of Birth in DateFrom');
        return false;
      }
      else if ((d1>b)&&(m1==a)&&(y1==c))
      {
        alert('Please Enter valid Date Of Birth in DateFrom');
        return false;
      }
      else if (y1<=c-100)
      {
        alert('Please Enter valid Date Of Birth in DateFrom');
        return false;
      }
      else{
       document.checkbookrequest.cmd.value='btnSearch';
       document.checkbookrequest.submit();
      }
    }

    else{
      document.checkbookrequest.cmd.value='btnSearch';
      document.checkbookrequest.submit();
    }        
  } 
```

### html代码

```
<td>Date From:<font color="red">*</font></td>
<td><input type="text" name="txtDateFrom" ></td>

<td>Date To:<font color="red">*</font></td>
<td><input type="text" name="txtDateTo"> </td>

<input type="button" name="btnSearch" value="Search" onclick="return ValidateDate(txtDateFrom,txtDateTo)" /></td> 
```

如果我把“dateto”验证放在上面，那么它就可以工作，但是如果我把它放在验证日期之后，那么日期从是有效的，而日期是不工作的

这有什么不对吗？请帮助我...在此先感谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T10:07:22.683

我建议您完全远离这条路，并通过使用无法输入无效数据的控件来减轻您的头痛。为什么不使用[jQuery 日历](http://docs.jquery.com/UI/Datepicker)进行输入。有了两个有效日期，您的验证代码现在将仅限于检查结束日期是否早于开始日期

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T10:21:16.237

My guess is that there is something wrong with the nested if's.

[EDIT] If that's not it, refactor the code. Move the various checks into new JavaScript functions. This should make the code shorter and easier to understand. Try to avoid duplicating any checks, even if it makes the JS slower -- your main task is to *understand*, not to *optimize* the code. You can optimize later, if you find the code is too slow (which it won't be).

Then create tests which verify that the code actually behaves the way you expect it to. You can use one of the many JS frameworks or use a little trick: Define a function which adds text to an element with the ID `debug`. In your code, call that function at various places with the current values of variables, etc. Check that the values are correct.

Later, you can simply define the function to be empty or add a `return` as the first command to disable it.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T12:32:26.743

我支持 Aaron 的重构建议。通过将现有的大功能分解成更小的单元，定位错误会容易得多。

至于在 JavaScript 中验证日期，您可能会发现这很有帮助：

```
var dateFromTxtBox = new Date(document.getElementById('txtDateFld').value);
if (isNaN(dateFromTxtBox))
{
  alert('Invalid date entered in text box');
  return;
} 
```

此时，您知道用户给出了正确的日期，您可以使用 dateFromTxtBox 变量来测试其他验证（例如，在特定日期之前/之后）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-24T12:34:29.423

我使用 jQuery UI 日期方法来验证日期，它工作得很好：

> $.datepicker.parseDate('dd/mm/yy', '26/01/11');

您可以将其与**try/catch**一起使用来确定验证

* * *

*（我知道这需要 jQuery 并且它不是一个独立的解决方案，但我将它作为一个简单的替代方案提供）*

# java - 哪个更快，equalsIgnoreCase 或 compareToIgnoreCase

> ID：838987
> 
> 赞同：9
> 
> 时间：2009-05-08T09:24:12.663
> 
> 标签：java, string

在 java 应用程序中，假设我可以选择以下比较方法

**equalsIgnoreCase（字符串另一个字符串）**

**compareToIgnoreCase（字符串 str）**

哪个更快？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-08T09:30:44.813

`equalsIgnoreCase` *可以*快很多。例如，考虑两个以相同的 10,000 个字符开头的字符串 - 但其中一个在末尾有一个额外的字符。`equalsIgnoreCase`可以立即返回；`compareToIgnoreCase`必须迭代到字符串的末尾才能看到差异。

但一般来说，我会选择更能表达你意图的那个。这对性能也很有效：假设我说得对`equalsIgnoreCase`，至少与 一样快`compareToIgnoreCase`，这意味着您应该尽可能使用它 - 如果您需要实际订购，`compareToIgnoreCase`无论如何您都必须使用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-08T09:30:39.823

如果您担心性能...**衡量它**

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-08T09:31:49.010

查看 java.lang.String 的源代码

```
 public boolean equalsIgnoreCase(String anotherString) {
    return (this == anotherString) ? true :
           (anotherString != null) && (anotherString.count == count) &&
       regionMatches(true, 0, anotherString, 0, count);
 } 
```

因此，在逐个字符地查看实际的字符串（这也以类似的方式发生`compareToIgnoreCase`）之前，`equalsIgnoreCase`还要检查引用标识和字符长度，这可能会快得多。

# sql - 如何创建具有稳定时间格式的时间表？

> ID：838988
> 
> 赞同：0
> 
> 时间：2009-05-08T09:24:38.213
> 
> 标签：sql, sql-server, sql-server-2005

我怎样才能得到结果“我的梦想表结果”

```
CREATE TABLE #temp(
    [count] int
  , [Time] nvarchar(50))
DECLARE @DateNow DATETIME,@i int

SET @DateNow='00:00'
SET @i=1;
WHILE(@i<1440)
    BEGIN
        SET @DateNow=DATEADD(minute, 1, @DateNow)
        INSERT INTO #temp ([count], [Time]) VALUES (0, @DateNow)
        SET @i=@i+1
    END
SELECT [count],CONVERT(VARCHAR(max), [Time], 104) AS [Time] FROM  #temp
DROP TABLE #temp 
```

表结果：

```
Count  |                 Time
-----------------------------
    0  |  Jan  1 1900 12:01AM
    0  |  Jan  1 1900 12:02AM
    0  |  Jan  1 1900 12:03AM
    0  |  Jan  1 1900 12:04AM 
```

但我不喜欢这张桌子时间格式不好。我需要这张桌子我的梦想桌子结果：

```
Count   |   Time
    0   |  12:01
    0   |  12:02
    0   |  12:03
    0   |  12:04
    ...
    ...
    0   |  22:01
    0   |  22:02
    0   |  22:03
    0   |  22:04 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T09:34:53.900

@DateNow 是一个 DateTime 所以也会有 Date Compoent

```
select right(left(convert(nvarchar, @DateNow, 121), 16), 5) 
```

将为您提供放入 yoru Nvarchar 列的时间组件

```
while(@i<1440)
begin
    set @DateNow=DATEADD(minute, 1, @DateNow)
    insert into #temp ([count], [Time]) values(0, right(left(convert(nvarchar, @DateNow, 121), 16), 5))
    set @i=@i+1
end
SELECT [count], [Time] from  #temp
drop table #temp 
```

对于shits'n'giggles，这里是如何在不依赖 DateTime 对象的情况下做到这一点。

```
CREATE TABLE #temp (
   [count] int,
   [Time] nvarchar(50) 
)

DECLARE @hour int, @min int, @i int
SELECT @hour = 0, @min = 0, @i = 1

WHILE (@hour < 24)
BEGIN
    WHILE (@min < 60)
    BEGIN
        INSERT INTO #temp ([count], [time]) 
        VALUES (@i, REPLACE(STR(@hour, 2, 0), ' ', 0) + ':' + REPLACE(STR(@min, 2, 0), ' ', 0))
        set @min = @min + 1
        set @i=@i+1
    END     
    set @min = 0
    set @hour = @hour + 1
END

SELECT * FROM #Temp 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T17:10:27.480

SQL Server 2008 包含时间数据类型的概念。

看一下这个：

```
CREATE TABLE dbo.Table_1
(
testtime time(7) NULL,
testdate date NULL,
testdatetime datetime NULL
)  ON [PRIMARY]
GO

insert table_1
(testtime, testdate, testdatetime)
values (GETDATE(), GETDATE(), GETDATE())

CREATE TABLE dbo.Table_2
(
testtime time(0) NULL,
testdate date NULL,
testdatetime datetime NULL
)  ON [PRIMARY]
GO
insert table_2
(testtime, testdate, testdatetime)
values (GETDATE(), GETDATE(), GETDATE())

select * from Table_2
select * from Table_1 
```

# python - Python cgi 和标准输入

> ID：838991
> 
> 赞同：1
> 
> 时间：2009-05-08T09:26:34.217
> 
> 标签：python, cgi, stdin

我正在使用 pycurl 通过 put 和 python cgi 脚本上传文件以在服务器端接收文件。本质上，服务器端的代码是：

```
while True:
   next = sys.stdin.read(4096)
   if not next:
       break
   #.... write the buffer 
```

这似乎适用于文本，但不适用于二进制文件（我在 Windows 上）。对于二进制文件，执行 stdin.read 的循环在接收到大约 10kb 到 100kb 的任何内容后会中断。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T09:30:14.333

您需要以二进制模式运行 Python。从以下位置更改您的 CGI 脚本：

```
#!C:/Python25/python.exe 
```

或它所说的任何内容：

```
#!C:/Python25/python.exe -u 
```

或者您可以像这样以编程方式执行此操作：

```
msvcrt.setmode(sys.stdin.fileno(), os.O_BINARY) 
```

在开始阅读之前`stdin`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T10:15:11.433

使用[mod_wsgi](http://code.google.com/p/modwsgi/)代替 cgi。它将为您提供正确打开的上传输入文件。

# mysql - mysqld [v5.0.51a] 在调用存储过程时反复重启

> ID：838992
> 
> 赞同：0
> 
> 时间：2009-05-08T09:26:49.787
> 
> 标签：mysql, mysqli

我在 MySQld 的服务器错误日志中反复收到此信息。在我的 PHP (MySQLi) 或 SQL 客户端（不确定它们使用什么，可能还有 MySQLi）调用*一些*（不是全部）存储过程时，会发生这种情况，并且我收到错误消息“在查询期间丢失与 MySQL 服务器的连接”（重复） . 这个程序昨天确实有效；（。谢谢。

```
/usr/sbin/mysqld, Version: 5.0.51a-3ubuntu5.1-log ((Ubuntu)). started with:
Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock
Time                 Id Command    Argument
090508 10:18:43       1 Connect     validuser@user-5440b1b4.wfd77a.dsl.pol.co.u$
                      1 Query       BEGIN
090508 10:18:44       1 Query       call `test_graphstats`(1, 'gbp', 'MONTH')
/usr/sbin/mysqld, Version: 5.0.51a-3ubuntu5.1-log ((Ubuntu)). started with:
Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock
Time                 Id Command    Argument 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T09:48:15.100

这似乎是 SQL 中的一行的问题，我在其中调用了我自己的存储函数之一。所以，我想需要一个反复试验的方法。

# cookies - ASP.NET 中有服务器端 cookie 的概念吗？

> ID：838994
> 
> 赞同：2
> 
> 时间：2009-05-08T09:26:55.870
> 
> 标签：cookies, server-side

不确定我是否在这里遗漏了基本的 ASP.NET 概念，但是否存在服务器端 cookie 的概念。我知道如何在服务器上创建 HTTPCookie 并将其发送到客户端。但是，即使客户端禁用 cookie，服务器端 cookie 是否也允许使用 cookie？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T09:34:49.390

ASP.NET 有一个会话对象的概念。无论用户是否启用了 cookie，它都应该存储少量信息。

[http://msdn.microsoft.com/en-us/library/ms972429.aspx](http://msdn.microsoft.com/en-us/library/ms972429.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T09:34:45.210

存在在服务器上存储数据的替代方案。我使用会话状态。在服务器上存储有关当前用户的信息

[http://www.dotnetjunkies.com/quickstart/aspplus/doc/stateoverview.aspx](http://www.dotnetjunkies.com/quickstart/aspplus/doc/stateoverview.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-14T10:39:38.193

Cookies 存储在内存中，这是在客户端。

当服务器收到页面命中时，您可以设置会话变量 - 但不能设置*cookie*本身。

Cookies 是客户端，无法到达服务器端。

但是，如果有人知道有关服务器端 cookie 的任何概念，也请告诉我。****`