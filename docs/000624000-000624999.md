# StackOverflow 问答 000624000-000624999

# php - 基本 .htaccess mod_rewrite。（更明确）

> ID：624006
> 
> 赞同：0
> 
> 时间：2009-03-08T17:55:26.907
> 
> 标签：php, regex, apache, .htaccess

继续[**上一个问题**](https://stackoverflow.com/questions/623161/help-with-basic-htaccess-modrewrite)

我被告知使用

```
RewriteRule ^error/(.*) index.php?error=$1 [L]
RewriteRule ^file/(.*) index.php?file=$1 [L] 
```

和

```
RewriteCond %{HTTP_HOST} !^www\.mysite\.com$ [NC] 
```

在每个之前，但它并没有真正帮助我。

我正在使用通配符子域我怎样才能做出这种情况：

```
RewriteCond %{HTTP_HOST} !^www\.mysite\.com$ [NC] 
```

动态的，例如它是否是任何子域（www.除外），那么我需要更改什么。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-08T19:09:50.847

我不确定我是否理解您的问题，但回忆一下 RewriteCond 的第二个参数是一个正则表达式可能会有所帮助，因此您可以编写如下内容：

```
RewriteCond %{HTTP_HOST} ^[a-z]+\.mysite\.com$ [NC] 
```

至于排除 www，您可以链接规则（它们是和在一起的）或使用您的正则表达式。我建议前者，因为它通常更容易理解。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T20:06:04.563

我认为你没有理解[Gumbo 的建议](https://stackoverflow.com/questions/623161/help-with-basic-htaccess-modrewrite/624024#624024)。我已经把它包括在这里：

```
# stop rewriting for the host names example.com and www.example.com
RewriteCond %{HTTP_HOST} ^(www\.)?example\.com$
RewriteRule ^ - [L]

RewriteRule ^error/(.*) index.php?error=$1 [L]
RewriteRule ^file/(.*) index.php?file=$1 [L] 
```

这专门对 www.example.com 和 example.com 执行不重写。如果我们在example.com 的*任何其他*子域上，则 error/ 和 file/ 重写适用。

如果你想反转测试，你可以这样做：

```
RewriteCond %{HTTP_HOST} !^(www\.)?example\.com$
RewriteRule ^error/(.*) index.php?error=$1 [L]

RewriteCond %{HTTP_HOST} !^(www\.)?example\.com$
RewriteRule ^file/(.*) index.php?file=$1 [L] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T05:00:46.870

这使我摆脱了构建复杂正则表达式的类似情况，它也可能对您有所帮助。

[http://www.addedbytes.com/apache/mod_rewrite-cheat-sheet/](http://www.addedbytes.com/apache/mod_rewrite-cheat-sheet/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T20:51:31.117

我使用 php 并为我的框架创建了一个系统，我认为它在很多方面都更加高效和安全，但非常感谢您的建议！

:]<3

# ruby - 别名方法导致不同的对象？

> ID：624008
> 
> 赞同：1
> 
> 时间：2009-03-08T17:57:13.140
> 
> 标签：ruby, methods, alias, string-interpolation

```
def foo
    "foo"
end

alias foo2 foo
puts "foo2: " + foo2.object_id.to_s
puts "foo: " + foo.object_id.to_s 
```

在上面的示例中，我希望每个方法调用都看到相同的 object_id 输出，因为它们引用了相同的方法。为什么我看到不同的 object_id？当您在 Ruby 中为方法设置别名时，别名不是指原始对象，而不是副本吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T18:19:52.307

您正在调用`object_id`由返回的对象`foo`，该对象是在方法中创建的字符串，因此每次都会有所不同。如果您只调用`foo`两次，您会看到相同的结果。它每次都返回一个新字符串。如果您想要一个常量字符串，请`:foo`改为返回符号。

除此之外，即使它们现在共享相同的实现，它们*也是*不同的方法。如果您覆盖`foo`返回字符串“bar”，`foo2`仍将继续返回“foo”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T00:06:01.273

根据您的各种评论重新开始一个新的答案。

在示例代码中，您*调用*的是方法，而不是引用它。你想用

```
method(:foo) 
```

实际获取方法本身，而不是调用它的结果。

此外，`object_id`这不是测试两个方法是否相同的正确方法，因为`method(:foo)`每次都返回一个新的 Method 对象。打个比方，如果你打开同一个文件两次，即使底层文件相同，你也会有两个不同的文件句柄。相反，我认为你想要：

```
method(:foo) ==  method(:foo2) 
```

如果您尝试一下，您会看到它返回`true`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T19:02:57.523

尝试：

```
FOO = "foo"
def foo
    FOO
    end

alias foo2 foo
puts "foo2: " + foo2.object_id.to_s
puts "foo: " + foo.object_id.to_s 
```

以获得您想要的效果。“foo”是一个表达式，每次调用该函数时都会对其进行评估。要了解这是为什么，请考虑您也可以编写：

```
def foo
    "It is now #{Time.now}"
    end

alias foo2 foo
puts "foo2: " + foo2.object_id.to_s
puts "foo: " + foo.object_id.to_s 
```

# php - 在 MySQL 中插入 mm/dd/yyyy 格式的日期

> ID：624009
> 
> 赞同：5
> 
> 时间：2009-03-08T17:57:43.610
> 
> 标签：php, mysql

如何使用 PHP 将 MM/DD/YYYY 格式的日期插入 MySQL 数据库？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-08T18:03:30.520

这可以使用[STR_TO_DATE](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html)来完成。

例子：

```
INSERT INTO useless_table (id, date_added) VALUES(
            1, STR_TO_DATE('03/08/2009', '%m/%d/%Y')); 
```

编辑：还请考虑 MarkR 的解决方案，因为这是正确的做法[tm]。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-08T18:07:03.477

MySQL 支持 ISO-8601 日期/时间值，不支持其他。如果您需要使用其他一些古怪的格式（例如，因为您的美国客户希望日期不准确），您需要自己进行转换。

忍受它吧，ISO-8601 是一种真正的日期格式。

# asp.net-mvc - ASP.Net MVC 的登录状态？

> ID：624012
> 
> 赞同：4
> 
> 时间：2009-03-08T18:00:16.973
> 
> 标签：asp.net-mvc, security, authentication

如何获取 ASP.Net MVC 的 LoginStatus？我可以在 MVC 上进行连接和身份验证，但我不确定如何获取 LoginStatus，有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-08T18:10:35.183

当您创建一个新的 MVC 项目时，csproj 模板会创建一个名为“LoginUserControl”的局部视图，位于*~/Views/Shared/LoginUserControl.ascx*。

该视图具有以下逻辑，根据当前用户是否登录呈现不同的文本：

```
<%
    if (Request.IsAuthenticated) {
%>
        Welcome <b><%= Html.Encode(Page.User.Identity.Name) %></b>!
        [ <%= Html.ActionLink("Logout", "Logout", "Account") %> ]
<%
    }
    else {
%> 
        [ <%= Html.ActionLink("Login", "Login", "Account") %> ]
<%
    }
%> 
```

# database - 关系数据库中的高级功能如何工作？

> ID：624017
> 
> 赞同：2
> 
> 时间：2009-03-08T18:04:24.280
> 
> 标签：database, rdbms, relational-database

简而言之，我了解关系数据库、索引、复制、锁定、并发等的基础知识，以及与简单的表达，例如：

```
SELECT EventID,EventName FROM Events WHERE CustomerID=5 ORDER BY EventType 
```

但我不了解关系数据库中的任何“高级”主题，例如：

*   域
*   约束
*   指数

谁能给我一个快速入门，对这些方面的作用以及它们如何工作的大致解释？

您可能会否决并完全丢弃这个问题，但请向我解释一下这些主题是如何工作的，因为我需要非常快速地了解关系数据库。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-08T18:14:39.263

维基百科关于[关系数据库](http://en.wikipedia.org/wiki/Relational_database)和[关系模型](http://en.wikipedia.org/wiki/Relational_model)的文章是一个很好的起点。它们具有指向您提到的特定主题的其他文章的链接，并且这些具有示例，例如：

*   [域](http://en.wikipedia.org/wiki/Data_domain)
*   [约束](http://en.wikipedia.org/wiki/Check_constraint)
*   [指数](http://en.wikipedia.org/wiki/Index_(database))
*   [主键](http://en.wikipedia.org/wiki/Unique_key)和[外键](http://en.wikipedia.org/wiki/Foreign_key)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T00:09:28.677

我认为您将面临的一个问题是，不同 RDBMS 实现之间的功能差异很大。Oracle 中的锁定、一致性和并发性与`<insert random name of other system here>`. 如果您对某个特定的 RDBMS 感兴趣，那么我会敦促您调查该特定系统是如何实现它们的，因为正如他们所说，魔鬼在细节中。

例如，从[http://docs.oracle.com](http://docs.oracle.com/)上的每个版本的 HTML 和 PDF 版本的 Oracle 概念指南开始。

# asp.net - JQuery tbody 问题 - ASP.NET

> ID：624018
> 
> 赞同：0
> 
> 时间：2009-03-08T18:05:32.530
> 
> 标签：asp.net, jquery

我有一个看起来像这样的 aspx 页面：

```
<table runat="server" id="tblTEst">
  <tr id="trHeader" runat="server">

  </tr>
  <tr id="trRow1" runat="server">

  </tr>
  <tr id="trRow2" runat="server">

  </tr>
</table> 
```

当我写我的 JQuery 说得到 s 的计数时，我需要做：

```
alert($('#' + strTableId).children('tbody').children('tr').length); 
```

我的问题是何时添加 TBODY？当我做一个 InnerHTML 时，我确实看到了 TBODY。我想知道这是否是 ASP.NET 所做的事情？

**编辑感谢您的回答。如果是浏览器添加的，我是否需要担心在多个浏览器中测试代码以确保 JQuery 的兼容性？我的印象是，JQuery 与所有浏览器兼容，我不必担心在不同浏览器上测试代码。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T18:15:51.130

它既不是 ASP.Net 也不是 jQuery，它是您的浏览器。jQuery 访问由浏览器基于 ASP.Net 生成的 HTML 代码构建的页面 DOM。对于表，当没有明确声明时，会添加一个 TBODY 元素来保存表的“主体”行 (TR)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T18:17:43.403

这是浏览器在构建 DOM 时清理 HTML 过程的一部分。该[标准规定](http://www.w3.org/TR/html4/struct/tables.html#h-11.2.1)TR 元素必须出现在 TBODY、THEAD 或 TFOOT 元素中，并且由于您没有指定这些元素，因此浏览器会为您添加一个来帮助您。

如果您想忽略这一点，您可以将表达式重写为：

```
alert($('#' + strTableId).find('tr').length); 
```

...但是，您最好在 TBODY 中明确地包装您的行，以避免将来出现混淆。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T18:59:31.340

最好的办法是在服务器端使用 tbody 正确构建表。然后，您不必担心浏览器之间的不一致。

# c++ - 32 位 Linux 时钟（）溢出

> ID：624037
> 
> 赞同：2
> 
> 时间：2009-03-08T18:17:51.377
> 
> 标签：c++, linux, time, clock

我需要在 Linux（和其他类 Unix 系统）上的 C++ 中测量长时间计算所花费的 CPU（不是挂钟）时间，所以我使用的是 clock()。问题：在 32 位系统上，这会在大约 2000 或 4000 秒后回绕。

推荐的解决方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-08T18:33:10.497

您想使用`getrusage`填充以下结构：

```
struct rusage {
    struct timeval ru_utime; /* user time used */
    struct timeval ru_stime; /* system time used */
    ...
}; 
```

为了完成，`struct timeval`：

```
struct timeval {
    time_t      tv_sec;     /* seconds */
    suseconds_t tv_usec;    /* microseconds */
}; 
```

与往常一样，请参阅手册页了解详细信息 ( `man getrusage`)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T18:24:06.150

您需要提供的精度`clock()`吗？如果没有，您可以使用`time()`两次并取差：

```
time_t start, end;
double diff;

time(&start);
// Do your stuff...
time(&end);
diff = difftime(end, start); 
```

**编辑：** `time()`测量实时（不是 CPU 时间），正如 litb 在他的评论中指出的那样，但`clock()`. 如果你想测量 CPU 时间，你应该遵循 litb 的建议并使用`getrusage()`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T21:26:55.587

另一种可能的方法是使用 gettimeofday() 两次，因为它返回毫秒精度。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-08T18:25:25.040

定期获取时间并在每次翻转时增加一个乘数变量 int？

# asp.net-mvc - 从 ASP.NET MVC 视图返回时如何将相关实体保留在对象上

> ID：624041
> 
> 赞同：1
> 
> 时间：2009-03-08T18:22:55.747
> 
> 标签：asp.net-mvc, entity-framework

我正在使用实体框架开发 ASP.NET MVC RC2 应用程序。

这是我的实体图。

![](https://i.stack.imgur.com/NFAc4.png)

在我的存储库中，我得到这样的实体：

```
public Product GetProduct(int id)
{
    return (from c in _entities.ProductSet.Include("User")
           where c.Id == id
           select c).FirstOrDefault();
} 
```

我的观点：

```
<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage<SampleApp.Models.Product>" %> 
```

编辑产品

```
<h2>Edit product</h2>

<%= Html.ValidationSummary("Edit was unsuccessful. Please correct the errors and try again.") %>

<% using (Html.BeginForm()) {%>

    <fieldset>
        <legend>Fields</legend>
        <p>
            <label for="Id">Id:</label>
            <%=  Model.Id %>
        </p>
        <p>
            <label for="Title">Title:</label>
            <%= Html.TextBox("Title", Model.Title) %>
            <%= Html.ValidationMessage("Title", "*") %>
        </p>
        <p>
            <label for="Body">Body:</label>
            <%= Html.TextBox("Body", Model.Body) %>
            <%= Html.ValidationMessage("Body", "*") %>
        </p>
        <p>
            <input type="submit" value="Save" />
        </p>
    </fieldset>

<% } %>

<div>
    <%=Html.ActionLink("Back to List", "Index") %>
</div> 
```

问题和我的问题是：当从帖子视图返回“产品”实体时，链接实体“用户”为空。为什么会这样，有什么办法可以解决这个问题？

![](https://i.stack.imgur.com/ZADHo.png)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T18:27:56.860

因为 productToEdit 是从表单字段填充的新产品对象，如果您没有用户字段，您将如何填充 User 实体

对于“解决方法”，首先从数据库中获取产品，使用 productToEdit 中的已编辑字段对其进行编辑并保存到数据库

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T19:57:54.163

您还可以选择使用了解您的模型和持久性策略的自定义 ModelBinder 将图形完全加载回内存。

# python - django 登录中间件未按预期工作

> ID：624043
> 
> 赞同：1
> 
> 时间：2009-03-08T18:24:40.173
> 
> 标签：python, django, django-authentication

一个快速的，希望是一个简单的。我正在关注[http://docs.djangoproject.com/en/dev/topics/auth/](http://docs.djangoproject.com/en/dev/topics/auth/)上的文档，以获取一些简单的用户身份验证。我根本没有什么特殊要求，我只需要知道用户是否登录，仅此而已。我正在使用 login_required 装饰器，它的工作方式完全符合我的预期。我实际上使用 'django.contrib.auth.views.login' 作为我的登录视图，以及它们在文档中显示的确切形式：

```
{% if form.errors %}
<p>Your username and password didn't match. Please try again.</p>
{% endif %}

<form method="post" action=".">
<table>
<tr>
    <td>{{ form.username.label_tag }}</td>
    <td>{{ form.username }}</td>
</tr>
<tr>
    <td>{{ form.password.label_tag }}</td>
    <td>{{ form.password }}</td>
</tr>
</table>

<input type="submit" value="login" />
<input type="hidden" name="next" value="{{ next }}" />
</form> 
```

我想我不明白的是为什么我可以在用户/密码字段中放入我想要的任何内容，并且我从未收到无效用户/密码组合的错误。我可以输入不存在的用户，使用正确密码的正确用户，基本上我想要的任何内容，它都会将我发送到“下一个”变量中的任何内容。这让我相信它实际上并没有做任何事情。我在登录后检查了我通过请求变量发送的内容，并且我始终显示为 AnonymousUser，即使我“成功登录”。我在这里忽略了一些明显的东西吗？好像我现在已经阅读了关于身份验证的页面 6 或 7 次。

此外，如果我以具有“员工身份”的用户身份登录，我将显示为已通过身份验证，没有任何问题。如果用户没有该状态，则它不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-08T18:38:37.770

我相信我修复了它：

对：

```
url(r'^login/$', 'django.contrib.auth.views.login', {'template_name': 'quiz/quiz_login.html'}) 
```

错误的：

```
url(r'^login$', 'django.contrib.auth.views.login', {'template_name': 'quiz/quiz_login.html'}) 
```

嗯。

# ruby - 移除鞋子中的事件

> ID：624048
> 
> 赞同：2
> 
> 时间：2009-03-08T18:26:10.717
> 
> 标签：ruby, events, shoes

有什么方法可以删除鞋子中的事件？我搜索了许多网站和参考资料，但找不到任何删除事件的方法……我介意我需要创建自己的事件管理器……真的有必要吗？或者有办法解除事件监听器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T15:10:18.590

我发现 Shoes 只允许在给定事件上使用单个侦听器方法，因此您可以通过调用事件而不向其传递块来删除以前的侦听器。

例如，这款鞋类应用在点击一次后会清除点击事件。**如果您删除块内的click**调用，那么它将重复触发。

```
Shoes.app
  @p = para "Empty"
  @click_count = 0
  click do |b,x,y| 
    @click_count += 1
    @p.replace "Clicked #{@click_count} time(s)."
    click # remove the click handler
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T08:18:45.407

您要删除哪些键绑定？鞋子应用程序上的所有事件还是只是默认绑定？

如果您想覆盖为鞋子保留的绑定，例如“alt-/”、“alt-.”、“alt-?”，请将以下代码粘贴到包含您的应用程序代码的文件中

```
class Shoes::App
  def Shoes.show_log # gets called on alt-/
  end

  def Shoes.show_manual # gets called on alt-?
  end

  def Shoes.show_selector # gets called on alt-.
  end
end 
```

上面的代码猴子修补了鞋子代码，当相应的键被按下时，反过来什么也不做。

您可以对其余的默认绑定使用相同的技术。grep 键绑定的鞋子源，找到相应的方法并在您的应用程序中定义一个空方法以覆盖内置方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T18:55:09.697

你试过[method.unbind(obj)](http://www.ruby-doc.org/core/classes/Method.src/M001929.html)吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T18:56:00.613

您能否澄清“删除事件”的含义？您是要忽略特定事件还是要“关闭”事件侦听器？

如果是前者，我建议编写一个忽略该事件的侦听器。

如果是后者，为什么不让侦听器的主体以某些外部可访问的值为条件，给自己一个开/关开关。

如果您想要其他东西，请编辑问题以澄清，我稍后会停下来编辑我的答案。

作为对您的评论的回应，我重新建议上述替代方案中的第二个。如果你想变得非常花哨，你可以写这样的东西：

```
$keypress_listeners = {}
keypress do |key|
    $keypress_listeners.values.each { |l| l.call(key)
    end
$keypress_listeners[:hero_controller] = lambda { |key| ... }
:
:
$keypress_listeners.delete[:hero_controller] 
```

对于任何其他事件也是如此，但这可能是矫枉过正。另一方面，它可以让您完全控制事件处理。

# python - PyQt 中 wx 的空闲和 UI 更新事件

> ID：624050
> 
> 赞同：2
> 
> 时间：2009-03-08T18:26:51.637
> 
> 标签：python, qt, wxpython, pyqt

wx（和 wxPython）在 PyQt 中有两个我想念的事件：

*   `EVT_IDLE`被发送到一个框架。它可用于根据应用程序的状态更新各种小部件
*   `EVT_UPDATE_UI`当它必须重新绘制和更新时被发送到一个小部件，所以我可以在处理程序中计算它的状态

现在，PyQt 似乎没有这些，PyQt 书建议编写一个`updateUi`方法并手动调用它。我什至最终每 0.1 秒从计时器调用一次，以避免从可能更新 GUI 的方法中进行许多手动调用。我错过了什么吗？有没有更好的方法来实现这一目标？

* * *

一个例子：我有一个简单的应用程序，带有一个启动按钮，可以启动一些处理。仅当使用菜单打开文件时才应启用开始按钮。此外，状态栏上还有一个显示信息的永久小部件。

我的应用程序有状态：

1.  打开文件之前（在这种状态下，状态栏显示一些特殊的东西并且开始按钮被禁用）
2.  文件已打开且未开始处理：启动按钮已启用，状态栏显示其他内容
3.  处理正在运行：开始按钮现在显示“停止”，状态栏报告进度

在 Wx 中，我会让按钮的更新 UI 事件处理其状态：其上的文本，以及它是否已启用，具体取决于应用程序状态。状态栏也是如此（或者我会使用 EVT_IDLE）。

在 Qt 中，我必须在几个可能影响状态的方法中更新按钮，或者只是创建一个 update_ui 方法并在计时器中定期调用它。什么是更“QT”的方式？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T01:40:31.297

在 wxWidgets 中使用 EVT_UPDATE_UI 似乎突出了 wxWidgets 和 Qt 期望开发人员在其代码中处理事件的方式的根本区别之一。

使用 Qt，您可以在用户界面中的小部件之间连接信号和插槽，或者在每个插槽中处理“业务逻辑”，或者将其委托给专用方法。您通常不必担心对 GUI 中的每个小部件进行单独更改，因为任何重绘请求都将放置在事件队列中，并在控制返回事件循环时交付。为了效率，一些绘制事件甚至可以合并在一起。

因此，在使用信号和槽来处理状态更改的普通 Qt 应用程序中，基本上不需要有空闲机制来监视应用程序的状态并更新小部件，因为这些更新应该自动发生。

您将不得不多说一些关于您正在做什么来解释为什么您需要在 Qt 中与此事件等效的事件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T14:06:54.310

我会发送 Qt 信号来指示状态变化（例如 fileOpened、processingStarted、processingDone）。管理开始按钮和状态栏小部件（或子类）的对象中的插槽可以连接到这些信号，而不是“轮询”空闲事件中的当前状态。

如果您希望信号在事件循环中稍后而不是立即延迟（例如，因为它会花费一些时间来做某事），您可以使用“排队”信号槽连接而不是正常类型。

[http://doc.trolltech.com/4.5/signalsandslots.html#signals](http://doc.trolltech.com/4.5/signalsandslots.html#signals)

连接类型是 connect() 函数的可选参数： [http://doc.trolltech.com/4.5/qobject.html#connect](http://doc.trolltech.com/4.5/qobject.html#connect)，[http://doc.trolltech.com/4.5/qt.html#ConnectionType-枚举](http://doc.trolltech.com/4.5/qt.html#ConnectionType-enum)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T21:04:37.683

据我了解，EVT_IDLE 在应用程序消息队列为空时发送。Qt 中没有这样的事件，但是如果你需要在没有未决事件的情况下在 Qt 中执行某些事情，你应该使用 0 超时的 QTimer。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T18:31:03.723

一般来说，更 Qt 的方式是在任何需要更新的功能中根据需要更新按钮/工具栏，或者整合一些功能并在程序需要时直接调用该功能（例如 updateUi 功能）。

您应该知道，在 Qt 中，更改 Ui 元素的属性不会导致立即重绘，但会在事件系统中对重绘进行排队，并且在可能的情况下将多个重绘调用压缩为一个。

至于与状态相关的多项更改，请查看[这篇博客文章](http://labs.qtsoftware.com/blogs/2009/01/30/qt-state-machine-framework/)，了解即将推出的 Qt 新增功能，以便更轻松地处理状态。看起来这会解决你的很多抱怨，因为在你的多个函数中，你可以只转换状态变量，并且 UI 的其他部分应该更新以匹配。这并不肯定它会进入下一个 Qt 版本（尽管我会打赌，或者类似的东西），而且我不知道 PyQt 与 Qt 版本的跟踪有多密切。或者，您可以使用该概念并创建自己的类来根据需要跟踪状态。

# linux - IP 数据包在源主机上分段的频率如何？

> ID：624055
> 
> 赞同：4
> 
> 时间：2009-03-08T18:31:30.733
> 
> 标签：linux, networking, kernel, fragmentation, ip-protocol

我知道，如果 IP 有效负载 > MTU，那么路由器通常会将 IP 数据包分段。最后，使用 IP-ID、IP 分段偏移和分段标志字段在目的地组装所有分段的数据包。IP 有效负载的最大长度为 64K。因此，L4 移交 64K 的有效载荷非常合理。如果 L2 协议是以太网（通常是这种情况），那么 MTU 大约为 1600 字节。因此，IP 数据包将在源主机本身被分段。然而，快速搜索一下 Linux 中的 IP 实现告诉我，在最近的内核中，L4 协议是分段友好的，即它们*试图*通过移交大小接近 MTU 的缓冲区来为 IP 节省分段工作。

考虑到这两个事实，我想知道 IP 数据包在源主机本身被分段的频率。它有时/很少/从不发生吗？有谁知道linux内核中的碎片规则是否有例外（即是否存在L4协议对碎片不友好的情况）？这在其他常见的操作系统（如 Windows）中是如何处理的？一般来说，IP 数据包分段的频率如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T18:58:12.417

尽管从技术上讲，不应该有任何协议不能正确处理 IP 分片，但有一些协议（例如 NFS）[从缺乏分片中受益匪浅](http://wiki.linux-nfs.org/wiki/index.php/NFS_Howto_Optimization#Overflow_of_Fragmented_Packets)。

您看到分段数据包的频率很大程度上取决于您的网络环境。VPN 的数据包封装、设计或实施不当的 UDP 协议以及将端到端 MTU 降至端点值以下的 L1/L2 协议都可能导致 IP 分段。

大多数现代主机都实现[了 PTMUD](http://en.wikipedia.org/wiki/Path_MTU_discovery)，它将[自动](http://www.netheaven.com/pmtu.html)检测 MTU 大小，除非涉及[不兼容的设备或过度偏执的防火墙](http://kerneltrap.org/node/579)。在以太网无处不在的这些日子里，我不希望它们在整个互联网上特别普遍。

# c# - OOP 中的默认参数是不好的做法吗？

> ID：624057
> 
> 赞同：10
> 
> 时间：2009-03-08T18:33:49.607
> 
> 标签：c#, oop, default

方法的默认参数是否违反封装？

在 C# 中不提供默认参数的原因是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-08T18:38:39.423

我会[将此](https://docs.microsoft.com/en-us/archive/blogs/csharpfaq/does-c-have-default-parameters)作为微软的“官方”回答。但是， C# 4.0 中肯定会提供*默认*（和命名）参数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T18:36:52.640

不，它不会以任何方式影响封装。这根本不是经常需要的。通常，创建采用较少参数的重载是一种更灵活、更简洁的解决方案，因此 C# 的设计者根本没有看到将默认参数的复杂性添加到语言中的理由。

添加“做同样事情的另一种方法”始终是一种权衡。在某些情况下，它可能很方便。但是，您使语法越合法，语言学习起来就越复杂，您可能会越多地陷入困境，从而阻止未来的扩展。（也许他们有一天会为该语言提出另一个扩展，它使用类似的语法。然后那将不可能添加，因为它会与他们之前添加的功能冲突）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T19:37:44.087

如前所述，默认参数不是优先功能，但可能会在 C# 4.0 中添加。但是，我相信有充分的理由不早点包含它（在 4.0 中，据我了解，它主要是为了支持[鸭子类型](http://en.wikipedia.org/wiki/Duck_typing)的编程风格，其中默认参数增加了类型兼容性）。

我相信过多的参数列表（肯定超过 4-5 个不同的参数）是一种[代码异味](http://en.wikipedia.org/wiki/Code_smell)。默认参数本身并不邪恶，但有可能鼓励糟糕的设计，延迟重构为更多对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-08T18:36:29.677

对于您的第一个问题-不，这与提供多个重载构造函数完全相同。至于第二个，我不能说。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-08T18:39:27.097

默认参数将包含在 C# 4.0 中

一些关于它的阅读材料：

[点击](http://codebetter.com/blogs/matthew.podwysocki/archive/2008/10/29/c-4-0-named-and-optional-parameters-behind-the-scenes.aspx)

[点击](http://community.bartdesmet.net/blogs/bart/archive/2008/10/31/c-4-0-feature-focus-part-1-optional-parameters.aspx)

看来[这篇文章](http://blogs.msdn.com/samng/archive/2009/02/03/named-arguments-optional-arguments-and-default-values.aspx)的作者将在不久的将来发表一篇关于“为什么”MS选择在C#中实现默认参数的文章

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-08T18:41:26.437

这是一个答案，为什么它没有在 C# [http://blogs.msdn.com/csharpfaq/archive/2004/03/07/85556.aspx中提供](http://blogs.msdn.com/csharpfaq/archive/2004/03/07/85556.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-08T18:59:18.327

C# 4.0 中默认参数实现的一个缺点是它创建了对参数名称的依赖关系。这在 VB 中已经存在，这可能是他们选择在 4.0 中实现它的原因之一。

另一个缺点是默认值取决于您如何投射对象。你可以在这里阅读：[http](http://saftsack.fs.uni-bayreuth.de/~dun3/archives/optional-parameters-conclusion-treat-like-unsafe/216.html) ://saftsack.fs.uni-bayreuth.de/~dun3/archives/optional-parameters-conclusion-treat-like-unsafe/216.html 。

# asp.net - 从 asp.net 迁移到 python 进行 Web 开发时，我应该注意什么？

> ID：624062
> 
> 赞同：3
> 
> 时间：2009-03-08T18:34:58.980
> 
> 标签：asp.net, python

我正在考虑将应用程序从 Asp.net 转换为 python。我想知道：将 asp.net 应用程序移动到 python（插入框架）时要注意的关键比较是什么？

python有用户控件吗？母版页？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-08T18:44:05.930

首先，Python 是一种语言，而 ASP.NET 是一种 Web 框架。事实上，您可以使用[IronPython](http://www.codeplex.com/IronPython)编写 ASP.NET 应用程序。

如果您想放弃 ASP.NET 并使用 Python“堆栈”，那么您可以从几个不同的 Web 应用程序框架中进行选择，包括[Django](http://en.wikipedia.org/wiki/Django_(web_framework))和[Zope](http://en.wikipedia.org/wiki/Zope)。

例如，Zope 提供了一种可插入的架构，您可以在其中“添加”诸如 wiki、博客等之类的东西。它还有页面模板，有点类似于 ASP.NET 母版页。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-08T19:18:05.037

我支持 Out Into Space 关于 python 是一种语言还是一种 Web 框架的说明；这是一个重要的观察结果，几乎是您从 ASP.NET 迁移到 Python 所经历的一切的基础。

同样，您还会发现 C#/VB.NET 和 Python 在语言风格和开发人员社区方面的差异会影响开发 Web 框架的基本方法。无论您是从用 java、php、ruby、perl 或任何其他语言编写的 Web 框架迁移，这都是一样的。

古老的“当你有一把锤子，一切看起来都像钉子”这句格言在框架的基本设计中得到了体现对于螺丝刀。

例如，与 ASP.NET 相比，Python Web 框架对声明式配置的依赖要少得多。例如，Django 只有一个配置文件，实际上只有几十行（一旦去掉注释:-)）。同样，与 ASP.NET 相比，URL 配置和页面生命周期非常紧凑，但同样强大。配置上有更多的“约定”（尽管 Rails 少得多），并且大量使用 Python 中的模块是语言中的顶级对象这一事实......并非所有东西都必须是一个类。这减少了所涉及的代码量，并使应用程序流具有高度可读性。

正如 Out Into Space 提到的，zope 的页面模板“有点”类似于 ASP.NET 母版页，但不完全一样。Django 还提供了相互继承的页面模板，它们工作得很好，但如果你想像 ASP.NET 模板一样使用它们，那就不行了。

Python Web 框架中也没有用户控件的传统，例如 .NET。配置机制、请求/响应过程间接、处理程序复杂性和代码库大小并不是 Python 开发人员对其工具集的感觉的一部分。

我们都认为您可以使用 pythonic-tools 构建相同的 Web 应用程序，代码可能更少，并且更易于调试/维护 :-) 这里的主要好处是您还可以利用 python 语言和 pythonic框架，这就是让 Python 开发人员在早上很高兴上班的原因。YMMV，当然。

所有这一切，你会发现你可以做你一直做的一切，只是不同。从长远来看，无论这些差异是否令人愉悦或令人沮丧，您都将确定 Python Web 框架是否适合您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T03:38:56.040

大多数 python 框架都有一个“模板”引擎，它提供了与 ASP.NET 的母版页和用户控件类似的功能。:)

感谢 Out Of Space 和 Jarret Hardie 的回复

# jakarta-ee - 在单独的线程上为 Web 应用程序编写

> ID：624071
> 
> 赞同：1
> 
> 时间：2009-03-08T18:38:47.597
> 
> 标签：jakarta-ee, jboss

对于我的客户将要调用的 URL 之一，我希望它尽快返回，并且将中断降至最低，因此即使数据库已关闭或速度较慢，请求仍然会很快返回。

我仍然需要对发送的数据进行一些处理，所以我正在考虑有一个单独的“队列”来保存数据，然后几乎实时地处理，但在一个单独的线程中。

在我开始编写这个队列之前，我想问一下是否有现成的类/库可以做到这一点？

这是一个使用 jboss 部署的 java web 应用程序。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-08T18:43:29.020

强烈建议不要在 J2EE 应用程序中创建自己的线程，这超出了 J2EE 规范。我不认为你会找到一个 J2EE 库来做你想做的事。

J2EE 的主要优点之一是服务器为您管理所有线程（和其他资源）。如果您开始创建自己的线程，服务器不知道它们并且无法照顾它们，因此您将面临潜在的资源泄漏问题以及其他令人头疼的问题。创造一个短语，你不会得到一只狗并自己吠叫。

您最好尝试创建一个使用[JMS](http://java.sun.com/products/jms/)的解决方案。JMS 都是关于处理消息队列的，因此应该很好地满足您的要求。 [这是一篇文章，讨论了这一点。](http://www.geocities.com/sundar_rajan_in/java/jms/intro.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T19:03:51.080

JMS 的替代方法是将请求持久保存在数据库中，然后使用调度程序完全处理它们。您可以为此使用[Quartz](http://www.quartz-scheduler.org/)或[Java EE 计时器](http://www.onjava.com/pub/a/onjava/2004/10/13/j2ee-timers.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T13:41:58.567

实际上，您可以使用[commonj](http://sourceforge.net/projects/jbosscommonj/)创建所需的线程。它提供了一种在 Java EE 容器中使用线程和计时器的轻量级方式。[此处](https://stackoverflow.com/questions/533783/why-spawning-threads-in-j2ee-container-is-discouraged/533847#533847)的更多信息以及此问题已被多次提出。

这使您可以确认 Java EE 中资源管理的限制，并避免使用更重量级的 JMS 解决方案（尽管它也可以工作）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T19:06:57.857

这不是依靠 Ajax 的完美场景吗？您的长加载页面会立即返回，并包含一个 javascript ajax 请求以获取您的长处理请求。当请求未决时，用户面临一个微调器或其他方式来通知他该请求可能需要一些时间。一旦返回，响应就会通过 javascript 插入到您的页面中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T21:13:42.013

我使用 Doug Lea 的[PooledExecutor](http://gee.cs.oswego.edu/dl/classes/EDU/oswego/cs/dl/util/concurrent/PooledExecutor.html)非常成功地处理了这类事情。现在还有[ExecutorService](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ExecutorService.html)直接在 Java 5 和更新版本中。

有一些评论强烈建议不要在 J2EE 中使用您自己的线程。好吧，任何时候你自己穿线都必须小心，这真的没有什么不同。我发现让服务器处理所有事情的 J2EE 方式有点令人不安，并且不喜欢它限制您可以采取的设计选择的方式。

只是我的50美分...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-27T02:13:32.233

该实现最终成为一个 JMS 消息和一些处理数据的消息驱动 Bean，到目前为止效果很好，并且扩展得非常好。

我感谢所有帮助和评论，特别是 commonj，以及有关手动创建线程的警告。

# .net - 在 WPF 应用程序上与艺术家合作的最佳方式是什么？

> ID：624072
> 
> 赞同：2
> 
> 时间：2009-03-08T18:38:52.213
> 
> 标签：.net, wpf, user-interface, graphics

我即将完成我的应用程序的核心组件，我愿意尽快换档并进行一些 GUI 编程。从一开始我就决定编写一个基于 WPF 的应用程序，原因有两个：

```
a) I want my application to be visually stunning and 100% skineable.
b) I completely suck at designing user interfaces and then some more. 
```

所以计划是让一个 GUI 艺术家参与这个项目，让他接管它的每一个视觉方面。但是，我以前从未在 WPF 项目中工作过，也不知道如何处理这个问题。我想听听有这方面经验的人可以提供一些建议。

谢谢。

编辑：

我没有提到它，但是是的，艺术家将使用 MS Expression Blend 软件。我更感兴趣的是知道如何与他合作，而不是他将使用什么工具。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T21:30:56.513

*   确保您的项目使用 MVVM 模式。这使得 UI 设计人员可以更轻松地完成工作，而不会影响应用程序的其他部分。
*   使用命令而不是事件并将它们暴露给 VM 中的绑定
*   避免在 View 的代码后面的任何代码。当您使用命令时，唯一真正需要的是将窗口的 DataContext 设置为 ViewModel 的行。有时，您还会有事件侦听器来侦听 ViewModel 事件以弹出新窗口。
*   尽可能多地使用数据绑定，它只会让一切工作更顺利。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-09T15:24:32.500

始终首先创建一个功能齐全的 GUI，然后将其传递给艺术家以“皮肤”它 - 这样 XAML 的内部结构将适合所有逻辑和数据绑定。

如果您让艺术家设计皮肤，然后添加逻辑，您很可能会得到无法直接使用的 XAML，您将回到 WPF 的旧“尝试使应用程序看起来像漂亮的图片”应该解决。

当然，在您将文件传递给艺术家之前，您必须让所有可用性方面都正常工作（按用户工作流程排列元素，支持键盘导航等），并且可能在您获得结果后再次工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T18:42:18.353

使用 Expression Blend for Designer 创建 UI 的最佳方式。然后，您可以连接事件。

这是带有 Sliverlight 和 XAML 的 MS 的目标。Expression Designer 工具就是为此而生的。确保设计每次都符合最终产品，因为开发人员和设计人员每次都使用工具来创建正确的 XAML。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-08T19:09:00.707

正如 Longhorn213 所说，Expression Blend 是您的答案。

Blend 的绝妙之处在于它使用与 Visual Studio 相同的项目/解决方案格式，但主要侧重于 XAML。这样，设计者可以随心所欲地使用应用程序，而不会弄乱您的代码。

不过，您的任务不仅仅是“连接事件”。更有可能的是，您会交替工作，甚至同时处理该项目。您将提供他/她将使用和触发的数据源、事件等。也许他/她会想要一些您将构建的自定义控件。等等。

VS/Blend 组合是一个美妙的新世界，最终在整个项目生命周期中实现开发人员和设计人员之间的真正协作。欢呼！

# c - Strange OpenCV Distance Transform Results

> ID：624085
> 
> 赞同：0
> 
> 时间：2009-03-08T18:54:01.273
> 
> 标签：c, ubuntu, opencv, computer-vision

I'm trying to run a distance transform on a thresholded binary image in order to assist anomaly detection (my hope is that I can detect large changes around the edges of the object), however for some reason, upon running my Distance Transform script, I'm getting a strange banding type of effect. I tested something similar in the Distance Transform demo script in the samples directory, with the same results. One possible reason I came up with was that the distance was going beyond the 0-255 scale and therefore essentially being modulus'ed to keep it within the boundaries. Has anyone had any experience with this that could advise? [I have posted images and code on my blog if that helps](http://www.phatgfx.co.uk/blog/?p=59) Thanks in advance, Ian

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T19:14:30.803

One quick way to test your theory: try with a grey scale image that's muted (all values v --> 128+(v-128)/32 or something) and see if that makes the bands much wider or eliminates them completely.

It's always a good idea to nail down what the problem is first, and *then* try to fix it.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T08:58:09.717

I can't help with the code, but I'd like to point out that the [expected result](http://www.phatgfx.co.uk/blog/wp-content/uploads/2009/03/disttrans_correct-website.png) on your blog is probably incorrect as well: look at the sharp black-gray border in the bottom part of the large object: it should not be there, as the maximum difference between two adjacent pixels should be 1.

# jquery - 单击下拉列表时启用当前禁用的下拉列表

> ID：624102
> 
> 赞同：4
> 
> 时间：2009-03-08T19:03:52.967
> 
> 标签：jquery, html, events, drop-down-menu

**这是场景：** 我有两个单选按钮，1) 用于普通客户，2) 用于业务合作伙伴，它也有一个下拉控件，因此可以选择 X 个业务合作伙伴之一。选择一个客户类型时，其他部分随着对控件的正常禁用和应用CSS来获得禁用外观的暗示。

我正在努力争取的是，当单选按钮、旁边的标签以及在业务伙伴部分的情况下，单击下拉列表时，应该启用特定部分。我发现的是，当“标签”环绕单选按钮和下拉列表时，当启用相反部分时，它的属性 disabled=true 通过 jQuery，实际上单击下拉列表不会“ t 启用该部分。此外，我认为是正确的下拉列表不会触发 click 事件，因为它的禁用状态设置为 true。我尝试使用单选按钮和标签的单击事件，但禁用的下拉列表似乎是一个事件处理黑洞。我正在使用 jQuery 和 Asp.net MVC，但我确信至少，

单选按钮和标签单击事件将通过 IE7 中的禁用下拉列表触发，但不会通过 Firefox3 或 Chrome 浏览器触发。

有任何想法吗？

```
<label for="CustomerRadio">
 <input id="CustomerRadio" checked="checked" 
        name="usertype" type="radio"
        value="Customer" />Customer
</label> 

<label  for="BusinessPartnerRadio">
  <input id="BusinessPartnerRadio"
         name="usertype" type="radio"
         value="BusinessPartner" />Business Partner
    <select id="businessPartnerType" name="businessPartnerType">
      <option selected="selected" value="Builder">Builder</option>
      <option value="InstallDealer">Install Dealer</option>
      <option value="RepairDealer">Repair Dealer</option>
    </select>
</label> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T06:41:41.063

你是绝对正确的， disabled 属性将选择框变成了一个黑洞。即使是普通的浏览器右键单击 Firefox 上下文菜单也无法解决它。

听起来您的意图是在单击其标签容器时重新启用选择框，那么禁用状态是否只是为了外观？.. 如果是这样，如果您使用 CSS 不透明度使选择框*看起来*只是禁用了怎么办？

```
<style type="text/css">
  label.disabled select { opacity: 0.6; filter: alpha(opacity=60); }
</style>

<script type="text/javascript">
  $(function() {
    $('div.formdiv').bind('click',function() {
      $('label.disabled',this).removeClass('disabled');
      $('input:radio',this).attr('checked',true);
      $('div.formdiv').not(this).find('label').addClass('disabled').find('select').attr('selectedIndex',0);
    }).find('label').addClass('disabled');
  });
</script>

<div class="formdiv">
 <label for="CustomerRadio">
  <input id="CustomerRadio" checked="checked" name="usertype" type="radio" value="Customer" />Customer
 </label>
</div>

<div class="formdiv">
 <label for="BusinessPartnerRadio">
  <input id="BusinessPartnerRadio" name="usertype" type="radio" value="BusinessPartner" />Business Partner
 </label>
 <label>
  <select id="businessPartnerType" name="businessPartnerType">
   <option selected="selected" value="Builder">Builder</option>
   <option value="InstallDealer">Install Dealer</option>
   <option value="RepairDealer">Repair Dealer</option>
  </select>
 </label>
</div> 
```

测试页面在这里： http: [//www.carcomplaints.com/test/motowilliams.html](http://www.carcomplaints.com/test/motowilliams.html)

似乎在 FF3 中可以正常工作，我猜 Chrome 浏览器也是如此。不幸的是，在 IE7 中（希望我每次说这话时都能得到一个五分之一），如果您直接单击它，选择框会立即失去焦点.. IE 内部的一些东西，似乎与选择对象上的不透明度过滤器更改有关。

侧边栏......暂时忽略您的“禁用”选择框问题：即使您在标签上使用“for = ...”语法，我认为在单个标签中包含多个表单元素是无效的标签。如果它是有效的，也许不是一个好主意。整个想法是单击标签内的任意位置将焦点放在链接的表单元素上，因此从理论上讲，您的选择框（这是标签中的第二个表单元素）永远不会获得焦点。FF3 正确地处理了这个问题——如果你在不禁用选择框的情况下尝试你的代码，你会看到问题。

希望有帮助。第一张海报建议的 div 覆盖可能是要走的路。我想我只是尝试使用您相同的 HTML 代码的替代解决方案，调整以解决每个标签的多个表单元素问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T22:38:29.003

尝试在表单元素的顶部放置一个透明的 div（这对 jQuery 来说应该不会太难），并让该 div 捕获您的鼠标点击。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T19:45:03.513

这是我[在这里](http://www.sawyourad.com/technobotts/experiments/PursuitCurves.htm)使用的解决方案。基本上，单击控件*周围*的包装会导致选择框启用和禁用。由于您的标签包含所有内容，因此不需要额外的标签（除了脚本）。

```
<script type="text/javascript">
function setCustomer(Customer)
{
    //disable the business controls
    document.getElementById('BusinessPartnerType').disabled = Customer;

    //set the radio button selection
    document.getElementById('cradio').checked = Customer;
    document.getElementById('bradio').checked = !Customer;
}
</script>

<label for="CustomerRadio" id="CustomerLabel" onclick="setCustomer(true);">
    <input id="CustomerRadio" checked="checked" name="usertype" type="radio" value="Customer" id="cradio" />
    Customer
</label> 

<label for="BusinessPartnerRadio" onclick="setCustomer(false);">
    <input id="BusinessPartnerRadio" name="usertype" type="radio" value="BusinessPartner" id="bradio" />
    Business Partner
    <select id="businessPartnerType" name="businessPartnerType" id="businessPartnerType">
        <option selected="selected" value="Builder">Builder</option>
        <option value="InstallDealer">Install Dealer</option>
        <option value="RepairDealer">Repair Dealer</option>
    </select>
</label> 
```

希望这能解决问题。

# ajax - 即保存onunload错误

> ID：624110
> 
> 赞同：0
> 
> 时间：2009-03-08T19:10:28.177
> 
> 标签：ajax, internet-explorer, internet-explorer-7, xmlhttprequest

我有一个动态 ajaxy 应用程序，当用户关闭资源管理器窗口时我保存状态。它在所有浏览器中都可以正常工作，但在 IE 中存在问题。关闭两次应用程序选项卡后，我无法再连接到服务器。

我的理论是，在关闭选项卡时与服务器的连接无法完成，并且 ie7 认为它与服务器有 2 个未完成的连接，因此无限期地将新连接排队。

任何人都经历过这种情况，任何解决方法或解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-12T15:19:20.627

在 IE 中，如果您使用长轮询 AJAX 请求，您必须在“卸载”时关闭 XHR 连接。否则，即使您离开您的网站，它也会被浏览器保持活动状态。这些保持活动的连接将导致挂起，因为您的浏览器将达到最大打开连接限制。

在其他浏览器中不会出现此问题。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-08T19:46:12.443

好吧，您可以很容易地绕过连接限制；只需创建一个通配符域并指示您的应用循环子域；egarsrc.dmvnoc.com、b.rsrc.dmvnoc.com 等，用于我的[netMail 应用程序](http://demo.internetconnection.net/netmail/)。如果没有这个技巧，在 LAN 上预加载所有图像大约需要 30 秒（因为 MSIE 的低连接限制），但有了它，图像下载大约需要 1 秒。

如果您需要将脚本与此技巧相结合，只需`document.domain`在新脚本中设置为父级即可。

但是，您可能希望检查点更改状态 - 用户可能会丢失他们的网络连接，或者他们的计算机可能会崩溃。如果你想减少网络流量，让客户端简单地设置一个包含相关状态的 cookie——你可以在里面放很多东西（3000 字节左右）然后服务器在下一个连接上自动获取它——它在哪里可以保存结果（就像现在一样）并删除 cookie 以表明它已保存状态。

# .net - DataContract 与 XmlType

> ID：624111
> 
> 赞同：6
> 
> 时间：2009-03-08T19:10:58.643
> 
> 标签：.net, xml, wcf

作为尝试学习 WCF 的一部分，我正在阅读序列化。我正在努力理解如何在 .NET 3.5 中控制序列化。例如，我有一个带有一些公共属性的简单类。通过将 DataContract 属性添加到该类，我可以控制命名空间和类的名称，因为它被序列化。

另一方面，我可以添加 Serializable 属性（可能甚至不需要）和 XmlType 属性，这也允许我控制用于序列化类的命名空间和名称。

我实现了这两种方法，并将 ServiceContract 中的类用作接口调用的一部分。然后我使用 Http 分析器查看各种对象是如何序列化的，我注意到 XmlType 根本没有影响 http 中的 xml。

我整天都在试图理解这一点。我错过了什么？

**更新：** 我确实了解两者之间的区别以及它们存在的原因。我只是不明白为什么我不能用 XmlType 或（只是尝试了 XmlRoot）影响生成的 xml。

基本上，您可以通过实现 IXmlSerializable 来控制序列化的所有细节，除了名称空间和顶级元素的名称。为此，我假设您需要 XmlType 或 XmlRoot 属性。我错了吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T19:25:17.313

DataContractSerializer 的重点是*不*控制序列化的细节。相反，这个想法是将您的数据序列化为可以被最多数量的客户端使用的形式。

无需关心模式的细节，而是根据要发送和接收的数据成员定义数据契约。它是对数据的非常抽象的描述。它被序列化为一种非常简单的格式，反映了抽象的描述。

只有在绝对需要控制要序列化或反序列化的 XML 细节的情况下，才应使用 XML 序列化器。当您不需要那么多控制时，请坚持使用 Data Contract Serializer。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T19:13:29.527

请参阅[XmlSerializer 与 DataContractSerializer：Wcf](http://www.danrigsby.com/blog/index.php/2008/03/07/xmlserializer-vs-datacontractserializer-serialization-in-wcf/)中的序列化。

**编辑**：

请参阅[使用 .NET XML 属性自定义您的 .NET 对象 XML 序列化](http://blogs.microsoft.co.il/blogs/rotemb/archive/2008/07/27/customize-your-net-object-xml-serialization-with-net-xml-attributes.aspx)。首先让您的数据序列化为您想要的形式。然后放`XmlSerializerFormat`属性。

```
[ServiceContract]
[XmlSerializerFormat]
public interface MyService
{
    [OperationContract]
    [XmlSerializerFormat]
    void MyMethod();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T05:42:10.327

澄清点：[Serializable] 属性与 XmlSerialization 无关。[Serializable] 属性与 Runtime.Serialization 有关。令人困惑，是的。

.NET 中有太多的序列化程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T21:30:08.607

嗯，有很多关于 DataContractSerializer 与 XmlSerializer 的比较。

我想我认为的主要观点是：

*   DataContract 是“选择加入”的——您需要向任何字段或属性（公共、私有、内部或其他）显式添加一个 [DataMember] 属性以进行序列化——如果您没有，它就不会在那里。XmlSerializer 只会序列化所有公共属性

*   DataContract 允许您指定数据元素的特定顺序 - XmlSerializer 只是使用它们在源代码中出现的顺序

*   XmlSerializer 需要一个公共的、无参数的类构造函数

在简单的示例中，DataContractSerializer 的这些优点可能看起来并不多，实际上 - 但如果您的数据对象不必*具有*公共无参数构造函数，并且您没有将表面元素“人为地”作为公共属性，只是为了将它们包含在序列化中。

马克

# c# - 选项类型在 F# 中如何工作

> ID：624116
> 
> 赞同：10
> 
> 时间：2009-03-08T19:14:30.337
> 
> 标签：c#, .net, f#

所以我一直在阅读 Apress 的 Expert F# 书，主要是在构建玩具式 F# 库时将其用作参考，但有一点我没能掌握，那就是“选项”类型。

它是如何工作的，它在现实世界中的用途是什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-08T19:37:47.737

选项类型至少*类似于*C#中的`Nullable<T>`和引用类型。type 的值`Option<T>`要么`None`意味着没有封装的值，要么`Some`具有特定的`T`. 这就像`Nullable<int>`C# 中的 a 是*空*值*或*具有关联`int`的方式一样 - 并且`String`C# 中的值是*空*引用*或*引用 String 对象的方式。

当您使用选项值时，您通常会指定两条路径 - 一条用于有关联值的情况，另一条用于没有*关联*值*的*情况。换句话说，这段代码：

```
let stringLength (str:Option<string>) =
  match str with
  | Some(v) -> v.Length
  | None -> -1 
```

类似于：

```
int StringLength(string str)
{
    if (str != null)
    {
        return str.Length;
    }
    else
    {
        return -1;
    }
} 
```

我相信一般的想法是*强迫*你（好吧，几乎）处理“没有关联的值/对象”的情况会使你的代码更加健壮。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-08T19:45:52.210

实际使用的最佳示例之一是 .Net 中的[TryParse](http://msdn.microsoft.com/en-us/library/ms229009.aspx)模式。看前半部分

[http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!181.entry](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!181.entry)

进行讨论。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-08T19:40:58.370

当函数或方法应该“可能”或“可选地”返回值时使用它。在 C# 中，您可能会返回 null，或者返回[Null 对象](http://en.wikipedia.org/wiki/Null_Object_pattern)或值类型的 Nullable。

返回 null（最常见的情况）的缺点是它不是类型安全的：null 是所有类型的实例，因此您稍后会遇到各种毛茸茸的 null 引用情况。

Option 类型是所谓的有区别的联合类型，有两个构造函数：None 和 Some a。None 明确表示您没有值。基本上它是广义的空对象模式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-09T03:20:11.667

添加到其他答案中， Option 类型没什么特别的——它只是另一个有区别的联合。您可以在一行中自己定义它：

```
type 'a Option = None | Some of 'a 
```

正如其他人所指出的那样，该实用程序是模式匹配将让您安全地解构它，而不是检查 null 或使用一些 hack-workaround 来指示一个值是否真的是一个值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-08T19:37:17.707

当值是可选的时使用它。一种用途是拥有一种“空引用”，例如

```
 val x : int option ref = None 
```

然后您可以稍后将 x 更新为 Some v。您可以将它与 match 语句一起使用，例如

```
 match !x with (* dereference x *)
    None -> (* No value, do something *)
 |  Some v -> (* Value v, do something else *) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-17T21:48:36.243

使用选项类型的功能模式：

当您需要更改递归数据结构的一部分时，例如树或列表，您将希望尽可能多地重用现有数据结构。选项类型可以帮助您解决此问题。这两个函数都将所有出现的数字 5 替换为 7，但第一个函数复制了整个树。第二个没有。

```
type Tree = Leaf of int
      | Node of Tree * Tree

let rec replace_no_sharing tree =
    match tree with
    | Leaf 5      -> Leaf 7
    | Leaf x      -> Leaf x
    | Node (a, b) -> Node (replace_no_sharing a, replace_no_sharing b)

let replace_with_sharing tree =
    let rec replace_option tree =
        match tree with
        | Leaf 5      -> Leaf 7 |> Some
        | Leaf x      -> None
        | Node (a, b) -> match replace_option a, replace_option b with
                         | None, None     -> None
                         | Some a, Some b -> Node (a, b) |> Some
                         | Some a, None   -> Node (a, b) |> Some
                         | None, Some b   -> Node (a, b) |> Some
    match replace_option tree with
    | None      -> tree
    | Some tree -> tree 
```

可能并非在所有情况下都需要它，但这是一种很好的技术。

# php - 是否可以加快 PHP 中的递归文件扫描？

> ID：624120
> 
> 赞同：9
> 
> 时间：2009-03-08T19:18:51.870
> 
> 标签：php, performance, recursion, find, iteration

我一直在尝试在 PHP 中复制[Gnu Find](http://www.gnu.org/software/findutils/)（“find .”），但似乎无法接近它的速度。PHP 实现使用至少两倍于 Find 的时间。有没有更快的方法用 PHP 做到这一点？

编辑：我添加了一个使用 SPL 实现的代码示例——它的性能等于迭代方法

EDIT2：当从 PHP 调用 find 时，它实际上比原生 PHP 实现慢。我想我应该对我所拥有的感到满意:)

```
// measured to 317% of gnu find's speed when run directly from a shell
function list_recursive($dir) { 
  if ($dh = opendir($dir)) {
    while (false !== ($entry = readdir($dh))) {
      if ($entry == '.' || $entry == '..') continue;

      $path = "$dir/$entry";
      echo "$path\n";
      if (is_dir($path)) list_recursive($path);       
    }
    closedir($d);
  }
}

// measured to 315% of gnu find's speed when run directly from a shell
function list_iterative($from) {
  $dirs = array($from);  
  while (NULL !== ($dir = array_pop($dirs))) {  
    if ($dh = opendir($dir)) {    
      while (false !== ($entry = readdir($dh))) {      
        if ($entry == '.' || $entry == '..') continue;        

        $path = "$dir/$entry";        
        echo "$path\n";        
        if (is_dir($path)) $dirs[] = $path;        
      }      
      closedir($dh);      
    }    
  }  
}

// measured to 315% of gnu find's speed when run directly from a shell
function list_recursivedirectoryiterator($path) {
  $it = new RecursiveDirectoryIterator($path);
  foreach ($it as $file) {
    if ($file->isDot()) continue;

    echo $file->getPathname();
  }
}

// measured to 390% of gnu find's speed when run directly from a shell
function list_gnufind($dir) { 
  $dir = escapeshellcmd($dir);
  $h = popen("/usr/bin/find $dir", "r");
  while ('' != ($s = fread($h, 2048))) {
    echo $s;
  }
  pclose($h);
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T19:26:18.013

我不确定性能是否更好，但您可以使用递归目录迭代器来简化您的代码...参见`RecursiveDirectoryIterator`和['SplFileInfo`](http://uk.php.net/SplFileInfo)。

```
$it = new RecursiveDirectoryIterator($from);
foreach ($it as $file)
{
    if ($file->isDot())
        continue;

    echo $file->getPathname();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-08T19:40:29.307

在开始更改任何内容之前，请**分析您的代码**。

使用[Xdebug](http://www.xdebug.org/)（加上 kcachegrind 以获得漂亮的图表）之类的东西来找出慢速部分在哪里。如果你开始盲目地改变事情，你将一事无成。

我唯一的其他建议是使用已经发布的 SPL 目录迭代器。让内部 C 代码完成工作几乎总是更快。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-08T20:17:44.647

PHP 只是不能像 C 一样快，简单明了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-08T19:30:33.010

为什么您希望解释的 PHP 代码与编译的 C 版本的 find 一样快？只慢两倍实际上是相当不错的。

关于我要添加的唯一建议是在开始时执行 ob_start() 并在末尾执行 ob_get_contents()、ob_end_clean()。这*可能会*加快速度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-08T19:25:46.470

您保持打开 N 个目录流，其中 N 是目录树的深度。相反，尝试一次读取整个目录的条目，然后遍历这些条目。至少您将最大限度地利用桌面 I/O 缓存。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-08T19:57:48.593

您可能要认真考虑只使用 GNU find。如果它可用，并且未打开安全模式，您可能会喜欢结果：

```
function list_recursive($dir) { 
  $dir=escapeshellcmd($dir);
  $h = popen("/usr/bin/find $dir -type f", "r")
  while ($s = fgets($h,1024)) { 
    echo $s;
  }
  pclose($h);
} 
```

但是，可能会有一些目录太大，您也不想为此烦恼。考虑以其他方式摊销缓慢。您的第二次尝试可以通过简单地将目录堆栈保存在会话中来设置检查点（例如）。如果您要为用户提供文件列表，只需收集一个页面，然后将其余状态保存在第 2 页的会话中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-28T15:33:04.767

正如 Jason Cohen 所建议的那样，尝试使用`scandir()`一次读取整个目录。我将以下代码基于 php 手册注释中的代码`scandir()`

```
 function scan( $dir ){
        $dirs = array_diff( scandir( $dir ), Array( ".", ".." ));
        $dir_array = Array();
        foreach( $dirs as $d )
            $dir_array[ $d ] = is_dir($dir."/".$d) ? scan( $dir."/".$d) : print $dir."/".$d."\n";
 } 
```

# drupal - Drupal“站点”文件夹的问题

> ID：624122
> 
> 赞同：0
> 
> 时间：2009-03-08T19:19:12.743
> 
> 标签：drupal, themes

我在 MediaTemple gs 托管计划上安装了 Drupal。该站点已启动并且运行良好，但是“站点”文件夹存在一些问题。

如果我将主题放在“sites/default/themes”文件夹中，它们会显示在“Themes”文件夹中，但每个主题都不会显示任何图标。启用主题会从站点中删除所有样式，就像它无法访问 CSS 一样。将主题从“sites/default/themes”移动到“/themes”解决了这个问题，但我认为这不是处理它的最佳方式。

我检查了我的权限，它们看起来不错 - 我在这里遗漏了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T20:03:04.790

嗬！权限是问题。我忘了为每个人启用“执行”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T16:48:24.857

主题的正确位置如下。

核心 Drupal 发行版中包含的主题：

`themes`

从网上下载的主题，但不包含在核心中：

`sites/all/themes/contrib`

或者

`sites/example.com/themes/contrib`

你自己写的主题：

`sites/all/themes/custom`

或者

`sites/example.com/themes/contrib`

如果您使用 Drupal 的多站点功能在单个代码库上运行多个 Drupal 站点，您将在路径中使用带有 example.com 的位置。（下面`sites/all`的内容对所有站点都可用；下面的内容`sites/example.com`仅对 example.com 站点可用。）

# c# - 在 .NET 中使用 NTFS 压缩来压缩文件夹

> ID：624125
> 
> 赞同：13
> 
> 时间：2009-03-08T19:20:30.727
> 
> 标签：c#, .net, windows, ntfs

我想在 .NET 中使用 NTFS 压缩来压缩文件夹。我找到[了这篇文章](http://bytes.com/groups/net-c/262874-making-folder-compressed)，但它不起作用。它引发异常（“无效参数”）。

```
DirectoryInfo directoryInfo = new DirectoryInfo( destinationDir );
if( ( directoryInfo.Attributes & FileAttributes.Compressed ) != FileAttributes.Compressed )
{
   string objPath = "Win32_Directory.Name=" + "\"" + destinationDir + "\"";
   using( ManagementObject dir = new ManagementObject( objPath ) )
   {
      ManagementBaseObject outParams = dir.InvokeMethod( "Compress", null, null );
      uint ret = (uint)( outParams.Properties["ReturnValue"].Value );
   }
} 
```

有人知道如何在文件夹上启用 NTFS 压缩吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-08T22:28:49.853

根据我的经验，使用 P/Invoke 通常比 WMI 更容易。我相信以下应该有效：

```
private const int FSCTL_SET_COMPRESSION = 0x9C040;
private const short COMPRESSION_FORMAT_DEFAULT = 1;

[DllImport("kernel32.dll", SetLastError = true)]
private static extern int DeviceIoControl(
    SafeFileHandle hDevice,
    int dwIoControlCode,
    ref short lpInBuffer,
    int nInBufferSize,
    IntPtr lpOutBuffer,
    int nOutBufferSize,
    ref int lpBytesReturned,
    IntPtr lpOverlapped);

public static bool EnableCompression(SafeFileHandle handle)
{
    int lpBytesReturned = 0;
    short lpInBuffer = COMPRESSION_FORMAT_DEFAULT;

    return DeviceIoControl(handle, FSCTL_SET_COMPRESSION,
        ref lpInBuffer, sizeof(short), IntPtr.Zero, 0,
        ref lpBytesReturned, IntPtr.Zero) != 0;
} 
```

由于您尝试在目录上设置它，您可能需要使用 P/Invoke 调用[CreateFile](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx)来`FILE_FLAG_BACKUP_SEMANTICS`获取目录上的 SafeFileHandle。

另外，请注意，在 NTFS 中对目录设置压缩不会压缩所有内容，它只会使新文件显示为压缩（加密也是如此）。如果要压缩整个目录，则需要遍历整个目录并在每个文件/文件夹上调用 DeviceIoControl。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-08T21:04:03.020

我已经测试了代码和它 ![替代文字](https://codinghorror.typepad.com/.a/6a0120a85dcdae970b0128776ff992970c-pi)！

*   确保它适用于您的 gui。也许分配单元的大小对于压缩来说太大了。或者你没有足够的权限。
*   对于您的目的地，使用如下格式：“c:/temp/testcomp”，带有正斜杠。

完整代码：

```
using System.IO;
using System.Management;

class Program
{
    static void Main(string[] args)
    {
        string destinationDir = "c:/temp/testcomp";
        DirectoryInfo directoryInfo = new DirectoryInfo(destinationDir);
        if ((directoryInfo.Attributes & FileAttributes.Compressed) != FileAttributes.Compressed)
        {
            string objPath = "Win32_Directory.Name=" + "\"" + destinationDir + "\"";
            using (ManagementObject dir = new ManagementObject(objPath))
            {
                ManagementBaseObject outParams = dir.InvokeMethod("Compress", null, null);
                uint ret = (uint)(outParams.Properties["ReturnValue"].Value);
            }
        }
     }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-15T20:27:22.200

创建 Win32_Directory.Name=... 字符串时，您需要将反斜杠加倍，例如路径 C:\Foo\Bar 将构建为：

> Win32_Directory.Name="C:\\Foo\\Bar",

或使用您的示例代码：

> string objPath = "Win32_Directory.Name=\"C:\\\\Foo\\\\Bar\"";

显然，该字符串被馈送到一些需要路径字符串的转义形式的进程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-27T17:13:46.187

这是对 Igal Serban 答案的轻微改编。我遇到了一个微妙的问题，`Name`必须采用非常特定的格式。所以我首先添加了一些`Replace("\\", @"\\").TrimEnd('\\')` *魔法*来规范化路径，我还清理了一些代码。

```
var dir = new DirectoryInfo(_outputFolder);

if (!dir.Exists)
{
    dir.Create();
}

if ((dir.Attributes & FileAttributes.Compressed) == 0)
{
    try
    {
        // Enable compression for the output folder
        // (this will save a ton of disk space)

        string objPath = "Win32_Directory.Name=" + "'" + dir.FullName.Replace("\\", @"\\").TrimEnd('\\') + "'";

        using (ManagementObject obj = new ManagementObject(objPath))
        {
            using (obj.InvokeMethod("Compress", null, null))
            {
                // I don't really care about the return value, 
                // if we enabled it great but it can also be done manually
                // if really needed
            }
        }
    }
    catch (Exception ex)
    {
        System.Diagnostics.Trace.WriteLine("Cannot enable compression for folder '" + dir.FullName + "': " + ex.Message, "WMI");
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-10-27T17:06:52.823

有一种更简单的方法，我在 Windows 8 64 位中使用，为 VB.NET 重写。享受。

```
 Dim Path as string = "c:\test"
    Dim strComputer As String = "."
    Dim objWMIService = GetObject("winmgmts:{impersonationLevel=impersonate}!\\.\root\cimv2")
    Dim colFolders = objWMIService.ExecQuery("Select * from Win32_Directory where name = '" & Replace(path, "\", "\\") & "'")
    For Each objFolder In colFolders
        objFolder.Compress()
    Next 
```

对我很有用。Chagne .\root 到 \pcname\root 如果您需要在另一台计算机上执行此操作。小心使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-08T20:48:48.627

我不相信有一种方法可以在 .NET 框架中设置文件夹压缩，因为文档（备注部分）声称它不能通过[File.SetAttributes](http://msdn.microsoft.com/en-us/library/system.io.file.setattributes.aspx)完成。这似乎只在使用[DeviceIoControl](http://msdn.microsoft.com/en-us/library/aa364592(VS.85).aspx)函数的 Win32 API 中可用。人们仍然可以通过 .NET 使用[PInvoke](http://msdn.microsoft.com/en-us/library/aa719104.aspx)来做到这一点。

一旦熟悉了 PInvoke，请查看[pinvoke.net](http://pinvoke.net/index.aspx)上的参考资料，该参考资料讨论了[签名](http://pinvoke.net/default.aspx/kernel32/DeviceIoControl.html)需要是什么样子才能实现这一点。

# c# - 如何从域 C# 中的另一台计算机运行某些 exe 文件

> ID：624128
> 
> 赞同：1
> 
> 时间：2009-03-08T19:25:12.073
> 
> 标签：c#

我如何使用 C# 命令从我域中的另一台计算机运行 file.exe 文件

我知道 System.Diagnostic.Process.Start 但它在我的计算机中启动。我如何将它用于“192.168.100.2”IP 地址计算机，以便使用命令从我的计算机运行 exe 文件？我知道 TCP/Socket 编程，但除此之外？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T19:33:05.033

[PsExec](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)是[PsTools](http://technet.microsoft.com/en-us/sysinternals/bb896649.aspx)的一部分，可以为您执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T22:35:33.627

如果您不需要 .exe 的 UI，则可以使用 WMI 远程启动进程。我在这里没有代码来做这件事，但是[这篇 codeproject 文章](http://www.codeproject.com/KB/cs/Remote_Process_using_WMI_.aspx)看起来可以工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T22:48:37.013

一种简单的方法是让远程计算机监听某种事件，这可能是消息队列、远程处理（端口监听）、Web 服务/http。

一旦它监听到主机需要启动进程本身的事件，这将确保主机的安全性，因为它将在一些本地凭据和策略下运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T19:40:52.737

您可以在域内的计算机上共享一个包含 .exe 的文件夹，并使用 telnet 在另一台计算机上获取命令行以运行该程序。但是，没有特定于 C#/.NET 的内容。

# search - 搜索任意多边形区域的坐标绑定数据数据库

> ID：624135
> 
> 赞同：0
> 
> 时间：2009-03-08T19:27:34.563
> 
> 标签：search, geolocation, polygon

我有一个关系数据库，其中每个条目都标记为带有纬度/经度坐标的点。我让用户能够在地图上标记任意多边形，并希望返回多边形形状内的所有条目。

实现这一目标的最佳方法是什么？

此外，可能值得指出的是，小错误是可以的（即，如果有一种有效的方法可以将多边形变成一组矩形，那很好）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T19:30:48.953

使用空间扩展，大多数数据库都有这个。在 MySql 中，您只能将它们与非事务性的 MyISAM 表一起使用。

[http://dev.mysql.com/doc/refman/5.0/en/spatial-extensions.html](http://dev.mysql.com/doc/refman/5.0/en/spatial-extensions.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T19:31:13.040

一种快速减少要考虑的点数的方法是计算多边形的边界矩形（即多边形中点的 min-x、min-y、max-x、max-y），然后选择边界矩形内的点（即 x 在 min-x 和 max-x 之间，y 相同）。

当然，并非所有这些点都必须在多边形内，但现在您可以使用代码对其进行磨练。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-08T19:30:39.080

一个老黑客：

计算连接`<point far away>`到的线`<point in question>`穿过多边形的任何边界段的次数。

*   偶数表示该点在多边形之外
*   奇数表示它在多边形内

# java - 在linux中模拟“更快的时间”

> ID：624137
> 
> 赞同：12
> 
> 时间：2009-03-08T19:28:52.250
> 
> 标签：java, linux, testing, date, time

我有一个在 linux 上运行的 Java 应用程序，它有很多围绕时间和日期的事件和业务逻辑。

对于测试，是否可以将某些东西调整为更快的时间。比方说，在一小时的墙上时间完成整个计算机年？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-08T19:39:43.880

您可以为时间/日期调用编写包装接口。拥有一个执行真正系统调用的真正实现，以及一个可以做任何您想做的事情的测试实现（运行更快、更慢、假日期等）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-08T19:44:35.257

最适合单元测试的一种方法是抽象在代码中访问当前时间的方式。

您可以提供自己的实现，而不是直接调用 System.currentTimeMillis()。

像这样的东西（伪代码）：

```
class MyTime {
   private static TimeInterface CurrentTimeInterface = new DefaultTimeImpl();

   public setTimeInterface(TimeInterface timeInterface) {
      CurrentTimeInterface = timeInterface;
   }

   public int getTime() { CurrentTimeInterface.getTime(); }

}

class DefaultTimeImpl implements TimeInterface {
   public int getTime() { return System.currentTimeMillis(); }
}

class TestTimeImpl implements TimeInterface {
   private int CurrentTimeMillis = 0;
   public int getTime() { return CurrentTimeMillis; }
   public void setTime(int timeMillis) { CurrentTimeMillis = timeMillis}
   public void sleep(int millis) { CurrentTimeMillis += millis; }
} 
```

然后，在任何地方你都会调用 System.getTimeMillis() 而不是调用 MyTime.getTime()。当您测试您的代码时，只需创建一个 TestTimeImpl 并调用 MyTime.setTimeInterface(testTimeImpl)。然后，当您想要提前调用 testTimeImpl.sleep() 或 testTimeImpl.setTime() 时。

这允许您模拟任何时间到毫秒。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T19:32:15.503

如果你是系统调用来获取系统时间（ie `System.currentTimeMillis()`），想必你可以通过改变系统时间来加快时间。这应该反映在您在应用程序中看到的时间。

如果您使用其他方式来计算时间（从 JVM 启动（即`System.nanoTime()`）、网络时间服务器等经过的时间，那么答案是不可能的。

* * *

我不能过分强调，我只是在解释如何按照您的要求进行操作，这仅适用于集成测试，当您考虑到您在所述机器上影响的任何其他内容时。

这不应该作为适当和广泛的单元测试的替代品。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T19:44:33.243

您必须设计您的系统，以便您可以在测试期间“重新安排”时钟。对于某些类别的系统，有一个事件队列，它按时间顺序存储预定的事件。在模拟的任何时候，下一个事件都是队列中的第一项；您可以将其从队列中拉出，并调整有效时间，使其与该事件发生的时间相匹配。随着新事件的安排，它们被添加到队列中。因此，您可以在系统允许的范围内尽快处理事件，而不必等待实际时间过去。但是您必须设计您的系统以允许这种机制起作用。

# visual-studio - 我的 VS Team 项目绑定发生了什么？

> ID：624140
> 
> 赞同：0
> 
> 时间：2009-03-08T19:29:58.987
> 
> 标签：visual-studio, visual-studio-2008, tfs

我是使用 Team Explorer 的新手，我使用 VSTS 在源代码控制中创建了一个新项目，然后我看到了加号、复选标记等。

然后我关闭项目并重新打开它，所有的加号和复选标记都消失了，好像项目不受源代码控制一样。

我想知道为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-08T19:47:03.610

应该是断线了吧 使用文件菜单上的源代码控制菜单项重新连接到 TFS 服务器。

# objective-c - 如何在 href=mailto (iPhone) 中转义字符

> ID：624145
> 
> 赞同：0
> 
> 时间：2009-03-08T19:31:21.807
> 
> 标签：objective-c, iphone, cocoa-touch, uiwebview

我想在 UIWebView 上创建一个链接，将内容通过电子邮件发送给用户。一个简单的例子是：

```
<a href="mailto:zippy@example.com?subject=Sarcasm&body=I »
<b>love</b> &lt;html&gt; mail!">Hi!</a> 
```

这会创建一条如下所示的消息：

-- 开始留言 ---

收件人：zippy@example.com 主题：讽刺

我爱邮件！

-- 结束信息 --

我需要更详细的东西。主题将包含多个带有空格的单词。正文将包含 HTML、列表 (<ul>) 和在其 href 中带有引号的超链接。我该如何创造这样的东西？

这是一个例子：

subject="这只是一个测试"

body="这是正文部分。这是链接列表：
<ul>
<li><a href="http://www.abc.com">abc.com</a></li>
<li ><a href="http://www.xyz.com">xyz.com</a></li>
</ul>
结束。”

另外，为什么模拟器在单击 mailto 链接时会做任何事情？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T23:19:22.260

字段是 URL 编码的（在 Cocoa 中你可以使用[`stringByAddingPercentEscapesUsingEncoding:`](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/stringByAddingPercentEscapesUsingEncoding:)它）。

[4thspace](https://stackoverflow.com/users/40106/4thspace)提到[Mail.app*确实*允许 HTML](http://davidebenini.it/2008/12/19/iphone-sdk-sending-formatted-email/)。这违反了 [mailto RFC2368](http://www.faqs.org/rfcs/rfc2368.html)，它清楚地表明这`body`是应该的`text/plain`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T19:37:47.847

模拟器没有Mail.app，从它的主屏幕可以看到，所以当它遇到mailto链接时它没有任何东西可以打开。

据我所知，没有办法使用 mailto: 发送 html 格式的电子邮件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-25T21:09:19.187

您将需要 MessageUI.framework 对您的项目的引用。

将以下内容添加到您的 .h 文件中

```
#import <MessageUI/MessageUI.h>
#import <MessageUI/MFMailComposeViewController.h> 
```

添加委托人`<MFMailComposeViewControllerDelegate>`

在 .m 文件中创建几个类似于以下内容的方法。

```
-(IBAction)checkCanSendMail:(id)sender{
        Class mailClass = (NSClassFromString(@"MFMailComposeViewController"));
        if (mailClass != nil) {
            if ([mailClass canSendMail]) {
                [self displayComposerSheet];
            }
            else {
                //Display alert for not compatible. Need iPhone OS 3.0 or greater. Or implement alternative method of sending email.
            }
        }
        else {
            //Display alert for not compatible. Need iPhone OS 3.0 or greater.  Or implement alternative method of sending email.
        }
    }

    -(void)displayComposerSheet {
        MFMailComposeViewController *mailer = [[MFMailComposeViewController alloc] init];
        mailer.mailComposeDelegate = self;

        [mailer setSubject:@"Email Subject"];

        //Set our to address, cc and bcc
        NSArray *toRecipients = [NSArray arrayWithObject:@"primary@domain.com"];
        //NSArray *ccRecipients = [NSArray arrayWithObjects:@"first@domain.com",@"second@domain.com",nil];
        //NSArray *bccRecipients = [NSArray arrayWithObjects:@"first@domain.com",@"second@domain.com",nil];

        [mailer setToRecipients:toRecipients];
        //[mailer setCcRecipients:ccRecipients];
        //[mailer setBccRecipients:bccRecipients];

        NSString *emailBody = @"\
        <html><head>\
        </head><body>\
        This is some HTML text\
        </body></html>";

        [mailer setMessageBody:emailBody isHTML:YES];

        [self presentModalViewController:mailer animated:YES];
        [mailer release];
        } 
```

Apple 示例代码以及更多说明，请访问：http: [//developer.apple.com/iphone/library/samplecode/MailComposer/](http://developer.apple.com/iphone/library/samplecode/MailComposer/)

我知道这不使用 webView，但它确实允许您从应用程序中创建 HTML 电子邮件。

# c++ - 字符串问题

> ID：624148
> 
> 赞同：0
> 
> 时间：2009-03-08T19:36:46.913
> 
> 标签：c++, compare, cstring

我正在使用一个 cstring 函数，该函数应该比较两个字符串 MyString 和 m2 的值。我有#include，所以绝对不是那样。这些是我的错误。

```
(74) : error C2275: 'MyString' : illegal use of this type as an expression
(74) : error C2660: 'MyString::length' : function does not take 1 arguments
(76) : error C2275: 'MyString' : illegal use of this type as an expression 
```

这是我从中获取的代码。

```
bool MyString::operator ==(const MyString &m2) const
{
    int temp = 0;

    if (length(MyString) = length(m2)) // 74
    {
        if (strcmp(MyString, m2))  // 76
        {
            temp = 1;
        }
        else
        {
            temp = 2;
        }
    }
    if(temp = 2)
    {
        return "true";
    }
    else
    {
        return "false";
    }
} 
```

对此的任何帮助将不胜感激，谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-08T19:41:37.180

**问题：**

*   返回真或假，而不是“真”或“假”
*   您正在使用 = 而不是 == 进行比较（您在代码中使用 = 进行两次比较）
*   要在 C++ 类中引用自己，您需要使用关键字*this*而不是类名。
*   第 74 行应该是：

    ```
    if (length() == m2.length()) // 74 
    ```

*   strcmp 采用 char* 而不是 MyString。
*   第 76 行应该是：

    ```
    if (strcmp(this->c_str(), m2.c_str()))  // 76 
    ```

在第 76 行，这假定 MyString 类型有一个函数 c_str()，它返回一个指向 char[] 缓冲区的指针，该缓冲区以零结尾。

* * *

**功能结构：**

函数的结构真的很糟糕。考虑更像这样的事情：

```
bool MyString::operator ==(const MyString &m2) const
{
    if(this->length() != m2.length())
      return false;

    return !strcmp(this->c_str(), m2.c_str()));
} 
```

注意：在上述函数中 this-> 可以省略。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T20:37:19.717

大多数问题已经得到解决。我只是有一个上面没有写的建议：

使用比较运算符的自由函数形式而不是成员函数：

```
bool operator == (MyString const &, MyString const &); 
```

如果它依赖于私有数据/成员，您必须将其声明为朋友，但您将获得调用者的对称性。假设（与 std::string 一样）您确实定义了从`const char *`到您的字符串的隐式转换，那么 == 的成员函数实现不是对称的。成员函数要求左侧是所需类型。编译器不会在比较的左侧执行转换：

```
// assumes MyString( const char* ) is defined and not explicit
// operator== defined as member function

const char* literal = "hola";
MyString str( "hola" );

if ( str == literal ) {} // correct
if ( literal == str ) {} // compilation error 
```

如果您实现为成员函数，则在第一次测试中，编译器将创建一个未命名的 MyString 并调用转换运算符。在第二次检查中，不允许编译器转换`literal`为 MyString，因此它永远不会找到您的`operator==`实现。

如果您将比较作为自由函数提供，那么编译器将在 == 的两侧应用相同的转换规则，代码将编译并正常工作。

通常，这同样适用于其他运算符（不包括必须作为成员函数实现的 operator[] 和 operator=）。使用免费功能版本提供对称性。

# linux - Linux：卸载时哪个进程导致“设备忙”？

> ID：624154
> 
> 赞同：94
> 
> 时间：2009-03-08T19:39:37.733
> 
> 标签：linux, shell, device, mount, umount

Linux：卸载时哪个进程导致“设备忙”？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2009-03-08T19:46:13.037

查看[lsof](https://linux.die.net/man/8/lsof)命令（列出打开的文件）——它可以告诉您哪些进程正在打开哪些文件。有时这很棘手，但通常`sudo lsof | grep (your device name here)`可以为您做一些简单的事情。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-03-08T19:59:51.070

以防万一...有时您正在从终端调用 umount ，并且您的当前目录属于已安装的文件系统。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-08T20:16:40.840

您应该使用[fuser](https://linux.die.net/man/1/fuser)命令。

例如。`fuser /dev/cdrom`将使用 . 返回进程的 pid(s) `/dev/cdrom`。

如果您尝试卸载，您可以使用`-k`开关终止这些进程（请参阅参考资料`man fuser`）。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2012-06-04T00:30:39.120

使用“losetup -a”检查映射到文件系统上文件的开环设备。它们不会与 lsof 或 fuser 一起出现。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2013-09-06T11:28:09.177

还要检查`/etc/exports`。如果您通过 NFS 导出挂载点内的路径，则在尝试卸载时会出现此错误，并且不会在`fuser`or中显示任何内容`lsof`。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-07-05T17:51:55.073

```
lsof +f -- /mountpoint 
```

（列出了使用挂载在 /mountpoint 上的文件的进程。对于查找哪些进程正在使用挂载的 USB 记忆棒或 CD/DVD 非常有用。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-03-08T20:32:11.240

lsof 和 fuser 确实是找到保持某个文件打开的进程的两种方法。如果您只想 umount 成功，您应该调查它的 -f 和 -l 选项。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-03-12T21:17:30.493

这正是“fuser -m /mount/point”存在的原因。

顺便说一句，我不认为“fuser”或“lsof”会指示内核模块何时持有资源，尽管我通常没有这个问题..

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-08-20T12:34:08.827

### 打开文件

带有打开文件的进程通常是罪魁祸首。显示它们：

```
lsof +f -- <mountpoint or device> 
```

使用 `/dev/<device>`而不是有一个优点`/mountpoint`：挂载点将在 之后消失`umount -l`，或者它可能被覆盖的挂载隐藏。

`fuser`也可以使用，但在我看来`lsof`有一个更有用的输出。然而`fuser`，在杀死导致你的戏剧的过程时很有用，这样你就可以继续你的生活。

列出文件`<mountpoint>`（见上面的警告）：

```
fuser -vmM <mountpoint> 
```

仅以交互方式杀死打开文件以进行写入的进程：

```
fuser -vmMkiw <mountpoint> 
```

重新挂载只读（`mount -o remount,ro <mountpoint>`）后，杀死所有剩余进程是安全的（r）：

```
fuser -vmMk <mountpoint> 
```

### 挂载点

罪魁祸首可能是内核本身。另一个文件系统安装在您尝试的文件系统上`umount`会导致悲伤。检查：

```
mount | grep <mountpoint>/ 
```

对于环回挂载，还要检查以下输出：

```
losetup -la 
```

### 匿名 inode (Linux)

可以通过以下方式创建[匿名 inode ：](https://stackoverflow.com/q/4508998/5353461)

*   临时文件（`open`带`O_TMPFILE`）
*   [通知](https://en.wikipedia.org/wiki/Inotify)手表
*   [eventfd]
*   [事件投票]
*   [定时器]

这些是最难以捉摸的口袋妖怪类型，并在`lsof`'s`TYPE`列中显示为`a_inode`（在 [`lsof`手册页](http://man7.org/linux/man-pages/man8/lsof.8.html)中未记录）。

它们不会出现在 中`lsof +f -- /dev/<device>`，因此您需要：

```
lsof | grep a_inode 
```

有关杀死持有匿名 inode 的进程，请参阅：[列出当前 inotify 监视（路径名，PID）](https://unix.stackexchange.com/q/386877/143394)。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-05-03T07:51:58.090

lsof 和 fuser 也没有给我任何东西。

在将所有可能的目录重命名为 .old 并在每次进行更改后重新启动系统之后，我发现了一个负责的特定目录（与 postfix 相关）。

事实证明，我曾经建立了一个从 /var/spool/postfix 到 /disk2/pers/mail/postfix/varspool 的符号链接，以最大限度地减少对基于 SDCARD 的根文件系统（Sheeva Plug）的磁盘写入。

有了这个符号链接，即使停止了 postfix 和 dovecot 服务（ps aux 和 netstat -tuanp 都没有显示任何相关内容），我也无法卸载 /disk2/pers。

当我删除符号链接并更新后缀和 dovecot 配置文件以直接指向 /disk2/pers/ 上的新目录时，我能够成功停止服务并卸载目录。

下次我将更仔细地查看以下输出：

```
ls -lR /var | grep ^l | grep disk2 
```

上面的命令将递归地列出目录树中的所有符号链接（这里从 /var 开始）并过滤掉那些指向特定目标挂载点（这里是 disk2）的名称。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-09-21T16:57:19.213

如果您在停止所有打开文件的服务和进程后仍然无法卸载或重新安装您的设备，则可能是交换文件或交换分区使您的设备忙。这不会显示为`fuser`or `lsof`。关闭交换：

```
sudo swapoff -a 
```

您可以事先检查并显示任何交换分区或交换文件的摘要：

```
swapon -s 
```

或者：

```
cat /proc/swaps 
```

作为使用命令的替代方法`sudo swapoff -a`，您还可以通过停止服务或*systemd*单元来禁用交换。例如：

```
sudo systemctl stop dphys-swapfile 
```

或者：

```
sudo systemctl stop var-swap.swap 
```

在我的情况下，关闭交换是必要的，除了停止任何打开文件进行写入的服务和进程，这样我就可以将我的根分区重新挂载为只读，以便`fsck`在我的根分区上运行而无需重新启动。这在运行 Raspbian Jessie 的 Raspberry Pi 上是必需的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-01-20T14:37:27.467

`target is busy`除了正在使用的任何文件之外，安装在您尝试卸载的文件系统上的文件系统可能会导致错误。（例如当你`mount -o bind /dev /mnt/yourmount/dev`为了使用`chroot`那里。）

要查找文件系统上挂载了哪些文件系统，请运行以下命令：

`mount | grep '/mnt/yourmount'`

要查找正在使用的文件，请参阅此处其他人已经建议的建议：

`lsof | grep '/mnt/yourmount'`

# .net - 用于模拟 HTTP 事务的库，例如具有 cookie 和会话支持的浏览器

> ID：624172
> 
> 赞同：1
> 
> 时间：2009-03-08T19:46:28.230
> 
> 标签：.net, http, session, cookies

我想知道是否有一个 .NET 库可以在 HTTP 事务方面模仿浏览器。换句话说，我将发出多个 GET/POST 请求，并且我希望将 cookie 持久化到存储中，以便远程主机识别连续的请求。AFAIK [cURL](http://curl.haxx.se/)支持此功能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T20:45:07.840

内置的[System.Net.HttpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx)类支持 cookie，但出于安全原因默认禁用它们。您可以启用它们并使用[CookieContainer持久化它们](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.cookiecontainer.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T20:20:44.763

看看[提琴手](http://www.fiddlertool.com/fiddler)。它实际上是一个调试代理，可以方便地捕获初始对话。它内置在 .NET 中，并且可以在 .NET 语言中编写脚本。

# c# - 共享资源的结构与静态类？

> ID：624176
> 
> 赞同：1
> 
> 时间：2009-03-08T19:47:34.313
> 
> 标签：c#

我有一个产品图像类。这是一个具有重用潜力的对象，可用于处理图像的一般工作（例如，用于产品、处理图像时的 CMS 等）。它可以让我设置文件的标题，并使用标准 .NET 类以简单的方式编辑图像。

我可以使用一个结构，这意味着如果我在 5 个不同的地方使用该结构，那就是 5 个不同的内存位置，但彼此独立。更改其中一个内存位置的状态不会影响其他内存位置（这是所需的行为）。请求对象时，它将被装箱。

该对象是基于实例的。因此，每个产品都会使用产品对象并使用图像（例如编辑其标题等）。

如果我创建一个静态类，那是指一个对象的五个不同位置。所以我需要处理线程同步。我不能只写入一个变量，因为另一个访问可能会覆盖该变量，无论我如何同步对该共享资源的访问。所以我总是需要返回新的变量。此外，如果我使用许多不同调用方法使用的静态类，则会导致队列访问共享资源。因为实用程序类是静态的，而且它们就是这样——实用程序——它们将被我的代码库中的许多类使用。在这种情况下使用静态类可能不明智吗？

正如 MSDN 文档所解释的，我只会将静态类用于全局实体。所以一个封装了我的代码库细节的类——只有一个代码库，这个类将包含关于行数等的细节。这不是基于实例的，就像一个订单类（1个客户-1个订单-1个或更多订单） ）。

在这种情况下，改用结构是否是一个好的设计决策？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-08T19:52:59.820

在我看来，担心性能问题的时间是在你遇到性能问题之后。在那之前，担心使代码工作和可维护。否则，您会发现自己在追求微不足道的性能提升，或者可能解决错误的性能问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T19:58:57.110

我不太清楚您想将此类型用作什么，但听起来最好创建一个不可变的引用类型。在 .NET 中创建自己的结构很少适合（尤其是“产品”结构听起来几乎可以肯定是错误的选择），并且静态类通常不应该具有任何可变状态，除非可能用于计数器之类的东西。

你有什么理由不去上正常的课吗？如果您希望能够在多个“父母”之间共享单个实例而不用担心任何父母会更改内容，请使其不可变 - 添加额外的方法，这些方法会根据旧实例返回一个新实例，但会以某种方式进行更改，就像这样`String.Replace`做.

# sql-server - SQL Server 登录次数的实际限制？

> ID：624177
> 
> 赞同：1
> 
> 时间：2009-03-08T19:47:44.937
> 
> 标签：sql-server, reporting

使用需要为用户报告提供行和列级别安全性的应用程序。行过滤列掩码的逻辑已经到位，但在报表执行时仍然需要做出关于识别用户的决定。

该应用程序使用单个 SQL Server 登录来进行身份验证，因为所有权限都是在应用程序本身内驱动的数据。这种机制不适用于报表，因为 Crystal 和 MS Office 等客户端不通过应用程序（Web 和 WinForms）进行身份验证。

使用 SQL Server 登录名和数据库用户的传统方法可行，但可能存在一个问题。在应用程序的一些实现中，运行报告并需要唯一标识的用户数量可能达到数百个。

SQL Server 数据库（v 2005+）上的登录或用户数量是否有任何实际限制，这种方法可能会导致问题？应用程序可以自动管理数据库服务器上的用户，但可能需要考虑潜在的凭据数量。

我们已经研究了用户模拟技术，但是当 Excel 等报表客户端直接向服务器进行身份验证时，它们就变得难以实施。

*编辑：*关注的不是并发性或工作负载，而是本地 DBA 不可用的远程实例上的管理问题，尤其是当服务器不是专用于应用程序时。对登录次数有问题的场景感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T21:03:36.687

我使用了您描述的方法（由我们的应用程序自动管理的 SQL Server 帐户），我们没有遇到任何问题。但是，我们最多只有 200 个 SQL 帐户。但是我们没有遇到任何类型的管理开销，除非“超级用户”在没有告诉我们的情况下恢复了数据库，导致 SQL 登录帐户与数据库不同步*。

我认为你的方法是合理的。

编辑：我们的解决方案是一个简单地通过用户帐户运行并调用我们删除/创建用户帐户的过程的过程。当高级用户调用这个过程时，一切都很好，而且速度相当快。

# java - 如何在 Java 小程序中使用声音和图像？

> ID：624181
> 
> 赞同：0
> 
> 时间：2009-03-08T19:51:42.447
> 
> 标签：java, deployment, jar, applet

问题 1：我应该如何构建我的项目，以便最轻松地加载声音和图像文件？现在，我有文件夹：

```
C:\java\pacman 
```

与子目录

```
C:\java\pacman\src 
```

包含所有代码，以及

```
C:\java\pacman\assets 
```

包含图像和 .wav 文件。这是最好的结构还是我应该把资产放在其他地方？

问题2：

在不使用完整路径的情况下引用图像/声音的最佳方式是什么`C:\java\pacman\assets\something.png`？如果我使用该`getCodeBase()`函数，它似乎指的是`C:\java\pacman\bin`而不是`C:\java\pacman\`.

我想使用这样的函数/类，当我在 jar 中编译小程序时以及现在通过 Eclipse 测试小程序时，它会自动工作。

问题 3：我应该如何加载图像/声音？这就是我现在正在使用的：

1) 对于一般图像：

```
import java.awt.Image;

public Image getImg(String file)
{
          //imgDir in this case is a hardcoded string containing
          //"C:\\java\\pacman\\assets\\"
    file=imgDir + file;
    return new ImageIcon(file).getImage();
} 
```

从这个函数返回的图像在小程序的`drawImage`方法中的`Graphics`类的`paint`方法中使用。

2）对于缓冲图像，用于获取子图像并从精灵表加载精灵：

```
public BufferedImage getSheet() throws IOException
{
    return ImageIO.read(new File(img.getPath("pacman-sprites.png")));

} 
```

之后：

```
public void loadSprites()
{
    BufferedImage sheet;
    try
    {
        sheet=getSheet();

        redGhost.setNormalImg(sheet.getSubimage(0, 60, 20, 20));
        redGhost.setUpImg(sheet.getSubimage(0, 60, 20, 20));
        redGhost.setDownImg(sheet.getSubimage(30, 60, 20, 20));
        redGhost.setLeftImg(sheet.getSubimage(30, 60, 20, 20));
        redGhost.setRightImg(sheet.getSubimage(60, 60, 20, 20));    
    }
    catch (IOException e)
    {
        System.out.println("Couldnt open file!");
        System.out.println(e.getLocalizedMessage());
    }   
} 
```

3) 对于声音文件：

```
import sun.audio.*;
import java.io.*;
public synchronized void play() {
    try {
            InputStream in = new FileInputStream(filename);
            AudioStream as = new AudioStream(in);
            AudioPlayer.player.start(as); 

    } catch (IOException e) {
            e.printStackTrace();
    }

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T20:09:21.467

将它们放在您的类路径中（将它们与您的 .class 文件一起放置）并使用[ClassLoader](http://java.sun.com/javase/6/docs/api/java/lang/ClassLoader.html)加载它们。

爪哇：

```
package mypackage;

public class MyClass {
    public static void main(String[] args) {
        java.net.URL url = MyClass.class.getResource("/mypackage/image.gif");
        System.out.println(url);
    }
} 
```

控制台输出：

```
C:\resource>dir /b /s
C:\resource\bin
C:\resource\src
C:\resource\bin\mypackage
C:\resource\bin\mypackage\image.gif
C:\resource\bin\mypackage\MyClass.class
C:\resource\src\mypackage
C:\resource\src\mypackage\MyClass.java

C:\resource>java -cp bin mypackage.MyClass
file:/C:/resource/bin/mypackage/image.gif 
```

# usability - 我可以做些什么来防止 wiki 风格网站上的写-写冲突？

> ID：624186
> 
> 赞同：9
> 
> 时间：2009-03-08T19:54:19.180
> 
> 标签：usability, wiki

在 wiki 风格的网站上，我可以做些什么来防止或减轻[写-写冲突](http://en.wikipedia.org/wiki/Write-Write_conflict)，同时仍然允许网站快速运行并保持网站易于使用？

我预见的问题是这样的：

1.  用户 A 开始编辑文件
2.  用户 B 开始编辑文件
3.  用户 A 完成文件编辑
4.  用户 B 完成文件编辑，不小心覆盖了用户 A 的所有编辑

以下是我想出的一些方法：

*   有某种签出/签入/锁定系统（尽管我不知道如何防止人们将文件签出“太长时间”，而且我不希望用户因*不被允许*而感到沮丧进行编辑）
*   有某种[差异](http://en.wikipedia.org/wiki/Diff)系统，显示用户提交更改并允许某种合并时所做的其他更改（但我担心这将难以创建并且会使网站“太难”使用）
*   *在用户进行更改时*通知用户并发编辑（某种 AJAX？）

还有其他方法可以解决这个问题吗？有没有很好地实现这一点的网站示例？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-08T20:04:57.563

记住上次更改的版本号（或 ID）。然后在写入之前阅读条目并比较此版本是否仍然相同。

如果发生冲突，请通知尝试写入同时更改的条目的用户。用差异支持他。

大多数 wiki 都是这样做的。[MediaWiki](http://www.mediawiki.org/wiki/MediaWiki)、[Usemod](http://www.usemod.com/cgi-bin/wiki.pl)等[_](http://en.wikipedia.org/wiki/Et_cetera) _

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-11T11:30:04.827

**三向合并：**首先要指出的是，大多数并发编辑，尤其是在较长的文档上，都是针对文本的不同部分。因此，通过记录用户 A 和 B 获得的修订版本，我们可以进行三向合并，如[Guiffy Software 的 Bill Ritcher 所述](http://www.cmcrossroads.com/content/view/6725/120/)。三向合并可以识别从原始文章中进行编辑的位置，除非它们发生冲突，否则它可以静默地将两个编辑合并到新文章中。理想情况下，此时执行合并并向用户 B 显示新文档，以便她可以选择进一步修改它。

**冲突解决：** 当两个编辑器都编辑了同一部分时，这会给您留下场景。在这种情况下，合并其他所有内容并将三个版本的文本提供给用户 B - 即包括原始文本 - 文本框中包含用户 A 的版本或用户 B 的版本。该选择取决于您是否认为默认应该是接受最新的（用户只需单击保存以保留他们的版本）或强制编辑器编辑两次以获取他们的更改（他们必须将更改重新应用到编辑器 A该部分的版本）。

使用像这样的三向合并避免了锁定，这在网络上很难很好地处理（你让他们锁定多长时间？），以及加重“你可能想再看一次”的情况，这只会适用于论坛式回复。它还保留了 web 的 post-response 风格。

如果您想对其进行 Ajax 处理，请在用户 A 的版本*正在编辑时将其*动态 3 路合并到用户 B 的版本中，并通知他们。现在那将是令人印象深刻的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-09T03:10:14.217

在 Mediawiki 中，服务器接受第一个更改，然后在保存第二个编辑时出现冲突页面，然后第二个人将两个更改合并在一起。参见[维基百科：帮助：编辑冲突](http://en.wikipedia.org/wiki/Help:Edit_conflict)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-08T20:07:06.090

使用锁定机制可能是最容易实现的。每篇文章都可以有一个与之关联的锁定字段和锁定时间。如果锁定时间超过某个设定值，您会认为锁定无效并在查看文章进行编辑时将其删除。您还可以跟踪打开的锁并在会话关闭时将其删除。您还需要在数据库中实现一些并发控制（可能是自动生成的时间戳），以便您可以确保您正在签入对您签出的版本的更新，以防两个人能够编辑同时发表文章。只有具有正确版本的人才能成功签入编辑。

您可能还可以找到一个差异引擎，您可以使用它来构建差异，尽管在 wiki 编辑器中显示它们可能会出现问题——实际上显示差异可能比构建差异更难。您将依靠版本控制系统来检测何时需要拒绝编辑并执行差异。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-15T15:59:19.043

在 Gmail 中，如果我们正在对邮件进行回复，而其他人在我们仍在键入时发送了回复，则会出现一个弹出窗口，指示有新的更新，并且更新本身会显示为另一个帖子，而无需重新加载页面。这种方法将满足您的需求，如果您可以使用 Ajax 显示确切的帖子，其中包含指向刚刚更新内容的差异的链接，而用户 B 仍在忙于输入他的条目，那将是很棒的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-15T22:12:50.080

正如 Ravi（和其他人）所说，您可以使用 AJAX 方法并在另一个更改正在进行时通知用户。提交编辑时，只需指出文本差异，然后让第二个用户弄清楚如何合并两个版本。

但是，我想添加一些新的东西，你可以尝试除此之外：在编辑进行编辑时打开他们之间的聊天对话框。[例如，您可以为此使用嵌入式Gabbly 之](http://www.gabbly.com/)类的东西。

我说，最好的冲突解决方案是直接对话。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-12T20:38:29.730

[使用Optimistic Concurrency Control](http://en.wikipedia.org/wiki/Optimistic_concurrency_control)可以最好地解决您的问题（丢失更新）。

一种实现是在系统的每个可编辑实体中添加一个**版本**列。在用户编辑时，您加载行并在用户身上显示 html 表单。一个隐藏字段给出了版本，比如说**3**。更新查询需要类似于：

```
update articles set ..., version=4 where id=14 and version=3; 
```

如果返回的行数为 0，则说明第 14 条已经有人更新了。那么您需要做的就是如何处理这种情况。一些常见的解决方案：

1.  最后一次提交获胜
2.  第一次提交获胜
3.  合并有冲突的更新
4.  让用户决定

您可以使用**时间戳**而不是递增**版本**int/long，但不建议这样做，因为：

 **> 在集群环境中，从 JVM 检索当前时间不一定是安全的，因为在集群环境中节点可能没有时间同步。

（引用[Java Persistence with Hibernate](http://www.manning.com/bauer2/)）

[hibernate 文档](http://www.hibernate.org/hib_docs/reference/en/html/transactions-optimistic.html)中的更多信息。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-17T22:12:09.670

在我的办公室，我们的政策是所有数据表都包含 4 个字段：

*   由...制作
*   创建日期
*   最后更新者
*   上次更新日期

这样就可以很好地跟踪谁对记录做了什么，至少最近是这样。

但最重要的是，将屏幕上当前或已编辑记录的 LastUpdateDate 与数据库中的值进行比较变得非常容易（需要您将其存储在页面上、cookie 中等）与数据库中的值。如果值不比赛，你可以从那里决定做什么。

# ruby-on-rails - Ruby On Rails 中的持久会话

> ID：624191
> 
> 赞同：1
> 
> 时间：2009-03-08T19:58:16.127
> 
> 标签：ruby-on-rails, session

我想在 Rails 应用程序中添加类似“记住我”选项的内容，并且我需要创建一个在用户关闭浏览器时不会过期的持久会话。我现在找到的唯一解决方案是使用插件： http: [//blog.codahale.com/2006/04/08/dynamic-session-expiration-times-with-rails/](http://blog.codahale.com/2006/04/08/dynamic-session-expiration-times-with-rails/)

还有其他（更好的）解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T20:05:20.137

使用 cookie 并将到期日期设置为非常遥远的未来。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T22:09:12.397

看看 technoweenie 的[restful authentication](http://github.com/technoweenie/restful-authentication/tree/master)是如何做到的。

特别[是生成器的第 122 行，](http://github.com/technoweenie/restful-authentication/blob/2ae4c22f5a42100458f8be89c9f366b4099a4451/generators/authenticated/templates/authenticated_system.rb#L122)它允许从 cookie 登录。

# sql-server - 在 SQL Server 中修改 XML 以添加根节点

> ID：624206
> 
> 赞同：6
> 
> 时间：2009-03-08T20:07:10.707
> 
> 标签：sql-server, xml, xpath, shred

为了首先给出这个问题的一些背景知识，我正在重写一些当前循环通过一些 xml 的代码，在每个循环结束时对表进行插入 - 替换为带有 xml 参数并在一个中插入的单个 sp去，将 xml '粉碎'到一个表中。

main shred 已成功完成，但目前其中一列用于存储整个节点。我已经能够（几乎）计算出必要的查询，但它错过了节点的根部分。我得出的结论是，我的查询已经尽我所能，我正在寻找一种方法来执行更新语句以将根节点放回那里。

所以我的xml是这样的；

```
<xml>
<Items>
<Item>
    <node1>...</node1><node2>..<node2>.....<noden>...<noden>
<Item>
<Item>
    <node1>...</node1><node2>..<node2>.....<noden>...<noden>
<Item>
<Item>
    <node1>...</node1><node2>..<node2>.....<noden>...<noden>
<Item>
......
<Items>
</xml> 
```

因此，基本粉碎将 node1 中的值放入 column1，将 node2 放入 column2 等。插入语句看起来像；

```
INSERT INTO mytable col1, col2,...etc.....,wholenodecolumn
Select  
doc.col.value('node1[1]', 'int') column1,
doc.col.value('node2[1]', 'varchar(50)') column2,
....etc......,
doc.col.query('*')--this is the query for getting the whole node
FROM @xml.nodes('//Items/Item') doc(col) 
```

以 Wholenodecolumn 结尾的 XML 格式为；

```
<node1>...</node1><node2>..<node2>.....<noden>...<noden> 
```

但我需要它的形式

```
<Item><node1>...</node1><node2>..<node2>.....<noden>...<noden></Item> 
```

现有代码（很多）取决于此列中的 xml 格式是否正确。

那么有人可以看到如何修改`doc.col.query('*')`以获得所需的结果吗？

无论如何，我放弃了修改查询，并尝试考虑其他方法来完成最终结果。我现在正在查看的是插入后的更新 - 类似于；

```
update mytable set wholenodecolumn.modify('insert <Item> as first before * ') 
```

如果我能做到这一点

```
 .modify('insert </Item> as last after * ') 
```

这很好，但一次做 1 不是一个选项，因为 XML 是无效的

```
XQuery [mytable.wholenodecolumn.modify()]: Expected end tag 'Item' 
```

并一起做我不知道这是否可能，但我尝试了各种语法并且无法开始工作。

任何其他解决问题的方法也很感激

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-08T21:29:51.040

我相信您可以使用 FOR 子句指定根节点名称。

例如：

```
select top 1 *
from HumanResources.Department
for XML AUTO, ROOT('RootNodeName') 
```

看看网上的书籍了解更多详情：

[http://msdn.microsoft.com/en-us/library/ms190922.aspx](http://msdn.microsoft.com/en-us/library/ms190922.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-09T14:19:29.367

在这里回答我自己的问题！- 这是从评论到我所说的其他尝试答案之一：

> 我目前正在查询查询中的 FLWOR Xquery 构造。
> `col.query('for $item in * return <Item> {$item} </item>')` 几乎就在那里，但围绕每个节点，而不是围绕所有节点

我的语法几乎就在那里，一个小的调整给了我我需要的东西；

```
doc.col.query('<Item> { for $item in * return $item } </item>' 
```

感谢所有帮助过的人。我现在有更多相关问题，但我将作为单独的问题发布

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T21:23:44.317

你不能在你的选择中添加''/''作为固定文本吗？就像是：

```
Select  
  '<Item>',
  doc.col.value('node1[1]', 'int') column1,
  doc.col.value('node2[1]', 'varchar(50)') column2,
  ....etc......,
  doc.col.query('*'),
  '</Item>'      --this is the query for getting the whole node
FROM @xml.nodes('//Items/Item') doc(col) 
```

马克

# java - 从长度为无符号整数的 ByteBuffer 中读取 UTF-8 字符串

> ID：624207
> 
> 赞同：1
> 
> 时间：2009-03-08T20:07:47.120
> 
> 标签：java, string, utf-8, bytebuffer

我正在尝试通过 java.nio.ByteBuffer 读取 UTF8 字符串。大小是一个未分割的 int，当然，Java 没有。我已将值读入 long 以便我拥有该值。

我遇到的下一个问题是我无法使用 long 创建一个字节数组，并且将他的 long 转换回 int 会导致它被签名。

我也尝试在缓冲区上使用 limit() ，但它同样适用于 int 不长。

我正在做的具体事情是从类文件中读取 UTF8 字符串，因此缓冲区中的内容不仅仅是 UTF8 字符串。

关于如何从 ByteBuffer 读取可能长度为 unsigned int 的 UTF8 字符串的任何想法。

编辑：

[这是该问题的一个示例](http://java.sun.com/j2se/1.4.2/docs/guide/jpda/SourceDebugExtension_attribute.html)。

```
SourceDebugExtension_attribute {
       u2 attribute_name_index;
       u4 attribute_length;
       u1 debug_extension[attribute_length];
    }

attribute_name_index
    The value of the attribute_name_index item must be a valid index into the constant_pool table. The constant_pool entry at that index must be a CONSTANT_Utf8_info structure representing the string "SourceDebugExtension".

attribute_length
    The value of the attribute_length item indicates the length of the attribute, excluding the initial six bytes. The value of the attribute_length item is thus the number of bytes in the debug_extension[] item.

debug_extension[]
    The debug_extension array holds a string, which must be in UTF-8 format. There is no terminating zero byte.

    The string in the debug_extension item will be interpreted as extended debugging information. The content of this string has no semantic effect on the Java Virtual Machine. 
```

因此，从技术角度来看，类文件中可能有一个长度为完整 u4（无符号，4 个字节）的字符串。

如果 UTF8 字符串的大小有限制，这些都不是问题（我不是 UTF8 专家，所以可能有这样的限制）。

我可以坚持下去并接受这样一个现实，即不会有这么长的字符串......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-08T20:09:53.680

除非您的字节数组超过 2GB（Java 的最大正值），否则将back 转换为 signed`int`不会有问题。`long``int`

如果您的字节数组长度需要超过 2GB，那么您做错了，尤其是因为这远远超过了 JVM 的默认最大堆大小......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T20:15:59.563

签署 int 不会是您的主要问题。假设你有一个长度为 40 亿的字符串。您需要一个至少为 4 GB 的 ByteBuffer，一个至少为 4 GB 的 byte[]。将其转换为字符串时，您需要至少 8 GB（每个字符 2 个字节）和一个 StringBuilder 来构建它。（至少 8 GB）所有你需要的，24 GB 来处理 1 个字符串。即使你有很多内存，你也不会得到很多这种大小的字符串。

另一种方法是将长度视为有符号，如果无符号则视为错误，因为无论如何您都没有足够的内存来处理字符串。即使要处理长度为 20 亿 (2^31-1) 的字符串，您也需要 12 GB 才能以这种方式将其转换为字符串。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T23:30:41.170

Java 数组根据语言[规范](http://java.sun.com/docs/books/jls/third_edition/html/arrays.html#10.4)使用（Java，即已签名）int 进行访问，因此不可能拥有比 Integer.MAX_INT 更长的字符串（由 char 数组支持）

但即使是这么多也无法在一个块中处理 - 如果遇到足够大的字符串，它会完全降低性能并使您的程序在大多数机器上因 OutOfMemoryError 而失败。

您应该做的是处理任何大小合理的字符串，一次说几兆。那么你可以处理的大小没有实际限制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-10T09:44:21.170

我想你可以在 ByteBuffer 之上实现[CharSequence 。](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/CharSequence.html)这将允许您防止“字符串”出现在堆上，尽管大多数处理字符的实用程序实际上都需要一个字符串。即便如此，实际上 CharSequence 也有一个限制。它期望大小以 int 形式返回。

（理论上，您可以创建一个新版本的 CharSequence，它以 long 形式返回大小，但是 Java 中没有任何东西可以帮助您处理该 CharSequence。如果您实现[subSequence(...)](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/CharSequence.html#subSequence(int,%20int))到返回一个普通的 CharSequence。）

# jquery - 第一个 jQuery 插件问题

> ID：624208
> 
> 赞同：1
> 
> 时间：2009-03-08T20:07:59.940
> 
> 标签：jquery, select, plugins, populate

嘿伙计们，首先让我说我是一个 jQuery 菜鸟！我想制作一个简单的插件来自动填充 html 选择元素，它在第一个元素上工作正常，但是当我再次调用它来填充第二个元素时，它什么也不附加。这是我在 ajax 选项卡中的调用，其中 #product 和 #new-category 是选择元素：

```
$(function(){

    $("#product").popSelect("products");

    $("#new-category").popSelect("categories");

}); 
```

HTML：

```
><select id="product" name="product">
>     < option value="">Select Product</option>                 
></select >     
><select id="new-category" name="new-category">
>      < option value="">Select Category< /option>                  
></select > 
```

这是插件：

```
(function(jQuery){
jQuery.fn.popSelect = function(table) {

    return jQuery(this).each(function(){            

        var obj = jQuery(this); 

        if(this.nodeName.toLowerCase() == 'select'){
            jQuery.getJSON("../app/modules/ajax/json.php", { table:table },
                function(data){                 
                    var options = '';           
                    jQuery.each(data, function(i,item){                                        
                        options += '<option value="' + item.id + '">' + item.title + '</option>';                   
                    });                 
                    obj.append(options);                
                });     
        };
    });
};
})(jQuery); 
```

奇怪的是，如果我将第二个函数调用更改 `$("#new-category").popSelect("categories");`为 `$("[id^='new-category']").popSelect("categories");` 它然后工作正常，我的选择器有问题吗？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T21:24:50.223

我刚刚回答了一个类似的问题，基本上[你不能在同一页面上有两个具有相同 ID 的元素](https://stackoverflow.com/questions/632263/where-is-this-jquery-wrong/632273#632273)，这会导致这个确切的问题。您必须使用一个类或更改其中一个 ID。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T21:59:23.340

我没有直接的答案，但看起来你将有 2 个活跃的 ajax 调用基本上同时未完成，这可能会导致一些奇怪？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T17:04:32.277

好的，像这样的吗？

```
(function($){
jQuery.fn.popSelect = function(table) {

    return $(this).each(function(){         

        var obj = $(this);  

        if(this.nodeName.toLowerCase() == 'select'){
            obj.queue("fx", function(){$.getJSON("../app/modules/ajax/json.php", { table:table },
                function(data){                 
                    var options = '';           
                    $.each(data, function(i,item){                                         
                        options += '<option value="' + item.id + '">' + item.title + '</option>';                   
                    });             
                    obj.append(options);                
                }); }); 
        };
    });};})(jQuery); 
```

我没有收到任何错误，但它仍然只填充第一个选择，在 IE 中的响应相同。令人费解的是，甚至在调用之间添加了一个“等待”功能，但它什么也没做。有id标签==名称标签好吗？我刚刚注意到，将“id='new-category'”替换为“id='newwcategory'”可以让它工作！？ids中的“-”有什么问题吗？

再次感谢迄今为止的所有帮助！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T14:41:52.610

我已经确定这是 jQuery UI 选项卡的一个问题，因为没有它们，该插件也可以完美运行！如果先前选择的选项卡具有相同 id 的元素，则不会填充当前选定选项卡中的元素。例子：

第一个标签：

```
<select id="new_category" name="new_category">

     <option value="">Select Category</option>
</select> 
```

第二个标签：

```
<select id="product" name="product">
      <option value="">Select Product</option>
</select>

<select id="new_category" name="new_category">
      <option value="">Select Category</option>
</select> 
```

第三个标签：

```
<select id="product" name="product">
      <option value="">Select Product</option>
</select> 
```

从选项卡 1 转到选项卡 2 - 将填充产品，但不会填充 new_category 并从选项卡 2 转到选项卡 3 - 不会填充产品...

即，如果当前选项卡中存在具有与前一个选项卡等效的 id 的元素，它将不会被填充，并且（可能？）前一个选项卡元素将是虽然我看不到这一点，因为它没有加载。我试过摆弄缓存，但它没有帮助，将表单 id 指定为其父级应该可以解决这个问题，但为什么有必要，标签不应该是独立的吗？

# visual-studio - 如何从 VS Team 项目中删除绑定？

> ID：624213
> 
> 赞同：2
> 
> 时间：2009-03-08T20:11:26.877
> 
> 标签：visual-studio, visual-studio-2008, tfs

如何从 VS Team 项目中删除绑定，是否只是删除“.vspscc”文件的问题？

最好的方法是什么，比如说我在 CodePlex 上有一个项目，是时候打包它以供发布了，但默认情况下，绑定与源一起提供，因此当其他人打开解决方案时，它会干扰它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T00:25:15.907

从源代码管理中解除绑定的简单方法：

1.  打开你的项目
2.  文件 -> 源代码管理 -> 更改源代码管理
3.  选择您的项目
4.  点击“解除绑​​定”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T20:42:04.790

什么对我有用（在 TFS 下，而不是 codeplex）

将项目文件夹复制或移出你的工作区（我放在了`c:\temp`），然后在VS2008中打开。

Visual Studio 然后显示以下提示：

> 该解决方案似乎受源代码控制，但找不到其绑定信息。因为无法自动恢复这些丢失的信息，所以缺少绑定的项目将被视为不受源代码控制。

之后，会出现另一个对话框，如下所示：

> 该解决方案似乎受源代码控制，但找不到其绑定信息。因为无法自动恢复这些丢失的信息，所以缺少绑定的项目将被视为不受源代码控制。

您可以选择*临时不受控制地工作*，或*永久删除源代码控制关联绑定*。

选择后者，执行*Save All*并重新加载解决方案。利润！

# c# - 参数化为方法时的变量与对象的 C# 范围

> ID：624217
> 
> 赞同：6
> 
> 时间：2009-03-08T20:16:46.550
> 
> 标签：c#, object, scope

我广泛使用了继承、多态和封装，但我刚刚意识到我不知道关于对象范围与变量的以下行为。最好用代码显示差异：

```
public class Obj
{
    public string sss {get; set;}

    public Obj()
    {
        sss = "0";
    } 
}     

public partial class testScope : System.Web.UI.Page
 {
    protected void Page_Load(object sender, EventArgs e)
    { 
        Obj a = new Obj(); 
        String sss = "0";            
        Context.Response.Write(sss); // 0

        FlipString(sss);
        FlipString(a.sss);
        Context.Response.Write(sss + a.sss); // 0 0

        FlipObject(a);
        Context.Response.Write(a.sss); // 1
        Context.Response.End();
    }

    public void FlipString(string str)
    { str = "1"; }

    public void FlipObject(Obj str)
    { str.sss = "1"; }
} 
```

所以我认为当一个变量被传递到一个方法中时，更改仅限于该方法的范围。但是，如果一个对象被传递到一个方法中，那么它的属性就会超出该方法的范围。

如果规则是对象而不是变量存在这种行为，但在.net 中，一切都是对象，字符串（例如示例中的字符串是 System.String），我可以接受这一点那么规则是什么，我如何预测我传递给方法的参数的范围？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-08T20:20:57.447

您永远不会将*对象*作为参数传递 - 您只会传递*引用*或值类型值。除非您使用`ref`关键字，否则参数是按值传递的 - 即参数的初始值是参数的评估值，调用者看不到参数值的更改。

但是，了解参数的值（对于引用类型）*只是 reference*非常重要。如果您更改引用所引用的对象的内容，那么调用者*将*看到*该*更改。

 *这是一个值得多读几段的主题——我建议您阅读我[关于 .NET 中的参数传递的文章以](http://pobox.com/~skeet/csharp/parameters.html)获取更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T20:20:40.567

我想我只是在谷歌上找到了它，.net 中的一些东西是“值”类型，而另一些是“引用”类型，所以对于值类型，值在被编组为方法时是重复的，但引用类型有一个类似传递给方法的指针或引用，显然与父级共享相同的范围。那么我的问题是如何判断某物是否是值类型，我看到像 int 这样的结构都是值类型，但字符串似乎表现得像结构，即使它们是对象 System.String？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T20:23:01.480

一个类（在你的例子中是 Obj）是一个[引用类型](http://msdn.microsoft.com/en-us/magazine/cc301569.aspx)，所以当你调用这个函数时，你真正在做的是将一个引用（你基本上可以把它看作是一个类型安全的指针）传递给这个对象。如果您想阻止对可变对象（即类/引用类型）的更改，那么您需要在将其传递给适当的函数之前克隆该对象（或简单地考虑使其成为一个结构，以便按值复制它）。

# language-agnostic - 我应该在自由职业者合同中签署竞业禁止条款吗？

> ID：624230
> 
> 赞同：15
> 
> 时间：2009-03-08T20:28:55.150
> 
> 标签：language-agnostic

我正在努力让自己成为一名 iPhone 自由职业者，目前正在与一家初创公司就一个更大的项目进行谈判。他们表示希望我签署一份非竞争协议，这样我就不会被允许为在同一地理市场上竞争的公司开发类似的产品。不用说，我真的不喜欢这个。

这是一种常见的做法吗？如果是这样，有多常见？你会签吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-08T20:42:03.603

它们很常见。如果您可以让他们删除它，请这样做。拥有一个永远不符合您的利益。也就是说，如果它们的范围很窄并且有合理的时间限制，它们并不可怕。您不希望有人说您不能编写任何其他 iPhone 应用程序。有人说您不能编写相同类型的应用程序可能是可以接受的。阅读语言并确定可以查看的范围。

您最终是否必须签署一份协议在很大程度上取决于关系中的力量。如果你真的需要这份工作，或者如果你的技能不能得到很多尊重，你就必须签字。另一方面，如果你带来了独特的技能并且公司真的想要你，那么你就有了影响力，并且很可能将其移除。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-09T03:03:48.990

我已经签了几个。正如其他人所说，我确保它们的范围非常狭窄..即我不能为另一家公司开发应用程序的“克隆”..除此之外，我不会签署它们。

要考虑的另一件事是，非竞争本质上是您的增值。通过签署一份合同，您可以让他们物有所值。因此，除了实际项目成本外，由于签署协议，他们应该为您在未来 3 年内不能做的任何项目提供一些补偿。

通常，当我提醒一家公司这一点时，他们会忘记非竞争性，并满足于相信我的道德规范 + 保密协议。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-08T20:35:44.947

这并不少见，但请确保它指定了某种到期时间。一旦你在一个特定的领域或市场站稳了脚跟，你很可能会想继续在那个市场上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T20:34:26.477

这很常见，尤其是如果您要开发的产品具有创新性。你必须决定签署与否。我已经签了几次这样的合同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-01-06T20:06:30.773

NDA（保密协议）。我已多次签署的普遍协议。客户强迫开发商签署协议的原因之一是不开发复制品或将相同的软件出售给其他客户。

这是事实，因此大多数客户希望您签署一份包含或不包含到期日期的几行条款的协议

它很常见，因此您可以签署并开始工作，但请确保您彻底阅读所有条款以跳过假冒客户

# python - 斜纹/机械化访问 html 内容

> ID：624232
> 
> 赞同：5
> 
> 时间：2009-03-08T20:30:54.927
> 
> 标签：python, twill, mechanize-python

[关于斜纹](http://twill.idyll.org/)和[机械化](http://wwwsearch.sourceforge.net/mechanize/)的几个问题：

1.  Twill 作为网络自动化工具是否仍然适用？如果是，那么为什么目前没有维护？如果没有，Mechanize 是否进一步成熟以支持 Twill 风格的简单脚本？或者是否有另一个包已经加紧填补空白？

2.  我能够非常快速地使用 Twill 在 python 中设置几个测试套件，但我对如何访问 Twill 在我的 python 程序中吐出的信息有点困惑。也就是说，我可以执行 showforms() 并查看整齐列出的表单值，我可以使用 fv 更新表单值并提交。但是我如何以 python var 的形式访问这些表单值之一？我该怎么说：`someField1Value = fv("1","someField1")`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-11T22:54:49.587

斜纹布是[机械包周围的薄壳](http://twill.idyll.org/python-api.html)。你是对的，它似乎没有得到积极的维护，所以我会坚持使用 Mechanize。

但是 Mechanize 不支持您所追求的简单界面。为此，我会推荐[Chickenfoot](http://groups.csail.mit.edu/uid/chickenfoot/quickstart.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-04-03T20:42:59.940

这个问题很老，但在谷歌上排名很高。

截至 2014 年，官方斜纹布似乎已经死了，邮件列表也是如此。

github上有fork：

[https://github.com/zenoss/twill](https://github.com/zenoss/twill)

[https://github.com/ctb/twill](https://github.com/ctb/twill)

# delphi - 在 Delphi 2009 中显示 PDF 文件的最佳方式是什么

> ID：624246
> 
> 赞同：10
> 
> 时间：2009-03-08T20:41:29.220
> 
> 标签：delphi, pdf, delphi-2009, components

我应该使用什么组件在 Delphi 2009 应用程序中显示 PDF 文件？

编辑：

我一直在使用 Synactis 的[PDF 查看器](http://www.synactis.com/pdf-viewer.htm)- 一个非常不错的免费 PDF 查看器，但它不支持 Delphi 2009。

所以我需要从产品中设计出来

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-08T21:06:57.240

我们在 Delphi 应用程序中嵌入了 Acrobat Reader。看看这篇文章“[如何将 Adob​​e Acrobat 嵌入到您的应用程序中](http://edn.embarcadero.com/article/22101)”。将 Acrobat Reader ActiveX 组件添加到表单后，您可以使用以下代码：

```
procedure TForm1.Button1Click(Sender: TObject); 
begin
  // This example assumes that you have a TOpenDialog
  // and TPdf dropped onto your form
  OpenDialog1.Filter := 'PDF Files (*.pdf)|*.pdf';
  if OpenDialog1.Execute then
    Pdf1.src := OpenDialog1.FileName;
end; 
```

那里有原生的 Delphi 组件，但嵌入 Acrobat Reader 组件可以满足我们的需求。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-09T07:54:53.877

我有一种感觉，越来越多的用户更喜欢 acrobat reader 的替代品，所以强迫他们安装 acrobat 来使用你的程序是一个坏主意。

[Gnistice PDFtoolkit](http://www.gnostice.com/PDFtoolkit_VCL.asp)的 ProPlus 版本可让您显示 pdf 文件。[QuickPDFLibrary](http://www.quickpdflibrary.com/)也是如此。我敢肯定还有更多。

在用户喜欢的 pdf 查看器中启动文件可能是更好地控制打印等的第二种选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T08:42:40.033

如果您只想显示一个 pdf，为什么不启动用户安装的应用程序来查看 pdf 文件呢？这样他们就不会因为你的程序而无视他们的选择而烦恼，而且他们也已经熟悉了这个程序。

其他选项包括使用 Kris De Decker 建议的 Adob​​e 的 acrobat 阅读器插件，或者我相信其他查看器也提供的插件。这可能会给你一些更多的控制，但你肯定也会发现控制并不像你想要的那样彻底。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-10-11T08:52:22.007

可以使用 Twebbrowser 或 Bsalsa Web 文档，对文件路径进行 URL 编码并将其作为 Web 文档传递——它将在浏览器区域加载默认的 PDF 应用程序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T17:51:30.610

WPCubed ( [http://wptools.de/](http://wptools.de/) ) 提供带有免版税分发许可证的 WPViewPDF 工具和 Delphi 支持 - 4,5,6,7, 2005, 2006, 2007, BCB 5,6,2006, 2007

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-29T05:23:30.563

我没有使用过 wptools PDF 查看器，但我可以说他们的其他 PDF 工具是一流的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-04T17:59:53.887

在 Delphi 中嵌入原始 Acrobat Reader ActiveX 是最好的方式，而且是免费的。如果你想创建PDF，那会花费很多。

# c++ - 如何在 C++ 中读取/写入 gzip 压缩文件？

> ID：624250
> 
> 赞同：15
> 
> 时间：2009-03-08T20:45:24.143
> 
> 标签：c++, gzip, zlib, gzipstream

如何在 C++ 中读取/写入 gzip 压缩文件？

[这里](http://www-d0.fnal.gov/d0dist/dist/packages/lm_access/devel/lm_access/gzstream.hpp)的`iostream`包装类看起来不错，下面是一个简单的使用示例：

```
gz::igzstream in(filename);
std::string line;
while(std::getline(in, line)){
  std::cout << line << std::endl;
} 
```

但我无法真正链接它（虽然我有一个`/usr/lib/libz.a`）。一个简单的

```
g++ test-gzstream.cpp -lz 
```

没有这样做（`undefined reference to gz::gzstreambase::~gzstreambase()`）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-08T20:51:35.360

考虑使用 Boost zip 过滤器。据他们说，它支持`bzip`,`gzip`和`zlib`格式。

*   [提升 zlib](http://www.boost.org/doc/libs/1_38_0/libs/iostreams/doc/classes/zlib.html)
*   [提升 gzip](http://www.boost.org/doc/libs/1_38_0/libs/iostreams/doc/classes/gzip.html)
*   [提升 bzip2](http://www.boost.org/doc/libs/1_38_0/libs/iostreams/doc/classes/bzip2.html)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-10-20T20:13:46.117

为了提供比其他用户简要提到的更多细节，以下是我如何`gzstream`在我的计算机上使用。

首先，我`gzstream`在我家下载并安装了它（最后两行可以添加到你的`~/.bash_profile`）：

```
cd ~/src
mkdir GZSTREAM
cd GZSTREAM/
wget http://www.cs.unc.edu/Research/compgeom/gzstream/gzstream.tgz
tar xzvf gzstream.tgz
cd gzstream
make
export CPLUS_INCLUDE_PATH=$HOME/src/GZSTREAM/gzstream
export LIBRARY_PATH=$HOME/src/GZSTREAM/gzstream 
```

然后，我测试了安装：

```
make test
...
# *** O.K. Test finished successfully. *** 
```

最后，我编写了一个虚拟程序来检查我是否可以有效地使用该库：

```
cd ~/temp
vim test.cpp 
```

这是代码（非常简约，应该针对实际应用进行很大改进！）：

```
#include <iostream>
#include <string>
#include <gzstream.h>
using namespace std;

int main (int argc, char ** argv)
{
  cout << "START" << endl;

  igzstream in(argv[1]);
  string line;
  while (getline(in, line))
  {
    cout << line << endl;
  }

  cout << "END" << endl;
} 
```

这是我编译它的方法：

```
gcc -Wall test.cpp -lstdc++ -lgzstream -lz 
```

最后但并非最不重要的是，这是我使用它的方式：

```
ls ~/ | gzip > input.gz
./a.out input.gz
START
bin/
src/
temp/
work/
END 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-08T20:51:31.537

显然，您还需要定义 gzstreambase 析构函数的 cpp 文件，即[gzstream.cpp](http://www.cs.unc.edu/Research/compgeom/gzstream/#inst)（这是链接错误）。libz 只是 gzip 的 c-api，它对 c++ stdlib 流一无所知。

Boost 的 iostream 库也有 gzip 和 bzip2 流。

编辑：更新了链接以指向包含主要错误修复的代码的最新版本。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-21T22:44:54.500

旧的 GCC 编译器也有这个问题。我只是通过制作 gzstream 的仅标头版本来解决此问题，该版本应该更易于使用。

[https://gist.github.com/1508048](https://gist.github.com/1508048)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-08T21:01:09.627

这是来自“Gzstream图书馆主页”

> 手动编译 gzstream.C，将其放入某个库中，然后将 gzstream.h 移动到编译器的包含搜索路径中。或者使用提供的 Makefile，修改其变量，并按照 Makefile 中的说明进行操作。

# asp.net-mvc - ASP.NET MVC Html.SubmitImage

> ID：624252
> 
> 赞同：0
> 
> 时间：2009-03-08T20:46:30.350
> 
> 标签：asp.net-mvc

我在 RC1 中寻找 Html.SubmitImage 并且在通过 MVC 程序集反映时在任何地方都看不到它。

它是否已被移动/移除？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T21:39:51.063

SubmitImage 已移至 RC1 中的 MvcFutures。[您可以在http://www.codeplex.com/aspnet](http://www.codeplex.com/aspnet)找到实际来源。RC1 变更集位于[http://aspnet.codeplex.com/SourceControl/changeset/view/21528](http://aspnet.codeplex.com/SourceControl/changeset/view/21528)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T18:49:17.907

对于其他人来说，这是 HtmlHelper 的 SubmitButton 扩展的快速模型。

```
public static class HtmlLinkExtensions
{
    public static string SubmitButton(this HtmlHelper htmlHelper, string imageLink, string value, string altText)
    {
        return string.Format("<input type='image' src='{0}' value='{1}' alt='{2}' />", imageLink, value, altText);
    }
} 
```

# sql-server-2005 - MS Sql Server 2005+ 表索引创建可以自动化吗？

> ID：624255
> 
> 赞同：0
> 
> 时间：2009-03-08T20:49:59.840
> 
> 标签：sql-server-2005

我在 MSDN 杂志上阅读 Ian Stirk 的[Uncover Hidden Data to Optimize Application Performance](http://msdn.microsoft.com/en-us/magazine/cc135978.aspx)文章，现在我想知道是否可以像 Google AppEngine 的 BigTable 那样自动创建表索引。

是否有任何工具或 Sql Server 功能可以自动创建表索引？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T21:21:29.780

不，据我所知，SQL Server 中没有启用自动表索引创建的功能。

我也不认为这是一个好主意，因为获得正确的索引将取决于多种因素，几乎没有任何一个因素可以真正实现自动化。

当然——你可以在任何名为“ID”的列上放置一个主键——直到你遇到需要在其他东西上使用主键的情况......

当然，在子表中索引外键列是有意义的 - 但有时，插入的额外开销可能会抵消拥有索引的收益。

获得正确的索引太依赖于您的实际使用和许多动态的使用参数（以及您的设计决策），所以如果任何解决方案真的能很好地工作，我会感到惊讶.. .

马克

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T21:21:39.703

我不知道任何工具，创建索引的最佳方法是手动检查查询及其执行计划。我认为自动化工具永远不会像一些优秀的 DBA 和 Profiler 一起分析数据那样好。

但是，如果您想自己尝试一下，我建议您开始查看 SQL Server 中的性能视图。

从 function 开始`sys.dm_db_missing_index_columns`，它应该会提示您哪些列可以从索引中受益。

`sys.dm_db_index_usage_stats`可以向您显示哪些索引是无用的，或者也可以进行优化。

`sys.dm_exec_cached_plans`, `sys.dm_exec_query_plan`,`sys.dm_exec_query_stats`并且`sys.dm_exec_sql_text`应该向您展示执行的查询及其执行方式，以及来自其他表的信息，您可能会找出哪些需要更多工作。

实际上，我隐约记得有一些向导可以帮助您在 Profiler 中分析性能，可能不是自动的，但可以将其放入维护计划中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-04-14T12:11:08.327

我很高兴你喜欢我的文章！

在我关于通过 DMV 的 SQL Server 性能的新书 (www.manning.com/stirk) 的第 10 章中，您将看到一个允许您自动创建索引的脚本......还有一个删除未使用索引的脚本...... . 你可以看到这些如何一起使用。

谢谢伊恩

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-03T08:29:45.380

我知道这是一个旧线程，但我认为有人可能会觉得这很有趣：

[http://blogs.msdn.com/b/queryoptteam/archive/2006/06/01/613516.aspx](http://blogs.msdn.com/b/queryoptteam/archive/2006/06/01/613516.aspx)

尽管这听起来很棒，但我还是要小心——索引可以尽可能多地削弱系统——只有在你知道自己在做什么的情况下才使用！

# c++ - 如何重用 ostringstream？

> ID：624260
> 
> 赞同：122
> 
> 时间：2009-03-08T20:53:24.247
> 
> 标签：c++, stl, reset, ostringstream

我想清除并重用一个 ostringstream （和底层缓冲区），这样我的应用程序就不必做太多的分配。如何将对象重置为其初始状态？

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2009-03-08T21:08:38.750

我过去使用过一系列 clear 和 str ：

```
// clear, because eof or other bits may be still set. 
s.clear();
s.str(""); 
```

这对输入和输出字符串流都做了这件事。或者，您可以手动清除，然后寻找适当的顺序开始：

```
s.clear();
s.seekp(0); // for outputs: seek put ptr to start
s.seekg(0); // for inputs: seek get ptr to start 
```

这将`str`通过覆盖当前输出缓冲区中的任何内容来防止某些重新分配。结果是这样的：

```
std::ostringstream s;
s << "hello";
s.seekp(0);
s << "b";
assert(s.str() == "bello"); 
```

如果你想将字符串用于 c 函数，你可以使用`std::ends`，像这样放置一个终止的 null ：

```
std::ostringstream s;
s << "hello";
s.seekp(0);
s << "b" << std::ends;
assert(s.str().size() == 5 && std::strlen(s.str().data()) == 1); 
```

`std::ends`是 deprecated 的残余`std::strstream`，它能够直接写入您在堆栈上分配的 char 数组。您必须手动插入终止空值。但是，`std::ends`我认为它并没有被弃用，因为它在上述情况下仍然有用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-08T21:01:43.150

似乎这个`ostr.str("")`电话可以解决问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-03T00:31:56.380

如果您要清除缓冲区以使其在第一次使用之前被清除，您需要首先使用 MSVC 向缓冲区添加一些内容。

```
struct Foo {
    std::ostringstream d_str;
    Foo() { 
        d_str << std::ends;   // Add this
    }
    void StrFunc(const char *);
    template<class T>
    inline void StrIt(const T &value) {
        d_str.clear();
        d_str.seekp(0);  // Or else you'll get an error with this seek
        d_str << value << std::ends;
        StrFunc(d_str.str().c_str());  // And your string will be empty
    }
}; 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-08T21:04:01.680

你没有。为了清楚起见，使用两个不同命名的流，并让优化编译器确定它可以重用旧的流。

# web - 如何为手机设计网站

> ID：624262
> 
> 赞同：9
> 
> 时间：2009-03-08T20:54:45.913
> 
> 标签：web, cross-browser

我怎样才能开始开发一个可以从手机浏览的网站？例如，如果您从 iPhone 浏览 Gmail 网站，则该网站看起来与普通网站不同。你必须设计两个不同的网站来做到这一点？我如何知道该网站是否被移动浏览器访问？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-09T06:25:01.970

您不必设计两个不同的网站，但如果让移动用户访问您的网站很重要，您可能希望这样做。

有几种方法可以解决这个问题，每种方法都有利有弊。我假设您的网站在数据库中有其信息，并使用一组模板发布该数据？（如 Ruby on Rails 或 Django 站点；PHP 站点；博客等）如果您手动编写了一堆静态 HTML 页面，这对您来说将是更加劳动密集型的。

**1：相同的 HTML，不同的样式表用于 SCREEN 和 MOBILE**

想法：您为所有请求提供相同的 HTML 结构。您为 SCREEN 创建一个样式表，为 MOBILE 创建一个样式表。

好：对你来说，程序员。维护 2 个样式表比维护 2 个完全独立的模板站点更容易。

不好：对于您的用户。一个易于在移动设备上使用的网站通常对于普通浏览器来说效率低下；为台式机/笔记本电脑优化的网站通常在移动设备上失败。显然，这取决于您如何对页面进行编码，但在大多数情况下，将您的普通网站推送到移动浏览器对您的用户不利。（请参阅[http://www.useit.com/alertbox/mobile-usability.html](http://www.useit.com/alertbox/mobile-usability.html)，了解 Jakob Nielsen 最近对移动网站的可用性研究的摘要。）

**2：维护单独的站点**

（Gmail 维护甚至超过 2 个系统！它们基本上有不同的容器应用程序/模板来处理相同的数据：完整的 AJAX 浏览器版本；纯 HTML 浏览器版本；基本的移动版本；原生黑莓应用程序；和原生 iPhone 应用程序.)

这是真正关心同时拥有移动和桌面存在的网站的新兴标准。这对您来说工作量更大，但总的来说对您的用户来说要好得多。

从好的方面来说，您可能可以创建一个精简的纯 HTML 网站，该网站适用于移动设备，并且可以作为少数没有 javascript 或有主要可访问性问题阻止他们使用“完整“ 地点。

此外，取决于您的用户群：在美国，人们通常可以使用台式机/笔记本电脑，并使用他们的移动设备进行辅助访问。例如，我使用台式电脑预订机票和租车，但我想在手机上查找预订代码。在许多情况下，您可以避免限制您在移动网站上提供的功能，并要求使用完整的计算机来执行不常见的用例。

基本程序：

1.  为移动设备和屏幕设计和构建 UI。
2.  在两个不同的 URL 上启动站点；新兴的约定是桌面版的 www.yoursite.com 和移动版的 m.yoursite.com。（这允许用户在知道约定的情况下直接浏览到 m.yoursite.com。）
3.  在 www.yoursite.com 上，嗅探用户代理并测试用户的浏览器是否是移动的。如果是这样，请将用户定向到 m.yoursite.com。
    1.  您可能会使用用各种服务器语言（PHP、Perl 等）编写的嗅探器。检查许可证。[这是一个用 php 编写的嗅探器示例](http://detectmobilebrowsers.mobi/)。
    2.  来自[维基百科关于用户代理嗅探的文章](http://en.wikipedia.org/wiki/User_agent)：“专门针对手机的网站，如 NTT DoCoMo 的 I-Mode 或沃达丰的 Vodafone Live！门户网站，通常严重依赖用户代理嗅探，因为移动浏览器之间通常存在很大差异。手机浏览是近几年才出现的，而很多不具备这些新技术的老款手机仍然在大量使用，因此手机门户网站往往会根据浏览手机的不同，生成完全不同的标记代码。可以很小（例如调整某些图像的大小以适应较小的屏幕），也可以非常广泛（例如以 WML 而非 XHTML 呈现页面）。”
4.  在 m.yoursite.com 上，提供指向 www.yoursite.com 的链接。单击此链接的用户不应被重定向回移动站点，您如何完成此操作取决于您的实施。

您可能想关注[Quirksmode](http://www.quirksmode.org/blog/archives/2009/03/testing_mobile.html)以获取他关于移动测试的新兴文章。

**3：模板根据用户代理输出不同的数据块，并维护单独的样式表**

与 (2) 一样，这需要您嗅探用户代理。与 (2) 不同，您仍然使用所有相同的页面逻辑，并且不必维护两个单独的站点。如果您只是在处理主要是关于读取数据的博客或网站，这可能没问题。

在您的模板代码中，您可以这样说

```
if( $useragentType != mobile ) {
    echo( 'bigBlockOfRelatedArticlesAndAds.php' );
} 
```

这使您可以主要维护一组模板文件。您还可以简化发送给移动用户的页面，这样当他们只想阅读您的博客文章或其他内容时，他们就不会得到一个臃肿的页面。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-08T22:41:46.703

如今，大多数移动设备都支持“移动样式表”，它们只是用于更简单地显示内容的替代样式表。您可以以正常方式将移动样式表添加到您的站点并包含以下`media="handheld"`属性：

```
<link rel="stylesheet" type="text/css" href="/mobile.css" media="handheld" /> 
```

然后这些样式将适用于手机。

这种方法的唯一问题是，如果您的 HTML 很庞大，加载页面可能需要一段时间，因为大多数移动浏览器速度较慢（Opera Mini 除外）。这就是为什么像 flickr 和 digg 这样的大型网站使用不同的网站的原因。

补充笔记：

*   庞大的 HTML 对 Opera Mini 的影响不大，因为它使用代理在外部进行渲染，然后将特殊的“图像”发送到设备。
*   使用简单、干净的 HTML，然后您可以将其发送到普通浏览器和移动设备
*   您必须检查样式表与`media`属性的组合。IIRC 添加上面的代码将使浏览器忽略第一个样式表。如果您添加`media="all"`到第一个，两者都将被使用（因此您可以覆盖原始样式而不是重新开始）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T21:23:09.183

保持简单，想想[opera mini](http://www.opera.com/mini/)，你会做对的。（iPhone 有更多的普通浏览器......）

1.  专注于内容

2.  避免插件

3.  遵循网络标准

4.  将内容与布局/设计分开，尽可能多地使用 css。

5.  使用文字和图片。

如果需要，请添加其余的花里胡哨，但请确保网站内容始终可用，即使关闭了花里胡哨。如果您可以使用像 lynx 这样的简单浏览器和像 firefox 这样的普通浏览器来浏览页面，那么您就在正确的轨道上。

欲了解更多信息，请随时访问[任何浏览器活动](http://www.anybrowser.org/campaign/)

* * *

编辑：如果您对不同类型的浏览器使用不同的 css 并不明显，但始终使用相同的内容。访问[css zen garden](http://www.csszengarden.com/)以获得一个不错的演示。

* * *

更新：添加指向 css 媒体类型的链接，正如其他人所说，它是有趣的手持选项。

*   [http://www.w3.org/TR/CSS21/media.html](http://www.w3.org/TR/CSS21/media.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-08T22:24:45.917

要检查网页在移动浏览器中的外观，请使用[Opera Mini Emulator](http://www.opera.com/mini/demo/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-09T01:25:02.520

查看[WURFL](http://wurfl.sourceforge.net/)项目。它的目的是帮助开发人员针对多种手机浏览器，并且早在 Mobile Safari 出现之前就开始了，那是在 HDML、WAP 和 XHTML-MP 时代。然而，它是最新的，存储现代设备（如 iPhone）的功能。它拥有超过 400 台设备的数据，并拥有 Java、PHP、Perl、Ruby、Python、.NET、C++ 库。根据您希望针对您的移动应用程序的广泛程度，这是值得关注的。[这](http://wurfl.sourceforge.net/links.php)是使用 WURFL 的网站列表。

Luca Passani（WURFL 的联合创始人和维护者）编写的另一个相关项目是[Switcher](http://www.passani.it/switcher/)。您可以使用它自动重定向到您网站的移动版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-08T21:00:23.543

> 你必须设计两个不同的网站来做到这一点？

是的

> 我如何知道该网站是否被移动浏览器访问？

您的编程语言可能具有某种查看客户信息的方式。例如，PHP 有一个超全局变量`$_SERVER`，其中包含服务服务器和访问客户端的各种信息。在这种情况下，您会对 的值感兴趣`$_SERVER['HTTP_USER_AGENT']`，如果我访问一个页面，它将给出以下结果：

```
Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_6; en-us) AppleWebKit/528.16 (KHTML, like Gecko) 版本/4.0 Safari/528.16
```

这告诉您我正在使用 Safari 4.0 运行 Mac OS X 10.5.6。各种移动浏览器都有已知的关键字。例如，iPhone 浏览器的一个版本具有以下用户代理：

```
Mozilla/5.0 (iPhone; U; CPU like Mac OS X; en) AppleWebKit/420+ (KHTML, like Gecko) Version/3.0 Mobile/1A543a Safari/419.3
```

“iPhone”已经放弃了它，但通过关键词“Mobile”和“Safari”进一步证实了这一点

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-08T22:08:55.907

大多数网站的移动网站子域略有不同（大多数使用“m”）。例如[flickr](http://www.flickr.com)使用[m.flickr.com](http://m.flickr.com)

（有人建议使用[.mobi TLD](http://en.wikipedia.org/wiki/.mobi)，但我从未见过使用过）

让设计超级简单，不要使用太多的图形，你需要将它们尽可能小。 [这](http://www.w3.org/TR/mobile-bp/)可能对设计有所帮助。

我可能会为移动用户构建一组不同的页面，使用与主站点相同的业务对象等。

如果这两个景点的设计差异不是很大，您也许可以通过提供单独的 CSS 文件来获得一种方法？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-22T19:41:24.983

您的网站应仅限于可以支持最大要求的手机。你甚至不能娱乐所有的[手机](http://cellsindex.com/mobile-nokia-m2)。

您的网站应该有不同的 css 样式集，并且 HTTP AGENT 必须根据请求 Css 选择检查客户端类型。

# c# - 如何将此 CRC 检查从 Matlab 转换为 c#？

> ID：624264
> 
> 赞同：1
> 
> 时间：2009-03-08T20:56:23.273
> 
> 标签：c#, matlab

我正在尝试将此 MATLAB 函数转换为 c#，但结果不如预期。

MATLAB：

```
function check=CRC8(xa);
% xa is array of bits to be transmitted (column vector)
% Generates 8-bit CRC check with g(x) = x^8 + x^2 +x + 1
    xae = [xa;0;0;0;0;0;0;0;0]; % Append 8 zeros to array containing bit-stream
    g8x = [1;0;0;0;0;0;1;1;1] ; % Generator polynomial
    xsa=xae(1:9);
    for i=1:length(xa)
        if xsa(1) = = g8x(1), xsa = xor(xsa,g8x); end;
        xsa(1:8)=xsa(2:9);
        if i<length(xa) xsa(9)=xae(i+9); end;
    end;
    check = xsa(1:8); % 8 bit CRC column vector
    return; 
```

C＃

```
 public static int[] checkCRC8(int[] xa)
    {

        int[] g8x = { 1, 0, 0, 0, 0, 0, 1, 1, 1 };

        int[] xae = new int[xa.Length + 8];
        xa.CopyTo(xae, 0);
        //add zeros
        for (int i = xa.Length; i < xae.Length; i++)
        {
            xae[i] = 0;
        }

        int[] xsa = new int[8];
        for (int i = 0; i < 8; i++)
        {
            xsa[i] = xae[i];
        }

        for (int i = 0; i < xa.Length; i++)
        {
            if (xsa[0] == g8x[0])
            {
                //xor xsa with g8x
                for (int j = 0; j < xsa.Length; j++)
                {
                    xsa[j] = xsa[j] ^ g8x[j];
                }
            }
            //shift array elements left
            for (int j = 0; j < xsa.Length - 1; j++)
            {
                xsa[j] = xsa[j + 1];
            }

            if (i < xa.Length)
            {
                xsa[xsa.Length - 1] = xae[i + 8];
            }

        }
        return xsa;
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T21:37:37.747

像 in 这样的 matlab 范围`xsa = xae(1:9)`是包容性的，所以`xsa`应该有九个元素而不是八个。另外，由于你`i`已经是从零开始的，我认为最后一个 if 应该比较`xa.Length-1`并使用数组元素 at`i+9`而不是`i+8`：

```
if (i < xa.Length - 1)
{
   xsa[xsa.Length - 1] = xae[i + 9];
} 
```

# python - 如何使默认选择的 Django ModelForm 菜单项？

> ID：624265
> 
> 赞同：11
> 
> 时间：2009-03-08T20:56:46.737
> 
> 标签：python, django, django-forms

我正在开发一个 Django 应用程序。我的模型之一“用户”包含一个“性别”字段，定义如下：

```
GENDER_CHOICES = (
        ('M', 'Male'),
        ('F', 'Female'),
    )
gender = models.CharField(max_length=1, choices=GENDER_CHOICES, null=True) 
```

我正在使用 ModelForm 生成“新用户”HTML 表单。我的 Google-fu 似乎让我失望了——我怎样才能让这个 HTML 表单在下拉框中默认选中“男性”项目？（即`selected="selected"`这个项目。）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-08T21:45:42.670

如果您需要一个选择了默认值的空白表单，则使用字段名称作为键将“初始”字典传递给模型表单的构造函数：

```
form = MyModelForm (initial={'gender':'M'}) 
```

-或者-

您可以使用 Forms API 的声明性来覆盖 ModelForm 的某些属性。但是，对于这个用例来说，这可能有点麻烦，我提到它只是为了向您展示您可以做到。将来您可能会发现此功能的其他用途。

```
class MyModelForm (forms.ModelForm):
    gender = forms.ChoiceField (choices=..., initial='M', ...)
    class Meta:
        model=MyModel 
```

-或者-

如果您想要一个绑定到模型的特定实例的 ModelForm，您可以传递模型的“实例”，这会导致 Django 从该模型中提取选定的值。

```
form = MyModelForm (instance=someinst) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-08T21:19:46.913

肯定`default`会成功吗？

例如

```
gender = models.CharField(max_length=1, choices=GENDER_CHOICES, default='M', null=True)
```

# asp.net - 为作为服务器控件的 DIV 设置一个类

> ID：624269
> 
> 赞同：2
> 
> 时间：2009-03-08T20:58:56.497
> 
> 标签：asp.net, css

我有不同的 CSS 样式，其中之一是：

```
#layoutsectiondiv{
    border: 2px dashed #000000; 
   padding: 1px;
    left: 0px;
} 
```

我有一个 aspx 页面：

```
<div id="testDiv" runat="server">

</div> 
```

如果它是常规的 HTML，我会设置 div 的样式

```
<div id="layoutsectiondiv">

</div> 
```

在运行时（在后面的代码中），我需要为 DIV 动态分配不同的样式。我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T21:00:49.033

使用 class 属性并更改您的 css 样式以使用类选择器而不是 id 选择器。例如

```
.layoutsectiondiv{}

<div id="testDiv" class="layoutsectiondiv">
</div> 
```

# 编辑

只创建您的课程，以便您将其应用于您想要的特定 div。不要重用你的课程。这应该很容易，因为您的 css 已经绑定到特定 ID，只需将该类放在该元素上即可。

如果您在许多类型的元素上使用该类，那么您建议的效果会很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T21:14:55.770

Josh 是对的，你应该使用 class 而不是 id。

对于你的问题：

> 在运行时（在后面的代码中），我需要为 DIV 动态分配不同的样式。我该怎么做？

试试这个 ：

```
// layoutsectiondiv is defined as class : .layoutsectiondiv{}
testDiv.Attributes["class"] = "layoutsectiondiv"; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-09T08:53:38.807

因此，您可以通过这种方式使用 css id 选择器。

```
#layoutsectiondiv { color: red } 
```

使用以下html

```
<div id="layoutsectiondiv">    
</div> 
```

或者像这样的 css 类 html 选择器。

```
.layoutsectiondiv { color: blue } 
```

使用以下html

```
<div class="layoutsectiondiv">
</div> 
```

如果您想控制特定.net 控件的样式，即具有runat="server" 属性的控件，那么我们知道.net 将“修改”id 以确保其唯一性。

在这种情况下，在我们的代码中，我们可以使用 FindControl 访问 div 并更改其样式

```
<div id="testDiv" runat="server">
</div> 
```

IE。

```
 HtmlGenericControl testDiv =
            (HtmlGenericControl)Page.FindControl("testDiv");

        // to hide
        testDiv.Attributes.Add("style", "display: none");  // OR
        testDiv.Attributes["style"] = "display: none";

        // to show
        testDiv.Attributes.Add("style", "display: block"); // OR
        testDiv.Attributes["style"] = "display: block";

        // or to add a class
        testDiv.Attributes.Add("class", "MyCssClassName"); // OR
        testDiv.Attributes["class"] = "MyCssClassName"; 
```

这是关于 css id 和 class 之间区别的一个很好的解释 - [CSS: div id VS。div 类](https://stackoverflow.com/questions/544010/css-div-id-vs-div-class)。

在这里了解[如何在 .NET 中使用 C# 编辑 div 的 CSS 样式](https://stackoverflow.com/questions/175381/how-to-edit-css-style-of-a-div-using-c-in-net)

# sharepoint - 如何部署具有多个站点的 Sharepoint 发布站点

> ID：624296
> 
> 赞同：2
> 
> 时间：2009-03-08T21:12:39.427
> 
> 标签：sharepoint, moss

我正在开发发布站点，它将具有复杂的树结构。
有没有办法使用 SharePoint 解决方案部署网站结构（多个子网站 - SPWeb）？
我知道我可以以编程方式创建站点树。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T22:32:19.377

我一直在从事一个具有相同需求的项目，但是我们没有找到功能框架的 OOTB 功能的答案。我们还必须通过对象模型并以编程方式进行创建。

但我们没有对站点结构进行硬编码，而是采用了不同的方法。我们的解决方案是实现一个将 xml 文件作为输入的通用 SiteCreation 功能。xml 定义站点结构，并由解析它并创建指定站点的功能接收器读取。

我知道这个解决方案涉及一些编码，但我认为额外的工作是值得的，因为站点结构在投入生产之前可能会发生多次变化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T02:15:23.740

默认发布门户（和协作门户）站点定义使用门户供应类来构建基于 xml 文件的站点结构（这对于 MOSS 安装来说是开箱即用的）。

您可以查看如何在门户网站定义的 webtemp 文件 (12\TEMPLATE\1033\XML\webtempsps.xml) 中引用供应类。可以在 12\TEMPLATES\SiteTemplates\WebManifest 中找到实际使用的 xml 文档的示例——这是一个相当简单的模式。

如果您正在创建基于发布门户的自定义站点定义，那么您可以重新使用供应类并提供您自己的 xml 文档来构建您的自定义站点结构。

# php - 通过 php 用 mysql 设置 utf8

> ID：624301
> 
> 赞同：1
> 
> 时间：2009-03-08T21:15:01.497
> 
> 标签：php, mysql, character-encoding

我有以下非常简单的代码，它检索 utf8 formatetd 数据，例如包含来自 mysql 数据库的变音符号，它可能设置为也可能不设置为 utf8。如果我使用任何一种注释掉的方法来确保返回 utf8 数据，则数据不会以 utf8 形式返回，但是如果我不使用它们，则会显示数据。为什么强制 utf8 会否定将数据显示为 utf8？

```
<?php
  $con = mysqli_connect("localhost", "x", "", "x");
  //$con->query("SET NAMES 'utf8'");
  //$con-set_charset('utf8');
  $recordsQuery = "SELECT ARTICLE_NAME FROM AUCTIONS1";

  if ($getRecords = $con->prepare($recordsQuery)) {
        $getRecords->execute();
        $getRecords->bind_result($ARTICLE_NAME);

        while ($getRecords->fetch()) {
        echo "<p>$ARTICLE_NAME";
             }
    } else {
        print_r($con->error);
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T21:40:02.980

也许错误在于您为页面提供服务的字符集。如果您从数据库中获取 UTF-8 内容并使用 Windows-1252 的默认 HTML 字符集提供它，那么它看起来会出现乱码。确保你有这个等价物：

```
header( 'Content-Type: text/html; charset=utf-8' ); 
```

在您的 PHP 代码中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T22:13:03.823

1.  确保您的数据已经在数据库中进行了 UTF-8 编码
2.  配置数据库以提供 UTF-8（例如 SET NAMES 'utf8'）
3.  在您的网站上使用正确的编码（点头）

如果仍有问题，请提供更多数据，尤其是*预期*和最终*交付的数据*

# google-app-engine - 是否有本地 Google App Engine 数据查看器？

> ID：624304
> 
> 赞同：21
> 
> 时间：2009-03-08T21:16:32.430
> 
> 标签：google-app-engine

我想离线使用谷歌的在线 GAE 数据查看器......是否有一些 python 代码来显示我所有的本地数据甚至模式？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-08T21:33:40.390

是的，转到[http://localhost:8000/_ah/admin](http://localhost:8000/_ah/admin)（假设您正在使用 dev_appserver.py 运行本地实例）。

*注意*：当应用程序在本地部署时，它会记录管理页面绑定到哪个端口

# windows - 等待指定数量的对象？

> ID：624306
> 
> 赞同：0
> 
> 时间：2009-03-08T21:18:16.467
> 
> 标签：windows, winapi, visual-c++, wait

*   使用[WaitForMultipleObjects](http://msdn.microsoft.com/en-us/library/ms687025(VS.85).aspx)：
    *   可以等待**一个**或**所有****指定对象**更改为**单个**状态

**问题：**

*   一个人怎么能等待一个**特定**的数量-例如`5`，例如

**用法**

```
dwEvent = WaitForMultipleObjects(
                maxExpectedConnections,
                ghEventsA,
                TRUE,//but wait for a specified number instead
                INFINITE); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T21:25:32.813

使用 waitall 标志来指示您希望在任何对象发出信号时返回等待。当等待返回时，从对象数组中删除信号对象并再次等待，直到您有 N 个（例如，在您的情况下为 5 个）信号对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T21:25:05.497

您可以每次只等待一个对象多次，直到您收集到所需数量的“就绪”对象。

# php - 如何测试 MySQL 查询是否成功修改数据库表数据？

> ID：624307
> 
> 赞同：2
> 
> 时间：2009-03-08T21:18:28.180
> 
> 标签：php, mysql, mysqli, rows-affected

我有以下简单的 php 代码片段，它会在调用时从数据库中删除相关文章。结果被传递给一个 javascript 函数，该函数将通过 AJAX 更新页面。`false`如果查询失败，我想返回字符串，如下所示。

```
if($cmd=="deleterec"){
    $deleteQuery = "DELETE FROM AUCTIONS1 WHERE ARTICLE_NO = ?";
    if ($delRecord = $con->prepare($deleteQuery)) {
        $delRecord->bind_param("s", $pk);
        $delRecord->execute();
        $delRecord->close();
        echo "true";
    } else {
        echo "false";
    }
} 
```

我想知道我错过了什么以及检查查询是否成功的正确方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T21:20:29.410

您需要使用[mysqli->affected_rows()](http://uk3.php.net/mysqli_affected_rows)来检查查询是否成功（或者您可以使用[mysqli_stmt->execute()](http://uk3.php.net/manual/en/mysqli-stmt.execute.php)的结果值）。

以您的示例为例，只针对上述内容进行任何修改：

```
if($cmd=="deleterec") {
    $deleteQuery = "DELETE FROM AUCTIONS1 WHERE ARTICLE_NO = ?";

    if ($delRecord = $con->prepare($deleteQuery)) {
        $delRecord->bind_param("s", $pk);
        $delRecord->execute();

        if ($delRecord->affected_rows > 0) {
            echo "true";
        } else {
            echo "false";
        }

        $delRecord->close();
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T21:24:03.050

您目前只检查 SQL 语句是否正确准备，而不是检查它是否实际删除了记录。

尝试：

```
...
echo ($delRecord->affected_rows > 0) ? 'true' : 'false';
$delRecord->close(); 
```

这并不能解决您是否正确检查了 Javascript 代码中的结果字符串 - 如果这是一个问题，我们将需要更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T21:24:21.710

使用 的返回值[`mysqli_stmt->execute()`](http://docs.php.net/manual/en/mysqli-stmt.execute.php)来查看查询是否执行成功。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-08T23:12:19.827

```
if($cmd=="deleterec"){
    $deleteQuery = "DELETE FROM AUCTIONS1 WHERE ARTICLE_NO = ?";
    $delRecord = $con->prepare($deleteQuery);
    if ( $delRecord === false ) {
        echo "false";
    }

    $delRecord->bind_param("s", $pk);
    if ( $delRecord->execute() ) {
        echo "true";
    } else {
        echo "false";
    }
    $delRecord->close();
} 
```

`prepare()`可以省略检查，因为查询已修复并且应该可以正常工作（除非服务器端出现错误）。`execute()`如果查询执行成功，则返回 true。使用`affected_rows()`可能会产生误导，因为可能没有要删除的项目，因此应该`affected_rows()`返回`0`。尽管如此，查询已成功执行。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2021-05-04T06:11:49.697

```
function run_query($query,$conn,$dbname){
   $conn->select_db($dbname);
   if($result = $conn->query($query)){
     return $result; 
   }
   else{
     echo 'error ';
     exit();
   } 
```

}

run_query() 接受三个参数，查询、连接和数据库。如果查询不成功将通过错误，否则将返回结果对象。

# c# - 温莎城堡找不到我的服务类型

> ID：624310
> 
> 赞同：1
> 
> 时间：2009-03-08T21:20:20.970
> 
> 标签：c#, inversion-of-control, castle-windsor

试图利用 Castle Windsor IoC。我有一个非常简单的应用程序。我的接口存在于 Test.Services 命名空间中。编译时出现以下异常：

“找不到类型名称 Test.Services.IParse，Test.Services”

这是我的 app.config：

```
<configuration>
  <configSections>
    <section name="castle"
      type="Castle.Windsor.Configuration.AppDomain.CastleSectionHandler,    
      Castle.Windsor" />

   </configSections>

  <castle>
    <components>
      <component id="HtmlTitleRetriever"
                 type="Test.HTMLTitleRetriever, Test">
      </component>
      <component id="FileParser"
                 service="Test.Services.IParse, Test.Services"
                 type="Test.FileParser,   
                      Test">
      </component>
      <component id="FileDownloader"
                 service="Test.Services.IDownload, Test.Services"
                 type="Test.FileDownloader, Test">
      </component>
    </components>
  </castle> 
```

有人可以告诉我我错过了什么吗？

谢谢

-缺口

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T14:11:10.057

愚蠢的问题，但是您确定包含您注册的类的程序集实际上已复制到输出目录吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T00:04:19.677

Test.Services 程序集 (Test.Services.dll) 中是否有 IParse 接口？

用于在配置中定义类型名称的格式与您可以从类型的[AssemblyQualifiedName](http://msdn.microsoft.com/en-us/library/system.type.assemblyqualifiedname.aspx#)属性中获得的格式相同。简而言之，就是：

命名空间.类型，程序集。

对于泛型类型，请参阅[this](http://ayende.com/Blog/2006/05/15/TheNatureOfGenericTypeNames.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T21:49:02.553

```
IWindsorContainer container = new WindsorContainer();

        container.AddComponent("FileDownlader", typeof(IDownload),
             typeof(FileDownloader));
        container.AddComponent("FileParser", typeof(IParse),
             typeof(FileParser));
        container.AddComponent("HTMLTitleRetriever", typeof(HTMLTitleRetriever));

        HTMLTitleRetriever retriever = container.Resolve<HTMLTitleRetriever>(); 
```

在代码中执行以下操作。我想使用一个配置文件，所以不需要每次都重新编译更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T21:58:41.937

几乎是尼克！您需要将 xml 配置传递给 WindsorContainer 的构造函数：

```
IWindsorContainer container;
container =
  new WindsorContainer(
    new XmlInterpreter(
      new ConfigResource("castle")
  )); 
```

当我第一次开始玩 Castle Windsor 时，我也遇到了这个“Got ya”。它不知道查看配置部分。

提示：去他们的后备箱获取最新信息。有一个名为 Register 的新方法对于在同一个接口上批量注册多个类非常有用。即，如果您正在使用 ASP.NET MVC 进行开发，并且您有一堆 IController，您可以使用 Castle Windsor 为您自动注册它们。因此，您不必在配置文件中指定它们！

```
public class WindsorControllerFactory : IControllerFactor
{
  IWindsorContainer container;
  public WindsorControllerFactory()
  {
    container =
      new WindsorContainer(
        new XmlInterpreter(
          new ConfigResource("castleWindsor")
      ));

    container.Register(
      AllTypes.Of<IController>()
      .FromAssembly(Assembly.GetExecutingAssembly())
      .Configure(component => component.LifeStyle.Transient
        .Named(component.Implementation.Name)
      ));
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-29T14:29:12.677

我遇到了同样的问题，Eric 的解决方案可以解决这个问题。我创建了一个“域模型”项目，然后将其重命名为“域模型”，尽管我更改了所有引用，但随后查看 bin 文件夹，该程序集仍被称为“域模型”，这就是温莎城堡找不到它的原因。

# flash - 使用 actionscript 3.0 调整窗口大小

> ID：624317
> 
> 赞同：6
> 
> 时间：2009-03-08T21:23:34.893
> 
> 标签：flash, actionscript, resize, window, cs3

有没有办法使用 Actionscript 或其他方法来调整整个 Flash 项目的大小？

我创建了一个 1024x768 Flash CS3 应用程序，但在仔细检查规格后，我现在意识到它必须是 800x600。我不想手动缩小所有内容，而是想调整窗口的大小，就好像有人在拖动外边缘一样。或者添加一个允许在 1024x768 和 800x600 之间切换的按钮。这可能吗？

我的意思是这样的：

```
stage.stageWidth = 800;
stage.stageHeight = 600; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T21:47:47.720

是的 stageWidth 和 stageHeight 是只读的，尽管有文档。但如果 SWF 嵌入在网页中，那么更改其元素宽度和高度将改变舞台大小，而 scaleMode 将决定如何处理。[我Enjoy3D 网站上](http://enjoy3d.com/)的所有SWF 都会在调整窗口大小时执行此操作...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T17:00:37.753

如果您愿意，您可以只编辑 SWF 的 HTML 包装器并判断新尺寸是否，尽管我担心光栅化的媒体即使在缩小时也会被像素化。最好缩小所有内容，即使您不想这样做。

如果您真的需要在 Flash 中执行此操作，请使用 flash.external 包的 ExternalInterface 类来调用 HTML 中的 JavaScript 函数。确保您的 swf 在 div 内并设置为 div 的高度和宽度的 100%。现在您只需通过 JavaScript 通过 Actionscript 更改 div 的大小。

确保你有 stage.scaleMode 设置你想要的方式。

干杯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T21:34:23.820

您无法从 Actionscript 更改舞台宽度和高度，这些属性是只读的。

难道你不能在编译你的 swf 之前将舞台属性的大小（我假设你在这里使用 Flash）设置为 800 x 600 吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-06T06:33:42.453

1.  您可以在 xxx-app.xml 文件中设置宽度和高度属性
2.  如果要动态执行此操作，可以使用 FlexGlobals.topLevelApplication.width 和 height 属性或已弃用的 Application.application.width 和 height 属性
3.  或者，如果您有一个纯 ActionScript 项目，因此您不能执行 FlexGlobals 或 Application，您可以从您的主动作脚本文件 (Sprite) 执行以下操作（注意，在执行此操作之前必须初始化阶段）

    ```
    width = WIDTH;
    height = HEIGHT;
    stage.stageWidth = WIDTH;
    stage.stageHeight = HEIGHT;
    stage.nativeWindow.width = WIDTH;
    stage.nativeWindow.height = HEIGHT; 
    ```

# opengl - OpenGL顶点布局

> ID：624320
> 
> 赞同：1
> 
> 时间：2009-03-08T21:24:06.250
> 
> 标签：opengl, vertex-buffer

问题是这样的：如果我有一个仅使用位置（3 个浮点数）定义的顶点结构，总大小为 12 个字节，那么事情就完美了。但是，如果我尝试对位置组件使用无符号字节或短字节（每个顶点 3 或 6 个字节），它会在 glDrawArrays 处因访问冲突而崩溃。知道为什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T21:33:53.073

看起来我不得不使用无符号类型。

# objective-c - Cocoa/Objective-C NSProcessInfo 怪异

> ID：624325
> 
> 赞同：11
> 
> 时间：2009-03-08T21:27:38.707
> 
> 标签：objective-c, cocoa

所以我刚刚开始深入研究 Objective-C、Cocoa 和 iPhone 开发。我遇到了一个我不太明白的奇怪的事情。

我正在尝试获取进程信息，进程名称工作正常，但是当我尝试获取进程 ID 时事情变得很奇怪。

这是我拥有的一段代码，它显然没有向控制台输出任何内容：

```
NSProcessInfo *processInfo = [NSProcessInfo processInfo];
NSString *processName = [processInfo processName];
int processID = [processInfo processIdentifier];
NSLog(@"Process Name: '%@' Process ID:'%@'", processName, processID); 
```

在这段代码之后，所有其他 NSLog 调用也将被忽略。并且该过程继续运行，说明有关 GDB 的一些信息，我在控制台中得到了这个：

> `Loading program into debugger… GNU gdb 6.3.50-20050815 (Apple version gdb-962) (Sat Jul 26 08:14:40 UTC 2008) Copyright 2004 Free Software Foundation, Inc. GDB is free software, covered by the GNU General Public License, and you are welcome to change it and/or distribute copies of it under certain conditions. Type "show copying" to see the conditions. There is absolutely no warranty for GDB. Type "show warranty" for details. This GDB was configured as "i386-apple-darwin".Program loaded. sharedlibrary apply-load-rules all Attaching to program: '/Users/jim/Documents/Xcode Projects/CS 193P/Assignment1B (WhatATool)/WhatATool/build/Debug/WhatATool', process 28700. (gdb)`

我在这里可能有点白痴，但是，嘿，我以前从来没有弄乱过Objective-C……哈哈_ _*无辜地吹口哨*_ _

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-08T21:35:41.680

线

```
NSLog(@"Process Name: '%@' Process ID:'%@'", processName, processID); 
```

应该

```
NSLog(@"Process Name: '%@' Process ID:'%d'", processName, processID);
/*                          change here ^                          */ 
```

因为`processID`只是一个`int`没有 Objective-C 对象

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T21:48:26.243

也许这样的事情不使用 NSLOG 而只使用 printf：您可能需要清理输出，但它应该可以编译和工作。不确定这是否应该这样做，但似乎从我的测试中可以工作。

```
void PrintProcessInfo() 
{
    int pid = [[NSProcessInfo processInfo] processIdentifier];
    printf("ProcessInfo is : %d \n", pid);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T02:59:29.473

“int”不是Objective-C，所以删除“int”后的*应该没问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T01:50:58.050

"do %i" 表示整数。

# xml - 如何在 Visual C++ 应用程序中读取 XML 文件？

> ID：624329
> 
> 赞同：2
> 
> 时间：2009-03-08T21:30:21.133
> 
> 标签：xml, visual-c++, com, atl

如何在 Visual C++ 应用程序中读取 XML 文件？

我需要在 Visual Studio 2003 C++ COM ATL 应用程序中读取 XML 文件 - 非托管代码。我应该使用什么库：msxml、xmllite、其他？

我需要检查xml是否满足我定义的xsd然后阅读它。

欢迎使用示例代码；）

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T21:52:32.717

我使用[了 tinyXML](http://www.grinninglizard.com/tinyxmldocs/index.html)。它非常受限制（没有 DTD，没有 XSL），但是它将 XML 文件加载到 doms 中，非常小而且速度很快。如果您只想**读取**xml 文件以从中提取信息：这就是要走的路。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T21:43:23.037

有很多选择，我们使用[Xerces-C++](http://xerces.apache.org/xerces-c/)库，它涵盖了所有选项，但不是最轻量级的选择，但提供了很大的灵活性。

对于初学者，您需要决定是需要 DOM 样式解析器还是 SAX 样式（事件驱动程序）解析器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T22:31:41.220

我是[CMarkup](http://www.firstobject.com/dn_markup.htm)的忠实粉丝。它有 MFC 和 STL 字符串版本，并且是用非托管 C++ 编写的；非常适合我的所有情况。

MSXML 还有一个包装类。有一个可供试验的可下载版本和几个在线可用的示例/教程。

# asp.net - 在 UpdatePanel 之外更新控件

> ID：624332
> 
> 赞同：0
> 
> 时间：2009-03-08T21:31:47.667
> 
> 标签：asp.net, ajax

我有以下 ASPX 结构：

```
<UpdatePanel id="OutsidePanel" UpdateMode="Conditional">
  <div runat="server" id="myDiv">
    <UpdatePanel id="InsidePanel" UpdateMode="Conditional">    

     <asp:ImageButton that causes a postback.. />
   </UpdatePanel>
  </div>
</UpdatePanel> 
```

单击 imageButton 时，在服务器端，我更改了 myDiv 的类。它没有得到更新。我认为这是因为 div 在 Inside UpdatePanel 之外。我将如何强制它更新？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-08T21:46:01.360

如果您正在更新类服务器端，那么答案是肯定的。内部更新面板正在重新渲染并传递回客户端，但外部更新面板没有被替换。当 AJAX 回调返回时，不会替换正在更新的实际面板之外的任何内容。您可能需要考虑添加一些在返回结果时更新 div 的 javascript，作为更改类的简单解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T22:29:10.040

当“InsidePanel”导致回发时，您不能只在服务器上调用`Update`“OutsidePanel” [UpdatePanel的方法吗？](http://msdn.microsoft.com/en-gb/library/system.web.ui.updatepanel.aspx)`Imagebutton`或者，将`ImageButton`点击事件设置为“OutsidePanel”的触发器

根据[MSDN](http://msdn.microsoft.com/en-gb/library/system.web.ui.updatepanel.aspx)

> 如果 UpdateMode 属性设置为 Conditional，则 UpdatePanel 控件的内容会在以下情况下更新：
> 
> *   当您显式调用 UpdatePanel 控件的 Update 方法时。
>     
>     
> *   当 UpdatePanel 控件嵌套在另一个 UpdatePanel 控件中并且父面板被更新时。
>     
>     
> *   当回发由使用 UpdatePanel 控件的 Triggers 属性定义为触发器的控件引起时。在这种情况下，控件显式触发面板内容的更新。该控件可以位于与触发器关联的 UpdatePanel 控件内部或外部。
>     
>     
> *   当 ChildrenAsTriggers 属性设置为 true 并且 UpdatePanel 控件的子控件导致回发时。嵌套 UpdatePanel 控件的子控件不会导致对外部 UpdatePanel 控件的更新，除非它们被明确定义为触发器。

# sql - SQL 查询以查找表中 min_numbers 和 max_number 之间的漏洞

> ID：624333
> 
> 赞同：3
> 
> 时间：2009-03-08T21:32:02.017
> 
> 标签：sql, mysql

SQL 专家的快速问题。

我有一个表，其中包含两列 - min_number 和 max_number 我一直在尝试编写一个查询，该查询在最小和最大数字之间找到第一个*n大小的孔，但没有成功*

例子

```
 min    max
1\.   100    200
2\.   250    300
3\.   330    400 
```

如果我想找到一个大小为 50 的孔，将返回第 1 行的最大 200（在它和第 2 行的最小值之间有一个 50 的孔），一个 20 的孔将返回第 2 行的最大 300 等。如果没有合适的存在大小的孔，最后一个最大值 (400) 将被返回。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T04:58:07.733

```
SELECT
     MIN(T1.max_value)
FROM
     My_Table T1
LEFT OUTER JOIN My_Table T2 ON
     T2.min_value BETWEEN (T1.max_value + 1) AND (T1.max_value + @range)
WHERE
     T2.id IS NULL 
```

我猜想，由于您正在寻找要分配的 ID，因此您想要一个完全不包括 max_value 和 min_value 的值范围。

您还可以使用 NOT EXISTS 子句执行上述查询。两者都试一试，看看哪个更适合你。

要考虑的另一件事是，您真的需要重用 ID 吗？您的 ID 值会变得如此之高，而您的可用范围如此之低，以至于您需要这样做吗？我不知道你的系统的细节，但看起来你可能会花费很多精力，然后使用大量额外的处理来解决一个实际上并不存在的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T22:50:27.680

*编辑：最终答案在底部。*

为什么很多 SQL 题都忘记表名了？

```
-- Buggy: should reference (lo.max + 1)
SELECT lo.max + 1 AS min_range
    FROM example lo, example hi
    WHERE hi.min - (lo.max - 1) >= 40   -- Example won't work with 50
      AND NOT EXISTS (SELECT * FROM example AS mid
                         WHERE mid.min > lo.max
                           AND mid.max < hi.min
                     ) 
```

NOT EXISTS 子句至关重要——它确保您只考虑相邻的范围。

这涉及“存在足够大的差距”的情况。

名义上，您可以使用 UNION 子句处理“没有足够大的差距”：

```
...
UNION
SELECT MAX(max)+1
    FROM example
    WHERE NOT EXISTS(
        SELECT lo.max + 1 AS min_range
            FROM example lo, example hi
            WHERE hi.min - (lo.max - 1) >= 40   -- Example won't work with 50
              AND NOT EXISTS (SELECT * FROM example AS mid
                                 WHERE mid.min > lo.max
                                   AND mid.max < hi.min
                             )
            ) 
```

内部 SELECT 是第一个缩进的直接转录。

* * *

上面的 SQL 未经测试。第一部分有效（尤其是在测试数据上） - 但可以产生多个答案。所以，它需要修改为（修复，我认为，一个二分之一的错误）：

```
SELECT MIN(lo.max + 1) AS min_range
    FROM example lo, example hi
    WHERE hi.min - (lo.max + 1) >= 40   -- Example won't work with 50
      AND NOT EXISTS (SELECT * FROM example AS mid
                         WHERE mid.min > lo.max
                           AND mid.max < hi.min
                     ) 
```

UNION 条款让我有些悲伤……没有产生我期望的答案。

在语法上，我不得不将其修改为：

```
SELECT MIN(lo.max + 1) AS min_range
    FROM example lo, example hi
    WHERE hi.min - (lo.max + 1) >= 40   -- Example won't work with 50
      AND NOT EXISTS (SELECT * FROM example AS mid
                         WHERE mid.min > lo.max
                           AND mid.max < hi.min
                     )
UNION
SELECT MAX(solo.max)+1
    FROM example AS solo
    WHERE NOT EXISTS(
        SELECT MIN(lo.max + 1) AS min_range
            FROM example lo, example hi
            WHERE hi.min - (lo.max - 1) >= 40   -- Example won't work with 50
              AND NOT EXISTS (SELECT * FROM example AS mid
                                 WHERE mid.min > lo.max
                                   AND mid.max < hi.min
                             )
            ) 
```

这避免了将关键字 MAX 用作列名的问题（我可能会写`example.max`而不是`solo.max`. 但它并没有产生我期望的答案。

* * *

UNION 等同于 OR，当然在这种情况下，这个查询似乎产生了我想要的答案：

```
SELECT MIN(lo.max + 1) AS min_range
    FROM example lo, example hi
    WHERE (hi.min - (lo.max + 1) >= 40
           AND NOT EXISTS (SELECT * FROM example AS mid
                              WHERE mid.min > lo.max
                                AND mid.max < hi.min
                          )
          )
       OR lo.max = (SELECT MAX(solo.max) FROM Example AS Solo)
; 
```

OR 子句引用`lo.max`而不是引用是至关​​重要的`hi.max`；否则，你会得到错误的答案。

* * *

OK - UNION 版本注定失败，因为 SQL 错误定义了 MIN 的行为。具体来说，如果没有匹配的行，则 MIN 返回值为 NULL 的单行，而不是不返回任何行。这意味着 UNION 的第一个子句在没有找到行时返回 NULL；第二个子句可以通过在 NOT EXISTS 中从 SELECT 中省略 MIN 来“修复”，但是您仍然会从语句中得到两行（NULL 和正确的值），这是不可接受的。因此，OR 版本是要使用的版本——SQL 再次使用 NULL 值。

可以通过在 FROM 子句的表表达式中构建 UNION 来严格避免空值。这最终会稍微简单一些：

```
SELECT MIN(min_range)
    FROM (SELECT (lo.max + 1) AS min_range
              FROM example lo, example hi
              WHERE hi.min - (lo.max + 1) >= 49
                AND NOT EXISTS (SELECT * FROM example AS mid
                                   WHERE mid.min > lo.max
                                     AND mid.max < hi.min
                               )
          UNION
          SELECT MAX(solo.max + 1) AS min_range
              FROM example AS solo
         ); 
```

UNION 的前半部分可以返回任意数量的槽，包括零；第二个总是返回一个值（只要表中有任何行）。然后外部查询选择这些值中的最小值。

当然，这个版本可以用来分配行：

```
INSERT INTO Example(min, max)
    SELECT MIN(min_range) AS min, MIN(min_range) + (50 - 1) AS max
        FROM (SELECT (lo.max + 1) AS min_range
                  FROM example lo, example hi
                  WHERE hi.min - (lo.max + 1) >= 50
                    AND NOT EXISTS (SELECT * FROM example mid
                                       WHERE mid.min > lo.max
                                         AND mid.max < hi.min
                                   )
              UNION
              SELECT MAX(solo.max + 1) AS min_range
                  FROM example AS solo
             ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-07T16:20:23.597

```
select min(n+1) from myTable where n+1 NOT IN  (select n from myTable) 
```

*   R多尔蒂

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T21:38:08.477

就个人而言，我不会尝试在 SQL 中执行此操作 - AIUI 很难在最坏的情况下在 O(n^2) 中有效地扫描表的情况下跨不同行执行分析。不过，使用存储过程可能会更容易。

如果可以的话，我的解决方案是更改数据库架构和代码，以便每次插入新行时，都会使用该行的最大值和新行的最小值之间的差异来更新前一行，将该差异值存储在其自己的列中。

搜索具有足够大间隙的第一行然后变得相对微不足道。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T21:44:35.543

有 MySQL[模型子句](http://www.oracle.com/technology/oramag/oracle/04-jan/o14tech_sql.html)吗？如果是，您可以使用它进行查询。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T01:15:41.887

“一个 20 的孔将返回第 2 行，最多 300 等”我没有遵循你的逻辑 - 第 2 行的最大值（300）和第 3 行的最小值（330）之间的差距是 30（如果你包括最小值或最大值，如果不是，则为 29）。这是否意味着您正在寻找“大于或等于”指定值的第一个间隙，或者该间隙是否需要完全匹配？如果它“大于或等于”，那么返回的第一个匹配肯定是第 1 行，它与第 2 行之间的差距 > 20？

无论如何，如果您的表具有某种类型的行 ID，如示例所示，那么您可以尝试这样的操作（假设表 MyTable 中的列 RowID、MinVal 和 MaxVal 填充了示例中的数据）：

```
SELECT TOP 1
        a.RowID,
        a.MinVal,
        a.MaxVal, -- this is the value you want to return
        ISNULL(b.MinVal, 9999) AS MinVal_NextRow,
        ISNULL(b.MinVal, 9999) - a.MaxVal AS Diff
FROM    MyTable a
        LEFT JOIN MyTable b ON a.RowID = ( b.RowID - 1 )
WHERE   ( ISNULL(b.MinVal, 9999) - a.MaxVal ) = 20 
```

此示例选择间隙正好为 20 的第一行。如果您正在寻找至少 20 的第一个间隙，则可以将 WHERE 子句更改为：

```
WHERE   ( ISNULL(b.MinVal, 9999) - a.MaxVal ) >= 20 
```

当行是最后一个可用时，查询会替换一个任意大的数字 (9999) - 如果没有合适大小的间隙，这将返回最后一个（最大）MaxVal。您需要将此数字调整为对您的数据有意义的值（即大于数据中任何可能的值）。

# java - 在 Java 中将图像添加到数据库

> ID：624337
> 
> 赞同：5
> 
> 时间：2009-03-08T21:34:01.793
> 
> 标签：java, mysql, jdbc

我正在尝试将图像添加到 mysql 数据库中的 BLOB 字段。图像的大小将小于 100kb。但是我遇到了问题，想知道将这些数据添加到数据库的更好方法是什么？

com.mysql.jdbc.MysqlDataTruncation：数据截断：第 1 行的“数据”列的数据太长

```
PreparedStatement addImage = conn.prepareStatement("INSERT INTO Images (Width, Height, Data) VALUES (?,?,?)",Statement.RETURN_GENERATED_KEYS); 
```

下面是我用来将图像添加到数据库中的方法。

```
public int addImage(Image image) throws SQLException, IllegalArgumentException
{
    this.addImage.clearParameters();
    byte[] imageData = ImageConverter.convertToBytes(image);
    int width = image.getWidth(null);
    int height = image.getHeight(null);
    if (width == -1 || height == -1)
    {
        throw new IllegalArgumentException("You must load the image first.");
    }

    this.addImage.setInt(1, width);
    this.addImage.setInt(2, height);
    this.addImage.setBytes(3, imageData);
    this.addImage.executeUpdate();

    ResultSet rs = this.addImage.getGeneratedKeys();
    rs.next();

    return rs.getInt(1);
} 
```

[表的 SQL 定义](http://pastebin.com/m3cd428c2)

在将数据字段类型更改为 Mediumblob 并尝试将 140kb 图像文件放入数据库后，我收到了另一个错误。

com.mysql.jdbc.PacketTooBigException：查询数据包太大

问题是我尝试将数据添加到数据库的方式。我应该采取不同的方法吗？如果是这样，那是什么方式？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-08T21:54:07.613

尝试使用 a`MEDIUMBLOB`而不是 a `BLOB`。 `BLOB`限制为 64KB，而一`MEDIUMBLOB`列可以容纳 16MB。

[请参阅本页](http://dev.mysql.com/doc/refman/5.0/en/storage-requirements.html)的“字符串类型的存储要求”部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T23:39:09.123

要处理[PacketTooBigException](http://www.docjar.com/docs/api/com/mysql/jdbc/PacketTooBigException.html)，您似乎需要调整配置变量 max_allowed_pa​​cket。请参阅[http://dev.mysql.com/doc/refman/5.1/en/packet-too-large.html](http://dev.mysql.com/doc/refman/5.1/en/packet-too-large.html)。但是，默认情况下 MySQL 5.1 应该不会给您带来高达 1MB 的问题。您使用的是什么版本的 MySQL（服务器和客户端）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T21:51:29.833

尝试 setBlob 而不是 setBytes

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-03T23:10:15.723

只需在项目开始时执行以下查询...

```
SET GLOBAL max_allowed_packet = 1024*1024*number of MB 
```

IE

```
SET GLOBAL max_allowed_packet = 1024*1024*14 
```

***也读[这个](https://stackoverflow.com/questions/11320236/com-mysql-jdbc-packettoobigexception)***。

# vb.net - VB中的Sharepoint表单布局

> ID：624340
> 
> 赞同：2
> 
> 时间：2009-03-08T21:35:26.440
> 
> 标签：vb.net, sharepoint

好的，我有 PHP 背景，但我刚刚负责在 SharePoint 中开发一些自定义 Web 部件。我已经弄清楚如何在 VB 中创建和部署一个基本的“Hello world”Web 部件。到目前为止还好。

我坚持的是一个非常基本的、愚蠢的观点——我到底如何在 VB Web 部件中布置东西？

例如，这是一个标签和一个文本框：

```
protected overrides sub createchildcontrols()
mybase.createchildcontrols

dim mylabel as new label
dim mytextbox as new textbox

mylabel.text ="My label text"
mytextbox.text ="My textbox"

me.controls.add(mylabel)
me.controls.add(mytextbox) 
```

例如，我将如何让 mylabel 和我的文本框出现在不同的行上，而不是像现在这样一个接一个地运行？在 PHP 中，我只是将它们包装在一些顶部，将它们分成不同的行，但是我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T22:08:37.763

有很多方法可以解决这个问题。最简单的方法是，如果您真的只是希望控件出现在不同的行上，那就是在它们之间添加一个带有 BR 标记的 ASP.net [LiteralControl 。](http://msdn.microsoft.com/en-us/library/system.web.ui.literalcontrol.aspx)

除此之外，您始终可以使用 ASP.net 格式化控件，例如[Table](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.table.aspx)将您的控件分成多个部分以进行输出。

此外，从 WebControl 派生的所有内容都有一个 Attribues 和 CssClass 属性，用于根据您可以使用的样式表设置格式。

最后一种方法，也是最可定制但最难维护和更改的方法是覆盖 WebPart 的 Render 方法并在 WebPart 中完全手动生成 HTML。

或者，您可以完全放弃它，并使用[SmartPart](http://www.codeplex.com/smartpart)开发 ASP.net 用户控件以在 SharePoint 内部使用，从而为您提供使用 Visual Studio 设计器工具在表单上布局控件的选项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T22:12:53.980

您应该重写 Render() 方法。默认情况下，此方法仅呈现您在 CreateChildControls() 方法中添加的所有子控件，但覆盖它可以让您在控件周围编写额外的 HTML 元素。

我通常用 C# 编写代码，但我认为下面的示例应该在 VB 中工作：

```
Protected Overrides Sub Render(ByVal writer As System.Web.UI.HtmlTextWriter)
  writer.Write("<h1>Custom webpart rendering</h1>")
  me.mylabel.RenderControl(writer)
  writer.Write("<br />")
  me.myTextbox.RenderControl(writer)
End Sub 
```

试试看...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T23:29:35.840

我一直在使用标准 Web 用户控件模型为 ASP.NET 站点开发 Web 部件，这使您可以访问 VS 设计器并意味着您的 UI 可以是标准 HTML。然后，ASP.NET 在运行时将 UserControl 包装到 GenericWebPart 中，以将其托管在 WebParts 站点中。

我知道 Sharepoint 不支持这种开箱即用的模型，但我刚刚发现这可能会对您有所帮助......

[http://weblogs.asp.net/jan/archive/2006/12/02/announcing-the-return-of-the-smartpart.aspx](http://weblogs.asp.net/jan/archive/2006/12/02/announcing-the-return-of-the-smartpart.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T01:29:21.480

Smart Part（或其变体）是最简单的方法。当您可以更轻松地开发用户控件时，为什么还要直接渲染 html？

另外，如果您不是 VB 专家，拥有 Visual Studio Designer 将有助于创建用户控件

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T03:27:44.173

我写了关于这个话题的博客。 [无需使用 SmartPart 即可轻松为 Web 部件构建丰富的 UI](http://test.turimsaint.com/turimBlog/Lists/Posts/Post.aspx?ID=4)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T12:03:51.923

感谢所有的回复。我选择了 EvilGoatBobs 解决方案，因为它是最容易实现的。

这是我第一次使用 StackOverflow，您的有用答案使它成为对该网站的一个非常好的介绍！:)

# vim - vim pastebin 工作流程

> ID：624343
> 
> 赞同：2
> 
> 时间：2009-03-08T21:36:32.600
> 
> 标签：vim, workflow, copy-paste

您好，我最近开始使用 vim 编辑器（实际上是 netbeans 的插件），但我在使用 pastebin 时遇到了问题。

会发生什么我会 yunk 一些东西，然后用 dd 做一些删除，所以我失去了我最初的 yunk 内容。因此，对于我作为 vim 的初学者来说，delete 实际上确实会减少，这非常令人困惑。

大家平时是怎么处理的。我猜你必须在 yunk 之后立即粘贴它，但想知道你是否有其他技巧。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-08T21:40:49.953

您可以使用命名寄存器来 yunk

```
"ayw
"byy
"cy$
etc. 
```

其中“a”、“b”、“c”是寄存器的名称。
粘贴使用

```
"ap 
"bP
"cp 
```

默认寄存器是'"'，系统寄存器是'+'和'*'

您可以使用未命名的寄存器（黑洞）来删除 - 这样您就不会覆盖默认寄存器（'"'）中的信息。

```
"_dd
"_dw
"_D 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T21:58:23.890

> 会发生什么我会 yunk 一些东西，然后用 dd 做一些删除，所以我失去了我最初的 yunk 内容。

不，你没有。您的 yunked 文本在 register 中`"0`。

`:help "0`了解更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T21:59:16.990

由于在文件中跳转非常容易和快速，我倾向于只 cat 然后直接粘贴。（对不起，无聊的答案）

# python - 如何自定义 pygments 的输出？

> ID：624345
> 
> 赞同：1
> 
> 时间：2009-03-08T21:37:16.980
> 
> 标签：python, html, css, pygments

如果我通过 pygments 运行 python 源文件，它会输出 html 代码，其元素类属于 pygments 正在使用的某些 CSS 文件。样式属性是否可以包含在输出的 html 中，这样我就不必提供 CSS 文件了？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T23:22:37.400

通过将**noclasses**属性设置为**True**，只会生成内联样式。这是一个可以很好地完成工作的片段：

```
 formatter = HtmlFormatter(style=MyStyle)
formatter.noclasses = True
print highlight(content,PythonLexer(),formatter) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T01:29:47.500

将 full=True 传递给 HtmlFormatter 构造函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-02T07:51:03.527

@Ignacio：恰恰相反：

```
from pygments import highlight
from pygments.lexers import PythonLexer
from pygments.formatters import HtmlFormatter

code = 'print "Hello World"'
print highlight(code, PythonLexer(), HtmlFormatter(noclasses=True)) 
```

[参考：[http://pygments.org/docs/formatters/](http://pygments.org/docs/formatters/)，见 HtmlFormatter]

（基本上和Tempus的回答一样，我只是觉得完整的代码片段可能会节省几秒钟））

PS。那些认为原始问题不合适的人可能会想象将突出显示的代码粘贴到由第三方服务托管的博客条目中的任务。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-08T22:43:01.863

通常，您的代码只是网页上众多内容之一。您经常希望代码看起来与其他内容不同。通常，您希望将代码的样式控制为整体页面样式的一部分。CSS 是您的首选，最好的选择。

但是，如果这看起来更好，您可以将样式嵌入 HTML 中。这是一个显示`<style>`标签中`<head>`标签的示例。

[http://www.w3schools.com/TAGS/tag_style.asp](http://www.w3schools.com/TAGS/tag_style.asp)

# c++ - 如何使用 Jam make 工具构建项目的不同版本？

> ID：624348
> 
> 赞同：3
> 
> 时间：2009-03-08T21:39:27.990
> 
> 标签：c++, makefile, jam

我有一个 C++ 项目，可以编译成不同的版本，包括发布、调试、共享库和可执行文件，每个版本都有不同的编译器标志。我正在尝试将 Jam 作为 Make 的替代品，因为它看起来像一个更简单的系统。

果酱有这个能力吗？主要问题是它总是将 .o 文件与源文件放在同一个文件夹中，因此在构建多个版本时会覆盖它们。

### 更新

我找到了一个似乎可行的解决方案。使用此文件，我可以构建库或可执行文件的调试和发布配置。

构建发布库的命令：

```
jam -s config=lib -s release=1 
```

如果您只键入`jam`，它会构建调试可执行文件。这是 Jamfile：

```
FILES = 
    main.cpp 
    ;

BASENAME = steve ;
OBJ = obj ;

if $(release) 
{
    OBJ = $(OBJ)r ;
} 
else 
{
    DEFINES += DEBUG ;
    OBJ = $(OBJ)d ;
}

if $(config) = lib 
{
    OBJ = $(OBJ)_lib ;
    OUTFILE = lib$(BASENAME).so ;
    DEFINES += SHARED_LIBRARY ;
    LINKFLAGS += 
        -shared -Wl,-soname,$(OUTFILE) -fvisibility=hidden -fPICS 
    ;
} 
else 
{
    OUTFILE = $(BASENAME) ;
}

LOCATE_TARGET = $(OBJ) ;
MkDir $(LOCATE_TARGET) ;
Main $(OUTFILE) : $(FILES) ; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T08:22:40.643

我对 Perforce 的 Jam 不熟悉，但是[bjam](http://www.boost.org/doc/tools/build/index.html)允许这样做——而且非常简单。 `bjam`不将中间文件放在与源相同的目录中；它根据您正在构建的项目类型创建调试/发布/静态/共享目录。

例如，如果你想构建一个库的发布和调试版本并且你想静态地构建它：

```
bjam debug release link=static 
```

`bjam`确实有一些怪癖，但我们发现它非常有效。目前我们使用（几乎）相同的构建脚本来构建我们的系统，使用 msvc（8.0 和 9.0）、x86 上的 gcc 4.3、ARM 上的 gcc 3.4 和 PowerPC 上的 gcc 4.3。非常好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T08:26:36.500

是的，它能够做到这一点。它被称为“变体”，boost.build 带有预定义的“调试”和“发布”。也可以添加您自己的“功能”，将它们定义为链接不兼容会将生成的目标文件放入不同的子目录中：

功能魔法：关闭打开：传播复合；

feature.compose on : USE_MAGIC ;

我发现易于维护共存变体是 boost.build 最强大的功能之一。此外，维护项目层次结构非常容易（例如，应用程序需要库）；这是在文件级别完成的，而不是通过递归到目录中，使并行构建非常有效。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-09T00:07:56.340

构建系统的流行很重要，因为这意味着您组织中的更多人（以及未来的员工）可能知道它并能够支持它。

我会说不要这样做。不要使用果酱。无论如何，除了boost之外还有人使用它吗？例如，我认为 Ant 是一个更受欢迎的系统，而且我发现它更容易学习。帮您的组织一个忙，不要碰果酱。

# c# - 文件系统树视图

> ID：624352
> 
> 赞同：1
> 
> 时间：2009-03-08T21:40:06.867
> 
> 标签：c#, filesystems, explorer

是否有控件允许我单击 FS 上的文件夹？就像右键单击文件并在资源管理器中点击浏览后的左侧选项卡一样？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T21:59:40.407

我认为没有控件可以为您执行此操作，但使用 TreeView 控件相对容易。看看[这个例子](http://www.java2s.com/Code/CSharp/GUI-Windows-Form/RecursivelyloadDirectoryinfointoTreeView.htm)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T21:44:23.860

如果您问是否有允许您执行此操作的 WinForms/WPF**控件**，那么答案是否定的。没有这样的内置控件可用于此目的。

但是，您可以使用 OpenFileDialog 打开一个模态对话框。

```
using (var diag = new OpenFileDialog()) {
  var result = diag.ShowDialog();
  var fileName = diag.FileName;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T01:37:46.563

我写了一个库，也许可以帮助你。您可以在以下网址找到它： http: [//gong-shell.sourceforge.net/](http://gong-shell.sourceforge.net/)

您正在寻找的控件是 ShellTreeView。

# c++ - 人们离开 C++ 需要什么？

> ID：624354
> 
> 赞同：20
> 
> 时间：2009-03-08T21:40:57.363
> 
> 标签：c++, programming-languages, language-design

即使是大多数喜欢 C++ 的人也承认，它有很多与其作为系统/性能编程语言的利基无关的缺陷。其中包括其过时的模块管理系统（头文件）、对前向声明的要求、使其语法无法确定的语法怪癖（例如用于模板声明的 <> 尖括号）、包含在文本级别而不是真实语言操作的宏用于解决宏所用事物的功能，重复功能，如数组和字符串（这些类型的 STL 和 C 版本），几乎没有语法糖，以及普遍缺乏现代功能，如线程、垃圾收集、委托/闭包，等（注意：是的，在内存非常有限或实时环境中，您可能有充分的理由不想要垃圾收集，

另一方面，C++ 是唯一一种可以让您高效编写代码并接近金属，而且至少提供一些高级抽象的*主流语言。*它成熟、标准化，拥有大量编译器实现和库以及大型遗留代码库。

对于那些使用 C++ 作为主要语言的人来说，是什么让你个人认为它的缺点是值得忍受的？怎样才能让你改变主意并决定使用一种新的语言，这种语言的缺陷更少？你使用 C++ 是因为你真的*喜欢*它，还是因为遗留问题而不情愿地使用它，或者因为它的利基市场没有其他成熟的主流语言存在？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-08T21:50:28.243

你的部分问题有一个错误的假设。你假设我们可以选择语言。在我从事的**所有**使用 C++ 的项目中，没有真正的选择。这些项目早在我加入公司之前就已经存在并且是用 C++ 编写的。它们背后有多年的历史和相应数量的代码。

我认为这是人们在说“C++ 将死”或“为什么人们仍然使用 C++？”时犯的最大错误。我绝对同意，除了系统级程序之外，您不会看到很多/任何以 C++ 开始的新项目。恕我直言，这没有多大意义。不一定是因为语言的固有缺陷，而是越来越难找到擅长编写 C++ 的人。

人们经常忘记考虑的是当今世界运行的数百万（数十亿？）行 C++。切换到另一种语言的成本**非常**高，不能一时兴起。花费时间和精力来重写这种规模的应用程序需要很大的理由。这就是 C++ 不会消亡的原因。至少很快。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-03-08T22:14:08.280

给我一种编程语言：

1.  是标准化的，不是由单一公司驱动的
2.  不绑定到一个平台（不仅在理论上）
3.  编译为本机代码
4.  给了我和 C++ 一样的效率
5.  提供了一个经过深思熟虑的标准库
6.  对各种重要平台至少有一个成熟的实现

...我可能会考虑切换 ;-)

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-03-08T21:51:53.763

我使用 C++（并且已经使用了将近 25 年），因为它是最好的系统编程语言。我想说我不认识你描述的任何所谓的“疣”——那些是特征！

对于非系统编程，我使用其他语言，例如 PHP、Delphi、bash 脚本、awk、perl 和 Smalltalk。一种尺寸并不适合所有人，除非您当然是某种语言偏执狂。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-03-08T22:39:37.940

> 其中包括其过时的模块管理系统（头文件）

我真的看不出 C++ 使用头文件的方式有任何问题。通过提供两种包含标头的方法，您可以在源代码级别指定符号应该来自您的应用程序还是来自系统安装的设施。所有现代 C++ 编译器都支持预编译头文件，因此没有性能损失。将标头与实现分开允许开发人员使用以其他语言编写的库。

> 使其语法无法确定的语法怪癖（例如用于模板声明的 <> 尖括号），几乎没有语法糖，

该语言非常庞大，可能难以完全遵循，但它仍然受到许多适用于任何地方的逻辑规则的指导。该语言实际上提供了许多方法来自定义您的使用，通过函数和运算符重载以及模板可以简明扼要地表达您的问题

> 包含在文本级别而不是真实语言功能上运行的宏来解决宏的用途，

预处理器有很多不喜欢的地方，但从代码生成的角度来看，对令牌进行操作可能非常有用。诚然，像 M4 宏这样的东西提供了一种更强大的方法来执行此操作，但缺点是它不是该语言的标准部分。标准的 c/c++ 预处理器在编译器所在的任何地方都可用。

> 重复功能，如数组和字符串（这些类型的 STL 和 C 版本）

此功能不是重复的。实现高阶概念（如通用容器）需要低级别的逐字节原语（不包括指针算术）。请记住，C++ 是用于对其实施的系统进行编程，但也用于提供执行实际工作的表达能力。

> 并且普遍缺乏现代功能，例如线程、垃圾收集、委托/闭包等（注意：是的，在内存非常有限或实时的环境中，您可能有充分的理由不想要垃圾收集，但很容易选择-out 并成为管理内存的默认方式。）

线程是一种需要操作系统以某种编程语言无法真正标准化的方式进行合作的东西。许多语言将其抽象为单个接口，但这在 c++ 中并没有发生（这显然即将到来）。垃圾收集器可用于 C++，但它提供了一个更强大的概念，RAII。无论如何，选择退出不是 C++ 方式，如果垃圾收集工具曾经标准化为该语言，那么它肯定是一个选择加入，因此如果你不使用它就不必为此付费.

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-03-08T22:04:51.533

是的，比起Java，我更喜欢C++——因为我可以更自由地表达自己。

C++ 是必要的，因为它是目前唯一真正可扩展的语言。有一种方法可以调整程序的各个方面，因此它永远不会失去动力。

另一个好处是库代码中的详细程度，而不是“使用”代码。一旦库正常工作，使用代码通常会很好而且简洁（如果您使用正确的库，则易于阅读）。

在 Java/C# 中，所有的冗长都被带到了使用代码中——try/catch/finally ...所有这些东西都需要一遍又一遍地输入。咳咳……！

我是否提到了基于堆栈的对象？没有他们，人们如何生活......？？

C ++真正失败的唯一地方是反射（尽管即使这样也可以完成，例如COM）。

是的，具有更严格语法的清理 C++ 会很好，但我们知道它永远不会发生。您可以习惯语法，总体而言，为您获得的回报付出很小的代价。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-03-08T22:41:19.417

> 它作为系统/性能编程语言的利基

这是一个相当大的利基市场！如果一个软件有超过 1000 万用户，那么它很有可能是用 C++ 编写的：

*   视窗
*   IE
*   照相馆
*   火狐
*   办公室
*   SQL 服务器
*   MySQL
*   谷歌搜索引擎
*   欧特克

来源：[http ://www.research.att.com/~bs/applications.html](http://www.research.att.com/~bs/applications.html)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-03-09T03:05:28.113

对我来说，我更喜欢 C++，因为：

*   它仍然是硬件将要做什么的相当直接的表示，或者足够接近，您可以对实际程序行为和性能做出有根据的推断
*   它足够灵活，可以让我使用或实现大多数编程范例
*   与其他库和模块的兼容性高，现有最大的参考和直接可用代码支持库
*   大多数“缺陷”很容易通过良好的编程实践和/或实用程序库来消除，这与“缺陷”不太可修复的其他语言相反（例如：您可以通过使用智能指针轻松修复内存泄漏，并轻松诊断内存直接内存分析损坏，您不能轻松地用 C# 等高级语言调试内存损坏问题，是的，我已经遇到过）
*   C++ 应用程序通常可以在任何操作系统版本上运行，唯一的限制是努力；高级语言通常需要可能存在或不存在的运行时

我需要什么其他东西来进行主要开发？好吧，除了以某种方式解决上述原因之外，其他“高级”语言必须传达一种感觉，即我仍然能够实现和调试我可以在 C++ 中做的所有事情。真正对我来说唯一接近的是 C++/CLI，但它在语法上更糟糕，更难理解，并且未能通过“运行时要求”测试（并且可以说在其他期望的好处方面并没有增加太多）。

我猜在我退休前的 30 多年里，我会因为写 C++ 以外的东西而获得报酬。当然，在某些开发领域 C++ 并不可取，并且语言供应商有强烈的动机强迫开发人员使用在专有和/或供应商控制的运行时（例如：Java、C# 等）上运行的高级语言。不过，就目前而言，对我来说，C++ 仍然是完成这项工作的合适工具，而且我喜欢通过继续编写它来获得报酬。:)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-03-08T22:26:09.313

[C++0x](http://en.wikipedia.org/wiki/C%2B%2B0x)！

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-03-08T21:46:11.920

我的观点是人们需要更高级别的语言，以某种方式提供与 C++ 相同的功能。用高级语言（比如说 Java）做一些事情，同时以更快的速度、本机二进制编译和其他特性执行，而不诉诸 JNI 之类的东西，将是“我需要摆脱 C++ 的东西”。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-03-08T23:59:40.790

当他们提出一种在更少内存中运行得更快并且得到更广泛支持的语言时。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-08T22:07:07.987

坦率地说，它运作良好，我付钱来写它。它与控制它的单一供应商的营销奇思妙想无关。市场上的 C++ 专家越来越少，所以我的价值随着时间的推移而增加。我将继续使用它，直到市场变得不可持续。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-03-08T22:29:52.270

正如您所描述的，C++ 肯定有它的缺点，这个[C++ FQA](http://yosefk.com/c++fqa/)在指出其中许多方面做得很好。然而，已经使用一种语言很长一段时间的人和组织已经包含了大量的[习语、陷阱](http://www.gotw.ca/gotw/index.htm)和[指导方针](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)，这使得使用它更容易忍受。多年来，C++ 编程风格也在[不断发展](http://books.google.com/books?id=aJ1av7UFBPwC&dq=modern+c%2B%2B+alexandrescu&printsec=frontcover&source=bn&hl=en&ei=KkS0SYXjJ8KD-Aai1NTrAg&sa=X&oi=book_result&resnum=4&ct=result#PPR9,M1)。凭借原生编译和成熟的工具集，在许多平台上，C++ 仍然是一个强有力的竞争者。

在我看来，让 C++ 迅速失去其地位的唯一方法是让 IBM 或 Google 等大公司支持可行的替代方案，如[D 语言](http://www.digitalmars.com/d/2.0/index.html)，并全力推动它。但是，考虑到他们自己的代码库中已经存在的大量 C++，这实际上是不可能发生的。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-03-08T22:50:00.053

要理解 C++ 为何如此，并欣赏它的成就，最好的方法是阅读“C++ 的设计和演变”。

尽管有缺点，但 C++ 是一门相当不错的语言。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-03-08T22:50:30.770

我主要将 C++ 用于通常需要与硬件进行大量密切交互的嵌入式平台。我真的没有在这里看到任何 OO 替代品。如果我在这里用 C++ 代替任何东西，那将是可以在编译时解决所有包含特权的东西，所以我不必担心这些。基本上，这可以简化我的开发，但没有提供任何运行时开销（反射、垃圾收集等）。

对我来说，C++ 就是关于运行时性能和绝对控制。没有花哨的运行时东西可以“在幕后”工作。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-03-08T23:41:08.493

我做科学计算，我的 GUI 是 C#，我的后端是 C++。C# 在性能方面至少可以与 C++ 相提并论，但这并不是 C#/insert 托管语言的重点所在。这将是困难的，但在数值计算方面让 C# 与 C++（或非常接近）一样好（或非常接近）的可能性范围之内，因为 IL 被编译为机器代码。如果/当这种情况发生时，我很乐意做出改变。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-03-08T22:10:19.117

当一种新语言能够像 C++ 一样富有表现力时。由于高级和低级能力之间的利益冲突，这很难实现。这就是我们首先拥有语言和流程互操作性的原因。

此外，C 语言可能更难处理，因为它非常精简和强大。正因为如此，C在低级别赛场上获胜。C 为 C++ 和客观 C 创造了良好的支持。

**简而言之，您仍然会看到 C 和 C++ 很长一段时间。**

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-03-09T04:28:05.030

我个人选择使用 C++（当我什至可以选择时）是因为它是唯一一种不被解释的多用途编程语言，并且有足够的“花里胡哨”让我可以相对快速地完成工作。现在有很多理由让我在机会出现时选择其他语言（例如 Python、Java、Perl、ksh 等）。我将其他语言用于“一次性”应用程序和脚本，其中性能不是问题，“现场可部署性”也不是问题。许多脚本语言的部署支持都非常以 Web 为中心，我现在更多地从事基础设施和“隐形胶水”行业。我们正在寻找 J2EE 应用程序服务器来帮助解决部署和支持问题，但我们已经有了一些用于可执行服务的好方法。

在许多情况下，我将继续选择使用 C++ 的最大原因是，在您添加一些选择的库来处理非编程语言平台的东西（线程、套接字等）之后，它几乎支持我需要的一切。而且......**是**的......我确实认为线程应该在编程语言之外表示。这就是我倾向于远离其他语言的主要原因——我实际上喜欢具有基本核心的语言，其中功能是通过附加库提供的。

让编程语言担心语法、继承、多态性、模块结构、异常处理、循环结构等。一旦您进入应用程序域并想要多线程您的应用程序或者可能使用多个进程，那么您正在谈论库。太多的语言试图强制使用不适用于所有问题的特定编程范式 (OOP)。我更喜欢一种不错的通用编程语言。

最后一个原因是我选择 C++ 而不是其他语言是因为我实际上认为它比其他语言更具确定性。我知道 Java 是首选的*平台中立*解决方案，而 Ruby 和 Python 是du'jour的*快速开发替代方案。*问题是被解释的应用程序总是在解释器的时候执行。这并不总是一件坏事，当然也不总是一件好事。

C++ 很可能会在这里存在一段时间。我的猜测是，大量更纯粹的 OOP 语言将开始失去市场份额给更通用的动态语言（可能是 Ruby 和 Python），并且这些语言也会获得一些更严重的 OO 印章。当太阳开始真正落在 C++ 上并且有另一种语言被“行业”广泛接受时，我将切换到另一种语言。我确信它会在某一天发生……毕竟 C++ 实际上在几年前取代了 C 作为我选择的语言。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-03-09T06:24:42.533

C++ 是我工具箱中的一个工具。java和python以及其他一些东西也是如此。

方便我公司的环境使我能够使用任何合适的东西。

*   必要时 C++ == perf。
*   Java == 当 perf 不是那么必要时（由于网络/外部 IO 大大超过 CPU 周期的事实），并且开发速度是必要的。

工具箱中的工具。使用合适的。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-03-08T21:55:40.680

为什么？如果我开始用不同的语言编写代码，你会获利吗？:-P

开个玩笑，我编写 C++ 代码是因为这就是我的雇主付钱给我的原因。真的就是这么简单。如果他们决定使用不同的语言，我会开始使用它。现在，至于*他们*为什么选择使用它，我只能推测。我的猜测是他们有两个主要原因：

1.  有足够多的大学毕业生*精通*C++，可以实现他们的商业目标。
2.  C++在实时分布式系统中提供*了足够好的性能。*

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-03-08T22:00:31.420

不幸的是，您还没有发现该语言的基本优雅和概念完整性。它提供了与任何其他语言一样舒适和一致的世界观，这反映在它多年来的持续使用中。YMMV，但请允许我们所有人都考虑一下。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-03-09T03:12:12.463

你正在以相反的方式解决这个问题。人们选择他们感兴趣的问题/应用领域。语言的选择遵循该决定，并且非常简单。

没有人会选择编程语言。编程语言本身很无聊，并且在不参考问题/应用程序域的情况下谈论它们是荒谬的。

就个人而言，我想从事机器学习工作。作为研究生。学生我致力于分析大型数据集（IMDB、Netflix）的图形表示。我的大部分工作都使用 C++。我本来希望使用 C# 或 Java 或更好的 Python 工作，但问题的性质要求我使用 C++。在 5 年的时间里，我爱上了 C++，因为它在效率和抽象之间实现了黄金平衡。每当我看到需要它时，我都会使用 C++。C++ 程序员是顽固的实用主义者，他们不会让任何事情妨碍完成工作。他们不会仅仅为了它而坚持使用 C++。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-03-09T05:36:42.180

我认为现在不需要（通常也不应该）用同一种语言编写项目的高级和低级部分是公认的。因此，您要么等待雇主意识到即使很难找到使用多种语言工作的开发人员，但实际上找到*优秀的开发人员**更容易*，或者等待无能的大军使用多语种程序。

 ** * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-03-09T06:34:18.203

查看您使用 C++ 列出的“问题”列表，我可能会接近同意的唯一一个问题是 STL/C 字符串转换。

我可能会问，你为什么希望 C++ 成为 C#？

# c# - 如何在 WPF 中处理 WndProc 消息？

> ID：624367
> 
> 赞同：116
> 
> 时间：2009-03-08T21:49:03.210
> 
> 标签：c#, wpf, wndproc

在 Windows 窗体中，我只需覆盖`WndProc`，并在消息进入时开始处理它们。

有人可以向我展示如何在 WPF 中实现相同目标的示例吗？

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2009-12-18T07:12:42.617

您可以通过`System.Windows.Interop`包含名为`HwndSource`.

使用这个的例子

```
using System;
using System.Windows;
using System.Windows.Interop;

namespace WpfApplication1
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        protected override void OnSourceInitialized(EventArgs e)
        {
            base.OnSourceInitialized(e);
            HwndSource source = PresentationSource.FromVisual(this) as HwndSource;
            source.AddHook(WndProc);
        }

        private IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
        {
            // Handle messages...

            return IntPtr.Zero;
        }
    }
} 
```

完全取自出色的博客文章：[Steve Rands 在 WPF 应用程序中使用自定义 WndProc](http://web.archive.org/web/20091019124817/http://www.steverands.com/2009/03/19/custom-wndproc-wpf-apps/)

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2009-03-08T22:18:57.910

`HwndSource`实际上，据我了解，在 WPF 中使用and确实可以做到这一点`HwndSourceHook`。以MSDN上的[这个线程](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/6b97a6de-0480-4339-8ed0-cb7cdb27bd83/)为例。（相关代码如下）

```
// 'this' is a Window
HwndSource source = HwndSource.FromHwnd(new WindowInteropHelper(this).Handle);
source.AddHook(new HwndSourceHook(WndProc));

private static IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
{
    //  do stuff

    return IntPtr.Zero;
} 
```

现在，我不太确定您为什么要在 WPF 应用程序中处理 Windows 消息传递消息（除非它是与另一个 WinForms 应用程序一起工作的最明显的互操作形式）。WPF 中的设计思想和 API 的性质与 WinForms 有很大不同，因此我建议您只是更多地熟悉 WPF，以了解*为什么*没有 WndProc 的等价物。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-07-14T16:58:59.010

```
HwndSource src = HwndSource.FromHwnd(new WindowInteropHelper(this).Handle);
src.AddHook(new HwndSourceHook(WndProc));

.......

public IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
{

  if(msg == THEMESSAGEIMLOOKINGFOR)
    {
      //Do something here
    }

  return IntPtr.Zero;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-02-02T17:08:23.633

如果您不介意引用 WinForms，则可以使用更面向 MVVM 的解决方案，该解决方案不会将服务与视图耦合。您需要创建并初始化一个 System.Windows.Forms.NativeWindow，它是一个可以接收消息的轻量级窗口。

```
public abstract class WinApiServiceBase : IDisposable
{
    /// <summary>
    /// Sponge window absorbs messages and lets other services use them
    /// </summary>
    private sealed class SpongeWindow : NativeWindow
    {
        public event EventHandler<Message> WndProced;

        public SpongeWindow()
        {
            CreateHandle(new CreateParams());
        }

        protected override void WndProc(ref Message m)
        {
            WndProced?.Invoke(this, m);
            base.WndProc(ref m);
        }
    }

    private static readonly SpongeWindow Sponge;
    protected static readonly IntPtr SpongeHandle;

    static WinApiServiceBase()
    {
        Sponge = new SpongeWindow();
        SpongeHandle = Sponge.Handle;
    }

    protected WinApiServiceBase()
    {
        Sponge.WndProced += LocalWndProced;
    }

    private void LocalWndProced(object sender, Message message)
    {
        WndProc(message);
    }

    /// <summary>
    /// Override to process windows messages
    /// </summary>
    protected virtual void WndProc(Message message)
    { }

    public virtual void Dispose()
    {
        Sponge.WndProced -= LocalWndProced;
    }
} 
```

使用 SpongeHandle 注册你感兴趣的消息，然后重写 WndProc 来处理它们：

```
public class WindowsMessageListenerService : WinApiServiceBase
{
    protected override void WndProc(Message message)
    {
        Debug.WriteLine(message.msg);
    }
} 
```

唯一的缺点是您必须包含 System.Windows.Forms 引用，否则这是一个非常封装的解决方案。

更多信息可以在[这里阅读](http://tyrrrz.me/Blog/WndProc-in-WPF)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-04-08T17:26:36.380

这是使用行为覆盖 WindProc 的链接：http: [//10rem.net/blog/2010/01/09/a-wpf-behavior-for-window-resize-events-in-net-35](http://10rem.net/blog/2010/01/09/a-wpf-behavior-for-window-resize-events-in-net-35)

[编辑：迟到总比没有好] 下面是我基于上述链接的实现。虽然重新审视这一点，但我更喜欢 AddHook 实现。我可能会切换到那个。

就我而言，我想知道何时调整窗口大小以及其他几件事。此实现连接到 Window xaml 并发送事件。

```
using System;
using System.Windows.Interactivity;
using System.Windows; // For Window in behavior
using System.Windows.Interop; // For Hwnd

public class WindowResizeEvents : Behavior<Window>
    {
        public event EventHandler Resized;
        public event EventHandler Resizing;
        public event EventHandler Maximized;
        public event EventHandler Minimized;
        public event EventHandler Restored;

        public static DependencyProperty IsAppAskCloseProperty =  DependencyProperty.RegisterAttached("IsAppAskClose", typeof(bool), typeof(WindowResizeEvents));
        public Boolean IsAppAskClose
        {
            get { return (Boolean)this.GetValue(IsAppAskCloseProperty); }
            set { this.SetValue(IsAppAskCloseProperty, value); }
        }

        // called when the behavior is attached
        // hook the wndproc
        protected override void OnAttached()
        {
            base.OnAttached();

            AssociatedObject.Loaded += (s, e) =>
            {
                WireUpWndProc();
            };
        }

        // call when the behavior is detached
        // clean up our winproc hook
        protected override void OnDetaching()
        {
            RemoveWndProc();

            base.OnDetaching();
        }

        private HwndSourceHook _hook;

        private void WireUpWndProc()
        {
            HwndSource source = HwndSource.FromVisual(AssociatedObject) as HwndSource;

            if (source != null)
            {
                _hook = new HwndSourceHook(WndProc);
                source.AddHook(_hook);
            }
        }

        private void RemoveWndProc()
        {
            HwndSource source = HwndSource.FromVisual(AssociatedObject) as HwndSource;

            if (source != null)
            {
                source.RemoveHook(_hook);
            }
        }

        private const Int32 WM_EXITSIZEMOVE = 0x0232;
        private const Int32 WM_SIZING = 0x0214;
        private const Int32 WM_SIZE = 0x0005;

        private const Int32 SIZE_RESTORED = 0x0000;
        private const Int32 SIZE_MINIMIZED = 0x0001;
        private const Int32 SIZE_MAXIMIZED = 0x0002;
        private const Int32 SIZE_MAXSHOW = 0x0003;
        private const Int32 SIZE_MAXHIDE = 0x0004;

        private const Int32 WM_QUERYENDSESSION = 0x0011;
        private const Int32 ENDSESSION_CLOSEAPP = 0x1;
        private const Int32 WM_ENDSESSION = 0x0016;

        private IntPtr WndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, ref Boolean handled)
        {
            IntPtr result = IntPtr.Zero;

            switch (msg)
            {
                case WM_SIZING:             // sizing gets interactive resize
                    OnResizing();
                    break;

                case WM_SIZE:               // size gets minimize/maximize as well as final size
                    {
                        int param = wParam.ToInt32();

                        switch (param)
                        {
                            case SIZE_RESTORED:
                                OnRestored();
                                break;
                            case SIZE_MINIMIZED:
                                OnMinimized();
                                break;
                            case SIZE_MAXIMIZED:
                                OnMaximized();
                                break;
                            case SIZE_MAXSHOW:
                                break;
                            case SIZE_MAXHIDE:
                                break;
                        }
                    }
                    break;

                case WM_EXITSIZEMOVE:
                    OnResized();
                    break;

                // Windows is requesting app to close.    
                // See http://msdn.microsoft.com/en-us/library/windows/desktop/aa376890%28v=vs.85%29.aspx.
                // Use the default response (yes).
                case WM_QUERYENDSESSION:
                    IsAppAskClose = true; 
                    break;
            }

            return result;
        }

        private void OnResizing()
        {
            if (Resizing != null)
                Resizing(AssociatedObject, EventArgs.Empty);
        }

        private void OnResized()
        {
            if (Resized != null)
                Resized(AssociatedObject, EventArgs.Empty);
        }

        private void OnRestored()
        {
            if (Restored != null)
                Restored(AssociatedObject, EventArgs.Empty);
        }

        private void OnMinimized()
        {
            if (Minimized != null)
                Minimized(AssociatedObject, EventArgs.Empty);
        }

        private void OnMaximized()
        {
            if (Maximized != null)
                Maximized(AssociatedObject, EventArgs.Empty);
        }
    }

<Window x:Class="MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        xmlns:behaviors="clr-namespace:RapidCoreConfigurator._Behaviors"
        Title="name" Height="500" Width="750" BorderBrush="Transparent">

    <i:Interaction.Behaviors>
        <behaviors:WindowResizeEvents IsAppAskClose="{Binding IsRequestClose, Mode=OneWayToSource}"
                                      Resized="Window_Resized"
                                      Resizing="Window_Resizing" />
    </i:Interaction.Behaviors>

    ... 

</Window> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-09-08T07:40:19.463

您可以附加到内置 Win32 类的“SystemEvents”类：

```
using Microsoft.Win32; 
```

在 WPF 窗口类中：

```
SystemEvents.PowerModeChanged += SystemEvents_PowerModeChanged;
SystemEvents.SessionSwitch += SystemEvents_SessionSwitch;
SystemEvents.SessionEnding += SystemEvents_SessionEnding;
SystemEvents.SessionEnded += SystemEvents_SessionEnded;

private async void SystemEvents_PowerModeChanged(object sender, PowerModeChangedEventArgs e)
{
    await vm.PowerModeChanged(e.Mode);
}

private async void SystemEvents_PowerModeChanged(object sender, PowerModeChangedEventArgs e)
{
    await vm.PowerModeChanged(e.Mode);
}

private async void SystemEvents_SessionSwitch(object sender, SessionSwitchEventArgs e)
{
    await vm.SessionSwitch(e.Reason);
}

private async void SystemEvents_SessionEnding(object sender, SessionEndingEventArgs e)
{
    if (e.Reason == SessionEndReasons.Logoff)
    {
        await vm.UserLogoff();
    }
}

private async void SystemEvents_SessionEnded(object sender, SessionEndedEventArgs e)
{
    if (e.Reason == SessionEndReasons.Logoff)
    {
        await vm.UserLogoff();
    }
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-08T21:58:22.953

有一些方法可以在 WPF 中使用 WndProc 处理消息（例如使用 HwndSource 等），但通常这些技术保留用于与无法通过 WPF 直接处理的消息进行互操作。大多数 WPF 控件甚至不是 Win32（以及扩展为 Windows.Forms）意义上的窗口，因此它们不会有 WndProcs。

* * *

## 回答 #8

> 赞同：-7
> 
> 时间：2009-03-08T21:56:42.147

WPF 不在 WinForms 类型的 wndprocs 上运行

您可以在适当的 WPF 元素中托管 HWndHost，然后覆盖 Hwndhost 的 wndproc，但 AFAIK 与您将获得的一样接近。

[http://msdn.microsoft.com/en-us/library/ms742522.aspx](http://msdn.microsoft.com/en-us/library/ms742522.aspx)

[http://blogs.msdn.com/nickkramer/archive/2006/03/18/554235.aspx](http://blogs.msdn.com/nickkramer/archive/2006/03/18/554235.aspx)

* * *

## 回答 #9

> 赞同：-15
> 
> 时间：2009-03-08T21:57:37.400

简短的回答是你不能。WndProc 通过将消息传递给 Win32 级别的 HWND 来工作。WPF 窗口没有 HWND，因此不能参与 WndProc 消息。基本 WPF 消息循环确实位于 WndProc 之上，但它将它们从核心 WPF 逻辑中抽象出来。

您可以使用 HWndHost 并为它获取 WndProc。然而，这几乎肯定不是你想要做的。出于大多数目的，WPF 不在 HWND 和 WndProc 上运行。您的解决方案几乎肯定依赖于对 WPF 进行更改而不是在 WndProc 中进行更改。

# firefox - 在Firefox的文本区域中获取行号的最佳方法

> ID：624372
> 
> 赞同：1
> 
> 时间：2009-03-08T21:50:55.717
> 
> 标签：firefox

我很感兴趣是否可以（通过插件或其他方式）将行号（也许更多）添加到 vanilla firefox 文本区域（我知道有各种代码编辑器，并且有它的所有文本插件，但不是确定是否有更简单的方法可以使用）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T22:47:09.373

[试试这个](http://4umi.com/web/javascript/textarea.php)

# .net - 在 Outlook 2007 中检测自动存档设置/存储

> ID：624377
> 
> 赞同：1
> 
> 时间：2009-03-08T21:54:32.947
> 
> 标签：.net, outlook, vsto, outlook-2007, outlook-addin

我想编写一个简单的 Outlook 2007 插件，允许我手动自动存档邮件。也就是说，我右键单击一封邮件，选择自动存档，然后它会被移动到我的存档文件夹中。

不幸的是，我似乎无法检测到哪一个是存档存储。我知道 Application.GetNamespace("MAPI").Stores 是我所有商店的列表，其中包括我的存档商店。但是我似乎没有找到一种方法来检测商店是否是存档商店。

在推荐与 store.DisplayName 进行简单字符串匹配之前，请记住本地化（在德语中，Store 是“Archivordner”，这显然与英文不同）。

我在想可以访问自动存档设置以获取文件名，然后与 store.FilePath 匹配，但我无法在任何地方找到此设置。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T23:54:22.613

好的，找到了。秘密是 IPC.MS.Outlook.AgingProperties，它有点奇怪和无证，但对我来说已经足够了。

```
 private bool GetArchiveFilename(MAPIFolder fld, out string archiveFileName)
    {
        bool result = false;
        archiveFileName = string.Empty;
        if (fld != null)
        {
            StorageItem si = fld.GetStorage("IPC.MS.Outlook.AgingProperties", OlStorageIdentifierType.olIdentifyByMessageClass);

            try
            {
                archiveFileName = si.PropertyAccessor.GetProperty("http://schemas.microsoft.com/mapi/proptag/0x6859001E").ToString();
                result = true;
            }
            catch (COMException)
            {
                return GetArchiveFilename(fld.Parent as MAPIFolder, out archiveFileName);
            }
        }
        return result;
    } 
```

# asp.net-mvc - ASP.NET MVC 安全建议

> ID：624386
> 
> 赞同：4
> 
> 时间：2009-03-08T21:58:24.373
> 
> 标签：asp.net-mvc, security

我最近开始了一个使用 ASP.NET MVC（撰写本文时为 RC1）的个人项目。我的背景是传统的 ASP.NET WebForms 开发。

我对 ASP.NET MVC 的了解有限，因此我希望您能就如何最好地处理身份验证、输入验证和防止常见攻击（XSS、XSRF 等）提供意见。

[我将首先列出Stephen Walther 在他的博客上发布](http://stephenwalther.com/blog/)的几篇文章：

*   [提示 #7 - 使用 Html.Encode 防止 JavaScript 注入攻击](http://stephenwalther.com/blog/archive/2008/06/23/asp-net-mvc-tip-7-prevent-javascript-injection-attacks-with-html-encode.aspx)
*   [提示 #10 - 防止 URL 操纵攻击](http://stephenwalther.com/blog/archive/2008/06/26/prevent-url-manipulation-attacks.aspx)
*   [提示 #46 – 不要使用删除链接，因为它们会造成安全漏洞](http://stephenwalther.com/blog/archive/2009/01/21/asp.net-mvc-tip-46-ndash-donrsquot-use-delete-links-because.aspx)

验证：

*   [xVal 验证框架](http://www.codeplex.com/xval)

谢谢，
阿尼

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-08T22:27:47.657

在我的脑海中（而且还远未完成）......

*   在所有表单上使用 AntiForgeryToken 以防止 XSRF。使用单元测试确保所有接受 POSTS 的控制器操作都使用 ValidateAntiForgeryToken 属性进行修饰。

*   尽可能利用 HtmlHelper 扩展来利用自动 HTML 编码。

*   对所有数据库访问使用带有参数化查询的 ORM —— 不是 MVC 独有的，但仍然相关。

*   将您接受的 HTTP 动词限制在最低要求。使用 DELETE (vi AJAX) 或 POST 进行删除操作。

*   使用 AuthorizeAttribute 或派生自它的属性来保护非公共操作。

*   不要在可能被缓存的 url 中公开用户 ID/密码（即，通过表单 POST 而不是 GET url 登录）。与往常一样，使用 SSL 传递敏感数据。

# css - 如何使用 CSS 设置表格列中所有元素的宽度

> ID：624404
> 
> 赞同：1
> 
> 时间：2009-03-08T22:08:34.393
> 
> 标签：css

我有一个基于表格的布局，有一个主要的两列表格，用于表格的左侧和右侧。每列包含一个内部的两列表格，带有标签和输入列，每个字段位于其自己的行中。

我可以使用 CSS 来设置两个输入列的宽度吗？

例如

```
<table id="frameTable">
  <tr>
    <td id="leftFieldList">
      <table class="formColumn">
        <tr>
          <td>Surname</td>
          <td><asp:TextBox.....></td>
        </tr>
        <tr>
          <td>Address</td>
          <td><asp:TextBox.....></td>
        </tr>
        ....
        ....
      <table>
    </td>
</table> 
```

在“formColumn”类的表中，我想`<td>`使用服务器控件设置第二个的宽度。我宁愿这样做，而不是为`<td>`我的字段列表中的每一秒分配一个类。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-08T22:21:49.947

最好的解决方案：使用`col`标签！

```
<style> .col2 { width: 200px; } </style>
...

<table class="formColumn">
  <colgroup>
    <col></col>
    <col class="col2"></col>
  </colgroup>
  <tbody>
    <tr>...
  </tbody>
</table> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T22:22:40.990

另一个对 IE6 不友好的解决方案是

```
.formColumn td:last-child { width: 200px; } 
```

如果你没有卡在 CSS 上，你可以使用 col 组

```
<table class="formColumn">
   <colgroup>
      <col />
      <col width="200px" />
   </colgroup>
   <tr>
      <td>Surname</td>
      <td><asp:textbox..../></td>
   </tr>
</table> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T22:19:12.357

通常，您可以这样做：

```
table.formColumn tr td:last-child { width: 200px; } 
```

但 IE7 不识别最后一个孩子，所以你可能不得不去

```
table.formColumn tr td+td { width: 200px; } 
```

根据 quirksmode.org，IE6 无法识别 + 选择器。如果您计划支持 IE6，我没有适合您的解决方案，以及您当前的标记。

除此之外，有些人认为您不应该使用表格来设计网站的布局。第二个表 (formColumn) 可以替换为以下内容：

```
<fieldset><label ...>Surname</label><YourTextInput /></fieldset> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-08T22:21:35.207

如果您想将它们设置为相同的宽度，这很容易：

```
table.formColumn td {
  width: 150px;
} 
```

如果您希望它们具有不同的宽度，则问题会更大，但问题不大。最简单的选择就是为第一行的 td 元素分配一个类：

```
<table id="frameTable">
  <tr>
    <td id="leftFieldList">
      <table class="formColumn">
        <tr>
          <td class="left">Surname</td>
          <td class="right"><asp:TextBox.....></td>
        </tr>
        <tr>
          <td>Address</td>
          <td><asp:TextBox.....></td>
        </tr>
        ....
        ....
      <table>
    </td>
</table> 
```

然后：

```
table.formColumn td.left {
  width: 150px;
}

table.formColumn td.right {
  width: 300px;
} 
```

由于该列的其余部分将采用这些宽度。

您也可以使用 + 选择器，但 IE6 不支持它：

```
table.formColumn td {
  width: 150px;
}

table.formColumn td + td {
  width: 300px;
} 
```

# ruby-on-rails - Ruby 库从文本生成图形？

> ID：624413
> 
> 赞同：0
> 
> 时间：2009-03-08T22:13:26.473
> 
> 标签：ruby-on-rails, ruby, graphics, google-maps

我在 Rails 工作，我正在寻找一个库/宝石/插件来从文本生成图形。谷歌地图不允许你覆盖文本，只有图形，所以我正在寻找一个后门来覆盖文本。建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T22:21:50.120

看看[RMagick](http://rmagick.rubyforge.org/)。

要使用 RMagick 绘制文本，您需要使用[text](http://studio.imagemagick.org/RMagick/doc/draw.html#text)或[annotate](http://studio.imagemagick.org/RMagick/doc/draw.html#annotate)方法之一。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T22:20:16.800

您需要[RMagick 之](http://rmagick.rubyforge.org/)类的东西，尽管已知该特定库会泄漏内存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T22:22:22.723

[`libgd`](http://www.libgd.org/)可以做到这一点，并且绑定了许多不同的语言，包括[Ruby](http://www.libgd.org/Binders#Ruby)

# scroll - YUI 面板和滚动

> ID：624414
> 
> 赞同：2
> 
> 时间：2009-03-08T22:13:27.300
> 
> 标签：scroll, yui, panel

我有一个像这样定义的可拖动 YUI 面板

```
new YAHOO.widget.Panel("parameters", {
                        fixedcenter: true,
                        constraintoviewport: true,
                        underlay: "shadow",
                        visible: false,
                        close: true,
                        draggable: true,
                        width: "350px" }); 
```

显示面板时，我希望它始终可见，即使在窗口滚动时也是如此。情况也是如此，感谢`fixedcenter: true`. 问题是，当窗口滚动时，面板会将自身定位到窗口的中心，即使它之前被拖到其他地方也是如此。

我应该如何修改上述定义，以便在滚动窗口时面板的位置相对于窗口保持不变？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-25T06:24:25.300

将您的面板容器包装在具有固定定位的包装元素中，例如

```
<div id="wrapper" style="position: fixed">
    <div id="parameters">
        <div class="hd">Header</div>
        <div class="bd">Hello, this is my awesome panel.</div>
        <div class="ft">Footer</div>
    </div>
</div> 
```

构建没有`fixedcenter`配置属性的面板，并在渲染后立即将面板居中，例如

```
var panel = new YAHOO.widget.Panel("parameters", {
        constraintoviewport: true,
        underlay: "shadow",
        visible: false,
        close: true,
        draggable: true,
        width: "350px"
    });
panel.render();
panel.center(); 
```

当窗口滚动时，面板现在应该保持在相同的位置。我只在 Firefox 3.0 和 Internet Explorer 7 和 8 中对此进行了测试。

我已经[发布了](http://pastebin.com/f3b4861bf)一个独立示例的源代码，该示例将演示此工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-19T15:24:15.983

根据文档，将 fixedcenter 设置为：

> **"contained"**启用固定中心定位，与 true 选项一样。但是，与将属性设置为 true 不同的是，当属性设置为“包含”时，如果叠加层对于视口来说太大，则在用户滚动或调整窗口大小时不会自动居中（直到窗口足够大包含覆盖）。这在 Overlay 同时具有用户可能需要访问的页眉和页脚 UI 控件的情况下很有用。

[http://developer.yahoo.com/yui/docs/YAHOO.widget.Overlay.html](http://developer.yahoo.com/yui/docs/YAHOO.widget.Overlay.html)

# java - 如何在 Java 中记录包？

> ID：624422
> 
> 赞同：197
> 
> 时间：2009-03-08T22:17:42.033
> 
> 标签：java, packages, javadoc

在 Java API 中，我可以看到包的 Javadoc 注释。

如何/在哪里放置 Javadoc 注释来记录包？

* * *

## 回答 #1

> 赞同：272
> 
> 时间：2009-03-08T22:42:24.190

从 1.5 开始，您可以定义一个`package-info.java`文件并为包提供标准的 javadoc 样式注释：

com/foo/package-info.java：

```
/**
 * com.foo is a group of bar utils for operating on foo things.
 */
package com.foo;

//rest of the file is empty 
```

[包的语言规范](http://docs.oracle.com/javase/specs/jls/se7/html/jls-7.html#jls-7.4.1)

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-03-08T22:42:13.377

在 Java 1.4 之前并包括在内，您必须提供一个 HTML 文件 package.html，如其他答案中所述。

从 Java 1.5 开始，您还可以提供一个`package-info.java`包含常规 Javadoc 注释（无 HTML）的 . 后者是首选，因为它为您提供了一些额外的功能（特别是包注释）。

详细信息： [Sun 的 javadoc 文档](http://java.sun.com/javase/6/docs/technotes/tools/solaris/javadoc.html#packagecomment)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-08T22:18:50.720

使用`package.html`包级别的文件（即在该包的目录中）。这应该是一个完整的`HTML`文件，其中`<html>`定义了标签

# algorithm - 语音记忆密码生成算法

> ID：624425
> 
> 赞同：48
> 
> 时间：2009-03-08T22:19:07.507
> 
> 标签：algorithm, security, language-agnostic, passwords

### 背景

前几天在健身房时，我正在使用我的密码锁，并意识到一些对我作为程序员有用的东西。也就是说，我的组合是三组不同的数字，它们要么听起来相似，要么具有其他使它们易于记忆的关系。例如，5-15-25、7-17-2、6-24-5。这些例子*似乎*很容易记住。

### 问题

我将如何为密码实现类似的东西？是的，它们应该很难破解，但它们也应该易于最终用户记住。密码锁通过混合具有相似声音的数字和具有相似属性的数字来做到这一点（7-17-23：所有质数，17 在 7 之后立即从舌头上滚落，而 23 是另一个质数，并且是（出一组），“难”记住）。

### 标准

*   密码应该很容易记住。`Dog!Wolf`很容易记住，但是一旦攻击者知道您的网站给出了该组合，它就会使检查变得无限容易。
*   单词或字母应该大多遵循相同的声音（大部分）。
*   至少 8 个字母
*   不使用`!@#$%^&*();'{}_+<>?,./`这些标点符号虽然适用于“硬”密码，但没有“容易记住”的声音。

### 资源

这个问题与语言无关，但如果有 C# 的特定实现，我会很高兴听到它。

### 更新

一些用户说“这是糟糕的密码安全性”。**不要**以为这是针对网站的。这可能只是让我为自己制作一个根据这些规则生成密码的应用程序。这是一个例子。

> 字母 **A** - **C** - **C** - **L** - **I** - **M** - **O** - **P** 'flow'，它们恰好是放在一起的两个常规单词（**Acclimate**和**Mop**）。此外，当用户*说出*这些字母或将它们作为单词说出时，这对他们来说是一个实际的单词。容易记住，但很难破解（显然是字典攻击）。

这个问题有两个目标：

1.  从听起来相似的字母（使用头韵）或
2.  构造与常用词类似的密码，以生成不在字典中的第三组字母。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-08T22:36:29.163

你可能想看看：

*   [apg使用并在](http://www.adel.nursat.kz/apg/)[FIPS-181](http://www.nist.gov/manuscript-publication-search.cfm?pub_id=901456)中解释的发音密码生成算法
*   [是武](http://shorl.com/koremutake)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-08T22:30:23.267

首先确保密码长。考虑使用“密码短语”而不是单个“密码”。打破诸如“狗和狼互相憎恨”之类的密码短语。很难，但很容易记住。

一些网站也可能会为您提供可能有用的建议，例如[强密码：如何创建和使用它们](http://www.microsoft.com/protect/yourself/password/create.mspx)（链接自[Password checker](http://www.microsoft.com/protect/yourself/password/checker.mspx)，它本身就是一个有用的工具）。

此外，与其尝试创建易于记住的密码，在某些情况下，更好的选择是通过使用（并教育您的用户使用）一个好的密码管理实用程序来完全避免记住密码（请参阅[您最喜欢的密​​码存储是什么）工具？](https://stackoverflow.com/questions/11362/what-is-your-favorite-password-storage-tool)） - 这样做时，剩下的唯一部分就是创建一个难以破解的密码，这很容易（任何足够长的随机句子都可以）。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-11T20:00:37.093

我很惊讶没有人提到[http://www.multicians.org/thvv/gpw.html](http://www.multicians.org/thvv/gpw.html)中描述的 Multics 算法，它类似于 FIPS 算法，但基于三合字母而不是二合字母。它产生输出，例如

```
ahmouryleg
thasylecta
tronicatic
terstabble 
```

我也将代码移植到 python： http: [//pastebin.com/f6a10de7b](http://pastebin.com/f6a10de7b)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-08T22:28:37.483

您可以使用马尔可夫链生成听起来像英语（或您想要的任何其他语言）但它们不是实际单词的单词。

好记性这个问题真的很主观，所以我不认为你可以写出这样一个对每个人都有好处的算法。

为什么在网站/计算机应用程序上使用短密码而不是密码短语？它们很容易记住，但很难破解。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-09T00:21:23.577

多年后，我决定在密码中使用单词的第一个字母。它不可能破解，长度和限制如“你必须有一个数字”，并且很难出错。

这是通过创建一个短语来工作的。一个**疯狂有趣的生动话题**很有用！“Stack Overflow 外星人登陆时没有使用火箭或轮子”。取第一个字母，你的密码是“soalwurow”

**您可以快速****准确地**键入此内容，因为您不会逐个字母地记住，您只是在脑海中说出一个句子。

我也喜欢在键盘的左侧和右侧交替出现单词，它可以让你的打字速度更快，节奏更愉悦。请注意，在我的示例中，您的双手左右交替。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-11T20:15:50.757

我有几次使用以下算法：

1.  将所有小写元音（从 az）放入数组*Vowels*
2.  *将所有小写辅音*（从 az）放入另一个数组
**   创建第三个数组*Pairs* of two letters 以这样的方式创建所有可能的*元音*和*辅音*之间的字母对（“ab”，“ba”，“ac”等......）*   *从Pairs*中随机选择 3-5 个元素并将它们连接在一起作为字符串*密码**   随机选择`true`或`false`
    1.  如果，从*密码*`true`中删除最后一个字母
    **   如果`false`，什么都不做***   用大写等效替换*密码*中的2-4 个随机选择的字符*   用随机选择的整数 0-9替换*密码*中的2-4 个随机选择的字符**

 **瞧——现在你应该有一个长度在 5 到 10 个字符之间的密码，包含大小写字母数字字符。元音和辅音频繁轮流使它们具有半发音，因此更容易记住。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-08T22:51:58.113

FWIW 我非常喜欢使用混乱的单词音节来获得简单但基本上是随机的密码。以“Bongo”为例作为一个随机词。交换你得到“Gobong”的音节。将 o 替换为顶部的零（或其他一些常见的替换），您将获得一个基本上随机的字符序列，其中包含一些有助于您记住它的轨迹。

现在你如何以编程方式挑选音节 - 这是另一个问题！

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-03-08T22:47:18.747

当您为用户生成密码并通过电子邮件发送时，如果强制他们更改密码，您应该在他们首次登录时做的第一件事。系统创建的密码不需要很容易记住，因为它们应该只需要一次。

易于记忆、难以猜测的密码对您的用户来说是一个有用的概念，但不是系统应该以某种方式强制执行的概念。假设您向用户的 gmail 帐户发送密码，并且用户在登录后没有更改密码。如果 gmail 帐户的密码被泄露，那么您系统的密码也被泄露。

因此，如果您的用户必须立即更改密码，那么为您的用户生成易于记忆的密码是没有帮助的。如果他们不立即改变它，你还有其他问题。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-08T22:44:11.813

我更喜欢给用户一个“硬”密码，要求他们在第一次使用时更改它，并指导他们如何构建一个好的、长密码短语。我还会将此与合理的密码复杂性要求（8 个以上字符、大写/小写混合以及标点符号或数字）结合起来。我这样做的理由是，人们更有可能记住他们自己选择的东西，如果他们能记住的话，就不太可能把它写下来。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-09T00:42:36.897

“密码短语”想法的一个转折是取一个短语并写下短语中每个单词的第一个字母。例如

```
"A specter is haunting Europe - the specter of communism." 
```

变成

```
asihe-tsoc 
```

如果该短语恰好有标点符号，例如！，？等 - 不妨将它推到那里。数字也是如此，或者只是替换字母，或者在末尾添加相关数字。例如，卡尔·马克思（他说过这句话）于 1883 年去世，那么为什么不使用“asihe-tsoc83”呢？

我确信创造性的蛮力攻击可以利用这种密码的统计特性，但它仍然比字典攻击安全几个数量级。

* * *

另一个很好的方法是编造一些荒谬的词，例如“Barangamop”。使用几次后，您会记住它，但很难暴力破解。附加一些数字或标点以增加安全性，例如“386Barangamop！”

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-09T05:26:13.780

这是您的想法的第 2 部分，它以 shell 脚本为原型。它从您计算机上的 Unix 字典文件中提取 4、5 和 6 个字母的单词（大约 50,000 个），并将这些单词连接到第一个字符上。

```
#! /bin/bash

RANDOM=$$
WORDSFILE=./simple-words
DICTFILE=/usr/share/dict/words
grep -ve '[^a-z]' ${DICTFILE} | grep -Ee '^.{4,6}$' > ${WORDSFILE}
N_WORDS=$(wc -l < ${WORDSFILE})
for i in $(seq 1 20); do
    password=""
    while [ ! "${#password}" -ge 8 ] || grep -qe"^${password}$" ${DICTFILE}; do
        while [ -z "${password}" ]; do
            password="$(sed -ne "$(( (150 * $RANDOM) % $N_WORDS + 1))p" ${WORDSFILE})"
            builtfrom="${password}"
        done
        word="$(sort -R ${WORDSFILE} | grep -m 1 -e "^..*${password:0:1}")"
        builtfrom="${word} ${builtfrom}"
        password="${word%${password:0:1}*}${password}"
    done
    echo "${password} (${builtfrom})"
done 
```

像大多数密码生成器一样，我通过以 20 组输出密码来作弊。这通常以“安全性”（有人看着你的肩膀）的方式进行辩护，但实际上它只是让用户选择最友好的密码的一种黑客行为。

我发现字典文件中的 4 到 6 个字母的单词仍然包含晦涩的单词。

更好的文字来源是书面文件。我复制了这个页面上的所有单词并将它们粘贴到一个文本文档中，然后运行以下一组命令来获取*实际*的英文单词。

```
perl -pe 's/[^a-z]+/\n/gi' ./624425.txt | tr A-Z a-z | sort -u > ./words
ispell -l ./words | grep -Fvf - ./words > ./simple-words 
```

然后我使用这个页面中的这 500 个左右非常简单的单词，通过 shell 脚本生成了以下密码——脚本在括号中显示了构成密码的单词。

```
backgroundied (background died)
soundecrazy (sounding decided crazy)
aboupper (about upper)
commusers (community users)
reprogrammer (replacing programmer)
alliterafter (alliteration after)
actualetter (actual letter)
statisticrhythm (statistical crazy rhythm)
othereplacing (other replacing)
enjumbling (enjoying jumbling)
feedbacombination (feedback combination)
rinstead (right instead)
unbelievabut (unbelievably but)
createdogso (created dogs so)
apphours (applications phrase hours)
chainsoftwas (chains software was)
compupper (computer upper)
withomepage (without homepage)
welcomputer (welcome computer)
choosome (choose some) 
```

那里的一些结果是赢家。

原型表明它可能可以完成，但是您需要的有关头韵或音节信息的智能需要一个比单词更好的数据源。你需要发音信息。此外，我已经向您展示了您可能想要一个可供选择的简单单词数据库，而不是*所有*单词，以更好地满足您对记忆密码的要求。

第一次和每次都生成一个密码——Web 需要的东西——将需要更好的数据源和更复杂的功能。使用比 Bash 更好的编程语言来处理文本文件并使用数据库可以让它立即工作。使用数据库系统，您可以使用 SOUNDEX 算法或类似的算法。

好主意。祝你好运。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-09T08:47:38.243

我完全支持rjh。只使用密码短语的开头字母的好处是它看起来很随机，如果你不知道它后面的短语，这将很难记住，以防 Eve 在你输入密码时回头看你。
OTOH，如果她看到你输入了大约 8 个字符，其中 's' 两次，然后是 'o' 和 'r'，她可能第一次就猜对了。
强制使用至少一位数字并没有真正的帮助。您只*知道*它将是“pa55word”或“passw0rd”。

歌词是密码短语的取之不尽的来源。

```
"But I should have known this right from the start" 
```

变成“bishktrfts”。10 个字母，即使只有小写字母也会给你 10^15 种组合，这是*很多的*，尤其是因为没有破解它的捷径。（每秒 100 万个组合，测试所有 10^15 个组合需要 30 年。）
作为额外的（如果 Eve 知道你是警察迷），你可以交换例如第二个和第三个字母，或者取第二个第三个单词的字母。无限可能。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-08T22:33:39.093

看看[gpw 工具](http://www.multicians.org/thvv/tvvtools.html#SecurityTools)。该软件包也可在 Debian/Ubuntu 存储库中获得。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-08T23:06:26.720

系统生成的密码对于内部服务帐户或临时重置（等）以外的任何东西都是一个坏主意。

您应该始终使用自己的“密码短语”，这些“密码短语”很容易记住，但几乎不可能猜出或暴力破解。例如，我的旧大学帐户的密码是。

> `Here to study again!`

即 20 个字符，使用大小写和标点符号。这是一个令人难以置信的强密码，没有任何软件可以生成更安全、更容易记住的密码。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-09T10:02:28.797

生成“听起来像”单词的密码的一种方法是使用马尔可夫链。n 度马尔可夫链基本上是出现在输入语料库中的一大组 n 元组，以及它们的频率。例如，具有 2 阶马尔可夫链的“土豚”将生成元组 (a, a, 1)、(a, r, 2)、(r, d, 1)、(d, v, 1) , (v, a, 1), (r, k, 1)。或者，您还可以包括“虚拟”起始词和结束词标记。

为了为您的目的创建一个有用的马尔可夫链，您将输入大量的英语语言数据 - 有很多可用的，例如，包括古腾堡项目 - 以生成一组如上所述的记录。对于生成至少大部分遵循语法或组合规则的自然语言单词或句子，3 度马尔可夫链通常就足够了。

然后，要生成密码，您从集合中选择一个随机的“起始”元组，按其频率加权，并输出第一个字母。然后，重复随机选择（再次按频率加权）一个“下一个”元组 - 即一个以与当前字符相同的字母开头的元组，并且只有一个字母不同。使用上面的示例，假设我从 (a, a, 1) 开始，并输出“a”。我唯一的下一个选择是（a，r，2），所以我输出另一个'a'。现在，我可以选择 (r, d, 1) 或 (r, k, 1)，所以我会根据它们的出现频率随机选择一个。假设我选择 (r, k, 1) - 我输出“r”。这个过程一直持续到你到达一个词尾标记，或者决定独立停止（因为大多数马尔可夫链形成一个循环图，如果你不这样做，你可能永远不会完成生成

在单词级别（例如，元组的每个元素都是一个单词），一些“对话机器人”使用这种技术来生成看似合理的无意义句子。垃圾邮件发送者也使用它来试图逃避垃圾邮件过滤器。在字母级别，如上所述，它可用于生成无意义的单词，在这种情况下用于密码。

一个缺点：如果您的输入语料库不包含除字母以外的任何内容，您的输出短语也不包含任何内容，那么它们将无法通过大多数“安全”密码要求。您可能需要应用一些后处理来用一些字符替换数字或符号。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-12-10T01:48:19.243

编辑：回答后，我意识到这绝不是语音上令人难忘的。无论如何留下答案b / c我觉得很有趣。/编辑

旧线程，我知道...但值得一试。

1）我可能会建立你能积累的最大的字典。通过词性将它们排列成桶。

2）然后，构建一个可以组成多种句子的语法。句子的“类型”由词性的排列决定。

3）随机（或尽可能接近随机），选择一种句子。返回的是一个带有词性占位符的模式（nvn 将是名词-动词-名词）

3）在每个词性桶中随机选择单词作为占位符。填写它们。（上面的示例可能会变成 car-ate-bicycle 之类的东西。）

4）随机扫描每个字符，决定是否要将其替换为发音相似的字符（或字符集）或相似的字符。这是问题中最难的一步。

5) 结果密码类似于 kaR@tebyCICle

6）嘲笑上面看起来像“空手道自行车”的幽默结果

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-09T00:13:40.913

我真的**很想**看到有人同时使用像“”这样的控制字符`<Ctrl>+N`甚至像“”这样的组合字符来实现密码`A+C`。恕我直言，将其转换为某种二进制等效项将使密码要求更容易记住，输入更快，更难破解（要检查更多组合）。

# hosting - 为什么有些网站需要“www”？

> ID：624432
> 
> 赞同：18
> 
> 时间：2009-03-08T22:22:09.510
> 
> 标签：hosting, dns

为什么有些网站在地址的其余部分之前**需要**“www”，而另一些网站似乎使用“www”和没有它一样好？

是否有一些令人信服的理由让您将域名设置为这样工作？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-08T22:26:16.427

有几个原因，这里有一些：

**1) 这个人是故意这样想要的**

人们将 DNS 用于许多事情，而不仅仅是网络。他们可能需要一些其他对他们更重要的服务的主要 dns 名称。

**2) 配置错误的 dns 服务器**

如果有人在您的 dns 服务器上查找 www，则您的 DNS 服务器将需要解析它。

**3) 错误配置的网络服务器**

Web 服务器可以托管许多不同的网站。它通过 Host 标头区分您想要的站点。您需要指定要用于您的网站的主机名。

**4) 网站优化**

最好不要同时处理这两个，而是转发一个带有永久移动的 http 状态代码的。这样两个地址就不会竞争入站链接排名。

**5) 饼干**

避免浏览器未发回 cookie 的问题。这也可以通过永久移动的 http 状态码来解决。

**6) 客户端浏览器缓存**

如果您向 www 发出请求而另一个没有请求，则 Web 浏览器可能不会缓存图像。这也可以通过永久移动的 http 状态码来解决。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T22:45:40.077

某些站点需要它，因为该服务在该特定设置上配置为仅通过 www 子域提供 Web 内容。

这是正确的，因为 www 是“万维网”流量的常规子域。正如端口 80 是标准端口一样。显然还有其他标准服务和端口（端口 80 上的 http tcp/ip 没什么特别的！）

想象一下我的公司...

mx1.mycompany.com 25 smtp 等

ftp.mycompany.com 21 ftp

www.mycompany.com 80 http

不需要它的站点基本上具有 dns 转发或某种重定向。

例如

*.mycompany.com 80 http

据我所知，这样做的唯一原因是你喜欢它并且你愿意。

# logging - 我可以在运行时更改 Enterprise Library Logging 块的配置吗？

> ID：624436
> 
> 赞同：2
> 
> 时间：2009-03-08T22:23:34.407
> 
> 标签：logging, configuration-files, enterprise-library

如果不讨论 EntLib 日志记录块的优点或其他方面，有什么方法可以在运行时更改它的配置？

例如，我将块配置为将常规事件记录到平面文件，将关键事件记录到事件日志。
有什么方法可以更改它以将常规事件记录到控制台等，而无需重新启动我的应用程序？

**澄清：**我正在编写一个长时间运行的服务器应用程序。我希望能够临时增加各种日志记录组的详细程度/输出以进行诊断/故障排除，而无需重新启动应用程序。重新启动不是一种选择，因为这意味着生产中的“站点停机”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-23T11:09:34.310

其实很容易实现，只需按照以下步骤操作：

将企业库配置放在单独的文件中

```
<configuration>
  <configSections>
    <section name="enterpriseLibrary.ConfigurationSource" type="Microsoft.Practices.EnterpriseLibrary.Common.Configuration.ConfigurationSourceSection, Microsoft.Practices.EnterpriseLibrary.Common, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
  </configSections>
  <enterpriseLibrary.ConfigurationSource selectedSource="EntLib Config">
    <sources>
      <add name="EntLig Config" type="Microsoft.Practices.EnterpriseLibrary.Common.Configuration.FileConfigurationSource, Microsoft.Practices.EnterpriseLibrary.Common, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
          filePath="EntLib.config" />
    </sources>
  </enterpriseLibrary.ConfigurationSource>
</configuration> 
```

添加日志过滤器。您可以使用日志条目优先级或类别来过滤日志条目，因此在您的代码中您应该相应地设置优先级或类别。例如，你想给出非常重要的消息和低优先级的数字，比如 1，更详细的消息可能是 10。

```
<configuration>
  ...
  <loggingConfiguration name="Logging Application Block" tracingEnabled="true"
    defaultCategory="General" logWarningsWhenNoCategoriesMatch="true">
    ...
    <logFilters>
      <add minimumPriority="1" maximumPriority="10" type="Microsoft.Practices.EnterpriseLibrary.Logging.Filters.PriorityFilter, Microsoft.Practices.EnterpriseLibrary.Logging, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
        name="Priority Filter" />
    ...
  </loggingConfiguration>
</configuration> 
```

在运行时对 Enterprise Library 配置所做的任何更改都将被忽略 - 对 Logging Application Block 所做的更改除外。请参阅 MSDN 上的这篇文章：[在运行时更新配置设置](http://msdn.microsoft.com/en-us/library/dd203211.aspx)

我实现了一个简单的辅助方法来切换过滤器值：当我想要更详细的消息时，我允许通过增加最大优先级值来注册这些条目。同样，当我只想记录异常或其他非常重要的消息时，我将优先级范围设置为 0 到 1。

```
var path = System.IO.Path.Combine(Environment.CurrentDirectory, "EntLib.config");
var xd = XDocument.Load(path);

var x = (from z in xd.Root.Elements("loggingConfiguration").Elements("logFilters").Elements() where (z.Attribute("name").Value == "Priority Filter") select z).SingleOrDefault();
x.Attribute("minimumPriority").Value = 1; // Change this value...
x.Attribute("maximumPriority").Value = 5; // ... and this one to specify the range you want to log.

xd.Save(path); 
```

这将更改企业库日志记录功能，而无需重新加载您的服务，因为 web.config 永远不会被触及。唯一的缺点是您需要使用某种约定对日志条目进行优先级排序/分类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T01:52:35.823

我知道您可以打开 ConfigurationFileMap 并更改记录器的配置。但是，我不确定这是否会以您希望的方式解决问题，因为保存配置文件会重置应用程序，您必须将其设置回默认值。简单地连接控制台需要做很多工作。

由于日志记录块使用提供程序模型，您应该能够在运行时附加到它，但我不确定如何执行此操作。但是，您拥有 EntLib 的完整源代码，因此运行代码堆栈来解决这个问题不应该是一项主要的工作。您甚至不必通过代码进行反思来破解它。

我假设您的目标是实时观看应用程序？

# zend-framework - 使用 Zend 框架在 Zend_Form 中加载模型

> ID：624457
> 
> 赞同：4
> 
> 时间：2009-03-08T22:34:49.060
> 
> 标签：zend-framework, model, zend-form, loader

我正在尝试使用 Zend_Form 组件构建一个表单，但元素的数量会有所不同。每个 Zend_Form 元素的信息都存储在数据库中（名称、选项、验证器、过滤器等）。

我正在处理的应用程序包括构建包含不同数量问题的调查。每个问题都与不同的答案数组相关联。最终，我的目标是在服务器端动态地构建单选/复选框按钮数组。

我正在寻找一种生成表单的漂亮方法，但我不确定在表单中加载模型的最佳方法。是否应该将模型加载到控制器中，然后直接传递（不知何故，通过参数？）到表单，还是在 Form init() 方法中加载模型更好？放置逻辑的最佳位置在哪里，应该在表单类中，还是在控制器中，还是在模型中？

我的想法是在数据库中获取表单元素属性（名称、规则、过滤器等），然后迭代并最终呈现表单。您如何看待这种方法？最终，元素将被动态添加（客户端），这一次，使用 AJAX 和 JavaScript 库（如 jQuery）。

以下是我通过谷歌找到的几个有用的链接，但我认为它们都回答了一个与我的问题略有不同的问题：

在构建动态表单时，服务器端：

*   [http://framework.zend.com/wiki/display/ZFPROP/Zend_Form+generation+from+models+-+Jani+Hartikainen](http://framework.zend.com/wiki/display/ZFPROP/Zend_Form+generation+from+models+-+Jani+Hartikainen)
*   [http://weierophinney.net/matthew/archives/200-Using-Zend_Form-in-Your-Models.html](http://weierophinney.net/matthew/archives/200-Using-Zend_Form-in-Your-Models.html)
*   [http://codeutopia.net/blog/2009/01/07/another-idea-for-using-models-with-forms/](http://codeutopia.net/blog/2009/01/07/another-idea-for-using-models-with-forms/)

在使用 AJAX 处理构建客户端的动态表单时：

*   [http://www.jeremykendall.net/2009/01/19/dynamically-adding-elements-to-zend-form/](http://www.jeremykendall.net/2009/01/19/dynamically-adding-elements-to-zend-form/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T22:52:55.867

**我想我找到了一个可能的解决方案，它涉及将Zend Form 元素**数组传递给**Zend Form::__construct()**方法。构造函数采用一组选项，其中一个称为“**元素**”。查看 Zend Framework 库中的源代码。

我在控制器中编写了一个新的私有方法，称为 buildSurveyForm()。注意：作为参数传递的对象是由一个带有六个 JOIN 语句的巨大 SQL 查询构建的，从数据库中的几个表（调查、问题、答案等）中获取数据。此类的公共属性之一由一系列问题组成，存储为对象（也具有公共方法/属性等）。答案也一样。用于构建这些类的代码非常简单，并且不在此处讨论。

这是调查控制器中的代码。我复制/粘贴和编辑/删除了几行以使其更清晰：

```
private function buildSurveyForm(MyApp_Object_Survey $survey)
{
    foreach ($survey->questions as $question)
    {
        $element = new Zend_Form_Element_MultiCheckbox($question->order);
        $element->addMultiOptions($question->getAnswersLabels());
        $element->setName($question->order);
        $element->setLabel($question->title);

        $elements[] = $element;
    }

    // Here's the trick :
    $formOptions = array('elements' => $elements);

    $surveyForm = new MyApp_Survey_Form($formOptions);

    $urlHelper = $this->_helper->getHelper('url');
    $surveyForm->setAction($urlHelper->url(array(
            'controller' => 'survey',
            'action' => 'vote'),
        'default'
    ));
    $surveyForm->setMethod('post');

    $this->_forms['survey'] = $surveyForm;

    return $this->_forms['survey'];
} 
```

**MyApp 调查表单**类仅在init() 方法中包含一个提交按钮。使用上面的代码动态生成的元素被添加到这个提交按钮之前（这是出乎意料的，但很有用）。这个类只是简单地扩展了 Zend_Form。

然后，在调查控制器/视图操作中：

```
public function viewAction()
{
    $surveyModel =    $this->_model['survey'];
    $survey =        $surveyModel->getFullSurvey($this->_getParam('id'));
    $survey =        new MyApp_Object_Survey($survey);
    // Calls above private method :
    $surveyForm =    $this->buildSurveyForm($survey);

    $this->view->assign(array(
         'surveyForm' => $surveyForm,
    ));
} 
```

向表单元素添加过滤器、验证器和装饰器现在很简单。我的建议有点脏，但我认为它可以完成工作。如果我发现更优雅的东西，我会添加一个新的提案。随意发布不同的答案/解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T22:56:05.840

你可以扩展 Zend_Form。

Zend 形式不是逻辑的好地方，只有形式表示。

因此，使用控制器中的模型加载所有需要的元素，并将它们作为参数传递给构造器中的表单。

# java - 扩展 ByteBuffer 类

> ID：624458
> 
> 赞同：17
> 
> 时间：2009-03-08T22:34:51.023
> 
> 标签：java, nio, bytebuffer

有没有办法创建扩展 ByteBuffer 类的类？

ByteBuffer 中的一些抽象方法是包私有的，如果我创建包 java.nio，则会引发安全异常。

出于性能原因，我想这样做——例如 getInt 有大约 10 个方法调用，以及相当多的 if 方法。即使保留所有检查，并且仅内联方法调用并删除大/小端检查，我创建的测试表明它可以快 4 倍左右。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2011-05-29T10:26:01.723

你不能扩展 ByteBuffer 并感谢上帝。

你不能扩展 b/c 没有受保护的 c-tors。为什么要感谢上帝？好吧，只有 2 个真正的子类可以确保 JVM 可以大量优化任何涉及 ByteBuffer 的代码*。*

最后，如果您需要真正扩展类，请编辑字节码，只需将受保护的属性 c-tor 和 public 属性添加到 DirectByteBuffer（和 DirectByteBufferR）。*扩展 HeapBuffer 没有任何用处，因为无论如何您都可以访问底层数组*

在那里使用`-Xbootclasspath/p`并添加您自己的类，在您需要的包中扩展（在 java.nio 之外）。这就是它的完成方式。

另一种方法是使用 sun.misc.Unsafe 并在`address()`.

> 出于性能原因，我想这样做——例如 getInt 有大约 10 个方法调用，以及相当多的 if 方法。即使保留所有检查，并且仅内联方法调用并删除大/小端检查，我创建的测试表明它可以快 4 倍左右。

现在好的部分，使用 gdb 并检查真正生成的机器代码，您会惊讶地发现有多少检查会被删除。

我无法想象一个人为什么要扩展课程。它们的存在是为了实现良好的性能，而不仅仅是 OO 多态执行。

* * *

编辑：

### 如何声明任何类并绕过 Java 验证器

关于 Unsafe：Unsafe 有 2 个绕过验证器的方法，如果你有一个扩展 ByteBuffer 的类，你可以调用其中任何一个。您需要一些具有公共访问权限和受保护的 c-tor 的 ByteBuffer 版本（但这非常简单），仅供编译器使用。方法如下。您可以自行承担使用它们的风险。像这样声明类之后，您甚至可以使用 new 关键字来使用它（前提是有合适的 c-tor）

```
public native Class defineClass(String name, byte[] b, int off, int len, ClassLoader loader, ProtectionDomain protectionDomain);    
public native Class defineClass(String name, byte[] b, int off, int len); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-08T23:04:06.540

您可以通过使用反射来忽略保护级别，但这在很大程度上违背了性能目标。

您不能在 java.nio 包中创建类 - 这样做（并以任何方式分发结果）违反了 Sun 的 Java 许可证，理论上可能会让您陷入法律麻烦。

我不认为有一种方法可以在不使用原生的情况下做你想做的事情——但我也怀疑你屈服于过早优化的诱惑。假设您的测试是正确的（哪些微基准测试通常不正确）：您真的确定对 ByteBuffer 的访问将成为您实际应用程序中的性能瓶颈吗？当您的应用程序只花费 5% 的时间和 95% 的时间处理它获取的数据时，ByteBuffer.get() 是否可以快 4 倍有点无关紧要。

为了（可能纯粹是理论上的）性能而想要绕过所有检查听起来不是一个好主意。性能调优的基本规则是“首先让它正常工作，然后让它工作得更快”。

**编辑：**如果，如评论中所述，应用程序确实在 ByteBuffer 方法中花费了 20-40% 的时间并且测试是正确的，这意味着 15-30% 的加速潜力 - 显着，但 IMO 不值得开始使用 JNI 或弄乱 API 源。我会先尝试用尽所有其他选项：

*   你在使用 -server 虚拟机吗？
*   是否可以修改应用程序以减少对 ByteBuffer 的调用，而不是尝试加速它所做的调用？
*   使用分析器查看呼叫的来源——也许有些是完全没有必要的
*   也许可以修改算法，或者您可以使用某种缓存

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T23:03:06.777

ByteBuffer 是抽象的，所以，是的，你可以扩展它......但我认为你想要做的是扩展你可能无法实际实例化的类。也可能是被实例化的特定方法会覆盖该方法以比 ByteBuffer 中的方法更有效。

我还要说，对于所有需要的东西，你可能总体上是错误的——也许它不是为了你正在测试的东西，但很可能代码在那里是有原因的（也许在其他平台上）。

如果您确实认为自己是正确的，请打开一个[错误](http://bugs.sun.com/)并查看他们要说的内容。

如果要添加到 nio 包中，可以尝试在调用 Java 时设置引导类路径。它应该让你把你的类放在 rt.jar 之前。键入 java -X 以查看如何执行此操作，您需要 -Xbootclasspath/p 开关。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-01T06:11:39.537

[Java 代理](http://download.java.net/jdk7/docs/api/java/lang/instrument/Instrumentation.html)可以修改 ByteBuffer的字节码并更改构造函数的访问修饰符。当然，您需要在 JVM 上安装代理，并且您仍然需要编译才能编译您的子类。如果您正在考虑进行此类优化，那么您必须做好准备！

我从未尝试过如此低级的操作。希望 JVM 在您的代理可以挂接到它之前不需要 ByteBuffer。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-29T13:12:07.793

获取 Unsafe 实例的最简单方法是通过反射。但是，如果您无法使用反射，您可以创建另一个实例。您可以通过 JNI 执行此操作。

我尝试在字节码中创建一个实例而不调用构造函数，从而允许您创建一个没有可访问构造函数的对象实例。但是，这个 id 不起作用，因为我得到了字节码的 VerifyError。该对象必须有一个对其调用的构造函数。

* * *

我所做的是有一个 ParseBuffer，它包装了一个直接的 ByteBuffer。我使用反射来获取`Unsafe`参考和`address`. 为了避免耗尽缓冲区的末尾并杀死 JVM，我分配了比我需要的更多的页面，只要它们不被触及，就不会为应用程序分配物理内存。这意味着我的边界检查要少得多，只检查关键点。

使用 OpenJDK 的调试版本，您可以看到 Unsafe get/put 方法变成了一条机器代码指令。但是，这并非在所有 JVM 中都可用，并且可能不会在所有平台上获得相同的改进。

使用这种方法，我会说您可以减少大约 40% 的时间，但会面临普通 Java 代码所没有的风险，即您可以杀死 JVM。与使用普通直接 ByteBuffer 相比，我拥有的用例是一个对象创建免费的 XML 解析器和使用 Unsafe 包含的数据的处理器。我在 XML 解析器中使用的技巧之一是 getShort() 和 getInt() 一次检查多个字节，而不是一次检查每个字节。

对 Unsafe 类使用反射是一次开销。一旦有了 Unsafe 实例，就没有开销了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-05-27T20:03:26.420

> +50 赏金以绕过访问限制（tt 不能单独使用反射来完成。也许有一种使用 sun.misc.Unsafe 等的方法？）

答案是：没有办法绕过 Java 中的所有访问限制。

*   `sun.misc.Unsafe`在安全经理的授权下工作，因此无济于事
*   就像萨纳姆所说：

> ByteBuffer 有包私有抽象 _set 和 _get 方法，所以你不能覆盖它。而且所有的构造函数都是包私有的，所以你不能调用它们。

*   反射允许你绕过很多东西，但前提是安全管理器允许。在许多情况下，您无法控制安全管理器，它是强加给您的。如果您的代码依赖于对安全管理器的摆弄，那么它不会在所有情况下都是“可移植的”或可执行的，可以这么说。

问题的底线是试图覆盖字节缓冲区并不能解决问题。

除了使用您需要的方法自己实现一个类之外，别无选择。将方法设为最终方法将有助于编译器执行优化（减少为运行时多态性和内联生成代码的需要）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-06-01T17:01:05.177

**我正在回答您想要回答的问题，而不是您提出的问题。你真正的问题是“我怎样才能让它更快？” 答案是“一次处理一个数组的整数，而不是单独处理”。**

如果瓶颈确实是 ByteBuffer.getInt() 或 ByteBuffer.getInt(location)，那么您不需要扩展该类，您可以使用预先存在的 IntBuffer 类来批量抓取数据以进行更高效的处理。

```
int totalLength = numberOfIntsInBuffer;
ByteBuffer myBuffer = whateverMyBufferIsCalled;
int[] block = new int[1024];
IntBuffer intBuff = myBuffer.asIntBuffer();
int partialLength = totalLength/1024;

//Handle big blocks of 1024 ints at a time
try{
  for (int i = 0; i < partialLength; i++) {
     intBuff.get(block);
     // Do processing on ints, w00t!
  }

  partialLength = totalLength % 1024; //modulo to get remainder
  if (partialLength > 0) {
    intBuff.get(block,0,partialLength);
    //Do final processing on ints
  }
} catch BufferUnderFlowException bufo {
   //well, dang!
} 
```

这比一次获得一个 int 快得多。通过消除边界检查和 ByteBuffer 可能抛出的异常，遍历已设置且已知良好边界的 int[] 数组还将使您的代码 JIT 更加紧密。

如果您需要进一步的性能，您可以调整代码，或滚动您自己的大小优化 byte[] 到 int[] 转换代码。使用它来代替具有部分循环展开的 IntBuffer 方法，我能够获得一些性能改进......但无论如何都不建议这样做。

# c# - .NET 应用程序负载优化

> ID：624459
> 
> 赞同：1
> 
> 时间：2009-03-08T22:34:57.047
> 
> 标签：c#, .net, cold-start

使用 .NET 为我的应用程序本身提供了良好的性能，但我的应用程序的初始加载时间非常长。其中很多用于装载难以测量的组件。

**是否有任何优化可以应用于我的程序集，以使它们在不涉及 GAC 或 Ngen 的情况下更快地加载，而这些优化不适用于 ClickOnce？**

这是一个 WinForms 2.0 项目。我可以将它升级到 3.5，但这限制了我的用户群。我的机器上安装了 .NET Framework 3.5。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T23:23:01.050

我创建了一个非常小的 .exe，它会尽快显示启动画面。之后我初始化一切。

JIT 编译器加载从正在被 jit 处理的方法调用的模块。因此，您必须注意显示初始屏幕的方法不会调用您不想加载的模块中的方法。

例子：

```
internal sealed class Startup {

    // Call Startup.Run() from Program.Main to start the application
    internal void Run() {
        this.ShowSplash();
        this.ContinueStartup();
    }

    private void ShowSplash() {
        _splash = new Splash();
        _splash.Show();
        Application.DoEvents();
    }

    [MethodImpl(MethodImplOptions.NoInlining)]
    private void ContinueStartup() {
        // Do the startup here
    }
} 
```

需要 [MethodImpl(MethodImplOptions.NoInlining)] 以便 jit 不会内联 ContinueStartup() 方法，因为这会导致模块过早加载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T22:41:13.350

您可以使用 ILMerge 将所有程序集合并到一个文件中。将一个文件读入内存比读 10 个文件要快。尽管我怀疑您会在那里看到加载速度的真正提高。

您还可以删除对其他程序集的所有引用，将 ui 加载给用户，当他使用 UI（键入或其他）时，使用 Assembly.Load 预加载所有需要的程序集，使用反射和存储获取所有需要的函数指针他们在内部成员中。这样应用程序将加载得更快。但我不认为任何理智的人会做这样的优化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T07:33:30.667

你能描述一下你有多少个组件吗？

.NET 在您需要时即时加载程序集。您可以决定将您的应用程序拆分为多个程序集。程序集必须通过以下方式进行划分：部署策略、安全性和性能。大多数应用程序分为 3 层结构（UI、业务、数据）。

# iphone - 有没有关于将 iPhone 应用程序链接到数据库的好教程？

> ID：624460
> 
> 赞同：2
> 
> 时间：2009-03-08T22:35:12.710
> 
> 标签：iphone, mysql

我已经构建了一个需要从服务器提取数据的 iPhone 应用程序。首先我需要弄清楚我需要什么样的服务器。我对 MySQL 有点熟悉，但想知道是否有人对后端有更好的建议。我的应用程序将有两个表，需要由驻留在服务器上的数据填充。此外，用户可以向该数据库提交数据，该数据库依次填充前面提到的表格。

如果您有任何提示或教程、代码片段等，我们将不胜感激！

*编辑：我应该提到这是一个远程数据库

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T23:28:53.563

好吧，如果它是您考虑的远程服务器，那么您应该考虑实现某种服务架构，例如基于 SOAP 或 REST 的 Web 服务。

如果数据保留在 iPhone 上，那么一定要使用 SQLite，因为它既快速又轻量。

我建议先从 SQLite 和本地数据开始。然后，当您完成主程序逻辑、流程和 UI 时，将 SQLite 替换为 Web 服务调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T01:04:38.340

您的数据库听起来很简单，只有两个表。也许您甚至不需要 SQL 数据库。也许 Berkeley DB 就足够了。它具有原子提交、事务、回滚等。但是，您将数据存储为键值对。

但是我不确定您是否可以将其用作服务器。您可以考虑通过远程对象之类的方式访问数据。这在 Cocoa 中很容易完成。您可以在您的服务器上构建一个伯克利数据库，将数据作为您的 iPhone 应用程序连接到的分布式对象托管。

# winforms - 在应用程序上向用户显示屏幕的最佳方式

> ID：624463
> 
> 赞同：1
> 
> 时间：2009-03-08T22:36:18.667
> 
> 标签：winforms, user-interface, user-friendly, screens

我正在开发一个 Winforms 应用程序，该应用程序已运行多年，带有资源管理器视图（左树视图，右屏幕）。我的意思是：

*   所有屏幕都有一个层次结构
*   TreeView 上的所有节点都只有一个屏幕相关。
*   当树视图上的节点被选中时，屏幕会被激活。

优点之一是用户具有有序的结构，而不便之处之一是数百个屏幕使用户感到困惑。

我看到了其他选择：使用经典菜单、使用选项卡或混合使用所有内容。

对于以用户友好的方式向用户显示大量屏幕的好方法有什么建议吗？

**更新：**我被“很多屏幕”改变了“数百个屏幕”。最重要的不是所有时间都显示，而是用户可以轻松找到他们需要的东西。

**更新 2：**在此提案中，用户一次只能看到一个屏幕。

**Update3：**我说的是*处理*多个屏幕而不显示多个屏幕。没有 MDI，**只有一次准时**。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T23:22:20.880

我曾经使用过类似的其他应用程序，主要问题是试图找到您想要的确切屏幕。这个问题有两种常见的解决方案，快捷代码和收藏夹菜单。

使用快捷代码，为每个屏幕分配一个短代码（5 或 6 个字符）。然后，用户将此快捷方式代码输入到文本框中，然后该文本框将跳转到正确的屏幕。用户将创建自己的常用代码列表。

对于收藏夹菜单，允许用户能够以他们想要的结构创建自己的菜单列表。如果他们自己组织，他们会发现事情更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T23:10:15.650

为什么你需要一次显示这么多单独的屏幕？为什么不只显示当前选定节点的屏幕，为什么一次都需要？

如果是所有表格数据，可能一次消耗太多，如果是图形数据，不能合并吗？

一次显示所有数据可能有正当理由，也可能没有，很难从您的问题中提供的内容中分辨出来。话虽如此，最好保持简单而不是让用户过载。MDI 应用程序从来都不容易使用。

选项卡可能适用于一小部分项目，但对于数百个项目仍然不是一个好的 UI。

如果您一次只显示一个元素，在树节点上的数百个可能中，那很好。当用户在节点中移动时，一次显示的一个屏幕将与所选项目相关联。考虑一下 Outlook 方法，其中在左窗格中选择的内容以适合所显示数据的任何形式显示在右窗格中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T23:18:07.847

你考虑过Office Ribbon吗？

功能区在如何显示和组织功能方面为您提供了很大的灵活性，并且非常直观。

[这是关于功能区](http://office.microsoft.com/en-us/help/HA100898951033.aspx)的一个很好的链接，也在[这里](http://office.microsoft.com/en-us/products/HA101679411033.aspx)

要使用功能区，您必须从 Microsoft 获得许可。你可以在网上做。

为用户提供 ketboard shotcuts 通常也是一件好事。

我还想在菜单上为用户提供一个“自动完成”字段，以便他们可以按名称（或其中的一部分）找到功能，并能够直接导航到他们想去的地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T23:18:58.813

我一般认为树是一个坏主意，特别是如果您的“层次结构”具有较小的固定深度。

如果您的固定深度较小，请考虑将树替换为列表。列表顶部可以是基于节点级属性进行过滤的下拉列表。它将占用更少的屏幕空间，因为它只是垂直的，没有水平分量。

单击一个项目可以在视图中显示它（就像当前一样），但允许用户双击多个可以启动更多窗口的项目或与现有显示的项目平铺可能是一个好主意。（我假设目前，用户在任何给定窗口中一次只能看到一个详细视图。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T01:20:48.090

实际上，很难超越用于组织大量项目的层次结构。我不赞成为大量窗口使用经典的下拉菜单，因为它比在树中更难跟踪你的位置（例如，一棵树可以让你同时查看多个分支）。但这里有一些选择：

我不清楚你是如何得到这么多窗口的，但它可能来自类、视图、内容和细节的组合，或者它可能来自于使用以任务为中心的 UI 结构来处理过于复杂的事情（I'更多信息[请访问 http://www.zuschlogin.com/?p=3](http://www.zuschlogin.com/?p=3)）。对于复杂的应用程序，您希望每个重要的数据对象类别（例如，发票、员工）都有一个不同的主窗口。这些都列在一个菜单上，通常很少（15 个或更少）可以是单个非级联下拉菜单。每个窗口的内容由单独的菜单设置，可能由打开对话框的菜单项设置，该对话框可能包括列表框（如打开对话框）或其他用于查询/搜索的控件。每个窗口的“视图”（如何显示数据对象，例如表格与表格）由“视图”菜单中的菜单项设置。窗口中任何给定对象的详细信息都可以以主从关系的形式显示在窗口内的单独窗格中，实质上是将数据对象转换为详细信息菜单。单个窗口可以有多个详细信息窗格供用户打开和关闭以选择要显示的特定详细信息。选项卡也可以在单个窗格中使用以适应内容的细分。

您说一次显示所有窗口选项并不重要，但通常一次显示所有选项可以让用户最容易找到他们需要的内容。也许您需要一个“主”窗口，以组织、标记和分离的类别列出所有其他窗口。如果您的用户选择一个窗口然后在大部分会话中坚持使用它，这将比树更容易使用。如果在整个会话期间经常选择窗口，则您的树会更好，因为访问主窗口会产生开销。如果所有窗口/选项不适合单个主窗口，则仅显示主窗口上每个类别的选定公共窗口，并提供按钮或链接以显示详尽列表。

如果您正在谈论 100 多个窗口，也许您应该有搜索，也许除了基于菜单的浏览方法来访问一个窗口。

In any case, providing easy access to the few most commonly used windows is a good idea. Such windows can be explicitly selected by the designer, based on user research, or selected by the the user (favorites), but it also typically works well to make it automatic with an algorithm that uses some combination of frequency and recency of use.

# c# - 仅为公共成员提取 xml 注释

> ID：624466
> 
> 赞同：20
> 
> 时间：2009-03-08T22:39:02.433
> 
> 标签：c#, .net, xml-documentation

我正在使用 xml 注释来记录我的组件的公共以及内部和私有成员。我想将生成的文档 xml 文件与组件程序集打包在一起，以便在最终产品中启用“丰富”（例如，带有方法、异常和参数描述）Visual Studio Intellisense。问题在于 C# 编译器为所有内容（包括内部类、方法、内部枚举的私有字段等）创建文档条目，并且似乎没有切换到“仅公共成员”模式。

现在我不想检查超过 50 个文件，每个文件都有 XX 方法，并删除私人和内部成员的所有评论。即使我这样做了，我也可能不会在自动生成的资源文件上取得太大的成功，因为这些强类型资源类是自动注释的并且是非公开的。

我的问题是：是否有一些我忽略的选项/标志？如果不是，是否有一些工具可以帮助将公共成员与其他成员区分开来（在我开始编写代码之前）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-06-01T19:24:53.653

SandCastle Help File Builder 有一个选项可以重新创建 xml 文件，其中仅包含为方法、属性等配置的访问模式...

唯一的“缺点”是您必须生成文档。

## 编辑

因为很久以前我忘记了我向 SHFB 添加了一个“组件”来生成 XML。

好消息是这个组件包含在 SHFB 中。

您必须将“智能感知组件”添加到 SHFB 项目。然后它将根据配置的 SHFB 项目生成 XML。

更多信息：[SHFB 中的 Intellisense 组件](http://www.ewoodruff.us/shfbdocs/html/5d546511-6aec-455a-ba09-9daffb124c6d.htm)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-06-01T04:13:06.383

[eazfuscator](http://www.foss.kharkov.ua/g1/projects/eazfuscator/dotnet/Default.aspx)内部有一个工具可以删除非公开文档。[你可以在这里](http://eazfuscator.blogspot.com/2010/10/xml-documentation-filter.html)看到一个例子

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-03T15:44:40.037

我对此进行了一些思考，并决定改变解决这个特定问题的方式。而不是在尝试解析 XML 文档表示法的程序集中查找类型/成员。我决定简单地为公共 API 构建一个字符串集（XML 文档表示法），然后可以使用它来测试成员是否不是公共的。

这真的很简单。向 发送程序集，`XmlDocumentationStringSet`它将构建公共 API 的字符串集并删除不公开的元素。

```
static void Main(string[] args)
{
    var el = XElement.Load("ConsoleApplication18.XML");

    // obviously, improve this if necessary (might not work like this if DLL isn't already loaded)
    // you can use file paths
    var assemblyName = el.Descendants("assembly").FirstOrDefault();
    var assembly = Assembly.ReflectionOnlyLoad(assemblyName.Value);

    var stringSet = new XmlDocumentationStringSet(assembly);

    foreach (var member in el.Descendants("member").ToList()) // .ToList enables removing while traversing
    {
        var attr = member.Attribute("name");
        if (attr == null)
        {
            continue;
        }
        if (!stringSet.Contains(attr.Value))
        {
            member.Remove();
        }
    }

    el.Save("ConsoleApplication18-public.XML");
} 
```

这是构建 XML 文档名称的类（它有点大，但我想我还是在这里发布了整个源代码）：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text;

namespace ConsoleApplication18
{
    public class XmlDocumentationStringSet : IEnumerable<string>
    {
        private HashSet<string> stringSet = new HashSet<string>(StringComparer.Ordinal);

        public XmlDocumentationStringSet(Assembly assembly)
        {
            AddRange(assembly.GetExportedTypes());
        }

        public bool Contains(string name)
        {
            return stringSet.Contains(name);
        }

        /// <summary>
        /// Heelloasdasdasd
        /// </summary>
        /// <param name="types"></param>
        public void AddRange(IEnumerable<Type> types)
        {
            foreach (var type in types)
            {
                Add(type);
            }
        }

        public void Add(Type type)
        {
            // Public API only
            if (!type.IsVisible)
            {
                return;
            }
            var members = type.GetMembers(BindingFlags.Instance | BindingFlags.Static | BindingFlags.NonPublic | BindingFlags.Public);
            foreach (var member in members)
            {
                Add(type, member);
            }
        }

        StringBuilder sb = new StringBuilder();

        private void Add(Type type, MemberInfo member)
        {
            Type nestedType = null;

            sb.Length = 0;

            switch (member.MemberType)
            {
                case MemberTypes.Constructor:
                    sb.Append("M:");
                    AppendConstructor(sb, (ConstructorInfo)member);
                    break;
                case MemberTypes.Event:
                    sb.Append("E:");
                    AppendEvent(sb, (EventInfo)member);
                    break;
                case MemberTypes.Field:
                    sb.Append("F:");
                    AppendField(sb, (FieldInfo)member);
                    break;
                case MemberTypes.Method:
                    sb.Append("M:");
                    AppendMethod(sb, (MethodInfo)member);
                    break;
                case MemberTypes.NestedType:
                    nestedType = (Type)member;
                    if (IsVisible(nestedType))
                    {
                        sb.Append("T:");
                        AppendNestedType(sb, (Type)member);
                    }
                    break;
                case MemberTypes.Property:
                    sb.Append("P:");
                    AppendProperty(sb, (PropertyInfo)member);
                    break;
            }

            if (sb.Length > 0)
            {
                stringSet.Add(sb.ToString());
            }

            if (nestedType != null)
            {
                Add(nestedType);
            }
        }

        private bool IsVisible(Type nestedType)
        {
            return nestedType.IsVisible;
        }

        private void AppendProperty(StringBuilder sb, PropertyInfo propertyInfo)
        {
            if (!IsVisible(propertyInfo))
            {
                sb.Length = 0;
                return;
            }
            AppendType(sb, propertyInfo.DeclaringType);
            sb.Append('.').Append(propertyInfo.Name);
        }

        private bool IsVisible(PropertyInfo propertyInfo)
        {
            var getter = propertyInfo.GetGetMethod();
            var setter = propertyInfo.GetSetMethod();
            return (getter != null && IsVisible(getter)) || (setter != null && IsVisible(setter));
        }

        private void AppendNestedType(StringBuilder sb, Type type)
        {
            AppendType(sb, type.DeclaringType);
        }

        private void AppendMethod(StringBuilder sb, MethodInfo methodInfo)
        {
            if (!IsVisible(methodInfo) || (methodInfo.IsHideBySig && methodInfo.IsSpecialName))
            {
                sb.Length = 0;
                return;
            }
            AppendType(sb, methodInfo.DeclaringType);
            sb.Append('.').Append(methodInfo.Name);
            AppendParameters(sb, methodInfo.GetParameters());
        }

        private bool IsVisible(MethodInfo methodInfo)
        {
            return methodInfo.IsFamily || methodInfo.IsPublic;
        }

        private void AppendParameters(StringBuilder sb, ParameterInfo[] parameterInfo)
        {
            if (parameterInfo.Length == 0)
            {
                return;
            }
            sb.Append('(');
            for (int i = 0; i < parameterInfo.Length; i++)
            {
                if (i > 0)
                {
                    sb.Append(',');
                }
                var p = parameterInfo[i];
                AppendType(sb, p.ParameterType);
            }
            sb.Append(')');
        }

        private void AppendField(StringBuilder sb, FieldInfo fieldInfo)
        {
            if (!IsVisible(fieldInfo))
            {
                sb.Length = 0;
                return;
            }
            AppendType(sb, fieldInfo.DeclaringType);
            sb.Append('.').Append(fieldInfo.Name);
        }

        private bool IsVisible(FieldInfo fieldInfo)
        {
            return fieldInfo.IsFamily || fieldInfo.IsPublic;
        }

        private void AppendEvent(StringBuilder sb, EventInfo eventInfo)
        {
            if (!IsVisible(eventInfo))
            {
                sb.Length = 0;
                return;
            }
            AppendType(sb, eventInfo.DeclaringType);
            sb.Append('.').Append(eventInfo.Name);
        }

        private bool IsVisible(EventInfo eventInfo)
        {
            return true; // hu?
        }

        private void AppendConstructor(StringBuilder sb, ConstructorInfo constructorInfo)
        {
            if (!IsVisible(constructorInfo))
            {
                sb.Length = 0;
                return;
            }
            AppendType(sb, constructorInfo.DeclaringType);
            sb.Append('.').Append("#ctor");
            AppendParameters(sb, constructorInfo.GetParameters());
        }

        private bool IsVisible(ConstructorInfo constructorInfo)
        {
            return constructorInfo.IsFamily || constructorInfo.IsPublic;
        }

        private void AppendType(StringBuilder sb, Type type)
        {
            if (type.DeclaringType != null)
            {
                AppendType(sb, type.DeclaringType);
                sb.Append('.');
            }
            else if (!string.IsNullOrEmpty(type.Namespace))
            {
                sb.Append(type.Namespace);
                sb.Append('.');
            }
            sb.Append(type.Name);
            if (type.IsGenericType && !type.IsGenericTypeDefinition)
            {
                // Remove "`1" suffix from type name
                while (char.IsDigit(sb[sb.Length - 1]))
                    sb.Length--;
                sb.Length--;
                {
                    var args = type.GetGenericArguments();
                    sb.Append('{');
                    for (int i = 0; i < args.Length; i++)
                    {
                        if (i > 0)
                        {
                            sb.Append(',');
                        }
                        AppendType(sb, args[i]);
                    }
                    sb.Append('}');
                }
            }
        }

        public IEnumerator<string> GetEnumerator()
        {
            return stringSet.GetEnumerator();
        }

        System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }
    }
} 
```

哦，我还没有弄清楚如何处理事件，在这个例子中它们总是可见的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-10T10:40:18.640

@约翰·莱德格伦

我有同样的要求，我找到了你的代码缺失部分的答案。一个事件有 2 个方法，添加和删除，如果其中任何一个是公共的，则被认为是公共的。所以它会是这样的：

```
private bool IsVisible(EventInfo eventInfo)
{
    return eventInfo.GetAddMethod(false) != null
        || eventInfo.GetRemoveMethod(false) != null;
} 
```

虽然我想不出任何理由为什么一个会公开而不是另一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T22:41:56.093

您使用什么工具来生成文档？我使用 Sandcastle，这使您可以选择通过可访问性包含的成员。

一般来说，似乎期望 XML 将包含所有**可能**需要的信息，并由处理工具从中选择所需的信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-04T07:45:17.010

我面临着同样的问题。SHFB 慢得要命，因为我们有另一个文档代码库，我们不需要它来为我们生成文档。

我最终使用[XMLStarlet](http://xmlstar.sourceforge.net/)加上一个单独的内部类命名空间。例如，我所有的内部类都将驻留在`MyCompany.MyProduct.Internal`. 然后我可以使用一个简单的命令

```
xml ed -L -d "//member[contains(@name, 'MyCompany.MyProduct.Internal')]" MyProduct.xml 
```

清理 XML。这当然不是万无一失的——它不包括公共类中的内部成员，并且确实需要一些纪律来记住将内部类放入内部。但这是对我有用的最干净、侵入性最小的方法。它也是一个独立的 EXE 文件，很容易签入构建服务器，毫不费力。

# java - 您会使用 AOP 进行数据库事务管理吗？

> ID：624468
> 
> 赞同：3
> 
> 时间：2009-03-08T22:40:38.407
> 
> 标签：java, database, spring, transactions, aop

不久前，我编写了一个应用程序，它使用[Spring AOP](http://static.springframework.org/spring/docs/2.5.x/reference/aop.html)来定义哪些方法是事务性的。我现在正在重新考虑这是一个多么棒的主意。在一次小的重构（更改方法签名等）之后，我被击中了几次，这当然不会变得明显，直到实际出现问题（并且我有一个逻辑上不一致的数据库）。

所以我对一些事情感兴趣：

1.  其他人是否决定恢复到显式事务管理（例如通过`@Transactional`注释）？
2.  我可以在构建过程中使用有用的工具来帮助确定是否有任何东西被“破坏”了吗？
3.  如果人们使用 AOP 来管理事务，他们会采取哪些步骤来避免我所犯的错误？

我正在使用 IntelliJ IDEA，它允许您浏览装饰方法，并将重构 Spring`XML`配置以及方法名称更改，但这并不总是足够的（例如，将参数添加到错误位置的方法会影响方面是否触发）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T23:02:25.403

我目前在我从事的两个 Java 项目中使用声明式事务管理，指定哪些方法需要带有`@Transactional`注释的事务范围。在我看来，它是灵活性和健壮性的完美结合：您可以通过简单的文本搜索查看哪些方法具有事务行为，如果需要可以手动调整隔离和传播属性，并且额外的输入量实际上是可以忽略的.

在其中一个项目中，我通过方面实现了安全/日志记录，并且在重命名方法或更改签名时偶尔会遇到与您相同的障碍。在最坏的情况下，我丢失了一些用户访问合约的日志数据，并且在一个版本中，一些用户角色无法访问所有应用程序功能。没什么大不了的，但是，就数据库事务而言，我认为这根本不值得，我最好`@Transactional`自己打字。无论如何，春天是最困难的部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T00:25:51.663

关于（1）：我发现@Transactonal 在过去几年从事的所有项目中都是一个更实用的解决方案。然而，在一些非常特殊的情况下，我还必须使用 Spring AOP 来允许使用多个 JDBC 连接/TransactionManager，因为@Transaction 绑定到单个事务管理器。

关于（2）：话虽如此，在混合场景中，我做了很多自动化测试来查找可能损坏的代码。我使用 Spring 的 AbstractTransactionalJUnit4SpringContextTests / AbstractTransactionalTestNGSpringContextTests 来创建我的测试。到目前为止，这是一个非常有效的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T00:05:08.360

我更倾向于纯粹主义者，但我尝试在数据库本身内部保留任何和所有事务管理，而不是简单的自动提交。大多数数据库都非常擅长处理事务管理，毕竟，它是数据库要做的关键组件之一。

# unit-testing - 另一个关于衡量开发人员绩效的问题

> ID：624482
> 
> 赞同：-1
> 
> 时间：2009-03-08T22:47:18.530
> 
> 标签：unit-testing, measurement

我知道关于衡量开发人员绩效的问题已经被问死了，但请多多包涵。我知道关于如何无法衡量开发人员绩效的古老争论，但现实是，在我们公司，“需要”以一种或另一种方式做到这一点。

我在一家相对较小的公司工作（就开发人员而言很小），管理层认为有必要根据“在第一次迭代时通过测试 (QA) 的功能”来衡量开发人员的绩效。

我们以某种方式设法让他们相信，由于各种原因，这是一个坏主意，而是通过将代码置于所有单元测试都通过的测试中来衡量开发人员。由于在我们的团队中，以前没有“要求”本身开发单元测试，我们认为这是一个正式确定开发单元测试需求的机会——即激励开发人员编写单元测试。

我的问题是：既然可以说我们不会向 QA 发布未通过所有单元测试的代码，那么如何根据单元测试合理地衡量开发人员的性能呢？基于单元测试，是什么让优秀的开发人员脱颖而出？

1.  尽管单元测试通过但功能失败？
2.  根本没有为给定的功能编写单元测试，或者没有编写足够的单元测试？
3.  编写的单元测试的质量？
4.  编写的单元测试数量？

任何建议将不胜感激。还是我在这种绩效衡量中完全偏离了标准？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-08T22:58:03.793

**也许我在这种性能测量中完全偏离了标准？**

问题不是“我们测量什么？”

问题是“什么坏了？”

其次是“我们如何测量破损？”

其次是“我们如何衡量改进？”

直到你有你想要修复的东西，这就是发生的事情。

1.  你选择要测量的东西。

2.  人们通过根据该指标做“看起来”最好的事情来做出回应。

3.  你意识到你在测量错误的东西。

具体来说。

*   “在第一次迭代时通过测试 (QA) 的功能”是什么意思？保存代码，直到它必须工作。后来看起来好多了。因此，延迟到您在第一次迭代中通过 QA。

*   “虽然单元测试通过但功能失败？” 这似乎是“不完整的单元测试”。所以你过度测试了一切。花大量时间编写所有可能的测试。放慢交付速度，以免您受到此测量的惩罚。

*   “根本没有为给定的功能编写单元测试，或者没有编写足够的单元测试？” 不知道你是如何衡量这个的，但听起来和上一个一样。.

*   “编写的单元测试的质量？” 主观测量。总是一个好计划。定义你将如何衡量质量，你会得到最大化特定衡量的东西。想要更多评论？数那些。还有什么空格？数一下。

*   “编写的单元测试数量？” 没有什么比计算测试的数量更能激励我编写冗余测试了。如果根据这个指标让我看起来不错，我可以轻松地复制和粘贴几乎相同的代码。

你得到你所测量的。无论您采用什么指标，您都会发现所测量的具体事物将颠覆大多数其他质量问题。无论您测量什么，但绝对确定您希望人们最大化该测量，同时减少其他测量。

* * *

**编辑**

我不是说“不要测量”。我是说“你得到你所测量的”。选择一个您希望以牺牲其他人为代价最大化的指标。选择一个指标并不难。只知道告诉管理层要衡量什么的后果。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-08T23:04:56.910

我认为单元测试是一种质量工具，而不是生产力工具。如果你既想鼓励单元测试又想给管理层一个生产力指标，强制单元测试将代码投入生产，并根据在给定时间范围内投入生产的代码/功能报告生产力（每周，双每周一次，无论如何）。如果我们认为人们会玩任何系统，那么设计游戏以满足您的目标。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-08T22:50:05.357

当 Joel说这种测量方法将被你的开发人员玩弄时，我认为[它是正确的。](http://www.joelonsoftware.com/items/2006/08/09.html)它不会达到它所设定的目标，并且您最终可能会遭受质量损失（来自使用该系统的每个人的看法），而您*对质量的测量*都表明事情从未如此好过！

**编辑**. 你说管理层要求这个。你是一家小公司；你的管理层不能让*每个人都*举起棍子离开。告诉他们这是垃圾，你不会参与其中。

如果整个想法是让他们可以对人员进行排名以使他们变得多余（听起来可能是在这个时候），只需询问他们有多少人必须去，然后选择那些你认为最差的开发人员，使用你的*智力和判断力*，而不是一些愚蠢的经验法则

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-08T22:54:12.740

出于某种原因，我想到了[缺陷黑市……尽管这有点相反。](http://thedailywtf.com/Articles/The-Defect-Black-Market.aspx)

对于开发人员而言，任何基于度量的系统都无法正常工作，因为它不是您可以使用传统方法衡量的东西。无论您尝试针对此类事情采取什么措施，都会被玩弄（因为解决问题是我们整天都在做的事情，而这只是另一个要解决的问题），并且会损害您的代码（例如我写的前几天一个简单的拼写校正器，大约有 5 个单元测试足以检查它是否有效，但如果我在单元测试中被衡量，我可以再花一天时间再写 100 个，这将全部通过但不会增加任何价值）。

你需要弄清楚管理层为什么要建立这个系统。如果是为了给予奖励，那么你应该看看[Joel Spolsky 的关于激励薪酬的文章，](http://www.joelonsoftware.com/articles/fog0000000070.html)这与我所看到的相差不远（想想奖金日，看看有多少人真的很开心——没有人因为他们只是得到了他们认为应得的东西——有多少人真的很生气——任何得到的比他们认为应得的少）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-08T23:04:29.987

引用史蒂夫·耶格的话：

> 不应该有一条规则，不允许公司做在呆伯特漫画中被正式嘲笑的事情吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-09T01:18:36.607

我在挪威家里的报纸上读到了一些研究。简而言之，它说办公室类型的工作通常不会从绩效工资中受益。原因是在大多数办公室类型的工作中衡量绩效几乎是不可能的。

然而，像草莓采摘这样简单的工作可以从绩效工资中受益，因为绩效考核真的很容易。没有人会因为表现出色的人得到更高的薪水而感到难过，因为每个人都可以清楚地看到他或她采摘了更多的浆果。

在办公室里，并不总是很清楚另一个人做得更好。所以很多人会失去动力。他们对教师的绩效工资进行了测试，发现它给出了负面结果。薪水高的人通常不明白为什么他们比其他人做得更好，而薪水低的人通常不明白为什么他们的薪水低。

但他们确实发现，非货币奖励通常会有所帮助。从老板那里得到鼓励的话，说做得好，等等。

阅读 iCon，了解史蒂夫乔布斯如何设法让人们发挥作用。基本上，他让人们相信他们是某件大事的一部分，并将改变世界。这就是使人们付出努力和表现的原因。我认为开发人员不会为了钱而付出很多努力。它必须是他们真正相信和/或认为有趣或令人愉快的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-08T22:59:58.797

如果你打算将人们的薪酬与他们的单元测试表现联系起来，那么结果将不会是好的。

人们会尝试玩弄这个系统。

我认为你追求的是：

1.  您希望人们部署有效且错误数量最少的代码
2.  您希望始终如一地这样做的人得到奖励

您的系统两者都不会完成。

通过将人们的工资与他们的测试是否失败挂钩，你正在抑制编写测试的动力。为什么有人会编写这样的代码，至少不会产生任何好处，最坏的情况会限制他们的薪水？总体动机将是保持测试台的大小最小化，以便将可能的故障罩降到最低。

这意味着你会得到更多的错误，除非它们是你不知道的错误。

这也意味着您将奖励引入错误的人，而不是那些阻止错误的人。

基本上你会得到与你的目标相反的结果。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-08T23:02:09.757

这些是我对您的四个具体问题的初步想法：

1.  棘手的这个。乍一看它看起来不错，但如果代码通过了单元测试，除非开发人员作弊（见下文）或测试本身是错误的，否则很难看出你将如何证明这一点。

2.  这似乎是最好的方法。所有功能都应该进行单元测试，并且对代码的检查应该能够揭示哪些存在，哪些不存在。然而，一个缺点可能是开发人员编写了一个空测试（即只返回“通过”而没有实际测试任何内容的测试）。您可能需要花费大量精力进行代码审查才能发现这一点。

3.  你将如何评估质量？谁来评估质量？这假设您的 QA 团队可以接触到高技能的独立开发人员——这可能是真的，但似乎不太可能。

4.  计算任何东西的数量（代码行、编写的单元测试）是不可能的。开发人员将简单地编写大量无用的测试。

我同意 oxbow_lakes，事实上，自从我开始写这篇文章以来就出现了其他答案——大多数形式的测量都会被开发人员玩弄或更糟。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-08T23:03:34.573

我相信时间是衡量开发人员绩效的唯一方法，尽管是主观的。

在任何一家公司只要有足够的时间，优秀的开发人员**就会**脱颖而出。项目负责人**将**知道谁是他们最好的资产。只要有足够的时间，不良的开发人员**就会**暴露出来。不幸的是，最终的问题是足够的时间。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-08T23:09:08.260

基本心理学 - 人们为激励而工作。如果我获得奖金/保住工作的机会/无论是基于我编写的测试数量，我都会编写大量毫无意义的测试——可能会以牺牲我真正的工作为代价，也就是将产品推出市场门。

您可以提出的任何其他基本指标都会遇到同样的问题并且同样毫无意义。

如果您坚持“评级”开发人员，您可以使用更横向的东西。可能是其中一项 MS 认证测试的分数（这具有让人们接受培训的副作用）。至少这是客观的并且由中立的第三方独立验证，所以你不能“玩弄”它。当然，这个分数也与这个人在你的团队中的效率没有任何相似之处，但它比任意的内部测量要好。

您还可以考虑通过某种复杂性测量工具（更简单==更好）运行代码并根据结果对人们进行评分。同样，它具有帮助人们成为更好的编码员的效果，这是您真正想要实现的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-08T23:31:19.813

可怜的阿什...

使用管理上的无知来推动完全不相关的事情的荣誉，但现在你必须想出一个可行的措施。

我想不出任何不荒谬或容易被欺骗的绩效衡量标准。单元测试不能改变它。由于 Kopecks 和 Black Market 在几分钟内就建立了联系，我宁愿给你弹药，因为它不需要单独的性能测量：

首先，软件是相互冲突的目标之间的优化。评估其中的一个或几个——比如在 QA 期间进行了多少测试——将导致其他领域的严重权衡，从而损害最终产品。

其次，团队合作不仅仅是几个人粘在一起的产物。协同效应不能追溯到单个人的努力或技能——在团队中开发软件时，它们会产生巨大的影响。

第三，软件的总成本仅在时间之后才会显现。维护、可扩展性、与新平台的兼容性、与未来产品的交互都会带来巨大的长期成本。衡量短期成本（同比，或投入生产）根本不包括长期成本，一旦知道长期成本，将其追溯到发起人是没有意义的。

为什么不让每个开发者都为他们的同事“投票”：去年谁帮助我们实现了我们的目标？为什么不相信*你*（显然是他们的经理或领导）来判断他们的表现？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-10T23:08:29.850

单元测试应该有几个因素的组合，对于开发组以外的人来说，在测量以下方面应该很容易获得记分卡：

1) 单元测试对代码和可能为 UI 元素输入的任何常见输入数据的覆盖程度如何？这似乎是一个基本的事情，但它是一个很好的起点，并且我认为可以使用 nCover 等工具轻松量化。

2) 是否经常测试边界条件，例如参数或字母的空值而不是数字和其他基本验证测试？这也可以通过查看各种方法的参数以及有编码标准来防止绕过这里的东西来轻松量化，例如，除了构造函数之外的所有对象方法都采用 0 参数，因此没有边界测试。

3) 单元测试的粒度。测试是否检查一个特定的案例，而不是尝试在一个测试中做很多不同的案例？测试类是否包含数千行代码？

4) 根据可读性和可维护性对代码和测试进行评分。新人是否必须花费数天时间弄清楚发生了什么，或者代码是否有点自我记录？示例将包括有意义的方法名称和类名称以及是否存在文档？

最后三件事是我怀疑经理、团队负责人或其他开发人员之外的其他人可以排名和处理的。可能有一些游戏可以利用这些东西，但问题是你想要得到什么最终结果？我在想有据可查、高质量、易于理解的代码 = 好代码。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-13T20:32:33.247

查看戴明和全面质量管理，了解他对为什么根本不应该对任何工作进行绩效评估的想法。

相反，假设所有员工都是可接受的员工，除非证明不同。

如果有人做了一些不可接受的事情或没有达到您需要的水平，请将其写为性能问题。在您将他们赶出公司之前，确定他们获得了多少书面记录。

如果有人做得好，就把他们写下来，因为他们做得很好。如果您想提供奖金，请在表现良好时提供。更好的是确保你宣布人们何时得到一个attaboy。人们将努力获得它们。当然，您将拥有试图与系统博弈并根据其他成就被记录下来的政策类型，但无论如何您在任何系统中都会得到。通过在表现良好时宣布谁得到了他们，你已经消除了让办公室政治参与者发挥最佳作用的保密性。如果每个人都知道乔做了一件伟大的事，而你奖励玛丽，人们就会开始谈论它。至少，乔和玛丽可能都会得到一个好孩子。

每年，给每个人同样比例的加薪，因为你只保留了表现可以接受的员工，并且你在一年中只要他们做了好事就奖励了优秀的员工。

如果您坚持测量，那么请测量您为表现不佳而写下某人的次数以及为表现良好而写下某人的次数。然后，您必须小心谨慎地对此保持合理的客观性，甚至写出那些做好事时不是你朋友的人，以及当他们做坏事时是你朋友的人。但是面对现实，无论您如何坚持客观标准，经理都会在此过程中变得主观，因为现实世界中没有客观标准。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-09-12T15:28:43.710

明确地，遵循[公认的答案](https://stackoverflow.com/a/624511/2633577)单元测试并不是衡量开发性能的好方法。事实上，它们可能是一项几乎没有回报的投资。

> … 自动化测试本身不会提高我们的代码质量，但确实需要代码输出

– 从[*衡量开发人员的影响*](https://medium.com/@jsdario/measure-a-developers-impact-e2e18593ac79)

根据代码/功能报告生产力，使其在给定的时间范围内投入生产并强制进行单元测试实际上是一个很好的系统。问题是您从中得到的反馈很少，并且可能有太多的借口来实现目标。此外，功能/重构/增强可能具有非常不同的大小和性质，因此在大多数情况下比较与组织相关是不公平的。

使用版本控制系统，如 git，我们可以将有价值工作的最小单元原子化为提交 / PR。[可视化（如上面链接](https://medium.com/@jsdario/measure-a-developers-impact-e2e18593ac79)的引用）对于管理层来说是一个更好、更崇高的目标，而不是有一个扁平的阶梯或度量标准来比较他们的开发人员。

不要试图测量原始输出。尝试了解开发人员的工作，将其可视化。

# .net - 跟踪未处理的一次性对象

> ID：624490
> 
> 赞同：8
> 
> 时间：2009-03-08T22:51:44.040
> 
> 标签：.net, idisposable

**是否有一种工具可以扫描您的代码并确定哪些实现 IDisposable 的对象在编译时或运行时没有被释放到代码库中？**

我在代码中有可能没有处理对象的区域，但是很难回头看看哪些对象首先需要这样做。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-08T22:58:36.193

有很多静态分析工具，可以在这里提供帮助。

CodeRush/Refactor Pro 和 Resharper 都将在代码时在 Visual Studio 中向您显示未处理的对象。

FxCop，现在作为 Visual Studio 代码分析的一部分打包，可以为未处理的本地人和类成员生成编译时警告。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-24T04:00:44.717

red-gate的[ANTS 内存分析器](http://www.red-gate.com/products/ants_memory_profiler/index.htm)将在运行时提供帮助。这是我最喜欢的工具之一。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-08T23:11:09.940

当垃圾收集器最终清理不再使用的类时，将调用类的析构函数。您可以做的是检查已调用“Dispose”的析构函数。建议不要实际使用析构函数，但出于测试目的，它可能很有用。

此方法的唯一问题是您必须创建自己的类，该类继承自您需要测试 IDispose 的类并覆盖 Dispose 方法（因此您可以设置一个标志，说明它已被调用），初始化标志在构造函数中并在析构函数中检查它（您使用“~ClassName（）{...}”实现）

# python - 为什么我收到无效的语法 easy_install 错误？

> ID：624492
> 
> 赞同：4
> 
> 时间：2009-03-08T22:51:58.470
> 
> 标签：python, easy-install

我需要使用 easy_install 来安装一个包。我安装了 enthought 发行版，然后突然进入 IDLE 说：

```
>>> easy_install SQLobject
SyntaxError: invalid syntax 
```

我究竟做错了什么？ `easy_install`当然存在，包装也是如此。help('easy_install') 给了我一些基本的帮助。 `import easy_install`也不会改变事情。

有什么提示吗？我知道我在这里遗漏了一些非常基本的东西。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-08T22:58:13.993

easy_install 是一个 shell 命令。您无需将其放入 python 脚本中。

```
easy_install SQLobject 
```

只要easy_install在您的路径中，就直接将其输入bash（或其他）shell。

# asp.net - ASP.NET：使用混合 HTML 格式本地化内容

> ID：624502
> 
> 赞同：14
> 
> 时间：2009-03-08T23:00:49.963
> 
> 标签：asp.net, html, localization, resx

在我的应用程序中，我有包含混合静态文本和 HTML 格式和链接的段落。我正在寻找一个良好的本地化解决方案，使资源与标记分离。假设我们有以下段落：

```
<p>Let's have a <a href="someURL">cup of coffee</a> and get <b>energized</b>.</p> 
```

使用标准 resx 解决方案迫使我在 resx 字符串中嵌入 HTML 标记和链接目标。这很糟糕，因为它将标记/CSS/应用程序结构与资源结合在一起。

下一个最好的方法是拆分段落，使本地化内容永远不会包含标记。在上面的示例中，我将有 4 个段落片段：1）“让我们有一个”作为纯文本 2）“一杯咖啡”作为链接 3）“并且得到”作为纯文本 4）“精力充沛”作为粗体文本

这个解决方案的问题在于，碎片化使得资源的维护成为一场彻头彻尾的噩梦，而且它强制段落片段的特定顺序可能不适合所有文化的语法。例如，在翻译的语言中，正确的翻译可能是

```
<p>Let's get <b>energized</b> with a <a href="someURL">cup of coffee</a>.</p> 
```

我认为不将标记嵌入到资源中是不可能的，这可能不是什么大不了的事。使用适当的标记/CSS（span、div、id、class）我可以创建可以减少耦合影响的抽象。

但是，我该怎么处理链接 URL？谢谢，

斯特凡

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T23:45:54.490

不要将 HTML 视为“格式”，而是将其视为结构，并将其全部保存到资源数据存储（例如 resx，或数据库，或 xml 文件或其他东西）中。然后你就可以不用再担心段落中的小段文字了。取而代之的是，您将根据语言环境对名为“paragraph_energyd_with_coffee”或其他名称的资源进行一些引用，并且您用于编辑资源的任何软件都将决定编辑器在构建每个资源中的 html 时具有何种灵活性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-18T02:42:57.683

I was having the same problem. If I'm reading your question correctly this is what I was able to do to solve it:

In my resources, I added the following text:

```
<p>Let's get <b>energized</b> with a <a href="{0}">cup of coffee</a>.</p> 
```

And in my ASP.NET view (using a Razor view), I added the following:

```
@Html.Raw(String.Format(ShopSavvy.Retailers.Web.Resources.Home.Index.perksReachShoppersBody1, "someURL")) 
```

Doing this gave me all the word-specific formatting I needed for the proper effect.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-23T14:47:54.627

像这样做：

```
<%= String.Format("Resources.MyResource.mydata","someURL") %> 
```

并将其用作您的资源字符串：

```
<p>Let's have a <a href="{0}">cup of coffee</a> and get <b>energized</b>.</p> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T22:32:30.303

我遇到了这个谷歌搜索完全相同的问题。这是故意的，因为如果您将资源文件发送给翻译人员，他/她可能不理解 HTML 并可能损坏您的代码。我也不喜欢这个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T15:58:13.560

我站在 Rahuls 一边——我会考虑内容的 html/css ......只是那个......内容。

主要原因是当您想要对网站进行批量内容更新时，您只需将粘贴从提供的 html/css 复制到 resx 文件中。将原始模板从 html/css 转换为 asp.net 也快得多。

还有一些折射工具在选择内容时具有“导出到 resx 文件”选项，这可能会加快速度。

谢谢！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-09-21T18:42:33.787

默认的 Visual Studio 示例网站包含：

```
<%@ Page Title="Home Page" Language="C#" MasterPageFile="~/Site.master" 
       AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %>

<asp:Content ID="HeaderContent" runat="server" ContentPlaceHolderID="HeadContent">
</asp:Content>
<asp:Content ID="BodyContent" runat="server" ContentPlaceHolderID="MainContent">
    <h2>Welcome to ASP.NET!</h2>
    <p>To learn more about ASP.NET visit <a href="http://www.asp.net" title="ASP.NET
          Website">www.asp.net</a>.
    </p>
    <p>
        You can also find <a href="http://go.microsoft.com/fwlink/?LinkID=152368&amp;clcid=0x409"
            title="MSDN ASP.NET Docs">documentation on ASP.NET at MSDN</a>.
    </p>
</asp:Content> 
```

您将如何本地化这些：

1.  `<h2>Welcome to ASP.NET!</h2>`

2.  `<p>To learn more about ASP.NET visit <a href="http://www.asp.net" title="ASP.NET Website">www.asp.net</a>.</p>`

3.  `<p>You can also find <a href="http://go.microsoft.com/fwlink/?LinkID=152368&amp;clcid=0x409" title="MSDN ASP.NET Docs">documentation on ASP.NET at MSDN</a>.</p>`

# delphi - 在 D2009 中无法安装在 D7 下工作的组件

> ID：624509
> 
> 赞同：1
> 
> 时间：2009-03-08T23:04:18.690
> 
> 标签：delphi, path, delphi-2009, components

我有很多在 D7 下完美运行的组件。我设法通过将它们拖入 Delphi 2009 IDE 来编译和安装它们。但是，当我尝试在项目中使用这些组件时，编译器说它找不到它们的源代码。我可以在哪里输入该库的路径？

* * *

解决方案：

我在 Delphi 2009 中拖放了旧的 DPK 文件。然后在项目管理器中选择“构建”，然后选择“安装”。除了使用控件的应用程序看不到它的源之外，一切都运行得很顺利。通过将路径添加到工具-选项-库 Win32 中解决了问题。

感谢所有人，尤其是穆罕默德。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-09T00:24:50.590

您是否将组件的源路径添加到库路径中？

您可以从工具菜单 > 选项 > 库 win 32 > 库路径添加它

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T08:38:33.337

如果你真的安装了它们，那么编译器应该不需要找到源代码。编译器只需要 DCU 文件。

但是如果你从 Delphi 7 中获取了这些组件，那么*你*需要有源代码，因为 Delphi 7 DCU 文件与 Delphi 2009 不兼容。（唯一可以使用彼此 DCU 文件的两个版本是 Delphi 2006 和Delphi 2007，然后只有某些限制。）

尝试使用来自错误 Delphi 版本的 DCU 文件将导致 Delphi 尝试重新编译单元。但是，解决方案**不仅仅是**提供源代码的路径。如果还没有编译单元文件（如果它们的 Delphi 版本错误，它们显然没有编译），那么你还没有真正安装任何东西。在 Delphi 中安装组件从未涉及拖放。安装组件意味着安装包含该组件的包，而安装包通常意味着打开 DPK 项目文件，然后在 IDE 中选择“安装”命令。

# jquery - 是否有一个 Jquery 选项卡控件可以很好地处理多行选项卡？

> ID：624516
> 
> 赞同：12
> 
> 时间：2009-03-08T23:10:59.517
> 
> 标签：jquery, user-interface, tabs, widget

我有一个 Web 应用程序，其中包含 2 到 20 个动态选项卡。

我目前正在使用 Jquery UI 的选项卡插件，但发现它的行为不如理想（即大约 12 个选项卡，当它换行时，第二行选项卡会随着选项卡选择移动，有时会跳过 3 行而不是两行。

这是一个双重问题，首先，有没有人知道如何在选择更改时阻止第二行选项卡跳来跳去。

或者，是否有人知道 jQuery 的选项卡插件可以很好地处理多行选项卡（如果我找不到解决方案，我可能最终会使用 ExtJS 或类似的东西，但试图保持这个应用程序相当轻量级）。

**回答**

经过进一步调查，事实证明这是由我使用的 Jquery UI 主题引起的，这是有问题的样式：

```
.ui-tabs .ui-tabs-nav li.ui-tabs-selected {  padding-bottom: .1em; border-bottom: 0; } 
```

我刚刚删除了 padding-bottom: .1em 并且它解决了这个问题（线索是第二行元素随着选择的变化而移动）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T04:27:52.487

你根本不需要扩展。只需使用带有无样式 UL 的浮动 LI。LI 应该正确包装。通常通过将“”替换为“”来确保同一选项卡中的单词不会换行是一个好主意。

我的自定义选项卡控件是使用 ASP.Net 动态构建的，但选项卡和隐藏/显示功能都是 jQuery。

```
<div id="tabWrapper">
    <ul id="tabContainer">
        <li>Tab&nbsp;1</li>
        <li>Tab&nbsp;2</li>
        <li>Tab&nbsp;3</li>
     </ul>
</div> 
```

基本 CSS

```
#tabWrapper
{
    border-bottom: solid 1px #676767;
}

#tabContainer 
{
    padding:0;
margin:0;
    position:relative;
    z-index: 1;
    float:left;
    list-style:none;
}

#tabContainer li 
{
    float:left;
    margin:0;
    cursor: pointer;
    background: f1f1f1;
    border-top: solid 1px #676767;
    border-left: solid 1px #676767;
    border-right: solid 1px #ababab;
    margin-bottom: -1px;
}

#tabContainer .selected, #tabContainer .selected:hover
{
    background: #fff;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T16:48:05.230

不是技术解决方案，但请记住，[尼尔森](http://www.useit.com)强烈建议不要使用多行选项卡：

> 只有一行标签。多行创建跳跃的 UI 元素，这会破坏空间内存，从而使用户无法记住他们已经访问过哪些选项卡。此外，当然，多行是过度复杂性的肯定症状：如果您需要的选项卡多于单行，则需要简化设计。

--[标签，正确使用：13 条可用性指南](http://www.useit.com/alertbox/tabs.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-10-17T22:39:07.900

jQuery UI 问题跟踪器[的错误报告](http://dev.jqueryui.com/ticket/4882)中描述了此问题。在那个错误报告中，我附上了一个补丁，它解决了这个问题，同时*保留*了非选定标签下方的 .ui-tabs-nav 边框。干杯。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-09-28T06:03:17.630

我不喜欢切换到第二行时的选项卡呈现方式，因此我编写了一个插件来引入“查看更多”选项卡，而不是切换到第二行。

[https://github.com/jasonday/plusTabs](https://github.com/jasonday/plusTabs)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-06T16:31:57.097

我发现以下内容对于多行上的可排序选项卡很有用。我遇到的问题之一是除非指定，否则选项卡无法正确单击到位`axis: 'x'`，但是在行之间拖动时看起来很难看。

我设法通过以下方法改进了这一点：

```
$('#tab-container')
    .sortable({
        delay       : 200,
        distance    : 20,
        axis        : 'x'
    })
    .on('sort sortchange', function() {
        $('.ui-sortable-helper').css('top', $('.ui-sortable-placeholder').position().top + 'px');
    }); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-12-31T15:17:25.133

有很多很好的答案可以用来完全解决问题，但这是我自己的¢2。

为了大大简化问题，您可以根据需要添加`<hr>` 样式来分隔选项卡行。在我看来，这看起来也比开放行更好。

# css - CSS 布局，使用 CSS 重新排序 DIV

> ID：624519
> 
> 赞同：34
> 
> 时间：2009-03-08T23:12:49.047
> 
> 标签：css

鉴于 HTML

```
<div>
   <div id="content1"> content 1</div>
   <div id="content2"> content 2</div>
   <div id="content3"> content 3</div>
</div> 
```

呈现为

```
content 1
content 2
content 3 
```

我的问题：

有没有办法通过仅使用 CSS 而不更改 HTML 部分来呈现如下。

```
content 1
content 3
content 2 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2012-03-15T22:54:26.773

这可以在支持[CSS3 flexbox 概念](http://www.w3.org/TR/css3-flexbox/)的浏览器中完成，尤其是属性`flexbox-order`。

看[这里](http://www.html5rocks.com/en/tutorials/flexbox/quick)

但是，对此的支持[仅在大多数浏览器的当前版本中](http://caniuse.com/flexbox)仍然存在。

**编辑**时间继续前进，flexbox 支持得到改进..

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2013-06-20T07:19:38.050

这对我有用： http: [//tanalin.com/en/articles/css-block-order/](http://tanalin.com/en/articles/css-block-order/)

此页面的示例：

**HTML**

```
<div id="example">
  <div id="block-1">First</div>
  <div id="block-2">Second</div>
  <div id="block-3">Third</div>
</div> 
```

**CSS**

```
#example {display: table; width: 100%; }

#block-1 {display: table-footer-group; } /* Will be displayed at the bottom of the pseudo-table */
#block-2 {display: table-row-group;    } /* Will be displayed in the middle */
#block-3 {display: table-header-group; } /* Will be displayed at the top */ 
```

如那里所述，这应该适用于大多数浏览器。检查链接以获取更多信息。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-08T23:19:39.513

它可能与您所追求的不完全匹配，但请看一下这个问题：
[CSS 将 div 定位在另一个 div 之上，而不是在 HTML 中按该顺序](https://stackoverflow.com/questions/220273/css-positioning-div-above-another-div-when-not-in-that-order-in-the-html)

基本上，您必须使用 Javascript 才能使其以任何方式可靠。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-09T01:32:29.990

这是绝对定位的经典用例之一——从源顺序更改渲染。但是，您需要知道 div 的尺寸才能可靠地执行此操作，如果您不知道，javascript 是您唯一的办法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T16:25:12.237

我在 Firefox 3 中使用 Firebug 搞砸了，并想出了以下内容：

```
<div>
  <div id="content_1" style="height: 40px; width: 40px; background-color: rgb(255, 0, 0); margin-bottom: 40px;">1</div>
  <div id="content_2" style="width: 40px; height: 40px; background-color: rgb(0, 255, 0); float: left;">2</div>
  <div id="content_3" style="width: 40px; height: 40px; background-color: rgb(0, 0, 255); margin-top: -40px;">3</div>
</div> 
```

这并不完美，因为您需要知道每个容器的高度，并将该高度值应用于最后一个元素的负上边距和第一个元素的下边距。

希望有帮助，nd

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-08T23:22:44.373

我通过这样做使它工作：

```
#content2 { position:relative;top:15px; }
#content3 { position:relative; top:-17px; } 
```

但请记住，一旦您拥有动态内容，这将不适用于您。我发布此示例的原因是，如果不了解有关您的内容的更多具体信息，我无法给出更好的答案。但是，这种方法应该为您指明正确的方向，以使用相对定位。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-08T23:19:36.690

一个字回答：没有。查看 XSLT（XML 样式表语言转换），它是一种专门用于操作 XML 的语言。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T04:49:36.980

如果您知道每个元素的高度，那么这是一个简单的垂直相对定位情况来交换订单。如果您不知道高度，那么您要么必须给它们高度并允许 div 在有任何溢出时获得滚动条，要么使用 JavaScript 计算它并动态添加相对定位。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2015-08-28T15:06:58.013

使用 jquery，您可以简单地执行以下操作：

```
$('#content2').insertAfter($('#content3')); 
```

我不认为有办法用 CSS 做到这一点，除了强制每个 div 的固定位置并以这种方式堆叠它们。

# shell - 如何将命令的输出捕获到 Bourne shell 中的文件描述符？

> ID：624520
> 
> 赞同：1
> 
> 时间：2009-03-08T23:13:29.387
> 
> 标签：shell, pipe, sh

在 Bourne shell 中捕获命令输出的标准方法是使用以下`$()`语法：

```
output=$(mycommand) 
```

但是，对于具有大量输出的命令，这需要 shell 将整个内容作为一个长字符串分配内存。我更愿意找到与 Unix C 函数在道德上等效的东西`popen`，以获取我可以从中获取的新文件描述符`read`：

```
newfd=popen(mycommand)
while read -u $newfd LINE; do
  #process output
done 
```

这甚至可能吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-08T23:19:00.857

```
#!bash
ls | while read X
do 
    echo  $X is a directory entry
done 
```

用您选择的命令替换“ls”

# c# - 在一行中嵌套行

> ID：624521
> 
> 赞同：0
> 
> 时间：2009-03-08T23:16:42.420
> 
> 标签：c#, asp.net, telerik

我有 3 列（列：FirstName、LastName、Tel） 对于 FirstName 和 LastName，我使用 GridBoundColumn 这很好。但是对于最后一个我不知道该使用什么（我可以有几个数字，因为我需要一行中的几行）。我该如何解决这个问题我的数据源是一个列表（字符串 FirtsName、字符串姓氏、列表电话）

[替代文字 http://www.imagefilez.com/out.php/i343457_help.jpg](http://www.imagefilez.com/out.php/i343457_help.jpg)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T00:47:31.830

使用模板列并在 itemtemplate 中添加另一个嵌套列表控件。将其数据源属性设置为您的电话列表。

[本文](http://msdn.microsoft.com/en-us/library/aa479353.aspx)详细解释了这种方法。

您可以忽略 RowDataBound 事件中有关 RowFiltering 的示例代码，只需将数据源设置为您的列表。

# c# - 从 56k 调制解调器创建拨号音

> ID：624526
> 
> 赞同：7
> 
> 时间：2009-03-08T23:19:15.397
> 
> 标签：c#, vb6, serial-port, modem, mscomct2.ocx

好的，每个人都进入你的回程机器。我需要将电话拨入计算机的 56k 调制解调器。我需要我的电脑让调制解调器“打开”并有一个活跃的拨号音。原因如下：我有一个污水泵警报器，它会在泵出现故障时给我打电话。它仅适用于固定电话。我想停止为我的固定电话付费以省钱，而只拥有我的手机。我的想法是从我的 pc 的 56k v90 调制解调器上的水槽警报中拦截出站呼叫。然后我可以免费发短信、电子邮件等。

有人知道如何开始吗？我找到了很多关于如何从我的电脑拨打电话的资料，但我想要一部电话（设备）来拨打我的电脑。我认为除非听到拨号音，否则油底壳警报不会拨号。

我更喜欢 C# 或 vb6 程序，但愿意使用任何东西。我有一些使用串行通信设备的经验，所以我只需要指出正确的方向。

谢谢！！！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T00:49:09.547

要完成您所描述的任务，您需要的不仅仅是 PC 中的调制解调器。污水泵和您的 PC 都有调制解调器，它们是电话“环路”的用户端。CO 端（电话中的中央办公室）提供您的电话功能和上述两个调制解调器。

一个重要的问题是响铃的产生……这是一种相对高压的交流信号，它实际上在老式电话中敲响了警铃，但在较新的电话和调制解调器中可以简单地检测到。为了识别污水泵的呼叫，您的 PC 调制解调器必须接收到此振铃电压，但污水泵实际上不会产生此音调。

这里介绍的其他想法（使用 PABX SOHO 开关或将检测到的来自污水泵的信号直接连接到 PC 上的 I/O 端口），我可以想到另一种选择。污水泵内部的某处是一个 UART 芯片，它与随附的调制解调器进行串行通信。如果您断开调制解调器与 UART 的连接，您就具备了串行端口的基础知识，可以将其连接到 PC 上的串行端口（尽管您可能需要一个接口芯片来获得正确的电平……请参阅提供的 IC格言）。

祝你好运！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T23:35:27.523

简单的方法：拿一个简单的 PABX（小型 SOHO 类）让您的闹钟呼叫您的 PC。您可以使用 PC 的调制解调器等待调制解调器发出的 RING。（使用 System.IO.Ports.SerialPort 类来完成此操作。）您需要对警报系统进行编程以调用 PC 的内部号码。

一旦你得到一个戒指，剩下的就让你的软件来做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T14:31:29.173

另一种选择是用 Python 编写的 pySerial 脚本。

您可以编写一个小型侦听器来侦听来自泵调制解调器的电话。您将需要知道一些 AT 命令，您可以在任何地方在线查找这些命令。

```
import pySerial
ser=serial.Serial('COM4',2400,timeout=1) #replace 2400 with your baudrate

ser.open()

ser.write("ATS0=1\r\n") #picks up after one ring

while(1):
    line = ser.readline() #listen in a loop 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T14:40:09.607

我曾经有一个“电话线模拟器”，它允许我通过一个模拟电话公司讨价还价的小黑匣子让一个调制解调器呼叫另一个调制解调器来测试调制解调器配置。这样的东西应该很容易找到，并且可以轻松解决您的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T23:26:52.693

你需要污水泵来实际拨号吗？
你不能只拦截污水泵对拨号音的检查吗？
或者更好的是，也许你有一个电子朋友可以连接一个插入污水泵的简单设备，并检查泵发生故障时出现的电压边缘。这是在泵实际尝试拨号之前或同时发生的事件。当这个小设备检测到边缘时，它可以适当地在您的 PC 上触发某些东西。该设备甚至可以检测到电话线上的 V 变化 - 在 RJ11 上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-08T23:28:36.357

我不知道您对电子产品有多熟悉，但我几乎想知道您的解决方案是否可以通过软件和硬件的混合来处理。

我的第一个想法是让 Arduino 之类的东西连接到执行泵故障检测的电路或电话线，并监视泵发出的任何信号。Arduinos 通常通过串行/USB 连接到您的计算机，然后您可以拥有一个软件，可以通过电子邮件向您发送电子邮件、向您发送推文或任何您想要的东西。

你可以让你的调制解调器监视试图拨出的泵，但我不知道你是怎么做到的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-08T23:28:50.350

我可能会将这两个程序分开。

1.  我会让超级终端（假设你在 Windows 机器上）在你的调制解调器上运行，使用 ATA 或类似的东西，在活动时，我会让它写一个文件。
2.  我会让另一个程序作为自动任务运行（例如每 30 分钟一次），查看该文件是否已更改，并触发一条短信到您的手机。

我想这将是一个足够简单的设置，它很容易维护，但足够可靠，可以防止你的房子变成游泳池......

# wpf - 从 WPF 应用程序窗口获取位图？

> ID：624534
> 
> 赞同：5
> 
> 时间：2009-03-08T23:22:44.590
> 
> 标签：wpf, winforms, bitmap, system.drawing

Winforms System.Windows.Forms.Control 类有一个实例方法“DrawToBitmap”，我认为它在各种情况下都非常有用。我想知道是否有从 WPF 应用程序获取 System.Drawing.Bitmap 的等效方法？

我意识到我可以做一些 P/Invoke 的东西来获取应用程序窗口，但是我不喜欢这样，因为它不能很好地适应 64 位转换，并且不允许我只渲染子控件，如 DrawToBitmap做。

谢谢，理查德

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-09T00:19:46.700

使用 MSDN 上的 RenderTargetBitmap

```
RenderTargetBitmap bitmap = new RenderTargetBitmap(width, height, 96, 96, PixelFormats.Pbgra32);
bitmap.Render(this.YourVisualControlNameGoesHere); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T06:22:25.317

TFD 恰到好处。您还可以使用 MSDN 中不太优雅的参考示例：

```
Dim width As Integer = 128
Dim height As Integer = width
Dim stride As Integer = CType(width / 8, Integer)
Dim pixels(height * stride) As Byte

' Try creating a new image with a custom palette.
Dim colors As New List(Of System.Windows.Media.Color)()
colors.Add(System.Windows.Media.Colors.Red)
colors.Add(System.Windows.Media.Colors.Blue)
colors.Add(System.Windows.Media.Colors.Green)
Dim myPalette As New BitmapPalette(Colors)

' Creates a new empty image with the pre-defined palette
Dim image As BitmapSource = System.Windows.Media.Imaging.BitmapSource.Create(width, height, 96, 96, PixelFormats.Indexed1, myPalette, pixels, stride)
Dim stream As New FileStream("new.bmp", FileMode.Create)
Dim encoder As New BmpBitmapEncoder()
Dim myTextBlock As New TextBlock()
myTextBlock.Text = "Codec Author is: " + encoder.CodecInfo.Author.ToString()
encoder.Frames.Add(BitmapFrame.Create(image))
encoder.Save(stream) 
```

# python - 在我自己的应用程序中使用 Django 管理外观

> ID：624535
> 
> 赞同：1
> 
> 时间：2009-03-08T23:22:51.627
> 
> 标签：python, django, django-admin, styles, look-and-feel

我喜欢 django admin 非常简单但仍然非常优雅的外观和感觉，我想知道是否有办法将它应用到我自己的应用程序中。

（我想我在某处读过类似的东西，但现在我再也找不到该页面了。）

（编辑：我正在寻找的是一种通过扩展模板、导入模块或类似的东西来自动完成它的方法，而不仅仅是复制和粘贴 css 和 javascript 代码）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T06:47:34.087

您确定要获取管理站点的所有外观和感觉吗？我认为您需要自定义一些，例如页眉页脚等。

为此，只需从

> “djangosrc/contrib/admin/templates/admin/”

并将其保存在

> “your_template_dir/admin/base.html”或“your_template_dir/admin/mybase.html”

只需更改您想要自定义的任何 HTML 并保持原样（如 CSS 和 Javascript）并继续在应用程序的其他模板中扩展此模板。您的视图应该提供它需要渲染的内容（从源代码查看任何 django 视图），您将拥有管理员外观和感觉所拥有的一切。您可以通过以相同方式扩展 base_site.html 来做更多事情。

> （注意：如果您保留名称“base.html”，则在 html 中所做的更改也会影响 Django Admin。因为这是我们更改 Django Admin 外观本身的方式。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-09T11:34:30.120

```
{% extends "admin/base_site.html" %} 
```

通常是一个不错的起点，但请查看 contrib/admin/templates 中的模板并复制其中的一些技术。

# bit-manipulation - 位旋转重新排序

> ID：624538
> 
> 赞同：3
> 
> 时间：2009-03-08T23:24:05.900
> 
> 标签：bit-manipulation, shuffle

我需要对 7 位值进行任意重新排序（是的，我知道我应该使用表格）并且想知道是否有任何位黑客可以做到这一点。

例子：

```
// <b0, b1, b2, b3, b4, b5, b6> -> <b3, b2, b4, b1, b5, b0, b6>

// the naive way
out =
   (0x020 & In) << 5 |
   (0x008 & In) << 2 |
   (0x040 & In)      |
   (0x012 & In) >> 1 |
   (0x004 & In) >> 2 |
   (0x001 & In) >> 3;

// 6 ANDs, 5 ORs, 5 shifts = 16 ops 
```

* * *

*编辑：我在想一些类似*[的](http://blogs.msdn.com/devdev/archive/2005/12/12/502980.aspx) 东西

只是为了踢球，因为我是 AFTK，所以我正在尝试蛮力搜索以下形式的解决方案：

```
((In * C1) >> C2) & 0x7f 
```

未找到解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T01:54:26.550

第一步似乎是理解数学解决方案并对其进行优化。

看到这里的[小技巧](http://www-graphics.stanford.edu/~seander/bithacks.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-08T23:30:47.193

看看你的“天真”代码的编译器输出，它可能会让你大吃一惊。我曾经做过类似的事情，编译器（VC++2005）完全改变了我所有的值和移位，以提高它们的效率，例如我确信它会删除你的“（0x001＆In）>> 3"。

但是，是的，如果重新洗牌是一个固定功能，那么一张桌子可能是最好的。

**更新**

为了一笑，我查看了 VC++ 2005 的编译器输出......

首先，我为“In”尝试了一个常量值，但编译器一点也没有被愚弄，它产生了以下代码：

```
mov eax,469h 
```

IE。它完全优化了它。

所以......我尝试了正确的输入并得到了这个：

```
00401D4F  mov         eax,ecx 
00401D51  and         eax,20h 
00401D54  shl         eax,3 
00401D57  mov         edx,ecx 
00401D59  and         edx,8 
00401D5C  or          eax,edx 
00401D5E  mov         edx,ecx 
00401D60  sar         edx,1 
00401D62  and         edx,2 
00401D65  or          edx,ecx 
00401D67  sar         edx,1 
00401D69  shl         eax,2 
00401D6C  and         edx,9 
00401D6F  or          eax,edx 
00401D71  and         ecx,40h 
00401D74  or          eax,ecx 
```

那是四个移位操作，五个 AND，四个 OR - 对于六个输入来说还不错。可能比大多数人用手做的要好。

它可能还针对乱序执行进行了优化，因此时钟周期比看起来要少。:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T23:30:23.840

对于常见的操作，有很多位旋转技巧，即反转 32 位字中位的顺序（移位、AND 和 OR、AFAICR 各 10 个）。

在这种情况下，从输入到输出显然是完全任意的映射，我看不到任何清理它的方法。

使用查找表:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-02T21:51:02.367

在优化之前，您应该确保您的“天真”方式正在按照您的意愿行事。如果我把你的代码变成一个函数并运行这个循环：

```
for (b=0;b<7;b++)
{
    i=1<<b;
    printf("%d: %02x -> %02x\n", b, i, shuffle(i));
} 
```

它产生这个输出，这与评论相矛盾。事实上，它会丢失位。

```
0: 01 -> 00
1: 02 -> 01
2: 04 -> 01
3: 08 -> 20
4: 10 -> 08
5: 20 -> 00
6: 40 -> 40 
```

为了得到你描述的洗牌，我会这样编码：

```
 //    0 1 2 3 4 5 6 
   //-> 3 2 4 1 5 0 6
   (0x001 & In) << 3 |
   (0x004 & In) << 2 |
   (0x020 & In)      |
   (0x012 & In) << 1 |
   (0x008 & In) >> 2 |
   (0x020 & In) >> 5 ; 
```

# asp.net - 使用 ASP.NET 控件对性能的影响

> ID：624539
> 
> 赞同：2
> 
> 时间：2009-03-08T23:24:19.703
> 
> 标签：asp.net, performance, viewstate

对于页面上的用户控件，我知道每个控件都会通过将自己的状态存储在 ViewState 中来影响内存使用。我的问题是，多少钱？

例如 - 我有一个反馈表作为我的母版页上的控件。默认设置为 Visible="false"。用户单击反馈按钮，控件在需要时变为可见。

通过控制每个页面（因为它位于母版页中）但不可见，相对性能会产生什么影响？我正在开发的网站可能会有大量流量，我想知道如果事情变得缓慢，我是否会让自己头疼。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T23:33:38.043

性能可能会影响服务器和客户端。首先，您希望减少发送到客户端的 HTML 数量，包括视图状态。如果这位于每个页面上，那么您将比实际需要更频繁地发送此视图状态信息。

我认为你应该有一些逻辑来确保反馈表单控件只添加到反馈页面。与其使用 visible="false"，不如将其放在它自己的页面上并链接到它，或者将控件动态添加到页面中。

主要好处将是减少带宽使用，并在客户端更快地呈现页面。次要好处包括更容易调试和更清晰的代码呈现给客户端。

对于所有性能问题，您应该测试性能并根据硬数据做出判断。在这种情况下，计算客户端上视图状态的大小，然后乘以请求数以查看服务器上带宽使用的大小。在客户端使用像 FireBug 这样的工具来了解客户端收到的整体页面大小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T23:33:45.627

这取决于控制。具有数百行的 Datagrid 可能会生成 100k 的视图状态。另一方面，复选框不会生成太多。

您可以将反馈表单控件放在空的 aspx 页面上，在浏览器中访问它并检查 __viewstate 隐藏字段。这是您反馈表单将在视图状态方面添加到每个页面的数量。然后你必须决定它是否可以接受。

我不会在一开始就考虑这样的优化。如果以后它会变慢，您可以随时将表单更改为纯 html 并使用 ajax 或其他东西将其数据发布到服务器。只要是用户控制而不是复制粘贴的内容，就很容易优化

# c++ - 返回序列中子序列的最大可能和的算法

> ID：624540
> 
> 赞同：1
> 
> 时间：2009-03-08T23:26:03.087
> 
> 标签：c++, algorithm

```
int maxSumRec(const vector<int> &a, int left, int right){

    if (left == right){

               if (a[left] > 0){
        return a[left];
               }
               else
                  return 0;

    }

    int center = (left + right)/2;
    int maxLeftSum = maxSumRec(a, left, center);
    int maxRightSum = maxSumRec(a, center+1, right);

    int leftBorderSum = 0; int leftBorderMax = 0; 
    for (int i = center; i >= left; i--){

        leftBorderSum += a[i];
        if (leftBorderSum > leftBorderMax){

            leftBorderMax = leftBorderSum;
        }
    }

    int rightBorderSum = 0; int rightBorderMax = 0;
    for (int i = center+1; i <= right; i++){

        rightBorderSum += a[i];
        if (rightBorderSum > rightBorderMax){

            rightBorderMax = rightBorderSum;
        }

    }

    int crossSum = rightBorderMax + leftBorderMax;

    return max3(maxLeftSum, maxRightSum, crossSum);

} 
```

这是一个 O(NlogN) 算法，我知道它不是最好的。但只是有几个问题：

1.  在第一个 if 语句中，如果 a[left] < 0，为什么返回 0？

2.  为什么需要 2 个 for 循环？不是这样的逻辑吗，求前半部分和后半部分的最大值，然后相加，看相加是否大于两者。如果是这种情况，那我们可以直接跳到最后2行吗？

非常感谢，

岳哈丽特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T23:33:28.357

> 1.  在第一个 if 语句中，如果 a[left] < 0，为什么返回 0？

因为空子序列的和最大，即 0。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T23:32:11.667

好的，我想出了第二个问题，因为我们必须注意连续词而不是跳跃词。

# architecture - 你如何组织你的小型可重用cffunctions？

> ID：624541
> 
> 赞同：15
> 
> 时间：2009-03-08T23:26:42.133
> 
> 标签：architecture, coldfusion, cfimport

我正在重新组织我的 ColdFusion 目录结构，并对经验丰富的 CF 开发人员如何组织较小的 cffunctions 库感到好奇。

我对复杂的组件（对象）并不像对随着时间的推移而构建的几十个小实用函数那样好奇。

*   您是否使用带有 cffunctions 和 cfinclude 的大型单个文件？
*   您是否使用大型单个文件作为 cfcomponent 并调用 creatobject/cfinvoke？
*   您是否将每个实用程序 cffunction 放在其自己的 cfc 中并调用 createobject/cfinvoke？
*   你使用 cfimport taglib 语法吗？
*   您使用 CustomTags 还是 cfmodule？
*   你有更好的方法吗？

因为我不喜欢冗长的语法，所以我只是 cfinclude 一个 lib.cfm，其中有一堆常见的 cffunctions。我可以将它们重构为可以在其上创建对象的分组 cfcs，以便更好地隔离变量范围。

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-09T02:02:01.680

[这是我在 2007 年 6 月 13 日发表的一篇博](http://rip747.wordpress.com/2007/06/13/udfs-how-do-you-orgainze-them/)文的重印。我使用这种方法已经有一段时间了，效果很好！YMMV。

谁不喜欢用户定义函数 (UDF)？如果您进行过任何编程，那么您很可能已经广泛使用过它们。人们遇到的最大问题是如何在您的应用程序中包含和组织它们。

我发现大多数人所做的是创建一个 Utils.cfc 或 UDFs.cfc 并将他们想要使用的 UDF 剪切并粘贴到组件中，如下所示：

```
<!--- UDFs.cfc --->
<cfcomponent output="false">

<cffunction name="init" access="public” returntype="Any" output="false">
  <cfreturn this>
</cffunction>

<cffunction name="myUDF1" access="public" returntype="Any" output="false">
</cffunction>

<cffunction name="myUDF2" access="public" returntype="Any" output="false">
</cffunction>

</cfcomponent> 
```

将应用程序将使用的所有 UDF 粘贴到组件中后，您需要使 UDF 可用于您的应用程序。我见过的几乎每个人都将组件加载到应用程序范围内。如果您正在使用 Application.cfc，则将以下行放入，`onApplicationStart()`或者如果您正在使用它，只需将其添加到 Application.cfm 中：

```
<cfset application.functions = CreateObject("component", "udfs").init()> 
```

无论您使用的是 Application.cfc 还是 Application.cfm，结果都是一样的；您的所有 UDF 都可用于您的应用程序，并且您可以在整个过程中自由使用它们。唯一的区别是您使用的变量名称。我使用 application.functions，有些使用 application.utils 或 application.udfs；没关系，再次，结果是一样的。

不过，这种方法有一个问题，它很麻烦，而且 UDF 组件会变得很大。拥有如此庞大的组件文件的问题在于编辑它成为一场噩梦，因为滚动数千行代码并不是很有趣，而且我注意到 CFEclipse 陷入了巨大的文件中。当然，代码崩溃确实提供了一些缓解，但必须有更好的方法。

我想要的是为我正在使用的每个 UDF 提供一个文件，并为我的应用程序提供一种自动加载它们的方法。这背后的原因是，如果我需要编辑`myUDF1`，我可以打开文件`myUDF1.cfm`并编辑我需要的内容。我还希望能够从[CFLib.org](http://www.cflib.org/)获取 UDF，然后将它们放入我的应用程序中，而无需进行任何编辑。如果我需要从我的应用程序中删除 UDF，它就像删除 UDF 文件并重新初始化我的应用程序一样简单。

为了完成我想要的，我将我的 UDFs.cfc 修改为 11 行代码：

```
<!--- UDFs.cfc --->
<cfcomponent output="false">

  <cfset variables.udfdir = GetDirectoryFromPath(GetCurrentTemplatePath()) & "udfs">
  <cfset variables.q = "">

  <cffunction name="init" access="public" returntype="Any" output="false">
    <cfreturn this>
  </cffunction>

  <cfdirectory action="list" directory="#variables.udfdir#" filter="*.cfm" name="variables.q">

  <cfoutput query="variables.q">
    <cfinclude template="udfs\#name#">
  </cfoutput>

</cfcomponent> 
```

那么究竟发生了什么？

简而言之，这就是正在发生的事情：我有一个名为`udfs`UDFs.cfc 的目录中的目录。这是我放置所有 UDF CFM 文件的目录。UDFs.cfc 所做的是在调用它时扫描此目录并自动包含它找到的每个 CFM 文件。因此，它会自动将 UDFs 文件夹中的所有 UDF 加载到自身中（通常称为“mixin”）。

所以我的目标达到了！我在自己的文件中拥有每个 UDF，因此我不必滚动浏览一个巨大的组件文件来找到它。我现在可以轻松地打开和编辑它。通过查看目录，我知道我的应用程序正在使用哪些 UDF。我只需将浏览器中的文本保存到目录中的文件中，就可以自动从 CFLib.org 添加 UDF。另外，如果我不再需要在我的应用程序中使用 UDF，我只需从目录中删除该文件，并在下一次重新初始化期间将其从我的应用程序中删除。所有这些都无需接触主 UDFs.cfc 文件即可完成。

下面是一个 UDF CFM 文件的外观示例。该文件被调用`fullLeft.cfm`并位于 UDFs 目录中。

```
<!--- fullLeft --->
<cffunction name="fullLeft" access="public" displayname="fullLeft" returntype="string" output="false">
  <cfargument name="str" type="string" required="true">
  <cfargument name="count" type="numeric" required="true">
  <cfif not refind("[[:space:]]", arguments.str) or (arguments.count gte len(arguments.str))>
    <cfreturn Left(arguments.str, arguments.count)>
  <cfelseif reFind("[[:space:]]",mid(arguments.str,arguments.count+1,1))>
    <cfreturn left(arguments.str,arguments.count)>
  <cfelse>
    <cfif count-refind("[[:space:]]", reverse(mid(arguments.str,1,arguments.count)))>
      <cfreturn Left(arguments.str, (arguments.count-refind("[[:space:]]", reverse(mid(str,1,arguments.count)))))>
    <cfelse>
      <cfreturn left(arguments.str,1)>
    </cfif>
  </cfif>
</cffunction> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T01:17:35.843

我认为这取决于你的编程风格，选择你最喜欢的风格。我发现最简单的方法是在 application.cfm 中，将应用程序范围内的变量设置为具有我所有实用程序功能的 cfcomponent：

```
<cfif not isDefined("application.utilities")>
    <cfset application.utilities = createObject("component", "Utilities")>
</cfif> 
```

现在您可以从任何地方调用 application.utils 中的方法。请注意，如果您对 cfcomponent 进行更改，则必须使用新的 Utilities 实例刷新应用程序变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T21:50:10.053

如果您使用的是 Application.cfc（如果不是，我强烈建议您从 Application.cfm 迁移到它 - 这很容易做到）您可以使用您的所有 UDF 方法构建一个 baseComponent.cfc 并让 Application.cfc 继承自基础组件。然后在 onRequestStart 方法中设置一个名为 request.app=this 的变量；

对于整个请求，您可以使用 request.app.methodname() 访问 UDF。它处理UDF的非常好和简单的方法

此外，如果您愿意，可以让所有 cfcs 从同一个 baseComponent 继承，以便所有 cfcs 都将这些 util 函数作为本机方法。使单元测试 cfcs 变得非常容易，因为 cfcs 不需要回复对 UDf 组件的传递（注入）引用，它们是它的后代！

这种方法的一个挑战是 cfc 的 extends 属性不能是表达式……因此，根据您打包组件的方式，这可能很难实现。处理它的最简单方法是使用冷融合映射。

乔恩

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-18T14:55:33.167

我们将 .cfm 文件用于函数库，并使用 cfinclude 调用相应的文件。一些 .cfm 文件是从 cflib.org 下载的，其他文件是我们编写的。这些文件位于名为 UDF 的目录中，该目录是映射到正斜杠字符的另一个目录的子目录。cfinclude 语句很简单：

```
<cfinclude template="/UDF/filename.cfm"> 
```

这种方法使服务器上的所有应用程序都可以使用这些功能。

我们也更喜欢几个小型库的方法。每个库都是特定于主题的（数学、字符串、列表数组等）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-11-27T04:21:25.287

选项：您是否使用带有 cffunctions 和 cfinclude 的大型单个文件？

A：我做过，但我做的越来越少。我喜欢利用继承和 cfcexplorer

选项：您是否使用大型单个文件作为 cfcomponent 并调用 creatobject/cfinvoke？

A：是的，我经常这样做

选项：您是否将每个实用程序 cffunction 放在其自己的 cfc 中并调用 createobject/cfinvoke？

A：如果我希望以后添加其他功能，我可能会这样做

选项：您使用 cfimport taglib 语法吗？

A: 我就是这样做 i18n 的

选项：您是否使用自定义标签

答：很久没有了。cfc 在这方面做得更好

选项：或cfmodule？

答：很久没有了。cfc 在这方面做得更好。caller.* 范围会使调试变得困难

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-06T01:43:39.680

我意识到这是一个老问题，但我对这些问题使用了一些不同的方法。

**具有“注入”的实用函数/单例方法**

我创建了一个“核心”或“实用程序”cfc。在其中我打包了我所有的实用程序类型函数，它们是：

*   在任何地方都经常使用（例如通用`viewRecord()`dao 和核心`checkSecurity()`函数等）
*   恕我直言应该是 CF 核心的基本功能（例如`lpad()`, `capitalize()`, et al）
*   是一些允许我`cfscript`普遍使用的标签的包装器（例如`exit()`which wraps `<cfexit>`）

在 上`onApplicationStart()`，我创建了这个对象的一个​​实例并将其分配给`Application`范围，从而创建了一个静态单例。

然后，我没有将它扩展或重新包含到我几乎所有的 cfc 中，这允许我将扩展用于更传统的继承类型，然后我将这些方法注入到我构建的所有 cfc 的构造函数（init）中。我通过调用实用程序对象本身的方法来做到这一点，这样：

```
public/remote any function init() {
  structAppend( Variables, Application.MyApp.Objects.oCore.injectCoreMethods() ); 
  return this; // Return instance of this object
} 
```

该`injectCoreMethods()`方法有选择地返回我希望虚拟扩展到所有对象的实用函数的结构。它不一定注入*所有*实用程序方法。不太常用的那些，包括`injectCoreMethods()`它自己，仍然需要通过完整的单例应用程序指针来寻址，例如`Application.MyApp.Objects.oCore.infrequentMethod()`.

通过注入`Variables`受保护的作用域，这些方法将有效地成为私有方法。因此，任何对象转储都不会显示这些实用程序功能，但可以通过其所有直接方法在 cfc 中完全访问。

**文件组织：**

我通常陷入每个文件夹一个 cfc 的模式。在每个文件夹中，我都有一个用于组件和 init 的 cfc 文件。我将所有其他方法分解为 cfm 文件并包含在该 cfc 中。我这样做是为了：

1.  避免超过 1000 行的巨型 cfc 文件，这会降低我的 IDE 速度（我使用 aptana/cfeclipse）
2.  允许在每个文件的基础上更离散地记录/跟踪更改，从而记录在我的 SCM/版本控制软件中。
3.  允许多人在给定对象上工作，而不会相互碰撞代码。

所以一个包含 4 个 crud 方法的 dao 对象看起来像这样：

```
/code/dao/dao.cfc
/code/dao/_removeRecord.cfm
/code/dao/_addRecord.cfm
/code/dao/_viewRecord.cfm
/code/dao/_editRecord.cfm 
```

cfc 只包含`init()`和自文档注释，在伪构造器区域中，我包含了四种方法。这也让我可以通过文件夹抓取任何 cfc 并将其移动到某处。

实用程序 cfc 也是如此。它位于自己的文件夹中，在 10 个左右的 cfm 文件中具有大约 30 个奇怪的函数（我将一些简单的函数留在同一个文件中，例如`_string.cfm`实际上包含`lpad()`,`rpad()`等所有字符串相关的。你明白了。）

**模块和自定义标签**

我不惜一切代价避免这些，因为它们需要注册并妨碍轻松移动/部署。我不喜欢不只是在从一个环境拖放到另一个环境时自行配置的东西。CF5-您必须以这种方式做更多的事情。但是既然 CF6 和在真正的 OOP 模式中使用对象的能力，你为什么要这样做呢？如果有的话，您想要/需要的情况很少。

**其他**

我曾经将“核心”函数放入 base.cfc 中，该函数会自动扩展到 CF 生成的所有 cfc 中（查找它，添加一个函数，瞧！有点像在 js 中向原型添加东西）。我曾经非常喜欢这个，但这是部署/维护的问题。

在某种程度上，我采用工厂方法。我经常在应用程序中放置相当数量的静态cfc，就像核心一样。控制器读取通用控制表并在循环中设置所有对象以及应用程序启动时的一堆其他内容，例如应用程序变量。但是有些对象是根据需要实例化的，显然重的对象和包含可操作[半]持久数据的对象属于该类别

在某些方面，我从 CF7 开始就一直在这样做。使用 CF9+，它变得非常简单、成熟和流畅。

# sharepoint - 将元素添加到特定用户的公告列表

> ID：624549
> 
> 赞同：1
> 
> 时间：2009-03-08T23:29:30.223
> 
> 标签：sharepoint, list, impersonation

我有一个客户要求根据另一个数据库中的一些数据创建一些公告。大部分看起来很容易，但新元素应该由输入数据中指定的用户（登录）创建。我计划使用列表 Web 服务添加公告，但我肯定想避免使用模拟来获得创建用户的权利。有没有办法在不使用模拟的情况下将正确的用户分配为创建者？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-11T04:45:49.913

这可能不是您要寻找的答案，但如果您在 SharePoint 服务器上的 GAC 中运行代码，则模拟非常容易。您不需要知道许多人没有意识到的任何密码，所以我将继续假设这是您不想进行模拟的原因。这是如何做到的。

您可以使用用于 SPSite 的典型构造函数连接到 SharePoint，并找到适当的 SPUser 对象。完成此操作后，您可以获得该 SPUser 的 UserToken 属性。然后您需要再次使用 SPSite 构造函数，但使用提供 SPUserToken 的重载。然后，您在 SharePoint 中所做的任何事情都将通过模拟来完成。无需以提升的权限运行。

好的，既然我已经用文字说了出来，我将尝试猜测代码。它应该是这样的：

```
// Just determine the user token for a particular user
SPUserToken userToken = null;
using (SPSite tempSite = new SPSite("http://sharepointurl"))
{
    using (SPWeb tempWeb = tempSite.OpenWeb())
    {
        // I think this next line works, but I'm going from memory
        // I believe the user needs to have already logged into the site at least once
        SPUser user = tempWeb.AllUsers["username"];
        userToken = user.UserToken;
    }
}

// Now do whatever we want impersonating that user
using (SPSite site = new SPSite("http://sharepointurl", userToken))
{
    using (SPWeb web = site.OpenWeb())
    {
        // Do whatever you want here
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T08:48:06.277

我不认为有存档的方法。

但也许这种解决方法可能会有所帮助。我不得不承认我从未测试过这个，这只是一个想法，你可以如何解决你的问题。

你可以试试这个。使用管理员用户或 RunWithElevatedPrivileges() 创建新公告。之后再次使用 RunWithElevatedPrivileges() 方法并将“创建者”字段设置为应该是公告的实际创建者的用户。通过这种方式，只有“编辑者”字段应该显示“错误”用户。

我知道这不是一个非常优雅的解决方案，但它可能会奏效。;)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T21:39:43.463

我刚刚意识到我的要求实际上是绕过 SharePoint 中的审计跟踪，所以我当然希望它不能完成 :-)

我想出了另一个解决方案：我在公告列表中添加了一个新的用户或组字段，并将 AD 用户登录复制到该字段中。以前使用“创建者”字段的任何报表或视图现在都应使用新字段。

那么真实用户在公告列表中输入一个新元素的情况呢？这不会使用登录用户更新新字段！

好吧，我能想出的唯一解决方案是在列表中添加一个 ListItem Add 触发器。添加新元素时，我检查新字段是否包含值，然后我使用登录用户的 ID 更新新字段。这样，新字段应始终包含有效的用户 ID。

我知道这不是一个优雅的解决方案，但目前它是我能想到的最好的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-25T19:25:44.163

正如答案的代码注释中所提到的，如果用户至少一次没有访问过该站点，那么就没有可用的用户元数据来派生适当的用户令牌。

使用 SharePoint 2010，您可以使用 SPWeb 类中可用的 EnsureUser 方法模拟用户访问（此代码段创建用户并稍微调整他们的个人资料）：

```
SPUser alice = web.EnsureUser(@"MYDOMAIN\alice");
SPList userInfo = web.SiteUserInfoList; //metadata storage of user info

SPListItem item = userInfo.GetItemById(alice.ID);
item["About Me"] = "I am Alice from Mel's Diner";
item.Update(); 
```

# java - 在 Java JMS ResourceAllocationException 方面需要帮助

> ID：624556
> 
> 赞同：1
> 
> 时间：2009-03-08T23:30:54.697
> 
> 标签：java, jms

我收到以下错误：

> `javax.jms.ResourceAllocationException: [C4073]: A JMS destination limit was reached. Too many Subscribers/Receivers for Queue`

设置是这样完成的，即有一个提供者和两个消费者。发生此错误的原因是因为它是一个队列并且它只能有一个提供者和一个消费者吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T23:49:22.220

JMS 中的队列是点对点机制，如果您有多个消费者，则不应使用它们。您应该为此使用主题。

如果您愿意，请发布完整的代码，以便我们尝试提供更多帮助，因为您的代码在做什么并不是很清楚。

JMS 基本概念 [http://java.sun.com/products/jms/tutorial/1_3_1-fcs/doc/basics.html](http://java.sun.com/products/jms/tutorial/1_3_1-fcs/doc/basics.html)

话虽如此，根据 Sun 的说法，这是此错误的信息：

```
C4073 

Message A JMS destination limit was reached. Too many Subscribers/Receivers for {0} : {1}

{0} is replaced with “Queue” or “Topic” {1} is replaced with the destination name.

Cause The client runtime was unable to create a message consumer for the specified domain and destination due to a broker resource constraint. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T01:45:19.320

您实际上可以将队列与多个消费者一起使用。主题可能不是您想要的。主题将用作发布/订阅模型，每个消费者都将获得消息的副本；而对于队列，JMS 提供者应该只将消息分派给一个消费者。

您的 JMS 提供程序上可能有一个配置设置，将您限制为每个队列一个使用者。我只将 ActiveMQ 用于 JMS，但它允许您在单个队列上拥有多个消费者 - 它基本上对消费者之间的请求进行负载平衡。

# c# - TreeNode 广度优先枚举？

> ID：624562
> 
> 赞同：1
> 
> 时间：2009-03-08T23:35:00.037
> 
> 标签：c#, breadth-first-search

现在我的循环是

```
for (TreeNode n = e.Node.FirstNode; n != null; n = n.NextNode) 
```

我的数据类似于

```
a
    a1
    a2
b
    b1 
```

我只想枚举宽度（a、b 等，而不是 a1、a2 等）。我该怎么做呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T23:53:38.620

广度优先枚举通常通过使用某种队列作为辅助数据结构来完成。

首先将根推入队列。然后，虽然队列中有一些东西：

*   从队列的前面弹出第一个项目。
*   将其子项推到队列的末尾。
*   处理您弹出的项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T23:55:09.927

尝试

```
foreach (TreeNode n in e.Node.Parent.Nodes) 
```

您可能必须检查 null 父级并使用

```
TreeNodeCollection nodes;
if(e.Node.Parent != null)
{
    nodes = e.Node.Parent.Nodes;
}
else
{
    nodes = e.Node.TreeView.Nodes;
} 
```

这应该涵盖广度优先算法（抱歉我没有测试过）

```
Queue<TreeNode> currentLevel = new Queue<TreeNode>( nodes );
Queue<TreeNode> nextLevel = new Queue<TreeNode>();

while( currentLevel.Count > 0 )
{
    while( currentLevel.Count > 0 )
    {
        TreeNode n = currentLevel.Dequeue();

        // Add child items to next level
        foreach( TreeNode child in n.Nodes )
        {
            nextLevel.Enqueue( child );
        }
    }
    // Switch to next level
    currentLevel = nextLevel;
    nextLevel = new Queue<TreeNode>();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-06-07T09:31:09.030

修改 bstoney 提供的代码 1\. 将根节点推送到 currentLevel 队列 2\. 标记 nextLevel = new Queue();

```
 Queue<TreeNode> currentLevel = new Queue<TreeNode>();
        Queue<TreeNode> nextLevel = new Queue<TreeNode>();
        // 1\. push root to the queue
        currentLevel.Enqueue(treeView1.Nodes[0]);

        // pop the first item from the front of the queue
        while (currentLevel.Count > 0)
        {
            while (currentLevel.Count > 0)
            {
                TreeNode n = currentLevel.Dequeue();
                Console.WriteLine(n.Text);

                // Add child items to next level
                foreach (TreeNode child in n.Nodes)
                {
                    nextLevel.Enqueue(child);
                }

            }
            // Switch to next level
            currentLevel = nextLevel;
            // 2\. mark this line 
            //nextLevel = new Queue<TreeNode>();
        } 
```

# iphone - 如何在 TextMate 中添加 iPhone SDK 类以自动完成？

> ID：624568
> 
> 赞同：4
> 
> 时间：2009-03-08T23:38:30.200
> 
> 标签：iphone, textmate

如果可能的话，我怎样才能让 iPhone SDK 的类 (UI*) 在 TextMate 中自动完成？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-13T14:45:07.793

好的，在查看了 Kendall 发布的链接和其他一些地方之后，这就是我发现的：

目前没有简单的方法可以在 TextMate 中自动完成 iPhone API。

Kendall 指出的帖子上的链接很旧，但我在 gitHub 上找到了它和另一个 iPhone Bundle：http: [//github.com/Caged/gtbfm-textmate-bundle](http://github.com/Caged/gtbfm-textmate-bundle)
[http://github.com/drnic/objective-c -iphone-tmbundle](http://github.com/drnic/objective-c-iphone-tmbundle)

但是这些包都没有提供自动完成功能，它们有一些模板和片段。

我发现的最接近的是来自 TextMate 的 svn 存储库：http: [//svn.textmate.org/trunk/Review/Bundles/iPhone.tmbundle](http://svn.textmate.org/trunk/Review/Bundles/iPhone.tmbundle)

它还不是官方的，我已经向开发者 (Joachim Mårtensson) 报告了一些问题。您可以使用此捆绑包进行自动完成，但它仅适用于类文件，而不适用于标题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T07:43:36.507

试试这个帖子底部的链接：

[http://groups.google.com/group/google-toolbox-for-mac/browse_thread/thread/e097e998674231fa](http://groups.google.com/group/google-toolbox-for-mac/browse_thread/thread/e097e998674231fa)

# erlang - 从网络分区进行在线记忆恢复

> ID：624570
> 
> 赞同：19
> 
> 时间：2009-03-08T23:40:33.720
> 
> 标签：erlang, mnesia

是否可以在不重新启动任何相关节点的情况下从 mnesia 集群中的网络分区中恢复？如果是这样，如何去做呢？

我特别想知道：

*   如何使用标准 OTP mnesia (v4.4.7) 完成此操作
*   如果有人需要编写什么自定义代码来实现这一点（例如订阅 mnesia running_paritioned_network 事件，确定一个新的主节点，将非主节点的记录合并到主节点，从新主节点强制加载表，清除正在运行的分区网络事件 -示例代码将不胜感激）。
*   或者，mnesia 绝对不支持在线恢复，并且需要重新启动属于非主分区的节点。

虽然我很欣赏一般分布式系统理论的指针，但在这个问题上，我只对 erlang/OTP mnesia 感兴趣。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-06T04:46:37.760

经过一些实验，我发现了以下内容：

*   如果两个节点之间存在节点断开连接和重新连接而没有重新启动 mnesia，则 Mnesia 认为网络是分区的。
*   即使在断开连接期间没有发生 Mnesia 读/写操作也是如此。
*   必须重新启动 Mnesia 本身才能清除分区网络事件 - 在网络分区后您不能这样`force_load_table`做。
*   只有 Mnesia 需要重新启动才能清除网络分区事件。您不需要重新启动整个节点。
*   Mnesia 通过让新重新启动的 Mnesia 节点用来自另一个 Mnesia 节点的数据（启动表加载算法）覆盖其表数据来解决网络分区问题。
*   通常，节点会从运行时间最长的节点复制表（这是我看到的行为，我还没有验证这是明确编码的，而不是其他东西的副作用）。如果你从集群中断开一个节点，在两个分区（断开的节点和它的旧对等节点）中进行写入，关闭所有节点并重新启动它们，首先启动断开的节点，断开的节点将被认为是主节点和它的数据将覆盖所有其他节点。没有表比较/校验和/仲裁行为。

`mnesia:stop(), mnesia:start()`因此，为了回答我的问题，可以通过在您决定丢弃其数据的分区（我将其称为丢失分区）中的节点上执行来执行半在线恢复。执行`mnesia:start()`调用将导致节点联系分区另一侧的节点。如果丢失分区中有多个节点，您可能希望将主节点设置为将表加载到获胜分区中的节点 - 否则我认为它有可能从丢失分区中的另一个节点加载表，因此返回分区网络状态。

不幸的是，mnesia 不支持在启动表加载阶段合并/协调表内容，也不支持在启动后返回表加载阶段。

合并阶段尤其适用于 ejabberd，因为节点仍将具有用户连接，因此知道它拥有/应该是最新的用户记录（假设每个集群有一个用户连接）。如果存在合并阶段，节点可以过滤用户数据表，保存连接用户的所有记录，照常加载表，然后将保存的记录写回 mnesia 集群。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T06:56:45.297

它是这样工作的。想象一下满天飞鸟。拍照，直到你得到所有的鸟。把图片放在桌子上。将图片相互映射。所以你看到每只鸟一次。你看到每只鸟吗？行。那你知道，那个时候。系统稳定。记录所有鸟儿的声音（信息）并拍摄更多照片。然后重复。

如果你有一个节点拆分。返回到最新的常用稳定快照。并尝试** 重播之后附加的内容。:)

在“分布式快照：确定分布式系统的全局状态”K. MANI CHANDY 和 LESLIE LAMPORT 中有更好的描述

** 我认为在尝试重播发生的事情时决定谁的时钟存在问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T08:35:16.807

Sara 的回答很棒，甚至可以查看有关[CAP](http://floatingpoint.tinou.com/2007/01/cap_consistency.html)的文章。Mnesia 开发人员为 CA 牺牲了 P。如果你需要 P，那么你应该选择你想要牺牲的 CAP，而不是选择另一个存储。例如[CouchDB](http://couchdb.apache.org/)（牺牲 C）或[Scalaris](http://code.google.com/p/scalaris/)（牺牲 A）。

# php - 使用 php 将内容动态插入到 pdf 文件中

> ID：624578
> 
> 赞同：2
> 
> 时间：2009-03-08T23:48:29.757
> 
> 标签：php, pdf

我有一本电子书，我在分发给客户之前将其转换为 PDF。我想将他们的电子邮件地址动态插入到电子书的所有链接中，以允许他们访问我网站上的仅限会员的内容，并且我想动态地执行此操作，作为图书下载过程的一部分。

我已经简要地查看了[http://us.php.net/pdf](http://us.php.net/pdf)和 FPDF，但我想知道我将使用什么特定技术来插入这些数据。

我在想我会在我想要电子邮件地址的地方插入一个电子邮件令牌字符串，然后使用一些函数来更新 PDF 文档中的这些令牌。

谁能指出我正确的方向？我有 php 经验，但没有从 php 编辑/生成 pdf 文档。

编辑：是的，这个商业脚本[http://www.setasign.de/products/pdf-php-solutions/setapdf-linkreplacer/](http://www.setasign.de/products/pdf-php-solutions/setapdf-linkreplacer/)正是我需要的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T20:37:24.043

到目前为止，看起来这是我最好的选择：

[http://www.setasign.de/products/pdf-php-solutions/setapdf-linkreplacer/](http://www.setasign.de/products/pdf-php-solutions/setapdf-linkreplacer/)

尝试它的 eval 副本，将使用结果更新帖子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T09:19:32.753

您可以使用 FPDF 的 FPDI 扩展来做到这一点[http://www.setasign.de/products/pdf-php-solutions/fpdi/](http://www.setasign.de/products/pdf-php-solutions/fpdi/)

它使 fpdf 能够导入现有的 pdf 文件，但我不确定如何替换链接。

我想说你最好的办法是在 php 中生成整个东西，或者只是将它保存在 html 中，替换 html 中的链接，然后将 html 转换为 pdf。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T02:09:34.667

在不使用 Adob​​e LiveCycle Designer 的情况下，生成自定义 PDF 的最简单方法是使用 FDF 文件。有很多方法可以做到这一点，其中之一是从 Adob​​e 下载二进制文件并将它们安装在您的服务器上。但这些都不是真正需要的。您所需要的只是一个带有可填写表格的 pdf 和一个制作 FDF 文件的简单脚本。FDF 只保存需要填写的数据和指向要填写的 pdf 文件的指针。我在工作中使用它作为我们的时间表。数据进入 Web 表单，但必须是静态的、丑陋的，并且使用 30 年前的论文。这是您的 fdf 文件的样子（包括代码和原始文件）：

```
 $file = "http://www.example.com/blankpdfform.pdf";
 $data = "%FDF-1.2\n%âãÏÓ\n1 0 obj\n<< \n/FDF << /Fields [ ";
 foreach($datafields as $field => $val) {

      $data.='<< /T ('.$field.') /V ('.trim($val).')>> ';
 }

 $data.="] \n/F (".$file.") /ID [ <".md5(time()).">\n] >>".
      " \n>> \nendobj\ntrailer\n".
      "<<\n/Root 1 0 R \n\n>>\n%%EOF\n"; 
```

最终结果是：

```
 %FDF-1.2\n%âãÏÓ\n1 0 obj\n<< \n/FDF << /Fields [<< /T (email) /V (email@address.com)>>
 /F ("http://www.example.com/blankpdfform.pdf") /ID [ <"SomeUniqueID">
 ] >> \nendobj\ntrailer<<
 /Root 1 0 R 
 >>
 %%EOF 
```

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-03-09T00:04:12.590

如果您将带有电子邮件令牌的 PDF 模板存储在网络服务器上的文件中，则可以相当轻松地完成此操作。首先，您需要使用 PHP 读取文件。您可以使用 file_get_contents 方法执行此操作。然后使用 str_replace 将电子邮件令牌替换为实际电子邮件。最后，使用正确的内容类型提供文件。

```
$pdf = file_get_contents( 'template.pdf' );
$pdf = str_replace( '__EMAIL__TEMPLATE__', $userEmail, $pdf );
header( 'Content-type: application/pdf' );
print $pdf; 
```

文档链接： http: [//ca2.php.net/manual/en/function.file-get-contents.php](http://ca2.php.net/manual/en/function.file-get-contents.php) [http://ca2.php.net/manual/en/function.str-replace.php](http://ca2.php.net/manual/en/function.str-replace.php)

（我实际上没有尝试过这个，你可能会遇到一些问题，因为 PDF 是一种二进制格式，但理论上它应该可以工作......）

# php - 如果复选框/单选按钮和选项是由 PHP 设置的，为什么它们不能重置？

> ID：624580
> 
> 赞同：2
> 
> 时间：2009-03-08T23:50:41.747
> 
> 标签：php, xhtml, reset

使用 XHTML 1.1

我在 php 中管理了这个登录页面。它包含几个复选框、单选按钮和一个下拉列表。

它背后有很多表单检查，如果没有检查出来，页面会重新加载，所有值都会被填充回原位，除了密码。

这意味着已选择的 和 元素被重新`<select>`选择`<input type="radio"`。`<input type="checkbox"`

然而，当我查看源代码时，缺少`checked="checked"`和部分。`selected="selected"`但是看看重新加载的页面是如何选择它们的，它们肯定已经实现了。

然而，当我点击我的`<input type="reset"`按钮时，什么也没有发生。不要被取消选中。

有趣的是，当我选择其他一些复选框、单选按钮并更改选择时，重置确实有效，但仅适用于新单击的复选框和单选按钮。

更奇怪的是，当我单击重置时，单选按钮、复选框和选择不会自行清除，它们会跳回到 PHP 强制页面重新加载时选中或选中的那个。

这里发生了什么？

顺便用firefox，现在检查IE。

编辑： IE 同样的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T00:09:34.260

如果您使用“查看源代码”并且脚本设置了激进`no-cache`的标题，那么您可能看不到所显示内容的源代码。在显示实时 DOM 的东西中尝试它，例如 Firebug 或 DOM Inspector。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T23:58:14.617

如果您在 PHP 重新加载后的代码缺少 checked="checked" 和 selected="selected" 属性，那么它们看起来被选中的唯一解释是您的浏览器记住了它们的值并恢复了它们。这可能也解释了其余的行为。我建议确保 PHP 代码正确生成检查/选择的属性，其余的应该自己处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T23:56:44.040

（哪个浏览器？）

无论如何，这种行为（不重置所有控件）是设计使然，否则在 Web 中浏览和填写表单将是一种可怕的体验（大多数表单被一个错误重置）。

还有刷新（如 F5）和“真正的”刷新（Ctrl-F5），它们总是会完全重置页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T00:22:45.820

我不确定您所有问题的原因，但我将简要介绍一下 javascripts 默认表单重置方法的工作原理。

假设您有以下表格：

```
<form id="myForm>
    <input type="text" name="textField1" value="" />
    <input type="text" name="textField2" value="test1" />
    <input type="text" name="textField3" value="test2" />

    <input type="checkbox" name="checkbox1" value="box1" />
    <input type="checkbox" name="checkbox2" value="box2" checked />
</form> 
```

在 textField1 中放置 Foo 在 textField2 中放置 Bar 在 textField2 中放置 Baz

然后您选中两个复选框。然后重置表格

```
myForm.reset(); 
```

表单字段现在将具有以下内容：

textField1="" textField2="test1" textField3="test2"

复选框1=未选中复选框2=已选中

发生的情况是 reset 方法没有“清除”表单，它将它设置回表单的所有默认值。

希望这会有所帮助。

# validation - 最好的 Java 电子邮件地址验证方法是什么？

> ID：624581
> 
> 赞同：247
> 
> 时间：2009-03-08T23:51:47.783
> 
> 标签：validation, email, apache-commons, java

Java 有哪些好的电子邮件地址验证库？是否有任何替代[公共验证器](http://commons.apache.org/proper/commons-validator/apidocs/org/apache/commons/validator/routines/EmailValidator.html)的方法？

* * *

## 回答 #1

> 赞同：261
> 
> 时间：2011-05-09T01:53:03.833

使用[官方的 java email 包](https://java.net/projects/javamail)是最简单的：

```
public static boolean isValidEmailAddress(String email) {
   boolean result = true;
   try {
      InternetAddress emailAddr = new InternetAddress(email);
      emailAddr.validate();
   } catch (AddressException ex) {
      result = false;
   }
   return result;
} 
```

* * *

## 回答 #2

> 赞同：134
> 
> 时间：2009-03-08T23:57:01.030

Apache Commons 通常被称为一个可靠的项目。但是请记住，如果您想确保它是真实的电子邮件并且所有者希望它在您的网站上使用，您仍然必须向该地址发送验证电子邮件。

> **编辑**：有一个[错误](https://issues.apache.org/jira/browse/VALIDATOR-324)，它对域的限制过于严格，导致它不接受来自新 TLD 的有效电子邮件。
> 
> 此错误已于 03/Jan/15 02:48 在**commons-validator**版本 1.4.1中解决

* * *

## 回答 #3

> 赞同：91
> 
> 时间：2014-11-01T08:55:39.170

如其他答案中所述，可以使用 Apache Commons 验证器。

pom.xml：

```
<dependency>
    <groupId>commons-validator</groupId>
    <artifactId>commons-validator</artifactId>
    <version>1.4.1</version>
</dependency> 
```

构建.gradle：

```
compile 'commons-validator:commons-validator:1.4.1' 
```

进口：

```
import org.apache.commons.validator.routines.EmailValidator; 
```

编码：

```
String email = "myName@example.com";
boolean valid = EmailValidator.getInstance().isValid(email); 
```

并允许本地地址

```
boolean allowLocal = true;
boolean valid = EmailValidator.getInstance(allowLocal).isValid(email); 
```

* * *

## 回答 #4

> 赞同：71
> 
> 时间：2013-04-17T10:49:49.773

迟到的答案，但我认为这很简单且值得：

```
 public boolean isValidEmailAddress(String email) {
           String ePattern = "^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$";
           java.util.regex.Pattern p = java.util.regex.Pattern.compile(ePattern);
           java.util.regex.Matcher m = p.matcher(email);
           return m.matches();
    } 
```

**测试用例**：

![在此处输入图像描述](https://i.stack.imgur.com/G7joT.png)

出于生产目的，域名验证应在网络上执行。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2014-06-20T06:08:20.800

如果您尝试从客户端接收表单验证，或者只是 bean 验证 - 保持简单。最好进行松散的电子邮件验证，而不是进行严格的验证并拒绝某些人（例如，当他们试图注册您的 Web 服务时）。由于电子邮件的用户名部分几乎允许使用任何内容，并且每个月都会添加如此多的新域（例如 .company、.entreprise、.estate），因此不进行限制会更安全：

```
Pattern pattern = Pattern.compile("^.+@.+\\..+$");
Matcher matcher = pattern.matcher(email); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-10-30T06:36:22.690

迟到的问题，在这里，但是：我在这个地址维护一个类：http: [//lacinato.com/cm/software/emailrelated/emailaddress](http://lacinato.com/cm/software/emailrelated/emailaddress)

它基于 Les Hazlewood 的课程，但有许多改进并修复了一些错误。阿帕奇许可证。

我相信它是 Java 中功能最强大的电子邮件解析器，而且我还没有看到任何语言的功能更强大，尽管可能有一个。它不是词法分析器风格的解析器，但使用了一些复杂的 java 正则表达式，因此效率不高，但我的公司已经用它解析了超过 100 亿个实际地址：它当然可以用于高性能情况。也许每年一次它会遇到一个导致正则表达式堆栈溢出的地址（适当地），但这些是垃圾邮件地址，它们有数百或数千个字符长，带有许多引号和括号等。

[RFC 2822](http://www.ietf.org/rfc/rfc2822.txt)和相关规范在电子邮件地址方面确实非常宽松，所以像这样的类对于大多数用途来说是多余的。例如，以下是合法地址，根据规范、空格和所有：

```
"<bob \" (here) " < (hi there) "bob(the man)smith" (hi) @ (there) example.com (hello) > (again) 
```

没有邮件服务器允许这样做，但是这个类可以解析它（并将其重写为可用的形式）。

我们发现现有的 Java 电子邮件解析器选项不够耐用（意味着它们都无法解析某些有效地址），因此我们创建了这个类。

该代码有据可查，并且有许多易于更改的选项来允许或禁止某些电子邮件表单。它还提供了许多方法来访问地址的某些部分（左侧、右侧、个人姓名、评论等），解析/验证邮箱列表标题，解析/验证返回路径（这在标题中是唯一的）等等。

编写的代码具有 javamail 依赖项，但如果您不想要它提供的次要功能，则可以轻松删除。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-04-01T02:56:39.507

我只是想知道为什么没有人想出[`@Email`](http://docs.jboss.org/hibernate/validator/5.1/reference/en-US/html/chapter-bean-constraints.html#validator-defineconstraints-hv-constraints)Hibernate Validator 的附加约束。验证器本身是[`EmailValidator`](http://docs.jboss.org/hibernate/validator/5.1/api/org/hibernate/validator/internal/constraintvalidators/EmailValidator.html).

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-08-24T10:49:27.073

Les Hazlewood 使用 Java 正则表达式编写了一个非常彻底的符合 RFC 2822 的电子邮件验证器类。您可以在[http://www.leshazlewood.com/?p=23](http://www.leshazlewood.com/?p=23)找到它。但是，它的彻底性（或 Java RE 实现）导致效率低下 - 请阅读有关长地址解析时间的评论。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-07-12T23:57:00.163

我在 Zend_Validator_Email 中移植了一些代码：

```
@FacesValidator("emailValidator")
public class EmailAddressValidator implements Validator {

    private String localPart;
    private String hostName;
    private boolean domain = true;

    Locale locale;
    ResourceBundle bundle;

    private List<FacesMessage> messages = new ArrayList<FacesMessage>();

    private HostnameValidator hostnameValidator;

    @Override
    public void validate(FacesContext context, UIComponent component, Object value) throws ValidatorException {
        setOptions(component);
        String email    = (String) value;
        boolean result  = true;
        Pattern pattern = Pattern.compile("^(.+)@([^@]+[^.])$");
        Matcher matcher = pattern.matcher(email);

        locale = context.getViewRoot().getLocale();
        bundle = ResourceBundle.getBundle("com.myapp.resources.validationMessages", locale);

        boolean length = true;
        boolean local  = true;

        if (matcher.find()) {
            localPart   = matcher.group(1);
            hostName    = matcher.group(2);

            if (localPart.length() > 64 || hostName.length() > 255) {
                length          = false;
                addMessage("enterValidEmail", "email.AddressLengthExceeded");
            } 

            if (domain == true) {
                hostnameValidator = new HostnameValidator();
                hostnameValidator.validate(context, component, hostName);
            }

            local = validateLocalPart();

            if (local && length) {
                result = true;
            } else {
                result = false;
            }

        } else {
            result          = false;
            addMessage("enterValidEmail", "invalidEmailAddress");
        }

        if (result == false) {
            throw new ValidatorException(messages);
        }

    }

    private boolean validateLocalPart() {
        // First try to match the local part on the common dot-atom format
        boolean result = false;

        // Dot-atom characters are: 1*atext *("." 1*atext)
        // atext: ALPHA / DIGIT / and "!", "#", "$", "%", "&", "'", "*",
        //        "+", "-", "/", "=", "?", "^", "_", "`", "{", "|", "}", "~"
        String atext = "a-zA-Z0-9\\u0021\\u0023\\u0024\\u0025\\u0026\\u0027\\u002a"
                + "\\u002b\\u002d\\u002f\\u003d\\u003f\\u005e\\u005f\\u0060\\u007b"
                + "\\u007c\\u007d\\u007e";
        Pattern regex = Pattern.compile("^["+atext+"]+(\\u002e+["+atext+"]+)*$");
        Matcher matcher = regex.matcher(localPart);
        if (matcher.find()) {
            result = true;
        } else {
            // Try quoted string format

            // Quoted-string characters are: DQUOTE *([FWS] qtext/quoted-pair) [FWS] DQUOTE
            // qtext: Non white space controls, and the rest of the US-ASCII characters not
            //   including "\" or the quote character
            String noWsCtl = "\\u0001-\\u0008\\u000b\\u000c\\u000e-\\u001f\\u007f";
            String qText = noWsCtl + "\\u0021\\u0023-\\u005b\\u005d-\\u007e";
            String ws = "\\u0020\\u0009";

            regex = Pattern.compile("^\\u0022(["+ws+qText+"])*["+ws+"]?\\u0022$");
            matcher = regex.matcher(localPart);
            if (matcher.find()) {
                result = true;
            } else {
                addMessage("enterValidEmail", "email.AddressDotAtom");
                addMessage("enterValidEmail", "email.AddressQuotedString");
                addMessage("enterValidEmail", "email.AddressInvalidLocalPart");
            }
        }

        return result;
    }

    private void addMessage(String detail, String summary) {
        String detailMsg = bundle.getString(detail);
        String summaryMsg = bundle.getString(summary);
        messages.add(new FacesMessage(FacesMessage.SEVERITY_ERROR, summaryMsg, detailMsg));
    }

    private void setOptions(UIComponent component) {
        Boolean domainOption = Boolean.valueOf((String) component.getAttributes().get("domain"));
        //domain = (domainOption == null) ? true : domainOption.booleanValue();
    }
} 
```

使用主机名验证器，如下所示：

```
@FacesValidator("hostNameValidator")
public class HostnameValidator implements Validator {

    private Locale locale;
    private ResourceBundle bundle;
    private List<FacesMessage> messages;
    private boolean checkTld = true;
    private boolean allowLocal = false;
    private boolean allowDNS = true;
    private String tld;
    private String[] validTlds = {"ac", "ad", "ae", "aero", "af", "ag", "ai",
        "al", "am", "an", "ao", "aq", "ar", "arpa", "as", "asia", "at", "au",
        "aw", "ax", "az", "ba", "bb", "bd", "be", "bf", "bg", "bh", "bi", "biz",
        "bj", "bm", "bn", "bo", "br", "bs", "bt", "bv", "bw", "by", "bz", "ca",
        "cat", "cc", "cd", "cf", "cg", "ch", "ci", "ck", "cl", "cm", "cn", "co",
        "com", "coop", "cr", "cu", "cv", "cx", "cy", "cz", "de", "dj", "dk",
        "dm", "do", "dz", "ec", "edu", "ee", "eg", "er", "es", "et", "eu", "fi",
        "fj", "fk", "fm", "fo", "fr", "ga", "gb", "gd", "ge", "gf", "gg", "gh",
        "gi", "gl", "gm", "gn", "gov", "gp", "gq", "gr", "gs", "gt", "gu", "gw",
        "gy", "hk", "hm", "hn", "hr", "ht", "hu", "id", "ie", "il", "im", "in",
        "info", "int", "io", "iq", "ir", "is", "it", "je", "jm", "jo", "jobs",
        "jp", "ke", "kg", "kh", "ki", "km", "kn", "kp", "kr", "kw", "ky", "kz",
        "la", "lb", "lc", "li", "lk", "lr", "ls", "lt", "lu", "lv", "ly", "ma",
        "mc", "md", "me", "mg", "mh", "mil", "mk", "ml", "mm", "mn", "mo",
        "mobi", "mp", "mq", "mr", "ms", "mt", "mu", "museum", "mv", "mw", "mx",
        "my", "mz", "na", "name", "nc", "ne", "net", "nf", "ng", "ni", "nl",
        "no", "np", "nr", "nu", "nz", "om", "org", "pa", "pe", "pf", "pg", "ph",
        "pk", "pl", "pm", "pn", "pr", "pro", "ps", "pt", "pw", "py", "qa", "re",
        "ro", "rs", "ru", "rw", "sa", "sb", "sc", "sd", "se", "sg", "sh", "si",
        "sj", "sk", "sl", "sm", "sn", "so", "sr", "st", "su", "sv", "sy", "sz",
        "tc", "td", "tel", "tf", "tg", "th", "tj", "tk", "tl", "tm", "tn", "to",
        "tp", "tr", "travel", "tt", "tv", "tw", "tz", "ua", "ug", "uk", "um",
        "us", "uy", "uz", "va", "vc", "ve", "vg", "vi", "vn", "vu", "wf", "ws",
        "ye", "yt", "yu", "za", "zm", "zw"};
    private Map<String, Map<Integer, Integer>> idnLength;

    private void init() {
        Map<Integer, Integer> biz = new HashMap<Integer, Integer>();
        biz.put(5, 17);
        biz.put(11, 15);
        biz.put(12, 20);

        Map<Integer, Integer> cn = new HashMap<Integer, Integer>();
        cn.put(1, 20);

        Map<Integer, Integer> com = new HashMap<Integer, Integer>();
        com.put(3, 17);
        com.put(5, 20);

        Map<Integer, Integer> hk = new HashMap<Integer, Integer>();
        hk.put(1, 15);

        Map<Integer, Integer> info = new HashMap<Integer, Integer>();
        info.put(4, 17);

        Map<Integer, Integer> kr = new HashMap<Integer, Integer>();
        kr.put(1, 17);

        Map<Integer, Integer> net = new HashMap<Integer, Integer>();
        net.put(3, 17);
        net.put(5, 20);

        Map<Integer, Integer> org = new HashMap<Integer, Integer>();
        org.put(6, 17);

        Map<Integer, Integer> tw = new HashMap<Integer, Integer>();
        tw.put(1, 20);

        Map<Integer, Integer> idn1 = new HashMap<Integer, Integer>();
        idn1.put(1, 20);

        Map<Integer, Integer> idn2 = new HashMap<Integer, Integer>();
        idn2.put(1, 20);

        Map<Integer, Integer> idn3 = new HashMap<Integer, Integer>();
        idn3.put(1, 20);

        Map<Integer, Integer> idn4 = new HashMap<Integer, Integer>();
        idn4.put(1, 20);

        idnLength = new HashMap<String, Map<Integer, Integer>>();

        idnLength.put("BIZ", biz);
        idnLength.put("CN", cn);
        idnLength.put("COM", com);
        idnLength.put("HK", hk);
        idnLength.put("INFO", info);
        idnLength.put("KR", kr);
        idnLength.put("NET", net);
        idnLength.put("ORG", org);
        idnLength.put("TW", tw);
        idnLength.put("ایران", idn1);
        idnLength.put("中国", idn2);
        idnLength.put("公司", idn3);
        idnLength.put("网络", idn4);

        messages = new ArrayList<FacesMessage>();
    }

    public HostnameValidator() {
        init();
    }

    @Override
    public void validate(FacesContext context, UIComponent component, Object value) throws ValidatorException {
        String hostName = (String) value;

        locale = context.getViewRoot().getLocale();
        bundle = ResourceBundle.getBundle("com.myapp.resources.validationMessages", locale);

        Pattern ipPattern = Pattern.compile("^[0-9a-f:\\.]*$", Pattern.CASE_INSENSITIVE);
        Matcher ipMatcher = ipPattern.matcher(hostName);
        if (ipMatcher.find()) {
            addMessage("hostname.IpAddressNotAllowed");
            throw new ValidatorException(messages);
        }

        boolean result = false;

        // removes last dot (.) from hostname 
        hostName = hostName.replaceAll("(\\.)+$", "");
        String[] domainParts = hostName.split("\\.");

        boolean status = false;

        // Check input against DNS hostname schema
        if ((domainParts.length > 1) && (hostName.length() > 4) && (hostName.length() < 255)) {
            status = false;

            dowhile:
            do {
                // First check TLD
                int lastIndex = domainParts.length - 1;
                String domainEnding = domainParts[lastIndex];
                Pattern tldRegex = Pattern.compile("([^.]{2,10})", Pattern.CASE_INSENSITIVE);
                Matcher tldMatcher = tldRegex.matcher(domainEnding);
                if (tldMatcher.find() || domainEnding.equals("ایران")
                        || domainEnding.equals("中国")
                        || domainEnding.equals("公司")
                        || domainEnding.equals("网络")) {

                    // Hostname characters are: *(label dot)(label dot label); max 254 chars
                    // label: id-prefix [*ldh{61} id-prefix]; max 63 chars
                    // id-prefix: alpha / digit
                    // ldh: alpha / digit / dash

                    // Match TLD against known list
                    tld = (String) tldMatcher.group(1).toLowerCase().trim();
                    if (checkTld == true) {
                        boolean foundTld = false;
                        for (int i = 0; i < validTlds.length; i++) {
                            if (tld.equals(validTlds[i])) {
                                foundTld = true;
                            }
                        }

                        if (foundTld == false) {
                            status = false;
                            addMessage("hostname.UnknownTld");
                            break dowhile;
                        }
                    }

                    /**
                     * Match against IDN hostnames
                     * Note: Keep label regex short to avoid issues with long patterns when matching IDN hostnames
                     */
                    List<String> regexChars = getIdnRegexChars();

                    // Check each hostname part
                    int check = 0;
                    for (String domainPart : domainParts) {
                        // Decode Punycode domainnames to IDN
                        if (domainPart.indexOf("xn--") == 0) {
                            domainPart = decodePunycode(domainPart.substring(4));
                        }

                        // Check dash (-) does not start, end or appear in 3rd and 4th positions
                        if (domainPart.indexOf("-") == 0
                                || (domainPart.length() > 2 && domainPart.indexOf("-", 2) == 2 && domainPart.indexOf("-", 3) == 3)
                                || (domainPart.indexOf("-") == (domainPart.length() - 1))) {
                            status = false;
                            addMessage("hostname.DashCharacter");
                            break dowhile;
                        }

                        // Check each domain part
                        boolean checked = false;

                        for (int key = 0; key < regexChars.size(); key++) {
                            String regexChar = regexChars.get(key);
                            Pattern regex = Pattern.compile(regexChar);
                            Matcher regexMatcher = regex.matcher(domainPart);
                            status = regexMatcher.find();
                            if (status) {
                                int length = 63;

                                if (idnLength.containsKey(tld.toUpperCase())
                                        && idnLength.get(tld.toUpperCase()).containsKey(key)) {
                                    length = idnLength.get(tld.toUpperCase()).get(key);
                                }

                                int utf8Length;
                                try {
                                    utf8Length = domainPart.getBytes("UTF8").length;
                                    if (utf8Length > length) {
                                        addMessage("hostname.InvalidHostname");
                                    } else {
                                        checked = true;
                                        break;
                                    }
                                } catch (UnsupportedEncodingException ex) {
                                    Logger.getLogger(HostnameValidator.class.getName()).log(Level.SEVERE, null, ex);
                                }

                            }
                        }

                        if (checked) {
                            ++check;
                        }
                    }

                    // If one of the labels doesn't match, the hostname is invalid
                    if (check != domainParts.length) {
                        status = false;
                        addMessage("hostname.InvalidHostnameSchema");

                    }
                } else {
                    // Hostname not long enough
                    status = false;
                    addMessage("hostname.UndecipherableTld");
                }

            } while (false);

            if (status == true && allowDNS) {
                result = true;
            }

        } else if (allowDNS == true) {
            addMessage("hostname.InvalidHostname");
            throw new ValidatorException(messages);
        }

        // Check input against local network name schema;
        Pattern regexLocal = Pattern.compile("^(([a-zA-Z0-9\\x2d]{1,63}\\x2e)*[a-zA-Z0-9\\x2d]{1,63}){1,254}$", Pattern.CASE_INSENSITIVE);
        boolean checkLocal = regexLocal.matcher(hostName).find();
        if (allowLocal && !status) {
            if (checkLocal) {
                result = true;
            } else {
                // If the input does not pass as a local network name, add a message
                result = false;
                addMessage("hostname.InvalidLocalName");
            }
        }

        // If local network names are not allowed, add a message
        if (checkLocal && !allowLocal && !status) {
            result = false;
            addMessage("hostname.LocalNameNotAllowed");
        }

        if (result == false) {
            throw new ValidatorException(messages);
        }

    }

    private void addMessage(String msg) {
        String bundlMsg = bundle.getString(msg);
        messages.add(new FacesMessage(FacesMessage.SEVERITY_ERROR, bundlMsg, bundlMsg));
    }

    /**
     * Returns a list of regex patterns for the matched TLD
     * @param tld
     * @return 
     */
    private List<String> getIdnRegexChars() {
        List<String> regexChars = new ArrayList<String>();
        regexChars.add("^[a-z0-9\\x2d]{1,63}$");
        Document doc = null;
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setNamespaceAware(true);

        try {
            InputStream validIdns = getClass().getClassLoader().getResourceAsStream("com/myapp/resources/validIDNs_1.xml");
            DocumentBuilder builder = factory.newDocumentBuilder();
            doc = builder.parse(validIdns);
            doc.getDocumentElement().normalize();
        } catch (SAXException ex) {
            Logger.getLogger(HostnameValidator.class.getName()).log(Level.SEVERE, null, ex);
        } catch (IOException ex) {
            Logger.getLogger(HostnameValidator.class.getName()).log(Level.SEVERE, null, ex);
        } catch (ParserConfigurationException ex) {
            Logger.getLogger(HostnameValidator.class.getName()).log(Level.SEVERE, null, ex);
        }

        // prepare XPath
        XPath xpath = XPathFactory.newInstance().newXPath();

        NodeList nodes = null;
        String xpathRoute = "//idn[tld=\'" + tld.toUpperCase() + "\']/pattern/text()";

        try {
            XPathExpression expr;
            expr = xpath.compile(xpathRoute);
            Object res = expr.evaluate(doc, XPathConstants.NODESET);
            nodes = (NodeList) res;
        } catch (XPathExpressionException ex) {
            Logger.getLogger(HostnameValidator.class.getName()).log(Level.SEVERE, null, ex);
        }

        for (int i = 0; i < nodes.getLength(); i++) {
            regexChars.add(nodes.item(i).getNodeValue());
        }

        return regexChars;
    }

    /**
     * Decode Punycode string
     * @param encoded
     * @return 
         */
    private String decodePunycode(String encoded) {
        Pattern regex = Pattern.compile("([^a-z0-9\\x2d]{1,10})", Pattern.CASE_INSENSITIVE);
        Matcher matcher = regex.matcher(encoded);
        boolean found = matcher.find();

        if (encoded.isEmpty() || found) {
            // no punycode encoded string, return as is
            addMessage("hostname.CannotDecodePunycode");
            throw new ValidatorException(messages);
        }

        int separator = encoded.lastIndexOf("-");
            List<Integer> decoded = new ArrayList<Integer>();
        if (separator > 0) {
            for (int x = 0; x < separator; ++x) {
                decoded.add((int) encoded.charAt(x));
            }
        } else {
            addMessage("hostname.CannotDecodePunycode");
            throw new ValidatorException(messages);
        }

        int lengthd = decoded.size();
        int lengthe = encoded.length();

        // decoding
        boolean init = true;
        int base = 72;
        int index = 0;
        int ch = 0x80;

        int indexeStart = (separator == 1) ? (separator + 1) : 0;
        for (int indexe = indexeStart; indexe < lengthe; ++lengthd) {
            int oldIndex = index;
            int pos = 1;
            for (int key = 36; true; key += 36) {
                int hex = (int) encoded.charAt(indexe++);
                int digit = (hex - 48 < 10) ? hex - 22
                        : ((hex - 65 < 26) ? hex - 65
                        : ((hex - 97 < 26) ? hex - 97
                        : 36));

                index += digit * pos;
                int tag = (key <= base) ? 1 : ((key >= base + 26) ? 26 : (key - base));
                if (digit < tag) {
                    break;
                }
                pos = (int) (pos * (36 - tag));
            }
            int delta = (int) (init ? ((index - oldIndex) / 700) : ((index - oldIndex) / 2));
            delta += (int) (delta / (lengthd + 1));
            int key;
            for (key = 0; delta > 910; key += 36) {
                delta = (int) (delta / 35);
            }
            base = (int) (key + 36 * delta / (delta + 38));
            init = false;
            ch += (int) (index / (lengthd + 1));
            index %= (lengthd + 1);
            if (lengthd > 0) {
                for (int i = lengthd; i > index; i--) {
                    decoded.set(i, decoded.get(i - 1));
                }
            }

            decoded.set(index++, ch);
        }

        // convert decoded ucs4 to utf8 string
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < decoded.size(); i++) {
            int value = decoded.get(i);
            if (value < 128) {
                sb.append((char) value);
            } else if (value < (1 << 11)) {
                sb.append((char) (192 + (value >> 6)));
                sb.append((char) (128 + (value & 63)));
            } else if (value < (1 << 16)) {
                sb.append((char) (224 + (value >> 12)));
                sb.append((char) (128 + ((value >> 6) & 63)));
                sb.append((char) (128 + (value & 63)));
            } else if (value < (1 << 21)) {
                sb.append((char) (240 + (value >> 18)));
                sb.append((char) (128 + ((value >> 12) & 63)));
                sb.append((char) (128 + ((value >> 6) & 63)));
                sb.append((char) (128 + (value & 63)));
            } else {
                addMessage("hostname.CannotDecodePunycode");
                throw new ValidatorException(messages);
            }
        }

        return sb.toString();

    }

    /**
     * Eliminates empty values from input array
     * @param data
     * @return 
     */
    private String[] verifyArray(String[] data) {
        List<String> result = new ArrayList<String>();
        for (String s : data) {
            if (!s.equals("")) {
                result.add(s);
            }
        }

        return result.toArray(new String[result.size()]);
    }
} 
```

以及带有不同 tld 的正则表达式模式的 validIDNs.xml（太大而无法包含：）

```
<idnlist>
    <idn>
        <tld>AC</tld>
        <pattern>^[\u002d0-9a-zà-öø-ÿāăąćĉċčďđēėęěĝġģĥħīįĵķĺļľŀłńņňŋőœŕŗřśŝşšţťŧūŭůűųŵŷźżž]{1,63}$</pattern>
    </idn>
    <idn>
        <tld>AR</tld>
        <pattern>^[\u002d0-9a-zà-ãç-êìíñ-õü]{1,63}$</pattern>
    </idn>
    <idn>
        <tld>AS</tld>
        <pattern>/^[\u002d0-9a-zà-öø-ÿāăąćĉċčďđēĕėęěĝğġģĥħĩīĭįıĵķĸĺļľłńņňŋōŏőœŕŗřśŝşšţťŧũūŭůűųŵŷźż]{1,63}$</pattern>
    </idn>
    <idn>
        <tld>AT</tld>
        <pattern>/^[\u002d0-9a-zà-öø-ÿœšž]{1,63}$</pattern>
    </idn>
    <idn>
        <tld>BIZ</tld>
        <pattern>^[\u002d0-9a-zäåæéöøü]{1,63}$</pattern>
        <pattern>^[\u002d0-9a-záéíñóúü]{1,63}$</pattern>
        <pattern>^[\u002d0-9a-záéíóöúüőű]{1,63}$</pattern>
    </id>
</idlist> 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-07-05T06:47:27.880

```
public class Validations {

    private Pattern regexPattern;
    private Matcher regMatcher;

    public String validateEmailAddress(String emailAddress) {

        regexPattern = Pattern.compile("^[(a-zA-Z-0-9-\\_\\+\\.)]+@[(a-z-A-z)]+\\.[(a-zA-z)]{2,3}$");
        regMatcher   = regexPattern.matcher(emailAddress);
        if(regMatcher.matches()) {
            return "Valid Email Address";
        } else {
            return "Invalid Email Address";
        }
    }

    public String validateMobileNumber(String mobileNumber) {
        regexPattern = Pattern.compile("^\\+[0-9]{2,3}+-[0-9]{10}$");
        regMatcher   = regexPattern.matcher(mobileNumber);
        if(regMatcher.matches()) {
            return "Valid Mobile Number";
        } else {
            return "Invalid Mobile Number";
        }
    }

    public static void main(String[] args) {

        String emailAddress = "suryaprakash.pisay@gmail.com";
        String mobileNumber = "+91-9986571622";
        Validations validations = new Validations();
        System.out.println(validations.validateEmailAddress(emailAddress));
        System.out.println(validations.validateMobileNumber(mobileNumber));
    }
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-09T10:16:56.517

如果您正在寻找验证电子邮件地址是否有效，那么[VRFY](http://cr.yp.to/smtp/vrfy.html)将为您提供一些帮助。我发现它对于验证*Intranet*地址（即内部站点的电子邮件地址）很有用。但是它对 Internet 邮件服务器的用处不大（请参阅本页顶部的警告）

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-12-29T09:43:23.880

尽管 Apache commons 有许多替代方案，但它们的实现充其量只是基本的（就像[Apache commons 的实现](https://github.com/apache/commons-validator/blob/trunk/src/main/java/org/apache/commons/validator/EmailValidator.java)本身），在其他情况下甚至是完全错误的。

我也会远离所谓的简单“非限制性”正则表达式；没有这样的事情。例如[@ 被允许多次](https://stackoverflow.com/questions/12355858/how-many-symbol-can-be-in-an-email-address)取决于上下文，你怎么知道需要的那个？简单的正则表达式不会理解它，即使电子邮件应该是有效的。任何[更复杂](http://girders.org/blog/2013/01/31/dont-rfc-validate-email-addresses/)的东西都容易[出错](https://davidcel.is/posts/stop-validating-email-addresses-with-regex/)，甚至包含[隐藏的性能杀手](https://github.com/bbottema/email-rfc2822-validator/issues/4)。你将如何维护这样的[东西](https://stackoverflow.com/questions/201323/using-a-regular-expression-to-validate-an-email-address/719543#719543)？

我知道的唯一全面的 RFC 兼容的基于正则表达式的验证器是[email-rfc2822-validator](https://github.com/bbottema/email-rfc2822-validator)，它的“精炼”正则表达式适当地命名为[Dragons.java](https://github.com/bbottema/email-rfc2822-validator/blob/master/src/main/java/org/hazlewood/connor/bottema/emailaddress/Dragons.java)。虽然它只支持较旧的[RFC-2822](https://www.rfc-editor.org/rfc/rfc2822)规范，但足以满足现代需求（RFC-5322在已经超出日常用例范围的领域对其进行了[*更新）。*](https://www.rfc-editor.org/rfc/rfc5322#appendix-B)

但**[您真正想要](https://github.com/bbottema/email-rfc2822-validator/issues/2#issuecomment-189153764)**的是一个能够正确解析字符串并根据 RFC 语法将其分解为组件结构**的词法分析器。**[EmailValidator4J](https://github.com/egulias/EmailValidator4J)在这方面看起来很有希望，但仍然年轻且有限。

另一个选择是使用 Web 服务，例如 Mailgun 久经考验的[验证 Web](https://www.mailgun.com/email-validation)服务或[Mailboxlayer API](https://mailboxlayer.com/)（刚刚获得了第一个 Google 结果）。它并不严格符合 RFC，但足以满足现代需求。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-09T01:09:41.650

你想验证什么？电子邮件地址？

只能检查电子邮件地址的格式一致性。请参阅标准：[RFC2822](https://www.rfc-editor.org/rfc/rfc2822#page-16)。最好的方法是使用正则表达式。如果不发送电子邮件，您永远不会知道是否真的存在。

我检查了公共验证器。它包含一个 org.apache.commons.validator.EmailValidator 类。似乎是一个很好的起点。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-04-03T17:55:31.683

当前的 Apache Commons Validator 版本是[1.3.1](http://commons.apache.org/validator/download_validator.cgi)。

验证的类是 org.apache.commons.validator.EmailValidator。[它有一个 org.apache.oro.text.perl.Perl5Util 的导入，](http://kickjava.com/src/org/apache/commons/validator/EmailValidator.java.htm)它来自一个退休的[Jakarta ORO 项目](http://jakarta.apache.org/oro/)。

顺便说一句，我发现有一个 1.4 版本，[这里是 API 文档](http://commons.apache.org/validator/apidocs/org/apache/commons/validator/routines/EmailValidator.html)。[网站](http://commons.apache.org/validator/)上写着：“上次发布时间：2008 年 3 月 5 日 | 版本：1.4-SNAPSHOT”，但这不是最终版本。构建自己的唯一方法（但这是一个快照，而不是 RELEASE）和使用，或从[这里](http://apache-commons.680414.n4.nabble.com/validator-download-1-4-version-td2298390.html)下载。这意味着 1.4 已经三年（2008-2011）没有定稿。这不是 Apache 的风格。我正在寻找一个更好的选择，但没有找到一个非常受欢迎的选择。我想使用经过良好测试的东西，不想遇到任何错误。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-11-09T15:39:54.903

您可能还想检查长度 - 电子邮件最长为 254 个字符。我使用 apache commons 验证器，它不检查这个。

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2013-09-30T22:03:41.487

似乎没有任何完美的库或方法可以自己执行此操作，除非您必须有时间向电子邮件地址发送电子邮件并等待回复（尽管这可能不是一个选项）。我最终使用了来自这里的建议 [http://blog.logichigh.com/2010/09/02/validating-an-e-mail-address/](http://blog.logichigh.com/2010/09/02/validating-an-e-mail-address/) 并调整了代码以便它可以在 Java 中工作。

```
public static boolean isValidEmailAddress(String email) {
    boolean stricterFilter = true; 
    String stricterFilterString = "[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,4}";
    String laxString = ".+@.+\\.[A-Za-z]{2}[A-Za-z]*";
    String emailRegex = stricterFilter ? stricterFilterString : laxString;
    java.util.regex.Pattern p = java.util.regex.Pattern.compile(emailRegex);
    java.util.regex.Matcher m = p.matcher(email);
    return m.matches();
} 
```

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2015-10-15T13:08:05.910

这是最好的方法：

```
public static boolean isValidEmail(String enteredEmail){
        String EMAIL_REGIX = "^[\\\\w!#$%&’*+/=?`{|}~^-]+(?:\\\\.[\\\\w!#$%&’*+/=?`{|}~^-]+)*@(?:[a-zA-Z0-9-]+\\\\.)+[a-zA-Z]{2,6}$";
        Pattern pattern = Pattern.compile(EMAIL_REGIX);
        Matcher matcher = pattern.matcher(enteredEmail);
        return ((!enteredEmail.isEmpty()) && (enteredEmail!=null) && (matcher.matches()));
    } 
```

资料来源：- [http://howtodoinjava.com/2014/11/11/java-regex-validate-email-address/](http://howtodoinjava.com/2014/11/11/java-regex-validate-email-address/)

[http://www.rfc-editor.org/rfc/rfc5322.txt](http://www.rfc-editor.org/rfc/rfc5322.txt)

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2017-12-18T19:48:20.193

另一种选择是使用[Hibernate 电子邮件验证器](https://docs.jboss.org/hibernate/validator/5.1/api/org/hibernate/validator/internal/constraintvalidators/EmailValidator.html)，使用注释`@Email`或以编程方式使用验证器类，例如：

```
import org.hibernate.validator.internal.constraintvalidators.hv.EmailValidator; 

class Validator {
    // code
    private boolean isValidEmail(String email) {
        EmailValidator emailValidator = new EmailValidator();
        return emailValidator.isValid(email, null);
    }

} 
```

* * *

## 回答 #19

> 赞同：-3
> 
> 时间：2016-01-20T03:11:07.873

这是我的务实方法，我只需要使用 RFC 中允许的字符来合理区分 blah@domain 地址。地址必须预先转换为小写。

```
public class EmailAddressValidator {

    private static final String domainChars = "a-z0-9\\-";
    private static final String atomChars = "a-z0-9\\Q!#$%&'*+-/=?^_`{|}~\\E";
    private static final String emailRegex = "^" + dot(atomChars) + "@" + dot(domainChars) + "$";
    private static final Pattern emailPattern = Pattern.compile(emailRegex);

    private static String dot(String chars) {
        return "[" + chars + "]+(?:\\.[" + chars + "]+)*";
    }

    public static boolean isValidEmailAddress(String address) {
        return address != null && emailPattern.matcher(address).matches();
    }

} 
```

# data-structures - 在现代架构上，Tries 仍然是一个好主意吗？

> ID：624599
> 
> 赞同：10
> 
> 时间：2009-03-09T00:07:17.340
> 
> 标签：data-structures, trie

我在大学里最喜欢的数据结构之一是[Trie](http://en.wikipedia.org/wiki/Trie)。如果前缀是共享的，它是一个很好的数据结构，用于保存大量字符串。查找也很好，因为无论集合中有多少字符串，它们都是在字符串的 O(|length|) 处完成的。

相比之下，平衡树的设置项目数量为 O(log N)，加上您为比较支付的任何费用。哈希表将涉及哈希计算、比较等。

因此，令我惊讶的[是，大多数语言的标准库中都没有 Trie 实现](https://stackoverflow.com/questions/623892/where-do-i-find-a-standard-trie-based-map-implementation-in-java)。

我能想出的唯一原因是内存访问成本可能使其过于昂贵。如果进行树查找，而不是调查 O(log N) 个位置，而不是执行 O(|length|) 个不同的位置，这会带来所有后果。如果字符串很长，这最终可能会太多。

所以我想知道：我刚才描述的问题有多少？当您需要存储大量字符串或字符串时，您会怎么做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-09T00:16:04.150

以前我不认为这是一个值得关注的领域，但现在你提到它，有时标准的 Trie 实现可能会很方便。另一方面，据我所知，Python 和 Perl 以及我现在使用的其他精通字符串的语言都使用 Tries。

最后我检查了一下，那是很久以前的事了，BSD 内核代码在代码中使用了 Tries (Patricia Tries) 来选择发送数据包的最佳接口。看起来[维基百科有一些信息](http://en.wikipedia.org/wiki/Radix_tree)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-09T00:13:59.913

您可以只构建两个示例应用程序，然后看看哪一个表现更好。假设您没有页面错误，内存访问很便宜。然后它非常昂贵。对于客户端应用程序开发，出于这个原因，处理几乎总是比访问内存更好。现代处理器速度快得离谱，但缓存未命中仍然会受到伤害。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T08:45:00.183

我在 C# 中使用 Trie 和 Dictionary（强类型哈希表）进行了一些性能测试。我发现 Dictionary 比 Trie 快 5-10 倍。也许我对 Trie 的实现可以稍微优化一下，但还不足以比字典快得多（或者甚至快得多）。

字典中的 ContainsKey 方法接近于 O(1) 操作（取决于散列算法的好坏），因此只要散列算法相当快，就不容易制作出一个优于该值的集合。

使用自定义 IEqualityComparer，您可以将大多数任何内容用作字典中的键，这使得它相当灵活。Trie 在您可以用作键的方面受到更多限制，因此在一定程度上限制了有用性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-01-29T03:26:35.217

尝试对于 IP 地址和子网查找特别有用，并且始终适用于任何架构。[您可以在The open-source IPAddress Java library](https://seancfoley.github.io/IPAddress/)中找到地址的 trie 实现。免责声明：我是那个图书馆的项目经理。

尝试按地址前缀组织，如下例所示：

```
● 0.0.0.0/0 (10)
└─○ 0.0.0.0/1 (9)
  ├─○ 8.0.0.0/6 (8)
  │ ├─● 8.9.8.0/24 (7)
  │ │ └─○ 8.9.8.0/28 (6)
  │ │   ├─● 8.9.8.0/29 (1)
  │ │   └─● 8.9.8.8/29 (5)
  │ │     ├─○ 8.9.8.8/30 (2)
  │ │     │ ├─● 8.9.8.9 (1)
  │ │     │ └─● 8.9.8.10 (1)
  │ │     └─● 8.9.8.12/30 (2)
  │ │       └─● 8.9.8.12/31 (1)
  │ └─● 10.0.2.15 (1)
  └─● 127.0.0.1 (1) 
```

该结构允许有效的查找、路由和包含检查。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-01-29T04:07:09.183

很难使标准的 Trie 类具有广泛的用途，足以证明将其放入标准库是合理的。

当然，它需要您放入其中的任何内容来实现一个通用的类似字符串的接口。

而且由于 Trie 实际上并不存储字符串，因此迭代它要么很慢，因为它必须重构所有元素，要么很尴尬，因为你实际上并没有得到字符串。

而且，您知道，average_length 和 max_length 都至少为 O(log N)。如果您知道元素是字符串，那么您可以在 O(length + log N) 中搜索 BST，这与 O(length) 几乎相同，并且您保留了结构中实际包含字符串的优势。

Tries真正赢得的*唯一*优势是具有长公共前缀的字符串的内存高效存储。它会发生，但并不常见。我想没有一种语言认为值得麻烦包括一种。

# java - 不区分大小写的等于使用 Hibernate Criteria

> ID：624604
> 
> 赞同：62
> 
> 时间：2009-03-09T00:13:16.903
> 
> 标签：java, hibernate

我见过 Restrictions.ilike('property', '%value%')，但想生成如下 SQL：lower(property) = 'value'。有任何想法吗？

我用了：

```
Restrictions.eq("email", email).ignoreCase() 
```

因为不推荐使用表达式。SimpleExpression 将对值调用 toLowerCase()，因此无需事先进行。

请参阅： [SimpleExpression 源](http://viewvc.jboss.org/cgi-bin/viewvc.cgi/hibernate/core/trunk/core/src/main/java/org/hibernate/criterion/SimpleExpression.java?view=markup)

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2012-10-11T09:51:18.950

现在不推荐使用表达式。改为使用限制...

```
crit(Restrictions.eq("firstName", firstName).ignoreCase()); 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2009-03-09T02:47:44.630

使用 ilike 时要小心，因为它会允许某人输入“test%”之类的内容并进行匹配。我使用以下内容在一个应用程序中执行不区分大小写的相等操作：

```
...
Criteria crit=session.createCriteria(Event.class);
crit.add(Expression.eq("rsvpCode","test1").ignoreCase());
... 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2014-05-29T10:02:41.167

正如安迪的回答所暗示的那样，这适用于不区分大小写的搜索，但它也适用于 Hibernate **4.1**版：

```
crit(Restrictions.eq("firstName", firstName).ignoreCase()); 
```

**Hibernate 4.1.1 及更高版本**不支持`ignoreCase()`on 方法`Restriction.eq()`。为此，我们必须使用`ilike`with `MatchMode`。

```
Criteria crit = session.createCriteria(ENTITY.class);
crit.add(Restrictions.ilike('PROPERTY NAME', 'VALUE', MatchMode.ANYWHERE)); 
```

例如，对于具有**id、name、surname属性的****USER**实体，基于 name 的不区分大小写的搜索将是：

 **```
Criteria crit = session.createCriteria(USER.class);
crit.add(Restrictions.ilike('name', 'Satyam', MatchMode.ANYWHERE)); 
```

这将返回所有结果，不区分大小写。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-09T00:32:16.920

我不确定，但是当您使用 Restriction.eq 时，您会获得一个 SimpleExpression 对象，并且该对象支持我从未尝试过使用的 ignoreCase() 操作，但听起来它可能会有所作为。

感谢 Hibernate 没有记录这个方法的实际作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-04-22T13:30:18.350

如果要求`lower(property) = 'value'`不是最好的方法是使用 Restrictions.eq 和 ignoreCase() 而不是在这里使用 ilike cuz，确切的值是已知的。ilike 有利于搜索模式或当我们不知道确切值时。ignoreCase() 的唯一问题是，它不会将您的结果限制为小写，并且还包括其他情况的结果，但我认为这是 hibernate 提供的唯一可用选项。

```
 Criteria criteria = session.createCriteria(ClassName.class);
 criteria.add(Restrictions.eq("PROPERTY", propertyName).ignoreCase()).uniqueResult(); 
```

现在，如果我正确理解您的问题，您的数据库具有以下值：ABC、abc、aBC、aBc ......等等，您希望将它们转换为小写，然后与某个值进行比较，例如“ABC”或“abc” . 你可以通过进一步处理你得到的列表来做到这一点。

您可以将此结果保存在列表中。

```
List<ClassName> listOfAllMatches =  criteria.list(); // gives all matched results (ABC, abc, aBC, aBc)

List<ClassName> finalResult = listOfAllMatches.stream().map(x -> x.getPropertyName().toLowerCase()).filter(y ->y.getPropertyName()== value).collect(Collectors.toList());

//convert this field to lower case using map() and filter your results with filter() function. 
```

您可以进一步将此列表添加到 Criteria 并对其进行处理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-10-27T14:25:49.270

您可以使用 Criterion.ilike。有关更多信息，请查看此[链接](https://docs.jboss.org/hibernate/orm/3.2/api/org/hibernate/criterion/Restrictions.html#ilike(java.lang.String,%20java.lang.String,%20org.hibernate.criterion.MatchMode))。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-11-15T03:42:29.807

`crit(Restrictions.eq("firstName", firstName).ignoreCase());`作品。

这确实返回了 a`SimpleExpression Object`但它会生成`lower(firstname)`查询。所以这行得通。

# java - JSP.13.8 示例简单标记处理程序场景不起作用？

> ID：624607
> 
> 赞同：0
> 
> 时间：2009-03-09T00:14:47.243
> 
> 标签：java, jsp, tomcat, jsp-tags

这个测试是通过阅读[Sun java 论坛上的一个问题来](http://forums.sun.com/thread.jspa?threadID=5371653&tstart=25)提示的，我想我会尝试一下。JSP2.0 规范部分 JSP.13.8 包含一个“示例简单标记处理程序方案”。我复制并粘贴了代码片段并尝试运行它。

环境：Apache Tomcat 版本 5.5.26 和 6.0.14（均已测试） Java：1.5

我正在测试的代码：Jsp 页面：

```
<%@ taglib prefix="my" tagdir="/WEB-INF/tags" %>
<my:simpletag x="10">
<jsp:attribute name="y">20</jsp:attribute>
<jsp:attribute name="nonfragment">
Nonfragment Template Text
</jsp:attribute>
<jsp:attribute name="frag">
Fragment Template Text ${var1}
</jsp:attribute>
<jsp:body>
Body of tag that defines an AT_BEGIN
scripting variable ${var1}.
</jsp:body>
</my:simpletag> 
```

和标签文件：

```
<%-- /WEB-INF/tags/simpleTag.tag --%>
<%@ attribute name="x" %>
<%@ attribute name="y" %>
<%@ attribute name="nonfragment" %>
<%@ attribute name="frag" fragment="true" %>
<%@ variable name-given="var1" scope="AT_BEGIN" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
Some template text.
<c:set var="var1" value="${x+y}"/>
<jsp:invoke fragment="frag" varReader="var1"/>
Invoke the body:
<jsp:doBody/> 
```

此代码直接从 JSP2.0 规范的 PDF 副本中复制而来。
它也可以作为 JSP-API 的一部分在[此处](http://java.sun.com/products/jsp/2.1/docs/jsp-2_1-pfd2/javax/servlet/jsp/tagext/package-summary.html#sths) 进行微小更改 - 我将标记文件的名称从 simpletag.tag 更改为 simpleTag.tag 以匹配 JSP 中对它的调用。
我还尝试从规范的 PDF 中复制（根据需要调整引号） - 结果相同。

当我执行该页面时，我最终得到一个标准的 500 错误根本原因：java.lang.ClassCastException: java.io.StringReader org.apache.jsp.tagVariableTest_jsp._jspService(tagVariableTest_jsp.java:62)

生成的 JSP 的第 62 行原来是： var1 = (java.lang.String) _jspx_page_context.findAttribute("var1");

好的，我可以理解 ClassCastException - 它认为 var1 应该是一个字符串，而实际的属性是一个 StringReader。但为什么它是 StringReader？变量是在哪里创建的？它为什么要尝试完成这项任务？

有人可以指出我正确的方向吗？代码/设置有什么问题？这是一个已知的问题？我用谷歌搜索，但似乎找不到任何东西。

谢谢， evnafets

* * *

使用分辨率进行编辑：ClassCastException 是由标记中的行引起的：

```
<jsp:invoke fragment="frag" varReader="var1"/> 
```

如前所述[，](http://72.5.124.55/products/jsp/syntax/2.0/syntaxref2021.html) varReader 属性指定将评估结果存储为 StringReader 的属性。该异常是由 Tomcat 生成的代码尝试检索“var1”的值并将其转换为字符串引起的。由于 String 不是 StringReader 因此，它在那时引发了异常。

我不确定编码错误是否是他们应该使用“var”而不是“varReader”属性，或者他们不应该使用任何一个而只是按原样评估它。删除该属性会完全打印出片段，然后是带有“var1”值的正文：

> 片段模板文本 30\. 调用正文：定义 AT_BEGIN 脚本变量的标记正文 30

使属性 var="var1" 执行片段，并将结果存储到 var1。然后使用 var1 的这个新值对主体进行评估，结果是：

> 调用正文：定义 AT_BEGIN 脚本变量的标记正文片段模板文本 30

我个人认为第一种情况更有意义，但此代码是作为内部工作的示例，而不是最佳实践。
在任何情况下，我仍然希望该示例能够编译/运行。当它没有时，我相当惊讶。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T13:08:48.380

从[语法参考](http://72.5.124.55/products/jsp/syntax/2.0/syntaxref2021.html)中，您可以看到 var 或 varReader 是

> 用于存储片段调用结果的作用域属性的名称

所以恐怕示例代码包含错误。如果您需要将 jsp:invoke 的结果直接写入页面，则无需将其分配给 var。

您可以尝试省略“varReader”属性吗？

# lifecycle - 你怎么知道什么时候关闭一个项目？

> ID：624613
> 
> 赞同：4
> 
> 时间：2009-03-09T00:21:09.600
> 
> 标签：lifecycle

嘿，我在一年的时间里建立了一个项目。我已经投入了很多时间，结果非常好。一群人使用它，还有一群人为它编写插件。然而，我已经转向不同的语言，不同的风格，代码库是肮脏和hackish，我不确定我是否想继续在我构建它的框架中工作。

你什么时候知道你应该关闭一个项目并继续前进？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-09T00:24:33.583

当你不想再工作时。您是否考虑过开源它，以便用户社区可以继续支持它，如果他们愿意？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-09T00:38:46.890

一旦你失去了灵感，一个项目开始变得乏味，你已经到了无法从项目中获得太多或更多经验的地步，就该继续前进了。如果一个项目的代码库过于混乱而无法修复，那么是时候继续前进了。如果人们使用它并为它编写插件，我会亲自将项目开源并将其交给社区以继续，否则就结束它。

找一个新的维护者，因为它已经是开源的。请求志愿者。如果他们喜欢它，他们肯定会抓住机会维护它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T00:37:35.877

如果您确定您已准备好离开项目，那么您可以这样做，但您应该首先考虑您的用户。他们仍然觉得它有用；他们贡献了数小时的工作来编写插件。

因此，您的首要任务是确保那些想要使用他们认为有用的东西的人仍然可以这样做，并且仍然可以增强它。所以，请一个志愿者来接管这个项目，或者一个小组。向他们提供来源，以及您对缺陷在哪里以及需要采取哪些措施来纠正它们（重写）的坦率评估。

如果你简单地关闭项目，你会让很多人对你不满意，而他们现在对你很满意——那是愚蠢的。制造敌人很容易，而不会特意疏远那些会尊重你决定的人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T00:31:59.340

你确定你不会从这个项目中获得更多有价值的经验/知识吗？为什么不用您选择的语言/平台重新实现它，从而使其成为一种学习体验？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T00:41:04.637

我想说，如果您打算花更多时间重写并尝试围绕当前框架工作，然后从头开始制定更好的设计和计划，那么现在是继续前进的好时机。

我认为这真的取决于你对项目的动机。如果纯粹是财务方面的，那么您可以进行直接成本分析。如果是出于爱好或学习经验，您可能希望继续前进，即使留在当前项目中会更容易。

# .net-3.5 - 为 Vista（及更高版本）机器简化 .NET 3.5 安装所需的 WiX 更改

> ID：624614
> 
> 赞同：2
> 
> 时间：2009-03-09T00:21:20.877
> 
> 标签：.net-3.5, wix, windows-installer, upgrade

我们决定冒险并要求我们的用户在使用我们的媒体中心插件之前安装 .NET 3.5。

我想确保安装体验尽可能流畅，并且我们的安装程序保持较小。

我需要对我的[WiX 文件](http://code.google.com/p/videobrowser/source/browse/trunk/MediaBrowser/Setup/Setup.wxs)进行哪些更改以支持以下方案？代码示例将不胜感激。

*   用户已安装 .Net framework 3.0，交互式安装。

**期望行为**：用户会收到一个窗口提示，告诉她她需要新版本的框架，如果她接受，则会下载 dotNetFx35setup.exe (2.7 MB)，然后执行。最后，安装继续进行。

*   用户安装了 .Net framework 3.0，非交互式安装。

**背景**：为了便于从媒体中心自动更新，如果用户选择升级现有版本，我们可能会执行“msiexec.exe /qb /i mediabrowser.msi”。

**期望的行为**：用户会收到一个窗口提示，告诉她她需要一个新版本的框架，如果她接受，则会下载 dotNetFx35setup.exe (2.7 MB)，然后执行。最后，安装会静默进行。

是否有任何其他开源项目可以实现这些方面的东西？

**相关问题**：[.NET 3.5 是媒体中心插件的合理先决条件吗？](https://stackoverflow.com/questions/623213/is-net-3-5-a-reasonable-pre-requisite-for-a-media-center-plugin)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T09:18:45.843

我相信在您的 msi 启动之前安装 .NET 属于 setup.exe 引导程序的职责。WIX（还）没有自己的方式来生成引导程序（或者如果有，它没有记录在 wix.chm 中）。相反，您可以使用 GenerateBootStrapper msbuild 任务来生成 setup.exe。查看wix 文档中的主题“[如何：使用引导程序安装 .NET Framework ”。](http://wix.sourceforge.net/manual-wix3/install_dotnet.htm)要通过下载安装 .NET 3.5 SP1，您的 msbuild 文件将如下所示：

```
<Project ToolsVersion="3.5"
   xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <ItemGroup>
        <BootstrapperFile Include="Microsoft.Windows.Installer.3.1" >
           <ProductName>Windows Installer 3.1</ProductName>
        </BootstrapperFile>
        <BootstrapperFile Include="Microsoft.Net.Framework.3.5.SP1" >
           <ProductName>Microsoft DotNet Framework 3.5 SP1</ProductName>
        </BootstrapperFile>
    </ItemGroup>

    <Target Name="SetupExe">
        <GenerateBootstrapper
            ApplicationFile="myproduct.msi"
            ApplicationName="myproduct"
            BootstrapperItems="@(BootstrapperFile)"
            Path="C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\"
            OutputPath="path/to/put/setup/"
            Culture="en"/>
    </Target>

</Project> 
```

如果您将上述内容保存在 setup.msbuild 文件中，则可以通过调用来构建您的设置

> C:\WINDOWS\Microsoft.NET\Framework\v3.5\msbuild.exe setup.msbuild

您也可以从安装 CD 安装 .NET，而不是下载它。只需添加[`ComponentsLocation="Relative"`](http://msdn.microsoft.com/en-us/library/microsoft.build.tasks.generatebootstrapper.componentslocation.aspx)到 GenerateBootstrapper 的属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-25T22:34:53.137

[dotNetInstaller](http://dotnetinstaller.codeplex.com)支持所有这些

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-07T02:02:14.707

您将需要使用引导程序来完成此操作。一旦一个安装程序已经运行，Microsoft Installer 将不允许您启动另一个安装程序。您可以从 Visual Studio 附带的 msbuild 文件中使用引导生成器，或者您可以查看许多开源选项。

[dotNetInstaller](http://dotnetinstaller.codeplex.com/ "dotNetInstaller")是一个流行的选项。而“Burn”是 WiX 中即将推出的用于此任务的工具的名称。但是，它现在仍然是概念件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-25T01:08:58.173

来自WiX 首席开发人员[Rob Mensching](https://stackoverflow.com/users/23852/rob-mensching)：这是 Burn（即将开发的 WiX 工具集引导程序）的关键场景。

所以不，没有内置的方法可以用 WiX pure 来简化这个过程。不过，您可以编写[自己的引导程序](http://github.com/SamSaffron/Media-Browser/tree/cfb3afdbec276c3fba2c4ffd73ec8534a3de1c0d/Bootstrapper)。

# database-design - 用于存储 RSS 提要的最佳数据库结构

> ID：624616
> 
> 赞同：10
> 
> 时间：2009-03-09T00:21:26.480
> 
> 标签：database-design, rss

我一直在这里和谷歌寻找答案，虽然我找到了一些我还没有找到解决方案的指针。

如果您有一个带有数据库的简单 RSS 阅读器，您可能有几个表用于存储提要（此处忽略与订阅者的处理）：

*   供稿（**供稿 ID**、供稿标题、供稿网址）
*   项目 ( **item-id** , *feed-id* , item-title, item-content)

这在大多数情况下都有效，但对于许多网站/基于 Web 的应用程序，您可能有来自首页的主要提要，然后是类别提要，如果您将两者都纳入上述类型的系统，那么由于相同的原因，将会有很多复制数据帖子出现在几个 RSS 提要中。

我提出的两个选择要么忽略它并接受重复项，要么使用提要和项目之间的链接表。但这似乎也很浪费，因为我希望提取的 80% 的提要没有多个提要可以创建这种复制。

有没有更好的方法来做到这一点/我是否以完全错误的方式看待这个？

**更新**

感谢两位的回答，所以共识似乎是节省空间可能不足以担心，并且会被潜在的未知问题（如 dbr 提到的）所否定。

添加链接表或类似的可能也会增加处理时间，因此总体而言不值得担心太多。在阅读了链接内容和删除重复内容的回复后，我有想法，只有当帖子不再出现在任一 RSS 提要中以节省空间时，但正如 Assaf 所说，节省空间可能会浪费时间。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T00:27:54.637

我建议您不要在这个开发阶段（我认为是设计）尝试优化掉所有可能的提要数据副本。专注于让它工作，当你完成时，如果你做一些分析并发现如果你在提要之间使用链接或共享数据，你确实可以节省 X% 的存储空间，**只有这样**并且***如果*X 大到足以支付优化数据库所需的时间**我建议您实施任何此类更高级的方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-09T01:31:58.400

正如 Assaf 所说，如果重复文章来自不同的提要，我不会担心存储重复的文章，至少现在是这样。它会增加的复杂性不会使您节省的几千字节空间受益。

我想如果您对内容进行 sha1 哈希处理，`SELECT id FROM articles WHERE hash = $hash`并且如果存在某些内容，只需有一个“article_content_id”，如果设置将文章内容指向另一行...但是，如果您有两篇文章怎么办：

```
id: 1
title: My First Post!
feed: Bobs site
content: Hi!
hash: abc
link: no
content_link_id:

id:2
title: My First Post!
feed: Planet Randompeople Aggregator
content:
hash: abc
content_link_id: 1 
```

..这很好用，并且您通过不复制文章节省了 3 个字节（如果文章更长，显然更多）

..但是当 Bob 决定将广告添加到他的 RSS 提要时会发生什么，将内容从 更改`Hi!`为`Hi!<p><img src='...'></p>`- 但 Planet Randompeople 删除了所有图像。然后要更新提要项目，您必须检查`content_link_id`与您正在更新的文章链接的每一行，检查新项目是否与链接到它的文章具有相同的哈希值 - 如果它不同，您必须打破链接并将旧数据复制到链接项目，然后将新内容复制到原始项目..

可能有更简洁的方法可以做到这一点，但我的观点是它可能会变得非常复杂，并且您可能只会在非常有限的帖子子集上节省几千字节（假设数据库引擎本身不进行任何压缩）。

除此之外，拥有一张`feeds`and的表`items`似乎是明智的，这也是我见过的大多数其他 RSS 存储数据库处理它的方式。

# asp.net-mvc - MVC 模式 + DDD 模式

> ID：624618
> 
> 赞同：7
> 
> 时间：2009-03-09T00:23:26.037
> 
> 标签：asp.net-mvc, model-view-controller, domain-driven-design

在 MVC 应用程序中，DDD 是如何实现的。什么是域对象？如果我将实体映射到自定义对象，这个映射逻辑在哪里，在存储库的方法中还是在服务层中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T01:13:03.907

在[http://nathan.whiteboard-it.com/archive/2009/03/01/asp.net-mvc-domain-driven-design.aspx](http://nathan.whiteboard-it.com/archive/2009/03/01/asp.net-mvc-domain-driven-design.aspx)上有一个很棒的新帖子系列，实际上是从 get 开始描述的了解如何在考虑 DDD 的情况下设计应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T01:27:25.947

看看[S#arpArchitecture](http://code.google.com/p/sharp-architecture/)。这是同时开始使用 MVC 和 DDD 的一种非常好的方式。域对象（模型）存储在与控制器和演示不同的项目中。它有一个非常好的安装和解决方案模板以及很棒的文档。

它充分利用了作为 DDD 核心一部分的存储库模式。它还采用了几种现代“最佳实践”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T10:01:12.420

在 MVC 应用程序中，所有特定于域的逻辑都应该放在 MVC 的 M 中，即您的模型中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T00:30:03.773

将会有大量的学习进化来回答所有这些问题。

我将从使用 TDD 而不是[DDD的](http://domaindrivendesign.org/)[ASP.NET MVC Storefront Starter Kit](http://www.asp.net/learn/mvc-videos/)开始，但它是一个很好的起点。如果您真的对 DDD 感兴趣，我建议您阅读 [Eric Evans Book](http://books.google.co.uk/books?id=7dlaMs0SECsC&dq=Domain+Driven+Design&printsec=frontcover&source=bn&hl=en&ei=OWO0Sd6hL9nHjAea7IzPBQ&sa=X&oi=book_result&resnum=4&ct=result#PPP1,M1)，它被大多数人认为是 DDD 圣经。[Ayende Rahien](http://ayende.com/Blog/Default.aspx)还写了一本名为[Building Domain Specific Languages](http://www.manning.com/rahien/) with [BOO](http://agenericcollection.blogspot.com/)的书，这也可能对 DDD 有所了解。

# jquery - 获取与另一个在同一行中的第一个文本

> ID：624623
> 
> 赞同：1
> 
> 时间：2009-03-09T00:26:54.373
> 
> 标签：jquery

我越来越经常遇到一个问题，我有一个与 a 绑定的事件处理程序`<td>`，我需要获取该`<td>`行中第一个中的文本（这是主键）。假设我不想添加任何额外的标记，那么最简单的方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T00:32:29.667

使用 JQuery，您可以编写如下内容：

```
function eventHandler()
{
    var firstTdText = $(this).parent().children("td:first").html();
} 
```

当然，假设“this”引用了 html TD。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T00:36:15.337

要引用该行中的第一个单元格，您可以使用`prevAll`选择器选择它：

```
$(this).prevAll("td:last") 
```

要从中获取文本：

```
$(this).prevAll("td:last").html()
// or,
$(this).prevAll("td:last").text() 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T00:29:01.530

你会去[父母`<tr>`](http://docs.jquery.com/Selectors/parent)那里，然后从父母[那里去第一个孩子。](http://docs.jquery.com/Selectors/firstChild)

# normalization - 上下文无关语法转换

> ID：624637
> 
> 赞同：2
> 
> 时间：2009-03-09T00:42:26.850
> 
> 标签：normalization, context-free-grammar, bnf, chomsky-normal-form

谁能告诉我是否有任何软件可以将[乔姆斯基范式](http://en.wikipedia.org/wiki/Chomsky_normal_form)转换为[巴科斯-瑙尔范式](http://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form)，反之亦然？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T00:58:53.410

嗯，乔姆斯基范式和巴库斯-瑙尔形式并不是一个真正的概念，所以我真的不这么认为。但是，如果您告诉我们您需要什么软件，我们可能会提供帮助。

现在，根据您的要求，我假设您想要某种代码将 BNF 语法规范化为乔姆斯基范式。据我所知，不存在这样的软件，但有可能存在一些，假设它是一项实际上在计算上可行的任务。

但是，如果您能更具体地了解您的实际需求，我们将能够为您提供有关该任务的有用建议。

编辑：在我的书中挖掘了一下之后，事实证明完全有可能制定一种算法来将任意 CFG 转换为乔姆斯基范式。我没有实际的算法或其复杂性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-12T20:31:33.487

也许[JFLAP](http://www.jflap.org/whatis.html)会做你正在寻找的东西。

我自己还没有使用它，但是我的 Automata 教授向我推荐了它。

查看“什么是 JFLAP？” 页面，它似乎可以从“CFG - > CNF”转换，这听起来像你想要做的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T00:54:41.330

正如所指出的，我最初关于 BNF 已经在 CNF 中的回答是错误的。您可以将任何上下文无关语法转换为 CNF，如此[处](https://www.cs.bris.ac.uk/Teaching/Resources/COMS30122/lectures/04_Grammar_Transformation.v.pdf)所述(PDF)。[Sipser](https://rads.stackoverflow.com/amzn/click/com/053494728X)第 2 版中也说明了转换过程。如果您可以访问第 106-109 页。我不知道是否有现有的软件可以自动化这个过程（但它似乎很容易编写）。

# c# - 根据参数抛出/不抛出异常 - 为什么这不是一个好主意？

> ID：624647
> 
> 赞同：8
> 
> 时间：2009-03-09T00:49:29.377
> 
> 标签：c#, exception, parameters, option

我在 MSDN 中四处寻找，发现[这篇文章](http://msdn.microsoft.com/en-us/library/ms229030(VS.80).aspx)有一个有趣的建议：**不要让公共成员根据某些选项抛出或不抛出异常。**

例如：

```
Uri ParseUri(string uriValue, bool throwOnError) 
```

现在我当然可以看到，在 99% 的情况下，这将是可怕的，但它的偶尔使用是否合理？

我见过的一种情况是在访问数据库或配置文件中的数据时使用“AllowEmpty”参数。例如：

```
object LoadConfigSetting(string key, bool allowEmpty); 
```

在这种情况下，替代方法是返回 null。但是随后调用代码将充满空引用检查。（如果您愿意，该方法还将排除实际允许 null 作为特定可配置值的能力）。

你怎么认为？为什么这会是个大问题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-09T01:03:36.860

我认为基于布尔值进行投掷/不投掷决定绝对是一个坏主意。即因为它要求开发人员查看一段代码以了解 API 的功能知识以确定布尔值的含义。这本身就很糟糕，但是当它改变底层错误处理时，开发人员在阅读代码时很容易出错。

在这种情况下，拥有 2 个 API 会更好、更易读。

```
Uri ParseUriOrThrow(string value);

bool TryParseUri(string value, out Uri uri); 
```

在这种情况下，这些 API 的作用是 100% 清楚的。

关于为什么布尔值作为参数不好的文章：http: [//blogs.msdn.com/jaredpar/archive/2007/01/23/boolean-parameters.aspx](http://blogs.msdn.com/jaredpar/archive/2007/01/23/boolean-parameters.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-09T01:00:23.530

通常最好选择一种错误处理机制并坚持使用它。允许这种触发器代码并不能真正改善开发人员的生活。

在上面的例子中，如果解析失败并且 throwOnError 为 false 会发生什么？现在用户必须猜测是否返回NULL，或者上帝知道......

确实，作为更好的错误处理方法，异常和返回值之间存在着持续的争论，但我很确定对于保持一致并坚持你所做的任何选择已经达成共识。API 不会让用户感到惊讶，错误处理应该是接口的一部分，并且与接口一样明确定义。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T01:04:35.563

从可读性的角度来看，这有点令人讨厌。开发人员倾向于期望每个方法都抛出异常，如果他们想忽略异常，他们会自己捕获它。使用“布尔标志”方法，每个方法都需要实现这种异常抑制语义。

但是，我认为 MSDN 文章严格指的是“throwOnError”标志。在这些情况下，要么错误在方法本身内部被忽略（不好，因为它被隐藏了），要么返回某种空/错误对象（不好，因为你没有使用异常来处理错误，这是不一致的并且本身就是错误的-易于）。

而你的例子对我来说似乎很好。异常表示方法未能执行其职责 - 没有返回值。然而，'allowEmpty' 标志*改变了方法的语义*——所以本来应该是一个异常（'Empty value'）的东西现在是预期的并且是合法的。另外，如果您抛出异常，您*将*无法轻松返回配置数据。所以在这种情况下似乎没问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T01:06:13.407

在任何公共 API 中，有两种方法来检查错误情况确实是一个坏主意，因为如果发生错误会发生什么就变得不明显了。仅仅通过查看代码将无济于事。您必须了解标志参数的语义（没有什么可以阻止它成为表达式）。

如果检查 null 不是一个选项，并且如果我需要从这个特定的故障中恢复，我更愿意创建一个特定的异常，以便以后可以捕获它并适当地处理它。在任何其他情况下，我都会抛出一般异常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T01:05:27.450

与此相符的另一个示例可能是某些值类型上的 TryParse 方法集

`bool DateTime.TryParse(string text, out DateTime)`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T01:21:23.213

拥有一个 donTThrowException 参数会破坏整个异常点（在任何语言中）。如果调用代码想要：

```
public static void Main()
{
        FileStream myFile = File.Open("NonExistent.txt", FileMode.Open, FileAccess.Read);
} 
```

欢迎他们（C# 甚至没有检查异常）。在 Java 中，同样的事情可以通过以下方式完成：

```
public static void main(String[] args) throws FileNotFoundException
{
        FileInputStream fs = new FileInputStream("NonExistent.txt");
} 
```

无论哪种方式，决定如何处理（或不处理）异常是调用者的工作，而不是被调用者的工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-09T02:45:14.463

在链接到的文章中有一条注释，异常不应用于控制流 - 这似乎暗示在示例问题中。异常应该反映方法级别的失败。有一个可以抛出错误的签名似乎没有经过深思熟虑的设计。

Jeffrey Richters 通过 C# 预订 CLR 指出 - “当方法无法完成其名称所指示的任务时，您应该抛出异常”。

他的书还指出了一个非常常见的错误。人们倾向于编写代码来捕获所有内容（他的话“一个普遍存在的错误，即没有接受过正确使用异常的适当培训的开发人员往往会过于频繁且不正确地使用 catch 块。当您捕获异常时，您是在说明你预料到了这个异常，你明白它为什么会发生，你知道如何处理它。”）

这使我尝试为我可以预期并且可以在我的逻辑中处理的异常编写代码，否则它应该是一个错误。

验证您的论点并防止异常，并且只捕获您可以处理的内容。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-10-17T17:43:50.023

我敢肯定，有一个参数来指示故障是否应该导致异常或简单地返回错误指示通常很有用，因为这样的参数可以很容易地从外部例程传递到内部例程。考虑类似的事情：

Byte[] ReadPacket(bool DontThrowIfNone) // 记录为返回 null if none { int len = ReadByte(DontThrowIfNone); // 记录为如果没有返回 -1 if (len

如果在读取数据时发生类似 TimeoutException 的情况会导致异常，则应在 ReadByte() 或 ReadMultiBytesbytes() 中引发此类异常。但是，如果应将这种数据缺失视为正常现象，则 ReadByte() 或 ReadMultiBytesbytes() 例程不应引发异常。如果简单地使用 do/try 模式，则 ReadPacket 和 TryReadPacket 例程需要具有几乎相同的代码，但其中一个使用 Read* 方法，另一个使用 TryRead* 方法。恶心。

使用枚举而不是布尔值可能会更好。

# css - 用于动态内容的 css

> ID：624651
> 
> 赞同：1
> 
> 时间：2009-03-09T00:54:13.513
> 
> 标签：css, dynamic-data

我正在使用 javascript 向网页添加内容。问题是 IE (7) 中的 CSS 似乎不适用于动态添加的内容。

这是一个示例文档..

```
<html>
<head>
    <style type="text/css">
    p.foo { color: #FF4400 ; background-color: #000000 }
    p.bar { color: #FF0000 ; background-color: #000000 }
    </style>
    <script type="text/javascript">
        function add() {
            var node = document.createElement("p");
            node.setAttribute("class", "bar");
            node.appendChild(document.createTextNode("New Content"));
            document.body.appendChild(node);
        };
    </script>
</head>
<body onload="add()">
        <p class="bar">bar</p>
        <p class="foo">foo</p>
</body>
</html> 
```

在 FF 中，新添加的“新内容”段落应用了样式，但在 IE 中，它没有。这似乎很明显，应该很容易搜索，但一些明显的查询没有给我任何帮助。

那么诀窍是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-09T01:08:31.793

为什么不使用已经解决所有这些问题的框架，例如[jQuery](http://jquery.com)、[MooTools](http://mootools.net)、[extJs](http://extjs.com/)、[Dojo](http://www.dojotoolkit.org/)、[Prototype等？](http://www.prototypejs.org)

但是，如果您坚持自己做，请尝试使用：

```
 function add() {
        var node = document.createElement("p");
        node.className = 'bar'; // <- use in leu of setAttribute()
        node.appendChild(document.createTextNode("New Content"));
        document.body.appendChild(node);
    }; 
```

# design-patterns - Monostate 是邪恶的 Singleton 的好表弟吗？

> ID：624653
> 
> 赞同：8
> 
> 时间：2009-03-09T00:56:13.320
> 
> 标签：design-patterns, oop

Singleton 绝对是最被滥用和滥用的模式之一。我们中的许多人曾在某一时刻感染过单胎炎。奇怪的是，它的近亲[Monostate](https://segueuserfiles.middlebury.edu/xp/SingletonAndMonostate.pdf)不太出名，也很少使用。您对于 Monostate 的观点是？好还是一样坏？它是使用 Singleton 的更好选择吗？您是否也会像使用 Singleton 一样不鼓励使用它？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-09T04:15:05.683

嗯，单态*是*单例......所以它有完全相同的问题。

*   测试
*   隐藏依赖
*   不灵活
*   线程安全
*   全局状态难以确保正确性

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-09T02:52:06.820

根据[Monostates](http://c2.com/cgi/wiki?MonostatePattern)的这个定义，这个注释是：

“Monostates 是邪恶的，就像[SingletonsAreEvil](http://c2.com/cgi/wiki?SingletonsAreEvil)一样。”

我不一定同意。基本前提是 Singletons 和 Monostates 是全局变量，并且由于 Globals 是邪恶的，所以 Singletons 和 Monostates 也必须是邪恶的。

这种推理的问题在于它没有考虑到为什么全局变量是邪恶的。全局变量是邪恶的，主要是因为它们是可以在本地范围之外*意外*访问的变量，类似于非类型化语言通常允许通过引用它们来创建变量。

Singletons 和 Monostates 不会导致相同类型的问题，因为几乎不可能“意外”引用全局静态，调用它的实例方法，然后使用实例。

换句话说，全局变量是邪恶的，因为它们会导致微妙且难以察觉的问题。Singletons 和 Monostates 不会导致相同类型的问题，因此出于相同的原因，我不认为它们是邪恶的，这是大多数人在这个论点中似乎出错的地方。

现在，单例和单态会导致其他类型的问题吗？当然。显然，TDD 的人讨厌他们，因为他们很难用自动化测试来正确测试。好的，很好，但是对于那些不使用 TDD 的人来说，这些问题不存在。

当然，单例可能会被滥用。仅仅为了避免传递实例而使用它们的人正在滥用它们。我认为 Monostates 比单例更好。

很多人提出工厂模式而不是单例，但我觉得工厂只是花哨的单例生成器。不，没有静态“实例”方法，但它基本上做同样的事情（当工厂创建单个实例对象时）。Factory.Create 与 Singleton.Instance 没有什么不同。

编辑：

Singletons 和 Monostates 与 Globals 相比的一个方面是它们是共享的，因此不是线程安全的。如果您计划开发多线程应用程序，这是一个问题，但如果您知道这一点，您可以采取措施序列化对共享对象的访问。所以这可能是唯一一个通常认为所有三种类型都会造成麻烦的领域。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-09T01:01:01.470

仅仅因为不使用模式怎么样？

更新：滥用单例是因为人们添加了没有理由的模式。它通常会添加任意约束而无济于事。使用单态 w/o 理由可能危害较小，但没有更多理由。如果有多个实例，宇宙不会崩溃，那么不要用一种模式强制它——只创建一个实例。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-09T01:41:46.393

我对 Monostate 最大的问题是它可能会导致使用它的人感到困惑。一般来说，如果您创建一个对象的新实例，您希望它只是一个新实例，具有自己的状态和生命周期。我通常认为意外行为是一件坏事，所以我更喜欢单例，只是因为你知道当你使用它时你会得到什么。

至于任何一种模式是否是邪恶的，单例往往会被误用，但所有其他模式、switch 语句、for 循环或您想提及的任何其他模式也是如此。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-09T01:06:22.470

你为什么假设人们会不鼓励使用单例？对 Singleton 进行全面概括就像对 goto、全局变量等进行全面概括。他们都有一个地方。这些东西都不是“邪恶的”，它们的滥用并不会使它们不好用，只是意味着它们需要正确使用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-09T01:57:05.110

这是 Gamma、Helm、Johnson 和 Vlissides 所著的 Design Patterns: Elements of Reusable Object-Oriented Software 第 127 页的节选。

在以下情况下使用单例模式

*   必须有一个类的实例，并且客户端必须可以从众所周知的访问点访问它
*   当唯一的实例应该可以通过子类化来扩展，并且客户端应该能够在不修改其代码的情况下使用扩展的实例

是否真的因为单例被滥用和误解而变得邪恶？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-09T01:15:14.510

与 Monostate 的交易是，您需要较少了解对象的实现才能使用它。换句话说，您无需调用对象的 getInstance 方法（Singleton s = Singleton::getInstance; s.Method(); ）来获得对对象的引用，因此您节省了一些击键，您只需使用普通语言结构（单态毫秒；ms.Method()；）。确实是一条细线。

每个编程语言结构都可以被标记为邪恶，因为每个编程语言结构都可能被滥用。

当合理使用时，我认为没有一个是“邪恶的”或“好的”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-11T11:48:09.633

具有单个实例但没有全局访问权限的类怎么样：

```
public class SingleInstance
{
    private static boolean exhausted = false;

    public SingleInstance()
    {
        if (exhausted)
        {
            throw new IllegalStateException("only one instance allowed");
        }
        exhausted = true;

        [...]
    }

    [...]
} 
```

这避免了 Singleton 和 MonoState 的问题，同时它强制并清楚地传达只有一个实例。

# c# - SQL Server 2000 服务器错误

> ID：624657
> 
> 赞同：0
> 
> 时间：2009-03-09T01:00:59.240
> 
> 标签：c#, sql-server

相同的数据库和应用程序在我们的测试机器上运行异常，但在其他计算机上运行良好。

在测试机器上：

*   我们得到 SSL 错误异常。我们根据 MS KB 文章修复了该问题，但之后它说
*   " `Server error`" 或 " `General network error`" 并减慢到 1-2 个存储过程/秒。
*   profiler 说应用程序运行时我们有 2000-2500 个连接。同一个应用程序在其他机器上只有 5-10 个连接。我认为随机错误消息是由这个巨大的连接数引起的。

我们重新安装了 SQL Server，关闭了连接池，并关闭了所有数据读取器。

我还可以做些什么？MSSQL2k 是否有“更深”的配置工具？任何隐藏的组件/ini/config/注册表项？或者我可以使用的除 SQL Profiler 之外的其他分析器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T01:31:39.820

还有另一种可能性（！）：

[SQL Server .NET 数据提供程序的多个修复](http://support.microsoft.com/default.aspx?scid=kb;en-us;823679)

> 当 SQLCommand.CommandTimeout 设置为零时，您期望无限超时。但是，当来自 SQL Server 的响应被分成两个数据包时，SqlClient 提供程序的 1.1 和 1.0 版本错误地超时。收到第二个数据包后，提供程序的 1.1 和 1.0 版立即错误地超时。本文中包含的修复程序修复了此问题，因此该命令将具有无限超时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T01:17:43.597

如果关闭 OLE DB 资源池会发生什么？：

```
'For SQLOLEDB provider
 'strConnect = "Provider=SQLOLEDB;server=MyServerName;OLE DB Services = -2;uid=AppUser;pwd=AppUser;initial catalog=northwind"

' For MSDASQL provider 
'strConnect = "DSN=SQLNWind;UID=Test;PWD=Test; OLE DB Services= -2" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T01:26:10.567

要查看的另一件事是您是否总是从 ADO.NET 指定存储过程参数的类型和方向。

内部发生的是 sqlClient 将您在 ADO.NET 中设置的参数转换为存储过程参数中的相关数据类型。但是，当您发送可能导致错误转换的 nText 参数时，这可能会失败。

另外，我会检查您是否有时会在存储过程参数中传递很长的语句。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T11:21:13.233

再次感谢米奇，遗憾的是这些想法都不是真正的解决方案。毫不奇怪 - 来自 MSSQL 的那些错误消息似乎是*随机*的。

*随机*，我的意思是：

*   X[1] 并发连接后，MSSQL 停止自动关闭连接，连接池槽巨大。在 X 之前，我只看到了 5-10 个连接 [2] / 但之后有 2500 个连接，并且 MSSQL 被查到了。
*   在这种情况下，MSSQL 会抛出不确定的错误消息，例如*'General failure'*、*'User (null)'*等。
*   我们在 DAL 中有未关闭的连接（自 2 年以来一直隐藏...... brrr），当我们使用它太多时，它导致了这个严重的错误。

[1] 我不知道 X 的具体值

[2] 我用过这个查询：

```
 SELECT 
      DB_NAME(dbid) as DBName, 
      COUNT(dbid) as NumberOfConnections,
      loginame as LoginName 
    FROM
      sysprocesses
    WHERE 
      dbid > 0
    GROUP BY 
      dbid, loginame 
```

# cocos2d-iphone - 你如何在 Cocos2d 中制作动画？

> ID：624659
> 
> 赞同：1
> 
> 时间：2009-03-09T01:01:31.610
> 
> 标签：cocos2d-iphone

我正在尝试为精灵设置动画。cocos2d 网站让它看起来很简单，但每次我尝试都会出错。我设法下载了一些代码以使其正常工作，但一个精灵动画需要 6 个文件。我有一个角色需要左右行走、跳跃、攀爬和跌倒。这意味着我正在查看 35 个文件。不能精简一点吗？这似乎比应该的要难。

谢谢，乔什

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T01:18:52.317

可可很棒。您只需要花时间在演示项目上，在留言板上闲逛，并坚持下去。

您可以像这样为精灵设置动画：

```
id action = [Sequence actions:
             [ScaleTo actionWithDuration:.3 scale:0.7f],
             [ScaleTo actionWithDuration:.3 scale:1.0f],
             nil];

[[self getByTag:FOO] do:action]; 
```

这会导致带有 FOO 标签的精灵在 0.3 秒内缩小到 70%，然后在 0.3 秒内恢复到 100%。

更复杂的动画是可能的，只要掌握基础知识，世界就会变得如此简单，至少就让东西在屏幕上飞来飞去而言，就是这样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-07T22:50:46.627

```
 UIImageView* headBandAnimation = [[UIImageView alloc] initWithFrame:CGRectMake(25, 205, 100, 50)];
    headBandAnimation.animationImages = [NSArray arrayWithObjects:    
                                    [UIImage imageNamed:@"band1.png"],
                                    [UIImage imageNamed:@"band2.png"],
                                    [UIImage imageNamed:@"band3.png"],
                                    [UIImage imageNamed:@"band4.png"], nil];
    headBandAnimation.animationDuration = 0.5;
    headBandAnimation.animationRepeatCount = 0;
    [headBandAnimation startAnimating];
    [self.view addSubview:headBandAnimation]; 
```

如果你想走这条路，如何在没有 cocos2d 的情况下制作动画。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T01:58:46.823

[Cocoa With Love](http://cocoawithlove.com/2009/02/asteroids-style-game-in-coreanimation.html)有一个关于使用 CoreAnimation 编写的短系列，也许它可能有用？

Cocoa*确实*需要很多时间来适应，而且看起来确实过于复杂，但是当你将它与我使用过的大多数其他 GUI 工具包进行比较时，它突然看起来非常优雅和简单。示例代码和大多数教程（包括我链接到的教程，尽管程度稍低）的问题是它们只向您显示完成的应用程序 - 它不显示增量。没有“我有一个空的画布”，然后是“我想出了如何画一个圆圈”，然后是“我已经为圆圈设置了动画”。

尝试制作一个新应用程序，查看示例代码/IB 项目/教程/文档中的初始化画布的位。然后寻找添加简单形状的代码。然后查找代码以使代码动画化（例如，Genericrich 答案）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-30T06:53:44.037

我知道这个线程要旧得多，但为了将来参考，[这](http://www.raywenderlich.com/32045/how-to-use-animations-and-sprite-sheets-in-cocos2d-2-x)是似乎最适合这个问题的文章。

它涉及**TexturePacker**工具，它生成满足我们需求的 a`PLIST`和 a 。`PNG`

# ruby - 学习 Ruby 中的插入排序

> ID：624666
> 
> 赞同：8
> 
> 时间：2009-03-09T01:05:01.960
> 
> 标签：ruby, algorithm

我刚刚通过网上发布的材料开始了麻省理工学院的算法入门课程。除了课程之外，我还决定通过编写其中的算法来学习/增强我的 Ruby 技能。

我使用的是第一个给出的算法，即插入排序，我输入了以下代码，但是当我运行它时出现此错误：

> insertsort.rb:5:in `>': Fixnum 与 nil 的比较失败（ArgumentError）

```
def  insertionsort(num)
for j in 2..num.length
    key = num[j]
    i = j - 1
    while i > 0 and num[i] > key
        num[i+1] = num[i]
        i = i - 1
    end
    num[i+1] = key
end 
puts num
end

numbers = [23,34,46,87,12,1,66]

insertionsort(numbers) 
```

我确信这是一个相当基本的问题，但我现在无法理解它是什么。任何帮助或提示将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-09T01:21:49.313

您正在超出数组的范围。您给出的示例假设 1-indexed 数组，但 ruby​​ 中的数组是 0-indexed。第一行应该是

```
for j in 1...num.length 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-09T01:34:28.533

另一个答案是正确的，您将超过数组中值的末尾，因为它是基于 0 的，但是您需要进行其他更改才能使算法正常工作：

```
for j in 1..(num.length - 1) 
```

和

```
while i >= 0 and num[i] > key 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-08-09T19:07:51.810

最简单的实现是这样的：

```
def insertion_sort(arr)
  for i in (1...(arr.size))
    if arr[i-1] > arr[i]
      i.downto(1) do |el|
        if arr[el] < arr[el-1]
          arr[el-1], arr[el] = arr[el], arr[el-1]
        end
      end
    end
  end
  arr
end

arr = [5, 2, 4, 6, 1, 3]

p insertion(arr) 
```

注意：为了提高算法的效率，您可以使用二分搜索进行元素比较。

[什么是插入排序？](https://en.wikipedia.org/wiki/Insertion_sort)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T10:24:41.007

只是对其他优秀答案的一个小补充：

我认为现在普遍认为 0 原点索引比 1 原点索引具有许多实际和经验优势。经验表明它只是“工作得更好”并且不易出错。

这就是为什么许多程序员从零开始编号，并让“正常”人感到惊讶。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-05-15T04:57:31.197

虽然这个练习真的很酷，但根据这篇优秀的博客文章，您可能应该避免编写自己的排序并依赖内置的 Array::sort

[http://philcrissman.com/2010/07/18/how-not-to-write-sorting-algorithms-in-ruby/](http://philcrissman.com/2010/07/18/how-not-to-write-sorting-algorithms-in-ruby/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-09T01:37:26.487

```
class InsertionSort
  attr_accessor :arr

  def initialize(arr)
    self.arr = arr
  end

  def sort
    for i in (1...(arr.size))
      j = i
      while j > 0 && arr[j - 1] > arr[j]
        swap(j)
        j = j - 1
      end
    end
  end

  def swap(j)
    v1 = arr[j]
    v2 = arr[j - 1]
    arr[j - 1] = v1
    arr[j] = v2
  end
end

arr = [4, 92, 1, 39, 19]
isort = InsertionSort.new(arr)
isort.sort
puts isort.arr 
```

# sockets - REST 用于低延迟消息传递。

> ID：624668
> 
> 赞同：2
> 
> 时间：2009-03-09T01:06:06.667
> 
> 标签：sockets, rest, messaging, tibco

为什么您没有看到更多的人将 REST 架构用于客户端服务器系统。您看到人们使用套接字、TIBCO RV、EMS 或 MQ，但我没有看到太多基本的 REST 架构

有谁知道为什么您会避免使用此架构进行客户端/服务器通信以实现高吞吐量/低延迟

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-09T01:17:04.847

REST 并不适合所有问题。

REST 最适合*资源*管理。如果您正在编写 Web 服务（如使用客户端-服务器系统），那么您会发现您需要与语言无关的数据表示、参数验证、客户端/服务器代码生成、错误处理、访问控制等内容。REST 基本上要求您自己编写这些代码。

另一方面，它添加了 HTTP 层。您可以获得代理、缓存等的无缝集成，但由于 HTTP 标头、网络服务器前端等，您确实会损失一些速度。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-09T01:22:34.960

我不知道我一定会避免它，但我可以想到几个原因，为什么我可能不会选择它来提供高吞吐量、低延迟的服务。首先，您必须处理整个 Web 堆栈才能将消息传递给您的服务。这可能会引入许多不必要的层和服务，从而延迟消息。自定义服务只需要支持服务本身所需的协议层。

其次，除非您的服务是 Web 服务器上托管的唯一服务，否则您将与其他请求竞争您的消息得到服务。虽然为您的服务拥有一个自定义端点可能无法解决所有资源争用问题，但至少您不必竞争其他服务对您的端点的访问。

第三，自定义协议只需要支持实际的服务相关协议信息，并且可能会导致更小的数据包大小，因为您不需要支持额外的 HTTP 协议开销。这将特别影响交换小消息的协议，因为标头信息将是消息大小的较大部分。

# python - 无法安装 python-setuptools: ./configure: 没有这样的文件或目录

> ID：624671
> 
> 赞同：2
> 
> 时间：2009-03-09T01:06:48.927
> 
> 标签：python, setuptools, failed-installation

该问题与[“Unable to install Python without sudo access”的答案](https://stackoverflow.com/questions/622744/unable-to-install-python-without-sudo-access/622810#622810)有关。

我需要安装 python-setuptools 来安装 python 模块。我已经解压了安装包。

配置时出现以下错误

```
[~/wepapps/pythonModules/setuptools-0.6c9]# ./configure --prefix=/home/masi/.local
-bash: ./configure: No such file or directory 
```

[我在程序的主页](http://peak.telecommunity.com/DevCenter/EasyInstall)上没有找到解决方案。

如何解决此错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T04:22:19.940

正如 Noah 所说，setuptools 不是自动制作包，因此不使用“./configure”。相反，它是一个纯 Python 风格的“setup.py”（distutils）脚本。

您通常不需要使用 .pydistutils.cfg，只要您使用正确版本的 Python 运行它。因此，如果您尚未将 .local/bin 文件夹添加到 PATH，则必须明确说明：

```
/home/masi/.local/bin/python setup.py install 
```

AIUI 这应该只是工作。

> 我在程序的主页上没有找到解决方案。

是的，他们希望您从使用默认 Python 版本的 shell 脚本 egg 安装它。你不想要的。

（如果你不能让 setuptools 工作，另一种方法是跳过它并手动安装每个模块和依赖项。就我个人而言，我对 setuptools/egg 有点反感，因为它包含太多“聪明”的魔法，不适合我的口味并且把我的文件系统弄得一团糟。但我是一个这样的老顽固。大多数 Python 模块可以作为简单的 Python 文件或普通的旧 distutils 脚本获得，但不幸的是*有些*需要鸡蛋。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T01:34:49.110

您可能需要查看[http://peak.telecommunity.com/DevCenter/EasyInstall#custom-installation-locations](http://peak.telecommunity.com/DevCenter/EasyInstall#custom-installation-locations)。

EasyInstall 是一个带有一些 shell 脚本的 python 模块（或一些带有 python 模块的 shell 脚本？），并且不使用通过“./configure”命令配置的 unix make 工具。看起来您最好的选择是尝试编辑 ~/.pydistutils.cfg 以包括：

```
[install]
install_lib = /home/masi/.local/lib/python/site-packages/
install_scripts = /home/masi/.local/bin 
```

您可能还会将 ~/.local/bin/ 文件夹作为 PATH 的一部分，以便您可以运行 easy_install 脚本。（我不确定 site-packages 目录在 .local 下的确切位置，但应该不难找到。）

希望这可以帮助。

# linux - linux Imagemagick 将 PDF 转换为 JPG 的问题

> ID：624678
> 
> 赞同：1
> 
> 时间：2009-03-09T01:13:23.483
> 
> 标签：linux, pdf, jpeg, postscript

我正在使用的系统使用 linux 实用程序 convert 将 pdfs 转换为 jpgs。我的盒子给了我以下错误。

```
>$ convert Badge-1114044091.pdf Badge-1114044091.jpg
convert: Postscript delegate failed `Badge-1114044091.pdf'.
convert: missing an image filename `Badge-1114044091.jpg'. 
```

但是生产机器没有。根据

```
>$ convert -version 
```

我的版本与生产机器相同。我不确定如何检查 postscript 是否需要更新。并不是一个真正的 Linux 大师。

**编辑：**根据建议，我检查了 Ghostscript。以下已安装。

```
>$ gs -version
ESP Ghostscript 8.15.3 (2006-08-25)
Copyright (C) 2004 artofcode LLC, Benicia, CA.  All rights reserved. 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T01:19:00.880

安装 GhostScript。

[http://www.ghostscript.com/](http://www.ghostscript.com/)

* * *

ImageMagick（“转换”实用程序）实际上并不转换 PDF；它使用神秘的命令调用 GhostScript，例如

```
gs -q -sDEVICE=jpeg -dBATCH -dNOPAUSE -dFirstPage=1 -dLastPage=1 -r<OUTPUT RESOLUTION> -sOutputFile=<OUTPUT>.jpg <INPUT>.pdf 2>&1 
```

如果您想要更多控制权，您可能想直接尝试该命令。

# .net - ClassFactory 无法提供请求的类 0x80040111 错误：-2147221231

> ID：624681
> 
> 赞同：1
> 
> 时间：2009-03-09T01:15:41.997
> 
> 标签：.net, com, shell-extensions

使用 Visual Studio 2008 时，我在尝试在 Visual Basic 中打开标准保存文件对话框时第一次遇到这种情况。到目前为止，我已经在无结果的搜索后解决了它。现在我发现任何会导致保存/打开对话框的操作（例如 ctrl-O）也会失败。我已经搜索了更多，但仍然不知道如何解决它。

我知道的东西：这不是 Visual Studio 错误，它显然可以发生在任何数量的其他应用程序中（这就是为什么搜索它很烦人）

它与 .NET 或 COM 相关，我尝试重新安装所有 .NET 却没有运气，而且我从来没有搞砸过 COM，我什至不知道它是什么。

有些东西丢失、放错了地方，或者可能是 DLL 版本问题。

我真的不想处理卸载 VS2008 或 MS Office（我发现建议的一个结果）或任何其他大型应用程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T02:51:23.263

这里的根本问题是 CoCreateInstance 失败了。如果不附加调试器并中断 CoCreateInstance，将很难找出问题所在。即使您花时间执行此操作，也不太可能修复错误。

我同意重新安装是最后的手段。但是中间步骤是尝试修复安装。如果您重新插入 VS 安装盘，其中一个选项将是“修复”安装。您可能必须通过添加/删除程序才能获得此选项。

修复比卸载/重新安装要快得多，并且很可能会解决此特定问题。

**编辑**

OP 报告修复成功但没有修复错误。您能否检查事件日志并查看是否针对此故障生成了更具体的错误？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-01T10:03:31.283

我在 VS 2008 中遇到过类似的问题，幸运的是，它通过以下解决方案得到了解决。尝试这个！！

找到 devenv.exe。右键单击>属性>取消选中禁用视觉主题选项

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T01:23:08.670

因此，某个地方的某个人正在尝试共同创建它（认为）它需要完成其工作的一些对象。这可能是也可能不是 Visual Studio 对象。由于它显示在“保存/打开”对话框中，它很可能是一个外壳对象。

最可能的解释是对象的注册表项已以某种方式损坏，或者导出对象的 dll 以某种方式损坏。对于后者，它可能完全丢失，或者由于某种原因处于不良状态。

您可以尝试做的一件事是在可能的候选 DLL 上运行 regsvr32，但这只是在黑暗中拍摄。

另一个更高级的选项是将调试器（例如 ntsd 或 windbg）附加到它自己的 Visual Studio 进程并在系统 dll 中的 CoCreateInstance() 上设置断点（确保在头文件中查找其确切签名 -它可能是#defined 到别的东西）。然后获取它作为参数传递给 CoCreateInstance() 的对象的 GUID。在您的注册表（或没有此问题的朋友注册表）中查找此内容应该可以让您很好地了解需要处理的 DLL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-28T18:42:10.577

Unchecking `Disable Visual Themes` didn't work for me, but running in xp compatibility mode fixed it. I'm assuming the problem is a missing dll.

# c++ - 将指针传递给使用 exec() 生成的进程

> ID：624691
> 
> 赞同：1
> 
> 时间：2009-03-09T01:19:24.357
> 
> 标签：c++, linux, gcc, exec, mmap

我想向使用 fork + exec 生成的进程传递一个指针（我正在使用 mmap 将一个包含数据的文件放入内存中），但我被困在如何将指针传递给 exec() 生成的进程？

更新1：

感谢您的输入，我确实使用共享内存使用带有 MAP_INHERIT 标志的 mmap 创建它：

使用 mmap() 函数创建的每个映射文件和共享内存区域都会通过成功调用任何 exec 函数来取消映射，使用 MAP_INHERIT 选项映射的区域除外。使用 MAP_INHERIT 选项映射的区域仍然映射在新的过程映像中。

来源：[http ://www.uwm.edu/cgi-bin/IMT/wwwman?topic=exec(2)&msection=](http://www.uwm.edu/cgi-bin/IMT/wwwman?topic=exec(2)&msection=)

更新2：

这是家庭作业练习，但我认为我必须停止考虑指针并考虑 IPC 本身。我想我会尝试在子进程中映射同一个文件。

非常感谢短代码示例。

在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-09T01:22:53.960

如果使用共享内存，则无法传递指针。指针将包含虚拟地址，该地址与一个进程不同。您必须根据共享内存区域的开始交换偏移值。

如果您不使用共享内存，则无法交换任何类型的指针：其他进程将无法访问您进程的内存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T01:22:07.130

这是行不通的。新进程也应该`mmap`是文件本身。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T01:32:46.340

生成的进程可能应该打开一个返回父进程的管道，并请求它需要映射共享内存段的数据。

或者，您可以使用 boost::interprocess 为您创建一个共享内存段并实际传递地址（它可以进行映射）。不过，您自己阅读该文档：http: [//www.boost.org/doc/libs/1_38_0/doc/html/interprocess.html](http://www.boost.org/doc/libs/1_38_0/doc/html/interprocess.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T02:39:19.253

考虑将文件内内存的偏移量传递给子进程。如果偏移量为零，则不要打扰，但是如果您需要传递一个“指针”以部分通过文件，则将其转换为从起始地址开始的偏移量，并将其传递给子级。然后，孩子可以通过将偏移量添加到它为映射文件获得的地址来获取数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T01:21:14.493

只需在命令行参数或环境变量中作为文本传递。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T07:02:12.763

这是一个很大的区域，你有很多选择。

找到这些解决方案的关键是搜索诸如[Linux 处理器间通信](http://www.google.se/search?hl=en&safe=off&client=firefox-a&rls=com.ubuntu%3Aen-GB%3Aunofficial&hs=4zp&num=20&q=Linux+inter+processor+communication&btnG=Search)或[Linux IPC](http://www.google.se/search?hl=en&safe=off&client=firefox-a&rls=com.ubuntu%3Aen-GB%3Aunofficial&hs=rKV&num=20&q=Linux+IPC&btnG=Search)之类的东西。

IPC 简介也可以在诸如 Advance Linux Programming (ISBN: 0-7357-1043-0) 等书籍中找到

# algorithm - 设计一个也可以在 O(1) 摊销时间内出列的堆栈？

> ID：624704
> 
> 赞同：4
> 
> 时间：2009-03-09T01:25:32.067
> 
> 标签：algorithm, stack, amortized-analysis

我有一个抽象数据类型，可以看作是从左到右存储的列表，有以下可能的操作： Push：向列表左端添加一个新项目 Pop：删除列表左端的项目 Pull ：删除列表右端的项目

使用三个堆栈和恒定的附加内存来实现这一点，以便任何推送、弹出或拉取操作的摊销时间都是恒定的。堆栈具有基本操作，isEmpty、Push 和 Pop。

摊销时间的意思是“如果我花这么多时间，我可以再花一部分时间，并将其存储在时间银行中以备后用。” 就像每次推送操作一样，花费三个常量时间块，所以对于每个推送的元素，你有 2 个额外的常量时间块。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-09T01:44:35.623

做几个假设：

1.  这是作业
2.  这一段是作业的一部分

> 使用三个堆栈和恒定的附加内存来实现这一点，以便任何推送、弹出或拉取操作的摊销时间都是恒定的。堆栈具有基本操作，isEmpty、Push 和 Pop。

那么我的第一个建议是忽略那些与你谈论链表的人。诚然，这就是任何理性的人在*没有三栈要求的情况下实施它的方式，*但家庭作业的关键因素不是按照理性人的方式去做，而是你的导师希望你如何去做。

我的第二条建议是准备一些积木、一副纸牌或一堆泡沫塑料杯，并指定三叠（例如杯垫或其他东西）。开始尝试将一个堆栈的内容转移到另一个堆栈时会发生什么，这应该会给你一个想法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-09T01:41:54.850

你可以做一些只使用 3 个堆栈的事情。想想[河内的塔](http://en.wikipedia.org/wiki/Tower_of_Hanoi)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T01:30:50.867

使用双向链表并保持指向头部和尾部的指针。其余的，您需要先编写自己的代码，然后让我们帮助您更正它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T21:54:19.163

首先根据两个堆栈（一个非常标准的问题）实现一个队列并进行概括。

# jquery - 使用 jQuery.find() 和 XML 文档获取 HTMLUnknownElement

> ID：624723
> 
> 赞同：2
> 
> 时间：2009-03-09T01:32:15.793
> 
> 标签：jquery, xml, ajax, internet-explorer

我正在尝试通过 Ajax 请求加载 XML 文档（特别是 RSS 提要），对其进行解析，然后将基于所述提要的一些信息插入到我的页面中。该代码在 Firefox、Opera、Chrome 和 Safari 中运行良好，但在 IE7 中运行良好。去搞清楚。

在进行了一些初步调试之后，我发现 XML 字符串*是*通过请求检索的，而我在尝试从文档中解析节点时得到的特定节点类型是**HTMLUnknownElement**。

以下是相关代码：

```
$.get('feed.php', function(oXmlDoc) {

    var titles = $(oXmlDoc).find('title');
    var dates = $(oXmlDoc).find('pubDate');

    for(var i = 0; i < 5; i++) {
        parseNodes(titles[i].firstChild.nodeValue, dates[i].firstChild.nodeValue));
    }

}); 
```

该`parseNodes`函数实际上从未被命中，因为 IE 无法访问`firstChild`，因此`nodeValue`.

提前感谢有关如何解决此问题的任何想法和/或建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T17:29:00.970

我能够解决这个问题，但它需要一些特定于 IE 的代码才能使其正常工作。本质上，这就是我最终不得不解决问题的方式。

首先，我验证了我的服务器端代码返回了正确的内容类型：

```
header('Content-Type: application/rss+xml'); 
```

之后，我进行了检查以查看当前正在访问该页面的浏览器：

```
if($.browser.msie) {
    // ie-specific code (see below)
} else {
    // code as posted in the question
} 
```

为了更好地控制 ajax 请求，我选择使用 jQuery 的`$.ajax`函数而不是`$.get`函数。

```
var oXmlDoc = new ActiveXObject("Microsoft.XMLDOM");
$.ajax({
    url: "feed.php",
    processData: false,
    data: oXmlDoc,
    success: function(sXml) {
        oXmlDoc.loadXML(sXml) 
        var titles = $('title', oXmlDoc);
        var dates = $('date', oXmlDoc);
        for(var i = 0; i < 5; i++) {
            parseNodes(titles[i].childNodes[0].nodeValue, dates[i].childNodes[0].nodeValue));
        }
     }
}); 
```

无论如何，它不像我想要的那样优雅，但它完成了工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-02T20:21:03.573

这对我使用 GET 有用

```
$.get("url.php", { mode: "r"},
    function(data){
     //FIX FOR UNKNOWNHTML OBJECT RETURNED IN IE
     if(navigator.appName.indexOf("Microsoft")>=0) {
        var xData = new ActiveXObject("Microsoft.XMLDOM");
        xData.loadXML(data);
     } else {
        var xData = $(data)
     }
     $(xData).find("room").each(function() {
            alert($(this).find("name:first").text());
     });
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T01:37:59.213

**编辑**

在您发表评论后，我仔细查看了您的代码。Find 与选择器不同，它返回一个 jQuery 对象，但您需要实际的 DOM 对象。尝试使用 get() 从 jQuery 中检索元素数组。您可能还需要使用 childNodes[] 。

```
$.get('feed.php', function(oXmlDoc) {

    var titles = $(oXmlDoc).find('title').get();
    var dates = $(oXmlDoc).find('pubDate').get();

    for(var i = 0; i < 5; i++) {
        parseNodes(titles[i].childNodes[0].nodeValue,
                   dates[i].childNodes[0].nodeValue));
    }

}); 
```

# java - 如何从其 URL 中获取 MP3 的长度？

> ID：624741
> 
> 赞同：3
> 
> 时间：2009-03-09T01:43:37.297
> 
> 标签：java, url, properties, mp3

如果我知道 MP3 文件的 URL，获取其长度、比特率、大小等的最简单/最快的方法是什么？

如何仅下载 MP3 的 ID3 标签部分以获取这些详细信息？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T01:45:24.747

您将需要查看 mp3 文件中的 ID3 标签。

除非您在其他地方跟踪您想要的元数据。

要明确获取文件的轨道长度，您需要确定查看 ID3 元数据标签，特别是标签的“TRCK”框架。

要仅下载 ID3 Tag 部分，您必须先下载文件的 ID3 标头部分。

该[网站](http://www.id3.org/Developer_Information)包含有关 ID3 标签格式的非常具体的信息。您将需要查看 ID3 标签的版本号，然后，您将需要找到有关 ID3 标签长度的信息。然后，您必须下载整个标签，因为帧没有任何特定的顺序。

然后您应该能够使用第三方库来查找 TRCK 框架及其数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T03:54:09.167

> 获取其长度、比特率、大小等的最简单/最快的方法是什么？

可以通过 HTTP HEAD 请求获得的文件大小。如果“长度”是指播放时间（以秒为单位），则如果不获取整个文件，您将无法获得此信息。您可以*猜测*，通过获取前几个 MP3 帧，查看它们的比特率，并假设文件的其余部分具有相同的比特率，但鉴于可变比特率编码的流行，这将接近准确的可能性是相当的低的。

ID3 标签理论上可以在 ASPI 和 ETCO 标签中包含可以让您更好地猜测长度的信息。但在实践中，这些很少出现。

> 如何仅下载 MP3 的 ID3 标签部分以获取这些详细信息？

对于 ID3v2 标签，抓取文件的开头。（ID3v2 帧可能在其他地方，但实际上它们总是在那里。）您无法提前知道标签将存在多长时间。对于纯文本标签，您可能会在前 512-1024 个字节中找到您想要的信息。不幸的是，越来越多的 MP3 嵌入了“专辑封面”图片，这些图片可能会更长；尝试选择一个可以优雅地忽略截断的 ID3 信息的 ID3 库。

ID3v1 标记位于文件末尾。同样，您无法确定它们会持续多长时间。当然，您事先并不知道该文件是否具有 ID3v1 标签、ID3v2 标签，或者两者都没有。一般来说，现在 ID3v2 是一个更好的选择。

要通过 HTTP 读取文件的一部分，您需要[Range](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35.2)标头。这也不是所有地方都支持的。

总之，这有很多问题，最好的选择可能是放弃并只获取整个文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T01:46:08.007

这是获取文件大小的方法，但是如何获取比特率和轨道长度？

```
import java.io.*;
import java.net.*;

public class FileSizeFromURL {
public static final void main(String[] args) {
URL url;
URLConnection conn;
int size;

if(args.length != 1) {
  System.out.println("Usage: FileSizeFromURL ");
  return;
  }

try {
  url = new URL(args[0]);
  conn = url.openConnection();
  size = conn.getContentLength();
  if(size < 0)
     System.out.println("Could not determine file size.");
  else
    System.out.println(args[0] + "\nSize: " + size);
  conn.getInputStream().close();
  } 
catch(Exception e) {
  e.printStackTrace();
  }
}
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-06T19:02:47.340

我在被问到一年后才回答这个问题，但我确实有一些信息可以为以后发生的事情添加一些信息。我回答了一个类似的问题，即在不下载整个图像的情况下从远程服务器上的图像中获取图像尺寸。请参阅以下 URL 中的讨论：

[使用 Curl 获取图像尺寸](https://stackoverflow.com/questions/869989/get-image-dimensions-with-curl/2597990#2597990)

您绝对可以使用相同的技术从 ID3 标签中提取信息，而无需从远程服务器下载整个 MP3。

希望对以后的路人有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T01:45:06.683

您无法仅从 URL 获取此信息。

您必须加载前几 K 的内容并使用 mp3 库来解码标题并获取值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T01:45:28.990

该数据在 id3 标记中编码，因此您至少需要下载该文件的大部分内容，该文件位于开头，因此您很幸运。

或者，您可以查看 http 响应标头中的 content-length 标头值以了解长度，如果服务器告诉您它可能没有。

# java - 在 Web 服务器上运行 Java

> ID：624749
> 
> 赞同：11
> 
> 时间：2009-03-09T01:45:44.683
> 
> 标签：java, php, web-applications, servlets

我已经编写了一个独立的 Java 应用程序，我已经将它打包到一个 jar 文件中，该文件接受一些命令行参数，进行一些核心计算，然后将结果连同一些输出写入到默认输出流的文件中，指向哪里带有结果的文件是。

我现在想围绕这项技术创建一个网站。这个想法是，用户可以填写一个 html 表单，将其发布到网页，然后该网页将调用 Java 应用程序，解析来自 Java 应用程序的结果，并将其显示给用户。

目前，我正在使用一点 PHP 从发布请求中收集数据，然后只使用 exec 调用：

```
java -jar -Xmx128m myapplication.jar 命令行参数
```

这很糟糕吗？

我每天确实有数千次访问我的网站，Java 应用程序的每次执行可能需要 30 秒到一分钟以上的时间，所以我不想过于低效。似乎有比必须为每个请求直接调用 Java 更好的解决方案。

我不断听到诸如 java servlet、bean、tomcat、glassfish 等之类的东西，但我不明白它们是什么以及它们将如何使我受益。这些对我有什么好处？更快的结果是因为每次运行应用程序时都不必创建 Java JVM？更少的内存使用？我显然希望它以尽可能少的内存占用尽可能快地运行。

那么，我可以在这里采取的最佳方法是什么？我不想对我的应用程序进行任何认真的重写，因为有很多代码（因此将其重写为 C 或 C++ 是不可能的）。

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-09T02:06:36.053

好的，servlet 是设计为在容器内运行的小型应用程序。它们为您提供了一个扩展点，可以将您的 java 代码插入到像 tomcat 这样的简单 servlet 容器中，或者像 glassfish 这样的功能更齐全的应用程序服务器中。您希望这样做是因为应用程序服务器完成了处理 http 交互的繁重工作，并提供了其他功能，例如安全性、日志记录、会话管理、错误处理等（请参阅[servlet 规范](http://jcp.org/aboutJava/communityprocess/mrel/jsr154/index.html)）。

当您将应用程序置于应用程序容器（具有所有其他额外功能的 Web 服务器）中时，您还可以更好地管理应用程序的生命周期。您将能够启动和停止应用程序，而无需关闭 Web 服务器、重新部署、启动更多实例等。另外，当您提出第二个应用程序时，很容易将其放在第一个应用程序旁边. 或者，您可以将多台机器集群在一起，以实现应用服务器的轻松冗余和负载平衡功能。

这只是一个开始，还有更多功能、技术和框架可以帮助您制作基于容器的应用程序。[Servlet 教程](http://java.sun.com/products/servlet/articles/tutorial/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T01:52:22.190

[这些让我明白吗]“因为不必在每次运行应用程序时都创建 Java JVM 而获得更快的结果？”

是的。

并且——奖励——您可以替换 PHP，这样您的整个网站就使用一种语言：Java。

此外，您可以考虑修改您的用例，使其不再是一次痛苦的 30-60 秒，而是可能与用户交互执行一系列更快的步骤。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T02:11:47.447

在 servlet 容器中运行您的代码。

假设您需要使用 PHP 保存您的网站，并且您的机器上已经安装了 java，只需安装一个免费的 servlet 容器（例如 Apache Tomcat 或 Jetty）。配置为在未使用的端口上运行 servlet 容器。（8080）是他们的默认值。

这些 servlet 容器实际上是基于 Java 的 Web 服务器，就像 Apache，但是专门用于提供 Java 代码。

使用 java webserver 而不是为每个请求调用新的 java.exe 最明显的优势是，您的 java 虚拟机 (jvm) 将始终“热”，启动并运行。java.exe (jvm) 的每次新启动都会给您带来额外的浪费时间。

使用 servlet 容器的第二个优点是，容器将使您的代码能够在 jvm 内的新线程中针对每个新请求运行。每天为成千上万的用户提供服务不会有任何问题。如果您要启动数百个而不是一个 java 实例，您的机器很可能会崩溃。

将您的代码放在一个 servlet 中。即使对于新手来说也很容易。您将通过 HTTP（servlet 的 doGet 或 doPost 方法）与 servlet 对话。将 php 请求表单传递给这个 servlet，让 servlet 给您返回任何内容：页面、json 对象、xml 或纯文本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T01:49:30.637

您可能不想直接从网站调用 java 应用程序。正如您所说，如果 java 进程需要 30 秒才能运行，您的 Web 服务器将会陷入困境，尤其是当您的网站受到重创时。

您可能希望查看用于分派后端处理请求的 Web 服务（可能还有消息队列）。PHP 页面可以调用服务器上的 web 服务，然后服务器可以将处理请求放在队列中，或者只是以异步方式启动 java 应用程序。您不希望 HTTP 请求等待 java 应用程序完成，因为在处理过程中，用户只会有一个挂起的浏览器，并且 HTTP 请求可能会超时。

Java 应用程序完成后，它可以更新数据库表，然后用户可以从网站访问该表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T10:07:02.110

最简单的开始就是在你的应用程序中嵌入一个网络服务器。看看[码头](http://docs.codehaus.org/display/JETTY/Embedding+Jetty)。

# .net - 网格视图-颜色

> ID：624752
> 
> 赞同：1
> 
> 时间：2009-03-09T01:49:09.887
> 
> 标签：.net, gridview

我的网格视图根据搜索按钮显示详细信息。但我希望最新的日期行被着色以帮助用户识别最新的。你能帮忙吗？我正在使用 ASP.NET、VB.NET、SQL-2005

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T01:55:01.153

这应该是可以谷歌搜索的：

[http://digitalcolony.com/2007/07/highlight-rows-and-columns-on-gridview.aspx](http://digitalcolony.com/2007/07/highlight-rows-and-columns-on-gridview.aspx)

[http://www.dotnetcurry.com/ShowArticle.aspx?ID=123](http://www.dotnetcurry.com/ShowArticle.aspx?ID=123)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-20T09:50:24.550

用这个

```
public void NonEventModelHighlighting(Grid grid)
{
    //Initialize the grid
    grid.Headers.Add(new Header());
    grid.Headers[0].Add(new Column("Name"));
    grid.Headers[0].Add(new Column("Color"));
    grid.Headers[0].Add(new Column("Price"));

    //Set highlighting parameters
    grid.Highlighting.Fading = true;
    grid.Highlighting.Interval = TimeSpan.FromSeconds(2);

    //Set semi-transparent color
    grid.Highlighting.Color = Color.FromArgb(128, Color.Red);

    //Populate the grid
    Row rowMercedes = grid.Rows.Add(new object[] { "Mercedes", Color.Black, 25000d });
    Row rowBMW = grid.Rows.Add(new object[] { "BMW", Color.White, 35000d });

    //Cut off the BMW's price - this will highlight the 'Price' cell for 2 seconds with semi-transparent Red color
    rowBMW["Price"].Value = 24000d;

    //Highlight 'BMW' name with the green color for 3 seconds
    rowBMW["Name"].Highlight(TimeSpan.FromSeconds(3), Color.Green);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T01:58:21.330

你有能力拦截每一行的绑定，所以一半的问题在盒子外面解决了。_OnRowDatabound 有效。

解决方案的唯一其他部分是获取显示日期的最大日期。您可以通过查询批处理中的第二个查询来执行此操作（以避免第二次数据库命中），或者您可以通过在绑定之前循环数据来执行此操作。

当 date == max date 时，您只需更改行中单元格的背景颜色或任何您想要的颜色。

# flash - 在 Flash (AS3) 的动态文本框中启用对导入的旋转图像进行平滑处理

> ID：624754
> 
> 赞同：2
> 
> 时间：2009-03-09T01:50:30.447
> 
> 标签：flash, actionscript-3

我在舞台上有一个旋转 10° 的影片剪辑，里面有一个动态文本框。我正在加载一些文本，其中嵌入了图像：

（现在使用第一帧 AS3，最终这将进入一个类。）

```
var txt:String = '<img src="foo.gif" id="myImg1" /><p>Lorem ipsum</p>';

my_mc.txtBox.htmlText = txt; 
```

哪个工作正常。文本被放置，甚至很好地环绕图像。问题是，图像看起来很糟糕。我找到了 Bitmap.smoothing 属性，但似乎无法访问图像来设置属性。我正在尝试这段代码：

```
var img:DisplayObject = my_mc.txtBox.getImageReference('myImg1');
if (typeof(img) != 'undefined') {
    img.contentLoaderInfo.addEventListener(Event.COMPLETE, onHtmlImageLoaded);
}

function onHtmlImageLoaded(event:Event):void{
    event.target.removeEventListener(Event.COMPLETE, onHtmlImageLoaded);
    Bitmap(event.target.content).smoothing = true;  
} 
```

但是，“img.contentLoaderInfo ...”行会引发此错误：

```
1119: Access of possibly undefined property content through 
a reference with static type flash.display:DisplayObject. 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T13:53:53.187

试试这个：

```
var img:Loader = Loader( tx.getImageReference('proceso') );
img.contentLoaderInfo.addEventListener(Event.COMPLETE, onHtmlImageLoaded);

function onHtmlImageLoaded(event:Event):void{
    event.target.removeEventListener(Event.COMPLETE, onHtmlImageLoaded);
    Bitmap(event.target.content).smoothing = true;      
} 
```

这是工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T08:26:24.893

我认为您只是`Loader`在事件处理程序中缺少转换：

```
Bitmap(Loader(event.target).content).smoothing = true; 
```

**编辑：**注册事件处理程序时做同样的事情：

```
 Loader(img).contentLoaderInfo.addEventListener(Event.COMPLETE, onHtmlImageLoaded); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T04:03:21.017

我会尝试对图像使用 BitmapData 类，并对其应用平滑处理。

# jquery - jQuery 选择器可以应用于一个元素而不是整个文档吗？

> ID：624757
> 
> 赞同：8
> 
> 时间：2009-03-09T01:53:51.357
> 
> 标签：jquery, css-selectors

```
jQuery('td[class=bgoff]').each(function() {
    var td = jQuery(this);
    ... no apply selector to "this" only
}); 
```

我正在使用 html 中的表格数据并尝试解析每个 TD 的内容（它们不是唯一可识别的）。

使用 XPath，我可以将“this”的路径添加到其他选择中。

如何使用 jQuery 实现这一点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-09T02:03:32.990

使用 jQuery，您可以选择在选择器表达式之后提供第二个参数，这将成为 jQuery 用来限制查找范围的上下文。[在这里](http://docs.jquery.com/Core/jQuery#expressioncontext)了解更多

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-09T02:13:46.957

如果您已经有一个要在其中搜索的 jquery 对象，您也可以使用 .find(expression) 。

在您的示例中：

```
jQuery('td[class=bgoff]').each(function() {
    var td = jQuery(this);
    $(td).find( <selector to search within td> );
}); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-09T09:52:04.673

从[jQuery 源代码](http://dev.jquery.com/browser/trunk/jquery/src/core.js#L73)：

```
// HANDLE: $(expr, context)  
// (which is just equivalent to: $(context).find(expr) 
```

# c# - 重载绑定列表 具有 T 子类的父属性

> ID：624763
> 
> 赞同：2
> 
> 时间：2009-03-09T01:55:45.940
> 
> 标签：c#, oop

我有一个想法，最简单的似乎应该可行。

我正在尝试使用 a of 重载子类中的类型`BindingList<T>`属性。有一些方法可以解决这个问题，但似乎“最好”的方法是没有任何直接投射。我尝试了很多选项并有一些解决方案，但我对其中任何一个都不是特别满意。`BindingList``<subclasss T>`

有没有最好的方法呢？一个*简单*的代码示例可能是最好的描述符 在下面的这个示例中，我想派生一个只包含苹果但使用相同的属性名称来访问`BindingList<>`Apples 的水果碗（在子类的情况下；在超级班）。

- - - - 例子 - - - -

```
class Fruit{}
class Apple: Fruit {}

class FruitBowl
{
  protected BindingList<Fruit>  m_aFruits;

  public BindingList<Fruit> Fruits
  {
    get {return m_aFruits;}
  }
}

class AppleBowl : FruitBowl
{
  public BindingList<Apple> Fruits
  {
    get {return m_aFruits;}
  }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T02:46:51.713

您尝试做的事情被称为 Co/Contra Variance。不幸的是，这在 C# 中的具体类型上不受支持（仅适用于 C# 4.0 的接口）。鉴于 BindingList<T> 的实现，不可能做你想做的事并只维护一个列表。

您可以尝试以多种方式伪造它。解决此问题的一种方法是仅在子类上使用 IEnumerable<T>。在这种情况下，一个简单的 LINQ 查询就可以解决问题。

```
class AppleBowl : FruitBowl
{
  public IEnumerableApple> TypedFruits
  {
    get {return base.Fruits.Cast<Apple>();}
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T02:03:02.973

```
class FruitBowl<T> where T : Fruit //this requires T to inherit from Fruit
{
    protected BindingList<T> Fruits;
}

class AppleBowl : FruitBowl<Apple>
{
    //AppleBowl will have an inherited property Fruits 
    //of type BindingList<Apple>
} 
```

# ios - 奇怪的构建错误，类名问题？

> ID：624766
> 
> 赞同：0
> 
> 时间：2009-03-09T01:57:57.417
> 
> 标签：ios, objective-c, xcode, macos, cocoa

我正在做一个简短的项目，只是为了在不使用 nib 文件的情况下尝试写作（仅限个人兴趣，不要打算永远不使用 nib！）。

我将我的应用控制器设置为 NSApp 的代表。在 -(void)applicationDidFinishLaunching:(NSNotification *)aNotification 下，我尝试初始化接口。

应用控制器.h：

```
#import <Cocoa/Cocoa.h>
#import <QTKit/QTKit.h>

@interface AppController : NSObject {

NSWindow* mainWindow;
QTMovieView* movieView;
QTCaptureSession* mainSession;
QTCaptureMovieFileOutput* output;
QTCaptureDeviceInput* video;
QTCaptureDeviceInput* audio;

}

+ (void)initialize;
- (id)init;

- (void)applicationDidFinishLaunching:(NSNotification *)aNotification;

@end 
```

AppController.m 中的方法

```
- (void)applicationDidFinishLaunching:(NSNotification *)aNotification {

//Proceed to initialize the entire interface:

mainWindow = [[NSWindow alloc] initWithContentRect:NSMakeRect(500, 300, 700, 500)
styleMask:(NSTitledWindowMask|NSClosableWindowMask|
  NSMiniaturizableWindowMask|NSResizableWindowMask) 
backing:NSBackingStoreBuffered
defer:NO];

[mainWindow setTitle:@"Record a movie!"];

/*movieView = [[QTMovieView alloc] initWithFrame:NSMakeRect([[mainWindow contentView] bounds].origin.x + 5, 
                                                [[mainWindow contentView] bounds].origin.y + 30,
                                                    [[mainWindow contentView] bounds].size.width - 10, 
                                                    [[mainWindow contentView] bounds].size.height - 35)];*/

[[mainWindow contentView] addSubview:movieView];

[mainWindow makeKeyAndOrderFront:NSApp];

} 
```

注释掉的部分是文本编辑器中没有出现的 1 错误的来源，仅出现在“构建”面板中：

```
<pre> ".objc_class_name_QTMovieView", referenced from:  
literal-pointer@_OBJC@_cls_refs@QTMovieView in AppController.o
symbol(s) not found
collect2: Id returned 1 exit status 
```

There seems to be a problem with alloc/init'ing an instance here. I can declare a new one just fine, i.e. QTMovieView *test; and nothing complains. I've also found that it does the same thing with all the other QT classes when I try to alloc/init them. However, I was able to alloc/init NSWindow just fine. The framework is in my project and as you can see in my .h file, I included QTKit.

Anyone know what's going on?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T02:23:03.580

The error you're getting is a linker error -- the linker (`ld`) can't find the framework object code for the `QTMovieView` class. Therefore, you haven't included the QTKit framework in your project. If you think you have, then something about it isn't set up properly.

# mysql - MySQL 查询因违反完整性约束而失败

> ID：624774
> 
> 赞同：1
> 
> 时间：2009-03-09T02:00:54.400
> 
> 标签：mysql, pdo

此查询一直失败

> 完整性约束违规：1048 列 'login_name' 不能为空

我的插入语句是...

```
 $insertUserQuery = 'INSERT INTO `users` (
                    `login_name`,
                    `password`, 
                    `first_name`,
                    `last_name`,
                    `company_name`,
                    `company_address`,
                    `country`,
                    `email`,
                    `phone_number`,
                    `agency_type`,
                    `sold_before`,
                    `authorised`,
                    `current_module`
                    )
                    VALUES (
                   :login_name, :login_password, :first_name, :last_name, :company_name, :company_address, :country, :email, :phone_number, :agency_type, :sold_before, 0, 0);';

    $bindings = array(':login_name'      => $loginName,
                      ':login_password'  => sha1($password . Config::PASSWORD_SALT),
                      ':first_name'      => $firstName,
                      ':last_name'       => $lastName,
                      ':company_name'    => $companyName,
                      ':company_address' => $companyAddress,
                      ':country'         => $country,
                      ':email'           => $emailAddress,
                      ':phone_number'     => $phone,
                      ':agency_type'     => null,
                      ':sold_before' => null  
                      );

print_r($bindings);                 

    Db::query($insertUserQuery, $bindings); 
```

我的数据库类可以[在另一个问题](https://stackoverflow.com/questions/617646/is-this-wrapper-for-pdo-good-code-are-there-any-potential-problems)中找到。`print_r()`告诉我该数组肯定有一个值 。

使用“密码”这个词是否与我有关，它也是一个 MySQL 函数？

PDO 是否以与 SELECT 相同的方式支持使用 INSERT 准备好的语句？

我是否需要引用这些值，例如'：login_name'？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T02:47:15.677

`PDO::query`不支持准备好的语句语法吗？给[PDO::prepare](http://us.php.net/manual/en/pdo.prepare.php)和[PDOStatement::execute](http://us.php.net/manual/en/pdostatement.execute.php)一个读操作。你可能想要这样的东西：

```
$insertUserQuery = 'INSERT INTO `users` (`login_name`, ...) ' .
    'VALUES (:login_name, ...);';
$bindings = array(':login_name' => $loginName, ...);
$stmt = Db::prepare($insertUserQuery);
$stmt->execute($bindings); 
```

您也可以调用`$stmt->bindValue()`而不是构建绑定数组。我认为显式绑定每个值会更好一些，因为您可以在那里验证类型。

编辑：对不起，jcinacio，直到我发布后，我才看到您的评论几乎相同。

# c# - 如何将有向无环图 (DAG) 转换为树

> ID：624778
> 
> 赞同：16
> 
> 时间：2009-03-09T02:02:18.500
> 
> 标签：c#, data-structures, tree, directed-acyclic-graphs

我一直在寻找将 DAG 转换为树的 C# 示例。

有没有人有正确方向的例子或指示？

**澄清更新**

我有一个图表，其中包含我的应用程序需要加载的模块列表。每个模块都有一个它依赖的模块列表。例如这里是我的模块，A、BC、D 和 E

*   A 没有依赖关系
*   B 取决于 A、C 和 E
*   C 取决于 A
*   D 取决于 A
*   E 取决于 C 和 A

我想解决依赖关系并生成一个看起来像这样的树......

- 一种

--+--B

-----+--C

---------+--D

--+--E

**拓扑排序**

感谢您提供的信息，如果我执行拓扑排序并反转输出，我将具有以下顺序

*   一种
*   乙
*   C
*   D
*   乙

我想维护层次结构，以便将我的模块加载到正确的上下文中，例如...模块 E 应该与 B 在同一个容器中

谢谢

罗汉

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-07-13T08:58:39.403

有图形理论答案和程序员对此的答案。我假设您可以自己处理程序员部分。对于图论的答案：

*   DAG 是一组模块，其中 A 需要 B，同时 B（或 B 需要的模块之一）需要 A，用模块来说：没有循环依赖。我已经看到发生了循环依赖（在 Gentoo 论坛中搜索示例），所以你甚至不能 100% 确定你有一个 DAG，但让我们假设你有。检查循环依赖并不难，所以我建议你在模块加载器的某个地方这样做。
*   在树中，永远不会发生的事情是 A 依赖于 B 和 C，而 B 和 C 都依赖于 D（菱形），但这可能发生在 DAG 中。
*   此外，一棵树只有一个根节点，但 DAG 可以有多个“根”节点（即没有任何依赖关系的模块）。例如像 GIMP 这样的程序，GIMP 程序将是模块集的根节点，但对于 GENTOO，几乎所有带有 GUI 的程序都是“根”节点，而库等是它们的依赖项。（Konqueror 和 Kmail 的 IE 都依赖于 Qtlib，但不依赖于 Konqueror，也不依赖于 Kmail）

正如其他人指出的那样，您的问题的图表理论答案是 DAG 不能转换为树，而每棵树都是 DAG。

但是，（高级程序员回答）如果您想要树用于图形表示，您只对特定模块的依赖关系感兴趣，而不是依赖于该模块的内容。让我举个例子吧：

```
A depends on B and C
B depends on D and E
C depends on D and F 
```

我不能将它显示为 ASCII 艺术树，原因很简单，它不能转换成树。但是，如果要显示 A 依赖的内容，可以显示：

```
A
+--B
|  +--D
|  +--E
+--C
   +--D
   +--F 
```

如您所见，您的树中有两个条目 - 在这种情况下“仅” D 但如果您在 Gentoo 树上执行“全部扩展”，我向您保证您的树将具有至少 1000 倍的节点数量有模块。（至少有 100 个包依赖于 Qt，所以 Qt 所依赖的所有东西都会在树中出现至少 100 次）。

如果你有一个“大”或“复杂”的树，最好动态地扩展树，而不是提前，否则你可能会有一个非常占用内存的过程。

上面树的缺点是，如果你点击打开 B，然后打开 D，你会看到 A 和 B 依赖于 D，但不是 C 也依赖于 D。但是，根据你的情况，这可能根本不重要- 如果您维护已加载模块的列表，则在加载 C 时，您会看到您已经加载了 D，并且它不是为 C 加载的，而是为 B 加载的并不重要。它已加载，仅此而已。如果您动态维护直接依赖于某个模块的内容，您也可以处理相反的问题（卸载）。

然而，你不能用树做的是你最后一句话中的内容：保持拓扑顺序，即如果 B 与 C 被加载到同一个容器中，你将永远无法将 C 加载到同一个容器中。或者您可能不得不忍受将所有东西都放在一个容器中（并不是我完全理解“装入同一个容器”的意思）

祝你好运！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-09T02:18:46.180

DAG 和树在数学上不是一回事。因此，任何转换都会引入歧义。根据定义，一棵树没有周期，周期。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T02:36:25.467

为了找到加载模块的顺序，您正在寻找的是 DAG 的[拓扑排序](http://en.wikipedia.org/wiki/Topological_sort)。如果边缘从一个模块到它所依赖的模块（我认为这是最有可能的），您必须以拓扑排序的相反顺序加载模块，因为模块将出现在所有模块之前它取决于它。

如果你表示 DAG，使得边从依赖的模块到依赖于它们的模块（你可以通过反转上图中的所有边来得到这个），你可以按照拓扑的顺序加载模块种类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T02:06:51.623

这在很大程度上取决于您如何代表您的 DAG。例如，它可以是一个邻接矩阵（如果从节点 i 到节点 j 有一条边，则 A[i,j] = 1，否则为 0），或者作为指针系统，或者作为节点数组和边缘……

此外，尚不清楚您要应用什么转换。连接的 DAG*是*一棵树，所以恐怕您需要稍微澄清一下您的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-11-05T11:51:34.137

答案是你想获得一棵[生成树](https://en.wikipedia.org/wiki/Spanning_tree)。这甚至是为无向图定义的，因此即使您有循环，您也可以忽略边的方向，获得无向图并获得后者的生成树。您需要哪种生成树取决于您，因为有很多可能性，例如*最小生成树*。

我一直在寻找的是一种获得“冗余”生成树的算法，该生成树保留除“复制”节点之外的所有边。不幸的是，我还没有找到这个问题的名称，但我认为如果你自上而下并且没有循环迷失，算法很简单。仍然为这个问题命名会很好，因为寻找现成的快速实现。

概括起来就是有一个生成树的森林。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T02:05:48.583

只有当所有子树都有一个根节点时，您才能这样做。

# algorithm - 如何设计一个近似解算法

> ID：624788
> 
> 赞同：0
> 
> 时间：2009-03-09T02:11:11.457
> 
> 标签：algorithm, cuda, genetic-programming

我想编写一个算法，可以获取图片的一部分并将它们与同一对象的另一张图片相匹配。

例如，如果我给计算机一张花瓶的图片和一张带有花瓶的场景图片，我希望它能够确定花瓶在图像中的位置。我将如何开始开发这样的算法？

该算法的最终用途将是一个应用程序，例如，使用某人的面部照片可以判断他们是否在人群中。该算法最终将应用于视频流。

**编辑：**我不期待这个问题的实际解决方案，因为我不希望很快解决它。真正的问题是你如何为计算机定义这样的东西，以便你可以制定一个算法来做到这一点。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T02:18:18.537

我以前的一位老师就类似的问题写过他的博士论文，除了他的输入是某物的详细 3D 模型，他将使用该模型在 2D 图像中找到该对象。这是一个非常重要的问题，没有单一的“答案”，当然也没有任何符合 Stack Overflow 格式的问题。

我的最佳答案是：筹集大量资金并聘请一位经验丰富的程序员。

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T02:31:30.660

简单的答案是，找到一种描述人脸的数学方法，可以解释角度和部分缺失数据，然后对其进行改进和教学。

显然苹果已经做了这样的事情，但是，它仍然会犯错误，并且必须在前进的过程中被教导。

我希望它更多地是关于数学，而不是关于编程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T03:34:18.217

您描述的第一个问题和第二个问题都完全不同。

每个问题的主要部分都由[众多](http://www.cs.cmu.edu/~cil/v-source.html)可用的机器视觉库解决。您可能需要多种技术组合才能在任一项任务中取得任何成功。

在第一个中，您需要一般识别对象的东西。可能我会协同使用多种算法来识别模型图像中的前景对象，然后对分区目标图像进行某种加权比较。

在第二种情况下，相对于上面的一般识别器，检查人脸是一个困难得多的问题。面孔看起来都一样，或者几乎一样。一般识别器会注意到的东西不太可能有利于区分人脸。您需要一种已经针对面部识别进行了调整的算法。幸运的是，这是一个快速成熟的领域，您可能可以像第一种情况一样做到这一点，但使用一组不同的功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T02:19:21.843

我想你会发现这是一个相当大的挑战。这是一个极其困难的问题，是属于人工智能 (AI) 领域的众多计算领域之一。面部识别肯定是这个问题最流行的变体，不管你在媒体上读到什么，任何声称的成功都不是他们想象的那样。我认为最接近的解决方案涉及神经网络，它们通常需要非常清晰和精心挑选的图像。

不过，您可以尝试[在这里](http://www.face-rec.org/)阅读。祝你好运！

# scheme - 如何在 DrScheme 中重新定义常量标识符？

> ID：624794
> 
> 赞同：5
> 
> 时间：2009-03-09T02:15:34.130
> 
> 标签：scheme, racket

我正在使用 DrScheme 编写一个 Scheme 解释器。我定义了一个读取评估打印循环，并且我正在重新定义评估过程。这在 Chez Scheme 等其他方案实现中效果很好，但我不喜欢 Chez Scheme 中的代码编辑，所以我想为此使用 DrScheme。

当我进行如下定义时： (define (eval exp env) (cond ...)) 它说：define-values: cannot change constant identifier: eval

有没有办法覆盖它并让我更改常量标识符？我宁愿不必重命名所有变量来解决这个问题。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-09T03:00:44.223

事实证明，每种语言都有选项，其中之一是“不允许重新定义初始绑定”，可以取消选中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T02:44:54.450

您可能正在使用“相当大”的语言。切换到“模块”，就可以了。

# sql-server - 是否可以将数据库名称作为参数传递

> ID：624797
> 
> 赞同：2
> 
> 时间：2009-03-09T02:17:37.463
> 
> 标签：sql-server, stored-procedures

我在 cms 中构建了大约 100 个站点，每个站点都有自己的数据库。每个数据库都有相同的表。

我的存储过程需要选择给定站点名称的数据库中的所有页面。

下面我试图将数据库名称作为参数传递，但它似乎不起作用。

```
...
@site nvarchar(250)

AS

SELECT *
FROM @site..cmsDocument
WHERE published = 1 
```

还有其他方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T02:24:18.727

```
SELECT @dbname = quotename(dbname)
SELECT @sql = ' SELECT ... FROM ' + @dbname + '.dbo.tablename WHERE ...'
EXEC sp_executesql @sql, @params, ... 
```

参考：

[sp_executesql (Transact-SQL)](http://msdn.microsoft.com/en-us/library/ms188001.aspx)

[动态 SQL 的祸与福](http://www.sommarskog.se/dynamic_sql.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T02:34:49.527

您可以在连接字符串中指定数据库：

数据源=我的服务器地址；**初始目录=myDataBase** ;用户 ID=myUsername;Password=myPassword;

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T02:18:42.670

几乎没有 DBMS 允许您以这种方式使用参数。通过连接构建动态查询并执行它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T15:36:07.637

您可以使用未记录的存储过程 sp_MSforeachdb： sp_MSforeachdb 'SELECT * FROM ?..table_name_here'

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-09-03T18:18:10.967

如果查询/过程是从 .NET 应用程序执行的，您还可以通过编程方式更改连接对象 (VB.NET) 的数据库：

```
Using da As New SqlDataAdapter("SELECT * FROM cmsDocument WHERE published = 1", GetDatabaseConnection(ServerName))
     da.SelectCommand.Connection.ChangeDatabase("Foobar")
End Using 
```

# java - 如何将外部页面添加到 Java 代码文档？

> ID：624808
> 
> 赞同：5
> 
> 时间：2009-03-09T02:23:56.653
> 
> 标签：java, javadoc

在使用 C++ 编程时，我使用 Doxygen 并经常为不适合特定类或方法的其他文档创建外部 .dox 文件 - 例如，文件格式文档（用于由多个类访问的文件）。我试图找到一种在 Java 中做同样事情的方法，但似乎 javadoc 没有等效的功能，所有文档都必须写在 .java 文件的注释中并与之相关联（或至少与其相关联）包裹）。我对吗？有没有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T08:57:24.180

[javadoc](http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/javadoc.html)中的“<a href="http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/javadoc.html#unprocessed" rel="nofollow noreferrer">杂项未处理文件”部分[文档](http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/javadoc.html) 是您正在寻找的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-09T02:33:34.553

如果您问 Javadoc 是否可以创建外部文档，那么答案是否定的。但是您可以链接到您已经制作的外部文档。此外，如果某些内容适用于包级别，您可以将文档放在包文件中，而不是将其附加到特定的类或方法中。

# iis - 在我的网络上托管公共网站的风险？

> ID：624815
> 
> 赞同：3
> 
> 时间：2009-03-09T02:29:08.607
> 
> 标签：iis, windows-xp, hosting

我想在我们的 LAN 上工作的旧 XP 机器上设置 IIS，这样我就可以在上面托管一些我正在使用的 Silverlight 东西，以便我在互联网上向其他人展示它。我已经设置了一个公共 IP，它直接穿过我的防火墙并直接到达那台机器，我有时在家时使用远程桌面登录那台机器并做一些杂项工作。它的驱动器号映射到服务器上的数据文件夹，但没有数据直接在该机器上。我不想让我的整个网络面临我不了解的风险。那么，如果我让人们上网到公共 IP 地址并使用他们的网络浏览器访问那台机器会安全吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T02:38:58.083

> 那么，如果我让人们上网到公共 IP 地址并使用他们的网络浏览器访问那台机器会安全吗？

您总是通过允许访问受信任的资源来提高风险级别，因此“安全”是一个相对术语。在这种情况下，通过将其托管在您希望进行安全交易的同一位置（例如登录您的银行帐户） ，您*可能会承担危险的风险。*

也就是说，您可以采取一些高价值、低成本的保护措施：

1.  由于您位于路由器后面，因此您的路由器可以执行双重任务并充当防火墙。确保仅打开相应的端口。
2.  确保您运行的应用程序以最低权限执行此操作。如果可能，请在虚拟机内运行这些应用程序，并将*其*用作 Web 服务器。
3.  安全访问您服务的应用程序；只允许受信任的用户。
4.  使站点的面向公众的区域最小化。
5.  将应用程序保存在与其他所有文件完全不同的文件根目录中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T02:36:28.870

不，如果那台机器被入侵，他们就拥有了王国的钥匙，可以这么说。您应该在它与网络的其余部分之间设置一个 DMZ。您应该有一台可通过 VPN 用于 RDC 的单独机器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T02:40:02.433

我不会这样做有三个原因：

1.  正如杰夫所说，你可能会分发王国的钥匙
2.  除非您有能力减轻相当规模的 DoS 攻击，否则您不希望将注意力吸引到您的网络上。您永远不知道您托管的内容何时会引起其他人的注意，从而导致这种情况。这意味着，您的整个网络（理论上）可能与外界隔绝。
3.  即使 DMZ 包含妥协，您也冒着让该服务器向世界各地发送垃圾邮件的风险。您不希望在传出的公司邮件进入黑洞时从 DNSBL 中获取该 IP 的痛苦。

支付在其他地方托管或托管小型服务器的费用太便宜了。

**编辑**：

添加原因#3

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T06:56:48.337

IIS 5.1 限制为同时连接 10 个，并且大多数浏览器打开 2 个或更多连接以下载图像和其他页面元素。

IIS 5.1 和 XP 默认打开了很多东西。检查并关闭 IIS 中所有不必要的功能以及 XP 中所有不必要的面向网络的服务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T03:20:35.627

只要您牢记您正在让外部人员访问连接到您的内部网络的机器，并让机器保持最新状态，您将是“安全的”。

就我个人而言，我建议进行外部托管，从而使您自己的网络更安全，并让托管服务提供商担心更新软件、阻止攻击者和维护网络。它不会花费太多，并且可以减轻您不得不处理的大部分头痛。

# testing - 如何测试 web 应用程序的 vista 兼容性？

> ID：624816
> 
> 赞同：1
> 
> 时间：2009-03-09T02:30:37.400
> 
> 标签：testing

我没有安装微软vista。在 vmware 中是否安装了某种试用版 windows vista 可以让我们测试 Web 应用程序的兼容性？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T02:33:21.187

使用虚拟 PC： [http ://www.microsoft.com/downloadS/details.aspx?FamilyID=04d26402-3199-48a3-afa2-2dc0b40a73b6&displaylang=en](http://www.microsoft.com/downloadS/details.aspx?FamilyID=04d26402-3199-48a3-afa2-2dc0b40a73b6&displaylang=en)

并下载 MSFT 提供的应用程序兼容性测试图像：http: [//www.microsoft.com/downloads/details.aspx? FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T03:28:38.383

+1 VirtualPC，虽然整个到期的事情令人难以置信的烦人！

但是，FWIW IE7-on-Vista 和 IE7-on-XP 之间的差异几乎为零，webapp-compatibility-wise。差异是平台级别的安全性，通常不会影响您。

# asp.net - ASP.NET：使用预编译的 Web 编辑 App_GlobalResources

> ID：624819
> 
> 赞同：1
> 
> 时间：2009-03-09T02:31:34.730
> 
> 标签：asp.net, localization

是否有任何选项可以编辑 App_GlobalResources 文件夹中的资源？编译后，该目录不包含在预编译文件夹中。

我在网上看到 App_GlobalResources 资源被编译成一个 DLL 以便于访问。但是，我希望管理员能够更新这些文件的内容。将这些 GlobalResources .RESX 转换为 LocalResources 的唯一方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T06:35:26.813

我不知道有什么方法可以在编译文件后“就地”编辑文件 - 但为什么不直接进行更改，再次预编译 Web，然后将 App_GlobalResources.compiled 和 App_GlobalResources.dll 分别部署到您的网站？我认为这应该更新全局资源 DLL 并且应该实现您正在寻找的内容。

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-09T10:02:35.063

您可以创建一个自定义的小型资源编辑器应用程序，这将与您的主应用程序分开。

GlobalResource Editor 应用程序将打开一个表单，该表单在第一列中显示键，在另一列中显示值。

您可以编译此应用程序并将`app_globalresource`文件复制并粘贴到您的主应用程序中。

这样你也可以让你的客户使用这个应用程序，并教他在编译后复制和粘贴资源文件。

# vim - Vim 分行命令

> ID：624821
> 
> 赞同：92
> 
> 时间：2009-03-09T02:32:55.010
> 
> 标签：vim

> **可能重复：**
> [如何在不进入 Vim 插入模式的情况下在光标所在的位置插入换行符？](https://stackoverflow.com/questions/237383/how-do-i-insert-a-linebreak-where-the-cursor-is-without-entering-into-insert-mod)

在 vim 中，`J`将下一行连接到当前行。是否有类似的一键（或相对较短的）命令可以在给定的光标位置分割一行？我知道它可以用一个简单的宏来完成，但似乎如果`J`-command 存在应该有一个类似的功能。我试过搜索它，但似乎找不到答案。

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2009-03-09T02:38:43.823

`r``Enter`而在空白处会这样做。那是两次击键。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-03-09T02:37:59.287

我不认为有一个单一的关键命令。您可以使用股票 vim 做的最好的事情可能是`i` `Enter` `Esc`.

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2012-01-27T15:55:54.980

我的解决方案是重新映射 K 键，因为我从不使用默认操作（使用“man”查找光标下的单词），而我之前的编辑器分别使用 Alt+j 和 Alt+k 来连接和拆分行。

```
:nnoremap K i<CR><Esc> 
```

这将这三个烦人的击键合二为一。

可能还有一种更复杂的方法来消除任何尾随空格，但我更喜欢在写入时去除所有尾随空格。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-03-09T02:37:17.243

不，我现在已经阅读了足够多的答案，可以得出没有这样的命令的结论。

简单的回答：在插入时按“Enter”即可；但你是对的，在命令模式下应该有一个键。我也想知道。

由于每个人都有一个最喜欢的解决方法，我将分享我的。假设我会做*任何事情*来避免不得不使用 Esc 键。

**ylprX** ... 其中 'X' 是插入的字符，甚至可以是*换行符*。

所以，'yl' 是 char 向右拉，'p' = 粘贴 char，'r' 是替换那个 char；然后你只需输入新的字符。 *这就是*我讨厌使用 Escape 的原因。

（那是'l'，就像“向右移动”一样，顺便说一句）

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2012-06-08T15:40:35.843

旧线程，但我不使用“K”进行手册页查找或它所做的任何魔术。所以我的 .vimrc 中有这个映射：

```
map K i<Enter><Esc> 
```

我想既然“J”是加入，“K”可以是krack或其他东西。:)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-08-24T20:05:58.817

如果您可以为添加拆分的位置创建正则表达式，则可以拆分行。例如，如果要在每个分号处拆分行，可以使用以下替换：

%s/;/^v^m/g

效果很好

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-09T11:23:49.850

杰德的回答是最有用的。我想补充一点，我需要“control-V-alternative”，即 control-Q: %s/;/^q^m/g

# windows - 重新启动 Windows 服务

> ID：624822
> 
> 赞同：1
> 
> 时间：2009-03-09T02:33:14.993
> 
> 标签：windows, service

我想使用带有 net stop、net start 的批处理文件来安排我的自定义服务的自动重启。

当 net stop 运行时，它是否会立即中止正在执行的任何操作？

只是想知道如果在处理过程中会发生什么？

马尔科姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T02:36:44.593

它会异步调用你的代码，由你来处理它。您可以按照您认为合适的方式制定干净或中止。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T02:41:56.110

这实际上取决于服务的实现方式。“net stop”本质上是调用服务并说“你能停下来吗”。大多数服务将遵守此命令并及时停止。但是，有些不良服务不遵守并拒绝停止。在这种情况下，净止损不会采取进一步行动。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T02:35:03.973

这真的取决于服务。我怀疑大多数人会在停下来之前尝试进入一个好的状态。这不是杀戮。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T02:42:38.917

服务注册以接收事件（通过 RegisterServiceCtrlHandler）。当您执行网络停止时，注册的回调将收到带有 SERVICE_CONTROL_STOP 操作的回调。服务如何响应该回调取决于服务实现。服务定期执行应用程序关闭处理是有意义的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T02:43:18.197

就像其他人说的，当你调用 net stop 时，它会调用 Windows 服务中的 OnStop。如果 OnStop 没有杀死应用程序中的所有线程，或者没有正确关闭所有内容，您的服务可能不会停止。（我在我们的一项 WCF 服务中看到了这种情况：我们没有在 OnStop 中关闭 ServiceHost，因此，应用程序不会在我们的命令下停止 - 我们必须手动终止该进程。）

我见过的一种常见模式是尝试在服务上调用 stop，如果它没有在超时（10 秒）内终止，则强制终止该进程。作为批处理文件的替代方案，PowerShell 对处理服务有一些很好的支持。

# django - 在 django web 应用程序中，如何给用户自己的子域？

> ID：624827
> 
> 赞同：35
> 
> 时间：2009-03-09T02:36:05.423
> 
> 标签：django, subdomain, pinax

我正在使用 Django 和 Pinax 开始一个新的 Web 应用程序项目。我希望能够像 Wordpress 和其他网站一样为我的用户提供唯一的域名：`username.wordpress.com`。我不确定如何使用 Django 来解决这个问题，因为 url 解析逻辑（在 urls.py 中）以域名之后的 url 开头。

更具体地说，将有多个用户组，每个组都有一个唯一的名称。不确定这会有所不同，但我想我应该提到这一点。

有什么方法可以操纵 http 请求，使 URL 在 Django 中看起来就像 url 一样`www.domain.com/groupname`，但仍显示在浏览器地址栏中`groupname.domain.com`？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-09T03:09:04.703

您可以使用一些自定义中间件来拦截请求并从中获取子域。以下代码将检索子域并通过[反转命名的 url](http://docs.djangoproject.com/en/dev/topics/http/urls/#reverse)重定向到视图。

将它放在应用程序的 middleware.py 文件中。

确保在 settings.py 文件中设置了中间件。

确保您已在 urls.py 中命名您的视图

**中间件.py**

```
from django.http import HttpResponseRedirect
from django.core.urlresolvers import reverse
import re

subdomain_pattern = re.compile('(?P<subdomain>.*?)\..*?')

class SubdomainMiddleware(object):
    def process_request(self, request):
        match = subdomain_pattern.match(request.get_host())
        subdomain = match.group('subdomain')
        redirect_url = reverse('groups_detail', args=[subdomain])
        return HttpResponseRedirect(redirect_url) 
```

**网址.py**

```
from django.conf.urls.defaults import *

urlpatterns = patterns('',
    url(r'^groups/(?P<name>.+)/$', 'groups.views.detail', {}, name='group_detail'),
) 
```

*注意：此代码未经测试。*

重定向可以改变 URL 的外观。如果您想避免这种情况，只需调用关联的视图，捕获其结果，然后以`HttpResponse()`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T02:56:28.447

您需要通过您的网络服务器处理此问题。如果您有 Django 网址，例如...

```
/users/<username>/ 
```

...然后使用网络服务器中的重写规则映射`<username>.domain.com`到`domain.com/users/<username>/`.

如果您使用的是 Apache，您可以在[此处](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)阅读。否则，每个网络服务器都有自己的约定，但都支持 url 重写的概念。

# asp.net-mvc - ASP.NET MVC Html.DropDownList SelectedValue

> ID：624828
> 
> 赞同：104
> 
> 时间：2009-03-09T02:36:09.073
> 
> 标签：asp.net-mvc

我试过这是 RC1，然后升级到 RC2 没有解决问题。

```
// in my controller
ViewData["UserId"] = new SelectList(
    users, 
    "UserId", 
    "DisplayName", 
    selectedUserId.Value); // this has a value 
```

结果：在对象上设置了 SelectedValue 属性

```
// in my view
<%=Html.DropDownList("UserId", (SelectList)ViewData["UserId"])%> 
```

结果：所有预期的选项都呈现给客户端，但未设置 selected 属性。SelectedValue 中的项目存在于列表中，但列表中的第一项始终默认为选中。

我应该怎么做？

**更新** 感谢 John Feminella 的回复，我发现了问题所在。“UserId”是我的视图强类型化到的模型中的一个属性。当 Html.DropDownList("UserId" 更改为除 "UserId" 之外的任何其他名称时，所选值将正确呈现。

这导致该值未绑定到模型。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2010-07-29T17:29:36.803

这就是我解决此问题的方法：

我有以下内容：

控制器：

```
ViewData["DealerTypes"] = Helper.SetSelectedValue(listOfValues, selectedValue) ; 
```

看法

```
<%=Html.DropDownList("DealerTypes", ViewData["DealerTypes"] as SelectList)%> 
```

由以下内容更改：

看法

```
<%=Html.DropDownList("DealerTypesDD", ViewData["DealerTypes"] as SelectList)%> 
```

看来 DropDown 不能具有相同的名称具有 ViewData 名称：S 很奇怪，但它工作。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-03-09T02:44:01.860

尝试这个：

```
public class Person {
    public int Id { get; set; }
    public string Name { get; set; }
} 
```

接着：

```
var list = new[] {   
    new Person { Id = 1, Name = "Name1" }, 
    new Person { Id = 2, Name = "Name2" }, 
    new Person { Id = 3, Name = "Name3" } 
};

var selectList = new SelectList(list, "Id", "Name", 2);
ViewData["People"] = selectList;

Html.DropDownList("PeopleClass", (SelectList)ViewData["People"]) 
```

使用 MVC RC2，我得到：

```
<select id="PeopleClass" name="PeopleClass">
    <option value="1">Name1</option>
    <option selected="selected" value="2">Name2</option>
    <option value="3">Name3</option>
</select> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-08-11T16:08:15.640

您仍然可以将 DropDown 命名为“UserId”，并且模型绑定仍然为您正常工作。

这样做的唯一要求是包含 SelectList 的 ViewData 键与您要绑定的 Model 属性的名称不同。在您的具体情况下，这将是：

```
// in my controller
ViewData["Users"] = new SelectList(
    users, 
    "UserId", 
    "DisplayName", 
    selectedUserId.Value); // this has a value

// in my view
<%=Html.DropDownList("UserId", (SelectList)ViewData["Users"])%> 
```

这将生成一个名为 UserId 的选择元素，它与模型中的 UserId 属性具有相同的名称，因此模型绑定器将使用 Html.DropDownList 帮助器生成的 html 的选择元素中选择的值设置它。

我不确定为什么当您将选择列表放入 ViewData 中且键等于属性名称时，特定的 Html.DropDownList 构造函数不会选择 SelectList 中指定的值。我怀疑这与 DropDownList 帮助器在其他场景中的使用方式有关，其中约定是您在 ViewData 中确实有一个 SelectList ，其名称与模型中的属性相同。这将正常工作：

```
// in my controller
ViewData["UserId"] = new SelectList(
    users, 
    "UserId", 
    "DisplayName", 
    selectedUserId.Value); // this has a value

// in my view
<%=Html.DropDownList("UserId")%> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-29T20:08:03.163

之前的 MVC 3 帖子中的代码不起作用，但这是一个好的开始。我会修好它。我已经测试了这段代码，它在 MVC 3 Razor C# 中工作。这段代码使用 ViewModel 模式来填充一个返回`List<SelectListItem>`.

模型类

```
public class Product
{
    public string Name { get; set; }
    public decimal Price { get; set; }
} 
```

视图模型类

```
using System.Web.Mvc;

public class ProductListviewModel
{
    public List<SelectListItem> Products { get; set; }
} 
```

控制器方法

```
public ViewResult List()
{
    var productList = new List<SelectListItem>();

    foreach (Product p in Products)
    {
        productList.Add(new SelectListItem
        {
            Value = p.ProductId.ToString(),
            Text = "Product: " + p.Name + " " + p.Price.ToString(),
            // To set the selected item use the following code 
            // Note: you should not set every item to selected
            Selected = true
        });
    }

    ProductListViewModel productListVM = new ProductListViewModeld();

    productListVM.Products = productList;

    return View(productListVM);
} 
```

风景

```
@model MvcApp.ViewModels.ProductListViewModel

@using (Html.BeginForm())
{
    @Html.DropDownList("Products", Model.Products)
} 
```

HTML 输出将类似于

```
<select id="Products" name="Products">
    <option value="3">Product: Widget 10.00</option>
    <option value="4">Product: Gadget 5.95</option>
</select> 
```

取决于你如何格式化输出。我希望这有帮助。该代码确实有效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-12-12T23:03:15.800

如果我们不认为这是团队应该修复的错误，那么至少 MSDN 应该改进文档。令人困惑的真正来自这个糟糕的文件。在[MSDN](http://msdn.microsoft.com/en-us/library/dd492738%28v=vs.118%29.aspx)中，它将参数 ***名称***解​​释为，

```
Type: System.String
The name of the form field to return. 
```

这只是意味着它生成的最终 html 将使用该参数作为选择输入的名称。但是，它实际上意味着更多。

我猜设计师假设用户将使用视图模型来显示下拉列表，也将使用回发到**相同**的视图模型。但在很多情况下，我们并没有真正遵循这个假设。

使用上面的例子，

```
public class Person {
    public int Id { get; set; }
    public string Name { get; set; }
} 
```

如果我们遵循假设，我们应该为这个下拉列表相关视图定义一个视图模型

```
public class PersonsSelectViewModel{
    public string SelectedPersonId,
    public List<SelectListItem> Persons;
} 
```

因为回传时，只有选中的值才会回传，所以假设它应该回传到模型的属性SelectedPersonId，这意味着Html.DropDownList的第一个参数*名称*应该是'SelectedPersonId'。因此，设计者认为在视图中显示模型视图时，模型的属性 SelectedPersonId 应该保持该下拉列表的默认值。即使您的 List<SelectListItem> Persons 已经设置了 Selected 标志来指示哪个被选中/默认，tml.DropDownList 实际上会忽略它并重建它自己的 IEnumerable<SelectListItem> 并根据名称设置默认/选中的项目。

这是来自 asp.net mvc 的代码

```
private static MvcHtmlString SelectInternal(this HtmlHelper htmlHelper, ModelMetadata metadata,
            string optionLabel, string name, IEnumerable<SelectListItem> selectList, bool allowMultiple,
            IDictionary<string, object> htmlAttributes)
{
    ...

    bool usedViewData = false;

    // If we got a null selectList, try to use ViewData to get the list of items.
    if (selectList == null)
    {
        selectList = htmlHelper.GetSelectData(name);
        usedViewData = true;
    }

    object defaultValue = (allowMultiple) ? htmlHelper.GetModelStateValue(fullName, typeof(string[])) : htmlHelper.GetModelStateValue(fullName, typeof(string));

    // If we haven't already used ViewData to get the entire list of items then we need to
    // use the ViewData-supplied value before using the parameter-supplied value.
    if (defaultValue == null && !String.IsNullOrEmpty(name))
    {
        if (!usedViewData)
        {
            defaultValue = htmlHelper.ViewData.Eval(name);
        }
        else if (metadata != null)
        {
            defaultValue = metadata.Model;
        }
    }

    if (defaultValue != null)
    {
        selectList = GetSelectListWithDefaultValue(selectList, defaultValue, allowMultiple);
    }

    ...

    return tagBuilder.ToMvcHtmlString(TagRenderMode.Normal);
} 
```

所以，代码实际上走得更远，它不仅尝试在模型中查找名称，还尝试在视图数据中查找名称，一旦找到，它就会重建 selectList 并忽略您原来的 Selected。

问题是，在很多情况下，我们并没有真正那样使用它。我们只想抛出一个带有一个/多个项目的selectList Selected 设置为true。

当然解决方案很简单，使用一个不在模型或视图数据中的名称。找不到匹配的时候，会使用原来的selectList，原来的Selected会生效。

但我仍然认为 mvc 应该通过添加一个条件来改进它

```
if ((defaultValue != null) && (!selectList.Any(i=>i.Selected)))
{
    selectList = GetSelectListWithDefaultValue(selectList, defaultValue, allowMultiple);
} 
```

因为，如果原来的 selectList 已经有一个 Selected，你为什么要忽略它呢？

只是我的想法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-30T13:28:47.930

这似乎是 SelectExtensions 类中的一个错误，因为它只会检查 ViewData 而不是所选项目的模型。所以诀窍是将模型中的选定项复制到属性名称下的 ViewData 集合中。

这取自我在 MVC 论坛上给出的答案，我在使用[Kazi 的 DropDownList 属性的](http://weblogs.asp.net/rashid/archive/2010/02/09/asp-net-mvc-complex-object-modelmetadata-issue.aspx "Kazi's attribute")[博客文章](http://blog.paulhatcher.com/archive/2010/06/28/mvc-2-editorformodel-and-dropdownlist.aspx)中也有更完整的答案......

给定一个模型

```
public class ArticleType
{
   public Guid Id { get; set; }
   public string Description { get; set; }
}

public class Article
{
    public Guid Id { get; set; }
    public string Name { get; set; }
    public ArticleType { get; set; }
} 
```

和一个基本的视图模型

```
public class ArticleModel
{
     public Guid Id { get; set; }
     public string Name { get; set; }

     [UIHint("DropDownList")]
     public Guid ArticleType { get; set; }
} 
```

然后我们编写一个 DropDownList 编辑器模板如下..

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl" %>
<script runat="server">  
    IEnumerable<SelectListItem> GetSelectList()
    {
        var metaData = ViewData.ModelMetadata;
        if (metaData == null)
        {
            return null;
        }

        var selected = Model is SelectListItem ? ((SelectListItem) Model).Value : Model.ToString();
        ViewData[metaData.PropertyName] = selected;

        var key = metaData.PropertyName + "List";
        return (IEnumerable<SelectListItem>)ViewData[key];
    }
</script>
<%= Html.DropDownList(null, GetSelectList()) %> 
```

如果您将视图模型中的 ArticleType 更改为 SelectListItem，这也将起作用，尽管您必须按照 Kazi 的博客实现类型转换器并注册它以强制活页夹将其视为简单类型。

然后在您的控制器中，我们有...

```
public ArticleController 
{
     ...
     public ActionResult Edit(int id)
     {
          var entity = repository.FindOne<Article>(id);
          var model = builder.Convert<ArticleModel>(entity);

          var types = repository.FindAll<ArticleTypes>();
          ViewData["ArticleTypeList"] = builder.Convert<SelectListItem>(types);

          return VIew(model);
     }
     ...
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-11-29T14:42:39.190

在 ASP.NET MVC 3 中，您可以简单地将列表添加到 ViewData...

```
var options = new List<SelectListItem>();

options.Add(new SelectListItem { Value = "1", Text = "1" });
options.Add(new SelectListItem { Value = "2", Text = "2" });
options.Add(new SelectListItem { Value = "3", Text = "3", Selected = true });

ViewData["options"] = options; 
```

...然后在您的剃刀视图中按名称引用它...

```
@Html.DropDownList("options") 
```

您不必在 DropDownList 调用中手动“使用”列表。这样做也正确地为我设置了选定的值。

免责声明：

1.  还没有用 web 表单视图引擎尝试过这个，但它也应该可以工作。
2.  我没有在 v1 和 v2 中测试过这个，但它可能会起作用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-10-10T13:59:25.357

问题在于保管箱与列表框的工作方式不同，至少与 ASP.NET MVC2 设计所期望的方式不同：保管箱只允许零个或一个值，因为列表框可以有多个值选择。因此，严格遵守 HTML，该值不应作为“选定”标志出现在选项列表中，而应出现在输入本身中。

请参见以下示例：

```
<select id="combo" name="combo" value="id2">
  <option value="id1">This is option 1</option>
  <option value="id2" selected="selected">This is option 2</option>
  <option value="id3">This is option 3</option>
</select>

<select id="listbox" name="listbox" multiple>
  <option value="id1">This is option 1</option>
  <option value="id2" selected="selected">This is option 2</option>
  <option value="id3">This is option 3</option>
</select> 
```

该组合选择了选项，但**也设置了其 value 属性**。因此，如果您希望 ASP.NET MVC2 呈现一个保管箱并选择一个特定的值（即默认值等），您应该在呈现时给它一个值，如下所示：

```
// in my view             
<%=Html.DropDownList("UserId", selectListItems /* (SelectList)ViewData["UserId"]*/, new { @Value = selectedUser.Id } /* Your selected value as an additional HTML attribute */)%> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-05-17T07:19:54.500

我设法得到了想要的结果，但方法略有不同。在下拉列表中，我使用了模型，然后引用了它。不确定这是否是您要找的。

```
@Html.DropDownList("Example", new SelectList(Model.FeeStructures, "Id", "NameOfFeeStructure", Model.Matters.FeeStructures)) 
```

上面的 Model.Matters.FeeStructures 是我的 id，它可能是你应该选择的项目的值。

# python - 为什么信号不简单地称为事件？

> ID：624844
> 
> 赞同：4
> 
> 时间：2009-03-09T02:42:37.107
> 
> 标签：python, signals, django-signals

据我所知，在 Python 和 Django 中，信号只是委托事件。有什么可以在功能上将它们与 C#、Java、ActionScript 等中的典型事件概念区分开来吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-09T02:52:18.457

实际上，“信号”的存在时间比事件要长。在最早的用法中，信号是进程获取事件发生通知的一种异步方式。由于 Unix 比 Django 早得多（而且由于 Django 的许多工作都来自 pydispatcher，原来的东西就是在那里完成的），所以这个名字一直存在。

事件真的是信号，你可能会说！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-09T02:47:44.410

信号通常与操作系统设施相关联，而事件通常是应用程序定义的。在某些技术堆栈中，操作系统级别的东西可能隐藏得足够好，以至于 API 没有区别，但在其他技术堆栈中可能没有。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T02:51:10.520

Afaik Qt 有第一个信号/槽实现。 [Qt 的文档](http://doc.trolltech.com/4.4/signalsandslots.html)解释了这个比喻：“当特定事件发生时发出信号”。区别是如此微妙，以至于命名法已经模糊。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T02:49:20.587

您不妨问“为什么事件不简单地称为信号？”。出现术语差异。

# mp3 - 如何使用 rtsp 播放音乐文件

> ID：624851
> 
> 赞同：0
> 
> 时间：2009-03-09T02:46:45.537
> 
> 标签：mp3, broadcast, rtsp

如何使用 rtsp 广播 mp3 文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T03:05:46.427

开源 VideoLAN 项目[将做 RTSP](http://wiki.videolan.org/RTSP)。

# c++ - 带有 boost::shared_ptr 的 static_cast？

> ID：624854
> 
> 赞同：73
> 
> 时间：2009-03-09T02:47:21.667
> 
> 标签：c++, boost, shared-ptr, static-cast

`static_cast`a with的等价物是`boost::shared_ptr`什么？

换句话说，我该如何重写以下内容

```
Base* b = new Derived();
Derived* d = static_cast<Derived*>(b); 
```

什么时候用`shared_ptr`？

```
boost::shared_ptr<Base> b(new Derived());
boost::shared_ptr<Derived> d = ??? 
```

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2009-03-09T02:48:16.063

使用`boost::static_pointer_cast`：

```
boost::shared_ptr<Base> b(new Derived());
boost::shared_ptr<Derived> d = boost::static_pointer_cast<Derived>(b); 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-09T03:15:40.240

智能指针有三个强制转换运算符：`static_pointer_cast`、`dynamic_pointer_cast`和`const_pointer_cast`。它们位于命名空间`boost`（由 提供`<boost/shared_ptr.hpp>`）或命名空间`std::tr1`（由 Boost 或编译器的 TR1 实现提供）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-09T06:39:58.567

作为评论：如果 Derived 实际上是从 Base 派生的，那么您应该使用 dynamic_pointer_cast 而不是静态转换。系统将有机会检测您的演员何时/是否不正确。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-16T12:23:17.050

值得一提的是，Boost 提供的强制转换运算符的数量与 TR1 的实现存在差异。

TR1 没有定义第三个操作符 const_pointer_cast()

# linux - 查找哪个进程被 Linux OOM 杀手杀死

> ID：624857
> 
> 赞同：211
> 
> 时间：2009-03-09T02:47:54.817
> 
> 标签：linux, linux-kernel

当 Linux 内存不足 (OOM) 时，OOM 杀手会根据一些启发式方法选择一个要杀死的进程（这是一个有趣的阅读： http: [//lwn.net/Articles/317814/](http://lwn.net/Articles/317814/)）。

如何以*编程*方式确定最近被 OOM 杀手杀死的进程？

* * *

## 回答 #1

> 赞同：201
> 
> 时间：2009-03-09T02:54:54.987

试试这个：

```
grep -i 'killed process' /var/log/messages 
```

* * *

## 回答 #2

> 赞同：196
> 
> 时间：2013-04-11T15:58:36.073

试试这个，这样你就不必担心你的日志在哪里：

```
dmesg -T | egrep -i 'killed process' 
```

`-T, --ctime`- 打印人类可读的时间戳。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2014-09-02T11:32:09.667

现在 dstat 提供了在你正在运行的系统中找出哪个进程可能被 oom 机制杀死的功能

```
dstat --top-oom
 --out-of-memory---
  kill score
 java           77
 java           77
 java           77 
```

并根据手册页

```
 --top-oom
          show process that will be killed by OOM the first 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2013-03-26T05:18:48.937

试试这个：

```
grep "Killed process" /var/log/syslog 
```

# php - DocBook 到 DokuWiki

> ID：624869
> 
> 赞同：1
> 
> 时间：2009-03-09T02:55:12.660
> 
> 标签：php, documentation, phpdoc, docbook, dokuwiki

有没有一种直接的方法来获取 docbook 内容并将其转换为 DokuWiki 内容？到目前为止，我只找到了[DokuWiki 插件](http://www.dokuwiki.org/plugin:docbook)，它可以解释文档内容并将其输出为 XHTML，但每次页面加载都会发生这种情况。

我想找到一种方法将 docbook 内容直接转换为 DokuWiki 的本机格式语法，因此我只需解释一次。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T13:46:48.543

我不熟悉您提到的工具，但我对您可能采用的一般策略有一些想法。

1.  如果您对 DocuWiki 插件的输出感到满意，您可以在 perl、sh、ruby 等中编写某种脚本来执行插件并存储将来静态提供的内容。

2.  DocuWiki 似乎只是调用 xsltproc 程序并提供输出。如果插件正常工作，那么您应该能够直接从命令行或您自己的脚本调用 xsltproc。看看 DocuWiki 中的这些行

    exec("$xsltproc -o $tmpXhtmlFile $docbookXsl $tmpDocbookFile 2>&1", $errors);

    $returnXhtml = shell_exec("$xsltproc " . DOKU_PLUGIN . "/docbook/xhtmlCleaner.xsl $tmpXhtmlFile");

3.  一旦你有选项 1 或 2 工作。在您的版本控制系统中设置一个 cron 作业或挂钩，以观察对原始 docbook 源的更改并调用脚本以重新生成静态版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:01:28.753

另一种选择是

1.  使用 'docbook2html' - [[DocBook tools]](http://sources.redhat.com/docbook-tools/)将 docbook 转换为 HTML，然后
2.  使用类似 Perl Module 的东西将 HTML 转换为 wiki 标记。 [http://metacpan.org/pod/HTML::WikiConverter](http://metacpan.org/pod/HTML::WikiConverter)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:47:45.713

一个小（但可能很重要）注意事项：DokuWiki 包含一个缓存机制，可以保存输出的 HTML 文件。这意味着通常插件将很少执行（即仅在第一次查看页面的特定版本时）。

# regex - 正则表达式：一次性获取没有扩展名的文件名？

> ID：624870
> 
> 赞同：19
> 
> 时间：2009-03-09T02:55:37.340
> 
> 标签：regex, syntax

我只想使用正则表达式获取文件名，所以我一直在尝试简单的事情，比如

```
([^\.]*) 
```

当然只有当文件名有一个扩展名时才有效。但如果是`adfadsfads.blah.txt`我只想`adfadsfads.blah`。我怎样才能用正则表达式做到这一点？

关于大卫的问题，“你为什么要使用正则表达式”，答案是“为了好玩”。其实我用的代码很简单

```
length_of_ext = File.extname(filename).length
filename = filename[0,(filename.length-length_of_ext)] 
```

但我喜欢尽可能地学习正则表达式，因为它总是出现在 Geek 鸡尾酒会上。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-03-09T03:00:14.803

试试这个：

```
(.+?)(\.[^.]*$|$) 
```

这会：

*   捕获以点开头的文件名（例如`.logs`，文件名为`.logs`，而不是文件扩展名），这在 Unix 中很常见。
*   获取除最后一个点之外的所有内容：`foo.bar.jpeg`gets you `foo.bar`。
*   处理不带点的文件：`secret-letter`获取`secret-letter`.

* * *

注意：正如评论者 j_random_hacker 所建议的那样，这与宣传的一样，但出于可读性目的，您可能希望在事物前面加上锚点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-09T02:57:57.240

所有内容后跟一个点，然后是一个或多个不是点的字符，然后是字符串结尾：

```
(.+?)\.[^\.]+$ 
```

将最后一个点之前的所有内容分组以便于检索。

如果您不能 100% 确定每个文件都有扩展名，请尝试：

```
(.+?)(\.[^\.]+$|$) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-09T02:59:10.890

2 如何捕获一个结尾和一个文件名。

例如。

```
(.+?)(?:\.[^\.]*$|$) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-02-28T14:38:17.090

```
^(.*)\\(.*)(\..*)$ 
```

1.  获取没有最后一个的路径`\`
2.  没有扩展名的文件
3.  带有一个的扩展名`.`

例子：

`c:\1\2\3\Books.accdb`
`(c:\1\2\3)(Books)(.accdb)`

不支持`.`文件名`.`中的多个 文件路径中支持

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-07-17T14:03:19.517

我意识到这个问题有点过时了，但是，我在找到一个好的来源时遇到了一些麻烦，最终自己制作了正则表达式。为了拯救任何可能找到这个时间的人，

如果您正在寻找 ~standalone~ 正则表达式

这将匹配没有点的扩展名

`\w+(?![\.\w])`

*如果*文件名有扩展名，这将始终匹配文件名

`[\w\. ]+(?=[\.])`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T03:52:54.363

好的，我不确定为什么要为此使用正则表达式。例如，如果我知道字符串是完整的文件路径，那么我将使用另一个 API 来获取文件名。正则表达式非常强大，但同时也非常复杂（您刚刚通过询问如何创建如此简单的正则表达式证明了这一点）。有人说：你有一个问题，你决定用正则表达式来解决。现在你有两个问题。

再想想。例如，如果您在 .NET 平台上，请查看[System.IO.Path](http://msdn.microsoft.com/en-us/library/system.io.path.aspx)类。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-14T14:23:58.997

我使用此模式进行简单搜索：

```
^\s*[^\.\W]+$ 
```

对于这个文本：

```
file.ext
   fileext

   file.ext.ext
 file.ext
fileext 
```

它`fileext`在第二行和最后一行中找到。
我将它应用在文件夹的文本树视图中（空格作为缩进）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-10-24T10:06:10.477

只是文件名，没有路径和后缀。

```
^.*[\\|\/](.+?)\.[^\.]+$ 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-03T23:41:09.003

尝试

```
(?<=[\\\w\d-:]*\\)([\w\d-:]*)(?=\.[\.\w\d-:]*) 
```

仅捕获整个文件路径中的任何类型的文件名。故意排除文件路径和文件扩展名

ETC：

```
C:\Log\test\bin\fee105d1-5008-410c-be39-883e5e40a33d.pdf 
```

*   不捕获*(C:\Log\test\bin)*
*   捕获（**fee105d1-5008-410c-be39-883e5e40a33d**）
*   不捕获*(.pdf)*

# c# - 在 Castle.Windsor 框架中连接事件订阅者的问题

> ID：624873
> 
> 赞同：0
> 
> 时间：2009-03-09T02:56:33.190
> 
> 标签：c#, inversion-of-control, castle-windsor

我无法为我的 Castle.Windsor IoV 组件连接事件。即使我已经确认了它们的方法和签名，它也会引发异常并显示消息“对象与目标类型不匹配”。

谁能解释一下它所期望的对象是什么？

我的接线看起来像：

```
 <component
    id="mailManager"
    service="Pop3Dispatcher.Mail.IMailManager, Pop3Dispatcher"
    type="Pop3Dispatcher.Mail.DefaultMailManagerImpl, Pop3Dispatcher"
    startable="true"
    loadCompletedMethod="Init">
    <subscribers>
      <subscriber id="emailFilterImpl" event="MessageRecieved" handler="OnReceivedMessage"/>
    </subscribers>
  </component>

  <component 
    id="emailFilterImpl" 
    service="Pop3Dispatcher.Filters.IFilter, Pop3Dispatcher"
    type="Pop3Dispatcher.Filters.EmailFilterImpl, Pop3Dispatcher" 
    startable="true">
  </component> 
```

在有人问之前，是的，我已经包括：

```
<facilities>

  <facility
      id="event.wiring"
      type="Castle.Facilities.EventWiring.EventWiringFacility, Castle.MicroKernel" />

</facilities> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T03:20:39.027

好的，问题解决了，显然在这种情况下，声明的顺序很重要。此外，它不支持“服务”，必须直接订阅该类型。

```
 <component 
    id="emailFilterImpl" 
    type="Pop3Dispatcher.Filters.EmailFilterImpl, Pop3Dispatcher" 
    startable="true">
  </component>

  <component
    id="mailManager"
    type="Pop3Dispatcher.Mail.DefaultMailManagerImpl, Pop3Dispatcher"
    startable="true"
    loadCompletedMethod="Init">
    <subscribers>
      <subscriber id="emailFilterImpl" event="MessageRecieved" handler="OnReceivedMessage"/>
    </subscribers>
  </component> 
```

# java - 如何在 JDesktopPane 中获取 JInternalFrames 的 z 顺序

> ID：624885
> 
> 赞同：4
> 
> 时间：2009-03-09T03:04:08.413
> 
> 标签：java, swing, jinternalframe

如何在 JDesktopPane 中获取所有 JInternalFrames 的 z 顺序（层深度）。似乎没有直接的方法。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T03:27:40.510

虽然我没有尝试过，但[`Container`](http://java.sun.com/javase/6/docs/api/java/awt/Container.html)该类（它是该类的祖先[`JDesktopPane`](http://java.sun.com/javase/6/docs/api/javax/swing/JDesktopPane.html)）包含一个[`getComponentZOrder`](http://java.sun.com/javase/6/docs/api/java/awt/Container.html#getComponentZOrder(java.awt.Component))方法。通过传递[`Component`](http://java.sun.com/javase/6/docs/api/java/awt/Component.html)中的 a `Container`，它将返回 z 顺序作为 a `int`。由该方法返回的`Component`具有最低 z 顺序值的最后绘制，换句话说，绘制在顶部。

再加[`JDesktopPane.getAllFrames`](http://java.sun.com/javase/6/docs/api/javax/swing/JDesktopPane.html#getAllFrames())上返回数组的方法[`JInternalFrames`](http://java.sun.com/javase/6/docs/api/javax/swing/JInternalFrame.html)，我认为可以获得内部框架的 z 顺序。

**编辑**

我实际上已经尝试过了，它似乎有效：

```
final JFrame f = new JFrame();
f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

final JDesktopPane desktopPane = new JDesktopPane();
desktopPane.add(new JInternalFrame("1") {
    {
        setVisible(true);
        setSize(100, 100);
    }
});
desktopPane.add(new JInternalFrame("2") {
    {
        setVisible(true);
        setSize(100, 100);
    }
});
desktopPane.add(new JInternalFrame("3") {
    JButton b = new JButton("Get z-order");
    {
        setVisible(true);
        setSize(100, 100);
        getContentPane().add(b);
        b.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e)
            {
                JInternalFrame[] iframes = desktopPane.getAllFrames();
                for (JInternalFrame iframe : iframes)
                {
                    System.out.println(iframe + "\t" +
                            desktopPane.getComponentZOrder(iframe));
                }
            }
        });
    }
});

f.setContentPane(desktopPane);
f.setLocation(100, 100);
f.setSize(400, 400);
f.validate();
f.setVisible(true); 
```

在上面的示例中，a`JDesktopPane`填充了三个`JInternalFrame`s，第三个具有一个按钮，该按钮将输出`JInternalFrame`s 列表及其 z 顺序到`System.out`。

示例输出如下：

```
JDesktopPaneTest$3[... tons of info on the frame ...]    0
JDesktopPaneTest$2[... tons of info on the frame ...]    1
JDesktopPaneTest$1[... tons of info on the frame ...]    2 
```

该示例使用大量匿名内部类只是为了保持代码简短，但实际程序可能不应该这样做。

# java - 使用 POI 创建 Excel 工作簿时有哪些（陷阱和）限制？

> ID：624888
> 
> 赞同：3
> 
> 时间：2009-03-09T03:06:14.507
> 
> 标签：java, excel, apache-poi

刚刚看到崩溃，因为我们超过了 255 列。也许这个问题应该直接问 POI，但可以说我不想打扰他们努力进一步开发已经非常有用的 API。;-)[限制页面](http://poi.apache.org/spreadsheet/limitations.html)不是非常详细。

那么：假设输出应在 Excel 中可读，您对*实际限制的体验是什么？*有没有人使用 POI 来测试和探索 POI 生成的 Excel 文件的软硬限制？

我可以在 POI 界面中快速找到的唯一限制如下。Microsoft 列出了 POI 中似乎未涵盖的 Excel 的[进一步限制。](http://office.microsoft.com/en-gb/excel/HP051992911033.aspx)

*编辑：哎呀。刚刚意识到我们在过去 5 年没有刷新 POI，所以从那时起下面的代码可能已经被替换了 100 次。*

*编辑：自那时起和 2008 年 10 月 19 日的 3.2 版，下面的代码没有改变。*

```
/**
 * @throws RuntimeException if the bounds are exceeded.
 */
private void checkBounds(int cellNum) {
  if (cellNum > 255) {
      throw new RuntimeException("You cannot have more than 255 columns "+
                "in a given row (IV).  Because Excel can't handle it");
  }
  else if (cellNum < 0) {
      throw new RuntimeException("You cannot reference columns with an index of less then 0.");
  }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-25T21:10:22.037

Marliese，我对 poi 框架中的这个错误感到恼火，并明白我需要一个 styleManager。这些帖子，让我觉得所有的工作都完成了，直到我得出和你一样的结论。我不想重新发明轮子，所以我下载了他的框架的源码并搜索了CellStyleManager.setCellStyle()的用途。事实上，在代码中，创建了两个初始 HSSFCellStyle 对象，defaultCellStyle 和 cellStyle。任何时候您自定义样式使用 cellStyle，然后使用 CellStyleManager 设置它。如果样式存在，则重用它，如果不存在，则创建它。任何其他自定义另一种样式的尝试都是从使用 CellStyleHelper 的函数和 defaultCellStyle 重置 cellStyle 开始的，所有程序都保持不变。所以最后你会得到比真正需要的两种风格，

正如 paulgreg 所说，代码遍布整个框架，但我只需要两个类就可以加入所有代码。我把它们留在这里，直到我写信给 paulgreg 和 poi 开发团队以将其合并到其 jar 中，因为我认为要在 excel 中写入未知数据，您需要这种经理。

更改基本上是，经理知道工作簿，提供样式对象，并实现 CellStyleHelper 的代码。（它们不太通用，因为经理需要知道工作簿，并且总体而言，因为您必须一次只使用一次 getGeneralStyle 调用（因为它是同一个对象，它在任何调用中都会被重置，但一般使用的是代码适合）所以要使用它：

```
... Creates a workbook
CellStyleManager styleManager = new CellStyleManager(workbook);
... Create a cell
HSSFCellStyle style = styleManager.getGeneralStyle();
styleManager.setCellStyle(cell, style); // no more 4000 styles error! 
```

代码：感谢 PaulGreg！

```
// CellStyleCacheManager.java

public class CellStyleCacheManager {
    protected Set cellStyles;
    protected HSSFCellStyle cellStyle;
    protected HSSFCellStyle defaultValuesCellStyle;
    protected HSSFWorkbook workbook;

    public CellStyleCacheManager(HSSFWorkbook workbook) {
        this.workbook = workbook;
        this.cellStyles = new HashSet();
        // El desperdicio de estilos será pués de dos
        cellStyle = workbook.createCellStyle();
        // Estilo almacenado para reiniciar el que se va a usar
        defaultValuesCellStyle = workbook.createCellStyle();
    }

    /** Si el estilo se crea con createCellStyle, ya no podremos hacer nada */
    public void setCellStyle(HSSFCell cell, HSSFCellStyle cellStyle) {
        CellStyleWrapper cellStyleWrp = new CellStyleWrapper(cellStyle);
        CellStyleWrapper cachedCellStyleWrp = null;

        Iterator it = cellStyles.iterator();

        while(it.hasNext() && (cachedCellStyleWrp == null)) {
            CellStyleWrapper tmpCachedCellStyleWrp = (CellStyleWrapper) it.next();

            if(tmpCachedCellStyleWrp.equals(cellStyleWrp)) {
                // Si algún estilo coincide con el actual usamos ese
                cachedCellStyleWrp = tmpCachedCellStyleWrp;
            }
        }

        if(cachedCellStyleWrp == null) {
            // Si el estilo no existe creamos uno nuevo
            HSSFCellStyle newCellStyle = workbook.createCellStyle();
            CellStyleCacheManager.copyCellStyle(workbook, cellStyle, newCellStyle);

            CellStyleWrapper newWrp = new CellStyleWrapper(newCellStyle);
            cellStyles.add(newWrp);
            cachedCellStyleWrp = newWrp;
        }

        cell.setCellStyle(cachedCellStyleWrp.getHSSFCellStyle());
    }

    public HSSFCellStyle getGeneralStyle() {
        copyCellStyle(workbook, cellStyle, defaultValuesCellStyle);
        return cellStyle;
    }

    public static void copyCellStyle(HSSFWorkbook wb, HSSFCellStyle c1, HSSFCellStyle c2) {
        c2.setAlignment(c1.getAlignment());
        c2.setBorderBottom(c1.getBorderBottom());
        c2.setBorderLeft(c1.getBorderLeft());
        c2.setBorderRight(c1.getBorderRight());
        c2.setBorderTop(c1.getBorderTop());
        c2.setBottomBorderColor(c1.getBottomBorderColor());
        c2.setDataFormat(c1.getDataFormat());
        c2.setFillBackgroundColor(c1.getFillBackgroundColor());
        c2.setFillForegroundColor(c1.getFillForegroundColor());
        c2.setFillPattern(c1.getFillPattern());

        try {
            c2.setFont(wb.getFontAt(c1.getFontIndex()));
        } catch(NullPointerException e) {
            TLogger.getInstance().log(e.getMessage());
        } catch(ArrayIndexOutOfBoundsException e) {
            TLogger.getInstance().log("Be sure to have intialized all POI font objects !\n%s",e.getMessage());
        }

        c2.setHidden(c1.getHidden());
        c2.setIndention(c1.getIndention());
        c2.setLeftBorderColor(c1.getLeftBorderColor());
        c2.setLocked(c1.getLocked());
        c2.setRightBorderColor(c1.getRightBorderColor());
        c2.setRotation(c1.getRotation());
        c2.setTopBorderColor(c1.getTopBorderColor());
        c2.setVerticalAlignment(c1.getVerticalAlignment());
        c2.setWrapText(c1.getWrapText());
    }   
}

CellStyleWrapper.java

public class CellStyleWrapper implements Comparable {
    private HSSFCellStyle cs;
    private int hashCode;

    public CellStyleWrapper(HSSFCellStyle cs) {
        this.cs = cs;
    }

    public boolean equals(Object obj) {
        CellStyleWrapper csWrp_;
        HSSFCellStyle cs_;

        try {
            csWrp_ = (CellStyleWrapper) obj;
        } catch(ClassCastException e) {
            return false;
        }

        cs_ = csWrp_.getHSSFCellStyle();

        return (cs.getAlignment() == cs_.getAlignment()) && (cs.getBorderBottom() == cs_.getBorderBottom())
                && (cs.getBorderLeft() == cs_.getBorderLeft()) && (cs.getBorderRight() == cs_.getBorderRight())
                && (cs.getBorderTop() == cs_.getBorderTop())
                && (cs.getBottomBorderColor() == cs_.getBottomBorderColor())
                && (cs.getDataFormat() == cs_.getDataFormat())
                && (cs.getFillBackgroundColor() == cs_.getFillBackgroundColor())
                && (cs.getFillForegroundColor() == cs_.getFillForegroundColor())
                && (cs.getFillPattern() == cs_.getFillPattern()) && (cs.getFontIndex() == cs_.getFontIndex())
                && (cs.getHidden() == cs_.getHidden()) && (cs.getIndention() == cs_.getIndention())
                && (cs.getLeftBorderColor() == cs_.getLeftBorderColor()) && (cs.getLocked() == cs_.getLocked())
                && (cs.getRightBorderColor() == cs_.getRightBorderColor()) && (cs.getRotation() == cs_.getRotation())
                && (cs.getTopBorderColor() == cs_.getTopBorderColor())
                && (cs.getVerticalAlignment() == cs_.getVerticalAlignment())
                && (cs.getWrapText() == cs_.getWrapText());
    }

    private int v(int i) {
        if(i == 0) {
            return 1;
        } else {
            return i;
        }
    }

    public int hashCode() {
        if(hashCode == 0) {
            hashCode = 17;
            hashCode = 37 * v(cs.getBorderBottom());
            hashCode = 37 * v(cs.getBorderLeft());
            hashCode = 37 * v(cs.getBorderRight());
            hashCode = 37 * v(cs.getBorderTop());
            hashCode = 37 * v(cs.getBottomBorderColor());
            hashCode = 37 * v(cs.getDataFormat());
            hashCode = 37 * v(cs.getFillBackgroundColor());
            hashCode = 37 * v(cs.getFillForegroundColor());
            hashCode = 37 * v(cs.getFillPattern());
            hashCode = 37 * v(cs.getFontIndex());
            hashCode = 37 * (cs.getHidden() ? 1 : (-1));
            hashCode = 37 * v(cs.getIndention());
            hashCode = 37 * v(cs.getLeftBorderColor());
            hashCode = 37 * (cs.getLocked() ? 1 : (-1));
            hashCode = 37 * v(cs.getRightBorderColor());
            hashCode = 37 * v(cs.getRotation());
            hashCode = 37 * v(cs.getTopBorderColor());
            hashCode = 37 * v(cs.getVerticalAlignment());
            hashCode = 37 * (cs.getWrapText() ? 1 : (-1));
        }

        return hashCode;
    }

    public int compareTo(Object obj) {
        int diff = 0;
        CellStyleWrapper csWrp_;
        HSSFCellStyle cs_;

        try {
            csWrp_ = (CellStyleWrapper) obj;
        } catch(ClassCastException e) {
            return -1;
        }

        cs_ = csWrp_.getHSSFCellStyle();

        diff = cs.getAlignment() - cs_.getAlignment();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getBorderBottom() - cs_.getBorderBottom();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getBorderLeft() - cs_.getBorderLeft();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getBorderRight() - cs_.getBorderRight();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getBorderTop() - cs_.getBorderTop();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getBottomBorderColor() - cs_.getBottomBorderColor();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getDataFormat() - cs_.getDataFormat();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getFillBackgroundColor() - cs_.getFillBackgroundColor();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getFillForegroundColor() - cs_.getFillForegroundColor();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getFillPattern() - cs_.getFillPattern();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getFontIndex() - cs_.getFontIndex();

        if(diff != 0) {
            return diff;
        }

        if(cs.getHidden() != cs_.getHidden()) {
            return -1;
        }

        diff = cs.getIndention() - cs_.getIndention();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getLeftBorderColor() - cs_.getLeftBorderColor();

        if(diff != 0) {
            return diff;
        }

        if(cs.getLocked() != cs_.getLocked()) {
            return -1;
        }

        diff = cs.getRightBorderColor() - cs_.getRightBorderColor();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getRotation() - cs_.getRotation();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getTopBorderColor() - cs_.getTopBorderColor();

        if(diff != 0) {
            return diff;
        }

        diff = cs.getVerticalAlignment() - cs_.getVerticalAlignment();

        if(diff != 0) {
            return diff;
        }

        if(cs.getWrapText() != cs_.getWrapText()) {
            return -1;
        }

        return 0;
    }

    public HSSFCellStyle getHSSFCellStyle() {
        return cs;
    }
} 
```

有趣的是，在 poi 源中，在 HSSFCellStyle 的评论中，出现了这个条目

```
// Why would you do that??
protected HSSFCellStyle(... 
```

4000种款式限制男人，够不够理由？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-01T05:37:49.323

关于工作簿中 HSSFCellStyles 数量的限制，我发现比构建样式管理器更简单的方法。POI CellUtils 类有一个 setCellStyleProperty() 方法，该方法将尝试在工作簿中查找样式并使用它，如果不存在则创建它。

此示例使用 POI 3.7 编写日期，并且每个日期单元格仅使用一种格式（如果基础单元格都具有相同的样式）：

```
 public void writeFormattedDate(Workbook wb, Cell cell, Date date) {
            CellUtil.setCellStyleProperty(cell, wb, CellUtil.DATA_FORMAT, wb.getCreationHelper().createDataFormat().getFormat("dd-MMM-yyyy"));
            cell.setCellValue(date)
    } 
```

setCellStyleProperty() 的主要警告是您一次只能设置一个属性。您可以轻松地重写它以获取属性和值的列表。

在我的测试中，限制似乎是大约 4030 种样式，然后在打开工作簿时会引发错误并删除多余的格式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T03:38:39.063

我发现使用 POI 编写 Excel 文件的最大限制之一是它在将整个文件内容写入文件之前将其保存在内存中。对于非常大的文件（很多行），这成为一个真正的问题，导致频繁的 OutOfMemory 异常。

然而，和你一样，这是一个非常旧版本的 POI。我不确定新版本是否更有效地使用内存。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T13:39:59.090

在 paulgreg 关于您的 CellStyleCacheManager ：虽然这是一种重用样式的方法，但您的 setCellStyle() 方法需要一个 HSSFCellStyle 参数，并且创建我知道的 HSSFCellStyle 的唯一方法是通过调用将其注册到工作簿它是 createCellStyle() 方法。

尽管单元格实际上使用了较少的样式，但您最终在工作簿中注册的样式数量与没有缓存的情况相同吗？或者是否有某种我不知道的清除 HSSF 中未使用的样式？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T14:48:52.433

另一个严重的限制（我认为没有很好地解释）是 HSSFCellStyle 在工作簿中受到限制（我认为这是一个 excel 限制）。

您不应该在每个单元格上创建新样式（因为那样，excel 将无法打开您的工作簿），但是您必须保留对它们的引用并在单元格样式相似时重新应用它们。

因此，您必须管理 HSSFCellStyle 的内部缓存，例如：[CellStyleCacheManager](https://sweetdev-ria.svn.sourceforge.net/svnroot/sweetdev-ria/sweetdev-ria/branches/sweetdev-ria-1.1/sweetdev-ria-core/src/main/java/com/ideo/sweetdevria/tag/html/export/formatter/cellStyleCache/CellStyleCacheManager.java)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-26T09:06:37.430

@albfan

我喜欢你的缓存类并将它们转换为`.NET`. 我想我发现了一个错误。

里面有`getGeneralStyle()`一个电话：

```
copyCellStyle(workbook, cellStyle, defaultValuesCellStyle); 
```

此调用将 cellStyle 对象中的值复制到 defaultValuesCellStyle 中，从而覆盖默认值。

我认为我们想要相反的，所以它应该改为：

```
copyCellStyle(workbook, defaultValuesCellStyle, cellStyle); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-27T09:41:30.793

真的看起来有些奇怪，但是我使用代码的方式我不需要 hashCode 所以，我把那个代码留在那里。我认为这是 paulgreg 已经开始但尚未完成的事情。

# gwt - GMail 之类的文件上传进度条与 GWT？

> ID：624891
> 
> 赞同：26
> 
> 时间：2009-03-09T03:08:19.103
> 
> 标签：gwt

所有 Gmail 用户应该已经注意到文件上传进度条最近已更新。

我想知道这种效果是否可以用 GWT 来实现。我对 GWT 很陌生，所以如果有任何 GWT 源代码可以帮助我测试该功能，那将非常有帮助。

**更新**
我最终选择了 SWFUpload。但是，这个问题下的其他建议都是有效的。只需尝试不同的选项并选择您喜欢的选项！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-11-01T12:06:13.340

看看这个库：[http](http://code.google.com/p/gwtupload/) ://code.google.com/p/gwtupload/ 。它非常易于使用，并且在我检查过的所有浏览器和操作系统中都能正常工作。它使用 ajax 请求来计算进度。顺便说一句，Swfupload 在 linux 和 Mac 中表现不佳。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-12-14T22:19:29.700

我以前用过这个工具：

[http://code.google.com/p/gwt-fileapi/](http://code.google.com/p/gwt-fileapi/)

与这里的其他建议不同，它不仅提供了适当的 API 来显示上传进度，还提供了通过选择多个文件进行批量上传的能力，还提供了拖放支持。它还具有预 HTML5 后备机制。

我对 gwt-fileap 非常幸运。最近它在 Firefox 7 和 8 中出现故障，我不得不对它应用这个补丁 - 但除此之外它真的很好用：

```
@@ -57,26 +57,33 @@

     /**
      * gets the filename
-     * 
+     *
      * @return the filename
      */
     public final native String getFileName() /*-{
-        return this.fileName;
+        if(this.name)
+                    return this.name;
+         else
+                    return this.fileName;
+
     }-*/;

     /**
      * gets the file size in bytes
-     * 
+     *
      * @return the file size in bytes
      */
     public final native int getFileSize() /*-{
-        return this.fileSize;
+        if(this.size)
+                    return this.size;
+         else
+                    return this.fileSize;
     }-*/;

     /**
      * gets the MIME type of the file, may be null if the browser cannot detect
      * the type 
```

我还必须将以下行添加到[http://code.google.com/p/gwt-fileapi/source/browse/trunk/gwt-fileapi/src/com/gwtpro/html5/fileapi/Html5FileApi.gwt.xml](http://code.google.com/p/gwt-fileapi/source/browse/trunk/gwt-fileapi/src/com/gwtpro/html5/fileapi/Html5FileApi.gwt.xml) - 这些行描述了回退机制是如何工作的。如果您希望您的代码在缺少 HTML5 的情况下使用下面显示的 SWFUploader 实现，您可以执行类似的操作。

```
 <define-property name="fileapi.support" values="yes,no" />

    <property-provider name="fileapi.support"><![CDATA[
                   var input=document.createElement('input');
                    input.setAttribute('type','file');
                    return input.files==null?'no':'yes';
    ]]></property-provider>

    <replace-with
            class="com.gwtpro.html5.fileapi.client.ui.FileInput.FileInputImplHtml5">
            <when-type-is
                    class="com.gwtpro.html5.fileapi.client.ui.FileInput.FileInputImpl" />
            <when-property-is name="fileapi.support" value="yes" />
            <any>
                    <when-property-is name="user.agent" value="ie8" />
                    <when-property-is name="user.agent" value="safari" />
                    <when-property-is name="user.agent" value="gecko1_8" />
                    <when-property-is name="user.agent" value="opera" />
                    <when-property-is name="user.agent" value="chrome" /> 
            </any>
    </replace-with> 
```

这就是我在我的应用程序中使用它的方式：

这是描述抽象的接口：

```
public interface FileUpload {
    public void uploadFiles();
    public Widget getWidget();
    public void initialize(Grid updateTable, Uploader uploader, String url, boolean createDropHandler);
    public void setDisabled(boolean b);
    public  void readyToPaint();
    public void reset();

} 
```

以下是该接口的gwt-fileapi实现：

```
package com.hierarchycm.gxt.client.fileUpload;

import com.google.gwt.core.client.JsArray;
import com.google.gwt.event.dom.client.ChangeEvent;
import com.google.gwt.event.dom.client.ChangeHandler;
import com.google.gwt.http.client.RequestException;
import com.google.gwt.http.client.Response;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.Grid;
import com.google.gwt.user.client.ui.RootPanel;
import com.google.gwt.user.client.ui.Widget;
import com.gwtpro.html5.fileapi.client.FileApiSupport;
import com.gwtpro.html5.fileapi.client.drop.DropHandler;
import com.gwtpro.html5.fileapi.client.file.File;
import com.gwtpro.html5.fileapi.client.file.FileEvent;
import com.gwtpro.html5.fileapi.client.file.FileEvent.FileEventHandler;
import com.gwtpro.html5.fileapi.client.ui.FileInput;
import com.gwtpro.html5.fileapi.client.upload.UploadRequest;
import com.gwtpro.html5.fileapi.client.upload.UploadRequestBuilder;
import com.gwtpro.html5.fileapi.client.upload.UploadRequestCallback;

public class FileUploadHtmlImpl extends FileInput implements FileUpload {

    private Grid uploadTable;   
    int currentFile =0;
    String url;
    File[] files;   
    UploadRequestBuilder fileUploader;
    Uploader uploader;

    public FileUploadHtmlImpl() {

    }

    FileUploadHtmlImpl(Grid updateTable, Uploader uploader, String url) {
        this(updateTable, uploader, url, true);
    }

    FileUploadHtmlImpl(Grid updateTable, Uploader uploader, String url, boolean createDropHandler) {
        initialize(updateTable, uploader, url, createDropHandler);
        //this.setCallback(getMyCallback());
    }

    public void initialize(Grid updateTable, Uploader uploader, String url, boolean createDropHandler){
        this.url = url;
        this.uploadTable = updateTable;
        this.uploader = uploader;
        this.setAllowMultipleFiles(true);
        this.addChangeHandler(new ChangeHandler() {
                @Override
                public void onChange(ChangeEvent event) {
                    addFiles(FileUploadHtmlImpl.this.getFiles());   
                    uploadFiles();
                }
          });

        if (createDropHandler) {
            createDropHandler();
        }
    }

     private File[] jsArrToArr (JsArray<File> ipFiles) { 

         File [] result = new File [ipFiles.length()];       
         for (int i = 0; i < ipFiles.length(); ++i) {
             result[i] = ipFiles.get(i);
         }
         return result;
     }

    private UploadRequestCallback getMyCallback() {
        return new UploadRequestCallback() {

            @Override
            public void onError(UploadRequest request, Throwable exception) {
                uploadTable.setText(currentFile + 1, 2, "failed: " + exception.getMessage());
                uploadNextFile(currentFile + 1);
            }

            @Override
            public void onResponseReceived(UploadRequest request, Response response) {
                uploadTable.setText(currentFile + 1, 2, "success: " + response.getText());
                uploadNextFile(currentFile + 1);

                //If we just finished uploading  do your thing
                if (currentFile == files.length) {
                    setDisabled(false);
                    uploader.uploadDoneEventHandler();
                }
            }

            @Override
            public void onUploadProgress(UploadRequest request, int bytesUploaded) {
                uploadTable.setText(currentFile + 1, 2, bytesUploaded + "");
            }
        };
    }

    public void createDropHandler() {
          RootPanel rootPanel = RootPanel.get();
          DropHandler dropHandler = new DropHandler(rootPanel);
            this.fileUploader = new UploadRequestBuilder(url);
            this.fileUploader.setCallback(getMyCallback());
            dropHandler.addFileEventHandler(new FileEventHandler() {

                @Override
                public void onFiles(FileEvent event) {
                    addFiles(jsArrToArr(event.getFiles()));
                    uploadFiles();
                }
            });
    }

     private void addFiles (File[] ipFiles) {
            files = ipFiles;
            uploadTable.clear();
            uploadTable.resize(files.length + 1, 3);
            uploadTable.setText(0, 0, "File name");
            uploadTable.setText(0, 1, "File size");
            uploadTable.setText(0, 2, "Progress");
            for (int i = 0; i < files.length; ++i) {                
                uploadTable.setText(i + 1, 0, files[i].getFileName());                          
                uploadTable.setText(i + 1, 1, files[i].getFileSize() + "");
                uploadTable.setText(i + 1, 2, "");
            }
    }

    public void uploadNextFile(int index) {
            for (String paramName : uploader.getPostParams().keySet()) {
                fileUploader.setHeader(paramName, uploader.getPostParams().get(paramName));                                     
            }

            currentFile = index;
            this.setDisabled(true);
            if (index < this.files.length) {
                try {
                    this.fileUploader.setHeader("itemName", files[currentFile].getFileName());
                    this.fileUploader.sendFile(files[currentFile]);
                } catch (RequestException e) {
                    this.uploadTable.setText(index + 1, 2, "failed: " + e.getMessage());
                    uploadNextFile(index + 1);
                }
            }

     }

    public void uploadFiles() {
        uploadNextFile(0);
    }

    @Override
    public Widget getWidget() {
        return this;
    }

    @Override
    public void readyToPaint() {
        //no need to do anything - already painted for non swf
    }

    @Override
    public void reset() {
        // TODO Auto-generated method stub

    }

    private void showCapabilities() {
        RootPanel
                .get("status")
                .getElement()
                .setInnerHTML(
                        "Drag and Drop Support: "
                                + (FileApiSupport.isDragDropSupported() ? "Yes"
                                        : "No")
                                + "<br/>HTTPXmlRequest Level 2: "
                                + (FileApiSupport.isHttpXmlRequestLevel2() ? "Yes"
                                        : "No")
                                + "<br/>File input supports multiple files: "
                                + (FileApiSupport
                                        .isMultipleFileInputSupported() ? "Yes"
                                        : "No")+"<br/><br/>");
    }

} 
```

这是相同接口的 SWFUpload [http://code.google.com/p/swfupload-gwt/](http://code.google.com/p/swfupload-gwt/)实现：

```
package com.hierarchycm.gxt.client.fileUpload;

import com.extjs.gxt.ui.client.widget.Html;
import com.google.gwt.user.client.ui.Grid;
import com.google.gwt.user.client.ui.Widget;

public class FileUploadSwfImpl extends Html implements FileUpload {

    SwfUploadUtil swfUploadUtil = null;
    private Uploader uploader;
    private String url;
    private boolean createDropHandler;
    private Grid updateTable;

    static int uploadId = 0; 
    static String divTagId;

    public FileUploadSwfImpl() {
        divTagId = "swfupload" + uploadId++;
        String divTag = "<div id=\"" + divTagId + "\"></div";
        this.setHtml(divTag);
    }

    @Override
    public void uploadFiles() {
        swfUploadUtil.startUpload();        
    }

    @Override
    public Widget getWidget() {     
        return this;
    }

     public  void readyToPaint() {      

         swfUploadUtil =  new SwfUploadUtil(uploader, updateTable, divTagId, url);       
     }

    @Override
    public void initialize(Grid updateTable, Uploader uploader, String url, boolean createDropHandler) {

        this.uploader = uploader;
        this.url = url;
        this.createDropHandler = createDropHandler;
        this.updateTable = updateTable;

    }

    @Override
    public void setDisabled(boolean b) {

        swfUploadUtil.setDisabled(b);
        this.disabled = true;

    }

    @Override
    public void reset() {
        swfUploadUtil.reset();

    }
} 
```

这是 FileUploadSwfImpl 所依赖的实用程序：

```
package com.hierarchycm.gxt.client.fileUpload;

import java.util.HashMap;

import org.swfupload.client.File;
import org.swfupload.client.SWFUpload;
import org.swfupload.client.UploadBuilder;
import org.swfupload.client.SWFUpload.ButtonAction;
import org.swfupload.client.SWFUpload.ButtonCursor;
import org.swfupload.client.event.DialogStartHandler;
import org.swfupload.client.event.FileDialogCompleteHandler;
import org.swfupload.client.event.FileQueuedHandler;
import org.swfupload.client.event.UploadCompleteHandler;
import org.swfupload.client.event.UploadErrorHandler;
import org.swfupload.client.event.UploadProgressHandler;
import org.swfupload.client.event.UploadSuccessHandler;
import org.swfupload.client.event.FileDialogCompleteHandler.FileDialogCompleteEvent;
import org.swfupload.client.event.FileQueuedHandler.FileQueuedEvent;
import org.swfupload.client.event.UploadCompleteHandler.UploadCompleteEvent;
import org.swfupload.client.event.UploadErrorHandler.UploadErrorEvent;
import org.swfupload.client.event.UploadProgressHandler.UploadProgressEvent;
import org.swfupload.client.event.UploadSuccessHandler.UploadSuccessEvent;

import com.extjs.gxt.ui.client.widget.form.TextArea;
import com.google.gwt.core.client.GWT;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.Grid;

public class SwfUploadUtil {

    HashMap<String, Integer> filenameRowHm = new HashMap<String, Integer>(); 

    private boolean resetIssued;

    SWFUpload swfUpload = null;
    private HashMap <String, File> files = new HashMap<String, File>();     
    int tableRow = 5;   
    Uploader uploader = null;
    private Grid updateTable;
    private String divName;
    private String url;

    synchronized private void removeFile(String id) {
        files.remove(id);
    }       

    public SwfUploadUtil(Uploader uploader, Grid updateTable,  String divName, String url){
        reset();
        this.uploader = uploader;
        this.updateTable = updateTable;
        this.divName = divName;
        this.url = url;

        this.swfUpload = loadSWFUpload();
        updateTable.resize(5, 5);
        updateTable.setText(2, 0, "Upload URL:" );
        updateTable.setText(2, 1, url );        
        updateTable.setText(4, 0, "File Name" );
        updateTable.setText(4, 1, "Bytes In");
        updateTable.setText(4, 2, "Status");
        updateTable.setText(4, 3, "File Size" );
        updateTable.setText(4, 4, "Server response" );

    }

    public SWFUpload loadSWFUpload() {

        this.updateTable = updateTable;

        if (swfUpload == null) {        
            final UploadBuilder builder1 = new UploadBuilder();
            builder1.setHTTPSuccessCodes(200, 201);
            builder1.setFileTypes("*.webm;*.asf;*.wma;*.wmv;*.avi;*.flv;*.swf;*.mpg;*.mpeg;*.mp4;*.mov;*.m4v;*.aac;*.mp3;*.wav;*.png;*.jpg;*.jpeg;*.gif");
            builder1.setFileTypesDescription("Images, Video & Sound");

            builder1.setButtonPlaceholderID(divName);
            builder1.setButtonImageURL("./images/XPButtonUploadText_61x22.png");
            builder1.setButtonCursor(ButtonCursor.HAND);
            builder1.setButtonWidth(61);
            builder1.setButtonHeight(22);
            builder1.setButtonAction(ButtonAction.SELECT_FILES);

            builder1.setUploadProgressHandler(new UploadProgressHandler() {

                public void onUploadProgress(UploadProgressEvent e) {

                    File f = e.getFile();                   
                    updateTable.setText(getFilenameRow(f), 2, String.valueOf(e.getBytesComplete()));

                }
            });

            builder1.setUploadSuccessHandler(new UploadSuccessHandler() {
                public void onUploadSuccess(UploadSuccessEvent e) {
                    File f = e.getFile();
                    updateTable.setText(getFilenameRow(f), 4, e.getServerData());
                }
            }); 

            builder1.setUploadErrorHandler(new UploadErrorHandler() {
                public void onUploadError(UploadErrorEvent e) {
                    File ff = e.getFile(); 
                    String message = e.getMessage(); 
                    if (message == null || message.trim().length() == 0) {
                        message = "upload failed"; 
                    }               
                    updateTable.setText(getFilenameRow(ff), 2, String.valueOf(message));

                    removeFile(ff.getId()); 
                    if (files.values().size() > 0) {
                        ff = files.values().iterator().next(); 
                        updateTable.setText(getFilenameRow(ff), 2, "Started");
                        swfUpload.startUpload(ff.getId());                      
                    }
                }
            }); 

            builder1.setUploadURL(url); 

            builder1.setDialogStartHandler(new DialogStartHandler() {
                @Override
                public void onDialogStart() {
                    if(resetIssued == true) { 
                        filenameRowHm.clear();
                        resetIssued = false;
                    }               
                }                   
            }
            );

            builder1.setUploadCompleteHandler(new UploadCompleteHandler() {
                public void onUploadComplete(UploadCompleteEvent e) {
                    File f = e.getFile(); 

                    updateTable.setText(getFilenameRow(f), 2, "Done");

                    removeFile(f.getId()); 
                    if (files.values().size() > 0) {
                        File ff = files.values().iterator().next(); 

                        updateTable.setText(getFilenameRow(ff), 2, "Started");
                        swfUpload.startUpload(ff.getId()); 
                    } else {                    
                        uploader.uploadDoneEventHandler();
                    }
                }
            });

            builder1.setFileQueuedHandler(new FileQueuedHandler() {
                public void onFileQueued(FileQueuedEvent event) {

                    File f = event.getFile();                   
                    updateTable.setText(getFilenameRow(f), 2, "Queued");                    
                    files.put(f.getId(), f); 
                }
            });

            builder1.setFileDialogCompleteHandler(new FileDialogCompleteHandler() {
                public void onFileDialogComplete(FileDialogCompleteEvent e) {                                                   

                    updateTable.setText(2, 0, "Number of files");
                    updateTable.setText(2, 1, String.valueOf(files.values().size()));

                    for(File f : files.values()) {
                        getFilenameRow(f);
                    }

                    if (files.values().size() > 0) {

                        for (String paramName : uploader.getPostParams().keySet()) {
                            swfUpload.addPostParam(paramName,uploader.getPostParams().get(paramName));                          
                        }   
                    }
                }
            });
            swfUpload = builder1.build();

        }

        return swfUpload;

    }

    public int getFilenameRow (File f) {
        Integer filenamerow = filenameRowHm.get(f.getId());

        if (filenamerow == null) {
            updateTable.resize(tableRow+1, 5);
            filenamerow = new Integer(tableRow++);
            updateTable.setText(filenamerow.intValue(), 0, f.getName());
            updateTable.setText(filenamerow.intValue(), 3, String.valueOf(f.getSize()));
            //updateTable.setText(filenamerow.intValue(), 3, String.valueOf(f));
            filenameRowHm.put(f.getId(), filenamerow);
        }

        return filenamerow.intValue();
    }

    public void startUpload() {
        uploader.uploadStartedEventHandler();
        swfUpload.startUpload();
    }

    public void setDisabled(boolean disabled) {
        swfUpload.setButtonDisabled(disabled);

    }

    public void reset() {
        // TODO Auto-generated method stub
        resetIssued = true;
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T18:13:46.080

通过[swfupload-gwt使用 SWFUpload](http://code.google.com/p/swfupload-gwt)

与其他方法相比的主要优点是它不需要任何特殊的服务器代码。您甚至可以上传到另一个域（如果有允许它的 crossdomain.xml）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-09T03:14:54.487

查看[GWTC Upload](http://code.google.com/p/gwtcupload/)，它具有您正在寻找的内容的实现。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-09T06:35:46.407

如果您有一个 java 后端，那么编写自己的代码很简单，您只需启动文件上传，然后在计时器上轮询服务器以查看它在哪里（比如每隔一两秒）。java 文件上传二进制文件（apache commons 二进制文件）支持告诉你当前的进度，所以这很简单。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-25T13:37:36.017

最近我开始了我自己的一个项目，叫做`gwtupld`

[http://github.com/kompot/gwtupld/](http://github.com/kompot/gwtupld/)

主要目标是为尖端浏览器提供最佳文件上传体验，并为所有其他浏览器提供可接受的可用性。目前，存在以下主要功能

*   多文件选择
*   拖放
*   进度条
*   光滑而简单的外观
*   所有浏览器的一致行为
*   易于视觉定制
*   没有外部依赖，但 GWT

随意分叉并提交错误/功能建议。您可以查看源代码，然后键入

```
gradlew gwtcompile devmode 
```

并获得它将启动一个功能齐全的沙箱（具有真实文件保存的服务器端应该可以工作）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T12:53:09.343

您可以使用 GwtSwfExt，它是 SWFUpload 之上的包装器（与 Swfupload-gwt lib 相同），您可以从[http://code.google.com/p/gwtswfext](http://code.google.com/p/gwtswfext)下载示例和源代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-28T07:29:12.460

创建您自己的文件上传进度时，您可以让客户端显示一个不确定的条 2 秒，并让服务器计算预计完成时间更改回确定并拉新而是每 5、10 秒估计一次。这应该对交通几乎没有影响。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-09-19T17:22:24.840

有自定义多上传插件演示[http://ext4all.com/post/extjs-4-multiple-file-upload](http://ext4all.com/post/extjs-4-multiple-file-upload)

# eclipse-rcp - 在 Eclipse API 中，如何从位于项目或工作区之外的文件中获取 IFile

> ID：624897
> 
> 赞同：3
> 
> 时间：2009-03-09T03:12:14.103
> 
> 标签：eclipse-rcp, eclipse-3.4

我想创建 IFile 接口来打开位于项目或工作区之外的文件。

如何获取 IFile 接口？

问候，西蒙

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-09T04:03:16.850

[http://wiki.eclipse.org/FAQ_How_do_I_open_an_editor_on_a_file_outside_the_workspace%3F](http://wiki.eclipse.org/FAQ_How_do_I_open_an_editor_on_a_file_outside_the_workspace%3F)

您可以创建*链接资源*：

```
IPath location = new Path(name);
IFile file = project.getFile(location.lastSegment());
file.createLink(location, IResource.NONE, null); 
```

或者，如果您可以使用 EFS 接口（自 Eclipse 3.3 起），您可以使用它来代替 IFile。

# c# - 在 C# 中自动加密文件？

> ID：624898
> 
> 赞同：1
> 
> 时间：2009-03-09T03:13:50.090
> 
> 标签：c#, encryption

如何在 C# 中加密文件？我想使用一个数据库（如sqlite）并正常使用它，除了加密文件并让我的用户在访问数据库之前输入他的密码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-09T03:20:36.360

有多种方法可以做到这一点：

*   使用 ProtectedData（System.Security.Cryptography 类）中提供的 DPApi（数据保护 API），并使用基于密码的熵
*   使用内置的 SQL Compact Edition
*   根据密码生成密钥并使用该密码加密/解密文件
*   使用加密文件系统，因此操作系统将负责磁盘上的加密。（不过，Windows 的消费版没有这个功能。）

可能还有更多方法可以做到这一点。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T03:17:32.077

[SQL Server Compact Edition](http://www.microsoft.com/Sqlserver/2005/en/us/compact.aspx)（它是一个类似 SQLite 的进程内数据库服务器）允许您在[不编写任何额外代码](http://msdn.microsoft.com/en-us/library/ms171966.aspx#)的情况下加密文件。

要更改密码，请使用[Engine.Compact](http://msdn.microsoft.com/en-us/library/ms171752.aspx)方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-26T09:43:35.540

SQLiteConnection.SetPassword

[SQLite ADO.NET 提供程序](http://sqlite.phxsoftware.com/)

我认为您还必须在连接字符串中设置 Password= 参数。

# .net - winforms 分析 - dotTrace 3.1 或 Ants 4.3

> ID：624901
> 
> 赞同：4
> 
> 时间：2009-03-09T03:14:57.077
> 
> 标签：.net, optimization, memory, cpu, profiler

是否有任何特定功能可以帮助我决定为 Winforms 应用程序购买哪个功能。

我正在寻找内存、cpu、性能瓶颈。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T03:29:30.053

我红了各种评论。有人喜欢[dotTrace](http://www.jetbrains.com/profiler/)有人喜欢[Ants](http://www.red-gate.com/Products/ants_profiler/index.htm)。我建议您下载两者的试用版并亲自尝试。它们并不便宜，因此最好知道你在买什么。

（我个人使用 dotTrace。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-17T15:09:09.873

它不是特定于 WinForms 的，但您可能会找到[一些好的 .NET 分析器的答案？](https://stackoverflow.com/questions/3927/what-are-some-good-net-profilers)有用。

RedGate 的[Ants](http://www.red-gate.com/Products/ants%5Fprofiler/index.htm) profiler 和 JetBrains 的[dotTrace](http://www.jetbrains.com/profiler/)似乎是两个最受欢迎的商业产品。

# database - 有没有更好的方法来存储这个数据库？

> ID：624914
> 
> 赞同：0
> 
> 时间：2009-03-09T03:25:19.517
> 
> 标签：database, filesystems

我想做的是扫描磁盘或驱动器（usb、主硬盘等）以查找文件并将其信息存储在数据库中。然后我会将数据库搜索到特定文件以找到它的存储位置。或者，我可以搜索出于存档原因的副本有多旧，或者如果我有某些东西的副本并且不需要重新存档，或者在我故意备份它多次并且我的一张光盘被划伤或驱动器损坏的情况下寻找副本.

这就是我的想法

os + fs 标志（1 字节？） st_mode（即使不在**Linux**中） 2 字节 win32_attr（即使不在 Windows 上） 4 字节（这包括隐藏、目录与文件、锁定等）文件大小（64 位）a/m/c时间，64 位。索引/唯一键作为文件 ID

我应该将名称作为其自己的表中的可变长度通过其匹配的fileID查找吗？或者我应该在数据库中有一个 260 长度的文件名，还是应该在数据库中有一个可变长度的文件名？

然后我在通过fileID查找的校验和/哈希表中有我的校验和（md5、sha1、sha512等，每个一个blob）所需的XYZ位blob。

我在想我的哈希表应该有fileID（与索引长度相同的int？），hashType（int），hashValue（varchar）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T04:21:27.150

将文件名作为 varchar 放在文件表中，至少 varchar[1024]，windows 在某些 OS 组合中对总路径长度有限制，类似于 ISO CD/DVD。

将哈希值放入关联表中，例如：

```
Hash
{
    fileId int,
    hash_type int,         -- or enum
    hash varchar[ 255 ], -- or largest hashtype
    PK ( fileId, hash_type ),
    index( fileID ), 
} 
```

因此您可以稍后添加新的哈希类型，并允许您不支持所有文件的所有哈希类型。

# .net - 从.net中的另一个数组中减去数组

> ID：624916
> 
> 赞同：2
> 
> 时间：2009-03-09T03:26:02.103
> 
> 标签：.net, arrays, compare, subtraction

有什么简单的方法可以从另一个数组中删除一个数组的内容吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T03:30:42.390

如果你有 LINQ

```
array.Except(array2); 
```

# windows - 使用 WiX 创建 IIS 虚拟目录

> ID：624918
> 
> 赞同：20
> 
> 时间：2009-03-09T03:27:32.053
> 
> 标签：windows, iis, iis-7, installation, wix

我会在 WiX 邮件列表上问这个，但它似乎已经关闭了。

我有一个应用程序，它既是桌面应用程序，也是本地运行的 Web 应用程序。我已经创建了几个基本的 WiX 安装程序，但还没有使用 IIS 扩展在 IIS 下创建虚拟目录。我还没有找到一个简单的例子来说明如何做到这一点。我需要做的就是创建虚拟目录，设置它的端口，并将它指向一个真实的目录，我正在使用安装程序的其余部分创建该目录。

如果机器上的 IIS 尚未启用，那么它的好处是启用它，但我猜这是不可能的，而且对我来说也不是一个破坏者。

如果重要的话，这个安装程序将只在 Vista 机器上运行。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-06-30T23:55:10.673

由于大卫提到的文章似乎丢失了，这里有一个例子。这也会在虚拟目录中创建一个应用程序。

```
<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:iis="http://schemas.microsoft.com/wix/IIsExtension">
    <Product Id="6f2b2358-YOUR-GUID-HERE-aa394e0a73a2" Name="WixProject" Language="1033" Version="1.0.0.0" Manufacturer="WixProject" UpgradeCode="225aa7b2-YOUR-GUID-HERE-110ef084dd72">
        <Package InstallerVersion="200" Compressed="yes" />

        <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

        <!-- Reference existing site at port 8080 -->
        <iis:WebSite Id="My.Site" Description="My Site">
            <iis:WebAddress Id="My.Web.Address" Port="8080"/>
        </iis:WebSite>

        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder">
                <Directory Id="INSTALLLOCATION" Name="WixProject">
                    <Component Id="IIS.Component" Guid="{6FAD9EC7-YOUR-GUID-HERE-C8AF5F6F707F}" KeyPath="yes">
                        <iis:WebVirtualDir Id="My.VirtualDir" Alias="foo" Directory="INSTALLLOCATION" WebSite="My.Site">
                            <iis:WebApplication Id="My.Application1" Name="Web Application 1"/> 
                        </iis:WebVirtualDir>
                    </Component>

                </Directory>
            </Directory>
        </Directory>

        <Feature Id="ProductFeature" Title="WixProject" Level="1">
            <ComponentRef Id="IIS.Component" />
        </Feature>
    </Product>
</Wix> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-09T03:48:32.220

使用`iis:WebVirtualDir`和`iis:WebApplication`来自`http://schemas.microsoft.com/wix/IIsExtension`命名空间。

我之前有一个类似的问题，我发现以下文章非常有用：[Wix 3.0 Creating IIS Virtual Directory](http://barkga.spaces.live.com/blog/cns!3933FEFFB336CF0E!612.entry?wa=wsignin1.0&sa=555677186)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-28T14:47:34.750

挖掘谷歌缓存（我认为它现在已被谷歌清除）我认为以下是他的答案中包含的丢失的博客条目 David Pokluda 的代码。我必须做一些重新格式化才能把它变成 SO，对不起，如果它很难看。

```
<?xml version="1.0" encoding="UTF-8"?>
<!--
IMPORTANT
1\. need to add the schema iis.xsd to the property window
2\. add the following iis namespace
3\. add the Visual Studio reference WixIIsExtenion
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
xmlns:iis="http://schemas.microsoft.com/wix/IIsExtension">
  <Product Id="7b523f47-YOUR-GUID-HERE-fea6be516471" 
           Name="Vince Wix 3 Web Service" 
           Language="1033" 
           Version="1.0.0.0" 
           Manufacturer="Vince LLC" 
           UpgradeCode="0a8c10df-YOUR-GUID-HERE-50b9ecdb0a41">
    <Package InstallerVersion="200" Compressed="yes" />

    <Media Id="1" Cabinet="WebAppWixProject.cab" EmbedCab="yes" />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="WebApplicationFolder" Name="MyWebApp">
          <Component Id="ProductComponent" Guid="80b0ee2a-YOUR-GUID-HERE-33a23eb0588e">
            <File Id="Default.aspx" Name="Default.aspx" Source="..\MyWebApp\Default.aspx" DiskId="1" />
            <File Id="Default.aspx.cs" Name="Default.aspx.cs" Source="..\MyWebApp\Default.aspx.cs" DiskId="1"/>
            <iis:WebVirtualDir Id="MyWebApp" Alias="MyWebApp" Directory="WebApplicationFolder" WebSite="DefaultWebSite">
              <iis:WebApplication Id="TestWebApplication" Name="Test" />
            </iis:WebVirtualDir>
          </Component>
        </Directory>
      </Directory>
    </Directory>

    <!--
    IMPORTANT
    Add a virtual directory to an existing web site
    If put it inside the Component, a new Web Site will be created and uninstall will remove it
    -->
    <iis:WebSite Id='DefaultWebSite' Description='Default Web Site' Directory='WebApplicationFolder'>
      <iis:WebAddress Id="AllUnassigned" Port="80" />
    </iis:WebSite>

    <Feature Id="ProductFeature" Title="Vince Wix 3 Web Service" Level="1">
      <ComponentRef Id="ProductComponent" />
    </Feature>
  </Product>
</Wix>

<!--
IMPORTANT
To get rid of light.exe location error, do the following on the Linker Tab:
Set culture to: en-US
Supress Schema Validation in the Advanced Button
--> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-09T03:46:37.780

我不熟悉 WiX，但 IIS 6 和 7 都可以使用 WMI（Windows 管理规范）对象进行管理。我使用 PowerShell 和 C# 在 IIS 上创建网站、虚拟目录、权限等。您应该能够从大多数脚本环境中获得这些对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-17T13:16:29.613

上面的代码片段以不正确的方式使用了 iis:WebAddress。如果您希望它适用于与名称和端口匹配的所有网站，则需要添加 IP="*"。如果在 IIS 中为网站分配了 ip 地址，则上面的示例在安装过程中失败（wix CA 一般不会找到它）

咆哮：在我看来，wix 很糟糕，原因有很多，这是一个很好的例子。如果缺少该属性，它将仅适用于具有默认 IP 的网站 - 这是多么不直观。Wix 至少应该为缺少的 IP 元素发出警告。此外，默认 IP (localhost) 在 IIS 元数据库中表示为 *，同时在 wix 文件中 * 表示所有网站（不仅是 *）。所以它真的很混乱，而且根本不直观。

# php - 在PHP中，NULL和将字符串设置为等于2个单引号有什么区别

> ID：624922
> 
> 赞同：29
> 
> 时间：2009-03-09T03:29:28.883
> 
> 标签：php, null

当我想要空白值时，我曾经设置过这样的东西。

```
$blankVar = ''; 
```

几个月后，我认为这看起来更好，并且意图更清晰。

```
$blankVar = null; 
```

这有一段时间没有打嗝，但最近使用 PDO 准备好的语句我遇到了问题。将值绑定到 null 会使查询失败，而将其绑定到 '' 则不会。我需要将它绑定到 null，这样如果满足某个条件，它将插入空白数据。

2之间有什么区别？我仍然认为等于 null（或至少是一个常数）看起来更好，所以我应该这样做吗？

```
define('EMPTY', ''); 
```

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-03-09T03:43:53.950

**Null 只是 PHP 中的另一种数据类型，它只有一个值（null）。** 由于 PHP 是一种松散类型的语言，它可能会混淆它如何处理不同的值。

`"", 0, "0", False, array(), Null`在 PHP 中都被认为是 False。

然而，Null 是另一种动物。使用 Null的**主要**不兼容之处在于您无法判断它是否为 isset()。

```
$x = false;
isset($x)  ->  true
echo $x    ->  ""

$y = null;
isset($y)  ->  false
echo $y    ->  ""

//$z is not set
isset($z)  ->  false
echo $z    ->  E_NOTICE 
```

所以 null 在某种意义上是奇怪的，因为它不遵循 PHP 中的正常变量规则（至少有些）。在大多数情况下，这很好。

**当涉及到数据库列时，PHP 的 NULL 没有位置。** 你看，SQL 是一种基于字符串的语言。SQL 的 NULL 必须`NULL`用不带引号的形式表示。

因此，如果您想要一个 EMPTY 字段，请将其设置为“”

```
INSERT INTO foo SET bar = "" 
```

但如果你想要一个 NULL 字段，请将其设置为 NULL

```
INSERT INTO foo SET bar = NULL 
```

巨大差距。

但是，如果您尝试直接插入 PHP NULL，它将在查询中添加零个字符（这会给您留下空白或语法错误，具体取决于您是否引用它）。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-09T03:32:00.967

**null**是编程语言中的一个特殊占位符值，字面意思是“无”。它不是 0，它不是一个空字符串，它什么都不是。内存中没有被指向的值。另一方面，一个空字符串仍然是一个字符串对象，只是一个非常短的对象:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-09T03:32:28.453

好吧，每种方法看起来有多好是一回事，但主要区别在于一种是空字符串，另一种是未初始化的变量（null）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-09T03:37:00.377

除了 Rex 所说的差异之外，PHP 中还有两种比较类型，松散的和严格的：

[http://www.php.net/manual/en/types.comparisons.php](http://www.php.net/manual/en/types.comparisons.php)

如果以任何身份使用严格比较或 is_null() 之类的函数，您将得到不同的结果。然而，通过松散的比较，PHP 是相当宽松的。

我不确定，但是您可以使用 null 方法，然后在遇到问题的上下文中使用变量时进行类型转换（即传递（字符串）$blankVar）。如果可行，则可能意味着您的代码需要进行的更改更少。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-09T03:39:56.250

'null' 是未初始化变量所指的唯一事物。您可以设置一个变量来引用 null。还有“未设置”状态意味着变量根本不存在。您可以通过[isset() 函数](http://us2.php.net/manual/en/function.isset.php)进行检查。最常用于检查数组元素是否存在，例如，一种查看 $_GET['op'] 是否收到查询字符串参数的方法。[您还可以通过unset() 函数取消设置](http://us2.php.net/manual/en/function.unset.php)变量（删除数组的元素） 。还有一个[函数 empty()](http://us2.php.net/manual/en/function.empty.php)将检查变量是否为 NULL、FALSE、0 或空字符串

# javascript - 可以从 javascript 中的原型模型中学到什么？

> ID：624924
> 
> 赞同：2
> 
> 时间：2009-03-09T03:30:18.863
> 
> 标签：javascript, prototype, language-design

这个问题是从语言设计的角度来看的。

我应该稍微解释一下情况。我正在研究一个不支持原型的 javascript 变体，但是它已经过期了一个体面的类型系统（最重要的是支持 instanceof）。ecmascript 规范并不重要，所以我可以自由地实现一些不同且更适合的东西。

在变体中：-

*   您不使用 声明构造函数`function foo()`，而是在模板文件中声明构造函数，这意味着构造函数存在于命名空间中（由文件的路径确定）
*   目前，所有行为的继承都是通过应用模板来完成的，这意味着所有共享函数都被复制到每个单独的对象（毕竟没有原型）。

从来没有做过网络开发人员，这让我处于一个有点奇怪的位置，从来没有在愤怒中使用过原型。尽管这并没有阻止我对他们发表意见。

据我了解，我对原型模型的主要问题是

*   对象命名空间、obj.prototype、obj.constructor 不必要的乱扔垃圾（这是一个不成熟的反对意见，试图保留将对象视为映射的能力，也许它们不是？）
*   在运行时更改共享行为的能力似乎没有必要，因为直接使用额外的间接级别会更直接`obj.shared.foo()`。特别是它是一个相当大的实现头痛
*   人们似乎不太了解原型，例如原型和构造函数之间的区别。

所以为了解决这些问题，我的想法是有一个特殊的 operator constructorsof。基本上，原则是每个对象都有一个构造函数列表，有时您会想要访问这些构造函数。

```
var x = new com.acme.X();
com.acme.Y(x,[]);      // apply y

(constructorsof x) // [com.acme.Y,com.acme.X,Object];

x instanceof com.acme.X;   // true
x instanceof com.acme.Y;   // true 
```

感谢所有反馈，我很感激可能很难欣赏我的 POV，因为我试图传达很多东西，但这是一个重要的决定和专家意见可能是无价的。

*   任何可以提高我对原型模型的理解的东西，好的和坏的。
*   对我的提议的想法

谢谢，

麦克风

**编辑：**希望提案现在有意义。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T03:54:30.867

Steve Yegge 写了一篇关于[原型模型](http://steve-yegge.blogspot.com/2008/10/universal-design-pattern.html)的优秀技术文章。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T12:38:41.353

我不认为您对原型模型的问题是有效的：

> *   对象命名空间、obj.prototype、obj.constructor 不必要的乱扔垃圾

`prototype`是构造函数的属性，而不是对象实例。此外，由于 [[DontEnum]] 属性，问题并不像听起来那么糟糕，遗憾的是无法以编程方式设置该属性。如果可以的话，一些感知到的问题会消失。

> 这是一个不成熟的反对意见，试图保留将对象视为地图的能力，也许他们不是？

使用对象作为映射没有问题，只要键是字符串并且您检查`hasOwnProperty()`.

> *   在运行时更改共享行为的能力似乎没有必要，当直接使用额外的间接级别时，obj.shared.foo() 会更直接。特别是它是一个相当大的实现头痛

我看不出在实现原型链时最令人头疼的地方在哪里。事实上，我认为原型继承在概念上比基于类的继承更简单，后者在具有后期绑定的语言中没有任何好处。

> *   人们似乎不太了解原型，例如原型和构造函数之间的区别。

只懂Java、C++等基于类的oo语言的人，不懂JavaScript的继承系统，11点新闻。

除了 MarkusQ 的建议之外，您可能还想查看[Io](http://www.iolanguage.com/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T03:59:30.230

使用实用的代码尝试一些事情可能会更容易。用一种简单的语法创建语言，不管是什么，然后用那种语言实现一些东西。然后，经过几次重构迭代后，找出阻碍阅读和编写代码的特性。添加、更改或删除改进语言所需的内容。这样做几次。

确保你的测试代码真正练习了你语言的所有部分，即使有一些真的试图破坏它。尝试在测试中做错所有事情（以及做对所有事情）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T04:43:05.930

阅读开创原型模型的语言“self”可能会帮助您，而不仅仅是从 javascript 的角度来思考它（特别是因为您似乎将它与“Web 编程”联系起来，正如许多人所做的那样）。一些帮助您入门的链接：

```
http://selflanguage.org/
http://www.self-support.com/ 
```

请记住，那些未能学习历史的人注定要重新实现它。

# python - 如何检测 Python 变量是否为函数？

> ID：624926
> 
> 赞同：865
> 
> 时间：2009-03-09T03:31:30.623
> 
> 标签：python

我有一个变量，`x`我想知道它是否指向一个函数。

我曾希望我可以做类似的事情：

```
>>> isinstance(x, function) 
```

但这给了我：

```
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
NameError: name 'function' is not defined 
```

我选择它的原因是因为

```
>>> type(x)
<type 'function'> 
```

* * *

## 回答 #1

> 赞同：1097
> 
> 时间：2009-03-09T03:39:02.620

如果这是针对 Python 2.x 或 Python 3.2+，您可以使用[`callable()`](https://docs.python.org/3/library/functions.html#callable). 它曾经被弃用，但现在已被弃用，因此您可以再次使用它。你可以在这里阅读讨论：http: [//bugs.python.org/issue10518](http://bugs.python.org/issue10518)。你可以这样做：

```
callable(obj) 
```

如果这是针对 Python 3.x 但在 3.2 之前的版本，请检查对象是否具有`__call__`属性。你可以这样做：

```
hasattr(obj, '__call__') 
```

经常被建议的[`types.FunctionTypes`](https://docs.python.org/3/library/types.html#types.FunctionType)或[`inspect.isfunction`](https://docs.python.org/3/library/inspect.html#inspect.isfunction)方法（两者都做[完全相同的事情](https://github.com/python/cpython/blob/ea46c7bc503d1103d60c0ec7023bb52c5defa11d/Lib/inspect.py#L159-L170)）带有许多警告。它`False`为非 Python 函数返回。例如，大多数[内置函数](https://docs.python.org/3/library/functions.html)`False`都是用 C 而不是 Python 实现的，因此它们返回：

```
>>> isinstance(open, types.FunctionType)
False
>>> callable(open)
True 
```

所以`types.FunctionType`可能会给您带来令人惊讶的结果。检查鸭子类型对象属性的正确方法是询问它们是否嘎嘎，而不是查看它们是否适合鸭子大小的容器。

* * *

## 回答 #2

> 赞同：318
> 
> 时间：2009-03-09T03:47:57.120

内置命名空间中没有构造函数的内置类型（例如函数、生成器、方法）位于`types`模块中。您可以`types.FunctionType`在`isinstance`通话中使用：

```
>>> import types
>>> types.FunctionType
<class 'function'>

>>> def f(): pass

>>> isinstance(f, types.FunctionType)
True
>>> isinstance(lambda x : None, types.FunctionType)
True 
```

请注意，这使用了一个非常具体的“功能”概念，这通常不是您所需要的。例如，它拒绝`zip`（技术上是一个类）：

```
>>> type(zip), isinstance(zip, types.FunctionType)
(<class 'type'>, False) 
```

`open`（内置函数有不同的类型）：

```
>>> type(open), isinstance(open, types.FunctionType)
(<class 'builtin_function_or_method'>, False) 
```

和`random.shuffle`（技术上是隐藏`random.Random`实例的方法）：

```
>>> type(random.shuffle), isinstance(random.shuffle, types.FunctionType)
(<class 'method'>, False) 
```

如果您正在执行特定于`types.FunctionType`实例的操作，例如反编译它们的字节码或检查闭包变量，请使用`types.FunctionType`，但如果您只需要像函数一样可调用的对象，请使用`callable`.

* * *

## 回答 #3

> 赞同：103
> 
> 时间：2011-11-28T21:40:27.637

[从 Python 2.1](http://docs.python.org/library/inspect.html#module-inspect)`isfunction`开始，您可以从[`inspect`](http://docs.python.org/library/inspect.html)模块中导入。

```
>>> from inspect import isfunction
>>> def f(): pass
>>> isfunction(f)
True
>>> isfunction(lambda x: x)
True 
```

* * *

## 回答 #4

> 赞同：80
> 
> 时间：2013-09-09T18:42:29.353

接受的答案是在被提供时被认为是正确的。事实证明，Python 3.2 中的*没有替代品*：`callable()`具体来说，`callable()`检查`tp_call`被测试对象的字段。没有普通的 Python 等价物。大多数建议的测试在大多数情况下都是正确的：

```
>>> class Spam(object):
...     def __call__(self):
...         return 'OK'
>>> can_o_spam = Spam()

>>> can_o_spam()
'OK'
>>> callable(can_o_spam)
True
>>> hasattr(can_o_spam, '__call__')
True
>>> import collections
>>> isinstance(can_o_spam, collections.Callable)
True 
```

我们可以通过从类中删除来将活动扳手投入`__call__`其中。为了让事情更加令人兴奋，`__call__`在实例中添加一个假的！

```
>>> del Spam.__call__
>>> can_o_spam.__call__ = lambda *args: 'OK?' 
```

请注意，这确实是不可调用的：

```
>>> can_o_spam()
Traceback (most recent call last):
  ...
TypeError: 'Spam' object is not callable 
```

`callable()`返回正确的结果：

```
>>> callable(can_o_spam)
False 
```

但是`hasattr`错*了*：

```
>>> hasattr(can_o_spam, '__call__')
True 
```

`can_o_spam`毕竟确实有那个属性；它只是在调用实例时不使用。

更微妙的是，`isinstance()`也会出错：

```
>>> isinstance(can_o_spam, collections.Callable)
True 
```

因为我们之前使用了这个检查，后来删除了方法，`abc.ABCMeta` 缓存了结果。可以说这是`abc.ABCMeta`. 也就是说，实际上没有任何方法*可以*产生比使用`callable()`它自己的结果更准确的结果，因为`typeobject->tp_call` 无法以任何其他方式访问 slot 方法。

只需使用`callable()`

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2009-03-09T03:33:49.777

以下应返回一个布尔值：

```
callable(x) 
```

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2010-11-20T18:27:53.020

Python 的 2to3 工具 ( [http://docs.python.org/dev/library/2to3.html](http://docs.python.org/dev/library/2to3.html) ) 建议：

```
import collections
isinstance(obj, collections.Callable) 
```

`hasattr(x, '__call__')`由于[http://bugs.python.org/issue7006](http://bugs.python.org/issue7006)，似乎选择了此方法而不是方法。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2009-03-09T03:58:55.677

`callable(x)` *如果传递的对象可以在 Python 中调用，则*返回 true，但 Python 3.0 中不存在该函数，并且正确地说不会区分：

```
class A(object):
    def __call__(self):
        return 'Foo'

def B():
    return 'Bar'

a = A()
b = B

print type(a), callable(a)
print type(b), callable(b) 
```

你会得到`<class 'A'> True`和`<type function> True`作为输出。

`isinstance`可以很好地确定某个东西是否是一个函数（try `isinstance(b, types.FunctionType)`）；如果您真的想知道是否可以调用某些东西，则可以使用`hasattr(b, '__call__')`或尝试一下。

```
test_as_func = True
try:
    b()
except TypeError:
    test_as_func = False
except:
    pass 
```

当然，这不会告诉您它是否可调用但`TypeError`在执行时抛出 a ，或者一开始就不可调用。这对你来说可能无关紧要。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2012-11-28T12:42:38.050

如果您想检测语法上看起来像函数的所有内容：函数、方法、内置 fun/meth、lambda ...但**排除**可调用对象（`__call__`定义了方法的对象），那么试试这个：

```
import types
isinstance(x, (types.FunctionType, types.BuiltinFunctionType, types.MethodType, types.BuiltinMethodType, types.UnboundMethodType)) 
```

我将此与模块中的`is*()`检查代码进行`inspect`了比较，上面的表达式更加完整，特别是如果您的目标是过滤掉任何函数或检测对象的常规属性。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2009-03-09T03:35:11.600

尝试使用`callable(x)`.

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2017-12-10T08:10:00.253

如果你学过`C++`，你必须熟悉`function object`或`functor`，表示任何可以的对象`be called as if it is a function`。

在 C++ 中， `an ordinary function`是函数对象，函数指针也是；更一般地说，定义`operator()`. 在 C++11 及更高版本中，`the lambda expression`也是`functor`如此。

相似的是，在 Python 中，这些`functors`都是`callable`. `An ordinary function`can be callable, `a lambda expression`can be callable, a `functional.partial`can be callable, the instances of `class with a __call__() method`can be callable。

* * *

好的，回到问题：`I have a variable, x, and I want to know whether it is pointing to a function or not.`

> 如果你想判断天气对象的行为就像一个函数，那么`callable`建议的方法`@John Feminella`是可以的。
> 
> 如果您想要`judge whether a object is just an ordinary function or not`（不是可调用的类实例或 lambda 表达式），那么`xtypes.XXX`建议的 by`@Ryan`是更好的选择。

## 然后我使用这些代码做一个实验：

```
#!/usr/bin/python3
# 2017.12.10 14:25:01 CST
# 2017.12.10 15:54:19 CST

import functools
import types
import pprint 
```

> 定义一个类和一个普通函数。

```
class A():
    def __call__(self, a,b):
        print(a,b)
    def func1(self, a, b):
        print("[classfunction]:", a, b)
    @classmethod
    def func2(cls, a,b):
        print("[classmethod]:", a, b)
    @staticmethod
    def func3(a,b):
        print("[staticmethod]:", a, b)

def func(a,b):
    print("[function]", a,b) 
```

> 定义函子：

```
#(1.1) built-in function
builtins_func = open
#(1.2) ordinary function
ordinary_func = func
#(1.3) lambda expression
lambda_func  = lambda a : func(a,4)
#(1.4) functools.partial
partial_func = functools.partial(func, b=4)

#(2.1) callable class instance
class_callable_instance = A()
#(2.2) ordinary class function
class_ordinary_func = A.func1
#(2.3) bound class method
class_bound_method = A.func2
#(2.4) static class method
class_static_func = A.func3 
```

> 定义函子列表和类型列表：

```
## list of functors
xfuncs = [builtins_func, ordinary_func, lambda_func, partial_func, class_callable_instance, class_ordinary_func, class_bound_method, class_static_func]
## list of type
xtypes = [types.BuiltinFunctionType, types.FunctionType, types.MethodType, types.LambdaType, functools.partial] 
```

> 判断函子是否可调用。如您所见，它们都是可调用的。

```
res = [callable(xfunc)  for xfunc in xfuncs]
print("functors callable:")
print(res)

"""
functors callable:
[True, True, True, True, True, True, True, True]
""" 
```

> 判断函子的类型（types.XXX）。那么函子的类型就不一样了。

```
res = [[isinstance(xfunc, xtype) for xtype in xtypes] for xfunc in xfuncs]

## output the result
print("functors' types")
for (row, xfunc) in zip(res, xfuncs):
    print(row, xfunc)

"""
functors' types
[True, False, False, False, False] <built-in function open>
[False, True, False, True, False] <function func at 0x7f1b5203e048>
[False, True, False, True, False] <function <lambda> at 0x7f1b5081fd08>
[False, False, False, False, True] functools.partial(<function func at 0x7f1b5203e048>, b=4)
[False, False, False, False, False] <__main__.A object at 0x7f1b50870cc0>
[False, True, False, True, False] <function A.func1 at 0x7f1b5081fb70>
[False, False, True, False, False] <bound method A.func2 of <class '__main__.A'>>
[False, True, False, True, False] <function A.func3 at 0x7f1b5081fc80>
""" 
```

* * *

## 我使用数据绘制了一张可调用函子类型的表格。

[![在此处输入图像描述](https://i.stack.imgur.com/W3Hvi.png)](https://i.stack.imgur.com/W3Hvi.png)

> 然后你可以选择合适的函子类型。

如：

```
def func(a,b):
    print("[function]", a,b)

>>> callable(func)
True
>>> isinstance(func,  types.FunctionType)
True
>>> isinstance(func, (types.BuiltinFunctionType, types.FunctionType, functools.partial))
True
>>> 
>>> isinstance(func, (types.MethodType, functools.partial))
False 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2014-01-23T15:08:58.850

以下是其他几种方法：

```
def isFunction1(f) :
    return type(f) == type(lambda x: x);

def isFunction2(f) :
    return 'function' in str(type(f)); 
```

这是我想出第二个的方法：

```
>>> type(lambda x: x);
<type 'function'>
>>> str(type(lambda x: x));
"<type 'function'>"
# Look Maa, function! ... I ACTUALLY told my mom about this! 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2018-07-11T06:24:52.840

作为公认的答案，John Feminella 表示：

> 检查鸭子类型对象属性的正确方法是询问它们是否嘎嘎，而不是查看它们是否适合鸭子大小的容器。“直接比较”的方法会为许多函数给出错误的答案，比如内置函数。

尽管有两个库可以严格区分函数，但我还是绘制了一个详尽的可比较表：

[8.9。types — 内置类型的动态类型创建和名称 — Python 3.7.0 文档](https://docs.python.org/3.7/library/types.html)

[30.13。inspect — 检查活动对象 — Python 3.7.0 文档](https://docs.python.org/3/library/inspect.html)

```
#import inspect             #import types
['isabstract',
 'isasyncgen',              'AsyncGeneratorType',
 'isasyncgenfunction', 
 'isawaitable',
 'isbuiltin',               'BuiltinFunctionType',
                            'BuiltinMethodType',
 'isclass',
 'iscode',                  'CodeType',
 'iscoroutine',             'CoroutineType',
 'iscoroutinefunction',
 'isdatadescriptor',
 'isframe',                 'FrameType',
 'isfunction',              'FunctionType',
                            'LambdaType',
                            'MethodType',
 'isgenerator',             'GeneratorType',
 'isgeneratorfunction',
 'ismethod',
 'ismethoddescriptor',
 'ismodule',                'ModuleType',        
 'isroutine',            
 'istraceback',             'TracebackType'
                            'MappingProxyType',
] 
```

“鸭子打字”是通用的首选解决方案：

```
def detect_function(obj):
    return hasattr(obj,"__call__")

In [26]: detect_function(detect_function)
Out[26]: True
In [27]: callable(detect_function)
Out[27]: True 
```

至于内置函数

```
In [43]: callable(hasattr)
Out[43]: True 
```

再走一步检查是内置函数还是用户定义的函数

```
#check inspect.isfunction and type.FunctionType
In [46]: inspect.isfunction(detect_function)
Out[46]: True
In [47]: inspect.isfunction(hasattr)
Out[47]: False
In [48]: isinstance(detect_function, types.FunctionType)
Out[48]: True
In [49]: isinstance(getattr, types.FunctionType)
Out[49]: False
#so they both just applied to judge the user-definded 
```

确定是否`builtin function`

```
In [50]: isinstance(getattr, types.BuiltinFunctionType)
Out[50]: True
In [51]: isinstance(detect_function, types.BuiltinFunctionType)
Out[51]: False 
```

**概括**

应用`callable`对类型检查功能，
如果`types.BuiltinFunctionType`你有进一步的指定需求使用。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2021-11-03T10:42:50.027

# 结果

|  | 可调用（x） | hasattr(x, '__call__') | 检查.isfunction(x) | 检查方法（x） | 检查.isgeneratorfunction(x) | 检查.iscoroutinefunction(x) | 检查.isasyncgenfunction(x) | isinstance（x，打字。可调用） | isinstance(x, types.BuiltinFunctionType) | isinstance(x, types.BuiltinMethodType) | isinstance(x, types.FunctionType) | isinstance(x, types.MethodType) | isinstance(x, types.LambdaType) | isinstance(x, functools.partial) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 打印 | √</td> | √</td> | × | × | × | × | × | √</td> | √</td> | √</td> | × | × | × | × |
| 功能 | √</td> | √</td> | √</td> | × | × | × | × | √</td> | × | × | √</td> | × | √</td> | × |
| functools.partial | √</td> | √</td> | × | × | × | × | × | √</td> | × | × | × | × | × | √</td> |
| <拉姆达> | √</td> | √</td> | √</td> | × | × | × | × | √</td> | × | × | √</td> | × | √</td> | × |
| 发电机 | √</td> | √</td> | √</td> | × | √</td> | × | × | √</td> | × | × | √</td> | × | √</td> | × |
| 异步函数 | √</td> | √</td> | √</td> | × | × | √</td> | × | √</td> | × | × | √</td> | × | √</td> | × |
| async_generator | √</td> | √</td> | √</td> | × | × | × | √</td> | √</td> | × | × | √</td> | × | √</td> | × |
| 一种 | √</td> | √</td> | × | × | × | × | × | √</td> | × | × | × | × | × | × |
| 功能1 | √</td> | √</td> | √</td> | × | × | × | × | √</td> | × | × | √</td> | × | √</td> | × |
| 功能2 | √</td> | √</td> | × | √</td> | × | × | × | √</td> | × | × | × | √</td> | × | × |
| 功能3 | √</td> | √</td> | √</td> | × | × | × | × | √</td> | × | × | √</td> | × | √</td> | × |

```
import types
import inspect
import functools
import typing

def judge(x):
    name = x.__name__ if hasattr(x, '__name__') else 'functools.partial'
    print(name)
    print('\ttype({})={}'.format(name, type(x)))
    print('\tcallable({})={}'.format(name, callable(x)))
    print('\thasattr({}, \'__call__\')={}'.format(name, hasattr(x, '__call__')))
    print()
    print('\tinspect.isfunction({})={}'.format(name, inspect.isfunction(x)))
    print('\tinspect.ismethod({})={}'.format(name, inspect.ismethod(x)))
    print('\tinspect.isgeneratorfunction({})={}'.format(name, inspect.isgeneratorfunction(x)))
    print('\tinspect.iscoroutinefunction({})={}'.format(name, inspect.iscoroutinefunction(x)))
    print('\tinspect.isasyncgenfunction({})={}'.format(name, inspect.isasyncgenfunction(x)))
    print()
    print('\tisinstance({}, typing.Callable)={}'.format(name, isinstance(x, typing.Callable)))
    print('\tisinstance({}, types.BuiltinFunctionType)={}'.format(name, isinstance(x, types.BuiltinFunctionType)))
    print('\tisinstance({}, types.BuiltinMethodType)={}'.format(name, isinstance(x, types.BuiltinMethodType)))
    print('\tisinstance({}, types.FunctionType)={}'.format(name, isinstance(x, types.FunctionType)))
    print('\tisinstance({}, types.MethodType)={}'.format(name, isinstance(x, types.MethodType)))
    print('\tisinstance({}, types.LambdaType)={}'.format(name, isinstance(x, types.LambdaType)))
    print('\tisinstance({}, functools.partial)={}'.format(name, isinstance(x, functools.partial)))

def func(a, b):
    pass

partial = functools.partial(func, a=1)

_lambda = lambda _: _

def generator():
    yield 1
    yield 2

async def async_func():
    pass

async def async_generator():
    yield 1

class A:
    def __call__(self, a, b):
        pass

    def func1(self, a, b):
        pass

    @classmethod
    def func2(cls, a, b):
        pass

    @staticmethod
    def func3(a, b):
        pass

for func in [print,
             func,
             partial,
             _lambda,
             generator,
             async_func,
             async_generator,
             A,
             A.func1,
             A.func2,
             A.func3]:
    judge(func) 
```

# 时间

挑选最常用的三种方法：</p>

*   **[`callable(x)`](https://docs.python.org/zh-cn/3/library/functions.html?highlight=callable#callable)**
*   **[`hasattr(x, '__call__')`](https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__call__)**
*   **[`isinstance(x, typing.Callable)`](https://docs.python.org/zh-cn/3/library/typing.html#callable)**

|  | 时间/秒 |
| --- | --- |
| 可调用（x） | 0.86 |
| hasattr(x, '__call__') | 1.36 |
| isinstance（x，打字。可调用） | 12.19 |

```
import typing
from timeit import timeit

def x():
    pass

def f1():
    return callable(x)

def f2():
    return hasattr(x, '__call__')

def f3():
    return isinstance(x, typing.Callable)

print(timeit(f1, number=10000000))
print(timeit(f2, number=10000000))
print(timeit(f3, number=10000000))
# 0.8643081
# 1.3563508
# 12.193492500000001 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-03-09T04:19:43.067

函数只是一个带有`__call__`方法的类，所以你可以这样做

```
hasattr(obj, '__call__') 
```

例如：

```
>>> hasattr(x, '__call__')
True

>>> x = 2
>>> hasattr(x, '__call__')
False 
```

这是执行此操作的“最佳”方式，但根据您需要知道它是否可调用或注释的原因，您可以将其放在 try/execpt 块中：

```
try:
    x()
except TypeError:
    print "was not callable" 
```

如果 try/except 比做更多 Python'y 是有争议的`if hasattr(x, '__call__'): x()`.. 我会说`hasattr`更准确，因为您不会意外捕获错误的 TypeError，例如：

```
>>> def x():
...     raise TypeError
... 
>>> hasattr(x, '__call__')
True # Correct
>>> try:
...     x()
... except TypeError:
...     print "x was not callable"
... 
x was not callable # Wrong! 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2013-09-09T16:59:39.330

`'__call__'`您可以检查用户定义的函数是否具有属性`func_name`,等，而不是检查（这不是函数独有的） `func_doc`。这不适用于方法。

```
>>> def x(): pass
... 
>>> hasattr(x, 'func_name')
True 
```

另一种检查方法是使用模块中的`isfunction()`方法`inspect`。

```
>>> import inspect
>>> inspect.isfunction(x)
True 
```

要检查对象是否是方法，请使用`inspect.ismethod()`

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-12-11T20:51:58.293

由于类也有`__call__`方法，我推荐另一种解决方案：

```
class A(object):
    def __init__(self):
        pass
    def __call__(self):
        print 'I am a Class'

MyClass = A()

def foo():
    pass

print hasattr(foo.__class__, 'func_name') # Returns True
print hasattr(A.__class__, 'func_name')   # Returns False as expected

print hasattr(foo, '__call__') # Returns True
print hasattr(A, '__call__')   # (!) Returns True while it is not a function 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2016-09-02T09:02:19.203

请注意，Python 类也是可调用的。

要获取函数（我们所说的函数是指标准函数和 lambdas），请使用：

```
import types

def is_func(obj):
    return isinstance(obj, (types.FunctionType, types.LambdaType))

def f(x):
    return x

assert is_func(f)
assert is_func(lambda x: x) 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2013-08-24T14:38:39.017

无论函数是类，因此您可以获取实例 x 的类的名称并进行比较：

```
 if(x.__class__.__name__ == 'function'):
     print "it's a function" 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-11-29T19:00:03.233

一些答案中使用`hasattr(obj, '__call__')`和`callable(.)`提到的解决方案有一个主要缺点：两者都返回`True`类和具有`__call__()`方法的类实例。例如。

```
>>> import collections
>>> Test = collections.namedtuple('Test', [])
>>> callable(Test)
True
>>> hasattr(Test, '__call__')
True 
```

检查对象是否是用户定义的函数（仅此而已）的一种正确方法是使用`isfunction(.)`：

```
>>> import inspect
>>> inspect.isfunction(Test)
False
>>> def t(): pass
>>> inspect.isfunction(t)
True 
```

如果您需要检查其他类型，请查看[inspect — Inspect live objects](http://docs.python.org/3/library/inspect.html)。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2019-09-08T21:50:53.187

## 精确的功能检查器

**callable**是一个很好的解决方案。然而，我想以与 John Feminella 相反的方式来对待这个问题。而不是这样对待它：

> 检查鸭子类型对象属性的正确方法是询问它们是否嘎嘎，而不是查看它们是否适合鸭子大小的容器。“直接比较”的方法会为许多函数给出错误的答案，比如内置函数。

我们会这样对待它：

> 判断一个东西是不是鸭子的正确方法不是看它会不会嘎嘎叫，而是通过几个过滤器看它是否真的是鸭子，而不是从表面上看它是否像鸭子。

## 我们将如何实现它

'types' 模块有很多类来检测函数，最有用的是**types.FunctionType**，但也有很多其他的，比如方法类型、内置类型和 lambda 类型。我们还将把 'functools.partial' 对象视为一个函数。

我们检查它是否是一个函数的简单方法是对所有这些类型使用 isinstance 条件。以前，我想创建一个从上述所有类继承的基类，但我无法做到，因为 Python 不允许我们从上述某些类继承。

下表列出了哪些类可以对哪些功能进行分类：

[![True, True, False, True] </code></pre> <p>其中一个错误是 is_function(partial)，因为那是一个类，而不是一个函数，而这正是函数，而不是类。 这是一个 <a href=](https://i.stack.imgur.com/W3Hvi.png)预览](https://i.stack.imgur.com/W3Hvi.png)供您试用代码。

## 结论

**callable(obj)**是检查对象是否为函数的首选方法，如果您想通过*鸭式输入*来检查*absolutes*。

我们的自定义**is_function(obj)**，如果您不将可调用类实例计为函数，但仅将函数定义为*built-in*或使用*lambda*、*def*，或*部分*。

我认为这一切都结束了。祝你有美好的一天！

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-09-25T21:02:46.670

`type (f) == type (lambda x:x)`在Python3中，我想出了`True`if`f`是一个函数，`False`如果不是。但我想我更喜欢`isinstance (f, types.FunctionType)`，感觉不那么特别。我想这样做`type (f) is function`，但这不起作用。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2020-02-05T09:17:51.827

你可以试试这个：

```
if obj.__class__.__name__ in ['function', 'builtin_function_or_method']:
    print('probably a function') 
```

甚至更奇怪的东西：

```
if "function" in lower(obj.__class__.__name__):
    print('probably a function') 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-06-09T09:26:26.723

根据之前的回复，我想出了这个：

```
from pprint import pprint

def print_callables_of(obj):
    li = []
    for name in dir(obj):
        attr = getattr(obj, name)
        if hasattr(attr, '__call__'):
            li.append(name)
    pprint(li) 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-03-03T16:23:25.293

结合@Sumukh Barve、@Katsu 和@tinnick 的答案，如果您的动机只是为了在控制台中获取可供您使用的内置函数列表，那么这两个选项有效：

1.  `[i for i, j in __builtin__.__dict__.items() if j.__class__.__name__ in ['function', 'builtin_function_or_method']]`
2.  `[i for i, j in __builtin__.__dict__.items() if str(j)[:18] == '<built-in function']`

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2022-01-15T07:35:40.630

您可以DIY一个简短的函数来检查输入是否不是字符串并将输入转换为字符串将返回匹配的名称定义：

```
def isFunction(o):return not isinstance(o,str) and str(o)[:3]=='<fu'; 
```

我认为这段代码已经兼容所有 python 版本。

或者，如果发生变化，您可以添加额外的小写转换并检查内容长度。我看到的函数的格式字符串是“<function”+name+” at 0xFFFFFFFF>”

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2013-11-11T03:45:17.523

如果值是可调用的，代码将继续执行调用，只需执行调用并 catch 即可`TypeError`。

```
def myfunc(x):
  try:
    x()
  except TypeError:
    raise Exception("Not callable") 
```

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2018-01-12T10:42:52.023

以下是检查它的“repr方式”。它也适用于 lambda。

```
def a():pass
type(a) #<class 'function'>
str(type(a))=="<class 'function'>" #True

b = lambda x:x*2
str(type(b))=="<class 'function'>" #True 
```

* * *

## 回答 #28

> 赞同：-3
> 
> 时间：2019-04-29T14:49:41.083

这对我有用：

```
str(type(a))=="<class 'function'>" 
```

# java - .NET 等效于 Java 中的 java.util.Arrays.toString(...) 方法

> ID：624929
> 
> 赞同：3
> 
> 时间：2009-03-09T03:32:48.483
> 
> 标签：java, .net, arrays, comparison

在 Java 中，`java.util.Arrays`该类有几个静态`toString(...)`方法，它们接受一个数组并返回其字符串表示形式（即用逗号分隔的数组内容的字符串表示形式和用方括号括起来的整个表示形式——例如 "[1, 2, 3 ]”）。

.NET 中是否有等效的方法/功能？

我正在寻找一种无需手动构建循环/方法来遍历数组的 for 方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T03:35:10.320

String.Join[方法](http://msdn.microsoft.com/en-us/library/system.string.join.aspx)。

[您需要自己添加方括号]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T03:36:39.770

试试这个。它不会处理 NULL 值，但可以处理值类型和引用类型。因为它是一种扩展方法，所以您可以在任何数组实例上调用 .ToElementString() 。

```
public static string ToElementString<T>(this T[] array) {
  var middle = array.Select(x => x.ToString().Aggregate((l,r) => l+","+r);
  return "[" + middle + "]";
} 
```

这是一个使用构建器的版本，并且可能会更有效率（只有分析器肯定知道）。它还将正确处理空值。

```
public static string ToElementString<T>(this T[] array) {
  var builder = new StringBuilder();
  builder.Append('[');
  for(int i =0; i < array.Length; i++ ) {
    if ( i > 0 ) {
      builder.Append(',');
    }
    builder.Append(array[i]);
  }
  builder.Append(']');
  return builder.ToString();
} 
```

# c# - Assembly 的 App.Config 被忽略；改为读取 Machine.config

> ID：624942
> 
> 赞同：1
> 
> 时间：2009-03-09T03:42:49.257
> 
> 标签：c#, visual-studio, unit-testing, configuration, app-config

在针对我的 DAL 运行我的 VS2008~~单元~~集成测试时，我发现程序集正在读取`machine.config`而不是程序集的`app.config`.

这是调用堆栈的概要：

*   单元测试项目具有调用 DataLayer 项目的方法
*   `MyDataLayer`类继承自基类。方法被调用`GetStuff()`
*   基类正在使用`System.Configuration`. 都好。
*   在代码中调用此属性：`ConfigurationManager.ConnectionStrings["MyConnStr"]`实际上返回 null 因为它显然没有找到。
*   检查 `MyDataLayer`课程，是的，MyConnStr 在那里。
*   检查集合`ConnectionStrings`，是的，它有一个连接字符串。这是 machine.config 中结束的那个`C:\Windows\Microsoft.NET\Framework\v2.0.50727\Config\machine.config`
*   我不确定为什么我的 DAL`app.config`被`machine.config`

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T03:47:48.603

不确定这是否适用于您，但您需要确保配置字符串在您的单元测试项目的 app.config 中，而不是在您的 DataLayer 项目中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-26T08:51:47.880

这可能对一些处理`Settings.settings`and的人有所帮助`App.config`：

`GenerateDefaultValueInCod`在 Visual Studio（在我的例子中是 VS2008）中编辑 Settings.settings 网格中的任何值（行）时，请注意属性窗格中的e 属性。

如果设置`GenerateDefaultValueInCode`为True（此处默认为True！），则默认值编译成exe（或dll），在纯文本编辑器中打开时可以发现它嵌入在文件中。

我正在开发一个控制台应用程序，如果我在 exe 中有默认值，该应用程序总是忽略放置在同一目录中的配置文件！

一场噩梦，整个互联网上都没有这方面的信息。

# c - 在 Turbo C++ 程序中编译 c 图形时出错

> ID：624943
> 
> 赞同：2
> 
> 时间：2009-03-09T03:43:52.263
> 
> 标签：c, graphics

在我的 Turbo C++ 程序中，我无法运行任何图形程序。当它编译时，它会显示如下错误：

```
undefined symbol _line, _closegraph,_ getmaxx etc... 
```

是因为我的c程序的设置吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T14:10:18.047

这是一个为 Turbo C++ 编写的旧程序，并且您正在尝试使用现代编译器进行编译吗？如果是这样，则可能是程序使用了特定于编译器的扩展和库，而这些扩展和库在您现在使用的编译器中根本不可用。

如果是这种情况，您必须

*   为您当前的环境找到一个模拟旧 Turbo C++ 的现有库，或者
*   找出每个调用应该做什么，并更改代码以使用您的环境支持的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T03:51:47.470

这是编译错误而不是链接错误。看起来“graphics.h”丢失了。

做

```
#include "graphics.h" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T03:47:25.970

这些错误是构建中缺少库的典型特征。尝试链接适当的库并重建解决方案（很可能是 graphics.lib）。

-约翰

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-01-05T06:06:20.567

如果问题是编译错误，那么您可以添加头文件：

```
#include<graphics.h> 
```

如果问题仍然存在，请确保您已添加头文件：

```
#include<dos.h> 
```

# java - 如何在不安装整个 JDK 的情况下在 Windows 中编译 Java 代码？

> ID：624950
> 
> 赞同：6
> 
> 时间：2009-03-09T03:50:35.353
> 
> 标签：java, compilation

假设运行时环境（版本 1.6.0_01-b06）已经到位，但由于我在这台特定 PC 中缺乏管理权限，因此无法安装 JDK。那么，是否有任何不需要安装的适用于 Windows 的可移植 JDK 或独立 Java 编译器？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-09T04:03:38.143

您可以尝试从 JDK 中获取 tools.jar 文件（您必须从另一台机器上复制它）并查看是否有效。

javac 本质上是一个小型 exe，它使用编译器的特定类启动 VM。

此外，对于 JDK 安装，没有什么（我知道）是您无法从另一台机器上复制它的。因此，在您可以安装 JDK 的机器上安装它，然后将文件复制到您无权访问的机器上的某个位置，并且它应该可以工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-09T04:59:00.650

您不需要安装 JDK。只需从另一台机器复制它，并将 PATH 设置为 %jdk%/bin 并将 JAVA_HOME 设置为 %jdk% （实际上，通常只有 PATH 就足够了）。我一直都这样做。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-09T04:23:02.047

Eclipse 工作得很好。作为一个可移植的 ide，它将使用它自己的 jdk。当我试图快速编写一些东西时，我个人使用带有 jdk 文件夹的 jGrasp 作为 PATH。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-09T09:26:56.353

你可以试试[吉克斯](http://jikes.sourceforge.net/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-08-27T00:03:10.030

到目前为止，最好的解决方案是编写自己的编译器。

# schedule - 你的日程安排

> ID：624951
> 
> 赞同：1
> 
> 时间：2009-03-09T03:51:15.850
> 
> 标签：schedule

我尝试每天花一定的时间来学习新技能，同时提高我获得的旧技能。但是，我并没有达到学习我想要什么并完成任务的最佳位置。

所以，我只是想知道你们每天是如何度过时间并“一击即中”的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T04:07:02.647

我使用谷歌阅读器，并在发现它们时添加越来越多的技术博客。然后，我早上喝咖啡读了它们。这个网站也提供了相当多的教育。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T04:22:50.813

我每天都阅读技术网站。我也喜欢使用谷歌阅读器，因为它可以跟踪我读过的内容，让我可以轻松地从我碰巧可以访问的任何计算机上继续我离开的地方。

我从基础开始：[Slashdot](http://slashdot.org/)、[Ars Technica](http://arstechnica.com/) 和[Dr. Dobb's Journal](http://www.ddj.com)。这些网站经常会导致其他重要的信息来源。

使用 RSS 提要关注此类网站时，您不必阅读通过的每篇文章。只需扫描它们并阅读引起您兴趣的那些。不知不觉中，你会储存很多信息，当你遇到触发它的情况时，这些信息会重新出现在你的脑海中。

您不一定是您阅读的所有内容的大师，但您至少会了解当前的发展和技术。

第二部分是练习。我通常一直在家里做一些简单而有趣的编程项目。我可能实际上并没有完成任何有用的事情，但我用它作为尝试新事物的基础。很多时候我会在工作中遇到问题，发现我已经在家里探索了一些解决方案，或者至少考虑过它们，并且能够做出更明智的决定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T04:28:01.237

技术博客是查找有关新材料的基本信息的好方法，有时它们甚至会具有更深入的功能，可以让您获得一些外卖知识，而不仅仅是另一个技术标题。

最适合我的是找出我在科技博客中阅读过的感兴趣的主题，然后找到可以为我提供有关该主题的更高级信息的资源。然后随着一周的过去，花费大量时间来消化学习材料的信息。

在我看来，整天浏览科技头条不会给你留下任何超出基本技术进步的提炼信息。实际上，每天花 X 时间学习你感兴趣的材料会更好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T04:28:28.583

我发现完成事情的关键是管理干扰。我每天只分批处理一到两次电子邮件，并尽量避免打电话、开会和即时消息。这让我有更多的时间可用于开发。

我通过几种不同的方式学习新技能……首先，通过 RSS 阅读器阅读大量与开发相关的技术博客。这让我能够吸收源源不断的新想法，而不必“学习”很多东西，但为我节省了大量的研究时间。然后当我遇到新的东西时，很可能我已经阅读过的东西会有所帮助，我可以更详细地“学习”一些东西。

例如，通过定期阅读 RSS，我意识到已经开发了大量的 javascript 框架，使用 js 框架似乎比手动编写 DOM 操作更有意义。后来，当我开始一个将重心使用 Ajax 的新项目时，我能够在脑海中命名几个框架，快速挑选一个并真正深入了解它。

# git - 我可以让 git-svn 更像 git 吗？

> ID：624956
> 
> 赞同：2
> 
> 时间：2009-03-09T03:52:41.963
> 
> 标签：git, git-svn

是否有可能（或可取？！）设置`git svn`为更像`git`？例如，而不是写

```
git svn dcommit 
```

为什么我不能写

```
git push 
```

同样，而不是

```
git svn rebase 
```

为什么不只是

```
git pull 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-09T15:45:24.540

git 和 svn 在哲学上是不同的，推/拉是主要区别之一。

虽然我可以争辩说您的提议从根本上是错误的（您甚至在您的问题中提出了这一点），但您可以通过别名和一些精神上的重新布线来实现您的目标。

这些并不完美，但可能对您有用或给您一些想法。

```
#file: .git/config
# assumes your svn-remote is called svn
alias.co = git config svn-remote.svn.url > /dev/null && git svn rebase || git pull --rebase
alias.ci = git config svn-remote.svn.url > /dev/null && git svn dcommit || git push 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T04:06:41.913

git 与 svn 不同。git-svn 是一个允许人们将 git 与 svn 一起使用的扩展。

一个冲突是结帐操作，您是指哪种结帐？“svn checkout”或“git checkout”或“git svn clone”。

另一个是“commit”，本地“git commit”，远程“svn commit”：P

这并不是说，他们无法通过查看配置来隐藏更多差异。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-03-20T19:17:04.903

要在使用 Subversion 存储库时使用标准 Git 工作流程和命令，您可以使用 SubGit ( [http://subgit.com/](http://subgit.com/) ) 而不是 git-svn。

SubGit 运行速度更快，不需要您使用“git rebase”保持历史线性，并允许您使用任何 Git 客户端进行推送和拉取。

免责声明：我是一名 SubGit 开发人员。

# c# - 用于差异集的 LINQ

> ID：624960
> 
> 赞同：3
> 
> 时间：2009-03-09T03:53:51.210
> 
> 标签：c#, linq

我有以下数组：

```
var original= new int[] { 2, 1, 3 };
var target = new int[] { 1, 3, 4 };
enum Operation {Added,Removed} 
```

我想执行一个返回以下内容的 LINQ 查询：

```
{{2,Removed},{4,Added}} 
```

限制：我希望 LINQ 能够非常有效地执行此操作并避免使用 O(n^2) 风格的算法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T04:25:44.893

在这种情况下，也许 LINQ 解决方案不是最佳选择。

这将生成一个包含您想要的结果的字典。

```
Dictionary<int, Operation> difference = new Dictionary<int,Operation>();
foreach (int value in original) {
    difference.Add(value, Operation.Removed);
}
foreach (int value in target) {
    if (difference.ContainsKey(value)) {
        difference.Remove(value);
    } else {
        difference.Add(value, Operation.Added);
    }
} 
```

为了减小字典的大小，也许可以并行循环枚举。我会看看那个...

编辑：
这里是：

```
Dictionary<int, Operation> difference = new Dictionary<int,Operation>();
IEnumerator<int> o = ((IEnumerable<int>)original).GetEnumerator();
IEnumerator<int> t = ((IEnumerable<int>)target).GetEnumerator();
bool oActive=true, tActive=true;
while (oActive || tActive) {
    if (oActive && (oActive = o.MoveNext())) {
        if (difference.ContainsKey(o.Current)) {
            difference.Remove(o.Current);
        } else {
            difference.Add(o.Current, Operation.Removed);
        }
    }
    if (tActive && (tActive = t.MoveNext())) {
        if (difference.ContainsKey(t.Current)) {
            difference.Remove(t.Current);
        } else {
            difference.Add(t.Current, Operation.Added);
        }
    }
} 
```

Edit2：
我做了一些性能测试。第一个版本的运行速度提高了 10%-20%，无论是排序列表还是随机排序列表。

我列出了从 1 到 100000 的数字列表，随机跳过了 10% 的数字。在我的机器上，代码的第一个版本在大约 16 毫秒内与列表匹配。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T04:31:48.827

```
enum Operation { Added, Removed, }

static void Main(string[] args)
{
    var original = new int[] { 2, 1, 3 };
    var target = new int[] { 1, 3, 4 };

    var result = original.Except(target)
        .Select(i => new { Value = i, Operation = Operation.Removed, })
        .Concat(
            target.Except(original)
            .Select(i => new { Value = i, Operation = Operation.Added, })
            );

    foreach (var item in result)
        Console.WriteLine("{0}, {1}", item.Value, item.Operation);
} 
```

我不认为你可以用 LINQ 做到这一点，只使用一次通过给定的股票 LINQ 扩展方法，但可能能够编写一个自定义扩展方法。您的权衡可能是延迟执行的损失。比较两者的相对性能会很有趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T04:25:00.433

你运气不好。如果如您在评论中所述，列表未排序，则您无法计算您在单个前向传递中寻求的差异。考虑：

```
{ 1, 2, 3, 4, 5, 6, 7, ...
{ 1, 2, 3, 6, 7, 8, 9, ... 
```

在遇到第一个差异（4 与 6）时，您无法确定您是否正在查看 4 和 5 的*删除*（如果两个列表都是单调增加的，或者*插入*6 , 7, 8, & 9 如果列表继续这样的话，情况就是这样：

```
{ 1, 2, 3,             4, 5, 6, 7, 8, 9,...
{ 1, 2, 3, 6, 7, 8, 9, 4, 5, 6, 7, 8, 9,... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T04:39:09.790

这将在一次通过中实现结果，但是我不确定 GroupBy 操作的复杂性。

```
var original= new int[] { 1, 2, 3 };
var target = new int[] { 1, 3, 4 };

var output = original.Select( i => new { I = i, L = "o" } )
    .Concat( target.Select( i => new { I = i, L = "t" } ) )
    .GroupBy( i => i.I ).Where( i => i.Count() == 1 )
.Select( i => new { I = i.Key, S = (i.ElementAt( 0 ).L == "o" ? Operation.Removed : Operation.Added) } ); 
```

# c# - C# 有结束文本优先级

> ID：624963
> 
> 赞同：1
> 
> 时间：2009-03-09T03:54:37.480
> 
> 标签：c#, textbox, label

我正在连接一个有时足够长的字符串，以至于它不适合标签控件。我怎样才能让它自动滚动到右侧，所以我总是看到字符串的结尾？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T06:41:03.867

虽然我确定有办法，但我不得不问，为什么？我认为它看起来和/或工作起来很糟糕，并且可能会使用户感到困惑。

为什么不在最后用椭圆 (...) 修剪文本并在标签上显示工具提示？

```
using System.Windows.Forms;

var label = new Label();
label.AutoSize = false;
label.AutoEllipsis = true;
label.Text = "This text will be too long to display all together.";

var labelToolTip = new ToolTip();
labelToolTip.SetToolTip(label, label.Text); 
```

现在，当用户将鼠标悬停在工具提示上时，它将显示全文。由于标签中的文本将被截断并以椭圆结尾，因此用户应该知道将鼠标悬停在上面以获取更多信息（通常是标准方式）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T04:00:30.600

该[`TextAlign`](http://msdn.microsoft.com/en-us/library/system.windows.forms.label.textalign.aspx)属性允许您指定对齐方式。如果你用它右对齐，文本的右侧将始终可见。但是，如果您希望它左对齐或居中对齐并且仍然具有您描述的行为，我怀疑您需要执行一些测量[`Graphics.MeasureString`](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.measurestring.aspx)以确定文本是否适合并动态更改对齐方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T04:49:42.747

AFAIK 无法滚动标签。一个技巧是使用 TextBox （只读，关闭边框），然后使用 SendKeys.Send() 将光标移动到文本的末尾。就像是：

```
 textBox1.Focus();
        SendKeys.SendWait("{END}"); 
```

为了使文本不显示为选中状态，我必须更改它在制表符顺序中的位置（使其不是 1），但这在您的情况下可能不是问题。

# jquery - 使用 jQuery 将样式表附加到 iframe

> ID：624979
> 
> 赞同：9
> 
> 时间：2009-03-09T04:07:31.660
> 
> 标签：jquery, dynamic, iframe, stylesheet

我正在创建一个 HTML 编辑器，类似于我现在输入的这个编辑器，输出如下。我正在使用 iframe 并将 $htmlTextBox.val() 转储到 iframe 的主体中。

我正在尝试在 iframe 内创建一个样式表，以便它看起来和它的工作一样好。

提前致谢！

```
$htmlTextBox.keyup(function(){
    SetPreview();
});   

function SetPreview()
{
    var doc = $preview[0].contentWindow.document;
    var $body = $("body", doc);

    $body.html($htmlTextBox.val());
} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-09T04:42:52.573

虽然您*可以*与 iframe 的 document.styleSheets 进行交互，但老派可靠的方法是首先将样式表放在其中（通过编写 iframe-src 以指向具有所需样式表的空文档），或者将其放入与`document.write()`. 例如：

```
<body>
    <iframe></iframe>
    <script type="text/javascript">

        var d= frames[0].document;
        d.open();
        d.write(
            '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional //EN" "http://www.w3.org/TR/html4/loose.dtd">'+
            '<html><head><style type="text/css">'+
            'body { font-size: 200%; }'+
            '<\/style><\/head><body><\/body><\/html>'
        );
        d.close();

        d.body.innerHTML= '<em>Hello</em>';
    </script>
</body> 
```

（这也会将 iframe 文档设置为标准模式，假设这是您想要的。）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-03-08T16:29:30.227

**跟进：**

HTML

```
<iframe id="message" name="message" /> 
```

jQuery

```
setTimeout(function() {
    var $head = $("#message").contents().find("head");                
    $head.append($("<link/>", 
        { rel: "stylesheet", href: url, type: "text/css" }
    ));                
}, 1); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-09-02T15:15:07.070

我们可以在 iframe 中插入样式标签。

```
<style type="text/css" id="cssID">
.className
{
    background-color: red;
}
</style>

<iframe id="iFrameID"></iframe>

<script type="text/javascript">
    $(function () {
        $("#iFrameID").contents().find("head")[0].appendChild(cssID);
        //Or $("#iFrameID").contents().find("head")[0].appendChild($('#cssID')[0]);
    });
</script> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-07T16:33:34.330

从 jHtmlArea 源中提取以下代码。有趣的是，这个功能就在那里，我没有意识到。当我试图弄清楚如何实现它时，我遇到了这个 SO Question 。:)

这不是真正的“jQuery”，但它有效。我猜想 append 的东西不能与 iframe 一起使用，所以他们是老派的。Bobince 的回答看起来也不错，而且可能更可靠？到目前为止，这似乎工作正常。

```
var e = edit.createElement('link'); 
e.rel = 'stylesheet'; 
e.type = 'text/css'; 
e.href = options.css; 
this.iframe[0].contentWindow.document.getElementsByTagName('head')[0].appendChild(e); 
```

**编辑**：我认为它起作用的原因是它是否是相同的域（包括在 js 中创建 iframe）否则通常的浏览器安全块将阻止您操作 iframe dom。

请参阅[如何将 CSS 应用于 iFrame](https://stackoverflow.com/questions/217776/how-to-apply-css-to-iframe)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-13T01:05:16.097

假设您在同一个域上并且不处理跨域安全性，您需要检查 iFrame 是否已加载——不仅仅是 IFRAME，而是里面的文档！（这让我在尝试使用时挂了一段时间`.load()`）

然后，使用 jquery 访问内容，访问头部，并将样式表附加到头部。

```
 $(document.getElementById('yourIframeID').contentWindow.document).ready(function() {
      $('yourIframeID').contents().find('head').append('<link rel="stylesheet" href="/path/to/stylesheet/style.css" type="text/css" />');
 }); 
```

# c# - 调试时无法查看变量值

> ID：624981
> 
> 赞同：11
> 
> 时间：2009-03-09T04:08:48.023
> 
> 标签：c#, .net, asp.net

我正在尝试调试我正在处理的当前应用程序的一部分，但是当我尝试检查属性/变量的值时，我得到了错误：

`Cannot evaluate expression because a thread is stopped at a point where garbage collection is impossible, possibly because the code is optimized.`

这只是一个常规的 ASP.NET 项目。在应用程序的某些部分，我可以完美地查看属性和变量。我还没有弄清楚我可以看到和看不到变量值的代码块有什么不同。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-09T10:07:33.293

该问题[记录](http://blogs.msdn.com/rmbyers/archive/2008/08/16/Func_2D00_eval-can-fail-while-stopped-in-a-non_2D00_optimized-managed-method-that-pushes-more-than-256-argument-bytes-.aspx)在 MSDN 博客上，因为在某些情况下某些类型的大小限制，链接中的更多详细信息。我相信它是 256 字节和/或传递给函数的参数数量的总大小/计数。很抱歉，似乎没有快速解决方案，但希望 MSDN 博客条目能帮助您找到解决问题的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-26T05:58:19.310

这篇文章，[Funceval 规则](http://blogs.msdn.com/b/jmstall/archive/2005/11/15/funceval-rules.aspx)给出了为什么会发生这种情况的一些原因。如果调试已打开且优化已关闭，您似乎无能为力解决此问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T04:09:44.230

你在制作发布版本吗？尝试将配置更改为“调试”，看看它是否有所改善。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T10:19:37.400

我们在两个 WinForm 用户控件中遇到了同样的问题。在这两种情况下，用户控件都包含大量业务逻辑（分别为 2000 和 3000 行代码）并使用多个相当重的对象（它们有 30 多个属性，当其中一个属性第一次从数据库中自动填充时）被访问）。当您尝试单步执行（有些复杂的）验证和保存方法时，您会在尝试访问对象属性时收到相同的消息。

我们得出的结论是，用户控件的大小和复杂性与使用的对象和条件数据库访问的大小和复杂性相结合，对于调试器来说已经变得难以处理，我们可能应该做一些重大的重构来移动大部分业务逻辑脱离用户控制。知道您的问题是否来自相同的情况以及进行上述重构是否确实会产生影响（我们没有时间和/或勇气:) 这样做会很有趣）。********