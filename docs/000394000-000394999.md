# StackOverflow 问答 000394000-000394999

# c# - Windows 应用程序

> ID：394005
> 
> 赞同：0
> 
> 时间：2008-12-26T17:16:08.633
> 
> 标签：c#, vb.net, winforms

Winforms之间如何传递变量？示例客户 ID

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-26T17:44:02.167

这里需要注意的最重要的一点是，Form 只不过是一个 C# 类。如果您从这些术语中考虑表单，答案可能会自行跳出来。

本质上，您有两种选择。第一个是在表单上公开一个属性，您希望向其传递数据。如果您的表单不依赖于传递的数据来运行，这是一个不错的方法。

```
CoolForm myForm = new CoolForm();

myForm.MyProp = "Hello World";
myForm.ShowDialog();
```

第二个选项是通过构造函数传递数据。当表单依赖于数据以发挥作用时，我更喜欢这种方法。我还倾向于将无参数构造函数标记为私有，以确保正确实例化表单。

```
CoolForm myForm = new CoolForm("Hello World");

myForm.ShowDialog();
```

希望有帮助...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T17:20:23.697

如果 CustomerID 是公开的：

```
frmTwo.CustomerId = frmOne.CustomerId 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T17:24:32.797

要添加到 Jim 的答案，您可以通过公共属性或表单构造函数传递变量。所以

```
Form2 frm = new Form2(customerId); 
```

或像吉姆提供的那样。获取值的方法有很多，如果第二种形式依赖于它，我更喜欢构造函数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-26T17:25:20.517

您必须以您希望传递的形式声明公共财产。然后，在实例化你的新表单之后，这是一个简单的任务：

C＃：`MyOtherInstantiatedForm.CustomerID = CurrentCustomerID;`

您是否需要将 CustomerID 传递给多个表单？其他客户信息呢？如果您提供更多信息，我们可能会为您提供更好的解决方案。

# c# - System.Diagnostics.Stopwatch 的准确性如何？

> ID：394020
> 
> 赞同：28
> 
> 时间：2008-12-26T17:27:12.090
> 
> 标签：c#, .net, performance, stopwatch

**System.Diagnostics.Stopwatch**的准确性如何？我正在尝试为不同的代码路径做一些指标，我需要它是准确的。我应该使用秒表还是有其他更准确的解决方案。

有人告诉我，有时秒表会提供不正确的信息。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2010-03-04T12:30:35.560

我刚刚写了一篇文章，解释了必须如何进行测试设置才能从秒表中获得高精度（优于 0.1 毫秒）。我认为它应该解释一切。

[http://www.codeproject.com/KB/testing/stopwatch-measure-precise.aspx](http://www.codeproject.com/KB/testing/stopwatch-measure-precise.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-11-17T21:55:08.670

System.Diagnostics.Stopwatch 类确实准确地测量了经过的时间，但是 ElapsedTicks 方法的工作方式使一些人得出结论，即它不准确，而实际上他们的代码中确实存在逻辑错误。

一些开发人员认为秒表不准确的原因是秒表中的 ElapsedTicks 不等于 DateTime 中的刻度。当应用程序代码使用 ElapsedTicks 创建新的 DateTime 时，就会出现问题。

```
var watch = new Stopwatch();
watch.Start();
... (perform a set of operations)
watch.Stop();
var wrongDate = new DateTime(watch.ElapsedTicks); // This is the WRONG value. 
```

如有必要，可以通过以下方式将秒表持续时间转换为 DateTime：

```
// This converts stopwatch ticks into DateTime ticks.
// First convert to TimeSpan, then convert to DateTime
var rightDate = new DateTime(watch.Elapsed.Ticks); 
```

这里有一篇文章更详细地解释了这个问题：http: [//geekswithblogs.net/BlackRabbitCoder/archive/2012/01/12/c.net-little-pitfalls-stopwatch-ticks-are-not-timespan-ticks。 aspx](http://geekswithblogs.net/BlackRabbitCoder/archive/2012/01/12/c.net-little-pitfalls-stopwatch-ticks-are-not-timespan-ticks.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T18:03:16.247

首先，在谈论时间或空间时，**精确当然不是一个可能或有意义的概念，因为任何物理量级的经验测量都不能假装是精确的。**

其次，[David Bolton](http://cplus.about.com/od/howtodothingsinc/a/timing.htm)的博客文章可能有用。我引用：

> 如果这是用高分辨率计数器计时的，那么它将精确到微秒。它实际上是精确到纳秒（10-9 秒，即十亿分之一秒），但是还有很多其他的东西，纳秒精度真的有点毫无意义。在对代码进行计时或基准测试时，您应该进行多次运行并取平均时间——因为在 Windows 下运行的其他进程、正在发生多少交换到磁盘等，两次运行之间的值可能会有所不同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-18T10:19:49.147

秒表类在不同的配置下返回不同的值，因为频率取决于安装的硬件和操作系统。

使用秒表类，我们只能粗略估计执行时间。对于每次执行，它返回不同的值，因此我们必须对不同的执行取平均值。

更多信息：http: [//msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-26T18:20:58.940

除了支持上述 HUAGHAGUAH 的建议外，我还要补充一点，您应该对一般的微基准非常怀疑。虽然密切关注的性能测试有一个合法的位置，但很容易调整一个不重要的细节。因此，编写并验证为可读性和清晰性而设计的代码，然后对其进行分析以找出热点在哪里（或者是否有*任何*值得担心的地方），然后（仅）调整这些部分。

我记得与一位程序员一起工作，他对系统等待人工输入时执行的一些代码进行了微优化。节省的时间在击键之间的延迟中完全消失了！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-28T14:26:35.650

如果你想要更精确的时间。看看 QueryPerformanceCounter。[QueryPerformanceCounter](http://msdn.microsoft.com/en-us/library/windows/desktop/ms644904%28v=vs.85%29.aspx)的 MSDN 链接。[这里](http://msdn.microsoft.com/en-us/library/aa964692%28v=VS.85%29.aspx)给出了一个简洁的实现。该示例为 CE 加载 coredll.dll，对于 Windows，您应该加载 Kernel32.dll，如 MSDN 文档中所述。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-26T17:30:38.620

MSDN 有[一些](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)秒表的例子。他们还用它来显示它在纳秒内的准确度。希望这可以帮助！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-26T18:27:18.257

为什么你不分析你的代码而不是专注于微基准？

有一些很好的开源分析器，例如：

*   [教授](http://code.google.com/p/nprof/)
*   [用于 C# 的 Prof-It](http://dotnet.jku.at/projects/Prof-It/)
*   [NProfiler](http://chimpswithkeyboards.com/projects/nprofiler/)
*   [简介Sharp](http://www.softprodigy.net/)

# c# - 简单映射器模式 C# 代码生成模板

> ID：394033
> 
> 赞同：0
> 
> 时间：2008-12-26T17:33:55.883
> 
> 标签：c#, orm, code-generation, dao

任何人都可以推荐一个体面的 C# [Mapper Pattern](http://martinfowler.com/eaaCatalog/dataMapper.html)代码生成模板，它可以很好地与 SQL 存储过程配合使用吗？我正在寻找生成[POCO](https://stackoverflow.com/questions/250001/define-poco)样式实体对象的东西，它带有一个静态映射器类，用于通过实体对象将数据传输到数据库/从数据库传输数据。

我了解 NHibernate 可以生成 POCO 样式的实体对象；但是，当您对 SQL 存储过程有很强的依赖（这是本项目的要求）时，NHibernate 就失去了吸引力。

如果您还可以推荐一个还生成 CRUD 存储过程的模板，则可获得奖励积分！;-)

**编辑：**对于这个特定的项目，我绝对对生成 Active Record 模式代码的任何模板不感兴趣（例如，Subsonic、Linq to SQL、Entity Framework 等）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-26T17:59:25.893

非常古老但免费的 LLBLGen 将生成 CRUD 存储过程。它也会生成对象，但我忘记了它们有多像 POCO。我有一种感觉，他们的胆量比没有的要多。

[http://www.codeproject.com/KB/database/usingllblgen.aspx](http://www.codeproject.com/KB/database/usingllblgen.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-06T03:25:12.410

您是否考虑过使用[My Generation](http://www.mygenerationsoftware.com/portal/default.aspx)并使用它来创建自己的模板？

# c#-2.0 - 如何从 C# windows 窗体应用程序执行 .bat 文件？

> ID：394036
> 
> 赞同：12
> 
> 时间：2008-12-26T17:39:35.420
> 
> 标签：c#-2.0, external-process, batch-file

我需要做的是根据用户的要求让 C# 2005 GUI 应用程序调用 .bat 和几个 VBScript 文件。这只是一个权宜之计，直到假期结束，我可以用 C# 编写它。我可以毫无问题地执行 VBScript 文件，但我无法执行 .bat 文件。当我在 C# 应用程序中“单击”以执行 .bat 文件时，一个 DOS 窗口打开和关闭非常快，并且测试 .bat 文件不执行 - “Windows 无法将 bat 识别为内部或外部命令”是错误在 DOS 框中返回。如果我只是双击 .bat 文件或从命令提示符手动运行它，它会执行。除非需要用户交互，否则我还需要 .bat 文件以静默方式执行 - 此脚本将 11k+ 文件复制到联网机器上的文件夹中，偶尔 Windows 会“忘记”

到目前为止，在我的 C# 源代码中，我有这个：

```
Process scriptProc = new Process();

        if (File.Exists("c:\\scripts\\batchfile1.bat"))
        {

            scriptProc.StartInfo.FileName = @"cscript";
            scriptProc.StartInfo.Arguments = ("cmd.exe", "/C C:\\scripts\\batchfile1.bat"); // Wacky psuedo code //
            scriptProc.Start();
            scriptProc.WaitForExit(1500000);
            scriptProc.Close();

        }

        if (!File.Exists("c:\\scripts\\batchfile1.bat"))
        {
        } 
```

我知道这段代码不起作用 - 但它本质上是我想要它做的。我正在看的是 .bat 文件的类似内容。我假设我必须告诉系统使用 cmd 来运行 .bat。我不知道如何做到这一点。我已经查看了这个适用于 C# 2003 的[站点](http://blogs.msdn.com/csharpfaq/archive/2004/06/01/146375.aspx)。对我没有太大帮助，因为我对 C# 非常熟悉。

编辑：使用凯文的帖子我再次尝试。该帖子中的相同解决方案脚本，但为我修改，因为我不需要重定向：

```
 System.Diagnostics.Process proc = new System.Diagnostics.Process();
            proc.StartInfo.FileName = "C:\\scripts\\batchfile1.bat";
            proc.StartInfo.RedirectStandardError = false;
            proc.StartInfo.RedirectStandardOutput = false;
            proc.StartInfo.UseShellExecute = false;
            proc.Start();
            proc.WaitForExit(); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-26T17:41:03.653

这是您要查找的内容：

[调用批处理文件后服务在 WaitForExit 挂起](https://stackoverflow.com/questions/361097/c-service-cannot-execute-batch-file)

这是关于为什么服务无法执行文件的问题，但它显示了执行此操作所需的所有代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-09T16:55:32.597

对于您遇到的关于批处理文件询问用户目标是文件夹还是文件的问题，如果您事先知道答案，您可以这样做：

如果目标是文件： echo f | [批处理文件路径]

如果文件夹：echo d | [批处理文件路径]

它本质上只是将“echo”之后的字母通过管道传输到批处理文件的输入。

# mysql - MySQL：如何在多个表中搜索任何列中存在的字符串

> ID：394041
> 
> 赞同：11
> 
> 时间：2008-12-26T17:44:53.943
> 
> 标签：mysql, string-search

如何搜索 in `table_a table_b table_c`，其中包含随机数列的字符串？

我知道这不是正确的 sql，但它会是这样的：

```
SELECT * FROM users, accounts, something_else WHERE ->ANY COLUMN CONTAINS 'this_string'<- 
```

提前为 SO 社区提供 Ty

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-26T17:56:20.737

将[全文索引](http://dev.mysql.com/doc/refman/5.0/en/fulltext-natural-language.html)添加到所有这些表中的所有字符串列，然后合并结果

```
select * from table1 where match(col1, col2, col3) against ('some string')
union all
select * from table2 where match(col1, col2) against ('some string')
union all
select * from table3 where match(col1, col2, col3, col4) against ('some string')
... 
```

# wcf - WCF 请求通道；真正发生了什么？

> ID：394051
> 
> 赞同：3
> 
> 时间：2008-12-26T17:52:40.337
> 
> 标签：wcf, service

当一个人调用*IRequestChannel的**Open*方法时会发生什么？例如，如果我有以下代码：

 *```
ChannelFactory<IRequestChannel> factory = new ChannelFactory<IRequestChannel>();
// using a netTcpBinding to a net.tcp://localhost:9999/Bar
IRequestChannel outchannel = factory.CreateChannel();
outchannel.Open(); // what happens here?
if (outchannel.State == CommunicationState.Opened)
{
    success = true;
}
outchannel.Close(); 
```

我似乎在某些服务上得到了“误报”，而在其他服务上却出现了准确的失败。如果这不能以某种方式验证通道是否打开，我会假设我总是会得到误报。

有什么改进建议吗？我想避免发送消息，因为这只是为了测试服务对诊断测试的可行性，但如果有必要，我可以。

* * *

我从我们的配置文件中注意到，返回误报的通道正在使用以下行为配置：

```
<binding name="secureNetTcpStream" maxBufferSize="2000000" maxReceivedMessageSize="2000000000" transferMode="Streamed" sendTimeout="00:05:00" receiveTimeout="14:00:00">
    <readerQuotas maxStringContentLength="2000000000" maxArrayLength="2000000000" />
    <security mode="TransportWithMessageCredential">
        <message clientCredentialType="UserName" />
    </security>
</binding> 
```

我想知道流行为配置是否导致 IRequestChannel 显示它是打开的，即使主机和服务不可用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-26T19:55:51.773

调用 Open 函数确实会联系到服务器端，并且会打开通信通道。

但是，可能存在 Open 会成功但调用服务的方法之一会失败的情况。

例如：如果客户端调用启动会话的服务方法并且服务器已达到其最大会话数，则该函数将失败并出现服务器繁忙异常。因此，即使您有一个开放的频道，您也可能无法创建会话。

即使通道已成功打开，服务中也可能存在其他各种故障。

摘要：您的检查很好，但可能还有其他“障碍”会干扰客户端-服务器通信。这些可能是你的误报...

# sql - 创建插入语句——Windows 应用程序 Vb.Net

> ID：394053
> 
> 赞同：1
> 
> 时间：2008-12-26T17:56:02.797
> 
> 标签：sql, vb.net, winforms, thick-client

我在 vb.net 中做 windows 应用程序。我有客户对象包含保存方法。我如何生成插入查询？

我需要将对象保存在关系数据库（SQL 服务器）中。我需要知道哪种是插入的正确方法，即。在 save 方法中，我编写了 SQL 语句来保存对象。这是正确的方法吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-26T19:25:24.737

SQL 的简单 INSERT 语句采用以下基本形式：

```
INSERT INTO [tablename] ( [column1], [column2], ... ) VALUES ( [value1], [value2], ...) 
```

因此，我们显然需要了解您正在使用的数据库表：它有哪些列。我们还需要了解这个类：它有什么属性。最后，我们需要了解表列和类属性的数据类型，以及属性如何映射到列。对于非常简单的对象，名称和类型将对齐。但在其他情况下，您的类本身可能包含一个（或多个）集合，这意味着将数据插入多个表中。

确定了这一切之后，我们仍然需要两件事：数据库的连接信息（通常被提炼成单个[连接字符串](http://www.connectionstrings.com/)）以及您是否担心您的类实例之前可能已保存，在这种情况下您想要构建一个 UPDATE 语句而不是 INSERT。

假设您可以以令人满意的方式回答所有这些问题，您的 VB.Net 代码将如下所示（当然，在适当的情况下替换您的特定列、属性、类型和连接信息）：

```
Public Class Customer
    Public Sub Save()
        DAL.SaveCustomer(Me)
    End Sub

    '   ...'

End Class 
```

.

```
' a VB Module is a C# static class'
Public Module DAL 
    Private ConnString As String = "Your connection string here"

    Public Sub SaveCustomer(ByVal TheCustomer As Customer)
        Dim sql As String = "" & _
        "INSERT INTO [MyTable] (" & _
            "[column1], [column2], ..." & _
        ") VALUES (" & _
            "@Column1, @Column2, ... )"

        Using cn As New SqlConnection(ConnString), _
              cmd As New SqlCommand(sql, cn)

            cmd.Parameters.Add("@column1", SqlDbTypes.VarChar, 50).Value = TheCustomer.Property1
            cmd.Parameters.Add("@column2", SqlDbTypes.VarChar, 1000).Value = TheCustomer.Property2

            cn.Open()
            cmd.ExecuteNonQuery()
        End Using
    End Sub
End Module 
```

我知道您已经听说分离出您的数据库代码是“正确的做法”tm，但我认为您可能还想要一些更具体的原因来说明您希望以这种方式构建代码的原因：

*   您的连接字符串保存在一个位置，因此如果您的数据库服务器移动，您只需进行一项更改。如果这是它自己的程序集或配置文件，那就更好了。
*   如果您曾经迁移到完全不同的数据库类型，您只需更改一个文件即可更新程序。
*   如果你有一个开发人员或 DBA 特别擅长 sql，你可以让他来做这部分应用程序的大部分维护工作。
*   它使您的“真实”对象的代码更简单，因此当您犯了逻辑设计错误时更容易发现。
*   如果另一个应用程序想要与同一个数据库通信，则 DAL 代码最终可能是可重用的。
*   如果您使用 ORM 工具，大部分 DAL 代码都是为您编写的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-26T18:09:24.830

这里有几个问题。首先，你到底在哪里保存这个？您说 SQL，但它是 SQL Server、SQL Express 的实例、本地数据缓存 (SQL CE 3.5) 还是通过 Web 服务保存以与您的 SQL SERVER 对话。这些不同的数据源具有不同的连接选项/要求，并且在 SQL CE 的情况下，SQL 本身还涉及一些其他“陷阱”。

其次，您确定要将数据保存到 SQL Server 等关系数据存储中吗？考虑一下，您可以改用 XML、数据文件（文本、CSV 等）甚至自定义二进制文件类型。

由于您正在使用 Windows 应用程序，因此您可以选择在何处以及如何保存数据。在您知道要将数据放在哪里之前，我们很难帮助您这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-26T21:04:48.720

我同意迈克霍弗的观点。将您的对象检索和持久化的类与您的业务类分开是拥有灵活和健壮设计的关键。这是您希望在 GUI 或业务层中看到的那种代码：

```
//Populate Customer Objects List with data
IList<Customer> customerList = new List<Customer>()
Customer newCustomer1 = new Customer();
newCustomer.Name = "New Name"
newCustomer.email ="abcd@abcd.com"
customerList.Add(newCustomer1)

//DAL calls
DataAccessClass dalClass = new DataAccessClass ();
dalClass.InsertCustomers(customerList); 
```

在您的 DALClass 中应该有一个名为 InsertCustomers(IList customers) 的方法，它应该具有以下代码：

```
 Public Function InsertCustomers(ByVal objectList As IList(Of Customer)) As Integer
        Dim command As IDbCommand = Nothing
        Dim rowsAffected As Integer = 0
        Dim connection As IDbConnection = New System.Data.SqlClient.SqlConnection(Me.ConnectionString)
        Try 
            connection.Open
            Dim e As IEnumerator = objectList.GetEnumerator

            Do While e.MoveNext

                command = connection.CreateCommand
                command.CommandText = "insert into dbo.Customer(CustomerID,CustomerGUID,RegisterDate,Password,SiteID,Las"& _ 
                    "tName,FirstName,Email,Notes,BillingEqualsShipping,BillingLastName) values (@Cust"& _ 
                    "omerID,@CustomerGUID,@RegisterDate,@Password,@SiteID,@LastName,@FirstName,@Email"& _ 
                    ",@Notes,@BillingEqualsShipping,@BillingLastName)"
                System.Console.WriteLine("Executing Query: {0}", command.CommandText)
                Dim paramCustomerID As IDbDataParameter = command.CreateParameter
                paramCustomerID.ParameterName = "@CustomerID"
                command.Parameters.Add(paramCustomerID)
                Dim paramCustomerGUID As IDbDataParameter = command.CreateParameter
                paramCustomerGUID.ParameterName = "@CustomerGUID"
                command.Parameters.Add(paramCustomerGUID)
                Dim paramRegisterDate As IDbDataParameter = command.CreateParameter
                paramRegisterDate.ParameterName = "@RegisterDate"
                command.Parameters.Add(paramRegisterDate)
                Dim paramPassword As IDbDataParameter = command.CreateParameter
                paramPassword.ParameterName = "@Password"
                command.Parameters.Add(paramPassword)
                Dim paramSiteID As IDbDataParameter = command.CreateParameter
                paramSiteID.ParameterName = "@SiteID"
                command.Parameters.Add(paramSiteID)
                Dim paramLastName As IDbDataParameter = command.CreateParameter
                paramLastName.ParameterName = "@LastName"
                command.Parameters.Add(paramLastName)
                Dim paramFirstName As IDbDataParameter = command.CreateParameter
                paramFirstName.ParameterName = "@FirstName"
                command.Parameters.Add(paramFirstName)
                Dim paramEmail As IDbDataParameter = command.CreateParameter
                paramEmail.ParameterName = "@Email"
                command.Parameters.Add(paramEmail)
                Dim paramNotes As IDbDataParameter = command.CreateParameter
                paramNotes.ParameterName = "@Notes"
                command.Parameters.Add(paramNotes)
                Dim paramBillingEqualsShipping As IDbDataParameter = command.CreateParameter
                paramBillingEqualsShipping.ParameterName = "@BillingEqualsShipping"
                command.Parameters.Add(paramBillingEqualsShipping)
                Dim paramBillingLastName As IDbDataParameter = command.CreateParameter
                paramBillingLastName.ParameterName = "@BillingLastName"
                command.Parameters.Add(paramBillingLastName)
                Dim modelObject As Customer = CType(e.Current,Customer)
                paramCustomerID.Value = modelObject.CustomerID
                paramCustomerGUID.Value = modelObject.CustomerGUID
                paramRegisterDate.Value = modelObject.RegisterDate
                If IsNothing(modelObject.Password) Then
                    paramPassword.Value = System.DBNull.Value
                Else
                    paramPassword.Value = modelObject.Password
                End If
                paramSiteID.Value = modelObject.SiteID
                If IsNothing(modelObject.LastName) Then
                    paramLastName.Value = System.DBNull.Value
                Else
                    paramLastName.Value = modelObject.LastName
                End If
                If IsNothing(modelObject.FirstName) Then
                    paramFirstName.Value = System.DBNull.Value
                Else
                    paramFirstName.Value = modelObject.FirstName
                End If
                If IsNothing(modelObject.Email) Then
                    paramEmail.Value = System.DBNull.Value
                Else
                    paramEmail.Value = modelObject.Email
                End If
                If IsNothing(modelObject.Notes) Then
                    paramNotes.Value = System.DBNull.Value
                Else
                    paramNotes.Value = modelObject.Notes
                End If
                paramBillingEqualsShipping.Value = modelObject.BillingEqualsShipping
                If IsNothing(modelObject.BillingLastName) Then
                    paramBillingLastName.Value = System.DBNull.Value
                Else
                    paramBillingLastName.Value = modelObject.BillingLastName
                End If
                rowsAffected = (rowsAffected + command.ExecuteNonQuery)

            Loop
        Finally
            connection.Close
            CType(connection,System.IDisposable).Dispose
        End Try
        Return rowsAffected
    End Function 
```

手动编写 DAL 代码很痛苦，但是您将完全控制您的 DAL、SQL 和映射代码，并且将来更改其中任何一个都将变得轻而易举。

如果您不想手动编写所有 DAL 代码，您可以使用像[Orasis Mapping Studio](http://www.orasissoftware.com)这样的 CodeGenerator来生成与所示完全相同的代码，而无需编写任何内容。您只需要在工具中构建 SQL，将属性映射到参数即可。它将为您生成所有其余部分。

祝你好运，快乐的 DAL 编码！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T18:21:09.627

我和斯蒂芬·赖顿在一起。这里有很多变数，还有很多悬而未决的问题。如果是 SQL，它甚至是 SQL 的 Microsoft 方言吗？是甲骨文吗？MySQL？还有什么？

无论如何，我个人的偏好是尽可能避免在应用程序中构建 SQL，并调用存储过程，即使对于插入和更新也是如此。然后我将过程的参数传递给 ADO.NET 命令对象。我脑子里有一个疯狂的想法，即 SQL 属于数据库。也许这来自于我在互联网时代花费大量时间调试将 SQL 字符串拼接在一起的可怕编写的 ASP 代码。（再也不。）

如果您觉得绝对有必要这样做，请参阅[System.Text.StringBuilder](http://msdn.microsoft.com/en-us/library/system.text.stringbuilder.aspx)类。学习它。爱它。让它成为你最好的朋友。

**更新：** 看到您的回复，我现在看到您正在使用 SQL Server。这让事情变得更好。

我建议将您的 SQL 代码分离到一个单独的类中，远离实际的业务类。有些人可能不同意这一点，但它会使课程的目的保持清晰。（请参阅[关注点分离](http://en.wikipedia.org/wiki/Separation_of_concerns)。）

您希望让您的业务对象处理业务逻辑，以及一个单独的类来处理将数据输入和输出数据库的工作。这样，如果您对序列化逻辑有疑问，您就可以更好地了解在哪里查找，并且大大减少了处理业务逻辑的机会。它还使您的应用程序更容易理解。

多写几门课的一点前期努力会在未来获得巨大的回报。

但那只是我的个人意见。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T19:25:50.587

我更喜欢 Mike Hofer 的想法，在 SQL Server 端有一个存储过程来处理实际的数据更新，并有一个单独的类来包装对这些存储过程的调用。只是我的 0.02 美元

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-26T23:28:08.070

不太确定OP在问什么。

您需要在“保存”方法中准确定义您在做什么

*   如果要在 Save 方法中创建新记录，则需要使用 INSERT 语句。
*   如果要在 Save 方法中更新现有记录，则需要使用 UPDATE 语句。

“保存”方法通常意味着这两种情况都由程序处理。

更好的方法是使用 ("Create" or "Insert") 和 ("Update" or "Save") 方法。

或者也许有一个程序可以同时处理这两种情况。

# c++ - 关键部分 - 是还是不是？

> ID：394061
> 
> 赞同：2
> 
> 时间：2008-12-26T18:00:37.157
> 
> 标签：c++, winapi, critical-section

我正在使用 WinSock2 和 WinAPI 函数编写聊天。我有一点麻烦。
我将客户端连接的 std::vector 存储在服务器上。当新客户端连接时，新线程启动并且与客户端的所有工作都在这个新线程中完成。我不使用类（我知道它不是很好）所以这个连接列表只是定义为全局变量。
在我看来，可能是多个线程尝试同时访问此列表的情况。虽然我没有注意到有任何问题，但我是否需要做这样的事情：

```
 template 
class SharedVector {
    std::vector vect;
    CRITICAL_SECTION cs;
    SharedVector(const SharedVector& rhs) {}
public:
    SharedVector();
    explicit SharedVector(const CRITICAL_SECTION& CS);
    void PushBack(const T& value);
    void PopBack();
    unsigned int size();
    T& operator[](int index);
    virtual ~SharedVector();
};

template
SharedVector::SharedVector() {
    InitializeCriticalSection(&cs);
}

template
SharedVector::SharedVector(const CRITICAL_SECTION& r): cs(r) {
    InitializeCriticalSection(&cs);
}

template
void SharedVector::PushBack(const T& value) {
    EnterCriticalSection(&cs);
    vect.push_back(value);
    LeaveCriticalSection(&cs);
}

template
void SharedVector::PopBack() {
    EnterCriticalSection(&cs);
    vect.pop_back();
    LeaveCriticalSection(&cs);
} 
```

那么，我的情况需要使用 CRITICAL_SECTION 吗？我只是没有发现错误的幸运儿吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-26T18:10:34.687

是的，你很幸运从未遇到任何问题。这是同步问题和竞争条件的问题，代码在 99.9% 的情况下都可以工作，当灾难发生时你不知道为什么。

我会删除将 CRITICAL_SECTION 作为参数的构造函数，因为如果不查看（可能不存在）文档以实现构造函数将初始化它，则不清楚。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-26T19:23:10.810

此代码不是异常安全的，向量 push_back 和 pop_back 方法可能会引发异常，并且您可能会在此处出现死锁。这种方法：

```
unsigned int size();
T& operator[](int index); 
```

也必须同步，因为它们访问可以由另一个线程修改的数据。例如，您可以像这样访问数据：

```
value = shared_vector[shared_vector.size() - 1]; 
```

同时，另一个线程可以这样做：

```
shared_vector.PopBack(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-08T03:02:46.310

我对你最大的问题是建筑。每个连接的线程真的需要直接访问这个**其他**连接数组吗？他们真的不应该将某种抽象消息排入队列吗？如果每个连接线程都知道它所在的宇宙的实现细节，我预计你会在某个地方遇到麻烦。

但是让我们假设连接线程确实需要直接相互访问......

全局变量本身并不是邪恶的。学校只是教它，因为它比提供细致入微的理解更容易。您确实必须知道全局变量的确切含义，并且在您发现别无选择之前假设全局是错误的选择是一个不错的经验法则。解决许多问题的一种替代方法是编写如下函数：

```
SharedVector & GetSharedVector (void)
{
    static SharedVector sharedVector;
    return sharedVector;
} 
```

与使用全局变量相比，这使您可以更好地控制何时实例化类，如果您在具有构造函数的全局变量之间存在依赖关系，这可能至关重要，尤其是当这些全局变量产生线程时。当有人想要访问这个“全局”变量时，它也让你有机会进行调解，而不是在他们直接戳它时无能为力地受苦。

许多其他想法也浮现在脑海中。没有特别的顺序...

*   您无疑已经知道您在这里使用的模板语法很奇怪；我假设你只是输入了这段代码而没有编译它。
*   您需要在私有部分中使用无操作赋值运算符来防止意外（出于同样的原因，您在那里有一个无操作复制构造函数）。
*   显式复制构造函数以多种方式被破坏。它需要显式复制向量，否则您将在新的 SharedVector 实例中得到一个空向量。它应该简单地初始化它自己的临界区而不是复制它（然后初始化它）。真的，对于您的情况，拥有此功能可能根本没有意义，因为网络连接没有合理的复制语义。
*   通过创建一个类 EnteredCriticalSection，其构造函数调用 EnterCriticalSection 并且其析构函数调用 LeaveCriticalSection，可以使异常安全更容易。（当然，它需要保留对临界区的引用。）这使得在面对异常时安全地序列化其他成员函数变得更加容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-26T18:09:22.333

是的，如果你像这样公开一个全局向量，你肯定需要在任何读/写时锁定它。是的，这会严重影响你的表现。

此外，每个请求一个新线程通常也不是一个好主意。你为什么不重新设计你的应用程序来使用 IO 完成端口呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T18:15:49.403

顺便说一句，将这个向量声明为全局变量并不是一个好方法。把它做成本地的会更好吗？

# embedded - 附加变量

> ID：394063
> 
> 赞同：3
> 
> 时间：2008-12-26T18:00:59.307
> 
> 标签：embedded, arduino

我想取两个变量（in 和 in2）并将它们放在一起，例如：

```
in = 1;
in2 = 3;

pin = in.in2; // I want this to set pin to 13 
```

arduino IDE 告诉我 in 不是一个类，那么我将使用什么语法来完成此操作？

编辑：我想出了一种不同的方法，你可以采取`in`. 将其乘以 10，然后设置`pin`为`in`加的总和`in2`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T17:53:09.407

如果你的两个变量肯定是整数，那么

```
pin = (in*10)+in2;
```

会工作。

如果没有，将它们读入字符串（可能使用 in.toString()，取决于语言）然后执行

```
pin = int.parse(in.toString()+in2.toString());
```

（虽然，再次依赖于语言，你可能不得不做一些比 int.parse [在 C# 中你应该使用 int.TryParse() 例如]）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T18:08:03.553

试试这个，我用**C**写的，但你明白了要点。将这两个项目转换为字符串，然后连接并将其解析为整数。

```
pin = int.Parse((string)in + (string)in2); 
```

# performance - 虚拟机中基准测试的可信度？

> ID：394064
> 
> 赞同：3
> 
> 时间：2008-12-26T18:02:00.617
> 
> 标签：performance, virtualization, benchmarking

*与真实硬件相比，在*虚拟机中执行的基准测试的可信度如何？

让我们剖析一个具体的情况。假设我们想要对最近代码更改的性能影响进行基准测试。为简单起见，假设工作负载完全受 CPU 限制（尽管 IO 限制和混合工作负载也很重要）。假设这台机器在 VirtualBox 下运行，因为它是最好的；）

假设我们测量了原始代码和新代码，新代码速度提高了 5%（在虚拟机中进行基准测试时）。我们是否可以有把握地声称它在真实硬件上也至少会快 5%？

更重要的是，假设新代码慢了 3%。我们能否完全确定在真正的硬件上它会慢 3% 或*更少*，但绝对不会*低于*3%？

更新：我最感兴趣的是你的战场结果。IE。你能见证一个例子，在虚拟机中慢 10% 的代码在真铁上执行快 5%，反之亦然？还是它总是一致的（即如果它在 VM 中更快/更慢，它在真实机器上总是成比例地更快/更慢）？到目前为止，我的或多或少是一致的；至少，总是朝着同一个方向前进。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-26T18:07:34.753

如果您将 VM 上的结果与未在 VM 上运行的结果进行比较，那么不，结果不可信。

另一方面，如果两个测试都在相同的环境中运行，他们是的，结果是可信的。这两个测试在虚拟机内都会变慢，但差异仍然应该是可信的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-26T18:15:19.653

考虑到所有因素，使用 Fair Witness 原则，您可以断言应用程序在 VM 中的性能如何，因为这就是您实际测量的内容。

现在，如果您希望尝试根据环境推断您观察到的内容，那么，假设您正在运行本机 VM（与模拟虚拟机相比，例如 x86 上的 PPC），CPU 绑定任务甚至是 CPU 绑定任务在 VM 中，因为 CPU 承担了大部分繁重的工作。

可以说可能涉及一些内存管理问题，可以区分 VM 和本机应用程序，但是一旦正确映射内存，我认为 VM 和本机机器之间的 CPU 绑定运行时间不会有显着差异.

因此，我认为在虚拟机上运行时，从应用程序的一个实例到另一个实例的性能变化会产生类似的性能变化，我认为这是公平的，特别是对于 CPU 密集型应用程序，当在本机机器上运行时。

但是，我认为您不能公平地说“您知道”，除非您在正确的环境中亲自测试它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-26T18:55:13.753

我不认为虚拟机有什么特别之处。即使在“真实”机器上，您仍然使用虚拟内存运行并与其他进程共享 CPU，因此需要考虑类似的考虑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T18:43:52.030

在测试和生产环境之间获得可靠的性能结果的**唯一方法是运行相同的硬件和软件。**一直到硬件版本和软件补丁级别。

否则你几乎是在浪费时间。

例如，一些记忆棒的性能比其他记忆棒更好，这很容易在其他相同的盒子上造成 5% 的吞吐量差异。

关于软件，VM 软件总是会产生影响；并且某些操作可能会比其他操作受到更大的影响，这取决于许多不同的因素，以至于无法比较它们。

# .net - 打印到文本文件的问题

> ID：394071
> 
> 赞同：1
> 
> 时间：2008-12-26T18:07:25.800
> 
> 标签：.net, file, text-files

我完全被难住了。我有一个程序可以提取存储在数据库中的信息，将数据库值分配给相应的类。该类具有打印其字段值的打印方法。用户输入订单 ID 或订单日期范围，然后它会找到这些订单并将它们打印到文本文件中。我遇到的问题是，有时，根据您选择的 id 和日期，文本文件会打印出这样的垃圾。“〢ⰢⱰ潋玱刬瑓抛弃圬扥†′愠岁瑥㔬㈶‸⁗㈱琰瑥敲瑥Ⱜ汁楳Ɒ䱉㘬㠰㌰”在这里我完全一无所知，因为当我调试它时，所有的值都显示出来在类、打印方法和结果集中正确。可能是什么问题呢？有没有人遇到过这种情况？

操作系统是 Windows Vista，我使用的语言是 C#。我正在使用带有 FileStream 作为参数的 StreamWriter 类。

这只发生在某些订单上。就像我选择订单 7 或订单 1-6 一样，它工作正常，但如果我选择 1-7，我会得到奇怪的语言。？？？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-26T19:34:46.560

根据您的评论，记事本会尝试猜测文件的编码。[在这里查看它是如何做到的](http://blogs.msdn.com/oldnewthing/archive/2004/03/24/95235.aspx)。

您应该明确说明文件的编码。

[从文档中](http://msdn.microsoft.com/en-us/library/system.io.streamwriter.aspx)：

> StreamWriter 默认使用 UTF8Encoding 的实例，除非另有说明。这个 UTF8Encoding 实例是在没有字节顺序标记 (BOM) 的情况下构造的，因此它的 GetPreamble 方法返回一个空字节数组。要使用 UTF-8 编码和 BOM 创建 StreamWriter，请考虑使用指定编码的构造函数，例如 StreamWriter(String, Boolean, Encoding)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T18:11:37.960

这***看起来***像是与 Unicode 之间的错误转换，或者设置了文化变量但未正确应用。

# c++ - 返回系统日期的 C++ 函数

> ID：394081
> 
> 赞同：1
> 
> 时间：2008-12-26T18:11:16.807
> 
> 标签：c++

我需要 c++ 中的函数来检索和存储系统日期。我有一个存储日期的类。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-26T19:05:35.917

处理日期和时间很困难，这就是人们使用图书馆的原因。我更喜欢 boost::date_time。

```
boost::posix_time::ptime local_time = boost::posix_time::second_clock::local_time();
boost::gregorian::date d = local_time.date(); 
```

d 是本地时间的当前日期，它使用计算机时区设置。要获取 UTC 时间，您可以使用*boost::posix_time::second_clock::universal_time()*。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-26T18:16:22.757

来自`time.h`：

```
struct tm {
    int tm_sec;     /* seconds after the minute - [0,59] */
    int tm_min;     /* minutes after the hour - [0,59] */
    int tm_hour;    /* hours since midnight - [0,23] */
    int tm_mday;    /* day of the month - [1,31] */
    int tm_mon;     /* months since January - [0,11] */
    int tm_year;    /* years since 1900 */
    int tm_wday;    /* days since Sunday - [0,6] */
    int tm_yday;    /* days since January 1 - [0,365] */
    int tm_isdst;   /* daylight savings time flag */
};

time_t time(time_t * timer);
struct tm* gmtime(const time_t *timer);
struct tm* localtime(const time_t * timer); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T18:25:31.503

对于 Windows 上的 C++，请查看 Windows 时间[函数](http://msdn.microsoft.com/en-us/library/ms725473(VS.85).aspx)，特别是[GetSystemTime](http://msdn.microsoft.com/en-us/library/ms724390(VS.85).aspx)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-26T19:07:34.213

只需添加，`GetSystemTime`为您提供 UTC 时间，同时获得`TimeZone`您需要使用的调整时间 `GetLocalTime`。

WinBase 时间函数（通过 windows.h）与 time.h 函数相比的另一个区别是，windows 时间函数一直可靠到**1601**，而 time.h 只到**1900**年以后。我不确定这是否是您需要考虑的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T19:31:22.247

时间（）

但也可以查看 localtime 和 asctime 进行显示

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T22:31:27.830

这是我最终使用的（`nowtm`填充了当前系统时间）：

```
time_t rawtime=time(NULL);
tm* nowtm = gmtime(&rawtime); 
```

其中 tm 定义为：

```
struct tm {
    int tm_sec;     /* seconds after the minute - [0,59] */
    int tm_min;     /* minutes after the hour - [0,59] */
    int tm_hour;    /* hours since midnight - [0,23] */
    int tm_mday;    /* day of the month - [1,31] */
    int tm_mon;     /* months since January - [0,11] */
    int tm_year;    /* years since 1900 */
    int tm_wday;    /* days since Sunday - [0,6] */
    int tm_yday;    /* days since January 1 - [0,365] */
    int tm_isdst;   /* daylight savings time flag */
}; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-07-08T11:25:51.707

几分钟前我写了非常相似的答案。您可以使用 C++11 中可用的 chrono。 [http://en.cppreference.com/w/cpp/chrono/time_point](http://en.cppreference.com/w/cpp/chrono/time_point)

# php - 确保 MySQL 连接在 PHP 函数中有效

> ID：394113
> 
> 赞同：3
> 
> 时间：2008-12-26T18:35:58.987
> 
> 标签：php, mysql, scope, mysqli

我有以下形式的代码：

```
<?php
function doSomething{
  //Do stuff with MySQL
  $con->tralalala();
}
$con = connectToDatabase;//This would actually be a line or two.
doSomething();
?> 
```

这种（类型的）代码不起作用，因为 doSomething() 没有与数据库的连接。谁能解释为什么不？我在调用 doSomething()*之前*创建了 $con 连接。那么为什么这个函数表现得好像没有连接一样呢？

除了将连接传递给 doSomething($con) 之类的函数之外，有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-26T18:41:17.353

您可能需要告诉它查看全局范围：

```
 function doSomething()
     {
         global $con;
         $con->tralalala();
     } 
```

# delphi - TClientDataset: 'XML 不支持字段类型。'

> ID：394122
> 
> 赞同：0
> 
> 时间：2008-12-26T18:47:49.760
> 
> 标签：delphi, xml-serialization, dataset, client-dataset

我将一堆数据加载到 TClientDataset 中，代表一组复杂对象。但是当我尝试跑步时

```
Dataset.SaveToFile('c:\test.xml', dfXMLUTF8); 
```

它不喜欢它：

项目 testing.exe 引发异常类 EDBClient 并带有消息“XML 不支持字段类型。”。

由于两个原因，这比它应该的用处要少得多。首先，它没有说明不支持哪个字段或哪个字段类型，其次，实际保存是在黑盒 DLL 中进行的。

我在这个数据集中使用的唯一字段类型是整数、字符串、布尔值和一些保存整数字段数组的 TArrayField。没有什么是我期望的那么难以序列化。任何人都知道为什么这不起作用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-26T21:19:32.433

是全部保存还是只保存了一些字段？也许例如 TArrayFields 正在引发异常？尝试一个一个地删除不同的字段类型，看看什么时候开始工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T23:45:08.240

疯狂的猜测是 XML 导出不支持数组字段，但您应该检查一下。

转到项目选项-> 编译器并打开“使用调试 DCU”。重建。

在 SaveToFile() 调用上设置断点。跑。

然后您可以进入 VCL 源并尝试寻找不支持的内容。

# java - 克隆和减去集合 - 这有效吗？

> ID：394127
> 
> 赞同：3
> 
> 时间：2008-12-26T18:57:40.410
> 
> 标签：java, collections, clone, set, subtraction

```
private HashMap<DataObject, HashSet> AllDataObjects;

...

/** Returns all DataObject elements that are NOT in the specified set. */
private DataObject[] invert( HashSet<DataObject> set )
{
    HashSet<DataObject> keys = (HashSet) AllDataObjects.keySet();
    keys = (HashSet) keys.clone();

    keys.removeAll( set );

    return (DataObject[]) keys.toArray();
} 
```

请注意，我不想`AllDataObjects`通过此过程进行更改。我将一组`AllDataObjects`' 键（这是`DataObject`我希望`set`从中减去参数的 s）转换为 HashSet 以使用克隆，它应该返回一个浅拷贝，然后我可以从中删除`set`而不影响`AllDataObjects`.

你觉得这合适吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-26T19:00:26.723

创建一个新集合并将要克隆的集合作为参数。这避免了强制转换，因此您不会丢失泛型。

```
private DataObject[] invert( Set<DataObject> set ){
    Set<DataObject> keys = new HashSet<DataObject>(AllDataObjects.keySet());
    keys.removeAll( set );
    return keys.toArray(new DataObject[]{});
} 
```

还值得注意的是，您应该使用 Set 而不是 HashSet 作为参数，以免给客户带来过多负担。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T14:18:56.057

知道这些集合是由关系查询填充的，我建议您至少权衡编写更好的 SQL 查询以获得您想要的东西，而不是在内存中执行它。有几个原因。首先，大多数关系数据库都经过优化，可以比您的代码更有效地执行此操作。其次，您要让运行关系数据库的服务器完成它原本打算做的更多工作。第三，如果集合的大小变得很大，您将不得不带回结果，为它们分配内存，然后丢弃不需要的结果，从而给中间层带来不必要的负担。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T14:20:27.457

如果必须，我认为此链接有更好的方法来编写该方法：

[Java：有没有一种简单、快速的方法来对集合进行 AND、OR 或 XOR？](https://stackoverflow.com/questions/393968/java-is-there-an-easy-quick-way-to-and-or-or-xor-together-sets)

# c - 初学者 C 程序员需要指针帮助（我认为）

> ID：394133
> 
> 赞同：3
> 
> 时间：2008-12-26T19:04:00.193
> 
> 标签：c, pointers

我是一名初级程序员，我正在学习我的第一语言 C。

我主要从 Deitel 和 Deitel 的 C How to Program 一书中学习，但也使用来自大学的示例任务和事物，但是我被困在一个。

我对指针有一个非常非常基本的理解 - 在变量前面添加 & 使它打印一个地址，并且 * 使用指针来使用存储在该地址等处的值。

我编写的代码用于计算两个数字的最大（最大？）公分母，实际上根本不需要或涉及指针。它使用两个函数并且逻辑都是正确的，因为如果我从第二个函数执行它，它会在屏幕上打印出正确的答案，而不是将其返回到主函数。这就是问题所在。

当第二个函数返回答案值时，由于某种原因它返回我只能假设是一个指针。我不知道它为什么这样做。我将能够使用它并将其转换为查找值 - 但是它似乎是第二个函数的本地指针并被覆盖。我在网络上或在我的书中找不到任何东西可以让我知道如何解决这个问题。

谢谢你读到这里。我跑题太多了。

这是我的代码和输出。任何帮助或指示（请原谅双关语）将不胜感激。我知道我可以让它在第二个函数中打印，但我更想知道它如何以及为什么它没有像我想要的那样返回值。

**代码**

```
#include <stdio.h>
int greatestCD (int num1, int num2);

int main(void)
{
    int a=0, b=0;
    int result;
    printf("Please enter two numbers to calculate the greatest common denominator from\n");
    scanf("%d%d", &a, &b);
    result = greatestCD (a,b);
    printf("Using the correct in main way:\nThe greatest common denominator of %d and %d is %d\n",a,b, result);
}

int greatestCD (int num1 ,int num2)
{ 

    if (num2==0){
        printf("Using the cheaty in gcd function way:\nThe greatest common denominator is %d\n",num1);
        return num1;
    } else {
        greatestCD(num2,(num1%num2));
    }    
} 
```

**输出（使用 12 和 15 - 答案应该是 3）**

```
C:\Users\Sam\Documents\C programs>gcd
Please enter two numbers to calculate the greatest common denominator from
12
15
Using the cheaty in gcd function way:
The greatest common denominator is 3
Using the correct in main way:
The greatest common denominator of 12 and 15 is 2293524 
```

来自 frankodwyer 的这样一个简单的解决方案。这是我无法发现或不知道的微小事物。那么返回的不是指针而是垃圾？

太感谢了。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-26T19:08:58.343

您在函数 bestCD() 的最后一行缺少“return”语句

```
greatestCD(num2,(num1%num2)); 
```

做了

```
return greatestCD(num2,(num1%num2)); 
```

（你可能还有进一步的调试要做，但这就是为什么它返回垃圾......你没有告诉它还有什么要返回）

编辑：我还建议在将来编译时打开所有编译器警告...如果您使用的是 gcc，请尝试将标志*-Wall*添加到您的编译命令中。当你做的事情可能会导致这样的错误时，这应该会警告你。（并非每个此类警告都必然是错误，因此是“警告”，但它通常表示可能存在问题。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-26T20:55:50.280

由于您正在学习 C，与您的缺失返回错误无关，这里有一些观察和建议：

*   指针是**该语言最难学的特性**，尤其是当你进入`malloc()`and时`free()`。 **不要气馁**。

*   扔掉 Deitel 和 Deitel，**给自己买一份[Kernighan 和 Ritchie](http://cm.bell-labs.com/cm/cs/cbook/)**的副本。这是有史以来最好的语言书籍之一。

*   **始终打开所有警告。** 如果可以使用 MacOS 或 Linux，那就`gcc -Wall -Werror -O`不错了。

*   **[在valgrind](http://valgrind.org/)****下运行每个 C 程序**。Valgrind 是一个很棒的工具，旨在**捕捉您使用指针的方式中的错误**。它会拯救你的培根！

祝你好运！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T19:07:32.123

您不会从函数中返回任何内容，因此值 2293524 只是随机垃圾。你的编译器没有给你一个关于缺少返回值的警告吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-26T22:37:47.767

请参阅[我不应该使用 Herb Schildt Book to Learn From的问题，特别是](https://stackoverflow.com/questions/391091/should-i-not-use-a-herb-schildt-book-to-learn-from#391380)[http://www.cs.technion.ac.il/users/yechiel/CS/BadBooksC+C++.html](http://www.cs.technion.ac.il/users/yechiel/CS/BadBooksC+C++.html)中引用的列表。尽管它列出了 Deitel 和 Deitel 的 C++ 书籍，但特定作者的书籍之间往往存在很强的家族相似性。我倾向于给自己买一本关于 C 的好书。我从 Kernighan & Ritchie 那里学到了（第一版，当时只有一个版本），所以我会推荐它——它简洁准确（就像 C 本身一样）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T19:30:03.183

更奇怪的是，该程序可以在我的 linux 机器上运行。gcc 的错误或功能？

```
/dev/shm $ gcc x.c
/dev/shm $ ./a.out
Please enter two numbers to calculate the greatest common denominator from
12
15
Using the cheaty in gcd function way:
The greatest common denominator is 3
Using the correct in main way:
The greatest common denominator of 12 and 15 is 3
/dev/shm $ gcc --version
gcc (Debian 4.3.2-1) 4.3.2
Copyright (C) 2008 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
```

# ruby - Ruby 中的“猴子补丁”到底是什么意思？

> ID：394144
> 
> 赞同：70
> 
> 时间：2008-12-26T19:12:41.237
> 
> 标签：ruby, terminology, monkeypatching

根据维基百科，[猴子补丁](http://en.wikipedia.org/wiki/Monkey_patch)是：

> 一种在不改变原始源代码的情况下扩展或修改动态语言的运行时代码的方法 [...]。

同一条目中的以下语句使我感到困惑：

> 在 Ruby 中，monkey patch 一词被误解为对类的任何动态修改，并且通常用作在运行时动态修改任何类的同义词。

我想知道**Ruby 中猴子补丁的确切含义。**它是在做类似以下的事情，还是做其他事情？

```
class String
  def foo
    "foo"
  end
end 
```

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2011-08-18T17:41:36.510

我听到的关于**Monkey patching/Duck-punching**的最佳解释是 Patrick Ewing 在[RailsConf 2007](https://web.archive.org/web/20120114085702/http://podcast.rubyonrails.org/programs/1/episodes/railsconf-2007)

> ...如果它像鸭子一样走路和像鸭子一样说话，那它就是鸭子，对吧？因此，如果这只鸭子没有给你想要的噪音，你就必须猛击那只鸭子，直到它返回你所期望的。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2008-12-26T19:58:57.853

简短的回答是没有“确切”的含义，因为它是一个新颖的术语，不同的人使用它的方式也不同。至少可以从维基百科的文章中看出这一点。有些人坚持认为它只适用于“运行时”代码（我想是内置类），而有些人会用它来指代任何类的运行时修改。

就个人而言，我更喜欢更具包容性的定义。毕竟，如果我们只使用修改内置类的术语，我们如何指代所有其他类的运行时修改？对我来说重要的是源代码和实际运行的类之间存在差异。

> 在 Ruby 中，monkey patch 一词被误解为对类的任何动态修改，并且通常用作在运行时动态修改任何类的同义词。

上面的声明断言 Ruby 的使用是不正确的——但是术语会不断发展，这并不总是一件坏事。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-12-26T20:06:09.850

Monkey patching 是在运行时**替换**类的方法（*而不是*像其他人描述的那样添加新方法）。

除了是一种非常不明显且难以调试的方式来更改代码之外，它还不能扩展；随着越来越多的模块开始使用猴子修补方法，更改相互影响的可能性也在增加。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-26T19:34:53.267

这是猴子补丁：

```
class Float
  def self.times(&block)
    self.to_i.times { |i| yield(i) }
    remainder = self - self.to_i
    yield(remainder) if remainder > 0.0
  end
end 
```

现在我想这有时可能很有用，但想象一下如果你看到了例行公事。

```
def my_method(my_special_number)
  sum = 0
  my_special_number.times { |num| sum << some_val ** num }
  sum
end 
```

它只是在被调用时*偶尔*中断。对于那些关注你的人来说你已经知道为什么了，但是想象一下你不知道浮点类型有一个`.times`类方法并且你自动假设它`my_special_number`是一个整数。每次参数是整数、整数或浮点数时，它都可以正常工作（整数被传回，除非有浮点余数）。但是传递一个带有小数区域内任何内容的数字，它肯定会中断！

想象一下，您的 gem、Rails 插件，甚至您自己的项目中的同事，这种情况发生的频率有多高。如果有这样的一两个小方法，可能需要一些时间来查找和纠正。

如果您想知道它为什么会中断，请注意它`sum`是一个整数，并且可以将浮点余数传回；此外，指数符号仅在类型相同时才有效。所以你可能认为它是固定的，因为你将麻烦的数字转换为浮点数......只是发现总和不能取浮点结果。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-26T19:34:58.883

你是对的; 当您修改或扩展现有类而不是对其进行子类化时。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-26T23:31:37.457

在 Python 中，monkeypatching 经常被称为尴尬的标志：“我不得不对这个类进行monkeypatch，因为......”（我在处理 Zope 时第一次遇到它，文章提到了这一点）。过去常说有必要抓住上游类并在运行时修复它，而不是游说在实际类中修复不需要的行为或在子类中修复它们。以我的经验，Ruby 的人很少谈论猴子补丁，因为它并不被认为特别糟糕甚至值得注意（因此是“打鸭子”）。显然，您必须小心更改将在其他依赖项中使用的方法的返回值，但是以 active_support 和 facets 的方式向类添加方法是非常安全的。

**10 年后更新**：我将最后一句修改为“相对安全”。如果其他人有相同的想法并添加具有不同实现或方法签名的相同方法，或者如果人们混淆了核心语言功能的扩展方法，则使用新方法扩展核心库类可能会导致问题。这两种情况都经常发生在 Ruby 中（尤其是关于 active_support 方法）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-01-11T05:45:29.920

# 无代码概念解释：

这意味着您可以“动态地”修改代码。想“动态地”将方法添加到仅在“运行时”已知的特定类中吗？没问题。它很强大，是的：但可能会被滥用。“动态”这个概念可能有点太深奥而难以理解，所以我在下面准备了一个例子（我保证没有代码）：

# 如何猴子修补汽车：

### 正常的汽车操作

你通常如何启动汽车？很简单：你转动点火开关，汽车就启动了！

### 太好了，但是我们如何“猴子补丁”汽车类呢？

这就是[法布里齐奥对可怜的](https://en.wikipedia.org/wiki/Michael_Corleone)[迈克尔柯里昂](https://en.wikipedia.org/wiki/Angelo_Infanti)所做的。通常，如果您想更改汽车的运行方式，则必须在汽车制造厂中进行这些更改（即在“编译”时，在 Car 类 ^** 内）。Fabrizzio 没有时间这样做：他偷偷摸摸地从引擎盖下修补汽车，偷偷地重新布线。换句话说，他重新打开了 Car 类，进行了他想要的更改，然后他就完成了：他只是修补了一辆汽车。他“动态地”做到了这一点。

当你进行猴子补丁时，你必须真正知道自己在做什么，否则结果可能会非常具有爆炸性。

> “<em>法布里齐奥，你要去哪里？”</p>

### 繁荣！

[![周一、周二、周三、周四、周五、周六。 图片是来自 unsplash 的免费和开源的 - https://unsplash.com/photos/dyrehVIidQk](https://i.stack.imgur.com/CrPeh.jpg)](https://i.stack.imgur.com/CrPeh.jpg)

## 正如孔子所说：

> “保持你的源代码接近，但你的猴子补丁更接近。”

这可能很危险。

^** 是的，我知道，动态语言。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-26T19:57:08.917

通常它是指临时更改，使用 Ruby 开放类，通常使用低质量的代码。

对该主题的良好跟进：

[http://www.infoq.com/articles/ruby-open-classes-monkeypatching](http://www.infoq.com/articles/ruby-open-classes-monkeypatching)

# c++ - 显示多态类

> ID：394146
> 
> 赞同：4
> 
> 时间：2008-12-26T19:15:57.440
> 
> 标签：c++, user-interface, separation-of-concerns

我有一个带有命令行界面的现有应用程序，我正在向该应用程序添加 GUI。经常出现的一种情况是我有一个继承自一个类的对象列表，需要在列表中显示，但每个子类的显示方式略有不同。

不想到处都有巨大的 switch 语句使用反射/RTTI 进行显示，每个类都知道如何返回自己的摘要字符串，然后将其显示在列表中：

```
int position = 0;
for (vector<DisplayableObject>::const_iterator iDisp = listToDisplay.begin(); iDisp != listToDisplay.end(); ++iDisp)
    cout << ++position << ". " << iDisp->GetSummary(); 
```

类似的功能可以在不同的上下文中显示不同的信息。在我们需要添加 GUI 之前，这一切都很好。字符串已经不够用了——我需要创建图形控件。

我不想修改每个单独的类以便能够在 GUI 中显示它——特别是因为我们至少希望将它移动到一个 GUI 平台。

是否可以使用某种技术将此 GUI 代码从数据对象中分离出来，而无需使用 RTTI 和 switch 语句？如果能够取出 GetSummary 函数，那就太好了。

理想情况下，我能够有一个显示类的层次结构，可以采用数据类并根据运行时类型而不是编译时类型显示它：

```
shared_ptr<Displayer> displayer = new ConsoleDisplayer(); 
// or new GUIDisplayer()

for (vector<DisplayableObject>::const_iterator iDisp = listToDisplay.begin(); iDisp != listToDisplay.end(); ++iDisp)
    displayer->Display(*iDisp); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-26T19:26:07.530

我认为这不会解决您不需要编写代码的问题，但您应该能够从数据对象中抽象出 GUI 逻辑。

查看访问者模式 ( [http://en.wikipedia.org/wiki/Visitor_pattern](http://en.wikipedia.org/wiki/Visitor_pattern) ) 它将允许您将代码添加到现有对象而不更改对象本身。您还可以根据平台更改访问者。

# asp.net - 从 ASP.NET 页面获取请求变量

> ID：394153
> 
> 赞同：7
> 
> 时间：2008-12-26T19:23:47.330
> 
> 标签：asp.net, vb.net, parameters, request

我编写了以下函数，大约 95% 的时间都可以工作，但我需要它 100%（显然）工作：

```
Public Shared Function getPassedVars() As String   
    Const keyCount As Integer = 54 ' 54 seems to be the number of parameter keys passed by default (for this web_app).
    '                                there are more if there is a form involved (ie. from search page)

    Dim oParams As String = ""
    Try
        With HttpContext.Current
            If .Request.Params.AllKeys.Count > keyCount Then
                For i As Integer = 0 To (.Request.Params.AllKeys.Count - (keyCount + 1))
                    oParams &= String.Format("{0}={1}{2}", .Request.Params.Keys.Item(i), .Request.Params(i), IIf(i < .Request.Params.AllKeys.Count - (keyCount + 1), ";", ""))
                Next
            End If
        End With
        Return oParams
    Catch ex As Exception
        Return Nothing
    End Try
End Function 
```

它清除`Request.Params`对象中传递的变量，这些变量位于数组的开头（其余的是 ASP 参数）。我很确定我已经看到了一种不同的方法来获取这些参数，但我无法弄清楚。有什么建议么？

## 编辑

所以看起来我可以使用`Request.URL.Query`来实现这一点，我将对此进行调查并回复。

这是我想出的：

```
Public Shared Function getPassedVars() As String
    Dim oParams As String = ""
    Dim qString As String = ""
    Dim oSplit As New List(Of String)
    Try
        With HttpContext.Current
            qString = .Request.Url.Query
            If qString.Length > 0 Then 'do we have any passed variables?
                If qString.StartsWith("?") Then qString = qString.Remove(0, 1) 'remove leading ? from querystring if it is there
                oSplit.AddRange(qString.Split("&"))
                For i As Integer = 0 To oSplit.Count - 1
                    oParams &= String.Format("{0}{1}", oSplit.Item(i), IIf(i < oSplit.Count - 1, ";", ""))
                Next
                Return oParams
            Else
                 Return Nothing
            End If
        End With
    Catch ex As Exception
        Return Nothing
    End Try
End Function 
```

到目前为止，一切都很好。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-26T20:21:30.133

Request.QueryString 是一个 NameValueCollection，因此获取“参数”的最简单方法是执行以下操作：

```
 foreach (String s in Request.QueryString) {
        Response.Write(s + " = " + Request.QueryString[s]);
    } 
```

你的函数在哪里？如果它在后面的页面代码中执行，那么您绝对不需要使用 HttpContext 变量。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-26T20:02:45.223

看起来您正在尝试从查询字符串中获取值。

例如，对于这个 URL：-

```
http://www.tempuri.org/mypage.aspx?param1=x&param2=y 
```

我假设您想要检索查询字符串参数 param1 和 param2 的值？

如果是这样，只需使用： -

```
Dim param1 as String = Request.QueryString("param1") 
```

否则，如果这些参数包含在表单（HTTP POST 请求）中，则使用 Mitchel Sellers 建议的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-16T09:36:06.263

```
httpcontext.Current.Request.QueryString("KeyName") 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-26T19:28:42.780

如果您知道名称，则可以使用以下方法通过键值获取它

```
Dim myParamValue as String = Request.Form("MyKeyName") 
```

否则，您可以通过按键等方式遍历表单集合以获取值。关键是，你真的需要解析所有 54 个项目吗？或者您只是在寻找一些特定的值？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T20:11:46.890

Request.Params 将包含您所追求的查询参数。

无需解析 Request.URL 中的信息，因为它已经为您完成了。

# c++ - 确定字符串是否包含实数或整数值的最快方法

> ID：394162
> 
> 赞同：0
> 
> 时间：2008-12-26T19:31:03.197
> 
> 标签：c++, optimization, parsing

我正在尝试编写一个能够确定字符串是否包含实数或整数值的函数。

这是我能想到的最简单的解决方案：

```
int containsStringAnInt(char* strg){
  for (int i =0; i < strlen(strg); i++) {if (strg[i]=='.') return 0;}
  return 1;
} 
```

但是当字符串很长时，这个解决方案真的很慢......有什么优化建议吗？任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-26T19:43:45.543

你的实数的语法是什么？

1e-6 对于文字来说是有效的 C++，但您的测试将作为整数传递。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-26T19:37:22.513

你的字符串有数百个字符长吗？否则，不要关心任何可能的性能问题。唯一的低效率是您以一种糟糕的方式使用 strlen()，这意味着对字符串（在 strlen 内部）进行了大量迭代。对于更简单的解决方案，具有相同的时间复杂度 (O(n))，但可能稍快一些，请使用 strchr()。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T19:44:12.267

您的函数没有考虑实数的指数表示法（1E7、1E-7 都是双精度数）

使用 strtol() 尝试先将字符串转换为整数；它还将返回解析失败的字符串中的第一个位置（如果数字是真实的，这将是 '.'）。如果解析在 '.' 处停止，请使用 strtod() 尝试转换为双精度。同样，该函数将返回解析停止的字符串中的位置。

在您对程序进行概要分析之前，不要担心性能。否则，为了尽可能快的代码，构造一个描述可接受的数字语法的正则表达式，然后先将其手动转换为 FSM，然后再转换为高度优化的代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-26T19:45:57.583

您正在使用 strlen，这意味着您不必担心 unicode。在那种情况下为什么要使用 strlen 或 strchr，只需检查 '\0' (Null char)

```
int containsStringAnInt(char* strg){ 

  for (int i =0;strg[i]!='\0'; i++) {
      if (strg[i]=='.') return 0;}   
  return 1; } 
```

只有一次解析字符串，而不是在循环的每次迭代中解析字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-26T21:46:09.743

所以首先是标准注释，如果还没有分析，请不要太担心性能:)

我不确定手动循环和检查点。两个问题

*   根据语言环境，点实际上也可以是“，”（在德国就是这种情况:)
*   正如其他人指出的那样，像 1e7 这样的数字存在问题

以前我在这里有一个使用 sscanf 的版本。但是测量性能表明，对于更大的数据集，sscanf 的速度要慢得多。所以我将首先展示更快的解决方案（嗯，它也更简单。我在 sscanf 版本中有几个错误，直到我让它工作，而 strto[ld] 版本第一次尝试）：

```
enum {
    REAL,
    INTEGER,
    NEITHER_NOR
};

int what(char const* strg){ 
    char *endp;
    strtol(strg, &endp, 10);
    if(*strg && !*endp)
        return INTEGER;
    strtod(strg, &endp);
    if(*strg && !*endp)
        return REAL;
    return NEITHER_NOR;
} 
```

 [只是为了好玩，这里是使用 sscanf 的版本：]

```
int what(char const* strg) {
    // test for int
    { 
        int d;     // converted value
        int n = 0; // number of chars read
        int rd = std::sscanf(strg, "%d %n", &d, &n);
        if(!strg[n] && rd == 1) {
            return INTEGER;
        }
    }
    // test for double
    { 
        double v;     // converted value
        int n = 0; // number of chars read
        int rd = std::sscanf(strg, "%lf %n", &v, &n);
        if(!strg[n] && rd == 1) {
            return REAL;
        }
    }
    return NEITHER_NOR;
} 
```

我认为这应该有效。玩得开心。

通过在循环中随机转换测试字符串（小字符串）10000000 次来完成测试：

*   6.6 秒`sscanf`
*   1.7s`strto[dl]`
*   0.5s`manual looping`直到 "."

Clear win for `strto[ld]`，考虑到它会正确解析数字，我会称赞它是手动循环的赢家。无论如何，一次转换的 1.2s/10000000 = 0.00000012 差异最终并没有那么多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-26T21:11:45.227

Strlen 遍历字符串以找到字符串的长度。

您在循环的每一次传递中都调用 strlen 。因此，您走线的次数超出了必要的次数。这个微小的变化应该会给你带来巨大的性能提升：

```
int containsStringAnInt(char* strg){
  int len = strlen(strg);
  for (int i =0; i < len; i++) {if (strg[i]=='.') return 0;}
  return 1;
} 
```

请注意，我所做的只是在函数开始时找到字符串的长度，然后在循环中重复引用该值。

请让我们知道这会给您带来什么样的性能改进。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-26T21:19:37.253

@Aaron，你也用你的方式遍历字符串两次。一次在 strlen 中，再一次在 for 循环中。在 for 循环中遍历 ASCII 字符串的最佳方法是在它自己的循环中检查 Null 字符。看看我的答案，它在 for 循环中只解析一次字符串，如果它找到一个 '.' 则可能是部分解析。在结束之前。这样，如果一个字符串像 0.01xxx （另外 100 个字符），你不需要走到最后才能找到长度。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-26T22:21:53.947

```
#include <stdlib.h>
int containsStringAnInt(char* strg){ 
    if (atof(strg) == atoi(strg))
        return 1;
    return 0;
} 
```

# algorithm - 如何最好地总结大量浮点数？

> ID：394174
> 
> 赞同：39
> 
> 时间：2008-12-26T19:40:09.170
> 
> 标签：algorithm, language-agnostic, floating-point, precision

想象一下，您有大量各种大小的浮点数。计算总和的最正确方法是什么，并且误差最小？例如，当数组看起来像这样时：

```
[1.0, 1e-10, 1e-10, ... 1e-10.0] 
```

然后你用一个简单的循环从左到右加起来，比如

```
sum = 0
numbers.each do |val|
    sum += val
end 
```

每当您将较小的数字相加时，可能会低于精度阈值，因此误差会越来越大。据我所知，最好的方法是对数组进行排序并开始从最低到最高的数字相加，但我想知道是否有更好的方法（更快，更精确）？

**编辑**：感谢您的回答，我现在有一个工作代码可以完美地总结 Java 中的双精度值。它是来自获胜答案的 Python 帖子的直接端口。该解决方案通过了我所有的单元测试。（这里有一个更长但经过优化的版本[Summarizer.java](http://github.com/martinus/java-playground/tree/master/src/java/com/ankerl/math/Summarizer.java)）

```
/**
 * Adds up numbers in an array with perfect precision, and in O(n).
 * 
 * @see http://code.activestate.com/recipes/393090/
 */
public class Summarizer {

    /**
     * Perfectly sums up numbers, without rounding errors (if at all possible).
     * 
     * @param values
     *            The values to sum up.
     * @return The sum.
     */
    public static double msum(double... values) {
        List<Double> partials = new ArrayList<Double>();
        for (double x : values) {
            int i = 0;
            for (double y : partials) {
                if (Math.abs(x) < Math.abs(y)) {
                    double tmp = x;
                    x = y;
                    y = tmp;
                }
                double hi = x + y;
                double lo = y - (hi - x);
                if (lo != 0.0) {
                    partials.set(i, lo);
                    ++i;
                }
                x = hi;
            }
            if (i < partials.size()) {
                partials.set(i, x);
                partials.subList(i + 1, partials.size()).clear();
            } else {
                partials.add(x);
            }
        }
        return sum(partials);
    }

    /**
     * Sums up the rest of the partial numbers which cannot be summed up without
     * loss of precision.
     */
    public static double sum(Collection<Double> values) {
        double s = 0.0;
        for (Double d : values) {
            s += d;
        }
        return s;
    }
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-26T19:46:02.060

对于“更精确”：[Python Cookbook 中的这个配方](http://code.activestate.com/recipes/393090/)有求和算法，可以保持完整的精度（通过跟踪小计）。代码是用 Python 编写的，但即使您不了解 Python，它也足以适应任何其他语言。

[本文](http://www-2.cs.cmu.edu/afs/cs/project/quake/public/papers/robust-arithmetic.ps)给出了所有细节。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-27T22:30:56.523

另请参阅：[Kahan 求和算法](http://en.wikipedia.org/wiki/Kahan_summation_algorithm "Kahan求和算法")它不需要 O(n) 存储，而只需要 O(1)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-12-30T14:07:55.103

有很多算法，取决于你想要什么。通常他们需要跟踪部分金额。如果你只保留总和 x[k+1] - x[k]，你会得到 Kahan 算法。如果您跟踪所有部分和（因此产生 O(n^2) 算法），您将得到 @dF 的答案。

请注意，除了您的问题之外，对*不同符号*的数量求和是非常有问题的。

现在，有比跟踪所有部分总和更简单的方法：

*   在求和之前对数字进行排序，将所有负数和正数独立地求和。如果您对数字进行了排序，那很好，否则您有 O(n log n) 算法。通过增加幅度求和。
*   逐对求和，然后成对求和，等等。

个人经验表明，你通常不需要比 Kahan 的方法更花哨的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T21:02:12.267

好吧，如果你不想排序，那么你可以简单地将总数保存在一个比单个值精度更高的变量中（例如，使用双精度来保持浮点数的总和，或者使用“四边形”来保持双打之和）。这会造成性能损失，但可能低于排序成本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T21:09:21.470

如果您的应用程序依赖于数值处理搜索任意精度的算术库，但是我不知道是否有这种 Python 库。当然，这一切都取决于您想要多少精度数字——如果您小心使用它，您可以使用标准 IEEE 浮点获得良好的结果。

# php - 搜索 Kohana 初学者的 PHP 教程

> ID：394175
> 
> 赞同：44
> 
> 时间：2008-12-26T19:40:12.477
> 
> 标签：php, frameworks, kohana

我将尝试第一次使用框架构建一个PHP网站，经过一些研究，我决定尝试使用**[Kohana](http://kohanaframework.org)**

我从他们的网站下载了源代码，然后在我的网络服务器上运行下载的内容，然后收到“欢迎来到 Kohana！”的问候。页面，仅此而已...

我试图在网上找到一些关于这个特定框架的初学者教程，但令我惊讶的是，几乎什么都没找到（*只有[这个](http://lee.hambley.name/kohana-tutorial)，但帮助不大*）

我对 PHP 并不陌生，对 MVC 概念也不是新手，但我对 PHP 框架非常陌生......所以任何人都可以**将我指向网络上某个地方的 Kohana 教程，这将帮助我开始构建我的网站从头开始使用这个框架？**

PS 正如我所说，我想要一个关于这个案例的*初学者教程。*

**[更新]**

我目前正在阅读[官方指南](http://kohanaframework.org/3.3/guide/kohana/install)……我们会看看情况如何。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-21T22:33:46.110

“Kohana 教程”页面是裤子。不是因为他们的内容，而是因为他们有一个非常该死的杂乱无章的 wordpress 博客，而且找到有用的信息并不容易。他们需要的是~~[http://learn.kohanaphp.com](http://learn.kohanaphp.com)~~上的帖子/页面，其中列出了最重要的教程，而不是强迫您浏览整个博客。

无论如何，咆哮，我会从这里开始：

[http://zacklive.com/hello-world-tutorial-for-kohana/15/](http://zacklive.com/hello-world-tutorial-for-kohana/15/)

然后：

~~[http://learn.kohanaphp.com/2008/03/26/blog-tutorial-1/](http://learn.kohanaphp.com/2008/03/26/blog-tutorial-1/)~~

~~[http://learn.kohanaphp.com/2008/03/28/blog-tutorial-part-2/](http://learn.kohanaphp.com/2008/03/28/blog-tutorial-part-2/)~~

其他感兴趣的文章：

[http://www.ninjapenguin.co.uk/blog/2008/06/21/kohana-pagination-tutorial/](http://www.ninjapenguin.co.uk/blog/2008/06/21/kohana-pagination-tutorial/)

~~[http://learn.kohanaphp.com/2008/04/25/using-auto_modeler-to-write-quicker-code/](http://learn.kohanaphp.com/2008/04/25/using-auto_modeler-to-write-quicker-code/)~~

[http://www.ninjapenguin.co.uk/blog/2008/06/29/practical-kohana-hooks-example-phpids/](http://www.ninjapenguin.co.uk/blog/2008/06/29/practical-kohana-hooks-example-phpids/)

~~[http://learn.kohanaphp.com/2008/04/14/5-tips-to-help-you-find-something-youre-looking-for-in-kohana/](http://learn.kohanaphp.com/2008/04/14/5-tips-to-help-you-find-something-youre-looking-for-in-kohana/)~~

当然，还有谷歌。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-07-01T11:59:51.303

我有完全相同的问题！经过几次搜索，我找到了 Kohaha101.pdf。这个指南/教程真的让我开始了！

链接：[ [http://pixelpeter.com/kohana/kohana101.pdf](http://pixelpeter.com/kohana/kohana101.pdf) [1](http://pixelpeter.com/kohana/kohana101.pdf)

祝你好运，享受 Kohana！

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-03-17T08:00:43.803

因为无论如何这都是碰撞的：

如果您正在寻找 Kohana 3 初学者教程，非官方 [Wiki](http://kerkness.ca/wiki/)底部列出的教程非常好。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-18T17:44:44.103

学习Kohana是一种痛苦。那里有一些信息，但到处都是，谷歌是你最好的盟友。支持论坛非常好，但它非常适合 PHP 极客。它解决了 PHP 的所有基本缺陷，并提供了干净的 MVC 设计模式，仅此而已。

这种最小化方法的优点是精简且快速。当事情不起作用时，您会发现需要通过库，因为有时通过查看底层代码更容易理解哪些方法/属性可用或它们如何工作。有人捐赠一些钱并让团队将其注入适当的文档中会很好，因为这是整个项目的致命弱点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-26T21:31:56.167

这是一个链接：[Kohana 教程](http://learn.kohanaphp.com/tutorials/) 但是无论如何 - 只需在 Google 中输入单词：Kohana 教程，您的问题就会得到解答。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-07-03T06:17:25.623

[Kohana Primer](http://www.google.com/notebook/public/15243151709237300427/BDSaoIgoQv5fS67kj)很不错。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-02T23:26:08.043

只是想告诉大家，Kohana 101 已经转移到了 wiki，并且它（并且将会）与 Kohana 框架的当前稳定版本保持同步。

[你可以在这里找到它。](http://dev.kohanaphp.com/wiki/kohana2/Kohana101)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-11-02T13:17:14.457

只需添加到列表中！我不久前写了一篇：http: [//flowdev.tumblr.com/post/1351061705/kohana-tutorial](http://flowdev.tumblr.com/post/1351061705/kohana-tutorial)

我的大部分博客文章都是关于 Kohana 的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-04-10T20:39:36.383

我同意。我想自从从 2.x 过渡到 3.x 后，文档需要改进。无论如何，我梳理了基础知识，并提出了一篇关于如何快速入门的博客文章：

[http://voloreport.com/learn-kohana-mvc-php-in-under-an-hour1](http://voloreport.com/learn-kohana-mvc-php-in-under-an-hour1)

我写的第一部分首先讨论了 MVC 是什么，以及为什么选择 Kohana。在第 2 部分中，我将继续解释如何安装和使用 Kohana。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-07T10:39:09.640

最近是 3.1 - 通过网站使用了一些工具，但我发现了这个 - 希望它可以帮助某人：

[http://kohanaframework.org/3.1/guide/kohana/](http://kohanaframework.org/3.1/guide/kohana/)

更具体的教程： http:
[//kohanaframework.org/3.1/guide/kohana/tutorials](http://kohanaframework.org/3.1/guide/kohana/tutorials)

# visual-studio-2008 - 使用 Visual Studio 2008 部署 Crystal Reports 11

> ID：394176
> 
> 赞同：4
> 
> 时间：2008-12-26T19:40:25.003
> 
> 标签：visual-studio-2008, crystal-reports

我正在使用 Visual Studio 2008 创建一个基于 Web 的报告查看页面。它在本地工作正常，但是当我将它部署到客户端的 Web 服务器时它没有运行，并且它给出了水晶报告 10.5 组件丢失的错误。客户告诉我服务器安装了水晶报表 11。

现在我的问题是，有没有办法可以将程序集版本从 web.config 更改为使用版本 11 的水晶报告？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T02:56:51.953

我们通常只在需要安装应用程序的地方安装 2008 年的 Crystal Reports Redistributable。

它通常可以在 C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\CrystalReports10_5 目录中找到

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T16:52:18.743

有一种方法可以将程序集版本重定向到 CR 11。此链接提供了程序集绑定重定向的完整信息。

[http://msdn.microsoft.com/en-us/library/7wd6ex19.aspx](http://msdn.microsoft.com/en-us/library/7wd6ex19.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T22:02:28.123

我非常可靠地获悉，Crystal 的不同版本被设计为并排放置，以至于如果您针对 10.5（随 VS 2008 一起提供）构建，那么您必须在那里拥有 10.5 二进制文件（可再发行组件应该在`C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages`）。

或者，由于客户端安装了 CR11，您可以将其安装在您的开发盒上，并以此为基础进行构建——此时您会发现他们的并行支持略有失败，并且您所有其他项目都有被升级到 v11。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T02:51:21.107

您是否尝试在项目中重新添加对 Crystal DLL 的引用？Crystal 11 与 VS2008 不*直接*兼容，因此您可能需要手动查找 DLL（尝试 c:\windows\assembly\GAC 和 c:\windows\assembly\GAC_MSIL）。在您的项目更新为使用 11.* DLL 之后，这应该可以在客户端计算机上运行。

FWIW——您现在在项目中引用的 Crystal 10.5 DLL 很可能是 Crystal Basic 2008（.NET 附带的版本）的 DLL。

保证客户端拥有 DLL 的另一个选择是包含 Crystal XIR2 合并模块。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-29T12:27:46.187

Crystal XI 将最适合您。它支持经典的 ASP 和 VB。可能，您甚至不需要太多代码更改。

# sql - 如何根据特定日期查询 SQL Server 表

> ID：394184
> 
> 赞同：0
> 
> 时间：2008-12-26T19:47:33.413
> 
> 标签：sql, sql-server, database

我在 SQL Server 2005 中有一个表，其中包含三列：

```
id (int), 
message (text), 
timestamp (datetime) 
```

时间戳和 id 上有一个索引。

我有兴趣做一个查询来检索给定日期的所有消息，比如“2008 年 12 月 20 日”。但是我知道简单地执行 where timestamp='12/20/2008' 不会给我正确的结果，因为该字段是一个日期时间字段。

有人建议使用 DATEPART 函数并从时间戳中提取年、月和日，并验证它们分别等于 2008、12 和 20。看起来这不会使用我在时间戳上的索引，最终会进行全表扫描。

那么构建查询以利用已创建的索引的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-26T20:28:58.137

根据我的经验，使用两个日期时间变量总是很可靠。该决议的问题似乎极不可能。然而，要记住的重要事实是（任何类型的）范围都包括两个端点。因此，您不能在两个日期上使用 BETWEEN 进行测试，因为它将同时包含这两个日期。而是使用类似的东西

日期字段 >= @startdate AND 日期字段 < @enddate

[手册。](http://msdn.microsoft.com/en-us/library/aa225976.aspx)

来吧，伙计们——这方面的文档并不难找到*。*:D

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-26T19:49:55.937

```
-- avoid re-calculating @MyDate +1 for every row
DECLARE @NextDay DateTime
Set @NextDay = @MyDate + 1

SELECT 
    -- ...
WHERE [timestamp] >= @MyDate AND [timestamp] < @NextDay 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T19:59:10.643

BETWEEN 语句可以帮助您。

```
SELECT *
FROM MyTable
WHERE TimeStamp BETWEEN @Start AND @End; 
```

开始需要像您想要消息的那一天的上午 12:01 一样，而结束的时间应该是同一天结束的晚上 11:59。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T20:30:35.980

BETWEEN 不做 >=, <。它确实 >=, <=，正如这段代码所证明的：

```
declare @low datetime
declare @high datetime
set @low = getdate()
set @high = @low+1

select case when @low between @low and @high then 1 else 0 end, 
    case when @high between @low and @high then 1 else 0 end 
```

结果将是 1,1，表明 = 应用于两个边界。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T01:08:33.547

假设 @Date 是您想要所有消息的那一天的任何日期时间的日期时间值，请使用此

```
Where [timestamp] >= DateAdd(day, DateDiff(day, 0, @Date), 0) 
  And [timestamp] <  DateAdd(day, DateDiff(day, 0, @Date), 1) 
```

这比使用 CAST 快得多，更不用说在日期时间上使用 CAST 时，如果您将中午之后的日期时间值转换为整数，

```
Declare @MyDate as Datetime
Set @MyDate = '12/25/2008 12:01:00'
Declare @IntVal Integer
Set @IntVal = Cast(@MyDate as Integer) 
Select Cast(@IntVal as DateTime) 
```

它将向上四舍五入到表示下一个日期的整数。上面的脚本将输出 12/26/2008

# ruby-on-rails - 更新的 Rails 引擎的来源

> ID：394192
> 
> 赞同：1
> 
> 时间：2008-12-26T19:50:50.240
> 
> 标签：ruby-on-rails

与 rails 2.2.2 一起使用的 Rails 引擎的来源 (url) 是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-27T00:35:28.497

我会从[github](http://github.com/rails/rails/tree/master)获取当前来源并搜索“引擎”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-11-18T20:37:22.600

看起来 Rails 指南直到 Rails 2.3.8 才开始。我找不到低于 Rails 2.3.8 的指南。
[http://guides.rubyonrails.org/v2.3.8](http://guides.rubyonrails.org/v2.3.8)。

此外，Rails 引擎是在 Rails 2.3 中引入的东西，尽管 Rails 2.2 中可能通过插件提供了类似的功能。
[http://railscasts.com/episodes/149-rails-engines?autoplay=false](http://railscasts.com/episodes/149-rails-engines?autoplay=false)

# performance - S3 中每个目录的最大文件数

> ID：394198
> 
> 赞同：91
> 
> 时间：2008-12-26T19:57:15.343
> 
> 标签：performance, file, amazon-s3, limit, directory

如果我有一百万张图像，最好将它们存储在某个文件夹/子文件夹层次结构中，还是直接将它们全部转储到一个存储桶中（没有任何文件夹）？

将所有图像转储到无层次结构的存储桶中会减慢 LIST 操作吗？

动态创建文件夹和子文件夹并设置它们的 ACL（以编程方式）是否有很大的开销？

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2008-12-27T00:34:33.583

S3 不尊重分层命名空间。每个存储桶仅包含许多从键到对象的映射（以及关联的元数据、ACL 等）。

即使您的对象的键可能包含“/”，S3 仍将路径视为纯字符串并将所有对象放在平面名称空间中。

以我的经验，随着对象数量的增加，LIST 操作确实需要（线性）更长的时间，但这可能是 Amazon 服务器上所需的 I/O 增加的症状，并向下连接到您的客户端。

然而，查找时间似乎并没有随着对象数量的增加而增加——它很可能是某种 O(1) 哈希表实现——因此在同一个存储桶中拥有许多对象应该与正常使用的小存储桶一样具有性能（即不是列表）。

至于 ACL，可以在存储桶和每个单独的对象上设置授权。由于没有层次结构，它们是您仅有的两个选择。显然，如果您有数百万个文件，设置尽可能多的存储桶范围授权将大大减少您的管理员头痛，但请记住，您只能**授予**权限，不能撤销它们，因此存储桶范围的授权应该是所有 ACL 的最大子集它的内容。

我建议将其拆分为单独的存储桶：

*   完全不同的内容 - 为图像、声音和其他数据提供单独的存储桶，使架构更加健全
*   显着不同的 ACL - 如果您可以有一个存储桶，每个对象接收一个特定的 ACL，或者两个存储桶具有不同的 ACL 而没有特定于对象的 ACL，请使用这两个存储桶。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2011-03-28T08:24:10.670

对原始问题“S3 中每个目录的最大文件数”的回答是：无限制。另请参阅[S3 对存储桶中对象的限制](https://stackoverflow.com/questions/3980968/s3-limit-to-objects-in-a-bucket)。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-12-26T20:16:43.870

我使用带有根目录的目录结构，然后至少使用一个子目录。我经常使用“文档导入日期”作为根目录下的目录。这可以使管理备份更容易一些。无论您使用什么文件系统，最终都必然会达到文件计数限制（如果不是物理限制的话，这是一个实用的限制）。您也可以考虑支持多个根。

# language-agnostic - 确定经纬度矩形和球体上的圆是否重叠

> ID：394201
> 
> 赞同：8
> 
> 时间：2008-12-26T19:59:09.523
> 
> 标签：language-agnostic, math, geometry, gis, trigonometry

假设我有以下内容：

*   由最小和最大纬度和经度定义的区域（通常是“经纬度矩形”，尽管它实际上不是矩形，除非在某些投影中）。
*   由中心纬度/经度和半径定义的圆

我如何确定：

1.  两个形状是否重叠？
2.  圆是否完全包含在矩形内？

我正在寻找一个完整的公式/算法，而不是数学课，本身。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-26T22:06:17.800

**警告：**如果圆圈/“矩形”跨越球体的大部分，这可能会很棘手，例如：

“矩形”：最小长度 = -90 度，最大长度 = +90 度，最小纬度 = +70 度，最大纬度 = +80 度

circle：center = lat = +85deg, long = +160deg, radius = 20deg（例如，如果 A 点在圆上，C 点是圆心，O 点是球心，那么角度 AOC = 40deg）。

这些相交但数学可能有几个案例来检查相交/包含。以下点位于上述圆上：P1=(+65deg lat,+160deg long), P2=(+75deg lat, -20deg long)。P1 在“矩形”之外，P2 在“矩形”内，因此圆/“矩形”至少相交 2 个点。

**好的，这是我对解决方案的概述：**

* * *

令 C = 半径为 R 的圆心（如上表示为球面角）。C 有纬度 LATC 和经度 LONGC。由于“矩形”这个词在这里有点误导（恒定纬度的线不是大圆的段），我将使用“边界框”这个词。

*   **函数`InsideCircle(P)`返回 +1,0 或 -1：**如果点 P 在圆内，则 +1，如果点 P 在圆上，则返回 0，如果点 P 在圆外，则返回 -1：计算大圆距离 D（表示C 和任何点 P 之间的球角）会告诉你 P 是否在圆内：（`InsideCircle(P) = sign(R-D)`正如 Sente 中的用户 @Die 所提到的，在其他地方的这个论坛上已经询问了大圆距离）

*   定义`PANG(x)`= x 的主角 = MOD(x+180deg, 360deg)-180deg。`PANG(x)`始终介于 -180 度和 +180 度之间（含）（+180 度应映射到 -180 度）。

*   要定义边界框，您需要知道 4 个数字，但经度存在一个小问题。LAT1 和 LAT2 表示边界纬度（假设 LAT1 < LAT2）；那里没有歧义。LONG1 和 LONG2 表示经度区间的边界经度，但这变得很棘手，并且更容易将此区间重写为中心和宽度，其中 LONGM = 该区间的中心，LONGW = 宽度。请注意，经度间隔总是有两种可能性。您必须指定是哪种情况，无论您是包括还是排除 180 度子午线，例如，从 -179 度到 +177 度的最短间隔为 LONGM = +179 度和 LONGW = 4 度，但从 -179 度到 + 的其他间隔177deg 有 LONGM = -1deg 和 LONGW = 356deg。如果你天真地尝试做“常规” 与区间 [-179,177] 进行比较，您最终将使用更大的区间，这可能不是您想要的。顺便说一句，如果以下两个都为真，则具有纬度 LATP 和经度 LONGP 的点 P 位于边界框内：

    *   LAT1 <= LATP 和 LATP <= LAT2 （那部分很明显）
    *   abs(PANG(LONGP-LONGM)) < LONGW/2

如果 PTEST = union(PCORNER,PLAT,PLONG) 中的任何以下点 P 如下所述，则圆与边界框相交，对于 不都返回相同的结果`InsideCircle()`：

*   PCORNER = 边界框的 4 个角
*   *如果*LATC 在 LAT1 和 LAT2 之间，则边界框两侧的点 PLAT（没有或 2 个）与圆的中心共享相同的纬度，在这种情况下，这些点具有纬度 LATC 和经度 LONG1 和 LONG2。
*   边界框两侧的点 PLONG（没有或 2 或 4 个！）与圆心的经度相同。这些点的经度 = LONGC*或**经度*PANG(LONGC-180)。如果 abs(PANG(LONGC-LONGM)) < LONGW/2 则 LONGC 是有效的经度。如果 abs(PANG(LONGC-180-LONGM)) < LONGW/2 则 PANG(LONGC-180) 是有效的经度。这些经度中的一个或两个或都不在边界框的经度区间内。选择具有有效经度和纬度 LAT1 和 LAT2 的点 PLONG。

上面列出的这些点 PLAT 和 PLONG 是边界框上离圆“最近”的点（如果角不是；我在引号中使用“最近”，在纬度/长距离的意义上，而不是大 -圆距离），并涵盖圆的中心位于边界框边界的一侧但圆上的点“潜入”边界框边界的情况。

如果 PTEST 中的所有点 P 返回`InsideCircle(P)`== +1（都在圆内），则圆包含整个边界框。

如果 PTEST 中的所有点 P 返回`InsideCircle(P)`== -1（都在圆外），则圆完全包含在边界框内。

否则，圆与边界框之间至少有一个交点。请注意，这不会计算这些点的位置，尽管如果您在 PTEST 中取任意 2 个点 P1 和 P2，其中 InsideCircle(P1) = -InsideCircle(P2)，那么您可以通过二等分找到一个交点（效率低下）。（如果 InsideCircle(P) 返回 0，那么你就有一个交点，尽管浮点数学中的相等性通常是不可信的。）

可能有一种更有效的方法可以做到这一点，但上述方法应该有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T23:10:08.697

使用[立体投影](http://en.wikipedia.org/wiki/Stereographic_projection#Properties)。所有圆圈（特别是纬度、经度和您的圆圈）都映射到平面中的圆圈（或线）。现在只是一个关于平面几何中的圆和线的问题（更好的是，所有经度都是通过0的线，所有纬度都是围绕0的圆）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T22:55:46.263

这个怎么样？

`v`找到将矩形中心点 连接到圆心的向量`Cr`。找到与矩形相交的`i`点。`v`如果`||i-Cr|| + r > ||v||`那么它们相交。

换句话说，矩形内线段的长度加上圆内线段的长度应该大于总长度（的`v`，中心连接线段）。

寻找点`i`应该是棘手的部分，特别是如果它落在经度边缘，但你应该能够比我更快地想出一些东西。

编辑：此方法无法判断圆是否完全在矩形内。为此，您需要找到从其中心到矩形所有四个边缘的距离。

**编辑：以上不正确。**正如 Federico Ramponi 所建议的那样，在某些情况下，即使在欧几里得几何中它也不起作用。我会发布另一个答案。请不接受这一点，并随时投反对票。我会尽快删除它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T21:17:42.517

*   是的，如果框角包含圆心。
*   是的，如果任何框角在圆心半径内。
*   是的，如果该框包含圆心的经度，并且最接近圆心纬度的框纬度的经度交点在圆心的半径内。
*   是的，如果盒子包含圆心的纬度，并且最短交点轴承上距圆心半径距离的点“超出”最近的盒子经度；其中最短交点方位角是通过找到从圆心到零纬度点的初始方位角和 pi/2“超过”最近的箱形经度的经度来确定的。
*   不，否则。

假设：

*   您可以找到从 A 点到 B 点的最小航向的初始方位。
*   您可以找到两点之间的距离。

第一次检查是微不足道的。第二次检查只需要找到四个距离。第三个检查只需要找到从圆心到（最近框纬度，圆心经度）的距离。

第四次检查需要找到最接近圆心的边界框的经线。然后找到距离圆心最远的经线所在的大圆的中心。找到从圆心到大圆心的初始方位。从该轴承上的圆心找到点圆半径。如果该点位于距离圆心最近的经线的另一侧，则圆和边界框在该侧相交。

在我看来，这应该有一个缺陷，但我一直无法找到它。

The real problem that I can't seem to solve is to find the bounding-box that perfectly contains the circle (for circles that don't contain a pole). The bearing to the latitude min/max appears to be a function of the latitude of circle-center and circle-radius/(sphere circumference/4). Near the equator, it falls to pi/2 (east) or 3*pi/2 (west). As the center approaches the pole and the radius approaches sphere-circumference/4, the bearing approach zero (north) or pi (south).

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-27T20:55:13.793

再试一次...

我认为解决方案是测试一组点，正如 Jason S 所建议的那样，但我不同意他选择的点，我认为这在数学上是错误的。

您需要找到纬度/经度框两侧的点，其中到圆心的距离是局部最小值或最大值。将这些点添加到角集，然后上面的算法应该是正确的。

即，设经度为 x 维，纬度为 y 维，令框的每一侧为参数曲线 P(t) = P0 + t (P1-P0)，对于 o <= t <= 1.0，其中 P0 和P1 是两个相邻的角。

令 f(P) = f(Px, Py) 为距圆心的距离。

那么 f (P0 + t (P1-P0)) 是 t 的距离函数：g(t)。找到距离函数的导数为零的所有点：g'(t) == 0。（当然，丢弃的解决方案超出域 0 <= t <= 1.0）

不幸的是，这需要找到一个超越表达式的零，所以没有封闭形式的解决方案。这类方程只能通过 Newton-Raphson 迭代求解。

好的，我知道你想要的是代码，而不是数学。但数学就是我所拥有的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-31T01:25:48.143

这应该适用于地球上的任何点。如果您想将其更改为不同大小的球体，只需将 kEarchRadiusKms 更改为您想要的球体半径即可。

此方法用于计算纬度和经度点之间的距离。

我从这里得到了这个距离公式：http: [//www.codeproject.com/csharp/distancebetweenlocations.asp](http://www.codeproject.com/csharp/distancebetweenlocations.asp)

```
public static double Calc(double Lat1, double Long1, double Lat2, double Long2)
{
    double dDistance = Double.MinValue;
    double dLat1InRad = Lat1 * (Math.PI / 180.0);
    double dLong1InRad = Long1 * (Math.PI / 180.0);
    double dLat2InRad = Lat2 * (Math.PI / 180.0);
    double dLong2InRad = Long2 * (Math.PI / 180.0);

    double dLongitude = dLong2InRad - dLong1InRad;
    double dLatitude = dLat2InRad - dLat1InRad;

    // Intermediate result a.
    double a = Math.Pow(Math.Sin(dLatitude / 2.0), 2.0) +
               Math.Cos(dLat1InRad) * Math.Cos(dLat2InRad) *
               Math.Pow(Math.Sin(dLongitude / 2.0), 2.0);

    // Intermediate result c (great circle distance in Radians).
    double c = 2.0 * Math.Atan2(Math.Sqrt(a), Math.Sqrt(1.0 - a));

    // Distance.
    // const Double kEarthRadiusMiles = 3956.0;
    const Double kEarthRadiusKms = 6376.5;
    dDistance = kEarthRadiusKms * c;

    return dDistance;
} 
```

如果矩形的任何顶点之间的距离小于圆半径的距离，则圆和矩形重叠。如果圆心和所有顶点之间的距离大于圆的半径，并且所有这些距离都小于矩形的宽度和高度，那么圆应该在矩形的内部。

如果您能找到问题，请随时更正我的代码，因为我确信存在一些我没有想到的情况。

此外，我不确定这是否适用于跨越半球末端的矩形，因为距离方程可能会失效。

```
public string Test(double cLat,
    double cLon,
    double cRadius,
    double rlat1,
    double rlon1,
    double rlat2,
    double rlon2,
    double rlat3,
    double rlon3,
    double rlat4,
    double rlon4)
{
    double d1 = Calc(cLat, cLon, rlat1, rlon1);
    double d2 = Calc(cLat, cLon, rlat2, rlon2);
    double d3 = Calc(cLat, cLon, rlat3, rlon3);
    double d4 = Calc(cLat, cLon, rlat4, rlon4);

    if (d1 <= cRadius ||
        d2 <= cRadius ||
        d3 <= cRadius ||
        d4 <= cRadius)
    {

        return "Circle and Rectangle intersect...";
    }

    double width = Calc(rlat1, rlon1, rlat2, rlon2);
    double height = Calc(rlat1, rlon1, rlat4, rlon4);

    if (d1 >= cRadius &&
        d2 >= cRadius &&
        d3 >= cRadius &&
        d4 >= cRadius &&
        width >= d1 &&
        width >= d2 &&
        width >= d3 &&
        width >= d4 &&
        height >= d1 &&
        height >= d2 &&
        height >= d3 &&
        height >= d4)
    {
        return "Circle is Inside of Rectangle!";
    }

    return "NO!";
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-31T00:26:59.730

有关欧几里得几何的答案，请参阅：[圆矩形碰撞检测（交集）](https://stackoverflow.com/questions/401847/circle-rectangle-collision-detection-intersection)

# php - php/mysql 环境中的“忘记用户密码”标准类或脚本？

> ID：394214
> 
> 赞同：7
> 
> 时间：2008-12-26T20:08:55.507
> 
> 标签：php, mysql, authentication, passwords, reset

我希望有一个标准的类/php 脚本可以用于“忘记密码”功能。似乎几乎每个网站都有一个，我想减少它的开发时间。

似乎一种常见的方法是：

1.  点击忘记密码
2.  用户通过电子邮件收到“重置密码”链接
3.  点击链接允许输入“新密码”“重新输入密码”
4.  生活很好

我不想从头开始做，希望有仔细考虑过任何细微差别的人可以指出我已经存在的代码。这似乎是一个非常标准化的。

全部：得到了一些回应，但我希望也许有人可以推荐一个符合普遍接受的安全准则的非常标准的类或 CMS。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-26T21:25:31.063

我使用自己的脚本进行密码重置。

我创建了一个表来存储 user_id、随机密钥和密码重置启动的时间：

```
// query is my own SQLite3 wrapper function which ensures I have a valid database connection then executes the SQL.
// I would imagine small changes will be needed to the SQL for MY SQL.
query("create table reset_password (user_id integer not null default 0, key text not null default '', time integer not null default 0)");
query("create unique index reset_password_user_id on reset_password (user_id)");
query("create index reset_password_key on reset_password (key)"); 
```

然后当需要重置密码时，调用如下代码：

```
// $user_id must be an integer that matches a valid user's ID.
function reset_password($user_id) {
  query("delete from reset_password where user_id = $user_id");
  $key = substr(base64_encode(crypt('', '')), 0, 32);
  query("insert into reset_password values ($user_id, '$key', " . time() . ")");
  // fetch is my own wrapper function to fetch a row from the query.
  $f = fetch(query("select username from users where id = $user_id"));
  // smtp is my own function, you will probably want to use the php mail function.
  smtp(
    "do-not-reply@example.com", // sender
    $f['username'], // recepient
    "From: The example.com Web Site <do-not-reply@example.com>\r\n" . // email headers
    "To: {$f['username']} <{$f['username']}>\r\n" . // actual email address <put a nice friendly name in here if you have the the information>
    'Subject: Reset Password' . "\r\n" .
    "\r\n" .
    "Hello\r\n" . // email body
    "\r\n" .
    "A request has been made to reset your example.com web site password.\r\n" .
    "\r\n" .
    "To complete the request, click on the following link within 48 hours of the transmision of this email and follow the on screen instructions.\r\n" .
    "\r\n" .
    /// URL is defined as the root of the URL used in the email, in this example it would be "http://example.com/"
    URL . "index.php?page=reset-password&user_id=" . urlencode($user_id) . "&key=" . urlencode($key) . "\r\n" .
    "\r\n" .
    "Kind regards,\r\n" .
    "\r\n" .
    "The example.com Web Site"
  );
} 
```

单击电子邮件中的链接时，将显示一个页面，其中包含以下内容：

```
// form, input_hidden, table, tr, td, label, input_password and input_submit are my own wrappers which return the appropriate HTML with escaped values where required.
echo
  form('reset-password/ok',
    input_hidden('user_id', $_GET['user_id']) .
    input_hidden('key', $_GET['key']) .
    table(
      tr(
        td(label('New Password')) .
        td(input_password('new_password', ''))
      ) .
      tr(
        td(label('Confirm Password')) .
        td(input_password('confirm_password', ''))
      )
    ) .
    input_submit('ok', 'OK')
  ); 
```

当上面的表单提交后，执行如下：

```
// The reset_password_message function displays the message to the user.
if (!isset($_POST['user_id'])) {
  reset_password_message('You must enter a user ID. Please try again.');
} else if (!isset($_POST['key'])) {
  reset_password_message('You must enter a key. Please try again.');
} else if (!isset($_POST['new_password']) || !$_POST['new_password']) {
  reset_password_message('You must enter a new password. Please try again');
} else if (!isset($_POST['confirm_password']) || $_POST['new_password'] != $_POST['confirm_password']) {
  reset_password_message('The new password and the confirmation do not match. Please try again.');
} else if (!$f = fetch(query("select time from reset_password where user_id = " . (integer)$_POST['user_id'] . " and key = '" . escape($_POST['key']) . "'"))) {
  reset_password_message('The user ID and key pair are invalid. Please try again.');
} else if ($f['time'] < time() - 60 * 60 * 24 * 2) { // 60 seconds * 60 minutes * 24 hours * 2 days (48 hours as explained in the email sent to the user above).
  reset_password_message('The user ID and key pair have expired. Please try again.');
} else {
  query("update users set password = '" . crypt($_POST['new_password']) . "' where id = " . (integer)$_POST['user_id']);
  reset_password_message('Your password has been reset. Please login.');
} 
```

欢迎您使用此代码而不是“滚动您自己的代码”，但您需要进行一些更改或添加一些功能以使其完整。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T20:26:06.503

您可以从各种框架/CMS 中窃取它。Drupal、Kohana 等...

# java - 您如何决定何时升级项目中的库？

> ID：394223
> 
> 赞同：6
> 
> 时间：2008-12-26T20:20:52.833
> 
> 标签：java, versioning

我从事一个使用多个开源 Java 库的项目。当这些库的升级出现时，我们倾向于遵循保守的策略：

1.  如果它没有坏，不要修理它
2.  如果它没有我们想要的新功能，请忽略它

我们遵循这个策略是因为我们通常没有时间放入新库并彻底测试整个应用程序。（就像许多软件开发团队一样，我们几个月前承诺的功能总是落后于计划。）

但是，我有时想知道这种策略是否明智，因为库升级通常会带来一些性能改进和大量错误修复。（即“谁知道呢，也许事情会以我们无法预见的方式更好地工作......”）

当您在项目中做出这些类型的决策时，您使用什么标准？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-26T20:35:17.030

重要提示：避免[技术债务](http://en.wikipedia.org/wiki/Technical_debt)。

“如果它没有损坏，就不要升级”是一项疯狂的政策，它会导致软件如此损坏，以至于没有人可以修复它。

轻率、未经测试的更改是一个坏主意，但不如累积技术债务那么糟糕，因为它在短期内看起来更便宜。

获得一个“夜间构建”过程，这样您就可以持续测试所有更改——您的以及您所依赖的包。

在您拥有持续集成流程之前，您可以按季度发布主要版本，其中包括基础架构升级。

避免技术债务。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-26T20:27:39.357

我已经学到了足够的教训来做以下事情：

1.  检查库的更改列表。他们修复了什么？我关心的？如果没有更改列表，那么我的项目中不会使用该库。
2.  人们在图书馆论坛上发布什么？发布后不久是否有大量帖子指出明显的问题？
3.  与第 2 条相同，不要立即升级。每个人都有一个糟糕的版本。我不打算成为第一个被那个小虫子咬伤的人。（不再是）。这也不意味着等待 6 个月。在发布的第一个月内，您应该知道缺点。
4.  当我决定继续升级时；测试，测试测试。这里自动化测试非常重要。

**编辑：**我想再添加一个至少同样重要的项目，也许比其他项目更重要。

*   此版本中引入了哪些重大更改？换句话说，图书馆是否朝着不同的方向发展？如果库正在弃用或替换功能，您将希望保持领先。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T21:46:45.013

一种方法是将您使用的开源库置于您自己的源代码控制之下。然后定期将上游更改合并到您的下一个发布分支中，或者如果它们是安全修复，则更快地合并，并运行您的自动化测试。

换句话说，使用与内部编写的代码发布周期相同的标准来决定是否使用上游更改。将开源开发人员视为您的虚拟开发团队的一部分。无论如何，情况确实如此，这只是您是否选择将其视为您的开发实践的一部分的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-26T22:05:42.917

虽然您不想仅仅因为有新版本而升级，但还有另一个考虑因素，那就是旧版本的可用性。我在尝试构建开源项目时遇到了这个问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-26T22:09:20.133

我通常认为忽略库的新版本（因为它没有任何有趣的功能或改进）是一个错误，因为有一天你会发现这个版本对于迁移到下一个版本是必要的你可能想升级到。

所以我的建议是仔细检查新版本中的变化，并考虑这些变化是否需要大量测试，或者很少。

如果需要进行大量测试，最好在软件的下一个版本（主要版本）（例如从 v8.0 迁移到 v8.5 时）升级到较新的库。发生这种情况时，我想还有其他重大修改，因此进行了大量测试。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-27T06:25:58.867

我不想让版本在依赖库上落后太多。除非已知安全或性能问题，否则大多数库最多可以使用一年。 **有已知安全问题的库是刷新的必备。**

我会定期下载每个库的最新版本并使用它们运行我的应用程序单元测试。如果它们通过了，我会在我们的开发和集成环境中使用它们一段时间，并在我满意它们不糟糕时推动 QA。

上述过程假设 API 没有显着变化。如果我需要重构现有代码只是为了使用更新的库版本，那么所有的赌注都没有了。（例如 Axis 1x vs. 2x）然后我需要让管理层参与来做出分配资源的决定。在计划对遗留代码进行重大修订之前，这种更改通常会有所不同。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-26T20:35:51.460

一些重要的问题：

*   图书馆的使用范围有多广？（如果被广泛使用，将更快地发现和消除错误）
*   它发展得有多活跃？
*   文档是否非常清楚？
*   是否有重大变化、次要变化或只是内部变化？
*   升级是否会破坏向后兼容性？（您是否必须更改任何代码？）

除非按照上述标准升级看起来很糟糕，否则最好继续使用它，如果您有任何问题，请恢复到旧版本。

# opengl - 笔记本电脑关闭屏幕时关闭屏幕渲染？

> ID：394227
> 
> 赞同：11
> 
> 时间：2008-12-26T20:25:57.627
> 
> 标签：opengl, sleep, gpu, power-management, video-card

我有一个冗长的数字运算过程，它利用了相当多的 OpenGL 离屏渲染。这一切都很好，但是当我在做三明治的时候让它自己工作时，我通常会发现它在我不在的时候崩溃了。
我能够确定崩溃发生的时间非常接近我正在使用的笔记本电脑决定关闭屏幕以节省能源。崩溃本身就在 NVIDIA dll 中，所以没有希望知道发生了什么。

显而易见的解决方案是关闭关闭屏幕和视频卡的电源管理功能，但我正在寻找更用户友好的东西。有没有办法以编程方式做到这一点？
我知道有一个利用 GPU 处理的 SETI@home 实现。它如何防止视频卡进入睡眠状态？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-26T20:35:50.617

我不确定您使用的是什么操作系统，但[Windows 会发送一条消息](http://msdn.microsoft.com/en-us/library/aa373247.aspx)，表明它即将进入新的电源状态。您可以对此进行侦听，然后开始在 CPU 上进行处理或拒绝进入低功耗状态的请求。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-26T21:20:49.140

为了让遇到类似问题的 Linux 用户受益，我想补充一点，您可以使用[DBUS API](http://people.freedesktop.org/~hughsient/temp/dbus-interface.html)获得类似的通知并禁止电源状态更改。Python 中的示例脚本，取自链接，用于禁止电源状态更改：

```
#!/usr/bin/python
import dbus
import time
bus = dbus.Bus(dbus.Bus.TYPE_SESSION)
devobj = bus.get_object('org.freedesktop.PowerManagement', 
                        '/org/freedesktop/PowerManagement')
dev = dbus.Interface (devobj, "org.freedesktop.PowerManagement.Inhibit")
cookie = dev.Inhibit('Nautilus', 'Copying files from /media/SANVOL')
time.sleep(10)
dev.UnInhibit(cookie) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-02T13:07:56.503

根据 MSDN，有一个 API 允许应用程序告诉 Windows 它仍在工作，并且 Windows 不应该进入睡眠状态或关闭显示。

该函数称为`SetThreadExecutionState`( [MSDN](http://msdn.microsoft.com/en-us/library/aa373208(VS.85).aspx) )。它对我有用，使用标志`ES_SYSTEM_REQUIRED`和`ES_CONTINUOUS`.

但是请注意，使用此功能不会停止屏幕保护程序的运行，如果屏幕保护程序也使用 OpenGL（或 Direct3D），这可能会干扰您的 OpenGL 应用程序。

# bash - 如何从 Bash 脚本中检测操作系统？

> ID：394230
> 
> 赞同：696
> 
> 时间：2008-12-26T20:27:35.313
> 
> 标签：bash, os-detection

我想将我的`.bashrc`和`.bash_login`文件保存在版本控制中，以便我可以在我使用的所有计算机之间使用它们。问题是我有一些特定于操作系统的别名，所以我正在寻找一种方法来确定脚本是否在 Mac OS X、Linux 或[Cygwin](http://en.wikipedia.org/wiki/Cygwin)上运行。

[在Bash](http://en.wikipedia.org/wiki/Bash_%28Unix_shell%29)脚本中检测操作系统的正确方法是什么？

* * *

## 回答 #1

> 赞同：762
> 
> 时间：2011-12-21T22:46:47.777

我认为以下应该有效。我不确定`win32`。

```
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        # ...
elif [[ "$OSTYPE" == "darwin"* ]]; then
        # Mac OSX
elif [[ "$OSTYPE" == "cygwin" ]]; then
        # POSIX compatibility layer and Linux environment emulation for Windows
elif [[ "$OSTYPE" == "msys" ]]; then
        # Lightweight shell and GNU utilities compiled for Windows (part of MinGW)
elif [[ "$OSTYPE" == "win32" ]]; then
        # I'm not sure this can happen.
elif [[ "$OSTYPE" == "freebsd"* ]]; then
        # ...
else
        # Unknown.
fi 
```

* * *

## 回答 #2

> 赞同：307
> 
> 时间：2008-12-26T20:36:15.140

对于我的 .bashrc，我使用以下代码：

```
platform='unknown'
unamestr=$(uname)
if [[ "$unamestr" == 'Linux' ]]; then
   platform='linux'
elif [[ "$unamestr" == 'FreeBSD' ]]; then
   platform='freebsd'
fi 
```

然后我做类似的事情：

```
if [[ $platform == 'linux' ]]; then
   alias ls='ls --color=auto'
elif [[ $platform == 'freebsd' ]]; then
   alias ls='ls -G'
fi 
```

这很丑陋，但它有效。如果您愿意，可以使用`case`而不是。`if`

* * *

## 回答 #3

> 赞同：291
> 
> 时间：2008-12-26T20:31:39.317

[bash 手册页](https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html)说变量 OSTYPE 存储操作系统的名称：

> `OSTYPE`自动设置为描述执行 bash 的操作系统的字符串。默认值取决于系统。

它设置在`linux-gnu`这里。

* * *

## 回答 #4

> 赞同：226
> 
> 时间：2013-08-25T23:43:01.260

### `$OSTYPE`

您可以简单地使用预定义的`$OSTYPE`变量，例如：

```
case "$OSTYPE" in
  solaris*) echo "SOLARIS" ;;
  darwin*)  echo "OSX" ;; 
  linux*)   echo "LINUX" ;;
  bsd*)     echo "BSD" ;;
  msys*)    echo "WINDOWS" ;;
  cygwin*)  echo "ALSO WINDOWS" ;;
  *)        echo "unknown: $OSTYPE" ;;
esac 
```

但是，较旧的 shell （例如[*Bourne shell*](https://en.wikipedia.org/wiki/Bourne_shell) [）无法识别](https://stackoverflow.com/q/23424783/55075)它。[](https://en.wikipedia.org/wiki/Bourne_shell)

 ** * *

### [`uname`](https://linux.die.net/man/1/uname)

另一种方法是基于`uname`命令检测平台。

请参阅以下脚本（准备包含在 .bashrc 中）：

```
# Detect the platform (similar to $OSTYPE)
OS="`uname`"
case $OS in
  'Linux')
    OS='Linux'
    alias ls='ls --color=auto'
    ;;
  'FreeBSD')
    OS='FreeBSD'
    alias ls='ls -G'
    ;;
  'WindowsNT')
    OS='Windows'
    ;;
  'Darwin') 
    OS='Mac'
    ;;
  'SunOS')
    OS='Solaris'
    ;;
  'AIX') ;;
  *) ;;
esac 
```

[你可以在我的`.bashrc`](https://github.com/kenorb/dotfiles).

* * *

[这是Travis CI](https://github.com/travis-ci/travis-build/blob/061cd364c38a07c8908b420b9dd134d86b537b01/lib/travis/build/bash/travis_setup_env.bash)上使用的类似版本：

```
case $(uname | tr '[:upper:]' '[:lower:]') in
  linux*)
    export TRAVIS_OS_NAME=linux
    ;;
  darwin*)
    export TRAVIS_OS_NAME=osx
    ;;
  msys*)
    export TRAVIS_OS_NAME=windows
    ;;
  *)
    export TRAVIS_OS_NAME=notset
    ;;
esac 
```

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2008-12-26T21:07:13.707

检测**操作系统和 CPU 类型**并不是那么容易*携带*。我有一个`sh`大约 100 行的脚本，适用于各种 Unix 平台：我自 1988 年以来使用的任何系统。

关键要素是

*   `uname -p`是**处理器类型**，但通常`unknown`在现代 Unix 平台上。

*   `uname -m`将在某些 Unix 系统上给出“机器硬件名称”。

*   `/bin/arch`，如果存在，通常会给出处理器的类型。

*   `uname`不带参数将命名操作系统。

最终，您将不得不考虑平台之间的区别以及**您希望将它们做得多好。** 例如，为了简单起见，我将`i386`through `i686`、 any " `Pentium*`" 和 any " `AMD*Athlon*`" all 视为`x86`。

我`~/.profile`在启动时运行一个脚本，它将一个变量设置为一个字符串，指示 CPU 和操作系统的组合。我有平台特定的`bin`, `man`, `lib`, 和`include`基于此设置的目录。然后我设置了一大堆环境变量。因此，例如，重新格式化邮件的 shell 脚本可以调用，例如，`$LIB/mailfmt`它是特定于平台的可执行二进制文件。

**如果你想偷工减料**，`uname -m`plain`uname`会在很多平台上告诉你你想知道的。需要时添加其他内容。（并且使用`case`，而不是嵌套`if`！）

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2010-09-25T07:00:11.757

我建议使用这个完整的 bash 代码

```
lowercase(){
    echo "$1" | sed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/"
}

OS=`lowercase \`uname\``
KERNEL=`uname -r`
MACH=`uname -m`

if [ "{$OS}" == "windowsnt" ]; then
    OS=windows
elif [ "{$OS}" == "darwin" ]; then
    OS=mac
else
    OS=`uname`
    if [ "${OS}" = "SunOS" ] ; then
        OS=Solaris
        ARCH=`uname -p`
        OSSTR="${OS} ${REV}(${ARCH} `uname -v`)"
    elif [ "${OS}" = "AIX" ] ; then
        OSSTR="${OS} `oslevel` (`oslevel -r`)"
    elif [ "${OS}" = "Linux" ] ; then
        if [ -f /etc/redhat-release ] ; then
            DistroBasedOn='RedHat'
            DIST=`cat /etc/redhat-release |sed s/\ release.*//`
            PSUEDONAME=`cat /etc/redhat-release | sed s/.*\(// | sed s/\)//`
            REV=`cat /etc/redhat-release | sed s/.*release\ // | sed s/\ .*//`
        elif [ -f /etc/SuSE-release ] ; then
            DistroBasedOn='SuSe'
            PSUEDONAME=`cat /etc/SuSE-release | tr "\n" ' '| sed s/VERSION.*//`
            REV=`cat /etc/SuSE-release | tr "\n" ' ' | sed s/.*=\ //`
        elif [ -f /etc/mandrake-release ] ; then
            DistroBasedOn='Mandrake'
            PSUEDONAME=`cat /etc/mandrake-release | sed s/.*\(// | sed s/\)//`
            REV=`cat /etc/mandrake-release | sed s/.*release\ // | sed s/\ .*//`
        elif [ -f /etc/debian_version ] ; then
            DistroBasedOn='Debian'
            DIST=`cat /etc/lsb-release | grep '^DISTRIB_ID' | awk -F=  '{ print $2 }'`
            PSUEDONAME=`cat /etc/lsb-release | grep '^DISTRIB_CODENAME' | awk -F=  '{ print $2 }'`
            REV=`cat /etc/lsb-release | grep '^DISTRIB_RELEASE' | awk -F=  '{ print $2 }'`
        fi
        if [ -f /etc/UnitedLinux-release ] ; then
            DIST="${DIST}[`cat /etc/UnitedLinux-release | tr "\n" ' ' | sed s/VERSION.*//`]"
        fi
        OS=`lowercase $OS`
        DistroBasedOn=`lowercase $DistroBasedOn`
        readonly OS
        readonly DIST
        readonly DistroBasedOn
        readonly PSUEDONAME
        readonly REV
        readonly KERNEL
        readonly MACH
    fi

fi
echo $OS
echo $KERNEL
echo $MACH 
```

更多示例：[https ://github.com/coto/server-easy-install/blob/master/lib/core.sh](https://github.com/coto/server-easy-install/blob/master/lib/core.sh)

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2012-05-03T21:59:43.050

我建议避免其中一些答案。不要忘记您可以选择其他形式的字符串比较，这将清除大多数变体或提供的丑陋代码。

一种这样的解决方案是简单的检查，例如：

`if [[ "$OSTYPE" =~ ^darwin ]]; then`

尽管它是版本后缀，但它具有匹配任何版本的达尔文的额外好处。这也适用于`Linux`人们可能期望的任何变化。

您可以在我的 dotfiles 中看到一些其他[示例](https://github.com/akiva/dotfiles)

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-12-26T20:33:03.493

尝试使用“uname”。例如，在 Linux 中：“uname -a”。

根据手册页，uname 符合 SVr4 和 POSIX，因此它应该也可以在 Mac OS X 和[Cygwin](http://en.wikipedia.org/wiki/Cygwin)上使用，但我无法确认。

顺便说一句：$OSTYPE 也设置在`linux-gnu`这里 :)

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2009-01-14T11:24:37.300

在 bash 中，使用`$OSTYPE`and `$HOSTTYPE`，如文档所述；这就是我所做的。如果这还不够，并且 even `uname`or `uname -a`（或其他适当的选项）没有提供足够的信息，那么GNU 项目中总会有专门为此目的而制作的[config.guess脚本。](http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob;f=config.guess;hb=HEAD)

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2015-03-24T17:52:36.047

我把这些糖写在我的`.bashrc`：

```
if_os () { [[ $OSTYPE == *$1* ]]; }
if_nix () { 
    case "$OSTYPE" in
        *linux*|*hurd*|*msys*|*cygwin*|*sua*|*interix*) sys="gnu";;
        *bsd*|*darwin*) sys="bsd";;
        *sunos*|*solaris*|*indiana*|*illumos*|*smartos*) sys="sun";;
    esac
    [[ "${sys}" == "$1" ]];
} 
```

所以我可以做这样的事情：

```
if_nix gnu && alias ls='ls --color=auto' && export LS_COLORS="..."
if_nix bsd && export CLICOLORS=on && export LSCOLORS="..."
if_os linux && alias psg="ps -FA | grep" #alternative to pgrep
if_nix bsd && alias psg="ps -alwx | grep -i" #alternative to pgrep
if_os darwin && alias finder="open -R" 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2008-12-26T20:33:45.363

```
uname 
```

或者

```
uname -a 
```

如果您想了解更多信息

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2009-03-12T19:15:28.040

我编写[了一个个人 Bash 库和脚本框架](http://www.gnu.org/software/shtool/)，它使用[GNU shtool](http://www.gnu.org/software/shtool/)来进行相当准确的平台检测。

GNU shtool 是一组非常便携的脚本，其中包含“shtool platform”命令等有用的东西。这是输出：

```
shtool platform -v -F "%sc (%ac) %st (%at) %sp (%ap)" 
```

在几台不同的机器上：

```
Mac OS X Leopard: 
    4.4BSD/Mach3.0 (iX86) Apple Darwin 9.6.0 (i386) Apple Mac OS X 10.5.6 (iX86)

Ubuntu Jaunty server:
    LSB (iX86) GNU/Linux 2.9/2.6 (i686) Ubuntu 9.04 (iX86)

Debian Lenny:
    LSB (iX86) GNU/Linux 2.7/2.6 (i686) Debian GNU/Linux 5.0 (iX86) 
```

如您所见，这会产生非常令人满意的结果。GNU shtool 有点慢，所以我实际上在我的脚本调用的系统上的一个文件中存储和更新平台标识。这是我的框架，所以对我有用，但你的里程可能会有所不同。

现在，您必须找到一种方法将 shtool 与您的脚本打包在一起，但这并不是一项艰巨的练习。您也可以随时使用 uname 输出。

编辑：

我错过了泰迪关于`config.guess`（不知何故）的帖子。这些是非常相似的脚本，但并不相同。我个人也将 shtool 用于其他用途，它对我来说效果很好。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2017-01-20T12:36:45.650

下面是一种使用***/etc/lsb-release***和***/etc/os-release***（取决于您使用的 Linux 风格）检测基于 Debian 和 RedHat 的**Linux 操作系统并基于它采取简单操作的方法。**

 **```
#!/bin/bash
set -e

YUM_PACKAGE_NAME="python python-devl python-pip openssl-devel"
DEB_PACKAGE_NAME="python2.7 python-dev python-pip libssl-dev"

 if cat /etc/*release | grep ^NAME | grep CentOS; then
    echo "==============================================="
    echo "Installing packages $YUM_PACKAGE_NAME on CentOS"
    echo "==============================================="
    yum install -y $YUM_PACKAGE_NAME
 elif cat /etc/*release | grep ^NAME | grep Red; then
    echo "==============================================="
    echo "Installing packages $YUM_PACKAGE_NAME on RedHat"
    echo "==============================================="
    yum install -y $YUM_PACKAGE_NAME
 elif cat /etc/*release | grep ^NAME | grep Fedora; then
    echo "================================================"
    echo "Installing packages $YUM_PACKAGE_NAME on Fedorea"
    echo "================================================"
    yum install -y $YUM_PACKAGE_NAME
 elif cat /etc/*release | grep ^NAME | grep Ubuntu; then
    echo "==============================================="
    echo "Installing packages $DEB_PACKAGE_NAME on Ubuntu"
    echo "==============================================="
    apt-get update
    apt-get install -y $DEB_PACKAGE_NAME
 elif cat /etc/*release | grep ^NAME | grep Debian ; then
    echo "==============================================="
    echo "Installing packages $DEB_PACKAGE_NAME on Debian"
    echo "==============================================="
    apt-get update
    apt-get install -y $DEB_PACKAGE_NAME
 elif cat /etc/*release | grep ^NAME | grep Mint ; then
    echo "============================================="
    echo "Installing packages $DEB_PACKAGE_NAME on Mint"
    echo "============================================="
    apt-get update
    apt-get install -y $DEB_PACKAGE_NAME
 elif cat /etc/*release | grep ^NAME | grep Knoppix ; then
    echo "================================================="
    echo "Installing packages $DEB_PACKAGE_NAME on Kanoppix"
    echo "================================================="
    apt-get update
    apt-get install -y $DEB_PACKAGE_NAME
 else
    echo "OS NOT DETECTED, couldn't install package $PACKAGE"
    exit 1;
 fi

exit 0 
```

****Ubuntu Linux**的**输出示例：****

 ****```
delivery@delivery-E5450$ sudo sh detect_os.sh
[sudo] password for delivery: 
NAME="Ubuntu"
===============================================
Installing packages python2.7 python-dev python-pip libssl-dev on Ubuntu
===============================================
Ign http://dl.google.com stable InRelease
Get:1 http://dl.google.com stable Release.gpg [916 B]                          
Get:2 http://dl.google.com stable Release [1.189 B] 
... 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2017-11-23T11:42:13.080

您可以使用以下内容：

```
OS=$(uname -s) 
```

然后您可以在脚本中使用 OS 变量。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2014-08-21T01:10:35.450

这应该可以安全地用于所有发行版。

```
$ cat /etc/*release 
```

这会产生类似的东西。

```
 DISTRIB_ID=LinuxMint
     DISTRIB_RELEASE=17
     DISTRIB_CODENAME=qiana
     DISTRIB_DESCRIPTION="Linux Mint 17 Qiana"
     NAME="Ubuntu"
     VERSION="14.04.1 LTS, Trusty Tahr"
     ID=ubuntu
     ID_LIKE=debian
     PRETTY_NAME="Ubuntu 14.04.1 LTS"
     VERSION_ID="14.04"
     HOME_URL="http://www.ubuntu.com/"
     SUPPORT_URL="http://help.ubuntu.com/"
     BUG_REPORT_URL="http://bugs.launchpad.net/ubuntu/" 
```

根据需要提取/分配给变量

注意：在某些设置上。这也可能会给您一些可以忽略的错误。

```
 cat: /etc/upstream-release: Is a directory 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2018-11-08T10:04:54.513

试试这个：

```
DISTRO=$(cat /etc/*-release | grep -w NAME | cut -d= -f2 | tr -d '"')
echo "Determined platform: $DISTRO" 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2016-02-27T21:12:16.620

您可以使用以下 if 子句并根据需要对其进行扩展：

```
if [ "${OSTYPE//[0-9.]/}" == "darwin" ]
then
    aminute_ago="-v-1M"
elif  [ "${OSTYPE//[0-9.]/}" == "linux-gnu" ]
then
    aminute_ago="-d \"1 minute ago\""
fi 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2015-01-15T17:36:42.927

我倾向于将我的 .bashrc 和 .bash_alias 保存在所有平台都可以访问的文件共享上。这就是我在 .bash_alias 中解决问题的方法：

```
if [[ -f (name of share)/.bash_alias_$(uname) ]]; then
    . (name of share)/.bash_alias_$(uname)
fi 
```

例如，我有一个 .bash_alias_Linux ：

```
alias ls='ls --color=auto' 
```

这样我就可以将特定于平台的代码和可移植代码分开，你可以对 .bashrc 做同样的事情

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2017-03-08T16:25:00.430

我在几个 Linux 发行版中尝试了上述消息，发现以下消息最适合我。这是一个简短而准确的单词答案，也适用于 Windows 上的 Bash。

```
OS=$(cat /etc/*release | grep ^NAME | tr -d 'NAME="') #$ echo $OS # Ubuntu 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2018-10-02T19:12:04.877

这会检查一堆`known`文件以识别 linux 发行版是 Debian 还是 Ubunu，然后它默认为`$OSTYPE`变量。

```
os='Unknown'
unamestr="${OSTYPE//[0-9.]/}"
os=$( compgen -G "/etc/*release" > /dev/null  && cat /etc/*release | grep ^NAME | tr -d 'NAME="'  ||  echo "$unamestr")

echo "$os" 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-08-09T02:47:43.660

如果有人也对检测 WSL 与 WSL 版本 2 感兴趣，这就是我使用的。

```
#!/usr/bin/env bash

unameOut=$(uname -a)
case "${unameOut}" in
    *Microsoft*)     OS="WSL";; #must be first since Windows subsystem for linux will have Linux in the name too
    *microsoft*)     OS="WSL2";; #WARNING: My v2 uses ubuntu 20.4 at the moment slightly different name may not always work
    Linux*)     OS="Linux";;
    Darwin*)    OS="Mac";;
    CYGWIN*)    OS="Cygwin";;
    MINGW*)     OS="Windows";;
    *Msys)     OS="Windows";;
    *)          OS="UNKNOWN:${unameOut}"
esac

echo ${OS}; 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2013-08-21T01:53:56.960

执行以下操作有助于正确执行 ubuntu 的检查：

```
if [[ "$OSTYPE" =~ ^linux ]]; then
    sudo apt-get install <some-package>
fi 
```

# wpf - 将复选框添加到 VB.NET WPF 3.5 TreeView

> ID：394241
> 
> 赞同：0
> 
> 时间：2008-12-26T20:34:50.683
> 
> 标签：wpf, vb.net, .net-3.5

是否可以向 WPF TreeView 对象添加复选框？我希望有人能够在以后检查特定条目以进行数据检索。

我在这里先向您的帮助表示感谢！

联合部队

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-26T20:53:57.133

Josh Smith[在他的博客](http://joshsmithonwpf.wordpress.com/2008/08/01/article-about-checkboxes-in-a-wpf-treeview/)中有一篇文章，其中包含可以帮助您的[Codeproject 文章](http://www.codeproject.com/KB/WPF/TreeViewWithCheckBoxes.aspx)的链接。这篇文章可能不足以让你得到你想要达到的目标，但它是一篇很好的文章，可以用来开始调查:)

HTH，印地

# oop - 描述接口的作用？

> ID：394260
> 
> 赞同：3
> 
> 时间：2008-12-26T21:00:41.363
> 
> 标签：oop, interface

关于 OOP，您如何描述接口？

我的意思是，子类化可以描述为*"Has-A"*，而继承可以是*"Is-A"*。成员方法可以是*"Can-Do"*。

有什么方法可以扩展（没有双关语）来描述接口的作用？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-26T21:19:21.107

我将对象视为**名词**，将方法视为**动词**，将接口视为**形容词**（当然，这种类比过于简单，但通常效果很好）。

示例：接口的`Serializable`作用类似于形容词，因为它将某些特性应用于实现该接口的对象，但不会改变该对象的性质。我们可以说，“这是一个可序列化的对象”。但我们不会说“这个对象*是可*序列化的”，也不会说“这个对象*有可*序列化的”。

我也喜欢 Federico 的[回答](https://stackoverflow.com/questions/394260/description-of-what-an-interface-does#394275)，即接口是“CAN-DO”。

接口是类支持的一组相关操作。接口中的方法一起描述了类可以做什么。

就像一个名词可以带多个形容词一样，一个类可以实现多个接口，只要它们不冲突。一个类实现的所有接口的联合是该类可以做什么的总和。

实际上，接口是一组方法签名，没有实现这些方法的代码。只是方法名称和参数。根据语言的不同，方法签名还可能包括返回类型和抛出的异常。

接口由方法组成，但不包含数据成员。

顺便说一句，我不会说子分类是 HAS-A。我的理解是子类化和继承是一样的，所以这些都是IS-A。而 HAS-A 称为聚合或组合。

*   **组合**是一个对象拥有另一个对象的地方。破坏外部对象也会破坏内部对象。示例：大学组成部门。关闭大学，部门消失。

*   **聚合**是一个对象包含另一个对象但不拥有它的地方。破坏外部对象不会破坏内部对象。示例：大学雇用教授，但关闭大学并不会杀死教授。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T21:02:42.857

接口是具有所有纯虚拟成员的抽象基类。

所以看看你的 Has-A/Is-A，它应该类似于你申请抽象基类的任何东西。

接口通常存在于不完全支持多重继承的语言中，以此来更安全地提供一些相同的好处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-26T21:01:44.060

充当A。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-26T21:10:24.400

正如您对方法的描述一样，我也将接口描述为“Can-Do”。接口是一个*契约*，就像“所有实现我的类，都可以做这些事情”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T21:10:00.160

Joel 说的不是接口是什么。它在某种程度上就像一个抽象基类，但它没有方法和属性的实现。

这几乎总结了接口是什么。

[http://www.c-sharpcorner.com/UploadFile/rmcochran/csharp_interrfaces03052006095933AM/csharp_interrfaces.aspx?ArticleID=cd6a6952-530a-4250-a6d7-54717ef3b345](http://www.c-sharpcorner.com/UploadFile/rmcochran/csharp_interrfaces03052006095933AM/csharp_interrfaces.aspx?ArticleID=cd6a6952-530a-4250-a6d7-54717ef3b345)

# ruby-on-rails - 命名范围的 API

> ID：394273
> 
> 赞同：2
> 
> 时间：2008-12-26T21:09:41.877
> 
> 标签：ruby-on-rails

我在阅读命名范围的 API 时遇到了很大的困难。每个“出价”都有一个 user_id 和一个auction_id。我需要一个范围来返回用户出价的拍卖。

拍卖

```
class Auction < ActiveRecord::Base

  has_many :bids

  named_scope :current, lambda { 
    {:conditions => ["scheduled_start < ?", 0.minutes.ago], 
                      :order => 'scheduled_start asc'} 
  }

  named_scope :scheduled, lambda { 
    {:conditions => ["scheduled_start > ?", 0.minutes.ago], 
                      :order => 'scheduled_start asc'} 
  }

end 
```

投标

```
class Bid < ActiveRecord::Base
  belongs_to :user
  belongs_to :auction

  validates_numericality_of :point, :on => :create

 #
 # how do I write a named scope to check if a user has bid on an auction?

end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-26T22:11:18.007

您可能想尝试通过关联而不是命名范围。

```
class User < ActiveRecord::Base
  has_many :bids
  has_many :auctions, :through => :bids
end 
```

或者反过来做

```
class Auction < ActiveRecord::Base
  has_many :bids
  has_many :users, :through => :bids
end 
```

这样，您可以简单地编写：@auction.users.include?(user)

这不是很清楚阅读，所以让我们改进它：

```
class Auction < ActiveRecord::Base
  has_many :bids
  has_many :bidders, :through => :bids, :source => :user
end 
```

现在：@auction.bidders.include?(user)

最后，您可以将多个参数传递给 lamda，所以（不是最好的例子）

```
named_scope :for_apple_and_banana, lambda{|apple_id, banana_id| {:conditions => ["apple_id = ? AND banana_id = ?", apple_id, banana_id ]}} 
```

# asp.net-mvc - 需要 3 层网站的预算 NLB 政策

> ID：394281
> 
> 赞同：0
> 
> 时间：2008-12-26T21:16:22.237
> 
> 标签：asp.net-mvc, load-balancing, nlb

我们有一些“经典的 asp”客户端面向网站，这些网站通过一个中央 asp.net mvc 站点提供服务，该站点充当 web 服务，即我们直接从 ASP 站点查询 MVC 控制器，并广泛使用 jquery ajax。这个 MVC 站点依次查询在单独的盒子上运行的 sql server。我们有一个自定义会话配置文件，它需要在每个页面视图上调用数据库。

目前，面向客户端的网站与 mvc 网站位于同一个盒子上。我们现在想使用 Windows 2008 网络负载平衡服务来控制高突发流量并保持可用性。在目前有限的预算内...

最佳策略是什么：2x2 - 2 个 NLBed 盒子上的客户端站点和单独一对 NLBed 盒子上的 MVC - 或两者都在一组 3 个 NLBed 盒子上？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T04:33:16.673

我会使用 2x2 解决方案，只是为了帮助这些 MVC 站点远离 Web。如果您不需要 MVC 远离网络，那么请使用 2 或 3 个 NLB 盒子。

请注意，NLB 是一种 IP 到 IP 负载平衡解决方案，因此如果您通过单个连接进行汇集，它最终将始终连接到同一台服务器，而您实际上只是获得了故障转移。

# asp.net - ASP.NET 错误处理问题

> ID：394285
> 
> 赞同：0
> 
> 时间：2008-12-26T21:19:54.257
> 
> 标签：asp.net, vb.net, error-handling

我一直在研究如何在我的 ASP.NET 应用程序中全局处理错误。我已经决定使用带有以下代码的 web.config 文件：

```
<customErrors mode="On" defaultRedirect="errorpage.aspx">
</customErrors> 
```

这是我的 errorpage.aspx.vb 代码：

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    Dim ex As Exception = Server.GetLastError
End Sub 
```

我遇到的问题`Server.GetLastError`最终什么都不是。我必须做什么才能访问最后的错误信息？因为它在一个 asp 表单页面上，我不应该在前面加上`HttpContext.Current.`，对`Server.GetLastError`吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-26T21:21:29.683

[您可以使用 global.asax](http://www.developer.com/net/asp/article.php/961301)捕获全局错误。

错误页面通过简单的 http 重定向加载，不幸的是不知道特定用户的最后一个错误是什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-26T22:03:06.213

尝试使用 ELMAH 来捕获您的错误。它非常可定制，并且会在后台进行处理而不向您的用户报告。它可以将错误发送到电子邮件和/或将它们保存在数据库中。我在所有应用程序中都使用它。

[http://code.google.com/p/elmah/](http://code.google.com/p/elmah/)

# objective-c - 获取 NSButtonCell 的行

> ID：394287
> 
> 赞同：2
> 
> 时间：2008-12-26T21:20:53.583
> 
> 标签：objective-c, cocoa, macos

我有一个 NSTableView 在其中一列中包含一个 NSButtonCell 。我可以设置在界面生成器中单击按钮时调用的操作，但无论如何我都无法确定该按钮存在于表中的哪一行。有没有办法做到这一点？

谢谢。:)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-26T21:43:35.100

特定列的单元格在整个表格中重复使用，因此默认情况下每行没有一个单元格。您可以通过将`clickedRow`消息发送到单元格的表格视图来获取在您的操作方法中单击的行。

```
NSInteger clickedRowIndex = [tableView clickedRow]; 
```

# scripting - 如何禁用“ActiveX 控件可能不安全”弹出窗口

> ID：394298
> 
> 赞同：10
> 
> 时间：2008-12-26T21:32:29.753
> 
> 标签：scripting, activex, security-zone

在我的电脑上的 HTML 文件中，我试图在脚本中使用 Scripting.FileSystemObject。如何禁用弹出窗口“此页面上的任何 ActiveX 控件可能对脚本不安全”？

“Internet 选项”安全窗格允许将“初始化和脚本未标记为可安全执行脚本的 ActiveX 控件”设置为启用，但本地计算机上的文件似乎不在任何列出的区域中。

所以我猜另一个问题是“如何编辑本地文件的安全选项？”

系统：Windows XP SP3
Internet Explorer 7

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-26T22:14:21.417

通过纯粹的hackery，我发现设置以下注册表值可以做到：

```
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\0]
"1201"=dword:00000000 
```

但我仍然想知道是否有任何*支持*的方式来做到这一点。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-26T22:10:22.457

工具 |Internet 选项 | 高级选项卡..在安全下..“允许活动内容在我的电脑上的文件中运行”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-02-15T01:34:26.560

1.  开始菜单，运行并输入INETCPL.CPL
2.  单击安全选项卡
3.  在 Internet 区域中，单击自定义级别按钮
4.  将未标记为安全的初始化和脚本 ActiveX 控件设置为允许

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-07-23T11:16:14.433

正如有人提到的，这应该添加到注册表 [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\0] "1201"=dword:00000000

但我发现 Internet 区域也必须启用“初始化并编写未标记为安全的 ActiveX 控件的脚本”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-26T23:17:27.517

有一种[注册表方法可以让“本地计算机”显示为安全区域之一](http://support.microsoft.com/kb/315933)。但是这篇文章没有提到IE7，所以IE7可能会有所不同。XP 在高级选项下还有新设置，例如“允许活动内容在我的电脑上的文件中运行”。

或者，如果您将本地 .html 文件重命名为 .hta（一个 HMTL 应用程序），这可能就是您要查找的内容。除非你需要所有的浏览器 chrome。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-10T14:30:52.550

取决于版本。这是 x64 Windows 上的 IE32：

Windows 注册表编辑器版本 5.00

[HKEY_CLASSES_ROOT\Wow6432Node\CLSID{0D43FE01-F093-11CF-8940-00A0C9054228}\实现的类别]

[HKEY_CLASSES_ROOT\Wow6432Node\CLSID{0D43FE01-F093-11CF-8940-00A0C9054228}\实现的类别{7DD95801-9882-11CF-9FA9-00AA006C42C4}]

[HKEY_CLASSES_ROOT\Wow6432Node\CLSID{0D43FE01-F093-11CF-8940-00A0C9054228}\实现的类别{7DD95802-9882-11CF-9FA9-00AA006C42C4}]

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-09T09:00:05.003

我在 IE11 Win10 上也收到了 ActiveX 安全警告（“此页面上的 activex 控件可能不安全，无法与页面的其他部分进行交互。你想允许这种交互吗？”）并且使用以下注册表设置我可以禁止该弹出窗口.

> [HKEY_USERS\S-1-5-18\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\0] "1201="dword:00000000"。

[HKEY_USERS\S-1-5-18 用于**系统**帐户，我们也可以为当前用户帐户设置**HKCU**。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-06-04T11:24:55.240

Activex 控件在尝试通过本地文件启动课程时经常提示错误消息。（对于 IE7）

请在 internet option\Security\Internet\custom level\ 下设置以下设置

1.  运行 Activex 控件和插件 - 启用
2.  脚本 Activex 控件标记为安全的脚本 - 启用
3.  在脚本 - 活动脚本 - 启用

还请检查工具\Internet 选项\高级\安全下的以下复选框 1\. 允许活动内容在我计算机上的文件中运行。

~阿尔帕纳

# java - 将超类作为参数传递给期望子类的方法

> ID：394299
> 
> 赞同：5
> 
> 时间：2008-12-26T21:32:31.923
> 
> 标签：java, inheritance, methods, polymorphism, overloading

我有一个看起来像的对象树

```
 Ball
          /    \
  LegalBall    IllegalBall 
```

我有两种方法：

```
class o {
AddBall(LegalBall l)
AddBall(IllegalBall i)
} 
```

在另一堂课上，我想做以下事情：

```
o.AddBall(myBall); 
```

其中 myBall 是 Ball 类型。并让它根据子类型调用正确的方法。显然我不能这样做......这些论点不适用。

有谁知道我怎样才能实现我想要的？或者如果有一个好的解决方法

谢谢

编辑：我正在尝试构建的应用程序是板球记分卡类型的东西。因此，根据保龄球的类型，其他各种元素应该改变。

我的初衷是能够从某种形式的 UI 中指定球的类型和得分，然后从 BallFactory 创建一个适当的类型球，然后例如当我向球队得分发送一个无球时，它会将值添加到球队得分，但也将值添加到无球计数器。但是，当我将同一个球交给击球手分析来处理它时，击球手总得分应该只有 1 分。

我希望这不是太糟糕的解释我的初衷。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-26T21:46:25.170

您可以使用[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)。

```
class Basket {
    void AddBall(LegalBall l) {
        System.out.println("LegalBall added to basket");
    }

    void AddBall(IllegalBall i) {
        System.out.println("IllegalBall added to basket");
    }
}

interface Ball {
    void AddBall(Basket b);
}

class LegalBall implements Ball {
    void AddBall(Basket b) {
        b.AddBall(this);
    }
}

class IllegalBall implements Ball {
    void AddBall(Basket b) {
        b.AddBall(this);
    }
} 
```

或使其更通用：

```
interface BallVisitor {
    void visit(LegalBall l);
    void visit(IllegalBall i);
}

interface Ball {
    void accept(BallVisitor v);
}

class LegalBall implements Ball {
    void accept(BallVisitor v) {
        v.visit(this);
    }
}

class IllegalBall implements Ball {
    void accept(BallVisitor v) {
        v.visit(this);
    }
}

class Basket implements BallVisitor {
    void visit(LegalBall l) {
        System.out.println("LegalBall added to basket");
    }

    void visit(IllegalBall i) {
        System.out.println("IllegalBall added to basket");
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-26T21:39:27.510

您应该尝试只实现*一种*方法：

```
class o {
AddBall(Ball b)
} 
```

并尝试依赖多态性来处理不同类的不同行为。当然，细节取决于 Ball 层次结构的实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T21:42:23.260

您可能（或可能不）想要（部分）访问者模式。

将方法添加到`Ball`：

```
public abstract void addTo(o o); 
```

实施于`LegalBall`和`IllegalBall`作为

```
public void addTo(o o) {
    o.add(this);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T22:12:53.667

就像上面提到的，这里有访问者模式。如果您不能或不想修改 Ball、LegalBall 或 IllegalBall，那么您可以尝试根据球的类型创建一个方法分支。请注意，如果您稍后添加 QuasiLegalBall，此代码将中断。您提到的一般情况很困难，因为 LegalBall 和 IllegalBall 的存在并不能阻止存在不适合您描述的两种类型的 Balls（至少从语言的角度来看）。

```
class o {
    public void AddBall(Ball b) 
    { 
        if (b instanceof LegalBall) {AddLegalBall(b); }
        else if (b instanceof IllegalBall) {AddIllegalBall(b); }
        else { /*error, new type of ball created*/ }
    }
    private void AddLegalBall(LegalBall b) { }
    private void AddIllegalBall(IllegalBall b) { }
    }
 } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-26T23:05:10.847

使用访客模式。不这样做很麻烦，并且是这个问题的主题：[Workaround Java's static method dispatching without Double Dispatch/Visitor patterns](https://stackoverflow.com/questions/370812/work-around-javas-static-method-dispatching-without-double-dispatchvisitor-patt)。

However, can you please state your original problem? I mean, why do you need to have those two overloads for the Add method? Maybe you can solve it in a completely different way which doesn't need to rely on dynamic dispatch like the visitor pattern?

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-26T22:16:31.647

我同意访客的使用。

此外，如果您无权访问 Ball 层次结构（源代码访问）或者只是不想在那里修改任何内容；您可以修改您的客户类并从那里决定。

坏事当然是你会得到很多 if/elseif 语句。

您需要添加通用方法 ( *add( Ball )* ) 并从那里调用其他方法。这是快速、简单和肮脏的。

:)

```
public class Test {
    public static void main( String [] args ) { 
        Ball ball = new IllegalBall();
        Test test = new Test();
        test.add( ball );
        test.add( new IllegalBall() );
        test.add( new LegalBall() );
    }
    private void add( Ball ball ){
        System.out.println("Generic method: I'll have someone handling this : "  + ball );
        if( ball instanceof IllegalBall ) {
            add( ( IllegalBall ) ball );
        } else if( ball instanceof LegalBall ) {
            add( ( LegalBall ) ball );
        }
    }
    private void add( IllegalBall ball ){
        System.out.println("illega-ball: I won't do anything about it! " + ball );
    }
    private void add( LegalBall ball ) { 
        System.out.println("legal-ball: Hey this is legal I'll do my best!! " + ball );
    }
}

class Ball {}
class IllegalBall extends Ball {}
class LegalBall extends Ball {} 
```

顺便说一句，如果您没有直接引用，编译器会将其发送到最后 2 次调用中的正确方法。

如您所见，您只需要添加以下代码：

```
private void add( Ball ball ){
    System.out.println("Generic method: I'll have someone handling this : "  + ball );
    if( ball instanceof IllegalBall ) {
        add( ( IllegalBall ) ball );
    } else if( ball instanceof LegalBall ) {
        add( ( LegalBall ) ball );
    }
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-26T22:21:40.203

访问者模式和使用回调的类似解决方案，在这种情况下似乎只是试图以这样一种方式弯曲您的代码，以使编译器接受您有缺陷的类层次结构。

我会保留 Ball 类型，并使该类型的属性合法/非法。您将只有 o.add(Ball)，您可以在其中根据某些属性或通过方法检查合法/非法，例如 isLegal()。

如果上面的方法看起来不合理，那么用一个方法来添加两个（非常）不同的类型是不合理的，并且您提出的子类型关系不会是要走的路。

# python - python内省未显示锁定功能

> ID：394300
> 
> 赞同：1
> 
> 时间：2008-12-26T21:34:05.663
> 
> 标签：python

当我尝试使用自省来查看 threading.Lock 上可用的方法时，我看不到我的期望。

具体来说，我没有看到获取、释放或锁定。为什么是这样？

这是我所看到的：

```
>>> dir (threading.Lock)
['__call__', '__class__', '__cmp__', '__delattr__', '__doc__', '__getattribute__', '__hash__', '__init__', '__module__', '__name__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__self__', '__setattr__', '__str__'] 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-26T21:42:07.503

你这样做是错的。 `threading.Lock`不是一个对象。

```
>>> import threading
>>> threading.Lock
<built-in function allocate_lock>
>>> type(threading.Lock)
<type 'builtin_function_or_method'>
>>> x=threading.Lock()
>>> type(x)
<type 'thread.lock'>
>>> dir(x)
['__enter__', '__exit__', 'acquire', 'acquire_lock', 'locked', 'locked_lock', 'release', 'release_lock']
>>> 
```

# c# - 家庭自动化图书馆

> ID：394303
> 
> 赞同：17
> 
> 时间：2008-12-26T21:37:10.073
> 
> 标签：c#, asp.net, .net, home-automation

我是一名 C# 开发人员，希望将家庭自动化作为一种​​爱好。我做了一些研究，但想知道是否有人知道支持 Insteon 硬件的良好 .NET 库。由于可靠性问题，我宁愿使用 Insteon 而不是 X10。

在这一点上，我的最终目标是拥有一个简单的家庭自动化服务器（可能是灯光和气候控制），并带有安全的 ASP.NET Web 应用程序界面。我更感兴趣的是实际构建它并了解它，而不是寻找现有的解决方案。

感谢您的任何建议或意见。

编辑：谢谢大家的帮助。

有人对[Z-wave 技术](http://www.z-wave.com)有经验吗？看起来很有希望 - 似乎是更高质量的硬件，包括一个核心库，支持 .NET 等。 [ControlThink](http://www.controlthink.com/)似乎有一个非常好的控制器和 SDK。

这是一个值得考虑的有趣应用程序：[失速状态：走之前知道](http://www.controlthink.com/)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-04-17T00:11:08.000

我们发现对 Insteon 的开发人员支持并不多，除非您想购买他们的 SDK 并同意他们相当严厉的许可协议。我们没有走这条路，而是编写了自己的 .NET 库，称为[FluentDwelling](http://soapboxautomation.com/products/fluentdwelling/)，并将其开源。如果您点击该链接，您可以找到下载链接和一些入门代码示例。

源代码附带一整套单元测试（需要 NUnit，也是免费的），因此您可以根据需要添加改进和更改。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-09T03:53:21.840

我会像瘟疫一样避免X10。在现代电视和电源板、桥接电源接线盒和简单奇怪的接线之间，X10 信号往往只是“消失”并且永远不会到达目的地。

如果你真的想试一试 X10，我在车库里有一盒价值 250 美元以上的新 X10 东西，在我家完全没用，所以你可以拥有它。其中一些在我的旧房子里有用，但它不会在我现在住的地方的 2 个插座上打开灯。

X10 被大多数现代电子设备视为线路上的“噪音”（从技术上讲，确实如此）并且需要过滤掉而不是通过或单独放置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T22:43:58.347

我不记得它是否涵盖了您提到的特定技术，但您绝对应该查看[.NET Rocks 的这一集](http://www.dotnetrocks.com/default.aspx?showNum=364)。他们谈论了您可以通过家庭自动化做的所有不同的事情，以及很多关于如何去做的事情。我认为其中一个要点是 Microsoft [Robotics](http://msdn.microsoft.com/en-us/robotics/default.aspx) Studio 是一个很好的使用工具，因为它使用了许多与您原本会使用的抽象相同的抽象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-20T15:48:19.580

我知道这篇文章发表已经有很长时间了，但是我想知道你是否选择了一条路线，以及从那以后你最终对家庭自动化做了什么。

我一直在使用许多可用的技术来做这类事情，但我总是在名为 homeseer 的产品之上完成它。.net 插件和 vb.net 和 c# 脚本可以在此基础之上完成。我一直在考虑滚动我自己的类似于你所描述的。您做出的任何想法、提示、决定等？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-25T20:14:49.610

有点跑题了，但听听最新一集 dot net Rocks，我的 .net 故事的决赛入围者之一构建了一个家庭自动化解决方案，这真的让我想再次涉足家庭自动化。完全可怕的解决方案。

[http://www.dotnetrocks.com/default.aspx?showNum=518](http://www.dotnetrocks.com/default.aspx?showNum=518)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-26T21:51:40.183

我认为这将是一个开始 [insteon sdk的地方](http://www.insteon.net/sdk/files/dm/docs/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-26T21:53:47.917

一些通过谷歌寻找[Insteon SDK](http://www.google.com/search?q=insteon+sdk)的研究只产生了[2005 年](http://www.cocoontech.com/index.php?showtopic=1681)的东西。只有关于[串行端口接口](http://www.smarthome.com/insteon/sdk2600s.html)（没有 USB）的信息，唯一提到的语言是称为 DockLight 脚本的东西，看起来它自 2005 年以来就没有更新过。

[另一方面， X10](http://www.x10.com/activehomepro/sdk/)拥有对 C++、VisualBasic、VB 脚本和 JavaScript 的支持。没有列出 .Net，但 VisualBasic/VB 脚本可能意味着您可以轻松导入 COM 对象以在 C# 中使用。它们也对 USB 更友好，而且该套件的价格是 Insteon 套件的 1/4（50 美元对 200 美元）。

如果您实际上是在构建产品，我会理解可靠性问题。但由于这是一个家庭项目，我认为您使用 X10 会有更好的运气。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-02-03T06:27:02.730

您可以免费试用 Clipsal(schneider) 的 C-bus。

# c# - 是否有 Sourcesafe API 来获取源代码控制中的总代码行？

> ID：394311
> 
> 赞同：0
> 
> 时间：2008-12-26T21:44:48.780
> 
> 标签：c#, visual-sourcesafe

我希望能够获得我在 Sourcesafe 中拥有的项目及其总代码行数（也许还有类总数等）。是否有用于 Sourcesafe 的 SDK（我使用 2005 版）允许我这样做？

或者 Sourcesafe 中是否有一个文档列出了 SS 中的所有项目？使用它，我可以努力获得行数。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-26T22:45:25.193

没有特定的行计数 API。有一个 API 可以访问这些文件，但它的速度太慢了。

如果您在根项目上设置一个影子文件夹可能会更好（这是通过管理工具完成的）。然后，一个简单的应用程序可以从影子文件夹中递归地打开所有源文件并进行一些行计数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-26T22:50:02.813

我意识到这并不完全是您所要求的，但您可以调整以下内容以满足您的需求：

[http://richnewman.wordpress.com/2007/07/01/c-and-vbnet-line-count-utility/](http://richnewman.wordpress.com/2007/07/01/c-and-vbnet-line-count-utility/)

我以前用过这个，效果很好。它也区分注释和自动生成的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T22:29:12.370

您将需要获取每个文件并自己计算行数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T01:19:14.960

我不需要 API 来计算类中的行数。这很容易做到，我知道几种方法。

相反，最好收集存储在 SS 中的文件，这样我就可以对每个文件运行行数。

但是，我想我可以用 projectnameISSOURCESAFECHECKEDIN 之类的标签标记我的根父目录，并且对于每个文件夹（并且只有父文件夹），我将深入研究并计算类中的行数。不是一个完美的解决方案，但有效且不依赖任何 API。

安东尼，

你的解决方案也是可信的。:)

# sql - 您如何从 Ruby 直接将 SQL 与 MySQL 对话？

> ID：394316
> 
> 赞同：7
> 
> 时间：2008-12-26T21:49:45.180
> 
> 标签：sql, mysql, ruby-on-rails, ruby, activerecord

我想用 Ruby 编写一个脚本来清理同一 MySQL 模式的多个副本中的一些混乱的键。我想做一些类似 SHOW CREATE TABLE 的事情，然后看看返回的内容并删除键（如果存在）。

我知道在 Rails 环境中你可以做到这一点......

```
ActiveRecord::Base.connection.execute( some sql ) 
```

但是你得到的是一个“结果”对象。对于这个任务，我需要一个字符串，这样我就可以分析它并采取相应的行动。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-08T07:50:58.193

这应该可以帮助您：

```
>> result = ActiveRecord::Base.connection.execute("SHOW TABLES")
=> #<Mysql::Result:0x37ecb30>

>> result.class.instance_methods - Object.instance_methods
=> ["all_hashes", "field_seek", "row_tell", "fetch_field_direct", "free", "field_tell", "fetch_lengths", "num_fields", "data_seek", "fetch_row", "num_rows", "fetch_field", "each", "each_hash", "fetch_hash", "row_seek", "fetch_fields"] 
```

查看 MySql::Result 实例上的#all_hashes

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-27T00:38:49.363

我会使用 mysql-ruby gem，你会做这样的事情：

```
require 'mysql'

m = MySQL.new("localhost", "username", "password", "database")
r = m.query("SELECT * FROM people ORDER BY name")
r.each_hash do |f|
  print "#{f['name']} - #{f['email']}"
end 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-26T22:26:23.140

如果您不想使用 ActiveRecord，ORM 现在可能对您的使用有点复杂），您仍然可以使用 ruby​​-mysql 库，或者更好的恕我直言，使用 Ruby DBI/DBD 库（[此处](http://rubyforge.org/projects/ruby-dbi/)）开箱即用的 mysql 和 postgresql 的 DBD 驱动程序。

这样，您可以像这样发出直接的 SQL 语句

```
require "dbi"
require "dbi/dbrc"

# == Configuration

DB = "sympa"
HOST = "saphir"

cnt = 0
dup = 0

# == Crude option processing
#
list_name = ARGV.shift.to_s
file = ARGV.shift.to_s

db = DBI::DBRC.new(DB)
DBI.connect(db.dsn + ":#{HOST}", db.user, db.password) do |dbh|
  date = Time.now.asctime

  if not list_name or list_name == "" then
    puts "List name is mandatory"
    exit 1
  end

  req1 = <<-"EOR"
insert into user_table (email_user,lang_user)
values (?, ?)
  EOR
...
req2 = <<-"EOR"
insert into subscriber_table
(user_subscriber, list_subscriber, visibility_subscriber,
date_subscriber, reception_subscriber) values (?, ?, ?, NOW(), ?)
EOR

sth1 = dbh.prepare(req1)
sth2 = dbh.prepare(req2)
...
#
# Insertion in user_table
#
begin
  sth1.execute(line, "en")
  cnt += 1
rescue DBI::DatabaseError => err
  $stderr.puts("DBI: #{err}")
end 
```

dbi/dbrc 是一个有用的模块，它使您能够避免将登录名和密码直接放在脚本中。见[那里](http://raa.ruby-lang.org/project/dbi-dbrc/)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-26T23:57:32.380

您可以检查[mysql-ruby](http://rubyforge.org/projects/mysql-ruby/) gem。

这是一篇关于如何使用它的文章：[使用 Ruby MySQL 模块](http://www.kitebird.com/articles/ruby-mysql.html)

更多可以通过谷歌找到

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-26T21:55:46.290

可能有更好的方式以编程方式执行此操作，但是如果您真的想驱动交互式命令并解析结果，那么[expect](http://expect.nist.gov/)可能更合适。你仍然可以从你的 ruby​​ 脚本中开始期待。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-28T15:55:12.253

# 使用Mysql2

To update this thread: I'd suggest Mysql2 now: [http://rubygems.org/gems/mysql2](http://rubygems.org/gems/mysql2)

# c# - 缓冲媒体内容，同时使用 C# 在 Windows Media Player 中播放另一个媒体内容

> ID：394317
> 
> 赞同：1
> 
> 时间：2008-12-26T21:50:16.817
> 
> 标签：c#, windows-media-player, buffering

我正在用 C# 开发一个应用程序，它有一个嵌入了 Windows Media Player 的表单。我的应用中有几个指向某些在线内容的链接。我希望用户通过单击按钮将内容从一个更改为另一个。由于 WMP 在缓冲下一个内容时花了一些时间，所以我想继续播放当前内容。类中有一个称为“缓冲”的事件`AXWindowsMediaPlayer`，当媒体播放器完成缓冲内容时发出信号。但我无法使用单个 AXWindowsMediaPlayer 对象来实现这一点。无论我做什么，我都无法在缓冲第二个内容的同时继续播放第一个内容。:(

有任何想法吗？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-26T22:03:53.623

我建议您根据需要交换两个 Player 控件实例。

或者，如果连接速度足够快，则将每个项目缓存在本地系统上并从那里播放。

# file - 文件树的文本规范？

> ID：394321
> 
> 赞同：4
> 
> 时间：2008-12-26T21:52:47.593
> 
> 标签：file, tree, grep, glob

我正在寻找在树结构中指定文件的示例，例如，用于指定要在 grep 工具中搜索的文件集。我希望能够通过名称匹配来包含和排除文件和目录。我敢肯定那里有例子，但我很难找到它们。

下面是一个可能的语法示例：

```
*.py *.html
*.txt *.js
-*.pyc
-.svn/
-*combo_*.js 
```

（这意味着包含扩展名为 .py .html .txt .js 的文件，排除 .pyc 文件，.svn 目录下的任何内容，以及任何匹配*combo_* .js 的文件）

我知道我以前在其他工具中看到过这类规范。这是否为任何人敲响了警钟？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-27T01:01:29.833

这种东西没有单一的标准格式，但如果你想复制被广泛认可的东西，请查看[`rsync`文档](http://samba.anu.edu.au/ftp/rsync/rsync.html)。查看“包含/排除模式规则”一章。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T23:06:58.160

[Apache Ant](http://ant.apache.org/)提供了['ant glob 或模式](http://ant.apache.org/manual/dirtasks.html#patterns)，其中：

```
**/foo/**/*.java 
```

表示“目录中任何以 '.java' 结尾的文件，其路径中包含一个名为 'foo' 的目录”——包括 ./foo/X.java

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-26T22:06:25.630

**`find`**在unixish环境中怎么样？

当然，Find 可以做的不仅仅是建立一个文件列表，但这是它的常用方法之一。从手册页：

> NAME find -- 遍历文件层次结构
> 
> 概要找到 [-H | -L | -P] [-EXdsx] [-f 路径名] 路径名 ... 表达式查找 [-H | -L | -P] [-EXdsx] -f 路径名 [路径名 ...] 表达式
> 
> 描述 find 实用程序递归地向下遍历每个列出的路径名的目录树，根据树中的每个文件评估一个表达式（由 `primaries'' and`下面列出的操作数组成）。

为了实现你的目标，我会写一些类似的东西（格式化为可读性）：

```
find ./ \( -name *.{py,html,txt,js,pyc} -or \
           -name *combo_*.js -or \
           \( -name *.svn -and -type d\)\) \
           -print 
```

此外，还有一个惯用模式，使用**`xargs`**它使得 find 适合将整个列表发送到任意命令，如下所示：

```
find /path -type f -print0 | xargs -0 rm 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-26T23:10:37.170

在您的示例语法中，是否隐含地理解有一个转义字符，以便您可以显式包含以破折号开头的文件？（同样的问题适用于任何其他通配符，但我想我希望看到更多名称中带有破折号的文件而不是星号。）

如您的示例所示，各种命令外壳使用 * （可能还有 ? 匹配单个字符），但它们通常仅匹配不包含路径组件分隔符的字符串（即 Windows 系统上的 '\'，' /'别处）。我还看到像 Perforce 这样的源代码控制应用程序使用*可以*匹配路径组件分隔符的其他模式。例如，使用 Perforce 模式“foo/...ext”（不带引号）将匹配 foo/ 目录结构下以“ext”结尾的所有文件，无论它们是在 foo/ 本身还是在它的其中之一后代目录。这似乎是一个有用的模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-27T01:14:28.480

如果您使用 bash，则可以使用`extglob`扩展来获得一些不错的通配函数。按如下方式启用它：

```
shopt -s extglob 
```

然后您可以执行以下操作：

```
# everything but .html, .jpg or ,gif files
ls -d !(*.html|*gif|*jpg)
# list file9, file22 but not fileit
ls file+([0-9])
# begins with apl or un only
ls -d +(apl*|un*) 
```

另请参阅[此页面](http://aplawrence.com/Words2005/2005_05_25.html)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-26T22:17:50.193

`find(1)`如上一个答案中所述，是一个很好的工具，但如果它变得更复杂，您应该考虑在任何常见的嫌疑人（Ruby、Perl、Python 等）中编写自己的脚本，或者尝试使用更强大的一个诸如 zsh 之类的 shell 具有通配`**`命令，您可以指定要排除的内容。后者可能更复杂。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-27T00:51:46.250

您可能想查看[ack](http://petdance.com/ack/)，它允许您使用诸如`--perl`等选项指定要搜索的文件类型。

它还`.svn`默认忽略目录，以及核心转储、编辑器、二进制文件等。

# ruby - 非常简单的 Ruby 问题：我的班级在哪里？

> ID：394330
> 
> 赞同：3
> 
> 时间：2008-12-26T21:59:12.913
> 
> 标签：ruby

*[我刚从 Ruby 开始，但“没有任何问题是新手”，所以我艰难前行……]*

我看到的每一本教程和书籍都从带有交互式 shell 的 Ruby 到 Ruby on Rails。我还没有使用 Rails，但我不想使用交互式 shell。我有一个类文件（first_class.rb）和一个主文件（main.rb）。如果我运行 main.rb，我当然会得到`uninitialized constant FirstClass`. **我如何告诉 ruby`first_class.rb`​​ ？**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-26T22:03:33.310

最简单的方法是将它们放在同一个文件中。

但是，您也可以使用 require，例如：

```
require 'first_class' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-28T08:57:41.947

您还可以按如下方式使用自动加载：

```
autoload :FirstClass, 'first_class' 
```

使用 FirstClass 后，此代码将自动加载 first_class.rb。但是请注意，当前的自动加载实现**不是**线程安全的（请参阅[http://www.ruby-forum.com/topic/174036](http://www.ruby-forum.com/topic/174036)）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-28T10:24:12.363

还有一点值得注意：您通常不会`main`在 ruby​​ 中使用文件。如果您正在编写命令行工具，标准做法是将工具放在`bin`子目录中。对于普通的一次性脚本，主要习惯用法是：

```
if __FILE__ == $0
  # main does here
  # `__FILE__` contains the name of the file the statement is contained in
  # `$0` contains the name of the script called by the interpreter
  # 
  # if the file was `required`, i.e. is being used as a library
  # the code isn't executed.
  # if the file is being passed as an argument to the interpreter, it is.
end 
```

# objective-c - “同步”2个数组的算法

> ID：394349
> 
> 赞同：1
> 
> 时间：2008-12-26T22:08:22.427
> 
> 标签：objective-c, arrays

```
Array 1 | Array 2
=================
   1    |   2
   2    |   3
   3    |   4
   5    |   5
        |   6 
```

什么是“同步”或将数组 2 合并到数组 1 中的好算法？需要发生以下情况：

1.  应将数组 2 中但数组 1 中未包含的整数添加到数组 1。
2.  两个数组中的整数都可以单独保留。
3.  应从 Array 1 中删除 Array 1 中但不在 Array 2 中的整数。

我最终将在 Obj-C 中对此进行编码，但我实际上只是在寻找一种有效算法的伪代码表示来解决这个问题，所以请随意以您喜欢的任何形式提出答案。

编辑：

如果不提供背景故事，我需要的最终结果有点难以解释。我有一个 Cocoa 应用程序，它有一个核心数据实体，其数据需要使用来自 Web 服务的数据进行更新。我不能简单地用数组 2 的内容（从 web 解析成数组的数据）覆盖数组 1（核心数据实体）的内容，因为数组 1 与我的应用程序中的其他核心数据实体有关系。所以基本上重要的是，两个数组中包含的整数不会在数组一中被覆盖。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-26T22:20:26.053

`Array1 = Array2.Clone()`或者一些等价物可能是最简单的解决方案，除非元素的顺序很重要。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-27T03:02:29.900

我有点猜测，因为你的例子让一些事情悬而未决，但通常在这种情况下，我会使用一个集合。这是 Obj-C 中的一些示例代码。

```
NSMutableSet *set = [NSMutableSet set];
[set addObjectsFromArray:array1];
[set addObjectsFromArray:array2];
NSArray *finalArray = [[set allObjects] sortedArrayUsingSelector:@selector(compare:)]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T22:34:56.680

在我的方法中，您将需要[**Set data structure**](http://en.wikipedia.org/wiki/Set_(computer_science))。我希望你能在 Obj-C 中找到一些实现。

1.  将 Array1 的所有元素添加到 Set1，并将 Array2 的所有元素添加到 Set2。
2.  循环遍历 Array1 的元素。检查它是否包含在 Set2 中（使用提供的方法。）如果不是，则从 Set1 中删除该元素。
3.  循环遍历 Array2 的元素。如果 Set1 中尚不存在，则将其添加到 Set1。

Set1 的所有元素现在都是您的“同步”数据。

在一些好的实现上，“包含”、“删除”和“添加”操作的“包含”、“删除”和“添加”操作的算法复杂性[`HashSet`](http://java.sun.com/javase/6/docs/api/java/util/HashSet.html)会给你想要的效率。

**编辑**：这是一个简单的实现，`Set`假设整数在 0 - 100 的有限范围内，每个元素都初始化为 0，只是为了更清楚地了解 Set。

您首先需要定义大小为 101 的数组存储桶。然后为 ..

*   **contains(n)** - 检查 bucket[n] 是否为 1。
*   **add(n)** - 将 bucket[n] 设置为 1。
*   **delete(n)** - 将 bucket[n] 设置为 0。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-26T22:37:39.780

（假设这不是一个简单的`Array1 = Array2`问题，）如果对数组进行了排序，那么您正在查看两个数组的单个 O(n+m) 传递。指向两个数组的开头，然后前进包含较小元素的指针。随时比较元素并相应地添加/删除元素。这样做的效率可能值得对数组进行排序的成本，如果它们还不是这样的话。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-26T22:45:16.363

你说：

什么是“同步”或将数组 2 合并到数组 1 中的好算法？需要发生以下情况：

1.  应将数组 2 中但数组 1 中未包含的整数添加到数组 1。
2.  两个数组中的整数都可以单独保留。
3.  应从 Array 1 中删除 Array 1 中但不在 Array 2 中的整数。

这是一些可以帮助您的文字算法（python）：

```
def sync(a, b):
 # a is array 1
 # b is array 2
 c = a + b
 for el in c:
  if el in b and el not in a:
   a.append(el) # add to array 1
  elif el in a and el not in b:
   a.remove(el) # remove from array 1
  # el is in both arrays, skip
 return a # done 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-26T23:48:45.563

尝试用“这是所需的最终条件”来描述需求，而不是“这就是需要发生的事情”。从这个角度来看，所需的最终状态似乎是 for`array1`包含与 完全相同的值`array2`。

如果是这种情况，那么为什么不等效于这个伪代码（除非你的环境有`clone`or`copy`方法）？

```
array1 = new int[array2.length]
for (int i in 0 .. array2.length - 1) {
    array1[i] = array2[i]
} 
```

如果订单、重复保留等问题，请更新问题，我们可以重试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-26T22:23:46.767

好吧，如果顺序无关紧要，您已经有了算法：

1.  应将数组 2 中但数组 1 中未包含的整数添加到数组 1。
2.  两个数组中的整数都可以单独保留。
3.  应从 Array 1 中删除 Array 1 中但不在 Array 2 中的整数。

如果整数的顺序很重要，那么您想要的是确定两个字符串之间“差异”的算法的变体。Levenshtein 算法应该适合你。

但是，我怀疑您实际上想要第一部分。在那种情况下，问题*究竟*是什么？如何找到数组中的整数？要不然是啥？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-27T05:57:56.647

您的问题没有说明顺序，如果您检查您的三个要求，您会看到后置条件表示**Array2 未更改**，并且**Array1 现在包含与 Array2 中完全相同的整数集**。除非您没有告诉我们有关**订单的某些要求，否则您也可以制作 Array2 的副本。**

# c++ - 是否值得学习 AMD 特定的 API？

> ID：394370
> 
> 赞同：5
> 
> 时间：2008-12-26T22:21:57.987
> 
> 标签：c++, intel, amd-processor

我目前正在学习与英特尔并行化库相关的 API，例如 TBB、MKL 和 IPP。不过，我想知道是否也值得关注 AMD 的部分难题。或者这只是浪费时间？（我必须承认，我对 AMD 的库支持一无所知——完全不知道——所以如果你有任何建议，我将不胜感激。）

澄清一下，我采用英特尔方式的原因是 1）API 非常好；2) 英特尔似乎对工具支持和 API 支持一样重视。（再一次，我**不知道**AMD 在这个部门的表现如何。）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-26T23:36:09.740

MKL 和 IPP 库将（几乎）在 AMD 机器上执行。我的猜测是 TBB 在 AMD 机器上也能正常运行。如果我必须建议一种对双方都有益和有用的技术，那就是掌握 OpenMP 库。带有 OpenMP 扩展的 Intel 编译器速度惊人，并且还可以与 AMD 芯片配合使用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-26T22:27:43.200

仅当您对构建视频游戏、操作系统、数据库服务器或虚拟化软件等特别感兴趣时才值得。换句话说：如果你有一个段，你足够关心性能，花时间在汇编程序中做（并且做对）。英特尔也是如此。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-26T22:25:29.913

如果您的公司只销售带有您的软件的英特尔服务器软件包，那么您不应该费心学习 AMD 方法。但是，如果您必须为两个（或多个）不同平台提供软件，那么可能值得研究不同的技术。为特定于硬件的库创建包装器将非常困难。（特别是因为涉及到线程。）

而且您绝对不想为每个硬件配置编写完全独立的实现。事实上，如果您的软件是供普通用户使用的，那么您可能希望放弃英特尔技术，而使用标准线程技术。我并不是要气馁，但我相信英特尔线程库在所有意图和目的上都领先于他们的时代。

# python - 通过 Python 查找 OSX 中的 ActiveApplication 何时更改

> ID：394372
> 
> 赞同：0
> 
> 时间：2008-12-26T22:24:43.130
> 
> 标签：python, cocoa-touch, macos

有没有办法通过 Python 和 AppKit 找到 OSX 中的 activeApplication 何时更改？我知道如何找出launchApplication和activeApplication（请参考我的另一个问题：[Finding the Current Active Window in Mac OS X using Python](https://stackoverflow.com/questions/373020/finding-the-current-active-window-in-mac-os-x-using-python)）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-26T22:50:24.933

我有[一个 OS X 应用程序](http://github.com/dustin/app-hider)，它通过[轮询 NSTimer](http://github.com/dustin/app-hider/tree/master/AppTracker.m#L212)来做到这一点。我尝试搜索分布式通知，看看是否能找到更好的方法，但我看不到任何非常有用的东西。

[当应用程序启动](http://github.com/dustin/app-hider/tree/master/AppTracker.m#L49)或[退出](http://github.com/dustin/app-hider/tree/master/AppTracker.m#L73)时，我确实收到了通知。这至少有点帮助。[您可以在我的控制器唤醒](http://github.com/dustin/app-hider/tree/master/Controller.m#L231)的地方看到这些注册。

这个应用程序对我非常有帮助，甚至每秒轮询一次几乎不使用 CPU。不过，如果我能让它更受事件驱动，我会的。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T22:52:05.117

我不知道这样做的“官方”/好方法，但是解决此问题的一种骇人听闻的方法是侦听任何分布式通知，并查看在最前面的应用程序更改时始终触发哪些通知，以便您可以收听那个：

你可以这样设置：

```
def awakeFromNib(self):
    NSDistributedNotificationCenter.defaultCenter().addObserver_selector_name_object_(
        self, 'someNotification:', None, None)

def someNotification_(self, notification):
    NSLog(notification.name()) 
```

在您找到在切换应用程序时始终触发的通知后，您可以将 addObserver_etc_ 调用中的第一个“None”替换为该通知的名称，并在“someNotification_”方法中检查最前面的应用程序。

在我的情况下，我注意到每次切换应用程序时都会触发“AppleSelectedInputSourcesChangedNotification”，所以我会听...

请记住，这可能会随时中断，并且您会比需要更频繁地检查最前面的应用程序中的更改。

不过必须有更好的方法..希望:)

# authentication - Facebook 风格 API 设计

> ID：394374
> 
> 赞同：1
> 
> 时间：2008-12-26T22:25:38.400
> 
> 标签：authentication, facebook, credentials

我正在为我的一个项目设计一个 api/应用程序结构来模仿 facebook 的结构。我想知道验证用户的最佳方法是什么。

对于应用程序，我如何为他们提供 nessecaru 凭据以及如何验证这些凭据？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-27T13:02:11.657

在我开始之前，我会研究这些技术：

*   **[OpenSocial](http://en.wikipedia.org/wiki/OpenSocial "开放社交")**这基本上是“开源”facebook 平台。您可以将站点设置为容器或应用程序（或两者的某种时髦组合）。

*   如果您只想能够使用来自另一个受信任站点的登录凭据对人员进行身份验证，则使用**[OpenID](http://en.wikipedia.org/wiki/OpenID "OpenID")**

*   如果您正在寻找 API 风格的身份验证框架，则为**[OAuth](http://en.wikipedia.org/wiki/OAuth "OAuth")**

所有这些技术在通常的嫌疑人中都有参考实现，并且*应该*比 facebook 所做的任何事情都更加“开放”。从长远来看，我们将看到会发生什么……

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T14:29:53.353

好吧，facebook api 实际上有一个开源实现，所以这很好。但我想知道 facebook 如何真正验证所有内容？比如他们如何将用户数据传递给您？

# abap - 如何在abap中获取内部表的行数？

> ID：394375
> 
> 赞同：38
> 
> 时间：2008-12-26T22:25:54.530
> 
> 标签：abap

如何获取内部表的行数？我想我可以循环播放它。但必须有一个更理智的方法。

我不知道它是否有区别，但代码应该在 4.6c 版本上运行。

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-01-05T00:03:04.053

此任务还有一个内置函数：

```
variable = lines( itab_name ). 
```

就像[IronGoofy](https://stackoverflow.com/users/25320/irongoofy)描述的“纯”ABAP 语法一样，函数“lines()”将表 itab_name 的行数写入变量中。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-12-26T22:34:51.533

您可以使用以下功能：

```
 DESCRIBE TABLE <itab-Name> LINES <variable> 
```

调用后，变量包含内部表的行数。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2015-09-18T11:44:12.650

除了推荐

```
DESCRIBE TABLE <itab-Name> LINES <variable> 
```

还有系统变量`SY-TFILL`。

从文档：

> 在语句 DESCRIBE TABLE、LOOP AT 和 READ TABLE 之后，访问的内部表的行数。

示例脚本：

```
REPORT ytest.

DATA pf_exclude TYPE TABLE OF sy-ucomm WITH HEADER LINE.

START-OF-SELECTION.
  APPEND '1' TO pf_exclude.
  APPEND '2' TO pf_exclude.
  APPEND '3' TO pf_exclude.
  APPEND '4' TO pf_exclude.

  WRITE: / 'sy-tfill = ', sy-tfill.

  DESCRIBE TABLE pf_exclude.
  WRITE: / 'sy-tfill = ', sy-tfill, 'after describe table'.

  sy-tfill = 0\. "Reset
  READ TABLE pf_exclude INDEX 1 TRANSPORTING NO FIELDS.
  WRITE: / 'sy-tfill = ', sy-tfill, 'after read table'.

  sy-tfill = 0\. "Reset
  LOOP AT pf_exclude.
    WRITE: / 'sy-tfill = ', sy-tfill, 'in loop with', pf_exclude.
    sy-tfill = 0\. "Reset
  ENDLOOP. 
```

结果：

```
sy-tfill =           0
sy-tfill =           4  after describe tabl
sy-tfill =           4  after read table
sy-tfill =           4  in loop with 1
sy-tfill =           0  in loop with 2
sy-tfill =           0  in loop with 3
sy-tfill =           0  in loop with 4 
```

请注意第二个条目的值 0：`SY-TFILL`不会随每一步更新，仅在第一个循环之后。

我只推荐使用SY-TFILL，如果你需要在`READ`（1）之后直接`READ`使用...

(1) 或描述表。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-02-06T05:42:07.247

```
 DATA : V_LINES TYPE I. "declare variable
  DESCRIBE TABLE <ITAB> LINES V_LINES. "get no of rows
  WRITE:/ V_LINES. "display no of rows 
```

参考：http : [//www.sapnuts.com/courses/core-abap/internal-table-work-area.html](http://www.sapnuts.com/courses/core-abap/internal-table-work-area.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-30T12:04:57.620

功能模块 EM_GET_NUMBER_OF_ENTRIES 也将提供行数。它需要 1 个参数 - 表名。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-11-29T11:04:00.890

您还可以使用 OPEN Sql 使用 COUNT 分组子句查找行数，并且还有系统字段 SY-LINCT 来计算表的行数（ROWS）。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-03-07T10:05:45.390

如果我正确理解您的问题，您想知道内部表的条件循环期间的行号。如果您使用内部表，则可以使用系统变量 sy-tabix。如果您需要更多信息，请参阅 ABAP 文档（尤其是关于[内部表处理](http://help.sap.com/saphelp_nw70/helpdata/EN/fc/eb36bb358411d1829f0000e829fbfe/frameset.htm)的章节）。

例子：

```
LOOP AT itab INTO workarea
        WHERE tablefield = value.

     WRITE: 'This is row number ', sy-tabix.

ENDLOOP. 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2011-11-24T16:26:57.360

```
data: vcnt(4).

clear vcnt.

LOOP at itab WHERE value = '1'.
  add 1 to vcnt.
ENDLOOP. 
```

答案将是`3\. (vcnt = 3).`

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2011-04-22T20:45:57.260

我认为这种结果没有 SAP 参数。虽然下面的代码会交付。

```
LOOP AT intTab.

  AT END OF value.

    result = sy-tabix.

    write result.  

  ENDAT.

ENDLOOP. 
```

# svn - 如何管理分布在多个文件夹中的 SVN 项目？

> ID：394379
> 
> 赞同：3
> 
> 时间：2008-12-26T22:30:18.687
> 
> 标签：svn, tortoisesvn

这是我的 svn 存储库的样子：

```
/
/图书馆
  /libA
  /libB
  /libC
/工具
/项目
  /项目1
  /proj2
/网站

```

我正在对 libA 和 proj1 进行更改。我想设置它，以便我可以一起提交我在 libA 和 proj1 中的更改。不检查整个存储库的挑战。我希望解决方案对 Tortoise SVN 友好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-26T22:37:19.733

您可以在 Subversion 1.5 中使用稀疏签出。

在此处阅读有关它的更多信息：[稀疏目录](http://svnbook.red-bean.com/en/1.5/svn.advanced.sparsedirs.html)。

这将允许您将根存储库目录签出到本地目录，但不能将其下的所有内容签出。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T22:34:51.097

我听说过几种不同的方法来做到这一点，但我更喜欢的方法是通过[SVN Externals](http://claudio.cicali.org/article/71/svnexternals-micro-howto)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T22:37:41.200

您可能正在进入使用真正的 IDE 或普通命令行可能比任何 GUI 更强大的领域。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T23:15:21.637

IntelliJ 与内置的 SVN 完美集成。我用那个。

Tortoise SVN 是 SVN 的 Windows 资源管理器界面。但我几乎不使用它，因为 IntelliJ 非常好。

# vba - McAfee 从 VBA 模块中删除代码

> ID：394382
> 
> 赞同：5
> 
> 时间：2008-12-26T22:34:09.957
> 
> 标签：vba, excel, mcafee

我正在尝试编写一个 Excel 模块，在该模块中，它以在设计时创建的形式在新对象中动态插入代码。

我正在使用此代码，其中“代码”包含一个字符串，其中包含应进入 DstrFiles 对象的实际代码。

```
Dim DstrFiles As Object
 Set DstrFiles = ThisWorkbook.VBProject.VBComponents("DistributeFiles")

 With DstrFiles.CodeModule
    .InsertLines .CountOfLines + 1, Code
 End With 
```

我的问题是，当我使用 .InsertLines 时，McAfee 会从我的模块中删除整个代码，有没有办法解决这个问题？

首先，我使用以下命令创建标签：

```
Form1.Controls.Add("Forms.Label.1", "Label1", True) 
```

然后我使用 .InsertLines 创建一些代码以配合标签。

例如，我希望标签的背景颜色在有人点击它时变为红色。使用“.InsertLines”很容易做到这一点。

解决此问题的一种丑陋方法是预先创建一堆在后台准备好的代码，然后限制可能动态创建的标签数量。- 我希望它不会到那个地步。

我一直在谷歌搜索，这似乎是 McAfee 的一个已知问题。

有谁知道一种创建动态用户表单的方法，该表单可以将代码添加到使用 Contrls.Add 方法添加的新标签或按钮？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-08T03:01:40.103

您不应该通过编写创建控件的代码来生成新标签。

您应该在 Controls 集合上使用 .Add 方法来创建新标签。

例如：

```
UserForm1.Controls.Add("Forms.Label.1", "foo", True) 
```

您可以使用`WithEvents`来获取事件。

例如，在 UserForm1 中，

```
Public WithEvents a As MSForms.Label

Private Sub a_Click()

    MsgBox "label clicked"

End Sub

Private Sub CommandButton1_Click()

    Set a = UserForm1.Controls.Add("Forms.Label.1", "foo", True)
    a.Visible = True
    a.Caption = "Hi There"

End Sub 
```

如果要创建一个新添加控件的动态数组，则需要创建一个小包装类。[示例代码在这里。](http://www.vbforums.com/showpost.php?p=3109544&postcount=4)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T14:17:57.477

如果可能的话，我会建议不要动态生成代码（闻起来像自修改程序？）。

如果不知道您的具体问题可能很难说，但我敢打赌，使用具有必要参数的函数会有更好的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T22:17:24.437

您或许能够解决此版本的 McAfee。但是下一个版本的数据文件或其他恶意软件拦截器可能会阻止您。

因此，您可以创建这样的代码以在您的开发机器上运行，但在分发给客户时它永远不会（或只是暂时的）工作。

# c# - 在 .NET 中，是否需要注册 DLL？

> ID：394388
> 
> 赞同：11
> 
> 时间：2008-12-26T22:35:53.043
> 
> 标签：c#, .net, dllregistration

是否有必要在目标机器上注册已编译的 DLL（用 C# .NET 编写）。

目标机器将安装 .NET，只需将 DLL 放到目标机器上就足够了吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-27T01:07:03.987

我觉得你有点混淆了。为了使用它，从来不需要注册一个 dll。

使用 dll 只需要加载它（给定一个已知位置或者如果库位于系统路径中）并获取您想要使用的函数的地址。

在分发需要将某些条目添加到 Windows 注册表的 COM 或 ActiveX 对象时使用注册 dll。为了使用 COM 服务（例如），您需要引用 GUID（即唯一标识符），它允许您获取实现该服务（或提供对它的访问）的 dll 的句柄。有时您可以引用完全限定的名称并获得相同的结果。

为了使所有这些工作，需要注册 dll。这个“注册”过程只是在注册表中创建了几个条目，但主要是这两个：一个将 GUID 与 dll 的位置相关联（这样您就可以通过 GUID 引用它而不知道它的确切位置）和第二个将全名与 GUID 相关联。但同样，这仅适用于 COM 或 ActiveX 对象。

当您在 .NET 中开发应用程序时，项目中引用的库会在需要时自动加载，您无需担心查找或加载它们。为此，框架会检查引用库的两个位置。

*   第一个位置是应用程序路径。
*   第二个位置是 GAC。

GAC（全局程序集缓存）允许您有效地注册要在整个系统中使用的 dll，并作为旧注册机制的演变。

所以基本上你只需要把dll放在应用程序的同一个文件夹中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-26T22:39:05.627

您需要将它“拖放”到需要它的应用程序可以找到它的目录中。

如果有多个应用程序，或者您想将文件“拖放”到应用程序目录以外的某个位置，则通常需要调整 PATH 变量，或者在全局程序集缓存 (GAC) 中注册程序集。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-26T22:37:11.433

通常将 dll 放入目标计算机上的应用程序文件夹中就足够了。

如果 dll 必须对其他应用程序可用，那么您可能需要考虑[GAC](http://en.wikipedia.org/wiki/Global_Assembly_Cache)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-26T23:40:55.237

如果您希望[通过 com+ 访问程序集](http://dn.codegear.com/article/32754)。例如，使用非 .NET 应用程序（例如 VB6 winforms 应用程序）的 .NET 程序集中定义的类型。

如果您计划从另一个 .NET 应用程序访问程序集，则无需执行任何操作。如果您的程序集有一个强名称，那么将它放到 GAC 中可能是个好主意。否则，只需将其放在将要引用它的应用程序的目录中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-27T02:15:33.443

.NET 在 Windows 平台上的一大卖点是，默认情况下，.NET 程序集 DLL 不必注册，只需将它们放在同一个应用程序中即可由应用程序私下使用文件夹作为 EXE 文件。这是一个巨大的进步，因为它使开发人员能够避免 DLL/COM 地狱的冲突。

共享 DLL/COM 模块被证明是 Windows 最大的设计错误之一，因为它会导致用户安装的应用程序不稳定。安装一个新应用程序很可能会破坏一个运行良好的应用程序 - 因为新应用程序引入了更新版本的共享 DLL/COM 模块。（实践证明，对于开发人员来说，正确管理细粒度的版本依赖关系是一个太大的负担。）

使用 Maven 等构建存储库系统管理模块版本是一回事。Maven 工作得非常好。

但是，在分布于数百万用户的最终用户运行时环境中处理该问题是完全不同的事情。

.NET GAC 绝不是解决这个古老的 Windows 问题的充分解决方案。

私人使用的 DLL 程序集仍然是无限可取的。这是一种不费吹灰之力的方式，因为这些天磁盘空间非常便宜（这些天在 Fry 的 TB 驱动器上大约 100 美元可以）。与其他产品共享程序集并没有什么好处——但当穷人的用户遇到问题时，公司的声誉就会下降。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-29T19:52:11.280

实际上，不需要在目标机器上的 .NET 中注册 dll。

如果您在应用程序中引用 .dll，请单击项目中引用下的引用 .dll，查看属性并将“隔离”设置为 TRUE。

现在这将自动将此 .dll 包含在您的项目中，并且您的应用程序将使用包含在您的项目中的 .dll 的副本，而无需在目标系统上注册它。

要在此处查看此外观的工作示例：

[http://code.msdn.microsoft.com/SEHE](http://code.msdn.microsoft.com/SEHE)

有问题的 .dll 需要在您构建应用程序的系统上注册才能正常工作。但是，一旦您构建了项目，就无需在您部署应用程序或程序的任何系统上注册相关的 .dll。

使用此方法的另一个好处是，即使将来在相关目标系统上以相同名称注册了另一个 .dll，您的项目仍将继续使用您部署时使用的 .dll。这在 .dll 有多个版本并且您希望保持某种稳定性（例如使用您测试过的版本）时非常方便，但所有其他应用程序都将使用已注册的 .dll，除非它们也使用 isolated = true 方法。

上面的例子就是其中一种情况，Skype4COM 有很多版本，它是一个 Skype API .dll 并且可以经常更改。

这种方法允许上面的例子使用测试项目的 API .dll，每次用户安装新版本的 Skype 时，可能会安装这个 .dll 的修改版本。

另外，还有一些Skype客户端没有安装这个.dll，比如Skype客户端的商业版比较小，不包含这个.dll，所以在这种情况下，项目不会在那个.dll上失败丢失并且没有被注册，因为它被包含在项目中作为隔离 = true。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-26T22:39:09.840

应用程序可以使用 .NET dll，只需将其与应用程序放在同一文件夹中即可。

但是，如果您希望其他第三方应用程序找到该 DLL 并使用它，他们还必须将其包含在其分发中。这可能是不可取的。

另一种方法是在 GAC（全局程序集缓存）中注册 DLL。

# report - 如何向潜在买家展示您的代码？

> ID：394399
> 
> 赞同：10
> 
> 时间：2008-12-26T22:41:02.223
> 
> 标签：report, metrics, presentation, lines-of-code

我将向稍微不懂技术的观众演示我的代码，我需要向他们展示我在项目中获得的内容（*大约 15K 行代码*）。我试图让他们相信我已经花时间在这个项目上并且它处于良好状态。

这些人计划在这个产品上投资。因此，我应该让他们相信**这个应用程序值得他们花费的价格，并证明我花费的时间是合理的**，其次他们应该看到这是需要时间的，我知道我在做什么（*基本上我需要赢他们的信任*）。

*   除了“代码行”之外，我还可以使用哪些指标？（*也许是评论行？*）
*   从 .NET 项目生成报告的最佳工具（*最好是免费的）是什么？*

**更新 ：**

提供“项目成本 - cocomo”的一种方法也很酷，就像这样：

[![在此处输入图像描述](https://i.stack.imgur.com/Pguvm.gif)](https://i.stack.imgur.com/Pguvm.gif)

**发现：** [http](http://www.cms4site.ru/utility.php?utility=cocomoii) ://www.cms4site.ru/utility.php?utility=cocomoii将帮助您计算项目的估计成本。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-26T22:45:56.423

如果他们不是技术性的，那没关系。这就像试图向那些不了解汽车和自行车的人出售高端自行车一样。15k 行代码对他们来说并不重要，而 300k 行代码则无关紧要。

您需要找到除实际代码之外的其他内容来让他们赞叹不已。

您能否编写一些演示代码并告诉他们使用您的代码构建类似应用程序需要多短的时间？就像“如果你使用我的代码，你可以在 15 分钟内构建这个多媒体应用程序，而无需编写超过几行代码”。非技术人员通常喜欢节省时间和金钱。

这可能取决于他们在非技术部门的“轻微”程度。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-27T01:16:30.987

投资者只关心钱。投资者从退出开始，然后向后工作。知道了这一点，就可以根据他们在投资中获得的回报来推销你的项目。

关键点包括：

*   **你的专长：** 你知道你想卖的市场吗？您是否以某种方式利用您的专业知识使该项目成为现实？
*   **风险：** 使用现有的代码库可以降低时间和金钱方面的风险。他们可能会进行技术尽职调查以验证您的声明，所以在这里说实话。
*   **上市时间：** 拥有一个代码库将缩短他们的上市时间，这可能很重要。
*   **愿景：** 他们需要知道您的产品有未来。这是让他们兴奋的机会！

投资是关于未来的，而不是过去的，所以要明白你需要实现你所承诺的。你走到现在的道路可能很有趣，但在很大程度上与投资者无关。我想说的是出售愿景，而不是你现在或你曾经去过的地方。

祝你好运，希望你得到你需要的！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-26T23:39:05.863

从您的问题中我不清楚您是在谈论会购买*使用*您的产品还是*拥有*您的产品的人。

无论哪种情况，问问自己这些问题：

*   **“从我的用户的角度来看**，该产品为我的用户解决了哪些问题？”
*   “这个产品让用户做什么，**他们已经想做**，但又离不开它？”
*   “这个产品让用户做什么，**他们已经想做**，但没有它就不能那么容易做？”

功能无关紧要。菜单和对话框无关紧要（除非它们需要解释，在这种情况下它们在负面意义上很重要）。

**如果您想要产品（一个实例）的潜在买家感兴趣的数字，请谈谈买家**可以通过使用您的产品节省多少时间或金钱。

如果您想要对您的公司或产品股票的潜在买家感兴趣的数字，请从市场规模、您如何分析市场需求以及任何投资的投资回报率等方面进行讨论。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-27T00:02:33.947

我已经成功地以幻灯片形式向潜在客户展示了我们的自动化构建周期。我带他们参观了我们的“生产线”，就像参观工厂一样，展示了覆盖报告的漂亮彩色条、历史代码行的向上倾斜行、每个模块代码行细分的饼图​​。

然后我对实际建筑物周围的所有东西都做了同样的事情。所以有一个他们参与的需求管道，以及一个他们再次参与的测试/验证周期。

这对他们可能没有任何意义，但它向他们表明您可以控制您的流程，并控制交付的最终产品的质量。

请注意，尽管人们可能不是技术人员，但请尽量诚实。一旦他们在你的故事中发现一个小小的谎言，你就迷路了。很有可能后面有一个技术人员可以提出一个让你的纸牌屋倒塌的问题。

祝销售愉快！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-26T22:48:28.633

“好代码”无关紧要，除非你展示了它的中长期优势——增强的灵活性、简单性，在增加敏捷性的同时节省客户的时间/金钱。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-26T22:50:25.650

我认为向任何观众解释代码的更复杂的方面和投入其中的工作将有助于展示一个项目投入了多少工作和努力。

花在编码上的时间可能是一个很好的衡量标准。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-26T22:51:52.763

谈谈特点。解释你有什么工作或几乎工作。从他们感兴趣的东西开始。

如果可以的话，试着向他们展示他们关心的视觉效果。我认为在板上涂鸦几分钟比显示代码行更好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-26T22:53:30.870

唯一可能对买家（尤其是非技术买家）重要的是功能。我会专注于销售这些功能。您可能会考虑讨论您如何测试它以验证它是否按您声称的那样执行。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-26T22:51:40.640

我不会使用代码本身，因为非技术人员不会理解它。吹嘘数量可能毫无意义（非技术人员怎么知道 1MLOC 项目很*重要*？至于质量，您可以展示，例如，可维护性指标、测试覆盖率等。也可以随意炫耀您出色的工具链（持续集成等等），你对各种性能测试工具的掌握。此外，展示像 Workflow Foundation 这样的东西会有所帮助——客户喜欢看到他们的业务流程如何直接转化为带有图表符号的代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-26T23:55:10.793

**编辑**修改以反映 OP 的说明（在[此处](https://stackoverflow.com/questions/394399/how-to-present-your-code-to-potential-buyers#394468)发表评论），即这些潜在买家正在寻求转售该软件

转售商将寻找三样东西：

1.  有人会做更好、更便宜或更快的东西吗？
2.  这家伙能有效地利用我们的投资来生产更多产品吗？
3.  我们能卖掉这个家伙已经生产的东西，并将生产的东西吗？

如何解决第 1 点和第 2 点已在其他答案中得到很好的解决，但问题 3 对我们这些技术人员来说是最难证明的。这也是非常重要的——如果你能去找这些买家，给他们3个杀手锏，当他们打电话时，他们可以用更多的天赋和Powerpoint重复这些好处，你会有一个好的开始:)

你要做的主要事情是从你的工作中退后一步，看看：

*   **特点**：它有什么作用
*   **优点**：为什么更好
*   **好处**：为什么要客户关怀

**功能**最接近您作为开发人员所关心的内容，但与非技术买家几乎无关。**优势**是了解您的竞争对手和客户选择的重要一步。

通过将功能和优势结合在一起，您可以为客户带来许多**好处**，例如：

*   *使用我的软件将为您每笔交易节省 0.01 美元，或每年 40,000 美元*
*   *我的软件将使客户保留率提高 5%*
*   *您的管理员使用我的软件部署更改所需的时间将减少 15%*

这些是客户关心的事情：什么对公司有利，什么对*他们*有利。

老实说：最终客户不在乎你付出了多少努力（LoC 或任何其他指标），他们不在乎它写得有多好（评论、测试、任何其他指标），他们不在乎关心解决问题的难度，他们不关心功能。

他们唯一的要求是这将节省他们的时间/精力/金钱。你知道你为解决问题付出了多大的努力，并且很好地解决了问题，这是他们要求的关键，但它是次要的。你需要非常清楚为什么他们购买他们的东西将意味着他们会得到提升。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-29T10:44:22.760

### 对于 COCOMO - 项目成本估算

我找到了这个网站，这是一个手动过程，但它会做。

[http://www.cms4site.ru/utility.php?utility=cocomoii](http://www.cms4site.ru/utility.php?utility=cocomoii)

# iphone - 最佳实践：将视图动画化到 iPhone 上显示

> ID：394402
> 
> 赞同：1
> 
> 时间：2008-12-26T22:45:15.957
> 
> 标签：iphone, cocoa, cocoa-touch, core-animation

如果我希望使用 Core Animation 淡入淡出视图 - 让 UIView 与它被绘制到的视图在同一个 NIB 中是一种好习惯吗？我应该在另一个 NIB 文件中构建视图并从那里加载它吗？我希望在用户操作时同时显示三个小视图的动画。我想在 IB 中构建视图。在此处寻找最佳实践类型的响应。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T10:16:17.200

您可以将三个视图作为单独的 UIViews 放在一个 XIB 中，或者在一个视图中布置三个视图（否则，您必须将它们放置在代码中）。将它们的初始 alpha 值设置为 0.0，然后将它们淡入就像这样简单：

```
[UIView beginAnimations:@"fade" context:nil];
[UIView setAnimationDuration:1.0];
myViewOne.alpha = 1.0;
myViewTwo.alpha = 1.0;
myViewThree.alpha = 1.0;
[UIView commitAnimations]; 
```

如果您打算将它们全部显示在一起，我不会将这三个视图中的每一个都放在单独的 XIB 中。如果它们是永远不会一起显示的单独“屏幕”的一部分，我通常只会像这样分解东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:01:45.040

Apple 建议每个 UIViewController/UIView 组合使用一个 XIB。这是因为如果您将多个 ViewCONtrollers 和 Views 放置在同一个 XIB 中，它们会同时加载并为 XIB 的所有元素占用内存，即使只有一个元素在屏幕上。

推荐的方法是使用 MainWindow.xib 为您计划加载的每个 xib（UIViewController/UIView 组合）提供代理。

如果您只是加载子视图，如上所述，您可以在同一个 xib 中构建它们，或者在 viewDidLoad 或 viewWillAppear 中以编程方式构建它们（将在 xib 与您的“基本”视图一起加载后调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T23:30:20.220

我认为应该尽可能多地使用界面构建器...所以我建议每个视图都是自己的 xib 文件...请记住，如果两者之间的功能有很多重叠，您可以构建从 UIViewController 扩展的类层次结构意见。

# iphone - 使用 Interface Builder 的绑定（适用于 iPhone 应用程序）

> ID：394408
> 
> 赞同：10
> 
> 时间：2008-12-26T22:48:41.100
> 
> 标签：iphone, cocoa-touch, interface-builder

如何使用 Interface Builder 绑定 iPhone SDK 控件（比如 UISlider）？

与常规 Cocoa 应用程序不同，当使用 Interface Builder 打开 iPhone-app XIB 时，绑定选项卡似乎不存在

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-26T23:15:17.223

Cocoa 绑定在 iPhone SDK 中不可用。您必须像过去在 Mac 上一样“手动”完成所有操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-27T06:04:00.597

在 viewcontroller .h 文件中将控件声明为 IBOutlet。在 IB 中，将视图的文件所有者设置为视图控制器类（选择文件所有者，在检查器窗口中单击 (i) 按钮并将类设置为视图控制器）现在选择文件所有者，单击蓝色按钮检查器窗口中的白色箭头。将 UISlider 的 IBOutlet 绑定到视图上的 UISlider。

要在滑块更改时获取滑块的值，请在视图控制器中创建一个返回类型为 IBAction 的方法。在检查器窗口中，如果将其连接到 UISlider，它会为您提供多个选项供您选择。选择“值已更改”选项。现在，每次更改滑块的值时，都会调用您的 IBAction 方法。

希望有帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-15T06:31:51.100

[Apple 的开发中心](http://developer.apple.com/library/ios/#documentation/Miscellaneous/Conceptual/iPhoneOSTechOverview/PortingfromCocoa/PortingfromCocoa.html)记录了 iPhone 缺乏可可绑定支持。如果您是一名开始 iPhone 开发的 Cocoa 开发人员，这通常是一个有用的页面。

但是，仍然完全支持键值观察 (KVO)，但是您需要手动完成您在绑定中完成的部分。这使得在例如 UITableView 中呈现排序的、动态的项目列表比在 Mac OS X 上挂接 NSArrayController 更痛苦。另请参阅关于 SO 的[这个问题。](https://stackoverflow.com/questions/866158/why-isnt-there-nsarraycontroller-for-the-iphone)

# user-interface - 哪个因素 GUI 教程/示例应用程序？

> ID：394430
> 
> 赞同：9
> 
> 时间：2008-12-26T23:07:17.350
> 
> 标签：user-interface, factor-lang

是否有一个用 Factor 语言编写的非平凡示例应用程序，最好是用于 GUI 应用程序，它可以作为语言教程提供服务？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T16:50:23.300

有点晚了，但是有针对 Qt 的 Factor 绑定正在开发中。它们应该很快就会处于可用状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-01-07T21:38:44.913

不知道这是否符合“非平凡”的条件，但有一个计算器示例：[http ://re-factor.blogspot.com/2010/08/calculator-with-gui.html](http://re-factor.blogspot.com/2010/08/calculator-with-gui.html)

（github：[https](https://github.com/mrjbq7/re-factor/blob/master/calc-ui/calc-ui.factor) ://github.com/mrjbq7/re-factor/blob/master/calc-ui/calc-ui.factor ）

# python - Python：在windows下锁定目录访问

> ID：394439
> 
> 赞同：5
> 
> 时间：2008-12-26T23:16:23.150
> 
> 标签：python, windows, directory, locking

我希望能够在 Windows 下锁定目录访问。以下代码对 POSIX 系统下的文件或目录非常有效：

```
def flock(fd, blocking=False, exclusive=False):

    if exclusive:
        flags = fcntl.LOCK_EX
    else:
        flags = fcntl.LOCK_SH
    if not blocking:
        flags |= fcntl.LOCK_NB
    fcntl.flock(fd, flags) 
```

但是我只找到了一种方法来对文件执行锁定访问，而不是使用以下代码对目录执行锁定访问：

```
def flock(fd, blocking=False, exclusive=False):

    if blocking:
        flags = msvcrt.LK_NBLCK
    else:
        flags = msvcrt.LK_LOCK
    msvcrt.locking(fd.fileno(), flags, os.path.getsize(fd.name)) 
```

您知道如何改进此代码并能够锁定目录访问吗？

伯特兰

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T17:53:45.577

我不相信在 Windows 中的目录上使用flock() 是可能的。 [flock() 上的PHP 文档](http://us2.php.net/flock)表明它甚至不适用于 FAT32 文件系统。

另一方面，如果任何文件仍然打开，Windows 已经倾向于不允许您删除文件/目录。这一点，再加上智能地使用 ACL，可能会为您提供 95% 的等效解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T23:33:21.850

您可能可以做这样的事情来间接锁定具有后一个群功能的目录。

```
for file in os.listdir(dir):
 f = open(file)
 flock(f) 
```

这是一个受限版本，因为用户将能够在目录中创建新文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T08:41:06.707

是的，您是对的，至少我可以尝试锁定目录的每个文件，但这可能会很痛苦，因为我需要进入目录的所有子目录。在 POSIX 系统中这很容易，因为目录被视为文件，所以没有问题。但是在 Windows 中，当我尝试打开一个目录时，它并不喜欢那样。

```
open(dirname) 
```

引发异常：

```
OSError: [Errno 13] Permission denied: dirname 
```

我不太确定我的解决方案实际上是实现它的好方法。

# c# - 奇怪的空引用异常

> ID：394440
> 
> 赞同：0
> 
> 时间：2008-12-26T23:16:46.970
> 
> 标签：c#, .net, nullreferenceexception

所以我有这段代码负责远程计算机的命令确认，有时（比如 14 天一次或其他什么）以下行会引发空引用异常：

```
computer.ProcessCommandAcknowledgment( commandType ); 
```

真正让我烦恼的是我在它之前检查了一个空引用，所以我**不**知道发生了什么。这是其价值的完整方法：

```
 public static void __CommandAck( PacketReader reader, SocketContext context )
    {
        string commandAck = reader.ReadString();

        Type commandType = Type.GetType( commandAck );

        Computer computer = context.Client as Computer;

        if (computer == null)
        {
            Console.WriteLine("Client already disposed. Couldn't complete operation");
        }
        else
        {
            computer.ProcessCommandAcknowledgment( commandType );
        }
    } 
```

有什么线索吗？

编辑：ProcessCommandAcknowledgement：

```
 public void ProcessCommandAcknowledgment( Type ackType )
    {
        if( m_CurrentCommand.GetType() == ackType )
        {
            m_CurrentCommand.Finish();
        }
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-26T23:58:49.600

根据您提供的信息，在该位置出现空 ref 肯定是不可能的。所以下一个问题是“你怎么知道特定的行正在创建 NullReferenceException？” 您使用的是调试器还是堆栈跟踪信息？您是否正在检查代码的零售或调试版本？

如果是调试器，则各种设置组合基本上会导致调试器**出现**在不同的位置报告 NullRef。这样做的主要是 Just My Code 设置。

根据我的经验，我发现确定异常实际发生在哪一行的最可靠方法是...

1.  关闭江铃
2.  用调试编译
3.  调试器 -> 设置 -> 抛出 CLR 异常时中断。
4.  检查调试器窗口中的 StackTrace 属性

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T23:25:07.093

是否有可能`ReadString()`返回null？这将导致 GetType 失败。也许你收到了一个空包？或者，字符串可能与类型不匹配，因此稍后使用时 commandType 将为空。

**编辑**：您是否`m_CurrentCommand`在调用时检查过不为空`ProcessCommandAcknowledgment`？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-27T00:12:07.203

我敢打赌你的 TCP 帧代码有问题（如果你有的话！）

“PacketReader”可能暗示您不这样做。因为，从技术上讲，如果你这样做，它将被称为“FrameReader”或类似的东西。

如果涉及的两台 PC 位于本地 LAN 或其他地方，那么它可能会解释 14 天的间隔。如果您通过 Internet 尝试此操作，我敢打赌您的错误频率会更常见，尤其是在 WAN 带宽被争用的情况下。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-27T00:16:52.963

如果您打开了优化，它可能会将您指向一个非常错误的地方，它实际上发生了。

几年前，类似的事情发生在我身上。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-27T00:18:55.643

或者在某个地方可能发生线程竞争，其中上下文被另一个线程设置为空。这也可以解释错误的罕见性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-27T00:25:05.787

好吧，实际上只有几种可能性。

1.  不知何故，当您调用该例程时，您的计算机参考信息已被篡改。

2.  调用下的某些内容引发了空指针取消引用错误，但在该行检测到它。

看着它，我非常怀疑堆栈正在损坏，导致您的`computer`自动装置损坏。检查您遇到问题*的*子程序/方法/函数调用；特别是，检查您正在制作的“计算机”项目是否真的是您期望的类型。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-27T00:37:31.300

其他线程在做什么？

编辑：您提到服务器是单线程的，但另一条评论表明*这部分*是单线程的。如果是这种情况，您仍然可能遇到并发问题。

我认为，这里的底线是你要么有一个多线程问题，要么有一个 CLR 错误。你可以猜到我认为哪个更有可能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-27T00:48:34.850

> computer.ProcessCommandAcknowledgment(commandType);

你有调试符号可以进入这个吗？

空引用异常可能由 ProcessCommandAcknowledgement 抛出，并冒泡。

# jquery - 如何使用 jQuery 动画化 css 的变化

> ID：394450
> 
> 赞同：1
> 
> 时间：2008-12-26T23:25:31.057
> 
> 标签：jquery, hover, jquery-animate

是否可以使用 jquery 对 css 的更改进行动画处理？

如果有人愿意为我提供一个例子，我将非常感激。

本质上，我正在尝试通过使用 jQuery 操作 css 中的背景图像来为精灵技术设置动画。目标是为悬停设置动画，以便我得到一个很好的淡入淡出，而不仅仅是下面代码产生的突然切换。

这是我所在的位置：

HTML：

```
<h1 id="solomon">Solomon</h1> 
```

CSS：

```
body#default h1 {
text-indent: -9999px;
display: inline-block;
height: 213px;
}
body#default h1#solomon {
    background: transparent url(/images/S.gif) center top no-repeat;
    width: 183px;
    margin: 100px 0 0 216px;
    } 
```

查询：

```
$(function() {
$('h1').hover(function() {
    $(this).stop().css('background-position', 'center bottom');
}, function() {
    $(this).stop().css('background-position', 'center top');
});
}); 
```

现在它工作正常，但悬停时没有漂亮的动画。我想知道如何设置切换背景图像位置的动画效果。

感谢任何对此进行尝试的人。:)

* * *

我希望有人可以回答我的问题而无需指向我的教程？我对教程的问题是它们都强迫我改变我的 html，我现在非常锁定。

另外，为什么动画功能在我上面的示例（@CMS）中不起作用？

谢谢大家的帮助！:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-01T20:26:16.000

要创建淡入淡出效果，您需要将一个元素绝对放置在另一个元素之上，并为元素的不透明度设置动画以显示下方的图像。

由于您无法更改 HTML，我建议您使用 JavaScript 通过动态插入将显示 H1 标记的新图像的跨度来更改标记。

我在 jsbin.com 上整理了一个使用您的标记（即仅 H1 标记）的工作示例。我使用了 jqueryfordesigners.com 教程中的图像（因为它是我的），以便您了解所需的 CSS 更改。

具体来说，您需要将 H1 中的嵌套 SPAN 设置为绝对定位在 H1 内，以使其淡入：

[http://jsbin.com/adike/](http://jsbin.com/adike/)（编辑： http: [//jsbin.com/adike/edit/](http://jsbin.com/adike/edit/)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T23:32:49.230

[这篇文章](http://jqueryfordesigners.com/image-cross-fade-transition/)将让你开始`Two Image Technique`

**[更新]**

为您找到了更好的教程： [本文](http://swedishfika.com/2008/03/04/creating-a-fading-header/)将向您展示如何创建褪色图像（例如徽标）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-11T08:35:10.913

你必须使用[这个](http://plugins.jquery.com/project/backgroundPosition-Effect)插件来动画背景位置:)

# python - 使用 mod_wsgi 的 Python POST 数据

> ID：394465
> 
> 赞同：15
> 
> 时间：2008-12-26T23:35:59.507
> 
> 标签：python, mod-wsgi

这一定是一个非常简单的问题，但我似乎无法弄清楚。

我正在使用 apache + mod_wsgi 来托管我的 python 应用程序，并且我想获取以其中一种形式提交的帖子内容——但是，环境值和 sys.stdin 都不包含任何这些数据。介意帮我一把吗？

编辑：已经尝试过：

*   environ["CONTENT_TYPE"] = 'application/x-www-form-urlencoded' (无数据)
*   environ["wsgi.input"] 似乎是一种合理的方式，但是 environ["wsgi.input"].read() 和 environ["wsgi.input"].read(-1) 返回一个空字符串（是的, 内容已发布，并且 environ["request_method"] = "post"

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-27T01:22:33.457

[PEP 333](http://www.python.org/dev/peps/pep-0333/)说[你必须阅读 environ['wsgi.input']](http://www.python.org/dev/peps/pep-0333/#input-and-error-streams)。

我刚刚保存了以下代码并让 apache 的 mod_wsgi 运行它。有用。

你一定做错了什么。

```
from pprint import pformat

def application(environ, start_response):
    # show the environment:
    output = ['<pre>']
    output.append(pformat(environ))
    output.append('</pre>')

    #create a simple form:
    output.append('<form method="post">')
    output.append('<input type="text" name="test">')
    output.append('<input type="submit">')
    output.append('</form>')

    if environ['REQUEST_METHOD'] == 'POST':
        # show form data as received by POST:
        output.append('<h1>FORM DATA</h1>')
        output.append(pformat(environ['wsgi.input'].read()))

    # send results
    output_len = sum(len(line) for line in output)
    start_response('200 OK', [('Content-type', 'text/html'),
                              ('Content-Length', str(output_len))])
    return output 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-24T12:31:53.310

请注意，从技术上讲，在 wsgi.input 上调用 read() 或 read(-1) 是违反 WSGI 规范的，即使 Apache/mod_wsgi 允许这样做。这是因为 WSGI 规范要求提供有效的长度参数。WSGI 规范还说您不应该读取超过 CONTENT_LENGTH 指定的数据。

因此，上面的代码可能在 Apache/mod_wsgi 中工作，但它不是可移植的 WSGI 代码，并且在其他一些 WSGI 实现上会失败。要正确，请确定请求内容长度并将该值提供给 read()。

# javascript - jquery在父div中选择类

> ID：394470
> 
> 赞同：22
> 
> 时间：2008-12-26T23:44:36.713
> 
> 标签：javascript, jquery

我正在尝试更改图像的 alt，我通过选择图像的类（***`add_answer`***）单击

**注意：在不同** *的**contains 中多次显示****`.add_answer`****`div`*

```
jQuery(function(){   // Add Answer

    jQuery(".add_answer").click(function(){
        var count = $(this).attr("alt");
        count++;
        $('.a_type_'+count+'').show();
        $(this).parents("div:first").$('.add_answer').attr("alt", count);
    }); 

}); 
```

这条线似乎不起作用，我如何**`add_answer`**通过它的父类来选择这个类`div`

```
$(this).parents("div:first").$('.add_answer').attr("alt", count); 
```

还有人有想法吗？

单击时，我在尝试减小图像`alt`上的值时遇到问题`.add_answer``.destroy_answer`

```
jQuery(function(){   // Hide Answer

    jQuery(".destroy_answer").click(function(){
        $(this).parents("div:first").hide();
        var count = $('.add_answer').attr("alt");
        count--;
        $('.add_answer',$(this).parent('div:first')).attr('alt',count);

    }); 

}); 
```

问题线：

```
$('.add_answer',$(this).parent('div:first')).attr('alt',count); 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-26T23:49:07.077

您可以使用父 div 作为范围：

```
 $('.add_answer',$(this).parent('div:first')).attr('alt',count); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-26T23:46:57.847

这应该有效：

```
$(this).parent("div").find(".add_answer").attr("alt", count); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-27T00:46:23.250

你的代码几乎是正确的。所需的更改是在 .parents 方法之后使用 .find 而不是 .$。应避免使用 .parent 而不是 .parents，这样您的代码将更加不引人注目（准确地说 - 这样 img 可以是 div 的非直接子级）。

```
$(this).parents('div:eq(0)').find('.add_answer') 
```

您可以使用 :eq(2) 操纵 :eq(0) 来选择例如第三个父 div。

# embedded - 串口发送奇怪的数据

> ID：394483
> 
> 赞同：0
> 
> 时间：2008-12-26T23:55:33.633
> 
> 标签：embedded, arduino

所以我正在制作一个草图，从 USB 端口获取一个两位数，检查与该数字匹配的引脚状态，然后打开/关闭引脚。

[看看源头](http://pastebin.com/f34b63a34)

出于某种原因，当我通过 Arduino 串行监视器发送 13 时，我收到了这条消息： `Pin number is greater than 14, details: 490 51 541`

这意味着 IDE 正在发送奇怪的数字，或者 Arduino 处理错误。你们中的任何人都看到为什么这不起作用的问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T01:10:27.880

如果输入**ASCII**字符“1”然后“3”，那么`Serial.read()`将返回 49 和 51。这是因为在**ASCII**字符表中，“1”和“3”分别由数字 49 和 51 表示。如果您想找到用户输入的数字，您必须将其从**ASCII**转换。

我对 Arduino 语言不是很熟悉，但假设它类似于 C，您可以在[此处](http://pastebin.com/pastebin.php?diff=m4ea60bca)找到所需的更改。

我用另一种方式重写了程序，这对[Read](http://pastebin.com/m441a2fdb)*可能*更清楚。

源代码中使用的 '0' 只是“用于表示字符 '0' 的数字”的另一种说法，48 也是如此。在类 C 语言`'0' == 48`中`'1' == 49`, 等。

# opencv - 如何将 8 位 OpenCV IplImage* 转换为 32 位 IplImage*？

> ID：394488
> 
> 赞同：12
> 
> 时间：2008-12-27T00:02:24.460
> 
> 标签：opencv, iplimage, bpp, bits-per-pixel

我需要将 8 位 IplImage 转换为 32 位 IplImage。使用来自整个网络的文档，我尝试了以下事情：

```
// general code
img2 = cvCreateImage(cvSize(img->width, img->height), 32, 3);
int height    = img->height;
int width     = img->width;
int channels  = img->nChannels;
int step1     = img->widthStep;
int step2     = img2->widthStep;
int depth1    = img->depth;
int depth2    = img2->depth;
uchar *data1   = (uchar *)img->imageData;
uchar *data2   = (uchar *)img2->imageData;

for(h=0;h<height;h++) for(w=0;w<width;w++) for(c=0;c<channels;c++) {
   // attempt code...
}

// attempt one
// result: white image, two red spots which appear in the original image too.
// this is the closest result, what's going wrong?!
// see: http://files.dazjorz.com/cache/conversion.png
((float*)data2+h*step2+w*channels+c)[0] = data1[h*step1+w*channels+c];

// attempt two
// when I change float to unsigned long in both previous examples, I get a black screen.

// attempt three
// result: seemingly random data to the top of the screen.
data2[h*step2+w*channels*3+c] = data1[h*step1+w*channels+c];
data2[h*step2+w*channels*3+c+1] = 0x00;
data2[h*step2+w*channels*3+c+2] = 0x00;

// and then some other things. Nothing did what I wanted. I couldn't get an output
// image which looked the same as the input image. 
```

如您所见，我真的不知道自己在做什么。我很想知道，但如果我能正确完成这项工作，我会更喜欢它。感谢我得到的任何帮助！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-20T16:24:32.110

您正在寻找的函数是 cvConvertScale()。它会自动为您进行任何类型转换。您只需指定要按 1/255 的因子进行缩放（将范围 [0...255] 映射到 [0...1]）。

例子：

```
IplImage *im8 = cvLoadImage(argv[1]);
IplImage *im32 = cvCreateImage(cvSize(im8->width, im8->height), 32, 3);

cvConvertScale(im8, im32, 1/255.); 
```

注意`1/255.`- 中的点以强制进行双重除法。没有它，你得到的比例为 0。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-27T14:37:41.840

也许这个[链接](http://www.cs.iit.edu/~agam/cs512/lect-notes/opencv-intro/opencv-intro.html#SECTION00054000000000000000)可以帮助你？

**编辑**响应OP的第二次编辑和评论

你有没有尝试过

`float value = 0.5`

代替

`float value = 0x0000001;`

我认为浮点颜色值的范围是从 0.0 到 1.0，其中 1.0 是白色。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-27T21:04:30.840

浮点颜色从 0.0 到 1.0，uchars 从 0 到 255。以下代码修复它：

```
// h is height, w is width, c is current channel (0 to 2)
int b = ((uchar *)(img->imageData + h*img->widthStep))[w*img->nChannels + c];
((float *)(img2->imageData + h*img2->widthStep))[w*img2->nChannels + c] = ((float)b) / 255.0; 
```

非常感谢**Stefan Schmidt**帮我解决这个问题！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T05:07:06.873

如果你不放点 (.)，一些编译器会理解为 int 除法，给你一个 int 结果（在这种情况下为零）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-18T16:44:02.530

您可以使用 boost::shared_ptr 和模板元编程创建一个 IplImage 包装器。我已经做到了，我得到了自动垃圾收集，以及从一个深度到另一个深度或从一个通道到多通道图像的自动图像转换。

我已经调用了 API blImageAPI，它可以在这里找到： [http ://www.barbato.us/2010/10/14/image-data-structure-based-shared_ptr-iplimage/](http://www.barbato.us/2010/10/14/image-data-structure-based-shared_ptr-iplimage/)

它非常快，并且使代码非常可读，（有利于维护算法）

它也可以在 opencv 算法中代替 IplImage 使用，而无需更改任何内容。

祝你好运，写算法玩得开心！！！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-06T20:53:56.767

IplImage *img8,*img32;
img8 =cvLoadImage("a.jpg",1);

```
 cvNamedWindow("Convert",1);
    img32 = cvCreateImage(cvGetSize(img8),IPL_DEPTH_32F,3);
    cvConvertScale(img8,img32,1.0/255.0,0.0); 
```

//用于确认检查像素值（0 - 1之间）

```
 for(int row = 0; row < img32->height; row++ ){
                float* pt = (float*) (img32->imageData + row * img32->widthStep);
                for ( int col = 0; col < width; col++ )
                            printf("\n %3.3f , %3.3f , %3.3f ",pt[3*col],pt[3*col+1],pt[3*col+2]);                  
            }

    cvShowImage("Convert",img32);
    cvWaitKey(0);
    cvReleaseImage(&img8);
    cvReleaseImage(&img32);
    cvDestroyWindow("Convert"); 
```

# javascript - 将数据传递给 jQuery UI 对话框

> ID：394491
> 
> 赞同：83
> 
> 时间：2008-12-27T00:06:12.097
> 
> 标签：javascript, jquery, asp.net-mvc, jquery-ui, jquery-ui-dialog

我正在开发一个`ASP.Net MVC`网站，并在其上列出来自数据库查询的一些预订，其中包含`ActionLink`取消特定行的预订，`BookingId`如下所示：

**我的预订**

```
<table cellspacing="3">
    <thead>
        <tr style="font-weight: bold;">
            <td>Date</td>
            <td>Time</td>
            <td>Seats</td>      
            <td></td>              
            <td></td>
        </tr>
    </thead>            
    <tr>
        <td style="width: 120px;">2008-12-27</td>
        <td style="width: 120px;">13:00 - 14:00</td>
        <td style="width: 100px;">2</td>
        <td style="width: 60px;"><a href="/Booking.aspx/Cancel/15">cancel</a></td>
        <td style="width: 80px;"><a href="/Booking.aspx/Change/15">change</a></td>
    </tr>            
    <tr>
        <td style="width: 120px;">2008-12-27</td>
        <td style="width: 120px;">15:00 - 16:00</td>
        <td style="width: 100px;">3</td>
        <td style="width: 60px;"><a href="/Booking.aspx/Cancel/10">cancel</a></td>
        <td style="width: 80px;"><a href="/Booking.aspx/Change/10">change</a></td>
    </tr>  
</table> 
```

如果我可以使用`jQuery Dialog`弹出一条消息，询问用户是否确定要取消预订，那就太好了。我一直在尝试让它工作，但我一直坚持如何创建一个接受参数的 jQuery 函数，以便我可以替换

`<a href="/Booking.aspx/Cancel/10">cancel</a>`

和

`<a href="#" onclick="ShowDialog(10)">cancel</a>`.

然后该`ShowDialog`函数将打开对话框并将参数 10 传递给对话框，以便如果用户单击是，那么它将发布 href：`/Booking.aspx/Change/10`

我在这样的脚本中创建了 jQuery 对话框：

```
$(function() {
    $("#dialog").dialog({
        autoOpen: false,
        buttons: {
            "Yes": function() {
                alert("a Post to :/Booking.aspx/Cancel/10 would be so nice here instead of the alert");},
            "No": function() {$(this).dialog("close");}
        },
        modal: true,
        overlay: {
            opacity: 0.5,
            background: "black"
        }
    });
}); 
```

和对话框本身：

```
 <div id="dialog" title="Cancel booking">Are you sure you want to cancel your booking?</div> 
```

所以最后我的问题是：我怎样才能做到这一点？或者有更好的方法吗？

* * *

## 回答 #1

> 赞同：275
> 
> 时间：2010-08-11T12:41:47.067

jQuery 提供了一种为您存储数据的方法，无需使用虚拟属性或找到解决问题的方法。

绑定点击事件：

```
$('a[href*=/Booking.aspx/Change]').bind('click', function(e) {
    e.preventDefault();
    $("#dialog-confirm")
        .data('link', this)  // The important part .data() method
        .dialog('open');
}); 
```

还有你的对话：

```
$("#dialog-confirm").dialog({
    autoOpen: false,
    resizable: false,
    height:200,
    modal: true,
    buttons: {
        Cancel: function() {
            $(this).dialog('close');
        },
        'Delete': function() {
            $(this).dialog('close');
            var path = $(this).data('link').href; // Get the stored result
            $(location).attr('href', path);
        }
    }
}); 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-12-27T02:34:38.070

你可以这样做：

*   用课程标记`<a>`，说“取消”
*   通过作用于 class="cancel" 的所有元素来设置对话框：

    ```
    $('a.cancel').click(function() { 
      var a = this; 
      $('#myDialog').dialog({
        buttons: {
          "Yes": function() {
             window.location = a.href; 
          }
        }
      }); 
      return false;
    }); 
    ```

（加上你的其他选择）

这里的关键点是：

*   让它尽可能不引人注目
*   如果您只需要 URL，那么您已经在 href 中拥有它。

但是，我建议您将其设为 POST 而不是 GET，因为取消操作具有副作用，因此[不符合 GET 语义](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html)......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-27T13:20:59.777

就您使用 jQuery 所做的事情而言，我的理解是您可以像您拥有的那样链接函数，并且内部函数可以访问外部变量。您的 ShowDialog(x) 函数是否包含这些其他函数，您可以在其中重复使用 x 变量，它将被视为对外部函数参数的引用。

我同意 mausch 的观点，你真的应该考虑使用 POST 来执行这些操作，这将`<form>`在每个元素周围添加一个标签，但会降低自动脚本或工具触发 Cancel 事件的可能性。更改操作可以保持原样，因为它（可能只是打开一个编辑表单）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-27T23:20:11.970

我现在已经尝试了你的建议，发现它有点工作，

1.  对话 div 总是以纯文本形式写出
2.  使用 $.post 版本，它实际上是在调用控制器并实际取消预订的情况下工作，但对话框保持打开状态并且页面不会刷新。使用获取版本 window.location = h.ref 效果很好。

在下面查看我的“新”脚本：

```
$('a.cancel').click(function() {
        var a = this;               
        $("#dialog").dialog({
            autoOpen: false,
            buttons: {
                "Ja": function() {
                    $.post(a.href);                     
                },
                "Nej": function() { $(this).dialog("close"); }
            },
            modal: true,
            overlay: {
                opacity: 0.5,

            background: "black"
        }
    });
    $("#dialog").dialog('open');
    return false;
}); 
```

});

有什么线索吗？

哦，我的 Action 链接现在看起来像这样：

```
<%= Html.ActionLink("Cancel", "Cancel", new { id = v.BookingId }, new  { @class = "cancel" })%> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-28T04:57:50.340

查看您的代码，您需要添加关闭窗口和更新页面的功能。在您的“是”功能中，您应该编写：

```
 buttons: {
            "Ja": function() {
                $.post(a.href);
                $(a). // code to remove the table row
                $("#dialog").dialog("close");
            },
            "Nej": function() { $(this).dialog("close"); }
        }, 
```

删除表格行的代码写起来并不有趣，所以我会让你处理细节，但基本上，你需要在发布后告诉对话框要做什么。这可能是一个聪明的对话，但它需要某种方向。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-03T02:26:40.307

经过几个小时的尝试/捕获后，我终于有了这个工作示例，它在 AJAX POST 上工作，新行附加到表中（这是我真正的问题）：

Tha魔法附带链接：

```
<a href="#" onclick="removecompany(this);return false;" id="remove_13">remove</a>
<a href="#" onclick="removecompany(this);return false;" id="remove_14">remove</a>
<a href="#" onclick="removecompany(this);return false;" id="remove_15">remove</a> 
```

这是使用 AJAX POST 和 Jquery Dialog 的最后一步：

```
 <script type= "text/javascript">/*<![CDATA[*/
    var $k = jQuery.noConflict();  //this is for NO-CONFLICT with scriptaculous
     function removecompany(link){
        companyid = link.id.replace('remove_', '');
    $k("#removedialog").dialog({
                bgiframe: true,
                resizable: false,
                height:140,
                autoOpen:false,
                modal: true,
                overlay: {
                    backgroundColor: '#000',
                    opacity: 0.5
                },
                buttons: {
                    'Are you sure ?': function() {
                        $k(this).dialog('close');
                        alert(companyid);
                        $k.ajax({
                              type: "post",
                              url: "../ra/removecompany.php",
                              dataType: "json",
                              data: {
                                    'companyid' : companyid
                                    },
                              success: function(data) {
                                    //alert(data);
                                    if(data.success)
                                    {
                                        //alert('success'); 
                                        $k('#companynew'+companyid).remove();
                                    }
                          }
                        }); // End ajax method
                    },
                    Cancel: function() {
                        $k(this).dialog('close');
                    }
                }
            });
            $k("#removedialog").dialog('open'); 
            //return false;
     }
    /*]]>*/</script>
    <div id="removedialog" title="Remove a Company?">
        <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
        This company will be permanently deleted and cannot be recovered. Are you sure?</p>
    </div> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-02-03T11:41:47.810

这对我有用：

`<a href="#" onclick="sposta(100)">SPOSTA</a>`

```
function sposta(id) {
        $("#sposta").data("id",id).dialog({
            autoOpen: true,
            modal: true,
            buttons: { "Sposta": function () { alert($(this).data('id')); } }
        });
    } 
```

当您在对话框警报显示 100 中单击“Sposta”时

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-27T23:42:34.640

好的，div 标签的第一个问题很简单：我只是在其中添加了一个`style="display:none;"`，然后在显示对话框之前，我在我的对话框脚本中添加了这个：

```
$("#dialog").css("display", "inherit"); 
```

但是对于后期版本，我仍然不走运。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-17T01:06:38.687

只是给你一些想法可能会对你有所帮助，如果你想完全控制对话框，你可以尽量避免使用默认按钮选项，并在你的#dialog div中自己添加按钮。您还可以将数据放入链接的某些虚拟属性中，例如 Click。需要时调用 attr("data") 。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-02-22T17:55:49.740

我采用的受 Boris Guery 启发的解决方案如下所示： 链接：

```
<a href="#" class = "remove {id:15} " id = "mylink1" >This is my clickable link</a> 
```

绑定一个动作到它：

```
$('.remove').live({
        click:function(){
            var data = $('#'+this.id).metadata();
            var id = data.id;
            var name = data.name;
            $('#dialog-delete')
                .data('id', id)
                .dialog('open');    
            return false;
        }
    }); 
```

然后访问 id 字段（在本例中值为 15：

```
$('#dialog-delete').dialog({
    autoOpen: false,
    position:'top',
    width: 345,
    resizable: false,
    draggable: false,
    modal: true,
    buttons: {            
        Cancel: function() {

            $(this).dialog('close');
        },
        'Confirm delete': function() {
            var id = $(this).data('id');
            $.ajax({
                url:"http://example.com/system_admin/admin/delete/"+id,
                type:'POST',
                dataType: "json",
                data:{is_ajax:1},
                success:function(msg){

                }
            })
        }
    }
}); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-06-09T17:43:54.200

我希望这有帮助

```
$("#dialog-yesno").dialog({
    autoOpen: false,
    resizable: false,
    closeOnEscape: false,
    height:180,
    width:350,
    modal: true,
    show: "blind",
    open: function() {
        $(document).unbind('keydown.dialog-overlay');
        },
    buttons: {
        "Delete": function() {
            $(this).dialog("close");
            var dir = $(this).data('link').href;
            var arr=dir.split("-");
            delete(arr[1]);
        },
    "Cancel": function() {
        $(this).dialog("close");
        }
    }
});

<a href="product-002371" onclick="$( '#dialog-yesno' ).data('link', this).dialog( 'open' ); return false;">Delete</a> 
```

# asp.net - 为什么我的 ApplicationCache 传回的是引用而不是值？

> ID：394492
> 
> 赞同：0
> 
> 时间：2008-12-27T00:06:32.377
> 
> 标签：asp.net, datatable, application-cache

这是我刚刚遇到的一件奇怪的事情。

我有一个 Web 应用程序，它在 ApplicationCache 中存储了一个小的 DataTable，以将查询量减少到一个单独的位置，因为数据是一个不经常更改的查找表。

我在给定页面内访问此 DataTable 两次。一次将数据绑定到我的 Page_Load 方法中的下拉列表：

```
dtDeptDivAct = GetAllDeptDivActCodes()
dtDeptDivAct.DefaultView.Sort = "LongDescription ASC"
ddlDeptDivAccount.DataSource = dtDeptDivAct.DefaultView
ddlDeptDivAccount.DataTextField = "LongDescription"
ddlDeptDivAccount.DataValueField = "Id"
ddlDeptDivAccount.DataBind() 
```

...并且在我的 ddlDeptDivAct_SelectedIndexChanged 事件中选择索引时从表中检索其他数据：

```
Dim dtDeptDivAct As DeptDivActDataTable

If ddlDeptDivAccount.SelectedIndex > 0 Then

   dtDeptDivAct = GetAllDeptDivActCodes()
   dtDeptDivAct.DefaultView.RowFilter = "Id = " & ddlDeptDivAccount.SelectedValue

   txtAddFundingDept.Text = DirectCast(dtDeptDivAct.DefaultView(0).Row, DeptDivActRow).Department.ToString.PadLeft(2, Char.Parse("0"))
   txtAddFundingDiv.Text = DirectCast(dtDeptDivAct.DefaultView(0).Row, DeptDivActRow).Division.ToString.PadLeft(2, Char.Parse("0"))
   txtAddFundingAct.Text = DirectCast(dtDeptDivAct.DefaultView(0).Row, DeptDivActRow).Activity.ToString.PadLeft(3, Char.Parse("0"))

Else

   txtAddFundingDept.Text = ""
   txtAddFundingDiv.Text = ""
   txtAddFundingAct.Text = ""

End If 
```

*注意：GetAllDeptDivActCodes() 方法是从 ApplicationCache 对象返回表的简单方法。*

The web page works fine. I can select my value and the proper values are insterted into the TextBox. However, when I go to a different page and come back to this page. My drop down list only has 1 value available for selection.

When I pulled up the debugger, I noticed that upon returning to the web page, when the GetAllDeptDivActCodes method returns the DataTable from the cache, the DefaultView RowFilter property was still applied to the DataTable, which was causing the problem.

I have fixed the issue for now by simply resetting the the DefaultView RowFilter once processing is done in the SelectedIndexChanged event, but why is the Application returning what appears to be a reference to the DataTable in the application cache when I was expecting a seperate copy (or value) of the object?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T02:06:14.820

This is by design. Whenever you store an object in the Application State or Session State you are returned the actual object (or as you put it a reference to the object) when you access it. By design .NET objects are almost always passed by reference unless you specify otherwise. Forexample when passing objects to Functions they are passed by reference.

# python - Python中有没有一种简单的方法来创建一个可以在一个线程中写入并在另一个线程中读取的文件？

> ID：394500
> 
> 赞同：3
> 
> 时间：2008-12-27T00:25:16.007
> 
> 标签：python

在我正在编写的 python 程序中，我有一个线程，它遍历内存中的一个大结构并将其增量写入一个类似文件的对象中。我有另一个线程，它接受一个类似文件的对象并将其写入磁盘。有没有一种简单的方法可以将两者连接起来，以便从第一个线程输入的任何数据都将被缓冲到第二个线程？

具体来说，我正在尝试将数据传递给 subprocess.Popen()。该过程将从标准输入读取，但您不能将“类似文件”的对象传递给 Popen，因为它调用 stdin.fileno() 并且除非您有真实文件，否则会爆炸。

相反，您需要将 PIPE 参数传递给 Popen，它允许您将 proc.stdin 用作类似文件的对象。但是，如果您已经有了一个类似文件的对象，那么似乎没有一个很好的方法可以将它们两个蛋黄在一起。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-27T00:32:30.483

您应该使用[Queue](http://docs.python.org/library/queue.html)模块跨线程共享顺序数据。您必须创建一个类似文件的 Queue 子类，其中 .read 和 .write 相互阻塞，中间有一个缓冲区。

OTOH，我想知道为什么第一个线程首先无法写入真实文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-27T01:33:04.137

使用[`shutil`的`copyfileobj()`](http://docs.python.org/library/shutil.html#shutil.copyfileobj)功能：

```
import shutil
import subprocess

proc = subprocess.Popen([...], stdin=subprocess.PIPE)

my_input = get_filelike_object('from a place not given in the question')

shutil.copyfileobj(my_input, proc.stdin) 
```

无需使用线程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T01:32:40.160

如果您希望数据最终出现在子流程中，我认为如果您已经有一个类似文件的对象，那么设计中有问题。然后，您应该首先安排将它们写入子进程，而不是先将它们写入其他文件之类的东西。编写数据的人应该允许灵活地指定输出流，这应该是子流程管道。

或者，如果作者坚持创建自己的流对象，你应该让它完成写入，然后才启动子进程，从第一次写入的结果中馈送它。eg如果是StringIO对象，写入后取其值，写入管道；这里不需要线程同步。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T00:36:28.713

我不清楚你想做什么。这听起来像是一个普通旧管道的工作，它是一个类似文件的对象。但是，我猜您的意思是您有其他类型的流。

听起来也很像您想要的是 python [Queue](http://docs.python.org/library/queue.html)，或者可能是[tempfile](http://docs.python.org/library/tempfile.html#module-tempfile)。

# c# - jQuery .load 似乎在一个意想不到的地方运行

> ID：394504
> 
> 赞同：3
> 
> 时间：2008-12-27T00:34:17.127
> 
> 标签：c#, asp.net, javascript, jquery, ajax

因此，我试图从 .aspx 页面加载一些返回的 html，但是在执行 AJAX 请求所依赖的一些事情之前，需要触发单击事件。更具体地说，我正在这样做。当用户在文本字段中键入时，此函数将运行...

```
function KeyPress() {
  $("#" + HiddenButtonId).click();
  $("#test").load("TempJumpToAJAX.aspx");
} 
```

然后 $("#" + HiddenButtonId).click(); 确实在代码隐藏文件中设置了一些会话数据。具体来说...

```
Session["SearchText"] = Search.Text; 
```

然后， $("#test").load("TempJumpToAJAX.aspx"); 调用返回新建选择框的 .aspx 页面...

```
 Response.Expires = -1;

        StringBuilder builder = new StringBuilder();

        builder.Append("<select id=\"testListId\" name=\"testList\" size=\"4\" style=\"width:200px;\">");
        builder.Append("<option>");
        builder.Append(Session["SearchText"]);
        builder.Append("</option>");            
        builder.Append("</select>");

        Response.ContentType = "text/HTML";
        Response.Write(builder.ToString());
        Response.End(); 
```

问题是，订单似乎搞砸了，它首先尝试附加 Session["SearchText"]，然后运行 ​​click 事件运行的代码。所以它的功能更像这样......

```
function KeyPress() {
  $("#test").load("TempJumpToAJAX.aspx");
  $("#" + HiddenButtonId).click();
} 
```

命令颠倒的地方。所以实际上发生的是会话变量有一个空字符串，而不是用户在文本框中键入的内容。对我来说奇怪的是，它似乎不应该有一个空字符串，它似乎应该什么都没有，因为此时会话变量还没有被初始化为任何东西。我真的不知道发生了什么。我猜这归咎于缺乏经验。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-27T02:00:44.067

你在这里混合技术。hiddenButtonID click 事件试图对页面进行完整的回发，而 AJAX 调用不会进行回发。没有理由回帖，然后通过 AJAX 调用跟进。AJAX 的目的是消除回发页面的需要，而只是使用对服务器的小回调重新加载页面上的少量 HTML。您应该在 AJAX 调用参数中将该数据传递给服务器，而不是访问 HiddenButtonID click 事件处理程序中的搜索文本框文本。

以下客户端脚本应该执行此操作。

```
 function KeyPress() {
  $("#test").load("TempJumpToAJAX.aspx", {searchText: $("#").val()});
} 
```

在此代码中，您将获取搜索文本框的 ID，然后使用 jQuery 检索该文本框的值。这将作为名为“searchText”的 POST 变量传递到 TempJumpToAJAX.aspx 页面。您应该能够通过访问“TempJumpToAJAX.aspx”页面中的 Request['searchText'] 变量来访问这些数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T11:05:09.193

您正在做的另一个智能扩展是不要在按下键后立即进行 ajax 调用。如果用户快速输入长字，您将触发多个 ajax http 请求，其速度快于它们返回和更新 UI 的速度。

这会增加您的服务器负载，并可能使客户端的 UI 变得迟缓。

相反，onkeypress，存储所有适当的详细信息，然后调用

var timeout = setTimeout('some_method()',100);

它说在 100 毫秒内调用 some_method()。您应该在按键方法中做的第一件事是使用 clearTimeout 取消/清除 Timeout 调用。

[http://www.w3schools.com/js/js_timing.asp](http://www.w3schools.com/js/js_timing.asp)

some_method() 还应该清除任何超时，然后发出 http ajax 请求。

这里的最终效果是您的 ajax 请求会稍微延迟，但如果用户按下另一个键，则永远不会发生。或者换一种说法，在用户停止/暂停输入之前，不要尝试触发 ajx 请求。100 毫秒可能太高或太低，但希望你能明白！

您还应该注意处理“服务器缓慢”的情况。考虑一下：

*   用户输入“hello”，暂停 1 秒，您触发一个以“hello”为参数的 ajax 请求
*   用户继续输入“world”，因此文本字段现在包含“hello world”，并停止输入。
*   您使用“hello world”作为参数触发第二个 ajax 请求。
*   第二个请求（对于“hello world”）首先返回，你更新你的 UI
*   第一个请求（对于“hello”）返回，你再次更新你的 UI。

哎呀！让服务器在返回给客户端的 (json) 数据中包含原始查询字符串。当客户端取回 ajax 数据时，检查结果/数据是否与当前文本字段中的查询（“hello”/“hello world”）匹配。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T07:35:56.697

有一个 JQuery 插件封装了前面的答案所说的内容。它称为[TypeWatch](http://www.dennydotnet.com/post/TypeWatch-jQuery-Plugin.aspx)。它允许在用户停止在文本字段中输入指定的毫秒数后触发函数。我以前用过，效果很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T18:04:55.833

惊人的！感谢大家，您的所有答案都非常有见地。我了解到的真正问题是我不知道如何使用该 ajax 请求发送变量。这里。

```
$("#test").load("TempJumpToAJAX.aspx", {searchText: $("#").val()}); 
```

还有mintywalker，感谢您的洞察力。一切都很好。

# mootools - Mootools 请求 - 无法使示例工作

> ID：394514
> 
> 赞同：1
> 
> 时间：2008-12-27T00:43:29.713
> 
> 标签：mootools, xmlhttprequest

我已经下载了 Request 和 Request.HTML 的示例，但都无法正常工作。我将它们解压缩到一个文件夹并浏览到它们的 index.html 以按原样执行它们，但响应始终是“请求失败”。不知道为什么。

我用不同的排列与他们一起玩，可以让请求完成，但它总是失败。有什么方法可以找到失败的原因吗？我尝试了三种不同的浏览器关闭了我的防火墙，使用了相对和绝对文件引用，但没有任何效果。我错过了一些非常明显的东西吗？我会发布代码，但它是完全一样的例子......

任何帮助都是极好的。

干杯，

贾斯汀。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T15:05:14.510

大多数任何网络服务器都应该工作。只是您的文件系统没有像 Web 服务器那样“响应”浏览器请求：

> 在本地（针对文件系统）执行的 ajax 请求无法正常工作，因为 ajax 逻辑正在寻找状态更改和服务器响应，而您的文件系统都没有提供这两者

-- [http://forum.mootools.net/viewtopic.php?id=5009](http://forum.mootools.net/viewtopic.php?id=5009)

XMLHttpRequest 对象可以处理的不仅仅是 HTTP 请求，但至少在 mootools 中，它并不意味着。并且“file:///...”不是 HTTP 请求。它只是从您的文件系统中获取一个文件并将其显示在浏览器中。

所以好消息是：任何网络浏览器，包括在本地机器上运行的最基本的浏览器，都应该可以正常工作:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T00:46:56.103

如果我没记错的话，大多数浏览器中的 AJAX 请求不能通过本地文件系统完成——你需要一个像 Apache 这样的实际 Web 服务器。在 Windows 中，[XAMPP](http://www.apachefriends.org/en/xampp-windows.html)将让您在几分钟内启动并运行 Apache。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-11T10:44:00.010

The `XMLHttpRequest()` succeeds cause there's nothing wrong with making the local call. it's just different and the problem is in the buggy mootools `isSuccess` function. You gotta override it the `Request` options. Here's how jquery does it

```
 // Determines if an XMLHttpRequest was successful or not
httpSuccess: function( xhr ) {
    try {
        // IE error sometimes returns 1223 when it should be 204 so treat it as success, see #1450
        return !xhr.status && location.protocol === "file:" ||
            // Opera returns 0 when status is 304
            ( xhr.status >= 200 && xhr.status < 300 ) ||
            xhr.status === 304 || xhr.status === 1223 || xhr.status === 0;
    } catch(e) {}

    return false;
}, 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T01:16:08.540

杰出的！！非常感谢！我将它上传到我最近的网络服务器，果然它可以工作。

我确实尝试过直接从我的文件系统进行一些 Ajax 调用，而不使用任何 javascript 库 - 使用 XMLHttpRequest() - 它工作得很好，所以这看起来确实是一个奇怪的限制。我可以确定这将始终在任何网络服务器上工作，无论多么基本？只是我正在处理的这个项目将使用多个托管环境，主要是纯 HTML 类型的站点，用于客户端环境，我无法控制......是否有最低规范？

干杯；）

# windows - 确保为 32 位 Windows 编写的程序与 64 位 Windows 兼容

> ID：394521
> 
> 赞同：11
> 
> 时间：2008-12-27T00:52:27.450
> 
> 标签：windows, 64-bit, backwards-compatibility

虽然我的理解是没有根本原因为 32 位硬件/操作系统编写的程序不能在 64 位硬件/操作系统上运行，但实际上，我发现许多用于 32 位版本 Windows 的程序不会在 64 位版本的 Windows 上工作。示例包括许多流行的安全实用程序（大多数产品来自 Norton 和 Check Point 的 Zone Alarm）和一些游戏（我一直试图让 Grand Theft Auto 4 运行几个星期，但无济于事 - 当然，这可能与与 GTA4 相关的许多其他问题有关，但这既不是这里也不是那里）。

我听说程序不兼容可能是由于不想从“Program Files (x86)”文件夹运行这样简单的事情，但还有哪些其他原因？为什么为 32 位系统编写的病毒扫描程序或防火墙不能在 64 位系统上运行？当一切理论上都向后兼容时，为什么游戏无法运行？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-27T16:00:05.510

这个线程有很多错误信息。

在 64 位窗口上运行 32 位应用程序时：

*   大多数兼容性问题出现在应用程序尝试安装内核模式驱动程序时。不能在 64 位操作系统上安装 32 位驱动程序。这几乎肯定是防火墙的问题。它试图连接到 TCP/IP 驱动程序堆栈。
*   没有模拟器！32 位目标代码完全由 cpu 全速本地执行。
*   不支持旧的 16 位代码。这打破了很多安装程序。
*   访问正确的文件夹*通常*不是问题。当 32 位程序在 %windir%\system32\ 中打开文件时，操作系统会自动将其重定向到 %windir%\syswow64。注册表的某些部分也是如此。这里有一些潜在的陷阱，但它们通常是假设各种 WINAPI Get...Directory() 函数返回的字符串与它们在 Windows 95 中所做的相同。
*   不管它是在 10 年前还是昨天编译的，那么 C/C++ 指针仍然是 32 位（4 字节）和所有假设的代码——包括 SendMessage()！——仍然有效。在您开始转换为 64 位编译器之前，8 字节指针问题不会出现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-27T01:10:28.053

这里提供了我找到的最好的解释，它基本上说 32 位程序运行在一个仿真层上，这不允许您从在 64 位环境中运行的本机程序获得的系统访问权限：

[http://blogs.msdn.com/oldnewthing/archive/2008/12/22/9244582.aspx](http://blogs.msdn.com/oldnewthing/archive/2008/12/22/9244582.aspx)

我认为这意味着像 GTA4 这样的程序的问题来自模拟层，没有产生在 32 位本机系统上发现的预期结果。这就是为什么您一直看到 Microsoft 版本兼容性更新的原因。

以下是 MSDN 对此事的看法：

[http://msdn.microsoft.com/en-us/library/bb427430(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb427430(VS.85).aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-27T01:07:15.953

驱动程序是一个不同的故事：http: [//support.microsoft.com/kb/896456](http://support.microsoft.com/kb/896456)

Zone Alarm 使用 Check Point 创建的特殊 32 位驱动程序进行监控。这可能是造成该应用程序问题的原因。至于侠盗猎车手4？我不知道。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-27T01:17:15.807

可能有很多原因。

任何被编程为低电平的应用程序都可能需要 32 位寄存器。novatrust 发布的 Zone Alarm 驱动程序就是一个很好的例子。GTA4 可能正在使用汇编来提高几个点的性能，这可能会导致任何结果，甚至只是假设 C++ 上的 32 位。例如下面的代码：

```
struct GPoint
{
  int x;
  int y;
}

// Array of twenty GPoints
GPoint[] myArr = malloc(20 * sizeof(GPoint);

GPoint* myPointer = myArr;
int index = GetIndexAffectedPoint();

// Invert X and Y for the point
myPointer += 8*index;
swap(myPointer); 
```

我知道这个例子很天真，但无论如何，在那个代码中你假设你的结构是 8 个字节长（x 整数的 4 个字节和 y 整数的 4 个字节）但在 64 位系统中实际上是两倍长所以你最终会交换错误的观点......这样的事情在低级语言上经常发生，特别是在试图提高性能时......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-27T22:48:59.710

[32 位到 64 位的迁移注意事项](http://www.navo.hpc.mil/usersupport/IBM/XLC/compiler/ref/rucl64mg.htm)

**编辑**：[替代链接](http://www.cs.unb.ca/docs/spdocs/vac/compiler/ref/rucl64mg.htm)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-14T01:01:32.880

安全应用程序就是一个不好的例子。他们都针对未记录的事物执行不受支持的事物。从一个 32 位版本的 Windows 到另一个版本的更改足以破坏它们，更不用说迁移到 64 位了。

也就是说，有一些兼容性填充程序可以在**32 位上修复您的代码，而当应用程序是****64 位**时不会。这是因为 Microsoft 假定您已经在 64 位上对其进行了测试。

一个由此产生的问题是**.NET 应用程序**。在 32 位系统上运行时，该 exe 会被**调整**为 32 位——其中有兼容性**填充**程序来修复您的错误。如果您的客户碰巧在 64 位系统上运行，则可执行文件将被转换为 64 位，而那些保护您免受自己侵害的兼容性垫片将**不再**存在。

Chris Jackson 对此有一篇不错的博客文章：[Windows Vista 64-Bit 上的 Shimming Applications](http://blogs.msdn.com/cjacks/archive/2008/12/01/shimming-applications-on-windows-vista-64-bit.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-14T01:11:15.337

问题可能是驱动程序。对于游戏，它可能是某种黏糊糊的 DRM 方案。尝试获取游戏的无 CD 破解，这样您就可以在没有 DRM 的情况下运行它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-27T01:03:27.253

如果您使用的是文件系统或注册表，请确保您**访问了正确的文件夹**。作为 x86 程序，您可能希望访问“Program Files (x86)”、“SysWOW64”、“WOW6232Node”等文件夹，而不是 x64 文件夹。

带有 x86 应用程序（如 Norton 和 Check Point 的 Zone Alarm）的产品无法运行其 x86 驱动程序，因为**驱动程序需要 x64**才能由操作系统运行。

# cocoa-touch - 似乎应该很容易：横向滚动文本字段

> ID：394530
> 
> 赞同：1
> 
> 时间：2008-12-27T01:09:22.500
> 
> 标签：cocoa-touch

我有一个正在处理的应用程序处于横向模式并且不旋转。但是我无法让文本字段旋转。我已经投入了好几个小时，所以如果这是一个简单的答案，请不要太苛刻......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T05:58:47.597

您是否使用 Interface Builder 来创建视图？在这种情况下，以横向模式将 UITextField 添加到 UIView。如果您不知道如何使用 IB 在横向模式下创建视图，请在 IB 中打开 UIView 对象。视图的右上角有一个小箭头。单击该箭头可将视图旋转到横向模式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-07T00:59:41.307

编辑您的 Info.plist 文件，使其包含“初始设备方向”键并指定 UIDeviceOrientationLandscapeLeft（根据 Apple 的 UI 指南，如果应用以横向方式打开，主页按钮应该在右侧）。一些样本已经在 plist 中附带了这个属性，但大多数都没有。

# build-automation - When should you not use automated testing for a web application?

> ID：394541
> 
> 赞同：1
> 
> 时间：2008-12-27T01:19:30.967
> 
> 标签：build-automation, automated-tests

Assume I'm using an interpreted language to power a medium or large application, and that the application is tested by hand (no unit tests, not integration tests, etc). Support for said product will not be dropped any time in the foreseeable future, and new development happens daily.

Are there some situations in which it would *not* be beneficial to begin implementing an automated test suite of some sort?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T01:48:38.897

Situations where one should not implement automated unit testing:

1.  When the application is at the end of it's lifecycle and is about to be discarded
2.  When management treatens to sack you for devoting extra effort to testing
3.  When the existing system is so obfuscated and poorly designed that adding tests would only be practical if the software were scrapped and redone from scratch
4.  When doing so will make your possition redundant

Other than that I can't think of a single reason not to start adding unit tests. Unit tests can help make it easier to change and redesign your system. It should be a part of the daily work of a developer and not some optional extra.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T01:26:29.690

Any time you want to guarantee employment for a bunch of people doing error-prone hand testing.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T01:40:04.920

Automated testing is just one tool available for testing. It finds a specific class of defects. Doing only unit tests or only automated UI testing or only manual testing won't get you the best results.

Automated UI tests are great at catching regression. They are worth doing on any reasonably complex application that is under active maintenance.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T06:23:36.267

When automated testing would trigger events or leave behind data in the system that would interfere with its proper operation.

# .net - 使用多个 LINQ to SQL DataContexts 添加相关数据

> ID：394542
> 
> 赞同：1
> 
> 时间：2008-12-27T01:21:45.113
> 
> 标签：.net, sql-server, linq, linq-to-sql

我正在使用 Linq to SQL 开发一个桌面应用程序。从我收集的信息来看，最好让 DataContext 对象保持短暂，但我遇到了以下难题：

我的应用程序有很多我想在客户端缓存的查找类型数据。我想缓存它的原因是因为我不想在执行大型 ETL 类型操作时为需要插入的每个子记录查找适当的父记录。

当我对数据库执行更新时，我需要将我更新的记录与此查找数据相关联。现在，使用单个全局 DataContext，这很容易：我只需将新的子记录添加到查找对象的关系集合中，然后点击 SubmitChanges()。

但是，如果我从最初从中获取数据的数据上下文中创建新的数据上下文，我如何才能最好地管理更新这些相关数据？我不能将缓存的数据与我的新 DataContext 一起使用，因为它来自不同的数据。

这一切都很令人困惑 - 我应该放弃并学习实体框架吗？

提前非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T16:54:04.263

在断开数据连接时，实体框架往往会*更加努力。*您应该能够相当轻松地使用带有附加/分离的 LINQ-to-SQL。当然，您并不总是需要设置*引用*来关联数据；您还可以选择设置相关的*id* - 即您通常有一对属性：

*   SomethingId（外键身份值）
*   某事（参考）

您可能可以只设置 Id 而无需触及参考。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T03:33:01.213

您可以使用分离/附加来删除与检索对象的数据上下文的关联，然后在准备更新时将其连接到新的数据上下文。

更多信息[在这里](http://weblogs.asp.net/omarzabir/archive/2007/12/08/linq-to-sql-how-to-attach-object-to-a-different-data-context.aspx)。

您可以做的另一件事是查看[nHibernate](http://www.hibernate.org/343.html)并将[Linq 用于 nHibernate](http://ayende.com/Blog/archive/2007/03/16/Linq-for-NHibernate.aspx)。

# apache - htdigest 文件格式

> ID：394552
> 
> 赞同：7
> 
> 时间：2008-12-27T01:41:32.577
> 
> 标签：apache, hash, md5, htdigest

我正在尝试编写一些代码来处理 htdigest 密码文件。我能找到的文档似乎声称该文件的格式是：

```
user:realm:MD5(user:realm:pass) 
```

如果是这样，那为什么这对我不起作用？我使用命令行 htdigest 创建了一个文件，因此：

```
htdigest -c test b a 
```

当提示输入密码时，我输入了“c”。这将创建一个包含以下内容的文件：

```
a:b:02cc8f08398a4f3113b554e8105ebe4c 
```

但是，如果我尝试导出这个哈希，我不能，

```
echo a:b:c | md5 
```

给我“49d6ea7ca1facf323ca1928995420354”。我在这里有什么明显的遗漏吗？

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-27T01:53:47.653

`echo`默认情况下添加一个尾随新行：

```
echo -n a:b:c | md5 
```

应该按您的预期工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T01:49:13.043

嗯，我似乎已经回答了我自己的问题。我的测试用例有缺陷，'echo' 添加了额外的字符（不确定是哪个）。例如

```
echo a:b:c | wc 
```

[给出 6 个字符而不是 5 个。在http://md5-hash-online.waraxe.us/](http://md5-hash-online.waraxe.us/)计算哈希值会给出正确的值。对不起大家！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-22T22:10:41.890

以下是为给定用户设置密码的方法。

```
sudo htdigest /etc/apache2/.htdigest yourrealm.com yourusername 
```

# .net - x64 计算机可以同时安装 x86 和 x64 .net 运行时吗？

> ID：394553
> 
> 赞同：4
> 
> 时间：2008-12-27T01:45:02.973
> 
> 标签：.net

x64 计算机可以同时安装 x86 和 x64 .net 运行时吗？

如果是这样，我如何确保程序在 x64 运行时而不是 x86 运行时上运行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-27T01:49:50.937

除非您告诉它不要这样做，否则 VS 应该构建一个针对任何 CPU 的程序集（即与平台无关）。如果可以，.NET 运行时将运行 x64 版本，否则它将运行 x86。

我的理解是 x86 和 x64 版本都安装在 x64 机器上（查看 %WINDIR% 下的 Microsoft.NET 文件夹，您应该可以找到 Framework 和 Framework64。

干杯!

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-27T02:15:10.543

是的。

但**请注意**！IIS 6.0 是 Windows Server 2003 附带的版本，[只能在一种模式下运行](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/13f991a5-45eb-496c-8618-2179c3753bb0.mspx?mfr=true)。所以要知道，如果你想在 IIS 6 中的同一个 IIS 实例上混合 32 位和 64 位应用程序，你将会受到伤害。不过，IIS 7 (Windows Server 2008) 不会遇到这个问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-27T01:57:52.777

是的。x64 .NET 框架同时安装 x86 .NET 框架，以便它可以运行 32 位强制二进制文件（只有在它们 P/Invoke 32 位二进制文​​件时才应该强制执行）。

# f# - 豹纹单声道上的 F#。序列转换错误

> ID：394554
> 
> 赞同：1
> 
> 时间：2008-12-27T01:48:15.167
> 
> 标签：f#, functional-programming

我遇到了这个已[回答的问题](https://stackoverflow.com/questions/332871/f-xml-parsing)，但我似乎无法编译代码。我在 Seq.cast 上收到以下错误：

错误 FS0039：未定义值、构造函数、命名空间或类型“cast”。

我在豹上使用 Mono 2.0.1_1 和 F# 1.9.4.19。在单声道下运行时 f# 有什么奇怪的地方吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T06:06:23.120

您需要升级到最新版本的 F# 1.9.6.2（也称为九月 CTP）： [http ://www.microsoft.com/downloads/details.aspx?FamilyID=61ad6924-93ad-48dc-8c67-60f7e7803d3c&displaylang= zh](http://www.microsoft.com/downloads/details.aspx?FamilyID=61ad6924-93ad-48dc-8c67-60f7e7803d3c&displaylang=en)

干杯，罗伯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T23:50:16.293

谢谢罗布。就是这样。我能够在 1.9.4.19 中使用 map_to_typed 解决它。

Seq.map_to_typed (fun e -> e :> System.Xml.XmlNode)

# c++ - boost::filesystem::path 用于 unicode 文件路径？

> ID：394564
> 
> 赞同：2
> 
> 时间：2008-12-27T02:02:33.830
> 
> 标签：c++, path, boost-filesystem

有没有办法将 boost::filesystem::path 与 unicode 文件路径一起使用？特别是我想将它与 std::wstring 一起使用，而不是 std::string。

我在 Windows 平台上工作，有时我需要处理一个包含 unicode 字符的文件路径。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-27T03:48:50.667

查看[头文件](http://www.boost.org/doc/libs/1_37_0/boost/filesystem/path.hpp)，我看到一个使用 std::wstring 模板化的 wpath。

# ruby-on-rails - 无法对唯一属性的记录进行排序

> ID：394566
> 
> 赞同：0
> 
> 时间：2008-12-27T02:09:10.103
> 
> 标签：ruby-on-rails, ruby

使用以下代码，我只需要返回“point”属性唯一的记录。我自己似乎无法到达那里。

```
uniques = Item.find_all_by_item_id(item_id)
uniques.sort! {|a, b| b.point <=> a.point } # how do I reject the equal points? 
```

换句话说..我猜，你是如何制作**[0, 1, 1, 1, 2, 3, 3, 4, 4, 7] #=> [0, 2, 7] 的？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T03:06:13.450

这个怎么样：

```
# Get the number of items with each point value
counts = Item.count("point", :group => "point")

# Get the IDs of all entries that only show up once
unique_ids = counts.collect { |count| count[0] if count[1] == 1 }.compact

unique_items = Item.find_all_by_id(unique_ids) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T03:10:02.070

我可以想到几种方法来做到这一点：

```
uniques.reject!{|u| uniques.select{|x| x == u}.size > 1} 
```

基本上遍历 uniques 数组，然后查看数组中是否有多个项目。显然有很多聪明的方法可以加快速度，但对于小型阵列，这应该有效。

或者

```
h = Hash.new(0)
uniques.each{|u| h[u] += 1}
h.reject{|k,v| v > 1}.keys 
```

基本上计算每个项目在哈希中出现的次数，如果它不止一个拒绝它，然后只看键。

# c# - C# - 序列化时如何使用通用列表的接口

> ID：394567
> 
> 赞同：2
> 
> 时间：2008-12-27T02:10:02.690
> 
> 标签：c#

我有一个通用列表说，我想序列化它。我想为无法序列化的通用列表使用接口，因此您必须使用实例。像这样 MyClass 实现了 IMyClass。

```
List<IMyClass> list = DeserializeMyClass(path);    //Can't do this right 
```

所以必须这样做

```
List<MyClass> list = DeserializeMyClass(path); 
```

所以问题是我现在可以投到

```
List<IMyClass> ilist = (IMyClass)list; 
```

马尔科姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-27T02:35:49.690

这会起作用，但我不确定这是最好的方法：

```
List<Test> list = new List<Test>();
List<ITest> ilist = list.ConvertAll<ITest>(x => (ITest)x); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-27T03:57:38.400

您似乎遇到了 C# 3.0 缺乏协变和反变的事实。

您可能想使用：

```
list.Cast<IMayClass>().ToList(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-06T09:32:38.943

您可以使用 BinaryFormatter 对接口进行序列化和反序列化，但这不是 Xml 序列化...您所描述的正是我所需要的。此外，我所有的具体类都是通用的。我有：IMyInterface interface MyConcreteClass1 class MyConcreteClass2 class

而且我还必须使用 Xml 序列化来序列化此类对象的集合（列表）......看起来这是不可能的！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-06T19:31:24.553

我意识到这是一个老问题，但对于那些正在寻找答案的人来说，如何做到这一点是 .NET v4

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.Serialization.Formatters.Binary;

    namespace ConsoleApplication6
    {
        internal class Program
        {
            private static void Main(string[] args)
            {
                List<ImyInterface> list = new List<ImyInterface>();

                list.Add(new MyClass {MyData = "Test1", SpecialData = "special"});
                list.Add(new MyOtherClass {MyData = "Test2", OtherData = "other"});

                Serialize("c:\\test.dat", list);
                List<ImyInterface> theList = Deserialize<List<ImyInterface>>("c:\\test.dat");
            }

            public static void Serialize<T>(string filename, T objectToSerialize)
            {
                Stream stream = File.Open(filename, FileMode.Create);
                BinaryFormatter bFormatter = new BinaryFormatter();
                bFormatter.Serialize(stream, objectToSerialize);
                stream.Close();
            }

            public static T Deserialize<T>(string filename)
            {
                Stream stream = File.Open(filename, FileMode.Open);
                BinaryFormatter bFormatter = new BinaryFormatter();
                T objectToSerialize = (T) bFormatter.Deserialize(stream);
                stream.Close();
                return objectToSerialize;
            }
        }

        public interface ImyInterface
        {
            string MyData { get; set; }
        }

        [Serializable]
        public class MyClass : ImyInterface
        {
            public string MyData { get; set; }
            public string SpecialData { get; set; }
        }

        [Serializable]
        public class MyOtherClass : ImyInterface
        {
            public string MyData { get; set; }
            public string OtherData { get; set; }
        }
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T02:26:38.023

好的，这应该是：

```
Listl<IMyclass> list = DeserializeMyClass(path); //Can't do this right 
```

所以必须这样做：

```
List<MyClass> list = DeserializeMyClass(path); 
```

所以问题是我现在可以转换为：

```
List<IMyclass> ilist = (IMyClass)list; 
```

# language-agnostic - Code Golf 新年版 - 整数到罗马数字

> ID：394574
> 
> 赞同：17
> 
> 时间：2008-12-27T02:21:02.980
> 
> 标签：language-agnostic, code-golf, rosetta-stone, roman-numerals

编写一个程序，接受一个命令行参数 N 并打印出相应的[Roman Numeral](http://en.wikipedia.org/wiki/Roman_numerals)。

例如 N = 2009 应该打印 MMIX。

假设这应该适用于 0 < N < 3000。

[（在圣诞节版](https://stackoverflow.com/questions/392788/code-golf-christmas-edition-how-to-print-out-a-christmas-tree-of-height-n)玩我的第一轮代码高尔夫很开心，并认为这可能适合新年。谷歌搜索看看这是否在其他地方出现过，看起来没有，但如果这让我知道太难或太容易，或者规则需要改变。）

快乐MMIX！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-14T21:46:32.147

## Perl：69 笔（数一下！）

*包括*调用perl在内的六十九招：

```
$ perl -ple's!.!($#.=5x$&*8%29628)=~y$IVCXL4620-8$XLMCDIXV$d!eg;last}{'
3484
MMMCDLXXXIV 
```

*   读取一行，写入一行。
*   适用于 0 到 3999（含）。（打印 0 的空字符串。）
*   在 Perl 高尔夫比赛中，这通常被记为 62 杆 = 58 为代码 + 4 为开关。
*   为什么，是的，那些*是*不匹配的大括号。谢谢你的提问。=)

致谢：最初归功于[Ton Hospel](http://groups.google.com/group/pl.comp.lang.perl/browse_frm/thread/6e0afdfe37ec51be/dbf17d1a9c9adee0?hl=en&fwc=1)。涉及不匹配大括号的技巧来自`rev.pl`这篇[文章](http://www.perlmonks.org/?node_id=130140)（顺便说一句，它很*巧妙*）。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-27T02:49:21.317

在 C# 中，作为扩展方法`Int32`：

```
public static class Int32Extension {
    public static string ToRomanNumeral(this int number) {
        Dictionary<int, string> lookup = new Dictionary<int, string>() {
            { 1000000, "M_" },
            { 900000, "C_D_" },
            { 500000, "D_" },
            { 400000, "C_D_" },
            { 100000, "C_" },
            { 90000, "X_C_" },
            { 50000, "L_" },
            { 40000, "X_L_" },
            { 10000, "X_" },
            { 9000, "MX_"},
            { 5000, "V_" },
            { 4000, "MV_" },
            { 1000, "M" },
            { 900, "CM" },
            { 500, "D" },
            { 400, "CD" },
            { 100,"C" },
            { 90, "XC" },
            { 50, "L" },
            { 40, "XL" },
            { 10, "X" },
            { 9, "IX" },
            { 5, "V" },
            { 4, "IV" },
            { 1, "I" }
        };

        StringBuilder answer = new StringBuilder();
        foreach (int key in lookup.Keys.OrderBy(k => -1 * k)) {
            while (number >= key) {
                number -= key;
                answer.Append(lookup[key]);
            }
        }
        return answer.ToString();
    }
} 
```

下划线应在相应字母上方的上划线为真正的罗马数字。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-27T02:55:21.337

通用口齿不清（SBCL）。“wc -c”计算的 63 个字符。

```
(format t "~@R~%" (parse-integer (elt *posix-argv* 1)))
(quit) 
```

这仅适用于最多 3999 的数字。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-27T03:49:49.913

C#：179 个字符（不包括空格/制表符）

```
 static string c(int a)
    {
        int[] v = { 1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1 };
        var s = ""; 
        for ( var i = 0; i < 13; i++ )
            while (a >= v[i])
            {
                a -= v[i];
                s += "M CM D CD C XC L XL X IX V IV I".Split()[i];
            }
        return s;
    } 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-27T03:10:38.887

Perl，19 笔。保证适用于 1 到 12 之间的值。

```
sub r{chr 8543+pop} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-27T10:35:55.697

**语言：JavaScript**。

*129 个字符，没有添加格式*

以下代码是`pl.comp.lang.javascript`几年前在 newsgrup 上进行的编码测验的结果。我不是代码的作者。

```
function rome(N,s,b,a,o){
  for(s=b='',a=5;N;b++,a^=7)for(o=N%a,N=N/a^0;o--;)
  s='IVXLCDM'.charAt(o>2?b+N-(N&=~1)+(o=1):b)+s;return s
} 
```

*Elus 的原始帖子*

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-27T08:28:29.820

Python，173 字节。

```
r=lambda n:o[n]if n<10 else''.join(dict(zip('ivxlc','xlcdm'))[c]for c in r(n//10))+o[n%10]
o=' i ii iii iv v vi vii viii ix'.split(' ')
import sys
print r(int(sys.argv[1])) 
```

（我第一次看到这个算法是在 Gimpel's *Algorithms in Snobol4 中*；Snobol 更优雅地表达了它。）

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-27T20:33:53.553

### 语言：C，字符数：174

```
#define R(s,v)for(;n>=v;n-=v)printf(#s);
main(int n,char**a){n=atoi(a[1]);R(M,1000)R(CM,900)R(D,500)R(CD,400)R(C,100)R(XC,90)R(L,50)R(XL,40)R(X,10)R(IX,9)R(V,5)R(IV,4)R(I,1)} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-27T05:57:25.460

## `Perl 5.10`

```
perl -nE'@l=qw{1 I 4 IV 5 V 9 IX 10 X 40 XL 50 L 90 XC 100 C 400 CD 500 D 900 CM 1000 M};
$o="";while(@l){$o.=pop(@l)x($_/($c=pop @l));$_%=$c;}say$o' 
```

您输入一行，它会为您提供罗马数字等价物。第一个版本甚至允许您输入多行。

这是一个较短的版本，仅适用于一行，并且忽略了边缘情况。所以`4`变成`IIII`了`IV`.

```
perl -nE'@l=qw{1 I 5 V 10 X 50 L 100 C 500 D 1000 M};
while(@l){$o.=pop(@l)x($_/($c=pop @l));$_%=$c;}say$o' 
```

这是第一个版本作为 Perl 脚本的样子。

```
use 5.010;
while(<>){
  @l=qw{1 I 4 IV 5 V 9 IX 10 X 40 XL 50 L 90 XC 100 C 400 CD 500 D 900 CM 1000 M};
  $o="";
  while(@l){
    $o .= pop(@l) x ($_/($c=pop @l));
    # $l = pop @l;
    # $c = pop @l;
    # $o .= $l x ($_/$c);

    $_ %= $c;
  }
  say $o;
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-27T06:14:18.907

## [派克](http://pike.ida.liu.se/generated/manual/modref/ex/predef_3A_3A/String/int2roman.html)

60 个字符，有效范围为 0 到 10000：

```
int main (int c, array a) {
    write(String.int2roman((int)a[1]));
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-10-27T13:07:56.800

一个简单的 Haskell 版本，仍然保持清晰。**205 个**字符，包括空格。

```
l = ["M","CM","L","CD","C","XC","L","XL","X","IX","V","IV","I"]
v = [1000,900,500,400,100,90,50,40,10,9,5,4,1]
roman n i
    | n == 0 = ""
    | n >= v!!i = l!!i ++ roman (n-v!!i) i
    | otherwise = roman n (i+1) 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-27T05:41:38.537

Perl，145 笔画（如果你去掉所有的换行符，这是可选的），对 1..3999 有效：

```
%t=qw(1000 M 900 CM 500 D 400 CD 100 C 90 XC 50 L 40 XL 10 X 9 IX 5 V 4 IV 1 I);
$d=pop;
for(sort{$b<=>$a}keys%t){$r.=$t{$_}x($d/$_);$d%=$_}
print$r 
```

有人会说我可以使用`say`，但我这里没有`say`-capable Perl 版本。`say`如果使用作品，请随意从笔画数中减去 2 。:-)

对于非 Perl 程序员，这个程序利用了许多有用的 Perl 特性：

1.  哈希是由偶数长度的列表构成的。
2.  可以使用紧凑的语法指定字符串列表，使用`qw`.
3.  字符串可以自动强制转换为整数，如在`<=>`对键进行排序时使用的比较运算符。
4.  有一个`x`操作员可以复制字符串/列表。不幸的是，在这里打高尔夫球，与 ;`x`具有相同的优先级`/`。如果`/`更高，括号也是可选的。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-04-15T17:13:27.337

## J，20个字符！

```
'MDCLXVI'#~(7$5 2)#: 
```

用法：

```
 'MDCLXVI'#~(7$5 2)#: 2009
MMVIIII 
```

好吧，它不能正确地做减法，但是嘿，它很酷！

解释;

`(7$5 2)`

这需要正确的参数（列表`5 2`）并将其转换为大小为 7 的列表 - 即`5 2 5 2 5 2 5`.

`(7$5 2)#: 2009`

这执行“反基”操作 - 基本上执行迭代 div 和 mod 操作，返回 list `2 0 0 0 0 0 1 4`。

然后`#~`使用前面的列表作为计数，将相应的字符拉出`'MDCLXVI'`。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-02T10:27:42.777

**红宝石，136 个字符**

```
n = $*[0].to_i
for k,v in [1e3,900,500,400,100,90,50,40,10,9,5,4,1].zip %w{M CM D CD C XC L XL X IX V IV I}
  until n < k
    n -= k
    print v
  end
end 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-12-27T03:05:31.830

在 Python 中 - 取自[ActiveState](http://code.activestate.com/recipes/81611/)（学分：Paul Winkler）并压缩了一下：

```
def int2roman(n):
   if not 0 < n < 4000: raise ValueError
   ints = (1000, 900,  500, 400, 100,  90, 50,  40, 10,  9,   5,  4,   1)
   nums = ('M',  'CM', 'D', 'CD','C', 'XC','L','XL','X','IX','V','IV','I')
   result = ""
   for i in range(len(ints)):
      count = int(n / ints[i])
      result += nums[i] * count
      n -= ints[i] * count
   return result 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-12-27T10:22:27.487

### 语言：dc（通过 shell） 字符数：122

编辑： q 相当于 2Q

```
dc -e '[I]1[IV]4[V]5[IX]9[X]10[XL]40[L]50[XC]90[C]100[CD]400[D]500[CM]900[M]?1000[szsz2Q]sq[~Sa[d0!<qrdPr1-lbx]dsbxLarz3<c]dscx10P' <<<$1 
```

编辑：通过优化主循环堆栈操作再增加两个字符

```
dc -e '[I]1[IV]4[V]5[IX]9[X]10[XL]40[L]50[XC]90[C]100[CD]400[D]500[CM]900[M]?1000[szsz2Q]sq[~Sa[d0!<qrdPr1-lbx]dsbxLarz3<c]dscx10P' <<<$1 
```

编辑：保存 2 个字符

```
dc -e '[I]1[IV]4[V]5[IX]9[X]10[XL]40[L]50[XC]90[C]100[CD]400[D]500[CM]900[M]1000?[sz2Q]sq[r~r[d0!<qSardPrLa1-lbx]dsbxrszz2<c]dscx10P' <<<$1 
```

以前的版本：

```
dc -e '[I]1[IV]4[V]5[IX]9[X]10[XL]40[L]50[XC]90[C]100[CD]400[D]500[CM]900[M]1000?[sz2Q]sq[r~r[d0!<qSaSadPLaLa1-lbx]dsbxrszz2<c]dscx10P' <<<$1 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-07-04T18:59:31.393

我不是 Haskell 专家，这对于成为赢家来说太长了，但这是我不久前写的解决 Euler #89 的解决方案。

```
toRoman 0 = ""
toRoman 1 = "I"
toRoman 2 = "II"
toRoman 3 = "III"
toRoman 4 = "IV"
toRoman n
| n >= 1000 = repeatRoman 'M' 1000
| n >= 900 = subtractRoman "CM" 900
| n >= 500 = subtractRoman "D" 500
| n >= 400 = subtractRoman "CD" 400
| n >= 100 = repeatRoman 'C' 100
| n >= 90 = subtractRoman "XC" 90
| n >= 50 = subtractRoman "L" 50
| n >= 40 = subtractRoman "XL" 40
| n >= 10 = repeatRoman 'X' 10
| n >= 9 = subtractRoman "IX" 9
| n >= 5 = subtractRoman "V" 5
| otherwise = error "Hunh?"
where
    repeatRoman c n' = (take (n `div` n') (repeat c)) ++ (toRoman $ n `mod` n')
    subtractRoman s n' = s ++ (toRoman $ n - n') 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-27T02:50:25.417

来自一种叫做 LPC（Pike 的前身）的模糊的类 C 语言：

```
string roman_numeral(int val) {
    check_argument(1, val, #'intp);
    unless(val)
        return "N";
    string out = "";
    if(val < 0) {
        out += "-";
        val = -val;
    }
    if(val >= 1000) {
        out += "M" * (val / 1000);
        val %= 1000;
    }
    if(val >= 100) {
        int part = val / 100;
        switch(part) {
        case 9      :
            out += "CM";
            break;
        case 6 .. 8 :
            out += "D" + ("C" * (part - 5));
            break;
        case 5      :
            out += "D";
            break;
        case 4      :
            out += "CD";
            break;
        default     :
            out += "C" * part;
            break;
        }
        val %= 100;
    }
    if(val >= 10) {
        int part = val / 10;
        switch(part) {
        case 9      :
            out += "XC";
            break;
        case 6 .. 8 :
            out += "L" + ("X" * (part - 5));
            break;
        case 5      :
            out += "L";
            break;
        case 4      :
            out += "XL";
            break;
        default     :
            out += "X" * part;
            break;
        }
        val %= 10;
    }
    switch(val) {
    case 9      :
        out += "IX";
        break;
    case 6 .. 8 :
        out += "V" + ("I" * (val - 5));
        break;
    case 5      :
        out += "V";
        break;
    case 4      :
        out += "IV";
        break;
    default     :
        out += "I" * val;
        break;
    }
    return out;
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-12-27T03:44:37.443

**Python，190 字节**。基于来自[ActiveState](http://code.activestate.com/recipes/81611/)的片段，通过[Federico](https://stackoverflow.com/questions/394574/code-golf-new-year-edition-integer-to-roman-numeral#394602)。

一些小的优化：删除多余的 int() 调用，拆分字符串以获取数组，删除空格，...

```
import sys
n=int(sys.argv[1])
N=(1000,900,500,400,100,90,50,40,10,9,5,4,1)
r=""
for i in range(len(N)):
 c=n/N[i]
 r+='M,CM,D,CD,C,XC,L,XL,X,IX,V,IV,I'.split(',')[i]*c
 n-=N[i]*c
print r 
```

**编辑**：多余的，不是虚假的，并删除范围检查 - 感谢[Chris](https://stackoverflow.com/users/13/chris-jester-young)和[dreeves](https://stackoverflow.com/users/4234/dreeves)！[从balabaster](https://stackoverflow.com/users/40650/balabaster)偷了使用内联符号数组的想法。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-12-27T03:56:56.173

VB：193 个字符

```
Function c(ByVal a)
    Dim v() = {1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1}
    Dim s = ""
    For i = 0 To 12
        While a >= v(i)
            a -= v(i)
            s += "M|CM|D|CD|C|XC|L|XL|X|IX|V|IV|I".Split("|")(i)
        End While
    Next
    Return s
End Function 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-11-29T16:11:54.930

Excel 8 个字符（不包括数字）：

=罗马（N）

工作量高达 3000。

舌在脸颊

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-12-27T05:09:59.143

## Java：286 个有效字符

```
public class R {

    String[]x="M,CM,D,C,XC,L,X,IX,V,I".split(",");
    int[]n={1000,900,500,100,90,50,10,9,5,1};

    String p(String s,int d,int i){return 10<=i?s:n[i]<=d?p(s+x[i],d-n[i],i):p(s,d,i+1);}

    public static void main(String[] a) {
        System.out.println(new R().p("",Integer.parseInt(a[0]),0));
    }

} 
```

“重要字符”是指打印字符和所需的空格（例如，类型和参数之间），但不是纯粹的装饰性空格（换行符和缩进）。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-12-27T05:51:30.277

Delphi（或 Pascal，这里没有特定于 Delphi 的内容）：

```
Function ToRoman(N : Integer) : String;

Const
    V : Array [1..13] of Word = (1000,900,500,400,100,90,50,40,10.9,5,4,1);
    T : Array [1..13] of String = ('M','CM','D','CD','C','XC','L','XL','X','IX','V','I');

Var I : Word;

Begin
    I := 1;
    Repeat
        While N < V[I] do Inc(I);
        Result := Result + T[I];
        N := N - V[I];
    Until N = 0;
End; 
```

每个人都如何获得字符数？（我数了8个必要的空格，其余的都只是为了格式化。）

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-12-27T06:11:16.820

这是 252 个有意义的字符的 C 解决方案。从 0 <= i < 4000 开始有效。主要是我写了这个，因为很多解决方案在数组点包括 IV 和 IX。解码它： t 是我们回填的临时缓冲区，这样我们就不必在输出时反转它。传入的缓冲区必须至少为 16 个字符（对于 3888 -> MMMDCCCLXXXVIII）。

```
 char* i2r(int i, char* r) {
     char t[20];
     char* o=t+19;*o=0;
     char* s="IVXLCDMM";
     for (char*p=s+1;*p&&i;p+=2) {
         int x=i%10;
         if (x==9) {*--o=p[1];*--o=p[-1];}
         else if (x==4) {*--o=*p;*--o=p[-1];}
         else {
             for(;x&&x!=5;--x)*--o=p[-1];
             if(x)*--o=*p;
         }
         i/=10;
     }
     return strcpy(r,o);
 } 
```

而且我总是忘记把主要的。252个字符就这么多：

```
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
 void main(int a,char**v){
     char buf[16];
     printf("%s\n",i2r(atoi(v[1])));
 } 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-12-27T07:35:54.873

**语言：C，字符数：195**

很大程度上基于[me.yahoo.com/joe_mucchielle 的 C 解决方案](https://stackoverflow.com/questions/394574/code-golf-new-year-edition-integer-to-roman-numeral#394730)：

```
char t[99],*o=t+99,*s="IVXLCDMM",*p,x;n(v){*--o=p[v];}main(int i,int**v){i=atoi(v[1]);*o=0;
for(p=s+1;*p&&i;p+=2){x=i%10;if(x%5==4)n(x==9),n(-1);else{for(;x%5;--x)n(-1);if(x)n(0);}i/=10;}puts(o);} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-12-27T02:41:56.540

非常简单：将查询传递给 Google 并截取答案。下一个。:p

顺便说一句，这不应该是一个社区维基吗？

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-12-27T09:45:10.977

### 语言：Erlang，字符数：222

EDIT2：Erlang 预处理器允许某种不平衡的宏，所以这个版本短了 9 个字符。

```
-module(n2).
-export([y/1]).
-define(D(V,S),n(N)when N>=V->[??S|n(N-V)];).
y(N)->io:format(n(N)).
?D(1000,M)?D(900,CM)?D(500,D)?D(400,CD)?D(100,C)?D(90,XC)?D(50,L)?D(40,XL)?D(10,X)?D(9,IX)?D(5,V)?D(4,IV)?D(1,I)n(0)->[10]. 
```

[编辑：受Darius](https://stackoverflow.com/questions/394574/code-golf-new-year-edition-integer-to-roman-numeral#394807)版本启发的较短版本（231 个字符）

```
-module(n).
-export([y/1]).
y(N)->io:format([n(N),10]).
n(N)when N>9->[Y||C<-n(N div 10),{K,Y}<-lists:zip("IVXLC","XLCDM"),K==C]++o(N rem 10);n(N)->o(N).
o(N)->lists:nth(N+1,[[]|string:tokens("I II III IV V VI VII VIII IX"," ")]). 
```

它的可读性较差，但可以保存 2 个字符（233 个字符）。

```
-module(n).
-export([y/1]).
-define(D(V,S),n(N)when N>=V->[??S|n(N-V)]).
y(N)->io:format(n(N)).
?D(1000,M);?D(900,CM);?D(500,D);?D(400,CD);?D(100,C);?D(90,XC);?D(50,L);?D(40,XL);?D(10,X);?D(9,IX);?D(5,V);?D(4,IV);?D(1,I);n(0)->[10]. 
```

命令行版本：

```
-module(n).
-export([y/1]).
-define(D(V,S),n(N)when N>=V->[??S|n(N-V)]).
y([N])->io:format(n(list_to_integer(N))),init:stop().
?D(1000,M);?D(900,CM);?D(500,D);?D(400,CD);?D(100,C);?D(90,XC);?D(50,L);?D(40,XL);?D(10,X);?D(9,IX);?D(5,V);?D(4,IV);?D(1,I);n(0)->[10]. 
```

调用：

```
$ erl -noshell -noinput -run n y 2009
MMIX 
```

编辑：我使用文字宏扩展保存了 17 个字符。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-01-02T22:49:06.857

**Railo CFML** - 53 个字符，46 个不带空格...

```
<cfoutput>
    #NumberFormat( N , 'roman' )#
</cfoutput> 
```

或者，对于其他 CF 引擎，不确定它们是否最短，但它们现在可以......

* * *

**CFML** - 350..453 个字符：

```
<cffunction name="RomanNumberFormat">
    <cfset var D = ListToArray('M,CM,D,C,XC,L,X,IX,V,IV,I') />
    <cfset var I = [1000,900,500,100,90,50,10,9,5,4,1] />
    <cfset var R = '' />
    <cfset var x = 1 />
    <cfset var A = Arguments[1] />
    <cfloop condition="A GT 0">
        <cfloop condition="A GTE I[x]">
            <cfset R &= D[x] />
            <cfset A -= I[x] />
        </cfloop>
        <cfset x++ />
    </cfloop>
    <cfreturn R />
</cffunction>

<cfoutput>
    #RomanNumberFormat(N)#
</cfoutput> 
```

**CFScript** - 219..323 个字符：

```
<cfscript>
    function RomanNumberFormat(A)
    {
        var D = ListToArray('M,CM,D,C,XC,L,X,IX,V,IV,I');
        var I = [1000,900,500,100,90,50,10,9,5,4,1];
        var R = '';
        var x = 1;
        while ( A > 0 )
        {
            while( A >= I[x] )
            {
                R &= D[x];
                A -= I[x];
            }
            x++;
        }
        return R;
    }

    WriteOutput( RomanNumberFormat(N) );
</cfscript> 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2010-03-05T07:49:27.067

在 C# 中（在 .NET 4 RC 上运行），具有 335 个字符（如果您删除了无关的格式）。

```
using System;
using System.Linq;
class C
{
    static void Main()
    {
        Console.WriteLine(
                Console.ReadLine()
                .PadLeft(4,'0')
                .Select(d=>d-'0')
                .Zip(new[]{"  M","MDC","CLX","XVI"},(x,y)=>new{x,y})
                .Aggregate("",(r,t)=>r+
                                    new string(t.y[2],t.x%5/4)+
                                    new string(t.y[0],t.x%5/4*t.x/5)+
                                    new string(t.y[1],Math.Abs(t.x%5/4-t.x/5))+
                                    new string(t.y[2],t.x%5%4)));
    }
} 
```

我知道它并没有击败当前的最佳 C# 答案（182 个字符），但这只是一个大的 LINQ 单线。一旦我看到一个写成[单个 LINQ 查询](http://dotnetkicks.com/linq/Taking_LINQ_to_Objects_to_Extremes_A_fully_LINQified_RayTracer)的光线追踪器，我就开始从这个角度接近代码高尔夫。

由于这种方法是有效的，我正在研究相同算法的 Haskell 版本（肯定会更短）。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2010-03-05T09:07:36.190

[我的C#/LINQ 答案](https://stackoverflow.com/questions/394574/code-golf-new-year-edition-integer-to-roman-numeral/2385261#2385261)的 Haskell 版本，234 个字符：

```
main=putStrLn.foldr(\(y,x)s->concat[s,r(a x)(y!!2),r(a x*div x 5)(y!!0),r(abs(a x-div x 5))(y!!1),r(mod(mod x 5)4)(y!!2)])"".zip["XVI","CLX","MDC","  M"].map(read.(:[])).take 4.(++"000").reverse=<<getLine
r=replicate
a x=div(mod x 5)4 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2010-11-29T17:24:54.733

哈斯克尔，245 个字符。

```
roman = numeral [(1000,"M"),(900,"CM"),(500,"D"),(400,"CD"),(100,"C"),(90,"XC"),
    (50,"L"),(40,"XL"),(10,"X"),(9,"IX"),(5,"V"),(4,"IV"),(1,"I")]
numeral [] n = ""
numeral ((m,c):xs) n = concat (replicate (n `div` m) c) ++ numeral xs (n `mod` m) 
```

# c# - 二进制序列化和 XML 序列化之间是否存在性能差异？

> ID：394588
> 
> 赞同：6
> 
> 时间：2008-12-27T02:45:33.150
> 
> 标签：c#, xml, binary-data

在解析（序列化、反序列化）和通过网络发送数据包方面，对二进制和 xml 序列化之间的性能差异有什么好的估计吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-27T02:54:25.813

没有。

这在很大程度上取决于 XML 文档本身内部的数据类型。如果您有大量结构化数据，则 XML 的开销会很大。例如，如果您的数据如下所示：

```
<person>
  <name>Dave</dave>
  <ssn>000-00-0000</ssn>
  <email1>xxxxxx/email1>
</person>
... 
```

如果你有一个看起来像这样的 XML 文档，你将有更多的开销：

```
<book name="bible">
 In the beginning God created the heavens and the earth. 
 Now the earth was formless and empty ... 
 And if any man shall take away from the words of the book of this prophecy, God shall take away his part out of the book of life, and out of the holy city, and from the things which are written in this book. He which testifieth these things saith, Surely I come quickly. Amen. Even so, come, Lord Jesus.
</book> 
```

所以这不是一个公平的问题。这在很大程度上取决于您打算发送的数据，以及如何/是否要压缩它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-27T15:41:43.863

和xml序列化最大的区别在于`BinaryFormatter`可移植性；BinaryFormatter 在版本之间很难保证，所以只适合短期存储或传输。

但是，您可以通过使用定制的二进制序列化来充分利用两者，*并*使其更小更快 - 您*甚至*不必自己做;-p

[protobuf-net](http://code.google.com/p/protobuf-net/)是 Google 协议缓冲区二进制序列化规范的 .NET 实现；它比`XmlSerializer`or更小`BinaryFormatter`，*完全*可移植（不仅在版本之间 - 您可以在例如 java 等中加载 pb 流），可扩展且快速。它也经过了相当全面的测试，拥有相当多的用户。

大小和速度的完整细分，覆盖`XmlSerializer`,和 protobuf-net 在[这里](http://code.google.com/p/protobuf-net/wiki/Performance)。`BinaryFormatter``DataContractSerializer`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T03:18:58.900

本能地你会想说二进制更有效，但它实际上取决于被序列化的数据。

查看这篇文章： http: [//www.nablasoft.com/alkampfer/index.php/2008/10/31/binary-versus-xml-serialization-size/](http://www.nablasoft.com/alkampfer/index.php/2008/10/31/binary-versus-xml-serialization-size/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T04:58:47.450

仅仅指出性能并不是您可能想要查看的唯一指标。

*   施工方便。您是否有几天/几周的时间来构建序列化器/反序列化器例程并对其进行彻底测试，或者是否可以更好地将时间花在功能上。
*   易于使用数据。客户可以使用预先构建的开源解析器，还是他们需要自己实现一堆（可能有问题的）代码？
*   易于调试。能够查看传输中的数据是否有助于调试？然后二进制格式将倾向于混淆任何问题。
*   每种方法的维护成本是多少？

就个人而言，我会使用已发布的 XML 标准和开源解析库，直到通过实际测试证明性能瓶颈。

# language-agnostic - 合同设计和测试驱动开发

> ID：394591
> 
> 赞同：28
> 
> 时间：2008-12-27T02:48:06.810
> 
> 标签：language-agnostic, project-management, tdd, design-by-contract

我正在努力改进我们团队的开发过程，并且我正在考虑如何最好地通过测试驱动开发来实现按合同设计。似乎这两种技术有很多重叠，我想知道是否有人对以下（相关）问题有所了解：

*   除非您使用某种代码生成器来生成基于合约的单元测试，否则拥有 TDD 和 DbC 是否违反 DRY 原则？否则，您必须在两个地方（测试和合同本身）维护合同，还是我遗漏了什么？
*   TDD 在多大程度上使 DbC 变得多余？如果我写的测试足够好，它们不等于写合同吗？如果我在运行时以及通过测试执行合同，我是否只会获得额外的好处？
*   仅使用 TDD 而不是 TDD 和 DbC 是否更容易/更灵活？

这些问题的重点是这个更普遍的问题：**如果我们已经在正确地进行 TDD，如果我们还使用 DbC，我们是否会从开销中获得显着的收益？**

一些细节，虽然我认为这个问题很大程度上与语言无关：

*   我们的团队非常小，<10 个程序员。
*   我们主要使用 Perl。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-27T03:13:15.637

注意差异。

*由合同驱动的*设计。*合同驱动*设计*。*

 **以测试驱动*开发。*测试驱动*开发*。*

 *它们是相关的，因为一个先于另一个。它们描述了不同抽象级别的软件。

当你去实施时，你会放弃设计吗？您是否认为设计文件违反了 DRY？您是否分别维护合同和代码？

软件是合同的一种实现方式。测试是另一回事。用户手册是第三本。操作指南是第四个。数据库备份/恢复过程是合同实施的一部分。

我看不到按合同设计的任何*开销*。

*   如果您已经在进行设计，那么您可以将格式从过多的单词更改为恰到好处的单词以概述合同关系。

*   如果您不进行设计，那么编写合同将消除问题，降低成本和复杂性。

我看不出灵活性有任何损失。

1.  从合同开始，

2.  然后

    一种。编写测试和

    湾。写代码。

看看这两个开发活动是如何从本质上交织在一起的，并且都来自合同。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-12-27T13:35:13.710

我认为 DbC 和 TDD 之间存在重叠，但是，我认为没有重复的工作：引入 DbC 可能会导致测试用例的减少。

让我解释。

在 TDD 中，测试并不是真正的测试。它们是行为规范。但是，它们*也是*设计工具：通过首先编写测试，您可以像用户一样使用被测对象的外部 API（您实际上还没有编写）。这样，您以一种对用户有意义的方式设计 API，而不是使您最容易实现的方式。类似的东西，`queue.full?`而不是`queue.num_entries == queue.size`.

第二部分不能被合同取代。

第一部分*可以*被合约部分替代，至少在单元测试中是这样。TDD 测试作为行为规范，对其他开发人员（单元测试）和领域专家（验收测试）都是如此。契约*还*为其他开发人员、领域专家以及编译器和运行时库指定行为。

但是契约有固定的粒度：你有方法的前置条件和后置条件、对象不变量、模块契约等等。也许循环变体和不变量。然而，单元测试是测试行为单元。这些可能小于一个方法或由多个方法组成。这不是你可以用合同做的事情。对于“大图”，您仍然需要集成测试、功能测试和验收测试。

DbC 没有涵盖 TDD 的另一个重要部分：中间 D。在 TDD 中，测试*驱动*您的开发过程：除非您的测试失败，否则您永远不会编写一行实现代码，您永远不会编写一行代码测试代码 除非您的测试全部通过，否则您只需编写最少数量的实现代码即可使测试通过，您只需编写最少数量的测试代码即可产生失败的测试。

总之：使用测试来设计 API 的“流程”、“感觉”。使用合约来设计 API 的合约。使用测试为开发过程提供“节奏”。

像这样的东西：

1.  为功能编写验收测试
2.  为实现该功能的一部分的单元编写单元测试
3.  使用您在步骤 2 中设计的方法签名，编写方法原型
4.  添加后置条件
5.  添加前置条件
6.  实现方法体
7.  如果验收测试通过，则转到 1，否则转到 2

如果你想知道按合同设计的发明者 Bertrand Meyer 对结合 TDD 和 DbC 的看法，他的小组有一篇很好的论文，叫做[Contract-Driven Design = Test-Driven Development - Writing Test Cases](http://SE.ETHZ.Ch/people/leitner/publications/cdd_leitner_esec_fse_2007.pdf)。基本前提是合约提供了所有可能用例的抽象表示，而测试用例只测试特定用例。因此，可以从合约中自动生成合适的测试工具。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-27T06:29:23.510

我要补充：

API 是程序员的契约，UI 定义是与客户端的契约，协议是客户端-服务器交互的契约。首先获得这些，然后您就可以利用并行开发轨道，而不会迷失在杂草中。是的，定期审查以确保满足要求，但不要在没有合同的情况下开始新的轨道。而“契约”是一个强有力的词：一旦部署，就决不能改变。您应该从一开始就包括版本管理和自省，对合同的更改仅由扩展集实现，版本号随之更改，然后您可以在处理混合或旧安装时执行优雅降级等操作。

我以艰难的方式吸取了这一教训，一个大型项目徘徊在从未有过的土地上，然后在严重的情况下以正确的方式应用它，公司生存，短导火线时间表。我们定义了协议，为交易的每一方定义并编写了一组协议仿真（基本上是罐装消息生成器和接收消息检查器，一个晚上的两脑编码），然后分开分别编写服务器端和客户端的应用程序。我们重新组合了演出之夜，而且效果很好。需求、设计、合同、测试、编码、集成。以该顺序。重复直到烘烤。

我对 TLA 的设计有点怀疑。与模式一样，符合流行语的配方是一个很好的指南，但根据我的经验，没有一刀切的设计或项目管理程序。如果你是按照书本 (tm) 做事，那么除非它是符合 DOD 程序要求的 DOD 合同，否则你可能会在此过程中的某个地方遇到麻烦。阅读书籍，是的，但一定要理解它们，然后还要考虑到团队中的人员方面。仅由 Book 强制执行的规则不会被统一执行 - 即使在工具强制执行时也可能会丢失（例如 svn 评论留空或神秘简短）。只有当工具链不仅强制执行程序，而且比任何可能的捷径更容易遵循程序时，程序才会被遵循。相信我，

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-13T11:42:49.883

您还可以使用以合同领域语言编写的可执行验收测试。它可能不是实际的“合同”，而是单元测试和合同之间的一半。

我会推荐使用 Ruby Cucumber [http://github.com/aslakhellesoy/cucumber](http://github.com/aslakhellesoy/cucumber)

不过既然你是Perl店，那也许你可以用我自己在p5-cucumber上的小尝试。 [http://github.com/kesor/p5-cucumber](http://github.com/kesor/p5-cucumber)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-13T12:21:35.110

微软已经完成了基于代码契约和参数化单元测试的自动生成单元测试的工作。例如，合同规定当将一个项目添加到集合时计数必须增加一，参数化单元测试说明如何将“n”个项目添加到集合中。然后，Pex 将尝试创建一个单元测试来证明合同被破坏。有关概述，请参阅此[视频](http://channel9.msdn.com/pdc2008/TL51/)。

**如果**这可行，您的单元测试只需为您尝试测试的每件事编写一个示例，然后 PEX 将能够计算出会破坏测试的女巫数据项。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-07T07:59:57.250

前段时间我对这个话题有过一些思考。

你可能想看看

[http://gleichmann.wordpress.com/2007/12/09/test-driven-development-and-design-by-contract-friend-or-foe/](http://gleichmann.wordpress.com/2007/12/09/test-driven-development-and-design-by-contract-friend-or-foe/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-14T11:27:38.237

当你使用 TDD 来实现一个新方法时，你需要一些输入：你需要知道断言来检查你的测试。契约式设计为您提供了这些断言：它们是方法的后置条件和不变量。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-29T23:40:54.163

我发现 DbC 对于启动**红绿重构**周期非常方便，因为它有助于识别单元测试开始。使用 DbC，我开始考虑被 TDD 编辑的对象必须处理的先决条件，并且每个先决条件都可能代表一个失败的单元测试，以启动一个红-绿-重构周期**。****在某些时候，我切换到以失败的后置条件**单元测试开始循环，然后保持 TDD 流程继续进行。我已经与 TDD 的新手尝试过这种方法，它确实有助于启动 TDD 思维方式。

总之，将 DbC 视为识别关键行为单元测试的有效方法。DbC 有助于分析输入（前置条件）和输出（后置条件），这是我们需要控制（输入）和观察（输出）以编写可测试软件（TDD 的类似目标）的两件事。

# user-interface - 在 Acrobat、Photoshop 等中从何处获取用户界面组件

> ID：394596
> 
> 赞同：0
> 
> 时间：2008-12-27T02:54:10.870
> 
> 标签：user-interface, treeview, adobe

有谁知道您是否可以获得在各种 adobe 产品中看到的以下用户界面组件以用于自己的产品？

*   树视图 (Adobe Acrobat)
*   可折叠工具栏（Adobe Photoshop、Illustrator）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-27T04:03:10.043

您是在 .NET 平台上构建的吗？然后，您可以访问Adob​​e 程序内部使用的**许多 COM 库。**

例如。您可以通过以下方式直接实例化和命令 Adob​​e Illustrator 的实例：

1.  在 Visual Studio 中，右键单击您的项目并选择“添加引用”。
2.  选择“Adobe Illustrator CS4/CS3 类型库”，按确定。 *（位于“C:\program files\adobe\adobe illustrator cs3/cs4\plug-ins\extensions\scriptingsupport.aip”）*

现在在你的程序中：

**C＃**

```
// open AI, init
Illustrator.Application illuApp = new Illustrator.Application();

// open doc
Illustrator.Document illuDoc = illuApp.Open("C:\myai.ai", Illustrator.AiDocumentColorSpace.aiDocumentRGBColor, null);

// close doc
illuDoc.Close();
illuDoc = null;

// close AI
illuApp.Quit();
illuApp = null; 
```

**VB**

```
'open AI, init
Dim illApp As Illustrator.Application = New Illustrator.Application()

' open doc
Dim illDoc As Illustrator.Document = illApp.Open("C:\myai.ai", Illustrator.AiDocumentColorSpace.aiDocumentRGBColor, Nothing)

' close doc
illDoc.Close()
illDoc = Nothing

'close AI
illApp.Quit()
illApp = Nothing 
```

* * *

尝试在“添加参考”窗口中**浏览**，以查找更多库。您甚至可以直接连接到 Adob​​e 的内部 UI 库！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T04:24:20.047

如果您正在考虑**购买/许可**，请参阅这些**ComponentSource页面：**

 ***   [树组件](http://www.componentsource.com/relevance/index.html?q=tree)
*   [工具栏和 UI 组件](http://www.componentsource.com/relevance/index.html?q=toolbar)

虽然您不会获得 Adob​​e 的组件，但您会获得具有**类似**功能的组件，甚至是**副本。**

*不过，也可以使用免费的替代品。尝试谷歌搜索一些开源的！*

# c# - WPF中的空间填充工具栏项

> ID：394613
> 
> 赞同：4
> 
> 时间：2008-12-27T03:18:10.477
> 
> 标签：c#, wpf

我怎样才能让一个项目里面`ToolBar`填满所有剩余的可用空间？或者，如何右对齐某些项目，因为这会给我带来同样的效果。

请注意，涉及在其中嵌套另一个容器（如 a `Grid`）的解决方案`ToolBar`不起作用，因为这会禁用`ToolBar`赋予其项目的特殊行为（如没有正常边框和外观、悬停时的简单轮廓边框、单击后不接收焦点等）。 ）。

此外，任何人都知道如何摆脱小按钮，如果我有的话，它会显示从工具栏溢出的其他图标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T15:59:02.303

我最终使用了这个解决方案：

[http://karlshifflett.wordpress.com/2008/01/23/wpf-sample-series-stretch-toolbar-width-of-window/](http://karlshifflett.wordpress.com/2008/01/23/wpf-sample-series-stretch-toolbar-width-of-window/)

这并不理想，但它有效。我仍然不知道如何摆脱最后的下拉菜单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T10:24:57.450

您可以通过重新模板工具栏来删除最后的按钮。您也可以通过这种方式解决您的其他查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-15T04:50:56.700

我写了一个解决方案来创建一个“空间填充”标签，该标签动态调整大小以允许您在工具栏中“右对齐”项目。检查一下：[WPF 工具栏项 Horizo​​ntalAligment="Right"](https://stackoverflow.com/questions/2201685/wpf-toolbar-items-horizontalaligment-right/6006516#6006516)

# java - 在 Windows 上运行 JAR 文件

> ID：394616
> 
> 赞同：280
> 
> 时间：2008-12-27T03:19:37.980
> 
> 标签：java, jar, executable-jar

我有一个名为*helloworld.jar*的 JAR 文件。为了运行它，我在命令行窗口中执行以下命令：

```
java -jar helloworld.jar 
```

这工作正常，但我如何用双击来执行它呢？我需要安装任何软件吗？

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-12-27T03:33:49.027

最简单的方法可能是升级或重新安装 Java 运行时环境 (JRE)。

或这个：

*   打开 Windows 资源管理器，从工具中选择“文件夹选项...”
*   单击文件类型选项卡，向下滚动并选择 JAR 文件类型。
*   按高级按钮。
*   在编辑文件类型对话框中，选择在操作框中打开，然后单击编辑...
*   按浏览按钮并导航到 Java 解释器 javaw.exe 的位置。
*   在 Application used to perform action 字段中，需要显示类似的`C:\Program Files\Java\j2re1.4.2_04\bin\javaw.exe" -jar "%1" %`内容（注意：以 'javaw' 开头的部分必须完全一样；路径名的其他部分可能因您使用的 Java 版本而异) 然后按 OK 按钮，直到所有对话框都关闭。

从这里被盗：http: [//windowstipoftheday.blogspot.com/2005/10/setting-jar-file-association.html](http://windowstipoftheday.blogspot.com/2005/10/setting-jar-file-association.html)

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2010-01-07T17:14:42.780

在 Windows Vista 或 Windows 7 中，[手动文件关联编辑器](https://stackoverflow.com/questions/394616/running-jar-file-in-windows/394628#394628)已被删除。

最简单的方法是运行[Jarfix](http://johann.loefflmann.net/en/software/jarfix/index.html)，这是一个小巧但功能强大的免费软件工具。只需运行它，您的 Java 应用程序就会回来...再次双击。

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2011-09-19T12:08:34.437

如果您需要分发您的 .jar 文件并使其可在其他人的 Windows 计算机上运行，​​您可以在命令提示符下创建一个简单的 .bat 文件，如下所示：

```
java -jar MyJavaTool.jar 
```

并将 .bat 文件放在与 .jar 文件相同的目录中。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2010-05-21T05:56:27.177

如果您有一个名为 Example.jar 的 jar 文件，请遵循以下规则：

1.  打开一个`notepad.exe`
2.  写 ：`java -jar Example.jar`
3.  使用扩展名保存它`.bat`
4.  将其复制到包含该`.jar`文件的目录
5.  双击它运行你的`.jar`文件

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-09-22T10:12:48.517

当在命令提示符下启动可运行的 jar 文件时，这个有趣的副作用会导致问题。

如果您尝试（在命令提示符下）：

```
jarfile.jar parameter 
```

不高兴，因为这被翻译成以下内容（不起作用）：

```
javaw.exe -jar jarfile.jar parameter 
```

但是，以下命令确实有效：

```
java.exe -jar jarfile.jar parameter 
```

如果您如上所述将文件管理器中的关联更改为：

```
"C:\Program Files\Java\j2re1.4.2_04\bin\java.exe" -jar "%1" %* 
```

然后你可以输入：

```
jarfile.jar parameter 
```

在命令提示符下，它现在可以工作了！

编辑：（但是，当您运行基于表单的（非控制台）Java 应用程序时，您会得到一个黑色的控制台窗口，所以这不是一个理想的解决方案）

如果您通过在窗口中双击它们来运行这些 jar 文件，则不会传递任何参数，因此您的 Java 代码需要处理堆栈溢出异常并在末尾包含“按键”功能，否则窗口将消失。

为了在 Windows 中传递参数，您必须创建 jar 文件的快捷方式，其中包括目标行中的参数（右键单击快捷方式并选择属性）您不能在此向 jar 文件图标本身添加参数方式。

这里没有单一的、一致的解决方案，但任何其他控制台应用程序都会遇到同样的问题。

有一个名为“bat to exe”的 Windows 免费软件应用程序，您可以使用它从 .bat 文件中创建一个带有适当命令行的 exe 文件。您还可以将jar文件嵌入到该应用程序的exe中，并在运行完成后将其清理干净，因此这可能是一个更优雅的解决方案。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-11-01T16:33:19.493

首先在cmd（命令提示符）上设置路径：

```
set path="C:\Program Files\Java\jre6\bin" 
```

然后输入

```
java -jar yourProgramname.jar 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2010-01-07T17:47:41.013

在 Windows XP ^*中，您只需要 2 个*shell*命令：

```
 C:\>ftype myjarfile="C:\JRE1.6\bin\javaw.exe" -jar "%1" %* 
   C:\>assoc .jar=myjarfile 
```

显然使用 JRE 的正确路径和您想要的任何名称，而不是`myjarfile`.

要检查当前设置：

```
 C:\>assoc .jar  
   C:\>ftype jarfile 
```

这次使用第一个命令返回的值，如果有的话，而不是`jarfile`.

^* *未经 Windows 7 测试*

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-08-27T13:59:02.723

有一种方法不需要用户在他的 PC 上进行更改。Runtime.getRuntime.exec() 允许我们启动 cmd.exe 并在其中执行命令。因此，当用户单击 .jar 文件时，java 程序可能会在命令提示符下自行运行。

```
public static void main(String[] args) throws IOException {
    if(args.length == 0) {
        Process p = Runtime.getRuntime().exec("cmd.exe /c start java -jar " + (new File(NameOfClass.class.getProtectionDomain().getCodeSource().getLocation().getPath())).getAbsolutePath() + " cmd");
    } else {
        //code to be executed
    }
} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-12-27T21:56:26.523

除了所有其他建议之外，您还需要考虑另一件事。你的 helloworld.jar 是一个控制台程序吗？如果是的话，那么我不相信你能把它变成一个可双击的 jar 文件。控制台程序使用常规的 cmd.exe shell 窗口进行输入和输出。通常，jar“启动器”绑定到 javaw.exe，它不会创建命令外壳窗口。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2013-10-25T14:57:05.837

在注册表中，打开`HKEY_CLASSES_ROOT\Applications\java.exe\shell\open\command`

双击左侧的默认值并在`java.exe`路径和“ `%1`”参数之间添加-jar。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-01-17T22:03:55.947

我正在运行 Windows 7 x64 并且无法使用这些修复程序中的任何一个。

毕竟这个对我有用：

[http://thepanz.netsons.org/post/windows7-jar-file-association-broken-with-nokia-ovi](http://thepanz.netsons.org/post/windows7-jar-file-association-broken-with-nokia-ovi)

您可以下载包含要运行的 .bat 文件的存档，但请检查实际 javaw.exe 的路径！！！！

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-12-27T03:26:01.397

你想检查几件事；如果这是您自己的 jar 文件，请确保您已在清单中定义了 Main-class。既然我们知道您可以从命令行运行它，那么要做的另一件事是创建一个 Windows 快捷方式，并修改属性（您必须环顾四周，我没有 Windows 机器可以查看），以便它在打开时执行的命令是您提到的 java -jar 命令。

另一件事：如果没有混淆，它应该可以工作；检查并确保您有与 .jar 扩展名关联的 java。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-11-07T14:32:32.793

不幸的是，这并不容易，因为微软在最近的 Windows 版本中删除了高级文件关联对话框。- 对于较新的 Windows 版本，您只能指定将用于打开 .jar 文件的应用程序。

修复在 Windows 上打开的 .jar 文件需要两个步骤。

1.  打开控制面板，然后选择“默认程序 -> 设置关联”。在那里找到 .jar 扩展名（*可执行 JAR 文件*），然后选择 Java 作为默认程序来打开这个扩展名。它可能会被列为“ *Java Platform(SE)* ”。一个更快的选择可能是直接右键单击 .jar 文件，然后通过单击“更改...”按钮更改关联的程序。

2.  现在打开注册表，然后打开`HKEY_CLASSES_ROOT\jarfile\shell\open\command`密钥。对我们来说幸运的是，我们可以在那里为`(Default)`值指定参数。在我的 Windows 系统上，它看起来像：`C:\app\32\jre7\bin\javaw.exe" -jar "%1" %*`但在大多数情况下，它是以下字符串：`C:\Program Files\Java\jre7\bin\javaw.exe" -jar "%1" %*`

笔记：

*   不要在`java.exe`那里使用，因为它会打开 shell 窗口。
*   该线程中提到的*jarfix*工具很可能只是为您修改注册表。我更喜欢手动注册表更改方法，因为这意味着系统管理员可以将注册表更改“推送”到网络中的所有工作站。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-11-15T14:00:44.437

创建`.bat`文件：

```
start javaw -jar %* 
```

并选择应用程序默认打开`.jar`此`.bat`文件。

`cmd`启动`.jar`文件时它将关闭。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-12-09T23:40:32.987

通过单击/双击运行 jar 文件的另一种方法是在文件名前添加“-jar”。例如，您将文件重命名**`MyJar.jar`**为**`-jar MyJar.jar`**.

当然，您必须拥有与`.class`关联的文件`java.exe`。这可能不适用于所有情况，但对我来说大多数时候都有效。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-01-02T08:46:44.607

我在 Windows 10 中遇到了同样的问题。我使用**右键单击**“ **helloworld.jar** ”并转到**属性**并单击“打开方式：”下的**更改按钮并选择“****在此 PC 上查找另一个应用程序**”来修复它。在“**打开方式...** ”对话框中，转到 PC 上的 Java 文件夹位置并打开相应的 jdk 文件夹，然后打开**bin**文件夹并从中选择“ **javaw.exe** ”。然后下次你的“ **helloworld.jar** ”会以正常方式打开。

通常的 java 位置示例：“ **C:\Program Files (x86)\Java\jdk1.8.0_111\bin** ”。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-09-19T18:38:34.247

**PreScript**：如果您的提示出现并立即消失，原因是您的程序被执行并自动关闭。尝试将扫描仪放在最后以终止，它会在终止之前让您的提示等待输入。（或者可能使用延迟）

在同样的情况下，从 cmd 运行 .jar 工作正常，但双击什么也没做。

解决方案：打开任意文本编辑器，编写命令行： java -jar Example.jar 将文件保存为.bat 文件。运行此 bat 文件以获取所需的输出。

更进一步，您可以使用简单的 GUI 工具（如 Bat To Exe Converter）将此 bat 文件转换为 exe 文件。

现在您可以将您的 .jar 作为 .exe 文件的分发版共享，任何人都可以使用它，只需确保将所有文件保存在一起。（特别是 .jar 和 .bat 文件，因为 .bat 只是一个 cmd 提示符）（感觉如何合乎逻辑）

我对开发和学习还很陌生。如果犯了任何错误，请原谅。欢迎提出建议。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-05-10T22:44:47.290

在 Windows 10 上遇到了同样的问题
**解决方案：**

1.  检查您的 JAVA_HOME 和 JAVA_PATH。
    [https://javatutorial.net/set-java-home-windows-10](https://javatutorial.net/set-java-home-windows-10)
2.  使用 Jarfix 恢复`.jar`和`javaw.exe`
    [https://johann.loefflmann.net/en/software/jarfix/index.html之间的关联](https://johann.loefflmann.net/en/software/jarfix/index.html)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-08-12T23:17:35.040

如果您使用 eclipse 制作您的 java 文件，您可以选择将其导出为可运行的 jar 文件。我用我的程序做到了这一点，我只需点击 jar，它就会像那样运行。这将适用于两个窗口以及 os x。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-10-17T20:11:08.270

制作 start.bat 是唯一对我有用的东西。

打开一个文本文档并输入。java -jar***不管你叫什么***.jar

在与要执行的 .jar 文件相同的文件夹中另存为 start.bat。然后运行。蝙蝠

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-05-08T03:06:47.423

如果您需要通过双击来运行 jar 文件，您必须将其创建为“可运行的**JAR** ”。你可以用你的IDE简单地做到这一点。

如果您使用的是 eclipse，请按照以下步骤操作：

```
 To create a new runnable JAR file in the workbench:

1.From the menu bar's File menu, select Export.
2.Expand the Java node and select Runnable JAR file. Click Next.
3.In the  Opens the Runnable JAR export wizard Runnable JAR File Specification page, select a 'Java Application' launch configuration to use to create a runnable JAR.
4.In the Export destination field, either type or click Browse to select a location for the JAR file.
5.Select an appropriate library handling strategy.
Optionally, you can also create an ANT script to quickly regenerate a previously created runnable JAR file. 
```

更多信息可以在 Eclipse 帮助页面上找到：[LINK](http://help.eclipse.org/luna/index.jsp?topic=%2Forg.eclipse.jdt.doc.user%2Ftasks%2Ftasks-37.htm)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-12-04T10:22:47.240

在 Windows 上运行 .jar 文件有很多[方法](http://www.internetgeeks.org/tech/computer/how-to-open-jar-files-windows/)。其中之一是使用命令提示符。

脚步 ：

1.  打开命令提示符（以管理员身份运行）
2.  现在为根目录编写“cd\”命令
3.  输入“java jar filename.jar” 注意：您还可以使用任何第三方应用程序，如 WinRAR、jarfix 等。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2017-12-13T18:48:49.510

> 使用`.bat`文件：

将您的命令放入 .bat 文件中。在这里，您的命令将是`java -jar path\yourJarName.jar`. `Something like: java -jar C:\workspace\myApplication.jar`

保存并双击bat文件运行你的jar。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-10-03T15:06:26.380

脚步：

1.) 在 Google 上搜索 Java SE 运行时环境：[https ://www.google.com/search?q=Java+SE+Runtime+Environment](https://www.google.com/search?q=Java%20SE%20Runtime%20Environment)

2.）在您的计算机上安装适当的版本

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-05-06T10:26:09.547

对于编译：

```
javac  -cp ".;./mysql-connector-java-5.0.8.jar;mybatis-3.0.1.jar;ibatis-2.3.0.677.jar" MainStart.java 
```

对于运行：

```
java  -cp ".;./mysql-connector-java-5.0.8.jar;mybatis-3.0.1.jar;ibatis-2.3.0.677.jar" MainStart 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2019-06-01T18:05:05.893

实际上，我也遇到了这个问题，我通过为我的 jar 文件制作了一个 .bat 运行器来解决这个问题，

代码如下：

```
class FileHandler{
   public static File create_CMD_Rnner(){
      int exitCode = -1625348952;
      try{
           File runner = new File(Main.batName);
           PrintWriter printer = new PrintWriter(runner);
           printer.println("@echo off");
           printer.println("title " + Main.applicationTitle);
           printer.println("java -jar " + Main.jarName + " " + Main.startCode );
           printer.println("PAUSE");
           printer.flush();
           printer.close();
           return runner;
       }catch(Exception e){
           System.err.println("Coudln't create a runner bat \n exit code: " + exitCode);
           System.exit(exitCode);
           return null;
       }
   }
} 
```

然后在您的主应用程序类中执行以下操作：

```
public class Main{
    static String jarName = "application.jar";
    static String applicationTitle = "java Application";
    static String startCode = "javaIsTheBest";
    static String batName = "_.bat";

    public static void main(String args[]) throws Exception{
        if(args.length == 0 || !args[0].equals(startCode)) {
            Desktop.getDesktop().open(FilesHandler.create_CMD_Rnner());
            System.exit(0);
        }else{
            //just in case you wanted to hide the bat
            deleteRunner();
            // Congratulations now you are running in a cmd window ... do whatever you want
            //......
            System.out.println("i Am Running in CMD");
            //......
            Thread.sleep(84600);
        }
    }

    public static void deleteRunner(){
        File batRunner = new File(batName);
        if(batRunner.exists()) batRunner.delete();
    }
} 
```

## 请注意

> 1.  此代码（我的代码）仅适用于 jar 文件，而不适用于类文件。
>     
>     
> 2.  jar 文件必须与字符串同名 “jarName” 是 Main 类

# python - SDL 或 PyGame 国际输入

> ID：394618
> 
> 赞同：5
> 
> 时间：2008-12-27T03:23:33.977
> 
> 标签：python, internationalization, sdl

那么基本上，在 SDL 或 OpenGL 游戏或应用程序中如何处理非西方输入？谷歌搜索显示[http://sdl-im.csie.net/](http://sdl-im.csie.net/)但这似乎不再维护或可用。只是为了查看我不得不使用[谷歌缓存](http://74.125.95.132/search?q=cache:PYYdG1HpzZ0J:sdl-im.csie.net/+sdl+input&hl=en&ct=clnk&cd=6&gl=us&client=firefox-a)的页面。

澄清一下，在应用程序向用户显示非西方语言文本方面，我没有任何问题。这是一个已解决的问题。有许多可用的 unicode 字体，以及将文本处理成字形然后处理成显示表面的许多不同方法。

我朝相反的方向跑了一次犯规。即使我的程序可以安全地处理任意编码的文本数据，如果碰巧包含一个需要多次击键才能产生的字符，用户也无法实际输入他们的姓名。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T10:56:18.197

您对[`SDL_EnableUNICODE()`](http://www.libsdl.org/docs/html/sdlenableunicode.html). 当您启用 unicode 翻译时，您可以使用结构`unicode`字段`SDL_keysym`根据键入的关键用户获取 unicode 字符。

一般来说，我认为每当您进行文本输入（例如，用户专注于文本框）时，您应该使用 unicode 字段而不是尝试自己进行翻译。

[这](https://opentibia.svn.sf.net/svnroot/opentibia/yatc/trunk/main.cpp)是我们在 YATC 中所做的事情。并不是真正应该如何做事的光辉榜样，而是展示了该`unicode`领域的使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T12:32:25.037

通常每个人最终都会使用 unicode 作为文本来国际化他们的应用程序。

我不记得 SDL 或 OpenGL 都没有实现任何会阻止您实现国际输入/输出的东西，除非它们对此没有帮助。

您可以使用 OpenGL 上的实用程序来使用 .ttf 字体进行渲染。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-30T22:40:57.163

看来现在有一个关于这个主题的谷歌夏季代码项目，适用于[X11](http://ocghop.appspot.com/student_project/show/google/gsoc2009/sdl/t124024854219)和[MacOS X](http://socghop.appspot.com/student_project/show/google/gsoc2009/sdl/t124024853848)

# java - RowSet 可以与 PreparedStatements 一起使用吗？

> ID：394627
> 
> 赞同：2
> 
> 时间：2008-12-27T03:33:36.173
> 
> 标签：java, database, jdbc, rowset

我刚刚找到了用于使用 JDBC 进行数据库查询的 RowSets。它们是无状态且可缓存的，它们看起来优于 ResultSet。
PreparedStatements 可以与它​​们一起使用吗？PreparedStatements 是查询非常大的数据库的性能提升器，而不是我想放弃的东西（在说之前，这不是过早的优化，我们有一个经过验证的速度需求！！）。我需要最快的查询返回到这里的集合，缓存是次要的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T06:07:14.303

RowSet 的默认实现在内部使用准备好的语句。

如果不是这样，我会感到惊讶。

查看代码 JDBCRowSetImpl 自己编写代码[http://www.google.com/codesearch/p?hl=en#TTY8xLpnKOE/src/share/classes/com/sun/rowset/JdbcRowSetImpl.java&q=JDBCRowSetImpl](http://www.google.com/codesearch/p?hl=en#TTY8xLpnKOE/src/share/classes/com/sun/rowset/JdbcRowSetImpl.java&q=JDBCRowSetImpl)

你会想看看 prepare() 方法。

注意：戳代码是我喜欢开源的原因：D

# haskell - Haskell 用于服务器？

> ID：394645
> 
> 赞同：31
> 
> 时间：2008-12-27T04:08:48.083
> 
> 标签：haskell, erlang

关于制作游戏服务器，Erlang 似乎总是作为一种“为这种事情而构建”的语言出现，它具有可扩展性和并发特性。我在 Haskell 和 Erlang 方面都没有经验，但从表面上看，它们似乎是一样的。查看 Haskell 的文档，它似乎支持多处理器可扩展性和并发性，据说 Haskell 是一种更可靠的语言，并且拥有明显更好的社区。那么，我的问题是，Haskell 是否被认为与 Erlang 所认为的服务器构建解决方案一样好？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-12-27T05:51:36.470

这取决于你想用你的服务器做什么。正如电信应用程序所期望的那样，**Erlang 擅长以非常高的并发性执行简单的任务**。如果您的服务器每秒或一次需要大量连接，Erlang 是您的朋友。Erlang 还为在多个服务器上分配负载提供了更好的支持。

**Haskell 擅长复杂的符号计算**，截至 2009 年 4 月，它还可以处理大量线程（参见下面的更新）。此外，Haskell 有**更多工具可以正确处理复杂的代码**：例如[QuickCheck](http://www.cs.chalmers.se/~rjmh/QuickCheck/)、[SmallCheck](http://www.cs.york.ac.uk/fp/smallcheck/)和静态类型系统。因此，如果您的服务器正在做复杂而有趣的事情，而您只需一台服务器就可以过关，那么使用 Haskell 可能会更好。

* * *

**2009 年 4 月 13 日更新**：可靠消息来源 Don Stewart 报告说“Glasgow Haskell 编译器中的最后一个线程缩放错误在几个月前就被压扁了”，并且一些用户报告说使用一百万个 Haskell 线程没有问题。截至 2009 年 1 月，实施者发表了[一篇新的、未发表的论文，](http://research.microsoft.com/en-us/um/people/simonpj/papers/parallel/)其中可能描述了如何实现这一目标。

* * *

**2012 年 2 月 21 日更新**：John Hughes 的公司[QuviQ](http://quviq.com)现在为 Erlang 制作 QuickCheck。他们发现了许多非常有趣的错误。您可以免费下载“QuickCheck Mini”；它与 Haskell QuickCheck 相当。还有一个更强大的商业版本。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-27T07:50:35.593

这些论文的基准表明 Haskell 可以与 Apache 竞争：

[*在 Concurrent Haskell 中开发高性能 Web 服务器*](http://research.microsoft.com/apps/pubs/default.aspx?id=67499)
— Simon Marlow

[*为可扩展的网络服务结合事件和线程：Monadic、应用程序级并发原语的实现和评估*](http://repository.upenn.edu/cgi/viewcontent.cgi?article=1391&context=cis_papers)
— Peng Li Stephan A. Zdancewic（参见图 19）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-27T15:10:11.133

> 我在 Haskell 和 Erlang 方面都没有经验，但从表面上看，它们似乎是一样的。

Haskell 和 Erlang 之间有一些非常明显的区别。Erlang 是专门为并发系统设计的。语言和虚拟机都被设计成支持很多很多的进程，Erlang 使用一个actor风格的系统来管理它们之间的通信。Haskell 也很容易支持并发，因为它的函数性质，*但是*在 Haskell 中进行并发编程仍然有点困难，并且语言没有专门设置来促进这一点。

与 Haskell 一样，Erlang 不会在进程之间共享状态，因此很容易编写多进程软件。但是 Haskell 和 Erlang 的编程风格有点不同，因为 Erlang 强调使用小进程来执行并发处理。

我喜欢 Haskell——它是我最喜欢的语言之一——但如果我要编写服务器软件，我可能会使用 Erlang。但是如果你更了解 Haskell 或者发现库支持更好的话，当然可以用 Haskell 编写服务器。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-02T16:10:44.647

现在有一个新选项：[使用 Haskell/Erlang FFI 在 Haskell 中编写逻辑并使用 Erlang 进行通信](http://haskell.org/haskellwiki/Applications_and_libraries/Interfacing_other_languages/Erlang)。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-12-27T05:56:05.993

上次我查看时，在 Erlang 中构建可扩展服务器的库和框架看起来比在 Haskell 中的要成熟一些。我建议查看[*Programming Erlang: Software for a Concurrent World*](https://rads.stackoverflow.com/amzn/click/com/193435600X)以了解这些信息。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-27T13:56:00.223

由于惰性，在 Haskell 应用程序中引入内存泄漏要容易得多。长时间运行的服务器*正是*那种你*真的*不希望有任何内存泄漏的程序。

虽然我同意 Haskell 是一种更可靠且更易于编程的语言，但 Erlang 更容易，并且有许多专门用于此类用途的库。

我认为没有与 Mnesia 等价的 Haskell，编写它会很困难。您*可以*编写 、 等的 Haskell 版本`gen_server`，`gen_event`但它们在十多年内都没有经过优化和调整。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-27T05:11:07.880

Haskell 是否与 Erlang 一样好取决于人们对一门语言的需求。我认为两者都可以作为游戏服务器做得很好，但这主要取决于您想要或期望从编程语言中获得什么。最容易注意到的区别之一是 Haskell 是一种具有类型推断的静态类型语言，而 Erlang 是一种动态类型语言。总的来说，我想说 Haskell 对那些不习惯函数式编程的人来说需要更多的“复杂性”。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-27T04:27:37.357

我相信你能找到这样想的人，但我认为你对 Erlang 支持这种使用的能力是错误​​的；它广泛用于电话应用程序，实际上非常强大。Erlang 针对高度可靠、高并发的服务器进行了非常优化。

# git - 有没有一种干净的方法来处理两个以相同内容开头的原始 git 存储库？

> ID：394647
> 
> 赞同：5
> 
> 时间：2008-12-27T04:11:23.007
> 
> 标签：git

假设我有两个从相同的初始内容创建的存储库。例如，如果我使用 git 来管理 /etc/apache2 中的 apache 配置文件，并且我分别`git init`在 machine-a 和 machine-b 上运行。

从那以后，我对 machine-b 进行了一些配置更改，我想将这些更改应用于 machine-a 上的配置，而不会覆盖不常见的东西，例如主机名等。

如果我这样做：

```
machine-a% remote add machine-b ssh://...
machine-a% git fetch machine-b 
```

我得到了 machine-b 上的所有提交，而 GitX 显示了一组完全断开的提交，正如我所期望的那样。

但是，如果我尝试合并 machine-b 的任何更改，我会在所有修改的行上遇到冲突。

就我的目的而言，这已经足够了，但我想知道，有没有更清洁的解决方案？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-27T19:17:00.917

你可能想看看 git 移植。此处提供了一些信息：http: [//git-scm.com/docs/git-filter-branch](http://git-scm.com/docs/git-filter-branch)

基本上，您要做的就是伪造祖先。

您在两台机器上都进行了初始提交——我们称它们为“baseA”和“baseB”。然后，您在两侧创建了第二个提交——“secondA”和“secondB”。你想要做的是告诉 git 'secondB' 没有 'baseB' 作为祖先，而是有 'baseA' 作为父级。

你可以通过使用移植物来做到这一点。例如，把它放在你的 .git/info/grafts 文件中：

```
secondB baseA 
```

（但随后使用真正的 SHA）。现在，如果你查看 GitX，你会看到历史是相互关联的。要使更改永久生效，您需要运行 git filter-branch。

## 从评论更新

我不确定您所做的是否“正确”，尽管它会起作用。如果你做你所做的，你会得到历史：

```
 BaseA --- SecondA -- .. - ..  - Merge
   \ BaseB --- SecondB ... - .. / 
```

这将起作用（并且合并将毫无问题地成功）。但是，更好的是：

```
 BaseA --- SecondA -- .. - ..  - Merge
   \ SecondB ... - .. / 
```

它基本上将“BaseA”作为提交并将“BaseA”设置为SecondB的父级。使用我告诉你的嫁接规则应该可以做到这一点。

为了证明这一点，我创建了一个小型存储库，您可以[在此处](http://frim.frim.nl/grafts_example.tar.gz)下载。

如果您查看 GitX 中的历史记录（“gitx master second_master”），您会看到历史记录是断开的。如果将 .git/info/_grafts 文件移动到 .git/info/grafts，您将获得第二个漂亮的历史记录。

我还添加了一个 .git/info/wrong_grafts 文件。如果您使用那个，您将获得您创建的历史记录。

如果你查看 grafts 文件中的 SHA，你会发现 _grafts 文件基本上有这个：

```
SecondB BaseA 
```

并且 wrong_grafts 文件有这个：

```
BaseB BaseA 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T18:32:09.743

这是 Git 的一个有趣的用法。我本可以用它来处理几个基于相同 wiki 代码库但配置非常不同的网站。

使用您的初始内容设置一个 Git 存储库，并为每台保存其当前配置的机器创建单独的分支。克隆到另一台机器并将每台机器设置为另一台机器的远程。

现在，您可以在一台机器上进行更改，并在提交时将它们推送到另一台机器上的分支。

如果您将公共元素与非公共元素分开提交，则可以

```
$ git checkout [localmachine bracnch]
$ git cherry-pick [SHA1 of common commit1]
$ git cherry-pick [SHA1 of common commit2] 
```

而且，如果您在一台机器上提交之前不知道要重用什么，您可以使用`git add --patch`从一个分支中提取单个差异并将它们暂存以提交到另一个分支。

对于两个以上的机器/站点，您可以将常见更改合并到每个分支上`MASTER`，并将更改合并`MASTER`到每个分支上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T04:26:45.613

Git 如何区分什么是“配置更改”和什么是“不常见的事情”？您是否只想在两者之间共享某些文件，例如 mime 类型的文件？

将共享部分分解为单独的文件并使用 Apache 的 Include 指令并将您想要忽略的任何文件添加到 .gitignore 怎么样？

# c++ - 使用哪个工具查看多重继承的内存布局

> ID：394650
> 
> 赞同：2
> 
> 时间：2008-12-27T04:13:11.723
> 
> 标签：c++

有没有工具可以用来查看已编译 C++ 代码的多重继承内存布局？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-27T04:33:51.713

我不知道你到底想知道什么。对于这个简单的例子

```
class classA { };

class classB { };

class classC : public classA, public classB {

};

$ g++ -fdump-class-hierarchy test.cpp 
```

将以下内容输出到文件中`test.cpp.002t.class`

```
Class classA
   size=1 align=1
   base size=0 base align=1
classA (0xb7b06780) 0 empty

Class classB
   size=1 align=1
   base size=0 base align=1
classB (0xb7b067bc) 0 empty

Class classC
   size=1 align=1
   base size=1 base align=1
classC (0xb7a736e0) 0 empty
  classA (0xb7b067f8) 0 empty
  classB (0xb7b06834) 0 empty 
```

有关详细信息，请参阅 gcc 手册页。将 classA 更改为此：

```
class classA { int aObj; virtual void aFun() { } }; 
```

突然弹出一个虚拟表：

```
Vtable for classA
classA::_ZTV6classA: 3u entries
0     (int (*)(...))0
4     (int (*)(...))(& _ZTI6classA)
8     classA::aFun

Class classA
   size=8 align=4
   base size=8 base align=4
classA (0xb7b4d7f8) 0
    vptr=((& classA::_ZTV6classA) + 8u)

Class classB
   size=1 align=1
   base size=0 base align=1
classB (0xb7b4d9d8) 0 empty

Vtable for classC
classC::_ZTV6classC: 3u entries
0     (int (*)(...))0
4     (int (*)(...))(& _ZTI6classC)
8     classA::aFun

Class classC
   size=8 align=4
   base size=8 base align=4
classC (0xb7aba820) 0
    vptr=((& classC::_ZTV6classC) + 8u)
  classA (0xb7b4da14) 0
      primary-for classC (0xb7aba820)
  classB (0xb7b4da50) 0 empty 
```

看起来很奇怪（_ZTI6classA 和 _ZTI6classC 和 _ZTV6classC）实际上是一个指向为类创建的 RTTI 信息 gcc 的指针。使用`-fno-rtti`表明它将为 vtables 的第二个条目分配一个空指针。很好，挖掘这些信息很有趣。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T04:24:36.333

是的，但你不会很喜欢它。您需要做的是使用 -S 标志（在 gcc 上，检查您的文档以了解其他编译器）并生成汇编代码，然后阅读它。

# remote-administration - 我可以使用什么程序来远程帮助客户？

> ID：394651
> 
> 赞同：1
> 
> 时间：2008-12-27T04:13:50.990
> 
> 标签：remote-administration

我有很多人要求我修理他们的电脑。通常是“慢速计算机”或“我的计算机有弹出窗口”等。换句话说，它们有病毒和间谍软件。我想我可以使用远程程序来做，而不是他们把电脑带给我或者我去他们家。

我想到了 UltraVNC，但我不确定如何让他们使用它。我想要的是他们可以从我的网站下载的程序。

你会为此推荐什么程序？远程桌面？虚拟网络？还有什么？如有必要，我很乐意支付少量费用以使事情尽可能无缝。口耳相传是有价值的，一个易于与计算机人员（我）一起工作的良好推荐值得每月或一次性费用。

我有 Vista，大多数人都会有 Vista Home Premium 或 XP Home。我有 Vista Home Premium 和 Mac OS X。如有必要，我可以使用 Linux。我只是现在没有安装它。

谢谢。

编辑：副驾驶有替代品吗？我喜欢它，但我害怕将所有东西都押在一个提供商身上。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-27T04:15:49.333

[https://www.copilot.com/](https://www.copilot.com/)

它变得简单，因此即使是最新手的计算机用户也可以弄清楚。

Copilot 通过让您连接到他们的计算机、查看他们看到的内容以及控制他们的鼠标和键盘来帮助解决问题，从而帮助您解决某人的计算机问题。

这很好，因为他们只是去网站并输入你给他们的代码。从那里开始安装很简单。

（修改的）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-27T04:22:41.347

[LogMeIn](http://logmein.com)有一个运行良好的免费版本。它在用户的系统托盘中运行，只要他们运行程序，您就可以登录和控制他们的计算机。免费版的功能少了一些，但它们大多是奢侈品，而不是必需品。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-27T05:00:48.523

[Team Viewer](http://www.teamviewer.com/index.aspx)是一款桌面共享远程控制支持工具。它可免费用于非商业、个人用途。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-27T04:24:49.953

有几个不同的选项：

*   远程桌面：界面不错，与 Windows 集成得很好（我从 XP 笔记本电脑连接到 Vista 桌面没有问题）。我认为您的客户需要有 Windows XP 专业版；XP home 没有远程桌面服务器。
*   RealVNC：界面不错，免费版非常好用。非免费版本提供加密连接。
*   还有其他的（比如 Copilot），但我只使用过 Remote Desktop 和 RealVNC。

对于其中任何一个，如果他们有路由器，您需要确保设置了端口转发，并且防火墙将程序列入白名单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-27T05:01:30.473

Windows XP 具有内置的“Windows 助手”，可让您向另一台 Windows 机器发送邀请（通常通过电子邮件），并允许您远程控制机器并让他们观看。这是一个不错的选择，因为它已经内置在 Windows 中（尽管不如 RemoteDesktop 或 LogMeIn 广为人知）。

与远程桌面相比的优势在于，用户可以看到您对他们的机器所做的事情，并且可以来回传递控制权。

[此链接](http://technet.microsoft.com/en-us/library/bb457004.aspx)包含执行此操作的步骤。

# user-interface - 未处理的异常是否可以接受？

> ID：394652
> 
> 赞同：0
> 
> 时间：2008-12-27T04:14:29.537
> 
> 标签：user-interface

在经历了某个媒体播放器的许多问题之后，我开始思考在这个时代，在没有任何相关信息的情况下提示用户启动调试器或终止应用程序真的可以接受吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T04:21:44.390

显然。您是否卸载了媒体播放器？

说真的，我会说“不，这是不可接受的”。但是似乎有很多供应商不同意我的观点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T10:27:22.593

也许不是，但你知道发生了**什么事情**:) “发生了一个闪亮的哦异常，请致电我们”和“只是经典的调试窗口消息”之间没有太大区别。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T04:25:30.810

重新启动后，媒体播放器“神奇地”似乎再次工作，我只是想“告诉我出了什么问题，我会尝试修复它”，而不是仅仅退出我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T04:28:40.633

并不真地。

虽然您无法真正预测程序中可能引发的所有您未考虑的异常，但您肯定可以`System.Exception`在程序顶部捕获并显示一个对话框，告诉用户向您报告信息。（甚至可以使用自动化系统在线执行此操作。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T04:33:30.717

同意，当然是“最后一道防线”，在这种情况下，正如您所说，System.Exception 应该给用户一个错误提示，以便他们可以采取行动。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-27T04:38:42.017

这只是开发人员的懒惰或无能吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-27T05:33:09.410

不。

（实际上，这就是我的全部答案，但是 SO 不喜欢简洁的答案，所以我不得不添加这个随机句子！;-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-27T10:35:33.013

取决于你的观众恕我直言。

如果您的目标是“普通乔”用户，我会说在顶级捕获您的母亲异常。终止应用程序并告诉用户出了点问题（请不要使用“打电话给我们”或“报告错误”的句子——它们没用）。

如果您的目标是开发人员（内部开发），恕我直言，未处理的异常是可以的，但最好的办法是打印和/或记录堆栈跟踪以及您获得的所有其他信息以及链接到一个网站，上面写着谁负责该应用程序以及如果问题仍然存在该联系谁。

# streaming - 用于网络摄像头的 iGoogle 小部件？

> ID：394665
> 
> 赞同：1
> 
> 时间：2008-12-27T04:30:16.447
> 
> 标签：streaming, webcam, igoogle

有谁知道我如何最好地通过 iGoogle 小部件流式传输网络摄像头？

我的理想是实际上能够在本地流式传输——也就是说，获得一个允许我显示计算机网络摄像头的小部件。这可能吗？

（不，我并没有那么虚荣。我将网络摄像头用作安全摄像头，我希望能够在我的 iGoogle 控制台上以流媒体形式查看它，作为一系列有用的自动小部件的一部分正在壁挂式平板显示器上显示。）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-27T05:40:12.750

Flash 可能是您最好的选择，因为它已经拥有您需要的一切，但是您可以只使用许多已经可用的服务之一并为其构建一个小部件。我个人的偏好是[uStream.tv](http://www.ustream.tv)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T05:47:37.663

iGoogle Widget 是否允许 iframe？

如果是，那么您几乎可以使用任何东西。

# ruby-on-rails - 在 Rails 中实现会话

> ID：394673
> 
> 赞同：3
> 
> 时间：2008-12-27T04:37:17.090
> 
> 标签：ruby-on-rails, ruby, ssl

我正在第一次通过在 Rails 中滚动我自己的身份验证和会话，我不确定我是否理解存在的会话支持。（首先，我的意思是我最初是通过 http 进行身份验证，而不是 https。生产代码将使用 https。）

我对安全会话的理解是，您通过 SSL 上的 cookie 将令牌传递给浏览器，然后将该令牌与存储在服务器上的令牌进行比较，以查看它是否真的是您认为的用户。我希望你们可以检查我对安全会话的理解，如下所示：

1.  用户获取登录页面并提交登录名和密码（通过 SSL POST）。
2.  服务器检查协议，然后根据数据库中的现有哈希检查密码的 sha1（通常是+盐）。如果它们匹配，则生成一个会话 ID，将其放入带有用户 ID 的 (n SSL) cookie 和服务器端会话存储中。将用户重定向到站点的安全区域。
3.  该会话 id 在用户登录的会话中保持不变——或者——服务器在每次安全操作后发出一个新的会话 id，通过 SSL cookie 发送它并将新值存储在数据库中。
4.  任何涉及私有或安全数据的操作都会检查会话存储是否存在此用户的会话 ID，如果存在，则在执行操作之前将 cookie 的 session_id 与会话存储进行比较。如果我们正在轮换会话 ID，请在操作后发出一个新的会话 ID（SSL cookie 和服务器端存储）。
5.  用户注销，这告诉服务器从会话存储中删除会话 ID 并清除 cookie。或者 cookie 在浏览器和/或服务器上过期，需要重新认证。

上面有什么明显的错误吗？此外，如果 cookie 中的令牌只是一个会话 ID，Rails 的 session[] 支持似乎不会阻止 MITM 攻击。那是对的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-27T04:59:28.260

我建议看看**restful_authentication**。这是 Rails 的事实上的标准认证库。

您实际上不需要自己生成 session_id ... Rails 会为您处理所有这些 - 根据浏览器提供的值检查会话 id。实际上，您可以将用户 ID 存储在 Rails 会话集合中，然后检查它是否存在。

如果您不使用 SSL 连接，从技术上讲，您很容易受到 MITM 攻击。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T13:18:35.057

您似乎混淆了“会话”和“正在登录”。Rails 中的 session 对象只是一个散列，存储在一个 cookie 中，它总是存在的——不管用户是否登录。

正如您所概述的，最常见的过程是将用户的 ID 存储在会话中。

restful_authentication 插件做了很多事情。也许您会发现我的[Blank Rails App](http://github.com/leethal/blank-rails-app/tree)更有帮助，因为它可以用更少的代码完成类似的操作。查看[会话控制器](http://github.com/leethal/blank-rails-app/tree/master/app/controllers/sessions_controller.rb)和[lib/authentication](http://github.com/leethal/blank-rails-app/tree/master/lib/authentication.rb)，其中定义了与身份验证相关的控制器代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T05:20:51.650

试试这个网站，[http://www.quarkruby.com/2007/10/21/sessions-and-cookies-in-ruby-on-rails](http://www.quarkruby.com/2007/10/21/sessions-and-cookies-in-ruby-on-rails)。它似乎对这个主题有相当全面的覆盖。

我的一个建议是，不仅要使用 SSL，还要对会话和您发送的其他 cookie 进行加密和编码（Base 64）。在会话 ID 中包含一个随机数（随机值），以便每次发送时加密/编码版本都会更改。如果您真的担心会话被劫持，您还可以定期重新生成会话 ID 以限制被劫持的 cookie 的暴露，尽管如果 cookie 不是持久的，加密它应该可以保护您。

即使您使用会话 id 的查询参数而不是 cookie，您也应该能够使用加密/编码思想。

# php - MySQL DATETIME question

> ID：394692
> 
> 赞同：1
> 
> 时间：2008-12-27T05:14:53.720
> 
> 标签：php, mysql, datetime, date, time

I have a DATETIME field. I would like to select all the records that have been updated in the last week. Right now I'm using this query:

```
SELECT SUM(mins_spent) as time_sum FROM todos WHERE 
lastUpdate >= '2008-12-22' AND lastUpdate <='2008-12-28' 
```

But the results i get seem to be different depending on time of the day, e.g on 7 PM I might get 17 hours and on 11 PM I'l get 14 hours even though it should be increasing, not decreasing. I was thinking of changing the query to:

```
SELECT SUM(mins_spent) as time_sum FROM todos WHERE 
lastUpdate >= '2008-12-22 00:00:00' AND lastUpdate <='2008-12-28 00:00:00' 
```

Would it help at all? Suggestions please..

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-27T05:46:22.690

`'2008-12-22'` should equal `'2008-12-22 00:00:00'`.

Are you wanting "till end-of-day 28th?" If so, add `23:59:59` to the 2nd date.
Alternatively, you can use `lastUpdate < "2008-12-29"`.

How are you tracking changes to an existing ToDo? `INSERT` and/or `DELETE`? Or `UPDATE`?

If you're `DELETE`'ing records upon "completion," you'll just have fewer records.

If you're `UPDATE`'ing, are you allowing dates to change to beyond the current week? If so, they'll be removed from your results.

To see what's happening, You may try grabbing a few aggregates on the table, `mins_spent`, and `lastUpdate` (mark down the values and run occasionally to see how they change).

```
SELECT count(*) AS Total
FROM todos
WHERE lastUpdate >= '2008-12-22' AND lastUpdate <= '2008-12-28 23:59:59'

SELECT min(mins_spent) AS Min, max(mins_spent) AS Max, avg(mins_spent) AS Avg
FROM todos
WHERE lastUpdate >= '2008-12-22' AND lastUpdate <= '2008-12-28 23:59:59'

SELECT min(lastUpdate) AS Min, max(lastUpdate) AS Max
FROM todos
WHERE lastUpdate >= '2008-12-22' AND lastUpdate <= '2008-12-28 23:59:59' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T07:33:07.360

Judging from the MySQL 6.0 Reference Manual for [Date and Time Types](http://dev.mysql.com/doc/refman/6.0/en/date-and-time-types.html), you should be more or less OK as written. However, if it really isn't working, then you may have found a reportable bug.

> A DATE value is coerced to the DATETIME type by adding the time portion as '00:00:00'. To perform the comparison by ignoring the time part of the DATETIME value instead, use the CAST() function to perform the comparison in the following way:
> 
> ```
> date_col = CAST(NOW() as DATE); 
> ```

Your queries say '<= '2008-12-28'; that should be strictly less-than, not less-than-or-equal.

One very fine point would be: do the expressions you wrote get treated as DATETIME (because the LHS is a DATETIME column) or as a DATE (because the RHS is best treated as a DATE) or, indeed, does the DATETIME get converted to a string to match the RHS? It would make a difference if the LHS is converted to a DATE, because any time on the 28th would come in range, whereas you seem to want everything from the 21st to the 27th. What happens if you do explicitly fixup the types with casts?

Also, is the MySQL server running in the same time zone as you? There seemed to be an 'off-by-an-hour' difference between what you were seeing and the nominal end of day? I'm still not sure exactly how that might be (mis-)working, but it could be an otherwise unaccounted for factor.

# html - HTML表格单元格间距或填充只是顶部/底部

> ID：394698
> 
> 赞同：28
> 
> 时间：2008-12-27T05:41:49.987
> 
> 标签：html, html-table

您可以在顶部/底部而不是所有 (T, B, L, R) 上设置单元格填充或间距吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-27T05:45:08.840

CSS？

```
td {
  padding-top: 2px;
  padding-bottom: 2px;
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-08-17T21:01:19.423

有css：

```
table { border-spacing: 40px 10px; } 
```

适用于 40px 宽和 10px 高

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-27T05:53:02.117

单元格间距在单元格周围，不能更改（即，如果设置为 1，则所有边都会有 1 个像素的空间）。可以谨慎地指定填充（例如`padding-top`、`padding-bottom`、`padding-left`和`padding-right;`或`padding: [top] [right] [bottom] [left];`）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-23T13:09:02.257

这可能会好一点：

```
td {
  padding:2px 0;
} 
```

# .net - 单个事务下具有相同连接字符串的多个连接，提升事务？

> ID：394702
> 
> 赞同：2
> 
> 时间：2008-12-27T05:44:14.177
> 
> 标签：.net, sql-server, ado.net, transactions, msdtc

当使用 ado.net 并在单个事务中创建到 MS SQL Server 数据库的多个连接时（使用 System.Transactions.TransactionScope），System.Transactions 是否将事务从轻量级事务管理器提升到分布式事务协调器（内核事务协调器在 Vista 上），即使所有连接对象的连接字符串都相同？

该文档在这种特定情况下有些模棱两可。它说如果在事务期间打开另一个连接到服务器，则事务将被提升，但它没有说它是否一直这样做，或者只有在连接字符串不同时才这样做。如果连接字符串相同，它会提升事务对我来说没有意义，但如果确实如此，它基本上使轻量级事务管理器完全无用，IMO。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T10:39:33.317

不幸的是，在当前版本中，它总是提升交易。

正如您所说，这使得 TransactionScope 的用处远不如其他方式。我相信有计划在未来的版本中改变这一点。

# functional-programming - 实现 Monad 的语言必须是静态类型的吗？

> ID：394709
> 
> 赞同：17
> 
> 时间：2008-12-27T05:51:31.340
> 
> 标签：functional-programming, monads, static-typing

我正在学习函数式编程风格。在[Don't Fear the Monads](http://channel9.msdn.com/shows/Going+Deep/Brian-Beckman-Dont-fear-the-Monads/)中，Brian Beckman 对 Monad 做了精彩的介绍。他提到 Monad 是关于函数的组合以解决复杂性。

> Monad 包含`unit`将 T 型转换为放大型 M(T) 的功能；和一个 Bind 函数，给定从 T 到 M(U) 的函数，将类型 M(T) 转换为另一种类型 M(U)。（U可以是T，但不一定）。

据我了解，实现 monad 的语言应该进行静态类型检查。否则编译时找不到类型错误，“复杂度”不受控制。我的理解正确吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-27T12:31:55.023

在动态类型语言中有很多 monad 的实现：

*   [Ruby 中的 Maybe Monad](http://Blog.PreTheory.Com/arch/2008/02/the_maybe_monad_in_ruby.php)
*   [OO Monads 和 Ruby](http://CWilliams.TextDriven.Com/pages/monads)（网站已关闭，但该文章[可在 Internet Archive 的 Wayback Machine 中找到](http://Web.Archive.Org/web/*/http://CWilliams.TextDriven.Com/pages/monads)）
*   [Ruby 中的 Monad 第 1 部分：身份](http://Meta-Meta.BlogSpot.Com/2006/12/monads-in-ruby-part-1-identity.html)，[Ruby 中的 Monad 第 1.5 部分：身份](http://Meta-Meta.BlogSpot.Com/2006/12/monads-in-ruby-part-15-identity.html)，[Ruby 中的 Monad 第 2 部分：可能（然后又可能不是）](http://Meta-Meta.BlogSpot.Com/2006/12/monads-in-ruby-part-2-maybe-then-again.html)
*   [Ruby 中的 Monad](http://MoonBase.Rydia.Net/mental/writings/programming/monads-in-ruby/)
*   [Monads on the Cheap I: The Maybe Monad in JavaScript](https://web.archive.org/web/20080119062355/http://osteele.com/archives/2007/12/cheap-monads) , [More Monads on the Cheap: Inlined fromMaybe](https://web.archive.org/web/20080302044628/http://osteele.com/archives/2008/02/inlined-frommaybe)
*   [Ruby 中的 Monad（语法很好！）](http://WWW.ValuedLessons.Com/2008/01/monads-in-ruby-with-nice-syntax.html)，[列出 Ruby 和 Python 中的 Monad](http://WWW.ValuedLessons.Com/2008/01/recently-i-wrote-about-ways-to-add.html)
*   [Ruby 的 Haskell 风格的 monad do-notation](https://GitHub.Com/Aanand/Ruby-Do-Notation/)

一般来说，Church-Turing-Thesis 告诉我们，可以用*一种*语言完成的*所有事情也可以用其他所有*语言完成。

从上面选择的示例中您可能可以看出，我（主要）是一名 Ruby 程序员。*所以，开个玩笑，我拿了上面的一个例子，用一种我完全不*知道的语言重新实现了它，这通常被认为是一种不是很强大的语言，而且它似乎是唯一的编程语言在我无法找到 Monad 教程的星球上。我可以向您介绍... PHP 中的 Identity Monad：

```
<?php
class Identity {
  protected $val;
  public function __construct($val) { $this->val = $val; }
  public static function m_return($a) { return new Identity($a); }
  public static function m_bind($id_a, $f) { return $f($id_a->val); }
}

var_dump(Identity::m_bind(
  Identity::m_return(1), function ($x) {
    return Identity::m_return($x+1);
  }
));
?> 
```

没有静态类型，没有泛型，不需要闭包。

现在，如果你真的想静态检查 monad，那么你需要一个静态类型系统。但这或多或少是一个重言式：如果你想静态检查类型，你需要一个静态类型检查器。呃。

关于你的问题：

> 据我了解，实现 monad 的语言应该进行静态类型检查。否则编译时找不到类型错误，“复杂度”不受控制。我的理解正确吗？

你是对的，但这与单子无关。这只是一般的静态类型检查，同样适用于数组、列表甚至是普通无聊的整数。

这里还有一个红鲱鱼：如果你看一下 C#、Java 或 C 中的 monad 实现，它们比上面的 PHP 示例要长得多，也复杂得多。特别是，到处都有*大量*的类型，所以它*看起来*确实令人印象深刻。但丑陋的事实是：C#、Java 和 C 的类型系统实际上并不足以表达`Monad`. 特别是，`Monad`是 rank-2 多态类型，但 C# 和 Java 仅支持 rank-1 多态（他们称之为“泛型”，但它是同一回事），C 甚至不支持。

因此，monad 实际上在 C#、Java 和 C 中*没有*进行静态类型检查。（例如，这就是为什么 LINQ monad 理解被定义为模式而不是类型的原因：因为您根本无法在 C# 中*表达*类型。 ) 所有静态类型系统所做的，就是使实现更加复杂，而没有实际帮助。它需要更复杂的类型系统，例如 Haskell 的，才能获得 monad 的实际类型安全性。

注意：正如@Porges 指出的那样，我上面写的*仅*适用于泛型类型本身。`monad`您当然可以表达任何*特定*monad 的类型，例如`List`or `Maybe`，但您不能表达其`Monad`自身的类型。这意味着您无法对“ `List`IS-A `Monad`”的事实进行类型检查，并且您无法对适用于所有实例的通用操作进行类型检查`Monad`。

（请注意，即使对于 Haskell 的类型系统，除了符合 monad*类型*之外，检查`Monad`它还遵守 monad*法则*可能太多了。您可能需要依赖类型，甚至可能需要一个成熟的自动定理证明器。）

 ** * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T06:01:55.997

正如您的问题标题所要求的那样，实现单子的语言肯定不是*必须静态类型的。*出于您概述的原因，这可能是一个好主意，但是在编译时未能检测到的错误从未阻止任何人。看看有多少人写PHP。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-15T02:43:06.933

您需要关闭 State monad。我查了一下，PHP 从 5.3 开始就关闭了。这样就不再是问题了。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2010-05-11T13:47:38.380

不，在 php 中不可能实现单子。为此，您需要闭包。尽管如此，当您使用类模拟模式匹配时，Maybe 的概念仍然很有用：

```
abstract class Maybe {
        abstract public function isJust();
        public function isNothing(){
                return !$this->isJust();
        }
}

class Just extends Maybe {
        protected $val = null;
        public function __construct($val){
                $this->val = $val;

        }
        public function isJust(){
                return true;
        }
        public function getVal(){
                return $this->val;
        }

}
class Nothing extends Maybe {
        protected $val = null;
        public function __construct(){

        }
        public function isJust(){
                return false;
        }
}

function just(){
        print "isJust";
}
function nothing(){
        print "nothing";
}
function MaybeFunc(Maybe $arg){
        if(get_class($arg) == 'Just'){
                print "Just";
        } else {
                print "Nothing";
        }
}

MaybeFunc(new Just(5));
MaybeFunc(new Nothing()); 
```

# .net - 使用 Masterpage 在 ASP.Net 页面上进行 javascript 验证的最佳方法是什么？

> ID：394715
> 
> 赞同：0
> 
> 时间：2008-12-27T05:56:51.407
> 
> 标签：.net, asp.net, javascript, master-pages

我正在母版页内的 ASP.Net 页面上实现 Javascript 验证。控件 ID 正在更改，因此我无法使用原始控件 ID 进行验证。我在网上查看并得到了动态构建脚本的建议，并使用 RegisterStartupScript 将其添加到页面中。我不喜欢那个解决方案，因为它不可维护。

我可以通过哪些方式在此页面上执行 javascript 验证并安排客户端 ID？

另一个解决方案只是要求我继续使用浏览器中显示的最终客户端 ID。这是可行的，我更喜欢在运行时创建脚本。你怎么看？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T06:09:25.500

IMO，复制出现在浏览器中的最终 ClientID 值是等待发生的麻烦。如果您更改代码中的控件 ID 并忘记在 javascript 中更改它，您可能不会注意到，直到验证神秘地停止工作。通过动态构建它，您至少会从编译时错误中受益。

当我需要在 javascript 中访问控件的客户端 ID 时，我在页面顶部放置了一个脚本块：

```
<script>
    var SomeControl = <%= Control1.ClientID %>;
    var AnotherControl = <%= Control2.ClientID %>;
    // etc, etc.
</script> 
```

不幸的是，它仍然感觉像一个丑陋的黑客。ASP.NET 的未来版本应该会解决这种情况。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T06:44:30.017

最佳解决方案取决于您的具体情况。在 Asp.Net 表单中处理验证的最简单和最易于维护的方法是使用内置验证控件。这些获取您要验证的控件的 ID，然后在该控件上提供客户端 (javascript) 和服务器端验证。他们为您处理自动接线和 javascript 创建。

如果这些由于某种原因不起作用并且您想在 javascript 中编写自己的验证函数，那么您需要使用类似于上述 Brant 解决方案的东西。正如布兰特所说，使用

```
<%= Control1.ClientID%>
```

在您的 javascript 中优于从浏览器源复制最终呈现的控件 ID，因为控件的最终 ID 会根据许多因素而变化，包括控件的 ID 和可能嵌套在其下方的任何父控件的 ID (用户控件、网格、中继器等）。.ClientID 将为每种情况输出控件的最终呈现 ID。这种技术可能*看起来*像一个肮脏的黑客，但它实际上是一种非常干净的方法来处理内置于框架中的 ID 重写以防止命名冲突。这是许多网站上使用的标准技术。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T06:46:06.643

通过内联代码（例如 <% %> 标记）引用 ClientID 是完全可以接受的。但是，给出的示例不会真正起作用；你需要访问 DOM...

```
<script language="javascript" type="text/javascript">
  var control = document.getElementById('<%= control.ClientID %>');
</script> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-27T18:24:45.267

另一种方法，虽然性能不高，是使用 JQuery。

在您要查找的每个控件中放置一个自定义 css 类。如果它是一个文本框，它可能如下所示：

```
< asp:TextBox id="NameTextBox" runat="server" cssClass="NameTextBox" > 
```

这应该像这样点击浏览器：

```
< input id="something_NameTextBox" type="text" class="NameTextBox" > 
```

然后，使用 JQuery，您可以找到这样的控件：

```
$(".NameTextBox") 
```

您可以使用以下方法获取文本框的值：`$(".NameTextBox").val()`

这不是那么高效，通过 ID 查找控件更快，但如果页面不是太大，这将正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T09:47:33.420

js 代码有两点需要满足： 1\. 在方便的 JS 编辑器中编辑 JS 代码。（例如VS） 2.安全的多个控制实例共存。

有一个通用的方法来提供这两个东西：分开

*   公共代码，独立于客户端 ID
*   取决于具体 ID 的代码。

如果计划很少更改，公共代码可以存储为 .js 文件或网络资源。ID 相关代码可以按照 Brant 的回答进行排列，例如

```
 <script>
       var <%=c1.ClientID %> = new SomeJsClass(<%=c1.ClientID %>);
       var <%=c2.ClientID %> = document.getElementById('<%=c1.ClientID %>');
   </script> 
```

处理这些变量的代码可能位于单独的 .js 文件中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-27T06:49:24.687

以下是我使用的两种方式：

在主人：

```
Page.ClientScript.RegisterClientScriptInclude("somescript", ResolveUrl("some.js")); 
```

以编程方式：

```
HtmlGenericControl JScript1 = new HtmlGenericControl("script");
JScript1.Attributes.Add("type", "text/javascript");
JScript1.Attributes.Add("src", ResolveUrl("some.js"));
this.Page.Header.Controls.Add(JScript1); 
```

# economics - 软件开发经济学

> ID：394719
> 
> 赞同：13
> 
> 时间：2008-12-27T06:00:05.377
> 
> 标签：economics

任何人都可以向我指出任何试图制定软件开发经济学的参考资料吗？在我自己的研究中，我发现了 Barry Boehm 的一本书，但它看起来非常尴尬和理论化。

依赖结构矩阵似乎提供了一些有价值的东西。卡利斯鲍德温在一些关于模块化、边界和交易成本的工作中使用了这些。不过，其中很多只是常识。

此外，经济学家还开发了一种称为行为经济学的东西。是否存在解决开发人员或开发人员群体认知偏差的“行为软件工程”？

这是一个有趣的参考：
[http ://www.amazon.com/Knowledge-Sharing-Software-Development-Comparing/dp/3639100840/ref=sr_1_1?ie=UTF8&s=books&qid=1232979573&sr=1-1](https://rads.stackoverflow.com/amzn/click/com/3639100840)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T06:53:57.220

在[哈尔瓦里安](http://en.wikipedia.org/wiki/Hal_Varian)成为谷歌首席经济学家之前，他曾在伯克利从事信息技术经济学研究，尽管他并不专注于软件开发本身。尽管如此，我还是建议您看一下[他 2001 年关于更一般主题的论文](http://people.ischool.berkeley.edu/~hal/Papers/mattioli/mattioli.html)。您可以在他的网站上找到[他的研究工作](http://people.ischool.berkeley.edu/~hal/people/hal/papers.html)的更完整列表。希望有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T07:48:20.137

[软件作为资本](https://rads.stackoverflow.com/amzn/click/com/0818677791)并不是浪费时间，尽管你不会在其中找到任何数学知识，而且它读起来就像一篇博士论文，因为它一开始就是一篇。

[另一个审查。](http://www.utdallas.edu/~plewin/SoftwareasCapital.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-28T07:55:56.923

我认为您正在寻找的内容可能属于[软件开发](https://rads.stackoverflow.com/amzn/click/com/0132366134)社会学……社会学家研究所有现代学科，如果有的话，您无疑会从那里找到对软件开发经济学的参考。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T06:42:50.113

[Robert Glass 的软件工程事实和谬误](http://www.amazon.com/s/ref=nb_ss_gw_0_21?url=search-alias%3Daps&field-keywords=facts+and+fallacies+of+software+engineering&x=0&y=0&sprefix=facts+and+fallacies+o)有一些与某些活动相关的美元金额（或至少占总预算的百分比）。不知道这是否有帮助，但它是一些东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-15T11:13:36.253

[几年前，我使用 Varian 的书INFORMATION RULES](http://www.inforules.com/)教授“电子商务经济学”课程。然而，他的锁定概念几乎将读者引向了购买者行为和剥削的吸毒者模型。这本书更多的是电子商务经济学，而不是软件开发过程的分析。

在实际制作软件方面，[神话人物月](http://en.wikipedia.org/wiki/The_Mythical_Man-Month)有一些值得了解的想法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-09-26T20:03:16.823

Douglas Hubbard 的“应用信息经济学”方法可能是您正在寻找的内容的一部分。如果我们假设软件开发（通常|总是|有时|???）通过提供（更好|更准确|更最新|无论如何）信息来支持决策，那么 AIE 会有所帮助，因为它是一种量化价值的技术更好的信息。阅读 Hubbard 的《*如何测量任何事物*》一书，以获得对这个想法的一个很好的概述。

此外，Mark Denne 和 Jane Cleland-Huang 所著的*Software By Numbers*一书提供了一个使用他们称之为“增量资金方法”的方法来管理软件项目的模型。IFM 基于所创造的业务价值将软件项目分解为功能，而不是沿着技术边界分解它们。然后，他们使用基于折现现金流 (DCF)、净现值 (NPV)、内部收益率 (IRR) 等的一系列计算来显示项目在项目生命周期中何时达到自筹资金状态，何时它将达到“盈亏平衡”，何时将为组织带来真正的正现金回报。

您可能还会发现感兴趣的*Capability Cases*书。它没有严格地详细处理任何经济问题，但它是一种软件规范方法，它试图更清楚地将软件功能映射到业务战略和业务问题。

# c# - C# - 如何确定源代码是否编译成功

> ID：394738
> 
> 赞同：1
> 
> 时间：2008-12-27T06:21:13.743
> 
> 标签：c#

我在代码中运行 C# 编译器，有点像我自己的 IDE。

我为命令行创建了一个批处理文件。

并运行并`Process.Start()`等待直到。`HasExited``true`

但是如何知道源代码编译是否成功呢？

马尔科姆

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-27T06:36:52.963

为什么您通过进程 API 使用 csc 而不是使用 System.CodeDom.Compiler API？这将为您提供相同的效果（实际上，它在内部调用 csc），但它是跨平台的，可以处理错误，允许您更轻松地以编程方式调整选项等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T06:30:27.610

通常使用命令行应用程序，您可以查看返回代码（批处理文件中的 ERRORLEVEL）。0 表示成功。其他任何事情都意味着某种失败。

# wpf - 有人知道我可以嵌入到 WPF 窗口或 Windows 窗体中的代码编辑器吗？

> ID：394751
> 
> 赞同：45
> 
> 时间：2008-12-27T06:43:49.783
> 
> 标签：wpf

我想创建自己的 IDE，但我想要一个可以突出显示语法的代码编辑器。

我想将它作为控件嵌入到 WPF 窗口中。

马尔科姆

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-27T17:02:53.013

[Sharp Develop IDE](https://github.com/icsharpcode/SharpDevelop)有一个很棒的代码编辑器，可以相对容易地在您的程序中使用（它确实需要一些工作来弄清楚它是如何工作的，并且它没有“即插即用”文档）。如果您查看[Kaxaml](https://github.com/thinkpixellab/kaxaml)的源代码，您可以了解如何将其嵌入 WPF。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-01-18T11:06:23.773

如果您不介意没有任何文档，[AvalonEdit](http://wiki.sharpdevelop.net/Default.aspx?Page=AvalonEdit&AspxAutoDetectCookieSupport=1)是一个不错的选择。我目前正在用于一个项目，它是一个很棒的工具。即使在复杂的场景中，我也没有遇到过一个错误。

你可以在 svn://svnmirror.sharpdevelop.net/sharpdevelop/trunk/SharpDevelop/src/Libraries/AvalonEdit 找到它的源代码。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-29T06:37:24.413

另一种选择是 Scintilla.NET（已**更新** [https://github.com/jacoblusser/ScintillaNET](https://github.com/jacobslusser/ScintillaNET)）。

它是 Scintilla Native Control 的 .NET 2.0 包装器。我们已成功用于显示/编辑 HLSL、XML、文本和其他内部脚本语言。如果需要，很容易为您自己的语言编写语言描述文件。

我目前在我们的 WPF 应用程序中托管 WinForms 控件。唯一的困难是在控件内单击时激活 WPF 上下文菜单；通过侦听 WinFormsHost 上的 MouseRightButtonDown 事件然后设置 ContextMenu 可见（ContextMenu.IsOpen = true）来解决它：/

我一直在联系 Actipro Software re: SyntaxEditor，WPF 版本正在积极开发中，即将推出。暂时我们将继续使用 Scintilla.NET

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-11-14T17:12:09.313

WPF 的另一种可能性：

[http://syntaxhighlightbox.codeplex.com/](http://syntaxhighlightbox.codeplex.com/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-27T10:45:43.680

Actipro 软件的 SyntaxEditor ( [http://www.actiprosoftware.com](http://www.actiprosoftware.com) )。它不会比那更容易。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-01T13:38:19.637

WPF 第一个公开测试版的 Actipro SyntaxEditor 现已上线 ( [http://www.actiprosoftware.com/Products/DotNet/WPF/SyntaxEditor/Default.aspx](http://www.actiprosoftware.com/Products/DotNet/WPF/SyntaxEditor/Default.aspx) )。它有一个功能非常丰富的基础框架，我们根据我们在该领域的多年经验投入了数月的开发时间。更多功能将很快添加，但同时查看我们提供的 40 多个示例。也适用于 XBAP！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-09-01T11:13:41.547

我最喜欢的是 Actipro 免费的有： [http://www.codeproject.com/KB/library/storm.aspx](http://www.codeproject.com/KB/library/storm.aspx) [http://www.codeproject.com/KB/edit/AvalonEdit.aspx](http://www.codeproject.com/KB/edit/AvalonEdit.aspx)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-12T15:02:07.830

也许您对 AqiStar.TextBox ( [http://aqistar-textbox.software.informer.com](http://aqistar-textbox.software.informer.com) ) 感兴趣。

这是一个针对 WPF 的语法高亮文本编辑器控件，快速且易于使用，但不是免费的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-09-01T11:32:02.637

我知道有两个可用：[qwhale 编辑器](http://www.qwhale.net/products/editor.htm)

和[同步融合](http://www.syncfusion.com/)

两者都是.net控件。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-04-04T05:53:40.650

试试[http://mycodelog.com/2010/04/01/xml-editor/](http://mycodelog.com/2010/04/01/xml-editor/)

# ide - 是否有带有集成调试器的 D IDE？

> ID：394757
> 
> 赞同：9
> 
> 时间：2008-12-27T06:53:08.203
> 
> 标签：ide, debugging, d

是否有带有集成调试器的 D IDE？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-27T07:21:26.790

[Descent](http://www.dsource.org/projects/descent)可以使用调试器。不完全是你问的，但是......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T01:18:05.890

DDBG *Win32 调试器适用***于** 一些 IDE - [http://ddbg.mainia.de/](http://ddbg.mainia.de/)

 ** * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-27T06:55:39.697

[波塞冬](http://dsource.org/projects/poseidon)。

# c++ - C ++将二维数组对象插入另一个二维数组对象

> ID：394763
> 
> 赞同：0
> 
> 时间：2008-12-27T07:00:39.017
> 
> 标签：c++, multidimensional-array

在使用 Dev C++ 时，我试图将较小的 2D 数组对象插入到较大的 2D 数组对象中。在尝试实现这一目标时，我遇到了我不知道如何解决的编译器错误。

我尝试通过使其返回数组的名称来插入较小的对象。然后我尝试用较小数组的值更改大数组中的值。

有两行代码我有问题：

```
int result = smallerArray.extractPiece();
largerArray.extractArray(result); 
```

在这两行代码中：

```
int Piece::extractPiece()
{
    return **pieceArray;
} 
```

和

```
无效网格::extractArray(int** arr)
{
    for(int i = 0; i < xGrid ; ++i)
    {
         对于 (int j = 0; j < yGrid ; ++j)
         {
             平方[i][j] = arr[i][j];
                 }
    }
}

```

两个问题是“int result”将不包含smallerArray.extractPiece（），如果我只是将“smallerArray.extractPiece（）”放入largerArray.extractArray（）中，我仍然会遇到问题。我试图将“int result”作为指针指针，作为“int** result”，我仍然有同样的错误。

这些是我尝试在 Dev C++ 中编译时遇到的错误：

```
In function `int main()';
invalid conversion from `int' to `int**'
initlizing argument 1 of 'void Grid::extractArray(int**)'
[Build Error] [grid test.o] Error 1 
```

有谁知道出了什么问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T07:09:45.080

正是这一串代码：

```
int result = smallerArray.extractPiece();
largerArray.extractArray(result);
// ...
int Piece::extractPiece() {
    return **pieceArray;
} 
```

试图将一个 int 传递给 extractArray，它需要一个指向指针的指针，可能是你的动态数组，而不是一个 int。尝试将其更改为

```
int **result = smallerArray.extractPiece();
largerArray.extractArray(result);
// ...
int ** Piece::extractPiece() {
    return pieceArray;
} 
```

仅将结果更改为指向指针的指针是行不通的。您当然还必须更改 extractPiece 返回的内容（从 int 更改为 int**）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T09:08:37.073

看，至少对我来说，将二维数组内部管理为一维数组更容易，其中 M[i,j]=A[i*N+j] 其中 N 是列数（或行数，如果二维数组是行列类型）。用户可以获得具有 i,j 索引的元素，但我的类始终将 A[M * N] 存储为私有数据。传递 1-D 指针数组比管理 2-D 指针数组更容易（您不能陷入在某些代码中可能会变得混乱的指针到指针语法）。，

这与这个问题无关，但由于我不知道具体的编译器优化内在，我想知道 M[i,j] 是否在内部转换为 A[i] 以在生成的代码中使用更简单的寻址模式。

# c - 指针算术

> ID：394767
> 
> 赞同：60
> 
> 时间：2008-12-27T07:10:39.027
> 
> 标签：c, pointers, pointer-arithmetic

有没有人有任何关于指针运算的好文章或解释（博客、示例）？图的听众是一群学习C和C++的Java程序员。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-27T07:31:48.907

这是我学习指针的地方：[http ://www.cplusplus.com/doc/tutorial/pointers.html](http://www.cplusplus.com/doc/tutorial/pointers.html)

一旦你理解了指针，指针算术就很容易了。它与常规算术之间的唯一区别是您添加到指针的数字将乘以指针指向的类型的大小。例如，如果您有一个指向 an 的指针，`int`并且 an`int`的大小为 4 个字节，`(pointer_to_int + 4)`则将评估为提前 16 个字节（4 个整数）的内存地址。

所以当你写

```
(a_pointer + a_number) 
```

在指针算术中，真正发生的是

```
(a_pointer + (a_number * sizeof(*a_pointer))) 
```

在常规算术中。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2008-12-27T07:21:24.730

首先，[binky](http://cslibrary.stanford.edu/104/)视频可能会有所帮助。这是一个关于指针的好视频。对于算术，这里有一个例子：

```
int * pa = NULL;
int * pb = NULL;
pa += 1; // pa++. behind the scenes, add sizeof(int) bytes
assert((pa - pb) == 1);

print_out(pa); // possibly outputs 0x4
print_out(pb); // possibly outputs 0x0 (if NULL is actually bit-wise 0x0) 
```

[（请注意，严格递增包含空指针值的指针是未定义的行为。我们使用 NULL 是因为我们只对指针的值感兴趣。通常，仅在指向数组元素时使用递增/递减）。]

下面展示了两个重要的概念

*   整数与指针的加/减意味着将指针向前/向后移动 N 个元素。因此，如果一个 int 是 4 字节大，pa 在我们的平台上可能包含 0x4 后递增 1。
*   另一个指针减去一个指针意味着得到它们的距离，由元素测量。所以从 pa 中减去 pb 将得到 1，因为它们有一个元素距离。

举一个实际的例子。假设您编写了一个函数并且人们为您提供了一个开始和结束指针（在 C++ 中很常见）：

```
void mutate_them(int *begin, int *end) {
    // get the amount of elements
    ptrdiff_t n = end - begin;
    // allocate space for n elements to do something...
    // then iterate. increment begin until it hits end
    while(begin != end) {
        // do something
        begin++;
    }
} 
```

`ptrdiff_t`是什么类型的（结束 - 开始）。对于某些编译器，它可能是“int”的同义词，但对于另一种编译器可能是另一种类型。一个人不知道，所以选择通用 typedef `ptrdiff_t`。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-27T08:08:49.020

应用 NLP，称之为地址算术。'指针'之所以令人恐惧和误解，主要是因为它们是由错误的人教的和/或在错误的阶段以错误的方式使用错误的例子。难怪没有人“得到”它。

在教授指针时，教师继续说“p是指向a的指针，p的值是a的地址”等等。它只是行不通。这是供您建造的原材料。练习它，你的学生会得到它。

'int a'，a是一个整数，它存储整数类型的值。'int* p', p 是一个'int star'，它存储'int star' 类型的值。

'a' 是如何获取存储在 a 中的 'what' 整数（尽量不要使用 'value of a'）

'b = a' 为此，双方必须是相同的类型。如果 a 是 int，则 b 必须能够存储 int。（所以______ b，空白处用'int'填充）

'p = &a' 为此，双方必须是相同的类型。如果 a 是整数，&a 是地址，则 p 必须能够存储整数的地址。（所以______ p，空白处用'int *'填充）

现在以不同的方式编写 int *p 以显示类型信息：

整数* | p

什么是'p'？回答：它是'int *'。所以'p'是一个整数的地址。

整数 | *p

什么是'*p'？答：它是一个'int'。所以 '*p' 是一个整数。

现在到地址算术：

诠释一个; a=1; a=a+1;

我们在'a = a + 1'中做什么？将其视为“下一个”。因为 a 是一个数字，这就像说“下一个数字”。由于 a 持有 1，因此说“下一个”将使其成为 2。

// 错误的例子。你被警告了！！！int *p int a; p = &a; p=p+1；

我们在'p = p + 1'中做什么？它仍然在说“下一步”。这一次，p 不是数字而是地址。所以我们所说的是“下一个地址”。下一个地址取决于数据类型，更具体地说取决于数据类型的大小。

printf("%d %d %d", sizeof(char), sizeof(int), sizeof(float));

所以地址的“下一个”将向前移动 sizeof（数据类型）。

这对我和我曾经教过的所有人都有效。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-27T07:44:50.893

我认为指针算术的一个很好的例子是以下字符串长度函数：

```
int length(char *s)
{
   char *str = s;
   while(*str++);
   return str - s;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-27T08:11:51.680

所以，要记住的关键是指针只是一个字大小的变量，它是为解除引用而键入的。这意味着无论是void *，int *，long long **，它仍然只是一个字大小的变量。这些类型之间的区别在于编译器认为取消引用的类型。澄清一下，字长意味着虚拟地址的宽度。如果你不知道这是什么意思，只要记住在 64 位机器上，指针是 8 个字节，而在 32 位机器上，指针是 4 个字节。地址的概念对于理解指针非常重要。地址是能够唯一标识内存中某个位置的数字。内存中的所有东西都有一个地址。出于我们的目的，我们可以说每个变量都有一个地址。这不一定总是正确的，但编译器让我们假设这一点。地址本身是字节粒度的，这意味着 0x0000000 指定内存的开头，而 0x00000001 是内存中的一个字节。这意味着通过向指针添加一个，我们将一个字节向前移动到内存中。现在，让我们使用数组。如果你创建一个 quux 类型的数组，它有 32 个元素大，它将从分配的开头跨越到分配的开头加上 32*sizeof(quux)，因为数组的每个单元都是 sizeof(quux) 大的。所以，实际上，当我们用 array[n] 指定数组的元素时，这只是 *(array+sizeof(quux)*n) 的语法糖（简写）。指针运算实际上只是更改您所指的地址，这就是我们可以使用 strlen 实现的原因 0x00000001 是内存中的一个字节。这意味着通过向指针添加一个，我们将一个字节向前移动到内存中。现在，让我们使用数组。如果你创建一个 quux 类型的数组，它有 32 个元素大，它将从分配的开头跨越到分配的开头加上 32*sizeof(quux)，因为数组的每个单元都是 sizeof(quux) 大的。所以，实际上，当我们用 array[n] 指定数组的元素时，这只是 *(array+sizeof(quux)*n) 的语法糖（简写）。指针运算实际上只是更改您所指的地址，这就是我们可以使用 strlen 实现的原因 0x00000001 是内存中的一个字节。这意味着通过向指针添加一个，我们将一个字节向前移动到内存中。现在，让我们使用数组。如果你创建一个 quux 类型的数组，它有 32 个元素大，它将从分配的开头跨越到分配的开头加上 32*sizeof(quux)，因为数组的每个单元都是 sizeof(quux) 大的。所以，实际上，当我们用 array[n] 指定数组的元素时，这只是 *(array+sizeof(quux)*n) 的语法糖（简写）。指针运算实际上只是更改您所指的地址，这就是我们可以使用 strlen 实现的原因 它将从分配的开始跨越到分配的开始加上 32*sizeof(quux)，因为数组的每个单元格都是 sizeof(quux) 大的。所以，实际上，当我们用 array[n] 指定数组的元素时，这只是 *(array+sizeof(quux)*n) 的语法糖（简写）。指针运算实际上只是更改您所指的地址，这就是我们可以使用 strlen 实现的原因 它将从分配的开始跨越到分配的开始加上 32*sizeof(quux)，因为数组的每个单元格都是 sizeof(quux) 大的。所以，实际上，当我们用 array[n] 指定数组的元素时，这只是 *(array+sizeof(quux)*n) 的语法糖（简写）。指针运算实际上只是更改您所指的地址，这就是我们可以使用 strlen 实现的原因

```
while(*n++ != '\0'){
  len++;
} 
```

因为我们只是一个字节一个字节地扫描，直到我们达到零。希望有帮助！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-27T10:07:55.907

有几种方法可以解决它。

大多数 C/C++ 程序员认为的直观方法是指针是内存地址。litb 的示例采用了这种方法。如果你有一个空指针（在大多数机器上对应于地址 0），并且你加上一个 int 的大小，你会得到地址 4。这意味着指针基本上只是花哨的整数。

不幸的是，这存在一些问题。首先，它可能行不通。不能保证空指针实际使用地址 0。（尽管将常量 0 分配给指针会产生空指针）。

此外，不允许增加空指针，或者更一般地说，指针必须始终指向分配的内存（或过去的一个元素），或特殊的空指针常量 0。

所以一个更正确的想法是指针只是迭代器，允许你迭代分配的内存。这确实是 STL 迭代器背后的关键思想之一。它们被建模为非常像指针，并提供修补原始指针以作为适当的迭代器工作的特化。

[例如，这里](http://ventspace.wordpress.com/2008/10/06/c-versus-reality/)给出了更详细的解释。

但是后一种观点意味着您应该真正解释 STL 迭代器，然后简单地说指针是这些迭代器的特例。您可以增加一个指针以指向缓冲区中的下一个元素，就像您可以使用`std::vector<int>::iterator`. 它可以指向数组末尾的一个元素，就像任何其他容器中的结束迭代器一样。您可以减去指向*同一缓冲区的*两个指针以获得它们之间的元素数量，就像使用迭代器一样，并且就像使用迭代器一样，如果指针指向单独的缓冲区，则*无法*有意义地比较它们。（作为一个实际的例子，为什么不考虑在分段的内存空间中发生了什么。指向不同段的两个指针之间的距离是多少？）

当然，在实践中，CPU 地址和 C/C++ 指针之间存在非常密切的相关性。但它们并不*完全相同*。指针有一些限制，这些限制在您的 CPU 上可能不是绝对必要的。

当然，大多数 C++ 程序员在第一次理解时都会蒙混过关，即使它在技术上是不正确的。它通常与您的代码最终表现得足够接近，以至于人们认为他们得到了它，然后继续前进。

但是对于来自 Java 并且刚刚从头开始学习指针的人来说，后一种解释可能同样容易理解，并且以后会给他们带来更少的惊喜。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-11-04T23:01:48.467

[这](http://www.cs.umd.edu/class/sum2003/cmsc311/Notes/BitOp/pointer.html)是关于指针算术的一个非常好的链接

例如：

**指针和数组**

计算 ptr + i 的地址的公式，其中 ptr 的类型为 T *。那么地址的公式是：

addr( ptr + i ) = addr( ptr ) + [ sizeof( T ) * i ]

对于 32 位平台的 int 类型，addr(ptr+i) = addr(ptr)+4*i;

**减法**

我们还可以计算 ptr - i。例如，假设我们有一个名为 arr 的 int 数组。诠释 arr [ 10 ] ; 整数 * p1, * p2 ;

```
p1 = arr + 3 ; // p1 == & arr[ 3 ] 
p2 = p1 - 2 ; // p1 == & arr[ 1 ] 
```

# python - 在实例级别覆盖方法

> ID：394770
> 
> 赞同：101
> 
> 时间：2008-12-27T07:12:07.587
> 
> 标签：python

Python中有没有办法在实例级别覆盖类方法？例如：

```
class Dog:
    def bark(self):
        print "WOOF"

boby = Dog()
boby.bark() # WOOF
# METHOD OVERRIDE
boby.bark() # WoOoOoF!! 
```

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2008-12-27T07:35:02.673

是的，有可能：

```
class Dog:
    def bark(self):
        print "Woof"

def new_bark(self):
    print "Woof Woof"

foo = Dog()

funcType = type(Dog.bark)

# "Woof"
foo.bark()

# replace bark with new_bark for this object only
foo.bark = funcType(new_bark, foo, Dog)

foo.bark()
# "Woof Woof" 
```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2017-02-10T07:46:32.043

您需要使用模块中的[MethodType](https://docs.python.org/3/library/types.html#types.MethodType)`types`。的目的`MethodType`是覆盖实例级别的方法（以便`self`在覆盖的方法中可用）。

请参见下面的示例。

```
import types

class Dog:
    def bark(self):
        print "WOOF"

boby = Dog()
boby.bark() # WOOF

def _bark(self):
    print "WoOoOoF!!"

boby.bark = types.MethodType(_bark, boby)

boby.bark() # WoOoOoF!! 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2017-10-15T16:12:22.140

为了解释@codelogic 的出色答案，我提出了一种更明确的方法。这与`.`操作员在将类方法作为实例属性访问时彻底绑定的技术相同，只是您的方法实际上是在类之外定义的函数。

使用@codelogic 的代码，唯一的区别在于方法的绑定方式。我正在使用函数和方法是Python中的非数据[描述符](https://docs.python.org/3/howto/descriptor.html)`__get__`这一事实，并调用该方法。请特别注意，原始和替换都具有相同的签名，这意味着您可以将替换编写为完整的类方法，通过访问所有实例属性`self`。

```
类狗：
    定义树皮（自我）：
        打印“汪”

def new_bark(self):
    打印“汪汪”

foo = 狗（）

#“呜呜”
foo.bark()

# 仅针对该对象将树皮替换为 new_bark
foo.bark = new_bark.__get__(foo, Dog)

foo.bark()
#《汪汪汪》

```

通过将绑定方法分配给实例属性，您创建了一个几乎完整的重写方法的模拟。缺少的一个方便的功能是访问无参数版本的`super`，因为您不在类定义中。另一件事是，`__name__`您的绑定方法的属性不会像在类定义中那样采用它所覆盖的函数的名称，但您仍然可以手动设置它。第三个区别是您的手动绑定方法是一个简单的属性引用，它恰好是一个函数。操作员除了获取该`.`引用之外什么都不做。另一方面，当从实例调用常规方法时，绑定过程每次都会创建一个新的绑定方法。

顺便说一句，这样做的唯一原因是实例属性覆盖了*非数据*描述符。数据描述符有`__set__`方法，而方法（幸运的是你）没有。类中的数据描述符实际上优先于任何实例属性。这就是您可以分配给属性的原因：`__set__`当您尝试进行分配时，会调用它们的方法。我个人喜欢更进一步，将底层属性的实际值隐藏在实例的`__dict__`中，因为该属性遮蔽了它，所以无法通过正常方式访问它。

您还应该记住，这对于[魔术（双下划线）方法](https://docs.python.org/3/reference/datamodel.html#special-method-names)毫无意义。魔术方法当然可以通过这种方式被覆盖，但是使用它们的操作只看类型。例如，您可以`__contains__`在您的实例中设置一些特殊的东西，但调用`x in instance`会忽略它并使用它`type(instance).__contains__(instance, x)`。这适用于 Python[数据模型](https://docs.python.org/3/reference/datamodel.html)中指定的所有魔术方法。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-12-27T07:46:45.787

```
class Dog:
    def bark(self):
        print "WOOF"

boby = Dog()
boby.bark() # WOOF

# METHOD OVERRIDE
def new_bark():
    print "WoOoOoF!!"
boby.bark = new_bark

boby.bark() # WoOoOoF!! 
```

如果需要，您可以`boby`在函数内部使用变量。由于您只是为这个实例对象覆盖该方法，因此这种方法更简单，并且与 using 具有完全相同的效果`self`。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-12-27T13:44:45.563

请不要如图所示执行此操作。当您将实例修补为与类不同时，您的代码将变得不可读。

您无法调试猴子补丁代码。

当你在`boby`and中发现一个 bug 时`print type(boby)`，你会看到 (a) 它是一只狗，但是 (b) 由于某种不明原因它不能正确吠叫。这是一场噩梦。不要做。

请改为这样做。

```
class Dog:
    def bark(self):
        print "WOOF"

class BobyDog( Dog ):
    def bark( self ):
        print "WoOoOoF!!"

otherDog= Dog()
otherDog.bark() # WOOF

boby = BobyDog()
boby.bark() # WoOoOoF!! 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2019-02-13T04:47:21.713

由于这里没有人提及[`functools.partial`](https://docs.python.org/library/functools.html#functools.partial)：

```
from functools import partial

class Dog:
    name = "aaa"
    def bark(self):
        print("WOOF")

boby = Dog()
boby.bark() # WOOF

def _bark(self):
    print("WoOoOoF!!")

boby.bark = partial(_bark, boby)
boby.bark() # WoOoOoF!! 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-27T12:06:04.827

由于函数是 Python 中的第一类对象，因此您可以在初始化类对象时传递它们，或者随时为给定的类实例覆盖它：

```
class Dog:
    def __init__(self,  barkmethod=None):
        self.bark=self.barkp
        if barkmethod:
           self.bark=barkmethod
    def barkp(self):
        print "woof"

d=Dog()
print "calling original bark"
d.bark()

def barknew():
    print "wooOOOoof"

d1=Dog(barknew)
print "calling the new bark"
d1.bark()

def barknew1():
    print "nowoof"

d1.bark=barknew1
print "calling another new"
d1.bark() 
```

结果是

```
calling original bark
woof
calling the new bark
wooOOOoof
calling another new
nowoof 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-03-09T21:48:30.710

当您需要在新方法中调用旧方法时要小心：

```
import types

class Dog:
  def bark(self):
    print("WOOF")

boby = Dog()
boby.bark() # WOOF

def _bark(self):
  self.bark()
  print("WoOoOoF!!")

boby.bark = types.MethodType(_bark, boby)

boby.bark() # Process finished with exit code -1073741571 (0xC00000FD) [stack overflow]
# This also happens with the  '__get__' solution 
```

对于这些情况，您*可以*使用以下内容：

```
def _bark(self):
  Dog.bark(self)
  print( "WoOoOoF!!") # Calls without error 
```

但是如果库中的其他人已经覆盖了`foo`的`bark`方法怎么办？那就`Dog.bark(foo)`不一样了`foo.bark`！根据我的经验，适用于这两种情况的最简单的解决方案是

```
# Save the previous definition before overriding
old_bark = foo.bark
def _bark(self):
  old_bark()
  print("WoOoOoF!!")
foo.bark = _bark
# Works for instance-overridden methods, too 
```

大多数时候，子类化和使用`super`是处理这种情况的正确方法。然而，有时这种猴子补丁是必要的，并且会因堆栈溢出错误而失败，除非您更加小心。

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2008-12-27T14:10:24.420

虽然我喜欢 S. Lott 的继承思想并同意 'type(a)' 的东西，但由于函数也具有可访问的属性，我认为可以这样管理它：

```
class Dog:
    def __init__(self, barkmethod=None):
        self.bark=self.barkp
        if barkmethod:
           self.bark=barkmethod
    def barkp(self):
        """original bark"""
        print "woof"

d=Dog()
print "calling original bark"
d.bark()
print "that was %s\n" % d.bark.__doc__

def barknew():
    """a new type of bark"""
    print "wooOOOoof"

d1=Dog(barknew)
print "calling the new bark"
d1.bark()
print "that was %s\n" % d1.bark.__doc__

def barknew1():
    """another type of new bark"""
    print "nowoof"

d1.bark=barknew1
print "another new"
d1.bark()
print "that was %s\n" % d1.bark.__doc__ 
```

输出是：

```
calling original bark
woof
that was original bark

calling the new bark
wooOOOoof
that was a new type of bark

another new
nowoof
that was another type of new bark 
```

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2013-06-07T06:30:39.907

亲爱的，这不是压倒一切的，您只是用该对象两次调用相同的函数。基本上覆盖与不止一个类有关。当不同的类中存在相同的签名方法时，您正在调用哪个函数决定调用它的对象。当你让多个类编写相同的函数并且还有一件事要共享时，在 python 中重写是可能的，在 python 中不允许重载

* * *

## 回答 #11

> 赞同：-4
> 
> 时间：2017-03-01T10:30:35.687

我发现这是对原始问题的最准确答案

[https://stackoverflow.com/a/10829381/7640677](https://stackoverflow.com/a/10829381/7640677)

```
import a

def _new_print_message(message):
    print "NEW:", message

a.print_message = _new_print_message

import b
b.execute() 
```

# sql - 在单个查询中从他们的 ID 获取相关数据的最佳方法是什么？

> ID：394771
> 
> 赞同：4
> 
> 时间：2008-12-27T07:15:34.960
> 
> 标签：sql, mysql, join, relational

我有一个表，其中每一行都有一些字段，这些字段的 ID 与其他表中的一些其他数据相关。

假设它被称为`people`，每个人的 ID 为a`city`和。`state``country`

所以会有另外三个表，，`cities`每个表都有一个 ID 和一个名称。`states``countries`

当我选择一个人时，在单个查询中获取,和的**名称**的最简单方法是什么？`city``state``country`

**注意：**我知道这可以通过连接实现，但是由于有更多相关表，嵌套连接使查询难以阅读，我想知道是否有更简洁的方法。该人也应该可以将这些字段留空。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T07:20:23.733

JOINS 是真正做到这一点的唯一方法。

您也许可以更改您的架构，但无论如何问题都是一样的。

（一个城市总是在一个州，它总是在一个国家 - 所以这个人可以只引用 city_id 而不是全部三个。你仍然需要加入 3 个表）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T19:16:13.290

假设下表：

```
create table People
(
     ID        int          not null primary key auto_increment
    ,FullName  varchar(255) not null
    ,StateID   int 
    ,CountryID int 
    ,CityID    int 
)
;
create table States
(
     ID   int          not null primary key auto_increment
    ,Name varchar(255) not null
)
;
create table Countries
(
     ID   int          not null primary key auto_increment
    ,Name varchar(255) not null
)
;
create table Cities
(
     ID   int          not null primary key auto_increment
    ,Name varchar(255) not null
)
; 
```

使用以下数据：

```
insert into Cities(Name) values ('City 1'),('City 2'),('City 3');
insert into States(Name) values ('State 1'),('State 2'),('State 3');
insert into Countries(Name) values ('Country 1'),('Country 2'),('Country 3');
insert into People(FullName,CityID,StateID,CountryID) values ('Has Nothing'   ,null,null,null);
insert into People(FullName,CityID,StateID,CountryID) values ('Has City'      ,   1,null,null);
insert into People(FullName,CityID,StateID,CountryID) values ('Has State'     ,null,   2,null);
insert into People(FullName,CityID,StateID,CountryID) values ('Has Country'   ,null,null,   3);
insert into People(FullName,CityID,StateID,CountryID) values ('Has Everything',   3,   2,   1); 
```

那么这个查询应该给你你所追求的。

```
select 
 P.ID
,P.FullName
,Ci.Name as CityName
,St.Name as StateName
,Co.Name as CountryName
from People P
left Join Cities    Ci on Ci.ID = P.CityID
left Join States    St on St.ID = P.StateID
left Join Countries Co on Co.ID = P.CountryID 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T09:34:40.670

没有比加入更清洁的方法了。如果允许字段为空，请使用外连接

```
SELECT c.*, s.name AS state_name
  FROM customer c
  LEFT OUTER JOIN state s ON s.id = c.state
 WHERE c.id = 10 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T19:15:31.760

根据您提供的模式描述，您将不得不在单个查询中使用 JOINS。

```
SELECT 
   p.first_name 
 , p.last_name
 , c.name as city
 , s.name as state
 , co.name as country 
FROM people p 
LEFT OUTER JOIN city c 
  ON p.city_id = c.id
LEFT OUTER JOIN state s 
  ON p.state_id = s.id
LEFT OUTER JOIN country co
  ON p.country_id = co.id; 
```

LEFT OUTER JOIN 将允许您获取人员的详细信息，即使某些 ID 为空白或为空。

另一种方法是重新设计查找表。一个城市永远在一个州，一个州在一个国家。因此，您的`city`表将包含 :`Id, Name`和`state_id`. 您的`state`表将是 :`Id, Name`和`country_id`。并且`country`表将保持不变：`Id`和`Name`。

该`person`表现在将只有 1 个 id ：`city_id`

现在您的查询将是：

```
 SELECT 
   p.first_name 
 , p.last_name
 , c.name as city
 , s.name as state
 , co.name as country 
FROM people p 
LEFT OUTER JOIN city c 
  ON p.city_id = c.id
LEFT OUTER JOIN state s 
  ON c.state_id = s.id
LEFT OUTER JOIN country co
  ON s.country_id = co.id; 
```

注意最后两个 OUTER JOINS 的区别

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T07:43:23.453

如果涉及的表是引用表（即它们保存在会话的生命周期内不会更改的查找数据），则根据应用程序的性质，您可以在应用程序启动期间预加载引用数据. 然后，您的查询不需要进行连接，而是返回 id 值，并且在您的应用程序中，当您需要显示数据时，您可以对 id 进行解码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-27T08:57:11.307

最简单的解决方案是使用名称作为 、 和 中的`city`主`state`键`country`。然后您的`person`表可以通过名称而不是伪键“ `id`”来引用它们。这样，您就不需要进行连接，因为您的`person`表已经具有所需的值。

存储字符串而不是 4 字节的伪密钥确实需要更多空间。但是你可能会发现这种权衡是值得的，如果你受到连接的威胁，就像你看起来一样（顺便说一下，这就像一个 PHP 程序员不愿意使用`foreach`- 连接以同样的方式是 SQL 的基础）。

还有许多城市名称出现在不止一个州。因此，您的`city`表应该引用该`state`表并将这两列用作主键。

```
CREATE TABLE cities (
  city_name VARCHAR(30),
  state     CHAR(2),
  PRIMARY KEY (city_name, state),
  FOREIGN KEY (state) REFERENCES states(state)
);

CREATE TABLE persons (
  person_id    SERIAL PRIMARY KEY,
  ...other columns...
  city_name    VARCHAR(30),
  state        CHAR(2),
  country_name VARCHAR(30),
  FOREIGN KEY (city_name, state) REFERENCES cities(city_name, state),
  FOREIGN KEY (country_name) REFERENCES countries(country_name)
); 
```

这只是该技术的一个例子。当然它比这更复杂，因为您可能在多个国家/地区拥有城市名称，您可能拥有没有州的国家，等等。关键是 SQL 不会强制您使用整数伪键，因此请在适当的情况下使用 CHAR 和 VARCHAR 键。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-27T10:30:53.177

标准 SQL 的一个缺点是返回数据需要采用表格格式。但是，一些数据库供应商添加了一些功能，可以选择非表格格式的数据。我不知道 MySQL 是否知道这些特性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-29T19:26:32.347

所有很好的答案，但提问者指定他们不想使用连接。正如一位受访者所展示的那样，假设您的`Cities`、`States`和`Countries`表有一个`Id`和 一个`Description`字段，您可能可以执行以下操作：

```
SELECT
   p.Name, c.Description, s.Description, ct.Description
FROM
   People p, Cities c, States s, Countries ct
WHERE
   p.Id = value AND
   c.Id = value AND
   s.Id = value AND
   ct.Id = value; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-29T20:14:59.347

创建一个为您连接 Person、City、State 和 Country 的视图。然后只需在所有其他连接中引用视图。

就像是：

```
CREATE VIEW FullPerson AS  
SELECT Person.*, City.Name, State.Name, Country.Name  
FROM  
  Person LEFT OUTER JOIN City ON Person.CityId = City.Id  
  LEFT OUTER JOIN State ON Person.StateId = State.Id  
  LEFT OUTER JOIN Country ON Person.CountryId = Country.Id 
```

然后在其他查询中，您可以

```
SELECT FullPerson.*, Other.Value  
FROM FullPerson LEFT OUTER JOIN Other ON FullPerson.OtherId = Other.Id 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-12-27T07:39:38.983

连接就是*答案*。通过练习，它们对您来说将变得更具可读性。
在某些特殊情况下，创建函数会对您有所帮助，例如您可以执行以下操作（在 Oracle 中，我不知道任何 mysql）：
您可以创建一个函数来返回给定城市州和国家/地区代码的格式化地址，那么您的查询变为

```
SELECT first_name, last_name, formated_address(city_id, state_id, country_id) 
FROM people
WHERE some_where_clause; 
```

在`formated_address`城市州和国家/地区表上进行个人查找并在解码值之间放置分隔符，或者如果它们都是空的，则返回“无地址”等

# c# - Windows Mobile 中的数据策略

> ID：394799
> 
> 赞同：1
> 
> 时间：2008-12-27T08:01:07.863
> 
> 标签：c#, .net, windows-mobile, xml-serialization, sql-server-ce

我正在 Windows Mobile 上开发 C# 应用程序，并且像我的大多数 WM 应用程序一样，每当我决定序列化策略时，我总是陷入困境。在桌面世界中，我并不太担心它，因为我已经开发了一个非常强大的自定义 xml 序列化程序 - 但是，在 WM 世界中，我不想使用它，因为反射性能会受到影响。

所以我针对数据访问对象 (DAO) 接口开发所有东西，因此我可以轻松换出不同的实现来序列化为 xml、注册表、sqlce 等。在开始开发时，我通常实现一个非持久内存 DAO (使用 Dictionary<>)，当我想要持久化数据时使用 XmlSerializer DAO，然后当一切完成后，转移到成熟的 sqlce DAO。

但是，在我最新的应用程序中，我不能使用 XmlSerializer DAO，因为它（不）处理接口属性的能力非常差。IE，我有一个 Foo 对象，它包含一个 List< IBar > Bars 属性，XmlSerializer 无法序列化它（尽管我很容易能够开发自己的自定义 xml 序列化器，它可以 - 去图）。

所有这些都是为了问这个问题：您找到了哪些 DAO 策略来帮助您开发 WM 应用程序？你是否为不同应用成熟度级别的多个不同 DAO 提前计划？你是从成熟的 sqlce DAO 开始的吗？当无法使用 XmlSerializer 时，您会推荐什么用于快速简便的持久序列化 DAO？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T15:59:04.437

好吧，它不一定适用于您的情况（因为它需要`XmlSerializer`具体类型），但[protobuf-net](http://code.google.com/p/protobuf-net/)是一个二进制序列化引擎，适用于所有 .NET 变体，包括 CF 2.0 和 CF 3.5；这将允许您存储数据，并与您的全脂 3.5 服务器（或者，实际上，与 java、perl、php[等](http://code.google.com/p/protobuf/wiki/OtherLanguages)）交换数据。

它肯定是快速和简单的，所以如果你想要 WM 中的可移植数据，绝对值得一看。

# python - Python有三元条件运算符吗？

> ID：394809
> 
> 赞同：7182
> 
> 时间：2008-12-27T08:32:18.533
> 
> 标签：python, operators, conditional-operator

如果 Python 没有[三元条件运算符](https://en.wikipedia.org/wiki/%3F:#Python)，是否可以使用其他语言结构来模拟一个？

* * *

## 回答 #1

> 赞同：8301
> 
> 时间：2008-12-27T08:44:19.883

是的，它是在 2.5 版中[添加的。](https://mail.python.org/pipermail/python-dev/2005-September/056846.html "[Python-Dev] 条件表达式解析")表达式语法为：

```
a if condition else b 
```

首先`condition`进行评估，然后根据 的[布尔](https://en.wikipedia.org/wiki/Boolean_data_type "布尔数据类型")值评估和返回其中一个`a`或中的一个。如果计算结果为， then被计算并返回但被忽略，否则 when被计算并返回但被忽略。`b``condition``condition``True``a``b``b``a`

这允许短路，因为`condition`仅评估 when is true`a`并且`b`根本不评估，但`condition`仅评估 when is false`b`并且`a`根本不评估。

例如：

```
>>> 'true' if True else 'false'
'true'
>>> 'true' if False else 'false'
'false' 
```

请注意，条件是一个*表达式*，而不是一个*语句*。这意味着您不能在条件**表达式**`pass`中使用赋值语句或其他**语句**：

 **```
>>> pass if False else x = 3
  File "<stdin>", line 1
    pass if False else x = 3
          ^
SyntaxError: invalid syntax 
```

但是，您可以使用条件表达式来分配变量，如下所示：

```
x = a if True else b 
```

将条件表达式视为在两个值之间切换。当您处于“一个值或另一个值”的情况时，它非常有用，但它并没有做太多其他事情。

如果需要使用语句，则必须使用普通`if` **语句**而不是条件**表达式**。

* * *

请记住，一些 Pythonistas 不赞成它，原因如下：

*   参数的顺序与`condition ? a : b`许多其他语言（如[C](https://en.wikipedia.org/wiki/C_%28programming_language%29)、[C++](https://en.wikipedia.org/wiki/C%2B%2B)、[Go](https://en.wikipedia.org/wiki/Go_%28programming_language%29)、[Perl](https://en.wikipedia.org/wiki/Perl)、[Ruby](https://en.wikipedia.org/wiki/Ruby_%28programming_language%29)、[Java](https://en.wikipedia.org/wiki/Java_%28programming_language%29)、[JavaScript](https://en.wikipedia.org/wiki/JavaScript)等）的经典三元运算符的顺序不同，这可能会在不熟悉 Python 的人时导致 bug。令人惊讶的”行为使用它（他们可能会颠倒参数顺序）。
*   有些人觉得它“笨拙”，因为它与正常的思维流程背道而驰（先考虑情况，然后考虑效果）。
*   风格原因。（虽然 'inline `if`'*真的*很有用，让你的脚本更简洁，但它确实让你的代码复杂化了）

如果您无法记住顺序，请记住，当您大声朗读时，您（几乎）说出了您的意思。例如，`x = 4 if b > 8 else 9`朗读为`x will be 4 if b is greater than 8 otherwise 9`.

官方文档：

*   [条件表达式](https://docs.python.org/3/reference/expressions.html#conditional-expressions "条件表达式")
*   [是否有等效于 C 的“？：”三元运算符？](https://docs.python.org/3/faq/programming.html#is-there-an-equivalent-of-c-s-ternary-operator "是否有等效于 C 的“？：”三元运算符？")

* * *

## 回答 #2

> 赞同：928
> 
> 时间：2009-01-22T18:58:09.553

您可以索引到一个元组：

```
(falseValue, trueValue)[test] 
```

`test`需要返回*True*或*False*。
始终将其实现为：

```
(falseValue, trueValue)[test == True] 
```

或者您可以使用内置[`bool()`](https://docs.python.org/3.3/library/functions.html#bool "布尔")来确保[布尔](https://en.wikipedia.org/wiki/Boolean_data_type "布尔数据类型")值：

```
(falseValue, trueValue)[bool(<expression>)] 
```

* * *

## 回答 #3

> 赞同：398
> 
> 时间：2008-12-27T10:48:27.137

对于 2.5 之前的版本，有诀窍：

```
[expression] and [on_true] or [on_false] 
```

`on_true`当布尔值错误时，它可能会给出错误的结果。¹

尽管它确实具有从左到右评估表达式的好处，但我认为这更清楚。

[1.[有没有相当于 C 的“?:”三元运算符？](http://docs.python.org/3.3/faq/programming.html#is-there-an-equivalent-of-c-s-ternary-operator)]

* * *

## 回答 #4

> 赞同：322
> 
> 时间：2010-05-27T07:56:06.373

`*<expression 1>* **if** *<condition>* **else** *<expression 2>*`

```
a = 1
b = 2

1 if a > b else -1 
# Output is -1

1 if a > b else -1 if a < b else 0
# Output is -1 
```

* * *

## 回答 #5

> 赞同：187
> 
> 时间：2008-12-27T08:44:23.143

从[文档中](https://docs.python.org/3/reference/expressions.html#conditional-expressions "条件表达式")：

> 条件表达式（有时称为“三元运算符”）在所有 Python 操作中具有最低优先级。
> 
> 该表达式`x if C else y`首先评估条件*C* (*不是 x* )；如果*C*为真，则计算*x*并返回其值；否则，评估*y*并返回其值。
> 
> 有关条件表达式的更多详细信息，请参阅[PEP 308](https://www.python.org/dev/peps/pep-0308/ "PEP 308 -- 条件表达式")。

自 2.5 版以来的新功能。

* * *

## 回答 #6

> 赞同：151
> 
> 时间：2015-05-05T12:00:09.190

作为[Python 增强提案 308](https://www.python.org/dev/peps/pep-0308/)的一部分，2006 年添加了 Python 中条件表达式的运算符。它的形式不同于普通`?:`运算符，它是：

```
<expression1> if <condition> else <expression2> 
```

这相当于：

```
if <condition>: <expression1> else: <expression2> 
```

这是一个例子：

```
result = x if a > b else y 
```

可以使用的另一种语法（与 2.5 之前的版本兼容）：

```
result = (lambda:y, lambda:x)[a > b]() 
```

其中操作数是[惰性求值](https://en.wikipedia.org/wiki/Lazy_evaluation)的。

另一种方法是索引一个元组（这与大多数其他语言的条件运算符不一致）：

```
result = (y, x)[a > b] 
```

或显式构造的字典：

```
result = {True: x, False: y}[a > b] 
```

另一种（不太可靠）但更简单的方法是使用`and`和`or`运算符：

```
result = (a > b) and x or y 
```

`x`但是，如果可以，这将行不通`False`。

一种可能的解决方法是制作`x`和`y`列表或元组，如下所示：

```
result = ((a > b) and [x] or [y])[0] 
```

或者：

```
result = ((a > b) and (x,) or (y,))[0] 
```

如果您正在使用字典，而不是使用三元条件，您可以利用[`get(key, default)`](https://docs.python.org/3/library/stdtypes.html#dict.get)，例如：

```
shell = os.environ.get('SHELL', "/bin/sh") 
```

^(资料来源：[？：在 Python 中在 Wikipedia](https://en.wikipedia.org/wiki/%3F:#Python))

* * *

## 回答 #7

> 赞同：112
> 
> 时间：2009-12-06T11:51:50.273

不幸的是，

```
(falseValue, trueValue)[test] 
```

解决方案没有短路行为；因此无论条件如何，都会对`falseValue`和`trueValue`进行评估。这可能不是最理想的甚至是错误的（即两者都`trueValue`可能`falseValue`是方法并具有副作用）。

一种解决方案是

```
(lambda: falseValue, lambda: trueValue)[test]() 
```

（直到知道获胜者后才执行；）），但它引入了可调用对象和不可调用对象之间的不一致。此外，它并不能解决使用属性时的情况。

所以故事是这样的 - 在三个提到的解决方案之间进行选择是在具有短路功能、至少使用 Python 2.5（恕我直言，不再是问题）和不容易出现“ `trueValue`-evaluates-to-false”之间进行权衡错误。

* * *

## 回答 #8

> 赞同：89
> 
> 时间：2016-08-21T17:56:26.180

## **不同编程语言的三元运算符**

在这里，我只是试图展示几种编程语言之间[三元运算符的一些重要区别。](https://en.wikipedia.org/wiki/%3F:)

### *[JavaScript](https://en.wikipedia.org/wiki/JavaScript)中的三元运算符*

```
var a = true ? 1 : 0;
# 1
var b = false ? 1 : 0;
# 0 
```

### *[Ruby](https://en.wikipedia.org/wiki/Ruby_%28programming_language%29)中的三元运算符*

```
a = true ? 1 : 0
# 1
b = false ? 1 : 0
# 0 
```

### *[Scala](https://en.wikipedia.org/wiki/Scala_%28programming_language%29)中的三元运算符*

```
val a = true ? 1 | 0
# 1
val b = false ? 1 | 0
# 0 
```

### *[R](https://en.wikipedia.org/wiki/R_%28programming_language%29)编程中的三元运算符*

```
a <- if (TRUE) 1 else 0
# 1
b <- if (FALSE) 1 else 0
# 0 
```

### *Python中的三元运算符*

```
a = 1 if True else 0
# 1
b = 1 if False else 0
# 0 
```

* * *

## 回答 #9

> 赞同：75
> 
> 时间：2012-04-25T11:40:11.447

对于 Python 2.5 和更新版本，有一个特定的语法：

```
[on_true] if [cond] else [on_false] 
```

在较旧的 Python 中，没有实现三元运算符，但可以模拟它。

```
cond and on_true or on_false 
```

但是，有一个潜在的问题，如果`cond`评估为`True`和`on_true`评估为`False`then`on_false`返回而不是`on_true`. 如果你想要这种行为，方法是好的，否则使用这个：

```
{True: on_true, False: on_false}[cond is True] # is True, not == True 
```

可以通过以下方式包装：

```
def q(cond, on_true, on_false)
    return {True: on_true, False: on_false}[cond is True] 
```

并以这种方式使用：

```
q(cond, on_true, on_false) 
```

它与所有 Python 版本兼容。

* * *

## 回答 #10

> 赞同：52
> 
> 时间：2013-01-14T15:56:09.080

你可能经常会发现

```
cond and on_true or on_false 
```

但这会在 on_true == 0 时导致问题

```
>>> x = 0
>>> print x == 0 and 0 or 1
1
>>> x = 1
>>> print x == 0 and 0 or 1
1 
```

对于普通的三元运算符，您会期望这个结果：

```
>>> x = 0
>>> print 0 if x == 0 else 1
0
>>> x = 1
>>> print 0 if x == 0 else 1
1 
```

* * *

## 回答 #11

> 赞同：47
> 
> 时间：2015-11-17T19:14:33.980

> # Python有三元条件运算符吗？

是的。从[语法文件](https://docs.python.org/reference/grammar.html)：

```
test: or_test ['if' or_test 'else' test] | lambdef 
```

感兴趣的部分是：

```
or_test ['if' or_test 'else' test] 
```

因此，三元条件运算的形式为：

```
expression1 if expression2 else expression3 
```

`expression3`将被延迟评估（即，仅当`expression2`在布尔上下文中为 false 时才评估）。而且由于递归定义，您可以无限期地链接它们（尽管它可能被认为是不好的样式。）

```
expression1 if expression2 else expression3 if expression4 else expression5 # and so on 
```

### 使用说明：

请注意，每个都`if`必须跟一个`else`. 学习列表推导和生成器表达式的人可能会发现这是一堂很难学习的课——以下内容将不起作用，因为 Python 期望 else 有第三个表达式：

```
[expression1 if expression2 for element in iterable]
#                          ^-- need an else here 
```

这引发了一个`SyntaxError: invalid syntax`. 所以上面要么是一个不完整的逻辑（也许用户期望在错误条件下没有操作）或者可能打算使用 expression2 作为过滤器 - 请注意以下是合法的 Python：

```
[expression1 for element in iterable if expression2] 
```

`expression2`用作列表理解的过滤器，而*不是*三元条件运算符。

### 更窄情况的替代语法：

您可能会发现编写以下内容有些痛苦：

```
expression1 if expression1 else expression2 
```

`expression1`必须使用上述用法进行两次评估。如果它只是一个局部变量，它可以限制冗余。但是，此用例的一个常见且高性能的 Pythonic 习惯用法是使用`or`的快捷方式行为：

```
expression1 or expression2 
```

这在语义上是等价的。请注意，一些样式指南可能会出于清晰的原因限制这种用法 - 它确实在非常少的语法中包含了很多含义。

* * *

## 回答 #12

> 赞同：30
> 
> 时间：2019-10-16T08:37:26.157

正如已经回答的那样，是的，Python 中有一个三元运算符：

```
<expression 1> if <condition> else <expression 2> 
```

在许多情况下`<expression 1>`也用作布尔评估`<condition>`。然后你可以使用[短路评估](https://en.wikipedia.org/wiki/Short-circuit_evaluation)。

```
a = 0
b = 1

# Instead of this:
x = a if a else b
# Evaluates as 'a if bool(a) else b'

# You could use short-circuit evaluation:
x = a or b 
```

短路评估的一大优点是可以链接两个以上的表达式：

```
x = a or b or c or d or e 
```

在使用函数时，它的细节更加不同：

```
# Evaluating functions:
def foo(x):
    print('foo executed')
    return x

def bar(y):
    print('bar executed')
    return y

def blubb(z):
    print('blubb executed')
    return z

# Ternary Operator expression 1 equals to False
print(foo(0) if foo(0) else bar(1))
''' foo and bar are executed once
foo executed
bar executed
1
'''

# Ternary Operator expression 1 equals to True
print(foo(2) if foo(2) else bar(3))
''' foo is executed twice!
foo executed
foo executed
2
'''

# Short-circuit evaluation second equals to True
print(foo(0) or bar(1) or blubb(2))
''' blubb is not executed
foo executed
bar executed
1
'''

# Short-circuit evaluation third equals to True
print(foo(0) or bar(0) or blubb(2))
'''
foo executed
bar executed
blubb executed
2
'''

# Short-circuit evaluation all equal to False
print(foo(0) or bar(0) or blubb(0))
''' Result is 0 (from blubb(0)) because no value equals to True
foo executed
bar executed
blubb executed
0
''' 
```

PS：当然，短路评估不是三元运算符，但通常在短路就足够的情况下使用三元。它具有更好的可读性，并且可以链接。

* * *

## 回答 #13

> 赞同：29
> 
> 时间：2013-11-20T10:44:12.760

模拟 Python 三元运算符。

例如

```
a, b, x, y = 1, 2, 'a greather than b', 'b greater than a'
result = (lambda:y, lambda:x)[a > b]() 
```

输出：

```
'b greater than a' 
```

* * *

## 回答 #14

> 赞同：29
> 
> 时间：2019-02-09T18:23:18.590

[Python 的条件表达式](https://mail.python.org/pipermail/python-dev/2005-September/056846.html)的替代方案之一

```
"yes" if boolean else "no" 
```

如下：

```
{True:"yes", False:"no"}[boolean] 
```

它具有以下不错的扩展名：

```
{True:"yes", False:"no", None:"maybe"}[boolean_or_none] 
```

最短的选择仍然是：

```
("no", "yes")[boolean] 
```

但别无选择

```
yes() if boolean else no() 
```

如果你想避免评估`yes()` *and* `no()`，因为在

```
(no(), yes())[boolean]  # bad 
```

`no()`和都`yes()`被评估。

* * *

## 回答 #15

> 赞同：27
> 
> 时间：2018-12-06T14:45:27.230

```
a if condition else b 
```

如果您难以记住，只需记住这个金字塔：

```
 condition
  if           else
a                   b 
```

* * *

## 回答 #16

> 赞同：26
> 
> 时间：2018-04-04T14:02:17.727

三元条件运算符仅允许在单行中测试条件，替换多行 if-else，从而使代码紧凑。

### 句法：

> [on_true] 如果 [表达式] 否则 [on_false]

### 1- 使用三元运算符的简单方法：

```
# Program to demonstrate conditional operator
a, b = 10, 20
# Copy value of a in min if a < b else copy b
min = a if a < b else b
print(min)  # Output: 10 
```

### 2- 使用元组、字典和 lambda 的直接方法：

```
# Python program to demonstrate ternary operator
a, b = 10, 20
# Use tuple for selecting an item
print( (b, a) [a < b] )
# Use Dictionary for selecting an item
print({True: a, False: b} [a < b])
# lambda is more efficient than above two methods
# because in lambda  we are assure that
# only one expression will be evaluated unlike in
# tuple and Dictionary
print((lambda: b, lambda: a)[a < b]()) # in output you should see three 10 
```

### 3- 三元运算符可以写成嵌套的 if-else：

```
# Python program to demonstrate nested ternary operator
a, b = 10, 20
print ("Both a and b are equal" if a == b else "a is greater than b"
        if a > b else "b is greater than a") 
```

上述方法可以写成：

```
# Python program to demonstrate nested ternary operator
a, b = 10, 20
if a != b:
    if a > b:
        print("a is greater than b")
    else:
        print("b is greater than a")
else:
    print("Both a and b are equal")
# Output: b is greater than a 
```

* * *

## 回答 #17

> 赞同：24
> 
> 时间：2017-08-20T07:31:02.467

你可以这样做：

```
[condition] and [expression_1] or [expression_2]; 
```

例子：

```
print(number%2 and "odd" or "even") 
```

如果数字是奇数，这将打印“奇数”，如果数字是偶数，则打印“偶数”。

* * *

**结果：**如果条件为真，则执行exp_1，否则执行exp_2。

**注意：** 0、None、False、emptylist 和 emptyString 的计算结果为 False。

并且除 0 以外的任何数据都评估为 True。

## 以下是它的工作原理：

如果条件 [condition] 变为“True”，则表达式_1 将被计算，而不是表达式_2。

如果我们用 0（零）“和”某物，结果将始终为假。所以在下面的声明中，

```
0 and exp 
```

表达式*exp*根本不会被计算，因为带有 0 的 "and" 总是会计算为零并且不需要计算表达式。这就是编译器本身在所有语言中的工作方式。

在

```
1 or exp 
```

表达式*exp*根本不会被计算，因为带有 1 的“或”总是 1。所以它不会费心计算表达式 exp，因为结果无论如何都会是 1（编译器优化方法）。

但万一

```
True and exp1 or exp2 
```

第二个表达式 exp2 不会被计算，因为`True and exp1`当 exp1 不为假时，它会为真。

同样在

```
False and exp1 or exp2 
```

表达式*exp1*不会被计算，因为 False 相当于写 0 并且用 0 做“与”本身就是 0，但是在 exp1 之后，因为使用了“或”，它会在“或”之后计算表达式 exp2。

* * *

**注意：-**这种使用“or”和“and”的分支只能在 expression_1 的真值不为 False（或 0 或 None 或 emptylist [ ] 或 emptystring ' '）时使用，因为如果 expression_1 变为False，则由于 exp_1 和 exp_2 之间存在“或”，将计算 expression_2。

**如果您仍然想让它适用于所有情况，而不管 exp_1 和 exp_2 真值是什么，请执行以下操作：**

```
[condition] and ([expression_1] or 1) or [expression_2]; 
```

* * *

## 回答 #18

> 赞同：24
> 
> 时间：2020-12-23T10:01:59.897

[Vinko Vrsalovic 的回答](https://stackoverflow.com/questions/394809/does-python-have-a-ternary-conditional-operator/394814#394814)已经足够好了。只有一件事：

> 请注意，条件是一个*表达式*，而不是一个*语句*。这意味着您不能在条件**表达式**`pass`中使用赋值语句或其他**语句**

 **### Python 3.8 中的海象运算符

在Python 3.8 中引入[海象运算符后，情况发生了变化。](https://docs.python.org/3/whatsnew/3.8.html#assignment-expressions)

```
(a := 3) if True else (b := 5) 
```

给出`a = 3`和`b is not defined`,

```
(a := 3) if False else (b := 5) 
```

给出`a is not defined`和`b = 5`, 和

```
c = (a := 3) if False else (b := 5) 
```

给出`c = 5`,`a is not defined`和`b = 5`.

即使这可能很难看，在 Python 3.8 之后的条件表达式**中**也可以进行**赋值。**无论如何，在这种情况下，最好还是使用普通**语句。****`if`**

 ***** * *

## 回答 #19

> 赞同：23
> 
> 时间：2016-05-11T07:13:31.007

更多的是一个提示而不是一个答案（我不需要第一百次重复显而易见的事情），但我有时将它用作此类构造中的单行快捷方式：

```
if conditionX:
    print('yes')
else:
    print('nah') 
```

，变为：

```
print('yes') if conditionX else print('nah') 
```

一些（很多 :) 可能会认为它是非 Python 的（甚至是 Ruby 风格的 :)，但我个人觉得它更自然 - 即，你如何正常表达它，加上在大块代码中更具视觉吸引力。

* * *

## 回答 #20

> 赞同：14
> 
> 时间：2018-12-25T13:04:23.357

[许多从C](https://en.wikipedia.org/wiki/C_%28programming_language%29)派生的编程语言通常具有以下三元条件运算符的语法：

```
<condition> ? <expression1> : <expression2> 
```

起初，Python 的[仁慈独裁者](https://en.wikipedia.org/wiki/Benevolent_dictator_for_life)（当然，我是指[Guido van Rossum](https://en.wikipedia.org/wiki/Guido_van_Rossum)）拒绝了它（作为非 Pythonic 风格），因为对于不习惯 C 语言的人来说，它很难理解。此外，冒号**`:`**在 Python 中已经有很多用途。在**PEP 308**获得批准后，Python 终于收到了自己的快捷条件表达式（我们现在使用的）：

```
<expression1> if <condition> else <expression2> 
```

因此，首先它评估条件。如果返回`True`，则计算**表达式**1 以给出结果，否则计算**表达式**2。由于[惰性求值](https://en.wikipedia.org/wiki/Lazy_evaluation)机制——只会执行一个表达式。

以下是一些示例（条件将从左到右评估）：

```
pressure = 10
print('High' if pressure < 20 else 'Critical')

# Result is 'High' 
```

三元运算符可以串联起来：

```
pressure = 5
print('Normal' if pressure < 10 else 'High' if pressure < 20 else 'Critical')

# Result is 'Normal' 
```

下一个与上一个相同：

```
pressure = 5

if pressure < 20:
    if pressure < 10:
        print('Normal')
    else:
        print('High')
else:
    print('Critical')

# Result is 'Normal' 
```

* * *

## 回答 #21

> 赞同：12
> 
> 时间：2018-10-21T20:14:53.217

*是*的，Python 有一个三元运算符，这里是语法和示例代码来演示相同的:)

```
#[On true] if [expression] else[On false]
# if the expression evaluates to true then it will pass On true otherwise On false

a = input("Enter the First Number ")
b = input("Enter the Second Number ")

print("A is Bigger") if a>b else print("B is Bigger") 
```

* * *

## 回答 #22

> 赞同：10
> 
> 时间：2020-05-19T16:47:24.857

其他答案正确地谈论了 Python 三元运算符。我想通过提及一个经常使用三元运算符但有更好的习惯用法的场景来作为补充。这是使用默认值的场景。

假设我们要使用`option_value`默认值（如果未设置）：

```
run_algorithm(option_value if option_value is not None else 10) 
```

或者，如果`option_value`从未设置为虚假值（`0`,`""`等），只需

```
run_algorithm(option_value if option_value else 10) 
```

但是，在这种情况下，更好的解决方案就是简单地编写

```
run_algorithm(option_value or 10) 
```

* * *

## 回答 #23

> 赞同：8
> 
> 时间：2020-03-11T06:49:39.947

Python 有一种三元形式的赋值；但是，人们应该注意的甚至可能还有更短的形式。

需要根据条件为变量分配一个值或另一个值是很常见的。

```
>>> li1 = None
>>> li2 = [1, 2, 3]
>>>
>>> if li1:
...     a = li1
... else:
...     a = li2
...
>>> a
[1, 2, 3] 
```

^ 这是完成此类作业的长格式。

下面是三元形式。但这不是最简洁的方式 - 参见最后一个示例。

```
>>> a = li1 if li1 else li2
>>>
>>> a
[1, 2, 3]
>>> 
```

使用 Python，您可以简单地`or`用于替代分配。

```
>>> a = li1 or li2
>>>
>>> a
[1, 2, 3]
>>> 
```

上面的工作是因为`li1`is`None`并且解释器在逻辑表达式中将其视为 False 。然后解释器继续并评估第二个表达式，它不是`None`而且它不是一个空列表 - 所以它被分配给*一个*.

这也适用于空列表。例如，如果您想分配`a`具有项目的列表。

```
>>> li1 = []
>>> li2 = [1, 2, 3]
>>>
>>> a = li1 or li2
>>>
>>> a
[1, 2, 3]
>>> 
```

知道了这一点，您可以在遇到它们时简单地进行此类分配。这也适用于字符串和其他可迭代对象。您可以分配`a`任何不为空的字符串。

```
>>> s1 = ''
>>> s2 = 'hello world'
>>>
>>> a = s1 or s2
>>>
>>> a
'hello world'
>>> 
```

我一直很喜欢 C 三元语法，但 Python 更进一步！

我知道有些人可能会说这不是一个好的风格选择，因为它依赖于并非所有开发人员都能立即了解的机制。我个人不同意这种观点。Python 是一种语法丰富的语言，具有许多惯用技巧，这些技巧对于涉猎者来说并不明显。但是你越了解和了解底层系统的机制，你就越欣赏它。

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2021-12-29T18:53:01.790

Pythonic的做事方式：

```
"true" if var else "false" 
```

但是也总是存在一种不同的方式来处理三元条件：

```
"true" and var or "false" 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2022-02-01T13:23:03.720

**if else-if**版本可以写成：

```
sample_set="train" if "Train" in full_path else ("test" if "Test" in full_path else "validation") 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2022-02-06T13:46:32.173

有多种方法。最简单的一种是使用“打印”方法中的条件。

您可以使用

```
print("Twenty" if number == 20 else "Not twenty") 
```

这相当于：

```
if number == 20:
    print("Twenty")
else:
    print("Not twenty") 
```

这样，也可以打印两个以上的语句。例如：

```
if number == 20:
    print("Twenty")
elif number < 20:
    print("Lesser")
elif 30 > number > 20:
    print("Between")
else:
    print("Greater") 
```

可以写成：

```
print("Twenty" if number == 20 else "Lesser" if number < 20 else "Between" if 30 > number > 20 else "Greater") 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2022-02-16T23:09:11.670

是的，它有，但它不同于类 C 语法的编程语言（即`condition ? value_if_true : value_if_false`

在 Python 中，它是这样的：`value_if_true if condition else value_if_false`

例子：`even_or_odd = "even" if x % 2 == 0 else "odd"`

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-03-26T21:59:43.430

我发现默认的 Python 语法`val = a if cond else b`很麻烦，所以有时我会这样做：

```
iif = lambda (cond, a, b): a if cond else b
# So I can then use it like:
val = iif(cond, a, b) 
```

当然，它总是评估双方（*a*和*b*）的缺点，但语法对我来说更清晰。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2019-05-12T13:03:48.900

*链接多个运算符的巧妙方法：*

```
f = lambda x,y: 'greater' if x > y else 'less' if y > x else 'equal'

array = [(0,0),(0,1),(1,0),(1,1)]

for a in array:
  x, y = a[0], a[1]
  print(f(x,y))

# Output is:
#   equal,
#   less,
#   greater,
#   equal 
```

* * *

## 回答 #30

> 赞同：-3
> 
> 时间：2018-04-26T15:41:32.840

如果定义了一个变量并且你想检查它是否有一个值，你可以使用`a or b`：

```
def test(myvar=None):
    # Shorter than: print myvar if myvar else "no Input"
    print myvar or "no Input"

test()
test([])
test(False)
test('hello')
test(['Hello'])
test(True) 
```

将输出

```
no Input
no Input
no Input
hello
['Hello']
True 
```

* * *

## 回答 #31

> 赞同：-5
> 
> 时间：2019-10-23T07:22:58.023

```
is_spacial=True if gender = "Female" else (True if age >= 65 else False) 
```

**

> 它可以根据您的需要嵌套。祝你好运

**

# c# - 如何以托管方式在.NET中获取父进程

> ID：394816
> 
> 赞同：96
> 
> 时间：2008-12-27T08:48:04.213
> 
> 标签：c#, process, pinvoke, parent, managed

我一直在寻找在 .NET 中获取父进程的方法，但只找到了 P/Invoke 方式。

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2010-07-27T17:09:02.407

这是一个解决方案。它使用 p/invoke，但似乎运行良好，32 或 64 cpu：

```
/// <summary>
/// A utility class to determine a process parent.
/// </summary>
[StructLayout(LayoutKind.Sequential)]
public struct ParentProcessUtilities
{
    // These members must match PROCESS_BASIC_INFORMATION
    internal IntPtr Reserved1;
    internal IntPtr PebBaseAddress;
    internal IntPtr Reserved2_0;
    internal IntPtr Reserved2_1;
    internal IntPtr UniqueProcessId;
    internal IntPtr InheritedFromUniqueProcessId;

    [DllImport("ntdll.dll")]
    private static extern int NtQueryInformationProcess(IntPtr processHandle, int processInformationClass, ref ParentProcessUtilities processInformation, int processInformationLength, out int returnLength);

    /// <summary>
    /// Gets the parent process of the current process.
    /// </summary>
    /// <returns>An instance of the Process class.</returns>
    public static Process GetParentProcess()
    {
        return GetParentProcess(Process.GetCurrentProcess().Handle);
    }

    /// <summary>
    /// Gets the parent process of specified process.
    /// </summary>
    /// <param name="id">The process id.</param>
    /// <returns>An instance of the Process class.</returns>
    public static Process GetParentProcess(int id)
    {
        Process process = Process.GetProcessById(id);
        return GetParentProcess(process.Handle);
    }

    /// <summary>
    /// Gets the parent process of a specified process.
    /// </summary>
    /// <param name="handle">The process handle.</param>
    /// <returns>An instance of the Process class.</returns>
    public static Process GetParentProcess(IntPtr handle)
    {
        ParentProcessUtilities pbi = new ParentProcessUtilities();
        int returnLength;
        int status = NtQueryInformationProcess(handle, 0, ref pbi, Marshal.SizeOf(pbi), out returnLength);
        if (status != 0)
            throw new Win32Exception(status);

        try
        {
            return Process.GetProcessById(pbi.InheritedFromUniqueProcessId.ToInt32());
        }
        catch (ArgumentException)
        {
            // not found
            return null;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2010-02-25T17:53:29.540

这段代码为查找父进程对象提供了一个很好的接口，并考虑了多个进程同名的可能性：

用法：

```
Console.WriteLine("ParentPid: " + Process.GetProcessById(6972).Parent().Id); 
```

代码：

```
public static class ProcessExtensions {
    private static string FindIndexedProcessName(int pid) {
        var processName = Process.GetProcessById(pid).ProcessName;
        var processesByName = Process.GetProcessesByName(processName);
        string processIndexdName = null;

        for (var index = 0; index < processesByName.Length; index++) {
            processIndexdName = index == 0 ? processName : processName + "#" + index;
            var processId = new PerformanceCounter("Process", "ID Process", processIndexdName);
            if ((int) processId.NextValue() == pid) {
                return processIndexdName;
            }
        }

        return processIndexdName;
    }

    private static Process FindPidFromIndexedProcessName(string indexedProcessName) {
        var parentId = new PerformanceCounter("Process", "Creating Process ID", indexedProcessName);
        return Process.GetProcessById((int) parentId.NextValue());
    }

    public static Process Parent(this Process process) {
        return FindPidFromIndexedProcessName(FindIndexedProcessName(process.Id));
    }
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2017-09-21T14:12:11.283

这边走：

```
public static Process GetParent(this Process process)
{
  try
  {
    using (var query = new ManagementObjectSearcher(
      "SELECT * " +
      "FROM Win32_Process " +
      "WHERE ProcessId=" + process.Id))
    {
      return query
        .Get()
        .OfType<ManagementObject>()
        .Select(p => Process.GetProcessById((int)(uint)p["ParentProcessId"]))
        .FirstOrDefault();
    }
  }
  catch
  {
    return null;
  }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-08-18T22:57:37.027

这是我对托管解决方案的尝试。

它轮询所有进程的性能计数器，并将子 PID 的字典返回给父 PID。然后你可以用你当前的 PID 查字典，看看你的父母、祖父母等。

当然，它获得多少信息是矫枉过正的。随意优化。

```
using System;
using System.Collections.Generic;
using System.Diagnostics;

namespace PidExamples
{
    class ParentPid
    {
        static void Main(string[] args)
        {
            var childPidToParentPid = GetAllProcessParentPids();
            int currentProcessId = Process.GetCurrentProcess().Id;

            Console.WriteLine("Current Process ID: " + currentProcessId);
            Console.WriteLine("Parent Process ID: " + childPidToParentPid[currentProcessId]);
        }

        public static Dictionary<int, int> GetAllProcessParentPids()
        {
            var childPidToParentPid = new Dictionary<int, int>();

            var processCounters = new SortedDictionary<string, PerformanceCounter[]>();
            var category = new PerformanceCounterCategory("Process");

            // As the base system always has more than one process running, 
            // don't special case a single instance return.
            var instanceNames = category.GetInstanceNames();
            foreach(string t in instanceNames)
            {
                try
                {
                    processCounters[t] = category.GetCounters(t);
                }
                catch (InvalidOperationException)
                {
                    // Transient processes may no longer exist between 
                    // GetInstanceNames and when the counters are queried.
                }
            }

            foreach (var kvp in processCounters)
            {
                int childPid = -1;
                int parentPid = -1;

                foreach (var counter in kvp.Value)
                {
                    if ("ID Process".CompareTo(counter.CounterName) == 0)
                    {
                        childPid = (int)(counter.NextValue());
                    }
                    else if ("Creating Process ID".CompareTo(counter.CounterName) == 0)
                    {
                        parentPid = (int)(counter.NextValue());
                    }
                }

                if (childPid != -1 && parentPid != -1)
                {
                    childPidToParentPid[childPid] = parentPid;
                }
            }

            return childPidToParentPid;
        }
    }
} 
```

在其他新闻中，我了解到我的机器上有多少性能计数器：13401。圣牛。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-10-01T09:46:38.100

如果接受 P/Invoke，有一个更好的方法，它比 NtQueryInformationProcess 记录更多：即 PROCESSENTRY32 (CreateToolhelp32Snapshot, Process32First, Process32Next)。它[显示在这篇文章中](https://stackoverflow.com/a/16756808)。

注意[细微的细节](https://stackoverflow.com/a/394014) ，注意父 PID 不一定是创建者 PID，实际上这些可能完全不相关，正如 [PROCESSENTRY32](http://msdn.microsoft.com/en-us/library/windows/desktop/ms684839%28v=vs.85%29.aspx)的社区评论所指出的那样。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-01-14T12:12:58.720

如果你曾经挖掘过 BCL，你会发现寻找父进程的方法被刻意避免了，例如：

[https://referencesource.microsoft.com/#System/services/monitoring/system/diagnosticts/ProcessManager.cs,327](https://referencesource.microsoft.com/#System/services/monitoring/system/diagnosticts/ProcessManager.cs,327)

正如您在源代码中看到的，它包含全面的结构和导入的本地方法，这绝对足以完成工作。但是，即使您通过反射访问它们（这是可能的），您也找不到直接执行此操作的方法。我无法回答为什么，但是这种现象会导致像您这样的问题被反复询问；例如：

[如何获取应用程序父进程的 PID](https://stackoverflow.com/questions/2531837/how-can-i-get-the-pid-of-the-parent-process-of-my-application)

因为在这个线程中没有答案以及使用[CreateToolhelp32Snapshot](https://msdn.microsoft.com/zh-tw/library/windows/desktop/ms682489(v=vs.85).aspx)的一些代码，我会添加它——我从 MS 的参考源中窃取的结构定义和名称的一部分:)

*   代码

    ```
    using System.Diagnostics;
    using System.Runtime.InteropServices;
    using System.Collections.Generic;
    using System.Linq;
    using System; 
    ```

    * * *

    ```
    public static class Toolhelp32 {
        public const uint Inherit = 0x80000000;
        public const uint SnapModule32 = 0x00000010;
        public const uint SnapAll = SnapHeapList|SnapModule|SnapProcess|SnapThread;
        public const uint SnapHeapList = 0x00000001;
        public const uint SnapProcess = 0x00000002;
        public const uint SnapThread = 0x00000004;
        public const uint SnapModule = 0x00000008;

        [DllImport("kernel32.dll")]
        static extern bool CloseHandle(IntPtr handle);
        [DllImport("kernel32.dll")]
        static extern IntPtr CreateToolhelp32Snapshot(uint flags, int processId);

        public static IEnumerable<T> TakeSnapshot<T>(uint flags, int id) where T : IEntry, new() {
            using(var snap = new Snapshot(flags, id))
                for(IEntry entry = new T { }; entry.TryMoveNext(snap, out entry);)
                    yield return (T)entry;
        }

        public interface IEntry {
            bool TryMoveNext(Toolhelp32.Snapshot snap, out IEntry entry);
        }

        public struct Snapshot:IDisposable {
            void IDisposable.Dispose() {
                Toolhelp32.CloseHandle(m_handle);
            }
            public Snapshot(uint flags, int processId) {
                m_handle=Toolhelp32.CreateToolhelp32Snapshot(flags, processId);
            }
            IntPtr m_handle;
        }
    } 
    ```

    * * *

    ```
    [StructLayout(LayoutKind.Sequential)]
    public struct WinProcessEntry:Toolhelp32.IEntry {
        [DllImport("kernel32.dll")]
        public static extern bool Process32Next(Toolhelp32.Snapshot snap, ref WinProcessEntry entry);

        public bool TryMoveNext(Toolhelp32.Snapshot snap, out Toolhelp32.IEntry entry) {
            var x = new WinProcessEntry { dwSize=Marshal.SizeOf(typeof(WinProcessEntry)) };
            var b = Process32Next(snap, ref x);
            entry=x;
            return b;
        }

        public int dwSize;
        public int cntUsage;
        public int th32ProcessID;
        public IntPtr th32DefaultHeapID;
        public int th32ModuleID;
        public int cntThreads;
        public int th32ParentProcessID;
        public int pcPriClassBase;
        public int dwFlags;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
        public String fileName;
        //byte fileName[260];
        //public const int sizeofFileName = 260;
    } 
    ```

    * * *

    ```
    public static class Extensions {
        public static Process Parent(this Process p) {
            var entries = Toolhelp32.TakeSnapshot<WinProcessEntry>(Toolhelp32.SnapAll, 0);
            var parentid = entries.First(x => x.th32ProcessID==p.Id).th32ParentProcessID;
            return Process.GetProcessById(parentid);
        }
    } 
    ```

我们可以像这样使用它：

*   测试

    ```
    public class TestClass {
        public static void TestMethod() {
            var p = Process.GetCurrentProcess().Parent();
            Console.WriteLine("{0}", p.Id);
        }
    } 
    ```

* * *

对于替代结局..

根据文档，每种类型的条目都有一对迭代方法，例如`Process32First`和`Process32Next`用于流程的迭代；但是我发现 `xxxxFirst' 方法是不必要的，然后我想为什么不把迭代方法和它对应的条目类型放在一起呢？它会更容易实现和理解（我想是这样..）。

就像`Toolhelp32`后缀*help*一样，我认为静态帮助器类是合适的，这样我们就可以有明确的限定名称，例如`Toolhelp32.Snapshot`或者`Toolhelp32.IEntry`尽管它在这里无关紧要..

获得父进程后，如果您还想获得一些详细信息，可以轻松扩展，例如，迭代其模块，然后添加：

*   代码 - WinModuleEntry

    ```
    [StructLayout(LayoutKind.Sequential)]
    public struct WinModuleEntry:Toolhelp32.IEntry { // MODULEENTRY32
        [DllImport("kernel32.dll")]
        public static extern bool Module32Next(Toolhelp32.Snapshot snap, ref WinModuleEntry entry);

        public bool TryMoveNext(Toolhelp32.Snapshot snap, out Toolhelp32.IEntry entry) {
            var x = new WinModuleEntry { dwSize=Marshal.SizeOf(typeof(WinModuleEntry)) };
            var b = Module32Next(snap, ref x);
            entry=x;
            return b;
        }

        public int dwSize;
        public int th32ModuleID;
        public int th32ProcessID;
        public int GlblcntUsage;
        public int ProccntUsage;
        public IntPtr modBaseAddr;
        public int modBaseSize;
        public IntPtr hModule;
        //byte moduleName[256];
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 256)]
        public string moduleName;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
        public string fileName;
        //byte fileName[260];
        //public const int sizeofModuleName = 256;
        //public const int sizeofFileName = 260;
    } 
    ```

    * * *

    和一些测试..

    ```
    public class TestClass {
        public static void TestMethod() {
            var p = Process.GetCurrentProcess().Parent();
            Console.WriteLine("{0}", p.Id);

            var formatter = new CustomFormatter { };
            foreach(var x in Toolhelp32.TakeSnapshot<WinModuleEntry>(Toolhelp32.SnapModule, p.Id)) {
                Console.WriteLine(String.Format(formatter, "{0}", x));
            }
        }
    }

    public class CustomFormatter:IFormatProvider, ICustomFormatter {
        String ICustomFormatter.Format(String format, object arg, IFormatProvider formatProvider) {
            var type = arg.GetType();
            var fields = type.GetFields();
            var q = fields.Select(x => String.Format("{0}:{1}", x.Name, x.GetValue(arg)));
            return String.Format("{{{0}}}", String.Join(", ", q.ToArray()));
        }

        object IFormatProvider.GetFormat(Type formatType) {
            return typeof(ICustomFormatter)!=formatType ? null : this;
        }
    } 
    ```

如果你想要一个代码示例..

*   [https://github.com/kenkins/ToolHelp32ConsoleApp](https://github.com/kenkins/ToolHelp32ConsoleApp)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2022-01-13T16:43:50.290

不幸的是，从 .NET 6 开始，仍然没有托管的跨平台解决方案来获取父进程。

.NET 存储库（自 2017 年 12 月 12 日起）正在讨论此问题：[通过 System.Diagnostics.Process (#24423) 公开父/子进程信息](https://github.com/dotnet/runtime/issues/24423)。

# wcf - WCF：由于身份验证失败，无法满足对安全令牌的请求

> ID：394829
> 
> 赞同：28
> 
> 时间：2008-12-27T09:19:30.030
> 
> 标签：wcf, wcf-authentication

我编写了一个非常简单的 WCF 服务来发送和接收消息。我已经通过 VS 2008 默认 Web 服务器主机测试了该应用程序，一切正常。但是当我将 WCF 服务部署到另一台计算机的 IIS 时，我收到以下错误：

**“由于身份验证失败，无法满足对安全令牌的请求。”**

如何设置身份验证类型以在配置文件中使用我的自定义用户名和密码？如果不可能，请告诉我如何设置其 Windows 凭据，因为我使用的两台计算机不共享相同的用户。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-28T20:21:19.827

您需要关闭绑定的安全性。否则，我相信默认情况下，wsHttpBinding 将尝试协商安全上下文令牌 (SCT)。

因此，修改端点定义以指向绑定配置部分。这是一个例子：

```
<endpoint address="" 
          binding="wsHttpBinding" 
          contract="HelloWorldService.IService1"
          bindingConfiguration="TheBindingConfig"> 
```

`<services>`然后在 web.config 部分的部分之后添加类似以下绑定配置的`<system.serviceModel>`内容。

```
<bindings>
  <wsHttpBinding>
    <binding name="TheBindingConfig">
      <security mode="None" />
    </binding>
  </wsHttpBinding>
</bindings> 
```

将安全设置为“无”是关键。

希望这有帮助！

* * *

以上对我有帮助-但不是立即显而易见的是如何添加到*服务*端（一旦你完成了需要的东西，它就很清楚了，但直到你这样做了）。它不完全明显的原因是因为默认情况下没有绑定部分，而客户端中可能有一个。

所以，要非常清楚 - 在服务端，添加绑定部分（如上文所述），然后向适当的端点添加 bindingConfiguration="TheBindingConfig" 属性。做过一次就很明显了...

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2010-05-18T19:36:37.360

您实际上不需要关闭安全性，在某些情况下也不应该。在 bindingConfiguration 中，您可以指定不建立安全上下文的消息级别安全性，如下所示：

```
<security mode="Message">
    <transport clientCredentialType="Windows" proxyCredentialType="None"
                        realm="" />
    <message clientCredentialType="Windows" negotiateServiceCredential="true"
        algorithmSuite="Default" establishSecurityContext="false" />
</security> 
```

请注意建立安全上下文属性。客户端和服务都应该有一个安全配置，其中建立安全上下文设置为相同的值。true 值也可以正常工作，但在服务器负载平衡的环境中建议使用 false。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-12-27T08:39:22.763

一定要在客户端和服务器上**都**`bindingConfiguration`设置这个（指定安全模式'none'），否则你会得到这个消息——就调试问题而言，这是一个非常危险的问题。

 **> 无法处理该消息。这很可能是因为操作“ [http://tempuri.org/IInterfaceName/OperationName](http://tempuri.org/IInterfaceName/OperationName) ”不正确，或者因为消息包含无效或过期的安全上下文令牌，或者因为绑定之间不匹配。如果服务由于不活动而中止通道，则安全上下文令牌将无效。为了防止服务过早中止空闲会话，请增加服务端点绑定的接收超时。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-08T14:20:18.567

如果您处于调试模式，则将调试属性设置为

```
<serviceDebug includeExceptionDetailInFaults="true"/> 
```

默认情况下，它设置为 false ..所以当您进行调试时，它会抛出该异常。

希望能帮助到你 。

# file - Inno 设置：隐藏文件

> ID：394835
> 
> 赞同：0
> 
> 时间：2008-12-27T09:29:25.003
> 
> 标签：file, hide, inno-setup

如何在使用 Inno Setup 制作的软件包安装我的应用程序时隐藏文件？它可以被隐藏

“[文件] 属性：隐藏”

但可以通过激活 windows 选项再次看到

“显示隐藏文件”

如何永久隐藏它以避免用户篡改 EXE 文件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T09:57:31.140

做不到。如果您需要详细解释原因，请参阅此博客文章：http: [//blogs.msdn.com/oldnewthing/archive/2005/04/19/409620.aspx](http://blogs.msdn.com/oldnewthing/archive/2005/04/19/409620.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-28T01:35:56.610

如果你真的很有野心，并且你真的对人们“篡改”你的 exe 文件有问题，你也许可以加密你的 exe 文件，使用 PE（便携式可执行文件）和加载器或其他东西。

我怀疑这一切是否值得。多年来，EXE 已被许多软件公司分发。您的应用程序可能没有那么特别，无法保证有任何不寻常之处。

设置这些标志，并专注于更重要的问题。

# security - CSRF：POST请求返回的JSON数据会被窃取吗？

> ID：394836
> 
> 赞同：2
> 
> 时间：2008-12-27T09:29:31.337
> 
> 标签：security, json, csrf

POST 请求返回的 JSON 数据会被跨站请求伪造攻击窃取吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T12:37:25.607

用JS是做不到的，但是我不确定Flash的跨域请求。

在 JS POST 请求可以通过表单和 XMLHTTPRequest 进行。你看不到跨域表单的结果，所以这是安全的。XHR 禁止跨域请求，所以也很安全。

浏览器确实允许通过元素跨域包含脚本`<script>`，但这仅使用 GET。

# asp.net - 在 Crystal Reports 中使用无类型数据集

> ID：394841
> 
> 赞同：1
> 
> 时间：2008-12-27T09:44:46.767
> 
> 标签：asp.net, crystal-reports

我正在页面加载中创建运行时数据集。在这个数据集中，我添加了这样的列：

```
CrystalDecisions.CrystalReports.Engine.ReportDocument orpt = 
   new CrystalDecisions.CrystalReports.Engine.ReportDocument();

DataTable table = new DataTable("DataSet1");

table.Columns.Add("Fname", typeof(System.String));
table.Columns.Add("Lname", typeof(System.String));
table.Columns.Add("Salary", typeof(System.String));
DataRow row = table.NewRow();
row["Fname"] = "Mathew";
row["Lname"] = "Hayden";
row["Salary"] = "5000$";

table.Rows.Add(row);
ds.Tables.Add(table);

orpt.Load(MapPath("CrystalReport3.rpt"));
orpt.SetDataSource(ds.Tables[0]);
CrystalReportViewer1.ReportSource = orpt; 
```

当我要运行程序时，CrystalReport3.rpt 中没有显示记录。请告诉我如何在 Crystal Reports 3 中设置这些列！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-11-11T09:22:11.277

代替

```
orpt.SetDataSource(ds.Tables[0]); 
```

做

```
orpt.SetDataSource(ds.Tables["table_name"]); 
```

table_name 是您为该表指定的表名

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T10:15:33.270

如果将代码从 Page_Load 移动到ASP.NET 页面的**Page_Init 事件处理程序会发生什么？**

尝试将[**AutoDataBind**属性](http://msdn.microsoft.com/en-us/library/ms226805.aspx)设置为“true”：

> 获取或设置是否使用自动数据绑定到报表源。如果该值设置为 True，则在 OnInit() 或 Page_Init() 事件之后调用 DataBind() 方法。

另一个提示：您是否尝试**调用 CrystalReportViewer1 对象的 RefreshReport()**（或旧版本中的 Refresh()）方法？

# c++ - C++ 2DArray 对象；指针和数组问题

> ID：394844
> 
> 赞同：0
> 
> 时间：2008-12-27T09:56:03.467
> 
> 标签：c++, pointers, object, multidimensional-array

这个问题来自我旧问题中的一个已解决问题，来自： [C++ Inserting 2D array Object into another 2D array Object](https://stackoverflow.com/questions/394763/c-inserting-2d-array-object-into-another-2d-array-object)

但也给我带来了新的问题。请阅读链接中的问题和解决方案以了解我的问题。上一个问题的解决方案是将我的数据成员函数变成一个指向指针的指针，以允许传递给另一个数据成员函数。但是在修复这个问题的同时，第一个数据成员函数`smallerArray.extractPiece()`现在只返回指针的地址，而不是这些指针的内容。我需要这些内容才能使我的第二个数据成员函数`largerArray.extractArray(result)`正常工作，因为我尝试运行代码并给出了窗口错误，而不是编译错误。

有谁知道如何提取`smallerArray.extractPiece()`和而不是获取地址的内容，并且没有，有没有人有任何其他方法来创建二维数组对象？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T11:03:38.417

```
void Grid::extractArray( int** arr )
{
  for(int i = 0; i < xGrid ; ++i) {
    for (int j = 0; j < yGrid ; ++j) {
      squares[i][j] = arr[i][j];
    }
  }
} 
```

较小的数组`int**arr`没有`Grid`. `xGrid`并且`yGrid`太大而不能用作 的索引`arr[][]`。

您必须将完整的较小数组对象传递给`extractArray()`函数，并将该对象的大小用于复制函数。

```
void Grid::extractArray( const Piece & piece)
{
  for(int i = 0; i < piece.xGrid ; ++i) {
    for (int j = 0; j < piece.yGrid ; ++j) {
      squares[i][j] = arr[i][j];
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-05T16:50:10.497

如果您创建一个二维数组对象或类（或结构），它可能会使事情变得更容易

```
class BaxMatrix {
public:
  int m_Data[4][4];
} 
```

通过一些工作，您可以根据需要构建动态结构或使用 STL 结构。数据和对数据的引用是两种不同的动物。在继续前进之前，最好先明确他们在您的思维中的每个角色。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T10:58:39.207

现在，您的问题似乎有点不明确。您希望从较小的阵列中获得多大的“一块”，以及您想在较大的阵列中的哪个位置插入它？

# c# - 在浏览器中调用 Adob e Reader 插件的打印/保存/电子邮件功能

> ID：394848
> 
> 赞同：1
> 
> 时间：2008-12-27T09:57:54.663
> 
> 标签：c#, asp.net, activex, acrobat, adobe-reader

我正在寻找一种从浏览器中的 Adob​​e Reader 插件调用打印/保存/电子邮件功能的方法。为了更好地解释，请在浏览器中打开以下图片：

[http://stylephp.com/demo/pdf.png](http://stylephp.com/demo/pdf.png)

在图像中，您将看到一个示例 PDF 已加载到 Adob​​e Reader 插件的浏览器中。该插件上有保存/电子邮件/打印按钮。此外，它上面还有四个类似的 html 按钮。

单击顶部的 html 按钮时，我想调用插件中的按钮。

仅供参考，我正在使用 asp.net c# 2005。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T16:13:46.277

Adobe Reader 插件不公开任何外部 Javascript API。

# c# - 如何在 C# 中获取调用方法

> ID：394850
> 
> 赞同：22
> 
> 时间：2008-12-27T10:07:38.107
> 
> 标签：c#, reflection

> **可能重复：**
> [如何找到调用当前方法的方法？](https://stackoverflow.com/questions/171970/how-can-i-find-the-method-that-called-the-current-method)

我需要一种方法来知道 C# 中调用方法的名称。

例如：

```
private void doSomething()
{
// I need to know who is calling me? (method1 or method2).

// do something pursuant to who is calling you?
} 

private void method1()
{
 doSomething();
}

private void method2()
{
 doSomething();
} 
```

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-12-27T10:12:54.603

来自[http://www.csharp-examples.net/reflection-calling-method-name/](http://www.csharp-examples.net/reflection-calling-method-name/)

```
using System.Diagnostics;

// get call stack
StackTrace stackTrace = new StackTrace();

// get calling method name
Console.WriteLine(stackTrace.GetFrame(1).GetMethod().Name); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-21T13:10:55.673

你几乎肯定不想这样做。调用者永远不应该知道是谁在调用它。相反，应该将两个调用者之间的差异抽象为一个参数，并传递给被调用的方法：

```
private void doSomething(bool doItThisWay)
{
    if (doItThisWay)
    {
        // Do it one way
    }
    else
    {
        // Do it the other way
    }
}

private void method1()
{
    doSomething(true);
}

private void method2()
{
    doSomething(false);
} 
```

这样，如果您添加一个 method3，它可以以一种方式或另一种方式做某事，而 doSomething 不会在意。

# sql - SQL INNER JOIN 语法

> ID：394853
> 
> 赞同：28
> 
> 时间：2008-12-27T10:14:14.943
> 
> 标签：sql, syntax, inner-join, cross-join

下面的两位 SQL 得到相同的结果

```
SELECT c.name, o.product  
FROM customer c, order o  
WHERE c.id = o.cust_id  
AND o.value = 150  

SELECT c.name, o.product  
FROM customer c  
INNER JOIN order o on c.id = o.cust_id  
WHERE o.value = 150 
```

我已经看到这两种风格在不同的公司都被用作标准。据我所见，第二个是大多数人在网上推荐的。除了风格之外，还有什么真正的原因吗？使用 Inner Join 有时会有更好的性能吗？

我注意到 Ingres 和 Oracle 开发人员倾向于使用第一种风格，而 Microsoft SQL Server 用户倾向于使用第二种风格，但这可能只是巧合。

感谢您的任何见解，我一直想知道这个问题。

编辑：由于我使用了不正确的术语，我已将标题从“SQL 内连接与笛卡尔积”更改。感谢您迄今为止的所有回复。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-27T10:38:15.877

这两个查询都是内部连接和等价的。第一种是较老的做事方法，而 JOIN 语法的使用只是在引入 SQL-92 标准之后才变得普遍（我相信它在较旧的定义中，只是在那之前并没有特别广泛地使用）。

强烈推荐使用 JOIN 语法，因为它将连接逻辑与 WHERE 子句中的过滤逻辑分开。虽然 JOIN 语法实际上是内连接的语法糖，但它的优势在于外连接，旧的 * 语法可能会产生无法明确描述连接并且解释依赖于实现的情况。[左 | RIGHT] JOIN 语法避免了这些陷阱，因此为了保持一致性，在所有情况下都最好使用 JOIN 子句。

请注意，这两个示例都不是笛卡尔积。为此，您可以使用

```
SELECT c.name, o.product  
FROM customer c, order o  
WHERE o.value = 150 
```

或者

```
SELECT c.name, o.product  
FROM customer c  CROSS JOIN order o 
WHERE o.value = 150 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-27T10:19:58.317

为了回答您的部分问题，我认为 Oracle 中 JOIN ... ON 语法中的早期错误阻止了 Oracle 用户远离该语法。我不认为现在有什么特别的问题。

它们是等价的，应该被解析为相同的内部表示以进行优化。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-27T10:17:07.463

实际上这些例子是等价的，也不是笛卡尔积。连接两个表而不指定连接条件时返回笛卡尔积，例如

```
select *
from t1,t2 
```

[在Wikipedia](http://en.wikipedia.org/wiki/Join_(SQL))上有很好的讨论。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-27T10:24:30.523

Oracle 在支持 JOIN ... ON (ANSI) 语法方面很晚（直到 Oracle 9），这就是 Oracle 开发人员经常不使用它的原因。

就个人而言，我更喜欢使用 ANSI 语法，因为逻辑上很清楚一个表正在驱动查询，而其他表是查找表。当表格“相等”时，我倾向于使用笛卡尔语法。

性能应该完全不同。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-27T10:17:03.173

两个查询都在执行内部连接，只是语法不同。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-29T00:23:49.813

JOIN... ON... 语法是对 SQL 的 ANSI 和 ISO 规范的最新补充。JOIN... ON... 语法通常是首选，因为它 1) 将连接条件从 WHERE 子句中移出，使得 WHERE 子句仅用于过滤；2) 如果您正在创建一个可怕的笛卡尔积，则它会更加明显，因为每个JOIN 必须伴随至少一个 ON 子句。如果所有的连接条件都只是在 WHERE 子句中进行了 AND 运算，那么当缺少一个或多个条件时就不那么明显了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-04-07T19:03:57.053

## TL;博士

INNER JOIN 语句可以重写为 CROSS JOIN，其 WHERE 子句与您在 INNER JOIN 查询的 ON 子句中使用的条件匹配。

## 表关系

考虑到我们有以下`post`和`post_comment`表格：

[![post 和 post_comment 表](https://i.stack.imgur.com/YjnW7.png)](https://i.stack.imgur.com/YjnW7.png)

有以下`post`记录：

```
| id | title     |
|----|-----------|
| 1  | Java      |
| 2  | Hibernate |
| 3  | JPA       | 
```

并且`post_comment`具有以下三行：

```
| id | review    | post_id |
|----|-----------|---------|
| 1  | Good      | 1       |
| 2  | Excellent | 1       |
| 3  | Awesome   | 2       | 
```

## SQL 内连接

SQL JOIN 子句允许您关联属于不同表的行。例如，[CROSS JOIN](https://vladmihalcea.com/sql-cross-join/)将创建一个笛卡尔积，其中包含两个连接表之间所有可能的行组合。

虽然 CROSS JOIN 在某些情况下很有用，但大多数时候，您希望根据特定条件连接表。而且，这就是 INNER JOIN 发挥作用的地方。

SQL INNER JOIN 允许我们根据通过 ON 子句指定的条件过滤连接两个表的笛卡尔积。

## SQL INNER JOIN - 在“始终为真”条件下

如果您提供“始终为真”条件，则 INNER JOIN 不会过滤连接的记录，结果集将包含两个连接表的笛卡尔积。

例如，如果我们执行以下 SQL INNER JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.id AS "pc.id"
FROM post p
INNER JOIN post_comment pc ON 1 = 1 
```

我们将得到所有的组合`post`和`post_comment`记录：

```
| p.id    | pc.id      |
|---------|------------|
| 1       | 1          |
| 1       | 2          |
| 1       | 3          |
| 2       | 1          |
| 2       | 2          |
| 2       | 3          |
| 3       | 1          |
| 3       | 2          |
| 3       | 3          | 
```

因此，如果 ON 子句条件为“始终为真”，则 INNER JOIN 就等同于 CROSS JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.id AS "pc.id"
FROM post p
CROSS JOIN post_comment
WHERE 1 = 1
ORDER BY p.id, pc.id 
```

## SQL INNER JOIN - ON“总是假”条件

另一方面，如果 ON 子句条件为“始终为假”，则所有连接的记录都将被过滤掉，结果集将为空。

因此，如果我们执行以下 SQL INNER JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.id AS "pc.id"
FROM post p
INNER JOIN post_comment pc ON 1 = 0
ORDER BY p.id, pc.id 
```

我们不会得到任何结果：

```
| p.id    | pc.id      |
|---------|------------| 
```

这是因为上面的查询等价于下面的 CROSS JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.id AS "pc.id"
FROM post p
CROSS JOIN post_comment
WHERE 1 = 0
ORDER BY p.id, pc.id 
```

## SQL INNER JOIN - 使用外键和主键列的 ON 子句

最常见的 ON 子句条件是子表中的外键列与父表中的主键列匹配的条件，如以下查询所示：

```
SELECT
   p.id AS "p.id",
   pc.post_id AS "pc.post_id",
   pc.id AS "pc.id",
   p.title AS "p.title",
   pc.review  AS "pc.review"
FROM post p
INNER JOIN post_comment pc ON pc.post_id = p.id
ORDER BY p.id, pc.id 
```

在执行上述 SQL INNER JOIN 查询时，我们得到以下结果集：

```
| p.id    | pc.post_id | pc.id      | p.title    | pc.review |
|---------|------------|------------|------------|-----------|
| 1       | 1          | 1          | Java       | Good      |
| 1       | 1          | 2          | Java       | Excellent |
| 2       | 2          | 3          | Hibernate  | Awesome   | 
```

因此，只有符合 ON 子句条件的记录才会包含在查询结果集中。在我们的例子中，结果集包含所有`post`以及它们的`post_comment`记录。`post`没有关联的行`post_comment`被排除，因为它们不能满足 ON 子句条件。

同样，上面的 SQL INNER JOIN 查询等价于下面的 CROSS JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.post_id AS "pc.post_id",
   pc.id AS "pc.id",
   p.title AS "p.title",
   pc.review  AS "pc.review"
FROM post p, post_comment pc
WHERE pc.post_id = p.id 
```

未命中的行是满足 WHERE 子句的行，只有这些记录才会包含在结果集中。这是可视化 INNER JOIN 子句如何工作的最佳方式。

```
| p.id | pc.post_id | pc.id | p.title | 电脑评论 |
|--------|------------|--------|-----------|--------- --|
| 1 | 1 | 1 | 爪哇 | 好 |
| 1 | 1 | 2 | 爪哇 | 优秀 |
| 1 | 2 | 3 | 爪哇 | 真棒| 
| 2 | 1 | 1 | 休眠 | 好 | 
| 2 | 1 | 2 | 休眠 | 优秀 |
| 2 | 2 | 3 | 休眠 | 真棒|
| 3 | 1 | 1 | JPA | 好 | 
| 3 | 1 | 2 | JPA | 优秀 | 
| 3 | 2 | 3 | JPA | 真棒|

```

> 并不是说这仅适用于 INNER JOIN，不适用于 OUTER JOIN。

# c++ - 使用“不可复制”类时消除 GCC 警告

> ID：394854
> 
> 赞同：1
> 
> 时间：2008-12-27T10:15:28.780
> 
> 标签：c++, effective-c++

我有几个我不想被复制的类，其中一些类有指针数据成员。为了使这些类不可复制，我私下继承了以下类模板：

```
template <class T>
class Uncopyable
{
  protected:
    Uncopyable() {}
    virtual ~Uncopyable() {}
  private:
    Uncopyable(const Uncopyable &);
    T & operator=(const T&);
}; 
```

我这样使用：

```
class Entity : private Uncopyable<Entity> { } 
```

这很好用，但是当我使用 -Weffc++ 编译时，我仍然收到以下警告：

```
class Entity has pointer data members
but does not override Entity(const Entity&)
or operator=(const Entity&) 
```

为什么它仍然给我这个警告？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-27T10:29:00.670

C++ 说

> 因为如果用户未声明复制赋值运算符，则会为类隐式声明，因此基类复制赋值运算符始终被派生类的复制赋值运算符隐藏（13.5.3）。从基类引入赋值运算符的 using-declaration (7.3.3)，其参数类型可能是派生类的复制赋值运算符的类型，不被视为复制赋值运算符的显式声明，并且不抑制派生类复制赋值运算符的隐式声明；由 using 声明引入的运算符被派生类中隐式声明的复制赋值运算符隐藏。

代码中的错误是您的基类声明`operator=`接受派生类类型的引用。这不会阻止隐式公开声明 operator= 为基础。因此，您的派生类**和**基类仍然是可分配的。尝试将您的不可复制类更改为非模板，这应该足够了：

```
class Uncopyable
{
  protected:
    Uncopyable() {}
    virtual ~Uncopyable() {}
  private:
    Uncopyable(const Uncopyable &);
    Uncopyable & operator=(const Uncopyable&);
}; 
```

One more thing i have just figured in that code: Don't make the destructor of Uncopyable virtual. The reason is, no-one (apart from the derived class itself) can call delete on a pointer to Uncopyable (because 1: the destructor is protected, 2: you derive privately). So it's not the concern of Uncopyable to make the destructor of the derived class implicitly virtual. If the derived class needs to have a virtual destructor, put virtual in there instead, and leave Uncopyables' destructor non-virtual.

# java - Java中的MVC

> ID：394871
> 
> 赞同：8
> 
> 时间：2008-12-27T10:32:02.567
> 
> 标签：java, model-view-controller

这是关于学校作业的，所以我正在努力按照书本做事。我觉得我掌握了 Java，但良好的编程实践、设计模式等对我来说都是新的。

我已经制作了我的模型，并且效果很好。它包含一个学生类，其中包含许多带有学生信息的字段（显然）。现在我希望这些信息显示在几个 JLabel 中。将整个学生对象传递给 GUI 并多次使用 JLabel.settext.getname() 等是最简单的方法，毫无疑问这将完美运行。但我觉得学生对象是模型的一部分，通过将其传递给 GUI，我不再使用 MVC 模式。我在这里吗？

我确实创建了一个控制器对象，用于将数据传入和传出模型和 GUI，但仅将字符串传递给标签或通过控制器设置 JLabel 文本，我需要 GUI 中的大量设置器，或者我必须使所有 JLabels 全局字段都感觉不好。

对此有何建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-27T10:49:31.487

请注意，Swing 组件内部都使用 MVC 模式，因此它们已经有了模型。这与 JTable 等复杂的小部件更相关，您肯定希望您的模型在其中实现`TableModel`接口。

最大的问题是如何协调您的域模型与各个 Swing 组件的内部模型。一种方法是在你的 GUI 类中拥有`setModel()`和`getModel()`方法，它们在它们之间进行转换，即`setModel()`获取你的模型并调用`setText()`各个 JLabels 等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T10:48:13.050

GUI 应该担心所有界面的东西。我猜你有一个类是你的 GUI，用你的 JLabels 对学生做“事情”。只需将您的学生实例传递给这个类，让它做它需要做的事情。当它完成后，它将调用一个控制器方法来做任何需要做的事情。

OOD 处理传递您想要操作的对象。您无需将对象分开即可传入 MVC。如果这是一般情况，您应该真正传递它。该模型定义了您将使用的数据对象......或者更具体地说，系统将使用（控制器）和用户将使用（GUI）。这些类是为了传递而构建的。如果您取消封装所有信息，您将不得不做更多的工作呵呵:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T12:32:09.283

视图需要您的模型来创建 UI（从模型中拉取）并从中接收更新（按模型推送）。理想情况下，模型以只读方式呈现给视图。控制器将提供视图将用于更新模型的方法，以便很好地分离关注点。

关于 MVC 究竟是什么，有许多不同的形式和解释，请尝试谷歌搜索。此外，您经常可以在应用程序的不同级别上找到 MVC（例如 Swing 模型、您的域模型，...）。

With MVC and variants on MVC, the most important thing is that you can explain individual subpatterns (Observer, Facade, ...) and defend the design choices you made (advantages/disadvantages) instead of trying to implement **the** one and only unique MVC pattern, if it would exist.

So my advice for your assignment, if possible of course, would be to implement something that works well, inspired by what you've read on MVC and its subpatterns, and only afterwards see how well it agrees or disagrees with some "traditional" descriptions of MVC patterns you can find.

# perl - 为什么我的 Perl 诅咒窗口不起作用？

> ID：394873
> 
> 赞同：4
> 
> 时间：2008-12-27T10:35:31.593
> 
> 标签：perl, window, curses

这可能是我对 Curses 的理解比 Perl 更多的问题，但请帮助我。我正在使用 Curses.pm，它运行良好，除非我尝试创建一个 curses“窗口”。示例代码：

```
use Curses;
initscr;
$w=newwin(1,1,40,40);
$w->addstr(20,20,"Hello");
$w->refresh;
refresh;
endwin; 
```

什么都不输出。不使用窗口可以正常工作：

```
use Curses;
initscr; 
$w=newwin(1,1,40,40); 
addstr(20,20,"Hello"); 
refresh; 
endwin; 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-27T12:13:53.843

你需要把你的论点放在正确的地方，记住什么是什么并不容易。在尝试了所有错误的排列之后，我总是要查找它。我只是查看 C 接口的手册页，然后将其更改为 Perl 语法。

[curs_window](http://www.mkssoftware.com/docs/man3/curs_window.3.asp)手册页中记录的`newwin`函数采用：

```
newwin( height, width, starty, startx ) 
```

您设置了一个一行高一列宽的窗口，从第 40 行第 40 列开始。但是，您随后告诉`addstr`在该窗口中的第 20 行第 20 列放置文本。那是在您设置的 1x1 框架之外，所以您什么都看不到。

试试这个，看看它是否适合你。如果可行，请尝试调整窗口值以获得所需的帧。

```
use Curses;
initscr;

$w = newwin(
    1,       # height (y)
    COLS(),  # width  (x)
    0,       # start y
    1        # start x
    );

$w->addstr( 
    0,       # relative y to window
    0,       # relative x to window
    "Hello" 
    );

$w->refresh();

sleep 10;
endwin; 
```

# algorithm - ASCII 艺术图像转换算法如何工作？

> ID：394882
> 
> 赞同：62
> 
> 时间：2008-12-27T10:43:43.527
> 
> 标签：algorithm, ascii-art

有一些不错的免费“图像到 ASCII 艺术”转换网站，例如：[ASCII-art.org](http://www.ascii-art.org/)

这样的图像转换算法是如何工作的？

```
                         ,                     
                     . ,                
                     万维网@                
                     ,WW                
                  , W, :W* .W 。             
                  #WW@WWWW#             
                  万维网万维网：W             
                  W.WW*WWW#WW@W             
               * :WW.WWWWWWW@WWW@W #          
              +* #WW#WWWWWWWWWWWWWW# W          
              W# @WWWWWWWWWWWWWWWWW          
              万维网万维网万维网万维网万维网          
              万维网万维网万维网万维网@W#         
             ,WW.WWWWWWWWWWWWWWWWWWWW         
              WW@WWWWWWWWWWWWWWWWWWWW         
            : WWWWWWWWWWWWWWWWWWWWWWW :       
            @WWWWWWW@WWWWWWW@@WWWWWW。        
            W*WWWWWW::::@WWW:::::#WWWW        
            万维网@:::+*:. ::@WWWW        
            WWWWW@:*:.:: .,.:.:WWWW        
            @WWWW#:.::::. .:: #:@WWW        
            ：万维网@：＃。:: :WWWW:@WWWW        
             万维网#*:W@*@W 。:#WWW        
            #WWWW:@ :: :: *WWWW        
            W@WW*W .::,.::::,:+ @@WW#,       
            WWWW## ,,.: .:::.: . 。万维网：，       
            @WWW@: W..::::: #. :万维网        
             万维网:: *..:. ::.,. :万维网        
             WWWW:::.:.::::,@WW@        
             万维网: .:, : ,, :WW,        
             .: # : , : *         
              W + ., ::: ., : @         
              W :: .: W         
           @,,,W:。,, ::*@*:, . :@W.,,@      
         +.....*: : : .#WWWWW: : .#:....+,    
        @...:::*:,, ::WWWWWWW, , *::::..,#   
      :...::::::W:, @W::::*W。:W:::::...#  
     @@@@@@@@@@@W@@@@@W@@@@@@W@@@@@W@@@@@@@@@@：

```

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-12-27T16:04:00.150

大图级别的概念很简单：

1.  每个可打印字符都可以分配一个近似的灰度值；例如，“at”符号`@`显然比“plus”符号在视觉上更暗`+`。效果会有所不同，具体取决于实际使用的字体和间距。

2.  根据所选字体的比例，将输入图像分组为具有恒定宽度和高度的矩形像素块（例如，4 像素宽和 5 像素高的矩形）。每个这样的块将成为输出中的一个字符。（使用刚才提到的像素块，一张 240w-x-320h 的图像将变成 64 行，每行 60 个字符。）

3.  计算每个像素块的平均灰度值。

4.  对于每个像素块，选择一个字符，其灰度值（来自步骤 1）是像素块平均值（来自步骤 3）的良好近似值。

这是最简单的练习形式。更复杂的版本在打破像素块候选者之间的联系时也会考虑字符的实际*形状。*例如，对于看起来具有从左下角到右上角对比度特征的像素块， “斜线”( `/`) 比“反斜线” ( ) 是更好的选择。`\`

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-27T11:05:57.897

[aalib](http://aa-project.sourceforge.net/aalib/)（最后一次发布于 2001 年）是一个开源 ASCII 艺术库，用于 mplayer 等应用程序。您可能想查看它的源代码以了解它是如何工作的。除此之外，[本页](http://www.jave.de/image2ascii/algorithms.html)更详细地描述了此类算法的工作原理。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-27T12:04:03.177

您还可以查看[`libcaca`](http://caca.zoy.org/wiki/libcaca)（2014 年最新版本），根据他们的网站，它有以下改进`aalib`：

*   Unicode 支持
*   2048 种可用颜色（某些设备只能处理 16 种）
*   彩色图像的抖动
*   高级文本画布操作（位图、旋转）

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-27T16:00:43.183

我发现[Daniel Fisher 写的这篇 CodeProject 文章](http://www.codeproject.com/KB/web-image/ascii_art_with_c_.aspx)包含一个简单的**C# 实现**的图像到 ASCII 艺术转换算法。

这些是程序/库执行的步骤：

1.  将图像流加载到位图对象
2.  使用 Graphics 对象对位图进行灰度化
3.  循环遍历图像的像素（因为我们不希望每个像素有一个 ASCII 字符，我们每 10 x 5 取一个）
4.  为了让每个像素影响生成的 ASCII 字符，我们循环它们并计算当前 10 x 5 块的亮度。
5.  最后，根据计算的数量为当前块附加不同的 ASCII 字符。

很容易，不是吗？

顺便说一句：在文章的评论中，我发现了这个**很酷的 AJAX 实现**：[Gaia Ajax ASCII Art Generator](http://ajaxwidgets.com/Ascii-Art/AsciiArt.aspx)：

> [...] 我觉得有必要证明它可以在一组标准化的网络技术中轻松完成。我开始寻找是否可以找到一些库来使用，我找到了 Sau Fan Lee 的 codeproject 文章，其中介绍了他的 ASCII fying .NET 库。

PS：卢卡斯（见评论）找到另[一篇 CodeProject 文章](http://www.codeproject.com/KB/recipes/ASCII_Imager.aspx)。

# c# - 在表单之间传递数据

> ID：394889
> 
> 赞同：0
> 
> 时间：2008-12-27T10:50:04.560
> 
> 标签：c#, winforms

我有以下场景，我有一个主窗体作为 MDI 父窗体和 MDI 子窗体，子窗体显示一个新窗体（我称之为 mydialog）。我想从 mydialog 访问 MDI 子表单中的特定功能，所以我尝试在 mydialog 对象中设置 Owner 属性，但发生异常（循环引用异常），而且 mydialog 表单的 Parent 和 ParentForm 属性为空，我做了一个快速和使用 mydialog 的 Tag 属性的脏解决方案。我正在寻找更好的解决方案以及为什么在设置 mydialog 的 Owner 属性时出现异常

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T11:25:50.650

> > 所以我尝试在 mydialog 对象中设置 Owner 属性但发生异常（循环引用异常）

设置 Owner 属性时应该没有例外。你能粘贴异常吗？您还可以粘贴设置此值的代码吗？您是否设置了其他属性，例如 MDIParent / 等？

编辑：代码更新

尝试以下，它应该工作

```
groupsettingsform mydialog= new groupsettingsform(); //create dialog 
mydialog.Owner= this; //set owner MDI child form 
mydialog.ShowDialog(); // <== DO NOT PASS THE OWNER 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T10:54:43.880

您能否向我们展示您用于显示对话框的代码，其中一个 ShowDialog 方法将父对象作为参数，它可以执行您正在寻找的操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T10:57:20.193

您可以在 MyDialog 中创建一个参数化构造函数

```
public MyDialog(object param1) 
```

将您的数据传递为

```
MyDialog frm = new MyDialog("data");
frm.ShowDialog(); 
```

或在 MyDialog 中创建一个公共属性

```
public object Data {get; set;} 
```

并在实例化对话框时设置它

MyDialog frm = new MyDialog(); frm.Data = "你的数据在这里"; frm.ShowDialog();

高温下，

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T11:58:26.217

设置所有者不应该抛出异常......在你的 MyDialog 表单中试试这个

```
((YourMDIChildForm)Owner).YourMDIChildFormMethod(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T13:41:51.203

到目前为止，我的简单答案是使用 Tag 属性，但我认为有更好的方法

groupsettingsform mydialog = new groupsettingsform(); mydialog.Tag=这个；mydialog.ShowDialog(this);

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-27T13:59:57.953

我更喜欢通过其构造函数将任何自定义数据或参数传递给 Form。这是最不特定于“WinForms”的方式，实际上与构建几乎任何其他对象没有什么不同。

在其他情况下，我喜欢在表单上设置属性。这似乎也是一个 WinForms 约定。

这比使用标签或从所有者“拉”数据要好。由于这两者都需要显式转换，因此并不是特别优雅。

# delphi - Delphi 中的 CD 翻录

> ID：394891
> 
> 赞同：2
> 
> 时间：2008-12-27T10:55:12.380
> 
> 标签：delphi, cd

有没有如何在delphi中翻录音频CD的例子？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T15:21:35.383

商业 ActiveX，150 美元： [CD 提取器控制](http://www.streamware-dev.com/products.html#extractor)

DLL，免费软件，50 欧元用于共享软件： [Bass CD Ripper](http://www.3delite.hu/Object%20Pascal%20Developer%20Resources/basscdripperlibrary.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T11:14:36.867

如果您只需要完成任务，那么您可以考虑运行现有的命令行工具来执行 CD 翻录（即从您的 delphi 代码中生成此任务）

# asp.net - ASP.NET 配置工具在带有特殊字符的文件夹中不起作用

> ID：394894
> 
> 赞同：1
> 
> 时间：2008-12-27T10:58:52.670
> 
> 标签：asp.net, configuration

看来我刚刚解决了为什么我不能在 VS2008 中使用 ASP.NET 配置工具的问题。当 aps.net 解决方案位于包含特殊字符（例如空格）的文件夹中时，此工具似乎不起作用。事实上，我自己并没有发现这一点。我在各种论坛上找到了它。

令我困惑的是，我的 VS2008 将新项目（包括 Web 项目）放入我的文档文件夹中，该文件夹在根目录的深处以 Documents And Settings\[User]\Documents 开头（至少在 XP 上）。我在这里遗漏了什么还是默认设置真的使使用 ASP.NET 配置工具无法使用？

感谢您的反馈

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-27T18:06:18.437

我已经很少使用 ASP.Net 配置工具了（它所做的只是修改你的 web.config），而且很多事情都可以解决它，但是......

我的大多数项目在某些时候在路径中都有空格，我从来没有遇到过这部分的任何问题。

我的建议是弄清楚你想要做什么，并学习如何直接在 web.config 中进行更改。（我在写这篇文章时能听到降级的声音）

# python - Python 线程 stack_size 和 segfaults

> ID：394895
> 
> 赞同：2
> 
> 时间：2008-12-27T11:03:00.850
> 
> 标签：python, multithreading, segmentation-fault, stack-size

一个网络爬虫脚本，最多产生 500 个线程，每个线程基本上请求从远程服务器提供的某些数据，每个服务器的回复在内容和大小上都与其他服务器不同。

我将 stack_size 设置为线程的 756K

```
threading.stack_size(756*1024) 
```

这使我能够拥有足够数量的所需线程并完成大部分工作和请求。但是由于某些服务器的响应比其他服务器大，并且当一个线程获得这种响应时，脚本会因 SIGSEGV 而死。

stack_sizes 超过 756K 使得不可能同时拥有所需数量的线程。

关于如何在不崩溃的情况下继续使用给定的 stack_size 的任何建议？以及如何获取任何给定线程的当前使用的 stack_size？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-27T11:28:29.317

**你到底为什么**要产生 500 个线程？这似乎是一个可怕的主意！

完全删除线程，使用事件循环进行爬取。您的程序将更快、更简单且更易于维护。

大量等待网络的线程不会让你的程序*等待得更快*。相反，将所有打开的套接字收集在一个列表中并运行一个循环，检查其中是否有任何可用的数据。

我推荐使用[Twisted](http://twistedmatrix.com) - 它是一个事件驱动的网络引擎。它非常灵活、安全、可扩展且非常稳定（无段错误）。

你也可以看看[Scrapy——](http://scrapy.org/)它是一个用 Python/Twisted 编写的网络抓取和屏幕抓取框架。它仍在大力开发中，但也许您可以提出一些想法。

# .net - .NET 中的双重检查锁定

> ID：394898
> 
> 赞同：58
> 
> 时间：2008-12-27T11:05:42.470
> 
> 标签：.net, multithreading, paradigms, double-checked-locking

我看到[这篇](http://www.cs.umd.edu/%7Epugh/java/memoryModel/DoubleCheckedLocking.html)文章讨论了为什么 Java 中的双重检查锁定范式被破坏了。如果声明了变量，范式是否适用于 .NET（特别是 C#）`volatile`？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-12-27T11:47:35.520

双重检查锁定现在可以在 Java 和 C# 中使用（Java 内存模型发生了变化，这是效果之一）。但是，您必须*完全*正确。如果你把事情弄得一团糟，你很可能最终会失去线程安全性。

正如其他答案所述，如果您正在实现[单例模式](http://pobox.com/%7Eskeet/csharp/singleton.html)，那么有更好的方法可以做到这一点。就个人而言，如果我必须在自己实施双重检查锁定和“每次都锁定”代码之间进行选择，我会每次都进行锁定，直到我得到真正的证据表明它会导致瓶颈。在线程方面，一个简单且明显正确的模式很有价值。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2010-05-25T23:46:37.560

.NET 4.0 有一种新类型：`Lazy<T>`消除了对模式错误的任何担忧。它是新任务并行库的一部分。

请参阅 MSDN 并行计算开发中心：http: [//msdn.microsoft.com/en-us/concurrency/default.aspx](http://msdn.microsoft.com/en-us/concurrency/default.aspx)

[顺便说一句，这里](http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx)有一个适用于 .NET 3.5 SP1 的后向端口（我相信它不受支持）。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-27T11:21:12.670

[在 C# 中实现单例模式在](https://csharpindepth.com/Articles/Singleton#dcl)第三个版本中谈到了这个问题。

它说：

> 使实例变量 volatile 可以使其工作，就像显式内存屏障调用一样，尽管在后一种情况下，即使专家也无法确切地同意需要哪些屏障。我倾向于避免专家不同意什么是对什么是错的情况！

作者似乎暗示双重锁定比其他策略不太可能起作用，因此不应使用。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-27T11:32:27.093

请注意，与在 Java 中（最有可能在 .Net 中也是如此）相比，单例初始化的双重检查锁定是完全没有必要的，而且会被破坏。由于类在第一次使用之前不会被初始化，因此所需的延迟初始化已经通过此实现；

```
private static Singleton instance = new Singleton(); 
```

除非您的 Singleton 类包含可以在首次使用 Singleton 实例之前访问的常量之类的东西，否则您需要做的就是这些。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-05-27T15:38:29.313

> 我已经通过使用布尔值（即使用原语来避免延迟初始化）进行了双重检查锁定：

使用布尔值的单例不起作用。除非您通过内存屏障，否则无法保证在不同线程之间看到的操作顺序。换句话说，从第二个线程看， `created = true`可能在执行之前`instance= new Singleton();`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-04-13T20:05:58.860

我不明白为什么所有人都说双重检查锁定是不好的模式，但不要调整代码以使其正常工作。在我看来，下面的代码应该可以正常工作。

如果有人能告诉我这段代码是否存在卡梅伦文章中提到的问题，请告诉我。

```
public sealed class Singleton {
    static Singleton instance = null;
    static readonly object padlock = new object();

    Singleton() {
    }

    public static Singleton Instance {
        get {
            if (instance != null) {
                return instance;
            }

            lock (padlock) {
                if (instance != null) {
                    return instance;
                }

                tempInstance = new Singleton();

                // initialize the object with data

                instance = tempInstance;
            }
            return instance;
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-06-13T01:36:59.540

我不太明白为什么有一堆关于双重检查锁定的实现模式（显然是为了解决各种语言的编译器特性）。关于这个主题的 Wikipedia 文章显示了解决问题的简单方法和可能的方法，但没有一个像这样简单（在 C# 中）：

```
public class Foo
{
  static Foo _singleton = null;
  static object _singletonLock = new object();

  public static Foo Singleton
  {
    get
    {
      if ( _singleton == null )
        lock ( _singletonLock )
          if ( _singleton == null )
          {
            Foo foo = new Foo();

            // Do possibly lengthy initialization,
            // but make sure the initialization
            // chain doesn't invoke Foo.Singleton.
            foo.Initialize();

            // _singleton remains null until
            // object construction is done.
            _singleton = foo;
          }
      return _singleton;
    }
  } 
```

在 Java 中，您将使用 synchronized() 而不是 lock()，但它基本上是相同的想法。如果在分配单例字段时可能存在不一致，那么为什么不先使用本地范围的变量，然后在退出临界区之前的最后一刻分配单例字段呢？我错过了什么吗？

@michael-borgwardt 的论点是，在 C# 和 Java 中，静态字段仅在首次使用时初始化一次，但**这种**行为是特定于语言的。我经常使用这种模式来延迟初始化集合属性（例如 user.Sessions）。

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2011-02-28T17:23:02.060

我已经通过使用布尔值（即使用原语来避免延迟初始化）进行了双重检查锁定：

```
private static Singleton instance;
private static boolean created;
public static Singleton getInstance() {
    if (!created) {
        synchronized (Singleton.class) {
            if (!created) {
                instance = new Singleton();
                created = true;
            }
        }
    }
    return instance;
} 
```

# c++ - 如何编写线程安全的自动化测试

> ID：394900
> 
> 赞同：10
> 
> 时间：2008-12-27T11:07:43.057
> 
> 标签：c++, multithreading, unit-testing, testing

我有一个不是线程安全的类：

```
class Foo { 
    /* Abstract base class, code which is not thread safe */ 
}; 
```

此外，如果你有 foo1 和 foo2 对象，你不能调用 foo1->someFunc() 直到 foo2->anotherFunc() 返回（这可能发生在两个线程上）。这就是这种情况，并且无法更改（Foo 子类实际上是 python 脚本的包装器）。

为了防止不需要的电话，我创建了以下内容 -

```
class FooWrapper {
public:
    FooWrapper(Foo* foo, FooWrappersMutex* mutex);
    /* Wrapped functions from Foo */
}; 
```

在内部，FooWrapper 使用共享互斥体包装对 Foo 函数的调用。

我想测试 FooWrapper 的线程安全性。我最大的问题是线程由操作系统管理，这意味着我对其执行的控制较少。我想测试的是以下场景：

*   线程 1 在函数内部调用 fooWrapper1->someFunc() 并阻塞
*   线程 2 调用 fooWrapper2->anotherFunc() 并立即返回（因为 someFunc() 仍在执行）
*   线程 1 完成执行

自动测试这样的场景最简单的方法是什么？

我在 Win32 上使用 QT，尽管我更喜欢至少像 QT 那样跨平台的解决方案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-27T12:07:09.443

您可能需要查看CHESS： Microsoft Research[*的并发软件系统测试工具。*](http://Research.Microsoft.Com/CHESS/)它是用于多线程程序（.NET 和本机代码）的测试框架。

如果我理解正确的话，它会用自己的替换操作系统的线程库，这样它就可以控制线程切换。然后它分析程序以找出线程的执行流可以交错的所有可能方式，并为每个可能的交错重新运行测试套件。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-27T14:08:39.043

与其仅仅检查特定线程是否完成，不如创建一个假`Foo`的以供您的包装器调用，其中函数记录它们实际启动/完成的时间。然后你的 yield 线程只需要等待足够长的时间就可以区分记录时间之间的差异。在您的测试中，您可以断言`another_func`' 开始时间在`some_func`' 开始时间之后，并且它的完成时间在`some_func`s 完成时间之前。由于您的假类仅记录时间，因此这足以保证包装类正常工作。

**编辑**：当然，您知道您的`Foo`对象所做的可能是一种[反模式](http://en.wikipedia.org/wiki/Anti-pattern)，即[Sequential Coupling](http://en.wikipedia.org/wiki/Sequential_coupling)。根据它的作用，如果第一个方法尚未被调用，您可以通过简单地让第二个方法不执行任何操作来处理它。使用 Sequential Coupling 链接中的示例，这类似于如果汽车尚未启动，则踩下油门踏板时汽车什么也不做。如果什么都不做不合适，您可以等待并稍后再试，在当前线程中启动“启动序列”，或者将其作为错误处理。所有这些事情都可以由您的包装器强制执行，并且可能更容易测试。

如果需要对另一个方法的干预调用，您可能还需要小心确保不会按顺序调用相同的方法两次。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-27T17:45:05.157

[英特尔线程检查器](http://software.intel.com/en-us/articles/intel-thread-checker-documentation)。

如果我没记错的话，该工具会检查您的代码是否存在理论上可能的数据竞争。关键是您不需要运行代码来检查它是否正确。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-27T15:10:26.577

当您开始多线程时，根据定义，您的代码变得不确定，因此在一般情况下，测试线程安全是不可能的。

但是对于您非常具体的问题，如果您在 Foo 中插入长时间延迟以导致每个 Foo 方法花费一个 looonnng 时间，那么您可以按照您的要求做。也就是说，在第二个线程进入调用之前，第一个线程返回的概率基本上为零。

但你真正想要完成的是什么？这个测试应该测试什么？如果您尝试验证 FooWrappersMutex 类是否正常工作，则不会这样做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T11:09:14.740

到目前为止，我已经编写了以下代码。有时它有效，有时测试失败，因为睡眠不足以运行所有线程。

```
//! Give some time to the other threads
static void YieldThread()
{
#ifdef _WIN32
    Sleep(10);
#endif //_WIN32
}

class FooWithMutex: public Foo {
public:
    QMutex m_mutex;
    virtual void someFunc()
    {
        QMutexLocker(&m_mutex);
    }
    virtual void anotherFunc()
    {
        QMutexLocker(&m_mutex);
    }
};

class ThreadThatCallsFooFunc1: public QThread {
public:
    ThreadThatCallsFooFunc1( FooWrapper& fooWrapper )
        : m_fooWrapper(fooWrapper) {}

    virtual void run()
    {
        m_fooWrapper.someFunc();
    }
private:
    FooWrapper& m_fooWrapper;
};

class ThreadThatCallsFooFunc2: public QThread {
public:
    ThreadThatCallsFooFunc2( FooWrapper& fooWrapper )
        : m_fooWrapper(fooWrapper) {}

    virtual void run()
    {
        m_fooWrapper.anotherFunc();
    }
private:
    FooWrapper& m_fooWrapper;
};

TEST(ScriptPluginWrapperTest, CallsFromMultipleThreads)
{
    // FooWithMutex inherits the abstract Foo and adds
    // mutex lock/unlock on each function.
    FooWithMutex fooWithMutex;

    FooWrapper fooWrapper( &fooWithMutex );
    ThreadThatCallsFooFunc1 thread1(fooWrapper);
    ThreadThatCallsFooFunc2 thread2(fooWrapper);

    fooWithMutex.m_mutex.lock();
    thread1.start(); // Should block

    YieldThread();
    ASSERT_FALSE( thread1.isFinished() );

    thread2.start(); // Should finish immediately
    YieldThread();
    ASSERT_TRUE( thread2.isFinished() );

    fooWithMutex.m_mutex.unlock();

    YieldThread();
    EXPECT_TRUE( thread1.isFinished() );
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-22T21:38:05.197

金克斯来救援

[http://www.corensic.com/](http://www.corensic.com/)

# windows - 如何确定某个键是否被按下，只知道它在美国键盘上的位置？

> ID：394902
> 
> 赞同：3
> 
> 时间：2008-12-27T11:08:36.037
> 
> 标签：windows, keyboard

考虑到，对于 Windows 视频游戏，我需要确定在美式英语键盘布局上生成 ` 和 ~ 字符的键（通常位于 Escape 键下方并左至 1）是否已被按下。这听起来像是一个微不足道的问题，但对我来说似乎不是一个问题。

当 Windows 发送键盘消息时，它会指定虚拟键代码和 OEM 扫描代码。我们不能依赖 OEM 扫描码，因为“值取决于 OEM”——我们也不能依赖虚拟键码，因为它依赖于当前活动的键盘布局。

我们目前的“解决方案”是使用`LoadKeyboardLayout`并`MapVirtualKeyEx`找到在美国英语键盘布局上生成`字符的键的OEM扫描码，然后只听那个OEM扫描码。问题是如果用户没有安装美国英语布局，这将不起作用。

有没有真正的方法可以在 Windows 上做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-27T11:19:23.300

OEM 扫描码不会因键盘而异。没有理由不使用它。

早在 DOS 时代，相同的扫描码已用于游戏，因为它是检测按键向上和按键向下事件的唯一方法。没有人对它有任何问题，我怀疑它将来会改变。

如果你想要另一个选项，你可能想试试 DirectInput-API。它还为您提供原始扫描码，如果我没记错的话，您还可以查询每个键的物理位置、尺寸等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T11:20:02.877

将游戏动作与角色联系起来，而不是钥匙的位置。否则，你如何告诉用户按下哪个键？“在转义键下”？他们可能没有任何东西，但如果你告诉他们“^ 键”，他们可以寻找它。

您可能还希望使其可配置以适应异国情调的键盘布局和用户偏好。

# networking - 包数据结构？

> ID：394908
> 
> 赞同：4
> 
> 时间：2008-12-27T11:20:26.837
> 
> 标签：networking, packet

我正在设计一个游戏服务器，我以前从未做过这样的事情。我只是想知道数据包的好结构是什么？如果重要的话，我正在使用 TCP。这是一个示例，以及我目前正在考虑使用的示例：

（括号中的每个值都是一个字节）

```
[Packet length][Action ID][Number of Parameters]
[Parameter 1 data length as int][Parameter 1 data type][Parameter 1 data (multi byte)]
[Parameter 2 data length as int][Parameter 2 data type][Parameter 2 data (multi byte)]
[Parameter n data length as int][Parameter n data type][Parameter n data (multi byte)] 
```

就像我说的那样，我以前真的从来没有做过这样的事情，所以我上面所说的可能是完全的公牛，这就是我问的原因;)。此外，是否有必要传递总数据包长度？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T11:37:42.373

传递总数据包长度是个好主意。它可能会多花两个字节，但您可以窥视并等待套接字在接收之前准备好完整的数据包。这使代码更容易。

总的来说，我同意 brazzy 的观点，一种语言提供的序列化机制比任何自制的更可取。

除此之外（我认为您使用的是没有序列化的 C-ish 语言），我会将数据包 ID 作为数据包数据结构上的第一个数据。恕我直言，这是某种约定，因为结构的第一个数据成员始终位于位置 0，并且任何结构都可以向下转换为该位置，从而识别其他匿名数据。

您的编译器可能会或可能不会生成打包结构，但这样您就可以分配缓冲区，读取数据包，然后根据第一个数据成员转换结构。如果你不走运并且它不产生压缩结构，请确保每个结构都有一个序列化方法，它将从（显然是非目标）内存构造。

Endiannes 是一个因素，尤其是在类 C 语言中。请务必明确数据包始终具有相同的字节序，或者您可以根据签名或其他内容识别不同的字节序。一件非常酷的奇怪事情：当您使用本文中讨论的方法访问它们时，C# 和 .NET 似乎总是以 little-endian 约定保存数据。在将这样的应用程序移植到 SUN 上的 Mono 时发现了这一点。很酷，但是如果你有那个设置，你应该使用 C# 的序列化方法。

除此之外，您的设置看起来非常好！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-27T12:46:26.633

首先考虑一个更简单的基本包装器：标签、长度、值（TLV）。您的基本数据包将如下所示：

```
[Tag] [Length] [Value] 
```

**Tag**是数据包标识符（如您的操作 ID）。

**长度**是数据包长度。您可能需要它来判断您是否拥有完整的数据包。它还可以让您计算出价值部分的长度。

**值**包含实际数据。这个格式可以是任何东西。

在上述情况下，值数据包含进一步的一系列 TLV 结构（参数类型、长度、值）。您实际上不需要发送参数的数量，因为您可以根据数据长度和遍历数据来处理它。

正如其他人所说，我会将数据包ID（标签）放在第一位。除非您有跨平台问题，否则我会考虑将应用程序的序列化对象包装在 TLV 中，然后像这样通过网络发送它。如果您出错或想稍后更改，您始终可以创建具有不同结构的新标签。

[有关TLV](http://en.wikipedia.org/wiki/Type-length-value)的更多详细信息，请参阅 Wikipedia 。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-27T13:38:58.150

为避免重新发明轮子，任何序列化协议都适用于有线数据（例如 XML、JSON），您可能会考虑将[BEEP](http://beepcore.org/)视为基本协议框架。

BEEP 在其常见问题解答文档中得到了很好的总结，它是*自 80 年代初以来经验丰富的应用程序协议设计人员使用的技巧的“最佳热门”专辑。*'

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-27T11:44:42.903

没有理由做这么复杂的事情。我看到您有一个操作 ID，所以我想会有固定数量的操作。

对于每个操作，您将定义一个数据结构，然后将这些值中的每一个放入该结构中。要通过网络发送它，您只需为结构中的每个元素分配 sum(sizeof(struct.i)) 字节。所以你的数据包看起来像这样：

```
[action ID][item 1 (sizeof(item 1 bytes)][item 1 (sizeof(item 2 bytes)]...[item n (sizeof(item n bytes)] 
```

这个想法是，您已经知道连接每一侧的每个变量的大小和类型，因此您不需要发送该信息。

对于字符串，您可以将它们以空终止的形式放入，然后当您“知道”根据您的数据包类型查找字符串时，开始读取并查找空值。

--

另一种选择是使用 '\r\n' 来描述你的变量。这将需要一些开销，并且您必须使用文本，而不是数字的二进制值。但是这样你就可以使用 readline 来读取每个变量。你的数据包看起来像这样

```
[action ID]
[item 1 (as text)]
...
[item n (as text)] 
```

--

最后，简单地序列化对象并将它们传递到网络中也是一种很好的方法，而且要编写的代码量最少。请记住，您不想过早地进行优化，这也包括网络流量。如果事实证明您需要稍后挤出更多性能，您可以返回并找出更有效的机制。

并查看 google 的[协议缓冲区](http://code.google.com/p/protobuf/)，它被认为是一种以平台无关的方式序列化数据的极快方式，有点像二进制 XML，但没有嵌套元素。还有[JSON](http://www.json.org/)，这是另一种平台中性编码。使用协议缓冲区或 JSON 意味着您不必担心如何专门对消息进行编码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T11:26:50.023

您希望服务器支持用不同语言编写的多个客户端吗？如果不是，则可能没有必要准确指定结构；而是使用您的语言提供的任何工具来序列化数据，只是为了减少出错的可能性。

如果您确实需要结构是可移植的，那么上面看起来还可以，尽管在这种情况下您也应该指定字节顺序和文本编码等内容。

# c# - 在表达式树中调用实例方法的最佳方法？

> ID：394911
> 
> 赞同：5
> 
> 时间：2008-12-27T11:22:32.917
> 
> 标签：c#, linq, expression-trees

在表达式树中调用实例方法的最佳方式是什么？对于接口 IColumn 的接口方法“object GetRowValue(rowIndex)”，我当前的解决方案是这样的。

```
public static Expression CreateGetRowValueExpression(
    IColumn column, 
    ParameterExpression rowIndex)
        {
            MethodInfo methodInfo = column.GetType().GetMethod(
                "GetRowValue",
                BindingFlags.Instance | BindingFlags.Public,
                null,
                CallingConventions.Any,
                new[] { typeof(int) },
                null);
            var instance = Expression.Constant(column);
            return Expression.Call(instance, methodInfo, rowIndex);            
        } 
```

有更快的方法吗？是否可以创建表达式而不必将方法名称作为字符串传递（不利于重构）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-27T11:32:03.553

您可以使用辅助方法来做到这一点：

```
MethodCallExpression GetCallExpression<T>(Expression<Func<T>> e)
{
    return e.Body as MethodCallExpression;
}

/* ... */
var getRowValExpr = GetCallExpression(x => x.GetRowValue(0)); 
```

# c# - .Net 中是否可以仅从客户端程序集的调试版本中调用某些代码？

> ID：394921
> 
> 赞同：1
> 
> 时间：2008-12-27T11:36:31.890
> 
> 标签：c#, build, debugging, release, conditional-compilation

我正在编写一个（非常小的）框架来检查方法的前置条件和后置条件。入口点是（它们很容易成为方法；没关系）：

```
public static class Ensures {
    public static Validation That {
        get { ... }
    }
}

public static class Requires {
    public static Validation That {
        get { ... }
    }
} 
```

显然，当方法没有问题时，检查后置条件可能会很昂贵，而且实际上并不是必需的。所以我想要一个像这样工作的方法：

```
public static class Ensures {
    [ConditionalCallingCode("DEBUG")]
    public static Validation ThatDuringDebug {
        get { ... }
    }
} 
```

where`ConditionalCallingCodeAttribute`意味着这个方法应该只在调用代码用定义的 DEBUG 符号编译时运行。这可能吗？

我希望客户端代码如下所示：

```
public class Foo {
    public void Bar() {
        ... // do some work
        Ensures.That // do these checks always
            .IsNotNull(result)
            .IsInRange(result, 0, 100);

        Ensures.WhileDebuggingThat // only do these checks in debug mode
            .IsPositive(ExpensiveCalculation(result));

        return result;
    }
} 
```

当然，我可以不提供WhileDebuggingThat。然后客户端代码将如下所示：

```
public class Foo {
    public void Bar() {
        ... // do some work
        Ensures.That // do these checks always
            .IsNotNull(result)
            .IsInRange(result, 0, 100);

        #ifdef DEBUG
        Ensures.That // only do these checks in debug mode
            .IsPositive(ExpensiveCalculation(result));
        #endif

        return result;
    }
} 
```

如果没有其他办法，这是后备计划，但它非常严重地破坏了 DRY。

据我了解，标记`WhileDebuggingThat`with`[Conditional("DEBUG")]`将发出（或不发出）此方法，具体取决于在库编译期间是否定义了 DEBUG，*而不是*引用该库的程序集。所以我*可以*这样做，然后编写文档告诉库用户将其代码的调试版本与库的调试版本链接起来，并将发布版本与发布版本联系起来。这对我来说并不是最好的解决方案。

最后，我可以告诉图书馆用户在他们的项目中定义这个类：

```
using ValidationLibrary;
public static class EnsuresWhileDebugging {
    [Conditional("DEBUG")]
    public static Validation That() {
        return Ensures.That;
    }
} 
```

据我所知，这应该也可以，但仍然需要打破 DRY 原则，即使只是轻微的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T11:43:06.403

除了处理属性而不是方法之外，这是普通[ConditionalAttribute](http://msdn.microsoft.com/en-us/library/system.diagnostics.conditionalattribute.aspx)不能为您做的任何事情吗？您可能需要更改调用方式，以便获得方法而不是属性 - 它返回值的事实可能会导致问题。

如果你能展示你的框架是如何使用的，那将会很有帮助——目前我们还没有很多工作要做。

要考虑的另一件事是提供库的各种二进制版本 - 这样调用者就可以提供实际上不进行任何检查的不同版本。但是，仅凭您提供的代码很难分辨。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-28T13:11:12.310

在这里找到的任何解决方案都会比实际检查慢。此外，由于它不会像 一样内置到编译器`ConditionalAttribute`中，因此仍会计算参数。如果后置条件可能非常复杂，例如

```
Ensures.That.IsPositive(ExpensiveCalculation(result)); 
```

您可能会考虑使用 icelava 的建议来反映调用程序集以查找它是在调试还是发布中构建的 - 但是您*必须*使用某种委托来延迟计算 - 以确保仅在需要时完成。例如：

```
Ensures.WhileDebugging.That. IsPositive(() => ExpensiveCalculation(result)); 
```

IsPositive 函数应该运行 lambda 并检查它的结果，只有在反射之后才能确定是否应该计算它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T12:43:19.540

我没有试过这个，因为我要洗澡离开家。

1.  调用 Assembly.GetCallingAssembly() 以获取调用当前执行方法的方法（类）来自的程序集。
2.  [对该 Assembly 对象运行检查以查看它是 Release 还是 Debug build](http://www.hanselman.com/blog/HowToProgrammaticallyDetectIfAnAssemblyIsCompiledInDebugOrReleaseMode.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T15:17:00.153

听起来您正在做的大部分事情已经使用`Debug.Assert()`.

就此而言，这段代码只会在调试模式下运行（但你必须忍受 catch-block 的缓慢）：

```
try
{
     Debug.Assert(false);
}
catch (Exception e)
{
     // will only and always run in debug mode

} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T12:16:54.663

看来我想要的只是不可用。我可能会满足于提供从`Validation`to的隐式转换`bool`，以便验证检查可以包含在`Debug.Assert()`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T02:10:39.707

即使在程序编译后，也可以使用 bool 设置/更改 Debug Assert 方法，例如，如果该值来自项目用户设置：

```
Debug.Assert(!Properties.Settings.Default.UseAutoDebug); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T19:27:57.447

我不确定，但我认为您可以为此使用 ConditionalAttribute：是否发出调用将取决于用户构建的类型，而不是您的库。您可以使用 Reflector 或 ILDasm 进行检查：编译您的示例并在 Reflector (ILDasm) 中查看示例项目中是否发出了调用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-16T07:12:49.520

我发生了这种情况：项目 A 调用 B 的 1 函数。B 包含此函数：Assembly.GetCallingAssembly().FullName 如果在模式调试时构建 B 然后运行，则此函数返回项目 A 的名称，如果在模式释放时构建而不是返回名称项目 B。我不知道发生这种情况的原因。请支持我谢谢

# linux - Flex：编译器如何知道依赖关系？

> ID：394940
> 
> 赞同：0
> 
> 时间：2008-12-27T12:06:42.050
> 
> 标签：linux, apache-flex, mxml, mate

我对 Flex 完全陌生，只是在玩 Mate 框架中的示例应用程序。我在 Linux 上进行黑客攻击，所以我使用的是命令提示符和文本编辑器，而不是 Flex Builder。

示例应用程序在其根目录 lib 和 src 中有两个文件夹。Lib 包含一个依赖项。如何在 src 中编译 mxml 文件，以便编译器知道 lib 中的依赖关系？

目前我正在运行 $ mxmlc sampleApp/src/sampleApp.mxml

编译器抛出一个异常，表示无法解析为组件实现。我知道这个组件是 lib 文件夹中依赖项的一部分。所以它显然不会被自动拾取。

任何帮助，将不胜感激。

问候，

克里斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T12:29:55.357

您必须指定库的路径，这可以通过使用命令行参数或将其放入配置文件来完成。看：

[http://livedocs.adobe.com/flex/3/html/compilers_19.html#158337](http://livedocs.adobe.com/flex/3/html/compilers_19.html#158337)

# jquery - jQuery中的简单模态

> ID：394942
> 
> 赞同：2
> 
> 时间：2008-12-27T12:12:05.690
> 
> 标签：jquery, ajax, popup, simplemodal

我在 jQuery 中使用 SimpleModal，并且有一个确认对话框。如果结果是`Yes`，我必须调用`my.php`此对话框。但是，我已经完成了代码，我仍在寻找想法。我该怎么做？

```
$(document).ready(function () {
    $('#confirmDialog input.confirm, #confirmDialog a.confirm').click(function (e) {
        e.preventDefault();
        // Example of calling the confirm function.
        // You must use a callback function to perform the "yes" action.
        confirm("Continue", function () {
            alert("OK");
        });
    });
});

function confirm(message, callback) {
    $('#confirm').modal({
        close:false,
        position: ["20%",],
        overlayId:'confirmModalOverlay',
        containerId:'confirmModalContainer',
        onShow: function (dialog) {
            dialog.data.find('.message').append(message);

            // If the user clicks "yes"
            dialog.data.find('.yes').click(function () {
                $.get('my.php', function(data){
                    // Create a modal dialog with the data.
                    // Here: How do I write the same window?
                });

                // Call the callback

                // Close the dialog
                $.modal.close();
            });
        }
    });
} 
```

在这里，我遇到了如何从 Ajax 结果中将其写入同一个窗口 Confirmdialog 的问题。我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-28T16:43:02.083

我不确定确认功能是否最适合您的需求，但这样的事情应该可以工作：

```
function confirm(message, callback) {
    $('#confirm').modal({
        close:false,
        position: ["20%",],
        overlayId:'confirmModalOverlay',
        containerId:'confirmModalContainer',
        onShow: function (dialog) {
            dialog.data.find('.message').append(message);

            // If the user clicks "yes"
            dialog.data.find('.yes').click(function () {
                $.get("my.php", function (data) {
                    /* Sample response:
                     *   <div id="title">my title</div>
                     *   <div id="message">my message</div>
                     *
                     */
                    var resp = $("<div/>").append(data);
                    var title = resp.find("#title").html(),
                        message = resp.find("#message").html();

                    dialog.data.find(".header span").html(title);
                    dialog.data.find(".message").html(message);
                    dialog.data.find(".buttons .yes").hide();
                    dialog.data.find(".buttons .no").html("Close");

                    // No need to call the callback or $.modal.close()
                });
            });
        }
    });
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-27T12:56:20.780

我不确定您要完成什么——您是否尝试重用确认模式对话框来显示您的结果？我想你可以这样做，因为你在对话框上有一个“关闭 X”按钮，只需用你的结果替换消息的内容并删除按钮，这样你的回调就不会再次被触发。它可能看起来像这样：

```
 dialog.data.find('.message').html( 'new contents from your ajax data' );
 dialog,data.find('.buttons').remove(); 
```

但是，这对我来说似乎是对模态对话框的滥用。在我看来，对话框应该只包含与用户的单一交互。如果您需要根据初始对话框的结果进行进一步的交互，那么我会考虑添加另一个模式对话框，在当前对话框与 AJAX 结果一起关闭后弹出，或者将 AJAX 结果插入主界面并处理它那里。

# database - 版本化的 RDF 存储

> ID：394947
> 
> 赞同：15
> 
> 时间：2008-12-27T12:16:48.660
> 
> 标签：database, rdf, privacy, reification

*让我试着改写一下：*

我正在寻找具有以下功能的强大 RDF 存储或库：

*   **命名图**，或某种其他形式的具体化。
*   **版本跟踪**（可能在命名图级别）。
*   **用户组之间的隐私**，无论是命名图还是三重级别。
*   人类可读的数据输入和输出，例如**TriG**解析器和序列化器。

前段时间我和[Jena](http://jena.sourceforge.net/)、[Sesame](http://www.openrdf.org/)、[Boca](http://ibm-slrp.sourceforge.net/2006/11/20/boca-the-rdf-repository-component-of-the-ibm-semantic-layered-research-platform/)、[RDFLib](http://rdflib.net/)、[Redland](http://librdf.org/)和其他一两个人一起玩过，但每个人都有自己的问题。最近在上述方面有什么改善吗？其他任何事情都可以做我想做的事，还是 RDF 还没有准备好迎接黄金时段？

* * *

更多地阅读这个主题，我发现：

*   [耶拿](http://jena.sourceforge.net/)，没有别的了
*   [芝麻](http://www.openrdf.org/)，没有别的了
*   [Boca](http://ibm-slrp.sourceforge.net/2006/11/20/boca-the-rdf-repository-component-of-the-ibm-semantic-layered-research-platform/)似乎不再被维护，而且似乎只是真正为 DB2 设计的。**[OpenAnzo](http://www.openanzo.org/)是一个开源分支，看起来更有希望。**
*   [RDFLib](http://rdflib.net/)，仅此而已
*   [雷德兰](http://librdf.org/),没有别的了
*   [Talis 平台](http://www.talis.com/platform/)似乎支持变更集（[维基页面](http://n2.talis.com/wiki/ChangeSets)和*[Kniblet 教程第 5 部分](http://n2.talis.com/wiki/Kniblet_Tutorial_Part_5)*中的参考），但它是仅托管服务。不过还是可以调查一下。
*   [SemVersion](http://semweb4j.org/site/semversion/index.html)听起来很有希望，但似乎已经过时了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-04-16T07:17:48.067

来自：[http ://www.semanticoverflow.com/questions/453/how-to-implement-semantic-data-versioning/748#748](http://www.semanticoverflow.com/questions/453/how-to-implement-semantic-data-versioning/748#748)

* * *

我个人非常喜欢 Freebase 采用的务实方法。

为人类浏览和编辑视图：

*   http://www.freebase.com/view/guid/9202a8c04000641f80000000041ecebd
*   http://www.freebase.com/edit/topic/guid/9202a8c04000641f80000000041ecebd

此处公开的数据模型：

*   http://www.freebase.com/tools/explore/guid/9202a8c04000641f80000000041ecebd

严格来说，它不是 RDF（它可能是它的超集），但它的一部分可以暴露为 RDF：

*   http://rdf.freebase.com/rdf/guid.9202a8c04000641f80000000041ecebd

由于它是一个社区驱动的网站，他们不仅需要跟踪谁说了什么，什么时候……而且他们可能还会保留历史记录（从不删除任何内容）：

*   http://www.freebase.com/history/view/guid/9202a8c04000641f80000000041ecebd

总而言之，我解决您问题的方式非常相似且务实。AFAIK，您将找不到开箱即用的解决方案。但是，您可以使用“元组”存储（3 或 4 不足以将历史记录保持在最精细的粒度（即三元组|四元组））。

我会将 TDB 代码用作库（因为它为您提供了 B+Trees 和许多您需要的有用的东西）并且我将使用一个数据模型，它允许我：计算四边形、为四边形分配所有权、时间戳和上一个/下一个四边形（如果有）：

```
[ id | g | s | p | o | user | timestamp | prev | next ] 
```

在哪里：

```
 id - long (unique identifier, same (g,s,p,o) will have different id... 
        a lot of space, but you can count quads... and when you have a 
        community driven website (like this one) counting things it's 
        important.
    g - URI (or blank node?|absent (i.e. default graph))
    s - URI|blank node
    p - URI
    o - URI|blank node|literal
 user - URI 
```

时间戳 - 创建四边形的时间 prev - 前一个四边形的 ID（如果存在） next - 下一个四边形的 ID（如果存在）

然后，您需要考虑需要哪些索引，这取决于您想要公开和访问数据的方式。

您不需要向外部用户/人员/应用程序公开所有内部结构/索引。并且，当（如果）出现用于表示版本控制等的 RDF 词汇表或本体时，您可以使用它们快速公开您的数据（如果您愿意的话）。

请注意，这*不是*常见的做法，如果你用你的“语义网络眼镜”看它，它可能是错误的、不好的等等。但是，我正在分享这个想法，因为我相信它没有害处，它可以提供一个解决方案对于您的问题（它会比四元存储更慢并且使用更多空间），其中一部分可以作为 RDF / LinkedData 暴露给语义网络。

我的 2（异端）美分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-08T18:24:16.730

达丽丝是显而易见的选择，但隐私可能是一个问题，或者无论如何都被认为是问题，因为它是一种 SaaS 产品。我说的很明显，因为您列表中的三个大胆的功能是他们平台 IIRC 的核心功能。

他们没有这样的功能列表 - 这使得很难支持这个答案，但他们确实[说](http://www.talis.com/platform/about_us/)数据存储可以单独保护。我想你可以——在紧要关头——代表你自己的每个用户注册一个单独的商店。

为每个用户任务编写自定义界面通常可以最好地支持人类可读的输入，因此您最好准备好根据需要执行此操作。

关于黄金时段的准备情况。对于某些应用程序，我会说是，但否则“不完全”。大多数情况下，社区需要与现有的开发人员工具集集成并编写针对“普通”开发人员的优秀文档——可能是使用 Java、.NET 和 Ruby/Groovy 的 OO 开发人员——然后我预测它会滚雪球。

另请参见[RDF 三元组的时间范围](http://www.jenitennison.com/blog/node/101)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-22T17:56:43.710

LMF 带有一个版本控制模块：[http ://code.google.com/p/lmf/wiki/ModuleVersioning](http://code.google.com/p/lmf/wiki/ModuleVersioning)

Linked Media Framework 是一个使用 JavaEE 开发的易于设置的服务器应用程序，它捆绑了核心语义 Web 技术以提供许多高级服务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T12:24:49.567

看看 Virtuoso 的[RDF 支持](http://virtuoso.openlinksw.com/main/rdf/index.htm)是否满足您的需求，听起来它可能会走得很远，而且它也可以很好地与 XML 和 Web 服务配合使用。有商业版和 GPL 版。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T10:44:21.883

[Mulgara/Fedora-Commons](http://fedora-commons.org/)可能符合要求。我相信隐私目前是一个主要项目，我知道它支持版本控制，但它可能太多了，因为它也是一个对象存储。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-30T10:15:45.550

（多年后）

我认为 Oracle 的 RDF 存储：

[http://www.oracle.com/technetwork/database/options/semantic-tech/index.html](http://www.oracle.com/technetwork/database/options/semantic-tech/index.html)

IBM 的 DB2 中最近宣布的图形存储支持其中的大部分内容：

[http://www-01.ibm.com/software/data/db2/linux-unix-windows/graph-store.html](http://www-01.ibm.com/software/data/db2/linux-unix-windows/graph-store.html)

# asp.net-mvc - 您如何为 ASP.NET MVC 编写自己的视图引擎？

> ID：394956
> 
> 赞同：5
> 
> 时间：2008-12-27T12:36:34.453
> 
> 标签：asp.net-mvc, viewengine

我知道 ASP.NET MVC 将允许我交换其他人创建的各种视图引擎，但我想知道如何创建自己的视图引擎？

**更多信息：** 我们有自己的基于 Web 表单的 CMS，而 MVC 的主要卖点是它为我们提供了更清晰的 HTML（我们的设计师会喜欢的）。但是，我们希望创建自己的特定于域的 View 实现。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-27T12:42:45.457

好的，我做了一些 Google-fu 并找到了这些帖子：

[在 ASP.NET MVC 应用程序中添加对皮肤的支持](http://www.thecodejunkie.com/2008/11/adding-support-for-skins-in-aspnet-mvc.html)

[ASP.NET MVC 中的部分渲染和视图引擎](http://bradwilson.typepad.com/blog/2008/08/partial-renderi.html)

我想我可以从这些人所说的中解决这个问题——我只是希望它仍然适用于最新的 ASP.NET MVC 下降！

**编辑：**还有一篇关于使用[VB.NET XML literals for a view engine](http://blogs.msdn.com/dmitryr/archive/2008/12/29/asp-net-mvc-view-engine-using-vb-net-xml-literals.aspx)的好帖子。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T20:26:40.177

这太容易了，这就是我所做的：

1.  创建一个从 VirtualPathProviderViewEngine 派生的类（实际上，您可以复制 WebFormsViewEngine 并稍微编辑它）。

2.  创建一个从 IView 派生的类。只有一种方法——把你的魔法放在这里。

3.  在 Global.asax.cs 中：

    ViewEngines.Engines.Add(new MyEngine());

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T09:00:44.363

查看[http://mvccontrib.org/](http://mvccontrib.org/)以获得不同 ViewEngines 的几个示例。包括 4 个（嗯，减去一个已过时但代码仍然可用的）

# theory - 为什么康威的生命游戏可以归类为万能机？

> ID：394957
> 
> 赞同：63
> 
> 时间：2008-12-27T12:36:57.073
> 
> 标签：theory, turing-machines, turing-complete, computability

我最近在阅读关于人工生命的文章，偶然发现了这样的说法，[“康威的生命游戏展示了足够的复杂性，可以被归类为通用机器。”](http://www.alesdar.org/oldSite/IS/chap3-9.html) [我对什么是通用机器](http://en.wikipedia.org/wiki/Universal_machine)只有一个粗略的了解，而维基百科只是让我与维基百科一样接近理解。我想知道是否有人可以对这个非常性感的声明有所了解？

[对我来说，康威的生命游戏](http://en.wikipedia.org/wiki/Conway's_Game_of_Life)似乎是一种可爱的消遣，具有一些巨大的影响：我无法在它和计算器之间进行跳跃？这甚至是我应该做出的飞跃吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-12-27T13:31:23.767

Paul Rendell[在 Life 中实现了图灵机](http://rendell-attic.org/gol/tm.htm)。滑翔机代表信号，它们之间的交互是门和逻辑，它们一起可以创建更大的组件来实现图灵机。

基本上，任何可以实现 AND、OR 和 NOT 的自动机器都可以以足够复杂的方式组合在一起以实现图灵完备。这不是一种有用的计算方式，但它符合标准。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-12-27T12:41:27.953

你*可以*从康威的生活中建造一台图灵机——尽管这将是非常可怕的。

关键在于*滑翔机*（和相关模式）——它们沿着比赛场地（缓慢地）移动，因此可以表示比特流（1 表示滑翔机的存在，0 表示没有滑翔机）。可以构建其他模式以接收两个滑翔机流（以直角）并发出另一个对应于原始两个流的 AND/OR/etc 的比特流。

[编辑： LogiCell 网站](http://www.rennard.org/alife/english/logicellgb.html)上有更多关于此的内容。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2012-01-13T03:37:39.610

康威的“生命”可以更进一步：不仅可以构建实现通用图灵机的生命模式，还可以构建冯诺依曼“通用构造器”：[http ://conwaylife.com/wiki/Universal_constructor](http://conwaylife.com/wiki/Universal_constructor)

由于可以对“通用构造器”进行编程以构造任何模式的细胞，包括其自身的副本，因此 Coway 的“生命”能够“自我复制”，而不仅仅是通用计算。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-12-27T14:53:24.130

我强烈推荐 Poundstone 的《递归宇宙》一书。绝版了，但你可能会找到一份副本，也许在一个好的图书馆。这几乎都是关于康威生命的力量，以及可以存在于具有那套自然法则的宇宙中的事物，包括自我复制实体和 IIRC，达尔文进化论。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-02-11T14:21:27.177

而保罗查普曼实际上构建了一个具有生命游戏的通用图灵机：[http](http://www.igblan.free-online.co.uk/igblan/ca/) ://www.igblan.free-online.co.uk/igblan/ca/通过构建“通用明斯基注册机”。

> 该图案是在 30x30 方格的格子上构建的。轻型宇宙飞船 (LWSS) 用于在具有 P60 逻辑的组件之间进行通信（寄存器除外 - 见下文）。一个 LWSS 需要 60 代才能穿过一个格子正方形。因此，每 60 代，任何组件间 LWSS（脉冲）都相对于它所在的正方形处于相同位置，允许旋转

.

# browser - 浏览器编辑控件中的 Tab 键行为

> ID：394959
> 
> 赞同：4
> 
> 时间：2008-12-27T12:37:59.897
> 
> 标签：browser

Web 浏览器非常适合作为 Web 应用程序的瘦客户端。

但是，如果用户必须在编辑框中输入一些代码（其中选项卡和格式很重要），在网络浏览器中，他每次点击“选项卡”键时都会浏览网页控件，而不是打印“选项卡”特点。

是否有任何免费的网络控件或是否有任何代码来获得相反的行为？
[Google Docs](http://docs.google.com/)完美地做到了这一点。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T13:02:27.007

Yahoo UI 库有一个[富文本编辑器](http://developer.yahoo.com/yui/editor/)，可以正确处理制表符。

**编辑**：我怀疑（因为我没有看过）YUI 编辑器和谷歌的编辑器都通过向文本容器添加一个 onKeyPress 处理程序来实现这一点。当他们检测到一个制表符时，他们将一个制表符附加到容器并返回 false 以取消正常的制表符操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T13:28:20.653

您可以过滤 keyDown 事件并捕获 tab 键：

```
<html>
<body>
<script type="text/javascript">
function keyFilter(e, field) {
  var key = window.event ? e.keyCode : e.which;
  if (key == 9) {
     field.value += "\t";
     return false;
  }
  return true;
}
</script>

<form>
<textarea onkeydown="return keyFilter(event, this);"></textarea>
</form>
</html> 
```

编辑：请注意，它当然比这更复杂。需要跟踪在文本中按下制表键的位置并相应地插入字符。

# python - 从 EXPLOSM.net 漫画脚本下载 [Python]

> ID：394978
> 
> 赞同：1
> 
> 时间：2008-12-27T13:09:10.893
> 
> 标签：python, scripting, download, urllib

所以我写了这个简短的脚本（正确的词？）从explosm.net漫画下载漫画图像，因为我最近发现了它，我想......把它放在我的iPhone......3G上。

它工作正常。用于获取网页 html 的 urllib2 和用于 image.retrieve() 的 urllib

***为什么我在 SO 上发布此内容：如何优化此代码？REGEX（正则表达式）会使其更快吗？是网络限制吗？算法差...？***

速度或***一般代码美学***的任何改进将不胜感激“答案”。

*谢谢你。*

*- - - - - - - - - - - - - - - - 代码 - - - - - - - - - -----------------*

```
import urllib, urllib2

def LinkConvert(string_link):
    for eachLetter in string_link:
        if eachLetter == " ":
            string_link = string_link[:string_link.find(eachLetter)] + "%20" + string_link[string_link.find(eachLetter)+1:]
    return string_link

start = 82
end = 1506

matchingStart = """<img alt="Cyanide and Happiness, a daily webcomic" src="http://www.explosm.net/db/files/Comics/"""
matchingEnd = """></"""
link = "http://www.explosm.net/comics/"

for pageNum in range(start,start+7):
    req = urllib2.Request(link+`pageNum`)
    response = urllib2.urlopen(req)
    page = response.read()

    istart1 = page.find(matchingStart)
    iend1 = page.find(matchingEnd, istart1)
    newString1 = page[istart1 : iend1]

    istart2 = newString1.find("src=")+4
    iend2 = len(newString1)
    final = newString1[istart2 +1 : iend2 -1]

    final = LinkConvert(final)
    try:
        image = urllib.URLopener()
        image.retrieve(final, `pageNum` + ".jpg")
    except:
        print "Uh-oh! " + `pageNum` + " was not downloaded!"

    print `pageNum` + " completed..." 
```

*顺便说一句，这是 Python 2.5 代码，而不是 3.0，但你敢打赌，我在新年之前或之后对 PYthon 3.0 的所有功能进行了深入研究和使用（在大学应用程序之后 - 耶！^-^）*

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-27T14:04:48.363

我建议使用[Scrapy](http://scrapy.org/)进行页面获取，使用[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)进行解析。这将使您的代码更简单。

是否要更改适用于这些替代方案的现有代码取决于您。如果不是，那么正则表达式可能会稍微简化您的代码。我不确定它会对性能产生什么影响。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-27T14:53:42.320

[refactormycode](http://refactormycode.com/)可能是更适合这些“让我们改进此代码”类型的讨论的网站。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T13:54:56.417

我建议使用[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)进行解析，它会大大简化您的代码。

但既然你已经让它以这种方式工作，也许你不想碰它，直到它坏掉（页面格式改变）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T21:56:24.200

urllib2 使用阻塞调用，这是性能的主要原因。您应该使用非阻塞库（如 scrapy）或使用多个线程进行检索。我从来没有使用过scrapy（所以我不知道那个选项），但是python中的线程非常简单直接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-11-24T14:27:42.263

今天使用 Bash 做了同样的事情。它真的很基本，但工作得很好。

我首先创建了两个目录，其中放置了文件：

```
mkdir -p html/archived
mkdir png 
```

然后，分两个步骤工作。首先，浏览所有页面：

```
START=15
END=4783
for ((i=START;i<=END;i++)); do
  echo $i
  wget http://explosm.net/comics/$i/ -O html/$i.html
done

#Remove 404
find html -name '*.html' -size 0 -print0 | xargs -0 rm 
```

2，对于每个页面，报废 htmlm 并检索图片：

```
#!/bin/bash
for filename in ./html/*.html; do
  i=`echo $filename | cut -d '"' -f 4 | cut -d '/' -f3 | cut -d '.' -f1`
  echo "$filename => $i"
  wget -c "$(grep '<meta property="og:image" content=' ${filename} | cut -d '"' -f 4)" -O ./png/${i}.png
  mv $filename ./html/archived/
done 
```

结果在这里： [Cyanide_and_happiness__up_to_2017-11-24.zip](http://evilpotatoe.free.fr/Cyanide_and_happiness__up_to_2017-11-24.zip)

请注意，我不太关心潜在的失败，但算上 4606 个文件，似乎大部分都可以。

我还将所有内容保存为png。它们可能是 jpg，我注意到 185 个 0 大小的文件，但是......随意关心它，我不会:)

# javascript - Ajax - 库或纯 Javascript

> ID：394979
> 
> 赞同：9
> 
> 时间：2008-12-27T13:09:15.933
> 
> 标签：javascript, jquery, ajax, prototypejs

我一直在阅读有关 AJAX 的大量内容，并且想知道哪种方法更好：通过使用 jQuery 等库的内置方法或在没有 AJAX 库的情况下创建 JavaScript？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-27T13:21:23.943

在使用 XMLHttpRequest 对象时，Ajax 有很多怪癖。当你开始使用它时，你不会看到它，但是当它在生产环境中出现时，它会咬你的屁股。浏览器、浏览器版本、用户设置、服务器类型、请求类型等等都会影响需要编码的内容。图书馆倾向于解决大部分问题，但它们都不是完美的。

我总是告诉人们使用教程来了解 XMLHttpRequest 的工作原理非常棒。在你学会了如何赤裸裸地做之后，使用一个适合你需要的库。

埃里克·帕斯卡雷洛

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-27T13:16:08.023

既然已经存在大量库，为什么还要创建一个库？如果您创建一个库，这将花费时间和精力，并且您最终会遇到其他人已经遇到的相同障碍。除非您的公司试图出售 Ajax 库，否则不要编写自己的管道代码。

我目前在我的站点中同时使用 JQuery 和 Microsoft 的 Ajax，并且发现它们都具有完整的功能，并且您可以通过多种不同的方式来设置通信。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T17:16:50.300

如果你在 comp.lang.javascript 上问这个问题，你会得到很多不同的答案，其中许多不屑于常用的库（有时会稍微断章取意的一句话是[Richard Cornford 在 2007 年关于 cljs 的帖子](http://groups.google.com/group/comp.lang.javascript/browse_thread/thread/4714540d2b766e26/39ba888b11ba1e89#39ba888b11ba1e89)：“Prototype. js 是由不懂 javascript 的人为不懂 javascript 的人编写的。不懂 javascript 的人并不是设计使用 javascript 的系统的最佳建议来源。”）

库的论点是它们抽象出浏览器之间的大部分差异并允许跨浏览器脚本。反对库的论点是它们是臃肿的代码，有自己的怪癖，所以你必须学习尽可能多地使用它们，就像在原始 javascript 中使用跨浏览器技术一样。[如果您正在编写大量要在多个地方重复使用的 Javascript，并且您正在尝试使网站能够快速加载并使用最少的多余带宽（例如，如果您通过Amazon](http://aws.amazon.com/s3/)进行按使用付费的网络托管）[S3](http://aws.amazon.com/s3/)或[nearfreespeech.net](https://www.nearlyfreespeech.net/)），那么可能值得从一个好的库中剥离您将要使用的任何内容，对其进行调整并使用它。

有一段时间我对 Prototype 很着迷，但后来决定我只需要一些简单的构建块。我倾向于使用 Doug Crockford 的简单[JSON 库](http://www.json.org/js.html)，然后根据需要使用一些[Fork Javascript](http://forkjavascript.org/)的极简主义库（主要是[FORK.Ajax](http://forkjavascript.org/ajax/docs)），然后我自己从头开始或重用早期项目中的例程，我已经磨练了一些东西这对我很有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T13:16:34.297

如果它满足您的需求，您为什么不使用库。您正在使用 .net 框架、Java JRE 或 php 内置函数...

您可以创建自己的 javascript 来学习，或者做一些图书馆不提供的事情。但是对于常规开发，您可以更快地使用库，并且无需手动编写跨浏览器支持即可获得跨浏览器兼容的 JS，它已经内置到库中

# linux - 以不同用户身份运行 Linux 服务的最佳实践

> ID：394984
> 
> 赞同：143
> 
> 时间：2008-12-27T13:14:47.840
> 
> 标签：linux, sysadmin, rhel, init.d

服务默认`root`在我的 RHEL 机器上启动时启动。如果我没记错的话，其他使用 init 脚本的 Linux 发行版也是如此`/etc/init.d`。

您认为让进程作为我选择的（静态）用户运行的最佳方式是什么？

我到达的唯一方法是使用类似的东西：

```
 su my_user -c 'daemon my_cmd &>/dev/null &' 
```

但这似乎有点不整洁......

是否有一些神奇的东西可以提供一种简单的机制来以其他非 root 用户身份自动启动服务？

**编辑：**我应该说我在这个实例中启动的进程要么是 Python 脚本，要么是 Java 程序。我宁愿不围绕它们编写本机包装器，所以不幸的是我无法像[Black](https://stackoverflow.com/users/25234/black)建议的那样调用[setuid() 。](http://linux.die.net/man/2/setuid)

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-12-27T13:53:34.423

在 Debian 上，我们使用该`start-stop-daemon`实用程序来处理 pid 文件、更改用户、将守护进程置于后台等等。

我对 RedHat 不熟悉，但是`daemon`您已经在使用的实用程序（`/etc/init.d/functions`顺便说一句`start-stop-daemon`，在它已经是正确的了。

如果您环顾网络，您可以使用几个现成的包装纸。有些甚至可能已经打包在 RedHat 中。看看[`daemonize`](http://www.clapper.org/software/daemonize/)，例如。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-12-27T19:59:21.503

在查看了这里的所有建议之后，我发现了一些我希望对我所在职位的其他人有用的东西：

1.  [跳](https://stackoverflow.com/users/3850/hop)是正确的指向我回来`/etc/init.d/functions`：该 `daemon`功能已经允许您设置备用用户：

    ```
    daemon --user=my_user my_cmd &>/dev/null & 
    ```

    这是通过用`runuser`- 包装流程调用来实现的，稍后会详细介绍。

2.  [Jonathan Leffler](https://stackoverflow.com/users/15168/jonathan-leffler)是对的：Python 中有 setuid：

    ```
    import os
    os.setuid(501) # UID of my_user is 501 
    ```

    但是，我仍然认为您不能从 JVM 内部进行 setuid。

3.  既不`su`也不`runuser` 优雅地处理您要求以您已经是用户的身份运行命令的情况。例如：

    ```
    [my_user@my_host]$ id
    uid=500(my_user) gid=500(my_user) groups=500(my_user)
    [my_user@my_host]$ su my_user -c "id"
    Password: # don't want to be prompted!
    uid=500(my_user) gid=500(my_user) groups=500(my_user) 
    ```

`su`为了解决and的这种行为`runuser`，我将初始化脚本更改为：

```
if [[ "$USER" == "my_user" ]]
then
    daemon my_cmd &>/dev/null &
else
    daemon --user=my_user my_cmd &>/dev/null &
fi 
```

感谢你的帮助！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-27T13:22:55.983

*   一些守护进程（例如 apache）通过调用[setuid()自行执行此操作](http://linux.die.net/man/2/setuid)
*   您可以使用[setuid-file 标志](http://en.wikipedia.org/wiki/Setuid)以其他用户身份运行该进程。
*   当然，您提到的解决方案也有效。

如果您打算编写自己的守护程序，那么我建议您调用 setuid()。这样，您的流程可以

1.  利用它的 root 权限（例如打开日志文件，创建 pid 文件）。
2.  在启动期间的某个时间点删除其 root 权限。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-10-14T14:41:52.657

只是添加一些其他需要注意的事项：

*   init.d 脚本中的 Sudo 不好，因为它需要一个 tty（“sudo：抱歉，您必须有一个 tty 才能运行 sudo”）
*   如果您正在对 Java 应用程序进行守护进程，您可能需要考虑 Java Service Wrapper（它提供了一种设置用户 ID 的机制）
*   另一种选择可能是*su --session-command=[cmd] [user]*

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-08T01:31:54.610

在 svn 服务器的 CENTOS (Red Hat) 虚拟机上：编辑`/etc/init.d/svnserver` 以将 pid 更改为 svn 可以写入的内容：

```
pidfile=${PIDFILE-/home/svn/run/svnserve.pid} 
```

并添加了选项`--user=svn`：

```
daemon --pidfile=${pidfile} --user=svn $exec $args 
```

原来的 pidfile 是`/var/run/svnserve.pid`. 守护进程没有启动，因为只有 root 可以写在那里。

```
 These all work:
/etc/init.d/svnserve start
/etc/init.d/svnserve stop
/etc/init.d/svnserve restart 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-05T18:00:47.370

需要注意的一些事项：

*   正如您所提到的，如果您已经是目标用户，su 将提示您输入密码
*   同样，如果您已经是目标用户（在某些操作系统上）， setuid(2) 将失败
*   setuid(2) 不安装 /etc/limits.conf (Linux) 或 /etc/user_attr (Solaris) 中定义的权限或资源控制
*   如果您使用 setgid(2)/setuid(2) 路线，请不要忘记调用 initgroups(3) - 更多信息请 [点击此处](http://daemons.net/~clay/2009/05/02/setuid-ate-my-css/)

我通常在启动守护进程之前使用 /sbin/su 切换到适当的用户。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-02-17T10:05:39.180

为什么不在 init 脚本中尝试以下操作：

```
setuid $USER application_name 
```

它对我有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-08-31T07:47:48.063

我需要将 Spring .jar 应用程序作为服务运行，并找到了一种以特定用户身份运行它的简单方法：

我将 jar 文件的所有者和组更改为我想要运行的用户。然后在 init.d 中符号链接这个 jar 并启动服务。

所以：

```
#chown myuser:myuser /var/lib/jenkins/workspace/springApp/target/springApp-1.0.jar

#ln -s /var/lib/jenkins/workspace/springApp/target/springApp-1.0.jar /etc/init.d/springApp

#service springApp start

#ps aux | grep java
myuser    9970  5.0  9.9 4071348 386132 ?      Sl   09:38   0:21 /bin/java -Dsun.misc.URLClassPath.disableJarChecking=true -jar /var/lib/jenkins/workspace/springApp/target/springApp-1.0.jar 
```

# vb.net - Gridview 链接按钮单击事件 - Windows 应用程序

> ID：394989
> 
> 赞同：2
> 
> 时间：2008-12-27T13:18:37.443
> 
> 标签：vb.net, winforms

如何在vb.net（windows应用程序）的gridview中处理linkbutton的点击事件

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-27T17:29:13.427

您需要使用 DataGridView.CellClick 事件并检查您是否获得了正确的列索引。您可以通过以下步骤进行操作：

> 创建一个新的 Windows 窗体应用程序
> 
> 将 DataGridView 拖到屏幕上
> 
> 在设计时属性中，将一列添加到 DataGridViewLinkColumn 类型的网格中
> 
> 将 DataPropertyName 属性设为“Link”（无引号）。
> 
> 在您的表单构造函数中，将此代码粘贴到对 InitializeComponent 的调用下：

哦，是的，你是在 VB.NET 中做的，所以它会是：

```
Dim data As New DataTable()
data.Columns.Add(New DataColumn("Link", Type.GetType("System.String")))
Dim newRow As DataRow = data.NewRow()
newRow("Link") = "http://www.stackoverflow.com"
data.Rows.Add(newRow)
DataGridView1.DataSource = data 
```

> 使用 DataGridView.CellClick 事件

```
Private Sub DataGridView1_CellClick(ByVal sender As Object, ByVal e As System.Windows.Forms.DataGridViewCellEventArgs) Handles DataGridView1.CellClick
    If (e.ColumnIndex = 0) Then
        Dim link As String = DataGridView1(e.ColumnIndex, e.RowIndex).Value.ToString()
        System.Diagnostics.Process.Start(link)
    End If
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-03-21T09:44:53.183

**Gridview 绑定时间**

```
LetterB lb = new LetterB();
var letter = lb.GetLetter();
if (letter != null && letter.Count > 0)
{
     dgvLetter.DataSource = letter;
     DataGridViewLinkColumn lnkEdit = new DataGridViewLinkColumn();

     lnkEdit.UseColumnTextForLinkValue = true;
     lnkEdit.LinkBehavior = LinkBehavior.SystemDefault;
     lnkEdit.HeaderText = "Edit";
     lnkEdit.Name = "SiteName";
     lnkEdit.LinkColor = Color.Blue;
     lnkEdit.TrackVisitedState = true;
     lnkEdit.Text = "Edit";
     lnkEdit.UseColumnTextForLinkValue = true;
     dgvLetter.Columns.Add(lnkEdit);
} 
```

**点击事件**

```
private void dgvLetter_CellContentClick(object sender, DataGridViewCellEventArgs e)
{
     var senderGrid = (DataGridView)sender;

     if (senderGrid.Columns[e.ColumnIndex] is DataGridViewLinkColumn && e.RowIndex >= 0)
     { 
          //your code
     }
} 
```************************