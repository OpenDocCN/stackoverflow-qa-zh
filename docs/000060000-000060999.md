# StackOverflow 问答 000060000-000060999

# c++ - C++ 继承和成员函数指针

> ID：60000
> 
> 赞同：50
> 
> 时间：2008-09-12T21:24:53.413
> 
> 标签：c++, inheritance, oop, member-function-pointers

在 C++ 中，成员函数指针可以用来指向派生（甚至是基）类成员吗？

编辑：也许一个例子会有所帮助。假设我们有一个按继承顺序排列的 三个类`X`,`Y`的层次结构。因此有一个基类和一个派生类。`Z``Y``X``Z`

现在我们可以`p`为 class定义一个成员函数指针`Y`。这写成：

```
void (Y::*p)(); 
```

（为简单起见，我假设我们只对带有签名的函数感兴趣`void f()`）

这个指针`p`现在可以用来指向类的成员函数`Y`。

这个问题（实际上是两个问题）是：

1.  可以`p`用来指向派生类中的函数`Z`吗？
2.  可以`p`用来指向基类中的函数`X`吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-04-22T06:25:21.923

C++03 标准，[§4.11 2 指向成员转换](http://www.open-std.org/jtc1/sc22/WG21/docs/wp/html/nov97-2/conv.html#conv.mem)的指​​针：

> “指向类型为*cv* T 的 B 的成员的指针”类型的右值，其中 B 是类类型，可以转换为类型为“指向类型为*cv* T 的 D 的成员的指针”类型的右值，其中 D 是派生类 ( B 的第 10 条）。如果 B 是 D 的不可访问（第 11 条）、模棱两可（10.2）或虚拟（10.1）基类，则需要进行这种转换的程序是格式错误的。转换的结果与发生转换之前的成员指针引用相同的成员，但它引用基类成员，就好像它是派生类的成员一样。结果引用了 D 的 B 实例中的成员。由于结果的类型为“指向*cv类型的 D 成员的指针”*T，”它可以用 D 对象取消引用。结果与使用 D 的 B 子对象取消引用 B 的成员的指针相同。空成员指针值转换为目标类型的空成员指针值。^(52))
> 
> ^(52))与指向对象的指针规则（从派生指针到基址指针）相比，成员指针转换规则（从基址成员指针到派生成员指针）似乎相反（4.10，第 10 条） . 这种反转是确保类型安全所必需的。请注意，指向成员的指针不是指向对象的指针或指向函数的指针，并且此类指针的转换规则不适用于指向成员的指针。特别是，指向成员的指针不能转换为 void*。

简而言之，您可以将指向可访问的、非虚拟基类的成员的指针转换为指向派生类成员的指针，只要该成员不模棱两可。

```
class A {
public: 
    void foo();
};
class B : public A {};
class C {
public:
    void bar();
};
class D {
public:
    void baz();
};
class E : public A, public B, private C, public virtual D {
public: 
    typedef void (E::*member)();
};
class F:public E {
public:
    void bam();
};
...
int main() {
   E::member mbr;
   mbr = &A::foo; // invalid: ambiguous; E's A or B's A?
   mbr = &C::bar; // invalid: C is private 
   mbr = &D::baz; // invalid: D is virtual
   mbr = &F::bam; // invalid: conversion isn't defined by the standard
   ... 
```

另一个方向（通过`static_cast`）的转换受[§ 5.2.9](http://www.open-std.org/jtc1/sc22/WG21/docs/wp/html/nov97-2/expr.html#expr.static.cast) 9 的约束：

> “指向*cv1* T 类型的 D 成员的指针”类型的右值可以转换为“指向*cv2* T 类型的 B 成员的指针”类型的右值，其中 B 是 D 的基类（第[10 条 class.derived](http://www.open-std.org/jtc1/sc22/WG21/docs/wp/html/nov97-2/derived.html#class.derived)） ，如果存在从“指向 T 类型 B 成员的指针”到“指向 T 类型 D 成员的指针”的有效标准转换（[4.11 conv.mem](http://www.open-std.org/jtc1/sc22/WG21/docs/wp/html/nov97-2/conv.html#conv.mem)），并且*cv2*与 cv-qualification 相同或更高资格比，*cv1*。^(11）)空成员指针值（[4.11 conv.mem](http://www.open-std.org/jtc1/sc22/WG21/docs/wp/html/nov97-2/conv.html#conv.mem)) 转换为目标类型的空成员指针值。如果类 B 包含原始成员，或者是包含原始成员的类的基类或派生类，则指向成员的结果指针指向原始成员。否则，强制转换的结果是未定义的。[注意：虽然B类不需要包含原始成员，但解除引用成员指针的对象的动态类型必须包含原始成员；见[5.5 expr.mptr.oper](http://www.open-std.org/jtc1/sc22/WG21/docs/wp/html/nov97-2/expr.html#expr.mptr.oper)。]
> 
> ^(11))函数类型（包括那些用于指向成员函数类型的指针）永远不是 cv 限定的；见[8.3.5 dcl.fct](http://www.open-std.org/jtc1/sc22/WG21/docs/wp/html/nov97-2/decl.html#dcl.fct)。

简而言之，如果可以从 a 转换为 a ，则可以从派生转换为基`D::*`，尽管您只能使用D 类型或从 D 派生的 on 对象。`B::*``B::*``D::*``B::*`

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-12T21:42:07.803

我不是 100% 确定你在问什么，但这里有一个适用于虚函数的示例：

```
#include <iostream>
using namespace std;

class A { 
public:
    virtual void foo() { cout << "A::foo\n"; }
};
class B : public A {
public:
    virtual void foo() { cout << "B::foo\n"; }
};

int main()
{
    void (A::*bar)() = &A::foo;
    (A().*bar)();
    (B().*bar)();
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-04-22T06:58:06.120

指向成员的指针的关键问题是它们可以应用于任何引用或指向正确类型的类的指针。这意味着因为`Z`是从`Y`指针（或引用）类型的指针（或引用）派生的，`Y`可能实际上指向（或引用）到的基类子对象`Z`或*任何其他*从`Y`.

```
void (Y::*p)() = &Z::z_fn; // illegal 
```

这意味着分配给指向成员的指针的任何内容都`Y`必须实际与 any 一起使用`Y`。如果允许它指向一个成员`Z`（不是 的成员`Y`），那么就有可能`Z`在一些实际上不是`Z`.

另一方面，任何指向成员的指针`Y`也指向成员`Z`（继承意味着`Z`具有其基的所有属性和方法）将指向成员的指针转换为指向成员的指针是合法`Y`的`Z`。这本质上是安全的。

```
void (Y::*p)() = &Y::y_fn;
void (Z::*q)() = p; // legal and safe 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-12T21:35:05.823

您可能想查看这篇文章[Member Function Pointers and the Fastest possible C++ Delegates](http://www.codeproject.com/KB/cpp/FastDelegate.aspx) 在某些情况下，简短的回答似乎是肯定的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T21:30:00.920

我相信是这样。由于函数指针使用签名来标识自己，因此基本/派生行为将依赖于您调用它的任何对象。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-15T10:53:14.430

我的实验揭示了以下内容： 警告 - 这可能是未定义的行为。如果有人可以提供明确的参考，那将很有帮助。

1.  这有效，但在将派生成员函数分配给`p`.
2.  这也有效，但在取消引用时需要额外的强制转换`p`。

如果我们真的很有野心，我们可以询问是否`p`可以用来指向不相关类的成员函数。我没有尝试过，但在 dagorym 的答案中链接的[FastDelegate](http://www.codeproject.com/KB/cpp/FastDelegate.aspx)页面表明这是可能的。

总之，我将尽量避免以这种方式使用成员函数指针。像下面这样的段落不会激发信心：

> 成员函数指针之间的转换是一个非常模糊的区域。在 C++ 的标准化过程中，有很多关于是否应该能够将成员函数指针从一个类强制转换为基类或派生类的成员函数指针，以及是否可以在不相关的类之间强制转换的讨论。当标准委员会做出决定时，不同的编译器供应商已经做出了实施决策，这些决策将他们锁定在对这些问题的不同答案中。[ [FastDelegate 文章](http://www.codeproject.com/KB/cpp/FastDelegate.aspx)]

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-04-22T04:01:20.723

假设我们有`class X, class Y : public X, and class Z : public Y`

您应该能够将 X、Y 的方法分配给 void (Y::*p)() 类型的指针，但不能将 Z 的方法分配给 Z。要了解原因，请考虑以下内容：

```
void (Y::*p)() = &Z::func; // we pretend this is legal
Y * y = new Y; // clearly legal
(y->*p)(); // okay, follows the rules, but what would this mean? 
```

通过允许该赋值，我们允许在 Y 对象上调用 Z 的方法，这可能导致谁知道什么。您可以通过转换指针来使其全部工作，但这并不安全或不能保证工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-13T18:51:28.733

这是一个有效的例子。您可以重写派生类中的方法，并且使用指向此重写方法的指针的基类的另一个方法确实调用派生类的方法。

```
#include <iostream>
#include <string>

using namespace std;

class A {
public:
    virtual void traverse(string arg) {
        find(&A::visit, arg);
    }

protected:
    virtual void find(void (A::*method)(string arg),  string arg) {
        (this->*method)(arg);
    }

    virtual void visit(string arg) {
        cout << "A::visit, arg:" << arg << endl;
    }
};

class B : public A {
protected:
    virtual void visit(string arg) {
        cout << "B::visit, arg:" << arg << endl;
    }
};

int main()
{
    A a;
    B b;
    a.traverse("one");
    b.traverse("two");
    return 0;
} 
```

# rss - 如何构建大型/繁忙的 RSS 提要

> ID：60009
> 
> 赞同：1
> 
> 时间：2008-09-12T21:29:42.637
> 
> 标签：rss

这周我一直在玩 RSS 提要，对于我的下一个技巧，我想为我们的内部应用程序日志构建一个。我们有一个集中的数据库表，我们的无数批处理和 Intranet 应用程序使用它来发布日志消息。我想从这个表中创建一个 RSS 提要，但我不确定如何处理这个量 - 即使在正常的一天，每天也可能有数百个条目。一个特殊的让你想戒烟的日子可能会看到几千人。有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T12:58:11.063

我会将提要制作为**静态文件**（您可以轻松提供数千个），**定期重新生成**。然后你有一个更广泛的选择，因为它不必运行在秒以下，它甚至可以运行几分钟。并且用户仍然可以获得**完美的下载速度**和合理的更新速度。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T16:16:49.620

如果您正在构建一个带有不可错过的通知的系统，那么发布-订阅机制（使用 XMPP、ApacheMQ 支持的其他协议之一或类似的东西）将比联合机制更合适。您需要在生成通知的系统和使用通知的系统之间进行一些耦合，以确保消费者不会错过通知。

（您可以使用 RSS 或 Atom 作为传输格式来执行此操作，但这可能不是一个常见的用例；您需要根据消费者及其之前看到的通知来改变显示的通知。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-07T18:51:12.513

我会尽可能多地拆分提要，让用户根据需要重新组合它们。如果我这样做，我可能会考虑使用 Django 和联合框架。

Django 的模型可能可以处理表示您关心的表的数据结构。

您可以有一个可以捕获所有内容的 URL，例如：（`r'/rss/(?(\w*?)/)+'`我认为这可能有效，但我现在无法对其进行测试，因此它可能并不完美）。

这样您就可以使用以下 URL（已编辑以取消示例 URL 的自动链接）：

*   http://feedserver/rss/batch-file-output/
*   http://feedserver/rss/support-tickets/
*   http://feedserver/rss/batch-file-output/support-tickets/（前两者合二为一）

然后在视图中：

```
def get_batch_file_messages():
    # Grab all the recent batch files messages here.
    # Maybe cache the result and only regenerate every so often.

# Other feed functions here.

feed_mapping = { 'batch-file-output': get_batch_file_messages, }

def rss(request, *args):
    items_to_display = []
    for feed in args:
        items_to_display += feed_mapping[feed]()
    # Processing/returning the feed. 
```

拥有单独的、可链接的提要意味着用户可以一次订阅一个提要，或者将他们关心的提要合并到一个更大的提要中。无论他们更容易阅读，他们都能做到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T16:10:20.260

好吧，我决定了我将如何处理这件事。我为每一列使用时间戳字段并按天分组。它需要一点 SQL-fu 才能实现，因为当然那里有一个完整的时间戳，我需要半智能地了解如何从组内选择要显示的日志消息，但这还不错。此外，我正在构建它以让您选择要监控的应用程序，然后显示特定日期的每条消息（最多 50 条）。

这让我明白了一些合理的事情。

我仍然希望对更一般的问题有一个好的答案：“您如何联合许多重要消息，其中缺少消息可能是一个问题？”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T21:59:32.130

在不了解您的申请的情况下，我无法提供具体建议。

也就是说，在这类系统中，具有一定程度的严重性是很常见的。您可以将查询字符串参数附加到指定严重性的 URL 的末尾。如果设置为“DEBUG”，无论多么微不足道，您都会看到每个事件。如果您将其设置为“致命”，您只会看到“系统故障”的事件。

如果仍然有太多事件，您可能希望将事件细分到某种类别系统中。同样，我会将其作为查询字符串参数。

然后，您可以为各种类别和严重性提供多个 RSS 提要。这应该允许您调整获得可接受级别的警报级别。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T19:05:13.943

在这种情况下，它更像是一个经理的仪表板：今天投入了多少工作，日志中有什么紧迫的事情，以及我们早上第一次到达的时间，以衡量一夜之间批处理作业出了什么问题.

# ruby-on-rails - 如何在 ROR 中使用 ActiveScaffold 一次创建多个记录

> ID：60019
> 
> 赞同：4
> 
> 时间：2008-09-12T21:38:03.430
> 
> 标签：ruby-on-rails, ruby, ajax, activerecord, activescaffold

我想使用 ActiveScaffold在一个步骤中为多个*学生创建**作业*记录。除了 student_id 之外，这些记录都将包含相同的数据。

 *我能够覆盖默认表单并将用于选择学生姓名的下拉框替换为多选框 - 这就是我想要的。然而，这种变化只是装饰性的，因为底层代码只从该框中获取第一个选定的名称，并创建一条记录。

有人可以建议一种不需要我解密和重写太多底层 ActiveScaffold 代码的方式来完成此任务的好方法吗？

* * *

更新：我仍然没有找到这个问题的好答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T16:06:16.283

我想你已经定义了你的多选框，将 :multiple => true 添加到 select_tag 的 html 参数中。然后，在控制器中，您需要访问所选名称的列表，您可以这样做：

```
params[:students].collect{|student| insert_student(student, params[:assignment_id]) } 
```

通过将 collect 应用于数组或枚举，您可以遍历该数组的每个项目，然后对每个学生执行您需要的操作（在示例中，调用插入学生的函数）。收集返回一个数组，其中包含执行代码的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T12:52:48.003

我被提到[BatchCreate](http://code.google.com/p/activescaffold-ext/wiki/BatchCreate)，这是一个 ActiveScaffold 扩展，看起来它可以解决问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-13T06:40:11.100

如果您的 assingnments 有`has_many :students`or `has_and_belongs_to_many :students`，那么您可以将多选框的 id 更改为 assignment_student_ids[]，它应该可以工作。

# javascript - 如何将 IE 浏览器窗口大小调整为 1024 x 768

> ID：60030
> 
> 赞同：9
> 
> 时间：2008-09-12T21:46:12.410
> 
> 标签：javascript, internet-explorer

在 Firefox 中，您可以在很棒的栏中输入以下内容并按 Enter：

```
javascript:self.resizeTo(1024,768); 
```

你如何在 IE 中做同样的事情？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-13T00:36:44.310

```
javascript:resizeTo(1024,768);
vbscript:resizeto(1024,768)
```

将在 IE7 中工作，但考虑使用类似的东西

```
javascript:moveTo(0,0);resizeTo(1024,768);
```

因为 IE7 不允许窗口“调整大小”超出屏幕边界。如果您在 1024,768 桌面上工作，会发生这种情况……

*   Firefox：1024x768 窗口，位于任务栏后面。如果你放下 moveTo 部分，窗口的左上角不会改变位置。（你仍然会得到一个 1024x768 的窗口）
*   IE7：在不遮挡任务栏或允许窗口的任何部分超出屏幕边界的情况下，尽可能接近请求的大小。
*   safari：在不遮挡任务栏或允许窗口的任何部分超出屏幕边界的情况下尽可能接近请求的大小，但您可以省略 moveTo 部分。Safari 会为您移动窗口的左上角。
*   Opera：什么都没发生。
*   铬：什么都没有发生。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-12T21:52:31.803

如果您只是在寻找 JavaScript 解决方案，可能没有直接关系，但您可以使用免费的 Windows 实用程序[Sizer](http://www.brianapps.net/sizer.html)自动将任何（浏览器）窗口调整为预定义的大小，如 800x600、1024,768 等。

![在此处输入图像描述](https://i.stack.imgur.com/8v43d.png)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-12T21:58:58.263

您的代码在 IE 中工作，您只需要在安全工具栏中“允许被阻止的内容”

![http://i38.tinypic.com/20uahkl.jpg](https://i.stack.imgur.com/3LZ7b.jpg)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-12T21:49:53.917

尝试：

```
javascript:resizeTo(1024,768); 
```

这至少在 IE7 中有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T21:52:07.170

它适用于 IE6，但我认为 IE7 增加了一些安全性？

# c# - 在“foreach”循环中获取数组键

> ID：60032
> 
> 赞同：28
> 
> 时间：2008-09-12T21:47:17.323
> 
> 标签：c#, arrays

如何`foreach`在 C# 的循环中获取当前元素的键？

例如：

## PHP

```
foreach ($array as $key => $value)
{
    echo("$value is assigned to key: $key");
} 
```

### 我在 C# 中尝试做的事情：

```
int[] values = { 5, 14, 29, 49, 99, 150, 999 };

foreach (int val in values)
{
    if(search <= val && !stop)
    {
         // Set key to a variable
    }
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-12T22:34:50.860

[Grauenwolf 的方式](https://stackoverflow.com/questions/60032/getting-the-array-key-in-a-foreach-loop#60035)是使用数组执行此操作的最直接和最高效的方式：

> 要么使用 for 循环，要么创建一个在每次传递时递增的临时变量。

这当然看起来像这样：

```
int[] values = { 5, 14, 29, 49, 99, 150, 999 };

for (int key = 0; key < values.Length; ++key)
  if (search <= values[key] && !stop)
  {
    // set key to a variable
  } 
```

使用 .NET 3.5，您也可以采用更实用的方法，但它在站点上有点冗长，并且可能依赖于几个[支持函数](http://en.wikipedia.org/wiki/Apply)来[访问](http://en.wikipedia.org/wiki/Visitor_pattern)IEnumerable 中的元素。如果这就是你所需要的一切，那就有点矫枉过正了，但如果你倾向于做大量的收集处理，那就很方便了。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-12T21:58:53.957

如果您想获得关键（阅读：索引），那么您必须使用 for 循环。如果你真的想要一个包含键/值的集合，那么我会考虑使用 HashTable 或 Dictionary （如果你想使用泛型）。

```
Dictionary<int, string> items = new  Dictionary<int, string>();

foreach (int key in items.Keys)
{
  Console.WriteLine("Key: {0} has value: {1}", key, items[key]);
} 
```

希望有帮助，泰勒

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-09-09T19:15:03.133

使用 DictionaryEntry 和 KeyValuePair：

基于
[MSDN](http://msdn.microsoft.com/en-us/library/system.collections.dictionaryentry.aspx)

```
IDictionary<string,string> openWith = new Dictionary<string,string>()
{
   { "txt", "notepad.exe" }
   { "bmp", "paint.exe" }
   { "rtf", "wordpad.exe" }
};

foreach (DictionaryEntry de in openWith)
{
    Console.WriteLine("Key = {0}, Value = {1}", de.Key, de.Value);
}

// also

foreach (KeyValuePair<string,string> de in openWith)
{
    Console.WriteLine("Key = {0}, Value = {1}", de.Key, de.Value);
} 
```

[相关的 SO 问题：KeyValuePair VS DictionaryEntry](https://stackoverflow.com/questions/905424/keyvaluepair-vs-dictionaryentry)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-12T21:48:40.923

唉，没有内置的方法可以做到这一点。要么使用 for 循环，要么创建一个在每次传递时递增的临时变量。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-12T22:38:31.897

我在这个问题的另一个版本中回答了这个问题：

> Foreach 用于迭代实现 IEnumerable 的集合。它通过在集合上调用 GetEnumerator 来完成此操作，这将返回一个 Enumerator。
> 
> 这个 Enumerator 有一个方法和一个属性：
> 
> ```
> * MoveNext()
> * Current 
> ```
> 
> Current 返回 Enumerator 当前所在的对象，MoveNext 将 Current 更新为下一个对象。
> 
> 显然，索引的概念与枚举的概念是陌生的，无法做到。
> 
> 因此，大多数集合都可以使用索引器和 for 循环结构进行遍历。
> 
> 与使用局部变量跟踪索引相比，我更喜欢在这种情况下使用 for 循环。

[您如何获得 foreach 循环的当前迭代的索引？](https://stackoverflow.com/questions/43021/c-get-index-of-current-foreach-iteration#43029)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-12T21:59:59.883

实际上，如果要遍历数组，则应该使用经典的 for (;;) 循环。但是您使用 PHP 代码实现的类似功能可以在 C# 中实现，例如使用 Dictionary：

```
Dictionary<int, int> values = new Dictionary<int, int>();
values[0] = 5;
values[1] = 14;
values[2] = 29;
values[3] = 49;
// whatever...

foreach (int key in values.Keys)
{
    Console.WriteLine("{0} is assigned to key: {1}", values[key], key);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-31T05:29:17.923

这是我刚刚为这个问题提出的解决方案

**原始代码：**

```
int index=0;
foreach (var item in enumerable)
{
    blah(item, index); // some code that depends on the index
    index++;
} 
```

**更新代码**

```
enumerable.ForEach((item, index) => blah(item, index)); 
```

**扩展方法：**

```
 public static IEnumerable<T> ForEach<T>(this IEnumerable<T> enumerable, Action<T, int> action)
    {
        var unit = new Unit(); // unit is a new type from the reactive framework (http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx) to represent a void, since in C# you can't return a void
        enumerable.Select((item, i) => 
            {
                action(item, i);
                return unit;
            }).ToList();

        return pSource;
    } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-31T06:12:08.447

您可以使用扩展方法自己实现此功能。例如，这是一个适用于列表的扩展方法 KeyValuePairs 的实现：

```
public struct IndexValue<T> {
    public int Index {get; private set;}
    public T Value {get; private set;}
    public IndexValue(int index, T value) : this() {
        this.Index = index;
        this.Value = value;
    }
}

public static class EnumExtension
{
    public static IEnumerable<IndexValue<T>> KeyValuePairs<T>(this IList<T> list) {
        for (int i = 0; i < list.Count; i++)
            yield return new IndexValue<T>(i, list[i]);
    }
} 
```

* * *

## 回答 #9

> 赞同：-10
> 
> 时间：2008-09-12T21:53:34.420

`myKey = Array.IndexOf(values, val);`

# ruby-on-rails - 复制 activerecord 记录的最简单方法是什么？

> ID：60033
> 
> 赞同：444
> 
> 时间：2008-09-12T21:48:04.140
> 
> 标签：ruby-on-rails, ruby, rails-activerecord

我想复制一个 ActiveRecord 对象，更改过程中的单个字段（除了**id**）。完成此任务的最简单方法是什么？

我意识到我可以创建一个新记录，然后遍历每个字段，逐个字段地复制数据 - 但我认为必须有一种更简单的方法来做到这一点。

也许是这样的：

```
 new_record = Record.copy(:id) 
```

* * *

## 回答 #1

> 赞同：667
> 
> 时间：2008-09-12T21:56:44.727

要获取副本，请使用[dup](https://api.rubyonrails.org/classes/ActiveRecord/Core.html#method-i-dup)（或 clone for < rails 3.1+）方法：

```
#rails >= 3.1
new_record = old_record.dup

# rails < 3.1
new_record = old_record.clone 
```

然后，您可以更改所需的任何字段。

[ActiveRecord 覆盖内置的 Object#clone](http://api.rubyonrails.com/classes/ActiveRecord/Base.html#M001363)为您提供一个未分配 ID 的新记录（未保存到数据库中）。
请注意，它不会复制关联，因此如果需要，您必须手动执行此操作。

[Rails 3.1 克隆是浅拷贝，请使用 dup 代替...](https://gist.github.com/994614)

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2008-09-15T13:48:34.157

根据您的需要和编程风格，您还可以使用类的新方法和合并的组合。由于缺少更好的*简单*示例，假设您有一个任务安排在某个日期，并且您想将其复制到另一个日期。任务的实际属性并不重要，因此：

```
old_task = Task.find(task_id)
new_task = Task.new(old_task.attributes.merge({:scheduled_on => some_new_date}))

```

将创建一个新任务`:id => nil`，其`:scheduled_on => some_new_date`、 和所有其他属性与原始任务相同。使用 Task.new，您必须显式调用 save，因此如果您希望它自动保存，请将 Task.new 更改为 Task.create。

和平。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2012-02-28T16:12:44.453

您可能还喜欢 ActiveRecord 3.2 的[Amoeba gem](https://rubygems.org/gems/amoeba)。

在您的情况下，您可能希望使用配置 DSL 中可用的`nullify`、`regex`或`prefix`选项。

它支持简单和自动的递归复制`has_one`、关联、字段预处理`has_many`和`has_and_belongs_to_many`高度灵活且功能强大的配置 DSL，可以同时应用于模型和动态。

请务必查看[Amoeba 文档](https://github.com/rocksolidwebdesign/amoeba#readme)，但使用起来非常简单......

只是

```
gem install amoeba 
```

或添加

```
gem 'amoeba' 
```

到您的 Gemfile

然后将变形虫块添加到您的模型中并`dup`像往常一样运行该方法

```
class Post < ActiveRecord::Base
  has_many :comments
  has_and_belongs_to_many :tags

  amoeba do
    enable
  end
end

class Comment < ActiveRecord::Base
  belongs_to :post
end

class Tag < ActiveRecord::Base
  has_and_belongs_to_many :posts
end

class PostsController < ActionController
  def some_method
    my_post = Post.find(params[:id])
    new_post = my_post.dup
    new_post.save
  end
end 
```

您还可以通过多种方式控制复制哪些字段，但是例如，如果您想防止注释被复制但又想保持相同的标签，则可以执行以下操作：

```
class Post < ActiveRecord::Base
  has_many :comments
  has_and_belongs_to_many :tags

  amoeba do
    exclude_field :comments
  end
end 
```

您还可以预处理字段以帮助指示前缀和后缀以及正则表达式的唯一性。此外，还有许多选项，因此您可以根据自己的目的以最易读的风格编写：

```
class Post < ActiveRecord::Base
  has_many :comments
  has_and_belongs_to_many :tags

  amoeba do
    include_field :tags
    prepend :title => "Copy of "
    append :contents => " (copied version)"
    regex :contents => {:replace => /dog/, :with => "cat"}
  end
end 
```

关联的递归复制很容易，只需在子模型上启用变形虫

```
class Post < ActiveRecord::Base
  has_many :comments

  amoeba do
    enable
  end
end

class Comment < ActiveRecord::Base
  belongs_to :post
  has_many :ratings

  amoeba do
    enable
  end
end

class Rating < ActiveRecord::Base
  belongs_to :comment
end 
```

配置 DSL 有更多选项，因此请务必查看文档。

享受！:)

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2011-08-05T13:59:20.313

如果您不想复制 id，请使用[ActiveRecord::Base#dup](http://api.rubyonrails.org/classes/ActiveRecord/Core.html#method-i-dup)

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2008-09-15T13:36:15.340

我通常只是复制属性，更改我需要更改的任何内容：

```
new_user = User.new(old_user.attributes.merge(:login => "newlogin")) 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2011-09-01T02:22:49.767

如果您需要带有关联的深层副本，我推荐[deep_cloneable](https://github.com/moiristo/deep_cloneable) gem。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2019-01-04T08:56:28.900

在 Rails 5 中，您可以像这样简单地创建重复的对象或记录。

```
new_user = old_user.dup 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-08-20T07:04:13.343

这是一个覆盖 ActiveRecord`#dup`方法的示例，用于自定义实例复制并包括关系复制：

```
class Offer < ApplicationRecord
  has_many :offer_items

  def dup
    super.tap do |new_offer|

      # change title of the new instance
      new_offer.title = "Copy of #{@offer.title}"

      # duplicate offer_items as well
      self.offer_items.each { |offer_item| new_offer.offer_items << offer_item.dup }
    end
  end
end 
```

注意：此方法不需要任何外部 gem，但需要更新的 ActiveRecord 版本并`#dup`实现方法

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-10-30T13:58:00.290

简单的方法是：

```
#your rails >= 3.1 (i was done it with Rails 5.0.0.1)
  o = Model.find(id)
 # (Range).each do |item|
 (1..109).each do |item|
   new_record = o.dup
   new_record.save
 end 
```

或者

```
# if your rails < 3.1
 o = Model.find(id)
 (1..109).each do |item|
   new_record = o.clone
   new_record.save
 end 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-10-27T22:27:24.553

您还可以检查[acts_as_inheritable](https://github.com/esbanarango/acts_as_inheritable) gem。

“Acts As Inheritable 是专门为 Rails/ActiveRecord 模型编写的 Ruby Gem。它旨在与[Self-Referential Association](https://github.com/esbanarango/acts_as_inheritable#self-referential-association)或具有共享可继承属性的父模型一起使用。这将让您继承任何属性或来自父模型的关系。”

通过添加`acts_as_inheritable`到您的模型中，您将可以访问这些方法：

**继承属性**

```
class Person < ActiveRecord::Base

  acts_as_inheritable attributes: %w(favorite_color last_name soccer_team)

  # Associations
  belongs_to  :parent, class_name: 'Person'
  has_many    :children, class_name: 'Person', foreign_key: :parent_id
end

parent = Person.create(last_name: 'Arango', soccer_team: 'Verdolaga', favorite_color:'Green')

son = Person.create(parent: parent)
son.inherit_attributes
son.last_name # => Arango
son.soccer_team # => Verdolaga
son.favorite_color # => Green 
```

**继承关系**

```
class Person < ActiveRecord::Base

  acts_as_inheritable associations: %w(pet)

  # Associations
  has_one     :pet
end

parent = Person.create(last_name: 'Arango')
parent_pet = Pet.create(person: parent, name: 'Mango', breed:'Golden Retriver')
parent_pet.inspect #=> #<Pet id: 1, person_id: 1, name: "Mango", breed: "Golden Retriver">

son = Person.create(parent: parent)
son.inherit_relations
son.pet.inspect # => #<Pet id: 2, person_id: 2, name: "Mango", breed: "Golden Retriver"> 
```

希望这可以帮到你。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-03-16T14:19:17.963

由于可能存在更多逻辑，因此在复制模型时，我建议创建一个新类，您可以在其中处理所有需要的逻辑。为了缓解这种情况，有一种宝石可以提供帮助：[小丑](https://github.com/palkan/clowne)

根据他们的文档示例，对于用户模型：

```
class User < ActiveRecord::Base
  # create_table :users do |t|
  #  t.string :login
  #  t.string :email
  #  t.timestamps null: false
  # end

  has_one :profile
  has_many :posts
end 
```

您创建克隆器类：

```
class UserCloner < Clowne::Cloner
  adapter :active_record

  include_association :profile, clone_with: SpecialProfileCloner
  include_association :posts

  nullify :login

  # params here is an arbitrary Hash passed into cloner
  finalize do |_source, record, params|
    record.email = params[:email]
  end
end

class SpecialProfileCloner < Clowne::Cloner
  adapter :active_record

  nullify :name
end 
```

然后使用它：

```
user = User.last
#=> <#User(login: 'clown', email: 'clown@circus.example.com')>

cloned = UserCloner.call(user, email: 'fake@example.com')
cloned.persisted?
# => false

cloned.save!
cloned.login
# => nil
cloned.email
# => "fake@example.com"

# associations:
cloned.posts.count == user.posts.count
# => true
cloned.profile.name
# => nil 
```

从项目中复制的示例，但它将清楚地说明您可以实现的目标。

**为了快速简单的记录，我会选择：**

`Model.new(Model.last.attributes.reject {|k,_v| k.to_s == 'id'}`

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-04-04T17:21:36.080

试试rails的`dup`方法：

```
new_record = old_record.dup.save 
```

# windows - How can you find and replace text in a file using the Windows command-line environment?

> ID：60034
> 
> 赞同：557
> 
> 时间：2008-09-12T21:48:26.617
> 
> 标签：windows, command-line, scripting, batch-file, text-files

I am writing a batch file script using Windows command-line environment and want to change each occurrence of some text in a file (ex. "FOO") with another (ex. "BAR"). What is the simplest way to do that? Any built in functions?

* * *

## 回答 #1

> 赞同：391
> 
> 时间：2014-01-08T15:01:35.567

A lot of the answers here helped point me in the right direction, however none were suitable for me, so I am posting my solution.

I have Windows 7, which comes with PowerShell built-in. Here is the script I used to find/replace all instances of text in a file:

```
powershell -Command "(gc myFile.txt) -replace 'foo', 'bar' | Out-File -encoding ASCII myFile.txt" 
```

To explain it:

*   `powershell` starts up powershell.exe, which is included in Windows 7
*   `-Command "... "` is a command line arg for powershell.exe containing the command to run
*   `(gc myFile.txt)` reads the content of `myFile.txt` (`gc` is short for the `Get-Content` command)
*   `-replace 'foo', 'bar'` simply runs the replace command to replace `foo` with `bar`
*   `| Out-File myFile.txt` pipes the output to the file `myFile.txt`
*   `-encoding ASCII` prevents transcribing the output file to unicode, as the comments point out

Powershell.exe should be part of your PATH statement already, but if not you can add it. The location of it on my machine is `C:\WINDOWS\system32\WindowsPowerShell\v1.0`

**Update**
Apparently modern windows systems have PowerShell built in allowing you to access this directly using

```
(Get-Content myFile.txt) -replace 'foo', 'bar' | Out-File -encoding ASCII myFile.txt 
```

* * *

## 回答 #2

> 赞同：187
> 
> 时间：2008-09-12T22:01:49.893

If you are on Windows version that supports .Net 2.0, I would replace your shell. [PowerShell](http://en.wikipedia.org/wiki/Windows_PowerShell) gives you the full power of .Net from the command line. There are many commandlets built in as well. The example below will solve your question. I'm using the full names of the commands, there are shorter aliases, but this gives you something to Google for.

```
(Get-Content test.txt) | ForEach-Object { $_ -replace "foo", "bar" } | Set-Content test2.txt 
```

* * *

## 回答 #3

> 赞同：175
> 
> 时间：2010-03-02T12:34:36.493

Just used **[FART](http://fart-it.sourceforge.net/)** ("**F** ind **A** nd **R** eplace **T** ext" command line utility):
excellent little freeware for text replacement within a large set of files.

The setup files [are on SourceForge](http://sourceforge.net/projects/fart-it/files/).

Usage example:

```
fart.exe -p -r -c -- C:\tools\perl-5.8.9\* @@APP_DIR@@ C:\tools 
```

will preview the replacements to do recursively in the files of this Perl distribution.

Only problem: the FART website icon isn't exactly tasteful, refined or elegant ;)

* * *

Update 2017 (7 years later) [jagb](https://stackoverflow.com/users/3217130/jagb) points out [in the comments](https://stackoverflow.com/questions/60034/how-can-you-find-and-replace-text-in-a-file-using-the-windows-command-line-envir/2363075#comment72538743_2363075) to the 2011 article "[FARTing the Easy Way – Find And Replace Text](https://emtunc.org/blog/03/2011/farting-the-easy-way-find-and-replace-text/)" from [Mikail Tunç](https://emtunc.org/blog/about/)

* * *

As noted by [Joe Jobs](https://stackoverflow.com/users/7058553/joe-jobs) in [the comments](https://stackoverflow.com/questions/60034/how-can-you-find-and-replace-text-in-a-file-using-the-windows-command-line-envir/2363075?noredirect=1#comment115826648_2363075) (Dec. 2020), if you want to replace `&A` for instance, you would need to use quotes in order to make sure `&` is not interpreted by the shell:

```
fart in.txt "&A" "B" 
```

* * *

## 回答 #4

> 赞同：138
> 
> 时间：2011-05-28T01:25:35.673

Replace - Replace a substring using string substitution Description: To replace a substring with another string use the string substitution feature. The example shown here replaces all occurrences "teh" misspellings with "the" in the string variable str.

```
set str=teh cat in teh hat
echo.%str%
set str=%str:teh=the%
echo.%str% 
```

Script Output:

```
teh cat in teh hat
the cat in the hat 
```

ref: [http://www.dostips.com/DtTipsStringManipulation.php#Snippets.Replace](http://www.dostips.com/DtTipsStringManipulation.php#Snippets.Replace)

* * *

## 回答 #5

> 赞同：60
> 
> 时间：2010-09-27T04:22:47.917

Create file replace.vbs:

```
Const ForReading = 1    
Const ForWriting = 2

strFileName = Wscript.Arguments(0)
strOldText = Wscript.Arguments(1)
strNewText = Wscript.Arguments(2)

Set objFSO = CreateObject("Scripting.FileSystemObject")
Set objFile = objFSO.OpenTextFile(strFileName, ForReading)
strText = objFile.ReadAll
objFile.Close

strNewText = Replace(strText, strOldText, strNewText)
Set objFile = objFSO.OpenTextFile(strFileName, ForWriting)
objFile.Write strNewText  'WriteLine adds extra CR/LF
objFile.Close 
```

To use this revised script (which we’ll call replace.vbs) just type a command similar to this from the command prompt:

`cscript replace.vbs "C:\Scripts\Text.txt" "Jim " "James "`

* * *

## 回答 #6

> 赞同：51
> 
> 时间：2008-09-15T17:14:09.530

[`BatchSubstitute.bat` on dostips.com](http://www.dostips.com/DtCodeBatchFiles.php#Batch.FindAndReplace) is an example of search and replace using a pure batch file.

It uses a combination of `FOR`, `FIND` and `CALL SET`.

Lines containing characters among `"&<>]|^` may be treated incorrectly.

* * *

* * *

## 回答 #7

> 赞同：51
> 
> 时间：2013-05-24T12:32:29.357

***Note*** *- Be sure to see the update at the end of this answer for a link to the superior JREPL.BAT that supersedes REPL.BAT*
*[JREPL.BAT 7.0 and above](http://www.dostips.com/forum/viewtopic.php?f=3&t=6044) natively supports unicode (UTF-16LE) via the `/UTF` option, as well as any other character set, including UTF-8, via ADO!!!!*

* * *

[I have written a small hybrid JScript/batch utility called REPL.BAT](http://www.dostips.com/forum/viewtopic.php?f=3&t=3855) that is very convenient for modifying ASCII (or extended ASCII) files via the command line or a batch file. The purely native script does not require installation of any 3rd party executeable, and it works on any modern Windows version from XP onward. It is also very fast, especially when compared to pure batch solutions.

REPL.BAT simply reads stdin, performs a JScript regex search and replace, and writes the result to stdout.

Here is a trivial example of how to replace foo with bar in test.txt, assuming REPL.BAT is in your current folder, or better yet, somewhere within your PATH:

```
type test.txt|repl "foo" "bar" >test.txt.new
move /y test.txt.new test.txt 
```

The JScript regex capabilities make it very powerful, especially the ability of the replacement text to reference captured substrings from the search text.

I've included a number of options in the utility that make it quite powerful. For example, combining the `M` and `X` options enable modification of binary files! The `M` Multi-line option allows searches across multiple lines. The `X` eXtended substitution pattern option provides escape sequences that enable inclusion of any binary value in the replacement text.

The entire utility could have been written as pure JScript, but the hybrid batch file eliminates the need to explicitly specify CSCRIPT every time you want to use the utility.

Here is the REPL.BAT script. Full documentation is embedded within the script.

```
@if (@X)==(@Y) @end /* Harmless hybrid line that begins a JScript comment

::************ Documentation ***********
::REPL.BAT version 6.2
:::
:::REPL  Search  Replace  [Options  [SourceVar]]
:::REPL  /?[REGEX|REPLACE]
:::REPL  /V
:::
:::  Performs a global regular expression search and replace operation on
:::  each line of input from stdin and prints the result to stdout.
:::
:::  Each parameter may be optionally enclosed by double quotes. The double
:::  quotes are not considered part of the argument. The quotes are required
:::  if the parameter contains a batch token delimiter like space, tab, comma,
:::  semicolon. The quotes should also be used if the argument contains a
:::  batch special character like &, |, etc. so that the special character
:::  does not need to be escaped with ^.
:::
:::  If called with a single argument of /?, then prints help documentation
:::  to stdout. If a single argument of /?REGEX, then opens up Microsoft's
:::  JScript regular expression documentation within your browser. If a single
:::  argument of /?REPLACE, then opens up Microsoft's JScript REPLACE
:::  documentation within your browser.
:::
:::  If called with a single argument of /V, case insensitive, then prints
:::  the version of REPL.BAT.
:::
:::  Search  - By default, this is a case sensitive JScript (ECMA) regular
:::            expression expressed as a string.
:::
:::            JScript regex syntax documentation is available at
:::            http://msdn.microsoft.com/en-us/library/ae5bf541(v=vs.80).aspx
:::
:::  Replace - By default, this is the string to be used as a replacement for
:::            each found search expression. Full support is provided for
:::            substituion patterns available to the JScript replace method.
:::
:::            For example, $& represents the portion of the source that matched
:::            the entire search pattern, $1 represents the first captured
:::            submatch, $2 the second captured submatch, etc. A $ literal
:::            can be escaped as $$.
:::
:::            An empty replacement string must be represented as "".
:::
:::            Replace substitution pattern syntax is fully documented at
:::            http://msdn.microsoft.com/en-US/library/efy6s3e6(v=vs.80).aspx
:::
:::  Options - An optional string of characters used to alter the behavior
:::            of REPL. The option characters are case insensitive, and may
:::            appear in any order.
:::
:::            A - Only print altered lines. Unaltered lines are discarded.
:::                If the S options is present, then prints the result only if
:::                there was a change anywhere in the string. The A option is
:::                incompatible with the M option unless the S option is present.
:::
:::            B - The Search must match the beginning of a line.
:::                Mostly used with literal searches.
:::
:::            E - The Search must match the end of a line.
:::                Mostly used with literal searches.
:::
:::            I - Makes the search case-insensitive.
:::
:::            J - The Replace argument represents a JScript expression.
:::                The expression may access an array like arguments object
:::                named $. However, $ is not a true array object.
:::
:::                The $.length property contains the total number of arguments
:::                available. The $.length value is equal to n+3, where n is the
:::                number of capturing left parentheses within the Search string.
:::
:::                $[0] is the substring that matched the Search,
:::                $[1] through $[n] are the captured submatch strings,
:::                $[n+1] is the offset where the match occurred, and
:::                $[n+2] is the original source string.
:::
:::                Arguments $[0] through $[10] may be abbreviated as
:::                $1 through $10\. Argument $[11] and above must use the square
:::                bracket notation.
:::
:::            L - The Search is treated as a string literal instead of a
:::                regular expression. Also, all $ found in the Replace string
:::                are treated as $ literals.
:::
:::            M - Multi-line mode. The entire contents of stdin is read and
:::                processed in one pass instead of line by line, thus enabling
:::                search for \n. This also enables preservation of the original
:::                line terminators. If the M option is not present, then every
:::                printed line is terminated with carriage return and line feed.
:::                The M option is incompatible with the A option unless the S
:::                option is also present.
:::
:::                Note: If working with binary data containing NULL bytes,
:::                      then the M option must be used.
:::
:::            S - The source is read from an environment variable instead of
:::                from stdin. The name of the source environment variable is
:::                specified in the next argument after the option string. Without
:::                the M option, ^ anchors the beginning of the string, and $ the
:::                end of the string. With the M option, ^ anchors the beginning
:::                of a line, and $ the end of a line.
:::
:::            V - Search and Replace represent the name of environment
:::                variables that contain the respective values. An undefined
:::                variable is treated as an empty string.
:::
:::            X - Enables extended substitution pattern syntax with support
:::                for the following escape sequences within the Replace string:
:::
:::                \\     -  Backslash
:::                \b     -  Backspace
:::                \f     -  Formfeed
:::                \n     -  Newline
:::                \q     -  Quote
:::                \r     -  Carriage Return
:::                \t     -  Horizontal Tab
:::                \v     -  Vertical Tab
:::                \xnn   -  Extended ASCII byte code expressed as 2 hex digits
:::                \unnnn -  Unicode character expressed as 4 hex digits
:::
:::                Also enables the \q escape sequence for the Search string.
:::                The other escape sequences are already standard for a regular
:::                expression Search string.
:::
:::                Also modifies the behavior of \xnn in the Search string to work
:::                properly with extended ASCII byte codes.
:::
:::                Extended escape sequences are supported even when the L option
:::                is used. Both Search and Replace support all of the extended
:::                escape sequences if both the X and L opions are combined.
:::
:::  Return Codes:  0 = At least one change was made
:::                     or the /? or /V option was used
:::
:::                 1 = No change was made
:::
:::                 2 = Invalid call syntax or incompatible options
:::
:::                 3 = JScript runtime error, typically due to invalid regex
:::
::: REPL.BAT was written by Dave Benham, with assistance from DosTips user Aacini
::: to get \xnn to work properly with extended ASCII byte codes. Also assistance
::: from DosTips user penpen diagnosing issues reading NULL bytes, along with a
::: workaround. REPL.BAT was originally posted at:
::: http://www.dostips.com/forum/viewtopic.php?f=3&t=3855
:::

::************ Batch portion ***********
@echo off
if .%2 equ . (
  if "%~1" equ "/?" (
    <"%~f0" cscript //E:JScript //nologo "%~f0" "^:::" "" a
    exit /b 0
  ) else if /i "%~1" equ "/?regex" (
    explorer "http://msdn.microsoft.com/en-us/library/ae5bf541(v=vs.80).aspx"
    exit /b 0
  ) else if /i "%~1" equ "/?replace" (
    explorer "http://msdn.microsoft.com/en-US/library/efy6s3e6(v=vs.80).aspx"
    exit /b 0
  ) else if /i "%~1" equ "/V" (
    <"%~f0" cscript //E:JScript //nologo "%~f0" "^::(REPL\.BAT version)" "$1" a
    exit /b 0
  ) else (
    call :err "Insufficient arguments"
    exit /b 2
  )
)
echo(%~3|findstr /i "[^SMILEBVXAJ]" >nul && (
  call :err "Invalid option(s)"
  exit /b 2
)
echo(%~3|findstr /i "M"|findstr /i "A"|findstr /vi "S" >nul && (
  call :err "Incompatible options"
  exit /b 2
)
cscript //E:JScript //nologo "%~f0" %*
exit /b %errorlevel%

:err
>&2 echo ERROR: %~1\. Use REPL /? to get help.
exit /b

************* JScript portion **********/
var rtn=1;
try {
  var env=WScript.CreateObject("WScript.Shell").Environment("Process");
  var args=WScript.Arguments;
  var search=args.Item(0);
  var replace=args.Item(1);
  var options="g";
  if (args.length>2) options+=args.Item(2).toLowerCase();
  var multi=(options.indexOf("m")>=0);
  var alterations=(options.indexOf("a")>=0);
  if (alterations) options=options.replace(/a/g,"");
  var srcVar=(options.indexOf("s")>=0);
  if (srcVar) options=options.replace(/s/g,"");
  var jexpr=(options.indexOf("j")>=0);
  if (jexpr) options=options.replace(/j/g,"");
  if (options.indexOf("v")>=0) {
    options=options.replace(/v/g,"");
    search=env(search);
    replace=env(replace);
  }
  if (options.indexOf("x")>=0) {
    options=options.replace(/x/g,"");
    if (!jexpr) {
      replace=replace.replace(/\\\\/g,"\\B");
      replace=replace.replace(/\\q/g,"\"");
      replace=replace.replace(/\\x80/g,"\\u20AC");
      replace=replace.replace(/\\x82/g,"\\u201A");
      replace=replace.replace(/\\x83/g,"\\u0192");
      replace=replace.replace(/\\x84/g,"\\u201E");
      replace=replace.replace(/\\x85/g,"\\u2026");
      replace=replace.replace(/\\x86/g,"\\u2020");
      replace=replace.replace(/\\x87/g,"\\u2021");
      replace=replace.replace(/\\x88/g,"\\u02C6");
      replace=replace.replace(/\\x89/g,"\\u2030");
      replace=replace.replace(/\\x8[aA]/g,"\\u0160");
      replace=replace.replace(/\\x8[bB]/g,"\\u2039");
      replace=replace.replace(/\\x8[cC]/g,"\\u0152");
      replace=replace.replace(/\\x8[eE]/g,"\\u017D");
      replace=replace.replace(/\\x91/g,"\\u2018");
      replace=replace.replace(/\\x92/g,"\\u2019");
      replace=replace.replace(/\\x93/g,"\\u201C");
      replace=replace.replace(/\\x94/g,"\\u201D");
      replace=replace.replace(/\\x95/g,"\\u2022");
      replace=replace.replace(/\\x96/g,"\\u2013");
      replace=replace.replace(/\\x97/g,"\\u2014");
      replace=replace.replace(/\\x98/g,"\\u02DC");
      replace=replace.replace(/\\x99/g,"\\u2122");
      replace=replace.replace(/\\x9[aA]/g,"\\u0161");
      replace=replace.replace(/\\x9[bB]/g,"\\u203A");
      replace=replace.replace(/\\x9[cC]/g,"\\u0153");
      replace=replace.replace(/\\x9[dD]/g,"\\u009D");
      replace=replace.replace(/\\x9[eE]/g,"\\u017E");
      replace=replace.replace(/\\x9[fF]/g,"\\u0178");
      replace=replace.replace(/\\b/g,"\b");
      replace=replace.replace(/\\f/g,"\f");
      replace=replace.replace(/\\n/g,"\n");
      replace=replace.replace(/\\r/g,"\r");
      replace=replace.replace(/\\t/g,"\t");
      replace=replace.replace(/\\v/g,"\v");
      replace=replace.replace(/\\x[0-9a-fA-F]{2}|\\u[0-9a-fA-F]{4}/g,
        function($0,$1,$2){
          return String.fromCharCode(parseInt("0x"+$0.substring(2)));
        }
      );
      replace=replace.replace(/\\B/g,"\\");
    }
    search=search.replace(/\\\\/g,"\\B");
    search=search.replace(/\\q/g,"\"");
    search=search.replace(/\\x80/g,"\\u20AC");
    search=search.replace(/\\x82/g,"\\u201A");
    search=search.replace(/\\x83/g,"\\u0192");
    search=search.replace(/\\x84/g,"\\u201E");
    search=search.replace(/\\x85/g,"\\u2026");
    search=search.replace(/\\x86/g,"\\u2020");
    search=search.replace(/\\x87/g,"\\u2021");
    search=search.replace(/\\x88/g,"\\u02C6");
    search=search.replace(/\\x89/g,"\\u2030");
    search=search.replace(/\\x8[aA]/g,"\\u0160");
    search=search.replace(/\\x8[bB]/g,"\\u2039");
    search=search.replace(/\\x8[cC]/g,"\\u0152");
    search=search.replace(/\\x8[eE]/g,"\\u017D");
    search=search.replace(/\\x91/g,"\\u2018");
    search=search.replace(/\\x92/g,"\\u2019");
    search=search.replace(/\\x93/g,"\\u201C");
    search=search.replace(/\\x94/g,"\\u201D");
    search=search.replace(/\\x95/g,"\\u2022");
    search=search.replace(/\\x96/g,"\\u2013");
    search=search.replace(/\\x97/g,"\\u2014");
    search=search.replace(/\\x98/g,"\\u02DC");
    search=search.replace(/\\x99/g,"\\u2122");
    search=search.replace(/\\x9[aA]/g,"\\u0161");
    search=search.replace(/\\x9[bB]/g,"\\u203A");
    search=search.replace(/\\x9[cC]/g,"\\u0153");
    search=search.replace(/\\x9[dD]/g,"\\u009D");
    search=search.replace(/\\x9[eE]/g,"\\u017E");
    search=search.replace(/\\x9[fF]/g,"\\u0178");
    if (options.indexOf("l")>=0) {
      search=search.replace(/\\b/g,"\b");
      search=search.replace(/\\f/g,"\f");
      search=search.replace(/\\n/g,"\n");
      search=search.replace(/\\r/g,"\r");
      search=search.replace(/\\t/g,"\t");
      search=search.replace(/\\v/g,"\v");
      search=search.replace(/\\x[0-9a-fA-F]{2}|\\u[0-9a-fA-F]{4}/g,
        function($0,$1,$2){
          return String.fromCharCode(parseInt("0x"+$0.substring(2)));
        }
      );
      search=search.replace(/\\B/g,"\\");
    } else search=search.replace(/\\B/g,"\\\\");
  }
  if (options.indexOf("l")>=0) {
    options=options.replace(/l/g,"");
    search=search.replace(/([.^$*+?()[{\\|])/g,"\\$1");
    if (!jexpr) replace=replace.replace(/\$/g,"$$$$");
  }
  if (options.indexOf("b")>=0) {
    options=options.replace(/b/g,"");
    search="^"+search
  }
  if (options.indexOf("e")>=0) {
    options=options.replace(/e/g,"");
    search=search+"$"
  }
  var search=new RegExp(search,options);
  var str1, str2;

  if (srcVar) {
    str1=env(args.Item(3));
    str2=str1.replace(search,jexpr?replFunc:replace);
    if (!alterations || str1!=str2) if (multi) {
      WScript.Stdout.Write(str2);
    } else {
      WScript.Stdout.WriteLine(str2);
    }
    if (str1!=str2) rtn=0;
  } else if (multi){
    var buf=1024;
    str1="";
    while (!WScript.StdIn.AtEndOfStream) {
      str1+=WScript.StdIn.Read(buf);
      buf*=2
    }
    str2=str1.replace(search,jexpr?replFunc:replace);
    WScript.Stdout.Write(str2);
    if (str1!=str2) rtn=0;
  } else {
    while (!WScript.StdIn.AtEndOfStream) {
      str1=WScript.StdIn.ReadLine();
      str2=str1.replace(search,jexpr?replFunc:replace);
      if (!alterations || str1!=str2) WScript.Stdout.WriteLine(str2);
      if (str1!=str2) rtn=0;
    }
  }
} catch(e) {
  WScript.Stderr.WriteLine("JScript runtime error: "+e.message);
  rtn=3;
}
WScript.Quit(rtn);

function replFunc($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10) {
  var $=arguments;
  return(eval(replace));
} 
```

***IMPORTANT UPDATE***

I have ceased development of REPL.BAT, and replaced it with JREPL.BAT. This newer utility has all the same functionality of REPL.BAT, plus much more:

*   Unicode UTF-16LE support via native CSCRIPT unicode capabilities, and any other character set (including UTF-8) via ADO.
*   Read directly from / write directly to a file: no need for pipes, redirection, or move command.
*   Incorporate user supplied JScript
*   Translation facility similar to unix tr, only it also supports regex search and JScript replace
*   Discard non-matching text
*   Prefix output lines with line number
*   and more...

As always, full documentation is embedded within the script.

The original trivial solution is now even simpler:

```
jrepl "foo" "bar" /f test.txt /o - 
```

[The current version of JREPL.BAT is available at DosTips](http://www.dostips.com/forum/viewtopic.php?f=3&t=6044). Read all of the subsequent posts in the thread to see examples of usage and a history of the development.

* * *

## 回答 #8

> 赞同：41
> 
> 时间：2013-01-18T09:45:46.343

# Use FNR

Use the `fnr` utility. It's got some advantages over `fart`:

*   Regular expressions
*   Optional GUI. Has a "Generate command line button" to create command line text to put in batch file.
*   Multi-line patterns: The GUI allows you to easily work with multi-line patterns. In FART you'd have to manually escape line breaks.
*   Allows you to select text file encoding. Also has an auto detect option.

Download FNR here: [http://findandreplace.io/?z=codeplex](http://findandreplace.io/?z=codeplex)

Usage example: `fnr --cl --dir "<Directory Path>" --fileMask "hibernate.*" --useRegEx --find "find_str_expression" --replace "replace_string"`

* * *

## 回答 #9

> 赞同：28
> 
> 时间：2014-11-12T18:45:44.750

I know I am late to the party..

Personally, I like the solution at: - [http://www.dostips.com/DtTipsStringManipulation.php#Snippets.Replace](http://www.dostips.com/DtTipsStringManipulation.php#Snippets.Replace)

We also, use the Dedupe Function extensively to help us deliver approximately 500 e-mails daily via SMTP from: - [https://groups.google.com/forum/#!topic/alt.msdos.batch.nt/sj8IUhMOq6o](https://groups.google.com/forum/#!topic/alt.msdos.batch.nt/sj8IUhMOq6o)

and these both work natively with no extra tools or utilities needed.

REPLACER:

```
DEL New.txt
setLocal EnableDelayedExpansion
For /f "tokens=* delims= " %%a in (OLD.txt) do (
Set str=%%a
set str=!str:FOO=BAR!
echo !str!>>New.txt
)
ENDLOCAL 
```

DEDUPLICATOR (note the use of -9 for an ABA number):

```
REM DE-DUPLICATE THE Mapping.txt FILE
REM THE DE-DUPLICATED FILE IS STORED AS new.txt

set MapFile=Mapping.txt
set ReplaceFile=New.txt

del %ReplaceFile%
::DelDupeText.bat
rem https://groups.google.com/forum/#!topic/alt.msdos.batch.nt/sj8IUhMOq6o
setLocal EnableDelayedExpansion
for /f "tokens=1,2 delims=," %%a in (%MapFile%) do (
set str=%%a
rem Ref: http://www.dostips.com/DtTipsStringManipulation.php#Snippets.RightString
set str=!str:~-9!
set str2=%%a
set str3=%%a,%%b

find /i ^"!str!^" %MapFile%
find /i ^"!str!^" %ReplaceFile%
if errorlevel 1 echo !str3!>>%ReplaceFile%
)
ENDLOCAL 
```

Thanks!

* * *

## 回答 #10

> 赞同：27
> 
> 时间：2008-09-12T21:57:06.533

I don't think there's a way to do it with any built-in commands. I would suggest you download something like [Gnuwin32](http://gnuwin32.sourceforge.net/) or [UnxUtils](http://unxutils.sourceforge.net/) and use the `sed` command (or download only [`sed`](http://gnuwin32.sourceforge.net/packages/sed.htm)):

```
sed -c s/FOO/BAR/g filename 
```

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2015-11-17T16:22:57.727

When you work with [**Git on Windows**](https://git-for-windows.github.io/) then simply fire up **`git-bash`** and use **`sed`**. Or, when using Windows 10, start "Bash on Ubuntu on Windows" (from the Linux subsystem) and use **`sed`**.

Its a stream editor, but can edit files directly by using the following command:

```
sed -i -e 's/foo/bar/g' filename 
```

*   `-i` option is used to edit in place on filename.
*   `-e` option indicates a command to run.
    *   `s` is used to replace the found expression "foo" with "bar" and `g` is used to replace any found matches.

* * *

Note by ereOn:

If you want to replace a string in versioned files only of a Git repository, you may want to use:

`git ls-files <eventual subfolders & filters> | xargs sed -i -e 's/foo/bar/g'`

which works wonders.

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2012-05-08T00:00:04.920

I played around with some of the existing answers here and prefer my improved solution...

```
type test.txt | powershell -Command "$input | ForEach-Object { $_ -replace \"foo\", \"bar\" }" 
```

or if you want to save the output again to a file...

```
type test.txt | powershell -Command "$input | ForEach-Object { $_ -replace \"foo\", \"bar\" }" > outputFile.txt 
```

The benefit of this is that you can pipe in output from any program. Will look into using regular expressions with this too. Couldn't work out how to make it into a BAT file for easier use though... :-(

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2010-12-09T19:33:32.460

I have used perl, and that works marvelously.

```
perl -pi.orig -e "s/<textToReplace>/<textToReplaceWith>/g;" <fileName> 
```

.orig is the extension it would append to the original file

For a number of files matching such as *.html

```
for %x in (<filePattern>) do perl -pi.orig -e "s/<textToReplace>/<textToReplaceWith>/g;" %x 
```

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2015-10-15T13:05:21.937

With the [replacer.bat](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/jscript/replacer.bat)

1) With `e?` option that will evaluate special character sequences like `\n\r` and unicode sequences. In this case will replace quoted `"Foo"` and `"Bar"`:

```
call replacer.bat "e?C:\content.txt" "\u0022Foo\u0022" "\u0022Bar\u0022" 
```

2) Straightforward replacing where the `Foo` and `Bar` are not quoted.

```
call replacer.bat "C:\content.txt" "Foo" "Bar" 
```

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2010-03-10T18:03:18.420

Here's a solution that I found worked on Win XP. In my running batch file, I included the following:

```
set value=new_value

:: Setup initial configuration
:: I use && as the delimiter in the file because it should not exist, thereby giving me the whole line
::
echo --> Setting configuration and properties.
for /f "tokens=* delims=&&" %%a in (config\config.txt) do ( 
  call replace.bat "%%a" _KEY_ %value% config\temp.txt 
)
del config\config.txt
rename config\temp.txt config.txt 
```

The `replace.bat` file is as below. I did not find a way to include that function within the same batch file, because the `%%a` variable always seems to give the last value in the for loop.

`replace.bat`:

```
@echo off

:: This ensures the parameters are resolved prior to the internal variable
::
SetLocal EnableDelayedExpansion

:: Replaces Key Variables
::
:: Parameters:
:: %1  = Line to search for replacement
:: %2  = Key to replace
:: %3  = Value to replace key with
:: %4  = File in which to write the replacement
::

:: Read in line without the surrounding double quotes (use ~)
::
set line=%~1

:: Write line to specified file, replacing key (%2) with value (%3)
::
echo !line:%2=%3! >> %4

:: Restore delayed expansion
::
EndLocal 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2008-10-14T20:19:08.177

Take a look at [Is there any sed like utility for cmd.exe](https://stackoverflow.com/questions/127318/) which asked for a sed equivalent under Windows, should apply to this question as well. Executive summary:

*   It can be done in batch file, but it's not pretty
*   Lots of available third party executables that will do it for you, if you have the luxury of installing or just copying over an exe
*   Can be done with VBScript or similar if you need something able to run on a Windows box without modification etc.

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2010-07-22T13:41:19.990

Power shell command works like a charm

```
(
test.txt | ForEach-Object { $_ -replace "foo", "bar" } | Set-Content test2.txt
) 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2014-07-22T12:52:16.847

Two batch files that supply `search and replace` functions have been written by Stack Overflow members `dbenham` and `aacini` using `native built-in jscript` in Windows.

They are both `robust` and `very swift with large files` compared to plain batch scripting, and also `simpler` to use for basic replacing of text. They both have `Windows regular expression` pattern matching.

1.  This`sed-like` helper batch file is called [`repl.bat`](https://www.dostips.com/forum/viewtopic.php?f=3&t=3855) (by dbenham).

    Example using the `L` literal switch:

    ```
    echo This is FOO here|repl "FOO" "BAR" L
    echo and with a file:
    type "file.txt" |repl "FOO" "BAR" L >"newfile.txt" 
    ```

2.  This `grep-like` helper batch file is called [`findrepl.bat`](https://www.dostips.com/forum/viewtopic.php?t=4697) (by aacini).

    Example which has regular expressions active:

    ```
    echo This is FOO here|findrepl "FOO" "BAR" 
    echo and with a file:
    type "file.txt" |findrepl "FOO" "BAR" >"newfile.txt" 
    ```

Both become powerful system-wide utilities `when placed in a folder that is on the path`, or can be used in the same folder with a batch file, or from the cmd prompt.

They both have `case-insensitive` switches and also many other functions.

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2009-12-23T16:20:39.060

May be a little bit late, but I am frequently looking for similar stuff, since I don't want to get through the pain of getting software approved.

However, you usually use the FOR statement in various forms. Someone created a useful batch file that does a search and replace. Have a look [here](http://www.dostips.com/?t=Batch.FindAndReplace). It is important to understand the limitations of the batch file provided. For this reason I don't copy the source code in this answer.

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2019-04-13T11:24:41.383

I'm prefer to use `sed` from [GNU utilities for Win32](http://unxutils.sourceforge.net/), the followings need to be noted

> *   single quote `''` won't work in windows, use `""` instead
> *   **`sed -i`** won't work in windows, it will need file **swapping**

So the working code of `sed` to find and replace text in a file in windows is as below

```
sed -e "s/foo/bar/g" test.txt > tmp.txt && mv tmp.txt test.txt 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2015-08-04T14:43:51.227

Just faced a similar problem - "Search and replace text within files", but with the exception that for both filenames and search/repalce I need to use regex. Because I'm not familiar with Powershell and want to save my searches for later use I need something more "user friendly" (preferable if it has GUI).

So, while Googling :) I found a great tool - [FAR (Find And Replace)](http://findandreplace.sourceforge.net/) (not FART).

That little program has nice GUI and support regex for searching in filenames and within files. Only disadventage is that if you want to save your settings you have to run the program as an administrator (at least on Win7).

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2018-04-17T01:12:44.567

Use powershell in .bat - for Windows 7+

encoding utf8 is optional, good for web sites

```
@echo off
set ffile='myfile.txt'
set fold='FOO'
set fnew='BAR'
powershell -Command "(gc %ffile%) -replace %fold%, %fnew% | Out-File %ffile% -encoding utf8" 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-09-17T17:58:08.923

This is one thing that batch scripting just does not do well.

The script **morechilli** linked to will work for some files, but unfortunately it will choke on ones which contain characters such as pipes and ampersands.

VBScript is a better built-in tool for this task. See this article for an example: [http://www.microsoft.com/technet/scriptcenter/resources/qanda/feb05/hey0208.mspx](http://www.microsoft.com/technet/scriptcenter/resources/qanda/feb05/hey0208.mspx)

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2017-06-15T21:21:51.647

@Rachel gave an excellent answer but here is a variation of it to read content to a powershell `$data` variable. You may then easily manipulate content multiple times before writing to a output file. Also see how multi-line values are given in a .bat batch files.

```
@REM ASCII=7bit ascii(no bom), UTF8=with bom marker
set cmd=^
  $old = '\$Param1\$'; ^
  $new = 'Value1'; ^
  [string[]]$data = Get-Content 'datafile.txt'; ^
  $data = $data -replace $old, $new; ^
  out-file -InputObject $data -encoding UTF8 -filepath 'datafile.txt';
powershell -NoLogo -Noninteractive -InputFormat none -Command "%cmd%" 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2021-10-24T09:08:41.770

For me, to be sure to not change the encoding (from UTF-8), keeping accents... the only way was to mention the default encoding before and after :

```
powershell -Command "(gc 'My file.sql' -encoding "Default") -replace 'String 1', 'String 2' | Out-File -encoding "Default" 'My file.sql'" 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-09-12T22:23:08.547

Download [Cygwin](http://www.cygwin.com/) (free) and use unix-like commands at the Windows command line.

Your best bet: sed

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-04-05T14:46:08.850

Can also see the Replace and ReplaceFilter tools at [https://zoomicon.github.io/tranXform/](https://zoomicon.github.io/tranXform/) (source included). The 2nd one is a filter.

The tool that replaces strings in files is in VBScript (needs Windows Script Host [WSH] to run in old Windows versions)

The filter is probably not working with Unicode unless you recompile with latest Delphi (or with FreePascal/Lazarus)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-07-01T03:53:48.153

Powershell Command -

Getting content of the file and replacing it with some other text and then storing into another file

**Command -1** (Get-Content filename.xml)| ForEach-Object { $_.replace("some_text","replace_text").replace("some_other_text","replace_text") } | Set-Content filename2.xml

Copying another file into the original one file

**Command2**

Copy-Item -Path filename2.xml -Destination filename.xml -PassThru

removing another one file

**Command 3**

Remove-Item filename2.xml

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2021-08-20T21:22:21.060

Notepad++ does this ALL for you with the "Find in files" command.

[![enter image description here](https://i.stack.imgur.com/WrHHK.png)](https://i.stack.imgur.com/WrHHK.png)

[![enter image description here](https://i.stack.imgur.com/VMpKL.png)](https://i.stack.imgur.com/VMpKL.png)

* * *

## 回答 #30

> 赞同：-5
> 
> 时间：2015-03-25T15:55:06.137

I have faced this problem several times while coding under Visual C++. If you have it, you can use Visual studio Find and Replace Utility. It allows you to select a folder and replace the contents of any file in that folder with any other text you want.

Under Visual Studio: Edit -> Find and Replace In the opened dialog, select your folder and fill in "Find What" and "Replace With" boxes. Hope this will be helpful.

# .net - C# NetCDF 库

> ID：60039
> 
> 赞同：8
> 
> 时间：2008-09-12T21:49:59.500
> 
> 标签：.net, file, file-format

我目前正在（或至少计划）几个使用大量重复数据的项目。这种数据在电子表格或数据库中运行良好，但在 XML 中很糟糕。:)

NetCDF 似乎是文件格式的绝佳选择。但是，我的工作是用 C# 编写的，并且没有可用的“官方”NetCDF 实现。有一个“官方”Python 版本，我可能会与 IronPython 一起使用。另一种选择是 CodePlex 上的“.Net 的 NetCDF 库”，但它看起来很安静（[http://www.codeplex.com/netcdf](http://www.codeplex.com/netcdf)）。

有没有人使用过这些库中的任何一个？你能提供任何建议吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2014-09-02T04:00:44.870

我现在添加这个是因为这是我在谷歌上搜索这个主题时的最佳答案。

* * *

**ETA**根据下面的回复，现在有另一个 Microsoft NetCDF 库可用：

[https://www.nuget.org/packages/SDSLite](https://www.nuget.org/packages/SDSLite)

**科学数据集精简版 1.4.0**

这是一个用于处理 netCDF、CSV 和 TSV 文件的跨平台库。

* * *

由于最初提出并回答了这个问题，微软发布了一个支持 NetCDF 的科学数据集库

[http://research.microsoft.com/en-us/downloads/ccf905f6-34c6-4845-892e-a5715a508fa3/](http://research.microsoft.com/en-us/downloads/ccf905f6-34c6-4845-892e-a5715a508fa3/)

**项目介绍**

SDS 库使 .Net 开发人员可以轻松地读取、写入和共享在科学建模中非常常见的标量、向量、矩阵和多维网格。支持CSV、NetCDF等文件格式

使用该库的程序将相关数据和相关元数据存储在一个紧凑的自描述包中。库附带一组实用程序和软件包：sds 命令行实用程序、DataSet Viewer 应用程序和 Microsoft Excel 2007（及更高版本）的加载项。有关详细信息，请参阅发布页面。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-15T15:09:08.283

首先，您确定 NetCDF 是正确的选择吗？如果您想与其他需要读取大量数据并且已经支持 NetCDF 的程序进行交互，那么它可能是一个不错的选择。支持大型多维数组的标准文件格式并不多。但是，如果您只打算从 C# 中读取和写入文件，那么它可能不是一个好的选择。

我是“经典”NetCDF 文件格式的忠实粉丝。它紧凑且极其简单，但足够灵活，可以支持许多常见的多维结构良好的数据。我只花了一天时间就为经典 NetCDF 编写了一个完整的解析器，并且只花了一个小时编写了一个程序来输出经典 NetCDF 文件的格式良好的特例。您可以自己实现一个纯 C# NetCDF 库，不会有太大的麻烦。您可以轻松地从仅实现您需要的功能开始。 [这是规范。](http://www.unidata.ucar.edu/software/netcdf/docs/netcdf/NetCDF-Classic-Format.html)

不幸的是，NetCDF-4 选择使用 HDF-5 作为其数据格式。它增加了很多复杂性，并使得用另一种语言编写完整的 NetCDF 解析器变得更加困难。HDF-5 是非常通用的，在我看来，它被过度设计了——它试图对太多人来说太多东西。我不建议尝试直接使用它，除非您打算花一个月的时间编写单元测试。如果你必须使用 C# 中的 netCDF-4 / HDF-5，你唯一现实的选择是使用 SWIG 或类似的东西来包装 C 库。

请注意，Python 的 NetCDF 只是 C 代码的一个包装器，所以它并不是真的很有帮助；如果你打算使用一个包装好的 C 库，你不妨只写一个 C# 包装器，而不是使用 Python 作为中间层。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-08-24T21:13:35.300

现在微软发布了一个更新的 netCDF 库，可以通过 NuGet 获得：

[https://www.nuget.org/packages/SDSLite](https://www.nuget.org/packages/SDSLite)

**科学数据集精简版 1.4.0**

这是一个用于处理 netCDF、CSV 和 TSV 文件的跨平台库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T19:21:28.550

在一个项目中，我们使用 ikvm 在 c# 中使用 ucar netcdf 实现。IKVM 可用于将 java 项目“转换”为 .Net 库，而无需使用 java VM。我没有做任何性能检查，但这是在 c# 中获取 netcdf 的简单方法:)。

[http://www.ikvm.net/stories.html](http://www.unidata.ucar.edu/downloads/netcdf/netcdf-java-4/index.jsp)

[http://www.unidata.ucar.edu/downloads/netcdf/netcdf-java-4/index.jsp](http://www.unidata.ucar.edu/downloads/netcdf/netcdf-java-4/index.jsp)

# apache-flex - Flex 组件中的 Google 地图

> ID：60046
> 
> 赞同：1
> 
> 时间：2008-09-12T21:52:50.977
> 
> 标签：apache-flex, actionscript-3, google-maps

我在 Flex 中嵌入了 Google Maps Flash API，它在本地运行良好，上面有水印等。当我将它上传到服务器 (flex.mydomain.com) 时，我收到下面列出的沙盒安全错误：

```
SecurityError: Error #2121: Security sandbox violation: Loader.content: http://mydomain.com/main.swf?Fri, 12 Sep 2008 21:46:03 UTC cannot access http://maps.googleapis.com/maps/lib/map_1_6.swf. This may be worked around by calling Security.allowDomain.
    at flash.display::Loader/get content()
    at com.google.maps::ClientBootstrap/createFactory()
    at com.google.maps::ClientBootstrap/executeNextFrameCalls() 
```

有没有人有将 Google Maps Flash API 嵌入 Flex 组件并专门设置安全设置以使其工作的经验？我确实获得了一个新的 API 密钥，该密钥已注册到我的域，并且在发布时正在使用它。

我尝试在主应用程序和组件中执行以下操作：

```
Security.allowDomain('*')
Security.allowDomain('maps.googleapis.com')
Security.allowDomain('mydomain.com') 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-13T10:14:15.810

这听起来像是一个`crossdomain.xml`相关的问题。我做了一个快速搜索，似乎有很多人有同样的问题。一些通过 XMLHttpRequest 等的代理请求。

[问题 406：为 Google 帐户添加 crossdomain.xml](http://code.google.com/p/gdata-issues/issues/detail?id=406)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T11:45:37.790

谢谢您的帮助。显然，这与在 ASP.NET 页面上包含 Flex 应用程序有关。当我将它移到一个平面 HTML 文件时，它运行良好。我现在没有时间进行全面调查，但这似乎已经解决了。

# java - Java 录音和混音器设置

> ID：60049
> 
> 赞同：4
> 
> 时间：2008-09-12T21:54:42.860
> 
> 标签：java, javasound

我在无线电数据模式解码程序中使用 javax.sound.sampled 包。要使用该程序，用户将无线电接收器中的音频输入到 PC 的线路输入中。用户还需要使用他们的混音器程序来选择线路输入作为录音输入。问题是一些用户不知道如何做到这一点，有时其他程序也会改变录音输入设置。所以我的问题是我的程序如何检测线路输入是否设置为录音输入？如果我的程序检测到录音输入设置不正确，是否可以更改它？

谢谢你的时间。

伊恩

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-13T22:43:22.860

要回答您的第一个问题，您可以检查录音输入的[Line.Info](http://java.sun.com/javase/6/docs/api/javax/sound/sampled/Line.Info.html)对象是否与[Port.Info.LINE_IN](http://java.sun.com/javase/6/docs/api/javax/sound/sampled/Port.Info.html#LINE_IN)匹配，如下所示：

```
public static boolean isLineIn(Line.Info lineInfo) {
    Line.Info[] detected = AudioSystem.getSourceLineInfo(Port.Info.LINE_IN);
    for (Line.Info lineIn : detected) {
        if (lineIn.matches(lineInfo)) {
            return true;
        }
    }
    return false;
} 
```

但是，这不适用于不提供每个可用混音器通道类型的操作系统或声卡驱动程序 API。因此，当我在 Windows 上测试它时，它可以工作，但在 Linux 或 Mac 上却不行。有关更多信息和建议，请参阅此[常见问题解答](http://www.jsresources.org/faq_audio.html#no_predefined_ports)。

关于第二个问题，您可以尝试通过[Control](http://java.sun.com/javase/6/docs/api/javax/sound/sampled/Control.html)类更改录音输入设置。特别是，请参阅[FloatControl.Type](http://java.sun.com/javase/6/docs/api/javax/sound/sampled/FloatControl.Type.html)了解一些常见设置。请记住，这些控件的可用性取决于操作系统和声卡驱动程序，就像线路输入检测一样。

# flash - 从子对象引用回父对象

> ID：60051
> 
> 赞同：2
> 
> 时间：2008-09-12T21:55:24.137
> 
> 标签：flash, actionscript-3

我的问题是关于访问子对象父对象的最佳实践。因此，假设一个类实例化了另一个类，该类实例现在被一个对象引用。从该子对象中，引用回父对象的最佳方法是什么？目前我知道我经常使用的几种方法，但我不确定 A）是否有更好的方法或 B）其中哪一种是更好的做法

第一种方法是使用 getDefinitionByName，它不会实例化该类，但允许访问其中公开声明的任何内容。

```
_class:Class = getDefinitionByName("com.site.Class") as Class; 
```

然后根据其父到子层次结构引用该变量。
例如，如果孩子试图引用一个比自己高两级的类：

```
_class(parent.parent).function(); 
```

这似乎工作正常，但您需要知道孩子所处的级别与您尝试访问的父级的级别相比。

我还可以得到以下语句来追踪 [object ClassName] 到 Flash 的输出中。

```
trace(Class); 
```

我不是 100% 地执行那条线，我没有说服它作为引用我所在的当前对象之外的对象的一种方式。

我见过的另一种方法是简单地将 this 的引用传递给您正在创建的类对象，然后用构造函数参数捕获它

```
var class:Class = new Class(this); 
```

然后在Class文件中

```
public function Class(objectRef:Object) {
    _parentRef = objectRef;
} 
```

但是，该引用还要求您使用子层次结构向后退到父层次结构。

我也可以导入该类，然后使用直接文件路径来引用该类内部的方法，无论它是否是父类。

```
import com.site.Class;
com.site.Class.method(); 
```

当然，父子关系是无关紧要的，因为我直接通过导入的类访问方法或属性。

我只是觉得我在这里错过了一些非常明显的东西。我基本上是在寻找确认这些是否是引用父母的正确方法，如果是的话，哪个是最理想的，还是我忽略了其他东西？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T22:09:49.803

一般来说，如果您需要孩子与父母交流，您应该考虑通过广播事件来让孩子这样做。这为父级解耦了子级，并使得其他类与子级一起工作成为可能。

我不建议将对父类的引用传递给子类。

这是一个简单的例子（我已经测试/编译了这个，所以可能有一些错别字）。

```
//Child.as
package
{
    import flash.events.EventDispatcher;
    import flash.events.Event;

    public class Child extends EventDispatcher
    {
        public function doSomething():void
        {
            var e:Event = new Event(Event.COMPLETE);
            dispatchEvent(e);
        }

        public function foo():void
        {
            trace("foo");
        }
    }
}

//Parent.as
package
{
    import flash.display.Sprite;
    import flash.events.Event;
    public class Parent extends Sprite
    {
        private var child:Child;
        public function Parent():void
        {
            c = new Child();
            c.addEventListener(Event.COMPLETE, onComplete);
            c.foo();//traces foo

            c.doSomething()
        }

        public function onComplete(e:Event):void
        {
            trace("Child broadcast Event.COMPLETE");
        }

    }
} 
```

在大多数情况下，您会分派自定义事件并与它们一起传递数据。

基本上：

Parent 引用 Child 并通过方法调用进行通信。Child 没有对 Parent 的引用，并通过调度事件（与任何人）进行通信。

希望有帮助...

迈克室

网格@adobe.com

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T08:27:47.580

将类作为它自己的实例并减少与其他事物的紧密耦合通常是好的（在这种情况下，它是父类）。如果您执行类似 parent.doSomething() 之类的操作，则无法在没有 doSometing() 方法的容器中使用该类。我认为传递类可能需要的任何东西肯定会更好，然后在类中它不必再做任何 parent.parent 等。

有了这个，如果您将来想要更改结构，只需传入一个新的引用就很容易了；子类的实现根本不需要改变。

您在这里的第三种选择也非常不同，它访问的是类级别的静态方法（访问该方法时您不必键入整个类路径），而不是前两个中的实例方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T22:12:01.147

我一直使用您的第二种方法，将指向父对象的指针传递给子对象并将该指针存储在子类的成员变量中。对我来说，这似乎是孩子与父母交流的最简单方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T08:57:07.993

我喜欢将父级作为接口传递（因此该类可以包含在实现该接口的任何父级中）或将引用实现为父级可以挂钩的事件/函数指针/委托。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T15:44:52.287

我喜欢设置一个全局类来处理对任何其他类（不一定是子类）需要访问的类的引用。

全局类仅由静态 getter 和 setter 组成，如下所示：

```
private static const class:Class;

public static function setClass(_class:Class){
class = _class;
}
public static function getClass(void):Class{
return class;
} 
```

这样做的好处是您不必导入从全局类返回的类，只需导入全局类本身。

需要引用的类将自身添加到全局列表中。另一个很酷的事情是您可以轻松地从这个集中位置发送事件。

大多数情况下，如果一个类需要被子类或任何其他类引用，我会通过接口来完成。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-03T01:52:04.360

如果这些对象在 DisplayList 中，那么您还有更多选择。如果我有一个 ParentClass 和一个 ChildClass，在子类中，如果您将请求转换为 ParentClass，您似乎可以访问父类。例如

```
ParentClass(parent).parentFunction(); 
```

如果 ParentClass 是 Document Class，我肯定知道它可以工作。由于文档类始终是显示列表中的第一项，因此有效：

```
ParentClass(stage.getChildAt(0)).parentFunction(); 
```

就我而言，它们都是同一个包的成员，所以我什至不需要导入任何东西。我没有在所有情况下都测试过它，但是当我需要它时它可以工作。

当然，'parent' 和 'getChild...' 仅在这些对象位于 DisplayList 中时才有效，但这对我来说已经足够了。

# operating-system - 有孩子的PID吗？

> ID：60070
> 
> 赞同：2
> 
> 时间：2008-09-12T22:08:42.623
> 
> 标签：operating-system

我目前正在上操作系统课，我的老师花了一半的课时谈论 PID。她提到，正如许多人所知，进程知道他们父母的 ID。

我的问题是这样的：

进程的 PCB 是否知道其子进程的 ID？如果是这样，获得它的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T22:13:34.437

据我所知，一个进程没有明确的子进程 PID 列表，但它可以很容易地构建，因为进程应该知道它产生了哪个子进程。例如，UNIX fork() 调用在父进程中返回子 PID，在子进程中返回 0，Windows 上的 CreateProcess() 返回 (IIRC) 创建的新进程的 PID。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-12T22:12:33.487

在*nix上使用`fork()`时，返回值为父进程中子进程的PID，子进程中为0。这是找出答案的一种方法。

不确定他们是否跟踪进程生成的“树”，我认为这取决于您使用的操作系统，但是由于当您杀死 bash（或任何 shell）时，所有正在运行的子进程也会被杀死，我认为类似 UNIX 的系统会这样做跟踪这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-12T22:13:59.647

如果您使用的是 Linux 或任何实现 Unix API 的东西，当进程调用 fork() 创建子进程时，父进程会收到子 PID 作为返回码，如果 fork 失败，则为 -1。子进程获得零返回码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-14T06:09:50.547

Process 的 PCB 知道它的子 ID。

正如我们所知，Fork() 用于创建进程。它不接受任何参数并返回一个进程 ID。创建新的子进程后，父进程和子进程都将执行 fork() 之后的下一条指令。在那里我们必须区分父母和孩子。这可以通过测试 fork() 的返回值来完成。

如果 Fork() 返回负值，则子进程创建不成功。如果 Fork() 向新创建的子进程返回零。如果 Fork() 将一个正值作为子进程的进程 ID 返回给父进程。

# sql-server - SQL 错误 OLE.INTEROP

> ID：60076
> 
> 赞同：1
> 
> 时间：2008-09-12T22:12:43.847
> 
> 标签：sql-server

每当我加载 Management Studio 或在服务器资源管理器中打开文件夹等时都会出现错误。此外，如果我尝试创建一个新数据库，它会不断更新并且无法完成。我附上了错误的截图。请让我知道我能做些什么来解决这个问题，因为它真的很烦人。

[错误屏幕 http://frickinsweet.com/databaseError.gif](http://frickinsweet.com/databaseError.gif)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-13T00:55:48.510

来自 MSDN 论坛[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=120476&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=120476&SiteID=1)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T22:26:25.497

我的第一个猜测是客户端工具损坏。

我有时不得不卸载我的客户端工具并重新安装它们。卸载后开机。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-13T06:00:15.157

我不得不添加注册表文件并重新运行“regsvr32 actxprxy.dll”这是一个非常奇怪和痛苦的错误。它似乎是在安装 VS SP1 后才出现的，但我真的不明白为什么会发生这种情况。

# visual-studio-2008 - 为什么VS2008中的断点会停止工作？

> ID：60093
> 
> 赞同：2
> 
> 时间：2008-09-12T22:37:48.090
> 
> 标签：visual-studio-2008

我有 ac#asp.net 网络应用程序。数据库层中的断点不再停止执行，但 UI 层中的断点仍然可以正常工作。任何人都可以猜测为什么会发生这种情况吗？

我已经检查了所有常见的嫌疑人（所有项目的调试版本都已启用）并重新编译了解决方案中的所有项目......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T22:50:56.343

感谢各位的回复和想法——我已经尝试过所有这些或它们的变体。

我认为这一定是一个非常微妙的 VS 错误。一位同事建议我将我试图打破的功能公开（以前“未定义”，因此隐含私有），然后再试一次。我这样做了，断点开始受到打击。然后我删除了 public 关键字并继续命中断点。不知道为什么这解决了它，但它确实解决了。

谢谢你的帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T23:01:43.760

几个建议。第一个是检查源代码行中断点的状态。它是一个实心的红球吗？如果不是，它通常表明有问题的文件不是用于构建的文件。其次 - 查看模块视图并查看已加载的模块和符号。你可能会发现这不是你所期望的。

至于为什么——我不知道！

缺口

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T22:43:31.773

我会确保 UI 层引用了适当的“调试”.dll。我还考虑在调试时按`CTRL`++ ( `ALT`)以查看是否为 BLL 和 DAL 加载了符号。如果没有，则 Visual Studio 无法找到该文件。调试文件是否与“模块”窗口中引用的 调试文件位于同一目录中？`U``Modules View``.dlls``.PDBs`
`.PDBs``.dlls`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T22:45:53.407

*   将调试器附加到 ASP.NET 进程并单击模块窗口。确保为要调试的程序集加载调试符号。
*   确保 UI 引用的是调试程序集，而不是发布程序集。
*   确保 .PDB 文件位于 /bin/debug/ 目录中
*   确保在附加调试器之前重建整个解决方案。
*   如果数据层在单独的解决方案中，请将项目添加到 UI SLN（您不需要添加引用，那些应该已经建立或者您的代码不会编译），以便调试器可以拉起完整的代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T22:41:28.673

您是否尝试过在重新编译之前删除您的 bin 目录？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-05T16:15:30.873

我遇到了同样的问题，并一直在想“我在 web.config 中做了什么改变”​​以可能做到这一点？

```
 <location path="." inheritInChildApplications="false"> 
```

那不允许断点为我工作。

# c# - 转换为 VB.NET 的 Web 服务中的“无法加载类型”

> ID：60098
> 
> 赞同：1
> 
> 时间：2008-09-12T22:38:38.027
> 
> 标签：c#, vb.net, web-services, translation, sharpdevelop

我使用 SharpDevelop 用 C# 编写了一个简单的 Web 服务（我刚刚得到并且我很喜欢）。

客户想要它在 VB 中，幸运的是有一个转换为 VB.NET 功能。这很棒。翻译了所有的代码，它就构建了。（我很长一段时间都是“记事本”的人，所以我可能看起来有点过时。）

但是当我现在尝试加载服务时出现此错误。

```
解析器错误消息：无法从程序集“flightinfo”加载类型“flightinfo.Soap”。

源错误：

第 1 行：<%@ WebService Class="flightinfo.Soap,flightinfo" %>

```

我已经删除了垃圾箱并重建了，我搜索了谷歌（和 stackoverflow）。我已经在项目文件中搜索了 C# 的任何残余。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T13:11:31.630

在 VB.NET 中，命名空间声明与项目的默认命名空间相关。因此，如果项目的默认命名空间设置为 XY，则介于`Namespace Z`和之间的一切`End Namespace`都将位于 XYZ 命名空间中。在 C# 中，您必须提供完整的命名空间名称，而不考虑项目的默认命名空间。因此，如果 C# 项目具有默认命名空间 XY，则 CS 文件仍将包含`namespace X.Y`声明。转换为 VB 后，如果文件中的默认命名空间和命名空间声明保持不变，您最终会得到 XYXY 命名空间中的类。因此，在您的情况下，Soap 类现在位于 flightinfo.flightinfo 命名空间中。因此，有三种可能的解决方案：

*   将 asmx 文件更改为

*   从项目中删除默认命名空间

*   从 vb 文件中删除命名空间声明

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T22:44:47.730

```
<%@ WebService Class="flightinfo.Soap,flightinfo" %> 
```

你的班级叫什么名字？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:20:50.953

该问题可能是由 VB.NET 和 C# 项目对项目程序集使用不同的命名约定以及项目命名空间的使用方式引起的。至少那是我会开始寻找的。

# version-control - 如何在 Borland StarTeam 中获得特定标记版本的文件夹？

> ID：60099
> 
> 赞同：1
> 
> 时间：2008-09-12T22:38:56.717
> 
> 标签：version-control, starteam

我即将在 StarTeam 中执行一堆[文件夹移动操作](https://stackoverflow.com/questions/28578/how-can-i-merge-my-files-when-the-folder-structure-has-changed-using-borland-st)（包括一些新的嵌套级别），我想设置一个标签，以便在出现问题时可以回滚。我想出了如何在文件夹及其所有子项上设置标签，但我不知道如何获取与该特定标签相对应的该文件夹的版本。似乎标签与文件本身相关联，而不是与文件夹/文件夹结构相关联。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-14T06:27:26.567

我已经切换到 Subversion 和 FogBugz，所以我对 StarTeam 生疏了。我认为您需要一个视图标签。

1.  从`View`菜单中，选择`Labels...`打开标签对话框。
2.  在`View`选项卡上，单击`New...`按钮打开查看标签对话框。
3.  输入标签名称为“Release 1.2.3.4”，勾选`Frozen`，然后点击`OK`。

为了回到国家，

1.  从`View`菜单中，选择`Select Configuration...`打开“选择视图配置”对话框。
2.  选择`Labeled configuration`，然后选择“发布 1.2.3.4”

然后，您可以从视图标签创建一个新视图，以根据需要进行分支。请参阅帮助文件`Working with StarTeam`>> `Managing Views`。这是来自的报价`Configuring a View`：

> 默认情况下，视图具有当前配置——也就是说，它显示项目中项目的最新版本。但是，您可以根据标签、促销状态或时间点将视图回滚到过去的状态。

# c# - 在 C#（或任何语言）中，您最喜欢的消除重复的方式是什么？

> ID：60100
> 
> 赞同：4
> 
> 时间：2008-09-12T22:39:33.890
> 
> 标签：c#, coding-style, refactoring

我刚刚编写了一个 700 行的类。可怕。我羞愧地低下了头。它与[DRY](http://en.wikipedia.org/wiki/Don't_repeat_yourself)正好相反，就像英国的夏天一样。

它充满了剪切和粘贴，并在这里和那里进行了细微的调整。这使它成为重构的主要候选者。在我开始之前，我想我会问当你有很多重复时，你寻找的第一个重构机会是什么？

作为记录，我的可能正在使用：

1.  泛型类和方法
2.  方法重载/链接。

你的是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-13T01:45:10.230

我喜欢在需要时开始重构，而不是一有机会就开始重构。您可能会说这在某种程度上是一种敏捷的重构方法。我什么时候觉得我需要？通常当我觉得我的代码中丑陋的部分开始传播时。我觉得丑是可以控制的，但是当他们开始有传播的冲动的时候，那就是你需要照顾生意的时候了。

您用于重构的技术应该从最简单的开始。我强烈推荐 Martin Fowler 的书。将通用代码组合到函数中、删除不需要的变量和其他简单的技术可以让您获得很多好处。对于列表操作，我更喜欢使用函数式编程习语。也就是说，我尽可能使用内部迭代器、map、filter 和 reduce（在 python 中，ruby、lisp 和 haskell 中有相应的东西），这使得代码更短，更独立。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-13T02:34:57.163

有时，当您使用复制和粘贴代码“完成功能”时，您已经到了这样的地步，即它已被损坏和损坏，以至于任何重构尝试实际上都比在它原来的位置重构它花费的时间要长得多明显的。

以我个人的经验，我最喜欢的“消除重复的方法”是 Resharper 的“提取方法”功能（尽管这在 vanilla Visual Studio 中也可用）。

很多时候，我会看到重复的代码（我正在维护的一些遗留应用程序）不是完整的方法，而是完全独立的方法中的块。这为将这些块转化为方法提供了绝佳的机会。

Monster 类也倾向于显示它们包含多个功能。这反过来又成为将每个不同的功能分成自己的（希望更小）类的机会。

我必须重申，做所有这些（对我来说）根本不是一种愉快的体验，所以我真的宁愿在它是一个小泥球的时候做正确的事，而不是让大泥球滚动然后尝试解决这个问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-12T22:42:51.730

＃地区

我用它做了一个1000行的类只有一行！

严肃地说，避免重复的最佳方法是列表中涵盖的内容，以及充分利用多态性，检查您的类并发现在基类中最好的做法，以及如何分解它的不同组件一个子类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T22:49:07.737

首先，我建议您在完成该类的第一个版本时更快地进行重构。任何时候你看到重复，尽快消除它。最初这可能需要更长的时间，但我认为结果最终会变得更加清晰，并且它可以帮助您重新思考您的代码，以确保您做对了事情。

至于我最喜欢的删除重复的方式……闭包，尤其是在我最喜欢的语言（Ruby）中。它们往往是获取 2 段代码并合并相似之处的一种非常简洁的方式。当然（就像任何“最佳实践”或提示一样），这不能盲目地完成......我只是觉得当我可以使用它们时使用它们真的很有趣。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T22:58:47.510

我所做的一件事是尝试制作可以在编辑器（Visual Studio）的单个页面上看到的小而简单的方法。

我从经验中了解到，简化代码可以让编译器更容易对其进行优化。方法越大，编译器就越难工作！

我最近还看到了一个大型方法导致内存泄漏的问题。基本上我有一个非常类似于以下的循环：

```
而（真）
{
  var smallObject = WaitForSomethingToTurnUp();
  var largeObject = DoSomethingWithSmallObject();
}

```

我发现我的应用程序将大量数据保存在内存中，因为即使在 smallObject 返回某些内容之前“大对象”不在范围内，垃圾收集器仍然可以看到它。

我通过将“DoSomethingWithSmallObject()”和其他相关代码移动到另一个方法轻松解决了这个问题。

此外，如果你制作小的方法，你在一个类中的重用将会大大提高。我通常会尝试确保我的任何方法都不像其他方法！

希望这可以帮助。

缺口

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-13T00:16:16.543

“在这里和那里进行细微调整的剪切和粘贴”是我通常用完全非异国情调的方法解决的那种代码重复 - 获取类似的代码块，将其提取到单独的方法中。在该代码块的每个实例中都有一点不同，将其更改为参数。

还有一些简单的技术可以删除重复的 if/else if 和 switch 块，由 Scott Hanselman 提供： [http ://www.hanselman.com/blog/CategoryView.aspx?category=Source+Code&page=2](http://www.hanselman.com/blog/CategoryView.aspx?category=Source+Code&page=2)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-13T01:09:53.450

我可能会这样：

为数据结构创建自定义（私有）类型并将所有相关逻辑放入其中。字典<string, List<int>> 等。

制作保证行为的内部功能或属性。如果您不断检查可公开访问的属性的条件，则创建一个私有 getter 方法，其中包含所有检查。

拆分方法分开有太多的事情。如果你不能把一些简洁的东西放进去或者给它一个好名字，然后开始分解函数直到代码被分解（即使这些“子”函数没有在其他任何地方使用）。

如果所有其他方法都失败了，请在其上打一个 [SuppressMessage("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")] 并评论原因。

# oop - 用于学习或提高面向对象编程 (OOP) 技能的良好挑战/任务/练习

> ID：60109
> 
> 赞同：84
> 
> 时间：2008-09-12T22:45:09.633
> 
> 标签：oop

什么是提高你的面向对象编程技能的好挑战？

这个投票背后的想法是提供一个关于哪些练习对学习 OOP 有用的想法。

挑战应该尽可能与语言无关，需要很少或不使用特定库，或者只需要最常见的库。尝试在每个答案中仅包含一个挑战，以便投票与该挑战的优点相对应。如果指出所需的技能水平，以及为什么它是一个有用的练习背后的基本原理，那也很好。

然后可以将挑战的解决方案发布为“如何...”问题的答案，并从此处链接到。

例如：

*   挑战 - 实施后进先出堆栈
*   技能水平 - 初学者
*   基本原理 - 提供如何引用对象的经验

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-05-13T09:38:29.780

[Building Skills in Object-Oriented Design](https://www.itmaybeahack.com/homepage/books)是一本可能有用的免费书。

说明如下：

“本书的目的是通过为初学者提供一系列有趣且适度复杂的 OO 设计练习来帮助他们。本书还可以帮助管理人员在 OO 软件开发过程中建立一定程度的舒适度。我们将使用的应用程序构建是微不足道的一步，需要一些仔细的思考和设计。此外，由于应用程序本质上是娱乐性的，它们很有趣且引人入胜。本书允许读者在项目截止日期之前探索 OO 设计的过程和工件让好的设计看起来不可能。”

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-17T19:40:19.863

**从头开始**编写一个具有挑战性的程序。尝试让一些人（大约五个，这应该是可行的）使用它。响应他们的变更请求。

调整您的程序设计。从小处着手，然后看着它成长。管理这种增长。**这很难。**随着时间的推移，您还必须修复错误并维护它，这对我来说是非常宝贵的一课。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-12T23:07:56.880

挑战：用您选择的语言为您选择的网站/服务 API 编写一个包装器，该语言尚不存在（例如，用 C# 编写的[ZenDesk API包装器）。](http://www.zendesk.com/api)将包装器发布为开源供其他人使用。

技能等级：初级到中级

基本原理：学习如何将第 3 方 Web 服务 API 外推到一组有意义的对象/类中，从而在您选择的语言中更轻松地重用该 API。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T14:31:32.417

学习了基础知识后，请学习“Gang of Four”设计模式一书。

[http://www.amazon.com/Design-Patterns-Object-Oriented-Addison-Wesley-Professional/dp/0201633612/ref=pd_bbs_sr_1?ie=UTF8&s=books&qid=1221488916&sr=8-1](https://rads.stackoverflow.com/amzn/click/com/0201633612)

这是一本经典之作，任何想要了解如何使用 OO 来设计常见编码问题的优雅解决方案的编码人员都必须阅读。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-17T13:57:29.140

获取一段程序式的书面代码，并尝试将其转换为基于 OOP 的解决方案。在此过程中，请查阅有关重构和设计模式的书。我的一个朋友正是通过这种方式在理解面向对象的概念方面向前迈出了一大步。与任何事情一样，这可能并不适合所有人。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T14:21:16.043

我发现[CRC 卡](http://c2.com/doc/oopsla89/paper.html)在学习、教学和构建良好的 OO 设计方面非常有效。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-12T22:54:16.990

当然，一个很好的挑战，尽管比“从头开始”分配更难访问，是重构一些不使用继承或不使用太多继承的现有代码，以更好地利用继承。重构的过程将揭示 oop 的许多好处和陷阱，正如我在最近的项目中所做的那样。它也促使我比过去的项目更好地理解这些概念，在这些项目中我创建了自己的面向对象设计。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T21:06:00.977

给定的任务与“OOP”几乎没有关系，更多的是你如何对其评分。

我会查看重构书第 3 章，并确保解决方案中不存在任何不良代码气味。或者，更重要的是，检查那些确实适用的。

最重要的是，注意 setter 和 getter 的存在（表明您正在对类中的值进行操作，而不是要求类对自己的值进行操作）——或者在不应用 Liskov 替换原则的情况下使用“扩展”，例如那。

# asp.net - HTTPS 与 Visual Studio 的内置 ASP.NET 开发服务器

> ID：60113
> 
> 赞同：113
> 
> 时间：2008-09-12T22:48:33.213
> 
> 标签：asp.net, visual-studio, visual-studio-2008

有没有办法通过 HTTPS 访问 Visual Studio 的内置 ASP.NET 开发服务器？

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2012-01-11T10:23:48.400

到目前为止，我们可以使用 IIS Express 在 SSL 中进行开发和测试。这是一篇完整的文章，解释了如何使用 IIS Express 和 Visual Studion 2010 在 SSL 中开发网站。

![在此处输入图像描述](https://i.stack.imgur.com/jvqeG.png)

**下一个**

![在此处输入图像描述](https://i.stack.imgur.com/3didG.png)

**然后你会得到这个**

![在此处输入图像描述](https://i.stack.imgur.com/Oh154.png)

[使用 IISExpress 在开发时使用 SSL 更容易](http://www.hanselman.com/blog/WorkingWithSSLAtDevelopmentTimeIsEasierWithIISExpress.aspx)

[介绍 IIS Express](http://weblogs.asp.net/scottgu/archive/2010/06/28/introducing-iis-express.aspx)

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-09-12T22:53:44.153

Cassini 不支持 HTTPS。

但是，您可以使用 IIS 来执行此操作，如果您使用 IIS 5.1，请下载适用于 IIS 6.0 的 MS IIS 工具包，它带有一个创建自签名 SSL 证书的工具。这适用于 IIS 5.1

[http://www.microsoft.com/downloads/details.aspx?FamilyID=56fc92ee-a71a-4c73-b628-ade629c89499&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=56fc92ee-a71a-4c73-b628-ade629c89499&DisplayLang=en)

您需要的一个工具 (SelfSSL.exe) 与 IIS 5.1 配合得很好。不幸的是，它与一堆其他东西捆绑在一起。

脚步：

*   安装 IIS 工具文件。如果需要，您可以单击自定义并告诉它只安装 SelfSSL。
*   在 IIS 中激活您也想安装 SSL 证书的站点。
*   转到开始/程序/IIS 资源/SelfSSL
*   这将在 SelfSSL 目录中启动命令提示符。
*   使用提供的帮助，运行 SelfSSL。我使用的命令是：selfssl.exe /N:cn=[MACHINENAME] /K:1024 /V:90 /S:5 /P:443
*   /S 开关指示要安装证书的站点。您可以通过在 IIS 中查看您的站点并计数（从第一个站点的 1 开始，而不是 0）到您想要的站点来计算数字。
*   运行后，通过 HTTPS 浏览到您的本地主机
*   您应该会收到一条错误消息，指出此证书来自不受信任的来源。您可以将您的机器名称添加到浏览器的“受信任的权限”列表中，或者您可以告诉浏览器忽略它。

此时，您将能够通过 HTTPS 运行 localhost。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-12T23:36:09.947

Wilco Bauwer 编写了一个支持 https 的 webdev 服务器。他是开发 cassini Visual Studio 2005 内置 Web 服务器的开发人员之一。[WebDev.WebServer2](http://www.wilcob.com/download/index.html)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-07-16T07:50:12.057

**在解决方案资源管理器中选择项目文件：**例如：“WebApplication1”。

按下**ALT+ENTER**进入项目属性。

选择左侧的**“** **DEBUG”**。

 **在这里您可以选择**“启用 SSL”**。

*然后您可以正常使用 IIS Express 启动您的项目，它将开始使用 SSL，新端口将为 44301*

# apache-flex - Silverlight 安装基础 - 它有多大？

> ID：60121
> 
> 赞同：14
> 
> 时间：2008-09-12T22:58:20.600
> 
> 标签：apache-flex, silverlight, installation

Silverlight v2.0 越来越接近 RTM，但我还没有听到任何关于有多少浏览器正在运行 Silverlight 的统计数据。如果我问 Adob​​e（通过谷歌搜索“Flash 安装库”），他们很[高兴告诉我](http://www.adobe.com/products/player_census/flashplayer/version_penetration.html)97.7% 的浏览器都在运行 Flash Player 9 或更高版本。

并不是说我相信我读到的所有内容，但是**这些来自 Microsoft 或其他供应商的有关 Silverlight 的统计数据在哪里？**我将很快做出技术选择，在这一点上，一点经验证据将是一种资产......

所有 Silverlight 开发人员，给我看看你的统计数据！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-17T21:46:44.933

快速回答：[www.riastats.com](http://www.riastats.com)

该站点使用图形图表和图形比较不同的 RIA 插件。

它从运行在整个网络上的站点上的一小段 javascript 中获取数据（我上次查看时大约 400,000 个）

在发布这篇文章时，Silverlight 2 的使用率接近 11%。

我不会把它作为 RIA 统计数据的全部，但它是迄今为止我发现的最好的网站。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-12T23:03:12.227

如果您正在为普通观众开发一些东西，我强烈建议您反对 Silverlight，因为您会立即删除 Linux 用户。

我去看了奥运会的视频（我只运行 Linux），但我无法在他们的网站上观看视频，因为他们在 Silverlight 中。最重要的是，他们主动从 YouTube 上删除了所有视频，所以我别无选择，只能尝试寻找 Windows 启动。这只会让我对 NBC 产生非常负面的看法，并认为他们为每个人都应该使用的东西选择这样一种限制性技术是相当业余的。

虽然 Flash 有它的问题，但它在 Linux 中运行良好，所以我想说（在这一点上），它是一种更优越的技术选择。

如果您知道您的观众完全在 Windows 上（可能是 Mac）......那么您可以考虑 Silverlight，因为您知道您不会削减部分观众。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-22T21:12:53.210

如果您担心锁定潜在用户，那么无论如何您都应该构建网站的低带宽 HTML 版本……无论您使用 Flash 还是 Silverlight。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T14:33:29.600

我为此挣扎了一段时间。最终，我选择使用 Silverlight 作为主要组件来开发我的网站。我做了很多研究，得出了以下底线结论：

> 如果 Silverlight 失败，**并不是** 因为缺乏安装基础。MS 有太多的杠杆（Windows 更新，将其嵌入 IE8，甚至支付高流量的网站来使用它）。

我将从 Alexa 中添加此内容 - microsoft.com 的每日访问量令人印象深刻，并且它在主页上使用 SL。如果将 Outlook Web Access 迁移到 Silverlight，我也不会感到惊讶 - 从而将每个想要从家里/其他地方访问电子邮件的办公室 Outlook 用户都变成了漫游的 SL 安装程序。

[Alexa Link 比较 microsoft.com/ebay.com/amazon.com](http://www.alexa.com/data/details/traffic_details/windowslive-hotmail.com?site0=microsoft.com&site1=amazon.com&site2=ebay.com&y=r&z=3&h=300&w=470&c=1&u%5B%5D=microsoft.com&u%5B%5D=amazon.com&u%5B%5D=ebay.com&x=2008-09-17T14%3A24%3A46.000Z&check=www.alexa.com&signature=IUzWOf7U%2BFV0rf%2FITdkvrNV%2BfUI%3D&range=3m&size=Medium)

我将从[ScottGu 的博客条目](http://weblogs.asp.net/scottgu/archive/2008/11/16/update-on-silverlight-2-and-a-glimpse-of-silverlight-3.aspx)中添加此内容：

> 除了为美国的奥运会体验提供动力外，Silverlight 还在法国（由 FranceTV）、荷兰（由 NOS）、俄罗斯（由 Sportbox.ru）和意大利（由 RAI）使用。除了视频质量之外，这些广播公司决定使用 Silverlight 的一个重要原因是 Silverlight 提供的 TCO 和流媒体成本差异。在 2008 年 8 月版的 Web Designer Magazine（荷兰出版物）中，NOS 代表报告说，他们能够使用 Silverlight 和 40 台 Windows Media Server 为 100,000 名并发用户提供服务，而如果他们使用 Flash Media Server 则需要 270 台服务器。
> 
> 在过去的一个月里，我们看到了针对媒体场景的 Silverlight 的几个主要新部署。例如：CBS College Sports 现在正在使用 Silverlight 从其 170 所合作学院和大学流式传输 NCAA 赛事。Blockbuster 正在为其 MovieLink 应用程序用 Silverlight 替换 Flash。两周前，Netflix 使用 Silverlight 推出了新的 Instant Watch 服务。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-11-18T22:23:31.073

在 2009 年微软专业开发者大会上，Scott Guthrie 表示 Silverlight 安装在“全球 45% 的互联网连接设备”上

[http://www.betanews.com/article/PDC-2009-Live-from-the-Day-2-keynote/1258561992](http://www.betanews.com/article/PDC-2009-Live-from-the-Day-2-keynote/1258561992)（引自“太平洋时间上午 9:28”）条目

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-12T23:13:44.027

这是几周前[在 CP 上进行的每周民意调查。](http://www.codeproject.com/script/Surveys/Results.aspx?srvid=811)在 1463 名开发人员的回复中，大约。62% 的人至少在一个系统上安装了 Silverlight。

所以...如果您要创建一个针对 Windows 开发人员的网站...并且不介意锁定三分之一的潜在市场...

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-12T23:23:35.407

我一直无法获得统计数据。我假设他们可能会在 10 月下旬在 PDC 上发布一些。如果您正在构建一个需要针对不想安装其他插件的非开发人员受众的网站，您可能需要等待 Silverlight。

我已经在 Linux 上使用 Moonlight 进行了大量测试，它适用于使用 Silverlight 1.0 功能（几乎 100% 支持）或恰好使用 Moonlight 当前支持的 Silverlight 2.0 位的站点。需要注意的是，如果您不在“受支持的”平台上，某些网站会明确检查用户代理并且不会提供内容。那是糟糕的网站编码，不是 Silverlight 插件的错。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-29T22:34:12.977

在 @ReMIX UK 的主题演讲中，当 ScottGu 给出每天 150 万次安装的数字时，我坐在 Andrew Shorten 旁边，他是 Adob​​e 平台的推广者之一（也是一个好朋友）。他告诉我，Adobe 有独立的证据表明平均每天安装 1200 万次，下载量超过 4000 万次。

看起来150万只是它可能的一小部分。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-12T23:04:25.453

有 600 万人在 NBC 上观看了奥运会，该节目使用的是 silverlight 播放器。所以至少600万。我从未见过确切的统计数据，但你可以肯定它仍然很小。

此外，还有一个用于 linux 的 silverlight 实现，称为[moonlight](http://www.mono-project.com/Moonlight)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-12T23:09:01.247

我认为一个有趣的统计数据来自这个网站本身。看看有多少silverlight问题！有多少回应 - 这不是最活跃的话题！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-18T14:51:19.487

我认为在 Silverlight 2.0 正式发布后，您会看到 Silverlight 安装基础的显着增长。目前它仍处于测试阶段。Silverlight 1.0 已经发布并且运行良好，与我在 Linux 上的 Moonlight 中看到的一样，但是为 2.0 版创建完整的应用程序要困难得多。据微软称，Moonlight 将在发布时“100% 兼容”。请参阅[Scott Guthrie 的博客](http://weblogs.asp.net/scottgu/archive/2007/09/04/silverlight-1-0-released-and-silverlight-for-linux-announced.aspx)（注意：2.0 当时称为 1.1）。

Nick R，至于这些论坛上没有太多 Silverlight 活动，我认为最大的原因是[silverlight.net](http://www.silverlight.net)论坛上非常活跃的社区。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-18T19:50:23.823

Scott Guthrie 说（在 Remix UK 2008 年 9 月 18 日）Silverlight 目前每天被下载 150 万次。自第 1 版发布以来，下载量已超过 1.15 亿次。

版本 1 安装基础将在测试版结束时自动更新到版本 2。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-22T21:07:20.820

哇！斯科特在 2 月 8 日的 Mix 上说了同样的话，关于跑步率 - 150 万。因此，6 个月每天 150 万次的每日运行率似乎会为安装基数增加 2.7 亿次安装。所以他们的数字的含义并不完全清楚。

如果假设 115m 的安装基数是正确的，那么这意味着自 SL2 以来的六个月内每天的运行率约为 700k。当然，很多用户都以升级版本B1到B2为例。

无论哪种方式，它都获得了一些稳定的安装。很高兴看到运行率提高。到明年第二季度，由于 v2 出货量、应用程序/网站采用、各种计算机（如 HP）上的预安装以及任何未宣布的分发机制，它应该会显着提高。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-22T21:31:58.890

虽然总的来说，我支持使用 silverlight 开发网站的想法，并且认为，根据您的受众，让用户下载插件应该不会有太多麻烦，但我会提醒您不要假设 Microsoft 将发布内置的插件进入 IE 或作为 Windows 更新的一部分。

我有两个独立的微软技术布道者告诉我，由于反托拉斯的原因，该公司不愿意这样做。

这是一年多以前的事了，他们的策略可能从那时起已经演变，但这足以让我不指望它作为扩大市场渗透率的选择。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-06T04:07:41.043

不要忘记 Silverlight 2 安装基础永远不会包括 PPC Mac 用户。尽管在奥巴马就职典礼上为 Silverlight 1.0 用户添加 PIC 流媒体方面做出了[英勇的努力，但](http://arstechnica.com/open-source/news/2009/01/obama-inauguration-shines-on-linux-too-with-moonlight.ars)[看起来](http://www.mono-project.com/MoonlightRoadmap)Moonlight 人根本没有针对他们。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-18T19:59:16.800

更大的问题是，如果在 Silverlight 中实施，您的网站将失去多少用户。而且，这在很大程度上取决于您的观众。

如果您正在运行一个关于 Linux 内核黑客的乐趣或 Internet 安全优点的网站，您可能会失去大量的受众。如果你经营的是一个更主流的网站，我的经验是，遗憾的是，人们大部分时间都会下载他们被告知的任何内容。这就是间谍软件和恶意软件起作用的原因。而且，正如 NBC/Olympics 的交易所表明的那样，微软将积极推动其合作伙伴使用 Silverlight，直到它相当普遍。

在 Silverlight 更成熟之前我不会使用它，因为我*确实*迎合了相当数量的 Linux 用户，但我可能会为一个不太注重技术的网站。

# .net - 根据其他数据集表选择数据集表中的行

> ID：60122
> 
> 赞同：2
> 
> 时间：2008-09-12T22:58:20.880
> 
> 标签：.net, vb.net, select, dataset

我有一个数据集，其中有两个表。我想做以下（或类似的事情）是否可能，我如何做到正确？

```
dsTabData.Tables("FilingTabs").Select("fs_ID not in (select fsp_fsid from ParentTabs)") 
```

您如何引用同一数据集中其他表中的数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T23:25:14.513

好吧好吧，在你们给我发火之前！;)

我在网上做了更多的搜索，发现了我需要的东西，现在开始从这里阅读更多内容：

[导航表之间的关系](http://msdn.microsoft.com/en-us/library/d6s958d6(VS.80).aspx "导航表之间的关系")

# hosting - 切换到非托管虚拟专用服务器 (VPS) 托管服务提供商时的技术问题？

> ID：60137
> 
> 赞同：2
> 
> 时间：2008-09-12T23:13:52.887
> 
> 标签：hosting, virtualization, vps, reverse-dns

我正在考虑将一些小型客户站点转移到非托管 VPS 托管服务提供商。我还没有决定哪一个，但我的理解是他们会给我一个基本的操作系统安装（我更喜欢 Debian 或 Ubuntu）、一个 IP 地址、一个 root 帐户、SSH，仅此而已。

理想情况下，我想为我的配置设置创建一个完整的 VM 映像，然后将这些位发送给提供商。有没有人有这方面的经验？我[在 Coding Horror 中看到 Jeff 谈论过类似的事情](http://www.codinghorror.com/blog/archives/000984.html)。但我不确定他的经历是否典型。我想它还取决于主机使用的 VM 服务器的类型。

此外，这些主机是否提供反向 DNS？这对于发送电子邮件的网站很有用。我知道 GMail 往往会在没有它的情况下反弹来自服务器的任何内容。

最后，我可能需要多个 IP 地址，因为至少有几个站点具有 SSL 保护，这不适用于基于名称的虚拟主机。有没有人通过 VPS 遇到多个 IP 的问题？我不这么认为，但我听到过相反的耳语。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T23:33:13.433

[Slicehost](http://slicehost.com/)（[推荐链接](https://manage.slicehost.com/customers/new?referrer=2c6a507bb84e2082ae17fe0963c2db00)，如果您选择的话）提供反向 DNS、多个 IP（2 美元/月/IP）、Ubuntu/Debian（以及其他）。它不支持的唯一标准是提供虚拟机标准，但它确实允许您通过快照克隆您在其系统中设置的虚拟机。因此，您可以设置一次，然后根据需要多次复制该 VM。

如果这是您愿意做出的牺牲，我强烈推荐他们——在我需要联系他们的几次时，他们提供了出色的客户服务、可观的价格和出色的管理后端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T14:10:22.233

我喜欢[XenPlanet](http://www.xenplanet.com)，它们的价格似乎相当，但它们也允许您购买额外的磁盘空间等附加功能。不确定他们是否让您购买额外的带宽。

我已经将它们用于许多不同的机器，并发现它们的服务非常好。

# asp.net - 确定所需服务器数量的最佳方法

> ID：60142
> 
> 赞同：8
> 
> 时间：2008-09-12T23:17:43.253
> 
> 标签：asp.net, webserver, capacity-planning

一台 Web 服务器可以处理多少流量？看看我们是否超出这个范围的最好方法是什么？

我有一个拥有几百个用户的 ASP.Net 应用程序。它的某些方面是相当密集的处理器，但到目前为止，我们已经做得很好，只有一台服务器来运行 SqlServer 和站点。它运行 Windows Server 2003，3.4 GHz 和 3.5 GB 的 RAM。

但是最近我开始注意到在不同的时间变慢了，我想知道确定服务器是否因应用程序的使用而过载或者我是否需要做一些事情来修复应用程序的最佳方法是什么（我不如果我对盒子的期望过高，我真的想花很多时间寻找一些小的优化）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-12T23:31:14.640

您需要的是有关[容量规划](http://msdn.microsoft.com/en-us/library/ms979198.aspx)的一些信息..

容量规划是规划增长和预测高峰使用期以满足系统和应用程序容量要求的过程。它涉及广泛的性能测试，以确定应用程序的资源利用率和负载下的事务吞吐量。首先，您测量站点当前接收的访问者数量以及每个用户对服务器的需求量，然后计算支持当前和未来所需的计算资源（CPU、RAM、磁盘空间和网络带宽）使用水平。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T23:35:08.327

如果您可以访问某些分析工具（例如 Visual Studio 的 Team Suite 版本中的工具），您可以尝试设置一个测试服务器并针对它运行一些合成请求，并查看代码的任何特定部分是否花费了不合理的时间跑步。在执行此操作之前，您可能应该检查一些随时间变化的 CPU 和内存使用图，看看是否可以。（类似于 UNIX“平均负载”的数字可能是一个有用的指标，我不知道 Windows 是否有类似的东西。基本上是每个时间片需要 CPU 时间的平均线程数。）

还要检查明显的，你没有用完带宽。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T01:09:09.807

测量，测量，测量。Rico Mariani 总是这么说，他是对的。

测量请求/秒、RAM、CPU、会话等。

您可能会想出一个缓存策略（输出缓存、数据缓存、缓存依赖项等）。

另请参阅您的 SQL Server 是如何做的……索引是一个很好的起点，但不是唯一要看的东西……

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-13T02:50:17.547

在该硬件上，.NET 应用程序应该能够每秒处理大约 200-400 个请求。如果你只有几百个用户，我怀疑你每秒看到 2 个请求，所以我认为你在那个盒子上有很多容量，即使 SQL 服务器正在运行。

在不了解所有细节的情况下，我会说不**，**您不会通过添加服务器看到任何性能改进。

顺便说一句，如果您不使用[Output Cache](http://msdn.microsoft.com/en-us/library/hdxfb6cy.aspx)，我将从那里开始。

# .net - 是否可以在 .net DLL 中嵌入和使用可移植的可执行文件？

> ID：60143
> 
> 赞同：4
> 
> 时间：2008-09-12T23:21:04.243
> 
> 标签：.net, dll, command-line, resources

考虑我的问题的最简单方法是考虑一个简单的 unix 命令（尽管这是针对 Windows 的），我需要编程访问来运行它。

我有一个基于命令行的可执行文件来执行某些工作单元。我想使用 .net 进程库调用该可执行文件，就像我可以使用任何其他可执行文件一样。

但是，我突然意识到 dll 有可能变得无用或因对可执行文件或不存在的可执行文件的意外更新而中断。

是否可以像运行外部可执行文件一样从 .net 框架中的 Process 对象运行可执行文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T23:43:50.333

不，你不能直接执行它。您可能可以将其解压缩到一个临时目录并从那里执行它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T23:27:14.837

这是[PInvoke](http://msdn.microsoft.com/en-us/magazine/cc164123.aspx)可以提供帮助的地方吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-13T00:20:21.090

根据您要运行的命令行程序的功能，可能会在 PowerShell 中复制该功能，您可以在其中将 PowerShell 运行时嵌入到您的 .NET 应用程序中。

# c# - 在 C# 中做 throbber 的最佳方法是什么？

> ID：60151
> 
> 赞同：3
> 
> 时间：2008-09-12T23:27:39.173
> 
> 标签：c#, treeview

具体来说，我要做的是让我的 System.Windows.Forms.TreeView 控件中的节点图标在进行长时间加载操作时跳动。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-13T00:08:10.137

如果将每一帧加载到 ImageList 中，则可以使用循环更新每一帧。例子：

> ```
>  bool runThrobber = true;
>     private void AnimateThrobber(TreeNode animatedNode)
>     {
>         BackgroundWorker bg = new BackgroundWorker();
>         bg.DoWork += new DoWorkEventHandler(delegate
>         {
>             while (runThrobber)
>             {
>                 this.Invoke((MethodInvoker)delegate
>                 {
>                     animatedNode.SelectedImageIndex++;
>                     if (animatedNode.SelectedImageIndex >= imageList1.Images.Count) > animatedNode.SelectedImageIndex = 0;
>                 });
>                 Thread.Sleep(100);
>             }
>         });
>         bg.RunWorkerAsync();
>     } 
> ```

显然有不止几种方法可以实现这一点，但这是基本思想。

# python - 用python自动化firefox？

> ID：60152
> 
> 赞同：12
> 
> 时间：2008-09-12T23:28:16.830
> 
> 标签：python, linux, firefox, ubuntu, automation

一直在网上搜索类似firewatir但为python的东西。我正在尝试在 linux 上自动化 firefox。有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T00:48:35.843

你可以试试[selenium](http://selenium.openqa.org/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T06:41:51.757

PyXPCOM[扩展](https://developer.mozilla.org/en/PyXPCOM)是一种可能性。

但是看看 firewatir 提供了什么，我不得不对斜纹布提出第二个建议。它基于[mechanize](http://wwwsearch.sourceforge.net/mechanize/)，在这种情况下也可能有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-13T15:48:18.487

我使用[Selenium RC](http://selenium-rc.openqa.org/python.html)。我所有的测试都是用 Python 编写的，并使用测试套件运行。

一件小事是您要么必须手动启动 selenium 并将您的测试指向它，要么从需要一点编码的测试套件启动 selenium。但这是可行的。

一般来说，我对这个解决方案非常满意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T13:51:57.113

看看[斜纹布](http://twill.idyll.org/)能不能帮到你。它可以用作命令行工具或python库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-30T12:35:43.490

我建议您使用 Selenium 而不是 Mechanize/Twill，因为 Mechanize 在处理 Javascript 时会失败。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-13T00:46:40.107

Firefox 选择的语言是 Javascript。除非您有需要 Python 的特定要求，否则我建议您使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T14:06:18.187

在 Firefox 中安装[Mozlab](http://hyperstruct.net/projects/mozlab)并启用 telnet 服务器，然后打开一个套接字。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-08T18:01:59.153

许多命令行工具没有 javascript 解释器，因此不支持 web 2.0 功能。 [juicedpyshell](http://code.google.com/p/juicedpyshell)基于 PyXPCOMext 的 PyShell 示例。它在浏览器“内部”为您提供了一个 python shell 窗口，并简化了对您正在浏览的 DOM 以及 shell 窗口本身的访问（因此您可以添加 GUI 元素作为自动化脚本的一部分）。但它是一个新项目，因此可能不像上述一些项目那样功能齐全。

# java - 如何在Java中为正则表达式转义文本

> ID：60160
> 
> 赞同：346
> 
> 时间：2008-09-12T23:36:36.687
> 
> 标签：java, regex, escaping

Java 是否有内置的方法来转义任意文本，以便可以将其包含在正则表达式中？例如，如果我的用户输入“$5”，我想完全匹配它而不是输入结束后的“5”。

* * *

## 回答 #1

> 赞同：476
> 
> 时间：2008-09-12T23:39:52.123

从[Java 1.5 开始，是的](http://download.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#quote(java.lang.String))：

```
Pattern.quote("$5"); 
```

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2008-09-12T23:52:14.310

在我看到以下示例之前，我并不清楚[`Pattern.quote`](http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#quote-java.lang.String-)和之间的区别[`Matcher.quoteReplacement`](http://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#quoteReplacement-java.lang.String-)

```
s.replaceFirst(Pattern.quote("text to replace"), 
               Matcher.quoteReplacement("replacement text")); 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2016-03-14T15:04:02.993

响应可能为时已晚，但您也可以使用`Pattern.LITERAL`，它会在格式化时忽略所有特殊字符：

```
Pattern.compile(textToFormat, Pattern.LITERAL); 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-12T23:42:16.220

我想你追求的是`\Q$5\E`. 另见`Pattern.quote(s)`Java5中介绍。

有关详细信息，请参阅[模式](http://java.sun.com/javase/6/docs/api/java/util/regex/Pattern.html)javadoc。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2012-08-14T15:00:27.453

首先，如果

*   你使用 replaceAll()
*   你不要使用 Matcher.quoteReplacement()
*   要替换的文本包括 $1

它不会在最后放一个 1 。它将查看第一个匹配组的搜索正则表达式并将其插入。这就是替换文本中 $1、$2 或 $3 的含义：来自搜索模式的匹配组。

我经常将长字符串插入 .properties 文件，然后从中生成电子邮件主题和正文。事实上，这似乎是在 Spring Framework 中执行 i18n 的默认方式。我将 XML 标记作为占位符放入字符串中，并使用 replaceAll() 将 XML 标记替换为运行时的值。

我遇到了一个问题，用户输入带有美元符号的美元和美分数字。replaceAll() 被它呛住了，以下显示在 stracktrace 中：

```
java.lang.IndexOutOfBoundsException: No group 3
at java.util.regex.Matcher.start(Matcher.java:374)
at java.util.regex.Matcher.appendReplacement(Matcher.java:748)
at java.util.regex.Matcher.replaceAll(Matcher.java:823)
at java.lang.String.replaceAll(String.java:2201) 
```

在这种情况下，用户在其输入中的某处输入了“$3”，replaceAll() 在搜索正则表达式中查找第三个匹配组，但没有找到，然后吐了。

鉴于：

```
// "msg" is a string from a .properties file, containing "<userInput />" among other tags
// "userInput" is a String containing the user's input 
```

更换

```
msg = msg.replaceAll("<userInput \\/>", userInput); 
```

和

```
msg = msg.replaceAll("<userInput \\/>", Matcher.quoteReplacement(userInput)); 
```

解决了这个问题。用户可以毫无问题地输入任何类型的字符，包括美元符号。它的行为完全符合您的预期。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2012-11-15T20:27:30.873

要拥有受保护的模式，您可以用“\\\\”替换所有符号，数字和字母除外。之后，您可以在该受保护模式中放入您的特殊符号，以使该模式不像愚蠢的引用文本那样工作，而是真正像一个模式，而是您自己的模式。无用户特殊符号。

```
public class Test {
    public static void main(String[] args) {
        String str = "y z (111)";
        String p1 = "x x (111)";
        String p2 = ".* .* \\(111\\)";

        p1 = escapeRE(p1);

        p1 = p1.replace("x", ".*");

        System.out.println( p1 + "-->" + str.matches(p1) ); 
            //.*\ .*\ \(111\)-->true
        System.out.println( p2 + "-->" + str.matches(p2) ); 
            //.* .* \(111\)-->true
    }

    public static String escapeRE(String str) {
        //Pattern escaper = Pattern.compile("([^a-zA-z0-9])");
        //return escaper.matcher(str).replaceAll("\\\\$1");
        return str.replaceAll("([^a-zA-Z0-9])", "\\\\$1");
    }
} 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-07-31T12:26:41.050

Pattern.quote("blabla") 效果很好。

Pattern.quote() 效果很好。**它用字符“ \Q** ”和“ **\E** ”将句子括起来，如果它确实转义了“\Q”和“\E”。但是，如果您需要进行真正的正则表达式转义（或自定义转义），则可以使用以下代码：

```
String someText = "Some/s/wText*/,**";
System.out.println(someText.replaceAll("[-\\[\\]{}()*+?.,\\\\\\\\^$|#\\\\s]", "\\\\$0")); 
```

此方法返回：*Some/\s/wText*/\,***

代码示例和测试：

```
String someText = "Some\\E/s/wText*/,**";
System.out.println("Pattern.quote: "+ Pattern.quote(someText));
System.out.println("Full escape: "+someText.replaceAll("[-\\[\\]{}()*+?.,\\\\\\\\^$|#\\\\s]", "\\\\$0")); 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2018-06-22T15:00:14.100

^（否定）符号用于匹配不在字符组中的内容。

这是[正则表达式的链接](https://docs.microsoft.com/en-us/dotnet/standard/base-types/regular-expression-language-quick-reference)

这是关于否定的图像信息：

![关于否定的信息](https://i.stack.imgur.com/m5cXU.png)

# mysql - 以什么顺序处理 ON DELETE CASCADE 约束？

> ID：60168
> 
> 赞同：12
> 
> 时间：2008-09-12T23:46:52.777
> 
> 标签：mysql, database-design, mysql-error-1451

这是我正在做的一个例子：

```
CREATE TABLE Parent (id BIGINT NOT NULL,
  PRIMARY KEY (id)) ENGINE=InnoDB;

CREATE TABLE Child (id BIGINT NOT NULL,
  parentid BIGINT NOT NULL,
  PRIMARY KEY (id),
  KEY (parentid),
  CONSTRAINT fk_parent FOREIGN KEY (parentid) REFERENCES Parent (id) ON DELETE CASCADE) ENGINE=InnoDB;

CREATE TABLE Uncle (id BIGINT NOT NULL,
  parentid BIGINT NOT NULL,
  childid BIGINT NOT NULL,
  PRIMARY KEY (id),
  KEY (parentid),
  KEY (childid),
  CONSTRAINT fk_parent_u FOREIGN KEY (parentid) REFERENCES Parent (id) ON DELETE CASCADE,
  CONSTRAINT fk_child FOREIGN KEY (childid) REFERENCES Child (id)) ENGINE=InnoDB; 
```

请注意，Uncle-Child 关系没有 ON DELETE CASCADE；即删除 Child 不会删除其 Uncle，反之亦然。

当我有同一个孩子的父母和叔叔时，我删除了父母，*似乎*InnoDB 应该能够“弄清楚”并让级联在整个家庭中涟漪（即删除父母删除叔叔和孩子也是如此）。但是，相反，我得到以下信息：

```
 ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`cascade_test/uncle`, CONSTRAINT `fk_child` FOREIGN KEY (`childid`) REFERENCES `child` (`id`)) 
```

InnoDB 正在尝试在引用它的 Uncle 之前级联删除 Child。

我错过了什么吗？这是否*应该*由于某种我不明白的原因而失败？或者是否有一些技巧可以让它工作（或者它是 MySQL 中的一个错误）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-13T00:08:22.443

在更简单的情况下，如果从 Child 中删除一条记录并且它有一个引用 Uncle 会发生什么？这是未指定的，因此无论如何约束都失败了。

如果删除一个 Child 并没有删除它的 Uncles，那么会发生什么呢？Uncle.childid 不能为空。

您想要的是以下三件事之一：

1.  Uncle.childid 可以为 null，并且您希望为 childid 设置 ON DELETE SET NULL。
2.  Uncle.childid 不能为 null，并且您希望对 childid 进行 ON DELETE CASCADE。
3.  Childid 不属于 Uncle，并且您希望 ChildsUncle 关系具有对 Child 和 Uncle 的 ON DELETE CASCADE 外键约束。Uncleid 将是该关系的候选键（即它应该是唯一的）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T22:38:24.373

正如您所说，父删除正在触发子删除，我不知道为什么它会在叔表之前进入子表。我想您必须查看 dbms 代码才能确定，但​​我确定有一种算法可以选择首先级联的表。

该系统并没有真正按照您在此处暗示的方式“找出”东西，它只是遵循其约束规则。问题是您创建的架构遇到了一个不允许它进一步通过的约束。

我明白你在说什么.. 如果它首先击中叔叔表，它将删除记录然后删除子项（而不是从子项删除中击中叔叔级联）。但即便如此，我认为不会建立一个模式来依赖现实中的这种行为。我认为确定发生了什么的唯一方法是查看代码或让这里的 mysql/postgresql 程序员之一说出它如何处理 fk 约束。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-07T17:51:47.487

@Matt Solnit 首先，这确实是一个好问题，据我所知，何时要删除 Parent 中的记录，然后 innodb 首先尝试确定哪些其他表包含对它的引用，以便它可以从中删除记录好。在您的情况下，它是 Child 表和 Uncle 表，现在看来，在这种情况下，它决定首先从 Child 表中删除记录，因此它对 Child 重复相同的过程并最终失败，因为 Uncle 持有对 Child 表的引用，但既不是“ON在 Uncle 表中为 fk_child FK 指定了 DELETE CASCADE”或“ON DELETE SET NULL”。然而，*如果*innodb 首先尝试从 Uncle 表中删除记录，然后删除应该顺利进行。好吧，在考虑了一下之后，我认为由于 innodb 遵循 ACID 模型，因此它选择 Child 而不是 Uncle 来启动删除过程，因为如果它以 Uncle 开头，即使那么 Child 中的删除可能仍然失败，例如假设一个具有 fk_child 键的 Friend 表（类似于 Uncle）没有 ON DELETE CASCADE，现在这仍然会导致整个事务失败，因此这对我来说是正确的行为。换句话说，innodb 从可能导致事务可能失败的表开始，但这是我的理论，实际上它可能是一个完全不同的故事。:)

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-09-13T01:02:21.800

设计都是错误的。你应该有一个表，有父子关系（字面意思）。然后你可以通过查询找出叔叔（和阿姨）

`select id from persons where -find all children of the grandparents
parent id in (
select parentid from persons --find the grandparents
where id in (
select parentid from persons --find the parents
where id=THECHILD) )
minus --and take out the child's parents
select parentid from persons
where id=THECHILD` 

# php - 如何防止 PHP 中的 SQL 注入？

> ID：60174
> 
> 赞同：2773
> 
> 时间：2008-09-12T23:55:00.900
> 
> 标签：php, mysql, sql, security, sql-injection

如果用户输入未经修改就插入到 SQL 查询中，则应用程序容易受到[SQL 注入](https://stackoverflow.com/a/332367/)的攻击，如下例所示：

```
$unsafe_variable = $_POST['user_input']; 

mysql_query("INSERT INTO `table` (`column`) VALUES ('$unsafe_variable')"); 
```

那是因为用户可以输入类似`value'); DROP TABLE table;--`的内容，查询变为：

```
INSERT INTO `table` (`column`) VALUES('value'); DROP TABLE table;--') 
```

可以做些什么来防止这种情况发生？

* * *

## 回答 #1

> 赞同：9408
> 
> 时间：2008-09-13T12:30:26.950

无论您使用哪个数据库，避免 SQL 注入攻击的*正确方法是***将数据与 SQL 分离**，以便数据保持数据，**永远不会被 SQL 解析器解释**为命令。可以使用格式正确的数据部分创建 SQL 语句，但如果您不*完全*了解详细信息，则应始终**使用准备好的语句和参数化查询。**这些是与任何参数分开发送到数据库服务器并由其解析的 SQL 语句。这样攻击者就不可能注入恶意 SQL。

你基本上有两种选择来实现这一点：

1.  使用[**PDO**](http://php.net/manual/en/book.pdo.php)（对于任何支持的数据库驱动程序）：

    ```
     $stmt = $pdo->prepare('SELECT * FROM employees WHERE name = :name');

     $stmt->execute([ 'name' => $name ]);

     foreach ($stmt as $row) {
         // Do something with $row
     } 
    ```

2.  使用[**MySQLi**](http://php.net/manual/en/book.mysqli.php)（用于 MySQL）：

    ```
     $stmt = $dbConnection->prepare('SELECT * FROM employees WHERE name = ?');
     $stmt->bind_param('s', $name); // 's' specifies the variable type => 'string'

     $stmt->execute();

     $result = $stmt->get_result();
     while ($row = $result->fetch_assoc()) {
         // Do something with $row
     } 
    ```

如果您要连接到 MySQL 以外的数据库，则可以参考特定于驱动程序的第二个选项（例如，`pg_prepare()`对于`pg_execute()`PostgreSQL）。PDO 是通用选项。

* * *

## 正确设置连接

请注意，当使用**PDO**访问 MySQL 数据库时**，默认情况下不使用***实际*准备好的语句。要解决此问题，您必须禁用准备好的语句的模拟。**使用PDO**创建连接的示例是：

 ****```
$dbConnection = new PDO('mysql:dbname=dbtest;host=127.0.0.1;charset=utf8', 'user', 'password');

$dbConnection->setAttribute(PDO::ATTR_EMULATE_PREPARES, false);
$dbConnection->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); 
```

在上面的示例中，错误模式并不是绝对必要的，**但建议添加它**。这样脚本就不会`Fatal Error`在出现问题时停止。它使开发人员有机会处理n as s 的`catch`任何错误。`throw``PDOException`

然而，**强制性**的是第一`setAttribute()`行，它告诉 PDO 禁用模拟的预准备语句并使用*真正的*预准备语句。这确保了语句和值在将其发送到 MySQL 服务器之前不会被 PHP 解析（使可能的攻击者没有机会注入恶意 SQL）。

尽管您可以`charset`在构造函数的选项中设置 ，但重要的是要注意“旧”版本的 PHP（5.3.6 之前）[会默默地忽略](http://php.net/manual/en/ref.pdo-mysql.connection.php)DSN 中的 charset 参数。

* * *

## 解释

您传递给的 SQL 语句`prepare`由数据库服务器解析和编译。通过指定参数（如上例中的`?`参数或命名参数`:name`），您可以告诉数据库引擎您要过滤的位置。然后，当您调用 时`execute`，准备好的语句将与您指定的参数值相结合。

这里重要的是参数值与编译语句组合在一起，而不是 SQL 字符串。SQL 注入的工作原理是在创建要发送到数据库的 SQL 时诱使脚本包含恶意字符串。因此，通过将实际 SQL 与参数分开发送，您可以限制以您不想要的东西结束的风险。

您在使用准备好的语句时发送的任何参数都将被视为字符串（尽管数据库引擎可能会进行一些优化，因此参数也可能最终以数字形式结束）。在上面的示例中，如果`$name`变量包含`'Sarah'; DELETE FROM employees`结果将只是对 string 的搜索`"'Sarah'; DELETE FROM employees"`，并且您最终不会得到[一个空 table](http://xkcd.com/327/)。

使用准备好的语句的另一个好处是，如果您在同一个会话中多次执行相同的语句，它只会被解析和编译一次，从而为您带来一些速度提升。

哦，既然你问过如何插入，这里有一个例子（使用 PDO）：

```
$preparedStatement = $db->prepare('INSERT INTO table (column) VALUES (:column)');

$preparedStatement->execute([ 'column' => $unsafeValue ]); 
```

* * *

## 准备好的语句可以用于动态查询吗？

虽然您仍然可以为查询参数使用准备好的语句，但动态查询本身的结构无法参数化，某些查询功能也无法参数化。

对于这些特定场景，最好的办法是使用限制可能值的白名单过滤器。

```
// Value whitelist
// $dir can only be 'DESC', otherwise it will be 'ASC'
if (empty($dir) || $dir !== 'DESC') {
   $dir = 'ASC';
} 
```

* * *

## 回答 #2

> 赞同：1711
> 
> 时间：2008-09-13T09:48:48.617

> **不推荐使用的警告：** 此答案的示例代码（如问题的示例代码）使用 PHP 的`MySQL`扩展，该扩展在 PHP 5.5.0 中已弃用，并在 PHP 7.0.0 中完全删除。
> 
> **安全警告**：此答案不符合安全最佳实践。[转义不足以防止 SQL 注入](https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide)，请改用*准备好的语句*。使用下面概述的策略，风险自负。（另外，`mysql_real_escape_string()`在 PHP 7 中被删除。）

如果您使用的是最新版本的 PHP，`mysql_real_escape_string`下面列出的选项将不再可用（尽管`mysqli::escape_string`是现代的等效选项）。如今，该`mysql_real_escape_string`选项仅对旧版本 PHP 上的遗留代码有意义。

* * *

您有两个选择 - 转义 中的特殊字符`unsafe_variable`，或使用参数化查询。两者都可以保护您免受 SQL 注入。参数化查询被认为是更好的做法，但需要在 PHP 中更改为较新的 MySQL 扩展，然后才能使用它。

我们将首先介绍较低的影响字符串逃脱一个。

```
//Connect

$unsafe_variable = $_POST["user-input"];
$safe_variable = mysql_real_escape_string($unsafe_variable);

mysql_query("INSERT INTO table (column) VALUES ('" . $safe_variable . "')");

//Disconnect 
```

另请参阅[`mysql_real_escape_string`](http://php.net/mysql_real_escape_string)函数的详细信息。

要使用参数化查询，您需要使用[MySQLi](http://php.net/mysqli)而不是[MySQL](http://php.net/mysql)函数。要重写您的示例，我们需要以下内容。

```
<?php
    $mysqli = new mysqli("server", "username", "password", "database_name");

    // TODO - Check that connection was successful.

    $unsafe_variable = $_POST["user-input"];

    $stmt = $mysqli->prepare("INSERT INTO table (column) VALUES (?)");

    // TODO check that $stmt creation succeeded

    // "s" means the database expects a string
    $stmt->bind_param("s", $unsafe_variable);

    $stmt->execute();

    $stmt->close();

    $mysqli->close();
?> 
```

您要阅读的关键功能是[`mysqli::prepare`](http://php.net/mysqli.prepare).

[此外，正如其他人所建议的那样，您可能会发现使用PDO](http://php.net/pdo)之类的东西来加强抽象层很有用/更容易。

请注意，您询问的案例是一个相当简单的案例，更复杂的案例可能需要更复杂的方法。尤其：

*   如果您想根据用户输入更改 SQL 的结构，参数化查询将无济于事，并且所需的转义不在`mysql_real_escape_string`. 在这种情况下，您最好将用户的输入通过白名单传递，以确保只允许“安全”值通过。
*   如果您在条件中使用来自用户输入的整数并采用该`mysql_real_escape_string`方法，您将遇到下面评论中[多项式描述的问题。](https://stackoverflow.com/users/978756/polynomial)这种情况比较棘手，因为整数不会被引号包围，因此您可以通过验证用户输入仅包含数字来处理。
*   可能还有其他我不知道的情况。您可能会发现[这](http://webappsec.org/projects/articles/091007.txt)是一个有用的资源，可以解决您可能遇到的一些更微妙的问题。

* * *

## 回答 #3

> 赞同：1129
> 
> 时间：2011-11-24T09:50:49.593

这里的每个答案都只涵盖了问题的一部分。事实上，我们可以动态地将**四个**不同的查询部分添加到 SQL 中：-

*   一个字符串
*   一个号码
*   标识符
*   语法关键字

准备好的陈述只涵盖其中两个。

但有时我们必须使查询更加动态，同时添加运算符或标识符。因此，我们将需要不同的保护技术。

一般来说，这种保护方法是基于*白名单*的。

在这种情况下，每个动态参数都应该在您的脚本中进行硬编码并从该集合中选择。例如，要进行动态排序：

```
$orders  = array("name", "price", "qty"); // Field names
$key = array_search($_GET['sort'], $orders)); // if we have such a name
$orderby = $orders[$key]; // If not, first one will be set automatically. 
$query = "SELECT * FROM `table` ORDER BY $orderby"; // Value is safe 
```

为了简化这个过程，我编写了一个[白名单辅助函数](https://phpdelusions.net/pdo_examples/order_by)，它可以在一行中完成所有工作：

```
$orderby = white_list($_GET['orderby'], "name", ["name","price","qty"], "Invalid field name");
$query  = "SELECT * FROM `table` ORDER BY `$orderby`"; // sound and safe 
```

还有另一种保护标识符的方法 - 转义，但我宁愿坚持将白名单作为一种更强大和明确的方法。然而，只要您引用了标识符，您就可以转义引号字符以使其安全。例如，默认情况下，对于 mysql，您必须[将引号字符加倍才能对其进行转义](https://dev.mysql.com/doc/refman/8.0/en/identifiers.html)。对于其他其他 DBMS 转义规则会有所不同。

尽管如此，SQL 语法关键字（例如`AND`,`DESC`等）仍然存在问题，但在这种情况下，白名单似乎是唯一的方法。

因此，一般建议可以表述为

> *   任何表示 SQL 数据文字的变量（或者，简单地说 - SQL 字符串或数字）都必须通过准备好的语句添加。没有例外。
> *   任何其他查询部分，例如 SQL 关键字、表或字段名称或运算符 - 必须通过白名单进行过滤。

### 更新

尽管关于 SQL 注入保护的最佳实践达成了普遍共识，但**仍然存在许多不好的实践。**其中一些在 PHP 用户的脑海中根深蒂固。例如，在这个页面上（尽管大多数访问者看不到）**超过 80 个已删除的答案**- 由于质量差或宣传不良和过时的做法，所有答案都被社区删除。更糟糕的是，一些不好的答案并没有被删除，而是蓬勃发展。

例如，[there(1)](https://stackoverflow.com/a/11802479) [are(2)](https://stackoverflow.com/a/6381189) [still(3)](https://stackoverflow.com/a/60195/) [many(4)](https://stackoverflow.com/a/12426697/) [answers(5)](https://stackoverflow.com/a/21179234)，包括建议您手动转义字符串的[第二个最受好评的答案](https://stackoverflow.com/a/60442)- 一种已被证明不安全的过时方法。

或者有一个稍微好一点的答案，它暗示了[另一种字符串格式化方法](https://stackoverflow.com/a/12710285)，甚至把它吹捧为终极灵丹妙药。当然，事实并非如此。这种方法并不比常规字符串格式化好，但它保留了所有缺点：它仅适用于字符串，并且与任何其他手动格式化一样，它本质上是可选的、非强制性的措施，容易出现任何类型的人为错误。

[我认为这一切都是因为一个非常古老的迷信，得到了OWASP](https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet#Defense_Option_4:_Escaping_All_User_Supplied_Input)或[PHP 手册](http://php.net/manual/en/function.mysql-real-escape-string.php#refsect1-function.mysql-real-escape-string-description)等权威机构的支持，它宣称任何“转义”和 SQL 注入保护之间都是平等的。

不管 PHP 手册多年来说什么，**`*_escape_string`绝不会保证数据安全**，也从来没有打算这样做。除了对字符串以外的任何 SQL 部分无用之外，手动转义也是错误的，因为它是手动的，与自动相反。

OWASP 让情况变得更糟，强调转义*用户输入*，这完全是胡说八道：在注入保护的上下文中不应该有这样的词。每个变量都有潜在的危险 - 无论来源如何！或者，换句话说 - 每个变量都必须正确格式化才能放入查询中 - 无论来源如何。重要的是目的地。开发人员开始将绵羊与山羊分开的那一刻（考虑某个特定变量是否“安全”）他/她迈出了走向灾难的第一步。更不用说，甚至措辞都暗示在入口点进行批量转义，类似于非常神奇的引号功能 - 已经被鄙视、弃用和删除。

因此，与任何“转义”不同，准备好的语句*是*确实防止 SQL 注入的措施（如果适用）。

* * *

## 回答 #4

> 赞同：882
> 
> 时间：2008-09-13T00:02:20.430

我建议使用[PDO](http://ca3.php.net/manual/en/book.pdo.php)（PHP 数据对象）来运行参数化 SQL 查询。

这不仅可以防止 SQL 注入，还可以加快查询速度。

通过使用 PDO 而不是`mysql_`、`mysqli_`和`pgsql_`函数，您可以使您的应用程序从数据库中更加抽象一点，在极少数情况下您必须切换数据库提供程序。

* * *

## 回答 #5

> 赞同：654
> 
> 时间：2008-09-13T13:20:56.860

使用`PDO`和准备好的查询。

（`$conn`是一个`PDO`对象）

```
$stmt = $conn->prepare("INSERT INTO tbl VALUES(:id, :name)");
$stmt->bindValue(':id', $id);
$stmt->bindValue(':name', $name);
$stmt->execute(); 
```

* * *

## 回答 #6

> 赞同：577
> 
> 时间：2012-10-03T14:07:42.387

如您所见，人们建议您最多使用准备好的语句。这没有错，但是当您的查询在每个进程中**只执行一次**时，性能会受到轻微影响。

我遇到了这个问题，但我认为我以*非常*复杂的方式解决了它——黑客用来避免使用引号的方式。我将它与模拟的准备好的语句结合使用。我用它来防止*各种*可能的 SQL 注入攻击。

## 我的做法：

*   如果您希望输入是整数，请确保它***确实是***整数。在像 PHP 这样的可变类型语言中，这一点*非常*重要。例如，您可以使用这个非常简单但功能强大的解决方案：`sprintf("SELECT 1,2,3 FROM table WHERE 4 = %u", $input);`

*   **如果您期望从整数十六进制中**获得任何其他信息。如果你对它进行十六进制，你将完美地逃避所有输入。在 C/C++ 中有一个函数叫做[`mysql_hex_string()`](http://dev.mysql.com/doc/refman/5.0/en/mysql-hex-string.html)，在 PHP 中你可以使用[`bin2hex()`](http://www.php.net/manual/en/function.bin2hex.php).

    不用担心转义字符串的大小会是其原始长度的 2 倍，因为即使使用`mysql_real_escape_string`，PHP 也必须分配相同的容量`((2*input_length)+1)`，这是相同的。

*   传输二进制数据时经常使用这种十六进制方法，但我认为没有理由不对所有数据使用它来防止 SQL 注入攻击。请注意，您必须在数据前添加`0x`或使用 MySQL 函数`UNHEX`。

因此，例如，查询：

```
SELECT password FROM users WHERE name = 'root'; 
```

会变成：

```
SELECT password FROM users WHERE name = 0x726f6f74; 
```

或者

```
SELECT password FROM users WHERE name = UNHEX('726f6f74'); 
```

Hex是完美的逃生方式。没办法注入。

## UNHEX函数和0x前缀的区别

评论里有一些讨论，所以我最后想说清楚。这两种方法非常相似，但在某些方面略有不同：

`0x`前缀只能用于 , , , , 等数据列。`char`另外`varchar`，`text`如果要插入空字符串`block`， 它的使用会有点复杂。您必须将其完全替换为，否则会出现错误。`binary`
`''`

`UNHEX()`适用于**任何**列；您不必担心空字符串。

* * *

## 十六进制方法经常被用作攻击

请注意，这种十六进制方法通常用作 SQL 注入攻击，其中整数就像字符串一样，只是用`mysql_real_escape_string`. 然后你可以避免使用引号。

例如，如果您只是执行以下操作：

```
"SELECT title FROM article WHERE id = " . mysql_real_escape_string($_GET["id"]) 
```

一次攻击可以很*容易地*注入你。考虑以下从您的脚本返回的注入代码：

```
SELECT ... WHERE id = -1 UNION ALL SELECT table_name FROM information_schema.tables; 
```

现在只需提取表结构：

```
SELECT ... WHERE id = -1 UNION ALL SELECT column_name FROM information_schema.column WHERE table_name = __0x61727469636c65__; 
```

然后只需选择所需的任何数据。不是很酷吗？

但是，如果可注入站点的编码器对其进行十六进制处理，则不可能进行注入，因为查询如下所示：

```
SELECT ... WHERE id = UNHEX('2d312075...3635'); 
```

* * *

## 回答 #7

> 赞同：513
> 
> 时间：2011-06-17T04:00:21.353

> **不推荐使用的警告：** 此答案的示例代码（如问题的示例代码）使用 PHP 的`MySQL`扩展，该扩展在 PHP 5.5.0 中已弃用，并在 PHP 7.0.0 中完全删除。
> 
> **安全警告**：此答案不符合安全最佳实践。[转义不足以防止 SQL 注入](https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide)，请改用*准备好的语句*。使用下面概述的策略，风险自负。（另外，`mysql_real_escape_string()`在 PHP 7 中被删除。）
> 
> **重要的**
> 
> 正如[公认的答案](https://stackoverflow.com/a/60496/2224584)所示，防止 SQL 注入的最佳方法是使用**Prepared Statements** *而不是 escaping*。
> 
> [Aura.Sql](https://github.com/auraphp/Aura.Sql)和[EasyDB](https://github.com/paragonie/easydb)等库允许开发人员更轻松地使用准备好的语句。要详细了解为什么准备好的语句更[擅长阻止 SQL 注入](https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide)，请参阅[此`mysql_real_escape_string()`绕过](https://stackoverflow.com/a/12118602/2224584)和[最近修复的 WordPress 中的 Unicode SQL 注入漏洞](https://kraft.im/2015/05/how-emoji-saved-your-sites-hide/)。

注入预防 - [mysql_real_escape_string()](http://php.net/manual/en/function.mysql-real-escape-string.php)

PHP 有一个专门的函数来防止这些攻击。您需要做的就是使用满口的功能，`mysql_real_escape_string`.

`mysql_real_escape_string`接受一个将在 MySQL 查询中使用的字符串，并返回相同的字符串，所有 SQL 注入尝试都安全转义。基本上，它将用一个 MySQL 安全的替代品，一个转义的引号 \' 替换用户可能输入的那些麻烦的引号（'）。

**注意：**您必须连接到数据库才能使用此功能！

// 连接到 MySQL

```
$name_bad = "' OR 1'"; 

$name_bad = mysql_real_escape_string($name_bad);

$query_bad = "SELECT * FROM customers WHERE username = '$name_bad'";
echo "Escaped Bad Injection: <br />" . $query_bad . "<br />";

$name_evil = "'; DELETE FROM customers WHERE 1 or username = '"; 

$name_evil = mysql_real_escape_string($name_evil);

$query_evil = "SELECT * FROM customers WHERE username = '$name_evil'";
echo "Escaped Evil Injection: <br />" . $query_evil; 
```

*[您可以在MySQL-SQL 注入防护](http://www.tizag.com/mysqlTutorial/mysql-php-sql-injection.php)*中找到更多详细信息。

* * *

## 回答 #8

> 赞同：480
> 
> 时间：2008-09-13T00:15:53.283

你可以做一些基本的事情是这样的：

```
$safe_variable = mysqli_real_escape_string($_POST["user-input"], $dbConnection);
mysqli_query($dbConnection, "INSERT INTO table (column) VALUES ('" . $safe_variable . "')"); 
```

这不会解决所有问题，但它是一个很好的垫脚石。我省略了明显的项目，例如检查变量的存在、格式（数字、字母等）。

* * *

## 回答 #9

> 赞同：393
> 
> 时间：2008-12-08T05:26:35.927

无论您最终使用什么，请确保您检查您的输入是否已经被`magic_quotes`或其他一些善意的垃圾所破坏，如有必要，请运行它`stripslashes`或进行任何清理。

* * *

## 回答 #10

> 赞同：375
> 
> 时间：2011-07-03T21:50:15.280

> **不推荐使用的警告：** 此答案的示例代码（如问题的示例代码）使用 PHP 的`MySQL`扩展，该扩展在 PHP 5.5.0 中已弃用，并在 PHP 7.0.0 中完全删除。
> 
> **安全警告**：此答案不符合安全最佳实践。[转义不足以防止 SQL 注入](https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide)，请改用*准备好的语句*。使用下面概述的策略，风险自负。（另外，`mysql_real_escape_string()`在 PHP 7 中被删除。）

参数化查询和输入验证是要走的路。尽管`mysql_real_escape_string()`已经使用了 SQL 注入，但在许多情况下都可能发生 SQL 注入。

这些示例易受 SQL 注入攻击：

```
$offset = isset($_GET['o']) ? $_GET['o'] : 0;
$offset = mysql_real_escape_string($offset);
RunQuery("SELECT userid, username FROM sql_injection_test LIMIT $offset, 10"); 
```

或者

```
$order = isset($_GET['o']) ? $_GET['o'] : 'userid';
$order = mysql_real_escape_string($order);
RunQuery("SELECT userid, username FROM sql_injection_test ORDER BY `$order`"); 
```

在这两种情况下，您都不能使用`'`来保护封装。

[来源](http://www.webappsec.org/projects/articles/091007.txt)：*意外的 SQL 注入（当转义不够时）*

* * *

## 回答 #11

> 赞同：320
> 
> 时间：2012-07-03T10:14:50.590

在我看来，通常在 PHP 应用程序（或任何 Web 应用程序）中防止 SQL 注入的最佳方法是考虑应用程序的架构。如果防止 SQL 注入的唯一方法是记住每次与数据库交谈时都使用一种特殊的方法或函数来执行正确的事情，那么你做错了。这样，您忘记在代码中的某个位置正确格式化查询只是时间问题。

采用 MVC 模式和像[CakePHP](http://cakephp.org/)或[CodeIgniter](http://codeigniter.com/)这样的框架可能是正确的方法：创建安全数据库查询等常见任务已在此类框架中得到解决和集中实现。它们帮助您以一种合理的方式组织您的 Web 应用程序，并使您更多地考虑加载和保存对象，而不是安全地构建单个 SQL 查询。

* * *

## 回答 #12

> 赞同：311
> 
> 时间：2009-11-03T18:05:20.810

从安全的角度来看，我喜欢[存储过程](http://en.wikipedia.org/wiki/Stored_procedure)（[MySQL 从 5.0 开始就支持存储过程）——优点是——](http://dev.mysql.com/doc/refman/5.1/en/stored-routines-syntax.html)

1.  大多数数据库（包括[MySQL](http://dev.mysql.com/doc/refman/5.1/en/stored-routines-privileges.html)）允许用户访问被限制为执行存储过程。细粒度的安全访问控制有助于防止权限升级攻击。这可以防止受感染的应用程序能够直接针对数据库运行 SQL。
2.  它们从应用程序中抽象出原始 SQL 查询，因此应用程序可以使用的数据库结构信息较少。这使得人们更难理解数据库的底层结构和设计合适的攻击。
3.  它们只接受参数，因此参数化查询的优势就在那里。当然 - IMO 你仍然需要清理你的输入 - 特别是如果你在存储过程中使用动态 SQL。

缺点是——

1.  它们（存储过程）很难维护，并且往往会迅速增加。这使得管理它们成为一个问题。
2.  它们不太适合动态查询——如果它们被构建为接受动态代码作为参数，那么很多优点都被否定了。

* * *

## 回答 #13

> 赞同：311
> 
> 时间：2012-07-23T10:19:50.530

有很多方法可以防止 SQL 注入和其他 SQL 黑客攻击。您可以在 Internet 上轻松找到它（Google 搜索）。当然，**PDO 是很好的解决方案之一。**但我想建议你一些好的链接预防 SQL 注入。

*[什么是 SQL 注入以及如何预防](http://www.tizag.com/mysqlTutorial/mysql-php-sql-injection.php)*

*[SQL注入的PHP手册](https://php.net/manual/en/security.database.sql-injection.php)*

*[微软讲解PHP中SQL注入及预防](https://docs.microsoft.com/en-gb/archive/blogs/brian_swan/whats-the-right-way-to-prevent-sql-injection-in-php-scripts)*

还有一些其他的，比如*[用 MySQL 和 PHP 防止 SQL 注入](https://web.archive.org/web/20190221025712/http://www.digifuzz.net/archives/2007/07/preventing-sql-injection-with-php/)*。

现在，**为什么你需要防止你的查询被 SQL 注入？**

我想让您知道：为什么我们要尝试通过以下简短示例来防止 SQL 注入：

登录认证匹配查询：

```
$query="select * from users where email='".$_POST['email']."' and password='".$_POST['password']."' "; 
```

现在，如果有人（黑客）把

```
$_POST['email']= admin@emali.com' OR '1=1 
```

和密码什么的......

查询将被解析到系统中，直到：

```
$query="select * from users where email='admin@emali.com' OR '1=1'; 
```

另一部分将被丢弃。那么，会发生什么？未经授权的用户（黑客）无需密码即可以管理员身份登录。现在，他/她可以做管理员/电子邮件人员可以做的任何事情。看，如果不阻止 SQL 注入，那是非常危险的。

* * *

## 回答 #14

> 赞同：274
> 
> 时间：2012-10-10T14:53:49.153

我想如果有人想使用 PHP 和 MySQL 或其他一些数据库服务器：

1.  考虑学习[PDO](http://php.net/manual/en/book.pdo.php)（PHP 数据对象）——它是一个数据库访问层，提供访问多个数据库的统一方法。
2.  考虑学习[MySQLi](http://en.wikipedia.org/wiki/MySQLi)
3.  使用原生 PHP 函数，例如：[strip_tags](http://php.net/manual/en/function.strip-tags.php)、[mysql_real_escape_string](http://php.net/manual/en/function.mysql-real-escape-string.php)或如果变量为数字，则为`(int)$foo`. [在此处](http://php.net/manual/en/language.types.php)阅读有关 PHP 中变量类型的更多信息。如果您使用 PDO 或 MySQLi 等库，请始终使用[PDO::quote()](http://php.net/manual/en/pdo.quote.php)和[mysqli_real_escape_string()](http://php.net/manual/en/mysqli.real-escape-string.php)。

* * *

**库示例：**

---- **PDO**

> ----- 没有占位符 - SQL 注入的时机已经成熟！**这不好**

```
$request = $pdoConnection->("INSERT INTO parents (name, addr, city) values ($name, $addr, $city)"); 
```

> ----- 未命名的占位符

```
$request = $pdoConnection->("INSERT INTO parents (name, addr, city) values (?, ?, ?); 
```

> ----- 命名占位符

```
$request = $pdoConnection->("INSERT INTO parents (name, addr, city) value (:name, :addr, :city)"); 
```

--- **MySQLi**

```
$request = $mysqliConnection->prepare('
       SELECT * FROM trainers
       WHERE name = ?
       AND email = ?
       AND last_login > ?');

    $query->bind_param('first_param', 'second_param', $mail, time() - 3600);
    $query->execute(); 
```

* * *

**PS**：

PDO 轻松赢得了这场战斗。由于支持十二种不同的数据库驱动程序和命名参数，我们可以忽略小的性能损失，并习惯它的 API。从安全的角度来看，只要开发人员以应有的方式使用它们，它们都是安全的

但是，虽然 PDO 和 MySQLi 都非常快，但 MySQLi 在基准测试中的执行速度却微不足道——非准备语句约为 2.5%，准备语句约为 6.5%。

**请测试对您数据库的每个查询 - 这是防止注入的更好方法。**

* * *

## 回答 #15

> 赞同：267
> 
> 时间：2012-06-12T08:03:08.573

如果可能，请转换参数的类型。但它只适用于简单类型，如 int、bool 和 float。

```
$unsafe_variable = $_POST['user_id'];

$safe_variable = (int)$unsafe_variable ;

mysqli_query($conn, "INSERT INTO table (column) VALUES ('" . $safe_variable . "')"); 
```

* * *

## 回答 #16

> 赞同：238
> 
> 时间：2012-10-15T13:52:37.080

如果您想利用缓存引擎，如[Redis](http://en.wikipedia.org/wiki/Redis_%28data_store%29)或[Memcached](http://en.wikipedia.org/wiki/Memcached)，也许 DALMP 可能是一个选择。它使用纯[MySQLi](http://en.wikipedia.org/wiki/MySQLi)。检查这个：[使用 PHP 的 MySQL 的 DALMP 数据库抽象层。](http://dalmp.readthedocs.org/en/latest/database/PExecute.html)

此外，您可以在准备查询之前“准备”您的参数，以便您可以构建动态查询并最终获得完全准备好的语句查询。[使用 PHP 的 MySQL 的 DALMP 数据库抽象层。](http://dalmp.readthedocs.org/en/latest/database/Prepare.html)

* * *

## 回答 #17

> 赞同：231
> 
> 时间：2012-09-19T18:10:33.653

对于那些不确定如何使用 PDO（来自`mysql_`函数）的人，我制作了一个[非常非常简单的 PDO 包装器](https://github.com/Xeoncross/DByte/blob/master/DByte/DB.php)，它是一个文件。它的存在是为了展示完成应用程序需要完成的所有常见事情是多么容易。适用于 PostgreSQL、MySQL 和 SQLite。

基本上，[在阅读手册的同时阅读它，了解如何将 PDO 函数用于现实生活](http://php.net/pdo)**中**，以便以所需格式轻松存储和检索值。

> **我想要一个单列**
> 
> ```
> $count = DB::column('SELECT COUNT(*) FROM `user`'); 
> ```
> 
> **我想要一个数组（键 => 值）结果（即用于制作选择框）**
> 
> ```
> $pairs = DB::pairs('SELECT `id`, `username` FROM `user`'); 
> ```
> 
> **我想要一个单行结果**
> 
> ```
> $user = DB::row('SELECT * FROM `user` WHERE `id` = ?', array($user_id)); 
> ```
> 
> **我想要一系列结果**
> 
> ```
> $banned_users = DB::fetch('SELECT * FROM `user` WHERE `banned` = ?', array('TRUE')); 
> ```

* * *

## 回答 #18

> 赞同：227
> 
> 时间：2013-05-09T16:36:55.423

在 SQL 语句中转义特殊字符的一些准则。

不要使用[MySQL](http://www.php.net/manual/en/intro.mysql.php)。此扩展已弃用。请改用[MySQLi](http://php.net/manual/en/book.mysqli.php)或[PDO](http://php.net/manual/en/book.pdo.php)。

**MySQLi**

要手动转义字符串中的特殊字符，您可以使用[mysqli_real_escape_string](http://www.php.net/manual/en/mysqli.real-escape-string.php)函数。[除非使用mysqli_set_charset](http://www.php.net/manual/en/mysqli.set-charset.php)设置了正确的字符集，否则该函数将无法正常工作。

例子：

```
$mysqli = new mysqli('host', 'user', 'password', 'database');
$mysqli->set_charset('charset');

$string = $mysqli->real_escape_string($string);
$mysqli->query("INSERT INTO table (column) VALUES ('$string')"); 
```

要使用准备好的语句自动转义值，请使用[mysqli_prepare](http://www.php.net/manual/en/mysqli.prepare.php)和[mysqli_stmt_bind_param](http://www.php.net/manual/en/mysqli-stmt.bind-param.php)，其中必须提供相应绑定变量的类型以进行适当的转换：

例子：

```
$stmt = $mysqli->prepare("INSERT INTO table (column1, column2) VALUES (?,?)");

$stmt->bind_param("is", $integer, $string);

$stmt->execute(); 
```

无论您使用预准备语句还是`mysqli_real_escape_string`，您始终必须知道您正在使用的输入数据的类型。

因此，如果您使用准备好的语句，则必须为`mysqli_stmt_bind_param`函数指定变量的类型。

顾名思义，它的用途`mysqli_real_escape_string`是转义字符串中的特殊字符，因此它不会使整数变得安全。此函数的目的是防止破坏 SQL 语句中的字符串，以及它可能导致的数据库损坏。`mysqli_real_escape_string`正确使用时是一个有用的功能，尤其是与`sprintf`.

例子：

```
$string = "x' OR name LIKE '%John%";
$integer = '5 OR id != 0';

$query = sprintf( "SELECT id, email, pass, name FROM members WHERE email ='%s' AND id = %d", $mysqli->real_escape_string($string), $integer);

echo $query;
// SELECT id, email, pass, name FROM members WHERE email ='x\' OR name LIKE \'%John%' AND id = 5

$integer = '99999999999999999999';
$query = sprintf("SELECT id, email, pass, name FROM members WHERE email ='%s' AND id = %d", $mysqli->real_escape_string($string), $integer);

echo $query;
// SELECT id, email, pass, name FROM members WHERE email ='x\' OR name LIKE \'%John%' AND id = 2147483647 
```

* * *

## 回答 #19

> 赞同：226
> 
> 时间：2012-08-03T19:59:31.307

使用此 PHP 功能`mysql_escape_string()`，您可以快速获得良好的预防。

例如：

```
SELECT * FROM users WHERE name = '".mysql_escape_string($name_from_html_form)."' 
```

`mysql_escape_string`— 转义字符串以在 mysql_query 中使用

为了进一步预防，您可以在末尾添加...

```
wHERE 1=1   or  LIMIT 1 
```

最后你得到：

```
SELECT * FROM users WHERE name = '".mysql_escape_string($name_from_html_form)."' LIMIT 1 
```

* * *

## 回答 #20

> 赞同：186
> 
> 时间：2012-10-25T08:07:25.437

这个问题的简单替代方案可以通过在数据库本身中授予适当的权限来解决。例如：如果您使用的是 MySQL 数据库，则通过终端或提供的 UI 进入数据库，然后按照以下命令进行操作：

```
 GRANT SELECT, INSERT, DELETE ON database TO username@'localhost' IDENTIFIED BY 'password'; 
```

这将限制用户只能使用指定的查询。删除删除权限，因此数据永远不会从 PHP 页面触发的查询中删除。第二件事是刷新权限，以便 MySQL 刷新权限和更新。

```
FLUSH PRIVILEGES; 
```

有关[冲洗](https://dev.mysql.com/doc/refman/5.7/en/flush.html)的更多信息。

要查看用户的当前权限，请触发以下查询。

```
select * from mysql.user where User='username'; 
```

了解更多关于[GRANT](https://dev.mysql.com/doc/refman/5.7/en/grant.html)的信息。

* * *

## 回答 #21

> 赞同：182
> 
> 时间：2013-01-28T19:37:48.973

关于许多有用的答案，我希望为这个线程增加一些价值。

SQL 注入是一种可以通过用户输入（由用户填写然后在查询中使用的输入）来完成的攻击。SQL 注入模式是正确的查询语法，我们可以称之为：出于不良原因的不良查询，并且我们假设可能有一个坏人试图获取影响安全三原则（机密性）的秘密信息（绕过访问控制） 、完整性和可用性）。

现在，我们的重点是防止SQL注入攻击等安全威胁，问的问题（如何使用PHP防止SQL注入攻击），更现实一点，数据过滤或清除输入数据是在使用用户输入数据时的情况这样的查询，使用 PHP 或任何其他编程语言并非如此，或者更多人建议使用现代技术，例如准备好的语句或任何其他当前支持 SQL 注入预防的工具，是否认为这些工具不再可用？您如何保护您的应用程序？

我反对 SQL 注入的方法是：在将用户输入数据发送到数据库之前（在任何查询中使用它之前）清除用户输入数据。

**数据过滤（将不安全数据转换为安全数据）**

考虑到[PDO](http://en.wikipedia.org/wiki/PHP#History)和[MySQLi](http://en.wikipedia.org/wiki/MySQLi)不可用。如何保护您的应用程序？你强迫我使用它们吗？PHP 以外的其他语言呢？我更喜欢提供一般性的想法，因为它可以用于更广泛的边界，而不仅仅是特定的语言。

1.  SQL用户（限制用户权限）：最常见的SQL操作是（SELECT，UPDATE，INSERT），那么，为什么要给不需要的用户UPDATE权限呢？比如**登录和搜索页面**都只使用了SELECT，那么，为什么在这些页面中使用DB用户的权限很高呢？

**规则：不要为所有权限创建一个数据库用户。对于所有 SQL 操作，您可以创建您的方案（如（deluser、selectuser、updateuser）作为用户名以便于使用。**

参见[最小特权原则](http://en.wikipedia.org/wiki/Principle_of_least_privilege)。

2.  数据过滤：在构建任何查询用户输入之前，应该对其进行验证和过滤。对于程序员来说，为每个用户输入变量定义一些属性很重要： **数据类型、数据模式和数据长度**。必须使用精确规则精确验证 (x 和 y) 之间的数字字段，对于字符串（文本）字段：模式就是这种情况，例如，用户名必须只包含一些字符，让我们说[a-zA-Z0-9_-.]。长度在 (x 和 n) 之间变化，其中 x 和 n (整数，x <=n)。 **规则：创建精确的过滤器和验证规则对我来说是最佳实践。**

3.  使用其他工具：在这里，我也同意您的说法，即准备好的语句（参数化查询）和存储过程。这里的缺点是这些方法需要大多数用户不具备的高级技能。这里的基本思想是区分 SQL 查询和内部使用的数据。即使是不安全的数据也可以使用这两种方法，因为这里的用户输入数据不会向原始查询添加任何内容，例如 (any 或 x=x)。

有关更多信息，请阅读[OWASP SQL 注入预防备忘单](https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet)。

现在，如果你是高级用户，开始使用这个防御就可以了，但是，对于初学者来说，如果他们不能快速实现存储过程并准备好语句，那么最好尽可能过滤输入数据。

最后，让我们考虑一个用户在下面发送这个文本而不是输入他/她的用户名：

```
[1] UNION SELECT IF(SUBSTRING(Password,1,1)='2',BENCHMARK(100000,SHA1(1)),0) User,Password FROM mysql.user WHERE User = 'root' 
```

无需任何准备好的语句和存储过程即可尽早检查此输入，但为了安全起见，在用户数据过滤和验证之后开始使用它们。

最后一点是检测需要更多努力和复杂性的意外行为；不建议将其用于普通的 Web 应用程序。

上述用户输入中的意外行为是 SELECT、UNION、IF、SUBSTRING、BENCHMARK、SHA 和 root。一旦检测到这些词，就可以避免输入。

## 更新 1：

有网友评论说这个帖子没用，OK！以下是[OWASP.ORG 提供](https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet#Defense_Option_3:_Escaping_All_User_Supplied_Input)的内容：

> 主要防御：
> 
> 选项 #1：使用准备好的语句（参数化查询）
> 选项 #2：使用存储过程
> 选项 #3：转义所有用户提供的输入
> 
> 其他防御：
> 
> 同时执行：最小权限
> 同时执行：白名单输入验证

您可能知道，声明一篇文章应该有一个有效的论据支持，至少有一个参考！否则，将被视为攻击和恶意索赔！

## 更新 2：

来自 PHP 手册，[PHP：Prepared Statements - Manual](http://php.net/manual/en/mysqli.quickstart.prepared-statements.php)：

> 转义和 SQL 注入
> 
> 绑定变量将被服务器自动转义。服务器在执行之前将它们的转义值插入到语句模板的适当位置。必须向服务器提供绑定变量类型的提示，以创建适当的转换。有关详细信息，请参阅 mysqli_stmt_bind_param() 函数。
> 
> 服务器内的值的自动转义有时被认为是防止 SQL 注入的安全功能。如果输入值被正确转义，则可以使用非准备语句实现相同程度的安全性。

## 更新 3：

我创建了测试用例来了解 PDO 和 MySQLi 在使用准备好的语句时如何将查询发送到 MySQL 服务器：

**PDO：**

```
$user = "''1''"; // Malicious keyword
$sql = 'SELECT * FROM awa_user WHERE userame =:username';
$sth = $dbh->prepare($sql, array(PDO::ATTR_CURSOR => PDO::CURSOR_FWDONLY));
$sth->execute(array(':username' => $user)); 
```

**查询日志：**

> ```
>  189 Query SELECT * FROM awa_user WHERE userame ='\'\'1\'\''
>     189 Quit 
> ```

**MySQLi：**

```
$stmt = $mysqli->prepare("SELECT * FROM awa_user WHERE username =?")) {
$stmt->bind_param("s", $user);
$user = "''1''";
$stmt->execute(); 
```

**查询日志：**

> ```
>  188 Prepare   SELECT * FROM awa_user WHERE username =?
>     188 Execute   SELECT * FROM awa_user WHERE username ='\'\'1\'\''
>     188 Quit 
> ```

### 很明显，准备好的语句也在转义数据，仅此而已。

正如上述声明中也提到的，

> 服务器内的值的自动转义有时被认为是防止 SQL 注入的安全功能。如果输入值被正确转义，则使用非准备语句可以实现相同程度的安全性

因此，这证明了`intval()`在发送任何查询之前对整数值进行数据验证是一个好主意。此外，在发送查询之前阻止恶意用户数据是**一种正确有效的方法**。

请参阅此问题以获取更多详细信息：*[PDO 将原始查询发送到 MySQL 而 Mysqli 发送准备好的查询，两者都产生相同的结果](https://stackoverflow.com/questions/18026088/pdo-sends-raw-query-to-mysql-while-mysqli-sends-prepared-query-both-produce-the)*

参考：

1.  [SQL 注入备忘单](http://ferruh.mavituna.com/sql-injection-cheatsheet-oku/#UnionInjections)
2.  [SQL 注入](https://www.owasp.org/index.php/SQL_Injection)
3.  [信息安全](http://en.wikipedia.org/wiki/Information_security)
4.  [安全原则](http://www.dwheeler.com/secure-programs/Secure-Programs-HOWTO/security-principles.html)
5.  [数据验证](http://en.wikipedia.org/wiki/Data_validation)

* * *

## 回答 #22

> 赞同：178
> 
> 时间：2012-09-14T14:37:56.560

> **安全警告**：此答案不符合安全最佳实践。[转义不足以防止 SQL 注入](https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide)，请改用*准备好的语句*。使用下面概述的策略，风险自负。（另外，`mysql_real_escape_string()`在 PHP 7 中被删除。）
> 
> **不推荐使用的警告**：此时不推荐使用 mysql 扩展。我们建议使用*PDO 扩展*

我使用三种不同的方法来防止我的 Web 应用程序容易受到 SQL 注入的攻击。

1.  使用`mysql_real_escape_string()`, 这是[PHP](http://en.wikipedia.org/wiki/PHP)中的一个预定义函数，并且此代码将反斜杠添加到以下字符：`\x00`、`\n`、`\r`、`\`、`'`和. 将输入值作为参数传递，以最大限度地减少 SQL 注入的机会。`"``\x1a`
2.  最先进的方法是使用 PDO。

我希望这能帮到您。

考虑以下查询：

`$iId = mysql_real_escape_string("1 OR 1=1"); $sSql = "SELECT * FROM table WHERE id = $iId";`

mysql_real_escape_string() 不会在这里保护。如果您在查询中的变量周围使用单引号 (' ') 可以保护您免受这种情况的影响。下面是一个解决方案：

`$iId = (int) mysql_real_escape_string("1 OR 1=1"); $sSql = "SELECT * FROM table WHERE id = $iId";`

这个[问题](https://stackoverflow.com/questions/5741187/sql-injection-that-gets-around-mysql-real-escape-string)对此有一些很好的答案。

我建议，使用 PDO 是最好的选择。

**编辑：**

`mysql_real_escape_string()`自 PHP 5.5.0 起已弃用。使用 mysqli 或 PDO。

mysql_real_escape_string() 的替代方法是

```
string mysqli_real_escape_string ( mysqli $link , string $escapestr ) 
```

**例子：**

```
$iId = $mysqli->real_escape_string("1 OR 1=1");
$mysqli->query("SELECT * FROM table WHERE id = $iId"); 
```

* * *

## 回答 #23

> 赞同：172
> 
> 时间：2013-06-25T19:00:36.200

一种简单的方法是使用像[CodeIgniter](http://en.wikipedia.org/wiki/Codeigniter#CodeIgniter)或[Laravel](https://laravel.com/)这样的 PHP 框架，它们具有过滤和活动记录等内置功能，这样您就不必担心这些细微差别。

* * *

## 回答 #24

> 赞同：153
> 
> 时间：2013-04-04T08:15:30.653

**警告：此答案中描述的方法仅适用于非常特定的场景并且不安全，因为 SQL 注入攻击不仅依赖于能够注入`X=Y`.**

如果攻击者试图通过 PHP 的变量或 URL 的查询字符串侵入表单`$_GET`，如果它们不安全，您将能够捕获它们。

```
RewriteCond %{QUERY_STRING} ([0-9]+)=([0-9]+)
RewriteRule ^(.*) ^/track.php 
```

因为`1=1`, `2=2`, `1=2`, `2=1`, `1+1=2`, 等是攻击者对 SQL 数据库的常见问题。也许它也被许多黑客应用程序使用。

但是您必须小心，您不能从您的站点重写安全查询。上面的代码给了你一个提示，重写或重定向*（取决于你）*特定于黑客的动态查询字符串到一个页面中，该页面将存储攻击者的[IP 地址](http://en.wikipedia.org/wiki/IP_address)，甚至他们的 COOKIES、历史记录、浏览器或任何其他敏感信息信息，以便您以后可以通过禁止他们的帐户或联系当局来处理他们。

* * *

## 回答 #25

> 赞同：135
> 
> 时间：2014-03-20T00:17:35.683

一个好主意是使用像[Idiorm这样的](http://j4mie.github.io/idiormandparis/)[对象关系映射器](https://en.wikipedia.org/wiki/Object-relational_mapping)：

```
$user = ORM::for_table('user')
->where_equal('username', 'j4mie')
->find_one();

$user->first_name = 'Jamie';
$user->save();

$tweets = ORM::for_table('tweet')
    ->select('tweet.*')
    ->join('user', array(
        'user.id', '=', 'tweet.user_id'
    ))
    ->where_equal('user.username', 'j4mie')
    ->find_many();

foreach ($tweets as $tweet) {
    echo $tweet->text;
} 
```

它不仅可以避免 SQL 注入，还可以避免语法错误！它还支持具有方法链接的模型集合，以一次过滤或将操作应用于多个结果和多个连接。

* * *

## 回答 #26

> 赞同：131
> 
> 时间：2014-01-30T07:00:43.773

**PHP 和 MySQL**有很多答案，但这里是**PHP 和 Oracle**的代码，用于防止 SQL 注入以及定期使用 oci8 驱动程序：

```
$conn = oci_connect($username, $password, $connection_string);
$stmt = oci_parse($conn, 'UPDATE table SET field = :xx WHERE ID = 123');
oci_bind_by_name($stmt, ':xx', $fieldval);
oci_execute($stmt); 
```

* * *

## 回答 #27

> 赞同：127
> 
> 时间：2014-01-17T06:25:22.080

> **不推荐使用的警告：** 此答案的示例代码（如问题的示例代码）使用 PHP 的`MySQL`扩展，该扩展在 PHP 5.5.0 中已弃用，并在 PHP 7.0.0 中完全删除。
> 
> **安全警告**：此答案不符合安全最佳实践。[转义不足以防止 SQL 注入](https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide)，请改用*准备好的语句*。使用下面概述的策略，风险自负。（另外，`mysql_real_escape_string()`在 PHP 7 中被删除。）

使用[PDO](http://in3.php.net/pdo)和[MYSQLi](http://in3.php.net/mysqli)是防止 SQL 注入的好习惯，但如果你真的想使用 MySQL 函数和查询，最好使用

[mysql_real_escape_string](http://php.net/manual/en/function.mysql-real-escape-string.php)

```
$unsafe_variable = mysql_real_escape_string($_POST['user_input']); 
```

有更多的功能可以防止这种情况发生：比如识别 - 如果输入是字符串、数字、字符或数组，有很多内置函数可以检测到这一点。此外，最好使用这些函数来检查输入数据。

[is_string](http://in3.php.net/is_string)

```
$unsafe_variable = (is_string($_POST['user_input']) ? $_POST['user_input'] : ''); 
```

[is_numeric](http://in3.php.net/manual/en/function.is-numeric.php)

```
$unsafe_variable = (is_numeric($_POST['user_input']) ? $_POST['user_input'] : ''); 
```

使用这些函数检查输入数据要好得多`mysql_real_escape_string`。

* * *

## 回答 #28

> 赞同：90
> 
> 时间：2014-02-18T20:38:27.203

几年前我写过这个小函数：

```
function sqlvprintf($query, $args)
{
    global $DB_LINK;
    $ctr = 0;
    ensureConnection(); // Connect to database if not connected already.
    $values = array();
    foreach ($args as $value)
    {
        if (is_string($value))
        {
            $value = "'" . mysqli_real_escape_string($DB_LINK, $value) . "'";
        }
        else if (is_null($value))
        {
            $value = 'NULL';
        }
        else if (!is_int($value) && !is_float($value))
        {
            die('Only numeric, string, array and NULL arguments allowed in a query. Argument '.($ctr+1).' is not a basic type, it\'s type is '. gettype($value). '.');
        }
        $values[] = $value;
        $ctr++;
    }
    $query = preg_replace_callback(
        '/{(\\d+)}/', 
        function($match) use ($values)
        {
            if (isset($values[$match[1]]))
            {
                return $values[$match[1]];
            }
            else
            {
                return $match[0];
            }
        },
        $query
    );
    return $query;
}

function runEscapedQuery($preparedQuery /*, ...*/)
{
    $params = array_slice(func_get_args(), 1);
    $results = runQuery(sqlvprintf($preparedQuery, $params)); // Run query and fetch results.   
    return $results;
} 
```

这允许以单行 C#-ish String.Format 运行语句，例如：

```
runEscapedQuery("INSERT INTO Whatever (id, foo, bar) VALUES ({0}, {1}, {2})", $numericVar, $stringVar1, $stringVar2); 
```

考虑到变量类型，它会逃脱。如果您尝试参数化表、列名，它将失败，因为它将每个字符串都放在引号中，这是一种无效的语法。

安全更新：以前的`str_replace`版本允许通过将 {#} 令牌添加到用户数据中来进行注入。如果替换包含这些标记，则此`preg_replace_callback`版本不会导致问题。

# c# - 是否可以用 C# 编写将在 Excel 中运行的 ActiveX 控件？

> ID：60199
> 
> 赞同：2
> 
> 时间：2008-09-13T00:19:50.920
> 
> 标签：c#, .net, excel, activex

我一直在网上搜索一些示例代码，了解我们如何使用 .NET 编写自定义 ActiveX 控件以在 Excel 中使用，但到目前为止，我发现旧文章表明它不受支持。

我们正在构建的应用程序使用 Excel 作为报告编写器，因此我们在工作表中添加了一些自定义控件以提供更丰富的体验。从我目前所做的研究来看，一些 ActiveX 控件似乎只能托管在 IE 中，因此我需要确保所采取的任何方法都适用于作为主机的 Excel。

链接[http://www.codeproject.com/KB/miscctrl/exposingdotnetcontrols.aspx](http://www.codeproject.com/KB/miscctrl/exposingdotnetcontrols.aspx)提到以下内容：

**警告**：由于 .NET 的 Beta2 已放弃此支持，如果它会炸毁您的 PC 或烤猫，请不要怪我。

如果可以使用.NET 1.1，任何人都可以给我一个指示，如果可以的话，可以提供任何关于最佳实践的指针吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T18:24:35.550

Andrew Whitechapel 将托管控件描述为 Office 文档中的 ActiveX 控件。你可以在这里阅读他的文章：

> **[将托管控件用作 ActiveX 控件](http://blogs.msdn.com/andreww/archive/2008/11/24/using-managed-controls-as-activex-controls.aspx)**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-13T04:20:36.987

我以为你不走运，但确实发现了这个：

[http://dotnetslackers.com/articles/csharp/WritingAnActiveXControlInCSharp.aspx](http://dotnetslackers.com/articles/csharp/WritingAnActiveXControlInCSharp.aspx)

给我威利斯...但它可能正好适合你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T12:33:20.107

尽管这些文章似乎使用 IE 作为托管容器而不是 Excel，但可以在下面找到有关使用 C# 创建 ActiveX 控件的更多信息。

[http://www.ondotnet.com/pub/a/dotnet/2003/01/20/winformshosting.html](http://www.ondotnet.com/pub/a/dotnet/2003/01/20/winformshosting.html)

[http://www.codeproject.com/KB/miscctrl/exposingdotnetcontrols.aspx](http://www.codeproject.com/KB/miscctrl/exposingdotnetcontrols.aspx)

# database - 以单个十进制形式存储在数据库中的多种权限类型（角色）

> ID：60204
> 
> 赞同：9
> 
> 时间：2008-09-13T00:25:58.253
> 
> 标签：database, permissions, roles

我打算在这里问一个问题，关于我对某些用户/角色数据库表的设计是否可以接受，但经过一些研究，我遇到了这个问题：

[处理多种权限类型的最佳方法是什么？](/questions/1451/what-is-the-best-way-to-handle-multiple-permission-types)

这听起来像是一种创新方法，因此我将多个权限定义为单个小数（我假设为 int 数据类型），而不是多对多关系 users_to_roles 表。这意味着单个用户的所有权限都在一行中。在您阅读其他问题和答案之前，它可能没有意义

我无法解决这个问题。有人可以解释一下转换过程吗？这听起来“正确”，但我只是不知道如何在角色进入数据库之前将其转换为小数，以及当它从数据库中出来时如何转换回来。我正在使用 Java，但如果你把它去掉，那也很酷。

这是另一个问题被删除的机会的原始答案：

“就个人而言，我有时会使用标记的权限枚举。这样你就可以对枚举项使用 AND、OR、NOT 和 XOR 位运算。

```
[Flags]
public enum Permission
{
    VIEWUSERS = 1, // 2^0 // 0000 0001
    EDITUSERS = 2, // 2^1 // 0000 0010
    VIEWPRODUCTS = 4, // 2^2 // 0000 0100
    EDITPRODUCTS = 8, // 2^3 // 0000 1000
    VIEWCLIENTS = 16, // 2^4 // 0001 0000
    EDITCLIENTS = 32, // 2^5 // 0010 0000
    DELETECLIENTS = 64, // 2^6 // 0100 0000
} 
```

然后，您可以使用 AND 位运算符组合多个权限。

例如，如果用户可以查看和编辑用户，则操作的二进制结果是 0000 0011 转换为十进制是 3。然后您可以将一个用户的权限存储到数据库的单个列中（在我们的例子中它会是 3)。

在您的应用程序中，您只需要另一个按位运算 (OR) 来验证用户是否具有特定权限。”

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-13T00:58:29.343

您使用按位运算。伪代码将类似于：

```
bool HasPermission(User user, Permission permission) {
    return (user.Permission & permission) != 0;
}

void SetPermission(User user, Permission permission) {
    user.Permission |= permission;
}

void ClearPermission(User user, Permission permission) {
    user.Permission &= ~permission;
} 
```

权限是您帖子中定义的枚举类型，但无论它是什么类型都需要基于类似整数的类型。这同样适用于 User.Permission 字段。

如果这些运算符（&、|= 和 &=）对您没有意义，那么请阅读按位运算（按位与和按位或）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T00:32:47.860

实际上，这就是我们在我担任 DBA 的相当大的 Web 应用程序中确定权限的方式。

如果你打算做这样的事情，你会真正受益于拥有一个 [数字表](http://snippets.dzone.com/posts/show/1184)。它将使您的计算速度更快。

基本设置包括下表：

1.  组 - 用于处理多对多用户和安全点
2.  安全点 - 包含匿名授权的值和不属于单独组的经过身份验证的用户的值
3.  组安全点连接表
4.  一个特殊的 BitMask 数字表，其中包含 ^2 值的条目。因此，2 (2) 有一个条目，3 (2 和 1) 有两个条目。这使我们不必每次都计算值。

首先，我们确定用户是否登录。如果不是，我们返回安全点的匿名授权。

`EXISTS`接下来，我们通过简单的使用来确定用户是否是与安全点关联的任何组的成员`JOIN`。如果不是，我们将返回与经过身份验证的用户关联的值。我们系统上的大多数匿名和经过身份验证的默认值都设置为 1，因为我们要求您属于特定组。

> **注意：**如果匿名用户没有访问权限，界面会将他们扔到一个登录框，以允许他们登录并重试。

如果用户*是*一个或多个组的成员，那么我们从 BitMask 表中为为组定义的每个值选择不同的值。例如，如果您属于三个组，并且其中一个授权级别为 8，一个为 12，最后一个为 36，则我们对位掩码表的选择将分别返回 8、8 和 4，以及 4 和 32。通过执行 distinct 我们得到数字 4、8 和 32，它们正确位掩码为 101100。

该值作为用户授权级别返回并由网站处理。

有道理？

# python - Python中switch语句的替换？

> ID：60208
> 
> 赞同：1717
> 
> 时间：2008-09-13T00:36:30.847
> 
> 标签：python, switch-statement

我想在 Python 中编写一个函数，该函数根据输入索引的值返回不同的固定值。

在其他语言中，我会使用`switch`or`case`语句，但 Python 似乎没有`switch`语句。在这种情况下推荐的 Python 解决方案是什么？

* * *

## 回答 #1

> 赞同：1935
> 
> 时间：2008-09-13T00:38:24.353

下面的原始答案是在 2008 年编写的。从那时起，Python 3.10 (2021) 引入了[`match`-`case`](https://www.python.org/dev/peps/pep-0634/)语句，它为 Python 提供了“开关”的一流实现。例如：

```
def f(x):
    match x:
        case 'a':
            return 1
        case 'b':
            return 2
        case _:        
            return 0   # 0 is the default case if x is not found 
```

`match`-`case`语句比这个简单的例子要强大得多。

* * *

您可以使用字典：

```
def f(x):
    return {
        'a': 1,
        'b': 2,
    }[x] 
```

* * *

## 回答 #2

> 赞同：1540
> 
> 时间：2008-09-19T15:45:15.207

如果你想要默认值，你可以使用字典[`get(key[, default])`](https://docs.python.org/3/library/stdtypes.html#dict.get)函数：

```
def f(x):
    return {
        'a': 1,
        'b': 2
    }.get(x, 9)    # 9 will be returned default if x is not found 
```

* * *

## 回答 #3

> 赞同：470
> 
> 时间：2008-09-13T00:41:46.123

我一直喜欢这样做

```
result = {
  'a': lambda x: x * 5,
  'b': lambda x: x + 7,
  'c': lambda x: x - 2
}[value](x) 
```

[从这里](http://blog.simonwillison.net/post/57956755106/switch)

* * *

## 回答 #4

> 赞同：441
> 
> 时间：2008-09-13T01:10:58.597

除了字典方法（我真的很喜欢，顺便说一句），您还可以使用--`if`来获取//功能`elif`：`else``switch``case``default`

```
if x == 'a':
    # Do the thing
elif x == 'b':
    # Do the other thing
if x in 'bc':
    # Fall-through by not using elif, but now the default case includes case 'a'!
elif x in 'xyz':
    # Do yet another thing
else:
    # Do the default 
```

这当然与 switch/case 不同——你不能像离开`break`语句那样容易地失败，但你可以进行更复杂的测试。它的格式比一系列嵌套`if`的 s 更好，尽管在功能上它更接近。

* * *

## 回答 #5

> 赞同：320
> 
> 时间：2015-06-17T02:25:10.860

**蟒蛇> = 3.10**

哇，Python 3.10+ 现在有了类似的[`match`/`case`](https://docs.python.org/3.10/whatsnew/3.10.html#pep-634-structural-pattern-matching)语法`switch/case`！

[PEP 634 -- 结构模式匹配](https://www.python.org/dev/peps/pep-0634/)

**选择的特征`match/case`**

1 - 匹配值：

匹配值类似于`switch/case`另一种语言中的简单：

```
match something:
    case 1 | 2 | 3:
        # Match 1-3. 
```

2 - 匹配结构模式：

```
match something:
    case str() | bytes():  
        # Match a string like object.
    case [str(), int()]:
        # Match a `str` and an `int` sequence 
        # (`list` or a `tuple` but not a `set` or an iterator). 
    case [_, _]:
        # Match a sequence of 2 variables.
        # To prevent a common mistake, sequence patterns don’t match strings.
    case {"bandwidth": 100, "latency": 300}:
        # Match this dict. Extra keys are ignored. 
```

3 - 捕获变量

解析一个对象；将其保存为变量：

```
match something:
    case [name, count]
        # Match a sequence of any two objects and parse them into the two variables.
    case [x, y, *rest]:
        # Match a sequence of two or more objects, 
        # binding object #3 and on into the rest variable.
    case bytes() | str() as text:
        # Match any string like object and save it to the text variable. 
```

在解析可能以多种不同模式之一出现的数据（例如 JSON 或 HTML）时，捕获变量可能很有用。

捕获变量是一项功能。但这也意味着您`COLOR.RED`只需要使用点分常量（例如：）。否则，该常量将被视为捕获变量并被覆盖。

[更多示例用法](https://docs.python.org/3.10/tutorial/controlflow.html#match-statements)：

```
match something:
    case 0 | 1 | 2:
        # Matches 0, 1 or 2 (value).
        print("Small number")
    case [] | [_]:
        # Matches an empty or single value sequence (structure).
        # Matches lists and tuples but not sets.
        print("A short sequence")
    case str() | bytes():
        # Something of `str` or `bytes` type (data type).
        print("Something string-like")
    case _:
        # Anything not matched by the above.
        print("Something else") 
```

* * *

**Python <= 3.9**

我最喜欢的用于 switch/case 的 Python 配方是：

```
choices = {'a': 1, 'b': 2}
result = choices.get(key, 'default') 
```

简单的场景简短而简单。

与 11 多行 C 代码相比：

```
// C Language version of a simple 'switch/case'.
switch( key ) 
{
    case 'a' :
        result = 1;
        break;
    case 'b' :
        result = 2;
        break;
    default :
        result = -1;
} 
```

您甚至可以使用元组分配多个变量：

```
choices = {'a': (1, 2, 3), 'b': (4, 5, 6)}
(result1, result2, result3) = choices.get(key, ('default1', 'default2', 'default3')) 
```

* * *

## 回答 #6

> 赞同：111
> 
> 时间：2011-07-07T06:09:09.443

```
class switch(object):
    value = None
    def __new__(class_, value):
        class_.value = value
        return True

def case(*args):
    return any((arg == switch.value for arg in args)) 
```

用法：

```
while switch(n):
    if case(0):
        print "You typed zero."
        break
    if case(1, 4, 9):
        print "n is a perfect square."
        break
    if case(2):
        print "n is an even number."
    if case(2, 3, 5, 7):
        print "n is a prime number."
        break
    if case(6, 8):
        print "n is an even number."
        break
    print "Only single-digit numbers are allowed."
    break 
```

测试：

```
n = 2
#Result:
#n is an even number.
#n is a prime number.
n = 11
#Result:
#Only single-digit numbers are allowed. 
```

* * *

## 回答 #7

> 赞同：65
> 
> 时间：2011-07-07T06:12:47.830

我最喜欢的是一个非常好的[食谱](http://code.activestate.com/recipes/410692/)。这是我见过的最接近实际 switch case 语句的语句，尤其是在特性方面。

```
class switch(object):
    def __init__(self, value):
        self.value = value
        self.fall = False

    def __iter__(self):
        """Return the match method once, then stop"""
        yield self.match
        raise StopIteration

    def match(self, *args):
        """Indicate whether or not to enter a case suite"""
        if self.fall or not args:
            return True
        elif self.value in args: # changed for v1.5, see below
            self.fall = True
            return True
        else:
            return False 
```

这是一个例子：

```
# The following example is pretty much the exact use-case of a dictionary,
# but is included for its simplicity. Note that you can include statements
# in each suite.
v = 'ten'
for case in switch(v):
    if case('one'):
        print 1
        break
    if case('two'):
        print 2
        break
    if case('ten'):
        print 10
        break
    if case('eleven'):
        print 11
        break
    if case(): # default, could also just omit condition or 'if True'
        print "something else!"
        # No need to break here, it'll stop anyway

# break is used here to look as much like the real thing as possible, but
# elif is generally just as good and more concise.

# Empty suites are considered syntax errors, so intentional fall-throughs
# should contain 'pass'
c = 'z'
for case in switch(c):
    if case('a'): pass # only necessary if the rest of the suite is empty
    if case('b'): pass
    # ...
    if case('y'): pass
    if case('z'):
        print "c is lowercase!"
        break
    if case('A'): pass
    # ...
    if case('Z'):
        print "c is uppercase!"
        break
    if case(): # default
        print "I dunno what c was!"

# As suggested by Pierre Quentel, you can even expand upon the
# functionality of the classic 'case' statement by matching multiple
# cases in a single shot. This greatly benefits operations such as the
# uppercase/lowercase example above:
import string
c = 'A'
for case in switch(c):
    if case(*string.lowercase): # note the * for unpacking as arguments
        print "c is lowercase!"
        break
    if case(*string.uppercase):
        print "c is uppercase!"
        break
    if case('!', '?', '.'): # normal argument passing style also applies
        print "c is a sentence terminator!"
        break
    if case(): # default
        print "I dunno what c was!" 
```

一些评论表明使用`with foo as case`而不是`for case in foo`可能更清洁的上下文管理器解决方案，并且对于大型 switch 语句，线性而不是二次行为可能是一个不错的选择。这个带有 for 循环的答案的部分价值是能够有突破和失败，如果我们愿意稍微使用我们选择的关键字，我们也可以在上下文管理器中得到它：

```
class Switch:
    def __init__(self, value):
        self.value = value
        self._entered = False
        self._broken = False
        self._prev = None

    def __enter__(self):
        return self

    def __exit__(self, type, value, traceback):
        return False # Allows a traceback to occur

    def __call__(self, *values):
        if self._broken:
            return False

        if not self._entered:
            if values and self.value not in values:
                return False
            self._entered, self._prev = True, values
            return True

        if self._prev is None:
            self._prev = values
            return True

        if self._prev != values:
            self._broken = True
            return False

        if self._prev == values:
            self._prev = None
            return False

    @property
    def default(self):
        return self() 
```

这是一个例子：

```
# Prints 'bar' then 'baz'.
with Switch(2) as case:
    while case(0):
        print('foo')
    while case(1, 2, 3):
        print('bar')
    while case(4, 5):
        print('baz')
        break
    while case.default:
        print('default')
        break 
```

* * *

## 回答 #8

> 赞同：64
> 
> 时间：2015-05-03T09:05:43.523

```
class Switch:
    def __init__(self, value):
        self.value = value

    def __enter__(self):
        return self

    def __exit__(self, type, value, traceback):
        return False # Allows a traceback to occur

    def __call__(self, *values):
        return self.value in values

from datetime import datetime

with Switch(datetime.today().weekday()) as case:
    if case(0):
        # Basic usage of switch
        print("I hate mondays so much.")
        # Note there is no break needed here
    elif case(1,2):
        # This switch also supports multiple conditions (in one line)
        print("When is the weekend going to be here?")
    elif case(3,4):
        print("The weekend is near.")
    else:
        # Default would occur here
        print("Let's go have fun!") # Didn't use case for example purposes 
```

* * *

## 回答 #9

> 赞同：50
> 
> 时间：2008-09-13T01:26:26.827

我从 Twisted Python 代码中学到了一种模式。

```
class SMTP:
    def lookupMethod(self, command):
        return getattr(self, 'do_' + command.upper(), None)
    def do_HELO(self, rest):
        return 'Howdy ' + rest
    def do_QUIT(self, rest):
        return 'Bye'

SMTP().lookupMethod('HELO')('foo.bar.com') # => 'Howdy foo.bar.com'
SMTP().lookupMethod('QUIT')('') # => 'Bye' 
```

您可以在需要发送令牌并执行扩展代码的任何时候使用它。在状态机中，您将拥有`state_`方法，并在`self.state`. 可以通过从基类继承并定义自己的`do_`方法来干净地扩展此开关。很多时候你甚至`do_`在基类中都没有方法。

*编辑：究竟是如何使用的*

在 SMTP 的情况下，您将收到`HELO`来自网络的信息。相关代码（来自`twisted/mail/smtp.py`，针对我们的案例进行了修改）如下所示

```
class SMTP:
    # ...

    def do_UNKNOWN(self, rest):
        raise NotImplementedError, 'received unknown command'

    def state_COMMAND(self, line):
        line = line.strip()
        parts = line.split(None, 1)
        if parts:
            method = self.lookupMethod(parts[0]) or self.do_UNKNOWN
            if len(parts) == 2:
                return method(parts[1])
            else:
                return method('')
        else:
            raise SyntaxError, 'bad syntax'

SMTP().state_COMMAND('   HELO   foo.bar.com  ') # => Howdy foo.bar.com 
```

您将收到`' HELO foo.bar.com '`（或者您可能会收到`'QUIT'`或`'RCPT TO: foo'`）。这被标记为`parts`as `['HELO', 'foo.bar.com']`。实际的方法查找名称取自`parts[0]`.

（原来的方法也叫`state_COMMAND`，因为它使用相同的模式来实现状态机，即`getattr(self, 'state_' + self.mode)`）

* * *

## 回答 #10

> 赞同：30
> 
> 时间：2017-08-14T22:19:38.337

我只是要把我的两分钱放在这里。Python 中没有 case/switch 语句的原因是因为 Python 遵循“只有一种正确的方法可以做某事”的原则。所以很明显，你可以想出各种方法来重新创建 switch/case 功能，但 Pythonic 的实现方式是 if/elif 构造。IE，

```
if something:
    return "first thing"
elif somethingelse:
    return "second thing"
elif yetanotherthing:
    return "third thing"
else:
    return "default thing" 
```

我只是觉得[PEP 8](https://pep8.org/)值得在这里点头。Python 的一大优点是它的简洁和优雅。这在很大程度上源于 PEP 8 中规定的原则，包括“做某事只有一种正确的方法”。

* * *

## 回答 #11

> 赞同：29
> 
> 时间：2010-09-30T08:31:55.040

假设您不想只返回一个值，而是想使用更改对象上某些内容的方法。使用此处所述的方法将是：

```
result = {
  'a': obj.increment(x),
  'b': obj.decrement(x)
}.get(value, obj.default(x)) 
```

在这里，Python 评估字典中的所有方法。

因此，即使您的值是 'a'，该对象也会以 x 递增**和**递减。

解决方案：

```
func, args = {
  'a' : (obj.increment, (x,)),
  'b' : (obj.decrement, (x,)),
}.get(value, (obj.default, (x,)))

result = func(*args) 
```

因此，您会得到一个包含函数及其参数的列表。这样，只有函数指针和参数列表被返回，*而不是被*评估。'result' 然后评估返回的函数调用。

* * *

## 回答 #12

> 赞同：25
> 
> 时间：2018-02-17T21:54:47.367

运行函数的解决方案：

```
result = {
    'case1':     foo1, 
    'case2':     foo2,
    'case3':     foo3,
}.get(option)(parameters_optional) 
```

其中 foo1()、foo2() 和 foo3() 是函数

**示例 1**（带参数）：

```
option = number['type']
result = {
    'number':     value_of_int,  # result = value_of_int(number['value'])
    'text':       value_of_text, # result = value_of_text(number['value'])
    'binary':     value_of_bin,  # result = value_of_bin(number['value'])
}.get(option)(value['value']) 
```

**示例 2**（无参数）：

```
option = number['type']
result = {
    'number':     func_for_number, # result = func_for_number()
    'text':       func_for_text,   # result = func_for_text()
    'binary':     func_for_bin,    # result = func_for_bin()
}.get(option)() 
```

* * *

## 回答 #13

> 赞同：21
> 
> 时间：2012-04-22T21:43:03.307

如果您有一个复杂的案例块，您可以考虑使用函数字典查找表...

如果您之前没有这样做过，最好进入调试器并准确查看字典如何查找每个函数。

注意：不要*在*案例/字典查找中使用“()”，否则它会在创建字典/案例块时调用您的每个函数。请记住这一点，因为您只想使用哈希样式查找调用每个函数一次。

```
def first_case():
    print "first"

def second_case():
    print "second"

def third_case():
    print "third"

mycase = {
'first': first_case, #do not use ()
'second': second_case, #do not use ()
'third': third_case #do not use ()
}
myfunc = mycase['first']
myfunc() 
```

* * *

## 回答 #14

> 赞同：20
> 
> 时间：2010-12-06T15:08:12.703

如果您正在搜索额外语句，作为“开关”，我构建了一个扩展 Python 的 Python 模块。它被称为[ESPY](https://web.archive.org/web/20111103124355/http://elp.chronocv.fr/articles.php?lng=en&pg=19)作为“Python 的增强结构”，它适用于 Python 2.x 和 Python 3.x。

例如，在这种情况下，可以通过以下代码执行 switch 语句：

```
macro switch(arg1):
    while True:
        cont=False
        val=%arg1%
        socket case(arg2):
            if val==%arg2% or cont:
                cont=True
                socket
        socket else:
            socket
        break 
```

可以这样使用：

```
a=3
switch(a):
    case(0):
        print("Zero")
    case(1):
        print("Smaller than 2"):
        break
    else:
        print ("greater than 1") 
```

所以 espy 在 Python 中将其翻译为：

```
a=3
while True:
    cont=False
    if a==0 or cont:
        cont=True
        print ("Zero")
    if a==1 or cont:
        cont=True
        print ("Smaller than 2")
        break
    print ("greater than 1")
    break 
```

* * *

## 回答 #15

> 赞同：19
> 
> 时间：2008-09-19T15:37:15.053

扩展“dict as switch”的想法。如果您想为您的开关使用默认值：

```
def f(x):
    try:
        return {
            'a': 1,
            'b': 2,
        }[x]
    except KeyError:
        return 'default' 
```

* * *

## 回答 #16

> 赞同：18
> 
> 时间：2018-04-10T06:13:39.750

这里的大多数答案都很老了，尤其是被接受的答案，所以似乎值得更新。

首先，官方[Python 常见问题解答](https://docs.python.org/3/faq/design.html#why-isn-t-there-a-switch-or-case-statement-in-python)涵盖了这一点，并推荐了`elif`用于简单情况的链以及`dict`用于更大或更复杂情况的链。它还`visit_`针对某些情况提出了一组方法（许多服务器框架使用的一种风格）：

```
def dispatch(self, value):
    method_name = 'visit_' + str(value)
    method = getattr(self, method_name)
    method() 
```

常见问题解答还提到了[PEP 275](https://www.python.org/dev/peps/pep-0275/)，它是为了获得有关添加 C 样式 switch 语句的官方一次性决定而编写的。但是那个 PEP 实际上被推迟到 Python 3，它只是作为一个单独的提案被正式拒绝，[PEP 3103](https://www.python.org/dev/peps/pep-3103/)。答案当然是否定的——但如果您对原因或历史感兴趣，这两个 PEP 会提供指向其他信息的链接。

* * *

多次出现的一件事（并且可以在 PEP 275 中看到，尽管它被作为实际建议删掉了）是，如果你真的被 8 行代码处理 4 个案例所困扰，而 6你在 C 或 Bash 中的行，你总是可以这样写：

```
if x == 1: print('first')
elif x == 2: print('second')
elif x == 3: print('third')
else: print('did not place') 
```

PEP 8 并不完全鼓励这样做，但它是可读的并且不是太单调。

* * *

自从 PEP 3103 被拒绝后的十多年里，C 风格的 case 语句的问题，甚至是 Go 中稍微强大的版本，都被认为已经死了；每当有人在 python-ideas 或 -dev 上提出它时，他们都会参考旧的决定。

然而，完全 ML 风格的模式匹配的想法每隔几年就会出现一次，尤其是在 Swift 和 Rust 等语言已经采用它之后。问题在于，如果没有代数数据类型，就很难从模式匹配中获得很多用途。虽然 Guido 对这个想法表示同情，但没有人提出一个非常适合 Python 的建议。（您可以阅读[我 2014 年的稻草人](http://stupidpythonideas.blogspot.com/2014/08/a-pattern-matching-case-statement-for.html)作为示例。）这可能会随着`dataclass`3.7 和一些零星的提议而改变，以更强大地`enum`处理 sum 类型，或者针对不同类型的语句本地绑定（如[PEP 3150](https://www.python.org/dev/peps/pep-3150/)或目前正在讨论的一组提案-ideas）。但到目前为止，还没有。

偶尔也有关于 Perl 6 样式匹配的建议，这基本上是从`elif`正则表达式到单调度类型切换的所有内容的混搭。

* * *

## 回答 #17

> 赞同：17
> 
> 时间：2015-01-02T18:01:25.527

我发现了一个常见的开关结构：

```
switch ...parameter...
case p1: v1; break;
case p2: v2; break;
default: v3; 
```

可以用 Python 表示如下：

```
(lambda x: v1 if p1(x) else v2 if p2(x) else v3) 
```

或以更清晰的方式格式化：

```
(lambda x:
     v1 if p1(x) else
     v2 if p2(x) else
     v3) 
```

Python 版本不是一个语句，而是一个表达式，它的计算结果是一个值。

* * *

## 回答 #18

> 赞同：15
> 
> 时间：2010-06-28T01:32:33.703

我使用的解决方案：

此处发布的 2 个解决方案的组合，相对易于阅读并支持默认设置。

```
result = {
  'a': lambda x: x * 5,
  'b': lambda x: x + 7,
  'c': lambda x: x - 2
}.get(whatToUse, lambda x: x - 22)(value) 
```

在哪里

```
.get('c', lambda x: x - 22)(23) 
```

在字典中查找`"lambda x: x - 2"`并使用它`x=23`

```
.get('xxx', lambda x: x - 22)(44) 
```

在 dict 中找不到它并使用默认值`"lambda x: x - 22"`with `x=44`。

* * *

## 回答 #19

> 赞同：13
> 
> 时间：2013-10-12T15:04:01.653

我在 Google 搜索的任何地方都没有找到我正在寻找的简单答案。但我还是想通了。这真的很简单。决定发布它，也许可以防止在别人的头上少一些划痕。关键是简单的“in”和元组。下面是带有贯穿的 switch 语句行为，包括 RANDOM 贯穿。

```
l = ['Dog', 'Cat', 'Bird', 'Bigfoot',
     'Dragonfly', 'Snake', 'Bat', 'Loch Ness Monster']

for x in l:
    if x in ('Dog', 'Cat'):
        x += " has four legs"
    elif x in ('Bat', 'Bird', 'Dragonfly'):
        x += " has wings."
    elif x in ('Snake',):
        x += " has a forked tongue."
    else:
        x += " is a big mystery by default."
    print(x)

print()

for x in range(10):
    if x in (0, 1):
        x = "Values 0 and 1 caught here."
    elif x in (2,):
        x = "Value 2 caught here."
    elif x in (3, 7, 8):
        x = "Values 3, 7, 8 caught here."
    elif x in (4, 6):
        x = "Values 4 and 6 caught here"
    else:
        x = "Values 5 and 9 caught in default."
    print(x) 
```

提供：

```
Dog has four legs
Cat has four legs
Bird has wings.
Bigfoot is a big mystery by default.
Dragonfly has wings.
Snake has a forked tongue.
Bat has wings.
Loch Ness Monster is a big mystery by default.

Values 0 and 1 caught here.
Values 0 and 1 caught here.
Value 2 caught here.
Values 3, 7, 8 caught here.
Values 4 and 6 caught here
Values 5 and 9 caught in default.
Values 4 and 6 caught here
Values 3, 7, 8 caught here.
Values 3, 7, 8 caught here.
Values 5 and 9 caught in default. 
```

* * *

## 回答 #20

> 赞同：13
> 
> 时间：2019-02-06T08:49:31.883

您可以使用分派的字典：

```
#!/usr/bin/env python

def case1():
    print("This is case 1")

def case2():
    print("This is case 2")

def case3():
    print("This is case 3")

token_dict = {
    "case1" : case1,
    "case2" : case2,
    "case3" : case3,
}

def main():
    cases = ("case1", "case3", "case2", "case1")
    for case in cases:
        token_dict[case]()

if __name__ == '__main__':
    main() 
```

输出：

```
This is case 1
This is case 3
This is case 2
This is case 1 
```

* * *

## 回答 #21

> 赞同：12
> 
> 时间：2015-08-13T17:40:47.160

```
# simple case alternative

some_value = 5.0

# this while loop block simulates a case block

# case
while True:

    # case 1
    if some_value > 5:
        print ('Greater than five')
        break

    # case 2
    if some_value == 5:
        print ('Equal to five')
        break

    # else case 3
    print ( 'Must be less than 5')
    break 
```

* * *

## 回答 #22

> 赞同：11
> 
> 时间：2018-09-28T17:11:33.603

```
def f(x):
    dictionary = {'a':1, 'b':2, 'c':3}
    return dictionary.get(x,'Not Found') 
##Returns the value for the letter x;returns 'Not Found' if x isn't a key in the dictionary 
```

* * *

## 回答 #23

> 赞同：10
> 
> 时间：2017-06-14T12:39:34.030

阅读接受的答案后，我很困惑，但这一切都清楚了：

```
def numbers_to_strings(argument):
    switcher = {
        0: "zero",
        1: "one",
        2: "two",
    }
    return switcher.get(argument, "nothing") 
```

此代码类似于：

```
function(argument){
    switch(argument) {
        case 0:
            return "zero";
        case 1:
            return "one";
        case 2:
            return "two";
        default:
            return "nothing";
    }
} 
```

检查[源](https://www.pydanny.com/why-doesnt-python-have-switch-case.html)以获取有关字典映射到函数的更多信息。

* * *

## 回答 #24

> 赞同：9
> 
> 时间：2014-11-30T10:12:36.020

我喜欢[马克比斯的回答](https://stackoverflow.com/a/60215/1766716)

由于`x`变量必须使用两次，我将 lambda 函数修改为无参数。

我必须与 `results[value](value)`

```
In [2]: result = {
    ...:   'a': lambda x: 'A',
    ...:   'b': lambda x: 'B',
    ...:   'c': lambda x: 'C'
    ...: }
    ...: result['a']('a')
    ...: 
Out[2]: 'A'

In [3]: result = {
    ...:   'a': lambda : 'A',
    ...:   'b': lambda : 'B',
    ...:   'c': lambda : 'C',
    ...:   None: lambda : 'Nothing else matters'

    ...: }
    ...: result['a']()
    ...: 
Out[3]: 'A' 
```

**编辑：**我注意到我可以将`None`类型与字典一起使用。所以这会效仿`switch ; case else`

* * *

## 回答 #25

> 赞同：8
> 
> 时间：2012-11-05T20:05:12.600

```
def f(x):
     return 1 if x == 'a' else\
            2 if x in 'bcd' else\
            0 #default 
```

简短易读，具有默认值并支持条件和返回值中的表达式。

但是，它的效率低于使用字典的解决方案。例如，Python 在返回默认值之前必须扫描所有条件。

* * *

## 回答 #26

> 赞同：8
> 
> 时间：2018-02-05T01:54:06.347

简单，未经测试；每个条件都被独立评估：没有失败，但所有情况都被评估（尽管要打开的表达式只评估一次），除非有一个 break 语句。例如，

```
for case in [expression]:
    if case == 1:
        print(end='Was 1\. ')

    if case == 2:
        print(end='Was 2\. ')
        break

    if case in (1, 2):
        print(end='Was 1 or 2\. ')

    print(end='Was something. ') 
```

打印`Was 1\. Was 1 or 2\. Was something.` ^(（该死！为什么我不能在内联代码块中包含尾随空格？）)如果`expression`评估为`1`，`Was 2.`如果`expression`评估为`2`，或者`Was something.`如果`expression`评估为其他内容。

* * *

## 回答 #27

> 赞同：7
> 
> 时间：2018-06-06T16:45:58.170

我倾向于使用的也使用字典的解决方案是：

```
def decision_time( key, *args, **kwargs):
    def action1()
        """This function is a closure - and has access to all the arguments"""
        pass
    def action2()
        """This function is a closure - and has access to all the arguments"""
        pass
    def action3()
        """This function is a closure - and has access to all the arguments"""
        pass

   return {1:action1, 2:action2, 3:action3}.get(key,default)() 
```

这样做的好处是它不会每次都尝试评估函数，您只需确保外部函数获取内部函数所需的所有信息。

* * *

## 回答 #28

> 赞同：7
> 
> 时间：2018-08-30T22:34:49.640

到目前为止，已经有很多答案说，“我们在 Python 中没有开关，就这样做吧”。但是，我想指出 switch 语句本身是一个容易被滥用的结构，在大多数情况下可以而且应该避免，因为它们促进了惰性编程。一个例子：

```
def ToUpper(lcChar):
    if (lcChar == 'a' or lcChar == 'A'):
        return 'A'
    elif (lcChar == 'b' or lcChar == 'B'):
        return 'B'
    ...
    elif (lcChar == 'z' or lcChar == 'Z'):
        return 'Z'
    else:
        return None        # or something 
```

现在，您*可以*使用 switch 语句（如果 Python 提供一个）来执行此操作，但您会浪费您的时间，因为有些方法可以很好地执行此操作。或者，你有一些不太明显的东西：

```
def ConvertToReason(code):
    if (code == 200):
        return 'Okay'
    elif (code == 400):
        return 'Bad Request'
    elif (code == 404):
        return 'Not Found'
    else:
        return None 
```

然而，这种操作可以而且应该用字典来处理，因为它会更快、更简单、更不容易出错并且更紧凑。

而switch语句的绝大多数“用例”都属于这两种情况之一；如果您已经彻底考虑过您的问题，那么几乎没有理由使用它。

所以，与其问“我如何在 Python 中切换？”，或许我们应该问，“我为什么要在 Python 中切换？” 因为这通常是更有趣的问题，并且经常会暴露您正在构建的任何设计中的缺陷。

现在，这并不是说也不应该使用开关。状态机、词法分析器、解析器和自动机都在某种程度上使用它们，一般来说，当您从对称输入开始并转到不对称输出时，它们会很有用；您只需要确保不要将开关用作锤子，因为您会在代码中看到一堆钉子。

* * *

## 回答 #29

> 赞同：6
> 
> 时间：2013-07-25T18:23:33.470

定义：

```
def switch1(value, options):
  if value in options:
    options[value]() 
```

允许您使用相当简单的语法，将案例捆绑到地图中：

```
def sample1(x):
  local = 'betty'
  switch1(x, {
    'a': lambda: print("hello"),
    'b': lambda: (
      print("goodbye," + local),
      print("!")),
    }) 
```

我一直试图以一种可以让我摆脱“lambda：”的方式重新定义 switch，但最终放弃了。调整定义：

```
def switch(value, *maps):
  options = {}
  for m in maps:
    options.update(m)
  if value in options:
    options[value]()
  elif None in options:
    options[None]() 
```

允许我将多个案例映射到相同的代码，并提供默认选项：

```
def sample(x):
  switch(x, {
    _: lambda: print("other") 
    for _ in 'cdef'
    }, {
    'a': lambda: print("hello"),
    'b': lambda: (
      print("goodbye,"),
      print("!")),
    None: lambda: print("I dunno")
    }) 
```

每个重复的案例都必须在自己的字典中；switch() 在查找值之前合并字典。它仍然比我想要的更难看，但它具有在表达式上使用散列查找的基本效率，而不是遍历所有键的循环。

* * *

## 回答 #30

> 赞同：6
> 
> 时间：2016-03-18T08:01:35.393

我认为最好的方法是**使用 Python 语言习语来保持您的代码可测试**。如之前的答案所示，我使用字典来**利用 python 结构和语言**，并以不同的方法隔离“案例”代码。下面有一个类，但您可以直接使用模块、全局变量和函数。该类具有**可以使用隔离测试的**方法。

根据您的需要，您也可以使用静态方法和属性。

```
class ChoiceManager:

    def __init__(self):
        self.__choice_table = \
        {
            "CHOICE1" : self.my_func1,
            "CHOICE2" : self.my_func2,
        }

    def my_func1(self, data):
        pass

    def my_func2(self, data):
        pass

    def process(self, case, data):
        return self.__choice_table[case](data)

ChoiceManager().process("CHOICE1", my_data) 
```

也可以使用类作为“__choice_table”**的键来利用此方法。**通过这种方式，您可以避免*isinstance 滥用*并保持所有内容的清洁和可测试。

假设您必须处理来自网络或您的 MQ 的大量消息或数据包。每个数据包都有自己的结构和管理代码（以通用方式）。

使用上面的代码可以做这样的事情：

```
class PacketManager:

    def __init__(self):
        self.__choice_table = \
        {
            ControlMessage : self.my_func1,
            DiagnosticMessage : self.my_func2,
        }

    def my_func1(self, data):
        # process the control message here
        pass

    def my_func2(self, data):
        # process the diagnostic message here
        pass

    def process(self, pkt):
        return self.__choice_table[pkt.__class__](pkt)

pkt = GetMyPacketFromNet()
PacketManager().process(pkt)

# isolated test or isolated usage example
def test_control_packet():
    p = ControlMessage()
    PacketManager().my_func1(p) 
```

所以**复杂性并没有散布在代码流中，而是呈现在代码结构**中。

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2017-04-21T07:17:38.997

扩展[Greg Hewgill 的答案](https://stackoverflow.com/a/60211/3106539)- 我们可以使用装饰器封装字典解决方案：

```
def case(callable):
    """switch-case decorator"""
    class case_class(object):
        def __init__(self, *args, **kwargs):
            self.args = args
            self.kwargs = kwargs

        def do_call(self):
            return callable(*self.args, **self.kwargs)

return case_class

def switch(key, cases, default=None):
    """switch-statement"""
    ret = None
    try:
        ret = case[key].do_call()
    except KeyError:
        if default:
            ret = default.do_call()
    finally:
        return ret 
```

然后可以与`@case`-decorator一起使用

```
@case
def case_1(arg1):
    print 'case_1: ', arg1

@case
def case_2(arg1, arg2):
    print 'case_2'
    return arg1, arg2

@case
def default_case(arg1, arg2, arg3):
    print 'default_case: ', arg1, arg2, arg3

ret = switch(somearg, {
    1: case_1('somestring'),
    2: case_2(13, 42)
}, default_case(123, 'astring', 3.14))

print ret 
```

好消息是这已经在[NeoPySwitch](https://pypi.python.org/pypi/NeoPySwitch/0.2.0)模块中完成了。只需使用 pip 安装：

```
pip install NeoPySwitch 
```

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2016-05-25T22:56:30.197

如果您不担心在案例套件中丢失语法高亮，您可以执行以下操作：

```
exec {
    1: """
print ('one')
""", 
    2: """
print ('two')
""", 
    3: """
print ('three')
""",
}.get(value, """
print ('None')
""") 
```

价值在哪里`value`。在 C 中，这将是：

```
switch (value) {
    case 1:
        printf("one");
        break;
    case 2:
        printf("two");
        break;
    case 3:
        printf("three");
        break;
    default:
        printf("None");
        break;
} 
```

我们还可以创建一个辅助函数来执行此操作：

```
def switch(value, cases, default):
    exec cases.get(value, default) 
```

因此，我们可以像这样使用它来作为一、二和三的示例：

```
switch(value, {
    1: """
print ('one')
    """, 
    2: """
print ('two')
    """, 
    3: """
print ('three')
    """,
}, """
print ('None')
""") 
```

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2013-02-04T14:21:46.897

正如大多数人使用字典所展示的那样，仅仅将一些键映射到一些代码并不是一个真正的问题。真正的诀窍是试图模仿整个穿透和破坏的东西。我不认为我曾经写过使用该“功能”的案例陈述。这是一个通过。

```
def case(list): reduce(lambda b, f: (b | f[0], {False:(lambda:None),True:f[1]}[b | f[0]]())[0], list, False)

case([
    (False, lambda:print(5)),
    (True, lambda:print(4))
]) 
```

我真的把它想象成一个单一的陈述。我希望你能原谅愚蠢的格式。

```
reduce(
    initializer=False,
    function=(lambda b, f:
        ( b | f[0]
        , { False: (lambda:None)
          , True : f[1]
          }[b | f[0]]()
        )[0]
    ),
    iterable=[
        (False, lambda:print(5)),
        (True, lambda:print(4))
    ]
) 
```

我希望这是有效的 Python 代码。它应该让你通过。当然，布尔检查可以是表达式，如果您希望它们被懒惰地评估，您可以将它们全部包装在 lambda 中。在执行列表中的某些项目后使其接受也不难。只需创建元组 (bool, bool, function)，其中第二个 bool 指示是否突破或丢弃。

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2018-03-19T16:32:29.423

*我从[Python 文档](https://docs.python.org/3/faq/design.html#why-isn-t-there-a-switch-or-case-statement-in-python)中发现以下答案最有帮助：*

您可以使用一系列`if... elif... elif... else`. 已经有一些关于 switch 语句语法的提议，但是关于是否以及如何进行范围测试还没有达成共识。有关完整的详细信息和当前状态，请参阅 PEP 275。

对于需要从大量可能性中进行选择的情况，您可以创建一个字典，将案例值映射到要调用的函数。例如：

```
def function_1(...):
    ...

functions = {'a': function_1,
             'b': function_2,
             'c': self.method_1, ...}

func = functions[value]
func() 
```

对于调用对象的方法，您可以通过使用内置的 getattr() 来检索具有特定名称的方法来进一步简化：

```
def visit_a(self, ...):
    ...
...

def dispatch(self, value):
    method_name = 'visit_' + str(value)
    method = getattr(self, method_name)
    method() 
```

建议您为方法名称使用前缀，例如`visit_`在本例中。如果没有这样的前缀，如果值来自不受信任的来源，攻击者将能够调用您对象上的任何方法。

* * *

## 回答 #35

> 赞同：4
> 
> 时间：2018-06-04T18:41:10.330

作为[Mark Biek 答案的一个小变化，对于](https://stackoverflow.com/a/60215/908494)[这种](https://stackoverflow.com/questions/50686700/)不常见的情况，比如用户有一堆函数调用要延迟并带有要打包的参数（并且不值得构建一堆函数外线），而不是这个：

```
d = {
    "a1": lambda: a(1),
    "a2": lambda: a(2),
    "b": lambda: b("foo"),
    "c": lambda: c(),
    "z": lambda: z("bar", 25),
    }
return d[string]() 
```

… 你可以这样做：

```
d = {
    "a1": (a, 1),
    "a2": (a, 2),
    "b": (b, "foo"),
    "c": (c,)
    "z": (z, "bar", 25),
    }
func, *args = d[string]
return func(*args) 
```

这当然更短，但它是否*更具可读性*是一个悬而未决的问题……</p>

* * *

我认为从这个特定用途切换`lambda`到可能更具可读性（尽管不是更简洁） ：`partial`

```
d = {
    "a1": partial(a, 1),
    "a2": partial(a, 2),
    "b": partial(b, "foo"),
    "c": c,
    "z": partial(z, "bar", 25),
    }
return d[string]() 
```

…它的优点是可以很好地使用关键字参数：

```
d = {
    "a1": partial(a, 1),
    "a2": partial(a, 2),
    "b": partial(b, "foo"),
    "c": c,
    "k": partial(k, key=int),
    "z": partial(z, "bar", 25),
    }
return d[string]() 
```

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2017-08-31T12:36:18.930

我制作了一个在外部不太使用*ifs的**switch case*实现（它仍然在类中使用*if*）。

 **```
class SwitchCase(object):
    def __init__(self):
        self._cases = dict()

    def add_case(self,value, fn):
        self._cases[value] = fn

    def add_default_case(self,fn):
        self._cases['default']  = fn

    def switch_case(self,value):
        if value in self._cases.keys():
            return self._cases[value](value)
        else:
            return self._cases['default'](0) 
```

像这样使用它：

```
from switch_case import SwitchCase
switcher = SwitchCase()
switcher.add_case(1, lambda x:x+1)
switcher.add_case(2, lambda x:x+3)
switcher.add_default_case(lambda _:[1,2,3,4,5])

print switcher.switch_case(1) #2
print switcher.switch_case(2) #5
print switcher.switch_case(123) #[1, 2, 3, 4, 5] 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2008-09-13T00:43:49.300

如果您真的只是返回一个预定的固定值，您可以创建一个字典，其中所有可能的输入索引作为键，以及它们的相应值。此外，您可能并不真的想要一个函数来执行此操作 - 除非您以某种方式计算返回值。

哦，如果你想做一些类似开关的事情，请看[这里](https://web.archive.org/web/20120216013404/http://www.mustap.com/pythonzone_post_224_python-switch-statement?)。

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2018-01-01T04:48:56.837

虽然已经有了足够多的答案，但我想指出一个更简单、更强大的解决方案：

```
class Switch:
    def __init__(self, switches):
        self.switches = switches
        self.between = len(switches[0]) == 3

    def __call__(self, x):
        for line in self.switches:
            if self.between:
                if line[0] <= x < line[1]:
                    return line[2]
            else:
                if line[0] == x:
                    return line[1]
        return None

if __name__ == '__main__':
    between_table = [
        (1, 4, 'between 1 and 4'),
        (4, 8, 'between 4 and 8')
    ]

    switch_between = Switch(between_table)

    print('Switch Between:')
    for i in range(0, 10):
        if switch_between(i):
            print('{} is {}'.format(i, switch_between(i)))
        else:
            print('No match for {}'.format(i))

    equals_table = [
        (1, 'One'),
        (2, 'Two'),
        (4, 'Four'),
        (5, 'Five'),
        (7, 'Seven'),
        (8, 'Eight')
    ]
    print('Switch Equals:')
    switch_equals = Switch(equals_table)
    for i in range(0, 10):
        if switch_equals(i):
            print('{} is {}'.format(i, switch_equals(i)))
        else:
            print('No match for {}'.format(i)) 
```

输出：

```
Switch Between:
No match for 0
1 is between 1 and 4
2 is between 1 and 4
3 is between 1 and 4
4 is between 4 and 8
5 is between 4 and 8
6 is between 4 and 8
7 is between 4 and 8
No match for 8
No match for 9

Switch Equals:
No match for 0
1 is One
2 is Two
No match for 3
4 is Four
5 is Five
No match for 6
7 is Seven
8 is Eight
No match for 9 
```

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2018-06-04T20:21:47.250

与[abarnert 的这个答案](https://stackoverflow.com/a/50686874/2482744)类似，这里有一个专门针对在 switch 中为每个“case”调用单个函数的用例的解决方案，同时避免`lambda`or`partial`以获得超简洁性，同时仍然能够处理关键字参数：

```
class switch(object):
    NO_DEFAULT = object()

    def __init__(self, value, default=NO_DEFAULT):
        self._value = value
        self._result = default

    def __call__(self, option, func, *args, **kwargs):
        if self._value == option:
            self._result = func(*args, **kwargs)
        return self

    def pick(self):
        if self._result is switch.NO_DEFAULT:
            raise ValueError(self._value)

        return self._result 
```

示例用法：

```
def add(a, b):
    return a + b

def double(x):
    return 2 * x

def foo(**kwargs):
    return kwargs

result = (
    switch(3)
    (1, add, 7, 9)
    (2, double, 5)
    (3, foo, bar=0, spam=8)
    (4, lambda: double(1 / 0))  # if evaluating arguments is not safe
).pick()

print(result) 
```

请注意，这是链接调用，即`switch(3)(...)(...)(...)`. 中间不要加逗号。将所有内容放在一个表达式中也很重要，这就是为什么我在主调用周围使用额外的括号来实现隐式行继续。

如果您打开一个未处理的值，上面的示例将引发错误，例如`switch(5)(1, ...)(2, ...)(3, ...)`. 您可以改为提供默认值，例如`switch(5, default=-1)...`返回`-1`。

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2013-06-06T14:01:46.583

也使用*列表*存储案例，并通过选择调用相应的功能 -

```
cases = ['zero()', 'one()', 'two()', 'three()']

def zero():
  print "method for 0 called..."
def one():
  print "method for 1 called..."
def two():
  print "method for 2 called..."
def three():
  print "method for 3 called..."

i = int(raw_input("Enter choice between 0-3 "))

if(i<=len(cases)):
  exec(cases[i])
else:
  print "wrong choice" 
```

[在螺丝桌](http://screwdesk.com/python-switch-case-alternative/)也有解释。

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2017-11-16T16:47:52.713

当我需要一个简单的 switch-case 来调用一堆方法而不是仅仅打印一些文本时，以下适用于我的情况。在玩过 lambda 和 globals 之后，它对我来说是迄今为止最简单的选择。也许它也会帮助某人：

```
def start():
    print("Start")

def stop():
    print("Stop")

def print_help():
    print("Help")

def choose_action(arg):
    return {
        "start": start,
        "stop": stop,
        "help": print_help,
    }.get(arg, print_help)

argument = sys.argv[1].strip()
choose_action(argument)()  # calling a method from the given string 
```

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2017-12-28T20:21:14.403

还有另一个选择：

```
def fnc_MonthSwitch(int_Month): #### Define a function take in the month variable 
    str_Return ="Not Found"     #### Set Default Value 
    if int_Month==1:       str_Return = "Jan"   
    if int_Month==2:       str_Return = "Feb"   
    if int_Month==3:       str_Return = "Mar"   
    return str_Return;          #### Return the month found  
print ("Month Test 3:  " + fnc_MonthSwitch( 3) )
print ("Month Test 14: " + fnc_MonthSwitch(14) ) 
```

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2018-08-12T18:35:50.333

**容易记住：**

```
while True:
    try:
        x = int(input("Enter a numerical input: "))
    except:
        print("Invalid input - please enter a Integer!");
    if x==1:
        print("good");
    elif x==2:
        print("bad");
    elif x==3:
        break
    else:
        print ("terrible"); 
```

* * *

## 回答 #44

> 赞同：-1
> 
> 时间：2017-08-06T08:53:39.240

switch 语句只是 if/elif/else 的语法糖。任何控制语句所做的都是根据正在满足的特定条件委派工作 - 决策路径。为了将其包装到模块中并能够根据其唯一 ID 调用作业，可以使用继承以及 Python 中的任何方法都是虚拟的这一事实，以提供派生类特定的作业实现，作为特定的“案例”处理程序：

```
#!/usr/bin/python

import sys

class Case(object):
    """
        Base class which specifies the interface for the "case" handler.
        The all required arbitrary arguments inside "execute" method will be
        provided through the derived class
        specific constructor

        @note in Python, all class methods are virtual
    """
    def __init__(self, id):
        self.id = id

    def pair(self):
        """
            Pairs the given id of the "case" with
            the instance on which "execute" will be called
        """
        return (self.id, self)

    def execute(self): # Base class virtual method that needs to be overridden
        pass

class Case1(Case):
    def __init__(self, id, msg):
        self.id = id
        self.msg = msg
    def execute(self): # Override the base class method
        print("<Case1> id={}, message: \"{}\"".format(str(self.id), self.msg))

class Case2(Case):
    def __init__(self, id, n):
        self.id = id
        self.n = n
    def execute(self): # Override the base class method
        print("<Case2> id={}, n={}.".format(str(self.id), str(self.n)))
        print("\n".join(map(str, range(self.n))))

class Switch(object):
    """
        The class which delegates the jobs
        based on the given job id
    """
    def __init__(self, cases):
        self.cases = cases # dictionary: time complexity for the access operation is 1
    def resolve(self, id):

        try:
            cases[id].execute()
        except KeyError as e:
            print("Given id: {} is wrong!".format(str(id)))

if __name__ == '__main__':

    # Cases
    cases=dict([Case1(0, "switch").pair(), Case2(1, 5).pair()])

    switch = Switch(cases)

    # id will be dynamically specified
    switch.resolve(0)
    switch.resolve(1)
    switch.resolve(2) 
```

# apache - 为什么我的本地 Apache 打不开 html 页面？

> ID：60213
> 
> 赞同：4
> 
> 时间：2008-09-13T00:38:31.403
> 
> 标签：apache

所以，我在笔记本电脑上运行 Apache。

如果我去“本地主机”，我会得到这样的页面，

> 如果您能看到这一点，则表示该系统上的 Apache Web 服务器软件安装成功。您现在可以将内容添加到此目录并替换此页面。

除了，我无法添加内容并替换该页面。

我可以点击它的链接，效果很好。

首先，该目​​录中甚至没有“index.html”文档。如果我尝试直接访问我使用 localhost/index.html 创建的一个，我会得到“在服务器上找不到请求 URL”。所以，我什至不确定该页面的来源。我已经在 apache 目录下的那个页面中搜索了单词，但什么也没有出现。它似乎重定向到某个地方。

就像测试一样，我知道它加载了 localhost/manual/index.html （不管那是什么），所以我尝试用我写的东西替换它，我收到了消息

> 服务器遇到内部错误或配置错误，无法完成您的请求。

错误日志说，

> [2008 年 9 月 12 日星期五 20:27:54] [错误] [客户端 127.0.0.1] 类型映射中的语法错误，C:/Program Files/Apache Group/Apache2/manual/index.html 中没有 ':' 用于标题 \ r\n

但是，如果我直接使用浏览器打开，该页面可以正常工作。

所以，基本上，我不知道我在这里不知道什么。我不确定apache在寻找什么。我不确定错误是在我的配置文件、我的 html 页面还是什么。

哦，我想使用 apache 打开它的原因（主要）是因为我正在尝试测试一些 php，所以我试图让 apache 在本地运行。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-13T00:44:25.820

“默认情况下，对于 Apache 2.0，您的页面应放置在“C:\Program Files\Apache Group\Apache2\htdocs”文件夹中，对于 Apache 2.0，您的页面应放置在“C:\Program Files\Apache Software Foundation\Apache2.2\htdocs”文件夹中Apache 2.2。当您的站点准备就绪时，只需删除文件夹中的现有文件并将其替换为您想要测试的文件。”

从[这里](http://www.thesitewizard.com/apache/install-apache-2-windows.shtml)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T01:05:16.490

好的，

回答我自己的。. .我发现配置文件中的“Listen”指令已设置为“Listen 80”而不是“Listen localhost:80”。

此外， localhost/htdocs/index.html 不起作用，但 localhost/index.html 可以。

希望这可以帮助将来的人。

谢谢，施罗德。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-17T11:07:55.773

如果您有 Skype，它也使用与 Xampp 相同的端口（80、443）。所以先启动 Xampp，然后再启动 Skype。

[来源：http://starikovs.com/2011/02/23/apache-doesnt-start-in-xampp/]

# command-line - 如何为命令行设置动画？

> ID：60221
> 
> 赞同：81
> 
> 时间：2008-09-13T00:53:10.997
> 
> 标签：command-line

我一直想知道人们如何在命令行中更新前一行。一个很好的例子是在 linux 中使用 wget 命令。它创建了一个 ASCII 加载条，如下所示：

> [======>] 37%

当然，加载条会移动，百分比也会发生变化，但它不会换行。我无法弄清楚如何做到这一点。有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-09-13T00:58:24.273

一种方法是使用当前进度重复更新文本行。例如：

```
def status(percent):
    sys.stdout.write("%3d%%\r" % percent)
    sys.stdout.flush() 
```

请注意，我使用`sys.stdout.write`而不是`print`（这是 Python），因为`print`在每行的末尾自动打印“\r\n”（回车换行符）。我只想要将光标返回到行首的回车符。此外，这`flush()`是必要的，因为默认情况下，`sys.stdout`仅在换行符之后（或在其缓冲区已满之后）刷新其输出。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-09-13T00:56:00.240

我知道有两种方法可以做到这一点：

*   使用退格转义字符 ('\b') 擦除您的行
*   `curses`如果您选择的编程语言有绑定，请使用该包。

谷歌透露了[ANSI Escape Codes](http://en.wikipedia.org/wiki/ANSI_escape_code)，这似乎是一个好方法。作为参考，这是 C++ 中的一个函数来执行此操作：

```
void DrawProgressBar(int len, double percent) {
  cout << "\x1B[2K"; // Erase the entire current line.
  cout << "\x1B[0E"; // Move to the beginning of the current line.
  string progress;
  for (int i = 0; i < len; ++i) {
    if (i < static_cast<int>(len * percent)) {
      progress += "=";
    } else {
      progress += " ";
    }
  }
  cout << "[" << progress << "] " << (static_cast<int>(100 * percent)) << "%";
  flush(cout); // Required.
} 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2014-10-06T15:04:35.553

秘诀是在行的 and 处只打印 \r 而不是 \n 或 \r\n。

\r 称为回车，它将光标移动到行首

\n 称为换行符，它将光标移动到控制台中的下一行。如果你只使用 \r 你会覆盖之前写的行。所以首先写一行如下：

```
[          ] 
```

然后为每个刻度添加一个符号

```
\r[=         ]

\r[==        ]

...

\r[==========] 
```

等等。您可以使用 10 个字符，每个字符代表 10%。此外，如果您想在完成后显示一条消息，请不要忘记添加足够的白色字符，以便覆盖之前写入的等号，如下所示：

```
\r[done      ] 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-12-06T06:47:29.993

下面是我的答案，使用 windows API [Consoles(Windows)](http://msdn.microsoft.com/en-us/library/windows/desktop/ms682055%28v=vs.85%29.aspx)，C 编码。

```
/*
* file: ProgressBarConsole.cpp
* description: a console progress bar Demo
* author: lijian <hustlijian@gmail.com>
* version: 1.0
* date: 2012-12-06
*/
#include <stdio.h>
#include <windows.h>

HANDLE hOut;
CONSOLE_SCREEN_BUFFER_INFO bInfo;
char charProgress[80] = 
    {"================================================================"};
char spaceProgress = ' ';

/*
* show a progress in the [row] line
* row start from 0 to the end
*/
int ProgressBar(char *task, int row, int progress)
{
    char str[100];
    int len, barLen,progressLen;
    COORD crStart, crCurr;
    GetConsoleScreenBufferInfo(hOut, &bInfo);
    crCurr = bInfo.dwCursorPosition; //the old position
    len = bInfo.dwMaximumWindowSize.X;
    barLen = len - 17;//minus the extra char
    progressLen = (int)((progress/100.0)*barLen);
    crStart.X = 0;
    crStart.Y = row;

    sprintf(str,"%-10s[%-.*s>%*c]%3d%%", task,progressLen,charProgress, barLen-progressLen,spaceProgress,50);
#if 0 //use stdand libary
    SetConsoleCursorPosition(hOut, crStart);
    printf("%s\n", str);
#else
    WriteConsoleOutputCharacter(hOut, str, len,crStart,NULL);
#endif
    SetConsoleCursorPosition(hOut, crCurr);
    return 0;
}
int main(int argc, char* argv[])
{
    int i;
    hOut = GetStdHandle(STD_OUTPUT_HANDLE);
    GetConsoleScreenBufferInfo(hOut, &bInfo);

    for (i=0;i<100;i++)
    {
        ProgressBar("test", 0, i);
        Sleep(50);
    }

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-13T01:10:54.027

PowerShell 有一个 Write-Progress cmdlet，它创建一个控制台内进度条，您可以在脚本运行时更新和修改该进度条。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-07-04T09:12:41.653

这是您问题的答案...（python）

```
def disp_status(timelapse, timeout):
  if timelapse and timeout:
     percent = 100 * (float(timelapse)/float(timeout))
     sys.stdout.write("progress : ["+"*"*int(percent)+" "*(100-int(percent-1))+"]"+str(percent)+" %")
     sys.stdout.flush()
     stdout.write("\r  \r") 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-06-23T22:44:09.563

[作为Greg 回答](https://stackoverflow.com/a/60227/1048120)的后续，这里是他的功能的扩展版本，允许您显示多行消息；只需传入要显示/刷新的字符串列表或元组。

```
def status(msgs):
    assert isinstance(msgs, (list, tuple))

    sys.stdout.write(''.join(msg + '\n' for msg in msgs[:-1]) + msgs[-1] + ('\x1b[A' * (len(msgs) - 1)) + '\r')
    sys.stdout.flush() 
```

注意：我只使用 linux 终端对此进行了测试，因此您的里程在基于 Windows 的系统上可能会有所不同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-24T18:55:46.087

如果您使用脚本语言，您可以使用“tput cup”命令来完成这项工作...... PS 这是一个 Linux/Unix 的东西，据我所知......

# windows - Is there replacement for cat on Windows

> ID：60244
> 
> 赞同：337
> 
> 时间：2008-09-13T01:28:06.043
> 
> 标签：windows, command-line, scripting

I need to join two binary files with a `*.bat` script on Windows.

How can I achieve that?

* * *

## 回答 #1

> 赞同：488
> 
> 时间：2008-09-13T01:53:10.320

Windows `type` command works similarly to UNIX `cat`.

**Example 1:**

```
type file1 file2 > file3 
```

is equivalent of:

```
cat file1 file2 > file3 
```

**Example 2:**

```
type  *.vcf > all_in_one.vcf 
```

This command will merge all the vcards into one.

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2008-09-13T01:29:36.773

You can use `copy /b` like this:

```
copy /b file1+file2 destfile 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-13T03:45:06.497

If you have control over the machine where you're doing your work, I highly recommend installing [GnuWin32](http://gnuwin32.sourceforge.net/). Just "Download All" and let the wget program retrieve all the packages. You will then have access to cat, grep, find, gzip, tar, less, and hundreds of others.

GnuWin32 is one of the first things I install on a new Windows box.

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-09-13T02:00:03.847

Shameless PowerShell plug (because I think the learning curve is a pain, so teaching something at any opportunity can help)

```
Get-Content file1,file2 
```

Note that `type` is an alias for Get-Content, so if you like it better, you can write:

```
type file1,file2 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-13T01:32:55.750

Just use the dos copy command with multiple source files and one destination file.

```
copy file1+file2 appendedfile 
```

You might need the /B option for binary files

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-05-17T20:15:34.943

In Windows 10's Redstone 1 release, the Windows added a real Linux subsystem for the NTOS kernel. I think originally it was intended to support Android apps, and maybe docker type scenarios. Microsoft partnered with Canonical and added an actual native bash shell. Also, you can use the apt package manager to get many Ubuntu packages. For example, you can do apt-get gcc to install the GCC tool chain as you would on a Linux box.

If such a thing existed while I was in university, I think I could have done most of my Unix programming assignments in the native Windows bash shell.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-05-30T03:49:44.587

If you simply want to append text to the end of existing file, you can use the >> pipe. ex:

```
echo new text >>existingFile.txt 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-15T13:40:05.037

If you have to use a batch script and have python installed here is a [polygot](http://en.wikipedia.org/wiki/Polyglot_%28computing%29) answer in batch and python:

```
1>2# : ^
'''
@echo off
python "%~nx0" " %~nx1" "%~nx2" "%~nx3"
exit /b
rem ^
'''
import sys
import os

sys.argv = [argv.strip() for argv in sys.argv]
if len(sys.argv) != 4:
    sys.exit(1)

_, file_one, file_two, out_file = sys.argv

for file_name in [file_one, file_two]:
    if not os.path.isfile(file_name):
        print "Can't find: {0}".format(file_name)
        sys.exit(1)

if os.path.isfile(out_file):
    print "Output file exists and will be overwritten"

with open(out_file, "wb") as out:
    with open(file_one, "rb") as f1:
        out.write(f1.read())

    with open(file_two, "rb") as f2:
        out.write(f2.read()) 
```

If saved as join.bat usage would be:

```
join.bat file_one.bin file_two.bin out_file.bin 
```

Thanks too [this answer](https://stackoverflow.com/a/17468811/1663352) for the inspiration.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-11-10T05:17:08.450

I try to rejoin tar archive which has been splitted in a Linux server.

And I found if I use `type` in Windows's `cmd.exe`, it will causes the file being joined in wrong order.(i.e. `type` sometimes will puts XXXX.ad at first and then XXXX.ac , XXXX.aa etc ...)

So, I found a tool named `bat` in GitHub [https://github.com/sharkdp/bat](https://github.com/sharkdp/bat) which has a Windows build, and has better code highlight and the important thing is, it works fine on Windows to rejoin tar archive!

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-01-13T10:03:16.413

So i was looking for a similar solution with the abillity to preserve EOL chars and found out there was no way, so i do what i do best and made my own utillity This is a native cat executable for windows - [https://mega.nz/#!6AVgwQhL!qJ1sxx-tLtpBkPIUx__iQDGKAIfmb21GHLFerhNoaWk](https://mega.nz/#!6AVgwQhL!qJ1sxx-tLtpBkPIUx__iQDGKAIfmb21GHLFerhNoaWk)

```
Usage: cat file1 file2 file3 file4 -o output.txt
-o | Specifies the next arg is the output, we must use this rather than ">>" to preserve the line endings 
```

I call it sharp-cat as its built with C#, feel free to scan with an antivirus and source code will be made available at request

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2020-05-13T14:44:25.203

Windows type command has problems, for example with Unicode characters on 512 bytes boundary. Try Cygwin's cat.

# project-management - 你如何平衡有趣的功能蠕变和时间限制？

> ID：60256
> 
> 赞同：3
> 
> 时间：2008-09-13T01:57:34.553
> 
> 标签：project-management

我通常喜欢编程。乏味的东西很容易尽快和正确地完成，所以我可以通过它而不必再次看到它。

但是我的很多编码都很*有趣*，当我进入“区域”时，我真的很享受。

这就是我犯了错误的地方，我花了太多时间，可能是添加功能，可能是用一种很酷或优雅的方式编写它，或者只是做整洁的原型。

*   在超出您的时间范围之前，您如何识别这种情况正在发生？
*   在开始一段可能很有趣的代码之前或期间，你会做什么才能回到正轨？
*   什么时候可以让自己“疯狂”并享受它而不担心后果？

-亚当

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-13T02:01:36.290

保留详细的优先功能列表/错误列表。经常回顾它，然后平衡有趣的工作与需要完成的错误/功能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T02:20:01.177

给自己一个严格的最后期限——即使是你自己的项目。否则，您只会不断地调整和添加功能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-13T03:40:47.317

始终准备好工作版本（快照）。将其视为 SQL Server 实现快照隔离的方式。:)

继续将新的很酷的东西添加到项目的单独副本中。稳定后，覆盖您的发布文件夹，这就是您的新快照。每当有人要求演示或发布时，您总是可以切换到稳定的应用程序，并且随时可以展示一些东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-13T02:12:56.530

有积压。这样，您将始终牢记在开始做您*想做的事情之前**需要*做什么。

 ** * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T06:51:20.400

将您插入的任何“有趣”功能视为有市场的吸引眼球的东西，以此来证明它们的合理性。

当然，除非它们不可见；）

# wpf - 如何将代码中的 xml 字符串加载到绑定到 XML 的 XPath 的数据绑定 UI 控件？

> ID：60259
> 
> 赞同：3
> 
> 时间：2008-09-13T02:02:00.033
> 
> 标签：wpf, xml, data-binding, xpath, xmldataprovider

我看到的每个示例都在 xmldataprovider 源中使用静态 XML，然后使用 XPath 绑定来对 UI 控件进行数据绑定。想法是使用 WPF UI 编辑动态 XML（开发人员在编码期间已知的结构）。

有没有人找到一种方法来加载动态 xml 字符串（例如在运行时从文件中加载它），然后将该 xml 字符串用作 XmlDataprovider 源？

代码片段会很棒。

更新：为了更清楚，假设我想加载从 Web 服务调用收到的 xml 字符串。我知道xml的结构。所以我将它数据绑定到 WPF 窗口上的 WPF UI 控件。如何使这项工作？Web 上的所有示例，在 XmlDataProvider 节点的 XAML 代码中定义整个 XML。这不是我要找的。我想在代码隐藏中使用 xml 字符串将数据绑定到 UI 控件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T20:15:38.287

这是我用来从磁盘加载 XML 文件并将其绑定到 TreeView 的一些代码。为了简洁，我删除了一些正常的测试。示例中的 XML 是一个 OPML 文件。

```
XmlDataProvider provider = new XmlDataProvider();

if (provider != null)
{
  System.Xml.XmlDocument doc = new System.Xml.XmlDocument();
  doc.Load(fileName);
  provider.Document = doc;
  provider.XPath = "/opml/body/outline";
  FeedListTreeView.DataContext = provider;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T08:00:45.197

使用您的网络服务获取您的 XML 并从中创建一个 XML 文档，然后您可以将 xmlDataProvider 的源设置为您从服务中获得的 XMLDocument。

我不在带有 Visual Studio 的 PC 上对其进行测试，但您应该可以这样做。

这些步骤正如您在问题中提到的那样：

```
1.从webservice获取XML
2\. 将 XML 字符串转换为 XML 文档
3\. 将 XMLDataProvider.Document 值设置为您的 XML 文档
4.将其绑定到您的控件

```

# macros - 我的第一个 Lisp 宏；漏水了吗？

> ID：60260
> 
> 赞同：5
> 
> 时间：2008-09-13T02:04:20.153
> 
> 标签：macros, lisp

我一直在研究[Practical Common Lisp](http://gigamonkeys.com/book)，并作为练习决定编写一个宏来确定一个数字是否是另一个数字的倍数：

`(defmacro multp (value factor)
`(= (rem ,value ,factor) 0))`

所以 : `(multp 40 10)` 评估为 true 而 `(multp 40 13)` 不是

问题是这个宏是否以某种方式[泄漏？](http://gigamonkeys.com/book/macros-defining-your-own.html#plugging-the-leaks)这也是“好”的 Lisp 吗？是否已经有我可以使用的现有函数/宏？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-13T02:21:26.400

Siebel 对可能的泄漏源进行了广泛的概述（无论如何都是简单的情况），这里没有任何一个。`value`和都只`factor`按顺序评估一次，并且`rem`没有任何副作用。

但这不是好的 Lisp，因为在这种情况下没有理由使用宏。一个函数

```
(defun multp (value factor)
  (zerop (rem value factor))) 
```

对于所有实际目的都是相同的。（注意使用`zerop`. 我认为在这种情况下它使事情更清楚，但在您需要强调的情况下，如果您正在测试的值不是零，那么它可能仍然有意义，`(= ... 0)`可能会更好）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-13T02:21:44.840

你的宏对我来说看起来不错。我不知道什么是泄漏宏，但你的非常简单，不需要任何 gensyms。就这是否是“好”的 Lisp 而言，我的经验法则是仅在函数不起作用时才使用宏，在这种情况下，可以使用函数代替宏。但是，如果此解决方案对您有用，则没有理由不使用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T10:28:16.570

好吧，原则上，用户可以这样做：

```
(flet ((= (&rest args) nil))
  (multp 40 10)) 
```

这将评估为 NIL ...除了 ANSI CL 使重新绑定大多数标准符号（包括 CL:=）是非法的，因此在这种特殊情况下你是安全的。

当然，一般来说，您应该注意引用不透明（从宏扩展的上下文中捕获标识符）和宏不卫生（将标识符泄漏到扩展代码）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T11:57:48.930

不，宏的“词法闭包”中引入的符号不会被释放到外部。

请注意，泄漏不一定是坏事，即使意外泄漏几乎总是如此。对于我从事的一个项目，我发现类似于此的宏很有用：

```
(defmacro ana-and (&rest forms)
  (loop for form in (reverse forms)
        for completion = form then `(let ((it ,form))
                                      (when it
                                       ,completion))
        finally (return completion))) 
```

这使我能够“短路”需要按顺序完成的事情，并从序列中的先前调用中继承参数（并通过返回 NIL 表示失败）。此代码来自的特定上下文是用于配置文件的手写解析器，该配置文件具有足够拼凑的语法，使用解析器生成器编写适当的解析器比手动滚动更多工作。

# java - 如何使用 Java Swing 实现可拖动选项卡？

> ID：60269
> 
> 赞同：34
> 
> 时间：2008-09-13T02:25:54.563
> 
> 标签：java, user-interface, swing, tabs

如何使用 Java Swing 实现可拖动选项卡？而不是静态的 JTabbedPane 我想将选项卡拖放到不同的位置以重新排列选项卡。

**编辑**：[Java 教程 - 拖放和数据传输](http://java.sun.com/docs/books/tutorial/uiswing/dnd/index.html)。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-13T03:33:48.240

诅咒！被谷歌搜索打败了。不幸的是，确实没有简单的方法可以在 Swing 中创建可拖动的选项卡窗格（或任何其他组件）。因此，虽然上面的例子已经完成，但我刚刚写的这个例子要简单一些。因此，它有望更清楚地展示所涉及的更先进的技术。步骤是：

1.  检测到发生了拖拽
2.  将拖动的选项卡绘制到屏幕外缓冲区
3.  拖动时跟踪鼠标位置
4.  在组件顶部的缓冲区中绘制选项卡。

上面的示例将为您提供所需的内容，但如果您想真正了解此处应用的技术，则修整此示例的边缘并向其添加上面演示的额外功能可能是一个更好的练习。

或者，也许我只是感到失望，因为我花时间编写了这个已经存在的解决方案：p

```
import java.awt.Component;
import java.awt.Graphics;
import java.awt.Image;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionAdapter;
import java.awt.image.BufferedImage;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JTabbedPane;

public class DraggableTabbedPane extends JTabbedPane {

  private boolean dragging = false;
  private Image tabImage = null;
  private Point currentMouseLocation = null;
  private int draggedTabIndex = 0;

  public DraggableTabbedPane() {
    super();
    addMouseMotionListener(new MouseMotionAdapter() {
      public void mouseDragged(MouseEvent e) {

        if(!dragging) {
          // Gets the tab index based on the mouse position
          int tabNumber = getUI().tabForCoordinate(DraggableTabbedPane.this, e.getX(), e.getY());

          if(tabNumber >= 0) {
            draggedTabIndex = tabNumber;
            Rectangle bounds = getUI().getTabBounds(DraggableTabbedPane.this, tabNumber);

            // Paint the tabbed pane to a buffer
            Image totalImage = new BufferedImage(getWidth(), getHeight(), BufferedImage.TYPE_INT_ARGB);
            Graphics totalGraphics = totalImage.getGraphics();
            totalGraphics.setClip(bounds);
            // Don't be double buffered when painting to a static image.
            setDoubleBuffered(false);
            paintComponent(totalGraphics);

            // Paint just the dragged tab to the buffer
            tabImage = new BufferedImage(bounds.width, bounds.height, BufferedImage.TYPE_INT_ARGB);
            Graphics graphics = tabImage.getGraphics();
            graphics.drawImage(totalImage, 0, 0, bounds.width, bounds.height, bounds.x, bounds.y, bounds.x + bounds.width, bounds.y+bounds.height, DraggableTabbedPane.this);

            dragging = true;
            repaint();
          }
        } else {
          currentMouseLocation = e.getPoint();

          // Need to repaint
          repaint();
        }

        super.mouseDragged(e);
      }
    });

    addMouseListener(new MouseAdapter() {
      public void mouseReleased(MouseEvent e) {

        if(dragging) {
          int tabNumber = getUI().tabForCoordinate(DraggableTabbedPane.this, e.getX(), 10);

          if(tabNumber >= 0) {
            Component comp = getComponentAt(draggedTabIndex);
            String title = getTitleAt(draggedTabIndex);
            removeTabAt(draggedTabIndex);
            insertTab(title, null, comp, null, tabNumber);
          }
        }

        dragging = false;
        tabImage = null;
      }
    });
  }

  protected void paintComponent(Graphics g) {
    super.paintComponent(g);

    // Are we dragging?
    if(dragging && currentMouseLocation != null && tabImage != null) {
      // Draw the dragged tab
      g.drawImage(tabImage, currentMouseLocation.x, currentMouseLocation.y, this);
    }
  }

  public static void main(String[] args) {
    JFrame test = new JFrame("Tab test");
    test.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    test.setSize(400, 400);

    DraggableTabbedPane tabs = new DraggableTabbedPane();
    tabs.addTab("One", new JButton("One"));
    tabs.addTab("Two", new JButton("Two"));
    tabs.addTab("Three", new JButton("Three"));
    tabs.addTab("Four", new JButton("Four"));

    test.add(tabs);
    test.setVisible(true);
  }
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-15T07:41:08.797

我喜欢[Terai Atsuhiro san 的 DnDTabbedPane](http://java-swing-tips.blogspot.com/2008/04/drag-and-drop-tabs-in-jtabbedpane.html)，但我想从中获得更多。最初的 Terai 实现在 TabbedPane 中传输选项卡，但如果我可以从一个 TabbedPane 拖动到另一个会更好。

受到@Tom[努力](https://stackoverflow.com/questions/60269/how-to-implement-draggable-tab-using-java-swing#60306)的启发，我决定自己修改代码。我添加了一些细节。例如，幻影选项卡现在沿着选项卡式窗格滑动，而不是与鼠标一起移动。

`setAcceptor(TabAcceptor a_acceptor)`应该让消费者代码决定是否让一个选项卡从一个选项卡式窗格转移到另一个。默认接受器总是返回`true`。

```
/** Modified DnDTabbedPane.java
 * http://java-swing-tips.blogspot.com/2008/04/drag-and-drop-tabs-in-jtabbedpane.html
 * originally written by Terai Atsuhiro.
 * so that tabs can be transfered from one pane to another.
 * eed3si9n.
 */

import java.awt.*;
import java.awt.datatransfer.*;
import java.awt.dnd.*;
import java.awt.geom.*;
import java.awt.image.*;
import javax.swing.*;

public class DnDTabbedPane extends JTabbedPane {
    public static final long serialVersionUID = 1L;
    private static final int LINEWIDTH = 3;
    private static final String NAME = "TabTransferData";
    private final DataFlavor FLAVOR = new DataFlavor(
            DataFlavor.javaJVMLocalObjectMimeType, NAME);
    private static GhostGlassPane s_glassPane = new GhostGlassPane();

    private boolean m_isDrawRect = false;
    private final Rectangle2D m_lineRect = new Rectangle2D.Double();

    private final Color m_lineColor = new Color(0, 100, 255);
    private TabAcceptor m_acceptor = null;

    public DnDTabbedPane() {
        super();
        final DragSourceListener dsl = new DragSourceListener() {
            public void dragEnter(DragSourceDragEvent e) {
                e.getDragSourceContext().setCursor(DragSource.DefaultMoveDrop);
            }

            public void dragExit(DragSourceEvent e) {
                e.getDragSourceContext()
                        .setCursor(DragSource.DefaultMoveNoDrop);
                m_lineRect.setRect(0, 0, 0, 0);
                m_isDrawRect = false;
                s_glassPane.setPoint(new Point(-1000, -1000));
                s_glassPane.repaint();
            }

            public void dragOver(DragSourceDragEvent e) {
                //e.getLocation()
                //This method returns a Point indicating the cursor location in screen coordinates at the moment

                TabTransferData data = getTabTransferData(e);
                if (data == null) {
                    e.getDragSourceContext().setCursor(
                            DragSource.DefaultMoveNoDrop);
                    return;
                } // if

                /*
                Point tabPt = e.getLocation();
                SwingUtilities.convertPointFromScreen(tabPt, DnDTabbedPane.this);
                if (DnDTabbedPane.this.contains(tabPt)) {
                    int targetIdx = getTargetTabIndex(tabPt);
                    int sourceIndex = data.getTabIndex();
                    if (getTabAreaBound().contains(tabPt)
                            && (targetIdx >= 0)
                            && (targetIdx != sourceIndex)
                            && (targetIdx != sourceIndex + 1)) {
                        e.getDragSourceContext().setCursor(
                                DragSource.DefaultMoveDrop);

                        return;
                    } // if

                    e.getDragSourceContext().setCursor(
                            DragSource.DefaultMoveNoDrop);
                    return;
                } // if
                */

                e.getDragSourceContext().setCursor(
                        DragSource.DefaultMoveDrop);
            }

            public void dragDropEnd(DragSourceDropEvent e) {
                m_isDrawRect = false;
                m_lineRect.setRect(0, 0, 0, 0);
                // m_dragTabIndex = -1;

                if (hasGhost()) {
                    s_glassPane.setVisible(false);
                    s_glassPane.setImage(null);
                }
            }

            public void dropActionChanged(DragSourceDragEvent e) {
            }
        };

        final DragGestureListener dgl = new DragGestureListener() {
            public void dragGestureRecognized(DragGestureEvent e) {
                // System.out.println("dragGestureRecognized");

                Point tabPt = e.getDragOrigin();
                int dragTabIndex = indexAtLocation(tabPt.x, tabPt.y);
                if (dragTabIndex < 0) {
                    return;
                } // if

                initGlassPane(e.getComponent(), e.getDragOrigin(), dragTabIndex);
                try {
                    e.startDrag(DragSource.DefaultMoveDrop, 
                            new TabTransferable(DnDTabbedPane.this, dragTabIndex), dsl);
                } catch (InvalidDnDOperationException idoe) {
                    idoe.printStackTrace();
                }
            }
        };

        //dropTarget =
        new DropTarget(this, DnDConstants.ACTION_COPY_OR_MOVE,
                new CDropTargetListener(), true);
        new DragSource().createDefaultDragGestureRecognizer(this,
                DnDConstants.ACTION_COPY_OR_MOVE, dgl);
        m_acceptor = new TabAcceptor() {
            public boolean isDropAcceptable(DnDTabbedPane a_component, int a_index) {
                return true;
            }
        };
    }

    public TabAcceptor getAcceptor() {
        return m_acceptor;
    }

    public void setAcceptor(TabAcceptor a_value) {
        m_acceptor = a_value;
    }

    private TabTransferData getTabTransferData(DropTargetDropEvent a_event) {       
        try {
            TabTransferData data = (TabTransferData) a_event.getTransferable().getTransferData(FLAVOR);             
            return data;
        } catch (Exception e) {
            e.printStackTrace();
        }

        return null;
    }

    private TabTransferData getTabTransferData(DropTargetDragEvent a_event) {
        try {
            TabTransferData data = (TabTransferData) a_event.getTransferable().getTransferData(FLAVOR);             
            return data;
        } catch (Exception e) {
            e.printStackTrace();
        }

        return null;
    }

    private TabTransferData getTabTransferData(DragSourceDragEvent a_event) {
        try {
            TabTransferData data = (TabTransferData) a_event.getDragSourceContext()
                .getTransferable().getTransferData(FLAVOR);             
            return data;
        } catch (Exception e) {
            e.printStackTrace();
        }

        return null;        
    }

    class TabTransferable implements Transferable {
        private TabTransferData m_data = null;

        public TabTransferable(DnDTabbedPane a_tabbedPane, int a_tabIndex) {
            m_data = new TabTransferData(DnDTabbedPane.this, a_tabIndex);
        }

        public Object getTransferData(DataFlavor flavor) {
            return m_data;
            // return DnDTabbedPane.this;
        }

        public DataFlavor[] getTransferDataFlavors() {
            DataFlavor[] f = new DataFlavor[1];
            f[0] = FLAVOR;
            return f;
        }

        public boolean isDataFlavorSupported(DataFlavor flavor) {
            return flavor.getHumanPresentableName().equals(NAME);
        }       
    }

    class TabTransferData {
        private DnDTabbedPane m_tabbedPane = null;
        private int m_tabIndex = -1;

        public TabTransferData() {
        }

        public TabTransferData(DnDTabbedPane a_tabbedPane, int a_tabIndex) {
            m_tabbedPane = a_tabbedPane;
            m_tabIndex = a_tabIndex;
        }

        public DnDTabbedPane getTabbedPane() {
            return m_tabbedPane;
        }

        public void setTabbedPane(DnDTabbedPane pane) {
            m_tabbedPane = pane;
        }

        public int getTabIndex() {
            return m_tabIndex;
        }

        public void setTabIndex(int index) {
            m_tabIndex = index;
        }
    }

    private Point buildGhostLocation(Point a_location) {
        Point retval = new Point(a_location);

        switch (getTabPlacement()) {
            case JTabbedPane.TOP: {
                retval.y = 1;
                retval.x -= s_glassPane.getGhostWidth() / 2;
            } break;

            case JTabbedPane.BOTTOM: {
                retval.y = getHeight() - 1 - s_glassPane.getGhostHeight();
                retval.x -= s_glassPane.getGhostWidth() / 2;
            } break;

            case JTabbedPane.LEFT: {
                retval.x = 1;
                retval.y -= s_glassPane.getGhostHeight() / 2;
            } break;

            case JTabbedPane.RIGHT: {
                retval.x = getWidth() - 1 - s_glassPane.getGhostWidth();
                retval.y -= s_glassPane.getGhostHeight() / 2;
            } break;
        } // switch

        retval = SwingUtilities.convertPoint(DnDTabbedPane.this,
                retval, s_glassPane);
        return retval;
    }

    class CDropTargetListener implements DropTargetListener {
        public void dragEnter(DropTargetDragEvent e) {
            // System.out.println("DropTarget.dragEnter: " + DnDTabbedPane.this);

            if (isDragAcceptable(e)) {
                e.acceptDrag(e.getDropAction());
            } else {
                e.rejectDrag();
            } // if
        }

        public void dragExit(DropTargetEvent e) {
            // System.out.println("DropTarget.dragExit: " + DnDTabbedPane.this);
            m_isDrawRect = false;
        }

        public void dropActionChanged(DropTargetDragEvent e) {
        }

        public void dragOver(final DropTargetDragEvent e) {
            TabTransferData data = getTabTransferData(e);

            if (getTabPlacement() == JTabbedPane.TOP
                    || getTabPlacement() == JTabbedPane.BOTTOM) {
                initTargetLeftRightLine(getTargetTabIndex(e.getLocation()), data);
            } else {
                initTargetTopBottomLine(getTargetTabIndex(e.getLocation()), data);
            } // if-else

            repaint();
            if (hasGhost()) {
                s_glassPane.setPoint(buildGhostLocation(e.getLocation()));
                s_glassPane.repaint();
            }
        }

        public void drop(DropTargetDropEvent a_event) {
            // System.out.println("DropTarget.drop: " + DnDTabbedPane.this);

            if (isDropAcceptable(a_event)) {
                convertTab(getTabTransferData(a_event),
                    getTargetTabIndex(a_event.getLocation()));
                a_event.dropComplete(true);
            } else {
                a_event.dropComplete(false);
            } // if-else

            m_isDrawRect = false;
            repaint();
        }

        public boolean isDragAcceptable(DropTargetDragEvent e) {
            Transferable t = e.getTransferable();
            if (t == null) {
                return false;
            } // if

            DataFlavor[] flavor = e.getCurrentDataFlavors();
            if (!t.isDataFlavorSupported(flavor[0])) {
                return false;
            } // if

            TabTransferData data = getTabTransferData(e);

            if (DnDTabbedPane.this == data.getTabbedPane()
                    && data.getTabIndex() >= 0) {
                return true;
            } // if

            if (DnDTabbedPane.this != data.getTabbedPane()) {
                if (m_acceptor != null) {
                    return m_acceptor.isDropAcceptable(data.getTabbedPane(), data.getTabIndex());
                } // if
            } // if

            return false;
        }

        public boolean isDropAcceptable(DropTargetDropEvent e) {
            Transferable t = e.getTransferable();
            if (t == null) {
                return false;
            } // if

            DataFlavor[] flavor = e.getCurrentDataFlavors();
            if (!t.isDataFlavorSupported(flavor[0])) {
                return false;
            } // if

            TabTransferData data = getTabTransferData(e);

            if (DnDTabbedPane.this == data.getTabbedPane()
                    && data.getTabIndex() >= 0) {
                return true;
            } // if

            if (DnDTabbedPane.this != data.getTabbedPane()) {
                if (m_acceptor != null) {
                    return m_acceptor.isDropAcceptable(data.getTabbedPane(), data.getTabIndex());
                } // if
            } // if

            return false;
        }
    }

    private boolean m_hasGhost = true;

    public void setPaintGhost(boolean flag) {
        m_hasGhost = flag;
    }

    public boolean hasGhost() {
        return m_hasGhost;
    }

    /**
     * returns potential index for drop.
     * @param a_point point given in the drop site component's coordinate
     * @return returns potential index for drop.
     */
    private int getTargetTabIndex(Point a_point) {
        boolean isTopOrBottom = getTabPlacement() == JTabbedPane.TOP
                || getTabPlacement() == JTabbedPane.BOTTOM;

        // if the pane is empty, the target index is always zero.
        if (getTabCount() == 0) {
            return 0;
        } // if

        for (int i = 0; i < getTabCount(); i++) {
            Rectangle r = getBoundsAt(i);
            if (isTopOrBottom) {
                r.setRect(r.x - r.width / 2, r.y, r.width, r.height);
            } else {
                r.setRect(r.x, r.y - r.height / 2, r.width, r.height);
            } // if-else

            if (r.contains(a_point)) {
                return i;
            } // if
        } // for

        Rectangle r = getBoundsAt(getTabCount() - 1);
        if (isTopOrBottom) {
            int x = r.x + r.width / 2;
            r.setRect(x, r.y, getWidth() - x, r.height);
        } else {
            int y = r.y + r.height / 2;
            r.setRect(r.x, y, r.width, getHeight() - y);
        } // if-else

        return r.contains(a_point) ? getTabCount() : -1;
    }

    private void convertTab(TabTransferData a_data, int a_targetIndex) {
        DnDTabbedPane source = a_data.getTabbedPane();
        int sourceIndex = a_data.getTabIndex();
        if (sourceIndex < 0) {
            return;
        } // if

        Component cmp = source.getComponentAt(sourceIndex);
        String str = source.getTitleAt(sourceIndex);
        if (this != source) {
            source.remove(sourceIndex);

            if (a_targetIndex == getTabCount()) {
                addTab(str, cmp);
            } else {
                if (a_targetIndex < 0) {
                    a_targetIndex = 0;
                } // if

                insertTab(str, null, cmp, null, a_targetIndex);

            } // if

            setSelectedComponent(cmp);
            // System.out.println("press="+sourceIndex+" next="+a_targetIndex);
            return;
        } // if

        if (a_targetIndex < 0 || sourceIndex == a_targetIndex) {
            //System.out.println("press="+prev+" next="+next);
            return;
        } // if

        if (a_targetIndex == getTabCount()) {
            //System.out.println("last: press="+prev+" next="+next);
            source.remove(sourceIndex);
            addTab(str, cmp);
            setSelectedIndex(getTabCount() - 1);
        } else if (sourceIndex > a_targetIndex) {
            //System.out.println("   >: press="+prev+" next="+next);
            source.remove(sourceIndex);
            insertTab(str, null, cmp, null, a_targetIndex);
            setSelectedIndex(a_targetIndex);
        } else {
            //System.out.println("   <: press="+prev+" next="+next);
            source.remove(sourceIndex);
            insertTab(str, null, cmp, null, a_targetIndex - 1);
            setSelectedIndex(a_targetIndex - 1);
        }
    }

    private void initTargetLeftRightLine(int next, TabTransferData a_data) {        
        if (next < 0) {
            m_lineRect.setRect(0, 0, 0, 0);
            m_isDrawRect = false;
            return;
        } // if

        if ((a_data.getTabbedPane() == this)
                && (a_data.getTabIndex() == next
                || next - a_data.getTabIndex() == 1)) {
            m_lineRect.setRect(0, 0, 0, 0);
            m_isDrawRect = false;
        } else if (getTabCount() == 0) {
            m_lineRect.setRect(0, 0, 0, 0);
            m_isDrawRect = false;
            return;
        } else if (next == 0) {
            Rectangle rect = getBoundsAt(0);
            m_lineRect.setRect(-LINEWIDTH / 2, rect.y, LINEWIDTH, rect.height);
            m_isDrawRect = true;
        } else if (next == getTabCount()) {
            Rectangle rect = getBoundsAt(getTabCount() - 1);
            m_lineRect.setRect(rect.x + rect.width - LINEWIDTH / 2, rect.y,
                    LINEWIDTH, rect.height);
            m_isDrawRect = true;
        } else {
            Rectangle rect = getBoundsAt(next - 1);
            m_lineRect.setRect(rect.x + rect.width - LINEWIDTH / 2, rect.y,
                    LINEWIDTH, rect.height);
            m_isDrawRect = true;
        }
    }

    private void initTargetTopBottomLine(int next, TabTransferData a_data) {
        if (next < 0) {
            m_lineRect.setRect(0, 0, 0, 0);
            m_isDrawRect = false;
            return;
        } // if

        if ((a_data.getTabbedPane() == this)
                && (a_data.getTabIndex() == next
                || next - a_data.getTabIndex() == 1)) {
            m_lineRect.setRect(0, 0, 0, 0);
            m_isDrawRect = false;
        } else if (getTabCount() == 0) {
            m_lineRect.setRect(0, 0, 0, 0);
            m_isDrawRect = false;
            return;
        } else if (next == getTabCount()) {
            Rectangle rect = getBoundsAt(getTabCount() - 1);
            m_lineRect.setRect(rect.x, rect.y + rect.height - LINEWIDTH / 2,
                    rect.width, LINEWIDTH);
            m_isDrawRect = true;
        } else if (next == 0) {
            Rectangle rect = getBoundsAt(0);
            m_lineRect.setRect(rect.x, -LINEWIDTH / 2, rect.width, LINEWIDTH);
            m_isDrawRect = true;
        } else {
            Rectangle rect = getBoundsAt(next - 1);
            m_lineRect.setRect(rect.x, rect.y + rect.height - LINEWIDTH / 2,
                    rect.width, LINEWIDTH);
            m_isDrawRect = true;
        }
    }

    private void initGlassPane(Component c, Point tabPt, int a_tabIndex) {
        //Point p = (Point) pt.clone();
        getRootPane().setGlassPane(s_glassPane);
        if (hasGhost()) {
            Rectangle rect = getBoundsAt(a_tabIndex);
            BufferedImage image = new BufferedImage(c.getWidth(),
                    c.getHeight(), BufferedImage.TYPE_INT_ARGB);
            Graphics g = image.getGraphics();
            c.paint(g);
            image = image.getSubimage(rect.x, rect.y, rect.width, rect.height);
            s_glassPane.setImage(image);            
        } // if

        s_glassPane.setPoint(buildGhostLocation(tabPt));
        s_glassPane.setVisible(true);
    }

    private Rectangle getTabAreaBound() {
        Rectangle lastTab = getUI().getTabBounds(this, getTabCount() - 1);
        return new Rectangle(0, 0, getWidth(), lastTab.y + lastTab.height);
    }

    public void paintComponent(Graphics g) {
        super.paintComponent(g);

        if (m_isDrawRect) {
            Graphics2D g2 = (Graphics2D) g;
            g2.setPaint(m_lineColor);
            g2.fill(m_lineRect);
        } // if
    }

    public interface TabAcceptor {
        boolean isDropAcceptable(DnDTabbedPane a_component, int a_index);
    }
}

class GhostGlassPane extends JPanel {
    public static final long serialVersionUID = 1L;
    private final AlphaComposite m_composite;

    private Point m_location = new Point(0, 0);

    private BufferedImage m_draggingGhost = null;

    public GhostGlassPane() {
        setOpaque(false);
        m_composite = AlphaComposite.getInstance(AlphaComposite.SRC_OVER, 0.7f);
    }

    public void setImage(BufferedImage draggingGhost) {
        m_draggingGhost = draggingGhost;
    }

    public void setPoint(Point a_location) {
        m_location.x = a_location.x;
        m_location.y = a_location.y;
    }

    public int getGhostWidth() {
        if (m_draggingGhost == null) {
            return 0;
        } // if

        return m_draggingGhost.getWidth(this);
    }

    public int getGhostHeight() {
        if (m_draggingGhost == null) {
            return 0;
        } // if

        return m_draggingGhost.getHeight(this);
    }

    public void paintComponent(Graphics g) {
        if (m_draggingGhost == null) {
            return;
        } // if 

        Graphics2D g2 = (Graphics2D) g;
        g2.setComposite(m_composite);

        g2.drawImage(m_draggingGhost, (int) m_location.getX(), (int) m_location.getY(), null);
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-13T02:49:25.507

[在管子](http://java-swing-tips.blogspot.com/2008/04/drag-and-drop-tabs-in-jtabbedpane.html)上找到了这段代码：

```
class DnDTabbedPane extends JTabbedPane {
  private static final int LINEWIDTH = 3;
  private static final String NAME = "test";
  private final GhostGlassPane glassPane = new GhostGlassPane();
  private final Rectangle2D lineRect   = new Rectangle2D.Double();
  private final Color     lineColor  = new Color(0, 100, 255);
  //private final DragSource dragSource  = new DragSource();
  //private final DropTarget dropTarget;
  private int dragTabIndex = -1;

  public DnDTabbedPane() {
    super();
    final DragSourceListener dsl = new DragSourceListener() {
      public void dragEnter(DragSourceDragEvent e) {
        e.getDragSourceContext().setCursor(DragSource.DefaultMoveDrop);
      }
      public void dragExit(DragSourceEvent e) {
        e.getDragSourceContext().setCursor(DragSource.DefaultMoveNoDrop);
        lineRect.setRect(0,0,0,0);
        glassPane.setPoint(new Point(-1000,-1000));
        glassPane.repaint();
      }
      public void dragOver(DragSourceDragEvent e) {
        //e.getLocation()
        //This method returns a Point indicating the cursor location in screen coordinates at the moment
        Point tabPt = e.getLocation();
        SwingUtilities.convertPointFromScreen(tabPt, DnDTabbedPane.this);
        Point glassPt = e.getLocation();
        SwingUtilities.convertPointFromScreen(glassPt, glassPane);
        int targetIdx = getTargetTabIndex(glassPt);
        if(getTabAreaBound().contains(tabPt) && targetIdx>=0 &&
           targetIdx!=dragTabIndex && targetIdx!=dragTabIndex+1) {
          e.getDragSourceContext().setCursor(DragSource.DefaultMoveDrop);
        }else{
          e.getDragSourceContext().setCursor(DragSource.DefaultMoveNoDrop);
        }
      }
      public void dragDropEnd(DragSourceDropEvent e) {
        lineRect.setRect(0,0,0,0);
        dragTabIndex = -1;
        if(hasGhost()) {
          glassPane.setVisible(false);
          glassPane.setImage(null);
        }
      }
      public void dropActionChanged(DragSourceDragEvent e) {}
    };
    final Transferable t = new Transferable() {
      private final DataFlavor FLAVOR = new DataFlavor(DataFlavor.javaJVMLocalObjectMimeType, NAME);
      public Object getTransferData(DataFlavor flavor) {
        return DnDTabbedPane.this;
      }
      public DataFlavor[] getTransferDataFlavors() {
        DataFlavor[] f = new DataFlavor[1];
        f[0] = this.FLAVOR;
        return f;
      }
      public boolean isDataFlavorSupported(DataFlavor flavor) {
        return flavor.getHumanPresentableName().equals(NAME);
      }
    };
    final DragGestureListener dgl = new DragGestureListener() {
      public void dragGestureRecognized(DragGestureEvent e) {
        Point tabPt = e.getDragOrigin();
        dragTabIndex = indexAtLocation(tabPt.x, tabPt.y);
        if(dragTabIndex<0) return;
        initGlassPane(e.getComponent(), e.getDragOrigin());
        try{
          e.startDrag(DragSource.DefaultMoveDrop, t, dsl);
        }catch(InvalidDnDOperationException idoe) {
          idoe.printStackTrace();
        }
      }
    };
    //dropTarget =
    new DropTarget(glassPane, DnDConstants.ACTION_COPY_OR_MOVE, new CDropTargetListener(), true);
    new DragSource().createDefaultDragGestureRecognizer(this, DnDConstants.ACTION_COPY_OR_MOVE, dgl);
  }

  class CDropTargetListener implements DropTargetListener{
    public void dragEnter(DropTargetDragEvent e) {
      if(isDragAcceptable(e)) e.acceptDrag(e.getDropAction());
      else e.rejectDrag();
    }
    public void dragExit(DropTargetEvent e) {}
    public void dropActionChanged(DropTargetDragEvent e) {}
    public void dragOver(final DropTargetDragEvent e) {
      if(getTabPlacement()==JTabbedPane.TOP || getTabPlacement()==JTabbedPane.BOTTOM) {
        initTargetLeftRightLine(getTargetTabIndex(e.getLocation()));
      }else{
        initTargetTopBottomLine(getTargetTabIndex(e.getLocation()));
      }
      repaint();
      if(hasGhost()) {
        glassPane.setPoint(e.getLocation());
        glassPane.repaint();
      }
    }

    public void drop(DropTargetDropEvent e) {
      if(isDropAcceptable(e)) {
        convertTab(dragTabIndex, getTargetTabIndex(e.getLocation()));
        e.dropComplete(true);
      }else{
        e.dropComplete(false);
      }
      repaint();
    }
    public boolean isDragAcceptable(DropTargetDragEvent e) {
      Transferable t = e.getTransferable();
      if(t==null) return false;
      DataFlavor[] f = e.getCurrentDataFlavors();
      if(t.isDataFlavorSupported(f[0]) && dragTabIndex>=0) {
        return true;
      }
      return false;
    }
    public boolean isDropAcceptable(DropTargetDropEvent e) {
      Transferable t = e.getTransferable();
      if(t==null) return false;
      DataFlavor[] f = t.getTransferDataFlavors();
      if(t.isDataFlavorSupported(f[0]) && dragTabIndex>=0) {
        return true;
      }
      return false;
    }
  }

  private boolean hasGhost = true;
  public void setPaintGhost(boolean flag) {
    hasGhost = flag;
  }
  public boolean hasGhost() {
    return hasGhost;
  }
  private int getTargetTabIndex(Point glassPt) {
    Point tabPt = SwingUtilities.convertPoint(glassPane, glassPt, DnDTabbedPane.this);
    boolean isTB = getTabPlacement()==JTabbedPane.TOP || getTabPlacement()==JTabbedPane.BOTTOM;
    for(int i=0;i<getTabCount();i++) {
      Rectangle r = getBoundsAt(i);
      if(isTB) r.setRect(r.x-r.width/2, r.y,  r.width, r.height);
      else   r.setRect(r.x, r.y-r.height/2, r.width, r.height);
      if(r.contains(tabPt)) return i;
    }
    Rectangle r = getBoundsAt(getTabCount()-1);
    if(isTB) r.setRect(r.x+r.width/2, r.y,  r.width, r.height);
    else   r.setRect(r.x, r.y+r.height/2, r.width, r.height);
    return   r.contains(tabPt)?getTabCount():-1;
  }
  private void convertTab(int prev, int next) {
    if(next<0 || prev==next) {
      //System.out.println("press="+prev+" next="+next);
      return;
    }
    Component cmp = getComponentAt(prev);
    String str = getTitleAt(prev);
    if(next==getTabCount()) {
      //System.out.println("last: press="+prev+" next="+next);
      remove(prev);
      addTab(str, cmp);
      setSelectedIndex(getTabCount()-1);
    }else if(prev>next) {
      //System.out.println("   >: press="+prev+" next="+next);
      remove(prev);
      insertTab(str, null, cmp, null, next);
      setSelectedIndex(next);
    }else{
      //System.out.println("   <: press="+prev+" next="+next);
      remove(prev);
      insertTab(str, null, cmp, null, next-1);
      setSelectedIndex(next-1);
    }
  }

  private void initTargetLeftRightLine(int next) {
    if(next<0 || dragTabIndex==next || next-dragTabIndex==1) {
      lineRect.setRect(0,0,0,0);
    }else if(next==getTabCount()) {
      Rectangle rect = getBoundsAt(getTabCount()-1);
      lineRect.setRect(rect.x+rect.width-LINEWIDTH/2,rect.y,LINEWIDTH,rect.height);
    }else if(next==0) {
      Rectangle rect = getBoundsAt(0);
      lineRect.setRect(-LINEWIDTH/2,rect.y,LINEWIDTH,rect.height);
    }else{
      Rectangle rect = getBoundsAt(next-1);
      lineRect.setRect(rect.x+rect.width-LINEWIDTH/2,rect.y,LINEWIDTH,rect.height);
    }
  }
  private void initTargetTopBottomLine(int next) {
    if(next<0 || dragTabIndex==next || next-dragTabIndex==1) {
      lineRect.setRect(0,0,0,0);
    }else if(next==getTabCount()) {
      Rectangle rect = getBoundsAt(getTabCount()-1);
      lineRect.setRect(rect.x,rect.y+rect.height-LINEWIDTH/2,rect.width,LINEWIDTH);
    }else if(next==0) {
      Rectangle rect = getBoundsAt(0);
      lineRect.setRect(rect.x,-LINEWIDTH/2,rect.width,LINEWIDTH);
    }else{
      Rectangle rect = getBoundsAt(next-1);
      lineRect.setRect(rect.x,rect.y+rect.height-LINEWIDTH/2,rect.width,LINEWIDTH);
    }
  }

  private void initGlassPane(Component c, Point tabPt) {
    //Point p = (Point) pt.clone();
    getRootPane().setGlassPane(glassPane);
    if(hasGhost()) {
      Rectangle rect = getBoundsAt(dragTabIndex);
      BufferedImage image = new BufferedImage(c.getWidth(), c.getHeight(), BufferedImage.TYPE_INT_ARGB);
      Graphics g = image.getGraphics();
      c.paint(g);
      image = image.getSubimage(rect.x,rect.y,rect.width,rect.height);
      glassPane.setImage(image);
    }
    Point glassPt = SwingUtilities.convertPoint(c, tabPt, glassPane);
    glassPane.setPoint(glassPt);
    glassPane.setVisible(true);
  }

  private Rectangle getTabAreaBound() {
    Rectangle lastTab  = getUI().getTabBounds(this, getTabCount()-1);
    return new Rectangle(0,0,getWidth(),lastTab.y+lastTab.height);
  }

  public void paintComponent(Graphics g) {
    super.paintComponent(g);
    if(dragTabIndex>=0) {
      Graphics2D g2 = (Graphics2D)g;
      g2.setPaint(lineColor);
      g2.fill(lineRect);
    }
  }
}

class GhostGlassPane extends JPanel {
  private final AlphaComposite composite;
  private Point location = new Point(0, 0);
  private BufferedImage draggingGhost = null;
  public GhostGlassPane() {
    setOpaque(false);
    composite = AlphaComposite.getInstance(AlphaComposite.SRC_OVER, 0.5f);
  }
  public void setImage(BufferedImage draggingGhost) {
    this.draggingGhost = draggingGhost;
  }
  public void setPoint(Point location) {
    this.location = location;
  }
  public void paintComponent(Graphics g) {
    if(draggingGhost == null) return;
    Graphics2D g2 = (Graphics2D) g;
    g2.setComposite(composite);
    double xx = location.getX() - (draggingGhost.getWidth(this) /2d);
    double yy = location.getY() - (draggingGhost.getHeight(this)/2d);
    g2.drawImage(draggingGhost, (int)xx, (int)yy , null);
  }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-12-22T21:38:34.760

@Tony：看起来[Euguenes 解决方案](https://stackoverflow.com/a/61982/1112480)只是忽略了在交换期间保留 TabComponents。

convertTab 方法只需要记住 TabComponent 并将其设置为它创建的新选项卡。

尝试使用这个：

```
 private void convertTab(TabTransferData a_data, int a_targetIndex) {

            DnDTabbedPane source = a_data.getTabbedPane();
            System.out.println("this=source? " + (this == source));
            int sourceIndex = a_data.getTabIndex();
            if (sourceIndex < 0) {
                    return;
            } // if
            //Save the tab's component, title, and TabComponent.
            Component cmp = source.getComponentAt(sourceIndex);
            String str = source.getTitleAt(sourceIndex);
            Component tcmp = source.getTabComponentAt(sourceIndex);

            if (this != source) {
                    source.remove(sourceIndex);

                    if (a_targetIndex == getTabCount()) {
                            addTab(str, cmp);
                            setTabComponentAt(getTabCount()-1, tcmp);
                    } else {
                            if (a_targetIndex < 0) {
                                    a_targetIndex = 0;
                            } // if

                            insertTab(str, null, cmp, null, a_targetIndex);
                            setTabComponentAt(a_targetIndex, tcmp);
                    } // if

                    setSelectedComponent(cmp);
                    return;
            } // if
            if (a_targetIndex < 0 || sourceIndex == a_targetIndex) {
                    return;
            } // if
            if (a_targetIndex == getTabCount()) {    
                    source.remove(sourceIndex);
                    addTab(str, cmp);
                    setTabComponentAt(getTabCount() - 1, tcmp);
                    setSelectedIndex(getTabCount() - 1);
            } else if (sourceIndex > a_targetIndex) {
                    source.remove(sourceIndex);
                    insertTab(str, null, cmp, null, a_targetIndex);
                    setTabComponentAt(a_targetIndex, tcmp);
                    setSelectedIndex(a_targetIndex);
            } else {
                    source.remove(sourceIndex);
                    insertTab(str, null, cmp, null, a_targetIndex - 1);
                    setTabComponentAt(a_targetIndex - 1, tcmp);
                    setSelectedIndex(a_targetIndex - 1);
            }

    } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-12-06T21:11:17.630

将此添加到 isDragAcceptable 以避免异常：

```
boolean transferDataFlavorFound = false;
for (DataFlavor transferDataFlavor : t.getTransferDataFlavors()) {
    if (FLAVOR.equals(transferDataFlavor)) {
        transferDataFlavorFound = true;
        break;
    }
}
if (transferDataFlavorFound == false) {
    return false;
} 
```

# plugins - 编写 Safari 4 扩展的最佳方法

> ID：60271
> 
> 赞同：13
> 
> 时间：2008-09-13T02:30:32.493
> 
> 标签：plugins, safari

编写 Safari 扩展的最佳方式是什么？我已经为 Firefox 编写了几个 XUL 扩展，现在我想为 Safari 编写它们的版本。有没有一种方法可以让您向浏览器 UI 添加按钮或表单，因为输入管理器或服务菜单无法做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-13T03:33:03.140

Safari 插件开发并非易事。该接口是用 Objective-C 编写的，其中大部分甚至不是 WebKit 的一部分（因此您看不到源代码），但是有一些机制可以检查和修补正在运行的应用程序的对象层次结构。它需要了解 Cocoa 和 Objective-C，但不能更低。

[这是我在流程http://livingcode.org/2006/tab-dumping-in-safari](http://livingcode.org/2006/tab-dumping-in-safari)的书签中的高级概述。它使用 Python 和工作（可能过时的）代码来创建 Safari 插件。您可以使用任何具有 Objective-C 绑定的东西来代替 Python。

它有两个主要部分：

*   您需要将代码附加到正在运行的 Safari。这通常通过 SIMBL [http://www.culer.net/software/SIMBL/SIMBL.php](http://www.culater.net/software/SIMBL/SIMBL.php)完成。

*   进入内部后，您需要弄清楚要修补什么。有一个关于逆向 Cocoa 应用程序的教程[http://www.culater.net/wiki/moin.cgi/CocoaReverseEngineering](http://www.culater.net/wiki/moin.cgi/CocoaReverseEngineering)，它链接到最重要的工具，类转储[http://www.codethecode.com/projects/class- dump/](http://www.codethecode.com/projects/class-dump/)（wiki 上的链接已损坏）。Class-dump 为您提供了 Safari 类的完整层次结构，您可以在其中通过名称猜测您需要修补的具体内容。这是一种非常试错的模式。

阅读上面的链接将为您提供项目的范围。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-06-08T00:45:19.440

最近情况发生了变化。Apple 现在提供扩展 API 作为 Safari 5 的一部分。您可以在[Apple 的网站](http://www.apple.com/safari/whats-new.html)上找到更多信息并[加入 Safari 开发者计划](http://developer.apple.com/programs/safari/)。

Safari 的扩展必须经过数字签名，但您可以从 Apple 免费获得签名证书。这是让您的扩展程序进入 Safari 的合法方式，而无需求助于每次 Apple 更新 Safari 时可能会破坏的黑客行为。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-06-08T13:38:34.923

随着 Safari 5.0 的发布，Apple 发布了一个新的扩展框架供开发人员使用。在功能上，它看起来类似于 Firefox 扩展框架，允许使用 javascript 和 html 5 自定义按钮、工具栏、上下文菜单、注入

更多在这个链接

[https://developer.apple.com/documentation/safariextensions](https://developer.apple.com/documentation/safariextensions)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-08-10T19:24:37.153

似乎没有人提到 Safari 确实支持真正的插件这一事实，而输入管理器黑客绝对不是。

> **《WebKit 插件编程主题》** [http://developer.apple.com/documentation/InternetWeb/Conceptual/WebKit_PluginProgTopic/](http://developer.apple.com/documentation/InternetWeb/Conceptual/WebKit_PluginProgTopic/)

这就是对 PDF 和 Flash 内容的支持之类的实现方式。查看您的`/Library/Internet Plug-ins/`目录以查看示例。

当然，存在固有的局限性，就 UI 修改而言，您可能无法完成您希望的工作。Safari 插件不能完成 Input Manager 破解的所有事情，但它们可以在任何地方的 WebKit 以及未来版本的操作系统中工作。**注意：** Snow Leopard 上的 Safari 默认为 64 位，因此没有输入管理器工作。我已经错过了[Safari AdBlock](http://safariadblock.sourceforge.net/) ... :-( 我很想看到它被重写为一个真正的插件。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-13T08:05:30.690

> 有没有一种方法可以让您向浏览器 UI 添加按钮或表单，因为输入管理器或服务菜单无法做到这一点？

实际上，使用 InputManager，这*是*可能的。SIMBL 是 Safari 扩展的常用技术，它只是 InputManagers 的一个包装器——它代表**S** mart **I** nput **Manager** **B** undle **L** oder 。您可以将内容添加到菜单栏、工具栏、对话框以及任何地方，只需扩展 Safari 现有的类即可。

 ****也就是说，为 Safari 编写扩展不仅像 æon 所说的那样重要，而且完全不受支持。有一些比较流行的，比如 Inquisitor（最近被 Yahoo! 收购）和 Google 的 Gears，但在大多数情况下，它与 Firefox 的扩展非常不同，Firefox 的扩展是一种官方支持、广泛使用的技术。

您肯定还需要考虑到[Leopard 上 InputManagers 的特殊限制](https://stackoverflow.com/questions/30966/inputmanager-on-os-x)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-11T23:17:14.520

另外，需要注意的是，Apple 已经声明 InputManagers 从 Leopard 开始受到严格限制，并且不会在 Apple [Leopard Release Notes](http://developer.apple.com/releasenotes/Cocoa/AppKit.html#NSInputManager)的 64 位应用程序中运行。考虑到大多数应用程序在 Snow Leopard 中都是 64 位的（可能包括 Safari），这一点尤其有趣。Apple 肯定会尝试将 InputManager 作为一种向量来覆盖和扩展功能。Safari 迫切需要一种扩展机制。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-09T15:51:45.330

Safari 扩展不需要经过苹果的批准。你只需要一个开发者证书（免费）来制作它们，但你可以传递它们，虽然 Apple 正在制作扩展库，但你不必通过那里分发它。正如您所看到的，您今天已经可以尝试很多扩展。证书只是确保它没有被篡改。

[http://safariextensions.tumblr.com/](http://safariextensions.tumblr.com/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-10T11:38:59.187

如果您想查看现有扩展以​​了解其完成方式，请下载它或从您的 Safari 扩展文件夹中获取它，然后将 .safariextz 更改为 .xar，然后使用 Pacifist 打开/提取以查看代码，如果您想将其添加到扩展生成器应用程序。

# math - 有哪些好的刚体动力学参考资料？

> ID：60274
> 
> 赞同：6
> 
> 时间：2008-09-13T02:37:13.383
> 
> 标签：math, physics

我至少不是一个数学专家，但我对学习刚体物理很感兴趣（为了实现一个基本的 3d 物理引擎）。在学校我只通过代数 II 学习数学，但我已经做了多年的 3d 开发，所以我对向量、四元数、矩阵等有相当不错的理解。我真正的问题是阅读复杂的公式等，所以我正在寻找对于一些体面的刚体动力学参考，这将是有意义的。

谁有好的参考资料？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-13T02:40:58.100

[我认为面向游戏程序员的](https://rads.stackoverflow.com/amzn/click/com/159059472X)[物理学比面向游戏开发者](https://rads.stackoverflow.com/amzn/click/com/0596000065)的物理学要好。

如果你想在你的书架上放一些厚实的东西（就像我一样），Eberly 的[3D 游戏引擎设计](https://rads.stackoverflow.com/amzn/click/com/0122290631)和 Erleben 的[基于物理的动画](https://rads.stackoverflow.com/amzn/click/com/1584503807)可以伴随上述内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T03:18:37.057

[Chris Hecker](http://chrishecker.com/Rigid_Body_Dynamics)在他的网站上有一组很好的文章，这些文章最初发表在 Game Developer Magazine 上。他们从 2D 物理开始，然后发展到 3D。

[David Baraff 的基于物理的建模](http://www.cs.cmu.edu/~baraff/sigcourse/)也不错，但在数学上有点重。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T02:46:58.430

我想您正在寻找的是经典力学，它以广义的方式描述了一维、二维和三个维度的运动。

我在[德克萨斯大学找到了一门很好的古典力学入门课程](http://farside.ph.utexas.edu/teaching/301/301.html)。

我不保证你能理解那里的所有概念，但它至少会给你一个计划的基础。我建议你咨询物理学教授来帮助你理解数学。

祝你好运！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-04T22:21:53.123

如果您已经熟悉（并且习惯）

*   线性代数
*   基础微积分
*   牛顿运动定律

那么[6DoF 刚体动力学](http://www.museful.net/2011/system-modelling/6dof-rigid-body-dynamics)就是您要寻找的。这是一篇简短的文章 [免责声明：由我撰写]，当时我不得不开发直升机飞行模拟器。

[使用旋转矩阵可以实现极其简单的建模方程，但如果您出于其他原因更喜欢该表示，](http://www.museful.net/2011/system-modelling/expressing-3dof-rotation)则存在与四元数之间的简单映射。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T16:58:48.190

尽量不要让你沮丧地扯掉你的头发（好吧，Baraff/Witkin 的多维矩阵的优秀数学文章有时会这样做），你可以查看更简单的在线文章，例如在 Gamasutra 上发表的文章。这是其中的两个：

1.  [http://www.gamasutra.com/resource_guide/20030121/kennedy_pfv.htm](http://www.gamasutra.com/resource_guide/20030121/kennedy_pfv.htm)
2.  [http://www.gamasutra.com/features/19990702/data_structures_01.htm](http://www.gamasutra.com/features/19990702/data_structures_01.htm)
3.  [http://www.gamasutra.com/resource_guide/20030121/jacobson_pfv.htm](http://www.gamasutra.com/resource_guide/20030121/jacobson_pfv.htm)

您会注意到他们将提到的资源作为参考的一部分。我要补充一点，除非您需要求解多个粒子、关节字符或非刚性复杂对象的方程组，否则这可能就足够了。

但是，如果您确实在寻找涉及矩阵和方程系统的更高级的物理和数学，请查看 Witkin 和 Baraff 的主页（如果我没记错的话，我认为它们都在 Pixar 中），或者从 Hecker 开始（尝试了不止几种实用的方法并记录了他的结果）。

# git - Git commit 打开空白文本文件，为什么？

> ID：60278
> 
> 赞同：95
> 
> 时间：2008-09-13T02:48:40.750
> 
> 标签：git, git-commit

在我读过的所有 Git 教程中，他们说你可以这样做：

```
git init
git add .
git commit 
```

当我这样做时，我会打开一个大文本文件。没有任何教程似乎解决了这个问题，所以我不知道如何处理该文件或在其中放入什么（如果有的话）。

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-02-10T12:21:55.797

您应该将提交消息放入此文本文件中，然后保存并退出。

您可以使用以下命令更改 git 使用的默认文本编辑器：

```
git config --global core.editor "nano" 
```

您必须将 nano 更改为通常会打开您的文本编辑器的任何命令。

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2008-09-13T03:44:02.287

正如[Ben Collins](https://stackoverflow.com/questions/60278/git-commit-text-file#60283)所提到的，如果没有`-m "..."`输入内联提交的参数（这通常是一个坏主意，因为它鼓励您保持简短），打开的这个“大文本文件”是一个输入提交消息的窗口.

通常建议在第一行写一个摘要，跳过一行，然后在下面写更详细的注释；这有助于执行诸如通过电子邮件发送带有适当主题行的提交消息和在正文中所做更改的完整列表的程序。

除了更改`EDITOR`shell 变量，您还可以通过在`~/.gitconfig`文件中添加附加行来更改使用的编辑器：

```
[core]
    editor = emacs
    excludesfile = /Users/will/.gitignore 
```

第二行实际上与您的问题无关，但我发现它非常有用，因此我可以使用我*知道*我永远不会想要提交到存储库`~/.gitignore`的所有文件类型填充我的文件。

 ** * *

## 回答 #3

> 赞同：36
> 
> 时间：2008-09-13T03:00:52.450

正在打开的文本文件是当前提交操作的摘要。git commit 会将您放入此文件，因此您可以在文件顶部添加提交消息。添加消息后，只需保存并退出此文件即可。

此命令上还有一个“-m msg”开关，允许您在命令行上添加提交消息。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-09-06T08:54:44.533

如果您在 Mac OS X 上并使用 BBEdit，则可以将其设置为提交消息的首选编辑器：

```
git config --global core.editor "bbedit -w" 
```

完成编辑后，保存并关闭文件，git 会将其用于注释。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2011-04-21T17:24:31.997

假设您的编辑器默认为 vi/vim，您可以通过键入以下内容退出提交消息编辑器：

```
:x 
```

这将保存并退出提交消息文件。然后你会回到正常的 git 命令部分。

*更多 vi 命令：
[http ://www.lagmonster.org/docs/vi.html](http://www.lagmonster.org/docs/vi.html)*

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-01-21T20:20:31.090

正如所有人所说，这只是您添加提交评论的地方 - 但对于某些人来说，如果您没有配置编辑器设置，并且您不知道[VI](http://en.wikipedia.org/wiki/Vi)是什么，它可能仍然令人困惑：那么您可能会感到震惊, 因为你会认为你还在 GIT-Bash

在这种情况下，你实际上是在一个文本编辑器中，有一些有趣的处理方式，[这组命令](http://www.tuxfiles.org/linuxhelp/vimcheat.html)可能会帮助你，这样你就可以通过你的第一次提交，然后配置一个你熟悉的编辑器或将其用作一个学习如何使用它的机会。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-09-13T02:58:36.357

`-m`提交选项允许您在命令行上输入提交消息：

```
git commit -m "my first commit" 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-03-20T17:28:13.067

当你创建一个新的提交时，git 会启动一个文本编辑器并将一些内容写入其中。

**使用此文本编辑器的目的是让您编写将与您刚刚创建的提交相关联的提交消息。**

**完成此操作后，保存并退出文本编辑器。Git 将使用您编写的内容作为提交消息。**

提交消息具有特定的结构，描述如下：

提交消息的第一行用作消息头（或标题）。提交标头的首选长度小于 40 个字符，因为这是 github 在截断之前在给定存储库的 Commits 选项卡上显示的字符数，有些人觉得这很烦人。

在撰写标题时，第一个单词使用大写的现在时动词是常见的做法，但根本不需要。

一个换行符描述了消息的标题和正文。

身体可以由你喜欢的任何东西组成。您的提交引入的更改的概述是合理的。一些第三方应用程序使用包含提交消息正文的信息来触发各种钩子（我在想 Gerrit 和 Pivotal Tracker，仅举两个例子）。

这是一个简短而甜蜜的例子。前导`#`表示注释。

```
Gitignore index.pyc

Ignore gunicorn generated binary file
# Please enter the commit message for your changes. Lines starting
# with '#' will be ignored, and an empty message aborts the commit.
# On branch dev
# Your branch is ahead of 'origin/dev' by 10 commits.
#   (use "git push" to publish your local commits)
#
# Changes to be committed:
#   (use "git reset HEAD <file>..." to unstage)
#
#   modified:   .gitignore
# 
```

[在这里](https://gist.github.com/matthewhudson/1475276)，一位 Torvalds 先生就什么是好的承诺发表了看法。

[在这里，](http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html) Tpope也是如此。

如其他几个答案所述，更改默认编辑器是命令行上的单行代码。

根据我的喜好：

```
git config --global core.editor "vim" 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-09-23T06:53:48.100

输入完信息后，尝试 Escape 然后 ZZ。正如其他人所说，当您运行该提交命令时，它实际上会运行一个文本编辑器来输入消息。在我的情况下（OS X），它是 VI，我经过一番挖掘后发现了它。在这种情况下，点击 Escape 进入“命令”模式（与 INSERT 模式相反），然后输入 ZZ。我敢肯定还有其他方法可以完成这项任务，但这对我来说是可行的。从未使用过 VI 或 emacs，这对我来说并不明显，并且在我使用的任何初学者指南中都没有提及。希望这会有所帮助。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-13T02:56:32.477

该`git commit`命令将打开`EDITOR`环境变量中指定的编辑器，以便您输入提交注释。在 Linux 或 BSD 系统上，默认情况下应该是 vi，尽管任何编辑器都可以工作。

只需输入您的评论并保存文件。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-06-07T09:00:36.243

我很困惑，因为我一直试图在 VIM 中的 :w 之后输入文件名。这不会触发提交。相反，我不断收到一条消息“由于提交消息为空而中止提交”。不要在 :w 后面加上文件名。:w 默认将文件保存到 .git/COMMIT_EDITMSG。然后 :q 退出以完成提交。您可以使用 git log 查看结果。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-01-11T13:25:38.903

现在我已将编辑器更改为 emacs，一切正常。

但在我设置这个之前，“git commit -a”确实打开了gedit，但也立即以“由于空提交消息而中止提交”结束。从 gedit 保存文件没有效果。使用“git config --global core.editor "gedit"" 显式设置编辑器具有相同的结果。

emacs 没有任何问题，但出于好奇，为什么这不适用于 gedit，有没有办法让它工作？

谢谢。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-04-07T02:11:34.940

对于那些使用 OS XI 的人来说，这个命令运行良好：
`git config --global core.editor "open -t -W"`

这将强制 git 打开默认的文本编辑器（在我的情况下为 textedit），然后等待您退出应用程序。请记住，在提交通过之前，您需要“保存”然后“退出”文本编辑。您可以使用其他一些命令，如本页所述：

[Apple 开发者库 - 打开命令](http://developer.apple.com/library/mac/#documentation/Darwin/Reference/ManPages/man1/open.1.html "Apple 开发者库 - 打开命令")

`git config --global core.editor "open -e -W"`如果您希望 git 始终打开 textedit 而不管默认编辑器是什么，您也可以尝试。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-13T03:11:33.033

在进行修订控制时，您应该始终解释您所做的更改是什么。通常在您第一次收到诸如“Initial Commit”之类的评论时。

但是从长远来看，您希望对每次提交都做出良好的评论。您将需要以下形式的东西：

> 添加了实验功能 x。
> 
> X 将在条件 Z 中提高功能 Y 的性能。如果您需要 X 使用 -x 或 --feature-eks 开关激活它。这解决了功能请求 #1138。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-13T04:09:18.200

是的，确保你有一个合理的编辑器集。不确定你的默认编辑器是什么，但如果像我一样`nano`（在你输入 commit 后它会在顶部附近的某个地方这么说）你只需要输入评论然后点击`Ctrl`-`X`即可完成。然后点击`y`，然后`enter`确认提交。

此外，如果您想查看您将提交的文件的简单列表，而不是事先尝试巨大的差异列表

```
git diff --name-only 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-10-21T01:19:47.773

作为终端的新手，“Escape and then ZZ”对我有用，我已经有这个问题好几个月了，也找不到解决方法。

感谢 TheGeoff 的简单建议！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-07-03T03:37:35.193

以下可能是提交所有更改的最简单方法：

```
git commit -a -m "Type your commit message here..." 
```

当然，还有更详细的提交方式，但这应该可以帮助您入门。

# database - 如果可能的话，如何嵌入 PostgreSQL？

> ID：60285
> 
> 赞同：38
> 
> 时间：2008-09-13T02:59:22.657
> 
> 标签：database, postgresql, embedded-database

如果可能的话，我有兴趣能够嵌入一个 PostgreSQL 数据库，类似于[sqllite](http://www.sqlite.org/)。我读过这是[不可能的](http://bytes.com/forum/thread647637.html)。我不是数据库专家，所以我想听听你的意见。

本质上我想要 PostgreSQL 没有所有的配置和安装。如果可能的话，告诉我怎么做。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-13T03:26:14.043

你不能嵌入它，你也不应该尝试。

对于嵌入，您应该使用您提到的[sqlite或](http://www.sqlite.org/)[firebird rdbms](http://www.firebirdsql.org/)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-11-20T20:18:14.003

在后台进程中运行 postgresql。

在您的应用程序中启动一个单独的线程，该线程将以本地模式启动 postgresql 服务器，方法是使用一些随机空闲端口将其绑定到 localhost 或使用套接字（Windows 是否支持套接字？）。这应该相当容易，例如：

system("C:\Program Files\MyApplication\pgsql\postgres.exe -DC:\Documents and Settings\User\Local Settings\MyApplication\database -h 127.0.0.1 -p 12345");

然后只需连接到 127.0.0.1:12345。

当您的应用程序退出时，您可以随时向您的线程发送一个 SIGTERM，然后等待几秒钟让 postgresql 退出（即加入线程）。

PS：您也可以使用[pg_ctl](http://www.postgresql.org/docs/8.4/static/app-pg-ctl.html)来控制您的“嵌入式”数据库，即使没有线程，只需在启动应用程序时执行“pg_ctl start”（使用适当的选项）并在退出时执行“pg_ctl stop”。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-13T06:06:24.800

除非您对代码进行重大重写，否则不可能“嵌入”运行 Postgres。要么将其作为单独的进程运行，要么使用其他东西。SQLite 是一个很好的选择。但还有其他人。MySQL 有一个嵌入式版本。[在http://mysql.com/oem/](http://mysql.com/oem/)上查看。还有几个 java 选择，Mac 也有你可以编写的 Core Data。见鬼，你甚至可以使用 FoxPro。你在什么操作系统上，你需要数据库提供什么服务？

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-22T05:38:06.793

[您不能将其嵌入为像 sqlite 等这样的进程类型的东西，但您可以使用http://www.innosetup.org](http://www.innosetup.org)上的 Inno setup 轻松将其嵌入到您的应用程序设置中。搜索他们的邮件列表存档，您会发现有人为您完成了大部分工作，您所要做的就是获取压缩的发行版，当用户安装您的应用程序时，您可以轻松安装 postgresql。然后，您可以使用 pg_hba.conf 文件将服务器限制为仅本地主机。不是真正的嵌入式数据库，但它会工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T03:22:45.113

PostgreSQL 旨在作为独立服务器运行；如果你努力破解它并且足够长的时间，它可能会嵌入它，但是在单独的进程中按预期运行它会容易得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-01-13T14:26:08.817

HSQLDB (http://hsqldb.org/) 是另一个易于嵌入的数据库。需要 Java，但对于 Java 应用程序来说是一个优秀且经常使用的选择。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T15:06:50.077

任何人在 Mac OS X 上尝试过：

[http://pagesperso-orange.fr/bruno.gaufier/xhtml/prod_postgresql.xhtml](http://pagesperso-orange.fr/bruno.gaufier/xhtml/prod_postgresql.xhtml)

[http://www.macosxguru.net/article.php?story=20041119135924825](http://www.macosxguru.net/article.php?story=20041119135924825)

（当然 sqlite 也是我选择的嵌入式数据库）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-10-06T22:31:59.500

好吧，我知道这是一个非常非常非常古老的帖子，但是如果现在有人有这个问题，我会参考：

*   您可以使用运行 Postgres 的容器。这是一篇可能会有所帮助的帖子，使用以下方法做一些事情`R`： [https ://rsangole.netlify.app/post/2021/08/07/docker-based-rstudio-postgres/?utm_source=pocket_mylist](https://rsangole.netlify.app/post/2021/08/07/docker-based-rstudio-postgres/?utm_source=pocket_mylist)
*   看看`duckdb` [https://duckdb.org/docs/installation/](https://duckdb.org/docs/installation/)比较新，还需要成熟。但它的工作原理非常类似于嵌入式数据库（“进程内、无服务器”），具有多种语言（Python、R、Java 等）的绑定

# html - 我可以在没有第二张图像的情况下在悬停期间更改 html 图像的外观吗？

> ID：60290
> 
> 赞同：4
> 
> 时间：2008-09-13T03:10:18.403
> 
> 标签：html, css, image

当我悬停光标时，有没有办法改变图标的​​外观（即对比度/亮度），而不需要第二个图像文件（或不需要图像的隐藏部分）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-13T03:17:12.647

[这里有一些关于使用 CSS 的图像不透明度和透明度的好信息](http://www.w3schools.com/css/css_image_transparency.asp)。

因此，要制作不透明度为 50% 的图像，您可以这样做：

```
<img src="image.png" style="opacity: 0.5; filter: alpha(opacity=50)" /> 
```

**opacity:**部分是 Firefox的处理方式，它是一个介于 0.0 和 1.0 之间的值。**filter:**是 IE 怎么做的，它是一个从 0 到 100 的值。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-13T03:55:24.537

您不使用 img 标签，而是使用具有 background-image css 属性的元素并在悬停时设置背景位置。IE 需要一个 'a' 标签作为 :hover 选择器的父元素。它们被称为 css sprites。

[一篇很棒的文章，解释了如何使用 CSS sprites](http://www.alistapart.com/articles/sprites/)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-13T04:12:31.233

这是一些可以玩的代码。基本思路：把图片所有可能的状态放到一张大图里，设置一个比图片小的“窗口大小”；使用 移动窗口`background-position`。

```
#test {
  display: block;
  width: 250px;  /* window */
  height: 337px; /*  size  */
  background: url(http://vi.sualize.us/thumbs/08/09/01/fashion,indie,inspiration,portrait-f825c152cc04c3dbbb6a38174a32a00f_h.jpg) no-repeat; /* put the image */
  border: 1px solid red; /* for debugging */
  text-indent: -1000px; /* hide the text */
}

#test:hover {
  background-position: -250px 0; /* on mouse over move the window to a different part of the image */
}
```

```
<a href="#" id="test">a button</a>
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T03:13:56.023

我通常使用较小的图像（例如按钮）完成操作的方式是只显示图像的特定部分。然后图片的许多状态将组成一个更大的图片，该图片在可见端口后面移动。当有人有代码时，我会删除它。

# c# - Listview背景绘制问题 C# Winform

> ID：60293
> 
> 赞同：3
> 
> 时间：2008-09-13T03:12:48.290
> 
> 标签：c#, winforms, listview

我对 Listview 有一点问题。

我可以很好地使用 listview 项目加载它，但是当我设置背景颜色时，它不会一直将颜色绘制到行的左侧 [ListViewItems 加载了 ListViewSubItems 以制作网格视图，只有第一列显示错误]。有一条不涂漆的窄条。如果我有一个行标题，该条的宽度与行标题的宽度大致相同。

如果您对可以做些什么来绘制背景图有想法，我很想听听。

现在只是为了尝试一个新想法，我为第一个解决方案提供 10 票赏金，该解决方案仍然让我使用这种糟糕的伪网格视图结构。[我喜欢遗留代码。]

**编辑：**

这是一个展示问题的示例。

```
public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();

        ListView lv = new ListView();

        lv.Dock = System.Windows.Forms.DockStyle.Fill;
        lv.FullRowSelect = true;
        lv.GridLines = true;
        lv.HideSelection = false;
        lv.Location = new System.Drawing.Point(0, 0);
        lv.TabIndex = 0;
        lv.View = System.Windows.Forms.View.Details;
        lv.AllowColumnReorder = true;

        this.Controls.Add(lv);

        lv.MultiSelect = true;

        ColumnHeader ch = new ColumnHeader();
        ch.Name = "Foo";
        ch.Text = "Foo";
        ch.Width = 40;
        ch.TextAlign = HorizontalAlignment.Left;

        lv.Columns.Add(ch);

        ColumnHeader ch2 = new ColumnHeader();
        ch.Name = "Bar";
        ch.Text = "Bar";
        ch.Width = 40;
        ch.TextAlign = HorizontalAlignment.Left;

        lv.Columns.Add(ch2);

        lv.BeginUpdate();

        for (int i = 0; i < 3; i++)
        {

            ListViewItem lvi = new ListViewItem("1", "2");

            lvi.BackColor = Color.Black;
            lvi.ForeColor = Color.White;

            lv.Items.Add(lvi);
        }
        lv.EndUpdate();
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T05:10:44.073

啊! 我现在明白了 ：}

你想要hacky吗？我向您介绍以下内容：

```
 ...
    lv.OwnerDraw = true;
    lv.DrawItem += new DrawListViewItemEventHandler( lv_DrawItem );
    ...

void lv_DrawItem( object sender, DrawListViewItemEventArgs e )
{
    Rectangle foo = e.Bounds;
    foo.Offset( -10, 0 );
    e.Graphics.FillRectangle( new SolidBrush( e.Item.BackColor ), foo );
    e.DrawDefault = true;
} 
```

要获得更具创造性且不那么老套的方法，您可以尝试利用 ListView 的背景图像；）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T03:25:05.263

（在编辑之前...）

我刚刚尝试在 System.Windows.Forms.ListView 上设置 BackColor，并且颜色可以很好地应用于控件（有和没有图像）。

你在做任何定制绘画吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T04:36:20.630

好的，我正在添加一些额外的解决方案说明。如果您使用上面的解决方案，您还需要为列标题插入一个绘制处理程序，否则它们不会绘制。选定的项目矩形看起来也很有趣，因此您需要在 lv_DrawItem 函数中检查它并实现类似的解决方案。请记住，突出显示是在系统级别而不是在您的应用程序中选择的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-22T23:09:36.257

[Better ListView](http://www.componentowl.com/better-listview)（和免费[的 Better ListView Express](http://www.componentowl.com/better-listview-express)）允许使用各种对齐设置（居中、平铺、拉伸、适合、对齐边框/角）设置背景图像。还支持 Alpha 透明度：

![在此处输入图像描述](https://i.stack.imgur.com/OZicy.png)

# java - Starting a process with inherited stdin/stdout/stderr in Java 6

> ID：60302
> 
> 赞同：28
> 
> 时间：2008-09-13T03:27:59.720
> 
> 标签：java, io, process, pipe

If I start a process via Java's [ProcessBuilder](http://java.sun.com/javase/6/docs/api/java/lang/ProcessBuilder.html) class, I have full access to that process's standard in, standard out, and standard error streams as Java `InputStreams` and `OutputStreams`. However, I can't find a way to seamlessly connect those streams to `System.in`, `System.out`, and `System.err`.

It's possible to use `redirectErrorStream()` to get a single `InputStream` that contains the subprocess's standard out and standard error, and just loop through that and send it through my standard out—but I can't find a way to do that and let the user type into the process, as he or she could if I used the C `system()` call.

This appears to be possible in Java SE 7 when it comes out—I'm just wondering if there's a workaround now. Bonus points if the result of [`isatty()`](http://www.opengroup.org/onlinepubs/009695399/functions/isatty.html) in the child process carries through the redirection.

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-13T14:51:41.387

You will need to copy the [Process](http://java.sun.com/javase/6/docs/api/java/lang/Process.html) out, err, and input streams to the System versions. The easiest way to do that is using the [IOUtils](http://commons.apache.org/io/api-release/org/apache/commons/io/IOUtils.html) class from the Commons IO package. The [copy method](http://commons.apache.org/io/api-release/org/apache/commons/io/IOUtils.html#copy%28java.io.InputStream,%20java.io.OutputStream%29) looks to be what you need. The copy method invocations will need to be in separate threads.

Here is the basic code:

```
// Assume you already have a processBuilder all configured and ready to go
final Process process = processBuilder.start();
new Thread(new Runnable() {public void run() {
  IOUtils.copy(process.getOutputStream(), System.out);
} } ).start();
new Thread(new Runnable() {public void run() {
  IOUtils.copy(process.getErrorStream(), System.err);
} } ).start();
new Thread(new Runnable() {public void run() {
  IOUtils.copy(System.in, process.getInputStream());
} } ).start(); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-10-15T04:25:18.363

A variation on John's answer that compiles and doesn't require you to use Commons IO:

```
private static void pipeOutput(Process process) {
    pipe(process.getErrorStream(), System.err);
    pipe(process.getInputStream(), System.out);
}

private static void pipe(final InputStream src, final PrintStream dest) {
    new Thread(new Runnable() {
        public void run() {
            try {
                byte[] buffer = new byte[1024];
                for (int n = 0; n != -1; n = src.read(buffer)) {
                    dest.write(buffer, 0, n);
                }
            } catch (IOException e) { // just exit
            }
        }
    }).start();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-06-10T08:19:32.010

For `System.in` use the following `pipein()` instead of `pipe()`

```
pipein(System.in, p.getOutputStream()); 
```

Implementation:

```
private static void pipein(final InputStream src, final OutputStream dest) {

    new Thread(new Runnable() {
        public void run() {
            try {
               int ret = -1;
               while ((ret = System.in.read()) != -1) {
                  dest.write(ret);
                  dest.flush();
               }
            } catch (IOException e) { // just exit
            }
        }
    }).start();

} 
```

# tags - 标签云有什么功能？

> ID：60330
> 
> 赞同：5
> 
> 时间：2008-09-13T04:37:18.023
> 
> 标签：tags

我一直看到他们，总是忽略他们。有人可以向我解释为什么它们变得如此流行吗？如果我正在使用一个允许我通过标签（例如，这个、del.icio.us 等）探索它的网站，我会这样做。为什么我需要一个可以点击的标签“云”？我可以在搜索框中输入该标签。我错过了什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-13T04:46:01.187

它更多的是浏览辅助而不是搜索辅助。如果您在您感兴趣的标签云中看到一个大的或粗体的标签，我会发现一些知识发现，否则这些知识发现是通过刻意搜索无法找到的。当我浏览 del.ico.us 或 stackoverflow 时，我很欣赏这些标签，因为它们有时会引导我发现相关主题。

维基百科有一个有趣的[定义](http://en.wikipedia.org/wiki/Tag_cloud)：

> 标签云或词云（或视觉设计中的加权列表）是用户生成标签的视觉描述，或简称为网站的文字内容，通常用于描述网站的内容。标签通常是单个单词，通常按字母顺序列出，标签的重要性以字体大小或颜色显示。[1](http://en.wikipedia.org/wiki/Tag_cloud)因此，通过字母和流行度查找标签都是可能的。标签通常是指向与标签相关联的项目集合的超链接。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T04:42:04.580

这是一种简单的机制，可以确定哪些标签最受欢迎或该标签的填充程度（标签数量）。

它只是一个直观的界面，我相当肯定这就是它们如此受欢迎的更大原因之一，而且它们也是非常 Web 2.0 的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-13T05:29:13.623

> 为什么我需要一个可以点击的标签“云”？我可以在搜索框中输入该标签。我错过了什么？

你怎么知道哪些标签可以在没有大量试验和错误的情况下输入？即使您知道有哪些标签可用，如果没有更多的反复试验，您如何知道哪些标签最受欢迎？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-13T06:17:18.050

使标签云真正有用的东西（至少是实施良好的标签云 IMO）是能够越来越深入地钻研主题。

例如，我可以单击“主题 A”，然后我可以在“主题 A”项目中的所有标签的标签云中看到项目。然后我可以深入研究其中一个子主题并进一步缩小项目范围。

stackoverflow 标签云没有这样做（这太糟糕了），但如果这样做，我可以单击“visualstudio”之类的内容来钻取标记为 visualstudio 的线程，然后单击“asp.net”来钻取它，然后“ javascript”。最终结果将是标记所有三个“visualstudio”、“asp.net”和“javascript”的所有项目的列表。这就是标签云真正有用的地方。不幸的是，并非所有标签云都以这种方式工作（但 IMO 他们应该这样做）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T04:44:47.413

因为搜索php和查看所有者标记为php的所有帖子是不一样的。尝试一下。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-13T05:25:08.173

它可以帮助您了解您正在查看的页面或站点的焦点。讨论最多的话题是什么？我会在这里找到哪些信息？

如果您搜索与 Java 相关的内容并登陆两个站点，一个带有显示“Java”的标签云的站点很显眼，一个 Java 几乎不可见但“C#”很显眼，那么很容易快速确定哪个站点最有价值给你。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T05:09:07.650

标签提供了一种明确标记事物的方法，而不是依赖计算机来提取此信息。

例如，您可能对有关 stackoverflow 的问题感兴趣。如果您搜索“stackoverflow”，您将得到各种与 stackoverflow 无关的问题（例如，它们只包含“stackoverflow”这个词，因为有一些指向另一个问题的链接）。通过选择带有“stackoverflow”标签的问题，您只会获得人们明确识别为有关 stackoverflow 的那些帖子。

# c++ - C++ 测验 - 单例

> ID：60331
> 
> 赞同：-3
> 
> 时间：2008-09-13T04:40:37.860
> 
> 标签：c++, oop, design-patterns

我很快就会在[我的博客](http://theschmitzer.blogspot.com)上发布一篇文章，但我想先确认我没有错过任何内容。

找到一个我错过的例子，我会在我的帖子中引用你。

主题是失败的Singleton implementations：在什么情况下你会*不小心*得到一个singleton的多个实例？

到目前为止，我想出了：

*   第一次调用时的竞争条件`instance()`
*   并入多个 DLL 或 DLL 和可执行文件
*   单例的模板定义 - 实际上是单独的类

我还缺少任何其他方式——也许是继承？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T05:57:30.653

如果您使用在 cpp 文件中初始化的静态实例字段，如果某些静态/全局的初始化尝试获取单例的实例，您可以获得多个实例（甚至更糟糕的行为）。这是因为跨编译单元的静态初始化顺序是未定义的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T05:18:05.977

只要 ctor 是私有的，继承就不应该成为问题。

但是，如果您不禁止复制构造函数，用户可能会[无意]复制单例实例。[从boost::noncopyable](http://www.boost.org/doc/libs/1_36_0/libs/utility/utility.htm)私下继承是防止这种情况的最简单方法。

# python - distutils 可以创建空的 __init__.py 文件吗？

> ID：60352
> 
> 赞同：0
> 
> 时间：2008-09-13T05:51:17.097
> 
> 标签：python, version-control, distutils

如果我所有的`__init__.py`文件都是空的，我是否必须将它们存储到版本控制中，或者有没有办法在安装过程中`distutils`创建空`__init__.py`文件？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-13T09:19:56.330

在 Python 中，`__init__.py`文件实际上是有意义的！他们的意思是他们所在的文件夹是一个 Python 模块。因此，它们在您的代码中具有真正的作用，并且很可能应该存储在版本控制中。

您可以想象源代码树中的一个文件夹不是 Python 模块，例如一个仅包含资源（例如图像）而没有代码的文件夹。该文件夹不需要在其中包含`__init__.py`文件。现在，您如何区分 distutils 应该创建那些文件的文件夹和不应该创建这些文件的文件夹？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T12:46:50.657

您是否有理由*避免*将空`__init__.py`文件放入版本控制中？如果您这样做，您将无法`import`从源目录中获取您的包，而无需首先运行 distutils。

如果你真的想，我想你可以`__init__.py`在`setup.py`. 它必须*在*运行之前`distutils.setup`，所以`setup`它自己能够找到你的包：

```
from distutils import setup
import os

for path in [my_package_directories]:
    filename = os.path.join(pagh, '__init__.py')
    if not os.path.exists(filename):
        init = open(filename, 'w')
        init.close()

setup(
...
) 
```

`__init__.py`但是......与首先在那里有空文件相比，你会从中获得什么？

# jquery - 使用多个 AJAX 库的最佳策略是什么？

> ID：60360
> 
> 赞同：7
> 
> 时间：2008-09-13T06:14:52.237
> 
> 标签：jquery, ajax, yui, prototypejs, scriptaculous

您可以分享使用多个 AJAX 库的哪些经验？

Prototype 中有一些有用的功能，一些在 jQuery、Yahoo 库等中。是否可以包含所有库并使用您想要的每个库，它们通常都与名称空间等一起很好地发挥作用吗？为了速度要包含的库的大小/数量是否有实际限制，或者可以忽略不计？有没有特别好的配对（例如Prototype/Scriptaculous）或不适合的配对？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-15T05:14:40.053

你可以使用所有这些库，但我强烈建议不要这样做。下载和执行这么多 JavaScript 很可能会阻塞浏览器并降低用户体验。从用户和开发人员的角度来看，选择一个会更好。更少的上下文/架构切换和更少的代码维护。

就像其他答案所说的那样，大多数都不冲突。

有关详细信息，请参阅 Yahoo! 的[卓越性能](http://developer.yahoo.com/performance/)网站。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T18:13:32.553

您可以使用[Google AJAX Libraries API](http://code.google.com/apis/ajaxlibs/)。它为 jQuery、prototype、script.aculo.us、MooTools 和 dojo 提供了一个通用的分发网络和加载架构

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T05:04:47.490

YUI 具有很强的命名空间，因此不应与其他库发生冲突。

如前所述，您可以在无冲突模式下运行 jQuery。

Prototype在与其他库配合使用时*确实*存在一些问题，部分原因是它（或曾经）修改了核心对象，例如`Array`. [Protosafe](http://code.google.com/p/protosafe/)试图解决这些问题。

Script.aculo.us 只是一个位于 Prototype 之上的小部件库，因此这两者显然应该很好地结合在一起。

所有这一切意味着您*可以*在您的应用程序中使用 YUI、jQuery、Prototype 和 Script.aculo.us，但您可能会发现使用单个库可以更轻松地维护事物。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-13T09:25:28.813

我也是 jQuery 的信徒，所以请原谅我对其他人缺乏了解，但是......

使 jQuery 如此出色的是无冲突模式，例如，您可以这样做：

```
$('#foobar').whatever(); 
```

使用无冲突模式，您可以这样做：

```
var jq = jQuery.noConflict();
jq('#foobar').whatever(); 
```

少一件需要担心的事情。我想原型提供类似的功能，雅虎也是如此。

但无论如何，我不想过多地提倡 jQuery 并使人们发疯，但是无论您选择什么库，我认为它们几乎都可以完成您需要的所有事情。尤其要考虑不必学习三个不同库的***好处***。

三个人都应该有能力。选择你最喜欢的并扩展它。:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T07:21:01.140

我现在在项目中并排使用 jQuery 和仅 javascript 文件版本的 Microsof ajax 工具包。

我想我将使用 jQuery 并最终删除 Microsoft 。我对 jQuery 很陌生，但是我对它了解得越多，我就越迷恋它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-10T17:22:27.210

最好的策略是**不使用多个库**。想要在一个问题上投入更多的库是很诱人的，但它效率低下，容易出错，并且使您的代码更难被其他人维护。

在大多数情况下，您应该能够通过了解您的问题域以及哪个库将帮助您最好地解决它来避免使用多个库。所有这些库还有无数的插件和扩展。

例如，JQuery 支持开箱即用的跨域 JSONP 调用，并且在 JQueryUI 中有一个不错的小部件库，Prototype 没有。

```
$.getJSON('http://anothersite.com/mashup.json?callback=?', function(data) { }); 
```

Prototype 具有非常好的 OO 支持，并且很容易遍历 DOM，但缺少创建小部件和 mashup 所需的一些跨域功能。

```
var Foo =  Class.create({  
  initialize: function(name) {
    this.name = name;
  }   
});

var Bar = Class.create(Foo, {
  initialize: function($super, name)  {
     $super(name);
   }
}); 
```

Mootools 有很好的效果，良好的 OO 支持，非常可靠的小部件和跨域请求，但是（这可能只是我的印象），开发社区与全球社区（在 mootools 之外）的协作和社交不如其他社区社区（原型曾经是这种方式）。这可能是由于他们的主要开发人员居住在美国以外，因此无法参加尽可能多的会议并参与更大的社区。我不会让这完全阻止你，但要记住这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T09:50:29.923

默认情况下，Ruby on Rails 同时使用原型和 Scriptaculous，因为两者之间几乎没有重叠。除此之外，我还使用了 yui 片段并且从未遇到过问题。加载时间是一个问题，但这些库通常是缓存的，所以它只在加载的第一页上。

# continuous-integration - 持续集成网络服务

> ID：60368
> 
> 赞同：1
> 
> 时间：2008-09-13T06:42:46.740
> 
> 标签：continuous-integration

我处于一个可以成为分布在两个国家/地区的团队的团队负责人的位置。这个团队将是技术。我们计划在有限的资金上启动一家初创公司的团队。因此，我正在努力寻找将前期费用降至最低的方法。现在我们正计划使用 Java 并且将进行大量的 junit 测试。我打算将 github 用于 VCS，将 lighthouse 用于错误跟踪器。此外，我想添加一个持续集成服务器，但我不知道任何作为 Web 服务提供的持续集成服务器。

有人知道*软件即服务*模型中是否有可用的持续集成服务器吗？

PS，如果有人知道我可以在一个地点获得这三项服务，那将是非常棒的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-13T07:08:19.830

我假设您正在谈论*持续*集成。

您可以在虚拟机或旧机器上运行[CruiseControl](http://cruisecontrol.sourceforge.net/)，但如果需要在 Internet 上运行，您可以尝试虚拟专用服务器托管服务。你可以在这里选择 Linux 来省钱，但如果你的目标平台是 Windows，我会选择 Windows 服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-13T07:27:09.347

**注意：**这是 2008 年的过时答案。由于亚马逊的 Elastic Cloud Compute 服务（例如[travis-ci](http://travis-ci.org/)）之类的东西，现在有很多这样的服务

* * *

我很怀疑你会找到一项服务来为你构建东西。构建需要大量的 CPU 能力，如果每次有人提交时都必须重新构建，那么很难扩展这样的服务。我敢肯定，可能还有安全问题等等。

正如@eed3si9n 所说，您可以在备用（虚拟）机器上运行 CruiseControl 并使用它。然后设置端口转发，以及诸如[http://dyndns.com](http://dyndns.com)或[http://no-ip.info](http://no-ip.info)之类的东西以使其可公开访问。不太理想。。

我以前从未使用过 CruiseControl，但我想会有一种方法来获取构建结果，并将它们上传到公共网络服务器（作为一个愚蠢的 HTML 文件）。这样它就可以放在你的家用机器上，观看 github，构建新版本并将结果发送到可靠的网络主机（所以每次你的家庭连接无法访问时都不会出现“连接超时”）

事实上，我只是查看了 CruiseControl 文档 - 构建结果存储为一组 XML 文件，因此在另一台机器上传输/显示它们是微不足道的。

基本上，我的建议是：在备用机器上运行持续集成服务器，让它以某种方式将结果上传到公共 Web 服务器。

# php - PHP QuickForm 的替代品？

> ID：60369
> 
> 赞同：5
> 
> 时间：2008-09-13T06:47:53.310
> 
> 标签：php

我目前正在使用[HTML_QuickForm](http://pear.php.net/package/HTML_QuickForm)在 PHP 中生成表单。似乎有点限制，因为很难插入我自己的 javascript 或自定义某些元素的显示和分组。

QuickForm 是否有任何替代方案可以提供更大的灵活性？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T06:53:20.333

如果您发现很难将 Javascript 插入表单元素，请考虑使用 JavaScript 框架，例如[Prototype](http://www.prototypejs.org/)或[jQuery](http://jquery.com/)。在那里，您可以集中将事件处理注入表单控件的任务。

我的意思是您不需要将事件处理程序插入到 HTML 表单代码中。相反，您从其他地方注册这些事件。例如，在 Prototype 中，您可以编写如下内容：

```
$('myFormControl').observe('click', myClickFunction) 
```

[另请查看另一个问题](https://stackoverflow.com/questions/34126/whats-the-best-way-to-add-event-in-javascript)的答案。

/EDIT：当然，您也可以使用 HTML_QuickForm 将自定义属性和事件处理程序插入到表单元素中。但是，上面的方式是优越的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-13T07:32:14.903

我发现[Zend 框架的](http://framework.zend.com)[Zend_Form](http://framework.zend.com/manual/en/zend.form.html)包特别灵活。该组件还可以与[Zend_Dojo](http://framework.zend.com/manual/en/zend.dojo.html)一起使用，以快速实现常见的 javascript 表单助手。但是，当涉及到您使用的库时，该组件是不可知的，而是原生支持 Dojo。该组件还允许分组、多页表单、自定义装饰器、验证器和其他功能，使其非常灵活。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T18:40:22.443

我为 OnLamp 写了一篇关于此的文章： [自动填充 PHP 表单](http://www.onlamp.com/pub/a/php/2006/03/16/autofill-forms.html)

我对 HTML_QuickForm 和 Zend_Form 以及我能找到的所有其他表单处理框架的不满是，它们似乎假设您将编写代码来生成表单。但这与我的开发过程不匹配，我将从页面的外观（通过 HTML 模板指定）开始并为其添加功能。

在我看来，表单处理归结为：

1.  获取应该在表单中启动的数据（通常来自数据库）。
2.  获取表单的 HTML 代码（通常是模板）。
3.  将 1 和 2 混合在一起，并输出结果。
4.  获取提交的表单数据并验证它。
5.  重新显示带有错误消息和无效数据的表单，或者
6.  显示 congratulations-your-data-was-ok 页面。

fillInFormValues() 使 2、3 和 5 变得非常简单。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T09:40:51.367

我将第二个 Zend_Form；它具有出色的 ini 样式实现，可让您非常快速地定义表单：

```
[main]
vessel.form.method = "post"

vessel.form.elements.name.type = "text"
vessel.form.elements.name.name = "name"
vessel.form.elements.name.options.label = "Name: "
vessel.form.elements.name.options.required = true

vessel.form.elements.identifier_type.type = "select"
vessel.form.elements.identifier_type.name = "identifier_type"
vessel.form.elements.identifier_type.options.label = "Identifier type: "
vessel.form.elements.identifier_type.options.required = true
vessel.form.elements.identifier_type.options.multioptions.IMO Number = "IMO Number";
vessel.form.elements.identifier_type.options.multioptions.Registry organisation and Number = "Registry organisation and Number";
vessel.form.elements.identifier_type.options.multioptions.SSR Number = "SSR Number";

vessel.form.elements.identifier.type = "text"
vessel.form.elements.identifier.name = "identifier"
vessel.form.elements.identifier.options.label = "Identifier: "
vessel.form.elements.identifier.options.required = true
vessel.form.elements.identifier.options.filters.lower.filter = "StringToUpper"

vessel.form.elements.email.type = "text"
vessel.form.elements.email.name = "email"
vessel.form.elements.email.options.label = "Email: "
vessel.form.elements.email.options.required = true

vessel.form.elements.owner_id.type = "hidden"
vessel.form.elements.owner_id.name = "owner_id"
vessel.form.elements.owner_id.options.required = true

; submit button
vessel.form.elements.submit.type = "submit"
vessel.form.elements.submit.name = "Update"
vessel.form.elements.submit.option.value = "Update" 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T18:27:36.377

使用 Zend_Form 完全可以从您的表单视觉开始，然后处理反词。

这是通过删除所有装饰器并用 ViewScript 装饰器替换它们来完成的

```
$this->form->setDecorators( array(array('ViewScript', array('viewScript' => 'forms/aform.phtml')))); 
```

在该视图脚本中，您将执行以下操作：

```
<?=$this->element->title->renderViewHelper()?> 
```

使用这种方法，您基本上可以对表单做任何您想做的事情。

Zend_Form 的另一个优点是您可以创建自定义元素，这些元素可以在其中封装其他内容。例如，您可以有一个元素输出一个文本区域，然后使用一些 Javascript 将其转换为所见即所得的区域。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T19:01:28.930

我真的不能说什么，但前几天，我遇到了[克隆鱼](http://www.phpformclass.com/page/index)表单库。它看起来很有希望以“稍后再看”的形式出现在我的书签列表中。

# metrics - 计算代码指标

> ID：60394
> 
> 赞同：87
> 
> 时间：2008-09-13T07:53:06.010
> 
> 标签：metrics

是否有任何工具可以为您的项目计算代码指标（例如代码行数、圈复杂度、耦合度、内聚度），并随着时间的推移生成显示趋势的图表？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-09-13T08:01:47.190

在我的最新项目中，我使用[了 SourceMonitor](http://www.campwoodsw.com/sourcemonitor.html)。这是一个很好的免费代码度量分析工具。
以下是 SourceMonitor 官方网站的摘录：

> *   通过源文件快速收集指标。
> *   衡量用 C++、C、C#、VB.NET、Java、Delphi、Visual Basic (VB6) 或 HTML 编写的源代码的指标。
> *   包括 C++、C、C#、VB.NET、Java 和 Delphi 的方法和函数级别指标。
> *   **将指标保存在检查点中，以便在软件开发项目期间进行比较。**
> *   在表格和图表中显示和打印指标。
> *   在标准 Windows GUI 内或使用 XML 命令文件的脚本内操作。
> *   将指标导出到 XML 或 CSV（逗号分隔值）文件，以便使用其他工具进行进一步处理。

[对于NDepend](http://www.ndepend.com)旁边的 .NET，这是最好的工具，我可以推荐[vil](http://www.1bot.com/index.html)。

以下工具可以进行趋势分析：

*   [投掷](http://www.castsoftware.com/Product/Application-Intelligence-Platform.aspx)
*   [Klocwork 洞察力](http://www.klocwork.com/products/insight.asp)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-01-26T22:12:21.540

[Sonar](http://sonar.codehaus.org)绝对是您必须考虑的工具，尤其是对于 Java 项目。然而，它也可以处理 PHP 或 C/C++、Flex 和 Cobol 代码。

这是一个屏幕截图，显示了项目的一些指标：

[替代文字 http://sonar.codehaus.org/wp-content/uploads/2009/05/squid-metrics.png](http://sonar.codehaus.org/wp-content/uploads/2009/05/squid-metrics.png)

请注意，您可以使用他们的演示站点[http://nemo.sonarsource.org来试用该工具](http://nemo.sonarsource.org)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-13T07:54:10.860

[NDepend](http://www.ndepend.com/) for .net

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-13T08:26:36.100

我还在为我的 IDE 寻找代码指标工具/插件，但据我所知，没有（对于 eclipse 而言）也显示指定时间段内的复杂性图表。但是，我确实找到了[eclipse metrics 插件](http://eclipse-metrics.sourceforge.net/)，它可以处理：

*   McCabe 的圈复杂度
*   传出耦合
*   方法缺乏凝聚力
*   方法中的代码行
*   字段数
*   层数
*   范围内的当地人数量
*   参数数量
*   语句数
*   每类加权方法

在使用它时，我也没有错过您正在寻找的图形选项。
我认为，如果您找不到任何可以处理随时间变化的图表的插件/工具，您应该查看最适合您并为您提供所需信息的工具；即使给定的信息仅适用于您项目的当前版本。

附带说明一下，*eclipse 指标插件*允许您[将数据导出到外部文件](http://eclipse-metrics.sourceforge.net/example/index.html)（链接到一个示例），因此如果您使用源代码控制工具，并且您应该这样做！，您始终可以导出特定的数据将文件与源代码一起构建和存储，这样您仍然有一种（基本）方法可以及时返回并检查差异。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-19T20:31:32.320

请记住，您所测量的就是您所得到的。loc 没有提及生产力或效率。

通过代码行对程序员进行评分，您将获得..代码行。同样的论点也适用于其他指标。

otoh .. [http://www.crap4j.org/](http://www.crap4j.org/)是一个非常保守和有用的指标。它设置了与覆盖范围相关的复杂性。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-01-26T22:01:37.000

NDepend，我正在使用它并且它最好用于此目的。检查这个： http: [//www.codeproject.com/KB/dotnet/NDepend.aspx](http://www.codeproject.com/KB/dotnet/NDepend.aspx)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-26T18:44:36.967

关于工具[NDepend](http://www.NDepend.com)，它带有 82 种不同的代码度量，从代码行数到方法排名（流行度）、循环复杂性、方法缺乏凝聚力、覆盖率百分比（从 NCover 或 VSTS 中提取）、继承深度.. .

借助其规则系统，NDepend 还可以发现问题并估计[技术债务](http://www.ndepend.com/docs/technical-debt)，这是一个有趣的代码指标（解决问题的开发努力量*与*每年为了让问题未解决而被破坏的开发时间量）。

所有这些指标都[在这里详述](http://www.ndepend.com/Metrics.aspx)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-13T08:07:55.223

如果您在 .NET 领域，Developer Express 的[CodeRush](http://devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/)可实时提供代码的LOC、圈复杂性和（相当出色，恕我直言）[维护复杂性分析。](http://74.125.95.104/search?q=cache:www.doitwith.net/2005/03/02/Here%27sYourNewMetric.aspx)

（抱歉，维护复杂性链接；它将进入 Google 的缓存。原来的似乎是离线 ATM）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-19T07:09:37.467

[代码分析器](http://sourceforge.net/projects/codeanalyze-gpl/)是生成此类指标的简单工具。

[![替代文字](https://i.stack.imgur.com/iiyaB.png)](https://i.stack.imgur.com/iiyaB.png)
[（来源：[teel.ws](http://www.codeanalyzer.teel.ws/docs/post-analysis-shot.png)）]

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-26T18:56:07.350

Atlassian FishEye 是另一个出色的工具。它与您的源代码控制系统（目前支持 CVS、SVN 和 Perforce）集成，并以这种方式分析您的所有文件。虽然分析是相当基本的，并且产品本身是商业的（但价格非常合理，IMO）。

您还可以为其添加一个名为 Crucible 的插件，以促进同行代码审查。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-02-15T00:36:34.553

对于 Visual Studio .NET（至少是 C# 和 VB.NET），我发现免费的[StudioTools](http://www.exactmagic.com/products/studiotools/index.html)对于度量非常有用。它还添加了[ReSharper](http://www.jetbrains.com/resharper/)等商业工具中的许多功能。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-13T08:30:16.903

对于 Python，[pylint](http://www.logilab.org/857)可以提供一些代码质量指标。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-13T10:05:21.307

如果您使用的是 .NET，还有一个用于[reflector的](http://www.red-gate.com/products/reflector/)[代码指标插件。](http://www.codeplex.com/reflectoraddins/Wiki/View.aspx?title=CodeMetrics&referringTitle=Home)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-08-28T11:13:58.353

我会推荐Visual Studio 的[代码指标查看器扩展。](http://visualstudiogallery.msdn.microsoft.com/9f35524b-a784-4dbc-bd7b-6babd7a5a3b3)

一次分析解决方案非常容易，如果您取得了进展，也可以进行比较；-)

[在此处](http://codemetricsviewer.wordpress.com/features/)阅读有关[功能的更多信息](http://codemetricsviewer.wordpress.com/features/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-13T09:15:08.777

在 PHP 方面，我相信例如[phpUnderControl](http://phpundercontrol.org)包括通过[phpUnit](http://www.phpunit.de/)的指标（如果我没记错的话）。

请记住，指标通常是有缺陷的。例如，处理琐碎问题的编码员会比解决复杂问题的编码员生成更多代码，并且在您的图表上看起来更好。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-13T10:40:44.203

如果您在进行一些趋势分析，那么它真的意味着除了 SLOC 之外的任何衡量标准吗？

即使您只是对尾随分号执行 grep 并计算返回的行数，您所追求的是 SLOC 测量技术的一致性。这样，今天的测量值可以与上个月的测量值进行有意义的比较。

我真的看不出 McCabe Cyclometric Complexity 的趋势会带来什么？我认为 CC 应该更多地用于质量快照，以便向开发人员提供反馈。

编辑：哦。只是想到了一些其他可能有用的测量方法。注释占 SLOC 和测试覆盖率的百分比。这两个你都不想放过。回来改造其中任何一个都不是“一时兴起”那样做它们的神！

HTH。

干杯，

抢

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-26T18:50:20.077

[Scitools 的理解](http://www.scitools.com/products/understand/)确实有能力为您生成大量代码指标。我对代码度量功能没有太多经验，但是静态分析功能总体上很好，而且价格也很合理。支持非常好。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-07-19T13:34:45.697

[Project Code Meter](http://www.projectcodemeter.com)提供差异化​​开发历史报告（Excel 格式），以 SLOC、时间和生产力百分比显示您的编码进度指标（它的时间估计基于圈复杂度和其他指标）。然后在 Excel 中，您可以轻松生成所需的图形。

请参阅这篇逐步描述它的文章：http: [//www.projectcodemeter.com/cost_estimation/help/FN_monsizing.htm](http://www.projectcodemeter.com/cost_estimation/help/FN_monsizing.htm)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-05-03T13:53:58.043

对于 Java，您可以尝试我们的工具[QualityGate](http://www.quality-gate.com/)，它可以计算 60 多个源代码指标，跟踪所有变化，并为源代码的可维护性提供总体评级。

# php - In PHP is it possible to use a function inside a variable

> ID：60409
> 
> 赞同：10
> 
> 时间：2008-09-13T08:26:34.913
> 
> 标签：php, html, variables, function

I know in php you can embed variables inside variables, like:

```
<? $var1 = "I\'m including {$var2} in this variable.."; ?> 
```

But I was wondering how, and if it was possible to include a function inside a variable. I know I could just write:

```
<?php
$var1 = "I\'m including ";
$var1 .= somefunc();
$var1 = " in this variable..";
?> 
```

But what if I have a long variable for output, and I don't want to do this every time, or I want to use multiple functions:

```
<?php
$var1 = <<<EOF
    <html lang="en">
        <head>
            <title>AAAHHHHH</title>
            <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        </head>
        <body>
            There is <b>alot</b> of text and html here... but I want some <i>functions</i>!
            -somefunc() doesn't work
            -{somefunc()} doesn't work
            -$somefunc() and {$somefunc()} doesn't work of course because a function needs to be a string
            -more non-working: ${somefunc()}
        </body>
    </html>
EOF;
?> 
```

Or I want dynamic changes in that load of code:

```
<?
function somefunc($stuff) {
    $output = "my bold text <b>{$stuff}</b>.";
    return $output;
}

$var1 = <<<EOF
    <html lang="en">
        <head>
            <title>AAAHHHHH</title>
            <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        </head>
        <body>
            somefunc("is awesome!") 
            somefunc("is actually not so awesome..") 
            because somefunc("won\'t work due to my problem.")
        </body>
    </html>
EOF;
?> 
```

Well?

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-13T08:45:42.483

Function calls within strings are supported since PHP5 by having a variable containing the name of the function to call:

```
<?
function somefunc($stuff)
{
    $output = "<b>{$stuff}</b>";
    return $output;
}
$somefunc='somefunc';
echo "foo {$somefunc("bar")} baz";
?> 
```

will output "`foo <b>bar</b> baz`".

I find it easier however (and this works in PHP4) to either just call the function outside of the string:

```
<?
echo "foo " . somefunc("bar") . " baz";
?> 
```

or assign to a temporary variable:

```
<?
$bar = somefunc("bar");
echo "foo {$bar} baz";
?> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-13T08:46:27.410

`"bla bla bla".function("blub")." and on it goes"`

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-14T11:00:57.953

Expanding a bit on what Jason W said:

```
I find it easier however (and this works in PHP4) to either just call the 
function outside of the string:

<?
echo "foo " . somefunc("bar") . " baz";
?>

```

You can also just embed this function call directly in your html, like:

```
<?

function get_date() {
    $date = `date`;
    return $date;
}

function page_title() {
    $title = "Today's date is: ". get_date() ."!";
    echo "$title";
}

function page_body() {
    $body = "Hello";
    $body = ",  World!";
    $body = "\n
\n";
    $body = "Today is: " . get_date() . "\n";
}

?>
<html>
    <head>
    <title><? page_title(); ?></title>
    </head>
    <body>
    <? page_body(); ?>
    </body>
</html>

```

# sql - 我真的需要在存储过程中使用事务吗？[MSSQL 2005]

> ID：60419
> 
> 赞同：7
> 
> 时间：2008-09-13T08:45:16.087
> 
> 标签：sql, asp.net, sql-server, e-commerce

我`e-commerce app`在**asp.net**中写了一个非常简单的东西，我需要在我的存储过程中使用事务吗？

读/写比率约为 9:1

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-13T08:52:26.303

很多人问——我需要交易吗？为什么我需要它们？什么时候使用它们？

答案很简单：一直使用它们，除非您有充分的理由不使用（例如，不要将原子事务用于企业之间的“长时间运行的活动”）。默认值应始终为是。你有疑问吗？- 使用交易。

为什么交易是有益的？它们可以帮助您处理崩溃、故障、数据一致性、错误处理，它们可以帮助您编写更简单的代码等。而且好处列表将随着时间的推移而继续增长。

[以下是来自http://blogs.msdn.com/florinlazar/](http://blogs.msdn.com/florinlazar/)的更多信息

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T16:07:22.937

请记住，在 SQL Server 中，默认情况下，所有单语句 CRUD 操作都在隐式事务中。如果您需要将多个语句作为一个原子单元，您只需要打开显式事务 (BEGIN TRAN)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T09:06:01.997

答案是，这取决于。您并不总是需要交易安全。有时它是矫枉过正的。有时不是。

我可以看到，例如，当您实施结帐流程时，您只想在收集所有数据等后完成它。考虑一下付款方式，您可以回滚 - 这是您需要交易时的示例。或者也许在明智的时候使用它们。

创建新用户帐户时是否需要交易？也许，如果它跨越 10 个表（无论出于何种原因），如果它只是一个表，那么可能不会。

这还取决于您向客户出售的产品以及他们是谁，以及他们是否提出要求等。但是，如果由您做出决定，那么我会说，明智地选择。

我的底线是，避免过早优化。构建您的应用程序，请记住，您可能希望稍后在需要时返回并重构/优化。看看几个开源项目，看看他们如何实现应用程序的不同部分，从中学习。你会看到他们中的大多数根本不使用交易，但是有大量的在线商店使用它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T09:49:10.957

当然，这取决于。

这取决于特定存储过程执行的工作，也许与您建议的“读/写比率”无关。通常，如果查询可能会受到其他同时运行的查询的影响，则应考虑在事务中包含工作单元。如果这听起来不确定，那就是。通常很难预测在什么情况下某个特定的工作单元有资格成为这个候选者。

一个好的起点是检查工作单元中正在执行的精确[CRUD](http://en.wikipedia.org/wiki/Create,_read,_update_and_delete)，在这种情况下是在您的存储过程中，并确定它是否 a）可能受到其他一些同时操作的影响，以及 b）其他工作是否重要到正在执行的这项工作的最终结果（或者，甚至反之亦然）。如果这两个答案都是“是”，那么考虑将工作单元包装在事务中。

这表明您不能总是简单地决定*使用或不使用 transaction*，而是应该在有意义的时候应用它们。使用[ACID](http://en.wikipedia.org/wiki/ACID)定义的属性（原子性、一致性、隔离性和持久性）来帮助确定何时可能出现这种情况。

要考虑的另一件事是，在某些情况下，特别是如果系统必须快速连续执行许多操作，例如，大容量事务处理应用程序，您可能需要权衡事务的相对性能成本。根据工作单元的大小，事务的提交（或回滚）可能会耗费大量资源，可能会对系统性能产生不必要的负面影响，或者至少收益有限。

不幸的是，这不是一个容易准确回答的问题：“视情况而定”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T12:55:22.613

在以下情况下使用它们：

1.  您可能想要测试和捕获一些错误，除非您出去并做工作（查找内容，测试值等），否则不会被捕获，通常从事务中进行，以便您可以滚动返回整个操作。
2.  有任何类型的多步骤操作，如果它们失败，从逻辑上讲，它们应该作为一个组回滚。

# c++ - Vista 上的 IDebugProgramProvider2.GetProviderProcessData

> ID：60422
> 
> 赞同：0
> 
> 时间：2008-09-13T08:49:41.707
> 
> 标签：c++, debugging, internet-explorer, windows-vista

作为 IE 6/7 的 JavaScript Profiler 的一部分，我需要将我创建的自定义调试器加载到 IE 中。我在 XP 上运行良好，但无法在 Vista 上运行（全文在这里：[http](http://damianblog.com/2008/09/09/tracejs-v2-rip/) ://damianblog.com/2008/09/09/tracejs-v2-rip/ ）。

在 Vista 上调用 GetProviderProcessData 失败。有人有什么建议吗？

谢谢，达米安

```
// Create the MsProgramProvider
IDebugProgramProvider2* pIDebugProgramProvider2 = 0;
HRESULT st = CoCreateInstance(CLSID_MsProgramProvider, 0, CLSCTX_ALL, IID_IDebugProgramProvider2, (void**)&pIDebugProgramProvider2);
if(st != S_OK) {
    return st;
}

// Get the IDebugProgramNode2 instances running in this process
AD_PROCESS_ID processID;
processID.ProcessId.dwProcessId = GetCurrentProcessId();
processID.ProcessIdType = AD_PROCESS_ID_SYSTEM;

CONST_GUID_ARRAY engineFilter;
engineFilter.dwCount = 0;

PROVIDER_PROCESS_DATA processData;

st = pIDebugProgramProvider2->GetProviderProcessData(PFLAG_GET_PROGRAM_NODES|PFLAG_DEBUGGEE, 0, processID, engineFilter, &processData);
if(st != S_OK) {
    ShowError(L"GPPD Failed", st);
    pIDebugProgramProvider2->Release();
    return st;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-30T22:34:12.373

这将有助于了解错误结果是什么。

我能想到的可能问题：

如果您的权限被拒绝，您很可能在 ACL 中缺少一些必需的[权限](http://msdn.microsoft.com/en-us/library/aa375728(VS.85).aspx)。新的有时没有很好地记录，请检查最新的 Platform SDK 标头以查看是否还有新的。可能是在 vista 下，权限不再分配给我的默认值给您的 ACL。

如果您收到某种 Not Found 类型错误，则可能是 32 位 / 64 位问题。您的调试 API 可能仅在 vista 64 上的 64 位 COM 下可用。32 位/64 位互操作可能非常混乱。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-13T10:41:46.867

我不熟悉这些界面，但 Vista 中的意外故障可能需要通过 UAC 提示。您是否尝试过以管理员权限启动调试器？

# openid - 在站点上仅使用 OpenID 身份验证有什么好处？

> ID：60436
> 
> 赞同：51
> 
> 时间：2008-09-13T09:35:37.183
> 
> 标签：openid

根据我使用[OpenID](http://en.wikipedia.org/wiki/OpenID)的经验，我看到了一些明显的缺点：

**向站点添加[单点故障](http://en.wikipedia.org/wiki/Single_Point_of_Failure)**
即使检测到，站点也无法修复该故障。如果 OpenID 提供商关闭了三天，该网站有什么办法允许其用户登录并访问他们拥有的信息？

**将用户带到另一个站点的内容，并且每次他们登录到您的站点时，**
即使 OpenID 提供程序没有错误，用户也会被重定向到他们的站点进行登录。登录页面有内容和链接。因此，用户实际上有可能会被吸引离开该网站而进入互联网兔子洞。

为什么我要将我的用户发送到另一家公司的网站？
[注意：我的提供商不再这样做，并且似乎已经解决了这个问题（现在）。]

**为注册增加了重要的时间要注册**
该站点，新用户必须阅读新标准，选择提供商并注册。标准是技术人员应该同意的东西，以使用户体验顺畅。它们不是应该强加给用户的东西。

**这是钓鱼者的梦想**
OpenID 非常不安全，并且在用户登录时窃取他们的 ID 非常容易。[摘自下面大卫·阿诺的[回答](https://stackoverflow.com/questions/60436/what-is-the-benefit-of-using-only-openid-authentication-on-a-site#173467)]

* * *

对于所有的缺点，一个优点是允许用户在 Internet 上登录的次数更少。如果网站选择加入 OpenID，那么想要该功能的用户可以使用它。

**我想了解的是：网站****强制执行**
OpenID 有什么好处？

 *** * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-13T10:06:48.560

强制使用 OpenID 的好处只是不需要编写网站的登录代码（除了 OpenID 集成之外），也不需要在存储用户密码等方面采取预防措施。

没有自己的登录代码也意味着不必处理很多支持问题，例如重置丢失的密码等。

当然，你的大部分缺点都是有效的，所以我想这是一种权衡。

令我惊讶的是，没有更多的网站与特定的 OpenID 提供商建立密切关系以简化帐户注册阶段 - 即某种“你可以使用任何你喜欢的 OpenID，但你也可以现在通过输入一个用户名和密码等的登录页面，它会自动为您创建一个与所选提供商的新帐户。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-13T09:44:20.733

这是外包一部分基础架构的好方法。您不必担心丢失密码等，其他人会为您完成。

不过，我不确定我是否会专门使用它。我没有使用足够多的 OpenID 来完全信任它，并且需要简化注册过程，直到超过 90% 的用户拥有 OpenID。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-13T13:26:45.990

> **向站点添加故障的关键点**

[Stackoverflow](https://web.archive.org/web/20090424075552/http://stackoverflow.uservoice.com:80/pages/general/suggestions/16685)用户语音的第三个最高想法是允许更改 OpenID 提供程序。并且在评论中有建议允许在 OpenID 之外进行更多的关联。在可以将多个 OpenID 与一个帐户关联的站点上，如果您通常的 OpenID 提供商已关闭，您仍然可以使用另一个提供商登录（假设您已经将其与该站点关联）。

此外，对于无法正常工作的 OpenID 提供程序的用户来说，这只是一个关键的故障点。其他 OpenID 提供商上的所有其他用户都可以继续记录它。随着时间的推移，您会期望用户会迁移到最可靠的提供商。

> **将用户带到另一个站点的内容，并且每次他们登录到您的站点时**

如果您已将 OpenID 提供程序设置为始终信任某个站点（或命名法中的 OpenID 消费者）并且您已经登录到您的 OpenID 提供程序，那么他们会将您直接重定向回该站点，而您甚至不会看到您的 OpenID 提供程序站点。

> **为注册增加非试用时间**

目前这可能是真的，但正如 andyuk 所说，“支持 OpenID 的站点越多，这就越不成问题”。我希望几年后大多数用户已经拥有一个 OpenID 并且知道它是什么。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-06T22:00:27.333

从工程的角度来看，仅使用 OpenID 的一大好处是，将凭证身份验证部分抽象出来，让用户可以选择比您为您的站点构建的任何方法都复杂得多的身份验证方法。是的，一些 OpenID 提供者很容易被钓鱼。另一方面，其他 OpenID 用户使用信息卡、硬件令牌或电话验证登录，这些都是网络钓鱼者*无法*捕获和重放的凭据。

正如 Gabe Wachob[所说](http://blog.wachob.com/2007/01/openid_is_a_pla.html)：

> 想要在身份验证方法方面进行创新的人 [...] 不必是在网络上提供服务方面进行创新的人（运行 Mediawiki、Drupal 等的百万人中的任何一个）。认证创新与服务创新的“脱钩”，正是 OpenID 的价值所在。

因此，通过使用 OpenID，您可以为您的用户提供更强大的身份验证方法。这种抽象让您可以实现一个接口，然后您可以选择任何提供者来使用，无论他们使用明文形式的八字符密码还是挑战响应神经植入物。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-06T07:31:29.337

缺点列表忽略了最明显的一个：这是网络钓鱼者的梦想。OpenID 非常不安全，在用户登录时窃取他们的 ID 非常容易。

不过，Matt Sheppard 对答案一针见血：只使用 OpenID 的好处是它为网站创建者带来了更少的麻烦，因为无需处理用户名和密码，也不需要用户帐户创建代码。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-13T10:17:22.607

它鼓励用户注册 OpenID，了解有关它的更多信息，并希望自己宣传它。

Stack Overflow 证明只支持 OpenID 是可行的。

> **“向站点添加故障的关键点”**

如果 OpenID 提供者无法工作，站点应该有一种机制允许用户登录和添加/更改 OpenID 提供者。也许该站点可以通过电子邮件发送一个临时链接以绕过安全性，以便用户可以访问他们的帐户。

> **“将用户带到另一个站点的内容，并且每次他们登录到您的站点时”**

我的 OpenID 提供商允许我信任给定的网站，因此我什至不需要查看他们的网站。

> **“为注册增加非试用时间”**

支持 OpenID 的站点越多，这个问题就越少。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-13T14:36:07.070

作为一名 Web 开发人员，我是 OpenID 理念的忠实拥护者。编写 Auth 代码是一件很痛苦的事情。作为一名网络用户，我是 OpenID 的忠实粉丝——用于非关键用途，如 SO、论坛等——因为一旦你拥有了 ID，这是一种非常简单的加入网站的方式。

我认为，除了少数例外——比如开发者社区——目前，你不能只强制使用 OpenID。“普通”网络用户（无论这意味着什么）不明白。然而，在这样的网站上推广它会提高开发人员的意识，这个想法最终会慢慢流传下来。随着 OpenID 出现在越来越多的网站上，人们会关注它，意识到他们拥有一个，然后开始使用它。为了让 OpenID（这是一个好主意）流行起来，需要有大量的用户和网站支持它。

最终，它只会是“它本来的样子”，我们会想知道为什么我们会为我们创建的每个网站创建身份验证代码，或者为什么我们会在网络上的任何地方创建一个唯一的身份

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-06T22:05:00.227

正如其中一个播客中所讨论的，它增加了进入流浪者的障碍，因为他们想知道这是否可能是他们应该在雅虎发布的地方！回答问题。

这有点精英主义，但考虑到这个网站的重点，拒绝任何无法弄清楚 Open ID 流程的人是完全可以接受的，任何真正有需要回答的真正问题的人都可能会费心解决任何问题轻微的困难。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-05-27T12:41:42.063

根据我使用 OpenID 的经验，我看到了一些重要的好处：

如果您选择使用您信任的 OpenID 提供商登录，例如。威瑞信 PIP+VIP 您可以享受带外 SecureID 身份验证机制的好处。这应该被视为胜过所有其他人的主要好处。您不再信任您访问的站点上的任何基于表单的蹩脚的身份验证，您正在信任 Verisign VIP 或您选择的任何 OpenID 提供商。

互联网兔子洞？听起来像是糟糕的实施，我不知道你指的是什么。

您不能轻易窃取身份验证细节，它可以比我们已经拥有的更接近不可能！您可能会欺骗我，让我认为我正在联系我的提供商，但 Verisign 可以选择不允许或接受重定向。我认为这些网络钓鱼问题也是微不足道的，尤其是当您将其与您可以通过 OpenID 身份验证提供程序获得的带外身份验证机制的好处进行权衡时。因此，假设您曾经钓鱼 RSA 密钥详细信息，下一次它将无效，或者如果您要说使用浏览器证书，它可能完全没用。

总之，OpenID 只是当前系统的演变，是一个用于验证的电子邮件地址。如果您的电子邮件帐户是您当前的单点故障，那么是的，在您控制的 OpenID 不再受您控制的情况下，您的 OpenID 可能是您的新单点故障。因此，如果您只信任您的电子邮件服务器，那么只需托管您自己的 OpenID URL。如果您信任 Gmail，请为您的 OpenID 使用 gmail URL，因为出于同样的原因，您已经信任 Gmail 作为您的 SSO，因为您的 gmail 帐户最终可以检索您的帐户密码。

It's a no brainer, but I can see that some people may have difficulty understanding the basic concepts of authentication mechanisms. If I CAN login with my SecureID card (via my OpenID provider) to a site that I have an account on, I WOULD. So if it was the only option, I'll take it!

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-13T09:46:18.780

**向站点添加故障的关键点**

失败的关键点可能是您发送的确认电子邮件，但用户的邮箱 a) 由于拼写错误不可用，b) 已满或 c) 提供商“关闭”。

**将用户带到另一个站点的内容，并且每次他们登录到您的站点时**

我可以看到，但恕我直言 - 这还不错。我的意思是，Y！似乎是最混乱的登录之一，它也对我不起作用。;) 除此之外，大多数 OpenID 提供商看起来还不错（还）。

另外，请记住您的听众。如果妈妈和爸爸是您的用户，那么 OpenID 可能会令人困惑。但在互联网上可能很多。在 SO 的情况下，人们是一些精明的用户并且知道他们想要什么。

**为注册增加非试用时间**

这是一个非问题。查看提供者列表：http: [//openid.net/get/](http://openid.net/get/)

这么多人至少有一个 Yahoo! 帐户，所以如果它确实有效。不会那么糟糕。我同意，如果用户没有 OpenID，并且不知道它的用途。教育他们并不容易。

并想一想其中的含义——“要注册站点 A，您需要在站点 B 注册”。我们都知道注册本身就是一件痛苦的事情。但从长远来看，这也正是 OpenID 试图解决的问题。

在主流中，我目前认为强制 OpenID 没有任何价值。不过我喜欢它作为一个附加组件。只是人们如何提供“使用您的 Facebook 登录”的链接等。然后那些不明白（或不在乎）的人不需要打扰。但其他人仍然可以使用它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-05T14:53:00.740

还要提一件事。您已经有一个使用 OpenID 的用户群，他们只需要登录。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-06T05:48:57.577

OpenID 可能是自切片面包以来最伟大的事情，但我没有理由相信“他们”的身份——除了 Jeff Atwood/Joel Spolsky 让我这样做是为了在这里抱怨它；-)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-17T13:37:22.603

我赞成 OpenID，主要是从易用性的角度来看。我仍然相信它的安全性，但它有很大的潜力。对此有很多可以说的，但我只想回应以下两点：

> **为注册增加了重要的时间**

只有第一次设置。此外，现在有像雅虎这样的公司提供支持，如果他们不想，很多人甚至不必费心设置 OpenID。如果您使用 Google 或类似的人作为您的 OpenID 提供者，您会认为它们本质上是不安全的吗？您希望他们多久停机一次？

> **这是钓鱼者的梦想**

我确实接受这可能部分正确。但是，网络钓鱼与其说是一个技术问题，不如说是一个社会问题？OpenID 可以使它更容易，但这并不能消除真正的问题是用户这一事实。让用户了解网络钓鱼者的运作方式比试图通过技术保护他们要重要得多。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-24T02:03:08.273

至少 OpenID 会将您发送到您的 OpenID 提供商以进行登录。
我在 blogspot 上阅读了一个博客，并且有一个链接可以关注这个博客（大概告诉我什么时候有新帖子）这样做它会弹出一个框，询问我的 Gmail 用户名和密码。

即使假设这是真实的而不是网络钓鱼网站——他们现在（可能）已经登录到我的 Gmail、我的谷歌文档、我的谷歌应用程序——一切！

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-10-06T08:48:54.513

从长远来看，拥有 OpenID 的主要好处将会显现。您不必向不同的网站申请身份，只需这样做一次，然后在所有需要唯一身份的网站上使用它。当然，对于像银行和交易这样的安全网站，它需要完全不同的思维方式。但是对于社交网站等，您可以轻松使用它。

妈妈和爸爸也会发现这很容易，因为现在他们只需要记住一个用户名/密码。很多时候，我们很难记住我们在哪个站点上的登录信息，并最终在站点 B 上使用站点 A 的正确用户名/密码。OpenID 将解决这个问题。此外，对于 OpenID 提供者和用户来说，这是一个很好的收入模式。我可以向这样的提供商输入我愿意提供的所有细节，并且我提供的每一个这样的细节都可以赚钱。

也许供应商可以诱使我告诉它更多关于我自己的信息，以此作为激励，然后它可以将其出售给我注册的网站。所以站点 A 为我的信息支付 OpenID。OpenID 然后将其中的一部分传递给我。站点A不用管用户，OpenID拿钱，用户拿钱，大家开心：）

这样您就不必强制使用 OpenID。人们自己会想要它。然后，OpenID 提供商将相互竞争以提供更好的服务，并且在存在竞争的地方，将为所有相关人员提供更好的价值。我认为这是一个绝妙的主意。

**编辑：** 关于一个特定提供商的停机时间；如果 OpenID 提供者 A 对提供 100% 的正常运行时间没有信心，它可以借助另一个提供者 B 的帮助，并且提供者 A 上的用户可以从提供者 A 提供的选项中进行选择。前往提供者 A 对用户进行身份验证的站点将知道在提供者 A 不工作的情况下要访问哪些其他提供者。这将在首次登录时自动存储在其数据库中。有人想集思广益实施细节吗？:)

# jquery - 在 jQuery 中使用 href="javascript:..." 访问 $(this)

> ID：60438
> 
> 赞同：2
> 
> 时间：2008-09-13T09:37:02.157
> 
> 标签：jquery

我正在使用 jQuery。我用下一个 html 调用 JavaScript 函数：

```
<li><span><a href="javascript:uncheckEl('tagVO-$id')">$tagname</a></span></li> 
```

我想删除元素，我认为这对对象`li`很容易。`$(this)`这是我的 JavaScript 函数：

```
function uncheckEl(id) {
    $("#"+id+"").attr("checked","");
    $("#"+id+"").parent("li").css("color","black");                 
    $(this).parent("li").remove();  // This is not working
    retrieveItems();
} 
```

但是`$(this)`是未定义的。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T10:04:41.137

尝试这样的事情（例如隐藏`<li>`）：

```
function unCheckEl(id, ref) {
  (...)
  $(ref).parent().parent().hide(); // this should be your <li>
} 
```

还有你的链接：

```
<a href="javascript:uncheckEl('tagVO-$id', \$(this))"> 
```

`$(this)`不存在于您的函数中，因为它应该如何知道从哪里调用该操作？您没有在其中传递任何引用，因此`$(this)`可以引用除`<a>`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T17:17:51.570

为什么不这样：

```
<li id="uncheck_tagVO-$id">$tagname</li> 
```

和

```
$('li').click( function() {
    var id = this.id.split("_")[1];
    $('#'+id).attr("checked","").parent("li").css("color","black"); 
    $(this).remove();
    retrieveItems();
}); 
```

# python - 使用 Python 进行 Windows Mobile 开发

> ID：60446
> 
> 赞同：4
> 
> 时间：2008-09-13T09:56:04.653
> 
> 标签：python, windows-mobile

开始使用 Python 开发 Windows Mobile Professional 应用程序的最佳方式是什么？是否有合理的 SDK，包括模拟器？例如，是否有可能不为 UI 进行过多的底层 Windows API 调用？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-13T10:03:55.523

## Python CE

Windows CE (Pocket PC) 设备的 Python 端口。旨在尽可能接近桌面版本（控制台、当前目录支持、测试套件通过）。

[![Python CE](https://i.stack.imgur.com/NQmKI.jpg)](http://pythonce.sourceforge.net/)
[（来源：[sourceforge.net](http://pythonce.sourceforge.net/images/python-logo.jpg)）]

![替代文字](https://sourceforge.net/dbimage.php?id=76454)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-13T22:30:01.690

（我曾经为 Windows Mobile 编写客户应用程序。）

忘记python。即使技术上可行：

*   您的应用程序会很大（您必须将整个 python 运行时与您的应用程序捆绑在一起）
*   您的应用程序将使用大量内存（相对于 C/C++，python 是一个内存猪）
*   你的应用会很慢
*   当您（不可避免地）遇到问题时，您不会找到任何文档或讨论组来帮助您

使用 C/C++（或 C#）。Visual Studio 2005/2008 为这些提供了不错的工具（内置用于 winmo 的 SDK、在模拟器上调试或通过 USB 连接的设备），最好的文档是针对这些技术的，此外还有活跃的论坛/讨论组/邮件列表，您可以在其中请求帮忙。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T10:29:26.010

如果 IronPython 和 .Net Compact Framework 团队合作，Visual Studio 有朝一日可能会支持 Python 开箱即用地进行 Windows Mobile 开发。不幸的是，[这个功能请求已经在他们的问题跟踪器上放置了很长时间](http://www.codeplex.com/IronPython/WorkItem/View.aspx?WorkItemId=9191)......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-05T11:07:39.277

刚刚发现：[http ://ejr44.blogspot.com/2008/05/python-for-windows-mobile-cab.html](http://ejr44.blogspot.com/2008/05/python-for-windows-mobile-cab.html)

看起来像是一套完整的 .CAB 文件，用于在 Windows Mobile 上提供 Python。

# javascript - 用 JavaScript 截取网页截图？

> ID：60455
> 
> 赞同：149
> 
> 时间：2008-09-13T10:21:08.993
> 
> 标签：javascript, hta, webpage-screenshot

是否可以使用 JavaScript 截取网页的屏幕截图，然后将其提交回服务器？

我不太关心浏览器的安全问题。等等，因为实施将是[HTA](http://msdn.microsoft.com/en-us/library/ms536471(vs.85).aspx)。但有可能吗？

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2011-08-02T22:53:13.273

Google 正在 Google+ 中进行此操作，一位才华横溢的开发人员对其进行了逆向工程并制作了[http://html2canvas.hertzen.com/](http://html2canvas.hertzen.com/)。要在 IE 中工作，您需要一个画布支持库，例如[http://excanvas.sourceforge.net/](http://excanvas.sourceforge.net/)

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-15T14:40:44.407

我已经通过使用 ActiveX 控件为 HTA 完成了此操作。在 VB6 中构建控件以截取屏幕截图非常容易。我不得不使用 keybd_event API 调用，因为 SendKeys 不能做 PrintScreen。这是代码：

```
Declare Sub keybd_event Lib "user32" _
(ByVal bVk As Byte, ByVal bScan As Byte, ByVal dwFlags As Long, ByVal dwExtraInfo As Long)

Public Const CaptWindow = 2

Public Sub ScreenGrab()
   keybd_event &H12, 0, 0, 0
   keybd_event &H2C, CaptWindow, 0, 0
   keybd_event &H2C, CaptWindow, &H2, 0
   keybd_event &H12, 0, &H2, 0
End Sub 
```

这只能让你把窗口带到剪贴板。

另一种选择，如果您想要截屏的窗口是 HTA，则只需使用 XMLHTTPRequest 将 DOM 节点发送到服务器，然后在服务器端创建截屏。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-02-13T23:25:29.310

我发现的另一种可能的解决方案是[http://www.phantomjs.org/](http://www.phantomjs.org/)，它允许人们非常轻松地截取页面和更多内容。虽然我对这个问题的原始要求不再有效（不同的工作），但我可能会将 PhantomJS 集成到未来的项目中。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-10-25T08:29:36.733

Pounder 是否可以通过将整个身体元素设置为画布然后使用 canvas2image 来做到这一点？

[http://www.nihilogic.dk/labs/canvas2image/](http://www.nihilogic.dk/labs/canvas2image/)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-12-02T21:47:16.570

一种可能的方法是，如果在 Windows 上运行并安装了 .NET，您可以执行以下操作：

```
public Bitmap GenerateScreenshot(string url)
{
    // This method gets a screenshot of the webpage
    // rendered at its full size (height and width)
    return GenerateScreenshot(url, -1, -1);
}

public Bitmap GenerateScreenshot(string url, int width, int height)
{
    // Load the webpage into a WebBrowser control
    WebBrowser wb = new WebBrowser();
    wb.ScrollBarsEnabled = false;
    wb.ScriptErrorsSuppressed = true;
    wb.Navigate(url);
    while (wb.ReadyState != WebBrowserReadyState.Complete) { Application.DoEvents(); }

    // Set the size of the WebBrowser control
    wb.Width = width;
    wb.Height = height;

    if (width == -1)
    {
        // Take Screenshot of the web pages full width
        wb.Width = wb.Document.Body.ScrollRectangle.Width;
    }

    if (height == -1)
    {
        // Take Screenshot of the web pages full height
        wb.Height = wb.Document.Body.ScrollRectangle.Height;
    }

    // Get a Bitmap representation of the webpage as it's rendered in the WebBrowser control
    Bitmap bitmap = new Bitmap(wb.Width, wb.Height);
    wb.DrawToBitmap(bitmap, new Rectangle(0, 0, wb.Width, wb.Height));
    wb.Dispose();

    return bitmap;
} 
```

然后通过 PHP 你可以这样做：

`exec("CreateScreenShot.exe -url http://.... -save C:/shots domain_page.png");`

然后你在服务器端有截图。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-15T14:58:00.480

这可能不是您的理想解决方案，但可能仍然值得一提。

*[Snapsie](http://snapsie.sourceforge.net/)是一个开源的[ActiveX](http://en.wikipedia.org/wiki/ActiveX)对象，可以捕获和保存 Internet Explorer 屏幕截图。*在客户端注册 DLL 文件后，您应该能够捕获屏幕截图并使用 JavaScript 将文件上传到服务器。缺点：需要在客户端注册DLL文件，只能在Internet Explorer上使用。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-13T15:28:00.533

我们对报告错误有类似的要求。因为它是针对 Intranet 场景的，所以我们能够使用浏览器插件（例如用于 Firefox的[Fireshot](https://addons.mozilla.org/en-US/firefox/addon/5648)和用于 Internet Explorer 的[IE Screenshot ）。](http://www.softpedia.com/get/Tweak/Browser-Tweak/IE-Screenshot-Pro.shtml)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-10-14T19:01:23.217

SnapEngage[使用](http://www.snapengage.com/)[Java 小程序](http://en.wikipedia.org/wiki/Java_applet)( 1.5+) 来制作浏览器屏幕截图。AFAIK，`java.awt.Robot`应该完成这项工作 - 用户只需允许小程序执行它（一次）。

我刚刚找到了一篇关于它的帖子：

*   Stack Overflow 问题*[JavaScript 代码在不使用 ActiveX 的情况下截取网站的屏幕截图](https://stackoverflow.com/questions/2046812)*
*   博客文章*[SnapABug 的工作原理 - 以及他们应该做什么](http://www.barklund.org/blog/2009/10/14/how-snapabug-works/)*

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-11-26T18:06:31.083

这个问题很老，但也许仍然有人对最先进的答案感兴趣：

您可以使用[`getDisplayMedia`](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getDisplayMedia)：

[https://github.com/ondras/browsershot](https://github.com/ondras/browsershot)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-13T10:52:47.263

您可以使用 HTA 和[VBScript](http://en.wikipedia.org/wiki/VBScript)来实现。只需调用外部工具来进行屏幕截图。我忘记了名字是什么，但是在 Windows Vista 上有一个工具可以做截图。您甚至不需要额外安装它。

至于自动 - 这完全取决于您使用的工具。如果它有一个 API，我相信你可以通过几个 Visual Basic 调用触发屏幕截图和保存过程，而用户不知道你做了什么。

既然您提到了 HTA，我假设您在 Windows 上并且（可能）非常了解您的环境（例如操作系统和版本）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-03-26T15:38:03.920

我发现**dom-to-image**做得很好（比 html2canvas 好得多）。请参阅以下问题和答案：[https ://stackoverflow.com/a/32776834/207981](https://stackoverflow.com/a/32776834/207981)

This question询问关于将其提交回服务器，这应该是可能的，但是如果您要下载图像，则需要将其与[FileSaver.js](https://github.com/eligrey/FileSaver.js/)结合使用，并且如果您想下载 zip 与客户端生成的多个图像文件都看一下[jszip](http://stuk.github.io/jszip/)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-11-16T10:38:27.817

如果您愿意在服务器端执行此操作，可以使用[PhantomJS](https://github.com/ariya/phantomjs)之类的选项，但现在已弃用。最好的方法是在 Node.JS 上使用类似Puppeteer 的[Headless Chrome。](https://github.com/GoogleChrome/puppeteer)使用 Puppeteer 捕获网页非常简单，如下所示：

```
const puppeteer = require('puppeteer');

(async () => {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  await page.goto('https://example.com');
  await page.screenshot({path: 'example.png'});

  await browser.close();
})(); 
```

但是，它需要 headless chrome 才能在您的服务器上运行，这有一些依赖性，可能不适合受限环境。（另外，如果您不使用 Node.JS，您可能需要自己处理浏览器的安装/启动。）

如果您愿意使用 SaaS 服务，有很多选择，例如

*   [休息包](https://restpack.io)
*   [网址框](https://urlbox.io)
*   [截图层](https://screenshotlayer.com)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-07-01T10:30:10.880

[https://grabz.it](https://grabz.it)提供的一个很好的 Javascript 截图解决方案。

他们有一个灵活且易于使用的屏幕截图 API，可以被任何类型的 JS 应用程序使用。

如果你想尝试，首先你应该得到授权[应用密钥+秘密](https://grabz.it/api/#Key)和[免费的SDK](https://grabz.it/api/javascript/download.ashx)

然后，在您的应用程序中，实施步骤将是：

```
// include the grabzit.min.js library in the web page you want the capture to appear
<script src="grabzit.min.js"></script>

//use the key and the secret to login, capture the url
<script>
GrabzIt("KEY", "SECRET").ConvertURL("http://www.google.com").Create();
</script> 
```

屏幕截图可以定制不同的[参数](https://grabz.it/api/javascript/parameters.aspx)。例如：

```
GrabzIt("KEY", "SECRET").ConvertURL("http://www.google.com", 
{"width": 400, "height": 400, "format": "png", "delay", 10000}).Create();
</script> 
```

就这样。然后只需稍等片刻，图片就会自动出现在页面底部，无需重新加载页面。

您可以[在此处](https://grabz.it/api/javascript/)探索屏幕截图机制的其他功能。

也可以将屏幕截图保存在本地。为此，您需要使用 GrabzIt 服务器端 API。有关更多信息，请查看[此处](https://grabz.it/support/?uniqueId=SaveJavaScriptScreenshot)的详细指南。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-04-16T16:59:00.890

截至今天 2020 年 4 月 GitHub 库 html2Canvas [https://github.com/niklasvh/html2canvas](https://github.com/niklasvh/html2canvas)

**GitHub 20K 星**| Azure pipeles : 成功 | 下载量 1.3M/月 |

引用：“ *JavaScript HTML 渲染器 该脚本允许您**直接在用户浏览器上截取网页或其部分的“屏幕截图”**。屏幕截图基于 DOM，因此可能无法 100% 准确表示为真实表示，因为它不制作实际的屏幕截图，而是根据页面上可用的信息构建屏幕截图。*

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-06-17T16:17:07.297

我做了一个简单的函数，它使用 rasterizeHTML 来构建 svg 和/或带有页面内容的图像。

看看这个 ：

[https://github.com/orisha/tdg-screen-shooter-pure-js](https://github.com/orisha/tdg-screen-shooter-pure-js)

# web-services - DynamicPopulateExtender 、TextArea 和换行

> ID：60456
> 
> 赞同：0
> 
> 时间：2008-09-13T10:22:50.267
> 
> 标签：web-services, soap

我在一个页面中有这个：

```
<textarea id="taEditableContent" runat="server" rows="5"></textarea>
<ajaxToolkit:DynamicPopulateExtender ID="dpeEditPopulate" runat="server" TargetControlID="taEditableContent"
        ClearContentsDuringUpdate="true" PopulateTriggerControlID="hLink" ServicePath="/Content.asmx"
        ServiceMethod="EditContent" ContextKey='<%=ContextKey %>' /> 
```

基本上，一个 DynamicPopulateExtender 填充来自 web 服务的文本区域的内容。问题是，无论我如何返回换行符，文本区域中的文本都不会有换行符。

如果我将换行符返回为“br/”，则整个文本区域仍然为空。如果我将新行返回为 "/r/n" ，我会将所有文本作为一个连续行。网络服务正确返回字符串：

```
<?xml version="1.0" encoding="utf-8"?>
<string xmlns="http://rprealm.com/">First line

Third line
Fourth line</string> 
```

但我在文本区域得到的是：

```
First line Third line Fourth line 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T16:39:28.740

问题是在处理 XML 时默认会忽略空格。尝试将`xml:space="preserve"`属性添加到字符串元素。您还需要将 xml 前缀定义为`xmlns:xml="http://www.w3.org/XML/1998/namespace"`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-13T12:10:17.700

尝试在 textarea 上添加以下样式：**style="white-space: pre"**

# symbian - 在 Symbian 中以编程方式获取自己的电话号码

> ID：60461
> 
> 赞同：6
> 
> 时间：2008-09-13T10:30:33.103
> 
> 标签：symbian, telephony

如何在 Symbian 中获取设备的电话号码？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-18T15:45:11.730

根据 GSM 规范，[SIM](http://en.wikipedia.org/wiki/Subscriber_Identity_Module#Data)卡上只需要提供[IMSI](http://en.wikipedia.org/wiki/IMSI)。

实际的电话号码[MSISDN](http://en.wikipedia.org/wiki/MSISDN)存储在运营商网络中的[HLR](http://en.wikipedia.org/wiki/GSM_core_network#Home_Location_Register_.28HLR.29)数据库中，不需要在 SIM 卡上可用或传输到手机。

因此，无论您使用什么技术（Symbina、Java ...），您都不能指望能够始终如一地从设备或 SIM 中获取您自己的电话号码。如果运营商将其存储在 SIM 卡上，或者手机为用户提供了手动输入的可能性，您可能会很幸运，但不必如此。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:05:52.593

正如 Pat 所说，虽然有用于访问 SIM 上“自己的号码”插槽的 API，但根据我的经验，这个插槽很少被填满。

获取已连接应用程序的电话号码的常用策略是发送 SMS 作为验证过程的一部分。任何一个：

1.  以编程方式将 SMS 从手机发送到您的服务器（那里有很多优秀的 SMS 网关互连提供商）。SMS 将“从”手机号码（或更正确的 SIM 卡号码）到达您的服务器。当然，SMS 应该包含一些令牌，以便服务器可以将它与给定的会话/用户链接。这样做的好处是您不需要用户输入他们自己的电话号码（鉴于很少有人了解如何以 E.164 格式格式化数字，这会带来一些微妙的困难）。一个缺点是该过程可能会花费您的用户资金（一条短信）。

2.  让用户输入他们的电话号码（网站或手机）并连接到您的服务器，并传递该电话号码。让手机等待您从服务器发送的 SMS 到达。如果此 SMS 确实到达，则您已验证他们输入的电话号码正确且有效。明显的缺点是这依赖于用户正确输入他们的号码 - 同样，鉴于世界各地编写电话​​号码的方式过多，将号码标准化为 E.164 并不像听起来那么简单......

唉，这些方法都不是万无一失的，特别是因为 SMS 是一种未连接的传输方式。根据 GSM 网络负载，您的网关提供商的负载、月相和吹窗方向的 SMS 可能需要一秒钟到一个月才能到达（是的，我确实有后者的经验）。平均交付时间通常以秒为单位，但您必须考虑操作超时，并且可能必须根据地理和 GSM 网络对其进行调整。[不，不要依赖交付报告-甚至比短信交付更不可靠]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T10:33:21.257

仅供参考：实际上我已经找到了这个。

[http://www3.symbian.com/faq.nsf/AllByDate/100335073FFD8FEF80256E3200571A49?OpenDocument](http://www3.symbian.com/faq.nsf/AllByDate/100335073FFD8FEF80256E3200571A49?OpenDocument)

但事实是，电话号码并不总是存储在 SIM 卡中。运营商选择做或不做！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-13T10:37:05.913

你不能。AFAIK。

检查此讨论： [http ://discussion.forum.nokia.com/forum/showthread.php?t=65117](http://discussion.forum.nokia.com/forum/showthread.php?t=65117)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T19:33:46.230

通常不可能从 Symbian 设备（或 BREW 或任何其他平台）获取 MSISDN。我们试过了。

# emacs - 更改 Emacs 中的默认文件夹

> ID：60464
> 
> 赞同：117
> 
> 时间：2008-09-13T10:34:52.080
> 
> 标签：emacs, customization, directory

我对 Emacs 相当陌生，我一直在试图弄清楚如何`C-x C-f`在启动时更改默认文件夹。例如，当我第一次加载 Emacs 并点击`C-x C-f`它的默认文件夹`C:\emacs\emacs-21.3\bin`时，但我宁愿它是桌面。我相信有一些方法可以自定义`.emacs`文件来做到这一点，但我仍然不确定那是什么。

更新：我发现该问题有三种解决方案，但我相信解决方案 3 仅适用于 Windows。

*   解决方案1：添加`(cd "C:/Users/Name/Desktop")`到`.emacs`文件

*   解决方案2：添加`(setq default-directory "C:/Documents and Settings/USER_NAME/Desktop/")`到`.emacs`文件

*   解决方案 3：右键单击 Emacs 快捷方式，点击属性并将起始字段更改为所需的目录。

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2008-09-13T11:22:44.727

您没有这么说，但听起来您是从 Windows 快捷方式启动 Emacs。

您使用 cx cf 看到的目录是 cwd，用 Emacs 术语来说，就是`default-directory`（一个变量）。

当您使用 MS Windows 快捷方式启动 Emacs 时，`default-directory`它最初是快捷方式属性的“开始于”字段中指定的文件夹（目录）。右键单击快捷方式，选择，然后在字段`Properties`中输入桌面的路径。`Start In`

如果您从命令行使用 Emacs，则从`default-directory`您启动 Emacs 的目录（cwd）开始。

这种方法比编辑您的 .emacs 文件要好，因为它允许您拥有多个具有多个起始目录的快捷方式，并且如果您需要，它可以让您拥有 Emacs 的正常命令行行为。

**CWD** =[当前工作目录](http://linux.die.net/man/3/cwd)= **PWD** =[当前工作目录](http://en.wikipedia.org/wiki/Pwd)。它在命令行中比在 GUI 中更有意义。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-09-15T18:25:14.973

我认为您需要添加到 .emacs 的行是

```
(setq default-directory "C:/Documents and Settings/USER NAME/Desktop/" ) 
```

Emacs 将以这种方式在您的桌面启动，除非您打开了一个文件。否则，它通常会在与当前缓冲区中的文件相同的目录中启动。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2010-05-20T06:09:00.367

您可以键入“cd”emacs 命令。( Mx cd ) 将默认文件夹更改为一次性。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-13T11:19:45.187

我放了

```
(cd "c:/cvsroot/") 
```

在我的 .emacs 中，它完成了工作

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-13T13:21:11.727

默认文件夹实际上与缓冲区的当前工作文件夹相同，即您使用的每个文件都可以不同。假设您正在使用的文件位于 中`C:\dir_a`，那么该缓冲区的工作目录将默认为`C:\dir_a`. 您可以更改它`M-x cd`并输入您希望作为默认目录的任何目录（默认情况下，我的意思是当您这样做时会显示的目录`C-x C-f`）。

如果你在没有打开文件的情况下启动 emacs，你最终会`*scratch*`打开缓冲区。如果您从 Windows 快捷方式启动 emacs，则工作目录将与快捷方式属性中指定的目录相同。如果您从命令行启动它，它将是您启动它的目录。您仍然可以使用 , 更改此默认目录`M-x cd`，也可以从`*scratch*`缓冲区中更改。

最后，您可以按照 Vadim 的建议进行操作

```
(cd "c:/dir_a/") 
```

在您的`.emacs`文件中，无论您如何启动 emacs，都要将该目录设为默认目录。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-13T11:23:53.757

当您在 Windows 上时，您可以使用快捷方式进行操作。

创建 的快捷方式`C:\emacs\emacs-21.3\bin\runemacs.exe`。编辑快捷方式的属性并将 的值更改为`Start In:`您想要的默认目录。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-02T12:25:19.667

我在 Windows XP 下使用 emacs 22.2.1，上面的答案帮助我在我想要的命令 Cx Cf 的迷你缓冲区中获得响应。最初我得到像 Anton 一样的“查找文件：C:\Program Files\emacs\bin/”。我将 HOME 设置为“C:\Documents and settings\USER NAME\My Documents”。我想要在 minibuffer 中对 Cx Cf 的响应是“查找文件：~/”。通过将 (setq default-directory "C:/Documents and Settings/USER NAME/My Documents") 添加到我的 .emacs 文件中，我能够得到响应“查找文件：C:\Documents and settings\USER NAME\My Documents /”，其功能与“查找文件：~/”相同。然而，我注意到另一点。“选项”下的“自定义 Emacs”允许我禁止启动屏幕。现在，当我打开 emacs 时，我会立即进入暂存缓冲区。当我在暂存缓冲区中键入 Cx Cf 时，我得到了我想要的确切响应。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-05-18T20:54:35.270

我在我的快捷方式（在 Gnome，Linux 中）添加了一个 pramater，它是一个空白的虚拟文件名，我指定了目录。由于我的 emacs 默认为“home”，我简单地说：

/桌面/空白文件

并打开一个名为“blank_file”的文件

这也会将该 emacs 会话的当前工作目录移动到桌面。

如果我碰巧把东西放在“blank_file”中然后保存它，当然，我已经保存了这些东西。这可能是一个烦恼，也可能是一件好事，这取决于！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-05-21T09:20:38.437

要将 Dired 和 shell 中的默认目录更改为 DESKTOP，请将其放入 ~/.emacs:

;;这适用于 Windows XP。
(setq 默认目录 (concat "C:\Documents and Settings\MY_ACCOUNT\DESKTOP\"))

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-08-26T16:01:21.737

对于 Windows 用户，我发现最好的方法是创建快捷方式`runemacs.exe`并将快捷方式放在我的笔记文件夹的根目录中。

这样，当你使用这个快捷方式打开 emacs 时，它会默认在根目录下打开，而无需专门设置`Start In`属性（*你可以将`Start In`属性留空*）。

> [参考](https://stackoverflow.com/a/17951772/6908282)：根据微软的说法，如果您将“开始”框留空，脚本将在当前工作目录中运行

## 提示：

此外，如果您已将笔记组织到多个根文件夹（个人、工作等）中，则可以在每个文件夹中复制多个此类快捷方式，以使用其自己的默认目录打开各种 emacs 实例。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-07-29T23:52:06.683

在 Windows 8 中，可以在桌面中创建快捷方式并更改快捷方式的“开始于：”属性。

现在，我按照建议运行了 emacs-23.3\bin\addpm.exe 程序，Windows-8 屏幕（微软的可怕发明）出现了一个指向 Emacs 的图标链接。但是您必须再次更改“开始于”属性。（它与桌面中的不同）。只需右键单击，在底部栏中选择“打开文件位置”（或类似的，我用我的语言完成的），您将被带到带有新快捷方式的文件夹，您可以（必须）在其中更改属性“开始于：”。

有点涉及，但实际上很容易。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-07-22T04:18:09.527

由于最烦人的事情是当您仅使用快捷方式时，Windows Emacs 会将您转储到 system32 中，但希望其他所有情况都能正常工作，只需使用一点 elisp...

(当 (string< "C:\WINDOWS\system32" 默认目录) (setq default-directory "~/"))

因此，当您最终进入系统时，它只会默认为您的主目录。唯一的缺点是如果你真的想在 system32 中启动 emacs ......

# java - 从签名的小程序加载 Java 类

> ID：60470
> 
> 赞同：6
> 
> 时间：2008-09-13T10:51:22.010
> 
> 标签：java, applet, signed, download

如果我正在运行一个签名的 Java 小程序。我可以在同一个域甚至同一个主机中从远程源加载其他类并运行它们吗？

我想在不更改页面甚至停止当前小程序的情况下执行此操作。当然，所有类的总大小太大，无法一次全部加载。

有没有办法做到这一点？有没有办法用签名的小程序来做到这一点并保持他们的“信心”状态？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-13T15:28:18.350

我认为类是在小程序中延迟加载的。按需加载。

无论如何，如果类在 jar 之外，您可以简单地使用 applet 类加载器并按名称加载它们。前任：

```
ClassLoader loader = this.getClass().getClassLoader();
Class clazz = loader.loadClass("acme.AppletAddon"); 
```

如果您想从 jar 加载类，我认为您需要使用 jar 的 url 创建一个 URLClassLoader 的新实例。

```
URL[] urls = new URL[]{new URL("http://localhost:8080/addon.jar")};
URLClassLoader loader = URLClassLoader.newInstance(urls,this.getClass().getClassLoader());
Class clazz = loader.loadClass("acme.AppletAddon"); 
```

默认情况下，applet 被禁止创建新的类加载器。但是，如果您签署您的小程序并包含创建新类加载器的权限，您就可以这样做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T08:35:48.877

是的，您可以打开与运行小程序的主机的 URL 连接。您可以使用 HTTP url 创建一个类加载器，或者将类（作为 jars）下载到用户的机器上，然后在类路径中使用这些 jars 创建一个类加载器。小程序不会停止，您不需要加载另一个页面。

关于您关于信心的问题的第二部分，一旦用户授予对您的小程序的访问权限，它就可以下载任何东西，是的，它想要本地机器。如果您的 UI 设计允许，您可能可以告知用户它在做什么。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-13T14:43:49.640

听起来应该是可能的（但我从来没有做过）。您是否已经看过远程方法调用 ( [RMI](http://java.sun.com/javase/technologies/core/basic/rmi/index.jsp) )？

# .net - 使用 DLR 进行（主要）静态语言编译

> ID：60474
> 
> 赞同：8
> 
> 时间：2008-09-13T10:58:27.390
> 
> 标签：.net, compiler-construction, cil, dynamic-language-runtime

我正在构建一个面向 .NET 的编译器，并且我之前直接生成了 CIL，但是生成 DLR 树将使我的生活变得更加轻松。我支持一些动态特性，即运行时函数创建和鸭式，但绝大多数代码是完全静态的。

既然已经解释了，我有以下问题：

*   除了 MSDN 博客上的小示例之外，DLR 是否已用于静态编译？
*   如果是这样，实现了什么样的性能？
*   如果没有，有什么从根本上阻止这种情况吗？
*   有没有比使用 DLR 或直接发出 IL 更好的代码生成机制？

对此的任何见解或对博客/代码/谈话的引用将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-13T13:30:49.893

我还不知道有人以这种方式使用 DLR，尽管这绝对是它的预期用例之一。要考虑的一件有趣的事情是 DLR 的表达式树已与 LINQ 表达式树合并，因此在一些尚未宣布的 Visual Studio 未来版本中为 LINQ 生成的 IL 将使用 DLR 代码。

将 DLR 作为开源发布的一个巧妙方面是，我们不知道公司以外的人可能会用它做什么有趣的事情:)。

# .net - 开始使用 REST

> ID：60477
> 
> 赞同：33
> 
> 时间：2008-09-13T11:09:32.557
> 
> 标签：.net, web-services, rest

我正在寻找一些关于使用 .NET 创建[REST](http://en.wikipedia.org/wiki/Representational_State_Transfer) ful Web 服务的最佳实践和示例代码的良好链接。

此外，您可能对 REST 提出的任何其他意见将不胜感激。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-13T12:19:30.610

[ADO.Net Data Servcies使得在 .Net 世界中构建和](http://msdn.microsoft.com/en-us/magazine/cc748663.aspx?pr=blog)[使用](http://msdn.microsoft.com/en-us/magazine/cc794279.aspx)RESTful Web 服务变得非常容易，但是理解这些概念很重要。与 WCF（后来添加了 REST 支持）相比，ADO.Net 数据服务主要是为 REST 构建的。

[构建 RESTful Web 服务的指南](http://www.25hoursaday.com/weblog/2007/11/19/GuidelinesForBuildingRESTfulWebServices.aspx)包含有关您需要的资源的所有信息。

这是另一个有用的[博客条目](http://www.25hoursaday.com/weblog/2008/08/17/ExplainingRESTToDamienKatz.aspx)：

统一接口约束描述了为 Web 构建的服务如何成为 Web 体系结构的良好参与者。这些约束简要描述如下：

1) 资源标识：资源是可以命名和表示的任何信息项（例如，文件、给定时间点的股票价格、拉斯维加斯当前的天气等）。您的服务中的资源应使用 URI 进行标识。

2）通过表示操作资源：表示是资源的物理表示，应该对应于有效的媒体类型。使用标准媒体类型作为服务背后的数据格式，可以让广泛的潜在客户访问您的服务，从而扩大服务的覆盖范围。与资源的交互应基于对其 URI 标识的资源表示的检索和操作。

3）自描述消息：遵循服务交互中的无状态原则，使用标准媒体类型并通过HTTP方法使用和控制标头正确指示消息的可缓存性，确保消息是自描述的。自描述消息使得消息可以由客户端和服务器之间的中介处理，而不会影响任何一方。

4）超媒体作为应用程序状态的引擎：应用程序状态应该使用URI和超链接来表示状态之间的转换。这可能是[Roy Fielding 论文](http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm)中提出的架构约束中最具争议性和最不被理解的。事实上，Fielding 的论文包含一个明确的论点，反对使用 HTTP cookie 来表示应用程序状态来强调这一点，但它经常被忽略。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-13T11:16:57.673

Windows Communication Foundation[自 .NET 3.5 起支持 REST 模型](http://blogs.conchango.com/anthonysteele/archive/2008/03/15/rest-from-wcf-3-5.aspx)。

您可以在 MSDN 上找到文档和代码示例：

[休息和痘](http://msdn.microsoft.com/en-us/library/aa395208.aspx)

学习 REST 的一些资源：

*   [xFront.com 上的 REST 文档](http://www.xfront.com/files/rest.html)
*   [架构风格和基于网络的软件架构设计。第 5 章：代表性状态转移 (REST)](http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm)（Roy Fielding 的博士论文 - REST 的作者）
*   [维基百科条目](http://en.wikipedia.org/wiki/Representational_State_Transfer)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-13T11:44:28.560

我读过的最好的介绍是[RESTful Web 服务这本书](http://www.crummy.com/writing/RESTful-Web-Services/)，它不仅解释了模型和原理，还实际向您展示了如何设计 RESTful Web 服务。最有用的是它关于如何编写/指定 REST API 的清单：

1.  找出数据集[即指定数据模型]。
2.  将数据集拆分为资源。对于每种资源：
3.  使用 URI 命名资源。
4.  公开统一接口的一个子集[即指定使用哪些 HTTP 方法以及它们做什么]。
5.  设计从客户端接受的表示[例如，您可以 PUT 或 POST 的 XML 格式]。
6.  设计提供给客户端的表示[例如，您返回的 XML]。
7.  使用超媒体链接和表单将此资源集成到现有资源中。
8.  考虑事件的典型过程：应该发生什么？[这就像一个用例主要成功场景。]
9.  考虑错误情况。[这就像用例异常场景。]

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T21:40:38.797

[“一篇非常清晰的文章，关于如何使用美味使 Web 服务更加 RESTful”](http://www.peej.co.uk/articles/restfully-delicious.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T23:06:37.140

[来自xml.com](http://www.xml.com/)的“ [RESTful Web](http://www.xml.com/pub/au/225) ”系列的文章是一个很好的介绍。

作者（Joe Gregorio，以 The Atom Publishing Protocol 闻名）还定期在他的 [博客](http://bitworking.org/news/)上发布有关 REST 的所有内容的有见地的文章。“ [RESTify DayTrader](http://bitworking.org/news/201/RESTify-DayTrader) ”（应用于基准股票交易应用程序的 REST 架构）是一个很好的起点。我也喜欢“[为什么有这么多 Python Web 框架？](http://bitworking.org/news/Why_so_many_Python_web_frameworks) ”，它展示了一个小型的 RESTful Web 框架在 Python 中的实现。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-12-13T08:28:06.523

当我开始开发 REST Web 服务时，我阅读了 Mark Masse 的 REST API 设计规则手册。一旦您了解了基础知识和理论，您将能够使用 WCF、HTTPListener 或 ServiceStack 实现 REST。所有这些框架都是 .NET 并且有很好的文档记录......

我会向您推荐服务堆栈 (http://www.servicestack.net/)，网上有足够的信息可以开始使用。

WCF 提供了 ASP.NET Web API，没问题，但我没用。

无论如何，今天没有好的 REST 框架，你必须选择一个你认为易于使用的框架，然后应用你从书中学到的理论。

# unit-testing - 自测系统

> ID：60478
> 
> 赞同：3
> 
> 时间：2008-09-13T11:09:53.587
> 
> 标签：unit-testing, language-agnostic

我有一个想法，我正在和一些同事一起考虑。我们都不知道它目前是否存在。

基本前提是拥有一个具有 100% 正常运行时间但可以动态提高效率的系统。

> **这是场景：**
> 
> * 所以我们快速将一个系统散列到一组指定的接口，它有零优化，但我们相信它是 100% 稳定*的（可疑，但为了这个场景，请继续玩）*
> 
> * 然后我们分析原始类，并开始为瓶颈编程替换。
> 
> * 原件和替换件同时启动并同步。
> 
> * 原件可以运行至完成：如果替换件未完成，系统将否决它作为原件的替换件。
> 
> * 替换必须始终返回与原始相同的值、指定次数和特定范围的值，然后才能将其用作原始替换。
> 
> * 如果采用替换后出现异常，系统会自动尝试与被替换的类相同的操作。

**你在实践中见过类似的概念吗？** *请批评...*

> **以下是在关于帖子的初始问题之后写的评论：**
> 
> * 该系统展示了达尔文的系统进化方法。
> 
> * 原始和替换将并行运行而不是串联运行。
> 
> * 竞争条件是多线程应用程序的固有问题，我承认它们。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T18:21:40.973

我相信这个想法是一个有趣的理论辩论，但由于以下原因不是很实用：

1.  为了确保新版本的代码运行良好，您需要拥有出色的自动测试，这是一个很难实现的目标，也是许多公司未能开发的目标。只有在此类自动测试到位后，您才能继续实施系统。
2.  这个系统的重点是性能调优，即 - 代码的特定版本被替换为性能上取代它的版本。对于当今的大多数应用程序，性能是次要的。意思是，大多数应用程序的整体性能是足够的 - 想想看，你可能很少发现自己抱怨“这个应用程序非常慢”，相反你通常会发现自己抱怨缺乏特定功能、稳定性问题、UI 问题等. 即使您确实抱怨运行缓慢，这通常是系统整体运行缓慢，而不仅仅是特定应用程序（当然也有例外）。
3.  对于性能是一个大问题的应用程序或模块，改进它们的方法通常是识别瓶颈，编写新版本并首先独立于系统进行测试，使用某种基准测试。当然，对整个应用程序的新版本进行基准测试也是必要的，但总的来说，我认为这个过程只会发生非常少的次数（遵循 20%-80% 的规则）。在这些情况下，“手动”执行此过程可能比所描述的系统更容易且更具成本效益。
4.  当您添加功能、修复与性能无关的错误等时会发生什么？您不会从该系统中获得任何好处。
5.  同时运行这两个版本来比较它们的性能比你想象的要多得多——不仅你可能有竞争条件，而且如果输入不是一个合适的基准，你可能会得到错误的结果（例如，如果你得到负载小数据包，即 90% 的时间输入是大数据包）。此外，这可能是不可能的（例如，如果实际代码更改了数据，则不能同时运行它们）。

唯一听起来有用并且实际上是“必须”的“环境”是一个“遗传”系统，它自己生成新版本的代码，但这是一个完全不同的故事，并没有真正广泛适用......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-13T12:29:11.040

在运行时运行性能基准测试的系统将比不运行的系统慢。如果目标是优化速度，您为什么不独立进行基准测试并在证明它们更快时导入最快的例程？

您同时启动例程的想法可能会引入[竞争条件](http://en.wikipedia.org/wiki/Race_condition)。

此外，如果目标是确保 100% 的正常运行时间，您不希望引入未经测试的例程，因为它们可能会产生无法捕获的异常。

也许您的想法作为基准测试的工具而不是操作系统具有价值？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-13T12:42:20.120

我在实践中见过类似的概念吗？不，但无论如何我都会提出一种方法。

似乎您的大多数目标都可以通过某种超级源代码控制系统来实现，可以使用[CruiseControl](http://en.wikipedia.org/wiki/CruiseControl)来实现。

CruiseControl 可以运行单元测试以确保新版本的正确性。

您必须编写一个 CruiseControl 构建器[插件](http://cruisecontrol.sourceforge.net/main/plugins.html)，该插件将针对一系列现有基准执行系统的新版本，以确保新版本是一个改进。

如果 CruiseControl 构建循环通过，则将接受新版本。这样的过程需要付出相当大的努力才能实施，但我认为这是可行的。单元测试和基准构建器必须非常巧妙。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-13T13:15:31.803

我认为像 OSGi 或 Spring 这样的控制反转容器可以完成您所说的大部分工作。（按名称动态加载）

你可以建立在他们的东西之上。然后实现你的代码

1.  将工作单元划分为离散的模块/类（策略模式）
2.  通过唯一的名称识别每个模块并将功能与其关联
3.  当一个模块被请求时，它是由能力请求的，并且随机使用具有该能力的模块之一。
4.  保持性能统计（在执行前后获取系统滴答并存储结果）
5.  如果发生异常，将该模块标记为不使用并记录异常。

如果模块通过消息传递完成它们的工作，您可以存储消息直到操作成功完成，如果发生异常，则使用另一个模块重做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T21:01:36.843

有关高可用性系统的设计理念，请查看 Erlang。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T21:17:24.513

我不认为代码本身会变得更好。然而，一些运行时参数可以很容易地调整到最佳值，但这只是常规编程，对吧？

关于即时更改，我已经分享了这个疑惑，并将在 Lua 或类似的动态语言之上构建它。可以有已装载的部件，如果它们被更换，则重新装载以投入使用。也没有火箭科学。如果“旧代码”仍在运行，那完全没问题，因为与 DLL 不同，该文件仅在读入时才需要，而不是在执行来自那里的代码时。

用处？呐……

# javascript - 在 Windows Mobile 设备上编写 JavaScript/Ruby 应用程序的最佳方式是什么？

> ID：60484
> 
> 赞同：8
> 
> 时间：2008-09-13T11:29:17.720
> 
> 标签：javascript, ruby, windows-mobile, pocketpc

我最近购买了一台 Windows Mobile 设备，因为我是一名开发人员，所以我想将其用作开发平台。是的，它不应该那样使用，但它总是和我在一起，而我的笔记本电脑不是。我知道[cke](http://www.animaniak.com/cke/cke_main.asp)是一个很好的代码编辑器，但是我怎样才能运行 JavaScript/Ruby 代码而不会太头疼呢？

我可能可以编写一个 Web 应用程序，向它发送代码并获取结果，但也许有更好的解决方案？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T09:25:15.920

有可能[**在 Windows Mobile 上运行 Ruby**](http://uema2.s8.xrea.com/ruby-mswince/)

查看这篇文章的步骤：[**人与机器**](http://andryshuzain.com/journal/ruby-on-windows-mobile-5)

Javascript 在 Windows Mobile 上有点残缺。在这里跟进讨论：[**Windows Mobile IE 团队博客**](http://blogs.msdn.com/iemobile/archive/2006/04/06/570375.aspx) 如果 Pocket Internet Explorer 支持更好，希望下一个版本！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T10:31:21.153

我不确定你是否感兴趣，但只有一个用于 CE 的 Python 端口。

[http://pythonce.sourceforge.net/](http://pythonce.sourceforge.net/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T02:12:41.697

您还可以使用 Evolane ( [http://www.evolane.com/software/etcl](http://www.evolane.com/software/etcl) ) 的 etcl。

它带有控制台。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-13T23:44:37.533

这是 Ruby 到 WinCE 的旧端口，但从我读过的内容来看，它并不能很好地工作 - 谁知道，试一试，YMMV

[http://uema2.s8.xrea.com/ruby-mswince/](http://uema2.s8.xrea.com/ruby-mswince/)

至于 Javascript，WinMo 设备有 Pocket Internet Explorer - 它不是很好，但运行一些 Javascript。如果你想要更接近桌面的东西，你可以安装 Opera。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-23T01:11:18.720

Rhomobile 的开源框架 Rhodes (www.rhomobile.com) 在 Windows Mobile 上运行良好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T13:19:32.447

我拥有一部 Windows Mobile 手机已经一个多月了，并且还想在上面运行代码。不幸的是，它是一个如此有限的平台，几乎没有任何社区支持。在我看来，唯一不错的选择是[Python](http://pythonce.sourceforge.net/)、[NSBASIC](http://www.nsbasic.com/ce/)和[PPL](http://www.arianesoft.ca/page.php?1)

对于 Javascript，您最好使用 Opera，而不是 Pocket Internet Explorer。

至于cke，我发现[CEdit](http://www.logicalsky.com/Product_CEdit.htm)是一个更稳定的编辑器，但你必须为此付费。虽然我认为没有任何编辑器可以在 Window Mobile 上为 Ruby 进行语法高亮显示。

# c++ - C++ 函数指针和类

> ID：60507
> 
> 赞同：12
> 
> 时间：2008-09-13T12:53:06.473
> 
> 标签：c++, oop, class, function-pointers

说我有：

```
void Render(void(*Call)())
{
    D3dDevice->BeginScene();
    Call();
    D3dDevice->EndScene();
    D3dDevice->Present(0,0,0,0);
} 
```

只要我要用于渲染的函数是函数或`static`成员函数，这很好：

```
Render(MainMenuRender);
Render(MainMenu::Render); 
```

但是，我真的希望能够使用类方法，因为在大多数情况下，渲染函数会想要访问成员变量，并且我宁愿不使类实例成为全局的，例如

```
Render(MainMenu->Render); 
```

但是我真的不知道如何做到这一点，并且仍然允许使用函数和`static`成员函数。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-13T13:02:16.110

有很多方法可以给这只猫换皮，包括模板。我最喜欢的是[Boost.function](http://www.boost.org/doc/libs/1_36_0/doc/html/function.html)，因为我发现从长远来看它是最灵活的。还要阅读[Boost.bind](http://www.boost.org/doc/libs/1_36_0/libs/bind/bind.html)以了解绑定到成员函数以及许多其他技巧。

它看起来像这样：

```
#include <boost/bind.hpp>
#include <boost/function.hpp>

void Render(boost::function0<void> Call)
{
    // as before...
}

Render(boost::bind(&MainMenu::Render, myMainMenuInstance)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T13:01:57.560

您可以创建一个包装函数`void Wrap(T *t)`，该函数只调用`t->Call()`并将`Render`此类​​函数与对象一起使用。那是：

```
void Wrap(T *t)
{
  t->Call();
}

void Render(void (*f)(T *), T *t)
{
  ...
  f(t);
  ...
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-13T13:55:09.803

[C++ 常见问题解答：指向成员的指针](http://www.parashift.com/c++-faq-lite/pointers-to-members.html)怎么说？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T13:04:02.923

我这样做了一次，它定义了一个全局函数“Call”，它接受指向您的实例的指针作为成员

```
void CallRender(myclass *Instance)
{
  Instance->Render();
} 
```

所以渲染变成：

```
void Render(void (*Call)(myclass*), myclass* Instance)
{
  ...
  Call(Instance);
  ...
} 
```

您对渲染的调用是：

```
Render(CallRender, &MainMenu); 
```

我知道它很难看，但对我有用（我使用的是 pthreads）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T13:19:34.493

除非您也引用了该对象，否则您不能从指针调用成员函数。例如：

```
((object).*(ptrToMember))
```

因此，如果不更改渲染方法的签名，您将无法实现这一目标。 [本文](http://www.parashift.com/c++-faq-lite/pointers-to-members.html)解释了为什么这通常是一个坏主意。

更好的方法可能是定义一个“渲染器”接口，您的具有渲染方法的类可以实现该接口，并将其作为您的主要渲染方法的参数类型。然后，您可以编写一个“StaticCaller”实现来支持通过引用调用您的静态方法。

例如（我的 C++ 真的很生锈，我也没有编译过这个）。

```
 void Render(IRenderer *Renderer)
{
    D3dDevice->BeginScene();
    Renderer->Render();
    D3dDevice->EndScene();
    D3dDevice->Present(0,0,0,0);
}

// The "interface"
public class IRenderer 
{
public:
    virtual void Render();
};

public class StaticCaller: public IRenderer
{
    void (*Call)();
public:

    StaticCaller((*Call)())
    {
        this->Call = Call;
    }

    void Render()
    {
        Call();
    }
}; 
```

所有这些都是非常样板，但它应该提高可读性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T22:40:35.310

您可以使用以下方法声明指向类 T 的成员函数的函数指针：

```
typedef void (T::*FUNCTIONPOINTERTYPE)(args..)
FUNCTIONPOINTERTYPE function; 
```

并将其调用为：

```
T* t;
FUNCTIONPOINTERTYPE function;
(t->*function)(args..); 
```

将其推断为具有可变参数、类型、返回值等的有用柯里化系统是单调且令人讨厌的。我听说过关于上述 boost 库的好消息，所以我建议在做任何激烈的事情之前先调查一下。

# asp.net-mvc - 在 MVC 应用程序中将母版页的代码放在哪里？

> ID：60516
> 
> 赞同：8
> 
> 时间：2008-09-13T13:05:04.217
> 
> 标签：asp.net-mvc, master-pages

我在我的 ASP.NET MVC 应用程序中使用了几个（2 或 3）母版页，它们必须每个都显示来自数据库的信息位。例如赞助商名单、当前资金状况等。

所以我的问题是，我应该把这些母版页数据库调用代码放在哪里？

通常，这些应该进入它自己的控制器类，对吧？但这意味着我必须手动连接它们（例如传递 ViewDatas），因为它超出了 MVC 框架提供的正常路由框架。

有没有办法干净地做到这一点，而无需手动将 ViewData 传递/操作调用连接到母版页或对框架进行子类化？

文档的数量非常少......而且我对这一切都很陌生，包括 MVC 本身的概念，所以请分享你的提示/技术。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T14:19:14.600

一种方法是在主页面视图中放置 ViewData 的钩子，然后定义一个 BaseController : Controller（或多个基类），您可以在其中执行所需的所有 db 调用。

[您想要做的与本文](http://weblogs.asp.net/stephenwalther/archive/2008/08/12/asp-net-mvc-tip-31-passing-data-to-master-pages-and-user-controls.aspx)中描述的完全一样。

我希望这有帮助！

问候

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T19:56:20.880

好问题。您有多种选择。

1.  在您的母版页上进行 jQuery 调用，从控制器中获取您需要的数据，然后再次使用 jQuery 填充您的字段。
2.  您的第二个选项是创建用户控件，它们自己调用控制器来填充他们的信息。

我认为最好的选择是为您的母版页中需要填充数据的区域创建控件。从而让您的母版页严格包含设计元素。祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T20:49:40.010

如果您不介意强类型视图数据，您可以将所有母版页数据放在 viewData 的公共基类中。您可以在基类的构造函数中设置此数据。所有需要额外数据的视图都需要继承自这个基类的强类型视图数据。

要允许在没有任何显式视图数据的情况下在控制器中调用 View()，您可以在 ControllerBase 中覆盖 View：

```
protected override ViewResult View(string viewName, string masterName, object model)
{
    if (model == null)
    {
        model = new ViewDataBase();
    }
    return base.View(viewName, masterName, model);
} 
```

# sql - 在数据库中使用事务有哪些问题？

> ID：60518
> 
> 赞同：1
> 
> 时间：2008-09-13T13:07:39.123
> 
> 标签：sql, transactions, deadlock

从[这个帖子](https://stackoverflow.com/questions/60419/do-i-really-need-to-use-transactions-in-stored-procedures-mssql-2005)。一个明显的问题是可扩展性/性能。交易使用还会引发哪些其他问题？

你能说有两组问题，一组是长期运行的事务，一组是短期运行的事务吗？如果是，您将如何定义它们？

编辑：死锁是另一个问题，但数据不一致可能会更糟，具体取决于应用程序域。假设一个值得交易的领域（银行，使用规范的例子），死锁的可能性更像是为确保数据一致性而付出的代价，而不是交易使用的问题，或者你会不同意？如果是这样，您将使用哪些其他解决方案来确保无死锁的数据一致性？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-13T13:20:04.630

即使不使用显式事务，也可能出现死锁。一方面，大多数关系数据库将对您执行的每条语句应用一个隐式事务。

死锁基本上是由获取多个锁引起的，任何涉及获取多个锁的活动都可能与涉及获取至少两个与第一个活动相同的锁的任何其他活动发生死锁。在数据库事务中，某些获取的锁可能会比其他情况下持有的时间更长——事实上，直到事务结束。持有的锁越长，发生死锁的机会就越大。这就是为什么一个运行时间较长的事务比一个较短的事务更有可能发生死锁。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T12:25:14.713

它很大程度上取决于数据库内部的事务实现，也可能取决于您使用的事务隔离级别。我在这里假设“可重复读取”或更高。长时间保持事务打开（即使是没有修改任何内容的事务）会强制数据库保留经常更改的表的已删除或更新行（以防万一您决定读取它们），否则这些表可能会被丢弃。

此外，回滚事务可能非常昂贵。我知道在 MySQL 的 InnoDB 引擎中，回滚一个大事务可能需要比提交它更长的时间（我们已经看到回滚需要 30 分钟）。

Another problem is to do with database connection state. In a distributed, fault-tolerant application, you can't ever really know what state a database connection is in. Stateful database connections can't be maintained easily as they could fail at any moment (the application needs to remember what it was in the middle of doing it and redo it). Stateless ones can just be reconnected and have the (atomic) command re-issued without (in most cases) breaking state.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T13:13:17.283

事务的一个问题是有可能（不太可能，但可能）在数据库中出现死锁。为了调试这些有趣/令人沮丧的问题，您必须了解您的数据库如何工作、锁定、事务等。

-亚当

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-13T13:18:03.263

我认为主要问题在于设计层面。我在我的应用程序中的哪个或多个级别使用事务。

例如我可以：

*   在存储过程中创建事务，
*   使用数据访问 API (ADO.NET) 控制事务
*   在应用程序中使用某种形式的隐式回滚
*   （通过 DTC / COM+）中的分布式事务。

在同一应用程序中使用这些级别中的一个以上通常似乎会产生性能和/或数据完整性问题。

# zedgraph - 平滑没有“凹凸”的 Zedgraph 线图

> ID：60542
> 
> 赞同：1
> 
> 时间：2008-09-13T13:38:39.830
> 
> 标签：zedgraph, smooth, linegraph

当您将 Zedgraph 用于线图并将 IsSmooth 设置为 true 时，线条会很好地弯曲，而不是有硬角/角度。

虽然这对于大多数图表来说看起来要好得多 - 在我的拙见中 - 有一个小问题。平滑算法使线在向上或向下移动之前稍微“下潜”或“颠簸”。

在大多数情况下，如果数据点本身是平滑的，这不是问题，但如果您的数据点从 0 到 15，“下潜”会使线在 x 轴下方，这看起来好像有是一些低于零的数据点（事实并非如此）。

我该如何解决这个问题（最好很容易；）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-21T20:41:36.160

对此没有简单的答案。将张力保持在零附近将是您最简单的解决方案。

ZedGraph 使用 GDI 的 DrawCurve 张力参数来应用平滑度，这可能是 Hermite Interpolation。您可以尝试实现自己的余弦插值，由于其性质，这将保持局部极值。您可以查看此链接以了解原因： [http ://local.wasp.uwa.edu.au/~pbourke/miscellaneous/interpolation/](http://local.wasp.uwa.edu.au/~pbourke/miscellaneous/interpolation/)

编辑：网站已关闭。这是页面的缓存版本：http: [//web.archive.org/web/20090920093601/http ://local.wasp.uwa.edu.au/~pbourke/miscellaneous/interpolation/](http://web.archive.org/web/20090920093601/http://local.wasp.uwa.edu.au/~pbourke/miscellaneous/interpolation/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T15:05:00.247

您可以尝试向上或向下更改 myCurve.Line.SmoothTension 属性，看看是否有帮助。

# c - C（或任何）编译器确定性性 能

> ID：60547
> 
> 赞同：18
> 
> 时间：2008-09-13T13:47:04.350
> 
> 标签：c, compiler-construction, deterministic, embedded

在处理最近的一个项目时，一位客户 QA 代表拜访了我，他问了我一个我以前没有真正考虑过的问题：

> 您如何知道您使用的编译器生成的机器代码与 c 代码的功能完全匹配并且编译器是完全确定的？

对于这个问题，我完全没有回答，因为我一直认为编译器是理所当然的。它接收代码并输出机器代码。我怎样才能开始测试编译器实际上并没有添加我没有要求的功能？或者更危险地以与我期望的方式略有不同的方式实现代码？

我知道这对每个人来说可能并不是一个真正的问题，实际上答案可能只是......“你已经过了桶并处理它”。但是，在嵌入式环境中工作时，您隐含地信任您的编译器。我如何向自己和 QA 证明我这样做是正确的？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-13T14:10:58.830

您可以在任何级别应用该论点：您信任第三方库吗？你相信操作系统吗？你相信处理器吗？

当然，为什么这可能是一个有效问题的一个很好的例子是，Ken Thompson 如何在原始的“登录”程序中放置一个后门......并修改了 C 编译器，以便即使您重新编译登录，您仍然可以获得后门。有关更多详细信息，请参阅此[帖子](http://it.toolbox.com/blogs/puramu/ken-thompson-and-the-selfreferencing-c-compiler-16142)。

关于加密算法也提出了类似的问题——我们怎么知道 DES 中没有可供 NSA 窥探的后门？

最后，您必须决定是否足够信任您所构建的基础设施而不必担心，否则您必须开始开发自己的硅芯片！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-13T18:05:12.857

对于安全关键的嵌入式应用，认证机构需要满足编译器的“使用验证”要求。通常有某些要求（有点像“营业时间”）需要通过详细的文档来满足和证明。然而，大多数人不能或不想满足这些要求，因为这可能非常困难，尤其是在您的第一个项目中使用新的目标/编译器。

另一种方法基本上是根本不信任编译器的输出。除了后来的功能测试之外，任何编译器甚至与语言相关的（C-90 标准的附录 G，有人知道吗？）缺陷都需要通过一组严格的静态分析、单元和覆盖测试来覆盖。

像[MISRA-C](http://www.embedded.com/columns/beginerscorner/9900659?_requestid=212266)这样的标准可以帮助将编译器的输入限制为 C 语言的“安全”子集。另一种方法是将编译器的输入限制为语言的一个子集，并测试整个子集的输出是什么。如果我们的应用程序仅由子集的组件构建，则假定知道编译器的输出将是什么。通常通过“编译器的资格”进行。

所有这一切的目标是能够用“我们不仅依赖编译器的确定性，而且这是我们证明它的方式......”来回答 QA 代表的问题。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-16T21:33:37.947

你通过测试就知道了。测试时，您正在测试代码和编译器。

您会发现，您或编译器编写者出错的几率远小于使用某种汇编语言编写相关程序时出错的几率。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-17T22:52:06.593

有可用的编译器验证套装。
我记得的一个是[“多年生”](http://www.peren.com/pages/cvsa_set.htm)。

当我为嵌入式 SOC 处理器开发 C 编译器时，我们必须针对这个和另外两个验证套装（我忘记了它的名字）来验证编译器。验证编译器与这些测试套件的一致性程度是合同的一部分。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-13T14:08:01.757

这一切都归结为信任。您的客户是否信任任何编译器？使用它，或者至少比较你和他们的输出代码。

如果他们不信任任何人，是否有该语言的参考实现？你能说服他们相信它吗？然后将您的与参考进行比较或使用参考。

这一切都假设您实际上验证了从供应商/供应商处获得的实际代码，并且您检查了编译器没有被篡改，这应该是第一步。

无论如何，这仍然留下了一个问题，即如何在没有引用的情况下从头开始验证编译器。这当然看起来像大量的工作，并且需要定义语言，这并不总是可用的，有时定义是编译器。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-07T00:56:04.890

> 您如何知道您使用的编译器生成的机器代码与 c 代码的功能完全匹配并且编译器是完全确定的？

你没有，这就是你测试生成的二进制文件的原因，以及为什么你确保发布你测试过的相同的二进制文件。以及为什么当您进行“次要”软件更改时，您进行回归测试以确保没有旧功能损坏。

我认证的唯一软件是航空电子设备。FAA 认证不足以证明该软件可以正常工作，同时它确实会迫使您跳过一定数量的障碍。诀窍是构建你的“过程”，尽可能地提高质量，尽可能少地避免多余的跳圈。因此，任何你知道的东西都是毫无价值的，并且实际上不会发现错误，你可能可以摆脱。你知道你应该做的任何事情，因为它*会*发现 FAA 没有明确要求的错误，你最好的办法是扭曲词，直到听起来你给 FAA/你的 QA 人员他们要求的东西。

这实际上并不像我所说的那样不诚实，总的来说，FAA 更关心你是否认真和自信，你正在*努力*做好工作，而不是你到底做了什么。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-08T02:28:33.267

一些智力弹药可能会在国防软件工程师杂志 Crosstalk 中找到。这个问题是他们花了很多醒着的时间来做的事情。 [http://www.stsc.hill.af.mil/crosstalk/2006/08/index.html](http://www.stsc.hill.af.mil/crosstalk/2006/08/index.html) （如果我能从一个旧项目中找到我的旧笔记，我会回到这里......）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-26T14:23:58.397

您永远无法完全信任编译器，即使是强烈推荐的编译器。他们可以发布有错误的更新，并且您的代码编译相同。当使用有缺陷的编译器更新旧代码时，这个问题变得更加复杂，进行测试并运送货物只是让客户在 3 个月后给您打电话给您一个问题。

这一切都回到了测试上，如果我学到了一件事，那就是在任何重要的变化之后彻底测试。如果问题似乎无法找到，请查看已编译的汇编器并检查它是否在做它应该做的事情。

有几次我在编译器中发现了错误。曾经有一个错误，其中 16 位变量会增加但没有进位，并且只有当 16 位变量是在头文件中定义的外部结构的一部分时。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-13T15:27:22.297

您不确定编译器是否会完全按照您的预期执行。当然，原因是**编译器是软件的一部分**，因此容易出现错误。

编译器编写者具有使用高质量规范工作的优势，而我们其他人则必须在进行过程中弄清楚我们在做什么。但是，编译器规范*也*存在错误，以及具有微妙交互的复杂部分。因此，弄清楚编译器应该做什么并不是一件容易的事。

尽管如此，一旦你确定了你认为语言规范的含义，你就可以为每一个细微差别编写一个好的、快速的、自动化的测试。这就是编译器编写比编写其他类型的软件具有巨大优势的地方：在测试方面。每个 bug 都成为一个自动化测试用例，并且测试套件可以非常彻底。编译器供应商在验证编译器正确性方面投入的预算比您多得多（您已经有一份日常工作，对吧？）。

这对你意味着什么？这意味着您需要对编译器中可能存在的错误持开放态度，但您自己可能不会发现任何错误。

我会选择一个编译器供应商，该供应商短期内不太可能倒闭，其编译器具有高质量的历史，并且已经证明他们有能力为他们的产品提供服务（修补）。随着时间的推移，编译器似乎变得更加正确，所以我会选择一个已经存在大约一两年的编译器。

**将注意力集中在正确编写代码上。** 如果它是**清晰和简单**的，那么当您*遇到*编译器错误时，您将不必费力地思考问​​题所在。 **编写好的单元测试**，这将确保您的代码按照您的预期执行。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-24T03:38:34.240

> ...您隐含地信任您的编译器

当您第一次遇到编译器错误时，您将停止这样做。;-)

但最终这就是测试的目的。对于您的测试制度而言，错误最初是如何进入您的产品并不重要，重要的是它没有通过您的广泛测试制度。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-01-08T02:15:23.137

嗯..你不能简单地说你信任你的编译器的输出——特别是如果你使用嵌入式代码。使用不同的编译器编译相同的代码时，不难发现生成的代码之间的差异。之所以如此，是因为 C 标准本身过于松散。许多细节可以由不同的编译器以不同的方式实现，而不会破坏标准。我们如何处理这些东西？我们尽可能避免依赖编译器的构造。我们可以通过选择更安全的 C 子集来处理它，如用户 cschol 之前提到的[Misra-C 。](http://www.embedded.com/columns/beginerscorner/9900659?_requestid=212266)我很少需要检查编译器生成的代码，但这有时也发生在我身上。但是，最终，您依赖于您的测试以确保代码按预期运行。

那里有更好的选择吗？有些人声称有。另一种选择是在[SPARK/Ada中编写代码](http://www.embedded.com/columns/technicalinsights/190400498?_requestid=177701). 我从未在 SPARK 中编写过代码，但我的理解是，您仍然必须将其与用 C 编写的处理“裸机”内容的例程联系起来。SPARK/Ada 的美妙之处在于绝对保证任何编译器生成的代码总是相同的。没有任何歧义。最重要的是，该语言允许您对代码进行注释，并解释代码的行为方式。SPARK 工具集将使用这些注释来正式证明所编写的代码确实做了注释所描述的事情。所以有人告诉我，对于关键系统，SPARK/Ada 是一个不错的选择。不过，我自己从未尝试过。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-13T13:58:34.493

尝试单元测试。

如果这还不够，请使用不同的编译器并比较单元测试的结果。比较 strace 输出，在 VM 中运行测试，记录磁盘和网络 I/O，然后比较它们。

或者建议编写自己的编译器并告诉他们要花多少钱。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-13T14:27:29.680

您最容易证明的是您正在使用来自提供者 X 的未篡改编译器。如果他们不信任提供者 X，那就是他们的问题（如果 X 相当值得信赖）。如果他们不信任任何编译器提供者，那么他们是完全不合理的。

回答他们的问题：我确保通过这些方式使用来自 X 的未篡改编译器。X 享有盛誉，而且我有一组很好的测试表明我们的应用程序的行为符合预期。

其他一切都开始打开蠕虫罐头。正如罗布所说，你必须在某个地方停下来。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-13T15:00:48.320

有时，当您要求进行积极的优化时，您确实会改变行为。

以及优化和浮点数？忘了它！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-17T20:04:56.013

对于大多数软件开发（想想桌面应用程序），答案可能是您不知道也不关心。

在安全关键系统（想想核电站和商业航空电子设备）中，您*需要*注意，监管机构会要求您证明这一点。根据我的经验，您可以通过以下两种方式之一执行此操作：

1.  使用合格的编译器，其中“合格”意味着它已根据监管机构制定的标准进行了验证。
2.  执行目标代码分析。本质上，您编译一段参考代码，然后手动分析输出以证明编译器没有插入任何无法追溯到您的源代码的指令。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-26T14:38:58.927

你得到了 Dijkstra 写的那个。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-01-07T12:51:49.597

选择经过正式验证的编译器，例如 Compcert C 编译器。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-13T14:16:46.197

1.  更改编译器的优化级别将更改输出。
2.  对函数的轻微更改可能会使编译器内联或不再内联函数。
3.  对编译器的更改（例如 gcc 版本）可能会更改输出
4.  某些库函数可能是内在的（即，发出优化的程序集），而其他大多数不是。

好消息是，对于大多数事情来说，它真的没有那么重要。如果它确实很重要（例如，在 ISR 中），您可能需要考虑组装。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-13T14:27:35.123

如果您担心不会产生可见结果的意外机器代码，唯一的方法可能是联系编译器供应商以获得某种令您的客户满意的认证。

否则，您会像了解代码中的错误一样了解它 - 测试。

现代编译器的机器代码可能有很大的不同，对于弱小的人类来说是完全无法理解的。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-13T15:02:57.147

我认为有可能以某种方式将此问题简化为[停机问题](http://en.wikipedia.org/wiki/Halting_problem)。

最明显的问题是，如果你使用某种程序来分析编译器及其确定性，你怎么知道*你的*程序被正确编译并产生了正确的结果？

如果您使用的是另一个“安全”编译器，我不确定。我确信从头开始编写编译器可能会更容易。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-19T00:57:33.900

即使是合格或经过认证的编译器也会产生不良结果。保持你的代码简单，测试，测试，测试。或者手动遍历机器代码，同时不允许任何人为错误。加上操作系统或您正在运行的任何环境（最好没有操作系统，只有您的程序）。

自从软件和编译器出现以来，这个问题已经在关键任务环境中得到了解决。正如许多其他做出回应的人也知道的那样。每个行业都有自己的规则，从经过认证的编译器到编程风格（你必须始终以这种方式编程，永远不要使用这个或那个或其他），大量的测试和同行评审。验证每个执行路径等。

如果您不在这些行业之一，那么您将得到所得到的。COTS 硬件上的 COTS 操作系统上的商业程序。它会失败，这是一种保证。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2010-01-07T18:53:39.597

如果您担心编译器中的*恶意*错误，一个建议（IIRC，某些项目的 NSA 要求）是编译器二进制文件早于编写代码。至少那时您知道没有人*添加*针对*您的*程序的错误。

# apache-flex - Flex 中的终端仿真

> ID：60558
> 
> 赞同：3
> 
> 时间：2008-09-13T14:16:35.027
> 
> 标签：apache-flex

我需要在 Flex 中模拟一些旧的 DOS 或大型机终端。例如，如下图所示。

![替代文字](https://i.stack.imgur.com/qFtvP.png)

不同颜色的文本很容易，但是制作不同背景颜色的能力，例如黄色背景，超出了标准 Flash 文本的能力。

我可能还需要能够在某些地方输入文本并将文本向上滚动到“终端”。知道我会如何攻击这个吗？或者更好的是，这种事情的任何现有代码/组件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-13T15:05:16.237

用于[`TextField.getCharBoundaries`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/text/TextField.html)在需要背景的区域中获取第一个和最后一个字符的矩形。从这些矩形中，您可以构建一个跨越整个区域的矩形。使用它在`Shape`文本字段后面或文本字段的父级中绘制背景。

*更新*您要求的示例，以下是如何从一系列字符中获取矩形：

```
var firstCharBounds : Rectangle = textField.getCharBoundaries(firstCharIndex);
var lastCharBounds  : Rectangle = textField.getCharBoundaries(lastCharIndex);

var rangeBounds : Rectangle = new Rectangle();

rangeBounds.topLeft = firstCharBounds.topLeft;
rangeBounds.bottomRight = lastCharBounds.bottomRight; 
```

如果你想为整条线找到一个矩形，你可以这样做：

```
var charBounds : Rectangle = textField.getCharBoundaries(textField.getLineOffset(lineNumber));

var lineBounds : Rectangle = new Rectangle(0, charBounds.y, textField.width, firstCharBounds.height); 
```

当您拥有要为其绘制背景的文本范围的边界时，您可以在`updateDisplayList`文本字段的父级方法中执行此操作（假设文本字段位于 [0, 0] 并且具有白色文本，并且这`textRangesWithYellowBackground`是一个矩形数组，代表应该有黄色背景的文本范围）：

```
graphics.clear();

// this draws the black background
graphics.beginFill(0x000000);
graphics.drawRect(0, 0, textField.width, textField.height);
graphics.endFill();

// this draws yellow text backgrounds
for each ( var r : Rectangle in textRangesWithYellowBackground )
    graphics.beginFill(0xFFFF00);
    graphics.drawRect(r.x, r.y, r.width, r.height);
    graphics.endFill();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T14:20:47.293

字体的宽度和高度是固定的，因此动态制作背景位图并不难，而且可能是最快捷、最简单的解决方案。事实上，如果你正确调整它的大小，每个字符只会有一个拉伸像素。

根据字符的背景为像素（或多个像素）着色。

-亚当

# winforms - 如何在安装项目结束时运行可执行文件？

> ID：60565
> 
> 赞同：21
> 
> 时间：2008-09-13T14:25:30.370
> 
> 标签：winforms, installation

我有一个 Visual Studio 安装项目，我用它来安装一个相当简单的 WinForms 应用程序。在安装结束时，我有一个自定义用户界面页面，其中显示了一个复选框，询问用户是否要运行该应用程序。我见过其他安装程序经常这样做。但是我找不到在安装完成后让安装项目运行可执行文件的方法。一个想法？

注意：您不能使用自定义操作，因为它们被用作安装过程的一部分，一旦用户在安装结束时按下“关闭”按钮，我想运行我安装的应用程序。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-13T17:17:39.927

我相信这是 Visual Studio 安装项目的真正限制之一。您需要能够修改安装 UI 的最后一页，但 VS.NET 并没有为您提供执行此操作的方法。您可以在构建 .MSI 后修改表，但 VS.NET 可能会在每次构建时覆盖这些更改。您可以使用安装项目中包含的合并模块覆盖最后一页。无论哪种方式，您都需要熟悉如何在 .MSI 中编写 UI 对话框，这并非易事。

您可能需要考虑切换到基于免费脚本的安装程序或购买商业设置创作应用程序（只是不要因为 Pete 的爱而购买 InstallShield）。看看InstallAware（虽然我没用过）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-11-24T12:30:03.887

我刚刚找到了一种不需要外部工具的非常简单的方法。您只需将一个类文件添加到主项目并将自定义操作添加到设置项目。

[http://www.codeproject.com/KB/install/Installation.aspx](http://www.codeproject.com/KB/install/Installation.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-12-10T09:32:03.457

您还可以使用自定义操作

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T16:03:58.717

我通过创建一个 VB 脚本工具来为内部应用程序完成此操作，该工具启动安装程序可执行文件，等待它关闭，然后启动第二个程序。

您还可以在 C 可执行文件中使用一些 Win API 调用来完成此操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T02:55:57.487

您可以使用 MSILAUNCH（尽管我只让它与 MSICREATE 一起使用）。

[http://www.cornerhouse.ca/en/msi.html](http://www.cornerhouse.ca/en/msi.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-13T04:32:46.807

我通过使用以下行调用程序集的 Main 方法来管理它：

```
(typeof(ClassWithinAssemblyToExecute)).Assembly.EntryPoint.Invoke(null, new Object[] {} ) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-29T12:34:13.977

您可以通过自定义安装程序来完成。只需添加安装程序类，您就会在安装后看到许多事件，如安装前。只需在安装后连接并从那里按进程类运行你的 exe。我建议你用谷歌搜索更多关于自定义安装程序的信息。这是一个很好的链接，可以帮助你[http://www.codeproject.com/Articles/19560/Launching-Your-Application-After-Install-using-Vis](http://www.codeproject.com/Articles/19560/Launching-Your-Application-After-Install-using-Vis)

谢谢

# file-io - 如何在 Haskell 中创建内存中的句柄？

> ID：60569
> 
> 赞同：19
> 
> 时间：2008-09-13T14:30:08.287
> 
> 标签：file-io, haskell, io

我想要一些看起来像文件句柄但实际上由内存缓冲区支持的东西，用于 I/O 重定向。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2011-10-09T01:23:22.883

我刚刚编写了一个提供此功能的库，称为“knob”[ [hackage](http://hackage.haskell.org/package/knob) ]。您可以使用它来创建`Handle`引用/修改 a 的 s `ByteString`：

```
import Data.ByteString (pack)
import Data.Knob
import System.IO

main = do
    knob <- newKnob (pack [])
    h <- newFileHandle knob "test.txt" WriteMode
    hPutStrLn h "Hello world!"
    hClose h
    bytes <- Data.Knob.getContents knob
    putStrLn ("Wrote bytes: " ++ show bytes) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T00:54:10.563

如果您可以用 C 或系统调用来表达您想要做的事情，您可以使用 Haskell 的外部函数接口 (FFI)。我开始建议使用 mmap，但转念一想，我认为 mmap 可能是错误的映射方式，即使您将它与匿名选项一起使用也是如此。

您可以在 haskell.org wiki 上找到有关 Haskell FFI 的更多信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-26T03:50:26.307

这实际上是库设计中的一个错误，也是一个让我恼火的错误。我看到了两种做你想做的事的方法，这两种方法都不是很有吸引力。

1.  创建一个新的类型类，使当前句柄成为它的实例，编写另一个实例来执行内存中数据的事情，并更改所有需要使用此工具的程序。可能这就像导入`System.SIO`（或任何您想调用的名称）而不是`System.IO`. 但是，如果您使用库中的自定义 I/O 例程，例如`Data.ByteString`，还有更多工作要做。

2.  重写 I/O 库以扩展它们以支持这一点。不是微不足道的，而且工作量很大，但它不会是特别困难的工作。但是，您会遇到与没有此库的系统的兼容性问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T18:02:19.647

这可能是不可能的。[至少， GHC](http://en.wikipedia.org/wiki/Glasgow_Haskell_Compiler)似乎需要一个句柄来拥有一个用于所有读/写/查找操作的 OS 文件描述符。

参见`/libraries/base/IOBase.lhs`GHC 来源。

您可以通过获取操作系统的帮助来获得相同的效果：创建一个临时文件，将句柄连接到它，然后内存映射该文件以进行 I/O 重定向。这样，所有句柄 I/O 将在内存映射部分中变得可见。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-10T15:41:05.927

要为这个问题添加现代答案，您可以使用`createPipe`from `System.Process`：

```
createPipe :: IO (Handle, Handle) 
```

[https://www.stackage.org/haddock/lts-10.3/process-1.6.1.0/System-Process.html#v:createPipe](https://www.stackage.org/haddock/lts-10.3/process-1.6.1.0/System-Process.html#v:createPipe)

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-09-15T21:44:34.917

不修改编译器是不可能的。这是因为 Handle 是一种抽象数据类型，而不是类型类。

# c++ - 为什么要使用“PIMPL”成语？

> ID：60570
> 
> 赞同：141
> 
> 时间：2008-09-13T14:30:29.657
> 
> 标签：c++, oop, information-hiding, pimpl-idiom

背景资料：

[PIMPL Idiom](http://en.wikipedia.org/wiki/Opaque_pointer) （指向 IPLementation的指针）是一种实现隐藏技术，其中公共类包装了在公共类所属的库之外无法看到的结构或类。

这对库的用户隐藏了内部实现细节和数据。

在实现这个习惯用法时，为什么要将公共方法放在 pimpl 类而不是公共类上，因为公共类的方法实现将被编译到库中并且用户只有头文件？

为了说明，此代码将`Purr()`实现放在 impl 类上并包装它。

**为什么不在公共类上直接实现 Purr 呢？**

```
// header file:
class Cat {
    private:
        class CatImpl;  // Not defined here
        CatImpl *cat_;  // Handle

    public:
        Cat();            // Constructor
        ~Cat();           // Destructor
        // Other operations...
        Purr();
};

// CPP file:
#include "cat.h"

class Cat::CatImpl {
    Purr();
...     // The actual implementation can be anything
};

Cat::Cat() {
    cat_ = new CatImpl;
}

Cat::~Cat() {
    delete cat_;
}

Cat::Purr(){ cat_->Purr(); }
CatImpl::Purr(){
   printf("purrrrrr");
} 
```

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-09-13T14:51:46.893

我认为大多数人将其称为*Handle Body*成语。请参阅 James Coplien 的书*[Advanced C++ Programming Styles and Idioms](https://rads.stackoverflow.com/amzn/click/com/0201548550)*。它也被称为[柴郡猫](http://en.wikipedia.org/wiki/Cheshire_Cat)，因为[刘易斯卡罗尔的](https://en.wikipedia.org/wiki/Lewis_Carroll)角色逐渐消失，直到只剩下笑容。

示例代码应分布在两组源文件中。那么只有*Cat.h*是产品附带的文件。

*CatImpl.h*包含在*Cat.cpp*中，*CatImpl.cpp*包含*CatImpl::Purr()*的实现。使用您的产品的公众不会看到此信息。

基本上，这个想法是尽可能多地隐藏实现以防窥探。

这在您拥有作为一系列库提供的商业产品时最有用，这些库通过 API 访问，客户的代码根据这些库进行编译和链接。

为此，我们在 2000 年重写了[IONA 的](https://en.wikipedia.org/wiki/IONA_Technologies) [Orbix](https://en.wikipedia.org/wiki/Orbix_(software)) 3.3 产品。

正如其他人所提到的，使用他的技术将实现与对象的接口完全分离。然后，如果您只想更改*Purr()*的实现，则不必重新编译使用*Cat*的所有内容。

 *这种技术用于一种称为[按合同设计](http://en.wikipedia.org/wiki/Design_by_contract)的方法中。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-13T15:16:18.597

*   因为您希望`Purr()`能够使用`CatImpl`. `Cat::Purr()`如果没有`friend`声明，将不允许这样的访问。
*   因为你不混合职责：一个类实现，一个类转发。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2014-09-23T11:18:03.327

值得一提的是，它将实现与接口分开。这在小型项目中通常不是很重要。但是，在大型项目和库中，它可用于显着减少构建时间。

考虑到`Cat`可能包括许多头文件的实现，可能涉及模板元编程，这需要时间自行编译。为什么只想使用的用户`Cat`必须包含所有这些？因此，所有必要的文件都使用 pimpl 成语隐藏（因此前向声明`CatImpl`），并且使用界面不会强制用户包含它们。

我正在开发一个用于非线性优化的库（阅读“大量讨厌的数学”），它在模板中实现，因此大部分代码都在标头中。编译大约需要 5 分钟（在一个体面的多核 CPU 上），仅在一个空的文件中解析头文件`.cpp`大约需要 1 分钟。因此，任何使用该库的人每次编译代码时都必须等待几分钟，这使得开发相当[乏味](http://xkcd.com/303/)。但是，通过隐藏实现和标头，只需包含一个简单的接口文件，即可立即编译。

它不一定与保护实现不被其他公司复制有关 - 这可能不会发生，除非可以从成员变量的定义中猜出算法的内部工作原理（如果是这样，它是可能不是很复杂，首先不值得保护）。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-13T15:28:30.783

如果您的类使用 PIMPL 习语，您可以避免更改公共类的头文件。

这允许您向 PIMPL 类添加/删除方法，而无需修改外部类的头文件。您也可以向 PIMPL 添加/删除#includes。

当您更改外部类的头文件时，您必须重新编译 #includes 它的所有内容（如果其中任何一个是头文件，您必须重新编译 #includes 它们的所有内容，依此类推）。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-13T14:53:59.837

*通常，所有者*类（在本例中为*Cat* ）的标头中对 PIMPL 类的唯一引用将是前向声明，正如您在此处所做的那样，因为这可以大大减少依赖关系。

例如，如果您的 PIMPL 类具有*ComplicatedClass*作为成员（而不仅仅是指针或对它的引用），那么您需要在使用之前完全定义*ComplicatedClass 。*实际上，这意味着包括文件“ComplicatedClass.h”（这也将间接包括任何*ComplicatedClass*所依赖的内容）。这可能会导致单个标头填充拉入大量内容，这不利于管理您的依赖项（以及您的编译时间）。

当您使用 PIMPL 成语时，您只需要 #include 在您的*所有者*类型的公共接口中使用的内容（此处为*Cat*）。这让使用你的图书馆的人变得更好，这意味着你不需要担心人们依赖于你图书馆的某些内部部分——无论是错误的，还是因为他们想做你不允许的事情，所以他们#在包含您的文件之前定义私有公共。

如果它是一个简单的类，通常没有任何理由使用 PIMPL，但对于类型非常大的时候，它可能会有很大帮助（尤其是在避免长时间构建方面）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-06-21T13:30:54.247

好吧，我不会用它。我有一个更好的选择：

### 文件*foo.h*

```
class Foo {
public:
    virtual ~Foo() { }
    virtual void someMethod() = 0;

    // This "replaces" the constructor
    static Foo *create();
} 
```

### 文件*foo.cpp*

```
namespace {
    class FooImpl: virtual public Foo {

    public:
        void someMethod() {
            //....
        }
    };
}

Foo *Foo::create() {
    return new FooImpl;
} 
```

这种模式有名字吗？

作为一个同时也是 Python 和 Java 程序员的人，我比 PIMPL 成语更喜欢这个。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-13T14:45:22.180

在 .cpp 文件中调用 impl->Purr 意味着将来您可以做一些完全不同的事情而无需更改头文件。

也许明年他们会发现一个他们可以调用的辅助方法，因此他们可以更改代码以直接调用它，而根本不使用 impl->Purr。（是的，他们也可以通过更新实际的 impl::Purr 方法来实现相同的目的，但是在这种情况下，您会遇到一个额外的函数调用，该调用只能依次调用下一个函数。）

这也意味着标题只有定义，没有任何实现更清晰的分离，这是成语的重点。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-11-11T18:20:59.133

我们使用 PIMPL 习惯用法来模拟[面向方面的编程](https://en.wikipedia.org/wiki/Aspect-oriented_programming)，其中在执行成员函数之前和之后调用 pre、post 和 error 方面。

```
struct Omg{
   void purr(){ cout<< "purr\n"; }
};

struct Lol{
  Omg* omg;
  /*...*/
  void purr(){ try{ pre(); omg-> purr(); post(); }catch(...){ error(); } }
}; 
```

我们还使用指向基类的指针来在许多类之间共享不同的方面。

这种方法的缺点是图书馆用户必须考虑将要执行的所有方面，但只能看到他/她的班级。它需要浏览文档以了解任何副作用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-24T16:34:13.050

在过去的几天里，我刚刚实现了我的第一个 PIMPL 课程。我用它来消除我遇到的问题，包括 Borland Builder 中的文件 *winsock2.*h。它似乎搞砸了结构对齐，因为我在类私有数据中有套接字的东西，这些问题正在蔓延到任何包含标题的 .cpp 文件中。

通过使用 PIMPL，*winsock2.h*仅包含在一个 .cpp 文件中，我可以在其中解决问题，而不必担心它会回来咬我。

为了回答最初的问题，我在将调用转发给 PIMPL 类时发现的优势是 PIMPL 类与您在 pimpl 之前的原始类相同，而且您的实现不会分布在两个以某种奇怪的方式上课。实现公共成员以简单地转发到 PIMPL 类要清楚得多。

就像[Nodet 先生说](https://stackoverflow.com/questions/60570/why-should-the-pimpl-idiom-be-used/60605#60605)的，一个班级，一个责任。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-13T15:31:47.980

我不知道这是否值得一提，但是...

是否可以在自己的命名空间中实现实现，并为用户看到的代码提供公共包装器/库命名空间：

```
catlib::Cat::Purr(){ cat_->Purr(); }
cat::Cat::Purr(){
   printf("purrrrrr");
} 
```

这样，所有库代码都可以使用 cat 命名空间，并且当需要向用户公开一个类时，可以在 catlib 命名空间中创建一个包装器。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T09:54:01.083

我发现它说明了这一点，尽管 PIMPL 习语有多么广为人知，但我认为它在现实生活中并不经常出现（例如，在开源项目中）。

我经常想知道“好处”是否被夸大了；是的，你可以让你的一些实现细节更加隐藏，是的，你可以在不改变标题的情况下改变你的实现，但这些在现实中并不是很明显的优势。

也就是说，不清楚你的实现有没有必要隐藏得*那么*好，而且人们真的只改变实现的情况可能很少见；只要您需要添加新方法，例如，无论如何您都需要更改标题。

# c# - XmlSerializer - 存在反映类型的错误

> ID：60573
> 
> 赞同：355
> 
> 时间：2008-09-13T14:40:21.507
> 
> 标签：c#, .net, xml, serialization, .net-2.0

使用 C# .NET 2.0，我有一个复合数据类，它确实具有`[Serializable]`属性。我正在创建一个`XMLSerializer`类并将其传递给构造函数：

```
XmlSerializer serializer = new XmlSerializer(typeof(DataClass)); 
```

我得到一个例外说：

> 反映类型有错误。

在数据类内部还有另一个复合对象。这是否也需要具有`[Serializable]`属性，或者通过将其放在顶部对象上，它是否递归地将其应用于内部的所有对象？

* * *

## 回答 #1

> 赞同：434
> 
> 时间：2008-09-13T14:53:09.820

看看你得到的内部异常。它会告诉您在序列化时遇到问题的字段/属性。

您可以通过使用属性装饰字段/属性来从 xml 序列化中排除它们[`[XmlIgnore]`](https://docs.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlignoreattribute)。

`XmlSerializer`不使用该[`[Serializable]`](https://docs.microsoft.com/en-us/dotnet/api/system.serializableattribute)属性，所以我怀疑这是问题所在。

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2008-09-13T16:23:20.480

请记住，序列化类必须具有默认（即无参数）构造函数。如果您根本没有构造函数，那很好；但是如果你有一个带参数的构造函数，你也需要添加默认的。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2011-09-16T21:51:10.547

我遇到了类似的问题，结果证明序列化程序无法区分我拥有的两个具有相同名称的类（一个是另一个的子类）。内部异常如下所示：

“Types BaseNamespace.Class1”和“BaseNamespace.SubNamespace.Class1”都使用命名空间“”中的 XML 类型名称“Class1”。使用 XML 属性为类型指定唯一的 XML 名称和/或命名空间。

其中 BaseNamespace.SubNamespace.Class1 是 BaseNamespace.Class1 的子类。

我需要做的是向其中一个类添加一个属性（我添加到基类中）：

```
[XmlType("BaseNamespace.Class1")] 
```

注意：如果您有更多的类层，您还需要为它们添加一个属性。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-13T17:31:05.900

另请注意，`XmlSerializer`无法序列化抽象属性。请[在此处](https://stackoverflow.com/questions/20084/xml-serialization-and-inherited-types)查看我的问题（我已将解决方案代码添加到其中）。

[XML 序列化和继承类型](https://stackoverflow.com/questions/20084/xml-serialization-and-inherited-types)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-02-22T12:29:00.810

我最常见的原因：

```
 - the object being serialized has no parameterless constructor
 - the object contains Dictionary
 - the object has some public Interface members 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-13T15:05:24.223

序列化图中的所有对象都必须是可序列化的。

由于`XMLSerializer`是一个黑盒，如果您想进一步调试序列化过程，请检查这些链接。

[更改 XmlSerializer 输出临时程序集的位置](http://www.hanselman.com/blog/CategoryView.aspx?category=XmlSerializer)

[如何：调试到 .NET XmlSerializer 生成的程序集](http://www.hanselman.com/blog/HOWTODebugIntoANETXmlSerializerGeneratedAssembly.aspx)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-04-26T18:34:26.923

如果您需要处理特定的属性（即 Dictionary 或任何类），您可以实现[IXmlSerialable](http://msdn.microsoft.com/it-it/library/system.xml.serialization.ixmlserializable%28VS.80%29.aspx)接口，这将允许您*以更冗长的编码为代价获得*更多的自由。

```
public class NetService : IXmlSerializable
{
    #region Data

        public string Identifier = String.Empty;

        public string Name = String.Empty;

        public IPAddress Address = IPAddress.None;
        public int Port = 7777;

    #endregion

    #region IXmlSerializable Implementation

        public XmlSchema GetSchema() { return (null); }

        public void ReadXml(XmlReader reader)
        {
            // Attributes
            Identifier = reader[XML_IDENTIFIER];
            if (Int32.TryParse(reader[XML_NETWORK_PORT], out Port) == false)
            throw new XmlException("unable to parse the element " + typeof(NetService).Name + " (badly formatted parameter " + XML_NETWORK_PORT);
            if (IPAddress.TryParse(reader[XML_NETWORK_ADDR], out Address) == false)
            throw new XmlException("unable to parse the element " + typeof(NetService).Name + " (badly formatted parameter " + XML_NETWORK_ADDR);
        }

        public void WriteXml(XmlWriter writer)
        {
            // Attributes
            writer.WriteAttributeString(XML_IDENTIFIER, Identifier);
            writer.WriteAttributeString(XML_NETWORK_ADDR, Address.ToString());
            writer.WriteAttributeString(XML_NETWORK_PORT, Port.ToString());
        }

        private const string XML_IDENTIFIER = "Id";

        private const string XML_NETWORK_ADDR = "Address";

        private const string XML_NETWORK_PORT = "Port";

    #endregion
} 
```

有一篇有趣的[文章](http://msdn.microsoft.com/en-us/magazine/cc164135.aspx)，它展示了一种优雅的方式来实现一种“扩展” XmlSerializer 的复杂方式。

* * *

文章说：

> IXmlSerializable 包含在官方文档中，但文档声明它不打算供公众使用，并且除此之外没有提供任何信息。这表明开发团队希望保留修改、禁用甚至完全删除此可扩展性挂钩的权利。但是，只要您愿意接受这种不确定性并应对未来可能发生的变化，就没有任何理由不能利用它。

因此，我建议实现你自己的`IXmlSerializable`类，以避免过于复杂的实现。

`XmlSerializer`...使用反射实现我们的自定义类可能很简单。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-01-12T12:59:07.013

我刚遇到同样的错误，发现类型属性`IEnumerable<SomeClass>`是问题所在。看来`IEnumerable`不能直接序列化。

相反，可以使用`List<SomeClass>`.

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-07-02T19:32:19.697

我发现 .Net 2.0 中的 Dictionary 类不能使用 XML 序列化，但在使用二进制序列化时可以很好地序列化。

[我在这里](http://weblogs.asp.net/pwelter34/archive/2006/05/03/444961.aspx)找到了一份工作。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-12-17T14:15:18.633

我最近在添加新属性时在 web 参考部分类中得到了这个。自动生成的类正在添加以下属性。

```
 [System.Xml.Serialization.XmlElementAttribute(Order = XX)] 
```

我需要添加一个类似的属性，其顺序比自动生成的序列中的最后一个高一个，这为我修复了它。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-13T15:23:04.103

我也认为 Serializable 属性必须在对象上，但除非我是一个完整的菜鸟（我正处于深夜编码会话的中间），否则[SnippetCompiler](http://www.sliver.com/dotnet/SnippetCompiler/)的以下工作：

```
using System;
using System.IO;
using System.Xml;
using System.Collections.Generic;
using System.Xml.Serialization;

public class Inner
{
    private string _AnotherStringProperty;
    public string AnotherStringProperty 
    { 
      get { return _AnotherStringProperty; } 
      set { _AnotherStringProperty = value; } 
    }
}

public class DataClass
{
    private string _StringProperty;
    public string StringProperty 
    { 
       get { return _StringProperty; } 
       set{ _StringProperty = value; } 
    }

    private Inner _InnerObject;
    public Inner InnerObject 
    { 
       get { return _InnerObject; } 
       set { _InnerObject = value; } 
    }
}

public class MyClass
{

    public static void Main()
    {
        try
        {
            XmlSerializer serializer = new XmlSerializer(typeof(DataClass));
            TextWriter writer = new StreamWriter(@"c:\tmp\dataClass.xml");
            DataClass clazz = new DataClass();
            Inner inner = new Inner();
            inner.AnotherStringProperty = "Foo2";
            clazz.InnerObject = inner;
            clazz.StringProperty = "foo";
            serializer.Serialize(writer, clazz);
        }
        finally
        {
            Console.Write("Press any key to continue...");
            Console.ReadKey();
        }
    }

} 
```

我想 XmlSerializer 正在对公共属性使用反射。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2021-02-20T08:50:28.877

有时，这种类型的错误是因为您没有没有参数的类的构造

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-12-17T22:22:07.277

我有一种情况，其中连续两个元素的顺序相同

```
[System.Xml.Serialization.XmlElementAttribute(IsNullable = true, Order = 0, ElementName = "SeriousInjuryFlag")] 
```

....一些代码...

```
[System.Xml.Serialization.XmlElementAttribute(IsNullable = true, Order = 0, ElementName = "AccidentFlag")] 
```

当我更改代码为类中的每个新属性将顺序增加一时，错误就消失了。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-12-17T10:58:04.863

当我创建具有数据类型 - 的属性时，我遇到了同样的错误`Type`。在这个问题上，我遇到了一个错误——反映类型有一个错误。我不断检查调试坞中每个异常的“InnerException”，并`Type`在我的情况下获得了特定的字段名称（即 ）。解决方法如下：

```
 [XmlIgnore]
    public Type Type { get; set; } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-13T14:55:17.693

另请注意，您不能序列化用户界面控件，并且要传递到剪贴板的任何对象都必须是可序列化的，否则无法传递给其他进程。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-16T13:14:18.520

我一直在使用`NetDataSerialiser`该类来序列化我的域类。[NetDataContractSerializer 类](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.netdatacontractserializer.aspx)。

域类在客户端和服务器之间共享。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-02-16T11:48:17.423

```
[System.Xml.Serialization.XmlElementAttribute("strFieldName", Form = System.Xml.Schema.XmlSchemaForm.Unqualified)] 
```

或者

```
[XmlIgnore]
string [] strFielsName {get;set;} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-05-26T01:19:58.430

我有同样的问题，在我的情况下，该对象有一个 ReadOnlyCollection。集合必须实现 Add 方法才能序列化。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-12-17T10:55:35.803

到目前为止，我对这里描述的所有解决方案都有一个稍微不同的解决方案，所以对于任何未来的文明，这里都是我的！

我已经声明了“时间”的数据类型，因为原始类型是 a`TimeSpan`并随后更改为 a `String`：

```
[System.Xml.Serialization.XmlElementAttribute(DataType="time", Order=3)] 
```

但是实际类型是字符串

```
public string TimeProperty {
    get {
        return this.timePropertyField;
    }
    set {
        this.timePropertyField = value;
        this.RaisePropertyChanged("TimeProperty");
    }
} 
```

通过删除`DateType`属性`Xml`可以序列化

```
[System.Xml.Serialization.XmlElementAttribute(Order=3)]
public string TimeProperty {
    get {
        return this.timePropertyField;
    }
    set {
        this.timePropertyField = value;
        this.RaisePropertyChanged("TimeProperty");
    }
} 
```

# php - 使用本地用户帐户在 Windows 上基于 PHP 表单的身份验证

> ID：60585
> 
> 赞同：5
> 
> 时间：2008-09-13T14:57:45.613
> 
> 标签：php, windows, apache, authentication, sam

我正在运行 PHP、Apache 和 Windows。我没有域设置，所以我希望我的网站的基于表单的身份验证使用 Windows 内置的本地用户帐户数据库（我认为它称为 SAM）。

我知道如果设置了 Active Directory，您可以使用 PHP LDAP 模块在脚本中进行连接和身份验证，但没有 AD 就没有 LDAP。独立机器的等价物是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-14T09:22:01.387

我也没有找到一个简单的解决方案。有使用 CreateObject 和 WinNT ADSI 提供程序的示例。但最终他们都遇到 [了 Active Directory 服务接口 WinNT 提供程序的用户身份验证问题](http://support.microsoft.com/kb/218497)。我不是 100% 确定，但我*猜*WSH/网络连接方法也有同样的问题。
根据[如何在 Microsoft 操作系统上验证用户凭据，](http://support.microsoft.com/kb/180548/)您应该使用 LogonUser 或 SSPI。
它还说

> ```
> 在 Microsoft Windows Server 2003 中，LogonUser Win32 API 不需要 TCB 权限，但是，为了向下兼容，这仍然是最好的方法。在 Windows XP 上，不再需要进程具有 SE_TCB_NAME 权限才能调用 LogonUser。因此，在 Windows XP 上验证用户凭据的最简单方法是调用 LogonUser API。
> ```

因此，如果我确定不需要 Win9x/2000 支持，我会编写一个将 LogonUser 暴露给 php 的扩展。
您可能还对 [NT Accounts 的用户身份验证](http://www.codewalkers.com/c/a/User-Management-Code/User-Authentication-from-NT-Accounts/)感兴趣。它使用 w32api 扩展，需要一个支持 dll ...我宁愿写那个小的 LogonUser-extension ;-)
如果这不可行，我可能会研究 IIS 的 fastcgi 模块以及它的稳定性并让IIS 处理身份验证。

编辑：
我也尝试过利用[System.Security.Principal.WindowsIdentity](http://msdn.microsoft.com/en-us/library/system.security.principal.windowsidentity.aspx)和 php 的[com/.net 扩展名](http://uk.php.net/manual/en/book.com.php)。但是 dotnet 构造函数似乎不允许将参数传递给对象构造函数，并且我从 GetType() 获取程序集（以及 CreateInstance()）的“实验”因“未知 zval”错误而失败。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-14T02:13:33.803

好问题！

我已经考虑过了……我想不出一个好的解决方案。我能想到的是一个可怕的骇人听闻的骇客，它可能会奏效。在看到将近一天没有人发布这个问题的答案后，我认为这是一个不好的答案，但可以工作的答案是可以的。

SAM 文件在系统运行时不受限制。有一些 DLL 注入技巧，您可能可以使用它们，但最终您只会得到密码哈希，并且无论如何您都必须对用户提供的密码进行哈希处理以匹配它们。

您真正想要的是尝试根据 SAM 文件对用户进行身份验证的东西。我认为您可以通过执行以下操作来做到这一点。

1.  在服务器上创建文件共享并进行设置，以便只有您希望能够登录的帐户才能获得访问权限。
2.  在 PHP 中，使用系统命令调用 wsh 脚本，该脚本： 使用网站用户提供的用户名和密码安装共享。记录它是否有效，如果有效则卸载驱动器。
3.  以某种方式收集结果。结果可以在脚本的标准输出上返回给 php，或者希望使用脚本的返回码。

我知道它不漂亮，但它应该工作。

我觉得脏:|

编辑：调用外部 wsh 脚本的原因是 PHP 不允许您使用 UNC 路径（据我所知）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T20:07:18.130

构建 PHP 扩展需要在硬盘空间方面进行相当大的投资。由于我已经安装了 GCC (MinGW) 环境，因此我决定从 PHP 脚本启动进程来降低性能。源代码如下。

```
// Usage: logonuser.exe /user username /password password [/domain domain]
// Exit code is 0 on logon success and 1 on failure.

#include <windows.h>

int main(int argc, char *argv[]) {
    HANDLE r = 0;
    char *user = 0;
    char *password = 0;
    char *domain = 0;
    int i;

    for(i = 1; i < argc; i++) {
        if(!strcmp(argv[i], "/user")) {
            if(i + 1 < argc) {
                user = argv[i + 1];
                i++;
            }
        } else if(!strcmp(argv[i], "/domain")) {
            if(i + 1 < argc) {
                domain = argv[i + 1];
                i++;
            }
        } else if(!strcmp(argv[i], "/password")) {
            if(i + 1 < argc) {
                password = argv[i + 1];
                i++;
            }
        }
    }

    if(user && password) {
        LogonUser(user, domain, password, LOGON32_LOGON_BATCH, LOGON32_PROVIDER_DEFAULT, &r);
    }
    return r ? 0 : 1;
} 
```

接下来是演示其用法的 PHP 源代码。

```
if($_SERVER['REQUEST_METHOD'] == 'POST') {
    if(isset($_REQUEST['user'], $_REQUEST['password'], $_REQUEST['domain'])) {
        $failure = 1;
        $user = $_REQUEST['user'];
        $password = $_REQUEST['password'];
        $domain = $_REQUEST['domain'];

        if($user && $password) {
            $cmd = "logonuser.exe /user " . escapeshellarg($user) . " /password " . escapeshellarg($password);
            if($domain) $cmd .= " /domain " . escapeshellarg($domain);
            system($cmd, $failure);
        }

        if($failure) {
            echo("Incorrect credentials.");
        } else {
            echo("Correct credentials!");
        }
    }
}
?>
<form action="<?php echo(htmlentities($_SERVER['PHP_SELF'])); ?>" method="post">
    Username: <input type="text" name="user" value="<?php echo(htmlentities($user)); ?>" /><br />
    Password: <input type="password" name="password" value="" /><br />
    Domain: <input type="text" name="domain" value="<?php echo(htmlentities($domain)); ?>" /><br />
    <input type="submit" value="logon" />
</form> 
```

# php - 启动下载的最佳方式？

> ID：60590
> 
> 赞同：12
> 
> 时间：2008-09-13T15:00:28.947
> 
> 标签：php, javascript, download

在一个基于 PHP 的网站上，我想在用户填写一个简短的表格后向他们发送一个下载包。由站点启动的下载应该类似于像 download.com 这样的站点，它们说“您的下载将立即开始”。

我知道的几种**可能的方法**，以及浏览器兼容性（基于快速测试）：

**1）做一个`window.open`指向新文件。**

```
- FireFox 3 blocks this.  
 - IE6 blocks this.  
 - IE7 blocks this. 
```

**2) 创建一个指向新文件的 iframe。**

```
- FireFox 3 seems to think this is OK. (Maybe it's because I already accepted it once?)  
 - IE6 blocks this.  
 - IE7 blocks this.

How can I do this so that at least these three browsers will not object? 
```

奖励：是否有不需要浏览器条件语句的方法？

（我相信 download.com 有条件地使用了这两种方法，但我无法让其中任何一种工作。）

**回应和澄清：**

```
Q: "Why not point the current window to the file?"  
A: That might work, but in this particular case, I want to show them some other content while their download starts - for example, "would you like to donate to this project?" 
```

**更新：我已经放弃了这种方法。原因请参阅下面的答案。**

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-13T15:18:14.707

您还可以进行大多数浏览器支持的元刷新。Download.com 将一个放在 noscript 标记中。

```
<meta http-equiv="refresh" content="5;url=/download.php?doc=123.zip"/> 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-16T14:52:18.050

更新：我决定放弃这种方法，而只是向用户提供指向实际文件的链接。我的理由是这样的：

浏览器阻止了我最初尝试从服务器启动的下载。这让我想到：“浏览器是正确的。**它**怎么知道这是合法下载？它**应该**阻止显然不是用户启动的下载。”

我可以用于服务器启动下载的任何方法**也**可以被想要发送恶意软件的人使用。因此，只有当用户通过单击文件的链接来明确请求文件时，才应进行下载。

你可以不同意，如果你仍然想开始下载，希望这个帖子能帮助你。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-13T15:13:45.717

我通常只有一个 PHP 脚本，它使用适当的 Content-Type 将文件直接输出到浏览器

```
if(file_exists($filename)) {
    header("Pragma:  public");
    header("Expires:  0");
    header("Cache-Control:  must-revalidate, pre-check=0");
    header("Cache-Control:  private", false);
    header("Content-Type:  " . $content-type);
    header("Content-Disposition:  attachment; filename=\"" . basename($filename) . "\";" );
    header("Content-Transfer-Encoding:  binary");
    header("Content-Length:  " . filesize($filename));

    readfile("$filename");
}else{
    print "ERROR:  the file " . basename($filename) . " could not be downloaded because it did not exist.";
} 
```

唯一的缺点是，由于这设置了 HTTP 标头，因此在您获得任何其他输出之前已调用它。

但是你可以有一个指向 PHP 下载页面的链接，它会导致浏览器弹出一个下载框，而不会弄乱当前页面的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T13:32:27.020

一个问题是，如果标头没有“正确”设置，您可能会遇到 IE（特别是版本 6）的问题。

确保设置正确的 Content-Type，但也要考虑为 IE 设置缓存选项（至少）以*允许*缓存。如果文件是一个用户可以打开而不是保存的文件（例如 MS Word 文档），IE 的早期版本需要缓存文件，因为他们将“打开”请求传递给适用的应用程序，指向下载的文件在缓存中。

还有一个相关的问题，如果 IE6 用户的缓存已满，它将无法正确保存文件（因此当适用的应用程序伸手打开它时，它会抱怨文件已损坏。

您可能还想关闭下载的任何 gzip 操作（对于 IE）

IE6/IE7 都存在大量下载问题（例如 4.x Gigs...），这不太可能发生，因为 IE 甚至没有下载管理器，但需要注意一些事情。

最后，如果从嵌套 iframe 中启动下载“推送”，IE6 有时不能很好地处理它。我不确定是什么触发了这个问题，但我发现使用 IE6 更容易避免这种情况。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T13:03:01.733

喂！

@Nathan：我决定这样做：让我的“getfile.php”加载所有必要的东西，然后做一个

```
header("Location: ./$path/$filename"); 
```

让浏览器本身并直接对文件执行它认为正确的任何操作。这甚至在我的 Opera 中也能正常工作。

但这在不允许直接访问文件的环境中是个问题，在这种情况下，您将不得不找到不同的方法！（感谢 Discordia，我的文件是公共 PDF！）

最好的问候， 巴斯蒂

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-13T15:06:41.770

如何更改位置以指向新文件？（例如通过改变 window.location）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T15:37:52.240

我一直只是制作一个指向该文件的 iframe。

```
<iframe src="/download.exe" frameborder="0" height="0" width="0"><a href="/download.exe">Click here to download.</a></iframe> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T11:56:47.700

关于不将当前窗口指向下载。根据我的经验，您仍然可以显示您的“请捐赠”页面，因为下载（只要它们发送正确的标题）实际上不会更新浏览器窗口。我在我的一个站点上为 csv 导出执行此操作，就用户而言，它只是弹出一个安全文件窗口。所以我会推荐一个简单的元重定向，就像 Soldarnal 展示的那样。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T12:49:01.490

总结一下，你有两个目标：

1.  开始下载过程
2.  向用户显示带有捐赠选项的页面

为此，我将执行以下操作：

当您的用户提交表单时，他会得到带有捐赠选项的结果页面和一条说明他的下载将在 5 秒后开始的文字。在此页面的头部，您将 META 代码作为 Soldarnal 所说： <meta http-equiv="refresh" content="5;url=/download.php?doc=123.zip>

就这样。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-07T23:40:30.300

```
<a href="normaldownload.zip" onclick="use_dhtml_or_ajax_to_display_page()"> 
```

如果保存下载，当前页面不受影响。只要确保下载不会在同一窗口中打开（正确的 MIME 类型或`Content-Disposition`），您就可以显示任何内容。

[查看更多完整答案](https://stackoverflow.com/a/300517)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-04-17T07:01:30.633

您可以使用 Javascript/jQuery 来启动下载。这是一个示例 - 您可以摆脱 Ajax 请求，只使用 setTimeout() 块。

```
$("btnDownloadCSV").on('click', function() {
    $.ajax({
        url: "php_backend/get_download_url",
        type: 'post',
        contentType: "application/x-www-form-urlencoded",
        data: {somedata: "somedata"},
        success: function(data) {
            // If iFrame already exists, remove it.
            if($("[id^='iframeTempCSV_"]).length) { 
                $("[id^='iframeTempCSV_"]).remove();
            }
            setTimeout(function() {
                //  If I'm creating an iframe with the same id, it will permit download only the first time.
                // So randHashId appended to ID to trick the browser.
                var randHashId = Math.random().toString(36).substr(2);
                // Create a fresh iFrame for auto-downloading CSV
                $('<iframe id="iframeTempCSV_'+randHashId+'" style="display:none;" src="'+data.filepath+'"></iframe>').appendTo('body');
            }, 1000);
        },
        error: function(xhr, textStatus, errorThrown) {
           console.error("Error downloading...");
       }
    });
}); 
```

# php - 在 PHP5 中，我应该使用 Exceptions 还是 trigger_error/set_error_handler？

> ID：60607
> 
> 赞同：33
> 
> 时间：2008-09-13T15:18:54.423
> 
> 标签：php, exception

做任何一种方式的优点/缺点是什么。有一种正确的方式（tm）吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-07-15T02:51:27.953

如果您想在整个应用程序中使用异常而不是错误，您可以使用[ErrorException](http://php.net/ErrorException)和自定义错误处理程序来实现（请参阅 ErrorException 页面以获取示例错误处理程序）。这种方法唯一的缺点是非致命错误仍然会抛出异常，除非被捕获，否则这些异常总是致命的。基本上，如果您的[error_reporting](http://php.net/error_reporting)设置没有抑制它们，甚至`E_NOTICE`会停止您的整个应用程序。

在我看来，使用 ErrorException 有几个好处：

1.  [自定义异常处理程序将允许您使用set_exception_handler](http://php.net/set_exception_handler)显示漂亮的消息，即使是错误消息。
2.  它不会以任何方式破坏现有代码... [trigger_error](http://php.net/trigger_error)和其他错误函数仍将正常工作。
3.  很难忽略触发`E_NOTICE`s 和`E_WARNING`s 的愚蠢编码错误。
4.  您可以使用`try`/`catch`来包装可能会生成 PHP 错误（不仅仅是异常）的代码，这是避免使用`@`错误抑制 hack 的好方法：

    ```
    try {
        $foo = $_GET['foo'];
    } catch (ErrorException $e) {
        $foo = NULL;
    } 
    ```

5.  如果您想在发生任何未捕获的错误时向用户显示友好的消息，您可以将整个脚本包装在单个`try`/块中。`catch`（请谨慎执行此操作，因为只记录未捕获的错误和异常。）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-08T03:39:37.387

您应该在“异常情况”中使用异常，即当您调用方法 doFoo() 时，您应该期望它执行，如果由于某种原因 doFoo 无法完成它的工作，那么它应该引发异常。

很多旧的 php 代码在发生故障时会采用返回 false 或 null 的方法，但这使调试变得困难，异常使调试变得容易得多。

例如，假设您有一个名为 getDogFood() 的方法，它返回一个 DogFood 对象数组，如果您调用此方法并在出现问题时返回 null，您的调用代码将如何判断是否返回 null，因为存在错误还是没有可用的狗粮？

关于处理使用 php 内置错误日志记录的遗留代码库，您可以使用 set_error_handler() 函数覆盖错误日志记录，然后您可以使用该函数重新抛出通用异常。

现在您的所有代码都抛出了详细的异常，您可以自由决定如何处理它们，在代码的某些部分您可能希望捕获它们并尝试替代方法，或者您可以使用自己的日志记录函数记录它们可能会登录到数据库、文件、电子邮件 - 无论您喜欢哪个。简而言之——异常更加灵活。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-13T20:08:05.087

我喜欢使用异常的想法，但我经常涉及第三方库，然后如果他们不使用异常，您最终会使用 3-4 种不同的方法来解决问题！Zend 使用异常。CakePHP 使用自定义错误处理程序，大多数 PEAR 库都使用 PEAR::Error 对象。

我在这方面有一种真正的方式。在这种情况下，自定义错误处理程序路由可能是最灵活的。如果您要么只使用自己的代码，要么使用使用它们的库，例外是一个好主意。

不幸的是，在 PHP 世界中，我们仍然遭受着拒绝放弃 PHP4 的痛苦，所以像异常之类的东西，虽然它们可能代表最佳实践，但在每个人仍在编写能够同时在这 4和 5\. 希望这场灾难现在已经结束，尽管到那时，我们将在 6 和 5 之间出现紧张局势......

/我双手抱头...

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T19:39:45.787

异常的想法很优雅，并且使错误处理过程如此顺畅。但这仅适用于您有适当的异常类并且在团队开发中，更重要的一件事是“标准”异常。所以如果你打算使用异常，你最好先标准化你的异常类型，或者更好的选择是使用一些流行框架的异常。适用于 PHP 的另一件事（您可以在其中编写代码面向对象与结构代码相结合）是，如果您正在使用类编写整个应用程序。如果您正在编写面向对象，那么异常肯定会更好。毕竟我认为你的错误处理过程会比 trigger_error 和其他东西更顺畅。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-13T15:49:04.507

这取决于实际情况。当我编写业务逻辑/应用程序内部时，我倾向于使用异常，而对于验证器和类似的东西，我倾向于使用 trigger_error。

在逻辑级别使用异常的优点是允许您的应用程序在发生此类错误时执行。您允许应用程序进行选择，而不是让业务逻辑知道如何呈现错误。

例如，将 trigger_error 用于 Validator 的专业人士以及类似的事情是，

```
try {
    $user->login();
}  catch (AuthenticationFailureException $e) {
    set_error_handler("my_login_form_handler");
    trigger_error("User could not be logged in. Please check username and password and try again!");
} catch (PersistenceException $pe) { // database unavailable
    set_error_handler("my_login_form_handler"); 
    trigger_error("Internal system error. Please contact the administrator.");
} 
```

其中 my_login_form_handler 修饰字符串并将元素放置在登录表单上方的可见区域中。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-17T11:34:00.407

显然，没有“一条正确的道路”，但对此有很多意见。;)

就我个人而言，我将 trigger_error 用于异常无法执行的操作，即通知和警告（即您想要记录的内容，但不会以与错误/异常相同的方式停止应用程序的流程（即使您在某个级别捕获它们） ））。

我还主要将异常用于假定为不可恢复的条件（对于发生异常的方法的调用者），即严重错误。我不使用异常作为返回具有相同含义的值的替代方法，如果这可能以非复杂的方式进行的话。例如，如果我创建一个查找方法，如果它没有找到它正在寻找的任何东西，我通常会返回一个空值，而不是抛出一个 EntityNotFoundException（或等效项）。

所以我的经验法则是：

*   只要没有找到某些东西是一个合理的结果，我发现返回和检查空值（或其他一些默认值）比使用 try-catch 子句处理它要容易得多。
*   另一方面，如果没有发现它是不在调用者范围内恢复的严重错误，我仍然会抛出异常。

在后一种情况下引发异常（与触发错误相反）的原因是，鉴于您使用正确命名的 Exception 子类，异常更具表现力。我发现在决定使用哪些异常时，使用 PHP 的标准库的异常是一个很好的起点：[http ://www.php.net/~helly/php/ext/spl/classException.html](http://www.php.net/~helly/php/ext/spl/classException.html)

但是，您可能希望扩展它们以针对您的特定情况获得更多语义正确的异常。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-12-01T02:12:53.903

## 介绍

以我个人的经验，作为一般规则，我更喜欢在我的代码中使用 Exceptions 而不是 trigger_error。这主要是因为使用异常比触发错误更灵活。而且，恕我直言，这不仅对我自己和第 3 方开发人员都有好处。

1.  我可以扩展 Exception 类（或使用异常代码）来明确区分我的库的状态。这有助于我和第 3 方开发人员处理和调试代码。这也揭示了它在不需要源代码浏览的情况下**会在哪里以及为什么会失败。**
2.  我可以有效地停止我的库的执行，而无需停止脚本的执行。
3.  第 3 方开发人员可以链接我的异常（在 PHP > 5.3.* 中）对于调试非常有用，并且在处理我的库由于不同原因而失败的情况时可能会很方便。

我可以做到这一切，而不用强加他应该如何处理我的图书馆故障。（即：创建复杂的错误处理函数）。他可以使用 try catch 块或只使用通用异常处理程序

***笔记：***

其中一些点，本质上对 trigger_error 也是有效的，只是实现起来稍微复杂一些。Try catch 块非常易于使用并且对代码非常友好。

* * *

## 例子

我认为这是一个例子可以说明我的观点：

```
class HTMLParser {
    protected $doc;
    protected $source = null;
    public $parsedHtml;
    protected $parseErrors = array();
    public function __construct($doc) {
        if (!$doc instanceof DOMDocument) {
            // My Object is unusable without a valid DOMDOcument object
            // so I throw a CriticalException
            throw new CriticalException("Could not create Object Foo. You must pass a valid DOMDOcument object as parameter in the constructor");
        }
        $this->doc = $doc;
    }

    public function setSource($source) {
        if (!is_string($source)) {
            // I expect $source to be a string but was passed something else so I throw an exception
            throw new InvalidArgumentException("I expected a string but got " . gettype($source) . " instead");
        }
        $this->source = trim($source);
        return $this;
    }

    public function parse() {
        if (is_null($this->source) || $this->source == '') {
            throw new EmptyStringException("Source is empty");
        }
        libxml_use_internal_errors(true);
        $this->doc->loadHTML($this->source);
        $this->parsedHtml = $this->doc->saveHTML();
        $errors = libxml_get_errors();
        if (count($errors) > 0) {
            $this->parseErrors = $errors;
            throw new HtmlParsingException($errors[0]->message,$errors[0]->code,null,
                $errors[0]->level,$errors[0]->column,$errors[0]->file,$errors[0]->line);
        }
        return $this;
    }

    public function getParseErrors() {
        return $this->parseErrors;
    }

    public function getDOMObj() {
        return clone $this->doc;
    }
} 
```

* * *

## 解释

在**构造函数***`CriticalException`*中，如果传递的参数不是类型，我会抛出一个，*`DOMDocument`*因为没有它我的库将根本无法工作。

（注意：我可以简单地写`__construct(DOMDocument $doc)`，但这只是一个例子）。

在方法中，如果传递的参数不是字符串，**`setsource()`**我会抛出一个。*`InvalidArgumentException`*我更喜欢在这里停止库执行，因为**源属性**是我的类的基本属性，并且无效值会将错误传播到我的库中。

该**`parse()`**方法通常是循环中调用的最后一个方法。即使我抛出一个*`XmlParsingException`*if libXML 发现格式错误的文档，解析首先完成并且结果可用（在一定程度上）。

* * *

## 处理示例库

这是一个如何处理这个组成的库的示例：

```
$source = file_get_contents('http://www.somehost.com/some_page.html');
try {
    $parser = new HTMLParser(new DOMDocument());
    $parser->setSource($source)
           ->parse();
} catch (CriticalException $e) {
    // Library failed miserably, no recover is possible for it.
    // In this case, it's prorably my fault because I didn't pass
    // a DOMDocument object.
    print 'Sorry. I made a mistake. Please send me feedback!';
} catch (InvalidArgumentException $e) {
    // the source passed is not a string, again probably my fault.
    // But I have a working parser object. 
    // Maybe I can try again by typecasting the argument to string
    var_dump($parser);
} catch (EmptyStringException $e) {
    // The source string was empty. Maybe there was an error
    // retrieving the HTML? Maybe the remote server is down?
    // Maybe the website does not exist anymore? In this case,
    // it isn't my fault it failed. Maybe I can use a cached
    // version?
    var_dump($parser);
} catch (HtmlParsingException $e) {
    // The html suplied is malformed. I got it from the interwebs
    // so it's not my fault. I can use $e or getParseErrors() 
    // to see if the html (and DOM Object) is usable
    // I also have a full functioning HTMLParser Object and can
    // retrieve a "loaded" functioning DOMDocument Object
    var_dump($parser->getParseErrors());
    var_dump($parser->getDOMObj());
}
$var = 'this will print wether an exception was previously thrown or not';
print $var; 
```

您可以更进一步，嵌套 try catch 块、链接异常、按照确定的异常链路径运行选择性代码、选择性日志记录等......

作为旁注，使用异常并不意味着程序执行将停止，它只是意味着依赖于我的对象的代码将被绕过。由我或第 3 方开发人员随心所欲地处理它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-04T15:47:29.880

异常是指示错误情况/异常情况的现代且稳健的方式。使用它们 ：）

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2012-11-11T19:22:38.580

***在 3rd 方应用程序集成时代，使用异常并不是一个好主意***。

因为，当您尝试将您的应用程序与其他应用程序或其他人的应用程序与您的应用程序集成时，您的整个应用程序将在某个 3rd 方插件中的类抛出异常时停止。即使您有完整的错误处理，在您自己的应用程序中实现日志记录，第三方插件中某人的随机对象也会抛出异常，并且您的整个应用程序将停在那里。

***即使您的应用程序有办法弥补您正在使用的那个库的错误***......

一个例子可能是第 3 方社交登录库，它抛出异常，因为社交登录提供程序返回了一个错误，并且不必要地杀死了你的整个应用程序 - 顺便说一下，hybridauth。所以，你有一个完整的应用程序，你有一个库为你带来了额外的功能——在这种情况下，社交登录——即使你有很多后备的东西，以防提供者没有进行身份验证（你自己的登录系统，再加上大约 20 个其他社交登录提供商），您的整个应用程序将完全停止。而且您最终将不得不更改 3rd 方库来解决这些问题，并且使用 3rd 方库来加速开发的意义将丢失。

在 PHP 中处理错误的理念方面，这是一个严重的设计缺陷。让我们面对现实吧——在当今开发的大多数应用程序的另一端，都有一个用户。无论是 Intranet 用户，还是 Internet 上的用户，还是系统管理员，都无所谓 - 通常有一个用户。

而且，让一个应用程序死在你的脸上，而此时你除了返回上一页并在黑暗中对你正在尝试做的事情一无所知之外，你无能为力，作为用户，这是不好的，开发方面的不良做法。更不用说，由于许多原因（从可用性到安全性）而只有开发人员应该知道的内部错误被抛出到用户的脸上。

结果，我将不得不放弃特定的第 3 方库（在本例中为 hybridauth），而不是在我的应用程序中使用它，仅出于这个原因。尽管hybridauth 是一个非常好的库，并且显然已经在它上面花费了很多精力，并且具有大量的功能。

因此，您应该避免在代码中使用异常。即使您现在正在执行的代码是将运行您的应用程序的顶级代码，而不是库，您也可能希望将全部或部分代码包含在其他项目中，或者必须集成部分或全部与您的其他代码或第 3 方代码。如果你使用异常，你最终会遇到同样的情况——即使你有适当的方法来处理一段代码提供的任何问题，整个应用程序/集成都会死在你的面前。

# .net - 在 Windows 上使用 c# 自动化 Safari Web 浏览器

> ID：60609
> 
> 赞同：4
> 
> 时间：2008-09-13T15:21:53.340
> 
> 标签：.net, windows, automation, safari, watin

我想知道是否有人成功管理或知道如何在 Windows 平台上自动化 Safari 网络浏览器。

理想情况下，我想以类似于将[mshtml](http://msdn.microsoft.com/en-us/library/aa741317.aspx)用于 Internet Explorer 的方式自动化 Safari。如果无法将 JavaScript 注入正在运行的进程中也可以。我已经使用 JavaScript 注入方法通过[jssh](http://www.croczilla.com/jssh)插件自动化 Firefox。

我希望使用 .Net 自动化浏览器以增强现有的自动化框架[WatiN](http://watin.sourceforge.net/)

**编辑**：虽然我认为 selenium 可能是在某些情况下自动化 Safari 的绝佳选择，但我想使用不需要在服务器上安装软件的解决方案，即 Selenium Core 或在 Selenium Remote Control 的情况下的中间代理服务器。

**更新：23-03-2009**：虽然我还没有找到自动化 Safari 的方法，但我找到了一种在 Chrome 中自动化 Webkit 的方法。如果您使用 --remote-shell-port=9999 命令行开关（参考：[http](http://www.ericdlarson.com/misc/chrome_command_line_flags.html) ://www.ericdlarson.com/misc/chrome_command_line_flags.html）运行 Chrome，您可以将 javascript 发送到浏览器。

一旦连接到远程调试视图

*   发送**debug()**以附加到当前选项卡
*   **使用print**发送任何 javascript 命令，即打印 document.window.location.href

我们已使用此方法将[Chrome 支持添加到 WatiN](http://watin.svn.sourceforge.net/viewvc/watin/trunk/src/Core/Native/Chrome/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T18:36:32.897

我不确定这是否有帮助，但 ArtOfTest 的人已经在他们基于 .Net 的自动化框架[WebAii](http://www.artoftest.com)中添加了 Safari 支持。也许你可以弄清楚他们在做什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-20T08:49:14.137

你可以在这里查看我的帖子，我正在使用上述方法在 C# 中自动化 Chrome

[http://markcz.wordpress.com/2012/02/18/automating-chrome-browser-from-csharp/](http://markcz.wordpress.com/2012/02/18/automating-chrome-browser-from-csharp/)

马丁

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T15:40:37.850

[Selenium](http://selenium.openqa.org/)对我进行兼容性测试非常有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-08T15:50:03.403

WatiN 在这里[http://watinandmore.blogspot.com/2010/01/browserattachto-and-iattachto.html](http://watinandmore.blogspot.com/2010/01/browserattachto-and-iattachto.html)让您自动化 IE 和 FF。它是开源的，所以你可以看看他们是如何做到的。

也许您可以根据自己的需要进行调整？

# .net - Silverlight 开发入门

> ID：60620
> 
> 赞同：6
> 
> 时间：2008-09-13T15:38:01.650
> 
> 标签：.net, visual-studio, visual-studio-2008, silverlight

如何在 Silverlight 中开始开发？

是否需要一个新的 IDE？还是 Visual Studio 会支持？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-13T15:46:29.990

是的，Visual Studio 有工具支持。虽然它仍处于测试阶段。

[开始构建 Silverlight 2 应用程序](http://silverlight.net/GetStarted/)

1) 安装 Visual Studio 2008，然后安装 Silverlight Tools Beta 2 for Visual Studio 2008 这个 Visual Studio 2008 的附加组件允许您使用 .NET 创建 Silverlight 2 Beta 2 网站。Silverlight 2 Beta 2 Runtime 和 Silverlight 2 Beta 2 SDK 作为此安装的一部分进行安装。有关更多信息，请阅读概述和 Silverlight 2 Beta 2 自述文件。请注意，如果您安装了 Visual Studio 2008 Service Pack 1 Beta，请参阅此信息以了解有关正确安装的详细信息。

2) 安装 Expression Blend 2.5 2008 年 6 月预览 这是 Expression Blend 的预览版本，用于设计 Silverlight 2 体验。

3) 安装 Deep Zoom Composer 此工具允许您准备图像以用于 Silverlight 2 中的 Deep Zoom 功能。

需要注意的一件事是 Silverlight 不支持对服务器的同步调用。[从这个 Beta](http://petesbloggerama.blogspot.com/2008/07/omg-silverlight-asynchronous-is-evil.html)开始，所有调用都是[异步](http://weblogs.asp.net/scottgu/pages/silverlight-tutorial-part-3-using-networking-to-retrieve-data-and-populate-a-datagrid.aspx)的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T05:35:00.903

让我们系统地解决这个问题，因为有很多东西要学，而且那里有很多信息。您可能希望首先从 Microsoft 的资源开始，因为它们经过了高度审查，并且都集中在一个地方，我们正在努力创建大量资源以顺利进入。然后，当您感到舒适时，您当然也可以扩展到其他资源。

我的建议是记住这个 URL：[http ://silverlight.net](http://silverlight.net)

几乎所有你需要一段时间的东西都在那里。

这是我开始的方式，但也有很多替代路径......

1.  转到[入门页面][1]，但不要下载您看到的所有内容。只关注绿色的大数字 1 和 2，即下载 Visual Studio 2000、Beta 2 VS 200 的工具、Beta 1 包以及 Blend 2.5 June 2008 预览版的链接。

2.  单击菜单上的学习（或单击 [此处][2] ）并观看留置权或下载第一个视频，即 Silverlight 安装体验。

3.  假设您以前没有在 Silverlight 或 WPF 中工作过，我会看看我们的 [showcase][3] 应用程序，只是为了了解 Silverlight 可以做什么。

4.  完成此操作后，我过去推荐的视频顺序在 [this blog entry.][4] 中（您会看到我抄写这些笔记的地方）

一旦掌握了基础知识，请务必查看我们不断扩大的 [教程][5]、[视频][6]、[网络广播][7] 集合，我们还有更多内容即将发布，包括即将发布的书籍，以及许多替代品。此外，明天我将开始每月一次与 [Sparkling Client][8] 合作的博客投稿，我希望这会很有趣且内容丰富。

最后，当您有问题时，您当然可以在这里提问（这看起来是一个巨大的资源！）但如果它们与 Silverlight 相关，您可能还想在我们的 [论坛][9] 上发布它们

希望有帮助。

-杰西自由

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T17:47:03.647

Silverlight 2.0 示例项目的大多数文档以及源代码都可以在 Web 上找到。寻找新的和相关的东西的金矿是每天查看[http://geekswithblogs.net/WynApseTechnicalMusings/Default.aspx](http://geekswithblogs.net/WynApseTechnicalMusings/Default.aspx)，其中链接发布到所有可用的好东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T13:52:35.013

我自己的博客对此发表：

[http://www.codersbarn.com/post/2008/05/07/Beginning-Silverlight-First-Steps.aspx](http://www.codersbarn.com/post/2008/05/07/Beginning-Silverlight-First-Steps.aspx)

安东尼:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-13T17:18:06.807

Dan Wahlin 在以下位置有一些不错的 Silverlight 2 视频：

[http://weblogs.asp.net/dwahlin/archive/2008/03/07/silverlight-2-0-video-tutorials.aspx](http://weblogs.asp.net/dwahlin/archive/2008/03/07/silverlight-2-0-video-tutorials.aspx)

他们很有帮助。

rp

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T07:03:57.140

您可以使用文本编辑器开始为 Silverlight 进行开发。把事情放在一起可能需要更长的时间，但你会更多地了解正在发生的事情。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-03T18:25:13.383

如果您在 2011 年发现自己在这里，当我们达到第 4 版时，现在开始的地方是[Silverlight 入门](http://www.silverlight.net/getstarted/)

# keyboard - 如何保持键盘清洁？

> ID：60629
> 
> 赞同：2
> 
> 时间：2008-09-13T15:48:08.957
> 
> 标签：keyboard

我已经使用相同的键盘大约 3 年了，它变得非常肮脏和恶心。我把它翻过来，不时试着敲出面包屑，不时用外用酒精擦干净。这似乎并没有真正完成这项工作。

还有其他想法吗？盖子？橡胶键盘？换个新键盘？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T15:49:54.350

我经常（一年两次，可能）弹出钥匙。这使您可以访问钥匙的所有侧面以进行清洁，以及下面的托盘。

有些人喜欢使用洗碗机，但我不会将 G15 放入洗碗机中。:-p

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T15:55:26.473

我经常使用一罐压缩空气来清除大部分碎屑，但我还没有尝试过洗碗机的方法。

Jeff 实际上有一篇[关于它](http://www.codinghorror.com/blog/archives/001115.html)的帖子。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-13T15:53:52.080

Dishwasher 让我想起了 Jeff 的这篇文章 ..[清洁你的显示器和键盘](http://www.codinghorror.com/blog/archives/001115.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T15:52:59.693

一旦我发现它们变脏了，我也会弹出键盘的按键并单独清洁每个按键。这需要大约 45 分钟或一个小时才能正确完成，包括托盘。我认为这还不错，因为我大部分时间每天使用键盘 8 小时...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T15:54:28.317

我学会了忽略键盘的状态。只有当钥匙真的变粘时，我才会用一些清洁剂擦掉。

我想我是那些令人作呕、有问题的卫生型极客之一。虽然我*很*喜欢保持鼠标清洁......嗯

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-13T16:31:25.110

甚至没有想过要弹出钥匙。刚刚做了，效果很好。

# c++ - 如何用我自己的实现替换MS VC++项目中的WinAPI函数调用（名称和参数设置相同）？

> ID：60641
> 
> 赞同：1
> 
> 时间：2008-09-13T16:02:07.940
> 
> 标签：c++, winapi, visual-c++

我需要替换所有 WinAPI 调用

*   创建文件，
*   读取文件，
*   设置文件指针，
*   关闭手柄

使用我自己的实现（通过蓝牙使用低级文件读取）。将替换功能的代码是视频文件播放器，它已经适用于常规硬盘文件。如果 VideoPlayer 输入中的文件是常规硬盘文件，还需要 Video Player 仍然可以播放 HDD 中的文件。

这种任务的最佳实践是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T17:03:28.447

我建议您按照以下步骤操作：

1.  编写一组包装函数，例如 MyCreateFile、MyReadFile 等，它们最初只是调用相应的 API 并传递相同的参数，未经修改。
2.  使用您的文本编辑器搜索对原始 API 的所有调用，并将这些调用替换为对新包装函数的调用。
3.  测试应用程序是否仍然正常运行。
4.  修改包装函数以适合您自己的目的。

请注意，CreateFile 是一个宏，可扩展为 CreateFileW 或 CreateFileA，具体取决于是否定义了 UNICODE。考虑使用 LPCTSTR 和[TCHAR 函数](http://msdn.microsoft.com/en-us/library/c426s321%28VS.80%29.aspx)，以便您的应用程序可以构建为 ANSI 或 Unicode。

请不要使用#define，正如其他回复中所建议的那样，因为这只会导致维护问题，并且正如 Maximilian 正确指出的那样，这不是最佳实践。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T09:00:55.253

您可以在自定义命名空间中编写新函数。例如

```
namespace Bluetooth
{
  void CreateFile(/*params*/);
  void etc...
} 
```

然后在您的代码中，您唯一需要更改的是：

```
if (::CreateFile(...))
{
} 
```

到

```
if (Bluetooth::CreateFile(...))
{
} 
```

简单的！:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T16:22:19.233

如果您尝试拦截来自另一个应用程序的对这些 API 的调用，请考虑[Detours](http://research.microsoft.com/sn/detours/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T16:29:13.350

如果您可以编辑代码，您应该重写它以使用自定义 API 来满足您的需求。如果做不到这一点，请使用马克西米利安的技术，但要注意这是一种维护恐惧。

如果您无法编辑代码，您可以修补导入表以将调用重定向到您自己的代码。可以在[本文](http://www.codeproject.com/KB/system/hooksys.aspx)中找到对这种技术的描述- 搜索标题为“通过更改导入地址表进行间谍活动”的部分。

这很危险，但如果你小心，你可以让它发挥作用。还可以查看[Microsoft Detours](http://research.microsoft.com/sn/detours/)，它可以做同样的事情，但不需要您搞乱实际的修补程序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T12:40:02.627

如果您真的想劫持 API，请查看[注射器.dll](http://www.geocities.com/SiliconValley/1741/downloads/) (L-GPL)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-13T16:11:22.643

我认为这不是最佳做法，但如果你将它放在一个包含文件中，它应该可以工作，该文件包含在你想要更改的函数被调用的任何地方：

```
#define CreateFile MyCreateFile

HRESULT MyCreateFile(whatever the params are); 
```

MyCreateFile 的实现如下所示：

```
#undef CreateFile
HRESULT MyCreateFile(NobodyCanRememberParamListsLikeThat params)
{
    if (InputIsNormalFile())
        CreateFile(params);
    else
        // do your thing
} 
```

您基本上使每个 CreateFile 调用都成为 MyCreateFile 调用，您可以在其中决定是否需要使用自己的实现或原始实现。

免责声明：我认为这样做很丑陋，我不会这样做。我宁愿搜索并替换所有出现的东西或其他东西。

# winapi - 匿名管道上的重叠 I/O

> ID：60645
> 
> 赞同：18
> 
> 时间：2008-09-13T16:04:51.960
> 
> 标签：winapi, pipe

是否可以将重叠 I/O 与匿名管道一起使用？CreatePipe() 没有任何指定 FILE_FLAG_OVERLAPPED 的方法，所以我假设 ReadFile() 会阻塞，即使我提供了一个 OVERLAPPED 结构。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-07T09:38:12.957

这是一个匿名管道函数的实现，可以指定 FILE_FLAG_OVERLAPPED：

```
/******************************************************************************\
*       This is a part of the Microsoft Source Code Samples. 
*       Copyright 1995 - 1997 Microsoft Corporation.
*       All rights reserved. 
*       This source code is only intended as a supplement to 
*       Microsoft Development Tools and/or WinHelp documentation.
*       See these sources for detailed information regarding the 
*       Microsoft samples programs.
\******************************************************************************/

/*++
Copyright (c) 1997  Microsoft Corporation
Module Name:
    pipeex.c
Abstract:
    CreatePipe-like function that lets one or both handles be overlapped
Author:
    Dave Hart  Summer 1997
Revision History:
--*/

#include <windows.h>
#include <stdio.h>

static volatile long PipeSerialNumber;

BOOL
APIENTRY
MyCreatePipeEx(
    OUT LPHANDLE lpReadPipe,
    OUT LPHANDLE lpWritePipe,
    IN LPSECURITY_ATTRIBUTES lpPipeAttributes,
    IN DWORD nSize,
    DWORD dwReadMode,
    DWORD dwWriteMode
    )

/*++
Routine Description:
    The CreatePipeEx API is used to create an anonymous pipe I/O device.
    Unlike CreatePipe FILE_FLAG_OVERLAPPED may be specified for one or
    both handles.
    Two handles to the device are created.  One handle is opened for
    reading and the other is opened for writing.  These handles may be
    used in subsequent calls to ReadFile and WriteFile to transmit data
    through the pipe.
Arguments:
    lpReadPipe - Returns a handle to the read side of the pipe.  Data
        may be read from the pipe by specifying this handle value in a
        subsequent call to ReadFile.
    lpWritePipe - Returns a handle to the write side of the pipe.  Data
        may be written to the pipe by specifying this handle value in a
        subsequent call to WriteFile.
    lpPipeAttributes - An optional parameter that may be used to specify
        the attributes of the new pipe.  If the parameter is not
        specified, then the pipe is created without a security
        descriptor, and the resulting handles are not inherited on
        process creation.  Otherwise, the optional security attributes
        are used on the pipe, and the inherit handles flag effects both
        pipe handles.
    nSize - Supplies the requested buffer size for the pipe.  This is
        only a suggestion and is used by the operating system to
        calculate an appropriate buffering mechanism.  A value of zero
        indicates that the system is to choose the default buffering
        scheme.
Return Value:
    TRUE - The operation was successful.
    FALSE/NULL - The operation failed. Extended error status is available
        using GetLastError.
--*/

{
  HANDLE ReadPipeHandle, WritePipeHandle;
  DWORD dwError;
  UCHAR PipeNameBuffer[ MAX_PATH ];

  //
  // Only one valid OpenMode flag - FILE_FLAG_OVERLAPPED
  //

  if ((dwReadMode | dwWriteMode) & (~FILE_FLAG_OVERLAPPED)) {
    SetLastError(ERROR_INVALID_PARAMETER);
    return FALSE;
  }

  //
  //  Set the default timeout to 120 seconds
  //

  if (nSize == 0) {
    nSize = 4096;
  }

  sprintf( PipeNameBuffer,
           "\\\\.\\Pipe\\RemoteExeAnon.%08x.%08x",
           GetCurrentProcessId(),
           InterlockedIncrement(&PipeSerialNumber)
         );

  ReadPipeHandle = CreateNamedPipeA(
                       PipeNameBuffer,
                       PIPE_ACCESS_INBOUND | dwReadMode,
                       PIPE_TYPE_BYTE | PIPE_WAIT,
                       1,             // Number of pipes
                       nSize,         // Out buffer size
                       nSize,         // In buffer size
                       120 * 1000,    // Timeout in ms
                       lpPipeAttributes
                       );

  if (! ReadPipeHandle) {
    return FALSE;
  }

  WritePipeHandle = CreateFileA(
                      PipeNameBuffer,
                      GENERIC_WRITE,
                      0,                         // No sharing
                      lpPipeAttributes,
                      OPEN_EXISTING,
                      FILE_ATTRIBUTE_NORMAL | dwWriteMode,
                      NULL                       // Template file
                    );

  if (INVALID_HANDLE_VALUE == WritePipeHandle) {
    dwError = GetLastError();
    CloseHandle( ReadPipeHandle );
    SetLastError(dwError);
    return FALSE;
  }

  *lpReadPipe = ReadPipeHandle;
  *lpWritePipe = WritePipeHandle;
  return( TRUE );
} 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-13T16:48:03.243

不。正如[这里](http://msdn.microsoft.com/en-us/library/aa365141%28VS.85%29.aspx)所解释的，匿名管道不支持异步 I/O。您需要使用命名管道。[在此处](http://msdn.microsoft.com/en-us/library/aa365603%28VS.85%29.aspx)和[此处](http://msdn.microsoft.com/en-us/library/aa365592%28VS.85%29.aspx)的 MSDN 上有执行此操作的示例代码。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2018-07-20T18:27:18.867

首先需要了解 - 什么是[*匿名管道以及匿名管道和*](https://docs.microsoft.com/en-us/windows/desktop/ipc/anonymous-pipes)[*命名管道*](https://docs.microsoft.com/en-us/windows/desktop/ipc/named-pipes)之间存在什么区别。

真的只存在**单一管道类型**（由*npfs.sys*实现）。除了名称之外，命名管道和匿名管道之间没有任何区别。两者都只是管道。

所谓的匿名管道 - 这是win7之前的特殊/随机命名管道，真正的未命名管道从win7开始。

当 msdn 写道*“匿名管道是单向管道”*时- 这是**谎言**。与任何管道一样，它可以是单向或双工的。当 msdn 写道*“匿名管道不支持异步（重叠）读写操作”时。*- 这是**谎言**。当然管道支持异步 io。管道的名称不影响这一点。

在win7之前，真正的未命名管道甚至根本不存在。[`CreatePipe`](https://docs.microsoft.com/en-us/windows/desktop/ipc/anonymous-pipe-operations)函数使用`Win32Pipes.%08x.%08x`格式创建“匿名管道”的名称。

```
 static LONG PipeSerialNumber;
    WCHAR name[64];
    swprintf(name, L"\\Device\\NamedPipe\\Win32Pipes.%08x.%08x", 
        GetCurrentProcessId(), InterlockedIncrement(&PipeSerialNumber)); 
```

从win7开始`CreatePipe` 使用另一种技术（相对文件打开）创建管道对 - 现在它真的是匿名的。

例如代码女巫创建管道对，其中一个管道是异步的且不可继承。另一个管道是同步的和可继承的。两个管道都是双工的（支持读写）

```
ULONG CreatePipeAnonymousPair7(PHANDLE phServerPipe, PHANDLE phClientPipe)
{
    HANDLE hNamedPipe;

    IO_STATUS_BLOCK iosb;

    static UNICODE_STRING NamedPipe = RTL_CONSTANT_STRING(L"\\Device\\NamedPipe\\");

    OBJECT_ATTRIBUTES oa = { sizeof(oa), 0, const_cast<PUNICODE_STRING>(&NamedPipe), OBJ_CASE_INSENSITIVE };

    NTSTATUS status;

    if (0 <= (status = NtOpenFile(&hNamedPipe, SYNCHRONIZE, &oa, &iosb, FILE_SHARE_VALID_FLAGS, 0)))
    {
        oa.RootDirectory = hNamedPipe;

        static LARGE_INTEGER timeout = { 0, MINLONG };
        static UNICODE_STRING empty = {};

        oa.ObjectName = &empty;

        if (0 <= (status = ZwCreateNamedPipeFile(phServerPipe,
            FILE_READ_ATTRIBUTES|FILE_READ_DATA|
            FILE_WRITE_ATTRIBUTES|FILE_WRITE_DATA|
            FILE_CREATE_PIPE_INSTANCE, 
            &oa, &iosb, FILE_SHARE_READ|FILE_SHARE_WRITE,
            FILE_CREATE, 0, FILE_PIPE_BYTE_STREAM_TYPE, FILE_PIPE_BYTE_STREAM_MODE,
            FILE_PIPE_QUEUE_OPERATION, 1, 0, 0, &timeout)))
        {
            oa.RootDirectory = *phServerPipe;
            oa.Attributes = OBJ_CASE_INSENSITIVE|OBJ_INHERIT;

            if (0 > (status = NtOpenFile(phClientPipe, SYNCHRONIZE|FILE_READ_ATTRIBUTES|FILE_READ_DATA|
                FILE_WRITE_ATTRIBUTES|FILE_WRITE_DATA, &oa, &iosb, 
                FILE_SHARE_VALID_FLAGS, FILE_SYNCHRONOUS_IO_NONALERT)))
            {
                NtClose(oa.RootDirectory);
            }
        }

        NtClose(hNamedPipe);
    }

    return RtlNtStatusToDosError(status);
}

ULONG CreatePipeAnonymousPair(PHANDLE phServerPipe, PHANDLE phClientPipe)
{
    static char flag_supported = -1;

    if (flag_supported < 0)
    {
        ULONG dwMajorVersion, dwMinorVersion;
        RtlGetNtVersionNumbers(&dwMajorVersion, &dwMinorVersion, 0);
        flag_supported = _WIN32_WINNT_WIN7 <= ((dwMajorVersion << 8)| dwMinorVersion);
    }

    if (flag_supported)
    {
        return CreatePipeAnonymousPair7(phServerPipe, phClientPipe);
    }

    static LONG PipeSerialNumber;

    WCHAR name[64];

    swprintf(name, L"\\\\?\\pipe\\Win32Pipes.%08x.%08x", GetCurrentProcessId(), InterlockedIncrement(&PipeSerialNumber));

    HANDLE hClient, hServer = CreateNamedPipeW(name, 
        PIPE_ACCESS_DUPLEX|FILE_READ_DATA|FILE_WRITE_DATA|FILE_FLAG_OVERLAPPED, 
        PIPE_TYPE_BYTE|PIPE_READMODE_BYTE, 1, 0, 0, 0, 0);

    if (hServer != INVALID_HANDLE_VALUE)
    {
        static SECURITY_ATTRIBUTES sa = { sizeof(sa), 0, TRUE };

        hClient = CreateFileW(name, FILE_GENERIC_READ|FILE_GENERIC_WRITE, 
            FILE_SHARE_READ|FILE_SHARE_WRITE, &sa, OPEN_EXISTING, 0, 0);

        if (hClient != INVALID_HANDLE_VALUE)
        {
            *phServerPipe = hServer, *phClientPipe = hClient;
            return NOERROR;
        }

        CloseHandle(hServer);
    }

    return GetLastError();
} 
```

# smtp - 如何判断我是否有开放式继电器？

> ID：60648
> 
> 赞同：0
> 
> 时间：2008-09-13T16:08:31.887
> 
> 标签：smtp

我正在尝试确定我的服务器上是否有开放中继。我怎么做？

我试过[http://www.abuse.net/relay.html](http://www.abuse.net/relay.html)

它报告：

嗯，乍一看，宿主似乎接受了中继的消息。这可能或可能不意味着它是一个开放的继电器。一些系统似乎接受中继邮件，但随后在内部拒绝邮件而不是传递它们，但此时您无法判断邮件是否会被中继。

我可以做哪些进一步的测试来确定服务器是否有开放中继？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T16:18:01.850

诶？正如您的链接告诉您的那样，注册该站点，它将为您提供一个地址@abuse.net，有效期为 24 小时。在测试表格中输入该地址。如果您的 abuse.net 帐户收到了测试电子邮件，那么您就有了一个开放的中继。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T16:17:21.943

您可以尝试设置电子邮件客户端，以通过您的服务器从不在同一服务器上的电子邮件地址发送电子邮件。如果您可以从不同域的电子邮件地址成功发送邮件，而无需输入 SMTP 服务器的登录名和密码，那么它可能是一个开放中继。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T00:16:23.013

这取决于您的 MTA 以及您如何配置它。最终，您必须做一件事来防止中继。限制对经过身份验证的用户的中继和/或限制对特定 IP 的中继。我更喜欢在我的邮件服务器上限制除 localhost 之外的所有 IP，并要求其他人进行身份验证。

常见的错误是允许超过必要的 IP。想象一下，使用电缆调制解调器的用户决定允许室友的笔记本电脑使用语句 192.168.1.0/24 而不是更具体的 192.168.1.0/29 进行中继。现在 /24 上的任何其他人都可以中继服务器。

# cross-platform - 跨平台工控机

> ID：60649
> 
> 赞同：74
> 
> 时间：2008-09-13T16:10:34.003
> 
> 标签：cross-platform, ipc

我正在寻找有关可能的 IPC 机制的建议，这些机制是：

*   **跨平台**（至少 Win32 和 Linux）
*   在**C++**以及**最常见的脚本语言**（perl、ruby、python 等）中易于实现。
*   最后，从编程的角度来看**，使用简单！**

我的选择是什么？我在 Linux 下编程，但我希望我写的东西将来可以移植到其他操作系统。我考虑过使用套接字、命名管道或 DBus 之类的东西。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-15T19:22:37.350

在速度方面，最好的跨平台 IPC 机制将是管道。但是，这假设您希望在同一台机器上跨平台 IPC。如果您希望能够与远程机器上的进程通信，则需要考虑使用套接字。幸运的是，如果您至少在谈论 TCP，套接字和管道的行为几乎相同。虽然用于设置和连接它们的 API 不同，但它们都像数据流一样工作。

然而，困难的部分不是沟通渠道，而是你通过它传递的信息。你真的很想看看可以为你执行验证和解析的东西。我建议查看 Google 的[Protocol Buffers](http://code.google.com/apis/protocolbuffers/docs/overview.html)。您基本上创建了一个描述要在进程之间传递的对象的规范文件，并且有一个编译器可以生成多种不同语言的代码，用于读取和写入与规范匹配的对象。这比尝试自己提出消息传递协议和解析器要容易得多（并且不易出错）。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-13T16:19:10.520

对于 C++，请查看[Boost IPC](http://www.boost.org/doc/libs/1_36_0/doc/html/interprocess.html)。
您也可以为脚本语言创建或找到一些绑定。

否则，如果能够与脚本语言交互真的很重要，那么最好的选择就是使用文件、管道或套接字，甚至是 HTTP 等更高级别的抽象。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-16T17:04:46.143

为什么不是 D-Bus？这是一个非常简单的消息传递系统，几乎可以在所有平台上运行，并且专为健壮性而设计。目前几乎所有脚本语言都支持它。

[http://freedesktop.org/wiki/Software/dbus](http://freedesktop.org/wiki/Software/dbus)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-07-30T10:22:40.920

如果您想要一个可移植、易于使用、多语言和[LGPL](http://zeromq.org/intro:commercial-support) ed 的解决方案，我会推荐您[ZeroMQ](http://zeromq.org/)：

*   速度惊人，几乎可以线性扩展并且仍然很简单。
*   适用于简单和复杂的系统/架构。
*   可用的非常强大的通信模式：REP-REP、PUSH-PULL、PUB-SUB、PAIR-PAIR。
*   **`inproc://`**如果您在线程 ( )、进程 ( **`ipc://`**) 或机器 ( )之间传递消息，您可以配置传输协议以提高效率**`{tcp|pgm|epgm}://`**，并使用智能选项来削减部分协议开销，以防 VMware 之间运行连接虚拟机 ( **`vmci://`**)。

对于序列化，我会建议[MessagePack](http://msgpack.org/index.html)或 Protocol Buffers（其他人也已经提到过），具体取决于您的需要。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-15T22:11:03.607

您可能想尝试[YAMI](http://www.msobczak.com/prog/yami/ "雅米")，它非常简单但功能强大，可移植，并且绑定了几种语言

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-13T16:21:24.227

[Facebook 的 Thrift](http://incubator.apache.org/thrift/)怎么样？

> Thrift 是一个用于可扩展的跨语言服务开发的软件框架。它将软件堆栈与代码生成引擎相结合，以构建在 C++、Java、Python、PHP、Ruby、Erlang、Perl、Haskell、C#、Cocoa、Smalltalk 和 OCaml 之间高效且无缝工作的服务。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-13T17:17:20.753

我想你会想要一些基于套接字的东西。

如果您想要 RPC 而不仅仅是 IPC，我建议您使用 XML-RPC/SOAP 之类的东西，它通过 HTTP 运行，并且可以从任何语言中使用。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-01-25T23:52:16.567

[YAMI - Yet another Messaging Infrastructure](http://www.msobczak.com/prog/yami/)是一个轻量级的消息传递和网络框架。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-06-19T18:54:44.037

我可以建议您使用[plibsys](https://github.com/saprykin/plibsys) C 库。它非常简单、轻量级和跨平台。根据 LGPL 发布。它提供：

*   命名的系统范围共享内存区域（System V、POSIX 和 Windows 实现）；
*   用于访问同步的命名系统范围信号量（System V、POSIX 和 Windows 实现）；
*   基于共享内存和信号量的命名系统范围共享缓冲区实现；
*   支持 IPv4 和 IPv6（UNIX 和 Windows 实现）的套接字（TCP、UDP、SCTP）。

它很容易使用具有相当好的文档的库。由于它是用 C 编写的，因此您可以轻松地从脚本语言进行绑定。

如果您需要在进程之间传递大型数据集（尤其是在速度很重要的情况下），最好使用共享内存来传递数据本身，并使用套接字来通知进程数据已准备好。您可以按以下方式制作：

*   进程将数据放入共享内存段，并通过套接字向另一个进程发送通知；由于通知通常非常小，因此时间开销很小；
*   另一个进程收到通知并从共享内存段中读取数据；之后，它会向第一个进程发送数据已读回的通知，以便它可以提供更多数据。

这种方法可以以跨平台的方式实现。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-15T19:39:28.073

如果你愿意尝试一些不同的东西，那就是[ZeroC的](http://zeroc.com)[ICE](http://zeroc.com/ice.html)平台。它是开源的，几乎所有你能想到的操作系统都支持它，并且支持 C++、C#、Java、Ruby、Python 和 PHP。最后，它非常容易驱动（语言映射经过定制，可以自然地适应每种语言）。它也快速高效。甚至还有设备的精简版。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-08T22:55:24.297

分布式计算通常很复杂，建议您使用现有的库或框架，而不是重新发明轮子。之前的海报已经列举了几个这样的库和框架。根据您的需要，您可以选择非常低级别（如套接字）或高级框架（如 CORBA）。不能有一个通用的“使用这个”答案。您需要对分布式编程进行自我教育，然后会发现为工作选择正确的库或框架要容易得多。

存在一个广泛使用的用于分布式计算的 C++ 框架，称为 ACE 和 CORBA ORB TAO（基于 ACE）。有很多关于 ACE 的好书[http://www.cs.wustl.edu/~schmidt/ACE/](http://www.cs.wustl.edu/~schmidt/ACE/)所以你可以看看。小心！

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-13T16:27:20.173

它没有比使用管道更简单的了，我知道的每个操作系统都支持管道，并且几乎可以用每种语言进行访问。

看看[这个](http://web.archive.org/web/20080919054639/http://www.utdallas.edu/~kcooper/teaching/3375/Tutorial6a/tutorial6.htm)教程。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-13T17:03:28.527

到本地主机 FTW 的 TCP 套接字。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-16T17:07:42.610

Python 有一个非常好的 IPC 库：见[https://docs.python.org/2/library/ipc.html](https://docs.python.org/2/library/ipc.html)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-09-24T20:22:13.360

[Xojo 通过其IPCSocket 类](https://docs.xojo.com/index.php/IPCSocket)内置了跨平台 IPC 支持。尽管您显然无法用其他语言“实现”它，但您可以在 Xojo 控制台应用程序中使用它并从其他语言调用它，这对您来说可能非常简单。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-03-05T10:39:08.060

在当前时代，有一个非常简单、符合 C++1x、有据可查、兼容 Linux 和 Windows 的开源“CommonAPI”库：[CommonAPI C++](https://at.projects.genivi.org/wiki/pages/viewpage.action?pageId=5472311)。

底层 IPC 系统是 D-Bus (libdbus) 或 SomeIP（如果需要）。应用程序接口是使用为该 Franca IDL 语言量身定制的简单语言指定的。

# asp.net - ASP.NET - 是否可以从服务器代码触发回发？

> ID：60650
> 
> 赞同：11
> 
> 时间：2008-09-13T16:11:02.583
> 
> 标签：asp.net, postback

是否可以以编程方式从 ASP.NET 中的服务器代码触发回发？我知道可以执行 Response.Redirect 或 Server.Transfer 来重定向到页面，但是有没有办法在服务器代码中触发回发到同一页面（*即*不使用 javascript 技巧来提交表单）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-13T16:25:26.853

Asp.net 回发是从客户端启动的（通常是表单提交）。我不确定您要达到的目标。一些服务器端[页面生命周期](http://www.15seconds.com/issue/020102.htm)事件已经被执行，你想要做的是再次引发以前的事件处理程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-13T16:28:12.107

回发是由 FORM 提交引起的。您需要从客户端启动它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T16:14:35.883

您可以使用 Ajax 请求来完成。您必须让页面轮询服务器。服务器没有任何方法可以在不请求的情况下将信息推送到浏览器。但是让一些在后台运行并每 5 秒（或更多，取决于您的需要）轮询服务器的 Javascript 可能是最好的解决方案。

附加

如果你走这条路，你可以让服务器只发回一个是或否，甚至只是 0 或 1，这取决于是否应该执行回发。根据您的需要，没有理由实际使用 AJAX 的 XML 部分。只需运行一个简单的异步请求，可能带有一些查询字符串变量，然后返回一个简单的单词，甚至是一个数字作为响应。这样，如果不需要，您可以保留用于创建和解析 XML 的 javascript。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-06-24T16:44:27.970

如果您希望从服务器发起通信，而不是轮询，请查看 Microsoft 的[SignalR](http://www.asp.net/signalr)。最简单的上下文是聊天应用程序，SignalR 作为其示例代码的一部分。您将能够从后面的代码启动消息，并在您的页面上将它们作为 javascript 事件接​​收。

要发送的服务器代码：

```
using System;
using System.Web;
using Microsoft.AspNet.SignalR;
namespace SignalRChat
{
    public class ChatHub : Hub
    {
        public void Send(string name, string message)
        {
            // Call the broadcastMessage method to update clients.
            Clients.All.broadcastMessage(name, message);
        }
    }
} 
```

捕获服务器消息的客户端代码是“chat.client.broadcastMessage”的覆盖：

```
<script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub. 
            var chat = $.connection.chatHub;
            // Create a function that the hub can call to broadcast messages.
            chat.client.broadcastMessage = function (name, message) {
                // Html encode display name and message. 
                var encodedName = $('<div />').text(name).html();
                var encodedMsg = $('<div />').text(message).html();
                // Add the message to the page. 
                $('#discussion').append('<li><strong>' + encodedName
                    + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
            };
            // Get the user name and store it to prepend to messages.
            $('#displayname').val(prompt('Enter your name:', ''));
            // Set initial focus to message input box.  
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    // Call the Send method on the hub. 
                    chat.server.send($('#displayname').val(), $('#message').val());
                    // Clear text box and reset focus for next comment. 
                    $('#message').val('').focus();
                });
            });
        });
    </script> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-05T07:08:51.930

对于那些使用较新版本的 .NET，您必须使用`Page.ClientScript.GetPostBackEventReference`因为`'this.GetPostBackEventReference(...)'`已过时。也大概`Page.ClientScript.RegisterStartupScript(...`

# c# - 常用内存优化

> ID：60652
> 
> 赞同：4
> 
> 时间：2008-09-13T16:11:31.910
> 
> 标签：c#, optimization, memory-management

csharp、dotnet 2.0 中最常见的内存优化是什么？想看看在winform应用程序中是否存在人们默认情况下可能不会做的常见事情

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-13T17:04:32.877

*   对小型包装对象使用结构以避免堆碎片
*   仔细考虑对象的生命周期，特别是对于大型对象，这样它们就不会出现在 LOH 上，除非你打算让它们
*   考虑循环内的分配
*   确保动态大小的数组具有合理的大小，否则分区问题

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T17:31:01.580

如果您对同一字符串执行多次修改，请使用 StringBuilder 而不是直接修改字符串。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-13T17:51:15.510

密封尽可能多的课程也应该有所帮助。AFAIK 这是 SmartAssembly 用来减少内存消耗的一种技巧。

# c++ - 全局内存是否在 C++ 中初始化？

> ID：60653
> 
> 赞同：15
> 
> 时间：2008-09-13T16:13:29.520
> 
> 标签：c++, memory, memory-management

全局内存是否在 C++ 中初始化？如果是这样，怎么办？

（二）澄清：

当程序启动时，在初始化原语之前，将成为全局内存的内存空间中有什么？我试图了解它是归零还是垃圾。

`instance()`情况是：可以在初始化之前通过调用设置单例引用：

```
MySingleton* MySingleton::_instance = NULL; 
```

结果得到两个单例实例？

请参阅我关于单例的多个实例的 C++ 测验...

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-13T17:20:43.197

从标准：

> 具有静态存储持续时间（3.7.1）的对象应在任何其他初始化发生之前进行零初始化（8.5）。零初始化和用常量表达式初始化统称为*静态初始化*；所有其他初始化都是*动态初始化*. 使用常量表达式 (5.19) 初始化的具有静态存储持续时间的 POD [plain old data] 类型 (3.9) 的对象应在任何动态初始化发生之前进行初始化。在同一翻译单元的命名空间范围内定义的静态存储持续时间并动态初始化的对象应按照其定义在翻译单元中出现的顺序进行初始化。[注：8.5.1 描述了聚合成员的初始化顺序。局部静态对象的初始化在 6.7 中描述。]

所以是的，具有静态存储持续时间的全局变量将被初始化。例如，在堆上分配的全局变量当然不会自动初始化。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-13T16:15:28.360

是的，全局原语被初始化为 NULL。

例子：

```
int x;

int main(int argc, char**argv)
{
  assert(x == 0);
  int y;
  //assert(y == 0); <-- wrong can't assume this.
} 
```

你不能对堆上的类、结构、数组、内存块做任何假设......

始终初始化所有内容是最安全的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-13T16:28:05.663

来自嵌入式世界...

您的代码被编译成三种类型的内存：
1\. .data：初始化内存
2..text：常量和代码
3..bss：未初始化内存（如果未显式初始化，则在 C++ 中初始化为 0）

如果初始化，全局变量会进入 .data。如果不是，它们将被放置在 .bss 中并在主代码中归零。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-13T16:34:42.293

使用静态/全局范围声明的变量总是至少在 VC++ 下初始化。

在某些情况下，实际上可能存在以下行为差异：

```
int x = 0;

int main() { ... } 
```

和

```
int x;

int main() { ... } 
```

如果您使用共享数据段，那么 VC++ 至少使用显式初始化和 a`#pragma data_seg`来确定特定变量应该进入共享数据段还是进程的私有数据段。

为了增加乐趣，请考虑如果您有一个静态 C++ 对象，并且在共享数据段中声明了构造函数/析构函数，会发生什么。每次 exe/dll 附加到数据段时都会调用构造函数/析构函数，这几乎肯定不是您想要的。

[此知识库文章](http://support.microsoft.com/kb/125677)中的更多详细信息

# ruby-on-rails - Rails 模型、视图、控制器和助手：什么去哪里？

> ID：60658
> 
> 赞同：155
> 
> 时间：2008-09-13T16:18:01.023
> 
> 标签：ruby-on-rails, ruby, model-view-controller

在 Ruby on Rails 开发（或一般的 MVC）中，我应该遵循什么快速规则来放置逻辑。

请给予肯定的回答——Do *put this here*，而不是*Don't put that there*。

* * *

## 回答 #1

> 赞同：173
> 
> 时间：2008-09-13T19:59:14.953

MVC

**控制器**：将代码放在这里，用于确定用户想要什么，决定给他们什么，确定他们是否登录，他们是否应该看到某些数据等。最后，控制器查看请求并计算出要显示的数据（模型）和要渲染的视图。如果您对代码是否应该进入控制器有疑问，那么它可能不应该。保持你的控制器[瘦](http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model)。

**视图**：视图应该只包含显示数据（模型）的最少代码，它不应该做大量的处理或计算，它应该显示模型计算（或汇总）的数据，或者从控制器生成的数据。如果你的 View 确实需要做 Model 或 Controller 无法完成的处理，请将代码放在 Helper 中。视图中的大量 Ruby 代码使页面标记难以阅读。

**模型**：您的模型应该是与您的数据相关的**所有**代码（构成您网站的实体，例如用户、帖子、帐户、朋友等）所在的位置。如果代码需要保存、更新或汇总与您的实体相关的数据，请将其放在这里。它将在您的视图和控制器中重复使用。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-13T20:18:46.013

要添加到 pauliephonic 的答案：

**Helper**：使创建视图更容易的功能。例如，如果您总是遍历小部件列表以显示其价格，请将其放入帮助程序（以及用于实际显示的部分）。或者，如果您不想弄乱视图，请将其放入帮助程序中。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-13T16:59:40.767

MVC 模式实际上只关心 UI 而不是其他的。您不应该在控制器中放置任何复杂的业务逻辑，因为它控制视图而不是逻辑。控制器应该关注选择正确的视图并将更复杂的东西委托给领域模型（模型）或业务层。

领域驱动设计有一个服务的概念，这是一个你坚持逻辑的地方，它需要编排许多不同类型的对象，这通常意味着不自然属于模型类的逻辑。

我通常将服务层视为我的应用程序的 API。我的服务层通常与我正在创建的应用程序的要求非常接近，因此服务层充当了在我的应用程序的较低级别中发现的更复杂交互的简化，即您可以绕过服务层实现相同的目标但你必须拉更多的杠杆才能让它发挥作用。

请注意，我在这里不是在谈论 Rails，而是在谈论解决您的特定问题的一般架构风格。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-09-25T09:01:14.000

这里已经有了完美的解释，一个非常简单的句子作为结论并且容易记住：

> 我们需要 SMART 模型、THIN 控制器和 DUMB 视图。

[http://c2.com/cgi/wiki?ModelViewController](http://c2.com/cgi/wiki?ModelViewController)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-13T17:52:26.973

Rails 的方式是拥有[瘦控制器和胖模型](http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model)。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-15T12:59:23.963

一定要把与授权/访问控制相关的东西放在控制器中。

模型都是关于您的数据的。验证、关系、CRUD、业务逻辑

视图是关于显示您的数据。仅显示和获取输入。

控制器是关于控制哪些数据从您的模型到您的视图（以及哪个视图）以及从您的视图到您的模型。控制器也可以在没有模型的情况下存在。

我喜欢将控制器视为保安/接待员，他将客户（请求）引导到您向出纳员（查看）问题的适当柜台。出纳员（视图）然后从您从未见过的经理（模型）那里得到答案。您的请求然后返回给保安/接待员（控制器）并等到您被指示去另一个柜员（视图），他告诉您经理（模型）告诉他们的答案以回应其他柜员（视图）的问题.

同样，如果您想告诉出纳员（查看）某些事情，那么基本上会发生相同的事情，除了第二个出纳员会告诉您经理是否接受了您的信息。也有可能是保安/接待员（控制员）告诉您去远足，因为您无权告诉经理该信息。

因此，为了扩展这个比喻，在我刻板和不切实际的世界中，出纳员（观点）很漂亮但头脑空洞，并且经常相信你告诉他们的任何事情，保安/接待员有最低限度的礼貌，但不是很了解，但他们知道人们应该去哪里和不应该去，经理们真的很丑陋和卑鄙，但什么都知道，可以分辨什么是真的，什么不是。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-15T14:54:19.490

有助于正确分离的一件事是避免“将局部变量从控制器传递到视图”反模式。而不是这个：

```
# app/controllers/foos_controller.rb:
class FoosController < ApplicationController

  def show
    @foo = Foo.find(...)
  end

end

#app/views/foos/show.html.erb:
...
<%= @foo.bar %>
... 
```

尝试将其移至可用作辅助方法的 getter：

```
# app/controllers/foos_controller.rb:
class FoosController < ApplicationController

  helper_method :foo

  def show
  end

  protected

  def foo
    @foo ||= Foo.find(...)
  end

end

#app/views/foos/show.html.erb:
...
<%= foo.bar %>
... 
```

这使得修改“@foo”中的内容及其使用方式变得更加容易。它增加了控制器和视图之间的分离，而不会使它们变得更复杂。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-13T16:33:54.853

嗯，这有点取决于逻辑必须处理的内容......

通常，将更多东西推入模型是有意义的，而控制器则很小。这可确保您可以在任何需要访问模型表示的数据的地方轻松使用此逻辑。视图应该几乎不包含任何逻辑。所以真的，总的来说，你应该努力做到这一点，这样你就不会重复自己。

此外，快速浏览一下 google 会发现一些更具体的例子来说明去哪里。

模型：验证要求、数据关系、创建方法、更新方法、销毁方法、查找方法（注意，你应该不仅有这些方法的通用版本，而且如果有你经常做的事情，比如用红色找人姓氏的头发，那么你应该提取那个逻辑，这样你所要做的就是调用 find_redH_by_name("smith") 或类似的东西）

观点：这应该是关于数据的格式化，而不是数据的处理。

控制器：这是数据处理的地方。来自互联网：“控制器的目的是响应用户请求的操作，获取用户设置的任何参数，处理数据，与模型交互，然后将请求的数据以最终形式传递给看法。”

希望有帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-09-01T15:43:58.690

简单来说，通常， **模型**将具有与表相关的所有代码，它们的简单或复杂关系（将它们视为涉及多个表的 sql 查询），使用业务逻辑操作数据/变量以达到结果.

**控制器**将具有指向所请求工作的相关模型的代码/指针。

**视图**将接受用户输入/交互并显示结果响应。

与这些的任何重大偏差都会对该部分造成不必要的压力，并且整体应用程序性能可能会受到影响。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-02-03T07:39:38.373

测试，测试......在模型中加入尽可能多的逻辑，然后你就可以正确地测试它。单元测试通过测试模型来测试数据及其形成方式，功能测试通过测试控制器来测试数据的路由或控制方式，因此你无法测试数据的完整性，除非它在该模型。

j

# internet-explorer-6 - 是否可以在 IE6 中显示实体⇓

> ID：60664
> 
> 赞同：2
> 
> 时间：2008-09-13T16:22:43.443
> 
> 标签：internet-explorer-6

是否可以在 ie6 中显示 ⇓ 实体？它显示在每个浏览器中，但不是 IE 6。我正在编写标记，例如：

```
<span>&#8659;</span> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T16:40:49.343

根据[this page](https://web.archive.org/web/20080221144246/http://www.ackadia.com:80/web-design/character-code/character-code-symbols.php)，该符号根本不显示在IE6中。

```
Symbol  Character  Numeric  Description
⇓       &dArr;     &#8659;  Down double arrow - -  * Doesn't show with MS IE6 
```

如果你真的需要那个特定的符号，你可能只需要一个小箭头图形——这不是一个理想的解决方案，但如果你需要它在 IE6 中显示，那么这可能是你唯一的选择。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T16:59:14.793

是的，有可能...但是您需要明确告诉 IE 可以在哪种字体中找到它。例如：

```
<span style="font-family:Arial Unicode MS"> &#8659; </span> 
```

在大多数浏览器中应该产生 ⇓。

# asp.net - IIS 集成请求处理管道——修改请求

> ID：60672
> 
> 赞同：0
> 
> 时间：2008-09-13T16:30:26.950
> 
> 标签：asp.net, iis-7, httpmodule

我想在 IIS 集成请求处理管道模式下运行的 IIS7 中使用 HttpModule 实现类似 ISAPI 过滤器的功能。

目标是在 Web Server 级别查看传入的请求，并将一些自定义 HttpHeaders 注入到请求中。`(for ex: HTTP\_EAUTH\_ID)`

稍后在 ASPX 页面的页面生命周期中，我应该能够将该变量用作

```
string eauthId = Request.ServerVariables["HTTP\_EAUTH\_ID"].ToString(); 
```

那么在 Web 服务器级别实现这个模块，是否可以改变 ServerVariables 集合？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T17:52:30.547

[HttpRequest.ServerVariables](http://msdn.microsoft.com/en-us/library/system.web.httprequest.servervariables.aspx)属性是一个只读集合。所以，你不能直接修改它。我建议将您的自定义数据从您的 httpmodule 存储在[httpcontext](http://www.odetocode.com/Articles/111.aspx)（或全局应用程序对象或您的数据库）中，然后在 aspx 页面中读取该共享值。

如果您仍想修改服务器变量，此[线程](http://forums.asp.net/t/1125149.aspx)中提到了一种使用反射的 hack 技术。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-13T17:07:38.093

我相信服务器变量列表只包含从浏览器发送到服务器的标头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T09:25:41.783

您将无法修改 the`HttpRequest.Headers`或`HttpRequest.ServerVariables`集合。但是，您可以将您的信息附加到以下任何一项：

```
HttpContext.Current.Items
HttpContext.Current.Response.Headers 
```

不幸的是，`Request.Params, Request.QueryString, Request.Cookies, Request.Form`（几乎任何其他你想填充它的地方都是只读的。

**如果这是您计划安装到 IIS 7 中的 HttpModule，我强烈建议您不要使用反射**。鉴于（可能）通过网络服务器的每个请求都会调用此代码，因此它需要非常快，并且反射不会削减它（除非您的用户很少）。

祝你好运！

# c++ - 改进代码的指南

> ID：60673
> 
> 赞同：10
> 
> 时间：2008-09-13T16:30:50.883
> 
> 标签：c++, coding-style

您遵循哪些准则来提高代码的总体质量？许多人都有关于如何编写 C++ 代码的规则（据说）这使得出错变得更加困难。我见过有人*坚持*每条`if`语句后跟一个大括号（`{...}`）。

我对其他人遵循的指导方针及其背后的原因很感兴趣。我也对你认为是垃圾但普遍持有的指导方针感兴趣。谁能推荐几个？

为了让球滚动，我将首先提到一些：

*   始终在每个`if`/`else`语句后使用大括号（如上所述）。这背后的基本原理是，要判断一条语句实际上是一条语句还是扩展为多个语句的预处理器宏并不总是那么容易，因此这段代码会中断：

```
    // 文件顶部：
    #define 语句 doSomething(); 做点别的

    // 在实现中：
    如果（某些条件）
        做点什么（）;

```

但是如果您使用大括号，那么它将按预期工作。

*   仅将预处理器宏用于条件编译。预处理器宏可能会导致各种麻烦，因为它们不允许 C++ 范围规则。由于头文件中具有通用名称的预处理器宏，我已经多次搁浅。一不小心，就会造成各种各样的破坏！

现在交给你了。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-13T17:28:03.663

我个人最喜欢的几个：

努力编写[const 正确](http://www.parashift.com/c++-faq-lite/const-correctness.html)的代码。您将使用编译器来帮助清除易于修复但有时令人痛苦的错误。您的代码还将讲述您在编写它时的想法——一旦您离开，这对新手或维护者都很有价值。

退出内存管理业务。学习使用智能指针：`std::auto_ptr`、`std::tr1::shared_ptr`（或`boost::shared_ptr`）和`boost::scoped_ptr`。了解它们之间的区别以及何时使用它们。

您可能会使用标准模板库。阅读[Josuttis 的书](https://rads.stackoverflow.com/amzn/click/com/0201379260)。不要只是在读完关于容器的前几章后就停下来，以为你知道 STL。推进好东西：算法和函数对象。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-13T18:00:22.727

1.  删除不必要的代码。

就这些。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-13T16:57:26.793

*   使用并执行通用的编码风格和准则。*理由：*团队或公司中的每个开发人员都能够阅读代码，而不会因不同的大括号样式或类似情况而分心。
*   定期对整个源代码库进行全面重建（即每日构建或每次签入后构建）并报告任何错误！*理由：*源几乎总是处于可用状态，问题在“实施”后不久就会被检测到，而解决问题的成本很低。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-13T19:46:10.227

打开编译器中可以出现的所有警告（gcc:`-Wall`是一个好的开始，但不包括所有内容，因此请查看文档），并使它们出错，因此您必须修复它们（gcc: `-Werror`）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-14T11:09:29.493

这些答案之一中提到的 Google 风格指南非常可靠。里面有一些毫无意义的东西，但总比坏的好。

Sutter 和 Alexandrescu 就这个主题写了一本不错的书，名为*C++ Coding Standards*。

以下是 lil' ole me 的一些一般提示：

1.  您的缩进和括号样式都是错误的。其他人的也是如此。因此，请遵循项目的标准。吞下你的骄傲并设置你的编辑器，以便一切都尽可能与代码库的其余部分保持一致。不得不阅读缩进不一致的代码真的很烦人。也就是说，括号和缩进与“改进代码”没有任何关系。更多的是提高你与他人合作的能力。

2.  好好评论。这是非常主观的，但一般来说，写评论*为什么*代码会以它的方式工作总是好的，而不是解释它的作用。当然，对于复杂的代码，可能不熟悉算法或代码的程序员也可以了解*它*在做什么。非常欢迎链接到所用算法的描述。

3.  以尽可能直接的方式表达逻辑。我认为具有讽刺意味的是，像“将常量放在比较左侧”这样的建议在这里出错了。它们非常受欢迎，但对于说英语的人来说，它们经常会破坏程序的逻辑流程以供阅读者使用。如果您不能相信自己（或您的编译器）能够正确编写相等比较，那么请务必使用这样的技巧。但是当你这样做时，你会牺牲清晰度。也属于这一类的还有......“我的逻辑有 3 级缩进吗？它可以更简单吗？” 并将类似的代码滚动到函数中。甚至可能拆分功能。编写优雅地表达底层逻辑的代码需要经验，但值得努力。

那些很一般。对于具体的提示，我不能比 Sutter 和 Alexandrescu 做得更好。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-13T17:32:34.853

在 if 语句中，将常量放在左侧，即

```
if( 12 == var ) 
```

不是

```
if( var == 12 ) 
```

因为如果你错过了输入“=”，那么它就变成了作业。在最高版本中，编译器说这是不可能的，在后者中它运行并且 if 始终为真。

每当它们不在同一行时，我都会为 if 使用大括号。

```
if( a == b ) something();
if( b == d )
{
    bigLongStringOfStuffThatWontFitOnASingleLineNeatly();
} 
```

打开和关闭大括号总是有自己的行。但这当然是个人惯例。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-13T18:19:43.630

仅在仅需要解释代码在做什么时才发表评论，而阅读代码无法告诉您相同的信息。

不要注释掉不再使用的代码。如果要恢复旧代码，请使用源代码控制系统。注释掉代码只会让事情看起来很混乱，并且会让你真正重要的注释淡入注释代码的背景混乱中。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-13T18:13:00.263

1.  使用一致的格式。
2.  在处理遗留代码时，请使用现有的格式样式，尤其是。大括号样式。
3.  获取 Scott Meyer 的《Effective C++》一书的副本
4.  获取 Steve MConnell 的书 Code Complete 的副本。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-14T07:35:47.073

Google 内部还使用了一个不错的[C++ 样式指南](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)，其中包括这里提到的大部分规则。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-15T17:35:45.670

开始写很多评论——但以此为契机重构代码，使其具有自我解释性。

IE：

```
for(int i=0; i<=arr.length; i++) {
  arr[i].conf() //confirm that every username doesn't contain invalid characters
} 
```

应该更像

```
for(int i=0; i<=activeusers.length; i++) {
  activeusers[i].UsernameStripInvalidChars()
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-13T17:44:11.563

类似地，您可能会在这里找到一些有用的建议：[如何使错误的代码看起来不正确？您使用什么模式来避免语义错误？](https://stackoverflow.com/questions/26086/how-do-you-make-wrong-code-look-wrong-what-patterns-do-you-use-to-avoid-semanti)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-13T17:58:58.330

*   使用制表符进行缩进，但将数据与空格对齐这意味着人们可以通过更改制表符大小来决定缩进多少，但也可以保持对齐（例如，在将值分配给结构）

*   尽可能使用常量或内联函数而不是宏

*   永远不要在头文件中使用“使用”，因为包含该头文件的所有内容也会受到影响，即使包含您的头文件的人不希望在其全局命名空间中使用所有 std（例如）。

*   如果某些内容超过大约 80 列，请将其分成多行，例如

    ```
    if(SomeVeryLongVaribleName != LongFunction(AnotherVarible, AString) &&
       BigVaribleIsValid(SomeVeryLongVaribleName))
    {
        DoSomething();
    } 
    ```

*   仅重载运算符以使它们执行用户期望的操作，例如重载 2dVector 的 + 和 - 运算符就可以了

*   始终注释您的代码，即使它只是说明下一个块在做什么（例如“删除此级别不需要的所有纹理”）。有人可能需要稍后使用它，可能在你离开之后，他们不想找到没有注释的 1000 行代码来指示什么在做什么。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-13T19:03:17.193

1.  设置编码约定并让所有参与的人都遵守约定（您不希望阅读需要您弄清楚下一个语句/表达式在哪里的代码，因为它没有正确缩进）
2.  不断地重构你的代码（获取一份 Martin Fowler 的 Refactoring 的副本，书中详细介绍了优缺点）
3.  编写松散耦合的代码（通过编写不言自明的代码来避免写注释，松散耦合的代码往往更易于管理/适应更改）
4.  如果可能的话，对你的代码进行单元测试（或者如果你足够有男子气概，那就是 TDD。）
5.  尽早发布，经常发布
6.  避免过早优化（分析有助于优化）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-15T17:25:57.690

在可能的情况下，使用前增量而不是后增量。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-15T18:11:48.423

我在我的 C++ 项目中使用 PC-Lint，尤其喜欢它引用现有出版物的方式，例如 MISRA 指南或 Scott Meyers 的“Effective C++”和“More Effective C++”。即使您计划为静态分析工具检查的每条规则编写非常详细的理由，最好指出您的用户信任的已建立的出版物。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-16T07:39:10.057

这是 C++ 大师给我的最重要的一条建议，它帮助我在一些关键场合找到了代码中的错误：

*   当方法**不应该**修改对象时使用 const 方法。
*   **当对象不应该**修改对象时，在参数中使用 const 引用和指针。

使用这两条规则，编译器将免费告诉您代码中的逻辑缺陷！

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-16T08:07:15.497

此外，对于一些好的技术，您可以关注[Google 的博客“马桶测试”](http://googletesting.blogspot.com/2007/01/introducing-testing-on-toilet.html)。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-08T03:31:19.350

六个月后再看

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-13T16:50:23.957

确保正确缩进

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-14T07:25:29.797

嗯 - 我可能应该更具体一点。

我并不是在为自己寻找建议——我正在编写一个静态代码分析工具（当前的商业产品还不足以满足我的需求），我正在寻找插件的想法来突出可能代码中的错误。

有几个人提到了诸如 const 正确性和使用智能指针之类的东西——这是我可以检查的那种想法。检查缩进和注释有点难（无论如何从编程的角度来看）。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-16T07:57:12.137

智能指针有一种非常清楚地指示所有权的好方法。如果你是一个类或一个函数：

*   如果你得到一个**原始指针**，你就没有任何东西。您可以使用指针，由您的呼叫者提供，他保证指针将比您活得更久。
*   如果你得到一个**weak_ptr**，你不拥有指针，最重要的是指针可以随时消失。
*   如果您获得了**shared_ptr**，则您与其他人一起拥有该对象，因此您无需担心。压力更小，控制也更少。
*   如果您获得**auto_ptr**，则您是该对象的唯一所有者。这是你的，你是国王。您有权销毁该对象，或将其交给其他人（从而失去所有权）。

我发现 auto_ptr 的情况特别强大：在设计中，如果我看到一个 auto_ptr，我会立即知道该对象将从系统的一个部分“游走”到另一个部分。

这至少是我在我的宠物项目中使用的逻辑。我不确定这个主题会有多少变化，但到目前为止，这个规则集对我很有帮助。

# python - 如何编写 python HTTP 服务器来监听多个端口？

> ID：60680
> 
> 赞同：21
> 
> 时间：2008-09-13T16:42:38.153
> 
> 标签：python, webserver

我正在用 Python 编写一个小型 Web 服务器，使用 BaseHTTPServer 和 BaseHTTPServer.BaseHTTPRequestHandler 的自定义子类。是否可以在多个端口上进行监听？

我现在在做什么：

```
class MyRequestHandler(BaseHTTPServer.BaseHTTPRequestHandler):
  def doGET
  [...]

class ThreadingHTTPServer(ThreadingMixIn, HTTPServer): 
    pass

server = ThreadingHTTPServer(('localhost', 80), MyRequestHandler)
server.serve_forever() 
```

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-13T18:22:06.573

当然; 只需在两个不同线程中的两个不同端口上启动两个不同的服务器，每个线程都使用相同的处理程序。这是我刚刚编写和测试的一个完整的工作示例。如果您运行此代码，那么您将能够在[http://localhost:1111/](http://localhost:1111/)和[http://localhost:2222/上获得一个 Hello World 网页](http://localhost:2222/)

```
from threading import Thread
from SocketServer import ThreadingMixIn
from BaseHTTPServer import HTTPServer, BaseHTTPRequestHandler

class Handler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header("Content-type", "text/plain")
        self.end_headers()
        self.wfile.write("Hello World!")

class ThreadingHTTPServer(ThreadingMixIn, HTTPServer):
    daemon_threads = True

def serve_on_port(port):
    server = ThreadingHTTPServer(("localhost",port), Handler)
    server.serve_forever()

Thread(target=serve_on_port, args=[1111]).start()
serve_on_port(2222) 
```

*更新：*

这也适用于 Python 3，但需要稍微更改三行：

```
from socketserver import ThreadingMixIn
from http.server import HTTPServer, BaseHTTPRequestHandler 
```

和

```
self.wfile.write(bytes("Hello World!", "utf-8")) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-13T18:23:10.283

不容易。你可以有两个 ThreadingHTTPServer 实例，编写你自己的 serve_forever() 函数（不要担心它不是一个复杂的函数）。

现有功能：

```
def serve_forever(self, poll_interval=0.5):
    """Handle one request at a time until shutdown.

    Polls for shutdown every poll_interval seconds. Ignores
    self.timeout. If you need to do periodic tasks, do them in
    another thread.
    """
    self.__serving = True
    self.__is_shut_down.clear()
    while self.__serving:
        # XXX: Consider using another file descriptor or
        # connecting to the socket to wake this up instead of
        # polling. Polling reduces our responsiveness to a
        # shutdown request and wastes cpu at all other times.
        r, w, e = select.select([self], [], [], poll_interval)
        if r:
            self._handle_request_noblock()
    self.__is_shut_down.set() 
```

所以我们的替换是这样的：

```
def serve_forever(server1,server2):
    while True:
        r,w,e = select.select([server1,server2],[],[],0)
        if server1 in r:
            server1.handle_request()
        if server2 in r:
            server2.handle_request() 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-14T13:15:51.403

我会说这种简单的东西的线程是矫枉过正的。你最好使用某种形式的异步编程。

这是使用[Twisted](http://twistedmatrix.com/)的示例：

```
from twisted.internet import reactor
from twisted.web import resource, server

class MyResource(resource.Resource):
    isLeaf = True
    def render_GET(self, request):
        return 'gotten'

site = server.Site(MyResource())

reactor.listenTCP(8000, site)
reactor.listenTCP(8001, site)
reactor.run() 
```

我还认为让每个端口都以相同的方式处理看起来更干净，而不是让主线程处理一个端口，另一个线程处理另一个。可以说这可以在线程示例中修复，但是您使用的是三个线程。

# c# - 列表视图控件中的复选框

> ID：60683
> 
> 赞同：13
> 
> 时间：2008-09-13T16:51:31.143
> 
> 标签：c#, user-interface, visual-studio-2005, checkbox

你能有一个多列列表视图控件，其中一列是一个复选框吗？示例代码或链接将不胜感激。

我正在使用视觉工作室 2005

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-17T14:34:27.057

更好地使用网格视图控件，但是如果您**只**想要一个带有复选框的列并且该列是**第一**列，您可以编写：

```
this.listView1.CheckBoxes = true; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-13T17:07:11.467

Allan Anderson 创建了一个自定义控件来让您执行此操作。你可以在这里找到它：http: [//www.codeproject.com/KB/list/aa_listview.aspx](http://www.codeproject.com/KB/list/aa_listview.aspx)

这是该控件的一些示例代码：

```
 GlacialList mylist = new GlacialList();

mylist.Columns.Add( "Column1", 100 ); // this can also be added 

         // through the design time support 

mylist.Columns.Add( "Column2", 100 ); 
mylist.Columns.Add( "Column3", 100 ); 
mylist.Columns.Add( "Column4", 100 ); 

GLItem item;

item = this.glacialList1.Items.Add( "Atlanta Braves" );
item.SubItems[1].Text = "8v";
item.SubItems[2].Text = "Live";
item.SubItems[2].BackColor = Color.Bisque;
item.SubItems[3].Text = "MLB.TV"; 

item = this.glacialList1.Items.Add( "Florida Marlins" );
item.SubItems[1].Text = "";
item.SubItems[2].Text = "Delayed";
item.SubItems[2].BackColor = Color.LightCoral;
item.SubItems[3].Text = "Audio";

item.SubItems[1].BackColor = Color.Aqua; // set the background 

      // of this particular subitem ONLY

item.UserObject = myownuserobjecttype; // set a private user object

item.Selected = true; // set this item to selected state

item.SubItems[1].Span = 2; // set this sub item to span 2 spaces

ArrayList selectedItems = mylist.SelectedItems; 
           // get list of selected items 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-04-04T02:35:02.770

*添加复选框列，如下所示。*

```
myListView.CheckBoxes = true;
myListView.Columns.Add(text, width, alignment); 
```

*添加 ListViewItem 如下所示。*

```
ListViewItem lstViewItem = new ListViewItem();
lstViewItem.SubItems.Add("Testing..");
lstViewItem.SubItems.Add("Testing1..");

myListView.Items.Add(lstViewItem); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-04-13T01:01:33.753

你为什么不试试[Mathew Hall 的 XPTable](http://www.codeproject.com/KB/list/XPTable.aspx)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-13T17:21:50.150

您可以改用网格视图，因为这样可以更好地控制列内容。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-13T17:08:47.327

也许[ListView.Checkboxes](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.checkboxes(VS.80).aspx)。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-06-22T08:27:34.857

您可以将`CheckBoxes`属性设置为`true`. 在代码中，可以这样完成：

```
listView1.CheckBoxes = true; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-13T17:33:35.177

您可以尝试[TreeViewAdv](http://www.codeproject.com/KB/tree/treeviewadv.aspx)。它是开源的，托管在 sourceforge 上。

# visual-studio - 在文本编辑器中删除代码行

> ID：60684
> 
> 赞同：-5
> 
> 时间：2008-09-13T16:53:41.810
> 
> 标签：visual-studio, eclipse, vim, emacs, text-editor

***编辑：***这个问题被标记为“托尔斯泰”，以感谢我写作的质量和长度:) 只需阅读第一段和最后一段就足够了:) 如果你倾向于用鼠标选择和移动代码，那么里面的东西中间对你来说可能很有趣。

这个问题是关于你一般如何使用文本编辑器的。我正在寻找*删除*多行代码的最佳方法（无意为其申请专利：）这延伸到*转置*行，即在其他地方删除和添加它们。最重要的是，我不想创建任何必须单独删除的空行。有点像 Visual Studio 的 SHIFT+DELETE 功能，但同时适用于多行。

假设您想从以下代码中删除第 3 行（制表符和换行符也可视化）。天真的方法是选择尖括号之间的文本：

```
如果（真）{\n
\t int i = 1;\n
\t <i *= 2;>\n
\ti += 3;\n
}\n

```

然后按退格键。这将创建一个空行。再按两次退格键删除 \t 和 \n。

你最终得到：

```
如果（真）{\n
\t int i = 1;\n
\ti += 3;\n
}\n

```

当您尝试选择整行时，Visual Studio 不允许您选择尾随换行符。例如，将光标放在一行上并按 SHIFT+END 不会选择末尾的换行符。如果您使用鼠标也不会选择换行符，即单击一行的中间并将光标一直拖到右侧。如果您做出的选择至少跨越两行，您只选择尾随的换行符。我使用的大多数编辑器都是这样做的；Microsoft 写字板和 Word 是反例（我在删除文本时经常会出现换行错误；至少 Word 有一种方法可以显式显示行尾和段尾字符）。

通常在使用 Visual Studio 和其他编辑器时，这是目前最适合我的解决方案：

使用鼠标，我选择放在尖括号之间的字符：

```
如果（真）{\n
\t int i = 1;<\n
\ti *= 2;>\n
\ti += 3;\n
}\n

```

现在按退格键，您可以一次性删除该行，而无需删除任何其他字符。这同时适用于几条连续的线。此外，它还可用于转置行。您可以将尖括号之间的选择拖动到用插入符号标记的点：

```
如果（真）{\n
\t int i = 1;<\n
\ti *= 2;>\n
\ti += 3;^\n
}\n

```

这给你留下了：

```
如果（真）{\n
\t int i = 1;\n
\ti += 3;<\n
\ti *= 2;>\n
}\n

```

其中第 3 行和第 4 行交换了位置。

这个主题有一些变化。当您要删除第 3 行时，您还可以选择以下字符：

```
如果（真）{\n
\t int i = 1;\n
<\ti *= 2;\n
>\ti += 3;\n
}\n

```

事实上，如果你告诉它选择一整行，这就是 Visual Studio 所做的。您可以通过单击代码与指示断点的红色圆圈所在的列之间的边距来执行此操作。鼠标指针在该区域镜像以更好地区分它，但我认为它太窄并且与我要选择的代码相距太远。

也许这种方法对其他人也很有用，即使它只是让他们知道在选择/删除文本时如何处理换行符：) 它适用于大多数非专业文本编辑器。但是，鉴于 Visual Studio 的大量功能和插件（我使用最多），我确信有更好的方法来使用它来删除和移动代码行。在不同块之间移动代码时自动获得正确的缩进会很好（即不点击“格式化文档/选择”）。我期待着建议；请不要对微优化大喊大叫:)

* * *

***答案摘要***

关于 Visual Studio：用光标键很好地导航。

最适合我浏览和编辑代码风格的解决方案是*Eclipse*方式：

您可以选择几行连续的代码，其中第一行和最后一行可能只被部分选择。按下 ALT+{up,down} 可以上下移动整行（不仅仅是选择），同时修正缩进。按 CTRL+D 将完全删除行（不仅仅是选择），而不会留下任何不需要的空行。我很想在 Visual Studio 中看到这个！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-13T17:08:00.077

在 Emacs 中：

*   杀伤线CK
*   转置线 Cx Ct

Ca Ck Ck - 杀死包括换行符在内的整行（或`kill-whole-line`通过 CS-退格）。

Cu <number> Ck -- 杀死 <number> 行（包括换行符）。

Cy -- 拉回最近删除的文本（又名粘贴）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T17:22:16.220

在 VIM 中：

*   删除包括换行符在内的整行：`dd`
*   转置线：`dd p`

您始终可以在任何命令前加上一个数字来重复它，因此要删除 10 行，请执行以下操作：

```
10 dd 
```

您还可以指定要删除的行范围。例如，要删除第 10-15 行：

```
:10,15d 
```

或者您可以移动这些行，例如将第 10-15 行移动到第 20 行下方：

```
:10,15m20 
```

或者您可以*复制*以下行：

```
:10,15t20 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-13T17:35:25.547

我所做的是，从行首的光标开始（在某些编辑器中，您必须按两次 home 才能执行此操作），按住 shift 并按下，直到选择了我要删除的所有行。然后我按删除。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-13T17:18:04.280

在 Eclipse 中，您可以`ALT`-`↓`或`ALT`-`↑`移动一条线。我发现这非常有用，以及`ALT`- `SHIFT`-{ `↓`, `↑`} 复制一行。此外，它不会破坏您的剪贴板。它甚至可以在线条移动时纠正缩进！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T06:30:13.497

添加到现有的 vim 答案中，您可以使用 d 以及任何光标移动命令从光标的当前位置删除到新位置。例如，要删除...

*   ...到段落结尾（通常意思是“到下一个空白行”）：d}
*   ...包含光标的行和接下来的 5 行：d5j
*   ...一组括号、大括号等及其内容：d%（光标位于开始或结束括号/大括号/等上）
*   ...到单词“foo”的第三次出现：d3/foo

它非常灵活。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-13T17:33:49.687

学习使用光标键。

对于移动线，我执行以下操作：

1.  使用`↑`/`↓`移动到要复制的行。
2.  `Home`如果还没有，请点击，如果将光标放在空格之后，请再次点击。
3.  然后按**`Shift`+`↓`**选择要移动的行（或行）
4.  `Ctrl`+`X`切断线路。
5.  向上/向下移动到要插入的行
6.  `Ctrl`+`V`

这应该适用于 Windows 上的几乎所有文本编辑器。

删除行时，我仍然倾向于使用`Ctrl`+ `X`（尽管我想我也使用退格），因为上述内容在我的编辑方式中根深蒂固，而且也更加宽容。

（虽然我发现他们在我使用 Mac 的情况下迷失方向，但我认为 Apple 可能已经对他们设置 Home/End 的方式有所了解，在 Mac 上跳过单词快捷方式）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-18T03:07:25.923

在 Emacs 中，除了`C-k`（并`C-k`带有数字前缀 arg，以杀死 N 行）之外，您还可以只使用鼠标：

*   ***要杀死一行：***三次单击它，然后右键单击两次

*   ***要杀死多行：***三次单击第一行，然后右键单击最后一行（“first”行可以在“last”行之后-“first”在这里表示您单击的第一个）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T03:37:19.030

使用**简要**键盘映射，这是使用**`Alt`+`L`**标记行和**`-`**数字键盘上的键（或**`Alt`+`D`**）将行剪切到剪贴板来完成的。剪切将完全删除该行，包括换行符。

按**`Ins`**数字键盘上的键会将行放回文档中，包括换行符。

恕我直言， **Brief**是一个设计精良的键盘映射。

**PS：**我认为 MSVC 可以选择模拟简要键盘映射。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T06:00:59.167

除了上述之外，使用[Resharper](http://www.jetbrains.com/resharper/) for Visual Studio 来做你想做的事。你会发现的最好的 VS 插件。它提供了一堆不同的命令来帮助在这里和任何地方移动/删除/复制代码。更不用说重构/生成/等代码了。

`Ctrl`- `Shift`-`Alt` `↑`或`↓`将向上或向下移动方法，向上或向下移动等 `Shift`- `Del`- 删除当前行，但将其放在剪贴板中（除非您修改设置不这样做 - 我试图回忆如果这是一个 VS 标准快捷方式，而不仅仅是 Resharper - 太长了）。 `Ctrl`- `C`, `Ctrl`-`X`不选择复制/剪切当前行。一直在……

有关完整列表，请参阅[http://www.jetbrains.com/resharper/docs/ReSharper40DefaultKeymap2.pdf](http://www.jetbrains.com/resharper/docs/ReSharper40DefaultKeymap2.pdf)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-04-06T11:41:25.103

`Ctrl`++`Shift`删除`L`行而不将其复制到缓冲区。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T19:13:51.560

在 Eclipse 中，我使用`CTRL`+`D`删除多行的单行（或几行），我将使用鼠标或`SHIFT`+选择它们，`ARROW`然后按下`DEL`键。

# python - python 正则表达式匹配多行预处理器宏

> ID：60685
> 
> 赞同：5
> 
> 时间：2008-09-13T16:53:57.113
> 
> 标签：python, regex

下面是我编写的一个正则表达式，用于匹配 C / C++ 代码中的多行预处理器宏。我绝不是正则表达式专家，所以我欢迎任何关于如何使它变得更好的建议。

这是正则表达式：

```
\s*#define(.*\\\n)+[\S]+(?!\\) 
```

它应该匹配所有这些：

```
#define foo(x) if(x) \
doSomething(x) 
```

但只有其中一些（不应该匹配下一行代码：

```
#define foo(x) if(x) \
doSomething(x)
normalCode(); 
```

也不应该匹配单行预处理器宏。

我很确定上面的正则表达式有效 - 但正如我所说，可能有更好的方法来做到这一点，我想有办法打破它。任何人都可以提出任何建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T17:46:14.867

这是我敲出来的一个简单的测试程序：

```
#!/usr/bin/env python

TEST1="""
#include "Foo.h"
#define bar foo\\
    x
#include "Bar.h"
"""

TEST2="""
#define bar foo
#define x 1 \\
    12 \\
    2 \\\\ 3
Foobar
"""

TEST3="""
#define foo(x) if(x) \\
doSomething(x)
"""

TEST4="""
#define foo(x) if(x) \\
doSomething(x)
normalCode();
"""

import re
matcher = re.compile(r"^[ \t]*#define(.*\\\n)+.*$",re.MULTILINE)

def extractDefines(s):
    mo = matcher.search(s)
    if not mo:
        print mo
        return
    print mo.group(0)

extractDefines(TEST1)
extractDefines(TEST2)
extractDefines(TEST3)
extractDefines(TEST4) 
```

我使用的重新：

```
r"^[ \t]*#define(.*\\\n)+.*$" 
```

与使用的一种用途非常相似，变化：

1.  [ \t] 避免在定义开始处换行。
2.  我依赖 + 是贪婪的，所以我可以在最后使用一个简单的 .*$ 来获取不以 \ 结尾的定义的第一行

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T17:53:30.713

```
start        = r"^\s*#define\s+"
continuation = r"(?:.*\\\n)+"
lastline     = r".*$"

re_multiline_macros = re.compile(start + continuation + lastline, 
                                 re.MULTILINE) 
```

# ruby-on-rails - 如何在 Ruby on Rails 执行期间确定控制器变量的值？

> ID：60720
> 
> 赞同：8
> 
> 时间：2008-09-13T17:44:00.457
> 
> 标签：ruby-on-rails, ruby, debugging, variables

在执行期间确定控制器变量值的最佳方法是什么？

例如，有没有一种方法可以在代码中插入中断，并导致变量的值输出到屏幕（或日志）？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-13T17:56:16.683

是的。最简单的方法是将值提升为字符串。像这样：`raise @foo.to_s`

或者，您可以安装调试器 ( `gem install ruby-debug`)，然后使用`--debugger`标志启动开发服务器。然后，在您的代码中，调用该`debugger`指令。

在调试器提示中，您有许多命令，包括`p`打印变量的值。

**更新：**这里[有更多关于 ruby​​-debug 的信息](http://bashdb.sourceforge.net/ruby-debug.html)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-13T17:57:15.590

如果您有一个名为 的控制器实例变量`@foo`，那么在您的控制器中，您可以简单地执行以下操作：

```
logger.debug "@foo is: #{@foo}" 
```

此外，您可以使用以下方式在视图模板中输出值：

```
<%= debug @foo %> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-13T18:05:07.253

我更喜欢像这样使用检查方法：

```
raise @foo.inspect 
```

它比 to_s 有更多的信息，比如属性值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T14:34:51.270

Jordi Bunster、John Topley 和 Jaryl 的总结：

一、又快又脏的方式：

```
raise @foo.inspect 
```

在您的控制器中。或者

```
<% raise @foo.inspect %> 
```

在你看来。

二、正确记录给您`development.log`：

```
logger.debug "@foo == #{@foo.inspect}" 
```

三、[全面调试](http://bashdb.sourceforge.net/ruby-debug.html)：

安装调试器 ( `gem install ruby-debug`)，然后使用`--debugger`标志启动开发服务器。然后，在您的代码中，调用该`debugger`指令。

在调试器提示中，您有许多命令，包括`p`打印变量的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T14:42:12.797

如果您只需要查看一个值，则引发异常是最快的方法，但值得花时间学习如何正确使用调试器。您很少只需要查看变量的值，您可能会尝试在代码中查找错误，而这就是调试器的用途。

如果您学习如何使用调试器（谁想通读日志文件），则将信息发送到开发日志比这里的其他两个选项中的任何一个都慢。使用记录器进行生产，当有人打电话给你并说一切都坏了时，你会想看看价值是多少。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T12:40:35.170

好吧，我通常更喜欢标准错误输出

$stderr.print("随便")

它很简单并且可以完成工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-05-01T10:19:01.997

1.  将[撬动](https://github.com/garmoshka-mo/pry-moves)添加到 Gemfile：`gem 'pry-moves'`
2.  `binding.pry`在要停止的地方插入
3.  键入变量的名称以查看其值

* * *

然后继续键入`c`，移至下一行`n`或执行其他调试操作，直到您解决问题。

# linux - 如何在 GNU/Linux 上设置 Subversion (SVN) 服务器 - Ubuntu

> ID：60736
> 
> 赞同：96
> 
> 时间：2008-09-13T18:00:42.210
> 
> 标签：linux, svn, ubuntu, debian

我有一台运行 Ubuntu 的笔记本电脑，我想充当 Subversion 服务器。既为我自己在本地承诺，也为其他人远程。完成这项工作需要哪些步骤？请包括以下步骤：

*   获取和配置 Apache，以及必要的模块（我知道还有其他方法可以创建 SVN 服务器，但我希望它是特定于 Apache 的）
*   配置访问服务器的安全方式（SSH/HTTPS）
*   配置一组授权用户（如，他们必须授权提交，但可以自由浏览）
*   使用初始提交验证设置（类似于“Hello world”）

这些步骤可能涉及命令行或 GUI 应用程序指令的任何混合。如果可以，请注意说明特定于特定发行版或版本的位置，以及可以使用用户选择的特定工具的位置（例如[nano](https://en.wikipedia.org/wiki/GNU_nano)代替[vi](http://en.wikipedia.org/wiki/Vi)）。

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2008-09-13T19:37:23.803

我为使笔记本电脑成为 Subversion 服务器而采取的步骤。信用必须去[AlephZarro](http://alephzarro.com/blog/)为他的指示[在这里](http://alephzarro.com/blog/2007/01/07/installation-of-subversion-on-ubuntu-with-apache-ssl-and-basicauth/)。我现在有一个工作的 SVN 服务器（目前只在本地测试过）。

具体设置：Kubuntu 8.04 Hardy Heron

遵循本指南的要求：

*   apt-get 包管理程序
*   文本编辑器（我使用凯特）
*   须藤访问权限

1：安装 Apache HTTP 服务器和所需模块：

```
sudo apt-get install libapache2-svn apache2 
```

将安装以下额外软件包：

```
apache2-mpm-worker apache2-utils apache2.2-common 
```

2：启用 SSL

```
sudo a2enmod ssl
sudo kate /etc/apache2/ports.conf 
```

添加或检查文件中是否包含以下内容：

```
<IfModule mod_ssl.c>
    Listen 443
</IfModule> 
```

3：生成SSL证书：

```
sudo apt-get install ssl-cert
sudo mkdir /etc/apache2/ssl
sudo /usr/sbin/make-ssl-cert /usr/share/ssl-cert/ssleay.cnf /etc/apache2/ssl/apache.pem 
```

4：创建虚拟主机

```
sudo cp /etc/apache2/sites-available/default /etc/apache2/sites-available/svnserver
sudo kate /etc/apache2/sites-available/svnserver 
```

更改（在 ports.conf 中）：

```
"NameVirtualHost *" to "NameVirtualHost *:443" 
```

和（在 svnserver 中）

```
<VirtualHost *> to <VirtualHost *:443> 
```

在 ServerAdmin 下添加（也在文件 svnserver 中）：

```
SSLEngine on
SSLCertificateFile /etc/apache2/ssl/apache.pem
SSLProtocol all
SSLCipherSuite HIGH:MEDIUM 
```

5：启用网站：

```
sudo a2ensite svnserver
sudo /etc/init.d/apache2 restart 
```

要克服警告：

```
sudo kate /etc/apache2/apache2.conf 
```

添加：

```
"ServerName $your_server_name" 
```

6：添加存储库：以下设置假设我们要托管多个存储库。运行此命令以创建第一个存储库：

```
sudo mkdir /var/svn

REPOS=myFirstRepo
sudo svnadmin create /var/svn/$REPOS
sudo chown -R www-data:www-data /var/svn/$REPOS
sudo chmod -R g+ws /var/svn/$REPOS 
```

6.a. 对于更多存储库：再次执行第 6 步（更改 REPOS 的值），跳过该步骤`mkdir /var/svn`

7：添加认证用户

```
sudo htpasswd -c -m /etc/apache2/dav_svn.passwd $user_name 
```

8：启用和配置WebDAV和SVN：

```
sudo kate /etc/apache2/mods-available/dav_svn.conf 
```

添加或取消注释：

```
<Location /svn>
DAV svn

# for multiple repositories - see comments in file
SVNParentPath /var/svn

AuthType Basic
AuthName "Subversion Repository"
AuthUserFile /etc/apache2/dav_svn.passwd
Require valid-user
SSLRequireSSL
</Location> 
```

9：重启apache服务器：

```
sudo /etc/init.d/apache2 restart 
```

10：验证：

启动浏览器：

```
http://localhost/svn/$REPOS
https://localhost/svn/$REPOS 
```

两者都需要用户名和密码。我认为取消注释：

```
<LimitExcept GET PROPFIND OPTIONS REPORT>

</LimitExcept> 
```

在`/etc/apache2/mods-available/dav_svn.conf`, 将允许匿名浏览。

浏览器显示“Revision 0: /”

提交一些东西：

```
svn import --username $user_name anyfile.txt https://localhost/svn/$REPOS/anyfile.txt -m “Testing” 
```

接受证书并输入密码。查看您刚刚提交的内容：

```
svn co --username $user_name https://localhost/svn/$REPOS 
```

按照这些步骤（假设我没有进行任何错误复制/粘贴），我的笔记本电脑上有一个可用的 SVN 存储库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-04T12:14:52.457

之后，我需要执行（在上面引用的示例的上下文中）

$ sudo chmod g+w /var/svn/$REPOS/db/rep-cache.db

$ sudo chown www-data:www-data /var/svn/$REPOS/db/rep-cache.db

否则我在提交本地修改时一直收到 409 错误（尽管这些承诺在服务器端有效，但我需要跟进本地更新）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-25T11:49:20.290

如果您在访问网络服务器时收到 403 禁止，可能是因为您使用的主机名不是您在配置文件中指定的主机名（即 localhost 或 127.0.0.1）。尝试点击[https://whateveryousetasyourhostname](https://whateveryousetasyourhostname)代替...

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-13T18:09:01.427

对于阿帕奇：

```
sudo apt-get -yq install apache2 
```

对于 SSH：

```
sudo apt-get -yq install openssh-server 
```

对于颠覆：

```
sudo apt-get -yq install subversion subversion-tools 
```

如果您愿意，可以将它们组合成一个命令，例如：

```
sudo apt-get -yq install apache2 openssh-server subversion subversion-tools 
```

其他的我帮不上...

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2014-11-18T06:26:56.907

请在终端上写一个命令。

要打开终端，请按`Ctrl`+ `Alt`+ `T`，然后键入以下命令：

```
$sudo apt-get install subversion 
```

# jquery - 应该使用哪个 jQuery 插件来修复 IE6 PNG 透明度问题？

> ID：60740
> 
> 赞同：11
> 
> 时间：2008-09-13T18:08:22.567
> 
> 标签：jquery, internet-explorer-6, png

是否有 jQuery 团队正式开发的 IE6/PNG 修复程序？

如果不是，我应该使用哪个可用的插件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-13T18:33:06.080

我正在使用[jquery.pngFix.js](http://jquery.andreaseberhard.de/pngFix/)。我不知道它是否被官方批准，我知道它有效。我选择它是因为它是 FancyBox 附带的插件，没有其他原因。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-13T22:35:43.450

这个[.htc pngfix](http://www.twinhelix.com/css/iepngfix/)一直对我有用，即使在 jquery 插件失败的情况下也是如此。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-13T18:10:56.837

看一下这个。有些人在评论中也提到了 jQuery 插件。

[从 24 种方式修复 PNG](http://24ways.org/2007/supersleight-transparent-png-in-ie6)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-29T17:23:35.330

**你好Guyz，这是我解决这个问题的方法**

[从 ( http://jquery.andreaseberhard.de](http://jquery.andreaseberhard.de) )下载 jQuery-Plugin "pngFix" 顺便说一句很棒的插件！！！

**--更改这些行，如下所示：**

```
// this line
jQuery(this).find("img[src$=.png]:visible").each(function() { 
// this line
jQuery(this).find(":visible").each(function(){
// and this line
jQuery(this).find("input[src$=.png]:visible").each(function() { 
```

**--在结束之前放置此代码**

```
// Store a reference to the original method.
var _show = jQuery.fn.show;

// Overriding Show method.
jQuery.fn.show = function(){
  // Execute the original method.
  _show.apply( this, arguments );
  // Fix Png 
  return $(this).pngFix();
}

//No more problems with hidden images

})(jQuery);

//The End 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-06T21:25:03.763

嘿伙计们，只是想把这个扔进去。我又在四处寻找它，它比其他的有一个特定的优势：可重复的背景，以及背景位置（这里被标记为最佳答案的那个实际上只是缩放背景图像）。

[http://www.dillerdesign.com/experiment/DD_belatedPNG/](http://www.dillerdesign.com/experiment/DD_belatedPNG/)

太棒了。只需将其放入并忘记它。还没有看到它爆炸一组CSS。

# c++ - c ++具有多个图形选项

> ID：60751
> 
> 赞同：4
> 
> 时间：2008-09-13T18:20:36.250
> 
> 标签：c++, opengl, graphics, direct3d

目前，我的应用程序仅使用 Direct3D9 进行图形处理，但将来我计划将其扩展到 D3D10 和可能的 OpenGL。问题是我怎样才能以整洁的方式做到这一点？

目前我的代码中有各种Render方法

```
void Render(boost::function<void()> &Call)
{
    D3dDevice->BeginScene();
    Call();
    D3dDevice->EndScene();
    D3dDevice->Present(0,0,0,0);
} 
```

然后传递的函数取决于确切的状态，例如 MainMenu->Render、Loading->Render 等。这些将经常调用其​​他对象的方法。

```
void RenderGame()
{
    for(entity::iterator it = entity::instances.begin();it != entity::instance.end(); ++it)
        (*it)->Render();
    UI->Render();
} 
```

以及从 entity::Base 派生的示例类

```
class Sprite: public Base
{
    IDirect3DTexture9 *Tex;
    Point2 Pos;
    Size2 Size;
public:
    Sprite(IDirect3DTexture9  *Tex, const Point2 &Pos, const Size2 &Size);
    virtual void Render();
}; 
```

然后，每种方法都会根据更详细的设置（例如是否支持像素着色器）来处理如何最好地渲染。

问题是我真的不确定如何扩展它以能够使用其中一种可能有所不同的（D3D v OpenGL）渲染模式......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-13T19:33:55.107

定义一个足以满足应用程序图形输出需求的界面。然后为您要支持的每个渲染器实现此接口。

```
class IRenderer {
  public:
    virtual ~IRenderer() {}
    virtual void RenderModel(CModel* model) = 0;
    virtual void DrawScreenQuad(int x1, int y1, int x2, int y2) = 0;
    // ...etc...
};

class COpenGLRenderer : public IRenderer {
  public:
    virtual void RenderModel(CModel* model) {
      // render model using OpenGL
    }
    virtual void DrawScreenQuad(int x1, int y1, int x2, int y2) {
      // draw screen aligned quad using OpenGL
    }
};

class CDirect3DRenderer : public IRenderer {
  // similar, but render using Direct3D
}; 
```

但是，正确设计和维护这些接口可能非常具有挑战性。

如果您还使用与渲染驱动程序相关的对象（如纹理）进行操作，您可以使用工厂模式让单独的渲染器每个都使用 IRenderer 中的工厂方法创建自己的 ITexture 实现：

```
class IRenderer {
  //...
    virtual ITexture* CreateTexture(const char* filename) = 0;
  //...
};

class COpenGLRenderer : public IRenderer {
  //...
    virtual ITexture* CreateTexture(const char* filename) {
      // COpenGLTexture is the OpenGL specific ITexture implementation
      return new COpenGLTexture(filename);
    }
  //...
}; 
```

看看现有的（3d）引擎不是一个想法吗？根据我设计这种界面的经验，真的会分散你真正想要做的事情:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T03:09:46.493

我想说，如果您想要一个真正完整的答案，请查看`Ogre3D`. 他们有两端`D3D`和`OpenGL`后端。看看：[http](http://www.ogre3d.org) : //www.ogre3d.org 基本上他们的 API 迫使你以 D3D 的方式工作，创建缓冲区对象并用数据填充它们，然后在这些缓冲区上发出绘图调用。无论如何，这就是硬件喜欢它的方式，所以这不是一个坏方法。

然后，一旦您了解他们是如何做事的，您不妨继续使用它，而不必重新实现它已经提供的所有功能。:-)

# security - 处理用户帐户身份验证和密码的最佳方法

> ID：60757
> 
> 赞同：5
> 
> 时间：2008-09-13T18:34:58.510
> 
> 标签：security, database-design, authentication, authorization

在系统中处理用户帐户管理的最佳方法是什么，而不让您的员工有权访问数据库来访问帐户。

例子：

1.  在数据库中存储用户名/密码。这是一个坏主意，因为任何有权访问数据库的人都可以看到用户名和密码。因此使用它。

2.  存储用户名/密码哈希。这是一种更好的方法，但是可以通过将数据库中的密码哈希替换为您知道其身份验证信息的另一个帐户的哈希来访问该帐户。然后在授予访问权限后将其还原回数据库。

windows/*nix 是如何处理这个问题的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T18:51:29.327

> 这是一种更好的方法，但是可以通过将数据库中的密码哈希替换为您知道其身份验证信息的另一个帐户的哈希来访问该帐户。

真的没有办法解决这个问题。任何对密码文件具有写访问权限的人都可以完全控制计算机。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T20:51:06.093

我会选择2，但使用一些盐。一些伪代码：

```
SetPassword(user, password)
    salt = RandomString()
    hash = Hashfunction(salt+password)
    StoreInDatabase(user, salt, hash)

CheckPassword(user, password)
    (salt, hash) = GetFromDatabase(user)
    if Hashfunction(salt+password) == hash
        return "Success"
    else
        return "Login Failed" 
```

使用在库中实现的众所周知的散列函数（例如 MD5 或 SHA-1）很重要。**不要自己动手或尝试从书中实现它，这**不值得冒出错的风险。

@Brian R. Bondy：您使用盐的原因是为了使字典攻击更加困难，攻击者无法对字典进行哈希处理并尝试对所有密码进行尝试，相反，她必须使用盐 + 字典并对其进行哈希处理，这使得存储需求爆发。如果您有 1000 个最常用密码的字典并对它们进行哈希处理，则您需要 16 kB 之类的大小，但如果添加两个随机字母，您将得到 62*62*16 kB ≈ 62 Mb。

否则，您可以使用某种[一次性密码](http://en.wikipedia.org/wiki/One-time_password)，我听说过有关 OTPW 的好消息，但还没有使用过。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T17:06:52.610

这是多年前 UNIX 中的一个常见问题，通过将用户身份组件（用户名、UID、shell、全名等）与身份验证组件（密码哈希、密码哈希盐）分开来解决。身份组件可以是全局可读的（事实上必须是，如果要将 UID 映射到用户名），但身份验证组件**必须**保持用户无法访问。要对用户进行身份验证，请拥有一个接受用户名和密码的受信任系统，并返回“已验证”或“未验证”的简单结果。该系统应该是唯一可以访问身份验证数据库的应用程序，并且应该等待一段随机的时间（可能在 0.1 到 3 秒之间），然后再进行回复，以帮助避免定时攻击。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-13T19:29:54.993

您可以使用 openID 并且根本不保存任何机密用户密码。谁说它只适用于网站？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-14T08:37:14.180

Jeff Atwood 有一些关于散列的好帖子，如果你决定走那条路：

*   [彩虹哈希破解](http://www.codinghorror.com/blog/archives/000949.html)
*   [您可能错误地存储了密码](http://www.codinghorror.com/blog/archives/000953.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-13T18:41:54.857

1.  确实是一个非常糟糕的主意。如果数据库受到威胁，所有帐户都会受到威胁。
2.  好方法。如果您的散列算法包含用户名，则将密码散列替换为另一个将不起作用。

Unix 将哈希值存储在一个文本文件 /etc/shadow 中，只有特权用户可以访问该文件。密码用盐加密。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T18:38:05.710

您可以将哈希密码的*盐*存储在另一个表中，当然每个用户都有自己的盐。然后，您可以限制对该表的访问。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-13T22:02:06.093

通常的方法是将选项二与电子邮件一起使用：

将用户名、密码哈希和电子邮件地址存储到数据库中。

用户可以输入他们的密码或重置密码，在后一种情况下会生成一个随机密码，为用户创建一个新的哈希并通过电子邮件将密码发送给他。

编辑：如果数据库遭到破坏，那么您只能保证无法访问任何敏感信息，您将无法再确保应用程序的安全性。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-13T22:27:28.777

将用户名和密码散列*在一起*。这样，如果两个用户的密码相同，哈希值仍然不同。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-24T10:54:46.967

这对于很多应用程序来说都不是问题，因为获得对数据库的访问权限可能是任何攻击者最常见的目标。那么，如果他们已经可以访问数据库，为什么还要登录应用程序呢？:)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-05-08T19:58:32.887

如果“系统”是一个公共网站， [RPX](https://rpxnow.com/)可以为您提供最常见的提供商的登录/用户帐户服务，例如 OpenId、Facebook、Google 等。

现在，鉴于您提出问题的方式，我猜您所说的“系统”更可能是基于内部 Windows/Linux 的企业应用程序。尽管如此; 对于那些在谷歌上搜索登录/用户帐户提供商的人（就像我在遇到 RPX 之前所做的那样），这可能是一个很好的选择:)

# linux - 在家学习内核黑客和嵌入式开发？

> ID：60763
> 
> 赞同：36
> 
> 时间：2008-09-13T18:48:13.877
> 
> 标签：linux, kernel, embedded

我总是被内核黑客和嵌入式系统的世界所吸引。
有没有人有关于开始弄乱这些东西的好教程（+容易获得的硬件）？
诸如用于编写驱动程序的工具包之类的东西，它们带有良好的文档并且价格合理？

谢谢！

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-06T14:38:26.727

如果您对内核开发完全陌生，我建议不要从硬件开发开始，而是使用一些“纯软件”内核模块，如 proc 文件/sysfs 或更复杂的示例文件系统/网络开发，在 uml/vmware/ 上开发virtualbox/...机器，所以让你的机器崩溃不会有太大的伤害:) 对于嵌入式开发，你可以选择一个小型 ARM 开发套件或小型 Via C3/C4 机器，或者任何你可以用自制软件烧录的旧 PC USB / PCI / 任何设备。

一个好的起点可能是[Kernelnewbies.org](http://kernelnewbies.org/) - 它为内核开发人员提供了许多链接和有用的信息，并且还提供了一个易于实现的任务列表以供初学者处理。

一些要读的书：

[了解 Linux 内核](http://books.google.de/books?id=cbbMrRNiC4cC&dq=understanding+the+linux+kernel&pg=PP1&ots=TvUb8_r9Yd&sig=7Cn76JnJktn0B9cvLjh-pxFEdfo&hl=de&sa=X&oi=book_result&resnum=5&ct=result#PPP1,M1)- 一个很好的参考资料，详细介绍了内核子系统的设计

[Linux 设备驱动程序](http://lwn.net/Kernel/LDD3/)- 编写起来更像是一个包含大量示例代码的教程，重点是让您了解并解释 linux 内核的关键方面。它介绍了内核模块的构建过程和基础知识。

[Linux Kernel Module Programming Guide](http://www.tldp.org/LDP/lkmpg/2.6/html/) - 一些更多的介绍性材料

如前所述，查看 linux 代码总是一个好主意，尤其是 Linux 内核 API 往往会经常更改……LXR 提供了非常好的浏览界面 - [lxr.linux.no](http://lxr.linux.no)

要了解内核构建过程，此链接可能会有所帮助：

[Linux 内核 Makefiles (kbuild)](http://www.ravnborg.org/kbuild/makefiles.html)

最后但同样重要的是，浏览内核源代码发行版的文档目录！

以下是一些从内核开发课程中偷来的有趣练习：

*   编写一个内核模块，该模块创建文件 /proc/jiffies，在每次读取访问时以 jiffies 报告当前时间。
*   编写一个提供 proc 文件 /proc/sleep 的内核模块。当应用程序将若干秒作为 ASCII 文本写入此文件时（“echo 3 > /proc/sleep”），它应该阻塞指定的秒数。写访问应该对文件的内容没有副作用，即，在读访问时，文件应该看起来是空的（见 LDD3，第 6/7 章）
*   编写一个 proc 文件，您可以在其中临时存储一些文本（使用 echo "blah" > /proc/pipe）并再次将其取出（cat /proc/pipe），清除文件。注意同步问题。
*   修改管道示例模块注册为字符设备/dev/pipe，为写请求添加动态内存分配。
*   编写一个非常简单的文件系统。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T08:06:17.313

绝对**必须**是鲁比尼的[这](http://lwn.net/Kernel/LDD3/)本书。（提供硬拷贝或免费软拷贝）

他提供了几个虚拟驱动程序的实现，这些虚拟驱动程序不需要您拥有除 PC 之外的任何硬件。因此，对于开始内核开发来说，这是最简单的方法。

至于做嵌入式工作，我建议购买那里的众多 SBC（单板计算机）之一。其中有许多基于 x86 处理器，通常带有 PC/104 接口（在电气上 PC/104 与 ISA 总线标准相同，但基于可堆叠连接器而不是边缘连接器 - 非常容易与自定义硬件连接）

他们通常有 vga 连接器，可以更轻松地进行调试。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-13T20:04:50.650

对于嵌入式 Linux 黑客，您可以随处购买的简单 Linksys WRT54G 路由器是一个独立的开发平台[http://en.wikipedia.org/wiki/Linksys_WRT54G_series](http://en.wikipedia.org/wiki/Linksys_WRT54G_series)：

> WRT54G 以作为第一个发布固件源代码以满足 GNU GPL 义务的消费级网络设备而著称。这允许程序员修改固件以更改或添加设备功能。几个第三方固件项目为公众提供了 WRT54G 的增强固件。

我试过在上面安装[OpenWrt](http://www.openwrt.org)和[DD-WRT](http://www.dd-wrt.com)固件。您可以将这些作为在低成本平台上进行黑客攻击的起点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T18:28:35.107

对于初学者来说，最好的方法是阅读大量代码。由于 Linux 是开源的，因此您会发现许多驱动程序。找到一个在某些方面像你想写的东西一样有效的东西。您会发现一些体面且相对易于理解的代码（环回设备、ROM fs 等）

您还可以使用[lxr.linux.no](http://lxr.linux.no)，这是交叉引用的 Linux 代码。如果您必须找出某些东西是如何工作的，并且需要查看代码，这是一个很好且简单的方法。

还有一本 O'Reilly 的书（了解 Linux 内核，第 3 版是关于 2.6 内核的），或者如果你想要免费的东西，你可以使用高级 Linux 编程书（[http://www.advancedlinuxprogramming.com/](http://www.advancedlinuxprogramming.com/)） . 还有很多关于文件系统、网络等的特定文档。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-14T04:12:51.663

一些需要准备的东西：

*   您将进行交叉编译。嵌入式设备将使用 MIPS、PowerPC 或 ARM CPU，但没有足够的 CPU 能力、内存或存储来在合理的时间内编译自己的内核。
*   嵌入式系统通常使用串行端口作为控制台，为了降低成本，通常不会将连接器焊接到生产板上。调试内核崩溃非常困难，除非您可以焊接到串行端口连接器上，否则您不会有太多关于出了什么问题的信息。

[Linksys NSLU2](http://www.nslu2-linux.org/)是一种让真正的嵌入式系统工作的低成本方式，并且有一个 USB 端口来添加外围设备。也可以使用任意数量的无线接入点，请参阅[OpenWrt 兼容性页面。](http://wiki.openwrt.org/TableOfHardware)请注意，您可以在商店中找到的当前型号的 Linksys WRT54G 不能再与 Linux 一起使用：它们的 RAM 和闪存更少，以降低成本。Cisco/Linksys 现在在 WRT54G 上使用 vxWorks，内存占用更小。

如果你真的想进入它，嵌入式 CPU 的评估套件起价为几百美元。我建议不要在这些上花钱，除非您出于工作或咨询合同的专业需要。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-31T10:31:56.870

我完全是内核黑客的初学者 :) 我决定买两本书“Linux 程序开发：练习指南”和“编写 Linux 设备驱动程序：练习指南”，它们写得很清楚，为进一步学习提供了良好的基础。

# java - 如何在运行时动态加载 JAR 文件？

> ID：60764
> 
> 赞同：349
> 
> 时间：2008-09-13T18:48:19.570
> 
> 标签：java, jar, classloader

为什么在 Java 中做到这一点如此困难？如果您想拥有任何类型的模块系统，您需要能够动态加载 JAR 文件。有人告诉我有一种方法可以通过编写自己`ClassLoader`的 .

对执行此操作的简单代码有什么建议吗？

* * *

## 回答 #1

> 赞同：292
> 
> 时间：2008-09-13T19:04:16.613

难的原因是安全性。类加载器是不可变的；您不应该在运行时随意添加类。实际上，我对使用系统类加载器感到非常惊讶。以下是制作自己的子类加载器的方法：

```
URLClassLoader child = new URLClassLoader(
        new URL[] {myJar.toURI().toURL()},
        this.getClass().getClassLoader()
);
Class classToLoad = Class.forName("com.MyClass", true, child);
Method method = classToLoad.getDeclaredMethod("myMethod");
Object instance = classToLoad.newInstance();
Object result = method.invoke(instance); 
```

痛苦，但它就在那里。

* * *

## 回答 #2

> 赞同：147
> 
> 时间：2008-09-13T18:50:36.023

以下解决方案是骇人听闻的，因为它使用反射绕过封装，但它完美无缺：

```
File file = ...
URL url = file.toURI().toURL();

URLClassLoader classLoader = (URLClassLoader)ClassLoader.getSystemClassLoader();
Method method = URLClassLoader.class.getDeclaredMethod("addURL", URL.class);
method.setAccessible(true);
method.invoke(classLoader, url); 
```

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2008-09-13T18:55:34.543

您应该看看[OSGi](http://www.osgi.org)，例如在[Eclipse 平台](http://www.eclipse.org)中实现的。它正是这样做的。您可以安装、卸载、启动和停止所谓的包，这些包实际上是 JAR 文件。但它做得更多，因为它提供了例如可以在运行时在 JAR 文件中动态发现的服务。

或者查看[Java 模块系统](http://jcp.org/en/jsr/detail?id=277)的规范。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2009-09-20T11:35:39.023

[JCL 类加载器框架](https://github.com/kamranzafar/JCL)怎么样？我不得不承认，我没有使用过它，但它看起来很有希望。

使用示例：

```
JarClassLoader jcl = new JarClassLoader();
jcl.add("myjar.jar"); // Load jar file  
jcl.add(new URL("http://myserver.com/myjar.jar")); // Load jar from a URL
jcl.add(new FileInputStream("myotherjar.jar")); // Load jar file from stream
jcl.add("myclassfolder/"); // Load class folder  
jcl.add("myjarlib/"); // Recursively load all jar files in the folder/sub-folder(s)

JclObjectFactory factory = JclObjectFactory.getInstance();
// Create object of loaded class  
Object obj = factory.create(jcl, "mypackage.MyClass"); 
```

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2020-01-15T01:14:03.103

虽然这里列出的大多数解决方案要么是难以配置的黑客（JDK 9 之前）（代理），要么就是不再工作（JDK 9 之后），但我发现没有人提到[明确记录的方法](https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/ClassLoader.html#getSystemClassLoader())真的很令人惊讶。

您可以创建一个自定义系统类加载器，然后您可以自由地做任何您想做的事情。不需要反射，所有类共享相同的类加载器。

启动 JVM 时添加此标志：

```
java -Djava.system.class.loader=com.example.MyCustomClassLoader 
```

类加载器必须有一个接受类加载器的构造函数，该类加载器必须设置为其父级。JVM启动时会调用构造函数并传递真实系统类加载器，主类将由自定义加载器加载。

要添加罐子，只需调用`ClassLoader.getSystemClassLoader()`并将其转换为您的班级。

查看[此实现](https://github.com/update4j/update4j/blob/master/src/main/java/org/update4j/DynamicClassLoader.java)以获取精心设计的类加载器。请注意，您可以将`add()`方法更改为公开。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2010-04-07T15:33:22.013

这是一个未弃用的版本。我修改了原始版本以删除不推荐使用的功能。

```
/**************************************************************************************************
 * Copyright (c) 2004, Federal University of So Carlos                                           *
 *                                                                                                *
 * All rights reserved.                                                                           *
 *                                                                                                *
 * Redistribution and use in source and binary forms, with or without modification, are permitted *
 * provided that the following conditions are met:                                                *
 *                                                                                                *
 *     * Redistributions of source code must retain the above copyright notice, this list of      *
 *       conditions and the following disclaimer.                                                 *
 *     * Redistributions in binary form must reproduce the above copyright notice, this list of   *
 *     * conditions and the following disclaimer in the documentation and/or other materials      *
 *     * provided with the distribution.                                                          *
 *     * Neither the name of the Federal University of So Carlos nor the names of its            *
 *     * contributors may be used to endorse or promote products derived from this software       *
 *     * without specific prior written permission.                                               *
 *                                                                                                *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS                            *
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT                              *
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR                          *
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR                  *
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,                          *
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,                            *
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR                             *
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                         *
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING                           *
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS                             *
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                   *
 **************************************************************************************************/
/*
 * Created on Oct 6, 2004
 */
package tools;

import java.io.File;
import java.io.IOException;
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.net.URL;
import java.net.URLClassLoader;

/**
 * Useful class for dynamically changing the classpath, adding classes during runtime. 
 */
public class ClasspathHacker {
    /**
     * Parameters of the method to add an URL to the System classes. 
     */
    private static final Class<?>[] parameters = new Class[]{URL.class};

    /**
     * Adds a file to the classpath.
     * @param s a String pointing to the file
     * @throws IOException
     */
    public static void addFile(String s) throws IOException {
        File f = new File(s);
        addFile(f);
    }

    /**
     * Adds a file to the classpath
     * @param f the file to be added
     * @throws IOException
     */
    public static void addFile(File f) throws IOException {
        addURL(f.toURI().toURL());
    }

    /**
     * Adds the content pointed by the URL to the classpath.
     * @param u the URL pointing to the content to be added
     * @throws IOException
     */
    public static void addURL(URL u) throws IOException {
        URLClassLoader sysloader = (URLClassLoader)ClassLoader.getSystemClassLoader();
        Class<?> sysclass = URLClassLoader.class;
        try {
            Method method = sysclass.getDeclaredMethod("addURL",parameters);
            method.setAccessible(true);
            method.invoke(sysloader,new Object[]{ u }); 
        } catch (Throwable t) {
            t.printStackTrace();
            throw new IOException("Error, could not add URL to system classloader");
        }        
    }

    public static void main(String args[]) throws IOException, SecurityException, ClassNotFoundException, IllegalArgumentException, InstantiationException, IllegalAccessException, InvocationTargetException, NoSuchMethodException{
        addFile("C:\\dynamicloading.jar");
        Constructor<?> cs = ClassLoader.getSystemClassLoader().loadClass("test.DymamicLoadingTest").getConstructor(String.class);
        DymamicLoadingTest instance = (DymamicLoadingTest)cs.newInstance();
        instance.test();
    }
} 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2017-09-27T21:28:57.140

使用**Java 9**时，`URLClassLoader`现在的答案会给出如下错误：

```
java.lang.ClassCastException: java.base/jdk.internal.loader.ClassLoaders$AppClassLoader cannot be cast to java.base/java.net.URLClassLoader 
```

这是因为使用的类加载器发生了变化。相反，要添加到系统类加载器，您可以通过代理使用[Instrumentation API。](https://docs.oracle.com/javase/9/docs/api/java/lang/instrument/Instrumentation.html)

**创建代理类：**

```
package ClassPathAgent;

import java.io.IOException;
import java.lang.instrument.Instrumentation;
import java.util.jar.JarFile;

public class ClassPathAgent {
    public static void agentmain(String args, Instrumentation instrumentation) throws IOException {
        instrumentation.appendToSystemClassLoaderSearch(new JarFile(args));
    }
} 
```

**添加 META-INF/MANIFEST.MF 并将其与代理类一起放入 JAR 文件中：**

```
Manifest-Version: 1.0
Agent-Class: ClassPathAgent.ClassPathAgent 
```

**运行代理：**

这使用[byte-buddy-agent](https://github.com/raphw/byte-buddy)库将代理添加到正在运行的 JVM：

```
import java.io.File;

import net.bytebuddy.agent.ByteBuddyAgent;

public class ClassPathUtil {
    private static File AGENT_JAR = new File("/path/to/agent.jar");

    public static void addJarToClassPath(File jarFile) {
        ByteBuddyAgent.attach(AGENT_JAR, String.valueOf(ProcessHandle.current().pid()), jarFile.getPath());
    }
} 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2018-11-02T01:16:54.117

以下是 Alllain 方法的快速解决方法，以使其与较新版本的 Java 兼容：

```
ClassLoader classLoader = ClassLoader.getSystemClassLoader();
try {
    Method method = classLoader.getClass().getDeclaredMethod("addURL", URL.class);
    method.setAccessible(true);
    method.invoke(classLoader, new File(jarPath).toURI().toURL());
} catch (NoSuchMethodException e) {
    Method method = classLoader.getClass()
            .getDeclaredMethod("appendToClassPathForInstrumentation", String.class);
    method.setAccessible(true);
    method.invoke(classLoader, jarPath);
} 
```

请注意，它依赖于特定 JVM 内部实现的知识，因此它并不理想，也不是通用解决方案。但是，如果您知道要使用标准 OpenJDK 或 Oracle JVM，那么这是一种快速简便的解决方法。将来发布新的 JVM 版本时，它也可能会中断，因此您需要牢记这一点。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-09-15T15:22:42.293

我发现最好的是[org.apache.xbean.classloader.JarFileClassLoader](http://svn.apache.org/viewvc/geronimo/xbean/trunk/xbean-classloader/src/main/java/org/apache/xbean/classloader/JarFileClassLoader.java?view=markup)，它是[XBean](http://geronimo.apache.org/xbean)项目的一部分。

这是我过去使用过的一种简短方法，用于从特定目录中的所有 lib 文件创建类加载器

```
public void initialize(String libDir) throws Exception {
    File dependencyDirectory = new File(libDir);
    File[] files = dependencyDirectory.listFiles();
    ArrayList<URL> urls = new ArrayList<URL>();
    for (int i = 0; i < files.length; i++) {
        if (files[i].getName().endsWith(".jar")) {
        urls.add(files[i].toURL());
        //urls.add(files[i].toURI().toURL());
        }
    }
    classLoader = new JarFileClassLoader("Scheduler CL" + System.currentTimeMillis(), 
        urls.toArray(new URL[urls.size()]), 
        GFClassLoader.class.getClassLoader());
} 
```

然后要使用类加载器，只需执行以下操作：

```
classLoader.loadClass(name); 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2013-08-15T12:57:44.580

如果您使用的是 Android，则以下代码有效：

```
String jarFile = "path/to/jarfile.jar";
DexClassLoader classLoader = new DexClassLoader(jarFile, "/data/data/" + context.getPackageName() + "/", null, getClass().getClassLoader());
Class<?> myClass = classLoader.loadClass("MyClass"); 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2020-07-25T23:36:59.423

我知道我迟到了，但我一直在使用[pf4j](https://github.com/pf4j/pf4j)，这是一个插件框架，而且效果很好。

PF4J 是一个微框架，其目的是保持核心简单但可扩展。

插件使用示例：

使用 ExtensionPoint 接口标记在应用程序/插件中定义扩展点：

```
public interface Greeting extends ExtensionPoint {

    String getGreeting();

} 
```

`@Extension`使用注解创建扩展：

```
@Extension
public class WelcomeGreeting implements Greeting {

    public String getGreeting() {
        return "Welcome";
    }

} 
```

然后您可以根据需要加载和卸载插件：

```
public static void main(String[] args) {

    // create the plugin manager
    PluginManager pluginManager = new JarPluginManager(); // or "new ZipPluginManager() / new DefaultPluginManager()"

    // start and load all plugins of application
    pluginManager.loadPlugins();
    pluginManager.startPlugins();

    // retrieve all extensions for "Greeting" extension point
    List<Greeting> greetings = pluginManager.getExtensions(Greeting.class);
    for (Greeting greeting : greetings) {
        System.out.println(">>> " + greeting.getGreeting());
    }

    // stop and unload all plugins
    pluginManager.stopPlugins();
    pluginManager.unloadPlugins();

} 
```

有关更多详细信息，请参阅[文档](https://pf4j.org/)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2015-07-25T07:40:57.553

jodonnell 提出的解决方案很好，但应该加强一点。我使用这篇文章成功地开发了我的应用程序。

## 分配当前线程

首先我们必须添加

```
Thread.currentThread().setContextClassLoader(classLoader); 
```

否则您将无法加载存储到 jar 中的资源（例如 spring/context.xml）。

## 不包括

你的 jars 到父类加载器中，否则你将无法理解谁在加载什么。

另请参阅[使用 URLClassLoader 重新加载 jar 时出现问题](https://stackoverflow.com/questions/3216780/problem-reloading-a-jar-using-urlclassloader/31624123#31624123)

然而，OSGi 框架仍然是最好的方式。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2018-10-02T21:50:37.620

Alllain 的另一个版本的 hackish 解决方案也适用于 JDK 11：

```
File file = ...
URL url = file.toURI().toURL();
URLClassLoader sysLoader = new URLClassLoader(new URL[0]);

Method sysMethod = URLClassLoader.class.getDeclaredMethod("addURL", new Class[]{URL.class});
sysMethod.setAccessible(true);
sysMethod.invoke(sysLoader, new Object[]{url}); 
```

在 JDK 11 上，它给出了一些弃用警告，但作为在 JDK 11 上使用 Alllain 解决方案的人的临时解决方案。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2018-10-10T13:42:35.563

另一个使用 Instrumentation 的工作解决方案对我有用。它的优点是修改了类加载器搜索，避免了依赖类的类可见性问题：

**创建代理类**

对于此示例，它必须位于命令行调用的同一 jar 中：

```
package agent;

import java.io.IOException;
import java.lang.instrument.Instrumentation;
import java.util.jar.JarFile;

public class Agent {
   public static Instrumentation instrumentation;

   public static void premain(String args, Instrumentation instrumentation) {
      Agent.instrumentation = instrumentation;
   }

   public static void agentmain(String args, Instrumentation instrumentation) {
      Agent.instrumentation = instrumentation;
   }

   public static void appendJarFile(JarFile file) throws IOException {
      if (instrumentation != null) {
         instrumentation.appendToSystemClassLoaderSearch(file);
      }
   }
} 
```

**修改 MANIFEST.MF**

添加对代理的引用：

```
Launcher-Agent-Class: agent.Agent
Agent-Class: agent.Agent
Premain-Class: agent.Agent 
```

我实际上使用 Netbeans，所以[这篇文章](https://stackoverflow.com/a/52728977/10448469)有助于如何更改 manifest.mf

**跑步**

仅在 JDK 9+ 上受`Launcher-Agent-Class`支持，并且负责加载代理而不在命令行上显式定义它：

```
 java -jar <your jar> 
```

在 JDK 6+ 上工作的方式是定义`-javaagent`参数：

```
java -javaagent:<your jar> -jar <your jar> 
```

**在运行时添加新 Jar**

然后，您可以根据需要使用以下命令添加 jar：

```
Agent.appendJarFile(new JarFile(<your file>)); 
```

我在文档上使用它没有发现任何问题。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2020-03-12T23:04:57.150

如果将来有人搜索这个，这种方式对我来说适用于 OpenJDK 13.0.2。

我有许多需要在运行时动态实例化的类，每个类都可能具有不同的类路径。

在这段代码中，我已经有一个名为 pack 的对象，它包含一些关于我要加载的类的元数据。getObjectFile() 方法返回类的类文件的位置。getObjectRootPath() 方法返回包含类文件的 bin/ 目录的路径，这些类文件包括我要实例化的类。getLibPath() 方法返回包含 jar 文件的目录的路径，这些 jar 文件构成该类所属模块的类路径。

```
File object = new File(pack.getObjectFile()).getAbsoluteFile();
Object packObject;
try {
    URLClassLoader classloader;

    List<URL> classpath = new ArrayList<>();
    classpath.add(new File(pack.getObjectRootPath()).toURI().toURL());
    for (File jar : FileUtils.listFiles(new File(pack.getLibPath()), new String[] {"jar"}, true)) {
        classpath.add(jar.toURI().toURL());
    }
    classloader = new URLClassLoader(classpath.toArray(new URL[] {}));

    Class<?> clazz = classloader.loadClass(object.getName());
    packObject = clazz.getDeclaredConstructor().newInstance();

} catch (Exception e) {
    e.printStackTrace();
    throw e;
}
return packObject; 
```

我以前使用 Maven 依赖项：org.xeustechnologies:jcl-core:2.8 来执行此操作，但在超过 JDK 1.8 之后，它有时会冻结并且永远不会返回在 Reference::waitForReferencePendingList() 处“等待引用”。

我还保留了类加载器的映射，以便如果我尝试实例化的类与我已经实例化的类在同一个模块中，它们可以被重用，我会推荐。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-05-25T04:32:54.050

请看一下我开始的这个项目：[proxy-object lib](https://github.com/avinokurov/proxy-object)

这个库将从文件系统或任何其他位置加载 jar。它将为 jar 专用一个类加载器，以确保没有库冲突。用户将能够从加载的 jar 中创建任何对象并在其上调用任何方法。此库旨在从支持 Java 7 的代码库加载用 Java 8 编译的 jar。

创建对象：

```
 File libDir = new File("path/to/jar");

    ProxyCallerInterface caller = ObjectBuilder.builder()
            .setClassName("net.proxy.lib.test.LibClass")
            .setArtifact(DirArtifact.builder()
                    .withClazz(ObjectBuilderTest.class)
                    .withVersionInfo(newVersionInfo(libDir))
                    .build())
            .build();
    String version = caller.call("getLibVersion").asString(); 
```

ObjectBuilder 支持工厂方法、调用静态函数和回调接口实现。我将在自述文件页面上发布更多示例。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-10-21T00:20:01.137

这可能是一个较晚的响应，我可以使用 DataMelt 中的 jhplot.Web 类（[http://jwork.org/dmelt](http://jwork.org/dmelt) ）这样做（fastutil-8.2.2.jar 的一个简单示例）

```
import jhplot.Web;
Web.load("http://central.maven.org/maven2/it/unimi/dsi/fastutil/8.2.2/fastutil-8.2.2.jar"); // now you can start using this library 
```

根据文档，此文件将在“lib/user”中下载，然后动态加载，因此您可以立即开始在同一程序中使用此 jar 文件中的类。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2020-02-18T12:55:29.713

我需要在运行时为 java 8 和 java 9+ 加载一个 jar 文件（以上注释对这两个版本都不起作用）。这是执行此操作的方法（如果可能相关，请使用 Spring Boot 1.5.2）。

```
public static synchronized void loadLibrary(java.io.File jar) {
    try {            
        java.net.URL url = jar.toURI().toURL();
        java.lang.reflect.Method method = java.net.URLClassLoader.class.getDeclaredMethod("addURL", new Class[]{java.net.URL.class});
        method.setAccessible(true); /*promote the method to public access*/
        method.invoke(Thread.currentThread().getContextClassLoader(), new Object[]{url});
    } catch (Exception ex) {
        throw new RuntimeException("Cannot load library from jar file '" + jar.getAbsolutePath() + "'. Reason: " + ex.getMessage());
    }
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-07-08T18:55:39.587

对于jar文件的动态上传，可以使用我对URLClassLoader的修改。这个修改在应用运行过程中改变jar文件没有问题，和标准的URLClassloader一样。所有加载的 jar 文件都加载到 RAM 中，因此独立于原始文件。

[内存中的 jar 和 JDBC 类加载器](https://github.com/kotalr/b2b-jcl)

* * *

## 回答 #20

> 赞同：-3
> 
> 时间：2011-09-23T02:48:15.313

我个人觉得[java.util.ServiceLoader](http://download.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html)做得很好。[你可以在这里](http://java.sun.com/developer/technicalArticles/javase/extensible/)得到一个例子。

# c# - 无法为 CodeDom 加载 System.Data.Linq.dll

> ID：60768
> 
> 赞同：1
> 
> 时间：2008-09-13T18:53:25.250
> 
> 标签：c#, codedom

我正在尝试使用 CodeDom 动态编译代码。我可以加载其他程序集，但无法加载 System.Data.Linq.dll。我收到一个错误：

找不到元数据文件“System.Data.Linq.dll”

我的代码如下所示：

```
CompilerParameters compilerParams = new CompilerParameters();
compilerParams.CompilerOptions = "/target:library /optimize";
compilerParams.GenerateExecutable = false;
compilerParams.GenerateInMemory = true;
compilerParams.IncludeDebugInformation = false;
compilerParams.ReferencedAssemblies.Add("mscorlib.dll");
compilerParams.ReferencedAssemblies.Add("System.dll");
compilerParams.ReferencedAssemblies.Add("System.Data.Linq.dll"); 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T19:18:03.490

这可能是因为此程序集存储在与 mscorlib 不同的位置。如果您提供程序集的完整路径，它应该可以工作。获取完整路径最方便的方法是让 .NET 加载程序为您完成工作。我会尝试这样的事情：

```
compilerParams.ReferencedAssemblies.Add(typeof(DataContext).Assembly.Location); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-14T12:45:55.097

这可能是一个愚蠢的答案，但您确定代码在使用 .NET Framework 3.5 的机器上运行吗？

# user-interface - 帮助文件（或用户手册）死了吗？

> ID：60772
> 
> 赞同：23
> 
> 时间：2008-09-13T18:56:49.877
> 
> 标签：user-interface, language-agnostic, documentation

在 Unix 时代，如果不先阅读手册页，您甚至无法[关闭软件。](http://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Exiting)然后是具有一致菜单布局和键盘快捷键的 Mac 和 Windows，但您仍然会在收缩包装盒中看到纸质用户手册，其中描述了应用程序中可能的每一个操作。上网后，帮助文件变成了html文件。

现在使用*Web 2.0*应用程序，您几乎看不到帮助。即使[它在那里](http://mail.google.com/support/)，它们也只是描述了一些特定的任务。换句话说，这些应用程序更多地依赖于用户群的*常识*或[*不让我思考*](http://www.sensible.com/)的因素。

几年前，微软提出了一个叫做[归纳用户界面](http://msdn.microsoft.com/en-us/library/ms997506.aspx)的概念，它基本上告诉程序员在应用程序本身上输入指令，但我不确定这个想法有多受欢迎。

使用 F1 键的帮助文件、用户手册和上下文相关在线帮助是否失效？如果用户无法从 UI 中找到该做什么，我是否失败了？如果没有，我应该提供什么程度的帮助？（适用于桌面和网络应用程序）

编辑：文档/帮助文件如何与敏捷开发方法相结合？例如，开发人员是否应该在 UI 更改之前三思而后行，这可能会使一堆屏幕截图过时？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-13T19:08:33.123

### 关于帮助的三个注意事项：

1.  F1/独立的上下文相关帮助总是注定要失败的。默认情况下它是隐藏的，因此最需要它的人最不可能阅读它。曾经有希望我们能够训练用户在遇到麻烦时总是按 F1，但是太多的应用程序没有有用的上下文相关帮助......再加上太多奇怪的帮助界面......几乎被杀死这。
2.  手册现在和以往一样重要。不再有那么多印刷手册，但在线手册比以往任何时候都好。wiki-as-a-manual 系统的普及在这方面有所帮助，降低了创建良好在线文档的前期成本。当然，很多人*只是不读书*...
3.  将网页用作应用程序界面的美妙之处在于，您*可以*将有用的上下文相关帮助与 UI 结合起来，从而为新手和其他在遇到困难时无法查找相关信息的人消除障碍。

当然，仍然有很多应用程序，甚至是在线应用程序，设计的界面很钝，在某个角落的某个角落有一个很小的帮助图标，大概希望后者减轻前者的影响。可怜他们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-13T19:03:29.080

没门。你看看 MS 提出的文档、培训和营销支出的数量......你会得到答案。尝试使用其他人的产品，您将了解文档的真正价值 - 我现在正在学习 Godiagrams.. :)
所以我可以毫无疑问地说..**不，它永远不会.. 无论用户界面变得多么直观..超出一定规模，您将需要帮助和培训。**但是通过了解用户以及他需要完成什么，您可以将其设计为使他/她学习系统完成他/她的日常任务所需的时间最少。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T19:06:27.483

> 如果用户无法从 UI 中找到该做什么，我是否失败了？如果没有，我应该提供什么程度的帮助？（适用于桌面和网络应用程序）

他们应该能够使用您的应用程序从 UI 执行基本操作。例如，对于图像编辑器，他们应该能够创建一个新图像，并绘制一些线条，然后通过查看 UI 来保存它。

这最好通过遵循常见布局来完成（例如在菜单栏中的文件下新建、打开和保存，以及使用标准的打开和保存对话框）。

对于 webapps 也是如此，人们希望能够在不阅读文档的情况下做基本的事情，但对于更高级的功能，人们仍然会阅读文档。（例如，大多数人会阅读文档以获取 BB 代码或至少有时会降价，但他们希望能够发布而不必知道它们）

> 使用 F1 键的帮助文件、用户手册和上下文相关在线帮助是否失效？

他们仍然有自己的位置。人们将使用它们来学习如何最好地使用各种功能，例如 markdown 或 bbcode，或者如何使用过滤器在图像编辑器中获得某些效果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T05:19:49.207

我一直在将上下文相关的截屏视频合并到我的应用程序中。我发现这有助于非技术用户快速掌握应用程序，而无需寻求实时帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T21:13:26.380

白痴/傻瓜书一定做得很好。想象一下，如果标准应用程序帮助和那些书一样好。许多应用程序的标准 F1 帮助非常糟糕。

帮助死了吗？不，但其中一些应该取出并射击。

# php - 如何在 PDO 中使用绑定参数进行模糊搜索？

> ID：60779
> 
> 赞同：11
> 
> 时间：2008-09-13T19:09:01.953
> 
> 标签：php, sql, pdo

试图做这样的事情...

```
WHERE username LIKE '%$str%' 
```

...但是在 PDO 中使用绑定参数来准备语句。例如：

```
$query = $db->prepare("select * from comments where comment like :search");
$query->bindParam(':search', $str);
$query->execute(); 
```

我已经尝试了许多单引号和 % 符号的排列，这让我很反感。

我似乎记得以前在某个时候与这个摔跤，但我找不到任何参考资料。有谁知道如何（如果？）在 PDO 中使用命名参数很好地做到这一点？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-13T19:21:09.240

啊。在 php.net 上发现一条评论让我想起了答案；您需要在评估 bindParam 之前对您的值进行通配符，而不必担心引用它。因此，例如，这可以正常工作：

```
$str = "%$str%";
$query = $db->prepare("select * from comments where comment like :search");
$query->bindParam(':search', $str);
$query->execute(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-03-13T05:21:57.127

5 年后，万一其他人偶然发现了这一点，我发现了另一种方法。接受的解决方案对我的情况并不可行，但这种方法似乎也能完成工作：

```
$query = $db->prepare("select * FROM table WHERE field LIKE CONCAT('%',:search,'%')");
$query->bindParam(':search', $str);
$query->execute(); 
```

我不确定由于调用`CONCAT`函数的开销是否会影响性能，但我想将其作为一个选项传递。希望它会帮助某人。

# c# - 如何在 C# 中显示灰色透明覆盖？

> ID：60785
> 
> 赞同：0
> 
> 时间：2008-09-13T19:24:13.820
> 
> 标签：c#

如何在 C# 中显示灰色透明覆盖？
它应该覆盖不属于执行覆盖的应用程序的其他进程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-14T00:24:28.217

创建一个整个屏幕大小的透明窗口，将其标记为始终在顶部，计算其他应用程序窗口的区域，并将顶部窗口的非窗口区域设为灰色。

我想您可以将自己的应用程序窗口放置在透明的灰色窗口之上，使其高于所有其他窗口，但是得到一个像这样的棘手 z 顺序场景，特别是与其他可能也在做的应用程序结合使用z-order技巧，很难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T15:28:37.177

这是一个小应用程序，它或多或少地完成了您想要的功能：

[http://www.anappaday.com/downloads/2006/09/day-10-jedi-concentrate.html](http://www.anappaday.com/downloads/2006/09/day-10-jedi-concentrate.html)

# c# - 当应用程序是 C# 中的任务栏时，如何监听快捷方式

> ID：60788
> 
> 赞同：2
> 
> 时间：2008-09-13T19:31:15.783
> 
> 标签：c#, keyboard-shortcuts

执行此操作的应用程序示例是[Enso](http://www.humanized.com/enso/)，当您按下大写锁定时它会弹出。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T19:47:08.837

您可以通过调用 winapi 函数[RegisterHotKey](https://www.pinvoke.net/default.aspx/user32/RegisterHotKey.html)对全局热键进行操作。另请参阅[https://www.codeproject.com/Articles/4345/NET-system-wide-hotkey-component](https://www.codeproject.com/Articles/4345/NET-system-wide-hotkey-component)和[https://www.codeproject.com/Articles/3055/System-Hotkey-Component](https://www.codeproject.com/Articles/3055/System-Hotkey-Component)例如。您不能将所有组合键用作热键。对于那些不起作用的，您可以尝试使用全局键盘挂钩 (SetWindowsHookEx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-13T19:46:16.950

您需要在 user32.dll 中安装一个挂钩。查找 Win32-API 调用 SetWindowsHookEx。您可以通过 System.Runtime.InteropServices 中的内容从 C# 调用它。

[这篇文章](https://www.codeproject.com/Articles/14485/Low-level-Windows-API-hooks-from-C-to-stop-unwante)很好地讨论了这个话题。

**编辑**： Lars Truijens 的回答实际上看起来是一种更好的方法。

# javascript - LI 中的 Scriptaculous Ajax.Autocompleter 额外功能

> ID：60794
> 
> 赞同：1
> 
> 时间：2008-09-13T19:43:26.380
> 
> 标签：javascript, prototypejs, scriptaculous, autocomplete

我正在使用 Prototype/Scriptaculous 库中的 Ajax.Autocompleter 类，它调用一个 ASP.NET WebHandler，它创建一个包含建议的列表项的无序列表。

现在我正在开发一个页面，您可以在其中向“停用词”表添加建议，这意味着如果它们出现在表中，将不再被建议。

我在 LI 元素中放置了一个按钮，当您单击它时，它应该向页面发出 ajax 请求，然后将单词添加到表中。这样可行。但是我希望立即刷新建议，以便建议出现时没有刚刚添加到表中的单词。优选地，选择的词是之前点击的词的下一个或之前的词。

我该怎么做呢？现在发生的情况是，您单击按钮的 LI 成为选定的单词，并且建议消失了。

列表项如下所示：

```
<li>{0}
 <img onclick=\"deleteWord('{0}');\" src=\"delete.gif\"/>
</li> 
```

where`{0}`代表建议的词。JavaScript 函数`deleteWord(w)`会调用 webhandler，它可以将单词添加到“停用词”表中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-14T02:25:57.957

Scriptaculous Autocompleter 监视“li”上的 onclick 事件。当您将图像粘贴到“li”中时，“img”和“li”都会获得点击事件，如下所示。这就是为什么 Autocompleter 在单击按钮时只是做正常的事情的原因：

```
<ul>
  <li onclick="alert('li');">
    <img onclick="alert('image')" src="blah.gif"/>
  </li>
</ul> 
```

我会尝试让您的“onclick”设置某种状态变量，告诉您已单击删除。然后，如果设置了状态，则[覆盖自动完成器中的“updateElement”以不执行任何操作。](http://github.com/madrobby/scriptaculous/wikis/ajax-autocompleter)另一种方法是将整个自动完成器子类化并覆盖“onClick”。当您的图像被点击时，这将使列表不会消失。

要实时更新列表，请在图像的“onclick”中，也从 DOM 中的列表中删除“li”。像这样在概念上：

```
img onclick="deleteWord('blah');setStateVariable();this.parentNode.parentNode.removeChild(this.parentNode);" 
```

# ide - 在 AMD 处理器上安装 Curl IDE/RTE

> ID：60800
> 
> 赞同：0
> 
> 时间：2008-09-13T19:51:17.077
> 
> 标签：ide, amd-processor, curl-language

试图将我的开发环境迁移到 Linux。并且是 Curl 的新手。无法在运行 Ubuntu x64 的 AMD HP PC 上安装 IDE 和 RTE 软件包。我尝试通过包安装程序安装 Debian 包并得到“错误：错误的架构 - i386”。尝试使用 --force-architecture 开关，但它出错了。

我假设 Curl IDE 只能在 Intel 处理器下运行？任何人都对此问题有任何运气并可以提供建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-13T21:53:41.933

自从我运行 linux 以来已经有一段时间了，但尝试寻找 x64 版本。还有一些 x64 到 x86 的兼容性库可以让 32 位程序适用于大多数情况。

然而，对于这个问题， [ubuntu 论坛](http://ubuntuforums.org/)是一个更好的地方。

# linq - Linq to NHibernate 多个 OrderBy 调用

> ID：60802
> 
> 赞同：6
> 
> 时间：2008-09-13T19:55:00.547
> 
> 标签：linq, nhibernate, linq-to-nhibernate

我在我的 Linq to NHibernate 查询中按多个字段排序时遇到问题。有谁知道可能出了什么问题或者是否有解决方法？

代码：

```
IQueryable<AgendaItem> items = _agendaRepository.GetAgendaItems(location)
   .Where(item => item.Minutes.Contains(query) || item.Description.Contains(query));

int total = items.Count();

var results = items
   .OrderBy(item => item.Agenda.Date)
   .ThenBy(item => item.OutcomeType)
   .ThenBy(item => item.OutcomeNumber)
   .Skip((page - 1)*pageSize)
   .Take(pageSize)
   .ToArray();

return new SearchResult(query, total, results); 
```

我尝试用多个 OrderBy 调用替换 ThenBy。结果相同。如果我注释掉两个 ThenBy 调用，该方法效果很好。

我收到的错误：

```
    [SqlException（0x80131904）：无效的列名'__hibernate_sort_expr_0____hibernate_sort_expr_1__'。
    列名 '__hibernate_sort_expr_0____hibernate_sort_expr_1__' 无效。]
       System.Data.SqlClient.SqlConnection.OnError（SqlException 异常，布尔 breakConnection）+1948826
       System.Data.SqlClient.SqlInternalConnection.OnError（SqlException 异常，布尔型 breakConnection）+4844747
       System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) +194
       System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +2392

    [ADOException：无法执行查询
    [ 选择 this_.Id 作为 Id5_2_，this_.AgendaId 作为 AgendaId5_2_，this_.Description 作为 Descript3_5_2_，this_.OutcomeType 作为 OutcomeT4_5_2_，this_.OutcomeNumber 作为 OutcomeN5_5_2_，this_.Minutes 作为 Minutes5_2_，议程 1_.Id 作为 Id2_0_，议程 1_.LocationId 作为 LocationId2_0_议程 1_.日期为 Date2_0_，位置 2_.Id 为 Id7_1_，位置 2_.名称为 Name7_1_ FROM AgendaItem this_ 左外连接议程议程 1_ 在 this_.AgendaId=agenda1_.Id 左外连接位置 location2_ 在议程 1_.LocationId=location2_.Id WHERE location2_.Id = ? 和（this_.Minutes like ? or this_.Description like ?) ORDER BY Agenda1_.Date asc, this_.OutcomeType asc, this_.OutcomeNumber asc]
    位置参数：#0>1 #0>%Core% #0>%Core%
    [SQL：选择 this_.Id 作为 Id5_2_，this_.AgendaId 作为 AgendaId5_2_，this_.Description 作为 Descript3_5_2_，this_.OutcomeType 作为 OutcomeT4_5_2_，this_.OutcomeNumber 作为 OutcomeN5_5_2_，this_.Minutes 作为 Minutes5_2_，议程 1_.Id 作为 Id2_0_，议程 1_.LocationId 作为LocationId2_0_，agenda1_.Date as Date2_0_，location2_.Id as Id7_1_，location2_.Name as Name7_1_ FROM AgendaItem this_ left outer join Agenda议程1_ on this_.AgendaId=agenda1_.Id left outer join Location location2_ on agenda1_.LocationId=location2_.Id WHERE location2_ .Id = ? 和 (this_.Minutes like ? or this_.Description like ?) ORDER BY议程1_.Date asc, this_.OutcomeType asc, this_.OutcomeNumber asc]]
       NHibernate.Loader.Loader.DoList(ISessionImplementor session, QueryParameters queryParameters) +258
       NHibernate.Loader.Loader.ListIgnoreQueryCache(ISessionImplementor session, QueryParameters queryParameters) +18
       NHibernate.Loader.Loader.List(ISessionImplementor session, QueryParameters queryParameters, ISet`1 querySpaces, IType[] resultTypes) +87
       NHibernate.Impl.SessionImpl.List（CriteriaImpl 标准，IList 结果）+342
       NHibernate.Impl.CriteriaImpl.List(IList 结果) +41
       NHibernate.Impl.CriteriaImpl.List() +35
       C:\home\dev\tools\NHibernate\NHibernateContribSrc\src\NHibernate.Linq\src\NHibernate.Linq\CriteriaResultReader.cs:22 中的 NHibernate.Linq.CriteriaResultReader`1.List()
       C:\home\dev\tools\NHibernate\NHibernateContribSrc\src\NHibernate.Linq\src\NHibernate.Linq\CriteriaResultReader.cs:27 中的 NHibernate.Linq.d__0.MoveNext()

```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-17T19:27:40.423

在我看来，这就像 Linq to Nhybernate 的一个错误。一种可能的解决方法是在排序之前转换为数组。一个潜在的大缺点是您不能在枚举之前使用 Skip() 和 Take() 限制结果，因此这对您来说可能还不够。

```
var results = items
   .ToArray()
   .OrderBy(item => item.Agenda.Date)
   .ThenBy(item => item.OutcomeType)
   .ThenBy(item => item.OutcomeNumber)
   .Skip((page - 1)*pageSize)
   .Take(pageSize) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-14T02:51:52.573

虽然我不认为它会有所作为，但如果你像这样做你的 linq 会发生什么：

（从 i 在项目 orderby i.prop1、i.prop2、i.prop3）.Skip(...).Take(...).ToArray();

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-08-23T12:17:40.933

如果您的结果集相对较小，则首先将其转换为数组可能是一个可接受的解决方案。但是如果你想让 SQL Server 完成这项工作，你最好这样做：

```
var results = items
   .OrderBy(item => item.Agenda.Date).Asc
   .ThenBy(item => item.OutcomeType).Asc
   .ThenBy(item => item.OutcomeNumber).Asc
   .Skip((page - 1)*pageSize)
   .Take(pageSize)
   .ToArray(); 
```

每当您在 Linq 的 NHibernate 方言中使用 OrderBy 或 OrderByAlias 方法时，您应该始终添加 Asc 或 Desc 修饰符。

# python - 通过 SQLAlchemy 获取随机行

> ID：60805
> 
> 赞同：92
> 
> 时间：2008-09-13T19:58:02.897
> 
> 标签：python, sql, database, random, sqlalchemy

如何使用 SQLAlchemy 从表中选择一个或多个随机行？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-09-13T20:09:28.533

这在很大程度上是一个特定于数据库的问题。

我知道 PostgreSQL、SQLite、MySQL 和 Oracle 可以通过随机函数进行排序，因此您可以在 SQLAlchemy 中使用它：

```
from  sqlalchemy.sql.expression import func, select

select.order_by(func.random()) # for PostgreSQL, SQLite

select.order_by(func.rand()) # for MySQL

select.order_by('dbms_random.value') # For Oracle 
```

接下来，您需要通过您需要的记录数来限制查询（例如使用`.limit()`）。

请记住，至少在 PostgreSQL 中，选择随机记录具有严重的性能问题；[这](http://www.depesz.com/index.php/2007/09/16/my-thoughts-on-getting-random-row/)是关于它的好文章。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-12-24T03:22:30.533

如果您正在使用 orm 并且表不大（或者您缓存了它的行数）并且您希望它独立于数据库，那么真正简单的方法是。

```
import random
rand = random.randrange(0, session.query(Table).count()) 
row = session.query(Table)[rand] 
```

这有点作弊，但这就是您使用 orm 的原因。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2013-02-16T02:19:56.087

有一种简单的方法可以拉取独立于数据库的随机行。只需使用 .offset() 。无需拉所有行：

```
import random
query = DBSession.query(Table)
rowCount = int(query.count())
randomRow = query.offset(int(rowCount*random.random())).first() 
```

Table 在哪里是你的表（或者你可以在那里放置任何查询）。如果您想要几行，那么您可以多次运行，并确保每一行与前一行不同。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2015-11-07T12:55:09.983

这里有四种不同的变体，从最慢到最快排序。`timeit`底部的结果：

```
from sqlalchemy.sql import func
from sqlalchemy.orm import load_only

def simple_random():
    return random.choice(model_name.query.all())

def load_only_random():
    return random.choice(model_name.query.options(load_only('id')).all())

def order_by_random():
    return model_name.query.order_by(func.random()).first()

def optimized_random():
    return model_name.query.options(load_only('id')).offset(
            func.floor(
                func.random() *
                db.session.query(func.count(model_name.id))
            )
        ).limit(1).all() 
```

`timeit`在我的 Macbook 上针对 300 行的 PostgreSQL 表运行 10,000 次的结果：

```
simple_random(): 
    90.09954111799925
load_only_random():
    65.94714171699889
order_by_random():
    23.17819356000109
optimized_random():
    19.87806927999918 
```

您可以很容易地看到 using`func.random()`比将所有结果返回到 Python 的`random.choice()`.

此外，随着表大小的增加，性能`order_by_random()`会显着下降，因为`ORDER BY`需要全表扫描，而`COUNT`in`optimized_random()`可以使用索引。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-10-07T20:00:36.487

一些 SQL DBMS，即 Microsoft SQL Server、DB2 和[PostgreSQL](https://www.postgresql.org/docs/current/static/sql-select.html#SQL-FROM) ，已经实现了 SQL:2003`TABLESAMPLE`子句。[在 1.1 版](https://bitbucket.org/zzzeek/sqlalchemy/issues/3718)中添加了对 SQLAlchemy 的支持。它允许使用不同的采样方法返回表格样本——标准要求`SYSTEM`和`BERNOULLI`，它返回表格的所需近似百分比。

在 SQLAlchemy中[`FromClause.tablesample()`](https://docs.sqlalchemy.org/en/latest/core/selectable.html#sqlalchemy.sql.expression.FromClause.tablesample)，[`tablesample()`](https://docs.sqlalchemy.org/en/latest/core/selectable.html#sqlalchemy.sql.expression.tablesample)用于生成[`TableSample`](https://docs.sqlalchemy.org/en/latest/core/selectable.html#sqlalchemy.sql.expression.TableSample)构造：

```
# Approx. 1%, using SYSTEM method
sample1 = mytable.tablesample(1)

# Approx. 1%, using BERNOULLI method
sample2 = mytable.tablesample(func.bernoulli(1)) 
```

与映射类一起使用时有一个小问题：生成的`TableSample`对象必须具有别名才能用于查询模型对象：

```
sample = aliased(MyModel, tablesample(MyModel, 1))
res = session.query(sample).all() 
```

* * *

由于许多答案都包含性能基准，因此我还将在此处包含一些简单的测试。在 PostgreSQL 中使用一个包含大约一百万行和一个整数列的简单表，选择（大约）1% 的样本：

```
In [24]: %%timeit
    ...: foo.select().\
    ...:     order_by(func.random()).\
    ...:     limit(select([func.round(func.count() * 0.01)]).
    ...:           select_from(foo).
    ...:           as_scalar()).\
    ...:     execute().\
    ...:     fetchall()
    ...: 
307 ms ± 5.72 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)

In [25]: %timeit foo.tablesample(1).select().execute().fetchall()
6.36 ms ± 188 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

In [26]: %timeit foo.tablesample(func.bernoulli(1)).select().execute().fetchall()
19.8 ms ± 381 µs per loop (mean ± std. dev. of 7 runs, 10 loops each) 
```

在急于使用`SYSTEM`抽样方法之前，应该知道它对*页面*进行抽样，而不是对单个元组进行抽样，因此它可能不适用于小表，并且如果表是聚集的，则可能不会产生随机结果。

* * *

如果使用不允许将样本百分比/行数和种子作为参数传递的方言，以及不内联值的驱动程序，则*如果它们是静态*的，则将值作为文字 SQL 文本传递，或者使用自定义内联它们SQLA 编译器扩展：

```
from sqlalchemy.ext.compiler import compiles
from sqlalchemy.sql import TableSample

@compiles(TableSample)
def visit_tablesample(tablesample, self, asfrom=False, **kw):
    """ Compile `TableSample` with values inlined.
    """
    kw_literal_binds = {**kw, "literal_binds": True}
    text = "%s TABLESAMPLE %s" % (
        self.visit_alias(tablesample, asfrom=True, **kw),
        tablesample._get_method()._compiler_dispatch(self, **kw_literal_binds),
    )

    if tablesample.seed is not None:
        text += " REPEATABLE (%s)" % (
            tablesample.seed._compiler_dispatch(self, **kw_literal_binds)
        )

    return text

from sqlalchemy import table, literal, text

# Static percentage
print(table("tbl").tablesample(text("5 PERCENT")))
# Compiler inlined values
print(table("tbl").tablesample(5, seed=literal(42))) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-05-15T08:03:38.180

**这是我选择表的随机行的函数：**

```
from sqlalchemy.sql.expression import func

def random_find_rows(sample_num):
    if not sample_num:
        return []

    session = DBSession()
    return session.query(Table).order_by(func.random()).limit(sample_num).all() 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-14T07:32:37.297

这是我使用的解决方案：

```
from random import randint

rows_query = session.query(Table)                # get all rows
if rows_query.count() > 0:                       # make sure there's at least 1 row
    rand_index = randint(0,rows_query.count()-1) # get random index to rows 
    rand_row   = rows_query.all()[rand_index]    # use random index to get random row 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2014-01-20T19:18:12.990

## 此解决方案将选择单个随机行

此解决方案要求主键名为 id，如果尚未命名，则应为：

```
import random
max_model_id = YourModel.query.order_by(YourModel.id.desc())[0].id
random_id = random.randrange(0,max_model_id)
random_row = YourModel.query.get(random_id)
print random_row 
```

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2020-06-11T09:58:34.617

使用这个最简单的方法这个例子从数据库中选择一个随机问题： -

```
#first import the random module
import random

#then choose what ever Model you want inside random.choise() method
get_questions = random.choice(Question.query.all()) 
```

* * *

## 回答 #10

> 赞同：-8
> 
> 时间：2008-09-13T20:04:11.103

通过 SQL 有几种方法，具体取决于所使用的数据库。

（我认为 SQLAlchemy 无论如何都可以使用所有这些）

mysql:

```
SELECT colum FROM table
ORDER BY RAND()
LIMIT 1 
```

PostgreSQL：

```
SELECT column FROM table
ORDER BY RANDOM()
LIMIT 1 
```

微软SQL：

```
SELECT TOP 1 column FROM table
ORDER BY NEWID() 
```

IBM DB2：

```
SELECT column, RAND() as IDX
FROM table
ORDER BY IDX FETCH FIRST 1 ROWS ONLY 
```

甲骨文：

```
SELECT column FROM
(SELECT column FROM table
ORDER BY dbms_random.value)
WHERE rownum = 1 
```

但是我不知道任何标准方式

# c# - 找出 C# 中的对象使用了多少内存？

> ID：60820
> 
> 赞同：15
> 
> 时间：2008-09-13T20:12:51.003
> 
> 标签：c#, performance, memory, profiler

有谁知道找出对象实例占用多少内存的方法？

例如，如果我有以下对象的实例：

```
TestClass tc = new TestClass(); 
```

有没有办法找出实例占用了多少内存`tc`？

询问的原因是，尽管 C# 内置了内存管理，但我经常遇到不清除对象实例的问题（例如，跟踪某事的列表）。

有几个相当不错的内存分析器（例如 ANTS Profiler），但在多线程环境中，即使使用这些工具，也很难弄清楚什么属于哪里。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-13T20:28:38.860

如果您不尝试在代码本身中执行此操作，我假设基于您的 ANTS 参考，请尝试查看 CLRProfiler（当前为 v2.0）。它是免费的，如果您不介意相当简单的 UI，它可以提供有价值的信息。它将为您提供各种统计数据的深入概述。不久前，我将它用作查找内存韭菜的一种工具。

在此处下载：[https ://github.com/MicrosoftArchive/clrprofiler](https://github.com/MicrosoftArchive/clrprofiler)

如果您确实想在代码中执行此操作，CLR 具有您可以使用的分析 API。如果您在 CLRProfiler 中找到信息，因为它使用这些 API，您应该也可以在代码中完成。更多信息：http: [//msdn.microsoft.com/de-de/magazine/cc300553 (en-us).aspx](http://msdn.microsoft.com/de-de/magazine/cc300553(en-us).aspx)

（它不像使用 WinDbg 那样神秘，但要准备好深入 CLR。​​）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T20:31:47.807

Microsoft 免费提供的[CLR Profiler](http://www.microsoft.com/downloads/details.aspx?familyid=a362781c-3870-43be-8926-862b40aa0cd0&displaylang=en)在这类事情上做得非常好。

可以在[此处](http://www.microsoft.com/downloads/details.aspx?familyid=CD5AA57C-9CD1-45AB-AA4B-8DC586D30938&displaylang=en)下载对整个分析器的介绍。不久前，Patterns & Practices 团队还[整理了一些东西](http://msdn.microsoft.com/en-us/library/ms979205.aspx)，详细说明了如何使用分析器。

它在向您展示在这些线程中创建的不同线程和对象方面做得相当合理。

希望这能有所启发。快乐的剖析！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-13T20:24:28.043

[我对MemProfiler](http://memprofiler.com/)有很好的体验。它为您提供对象创建时间的堆栈跟踪以及对象仍未被垃圾回收的所有图表。

# silverlight - 谁能推荐一本 Silverlight 2 的书？

> ID：60822
> 
> 赞同：-1
> 
> 时间：2008-09-13T20:15:20.187
> 
> 标签：silverlight

即使 Silverlight2 仍处于起步阶段，任何人都可以推荐一本书来入门吗？一个比设计师更关注开发人员的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T17:57:54.947

我预购了这个：Jesse Liberty 和 Tim Heuer 的“Programming Silverlight 2”。两位作者都受雇于微软，致力于 Silverlight 2，他们的博客很棒，所以我希望这本书（将在 RTM 之后发布）是最新的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-14T18:14:23.993

我看过劳伦特的一些作品……等他的书

[![Sams Silverlight 2 释放](https://i.stack.imgur.com/CKTMv.png)](https://i.stack.imgur.com/CKTMv.png)
[（来源：[galasoft.ch](http://galasoft.ch/blogs-all/2008090101.png)）]

[Sams Silverlight 2 释放](http://geekswithblogs.net/lbugnion/archive/2008/09/01/sams-silverlight-2-unleashed-was-teach-yourself-silverlight-in-24.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:54:13.650

我已经开始阅读[Silverlight 2 in Action](http://www.manning.com/campbell/)，看起来还不错。一件好事是，因为他们有一个早期访问计划，你现在已经可以将大部分书籍作为电子副本获得。尽管整本书要到 10 月的某个时候才能发布。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T23:07:45.347

A lot of the books available are simply a rehash of the help files. Your best bet would be to start at silverlight.net and read the Help files that get installed with the SDK. Then when Jesse Liberty's book is released read that.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-13T20:21:14.183

我目前正在努力[介绍 Microsoft Silverlight 2](https://rads.stackoverflow.com/amzn/click/com/073562528X)，到目前为止一切顺利。

这是一本典型的微软书籍，提供了**koolaid**，但提供了很好的介绍。我看到这个人在 Metro Detroit 地区的一个本地 .NET 用户组发表演讲，我印象深刻。

[替代文字 http://ecx.images-amazon.com/images/I/51YD6H7PQyL._SL500_BO2,204,203,200_PIsitb-dp-500-arrow,TopRight,45,-64_OU01_AA240_SH20_.jpg](http://ecx.images-amazon.com/images/I/51YD6H7PQyL._SL500_BO2,204,203,200_PIsitb-dp-500-arrow,TopRight,45,-64_OU01_AA240_SH20_.jpg)

# windows - 任何类似于超级终端应用程序的工具？

> ID：60823
> 
> 赞同：8
> 
> 时间：2008-09-13T20:18:20.883
> 
> 标签：windows, windows-vista, hyperterminal, virtual-serial-port

> HyperTerminal 是一个程序，您可以使用调制解调器、空调制解调器电缆或以太网连接来连接到其他计算机、Telnet 站点、公告板系统 (BBS)、在线服务和主机计算机。

但我对超级终端的主要用途是通过本地（虚拟）COM 端口与硬件通信。我想由于某种原因它在 Vista 中被删除了。

有没有其他功能类似于超级终端的工具？

【就算不是vista也好想知道】

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-13T20:32:29.147

[PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/)现在可以进行串行通信。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T20:32:03.533

这里有两个：

[太长期](http://hp.vector.co.jp/authors/VA002416/teraterm.html)

> Tera Term (Pro) 是一款适用于 MS-Windows 的免费软件终端仿真器（通信程序）。支持VT100仿真、telnet连接、串口连接等。

[柯米特 95](http://www.columbia.edu/kermit/k95.html)

> Kermit 95：来自哥伦比亚大学 Kermit 项目的 Microsoft Windows® 95、Windows 98、Windows ME、Windows NT（4.0 和更高版本）、Windows 2000、Windows XP 和 IBM OS/2 的 Internet 和串行通信，为您提供文本-基于终端连接到 Unix、VMS 和许多其他类型的主机，允许您直接与其外壳和应用程序交互，传输文件，如果需要，使用其内置平台和传输自动交互和文件传输- 独立的脚本语言。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T20:33:05.043

我在尝试通过 RS323/串行连接到 RFID 设备并找到 SerialMonitor 时遇到了同样的问题。

该应用程序有两个链接。我在这里找到的免费版本（这是我使用的版本，它适用于 Vista）： http: [//www.softhypermarket.com/Free-Serial-Port-Monitor-download_29681.html](http://www.softhypermarket.com/Free-Serial-Port-Monitor-download_29681.html)

但是，如果您按照电子邮件地址访问主站点，则该工具有几个版本。它们不是免费的，但它们似乎比我使用的功能更多。

[http://www.hhdsoftware.com/Products/home/serial-monitor.html](http://www.hhdsoftware.com/Products/home/serial-monitor.html)

希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-26T11:57:20.230

这是专门设计用于测试串行设备的更好工具：http: [//www.caerustech.com/UDT.php](http://www.caerustech.com/UDT.php)。您可以保存各种设备的设置和命令——我经常在工作中使用它。

# javascript - Javascript 中的国际字符

> ID：60825
> 
> 赞同：14
> 
> 时间：2008-09-13T20:19:38.773
> 
> 标签：javascript, unicode, internationalization, character-encoding

我正在开发一个 Web 应用程序，我在其中以 XML 格式将数据从服务器传输到浏览器。

由于我是丹麦人，我很快就遇到了人物问题`æøå`。

我知道在 html 中，我使用`"&amp;aelig;&amp;oslash;&amp;aring;"`for `æøå`。

但是，一旦字符通过 JavaScript，我会`"?"`在使用时得到黑框`æøå`，并按`"&aelig;&oslash;&aring;"`原样打印。

我确保将其设置为 utf-8，但这并没有多大帮助。

理想情况下，我希望它与任何特殊字符一起工作（自然）。

不工作的例子包括在下面：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Untitled Document</title>
        <script type="text/javascript" charset="utf-8">
            alert("&aelig;&oslash;&aring;");
            alert("æøå");

        </script>
    </head>
    <body>
    </body>
</html> 
```

我究竟做错了什么？

* * *

好的，感谢 Grapefrukts 的回答，我得到了它的工作。

我实际上需要它来处理来自 MySQL 服务器的数据。由于以 UTF-8 编码保存文件只能解决静态内容的问题，我想我会包含 MySQL 服务器中字符串的解决方案，使用 PHP 提取：

`utf8_encode($MyStringHere)`

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-28T00:38:30.543

如果您无法设置响应编码，您可以`\u`在 JavaScript 字符串文字中使用转义序列来显示这些字符。

```
alert("\u00e6\u00f8\u00e5") 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-13T20:39:25.840

仅在标头中指定 UTF-8 是不够的。我敢打赌，您还没有将文件保存为 UTF-8。任何相当先进的文本编辑器都会有这个选项。试试看，我相信它会起作用的！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-15T21:43:22.470

您还可以使用`String.fromCharCode()`从数字实体中输出字符。

例如`String.fromCharCode( 8226 )`将创建一个子弹字符。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-13T20:35:54.710

我得到“æøå” 第一个和一些垃圾字符的下一个。可能是 javascript 没有修改（或[mojibake](http://en.wikipedia.org/wiki/Mojibake)）您的字母，但警报对话框使用系统默认字体，并且该字体无法显示字母？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-07-25T23:31:08.730

我将这样的代码与泰语一起使用。没关系。

`$message`是我的 PHP 变量。

```
echo("<html><head><meta charset='utf-8'></head><body><script type='text/javascript'>alert('" . $message . "');</script></body></html>"); 
```

希望这能有所帮助。谢谢你。

（我无法发布我所做的图像，因为系统说“我没有足够的声誉”，所以我把图像留在这里。http: [//goo.gl/9P3DtI](http://goo.gl/9P3DtI)抱歉给您带来不便。）

对不起我的英语不好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-13T20:25:35.297

这对我来说按预期工作：

```
alert("&aelig;&oslash;&aring;"); 
```

... 创建一个包含字符串“æøå”的警报 然而

```
alert("æøå"); 
```

... 使用非 ASCII 字符创建警报。

Javascript 非常干净 utf-8，不会给您设置障碍。

也许你把它放在一个作为 ISO-8859-1 服务的网络服务器上？如果你使用 Apache，在你的 Apache 配置文件中（或者在 .httaccess 中，如果你可以覆盖的话），你应该有一行

```
AddCharset utf-8 .js 
```

（注意：编辑以逃避＆符号......否则它没有意义。）

# c++ - 使用内联函数有什么问题？

> ID：60830
> 
> 赞同：38
> 
> 时间：2008-09-13T20:25:07.450
> 
> 标签：c++, inline-functions

虽然在某些情况下使用内联函数会非常方便，

内联函数有什么缺点吗？

**结论**：

显然，使用内联函数并没有错。

但值得注意的是以下几点！

*   过度使用内联实际上会使程序变慢。根据函数的大小，内联它可能会导致代码大小增加或减少。内联非常小的访问器函数通常会减少代码大小，而内联非常大的函数会显着增加代码大小。在现代处理器上，由于更好地使用指令缓存，较小的代码通常运行得更快。[- 谷歌指南](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Inline_Functions)

*   随着函数大小的增长，内联函数的速度优势趋于减弱。在某些时候，函数调用的开销与函数体的执行相比变得很小，并且失去了好处[- 来源](http://www-rocq.inria.fr/who/Marc.Thiriet/Langages/tic0324.html)

*   在少数情况下内联函数可能不起作用：

    *   对于返回值的函数；如果存在 return 语句。
    *   对于不返回任何值的函数；如果存在循环、switch 或 goto 语句。
    *   如果函数是递归的。[-来源](http://www-rocq.inria.fr/who/Marc.Thiriet/Langages/tic0324.html)
*   仅当您指定优化选项时，`__inline`关键字才会内联函数。如果指定了优化，是否`__inline`兑现取决于内联优化器选项的设置。默认情况下，只要运行优化器，内联选项就会生效。如果您指定 optimize ，如果您希望`__inline`关键字被忽略，则还必须指定 noinline 选项。[-来源](http://support.sas.com/documentation/onlinedoc/sasc/doc750/html/clug/zcoptinl.htm)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-13T20:38:49.460

值得指出的是，inline 关键字实际上只是给编译器的一个提示。编译器可能会忽略内联，而只是在某个地方为函数生成代码。

内联函数的主要缺点是它会**增加可执行文件的大小**（取决于实例化的数量）。这在某些平台（例如嵌入式系统）上可能是一个问题，特别是如果函数本身是递归的。

我还建议使内联函数**非常小**- 内联函数的速度优势往往会随着函数大小的增长而减少。在某些时候，函数调用的开销与函数体的执行相比变得很小，并且失去了好处。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-13T20:28:46.020

它可能会增加可执行文件的大小，而且我认为即使您使用了 inline 关键字，编译器也不会总是将它们内联。（或者相反，就像[Vaibhav](https://stackoverflow.com/questions/60830/what-is-wrong-with-using-inline-functions#60833) 所说的那样？...）

我认为如果函数只有 1 或 2 条语句通常是可以的。

**编辑：**这是 linux [CodingStyle](http://lxr.linux.no/linux/Documentation/CodingStyle)文档所说的：

> 第15章：内联疾病
> 
> 似乎有一个普遍的误解，即 gcc 有一个神奇的“让我更快”加速选项，称为“内联”。虽然使用内联可能是合适的（例如，作为一种替换宏的方法，参见第 12 章），但通常情况并非如此。大量使用 inline 关键字会导致更大的内核，这反过来又会降低整个系统的速度，这是因为 CPU 占用的 icache 占用空间更大，并且仅仅是因为页面缓存可用的内存更少。考虑一下; pagecache 未命中会导致磁盘查找，这很容易花费 5 毫秒。有很多 cpu 周期可以进入这 5 毫秒。
> 
> 一个合理的经验法则是不要将 inline 放在其中包含超过 3 行代码的函数中。此规则的一个例外是参数已知为编译时常量的情况，并且由于这种常量性，您*知道*编译器将能够在编译时优化您的大部分函数。有关后一种情况的一个很好的示例，请参见 kmalloc() 内联函数。
> 
> 人们经常争辩说，将内联添加到静态且只使用一次的函数中总是一种胜利，因为没有空间权衡。虽然这在技术上是正确的，但 gcc 能够在没有帮助的情况下自动内联这些，并且当第二个用户出现时删除内联的维护问题超过了告诉 gcc 做它本来会做的事情的提示的潜在价值。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-15T22:20:03.083

内联存在问题 - 一旦您在头文件中定义了一个函数（这意味着内联，通过在类中定义成员函数的主体显式或隐式），没有简单的方法可以在不强制用户重新编译的情况下更改它（而不是重新链接）。这通常会导致问题，特别是如果所讨论的函数是在库中定义的，并且标头是其接口的一部分。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-13T22:28:06.857

我同意其他帖子：

*   inline 可能是多余的，因为编译器会这样做
*   内联可能会使您的代码膨胀

第三点是它可能会迫使您在标头中公开实现细节，例如，

```
class OtherObject;

class Object {
public:
    void someFunc(OtherObject& otherObj) {
        otherObj.doIt(); // Yikes requires OtherObj declaration!
    }
}; 
```

如果没有内联，您只需要OtherObject 的前向声明。使用内联，您的标题需要 OtherObject 的定义。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-14T12:26:59.947

正如其他人所提到的， inline 关键字只是对编译器的提示。事实上，大多数现代编译器都会完全忽略这个提示。编译器有自己的启发式方法来决定是否内联函数，坦率地说不想要你的建议，非常感谢。

如果您真的非常想内联，如果您实际上已经对其进行了分析并查看了反汇编以确保覆盖编译器启发式实际上是有意义的，那么它是可能的：

*   在 VC++ 中，使用 __forceinline 关键字
*   在 GCC 中，使用 __attribute__((always_inline))

然而， inline 关键字确实有第二个有效的目的——在头文件中声明函数，而不是在类定义中。需要 inline 关键字来告诉编译器不要生成函数的多个定义。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-13T20:26:12.250

我对此表示怀疑。甚至编译器也会自动内联一些函数进行优化。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T07:35:02.500

我不知道我的回答是否与问题有关，但是：

小心内联**虚**方法！一些有缺陷的编译器（例如以前的 Visual C++ 版本）会为虚拟方法生成内联代码，其中标准行为是什么都不做，只是沿着继承树向下并调用适当的方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-13T20:41:07.817

您还应该注意 inline 关键字只是一个请求。编译器可能会选择不内联它，同样，如果编译器认为速度/大小权衡是值得的，它可能会选择将您未定义为内联的函数内联。

这个决定通常是基于许多事情做出的，例如优化速度（避免函数调用）和优化大小之间的设置（内联会导致代码膨胀，因此对于大型重复使用的函数来说不是很好）。

使用 VC++ 编译器，您可以使用`__forceinline`

所以一般来说：如果你真的想在头文件中有一个函数，请使用内联，但在其他地方没有什么意义，因为如果你想从中获得任何东西，一个好的编译器无论如何都会为你内联。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-14T11:58:54.147

内联较大的函数会使程序变大，从而导致更多的[指令缓存](https://stackoverflow.com/questions/22394750/what-is-meant-by-data-cache-and-instruction-cache)未命中并使其变慢。

确定一个函数何时足够小以至于内联会提高性能是非常棘手的。[Google 的 C++ Style Guide](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Inline_Functions)建议仅使用 10 行或更少的内联函数。

（简化）**示例**：

想象一个简单的程序，它只调用函数“X”5 次。

如果 X 很小并且所有调用都内联：可能所有指令都将通过单个主存储器访问预取到指令缓存中 - 太棒了！

如果 X 很大，假设接近指令缓存的容量：
内联 X 可能会导致 X 的每个内联实例从内存中获取一次指令。
如果 X 未内联，则可能会在第一次调用时从内存中获取指令到 X，但可能会保留在缓存中以供后续调用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-13T20:31:27.403

函数的过度内联会增加编译后的可执行文件的大小，这会对缓存性能产生负面影响，但现在编译器会自行决定函数内联（取决于许多标准）并忽略 inline 关键字。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-07-25T08:34:55.760

在我已经看到过度使用的内联函数的其他问题中（我已经看到了 500 行的内联函数），您必须注意的是：

*   建立不稳定

    *   更改内联函数的源代码会导致头文件的所有用户重新编译
    *   `#include`s 泄漏到客户端。如果您重新编写内联函数并删除某些客户端所依赖的不再使用的标头，这可能会非常令人讨厌。
*   可执行文件大小

    *   每次内联而不是调用指令时，编译器都必须生成内联的整个代码。如果函数的代码很短（一两行），这是可以的，如果函数很长，则不太好
    *   一些函数可以产生比最初出现的更多的代码。我的例子是一个类的“微不足道”的析构函数，它有很多非 pod 成员变量（或两个或 3 个具有相当混乱的析构函数的成员变量）。必须为*每个*析构函数生成一个调用。
*   执行时间处理时间

    *   这非常依赖于您的 CPU 缓存和共享库，但引用的位置很重要。如果您可能要内联的代码恰好保存在 cpu 缓存中的某个位置，那么许多客户端可以发现该代码不会遭受缓存未命中和随后的内存提取（更糟糕的是，如果发生这种情况，磁盘提取） . 可悲的是，这是您真正需要进行性能分析的情况之一。

我工作的编码标准将内联函数限制为简单的 setter/getter，特别是析构函数不应该是内联的，除非你有性能测量来显示内联具有明显的优势。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-11-16T14:28:08.760

除了其他很好的答案之外，至少有一次我看到强制内联实际上将受影响的代码减慢了 1.5 倍的情况。里面有一个嵌套循环（非常小），当这个函数被编译为一个单独的单元时，编译器设法有效地展开和优化它。但是当同一个函数被内联到更大的外部函数中时，编译器（MSVC 2017）未能优化这个循环。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2016-07-24T17:14:35.527

1.  正如其他人所说，如果代码很大，内联函数会产生问题。由于每条指令都存储在特定的内存位置，因此内联函数的重载会使代码花费更多时间来执行。

2.  在其他情况下内联可能不起作用

    1.  在递归函数的情况下不起作用。
    2.  它也可能不适用于静态变量。
    3.  如果使用循环、开关等，它也不起作用。或者我们可以用多个语句说。
    4.  并且函数 main 不能用作内联函数。

# python - 如何按照插入的顺序从字典中检索项目？

> ID：60848
> 
> 赞同：65
> 
> 时间：2008-09-13T20:38:05.467
> 
> 标签：python, dictionary

是否可以按照插入的顺序从 Python 字典中检索项目？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-09-13T20:48:36.003

`dict`如果您使用 CPython 3.6+（或 Python 3.7+ 用于 Python 的任何其他实现），标准 Python默认会执行此操作。

在旧版本的 Python 上，您可以使用[`collections.OrderedDict`](https://docs.python.org/library/collections.html#ordereddict-objects).

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2014-10-29T17:42:25.693

使用 OrderedDict()，从 2.7 版开始可用

只是一个好奇的问题：

```
from collections import OrderedDict
a = {}
b = OrderedDict()
c = OrderedDict()

a['key1'] = 'value1'
a['key2'] = 'value2'

b['key1'] = 'value1'
b['key2'] = 'value2'

c['key2'] = 'value2'
c['key1'] = 'value1'

print a == b  # True
print a == c  # True
print b == c  # False 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2018-08-10T00:53:46.290

从 Python 3.7 开始，标准 dict 保留插入顺序。从[文档](https://docs.python.org/3.7/library/stdtypes.html#mapping-types-dict)：

> 在 3.7 版更改: 字典顺序保证为插入顺序。这种行为是 CPython 3.6 的实现细节。

因此，您应该能够正常迭代字典或使用`popitem()`.

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-09-14T00:58:30.413

其他答案是正确的；这是不可能的，但你可以自己写。但是，如果您不确定如何实际实现这样的东西，这里有一个完整且有效的实现，它继承了我刚刚编写和测试的 dict 的子类。（请注意，传递给构造函数的值的顺序是未定义的，但会在稍后传递的值之前出现，并且您始终可以不允许使用值初始化有序 dicts。）

```
class ordered_dict(dict):
    def __init__(self, *args, **kwargs):
        dict.__init__(self, *args, **kwargs)
        self._order = self.keys()

    def __setitem__(self, key, value):
        dict.__setitem__(self, key, value)
        if key in self._order:
            self._order.remove(key)
        self._order.append(key)

    def __delitem__(self, key):
        dict.__delitem__(self, key)
        self._order.remove(key)

    def order(self):
        return self._order[:]

    def ordered_items(self):
        return [(key,self[key]) for key in self._order]

od = ordered_dict()
od["hello"] = "world"
od["goodbye"] = "cruel world"
print od.order()            # prints ['hello', 'goodbye']

del od["hello"]
od["monty"] = "python"
print od.order()            # prints ['goodbye', 'monty']

od["hello"] = "kitty"
print od.order()            # prints ['goodbye', 'monty', 'hello']

print od.ordered_items()
# prints [('goodbye','cruel world'), ('monty','python'), ('hello','kitty')] 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-13T20:39:58.803

你不能用基本的 dict 类来做到这一点——它是按哈希排序的。您可以构建自己的字典，它实际上是键、值对或类似的列表，它们将被排序。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-15T19:31:43.350

或者，只需使用 time.now() 作为元组中的第一个字段将键设为元组。

然后你可以用 dictname.keys() 检索键，排序，瞧！

格里

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-15T18:15:46.853

我以前使用过 StableDict 并取得了很好的成功。

[http://pypi.python.org/pypi/StableDict/0.2](http://pypi.python.org/pypi/StableDict/0.2)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-18T19:42:29.707

[或者使用此处](http://www.python.org/dev/peps/pep-0372/#reference-implementation)描述的[PEP-372](http://www.python.org/dev/peps/pep-0372/)的任何实现，例如pythonutils中的[odict](http://www.voidspace.org.uk/python/pythonutils.html)[模块](http://www.voidspace.org.uk/python/odict.html)。

我成功使用了 pocoo.org 实现，就像替换你的一样简单

```
my_dict={}
my_dict["foo"]="bar" 
```

和

```
my_dict=odict.odict()
my_dict["foo"]="bar" 
```

并且只需要[这个文件](http://dev.pocoo.org/hg/sandbox/raw-file/tip/odict.py)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T15:56:35.460

除非您将密钥存储在单独的列表中以供以后参考，否则这是不可能的。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-15T16:07:04.213

如果您不需要 dict 功能，而只需要按照插入的顺序返回元组，队列不是更好吗？

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2014-06-04T02:50:06.983

您可以做的是使用代表输入顺序的键插入值，然后调用`sorted()`项目。

```
>>> obj = {}
>>> obj[1] = 'Bob'
>>> obj[2] = 'Sally'
>>> obj[3] = 'Joe'
>>> for k, v in sorted(obj.items()):
...     print v
... 
Bob
Sally
Joe
>>> 
```

# iis - IIS 7.0 的 mod_rewrite 等效项

> ID：60857
> 
> 赞同：25
> 
> 时间：2008-09-13T20:43:19.853
> 
> 标签：iis, mod-rewrite

是否有 IIS 7.0 的 mod_rewrite 等效项

a) 或多或少完整

b) 适用于生产环境，即久经考验/可靠/安全

你有基于经验的推荐吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-13T21:09:45.347

查看Microsoft 创建的[用于 IIS 7 的 URL 重写模块](http://www.iis.net/downloads/microsoft/url-rewrite)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-13T20:54:43.493

如果你有 99.00 美元的闲钱，你可能想看看[http://www.isapirewrite.com/](http://www.isapirewrite.com/)

[摘自他们的网站]

**产品概览**

ISAPI_Rewrite 是一个基于正则表达式的强大的 URL 操作引擎。它的作用与 Apache 的 mod_Rewrite 非常相似，但专为 Microsoft 的 Internet 信息服务器 (IIS) 而设计。ISAPI_Rewrite 是一个用纯 C/C++ 编写的 ISAPI 过滤器，因此速度非常快。ISAPI_Rewrite 让您可以自由地超越标准 URL 方案并开发自己的方案。

[使用示例] [http://www.helicontech.com/articles/provocative_SEF_URLs.htm](http://www.helicontech.com/articles/provocative_SEF_URLs.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-13T20:48:15.677

看看 URLRewriter。在生产中使用它一次没有问题。但不要依赖它作为唯一的质量检查：

[http://www.codeplex.com/urlrewriter](http://www.codeplex.com/urlrewriter)

*（它是免费的，并且拥有 Microsoft 公共许可证）*

> Managed Fusion URL Rewriter 是一个基于 Apache mod_rewrite 扩展的强大的 URL 操作引擎。它从一开始就被设计为将 Apache mod_rewrite 的所有功能带到 IIS 6.0 和 IIS 7.0。Managed Fusion Url Rewriter 在 Microsoft 的 Internet Information Server (IIS) 6.0 和 Mono XPS Server 上与 ASP.NET 一起使用，并且在 IIS 7.0 中完全支持所有语言，包括 ASP.NET 和 PHP。Managed Fusion Url Rewriter 让您可以自由地超越标准 URL 方案并开发自己的方案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-05T01:27:55.273

[IIRF](http://IIRF.codeplex.com)

*   适用于 IIS5、6 或 7。
*   自由
*   开源
*   维护良好
*   自由
*   支持正则表达式模式匹配
*   使用 .htaccess 语法
*   重写规则
*   重定向规则
*   重写标头
*   重写条件
*   自由
*   为每个 IIS 应用程序或站点使用单独的配置文件
*   规则更改会自动加载
*   代理通行证
*   我有没有提到它是免费的？

![替代文字](https://imgur.com/cz6tM.png)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-09T12:52:30.317

[Helicon Ape](http://www.helicontech.com/ape/)是 IIS7 上 Apache mod_rewrite 和其他 Apache 模块的完美替代品。语法 99% 与 Apache 兼容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-16T19:41:51.637

[http://www.iis.net/extensions/URLRewrite](http://www.iis.net/extensions/URLRewrite)是为 IIS 7.0 设计的，具有出色的性能和管理 UI。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-02T13:08:34.563

[IIS mod-rewrite](http://www.micronovae.com/ModRewrite/ModRewrite.html)是我所知道的最佳选择，但它不是免费的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T03:19:17.477

[ISAPI Rewrite](http://www.isapirewrite.com/)适用于 IIS 5 或 6。有免费的 Lite 版本，或者您可以付费购买完整版本以获得更多功能，例如代理功能。我已经有一段时间没有使用它了，但当时它工作得很好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-17T16:08:33.313

自从从 Apache 跳下并移至 IIS 以来，我一直在使用 Helicon Ape。它的语法与 Apache 兼容。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-05-18T08:30:52.583

您可以在此处阅读我关于如何使用**Managed Fusion URL Rewriter**的文章：

[http://carlos.mendible.com/2010/02/runnig-apache-behind-iis-server-net.html](http://carlos.mendible.com/2010/02/runnig-apache-behind-iis-server-net.html)

希望能帮助到你。

# c++ - 如何解决内存碎片

> ID：60871
> 
> 赞同：49
> 
> 时间：2008-09-13T21:04:08.043
> 
> 标签：c++, windows, memory

我们偶尔会遇到问题，即我们的长时间运行的服务器进程（在 Windows Server 2003 上运行）由于内存分配失败而引发异常。我们怀疑这些分配由于内存碎片而失败。

因此，我们一直在寻找一些可能对我们有帮助的替代内存分配机制，我希望有人能告诉我最好的一个：

1）使用Windows[低碎片堆](http://msdn.microsoft.com/en-us/library/aa366750.aspx)

2) jemalloc - 用于[Firefox 3](http://en.wikipedia.org/wiki/Mozilla_Firefox_3)

3) Doug Lea 的[malloc](http://g.oswego.edu/)

我们的服务器进程是使用跨平台 C++ 代码开发的，因此理想的解决方案也是跨平台的（*nix 操作系统会遭受这种类型的内存碎片吗？）。

另外，我是否认为 LFH 现在是 Windows Server 2008 / Vista 的默认内存分配机制？...如果我们的客户只是升级他们的服务器操作系统，我当前的问题会“消失”吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-14T02:12:23.013

首先，我同意其他建议资源泄漏的海报。你真的想先排除它。

希望您当前使用的堆管理器能够转储堆中的实际可用总空闲空间（跨所有**空闲**块）以及它被划分的块总数。如果平均空闲块大小与堆中的总空闲空间相比相对较小，那么您确实存在碎片问题。或者，如果您可以转储最大空闲块的大小并将其与总空闲空间进行比较，那将完成同样的事情。如果您遇到碎片，最大的空闲块相对于所有块中可用的总***可用***空间将很小。

要非常清楚上述内容，在所有情况下，我们都在谈论堆中的***空闲***块，而不是堆中分配的块。无论如何，如果不满足上述条件，那么您*确实*存在某种泄漏情况。

因此，一旦您排除了泄漏，您可以考虑使用更好的分配器。***问题中建议的Doug Lea 的 malloc***对于一般用途的应用程序来说是一个非常好的分配器，并且在*大多数*情况下非常健壮。换句话说，它已经过时间测试，可以很好地适用于大多数应用程序。然而，没有一种算法适用于*所有*应用程序，任何管理算法方法都可能被与其设计相反的正确病理条件破坏。

*为什么你有碎片问题？*- 碎片问题的来源是由应用程序的行为*引起*的，并且与同一内存区域中的分配生命周期大不相同。也就是说，一些对象会定期分配和释放，而其他类型的对象会在同一个堆中持续较长时间......将较长生命周期的对象视为在竞技场的更大区域中戳洞，从而防止合并已释放的相邻块。

要解决此类问题，您可以做的最好的事情是在逻辑上将堆划分为生命周期更相似的子区域。实际上，您需要一个临时堆和一个或多个持久堆，它们将具有相似生命周期的事物组合在一起。

其他一些人提出了另一种解决问题的方法，即尝试使分配大小更相似或相同，但这不太理想，因为它创建了一种称为内部碎片的不同类型的碎片 - 这实际上是浪费的空间通过在块中分配比您需要的更多的内存。

此外，使用像 Doug Lea 这样的好的堆分配器，使块大小更相似是不必要的，因为分配器已经在执行两倍大小的分桶方案，这将完全没有必要人为地调整传递给 malloc( ) - 实际上，他的堆管理器会自动为您执行此操作，比应用程序能够进行的调整要强大得多。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-12T10:46:16.837

我认为您错误地过早地排除了内存泄漏。即使是很小的内存泄漏也会导致严重的内存碎片。

假设您的应用程序的行为如下：
分配 10MB
分配 1 个字节
空闲 10MB
（哎呀，我们没有释放 1 个字节，但谁在乎 1 个小字节）

这似乎是一个很小的泄漏，**仅在监视分配的总内存大小时几乎不会注意到它**。但是这种泄漏最终会导致您的应用程序内存看起来像这样：
.
.
免费 – 10MB
。
.
[分配的 -1 字节]
。
.
免费 – 10MB
。
.
[分配的 -1 字节]
。
.
免费 – 10MB
。
.

这种泄漏不会被注意到...直到您想要分配 11MB
假设您的小型转储包含完整的内存信息，我建议使用[DebugDiag](http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en)来发现可能的泄漏。在生成的内存报告中，**仔细检查分配计数（而不是大小）**。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-14T02:21:08.530

正如您所建议的那样，Doug Lea 的 malloc 可能效果很好。它是跨平台的，并且已用于运输代码。至少，它应该很容易集成到您的代码中进行测试。

在固定内存环境中工作多年，这种情况肯定是个问题，即使在非固定环境中也是如此。我们发现 CRT 分配器在性能（速度、浪费空间的效率等）方面往往很糟糕。我坚信，如果您在很长一段时间内广泛需要一个好的内存分配器，您应该编写自己的（或者看看像 dlmalloc 这样的东西是否可以工作）。诀窍是编写适合您的分配模式的东西，并且几乎与其他任何事情一样与内存管理效率有关。

试试 dlmalloc。我肯定会竖起大拇指。它也是相当可调的，因此您可以通过更改一些编译时间选项来获得更高的效率。

老实说，您不应该依赖新的操作系统实现“消失”的东西。N 年后的服务包、补丁或另一个新操作系统可能会使问题变得更糟。同样，对于需要强大内存管理器的应用程序，不要使用编译器提供的库存版本。找到适合*您*情况的。从 dlmalloc 开始并对其进行调整，看看您是否可以获得最适合您的情况的行为。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-13T21:21:56.783

您可以通过减少分配解除分配的数量来帮助减少碎片。

例如，对于运行服务器端脚本的 Web 服务器，它可能会创建一个字符串来将页面输出到。无需为每个页面请求分配和释放这些字符串，只需维护它们的池，因此您仅在需要更多时才分配，但不会释放（意味着一段时间后您会遇到不再分配的情况，因为您有足够）

您可以使用 _CrtDumpMemoryLeaks(); 在运行调试版本时将内存泄漏转储到调试窗口，但是我相信这是特定于 Visual C 编译器的。（它在 crtdbg.h 中）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T21:10:38.230

在怀疑碎片之前，我会怀疑泄漏。

对于内存密集型数据结构，您可以切换到可重用的存储池机制。与堆相比，您还可以在堆栈上分配更多的东西，但实际上我认为这不会产生太大的影响。

我会启动一个像 valgrind 这样的工具，或者做一些密集的日志记录来寻找没有被释放的资源。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-13T21:28:44.363

@nsaners - 我很确定问题出在内存碎片上。我们分析了在分配大块（5-10mb）内存时指向问题的[小型转储。](http://msdn.microsoft.com/en-us/library/bb204861(VS.85).aspx)我们还监控了过程（现场和开发中）以检查内存泄漏 - 没有检测到（内存占用通常非常低）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-13T21:59:32.060

这个问题确实发生在 Unix 上，尽管它通常没有那么糟糕。

Low-fragmentation heap 帮助了我们，但我的同事对[Smart Heap](http://www.microquill.com/)发誓 （多年来，它已在我们的几个产品中跨平台使用）。不幸的是，由于其他情况，我们这次无法使​​用 Smart Heap。

我们还研究了块/分块分配并尝试使用范围精明的池/策略，即这里的长期事物，那里的整个请求事物，那里的短期事物等。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-13T22:55:00.333

像往常一样，您通常可以浪费内存来获得一些速度。

这种技术对于通用分配器没有用，但它确实有它的位置。

基本上，这个想法是编写一个分配器，它从所有分配大小相同的池中返回内存。这个池永远不会碎片化，因为任何块都和另一个块一样好。您可以通过创建具有不同大小块的多个池来减少内存浪费，并选择仍然大于请求数量的最小块大小池。我已经使用这个想法来创建在 O(1) 中运行的分配器。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-11-29T11:09:32.023

如果您谈论 Win32 - 您可以尝试使用 LARGEADDRESSAWARE 来压缩某些东西。您将拥有约 1Gb 的额外碎片整理内存，因此您的应用程序会将其碎片化时间更长。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2018-11-03T17:40:21.817

简单、快速和肮脏的解决方案是将应用程序拆分为**多个进程**，每次创建进程时都应该获得新的 HEAP。

您的内存和速度可能会受到一点影响（交换），但快速硬件和大 RAM 应该能够提供帮助。

当线程还不存在时，这是带有守护程序的旧 UNIX 技巧。

# bash - bash 中的高级目录切换

> ID：60874
> 
> 赞同：9
> 
> 时间：2008-09-13T21:08:33.133
> 
> 标签：bash

我知道一些高级方法来更改目录。`pushd`和`popd`（目录堆栈）或`cd -`（更改到最后一个目录）。

但我正在寻找实现以下目标的快速方法：

说，我在一个相当深的目录中：

```
/this/is/a/very/deep/directory/structure/with\ lot\ of\ nasty/names 
```

我想切换到

```
/this/is/another/very/deep/directory/structure/with\ lot\ of\ nasty/names 
```

有没有一种很酷/快速/极客的方法（没有鼠标）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-13T21:24:39.943

你的意思是路径名相同，只有一个目录名改变（“a”变成“another”）？在这种情况下：

```
cd ${PWD/a/another} 
```

将切换到另一个目录。`$PWD`保存您当前的目录，并`${var/foo/bar}`为您`$var`提供用 'bar' 替换的字符串 'foo'。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T22:22:30.770

设置`CDPATH`变量怎么样？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T19:59:41.987

```
cd ^/a/^/another/ 
```

# sql - SQL 选择底部记录

> ID：60877
> 
> 赞同：10
> 
> 时间：2008-09-13T21:11:18.307
> 
> 标签：sql, sql-server, tsql

我有一个查询，我希望检索最旧的 X 记录。目前我的查询是这样的：

```
SELECT Id, Title, Comments, CreatedDate
FROM MyTable
WHERE CreatedDate > @OlderThanDate
ORDER BY CreatedDate DESC 
```

我知道通常我会删除“DESC”关键字来切换记录的顺序，但是在这种情况下，我仍然希望首先获得以最新项目排序的记录。

因此，我想知道是否有任何方法可以执行此查询，以便对最旧的 X 项进行排序，使最新的项排在第一位。我还应该补充一点，我的数据库存在于 SQL Server 2005 上。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-13T21:17:08.387

为什么不只使用子查询？

```
SELECT T1.* 
FROM
(SELECT TOP X Id, Title, Comments, CreatedDate
FROM MyTable
WHERE CreatedDate > @OlderThanDate
ORDER BY CreatedDate) T1
ORDER BY CreatedDate DESC 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T21:18:05.293

嵌入查询。当按升序排序（即最旧的）时，您取前 x，然后按降序重新排序...

```
select * 
from 
(
    SELECT top X Id, Title, Comments, CreatedDate
    FROM MyTable
    WHERE CreatedDate > @OlderThanDate
    ORDER BY CreatedDate 
) a
order by createddate desc 
```

# sql - MS SQL 中查询的优先级

> ID：60878
> 
> 赞同：23
> 
> 时间：2008-09-13T21:11:30.100
> 
> 标签：sql, sql-server, database

有没有办法告诉 MS SQL 查询不是很重要，它可以（并且应该）花时间？

同样有没有办法告诉 MS SQL 它应该给查询更高的优先级？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-15T18:29:31.813

不在 SQL 2008 以下的版本中。在 SQL Server 2008 中，有资源管理器。使用它，您可以根据登录名的属性（登录名、应用程序名等）将登录名分配给组。然后可以将这些组分配给资源池，并且可以将资源限制或限制应用于这些资源池

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-13T21:31:59.910

SQL Server 还没有任何形式的资源调控器。有一个名为 QUERY_GOVERNOR_COST_LIMIT 的 SET 选项，但它并不完全符合您的要求。并且它可以防止查询基于成本而不是控制资源来执行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:46:46.657

我不确定这是否是您要问的，但我遇到过一种情况，即单击一次 UI 会将 10,000 条记录添加到电子邮件队列（正文中有大量数据）。这封邮件在接下来的几天里就发出去了，所以它不需要是高优先级，事实上，每次发生它都会使服务器陷入困境。

我将该过程拆分为 10,000 个单独的调用，在 UI 上以不同的线程（设置为低优先级）运行该过程，并在运行该过程后将其设置为休眠一秒钟。花了一段时间，但我对它在做什么有非常精细的控制。

顺便说一句，这不是垃圾邮件，所以不要以为是垃圾邮件。

# architecture - 你如何避免技术债务，同时仍然忠于敏捷，即：避免违反 YAGNI 和避免 BDUF？

> ID：60888
> 
> 赞同：10
> 
> 时间：2008-09-13T21:26:40.890
> 
> 标签：architecture, agile, methodology, technical-debt

[通过 Martin Fowler](http://www.martinfowler.com/bliki/TechnicalDebt.html)和[Steve McConnell](http://forums.construx.com/blogs/stevemcc/archive/2007/11/01/technical-debt-2.aspx)的技术债务

YAGNI（你不需要它）[通过维基百科](http://en.wikipedia.org/wiki/You_Ain%27t_Gonna_Need_It)

BDUF（前面的大设计）[通过维基百科](http://en.wikipedia.org/wiki/BDUF)

更新：为了澄清这个问题，我想我也可以这样陈述并保持我的意思：

***“作为一名敏捷实践者，您如何在**每次迭代中在“快速和肮脏”（在尝试遵守 YAGNI 时无意冒着技术债务风险）和过度工程（BDUF）之间找到适当的平衡？*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T16:42:33.700

似乎如果你坚持敏捷的“计划、执行、适应；计划、执行、适应”的敏捷理念（迭代、迭代审查），你会默认避免这些事情。BDUF 与[敏捷估计和计划](https://rads.stackoverflow.com/amzn/click/com/0131479415)的理念完全相反，如果你真的很敏捷，你就不会自动成为 BDUF。

发布和迭代计划会议的目的是确保您为该迭代的项目添加最有价值的功能。如果您牢记这一点，您将免费避免使用 YAGNI。

我强烈推荐 Mike Cohn 关于敏捷规划的书籍：

1.  [应用用户故事](https://rads.stackoverflow.com/amzn/click/com/0321205685)
2.  [敏捷估计和计划](https://rads.stackoverflow.com/amzn/click/com/0131479415)

* * *

**更新：** 在您澄清在迭代中避免 YAGNI 和 BDUF 之后......

**BDUF** ...如果我觉得在开始工作之前没有明确定义某个功能，我会创建一个小的“功能”或故事来说明所需工作的设计类型部分。因此，可能较小的故事的[故事点](http://en.wikipedia.org/wiki/Story_points)估计值为 1，而不是真实功能的 5。这样，设计将时间框化到较小的故事中，您将被驱使继续研究功能本身。

为了避免**违反 YAGNI**，我会非常清楚客户对迭代中某个功能的期望。只做符合客户期望的工作。如果您认为应该添加一些额外的东西，请为其创建一个新功能，并将其添加到待完成[的工作积压中。](http://en.wikipedia.org/wiki/Scrum_(development)#Documents)然后，您会说服客户看到它的好处；就像客户会推动某个功能在某个时间点完成一样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T19:31:12.983

您似乎说“YAGNI”意味着“又快又脏”。我没有看到。

作为一名敏捷程序员，我练习测试驱动开发、代码审查和持续集成。

*   测试驱动开发 (TDD) 作为一个过程，是避免 YAGNI 的好方法。“以防万一有用”的代码往往未经测试且难以测试。
*   TDD 还很大程度上消除了对 BDUF 的强迫：当您的流程是从坐下来开始做一些真正带来价值的事情时，您不能沉迷于 BDUF。
*   TDD，作为一种设计实践，意味着随着您获得解决问题的经验并重构真实代码，大型设计将出现。
*   持续集成意味着您设计您的流程，以便您的产品基本上可以随时发布。这意味着您有一个集成的质量流程，试图防止主线的质量下降。

根据我的经验，技术债务的主要形式是：

*   自动化测试套件未涵盖的代码。不要让这种情况发生，除非非常本地化的组件特别难以测试。未经测试的代码是损坏的代码。
*   违反编码标准的丑陋代码。不要让这种情况发生。这就是您需要将代码审查构建到持续集成过程中的原因之一。
*   有异味且需要重构以便更容易修改或理解的代码和测试。这是技术债务的良性形式。用你的经验知道什么时候积累，什么时候回报。

不确定这是否回答了你的问题，但我写得很开心。

> Troy DeMonbreun 评论道：
> 
> > 不，那不是我的意思……“又快又脏”=（在尝试遵守 YAGNI 时无意冒着技术债务的风险”）。这并不意味着 YAGNI 只是又快又脏。短语“又快又脏”是我曾经在 Martin Fowler 对技术债务的描述中引用过的话

避免[YAGNI是](http://c2.com/xp/YouArentGonnaNeedIt.html)[KISS](http://en.wikipedia.org/wiki/KISS_principle)的另一种说法。YAGNI 增加了[技术债务](http://www.martinfowler.com/bliki/TechnicalDebt.html)。避免 YAGNI 和保持低技术债务之间没有矛盾。

我想我可能仍然错过了你的问题的重点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T17:02:11.377

几周前，基于您在 HanselMinutes 上完成的定义，有一个关于技术债务的有趣讨论 -[完成了什么](http://www.hanselminutes.com/default.aspx?showID=137)。该节目的基本内容是，如果您重新定义“完成”以提高感知速度，那么您将积累技术债务。这样做的必然结果是，如果您没有对“完成”的正确定义，那么您很可能会获得一份需要在发布前完成的项目列表，而不管设计方法如何。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T23:50:04.473

只做[最简单的事情](http://www.xprogramming.com/Practices/PracSimplest.html)。我同意 Ayende 的观点，他说[敏捷的关键](http://ayende.com/Blog/archive/2008/12/21/the-tests-has-no-value-by-themselves-my-most-successful.aspx)是“经常发布”。像这样的定期发布周期将意味着没有时间进行 BDUF，它还将阻止开发人员违反 YAGNI。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T21:49:56.230

我发现 Robert Martin 的[测试驱动开发](http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd) (TDD) 方法有助于解决这些问题。

为什么？

*   您只需编写足够的代码即可通过下一个测试。
*   我认为可测试的代码更干净。
*   设计必须纳入测试，这有助于保持设计的重点。
*   当您确实必须更改（重构）时，您需要依靠测试

无论何时编写测试（之前或之后），我发现编写测试可以帮助您做出实际决定。例如，我们选择了设计 A 或 B，因为 A 更易于测试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-13T22:01:15.220

“传统”的 XP 答案是重构与自动化单元测试相结合。

但从哲学上讲，这是一个非常有趣的问题。我认为您不需要*避免*技术债务，只需将其保持在可管理的水平即可。Steve McConnell 的文章很好地平衡了这种平衡——类比有效的原因是，只要你接受成本和风险，在公司中建立财务债务是正常且可以接受的——技术债务也可以。

或许答案本身也在于 YAGNI 的原理。在你这样做之前，你不需要偿还技术债务，那就是你进行重构的时候。当您在技术债务的系统领域进行大量工作时，请查看重新设计将产生多少短期差异。如果它足以让它变得有价值，那就还清吧。麦康奈尔关于维护债务清单的建议将帮助您了解何时进行此考虑。

我不认为有一个绝对的答案 - 就像很多事情一样，它是基于你的经验、直觉和你在每种特定情况下的分析的判断。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-01T21:08:45.550

在我工作的地方，我相信我们避免债务的方法是快速完成整个周期，即向最终用户展示功能，然后得到一个应该推动测试的签名，或者拒绝说出什么是错的给出更新的要求。通过在迭代中重复执行此操作，可以通过尝试这个和那个来找到关于用户想要什么的很多变化。

一个关键点是尝试完全按照用户的意愿去做，因为做的更多违反了 YAGNI 并引入了 BDUF，而一遍又一遍地提炼需求的想法是我认为敏捷的核心。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-13T21:50:19.897

这就是为什么写好的“学术论文”总是更容易，谈论敏捷开发有多好，什么是“最佳实践”等等。

这就是为什么你会发现很多“合适的工程师”组成了新的软件工程技术。

过程很重要，保持最佳实践很酷，但最重要的是，常识驱动设计过程。软件是由人开发的，所以 YAGNI 真的应该是：

我可能不需要，但也许我会，因为在我的具体业务/公司/部门中，这件事确实会发生，或者我会需要它，但我只是没有时间，没有那么快速和肮脏的黑客来赚钱并保住我的工作，或者我可能需要它，以后重构将比现在从头开始做的成本高出 10 倍，而且我现在有时间。

所以使用你的常识，相信它或相信为你工作的人的常识。不要把每一篇学术论文都当作事实证明，经验是最好的老师，你的公司应该随着时间和自己的经验改进他们的方式或做事。

**编辑：**顺便说一句，TDD 与 YAGNI 是相反的，你甚至在知道你是否需要它们之前就已经构建了测试。说真的，别再听学术了！！制作软件没有神奇的方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-13T22:30:43.293

对于任何给定的项目，敏捷肯定会降低您的 TD 吗？

事实上，您正在实施客户想要的，即通过他们的反馈，将 TD 保持在最低限度，

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-08-08T22:39:34.943

问题实际上可能在更高的层面：管理层和产品负责人关心截止日期，而不是开发人员自己。

在我最后一个工作的地方，我从事遗留代码工作，但与使用（据说）敏捷和 TDD 开发全新代码的人保持联系。

现在 TDD 应该是红 - 绿 - 重构：编写失败的测试，做最少的事情以通过测试，然后重新编写代码以使其更易于维护，同时确保它仍然通过测试。

*但是*……进度是通过用户故事的实施速度来衡量的，即添加新功能的速度。重构的关键在于它不会添加任何新功能。是的，它非常重要，但它并没有像向产品所有者展示新功能甚至测试代码行那样立即产生影响。

随着截止日期越来越近，加班成为标准，人们有动力在重构部分吝啬。这样做的越多，通过用户故事的速度就越快，这似乎是管理层所关心的。

现在，这*确实*导致了技术债务，因为在许多情况下，为了完成下一个用户故事，事实证明有必要返回并重构 - 真正重写 - 前一堆用户故事的代码。管理层对此感到愤怒，因为从他们的角度来看，所讨论的用户故事看起来与以前的用户故事并没有太大的不同，那么为什么对它的估计要长 10 倍呢？

（事情也有一个丑陋的博弈论方面。如果你或你的团队对重构*很*认真，这并没有阻止你在另一个团队之后被困在清理*中*。当然，另一个团队看起来更好，因为他们在相同的时间内完成了更多的用户故事。）

我的观点是，如果做得好，TDD 可能不会导致技术债务。但要正确完成，必须有来自高层的真正支持。

# asp.net - ASP.NET 将无效字符串转换为 Null

> ID：60893
> 
> 赞同：0
> 
> 时间：2008-09-13T21:35:16.953
> 
> 标签：asp.net, linq, linq-to-sql, validation, data-binding

在我的应用程序中，我必须像`TextBox`这样：`FormView``LinqDataSource`

```
<asp:TextBox ID="MyTextBox" runat="server" 
             Text='<%# Bind("MyValue") %>' AutoPostBack="True" 
             ontextchanged="MyTextBox_TextChanged" />

protected void MyTextBox_TextChanged(object sender, EventArgs e)
{
    MyFormView.UpdateItem(false);
} 
```

这是在内部，`UpdatePanel`因此对该字段的任何更改都会立即保留。此外， 的`MyValue`值为`decimal?`。除非我在字段中输入任何无法转换为十进制的字符串，否则这很好用。在这种情况下，`UpdateItem`调用会抛出：

> **LinqDataSourceValidationException** - 无法设置 MyType 类型的一个或多个属性。asdf 不是 Decimal 的有效值。

我了解这个问题，ASP.NET 不知道如何将“asdf”转换为十进制？我想做的是将所有这些无效值转换为空值。做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-13T21:46:57.300

我认为您应该在您的页面上处理 LinqDataSource 的更新事件。检查无效字符串（使用 TryParse 方法或其他方法），然后继续更新基类。

（编辑：我的直觉与[这里](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.linqdatasourcevalidationexception.aspx)推荐的一致）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T21:55:52.583

不熟悉 ASP，但在 .net 中，你不能只做一些类似的事情

```
protected void MyTextBox_TextChanged(object sender, EventArgs e)
{ 
    Decimal d = null;
    TextBox tb = sender as TextBox;

    if(!Decimal.TryParse(tb.Text, out d))
    {
            tb.Text = String.Empty;
    }
    MyFormView.UpdateItem(false);
} 
```

# windows - 如何在特定位置打开 cmd 窗口？

> ID：60904
> 
> 赞同：405
> 
> 时间：2008-09-13T21:51:07.960
> 
> 标签：windows, cmd

如何在特定位置打开 cmd 窗口，而不必一直导航到我想要的目录？

* * *

## 回答 #1

> 赞同：528
> 
> 时间：2008-09-13T21:53:54.147

这可能是你想要的：

```
cmd /K "cd C:\Windows\" 
```

请注意，为了更改驱动器号，您需要使用`cd /d`. 例如：

```
C:\Windows\System32\cmd.exe /K "cd /d H:\Python\" 
```

[（文档）](http://ss64.com/nt/cd.html)

* * *

## 回答 #2

> 赞同：306
> 
> 时间：2008-09-13T21:58:17.227

如果您有 Windows Vista 或更高版本，请在按住 Shift 键的同时右键单击资源管理器中的文件夹图标，然后单击“在此处打开命令窗口”或“在此处打开 PowerShell 窗口”上下文菜单选项。

如果您已经在所需的文件夹中，则可以执行以下操作之一：

*   [仅限 Win8+] 单击资源管理器功能区的文件按钮，然后单击“在此处打开命令窗口”或“在此处打开 PowerShell 窗口”。
*   `Shift`-`right-click`在资源管理器窗口的背景上，然后单击“在此处打开命令窗口”或“在此处打开 PowerShell 窗口”。（凯特在评论中推荐）
*   [仅限 Vista 或 Win7] 打开资源管理器文件菜单时按住 Shift 键，然后单击“在此处打开命令窗口”。如果看不到菜单栏，请按`Alt`- `Shift`- `F`-打开文件菜单`Alt`，`F`打开文件菜单，加`Shift`.

对于 Windows XP，[使用 dF 提到的 PowerToy](https://stackoverflow.com/a/60905/1879)可以获得相同的功能。

* * *

## 回答 #3

> 赞同：289
> 
> 时间：2014-04-27T07:40:25.947

假设您在文件资源管理器中打开了目标目录/文件夹，请执行以下操作：

1.  点击地址栏，或者按`Alt`+`D`

2.  现在，当地址栏突出显示时，在栏中键入**cmd**。

3.  按回车键

您会注意到该文件夹​​中的命令提示符

* * *

## 回答 #4

> 赞同：82
> 
> 时间：2014-03-06T09:57:24.790

从 Windows 7 到 Windows 10 的某些版本，在任何地方打开命令提示符都非常简单，无需使用命令“cd”进行导航。试试下面的一个。按住 键单击鼠标右键`Shift`。

![样本](https://i.stack.imgur.com/VxAHr.png)

它将产生这样的选项。然后只需选择“在此处打开命令窗口”选项。最新版本的 Windows 10 已将此功能替换为“在此处打开 Powershell”。

* * *

## 回答 #5

> 赞同：63
> 
> 时间：2008-09-13T21:53:35.223

试试[这个来自 Microsoft 的“PowerToy”](http://go.microsoft.com/fwlink/?LinkId=211471)：

> **在此处打开命令窗口**
> 
> 此 PowerToy 在文件系统文件夹上添加了“在此处打开命令窗口”上下文菜单选项，让您可以快速打开指向所选文件夹的命令窗口 (cmd.exe)。

**编辑：**除了 Windows XP，此软件将无法在任何版本的 Windows 上运行。

[![在此处输入图像描述](https://i.stack.imgur.com/sdXWW.png)](https://i.stack.imgur.com/sdXWW.png)

* * *

## 回答 #6

> 赞同：53
> 
> 时间：2012-04-13T04:26:57.673

在 Windows Vista、Windows 7 和 Windows 10 上，只需按住该`Shift`键并右键单击文件夹即可。

上下文菜单将包含一个标题为：“在此处打开命令窗口”的条目

**更新：**在资源管理器的地址栏中输入“cmd”并按`enter`

[![在此处输入图像描述](https://i.stack.imgur.com/irrxh.png)](https://i.stack.imgur.com/irrxh.png)

**更新 2：**在 Windows 10 中，转到文件菜单并选择“打开 Windows PowerShell”。有一个以**管理员**身份运行的选项。

[![在此处输入图像描述](https://i.stack.imgur.com/3GAxb.png)](https://i.stack.imgur.com/3GAxb.png)

* * *

## 回答 #7

> 赞同：38
> 
> 时间：2008-09-13T21:55:38.167

使用 /K 开关。例如

```
cmd /K "cd /dc:\WINDOWS\"

```

将在 C:\Windows 目录下创建一个 cmd 窗口

* * *

## 回答 #8

> 赞同：37
> 
> 时间：2017-01-10T21:17:10.430

只需`cmd`在地址栏中写入，它将在当前文件夹中打开。

* * *

## 回答 #9

> 赞同：29
> 
> 时间：2018-11-25T13:52:08.317

在 Windows 中，转到文件资源管理器中的文件夹位置，删除路径并键入 cmd，然后按 Enter。路径将在 cmd 中打开。

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2015-03-01T15:44:54.277

此外，这是在任何 Windows 文件夹中打开控制台的快捷方式：

*   在 Windows 资源管理器中打开任何文件夹。
*   按下`Alt + D`以聚焦地址栏
*   输入`cmd`并按回车

很实用的捷径。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2018-05-18T02:06:53.840

如果您从任务栏启动 cmd，则需要执行以下操作：

右键单击->右键单击命令提示符->属性

[![在此处输入图像描述](https://i.stack.imgur.com/NMFBt.png)](https://i.stack.imgur.com/NMFBt.png)

然后在属性窗口中更改**Start in**的值：

[![在此处输入图像描述](https://i.stack.imgur.com/1oI8t.png)](https://i.stack.imgur.com/1oI8t.png)

**此解决方案不适用于以管理员身份打开命令提示符**

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2008-09-13T21:56:16.280

创建一个快捷方式并编辑您希望 cmd.exe 启动的目录的快捷方式的“开始于”属性。

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2014-03-12T04:20:02.637

在 Windows 8 中，您可以单击地址栏并键入“cmd”（不带引号）并按 Enter。这将在当前路径中打开 cmd 窗口。

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2016-06-03T02:33:13.293

最简单的方法是转到 Windows 资源管理器的地址栏并`cmd`在那里输入。它将自动为您打开命令提示符窗口。

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2011-03-17T16:41:01.167

我刚刚看到这个问题，无法帮助在 Windows XP 上发布我的 cmd 的 AutoHotkey 脚本。您可以在脚本中发现热键。好消息是当您当前的窗口是资源管理器时，cmd 将在地址栏中显示的路径中打开。

我将此脚本保存在一个文件夹中，其中存储了所有绿色工具（包括 AutoHotkey）。对于一台新机器，我只需复制文件夹，双击脚本将 .ahk 与 AutoHotkey 关联，并在我的启动文件夹中创建一个快捷方式。它比安装[PowerToys](https://en.wikipedia.org/wiki/Microsoft_PowerToys)更快。

```
; Get working folder
GetWorkingFolder() {
    if WinActive("ahk_class ExploreWClass") or WinActive("ahk_class CabinetWClass") {
        ControlGetText, path, Edit1
        return %path%
    } else if WinActive("FreeCommander") {
        Send, {CTRLDOWN}{ALTDOWN}{INS}{ALTUP}{CTRLUP}
        Sleep, 100
        return clipboard
    } else {
        return "C:\"
    }
}

#IfWinActive,

#c::
    path := GetWorkingFolder()
    Run, %ComSpec%, %path%
    return

; PowerShell
#+C::
    path := GetWorkingFolder()
    Run, %SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe, %path%
    return

#^c::
    Run, %ComSpec%, %temp%
    return

#!c::
    path := GetWorkingFolder()
    Run, %comspec% /k "%VS90COMNTOOLS%vsvars32.bat", %path%
    return

; irb
#!b::
    path := GetWorkingFolder()
    Run, c:\cygwin\bin\ruby /usr/bin/irb, %path%
    return

; Bash
#b::
    path := GetWorkingFolder()
    Run, bash --login, %path%
    return

; Paste in console
+INS::
    if WinActive("ahk_class ConsoleWindowClass") {
        WinGetPos, x, y, w, h, A
        MouseGetPos, mx, my
        ;MsgBox x=%x% y=%y% w=%w% h=%h% mx=%mx% my=%my%
        if (mx < 10)
            mx = 10
        else if (mx > w - 30)
            mx := w - 30

        if (my < 40)
            my = 40
        else if (my > h)
            my := h - 10

        MouseClick, right, mx, my
    }
    return 
```

对于任何感兴趣的人，您可以[在 github 上的 rwin找到此脚本](https://github.com/codism15/rwin/blob/master/ahk-scripts/console.ahk)

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2008-10-18T21:03:15.743

**更新**：这现在内置在 Windows 中。看到[这个答案](https://stackoverflow.com/a/60914/4228)。

XP powertoy 是一个不错的选择，但我想我会发布另一个，以防您想“自己动手”。创建一个文本文件，将其命名为anything.reg，粘贴下面的代码，保存，然后双击它以将其添加到注册表中（或者如果您了解其中发生的情况，只需手动将信息添加到注册表中.reg 文件）。

```
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Folder\shell\Command_Prompt_Here...]
@="Command Prompt Here..."

[HKEY_CLASSES_ROOT\Folder\shell\Command_Prompt_Here...\command]
@="cmd.exe \"%1\"" 
```

更新：Windows 更新后，**Win10**删除了 cmd-here 功能。要重新激活它，您必须使用：

```
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Directory\shell\cmd]
@="@shell32.dll,-8506"
"Extended"=""
"NoWorkingDirectory"=""
"ShowBasedOnVelocityId"=dword:00639bc8

[HKEY_CLASSES_ROOT\Directory\shell\cmd\command]
@="cmd.exe /s /k pushd \"%V\"" 
```

该条目`ShowBasedOnVelocityId`是强制性的

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2017-08-02T19:53:19.860

这将在上下文菜单中添加条目以启动自动导航到您单击的目录的命令窗口。

用法：

```
Right-click a folder icon (or the empty background area inside an already open folder)
and click either "Open in Terminal" or "Open in Terminal (Admin)".

You can also right click files to execute them with a command window.
When the file is done running you are left with a command window that is navigated to the files directory. 
```

[![在此处输入图像描述](https://i.stack.imgur.com/buU1K.png)](https://i.stack.imgur.com/buU1K.png)

Open_in_Terminal.reg

```
Windows Registry Editor Version 5.00

; Admin versions.

; Right click on a folder in a directory.
[HKEY_CLASSES_ROOT\Directory\shell\OpenCommandWindowHereAsAdministrator]
@="Open in Terminal (Admin)"
"Icon"="cmd.exe"
"HasLUAShield"=""
"Position"="middle"
[HKEY_CLASSES_ROOT\Directory\shell\OpenCommandWindowHereAsAdministrator\command]
@="cmd.exe /c powershell.exe -Command \"Start-Process cmd -Verb runas -ArgumentList '/k pushd \"%1\"'\""

; Right click on nothing in a directory, i.e. the "background" of the directory.
[HKEY_CLASSES_ROOT\Directory\Background\shell\OpenCommandWindowHereAsAdministrator]
@="Open in Terminal (Admin)"
"Icon"="cmd.exe"
"HasLUAShield"=""
"Position"="middle"
[HKEY_CLASSES_ROOT\Directory\Background\shell\OpenCommandWindowHereAsAdministrator\command]
@="cmd.exe /c powershell.exe -Command \"Start-Process cmd -Verb runas -ArgumentList '/k pushd \"%V\"'\""

; Right click on nothing in a library directory, i.e. the "background" of the library directory.
[HKEY_CLASSES_ROOT\LibraryFolder\Background\shell\OpenCommandWindowHereAsAdministrator]
@="Open in Terminal (Admin)"
"Icon"="cmd.exe"
"HasLUAShield"=""
"Position"="middle"
[HKEY_CLASSES_ROOT\LibraryFolder\Background\shell\OpenCommandWindowHereAsAdministrator\command]
@="cmd.exe /c powershell.exe -Command \"Start-Process cmd -Verb runas -ArgumentList '/k pushd \"%V\"'\""

; Right click on a file in a directory.
[HKEY_CLASSES_ROOT\*\shell\OpenWithCommandWindowAsAdministrator]
@="Open in Terminal (Admin)"
"Icon"="cmd.exe"
"HasLUAShield"=""
"Position"="middle"
[HKEY_CLASSES_ROOT\*\shell\OpenWithCommandWindowAsAdministrator\command]
@="cmd.exe /c powershell.exe -Command \"Start-Process cmd -Verb runas -ArgumentList '/k pushd \\\"%W \\\" && \\\"%1\\\"'\""

; Non-Admin versions.

; Right click on a folder in a directory.
[HKEY_CLASSES_ROOT\Directory\shell\OpenCommandWindowHere]
@="Open in Terminal"
"Icon"="cmd.exe"
"Position"="middle"
[HKEY_CLASSES_ROOT\Directory\shell\OpenCommandWindowHere\command]
@="cmd.exe /k pushd \"%1\""

; Right click on nothing in a directory, i.e. the "background" of the directory.
[HKEY_CLASSES_ROOT\Directory\Background\shell\OpenCommandWindowHere]
@="Open in Terminal"
"Icon"="cmd.exe"
"Position"="middle"
[HKEY_CLASSES_ROOT\Directory\Background\shell\OpenCommandWindowHere\command]
@="cmd.exe /k pushd \"%V\""

; Right click on nothing in a library directory, i.e. the "background" of the library directory.
[HKEY_CLASSES_ROOT\LibraryFolder\Background\shell\OpenCommandWindowHere]
@="Open in Terminal"
"Icon"="cmd.exe"
"Position"="middle"
[HKEY_CLASSES_ROOT\LibraryFolder\Background\shell\OpenCommandWindowHere\command]
@="cmd.exe /k pushd \"%V\""

; Right click on a file in a directory.
[HKEY_CLASSES_ROOT\*\shell\OpenWithCommandWindow]
@="Open in Terminal"
"Icon"="cmd.exe"
"Position"="middle"
[HKEY_CLASSES_ROOT\*\shell\OpenWithCommandWindow\command]
@="cmd.exe /k pushd \"%W\" && \"%1\"" 
```

这需要付出很多努力，所以如果您觉得慷慨，请随时发送[贝宝](https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=3HVWGXQ9U9F5W&currency_code=USD&source=url)捐款以帮助我克服调试和测试的 PTSD :)

如果您需要一个卸载程序：

Open_in_Terminal_Remover.reg

```
Windows Registry Editor Version 5.00

[-HKEY_CLASSES_ROOT\Directory\shell\OpenCommandWindowHereAsAdministrator]
[-HKEY_CLASSES_ROOT\Directory\Background\shell\OpenCommandWindowHereAsAdministrator]
[-HKEY_CLASSES_ROOT\LibraryFolder\Background\shell\OpenCommandWindowHereAsAdministrator]
[-HKEY_CLASSES_ROOT\*\shell\OpenWithCommandWindowAsAdministrator]
[-HKEY_CLASSES_ROOT\Directory\shell\OpenCommandWindowHere]
[-HKEY_CLASSES_ROOT\Directory\Background\shell\OpenCommandWindowHere]
[-HKEY_CLASSES_ROOT\LibraryFolder\Background\shell\OpenCommandWindowHere]
[-HKEY_CLASSES_ROOT\*\shell\OpenWithCommandWindow] 
```

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2017-08-08T08:53:15.097

**pushd**命令设置当前文件夹。所以：

```
cmd /k "pushd D:\Music" 
```

* * *

## 回答 #19

> 赞同：9
> 
> 时间：2015-10-09T09:02:23.110

对于 Windows 7 或更高版本，只需在目标文件夹地址栏中键入 cmd。这就对了。它将打开命令提示符，路径设置为您当前的目录。

* * *

## 回答 #20

> 赞同：9
> 
> 时间：2019-07-10T19:06:39.353

此答案适用于 Windows 10。

在文件夹中任意位置创建命令提示符快捷方式，然后右键单击该快捷方式 [![在字段中输入您的目标](https://i.stack.imgur.com/1bcj5.png)](https://i.stack.imgur.com/1bcj5.png)

和

[![干得好](https://i.stack.imgur.com/wKNKx.png)](https://i.stack.imgur.com/wKNKx.png)

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2016-02-09T14:01:28.747

在文件资源管理器中，按住`Shift`键，然后按住`right click`或按住要在该位置打开命令提示符的`press and hold`或`folder`选项，然后按住选项。`drive``click/tap``Open Command Prompt Here`

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2016-06-15T17:49:57.863

我看到有多个答案，有些很复杂:)，看到它们很奇怪。您只需打开任何 Windows 文件夹窗口，导航到所需文件夹并专注于地址栏并输入“cmd”并按 Enter，您将直接看到新的命令提示符窗口，其中包含我们已经导航的文件夹路径或位置windows文件夹窗口。如果您想以清晰的图像查看这些步骤，您可以查看

[**如何直接在特定文件夹中打开命令提示符**](http://www.testingtools.co/general/how-to-open-command-prompt-in-a-specific-folder)

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2017-02-07T05:51:08.850

对于 Windows： **选择**要在命令提示符中打开的文件夹 - 选择后，按住“Shift 键”。右键单击那里并选择选项“在此处打开命令窗口”

* * *

## 回答 #24

> 赞同：7
> 
> 时间：2017-03-24T17:57:53.840

使用参数 /S /K pushd "C:\YOUR FOLDER\" 创建 cmd.exe 的快捷方式

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2019-05-22T08:46:38.277

在 Windows 中转到特定文件夹，然后单击文件资源管理器路径并将其删除，然后键入 cmd 并单击 enter.. 在 cmd 中，您的特定文件夹及其路径将打开..

* * *

## 回答 #26

> 赞同：6
> 
> 时间：2014-01-14T23:39:19.893

在 Windows 资源管理器中 - shift + 鼠标右键单击文件夹上方的“在此处打开命令窗口”选项显示在菜单中。或使用您的 Windows 版本的语言。

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2008-10-18T20:25:03.340

右键单击桌面并导航到新建，然后从子菜单中选择“快捷方式”→ 浏览到 Windows 目录（或文件夹），然后到该`system32`目录并单击`OK`。

将 a`\`和“cmd.exe”（不带引号）添加到命令字符串中。它应该如下所示：

```
C:\WINDOWS\System32\cmd.exe. 
```

单击`Next`和`Finish`。右键单击桌面上的新 CMD 图标并选择属性，然后`Next`到开始。在选项中，删除该行并将路径添加到您希望它开始的目录的任何位置...例如，`C:\temp\mp3`然后单击`OK`。

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2011-11-02T09:00:04.210

我知道有一种更简单的方法。在开始菜单中找到 cmd.exe 并将其作为快捷方式发送到桌面。然后右键单击它并选择属性。您将在“目标”下看到“开始于”框。将该目录更改为您想要设置的任何内容。单击确定并启动桌面中的 cmd.exe。在我看来，这是一个非常简单且确定的解决方案:)

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2012-01-16T09:43:02.670

该程序始终在资源管理器的当前路径中打开 cmd.exe： [https ://github.com/jhasse/smart_cmd](https://github.com/jhasse/smart_cmd)

您也可以将其固定到任务栏，然后使用 WindowsKey+[1-0] 作为键盘快捷键。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2015-10-08T16:59:23.597

批量使用一行文件：

START "Desire_Path" // 不带引号将您要开始的位置用 cmd

示例（打开文本编辑器，将代码放入其中并使用 .bat 扩展名保存文件）：

```
START cd C:\Users 
```

然后只需双击它

****注意：如果您希望资源管理器完成任务，请不要输入 CD 命令。

*做对面：

为了让您在使用 cmd 时使用 explorer.exe 应用程序打开特定目录，您可以使用命令 START 和要显示的文件夹的绝对路径。

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2015-12-30T18:15:06.780

此方法使用`cmd.exe`快捷`Send to`方式，因此`cmd.exe`可以直接打开目录。这种替代方法是在没有`Open command window here`右键单击菜单的情况下。

1.  打开“文件资源管理器”并`shell:sendto`在位置栏中输入以导航到`Send to`文件夹。
2.  复制`Command Prompt`快捷方式或创建新的快捷方式`.lnk`文件。
3.  编辑快捷方式的属性并将目标编辑为`%windir%\system32\cmd.exe /k cd /d`，然后按“确定”保存更改。
4.  右键单击文件夹并展开`Send to`菜单以使用`cmd`快捷方式。

此快捷方式应打开一个`cmd`窗口，其中包含通过右键单击选择的目录。

此方法至少应在 Window 7 和 10 下工作。将快捷方式命名为`Command Prompt (cd)`指定快捷方式的任务。

可能的错误信息：

*   显示“目录名无效。” 如果选择了文件夹以外的文件夹。
*   显示“系统找不到指定的驱动器。” 如果该文件夹不存在。
*   显示“文件名、目录名或卷标语法不正确。” 如果选择了多个文件。

关于快捷方式的小知识：使用 under 时，目录会自动作为参数添加到快捷方式的末尾`Send to`，因此快捷方式不需要输入目录。

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2018-09-10T22:11:36.750

就我而言，我非常希望在特定文件夹中以管理员模式打开 CMD 窗口。方法如下（适用于 Windows 7）：

在目标文件夹中，创建仅包含一行的 START.BAT：

```
 start cd c:\MyTargetFolder 
```

从 START.BAT 中拖动一个快捷方式并将其命名为“START AS ADMIN”。

右键单击快捷方式并选择“以管理员身份运行”和“最小化运行”。还要确保“Start In”将导致选择相同的驱动器（因为 CD 不会更改驱动器！）。

当您单击该快捷方式时，您将获得 UAC 提示，然后在所需文件夹中打开一个命令窗口。标题栏将显示此 CMD 窗口处于 ADMINISTRATOR 模式。

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2021-07-02T15:32:00.720

**<===||==========> 在 Windows 10 上 <==========||===>**

* * *

假设您在文件资源管理器中打开了目标目录/文件夹，请执行以下操作：

1.  点击地址栏，或者按`Alt`+`A`

2.  现在，当地址栏突出显示时，`cmd`在栏中输入。

3.  按键`Enter`_

* * *

对于 powershell 窗口：

1.  只需按`Alt`+ `f`+ `s`+`a`

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2014-02-27T23:47:28.520

如果您使用 Total Commander，则底部有一个字段。它显示您当前所在的活动目录，并将在该目录中运行输入的命令。

![Total Commander 命令行](https://i.stack.imgur.com/naGaS.png)

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2018-05-19T07:26:23.927

我没有将其保存为快捷方式，而是这样做的，我发现它非常有用。已经有答案可以显示为快捷方式，但我只是想分享这个，特别是我发现它对 Angular 项目非常有用。

*   创建一个新的txt文件并将以下代码写入其中。
    `@ECHO OFF cd C:\YourProjectPath\FolderPath\`
*   以方便的名称另存为 .bat 文件。（我通常将其保存为“goto-myProjectName.bat”

*   然后将该 bat 文件复制到您的默认路径中（当您运行 cmd 时，无论您的默认路径是什么，它都以该路径开头。例如，在我的机器上它是 windows/system32）

*   然后键入不带扩展名的 bat 文件名。
*   例如：`goto-myProjectName`

然后它应该带你去那里。

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2021-02-22T14:59:22.270

另一个简单的解决方案是安装[Windows Terminal](https://www.microsoft.com/en-us/p/windows-terminal/9n0dx20hk701?activetab=pivot:overviewtab)。

然后，当您右键单击文件夹时，您会自动获得“在 Windows 终端中打开”：

[![在此处输入图像描述](https://i.stack.imgur.com/hiWuc.jpg)](https://i.stack.imgur.com/hiWuc.jpg)

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2009-08-03T06:58:27.147

你也可以这样做：

```
[HKEY_CLASSES_ROOT\Directory\shell\cmd]
@="command prompt here"
[HKEY_CLASSES_ROOT\Directory\shell\cmd\command]
@="cmd.exe /c start \"%1\" cmd.exe /k cd /d %1"
[HKEY_CLASSES_ROOT\Drive\shell\cmd]
@="command prompt here"
[HKEY_CLASSES_ROOT\Drive\shell\cmd\command]
@="cmd.exe /c start \"%1\" cmd.exe /k cd /d %1" 
```

更新：对于您需要的 Win10 `ShowBasedOnVelocityId`- 请参阅上面的答案。

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2019-05-22T10:28:43.607

`HKCR\Directory\shell`尽管在 Windows 10（不起作用）下有一些答案，但以下内容对我有用：

**SetOpenCmdHere.reg**

```
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Folder\shell\cmd]
@="Open CMD here..."

[HKEY_CLASSES_ROOT\Folder\shell\cmd\command]
@="C:\\Windows\\system32\\cmd.exe /k pushd \"%1\"" 
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2017-05-27T01:21:47.233

在 Windows 10 中，您只需单击一下即可在任何文件夹中获取 cmd。只需保留`"shift + mouse right click "`您想要的文件夹，然后`cmd`将使用您的文件夹路径打开。

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2019-02-04T02:12:06.370

Windows 10 文件资源管理器现在有一个“快速访问工具栏”。

只需按“Alt+F”打开文件菜单，导航到“打开 Windows PowerShell”菜单，右键单击并选择“添加到快速访问工具栏”：

[![在此处输入图像描述](https://i.stack.imgur.com/rRkHD.png)](https://i.stack.imgur.com/rRkHD.png)

现在您将获得一个可以单击的小图标，它将在您所在的目录中打开 PowerShell： [![在此处输入图像描述](https://i.stack.imgur.com/QTe8F.png)](https://i.stack.imgur.com/QTe8F.png)

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2019-06-07T07:02:38.490

为什么这么多设置，对于这个简单的问题，当你在 cmd 的路径上输入

```
start . 
```

然后按 Enter

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2017-04-15T13:55:45.080

为了在 windows 系统中使用终端获得更好的体验，[cmder](http://cmder.net/)可能有助于快捷方式的使用：

1.  [将cmder](http://cmder.net/)下载到您的系统中
2.  制作快捷方式
3.  类型`path_of_the_cmder` `/START` `target_path_wish_to_run`

例如：

**`TARGET`**->`C:\Users\<username>i\AppData\Roaming\cmder\Cmder.exe /START C:\SOURCE\`

# macos - 更改 Aquamacs 中的字体？

> ID：60910
> 
> 赞同：10
> 
> 时间：2008-09-13T21:55:20.120
> 
> 标签：macos, emacs, lisp, aquamacs

我最近需要做一些 lisp 编辑，我发现了适用于 OS X 的漂亮 Ready Lisp 包，这很棒，除了 Aquamacs 自动使用比例字体（这是白痴，恕我直言），我想改变它为等宽字体。但是，我并不是一个真正的 EMACS 用户，而且 Aquamacs 中的首选项菜单对于在何处以及如何进行此类更改还不太清楚。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-09-01T05:01:11.023

在 Aquamacs 2.1 中，您可以通过 Options->Appearance->Font for Text Mode 设置字体...这会打开标准字体选择器窗口，选择您喜欢的字体。然后，当您退出 emacs (Cx Cc) 时，系统会提示您保存选项，点击“y”。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-13T22:31:21.623

这就是我在 OS X 的 .emacs 中的内容：

```
(set-default-font "-apple-bitstream vera sans mono-medium-r-normal--0-0-0-0-m-0-mac-roman") 
```

现在，我不确定 Bitstream Vera 是 OS X 的标准配置，因此您可能必须下载它或选择不同的字体。`(x-list-fonts "searchterm")`您可以通过在 ELisp 缓冲区中运行来搜索 X 字体名称（例如`*scratch*`- 要运行它，输入它然后`C-j`在同一行上输入）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-13T22:27:59.387

来自[EmacsWiki Aquamacs 常见问题解答](http://www.emacswiki.org/cgi-bin/wiki/AquamacsFAQ#toc7)：

> 要更改用于显示当前帧的字体，请转到字体面板。您可以使用按键 Apple-t 或通过菜单执行此操作：选项 → 显示/隐藏 → 字体面板。在那里，选择你想要的字体。
> 
> 要将当前框架的字体设为默认字体，请转到选项 → 框架外观样式。选择“使用当前样式用于 foo 模式”，其中 foo 是当前帧的模式（例如，对于文本模式，foo=text），以使用当前样式（包括字体，以及您所做的任何其他更改）框架的样式）适用于所有这种类型的文件。选择“使用当前样式作为默认样式”以将当前样式用于其主要模式未定义特殊样式的所有文件。

也有等宽字体的建议 - Monaco 或“Vera Sans Mono”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-11T10:35:21.183

这是我使用的：

```
 -apple-DejaVu_Sans_Mono-medium-normal-normal-*-12-*-*-*-m-0-iso10646-1 
```

您可以在 .emacs 文件中设置它，例如：

```
(set-default-font "-apple-DejaVu_Sans_Mono-medium-normal-normal-*-12-*-*-*-m-0-iso10646-1") 
```

您可以从[dejavu-fonts.org下载它](http://dejavu-fonts.org/wiki/index.php?title=Download)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-09-27T13:54:46.997

快进十年，对于最近的 Aquamacs，如 3.3 版，请在[https://emacs.stackexchange.com/questions/45135/change-permanently-font-size-in-aquamacs查看默认设置固定宽度的好解决方案](https://emacs.stackexchange.com/questions/45135/change-permanently-font-size-in-aquamacs)

对于那些非常不耐烦的人来说，这是相关的一点，但请投票赞成这个答案，用户@nega 在这里值得称赞

```
(when window-system
  (setq initial-frame-alist nil)   ;; Undo Aquamacs forced defaults
  (setq default-frame-alist nil)   ;; Undo Aquamacs forced defaults
  (aquamacs-autoface-mode -1)      ;; Use one face (font) everywhere
  (set-frame-font "Menlo-12")      ;; Set the default font to Menlo size 12
  ;;(set-default-font "Menlo-12")  ;; This would do the same.
) 
```

# visual-studio-2008 - IIS7 的工作进程是什么？

> ID：60918
> 
> 赞同：27
> 
> 时间：2008-09-13T22:07:21.947
> 
> 标签：visual-studio-2008, iis-7

我正在尝试在 Visual Studio 2008 中进行“附加到进程”以进行调试，但我不知道要附加到哪个进程。帮助。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-08-09T21:56:46.403

实际上它仍然是 w3wp.exe - 您需要检查“**在所有会话中显示进程**”选项才能显示它。

（它也让我感到困惑。）

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-13T22:16:05.013

不是 w3wp.exe 吗？

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-06-15T18:39:26.367

如果您正在运行多个进程，[这里有一篇用于识别 w3wp 进程的有用文章。](http://abhijitjana.net/2010/07/15/identifying-worker-process-w3wp-exe-iis-6-0-and-iis-7-0-for-debugging-asp-net-application/)

> 对于 IIS 6.0
> 
> *   开始 > 运行 > Cmd
> *   转到 Windows > System32
> *   跑`cscript iisapp.vbs`
> *   您将获得正在运行的工作进程 ID 和应用程序池名称的列表。
> 
> 从 IIS 7.0 开始，您需要运行 IIS 命令工具 (appcmd)。
> 
> *   开始 > 运行 > Cmd
> *   转到 Windows > System32 > Inetsrv
> *   跑`appcmd list wp`

# .net - SqlCommand.Dispose 是否关闭连接？

> ID：60919
> 
> 赞同：61
> 
> 时间：2008-09-13T22:10:29.537
> 
> 标签：.net, garbage-collection, dispose, sqlconnection, sqlcommand

我可以有效地使用这种方法吗？

```
using(SqlCommand cmd = new SqlCommand("GetSomething", new SqlConnection(Config.ConnectionString))
{
    cmd.Connection.Open();
    // set up parameters and CommandType to StoredProcedure etc. etc.
    cmd.ExecuteNonQuery();
} 
```

我担心的是：SqlCommand 的 Dispose 方法（退出 using 块时调用）是否会关闭底层 SqlConnection 对象？

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-09-13T22:20:59.667

不，处置`SqlCommand`不会影响连接。更好的方法是也将其包装`SqlConnection`在 using 块中：

```
using (SqlConnection conn = new SqlConnection(connstring))
{
    conn.Open();
    using (SqlCommand cmd = new SqlCommand(cmdstring, conn))
    {
        cmd.ExecuteNonQuery();
    }
} 
```

否则，连接不会因为使用它的命令被处置而改变（也许这就是你想要的？）。但请记住，连接也应该被处理掉，而且处理起来可能比命令更重要。

**编辑：**

我刚刚测试了这个：

```
SqlConnection conn = new SqlConnection(connstring);
conn.Open();

using (SqlCommand cmd = new SqlCommand("select field from table where fieldid = 1", conn))
{
    Console.WriteLine(cmd.ExecuteScalar().ToString());
}

using (SqlCommand cmd = new SqlCommand("select field from table where fieldid = 2", conn))
{
    Console.WriteLine(cmd.ExecuteScalar().ToString());
}

conn.Dispose(); 
```

第一个命令在 using 块退出时被释放。连接仍然打开并且对第二个命令有好处。

***因此，处理命令绝对不会处理它正在使用的连接。***

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-08T22:48:42.697

SqlCommand.Dispose 是不够的，因为许多 SqlCommand(s) 可以（重新）使用相同的 SqlConnection。将注意力集中在 SqlConnection 上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-01-07T20:55:54.460

很多地方都犯了这个错误，甚至是 MS 自己的文档。请记住 - 在 DB 世界中，几乎*所有*内容都由非托管资源支持，因此几乎所有内容都实现了 IDisposable。除非编译器另有说明，否则假设一个类可以。将您的命令包装在 using 中。*将您的连接*包装在 using 中。从 DbProvider 创建连接（从 DbProviderFactories.GetFactory 获取），并从连接中创建命令，这样如果您更改底层数据库，只需更改对 DBPF.GetFactory 的调用。因此，您的代码最终应该看起来漂亮且对称：

```
var provider = DbProviderFactories.GetFactory("System.Data.SqlClient");// Or MS.Data.SqlClient
using (var connection = provider.CreateConnection())
{
    connection.ConnectionString = "...";
    using (var command = connection.CreateCommand())
    {
        command.CommandText = "...";
        connection.Open();

        using (var reader = command.ExecuteReader())
        {
...
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：-12
> 
> 时间：2011-04-13T18:52:08.473

我使用这种模式。我在我的应用程序的某个地方有这个私有方法：

```
private void DisposeCommand(SqlCommand cmd)
{
    try
    {
        if (cmd != null)
        {
            if (cmd.Connection != null)
            {
                cmd.Connection.Close();
                cmd.Connection.Dispose();
            }
            cmd.Dispose();
        }
    }
    catch { } //don't blow up
} 
```

然后我总是在 try 块中创建 SQL 命令和连接（但没有被包装在 using 块中）并且总是有一个 finally 块：

```
 finally
    {
        DisposeCommand(cmd);
    } 
```

作为命令对象的属性的连接对象在这种情况下使 using 块很尴尬 - 但是这种模式可以完成工作而不会弄乱你的代码。

# sql-server - DB Audit Trail 的最佳实施是什么？

> ID：60920
> 
> 赞同：3
> 
> 时间：2008-09-13T22:10:40.037
> 
> 标签：sql-server, audit

数据库审计跟踪捕获用户上次修改、修改日期和创建日期。

有几种可能的实现方式：

*   SQL Server 触发器
*   将 UserModified、ModifiedDate、CreatedDate 列添加到数据库，并在存储过程或 Insert、Update 语句中相应地包含逻辑。

如果您在答案中包含实现（或链接），那就太好了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-13T22:14:19.840

根据您正在执行的操作，您可能希望将审计从数据层移到数据访问层。它给你更多的控制权。

[我在这里](https://stackoverflow.com/questions/15917/data-auditing-in-nhibernate-and-sqlserver)问了一个与 NHibernate 和 SqlServer 类似的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T23:30:02.730

我完全支持@IainMH（并投票支持他）。

您希望将它放在您的 DAL 中，并理想地与某种方面/拦截器/代码注入机制相关联。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T23:41:31.940

+2 用于在 DAL 中实施**何时/如何**进行审计。

至于审计条目本身应该放在哪里，这取决于它的可见性。如果用户可以查看单独的“审计跟踪报告”，我会创建一个单独的表，但如果您想内联显示最后修改类型的审计，请标记现有表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T13:04:47.873

这是我用来审计表的实现： [Pop Rivett 的 SQL Server FAQ No.5: Pop on the Audit Trail](http://www.simple-talk.com/sql/database-administration/pop-rivetts-sql-server-faq-no.5-pop-on-the-audit-trail/)

# methodology - 方法论和生命周期的真实示例

> ID：60932
> 
> 赞同：5
> 
> 时间：2008-09-13T22:19:34.693
> 
> 标签：methodology

选择正确的生命周期和方法论并不像以前那样容易，当时没有那么多方法论，现在每天都会出现一个新的方法。

我发现大多数项目都需要一定程度的进化，而且每个项目都与其他项目不同。这样，极限编程适用于拥有 15 名员工的给定公司的项目，但不适用于 100 名员工的公司，或者不适用于给定的项目类型（例如实时应用程序、科学应用程序等） .

我想要一份经验清单，主要说明项目类型、项目规模（参与项目的人数）、项目时间（实际的或计划的）、项目生命周期和方法以及项目是成功还是失败. 任何其他数据将不胜感激，我认为如果有足够的数据，我们可能会找到一些模式。当然，欢迎评论。

*   PS：非常大，PT：非常长，LC：增量-CMMI，PR：成功
*   PS：非常大，PT：很长，LC：瀑布-CMMI，PR：成功

**编辑：**我将用所有答案的统计信息构建一个“摘要”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-13T22:29:04.063

我的个人经历：

*   项目规模：非常大（150+人）
*   项目时间：很长（+6 年）
*   项目收入（预计）：4000万美元（军方正在支付）
*   项目生命周期：增量生命周期。每年的主要里程碑。
*   项目结构：一开始是传统的（系统部门、开发部门等）不太好。后期基于流程（流程建立工作流、需求、设计、实施、测试、反馈、指标）：到目前为止相当好。
*   项目结果：成功（到目前为止）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T22:49:45.153

干得好：

*   项目规模：约100万行代码，30人
*   项目时间：9年
*   项目生命周期：良好的老瀑布，由于大客户的需求，但交错交付给 QA 团队 - 当您有客户对大客户的承诺时，很难保持敏捷
*   项目结构：我们按部门组织，但我们使用 CMMI 使它们保持同步——我们有利益相关者、工作产品、偏差程序等。
*   项目结果：我们确实通过实施 CMMI 得到了改进，并且每次都按时交付了我们最近的几个版本

-C。

# project-management - 启动项目的最佳方式

> ID：60939
> 
> 赞同：24
> 
> 时间：2008-09-13T22:27:38.247
> 
> 标签：project-management, projects, project-planning

当你开始一个个人编程项目时，你的第一步是什么？我正在尝试启动一个目前只是一个想法的项目。我得到了很多这些，然后我直接进入代码，过了一段时间就完全失去了兴趣，或者只是忘记了这个项目。

当你开始时，你的第一步是什么？你计划好这个项目了吗？做个图表？在纸上写一些代码？你如何以你知道你会成功的方式开始一个项目？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-13T22:52:26.457

唯一对我有用的是：创建它的最小可能实现，它以某种方式可用，然后使用它。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-13T23:01:00.150

来自[高效能人士的 7 个习惯](http://en.wikipedia.org/wiki/The_Seven_Habits_of_Highly_Effective_People)，习惯 2：以终为始。

对于任何项目，您都需要一个明确的目标，一个可以说“我完成了”的点。明确的结果会给你指明方向。一旦你有了它，你就可以开始计划如何到达那里。项目的规模和复杂性将决定您的计划需要多少细节，但一般来说，您会希望定期感受到您的计划取得的进展。

我的下一步是勾勒出所需模块的设计以及每个模块之间的 API。如果 API 是干净的，那么模块可能是正确的。然后我开始实现模块，边做边测试。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-13T22:42:20.990

在我触摸键盘之前，我花了很多时间思考项目的各个方面。

我回顾了我从以前的项目中学到的东西，并将其写在不同的类别中（“技术”、“促销”等）

个人项目与否，我总是设置源代码控制。Git、Mercurial of Bazaar 是源代码控制工具的示例，它们不是侵入性的，因为您不需要设置主服务器。只需键入一个简单的命令来创建项目，签入文件，提交。将来，当您弄乱某个文件时，您将能够“撤消”

我还建立了一个轻量级的票证系统来跟踪 1.issues 和 2.ideas “轻量级”我的意思是，如果使用这些列表维护两个文本文档对您有用，那就足够了。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-14T08:20:45.780

我同意已经给出的建议：

*   计划一个最小的实现，作为第一个完整版本做一些有用的事情。
*   对您想要实现的目标有具体的目标，以便与您的进度进行比较。

我还建议您从整体**架构**的轻量级设计开始，这样您就可以获得如何构建产品的*路线图。*

当我对至少在第一级分解时的外观没有清晰的概念时，我发现很难开始构建一些东西。想想除了功能之外您还需要什么：高性能？、可扩展性场景？、哪些？、可用性目标？、高可扩展性？、易于部署和可安装性？等等。问问自己：我必须按顺序构建哪些组件达到那些建筑品质？

不要误会我的意思，我是敏捷软件开发的坚定支持者。你不需要花很多时间来设计你的架构（因为它肯定会随着你的构建而发展，并获得关于哪些有效和哪些无效的反馈），但是**有一个如何构建你的产品的蓝图基于它的架构**应该有助于计划您的进度和**设定现实的目标**。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-17T10:13:08.540

定义项目的目标。听起来您几乎只关注解决方案而不是问题。

一个程序对你或其他任何人都没有用，除非它解决了一些问题。编写代码以开始行动固然很棒，但是在开始之后您似乎失去了兴趣和注意力——因为您正在查看代码，而不是问题。

花一些时间考虑是什么导致您编写此代码。思考其他人如何发现同样的需求，什么样的路径可能会让他们遇到你努力解决的同样的挫败感。

然后，找到其中一些人并提供您的（部分）解决方案，您将在他们之间产生兴趣和建议。

THAT will keep you going on your project. The fellow interest, the sharing, even the disagreements -- it's people who need software! Don't create solutions (software) looking for a problem (people). You started with YOU, with your need or desire, but focused on the code, and lost the impetus for the project.

Programming's a lot more fun when you're problem-solving. But you need to keep the problem in front of you. Sharing the problem builds community. That's what this is really all about, isn't it?

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-13T22:31:49.813

对于我自己的个人项目，我只是直接投入其中。当然，这些项目都还没有大到需要任何形式的预先计划。如果这将是一个严肃的项目或规模相对较大的项目，那么至少清除程序的每个部分需要做什么以及他们将如何做的高级视图总是一个好主意。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-14T01:28:04.273

和其他人一样，我的个人项目总是有：

*   最终目标
*   任务列表
*   小可用单位
*   源代码控制

作为额外的动力，我尝试使用我以前从未使用过的技术。学习新事物通常成为我最大的动力。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-14T05:22:15.550

容易——不要从你可能会失去兴趣的所有项目开始。在开始任何工作之前，花更多的时间来确保你想致力于一个想法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-13T23:35:53.997

这取决于项目 - 它有多大？

如果我正在编写下一个记事本克隆，我可能会一头扎进，如果我想推出自己的操作系统，则需要更多的非编码工作。

我喜欢做很多图表，我用于大多数开发的工具是干净的 A4 纸和一支铅笔。画出 UI、工作流程、基本类以及您将如何存储任何数据 - 然后编码只是一种计算机可读的方式来编写您已经绘制的内容。

源代码控制法 SVN 是几次击键/点击，因此开销很低，收益很高，尝试一些东西很方便，如果它们不起作用，就恢复到早期状态。

然后只需制作可以工作的最基本的原型 - 一旦实际进行某些事情，就更容易获得热情并添加更多内容。如果它是压倒性的，我会发现我认为问题已经在我的脑海中解决了，这就足够了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-13T23:00:53.613

首先规划出最终申请的基本大纲。最重要的功能，基本的 GUI，程序流程等。然后对其进行优化，以便您一开始不会承担太多，删除不必要的功能，并在第一个版本中添加您想要的其他内容。然后使用该大纲启动任务列表，以创建应用程序的最小可能工作版本。然后更容易添加额外的功能并使其充分发挥作用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-14T00:36:32.370

我喜欢马克西米利安的回答..扩展一点，我的个人项目是为了解决我已经在做的事情而开发的。所以当我厌倦了重复的工作时，我会设计一个解决方案的原型。然后使用它。如果它与我早期的项目之一足够相似，我将尽可能多地借用代码并尝试提高我的工作水平，使其更专业。

Fusion 对源代码控制的使用也很重要。安装 SVN 需要 2 分钟。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-14T01:41:29.153

如果你想把它变成一个公共的开源项目，[Producing Open Source Software](http://producingoss.com/)应该是一本不错的读物（在线和印刷版都可以）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-14T11:59:41.697

如果您的个人项目类似于现有的开源项目，您应该考虑为该项目做出贡献。一些小的贡献（错误修复等）比完成一半的项目更有价值。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-03-24T12:40:58.853

All of the above, but start to cement the plan in place.....

Go for some tools SmartSheet - even if you are working on your own you should set out some stages and dates yEd - and Graphity from www.yworks.com

# windows - 如何使用 Unix（或 Windows）中的（最好是未命名的）管道将一个进程的标准输出发送到多个进程？

> ID：60942
> 
> 赞同：83
> 
> 时间：2008-09-13T22:28:36.590
> 
> 标签：windows, bash, unix, shell, pipe

我想将进程 proc1 的标准输出重定向到两个进程 proc2 和 proc3：

```
 proc2 -> stdout
       /
 proc1
       \ 
         proc3 -> stdout 
```

我试过

```
 proc1 | (proc2 & proc3) 
```

但它似乎不起作用，即

```
 echo 123 | (tr 1 a & tr 1 b) 
```

写

```
 b23 
```

到标准输出而不是

```
 a23
 b23 
```

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2008-09-13T22:37:53.527

^(*编者注*：
-`>(…)`是一个[*进程替换*](http://mywiki.wooledge.org/ProcessSubstitution)，它是*一些*POSIX 兼容 shell的*非标准 shell 功能*： , , . *- 这个答案也意外地通过管道发送了* 输出过程替换的输出：。 - 进程替换的输出将不可预测地交错，并且，除了在 中，管道可能会在内部命令执行之前终止。*`bash``ksh``zsh`
*`echo 123 | tee >(tr 1 a) | tr 1 b`
`zsh``>(…)`**)

 **在 unix（或 mac）中，使用[`tee`命令](http://en.wikipedia.org/wiki/Tee_(command))：

```
$ echo 123 | tee >(tr 1 a) >(tr 1 b) >/dev/null
b23
a23 
```

通常您会使用`tee`将输出重定向到多个文件，但使用 >(...) 您可以重定向到另一个进程。所以，一般来说，

```
$ proc1 | tee >(proc2) ... >(procN-1) >(procN) >/dev/null 
```

会做你想做的。

在 windows 下，我认为内置的 shell 没有等价物。微软的[Windows PowerShell](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)有一个`tee`命令。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-10T10:43:40.147

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2017-05-11T04:51:11.043

### Unix (`bash`, `ksh`, `zsh`)

[dF.'s answer](https://stackoverflow.com/q/60942/45375) contains the *seed* of an answer based on `tee` and *output* [process substitutions](http://mywiki.wooledge.org/ProcessSubstitution)
(`>(...)`) that *may or may not* work, depending on your requirements:

^(Note that process substitutions are a *nonstandard* feature that (mostly) POSIX-features-only shells such as `dash` (which acts as `/bin/sh` on Ubuntu, for instance), do *not* support. Shell scripts targeting `/bin/sh` should *not* rely on them.)

```
echo 123 | tee >(tr 1 a) >(tr 1 b) >/dev/null 
```

The **pitfalls** of this approach are:

*   **unpredictable, asynchronous output behavior**: the output streams from the commands inside the output process substitutions `>(...)` interleave in unpredictable ways.

*   In `bash` and `ksh` (as opposed to `zsh` - but see exception below):

    *   **output may arrive *after* the command has finished.**
    *   **subsequent commands may start executing *before* the commands in the process substitutions have finished** - `bash` and `ksh` do *not* wait for the output process substitution-spawned processes to finish, at least by default.
    *   [jmb](https://stackoverflow.com/users/173250/jmb) puts it well in a comment on dF.'s answer:

> be aware that the commands started inside `>(...)` are dissociated from the original shell, and you can't easily determine when they finish; the `tee` will finish after writing everything, but the substituted processes will still be consuming the data from various buffers in the kernel and file I/O, plus whatever time is taken by their internal handling of data. You can encounter race conditions if your outer shell then goes on to rely on anything produced by the sub-processes.

*   **`zsh`** is the only shell that ***does* by default wait for the processes run in the output process substitutions to finish**, *except* if it is *stderr* that is redirected to one (`2> >(...)`).

*   **`ksh`** (at least as of version `93u+`) allows use of argument-less `wait` to wait for the output process substitution-spawned processes to finish.
    Note that in an interactive session that could result in waiting for any pending *background jobs* too, however.

*   **`bash v4.4+`** can wait for the *most recently* launched output process substitution with `wait $!`, but argument-less `wait` does *not* work, making this unsuitable for a command with *multiple* output process substitutions.

*   However, **`bash` and `ksh` can be *forced* to wait** by piping the command to **`| cat`**, but note that this makes the command run in a *subshell*. *Caveats*:

    *   `ksh` (as of `ksh 93u+`) doesn't support sending *stderr* to an output process substitution (`2> >(...)`); such an attempt is *silently ignored*.

    *   While `zsh` is (commendably) synchronous *by default* with the (far more common) *stdout* output process substitutions, even the `| cat` technique cannot make them synchronous with *stderr* output process substitutions (`2> >(...)`).

*   However, **even if you ensure *synchronous execution*, the problem of *unpredictably interleaved output* remains.**

The following command, when run in `bash` or `ksh`, illustrates the problematic behaviors (you may have to run it several times to see *both* symptoms): The `AFTER` will typically print *before* output from the output substitutions, and the output from the latter can be interleaved unpredictably.

```
printf 'line %s\n' {1..30} | tee >(cat -n) >(cat -n) >/dev/null; echo AFTER 
```

**In short**:

*   Guaranteeing a particular per-command output sequence:

    *   Neither `bash` nor `ksh` nor `zsh` support that.
*   Synchronous execution:

    *   Doable, except with *stderr*-sourced output process substitutions:
        *   In `zsh`, they're *invariably* asynchronous.
        *   In `ksh`, they *don't work at all*.

If you can live with these limitations, using output process substitutions is a viable option (e.g., if all of them write to separate output files).

* * *

Note that **[tzot's much more cumbersome, but potentially POSIX-compliant solution](https://stackoverflow.com/a/190777/45375) also exhibits unpredictable output behavior**; however, by using `wait` you can ensure that subsequent commands do not start executing until all background processes have finished.
**See bottom** for **a more robust, synchronous, serialized-output implementation**.

* * *

**The only *straightforward* `bash` solution *with predictable output behavior*** is the following, which, however, is **prohibitively slow with large input sets**, because shell loops are inherently slow.
Also note that this ***alternates* the output lines from the target commands**.

```
while IFS= read -r line; do 
  tr 1 a <<<"$line"
  tr 1 b <<<"$line"
done < <(echo '123') 
```

* * *

### Unix (using GNU Parallel)

Installing [GNU `parallel`](https://www.gnu.org/software/parallel/) enables a **robust solution** with **serialized (per-command) output** that additionally allows **parallel execution**:

```
$ echo '123' | parallel --pipe --tee {} ::: 'tr 1 a' 'tr 1 b'
a23
b23 
```

`parallel` by default ensures that output from the different commands doesn't interleave (this behavior can be modified - see `man parallel`).

^(Note: Some Linux distros come with a *different* `parallel` utility, which won't work with the command above; use `parallel --version` to determine which one, if any, you have.)

* * *

### Windows

[Jay Bazuzi's helpful answer](https://stackoverflow.com/a/61716/45375) shows how to do it in **PowerShell**. That said: his answer is the analog of the looping `bash` answer above, it will be **prohibitively slow with large input sets** and also ***alternates* the output lines from the target commands**.

* * *

* * *

### `bash`-based, but otherwise portable Unix solution with synchronous execution and output serialization

The following is a simple, but reasonably robust implementation of the approach presented in [tzot's answer](https://stackoverflow.com/a/190777/45375) that additionally provides:

*   synchronous execution
*   serialized (grouped) output

While not strictly POSIX compliant, because it is a `bash` script, it should be **portable to any Unix platform that has `bash`**.

Note: You can find a more full-fledged implementation released under the MIT license in [this Gist](https://gist.github.com/mklement0/a9ca81f1d4e170fc1544706147663f64).

If you save the code below as script `fanout`, make it executable and put int your `PATH`, the command from the question would work as follows:

```
$ echo 123 | fanout 'tr 1 a' 'tr 1 b'
# tr 1 a
a23
# tr 1 b
b23 
```

**`fanout` script source code**:

```
#!/usr/bin/env bash

# The commands to pipe to, passed as a single string each.
aCmds=( "$@" )

# Create a temp. directory to hold all FIFOs and captured output.
tmpDir="${TMPDIR:-/tmp}/$kTHIS_NAME-$$-$(date +%s)-$RANDOM"
mkdir "$tmpDir" || exit
# Set up a trap that automatically removes the temp dir. when this script
# exits.
trap 'rm -rf "$tmpDir"' EXIT 

# Determine the number padding for the sequential FIFO / output-capture names, 
# so that *alphabetic* sorting, as done by *globbing* is equivalent to
# *numerical* sorting.
maxNdx=$(( $# - 1 ))
fmtString="%0${#maxNdx}d"

# Create the FIFO and output-capture filename arrays
aFifos=() aOutFiles=()
for (( i = 0; i <= maxNdx; ++i )); do
  printf -v suffix "$fmtString" $i
  aFifos[i]="$tmpDir/fifo-$suffix"
  aOutFiles[i]="$tmpDir/out-$suffix"
done

# Create the FIFOs.
mkfifo "${aFifos[@]}" || exit

# Start all commands in the background, each reading from a dedicated FIFO.
for (( i = 0; i <= maxNdx; ++i )); do
  fifo=${aFifos[i]}
  outFile=${aOutFiles[i]}
  cmd=${aCmds[i]}
  printf '# %s\n' "$cmd" > "$outFile"
  eval "$cmd" < "$fifo" >> "$outFile" &
done

# Now tee stdin to all FIFOs.
tee "${aFifos[@]}" >/dev/null || exit

# Wait for all background processes to finish.
wait

# Print all captured stdout output, grouped by target command, in sequences.
cat "${aOutFiles[@]}" 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-14T23:16:45.080

由于@dF: 提到 PowerShell 有 tee，我想我会展示一种在 PowerShell 中执行此操作的方法。

```
PS > "123" | % { 
    $_.Replace( "1", "a"), 
    $_.Replace( "2", "b" ) 
}

a23
1b3 
```

请注意，从第一个命令出来的每个对象都会在创建下一个对象之前进行处理。这可以允许缩放到非常大的输入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-06-04T06:37:01.980

You can also save the output in a variable and use that for the other processes:

```
out=$(proc1); echo "$out" | proc2; echo "$out" | proc3 
```

However, that works only if

1.  `proc1` terminates at some point :-)
2.  `proc1` doesn't produce too much output (don't know what the limits are there but it's probably your RAM)

But it is easy to remember and leaves you with more options on the output you get from the processes you spawned there, e. g.:

```
out=$(proc1); echo $(echo "$out" | proc2) / $(echo "$out" | proc3) | bc 
```

I had difficulties doing something like that with the `| tee >(proc2) >(proc3) >/dev/null` approach.

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-05-14T11:23:48.783

another way to do would be,

```
 eval `echo '&& echo 123 |'{'tr 1 a','tr 1 b'} | sed -n 's/^&&//gp'` 
```

output:

```
a23
b23 
```

no need to create a subshell here

# javascript - 灵活/流畅的 HTML 表单的 CSS 秘诀是什么？

> ID：60944
> 
> 赞同：0
> 
> 时间：2008-09-13T22:29:57.213
> 
> 标签：javascript, jquery, html, css

下面的 HTML/CSS/Javascript (jQuery) 代码显示了`#makes`选择框。选择一个选项会显示`#models`带有相关选项的选择框。`#makes`选择框偏离中心，选择`#models`框在显示时填充空白区域。

您如何设置表单样式，以便`#makes`选择框在它是唯一显示的表单元素时居中，但是当显示两个选择框时，它们都在容器内居中？

```
var cars = [
  {
    "makes"  : "Honda",
    "models"  : ['Accord','CRV','Pilot']
  }, 
  {
    "makes"   :"Toyota",
    "models"  : ['Prius','Camry','Corolla']
  }
];

$(function() {
  vehicles = [] ;
  for(var i = 0; i < cars.length; i++) {
    vehicles[cars[i].makes] = cars[i].models ;
  }
  var options = '';
  for (var i = 0; i < cars.length; i++) {
    options += '<option value="' + cars[i].makes + '">' + cars[i].makes + '</option>';
  }
  $("#make").html(options);   // populate select box with array

  $("#make").bind("click", function() {
    $("#model").children().remove() ;   // clear select box
    var options = '';
    for (var i = 0; i < vehicles[this.value].length; i++) {
      options += '<option value="' + vehicles[this.value][i] + '">' +
        vehicles[this.value][i] +
        '</option>';
    }
    $("#model").html(options);   // populate select box with array
    $("#models").addClass("show");
  });     // bind end
});
```

```
.hide {
  display: none;
}
.show {
  display: inline;
}
fieldset {
  border: #206ba4 1px solid;
}
fieldset legend {
  margin-top: -.4em;
  font-size: 20px;
  font-weight: bold;
  color: #206ba4;
}
fieldset fieldset {
  position: relative;
  margin-top: 25px;
  padding-top: .75em;
  background-color: #ebf4fa;
}
body {
  margin: 0;
  padding: 0;
  font-family: Verdana;
  font-size: 12px;
  text-align: center;
}
#wrapper {
  margin: 40px auto 0;
}
#myFieldset {
  width: 213px;
}
#area {
  margin: 20px;
}
#area select {
  width: 75px;
  float: left;
}
#area label {
  display: block;
  font-size: 1.1em;
  font-weight: bold;
  color: #000;
}
#area #selection {
  display: block;
}
#makes {
  margin: 5px;
}
#models {
  margin: 5px;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>

<div id="wrapper">
  <fieldset id="myFieldset">
    <legend>Cars</legend>
    <fieldset id="area">
      <label>Select Make:</label>
      <div id="selection">
        <div id="makes">
          <select id="make"size="2"></select>
        </div>
        <div class="hide" id="models">
          <select id="model" size="3"></select>
        </div>
      </div>
    </fieldset>
  </fieldset>
</div>
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-14T00:46:57.990

您的问题并不完全清楚您要实现什么布局，但从您已将“float：left”应用于选择元素的事实来看，您似乎希望选择元素并排出现。如果是这种情况，您可以通过执行以下操作来实现：

*   要居中对齐元素，您需要将“text-align:center”添加到包含块级元素，在本例中为#selection。
*   浮动元素的位置不受“text-align”声明的影响，因此从选择元素中删除“float:left”声明。
*   为了让#make 和#model div 并排放置而不使用浮动，它们必须显示为内联元素，因此在#make 和#model 中添加“display:inline”（注意这将丢失这些元素的垂直边距，因此您可能需要进行一些其他更改才能获得所需的确切布局）。

由于选择元素默认内联显示，最后一步的替代方法是删除#make 和#model div，并将“show”和“hide”类直接应用于模型选择元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-14T00:13:19.773

浮动选择框将其显示属性更改为“块”。如果您没有理由浮动它们，只需删除“float：left”声明，并将“text-align：center”添加到#makes 和#models。

# windows - 有更好的 Windows 控制台窗口吗？

> ID：60950
> 
> 赞同：316
> 
> 时间：2008-09-13T22:33:26.313
> 
> 标签：windows, command-line, console, terminal, command-line-interface

我发现在 Windows 中使用命令行令人沮丧，主要是因为与 linux 和 OS X 上的终端应用程序（例如“rxvt”、“xterm”或“Terminal”）相比，控制台窗口使用起来很糟糕。主要投诉：

1.  没有标准的复制/粘贴。您必须打开“标记”模式，并且它只能从（小）左手角按钮触发的多级弹出窗口中使用。然后需要从同一个菜单调用复制和粘贴

2.  不能通过拖动任意调整窗口大小，每次要调整窗口大小时都需要设置一个首选项（回到多级弹出窗口）

3.  您只能在水平滚动条进入画面之前使窗口变大。水平滚动条很烂。

4.  使用 cmd.exe shell，您无法导航到带有 \\netpath 表示法 (UNC?) 的文件夹，您需要映射网络驱动器。在将映射不同驱动器的多台机器上工作时，这很糟糕

是否有任何技巧或应用程序（付费或其他方式）可以解决这些问题？

* * *

## 回答 #1

> 赞同：290
> 
> 时间：2012-06-05T20:32:22.557

对不起自我推销，我是另一个控制台模拟器的作者，这里没有提到。

[ConEmu](http://www.fosshub.com/ConEmu.html)是带有选项卡的开源控制台模拟器，它将多个控制台和简单的 GUI 应用程序表示为一个可自定义的 GUI 窗口。

最初，该程序旨在与[Far Manager](http://www.farmanager.com/)（我最喜欢的 shell 替换 - 文件和存档管理、命令历史记录和完成、强大的编辑器）一起使用。但是 ConEmu 可以与任何其他控制台应用程序或简单的 GUI 工具（例如 PuTTY）一起使用。ConEmu 是一个实时项目，欢迎提出建议。

一长串选项的简短摘录：

*   最新版本的 ConEmu 可能会将自己[设置为 Windows 的默认终端](https://superuser.com/a/509710/139371)
*   使用系统中安装的任何字体，或复制到程序的文件夹（ttf、otf、fon、bdf）
*   以管理员 (Vista+) 或选定用户身份运行选定的选项卡
*   Windows 7 任务栏上的跳转列表和进度
*   与[DosBox](http://www.dosbox.com/)集成（在 64 位系统中用于运行 DOS 应用程序）
*   平滑调整大小、最大化和全屏窗口模式
*   滚动条最初是隐藏的，可以通过鼠标悬停或设置中的复选框显示
*   选定应用程序的可选设置（例如调色板）
*   用户友好的文本和块选择（从键盘或鼠标）、复制、粘贴、控制台中的文本搜索
*   ANSI X3.64 和 Xterm 256 颜色

Far Manager 用户将获得外壳样式的拖放、面板中的缩略图和图块、编辑器和查看器的选项卡、真实颜色和字体样式（斜体/粗体/下划线）。

PS。Far Manager 支持 UNC 路径 (\\server\share\...)

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2008-09-13T22:36:33.157

尝试[控制台 2](http://sourceforge.net/projects/console/)。

> *Console 是 Windows 控制台窗口增强功能。*控制台功能包括：多个选项卡、类似文本编辑器的文本选择、不同的背景类型、alpha 和颜色键透明度、可配置的字体、不同的窗口样式

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-09-13T22:37:59.253

[接受指挥](http://www.jpsoft.com/)。这个已经存在了很长时间（以前是 4DOS）。我在 Windows NT 3.5 (!) 上使用了它并且喜欢它。

[Cygwin](http://www.cygwin.com/)允许您在 Windows 上运行 X，因此您可以启动`xterm`或启动您喜欢的任何终端应用程序，并且还可以获得使用 UNIX shell 的好处。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-14T01:28:35.537

1.  打开快速编辑模式（但选择仍然是矩形而不是换行）
2.  通过拖动调整大小对我有用
3.  您可以更改将影响滚动条出现时的缓冲区大小
4.  推送\\服务器\共享

即使有这些，cmd.exe 也不是一个很好的控制台。查看关于同一主题的所有其他回复和早期的 stackoverflow 问题。sourceforge 的“控制台”项目看起来很不错。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-13T22:43:18.053

[安慰](http://sourceforge.net/projects/console "Windows 控制台增强")

从文档：

> 注意：控制台不是外壳。因此，它没有实现命令行补全、语法着色、命令历史记录等 shell 功能。
> 
> 控制台只是您选择的外壳（cmd.exe、4NT、bash 等）的漂亮前端。控制台也可以将其他命令行实用程序用作“外壳”。

作为一个编程外壳，可以使用[ipython](http://ipython.scipy.org/)。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-13T22:42:57.680

我在 Windows 上也遇到了这些问题多年，但我最近发现了这个项目： [控制台](http://sourceforge.net/projects/console/ "安慰")

它仍然需要“标记模式”来复制/粘贴，但至少它可以从右键单击上下文菜单中获得（因此您无需将鼠标移动到左上角然后再次将其移动到您想要的文本选择）

cmd.exe 不支持 UNC 路径，但 PowerShell 支持它们。（控制台可以配置为使用任何 shell，包括 cmd.exe 和 PowerShell）

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-13T23:36:11.343

我在[Poderosa](http://poderosa.sourceforge.net/)终端仿真器中使用[Cygwin 。](http://www.cygwin.com)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-12-13T16:51:42.833

我个人使用薄荷糖。因此我使用 Cygwin（因为据我所知，这是它支持的唯一 shell）。

顺便说一句，还有另一个问题：[Windows 更好的命令？](https://stackoverflow.com/questions/10083/better-command-for-windows)我发现。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-02-14T12:35:58.640

我想你会喜欢 PowerCMD，它可以同时工作 4 个命令窗口。此外，您可以在 PowerCMD 中使用许多额外的命令。 [PowerCMD](http://www.powercmd.com/)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-05-27T08:56:44.083

使用**Gow.exe** .. 这将使您的**DOS 提示符**成为**Linux 终端**...

别的

使用**ZOC.exe** ...它的试用期终端...

别的

安装**Git** .. 它提供了一个 bash 控制台，您可以在其中部分使用 unix 命令

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-10-17T21:09:54.123

github上有一个小程序**mo.exe**，解决了前三个问题： [https ://github.com/boolship/Mo](https://github.com/boolship/Mo)

它在普通的 DOS 控制台窗口、Windows 上的 Git Bash 等中运行。

### 更新：

该链接现已弃用，请使用：[https ://github.com/boolship/MoDi](https://github.com/boolship/MoDi)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-13T22:37:50.377

看看[Take Command](http://www.jpsoft.com)。

> Take Command 是一个全面的交互式 GUI 和命令行环境，它使使用 Windows 命令提示符和创建批处理文件变得容易且功能更强大。

（但是，Take Command 是“不免费的”。）

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-13T23:24:11.963

我正在使用终端通过 Telnet、RDC、SSH 进行远程连接……在一个程序中结合了最常用的协议。

网址： http: [//www.codeplex.com/Terminals](http://www.codeplex.com/Terminals)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-10T01:10:31.020

为什么不使用腻子？

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-08-24T17:04:17.867

我使用来自 cygwin 的 rxvt。它的行为非常像 xterm。

# x11 - 如何在 X11 中跟踪相关窗口？

> ID：60967
> 
> 赞同：1
> 
> 时间：2008-09-13T22:59:54.300
> 
> 标签：x11

不幸的是，我的问题并不像跟踪由同一进程创建的两个窗口那么简单。

这是我所拥有的：

*   两个用户 Jack 和 Jim 远程登录到同一个 Unix 系统并运行 X 服务器
*   Jack 运行一个应用程序“AwesomeApp”，它在 X 窗口中打开一个 GUI
*   Jim 运行该应用程序的另一个实例，打开他自己的 GUI 窗口
*   现在，Jack 运行一个主管应用程序，该应用程序将与拥有第一个窗口（例如“AwesomeApp”）的进程进行通信，因为它是“AwesomeApp”的 HIS 实例
*   他的主管实例如何找到“AwesomeApp”窗口的哪个实例是他自己的？

* * *

Aaaahhhh ...在每个用户的基础上查找它是可以工作的。只要我告诉用户他们不能从两个不同的地方使用同一个用户帐户登录。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-14T05:19:11.613

您可以使用[pgrep](http://en.wikipedia.org/wiki/Pgrep)获取 Jack 的 AwesomeApp 实例的进程 ID：

```
pgrep -u Jack AwesomeApp 
```

因此，如果您从 shell 脚本启动主管应用程序，您可以执行以下操作：

```
AWESOME_ID=`pgrep -u $USER AwesomeApp 2>/dev/null`

# run the supervisor application and pass the process id as the argument
supervisor $AWESOME_ID 
```

或者，如果您不想使用 pgrep 或[ps](http://en.wikipedia.org/wiki/Ps_(Unix))等外部程序，您可以随时尝试直接在[/proc中查找进程。](http://en.wikipedia.org/wiki/Procfs)

# sql - 如何从 EDM 创建数据库？

> ID：60972
> 
> 赞同：2
> 
> 时间：2008-09-13T23:14:51.380
> 
> 标签：sql, entity-framework, ado.net

如何从实体数据模型创建数据库。

所以我在 VisualStudio 2008 中使用 EDM Designer 创建了一个数据库，现在我想生成 SQL Server Schema 以在 SQL Server 中创建存储。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-14T12:43:59.733

据我了解，您不仅应该将 EDM 用作“漂亮”的数据库设计器，实际上 EDM 并不依赖于特定的存储层。它试图为开发人员抽象出这部分。有设计模式（CSDL）和存储模式（SSDL）。总之，不是要教训你。;)

有[EDM Generator](http://msdn.microsoft.com/en-us/library/bb387165.aspx)，您可以使用它来创建模型和类等。对于 DDL 类型的导出，我从未这样做过，但我所做的是将我的 EDM 映射到现有数据库，这对我来说更容易获得开始了。

MSDN 上有一个很棒的教程，其中详细介绍了如何使用现有数据库的分步说明，还涉及如何从头开始的方法。

[http://msdn.microsoft.com/en-us/magazine/cc163286.aspx](http://msdn.microsoft.com/en-us/magazine/cc163286.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T13:44:28.050

“从模型生成数据库模式”功能计划在实体框架的未来版本中使用。V1 不支持基于 EF 模型的模式生成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T18:46:17.717

我相信其他答案暗示了这一点，但只是为了明确 - 使用 SSMS （或者如果你是一个勇敢的唯一而不使用 SQL Server 提供程序的任何等价物）来设计 DB 布局，然后将其吸入 EDM - 然后应用应用程序根据需要对模型进行更改。

我花了大约一个小时尝试先按照自己的方式去做（其他一些 Java ORM 工具的遗留习惯）——我最终放弃了，现在用“正确的方式”（tm）

最终，从模型功能中生成数据库模式会很好（正如 JRoppert 所指出的那样） - 然后您可以自动获取各种 DB 风格的 DDL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T18:53:35.360

从模型生成数据库是实体框架 vNext 计划的一项功能。查看[实体框架设计的这篇](http://blogs.msdn.com/efdesign/default.aspx)[博客文章](http://blogs.msdn.com/efdesign/archive/2008/09/10/model-first.aspx)，解释从模型生成数据库的计划功能。

您现在必须做的是 1) 手动生成数据库，或者 2) 解析 CSDL 文件并编写自己的生成器。我认为选项 1) 可能是一个更好的选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-07T23:16:49.660

在 EF 4 中可用：http: [//blogs.msdn.com/b/efdesign/archive/2008/09/10/model-first.aspx](http://blogs.msdn.com/b/efdesign/archive/2008/09/10/model-first.aspx)

# c# - 你最喜欢 asp.net 3.5 中的新功能是什么？

> ID：60973
> 
> 赞同：-1
> 
> 时间：2008-09-13T23:15:24.513
> 
> 标签：c#, asp.net

我正在将一个 asp.net 2.0 站点升级到 3.5 和 Visual Studio 2008。您建议考虑升级以使该站点受益的一件事是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-13T23:57:00.903

绝对是LINQ。很容易将其仅视为数据库访问快捷方式，但在很多情况下它都很有用：

*   LINQ to objects 是处理业务逻辑对象集合的一种非常方便的方法。
*   LINQ to XML 彻底改变了我在 C# 中处理 XML 的看法。不再需要对 XML 文档和节点的奇异集合进行痛苦的 XPath 查询。将 XML 视为数据库！
*   [随着PLINQ](http://msdn.microsoft.com/en-us/magazine/cc163329.aspx)的成熟，它可能会改变游戏规则。在优化瓶颈时，能够将其放入并并行化现有代码将是巨大的。
*   更不用说在运行数据库代码之前获得代码完成和语法指示。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-14T00:33:15.433

AJAX 启用了 WCF 服务。在 WCF 的 .NET 3.0 版本中启用了一些功能，但随着 .NET 3.5 的发布，它变得更加成熟。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-13T23:30:26.990

在启用 Ajax 的应用程序中，我最喜欢新的“ASP.NET AJAX 浏览器历史”。它通过使用浏览器中的前进和后退按钮为在 AJAX 应用程序中导航提供支持。

还有我非常喜欢的“ASP.NET 动态数据”。它提供了一个框架，使您能够基于 LINQ to SQL 或实体框架数据模型快速构建功能性数据驱动的应用程序。它还以智能验证的形式为 DetailsView、FormView、GridView 和 ListView 控件增加了极大的灵活性和功能，并能够使用模板轻松更改这些控件的显示。

# c++ - 重置源文件更改检测

> ID：60977
> 
> 赞同：0
> 
> 时间：2008-09-13T23:19:40.510
> 
> 标签：c++, visual-studio, svn, time, timezone

有时我必须编写使计算机时钟向前移动的代码。在这种情况下，某些 .cpp 或 .h 文件会将其最新修改日期设置为未来时间。

稍后，当我的时钟固定并编译我的源代码时，系统会重建大部分项目，因为一些最新的修改日期是在未来。随后的每次重新编译都有相同的问题。

我知道的解决方案是：

a) 找到具有未来时间的文件并重新保存。这种方法并不理想，因为项目很大，即使是 windows 高级搜索也需要时间来查找更改的文件。

b) 删除整个项目并从 svn 重新签出。

有谁知道我该如何解决这个问题？

Visual Studio 中是否有一个设置可以让我告诉编译器使用存档位而不是最后修改日期来检测源文件更改？

或者也许有一个递归修改日期重置工具可以在这种情况下使用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T00:23:33.320

我建议使用虚拟机，您可以在其中随心所欲地调整时钟，并且不会影响您的开发机器。两个免费的是Microsoft的[Virtual PC](http://www.microsoft.com/Windows/products/winfamily/virtualpc/default.mspx)和Sun的[VirtualBox 。](http://www.virtualbox.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T23:31:39.560

我不知道这是否适用于您的情况，但是您是否不将时钟向前移动，而是包装您的 gettime 方法（或您正在使用的任何方法）并使其返回您需要的未来时间？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-14T00:20:45.497

安装[Unix 实用程序](http://unxutils.sourceforge.net/)

```
touch temp
find . -newer temp -exec touch {} ;
rm temp 
```

请确保在调用 find 时使用完整路径，否则它可能会使用 Windows 的 find.exe。这在 Windows shell 中未经测试——您可能需要稍微修改语法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T03:35:23.920

如果这是我的问题，我会寻找避免与系统时间混淆的方法。隔离单元测试下的代码，或虚拟机，或其他东西。

但是，因为我喜欢[PowerShell](https://stackoverflow.com/questions/52487/the-most-amazing-pieces-of-software-in-the-world#53414)：

```
Get-ChildItem -r . | 
    ? { $_.LastWriteTime -gt ([DateTime]::Now) } | 
    Set-ItemProperty -Name "LastWriteTime" -Value ([DateTime]::Now) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-13T23:30:35.007

我不使用 windows - 但肯定有类似 awk 或 grep 的东西，您可以使用它来查找“未来”时间戳文件，然后“触摸”它们，以便它们有正确的时间 - 甚至是 perl 脚本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T18:13:02.447

1) 使用不使用时间戳来检测修改的构建系统，例如[scons](http://www.scons.org)

2) 使用[ccache](http://ccache.samba.org/)来加速使用时间戳的构建系统（并重建所有）。

无论哪种情况，它都使用 md5sum 来验证文件是否已被修改，而不是时间戳。

# powershell - 如何使用 WMI 访问非 IPM_SUBTREE 公用文件夹树？

> ID：60995
> 
> 赞同：1
> 
> 时间：2008-09-13T23:47:04.810
> 
> 标签：powershell, scripting, wmi, exchange-server

我正在尝试验证何时使用 powershell 创建新 OAB 的 OAB（脱机通讯簿）根文件夹。是否有公开此内容的 WMI 类？我正在使用 powershell，但任何示例或链接都可以。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T03:46:43.763

如果您的 Exchange 服务器是 Exchange 2007，则 PowerShell（使用 Exchange 管理单元）将能够通过运行以下命令来访问它：

```
Get-PublicFolder \NON_IPM_SUBTREE -recurse 
```

如果您的服务器是 Exchange 2003，那么您将需要混合使用 ADSI/LDAP 来查询它。如果是 Exchange 2003，请回复。********************