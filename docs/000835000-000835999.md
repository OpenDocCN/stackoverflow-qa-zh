# StackOverflow 问答 000835000-000835999

# vim - 删除 vim 中的文本“块”

> ID：835008
> 
> 赞同：2
> 
> 时间：2009-05-07T14:33:57.497
> 
> 标签：vim

我的文件如下所示：

```
>>Start-pattern
some text
some more text
>>Start-pattern
some other text

some more other text
>>Start-pattern
[and so on] 
```

我想要的是一个允许我删除当前文本“块”的映射。其中“块”定义为从“>>Start-pattern”到下一个“>>Start-pattern”行*之前*的所有行。

我所拥有的是以下内容：

```
nnoremap ,d $:?^>>Start-pattern?,/^>>Start-pattern/-1delete<CR> 
```

除非我站在文件中的最后一个“块”上，否则这是有效的。

我怎样才能让这张地图（或做同样事情的完全不同的地图）在文件中的所有“块”上工作？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T16:22:55.627

我认为，我们再次将正则表达式的界限推到了它们擅长的范围之外。他们擅长将一个字符串与另一个字符串交换，这是一个副作用，您可以使用它们删除文本。

相反，为什么不利用 vim 提供的迷人的脚本语言。它更容易，就像在回程机器上旅行。如果您将以下功能添加到您的 .vimrc 文件中，它将执行您想要的操作并且更加可重用/灵活：

```
fun! DelBlock(thePattern)
  let origLineNumber = line(".")
  let lineNumber = origLineNumber

  let lineString = getline(lineNumber)
  while lineString !~ a:thePattern
    let lineNumber = lineNumber - 1
    if lineNumber < 0
      echo "Function not found :/"
    endif
    let lineString = getline(lineNumber)
  endwhile
  let startLine = lineNumber

  let lastLineInFile = line("$")
  let lineNumber = origLineNumber + 1
  let lineString = getline(lineNumber)
  while lineNumber != lastLineInFile && lineString !~ a:thePattern
    let lineNumber = lineNumber + 1
    let lineString = getline(lineNumber)
  endwhile
  let endLine = lineNumber
  if endLine != lastLineInFile
    let endLine = endLine - 1
  end

  execute startLine.","endLine."d"
endfunction

map ,d :call DelBlock("^>>Start-pattern")<CR> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T17:45:53.760

你可以用一个正则表达式来做到这一点：

```
nnoremap ,d :1,.s/\v%(%(.*%#&(\>\>Start-pattern))%(\1@!\_.)+)\|%((\>\ >开始模式)%(\2@!\_.)*%#%(\2@!\_.)+)//
```

你是否*应该*是另一个问题......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T15:49:06.817

这是一个可能的黑客攻击。

```
nnoremap ,d maGo>>Start-pattern<Esc>'a$?^>>Start-pattern<CR>dNmaGdd'a

 ma                     - mark your current position
 G                      - go to the end of the file
 o>>Start-pattern<Esc>  - append your pattern line
 'a                     - go back to your prior position
 $                      - go to the end of the current line
 ?^>>Start-pattern<CR>  - find the previous occurrence of the pattern
 dN                     - delete until the next occurence
 ma                     - mark your current position
 G                      - go to the end of the file
 dd                     - delete the last line of the file
 'a                     - return to your previous position 
```

我最初试图让`\%$`（文件结尾）工作，但我无法删除以包含文件中的最后一个字符。所以我尝试了这种方式。

我已经做了一些测试，它似乎对我有用（中间块和最后一个块）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T08:12:18.483

非常感谢您的好答案，伙计们！

最后，我选择了最可维护/最强大的一个。基于 Whaledawg 的回答并考虑到 Luc Hermitte 的评论，我最终得到：

```
fun! DelBlock(pat)
  let startLine = search(a:pat, "nbcW")
  let endLine = search(a:pat, "nW")

  if startLine == 0
     echo "Block '".a:pat."' not found"
     return
  end

  if endLine == 0
     let endLine = line("$")
  else
     let endLine = endLine-1
  end

  execute startLine.","endLine."delete"
endfunction

nmap ,d :call DelBlock("^>>Start-pattern")<CR> 
```

# c# - 监控文件夹权限

> ID：835012
> 
> 赞同：0
> 
> 时间：2009-05-07T14:34:34.920
> 
> 标签：c#, security, file, directory, permissions

任何人都知道我们如何监控 Windows 上的文件/文件夹权限。假设用户可以更改文件夹权限，应用程序可以记录用户、时间和其他详细信息。

如果neone知道相同的第三方工具/脚本，请建议。

-谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T14:40:02.193

您将需要使用[`FileSystemWatcher`](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)该类，它可以在目录或文件的各种属性发生更改时引发事件。在您的情况下，您要确保将[`NotifyFilter`](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.notifyfilter.aspx)属性设置为包含该[`NotifyFilters.Security`](http://msdn.microsoft.com/en-us/library/system.io.notifyfilters.aspx)标志，该标志告诉您监视任何权限更改。MSDN 页面上提供了一些很好的示例代码，但`FileSystemWatcher`使用起来非常简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T14:38:39.967

启用文件系统审核，并在父文件夹上设置 SACL 以审核权限和所有权更改。它们将在系统事件日志中报告。

# winforms - Winform 内存峰值

> ID：835023
> 
> 赞同：0
> 
> 时间：2009-05-07T14:35:23.000
> 
> 标签：winforms, memory

我有以下问题。我已经为多个用户部署了一个智能客户端应用程序。除了一个之外，所有这些内存使用都足够了。对于这个特定用户，内存使用量是其他任何用户的 2 到 2 1/2 倍。桌面规格与其他用户相同。电脑不久前被整理过碎片。我想知道是否有人对为什么会发生这种情况有任何见解。任何想法表示赞赏！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T14:43:54.307

我没有答案，但有一些关于如何解决问题的想法。

1.  这个用户有什么不同？64位操作系统，windows版本，他们正在访问的数据
2.  您是否有日志记录和分析。观看/记录他们的使用情况，以便您可以“重播”它。
3.  他们是否长时间使用该应用程序（特别是比其他用户更长），您可能有正在被垃圾收集的对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T05:10:17.353

您可以使用[.NET 内存分析器](http://memprofiler.com/)来解决此类问题。它将为您提供 .NET 应用程序的内存使用情况的一个非常好的快照。

# asp.net - ASP.NET Web 表单资源和本地化的棘手问题

> ID：835027
> 
> 赞同：1
> 
> 时间：2009-05-07T14:35:43.233
> 
> 标签：asp.net, localization, webforms, globalization, aspnet-merge

我有以下非标准设置（VS2008，.NET 3.5 SP1）：

有一个名为 MainSite 的主 Web 项目，并且有几个具有不同名称的“插件”Web 项目。

在构建这些插件时，我有一个自定义构建步骤，它调用`aspnet_compiler.exe`和`aspnet_merge.exe`. 这会产生两个 .DLL 文件 - *plugin_name* .dll 和*plugin_name* _deploy.dll。第一个包含代码隐藏类，第二个包含从 .ascx 文件生成的代码。

然后将这些插件 .DLL 复制到`/MainSite/bin/Plugins/`文件夹中。在运行时（应用程序启动），MainSite 应用程序在此文件夹中查找并动态加载那里的所有 .DLL 文件。

我所有的表单都在插件中，在 .ascx 文件中。主应用程序只是一个框架，它根据需要加载这些 .ascx 用户控件。

现在需要本地化。理想情况下，我希望拥有以下内容：

*   在 Visual Studio 中制作资源时，每个表单都应该有一个单独的资源文件（.ascx 文件），以便人们更容易并行本地化表单。
*   .ascx 文件中的 nice`meta:resourcekey`方法非常适合本地化控件；
*   .NET 中的自动资源语言/文化回退机制应该可用；
*   编译的结果应该是所有插件的文件都可以复制到`/MainSite/bin/Plugins/`文件夹中。如果每种语言/文化都有一个 .DLL 文件，并且它们必须放在一些特定的子文件夹中 - 只要来自不同插件的 .DLL 没有冲突的名称，那就没问题了。

关于如何实现这一目标的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T08:48:27.380

显然可以在 .NET 中实现自定义资源提供程序。[这](http://www.west-wind.com/weblog/posts/117287.aspx)是一篇文章，其中包含解释整个过程的各种其他文章的链接。实际上，您可以`meta:resourcekey`从任何您想要的地方获取价值。例如，上面的文章将所有本地化信息存储在数据库中。

# c++ - 在 Visual Studio 2008 中显示 CR/LF 的 Visual C++ 调试窗口

> ID：835038
> 
> 赞同：5
> 
> 时间：2009-05-07T14:36:51.873
> 
> 标签：c++, visual-studio-2008, debugging, newline

一段时间以来，当我调试 Visual C++ 应用程序并在 Local、Auto 或 Watch 调试窗口中查看任何 CString 或 char*（或任何其他基于 ascii char 的类型）变量时，我的变量中的 CR/LF 字符不显示一点也不。

换句话说，如果我在代码中将字符串变量设置为“This is a line\r\nThis is another line”，调试窗口将显示“This is a lineThis is another line”。我希望它显示的是“这是一行□□这是另一行”，以​​便我可以看到该文本中的两个额外字符。

这导致我在尝试调试字符串解析代码时犯了一些错误。请注意，文本可视化器正确地将文本分成单独的行，但如果我不需要，我不想使用文本可视化器。此外，我的一些同事能够以正确的方式看到 CR/LF 字符，但我们无法确定为什么没有为我显示它们。

提前谢谢了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T04:20:00.850

[根据这个旧链接](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=100850)，这似乎是某种难以重现的错误（我也没有在 2k8 中看到它们）：

> 如果我们想正确地做到这一点，我们需要为这些字符发出正确的转义序列。例如在字符串中显示“\r\n”。剥离历史特殊字符的行为，将在未来的版本中修复。如果您正在查看带有换行符的文本，您可以将字符串视为字符数组：键入“str,100”以将长度为 100 的字符串视为数组。或者您可以单击放大镜字形并在多行编辑控件中查看字符串。

一个月以后：

> 我们无法在 VS2003 和 VS2005 上重现此问题。这看起来像是特定于机器的问题。

因此，如果您的同事真的看到了，那么我们的设置中肯定发生了一些奇怪的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T19:48:42.280

会不会是你使用的字体？你们都使用相同的（最好是默认的）字体吗？

我遇到了很多令人讨厌的问题。不确定这是否是您的问题，但需要检查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-16T14:40:56.823

为了响应我发现的 SQL Server 问题，至少在 2008 年，如果您获得 200 行进行编辑，它将显示 \r\n 方块，如果您获得 1000 行进行只读，则不会。

# iphone - 为什么 UIWebView 会缩小图片？

> ID：835040
> 
> 赞同：2
> 
> 时间：2009-05-07T14:37:19.190
> 
> 标签：iphone, cocoa-touch, uiwebview, base64

我正在使用 UIWebView 以 base64 ( [http://www.abluestar.com/utilities/encode_base64/index.php](http://www.abluestar.com/utilities/encode_base64/index.php) ) 显示图像。UIWebView 设置为“缩放页面以适应”，模式为“左”。图像可能是 400px 宽，但一旦在 UiWebView 中渲染，它甚至不占屏幕的一半。我需要做一些类似 style="width:800px;..." 在它开始占据大部分屏幕并且可读之前（因为它不是那么小）。这是正确的方法吗？为什么 UIWebView 中的图像会缩小，然后我必须拉伸它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T14:40:21.257

我发现解决这个问题的最好方法是在我的 html 头中使用这个元标记

```
<meta name="viewport" content="width=320;height=420;user-scalable=yes;initial-scale=1.0;"> 
```

那么就不需要补偿缩放效果了

# python - 有没有人使用 Sphinx 来记录 C++ 项目？

> ID：835043
> 
> 赞同：43
> 
> 时间：2009-05-07T14:37:50.717
> 
> 标签：python, c++, python-sphinx, documentation-generation

[Sphinx](https://www.sphinx-doc.org)是一个新的 Python 文档工具。它看起来非常漂亮。我想知道的是：

*   这对于记录 C++ 项目有多合适？
*   是否有任何工具可以将现有文档（例如 doxygen）转换为 Sphinx 格式？
*   是否有使用 Sphinx 的 C++ 项目的在线/可下载示例？
*   使用过 Sphinx 的人有什么建议吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2011-02-15T14:57:01.297

如[here](https://stackoverflow.com/questions/2377985/doxygen-c-comment-string-parser-in-python)和[here](https://stackoverflow.com/questions/2743687/sphinx-in-clinux)所述，

*   Sphinx 本机 C++ 支持与突出显示/格式化/引用有关，而不是代码内文档提取
*   [呼吸](http://michaeljones.github.com/breathe/index.html)是从chrisdew引用的讨论中发展而来的

[编辑插入下面]：

我在一个包含 10 个不同模块/域的多 10k C++ 库上测试了 doxygen+breathe+sphinx 工具链。我的底线是：

1.  尚未完全可用
2.  但继续看
3.  而且，最重要的是，如果您目前正在寻找一个值得您花时间的有价值的 OSS 项目，请考虑自己花一些时间。

让我详细说明以下几点：

1.  我遇到了以下问题：

    *   doxygen 标记中的 Latex 标记（目前不支持，但应该易于实现）
    *   一些解析器错误（几个函数头定义），这似乎会导致 sphinx 解析器出错，但如果我直接在 sphinx c++ 代码块中测试它们就没有问题。不知道修复的难度，但这是一个严重的功能破坏者。
    *   重载标识符的一些问题。似乎支持在不同的类和/或命名空间和/或 doxygen xml 输出文件中寻址具有相同名称的函数。但是在单个类中显示或链接到一个特定的 10 个重载构造函数似乎是不可行的 ATM。在引用/链接的情况下，狮身人面像水平甚至有一个平行的（可能是暂时的）限制，呼吸可能会也可能不会解决。
    *   目前没有办法显示一个类的所有（或所有受保护/私有）成员。这以某种方式引入了另一个修复程序，并且修复起来必须非常简单。
    *   在更一般的意义上，请注意 ATM 是 Doxygen 的 xml 输出的桥梁。不应该以这样的方式理解它会准确地输出 doxygen 所做的事情，只是具有上述限制。相反，它为您提供了准确的，而不是更多，而不是更少的可能性

        *   将一个 doxygen 输出域中的所有内容转储到一个巨大的页面上
        *   显示特定的函数、成员、结构、枚举、类型定义或类，但必须手动指定。github上有一个fork，它可能想也可能不想解决这个整体概念问题，但没有对未来的暗示。
2.  在我看来，功能齐全的呼吸将填补一个重大空白并开辟一条相当酷的道路。因此，仅仅因为潜在的收益就值得关注。

3.  可悲的是，未来通过创作者的维护似乎会严重下降。因此，如果您在一家公司工作并且可以说服您的老板“呼吸”适合他，或者有一些空闲时间并且正在寻找一个真正有价值的项目，请考虑给它一个叉子！

作为最后的指针，还要注意 sphinx 的[doxylink](https://bitbucket.org/birkenfeld/sphinx-contrib/src) contrib 项目，它可以提供一个中间解决方案：建立一个类似教程的结构，它引用（css 样式匹配的）旧 doxygen 文档（我认为你甚至可以注入相同的标头进入 sphinx 并在 doxygen 文档之上查看'n'feels）。这样，您的项目就可以与 sphinx 保持密切联系，并且当呼吸完全到位时，您就可以继续前进了。但再说一遍：如果它符合您的议程，请考虑表现出一些爱。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-07T15:01:29.740

首先，保留两个目录树，`source`和`build`. 置于`source`版本控制之下。不要置于`build`版本控制之下，在安装过程中重建它。

其次，阅读[http://sphinx.pocoo.org/intro.html#setting-up-the-documentation-sources](http://sphinx.pocoo.org/intro.html#setting-up-the-documentation-sources)。

使用`sphinx-quickstart`构建实践文档树。玩几天以了解它是如何工作的。然后再次使用它在 SVN 目录中构建真实的东西。

在精心规划的树中组织您的文档。有些部分需要该部分的“index.rst”，有些则不需要。这取决于该部分的“独立”程度。

我们的顶层`index.rst`看起来是这样的。

```
.. XXX documentation master file, created by sphinx-quickstart on Wed Dec 31 07:27:45 2008.

..  include:: overview.inc

.. _`requirements`:

Requirements
============

.. toctree::
   :maxdepth: 1

   requirements/requirements
   requirements/admin
   requirements/forward
   requirements/volume

.. _`architecture`:

Architecture
============

.. toctree::
   :maxdepth: 1

   architecture/architecture
   architecture/techstack
   architecture/webservice_tech
   architecture/webservice_arch
   architecture/common_features
   architecture/linux_host_architecture

Detailed Designs
================

..  toctree::
    :maxdepth: 3

    design/index

Installation and Operations
===========================

.. toctree::
   :maxdepth: 1

   deployment/installation
   deployment/operations
   deployment/support
   deployment/load_test_results
   deployment/reference
   deployment/licensing

Programming and API's
=====================

..  toctree::
    :maxdepth: 2

    programming/index

**API Reference**. The `API Reference`_ is generated from the source.

.. _`API Reference`: ../../../apidoc/xxx/index.html

..  note::
    The API reference must be built with `Epydoc`_.

    .. _`Epydoc`: http://epydoc.sourceforge.net/

Management
==========

.. toctree::
   :maxdepth: 2
   :glob:

   management/*

Indices and tables
==================

* :ref:`genindex`
* :ref:`modindex`
* :ref:`search`

SVN Revision
============

::

    $Revision: 319 $ 
```

注意，我们没有“包含”API，我们只是用一个普通的 HTML 链接引用它。

Sphinx 有一个非常酷的插件，称为 automodule，它从 Python 模块中挑选文档字符串。

**更新**从 Sphinx 1.0 开始，支持 C 和 C++。 [http://sphinx.pocoo.org/](http://sphinx.pocoo.org/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-10-29T15:52:57.040

Have a look at [http://www.nabble.com/Using-doxygen-and-sphinx-together-td20989904.html](http://www.nabble.com/Using-doxygen-and-sphinx-together-td20989904.html) for an XML approach.

# ajax - 如何实现 CrateAndBarrel.com 类似的购物车？

> ID：835055
> 
> 赞同：1
> 
> 时间：2009-05-07T14:40:04.877
> 
> 标签：ajax, flash, shopping-cart

我们正在寻找实现购物车的方法，将购物项目放在页面底部，就像 CrateAndBarrels

[http://www.crateandbarrel.com/family.aspx?c=837&f=28291](http://www.crateandbarrel.com/family.aspx?c=837&f=28291)

访问者应该能够通过单击商品的“+ 添加到购物车”按钮将购物商品添加到购物车。据我了解，对于 CrateAndBarrel 来说，底部的购物车确实是一个 flash 对象。但是，如果可能的话，我希望我们能找到一种在 ajax 时尚中实现这一点的方法。

无论如何，我们并不是 web 2.0 方面的专家，并且正在寻找一些指南来实现此功能。我们的顾问建议我们使用框架来实现这一点。

1.  如果你是我，你会如何实现这个功能？

    *   A. 普通 WebForms 页面
    *   B. 使用 Frame 或 IFrame。
    *   C. HTML 和 Flash，就像 CrateAndBarrel
    *   D、阿贾克斯
2.  一些关于这些组件应该如何协作的简单解释将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:24:27.687

我肯定会选择 AJAX。查看 jquery 或其他框架之一，以帮助您完成大部分工作。

我会创建一个方法来绘制底部面板。然后在页面加载时调用它，并通过异步调用来获取购物车内容。当用户将商品添加到购物车时，您可以刷新页面（这将重新绘制面板）或调用更新方法来重新绘制购物车内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T15:26:43.017

1）我个人会使用 Ajax（我很确定 CrateandBarrel 必须这样做，并且使用 Flash 只是为了渲染篮子）——奇怪的是，虽然我的 Firefox 是最新的，但它不会让我使用他们的网站）

然后，您可以在视口底部使用绝对定位的 DIV 渲染篮子。

You could use a frame, but I think an absolutely positioned DIV would be a better solution.

(2) As Adam Pope says, when an item is added (via Ajax) the basket can be redrawn (maybe a JSON call to get the basket contents?).

And definitely use a javascript framework.

Edit: And remember to let it degrade gracefully for anyone who does not have javascript!

# c# - 在 asp.net 3.5 中发送未来日期的电子邮件通知

> ID：835060
> 
> 赞同：2
> 
> 时间：2009-05-07T14:40:39.680
> 
> 标签：c#, asp.net, .net-3.5

我想在 ASP.NET 2.0 (C#) 和 SQL2005 中开发在线提醒服务。但我没有得到提醒服务的概念。我所知道的是使用在线提醒服务，我可以安排未来日期的提醒，该提醒会在该日期通过电子邮件或短信发送给我（安排提醒的人）。但是在 asp.net 中如何做到这一点，因为任何人都可以为任何日期安排提醒，我们如何知道何时将该邮件发送给该人。我们必须放一些循环或什么。

所以请指导我，在线提醒服务的概念是什么以及如何使用 ASP.NET 和 SQL 轻松开发此应用程序

已编辑

我在共享主机服务器上，因此该解决方案必须能够在共享主机上运行。

或者

请告诉我是否有人知道任何免费和开源的提醒服务 CMS，我可以下载并研究它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T14:50:46.113

Microsoft SQL Server 2005 具有调度（sql 作业）和电子邮件功能。您甚至可能不需要使用 ASP.NET。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T14:51:17.393

理想情况下，您应该有一个 Windows 服务，它会定期（每隔几分钟）检查是否需要发送任何新的提醒。由于您使用的是共享主机，因此您可能无法安装服务。

我对 Windows 共享主机不是很熟悉，但如果您可以选择创建计划/cron 作业类型的任务，您可能会这样做。

如果您无法在您的服务器上创建计划任务，另一种选择是在您的家用 PC 上创建一个计划任务，其中包含每隔几分钟运行一次的程序/脚本，并且只需点击您网站上的特殊网页。然后，该页面可以包含检查提醒并将其发送出去的代码。这有点骇人听闻，但它应该可以工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-27T17:38:16.030

看看 Quartz.Net ( [http://quartznet.sourceforge.net/](http://quartznet.sourceforge.net/) )。您可以在 Application_Start 事件中创建石英调度程序的实例，只要 ASP.Net 应用程序正在运行，它就会轮询数据库并触发您注册的任何功能。由于您在共享主机环境中，这可能是您最好的选择，除非您的主机提供商有一个可以定期触发 WebForm（或 ASP.Net MVC 控制器）的调度程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T02:48:25.670

首先，您显然需要创建一个用户界面和数据库来存储提醒。你得到的那部分。下一步是创建一个服务，该服务会定期查询数据库以获取到期通知的提醒。

最好的方法是编写一个轻量级的 Windows 服务，正如您所建议的，它使用循环和合理的睡眠时间（以免独占 CPU）来不断检查数据库中的提醒和发送通知。然后它会根据您的要求处理每个提醒。

但是由于您在共享主机上，因此无法部署 Windows 服务，因此最好的办法是在 global.asax 的 Application_Start 上运行后台线程。有很多例子可以说明如何做到这一点，例如：

*   [http://www.west-wind.com/WebLog/posts/67557.aspx](http://www.west-wind.com/WebLog/posts/67557.aspx)
*   [在 IIS 中管理后台线程有哪些最佳实践？](https://stackoverflow.com/questions/655012/what-are-some-best-practices-for-managing-background-threads-in-iis)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T02:57:00.720

共享主机不适用于您正在尝试做的事情。您可以在应用程序启动时创建一个后台轮​​询线程，但它会在某个时候关闭，并且实际上可能被您的托管公司禁止。您的主机很可能会检测到无限循环并导致您的帐户被自动关闭，尤其是当它使用相当多的 CPU 时。正如 John 所建议的，您的 ISP 可能有一个计划任务或托管 cron 选项，但通常，这些只是用于执行夜间备份之类的事情，并不真正具有您需要的粒度级别。

简单的答案是，您很可能需要托管帐户以外的其他东西。您可能需要研究 VPS 共享托管服务，或者您可能希望考虑研究 MS Azure 或 Amazon EC2。要做到这一点，您需要创建一个应用程序，或者更好的是，一个持续运行的服务，这是共享主机帐户无法提供的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-27T16:40:10.233

您可能会考虑使用缓存过期来触发事件的“黑客”。创建在特定日期时间到期的新缓存键以运行提醒或使其以定义的时间间隔重复，检查队列以查看是否应发送任何新内容。

请参阅： [ASPNET 中的简单后台任务](https://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T14:01:18.337

还有一些服务可以定期调用您服务上的特定网页。您可以使用它来检查页面是否需要发送任何提醒。

但是，由于您依赖于外部站点，因此您无法控制如果始终发送提醒非常重要，这可能不是理想的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T14:02:06.713

1）创建一个用于存储消息的数据库，带有日期戳

2) 创建一个 SQL 作业，选择一个时间段内的所有消息

3) 从 SQL 作业中，您可以初始化一个基于 .net 的 SQL 函数，该函数将使用 System.Net.Mail 命名空间发送电子邮件。

# perl - 如何在 Perl 中访问我的匿名数组？

> ID：835063
> 
> 赞同：1
> 
> 时间：2009-05-07T14:41:11.393
> 
> 标签：perl, hash

以下代码生成按子网连接的平均客户端数列表。目前我必须通过`sort | uniq | grep -v HASH`.

试图将其全部保留在 Perl 中，这是行不通的：

```
foreach $subnet (keys %{keys %{keys %days}}) {
    print "$subnet\n";
} 
```

来源是这样的：

```
foreach $file (@ARGV) {
    open(FH, $file) or warn("Can't open file $file\n");
    if ($file =~ /(2009\d{4})/) {
        $dt = $+;
    }
    %hash = {};
    while(<FH>) {
        @fields = split(/~/);
        $subnet = $fields[0];
        $client = $fields[2];
        $hash{$subnet}{$client}++;
    }
    close(FH);
    $file = "$dt.csv";
    open(FH, ">$file") or die("Can't open $file for output");
    foreach $subnet (sort keys %hash) {
        $tot = keys(%{$hash{$subnet}});
        $days{$dt}{$subnet} = $tot;
        print FH "$subnet, $tot\n";
        push @{$subnet}, $tot;
    }
    close(FH);
}

foreach $day (sort keys %days) {
    foreach $subnet (sort keys %{$days{$day}}) {
        $tot = $i = 0;
        foreach $amt (@{$subnet}) {
            $i++;
            $tot += $amt;
        }
        print "$subnet," . int($tot/$i) . "\n";
    }
} 
```

我怎样才能消除对`sort | uniq`Perl 之外的进程的需要？最后一个*foreach*让我得到子网 id，它们是数组的“匿名”名称。它会多次生成这些（每天使用该子网一次）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:06:27.200

> 但这似乎比在 excel 中组合电子表格更容易。

实际上，在大多数情况下，像[Spreadsheet::ParseExcel](http://search.cpan.org/search?query=Spreadsheet-ParseExcel&mode=module)这样的模块让这变得非常容易。您仍然必须像处理来自 CSV 或“A1”类型寻址的行一样，但您不必执行导出步骤。然后你可以用[Spreadsheet::WriteExcel](http://search.cpan.org/search?query=Spreadsheet-WriteExcel&mode=module)输出！

我已经使用这些模块来阅读包含数百张支票的电子表格，对内容进行分类、整理和修改，然后写入新的支票以交付给会计师。

* * *

在这部分：

```
foreach $subnet (sort keys %hash) {
        $tot = keys(%{$hash{$subnet}});
        $days{$dt}{$subnet} = $tot;
        print FH "$subnet,$tot\n";
        push @{$subnet}, $tot;
} 
```

$subnet 是一个字符串，但您在最后一条语句中将它用作数组引用。由于您没有[限制](http://www.perlmonks.org/?node_id=686571)，它会将其视为对变量的软引用，该变量的名称与 $subnet 的内容相同。如果您真的想这样做，那没关系，但这会令人困惑。至于澄清最后一部分...

*更新*我猜这就是您要查找的内容，其中子网值仅在以前未出现时才保存，即使是另一天（？）：

```
use List::Util qw(sum); # List::Util was first released with perl 5.007003 (5.7.3, I think)
my %buckets;
foreach my $day (sort keys %days) {
    foreach my $subnet (sort keys %{$days{$day}}) {
        next if exists $buckets{$subnet}; # only gives you this value once, regardless of what day it came in
        my $total = sum @{$subnet}; # no need to reuse a variable
        $buckets{$subnet} = int($total/@{$subnet}; # array in scalar context is number of elements
    }
}

use Data::Dumper qw(Dumper);
print Dumper \%buckets; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T15:25:50.010

基于[Anonymous 的建议](https://stackoverflow.com/questions/835063/how-can-i-get-to-my-anonymous-arrays-in-perl/835224#835224)，我构建了子网名称的哈希来访问数组：

..

```
 push @{$subnet}, $tot;
            $subnets{$subnet}++;
    }
    close(FH);
}

use List::Util qw(sum); # List::Util was first released with perl 5.007003

foreach my $subnet (sort keys %subnets) {
    my $total = sum @{$subnet}; # no need to reuse a variable
    print "$subnet," . int($total/@{$subnet}) . "\n"; # array in scalar context is number of elements
} 
```

我不确定这是否是最好的解决方案，但我不再有重复项了。

# visual-studio-2008 - 如何以编程方式在 Visual Studio 2008 中导航架构视图？

> ID：835064
> 
> 赞同：0
> 
> 时间：2009-05-07T14:41:28.367
> 
> 标签：visual-studio-2008, add-in, database-project

我计划为 Visual Studio 2008 开发一个插件，它允许我以编程方式为数据库项目中的表创建基本过程。

但是我被困在非常早期的阶段，因为我找不到以编程方式导航数据库项目的模式视图的方法。

有谁知道我该怎么做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T15:01:50.783

您指的是“VS Team System - 数据库版”项目吗？前几天我看到了这篇关于在这样一个项目中使用 T4 模板的[博客文章。](http://blogs.msdn.com/psirr/archive/2008/12/29/using-t4-templates-with-gdr-database-projects.aspx)

# c# - 从非托管代码传递指针

> ID：835072
> 
> 赞同：7
> 
> 时间：2009-05-07T14:42:44.510
> 
> 标签：c#, interop, dllimport

我有一个导入 C dll 的 C# 项目，该 dll 具有以下功能：

```
int primary_read_serial(int handle, int *return_code, int *serial, int length); 
```

我想访问串行参数。我实际上已经让它返回串行参数的一个字符，但我不太确定我在做什么并且想了解发生了什么，当然让它工作。

所以，我非常确定正在访问 dll，其他没有指针的函数可以正常工作。如何处理指针？我必须编组它吗？也许我得有个固定的地方放数据呢？

一个解释会很棒。

谢谢！理查德

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T14:47:11.443

您必须使用 IntPtr 并将 IntPtr 编组到您想要放入的任何 C# 结构中。在您的情况下，您必须将其编组为 int []。

这分几个步骤完成：

*   分配非托管句柄
*   使用未管理的数组调用函数
*   将数组转换为托管字节数组
*   将字节数组转换为整数数组
*   释放非托管句柄

该代码应该给您一个想法：

```
// The import declaration
[DllImport("Library.dll")]
public static extern int primary_read_serial(int, ref int, IntPtr, int) ;

// Allocate unmanaged buffer
IntPtr serial_ptr = Marshal.AllocHGlobal(length * sizeof(int));

try
{
    // Call unmanaged function
    int return_code;
    int result = primary_read_serial(handle, ref return_code, serial_ptr, length);

    // Safely marshal unmanaged buffer to byte[]
    byte[] bytes = new byte[length * sizeof(int)];
    Marshal.Copy(serial_ptr, bytes, 0, length);

    // Converter to int[]
    int[] ints = new int[length];
    for (int i = 0; i < length; i++)
    {
        ints[i] = BitConverter.ToInt32(bytes, i * sizeof(int));
    }

}
finally
{
    Marshal.FreeHGlobal(serial_ptr);
} 
```

不要忘记 try-finally，否则您将面临泄漏非托管句柄的风险。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T14:53:34.313

如果我理解你想要做什么，这应该对你有用。

```
unsafe
{
    int length = 1024; // Length of data to read.

    fixed (byte* data = new byte[length]) // Pins array to stack so a pointer can be retrieved.
    {
        int returnCode;
        int retValue = primary_read_serial(0, &returnCode, data, length);

        // At this point, `data` should contain all the read data.
    }
} 
```

然而，JaredPar 为您提供了一种简单的方法，只需更改您的外部函数声明，以便 C# 在后台为您进行编组。

希望这能让您了解在稍低的水平上发生的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T14:51:55.737

在编写该函数的 P/invoke 声明时，请尝试对指针参数使用关键字 ref，如下所示：

```
[DllImport("YouDll.dll", EntryPoint = "primary_read_serial")]
public static extern int primary_read_serial(int, ref int, ref int, int) ; 
```

我不确定您是否需要在 C# 中指定参数的名称。请记住，在调用该方法时，您还必须在通过引用传递的参数中使用 ref。

# java - 使用 JAXB 解组具有不同/动态名称的元素

> ID：835075
> 
> 赞同：7
> 
> 时间：2009-05-07T14:43:21.857
> 
> 标签：java, xml, serialization, orm, jaxb

我正在解析具有如下节点的 XML 文档：

```
<objects>
  <dog>
    <data1>...</data1>
    <data2>...</data2>
    <data3>...</data3>
  </dog>
  <cat>
    <data1>...</data1>
    <data2>...</data2>
    <data3>...</data3>
  </cat>
</objects> 
```

元素 data1、data2、data3 始终是一致的。只有父标签不同。在我的对象模型中，我有一个代表所有这些情况的对象。在事先不知道元素名称的情况下，如何让 JAXB 处理这种情况？

@XMLAnyElement 匹配所有对象，但不创建适当类型的对象；我得到一个节点对象列表而不是我的对象。我的对象目前看起来像：

```
public class MyObject {
    protected String otherData;

    @XmlAnyElement
    @XmlElementWrapper(name = "objects")
    protected List<MyChildObject> childObjects;
}

public class MyChildObject {
    protected String data1;
    protected String data2;
    protected String data3;
} 
```

除了将传入的 XML 格式更改为使用`<object type="dog">`元素之外，如何处理这种情况的任何想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T15:43:00.873

如果名称是真正动态的，那么我认为 JAXB 不会帮助您。如果您有定义数量的各种元素名称，那么您可以像其他帖子建议的那样使用继承。如果元素和名称的数量未知，我建议使用如下内容：

```
@XmlMixed
@XmlAnyElement
public List<Object> getObjects() {
    return objects;
} 
```

这会带来元素只是一个 DOM 元素。然后，您可以再次使用 JAXB 将每个元素转换为您的自定义类型。

那将是如果您必须使用 JAXB。您可能会发现直接使用 SAX 或 DOM API 来处理此类数据更容易。JAXB 真正适用于可以表示为模式的定义良好的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T15:06:16.233

您可以使用继承：

```
@XmlRootElement(name = "dog")
public class MyDogObject extends MyChildObject {
    //nothing here
}

@XmlRootElement(name = "cat")
public class MyCatObject extends MyChildObject {
    //nothing here
} 
```

通过这种方式，您可以处理相同的对象类型，`MyChildObject`同时灵活地控制 XML 结构。另一个好处是，如果您将来定义特定的狗/猫 XML 节点 - 它们可以映射到相应的子类，但不能映射到另一个，正如预期的那样。

# python - Python字典：键（）和值（）总是相同的顺序吗？

> ID：835092
> 
> 赞同：369
> 
> 时间：2009-05-07T14:46:13.083
> 
> 标签：python

看起来字典返回的列表`keys()`和`values()`方法总是一对一的映射（假设字典在调用这两个方法之间没有改变）。

例如：

```
>>> d = {'one':1, 'two': 2, 'three': 3}
>>> k, v = d.keys(), d.values()
>>> for i in range(len(k)):
    print d[k[i]] == v[i]

True
True
True 
```

如果你不改变 call`keys()`和 call之间的字典`values()`，假设上面的 for 循环总是打印 True 是错误的吗？我找不到任何文件证实这一点。

* * *

## 回答 #1

> 赞同：420
> 
> 时间：2009-05-07T15:45:47.153

发现这个：

> 如果`items()`, `keys()`, `values()`, `iteritems()`, `iterkeys()`, 和 `itervalues()`被调用而没有对字典进行干预修改，则列表将直接对应。

关于[2.x 文档](https://docs.python.org/2/library/stdtypes.html#dict.items)和[3.x 文档](https://docs.python.org/3/library/stdtypes.html#dictionary-view-objects)。

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2009-05-07T14:49:34.900

是的，您观察到的确实是一个有保证的属性 -- `keys()`，`values()`并且`items()`如果 dict 没有更改，则以一致的顺序返回列表。 `iterkeys()`&c 也以与相应列表相同的顺序进行迭代。

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2009-05-07T15:20:08.073

是的，它[在 python 2.x 中得到保证](https://docs.python.org/2/library/stdtypes.html#dictionary-view-objects)：

> 如果键、值和项目视图被迭代而没有对字典进行干预修改，项目的顺序将直接对应。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2017-12-16T19:16:11.657

是的。从 CPython 3.6 开始，字典[按照您插入它们的顺序返回项目](https://docs.python.org/3/whatsnew/3.6.html#new-dict-implementation)。

忽略说这是一个实现细节的部分。这种行为在 CPython 3.6 中得到保证，并且对于[从 Python 3.7 开始](https://docs.python.org/3/whatsnew/3.7.html)的所有其他 Python 实现都是[必需](https://mail.python.org/pipermail/python-dev/2017-December/151283.html)的。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-06-25T09:06:40.817

对文档的良好参考。无论文档/实施如何，您都可以通过以下方式保证订单：

```
k, v = zip(*d.iteritems()) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-07T15:10:48.233

根据[http://docs.python.org/dev/py3k/library/stdtypes.html#dictionary-view-objects](http://docs.python.org/dev/py3k/library/stdtypes.html#dictionary-view-objects)，dict 的 keys()、values() 和 items() 方法将返回相应的迭代器，其顺序对应。但是，对于同一件事，我无法找到对 python 2.x 官方文档的引用。

据我所知，答案是肯定的，但仅限于 python 3.0+

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-07T15:21:05.370

对于它的价值，我编写的一些大量使用的生产代码是基于这个假设的，我从来没有遇到过问题。我知道这并不是真的:-)

如果您不想冒险，我会使用 iteritems() 如果可以的话。

```
for key, value in myDictionary.iteritems():
    print key, value 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-12-06T16:53:39.667

我同意其他人的观点，即在 python 3.6+ 中，如果不受用户影响，它应该保持不变。

几天前我的代码中的一个例子：

```
ips = { '001' : '142.250.178.14', '002' : '104.18.2.89', '003' : '10.251.63.21' }
def run(self):
    for x, y in self.ips.items():
                try:
                    subprocess.check_call(
                    ['ping', '-n', '1', y],
                    stdout=DEVNULL,  # suppress output
                    stderr=DEVNULL
                    )
                except subprocess.CalledProcessError:
                    nextServer = ('HUB ' + x + ' is OFFLINE   ' + " IP:   " + y) 
```

并且输出的顺序总是相同的，就像我输入的那样，即只有离线服务器会按顺序显示：HUB 003 is OFFLINE IP: 10.251.63.21 因为前两个是可达的

希望清除它

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2017-07-12T16:10:16.020

我对这些答案并不满意，因为我想确保即使使用不同的字典，导出的值也具有相同的顺序。

在这里您预先指定键顺序，即使字典发生更改，返回的值也将始终具有相同的顺序，或者您使用不同的字典。

```
keys = dict1.keys()
ordered_keys1 = [dict1[cur_key] for cur_key in keys]
ordered_keys2 = [dict2[cur_key] for cur_key in keys] 
```

# sql-server - Sql Server 2005 SSIS/Agent - 查询作业状态

> ID：835093
> 
> 赞同：1
> 
> 时间：2009-05-07T14:46:13.113
> 
> 标签：sql-server, sql-server-2005, ssis

有没有办法查询当前状态（正在执行、空闲等）和最后结果（成功、失败等），以及特定作业名称的最后运行时间？我正在寻找的最终结果是能够在各种 SSIS 包的内部 Web 应用程序中显示此信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T15:00:40.833

您应该能够在 MSDB 中找到此信息 - 有表 sysjobs、sysjobhistory 和 sysjobsteps 提供您正在寻找的信息

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T16:10:09.777

```
exec msdb.dbo.sp_help_job @job_name = 'TheJobName' 
```

给出我想要的信息。那么我可以使用 SqlDataReader 来获取信息。请注意，此存储过程返回多个结果集。

此存储过程的 micrsoft 文档是 [http://msdn.microsoft.com/en-us/library/ms186722(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms186722(SQL.90).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T02:32:40.313

我使用的另一个解决方案是使用当前状态更新参考表。检索您需要的值既快速又简单，通常也很容易。

例如，一旦一个包启动，就插入一条包含日期和时间、包名称等的记录。

# c# - 具有推断的泛型参数的泛型方法

> ID：835094
> 
> 赞同：3
> 
> 时间：2009-05-07T14:46:37.357
> 
> 标签：c#, generics

我有以下代码来创建用于访问类属性的 func 表达式

```
public static Expression<Func<TObj, TProperty>> BuildGet<TObj, TProperty>(PropertyInfo property)
{
    Type type = typeof(TObj);
    ParameterExpression arg = Expression.Parameter(type, "x");
    var prop = Expression.Property(arg, property);

    return Expression.Lambda<Func<TObj, TProperty>>(prop, arg);
} 
```

问题是，我必须通过，`TObj`即使`TProperty`它们是已知的（`PropertyInfo`类上的属性 -`.DeclaringType`和`.PropertyType`）。

有没有办法解决这个问题，所以我不必明确地传递它们？

返回类型必须保持为`Expression<Func<TObj, TProperty>>`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T15:19:41.333

如果返回类型必须保持`Func<TObj, TProperty>`，那么方法必须保持通用。您必须在*编译时*指定类型。就是这样 - 虽然`PropertyInfo`知道类型，但该信息仅在*执行*时可用，而编译器需要知道类型信息才能检查您是否正确使用了该值等。它不可能知道属性的执行时间值将是。

如果您可以将返回类型更改为 just`Expression`那么您可以在执行时创建`Expression<Func<TObj, TProperty>>`具有适当类型的 an ，但只需将其作为`Expression`. 如果不进行强制转换，您将无法以编译时类型安全的方式使用返回值，但这可能会有所帮助......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T14:48:32.517

编译器应该如何推断 的类型`TObj`？您没有将任何参数传递给该类型的函数。

你可以尝试这样的事情：

```
public static Expression<Func<TObj, TProperty>> BuildGet<TObj, TProperty>
    (TObj obj, TProperty property) { ... } 
```

这将允许编译器推断 和 的类型，`TObj`但这`TProperty`意味着您必须在`PropertyInfo`当前使用参数时重构您的方法。

# c# - 带有 Java 和 C# 后端的 JQuery 前端：设计选择

> ID：835096
> 
> 赞同：2
> 
> 时间：2009-05-07T14:46:49.960
> 
> 标签：c#, java, jquery

我必须构建一个多浏览器 Web 应用程序，它应该能够安装在 Windows 和 Linux 服务器中。

我曾想过使用一个用 JQuery 构建的客户端前端，以及两个不同的后端，分别用 java 和 c# 构建。然后，客户端将使用带有 json 的 ajax 调用与服务器上的 MVC 框架进行通信（C# 版本为 ASP.net MVC，Java 版本为 Struts）。

明智吗？可行吗？我还有什么其他选择？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T14:49:53.823

如果你有一个完美的 Java 跨平台解决方案，可以安装在 Windows 和 linux 上，为什么还要使用 C#？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T15:05:44.893

这种方法是有道理的——我看到的主要挑战是使 java 和 .net 的接口完全相同——小问题，比如在任何 url 中都没有 aspx。

您还需要手动完成比其他方式更多的工作 - 例如，我发现将 asp.net scriptservice 的东西与 jquery 集成需要一些变通方法，如果您需要前端，这将不是一个选项结束与两个平台一起工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T14:57:51.980

关于 .NET 版本 - 您的后端唯一的功能是 json 通信？那么我认为 WCF 服务会是更好的选择。

# c# - Winforms：SuspendLayout/ResumeLayout 不够用？

> ID：835100
> 
> 赞同：28
> 
> 时间：2009-05-07T14:47:29.540
> 
> 标签：c#, winforms, performance, gdi+, doublebuffered

我有一个包含一些“自定义控件”的库。本质上，我们有自己的按钮、圆角面板和一些带有一些自定义油漆的组合框。尽管 OnPaint 方法中有“数学”，但控件是相当标准的。大多数时候，我们所做的只是绘制圆角并向背景添加渐变。我们使用 GDI+ 来完成这一切。

这些控件没问题（根据我们的客户看起来非常漂亮），但是尽管有 DoubleBuffer，您仍然可以看到一些重绘，尤其是当同一表单上有 20++ 个按钮（例如）时。在表单加载时，您会看到按钮绘制……这很烦人。

我很确定我们的按钮不是地球上最快的东西，但我的问题是：如果双缓冲区“打开”，所有重绘不应该在后台发生，Windows 子系统应该“立即”显示结果吗？

另一方面，如果存在将创建标签的“复杂”foreach 循环，则将它们添加到面板（双缓冲）并更改它们的属性，如果我们在循环之前暂停面板的布局并在循环时恢复面板的布局结束了，所有这些控件（标签和按钮）不应该“几乎立即”出现吗？这不会那样发生，您可以看到面板被填充。

知道为什么这没有发生吗？我知道没有示例代码很难评估，但这也很难复制。我可以用相机制作视频，但相信我，它并不快 :)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-07T15:03:31.530

我们也看到了这个问题。

我们已经看到“修复”它的一种方法是完全暂停控件的绘制，直到我们准备好开始。为此，我们向控件发送 WM_SETREDRAW 消息：

```
// Note that WM_SetRedraw = 0XB

// Suspend drawing.
UnsafeSharedNativeMethods.SendMessage(handle, WindowMessages.WM_SETREDRAW, IntPtr.Zero, IntPtr.Zero);

...

// Resume drawing.
UnsafeSharedNativeMethods.SendMessage(handle, WindowMessages.WM_SETREDRAW, new IntPtr(1), IntPtr.Zero); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-18T18:30:16.260

您应该查看的一件事是您是否在面板的任何子控件上设置了 BackColor=Transparent。BackColor=Transparent 将显着降低渲染性能，尤其是在父面板使用渐变的情况下。

Windows 窗体不使用真正的透明度，而是使用“假”的透明度。每个子控件绘制调用都会在父控件上生成绘制调用，因此父控件可以绘制其背景，子控件在其上绘制其内容，使其看起来透明。

因此，如果您有 50 个子控件，它们将在父控件上生成额外的 50 个绘制调用以进行背景绘制。而且由于梯度通常较慢，您会看到性能下降。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-07T16:37:04.457

我将从性能角度解决您的问题。

> foreach 循环将创建标签，将它们添加到面板（双缓冲）并更改它们的属性

如果事情是这样完成的，那么还有改进的余地。首先创建所有标签，更改它们的属性，当它们都准备好后，将它们添加到面板中：`Panel.Controls.AddRange(Control[])`

> 大多数时候，我们所做的只是绘制圆角并为背景添加渐变

你是否一遍又一遍地做同样的事情？你的渐变是如何生成的？写一张图片不能那么慢。我曾经不得不在内存中创建一个 1680x1050 的渐变，而且速度非常快，就像，对于 来说，太快了`Stopwatch`，所以绘制渐变不会那么难。

我的建议是尝试缓存一些东西。打开 Paint，绘制角并保存到磁盘，或在内存中生成图像一次。然后根据需要加载（并调整大小）。渐变也一样。

即使不同的按钮具有不同的颜色，但具有相同的主题，您也可以使用 Paint 或其他工具创建位图，并在运行时加载它并将颜色值乘以另一个颜色。

**编辑：**

> 如果我们在循环之前暂停面板布局并在循环结束时恢复面板布局

这不是 SuspendLayout 和 ResumeLayout 的用途。它们暂停布局逻辑，即控件的自动定位。与 FlowLayoutPanel 和 TableLayoutPanel 最相关。

至于双缓冲，我不确定它是否适用于自定义绘制代码（没有尝试过）。我想你应该实现你自己的。

**简而言之，双缓冲：** 非常简单，几行代码。在绘制事件上，渲染到位图而不是渲染到`Graphics`对象，然后将该位图绘制到`Graphics`对象。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-07T14:52:52.583

除了`DoubleBuffered`属性之外，还可以尝试将其添加到控件的构造函数中：

```
SetStyle(ControlStyles.OptimizedDoubleBuffer | 
         ControlStyles.AllPaintingInWmPaint, true); 
```

如果这最终还不够（我会勉强说它还不够），请考虑查看我对[这个问题](https://stackoverflow.com/questions/778095/windows-forms-using-backgroundimage-slows-down-drawing-of-the-forms-controls)的回答并暂停/恢复面板或表单的重绘。这将使您的布局操作完成，然后在完成后执行所有绘图。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-10-30T16:01:26.627

您可能想查看我的问题的答案，[如何暂停控件及其子项的绘制？](https://stackoverflow.com/questions/487661/how-do-i-suspend-painting-for-a-control-and-its-children)以获得更好的暂停/恢复。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-17T21:26:42.360

听起来您正在寻找的是“合成”显示，其中整个应用程序被一次绘制，几乎就像一个大位图。这是 WPF 应用程序发生的情况，除了应用程序周围的“chrome”（标题栏、调整大小手柄和滚动条等）。

请注意，通常情况下，除非您弄乱了某些窗口样式，否则每个 Windows 窗体控件都负责绘制自己。也就是说，每个控件都会对 WM_PAINT、WM_NCPAINT、WM_ERASEBKGND 等绘制相关消息进行破解，并独立处理这些消息。这对您意味着双缓冲仅适用于您正在处理的单个控件。为了在一定程度上接近于干净的复合效果，您不仅需要关注正在绘制的自定义控件，还需要关注放置它们的容器控件。例如，如果您的 Form 包含一个 GroupBox，而 GroupBox 又包含许多自定义绘制的按钮，则这些控件中的每一个都应将 DoubleBuffered 属性设置为 True。请注意，此属性受保护，所以这意味着您要么最终继承各种控件（只是为了设置双缓冲属性），要么使用反射来设置受保护的属性。此外，并非所有 Windows 窗体控件都尊重 DoubleBuffered 属性，因为在内部，它们中的一些只是本机“通用”控件的包装器。

如果您的目标是 Windows XP（可能是更高版本），有一种方法可以设置复合标志。有 WS_EX_COMPOSITED 窗口样式。我以前用它来混合结果。它不适用于 WPF/WinForm 混合应用程序，也不适用于 DataGridView 控件。如果你走这条路，请确保在不同的机器上进行大量测试，因为我看到了奇怪的结果。最后，我放弃了使用这种方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-07-16T10:36:38.320

也许首先在一个仅控制的“可见”（私有）缓冲区上绘制，然后渲染它：

### 在你的控制

```
BufferedGraphicsContext gfxManager;
BufferedGraphics gfxBuffer;
Graphics gfx; 
```

### 安装图形的功能

```
private void InstallGFX(bool forceInstall)
{
    if (forceInstall || gfxManager == null)
    {
        gfxManager = BufferedGraphicsManager.Current;
        gfxBuffer = gfxManager.Allocate(this.CreateGraphics(), new Rectangle(0, 0, Width, Height));
        gfx = gfxBuffer.Graphics;
    }
} 
```

### 在它的绘画方法中

```
protected override void OnPaint(PaintEventArgs e)
{
    InstallGFX(false);
    // .. use GFX to draw
    gfxBuffer.Render(e.Graphics);
} 
```

### 在其调整大小方法中

```
protected override void OnSizeChanged(EventArgs e)
{
    base.OnSizeChanged(e);
    InstallGFX(true); // To reallocate drawing space of new size
} 
```

上面的代码已经过一些测试。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-16T13:09:37.040

我过去遇到过很多类似的问题，我解决的方法是使用第三方 UI 套件（即[DevExpress](http://www.devexpress.com/Home/Mission.xml)）而不是标准的 Microsoft 控件。

我开始使用微软标准控件，但我发现我一直在调试由他们的控件引起的问题。由于 Microsoft 通常不会修复任何已识别的问题，而且他们几乎没有提供合适的解决方法，因此问题变得更糟。

我切换到 DevExpress，我只有好话要说。该产品很可靠，他们提供了很好的支持和文档，是的，他们实际上倾听了客户的意见。每当我有任何疑问或问题时，我都会在 24 小时内得到友好的答复。在某些情况下，我确实发现了一个错误，并且在这两种情况下，他们都为下一个服务版本实施了修复。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-02-04T19:23:03.147

在切换我想要显示的用户控件时，我遇到了与 tablelayoutpanel 相同的问题。

通过创建一个继承表的类，然后启用双缓冲，我完全摆脱了闪烁。

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Windows.Forms;

namespace myNameSpace.Forms.UserControls
{
    public class TableLayoutPanelNoFlicker : TableLayoutPanel
    {
        public TableLayoutPanelNoFlicker()
        {
            this.DoubleBuffered = true;
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-01-24T04:14:10.033

我在控件引用缺少字体的表单上看到了错误的 winforms 闪烁。

这可能并不常见，但如果您尝试过其他所有方法，则值得研究。

# sql - 用于评估多个相关表的 SQL 语句

> ID：835105
> 
> 赞同：2
> 
> 时间：2009-05-07T14:48:15.840
> 
> 标签：sql, sql-server

我有一个项目表，其中列出了客户信息。然后我有四个相关的工作表，用于该项目中的工作 - 屋顶、壁板、排水沟和杂项。这四个表都有一个 projectID 字段以将它们链接到 Projects 表，并且它们都有一个“状态”字段。一个项目可以有任何工作组合。

我希望能够仅选择所有作业状态字段都标记为“已完成”的项目。

可能有一种简单的方法可以做到这一点，但我的大脑有时会因为 SQL 而过热。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T14:57:10.357

也许...：

```
SELECT * FROM Projects
LEFT JOIN Roofing ON (projectID)
LEFT JOIN Siding ON (projectID)
LEFT JOIN Gutters ON (projectID)
LEFT JOIN Misc ON (projectID)
WHERE (Roofing.status IS NULL OR Roofing.status="completed")
AND (Siding.status IS NULL OR Siding.status="completed")
AND (Gutters.status IS NULL OR Gutters.status="completed")
AND (Misc.status IS NULL OR Misc.status="completed") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T14:55:53.683

```
select p.* 
from project as p
where not exists (select 1 from roofing where projectId = p.projectId and status <> 'completed')
    and not exists (select 1 from siding where projectId = p.projectId and status <> 'completed')
    and not exists (select 1 from gutters where projectId = p.projectId and status <> 'completed')
    and not exists (select 1 from misc where projectId = p.projectId and status <> 'completed') 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T15:16:59.233

亚历克斯的方法将在一行上为您提供所有信息（如果子表中没有多条记录），但如果您需要它单独的行，请尝试使用 union all 语句。只要确保在每个联合中使用相同的列即可。如果您在一个或多个表中有其他表没有的数据，那么您将使用 null 作为联合中该列的值。

```
SELECT p1.projectid,'roofing' as JobType FROM Projects p1
JOIN Roofing r ON p1.projectID = r.projectID
union all
SELECT p1.projectid,'gutters' as JobType FROM Projects p1
JOIN gutters g ON p1.projectID = g.projectID
union all
SELECT p1.projectid,'siding' as JobType FROM Projects p1
JOIN Siding s ON p1.projectID = s.projectID
union all
SELECT p1.projectid,'misc' as JobType FROM Projects p1
JOIN Misc m ON p1.projectID = m.projectID 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T15:01:58.647

```
SELECT *
FROM Projects
  --Step 3: filter the projects by the results from Step2
WHERE ProjectID not in
(
  SELECT ProjectID
  FROM
  (
    --Step 1: gather all the jobs into one bucket
    SELECT ProjectID, Status
    FROM Roofing
      UNION ALL
    SELECT ProjectID, Status
    FROM Siding
      UNION ALL
    SELECT ProjectID, Status
    FROM Gutters
      UNION ALL
    SELECT ProjectID, Status
    FROM Misc
  ) as Jobs
  --Step 2: find incomplete project IDs
  GROUP BY Jobs.ProjectID
  HAVING MIN(Jobs.Status) != 'COMPLETED'
    OR MAX(Jobs.Status) != 'COMPLETED'
) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T15:49:22.400

创建一个视图，为“所有已完成的作业”返回不同的 ProjectId，并将其连接到 Projects 表。这样，您只需在“所有作业已完成”的标准发生变化时更新视图，例如，如果添加了新作业。视图的 SQL 语句可以通过多种方式构建，如其他回复中所示。

# java - Java 类中的 SQL 代码

> ID：835108
> 
> 赞同：12
> 
> 时间：2009-05-07T14:48:32.767
> 
> 标签：java, sql, integration

我们当前的项目不使用 Hibernate（由于各种原因），我们使用 Spring 的 SimpleJdbc 支持来执行我们所有的数据库操作。我们有一个实用程序类，它抽象了所有 CRUD 操作，但复杂的操作是使用自定义 SQL 查询执行的。

目前，我们的查询以字符串常量的形式存储在服务类本身中，并提供给一个实用程序以由 SimpleJdbcTemplate 执行。我们处于一个必须平衡可读性和可维护性的僵局。类本身内的 SQL 代码更易于维护，因为它与使用它的代码一起存在。另一方面，如果我们将这些查询存储在外部文件（平面文件或 XML）中，SQL 本身将比转义的 java 字符串语法更具可读性。

有没有人遇到过类似的问题？什么是好的平衡？您将自定义 SQL 保存在项目中的什么位置？

示例查询如下：

```
private static final String FIND_ALL_BY_CHEAPEST_AND_PRODUCT_IDS = 
"    FROM PRODUCT_SKU T \n" +
"    JOIN \n" +
"    ( \n" +
"        SELECT S.PRODUCT_ID, \n" +
"               MIN(S.ID) as minimum_id_for_price \n" +
"          FROM PRODUCT_SKU S \n" +
"         WHERE S.PRODUCT_ID IN (:productIds) \n" +
"      GROUP BY S.PRODUCT_ID, S.SALE_PRICE \n" +
"    ) FI ON (FI.PRODUCT_ID = T.PRODUCT_ID AND FI.minimum_id_for_price = T.ID) \n" +
"    JOIN \n" +
"    ( \n" +
"        SELECT S.PRODUCT_ID, \n" +
"               MIN(S.SALE_PRICE) as minimum_price_for_product \n" +
"          FROM PRODUCT_SKU S \n" +
"         WHERE S.PRODUCT_ID IN (:productIds) \n" +
"      GROUP BY S.PRODUCT_ID \n" +
"    ) FP ON (FP.PRODUCT_ID = T.PRODUCT_ID AND FP.minimum_price_for_product = T.sale_price) \n" +
"WHERE T.PRODUCT_ID IN (:productIds)"; 
```

这是它在平面 SQL 文件中的样子：

```
--namedQuery: FIND_ALL_BY_CHEAPEST_AND_PRODUCT_IDS
FROM PRODUCT_SKU T 
JOIN 
( 
    SELECT S.PRODUCT_ID, 
           MIN(S.ID) as minimum_id_for_price 
      FROM PRODUCT_SKU S 
     WHERE S.PRODUCT_ID IN (:productIds) 
  GROUP BY S.PRODUCT_ID, S.SALE_PRICE 
) FI ON (FI.PRODUCT_ID = T.PRODUCT_ID AND FI.minimum_id_for_price = T.ID) 
JOIN 
( 
    SELECT S.PRODUCT_ID, 
           MIN(S.SALE_PRICE) as minimum_price_for_product 
      FROM PRODUCT_SKU S 
     WHERE S.PRODUCT_ID IN (:productIds) 
  GROUP BY S.PRODUCT_ID 
) FP ON (FP.PRODUCT_ID = T.PRODUCT_ID AND FP.minimum_price_for_product = T.sale_price) 
WHERE T.PRODUCT_ID IN (:productIds) 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-07T15:24:53.460

我将 SQL 存储为 Java 类中的字符串和在运行时加载的单独文件。我非常喜欢后者，原因有两个。首先，代码在很大程度上更具可读性。其次，如果将 SQL 存储在单独的文件中，则更容易单独测试 SQL。除此之外，当查询位于单独的文件中时，更容易找到比我更擅长 SQL 的人来帮助我处理查询。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-07T15:03:17.333

我也遇到过这个问题，目前是出于同样的原因——一个基于 spring jdbc 的项目。我的经验是，虽然在 sql 本身中包含逻辑并不是很好，但确实没有更好的地方，并且放入应用程序代码比让 db 执行它要慢，而且不一定更清晰。

我见过的最大的陷阱是 sql 开始在整个项目中扩散，有多种变体。“从 FOO 中获取 A、B、C”。“从 Foo 中获取 A、B、C、E”等。当项目达到一定的临界质量时，这种扩散尤其可能 - 10 个查询似乎不是问题，但是当整个项目中有 500 个查询分散时，要弄清楚你是否已经做了一些事情变得更加困难. 抽象出基本的 CRUD 操作让您在游戏中遥遥领先。

最好的解决方案，AFAIK，是与编码的 SQL 严格一致 - 评论，测试，并在一个一致的地方。我们的项目有 50 行未注释的 sql 查询。他们的意思是什么？谁知道？

至于外部文件中的查询，我看不出这有什么好处-您仍然依赖于 SQL，并且除了将 sql 排除在类之外的（有问题的）美学改进之外，您的类是仍然依赖于 sql - 例如，您通常将资源分开以获得插入替换资源的灵活性，但是您不能插入替换 sql 查询，因为这会改变类的语义或不起作用全部。所以这是一种虚幻的代码清洁度。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T15:15:55.010

一个相当激进的解决方案是使用 Groovy 来指定您的查询。Groovy 具有对多行字符串和字符串插值（有趣地称为 GStrings）的语言级支持。

例如，使用 Groovy，您在上面指定的查询将是：

```
class Queries
    private static final String PRODUCT_IDS_PARAM = ":productIds"

    public static final String FIND_ALL_BY_CHEAPEST_AND_PRODUCT_IDS = 
    """    FROM PRODUCT_SKU T 
        JOIN 
        ( 
            SELECT S.PRODUCT_ID, 
                   MIN(S.ID) as minimum_id_for_price 
              FROM PRODUCT_SKU S 
             WHERE S.PRODUCT_ID IN ($PRODUCT_IDS_PARAM) 
          GROUP BY S.PRODUCT_ID, S.SALE_PRICE 
        ) FI ON (FI.PRODUCT_ID = T.PRODUCT_ID AND FI.minimum_id_for_price = T.ID) 
        JOIN 
        ( 
            SELECT S.PRODUCT_ID, 
                   MIN(S.SALE_PRICE) as minimum_price_for_product 
              FROM PRODUCT_SKU S 
             WHERE S.PRODUCT_ID IN ($PRODUCT_IDS_PARAM) 
          GROUP BY S.PRODUCT_ID 
        ) FP ON (FP.PRODUCT_ID = T.PRODUCT_ID AND FP.minimum_price_for_product = T.sale_price) 
    WHERE T.PRODUCT_ID IN ($PRODUCT_IDS_PARAM) """ 
```

您可以从 Java 代码访问这个类，就像它是在 Java 中定义的一样，例如

```
String query = QueryFactory.FIND_ALL_BY_CHEAPEST_AND_PRODUCT_IDS; 
```

我承认，将 Groovy 添加到您的类路径中只是为了让您的 SQL 查询看起来更好，这有点像“大锤破解坚果”的解决方案，但是如果您使用的是 Spring，那么您很有可能已经在您的类路径中使用了 Groovy .

此外，您的项目中可能还有很多其他地方可以使用 Groovy（而不是 Java）来改进您的代码（特别是现在 Groovy 归 Spring 所有）。示例包括编写测试用例，或用 Groovy bean 替换 Java bean。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T16:04:22.647

我们使用存储过程。这对我们有好处，因为我们使用 Oracle Fine Grain Access。这允许我们通过限制用户访问相关程序来限制用户查看特定报告或搜索结果。它还为我们带来了一点性能提升。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T14:57:13.587

我想将查询存储在外部文件中，然后让应用程序在需要时读取它会带来巨大的安全漏洞。

如果一个邪恶的策划者可以访问该文件并更改您的查询，会发生什么？

例如更改

```
 select a from A_TABLE; 
```

到

```
 drop table A_TABLE; 
```

或者

```
 update T_ACCOUNT set amount = 1000000 
```

此外，它还增加了必须维护两件事的复杂性：Java 代码和 SQL 查询文件。

编辑：是的，您可以在不重新编译您的应用程序的情况下更改您的查询。我看不出有什么大不了的。如果项目太大，您可以重新编译仅保存/创建 sqlQueries 的类。此外，如果文档很差，也许您最终会更改不正确的文件，这将变成一个巨大的无声错误。不会抛出异常或错误代码，当您意识到自己做了什么时，可能为时已晚。

另一种方法是使用某种 SQLQueryFactory，有据可查，并使用返回您想要使用的 SQL 查询的方法。

例如

```
public String findCheapest (String tableName){

      //returns query.
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T14:58:08.657

为什么不使用存储过程而不是硬编码查询？存储过程将提高可维护性并为 SQL 插入攻击等事情提供更多安全性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T15:00:16.920

在课堂上可能是最好的 - 如果查询足够长以至于转义是一个问题，您可能想要查看存储过程或简化查询。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T15:03:54.460

一种选择是使用[iBatis](http://ibatis.apache.org/)。与 Hibernate 等成熟的 ORM 相比，它相当轻量级，但提供了一种将 SQL 查询存储在 .java 文件之外的方法

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-07T15:05:47.123

我们将所有的 SQL 存储在一个类中作为一堆静态最终字符串。为了可读性，我们将它分布在几行使用 + 连接的行上。另外，我不确定你是否需要转义任何东西——“字符串”在 sql 中用单引号括起来。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-07T15:08:58.037

我们有一个项目，我们使用了与您完全相同的方法，除了我们将每个查询外部化到一个单独的文本文件。每个文件都使用 Spring 的 ResourceLoader 框架读入（一次），应用程序通过如下接口工作：

```
public interface SqlResourceLoader {
    String loadSql(String resourcePath);
} 
```

这样做的一个明显优势是，使用非转义格式的 SQL 可以更轻松地进行调试——只需将文件读入查询工具即可。一旦您有多个中等复杂度的查询，在测试和调试（尤其是调整）时处理代码的非/转义/转义是非常宝贵的。

我们还必须支持几个不同的数据库，因此可以更轻松地交换平台。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-07T15:10:15.180

根据您解释的问题，这里没有真正的选择，除了将其保留在代码中，并在任何地方摆脱**/n**字符。这是您提到的唯一影响可读性的事情，它们绝对没有必要。

除非您在代码中遇到其他问题，否则您的问题很容易解决。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-07T15:36:53.837

您需要的是[SQLJ](http://en.wikipedia.org/wiki/SQLJ)，它是一个 SQL Java 预处理器。[可悲的是，尽管我已经看到了一些IBM](http://www.ibm.com/developerworks/data/library/techarticle/0302tsui/0302tsui.html)和[Oracle](http://www.oracle.com/technology/tech/java/sqlj_jdbc/htdocs/faq.html)的实现，但它显然从未起飞。但它们已经过时了。

如果我是你并且在系统上有很多查询，我会将它们存储在一个单独的文件中并在*运行时*加载它们。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-07T17:32:26.163

根据我的经验，最好将 SQL 语句保留在代码中而不将它们分开，这样可以使事情更易于维护（例如注释与配置文件），但现在我与团队成员就这件事进行了辩论。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-08T20:42:32.383

我有一个小程序，可以使用 Java 字符串文字访问剪贴板和转义/取消转义纯文本。

我将它作为“快速启动”工具栏上的快捷方式，所以我唯一需要做的就是

```
Ctrl+C, Click jar, Ctrl+V 
```

当我想在 SQL 工具中运行我的“代码”时，反之亦然。

所以我通常有这样的事情：

```
String query = 
    "SELECT a.fieldOne, b.fieldTwo \n"+
    "FROM  TABLE_A a, TABLE b \n"+ 
    "... etc. etc. etc";

logger.info("Executing  " + query  );

PreparedStatement pstmt = connection.prepareStatement( query );
....etc. 
```

变成：

```
 SELECT a.fieldOne, b.fieldTwo 
    FROM  TABLE_A a, TABLE b
    ... etc. etc. etc 
```

要么是因为在某些项目中我无法创建单独的文件，要么是因为我很偏执，并且我觉得在从外部文件读取时会插入/删除一些位（通常是一个不可见的 \n

```
select a,b,c 
from 
```

进入

```
select a,b,cfrom 
```

IntelliJ idea 自动为您做同样的事情，但只是从简单到代码。

这是我恢复的旧版本。它有点坏了，不能处理？

让我知道是否有人改进它。

```
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.DataFlavor;
import java.awt.datatransfer.ClipboardOwner;
import java.awt.datatransfer.Transferable;
import java.awt.datatransfer.StringSelection;
import java.awt.datatransfer.UnsupportedFlavorException;
import java.io.IOException;

/**
 * Transforms a plain string from the clipboard into a Java 
 * String literal and viceversa.
 * @author <a href="http://stackoverflow.com/users/20654/oscar-reyes">Oscar Reyes</a>
 */
public class ClipUtil{

    public static void main( String [] args ) 
                                throws UnsupportedFlavorException,
                                                     IOException {

        // Get clipboard
        Toolkit toolkit = Toolkit.getDefaultToolkit();
        Clipboard clipboard = toolkit.getSystemClipboard();

        // get current content.
        Transferable transferable = clipboard.getContents( new Object() ); 
        String s = ( String ) transferable.getTransferData( 
                                                DataFlavor.stringFlavor );

        // process the content
        String result = process( s );

        // set the result
        StringSelection ss = new StringSelection( result );
        clipboard.setContents( ss, ss );

    }
    /**
     * Transforms the given string into a Java string literal 
     * if it represents plain text and viceversa. 
     */
    private static String process( String  s ){
        if( s.matches( "(?s)^\\s*\\\".*\\\"\\s*;$" ) ) {
            return    s.replaceAll("\\\\n\\\"\\s*[+]\n\\s*\\\"","\n")
                       .replaceAll("^\\s*\\\"","")
                       .replaceAll("\\\"\\s*;$","");
        }else{
            return     s.replaceAll("\n","\\\\n\\\" +\n \\\" ")
                        .replaceAll("^"," \\\"")
                        .replaceAll("$"," \\\";");
        }
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-14T16:08:06.903

既然您已经使用 Spring，为什么不将 SQL 放在 Spring 配置文件中并将其 DI 到 DAO 类中呢？这是一种将 SQL 字符串外部化的简单方法。

HTH 汤姆

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-09-28T15:29:32.337

我更喜欢外部选项。我支持多个项目，但发现支持内部 SQL 要困难得多，因为每次要对 SQL 进行细微更改时都必须编译和重新部署。将 SQL 放在外部文件中可以让您轻松地进行大大小小的更改，同时降低风险。如果您只是在编辑 SQL，则不可能输入会破坏课程的错字。

对于 Java，我使用在 .properties 文件中表示 SQL 的 Properties 类，如果您想重复使用查询而不是多次读取文件，它允许您传递 SQL 查询。

# wcf - WCF readerQuotas 设置 - 缺点？

> ID：835114
> 
> 赞同：27
> 
> 时间：2009-05-07T14:49:52.170
> 
> 标签：wcf, performance

如果 WCF 服务在其响应消息中返回一个字节数组，则数据有可能超过 16384 字节的默认长度。发生这种情况时，异常将类似于

> 读取 XML 数据时已超出最大数组长度配额 (16384)。可以通过更改创建 XML 阅读器时使用的 XmlDictionaryReaderQuotas 对象的 MaxArrayLength 属性来增加此配额。

我在网上看到的所有建议只是将`<readerQuotas>`元素中的设置增加到最大，所以像

```
<readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647"
              maxArrayLength="2147483647" maxBytesPerRead="2147483647"
              maxNameTableCharCount="2147483647" /> 
```

在服务器上，在客户端上类似。

我想知道这种方法的任何缺点，特别是如果字节数组的大小偶尔会变得非常大。上面的设置是否只是让 WCF 为每个请求声明一个巨大的数组？您是否必须限制返回数据的最大大小，或者您可以指定一个合理大小的缓冲区并让 WCF 继续运行，直到读取所有数据？

谢谢！

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-07T15:22:32.543

主要缺点是潜在的攻击漏洞——例如，恶意源现在可以用最大 2 GB 的消息淹没您的网络服务器，并可能将其关闭。

当然，允许 2 GB 消息也会在内存消耗方面给服务器带来一些压力，因为这些消息需要在内存中完全组装（除非您在 WCF 中使用流协议）。如果您有 10 个客户端向您发送 2 GB 的消息，那么您的服务器上将需要大量 RAM！:-)

除此之外，我没有看到任何真正的问题。

马克

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-02-23T00:03:25.360

MSDN 上有一篇文章解释了设置这些值时需要考虑的各种安全注意事项。一些拒绝服务攻击会占用您的内存，其中一些（例如未正确设置 MaxDepth）可能会导致致命的 StackOverflowExceptions，这可能会在单个请求中关闭您的服务器。

[http://msdn.microsoft.com/en-us/library/ms733135.aspx](http://msdn.microsoft.com/en-us/library/ms733135.aspx)

# asp.net - 如何将我的 asp.net 会员数据库从 express 更改为标准 sql？

> ID：835124
> 
> 赞同：2
> 
> 时间：2009-05-07T14:51:23.337
> 
> 标签：asp.net, sql-server, security

我正在构建一个 ASP.NET 3.5 (C#) 应用程序，并计划使用成员资格和角色安全性。

我想在我的 SQL Server 2008 标准版上进行设置，而不是默认的 express 设置。

我该怎么办？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T14:58:43.303

**您可以在 *C:\Windows\Microsoft.NET\Framework\v2.0.50727* 使用这个命令aspnet_regsql.exe**安装会员数据库 （调整到您的路径）

您可以[在此处找到更多详细信息](http://msdn.microsoft.com/en-us/library/ms998347.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T14:59:58.993

除了 SQL Server 之外，您用于 ASP.NET 安全成员资格/角色模块的数据库服务器版本无关紧要。

要在服务器上手动设置此安全性，您必须运行以下脚本：

> c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\InstallCommon.sql
> 
> c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\InstallMembership.sql
> 
> c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\InstallRoles.sql

并相应地配置 web.config（请参阅[http://msdn.microsoft.com/en-us/library/6e9y4s5t.aspx](http://msdn.microsoft.com/en-us/library/6e9y4s5t.aspx)）。

您可以使用您拥有数据的同一数据库运行此脚本，或者您可以创建一个新数据库来存储用户成员资格或角色相关数据并在那里运行它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T14:54:50.380

你需要运行aspnet_regsql。这将弹出向导来配置您的新数据库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T14:55:58.833

1.  获取 Express Edition 创建的 MDF 和 LDF 文件（通常在 App_Data 中）并将它们附加到您的 SQL Server 2008 实例。
2.  为新数据库设置安全性（即，将用户添加到将访问数据库的数据库。确保为用户提供适当的权限）
3.  更改 web.config 中的连接字符串以指向新数据库

**编辑：**我的回答假设您已经在使用数据库并且只想将其从 SQL Express 迁移到 SQL Standard 版本。

# internet-explorer - IE 8 丢弃内存页？

> ID：835130
> 
> 赞同：25
> 
> 时间：2009-05-07T14:52:05.020
> 
> 标签：internet-explorer, memory

这个问题是这个问题的衍生/[演变](https://stackoverflow.com/questions/461605/invalid-webresource-axd-parameters-being-generated)。（该问题被标记为已解决，因为我对其进行了赏金并自动解决，但从未真正得到回答。）

总结如下：我们有一个 ASP.NET 站点。有时，当客户要求提供奇怪的 url 时，我们会遇到错误。从客户要求的资源来看，html 源代码中似乎缺少 4k 的文本块。

一个简单的例子......如果我们有一个看起来像这样的页面：

```
<a href="myValidLink.aspx">Here's some text</a>
a bunch more stuff
...(a large block of text)...
AND NOW MORE STUFF LATER 
```

客户可能会要求提供网址：“myValidLiORE%20STUFF%20LATER”。

就好像 html 源代码的一部分不存在......而丢失的部分似乎正好是 4KB（4096 字节）长（或者根据某些人，有时是 1KB？）。

不幸的是，我们无法按需复制此错误，尽管我们看到它每天多次来自客户。

起初我们认为这是 Webresource.axd 的问题，因为我们碰巧在那里看到了很多......但现在我认为这主要是因为我们将类似的错误分组在一起，并且这些错误往往在损坏发生时发生在那个特定区域。现在我正在研究更广泛的问题，我看到我们遇到非常不同的错误的地方，这些错误看起来像是由丢弃一个块的相同问题引起的。

我们已经在 IE 8 中看到了很多这种情况，并且随着 IE 8 变得越来越流行，这种情况变得越来越频繁。我们偶尔会在浏览器中看到它，该浏览器将自身报告为 IE 7……如果将其置于“兼容模式”，IE 8 就会这样做。

我的理论，在这一点上（我正试图找到一种测试方法）是 Web 服务器正确地发送了字节流中的所有数据......并且浏览器 IE 8 有问题，并在某些情况下删除它的内存页（4k）。

然而，我有点担心这个理论，因为显然有些人报告说在 IE 6 或 FF 3 中“偶尔”看到这种情况......这些往往是异常值，可能只是具有相似症状的不同问题，但如果在那些浏览器上真的是一样的东西，这会让我的理论失去意义。不过，在这一点上，我没有更好的主意。

我的另一个想法可能是服务器上的一个相对较新的服务包导致提供给客户端的数据出现问题，偶尔会丢失 4KB。这个理论的问题在于它不能解释 IE 8 上错误的巨大优势，以及其他客户端浏览器上的错误。

所以问题，希望最终会有答案：

1.  有人遇到过这种情况么？（也许现在它在你的雷达上？）
2.  任何人都可以始终如一地复制这个问题吗？
3.  关于它是什么的任何想法？你能证实或反驳我的理论吗？
4.  是否有任何修复或解决方法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-26T04:04:15.743

** 2010 年 4 月 1 日编辑：** 更新：4k 错误现已由 2010 年 3 月 30 日的 IE8 累积更新修复。blogs.msdn.com/ieinternals/archive/2010/04/01/

Internet Explorer 团队一直在调查此问题。

-=影响=-

到目前为止，我们认为该问题对最终用户使用 Web 应用程序的体验没有影响；唯一的负面影响是 JavaScript 推测下载引擎发送的虚假/格式错误的请求。当解析器实际需要该脚本时，将在那时正确下载和使用该脚本。

-=情况=-

虚假请求似乎仅在某些时间情况下发生，仅当强制重新启动预解析器时（例如当包含带有 CHARSET 指令的 Content-Type 的 META HTTP-EQUIV 标记出现在文档中时）并且仅当JavaScript SRC URL 跨越 HTTP 响应正文的第 4096 个字节。

-=解决方法=-

我们目前认为，通常可以通过使用 HTTP Content-Type 标头声明页面的 CHARSET 而不是在页面中指定它来缓解此问题。

所以，而不是把

[META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"]

相反，在您的 head 标记中，发送以下 HTTP 响应标头：

内容类型：文本/html；字符集=utf-8

请注意，HTTP 标头中的字符集规范会提高所有浏览器的性能，因为浏览器的解析器在遇到字符集声明时无需从头重新开始解析。此外，使用 HTTP 标头有助于缓解某些 XSS 攻击向量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-01T12:51:18.783

[http://blogs.msdn.com/ieinternals/archive/2009/07/27/Bugs-in-the-IE8-Lookahead-Downloader.aspx](http://blogs.msdn.com/ieinternals/archive/2009/07/27/Bugs-in-the-IE8-Lookahead-Downloader.aspx)是关于这个问题的当前帖子。

丢失的 4k 错误：文章指出：“通过使用 HTTP Content-Type 标头声明页面的 CHARSET 而不是在页面中指定它，您可以消除解析器重新启动的一个原因。” Eric Lawrence 在一封电子邮件中说：“不幸的是，解析器重启的另一个已知原因是使用了 XML 命名空间，而您的站点似乎使用了它。” 因此，如果您使用 XHTML，可能会出现 4K 问题！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-21T17:06:47.843

我们有同样的问题。我要补充：

```
 Response.ContentType = "text/html"
        Response.Charset = "utf-8" 
```

到我们的基页类。我会尽快报告结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-29T02:53:20.433

FWIW 这是我从 LogParser 中 1 个月的日志中获得的统计数据。

`12331 hits to ScriptResource & WebResource / 183 errors`

由用户代理信息分解。似乎只支持 IE8 理论（加上“兼容模式”用户代理）。

```
cs-uri-stem MSIEVersion TridentVersion COUNT
/WebResource.axd MSIE+8.0 三叉戟/4.0 100
/ScriptResource.axd MSIE+8.0 三叉戟/4.0 36
/WebResource.axd MSIE+7.0 三叉戟/4.0 44
/ScriptResource.axd MSIE+7.0 三叉戟/4.0 2
/ScriptResource.axd 不是 IE 不是三叉戟 1

```

单个非 IE8 错误根本没有查询字符串，来自 Firefox/3.5.3 浏览器（必须是不相关的）。

我的页面中没有任何 META HTTP-EQUIV="Content-Type"。虽然我确实有这个来反弹非 Javascript 用户。

```
<noscript>
    <meta http-equiv=Refresh content="0; URL=/ErrorPage.aspx?Error=NoJavascript">
</noscript> 
```

# c# - 使用标记类来控制逻辑流

> ID：835140
> 
> 赞同：7
> 
> 时间：2009-05-07T14:54:17.837
> 
> 标签：c#, .net

我一直在浏览一些代码，发现我的一位同事正在使用“标记类”来控制程序逻辑（请参见下面的人为示例）。它似乎运行良好，代码读起来非常好，但它有一些东西闻起来......

```
namespace ConsoleApplication4983
{
    public class MyClass
    {
        static void Main()
        {
            var c = new MyClass();
            c.DoSomething(new Sequential());
            c.DoSomething(new Random());
        }

        public void DoSomething(ProcessingMethod method)
        {
            if (method is Sequential)
            {
                // do something sequential
            }
            else if (method is Random)
            {
                // do something random
            }
        }
    }

    public class ProcessingMethod {}
    public class Sequential : ProcessingMethod {}
    public class Random : ProcessingMethod {}
} 
```

实现相同效果的更好方法是什么？枚举？属性？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T14:56:07.333

标记***接口***是一种更好的做法，因为它们提供了更大的灵活性。

但是在这种特定情况下，我认为虚拟调度是一个更好的解决方案。

```
using System;

namespace ConsoleApplication4983
{
    public class MyClass
    {
        static void Main()
        {
            var c = new MyClass();
            c.DoSomething(new Sequential());
            c.DoSomething(new Random());
        }

        public void DoSomething(ProcessingMethod method)
        {
            method.Foo();
        }
    }

    public class ProcessingMethod
    {
        public virtual void Foo() { }
    }
    public class Sequential : ProcessingMethod
    {
        public override void Foo() { }
    }
    public class Random : ProcessingMethod
    {
        public override void Foo() { }
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-07T15:03:49.797

你想做的是用一个[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)替换它。策略定义了某事是如何完成的——即算法。

```
public interface IProcessingMethod
{
    void Process();
}

public class SequentialProcess : IProcessingMethod
{
    public void Process( IProcessable obj )
    {
         do something sequentially with the obj
    }
}

public class ParallelProcess : IProcessingMethod
{
    public void Process( IProcessable obj )
    {
        do something in parallel with the obj
    }
}

public interface IProcessable
{
    void Process( IProcessingMethod method );
}

public class MyClass : IProcessable
{
     public void Process( IProcessingMethod method )
     {
         method.Process( this );
     }
}

...

var obj = new MyClass();
obj.Process( new SequentialProcess() ); 
```

现在，如果我有一种新的 ProcessingMethod 类型，我只需要为该方法创建类，并更改确定注入 IProcessable 对象的 Process 方法的处理方法的代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-03T02:50:58.863

我看到这个问题很老，但我觉得所有的答案都没有抓住重点。

如果该示例充分说明了所需功能的范围，那么此处使用的适当构造将是**Enum 类型**。枚举类型是值类型；它们的功能本质上类似于命名的数字常量，具有出色的 IDE 自动完成支持。这是修改为使用 Enum 类型的示例：

```
namespace ConsoleApplication4983
{
    public class MyClass
    {
        static void Main()
        {
            var c = new MyClass();
            c.DoSomething(ProcessingMethod.Sequential);
            c.DoSomething(ProcessingMethod.Random);
        }

        public void DoSomething(ProcessingMethod method)
        {
            if (method == ProcessingMethod.Sequential)
            {
                // do something sequential
            }
            else if (method == ProcessingMethod.Random)
            {
                // do something random
            }
        }
    }

    public enum ProcessingMethod
    {
        Sequential,
        Random
    }
} 
```

其他答案正在参考更复杂的模式。我认为他们对“标记类”一词读得太多了。有时策略模式、虚拟调度等是一个不错的方法，但在这种情况下，我认为 Enum 是对这段代码进行的最简单的改进。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T14:58:47.327

他几乎就在那里，但并不完全，这可能就是你所看到的。类型上的 if 语句是难闻的气味。做某事应该在 ProcessingMethod 基类上，并且扩展它的每个类型都应该有自己的版本。

```
public void DoSomething(ProcessingMethod method)    {
   method.DoSomething();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T15:03:54.100

《*框架设计指南》*一书建议不要使用标记接口（可能还有标记类），而是优先使用属性。话虽如此，这本书确实继续说使用`is`（就像你所做的那样）比使用反射检查属性要快得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T15:01:35.887

将处理逻辑委托给特定的子类怎么样？`ProcessingMethod`会有一些由每个子类实现的抽象方法。

```
public void DoSomething(ProcessingMethod method)
{
  method.Process();
}

public abstract class ProcessingMethod
{
  public abstract void Process();
}

public class Sequental : ProcessingMethod
{
  public override void Process()
  {
    // do something sequential
  }
}

public class Random : ProcessingMethod
{
  public override void Process()
  {
    // do something random
  }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T15:01:50.377

是的，这闻起来很糟糕。如果你想做一些并行的事情：

```
public class Parallel : ProcessingMethod{} 
```

那么你将不得不更改很多代码。

# matlab - matlab中的元素ifs - 它们存在吗？

> ID：835142
> 
> 赞同：3
> 
> 时间：2009-05-07T14:54:26.747
> 
> 标签：matlab, if-statement, elementwise-operations

假设我有以下基本的 if 语句：

```
if (A ~= 0)
   % do something like divide your favorite number by A
else
   % do something like return NaN or infinity
end 
```

问题是 A 不是一个简单的数字，而是一个向量。如果 A 中没有元素为 0，则 Matlab 返回 true。我正在寻找的是矢量化的？为 A 中的每个元素执行上述 if 语句的方法。

实际上，我只是想尽可能快地做到这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T15:07:40.177

向量化 if 不存在，但有一些选项。如果要测试所有或任何元素是否为真，请使用 all 或 any 函数。

这是有条件地修改矩阵值的一个示例：

```
b = A ~= 0;      % b is a boolean matrix pointing to nonzero indices
                 % (b could be derived from some other condition,
                 %  like b = sin(A)>0
A(b) = f(A(b))   % do something with the indices that pass
A(~b) = g(A(~b)) % do something else with the indices that fail 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T14:27:03.300

```
B = zeros(size(A));
B(A~=0) = FAV./A(A~=0);  
B(A==0) = NaN; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T16:09:08.220

通常，要对矩阵的某些元素执行一次运算，并对其余元素执行另一次运算，单行解决方案是：

```
Z = B .* X + ~B .* Y; 
```

其中 B 是逻辑矩阵。举个例子，

```
Z = (A == 0) .* -1 + (A ~= 0) .* A; 
```

复制 A 但在 A 为零的任何地方分配 -1。

但是，由于该问题涉及无穷大或 NaN，因此可以更简洁地完成：

```
Z = FAV ./ A; % produces inf where A == 0
Z = (A ~= 0) .* FAV ./ A; % produces NaN where A == 0 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T14:58:08.780

您是否在寻找所有非零元素？你可以通过几种方式做到这一点。

```
nonzero = find(A); % returns indicies to all non-zero elements of A
y = x./A(nonzero); % divides x by all non-zero elements of A
                   % y will be the same size as nonzero 
```

或者对于单行，您可以使用条件代替索引

```
y = x./A(A~=0); % divides x by all non-zero elements of A 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T15:07:36.650

您需要做的是确定要操作的元素。我会使用 FIND。我将结果存储在 VI（有效索引）中并使用它来填充矩阵。

```
clear
clc

den = [2 0 2; 0 2 0; -2 -2 -2]
num = ones(size(den));
frac = nan(size(den));

vi = (den ~=0)

frac(vi) = num(vi)./den(vi)

vi = (den == 0)

frac(vi) = nan %just for good measure... 
```

# algorithm - 算法：有趣的差异算法

> ID：835143
> 
> 赞同：8
> 
> 时间：2009-05-07T14:54:30.007
> 
> 标签：algorithm, list, language-agnostic, diff

这是在现实世界中出现的，我想我会分享它，因为它可能会带来一些有趣的解决方案。本质上，算法需要区分两个列表，但让我给你一个更严格的问题定义。

# 数学公式

假设您有两个列表，`L`每个列表`R`都包含来自某些底层字母表的元素`S`。此外，这些列表具有它们所具有的公共元素按顺序出现的特性：即 if `L[i] = R[i*]`and `L[j] = R[j*]`，and `i`< `j`then `i`* < `j`*。这些列表根本不需要任何共同的元素，并且其中一个或两个都可以是空的。[*澄清：您可以假设没有重复元素。*]

问题是产生一种列表的“差异”，可以将其视为有序对的新列表，`(x,y)`其中`x`is from`L`和`y`is from `R`，具有以下属性：

1.  如果`x`出现在两个列表中，则`(x,x)`出现在结果中。
2.  如果`x`出现在 中`L`，但没有出现在 中`R`，则`(x,NULL)`出现在结果中。
3.  如果`y`出现在 中`R`，但没有出现在 中`L`，则`(NULL,y)`出现在结果中。

最后

*   结果列表与每个输入列表具有“相同”的排序：粗略地说，它与每个列表单独共享与上述相同的排序属性（参见示例）。

# 例子

```
L = (d)
R = (a,b,c)
Result = ((NULL,d), (a,NULL), (b,NULL), (c,NULL))

L = (a,b,c,d,e)  
R = (b,q,c,d,g,e)
Result = ((a,NULL), (b,b), (NULL,q), (c,c), (d,d), (NULL,g), (e,e)) 
```

有没有人有任何好的算法来解决这个问题？复杂性是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T13:29:51.957

如果您愿意在不同的数据结构中复制其中一个列表，则有一种方法可以在 O(n) 中执行此操作。这是一个经典的时间/空间权衡。

创建列表 R 的哈希映射，键是元素，值是数组的原始索引；在 C++ 中，您可以使用 tr1 或 boost 中的 unordered_map。

保留列表 R 的未处理部分的索引，初始化为第一个元素。

对于列表 L 中的每个元素，检查列表 R 中的匹配项的哈希映射。如果找不到，则输出（L 值，NULL）。如果有匹配，则从哈希图中获取对应的索引。对于列表 R 中直到匹配索引的每个未处理元素，输出（NULL，R 值）。对于匹配，输出（值，值）。

当您到达列表 L 的末尾时，遍历列表 R 的剩余元素并输出（NULL，R 值）。

**编辑：**这是 Python 中的解决方案。对于那些说这个解决方案取决于一个好的散列函数的存在的人——当然是这样。如果这是一个问题，原始发布者可能会对该问题增加额外的限制，但在那之前我会采取乐观的立场。

```
def FindMatches(listL, listR):
    result=[]
    lookupR={}
    for i in range(0, len(listR)):
        lookupR[listR[i]] = i
    unprocessedR = 0
    for left in listL:
        if left in lookupR:
            for right in listR[unprocessedR:lookupR[left]]:
                result.append((None,right))
            result.append((left,left))
            unprocessedR = lookupR[left] + 1
        else:
            result.append((left,None))
    for right in listR[unprocessedR:]:
        result.append((None,right))
    return result

>>> FindMatches(('d'),('a','b','c'))
[('d', None), (None, 'a'), (None, 'b'), (None, 'c')]
>>> FindMatches(('a','b','c','d','e'),('b','q','c','d','g','e'))
[('a', None), ('b', 'b'), (None, 'q'), ('c', 'c'), ('d', 'd'), (None, 'g'), ('e','e')] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T18:32:14.990

最坏的情况，如定义和仅使用相等，必须是 O(n*m)。考虑以下两个列表：

A[] = {a,b,c,d,e,f,g}

B[] = {h,i,j,k,l,m,n}

假设这两个“有序”列表之间恰好存在一个匹配项。它将进行 O(n*m) 次比较，因为不存在以后不需要其他比较的比较。

因此，您提出的任何算法都将是 O(n*m)，或更糟。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:05:33.770

通过遍历两个列表并随时匹配，可以在线性时间内完成区分有序列表。我将尝试在更新中发布一些伪 Java 代码。

由于我们不知道排序算法并且无法根据小于或大于运算符确定任何排序，因此我们必须考虑无序的列表。此外，考虑到结果的格式，您将面临扫描两个列表（至少在找到匹配项之前，然后您可以添加书签并从那里重新开始）。它仍然是 O(n^2) 性能，或者更具体地说是 O(nm)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-09T04:23:15.973

这和序列比对一模一样，可以使用[Needleman-Wunsch](http://en.wikipedia.org/wiki/Needleman-Wunsch_algorithm)算法来解决。该链接包含 Python 中的代码。只需确保设置得分，使不匹配为负，匹配为正，最大化时与空白对齐为 0。该算法在O(n * m)时间和空间上运行，但是这个的空间复杂度可以提高。

**评分功能**

```
int score(char x, char y){
    if ((x == ' ') || (y == ' ')){
        return 0;
    }
    else if (x != y){
        return -1;
    }
    else if (x == y){
        return 1;
    }
    else{
        puts("Error!");
        exit(2);
    }
} 
```

**代码**

```
#include <stdio.h>
#include <stdbool.h>

int max(int a, int b, int c){
    bool ab, ac, bc;
    ab = (a > b);
    ac = (a > c);
    bc = (b > c);
    if (ab && ac){
        return a;
    }
    if (!ab && bc){
        return b;
    }
    if (!ac && !bc){
        return c;
    }
}

int score(char x, char y){
    if ((x == ' ') || (y == ' ')){
        return 0;
    }
    else if (x != y){
        return -1;
    }
    else if (x == y){
        return 1;
    }
    else{
        puts("Error!");
        exit(2);
    }
}

void print_table(int **table, char str1[], char str2[]){
    unsigned int i, j, len1, len2;
    len1 = strlen(str1) + 1;
    len2 = strlen(str2) + 1;
    for (j = 0; j < len2; j++){
        if (j != 0){
            printf("%3c", str2[j - 1]);
        }
        else{
            printf("%3c%3c", ' ', ' ');
        }
    }
    putchar('\n');
    for (i = 0; i < len1; i++){
        if (i != 0){
            printf("%3c", str1[i - 1]);
        }
        else{
            printf("%3c", ' ');
        }
        for (j = 0; j < len2; j++){
            printf("%3d", table[i][j]);
        }
        putchar('\n');
    }
}

int **optimal_global_alignment_table(char str1[], char str2[]){
    unsigned int len1, len2, i, j;
    int **table;
    len1 = strlen(str1) + 1;
    len2 = strlen(str2) + 1;
    table = malloc(sizeof(int*) * len1);
    for (i = 0; i < len1; i++){
        table[i] = calloc(len2, sizeof(int));
    }
    for (i = 0; i < len1; i++){
        table[i][0] += i * score(str1[i], ' ');
    }
    for (j = 0; j < len1; j++){
        table[0][j] += j * score(str1[j], ' ');
    }
    for (i = 1; i < len1; i++){
        for (j = 1; j < len2; j++){
            table[i][j] = max(
                table[i - 1][j - 1] + score(str1[i - 1], str2[j - 1]),
                table[i - 1][j] + score(str1[i - 1], ' '),
                table[i][j - 1] + score(' ', str2[j - 1])
            );
        }
    }
    return table;
}

void prefix_char(char ch, char str[]){
    int i;
    for (i = strlen(str); i >= 0; i--){
        str[i+1] = str[i];
    }   
    str[0] = ch;
}

void optimal_global_alignment(int **table, char str1[], char str2[]){
    unsigned int i, j;
    char *align1, *align2;
    i = strlen(str1);
    j = strlen(str2);
    align1 = malloc(sizeof(char) * (i * j));
    align2 = malloc(sizeof(char) * (i * j));
    align1[0] = align2[0] = '\0';
    while((i > 0) && (j > 0)){
        if (table[i][j] == (table[i - 1][j - 1] + score(str1[i - 1], str2[j - 1]))){
            prefix_char(str1[i - 1], align1);
            prefix_char(str2[j - 1], align2);
            i--;
            j--;
        }
        else if (table[i][j] == (table[i - 1][j] + score(str1[i-1], ' '))){
            prefix_char(str1[i - 1], align1);
            prefix_char('_', align2);
            i--;
        }
        else if (table[i][j] == (table[i][j - 1] + score(' ', str2[j - 1]))){
            prefix_char('_', align1);
            prefix_char(str2[j - 1], align2);
            j--;
        }
    }
    while (i > 0){
        prefix_char(str1[i - 1], align1);
        prefix_char('_', align2);
        i--;
    }
    while(j > 0){
        prefix_char('_', align1);
        prefix_char(str2[j - 1], align2);
        j--;
    }
    puts(align1);
    puts(align2);
}

int main(int argc, char * argv[]){
    int **table;
    if (argc == 3){
        table = optimal_global_alignment_table(argv[1], argv[2]);
        print_table(table, argv[1], argv[2]);
        optimal_global_alignment(table, argv[1], argv[2]);
    }
    else{
        puts("Reqires to string arguments!");
    }
    return 0;
} 
```

**示例 IO**

```
$ cc dynamic_programming.c && ./a.out aab bba
__aab
bb_a_
$ cc dynamic_programming.c && ./a.out d abc
___d
abc_
$ cc dynamic_programming.c && ./a.out abcde bqcdge
ab_cd_e
_bqcdge 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T15:08:18.490

这是一个非常简单的问题，因为您已经有一个有序列表。

```
//this is very rough pseudocode
stack aList;
stack bList;
List resultList;
char aVal;
char bVal;

while(aList.Count > 0 || bList.Count > 0)
{
  aVal = aList.Peek; //grab the top item in A
  bVal = bList.Peek; //grab the top item in B

  if(aVal < bVal || bVal == null)
  {
     resultList.Add(new Tuple(aList.Pop(), null)));
  }
  if(bVal < aVal || aVal == null)
  {
     resultList.Add(new Tuple(null, bList.Pop()));
  }
  else //equal
  {
     resultList.Add(new Tuple(aList.Pop(), bList.Pop()));
  }
} 
```

注意...此代码不会编译。它只是作为一个指南。

**编辑**基于 OP 评论

如果排序算法没有公开，那么列表*必须*被认为是无序的。如果列表是无序的，则该算法的时间复杂度为 O(n^2)，特别是 O(nm)，其中 n 和 m 是每个列表中的项目数。

**编辑** 算法来解决这个问题

L(a,b,c,d,e) R(b,q,c,d,g,e)

```
//pseudo code... will not compile
//Note, this modifies aList and bList, so make copies.
List aList;
List bList;
List resultList;
var aVal;
var bVal;

while(aList.Count > 0)
{
   aVal = aList.Pop();
   for(int bIndex = 0; bIndex < bList.Count; bIndex++)
   {
      bVal = bList.Peek();
      if(aVal.RelevantlyEquivalentTo(bVal)
      {
         //The bList items that come BEFORE the match, are definetly not in aList
         for(int tempIndex = 0; tempIndex < bIndex; tempIndex++)
         {
             resultList.Add(new Tuple(null, bList.Pop()));
         }
         //This 'popped' item is the same as bVal right now
         resultList.Add(new Tuple(aVal, bList.Pop()));

         //Set aVal to null so it doesn't get added to resultList again
         aVal = null;

         //Break because it's guaranteed not to be in the rest of the list
         break;
      }
   }
   //No Matches
   if(aVal != null)
   {
      resultList.Add(new Tuple(aVal, null));
   }
}
//aList is now empty, and all the items left in bList need to be added to result set
while(bList.Count > 0)
{
   resultList.Add(new Tuple(null, bList.Pop()));
} 
```

结果集将是

L(a,b,c,d,e) R(b,q,c,d,g,e)

结果 ((a,null),(b,b),(null,q),(c,c),(d,d),(null,g),(e,e))

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T16:38:25.450

没有真正有形的答案，只有模糊的直觉。因为您不知道排序算法，只知道数据在每个列表中排序，这听起来有点像用于“区分”文件（例如在 Beyond Compare 中）并将行序列匹配在一起的算法。或者也隐约类似于正则表达式算法。

~~也可以有多种解决方案。~~（没关系，如果没有严格排序的重复元素就不会。我在文件比较方面想太多了）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T18:09:59.053

我认为你没有足够的信息。您所断言的是匹配的元素以相同的顺序匹配，但是找到第一个匹配对是 O(nm) 操作，除非您有其他可以确定的顺序。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-05-09T05:51:20.583

SELECT distinct l.element, r.element
FROM LeftList l
OUTER JOIN RightList r
ON l.element = r.element
ORDER BY l.id, r.id

假设每个元素的 ID 是它的排序。当然，您的列表包含在关系数据库中:)

# php - PHP：来自类内部/外部的“动态”回调

> ID：835147
> 
> 赞同：0
> 
> 时间：2009-05-07T14:54:54.873
> 
> 标签：php, class, callback

我们有一个问题[引用]

我需要在一个类中动态分配一个回调，在一个变量参数的基础上：我的目标是**只有一个**类（而不是一个主类和许多扩展子类），如果值是 X，则在这个类中，那么必须使用funcitonX，如果是Y，则使用functionY。

我知道我不能很好地解释，我希望我的例子能做到：

```
class plzComplicateMyLife{
    public $vehicle;
    public $kindVehicle;
    public $dynamicFunction;
    public function __construct($vehicle, $kindVehicle){
    $this->kindVehicle = $kindVehicle;
    $this->vehicle = $vehicle;
    switch($kindVehicle){
        case 'cycle':
            $this->dynamicFunction = "isACycle";
            break;
        case 'car':
            $this->dynamicFunction = "isACar";
            break;
    }
    //here come the problem, i need to call the callback store in dynamicFunction.
    //i tried:
    //call_user_func($this->$this->dinamicFunction, $this->vehicle);
    //error: Catchable fatal error: Object of class plzComplicateMyLife could not be converted to string in [...]
    //call_user_func("plzComplicateMyLife::".$this->dynamicFunction);
    //Warning: call_user_func(plzComplicateMyLife::isACar) [function.call-user-func]: First argument is expected to be a valid callback in [...]
    //$this->dynamicFunction();
    //Fatal error: Call to undefined method plzComplicateMyLife::dynamicFunction() in [...]
    //so, how can i do that?
    }
    public function isACycle($vehicle){
        echo 'im a cycle, model: '.$vehicle.'<br />';
    }
    public function isACar($vehicle){
        echo 'im a car, model: '.$vehicle.'<br />';
    }
    //i know this has no sense, in this example at least.
    public function printKind(){
        //call_user_func($this->$this->dinamicFunction, $this->vehicle);
        //call_user_func("plzComplicateMyLife::".$this->dynamicFunction);
        //then?
    }
}

$maserati = new plzComplicateMyLife('maserati4', 'car');

//then, maybe, outside the class i'll need to recover the callback:

$maserati->printKind(); 
```

**编辑**：

正如 Rob 所说，多态性确实是一个很好的解决方案。

但问题是，在这种情况下，我真的**必须**对每个类实例都有相同的声明，只更改参数......例如：

```
$maserati = new plzComplicateMyLife('maserati4', 'car');
$ducati = new plzComplicateMyLife('maserati4', 'cycle');
//is good
//becose i cant have:
$maserati = new plzComplicateMyLifeWithACar('maserati4');
$ducati = new plzComplicateMyLifeWithACycle('maserati4'); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T20:11:30.757

多态是这里的方法，但为了将来参考，您也可以这样做：

```
public function printKind() {
    $this->{$this->dynamicFunction}($this->vehicle);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T14:57:41.573

在 PHP 中，您可以使用数组作为回调变量指定方法回调（[参见此处](http://php.net/callback)），例如：

```
array( $object, $methodName ); 
```

所以你可以这样做

```
$callback = array($this, $this->dynamicFunction);
call_user_func($callback, $this->vehicle); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:04:33.163

呃，这里为什么**不想**用一个简单的继承结构呢？如果您希望根据所建模的对象而产生不同的行为，那么这几乎就是多态性的规范描述。

如果你真的想通过回调进入同一个对象，那么你需要做以下两件事之一：

1.  从回调中删除`$vehicle`参数，将它们设为私有或受保护，然后正常调用它们，即

    `call_user_func( array( $this, 'isACycle' ) );`

2.  将回调标记为静态，将它们设为私有或受保护，并按如下方式调用它们：

    `call_user_func( array( __CLASS__, 'isACycle' ), $this );`

在非静态回调中，`$this`以正常方式访问对象的属性。另请注意，我建议将回调标记为私有或受保护，以防止不必要的外部调用者；大概，您不希望他们为每种类型执行错误的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T15:29:10.907

作为对您的编辑的回应，您能不能不做这样的事情？

```
abstract class MethodOfTransport {
    protected $model;

    public function __construct($model) {
        $this->model = $model;
    }

    abstract public function printKind();

    public static function create($model, $type) {
       $object = new $type($model);
       return $object;
    }
}

class cycle extends MethodOfTransport {
    public function printKind() {
        echo 'im a cycle, model: '.$this->model.'<br />';
    }
}

class car extends MethodOfTransport {
    public function printKind() {
        echo 'im a car, model: '.$this->model.'<br />';
    }
}

$maserati = MethodOfTransport::create('maserati4', 'car');
$maserati->printKind();

$ducati =  MethodOfTransport::create('maserati4', 'cycle');
$ducati->printKind(); 
```

# multithreading - 由于明显的线程问题，无法停止 Tomcat

> ID：835149
> 
> 赞同：2
> 
> 时间：2009-05-07T14:55:53.857
> 
> 标签：multithreading, spring, tomcat

我们的 Java webapp 在 Ubuntu 上的 Apache Tomcat 6.0.18 和 Java 1.6.0_6 上运行，我们可以很好地停止 tomcat。

但是，在使用 Java 1.6.0_13 的 Red Hat Enterprise Linux 上将相同的 war 文件部署到 Apache Tomcat 6.0.18 时，调用`/etc/init.d/tomcat6 stop`不会停止 Tomcat。我还没有尝试在 Red Hat 上使用 1.6.0_6 来看看会发生什么。在我到达那里之前，有什么想法吗？

jstack 显示没有死锁。webapp 使用 Spring 2.5.6 和 JAX-WS 来公开基于 SOAP 的 web 服务，以防万一。

谢谢您的帮助。

# javascript - DeviantArt 是如何在他们的图像中实现阴影的？

> ID：835154
> 
> 赞同：1
> 
> 时间：2009-05-07T14:56:14.900
> 
> 标签：javascript, jquery

我只想知道 [DeviantArt.com](http://browse.deviantart.com/?order=24&offset=24)是如何在每个图像上实现阴影的。

如果您查看缩略图，您会发现图像有点阴影。我认为他们是用 Javascript 完成的，因为当我关闭我的 Javascript 时，阴影就消失了。他们也在使用 jQuery btw。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T14:58:14.443

我相信它在服务器端。

如果你看到：[http ://sh.deviantart.com/x/170/100/logo3.png](http://sh.deviantart.com/x/170/100/logo3.png)

您可以更改“变量”以适合您的尺寸。

然后我猜它只是图像上的背景属性，带有一些填充以将图像放置在中心。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T15:03:45.880

他们的 javascript 被混淆了，所以很难理解正在发生的事情。如果您检查他们的图像，您会发现它们被一个名为“shadow”的类封装在一个跨度中，并且它具有如下背景图像的样式：

```
<span style="background-image: url(http://sh.deviantart.com/x/150/134/logo3.png);" class="shadow"> 
```

* * *

但是，如果您正在寻找向图像添加阴影的客户端方式，请查看此脚本： http: [//www.netzgesta.de/corner/](http://www.netzgesta.de/corner/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:04:42.180

使用 FireBug 检查缩略图，您将看到缩略图位于具有 style="background-image: url( [http://sh.deviantart.com/x/150/100/logo3.png](http://sh.deviantart.com/x/150/100/logo3.png) ); 的 span 元素中； "

所以基本上有一个模仿阴影的图像背景的跨度。

# c# - .NET 中令人尴尬的可并行化任务

> ID：835155
> 
> 赞同：3
> 
> 时间：2009-05-07T14:56:20.813
> 
> 标签：c#, .net, parallel-processing

我正在解决一个需要执行许多令人尴尬的可并行化任务的问题。该任务是通过从数据库中读取数据来创建的，但是**所有任务的集合将超过**机器上的内存量，因此必须创建、处理和处置任务。我想知道解决这个问题的好方法是什么？我正在考虑以下两种方法：

1.  实现一个同步的任务队列。实现一个生产者（任务创建者），它从数据库中读取数据并将任务放入队列中（将队列中当前的任务数量限制为一个恒定值，以确保不超过内存量）。有多个消费者进程（任务处理器）从队列中读取任务、处理任务、存储结果并处理任务。在这种方法中，大量的消费者进程会是多少？

2.  使用 .NET 并行扩展（PLINQ 或并行），但我知道必须创建一个任务集合（我们可以在并行处理的同时将任务添加到集合中吗？）。所以我们将创建一批任务——说一次 N 个任务，然后处理这批任务并读取另外 N 个任务。

您对这两种方法有何看法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T15:09:32.387

使用有界队列的 ThreadPool 以避免使系统不堪重负。

如果您的每个工作任务都受 CPU 限制，那么最初配置您的系统，使系统中的线程数等于您的机器可以运行的硬件线程数。

如果您的任务不受 CPU 限制，那么您将不得不试验池大小以获得适合您特定情况的最佳解决方案

您可能必须尝试使用​​任何一种方法来获得最佳配置。

基本上，测试、调整、测试、重复，直到你满意为止。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T15:19:02.707

我没有机会实际使用 PLINQ，但我知道 PLINQ（如 vanilla LINQ）是基于 IEnumerable 的。因此，我认为这可能是通过 C# 迭代器块（即 yield 关键字）实现任务生产者的情况。

假设您没有执行任何必须提前知道整个任务集的操作（例如排序），我希望 PLINQ 只会消耗它一次可以处理的尽可能多的任务。此外，[本文](http://msdn.microsoft.com/en-us/magazine/cc163329.aspx)还引用了一些策略来控制 PLINQ 如何使用输入（标题为“处理查询输出”的部分）。

**编辑**：将 PLINQ 与 ThreadPool 进行比较。

根据[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/magazine/cc163340.aspx)，有效地将工作分配给线程池并非易事，即使您“正确”地进行操作，使用 TPL 通常也会表现出更好的性能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T15:03:01.467

使用[线程池](http://msdn.microsoft.com/en-us/library/3dasc8as.aspx?ppud=4)。

然后，您可以将所有内容排队，并且项目将在线程变得可用于池时运行，而不会压倒系统。唯一的技巧是确定一次运行的最佳线程数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T15:02:05.213

听起来像是 Microsoft HPC Server 2008 的工作。鉴于任务的数量是压倒性的，您需要某种并行进程管理器。这就是 HPC 服务器的全部意义所在。

[http://www.microsoft.com/hpc/en/us/default.aspx](http://www.microsoft.com/hpc/en/us/default.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T15:55:38.703

为了给出一个好的答案，我们需要回答几个问题。

每个单独的任务是否可并行化？还是每个任务都是可并行化主任务的产物？

另外，是任务的数量会导致系统内存不足，还是每个任务持有和处理的数据量会导致系统内存不足？

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-07T19:15:41.563

听起来[Windows Workflow Foundation](http://msdn.microsoft.com/en-us/netframework/bb887609.aspx) (WF) 可能是用于执行此操作的好东西。它还可能为您带来一些额外的好处，例如暂停/恢复您的任务。

# iphone - 如何创建可重复使用的加载屏幕？

> ID：835161
> 
> 赞同：1
> 
> 时间：2009-05-07T14:57:12.137
> 
> 标签：iphone

如何创建可以在任何给定时间重复使用的加载屏幕。我知道 Default.png，但我需要在应用程序生命周期的任何时候灵活地插入加载屏幕。

这就是我迄今为止所拥有的。

```
//inside a method that gets called by a UIButton

LoadingViewController* loadController = [[LoadingViewController alloc] initWithNibName:@"Loading" bundle:nil vertical:NO];
[self.view addSubview: loadController.view];

//some method call that takes a few seconds to execute
[self doSomething];

//This loads some other view, my final view
[self.view addSubview: someOtherView] 
```

但似乎从未显示加载视图。相反，之前的视图会一直保留在那里，直到添加了“someOtherView”。我放了跟踪日志，代码似乎确实被执行了，我什至用 sleep(2) 替换了 [self doSomething]，但中间加载视图从未显示。

如果我删除 [self.view addSubview:someOtherView]; 然后几秒钟后......（在 doSomething 完成执行之后）显示加载视图，因为没有视图被推到它上面，但这显然不是我想要的功能。

可以解释这种行为吗？我是否误解了渲染周期，因为视图（至少在屏幕上）似乎没有立即更新，即使我调用 [self.view addSubview: loadController.view];

我需要创建一个单独的线程吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T15:20:12.220

通常，要使 UI 中的更改对用户可见，控制必须返回到主 runLoop。只有在关闭加载视图并将其替换为另一个视图后，您才会返回到 runLoop。处理此问题的一种策略是将执行加载的代码移动到另一个线程上。NSOperation 和 NSOperationQueue 可用于此。

更简单的方法是使用 performSelectorInBackground:withObject 进行处理。处理完成后，可以再次更新 UI 以显示数据。重要的是要记住 UI 更新必须在主线程上执行。使用 performSelectorOnMainThread:withObject:waitUntilDone: 从加载线程完成此操作。

这听起来很复杂，但实际上就像将单个方法分解为三个单独的方法一样简单，如下所示：

*   显示加载视图并启动后台进程 - 这是按钮操作方法。
*   执行后台加载 - 从按钮操作函数调用 performSelectorInBackground:withObject。
*   移除加载视图并使用数据更新显示 - 从后台线程调用 performSelectorOnMainThread:withObject:waitUntilDone。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T15:12:02.180

我创建了 UIView 的子类，在其中初始化了加载视图的工作方式和外观。（我的视图出现并从底部滑入一个漂亮的动画）。

然后我添加了处理加载视图是否应该在 UIViewController 的子类中可见的代码。

然后我让我所有的视图控制器成为我的新视图控制器类的子类，这使我可以这样做：

```
[self showloadingMessage:@"loading..."]; 
```

在我所有的视图控制器中......

# c++ - 如何通过套接字编程在两台机器上发送文件？

> ID：835171
> 
> 赞同：0
> 
> 时间：2009-05-07T14:58:13.117
> 
> 标签：c++, winapi, visual-c++, networking, mfc

我需要将目录中的所有文件发送到不同的机器，该目录内部可能包含子目录。

在这方面有什么帮助吗？

另一个疑问是：我还听说我们可以使用 FTP 发送文件，如果可以的话，这是两者之间的最佳选择。有什么帮助吗？

我需要使用 vc++/c++ 在 Windows 平台上实现它

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T15:06:15.750

一种可能性是 Windows API 中的 TransmitFile() 函数。您必须遍历目录才能使用自己的代码查找单个文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-24T09:18:29.960

1.  听起来像一个家庭作业问题。
2.  FTP 在内部使用套接字。

对问题进行初步尝试并将其发布在此处。如果人们认为您正在尝试，而不仅仅是免费加载，您将获得更多帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T15:34:29.473

您可能应该合并并压缩源端的文件/目录。
在另一端传输和解绑。

bzip ( [http://www.bzip.org/](http://www.bzip.org/) ) 是一个帮助库（免费）

如果你做得好，你应该能够在内存中做所有事情，但你也可以使用中间文件。

# iphone - UIToolBar - 如何处理按钮溢出？

> ID：835172
> 
> 赞同：1
> 
> 时间：2009-05-07T14:58:13.320
> 
> 标签：iphone, uibarbuttonitem, uitoolbar

我有一个带有工具栏的视图 - 工具栏上的每个按钮都代表用户正在撰写的一条新消息。我花了几个工作日才弄清楚如何处理视图切换等。但是现在我已经弄清楚了，我遇到了一些 UI 问题。

当我有超过 11 个按钮时（我知道，用户应该在创建第 11 个之前真正发送前 10 个，但我想彻底）按钮会从屏幕末端消失。没有指示器（除了您可以看到的半按钮），还有可以按下的其他按钮。

以前有没有人遇到过这样的情况，你是怎么处理的？

我最初的想法是当有超过（比如说）8个按钮时，我以编程方式制作第一个和最后一个按钮“<”和“>”按钮，通过删除和添加按钮到我的[工具栏项]按钮将向下滑动按钮.

有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T23:23:32.327

与其为 iPhone 创建新类型的 UI（Apple 可能接受也可能不接受），最好只是告诉用户他/她已达到限制并且必须在他们创建之前发送消息一个新的。就像 Safari 在您尝试打开第 10 个网页时所做的那样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-21T23:08:07.113

我认为 Kane 可能是正确的，但是您尝试做的听起来很像可滚动的标签栏。Three20 提供了一个类来处理这个问题，或者你可以自己实现它。操作系统中对此没有任何规定（我认为如果你说你试图在下面放置 10 个按钮，UI 人员可能会强烈反对，更不用说超过 10 个了。）

# wpf - 更换桌面壁纸/在桌面上绘图

> ID：835175
> 
> 赞同：3
> 
> 时间：2009-05-07T14:58:24.257
> 
> 标签：wpf, windows, desktop, wallpaper

我想对我的 Windows 桌面进行一些自定义绘图，使其看起来可以替换桌面背景（壁纸）。我的第一次尝试是获得一个 DC`desktopListView`并吸引它：

```
IntPtr desktopDC = GetWindowDC(desktopListView);
Graphics g = Graphics.FromHwnd(desktopDC); //<-- fails on out of memory error 
```

然后，我尝试创建一个 NativeWindow 并`WM_PAINT`通过将本机窗口的句柄分配给桌面并进行自己的绘图来捕获消息，但我无法看到桌面上的任何消息。

理想情况下，我想在 WPF 而不是 Windows 窗体中执行此操作。有什么线索可以创建一个我可以绘制到的 WPF 窗口，该窗口位于桌面图标下方但位于墙纸顶部，以便它忽略任何鼠标消息并且桌面继续正常工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:09:55.570

如果您获得桌面的窗口句柄，您可以创建一个新窗口并将您自己的自定义窗口添加为它的子窗口。把它放在列表视图后面可能会给你你需要的结果，尽管我不能 100% 确定透明度的效果如何。

找到一些代码 - 如果您不需要处理多个改变形状的屏幕，您需要的大部分内容都在第一部分。

```
 public void SetDesktopWindows()
    {
        Thread.Sleep(0);
        while (this.Count < Screen.AllScreens.Length)
        {
            OrangeGuava.Desktop.DesktopWindow.DesktopControl dtc = new OrangeGuava.Desktop.DesktopWindow.DesktopControl();
            User32.SetParent(dtc.Handle, User32.FindWindow("ProgMan", null));
            this.Add(dtc);

        }

        int minx = 0;
        int miny = 0;

        foreach (Screen screen in Screen.AllScreens)
        {               
            if (screen.Bounds.Left < minx) minx = screen.Bounds.Left;
            if (screen.Bounds.Top < miny) miny = screen.Bounds.Top;
        }

        for (int i = Screen.AllScreens.Length; i < Count; i++)
        {
            OrangeGuava.Desktop.DesktopWindow.DesktopControl dtc = (OrangeGuava.Desktop.DesktopWindow.DesktopControl)this[i];
            dtc.Hide();
        }

        for (int i = 0; i < Screen.AllScreens.Length; i++)
        {
            OrangeGuava.Desktop.DesktopWindow.DesktopControl dtc = (OrangeGuava.Desktop.DesktopWindow.DesktopControl)this[i];
            dtc.DeviceId = i.ToString();

            Rectangle r = Screen.AllScreens[i].WorkingArea;
            r.X -= minx;
            r.Y -= miny;

            dtc.SetBounds(r.X, r.Y, r.Width, r.Height);

            dtc.displaySettingsChanged(null, null);

        }

    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T17:06:07.973

我通过让我的窗口`WM_WINDOWPOSCHANGING`通过设置来响应消息来做到这一点`WINDOWPOS.hWndInsertAfter = HWND_BOTTOM`。这对操作系统说：确保我的窗口位于所有其他窗口的下方，并使其看起来好像您的窗口粘在桌面上。

# regex - awk：根据行的存在修改或追加一行

> ID：835180
> 
> 赞同：1
> 
> 时间：2009-05-07T14:58:59.230
> 
> 标签：regex, deployment, awk, configuration-files

我有一个小的 awk 脚本，它可以进行一些就地文件修改（对 Java`.properties`文件，给你一个想法）。这是影响大量用户的部署脚本的一部分。

我希望能够设置默认值，将文件的其余部分保留在用户的偏好中。这意味着如果缺少配置行，则附加配置行，如果存在则对其进行修改，其他所有内容保持不变。

目前我使用这样的东西：

```
# initialize
BEGIN {
  some_value_set      = 0
  other_value_set     = 0

  some_value_default  = "some.value=SOME VALUE"
  other_value_default = "other.value=OTHER VALUE"
}

# modify existing lines
{
  if (/^some\.value=.*/) 
  {
    gsub(/.*/, some_value_default)
    some_value_set = 1
  }
  else if (/^other\.value=.*/)
  {
    gsub(/.*/, other_value_default)
    other_value_set = 1
  }
  print $0
}

# append missing lines
END {
  if (some_value_set   == 0) print some_value_default
  if (other_value_set  == 0) print other_value_default
} 
```

尤其是当我要控制的行数变大的时候，这就越来越麻烦了。我的 awk 知识并不是那么好，上面的内容只是*感觉*不对 - 我该如何简化呢？

PS：如果可能的话，我想留在awk。请不要只推荐使用 Perl/Python/whatever 会容易得多。:-)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T15:32:24.690

```
BEGIN {
    defaults["some.value"]  = "SOME VALUE"
    defaults["other.value"] = "OTHER VALUE"
}

{
    for (key in defaults) {
        pattern = key
        gsub(/\./, "\\.", pattern)
        if (match($0, "^" pattern "=.*")) {
            gsub(/=.*/, "=" defaults[key])
            delete defaults[key]
        }
    }
    print $0
}

END {
    for (key in defaults) {
        print key "=" defaults[key]
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T15:14:49.957

我的 AWK 生锈了，所以我不会提供实际代码。

*   使用正则表达式和值初始化数组。
*   对于每一行，迭代数组并进行适当的替换。清除使用过的条目。
*   最后，迭代数组并为剩余条目附加行。

# asp.net-mvc - 在 ASP.NET MVC 中捕获输出

> ID：835181
> 
> 赞同：2
> 
> 时间：2009-05-07T14:59:12.227
> 
> 标签：asp.net-mvc

我需要捕获视图的所有渲染输出/html，以便我可以保留结果。如何在 ASP.NET MVC 中执行此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T15:39:08.823

有一篇关于部分输出缓存的好帖子，其中包含有关如何使用属性捕获输出的代码。

帖子： http: [//blog.codeville.net/2008/10/15/partial-output-caching-in-aspnet-mvc/](http://blog.codeville.net/2008/10/15/partial-output-caching-in-aspnet-mvc/)
代码： http: [//blog.codeville.net/blogfiles/2008/October/ ActionOutputCacheAttribute.cs](http://blog.codeville.net/blogfiles/2008/October/ActionOutputCacheAttribute.cs)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-05T13:12:14.017

MVC 通过 HttpContext 中的 HtmlTextWriter 对象查看输出到响应流。因此，完成任务的一种方法是将现有的 HttpContext 对象替换为包含输出到 StringBuilder 而不是响应流的 HtmlTextWriter 的新对象。

如果有点复杂，这相当简单，并且在此博客文章中进行了详细介绍：http: [//andrewlocatelliwoodcock.com/2011/04/28/capturing-the-output-of-a-view-as-a-string /](http://andrewlocatelliwoodcock.com/2011/04/28/capturing-the-output-of-a-view-as-a-string/)

我已经成功地使用了这种技术来捕获视图输出，因为它被发送到浏览器。

不要忘记：如果您还想真正看到视图，一旦您捕获了输出，您还需要将其写入响应流......

# .net - 在 MEF 和 MAF 之间进行选择（System.AddIn）

> ID：835182
> 
> 赞同：166
> 
> 时间：2009-05-07T14:59:24.627
> 
> 标签：.net, add-in, mef, system.addin, maf

Managed Extensibility Framework (MEF) 和 Managed AddIn Framework (MAF, aka System.AddIn) 似乎完成了非常相似的任务。根据这个 Stack Overflow 问题，[MEF 是 System.Addin 的替代品吗？](https://stackoverflow.com/questions/124040/is-mef-a-replacement-for-system-addin)，您甚至可以同时使用两者。

您什么时候选择使用其中一个？在什么情况下你会选择两者一起使用？

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2009-05-08T15:34:33.217

我一直在评估这些选项，这是我得出的结论。

MAF 是一个真正的插件框架。您可以完全分离您的插件，甚至在单独的应用程序域中运行它们，这样如果插件崩溃，它不会关闭您的应用程序。它还提供了一种非常完整的方法，可以将插件与除您提供的合同之外的任何内容分离。事实上，您可以在升级主应用程序时对您的合约适配器进行版本化，以提供对旧插件的向后兼容性。虽然这听起来不错，但要跨越应用程序域，您必须付出沉重的代价。您为速度以及可以来回发送的类型的灵活性付出了这个代价。

MEF 更像是依赖注入，具有一些额外的好处，例如可发现性和......（在这个上画一个空白）。MAF 的隔离程度在 MEF 中不存在。它们是针对两种不同事物的两种不同框架。

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2009-05-14T20:36:12.657

Danielg 说的很好。我要补充：

如果您观看有关 System.Addins 的视频，他们显然在谈论非常大的项目。他谈到一个**团队**管理主机应用程序，另一个**团队**管理每个插件，以及第三个**团队**管理合同和管道。基于此，我认为 System.Addins 显然适用于更大的应用程序。我正在考虑诸如 SAP 之类的 ERP 系统之类的应用程序（可能没有那么大，但你明白了）。如果您观看了这些视频，您会发现使用 System.Addins 的工作量非常大。如果您有很多公司为您的系统编写 3rd 方加载项，并且您不能违反任何这些加载项合同，那么这将很有效。

另一方面，MEF 似乎与 SharpDevelop 的插件方案、Eclipse 插件架构或 Mono.Addins 有更多相似之处。它比 System.Addins 更容易理解，而且我相信它更灵活。您失去的东西是您没有使用 MEF 获得 AppDomain 隔离或强大的版本控制合同。MEF 的优势在于您可以将整个应用程序构建为部件的组合，因此您可以为不同的客户提供不同配置的产品，如果客户购买了新功能，您只需将该功能的部件放到他们的安装目录中应用程序看到它并运行它。它也有利于测试。您可以实例化您想要测试的对象，并为其所有依赖项提供模拟对象，

我要提到的最重要的一点是，尽管 System.Addins 已经在框架中，但我没有看到很多人使用它的证据，但 MEF 只是坐在 CodePlex 上，据说应该包含在.NET 4，人们已经开始使用它构建大量应用程序（包括我自己）。我认为这可以告诉您有关这两个框架的一些信息。

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2009-08-05T14:43:48.120

开发并发布了 MAF 应用程序。我对 MAF 的看法有些厌烦。

MAF 在最坏的情况下是一个“去耦合”系统或“松耦合”系统。MEF 充其量是“耦合”系统或“松散耦合”系统。

我们通过使用 MAF 实现的 MAF 好处是：

1.  在应用程序运行时安装新组件或更新现有组件。可以在应用程序运行时更新插件，并且更新会无缝地呈现给用户。为此，您必须拥有 AppDomains。

2.  基于购买的组件的许可。我们可以控制用户的角色和权限加载了哪些 AddIn，以及该 AddIn 是否获得使用许可。

3.  快速开发（更快的上市时间）。插件开发与敏捷方法完美契合，开发团队一次开发一个插件，而无需同时开发与应用程序其余部分的集成部分。

4.  改进的 QA（一次仅 QA 一个组件）。然后，QA 可以针对单个功能测试和发布缺陷。测试用例更容易开发和实施。

5.  部署（在开发和发布时添加组件并且它们“正常工作”）。部署只是制作插件和安装文件的问题。无需考虑其他因素！

6.  新组件与旧组件一起工作。早期开发的插件继续工作。新插件无缝融入应用程序

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-05-22T14:56:18.353

在我看来，这两种技术实际上针对的是非常不同的用例。

MEF 通常最适合纯依赖注入场景，其中交付最终集成解决方案的个人或团队正在组装所有内容并保证整体完整性，但需要对关键功能进行不同的实现。

MAF 适用于某人/组正在开发平台或主机，而其他组将在事后以不受主机组控制的方式添加功能的场景。在这种情况下，需要更精细的机制来“保护”主机免受恶意插件的侵害（或相互保护插件）。

第三种类似模式的技术是整个 ProviderBase 方案。这也可以替换功能，但它的目标实际上是主机/应用程序绝对需要功能并且需要通过配置指定不同的实现。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-05-30T18:04:43.730

我刚刚发现这篇讨论 MAF 和 MEF 的冗长文章。 [http://emcpadden.wordpress.com/2008/12/07/managed-extensibility-framework-and-others/](http://emcpadden.wordpress.com/2008/12/07/managed-extensibility-framework-and-others/)

除了其他答案提出的观点之外，MEF 和 MAF 之间的主要区别之一似乎是托管可扩展性框架将允许一个可组合部分依赖于另一个。例如，它会让一个插件依赖于另一个插件。

托管可扩展性框架也不像 System.AddIn 那样真正区分主机和外接程序。就 MEF 而言，它们都只是可组合的部分。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2015-10-29T12:47:40.733

在我看来，发现差异的最好方法是一些动手代码。我找到了两个 MSDN 演练，都带有一个计算器示例，因此您可以轻松比较它们的实现：

**MEF：** **使用**[**MEF 部件**](https://msdn.microsoft.com/en-us/library/dd460648(v=vs.110).aspx)**的****简单**[计算器示例](https://msdn.microsoft.com/en-us/library/dd460648(v=vs.110).aspx) **（管理的可扩展性框架）**

 *******   展示如何使用 MEF 技术构建一个简单的计算器。不显示如何加载外部 dll。`catalog.Catalogs.Add(new DirectoryCatalog("Plugins", "*.dll"));` （但您可以通过使用而不是使用来简单地修改示例 `catalog.Catalogs.Add(new AssemblyCatalog(typeof(Program).Assembly));`并提取计算器代码和合同以分离 DLL 项目。）
*   MEF**不需要**特定的目录结构，使用起来简单直接，即使对于小型项目也是如此。它**与属性一起使用，**以声明导出的内容，易于阅读和理解。**例子：** `[Export(typeof(IOperation))] [ExportMetadata("Symbol", '+')] class Add: IOperation { public int Operate(int left, int right) { return left + right; } }`

*   MEF 不会自动处理版本控制

**MAF：带有** **V1**[和 V2 版本**MAF 插件**](https://msdn.microsoft.com/en-us/library/bb788290(v=vs.110).aspx) **的**
简单计算器（管理**的**插件框架）

 *******   展示如何使用 V1 插件构建计算器，然后如何转移到 V2 插件同时保持向后兼容性（**注意：您可以在**[此处](https://msdn.microsoft.com/en-us/library/vstudio/bb384194(v=vs.100).aspx)找到插件的 V2 版本，原始文章中的链接已损坏）
*   MAF**强制执行**特定的**目录结构，**并且需要大量样板代码才能使其工作，因此我不建议将其用于小型项目。 **例子：**

    > ```
    > Pipeline
    >   AddIns
    >     CalcV1
    >     CalcV2
    >   AddInSideAdapters
    >   AddInViews
    >   Contracts
    >   HostSideAdapters 
    > ```

MEF 和 MAF 都包含在 .NET Framework 4.x 中。如果您比较这两个示例，您会注意到与 MEF 框架相比，MAF 插件的复杂性要高得多——因此您需要仔细考虑何时使用这些框架中的哪一个。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-09-27T14:21:23.023

MAF 和 MEF 都可以使用 AppDomain，并且都可以在运行时加载/卸载 dll。但是我发现的区别是：MAF 插件是解耦的，MEF 组件是松耦合的；MAF “激活”（新实例），而 MEF 默认生成实例。

使用 MEF，您可以使用泛型为任何合同制作 GenericHost。这意味着 MEF 加载/卸载和组件管理可以在一个通用库中并通用。

# proof - 如何证明 (forall x, P x /\ Q x) -> (forall x, P x)

> ID：835183
> 
> 赞同：7
> 
> 时间：2009-05-07T14:59:32.490
> 
> 标签：proof, coq

如何在 Coq 中证明 (forall x, P x /\ Q x) -> (forall x, P x)？已经尝试了几个小时，但无法弄清楚如何将先行词分解为 Coq 可以消化的东西。（我是新手，显然:)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-06-03T20:14:39.693

您可以通过仅应用 H 来更快地完成它，但是这个脚本应该更清晰。

```
Lemma foo : forall (A:Type) (P Q: A-> Prop), (forall x, P x /\ Q x) -> (forall x, P x).
intros.
destruct (H x). 
exact H0.
Qed. 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-09T17:11:08.583

实际上，当我发现这个时，我想出了这个：

[计算机科学家数学 2](http://www.cs.nott.ac.uk/~txa/g52mc2/)

在第 5 课中，他解决了完全相同的问题并使用“cut (P x /\ Q x)”将目标从“P x”重写为“P x /\ Q x -> P x”。从那里你可以做一些操作，当目标只是“P x /\ Q x”时，你可以应用“forall x : P x /\ Q x”，剩下的就很简单了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T19:49:37.770

尝试

```
elim (H x). 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-06-03T20:24:19.437

```
Assume ForAll x: P(x) /\ Q(x)
   var x; 
      P(x) //because you assumed it earlier
   ForAll x: P(x)
(ForAll x: P(x) /\ Q(x)) => (ForAll x: P(x)) 
```

直观地说，如果对于所有 x，P(x) AND Q(x) 成立，那么对于所有 x，P(x) 成立。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2019-10-27T20:56:27.737

这是答案：

```
Lemma fa_dist_and   (A : Set) (P : A -> Prop) (Q: A -> Prop): 

(forall x, P x) /\ (forall x, Q x) <-> (forall x : A, P x /\ Q x).

Proof.

split.

intro H.

(destruct H).

intro H1.

split.

(apply H).

(apply H0).

intro H.

split.

intro H1.

(apply H).

intro H1.

(apply H).

Qed. 
```

您可以在此文件中找到其他已解决的练习：[https ://cse.buffalo.edu/~knepley/classes/cse191/ClassNotes.pdf](https://cse.buffalo.edu/~knepley/classes/cse191/ClassNotes.pdf)

# php - 在 PHP 中处理 Soap 超时

> ID：835184
> 
> 赞同：36
> 
> 时间：2009-05-07T14:59:40.273
> 
> 标签：php, web-services, soap, error-handling

我正在开发一个项目，我正在使用 SOAP Web 服务验证来自用户的信息。我目前正在处理错误，假设我正在接收来自 Web 服务的响应，但还需要处理服务超时或不可用的边缘情况。

在超时或服务不可用的情况下，我需要假装请求成功（网络服务批准了信息），但我不清楚抛出了哪些异常。

一些伪代码：

```
// $client is PHP's SoapClient class
try {
  $response = $client->SomeSoapRequest();
}
catch(SoapFault $e){
  // handle issues returned by the web service
}
catch(Exception $e){
  // handle PHP issues with the request
} 
```

我似乎找不到的是：

1.  超时是一个`SoapFault`吗？如果是这样，区分超时错误和 Web 服务问题（如类型错误等）的最佳方法是什么？我发现一页提到了一个错误，其中消息是“加载标头错误”的影响，但没有提到这是否是肥皂故障。
2.  服务不可用可能会如何发生？PHP 异常似乎有意义（SoapFault 将从 Web 服务返回，其中不可用可能是套接字问题或类似问题）？
3.  是否有我可以测试超时的现有服务（例如示例）？大多数与超时相关的讨论似乎都与通过扩展默认超时设置来防止超时有关，这在这种情况下并不理想。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2013-01-11T22:18:10.940

1) 在超时的情况下，PHP 使用`faultcode="HTTP"`and抛出 SoapFault 异常`faultstring="Error Fetching http headers"`。

2) 在我看来，区分超时错误和 Web 服务问题的最佳方法是查看[SoapFault 类](http://php.net/manual/en/class.soapfault.php)`faultcode`的和`faultstring`成员。 特别是，该元素旨在供软件使用，以提供用于识别故障的算法机制。 正如您也可以在[PHP 手册的评论中](http://php.net/manual/en/class.soapfault.php#94353)看到的那样，没有读取该属性的方法，因此您必须直接访问它（例如），因为该方法不起作用。[SOAP 1.1 规范](http://www.w3.org/TR/2000/NOTE-SOAP-20000508/#_Toc478383510)为该字段定义了四个可能的 值：
`faultcode`
`faultcode``$e->faultcode``getCode()`
`faultcode`

*   **VersionMismatch**：处理方发现 SOAP Envelope 元素的命名空间无效
*   **MustUnderstand**：处理方不理解或不遵守的 SOAP Header 元素的直接子元素包含值为“1”的 SOAP mustUnderstand 属性
*   **Client**：Client 类错误表明消息的​​格式不正确或没有包含适当的信息才能成功。例如，消息可能缺少正确的身份验证或支付信息。这通常表明消息不应该在没有更改的情况下重新发送。
*   **Server**：Server 类错误表明无法处理消息，原因并非直接归因于消息本身的内容，而是归因于消息的处理。例如，处理可能包括与没有响应的上游处理器通信。该消息可能在稍后的时间点成功。

除了这些代码之外，PHP 还使用`HTTP`代码来识别协议级别发生的错误（例如：套接字错误）；例如，如果您`add_soap_fault`在[ext/soap/php_http.c](https://github.com/php/php-src/blob/master/ext/soap/php_http.c)源代码中进行搜索，您可以看到这些错误是何时生成的。
通过在 PHP SOAP 扩展源文件中搜索`add_soap_fault`和`soap_server_fault`函数，我构建了以下 PHP`SoapFault`异常列表：

```
HTTP
----
Unable to parse URL
Unknown protocol. Only http and https are allowed.
SSL support is not available in this build
Could not connect to host
Failed Sending HTTP SOAP request
Failed to create stream??
Error Fetching http headers
Error Fetching http body: No Content-Length: connection closed or chunked data
Redirection limit reached: aborting
Didn't recieve an xml document
Unknown Content-Encoding
Can't uncompress compressed response
Error build soap request

VersionMismatch
---------------
Wrong Version

Client
------
A SOAP 1.2 envelope can contain only Header and Body
A SOAP Body element cannot have non Namespace qualified attributes
A SOAP Envelope element cannot have non Namespace qualified attributes
A SOAP Header element cannot have non Namespace qualified attributes
Bad Request
Body must be present in a SOAP envelope
Can't find response data
DTD are not supported by SOAP
encodingStyle cannot be specified on the Body
encodingStyle cannot be specified on the Envelope
encodingStyle cannot be specified on the Header
Error cannot find parameter
Error could not find "location" property
Error finding "uri" property
looks like we got "Body" with several functions call
looks like we got "Body" without function call
looks like we got no XML document
looks like we got XML without "Envelope" element
Missing parameter
mustUnderstand value is not boolean
SoapClient::__doRequest() failed
SoapClient::__doRequest() returned non string value
Unknown Data Encoding Style
Unknown Error
DataEncodingUnknown

MustUnderstand
--------------
Header not understood

Server
------
Couldn't find WSDL
DTD are not supported by SOAP
Unknown SOAP version
WSDL generation is not supported yet 
```

3）要模拟超时条件，请尝试使用以下代码：

**肥皂客户端.php**

```
<?php

ini_set('default_socket_timeout', 10);

$client = new SoapClient(null, 
  array(
    'location' => "http://localhost/soapserver.php",
    'uri'      => "http://localhost/soapserver.php",
    'trace'    => 1
  )
);

try {
    echo $return = $client->__soapCall("add",array(41, 51));
} catch (SoapFault $e) {
    echo "<pre>SoapFault: ".print_r($e, true)."</pre>\n";
    //echo "<pre>faultcode: '".$e->faultcode."'</pre>";
    //echo "<pre>faultstring: '".$e->getMessage()."'</pre>";
}

?> 
```

**肥皂服务器.php**

```
<?php

function add($a, $b) {
  return $a + $b;
}

sleep(20);

$soap = new SoapServer(null, array('uri' => 'http://localhost/soapserver.php'));
$soap->addFunction("add");
$soap->handle();

?> 
```

请注意脚本`sleep`中的调用时间 (20) 比为脚本中的参数`SoapServer.php`指定的时间 (10) 最长。 如果您想模拟服务不可用，例如，您可以在脚本中将协议从更改为，假设您的 Web 服务器未配置为 SSL；通过这样做，PHP 应该抛出“无法连接到主机”SoapFault。`default_socket_timeout``SoapClient.php`
`location``http``https``soapclient.php`

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-09-08T19:41:01.937

在通过 HTTPS 进行 SOAP 调用时似乎[`default_socket_timeout`](http://php.net/default_socket_timeout)没有考虑到：

*   [错误 #48524 - SOAP+HTTPS 调用不考虑超时设置](http://bugs.php.net/bug.php?id=48524)。

在撰写本文时存在错误。正如在已删除的答案[*Timeing Out PHP Soap Calls（2009 年 10 月 21 日；由 Robert F. Ludwick 出版）*](http://www.darqbyte.com/2009/10/21/timing-out-php-soap-calls/)[`SoapClient::__doRequest()`](http://php.net/soapclient.dorequest.php)中引用的博客文章 Robert Ludwick 的评论指出，这篇文章讨论的解决方法（用 curl 请求覆盖）可以解决这个问题错误也。

*   [<http://www.darqbyte.com/2009/10/21/timing-out-php-soap-calls/>的存档副本](http://web.archive.org/web/20140802215339/http://www.darqbyte.com/2009/10/21/timing-out-php-soap-calls)

另一个相关的错误是：

*   [错误 #41631 - default_socket_timeout 不适用于 SSL](https://bugs.php.net/bug.php?id=41631)

* * *

博客文章中提到的代码已经发生了一些变化，可以在 Github 上找到支持 HTTP 身份验证的最新形式：

*   [SoapClientTimeout.class.php](https://gist.github.com/hakre/da6435f967d40c66f479#file-soapclienttimeout-class-php)

无论如何，不​​再需要该变通方法，因为此问题已在 PHP SOAPClient 扩展中修复。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-07T16:53:39.783

处理服务中的超时

```
$client = new SoapClient($wsdl, array("connection_timeout"=>10));

// SET SOCKET TIMEOUT
if(defined('RESPONSE_TIMEOUT') &&  RESPONSE_TIMEOUT != '') {
 ini_set('default_socket_timeout', RESPONSE_TIMEOUT);
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-12-20T16:15:08.893

根据我的经验，如果`$e->getMessage`是“错误获取 http 标头”，您正在处理网络超时。

如果`$e->getMessage`是“无法连接到主机”之类的内容，则您尝试访问的服务已关闭。

然后是“看起来我们没有 XML 文档”，这更神秘，可能意味着不同的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-27T21:20:51.817

我使用了两个因素来让我的 SoapClient 扩展抛出一个很好的异常。消息和请求返回的时间。我认为错误消息“错误获取 http 标头”也可能出现在其他一些情况下，因此需要时间检查。

以下代码应该是正确的

```
class SoapClientWithTimeout extends SoapClient {
    public function __soapCall ($params, ---) {
        $time_start = microtime(true);
        try {
            $result = parent::__soapCall ($params, ---);
        }
        catch (Exception $e) {
            $time_request = (microtime(true)-$time_start);
            if(
                $e->getMessage() == 'Error Fetching http headers' &&
                ini_get('default_socket_timeout') < $time_request
            ) {
                throw new SoapTimeoutException(
                    'Soap request most likly timed out.'.
                    ' It took '.$time_request.
                    ' and the limit is '.ini_get('default_socket_timeout')
                );
            }

            // E: Not a timeout, let's rethrow the original exception
            throw $e;
        }

        // All good, no exception from the service or PHP
        return $result;
    }
}

class SoapTimeoutException extends Exception {} 
```

然后我使用 SoapClientWithTimeout

```
$client = new SoapClientWithTimeout();
try {
    $response = $client->SomeSoapRequest();
    var_dump($response);
}
catch(SoapTimeoutException $e){
    echo 'We experienced a timeout! '. $e->getMessage();
}
catch(Exception $e) {
    echo 'Exception: '.$e->getMessage();
} 
```

调试您的服务超时。在调用服务之前添加以下行

```
ini_set('default_socket_timeout', 1); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-19T22:23:08.063

简单地`default_socket_timeout`通过 ini 设置全局可能无法满足您的要求。这会影响 SOAP 请求，但也会影响其他传出连接，包括 DB 连接。相反，重写 SoapClient 的 __doRequest() 方法来自己建立 HTTP 连接。然后，您可以在套接字上设置自己的超时，检测它，并抛出您可以捕获和处理的异常。

```
class SoapClientWithTimeout extends SoapClient {

    public function __construct ($wsdl, $options = null) {
        if (!$options) $options = [];

        $this->_connectionTimeout =
            @$options['connection_timeout']
            ?: ini_get ('default_socket_timeout');
        $this->_socketTimeout =
            @$options['socket_timeout']
            ?: ini_get ('default_socket_timeout');
        unset ($options['socket_timeout']);

        parent::__construct($wsdl, $options);
    }

    /**
     * Override parent __doRequest to add a timeout.
     */
    public function __doRequest (
        $request, $location, $action, $version, $one_way = 0
    ) {
        // Extract host, port, and scheme.
        $url_parts = parse_url ($location);
        $host = $url_parts['host'];
        $port =
            @$url_parts['port']
            ?: ($url_parts['scheme'] == 'https' ? 443 : 80);
        $length = strlen ($request);

        // Form the HTTP SOAP request.
        $http_req = "POST $location HTTP/1.0\r\n";
        $http_req .= "Host: $host\r\n";
        $http_req .= "SoapAction: $action\r\n";
        $http_req .= "Content-Type: text/xml; charset=utf-8\r\n";
        $http_req .= "Content-Length: $length\r\n";
        $http_req .= "\r\n";
        $http_req .= $request;

        // Need to tell fsockopen to use SSL when requested.
        if ($url_parts['scheme'] == 'https')
            $host = 'ssl://'.$host;

        // Open the connection.
        $socket = @fsockopen (
            $host, $port, $errno, $errstr, $this->_connectionTimeout
        );
        if (!$socket)
            throw new SoapFault (
                'Client',
                "Failed to connect to SOAP server ($location): $errstr"
            );

        // Send the request.
        stream_set_timeout ($socket, $this->_socketTimeout);
        fwrite ($socket, $http_req);

        // Read the response.
        $http_response = stream_get_contents ($socket);

        // Close the socket and throw an exception if we timed out.
        $info = stream_get_meta_data ($socket);
        fclose ($socket);
        if ($info['timed_out'])
            throw new SoapFault (
                'Client',
                "HTTP timeout contacting $location"
            );

        // Extract the XML from the HTTP response and return it.
        $response = preg_replace (
            '/
                \A       # Start of string
                .*?      # Match any number of characters (as few as possible)
                ^        # Start of line
                \r       # Carriage Return
                $        # End of line
             /smx',
            '', $http_response
        );
        return $response;
    }

} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-22T12:32:53.090

只需使用“stream_context”设置超时设置也用于 WSDL 加载（您需要设置 SoapClient $options['connection_timeout'] 之前）：

```
class SoapClient2 extends SoapClient
{
  public function __construct($wsdl, $options=null)
  {
    if(isset($options['connection_timeout']))
    {
      $s_options = array(
          'http' => array(
              'timeout' => $options['connection_timeout']
              )
          );
      $options['stream_context'] = stream_context_create($s_options);
    }
    parent::__construct($wsdl, $options);
  }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-26T11:19:58.533

猜猜我来晚了，但如果有人仍在寻找解决 php soap 客户端超时的方法——这对我有用：

*   [<http://www.darqbyte.com/2009/10/21/timing-out-php-soap-calls/>的存档副本](http://web.archive.org/web/20140802215339/http://www.darqbyte.com/2009/10/21/timing-out-php-soap-calls)

基本上用设置超时的 cURL 替换 PHP SoapClient。请记住，有时 WS 期望在 HTTP 标头中指定操作。该网站上发布的原始解决方案不包括（查看评论）。

# c# - 为什么可为空的 KeyValuePair<,> 没有键属性？

> ID：835189
> 
> 赞同：16
> 
> 时间：2009-05-07T15:01:10.053
> 
> 标签：c#, .net, generics, .net-2.0

我有以下内容：

```
KeyValuePair<string, string>? myKVP;
// code that may conditionally do something with it
string keyString = myKVP.Key;  
// throws 'System.Nullable<System.Collections.Generic.KeyValuePair<string,string>>' 
// does not contain a definition for 'Key' 
```

我确信这是有原因的，因为我可以看到该类型可以为空。是因为我试图在`null`可能导致坏事发生时访问密钥吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-07T15:02:33.247

试试这个：

```
myKVP.Value.Key; 
```

这是一个精简的版本`System.Nullable<T>`：

```
public struct Nullable<T> where T: struct
{
    public T Value { get; }
} 
```

由于该`Value`属性是类型的`T`，因此您必须使用该`Value`属性来获取您正在使用的包装类型实例。

**编辑：**我建议您`HasValue`在使用`Value`.

```
if (myKVP.HasValue)
{
    // use myKVP.Value in here safely
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T15:18:01.713

这是因为可空类型可以分配空值或实际值，因此您必须在所有可空类型上调用“.value”。“.value”将返回基础值或抛出 System::InvalidOperationException。

您还可以在可空类型上调用“.HasValue”，以确保为实际类型分配了值。

# c++ - C++ 项目的嵌入式浏览器是什么？

> ID：835201
> 
> 赞同：13
> 
> 时间：2009-05-07T15:02:40.237
> 
> 标签：c++, browser

是否有任何浏览器可以嵌入到 Windows 上的 C++ 应用程序中？

我需要典型浏览器具有的所有功能（HTTP 客户端、cookie 支持、DOM 样式 HTML 解析器、JavaScript 引擎），**但**渲染除外。因为我不需要渲染功能（这是浏览器相当大的一部分），所以我更喜欢具有非整体设计的浏览器，因此我不必将渲染内容包含到我的项目中。

如果它有 C++ 而不是 C API，那就太好了。

我需要这个嵌入式浏览器主要是因为我很难找到可以像浏览器一样处理损坏的 HTML 的 C++ HTML 解析器。
如果您知道，请回答[Library Recommendation: C++ HTML Parser](https://stackoverflow.com/questions/489522/library-recommendation-c-html-parser) SO question 或至少对其进行投票以增加有人给出好的答案的机会。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T15:09:34.493

听起来你只需要[libcurl](http://curl.haxx.se/libcurl/)之类的东西，它是一个 HTTP 库，可以让你执行 GET/POST/etc。

当我想到浏览器时，我通常会想到渲染/JavaScript 而不是 HTTP 库。

**编辑**

在那种情况下，我会看看[WebKit](http://webkit.org/)（我认为它有一个 C++ API），希望你不必投入太多。

**再次编辑**

再三考虑（因为渲染是浏览器所做的一个重要部分），你可能最好使用像[SpiderMonkey这样的独立 JS 引擎和像](http://www.mozilla.org/js/spidermonkey/)[Xerces-C](http://xerces.apache.org/xerces-c/)这样的独立 XML 解析器（加上可能使你的 HTML 更[整洁](http://tidy.sourceforge.net/)转换成 XML）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T16:35:09.217

我对您关于嵌入不需要渲染功能的 Web 浏览器的问题感到有些困惑。Web 浏览器按定义呈现网页，除非您只需要带有 JavaScript 功能的 HTTP 和 XML，这是浏览器功能的子集？

如果您需要将 Web 浏览器嵌入到您的 C++ 应用程序中，我建议您考虑使用 WebKit 插件附带的 Qt。它是 C++、LGPL 并且有一个非常好的 IDE（Qt Creator）。我在 unix (Ubuntu) 上使用 Qt Creator 尝试了 Qt，它非常令人印象深刻。调试器有点轻，但它只是第一个版本。Qt 到 Visual c++ 2008 的适配器现在是免费的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-09-08T23:47:48.547

您可能还想查看[Awesomium——](http://www.awesomium.com)它可免费用于非商业用途，并且具有您正在寻找的所有功能（如果您不需要渲染，请不要使用它）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-10-17T15:52:24.730

有一个名为 CEF = [The Chromium Embedded Framework](https://code.google.com/p/chromiumembedded/)的项目- 它是：

> 一个简单的框架，用于将基于 Chromium 的浏览器嵌入到其他应用程序中。它是由 Marshall Greenblatt 于 2008 年创立的基于 Google Chromium 项目的 BSD 许可开源项目。与主要专注于 Google Chrome 应用程序开发的 Chromium 项目本身不同，CEF 专注于促进第三方应用程序中的嵌入式浏览器用例。

是的：

> 基本 CEF 框架包括对 C 和 C++ 编程语言的支持。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-07T15:33:25.170

包括 javascript 支持和 html 解析使这项任务变得非常重要 - 您必须使用其中一种可用的浏览器。

*   IE 可通过其 COM 模型使用 - 您可以在窗口中创建它的实例，无论它是否不可见，并调用它的 javascript/html 功能。

它从一开始就被设计成这样使用，当然它工作正常。

其他选项是：

*   Gecko/Mozilla - 几年前它不能像这样使用，现在我认为它是。

*   WebKit/V8 - 尚未为 chrome 发布公共 API，您可以使用 webkit 本身，但它没有 javascript 引擎。另一种选择是查看 Chrome 代码库，看看是否可以从中获得所需的东西。

我可能会选择 IE，因为它可能是最简单的选择，而且我已经使用过它。在我看来，其他选项更像是构建浏览器，而不仅仅是使用它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-07T15:27:07.773

[壁虎](https://developer.mozilla.org/en/Gecko)呢？您可能不需要整个引擎，但您可能会发现它的一些组件很有用，例如[SpiderMonkey](https://developer.mozilla.org/en/SpiderMonkey)，它是一个用 C 编写的 JavaScript 引擎。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-08T05:30:59.977

我建议选择 Qt 进行 C++ 编程。它有一个内置库，可以[将 Webkit](http://doc.trolltech.com/4.5/webkit-previewer.html)与所有的花里胡哨的东西一起嵌入，而 Qt 通常是一个很棒的 C++ 库。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-04-05T07:27:16.543

老问题，我知道，但看看 [http://msdn.microsoft.com/en-us/library/ky29ffxd%28v=vs.94%29.aspx](http://msdn.microsoft.com/en-us/library/ky29ffxd%28v=vs.94%29.aspx)

IActiveScript 和系列 COM 接口允许在内存中执行脚本（不仅是 JS，任何注册为脚本解释器的语言）。

# c# - 使用 NHibernate 在 WHERE 子句中使用 NOT IN 进行查询

> ID：835214
> 
> 赞同：6
> 
> 时间：2009-05-07T15:04:49.090
> 
> 标签：c#, nhibernate

以这个查询为例：

```
select * from publisher 
where id not in (
    select publisher_id from record 
    where year = 2008 and month = 4
) 
```

谁能帮助我了解如何使用 NHibernate 构建和运行此查询？假设我有 2 个类：`Publisher`和`Record`.

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T16:28:26.050

试试这个：

```
DetachedCriteria c = DetachedCriteria.For<Record>()
    .SetProjection(Projections.Property("Publisher"))
    .Add(Restrictions.Eq("Year", 2008))
    .Add(Restrictions.Eq("Month", 4));
session.CreateCriteria(typeof(Publisher))
    .Add(Subqueries.PropertyNotIn("Id", c))
    .List(); 
```

# c# - 什么应该进入顶级命名空间？

> ID：835216
> 
> 赞同：0
> 
> 时间：2009-05-07T15:05:06.097
> 
> 标签：c#, .net, vb.net, namespaces, oop

什么应该进入顶级命名空间？比如我有MyAPI.WebLogic、MyAPI.Compression等，如果我把类放到顶层命名空间，是不是违反了封装原则？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T15:09:06.007

命名空间不适用于与 OOP 相关的概念，例如封装。那里是为了组织，所以以对您的应用程序有意义的方式组织它。我在网站上所做的大部分工作都有一个业务库，而且大多数情况下它都隐藏在一个命名空间下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T15:13:22.673

取决于类是什么。

我尝试遵循的一个准则是命名空间之间的依赖关系不应该遵循一个循环。换句话说，低级命名空间不能访问来自高级命名空间的类型。

这意味着顶级 MyAPI 命名空间必须包含：

*   高级代码：允许查看 MyAPI.WebLogic 和 MyAPI.Compression 内部的代码
*   或者，低级代码：MyAPI.WebLogic 和/或 MyAPI.Compression 使用的代码

Patrick Smacchia 写了很多关于以这种方式构建代码的优点，包括在这个站点上：[Detecting dependencies between namespaces in .NET](https://stackoverflow.com/questions/304967/detecting-dependencies-between-namespaces-in-net)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T15:07:08.150

取决于命名空间的真正用途。如果它是一个应用程序，那么可能是引导程序类、加载程序 etx、Main 等。我会说（与所有事情一样）“这取决于”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T15:09:44.260

我不认为你这样做真的违反了封装本身。

通常，命名空间只是一种组织类以使它们更容易找到的方式，因此对您的应用程序有意义。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T15:11:55.940

据我所知，您根本没有违反封装。事实上，我什至不确定这是否可以称为封装，因为命名空间不是特定于 OOP 的——它只是类型的组织。

如果您认为某个类型属于顶级名称空间，则规则只是将其放置在顶级名称空间中。这种情况的一个明显示例是（使用您的示例）MyAPI.WebLogic 和 MyAPI.Compression（可能以及其他）都需要使用某种类型 - 因此最好将此类型放在 MyAPI 中。如果您仍然不太确定属于什么，请使用 Microsoft 库作为示例。`System`BCL的命名空间中有很多类！

# ruby-on-rails - Rails 邮件教程，以及所需的设置

> ID：835226
> 
> 赞同：0
> 
> 时间：2009-05-07T15:07:02.003
> 
> 标签：ruby-on-rails, email

我是 RoR 的新手，正在编写一个简单的应用程序。需要实现通常的注册/忘记密码的邮件功能。我已经google了，但还没有完整的教程。大多数教程都教如何发送邮件，但对设置没有帮助。有人可以建议一个很好的教程，并完成设置吗？

我在 ubuntu 9.04 上，想使用我的开发盒作为服务器。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T17:15:51.367

我刚刚开始使用 Ruby on Rails，并且也在使用 Ubuntu。根据我的研究，我发现[http://modrails.com/](http://modrails.com/)是在 ubuntu / apache 上托管 rails 的最佳解决方案。他们的文档非常适合启动和运行服务器。

从那里，我发现最好的 Rails 教程是官方教程，可以在[http://guides.rubyonrails.org/](http://guides.rubyonrails.org/)找到。

开始学习的一个好方法是查看其他应用程序的源代码，其中一些可以在[http://opensourcerails.com/](http://opensourcerails.com/)找到。

# sharepoint - string;# 在下拉列表中

> ID：835232
> 
> 赞同：1
> 
> 时间：2009-05-07T15:07:56.400
> 
> 标签：sharepoint, custom-controls

我做了一个自定义下拉字段。我想显示我的联系人的全名。我做了一个计算列，因为不是每个用户都填写了他们的全名，只有名字和最后一个。如果我想在我的下拉列表中显示项目，那么在我的值之前总是有 string;#。有人知道如何删除它吗？

这是我填写下拉列表的代码

```
SPWeb web = site.OpenWeb(); 
SPDataSource dataSource = new SPDataSource(); 
dataSource.List = web.Lists["Contacts"];
this.testing.DataSource = dataSource; 
this.testing.DataTextField = "Full Name"; 
this.testing.DataValueField = "Full Name"; 
this.testing.DataBind(); 
```

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:22:00.373

字段类型可能是“用户”（我认为在 UI 中显示为“人”）。此查找字段和其他查找字段始终由 SharePoint 以这种方式存储。值部分是用户 ID，字符串部分是用户名。

您可以使用正则表达式来拆分组件。您还可以将值转换为“正确”方式的[SPFieldUserValue](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spfielduservalue.aspx)，并使用该类的属性来检索信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T15:15:41.170

假设全名是一个文本字段，看起来您的计算列定义中有一个错误，与您的输入之一是查找字段相关。

如果你不能以更干净的方式摆脱它，那么总会有 substr （或者也许是对的，我永远记不起 excel 函数的语法）

# c++ - 如何处理在 C++ 中的类之间传递运行时大小的数组

> ID：835233
> 
> 赞同：1
> 
> 时间：2009-05-07T15:08:03.500
> 
> 标签：c++, arrays, memory

现在我有一个简单的类，可以将 XML 文件解析为对我有用的整数。看起来像这样：

```
int* DataParser::getInts(){
    *objectNumbers = new int[getSize()];
    for (int i=0;i<getSize();i++){
            objectNumbers[i]=activeNode->GetNextChild()->GetContent();
    }
    return objectNumbers;
 } 
```

在程序的主要部分，我通过以下方式收到：

```
int* numbers= data->getInts();
///Do things to numbers[]
delete numbers; 
```

一切正常，直到删除命令使一切崩溃。这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-07T15:11:56.750

部分问题是您没有将 new[] 与 delete[] 配对。这可能不是您的错误的根源，但您应该养成这样做的习惯。

该错误几乎肯定与您注释掉的代码有关。您能否在此处添加更多上下文，以便我们可以看到您对数字值做了什么？

一般来说，我发现使用向量来解决这类问题要容易**得多。**它将内存管理排除在外，并具有使用动态内存存储大小的额外好处。

```
void DataParser::getInts(std::vector<int>& objectNumbers){
    for (int i=0;i<getSize();i++){
      objectNumbers.push_back(activeNode->GetNextChild()->GetContent());
    }
 }

...
std::vector<int> numbers;
data.getInts(numbers); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T15:10:42.353

你需要

```
delete [] numbers; 
```

规则是每当你

```
ptr = new Type[...]; 
```

确保你

```
delete [] ptr; 
```

而不是常规的

```
delete ptr; 
```

这将导致未定义的行为（感谢 Neil Butterworth）并且旨在删除 ptr 指向的单个实例，而不是数组。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T15:10:41.027

以下行：

```
 *objectNumbers = new int[getSize()]; 
```

它有什么作用？如果你正在返回`objectNumbers`，这是一个指向 的指针`int`，你真的应该这样做：

```
 objectNumbers = new int[getSize()]; 
```

无论如何，C++ 为您提供集合（`vector`等`list`）——我会使用其中一个而不是普通数组。`new`如其他地方所述，将您的与 a`delete`和 a`new []`与 a匹配很重要`delete []`。

传递数组不是好的设计——你正在公开实现。尝试将迭代器传递到`int`s 的数组/集合/序列的开头和结尾，而不是遵循 STL 设计。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T15:19:26.123

只需使用 std::vector 代替；

```
std::vector<int> DataParser::getInts(){
    std::vector<int> objectNumbers(getSize());
    for (int i=0;i<getSize();i++){
            objectNumbers[i]=activeNode->GetNextChild()->GetContent();
    }
    return objectNumbers;
 } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T15:18:35.597

您将很快遇到麻烦和维护问题。考虑使用 std::vector，这是正确的方法。

# .net - 托管 C++ 中的数组初始化错误（后续）

> ID：835236
> 
> 赞同：1
> 
> 时间：2009-05-07T15:08:27.553
> 
> 标签：.net, c++, managed-c++

跟进我之前的问题。

谁能解释为什么以下代码编译没有任何错误：

```
typedef array<VdbMethodInfo^> MethodArray;
typedef array<VdbParameterInfo^> ParameterArray;
ParameterArray^ parameters = gcnew ParameterArray {
    gcnew VdbParameterInfo("name", "string", "Paul")};
MethodArray^ methods = gcnew MethodArray {
    gcnew VdbMethodInfo("createTable", parameters)
}; 
```

然而这给了我“错误C2440：'初始化'：无法从'VdbParameterInfo ^'转换为'VdbMethodInfo ^”

```
typedef array<VdbMethodInfo^> MethodArray;
typedef array<VdbParameterInfo^> ParameterArray;
MethodArray^ methods = gcnew MethodArray {
    gcnew VdbMethodInfo("createTable", gcnew ParameterArray {
        gcnew VdbParameterInfo("name", "string", "Paul")};
    )
}; 
```

我所做的只是尝试将参数数组“嵌套”在方法数组初始化中......不直接介意 - VdbMethodInfo 的构造函数将 ParameterArray 作为第二个参数。

这似乎暗示托管 C++ 数组初始化期望任何递归嵌套具有相同的类型......（即我认为这一定是一个错误）

相关问题：[这里](https://stackoverflow.com/questions/834903/array-initialization-in-managed-c)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:16:57.003

我找到了一种解决方法，它使语法更清晰。我使用“...”语法（托管 C++ 等效于 C#“params”关键字“）：

```
public ref class MetaData
{
    typedef array<VdbMethodInfo^> MethodArray;
    typedef array<VdbParameterInfo^> ParameterArray;
    static ParameterArray^ params(... ParameterArray^ p)
    {
        return p;
    }
public:
    static array<VdbMethodInfo^>^ Instance()
    {
        ParameterArray^ parameters = gcnew ParameterArray { gcnew VdbParameterInfo("name", "string", "Paul")};
        MethodArray^ methods = gcnew MethodArray {
            gcnew VdbMethodInfo("createTable",
                params(gcnew VdbParameterInfo("name", "string", "Paul"),
                       gcnew VdbParameterInfo("age", "number", "25")))
        };

        return methods;
    }
}; 
```

# c# - 为什么 StreamWriter 在 Windows 服务中不起作用？

> ID：835247
> 
> 赞同：1
> 
> 时间：2009-05-07T15:10:14.727
> 
> 标签：c#, .net, service, streamwriter

我有这个简单的代码，记录将日志附加到文本文件：

```
 public static void RecordToFile(string filename, Log log)
    {
            TextWriter textWriter = new StreamWriter(Constants.APP_PATH + 
                "\\" + filename, true);
            textWriter.WriteLine(log.ToString());
            textWriter.Close();
    } 
```

这在 Windows 窗体应用程序中完美运行。然而，使用[instsrv 和 srvany](http://support.microsoft.com/kb/137890)技巧，我把它变成了一个 Windows 服务。该服务运行良好，访问数据库，执行查询和所有...除了这个 StreamWriter。日志只是没有得到应有的更新。任何想法为什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T15:18:33.410

该服务很可能是在没有对该目录的访问权限的用户凭据下运行的。

因此，请检查服务的属性对话框，并检查“登录”选项卡以查看它以什么身份登录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T15:19:59.990

可能的原因：

1.  Constants.APP_PATH 指向映射驱动器 - 服务不会在与登录用户相同的环境中运行，因此路径可能无效
2.  权限 - 根据运行服务的用户，它可能无法访问 WinForms 应用程序所做的同一组目录

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T15:20:52.283

如果没有更多信息，任何人都无法提供帮助。它究竟以何种方式不起作用？你有例外吗？它只是默默地失败吗？

只是一些提示...

1) 不要使用字符串连接来创建文件路径。改为使用`System.IO.Path.Combine`。像这样：

```
TextWriter textWriter = new StreamWriter(
    System.IO.Path.Combine(Constants.APP_PATH, filename), true); 
```

2) 将你的作者放在一个`using()`块中。像这样：

```
using(TextWriter textWriter = new StreamWriter(
        System.IO.Path.Combine(Constants.APP_PATH, filename), true))
{
    textWriter.WriteLine(log.ToString());
} 
```

3) 验证服务使用的帐户是否有权在该目录中创建/覆盖文件。通常，服务帐户与用户帐户一样`LOCAL_SYSTEM`或`NETWORK_SERVICE`不会拥有与用户帐户相同的权限。这可以解释为什么它作为用户而不是作为服务工作。也可能是您的 APP_PATH 常量指向用户特定的东西，例如映射到网络共享的驱动器。驱动器映射不跨越用户，因此这也可能是一个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T15:21:14.043

如果没有更多信息，我猜您运行服务的帐户无权打开文件进行写入。

# asp.net-mvc - 在 ASP.NET MVC 视图中访问应用程序设置

> ID：835249
> 
> 赞同：2
> 
> 时间：2009-05-07T15:10:24.257
> 
> 标签：asp.net-mvc

我正在尝试在我的 ASP.NET MVC site.master 中构建一个全局菜单，我想知道如何从 site.master 标记访问应用程序设置属性？以前我可能会从我的 site.master 的代码隐藏中实例化一个配置对象，然后设置一个公共属性。但现在我正在摸不着头脑......必须需要更多的咖啡。

**已更新答案代码**

向应用程序属性添加了一个名为 baseurl 的字符串设置，并为其赋值“ [http://mysite.com](http://mysite.com) ”

制作了 GlobalMenu.cs 的模型类

```
 public class GlobalMenu
{
    private string _baseurl;
    public string baseurl
    {
        get { return _baseurl; }
        set
        {
            _baseurl = value;
        }
    }

} 
```

创建了一个名为 BaseController 并从 Controller 继承的基本控制器类，并因此覆盖 OnActionExecuted：

```
 protected override void OnActionExecuted(ActionExecutedContext filterContext)
    {
        string baseurl = Properties.Settings.Default.baseurl;

        GlobalMenu menumodel = new GlobalMenu();
        menumodel.baseurl = baseurl;
        ViewData["menudata"] = menumodel;
        base.OnActionExecuted(filterContext);
    } 
```

在 Shared 文件夹中创建了一个名为 ViewGlobalMenu 的局部视图，该文件夹被强输入到 GlobalMenu 中，看起来像这样......但显然还有更多内容：

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<MyApp.Web.Models.GlobalMenu>" %> 
```

最后在 Site.Master 中，我将其添加到我希望菜单显示的位置：

```
<%Html.RenderPartial("ViewGlobalMenu", (MyApp.Web.Models.GlobalMenu)ViewData["menudata"]); %> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T15:21:56.727

这是我可能会使用的策略。创建一个基本控制器，您的其他控制器将从该控制器派生，并使其从 Controller 派生。覆盖基本控制器中的 ActionExecuted 方法并让它访问应用程序设置（并可能缓存它们）。为您的菜单生成 ViewData 作为分配给 ViewData 中特定键的强类型菜单模型类。您只需要将模型提供给返回 ViewResult（也许还有 PartialViewResults）的操作。

创建一个使用菜单模型类实现全局菜单标记的强类型局部视图。通过 RenderPartial 将其包含在 MasterPage 定义中。将 key 对应的 ViewData 项作为 Model 传递给局部视图，以便您可以在菜单中使用模型的属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-09-12T12:48:30.203

这应该从视图中解决问题 -->

```
@System.Configuration.ConfigurationManager.AppSettings["AppSetting"] 
```

# sql - 如何在记录的 timeGap 中添加未记录的时间间隙？如何创建tihs方法？

> ID：835251
> 
> 赞同：0
> 
> 时间：2009-05-07T15:10:33.167
> 
> 标签：sql, sql-server, sql-server-2005

```
CREATE procedure sp_ActivityFrequencyOneUserGraph          
(          
@date1 nvarchar(100) ,                   
@date2 nvarchar(100),        
@customerID int,        
@user int,    
@type nvarchar(50)            
)          
as          

select Count(Page) as VisitingCount,[Time]      
from      
( SELECT Page,Date,[user],      
        **dbo.fn_GetActivityLogArranger2(Date,@type) as [Time]**
        FROM scr_SecuristLog      
) scr_SecuristLog      
where      
        Date between @date1 and @date2      
and      
        [user] in      
(       select USERNAME      
        from scr_CustomerAuthorities      
        where customerID=Convert(varchar,@customerID)      
        and ID=Convert(varchar,@user)      
)      
group by [Time] order by [Time] asc     

return 
```

* * *

我的功能：

* * *

```
CREATE FUNCTION [dbo].[fn_GetActivityLogArranger2]    
(    
@t  AS datetime,  
@type AS nvarchar(50)    
)    

RETURNS  nvarchar(max)    
AS    
BEGIN    
declare @Return nvarchar(max)  

set @t = cast (@t as smalldatetime)  

if(@type='hour')  
begin  
set @t= dateadd(minute, -(datepart(minute, @t)), @t)  
end  

else if(@type='halfhour')  
begin  
set @t=  
    case  
        when datepart(minute, @t) >= 30  
            then dateadd(minute, 60-(datepart(minute, @t)), @t)  
        else dateadd(minute, 30-(datepart(minute, @t)), @t)  
    end  
end  
else if(@type='tenminutes')  
begin  

set @t= case   
   when datepart(minute,@t)%10 >=5  
   then dateadd(minute,10-(datepart(minute,@t)%10),@t)  
      else dateadd(minute,-(datepart(minute,@t)%10),@t)  
    end  
end  
select @Return=CONVERT(VARCHAR(5),@t, 108)    

Return @Return    
end 
```

* * *

如果我使用**dbo.fn_GetActivityLogArranger2('2009-04-30','hour')**我的结果表

### 表2

VisitingCount----------时间--------------
23-------------------------10： 30----------
33------------- 11:00---------- -----
43---------------------11:30----
53--- ------------------12:00----------------

### 但; 12:30-13:30：午休。所以，没有人愿意进入系统。所以我的表格结果：

### 表2

VisitingCount---------时间----------
23----------10:30-- ------
33---------11:00----------
43------ ---------------11:30----------
53--------- 12:00---------
0--------------12:30----------
0 ----------13:00----------
0-------------- ------13:30----------
23----------14:00---- ------
33---------14:30----------
37-------- -------------15:00----------

但是在系统上的那些小时（'12：30-13：00-13：30'）之间没有任何记录。如何将Table1转换为Table2？我认为我需要一个函数来逐分钟生成所有时间间隔，然后我可以使用联合方法。但是如何？

但我需要动态方法而不是文本值“当时间在'12:30'和'13:30'之间时......”我需要生成器：'12:30...22:30...24:30'- --<0,0,0,0..... 和联合（这是我的猜测）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T22:09:18.040

创建所有时间的表（您可以使用数字表并使用 dateadd(mm, value*30) 但时间可能更容易）您需要在报告中涵盖并在查询中加入该表以用作时间价值; 这将让你填补你的空白。

创建一个时间表（在下面的示例中为 tblTimes），并将您需要报告的时间范围内的所有值插入到表中。然后更改您的 sql，以便从该表中选择并加入您的 scr_SecuristLog 表。这样做只会得到两个表之间映射的值；因此，如果您的 scr_SecuristLog 表出于某种原因计算出 10.36 并且不在您的 tblTimes 表中，那么您将看不到记录。

```
select Count(Page) as VisitingCount,[Time]      
from   
tblTimes Alltimes
left outer join   
( SELECT Page,Date,[user],      
        dbo.fn_GetActivityLogArranger2(Date,@type) as [Time]
        FROM scr_SecuristLog      
) scr_SecuristLog      
on Alltimes.Time = scr_SecuristLog.[Time]
where      
        Date between @date1 and @date2      
and      
        [user] in      
(       select USERNAME      
        from scr_CustomerAuthorities      
        where customerID=Convert(varchar,@customerID)      
        and ID=Convert(varchar,@user)      
)      
group by [Time] order by [Time] asc 
```

# asp.net - 有没有办法通过 jQuery 在 Asp.Net 中调用 [ScriptableMember]

> ID：835252
> 
> 赞同：2
> 
> 时间：2009-05-07T15:10:38.843
> 
> 标签：asp.net, javascript, jquery

我知道有一种方法可以通过 jQuery 调用 [WebMethod]`($.ajax(...))` 我想知道是否可以通过 jQuery 调用 [ScriptableMember]。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T15:22:38.270

这只是javascript。也许不是 jquery ajax 方法，但这并不意味着什么。

一些插件确实调用了内置的 ajax 方法，但如果需要，它们通常不会太难修改。

[演练：从 JavaScript 调用托管代码](http://msdn.microsoft.com/en-us/library/cc221414(VS.95).aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-28T16:41:58.960

jQuery ($.ajax()) 方法旨在通过 URL 调用 ajax 方法，或者至少您需要以简短形式指定 url，即 something.php，因此简短的回答是这是不可能的。我采用了我的原始设计，即从 C#（托管代码）调用 javascript，反之亦然。

# php - 根据选择值显示/隐藏字段

> ID：835259
> 
> 赞同：14
> 
> 时间：2009-05-07T15:12:06.530
> 
> 标签：php, javascript, jquery

我试图根据我的选择字段之一的值显示和隐藏一些表单字段。我希望使用数组来保存每个选择值应该显示和不应该显示的内容，以使我免于大量 switch 语句，但无法弄清楚如何去做。

我正在使用 PHP 和 jQuery。任何帮助都会很棒。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-07T15:15:36.100

尝试这样的事情：

```
<select id="viewSelector">
   <option value="0">-- Select a View --</option>       
   <option value="view1">view1</option>
   <option value="view2">view2</option>
   <option value="view3">view3</option>
</select>

<div id="view1">
  <!-- content --> 
</div>
<div id="view2a">
  <!-- content --> 
</div>
<div id="view2b">
  <!-- content --> 
</div>
<div id="view3">
  <!-- content --> 
</div> 
```

然后在jQuery中：

```
$(document).ready(function() {
  $.viewMap = {
    '0' : $([]),
    'view1' : $('#view1'),
    'view2' : $('#view2a, #view2b'),
    'view3' : $('#view3')
  };

  $('#viewSelector').change(function() {
    // hide all
    $.each($.viewMap, function() { this.hide(); });
    // show current
    $.viewMap[$(this).val()].show();
  });
}); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T15:36:34.990

有几种不同的方法可以做到这一点。最简单的方法是拥有几个单独的字段集，每个字段集包含一组字段。然后，在 jQuery 中，根据选择菜单的值，您可以显示/隐藏这些字段集，例如

```
<fieldset id="f1">
    <input name="something1" />
    <input name="something2" />
    <input name="something3" />
</fieldset>
<fieldset id="f2">
    <input name="something4" />
    <input name="something5" />
    <input name="something6" />
</fieldset>
<select name="fieldset-choice">
    <option value="f1">Fieldset 1</option>
    <option value="f2">Fieldset 2</option>
</select>

<script type="text/javascript">
    jQuery('select[name=fieldset-choice]').change(function(){
        var fieldsetName = $(this).val();
        $('fieldset').hide().filter('#' + fieldsetName).show();
    });

    // We need to hide all fieldsets except the first:
    $('fieldset').hide().filter('#f1').show();
</script> 
```

**注意**：为了使上述技术完全不引人注目，您可能希望使用所有不同字段集的名称动态构建选择菜单。

* * *

或者，您可以为每个字段名称添加一个有意义的前缀，然后根据该属性隐藏/显示：

```
<input name="group1-name1" />
<input name="group1-name2" />

<input name="group2-name3" />
<input name="group2-name4" />
<input name="group2-name5" />

<select name="field-choice">
    <option value="group1">Group 1</option>
    <option value="group2">Group 2</option>
</select>

<script type="text/javascript">
    jQuery('select[name=field-choice]').change(function(){
        var groupName = $(this).val();
        $('input').hide().filter('[name^=' + groupName + ']').show();
    });

    // We need to hide all fields except those of the first group:
    $('input').hide().filter('[name^=group1]').show();
</script> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-20T02:11:32.913

要在加载时启动代码，只需添加 .change()。如下所示...

```
$(document).ready(function() {
  $.viewMap = {
    '0' : $([]),
    'view1' : $('#view1'),
    'view2' : $('#view2a, #view2b'),
    'view3' : $('#view3')
  };

  $('#viewSelector').change(function() {
    // hide all
    $.each($.viewMap, function() { this.hide(); });
    // show current
    $.viewMap[$(this).val()].show();
  }).change();
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-11-03T11:22:09.300

我的 2 美分：我需要根据许多先前的选择值（不仅仅是一个）显示/隐藏字段。

所以我向 div 字段添加了一个父属性，如下所示：

```
<div id="view" parent="none">
<select class=selector id="view">
<option value="0"> -- Make a choice --</option>
<option value="s1">sub 1</option>
<option value="s2">sub 2</option>
<option value="s3">sub 3</option>
</select>
</div>

<!-- you need to define the parent value with the value of parent div id -->
<div id="s1" parent="view">
<!-- if you want to have a selector be sure it has the same id as the div -->
<select class=selector id="s1">
<option value="0">-- Make a choice --</option>
<option value="s1_sub1">sub 1 of s1</option>
<option value="s1_sub2">sub 2 of s1</option>
<option value="s1_sub3">sub 3 of s1</option>
</select>
</div>

<!-- Make the same thing for s2 and s3
Define div s2 here

Define div s3 here
-->

<!-- and finally if that's your final step you put what you want in the div -->
<div id="s1_sub1" parent="s1">
You are inside s1 sub1
</div> 
```

现在jquery代码：

```
$(document).ready(function() {

 $('select[class=selector]').change(function() { 
    //next div to show
    var selectorActive = $(this).val();
    //div where you are 
    var parentValue = $(this).attr("id");

   //show active div and hide others
    $('div').hide().filter('#' + selectorActive).show();

    while (parentValue!="none") {
      //then show parents of active div
      $('div[id=' + parentValue + ']').show();
      //return the parent of div until "none"
      parentValue = $('div[id=' + parentValue + ']').attr("parent");
     }

 });

// print only the first div at start
 $('div').hide().filter("#view").show();

}); 
```

这就像一个魅力，你不需要定义地图

我希望这个能帮上忙

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-08T00:31:39.797

@Martin 试试这个

```
`$('#viewSelector').trigger('change');` 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-20T15:22:59.197

### 这是一个非常简单的例子：

目的是展示一个简单示例，说明如何根据选择的值使用值数组来显示/隐藏字段。

在这个演示中，我*可以*使用 classNames 一次性显示/隐藏字段组——但这不是示例的目的——所以 classNames 仅用于 CSS。

因为演示使用 ID *（这些 ID 的两个数组）*进行演示，所以要隐藏的字段是`input`字段`divs`、`imgs`或 what-have-you 都没有关系。ID 标识要隐藏的任何内容。

```
var aPeople = ['bob','sam','ted'];
var aTransport = ['car','bike','truck'];

$('#mySel').change(function(){
   $('.alldiv').hide(); //Hide them all to start...
   let sel = $(this).val(); //Get selected option value
   if ( sel=='ppl' ){
      for (let i=0; i<aPeople.length;i++){
         $('#' + aPeople[i]).show();
      }
   }else if ( sel=='tpt' ){
      for (let i=0; i<aTransport.length;i++){
         $('#' + aTransport[i]).show();
      }
   }else{
      //Choose selected
      $('.alldiv').show();
   }
});
```

```
.alldiv{width:30vw;height:10vh;padding:2vh 2vw;text-align:center;}
.ppl{background:palegreen;}
.tpt{background:wheat;}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<select id="mySel">
  <option value="">Choose:</option>
  <option value="ppl">People</option>
  <option value="tpt">Vehicles</option>
</select>

<div id="bob" class="alldiv ppl">People: Bob</div>
<div id="car" class="alldiv tpt">Vehicle: Car</div>
<div id="truck" class="alldiv tpt">Vehicle: Truck</div>
<div id="sam" class="alldiv ppl">People: Sam</div>
<div id="ted" class="alldiv ppl">People: Ted</div>
<div id="bike" class="alldiv tpt">Vehicle: Bike</div>
```

# css - Internet Explorer 下拉边框

> ID：835260
> 
> 赞同：4
> 
> 时间：2009-05-07T15:12:35.343
> 
> 标签：css, internet-explorer

有没有办法在 IE 中隐藏下拉菜单的边框（使其看起来平坦，融入背景）？在 Firefox 中，只需将边框设置为 0px 就足够简单了，但即使您将边框设置为 0px，IE 仍会呈现边框。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T15:19:47.573

这在 IE 中是不可能的。它们不允许对列表的下拉组件进行样式设置，除了其中的文本（即红色文本）。

IE实际上使用的是Windows级别的控件，而不是基于浏览器的控件，所以它是相当有限的。

**编辑**：最初发表这篇文章时，IE8 的稳定版本尚未发布。根据评论，IE8 支持边框样式。然而，即使在 IE8 发布大约 2 年后，您仍然不应该指望所有用户都拥有 IE8+。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-05T21:03:25.840

我最近看到一些工具包将实际下拉菜单飞出 5000 像素，用自定义控件替换它，并使用 javascript 连接 2 个控件。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-10-21T20:12:52.423

IE8 支持更改下拉框的边框，但 IE6 不支持。

# hibernate - 休眠版本控制无缘无故发布更新声明

> ID：835264
> 
> 赞同：1
> 
> 时间：2009-05-07T15:14:44.997
> 
> 标签：hibernate

我的休眠版本无明显原因发出更新声明。

在我的 BankAccount 映射文件中：

```
<version type="dbtimestamp" name="modified" column="Modified"/> 
```

在 AvailableBalance 映射文件中：

```
<many-to-one name="bankAccount" class="model.businessdomain.orm.BankAccount" fetch="select" >
   <column name="BankAccountId" not-null="true" />
</many-to-one> 
```

当从 AvailableBalance 表（通过函数）中进行选择时，发出的结果 sql 语句：

```
17:12:16,152 DEBUG SQL:401 - select * from dbo.get_availablebalancelist(?) ab  where ab.bankAccountId = ?
17:12:31,539 DEBUG SQL:401 - select current_timestamp
17:12:31,625 DEBUG SQL:401 - update dbo.BankAccount set Modified=?, BankAccountTypeId=?, BankID=?, InterestSchemeID=?, BankAccNo=?, SysParamID=?, BankAccName=?, BranchCode=?, UserRef=?, CAMSCode=?, Provision=?, ProvisionPerc=?, OverDraftLimit=?, isIslamic=?, Active=? where BankAccountId=? and Modified=? 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-28T15:45:06.433

选择后是否以任何方式在内存中修改对象？如果对象被标记为脏，根据您的事务策略，可能会发生提交，这可能会隐式更新数据库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-22T04:05:54.050

该更新的原因很可能不在您发布的代码中。

要调试它，您可以在日志记录工具中设置一个断点，并查看发出此语句的堆栈。

# c# - 为什么临时变量可以阻止客户端删除事件处理程序？

> ID：835274
> 
> 赞同：1
> 
> 时间：2009-05-07T15:16:07.537
> 
> 标签：c#, multithreading, events

以下代码片段来自《Effective C#》一书，

```
public event AddMessageEventHandler Log;

public void AddMsg ( int priority, string msg )

{
    // This idiom discussed below.
    AddMessageEventHandler l = Log;
    if ( l != null )
        l ( null, new LoggerEventArgs( priority, msg ) );
} 
```

AddMsg 方法显示了引发事件的正确方法。***引用日志事件处理程序的临时变量是防止多线程程序中竞争条件的重要保障。如果没有引用的副本，客户端可以删除 if 语句检查和事件处理程序执行之间的事件处理程序。通过复制参考，这是不可能发生的。***

为什么临时变量可以阻止客户端删除事件处理程序？我一定在这里遗漏了一些东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T15:22:32.153

它不会阻止客户端删除事件处理程序 - 它只是意味着您无论如何都会调用该事件处理程序。

您可能缺少的重要一点是委托是不可变的 - 当删除事件处理程序时， 的值`Log`将更改为新的委托或`null`. 不过没关系，因为到那个阶段你正在使用`1`而不是`Log`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T15:21:35.027

委托链是不可变的。因此，如果另一个线程访问“Log”并删除了一个事件处理程序，则为 Log 分配一个新的委托链。因此，当访问 l 时，即使从 Log 中删除事件处理程序，它也不会影响 l，因为它将不再“指向”同一个委托链。所以是的，它确实可以防止竞争条件，但是您最终可能会遇到一个线程取消订阅但仍会调用 evanthandler 的情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T15:22:50.170

它不会阻止客户端*删除*事件处理程序 - 它只是意味着如果他们这样做你最终不会调用空委托......考虑：

*   线程 A：检查`Log`不为空
*   线程B：取消订阅，导致`Log`变为null
*   线程 A：invokes `Log`（现在为 null）= boom

当然，通过上述修复，您现在有一个幻像调用 - 即订阅者可以在他们取消订阅*后*调用事件......必须喜欢线程。

与往常一样，Eric Lippert 有一个关于这个主题的博客：[事件和比赛](http://blogs.msdn.com/ericlippert/archive/2009/04/29/events-and-races.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T15:21:59.643

客户端仍然可以删除事件处理程序。

坏的：

```
if ( Log != null )
{
  //another thread removes the event handler at this point,
  // Log is now null
  Log ( null, new LoggerEventArgs( priority, msg ) );
} 
```

好的：

```
AddMessageEventHandler l = Log; 
if ( l != null )
  //another thread removes the event handler at this point,
  // Log is now null
  // l is not null, so we are safe.
l ( null, new LoggerEventArgs( priority, msg ) ); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T15:22:29.860

因为当您分配它时，您会创建对该对象的本地引用，然后在继续之前检查该引用是否存在。

如果您只是检查 Log 是否不为空，然后继续执行下一条语句，则另一个线程可能会将 2 条指令之间的 Log 对象设为空。

```
If(Log != null)
// another thread could null the reference to Log here
l.DoSomething()

AddMessageEventHandler l = Log; 
if ( l != null )
// nothing can null the reference here as you’ve created a local copy of that reference
l ( null, new LoggerEventArgs( priority, msg ) );
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T15:23:15.350

您加粗的文本解释了可能出现的问题。

> 如果没有引用的副本，客户端可以删除 if 语句检查和事件处理程序执行之间的事件处理程序。

当您的 AddMsg 方法正在运行时，第二个线程可能会从 Log 中删除其事件处理程序。例如：

```
if (Log != null)
{
    // other thread has just removed its event handler, so Log is now null

    Log(null, new LoggerEventArgs(priority, msg)); // Oops! Throws NullReferenceException
} 
```

# mysql - MySQL查询排序数据的两种方式

> ID：835276
> 
> 赞同：1
> 
> 时间：2009-05-07T15:16:23.883
> 
> 标签：mysql, sql, sql-order-by

我正在使用下表跟踪模块内的页面浏览量：

```
id | page_id | user_id | session_id | created 
```

每个页面对于某个模块都是唯一的；例如，第 14 页仅存在于模块 2 中。

我正在尝试编写一个查询，告诉我特定模块的查看会话何时开始（GROUP BY session_id），但我在订购时遇到问题。基本上，对于那个分组会话，我想返回最早的“创建”（查看会话的开始时间）和最新的 page_id（他们在模块中的距离）。

实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T15:27:43.780

我认为您需要在选择中使用子查询：

```
SELECT a.session_id, MIN(a.created) as start_time, 
b.page_id AS last_page, b.end_time
FROM table a 
INNER JOIN 
   (SELECT b.session_id, MAX(b.created) as end_time, MAX(b.page_id) 
   FROM table b GROUP BY b.session_id) 
ON a.session_id = b.session_id GROUP BY a.session_id 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T15:21:37.553

```
SELECT  MIN(created), MAX(page_id)
FROM    modules
GROUP BY
        session_id 
```

# .net - 你能用 .net reactor 混淆 LinqToSql 程序集而不破坏它们吗？

> ID：835277
> 
> 赞同：4
> 
> 时间：2009-05-07T15:16:48.267
> 
> 标签：.net, linq-to-sql, obfuscation, net-reactor

我正在使用 .net Reactor 来混淆包含 LinqToSql 类的数据层程序集。在调用程序集时，我收到以下错误..

错误的存储属性：成员“RCSQLData.Application_DB.ApplicationId”上的“_ApplicationId”

我正在使用“图书馆”模式并启用了“Necrobit”和“混淆”。

是否可以混淆 LinqToSQL 类，或者它又是旧的反射核桃？

迈克尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-04-01T10:03:16.997

这是因为 LINQ-toSQL 大量使用反射。它无法找到原始属性，因为它试图通过原始名称（现在已被混淆）搜索它们。

解决方案是从重命名中排除正确的类/成员。[Crypto Obfuscator](http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm)等一些会通过检测代码中的 LINQ-SQL 使用情况自动为您完成所有这些工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T23:50:58.897

您是否在希望使用它的代码中调用受保护的程序集？（即引用受保护的 .dll？）

我也在使用 .NET Reactor，但在“应用程序模式”下并使用附加程序集保护 .exe，它工作正常。但是，我选择了我的主程序集并指定了要使用的附加卫星 .dll，它在一次合并和保护中被合并。

我不相信您将能够添加对受保护的 .dll 的引用，这就是它背后的想法，因为它需要反思它。我会在图书馆模式上阅读更多内容并回复您。

# c# - VIEWS 和流畅的 NHibernate？

> ID：835280
> 
> 赞同：16
> 
> 时间：2009-05-07T15:17:39.793
> 
> 标签：c#, sql, nhibernate, fluent-nhibernate

可以使用 Fluent NHibernate 映射视图吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-07T15:50:33.943

我认为您可以使用 WithTable 方法将表名称替换为视图名称：

```
WithTable("myview"); 
```

**编辑：**只是为了更新这个答案，Fluent NHibernate 现在使用：

```
Table("myview"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T15:54:57.177

mxmissile 的答案是正确的，但我想补充一点，如果您想对它进行插入或更新，该视图必须是可更新的（SQL Server 术语。）。我有几个表映射到过滤掉非活动记录的视图，因为这些表允许软删除。

# visual-studio-2005 - 如何获取间歇性崩溃 devenv.com 的调用堆栈？

> ID：835281
> 
> 赞同：0
> 
> 时间：2009-05-07T15:17:49.497
> 
> 标签：visual-studio-2005, debugging, callstack

我有一个夜间构建 DOS 批处理脚本，它调用 devenv.exe 来构建解决方案文件。我间歇性地观察到 devenv.com 崩溃。我得到一个 DW20.exe“分享你的痛苦”对话框。

1）如果按下调试按钮，我不会看到通常的“选择您的调试器”窗口。相反，它什么也不做。

2) 如果我启动 Visual Studio 并尝试附加到 devenv.com，它说应用程序似乎已死锁或等待操作完成。（我认为是因为它是由 DW20.exe 调试的）

你会建议我做什么来获得一个体面的调用堆栈？

**编辑**

我成功地让 WinDBG 附加。执行了 k 命令。以下看起来是否有意义，可以传递给编译器团队？有没有办法查看当前的异常？

```
(e90.fb8): Break instruction exception - code 80000003 (!!! second chance !!!)
eax=0012ccb8 ebx=04ed2750 ecx=0111bdc4 edx=5a57f004 esi=00000000 edi=14ed1000
eip=77e4bef7 esp=0012ccb4 ebp=0012cd08 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\WINDOWS\system32\kernel32.dll - 
kernel32!RaiseException+0x3c:
77e4bef7 5e              pop     esi
Missing image name, possible paged-out or corrupt data.
Missing image name, possible paged-out or corrupt data.
Missing image name, possible paged-out or corrupt data.
Missing image name, possible paged-out or corrupt data.
0:000> k
ChildEBP RetAddr  
WARNING: Stack unwind information not available. Following frames may be wrong.
0012cd08 5a760cf1 kernel32!RaiseException+0x3c
0012cd58 5a766105 cslangsvc!InMemoryCompile+0x4c6c1
0012cd7c 5a767375 cslangsvc!InMemoryCompile+0x51ad5
0012cd84 5a767637 cslangsvc!InMemoryCompile+0x52d45
00000000 00000000 cslangsvc!InMemoryCompile+0x53007 
```

我正在努力`!analyze -v`工作。

```
0:000> !analyze -v
*******************************************************************************
*                                                                             *
*                        Exception Analysis                                   *
*                                                                             *
*******************************************************************************

***** OS symbols are WRONG. Please fix symbols to do analysis.

*************************************************************************
***                                                                   ***
***                                                                   ***
***    Your debugger is not using the correct symbols                 ***
***                                                                   ***
***    In order for this command to work properly, your symbol path   ***
***    must point to .pdb files that have full type information.      ***
***                                                                   ***
***    Certain .pdb files (such as the public OS symbols) do not      ***
***    contain the required information.  Contact the group that      ***
***    provided you with these symbols if you need this command to    ***
***    work.                                                          ***
***                                                                   ***
***    Type referenced: ntdll!_PEB                                    ***
***                                                                   ***
*************************************************************************
c0000005 Exception in ext.analyze debugger extension.
PC: 014d7875  VA: 00000000  R/W: 0  Parameter: 0001003f 
```

**编辑 2**

我发现 WinDBG 有这些很棒的 SOS 扩展。显然我可以使用它们来调试 C# 编译器...

```
0:000> !PrintException
There is no current managed exception on this thread
0:000> !clrstack
OS Thread Id: 0x9fc (0)
ESP       EIP     
0012ee08 77e4bef7 [ComPlusMethodFrameGeneric: 0012ee08] Microsoft.Build.Tasks.Hosting.ICscHostObject.Compile()
0012ee18 6be671ab Microsoft.Build.Tasks.Csc.CallHostObjectToExecute()
0012ee48 6c0aed17 Microsoft.Build.Utilities.ToolTask.Execute()
0012ee7c 6bcbb348 Microsoft.Build.BuildEngine.TaskEngine.ExecuteTask(ExecutionMode, System.Collections.Hashtable, Microsoft.Build.BuildEngine.BuildPropertyGroup, Boolean ByRef)
0012ef24 6bcadf87 Microsoft.Build.BuildEngine.Target.ExecuteAllTasks(Microsoft.Build.BuildEngine.DependencyAnalysisResult, System.Collections.Hashtable, System.Collections.Hashtable, Microsoft.Build.BuildEngine.ItemBucket, System.Collections.ArrayList, Microsoft.Build.BuildEngine.BuildPropertyGroup)
0012efa0 6bcac7c0 Microsoft.Build.BuildEngine.Target.ExecuteAllTasks()
0012efec 6bcad05b Microsoft.Build.BuildEngine.Target.Build(System.Collections.IDictionary)
0012f070 6bcacfa6 Microsoft.Build.BuildEngine.Target.Build(System.Collections.IDictionary)
0012f0f4 6bcacfa6 Microsoft.Build.BuildEngine.Target.Build(System.Collections.IDictionary)
0012f178 6bcacfa6 Microsoft.Build.BuildEngine.Target.Build(System.Collections.IDictionary)
0012f1fc 6bc9b20d Microsoft.Build.BuildEngine.Project.DoBuild(System.String[], System.Collections.IDictionary, Boolean)
0012f250 6bca2134 Microsoft.Build.BuildEngine.Engine.BuildProject(Microsoft.Build.BuildEngine.Project, System.String[], System.Collections.IDictionary, Microsoft.Build.BuildEngine.BuildSettings, Boolean)
0012f2ac 6bc9af03 Microsoft.Build.BuildEngine.Project.Build(System.String[], System.Collections.IDictionary)
0012f2c0 04711a36 Microsoft.VisualStudio.Build.ComInteropWrapper.ProjectShim.BuildTarget(System.String, System.Collections.IDictionary)
0012f4f4 79f68cde [GCFrame: 0012f4f4] 
0012f650 79f68cde [ComMethodFrame: 0012f650] 
```

我仍在寻找一种检查异常内容的方法。!PrintException 没有发现任何异常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T15:21:30.143

您可以尝试安装[Windows 调试工具，](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)然后使用`-iae`选项（用于 NTSD/CDB）或`-I`选项（用于 WinDBG）使该软件包中的调试器之一成为 JIT/AeDebug 调试器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T20:20:20.567

我终于找到了错误编译器的异常类型和调用堆栈。为此，我保存了一个完整的转储文件 (.dump /ma c:\myCSCdump.dmp)，然后像在 VS2005 中打开任何其他项目文件一样打开转储文件。按下运行按钮在调用堆栈窗口中产生以下内容：

```
kernel32.dll!_RaiseException@16()  + 0x3c bytes 
```

> cslangsvc.dll!ALLOCHOST::ThrowOutOfMemoryException() + 0x10 字节
> cslangsvc.dll!PAGEHEAP::AllocPages() + 0xc1fd8 字节
> cslangsvc.dll!SYMTBL::GrowTable() + 0x5b 字节 cslangsvc.dll!BSYMMGR::AddChild() + 0x3b 字节 cslangsvc.dll!BSYMMGR::CreateGlobalSym() + 0x2ba 字节 cslangsvc.dll!BSYMMGR::CreateMethod() + 0xc 字节
> cslangsvc.dll!IMPORTER::ImportMethod() + 0x1d9 字节
> cslangsvc.dll!IMPORTER::DefineImportedType( ) + 0x3b2 字节 cslangsvc.dll!CLSDREC::prepareAggregate() + 0x8d 字节 cslangsvc.dll!COMPILER::ForceAggStates() + 0x8e 字节
> cslangsvc.dll!COMPILER::ForceAggStates() + 0x127 字节 cslangsvc.dll!COMPILER::EnsureState() + 0x2e 字节 cslangsvc.dll!CLSDREC::CheckForTypeErrors() + 0x23 字节
> cslangsvc.dll!CLSDREC::CheckForTypeErrors() + 0x2ba 字节
> cslangsvc.dll!CLSDREC::CheckForTypeErrors() + 0x80 字节
> cslangsvc.dll!CLSDREC::CheckForTypeErrors() + 0x8a 字节
> cslangsvc.dll!CLSDREC::CheckForTypeErrors() + 0x8a 字节
> cslangsvc.dll!CLSDREC::CheckForTypeErrors( ) + 0x8a 字节
> cslangsvc.dll!COMPILER::CheckForTypeErrors() + 0x100 字节 cslangsvc.dll!COMPILER::CompileAll() + 0x546 字节 cslangsvc.dll!COMPILER::Compile() + 0x7c 字节 cslangsvc.dll!CController::RunCompiler() + 0x177 字节 cslangsvc.dll!CController::Compile() + 0x16 字节
> cslangsvc.dll!CCSharpProjectSite::BuildProjectCore() + 0x5a 字节
> cslangsvc.dll!CProjectSite::BuildProject() + 0x11 字节
> csproj.dll!CCSharpBuildCompiler::DoMainBuild( ) + 0x88 字节
> csproj.dll!CCscMSBuildHostObject::Compile() + 0x4e 字节
> mscorwks.dll!_CLRToCOMWorker@8() + 0x171 字节

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T02:55:28.447

这有点罗嗦，所以我会发布它作为回复。它取自 Microsoft Connect 站点，以回应我的问题。读者可能会发现它相关：

日期：2009 年 5 月 7 日星期四 19:14:52 -0700

来自 Microsoft Connect 的问候！

此通知是针对您在 Microsoft Connect 站点提交的反馈项生成的：夜间构建问题（存储桶 365749762）。

感谢您报告您在使用 Visual Studio 2005 时遇到的这个问题，并感谢您提供的转储！

看起来问题出在 cslangsvc.dll（进程内 C# 编译器）中，DevEnv 正在调用它来执行您的构建。

我们解决此问题的建议是尝试使用 MSBuild 来进行夜间构建，因为这应该比自动化 DevEnv /build 更强大。具体来说，您可能会避免此特定问题，因为 MSBuild 将使用 csc.exe 而不是 cslangsvc.dll 进行编译。

我们不太可能有进一步的 VS 2005 版本来修复 cslangsvc 问题，所以我正在解决这个错误不会修复，但如果您在使用 MSBuild 时仍然看到问题，请重新激活它。

再次感谢您提供有关此问题的所有信息！

Alex Turner 项目经理 Visual C# 编译器

# django - ModelMultipleChoiceField 验证因小部件而异

> ID：835305
> 
> 赞同：1
> 
> 时间：2009-05-07T15:21:56.383
> 
> 标签：django, django-forms, validation

我有一个带有 a 的表格，`ModelMultipleChoiceField`它就像一个魅力。但是，当我设置`widget=forms.RadioSelect`表单验证时，总是会失败并显示错误消息“输入值列表”。

正如我所说，它与默认小部件完美配合，但不适用于单选小部件。验证表单的`POST`请求*完全相同*，除了小部件外，一切都*完全相同*，所以我无法弄清楚我做错了什么。

为什么是这样？

编辑：也许我应该提到它也适用`CheckboxSelectMultiple`。

EDIT2：我是否设置似乎并不重要`required=False`，它仍然告诉我“输入值列表”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:49:52.697

哇，我真的搞砸了。当然`ModelMultipleChoiceField`不适用于`RadioSelect`，因为单选按钮列表意味着只能有一个选择。解决方案是使用`ModelChoiceField`.

# javascript - 在 XUL 中，我如何知道浏览器标签已完成加载？

> ID：835313
> 
> 赞同：0
> 
> 时间：2009-05-07T15:22:46.007
> 
> 标签：javascript, firefox, dom, xul

我正在开发一个基于[本教程](http://www.ibm.com/developerworks/web/library/wa-xul1/)的 Firefox 扩展，它是一个 FF 2.0 扩展（本教程的第二部分位于[此网址](http://www.ibm.com/developerworks/web/library/wa-xul2/)）

最重要的是它使用

```
<iframe id="contentview" src="http://www.ibm.com/developerworks/web" flex="2"/> 
```

在后端代码中，当单击 GO 按钮时，会发生这种情况：

```
contentview.contentDocument.location.href = urlbox.value;

//Use Firefox XPath to get the raw text of the document
var doctext = contentview.contentDocument.evaluate(
    "string(.)", document, null, XPathResult.STRING_TYPE, null).stringValue; 
```

我收到 xpath 错误，但这不是我的问题。我对 FF 3.0 的问题是 contentDocument 值是指加载的旧站点，而不是由 href-change 加载的站点。

所以我的问题是：我怎样才能创建一个类似的窗口，但是当加载的文档完成时会通知某人，这样我就可以访问它的 DOM？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:31:59.667

**更新：** 首先您需要处理窗口的加载事件，然后将事件侦听器添加到 iframe 元素

```
window.addEventListener("load",Listen,false);
function Listen()
{
  var frame = document.getElementById("contentview");
  frame.addEventListener("DOMContentLoaded", DomLoadedEventHandler, true);          
}

    function DomLoadedEventHandler() {
    var frame = document.getElementById("contentview");
    alert(frame.contentDocument.location.href);
    } 
```

用您的事件处理程序名称替换“DomLoadedEventHandler”。

我建议您查看 Mozilla 的官方网站以了解有关 Firefox 扩展的所有信息

[http://developer.mozilla.com](http://developer.mozilla.com)

# web-services - 如何在 SSRS 中安装没有凭据的共享数据源

> ID：835318
> 
> 赞同：1
> 
> 时间：2009-05-07T15:23:40.763
> 
> 标签：web-services, reporting-services, db2, credentials

我将 SQL Server 2005 与 Reporting Services 一起使用。我安装了许多报告，有些使用共享数据源，有些没有；一些访问 Web 服务，一些访问 sql server 数据库，现在我正在尝试连接到 DB2 数据库。

我已经在 Visual Studio 2005 中成功创建了共享数据源和报表。我可以很好地提取数据并将其显示在设计器中的报表上。我现在正在尝试通过 ssrs Web 服务安装报告和数据源（与所有其他报告相同）。

问题是我们的大多数数据源都使用集成安全性，对于这个数据源，我使用“不需要凭据”，因为它们已在连接字符串中列出。这是我的安装代码：

```
Dim definition As New ServiceProxy.DataSourceDefinition

definition.ConnectString = connectionStringIncludingUsernameAndPassword
definition.Extension = "OLEDB"
definition.CredentialRetrieval = ServiceProxy.CredentialRetrievalEnum.None 

ServiceWebService.CreateDataSource(dataSourceName, containingFolderFromRoot, True, definition, Nothing) 
```

这也可以正常工作并且没有错误，并且似乎可以在 ssrs 中正确创建数据源。但是当我去运行报告时，我得到了这个错误：

> 当前操作无法完成，因为执行此报表所需的用户数据源凭据未存储在报表服务器数据库中。(rsInvalidDataSourceCredentialSetting)

我的报表已正确连接到我的数据源，并且我的数据源已正确设置为不需要的凭据，因此它与 Visual Studio 中的完全一样。我没主意了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T19:44:15.800

问题有几个方面：

1.  用户名和密码列在连接字符串中，而不是在服务器内部
2.  报表服务器上安装的 db2 connect 软件已过期（8 而不是 9）
3.  用户组“DB2Users”没有任何成员

纠正这些问题后，报告有效！

# wpf - 如何在所有 WPF 用户控件中保持数据源更新？

> ID：835319
> 
> 赞同：0
> 
> 时间：2009-05-07T15:24:14.490
> 
> 标签：wpf, data-binding, xaml

我有一个带有**一个主窗口**的 WPF 应用程序。

在这个窗口中有一系列按钮，它们形成一个菜单和一个**在运行时加载用户控件**的空间。

但是，如果用户在一个用户控件中更改数据（存储在 XML 文件中），然后切换到另一个用户控件，**则用户不会在新用户控件中看到更新的数据**。用户必须重新启动应用程序才能看到更改。

这是我的视图如何绑定到 ModelView 的，后者又从模型（ObservableCollection）中获取数据：

```
<UserControl.Resources>
    <local:CustomersViewModel x:Key="CustomersDataProvider"/>
</UserControl.Resources>

<ListBox 
    ItemsSource="{Binding Path=GetAll, Source={StaticResource CustomersDataProvider}}" 
    ItemTemplate="{StaticResource CustomersDataTemplate}"/> 
```

**那么，在数据绑定仅在 XAML 中定义的情况下，我现在如何告诉视图从视图模型中重新获取数据（可能在类后面代码的构造函数中）？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T17:07:34.710

您是否尝试过在 Binding 上设置 Mode=TwoWay？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T17:20:11.700

问题可能是由于在 UserControl 的资源中声明的资源。这意味着每个 UserControl 都将拥有自己的资源副本，并且它们不会同步。考虑使用共享资源。

# c# - C# 如何为违反 Equals 合约的类选择 Hashcode？

> ID：835321
> 
> 赞同：3
> 
> 时间：2009-05-07T15:24:42.397
> 
> 标签：c#, hash, equals, gethashcode

由于某些原因，我有多个课程不遵守官方`Equals`合同。在被覆盖的情况下，`GetHashCode()`这些类只返回 0，因此它们可以在 Hashmap 中使用。

其中一些类实现了相同的接口，并且有使用该接口作为键的 Hashmaps。所以我认为每个类至少应该在`GetHashCode()`.

问题是如何选择这个值。我应该简单地让第一个类返回 1，下一个类返回 2，依此类推吗？或者我应该尝试类似的东西

```
class SomeClass : SomeInterface {
    public overwrite int GetHashCode() {
        return "SomeClass".GetHashCode();
    }
} 
```

所以哈希分布更均匀？（我必须自己缓存返回的值还是微软的编译器能够对此进行优化？）

**更新：**不可能为每个对象返回单独的哈希码，因为 Equals 违反了合同。具体来说，我指的是[这个问题](https://stackoverflow.com/questions/580905/is-there-a-way-to-get-a-hashcode-of-a-float-with-epsilon)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:27:12.703

我很好奇重写`GetHashCode()`和返回常量值的原因是什么。为什么要违反散列的想法，而不是仅仅违反“合同”而不是根本不覆盖`GetHashCode()`函数并保留默认实现`Object`？

**编辑**

如果你所做的是这样你可以让你的对象根据它们的内容而不是它们的引用来匹配，那么你建议让不同的类简单地使用不同的常量就可以工作，但是效率很低。您要做的是提出一种散列算法，该算法可以获取类的内容并产生一个平衡速度与均匀分布的值（即散列 101）。

我想我不确定你在寻找什么......没有一个“好的”方案来为这个范例选择常数。一个并不比另一个好。尝试改进您的对象，以便创建真正的散列。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T15:29:00.423

如果它“违反了 Equals 合同”，那么我不确定您是否应该将其用作密钥。

它使用它作为键，你真的需要正确的散列......`Equals`逻辑是什么非常不清楚，但是被认为相等的两个值**必须**具有相同的散列码。不要求具有相同哈希码的两个值相等。

使用常量字符串并没有太大帮助 - 您将在类型上平均分配值，但仅此而已......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:32:21.303

当散列冲突发生时，HashTable/Dictionary 调用 Equals 来查找您要查找的键。使用恒定哈希码首先消除了使用哈希的速度优势——它变成了线性搜索。

您是说 Equals 方法尚未根据合同实施。你到底是什么意思？根据违规的类型，HashTable 或 Dictionary 只会很慢（线性搜索）或根本不起作用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T15:42:25.663

我在编写向量类时遇到了这个确切的问题。我想比较向量是否相等，但浮点运算会产生舍入误差，所以我想要近似相等。长话短说，除非你的实现是对称的、自反的和传递的，否则重写 equals 是一个坏主意。

其他类将假设 equals 具有这些属性，使用这些类的类也将如此，因此您可能会遇到奇怪的情况。例如，一个列表可能会强制执行唯一性，但最终有两个元素评估为等于某个元素 B。

当您破坏相等时，哈希表是不可预测行为的完美示例。例如：

```
//Assume a == b, b == c, but a != c
var T = new Dictionary<YourType, int>()
T[a] = 0
T[c] = 1
return T[b] //0 or 1? who knows! 
```

另一个例子是一个集合：

```
//Assume a == b, b == c, but a != c
var T = new HashSet<YourType>()
T.Add(a)
T.Add(c)
if (T.contains(b)) then T.remove(b)
//surely T can't contain b anymore! I sure hope no one breaks the properties of equality!
if (T.contains(b)) then throw new Exception() 
```

我建议使用另一种方法，名称类似于 ApproxEquals。您还可以考虑覆盖 == 运算符，因为它不是虚拟的，因此不会被 Equals 等其他类意外使用。

如果你真的不能对哈希表使用引用相等，不要破坏你可以使用的情况的性能。添加一个 IApproxEquals 接口，在您的类中实现它，并向 Dictionary 添加一个扩展方法 GetApprox，该方法枚举查找近似相等的键，并返回关联的值。您还可以为 3 维向量或任何您需要的东西编写自定义字典。

# c++ - 从旧的 Borland C++ 迁移到 Visual C++ Express

> ID：835324
> 
> 赞同：2
> 
> 时间：2009-05-07T15:25:41.880
> 
> 标签：c++, visual-c++, migration

冒着出现恐龙的风险，我有一些旧的 C++ 代码，用 Borland C++ 编译，它设置寄存器和与汇编程序模块的接口，我想对其进行现代化改造。我刚刚安装了MS VC++ Express，不用说很多东西都不行！默认似乎是 Win32，这很好，所以我已经删除了 FAR 和 HUGE。PASCAL 似乎映射到 __stdcall。所以我有一个宏

```
 #define THRCOMP  extern "C" int FAR PASCAL _Export 
```

where`THRCOMP`在模块名称前面。这大概会导致类似

```
extern "C" int __stdcall _Export <modname>; 
```

编译器不喜欢它，并发出一条关于“时代错误”的消息（没有说什么！）。怎么了？

旧代码集还具有内联汇编器，我需要将其转换为单独编译的子例程 - 是否有（免费）汇编器，它可以将汇编器 obj 甲板与 C++ 链接吗？

顺便说一句，我看不到我的 obj 卡组 - 但 WinZip 把它们捡起来了！解释？

一般来说，是否有迁移旧 C++ 代码的指南？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T15:36:20.980

您的示例中的一些具体内容：

*   VC根本不喜欢`_Export`。
*   不合时宜的是您`__stdcall`在数据声明上有修饰符（如 ）。如果`<modname>`没有括号，则它是一个数据声明，并且修饰符不做任何事情。如果`<modname>`是在汇编中实现的函数，则仍应使声明包含参数列表。

例如：

```
extern "C" int __stdcall  modname( int x); 
```

[您可以从Windows 驱动程序工具包](http://www.microsoft.com/whdc/DevTools/WDK/WDKpkg.mspx)（WDK - 以前称为 DDK）中获得免费的汇编程序，但如果您当前的代码是使用 Borland 的 TASM 编译器编写的，它可能不会使用相同的语法，因此可能会有相当多的移植它的一些工作。但是，如果当前的汇编程序是 16 位代码，那么无论如何您将有很多工作将其移植到 32 位汇编程序......

# iphone - 您如何使用 PhoneGap（在 iPhone 上）获取用户电话号码？

> ID：835330
> 
> 赞同：3
> 
> 时间：2009-05-07T15:27:02.783
> 
> 标签：iphone, cordova

那么PhoneGap中有一个plist布尔值引用用户的电话号码吗？这个可以收购吗？这个 StckOverflow 问题不建议： [Programmatically get own phone number in iOS](https://stackoverflow.com/questions/193182/programmatically-get-own-phone-number-in-iphone-os)

我想自动填充我的 iBlipper.com 应用程序中的消息“我的号码是...”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T19:29:58.720

这句话的措辞可能有点模棱两可。如果您在 XCode 文档浏览器中查看 UIWebView 属性检测电话号码的文档，您会发现它不会检测用户的电话号码，而是在 HTML 中识别电话号码。

以下是相关文档的片段：

> 默认情况下，Web 视图会自动将出现在 Web 内容中的电话号码转换为电话链接。当点击电话链接时，电话应用程序将启动并拨打该号码。将detectPhoneNumbers 属性设置为NO 以关闭此默认行为。

唯一标识单个设备的唯一方法是通过其设备 ID 属性。这不是一个易于阅读的值，只能识别手机。因此，如果一个人购买了一部新手机，或者将他们的手机卖给了其他人，那么设备 ID 是不同的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-05-22T15:04:24.837

这是一篇关于获取 android 电话号码的博客文章，但它涵盖了您需要的常见 js：http: [//simonmacdonald.blogspot.com/2012/12/how-to-get-devices-phone-number-using .html](http://simonmacdonald.blogspot.com/2012/12/how-to-get-devices-phone-number-using.html)

但是，您似乎无法在没有用户交互的情况下使用目标 C 从手机中获取电话号码（使用标准 API）：[Programmatically get own phone number in iOS](https://stackoverflow.com/questions/193182/programmatically-get-own-phone-number-in-ios)

所以你可能不走运。

# javascript - 无论焦点如何，我都想在 HTML 文本输入字段中的每次数据更改时触发一个事件

> ID：835337
> 
> 赞同：1
> 
> 时间：2009-05-07T15:28:21.577
> 
> 标签：javascript, jquery, html, ajax

当浏览器使用浏览器对纯 HTML 输入字段的自动完成功能更改输入文本字段时，如何捕获客户端事件？（这是浏览器提供的输入字段的小下拉菜单，我知道您可以在某些浏览器中的每个输入字段中使用“autocomplete=off”禁用它。）

我已经绑定到“change/keyup”事件，但是当用户开始输入一个值并使用浏览器的本机自动完成来填充字段的其余部分（并保持焦点）时，这些不处理这种情况领域的。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T15:38:51.617

我所知道的唯一万无一失的方法是使用 setInterval 来始终捕获所有更改，无论它们是如何完成的。不过，这有点占用 CPU，因此您可能希望尝试使选择器比这更小。

```
setInterval( function() {
    $('input').each( function() {
        if ($(this).val() != $(this).attr("_value")) {
            // Save the new value
            $(this).attr("_value", $(this).val());

            // TODO - Handle the changed value
        }
    });
}, 100); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T15:46:02.597

老实说，“更改”事件并没有触发，我很惊讶……

无论如何，**Plutor**的想法是正确的。他的答案更CPU友好的版本：

```
var value,
    elem = $('input[name=email]')[0];
setInterval(function(){
    if (elem.value !== value) { /* do something */ }
    value = elem.value;
}, 100); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-23T07:23:37.820

您可以在几秒钟后在您的函数中调用您的函数，试试这个：

```
function startTime() {
    var today=new Date();
    var h=today.getHours();
    var m=today.getMinutes();
    var s=today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    document.getElementById('txt').innerHTML = h+":"+m+":"+s;
    var t = setTimeout(function(){startTime()},500);
}

function checkTime(i) {
    if (i<10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
}
```

```
<!DOCTYPE html>
<html>
<head></head>
<body onload="startTime()">

<div id="txt"></div>

</body>
</html>
```

参考是：[http ://www.w3schools.com/js/tryit.asp?filename=tryjs_timing_clock](http://www.w3schools.com/js/tryit.asp?filename=tryjs_timing_clock)

# ruby-on-rails - 使用相同的操作来显示所有（索引）对象，但也显示由 url 参数限定的列表

> ID：835342
> 
> 赞同：2
> 
> 时间：2009-05-07T15:29:29.860
> 
> 标签：ruby-on-rails, ruby, activerecord

我遇到了一个问题，想出一个好方法来执行以下操作。我有一个非常通用的组织模型和用户模型。组织`has_many :users`，和`User belongs_to :org`。

我正在尝试找到一种方法来显示不受 Org 限制的用户列表，同时也显示受 Org 限制的用户列表。我知道我可以嵌套路线，并且只有两条不同的路线，例如

```
map.resources :users
map.resources :orgs, :has_many => :users 
```

问题是它们都返回到用户控制器中的相同操作。控制器代码开始变得非常混乱，因为我必须检查 :org_id 参数是否存在。然后我必须决定是返回对 User 的 find 调用的正常结果，还是返回范围为 Org 的 find。我不确定这里的最佳解决方案是什么，或者最佳实践是什么。如果有这方面知识的人可以赐教，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T16:01:02.543

在技​​术层面上可能不是您真正想要的答案，但我为我的项目使用了一个插件，为我解决了这个问题。看看[make_resourceful](http://github.com/hcatlin/make_resourceful/tree/master)。

```
make_resourceful do
 actions :all
 belongs_to :org
end 
```

它会为您解决剩下的问题，无需定义您的标准 crud 操作。它甚至会检测范围并为您确定范围。（除非那是我正在使用的其他插件，我忘记了）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T16:14:04.993

在大多数情况下，我使用[resource_controller](http://github.com/giraffesoft/resource_controller/tree/master)插件。有了它，您只需输入：

```
class UsersController < ApplicationController
  resource_controller
  belongs_to :org
end 
```

它适用于嵌套和非嵌套资源。

如果你不想使用额外的插件，你的控制器仍然不会很复杂。

```
class UsersController < ApplicationController
  def index
    @org = Org.find(params[:org_id]) unless params[:org_id].blank?
    @users = params[:org_id].blank? ? User.all : @org.users
    ...
  end
end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T20:41:08.783

没有插件的另一种方法是使用[named_scope](http://api.rubyonrails.org/classes/ActiveRecord/NamedScope/ClassMethods.html)。如果它不为空，您可以在 User 中创建一个按 org_id 过滤的命名范围。

```
class User < ActiveRecord::Base
  belongs_to :org
  named_scope :by_org, lambda{|org| org.blank? ? {} : { :conditions => ['org_id = ?', org] }}
end 
```

在控制器中，只需使用您的命名范围。这样，如果您最终在控制器中提供更多过滤器选项，则无需复制它们：

```
class UsersController < ApplicationController
  def index
    @users = User.by_org(params[:org_id]).all
    ...
  end
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T22:10:50.520

我通常做的是这样的：

```
class UsersController < ApplicationController
  def index
    root = Org.find(params[:org_id]) if params[:org_id]
    root = User if root.nil?
    @users = root.all(:conditions => {...}, :order => "...")
  end
end 
```

我基本上是在树上散步。添加条件后，我只需更改#find 调用的根。当我完成评估条件时，我调用最后的#find / #first / #all 方法，我就完成了。

如果您有多个命名范围，这也适用：

```
class UsersController < ApplicationController
  def index
    root = Org.find(params[:org_id]) if params[:org_id]
    root = User if root.nil?
    root = root.named(params[:name]) if params[:name]
    root = root.registered_after(params[:registered_at]) if params[:registered_at]
    # more conditions, as required
    @users = root.all(:conditions => {...}, :order => "...")
  end
end 
```

# apache-flex - Flex：确保用户获得的是最新版本而不是缓存版本？

> ID：835344
> 
> 赞同：0
> 
> 时间：2009-05-07T15:29:52.010
> 
> 标签：apache-flex, caching

有没有办法确保当用户查看我的 Flex 应用程序时，他们使用的是最新版本而不是缓存版本？

**这篇文章的副本[——prevent-flex-application-caching](https://stackoverflow.com/questions/300757/preventing-flex-application-caching-in-browser-multiple-modules) ...。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:00:37.290

如果您使用的是服务器端脚本语言，请获取 HTML 包装器的内容，将其放入脚本文件中，然后在 SWF URL 的末尾添加一些随机内容：

内容/application.swf?1234567890

以毫秒为单位附加当前时间通常效果很好。

# c# - 属性更改时未引发 BindingList.ListChanged 事件

> ID：835345
> 
> 赞同：4
> 
> 时间：2009-05-07T15:30:25.597
> 
> 标签：c#, bindinglist

我有一个用户类型的 BindingList，用户对象有几个属性（用户名、密码等）。所以我将一个事件处理程序绑定到 BindingList.ListChanged 事件，它在添加或删除用户时工作正常，但是，如果用户属性发生变化，它不会引发事件，有没有办法实现这一点？

```
bindingListUsers.Add(someUser); // This raises ListChangedEvent

bindingListUsers.Delete(someUser); // This raises ListChangedEvent

bindingListUsers[0].UserName = "Another user name"; // This does NOT raise the event 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-07T15:41:32.903

您的用户类型需要实现`INotifyPropertyChanged`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T15:39:28.087

我能想到的唯一方法是在 User 类中定义一个事件，该事件在属性值更改时触发（您必须为此手动编写代码）。然后创建一个绑定列表的包装类。处理该类中的列表事件和用户类事件。

如果您喜欢这个想法，我可以详细说明...

# xml - Flex：如何判断 XML 格式是否正确？

> ID：835348
> 
> 赞同：3
> 
> 时间：2009-05-07T15:30:54.020
> 
> 标签：xml, apache-flex, validation

我有一个加载一些 XML 的函数，如下所示：

```
private function onXMLLoad(e:Event):void
            {
                trace(e.target.data);
                hideLoading();
                DataModel.instance.data = XML(e.target.data);
                updateSelections();
                toggleExpand();
            } 
```

如果正在加载的 XML 数据格式不正确，例如打开的标签不会关闭。我收到一条错误消息，告诉我 XML 格式必须正确。我真的不*打算*加载格式不正确的 XML，但万一它真的发生了，我希望能够以某种方式处理它。首先，有没有办法在将加载的数据转换为 XML 之前判断其格式是否正确，如果可能，尝试修复它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T06:00:05.227

您可以将演员表包装在 try/catch 语句中：

```
try {
  DataModel.instance.data = XML(e.target.data);
} catch (err:TypeError) {
  //handle error
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T22:34:06.187

AFAIK，没有进行 XML 验证的官方 Flex/AS3 库，我也不知道任何自定义库。

如果您可以在服务器端验证 XML（假设适用），那可能是您最好的选择，因为对于大多数服务器端语言，您将拥有更多选择。

您可以编写自己的类/函数来验证 AS3 中的 XML，然后再将其加载到 XML 类中。将数据变量作为字符串读入并对其进行解析，执行必要的操作以验证 XML 是否满足您的要求，包括匹配标签，并进行所需的任何更正。

# html - 在 CruiseControl 仪表板中显示 HTML 报告

> ID：835349
> 
> 赞同：5
> 
> 时间：2009-05-07T15:31:09.387
> 
> 标签：html, xml, cruisecontrol.net, documentation-generation, dashboard

我最近一直在研究 CruiseControl 配置（我是一个完整的 CC 菜鸟），到目前为止，我了解您的构建过程生成的各种 XML 报告（例如 mbunit.xml、ncover.xml、fxcop.xml）可以显示在通过向 ccnet.config 的以下部分添加对 xml 的引用来控制仪表板：

```
<publishers>
 <merge>
  <files>
   <file>logs\some-report.xml</file>
  </files>
 </merge>
</publish> 
```

添加一个 xsl 文件以将 xml 转换为可呈现的 html，并将报告构建插件添加到引用 xsl 的dashboard.config：

```
<xslReportBuildPlugin description="Some report"
actionName="SomeReportAction" xslFileName="xsl\some-report.xsl" /> 
```

我的问题是：如果我有一些纯 HTML 的报告（由 JGregory 的 Docu 生成的代码文档和由 jpboodhoo 的 Bdddoc 生成的测试规范），有什么方法可以以类似的方式在仪表板中显示这些？我想不通。我确实想过将 ExternalLink 直接添加到 HTML 页面，但这是在用户通常无法访问的受保护区域中。有人有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T02:33:34.910

目前这在 CruiseControl.NET 版本 1.4.4 之前是不可能的。但是，此功能将作为 1.5.0 版的一部分添加。

[我们还不能为您提供发布的时间表，但您可以从http://ccnetlive.thoughtworks.com/CCNet-builds/1.5.0/](http://ccnetlive.thoughtworks.com/CCNet-builds/1.5.0/)下载并试用最新版本。

克雷格

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-03-04T14:05:20.393

正如 craig 已经提到的，此功能是在 CCNet 1.5 中添加的，您可以在此处找到有关 HtmlPlugin 的文档：http: [//cruisecontrolnet.org/projects/ccnet/wiki/HtmlReportPlugin](http://cruisecontrolnet.org/projects/ccnet/wiki/HtmlReportPlugin)

# c++ - 从代码块导出生成文件

> ID：835352
> 
> 赞同：25
> 
> 时间：2009-05-07T15:32:17.170
> 
> 标签：c++, makefile, codeblocks

是否可以从 C++ 代码块项目中导出生成文件？

如果是这样，它是如何完成的？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-08T00:04:01.837

我使用 cbp2mak，在这里阅读[http://forums.codeblocks.org/index.php?topic=9731.msg69835#msg69835](http://forums.codeblocks.org/index.php?topic=9731.msg69835#msg69835)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-12-13T14:07:24.083

你也可以使用这个[http://forums.codeblocks.org/index.php/topic,13675.0.html](http://forums.codeblocks.org/index.php/topic,13675.0.html)

该项目是 cbp2make，它托管在这里：http: [//sourceforge.net/projects/cbp2make](http://sourceforge.net/projects/cbp2make)

# jquery - GetListItems Webservice 忽略我的查询过滤器

> ID：835358
> 
> 赞同：3
> 
> 时间：2009-05-07T15:32:44.937
> 
> 标签：jquery, web-services, sharepoint

下面的代码看似执行 Web 服务并返回值，但忽略了 where 子句（因此返回列表中的所有项目）。这是我提出的问题的最简单形式。

TestQuery 列表是一个简单的自定义列表，没有用户定义的字段。谁能看到为什么过滤器不起作用？

```
<body>
<script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    var soapEnv = "<soapenv:Envelope xmlns:soapenv='http://schemas.xmlsoap.org/soap/envelope/'><soapenv:Body><GetListItems xmlns='http://schemas.microsoft.com/sharepoint/soap/'>";
    soapEnv += "<listName>TestQuery</listName>";
    soapEnv += "<Query><Where><Eq><FieldRef Name='Title'/><Value Type='Text'>One</Value></Eq></Where></Query>";
    soapEnv += "<ViewFields><ViewFields><FieldRef Name='Title'/></ViewFields></ViewFields><RowLimit>1</RowLimit>";
    soapEnv += "</GetListItems></soapenv:Body></soapenv:Envelope>";

    $.ajax({
        url: "_vti_bin/lists.asmx",
        type: "POST",
        dataType: "xml",
        data: soapEnv,
        complete: processResult,
        contentType: "text/xml; charset=\"utf-8\""
    });
});

function processResult(xData, status) {
            $('#WSResponse').text(status);
    $(xData.responseXML).find("z\\:row").each(function() {
        var liHtml = "<li>" + $(this).attr("ows_Title") + "</li>";
        $("#tasksUL").append(liHtml);
    });
    //}
}
</script>

<ul id="tasksUL"/>
<div id="WSResponse"/>

</body> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T15:48:54.320

我认为您需要将 Query 标记放在查询标记中，将 ViewField 放在 viewField 标记中，如下所示：

```
var soapEnv = "<soapenv:Envelope xmlns:soapenv='http://schemas.xmlsoap.org/soap/envelope/'><soapenv:Body><GetListItems xmlns='http://schemas.microsoft.com/sharepoint/soap/'>"; 
    soapEnv += "<listName>TestQuery</listName>"; 
    soapEnv += "<query><Query><Where><Eq><FieldRef Name='Title'/><Value Type='Text'>One</Value></Eq></Where></Query></query>"; 
    soapEnv += "<viewFields><ViewFields><FieldRef Name='Title'/></ViewFields></viewFields><RowLimit>1</RowLimit>"; 
    soapEnv += "</GetListItems></soapenv:Body></soapenv:Envelope>"; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T15:43:04.337

您缺少一个 <查询>。这些参数的格式有点违反直觉。

我的博客上有一篇文章，其中包含一个工作示例：

[http://tqcblog.com/2007/09/24/sharepoint-blog-content-rating-with-javascript-and-web-services](http://tqcblog.com/2007/09/24/sharepoint-blog-content-rating-with-javascript-and-web-services)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-08T05:18:55.580

我也遇到过同样的问题.. 'Temple 的解决方案已经解决了查询问题.. 但是为了使 RowLimit 工作，我将'R' 设为小写，即

```
<rowLimit> not <RowLimit> 
```

这从我这里抢走了相当多的时间...... :) 快乐的编码......

# java - 如何将“对”或 n 大小插入列表集合而不是组合 HashMap？

> ID：835359
> 
> 赞同：0
> 
> 时间：2009-05-07T15:32:47.590
> 
> 标签：java, collections, map, dataset, queue

所以，我有一种情况，我需要将三个值传递到串行 BlockingQueue 队列中：

```
(SelectableChannel, ComponentSocketBasis, Integer). 
```

它们实际上根本不需要进行哈希映射，使用 HashMap 是荒谬的，因为每个条目总是只有一个键；如果它们只是在某种有序集合中就好了。但是，由于缺乏已知的替代方案，我在实现中使用了 HashMap 并生成了这个混淆的泛型组合：

```
private LinkedBlockingQueue<HashMap<HashMap<SelectableChannel, ComponentSocketBasis>, Integer>> deferredPollQueue = new LinkedBlockingQueue<HashMap<HashMap<SelectableChannel, ComponentSocketBasis>, Integer>>(); 
```

这看起来真的很荒谬。我一定是个可怕的 n00b。当然有一种更好的方法可以做到这一点，它不需要我在检索值时分解密钥或浪费（理论上——在实践中，Java 总是臃肿的 :) 算法复杂性在我不需要的无用哈希计算上因为我有一个 1 的键空间，甚至不想关联映射这三个引用，而只是对它们进行分组？有了这个实现，我必须这样提取值：

```
while(deferredPollQueue.size() > 0) {
    System.out.println("*** Draining new socket channel from queue");
    HashMap<HashMap<SelectableChannel, ComponentSocketBasis>, Integer> p = deferredPollQueue.take();

    SelectableChannel chan = null;
    ComponentSocketBasis sock = null;
    int ops = 0;

    HashMap<SelectableChannel, ComponentSocketBasis> q = p.keySet().iterator().next();

    chan = q.keySet().iterator().next();
    sock = q.get(chan);

    ops = p.get(q).intValue();

    SelectionKey k = chan.register(selector, ops);  

    if(!channelSupervisorMap.containsKey(k))
        channelSupervisorMap.put(k, sock);
} 
```

我很确定这里的每个有知觉的人都可能认为这是一种荒谬的做法，所以问题是——正确的方法是什么？:) 我在任何地方都找不到 java.util.Pair 或 java.util.Triplet 的证据。

我想 Orthodox Way(TM) 会做一个自定义类或接口，只是为了容纳这个三元组，但是对于这么大的系统中这么小的任务，这似乎是荒谬的冗长和不必要的——不过，再说一次，那就是Java本身。

出于同样的原因，也许这些值可以放在一个 ArrayList 或一个 Vector 或其衍生物上，但在 Java 中，这并没有产生比我在这里摆脱这个 HashMap 更简洁的方法来解决它们，尽管它确实解决了也许是算法复杂性问题。

回到 Perl 领域，我们只需将数组引用用作数组中的值即可：

```
push(@$big_queue_array, [$elem1, \%elem2, \@elem3]); 
```

Java中最好的等价物是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T15:35:19.457

为什么不创建自己的通用 Pair 或 Triple 类？几乎每个 Java 5+ 项目最终都将它们放在自己的 util 类中！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T15:39:52.783

您说保存三元组的自定义类会变得臃肿且不必要，但这确实是这样做的方式，这就是面向对象建模的工作方式。自定义类是显式且可读的，并且不会比通用持有者类占用更多的运行时资源。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T15:45:58.650

[函数式 Java](http://code.google.com/p/functionaljava)有[pair](http://functionaljava.googlecode.com/svn/artifacts/2.19/javadoc/fj/P2.html)、[triplets](http://functionaljava.googlecode.com/svn/artifacts/2.19/javadoc/fj/P3.html)和 tuples 到 arity 8。还有一种类型称为[`HList`](http://functionaljava.googlecode.com/svn/artifacts/2.19/javadoc/fj/data/hlist/HList.html)arity arity。所以你的类型是：

```
LinkedBlockingQueue<P3<SelectableChannel, ComponentSocketBasis, Integer>> 
```

这只是一个库，所以把 jar 放到你的类路径中就可以了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T15:58:02.380

您可以只使用 ArrayList 来存储对象，因为您知道哪个对象将在哪个位置。使用成员 SelectableChannel 和 ComponentSocketBasis 创建一个新类可能会更好。

如果你要经常做这种事情，现在创建一个泛型对或元组将节省你很多时间，但如果这是你将要使用它的唯一地方，那么创建一个新的类将导致更容易阅读代码。

每当您在代码中看到您的类名时，您就会确切地知道它的用途，而如果您只是看到您的通用合并，您（或其他人）可能更难理解它的用途。

这是编程时间和可读性之间的权衡。

# asp.net - ASP.NET webforms - meta:resourcekey 是唯一的还是我们可以创建自己的元数据？

> ID：835361
> 
> 赞同：0
> 
> 时间：2009-05-07T15:33:06.107
> 
> 标签：asp.net, webforms

这个主题几乎说明了一切。该属性是如何工作的，我们是否可以使用我们想要的任何功能`meta:resourcekey`创建自己的标签？`meta:stackoverflow`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T12:46:42.137

废话。原来这些前缀是用于[设备过滤](http://msdn.microsoft.com/lv-lv/library/ms178620(en-us).aspx)的。而且`meta:resourcekey`很特别。:P

# sharepoint - 具有无法添加到文件夹的自定义新表单的 Sharepoint 自定义列表

> ID：835364
> 
> 赞同：0
> 
> 时间：2009-05-07T15:33:32.063
> 
> 标签：sharepoint, moss, designer, wss-3.0

我有一个自定义列表，其中包含用户所需的自定义编辑和新表单。

然后，我尝试将新项目添加到文件夹（文件夹具有年度文本，例如 2010 年），当我单击自定义新表单上的保存时，它会正确保存，但始终保存到列表的根目录。

我想知道是否有解决方法或解决方法，因为它非常烦人。

或者，任何人都可以推荐一种方法来实现一个从创建日期开始自动计算 + 1 年的字段，这可能是一个可能的替代方案，但它必须考虑以下内容。

本年度从 10 月到 9 月运行。

感谢您提供的任何帮助，这让我疯狂地试图找到解决方案。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T15:46:45.823

如果不知道您基于什么自定义表单，将无济于事，但对于新表单，要保存到的文件夹通常显示在查询字符串中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T16:05:12.050

该表单是一个基本的自定义表单列表，然后我只修改了部分以删除不需要或需要只读的字段。

原始表单完美运行，并允许将项目添加到列表子文件夹中。

新的没有额外的代码，并且使用标准的共享点 DataFormWebPart 来创建自定义列表表单，所以我没有后端代码来插入项目等，尽管我可能不得不求助于这个......我会吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T16:28:41.777

修改标准表格时需要小心。我建议您返回标准表单的副本并验证它是否正确保存。删除“不需要的”字段，直到它停止工作。

有时，通过这种自定义，您需要使用 css 而不是服务器端更改来修改表单，以便在隐藏组件后功能仍然存在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T10:04:52.533

删除字段绝对不是问题，因为我创建了原始副本的新副本，然后将其更改为自定义字段并保存它并尝试添加项目。

它直接进入了根。

我尝试了原始表单并正确保存到子文件夹。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T14:06:17.843

好吧，我目前只能解决这个问题（我目前正在与 MS 讨论）就是这个。

[http://blogs.msdn.com/sharepointdesigner/archive/2007/06/13/using-javascript-to-manipulate-a-list-form-field.aspx](http://blogs.msdn.com/sharepointdesigner/archive/2007/06/13/using-javascript-to-manipulate-a-list-form-field.aspx)

我使用了方法 getTagFromIdentifierAndTitle(tagName, identifier, title)

这返回了我想要的元素，然后我基本上去了行 dom 节点并删除了它。

我希望有一个更好的方法，但至少现在可以解决。

# c# - 我的 asp.net-mvc 站点的 TranslateAttribute

> ID：835365
> 
> 赞同：0
> 
> 时间：2009-05-07T15:33:38.600
> 
> 标签：c#, .net, asp.net-mvc, action-filter

在我当前的项目中，我有一个自定义 ViewData，它具有（除其他外）以下属性：

```
自定义视图数据
  + IList <语言> siteLangauges
  + 语言 CurrentLanguage
  + T9nProvider

```

我所有的网址都是这样的：

[http://someUrl.com/](http://someUrl.com/) {siteLanguage}/{restOfUrlIncludingcontrollersAndACtions}

我想创建一个捕获每个请求的 ActionAttribute，检查 siteLanguage 值是什么，并在 CustomViewData 上设置 Language 值。我当前的（非工作）代码是这样的：

```
public class TranslateAttribute: ActionFilterAttribute, IActionFilter
{
    void IActionFilter.OnActionExecuting(ActionExecutingContext filterContext)
    {
        ViewDataDictionary viewData = filterContext.Controller.ViewData;
        if (viewData is CustomViewData) { 
            (viewData as CustomViewData).Language = new Language(filterContext.ActionParameters["siteLanguage"] as string));
        }
        base.OnActionExecuting(filterContext);
    }

    void IActionFilter.OnActionExecuted(ActionExecutedContext filterContext)
    {
        base.OnActionExecuted(filterContext);
    }
} 
```

第一个问题是 viewdata 永远不是 customviewdata。为什么不？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T15:38:22.787

> 如果（viewData 是 CustomViewData）

这是一个非常奇怪的检查。它有什么作用？

我建议你放弃它。

您不需要调用基本实现 - base.OnAction ...

您也不需要从 IActionFilter 派生。派生自ActionFilterAttribute，这就够了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T15:41:48.643

您可以在控制器上设置 ViewData，那么为什么不为 CustomViewData 创建一个构造函数，该构造函数采用 ViewData 对象并执行以下操作：

```
var customData = new CustomViewData( filterContext.Controller.ViewData);
customData.Language = new Language(filterContext.ActionParameters["siteLanguage"] as string));
filterContext.Controller.ViewData = customData;
base.OnActionExecuting( filterContext ); 
```

# jquery - jQuery：如何通过其 src 查找图像

> ID：835378
> 
> 赞同：55
> 
> 时间：2009-05-07T15:36:22.837
> 
> 标签：jquery

我需要按名称和 src 找到一个 img。我一直在尝试以下无济于事。

```
var s = $("img[src='/images/greendot.gif'][name='BS']"); 
```

的HTML：

```
<img alt="This item is active." name="BS" src="/images/greendot.gif"/> 
```

对比

```
<img alt="This item is not active." name="BS" src="/images/spacer.gif"/> 
```

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-05-07T15:50:55.393

没有看到 html 我会说检查你的路径。

```
$("img[src$='greendot.gif'][name='BS']") 
```

给出以下 HTML：

```
<img src="http://assets0.twitter.com/images/twitter_logo_header.png" name="logo" /> 
```

这个jQuery工作：

```
var x = $("img[src$='twitter_logo_header.png'][name='logo']");
alert(x.attr("src")); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T15:42:30.950

尝试丢失引号：

```
var s = $("img[src=../../images/greendot.gif][name=BS]"); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-04-28T18:01:25.060

浏览器添加了 src、href 和类似属性的完整路径。所以即使元素是用相对路径定义的，在 DOM 'src' 属性中也包含域名和完整路径。使用 [src$="..."] 语法或指定完整的域名似乎是通过 src 使用 jQuery 查找图像的唯一选项。

* * *

我在这里可能错了。图像对象的 src 属性报告完整路径，但该属性应包含代码中指定的路径。[src="relative/path"] 在最新的 jQuery 版本中工作，也许它是一个早期版本，它没有工作。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-02-19T03:19:49.310

像这样更改您的 img 标签：

```
<img src="path/to/imgage/img.jpg" title="img.jpg" /> 
```

我的意思是添加到您的图像标题属性并设置它们的文件名。

当您需要访问某些图像时，您可以执行以下操作：

```
//Finding image that you need using 'title' attribute; 
var imageTag = $("img[title='imageName']");

//Then if you need to do something with it;
imageTag.attr('src', 'path/to/newImage/newImage.jgp');
imageTag.attr('title', 'newImage.jpg'); 
```

# web-services - 使用 Web 服务的 ibm iseries 遗留代码的最佳选择是什么？

> ID：835381
> 
> 赞同：0
> 
> 时间：2009-05-07T15:36:34.040
> 
> 标签：web-services, ibm-midrange, rpgle

场景：rpg 中的旧遗留代码必须使用来自新 Web 服务的数据我认为在以任何语言实现的新存储过程中以充当代理，但肯定有更好的选择我见过的一些选择是[http://www。 rpg-xml.com/](http://www.rpg-xml.com/)（第三方专有）或使用带有 DB2 XML Extender 的 Java 存储过程

谢谢！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T14:20:16.157

两者都是非常好的选择。这实际上取决于您在团队中的专业知识。如果您只知道 RPG，请使用 RPG 解决方案。如果您有具有 .NET 或 Java 经验的人，请使用它。

如果您有更多与此相关的问题，[Web400 邮件列表](http://lists.midrange.com/listinfo/web400)上有一个很棒的开发人员社区可以提供帮助。

# java - 可以从非空的 UTF-8 字节数组创建一个空的 java 字符串吗？

> ID：835385
> 
> 赞同：3
> 
> 时间：2009-05-07T15:37:16.893
> 
> 标签：java, string, utf-8

我正在尝试调试某些东西，我想知道以下代码是否可以返回 true

```
public boolean impossible(byte[] myBytes) {
  if (myBytes.length == 0)
    return false;
  String string = new String(myBytes, "UTF-8");
  return string.length() == 0;
} 
```

是否有一些我可以传递的值会返回 true？我只传入一个 2 字节序列的第一个字节，但它仍然产生一个字符串。

澄清一下，这发生在 PowerPC 芯片上，Java 1.4 代码通过 GCJ 编译为本机二进制可执行文件。这基本上意味着大多数赌注都是关闭的。我主要想知道 Java 的“正常”行为或 Java 的规范是否做出了任何承诺。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T15:49:31.230

根据 java.util.String 的 javadoc，当 bytearray 包含无效或意外数据时，未指定 new String(byte[], "UTF-8") 的行为。如果您希望生成的字符串具有更高的可预测性，请使用[http://java.sun.com/j2se/1.5.0/docs/api/java/nio/charset/CharsetDecoder.html](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/charset/CharsetDecoder.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T15:50:30.790

可能。

来自 Java 5 API 文档“未指定给定字节在给定字符集中无效时此构造函数的行为。”

我想这取决于：您使用的是哪个版本的 java 哪个供应商编写了您的 JVM（Sun、HP、IBM、开源的等）

一旦文档说“未指定”，所有的赌注都取消了

编辑：被[Trey](https://stackoverflow.com/users/50603/trey) 打败 听从他关于使用 CharsetDecoder 的建议

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:52:07.807

如果 Java 正确处理[BOM 标记](http://en.wikipedia.org/wiki/Byte-order_mark)（我不确定他们是否已经修复它），那么应该可以输入一个仅包含 BOM 的字节数组（U+FEFF，在 UTF-8 中是字节序列EF BB BF) 并得到一个空字符串。

* * *

更新：

我用 1-3 个字节的所有值测试了该方法。它们都没有在 Java 1.6 上返回空字符串。这是我使用不同字节数组长度的测试代码：

```
public static void main(String[] args) throws UnsupportedEncodingException {
    byte[] test = new byte[3];
    byte[] end = new byte[test.length];

    if (impossible(test)) {
        System.out.println(Arrays.toString(test));
    }
    do {
        increment(test, 0);
        if (impossible(test)) {
            System.out.println(Arrays.toString(test));
        }
    } while (!Arrays.equals(test, end));

}

private static void increment(byte[] arr, int i) {
    arr[i]++;
    if (arr[i] == 0 && i + 1 < arr.length) {
        increment(arr, i + 1);
    }
}

public static boolean impossible(byte[] myBytes) throws UnsupportedEncodingException {
    if (myBytes.length == 0) {
        return false;
    }
    String string = new String(myBytes, "UTF-8");
    return string.length() == 0;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T15:44:50.430

UTF-8 是一种可变长度编码方案，大多数“普通”字符都是单字节的。所以任何给定的非空字节 [] 总是会转换成一个字符串，我想。

如果你想玩它说，编写一个单元测试，它迭代每个可能的字节值，传入该值的单值数组，并断言该字符串是非空的。

# oracle - 重命名 Oracle 表或视图

> ID：835387
> 
> 赞同：63
> 
> 时间：2009-05-07T15:38:20.710
> 
> 标签：oracle, table-rename

在 Oracle 中重命名表或视图的语法是什么？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-05-07T15:39:29.350

```
ALTER TABLE mytable RENAME TO othertable 
```

在`Oracle 10g`还有：

```
RENAME mytable TO othertable 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-05-08T03:36:12.170

要重命名表，您可以使用：

```
RENAME mytable TO othertable; 
```

或者

```
ALTER TABLE mytable RENAME TO othertable; 
```

或者，如果由另一个架构拥有：

```
ALTER TABLE owner.mytable RENAME TO othertable; 
```

有趣的是，ALTER VIEW 不支持重命名视图。但是，您可以：

```
RENAME myview TO otherview; 
```

RENAME 命令适用于表、视图、序列和私有同义词，仅适用于您自己的模式。

如果视图不在您的模式中，您可以使用新名称重新编译视图，然后删除旧视图。

*（在 Oracle 10g 中测试）*

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-07T16:42:26.487

为了重命名不同模式中的表，请尝试：

```
ALTER TABLE owner.mytable RENAME TO othertable; 
```

重命名命令（如“ `rename mytable to othertable`”）仅支持重命名同一模式中的表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-12T13:23:36.723

可以用相同的方式[重命名索引](http://docs.oracle.com/cd/E11882_01/server.112/e26088/statements_1010.htm)：

```
alter index owner.index_name rename to new_name; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-08T14:21:37.313

过去 10g 当前答案不再适用于重命名视图。唯一仍然有效的方法是删除并重新创建视图。我能想到的最好的方法是：

> SELECT TEXT FROM ALL_VIEWS WHERE owner='some_schema' and VIEW_NAME='some_view';

在返回的 SQL 前面加上这个

> 创建或替换视图 some_schema.new_view_name 为 ...

放弃旧视图

> 删除视图 some_schema.some_view;

# javascript - 使用 Javascript 从 JSON 中获取数据

> ID：835391
> 
> 赞同：1
> 
> 时间：2009-05-07T15:39:02.550
> 
> 标签：javascript, jquery, json

好的，所以我有一个如下所示的 json 输出：

```
{"Result" : [
              {
                "Id" : "5214",
                "ParentReasonId" : "0",
                "Description" : "Billing & Payment",
                "SysName" : "Billing & Payment",
                "SysCategory" : "Billing & Payment",
                "ClientId" : "924",
                "DispositionCount" : "6",
                "IsActive" : true,
                "ChildReasonCount" : "8",
                "Attributes" : [],
                "SortOrder" : "0",
                "CreatedBy" : null
              }
            ]
 } 
```

我想从中提取 id 和 description 的数据。

```
 jQuery("#chained_child").cascade("#chained", {
    ajax: { url: 'Customhandler.ashx?List=MyList' },
        template: commonTemplate,
        match: commonMatch
    });

function commonTemplate(item) {
    return "<option Value='" + item.Result.Id + "'>" 
           + item.Result.Description + "</option>";
}; 
```

但是对于我的生活，我无法让它返回我正在寻找的价值。我知道这很无聊，但我正在碰壁。任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T15:49:16.863

如果您检查 JSON 字符串，您的`Result`对象实际上是一个大小为 1 的数组，其中包含一个对象，而不仅仅是一个对象。您应该删除额外的括号或使用以下方法引用您的变量：

```
item.Result[0].Id 
```

为了使用您的变量来引用您的变量，`item.Result.Id`您需要以下 JSON 字符串：

```
{
    "Result" :
    {
        "Id" : "5214",
        "ParentReasonId" : "0",
        "Description" : "Billing & Payment",
        "SysName" : "Billing & Payment",
        "SysCategory" : "Billing & Payment",
        "ClientId" : "924",
        "DispositionCount" : "6",
        "IsActive" : true,
        "ChildReasonCount" : "8",
        "Attributes" : [],
        "SortOrder" : "0",
        "CreatedBy" : null
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T16:09:10.060

item.Result[0].Id 像 Sebastian 提到的那样工作 - 但是它只有在“item”被实际分配了一个值时才有效。我的猜测是不是。

在您的 commonTemplate 函数中尝试执行 console.log(item) 并查看结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T16:12:10.070

据我在[插件页面](http://dev.chayachronicles.com/jquery/cascade/index.html)上看到的，发送到模板回调的参数是 JSON 响应中的一个 **项目**，它是一个数组。您的 JSON 响应是一个对象。我猜你没有发送正确的 JSON 响应。但是请谨慎对待，因为我从未使用过此插件。

无论如何，如果我是对的，你的反应应该是：

```
[
    {
        "Result" :
        {
            "Id" : "5214",
            "ParentReasonId" : "0",
            "Description" : "Billing & Payment",
            "SysName" : "Billing & Payment",
            "SysCategory" : "Billing & Payment",
            "ClientId" : "924",
            "DispositionCount" : "6",
            "IsActive" : true,
            "ChildReasonCount" : "8",
            "Attributes" : [],
            "SortOrder" : "0",
            "CreatedBy" : null
        }
    }
] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T15:56:22.993

对 JSON funkyness 有极大帮助的一件事是在[Firebug](http://getfirebug.com/)中设置断点，让您逐步浏览生成的对象，并查看其结构。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T19:19:24.610

Ionut G. Stan 的回答是正确的。您的 json 输出不是级联插件的正确格式。

如果您不想更改 json，可以使用设置`dataFilter`中的选项`ajax`来扩充数据。

我在这里设置了一个工作演示：http: [//jsbin.com/ebohe](http://jsbin.com/ebohe)（可通过[http://jsbin.com/ebohe/edit](http://jsbin.com/ebohe/edit)编辑）

这是相关的javascript：

```
$(function(){
  $('#chained_child').cascade(
    '#chained',
    {
      ajax: {
        url: 'Customhandler.ashx?List=MyList',
        dataFilter: extractResult
      },
      template: customTemplate,
      match: customMatch
    }
  );

  function extractResult(data) {
    return eval('(' + data + ')').Result;
  }

  function customTemplate(item) {
    return $('<option />')
      .val(item.Id)
      .text(item.Description);
  }

  function customMatch(selectedValue) {
    return this.ParentReasonId == selectedValue;
  }
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T16:00:18.553

您可能想看看 IBM 的这个 JSON 教程：

[精通 Ajax，第 10 部分：使用 JSON 进行数据传输](http://www.ibm.com/developerworks/web/library/wa-ajaxintro10/index.html?S_TACT=105AGX08&S_CMP=EDU)

# regex - 如何从 Perl 字符串中提取不同数量的数字组？

> ID：835398
> 
> 赞同：2
> 
> 时间：2009-05-07T15:39:53.797
> 
> 标签：regex, perl, multiple-matches

我正在尝试使用以下格式解析 Perl 中的字符串：

`Messages pushed to the Order Book queues 123691 121574 146343 103046 161253`

我想访问字符串末尾的数字，所以打算做一个匹配

`/(\d+)/s`

我的问题是最后的值的数量包含可变数量的字符串。

格式化正则表达式以便能够单独访问每个数字的最佳方法是什么？我是一名 C++ 开发人员，并且正在学习 Perl，因此我正在尝试找到最简洁的 Perl 方法来完成此任务。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T15:53:57.540

只需使用 /g 标志使匹配运算符执行全局匹配。在列表上下文中，匹配运算符将所有结果作为列表返回：

```
@result = $string =~ /(\d+)/g; 
```

如果没有其他数字而不是尾随数字，则此方法有效。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T16:28:40.373

您可以在带有全局标志的列表上下文中使用匹配运算符来获取所有括号捕获的列表。例子：

```
@list = ($string =~ /(\d+)/g); 
```

您的列表现在应该包含字符串中的所有数字组。有关更多信息，请参阅[匹配运算符](http://www.perl.com/doc/manual/html/pod/perlop.html#Regexp%5FQuote%5FLike%5FOperators)的文档。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:46:08.150

“在标量上下文中，每次执行 m//g 都会找到下一个匹配项，如果匹配则返回 true，如果没有进一步匹配则返回 false”--(From `perldoc perlop`)

因此，您应该能够创建一个全局正则表达式循环，如下所示：

```
while ($string =~ /(\d+)/g) {
    push @queuelist, $1;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T15:43:39.497

我会做这样的事情：

```
my @numbers;
if (m/Messages pushed to the Order Book queues ([\d\s]+)/) {
   @numbers = split(/\s+/, $1);
} 
```

无需将其塞入一个正则表达式中。

# java - 如何将属性从一个 Java bean 复制到另一个？

> ID：835416
> 
> 赞同：14
> 
> 时间：2009-05-07T15:43:47.203
> 
> 标签：java, javabeans

我有一个简单的 Java POJO，我会将属性复制到同一个 POJO 类的另一个实例。

我知道我可以用 BeanUtils.copyProperties() 做到这一点，但我想避免使用第三方库。

那么，如何简单、正确、安全地做到这一点呢？

顺便说一句，我使用的是 Java 6。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-07T15:48:30.343

我想如果您查看 BeanUtils 的源代码，它将向您展示如何在不实际使用 BeanUtils 的情况下执行此操作。

如果您只是想创建 POJO 的副本（与将属性从一个 POJO 复制到另一个不同），您可以更改源 bean 以实现 clone() 方法和 Cloneable 接口。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-10-21T06:41:32.140

在为 Google App Engine 开发应用程序时，我遇到了同样的问题，由于公共日志记录限制，我无法使用 BeanUtils。无论如何，我想出了这个解决方案并且对我来说工作得很好。

```
public static void copyProperties(Object fromObj, Object toObj) {
    Class<? extends Object> fromClass = fromObj.getClass();
    Class<? extends Object> toClass = toObj.getClass();

    try {
        BeanInfo fromBean = Introspector.getBeanInfo(fromClass);
        BeanInfo toBean = Introspector.getBeanInfo(toClass);

        PropertyDescriptor[] toPd = toBean.getPropertyDescriptors();
        List<PropertyDescriptor> fromPd = Arrays.asList(fromBean
                .getPropertyDescriptors());

        for (PropertyDescriptor propertyDescriptor : toPd) {
            propertyDescriptor.getDisplayName();
            PropertyDescriptor pd = fromPd.get(fromPd
                    .indexOf(propertyDescriptor));
            if (pd.getDisplayName().equals(
                    propertyDescriptor.getDisplayName())
                    && !pd.getDisplayName().equals("class")) {
                 if(propertyDescriptor.getWriteMethod() != null)                
                         propertyDescriptor.getWriteMethod().invoke(toObj, pd.getReadMethod().invoke(fromObj, null));
            }

        }
    } catch (IntrospectionException e) {
        e.printStackTrace();
    } catch (IllegalArgumentException e) {
        e.printStackTrace();
    } catch (IllegalAccessException e) {
        e.printStackTrace();
    } catch (InvocationTargetException e) {
        e.printStackTrace();
    }
} 
```

任何改进或建议都非常受欢迎。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-07-09T16:54:46.447

另一种选择是[MapStruct](http://mapstruct.org/)，它在构建时生成映射代码，从而产生在运行时不需要任何依赖项的类型安全映射（免责声明：我是 MapStruct 的作者）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-02-07T10:02:09.570

嘿，朋友们只需使用我创建的 ReflectionUtil 类将一个 bean 值复制到另一个类似的 bean。此类还将复制 Collections 对象。**[https://github.com/vijayshegokar/Java/blob/master/Utility/src/common/util/reflection/ReflectionUtil.java](https://github.com/vijayshegokar/Java/blob/master/JAVA-UTILS/src/common/util/reflection/v2_0/ReflectionUtil.java)**

**注意：**此 bean 必须具有与类型相似的变量名称，并且具有用于它们的 getter 和 setter。

现在添加了更多功能。您还可以将一个实体数据复制到其 bean。如果一个实体中有另一个实体，那么您可以将内部实体的运行时更改的映射选项传递给它的相关 bean。

例如。

```
ParentEntity parentEntityObject = getParentDataFromDB();
Map<Class<?>, Class<?>> map = new HashMap<Class<?>, Class<?>>();
map.put(InnerBean1.class, InnerEntity1.class);
map.put(InnerBean2.class, InnerEntity2.class);
ParentBean parent = ReflectionUtil.copy(ParentBean.class, parentEntityObject, map); 
```

当您的实体包含关系时，这种情况非常有用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-07T15:58:56.467

查看[JavaBeans API](http://java.sun.com/javase/6/docs/api/java/beans/package-summary.html)，尤其是[Introspector](http://java.sun.com/javase/6/docs/api/java/beans/Introspector.html)类。您可以使用 BeanInfo 元数据来[获取](http://java.sun.com/javase/6/docs/api/java/beans/PropertyDescriptor.html#getReadMethod())和[设置](http://java.sun.com/javase/6/docs/api/java/beans/PropertyDescriptor.html#getWriteMethod())属性。如果您还没有阅读[JavaBeans 规范](http://java.sun.com/javase/technologies/desktop/javabeans/docs/spec.html)，最好阅读一下。熟悉[反射 API](http://java.sun.com/javase/6/docs/api/java/lang/reflect/package-frame.html)也很有帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-07T16:31:50.677

没有简单*的*方法可以做到这一点。Introspector 和 Java bean 库是一体的 - BeanUtils 是一个简单的包装器，并且运行良好。没有库只是为了没有库一般来说是个坏主意——这是有原因的，从一开始就是公共的——Java应该存在的公共功能，但没有。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-05T13:50:53.120

我遇到了一些`Introspector.getBeanInfo`没有返回所有属性的问题，所以我最终实现了字段副本而不是属性副本。

```
public static <T> void copyFields(T target, T source) throws Exception{
    Class<?> clazz = source.getClass();

    for (Field field : clazz.getFields()) {
        Object value = field.get(source);
        field.set(target, value);
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-07-10T14:02:50.837

**您可以使用Java Reflection API**来实现它。

```
public static <T> void copy(T target, T source) throws Exception {
    Class<?> clazz = source.getClass();

    for (Field field : clazz.getDeclaredFields()) {
        if (Modifier.isPrivate(field.getModifiers()))
            field.setAccessible(true);
        Object value = field.get(source);
        field.set(target, value);
    }
} 
```

# c - 从具有可变长度记录的二进制文件中读取

> ID：835417
> 
> 赞同：2
> 
> 时间：2009-05-07T15:43:50.573
> 
> 标签：c, file-io, binary

我有一个可变长度记录的二进制文件，看起来像这样：

```
12  economic10
13  science5
14  music1 
15  physics9
16  chemistry9
17  history2 
18  anatomy7 
19  physiology7
20  literature3
21  fiction3
16  chemistry7
14  music10 
20  literature1 
```

课程名称是文件中唯一的可变长度记录，第一个数字是课程代码，可以是 1 到 9999 之间的数字，第二个数字是部门，可以是 1 到 10 之间的数字。正如您在文件中看到的那样，课程名称和部门编号之间没有空格。

问题是如何从二进制文件中读取？文件中没有字段告诉我课程名称字符串的大小。我可以很好地读取第一个 int（课程 ID），但我怎么知道课程名称的大小是多少课程？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T17:34:37.670

`fscanf()`与格式字符串一起使用`"%u %[a-z]%u"`。

这是一个完整的示例程序：

```
#include <stdio.h>

#define NAME_MAX 64

int main(int argc, char ** argv)
{
    FILE * file = fopen("foo.txt", "rb");
    unsigned int course, department;
    char name[NAME_MAX];

    while(fscanf(file, "%u %[a-z]%u", &course, name, &department) != EOF)
    {
        // do stuff with records
        printf("%u-%u %s\n", department, course, name);
    }

    fclose(file);

    return 0;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T15:51:37.450

要读取可变长度记录，您应该使用某种约定。例如，表示记录结束的特殊字符。在每条记录中，您可以使用另一个特殊字符来指示字段结束。

```
DO_READ    read from file
           is END_OF_RECORD char present?
           yes: GOTO DO_PROCESS
           no : GOTO DO_READ

DO_PROCESS read into buffer
           is END_OF_FILE mark present?
           yes: GOTO DOSOMETHINGWITHIT
           no:  GOTO DO_PROCESS 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:52:19.633

您首先需要知道文件是如何写出的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T17:07:03.680

正如其他人所说，这看起来很像文本，因此文本解析方法可能是正确的方法。由于这是家庭作业，因此我不会为您编写代码，但这是我将采取的一般方法：

*   使用 fscanf，读取课程代码，以及包含名称和部门代码的组合字符串。
*   从组合字符串的末尾开始，向后走，直到找到第一个非数字。这是课程名称的结尾。
*   从课程名称末尾开始读取整数（即，我们发现向后扫描的最后一个数字）。
*   将字符串中该整数部分的第一个字符替换为 NUL ('\0') - 这会在课程名称之后立即终止组合字符串。所以我们在组合字符串中剩下的就是课程名称，并且我们在整数变量中有课程代码和部门代码。
*   重复下一行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T15:52:51.410

如果课程代码和课程名称（包括部门代码）之间存在一一对应关系，您可以从其代码中推断出课程名称的大小，并在代码或配置文件中的某处预定义表格。

如果不是，我看到的主要问题是区分`music1`和`music10`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T17:38:34.650

假设没有回车并且每个字符串都以空字符结尾。我编写了一个小程序来创建一个二进制文件，然后将其读回，产生类似的输出。

```
 // binaryFile.cpp
#include "stdafx.h"
#include <stdio.h>
#include <string.h>

#define BUFSIZE 64
int _tmain(int argc, _TCHAR* argv[])
{
  FILE *f;
  char  buf[BUFSIZE+1];

  // create dummy bin file
  f = fopen("temp.bin","wb");
  if (f)
  { // not writing all the data, just a few examples
   sprintf(buf,"%04d%s\00",12,"economic10"); fwrite(buf,sizeof(char),strlen(buf)+1,f);
   sprintf(buf,"%04d%s\00",13,"science5"); fwrite(buf,sizeof(char),strlen(buf)+1,f);
   sprintf(buf,"%04d%s\00",14,"music1"); fwrite(buf,sizeof(char),strlen(buf)+1,f);
   sprintf(buf,"%04d%s\00",15,"physics9"); fwrite(buf,sizeof(char),strlen(buf)+1,f);
   fclose(f);
  }
  // read dummy bin file
  f = fopen("temp.bin","rb");
  if (f)
  {
   int classID;
   char str[64];
   char *pData
   long offset = 0;
   do
   {
    fseek(f,offset,SEEK_SET);
    pData = fgets(buf,BUFSIZE,f);
    if (pData)
    {  sscanf(buf,"%04d%s",&classID,&str);
       printf("%d\t%s\r\n",classID,str);
       offset +=strlen(pData)+1;    // record + 1 null character
     }
    } while(pData);
    fclose(f);
   }
   getchar();
   return 0;
} 

```

# c++ - MFC CDialog::Create 失败

> ID：835419
> 
> 赞同：1
> 
> 时间：2009-05-07T15:44:12.960
> 
> 标签：c++, mfc, cdialog

我在创建基于 CDialog 的窗口时遇到了一些代码问题。该代码上周运行良好。我所做的唯一更改是将 C++ 双端队列替换为哈希数组。我已经注释掉了调用 Create 方法的代码行，以允许我跳过加载窗口。现在代码不再创建窗口了。

Create 函数返回 false，GetLastError 函数返回 0。我没有在窗口内使用任何自定义控件 - 只是一个复选框和一个列表控件。据我所知（此时我无法连接调试器） OnCreate 和 OnInitDialog 函数根本没有被调用。

我粘贴了下面的代码，用于测试 Create 函数的返回和 GetLastError

```
BOOL result = ORDER_HANDLER_GUI.Create(OrderHandlerGUI::IDD, AfxGetMainWnd());
int error = ::GetLastError();

if(result)
    AfxMessageBox("Created GUI");
else
{
    CString msg;
    msg.Format("%d", error);
    AfxMessageBox("Could not create GUI");
    AfxMessageBox(msg);
} 
```

更新：我终于设法让调试器附加（这是一个加载在第三方应用程序中的插件，由于某种原因不喜欢调试器）。单步执行代码后，似乎 AfxGetMainWnd() 返回 NULL。我现在正在对此进行更多测试。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T20:59:57.100

问题似乎与对 CDynLinkLibrary() 的调用有关。

应编写加载我的插件的软件的公司的要求，我对此进行了评论。重新添加这一行会导致一些值仍然为空，但现在可以正确创建窗口。

我将对此进行一些研究，如果我发现任何东西，我会更新。如果有人比我更了解这一点（不难），请随时发表评论。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T16:51:25.340

该对话框是否使用任何可能导致问题的控件？例如 Richedit？

# c# - 这 hWnd 是我的孩子吗？

> ID：835420
> 
> 赞同：1
> 
> 时间：2009-05-07T15:44:14.643
> 
> 标签：c#, .net, winforms, hwnd

如何判断 hWnd 是否属于我的子控件之一？

我想做类似的事情：

```
if(this.Controls.Find(hWnd) != null) return false; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T15:58:18.900

为此有一个 Win32 函数：[IsChild](http://pinvoke.net/default.aspx/user32/IsChild.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T15:53:32.063

听起来像是一个使用递归的好机会。将此函数添加到您的父类：

```
 private bool IsChild(System.Windows.Forms.Control control, System.IntPtr hWnd)
  {
     if(control.Handle == hWnd)
        return(true);

     foreach (System.Windows.Forms.Control child in control.Controls)
     {
        if (IsChild(child, hWnd))
           return (true);
     }
     return (false);
  } 
```

然后，您可以使用此函数在此父类中搜索具有指定 hWnd 的任何子控件：

```
this.IsChild(this, hWnd); 
```

# c# - 如何在安装时（或在编译时轻松）配置 Windows 服务的名称？

> ID：835422
> 
> 赞同：22
> 
> 时间：2009-05-07T15:44:23.707
> 
> 标签：c#, .net, windows-services, windows-installer

我在 C# 中创建了一个 Windows 服务，将其安装在服务器上并且运行良好。

现在我想再次安装相同的服务，但从不同的工作目录运行，具有不同的配置文件等。因此，我希望同时运行同一服务的*两个（或更多）实例。*最初，这是不可能的，因为安装程序会抱怨已经安装了具有给定名称的服务。

我可以通过更改代码、将`ServiceBase.ServiceName`属性设置为新值、然后重新编译并再次运行 InstallUtil.exe 来克服这个问题。但是，如果我可以在安装时设置服务名称，我会更喜欢，即理想情况下我会做类似的事情

> InstallUtil.exe /i /servicename="MyService 实例 2" MyService.exe

如果这无法实现（我非常怀疑），我希望能够在构建服务时注入服务名称。我认为可能可以使用某种构建事件，使用聪明的 msbuild 或 nant 技巧或类似的东西，但我不知道。

任何建议将不胜感激。

感谢您的时间。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-07T20:04:50.617

我尝试使用访问配置

```
ConfigurationManager.OpenExeConfiguration(string exePath) 
```

在安装程序中，但无法使其正常工作。

相反，我决定`System.Environment.GetCommandLineArgs()`像这样在安装程序中使用：

```
string[] commandlineArgs = Environment.GetCommandLineArgs();

string servicename;
string servicedisplayname;
ParseServiceNameSwitches(
    commandlineArgs, 
    out servicename, 
    out servicedisplayname);

serviceInstaller.ServiceName = servicename;
serviceInstaller.DisplayName = servicedisplayname; 
```

现在我可以使用安装我的服务

> InstallUtil.exe /i InstallableService.dll /servicename="myserviceinstance_2" /servicedisplayname="我的服务实例 2"

[我在这里](http://www.runeibsen.dk/?p=153)写了一个更详细的解释。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T15:51:23.503

您不能将其作为命令行参数传递，因为 InstallUtil 没有为此提供正确的挂钩。

但是，您可以让服务安装程序从配置文件中读取 ServiceName。如果您[查看典型 ServiceInstaller 的一些代码](http://www.codeproject.com/Articles/14353/Creating-a-Basic-Windows-Service-in-C)，您会发现这只是在运行时设置适当的 DisplayName 和 ServiceName 属性的问题。这些可以很容易地从配置文件中读取，而不是硬编码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-08-15T14:57:10.113

而不是使用`Environment.GetCommandLineArgs();`该类`Installer`有一个调用的属性`Context`，您可以从该属性访问传递给 InstallUtil 的命令行参数，该参数以`StringDictionary`.

# sql-server - MS Access Partition 函数的 SQL 等效项

> ID：835431
> 
> 赞同：0
> 
> 时间：2009-05-07T15:45:51.240
> 
> 标签：sql-server, ms-access

我在 MS Access 2003 中为 Report 使用了 Partition 函数。我需要与 MS SQL 等效的这个函数。

这是关于分区功能的链接[http://office.microsoft.com/en-us/access/HA012288921033.aspx](http://office.microsoft.com/en-us/access/HA012288921033.aspx)（需要注册）

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T16:00:51.330

我能看到的最接近的是[NTILE](http://msdn.microsoft.com/en-us/library/ms175126.aspx)函数，虽然没有更多关于如何使用它的上下文，但我无法提供任何代码示例。

# .net - 修改 Combobox 的 MouseWheel 行为

> ID：835436
> 
> 赞同：0
> 
> 时间：2009-05-07T15:46:10.193
> 
> 标签：.net, winforms, mousewheel

我有一个包含 TextBoxes 和 ComboBoxes 的 UserControl，并且此 UserControl 包含在 AutoScroll 设置为 True 的面板中。

当文本框具有焦点并且我使用鼠标滚轮滚动时，面板会滚动，当组合框具有焦点并且我使用鼠标滚轮滚动时，组合框中的选定项目会更改。

我确定这是预期的行为，但我想更改它，以便所有鼠标滚轮事件滚动面板。

为此，我在 ComboBox 子类的 WndProc 方法中处理 WM_MOUSEWHEEL 消息，如下所示：

```
Protected Overrides Sub WndProc(ByRef m As System.Windows.Forms.Message)
    Const WM_MOUSEWHEEL As Integer = &H20A
    Select Case m.Msg
        Case WM_MOUSEWHEEL
            ' Send the message to the parent
            GetType(Control).InvokeMember("WmMouseWheel", Reflection.BindingFlags.InvokeMethod Or Reflection.BindingFlags.Instance Or Reflection.BindingFlags.NonPublic, Nothing, Parent, New Object() {m})
            Return
    End Select
    MyBase.WndProc(m)
End Sub 
```

有没有办法做到这一点，而无需通过反射调用控件上的私有方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:54:24.603

您可以使用 Win32`SendMessage`函数将您的消息内容转发`m`到`Parent.Handle`.

# network-programming - 游戏网络物理碰撞

> ID：835443
> 
> 赞同：50
> 
> 时间：2009-05-07T15:47:07.087
> 
> 标签：network-programming, physics

如何在网络游戏的典型客户端/服务器设置中模拟两个客户端控制的车辆（明智地）碰撞？我确实阅读[了这篇关于如何进行分布式网络物理的杰出博客文章](https://web.archive.org/web/20181107181430/https://gafferongames.com/post/networked_physics_2004/)（没有传统的客户端预测），但这个问题专门关于如何处理拥有对象的冲突。

### 例子

假设客户端 A 比服务器提前 20 毫秒，客户端 B 比服务器提前 300 毫秒（计算延迟和最大抖动）。这意味着当两辆车发生碰撞时，两个客户端都会将另一辆车视为落后 320 毫秒 - 与另一辆车的速度方向相反。在瑞典高速公路上正面交锋意味着相差 16 米/17.5 码！

### 什么不能尝试

几乎不可能推断位置，因为我也有非常复杂的车辆，到处都是关节和车身，它们又具有线性和角位置、速度和加速度，更不用说来自用户输入的状态了。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-07T19:10:00.813

I don't know of a perfect solution, and I have a feeling that one does not exist. Even if you could accurately predict the future position of the vehicle, you would be unable to predict the way the user will operate the controls. So the problem comes down to minimizing the negative effects of client/server lag. With that in mind, I would approach this from the position of the [principle of least astonishment](http://en.wikipedia.org/wiki/Principle_of_least_astonishment) (paraphrased from Wikipedia):

> In user interface design, the principle of least astonishment (or surprise) states that, when two elements of an interface conflict, or are ambiguous, the behaviour should be that which will least surprise the human user at the time the conflict arises.

In your example, each user sees two vehicles. Their own, and that of another player. The user expects their own vehicle to behave exactly the way they control it, so we are unable to play with that aspect of the simulation. However, the user can not know exactly how the other user is controlling *their* vehicle, and I would use this ambiguity to hide the lag from the user.

Here is the basic idea:

1.  The server has to make the decision about an impending collision. The collision detection algorithm doesn't have to be 100% perfect, it just has to be close enough to avoid obvious inconsistencies.
2.  Once the server has determined that two vehicles will collide, it sends each of the two users a message indicating that a collision is imminent.
3.  On client A, the position of vehicle B is adjusted (realistically) to guarantee that the collision occurs.
4.  On client B, the position of vehicle A is adjusted (realistically) to guarantee that the collision occurs.
5.  During the aftermath of the collision, the position of each vehicle can be adjusted, as necessary, so that the end result is in keeping with the rest of the game. This part is exactly what MedicineMan proposed in [his answer](https://stackoverflow.com/questions/835443/game-network-physics-collision/835747#835747).

In this way, each user is still in complete control of their own vehicle. When the collision occurs, it will not be unexpected. Each user will see the other vehicle move towards them, and they will still have the feeling of a real-time simulation. The nice thing is that this method reacts well in low-lag conditions. If both clients have low-latency connections to the server, the amount of adjustment will be small. The end result will, of course, get worse as the lag increases, but that is unavoidable. If someone is playing a fast-paced action game over a connection with several seconds worth of lag, they simply aren't going to get the full exeperience.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T16:35:30.917

也许你能做的最好的事情不是实时显示实际的碰撞，而是给人一种事情正在实时发生的错觉。

由于客户端落后于服务器（滞后），并且服务器需要显示碰撞的结果，也许你可以做的，客户端，显示一个闪光或爆炸或其他一些图形来分散用户的注意力并购买足够的东西服务器端计算碰撞结果的时间。当您完成预测后，将其发送回客户端进行演示。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T17:26:55.257

很抱歉回答“不要尝试什么”，但我从未听说过不涉及预测客户端结果的解决方案。考虑一个简化的例子：

客户 A 静止不动，看着客户 B 的车辆接近悬崖。客户 B 的车辆能够立即将速度降低到 0，并且在越过悬崖之前的最后一刻这样做。

If Client A is attempting to show Client B's state in real time, Client A has no choice but to predict that Client B fell off the cliff. You see this a lot in MMORPGs designed such that a player's character is capable of stopping immediately when running full-speed. Otherwise, Client A could just show Client B's state as the state updates come in, but this isn't viable, as Client A needs to be able to interact with Client B in real time in your scenario (I assume).

Could you try simplifying the collision models so that extrapolation is possible for real time prediction? Maybe make your "joints and bodies all over" have processor-less-intensive physical models, like a few cubes or spheres. I'm not too familiar with how to improve the efficiency of collision detection, but I assume it's done by detecting collisions of models that are less complex than the visual models.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-14T05:08:27.127

Regarding "What not to try". You are assuming that you need to predict perfectly, but you are never going to find a perfect solution in a game with complex physics. An approximation is probably the best you can do (for example, most commercial physics engines can cast a shape into the physics scene and return the first point of collision).

For example, I implemented some critical parts of the network physics for Mercenaries 2 under the guidance of Glenn (the blog poster you mentioned). It was impossible to push all of the necessary physics state across the wire for even a single rigid body. Havok physics gradually generates contact points each frame, so the current "contact manifold" is a necessary part of the physics state to keep the simulation deterministic. It's also way too much data. Instead, we sent over the desired transform and velocities and used forces and torques to gently push bodies into place. Errors are inevitable, so you need a good error correction scheme.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-21T07:43:14.570

What I eventually ended up doing was simply skipping prediction alltogether and simply doing this:

1.  Client has very much say about its own position,
2.  Server (almost) only says anything about the owning client's position when a "high energy" collision has happened with another dynamic object (i.e. not static environment).
3.  Client takes `meshoffset=meshpos-physpos` when receiving a positional update from the server and then sets `meshpos=physpos+meshoffset` each frame and gradually decreases `meshoffset`.

It looks quite good most of the time (in low latency situation), I don't even have to slerp my quaternions to get smooth transitions.

Skipping prediction probably gives high-latency clients an awful experiance, but I don't have time to dwell on this if I'm ever going to ship this indie game. Once in a while it's nice to create a half-ass solution that works good enough but best. ;)

**Edit:** I eventually ended up adding the "ownership" feature that Glen Fiedler (the blogger mentioned in the question) implemented for Mercenaries 2: each client gets ownership of (dynamic) objects that they collide with for a while. This was necessary since the penetration otherwise becomes deep in high latency and high speed situations. That soluation works just as great as you'd think when you see the GDC video presentation, can definitely recommend it!

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-07-19T21:14:19.740

Few thoughts.

1.  Peer to peer is better at dealing with latency & high speeds.

So if this is your own engine then switch to peer to peer. You then extrapolate the other peer's vehicle based on their button input to move forward to where it is now. You the set collision such that you collide against the other vehicle as if it's world. I.e. you take the hit.

This means as you collide against the other, you bounce off, on the peer's network they bounce off you, so it looks roughly correct. The lower the latency the better it works.

2.  If you want to go client / server then this will be inferior to p2p

Things to attempt o) Extrapolate clients forward as in p2p to perform collision detection. o) Send collision results back to clients and extrapolate forward

Note, this is NEVER going to be as good as p2p. Fundamentally high speed & latency = error so removing latency is the best strategy. P2P does that.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-09T10:18:32.937

In addition to predicting on the client side where the other user might be and sending the collision information and how you handled it to the server, what most mmo's do to deal with lag is they have the server run "in the past" as it were. Basically they buffer the recent inputs but only react to what happened .1sec in the past. This lets you "peek into the future" when you need to (ie when a collision is about to happen in your time frame, you can look at the buffered input to see what will happen and decide if the collision is real).

Of course, this adds an extra layer of complexity to your program as you have to consider what data to send to your clients and how they should react to it. For example you could send the entire "future" buffer to the clients and let them see which possible collisions will actually happen and which won't.

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-05-07T21:25:09.147

Ross has a good point. You could simplify the model you use to detect collisions by abstracting it to some simpler volume (i.e. the rough boxy outline of the vehicle). Then you can do the predictions based on the simple volume and the detailed calculations on the exact volumes while you have the user distracted by the "explosion". It may not be perfect but would allow you to speed up your collision detection.

# xsd - XSD 抱怨“模型组中出现多个名称为 'B'、类型不同的元素。”

> ID：835445
> 
> 赞同：1
> 
> 时间：2009-05-07T15:47:34.200
> 
> 标签：xsd

我有以下 XSD：

```
<xs:complexType name="typeBroken">
  <xs:choice>
    <xs:element name="B">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <xs:pattern value="FOO|BAR" />
        </xs:restriction>
      </xs:simpleType>
    </xs:element>
    <xs:sequence>
      <xs:element name="A">
        <xs:simpleType>
          <xs:restriction base="xs:string">
            <xs:maxLength value="5" />
          </xs:restriction>
        </xs:simpleType>
      </xs:element>
      <xs:element name="B">
        <xs:simpleType>
          <xs:restriction base="xs:string">
            <xs:maxLength value="3" />
          </xs:restriction>
        </xs:simpleType>
      </xs:element>
    </xs:sequence>
  </xs:choice>
</xs:complexType> 
```

因此，我希望“A”的存在使“B”具有不同的验证。这可能吗？例如：

```
<test><B>FOO</B></test>
<test><A>HELLO</A><B>BAZ</B><test> 
```

两者都应该验证。尽管：

```
<test><B>BAZ</B></test> 
```

不应该验证。但是，我从 xsd 得到：

```
cos-element-consistent: Error for type 'typeBroken'. Multiple elements with name 'B', with different types, appear in the model group. 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T17:27:40.713

我是否正确理解您的要求？您想在此之前有一个`<B>...</B>`和可选的一个`<A>....</A>`（但不是必需的）？

那么这个模式呢？

```
<xs:complexType name="typeBroken">
  <xs:sequence>
    <xs:element name="A" minOccurs="0">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <xs:maxLength value="5" />
        </xs:restriction>
      </xs:simpleType>
    </xs:element>
    <xs:element name="B">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <xs:pattern value="FOO|BAR" />
        </xs:restriction>
      </xs:simpleType>
    </xs:element>
    </xs:sequence>
  </xs:choice>
</xs:complexType> 
```

定义一个序列，其中第一个元素`<A>`是可选的 ( `minOccurs="0"`)，而第二个元素不是可选的。

这能解决你的要求吗？

马克

# tsql - T-SQL 中的 CREATE TABLE 语句问题

> ID：835448
> 
> 赞同：11
> 
> 时间：2009-05-07T15:47:51.843
> 
> 标签：tsql

我正在研究一个 pomotion 数据库，下面是我的 CREATE TABLE 语句的样子：

```
CREATE TABLE [dbo].[sponsors]
(
    [InstId] [bigint] NOT NULL,
    [EncryptedData] [varbinary](44) NOT NULL,
    [HashedData] [varbinary](22) NOT NULL,
    [JobId] [bigint] NOT NULL,
    CONSTRAINT [PK_sponsors] PRIMARY KEY CLUSTERED 
    (
        [InstId] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [dbo].[sponsors]  WITH CHECK ADD  CONSTRAINT [FK_sponsors_jobs] FOREIGN KEY([JobId])
REFERENCES [dbo].[jobs] ([Id])
GO

ALTER TABLE [dbo].[sponsors] CHECK CONSTRAINT [FK_sponsors_jobs]
GO

ALTER TABLE [dbo].[sponsors]  WITH CHECK ADD  CONSTRAINT [FK_sponsors_titles] FOREIGN KEY([TId])
REFERENCES [dbo].[titles] ([TId])
GO

ALTER TABLE [dbo].[sponsors] CHECK CONSTRAINT [FK_sponsors_titles]
GO 
```

而且我想摆脱 ALTER TABLE 语句并使它们成为 CREATE TABLE 语句的一部分，我知道如何做最多但不知道如何在创建表期间获得 CHECK CONSTRAINT，有人有这方面的经验吗？或者知道怎么做？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-07T15:54:31.640

您可以在 CREATE TABLE 声明中添加每个外键约束：

```
CREATE TABLE [dbo].[sponsors]
(
    [InstId] [bigint] NOT NULL,
    [EncryptedData] [varbinary](44) NOT NULL,
    [HashedData] [varbinary](22) NOT NULL,
    [JobId] [bigint] NOT NULL,
    [TId] [int] NOT NULL,
    CONSTRAINT [PK_sponsors] PRIMARY KEY CLUSTERED 
    (
        [InstId] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, 
           IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, 
           ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],

    CONSTRAINT [FK_sponsors_jobs] FOREIGN KEY([JobId]) 
                                   REFERENCES [dbo].[jobs] ([Id]),

    CONSTRAINT [FK_sponsors_titles] FOREIGN KEY([TId]) 
                                  REFERENCES [dbo].[titles] ([TId])
) ON [PRIMARY] 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-07T15:56:16.427

您似乎错过了一个列 (TId)

```
CREATE TABLE [dbo].[sponsors] 
( 
    [InstId] [bigint] NOT NULL
        CONSTRAINT [PK_sponsors] PRIMARY KEY CLUSTERED, 
    [EncryptedData] varbinary NOT NULL, 
    [HashedData] varbinary NOT NULL, 
    [JobId] [bigint] NOT NULL
        CONSTRAINT [FK_sponsors_jobs] FOREIGN KEY REFERENCES [dbo].[jobs] ([Id]), 
    [TId] int NOT NULL
        CONSTRAINT [FK_sponsors_titles] FOREIGN KEY REFERENCES [dbo].[titles] ([TId])
) ON [PRIMARY] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T16:00:17.133

ALTER TABLE ... CHECK CONSTRAINT 命令只是启用（或使用 NOCHECK 禁用）约束。添加约束时默认启用约束，因此如果您在 CREATE 语句中添加约束，则此额外语句是多余的并且不需要。

[http://msdn.microsoft.com/en-us/library/ms190273(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms190273(SQL.90).aspx)

# google-app-engine - 获取 Google App Engine 发布版本的来源

> ID：835451
> 
> 赞同：3
> 
> 时间：2009-05-07T15:48:10.267
> 
> 标签：google-app-engine

我可以从 Google 下载我的 App Engine 源代码吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-12-06T15:16:13.250

**更新：** Google appengine 现在允许您下载代码

[文档在这里](http://code.google.com/appengine/docs/python/tools/uploadinganapp.html#Downloading_Source_Code)。

[（从重复线程](https://stackoverflow.com/questions/2479087/can-i-restore-my-source-code-that-has-been-uploaded-into-google-appengine/4367821#4367821)复制答案）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-31T15:25:08.147

您不能 - App Engine 不是源代码控制系统。如果您在上传应用程序时在 app.yaml 中设置了这些处理程序，则可以使用这些处理程序直接下载您的源代码。但是，它们不能包含标记为静态的文件，因为它们被上传到单独的位置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-09T22:40:04.447

可能不是。但是，您可以创建一个包装脚本，围绕`appcfg.py`该脚本将源代码存档并将其与其他所有内容一起上传，然后将该存档在站点的受保护部分上可用。

一个例子是[here](http://www.cneophytou.com/2008/04/17/downloading-your-code-from-google-app-engine/)。

# c++ - C++ unicode 问题

> ID：835453
> 
> 赞同：6
> 
> 时间：2009-05-07T15:48:21.607
> 
> 标签：c++, unicode, wofstream

我知道 ICU 和代码项目中的 utf8 之类的小型库（忘记确切名称），但是这些都不是我想要的。

我真正想要的是像重症监护室这样的东西，但以更友好的方式包裹起来。

具体来说：

*   完全面向对象
*   c++ 标准流的实现，或者至少执行相同角色的东西。
*   可以以与地区相关的方式格式化时间、日期等（例如，英国的 dd/mm/yy 和美国的 mm/dd/yy）。
*   让我选择字符串的“内部”编码，例如，我可以让它在 windows 上使用 UTF-16，以避免在 windows API 和 DirectX 之间传递字符串时进行大量转换
*   在编码之间轻松转换字符串

如果不存在这样的库，是否可以使用标准 c++ 类来包装 ICU，因此我可以创建一个与 std::string 和 std::wstring 具有相同用法的 ustring，并且还可以实现流的版本（最好让它们与现有的完全兼容，即我可以将它传递给一个期望 std::ostream 的函数，它会在其内部格式和 ascii（或 utf-8）之间进行转换）？假设有可能做多少工作？

编辑：还查看了 c++0x 标准并注意到 utf8、utf16 和 utf32 的文字，这是否意味着标准库（例如字符串、流等）将完全支持这些编码以及它们之间的转换？如果是这样，有人知道 Visual Studio 支持这些功能需要多长时间？

EDIT2：至于使用现有的 c++ 支持，我将查找语言环境和方面的内容。

我遇到的一个问题是，当使用围绕 wchar_t 定义的流时，它在 windows 下是 2 个字节用于文件 i/o，但是它似乎仍然对它们自己的文件使用 ascii。

```
std::wofstream file(L"myfile.txt", std::ios::out);
file << L"Hello World!" << std::endl; 
```

在文件48 65 6C 6C 6F 20 57 6F 72 6C 64 0D 0A中产生以下十六进制，
这显然是 ascii 而不是预期的 utf-16 输出：
FF FE 48 00 65 00 6C 00 6C 00 6F 00 20 00 57 00 6F 00 72 00 6C 00 64 00 0D 00 0A 00

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T16:12:45.560

> 我真正想要的是像ICU这样的东西，但以更友好的方式包裹起来

不幸的是，没有这样的事情。他们的 API 并没有那么糟糕，所以你可以通过一些努力来适应它。

> 可以以与地区相关的方式格式化时间、日期等（例如，英国的 dd/mm/yy 和美国的 mm/dd/yy）。

课堂上完全支持它`std::locale`，请阅读如何使用它。您还可以指定语言环境，`std::iostream`以便正确格式化数字、日期。

> 在编码之间轻松转换字符串

`std::locale`提供用于将 8 位本地编码转换为宽一并返回的方面。

> 所以我可以例如让它使用 UTF-16

ICU 内部使用 utf-16，win32`wchar_t`和 wstring 也使用 utf-16，在其他操作系统下，大多数实现将 wchar_t 指定为 utf-32，wstring 使用 utf-32。

**备注：**的支持`std::locale`并不完美，但它已经提供了许多对字符操作有用的工具。

见：[http ://www.cplusplus.com/reference/std/locale/](http://www.cplusplus.com/reference/std/locale/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T16:55:05.927

这就是我使用 ICU 在 std::string （在 UTF-8 中）和 std::wstring 之间转换的方式

```
/** Converts a std::wstring into a std::string with UTF-8 encoding.
 */
template < typename StringT >
StringT utf8 ( std::wstring const & rc_string );

/** Converts a std::String with UTF-8 encoding into a std::wstring.
 */
template < typename StringT >
StringT utf8 ( std::string const & rc_string );

/** Nop specialization for std::string.
 */
template < >
inline std::string utf8 ( std::string const & rc_string )
{
  return rc_string;
}

/** Nop specialization for std::wstring.
 */
template < >
inline std::wstring utf8 ( std::wstring const & rc_string )
{
  return rc_string;
}

template < >
std::string utf8 ( std::wstring const & rc_string )
{
  std::string result;
  if(rc_string.empty())
    return result;

  std::vector<UChar> buffer;

  result.resize(rc_string.size() * 3); // UTF-8 uses max 3 bytes per char
  buffer.resize(rc_string.size() * 2); // UTF-16 uses max 2 bytes per char

  UErrorCode status = U_ZERO_ERROR;
  int32_t len = 0;

  u_strFromWCS(
    &buffer[0],
    buffer.size(),
    &len,
    &rc_string[0],
    rc_string.size(),
    &status
  );
  if(!U_SUCCESS(status))
  {
    throw XXXException("utf8: u_strFromWCS failed");
  }
  buffer.resize(len);

  u_strToUTF8(
    &result[0],
    result.size(),
    &len,
    &buffer[0],
    buffer.size(),
    &status
  );
  if(!U_SUCCESS(status))
  {
    throw XXXException("utf8: u_strToUTF8 failed");
  }
  result.resize(len);

  return result;
}/* end of utf8 ( ) */

template < >
std::wstring utf8 ( std::string const & rc_string )
{
  std::wstring result;
  if(rc_string.empty())
    return result;

  std::vector<UChar> buffer;

  result.resize(rc_string.size());
  buffer.resize(rc_string.size());

  UErrorCode status = U_ZERO_ERROR;
  int32_t len = 0;

  u_strFromUTF8(
    &buffer[0],
    buffer.size(),
    &len,
    &rc_string[0],
    rc_string.size(),
    &status
  );
  if(!U_SUCCESS(status))
  {
    throw XXXException("utf8: u_strFromUTF8 failed");
  }
  buffer.resize(len);

  u_strToWCS(
    &result[0],
    result.size(),
    &len,
    &buffer[0],
    buffer.size(),
    &status
  );
  if(!U_SUCCESS(status))
  {
    throw XXXException("utf8: u_strToWCS failed");
  }
  result.resize(len);

  return result;
}/* end of utf8 ( ) */ 
```

使用它就这么简单：

```
std::string s = utf8<std::string>(std::wstring(L"some string"));
std::wstring s = utf8<std::wstring>(std::string("some string")); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-09T18:15:37.600

我总是这样工作：

某些编码的字节流 -> `ICU`-> wistream -> stl & boost -> wostream -> `ICU`-> 某些编码的字节流

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T15:54:18.613

可以通过指定特定的语言环境来格式化日期、时间等。至于你自己的滚动——总是有可能的，你可以根据需要从底层库中获取尽可能多或尽可能少的内容。

> 还查看了 c++0x 标准并注意到 utf8、utf16 和 utf32 的文字，这是否意味着标准库（例如字符串、流等）将完全支持这些编码以及它们之间的转换？

是的。但请注意，这些是不同的数据类型，而不是您的常规`wchar`序列或`wstring`.

> 如果是这样，有人知道 Visual Studio 支持这些功能需要多长时间？

据我所知：vc9 (VS2008) 仅部分支持某些 TR1 功能。vc10（VS2010）预计会有更好的支持。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-07T16:41:08.063

我做了我自己的小包装。如果你愿意，我可以分享。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-07T16:44:50.583

倒霉。我知道 Dinkumware 库提供了一些 Unicode 支持——你可以查看他们网站上的文档。AFAIK，它不是免费的。

# python - 扩展 Python 的内置 Str

> ID：835469
> 
> 赞同：16
> 
> 时间：2009-05-07T15:50:29.730
> 
> 标签：python, oop, inheritance, overriding, immutability

我正在尝试子类化`str`，但由于它的不变性而遇到了一些困难。

```
class DerivedClass(str):

    def __new__(cls, string):
        ob = super(DerivedClass, cls).__new__(cls, string)
        return ob

    def upper(self):
        #overridden, new functionality. Return ob of type DerivedClass. Great.
        caps = super(DerivedClass, self).upper()
        return DerivedClass(caps + '123')

derived = DerivedClass('a')

print derived.upper() #'A123'
print type(derived.upper()) #<class '__main__.DerivedClass'>
print derived.lower() #'a' 
print type(derived.lower()) #<type 'str'> 
```

对于不需要任何新功能的继承方法，例如`derived.lower()`，是否有一种简单的 Pythonic 方法来返回类型对象`DerivedClass`（而不是`str`）？或者我是否像以前那样手动覆盖每个 str.method() `derived.upper()`？

编辑：

```
#Any massive flaws in the following?

class DerivedClass(str):
    def __new__(cls, string):
        ob = super(DerivedClass, cls).__new__(cls, string)
        return ob

    def upper(self):
        caps = super(DerivedClass, self).upper()
        return DerivedClass(caps + '123')

    def __getattribute__(self, name):
        att = super(DerivedClass, self).__getattribute__(name)

        if not callable(att):
            return att

        def call_me_later(*args, **kwargs):
            result = att(*args, **kwargs)
            if isinstance(result, basestring):
                return DerivedClass(result)
            return result
        return call_me_later 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T20:51:12.473

类装饰器的好用处——大致（未经测试的代码）：

```
@do_overrides
class Myst(str):
  def upper(self):
    ...&c... 
```

和

```
def do_overrides(cls):
  done = set(dir(cls))
  base = cls.__bases__[0]
  def wrap(f):
    def wrapper(*a, **k):
      r = f(*a, **k)
      if isinstance(r, base):
        r = cls(r)
      return r
  for m in dir(base):
    if m in done or not callable(m):
      continue
    setattr(cls, m, wrap(getattr(base, m))) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-07T16:56:42.020

您可以`__getattribute__`按照 Zr40 的建议通过覆盖来做到这一点，但您需要让 getattribute 返回一个可调用函数。下面的示例应该给你你想要的；它使用`functools.partial`包装器使生活更轻松，但如果您愿意，您可以不使用部分实现它：

```
from functools import partial

class DerivedClass(str):

    def __new__(cls, string):
        ob = super(DerivedClass, cls).__new__(cls, string)
        return ob

    def upper(self):
        #overridden, new functionality. Return ob of type DerivedClass. Great.
        caps = super(DerivedClass, self).upper()
        return DerivedClass(caps + '123')

    def __getattribute__(self, name):
        func = str.__getattribute__(self, name)
        if name == 'upper':
            return func

        if not callable(func):
            return func

        def call_me_later(*args, **kwargs):
            result = func(*args, **kwargs)
            # Some str functions return lists, ints, etc
            if isinstance(result, basestring:
                return DerivedClass(result)
            return result

        return partial(call_me_later) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-07T17:10:53.423

你们都很亲密，但是检查每个方法并不能很好地覆盖许多方法。

```
from functools import partial

class DerivedClass(str):
    def __new__(cls, string):
        ob = super(DerivedClass, cls).__new__(cls, string)
        return ob

    def upper(self):
        caps = super(DerivedClass, self).upper()
        return DerivedClass(caps + '123')

    def __getattribute__(self, name):
        if name in ['__dict__', '__members__', '__methods__', '__class__']:
            return object.__getattribute__(self, name)
        func = str.__getattribute__(self, name)
        if name in self.__dict__.keys() or not callable(func):
            return func

        def call_me_later(*args, **kwargs):
            result = func(*args, **kwargs)
            # Some str functions return lists, ints, etc
            if isinstance(result, basestring):
                return DerivedClass(result)
            return result

        return partial(call_me_later) 
```

[（[jarret hardie](https://stackoverflow.com/users/72247/jarret-hardie)在评论中提出的改进建议。）]

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-05-07T15:58:08.137

您可以通过覆盖来做到这一点`__getattribute__`。

```
def __getattribute__(self, name):
    # Simple hardcoded check for upper.
    # I'm sure there are better ways to get the list of defined methods in
    # your class and see if name is contained in it.
    if name == 'upper':
        return object.__getattribute__(self, name)

    return DerivedClass(object.__getattribute__(self, name)) 
```

# c# - 使用部分类从代码隐藏文件调用内联（ascx）方法

> ID：835487
> 
> 赞同：0
> 
> 时间：2009-05-07T15:52:32.207
> 
> 标签：c#, asp.net, partial-classes

我正在使用.net 2.0。我想将我的 C# 方法之一放在我的 ascx 文件内的内联服务器脚本块中，因为我需要在设计时对其进行大量更新。这样我就不必每次都编译我的大型项目。

我想从我的代码隐藏文件中调用该方法。我曾经通过在代码隐藏文件中插入一个虚拟存根方法并在 ascx 文件中覆盖它来做到这一点。现在，由于我已经开始使用部分类，我希望能够直接调用该方法。这不可能吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T20:37:50.197

不幸的是，我认为这是不可能的。在设计时，部分类 (*.designer.cs) 主要只包含您的控件。实际包含来自脚本块的代码的类也是由 ASP.NET 生成的，但它*继承*自您的主类。

看[http://msdn.microsoft.com/en-us/library/ms178138.aspx](http://msdn.microsoft.com/en-us/library/ms178138.aspx)了解更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T07:11:30.093

我不明白你的动机......修改页面的代码隐藏不是像 .ascx 文件一样容易吗？无论哪种方式，ASP.NET 要么在文件被访问时动态编译它们，要么强制你重新构建，具体取决于项目的类型。

# c# - 这个 linq 查询有什么问题？

> ID：835489
> 
> 赞同：0
> 
> 时间：2009-05-07T15:52:53.360
> 
> 标签：c#, .net, asp.net, linq

我敢肯定这真的很愚蠢，但我只是没有看到它..

`pData.LocationHours`是类型`BaseLocationHoursDataSet.LocationHoursDataTable`。然而，当我将光标悬停在 上时`l`，我看到的只是“ `(range variable) TSource l`”——这是为什么呢？为什么 linq 不知道它在处理什么？我用不同的 DataTable 尝试同样的事情，一切正常......不是这个人。可能是什么问题呢？

```
protected ListItem[] GetHoursTypesListItems(BaseLocationHoursDataSet pData)
{
  return (
            from l in pData.LocationHours   // putting cursor over the l here shows:  (range variable) TSource l
            select new ListItem
            {
              Value = l,  //ignore the fact that I didn't specify a property - that's the problem, that none of the properties of the object show up.
              Text = l
            }
          ).ToArray<ListItem>();
} 
```

.

**更新：**

问题是它不知道 l 是什么。我没有向我显示正确的类型（我希望看到 LocationHoursRow），而是看到“TSource l”.. 那是什么？`from l in pData.LocationHours`为什么它不知道 " " 行中的 l 是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-07T17:48:52.427

> 我看到“TSource l”.. 那是什么？

首先，编译器将查询从查询​​形式转换为方法调用形式。这个查询变成

```
pData.LocationHours.Select(l=>new ... ) 
```

其次，编译器尝试确定“pData.LocationHours.Select”的含义。如果 pData.LocationHours 的类型没有 Select 方法，则编译器开始寻找扩展方法。大概是找到了扩展方法

```
IEnumerable<TResult> Select<TSource, TResult>(
  this IEnumerable<TSource> source, Func<TSource, TResult> projection) 
```

或者它可能会找到相同的 IQueryable 版本。

现在编译器说“但是类型参数 TSource 和 TResult 是什么？”

我不知道你的问题是什么，但问题很可能发生在这个阶段。由于某种原因，类型推理引擎无法确定 TSource 是什么。

现在您将鼠标悬停在“l”上。发生什么了？智能感知引擎询问语义分析器“l”的类型是什么。语义分析器报告“l”已知是函数中的参数，该函数接受 TSource 并返回 TResult，但方法类型推断器无法确定 TSource 对应的实际类型。

因此，智能感知引擎尽其所能，并告诉您 l 是 TSource 类型。智能感知引擎还指出“l”是查询的范围变量，并告诉您这个事实。

> 为什么它不知道“from l in pData.LocationHours”行中的 l 是什么？

我不知道，但很明显*你*的代码有问题。在不知道所有表达式的类型以及确切可用的扩展方法的情况下，我很难说出到底发生了什么可怕的错误。

当代码被破坏并且无法编译时，智能感知仍然会尽力而为。我同意在这种情况下，结果有点令人困惑，但至少你知道在出现问题之前它已经达到了类型推断。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-07T16:00:56.460

我想也许你需要 l.Field：

```
select new ListItem
{
   Value = l.Field,
   Text = l.Field2
} 
```

好的，这样的事情怎么样：由于您使用的是数据集，因此您的查询可能需要类似于以下内容：

```
var query = pData.Tables["Name"].AsEnumerable() 
```

然后从查询对象中执行 LINQ

此外，发现这个代码片段可能会有所帮助。它使用通用数据集作为参考。

```
DataSet ds = new DataSet();
FillOrders(ds);

DataTable orders = ds.Tables["SalesOrderHeader"];

var ordersQuery = orders.ToQueryable();

var query = from o in ordersQuery
where o.Field<bool>("OnlineOrderFlag") == true
select new { SalesOrderID = o.Field<int>("SalesOrderID"),
OrderDate = o.Field<DateTime>("OrderDate") }; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T15:59:19.227

'l' 不代表 LocationHours 表中的数据行吗？我认为您需要在 lambda 中指定“l”的属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T16:00:01.190

它应该是 Value = l.Value 还是类似的东西？

# windows - Windows 中信号量的发布顺序是什么？

> ID：835494
> 
> 赞同：2
> 
> 时间：2009-05-07T15:53:30.630
> 
> 标签：windows, multithreading

信号量是 FIFO、随机还是使用其他算法释放的？该算法是否避免饥饿？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T15:56:35.300

[这篇文章](http://msdn.microsoft.com/en-us/library/ms685129(VS.85).aspx)说你不能假设 FIFO，虽然似乎稍微暗示 FIFO 是普遍预期的。不过，我可能夸大了。

[本文](http://www.dijksterhuis.org/using-semaphores-in-c/)确认它们不保证以任何顺序发布：

> C#中的信号量不是先进先出的，实现上其实并不能保证任务释放的顺序。

# git - 您如何存储未跟踪的文件？

> ID：835501
> 
> 赞同：1924
> 
> 时间：2009-05-07T15:54:20.423
> 
> 标签：git, git-stash

我对一个文件进行了更改，加上一个新文件，并希望在切换到另一个任务时使用 git stash 将它们收起来。但是 git stash 本身只存储对现有文件的更改；新文件保留在我的工作树中，使我未来的工作变得混乱。如何存储这个未跟踪的文件？

* * *

## 回答 #1

> 赞同：2709
> 
> 时间：2009-05-07T16:02:50.870

要存储您的工作目录，包括未跟踪的文件（尤其是那些在 中的文件`.gitignore`），那么您可能想要使用这个 cmd：

```
git stash --include-untracked 
```

或者，您可以使用简写`-u`代替`--include-untracked`，或者简单地使用`git stash --all`它来存储所有文件，包括**未跟踪**和**忽略**的文件。这种行为在 2018 年发生了变化，因此请确保您的 git 是最新的。

* * *

**警告：似乎有（或曾经有过）被忽略目录的内容可以被永久删除的情况。[有关详细信息，请参阅此存档网站](http://web.archive.org/web/20140310215100/http://blog.icefusion.co.uk:80/git-stash-can-delete-ignored-files-git-stash-u/)**。

* * *

## 回答 #2

> 赞同：462
> 
> 时间：2011-07-25T15:49:41.130

从 git 1.7.7 开始，`git stash`接受`--include-untracked`选项（或简写`-u`）。要在存储中包含未跟踪的文件，请使用以下任一命令：

```
git stash --include-untracked
# or
git stash -u 
```

**警告，如果您的 gitignore 文件中*有任何目录/条目，这样做将永久删除您的文件。****

 ** * *

## 回答 #3

> 赞同：98
> 
> 时间：2009-05-07T15:57:37.187

将文件添加到索引中：

```
git add path/to/untracked-file
git stash 
```

索引的全部内容，加上对现有文件的任何未暂存的更改，都会将其放入存储中。

* * *

## 回答 #4

> 赞同：69
> 
> 时间：2014-08-28T20:46:07.573

在 git bash 中，隐藏未跟踪文件是通过使用命令实现的

```
git stash --include-untracked
# or
git stash -u 
```

[http://git-scm.com/docs/git-stash](http://git-scm.com/docs/git-stash)

git stash 从您的工作区中删除任何未跟踪或未提交的文件。您可以使用以下命令恢复 git stash

```
git stash pop 
```

这会将文件放回本地工作区。

**我的经验**

我必须对我的 gitIgnore 文件进行修改，以避免将 .classpath 和 .project 文件移动到远程仓库中。到目前为止，我不允许在远程仓库中移动这个修改后的 .gitIgnore。

.classpath 和 .project 文件对于 eclipse 很重要——这是我的 java 编辑器。

我首先有选择地添加了我的其余文件并提交暂存。但是，除非修改后的 .gitIgnore 文件和未跟踪的文件，否则无法执行最终推送。.project 和 .classpath 没有被隐藏。

我用了

```
git stash 
```

用于存储修改后的 .gitIgnore 文件。

对于存储 .classpath 和 .project 文件，我使用了

```
git stash --include-untracked 
```

它从我的工作区中删除了文件。缺少这些文件会剥夺我在 Eclipse 中处理工作位置的能力。我继续完成将提交的文件推送到远程的过程。成功完成后，我使用

```
git stash pop 
```

这将相同的文件粘贴回我的工作区。这让我有能力在 Eclipse 中处理同一个项目。希望这能消除误解。

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2018-02-20T09:23:22.510

在 git 版本 2.8.1 上：以下对我有用。

将已修改和未跟踪的文件保存在没有名称的存储中

```
git stash save -u 
```

使用名称将已修改和未跟踪的文件保存在 stash 中

```
git stash save -u <name_of_stash> 
```

您可以使用**pop**或稍后**应用**，如下所示。

```
git stash pop

git stash apply stash@{0} 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2011-02-06T02:00:20.527

正如其他地方所说，答案是`git add`文件。例如：

```
git add path/to/untracked-file
git stash 
```

但是，另一个答案中也提出了这个问题：如果您真的不想添加文件怎么办？好吧，据我所知，你必须这样做。以下将***不起作用***：

```
git add -N path/to/untracked/file     # note: -N is short for --intent-to-add
git stash 
```

这将失败，如下所示：

```
path/to/untracked-file: not added yet
fatal: git-write-tree: error building trees
Cannot save the current index state 
```

所以，你可以做什么？好吧，您必须真正添加文件，*但是*，您可以稍后有效地取消添加它，使用`git rm --cached`：

```
git add path/to/untracked-file
git stash save "don't forget to un-add path/to/untracked-file" # stash w/reminder
# do some other work
git stash list
# shows:
# stash@{0}: On master: don't forget to un-add path/to/untracked-file
git stash pop   # or apply instead of pop, to keep the stash available
git rm --cached path/to/untracked-file 
```

然后您可以继续工作，以与之前相同的状态`git add`（即使用名为`path/to/untracked-file`; 的未跟踪文件以及您可能必须对跟踪文件进行的任何其他更改）。

对此工作流程的另一种可能性是：

```
git ls-files -o > files-to-untrack
git add `cat files-to-untrack` # note: files-to-untrack will be listed, itself!
git stash
# do some work
git stash pop
git rm --cached `cat files-to-untrack`
rm files-to-untrack 
```

*[注意：正如@mancocapac 的评论中所述，您可能希望添加`--exclude-standard`到`git ls-files`命令中（所以，`git ls-files -o --exclude-standard`）。]*

...这也可以很容易地编写脚本——即使是别名也可以（以 zsh 语法呈现；根据需要进行调整）[此外，我缩短了文件名，因此它完全适合屏幕，而无需在此答案中滚动；随意替换您选择的备用文件名]：

```
alias stashall='git ls-files -o > .gftu; git add `cat .gftu`; git stash'
alias unstashall='git stash pop; git rm --cached `cat .gftu`; rm .gftu' 
```

请注意，后者作为 shell 脚本或函数可能会更好，以允许将参数提供给`git stash`，以防万一您不想要`pop`but`apply`和/或希望能够指定特定的存储，而不是仅仅获取顶部一。也许这个（而不是上面的第二个别名）[空白被剥离以适应不滚动；重新添加以提高可读性]：

```
function unstashall(){git stash "${@:-pop}";git rm --cached `cat .gftu`;rm .gftu} 
```

***注意****：在这种形式中，如果您要提供存储标识符，则需要提供操作参数以及标识符，例如`unstashall apply stash@{1}`或`unstashall pop stash@{1}`*

当然，你会投入你的`.zshrc`或同等的东西来长期存在。

希望这个答案对某人有所帮助，将所有内容放在一个答案中。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2020-08-25T19:54:38.947

## 2020 年更新的答案

令我惊讶的是，此页面上没有提到其他答案`git stash push`。

[这篇文章](https://medium.com/@milan.brankovic/git-stash-984c4593b39c)帮助我理解了：

> 该命令`git stash`是`git stash push`. 在这种模式下，不允许使用非选项参数来防止拼写错误的子命令生成不需要的隐藏条目。此命令还有另一个别名`git stash save`，已弃用，取而代之的是`git stash push`.
> 
> 默认情况下，git 在进行存储时会忽略未跟踪的文件。如果需要将这些文件添加到存储中，您可以使用`-u`选项告诉 git 包含未跟踪的文件。`-a`如果指定了选项，也可以添加忽略的文件。`-a`将包括未跟踪和忽略的文件。

**我关心命名我的存储，我希望它们包含未跟踪的文件，所以我最常运行的命令是：** `git stash push -u -m "whatIWantToNameThisStash"`

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2017-05-06T22:33:33.923

我可以通过以下方式**仅**存储未跟踪的文件：

```
git stash save "tracked files I'm working on"
git stash save -u "untracked files I'm trying to stash"
git stash pop stash@{1} 
```

最后一个会弹出已跟踪文件的存储，因此只保留未跟踪的文件。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2019-03-04T14:41:19.050

如果您想存储未跟踪的文件，但保留索引文件（例如您即将提交的文件），只需将`-k`(keep index) 选项添加到`-u`

```
git stash -u -k 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-05-28T07:35:42.723

您可以使用以下命令简单地做到这一点

```
git stash save --include-untracked 
```

或者

```
git stash save -u 
```

有关 git stash 的更多信息，请[访问此帖子（单击此处）](https://medium.freecodecamp.org/useful-tricks-you-might-not-know-about-git-stash-e8a9490f0a1a)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-11-18T21:40:11.973

假设新的和未跟踪的文件被称为：“views.json”。如果您想通过隐藏应用程序的状态来更改分支，我通常会输入：

```
git add views.json 
```

然后：

```
git stash 
```

它会被藏起来。然后我可以改变分支

```
git checkout other-nice-branch 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2022-01-29T06:06:59.897

**2.35 版中的新功能**

git stash 的新 --staged 模式可以轻松地隐藏暂存区域中已有的内容，仅此而已。你可以把它想象成 git commit（它只写入分阶段的更改），但它不是创建一个新的提交，而是向存储写入一个新条目。然后，当您准备好时，您可以恢复您的更改（使用 git stash pop）并继续工作。

```
git add -A
git stash --staged 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-10-11T10:10:22.037

我认为这可以通过告诉 git 文件存在来解决，而不是将其所有内容提交到暂存区，然后调用`git stash`. Araqnid[描述](https://stackoverflow.com/questions/855767/can-i-use-git-diff-on-untracked-files/857696#857696)了如何做前者。

```
git add --intent-to-add path/to/untracked-file 
```

或者

```
git update-index --add --cacheinfo 100644 e69de29bb2d1d6434b8b29ae775ad8c2e48c5391 path/to/untracked-file 
```

但是，后者不起作用：

```
$ git stash
b.rb: not added yet
fatal: git-write-tree: error building trees
Cannot save the current index state 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-08-19T23:59:24.300

这里有几个正确的答案，但我想指出，对于新的整个目录，`'git add path'`将***不起作用***。*因此，如果您在untracked-path*中有一堆新文件，请执行以下操作：

```
git add untracked-path
git stash "temp stash" 
```

这将隐藏以下消息：

```
Saved working directory and index state On master: temp stash
warning: unable to rmdir untracked-path: Directory not empty 
```

如果*untracked-path*是您要存储的唯一路径，则存储“临时存储”将是一个空存储。正确的方法是添加整个路径，而不仅仅是目录名（即以'/'结束路径）：

```
git add untracked-path/
git stash "temp stash" 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-05-08T08:11:06.737

我在将 Sourcetree 与新创建的文件一起使用时遇到了类似的问题（它们也不会包含在存储中）。

当我第一次选择“全部暂存”然后将新添加的组件存储在跟踪位置并因此包含在存储中时。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-01-07T06:24:57.240

## 您如何存储未跟踪的文件？

```
git stash --include-untracked 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-11-11T14:41:10.950

**Stashing 在 VS 2019 及更高版本中可用。**

1.  转到 Git 更改窗口`Ctrl + Alt + F7`
2.  现在按附近的下拉键`Commit All`或`Commit staged`按钮以查看存储选项

[![在此处输入图像描述](https://i.stack.imgur.com/f1HcN.png)](https://i.stack.imgur.com/f1HcN.png)

如果您想存储未跟踪的文件，`Git ignored files`或者`Files which are not included into project`然后选择此选项

[![在此处输入图像描述](https://i.stack.imgur.com/SMvy2.png)](https://i.stack.imgur.com/SMvy2.png)

**阅读此答案以在 Visual Studio 中充分使用 Git stash：** [https ://stackoverflow.com/a/69905607/4391394](https://stackoverflow.com/a/69905607/4391394)

* * *

## 回答 #18

> 赞同：-7
> 
> 时间：2011-02-18T09:12:14.030

我曾经思考和渴望相同的功能。但随着时间的推移，我注意到它确实不需要。存储时，可以保留新文件。他们不会发生任何“坏事”（当您检查其他内容时，git 会出错并且不会覆盖现有的未跟踪文件）

`git stash`而且由于通常和之间的时间范围`git stash pop`很小，因此您将很快再次需要未跟踪的文件。因此，我想说的是，当`git status`您在处理其他事情（在`git stash`和`git stash pop`你的藏匿处。

# css - 用另一个类覆盖自定义 CSS

> ID：835505
> 
> 赞同：0
> 
> 时间：2009-05-07T15:54:32.903
> 
> 标签：css

我无法为此菜单的选项卡建立“开启”状态。由于 IE 6 显示问题，我最终放弃了使用 UL 和 LI。我现在使用一张桌子。

表格在目标浏览器中运行良好，在 Opera 中存在翻转颜色错误，但其余部分都很好。

事情是我需要为加载的选项卡设置一个“打开”状态，它具有翻转样式。

到目前为止，我无法对个人进行任何更改`<TD>`。

有问题的页面正在开发中，网址为[http://hiv411.dreamhosters.com/page.php](http://hiv411.dreamhosters.com/page.php)

非常感谢您的任何建议！

表代码如下所示：

```
<table border="0" cellspacing="0" cellpadding="0" class="tabs"> 
<tr> 
    <td class="tabs"><a href="page.php" class="tabs">First Link</a></td> 

    <td class="tabs"><a href="page.php" class="tabs">Another Link</a> </td> 

    <td class="tabOn"><a href="page.php" class="tabOn">A Third Link Which is Longer</a> 

</td> 
    </tr> 
</table> 
```

CSS 是这样的：

```
.tabOn td {
    width:140px;
    height:29px;
   border: 1px solid #fff;
    background-image:none;
    background-color:#FFF;
    color:#000;
   font-size:9pt;
   font-weight:bold;
   text-align:center;
   white-space:nowrap;
}
.tabOn td a{
   color:#000;
   display: block;
   padding: 6px;
   padding-top:7px;
   height:17px;
   text-decoration: none;
   margin-top:1px;
   white-space:nowrap;
}

/* NORMAL STATE */

table.tabs {
   border-collapse: collapse;
}
table.tabs td {
    width:140px;
    height:29px;
   border: 1px solid #fff;
   background:url(/images/tabOverBG.jpg) repeat-x;
   background-position:bottom;
   font-size:9pt;
   font-weight:bold;
   text-align:center;
   white-space:nowrap;
}
table.tabs td a{
   display: block;
   padding: 6px;
   height:17px;
   text-decoration: none;
   margin-top:4px;
   white-space:nowrap;
}
table.tabs td a:link, table.tabs td a:visited {
   color: #fff;
}
table.tabs td a:hover, table.tabs td a:active, table.tabs td:hover {
   color: #000;
   background-color: #fff;
   background-image:none;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:00:36.367

不`.tabOn td`应该`td.tabOn`吗？也`.tabOn td a`应该是`td.tabOn a`

你现在拥有它的方式将是`<tr class="tabOn">`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T16:11:39.260

你要做的是改变css的顺序，首先是一般标签和类。并应用相同的类 table.tabs（因此 css 不会覆盖属性），您可以节省空间，但不能在 .tabOn 中两次写入相同的属性：

```
table.tabs {
   border-collapse: collapse;
}
table.tabs td {
   width:140px;
   height:29px;
   border: 1px solid #fff;
   background:url(/images/tabOverBG.jpg) repeat-x;
   background-position:bottom;
   font-size:9pt;
   font-weight:bold;
   text-align:center;
   white-space:nowrap;
}
table.tabs td a{
   display: block;
   padding: 6px;
   height:17px;
   text-decoration: none;
   margin-top:4px;
   white-space:nowrap;
}
table.tabs td a:link, table.tabs td a:visited {
   color: #fff;
}
table.tabs td a:hover, table.tabs td a:active, table.tabs td:hover {
   color: #000;
   background-color: #fff;
   background-image:none;
}
table.tabs td.tabOn {
   background-image:none;
   background-color:#FFF;
   color:#000;
}
table.tabs td.tabOn a{
   color:#000;
   margin-top:1px;
} 
```

# wpf - 在 WPF/Silverlight 中：是否可以将 DataTable 或 XML 文件绑定到 ListView？

> ID：835507
> 
> 赞同：0
> 
> 时间：2009-05-07T15:55:03.400
> 
> 标签：wpf, xml, silverlight, listview, datatable

WPF 中是否可以将数据矩阵（数据表或 XML 文件）绑定到 ListView？

给定以下 XML 数据集：

```
<data>
  <cols>
    <col name="FirstName" />
    <col name="LastName" />
    <col name="Age" />
  </cols>
  <rows>
    <row>
      <col>Huey</col>
      <col>Freeman</col>
      <col>10</col>
    </row>
    <row>
      <col>Michael</col>
      <col>Caesar</col>
      <col>10</col>
    </row>
    <row>
      <col>Reiley</col>
      <col>Freeman</col>
      <col>8</col>
    </row>
    <row>
      <col>Cindy</col>
      <col null="true" />
      <col>9</col>
    </row>
    <row>
      <col />
      <col>Robert Jebediah Freeman</col>
      <col>70</col>
    </row>
  </rows>
</data> 
```

是否可以将此数据绑定到 ListView？

**请注意，**数据列不是预定义的。它可以是任何类型，名称各不相同。

P/S：我知道 DataGrid 但它对于使用来说太重了，我们只需要显示数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:01:20.343

您可以为此使用 XmlDataProvider。

```
XmlDataProvider data = new XmlDataProvider();

// you can load data from file/http/whatever

data.Source = "... some URL ...";

// *OR* you can go directly against an already existing XmlDocument

// data.Document = someXmlDocumentInstance;

data.XPath = "/books/book"; // specific to your schema obviously

myListView.ItemsSource = data.Data; 
```

您还可以设置绑定

```
Binding myBinding = new Binding();

myBinding.Source = data;

BindingOperations.SetBinding(myListView, ItemsControl.ItemsSourceProperty, myBinding); 
```

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T15:59:10.007

您可以将其绑定到列表视图，但列不会自动生成。您必须构建自己的控件来执行此操作，或者找到其他人已经完成的控件。

如果你用[谷歌搜索](http://www.google.com/search?rlz=1C1GGLS_enUS307US307&aq=0&oq=wpf+listview+auto&sourceid=chrome&ie=UTF-8&q=wpf+listview+auto+generate+columns)，你会发现各种带有代码和无代码的文章。

# amazon-s3 - Amazon S3 - 外部存储桶关联 API

> ID：835509
> 
> 赞同：1
> 
> 时间：2009-05-07T15:55:51.917
> 
> 标签：amazon-s3

我想在 X 账户中关联一个由账户 Y 创建的存储桶

账户 Y 已通过电子邮件 ID 向存储桶上的 X 授予读写权限

这是使用 S3Fox 完成的 - 但是当我登录 X 帐户时，我看不到任何关联外部存储桶的方法。

我尝试像往常一样输入存储桶名称，但没有成功

所以我想通过 PHP 编写我自己的关联并休息，但在 API 文档中找不到调用 - 有人可以给我发送关于如何在帐户 X 中创建外部存储桶的链接或示例代码

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-11T14:36:22.287

账户 X 必须将来自 Y 的存储桶配置为“外部存储桶”。但情况更糟。外部存储桶功能取决于 X 使用的客户端软件。所以关于 X 收听的存储桶的信息存储在 X 的客户端而不是 S3。X 必须使用支持外部存储桶的 s3 客户端。

马丁

# architecture - 实体元数据存储架构

> ID：835514
> 
> 赞同：1
> 
> 时间：2009-05-07T15:56:53.367
> 
> 标签：architecture, indexing, metadata

我们正在构建一个文档存储解决方案，对于每个文档，我们需要存储大量额外的元数据以符合当地法规，范围从标题或描述等基本数据到相关事件的日期或处置和分类规则。

我见过不同类型的解决方案，但没有一个能说服我：

1.  添加新的元数据槽时表在列中增长（因此它们的列与与文档关联的元数据一样多）
2.  具有大量备用通用列的表。与 1 非常相似，但表不会增长（权限较少）
3.  文档 ID、元数据键和元数据值的表。
4.  3\. 中包含元数据定义和元数据键的表被元数据 ID 替换。我们过去使用过这个解决方案。这些表最后有数百万行。
5.  文档表或关联表中的文本字段，用于存储 XML 或其他结构化信息以及键值对中的所有元数据。

我偏向于数字 5，提供并行全文索引（Lucene.Net？其他？）以通过相关元数据进行搜索（并非所有内容都必须是“可搜索的”）。

有什么建议吗？类似的经历？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T16:10:33.037

表 1：文档信息（PK 为文档 ID）

表 2：元数据定义（PK 是元数据定义 ID）

表 3：文档 ID、元数据定义 ID、元数据值

最大的缺点是您要么必须有一个类型（大概是 varchar），要么必须有 n 列（其中 n 是您愿意存储的数据类型的数量），并且使用元数据定义表中的一列来确定要从表 3 中的哪一列中提取值。

我对列出的 5 个解决方案的看法：

1.  增长表是一件痛苦的事情，并且可能会导致问题（特别是如果您想要/需要一个不可为空的元数据值）。
2.  我*讨厌*“备用通用列”（即使它们很受欢迎）。
3.  关闭，但这比我的解决方案更限制了您的元数据灵活性。如果您的元数据键和值相当基本，它可能会起作用。
4.  我不太确定你所说的这个是什么意思——它和我提议的一样，还是别的什么？
5.  我不喜欢将结构化 XML 存储在 RDBMS 中 - 恕我直言，您会失去 RDBMS 的大部分功能。

这就是我的想法——我从来没有设计过这样的系统，但我已经处理过使用其中几种方案的商业系统。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T13:44:16.880

为什么不使用[CouchDB](http://couchdb.apache.org/docs/overview.html)？它的设计正是为了解决这种类型的要求。

如果这不是一个选项，请考虑使用 Lua 或 JSon（根据您的 #5 选项）作为元数据描述符。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T17:16:14.407

也许你可以看看[JCR](http://www.ibm.com/developerworks/java/library/j-jcr/)（Java Content Repository）。JCR 是内容存储库的标准，它捕获了内容管理的常见要求，例如版本控制、全文搜索和编辑。它还提供了内容存储的抽象级别，这意味着您可以使用一个 API 将内容放入任何类型的存储系统，如数据库、xml 文件等。当然，您可以通过向文档添加一些属性来将元数据添加到文档中带有 JCR API 的文档节点。您不必担心文档和元数据的存储方式。JCR 会处理它。Jackrabbit 是 JCR 的参考实现。试试。

# objective-c - 你如何实现方法 makeKeyAndOrderFront:？

> ID：835516
> 
> 赞同：0
> 
> 时间：2009-05-07T15:57:23.567
> 
> 标签：objective-c, cocoa

我正在打开一个新窗口并希望实现方法 makeKeyAndOrderFront: 对于窗口，我想知道我需要输入什么代码来执行此操作。

这是我已经打开窗口的一些代码：

文件 1（第一个控制器）

```
#import "PreferenceController.h"

@implementation PreferenceController

- (id)init
{
    if (![super initWithWindowNibName:@"Preferences"])
        return nil;
    return self;
}
- (void)windowDidLoad
{
    NSLog(@"Nib file is loaded");
} 
```

文件 2（打开窗口的动作）

```
#import "Prefernces_Delegate.h"
#import "PreferenceController.h"

@implementation Prefernces_Delegate

- (IBAction)showPreferencePanel:(id)sender
{
    // Is preferenceController nil?
    if (!preferenceController) {
        preferenceController = [[PreferenceController alloc] init];
    }
    NSLog(@"showing %@", preferenceController);
    [preferenceController showWindow:self];
} 
```

我尝试这样做的原因是朋友建议解决开窗问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T16:01:27.863

你不想实现`-makeKeyAndOrderFront:`，你想在你的窗口上调用它，以便将它带到前面并使其成为关键窗口。你的`showWindow:`方法是做什么的？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T16:02:46.380

某处之后`[preferenceController showWindow:self];`：

```
[self.window makeKeyAndOrderFront:self]; 
```

还是您的意思是向控制器添加方法？

```
// you should use a different method name, cause it's not the
// controller that is made key and ordered front.
- (void)makeKeyAndOrderFront:(id)IBAction {
    [self.window makeKeyAndOrderFront:self];
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-04T20:41:10.967

`makeKeyAndOrderFront`只有在启动主事件循环后才会发送消息`[NSApp run]`。您可以尝试通过实现方法从主视图发送消息`viewWillDraw`：

```
- (void)viewWillDraw
{
    [window makeKeyAndOrderFront: nil];
} 
```

# .net - 如何在 .NET 中提供 JSON 响应数据？

> ID：835522
> 
> 赞同：7
> 
> 时间：2009-05-07T15:58:03.690
> 
> 标签：.net, ajax, json, response.write

在不使用任何第三方工具的情况下，提供 JSON 响应数据的理想方式是什么？

我正在考虑让一个 ASPX 应用程序页面只返回 json 字符串响应。有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-07T16:03:37.873

最简单的方法是创建一个带有`[WebMethod]`属性的方法，响应会自动被 JSON 序列化。自己试试：

```
[WebMethod]
public static string GetDateTime()
{
    return DateTime.Now.ToString();
} 
```

Ajax 调用 URL 将是：

```
Page.aspx/GetDateTime

```

### 编辑：

要传递参数，只需将它们添加到函数中：

```
[WebMethod]
public static int AddNumbers(int n1, int n2)
{
    return n1 + n2;
} 
```

我正在使用 jQuery，因此该`data:`对象将设置为：

```
data: "{n1: 1, n2: 2}", 
```

另请注意，返回的 JSON 对象将如下所示：

```
{"d":[3]} 
```

数据中的额外`"d"`内容在此处解释：http: [//encosia.com/2009/02/10/a-break-change-between-versions-of-aspnet-ajax/](http://encosia.com/2009/02/10/a-breaking-change-between-versions-of-aspnet-ajax/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-07T16:03:16.813

不是 aspx 页面，但可能是 ashx 处理程序。为了使这更容易，.Net 3.5内置了[对 JSON 的序列化支持。](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.json.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T16:06:20.677

查看 ASP.NET 框架提供的 JavascriptSerializer 类。通常，您会在 WebService 中的 Page Method 或 WebMethod 中使用它来返回序列化为 JSON 的对象。

请参阅[此处的 MSDN](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx)参考。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T16:02:47.517

我通常使用带有 ScriptService 属性和 ScriptManager 的 Web 服务 (asmx)。与一些 jQuery 插件有一些轻微的不兼容，但并不严重，我不必处理任何手动序列化。

# html - 我可以在我的自动 Perl 构建中使用 perltidy 的 HTML 格式化程序吗？

> ID：835530
> 
> 赞同：1
> 
> 时间：2009-05-07T15:59:10.037
> 
> 标签：html, perl, build-process, build, perl-tidy

我正在使用 Module::Build 在我正在开发的 Perl 模块上执行构建、测试、testpod、html 和安装操作。生成的 HTML 文件没问题，但如果我能以某种方式将 Module::Build 配置为使用 perltidy -html 格式化实用程序而不是它自己的 HTML 格式化程序，我会更高兴。

任何人都知道我可以用更漂亮的 perltidy HTML 格式化程序替换 Module::Build 附带的 HTML 格式化程序吗？

***附录：*** 当我在上面说“替换”时，这可能具有误导性。我真的不想编写代码来替换 Module::Build 附带的 html 格式化程序。我真的很想知道 Module::Build 是否有任何**其他**HTML 格式化程序选项。它生成的 HTML 看起来非常简单和通用。太无聊了。我非常喜欢 perltidy 的输出。

这是我现在如何在我编写的构建脚本中让它工作的方法，但这完全是一个 hack ......落入命令行 perltidy 脚本：

```
use strict;
use warnings;

# get list of files in directory
my $libLocation = "lib/EDF";
opendir( DIR, $libLocation );
my @filenameArray = readdir(DIR);

# iterate over all files to find *.pm set
for my $file (@filenameArray) {
    if ( $file =~ m/      # matching regex
                      \.  # literal period character
                      pm  # the pm file extenstion
                  /x      # end of regex
       )
    {

        my $return = `perl D:/Perl/site/bin/perltidy -q --indent-columns=4 --maximum-line-length=80 -html -opath blib/libhtml2 -toc $libLocation/$file`;

        if ($return eq "") {
            print "HTMLized " . $file . "\n";
        }
        else {
            print "Error: " . $return . "\n";
        }

    }

} 
```

但我真的希望有一种方法可以使用 Module::Build 并用一个标志或一个参数告诉它，或者告诉它使用不同的 HTML 格式化程序。不过，我想这是一个白日梦：

```
use strict;
use warnings;
use Module::Build;

my $build = Module::Build->resume (
  properties => {
    config_dir => '_build',
  },
);

$build->dispatch('build');
$build->dispatch('html', engine => 'perltidy'); 
```

或许：

```
$build->dispatch('htmltidy'); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T16:27:09.283

好吧，该动作在

```
htmlify_pods 
```

在[Module::Build::Base](http://cpansearch.perl.org/src/EWILHELM/Module-Build-0.33/lib/Module/Build/Base.pm)中。

应该可以覆盖该方法。

**很久以后 ...**

这是我的尝试（仅测试一次）：

```
package My::Builder;

use strict;
use warnings;

use base 'Module::Build';

sub htmlify_pods {
  my $self = shift;
  my $type = shift;
  my $htmldir = shift || File::Spec->catdir($self->blib, "${type}html");

  require Module::Build::Base;
  require Module::Build::PodParser;
  require Perl::Tidy;

  $self->add_to_cleanup('pod2htm*');

  my $pods = $self->_find_pods( 
      $self->{properties}{"${type}doc_dirs"},
      exclude => [ Module::Build::Base::file_qr('\.(?:bat|com|html)$') ] );
  return unless %$pods;  # nothing to do

  unless ( -d $htmldir ) {
    File::Path::mkpath($htmldir, 0, oct(755))
      or die "Couldn't mkdir $htmldir: $!";
  }

  my @rootdirs = ($type eq 'bin') ? qw(bin) :
      $self->installdirs eq 'core' ? qw(lib) : qw(site lib);

  my $podpath = join ':',
                map  $_->[1],
                grep -e $_->[0],
                map  [File::Spec->catdir($self->blib, $_), $_],
                qw( script lib );

  foreach my $pod ( keys %$pods ) {

    my ($name, $path) = File::Basename::fileparse($pods->{$pod},
        Module::Build::Base::file_qr('\.(?:pm|plx?|pod)$'));
    my @dirs = File::Spec->splitdir( File::Spec->canonpath( $path ) );
    pop( @dirs ) if $dirs[-1] eq File::Spec->curdir;

    my $fulldir = File::Spec->catfile($htmldir, @rootdirs, @dirs);
    my $outfile = File::Spec->catfile($fulldir, "${name}.html");
    my $infile  = File::Spec->abs2rel($pod);

    next if $self->up_to_date($infile, $outfile);

    unless ( -d $fulldir ){
      File::Path::mkpath($fulldir, 0, oct(755))
        or die "Couldn't mkdir $fulldir: $!";
    }

    my $path2root = join( '/', ('..') x (@rootdirs+@dirs) );
    my $htmlroot = join( '/',
             ($path2root,
              $self->installdirs eq 'core' ? () : qw(site) ) );

    my $fh = IO::File->new($infile) or die "Can't read $infile: $!";
    my $abstract = Module::Build::PodParser->new(fh => $fh)->get_abstract();

    my $title = join( '::', (@dirs, $name) );
    $title .= " - $abstract" if $abstract;

    my %opts = (
        argv => join(" ", 
            qw( -html --podflush ),
            "--title=$title",
            '--podroot='.$self->blib,
            "--htmlroot=$htmlroot",
            "--podpath=$podpath",
        ),
        source => $infile,
        destination => $outfile,
    );

    if ( eval{Pod::Html->VERSION(1.03)} ) {
      $opts{argv} .= ' --podheader';
      $opts{argv} .= ' --backlink=Back to Top';
      if ( $self->html_css ) {
          $opts{argv} .= " --css=$path2root/" . $self->html_css;
      }
    }

    $self->log_info("HTMLifying $infile -> $outfile\n");
    $self->log_verbose("perltidy %opts\n");
    Perl::Tidy::perltidy(%opts);    # or warn "pod2html @opts failed: $!";
  }
}
1; 
```

** 使用它.. **

```
#!/usr/bin/perl

use strict;
use warnings;

use My::Builder;

my $builder = My::Builder->new(
    module_name => 'My::Test',
    license     => 'perl',
);

$builder->create_build_script; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-09T19:21:37.590

定义可以通过 dispatch 调用的新 Module::Build 操作非常容易，Module::Build 文档中有很多示例。定义一个动作来处理你的新步骤：

```
子 ACTION_htmltidy
    {
    我的( $self ) = @_;

    $self->depends_on( ...其他目标... );

    需要 Perl::Tidy；

    ...做你的伤害...
    }

```

如果您希望其他操作使用您的操作，您可以扩展它以便建立依赖关系：

```
子 ACTION_install
    {
    我的( $self ) = @_;

    $self->depends_on('htmltidy');

    $self->超级::安装；
    }

```

# web-applications - 网站最受欢迎的功能

> ID：835542
> 
> 赞同：1
> 
> 时间：2009-05-07T16:00:46.180
> 
> 标签：web-applications

我正在尝试确定我正在写的一组文章的最佳卖点。我应该将 RSS 提要或 Facebook/Twitter/YouTube 集成到网站吗？或者是其他东西？我已经涵盖了图片库、博客、论坛、投票（甚至购物车）。如果这太主观了，我很抱歉。我只想知道您最常被要求为客户网站创建什么。

编辑：让我这样说。假设您正在学习如何使用 PHP 构建网站。您想尽快获得客户，那么您会先学习如何做：从其他网站获取 RSS 提要，或者从第三方网站（如 Facebook 和 Twitter）获取数据，或者集成 YouTube 视频？什么可能首先让您成为客户？还有什么？（除了博客、论坛、投票、图片库和购物车）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T16:11:41.863

当然，这取决于您的 Web 应用程序以及它的作用？

谁是您的目标受众，您将如何产生收入，以及您将其卖给谁？

所有这些问题对于确定要开发哪些功能都至关重要。

关于您的编辑，我想说的是专注于您网站的内容和功能。它存在的核心原因是什么？

创建一个使用 PHP 进行学习的网站并不意味着它值得任何东西，除了你。（除非它可能解释如何编写 PHP 代码？）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T16:56:44.610

人们喜欢在他们的网站上看到 Google 地图小部件。你把简洁的东西放在一个气泡对话框中，说明它是什么以及如何获得前往那里的路线。所以我想这会属于，向网站添加小部件。

例如[http://www.stjamestheapostle.ca/home/mapdirections/](http://www.stjamestheapostle.ca/home/mapdirections/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T16:40:34.727

我投票支持来自其他站点的 RSS 提要，通常是一个很少有新东西的站点，通过添加它看起来更有活力。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T17:29:41.037

我会投票支持 RSS、Twitter、Widgets（例如已经建议的 Google Maps）和 YouTube。RSS 和 Twitter 为您提供动态内容，如果是针对实体企业或机构，谷歌地图集成非常棒，如果它可以让人们无需离开您的网站即可找到方向，让企业有更多的“面对面时间”与客户而不是让他们访问用于查找路线的 3rd 方链接。

我认为您的列表中缺少的两件事是数据库集成和安全性。现在有很多网站都拥有 GB 或更大的数据库来提供内容，因此能够很好地掌握如何使用 PHP 从数据库中读取/写入信息，这将是一件好事，早点而不是晚点。此外，我还将解决构建安全管理控制的需求以及如何安全地处理私人信息（用户名、密码、电子邮件等），尤其是当您要谈论使用购物车时。

# c# - 确保流式阅读器不会挂起等待数据

> ID：835549
> 
> 赞同：3
> 
> 时间：2009-05-07T16:01:11.123
> 
> 标签：c#, .net, stream, tcpclient

下面的代码从 tcp 客户端流中读取所有要读取的内容，并且在下一次迭代中，它将仅位于 Read() 上（我假设等待数据）。我如何确保它不会，并且在没有什么可读的时候返回？我是否必须设置低超时，并在异常失败时响应异常？还是有更好的方法？

```
TcpClient tcpclnt = new TcpClient();
tcpclnt.Connect(ip, port);

Stream stm = tcpclnt.GetStream();

stm.Write(cmdBuffer, 0, cmdBuffer.Length);

byte[] response = new Byte[2048];

MemoryStream ms = new MemoryStream();
byte[] buffer = new Byte[2048];
int length;
while ((length = stm.Read(buffer, 0, buffer.Length)) > 0)
    ms.Write(buffer, 0, length);

byte[] response = ms.ToArray();

tcpclnt.Close(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T17:26:32.637

**TcpClient**有两个我会使用的属性。

1.  **NoDelay**获取或设置一个值，当发送或接收缓冲区未满时禁用延迟。
2.  **ReceiveTimeout**获取或设置一旦启动读取操作，TcpClient 将等待接收数据的时间量

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T18:33:35.953

也许你应该使用多线程。一个线程应该等待数据，另一个应该处理接收到的数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T16:11:57.730

服务器是否启用了“保持连接活动”？

我有服务器，只要您请求它们，它们就会向您发送空字节流。

转动“保持连接活动”会阻止它这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-01T19:27:22.163

```
var socket = new System.Net.Sockets.TcpClient();
            socket.NoDelay = true;
            socket.Connect(uri.Host, port);
            var ns = socket.GetStream();
            int timeout = 500; //ms
            DateTime lastReceived = DateTime.Now;
            string buffer = "";
            while (true)
            {
                if (ns.DataAvailable)
                {
                    var b = ns.ReadByte();
                    buffer += b + ", "; //customise this line yourself
                    lastReceived = DateTime.Now;
                    continue;
                }
                if (lastReceived.AddMilliseconds(timeout) < DateTime.Now) break;
                System.Threading.Thread.Sleep(timeout / 5);
            } 
```

# c# - 将 dll 动态加载到我的程序中的问题

> ID：835551
> 
> 赞同：2
> 
> 时间：2009-05-07T16:01:22.013
> 
> 标签：c#, visual-studio, dll, dynamic, casting

我正在尝试将插件添加到我的程序中，这看起来不错，只是我无法从 dll 中转换正确的类型。我有一个解决方案，上面有几个项目。其中一个项目是一个国家层，它实际上拥有一个 CountryBase（定义为公共抽象类 CountryBase：CountryLayers.ICountryBase）接口（公共接口 ICountryBase）

在另一个项目上，我有国家的“实施”。此 dll 在运行时加载，使用以下命令：

```
 Assembly assembly = Assembly.LoadFrom(file);
            //get the class from the assembly
            foreach (Type t in assembly.GetTypes())
            {
//just for debugging
                Console.WriteLine(t.FullName);
            }

            Type localType = assembly.GetType( "CountryLayers.Local");
            if (localType != null)
            {
                Country countrydata = new Country();
                countrydata.ObjectType = localType;
                countrydata.CountryObject  = Activator.CreateInstance(localType);
                countrydata.CountryObject2 = (CountryBase) countrydata.CountryObject;
                countrydata.FileName = file;
                CountryList.Add(countrydata);
            } 
```

其中 Local 是定义为公共类 Local 的类的名称： CountryLayers.CountryBase, CountryLayers.ICountryBase

countrydata 只是持有指针。CountryObject2 被定义为 CountryBase（我也尝试为 IcountryBase）。但它总是返回该类型不可转换。

控制台 writeline 显示在程序集中加载了属于 countrylayer 的所有类以及本地类。

所以此时我不知道错误是因为我将所有内容都放在同一个解决方案上，还是问题是我使用接口和抽象类的顺序不正确。同样，当 create instance 返回对象时，该对象具有抽象类中定义的所有属性，但没有方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T17:57:37.820

我自己解决。当您使用该解决方案编译所有内容时，就会出现问题。这样，它也会在其他类的输出中为接口创建 dll。考虑到这一点，我使用插件文件夹来保存插件，并将 VS 设置为将输出编译到该文件夹​​。它将派生类与接口 dll 和抽象实现 dll 一起复制到该文件夹​​。所以它使编译器感到困惑。我取出VS中项目的所有引用（我将它们更改为对“已编译”dll的引用），我自己编译每个dll，然后我只将我需要的dll复制到插件文件夹中，然后工作。无论如何，这个链接给了我一个关于这个问题的提示： [Dynamic Loading with Reflection](http://www.geocities.com/jeff_louie/OOP/oop13.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T16:10:59.760

过去我遇到过类似的情况，当您动态加载的 dll 引用包含基类的不同版本的 dll 时（`CountryBase`我猜是您的情况）。

# mysql - MySQL 查询优化

> ID：835568
> 
> 赞同：0
> 
> 时间：2009-05-07T16:03:40.340
> 
> 标签：mysql, optimization

我目前正在开发一个需要一些优化的网站......因为首页需要大约 15-20 秒才能加载，我认为一些优化会很好。

这是 MySQL 慢查询日志中出现的一个查询：

```
SELECT a.user,a.id
FROM `profil_perso` pp
INNER JOIN `acces` a ON pp.parrain = a.id
INNER JOIN `acces` ap ON ap.id = pp.id
WHERE pp.parrain_visibilite = '1'
  AND a.actif = 1
GROUP BY a.id
ORDER BY ap.depuis DESC LIMIT 15; 
```

在`profil_perso`（约 207K 行——包含电子邮件和个人资料）上`perso_id`，有主键，还有`id`（外键）+ `parrain`（引荐来源网址）+ `parrain_visibilite`（显示引荐来源网址）是索引。

`acces`那里是`id`主键，还有被索引的depuis（注册日期）

基准测试实际上表明了这一点：

第一次：1.94532990456
最后一次：1.94532990456
平均时间：0.0389438009262

我试着这样说：

```
SELECT DISTINCT a.id, a.user
FROM `profil_perso` pp
LEFT JOIN `acces` a ON pp.parrain = a.id
WHERE pp.parrain_visibilite = 1
  AND a.actif = 1
  AND pp.id != 0
ORDER BY pp.id DESC LIMIT 15; 
```

基准测试仍然显示：

第一次：1.96376991272
最后一次：1.96376991272
平均时间：0.0393264245987

任何降低查询时间的提示？

这是完整的索引：

访问：

```
id (primary)
derniere_visite -- last visit
pays_id -- country_id
depuis -- registration time
perso_id -- foreign key to profil_perso primary key
actif -- account status
compte_premium -- if account is premium 
```

profile_perso：

```
perso_id (primary)
id -- foreign key to acces primary key
genre -- gender
parrain_visibilite -- visibility of referer
parrain -- referer
parrain_contexte
telephone
orientation
naissance -- birthdate
photo -- if it has a picture 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T16:07:05.947

跑`EXPLAIN SELECT DISTINCT a.id .....;`

这将有助于向您显示可能缺少索引等的位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T16:12:03.983

为什么你有两个`JOIN`在这里？

在 上创建复合索引`acces (actif, depuis)`：

```
CREATE INDEX ix_acces_actif_depuis ON acces (actif, depuis) 
```

，在 上创建一个复合索引`profil_perso (parrain, parrain_visibilite)`：

```
CREATE INDEX ix_profilperso_parrain_parrainvisibilite ON profil_perso (parrain, parrain_visibilite) 
```

试试这个：

```
SELECT  a.user, a.id
FROM    acces a
JOIN    profil_perso p
ON      pp.parrain = a.id
        AND pp.parrain_visibilite = 1
WHERE   a.actif = 1
ORDER BY
        a.actif DESC, a.depuis DESC
LIMIT 15 
```

此查询将使用索引`actif`来避免排序，并使用索引`profil_perso`来查找和过滤掉不可见`parrain`的 's。

既然你有一个`LIMIT 15`here，这个查询应该是即时的。

这也将有助于了解您的`actif`领域的选择性。

要弄清楚这一点，请运行：

```
SELECT COUNT(DISTINCT actif) / COUNT(*)
FROM   acces 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T16:13:42.187

正确的回答者在很大程度上取决于数据的分布（记录数、字段的基数和字段组合等）和模式，以及查询表达式。即使有了这些信息，我们也只能提供测试建议，这只会导致更多的测试建议。

但是我们可以从涉及的表的模式开始第一次切割，加上当前 EXPLAIN 的结果（运行两次，第二次和第一次结果）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T16:15:48.127

一般来说，您需要确保正确设置您的索引 - 不仅针对主键，还针对表连接中使用的外键。

此外，通常最好为您过滤/订购的任何字段定义不合格 - 因此，再次确保这些设置正确。

但是，我认为这里对性能的重大影响可能是您正在对 207k 记录进行排序以检索最后插入的 15 条记录——您能以不同的方式实现同​​样的效果吗？

# linq - 使用 LINQ 进行编码是如何工作的？幕后会发生什么？

> ID：835569
> 
> 赞同：3
> 
> 时间：2009-05-07T16:03:58.717
> 
> 标签：linq, clr

例如：

```
m_lottTorqueTools = (From t In m_lottTorqueTools _
                     Where Not t.SlotNumber = toolTuple.SlotNumber _
                     And Not t.StationIndex = toolTuple.StationIndex).ToList 
```

这里发生了什么算法？后台是否有嵌套的 for 循环？它是否为这些字段构建了一个哈希表？我很好奇。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T16:09:56.783

查询表达式通常被翻译成扩展方法调用。（它们不一定*是*，但 99.9% 的查询使用`IEnumerable<T>`or `IQueryable<T>`。）

该方法所做的确切算法因方法而异。例如，您的示例查询不会使用任何哈希表，但连接或分组操作会使用。

简单的`Where`调用在 C# 中转换为类似的东西（使用迭代器块，据我所知，目前在 VB 中不可用）：

```
 public static IEnumerable<T> Where(this IEnumerable<T> source,
     Func<T, bool> predicate)
 {
     // Argument checking omitted
     foreach (T element in source)
     {
         if (predicate(element))
         {
             yield return element;
         }
     }
 } 
```

谓词作为委托（或表达式树，如果您正在使用`IQueryable<T>`）提供，并在序列中的每个项目上调用。结果是流式传输的，执行被延迟 - 换句话说，在您开始从结果中请求项目之前，什么都不会发生，即使这样，它也只会做它需要做的事情以提供下一个结果。一些操作符没有被延迟（基本上是返回单个值而不是序列的操作符）和一些缓冲输入（例如`Reverse`，必须读取到序列的末尾才能返回任何结果，因为它读取的最后一个结果是它必须屈服的第一个）。

恐怕要提供每个 LINQ 运算符的详细信息超出了单个答案的范围，但是如果您对特定问题有疑问，我相信我们可以提供帮助。

我应该补充一点，如果您使用 LINQ to SQL 或其他基于 的提供程序`IQueryable<T>`，情况就大不相同了。该类`Queryable`建立查询（在提供者的帮助下，它首先实现`IQueryable<T>`），然后查询通常由提供者翻译成更合适的形式（例如SQL）。确切的细节（包括缓冲、流媒体等）将完全取决于提供者。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T16:13:23.403

LINQ 通常在幕后发生了*很多事情。*对于任何查询，首先使用 an 将其转换为表达式树，`IQueryableProvider`然后通常将查询编译为 CIL 代码，并生成一个指向此函数的委托，您在调用查询时基本上都在使用该委托。这是一个极其简化的概述 - 如果您想阅读有关该主题的精彩文章，我建议您查看[*LINQ 的工作原理 - 创建查询*](http://aabs.wordpress.com/2006/12/15/how-linq-works-%E2%80%93-creating-queries/)。Jon Skeet 还在这个网站上发布了一个很好的答案来回答[这个问题](https://stackoverflow.com/questions/671235/how-linq-works-internally)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T16:13:10.457

发生的情况不仅取决于方法，还取决于使用的 LINQ 提供程序。在返回 an 的情况下，`IQueryable<T>`是 LINQ 提供程序解释表达式树并按照它喜欢的方式处理它。

# python - 我可以使用列表理解从文件中获取行索引吗？

> ID：835572
> 
> 赞同：0
> 
> 时间：2009-05-07T16:04:39.167
> 
> 标签：python, list-comprehension

我需要确定文件中某些标记可​​能存在的位置。我开始认为我会使用 list.index 但我很快发现它返回第一个（并且只有第一个）项目。所以我决定实施我自己的解决方案

```
count=0
docIndex=[]
for line in open('myfile.txt','r'):
    if 'mystring' in line:
        docIndex.append(count)
    count+=1 
```

但这是 Python 对的。必须有一个更简单的解决方案，因为它是 Python。在这个网站和网络上搜寻我想出了一些更好的东西

```
newDocIndex=[]
for line in fileinput.input('myfile',inplace=1):
    if 'mystring' in line:
    newDocIndex.append(fileinput.lineno()) 
```

我知道这是太多的信息，但自从我昨晚完成了评分期末考试后，我觉得很好——这是 Python，我们希望在今年夏天取得一些进展——让我们试试列表推导

所以我这样做了：

```
[fileinput.lineno() for line in fileinput.input('myfile',inplace=1) if 'mystring' in line] 
```

并得到一个空列表。所以我首先猜测问题是for中的项目必须是用于构建列表的项目。也就是说，如果我有 line 而不是`fileinput.lineno()`我会有一个非空列表，但这不是问题。

上述过程可以简化为列表理解吗？

使用答案但对其进行调整以提高可读性

```
listOfLines=[lineNumb for lineNumb,dataLine in enumerate(open('myfile')) if 'mystring' in dataLine] 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T16:07:15.573

那这个呢？

```
[index for index,line in enumerate(open('myfile.txt')) if 'mystring' in line] 
```

# delphi - Delphi 是否有“getopt”的实现？

> ID：835573
> 
> 赞同：13
> 
> 时间：2009-05-07T16:04:39.713
> 
> 标签：delphi, parsing, com

在 C/C++ 中使用 getopt() 解析命令行参数并不容易。

德尔福有类似的吗？或者理想情况下，使用相同的语法？我知道 Delphi 支持 FindCmdLineSwitch 和 ParamStr()，但它们仍然需要一些额外的解析。

我想要像 C 中的 getopt() 这样工作的东西。可以轻松实现基本切换开关以及在切换后捕获值的东西。请参阅下面的一些示例 C 代码以了解我在说什么：

```
void print_help()
{
        printf("usage:\n") ;
        printf("\t\t-i set input file\n") ;
        printf("\t\t-o set output file\n") ;
        printf("\t\t-c set config file\n") ;
        printf("\t\t-h print this help information\n") ;
        printf("\t\t-v print version\n") ;
}
 char* input_file = NULL ;
        char *query=NULL;
          char opt_char=0;
        while ((opt_char = getopt(argc, argv, "i:q:vh")) != -1)
        {
                switch(opt_char)
                {
                        case 'h':
                                print_help();
                                exit(-1);
                                break;
                        case 'v':
                                print_version() ;
                                exit(-1) ;
                                break ;
                        case 'i':
                                input_file= optarg ;
                                break ;
                        case 'q':
                                query= optarg ;
                                break ;
                        default:
                                print_help();
                                exit(-1);
                                break;
                }
        } 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-07T17:54:56.920

FPC RTL的**[getopts.pp](http://svn.freepascal.org/cgi-bin/viewvc.cgi/trunk/rtl/inc/getopts.pp?view=markup)**文件是实现 getopt 的自包含 Delphi（包括 Delphi2009）兼容单元：

> Free Pascal 的 Getopt 实现，仿照 GNU getopt

该[单元](http://svn.freepascal.org/cgi-bin/viewvc.cgi/trunk/rtl/inc/getopts.pp?view=markup) 在 FPC SVN 存储库中可用。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-07T16:24:39.867

有一个实现TGetOpt，声称

> 为 Delphi 实现一个 getopt 变体。它几乎与 POSIX 兼容，支持长选项、必需、可选和无参数

你可以在[这里](http://stefan.huberdoc.at/comp/software/delphi/sandkasten.html)找到它。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-08-20T01:58:48.697

请参阅此 EDN 文章[http://edn.embarcadero.com/print/40404](http://edn.embarcadero.com/print/40404)中描述的 TCommandParser，可从 CodeCentral [http://cc.embarcadero.com/item/27574](http://cc.embarcadero.com/item/27574)下载。TCommandParser 现在也应该包含在 Delphi 演示中。在我离开之前，我将代码免费提供给 Embarcadero，所以希望他们能在某个时候将它包含在框架中或类似的东西中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-07T16:27:32.433

没有内置任何东西 - 但你可以很容易地制作一个。这应该接近你习惯的

```
TsoCommandLineParser = class
private
  fArguments:TStringList;
public
  constructor Create();
  destructor Destroy(); override;

  function GetOpt(const pArgument:string; const pDefaultValue:string = ''):string;
end;

constructor TsoCommandLineParser.Create();
var
  i:Integer;
begin
  inherited Create();
  fArguments := TStringList.Create();
  for i := 1 to ParamCount() do
  begin
    fArguments.Add(ParamStr(i));
  end;
end;

destructor TsoCommandLineParser.Destroy();
begin
  fArguments.Free();
  inherited Destroy();
end;

function TsoCommandLineParser.GetOpt(const pArgument:string; const pDefaultValue:string = ''):string;
var
  i:Integer;
begin
  i := fArguments.IndexOfName(pArgument);
  if i > -1 then
  begin
    Result := fArguments.ValueFromIndex[i];
  end
  else
  begin
    Result := pDefaultValue;
  end;
end; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-07T16:47:34.087

SysUtils 单元中的 FindCmdLineSwitch 有什么问题？

```
if FindCmdLineSwitch('h',['-'],false) then
  Print_Help();
if FindCmdLineSwitch('v',['-'],false) then
  print_Version(); 
```

您将不得不遍历参数以获取值，但这很简单：

```
if FindCmdLineSwitch('f',['-'],false) then
  for ix := 1 to paramcount do
    if (paramStr(ix) = '-f') and (ix < paramcount) then
      begin
        if fileExists( ParamStr(ix+1) ) then
          filename := ParamStr(ix+1);
        break;
      end 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-12-20T06:33:16.810

还有一个与此问题相关的名为[delphi-argparse的新解析器。](https://github.com/tokibito/delphi-argparse)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-12-15T13:55:02.530

Delphi 的基于属性的解析器可以在[这里](http://www.thedelphigeek.com/2014/12/attribute-based-command-line-parsing.html)找到。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T16:47:32.277

有最近开源的“Gastown Delphi Command Line Parser”（例如[在 Torry's 上](http://www.torry.net/quicksearchd.php?String=gastown)）。我从未使用过它，所以我无法评论它。

# project-management - 作为一个团队编码

> ID：835576
> 
> 赞同：2
> 
> 时间：2009-05-07T16:05:12.690
> 
> 标签：project-management

可以说我和我的朋友正在尝试开发同一个软件项目。我们不在同一地点，但我们希望尽可能多产。

我们使用的是 Visual Studio 2005，代码必须用 C/C++ 编写，此时我们使用 zip 文件发送代码。

我的问题是：

1）应该使用什么方法共享代码以提高生产力。

2) 有什么免费的在线平台可以做到这一点吗？

3）您对我们有什么建议吗？

ps：我拥有一个带有 linux 主机的网络服务器帐户。我可以在该服务器上安装什么以改善我们的工作状态。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T16:08:23.010

源代码控制服务器、ala svn 服务器或任何您喜欢的服务器。

您可以提交代码，然后您的朋友可以根据您的更改更新他的代码，而无需发送或接收电子邮件。大多数源代码控制套件也具有内置的合并处理功能，因此您可以看到他所做的更改并解决与您所做的任何更改的任何冲突。

**更新**
人们已经开始推荐一些好的在线源代码控制，所以我也会添加[其他](https://stackoverflow.com/questions/35465/easy-simple-online-source-control)[问题的](https://stackoverflow.com/questions/568792/what-are-some-online-solutions-for-easily-accessing-my-source-code-from-anywhere)[链接](https://stackoverflow.com/questions/216349/online-private-source-control-system)，以供在线源代码控制主机使用。也看看那些。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T16:17:29.743

除了已经提到过几次的版本控制之外，您还应该研究一下项目管理工具，例如 Redmine( [http://www.redmine.org/](http://www.redmine.org/) ) 或 Trac( [http://trac.edgewall.org /](http://trac.edgewall.org/)）。

我发现它确实可以帮助提高团队的效率，尤其是当面对面开会并不总是一种选择时。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T16:12:17.510

使用版本控制软件。免费颠覆托管列表：

*   [http://www.straw-dogs.co.uk/09/20/6-free-svn-project-hosting-services/](http://www.straw-dogs.co.uk/09/20/6-free-svn-project-hosting-services/)
*   [http://cplus.about.com/b/2007/07/24/free-subversion-hosting-for-small-projects.htm](http://cplus.about.com/b/2007/07/24/free-subversion-hosting-for-small-projects.htm)

您还可以找到更多 googleling。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T16:22:13.553

除了源控制之外，您还可以注册免费的托管问题跟踪工具，例如[bughost.com](http://bughost.com/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T16:08:39.547

为了立即获胜，任何类型的版本控制系统。

在 Linux 上安装和设置 subversion，如果您想将 AnkhSVN 与 Visual Studio 或 TortoiseSVN 集成以进行 Windows 资源管理器集成，请获取它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-07T16:09:13.133

我使用托管在 Dreamhost 上的颠覆存储库来进行协作项目。Dreamhost 的托管不是免费的，但相对便宜 - 每年 100 美元左右。我认为 SO 播客听众也有折扣。

您还可以在家中或办公室设置自己的颠覆服务器。在 Linux 机器上最容易做到，但我也在使用 cygwin 的 Windows 2000 Server 机器上做过。这里有一个很好的教程：http: [//www.coderhaus.com/?p= 8](http://www.coderhaus.com/?p=8)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-07T16:30:05.737

我在 Git 和 GitHub 方面有很好的体验。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T16:10:48.607

我真正推荐你的第一件事是使用源代码控制，[Subversion](http://subversion.tigris.org/)可以是一个非常好的选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-07T16:11:56.717

除了前面所说的之外，您可能还想查看[分布式 VCS](http://en.wikipedia.org/wiki/Distributed_revision_control)。例如，[GIT](http://git-scm.com/)或[Mercurial](http://www.selenic.com/mercurial/wiki/)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-07T16:13:29.677

[您可以在Beanstalk](http://www.beanstalkapp.com/)上免费设置 1 个 svn 存储库和最多 3 个用户。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-07T21:55:49.477

根据您的描述，我认为 git 作为源代码控制工具非常适合您。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-08T21:02:49.713

我的建议是

1.  使用 D-VCS，例如 git 或 Mercurial。它是为分布式团队设计的。
2.  使用大本营等项目管理工具来管理您的项目。
3.  定期互相交谈。设置 Skype，如果可能的话，每天尝试沟通一到两次。电子邮件有时不是有效的沟通媒介。

# sql-server - 使用 log4net 记录到 XML 列

> ID：835583
> 
> 赞同：3
> 
> 时间：2009-05-07T16:06:24.840
> 
> 标签：sql-server, xml, log4net

是否可以使用 log4net 中的 AdoNetAppender 登录到 SQL Server 中的 XML 列？

我知道我可以将该列视为一个字符串并通过以下方式记录：

```
<parameter>
    <parameterName value="@details" />
    <dbType value="String" />
    <size value="4000" />
    <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%property{Details}" />
    </layout>
</parameter> 
```

但是，我宁愿使用以下方式登录：

```
<parameter>
    <parameterName value="@details" />
    <dbType value="Xml" />
    <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%property{Details}" />
    </layout>
</parameter> 
```

不幸的是，这似乎不起作用。

我宁愿使用实际的数据库类型进行日志记录，而不是利用我*可以*只使用字符串的事实。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:19:16.260

DbType.Xml枚举值是在 .Net 2.0 中引入的[。](http://msdn.microsoft.com/en-us/library/system.data.dbtype(VS.80).aspx)在仔细检查了[如何将 DBType.Xml 与 ADO.NET 一起使用之后，](http://msdn.microsoft.com/en-us/library/ms971534.aspx)似乎将数据传递到 XML 列的最佳方法实际上是将数据作为字符串传递。

# artificial-intelligence - 神经网络的正确性

> ID：835585
> 
> 赞同：14
> 
> 时间：2009-05-07T16:07:08.897
> 
> 标签：artificial-intelligence, neural-network

我已经问过其他 AI 专家这个问题，但我还没有真正得到让我满意的答案。

对于以前编写过人工神经网络的其他人，您如何测试其正确性？

我想，另一种说法是，如何调试神经网络背后的代码？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-07T16:18:20.913

对于神经网络，通常发生的事情是您使用未经训练的神经网络，并使用给定的数据集对其进行训练，以便它以您期望的方式响应。这是交易；通常，您会将其训练到您的输入的某个置信水平。通常（同样，这只是一般情况；您的里程可能会有所不同），您无法让神经网络始终提供正确的答案；相反，您正在对正确答案的**估计值**在一个置信范围内。您可以通过您如何训练网络来了解置信度范围。

问题是如果你不能确定神经网络得出的结论是可验证的正确的，你为什么要使用神经网络？答案是神经网络可以在线性时间内为某些类别的问题（特别是 NP-Complete 问题）得出高置信度的答案，而 NP-Complete 问题的可验证正确解只能在多项式时间内得出。通俗地说，神经网络可以“解决”普通计算无法解决的问题；但你只能有一定的百分比确信你有正确的答案。您可以通过训练方案确定这种信心，并且通常可以确保您至少有 99.9% 的信心。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-07T16:21:34.697

在大多数“软计算”中，正确性是一个有趣的概念。我能告诉你的最好的就是：“当神经网络始终满足其设计参数时，它就是正确的。” 为此，您可以使用数据对其进行训练，然后使用其他数据进行验证，并在中间设置一个反馈循环，让您知道神经网络是否正常运行。

当然，这仅适用于无法直接证明正确性的足够大的神经网络。如果您尝试构建学习 XOR 或类似事物的神经网络，则可以通过分析*证明*神经网络是正确的，但对于这类问题，很少需要人工神经网络。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T16:38:29.367

你在这里打开了一罐比你想象的更大的蠕虫。

顺便说一下，NN 可能最好被认为是通用函数逼近器，它可以帮助您思考这些东西。

无论如何，就您的问题而言，NN 没有什么特别之处，该问题适用于任何类型的学习算法。

你对它给出的结果的信心将取决于你所拥有的训练数据的数量和质量（通常更难确定）。

如果你真的对这些东西感兴趣，你可能想了解一下过度训练和集成方法（bagging、boosting 等）的问题。

真正的问题是，您通常对您已经看到的给定输入的答案的“正确性”（cf质量）实际上并不感兴趣，而是您关心预测您没有输入的答案的质量'还没有看到。这是一个困难得多的问题。然后，典型的方法涉及“保留”您的一些训练数据（即您知道“正确”答案的内容）并针对它测试您训练有素的系统。然而，当你开始考虑你可能没有足够的数据，或者它可能有偏见等等时，它变得微妙了。所以有很多研究人员基本上把所有的时间都花在了思考这些问题上！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T16:25:47.587

我从事过有测试数据和训练数据的项目，所以你知道 NN 没有看到的一组输入的预期输出。

分析任何分类器结果的一种常见方法是使用 ROC 曲线。可以在[解释诊断测试中找到分类器和 ROC 曲线的统计介绍](http://gim.unmc.edu/dxtests/Default.htm)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T16:17:11.040

我是这个领域的一个完全的业余爱好者，但你不使用你知道是正确的预先确定的数据集吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-07T19:54:09.130

我不相信有一个正确的答案，但有一些经过充分验证的概率或统计方法可以提供保证。统计方法通常称为[重采样](http://en.wikipedia.org/wiki/Resampling_(statistics))。

我可以推荐的一种方法是[Jackknife](http://en.wikipedia.org/wiki/Resampling_(statistics)#Jackknife)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-27T13:11:45.663

我的老师总是说他的经验法则是用 80% 的数据训练 NN，并用另外 20% 的数据进行验证。当然，还要确保数据集尽可能全面。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-01T22:20:13.153

如果你想知道网络的反向传播是否正确，有一个简单的方法。

由于您计算了错误情况的导数，因此您可以检查您的实现在数字上是否正确。您将计算误差相对于特定权重的导数，∂E/∂w。你可以证明

∂E/∂w = (E(w + e) - E(w - e)) / (2 * e) + O(e^2)。

（Bishop，机器学习和模式识别，第 246 页）

本质上，您评估权重左侧的误差，评估权重右侧的误差并检查数值梯度是否与分析梯度相同。

（这是一个实现：http: [//github.com/bayerj/arac/raw/9f5b225d6293974f8adfc5f20dfc6439cc1bed35/src/cpp/utilities/utilities.cpp](http://github.com/bayerj/arac/raw/9f5b225d6293974f8adfc5f20dfc6439cc1bed35/src/cpp/utilities/utilities.cpp)）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-13T06:25:19.923

对我来说，可能只有一个值需要额外的努力来验证，即反向传播的梯度。我认为拜耳的答案实际上是常用和建议的。您需要为此编写额外的代码，但所有代码都是前向传播矩阵乘法，易于编写和验证。

还有一些其他问题会阻止您获得最佳答案，例如：

*   NN 的成本函数不是凹的，因此不能保证您的梯度下降找到全局最优值。
*   过拟合/欠拟合
*   没有选择“正确”的功能/模型
*   ETC

但是我认为它们超出了编程错误的范围。

# email - 最不麻烦的电子邮件格式

> ID：835588
> 
> 赞同：3
> 
> 时间：2009-05-07T16:07:44.243
> 
> 标签：email, email-spam

有没有人有理由/偏好从网站发送电子邮件回复的最佳格式（付款确认/密码提醒等）？

谢谢

乔恩

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-07T16:11:35.623

在您的电子邮件中，使用带有 HTML 页面链接的纯文本。电子邮件中的 HTML 通常被广泛谴责为一个坏主意，因为它是一个巨大的安全漏洞。

永远不要在电子邮件中发送密码，即使是作为提醒。向用户注册的电子邮件地址发送一个链接，允许他们重置密码。让我退出使用您的服务的绝对最快的方法是通过电子邮件以纯文本形式向我发送密码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T16:21:05.977

纯文本。没有.html。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T17:43:20.380

请格式化纯文本。我的办公室目前使用的系统，我与设计无关，向客户发送看起来很专业的格式化纯文本电子邮件，在电子邮件客户端中加载速度很快，并且打印出来的效果与屏幕上的一样。HTML 不仅是一个安全漏洞，它还可以真正减慢电子邮件下载/打开过程，具体取决于包含多少无关内容（背景颜色、图像等）。此外，几乎可以保证纯文本在屏幕上显示时打印出来，而 HTML 可能会出现问题。

对于密码，正如 McWafflestix 所说，不要将密码发送到电子邮件地址。解决忘记密码的一种方法是在您的网站上创建一个模块，该模块向用户发送一封电子邮件，其中包含确认他们忘记并需要重置密码的链接，然后让他们回答他们创建的秘密问题。确认身份后，向他们发送一封电子邮件，其中包含新的临时密码和登录链接——一旦他们单击链接并输入临时密码，让用户输入新的个人密码。

# c++ - std::ostringstream 如何转换为布尔值？

> ID：835590
> 
> 赞同：4
> 
> 时间：2009-05-07T16:08:11.840
> 
> 标签：c++, casting, stream, boolean, ostringstream

我偶然发现了这段代码。

```
 std::ostringstream str;
    /// (some usage)
    assert( ! str ); 
```

在上下文**`ostringstream`**中使用时意味着什么？**`bool`**

这可能是编译和运行时发生的错误用法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-07T16:12:19.100

它告诉您流当前是否有效。这是所有流都可以做的事情。例如，如果文件未正确打开，则文件流可能无效。

作为旁注，此功能（将流测试为布尔值）是通过`explicit operator bool` *在 C++11 及更高版本中重载以及**在 C++11 之前*的版本中重载`void*`强制转换运算符来实现的。

 *这是一个链接，其中包含[一些流可能失败的示例](http://www.cppreference.com/wiki/io/fail "cppreference.com 上的流失败")。这并不特定于字符串流，但它确实适用于它们。

**编辑：**`bool`在`void*`Martin York 指出我的错误之后改为。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T17:12:29.080

供参考：[ostringstream::operator void*()](http://www.cplusplus.com/reference/iostream/ios/operator_voidpt/)和[ostringstream::operator!()](http://www.cplusplus.com/reference/iostream/ios/operatornot/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T16:13:28.473

该表达式有效并评估流的状态。此功能更常用于输入流：

```
istringstream is;
is.str( "foo" );
int x;
is >> x;

if ( ! is ) {
   cerr << "Conversion failed";
} 
```

我不确定任何标准流函数如何导致 ostringstream 变坏，但您当然可以自己编写一个。

# ironpython - 在 Asp.Net 中使用 Iron Python 时 ExtensionAttribute 的模糊参考

> ID：835592
> 
> 赞同：49
> 
> 时间：2009-05-07T16:08:27.910
> 
> 标签：ironpython, dynamic-language-runtime

启动使用程序集的 Asp.Net 站点时出现以下错误，该程序集又使用 dlr 和 Iron Python 进行脚本编写。

> BC30560：“ExtensionAttribute”在命名空间“System.Runtime.CompilerServices”中不明确。

这个问题似乎是已知的，并且在[问题跟踪器](http://www.codeplex.com/IronPython/WorkItem/View.aspx?WorkItemId=19126)中有一个解决方法。

然而，它说他们...

> ...希望在下一个版本中不需要此解决方法。

最新版本（我正在使用的版本）比报告中提到的版本晚。我还尝试下载问题跟踪器中提供的文件并替换当前版本中的文件，但这也不起作用。

除了下载源代码并手动构建之外，还有其他解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-01-15T20:52:06.770

该错误似乎只是由于报告附带的 DLL 而被关闭，所以我认为答案是“不，没有更好的方法”。

不过，我问了这个错误，如果问题仍然存在，为什么它会关闭。

# asp.net - 如何使用替代配置设置发布 ASP.NET 网站

> ID：835595
> 
> 赞同：1
> 
> 时间：2009-05-07T16:08:48.657
> 
> 标签：asp.net

我正在将 Web 项目作为网站而不是 Web 应用程序进行工作。如何根据托管位置使用不同的配置文件，因此本地版本使用我的本地 SQL 安装，但发布的版本使用实时数据库？例如 connectionStrings.config 被忽略（未发布），connectionStrings.live.config 发布为 connectionStrings.config

我看到一个策略文件选项，那能做到这一点吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T16:20:43.073

对不同的构建使用 MSBuild 或 NAnt 脚本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T16:28:52.133

对此有几种选择。最简单的是使用 Web 部署项目。ScottGu 的[帖子](http://weblogs.asp.net/scottgu/archive/2008/01/28/vs-2008-web-deployment-project-support-released.aspx)对此进行了更详细的介绍。

对于较大的项目，您将需要 Nant 或 MSBuild 和 CruiseControl 或 TeamBuild 之类的东西。

不久前，我还在这里发布[了一些](https://stackoverflow.com/questions/428573/managing-complex-web-config-files-between-deployment-environments/435082#435082)关于支持复杂配置部署的内容

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T16:28:04.353

您可以使用 Web 部署项目。查看 ScottGu 的[博客文章](http://weblogs.asp.net/scottgu/archive/2008/01/28/vs-2008-web-deployment-project-support-released.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T16:15:08.550

构建后交换配置的事件？

根据您的构建配置，您可以有不同的构建后事件，如果需要，每个都可以复制不同的配置。

# c# - Asp.Net 在运行存储过程时出现超时错误

> ID：835596
> 
> 赞同：1
> 
> 时间：2009-05-07T16:09:00.623
> 
> 标签：c#, asp.net, sql-server-2005

我正在使用 asp.net、.NET 3.5、C# 和 SQL Server Express 2005。

我在 SQL 中创建了一个存储过程，当我从 SQL 服务器运行 SP 时，返回结果的时间不到 1 秒。我还在查询分析器中尝试过该查询，它也在不到 1 秒的时间内给了我结果。但是当我尝试从 .NET (C#) 调用这个 SP 时，需要很长时间，然后给出超时错误。

这是我用来调用存储过程的代码：

```
SqlConnection con = new SqlConnection();

con.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings["ConnectionString"].ConnectionString;
con.Open();

SqlCommand command = new SqlCommand("spReport_SiteUsage_KP", con);

command.CommandType = CommandType.StoredProcedure;

command.Parameters.Add(new SqlParameter("@fromDate", SqlDbType.DateTime));

command.Parameters.Add(new SqlParameter("@toDate", SqlDbType.DateTime));

command.Parameters[0].Value = Convert.ToDateTime(DatePicker1.SelectedDate.ToShortDateString());

command.Parameters[1].Value = DatePicker2.SelectedDate;

int i = command.ExecuteNonQuery();

con.Close(); 
```

存储程序：

```
set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[spReport_SiteUsage_KP]
    @fromDate datetime = null,
    @toDate datetime = null
AS
    truncate table dbo.RPT_SiteUsage

IF (@FromDate is not null and @ToDate is not null) --Hourly Report, grouped by hour
Begin   

    insert into RPT_SiteUsage 
    select '' as ReportType, 
    'Site Usage for '+ datename(mm,@fromDate)+' '+datename(dd,@fromDate)+', '+datename(yy,@fromDate) + 
    ' To '+datename(mm,@toDate)+' '+datename(dd,@toDate)+', '+datename(yy,@toDate) as ReportTitle,
    min(@fromDate) as FromDate,max(@toDate) as ToDate,
    isnull(count(s.SessionId),0) VisitsTotal,
    isnull(count(distinct(s.cookieid)),0) VisitsUnique,
    isnull(sum(PagesVisited),0) PageViews, 
    isnull(round(avg(convert(decimal(10,2),PagesVisited)),2),0) PagePerVisit,  
    isnull(min(PagesVisited),0) MinNoPageViews, 
    isnull(max(PagesVisited),0) MaxNoPageViews,
    isnull(round(avg(convert(decimal(10,2),TimeInSiteMinutes)),2),0) AvgTimeInSite, 
    isnull(min(TimeInSiteMinutes),0) MinTimeSpent, 
    isnull(max(TimeInSiteMinutes),0) MaxTimeSpent, 
    isnull(sum(NewPeople),0) as NewVisitors
    from
    dbo.UMM_UserAction ua inner join dbo.UMM_Session s on ua.SessionId=s.Sessionid
    left join
        (select ua.sessionId, datediff(ss,min(Actiondate),max(Actiondate))/60 TimeInSiteMinutes
         from dbo.UMM_UserAction ua
         where ActionDate between @fromDate and @toDate
         group by ua.sessionid
         ) sessionTime on ua.sessionId = sessionTime.sessionid
    left join
        (select ua.sessionId, 0 as NewPeople
        from dbo.UMM_UserAction ua 
            inner join dbo.UMM_Session s on ua.SessionId=s.SessionId
            inner join dbo.UMM_Cookie c on s.CookieId=c.CookieId
            where ua.actiondate< @fromDate --this is the from date
        group by UserId,ua.sessionId    
         ) Old on ua.sessionId = Old.sessionid
    left join
        (select ua.sessionId,count(distinct(uaP.PageEntryId)) as PagesVisited
        from dbo.UMM_UserAction ua,
        dbo.UMM_UserActionPageReview uaP 
        where ua.UserActionId=uaP.UserActionId
        and ActionDate between @fromDate and @toDate
        group by ua.sessionId
        )pVisited on ua.sessionId = pVisited.sessionId
    where ActionDate between @fromDate and @toDate

    IF (select count(*) from RPT_SiteUsage)=0
        insert into RPT_SiteUsage 
        select '(1 day)' as ReportType, 
        'Site Usage for '+datename(mm,@fromDate)+' '+datename(dd,@fromDate)+', '+datename(yy,@fromDate) + 
        ' To '+datename(mm,@toDate)+' '+datename(dd,@toDate)+', '+datename(yy,@toDate) as ReportTitle,
        min(@fromDate) as FromDate,max(@toDate) as ToDate,
        0 as VisitsTotal,
        0 as VisitsUnique,
        0 as PageViews, 
        0 as PagePerVisit,  
        0 as MinNoPageViews, 
        0 as MaxNoPageViews,
        0 as AvgTimeInSite, 
        0 as MinTimeSpent, 
        0 as MaxTimeSpent, 
        0 as NewVisitors

END 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T17:23:15.560

另一个想法，每个 SqlCommand 的 TimeOut 也是单独控制的，因此，您可以使用 CommandTimeOut 属性来控制它。

```
command.CommandTimeout = 120; 
```

但是，我会检查执行计划，看看它在哪里浪费或占用数据库资源，我建议这只是为了实验，而不是在生产中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T16:12:23.563

好吧-我会说您的连接字符串中有错误。请检查一下。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T16:12:49.660

如果查询返回错误需要很长时间，则您的连接（字符串）可能有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T16:44:13.080

proc 上缓存的查询计划不好可能是一个有趣的问题。特别是如果 proc 的胆量就像 Query Analyzer 中的 Query 运行良好。查看此链接以了解如何解决这种情况：[http ://www.mssqltips.com/tip.asp?tip=1304](http://www.mssqltips.com/tip.asp?tip=1304)

# css - CSS视觉轻弹

> ID：835599
> 
> 赞同：0
> 
> 时间：2009-05-07T16:09:19.047
> 
> 标签：css

我的 CSS 知识非常有限，所以我把我的问题放在这里希望最好。

我在我的网站中使用这个框：[http](http://www.456bereastreet.com/lab/flexible_custom_corners_borders/) ://www.456bereastreet.com/lab/flexible_custom_corners_borders/ ，我需要以两列格式显示内容。

我尝试使用简单的表格，并使用带有浮动集的 div（需要 clearfix 以便父级得到它的高度）。我的问题是出现在左侧的视觉错误。

仅在 table 和 div 浮动时发生。p、h1 等工作正常。

这是错误的图片：http: [//img18.imageshack.us/img18/8783/imagem2hdp.png](http://img18.imageshack.us/img18/8783/imagem2hdp.png)

谢谢

编辑：这是代码：[http ://dl.getdropbox.com/u/178438/css_test.zip](http://dl.getdropbox.com/u/178438/css_test.zip)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T16:47:26.177

您应该设置背景颜色，`.content`这将隐藏边框图像的那部分。

--在下面编辑--

渐变和边框之间的额外空白*看起来*像是一个元素被推到一边，而它实际上是左边框背景​​图像的一部分，即第二个主 div。

```
div // Right border
    div // Top border with corner sub divs
    div // Left border
        div // Content
    div // Bottom border with corner sub divs 
```

由于框的内容部分在左边框 div 内，并且边框背景图像是 sprite 样式，将多个图像放在一个更大的图像中，唯一的 CSS 解决方案是将背景颜色应用于内容区域以覆盖左背景图像（就像左背景 div 对右背景 div 所做的那样）

还有其他方法可以解决此问题，例如将图像分离到单独的文件中或将内容 div 移到左边框 div 之外，但此时您不再真正使用同一个框。

# sharepoint - 在 Sharepoint 2007 中更改网站的语言？

> ID：835600
> 
> 赞同：1
> 
> 时间：2009-05-07T16:09:19.623
> 
> 标签：sharepoint, sharepoint-2007

我一直在我的开发机器上工作，并安装了英文版的 Sharepoint。因此，我创建并正在使用的网站以英语显示，我也创建了不同语言的变体（西班牙语、加泰罗尼亚语、巴斯克语、加利西亚语）。现在我意识到英语的管理部分应该是西班牙语。

我不知道如何更改语言，我在[论坛](http://www.sharepointblogs.com/mirjam/archive/2008/04/29/changing-the-language-of-an-existing-sharepoint-site.aspx)中看到了以下答案：

> 更新 dbo.Webs 设置语言 = 3082

这解决了语言的问题，网站的管理部分以西班牙语显示，但是当我进入变体标签部分时，它给了我一个错误。

谁能告诉我解决方案，或者我必须更改哪个表中的哪一列（我知道不推荐）？

哪个表保​​存了有关变化的信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:14:05.697

您在修改数据库时应该非常小心……不仅不推荐这样做，而且还会使您的 SharePoint 环境不受 Microsoft 支持。好笑，其他不多。

因此，为了给您正式的答案，如果不重新创建网站，您将无法做您正在尝试的事情。引用[Deploy 语言包 (Office SharePoint Server)](http://technet.microsoft.com/en-us/library/cc262108.aspx)：

> ...为网站或网站集选择特定语言的网站模板后，网站或网站集将始终以原始网站模板的语言显示内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T16:14:32.513

没有 where 子句的更新 - 您可能刚刚将所有变体设置为使用相同的语言。

您还会遇到用英语创建密钥的问题，并且在您进行更改后，它会搜索西班牙语的密钥。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-09T17:20:19.020

请查看我们的 MOSS 多语言解决方案 [http://www.alphamosaik.com/Pages/Solutions_EN_MultilingualModule.aspx](http://www.alphamosaik.com/Pages/Solutions_EN_MultilingualModule.aspx)

问候

阿尔法马赛克

# javascript - 如何使用javascript截断HTML编码的文本而不截断编码的字符

> ID：835604
> 
> 赞同：0
> 
> 时间：2009-05-07T16:09:48.250
> 
> 标签：javascript, client-side, client-side-scripting

我需要为网页编写一些客户端javascript，当触发按钮的onclick事件时，将截断div内的文本（按钮的目的是让用户可以在完整版本和截断版本之间切换显示的文本）。文本中不会有任何 HTML 标签，但可能会有 HTML 编码的字符，例如 " 和 &

有没有比必须对字符串进行 HTML 解码、截断和再次编码更好的方法？

这似乎是之前已经完成的一项相当普遍的任务。我对 JavaScript 没有那么丰富的经验，所以我不知道是否有比编码/解码更好的方法来使用 javascript。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T16:31:21.257

解码，截断然后编码是有意义的。解码后，字符串中的信息将针对任务进行标准化。

编写一个支持 HTML 的字符串截断函数似乎是错误的方法。

# vb.net - 禁用页面缓存以使用浏览器后退按钮强制页面加载

> ID：835605
> 
> 赞同：14
> 
> 时间：2009-05-07T16:09:56.330
> 
> 标签：vb.net, browser, caching, http-headers

我有一个asp.net 网站，该网站正在使用我无法从服务器重新加载的页面上的更新面板。我有这个用于母版页上的禁用页面缓存。

```
 Response.Cache.SetExpires(DateTime.UtcNow.AddDays(-1))
     Response.Cache.SetValidUntilExpires(False)
     Response.Cache.SetRevalidation(HttpCacheRevalidation.AllCaches)
     Response.Cache.SetCacheability(HttpCacheability.NoCache)
     Response.Cache.SetNoStore() 
```

当我单击浏览器返回按钮返回页面时，它说页面已过期。我网站上的其他页面工作并调用页面加载，我找到但无法使用的唯一解决方案是在更新面板中 wrp 整个页面，但我不能这样做，因为我在页面上有一个报告查看器不适用于ajax。如果有人可以提供帮助，我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-01-23T14:49:33.863

这不是浏览器缓存问题；这是一个回发。您必须实施 Post/Redirect/Get 模式以避免“您要再次提交吗？/页面已过期”消息。

[http://en.wikipedia.org/wiki/Post/Redirect/Get](http://en.wikipedia.org/wiki/Post/Redirect/Get)

这件事的典型例子是网页有一个保存按钮，可以在数据库中插入一些东西。单击“保存”按钮 -> 发生回发 -> 代码在表中插入一行 -> 用户引用页面 (F5) -> 再次发生回发 -> 代码再次插入同一行。

为避免前面示例中的双重插入，您需要在按下“保存”按钮时重定向，然后才执行插入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-22T16:45:50.650

只需将其添加到标题部分的视图文件中：

```
<head>
<script language="JavaScript">
<!--
javascript:window.history.forward(1);
//-->
</script>
</head> 
```

在正文标签内添加以下内容：

```
<body onUnload="OperaReload()">
<input type="hidden" id="refreshed" value="no"> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-19T10:22:27.717

要使用 JavaScript 重新加载页面，请使用以下命令：

```
window.location.replace(window.location.pathname); 
```

# ios - 如何更改后退按钮上的文本

> ID：835607
> 
> 赞同：90
> 
> 时间：2009-05-07T16:09:58.547
> 
> 标签：ios, iphone, cocoa-touch, uinavigationitem

默认情况下，后退按钮使用视图控制器的标题作为其上的文本。我可以在不更改视图控制器标题的情况下更改后退按钮上的文本吗？我需要这个，因为我有一个视图控制器，它的标题太长而无法显示，在这种情况下，我想只显示“返回”作为后退按钮的标题。

我尝试了以下不起作用：

```
self.navigationItem.leftBarButtonItem.title = @"Back"; 
```

谢谢。

* * *

## 回答 #1

> 赞同：167
> 
> 时间：2009-05-07T16:39:23.543

尝试

```
self.navigationItem.backBarButtonItem = [[[UIBarButtonItem alloc] initWithTitle:@"Back" style:UIBarButtonItemStylePlain target:nil action:nil] autorelease]; 
```

我通过查看Apple 的[UINavigationItem](https://developer.apple.com/documentation/uikit/uinavigationitem?language=objc)文档中的[backBarButtonItem](https://developer.apple.com/documentation/uikit/uinavigationitem/1624958-backbarbuttonitem?language=objc)文档发现了这一点。

* * *

## 回答 #2

> 赞同：97
> 
> 时间：2009-05-10T00:19:44.783

Marc W 的方法在我确定将其应用于哪个控制器后效果很好：重新命名的控制器，而不是顶部的控制器。因此，如果这是导航堆栈：

```
(bottom)  ControllerA -> ControllerB  (top) 
```

...并且您想在**ControllerB 位于 top**时显示的后退按钮中为 ControllerA 提供更短的标题，您将属性更改应用于**ControllerA**。

所以它更多的是在上下文中`self.title`，而不是像其他左/右栏按钮设置器。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2011-12-18T22:01:53.253

您可以在情节提要中进行。找到你想要返回的视图控制器（带有长标题的那个），选择它的导航项，然后打开属性检查器（Alt+Cmd+4），插入自定义的后退按钮标题。

![在此处输入图像描述](https://i.stack.imgur.com/2n9bo.png)

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2010-04-27T14:06:31.933

谢谢马可...这对我有帮助...

这就是我所做的。

如果您使用 tableView 导航到不同的视图...输入代码：

```
self.navigationItem.backBarButtonItem = [[[UIBarButtonItem alloc] initWithTitle:@"Back" style:UIBarButtonItemStylePlain target:nil action:nil] autorelease]; 
```

在你的`didSelectRowAtIndexPath`方法中......第一个控制器......控制器A。

当您导航到控制器 B 时，按钮的标题将是“返回”。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2010-07-08T05:54:03.437

**后退按钮从父视图控制器的标题中提取其文本。**

在父视图控制器（点击后退按钮时出现的视图控制器）中，将其自己的标题设置为后退按钮上所需的文本。

例如，假设我们有一`RootViewController`堂课。当我们在其表格视图中单击一个单元格时，我们推送一个`SecondViewController`. 我们希望实例的后退按钮显示为`SecondViewController`“Home”。

在*RootViewController.m*`viewDidLoad`的方法中：

 *```
self.title = @"Home"; 
```

在*SecondViewController.m*`viewDidLoad`的方法中：

 *```
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithTitle:@"Back" style:UIBarButtonItemStylePlain target:nil action:nil];
self.navigationItem.backBarButtonItem = backButton;
[backButton release]; 
```

如果您希望您的后退按钮显示“后退”，请将父视图控制器的标题设置为`@"Back"`；

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2013-06-20T13:10:51.203

这对我来说更好。尝试 ：

```
 self.navigationController.navigationBar.topItem.backBarButtonItem = [[UIBarButtonItem alloc] 
initWithTitle:@"Back" style:UIBarButtonItemStylePlain target:nil action:nil]; 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2014-03-10T15:36:08.343

如果您使用情节提要：

1.  打开故事板
2.  在 Document Outline 窗口中找到要返回到的 ViewController
3.  单击该 ViewController 的导航项
4.  在属性资源管理器中，将返回按钮值更改为您的自定义磁贴

就是这样，享受...

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-10-08T09:07:24.677

在 MonoTouch 中，以下工作（在父控制器的 ViewDidLoad 中）：

```
NavigationItem.BackBarButtonItem = new UIBarButtonItem( "Back", UIBarButtonItemStyle.Plain, null); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-08-06T11:09:46.183

```
[self.navigationItem setBackBarButtonItem:[[UIBarButtonItem alloc]
  initWithTitle:@"Back" style:UIBarButtonItemStyleBordered target:nil action:nil]]; 
```

这对我有用。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-10-05T21:05:26.010

在您的父视图控制器中，在视图加载时设置后退按钮：

```
- (void)viewDidLoad
{
    [super viewDidLoad];

    // Do any additional setup after loading the view.
    self.navigationItem.backBarButtonItem = 
       [[UIBarButtonItem alloc] initWithTitle:@"title" 
                                        style:UIBarButtonItemStylePlain 
                                       target:nil 
                                       action:nil];

} 
```

请注意，我们不需要`autorelease`在最后包含最新的 iOS 版本。

希望这可以帮助！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-03-15T07:20:27.127

`[self.navigationController.navigationBar.backItem setTitle:@"back"];`

这个对我有用。您可以将“返回”替换为其他内容。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-07-01T19:08:20.393

如果您不想拥有头衔，这对我有用！

```
self.navigationItem.backBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@" " style:UIBarButtonItemStylePlain target:nil action:nil]; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-06-10T07:48:19.643

```
self.navigationController.navigationBar.topItem.backBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@"Back" style:UIBarButtonItemStylePlain target:nil action:nil]; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-07-03T17:22:23.077

我终于知道为什么这些答案起初对我不起作用。我在情节提要中设置了标题。当我在代码上设置标题时。有用！

```
self.navigationItem.title = @"Main Menu";
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithTitle:@" " style:UIBarButtonItemStyleBordered target:nil action:nil];
[[self navigationItem] setBackBarButtonItem:backButton]; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-08-30T16:15:37.007

我的解决方案是在视图控制器被推送到导航堆栈时设置标题，并在推送 vc 关闭之前使用委托方法重置它：

因此，当我推送另一个视图控制器时，我将标题更改放在调用视图控制器中，例如：

```
self.pushedVC = [self.storyboard instantiateViewControllerWithIdentifier:@"pushedVCIdentifier"];
self.pushedVC.delegate = self;   
[self.navigationController pushViewController:self.pushedVC animated:YES];
self.title = @"Back"; 
```

在委托回调函数中（我在 viewWillDissapear 中调用）：

```
-(void)pushedVCWillClose:(PushedVC *)sender
{
    self.title = @"Previous Title";
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-12-31T04:59:09.533

如果您不仅要更改后退按钮的文本并保持原来的左箭头形状，还要在用户单击后退按钮时做一些事情，我建议您看看我的“ [CustomNavigationController](https://github.com/jianpx/CustomNavigationController) ”。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-03-31T08:58:54.977

要更改返回按钮标题，请参阅下面的代码

```
InformationVC *infoController=[[InformationVC alloc]init];[self.navigationController infoController animated:YES];

//Below code changed back button title on InformationVC page.
UIBarButtonItem *backBarButton = [[UIBarButtonItem alloc] initWithTitle:@"Information" style: UIBarButtonItemStylePlain target: nil action: nil];
self.navigationItem.backBarButtonItem = backBarButton;`enter code here` 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-09-10T19:51:13.543

//可以通过在上一个视图控制器中设置标题来实现，如下图

```
override func viewWillAppear(animated: Bool) {
        super.viewWillAppear(animated)
        //Set Title for this view
        self.navigationItem.title = "My Title"

}

override func viewWillDisappear(animated: Bool) {
        super.viewWillAppear(animated)
        //Set Title for back button in next view 
        self.navigationItem.title = "Back"
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-09-13T09:35:32.130

在 Swift5 中，无法编辑 backBarButtom。因此，我们需要先隐藏 backBarButtom，然后使用自定义的 leftbarButtom 替换 backBarButtom。这是详细的解决方案：[https ://stackoverflow.com/a/63868300/13939003](https://stackoverflow.com/a/63868300/13939003)

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2017-07-27T07:53:46.503

这对我有用：

```
self.navigationController.navigationBar.topItem.title = "Back" 
```

# .net - WCF：如何以编程方式重新创建这些 App.config 值？

> ID：835613
> 
> 赞同：10
> 
> 时间：2009-05-07T16:10:50.073
> 
> 标签：.net, wcf, wcf-binding

如果我创建服务而不指定任何绑定或端点（当我通过 Visual Studio 注册 WCF 时，它从 App.config 中生成的值中读取它），我有一个工作正常的 WCF 服务。

我有一个返回服务引用的简单方法：

```
return new SmsServiceReference.SmsEngineServiceClient(); 
```

这工作正常（因为值是从配置中读取的）。但是，我想在数据库中包含其中一些值（例如 URI），并且想做这样的事情：

```
 Binding binding = new BasicHttpBinding();
        EndpointAddress endpointAddress = new EndpointAddress( "my.uri.com/service.svc" );

        return new SmsServiceReference.SmsEngineServiceClient(binding,endpointAddress); 
```

这行不通。当我尝试使用服务引用时，它会引发异常。

我怀疑这是因为我的 App.config 有更多信息，而这两行没有提供（显然）。问题是，如何以编程方式复制以下 App.Config 值？

这是我的 App.Config 的片段：（URI 已被更改以保护无辜者）。

```
 <system.serviceModel>
<bindings>
  <basicHttpBinding>
    <binding name="BasicHttpBinding_ISmsEngineService" closeTimeout="00:01:00"
        openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"
        allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard"
        maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536"
        messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered"
        useDefaultWebProxy="true">
      <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"
          maxBytesPerRead="4096" maxNameTableCharCount="16384" />
      <security mode="None">
        <transport clientCredentialType="None" proxyCredentialType="None"
            realm="" />
        <message clientCredentialType="UserName" algorithmSuite="Default" />
      </security>
    </binding>
  </basicHttpBinding>
</bindings>
<client>
  <endpoint address="http://www.myuri.com/Services/Services.svc/basic"
      binding="basicHttpBinding" bindingConfiguration="BasicHttpBinding_ISmsEngineService"
      contract="SmsServiceReference.ISmsEngineService" name="BasicHttpBinding_ISmsEngineService" />
</client> 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-08T14:04:56.770

App 配置中的大多数值也是绑定中的属性，可以通过编程方式重新创建。就个人而言，我使用如下方法来创建绑定

```
 public static BasicHttpBinding CreateBasicHttpBinding()
        {
            BasicHttpBinding binding = new BasicHttpBinding();
            binding.AllowCookies = false;
            binding.ReceiveTimeout = new TimeSpan(0, 10, 0);
            binding.OpenTimeout = new TimeSpan(0, 1, 0);
            binding.SendTimeout = new TimeSpan(0, 1, 0);
            // add more based on config file ...
            //buffer size
            binding.MaxBufferSize = 65536;
            binding.MaxBufferPoolSize = 534288;
            binding.HostNameComparisonMode = HostNameComparisonMode.StrongWildcard;

            //quotas
            binding.ReaderQuotas.MaxDepth = 32;
            binding.ReaderQuotas.MaxStringContentLength = 8192;
            // add more based on config file ...

            return binding;
        } 

```

我使用这样的东西来创建我的端点地址

```
 public static EndpointAddress CreateEndPoint()
        {
            return new EndpointAddress(Configuration.GetServiceUri());
        } 

```

serviceUri 将是服务 URL，例如[http://www.myuri.com/Services/Services.svc/basic](http://www.myuri.com/Services/Services.svc/basic)

最后创建服务客户端

```
 Binding httpBinding = CreateBasicHttpBinding();
 EndpointAddress address = CreateEndPoint();
 var serviceClient = new MyServiceClient(httpBinding, address); 

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T17:21:43.427

好吧，配置中的客户端端点指定了这个 URL：

```
 <endpoint address="http://www.myuri.com/Services/Services.svc/basic" 
```

但在您的代码示例中，您创建：

```
 EndpointAddress endpointAddress = new EndpointAddress( "my.uri.com/service.svc" ); 
```

地址必须匹配 - 如果配置中的地址有效，您需要将代码更改为：

```
 EndpointAddress endpointAddress = new EndpointAddress( "http://www.myuri.com/Services/Services.svc/basic" ); 
```

请注意 - 您的代码示例中有各种小错字（my.uri.com 与 www.myuri.com，/service.svc 而不是 /Services/Services.svc）。

它是否适用于更正的端点地址？

马克

# c++ - C++ 的分层内存分配器库

> ID：835617
> 
> 赞同：2
> 
> 时间：2009-05-07T16:11:14.220
> 
> 标签：c++, memory-management, hierarchical

我的应用程序主要是*分层*组织的，所以我发现像[APR 内存池](http://apr.apache.org/docs/apr/1.3/group__apr__pools.html)这样的东西是最好的方法。

在阅读关于[此处](https://stackoverflow.com/questions/222557/cs-placement-new)和[此处](https://stackoverflow.com/questions/362953/what-are-uses-of-the-c-construct-placement-new)`C++ placement new`的帖子的 SO以及[更通用的 C 分配问题](https://stackoverflow.com/questions/722922/best-way-to-handle-memory-allocation-in-c)时，我正在考虑按照一篇帖子中的建议手工制作分层池分配器，但在纯粹的 NYI 传统中**，我首先要问这样的事情是否已经存在。**

 **它还可以具有能够将未使用的内存返还给操作系统的良好特性（因为可以使用 完成分配`mmap(MAP_ANON)`），或者可以按照[Ferrucico](https://stackoverflow.com/users/4086/ferruccio)[的](https://stackoverflow.com/questions/362953/what-are-uses-of-the-c-construct-placement-new/363537#363537)建议[从堆栈分配](http://the-lazy-programmer.com/blog/?p=24)。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T17:34:58.467

我知道另一个很好的分层内存分配器，但它在幕后调用`malloc`。

> [talloc](http://talloc.samba.org/)是一个基于分层池的内存分配器，带有析构函数。它是 Samba4 中使用的核心内存分配器，在 Samba4 开发的许多方面都产生了巨大的影响。
> 
> 要开始使用talloc，我建议您阅读[talloc 指南](http://samba.org/ftp/unpacked/talloc/talloc_guide.txt)。

话虽如此，Glibc`malloc`已经使用`mmap(MAP_ANON)`了大于 的分配`mmap_threshold`，您可以通过`mallopt(M_MMAP_THRESHOLD, bytes)`. 默认情况下，它在

```
/*
  MMAP_THRESHOLD_MAX and _MIN are the bounds on the dynamically
  adjusted MMAP_THRESHOLD.
*/

#ifndef DEFAULT_MMAP_THRESHOLD_MIN
#define DEFAULT_MMAP_THRESHOLD_MIN (128 * 1024)
#endif

#ifndef DEFAULT_MMAP_THRESHOLD_MAX
  /* For 32-bit platforms we cannot increase the maximum mmap
     threshold much because it is also the minimum value for the
     maximum heap size and its alignment.  Going above 512k (i.e., 1M
     for new heaps) wastes too much address space.  */
# if __WORDSIZE == 32
#  define DEFAULT_MMAP_THRESHOLD_MAX (512 * 1024)
# else
#  define DEFAULT_MMAP_THRESHOLD_MAX (4 * 1024 * 1024 * sizeof(long))
# endif
#endif 
```

小心降低它；默认情况下，`#define DEFAULT_MMAP_MAX 65536`使用`mmap`. 这可以用 更改`mallopt(M_MMAP_MAX, count)`，但使用 many`mmap`会产生开销。

环境变量`MALLOC_MMAP_THRESHOLD_`等也将设置这些选项。

显然，`malloc`分配的内存是用`mmap`释放的`munmap`。我不确定这些是否记录在 Glibc 源代码之外的任何地方，或者是否有任何兼容性保证。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T21:29:11.913

Dave Hanson 的[C 接口和实现](http://www.cs.princeton.edu/software/cii/)有一个精心调整的单池分配器。您可以将它们链接在一起以创建一个分层分配器，这比从头开始滚动您自己的更简单。

您*确实*有分析结果显示内存管理是一个重要的瓶颈，对吗？或者您只是想简化分配的 API？

# java - JDBC连接池性能对比

> ID：835621
> 
> 赞同：9
> 
> 时间：2009-05-07T16:11:49.430
> 
> 标签：java, performance, jdbc, connection-pooling

有没有人有任何信息比较不同 ConnectionPool 实现的性能特征？

背景：我有一个应用程序在后台线程中运行数据库更新到同一个盒子上的 mysql 实例。使用数据源 com.mchange.v2.c3p0.ComboPooledDataSource 会给我们偶尔的 SocketExceptions： com.mysql.jdbc.CommunicationsException: Communications link failure 由于底层异常：

```
** BEGIN NESTED EXCEPTION ** 

java.net.SocketException
MESSAGE: Broken pipe

STACKTRACE:

java.net.SocketException: Broken pipe
        at java.net.SocketOutputStream.socketWrite0(Native Method) 
```

增加 mysql 连接超时会增加这些错误的频率。

这些错误在切换到不同的连接池（com.mysql.jdbc.jdbc2.optional.MysqlConnectionPoolDataSource）时消失了；然而，性能可能更差，内存配置文件也明显如此（我们得到的 GC 比 c3p0 池少得多，而且大得多）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T17:19:18.940

无论您使用什么连接池，您都需要假设连接可以随时随机关闭，并让您的应用程序处理它。

在“受信任”网络上存在长期数据库连接的情况下，经常发生的情况是操作系统对连接可以打开多长时间施加时间限制，或者定期运行一些“连接清理”代码。但原因并不重要——这只是网络生活的一部分，你应该假设连接可以“从你的脚下拉出来”，并相应地处理这种情况。

因此，鉴于此，我真的看不出连接池框架不允许您以编程方式处理这种情况的意义。

（顺便说一句，这是我的另一个案例，我很高兴我只是编写了自己的连接池代码；没有黑匣子神秘地吃掉内存，也不必四处寻找“神奇参数”......）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-14T11:56:22.493

您可能想在[http://jolbox.com](http://jolbox.com)上查看一些基准测试数据- 托管 BoneCP 的站点，这是一个比 C3P0 和 DBCP 都快的连接池。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T16:19:36.230

我也用 mysql & c3p0 弹出了这个错误——我尝试了各种方法，最终让它消失了。我不记得了，但可能解决的是自动重新连接标志

```
url="jdbc:mysql://localhost:3306/database?autoReconnect=true" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T17:16:48.527

你试过[Apache DBCP](http://commons.apache.org/dbcp)吗？我不知道 c3po 但 DBCP 可以以不同的方式处理空闲连接：

*   它可以从池中删除空闲连接
*   它可以在一段时间不活动后对空闲连接运行查询

它还可以在将连接提供给应用程序之前通过对其运行查询来测试连接是否有效；如果它遇到异常，它会丢弃该连接并尝试另一个连接（或者如果可以，则创建一个新连接）。更健壮的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-14T12:48:37.800

> *断管*

这大致意味着对方已经中止/超时/关闭了连接。你不是保持连接那么长时间吗？确保您的代码正确关闭 finally 块中的所有 JDBC 资源（`Connection`和`Statement`）`ResultSet`。

> *增加 mysql 连接超时会增加这些错误的频率。*

注意这个超时不要超过数据库自己的超时设置。

# wix - 如何将 msiexec 属性传递给 WiX C# 自定义操作？

> ID：835624
> 
> 赞同：27
> 
> 时间：2009-05-07T16:11:57.933
> 
> 标签：wix, windows-installer, installation, custom-action

我有一个使用 Wxs 3.0 创建的 MSI 文件。我的 MSI 引用了一个 C# 自定义操作，它是使用新的[C# Custom Action project](http://blogs.msdn.com/jasongin/archive/2008/05/23/custom-action-project-templates.aspx)编写的。

我想将一个参数传递给 msiexec，该参数被路由到我的自定义操作 - 例如：

msiexec /i MyApp.msi ENVIRONMENT=TEST#

在我的 .wxs 文件中，我指的是这样的自定义操作：

```
<Property Id="ENVIRONMENT"/>
<Binary Id="WixCustomAction.dll"  SourceFile="$(var.WixCustomAction.Path)" />
<CustomAction Id="WixCustomAction" BinaryKey="WixCustomAction.dll"    DllEntry="ConfigureSettings"/>
<InstallExecuteSequence>
   <Custom Action="WixCustomAction" After="InstallFiles"></Custom>
</InstallExecuteSequence> 
```

我的 C# 自定义操作设置如下：

```
[CustomAction]
public static ActionResult ConfigureSettings(Session session)
{

} 
```

我期望能够像这样访问该属性：

字符串 environmentName = session.Property["ENVIRONMENT"];

但这似乎不起作用。

如何访问我在自定义操作中传递给 msiexec 的属性？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2010-05-08T19:06:52.007

如果不是

```
<CustomAction Id="SetCustomActionDataValue"
              Return="check"
              Property="Itp.Configurator.WixCustomAction"
              Value="[ENVIRONMENT],G2,[CONFIGFILE],[TARGETDIR]ITP_v$(var.VERSION_MAJOR)" /> 
```

你写这个：

```
<CustomAction Id="SetCustomActionDataValue"
              Return="check"
              Property="Itp.Configurator.WixCustomAction"
              Value="Environment=[ENVIRONMENT];G=G2;ConfigFile=[CONFIGFILE];TargetDir=[TARGETDIR]ITP_v$(var.VERSION_MAJOR)" /> 
```

那么您将能够像这样引用您的变量：

```
string env=session.CustomActionData["Environment"]; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-08T16:19:30.440

只是为了完整性；使用 Jeremy Lew 描述的方法，在上面的博客中允许以下内容：

来电：

```
msiexec /i ITP.Platform.2.msi ENVIRONMENT=QA CONFIGFILE=EnvironmentConfig.xml 
```

在 .wxs 文件中使用这个：

```
<Property Id="ENVIRONMENT" Secure="yes" />
<Property Id="CONFIGFILE" Secure="yes" />
<Binary Id="Itp.Configurator.WixCustomAction.dll"
        SourceFile="$(var.Itp.Configurator.WixCustomAction.Path)" />

<CustomAction Id="SetCustomActionDataValue"
              Return="check"
              Property="Itp.Configurator.WixCustomAction"
              Value="[ENVIRONMENT],G2,[CONFIGFILE],[TARGETDIR]ITP_v$(var.VERSION_MAJOR)" />

<CustomAction Id="Itp.Configurator.WixCustomAction"
              Return="check"
              Execute="deferred"
              BinaryKey="Itp.Configurator.WixCustomAction.dll"
              DllEntry="ConfigureItpBrandSettings" />

<InstallExecuteSequence>
  <Custom Action="SetCustomActionDataValue" After="InstallFiles"></Custom>
  <Custom Action="Itp.Configurator.WixCustomAction" After="SetCustomActionDataValue"></Custom>
</InstallExecuteSequence> 
```

使用自定义操作：

```
 /// <summary>
    /// CustomAction keys should be Environment,BrandId,ConfigPath,itpBasePath
    /// </summary>
    /// <param name="session"></param>
    /// <returns></returns>
    [CustomAction]
    public static ActionResult ConfigureItpBrandSettings(Session session)
    {
        string[] arguments = GetCustomActionDataArguments(session);

        string environmentName = arguments[0];
        string brandId = arguments[1];
        string configPath = arguments[2];
        string itpBasePath = arguments[3];

        //Do stuff

        return ActionResult.Success;
    }

    private static string[] GetCustomActionDataArguments(Session session)
    {
        string[] keys = new string[session.CustomActionData.Keys.Count];
        session.CustomActionData.Keys.CopyTo(keys,0);
        return keys[0].Split(',');
    } 
```

作品。

解析 CustomActionData 参数非常难看，但它确实有效。希望有人知道一种更优雅的方式来做到这一点。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-07T16:39:39.427

您的自定义操作需要是延迟自定义操作才能在 InstallFiles 之后运行。延迟的自定义操作无法访问属性，但它们可以访问 CustomActionData。有关如何处理它的讨论，请参阅[此博客文章。](http://blogs.claritycon.com/blogs/sajo_jacob/archive/2008/02/28/customactiondata-in-wix-with-deferred-custom-actions.aspx)（此示例是一个 VBScript 自定义操作，但您将能够通过 session.CustomActionData 集合检索该值。）

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-01-09T17:22:47.780

这是我的工作代码：

```
<Binary Id="MyCA" SourceFile="..\bin\ChainerRun.CA.exe" />

<CustomAction Id="SetCustomActionDataValue" Return="check" Property="CustomActionData" Value="TARGETDIR=[TARGETDIR];AA=Description;" />

<CustomAction Id="ReadAndSet" 
            BinaryKey="MyCA" 
            DllEntry="ReadAndSet" 
            Execute="immediate"
            HideTarget="no" 
            Return="check" />

<InstallExecuteSequence>
    <Custom Action="SetCustomActionDataValue" Before="InstallFiles" />
    <Custom Action="ReadAndSet" After="SetCustomActionDataValue" />
</InstallExecuteSequence> 
```

在 C# 自定义操作函数中：

```
[CustomAction]
public static ActionResult ReadAndSet(Session session)
{
    ActionResult retCode = ActionResult.NotExecuted;

    System.Diagnostics.Debug.Assert(false);

    session.Log("ReadAndSet() begins ...");

    string installLocation = session.CustomActionData["TARGETDIR"];
    string hostName = session.CustomActionData["AA"];
    ...
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-08-30T09:22:35.013

如果我们谈论的是 Wix Sharp（而不是带有 XML 内容的普通 Wix），那么添加自定义属性就是小菜一碟。您所要做的就是为您的托管操作设置**UsesProperties**属性。

例如，如果您想添加一个名为“ **MYPROP** ”的自定义属性，只需像这样定义您的操作：

```
new ElevatedManagedAction(nameof(CustomActions.MyCustomAction))
{
    Condition = Condition.Installed,
    When = When.Before,
    Step = Step.RemoveFiles,
    Return = Return.check,
    Execute = Execute.deferred,
    UsesProperties = "MYPROP"
} 
```

通过 msiexec 命令行设置属性值：

```
msiexec /i my.msi MYPROP=MYVALUE 
```

然后您将能够从您的自定义操作中访问它：

```
[CustomAction]
public static ActionResult MyCustomAction(Session session)
{
    session.Log("MYPROP VALUE: " + session.CustomActionData["MYPROP"]);
    return ActionResult.Success;
} 
```

当属性未通过命令行设置时，默认值为空字符串。

# c# - 没有已知校验和的 Mono/.Net 的 Zlib

> ID：835639
> 
> 赞同：0
> 
> 时间：2009-05-07T16:13:58.490
> 
> 标签：c#, mono, compression, checksum, zlib

我需要实现一个特殊的 ZLib 实现，它应该在 .Net 和 Mono 下运行。数据/字符串消息是通过套接字接收的，因此缺少校验和。这是关于原始字符串数据，而不是文件。

```
 unsigned char zlib_header[]={
// custom additional Zlib Id
       'Z',    // Our own ID
// The normal GZIP header
       0x1f,
       0x8b,   // GZIP ID
       0x08,   // Deflated
       0x00,   // Flags
       0, 0, 0, 0, // Timestamp,
       0x00,   // Extra flags
       0x00,   // OS identifier
// afterwards compressed data without a checksum
}; 
```

我曾尝试使用 GZipStream 和 DeflateStream 解压缩数据，但我认为 GZStream 由于缺少校验和而失败。我也尝试了各种偏移，但没有运气。不使用校验和，因为无论如何都是通过套接字接收数据 - 因此 ZLib 校验和将是额外的开销。我是否遗漏了什么，或者您能解释一下如何添加校验和并调用正确的库，还是我应该查看支持 Mono 和 .Net 的第 3 方库？编辑：性能非常关键，因为这至少每秒完成一次。最后你会推荐我通过 Interop 使用 C-Lib 吗？我现在总是收到无效数据异常，我认为它与错误的校验和有关。这是我尝试使用但没有成功的实际代码：

```
const int HeaderSize = 1;
System.IO.MemoryStream ms = new System.IO.MemoryStream(compressedBuffer, HeaderSize, compressedBuffer.Length-HeaderSize);//remove the additional Z from the header
GZipStream zipStream = new GZipStream(ms, CompressionMode.Decompress,true);
byte[] deCompressedBytes = new byte[actualBufferLength* 10];
int resultSize=zipStream.Read(deCompressedBytes, 0, actualBufferLength);//get rid of the header      
UTF8Encoding enc = new UTF8Encoding();
string result = enc.GetString(deCompressedBytes, 0, resultSize); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T16:48:05.193

你确定它与校验和有关吗？

32 位校验和在 GZIP 格式中不是可选的。我不明白您所说的“数据是通过套接字接收的，因此缺少校验和”是什么意思。如果您通过信鸽获取数据并不重要；如果它是有效的 GZIP 流，则它必须具有 32 位 CRC。谁或什么产生了源数据？

GZIP 规范中有一个可选部分——16 位校验和。（它的包含也不取决于 GZIP 字节流是如何创建的。） System.IO.GZipStream 类将很乐意接受缺少此 CRC16 以及包含它的 GZIP 流。

您在代码中还有其他一些问题。您的代码中的实际缓冲区长度 - 那是什么？保存解压后的数据肯定不是缓冲区的长度。那是10倍。但是 10 倍似乎很随意。对于非常可压缩的数据，您可能会超过 10 倍。我建议你在解压中使用流式方法。

至于您是否能够处理每秒 1 次的解压缩，是的，System.IO.GZipStream 对于足够小的数据块来说足够快。可能不需要使用本机 C/C++ 库。

ps：[DotNetZip](http://dotnetzip.codeplex.com)库包含一个开源的GZipStream；您可以开箱即用，或者如果您愿意，您可以直接获取 GZip 文件（如果您只需要这些内容）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T07:32:21.433

只需使用 DeflateStream 而不是 GZipStream。

# c++ - 如何删除运行程序的 Win32 桌面并终止这些程序？

> ID：835642
> 
> 赞同：1
> 
> 时间：2009-05-07T16:14:06.273
> 
> 标签：c++, winapi, windows-vista, process, desktop

我有这个代码：

```
#define _WIN32_WINNT 0x0500
#include <cstdlib>
#include <iostream>
#include <windows.h>

using namespace std;

int main(int argc, char *argv[])
{
    HDESK hOriginalThread;
    HDESK hOriginalInput;
    hOriginalThread = GetThreadDesktop(GetCurrentThreadId());
    hOriginalInput = OpenInputDesktop(0, FALSE, DESKTOP_SWITCHDESKTOP);

    HDESK hNewDesktop=CreateDesktop("BasicAppDesktopDesktop",NULL,NULL,0,DELETE|READ_CONTROL|WRITE_DAC|WRITE_OWNER|GENERIC_ALL,NULL);
    /*HDESK hNewDesktop=OpenDesktop("Winlogon", 0, FALSE,
                        DESKTOP_CREATEMENU |
                        DESKTOP_CREATEWINDOW |
                        DESKTOP_ENUMERATE    |
                        DESKTOP_HOOKCONTROL  |
                        DESKTOP_JOURNALPLAYBACK |
                        DESKTOP_JOURNALRECORD |
                        DESKTOP_READOBJECTS |
                        DESKTOP_SWITCHDESKTOP |
                        DESKTOP_WRITEOBJECTS);
                        */

    SetThreadDesktop(hNewDesktop);
    SwitchDesktop(hNewDesktop);
    //system("cmd");
    STARTUPINFOA si = {0};
    si.cb = sizeof(STARTUPINFO);
    si.lpDesktop = "winsta0\\BasicAppDesktopDesktop";
    PROCESS_INFORMATION infos;
    CreateProcess(NULL,"explorer",NULL,NULL,false,NORMAL_PRIORITY_CLASS,NULL,NULL,&si,&infos);
    //WaitForSingleObject( infos.hProcess, INFINITE );
    while(!(GetAsyncKeyState(VK_F12) == -32767))Sleep(50);
    CloseHandle( infos.hProcess );
    CloseHandle( infos.hThread );

    SwitchDesktop(hOriginalInput);
    SetThreadDesktop(hOriginalThread);
    CloseDesktop(hNewDesktop);
    CloseDesktop(hOriginalInput);
    return 0;
} 
```

当我按 F12 时，桌面切换到原始并且程序将关闭，但是如果我在第二个桌面上运行任何程序，则不要终止，当我再次运行我的程序时，任何程序都会出现。有没有办法删除带有程序的桌面，或者在退出时自动终止通过第二个桌面运行的程序？请帮忙。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T17:29:52.673

如果您想强制终止您开始使用的程序`CreateProcess`（如您发布的代码中），那么您可以在结构`TerminateProcess`中返回的句柄上使用。`PROCESS_INFORMATION`

如果您想终止所有带有附加到新桌面的线程的进程，无论您是否启动它们，那么它有点（好吧，很多）更复杂。您的代码必须执行以下操作：

1.  枚举所有正在运行的进程（使用`CreateToolhelp32Snapshot`）
2.  依次枚举每个进程的线程（再次使用`CreateToolhelp32Snapshot`）
3.  获取每个线程的桌面句柄（使用`GetThreadDesktop`）
4.  获取该桌面的名称（使用`GetUserObjectInformation`）
5.  与您的桌面名称进行比较
6.  如果名称匹配，则打开父进程的新句柄并终止它（`OpenProcess`和`TerminateProcess`）

要编写很多代码，但它应该可以工作。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-18T02:06:29.103

您可以编写一个简单的 DLL，它将使用套接字返回 GetStartupInfo。并且您必须在所有进程中注入您的 dll，并在 StartupInfo 数据到来后使用 CreateRemoteThread 执行您的 dll 并反注入。

对不起，我的英语不好..

# java - int 的所有可能值，从最小到最大，使用 Java

> ID：835648
> 
> 赞同：7
> 
> 时间：2009-05-07T16:15:25.223
> 
> 标签：java

编写一个程序，使用 Java 从最小到最大打印出 int 数据类型的所有可能值。

**截至 2009 年 5 月 8 日格林威治标准时间 10:44，一些值得注意的解决方案：**

1) Daniel Lew 是第一个发布[正确工作代码](https://stackoverflow.com/questions/835648/all-possible-values-of-int-from-the-smallest-to-the-largest-using-java/835666#835666)的人。

2) Kris为给定问题提供[了最简单的解决方案。](https://stackoverflow.com/questions/835648/all-possible-values-of-int-from-the-smallest-to-the-largest-using-java/835841#835841)

3) Tom Hawtin - tackline，可以说[是最优雅的解决方案](https://stackoverflow.com/questions/835648/all-possible-values-of-int-from-the-smallest-to-the-largest-using-java/835926#835926)。

4）mmyers指出，打印很可能会成为瓶颈，[可以通过缓冲来改善](https://stackoverflow.com/questions/835648/all-possible-values-of-int-from-the-smallest-to-the-largest-using-java/835681#835681)。

5) Jay 的[蛮力方法](https://stackoverflow.com/questions/835648/all-possible-values-of-int-from-the-smallest-to-the-largest-using-java/837436#837436)值得注意，因为除了违背编程的核心点之外，生成的源代码占用大约 128 GB 并且会突破编译器限制。

作为旁注，我相信答案确实表明这可能是一个很好的面试问题，只要重点不在于记住有关数据类型溢出及其含义的琐事的能力（在单元测试期间很容易发现） ），或者获取MAX和MIN限制的方式（可以很容易地在文档中查找）而是分析处理问题的各种方式。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-07T16:19:26.633

```
class Test {
    public static void main(String[] args) {
        for (int a = Integer.MIN_VALUE; a < Integer.MAX_VALUE; a++) {
            System.out.println(a);
        }
        System.out.println(Integer.MAX_VALUE);
    }
} 
```

我被录用了吗？

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-07T16:52:04.043

最简单的形式（最小代码）：

```
 for (long i = Integer.MIN_VALUE; i <= Integer.MAX_VALUE; i++) {
        System.out.println(i);
    } 
```

没有整数溢出，没有额外的检查（只是更多的内存使用，但谁没有 32 个备用位）。

虽然我想

```
 for (long i = Integer.MIN_VALUE; i <= Integer.MAX_VALUE; i++)
        System.out.println(i); 
```

字符更少，我真的不能说它*更简单*。更短不一定更简单，但它确实有更少的代码。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-07T17:13:45.960

我只需要添加一个答案...

```
public class PrintInts {
    public static void main(String[] args) {
        int i = Integer.MIN_VALUE;
        do {
            System.out.println(i);
            ++i;
        } while (i != Integer.MIN_VALUE);
    }
} 
```

*   我们不希望身体重复（想想维护！）
*   它不会永远循环。
*   它为计数器使用适当的类型。
*   它不需要一些狂野的第三方怪人库。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-07T16:22:10.420

有什么棘手的事情我没有抓住吗？可能有......（**编辑：**是的，有！）

```
class AllInts {
    public static void main(String[] args) {
        // wrong -- i <= Integer.MAX_VALUE will never be false, since
        // incrementing Integer.MAX_VALUE overflows to Integer.MIN_VALUE.
        for (int i = Integer.MIN_VALUE; i <= Integer.MAX_VALUE; i++) {
            System.out.println(i);
        }
    }
} 
```

由于打印是瓶颈，缓冲区会大大提高速度（我知道是因为我刚刚尝试过）：

```
class AllInts {
    public static void main(String[] args) {
        // a rather large cache; I did no calculations to optimize the cache
        // size, but adding the first group of numbers will make the buffer
        // as large as it will ever need to be.
        StringBuilder buffer = new StringBuilder(10000000);
        int counter = 0;
        // note that termination check is now <
        // this means Integer.MAX_VALUE won't be printed in the loop
        for (int i = Integer.MIN_VALUE; i < Integer.MAX_VALUE; i++) {
            buffer.append(i).append('\n');
            if (++counter > 5000000) {
                System.out.print(buffer);
                buffer.delete(0, buffer.length()-1);
                counter = 0;
            }
        }
        // take care of the last value (also means we don't have to check
        // if the buffer is empty before printing it)
        buffer.append(Integer.MAX_VALUE);
        System.out.println(buffer);
    }
} 
```

此外，这个版本实际上将终止（感谢 Daniel Lew 指出事实上，我没有注意到一些棘手的问题）。

此版本（使用 -Xmx512m 运行）的总运行时间为 1:53。每秒超过 600000 个数字；一点也不差！但我怀疑如果我没有将它最小化运行它会更慢。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-07T22:41:50.303

啊，我刚开始写

```
System.out.println(-2147483648);
System.out.println(-2147483647);
System.out.println(-2147483646); 
```

好吧，给我几个星期的时间来完成这个打字......

说明并没有说我必须使用循环，至少这种方法没有任何溢出问题。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-07T19:24:51.417

来吧伙计们，它说使用java。它没有说在 for 循环中使用 int 。:-)

```
public class Silly {
  public static void main(String[] args) {
    for (long x = Integer.MIN_VALUE; x <= Integer.MAX_VALUE; x++) {
      System.out.println(x);
    }
  }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-07T17:16:24.907

当我第一次看到这个时，我的第一个问题是'你如何定义最小和最大'。对于我认为最明显的定义（'smallest' == 'closest to 0'），答案是

```
for (int i = 0; i >= 0; i++) {
    System.out.println(i);
    System.out.println(-i-1);
} 
```

但其他人似乎将“最小”读作“最小”，将“最大”读作“最大”

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-07T19:31:12.447

另一种使用 int 类型遍历每个值的方法。

```
public static void main(String[] args) {
    int i = Integer.MIN_VALUE;
    do {
        System.out.println(i);
    } while (i++ < Integer.MAX_VALUE);
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-07T16:19:06.260

的最大值为`int`，`Integer.MAX_VALUE`最小值为`Integer.MIN_VALUE`。使用循环打印所有这些。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-08T13:13:12.680

鉴于最佳答案的概述，我意识到我们在蛮力部门严重缺乏。杰的回答很好，但实际上不起作用。以科学的名义，我呈现 - Bozo Range：

```
import java.util.Random;
import java.util.HashSet;

class Test {
    public static void main(String[] args) {
        Random rand = new Random();
        HashSet<Integer> found = new HashSet<Integer>();
        long range = Math.abs(Integer.MAX_VALUE - (long) Integer.MIN_VALUE);
        while (found.size() < range) {
            int n = rand.nextInt();
            if (!found.contains(n)) {
                found.add(n);
                System.out.println(n);
            }
        }
    }
} 
```

请注意，您需要留出*至少*4 GB 的 RAM 才能运行此程序。（可能是 8 GB，如果您使用的是 64 位机器，您可能需要实际运行该程序......）。此分析不计算 Integer 类添加到任何给定 int 的膨胀，也不计算 HashSet 本身的大小。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-07T16:29:20.340

包 fj 来自[这里](http://code.google.com/p/functionaljava)。

```
import static fj.pre.Show.intShow;
import static fj.pre.Show.unlineShow;
import static fj.data.Stream.range;
import static java.lang.Integer.MIN_VALUE;
import static java.lang.Integer.MAX_VALUE;

public class ShowInts
  {public static void main(final String[] args)
     {unlineShow(intShow).println(range(MIN_VALUE, MAX_VALUE + 1L));}} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-07T16:35:39.623

以 1000 行/秒的速度，您将在大约 7 周内完成。我们现在应该喝咖啡吗？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-07T17:05:03.390

`StringBuilder`只是稍微改进一下's 方法：

2 个线程 + 2 个缓冲区（即`StringBuilder`）：主要思想是一个线程填充一个缓冲区，而另一个线程转储另一个缓冲区的内容。

显然，“dumper”线程*总是*比“filler”线程运行得慢。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-08-10T11:23:10.013

如果面试官正在寻找 Java 中所有可能的 Integer 值，您可以尝试使用 Long 给他一个解决方案：

```
class AllIntegers{
    public static void main(String[] args) {
        for (int i = Integer.MIN_VALUE; i < Long.MAX_VALUE; i++) {
            System.out.println(i);
        }
        System.out.println(Long.MAX_VALUE);
    }
} 
```

这应该打印从 -9223372036854775808 到 9223372036854775807 的范围，这比使用 Integer 实现的范围要大得多。

# c# - 我应该如何将带有文本后缀的数字转换为c#中的整数？

> ID：835649
> 
> 赞同：2
> 
> 时间：2009-05-07T16:15:29.797
> 
> 标签：c#, string

在 C# 中将 400AMP 或 6M 之类的东西转换为整数的最干净/最好的方法是什么？我不会总是知道后缀是什么，我只是想让它消失并留下数字。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-07T16:16:55.970

您可以使用正则表达式：

```
Regex reg = new Regex("[0-9]*");
int result = Convert.ToInt32(reg.Match(input)); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T16:21:09.250

它可能不是最干净的方法，但它相当简单（单行），我想比正则表达式更快（肯定是未编译的）。

```
var str = "400AMP";
var num = Convert.ToInt32(str.Substring(0, str.ToCharArray().TakeWhile(
    c => char.IsDigit(c)).Count())); 
```

或作为扩展方法：

```
public static int GetInteger(this string value)
{
    return Convert.ToInt32(str.Substring(0, str.ToCharArray().TakeWhile(
        c => char.IsDigit(c)).Count()));
} 
```

等效地，您可以从函数的结果构造数字字符串`TakeWhile`，如下所示：

```
public static int GetInteger(this string value)
{
    return new string(str.ToCharArray().TakeWhile(
        c => char.IsNumber(c)).ToArray());
} 
```

没有对它们进行基准测试，所以我不知道哪个更快（尽管我非常怀疑第一个）。如果您想获得更好的性能，您只需将 LINQ（可枚举的扩展方法调用）转换为`for`循环。

希望有帮助。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-07T16:30:57.713

好的，这是一个冗长的解决方案，应该相当快。它类似于 Guffa 的中间答案，但我将条件放在循环体中，因为我认为这更简单（并且允许我们只获取一次角色）。这真的是个人品味的问题。

它故意*不*限制它匹配的位数，因为如果字符串是一个溢出 Int32 的整数，我想我宁愿看到一个异常而不仅仅是一个大整数:)

请注意，这也可以处理负数，我认为到目前为止其他任何解决方案都没有...

```
using System;

class Test
{
    static void Main()
    {
        Console.WriteLine(ParseLeadingInt32("-1234AMP"));
        Console.WriteLine(ParseLeadingInt32("+1234AMP"));
        Console.WriteLine(ParseLeadingInt32("1234AMP"));
        Console.WriteLine(ParseLeadingInt32("-1234"));
        Console.WriteLine(ParseLeadingInt32("+1234"));
        Console.WriteLine(ParseLeadingInt32("1234"));
   }

    static int ParseLeadingInt32(string text)
    {
        // Declared before loop because we need the
        // final value
        int i;
        for (i=0; i < text.Length; i++)
        {
            char c = text[i];
            if (i==0 && (c=='-' || c=='+'))
            {
                continue;
            }
            if (char.IsDigit(c))
            {
                continue;
            }
            break;
        }
        return int.Parse(text.Substring(0, i));
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T16:27:16.303

有几种选择...

就像使用正则表达式：

```
int result = int.Parse(Regex.Match(input, @"^\d+").Groups[0].Value); 
```

最快的；简单地循环查找数字：

```
int i = 0;
while (i < input.Length && Char.IsDigit(input, i)) i++;
int result = int.Parse(input.Substring(0, i)); 
```

用于`LastIndexOfAny`查找最后一位数字：

```
int i = input.LastIndexOfAny("0123456789".ToCharArray()) + 1;
int result = int.Parse(input.Substring(0, i)); 
```

（注意：用后缀后有数字的字符串打断，例如“123asdf123”。）

可能最快；自己解析：

```
int i = 0;
int result = 0;
while (i < input.Length) {
    char c = input[i];
    if (!Char.IsDigit(c)) break;
    result *= 10;
    result += c - '0';
    i++;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T16:50:08.963

如果您想要做的只是从原本是 int 的内容中删除未知的后缀，我会这样做：

我喜欢我称之为 IsInt(string possibleInt) 的实用程序静态方法，顾名思义，如果字符串将解析为 int，它将返回 True。您可以将相同的静态方法写入您的实用程序类（如果它不存在）并尝试：

```
 `string foo = "12345SomePostFix";
        while (!Tools.ToolBox.IsInt(foo))
        {
            foo = foo.Remove(foo.Length - 1);
        }
        int fooInt = int.Parse(foo);` 
```

# .net - MAF (System.AddIn) 中的插件可以有构造函数参数吗？

> ID：835651
> 
> 赞同：3
> 
> 时间：2009-05-07T16:15:34.803
> 
> 标签：.net, add-in, system.addin, maf

我需要将配置设置传递给使用托管插件框架（MAF，又名 System.AddIn）创建的插件。可以在 AddIn 的构造函数中放置一个设置参数吗？

另一种选择是创建一个 Initialize() 方法，但是我必须记住在使用 AddIn 进行任何工作之前调用它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-28T12:35:48.097

最好的方法是使用 Initalize() 方法，因为管道使用构造函数参数来传递合约。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-29T14:19:03.093

我也在加载项中使用 Initialize() 方法。实际上 System.AddIn 调用了外接程序类的无参数构造函数。

[以下](http://blogs.msdn.com/b/clraddins/archive/2007/06/28/behind-the-scenes-activation-pete-sheill.aspx)是对加载项激活期间发生的情况的说明。这是一个旧帖子，但激活过程仍然相同。您还可以从 Microsoft 的[Shared Source Initiative](https://referencesource.microsoft.com/)中查看 System.AddIn 程序集的源代码。您可以下载 Product Name = .Net 和 Version = 4 的框架 4，安装它，然后查找[AddInToken.cs](https://referencesource.microsoft.com/#System.AddIn/System/Addin/Hosting/AddInToken.cs)（它将引导您到 AddInActivator.cs）。

# windows-services - 如何从 Windows 服务访问 Linux Samba 共享？

> ID：835654
> 
> 赞同：2
> 
> 时间：2009-05-07T16:16:46.813
> 
> 标签：windows-services, permissions, samba

我正在用 C# 编写一个 Windows 服务。我在 linux 服务器上有一个 samba 共享，我可以从 Windows 机器浏览/读取/写入，并且我将它映射到驱动器号。Windows 服务以 SYSTEM 用户身份运行，无法写入共享。

我应该改变什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T15:49:55.173

我在我的 samba 配置文件 (smb.conf) 中使用了这样的条目，以使其可由任何用户写入。

```
[myshare]
   comment = My Share
   path = /home/myusername/myshare
   public = yes
   writable = yes
   #maps all users to the nobody user?
   only guest = yes 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T16:23:07.890

您需要使共享对系统用户可见。或以实际有权浏览共享的本地系统帐户以外的用户身份安装服务。

您可以通过设置以下 2 个属性来更改项目安装程序中的安装帐户。（它在 ProjectInstaller.Designer 文件中

```
this.serviceProcessInstaller1.Username = "DOMAIN\\UserName";
this.serviceProcessInstaller1.Password = "Password"; 
```

# delphi - 加载和调整图像大小的最快方法是什么？

> ID：835665
> 
> 赞同：5
> 
> 时间：2009-05-07T16:19:24.497
> 
> 标签：delphi, image, thumbnails, filestream

我需要在给定目录中显示图像的缩略图。在将图像加载到图像组件之前，我使用 TFileStream 读取图像文件。然后将位图调整为缩略图大小，并分配给 TScrollBox 上的 TImage 组件。

它似乎工作正常，但是对于较大的图像会减慢很多。

有没有更快的方法从磁盘加载（图像）文件并调整它们的大小？

谢谢，彼得

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T16:30:48.090

并不真地。您可以做的是在后台线程中调整它们的大小，并使用“占位符”图像，直到调整大小完成。然后，我会将这些调整大小的图像保存到某种缓存文件中以供以后处理（Windows 会这样做，并调用当前目录中的缓存 thumbs.db）。

线程架构本身有多种选择。处理所有图像的单个线程，或者一个线程只知道如何处理单个图像的线程池。[AsyncCalls](http://andy.jgknet.de/async)库甚至是另一种方式，可以让事情变得相当简单。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-07T17:03:20.350

我将通过 skamradt 来补充答案，并尝试将其设计为尽可能快。为此，您应该

*   优化 I/O
*   使用多个线程来利用多个 CPU 内核，并在读取（或写入）文件时保持单个 CPU 内核工作

使用多线程意味着使用 VCL 类来调整大小是行不通的，因为 VCL 不是线程安全的，并且所有围绕它的 hack 都不能很好地扩展。[efg 的计算机实验室](http://www.efg2.com/Lab/Library/ImageProcessing/Algorithms.htm)有图像处理代码的链接。

使用多个线程时不要导致多个并发 I/O 操作很重要。如果您选择将缩略图图像写回文件，那么一旦您开始读取文件，您应该完全读取它，一旦您开始写入文件，您也应该完全写入它。交错这两个操作将杀死您的 I/O，因为您可能会导致硬盘磁头的大量查找操作。

为了获得最佳结果，文件的读取（和写入）也不应该发生在应用程序的主（GUI）线程中。这将建议以下设计：

*   让一个线程将文件读取到 TGraphic 对象中，并将它们放入线程安全列表中。
*   让一个线程池等待原始大小的文件列表，并让一个线程处理一个 TGraphic 对象，将其调整为另一个 TGraphic 对象，并将其添加到另一个线程安全列表中。
*   通知 GUI 线程添加到列表中的每个缩略图，以便显示。
*   如果要将缩略图写入文件，也请在阅读线程中执行此操作（请参阅上面的说明）。

**编辑：**

在重新阅读您的问题时，我注意到您可能只需要调整一个图像的大小，在这种情况下，单个背景线程当然就足够了。无论如何我都会留下我的答案，也许它会在某个时候对其他人有用。这是我从最近的一个项目中学到的，最终的程序可能需要更高的速度，但在高峰时间只使用了大约 75% 的四核机器。将 I/O 从处理中解耦会有所作为。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-07T17:32:29.877

我经常将 TJPEGImage 与 Scale:=jsEighth 一起使用（在 Delphi 7 中）。这非常快，因为 JPEG 解压缩可以跳过大量数据来填充宽度和高度仅为八分之一的位图。

另一种选择是使用[shell 的方法来提取缩略图](http://yoy.be/item.asp?i1490)，这也非常快

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T19:24:14.740

我从事视觉业务，我只是使用 OpenGL 将图像上传到 GPU。（通常每秒 20x 2048x2000x8bpp），每个纹理一个 bmp，并让视频卡缩放（win32，Mike Lischke 的 opengl 标头）

上传此类图像需要 5-10 毫秒，具体取决于确切的视频卡（如果未集成和 nvidia 7300 系列或更高版本。最近的集成 GPU 也可能是可行的）。缩放和显示成本 300us。这意味着客户可以在不接触应用程序的情况下疯狂地平移和缩放。我在它上面画了一个覆盖（它曾经是一个 tmetafile，但现在是一种自己的格式）。

我最大的图片是 4096x7000x8bpp，它在 30 毫秒内显示和缩放。(GF 8600)

该技术的一个限制是最大纹理大小。它可以通过将图片分割成多个纹理来解决，但我还没有打扰，因为我通过软件交付系统。

（一些典型尺寸：nv6x00 系列：2k*2k 但与 GDI nv7x00 系列相比，上传几乎是收支平衡：4k*4k 对我来说是基线卡。GF7300 的价格约为 20-40 美元 nv8x00 系列：8k*8k）

请注意，这可能并不适合所有人。但是，如果您有幸指定硬件限制，它可能会起作用。主要问题是像 Thinkpad 这样的笔记本电脑，其 GPU 比普通笔记本电脑更老，而后者通常比台式机落后一代。

我选择了 OpenGL 而不是 DirectX，因为它在时间上更加静态，并且更容易找到非游戏相关的示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T14:23:16.740

利用 Windows 容量创建缩略图。还记得包含图像的文件夹中隐藏的 Thumbs.db 文件吗？

我已经实现了类似这个功能的东西，但是在 VB 中。我的软件能够在大约 10 秒内构建 100 个文件（混合大小）的缩略图。

我无法将其转换为 Delphi。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-13T11:08:54.720

尝试查看[Graphics32 库](http://www.graphics32.org/wiki/)：它非常擅长绘制事物并且与位图配合得*很好。*它们是线程安全的，有很好的例子，而且完全免费。

# graphics - 抗锯齿替代品

> ID：835668
> 
> 赞同：2
> 
> 时间：2009-05-07T16:19:42.610
> 
> 标签：graphics, antialiasing, platform-agnostic, raster-graphics

我见过使用 GDI+、Java 以及 Photoshop 和 Gimp 提供的 Windows 上的抗锯齿功能。是否有任何其他库可以在不依赖主机操作系统支持的情况下提供抗锯齿功能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T16:28:37.737

[Antigrain Geometry](http://www.antigrain.com/about/index.html)在软件中提供抗锯齿图形。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T17:49:13.643

正如 simon 指出的那样，抗锯齿这个词经常被误用/滥用，所以准确地知道你想要做什么总是有帮助的。

既然你提到了 GDI，我假设你在谈论在调整它们的大小时保持漂亮的清晰边缘 - 所以当你将它的大小调整为原始大小的 2 倍或 3 倍时，像字体中的字符之类的东西看起来很干净并且没有像素化。对于这类事情，我过去使用了一种称为 alpha 测试放大率的技术 - 您可以在此处阅读白皮书：

[http://www.valvesoftware.com/publications/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf](http://www.valvesoftware.com/publications/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf)

当我实现它时，我使用了不止一个平面，因此我可以在所有类型的对象上获得更好的边缘，但它在最后简要介绍了这一点。在缩放矢量图像时保持质量的所有方法（我使用过的）中，这是最简单和最高质量的。这还具有易于在硬件中实现的优点。从现有 API 的角度来看，您最好的选择是使用 OpenGL 或 Direct3D - 话虽如此，它实际上只需要双线性过滤和纹理映射来完成它的功能，因此您可以自己滚动（我过去有）。如果您总是在处理矩形并且只需要进行缩放，那么它非常简单，并且添加旋转不会增加太多复杂性。如果你自己滚动，

希望有帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T16:28:40.670

有许多可以使用的抗锯齿方法（通常是错误的名称，顺便说一句，但那是一匹死马）。根据您对原始信号的了解以及预期用途，不同的事物最有可能为您提供所需的结果。

如果输出是通过操作系统显示工具，“来自主机操作系统的支持”可能是最明智的，因为它们拥有关于对图像所做的操作的最多信息。

我想这是一个很长的路要问你到底想做什么？许多图形库将提供某种形式的抗锯齿，它们是否合适在很大程度上取决于您要实现的目标。

# asp.net-mvc - ASP.NET MVC - CustomeAuthorize 过滤器操作使用外部网站登录用户

> ID：835672
> 
> 赞同：7
> 
> 时间：2009-05-07T16:21:01.653
> 
> 标签：asp.net-mvc, redirect, authorization, custom-action-filter

我有一个 CustomeAuthorize 操作过滤器，如果用户未通过身份验证，它会将用户转发到登录页面。我将此过滤器应用于操作或控制器。

```
[CustumeAuthorize]
public ActionResult MyAction()
{
   //do something here
   return View();
} 
```

过滤器看起来像这样：

```
public class CustomAuthorizeAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {

        if (!currentUserIsAuthenticated)
        {

            filterContext.Result =
                new RedirectToRouteResult(
                    new RouteValueDictionary{{ "controller", "Account" },
                                                 { "action", "SignIn" },
                                                 { "returnUrl",    filterContext.HttpContext.Request.RawUrl }
                                                });
        }
        else
        {
            base.OnActionExecuting(filterContext);
        }
    }
} 
```

一旦我为 filterContext.Result 分配了一个值，在过滤器执行完成后，执行（不知何故？！）重定向到 SignIn 操作并且 MyAction 不执行。这正是我想要的。

现在说我想更改我的 CustomAuthorize 以针对外部网站而不是我自己的 SignIn 操作对用户进行身份验证，所以我正在做这样的事情：

```
public class CustomAuthorizeAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {

        if (!currentUserIsAuthenticated)
        {
             filterContext.HttpContext.Response.Redirect("http://externalSite.com/login?returnUrl=" + filterContext.HttpContext.Request.RawUrl);
        }
        else
        {
            base.OnActionExecuting(filterContext);
        }
    }
} 
```

**我的问题是**，在执行完第二版 CustomAuthorize 过滤器后，继续执行 MyAction，这不是我想要的！在这种情况下，如何在过滤后停止执行 MyAction？

**-更新-**我刚遇到一个新问题。我的 MVC 应用程序位于 iFrame 中，我希望重定向在重定向后强制当前帧作为主帧，所以我正在做类似的事情：

```
string url = "http://externalSite.com/login?returnUrl=" + filterContext.HttpContext.Request.RawUrl;
filterContext.HttpContext.Response.Write("<script type=\"text/javascript\">\ntop.location.href = \"" + url + "\";</script>"); 
```

有没有办法将 javascript 传递给 RedirectResult()？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-07T16:26:07.087

使用类似于之前使用 RedirectToRouteResult 的 RedirectResult 来替换过滤器上下文中的结果。

```
filterContext.Result = new RedirectResult("http://externalSite.com/login?returnUrl=" + filterContext.HttpContext.Request.RawUrl ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-21T00:09:42.797

让我看看我是否理解 - 你有一个 iFrame，并在这个 iFrame 中执行一个动作。您想重定向到父页面，而不是在该 iFrame 内？

如果是这样，只需在您的操作中使用 Redirect(url)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-08-14T07:57:32.870

登录页面可以通过jQuery添加判断。

```
$(function () {
        if (window != top) {
            top.location.href = location.href;
        }
    }); 
```

或者

在操作“OnActionExecuting”中编辑“filterContext.Result”

```
filterContext.Result = new ContentResult() { Content = "<script>top.window.location.href='/user/Login'</script>" }; 
```

# c# - 当多个用户可以编辑相同数据时首选的数据库/webapp 并发设计

> ID：835674
> 
> 赞同：8
> 
> 时间：2009-05-07T16:21:06.537
> 
> 标签：c#, asp.net, database-design, web-applications, concurrency

我有一个内部使用的 ASP.NET C# 业务 webapp。随着我们的成长，我们遇到的一个问题是原始设计没有考虑并发检查 - 所以现在多个用户正在访问相同的数据并覆盖其他用户的更改。所以我的问题是 - 对于 webapps，人们通常使用悲观或乐观的并发系统吗？是什么促使人们偏好使用一种而不是另一种，以及需要考虑哪些设计注意事项？

我目前倾向于乐观的并发检查，因为它看起来更宽容，但我担心可能会进行多项相互矛盾的更改。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T17:16:18.980

乐观锁定。
悲观主义更难实现，并且会在 Web 环境中产生问题。什么动作会释放锁，关闭浏览器？离开会话超时？如果他们确实保存他们的更改呢？

您没有指定您正在使用哪个数据库。MS SQL 服务器有一个时间戳数据类型。不过跟时间没有关系。每次更新行时都会更改一个数字。你不需要做任何事情来确保它被改变，你只需要检查它。您可以通过使用 @KM 建议的上次修改的日期/时间来实现类似的目标。但这意味着您必须记住每次更新行时都要更改它。如果您使用 datetime ，则需要使用具有足够精度的数据类型，以确保您最终不会在应该改变的时候改变值。例如，有人保存一行，然后有人读取它，然后发生另一次保存，但修改后的日期/时间保持不变。除非需要跟踪记录上的最后修改日期，否则我会使用时间戳。

要检查它，您可以按照@KM 的建议进行操作，并将其包含在更新语句 where 子句中。或者您可以开始一个事务，检查时间戳，如果一切正常，则进行更新，然后提交事务，如果没有，则返回失败代码或错误。

保持事务打开（如@le dorfier 建议的那样）类似于悲观锁定，但锁定的数据量可能不止一行。默认情况下，大多数 RDBM 的锁都在页面级别。您还将遇到与悲观锁定相同的问题。

您在问题中提到您担心更新冲突。这就是锁定肯定会阻止的事情。如果实施得当，无论乐观还是悲观都会完全防止这种情况发生。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T17:28:09.730

I agree with the first answer above, we try to use optimistic locking when the chance of collisions is fairly low. This can be easily implemented with a LastModifiedDate column or incrementing a Version column. If you are unsure about frequency of collisions, log occurrences somewhere so you can keep an eye on them. If your records are always in "edit" mode, having separate "view" and "edit" modes could help reduce collisions (assuming you reload data when entering edit mode).

If collisions are still high, pessimistic locking is more difficult to implement in web apps, but definitely possible. We have had good success with "leasing" records (locking with a timeout)... similar to that 2 minute warning you get when you buy tickets on TicketMaster. When a user goes into edit mode, we put a record into the "lock" table with a timeout of N minutes. Other users will see a message if they try to edit a record with an active lock. You could also implement a keep-alive for long forms by renewing the lease on any postback of the page, or even with an ajax timer. There is also no reason why you couldn't back this up with a standard optimistic lock mentioned above.

Many apps will need a combination of both approaches.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T17:04:38.133

对于许多处理相同记录的人来说，这是一个简单的解决方案。

当您加载数据时，获取上次更改的日期，我们在表格上使用 LastChgDate

当您保存（更新）数据时，将“AND LastChgDate=previouslyLoadedLastChgDate”添加到 where 子句。如果更新时的行数=0，则在“其他人已保存此数据”处发出错误并回滚所有内容，否则将保存数据。

我通常只对头表而不是明细表执行上述逻辑，因为它们都在一个事务中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T16:27:56.130

我假设您遇到了“丢失更新”的问题。

作为经验法则，我使用悲观锁定来解决这个问题，当发生冲突的可能性很高（或者事务是短暂的）时，我使用乐观锁定，当发生冲突的可能性很低（或者事务是长期存在的，或者您的业务规则包含多笔交易）。

你真的需要看看什么适用于你的情况并做出判断。

# model-view-controller - 所有 MVC 平台都一样吗？

> ID：835676
> 
> 赞同：1
> 
> 时间：2009-05-07T16:21:34.523
> 
> 标签：model-view-controller

将来我将使用带有 java/j2ee、hibernate 等的 MVC，但现在我有 asp.net、php、python、ruby 等。如果我学习如何使用 MVC asp.net 或 MVC php 框架或 RoR 对 Java 版本有帮助吗？我不想等到启动 java 项目后才真正开始学习如何使用 MVC，但如果 mvc 的 .net 或 php 版本如此不同以至于这将是一次重大的重新学习，那么我可能不会使用非 java mvc 框架。

简而言之，在一个平台上学习 MVC 是否适合在所有平台上学习？我意识到工具和语言会有所不同，但我的问题是一般知识。

我讨厌以一种“特殊”的方式为一个一次性的项目工作，这种项目不会显示出未来的好处。

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T16:32:36.370

MVC 就是将您的应用程序拆分为 3 个主要部分。包含与数据库交互的大部分代码的模型，访问模型并获取所需数据的控制器，然后将其传递给视图，视图将其呈现给用户查看。

无论您选择哪种技术/框架，这个基本原则都将保持不变，只有它背后使用的技术会改变。

例如，如果您选择 PHP 路线并选择 symfony 作为您的 Web 框架，您将使用 Doctrine 或 Propel 作为您的模型/ORM。如果您使用 JBoss Seam，您将使用 Hibernate/JPA 作为您的 ORM 和 EJB 作为您的控制器。

尽管这两个框架在将逻辑与设计分离时遵循相同的规则，但它们也需要您学习非常不同的概念才能正确使用它们。

例如在 JBoss Seam 中，该框架在很大程度上依赖于您对范围以及无状态和有状态会话 bean 的了解，而在 symfony 中没有这样的概念（有点）。

所以无论你选择什么路线，在你掌握了MVC的概念之后，还有很多东西要学。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T16:32:49.770

MVC 是一种基本的软件架构模式。这只是一个抽象的概念。它的具体实现将根据您使用的语言和平台而有所不同（一切都是如此），但基本概念保持不变。

总之一句话：是的。了解 MVC 作为一个概念意味着什么，您将能够在平台和技术之间转移这些知识。

# visual-studio - 智能感知在 Visual Studio 中如何工作？

> ID：835682
> 
> 赞同：12
> 
> 时间：2009-05-07T16:22:13.180
> 
> 标签：visual-studio, intellisense

我希望这是一个有效的问题：智能感知在 VS2008 中如何工作？我正在了解它用于查找建议的算法，它何时弹出（“。”只是一个明显的触发器），如果可能的话如何修改它的行为等等。

将此问题置于上下文中：我要解决的主要问题是如何在编辑器屏幕的某些部分中激活和停用智能感知，以及如何修改它搜索的位置以填充建议框。

欢迎所有信息。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-07T16:35:17.953

看看这篇关于 CodeProject的[DIY Intellisense 文章。](http://www.codeproject.com/KB/cs/diy-intellisense.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-07T16:44:37.573

不过，对其进行逆向工程会更有趣。让我们考虑一下这个问题：

*   您需要识别感兴趣的单词
*   你需要找到可能的选项
*   你需要展示它们

现在，第一步意味着您必须解析代码。您已经获得了 C/C** 关键字，您预先解析了各种函数和类声明，并将它们加载到某种数据结构中。然后解析代码并存储类、变量等名称并将它们放在相同的数据结构中。

第二步意味着您需要一个数据结构，它可以有效地搜索部分单词并获取具有该前缀的所有单词。您可以使用正则表达式来*做到*这一点，但这不是很有效。用于这种搜索的有效数据结构是 trie，[在 SO 上](https://stackoverflow.com/questions/794601/prefix-search-in-a-radix-tree-patricia-trie/794673#794673)进行了讨论。

一旦你有了可能性列表，你就可以把它展示出来。您可能希望保留对可能性树根的引用，以便在有人键入更多字母时实时搜索它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T16:54:38.517

对于这种情况，当我需要特定行为时，有时我会使用我为[AutoHotKey](http://www.autohotkey.com/forum/topic12985.html)开发的 InteliSense 版本。这个脚本的重点是它可以与任何编辑器一起使用，或者基本上任何接受文本的控件。它通过记录文本输入并在语法文件上解释它来工作。

您也许可以将其用作您想要实现的目标的基础。我成功地将 ISense 与几种没有此类功能的语言一起使用，例如[Csound](http://en.wikipedia.org/wiki/Csound)甚至批处理脚本。可以将其扩展为支持 C#，结合使用输入监视和反射。

无论如何，使用 AHK，您甚至可以通过“获取”它呈现的项目列表并过滤它或类似的东西来控制 VS intelissense。您可能会在流程边界方面遇到一些小问题，但没有什么是无法解决的。

智能感知通常，AFAIK，使用不同的方法实现。我读到 Delphi 非常快，它通过在每个令牌上重新编译项目来实现 isense，这就是 C++ Builder 没有 isense 的原因，因为它的编译速度非常慢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T16:25:50.690

Eclipse 也有这个特性，它是一个开源项目。为什么不通过实际查看代码来检查 Eclipse 是如何做到的呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T16:30:12.693

这个问题太笼统了。由于 VS IDE 开箱即用支持多种不同的语言，并且有 N 种支持替代智能感知的 DSL 和 IDE 增强功能，这意味着有很多答案。如果您专门谈论 C#，请参阅工具 | 选项 | 文本编辑器 | C# | Intellisense 区域可查看完成选项的可用选项。就所使用的算法而言，您将寻找程序集的元数据、类型成员的丰富缓存、为特定类型选择的最后一个成员的 MRU 列表等。如果您有更具体的问题，我建议你澄清。

[请参阅此处](http://www.codeplex.com/IronPython)的 DSL (ironpython) 示例及其实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T16:50:51.847

我没有在 VS 中看到任何限制 IntelliSense 显示位置的文本编辑器。这都是特定于语言的。如果您的光标位于 IntelliSense 可能有助于生成有效令牌的位置，则将使用它。

我相信与正在使用的项目系统有一些交互，但据我所知。我也相信 Visual Studio SDK 中有一个示例项目系统，这可能会给你一个想法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T18:27:57.950

至于你如何改变它的外观问题，简短的回答是，你不能。大多数情况下，Intellisense 是由项目中包含的程序集的反射提供的（以及 C++ 的一些其他技巧）。您得到的是 VS 处理您包含的所有程序集和 GAC 中的所有程序集的结果。

也就是说，如果您想从您正在处理的项目中提供明确的智能感知结果，请查看[IVsContextualIntellisenseFilterProvider](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.shell.interop.ivscontextualintellisensefilterprovider(VS.80).aspx)

最后，有关幕后流程的一些见解，请查看[此博客文章](http://blogs.msdn.com/vsdteam/archive/2006/06/09/624131.aspx)

# javascript - 文本溢出时选取文本

> ID：835684
> 
> 赞同：4
> 
> 时间：2009-05-07T16:22:30.543
> 
> 标签：javascript, jquery, html, css, marquee

那么继承人我的问题。假设我有 3 个 div 标签，都是 100 像素宽：

```
<--- DIV WIDTH --->
Text in div 1
Text in div two, it overflows
Text in div three
<--- DIV WIDTH ---> 
```

现在，目前我有这个用于 div 的 CSS：

```
width:100px;
overflow:hidden; 
```

我想要做的是如果文本溢出，它会像选框一样滚动，所以如果你稍等一下，所有的文本都可以看到。但我只希望字幕显示文本是否溢出。

我该怎么做？

谢谢，托尼

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T16:54:27.923

解决条件部分

## JS

```
var el = $('your element');
if (el.get(0).scrollWidth > el.width()) {
    // Your marquee code here
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T16:51:20.490

```
$(function(){
  $box = $('div.box');
  $box.children().each(function(){
    if ($box.width() < $(this).width()) {
      $(this).wrap('<marquee>');
    }
  )};
}); 
```

可以在 jQuery 中工作（我还没有检查过。如果你有任何问题，请回复）。或者，您可以在 css 中设置滚动属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-13T08:43:21.633

条件部分可以像rennat建议的那样轻松解决。

你可以使用jQuery吗？如果是，请构建与[jQuery marquee 插件](http://remysharp.com/demo/marquee.html)兼容的 html ，然后调用 $(element).marquee(); 为动画。它比 ' `<marquee>`' 标签更好，因为它只使用具有适当 css 属性的 div（避免使用非标准标签）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T16:53:27.037

如所描述的那样，这对您的问题不起作用（div 中的纯文本），但如果这只是最小的情况，您可以使用`overflow: auto`，如果溢出，它将添加一个水平滚动条。

（还要注意 marquee 是一个非标准的 HTML 标签。）

# user-interface - 在 MVP 界面模式中划分已经变得太大的演示者的好做法是什么？

> ID：835696
> 
> 赞同：3
> 
> 时间：2009-05-07T16:25:19.490
> 
> 标签：user-interface, refactoring, mvp

我最近经常遇到的一个问题是我的演讲者班级变得太大的问题。通常情况下，我可以在不跳过节拍的情况下砍掉一堂普通的大课。但是演示者有时更难削减，而不会使代码更难遵循。

特别是当页面开始填充面向 CRUD 的控件时。有时我会划分控件，但如果它们受到其他控件的影响，则协调逻辑本身就很复杂。有时我会划分列表或网格数据检索，但有时可能会有类似的陷阱。

是否有任何技术、经验法则或您从演示者中重构出来的公共区域？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-07T16:58:39.240

我通常使用两种方法：

1.  提取业务规则并将其委托给域类。
2.  将视图分区为逻辑相关的控件，然后为每个分区创建一个新的视图界面。然后，您可以沿着这些相同的路线拆分您的演示者。如果您使用的平台支持子表单组件组（C# 用户控件、Delphi 框架等），这是制作可重用控件的强大方法。

**更新**

拆分视图时，我通常首先拆分界面并让我的表单实现多个界面。

```
public class ComplexForm: Form, ISubView, IOtherSubView
{
    ...
} 
```

然后我将演示者分成我创建的许多视图。

```
public class SubViewPresenter
{
    private ISubView subView;
    ...
}

public class OtherSubViewPresenter
{
    private IOtherSubView otherSubView;
    ...
} 
```

您可以更进一步，将 ISubView 和 IOtherSubView 的实现移至用户控件或保持原样。如果您使用的是**被动视图**模式，这只是小菜一碟，因为表单无论如何都只处理 UI 逻辑。一旦我拆分了演示者，我会尽量避免演示者之间的直接交流。如果需要任何通信，我会尝试通过域对象间接进行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T16:44:40.350

尝试提取在将数据传递到 DAL 或将其推送到视图之外执行活动的代码。例如，如果您必须进行电子邮件更新或执行业务逻辑，请尝试将它们提取到单独的类中。我经常处理同样的问题，并且一直在尝试将尽可能多的逻辑转移到各个域/实体类并在那里执行验证。

希望这会有所帮助。

# maven-2 - 有没有办法在 Maven 中只跳过一个测试？

> ID：835705
> 
> 赞同：75
> 
> 时间：2009-05-07T16:26:51.967
> 
> 标签：maven-2, surefire

我想在启动时只跳过一个测试`mvn install`。

有没有办法做到这一点 ？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2016-06-13T15:55:42.843

`-Dtest`您可以通过在选项前面加上`!`（感叹号）来指定排除模式。例如，

```
mvn -Dtest=\!FlakyTest* install 
```

[在这里](https://issues.apache.org/jira/browse/SUREFIRE-131)找到它并验证它可以正常工作。例如，我可以通过使用以下方法跳过[这个](https://issues.jenkins-ci.org/browse/JENKINS-29150)易碎的 Jenkins 测试：

```
mvn -Dtest=\!CronTabTest* package 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-05-07T16:49:24.783

使用 junit 4，`@Ignore`当我想这样做时，我会添加一个注释。这对你有用，除非你只想有时忽略测试，或者只在构建从 maven 运行时忽略它。如果是这种情况，那么我会问“为什么？”

测试*应该*是一致的，它们*应该*是可移植的，并且*应该*始终通过。如果一个特定的测试有问题，我会考虑重写它，完全删除它，或者将它移到不同的测试套件或项目中。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2013-09-26T09:25:21.250

需要排除集成测试但需要包含单元测试是正常的。为了实现这一点，我建议使用后缀IntegrationTest（例如AbcIntegrationTest.java）命名所有集成测试。

然后在您的 Maven 构建中放置以下内容：

```
 <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <configuration>
                <excludes>
                    <exclude>**/*IntegrationTest.java</exclude>
                </excludes>
            </configuration>
        </plugin> 
```

当您使用它构建时，所有集成测试都将被排除，但所有其他测试（例如单元测试）都会运行。完美的 ：-）

有关在测试运行期间排除和包括测试的更多信息，请阅读

[http://maven.apache.org/surefire/maven-surefire-plugin/examples/inclusion-exclusion.html](http://maven.apache.org/surefire/maven-surefire-plugin/examples/inclusion-exclusion.html)

PS 要排除一个测试，您只需在排除列表中明确命名它。简单的。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2018-10-26T12:18:11.443

如果您想使用 CLI 排除一个测试，您应该使用`-Dtest`and`-Dit.test`标志。

小心重置默认值。当您使用该`!`符号时，所有默认值都将被删除，您应该将它们放回原处。对于您执行的正常测试`surefire`应添加`*Test, Test*, *Tests, *TestCase`，而对于`failsafe`您执行的集成测试应添加`IT*, *IT, *ITCase`.

您可以在此处找到更多信息[https://maven.apache.org/surefire/maven-surefire-plugin/examples/inclusion-exclusion.html](https://maven.apache.org/surefire/maven-surefire-plugin/examples/inclusion-exclusion.html)（正常测试）

在这里[https://maven.apache.org/surefire/maven-failsafe-plugin/examples/inclusion-exclusion.html](https://maven.apache.org/surefire/maven-failsafe-plugin/examples/inclusion-exclusion.html)（集成测试）

`-Dit.test='!ITsometestIT, IT*, *IT, *ITCase'`

一个完整的`mvn`命令可能是这个：

`mvn -e -B -Dtest='!unitTestABC, *Test, Test*, *Tests, *TestCase' -Dit.test='!ITintegrationTestABCIT, IT*, *IT, *ITCase' -DfailIfNoTests=false clean install`

记住使用`'`而不是`"`。当使用双引号时，其中的任何`!`内容都将由`bash`.

还要记住，集成测试在`mvn test`. `mvn verify`仅运行集成测试而不运行单元测试

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-12-09T07:31:49.637

看看[这个解决方案](https://dzone.com/articles/grouping-tests-using-junit)，使用`@Category`注释

```
public class AccountTest {

    @Test
    @Category(IntegrationTests.class)
    public void thisTestWillTakeSomeTime() {
        ...
    }

    @Test
    @Category(IntegrationTests.class)
    public void thisTestWillTakeEvenLonger() {
        ...
    }

    @Test
    public void thisOneIsRealFast() {
        ...
    }
} 
```

然后您使用测试套件运行它：

```
@RunWith(Categories.class)
@IncludeCategory(SlowTests.class)
@SuiteClasses( { AccountTest.class, ClientTest.class })
public class LongRunningTestSuite {} 
```

您还可以使用 maven包含 ( `groups`) / exclude ( ) 那些测试，例如：`excludedGroups`

```
mvn -DexcludedGroups=com.mycompany.tests.IntegrationTests test 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-19T07:23:06.363

我认为如果使用此命令，这应该可以工作：

```
mvn archetype:create -DgroupId=test -DartifactId=test 
```

（用于测试将 pom.xml 和 test-class 更改为以下并使用 mvn install）

pom.xml

```
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
<modelVersion>4.0.0</modelVersion>
<groupId>test</groupId>
<artifactId>test</artifactId>
<packaging>jar</packaging>
<version>1.0-SNAPSHOT</version>
<name>test</name>
<url>http://maven.apache.org</url>
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <configuration>
                <source>1.5</source>
                <target>1.5</target>
            </configuration>
        </plugin>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <configuration>
                <excludes>
                    <exclude>
                        test/AppTest.java
              </exclude>
                </excludes>
            </configuration>
        </plugin>
    </plugins>
</build>
<dependencies>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.5</version>
        <scope>test</scope>
    </dependency>
</dependencies> 
```

测试类：

```
package test;
import org.junit.Test;
import static org.junit.Assert.fail;
public class AppTest 
{
    @Test
    public void test_it() {
        fail("not implemented");
    }
} 
```

# ruby-on-rails - Ruby on Rails 问答网站

> ID：835710
> 
> 赞同：1
> 
> 时间：2009-05-07T16:27:39.953
> 
> 标签：ruby-on-rails, web-applications, collaboration

有没有人知道一个很好的教程或应用程序来询问和回答关于 Ruby on Rails 的问题，就像这个网站一样（尽管它最终可能会用于非常不同的目的）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T19:09:27.757

如果您对构建这个应用程序很认真，我只能建议您学习 Ruby on Rails 并自己构建它，而不是寻找教程。有很多很棒的学习材料，并且假设您对 Ruby 编程有相当的了解，Rails 非常容易上手。就书籍而言，[使用 Rails 进行敏捷 Web 开发](http://www.pragprog.com/titles/rails3/agile-web-development-with-rails-third-edition)肯定会得到我的推荐。

无论哪种方式，[Rails 指南](http://guides.rubyonrails.org/)都可能是一本不错的入门读物，它将帮助您了解 MVC 的基础知识以及如何构建一个简单的 Rails 应用程序，这样您就可以开始构建自己的应用程序了。如果您遇到任何问题，请在此处发布您的问题，我相信您会得到您正在寻找的答案。

即使存在用于构建各种应用程序的教程，了解正在发生的事情以及如何围绕您的特定需求构建应用程序也非常重要。

# c# - 在 ASP.Net MVC 中处理动态重定向路由所需的建议

> ID：835713
> 
> 赞同：2
> 
> 时间：2009-05-07T16:27:51.373
> 
> 标签：c#, asp.net-mvc

我有许多创建和删除部分视图，我想通过从其他视图调用来重用它们。问题是这需要我将返回路由和 routeValues 传递给 create 和 delete 控制器方法，以便它们可以在成功时生成适当的重定向回原始视图。我创建了一些扩展和助手来保持整洁，但以这种方式解决问题似乎很复杂。我错过了什么吗？当（重定向）控制器、动作和 routeValues 可以变化时，是否有一种简单的 RedirectToAction 方法？

为清楚起见的示例：产品 AZ 索引视图和产品*SomeCategory*索引视图都有一个删除按钮，该按钮调用删除视图（它显示“你真的要删除”消息），它有一个“真正删除”按钮，可以发回给产品控制器中的实际（POST）删除方法。一旦产品被删除，我们需要返回一个 RedirectToAction，但由于“AZ Index”和“ *SomeCategory* Index”视图都有一个删除链接，我们必须动态地将操作、控制器和 routeValues 设置为最初称为删除的任何视图。

这并不困难，但是在处理删除的所有控制器和视图周围传递重定向值非常复杂，因此必须有一种更明智的方法来做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-11T02:04:12.530

在 Delete 操作（显示确认视图的操作）中查询 Request.UrlReferrer 并将引用者详细信息存储在临时数据中。

在删除操作中，从临时数据中读取引荐来源网址详细信息，并使用 Redirect(string) 重载重定向到将用户引向原始删除请求的 url。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T16:44:08.120

你考虑过使用 RedirectToRoute

```
RedirectToRoute(new {controller = "MyController", Action = "Create", id = ""}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-09T08:44:32.337

考虑不要对“删除确认”使用整体视图。使用 Html 助手和 javascript 'confirm()'。IE。使用帮助程序呈现帖子表单并删除链接，以便当用户单击“删除”时，他们会收到一个 js 确认提示“确定删除？” 并且确定函数“返回true”并调用表单上的提交以删除。然后删除操作只是重定向到它通常会的位置。我希望您对尝试删除的不同对象使用不同的删除操作。如果您的计划是进行通用删除操作，那会更难（并且不推荐 IMO）。

我的删除助手包含很多东西，但删除部分看起来像这样（带有剪辑）：

```
 string deleteLink = String.Format(@"<a onclick=""deleteRecord({0})"" href='#'>Delete</a><form id='deleteForm' method='post' action='" +
             routeRelativePath + "/" + actionPrefix + "Delete/" + model.ID +
            @"'></form>", model.ID); 
```

..它（助手）也附加了一些js：

```
 function deleteRecord(recordId) {  
    if(confirm('Are you sure you want to delete this {friendlyModelName}?\nNOTE: There is no Undo.')) {
        // Perform delete  
        var action = "{routeRelativePath}/{actionPrefix}Delete/" + recordId;  

        // jQuery non-AJAX POST version
        $("form#deleteForm").submit();
    }
} 
```

..您可以看到帮助程序创建了删除链接，其中包含路线和 ID 等的所有参数。js 只需执行“确认”部分，然后提交您可以看到由帮助程序创建的微小信息。

[对不起，如果样本不是 100% 完整 - 我不得不删除很多东西：例如，帮助程序和附加的 js 有许多不同的模式，以便支持 ajax POST 等]

# vb.net - Process.Start 上的“目录名称无效”错误？

> ID：835717
> 
> 赞同：1
> 
> 时间：2009-05-07T16:28:37.207
> 
> 标签：vb.net, credentials, start-process

我正在编写一个启动程序，当我开始该过程时，我收到“目录名称无效”错误。这是启动该过程的代码：

```
Const DEBUG_ROOT = _ 
"Z:\Kiosk_JC\KioskSignIn.root\KioskSignIn\KioskSignIn\KioskSignIn\bin\Debug"

Dim oKiosk As New System.Diagnostics.Process
oKiosk.StartInfo.UserName = oEnc.Decrypt(Username)
oKiosk.StartInfo.Password = oEnc.DecryptSecure(Password)
oKiosk.StartInfo.Domain = oEnc.Decrypt(Domain)
''// The AddBS function appends a '\' to the passed string if it is not present
oKiosk.StartInfo.WorkingDirectory = AddBS(DEBUG_ROOT)
oKiosk.StartInfo.FileName = "KioskSignIn.exe"
oKiosk.StartInfo.UseShellExecute = False
Dim proc As Process = Nothing
proc = System.Diagnostics.Process.Start(oKiosk.StartInfo) 
```

我在这里看到另一个问题，我需要设置 WorkingDirectory（在我开始搜索之前我得到了错误）。即使我设置了此属性，我仍然收到错误消息。有什么想法吗？

## 更多信息

我还应该注意我的 Z:\ 在我的网络上。我有一个解析 UNC 路径的函数。当我在 DEBUG_ROOT 上运行这个函数时，我得到了同样的错误。

我尝试将应用程序移至 c:\kiosk。结果相同。我以我模拟的用户身份登录，因此我可以访问所有共享和文件。

这是链接，由于某种原因，URL 格式想要消耗指定链接后的所有文本：

[推荐帖子](https://stackoverflow.com/questions/777976/why-does-impersonating-a-process-return-the-directory-name-is-invalid/778021#778021)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:40:14.633

映射的驱动器是每个用户的。您可能会使用不同的用户开始该过程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-03T07:13:20.863

我得到了和你一样的错误。您用来运行进程的用户很可能无权访问指定的资源（exe 文件）

尝试将您的 exe 移动到其他位置和/或授予您的用户对该文件的访问权限。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T16:38:44.327

听起来进程看不到 Z: 驱动器或没有安全访问权限。应用程序在什么用户环境下运行？也许 Z: 驱动器在这种情况下不可用。

# ruby-on-rails - Rails 部分图像渲染

> ID：835726
> 
> 赞同：1
> 
> 时间：2009-05-07T16:29:34.660
> 
> 标签：ruby-on-rails, ruby, model, partial

我正在加快速度，遇到了一个奇怪的问题。我正在从数据库中渲染一些图像（附加到另一个模型的图像模型，植物）。尝试通过部分进行时我遇到了一些麻烦。我有 show.html.erb

```
 <fieldset class="fieldset">
      <legend>Images</legend>
      <%=  unless @plant.images.blank? then
                for image in @plant.images
                     debugger 
                     render :partial => 'show_image', :object => image 
                end
           else
                "This plant has no images to display."
           end
      %>
 </fieldset> 
```

和部分 _show_image.html.erb：

```
 <div class="image_container">
      <% debugger %>
      <img src="<%= url_for(:action => 'picture', :id => object.id) %>"/> 
      <p class='image_caption'><%= object.comment %></p> 
 </div> 
```

当它被渲染时，它只是为每个图像渲染一个“#”，而不是实际的图像。它似乎只是将对象呈现为字符串，如我得到的源代码所示：

```
 <fieldset class="fieldset">
      <legend>Images</legend>
      #<Image:0x242c910>
 </fieldset> 
```

在本地通过调试器运行时：

```
 /Users/*****/dev/plantmanager/app/views/plants/show.html.erb:54
 debugger
 (rdb:241) image
 #<Image id: 40, comment: "Test", name: "Ixia.gif", content_type: "image/gif", data: "GIF89a2\0002\000####$\205\233\tI\250\"x\224\b?\206\031d|ju####\v\031###\247\bI\257G\222\232\222\227\263\262...", plant_id: 55, thumbnail: nil> 
 (rdb:221) @plant
 #<Plant id: 55, name: "Test", description: "Test", created_at: "2009-05-07 07:19:44", updated_at: "2009-05-07 07:19:44", planted: "2009-05-07 00:00:00", sprouted: "2009-05-15 00:00:00", plant_type_id: 1, finished: "2009-05-27 00:00:00">
 (rdb:221) @plant.images
 [#<Image id: 40, comment: "Test", name: "Ixia.gif", content_type: "image/gif", data: "GIF89a2\0002\000####$\205\233\tI\250\"x\224\b?\206\031d|ju####\v\031###\247\bI\257G\222\232\222\227\263\262...", plant_id: 55, thumbnail: nil>]
 (rdb:221) continue
 /Users/*****/dev/plantmanager/app/views/plants/_show_image.html.erb:2
 <% debugger %>
 (rdb:221) object
 #<Image id: 40, comment: "Test", name: "Ixia.gif", content_type: "image/gif", data: "GIF89a2\0002\000####$\205\233\tI\250\"x\224\b?\206\031d|ju####\v\031###\247\bI\257G\222\232\222\227\263\262...", plant_id: 55, thumbnail: nil>
 (rdb:221) object.id
 40
 (rdb:221) object.comment
 "Test"
 (rdb:221) continue 
```

这是我的模型[剪断一点]：

```
class Plant < ActiveRecord::Base
     has_many :images

     validates_presence_of :name
     validates_presence_of :plant_type_id
     validates_associated :images

     after_update :save_images

     def image_attributes=(image_attributes)
          image_attributes.each do |attributes|
               # TODO: Probably handle validation in the image model?
               if attributes[:id].blank?
                   unless attributes[:uploaded_picture].blank?
                        tmpImg = images.build()
                        tmpImg.uploaded_picture=attributes[:uploaded_picture]
                        tmpImg.comment = attributes[:comment] 
                   end
               else
                   img = images.detect { |i| i.id == attributes[:id].to_i }
                   img.attributes = attributes
                end
           end
      end

      def save_images
           images.each do |i|
                if i.should_destroy?
                     i.destroy
                else
                     i.save(false)
                end
           end 
      end
 end

 class Image < ActiveRecord::Base 
      validates_format_of :content_type, 
                          :with => /^image/, 
                          :message => "--- you can only upload pictures" 

      attr_accessor :should_destroy

      def should_destroy?
           should_destroy.to_i == 1
      end

      def uploaded_picture=(picture_field)
           self.name = base_part_of(picture_field.original_filename) 
           self.content_type = picture_field.content_type.chomp 
           self.data = picture_field.read
           #image = MiniMagick::Image.from_blob self.data
           #self.thumbnail = resize_and_crop(image, 100).to_blob
      end 

      def base_part_of(file_name) 
           File.basename(file_name).gsub(/[^\w._-]/, '') 
      end
 end 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T16:40:47.537

试试这个：

```
<%  unless @plant.images.blank?
                for image in @plant.images
%>
                     <%= render :partial => 'show_image', :object => image %>
                <% end
           else %>
                This plant has no images to display.
           <% end %> 
```

对不起格式，但你明白了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T19:23:23.573

为您的图像模型中的图片构建一个方法

```
class Image < ActiveRecord::Base
   belongs_to :plant
   validates_presence_of :uploaded_picture
   ...
end 
```

在您的植物控制器中

```
def plant_pic
  img = Image.find(params[:id])      
  # THE NEXT LINE IS THE ONE I THINK YOU ARE MISSING:
  send_data img.uploaded_picture, :filename =>"plant#{img.plant_id}_#{img.id.to_s}+'.jpg', 
                                  :type => 'image/jpeg', 
                                  :disposition => 'inline'
end
... 
```

然后在您的植物视图中：

```
<fieldset class="fieldset">
  <legend>Images</legend>
  <% if plant.images.blank? -%>
  <p>This plant has no images to display.</p>
  <% else %>
    <%= @plant.images.each do |image| %>
      <div class="img_container"> 
      <img src="<%= url_for(:action => 'plant_pic', :id => image.id) %>"/>
      </div>
    <% end -%>
  <% end -%>
</fieldset> 
```

您可能想在图像控制器中以某种方式对 upload_picture 二进制字段进行编码/解码（我使用 Base64.encode 和 Base64.decode），但这是另一个问题。

希望对你有帮助

# c - OpenGL tex-mapping：整个对象是单个纹素的颜色

> ID：835729
> 
> 赞同：0
> 
> 时间：2009-05-07T16:30:07.357
> 
> 标签：c, opengl, texture-mapping

我一直在尝试让 HUD 纹理为模拟器显示一段时间，但没有成功。

首先我像这样绑定纹理：

```
glGenTextures(1,&hudTexObj);
gHud = getPPM("textures/purplenebula/hud.ppm",&n,&m,&s);
glBindTexture(GL_TEXTURE_2D,hudTexObj);
glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_REPEAT);
glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_REPEAT);
glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST); 
//glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
glTexImage2D(GL_TEXTURE_2D,0,GL_RGB,n,m,0,GL_RGB,GL_UNSIGNED_INT, gHud); 
```

然后我尝试将它映射到一个 QUAD，这导致整个四边形为单一棕色，我希望它使用所有的纹素。这是我的映射方式：

```
 glBindTexture(GL_TEXTURE_2D,hudTexObj);

glBegin(GL_QUADS);
glTexCoord2f(0.0,0.0);
glVertex2f(0,0);

glTexCoord2f(0.0,1.0);
glVertex2f(0,m);

glTexCoord2f(1.0,1.0);
glVertex2f(n,m);

glTexCoord2f(1.0,0.0);
glVertex2f(n,0);
glEnd(); 
```

奇怪的是，我已经能够获得上面的代码来在它自己的程序中显示纹理，但是当我把它放到我的主程序中时它失败了。它可能与纹理矩阵有关吗？此时我傻眼了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T20:51:53.173

愚蠢的是，我在代码的另一部分启用了自动 tex 坐标生成。因此，如果您看到一个纹素的颜色覆盖了整个图像，这可能是原因。

# iphone - 如何让我的 Nib 正确加载我自定义的 UIScrollView 子类？

> ID：835735
> 
> 赞同：3
> 
> 时间：2009-05-07T16:31:19.210
> 
> 标签：iphone, cocoa-touch, uikit, interface-builder, nib

我的笔尖里面有一个不错的 UIScrollView，效果很好。然后我有一些非常特殊的需求和子类化 UIScrollView。在我的 Nib 中，我将身份检查器中的类更改为我的子类。

但是由于某种原因，当 nib 加载器从 nib 构建所有这些对象时，我的 -initWithFrame: 方法永远不会被调用。实际上我现在在我的子类中没有改变任何东西。滚动视图工作正常。期望它似乎是一个空白的 UIScrollView，即使我告诉笔尖它应该是一个用于测试目的的 SpecializedUIScrollView。

在将 UIScrollView 子类化同时仍使用 Nib 文件将其置于透视图中时，我还必须考虑其他一些事情吗？

我的专用初始化程序如下所示：

```
- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        NSLog(@"Hello !!!!!!!!!!!!!");
    }
    return self;
} 
```

如果我尝试从 Nib 加载它，我永远不会在控制台中看到 Hello。当然，如果我自己分配和初始化它，它就可以工作。但是我不想以编程方式定位我的滚动视图，如果我可以使用那个该死的很酷的界面生成器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T17:02:18.670

nib 或 xib 中的对象存储为序列化对象，这可能意味着您必须使用该`awakeFromNib`方法，因为从不调用 init 方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-29T20:41:28.130

Extend **`initWithCoder`**，一定要调用 super 方法。正是在这个超级呼叫期间**`setFrame`**，您的班级将被呼叫。

然后，您可以重新使用您的标准**`initWithFrame`**调用**`initWithCoder`**，界面生成器将控制帧大小。

```
- (id)initWithCoder:(NSCoder *)aDecoder {
    [super initWithCoder:aDecoder]; // Required. setFrame will be called during this method.
    return [self initWithFrame:[self frame]];
} 
```

# sharepoint - 将 SharePoint 对象作为函数参数传递。这很糟糕吗？

> ID：835739
> 
> 赞同：0
> 
> 时间：2009-05-07T16:32:29.257
> 
> 标签：sharepoint, moss, sharepoint-2007

我正在构建一个 webpart，其中包含一个以 SPList 作为一个参数的函数。正在通过的列表会随着时间的推移而增长，这让我担心可扩展性问题。我应该担心使用这种方法的潜在性能问题吗？

如果您能提供与我的问题有关的其他 SharePoint 对象（SPSite 等）的任何见解，或提供进一步阅读该主题的链接，我将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:43:41.477

为什么这会是个问题？您是否希望在调用该函数时会复制列表中的数据？不会的。SPList 是对 SPList 对象的引用，您只需复制该引用。

否则，我想不出为什么会有可扩展性问题。请说明您认为可能存在的原因。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T18:36:13.513

如果您想深入了解 SharePoint 对象的性能，您应该阅读有关 SPSite 和 SPWeb 处理的信息。每个 SharePoint 开发人员都应该知道这些。

[http://blogs.msdn.com/rogerla/archive/2008/02/12/sharepoint-2007-and-wss-3-0-dispose-patterns-by-example.aspx](http://blogs.msdn.com/rogerla/archive/2008/02/12/sharepoint-2007-and-wss-3-0-dispose-patterns-by-example.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-11-18T17:13:37.223

为了添加到 John Saunders 的答案，诸如 SPList 之类的对象在实例化时实际上并没有在内存中创建所有数据的列表。相反，它会创建与列表数据存储在数据库中的位置的连接，并且对该对象的任何调用都会在后端触发它自己的 SQL。本质上，SPList 对象本身就是一个引用。将其作为参数传递是可以的！

# smtp - 如何通过 SMTP 中继延迟邮件传递，可能是 sendmail

> ID：835743
> 
> 赞同：0
> 
> 时间：2009-05-07T16:34:37.753
> 
> 标签：smtp, sendmail

我需要通过 SMTP 中继延迟邮件传递。

IE

在时间 T 成功接收到邮件消息。在时间 T+4 小时将消息转发到目的地。

这在 sendmail 或任何其他 SMTP 中继中是否可能。

部署平台是 IBM AIX。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T17:22:23.457

你的问题至少应该更具体一点。无论如何我都会提出一些建议。

如果您只想每四个小时发送一次邮件，则必须以仅队列模式运行 sendmail（QUEUE_MODE="cron"; 在 sendmail.conf 中）并将队列设置为每四个小时运行一次（QUEUE_INTERVAL="4h" ;)。我认为，这仅适用于类似 debian 的系统，但原理在任何地方都是相同的 - 您将队列模式设置为 cron（这实际上是由启动 sendmail 的参数控制），然后定期处理它。

如果您只想延迟邮件传递，也有多种方法可以做到这一点，具体取决于您要这样做的原因*。*一种流行的解决方案是*graylisting*，它只是执行以下操作 - 当主机连接到您的 MTA（sendmail，f.ex.）时，它会被退回，并提示您在某个时间间隔内重试。正确配置的邮件程序会这样做 - 它会尝试再次发送邮件，最终邮件将被接受并传递（或转发）。另一方面，大多数垃圾邮件机器人在收到错误后不会尝试重新发送邮件。如果您需要将 sendmail 列入灰名单，您可以在此处阅读：http: [//www.greylisting.org/implementations/sendmail.shtml](http://www.greylisting.org/implementations/sendmail.shtml)

希望这至少有一点帮助。

编辑：

好的，*现在*我知道你需要做什么了。这是使用 sendmail 的可能解决方案（多年来，我一直在以一种或另一种方式处理 sendmail，所以.. :P）：您使用其中两个。

第一个只是接收邮件并将其排队，并且（这很重要）它不会处理队列。第二个 sendmail 实例运行一个单独的队列，它的 QUEUE_MODE 设置为 daemon 或 cron（例如，每分钟）。现在您只需要编写一个外部脚本，一旦达到消息的“年龄”，它将把邮件从第一个队列移动到第二个队列。由于队列项目只是文件，因此这是一项简单的任务，只需几行，例如 perl 即可完成（地狱，shell 脚本也可以做到这一点）。将队列项从一个队列移动到另一个队列就像将文件从一个目录移动到另一个目录一样简单。请注意，这种技术被广泛用于邮件处理解决方案，例如 spamassassin，所以它不是什么奇怪的东西，由我病态的头脑想到：P

希望这能给你一两个提示。

# colors - 将灰度值转换为 RGB 表示？

> ID：835753
> 
> 赞同：24
> 
> 时间：2009-05-07T16:37:38.900
> 
> 标签：colors, rgb, grayscale

如何将灰度值 (0-255) 转换为 RGB 值/表示？它用于 SVG 图像，它似乎没有灰度支持，只有 RGB ......

注意：这不是 RGB -> 灰度，已在另一个问题中回答，例如[Converting RGB to grayscale/intensity](https://stackoverflow.com/questions/687261/converting-rgb-to-grayscale-intensity)）

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-07T16:42:15.597

快速而肮脏的方法是为 RGB 的每个分量重复灰度强度。因此，如果您的灰度为 120，它会转换为 RGB（120、120、120）。

这是快速而肮脏的，因为您获得的有效亮度取决于您正在使用的设备的 R、G 和 B 子像素的实际亮度。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-08-13T13:01:56.440

如果您的灰度值在 0..255 范围内，并且想要以 0x00RRGGBB 的形式生成一个新值，那么执行此操作的快速方法是：

```
int rgb = grey * 0x00010101; 
```

或您选择的语言的同等语言。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-05-07T16:45:18.820

灰度到 RGB 的转换很简单。只需使用 R = G = B = 灰度值。基本思想是颜色（在显示器上以 RGB 表示）是一种加法系统。

[http://en.wikipedia.org/wiki/Additive_color](http://en.wikipedia.org/wiki/Additive_color)

因此将红色添加到绿色会产生黄色。在混合物中加入等量的蓝色，你会得到中性色。Full on [red, green, blue] = [255 255 255] 产生白色。[0,0,0] 产生监视器黑色。中间值，当 R=G=B 都相等时，将产生给定灰度级别的名义上中性色。

一个小问题取决于您如何看待颜色，它可能不是完全中性的。这取决于您的显示器（或打印机）的校准方式。我们可以从这一点进入色彩科学的有趣深度。我会停在这里。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-07T16:41:02.700

灰度意味着所有值都具有相同的强度。将所有通道（以 RGB 为单位）设置为等于灰度值，您将获得 RGB 黑白图像。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-07T16:42:01.900

Woudln 将 R、G 和 B 设置为每个像素的相同值（灰度值）不会为您提供正确的灰色阴影吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-30T09:04:34.437

你也可以看看我的解决方案[Faster assembly optimization way to convert RGB8 image to RGB32 image](https://stackoverflow.com/questions/12004437/faster-assembly-optimized-way-to-convert-rgb8-image-to-rgb32-image)。灰色通道只是在所有其他通道中重复。

目的是找到使用 x86/SSE 进行转换的最快可能解决方案。

# open-source - 数据挖掘开源工具

> ID：835754
> 
> 赞同：27
> 
> 时间：2009-05-07T16:37:50.193
> 
> 标签：open-source, data-mining

我将从事一个数据挖掘项目。在开始之前，我想探索不同的数据挖掘工具（最好是开源的），这些工具允许基于 Web 的报告。在我的场景中，数据将提供给我，所以我不应该为它爬行。

简而言之，我正在寻找一种工具——数据分析，基于 Web 的报告，提供某种仪表板和挖掘功能。

我曾在 Microsoft Analysis Services 和 BOXI 工作过，最近我一直在研究 Pentaho，这似乎是一个不错的选择。

请分享您对任何您知道的此类工具的经验。

干杯

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-07T16:55:58.233

我相信 WEKA 是目前最好的开源 DM 软件。

检查它：[http ://www.cs.waikato.ac.nz/ml/weka/](http://www.cs.waikato.ac.nz/ml/weka/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-09-10T04:15:18.287

Weka 很棒，但您可能想尝试使用 Orange Data Mining 工具包。

[http://www.ailab.si/orange/](http://www.ailab.si/orange/)

**编辑：**截至 2010 年 11 月，我必须说我真的很喜欢[KNIME](http://knime.org)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-05-31T08:48:19.597

**[RapidMiner](http://www.RapidMiner.com/)**是我首选的数据挖掘工具。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-09-18T20:32:38.427

[R](http://www.r-project.org/)有很多与数据挖掘相关的优秀软件包。特别是，看看：

*   [CRAN 上的机器学习视图。](http://cran.r-project.org/web/views/MachineLearning.html)
*   [CRAN 上的自然语言处理视图。](http://cran.r-project.org/web/views/NaturalLanguageProcessing.html)

它还与 Weka 相关联（[请参阅 RWeka 包](http://cran.r-project.org/web/packages/RWeka/index.html)）。它可以与 .Net（通过 COM）或 Python（通过 RPy 或 RPy2）集成。

我同意将 Pentaho 作为报告平台，尽管它是一个非常大的项目，具体取决于您使用它的目的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-03-09T15:45:00.820

您还应该查看[Apache Mahout](http://lucene.apache.org/mahout/)。它对于一些大规模的机器学习任务（例如用户聚类）非常有用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-02-12T08:31:41.170

KEEL ( [http://keel.es](http://keel.es) ) 是用 Java 编写的，非常适合使用进化计算进行数据挖掘。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-11-03T04:11:29.100

我会尝试使用新的谷歌工具。

-首先您需要获取 google-storage 的 api id，这是您要存储和操作要分析的数据的地方。

-然后您需要获取 google-prediction-api (http://code.google.com/apis/predict/docs/getting-started.html) 的 api id，在我看来这是一个很棒的外包数据挖矿处理器。预测 API 允许您从数据中获取更多信息，并使其模式更易于访问。除了使用传统的数字和名义数据外，您还可以使用文本数据，借助此 api 可以利用例如按语言对电子邮件进行分类。

- 最后，您可以使用 bigQuery，它允许您执行临时分析、标准化报告、数据探索应用程序原型 (http://code.google.com/apis/bigquery/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-05-07T09:53:47.910

查看由 JMLR 维护的用于机器学习的开源软件列表。你可以在这里找到它：

[http://mloss.org/software/](http://mloss.org/software/)

[http://jmlr.csail.mit.edu/mloss/](http://jmlr.csail.mit.edu/mloss/)

它们代表了最先进的技术！

我对 Weka 的问题是其中的一些算法已经过时了。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-10-06T11:00:25.007

我相信 RapidMiner 是一个优秀的工具，应该添加到这个列表中。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-02-24T08:07:36.203

WEKA（已经提到）、Orange（http://orange.biolab.si/）、Tanagra（http://data-mining-tutorials.blogspot.com）你可以在那里找到很好的教程。

是非常好的数据挖掘工具。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-03-05T04:24:53.763

您可以查看我的软件**[SPMF 数据挖掘框架](http://www.philippe-fournier-viger.com/spmf/)**。

它是一个开源 Java 软件，提供 70 多种算法：

*   频繁项集挖掘
*   关联规则挖掘，
*   顺序模式挖掘
*   顺序规则挖掘。
*   和更多..

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-03-02T14:04:44.527

这里列出了一些开源数据挖掘工具的列表：http: [//dataminingtools.net/browse.php](http://dataminingtools.net/browse.php)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-01-04T13:29:47.563

您可以查看[Data Mining SDK](http://datamining.codeplex.com)及其[博客](http://msug.vn.ua/blogs/datamining/)。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-09-18T20:40:50.190

[Pentaho](http://www.pentaho.com/)是一个非常专业的解决方案。绝对是一个非常不错的选择。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-11-25T17:57:19.557

Weka 擅长分类和/机器学习/。对许多人来说，这被认为是人工智能的一部分，而不是实际的数据挖掘。RapidMiner 大致沿用相同的路线，但用户界面要好得多。Pentaho 是 Weka AFAICT 的专业支持。

您可能想看看 ELKI，[http](http://elki.dbs.ifi.lmu.de/) ://elki.dbs.ifi.lmu.de/，这是一个可比较的项目，专注于聚类算法和异常值检测，这是数据挖掘的另外两个关键任务。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-03-09T16:00:57.137

Eclipse BIRT [http://www.eclipse.org/birt/phoenix/project/description.php](http://www.eclipse.org/birt/phoenix/project/description.php)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-06-07T03:36:51.470

我相信[KNIME 也](http://www.knime.org/)应该加入这个名单。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-03-09T15:41:33.043

你可以看看数据挖掘工具，weka

这是 WEKA 教程上的教程和视频集合的链接：[http ://www.dataminingtools.net/browsetutorials.php?tag=weka](http://www.dataminingtools.net/browsetutorials.php?tag=weka) 

视频： [http ://www.dataminingtools.net/videos.php?id=6](http://www.dataminingtools.net/videos.php?id=6) 

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-12-29T13:11:17.163

除了这些工具，我强烈建议学习 Python 和 R。这些语言在分析过程中很有帮助。此外，可以“自定义分析”大型数据集。您还可以使用 Javascript 创建自己的自定义仪表板（查看[众多图表和可视化库](http://blizzardzblogs.blogspot.com/2010/12/data-visualization-charts-and.html)）

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-05-07T18:36:13.793

我自己就是一个蟒蛇，我不得不说：

是的！所有这些都可以在 Python 中完成。

我上次玩的是 Beautiful Soup[0]。这是一个非常简单易用的模块，可让您从 html 和 xml 中获取/挖掘数据（非常适合“屏幕抓取”）。

如果您不了解python，....好吧，它真的很容易学习。

[0] [http://www.crummy.com/software/BeautifulSoup/](http://www.crummy.com/software/BeautifulSoup/)

# jquery - Ext JS 与 jQuery 和 Mootools 等其他工具有何不同

> ID：835755
> 
> 赞同：9
> 
> 时间：2009-05-07T16:37:51.520
> 
> 标签：jquery, comparison, extjs, mootools

在查看 Ext JS 时，我不觉得它与 jQuery 和 Mootools 的用途相同。

虽然 jQuery 和 Mootools 有助于网站的一般运作，但 Ext JS 似乎专注于表格和存储数据，以及对其进行操作。

那么，这个观察是否正确，或者 Ext Js 是否适合与 jQuery 和 Mootools 相同的工作？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-07T18:27:25.330

比较 ExtJs 和 JQuery 就像比较苹果和橘子。您可以将 Ext Core 与 JQuery 进行比较，将 ExtJs 与 JQuery UI 进行比较。

Ext Core 和 ExtJs 是开源的，Core 属于 MIT 许可，ExtJs 属于 GPL 3。两者最终都由 Ext, LLC 管理，包括对库的所有更改。Ext 有一个专门的开发团队和支持人员，那些使用带有支持合同的商业许可证的人可以完全支持帮助和问题解决。除此之外，Ext 控制类（和所有其他类）非常全面和一致。

你提到的所有库都有优点和缺点，但我已经提到的有助于使 ExtJs 成为我的一个令人信服的选择。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-29T00:27:18.870

我们使用 ExtJS 非常快速地构建了一个复杂的呼叫中心应用程序，几乎不考虑样式，因为这一切都是“开箱即用”的。但是，ExtJS 使用更传统的 UI，因此如果您想要对 UI 进行更精细的控制，或者想要一些华丽或非常规的东西，那么 Ext 不是正确的选择。Mootools 和 JQuery 更适合原始设计，但需要付出更多努力才能获得正确的样式。

请注意，ExtJS 可以与其他库一起使用，我们确实将它与 JQuery 一起使用，这仅仅是因为我们有不同的应用程序，构建在不同的库中，它们必须放在一起。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T16:44:04.453

Ext JS 是一个成熟的小部件库，而 jQuery（不是 jQuery UI）和 Mootools 是有助于 DOM 操作等的 JavaScript 框架。您的观察是正确的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-16T23:10:04.500

我认为，ExtJS 和 jQuery 是完全不同的。Ext 提供了 UI 组件的强大功能。Core jQuery - 不带插件 - 为您提供速度，对于 DOM 操作和快速动画非常有用。

如果我的应用程序需要 Grid、Window、TabPanel 或 TreePanel，那么框架应该是 ExtJS。在这种情况下，我不处理 jQuery UI 或 jQuery UI 插件。

如果我的应用程序不需要 Grid、Window、TabPanel 或 TreePanel，则框架应该是 jQuery，因为脚本大小非常重要，而且 jQuery 很容易用于此类应用程序。

如果我的应用程序需要日期选择器、颜色选择器、基本选项卡或基本手风琴面板，则框架应该是 jQuery + jQuery UI。因为脚本大小和用法。

对于高度使用小部件的管理面板，ExtJS 将是一种很好的方法。看看 ExtJS 能做什么[ExtJS Demo Page](http://dev.sencha.com/deploy/dev/examples/)

# gdb - 如何使用“监视”GDB？

> ID：835757
> 
> 赞同：8
> 
> 时间：2009-05-07T16:38:14.657
> 
> 标签：gdb, watch

我试图通过命令“watch a”来观察“int a”的变化。但是，程序并没有停止，当它变为 12 时。为什么？

```
 /* FILE: test.c */
 #include <stdio.h>
 #include <stdlib.h>

 int main(int argc, char** argv){
  printf("Hello world\n");

  int a = 12;
  a = 10;                                                                                                                                                                      
  return 0; 
 } 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-09T02:08:03.053

指定您的平台、GDB 版本以及您使用的 GDB 命令的确切顺序可能会有所帮助。

这是我看到的（GDB 似乎工作得很好）：

```
$ gcc -g test.c

$ gdb a.out
GNU gdb (GDB) 6.8.50.20090430-cvs
Copyright (C) 2009 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-unknown-linux-gnu".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
(gdb) list
1       #include <stdio.h>
2       #include <stdlib.h>
3
4       int main(int argc, char** argv){
5         printf("Hello world\n");
6
7         int a = 12;
8         a = 10;                                                                                                                                                                      
9         return 0; 
10      }
11
(gdb) b 5
Breakpoint 1 at 0x4004a7: file test.c, line 5.
(gdb) r

Breakpoint 1, main (argc=1, argv=0x7fffffffdb28) at test.c:5
5         printf("Hello world\n");
(gdb) watch a
Hardware watchpoint 2: a
(gdb) c
Hello world
Hardware watchpoint 2: a

Old value = 0
New value = 12
main (argc=1, argv=0x7fffffffdb28) at test.c:8
8         a = 10;                                                                                                                                                                      
(gdb) c
Hardware watchpoint 2: a

Old value = 12
New value = 10
main (argc=1, argv=0x7fffffffdb28) at test.c:9
9         return 0; 
(gdb) c

Watchpoint 2 deleted because the program has left the block in
which its expression is valid.
0x00007ffff7ab3033 in exit () from /lib/libc.so.6
(gdb) c

Program exited normally.
(gdb) q 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-10T11:48:49.250

当您想调试程序时，您应该始终使用 -O0 -g3 构建（我认为您正在使用 gcc，如果您不是，您的编译器可能会支持其他标志来拒绝优化并启用调试信息）。

在我的系统（运行 Gentoo GNU/Linux 的 x86_64）上，当我使用任何大于或等于 -O 的优化时，我无法进入“int a = 12”行，因为编译器随后将应用[死代码消除](http://en.wikipedia.org/wiki/Dead_code_elimination)。（取自[这里](http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html)，它是 -O 部分中的 -fdce 标志）

调试时请始终牢记这一点！通过使用 objdump -D 反汇编或告诉编译器向您显示生成的程序集来验证您的代码（在带有 -S 标志的 gcc 上）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T16:41:48.483

编译器甚至可能不会生成将 12 分配给“a”的代码，最好将生成的代码反汇编以确认。你可能需要一个稍微复杂的测试来试试这个。

# sql - 从 .NET 应用程序运行包时如何设置 SSIS 包动态 .mdb 连接

> ID：835765
> 
> 赞同：1
> 
> 时间：2009-05-07T16:39:52.920
> 
> 标签：sql, ms-access, dynamic, ssis, filepath

我目前正在开发一个在后端使用 .mdb (Access) 数据库文件的 VB.NET 桌面应用程序。.mdb 文件在 VB.NET 应用程序中打开和编辑。编辑完成后，用户需要将数据导入我们的 SQL Server 数据库。这是一项简单的任务，直到您尝试引入动态文件路径方案。

我在 SSIS 方面有相当多的经验，但在解决这个问题时遇到了一些麻烦。我创建了一个 WinForm，允许用户浏览到他们选择的 .mdb 文件。.mdb 文件名中包含时间戳/日期信息，以使它们独一无二。（我没有开发应用程序的这一部分，我最近开始研究这个，因此出现了问题。我不会为 .mdb 文件名加上时间戳，但这是我被迫使用的！）。

无论如何，我需要动态地将文件名和路径传递给我的 SSIS 包。我看到你在哪里为 ConnectionString 等创建变量。但我真的不确定细节以及我应该为 MS Access 使用什么类型的数据连接（Ole DB、ODBC 或 Jet 4.0 for Office？？哎呀有很多！ ！）

我还假设我的数据连接的连接字符串必须是动态的，因为包将使用 .mdb 文件作为 SOURCE。但是如何在 SSIS 中为 .mdb 文件创建动态数据连接呢？

以及如何将文件名/路径字符串传递给我的 SSIS 包？

我目前正在使用以下代码进行原型设计：

```
 'Execute the SSIS_Import package 
    Dim pkgLocation As String
    Dim pkg As New Package
    Dim app As New Microsoft.SqlServer.Dts.Runtime.Application
    Dim pkgResults As DTSExecResult
    Dim eventListener As New EventListener()

    Try
        pkgLocation = "C:\SSIS_DataTransfer\ImportPackage.dtsx"

        'TO-DO: pass databasePath variable to SSIS package here ???
        pkg = app.LoadPackage(pkgLocation, eventListener)
        pkgResults = pkg.Execute(Nothing, Nothing, eventListener, Nothing, Nothing)

        Select Case pkgResults

            Case DTSExecResult.Completion
                MsgBox("Data import completed!")

            Case DTSExecResult.Success
                MsgBox("Data import was successful!")

            Case DTSExecResult.Failure
                MsgBox("Data import was not successful!")

        End Select

    Catch ex As Exception
        MsgBox(ex.Message)
    End Try 
```

1.  如何将 .mdb 文件位置传递给我的 SSIS 包？LoadPackage 也许？
2.  如何在我的 SSIS 包的数据连接中使用动态文件位置？

上传非动态的 .mdb 文件非常简单。在您介绍用户选择的动态方面之前，设置源和目标非常容易。这在 SSIS 中怎么可能？

任何帮助是极大的赞赏。谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T18:35:09.007

这会有所改变，具体取决于您使用的连接和执行方法，但将变量放入包中基本相同。自从我使用 SSIS 以来已经有一段时间了，所以它可能有点偏离。但是一旦你弄清楚了最初的步骤，它就很简单了。

要将变量放入包中：

*   在包中创建一个变量来保存文件名。单击设计器界面以确保您处于包级别范围，打开变量窗口，单击新建并指定变量的名称（“filePath”）、类型（“String”），并为其指定一个默认值。
*   从您的 VB.Net 代码中设置变量：

在 VB.NET 中：

```
pkg = app.LoadPackage(pkgLocation, eventListener)
' Set the file path variable in the package
' NB: You may need to prefix "User::" to the variable name depending on the execution method
pkg.Variables("filePath").Value = databasePath
pkgResults = pkg.Execute(Nothing, Nothing, eventListener, Nothing, Nothing) 
```

*   您现在应该可以访问包中的变量。

根据您用于导入 Access db 的连接，您可能需要做一些不同的事情。如果您使用的是 OLEDB 连接，则有一个连接字符串和 ServerName 属性。设置 ServerName 属性以使用具有文件路径 ( `@[User::filePath]`) 的变量和连接字符串以也使用 filePath 变量 ( `"Data Source=" + @[User::filePath] + ";Provider=Microsoft.Jet.OLEDB.4.0;"`)

查看[此文本文件示例](http://blogs.conchango.com/jamiethomson/archive/2006/03/11/SSIS-Nugget_3A00_-Setting-expressions.aspx)，了解如何使用表达式动态设置连接字符串。[这个是用于 Access 的](http://www.mssqltips.com/tip.asp?tip=1437)，但对于来自数据库的连接字符串很复杂。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T17:15:55.830

我不从程序中调用 SSIS 包，所以我不知道如何配置它们。我确实知道，当我使用 OLEDB 连接管理器并使用“Native OLE DB Jet 4.0 Provider”时，我可以将连接管理器的 ServerName 属性设置为 .MDB 文件的路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-19T13:49:44.877

我通过将文件移动到 importing.mdb 来解决这个问题。然后连接管理器是静态的。

# oracle - Amazon EC2 + EBS 上的 Oracle DB

> ID：835769
> 
> 赞同：1
> 
> 时间：2009-05-07T16:40:17.317
> 
> 标签：oracle, amazon-ec2, database-administration, amazon-ebs

我刚刚在我的 Amazon 的 Virtual EC2 Linux (Ubuntu) 服务器上安装了 Oracle。因为我不太熟悉 Oracle 数据库管理，所以我想知道哪些文件以及我需要如何移动到 ESB，所以当我关闭或终止我的实例时，数据不会丢失。

我找到了[这个](http://www.oracle-base.com/articles/misc/RenamingOrMovingOracleFiles.php)教程，但我不确定这是否是我需要的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:48:53.023

为简单起见，您可能希望从其中一个 Oracle AMI 开始。你可以在这里找到它们：

[http://www.oracle.com/technology/tech/cloud/index.html](http://www.oracle.com/technology/tech/cloud/index.html)

EC2 上的 Oracle 概述如下：

[http://aws.amazon.com/solutions/featured-partners/oracle/](http://aws.amazon.com/solutions/featured-partners/oracle/)

在那里观看演示视频。在您继续操作时，请确保您已在节点上预先安装了 EBS。当视频到达您指定数据位置的部分时，请使用您的 EBS 挂载点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T18:02:54.443

1.  备份您的数据库

2.  请遵循以下说明：

[http://www.oracle.com/technology/obe/paa/obe-dbf/html/Move_DF.htm](http://www.oracle.com/technology/obe/paa/obe-dbf/html/Move_DF.htm) [http://www.idevelopment.info/data/Oracle/DBA_tips/Database_Administration/DBA_35.shtml](http://www.idevelopment.info/data/Oracle/DBA_tips/Database_Administration/DBA_35.shtml)

# oracle - JPA：如何从 Oracle NUMBER 获得 Long 类型的标量结果，而不是 BigNumber？

> ID：835779
> 
> 赞同：0
> 
> 时间：2009-05-07T16:42:12.757
> 
> 标签：oracle, hibernate, jpa

Oracle NUMBER 值的默认映射是 BigNumber... 我怎样才能让标量结果查询返回 Long？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T19:25:06.547

让进入这里的人宽恕吧；我最终只是创建了一个带有 Long 类型字段的 shill 实体来填充。显然Oracle和hibernate讨厌你们所有人，除了BigNumbers之外不会给你任何东西。

# .net - 如何在 Linq 中执行 SQL Like %？

> ID：835790
> 
> 赞同：407
> 
> 时间：2009-05-07T16:43:26.437
> 
> 标签：.net, linq, tsql, linq-to-entities, sql-like

我有一个 SQL 程序，我试图将其转换为 Linq：

```
SELECT O.Id, O.Name as Organization
FROM Organizations O
JOIN OrganizationsHierarchy OH ON O.Id=OH.OrganizationsId
where OH.Hierarchy like '%/12/%' 
```

我最关心的一行是：

```
where OH.Hierarchy like '%/12/%' 
```

我有一列存储像 /1/3/12/ 这样的层次结构，所以我只使用 %/12/% 来搜索它。

我的问题是，什么是 Linq 或 .NET 相当于使用百分号？

* * *

## 回答 #1

> 赞同：580
> 
> 时间：2009-05-07T16:45:50.067

```
.Where(oh => oh.Hierarchy.Contains("/12/")) 
```

您也可以使用`.StartsWith()`或`.EndsWith()`。

* * *

## 回答 #2

> 赞同：259
> 
> 时间：2010-06-15T13:48:19.973

用这个：

```
from c in dc.Organization
where SqlMethods.Like(c.Hierarchy, "%/12/%")
select *; 
```

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-05-07T16:46:19.503

我假设您使用的是 Linq-to-SQL*（请参阅下面的注释）。如果是这样，请使用 string.Contains、string.StartsWith 和 string.EndsWith 来生成使用 SQL LIKE 运算符的 SQL。

```
from o in dc.Organization
join oh in dc.OrganizationsHierarchy on o.Id equals oh.OrganizationsId
where oh.Hierarchy.Contains(@"/12/")
select new { o.Id, o.Name } 
```

或者

```
from o in dc.Organization
where o.OrganizationsHierarchy.Hierarchy.Contains(@"/12/")
select new { o.Id, o.Name } 
```

**注意：** * = 如果您在 .net 3.5 中使用 ADO.Net Entity Framework (EF / L2E)，请注意它不会进行与 Linq-to-SQL 相同的转换。尽管 L2S 进行了正确的转换，但 L2E v1 (3.5) 将转换为 t-sql 表达式，该表达式将强制对您正在查询的表进行全表扫描，除非您的 where 子句或连接过滤器中有另一个更好的鉴别器。
**更新：**这在 EF/L2E v4 (.net 4.0) 中已修复，因此它会像 L2S 一样生成 SQL LIKE。

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2009-05-07T17:34:39.870

如果您使用的是 VB.NET，那么答案将是“*”。这是您的 where 子句的样子...

```
Where OH.Hierarchy Like '*/12/*' 
```

注意：“*”匹配零个或多个字符。[这是针对 Like 运算符的 msdn 文章](http://msdn.microsoft.com/en-us/library/swf8kaxw(VS.80).aspx)。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-10-04T11:56:52.160

好吧 indexOf 也适合我

```
var result = from c in SampleList
where c.LongName.IndexOf(SearchQuery) >= 0
select c; 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2018-09-16T10:23:36.687

.NET 核心现在有`EF.Functions.Like`

```
 var isMatch = EF.Functions.Like(stringThatMightMatch, pattern); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-08-08T12:48:57.277

使用这样的代码

```
try
{
    using (DatosDataContext dtc = new DatosDataContext())
    {
        var query = from pe in dtc.Personal_Hgo
                    where SqlMethods.Like(pe.nombre, "%" + txtNombre.Text + "%")
                    select new
                    {
                        pe.numero
                        ,
                        pe.nombre
                    };
        dgvDatos.DataSource = query.ToList();
    }
}
catch (Exception ex)
{
    string mensaje = ex.Message;
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-11-25T00:19:18.953

如果您不匹配数字字符串，最好有常见的情况：

```
.Where(oh => oh.Hierarchy.ToUpper().Contains(mySearchString.ToUpper())) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-02-16T13:19:13.587

我总是这样做：

```
from h in OH
where h.Hierarchy.Contains("/12/")
select h 
```

我知道我不使用 like 语句，但它在后台工作正常，这是翻译成带有 like 语句的查询。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-11-30T14:07:54.380

```
System.Data.Linq.SqlClient.SqlMethods.Like("mystring", "%string") 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-07-15T03:20:59.270

试试这个，这对我来说很好

```
from record in context.Organization where record.Hierarchy.Contains(12) select record; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-09-23T11:10:48.210

*Contains*用于 Linq，就像*Like*用于 SQL 一样。

```
string _search="/12/"; 
```

. . .

```
.Where(s => s.Hierarchy.Contains(_search)) 
```

您可以在 Linq 中编写 SQL 脚本，如下所示：

```
 var result= Organizations.Join(OrganizationsHierarchy.Where(s=>s.Hierarchy.Contains("/12/")),s=>s.Id,s=>s.OrganizationsId,(org,orgH)=>new {org,orgH}); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-10-05T18:26:52.027

对于那些像我一样在 LINQ 中寻找“SQL Like”方法的方法的人来说，我有一些非常好的东西。

我处于无法以任何方式更改数据库以更改列排序规则的情况。所以我必须在我的 LINQ 中找到一种方法来做到这一点。

我正在使用与**`SqlFunctions.PatIndex`**真正的 SQL LIKE 运算符类似的辅助方法。

首先，我需要在搜索值中枚举所有可能的变音符号（我刚刚学过的一个词）以获得类似：

```
déjà     => d[éèêëeÉÈÊËE]j[aàâäAÀÂÄ]
montreal => montr[éèêëeÉÈÊËE][aàâäAÀÂÄ]l
montréal => montr[éèêëeÉÈÊËE][aàâäAÀÂÄ]l 
```

然后以 LINQ 为例：

> ```
> var city = "montr[éèêëeÉÈÊËE][aàâäAÀÂÄ]l";
> var data = (from loc in _context.Locations
>                      where SqlFunctions.PatIndex(city, loc.City) > 0
>                      select loc.City).ToList(); 
> ```

所以为了我的需要，我写了一个 Helper/Extension 方法

```
 public static class SqlServerHelper
    {

        private static readonly List<KeyValuePair<string, string>> Diacritics = new List<KeyValuePair<string, string>>()
        {
            new KeyValuePair<string, string>("A", "aàâäAÀÂÄ"),
            new KeyValuePair<string, string>("E", "éèêëeÉÈÊËE"),
            new KeyValuePair<string, string>("U", "uûüùUÛÜÙ"),
            new KeyValuePair<string, string>("C", "cçCÇ"),
            new KeyValuePair<string, string>("I", "iîïIÎÏ"),
            new KeyValuePair<string, string>("O", "ôöÔÖ"),
            new KeyValuePair<string, string>("Y", "YŸÝýyÿ")
        };

        public static string EnumarateDiacritics(this string stringToDiatritics)
        {
            if (string.IsNullOrEmpty(stringToDiatritics.Trim()))
                return stringToDiatritics;

            var diacriticChecked = string.Empty;

            foreach (var c in stringToDiatritics.ToCharArray())
            {
                var diac = Diacritics.FirstOrDefault(o => o.Value.ToCharArray().Contains(c));
                if (string.IsNullOrEmpty(diac.Key))
                    continue;

                //Prevent from doing same letter/Diacritic more than one time
                if (diacriticChecked.Contains(diac.Key))
                    continue;

                diacriticChecked += diac.Key;

                stringToDiatritics = stringToDiatritics.Replace(c.ToString(), "[" + diac.Value + "]");
            }

            stringToDiatritics = "%" + stringToDiatritics + "%";
            return stringToDiatritics;
        }
    } 
```

如果你们中的任何人有改进这种方法的建议，我会很高兴听到你的声音。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-05-11T19:08:07.600

很晚了，但我把它放在一起以便能够使用 SQL Like 样式通配符进行字符串比较：

```
public static class StringLikeExtensions
{
    /// <summary>
    /// Tests a string to be Like another string containing SQL Like style wildcards
    /// </summary>
    /// <param name="value">string to be searched</param>
    /// <param name="searchString">the search string containing wildcards</param>
    /// <returns>value.Like(searchString)</returns>
    /// <example>value.Like("a")</example>
    /// <example>value.Like("a%")</example>
    /// <example>value.Like("%b")</example>
    /// <example>value.Like("a%b")</example>
    /// <example>value.Like("a%b%c")</example>
    /// <remarks>base author -- Ruard van Elburg from StackOverflow, modifications by dvn</remarks>
    /// <remarks>converted to a String extension by sja</remarks>
    /// <seealso cref="https://stackoverflow.com/questions/1040380/wildcard-search-for-linq"/>
    public static bool Like(this String value, string searchString)
    {
        bool result = false;

        var likeParts = searchString.Split(new char[] { '%' });

        for (int i = 0; i < likeParts.Length; i++)
        {
            if (likeParts[i] == String.Empty)
            {
                continue;   // "a%"
            }

            if (i == 0)
            {
                if (likeParts.Length == 1) // "a"
                {
                    result = value.Equals(likeParts[i], StringComparison.OrdinalIgnoreCase);
                }
                else // "a%" or "a%b"
                {
                    result = value.StartsWith(likeParts[i], StringComparison.OrdinalIgnoreCase);
                }
            }
            else if (i == likeParts.Length - 1) // "a%b" or "%b"
            {
                result &= value.EndsWith(likeParts[i], StringComparison.OrdinalIgnoreCase);
            }
            else // "a%b%c"
            {
                int current = value.IndexOf(likeParts[i], StringComparison.OrdinalIgnoreCase);
                int previous = value.IndexOf(likeParts[i - 1], StringComparison.OrdinalIgnoreCase);
                result &= previous < current;
            }
        }

        return result;
    }

    /// <summary>
    /// Tests a string containing SQL Like style wildcards to be ReverseLike another string 
    /// </summary>
    /// <param name="value">search string containing wildcards</param>
    /// <param name="compareString">string to be compared</param>
    /// <returns>value.ReverseLike(compareString)</returns>
    /// <example>value.ReverseLike("a")</example>
    /// <example>value.ReverseLike("abc")</example>
    /// <example>value.ReverseLike("ab")</example>
    /// <example>value.ReverseLike("axb")</example>
    /// <example>value.ReverseLike("axbyc")</example>
    /// <remarks>reversed logic of Like String extension</remarks>
    public static bool ReverseLike(this String value, string compareString)
    {
        bool result = false;

        var likeParts = value.Split(new char[] {'%'});

        for (int i = 0; i < likeParts.Length; i++)
        {
            if (likeParts[i] == String.Empty)
            {
                continue;   // "a%"
            }

            if (i == 0)
            {
                if (likeParts.Length == 1) // "a"
                {
                    result = compareString.Equals(likeParts[i], StringComparison.OrdinalIgnoreCase);
                }
                else // "a%" or "a%b"
                {
                    result = compareString.StartsWith(likeParts[i], StringComparison.OrdinalIgnoreCase);
                }
            }
            else if (i == likeParts.Length - 1) // "a%b" or "%b"
            {
                result &= compareString.EndsWith(likeParts[i], StringComparison.OrdinalIgnoreCase);
            }
            else // "a%b%c"
            {
                int current = compareString.IndexOf(likeParts[i], StringComparison.OrdinalIgnoreCase);
                int previous = compareString.IndexOf(likeParts[i - 1], StringComparison.OrdinalIgnoreCase);
                result &= previous < current;
            }
        }

        return result;
    }
} 
```

# asp.net - Visual Studio 2005 不会在发布配置模式下编译

> ID：835803
> 
> 赞同：3
> 
> 时间：2009-05-07T16:45:01.347
> 
> 标签：asp.net, configuration, visual-studio-2005, compilation

摘要：如何在发布模式下编译......我无法让它“接受”我想做的事情。

我在尝试优化的 VS2005 C# 中有一个 web 服务项目。我引起了我的注意的一件事是建议在发布模式下编译。我不确定在这里会发生什么，但这是我所看到的：

我在项目上右击鼠标并选择属性，然后选择构建选项卡我单击配置下拉框，设置为释放并注意到输出路径是\bin 我在项目上单击 REBUILD，DLL 进入 \bin\debug 文件夹（不是\bin）！这是从该编译的输出窗口粘贴的片段（请注意，它显示配置为“调试任何 CPU”，之后显示为 /define:DEBUG;TRACE）：

```
------ 重建所有开始：项目：TRIMBrokerService，配置：调试任何 CPU ------
C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Csc.exe /noconfig /nowarn:1701,1702 /errorreport:prompt /warn:4 /define:DEBUG;TRACE
/reference:"C:\Program Files\Microsoft WSE\v3.0\Microsoft.Web.Services3.dll" /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Configuration.dll /reference :C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Data.dll /参考：C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.dll
/reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Drawing.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.EnterpriseServices.dll /reference:C :\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Web.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Web.Mobile.dll /reference:C:\ WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Web.Services.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Xml.dll /reference:..\TRIMBrokerUtilities\ TRIMBrokerUtil\bin\Debug\TRIMBrokerUtil.dll
/debug+ /debug:full /optimize- /out:obj\Debug\TRIMBrokerService.dll /target:library FaultCode.cs FileService.asmx.cs Properties\AssemblyInfo.cs Properties\Settings.Designer.cs Settings.cs "Web References\ ASMXwsTrim\Reference.cs"

编译完成 -- 0 个错误，0 个警告
TRIMBrokerService -> C:\Documents and Settings\johna\My Documents\Visual Studio 2005\Projects\WSE\TRIMBrokerPassingByteArray\TRIMBroker\TRIMBrokerService\bin\debug\TRIMBrokerService.dll
==========全部重建：1成功，0失败，0跳过==========

```

我注意到我可以与 Build 选项卡对话框进行交互，当我将 Configuration 下拉列表框更改为 Active(Debug) 或只是 Debug 时，输出路径会更改为 \bin\debug，正如人们所期望的那样，但我似乎无法得到它以发布模式编译。有诀窍吗？我害怕阅读 MSBuild 文档只是为了部署我的小 Web 服务，因为我认为这比我现在需要的要多得多。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T16:50:59.367

右键单击您的解决方案并选择`Configuration Manager..` 确保“ `Active solution configuration`”设置为`Release`。然后确保下面网格中的项目设置为使用该`Release`配置。

也许是不小心改变了一些东西..

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T22:17:07.087

除了[Ryan 的回复](https://stackoverflow.com/questions/835803/visual-studio-2005-wont-compile-in-release-configuration-mode/835835#835835)，在项目设置的 Build 选项卡上设置的配置对当前的构建模式没有影响，这只是允许您在一个简单的地方在每个配置的构建模式上修改此项目的设置。

您还可以使用默认“标准”工具栏上的“解决方案配置”下拉列表，其中列出了“调试”按钮和“解决方案平台”下拉列表旁边的解决方案配置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-10T20:59:54.783

我在 VS 2008 中遇到了同样奇怪的问题。在调试模式下编译的项目很好，但在发布模式下吐出许多错误消息。经过几天的尝试和错误。我终于找到了问题：一些文件的路径超过了 260 个字母。它适用于调试模式的原因是“debug”这个词比“release”这个词少了两个字母。它碰巧在“发布”模式下超过了 260 个字母。如果您像我一样为您的嵌套项目目录起一个长名称，请注意这一点。缩短主目录名称后，问题就消失了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T16:47:06.193

如果您让程序集进入 bin\Debug，那么有人以错误的方式修改了项目。任何使用 ASP.NET 的东西都需要将程序集放入 bin。

# linux - 哪个 API 在 linux 中提供无线网络通知？

> ID：835804
> 
> 赞同：3
> 
> 时间：2009-05-07T16:45:18.587
> 
> 标签：linux, networking, wireless, notifications

每次我的网卡发送有关可用网络的新信息时，我都想触发一些回调。我也不介意自己是否需要轮询信息。我只是不想依赖`iwlist scan last`每秒生成“”，但这正是我需要的信息（网络名称 + 通道 + 加密类型）。

有没有实现类似功能的库？（或者是否有一些 ioctl 调用来做到这一点？）

如果这很重要，我只对 ndiswrapper 模块感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T17:05:08.413

如果 NetworkManager 正在运行，则可以通过其[DBUS API](http://people.redhat.com/dcbw/NetworkManager/NetworkManager%20DBUS%20API.txt)访问它——参见`WirelessNetworkAppeared`和`WirelessNetworkDisappeared`事件。

否则，您将不得不自己处理[wext](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=include/linux/wireless.h;hb=HEAD)（这是 NM 在下面使用的），您会对来自[NETLINK_ROUTE](http://en.wikipedia.org/wiki/Netlink)接口的`IWEVREGISTERED`和`IWEVEXPIRED`事件感兴趣。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T22:25:04.087

如果您不想使用 DBUS，您也可以将脚本/程序放入`/etc/NetworkManager/dispatcher.d/`中，NetworkManager 会在某些事件时调用它。

有关传递给脚本的事件和参数的类型，请参见“ `man 8 NetworkManager`”。但是，该脚本将执行为`root`，这可能不是您想要的。

# iphone - 在哪些情况下，在访问实例变量时放弃使用 self 是个好主意？

> ID：835808
> 
> 赞同：0
> 
> 时间：2009-05-07T16:46:02.827
> 
> 标签：iphone, cocoa, cocoa-touch, uikit

这可能是一个非常愚蠢的初学者问题，但是：

如果你的类中有一些不错的实例变量，例如 UIScrollview *scrollView2，那么你为什么要通过放弃一个来绕过 getter 和 setter

```
[self.scrollView2 addSubview:imageView]; 
```

, 而是做一个

```
[scrollView2 addSubview:imageView]; 
```

? 我的意思是......越过吸气剂并没有什么坏处，实际上我认为这总是要走的路。但在所有苹果的例子中，我到处都怀念这种模式。他们在调用方法时很少使用 self.someInstanceVariable。还是我做错了什么？

自从苹果做以来我就开始做同样的事情，但我想知道：为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T17:12:05.197

它与[KVO（Key-Value Observing）](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html)和[KVC（Key-Value Coding）](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueCoding/KeyValueCoding.html)有关。如果绕过 getter 或 setter，观察值的对象将不会收到消息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T16:54:53.243

我曾经也绕过 getter/setter，直到我发现直接访问变量时绑定不起作用。换句话说，键值编码仅在使用 getter/setter 函数访问属性时才有效。

编辑：有关 KVC 合规性，请参阅[此页面](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueCoding/Concepts/Compliant.html#//apple_ref/doc/uid/20002172)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T19:08:31.970

通常你不会在`init`or中使用属性`dealloc`，最好直接访问实例变量，因为你的对象可能不处于“安全”状态。

# visual-studio-2008 - Multiproc 在 VS2008 中构建

> ID：835810
> 
> 赞同：4
> 
> 时间：2009-05-07T16:46:20.033
> 
> 标签：visual-studio-2008, build-process, multicore

我记得在某处读过关于 VS2008 中的 multiproc 构建的文章，只是我现在找不到这篇文章。有谁知道如何打开它，或者即使它是可能的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T17:17:20.753

在 VS2008 中有两种方法可以并行化构建。

第一种是并行运行多个项目构建。设置在Tools->Options->Projects and Solutions->Build and Run，叫做“Maximum number of parallel project builds”。请注意，每个项目一次只能构建一个文件。

第二种是在单个项目中一次编译多个文件。对于 C++，这是通过设置[`/MP`编译器标志](http://msdn.microsoft.com/en-us/library/bb385193.aspx)来完成的。请注意，此功能与预编译标头的交互相当奇怪，您必须跳过一些环节才能将两者结合起来。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T17:15:25.860

我怀疑您是在询问新的（针对 VS 2008）多进程 VC++ 构建功能。看到[这个](http://msdn.microsoft.com/en-us/library/bb385193.aspx)。

> /MP 选项可以减少在命令行上编译源文件的总时间。/MP 选项使编译器创建自己的一个或多个副本，每个副本都在一个单独的进程中。然后这些副本同时编译源文件。因此，可以显着减少构建源文件的总时间。

此功能存在于旧版本的 VC++ 中，但未记录在案。这***不是***我们已经有一段时间的多项目建筑。

# c++ - Visual Studio 发布中令人费解的 STL 错误

> ID：835814
> 
> 赞同：1
> 
> 时间：2009-05-07T16:46:56.990
> 
> 标签：c++, optimization, crash, memory-corruption

我很确定这是 Visual Studio 2005 中优化器中的一个错误。问题出在 STL 映射上。

以下是相关代码：

```
MyMapIterator myIt = m_myMap.find(otherID);

if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_A)
{
    //Prints stuff.  No side-effects whatsoever.
}
else if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_B && myIt->second.foo == FOO_A)
{
    //Prints stuff.  No side-effects whatsoever.
}
else if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_B && myIt->second.foo == FOO_B && /*other meaningless conditions */)
{
    //Prints stuff.  No side-effects whatsoever.
} 
```

在调试中完美运行，在发布时崩溃，并禁用全局优化“修复它”现在，没有任何效果。我得到一个：

```
Microsoft Visual Studio C Runtime Library has detected a fatal error in [...]

Press Break to debug the program or Continue to terminate the program. 
```

这发生在**最后一个 else if 的第一个 MyMapIterator::operator->**

地图是空的，我知道 find 应该返回 end()，前两个比较有效。但不知何故，第三次 'myIt != m_myMap.end()' 返回 true，并执行 && 的右侧。

其他许多地方都像这样失败，'myIt!= m_myMap.end()' 的变体在同一个文件中返回 true，但对我来说，这是排除大多数其他可能性的地方。我曾经认为这是在我的地图上踩踏的缓冲区溢出，但回头看看代码。我很肯定没有其他线程在踩它，这是 100% 可复制的。

那么，我从这里做什么。这对性能一点也不敏感。我只需要它正常工作。任何选项都是可以接受的。是的，我知道我可以用迭代器相等性检查来包围整个事情，这不是最好的代码。关键是，它应该仍然有效，如果失败了，其他任何东西都可以。

**编辑**

最后一个 else-if 不会产生任何跳转！

```
 if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_A)
009270BE  mov         ecx,dword ptr [this] 
009270C4  add         ecx,0Ch 
009270C7  lea         eax,[ebp-90h] 
009270CD  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::end (8A21E0h) 
009270D2  mov         esi,eax 
009270D4  lea         edi,[myIt] 
009270D7  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::const_iterator::operator!= (8A2220h) 
009270DC  movzx       ecx,al 
009270DF  test        ecx,ecx 
009270E1  je          lux::Bar::DoStuff+0E4h (927154h) 
009270E3  lea         esi,[myIt] 
009270E6  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::iterator::operator-> (8A21F0h) 
009270EB  cmp         dword ptr [eax+8],1 
009270EF  jne         lux::Bar::DoStuff+0E4h (927154h) 
    {
         Stuff
    }
    else if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_B)
00927154  mov         ecx,dword ptr [this] 
0092715A  add         ecx,0Ch 
0092715D  lea         eax,[ebp-98h] 
00927163  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::end (8A21E0h) 
00927168  mov         esi,eax 
0092716A  lea         edi,[myIt] 
0092716D  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::const_iterator::operator!= (8A2220h) 
00927172  movzx       edx,al 
00927175  test        edx,edx 
00927177  je          lux::Bar::DoStuff+17Ah (9271EAh) 
00927179  lea         esi,[myIt] 
0092717C  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::iterator::operator-> (8A21F0h) 
00927181  cmp         dword ptr [eax+8],2 
00927185  jne         lux::Bar::DoStuff+17Ah (9271EAh) 
    {
            //Stuff
     }
    else if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_C)
009271EA  mov         ecx,dword ptr [this] 
009271F0  add         ecx,0Ch 
009271F3  lea         eax,[ebp-0A0h] 
009271F9  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::end (8A21E0h) 
009271FE  mov         esi,eax 
00927200  lea         edi,[myIt] 
00927203  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::const_iterator::operator!= (8A2220h) 
00927208  lea         esi,[myIt] 
0092720B  call        std::_Tree<std::_Tmap_traits<unsigned __int64,lux::Foo,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,lux::Foo> >,0> >::iterator::operator-> (8A21F0h) 
    {
            //Stuff in the condition and after 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T23:15:50.470

好吧，伙计们。在经历了太多的痛苦和泪水之后。为了至少暂时修复它，我不得不将代码重新修改为大多数人建议的形式，这在第一种情况下应该是这样的：

```
if (myIt != m_myMap.end())
{
    if (myIt->second.userStatus == STATUS_A) 
    {
        //Prints stuff.  No side-effects whatsoever.
    }
    else if (myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_A)
    {        
        //Prints stuff.  No side-effects whatsoever.
    }
    else if (myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_B && /*other meaningless conditions */)
    {
        //Prints stuff.  No side-effects whatsoever.
    }
} 
```

但是，该错误仍然存​​在。这颗宝石修复了它：

```
if (myIt != m_myMap.end())
if (myIt != m_myMap.end())
{
    if (myIt->second.userStatus == STATUS_A) 
    {
        //Prints stuff.  No side-effects whatsoever.
    }
    else if (myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_A)
    {        
        //Prints stuff.  No side-effects whatsoever.
    }
    else if (myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_B && /*other meaningless conditions */)
    {
        //Prints stuff.  No side-effects whatsoever.
    }
} 
```

是的。将 if 加倍会导致在测试后发出跳转指令。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T17:09:50.197

我怀疑您在其他地方的代码中有缓冲区溢出。

此其他代码正在设法破坏已发布代码正在使用的内存。

在调试模式下，额外的内存填充将改变行为。

更改其他随机代码也会改变行为，因为它会改变事物的相对位置。

基本上，您需要查看大量代码或使用 BoundsChecker 之类的工具来查找错误。

专注于数组或任何原始指针数学。也可以使用已删除的指针。

如果它们写入不会导致崩溃的地方，这样的错误可能会隐藏很长时间。出于同样的原因，它们经常神秘地消失。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T16:58:31.847

似乎您在未显示的代码中有其他一些条件导致地图填充了一些无效数据。

在调用之前尝试转储映射的内容`find()`，并在其余代码中查找任何可能的未初始化值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T16:59:53.557

显然任何东西都可能有错误，甚至是 VC 编译器。因此，如果这部分代码中存在错误，您可以将其包装在[#pragma](http://msdn.microsoft.com/en-us/library/d9x1s805(VS.71).aspx)中以关闭优化。如果在那之后它仍然崩溃，那么您的代码中的其他东西正在破坏您的地图（然后您需要打开 DrWatson 以获取转储，以便您可以检查 windbg 中的崩溃以尝试找出它发生了什么）。

要关闭优化使用：

```
#pragma optimize("g", off) 
```

要重新打开它，要么关闭，要么使用特殊情况

```
#pragma optimize("", on) 
```

它将您的优化设置重置为项目默认值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T17:06:41.217

优化器真的搞砸了你的调试信息。很有可能这条线路*实际上*在附近的另一条线路上发生故障。即使调试器告诉您异常发生在运算符的后半部分`&&`，也可能不是。

要诊断真正的问题，您可能希望将最后一个 if 语句分解为以下内容：

```
else if (myIt != m_myMap.end())
{
    printf("TEST 1\n");
    if (myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_B && /*other meaningless conditions */)
    {
        //Prints stuff.  No side-effects whatsoever.
    }
}

printf("TEST 2\n"); 
```

如果你得到“TEST 1”的输出，那么你的迭代器有问题。如果您得到“TEST 2”的输出，然后发生崩溃，那么显然错误发生在后续代码中。如果 "TEST 1" 和 "TEST 2" 都没有打印并且它仍然在那里崩溃，那么*确实*有问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-26T22:36:45.807

我想我遇到了同样的问题。

似乎只发生在 x64 版本中（完全优化）。我的 STL 映射被确认为空（size() == 0），但是这行代码没有检测到空映射，而是进入了 for 循环：

```
typedef std::map<std::string,std::string> KeyValueMap;

printf( "size: %d\n", ExtraHeaders.size() ); // prints "size: 0"

for( KeyValueMap::iterator it= ExtraHeaders.begin(); it != ExtraHeaders.end(); it++ )
{
    // this line is executed
    printf( "%s\t%s\n", (*it).first.c_str(), (*it).second.c_str() );
} 
```

对我来说感觉像是一个编译器错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T17:27:30.933

我认为您做出的假设可能是错误的：在**成功**检查`myIt != m_myMap.end() && myIt->second.userStatus`同一迭代后发生崩溃。我敢打赌，第一次检查这些值时，崩溃会立即发生。优化器使您看起来好像已经清除了前两个`if`条件。

尝试将一个完全不同的代码块放入循环中，看看它是否在那里崩溃（我敢打赌它会——我认为你不会在`cerr`崩溃前立即看到输出。）

```
// New code block
MyMapIterator yourIt = m_myMap.find(otherID);
if (yourIt != m_myMap.end() && yourIt->second.userStatus == STATUS_A || 
     yourIt->second.userStatus == STATUS_B)
{
        cerr << "Hey, I can print something! " << std::ios::hex << this << endl;
}

// Original code
MyMapIterator myIt = m_myMap.find(otherID);
if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_A)
{
        //Prints stuff.  No side-effects whatsoever.
}
else if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_A)
{
        //Prints stuff.  No side-effects whatsoever.
}
else if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_B && /*other meaningless conditions */)
{
        //Prints stuff.  No side-effects whatsoever.
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T17:09:30.540

> 是的，我知道我可以用迭代器相等性检查来包围整个事情，这不是最好的代码。关键是，它应该仍然有效，如果失败了，其他任何东西都可以。

当然，按照这种逻辑，您别无选择……您所做的任何事情都是一种解决方法。

我认为我的第一种方法是将这些东西包装在一个经过验证`myIt`的有效块中：

```
if (myIt != m_myMap.end())
{
    if (myIt->second.userStatus == STATUS_A) 
    {
        //Prints stuff.  No side-effects whatsoever.
    }
    else if (myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_A)
    {        
        //Prints stuff.  No side-effects whatsoever.
    }
    else if (myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_B && /*other meaningless conditions */)
    {
        //Prints stuff.  No side-effects whatsoever.
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-07T17:35:32.443

```
if (myIt != m_myMap.end() && myIt->second.userStatus == STATUS_B && myIt->second->foo == FOO_A) 
```

你为什么要访问 userStatus 。和 foo 与 -> ？

# javascript - 使用 innerHTML 读取 UTF8 字符会为所有字符返回 0xfffd

> ID：835821
> 
> 赞同：0
> 
> 时间：2009-05-07T16:48:29.263
> 
> 标签：javascript, html, utf-8

我正在阅读一个包含 UTF-8 字符的 HTML 文档，但是当我访问**`innerHTML`**文档时，所有“坏”字符都显示为`0xfffd`. 我已经在所有主要浏览器中尝试过它，它的行为方式相同。当我`alert()`将`innerHTML`这些字符显示为*“带有 ? 标记的钻石”时*。

令人惊讶的是，以下工作完美，在警报框中正确显示 UTF-8 字符，因此它没有出现`alert()`故障。

```
alert("Doppelg\u00e4nger!"); 
```

为什么我不能使用 UTF-8 字符访问**`innerHTML`**？或者是否有另一种方法可以在 JavaScript 中访问它们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T17:49:58.680

首先，检查文档标题是否包含。

```
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
```

您还可以使用 javascript 读取元标记：

```
var metaTags = document.getElementsByTagName("META"); 
```

如果是这样，这就是对行为的解释。您可以尝试将 utf-8 更改为 ISO-8859-1：

```
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"> 
```

更好的是对 HTML 中的所有扩展字符进行 htmlEncode。像这样：

```
function encodeHTML(str){
 var aStr = str.split(''),
     i = aStr.length,
     aRet = [];

   while (--i) {
    var iC = aStr[i].charCodeAt();
    if (iC < 65 || iC > 127 || (iC>90 && iC<97)) {
      aRet.push('&#'+iC+';');
    } else {
      aRet.push(aStr[i]);
    }
  }
 return aRet.reverse().join('');
} 
```

请注意，此函数将对所有不是 [a-zA-Z] 的内容进行编码。例如，此函数将在 Doppelgänger 中对 Doppelgänger 进行编码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T16:56:40.943

页面是否使用 UTF-8 字符集发送？ `.innerHTML`UTF-8 从来没有给我带来任何麻烦。

# tfs - 如何在源代码管理资源管理器中为文件夹图标添加图标覆盖？

> ID：835824
> 
> 赞同：2
> 
> 时间：2009-05-07T16:48:32.150
> 
> 标签：tfs, vsx

我有兴趣在源代码管理资源管理器中将文件夹标记为活动、存档和已发布，以便团队更轻松地查看哪些分支处于活动状态。我对 VSX 有点熟悉，所以一旦我知道从哪里开始，我就可以取得进步，但我需要从哪里开始的帮助。

我想要做的一个例子是 VisualSVN，它在解决方案资源管理器中放置文件的状态。我不确定 TFS 是否允许我在文件夹上设置一个属性，以便如果文件夹被移动，该状态将随之移动。如果必须，我可以创建一个名为 BranchStatus.xml 的文件并读取该文件以设置图标。

如果您知道我应该在 MSDN 上查看哪些命名空间和 VSX/DTE 对象，请告诉我。我很感激帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-31T18:31:14.630

我们决定在发布下一个版本后将分支移动到名为 Archive 的文件夹中。这样每个人都知道它只是为了历史参考。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T21:58:41.360

简单回答是不。TFS 团队确认 VS2008 中的源代码管理资源管理器没有可扩展性。VS2010中可能有这个选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T16:13:41.227

回应您的评论：

就像一个想法。使用命令行，您可以为任何人设置和修改工作区（如果您有足够的权限）。我认为也可以为其他工作区（即您的同事）隐藏一个分支。

如果需要，这些东西仍然可以访问，但不会自动检索。

没有你想要的那么好，但它可以工作......

瓦卡诺

# c# - 安全（加密）困境

> ID：835826
> 
> 赞同：7
> 
> 时间：2009-05-07T16:49:06.300
> 
> 标签：c#, .net, wpf, database, encryption

我有一个访问数据库的内部 WPF 客户端应用程序。

该应用程序是支持团队的中心资源，因此包括客户的远程访问/登录信息。目前，该数据库无法通过 Web 界面等方式使用，但有朝一日可能会。

远程访问信息包括客户网络的用户名和密码，以便我们可以远程支持客户的软件应用程序。我需要将用户名和密码存储在数据库中，并为支持顾问提供访问权限，以便他们可以登录到客户的系统，然后提供支持。希望这是有道理的。

因此，困境是我不想将用户名和密码以明文形式存储在数据库中，以确保如果数据库遭到破坏，我不会向任何获得数据库的人提供对我们客户网络的访问权限。

我已经看过密码的双向加密，但正如他们所说，双向与明文没有太大区别，就好像你可以解密它一样，攻击者也可以......最终。这里的问题是我已经设置了一个方法来使用存储在应用程序中的盐和密码，我使用了存储在数据库中的盐，但都有它们的弱点，即如果应用程序被反映它暴露盐类等

如何保护我的数据库中的用户名和密码，同时仍然让我的支持顾问能够查看应用程序中的信息，以便他们可以使用它来登录？

这显然与存储用户密码不同，因为这是一种方式，因为我不需要知道它们是什么。但我确实需要知道客户端的远程访问密码是什么，因为我们需要在远程访问它们时输入它们。

有人对这里最好的方法有一些理论吗？

**更新** 我正在尝试构建的功能是为我们的 CRM 应用程序存储客户端的远程访问详细信息。CRM 系统提供呼叫/问题跟踪功能，在调查问题的过程中，支持顾问将需要远程访问。然后他们将查看客户的远程访问详细信息并建立连接

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T19:07:33.220

有几种方法可以做到这一点；最好的解决方案将取决于您的支持团队如何访问客户的站点、有多少成员属于支持团队以及您的应用程序的体系结构。

做这样的事情的最好方法是使用像 Kerberos 这样的东西。这样，支持团队的成员就不必被委托给客户的密码——他们可以写下来并在以后用来攻击客户的密码。支持团队可以立即撤销成员的访问权限，而无需客户采取任何行动。

但是，我猜这是一个更危险的系统，团队成员通过远程桌面、SSH 或类似的方式获得访问客户端系统的密码。在这种情况下，当客户密码被泄露给团队成员时，就会承担很大的责任。

就个人而言，我不会接受这种风险。并不是我觉得我不能信任我的团队，而是我不能信任我的客户。如果他们的网站发生了什么事（或者即使他们只是假装发生了什么事），突然间我就成了嫌疑人。我宁愿设计一个系统，没有人可以访问单独行动的客户系统。这可以保护客户免受我团队中的坏苹果的伤害，并保护我免受虚假指控。

无论如何，一种方法是为每个团队成员生成密钥。这些可能是基于密码的对称加密密钥，但必须集中保存一些密钥。最好使用 RSA 等非对称算法。然后只集中保存团队成员的公钥。

当从客户端收到新密码时，使用每个需要副本的团队成员的公钥对其进行加密。此加密密码可以存储在数据库中，并在团队成员每次请求时提供给他们，也可以主动推送给团队成员以供他们存储。在任何一种情况下，当需要密码时，都会使用团队成员持有的私钥解密密码（在使用他们选择的密码加密的密钥库中）。

这有缺点。重申上述观点，团队成员可以访问客户密码。他们值得这种信任吗？如果客户有与该系统无关的安全漏洞，但想将责任归咎于某人怎么办？其次，虽然服务器上没有存储解密密钥，但仍然需要为每个团队成员的公钥建立信任。否则，攻击者可能会将他们自己的恶意公钥放入集合中并接收他们可以解密的密码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T09:21:32.340

类似的情况发生在我们公司，数据库管理员希望在他们之间维护一个凭据池。

我原本打算发布这个想法，但[埃里克森打败了我](https://stackoverflow.com/questions/835826/a-security-encryption-dilemma/836442#836442)。但是，可能值得发布一些伪代码来详细说明，所以我想我回答这个问题的时间并没有完全浪费......

你需要的东西：

*   一个数据库管理系统
*   [非对称密码](http://en.wikipedia.org/wiki/Public-key_cryptography)（例如：RSA [）](http://en.wikipedia.org/wiki/RSA)：
*   [对称密码](http://en.wikipedia.org/wiki/Symmetric-key_algorithm)（例如：[AES](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard)）
*   [密钥派生函数](http://en.wikipedia.org/wiki/Key_derivation_function)（例如：PBKDF2 [，](http://en.wikipedia.org/wiki/PBKDF2)感谢 erickson！）
    *   这需要一个[加密哈希函数](http://en.wikipedia.org/wiki/Cryptographic_hash_function)（例如：[SHA-512](http://en.wikipedia.org/wiki/SHA_hash_functions)）

首先，让我们设置数据库模式。这些表格将很快展示。

```
CREATE TABLE users (
  user_id               INTEGER,
  authentication_hash   BINARY,
  authentication_salt   BINARY,
  public_key            BINARY,
  encrypted_private_key BINARY,
  decryption_key_salt   BINARY,
  PRIMARY KEY(user_id)
)

CREATE TABLE secrets (
    secret_id INTEGER,
    -- WHATEVER COLUMNS YOU REQUIRE TO ACCURATELY MODEL YOUR PASSWORDS (CLIENT INFO, ETC)
    PRIMARY KEY(secret_id)
)

CREATE TABLE granted_secrets (
  secret_id      INTEGER,
  recipient_id   INTEGER,
  encrypted_data BINARY,
  PRIMARY KEY(secret_id, recipient_id),
  FOREIGN KEY(secret_id) REFERENCES secrets(secret_id)
  FOREIGN KEY(recipient_id) REFERENCES users(user_id)
) 
```

在用户可以开始使用这个系统之前，他们必须进行注册。

```
function register_user(user_id, user_password) {
    authentication_salt = generate_random_salt()
    authentication_hash = hash(authentication_salt, user_password);

    (public_key, private_key) = asymmetric_cipher_generate_random_key_pair();

    decryption_key_salt = generate_random_salt()
    decryption_key = derive_key(decryption_key_salt, user_password)
    encrypted_private_key = symmetric_cipher_encrypt(
        input => private_key,
        key   => decryption_key
    )

    // IMPORTANT: The decryption_key_hash is never stored

    execute("INSERT INTO users (user_id, authentication_hash, authentication_salt, public_key, encrypted_private_key, decryption_key_salt) VALUES (:user_id, :authentication_hash, :authentication_salt, :public_key, :encrypted_private_key, :decryption_key_salt)")
} 
```

用户可以登录系统。

```
function authenticate_user(user_id, user_password)
    correct_authentication_hash = query("SELECT authentication_hash FROM users WHERE user_id = :user_id")

    authentication_salt = query("SELECT authentication_salt FROM users WHERE user_id = :user_id")
    given_authentication_hash = hash(authentication_salt, user_password)

    return correct_authentication_hash == given_authentication_hash 
```

然后可以将秘密授予接收用户。

```
function grant_secret(secret_id, secret_data, recipient_id) {
    recipient_public_key = query("SELECT public_key FROM users WHERE user_id = :recipient_id")

    encrypted_secret_data = asymmetric_cipher_encrypt(
        input      => secret_data,
        public_key => recipient_public_key
    )

    execute("INSERT INTO granted_secrets (secret_id, recipient_id, encrypted_data) VALUES (:secret_id, :recipient_id, :encrypted_secret_data)")
} 
```

最后，已被授权访问秘密的用户（接收者）可以检索它。

```
void retrieve_secret(secret_id, recipient_id, recipient_password)
    encrypted_recipient_private_key = query("SELECT encrypted_private_key FROM users WHERE user_id = :recipient_id")

    recipient_decryption_key_salt = query("SELECT decryption_key_salt FROM users WHERE user_id = :recipient_id")
    recipient_decryption_key = derive_key(recipient_decryption_key_salt, recipient_password)
    recipient_private_key = symmetric_cipher_decrypt(
        input => encrypted_recipient_private_key,
        key   => recipient_decryption_key
    )

    encrypted_secret_data = query("SELECT encrypted_data FROM granted_secrets WHERE secret_id = :secret_id AND recipient_id = :recipient_id")

    secret_data = asymmetric_cipher_decrypt(
        input       => encrypted_secret_data,
        private_key => recipient_private_key
    )

    return secret_data 
```

希望这可以提供帮助。它确实帮助我充实了我的想法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T17:24:16.260

存储使用 AES 和良好的强密钥加密的密码。不要将解密密钥嵌入应用程序中，而是将其提供给您的用户（支持顾问）。然后让您的应用程序在他们需要查找信息时提示他们。不理想，因为每个人都使用相同的密钥，但如果您的数据库遭到破坏，它至少可以提供一些保护。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T12:49:12.557

如果您担心将原始用户密码提供给顾问，那么这里值得深思。

专门为您的支持成员生成临时密码/令牌怎么样？

当客户拨打电话时，创建一个令牌并将其与用户 ID 一起放入地图中。将此令牌或加密令牌发送给您的客户支持成员。然后，客户支持成员将使用用户名和令牌登录。系统检查有效令牌映射中的令牌并找到其有效令牌并授予对系统的访问权限。

支持会员解决问题。然后从 tokenMap 中移除 token。

通过这种方式，您永远不会向顾问透露原始用户密码。因此，您可以使用自己喜欢的安全技术存储用户密码。

您可以在发送令牌之前使用顾问的公钥对令牌进行加密。

令牌可能会给出到期时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T16:55:53.973

如果您需要从数据库中检索明文密码，那么您将需要使用 2 路加密方案。

不要将密钥放入您的客户端应用程序中。

这样，如果您担心密钥被泄露，您可以定期重新加密数据/更改密钥。尽管如果您的密钥足够强大并且不公开，那么您应该是安全的

通过网络连接发送密码时，请确保使用 SSL 加密链接。

设置可能如下所示

客户端--->服务器--->数据库

服务器解密密码并通过 SSL 链接将其传递给客户端。

如果您没有服务器并且您的客户端直接连接到数据库，那么您可以让您的客户端调用存储过程来检索纯文本密码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T17:04:31.083

这听起来像是为[DPAPI](http://msdn.microsoft.com/en-us/library/ms995355.aspx)设计的场景。创建一个可以验证您的客户端的中间层，然后在将数据存储到数据库之前使用 DPAPI 加密数据

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-05-07T17:06:54.633

您不需要将密码保存在数据库中，只需保存它们的哈希值（例如 SHA1）。然后在登录时再次计算哈希并将其与排序的哈希进行比较。

相信我，如果您没有存储密码，您的肩上就会减轻很多负担。

# grails - 在 grails 中是否有标准的审计跟踪方式？

> ID：835828
> 
> 赞同：5
> 
> 时间：2009-05-07T16:49:32.507
> 
> 标签：grails, audit

是否有 grails 插件或标准方式来管理域对象的`created_by`, `created_on`, `updated_by`,字段？`updated_on`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T23:24:50.950

如果您将 dateCreated 和 lastUpdated 声明为 Date，它们将由 grails 自动维护。您可以使用[Grails Audit Logging Plugin](http://www.grails.org/Grails+Audit+Logging+Plugin)在不同的安全系统下记录经过身份验证的用户。

# web-services - 无法连接到远程服务器 - SSRS 2008 - webservice

> ID：835829
> 
> 赞同：0
> 
> 时间：2009-05-07T16:49:45.843
> 
> 标签：web-services, reporting-services, ssrs-2008, load-testing

我有一个试图通过 ReportViewer 控件访问 SSRS 2008 ReportServer 的 asp.net 页面。使用在服务器上设置为“浏览器”角色的代理帐户访问报告。对于常规报告访问方案，此设置可以正常工作。但是每当我们尝试使用 100 个虚拟用户对该页面进行负载测试时，我们就会开始看到“无法连接到远程服务器”错误。负载测试设置为从 10 个用户开始，每 30 秒后增加 10 个用户。测试设置为运行 30 分钟。

堆栈跟踪如下：

> System.Net.WebResponse GetWebResponse(System.Net.WebRequest) System.Web.Services.Protocols.WebClientProtocol.GetWebResponse(WebRequest request) 在 System.Web.Services.Protocols.HttpWebClientProtocol.GetWebResponse(WebRequest request) 在 Microsoft.SqlServer.ReportingServices2005 .Execution.RSExecutionConnection.GetWebResponse(WebRequest request) 在 Microsoft.Reporting.WebForms.ServerReportSoapProxy.GetWebResponse(WebRequest request) 在 System.Web.Services.Protocols.SoapHttpClientProtocol.Invoke(String methodName, Object[] parameters) 在 Microsoft.SqlServer。 Microsoft.SqlServer.ReportingServices2005.Execution.RSExecutionConnection.LoadReport(String Report, String HistoryID) 的 Microsoft.Reporting.WebForms.ServerReport 的 ReportingServices2005.Execution.ReportExecutionService.LoadReport(String Report, String HistoryID)。Microsoft.Reporting.WebForms.ServerReport.SetParameters 处的 GetExecutionInfo()（IEnumerable`1 参数）

报表服务器配置中是否有需要更改以支持此类负载配置文件的内容？
我在想，100 个用户对于盒子来说并不多，因为盒子有 QuadCore Xeon 3.Ghz 和 10GB RAM。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T02:42:44.017

您可能需要检查托管 SSRS 的网站的应用程序池设置。确保没有将任何请求限制设置为任何低值。您可能想要更改一些设置并重新运行测试以查看它是否有任何影响。

另外，如果你从 10 个用户开始，每 30 秒再添加 10 个用户，然后运行 ​​30 分钟的测试，那不是更接近 600 个用户吗？或者你会在五分钟后停止添加用户吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T17:12:13.980

一些问题;

报告服务器上观察到的负载是多少；根据报告，如果返回数千行数据并对其进行操作，您可能会因用户数量较少而使其过载。根据您加载 vu 的方式，您可能会过早地输入过多的数据/请求。

其中一台机器上是否运行了自适应防火墙/ Windows 防火墙？一些防火墙会将此负载测试视为恶意行为，并在测试中将其部分阻止。

你排除了广告问题吗？如果不是，则 sqlserver 是否正确设置到 AD 中（信任委托并具有已注册的 SPN）并且在运行测试时 AD 服务器是否性能良好；我参与了一个使用普通域服务器的站点的负载测试；在运行测试时，我们将用户从未参与测试的整个网络中的应用程序和服务器中崩溃，因为我们通过错误设置的服务器通过数百万个请求使域控制器过载。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T02:09:40.383

我非常相信您的 SSRS 服务器已超载。您是在共享服务器还是专用服务器上托管 SSRS？如果您将其托管在共享服务器上，则应与您的主机讨论此问题。[我在asphostdirectory.com](http://www.asphostdirectory.com)上托管我的 SSRS 2008，到目前为止，服务真的很棒！我可以远程连接到我的 ReportManager，并且可以在线管理我的报告。到目前为止，我每月支付大约 6.99 美元来托管我的网站，当然，这是我目前可以获得的最佳价值。

如果您将 SSRS 托管在专用服务器上，则应考虑升级您的服务器资源。如果你真的有 10GB 的四核服务器，你应该没有问题！我不确定您的 SSRS 可以产生多少流量，但我真的相信具有 4GB RAM 的专用服务器足以处理 100 个并发用户。

希望这可以帮助

# objective-c - 为什么应用程序窗口只打开一次，然后再不打开？

> ID：835830
> 
> 赞同：2
> 
> 时间：2009-05-07T16:49:49.980
> 
> 标签：objective-c, cocoa

我正在根据书中的教程创建应用程序，但我注意到一个问题，当我创建的首选项窗口打开然后关闭时，它不会再次打开，我该如何解决这个问题？

谢谢。

编辑：我看到了另一篇关于此的帖子，但仍未得到答复，所以我想知道您是否可以为我回答这个问题。

编辑：我正在谈论一个面板（使用首选项窗格），它通过菜单项打开，并在窗口角落用十字关闭。我用来创建它的代码来自《Mac OS X 的 Cocoa 编程》一书，用作首选项窗格的面板位于单独的 nib 文件中。

编辑：这是代码，它很复杂，因为教程让你创建了 4 个文件。

**1) Preferences_Delegate.h**

```
#import <Cocoa/Cocoa.h>
@class PreferenceController;

@interface Prefernces_Delegate : NSObject {
    PreferenceController *preferenceController;
}
- (IBAction)showPreferencePanel:(id)sender;

@end 
```

**2) Preferences_Delegate.m**

```
#import "Prefernces_Delegate.h"
#import "PreferenceController.h"

@implementation Prefernces_Delegate

- (IBAction)showPreferencePanel:(id)sender
{
    // Is preferenceController nil?
    if (!preferenceController) {
        preferenceController = [[PreferenceController alloc] init];
    }
    NSLog(@"showing %@", preferenceController);
    [preferenceController showWindow:self];
}

@end 
```

**3）PreferencesController.h（不重要）**

```
#import <Cocoa/Cocoa.h>
@interface PreferenceController : NSWindowController {
    IBOutlet NSButton *checkbox;
}
- (IBAction)changeNewEmptyDoc:(id)sender;
@end 
```

**4) 首选项控制器.m**

```
#import "PreferenceController.h"

@implementation PreferenceController

- (id)init
{
    if (![super initWithWindowNibName:@"Preferences"])
        return nil;
    return self;
}
- (void)windowDidLoad
{
    NSLog(@"Nib file is loaded");
}
- (IBAction)changeNewEmptyDoc: (id)sender
{
    int state = [checkbox state];
        NSLog(@"Checkbox changed %d", state);
}

@end 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T18:57:13.650

在 Interface Builder 中，确保在 Window 的属性中关闭**Release on close 。**还要仔细检查窗口控制器与窗口之间的连接是否连接正常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T19:55:52.700

确保 windowController 中的 window 变量已连接到面板。

# python - Elixir（SqlAlchemy）：具有复合主键的 3 个表之间的关系

> ID：835834
> 
> 赞同：1
> 
> 时间：2009-05-07T16:50:58.353
> 
> 标签：python, sqlalchemy, python-elixir

我有 3 张桌子：

*   带有`(company_id)`主键的 Company 表
*   带有`(company_id, url)`主键和外键的页表返回公司
*   `(company_id, attr_key)`带有主键和返回公司的外键的 Attr 表。

我的问题是如何使用 Attr 中的现有列构建从 Attr 到 Page 的 ManyToOne 关系，即`company_id`和`url`？

```
from elixir import Entity, has_field, setup_all, ManyToOne, OneToMany, Field, Unicode, using_options
from sqlalchemy.orm import relation

class Company(Entity):
    using_options(tablename='company')
    company_id = Field(Unicode(32), primary_key=True)
    has_field('display_name', Unicode(255))
    pages = OneToMany('Page')

class Page(Entity):
    using_options(tablename='page')
    company = ManyToOne('Company', colname='company_id', primary_key=True)
    url = Field(Unicode(255), primary_key=True)

class Attr(Entity):
    using_options(tablename='attr')
    company = ManyToOne('Company', colname='company_id', primary_key=True)
    attr_key = Field(Unicode(255), primary_key=True)
    url = Field(Unicode(255)) #, ForeignKey('page.url'))
    # page = ManyToOne('Page', colname=["company_id", "url"])
    # page = relation(Page, backref='attrs', foreign_keys=["company_id", "url"], primaryjoin=and_(url==Page.url_part, company_id==Page.company_id)) 
```

我已经注释掉了一些失败的尝试。

最后，Attr.company_id 需要成为 Page 和 Company 的外键（以及 Attr 中的主键）。

这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T23:34:12.103

是的，你可以这样做。Elixir 没有内置的方法来做到这一点，但因为它是 SQLAlchemy 上的一个薄包装器，你可以说服它这样做。因为 Elixir 没有重用现有列的多对一关系的概念，您需要将 GenericProperty 与 SQLAlchemy 关系属性一起使用，并使用表选项添加外键。下面的代码应该做你想做的事：

```
from elixir import Entity, has_field, setup_all, ManyToOne, OneToMany, Field, Unicode, using_options, using_table_options, GenericProperty
from sqlalchemy.orm import relation
from sqlalchemy import ForeignKeyConstraint

class Company(Entity):
    using_options(tablename='company')

    company_id = Field(Unicode(32), primary_key=True)
    display_name = Field(Unicode(255))
    pages = OneToMany('Page')

class Page(Entity):
    using_options(tablename='page')

    company = ManyToOne('Company', colname='company_id', primary_key=True)
    url = Field(Unicode(255), primary_key=True)
    attrs = OneToMany('Attr')

class Attr(Entity):
    using_options(tablename='attr')

    page = ManyToOne('Page', colname=['company_id', 'url'], primary_key=True)
    attr_key = Field(Unicode(255), primary_key=True)

    using_table_options(ForeignKeyConstraint(['company_id'], ['company.company_id']))
    company = GenericProperty(relation(Company)) 
```

# linq - 使用 LINQ 的子查询中的高级多重连接

> ID：835836
> 
> 赞同：2
> 
> 时间：2009-05-07T16:51:01.380
> 
> 标签：linq, join, subquery, coalesce

我花了一个下午试图围绕如何将以下查询转换为 LINQ 来思考，但我无法做到。

```
declare @productId int; set @productId = 3212;

select * from InformationData data where productId = @productId and orgId = 1
and exists(
    select id from (
        select coalesce(id1.id, id2.id, id3.id) as id from (
            select productId,attributeId from InformationData where productId = @productId group by productId,attributeId
        ) id
        left outer join InformationData id1 on id1.productId = id.productId and id1.attributeId = id.attributeId and id1.language = 1
        left outer join InformationData id2 on id2.productId = id.productId and id2.attributeId = id.attributeId and id2.language = 2
        left outer join InformationData id3 on id3.productId = id.productId and id3.attributeId = id.attributeId and id3.language = 0
    ) row
    where row.id = data.id
) 
```

查询的目的是使用 2 种备用语言从表中获取数据，因此如果数据在语言 1 中不存在，则在语言 2 中获取，如果 2 不存在，则在语言 0 中获取，这是全球翻译。

我可以得到大部分正确的内部查询（除了 id1.language = 1，我似乎无法让它加入我要加入的表的成员，有什么想法吗？）

这是我的代码（LINQPad 代码）：

```
(
    from data in (
        from d in InformationData where d.ProductId == 3212 group d by new { d.ProductId, d.AttributeId } into p select new { ProductId = p.Key.ProductId, AttributeId = p.Key.AttributeId }
    )
    join x1 in InformationData on new { a = data.ProductId, b = data.AttributeId } equals new { a = x1.ProductId, b = x1.AttributeId } into f1
        from r1 in f1.DefaultIfEmpty()
        where r1.Language == 1
    join x2 in InformationData on new { a = data.ProductId, b = data.AttributeId } equals new { a = x2.ProductId, b = x2.AttributeId } into f2
        from r2 in f2.DefaultIfEmpty()
        where r2.Language == 2
    join x3 in InformationData on new { a = data.ProductId, b = data.AttributeId } equals new { a = x3.ProductId, b = x3.AttributeId } into f3
        from r3 in f3.DefaultIfEmpty()
        where r3.Language == 2
    select new { Id = ((int?)r1.Id) ?? ((int?)r2.Id) ?? r3.Id }
).Dump(); 
```

这会生成以下 SQL：

```
-- Region Parameters
DECLARE @p0 Int SET @p0 = 3212
DECLARE @p1 Int SET @p1 = 2
DECLARE @p2 Int SET @p2 = 2
DECLARE @p3 Int SET @p3 = 1
-- EndRegion
SELECT COALESCE([t2].[id],COALESCE([t3].[id],[t4].[id])) AS [Id]
FROM (
    SELECT [t0].[productId], [t0].[attributeId]
    FROM [InformationData] AS [t0]
    WHERE [t0].[productId] = @p0
    GROUP BY [t0].[productId], [t0].[attributeId]
    ) AS [t1]
LEFT OUTER JOIN [InformationData] AS [t2] ON ([t1].[productId] = [t2].[productId]) AND ([t1].[attributeId] = [t2].[attributeId])
LEFT OUTER JOIN [InformationData] AS [t3] ON ([t1].[productId] = [t3].[productId]) AND ([t1].[attributeId] = [t3].[attributeId])
LEFT OUTER JOIN [InformationData] AS [t4] ON ([t1].[productId] = [t4].[productId]) AND ([t1].[attributeId] = [t4].[attributeId])
WHERE ([t4].[language] = @p1) AND ([t3].[language] = @p2) AND ([t2].[language] = @p3) 
```

但我不能把它和其余的查询放在一起，也许我只是累了买我一直在做很多交叉申请。有没有人有什么建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T08:55:22.777

好吧，睡了一夜好觉，一些嘎吱嘎吱的东西变得更亮了，我找到了解决方案:)对于任何对此感到好奇的人来说

```
 (
    from i in InformationData
    where (
        from data in (
            from d in InformationData where d.ProductId == 3212 group d by new { d.ProductId, d.AttributeId } into p select new { ProductId = p.Key.ProductId, AttributeId = p.Key.AttributeId }
        )
        join x1 in InformationData on new { a = data.ProductId, b = data.AttributeId, c = 1} equals new { a = x1.ProductId, b = x1.AttributeId, c = x1.Language } into f1
            from r1 in f1.DefaultIfEmpty()
        join x2 in InformationData on new { a = data.ProductId, b = data.AttributeId, c = 2 } equals new { a = x2.ProductId, b = x2.AttributeId, c = x2.Language } into f2
            from r2 in f2.DefaultIfEmpty()
        join x3 in InformationData on new { a = data.ProductId, b = data.AttributeId, c = 0 } equals new { a = x3.ProductId, b = x3.AttributeId, c = x3.Language } into f3
            from r3 in f3.DefaultIfEmpty()
        select new { Id = ((int?)r1.Id) ?? ((int?)r2.Id) ?? r3.Id }
    ).Any(d => d.Id == i.Id)
    select i
).Dump(); 
```

这是生成的 SQL

```
 -- Region Parameters
DECLARE @p0 Int SET @p0 = 3212
DECLARE @p1 Int SET @p1 = 1
DECLARE @p2 Int SET @p2 = 2
DECLARE @p3 Int SET @p3 = 0
-- EndRegion
SELECT [t0].[id] AS [Id], [t0].[attributeId] AS [AttributeId], [t0].[productId] AS [ProductId], [t0].[value] AS [Value], [t0].[orgId] AS [OrgId], [t0].[version] AS [Version], [t0].[language] AS [Language], [t0].[metaType] AS [MetaType], [t0].[overload] AS [Overload], [t0].[parentId] AS [ParentId]
FROM [InformationData] AS [t0]
WHERE EXISTS(
    SELECT NULL AS [EMPTY]
    FROM (
        SELECT COALESCE([t3].[id],COALESCE([t4].[id],[t5].[id])) AS [value]
        FROM (
            SELECT [t1].[productId], [t1].[attributeId]
            FROM [InformationData] AS [t1]
            WHERE [t1].[productId] = @p0
            GROUP BY [t1].[productId], [t1].[attributeId]
            ) AS [t2]
        LEFT OUTER JOIN [InformationData] AS [t3] ON ([t2].[productId] = [t3].[productId]) AND ([t2].[attributeId] = [t3].[attributeId]) AND (@p1 = [t3].[language])
        LEFT OUTER JOIN [InformationData] AS [t4] ON ([t2].[productId] = [t4].[productId]) AND ([t2].[attributeId] = [t4].[attributeId]) AND (@p2 = [t4].[language])
        LEFT OUTER JOIN [InformationData] AS [t5] ON ([t2].[productId] = [t5].[productId]) AND ([t2].[attributeId] = [t5].[attributeId]) AND (@p3 = [t5].[language])
        ) AS [t6]
    WHERE [t6].[value] = [t0].[id]
    ) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T18:21:26.810

主要基于您对查询应该做什么的描述，我认为您可以使用适当的“orderby”子句完成相同的结果并仅检索第一个结果。像这样：

```
var result =
(
    from d in InformationData
    where d.ProductId == 3212
    orderby ((d.language == 0) ? Int32.MaxValue : d.language)
    select d
).First(); 
```

**编辑**：您可以通过扩展 orderby 子句来控制搜索优先级。例如，如果优先级应该是 2，然后是 3，然后是 1，然后是其他任何东西，您可以这样做：

```
var result =
(
    from d in InformationData
    where d.ProductId == 3212
    orderby
        (d.language == 2) ? 0
        : (d.language == 3) ? 1
        : (d.language == 1) ? 2
        : Int32.MaxValue
    select d
).First(); 
```

# c# - 使用 WCF JSON Web 服务的客户端配置

> ID：835839
> 
> 赞同：12
> 
> 时间：2009-05-07T16:51:28.413
> 
> 标签：c#, .net, wcf, web-services, json

我已将 Web 服务配置为使用此博客中所述的 Json：[http](http://www.west-wind.com/weblog/posts/164419.aspx) ://www.west-wind.com/weblog/posts/164419.aspx和其他各种博客，但我无法创建客户端来使用它服务。我尝试了各种各样的事情，但总是遇到毫无意义的例外。实现（我应该添加的 WCF）客户端的正确方法是什么？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2010-12-26T19:08:53.967

似乎缺乏关于如何为 JSON REST 服务编写 WCF 客户端的示例。似乎每个人都使用 WCF 来实现服务，但几乎没有使用 WCF 来编写客户端。因此，这里有一个相当完整的服务（实现 GET 和 POST 请求）和客户端示例。

## 服务

**服务接口**

```
[ServiceContract]
public interface IService1
{
    [OperationContract]
    [WebGet(ResponseFormat = WebMessageFormat.Json,
        BodyStyle = WebMessageBodyStyle.Bare,
        UriTemplate = "/getcar/{id}")]
    Car GetCar(string id);

    [OperationContract]
    [WebInvoke(RequestFormat = WebMessageFormat.Json,
        ResponseFormat = WebMessageFormat.Json,
        BodyStyle = WebMessageBodyStyle.Bare,
        UriTemplate = "/updatecar/{id}")]
    Car UpdateCar(string id, Car car);
} 
```

**服务数据结构**

```
[DataContract]
public class Car
{
    [DataMember]
    public int ID { get; set; }

    [DataMember]
    public string Make { get; set; }
} 
```

**服务实施**

```
public class Service1 : IService1
{
    public Car GetCar(string id)
    {
        return new Car { ID = int.Parse(id), Make = "Porsche" };
    }

    public Car UpdateCar(string f, Car car)
    {
        return car;
    }
} 
```

**服务标记**

```
<%@ ServiceHost Language="C#" Service="JSONService.Service1"
    CodeBehind="Service1.svc.cs"
    Factory="System.ServiceModel.Activation.WebServiceHostFactory" %> 
```

**网页配置**

```
<?xml version="1.0"?>
<configuration>
  <system.web>
    <compilation debug="true" targetFramework="4.0" />
  </system.web>
  <system.serviceModel>
    <behaviors>
      <serviceBehaviors>
        <behavior>
          <serviceMetadata httpGetEnabled="true"/>
        </behavior>
      </serviceBehaviors>
    </behaviors>
    <serviceHostingEnvironment multipleSiteBindingsEnabled="true" />
  </system.serviceModel>
  <system.webServer>
    <modules runAllManagedModulesForAllRequests="true"/>
  </system.webServer>   
</configuration> 
```

## 客户

现在是客户。它重用了接口`IService1`和类`Car`。此外，还需要以下代码和配置。

**应用程序配置**

```
<?xml version="1.0"?>
<configuration>
  <system.serviceModel>
    <behaviors>
      <endpointBehaviors>
        <behavior name="webby">
          <webHttp/>
        </behavior>
      </endpointBehaviors>
    </behaviors>
    <client>
      <endpoint address="http://localhost:57211/Service1.svc" name="Service1" binding="webHttpBinding" contract="JSONService.IService1" behaviorConfiguration="webby"/>
    </client>
  </system.serviceModel>
</configuration> 
```

**程序.cs**

```
public class Service1Client : ClientBase<IService1>, IService1
{
    public Car GetCar(string id)
    {
        return base.Channel.GetCar(id);
    }

    public Car UpdateCar(string id, Car car)
    {
        return base.Channel.UpdateCar(id, car);
    }
}

class Program
{
    static void Main(string[] args)
    {
        Service1Client client = new Service1Client();
        Car car = client.GetCar("1");
        car.Make = "Ferrari";
        car = client.UpdateCar("1", car);
    }
} 
```

玩得开心。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-07T18:21:15.280

有哪些例外？它们对您来说可能毫无意义，但这里的一些人可能会发现它们有助于诊断您的问题。我使用 jQuery 向 WCF 服务发出 ajax 请求，设置通常如下所示：

```
 $(document).ready(function() {

        $.ajaxSetup({
            type: "POST",
            processData: true,
            contentType: "application/json",
            timeout: 5000,
            dataType: "json"
        });
        var data = { "value": 5 };

        AjaxPost("GetData", data, OnEndGetData, OnError);
    });

    function OnEndGetData(result) {
        alert(result.GetDataResult);
    }

    function OnError(msg) {
        alert(msg);
    }

function AjaxPost(method, data, callback, error) {
    var stringData = JSON.stringify(data);
    var url = "Service1.svc/" + method;

    $.ajax({
        url: url,
        data: stringData,
        success: function(msg) {
            callback(msg);
        },
        error: error
    });
} 
```

JSON.stringify() 可以在 json.org 脚本中找到：[http://www.json.org/js.html](http://www.json.org/js.html)，我的 GetData 方法的签名如下所示：

```
[OperationContract]
[WebInvoke(Method = "POST", BodyStyle = WebMessageBodyStyle.Wrapped, ResponseFormat =   WebMessageFormat.Json)]
string GetData(int value); 
```

# methods - 通用扩展方法

> ID：835843
> 
> 赞同：0
> 
> 时间：2009-05-07T16:52:59.067
> 
> 标签：methods, generics

我正在按照 Rob Connery 的店面视频系列开发这个 mvc 项目并应用这些技术。关于过滤和扩展方法，我开始重复自己很多，例如：

```
public static Sponsor WithID(this IQueryable<Sponsor>qry, int ID)
{
    return qry.SingleOrDefault(s => s.ID== ID);
}

public static Keyword WithID(this IQueryable<Keyword>qry,int ID)
{
    return qry.SingleOrDefault(s => s.ID== ID);
}
.... 
```

为了防止这种情况，我尝试编写一个这样的通用扩展：

```
public static T WithID<T>(this IQueryable<T>qry,int ID)
{
    return qry.SingleOrDefault(s=>ID==ID);
} 
```

但是 s 没有 ID，那么您将如何解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T16:56:04.957

您需要一个声明 ID 属性的接口，例如

```
public interface IInt32Identifiable
{
    public int ID { get; }
} 
```

然后你可以写：

```
public static T WithID<T>(this IQueryable<T> source, int id)
    where T : IInt32Identifiable
{
   return source.SingleOrDefault(s=> s.ID == id);
} 
```

当然，您必须使所有适当的类都实现该接口——但这通常很容易；如果这些类是设计器生成的，您可能想要使用部分类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T16:56:46.670

您将需要两种不同的扩展方法。一种用于具有 ID 的类型，另一种用于没有 ID 的类型。您还需要一个所有 ID 类型都实现的接口或抽象基类。否则，编译器不会让您取消引用 ID。

我能想到的唯一其他选择将需要反射来查询 ID 属性的类型，如果存在，则获取值。

# php - 将 PHP(JSON) 转换为 ASP 代码

> ID：835847
> 
> 赞同：0
> 
> 时间：2009-05-07T16:53:36.723
> 
> 标签：php, json, asp-classic

有人可以将下面的代码转换为 ASP 格式吗？

```
<?php

$data = '
[
  {
    "A": "test",
    "B": "test",
    "C": "test"
  },
  {
    "A": "test",
    "B": "test",
    "C": "test"
  }
]
';

print($_GET['callback'] .'('. $data .')'); 
```

当我在测试跨域限制解决方法时，这段代码在 PHP 服务器上运行良好（当然），事情是我想在 ASP 环境下实现它。我在这里试过[http://www.me-u.com/php-asp/hosting/asp.php](http://www.me-u.com/php-asp/hosting/asp.php)。提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T17:33:54.663

比如，*一次*？

```
<%
Dim data 

''// VBScript Strings cannot span multiple lines, we must use
''// concatenation ("&") and line continuation markers ("_")
''// (also, double quotes need to be escaped by *double* double quotes)
data = "" & _
  "[" & _
  "  {" & _
  "    ""A"": ""test""," & vbCrLf & _
  "    ""B"": ""test""," & vbCrLf & _
  "    ""C"": ""test"""  & vbCrLf & _
  "  }," & vbCrLf & _
  "  {" & vbCrLf & _
  "    ""A"": ""test""," & vbCrLf & _
  "    ""B"": ""test""," & vbCrLf & _
  "    ""C"": ""test""" & vbCrLf & _
  "  }" & vbCrLf & _
  "]"

Response.Write Request.QueryString("callback") & "(" & data & ")"
%> 
```

如果您无论如何都要打印出所有字符串，则可以避免整个字符串连接业务（例如，在变量中没有进一步的用途）：

```
<%
Response.Write Request.QueryString("callback") & "("
%>
[
  {
    "A": "test",
    "B": "test",
    "C": "test"
  },
  {
    "A": "test",
    "B": "test",
    "C": "test"
  }
]
<%
Response.Write ")"
%> 
```

# memcached - 是否可以在 Apache iBatis 中注入 memcached？

> ID：835849
> 
> 赞同：2
> 
> 时间：2009-05-07T16:54:22.340
> 
> 标签：memcached, ibatis

我一直在使用一个需要缓存 SQL 查询的分布式应用程序来处理一个复杂的项目：因为我一直在使用 iBatis 框架，所以我想使用 memcached - sysadmin 需要它 - 作为缓存引擎。可能吗？如果是，是否有人知道现有的解决方案/实现？我已经知道 OSCACHE 也可以在集群中工作，但我想知道在切换到新架构之前是否可以使用现有架构。提前谢谢了！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-01T04:25:43.753

有趣的问题！

iBatis 返回一个或多个 JavaBean，而这些 JavaBean 又可能包含嵌套的 JavaBean 列表。JavaBean 只是一个遵守某些简单[约定](http://en.wikipedia.org/wiki/JavaBeans)的 Java 对象，其中之一是它实现了 Serializable 接口。如果是这样，您可以将 JavaBean 结构[序列](http://java.sun.com/developer/technicalArticles/Programming/serialization/)化为字符串，然后将该字符串反序列化回原始 JavaBean 结构的深层副本。

因此，假设您确保所有结果对象都被声明为“实现可序列化”。JavaBeans 的结构如此简单，不需要重写默认的Java 对象序列化/反序列化机制，这很好。

这些序列化的字符串是您放入 memcached 集群的分布式哈希映射的值*。*在每个运行查询并返回其结果的 Java 方法中，您首先在 memcached 中查找现有结果，如果它*存在*并且尚未过期，则将其反序列化为（可能）您的查询将返回的 JavaBean . 如果在 memcached 中*没有*找到查询结果，那么你通过 iBatis 查询数据库，但是在返回结果之前，你将它序列化为 String 并将该值存储在 memcached 中。

下一个问题是什么用于 memcached 查询结果*键*。就像是

```
YourIbatisQueryName + ":" + FirstParameterValue + ":" + SecondParameterValue 
```

应该可以工作（例如，“SelectStackOverflowReputation:Simone:Tripodi”）。

你快完成了。最后一步是计算查询结果可以缓存多长时间而不会失效。也许您可以为每个查询建立不同的过期时间，或者您可能需要手动缓存失效机制。即使只是几分钟的缓存查询结果也会对应用程序的可伸缩性产生非常大的影响。

注意：此方法的一个变体是不使用默认的 Java 序列化，而是使用 XML、JSON 或其他格式。如果您选择 XML 或 JSON，请查看[XStream 之](http://xstream.codehaus.org/)类的序列化框架，将您的 JavaBean 序列化/反序列化为 XML 字符串，然后再返回。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-21T08:08:09.733

扩展 cacheController ，但别名使用添加全局

# .net - Powershell 调用使用 App.config 的 .NET 程序集

> ID：835862
> 
> 赞同：20
> 
> 时间：2009-05-07T16:57:21.350
> 
> 标签：.net, powershell, app-config

我有一个 Powershell 脚本，它正在加载一个 .NET 程序集（在我的例子中是 .EXE）并调用一个使用 app.config 拉取加密连接字符串的公共方法。

该脚本将程序集的 exe.config 作为 powershell.exe.config 动态复制到 Powershell ($pshome) 文件夹，并且能够从我的开发框运行得很好。问题是它不能从标准的 Windows Server 2003 安装中运行。

我验证了 exe.config 已正确复制到 powershell 目录。我已经运行了 SysInternals Process Explorer 并验证了该进程正在访问配置文件（没有文件未找到消息）。我远程调试了 powershell.exe 实例，可以看到程序集加载正常，但无法访问 ConfigurationManager.AppSettings[...] 值（返回 null）。

我没主意了。我读过我可能可以使用单独的应用程序域，但我没有看到使用 Powershell 执行此操作的示例。

我的代码起到以下作用：

```
$absolute_path = "c:\foo.exe"
$config_path = $absolute_path + ".config"
copy "$config_path" "$pshome\powershell.exe.config" -Force
[Reflection.Assembly]::LoadFrom($absolute_path)
$foo = new-object MyFooAssembly.FooClass
$foo.DoSomething() 
```

在 Vista 中代码有效，在 Windows Server 2003 中代码无效。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-05-07T17:26:24.663

尝试：

```
[System.AppDomain]::CurrentDomain.SetData("APP_CONFIG_FILE", $config_path) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T23:41:43.103

经过进一步研究，我找到了原因。在脚本的前一点，我正在加载 SMO：

```
$null = [reflection.assembly]::loadwithpartialname("microsoft.sqlserver.smo") 
```

我相信这会破坏我的配置设置。解决方法是按照克里斯上面提到的首先对这个调用进行操作：

```
[System.AppDomain]::CurrentDomain.SetData("APP_CONFIG_FILE", $null)
$null = [reflection.assembly]::loadwithpartialname("microsoft.sqlserver.smo") 
```

然后在我第二次调用另一个程序集时这样做：

```
$config_path = $assembly_exe + ".config"
[System.AppDomain]::CurrentDomain.SetData("APP_CONFIG_FILE", $config_path)
[Reflection.Assembly]::LoadFrom($assembly_exe) 
```

问题似乎解决了……

# windows - 从 Git Bash 运行 Ruby 时出现“Bad Interpreter: No Medium”错误

> ID：835865
> 
> 赞同：2
> 
> 时间：2009-05-07T16:57:34.017
> 
> 标签：windows, ruby, bash, cygwin

我在运行时看到此错误：来自我的 Git Bash 的 rake/gem。有谁知道是什么意思？

```
sh.exe": /c/Ruby/bin/gem: D:/Users/Luis/projects/oss/oci/installer2-trunk/ruby/bin/ruby.exe^M: bad interpreter: no medium 
```

在 Windows/Cygwin 下运行 - 特别是在 Git Bash shell 中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T17:01:26.830

感谢这个网站：[http ://www.liquidfish.net/2009/04/ruby-and-git-bash-woes.htm](http://www.liquidfish.net/2009/04/ruby-and-git-bash-woes.htm)

原来 - c:\ruby\bin\gem 和 c:\ruby\bin\rake 在文件顶部的 shebang 中都有一个奇怪的路径。

我删除了整行并将其替换为

```
#!ruby.exe 
```

两者都很好用。

仅供参考，这是因为我有 ruby​​.exe 的路径作为我的系统路径的一部分 - 如果我没有，我将不得不使用

```
#!(path to ruby.exe)/ruby.exe 
```

# ruby - 使用 ruby 进行简单的远程 ODBC 数据库连接

> ID：835868
> 
> 赞同：4
> 
> 时间：2009-05-07T16:58:33.810
> 
> 标签：ruby, database, odbc

我正在尝试与远程数据库建立简单的连接。我似乎无法让它工作。

```
remote_db = DBI.connect('DBI:ODBC:remote-host','user','password')
remote_db.table { |table| pp table } 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T17:19:04.637

我认为您正在寻找的是Ruby DBI。
[http://ruby-dbi.rubyforge.org/](http://ruby-dbi.rubyforge.org/)

以下是使用 DBI 进行 ODBC 连接的示例：

```
# Require in the DBI files<br />
require 'DBI'

# create an ODBC connection instance<br />
dbi_conn = DBI.connect('DBI:ODBC:datasource','your_username','your_password')

# query tables available  <br />
dbi_conn.tables

# returns an array with the results from a table TABLE:<br />
array_out = dbi_conn.select_all('SELECT * FROM TABLE') 
```

一些更深入的信息：
[http ://www.kitebird.com/articles/ruby-dbi.html](http://www.kitebird.com/articles/ruby-dbi.html)

或者，您也可以使用 ruby​​-odbc： http:
[//odbc-rails.rubyforge.org/](http://odbc-rails.rubyforge.org/)

# c# - isNull(col, '')

> ID：835871
> 
> 赞同：1
> 
> 时间：2009-05-07T16:59:36.490
> 
> 标签：c#, subsonic, case, isnull

如何在 SubSonic/C# 中编写查询以执行以下操作？

从表中选择 isNull(col, someDefaultValue)

select x = case when (condition) then col1 else col2 end from table

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T17:10:20.413

我没有在本地启动和运行 SubSonic，但它看起来支持合并功能，这就是您的第一个查询似乎正在做的事情。（Coalesce 接受任意数量的参数并返回第一个非空参数。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T19:23:54.413

您可能会想在 subsonicproject 上使用内联查询函数[示例](http://subsonicproject.com/docs/Inline_Query_Tool)

# asp.net - 母版页怪异 - “内容控件必须是内容页或引用母版页的嵌套母版页中的顶级控件。”

> ID：835877
> 
> 赞同：68
> 
> 时间：2009-05-07T17:02:04.457
> 
> 标签：asp.net, visual-studio-2008, master-pages

这很奇怪。我在 Visual Studio 2008 中的解决方案中添加了一个全新的 Web 应用程序项目。

创建了一个母版页。进行了零修改。创建了一个新的网络表单。将其母版页设置为我刚刚创建的 MP。

仍然，没有修改。没有标记。没有用户控制。没有参考。没有。但是，当我尝试运行它时，我得到：

```
Content controls have to be top-level controls in a content page or a nested master page that references a master page.
HttpException (0x80004005): Content controls have to be top-level controls in a content page or a nested master page that references a master page.]
   System.Web.UI.MasterPage.CreateMaster(TemplateControl owner, HttpContext context, VirtualPath masterPageFile, IDictionary contentTemplateCollection) +8665016
   System.Web.UI.Page.get_Master() +51
   System.Web.UI.Page.ApplyMasterPage() +15
   System.Web.UI.Page.PerformPreInit() +45
   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +282 
```

如果我在这个解决方案之外的独立项目中做同样的事情，它工作正常。请记住，我使用的是 Web 应用程序项目与网站项目，如果这有什么不同的话。

网络表格：

```
<%@ Page Language="vb" AutoEventWireup="false" CodeBehind="Default.aspx.vb" Inherits="WebUI._Default" MasterPageFile="~/Site1.Master" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title></title>
</head>
<body>
    <form id="form1" runat="server">
    <div>

    </div>
    </form>
</body>
</html> 
```

母版页：

```
<%@ Master Language="VB" AutoEventWireup="false" CodeBehind="Site1.master.vb" Inherits="WebUI.Site1" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title></title>
    <asp:ContentPlaceHolder ID="head" runat="server">
    </asp:ContentPlaceHolder>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <asp:ContentPlaceHolder ID="ContentPlaceHolder1" runat="server">

        </asp:ContentPlaceHolder>
    </div>
    </form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-05-07T17:24:59.643

您的网络表单不应包含所有这些标记（如`<html>`标签）。由于它有一个母版页，您只需从内容标签开始。您的 aspx 页面应如下所示：

```
<%@ Page Language="vb" AutoEventWireup="false" CodeBehind="Default.aspx.vb" Inherits="WebUI._Default" MasterPageFile="~/Site1.Master" %>

<asp:content id="Content1" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
   This is the body!
</asp:content> 
```

当您添加新的 aspx 页面时，请确保在“添加新项目”对话框中选中“选择母版页”。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2009-05-07T17:32:32.887

这是使用 Visual Studio 的另一种方法：如果您在 Visual Studio 中执行 New Item 并选择 Web Form，它将创建一个独立的 *.aspx Web 表单，这就是您当前的 Web 表单所拥有的（这是您所做的吗？） . 您需要选择 Web 内容表单，然后选择要附加到它的母版页。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-07T17:25:57.397

您的 Web 表单应如下所示：

```
<%@ Page Language="vb" AutoEventWireup="false" CodeBehind="Default.aspx.vb" Inherits="WebUI._Default" MasterPageFile="~/Site1.Master" %>
<asp:Content runat="server" ID="head" ContentPlaceHolderId="head">
<!-- stuff you want in &gt;head%lt; -->
</asp:Content>

<asp:Content runat="server" ID="content" ContentPlaceHolderId="ContentPlaceHolder1">
<h1>Your content</h1>
</asp:Content> 
```

注意没有`<html>`标签

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-07T17:11:22.390

创建 WebForm 时，您是否在“添加新项目”对话框本身中选择了它所附加的母版页？还是您使用指令的`MasterPageFile`属性手动附加它？`@Page`如果是后者，它可能会解释您收到的错误消息。

VS 会自动在每种页面中插入特定的标记。`@Page`如果您在创建页面时选择 MasterPage，则除了声明和顶级 Content 控件之外，它不会生成任何标记。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-07T17:30:03.033

> 出于某种原因，创建页面对话框中没有选择母版页的选项。我已经尝试过以编程方式声明 MP 和更新“属性”窗格中的属性。– NoCarrier 13 分钟前
> 
> 我相信这是因为我使用的是“网络应用程序”与“网站”——NoCarrier 9 分钟前

很可能它在您的问题所在的 <@PAGE> 标记中。也就是说，无论您是否使用 Web 应用程序都没有区别。要创建子页面，请右键单击解决方案资源管理器中的母版页，然后选择添加内容页面。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-11-29T04:03:58.847

刚遇到这个问题。这是因为我们有一个以双斜杠结尾的标签：

```
<//asp:HyperLink> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-01-31T15:46:05.207

我刚刚遇到了这个异常，在我的情况下，它是由 asp:content 元素之间的空格引起的

所以，这失败了：

```
<asp:content runat="server" ContentPlaceHolderID="Header">
    Header
</asp:content>

<asp:Content runat="server" ContentPlaceHolderID="Content">
    Content
</asp:Content> 
```

但是删除元素之间的空白是有效的：

```
<asp:content runat="server" ContentPlaceHolderID="Header">
    Header
</asp:content><asp:Content runat="server" ContentPlaceHolderID="Content">
    Content
</asp:Content> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-08-11T15:50:28.530

我想迟到总比没有好...您可以选择设置 MASTERPAGE 只有您正在开发网站（文件>新>网站）...但不是在您创建 ASP.NET 项目时（文件>新> PROJECT） - 您必须使用新创建的 web 表单的属性设置 Masterpage，并由您来修改 ASPX 源以使其符合母版页（即删除库存 HTML 等...）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-12-14T17:50:00.220

```
protected void Page_PreInit(object sender, EventArgs e) 
{ 
 if (Membership.GetUser() == null) //check the user weather user is logged in or not
    this.Page.MasterPageFile = "~/General.master";
 else
    this.Page.MasterPageFile = "~/myMaster.master";
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-02-05T17:21:11.837

我在 SharePoint Designer 2013 中编辑 Web 部件 (.aspx) 页面后遇到此错误。当我查看 SPD 中的代码时，页面顶部附近的 H1 元素以黄色突出显示。将鼠标悬停在上面表示 SharePoint:AjaxDelta 在 H1 之前没有关闭。添加 `</SharePoint:AjaxDelta>`修复它。

很奇怪，因为在我处理列表视图 Web 部件或页面其他位置的页面查看器 Web 部件后，SPD 出现了错误。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-05-09T04:45:11.140

您需要添加**asp内容**并添加**内容占位符ID**对应于母版页中的占位符。

您可以阅读此[链接](https://docs.microsoft.com/en-us/aspnet/web-forms/overview/older-versions-getting-started/master-pages/multiple-contentplaceholders-and-default-content-cs)以获取更多详细信息

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-05-02T21:48:25.773

在我的情况下，我在页面中动态加载用户控件，并且页面和用户控件都有内容标签

```
<asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server"> 
```

从用户控件中删除此标签对我有用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-11-23T10:46:09.143

在我的情况下`runat="server"`，asp:content 标记中缺少。我知道这很愚蠢，但有人可能已经从我得到的构建中的代码中删除了。

它对我有用。有人可能会面临同样的事情。因此共享。

# wpf - WPF TextBox 在窗口窗体中的 ElementHost 中不接受输入

> ID：835878
> 
> 赞同：20
> 
> 时间：2009-05-07T17:02:16.237
> 
> 标签：wpf, interop, textbox, elementhost

我们正在 WPF 中开发一个 UI 控件，以便在现有的 Windows 窗体/MFC 应用程序引擎 (Rhino 3D) 中使用。

应用程序引擎公开了创建“Dockbar”的能力，它实质上允许您将 Windows 窗体控件放在可以停靠到引擎界面的子窗口中。

我试图将一个简单的 WPF TextBox 放在 ElementHost 控件中，该控件已添加到 Dockbar 中。乍一看，这似乎工作正常；但在尝试输入文本框后，只有某些序列实际显示在文本框中。**DELETE**、**BACKSPACE**、**COPY**、**PASTE**和SELECTING **TEXT**工作。如果您键入 AZ、1-9 等，则不会显示这些键。

我已经在网上搜索过，并且听说过，**`ElementHost.EnableModelessKeyboardInterop()`**但这仅适用于从表单创建的 WPF Windows。我只是创建 WPF 用户控件并将它们托管在 ElementHost 控件中。

我看到一篇关于 Dispatcher.Run() 的帖子，它有点工作，但打破了表格的其余部分：

```
System.Windows.Threading.Dispatcher.Run(); 
```

**PreviewKeyUp**、**PreviewKeyDown**、**KeyUp**和**KeyDown**事件都在 TextBox 上触发，但遗憾的是，TextBox 中没有显示任何文本。

我对 Windows 消息了解不多，但使用 WinSpector 我注意到没有 WM_GETTEXT 消息来自 TextBox（如果它们甚至应该是我不知道）。

我还创建了一个新的 Windows Forms 项目并在那里做了同样的事情，它工作正常，所以它必须是如何在 Rhino 3D 引擎中创建和停靠窗口的问题。

这是不起作用的示例代码：

```
ElementHost el = new ElementHost();
System.Windows.Controls.TextBox t = new System.Windows.Controls.TextBox();
t.Width = 100;
t.Text = "TEST";
el.Child = t;
panel1.Controls.Add(el); 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-07T19:58:29.370

经过两天的抓头，我终于弄明白了……

MFC 对话框窗口正在接收**`WM_CHAR`**消息并阻止控件处理输入。因此，为了防止这种情况，我挂钩 HwndSource，每当我收到**`WM_GETDLGCODE`**消息时，我都会回复要接受的输入类型，然后将事件标记为已处理。

我创建了自己的 TextBox 以防止必须修复每个文本框（见下文）：

```
 /// <summary>
    /// Interop Enabled TextBox : This TextBox will properly handle WM_GETDLGCODE Messages allowing Key Input
    /// </summary>
    class IOTextBox : TextBox
    {
        private const UInt32 DLGC_WANTARROWS = 0x0001;
        private const UInt32 DLGC_WANTTAB = 0x0002;
        private const UInt32 DLGC_WANTALLKEYS = 0x0004;
        private const UInt32 DLGC_HASSETSEL = 0x0008;
        private const UInt32 DLGC_WANTCHARS = 0x0080;
        private const UInt32 WM_GETDLGCODE = 0x0087;

        public IOTextBox() : base()
        {
            Loaded += delegate
                          {
                              HwndSource s = HwndSource.FromVisual(this) as HwndSource;
                              if (s != null)
                                  s.AddHook(new HwndSourceHook(ChildHwndSourceHook));
                          };
        }

        IntPtr ChildHwndSourceHook(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
        {
            if (msg == WM_GETDLGCODE)
            {
                handled = true;
                return new IntPtr(DLGC_WANTCHARS | DLGC_WANTARROWS | DLGC_HASSETSEL);
            }
            return IntPtr.Zero;
        }
    } 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-08T13:30:49.050

看看我自己关于这件事的问题。最后，你所需要的只是这样的：

```
Window window1 = new Window();
ElementHost.EnableModelessKeyboardInterop(window1);
window1.Show(); 
```

[为什么我的 WPF 文本框“有点”只读？](https://stackoverflow.com/questions/578826/why-is-my-wpf-textbox-kinda-readonly)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-03-15T16:58:56.263

我对 wxWidgets 父窗口和嵌入的 WPF TextBox 控件有类似的问题。我发现虽然附加 ChildHwndSourceHook 确实解决了不接收键盘输入的问题，但我最终还是偶尔会出现重复的空格字符。似乎 WM_KEYDOWN 消息可靠地处理了空格字符，但是对于某些空格，也会收到重复的 WM_CHAR 消息。为了解决这个问题，我在 ChildHwndSourceHook 函数的主体中添加了以下子句，它只是忽略了 WM_CHAR 空格字符：

```
 const UInt32 WM_CHAR = 0x0102;

        if (msg == WM_CHAR)
        {
            // avoid duplicated spaces when parent window is a native window
            if (wParam.ToInt32() == 32)
                handled = true;
        } 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-03-19T15:16:54.927

不必创建派生的 TextBox。IOTextBox 的代码可用于承载文本框的 UserControl。我已经使用用于 VS2010 包中使用的自定义选项页面的 WPF 控件成功对其进行了测试。

# iphone - 如何在 Cocoa 中进行全文搜索？

> ID：835880
> 
> 赞同：3
> 
> 时间：2009-05-07T17:02:29.013
> 
> 标签：iphone, cocoa, full-text-search, lucene

我需要像 Lucene 这样的东西来在 Cocoa 中进行优化的全文搜索。我正在开发一个 Iphone 应用程序来搜索数据库。

任何人都对其他数据库有任何运气。任何帮助表示赞赏。

到目前为止，我只能找到这个。

[http://github.com/tcurdt/lucenekit/tree/master](http://github.com/tcurdt/lucenekit/tree/master)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-16T17:35:58.360

根据您的评论：“..我不确定我是否正确解释了自己。我正在寻找构建一个可以通过将搜索短语传递到远程服务器来进行搜索的 Iphone 应用程序......”

您可以只使用 Java（或 .NET）版本的 Lucene 服务器端，并将搜索查询从目标 c 中的手机传递到服务器

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T18:02:09.773

如果我没记错的话，官方的 Lucene 是基于 Java 编写的，而且我还没有玩过你提到的 ObjC 端口。这是一个 Mac OS X 项目，快速浏览会显示一些可能难以移植到 iPhone 的依赖项。

根据您搜索需求的复杂性，我为您看到了一些可能的路径：

1.  对于简单的搜索：内置的 SQLite 支持索引。这会很快。
2.  等待 SDK 3.0 和 CoreData。
3.  试试你的运气移植上面的项目。

# nhibernate - NHirate 嵌套事务阻塞

> ID：835885
> 
> 赞同：0
> 
> 时间：2009-05-07T17:04:24.123
> 
> 标签：nhibernate, transactions

我有一个 NHibernate Transaction 做一些工作并调用一个使用 DBTransactions 调用多个存储过程的遗留方法。如果这些遗留方法调用中的任何一个失败，则 NHibernate Transaction 应该回滚。

问题是旧方法正在使用 NHibernate 事务正在创建的数据库中的数据。这会导致旧代码的 SQL 进程在等待 Nhibernate 进程时锁定。Nhibernate 进程正在等待 Legacy SQL 进程完成，从而导致死锁。

我已经尝试对这两个事务使用 ReadUncommitted 但这不起作用。

我尝试按照 NHibernate in Action 中的建议使用 System.EnterpriseServices 设置分布式事务，但这似乎也不起作用。

我真的不知道从这里去哪里。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T18:12:42.917

您可以按优先顺序降序执行几件事之一。

1.  如果您的 NHibernate 工作排在第一位（就执行顺序而言），您需要让您的旧方法使用您的 NHibernate 数据库连接。ISession 公开了一个 Connection 属性，您可以将其传递给您的旧 ADO 代码。

2.  如果这更容易，反之亦然。只要它们共享相同的连接，您就可以在相同的事务上下文中执行两组数据访问。ISessionFactory.OpenSession() 具有采用 IDbConnection 实例的重载。

3.  在启动旧方法或 NHibernate 方法之前启动环境隐式事务。当您完成了 Nhibernate 和遗留代码后，您可以通过完成环境事务同时提交它们。（我只放第 3 个，因为实现它可能需要比第 1 或 2 个更长的时间）请参阅[MSDN](http://msdn.microsoft.com/en-us/library/ms172152.aspx)了解如何执行此操作。

4.  如果你真的被卡住并且正在**使用 SQL Server**，你可以这样做，但这真的很讨厌。您可以将两个单独的连接合并到同一个数据库事务中。我还找不到有关如何执行此操作的链接，因此，如果您绝望地尝试一下，请回帖！

# java - java.util.Date 到 XMLGregorianCalendar

> ID：835889
> 
> 赞同：632
> 
> 时间：2009-05-07T17:05:03.327
> 
> 标签：java, xml, date, xmlgregoriancalendar

难道没有从 java.util.Date 到 XMLGregorianCalendar 的便捷方法吗？

* * *

## 回答 #1

> 赞同：1061
> 
> 时间：2009-05-07T17:22:15.487

```
GregorianCalendar c = new GregorianCalendar();
c.setTime(yourDate);
XMLGregorianCalendar date2 = DatatypeFactory.newInstance().newXMLGregorianCalendar(c); 
```

* * *

## 回答 #2

> 赞同：207
> 
> 时间：2011-01-04T15:03:50.900

对于那些可能最终在这里寻找相反转换（从`XMLGregorianCalendar`到`Date`）的人：

```
XMLGregorianCalendar xcal = <assume this is initialized>;
java.util.Date dt = xcal.toGregorianCalendar().getTime(); 
```

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2019-05-26T11:57:20.027

我想退后一步，以现代的眼光看待这个 10 年前的问题。提到的类`Date`和`XMLGregorianCalendar`，现在已经过时了。我挑战它们的使用并提供替代方案。

*   `Date`设计总是很差，已经有20多年的历史了。这很简单：不要使用它。
*   `XMLGregorianCalendar`也很旧，并且有老式的设计。据我了解，它用于为 XML 文档生成 XML 格式的日期和时间。喜欢`2009-05-07T19:05:45.678+02:00`或`2009-05-07T17:05:45.678Z`。这些格式与 ISO 8601 非常吻合，java.time 类（现代 Java 日期和时间 API）可以生成它们，这是我们更喜欢的。

## 无需转换

对于许多（大多数？）目的，现代替代 a`Date`将是`Instant`. An`Instant`是一个时间点（就像 a 一样`Date`）。

```
 Instant yourInstant = // ...
    System.out.println(yourInstant); 
```

此代码段的示例输出：

> 2009-05-07T17:05:45.678Z

`XMLGregorianCalendar`它与我上面的示例字符串中的后者相同。正如你们大多数人所知，它来自于`Instant.toString`被隐式调用`System.out.println`。使用 java.time，在许多情况下，我们不需要像过去那样在`Date`、`Calendar`和`XMLGregorianCalendar`其他类之间进行转换（但在某些情况下，我们确实需要转换，我将在下一节中向您展示一些） .

## 控制偏移

a`Date`和 in都没`Instant`有时区，也没有 UTC 偏移量。Ben Noland 先前接受且仍获得最高投票的答案使用 JVM 当前的默认时区来选择`XMLGregorianCalendar`. 为了在现代对象中包含偏移量，我们使用`OffsetDateTime`. 例如：

```
 ZoneId zone = ZoneId.of("America/Asuncion");
    OffsetDateTime dateTime = yourInstant.atZone(zone).toOffsetDateTime();
    System.out.println(dateTime); 
```

> 2009-05-07T13:05:45.678-04:00

这再次符合 XML 格式。如果要再次使用当前 JVM 时区设置，请设置`zone`为`ZoneId.systemDefault()`.

## 如果我绝对需要 XMLGregorianCalendar 怎么办？

还有更多方法可以转换`Instant`为`XMLGregorianCalendar`. 我将介绍一对夫妇，每一个都有其优点和缺点。首先，就像 an`XMLGregorianCalendar`产生一个类似的字符串一样`2009-05-07T17:05:45.678Z`，它也可以从这样的字符串构建：

```
 String dateTimeString = yourInstant.toString();
    XMLGregorianCalendar date2
            = DatatypeFactory.newInstance().newXMLGregorianCalendar(dateTimeString);
    System.out.println(date2); 
```

> 2009-05-07T17:05:45.678Z

Pro：它很短，我认为它不会给人任何惊喜。缺点：对我来说，将瞬间格式化为字符串并将其解析回来是一种浪费。

```
 ZonedDateTime dateTime = yourInstant.atZone(zone);
    GregorianCalendar c = GregorianCalendar.from(dateTime);
    XMLGregorianCalendar date2 = DatatypeFactory.newInstance().newXMLGregorianCalendar(c);
    System.out.println(date2); 
```

> 2009-05-07T13:05:45.678-04:00

Pro：这是官方的转换。控制偏移量自然而然。缺点：它经过更多步骤，因此更长。

## 如果我们有约会怎么办？

`Date`如果您从遗留 API 中获得了一个现在无法更改的老式对象，请将其转换为`Instant`：

```
 Instant i = yourDate.toInstant();
    System.out.println(i); 
```

输出和之前一样：

> 2009-05-07T17:05:45.678Z

如果您想控制偏移量，请以`OffsetDateTime`与上述相同的方式进一步转换为an。

如果你有一个老式的`Date`并且绝对需要一个老式的`XMLGregorianCalendar`，只需使用 Ben Noland 的答案。

## 链接

*   [Oracle 教程：日期时间](https://docs.oracle.com/javase/tutorial/datetime/)解释如何使用 java.time。
*   [W3Schools 上的XSD 日期和时间数据类型](https://www.w3schools.com/xml/schema_dtypes_date.asp)。
*   [维基百科文章：ISO 8601](https://en.wikipedia.org/wiki/ISO_8601)

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2009-05-07T17:26:07.707

这是从 GregorianCalendar 转换为 XMLGregorianCalendar 的方法；我将把从 java.util.Date 转换为 GregorianCalendar 的部分作为练习留给你：

```
import java.util.GregorianCalendar;

import javax.xml.datatype.DatatypeFactory;
import javax.xml.datatype.XMLGregorianCalendar;

public class DateTest {

   public static void main(final String[] args) throws Exception {
      GregorianCalendar gcal = new GregorianCalendar();
      XMLGregorianCalendar xgcal = DatatypeFactory.newInstance()
            .newXMLGregorianCalendar(gcal);
      System.out.println(xgcal);
   }

} 
```

编辑：慢 :-)

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2014-02-03T14:35:11.290

[使用Joda-Time](http://www.joda.org/joda-time/)库的单行示例：

```
XMLGregorianCalendar xgc = DatatypeFactory.newInstance().newXMLGregorianCalendar(new DateTime().toGregorianCalendar()); 
```

[归功于 Nicolas Mommaerts](https://stackoverflow.com/users/326206/nicolas-mommaerts)在[接受的答案](https://stackoverflow.com/a/835963/642706)中的评论。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2011-03-16T13:02:32.803

只是想我会在下面添加我的解决方案，因为上面的答案不符合我的确切需求。我的 Xml 架构需要单独的日期和时间元素，而不是单个日期时间字段。上面使用的标准 XMLGregorianCalendar 构造函数将生成一个 DateTime 字段

请注意有几个哥特卡，例如必须在月份中添加一个（因为 java 从 0 开始计算月份）。

```
GregorianCalendar cal = new GregorianCalendar();
cal.setTime(yourDate);
XMLGregorianCalendar xmlDate = DatatypeFactory.newInstance().newXMLGregorianCalendarDate(cal.get(Calendar.YEAR), cal.get(Calendar.MONTH)+1, cal.get(Calendar.DAY_OF_MONTH), 0);
XMLGregorianCalendar xmlTime = DatatypeFactory.newInstance().newXMLGregorianCalendarTime(cal.get(Calendar.HOUR_OF_DAY), cal.get(Calendar.MINUTE), cal.get(Calendar.SECOND), 0); 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2010-09-21T05:49:04.700

我希望我在这里的编码是正确的；D 为了让它更快，只需使用 GregorianCalendar 的丑陋 getInstance() 调用而不是构造函数调用：

```
import java.util.GregorianCalendar;
import javax.xml.datatype.DatatypeFactory;
import javax.xml.datatype.XMLGregorianCalendar;

public class DateTest {

   public static void main(final String[] args) throws Exception {
      // do not forget the type cast :/
      GregorianCalendar gcal = (GregorianCalendar) GregorianCalendar.getInstance();
      XMLGregorianCalendar xgcal = DatatypeFactory.newInstance()
            .newXMLGregorianCalendar(gcal);
      System.out.println(xgcal);
   }

} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-04-22T10:00:35.723

假设您正在解码或编码 xml 并使用`JAXB`，则可以完全替换 dateTime 绑定并为模式中的每个日期使用“XMLGregorianCalendar”以外的其他内容。

通过这种方式，您可以`JAXB`完成重复性工作，同时您可以花时间编写可提供价值的出色代码。

jodatime 示例`DateTime`：（使用 java.util.Date 执行此操作也可以 - 但有一定的限制。我更喜欢 jodatime，它是从我的代码中复制的，所以我知道它可以工作......）

```
<jxb:globalBindings>
    <jxb:javaType name="org.joda.time.LocalDateTime" xmlType="xs:dateTime"
        parseMethod="test.util.JaxbConverter.parseDateTime"
        printMethod="se.seb.bis.test.util.JaxbConverter.printDateTime" />
    <jxb:javaType name="org.joda.time.LocalDate" xmlType="xs:date"
        parseMethod="test.util.JaxbConverter.parseDate"
        printMethod="test.util.JaxbConverter.printDate" />
    <jxb:javaType name="org.joda.time.LocalTime" xmlType="xs:time"
        parseMethod="test.util.JaxbConverter.parseTime"
        printMethod="test.util.JaxbConverter.printTime" />
    <jxb:serializable uid="2" />
</jxb:globalBindings> 
```

和转换器：

```
public class JaxbConverter {
static final DateTimeFormatter dtf = ISODateTimeFormat.dateTimeNoMillis();
static final DateTimeFormatter df = ISODateTimeFormat.date();
static final DateTimeFormatter tf = ISODateTimeFormat.time();

public static LocalDateTime parseDateTime(String s) {
    try {
        if (StringUtils.trimToEmpty(s).isEmpty())
            return null;
        LocalDateTime r = dtf.parseLocalDateTime(s);
        return r;
    } catch (Exception e) {
        throw new IllegalArgumentException(e);
    }
}

public static String printDateTime(LocalDateTime d) {
    try {
        if (d == null)
            return null;
        return dtf.print(d);
    } catch (Exception e) {
        throw new IllegalArgumentException(e);
    }
}

public static LocalDate parseDate(String s) {
    try {
        if (StringUtils.trimToEmpty(s).isEmpty())
            return null;
        return df.parseLocalDate(s);
    } catch (Exception e) {
        throw new IllegalArgumentException(e);
    }
}

public static String printDate(LocalDate d) {
    try {
        if (d == null)
            return null;
        return df.print(d);
    } catch (Exception e) {
        throw new IllegalArgumentException(e);
    }
}

public static String printTime(LocalTime d) {
    try {
        if (d == null)
            return null;
        return tf.print(d);
    } catch (Exception e) {
        throw new IllegalArgumentException(e);
    }
}

public static LocalTime parseTime(String s) {
    try {
        if (StringUtils.trimToEmpty(s).isEmpty())
            return null;
        return df.parseLocalTime(s);
    } catch (Exception e) {
        throw new IllegalArgumentException(e);
    }
} 
```

见这里： [如何用日期替换 XmlGregorianCalendar？](https://stackoverflow.com/questions/11109608/how-replace-xmlgregoriancalendar-by-date)

如果您很乐意根据时区+时间戳映射到一个瞬间，而原始时区并不真正相关，那么`java.util.Date`可能也可以。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-03-24T10:51:01.527

查看此代码：-

```
/* Create Date Object */
Date date = new Date();
XMLGregorianCalendar xmlDate = null;
GregorianCalendar gc = new GregorianCalendar();

gc.setTime(date);

try{
    xmlDate = DatatypeFactory.newInstance().newXMLGregorianCalendar(gc);
}
catch(Exception e){
    e.printStackTrace();
}

System.out.println("XMLGregorianCalendar :- " + xmlDate); 
```

[你可以在这里](http://codedestine.com/convert-date-to-xmlgregoriancalendar/)看到完整的例子

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2022-02-09T07:24:47.683

我的解决方案

```
public static XMLGregorianCalendar DateToXMLGregorianCalendar(Date date) {

    GregorianCalendar gregoriancalendar = new GregorianCalendar();
    gregoriancalendar.setTime(date);
    XMLGregorianCalendar xmlGregorianCalendar = new XMLGregorianCalendarImpl(gregoriancalendar);
    return xmlGregorianCalendar;
} 
```

# c++ - 递归函数上的 OpenMP 并行化

> ID：835893
> 
> 赞同：6
> 
> 时间：2009-05-07T17:06:02.373
> 
> 标签：c++, drawing, openmp

我正在尝试使用并行化来提高绘制具有分层排序对象的 3D 场景的刷新率。场景绘制算法首先递归遍历对象树，并由此构建绘制场景所需的基本数据的有序数组。然后它多次遍历该数组以绘制对象/叠加层等。由于从我所读到的 OpenGL 不是线程安全的 API，我假设数组遍历/绘图代码必须在主线程上完成，但我我在想我可能能够并行化填充数组的递归函数。关键是数组必须按照对象在场景中出现的顺序填充，因此将给定对象与数组索引相关联的所有功能都必须以正确的顺序完成，但是一旦分配了数组索引，我就可以使用工作线程填充该数组元素的数据（这不一定是微不足道的操作）。所以这是我想要得到的伪代码。我希望您了解 xml-ish 线程语法。

```
recursivepopulatearray(theobject)
{
  <main thread>
  for each child of theobject
  {
     assign array index
     <child thread(s)>
       populate array element for child object
     </child thread(s)>
     recursivepopulatearray(childobject)
  }
  </main thread>
} 
```

那么，是否可以使用 OpenMP 来做到这一点，如果可以，怎么做？是否有其他并行化库可以更好地处理这个问题？

**附录：**应[Davide的要求](https://stackoverflow.com/questions/835893/openmp-parallelization-on-a-recursive-function/835974#835974)，让我再详细解释一下。假设场景是这样排序的：

```
-Bicycle Frame
  - Handle Bars 
  - Front Wheel
  - Back Wheel
-Car Frame
  - Front Left Wheel
  - Front Right Wheel
  - Back Left Wheel
  - Back Right Wheel 
```

现在，这些对象中的每一个都有很多与之相关的数据，即位置、旋转、大小、不同的绘图参数等。此外，我需要在这个场景上进行多次传递才能正确地绘制它。一个过程绘制对象的形状，另一个过程绘制描述对象的文本，另一个过程绘制对象之间的连接/关联（如果有的话）。无论如何，如果我必须多次访问这些不同的对象，从这些不同的对象中获取所有绘图数据非常慢，所以我决定使用一次将所有数据缓存到一维数组中，然后将所有实际的绘图通过只看数组。问题是，因为我需要以正确的顺序执行 OpenGL 推送/弹出，所以数组必须处于代表树层次结构的正确深度优先搜索顺序。在上面的例子中，

```
index 0: Bicycle Frame
index 1: Handle Bars 
index 2: Front Wheel
index 3: Back Wheel
index 4: Car Frame
index 5: Front Left Wheel
index 6: Front Right Wheel
index 7: Back Left Wheel
index 8: Back Right Wheel 
```

因此，数组的顺序必须正确序列化，但是一旦我正确分配了该顺序，我就可以并行化数组的填充。例如，一旦我将 Bicycle Frame 分配给索引 0 并将 Handle Bars 分配给索引 1，一个线程可以填充 Bicycle Frame 的数组元素，而另一个线程填充 Handle Bars 的数组元素。

好的，我想在澄清这一点时，我已经回答了我自己的问题，所以感谢 Davide。所以我发布了我自己的[答案](https://stackoverflow.com/questions/835893/openmp-parallelization-on-a-recursive-function/836657#836657)。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T17:24:16.387

我认为你应该更好地澄清你的问题（例如，究竟必须连续做什么以及为什么）

OpenMP（像许多其他并行化库一样）不**保证**各个并行部分的执行顺序，并且由于它们是真正并行的（在多核机器上），如果不同的部分写入相同的数据，可能会出现竞争条件。如果这对您的问题没问题，那么您当然可以使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T17:30:57.353

正如[gbjbaanb 所提到](https://stackoverflow.com/questions/835893/openmp-parallelization-on-a-recursive-function/835945#835945)的，您可以轻松地做到这一点 - 它只需要一个 pragma 语句来并行化它。

但是，有几点需要注意：

首先，您提到这里的顺序至关重要。如果您需要在扁平化层次结构中保留顺序，则并行化（在此级别）将是有问题的。您可能会完全失去您的订单。

此外，并行化递归函数有很多问题。举一个极端的例子——假设你有一台双核机器，并且你有一棵树，其中每个“父”节点都有 4 个子节点。如果树很深，你很快就会“过度并行化”问题，通常会使事情变得更糟，而不是更好，性能明智。

如果您要这样做，您可能应该放置一个级别参数，并且只并行化前几个级别。以我的 4 child-per-parent 示例为例，如果您并行化前 2 个级别，您已经将其分解为 16 个并行块（从 4 个并行块调用）。

从您提到的内容来看，我将把这部分留作连续的，并专注于您提到的第二部分：

“然后它会多次遍历该数组以绘制对象/叠加层等。”

这听起来像是一个理想的并行化地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T17:17:42.347

要并行化子线程，只需在循环前添加一个编译指示：

```
#pragma omp parallel for
for (i=0; i < elements; i++) 
{
} 
```

任务完成。

现在，你是对的，你不能让任何线程库以完全并行的方式先做一点（显然！），并且 openMP 没有“锁定”或“等待”功能（它确实有一个“ wait for all to finish' 关键字 - Barrier），它不是为模拟线程库而设计的，但它确实允许您将值存储在并行部分“外部”，并将某些部分标记为“仅单线程”（Ordered 关键字）所以这可以帮助您在并行循环中分配索引，而其他线程正在分配元素。

查看[入门指南](http://software.intel.com/en-us/articles/getting-started-with-openmp/)。

如果您使用的是 Visual C++，您还需要在编译器构建设置中设置 /omp 标志。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T19:49:06.380

这是一段修改过的伪代码，应该可以工作。

```
populatearray(thescene)
{
  recursivepopulatearray(thescene)

  #pragma omp parallel for
  for each element in array
    populate array element based on associated object
}

recursivepopulatearray(theobject)
{
  for each childobject in theobject
  {
     assign array index and associate element with childobject
     recursivepopulatearray(childobject)
  }
} 
```

# java - Joda-time：今年 ISO 第 1 周的第一天

> ID：835895
> 
> 赞同：13
> 
> 时间：2009-05-07T17:06:30.063
> 
> 标签：java, jodatime

我想找出今年 ISO 第 1 周的星期一的日期（对于 2009 年，这将是 2008 年 12 月 29 日星期一）。

我确信[joda-time](http://www.joda.org/joda-time/cal_iso.html)可以处理这个问题，但我只是无法弄清楚 API（也许为时已晚）。

任何人都可以帮忙吗？谢谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2014-03-11T19:15:23.953

另一个答案中提到的`DateMidnight`API 现在已弃用，请在下面使用：

```
DateTime date = new DateTime().dayOfYear().withMinimumValue().withTimeAtStartOfDay(); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-07T17:13:02.763

我相信这应该有效：

```
DateMidnight date = new DateMidnight().withWeekOfWeekyear(1).withDayOfWeek(1); 
```

# asp.net - ASP.NET MVC：在 ActionParameters 中设置对象也将它们添加到查询字符串中

> ID：835899
> 
> 赞同：0
> 
> 时间：2009-05-07T17:07:10.810
> 
> 标签：asp.net, asp.net-mvc

我有一个如下所示的控制器方法：

```
[AcceptGet]
public ActionResult Index(SecurityMatrixIndexViewModel model)
{
    if (model == null)  
        model = CreateIndexViewModel();

    return View(model);
} 
```

在另一个控制器方法中，我重定向到这个 Index 操作。我有一个动作过滤器属性，它从 TempData 中取出一个模型对象并将其分配给 filterContext.ActionParameters[“model”]，它将将该对象作为“model”参数传递给 Index()。问题是，当我在 ActionParameters 中添加对象时，它还会将“？model=MyProject.SecurityMatrixIndexViewModel”作为查询字符串放在 URL 上。您知道如何在 ActionParameters 中设置某些内容而不使其成为查询字符串的一部分吗？

乔恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T20:43:18.780

我认为在 GET 期间这是不可能的 - 因为请求数据是通过查询字符串中继的。

# iphone - OpenGL 到 OpenGL-ES - 更改条带中三角形的颜色

> ID：835903
> 
> 赞同：4
> 
> 时间：2009-05-07T17:08:14.567
> 
> 标签：iphone, opengl-es

在 opengl 中使用 glBegin() 和 glEnd() 时，您可以设置和更改每个 glVertex3f() 之间的颜色。使用顶点数组和 glDrawArrays() 时如何重新创建此行为。这是常规的opengl。

```
for(angle = 0.0f; angle < (2.0f*GL_PI); angle += (GL_PI/8.0f))
    {
    // Calculate x and y position of the next vertex
    x = 50.0f*sin(angle);
    y = 50.0f*cos(angle);

    // Alternate color between red and green
    if((iPivot %2) == 0)
        glColor3f(0.0f, 1.0f, 0.0f);
    else
        glColor3f(1.0f, 0.0f, 0.0f);

    // Increment pivot to change color next time
    iPivot++;

    // Specify the next vertex for the triangle fan
    glVertex2f(x, y);
    } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T17:17:42.937

使用 glDrawArrays 你必须启用 glVertexPointer 来设置顶点数据。

以同样的方式，您还可以为颜色设置客户端内存指针。

它归结为这些调用：

```
 glEnableClientState (GL_VERTEX_ARRAY);
  glEnableClientState (GL_COLOR_ARRAY); // enables the color-array.

  glVertexPointer (...  // set your vertex-coordinates here..
  glColorPointer (...   // set your color-coorinates here..

  glDrawArrays (... // draw your triangles 
```

顺便说一句 - 纹理坐标以相同的方式处理。只需为此使用 GL_TEXCOORD_ARRAY 和 glTexCoordPointer 。

# c++ - Qt：将信号/绑定参数适应插槽？

> ID：835914
> 
> 赞同：4
> 
> 时间：2009-05-07T17:11:03.267
> 
> 标签：c++, qt, boost

有没有办法将参数绑定到插槽 ala [boost::bind](http://www.boost.org/doc/libs/1_38_0/libs/bind/bind.html "提升::绑定")？

这是一个例子。我有一个带有树视图的窗口，我想允许用户从上下文菜单中隐藏一列。我最终会做类似的事情：

```
void MyWindow::contextMenuEvent (QContextMenuEvent* event) {
   m_column = view->columnAt (event->x());
   QMenu menu;
   menu.addAction (tr ("Hide Column"), this, SLOT (hideColumn ()));
   // .. run the menu, etc
} 
```

我需要捕获激活上下文菜单的列的索引，并将其存储在我的窗口`hideColumn`插槽使用的成员变量中：

```
void MyWindow::hideColumn () {
    view->setColumnHidden (m_column, true);
} 
```

我真正想要的是能够在创建菜单时将列号绑定到我的插槽，所以我不需要这个成员变量。基本上相当于Qt：

```
menu.addAction (tr ("Hide Column"),
                boost::bind (&MyWindow::hideColumn, this,
                             event->columnAt (event->x())); 
```

或者甚至更好地调整[QAction::triggered](http://doc.trolltech.com/4.3/qaction.html#triggered)信号并将其附加到[QTreeView::hideColumn](http://doc.trolltech.com/4.3/qtreeview.html#hideColumn)插槽，该插槽将列索引作为参数：

```
menu.addAction (tr ("Hide Column"),
                boost::bind (&QTreeView::hideColumn, view,
                             event->columnAt (event->x()))); 
```

这是可行的吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T21:49:12.003

[LibQxt](http://libqxt.org)通过 QxtBoundFunction 和 QxtMetaObject 使这成为可能（前者由于某种原因没有出现在他们的[文档中）。](http://doc.libqxt.org/0.5.0/)这是一个开源项目，因此如果您对实现感兴趣，可以获取源代码。它使用以下语法：

```
connect(
    button,
    SIGNAL(clicked()),
    QxtMetaObject::bind(
        lineEdit,
        SLOT(setText(QString)),
        Q_ARG(QString, "Hello World!)
        )
    ); 
```

[LibQxt](http://libqxt.org)还有一些其他非常有用的功能，例如[通过 QIODevice 发出信号](http://doc.libqxt.org/0.5.0/classQxtRPCService.html)的能力，例如网络连接。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-11-09T11:39:17.340

不能使用的`setData`功能`QAction`吗？

```
void MyWindow::contextMenuEvent (QContextMenuEvent* event)
{
    m_column = view->columnAt (event->x());
    QMenu menu;
    QAction * action = menu.addAction (tr ("Hide Column"), this, SLOT (hideColumn ()));
    action->setData(QVariant(hideColumn));
}

void hideColumn()
{
    const QAction * action = qobject_cast<const QAction *>(this->sender());
    assert(action);

    int hide_column = action->data().value<int>();
    this->view->setColumnHidden (m_column, true);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-07T19:50:25.020

AFAIK 唯一的方法是创建一个 QSignalMapper 对象来执行此操作。这就像一个额外的间接级别，可用于生成提供列索引的新信号。这有点笨拙的 IME，你可能会一直挂着很多 QSignalMapper 对象，但这似乎是目前最好的方式。（理想情况下，IMO，您可以只提供任何值，例如列索引到 connect()，它将作为参数传递给插槽，但您不能。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-01-29T17:37:34.613

正如上面评论中提到的，这在 Qt 5 中要容易得多，因为您可以将信号直接连接到函子，例如 std::tr1::bind() 或 boost::bind() 的结果。对于 Qt 4，有许多适配器库。Kaleb 提到了 LibQxt。我在[https://github.com/robertknight/qt-signal-tools有一个](https://github.com/robertknight/qt-signal-tools)

# c# - 使用 HttpCurrentContext 的单元/集成测试代码

> ID：835916
> 
> 赞同：1
> 
> 时间：2009-05-07T17:11:54.513
> 
> 标签：c#, asp.net, nunit

试图让 Nunit 在 ASP.Net 中工作。

问题是，我正在测试一个自定义控件——它引用了一个全局资源。

当我尝试对其进行单元测试时

```
/// </summary>
        [Test]
        public void TestSetAndGetNumber()
        {
            PhoneNumber phone = new PhoneNumber(PhoneNumber.NumberType.Business, "", true, "");
            string expectedString = "1-800-Goat-Phone";
            string resultString = "1-800-Goat-Phone";
            resultString = phone.Value = resultString;
            Assert.AreEqual(expectedString, resultString, "GetNumberMatch method returned unexpected result.");
            Assert.Fail("Create or modify test(s).");
        } 
```

我会得到“无法加载 App_GlobalResources”。

试图弄清楚我是否应该尝试[使用 You've been Haacked 博客文章](http://haacked.com/archive/2007/06/19/unit-tests-web-code-without-a-web-server-using-httpsimulator.aspx)来模拟 HttpContext但没有人证实这是可行的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T17:18:32.547

这听起来可能很花言巧语，但是您不能重新设计 PhoneNumber 类以使其可测试吗？

如果你想使用单元测试，这似乎是要走的路。如果不能修改 PhoneNumber 类，那么测试它的意义何在？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T17:18:44.043

这是一个典型的场景，你应该以正确的方式设置你的类以进行测试。如果您有外部依赖项（对全局资源的引用），那么您应该将其设为抽象，以便您可以模拟它。

我建议你看看这[本书](http://www.manning.com/osherove/)，它解释了如何设计你的类更易测试。[或者，您可以从moq](http://code.google.com/p/moq/)下载示例。设置单元测试在很大程度上是以更松散耦合的方式设计您的类，因此您可以在不与数据库/文件系统/其他资源交互的情况下有效地测试它。

# html - HTML 和 CSS 编程

> ID：835917
> 
> 赞同：1
> 
> 时间：2009-05-07T17:12:00.317
> 
> 标签：html, css

我正在使用以下代码：

```
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <style type="text/css">
    td.one
    {
      align="center";
      colspan="3";
      bgcolor="lightgrey";
      style="font-size:15px;font-weight:bold;"
    }
  </style>
</head>

<body>
  <table border="1" cellspacing="1" cellpadding="1" width="100%">
   <tr>
     <td>&nbsp;</td>
     <td>&nbsp;</td>
     <td class="one">Session 1</td>
     <td class="one">Session 1</td>
   </tr>
</body> 
```

这个 CSS 对我不起作用。我想制作类，所以不同的`<td>`元素会有不同的外观。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-07T17:17:04.017

您在样式表中使用 HTML 属性名称和语法，而您需要使用 CSS 名称和语法：

```
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <style type="text/css">
            td.one
            {
                text-align: center;
                /* There's no way to do colspan="3" in CSS */
                background-color: lightgrey;
                font-size: 15px;
                font-weight:bold;
            }
        </style>
    </head>

<body>
  <table border="1" cellspacing="1" cellpadding="1" width="100%">
   <tr>
     <td> </td>
     <td> </td>
     <td class="one">Session 1</td>
     <td class="one">Session 1</td>
   </tr>
</body> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T17:16:01.053

您当前的代码有两个问题。首先，您尝试`td`使用 CSS 设置属性，这是不可能的 - 您只能更改样式。您必须设置`align`,`colspan`和`bgcolor`内联属性（尽管其中一些有 CSS 等价物）。

其次，您的 CSS 规则的语法不正确。它应该如下所示：

```
td.one
{
    font-size: 15px;
    font-weight: bold;
} 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-05-07T17:17:27.417

```
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
        td.one
        {
            text-align:"Center";
            background-color:Gray;
            font-size:15px;
            font-weight:bold;
        }
    </style>
</head>

<body>
  <table border="1" cellspacing="1" cellpadding="1" width="100%">
   <tr>
     <td> </td>
     <td> </td>
     <td class="one" colspan="3">Session 1</td>
     <td class="one">Session 1</td>
   </tr>
</body> 
```

# apache-flex - setActualSize() 与 Label 组件混淆

> ID：835921
> 
> 赞同：0
> 
> 时间：2009-05-07T17:12:39.097
> 
> 标签：apache-flex

如果您正在扩展 UIComponent 并将 Label 组件添加到您的自定义组件，您似乎必须使用 setActualSize() 才能显示您的标签。问题是我不知道标签的大小，因为它取决于文本的长度和字体大小。有时这有效：

```
label.setActualSize(label.getExplicitOrMeasuredWidth(),
    label.getExplicitOrMeasuredHeight()) 
```

但不总是。我不确定这是什么原因。

将标签设置为其实际大小的最佳方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T23:45:19.230

确保`setActualSize()`在 UIComponent 的`updateDisplayList()`函数中调用 Label。这就是它应该发生的地方。如果您在验证周期的其他任何地方调用它，子标签可能尚未完成测量。

# c++ - 什么决定了在调用 delete 时写入 C++ 指针的内容？

> ID：835922
> 
> 赞同：8
> 
> 时间：2009-05-07T17:12:57.053
> 
> 标签：c++, windows, pointers, memory-management

我有一个指向给定类的指针。比如说，指针是：

```
0x24083094 
```

该指针指向：

```
0x03ac9184 
```

这是我班的虚函数表。这对我来说很有意义。在 windbg 中，一切看起来都是正确的。

我删除了所说的指针。现在`0x24083094`是：

```
0x604751f8 
```

但这不是一些随机的垃圾，该地址每次都放在那里，它始终如一`0x604751f8`！如此之多，以至于我实际上可以使用该地址来确定在我的应用程序执行之间是否删除了该指针！

但为什么？它如何确定`0x604751f8`应该写在那里？

作为记录，我使用的是 Windows，在 Visual Studio 2003 下构建。

我知道我不能依赖设置的值，即使它看起来确实是一致的，但我可以依赖它不同吗？即，如果指针被删除，`0x03ac9184`就不会在，对吧？`0x24083094`放在那里的是什么？它可以是任何东西，但`0x03ac9184`绝对不会存在（否则我仍然可以调用方法，因为那是虚函数表）。我对吗？

我觉得我有答案了。删除后不能依赖任何东西。也许一些背景会帮助人们了解我来自哪里。本质上，我正在尝试修复一个错误，该错误会从我下方删除一个指针。这是一个很长的故事，我不会详细说明。

基本上，我试图检测我是否处于这种情况，所以我可以优雅地退出我的函数。我想最简单和最好的方法就是找出谁真正拥有这个指针，然后问他是否有任何变化。所以我将实施这样的修复。它避免了我正在讨论的任何 C++ 删除黑客。

**然而**，有趣的是，在我们的代码中，我们有一个名为“BogusObject”的类，它本质上充当了一个托盘，用于捕获意外取消引用释放对象的人。基本上，我们挂钩我们自己的删除函数并将 BogusObject 类 bash 到任何已释放类的 vtable 中。

然后，如果有人打电话给他们，他们会收到一条很好的消息，说的是“嘿，伙计，出了点问题。”。这发生在我的案例中。即，`0x604751f8+(someoffset)`在 BogusObject 类中。 **但是我们不再使用 BogusObject！** 它实际上并没有在任何地方设置（如果我完全删除 BogusObject 类，即使链接正确），但我仍然最终得到一个很好的消息，说有问题！但我现在认为这是巧合。

出于某种原因，运行时`0x604751f8`在删除该指针时将该值放入该指针中，而这恰好与一个旨在捕获此类情况的类相对应！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-07T17:14:56.750

标准中的任何内容都无法确定在那里写入的内容。Visual Studio（至少在调试模式下）通常会在各处写入标记值，以帮助及早发现错误。

这个值不是你可以依赖的，但是如果你发现这个值神秘地出现在你的程序中，你可以假设你在某个地方引用了已删除的内存。有关一个编译器下的值列表，请参阅[此答案。](https://stackoverflow.com/questions/370195/when-and-why-will-an-os-initialise-memory-to-0xcd-0xdd-etc-on-malloc-free-new/370362#370362)

它也完全有可能是一个空闲列表指针，指向下一块空闲内存。大多数内存分配器将它们的空闲内存保存在一个链接列表中，使用它们正在跟踪的空闲内存来存储跟踪数据。

在任何情况下，您都不得将该指针值用于您想要继续工作的任何内容，除非您致电 microsoft 并获得一些文档说明为什么该值是它的值，并让他们保证它不会改变。即使这样，也要知道您的代码现在与一个编译器的行为相关联。在 C++ 中，访问未分配的内存是未定义且邪恶的。

编辑：您甚至不能依赖删除后更改的值。没有什么说编译器需要在删除时修改数据。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T17:23:09.947

一个你删除一个对象，它正在使用的内存被放回空闲存储（堆）。当然，免费存储将有自己的数据结构（可能还有调试数据），它将应用于该内存。

您正在查看的特定值是什么意思？几乎可以是任何东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T17:46:39.593

几乎可以肯定，每次删除对象时出现的值都有特定的内部含义。

但是，它可能会随着 Visual C++ 的下一版本而改变，并且在其他供应商的编译器上肯定会有所不同。

每次你删除一个对象时它看起来都是一样的这一事实*并不意味着任何有用*的东西。它甚至不可能有潜在的用处。假设你找到了某种方法来利用它，那么这样做将是一个骇人听闻的黑客行为，你最终会后悔的。

试着把它从你的脑海中抹去！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T17:47:21.040

正如 Michael Burr 之前所说，记忆可以追溯到免费商店。一些空闲存储被实现为链表，->next 指针放置在空闲缓冲区的开头。您看到的幻数 (0x604751f8) 可能是“列表结尾”保护。您可以通过执行以下实验来检查：

```
Foo* f = new Foo();
Bar* b = new Bar();

// make a note of the values of f and b _pointers_

delete b;  // check that b points now to 0x604751f8
delete f;  // check that f points now to 0x604751f8

// now check that does b point to;  it might point to f! 
```

让我们知道你发现了什么！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-07T17:24:13.500

正如 Josh 所说，可以插入许多值，以使调试器的调试工作更轻松。这些是特定于编译器的，绝对不能依赖。在发布版本中，我相信大多数 C++ 编译器的默认行为是对释放的内存不做任何事情，因此，在再次分配该地址空间之前，内容基本上将是以前的内容，当然，你永远不要依赖这个。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-07T17:16:55.263

仅仅为指针调用删除操作符并不意味着“已删除”的内存将被清除。它只会调用已删除对象的析构函数并将分配的堆内存标记为已释放。（这是删除操作符的默认行为）。

如果删除时需要清除内存内容，则需要覆盖删除操作符。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-07T18:05:57.720

这个指针值很可能是基类的 vtable。当派生类的析构函数运行时，在完成其正常主体后，它将内存“重铸”为基类型（基本上，将基类 vtable 指针写入对象），然后调用基类析构函数。

请注意，此行为是编译器运行时 C++ 支持的内部实现细节，因此其他编译器（或同一编译器的未来版本）可能会做一些完全不同的事情。但是这种“将 vtable 转换为基类并调用基类析构函数”相当普遍，并且可以追溯到 C++ 的原始 cfront 实现

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-07T18:11:22.340

该程序试图告诉你一些事情。一个日期，一个电话号码，谁知道呢？

现在说真的，这**没有指定**，完全**依赖于实现**，当然尝试取消引用该指针`delete`会导致未定义的行为。所以，简而言之，**谁在乎呢？**

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-07T18:13:16.767

不，你不能依赖它被设置。你甚至不能指望它与众不同。

MS-DOS 堆管理器通常允许在下一次调用 malloc 之前使用已释放的内存。那个时代的new和delete叫做malloc和free。

如今，大多数堆管理器都合理地将内存返回给操作系统，这意味着您甚至不能依赖它的可读性！即使仍然允许它（glibc 具有允许它的 bwd-compat 模式），您也会受到线程竞争条件的影响。

此外，如果指针是左值，则允许 delete 将指针更改为 NULL。

一旦你调用 delete，就不要考虑取消引用指针。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-13T21:55:08.453

You have access to the CRT source code in Visual Studio. You could take a look. I did once to better understand a bug I had.

# php - 如何从 PHP 运行 .bat 文件？

> ID：835941
> 
> 赞同：46
> 
> 时间：2009-05-07T17:17:00.617
> 
> 标签：php, system, exec, batch-file

谁能告诉我如何从 PHP 脚本执行 .bat 文件？

我试过了：

```
exec("C:\[path to file]");
system("C:\[path to file]"); 
```

没有任何工作。我检查了 PHP 手册并用谷歌搜索，但找不到一个好的答案。有人知道我要去哪里错了吗？

我正在运行 Windows 2003 Server 并已成功手动运行 .bat 文件，它可以满足我的需要；我只需要能够以编程方式启动它。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-05-07T17:20:09.500

您可能需要通过 运行它`cmd`，例如：

```
system("cmd /c C:[path to file]"); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-10-27T20:29:56.420

```
<?php
exec('c:\WINDOWS\system32\cmd.exe /c START C:\Program Files\VideoLAN\VLC\vlc.bat');
?> 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-06-01T07:54:23.593

当您使用该`exec()`功能时，就好像您`cmd`打开了一个终端并直接向它输入命令。

像这样使用单引号这 `$str = exec('start /B Path\to\batch.bat');`
意味着`/B`bat将在后台执行，因此**php**的其余部分将在运行该行后继续，而不是在 `$str = exec('start /B /C command', $result);` 哪里`command`执行然后`result`存储以供以后使用。

**PS：**它适用于 Windows 和 Linux。
更多细节在这里[http://www.php.net/manual/en/function.exec.php](http://www.php.net/manual/en/function.exec.php) :)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-09-07T23:25:46.930

```
<?php
 pclose(popen("start /B test.bat", "r")); die();
?> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-04-27T23:24:57.113

在我的运行 IIS 8 的 Windows 机器 8 机器上，我只需输入 bats 名称并忘记它的路径即可运行批处理文件。或者通过将 bat 放在 c:\windows\system32 中，不要问我它是如何工作的，但它确实可以。哈哈

$test=shell_exec("C:\windows\system32\cmd.exe /c $streamnumX.bat");

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-05-28T21:00:14.727

**此片段来自工作代码。**

您不仅可以从 Windows GUI 或任务计划程序触发 bat 文件，还可以在需要时直接从 PHP 脚本触发。但在大多数情况下，它将执行 30-60 秒。取决于您的 PHP 配置。如果 BAT 文件中的作业很长并且您不想冻结您的 PHP 脚本，则需要将 BAT 作业作为另一个进程使用`php.exe`而不依赖于 Apache。

这在 Windows 中**以后台**模式运行，被视为单独的进程`cmd.exe`，并且`php.exe`从任务管理器中不会停止您的 Apache PHP 脚本。您的脚本生成的消息可以通过日志文件存储和检索。

就我而言，`file_scanner.php`我在循环中对大量文件进行了一些繁重的计算，这些文件可能会持续几个小时，而 php 函数`sleep()`不会使 CPU 过载。

`$r`如果您想知道成功或错误开始，您可以通过 ajax 查询文件中的成功指针结果 。在我的情况下，您可以每隔几秒钟使用 AJAX 将`file_scanner.php`消息写入日志文件 以显示进度。`somefile.jpg - OK`

**PHP**

```
/**
 * Runs bat file in background mode
 *
 */
 function run_scanner() {

    $c='start /b D:\Web\example.com\tasks\file_scanner.bat'; 
    $r=pclose(popen($c, 'r')); 
    return json_encode(array('result'=>$r));

 } 
```

**蝙蝠**

```
@echo Off
D:\PHP\php.exe D:\Web\example.com\tasks\file_scanner.php > D:\Web\example.com\tasks\file_scanner.log
exit 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-10-08T10:00:41.647

对于需要在后台运行程序“无需 PHP 等待它完成”的任何人，请执行以下操作：

```
 pclose(popen("start /B ".$cmd, "r")); 
```

`$cmd`您需要运行的程序的字符串命令在哪里（例如`$cmd`可以等于`notepad.exe`或`node Path\to\server.js`）。

来源：[https](https://www.php.net/manual/en/function.exec.php) ://www.php.net/manual/en/function.exec.php （参见 Arno van den Brink 在标题为“用户贡献的注释”部分的注释）。

# sql-server-2005 - SQL 2005 Reporting Services 如果检查 null

> ID：835954
> 
> 赞同：5
> 
> 时间：2009-05-07T17:20:01.950
> 
> 标签：sql-server-2005, reporting-services, reportingservices-2005

在 SSRS 2005 中，我有一个带有链接到它的数据集的表。我想检查一个字段的值是否为空，如果它不为空，则格式化数据以确保它有一个小数位并添加一个 % 符号等。

这是我在字段/列上的表达：

```
=iif(IsNothing(Fields!COL01.Value), "" ,Format(CDbl(Trim(Replace(Fields!COL01.Value, "%", ""))), "N1") + "%") 
```

虽然当数据为空时它似乎不起作用（如果有数据它工作正常）。报告显示，但该字段显示为 #ERROR。

我认为它会检查这两种情况是否有效，即使它为空。我正在尝试使用 if 语句来避免形成空值。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-07T20:06:42.863

SSRS 表达式使用 Visual Basic 求值，它通常对表达式中的所有操作数进行完整（即不是短路）求值，例如在 IIf(cond, truexp, falsexp) 中，除了 cond，trueexp 和 falsexp 都被求值并且无论 cond 的值如何，都可能抛出。

由于在 VB.NET 2.0 中似乎没有合并函数，您可能希望在报告的代码部分添加一个，例如从 Oracle 返回的 Decimal

```
Function Coalesce(fieldValue As Object, defaultValue As Decimal) As Decimal
  If IsDBNull(fieldValue) OrElse IsNothing(fieldValue) Then
    Coalesce = defaultValue
  Else
    Coalesce = CDec(fieldValue) 
  End If
End Function 
```

也可以定义一个通用函数，例如 Coalesce(Of TResult)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T18:03:49.973

在查询您的数据集时，我会尝试使用 ISNULL(fieldname, 0)。

如果您要连接到没有 ISNULL 运算符的数据源（即 Oracle），请尝试使用 iSeries、oracle 和 sql 都支持的 COALESCE(fieldname, 0)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T17:32:13.747

尝试使用 IsDBNull

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T17:53:34.443

您可以在 SQL 查询中而不是在报告级别检查 null。像 IsNull(fieldname,0) 一样，只需格式化 %。当然，前提是您的数据来自 SQL Server。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-10T08:34:16.877

当我遇到这个问题时，我使用了 switch 语句，它按照编写的顺序评估条件，并且在我看来，它可以绕过同时评估的 iif 语句的两侧。

伊恩

# java - Linux 上的 Java：在绑定的本地地址上监听广播消息

> ID：835960
> 
> 赞同：6
> 
> 时间：2009-05-07T17:21:50.633
> 
> 标签：java, linux, networking, udp, broadcast

我有一个有点奇怪的要求，即能够在 Linux 机器上监听来自 Java 的多个网络接口，并确定其中一个是否接收到某种类型的 UDP 数据包。我需要的输出数据是相关接口的 IP 地址。有没有办法在Java中做到这一点？

监听通配符地址 (new DatagramSocket(port)) 并没有帮助，因为虽然我确实收到了广播数据包，但我无法确定它们通过的接口的本地 IP 地址。在绑定到某个接口（new DatagramSocket(port, address)）时收听广播根本不会收到数据包。这个案例值得一个代码示例来展示我正在尝试做的事情：

```
Enumeration interfaces = NetworkInterface.getNetworkInterfaces();
while (interfaces.hasMoreElements()) {
  NetworkInterface ni = (NetworkInterface) interfaces.nextElement();
  Enumeration addresses = ni.getInetAddresses(); 
  while (addresses.hasMoreElements()) { 
    InetAddress address = (InetAddress)addresses.nextElement();
    if (address.isLoopbackAddress() || address instanceof Inet6Address) 
      continue; //Not interested in loopback or ipv6 this time, thanks
    DatagramSocket socket = new DatagramSocket(PORT, address);
     //Try to read the broadcast messages from socket here
  }
} 
```

我还尝试使用基于接口的真实 IP 开头构造的广播地址初始化套接字，其余的根据正确的网络掩码进行初始化：

```
byte [] mask = { (byte)255, 0, 0, 0 };
byte[] addrBytes = InetAddress.getByName("126.5.6.7").getAddress();
for (int i=0; i < 4; i++) {
  addrBytes[i] |= ((byte)0xFF) ^ mask[i];
}
InetAddress bcastAddr = InetAddress.getByAddress(addrBytes); 
```

这只是在构造 DatagramSocket 时抛出一个 BindException。

**编辑：**使用广播地址（例如 126.255.255.255）调用 DatagramSocket 的构造函数的 BindException（java.net.BindException：无法分配请求的地址）仅随最新的 Ubuntu 9.04 提供（可能不是 Ubuntu，但内核版本特定的问题） . 使用 Ubuntu 8.10，以及我正在处理的 Red Hat 版本（RHEL 4.x）。

显然，在绑定到某个本地 IP 时不接收数据包是[正确的行为](http://www.developerweb.net/forum/showthread.php?t=5722)，尽管在 Windows 中这是有效的。我需要让它在 Linux（RHEL 和 Ubuntu）上运行。对于低级 C 代码，有一种解决方法 setsockopt(SO_BINDTODEVICE)，我在 Java-API 中找不到它。[不过，这](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4212324)并不完全让我充满乐观:-)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T12:53:55.150

这最终是一个 IPV6 Linux 内核问题。通常我禁用了 IPV6，因为它会引起各种头痛。然而，在 Ubuntu 9.04 中，禁用 IPV6 非常困难，以至于我放弃了，这让我很苦恼。

要收听来自某个接口的广播消息，我将首先创建接口 IP 地址的“广播版本”：

```
byte [] mask = { (byte)255, 0, 0, 0 };
byte[] addrBytes = InetAddress.getByName("126.5.6.7").getAddress();
for (int i=0; i < 4; i++) {
  addrBytes[i] |= ((byte)0xFF) ^ mask[i];
}
InetAddress bcastAddr = InetAddress.getByAddress(addrBytes); 
```

当然，如果许多接口的 IP 以相同的网络部分开头，这并不能真正将我绑定到某个接口，但对我来说，这个解决方案就足够了。

然后我用那个地址（和所需的端口）创建数据报套接字，它就可以工作了。但并非没有将以下系统属性传递给 JVM：

```
-Djava.net.preferIPv6Addresses=false -Djava.net.preferIPv4Stack=true 
```

我不知道 IPV6 如何设法中断收听广播，但确实如此，并且上述参数修复了它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-09T16:35:29.810

要重申您的问题，您需要确定在哪个接口上接收到广播 UDP 数据包。

*   如果您绑定到通配符地址，您会收到广播，但无法确定收到数据包的网络地址。
*   如果您绑定到特定接口，您就知道您正在接收哪个接口地址，但不再接收广播（至少在 Linux TCP/IP 堆栈上）。

正如其他人所提到的，有用于 Java 的第三方原始套接字库，例如[RockSaw](http://www.savarese.org/software/rocksaw/index.html)或[Jpcap](http://netresearch.ics.uci.edu/kfujii/jpcap/doc/)，它们可以帮助您确定实际接口的地址。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T17:39:27.113

不确定这是否有帮助，但我知道要获取所有网络接口的列表：

```
Enumeration<NetworkInterface> e = NetworkInterface.getNetworkInterfaces(); 
```

也许你可以独立绑定到每一个？

刚刚找到了一些关于 getNetworkInterfaces() 用法的好例子。

*   [http://www.javadocexamples.com/java/net/NetworkInterface/getNetworkInterfaces().html](http://www.javadocexamples.com/java/net/NetworkInterface/getNetworkInterfaces().html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T18:49:25.480

据我所知，唯一的方法是使用

`IP_RECVDSTADDR`

套接字选项。此选项应该确保在绑定到通配符地址时，数据包进入的接口的 dst 地址可用。所以我认为它也应该适用于广播。

这是我从网上找到的一个 C 示例：

[如何获取传入数据包的 UDP 目标地址](http://groups.google.com/group/comp.os.linux.development.system/msg/e09d9c278c7e6fe1?pli=1)

我会继续阅读[`recvmsg`](http://linux.die.net/man/2/recvmsg)，然后尝试找出这个接口在 Java 中是否可用。

**编辑：**

我刚刚意识到，如果 Java 支持它，您可能还有一个选择。您可能仍然需要`IP_RECVDSTADDR`套接字选项（不确定），但您可以使用原始套接字并从 IP 标头中获取目标地址，而不是使用 recvmsg。

使用时打开您的套接字`SOCK_RAW`，您将在每条消息的开头获得完整的 IP 标头，包括源地址和目标地址。

下面是在 Linux 上使用 C 中的原始套接字使用 UDP 的示例：

[高级 TCP/IP - 原始套接字程序示例](http://www.tenouk.com/Module43a.html)

如果这种方法在 Java 中也不起作用，我会感到惊讶。

**编辑2**

还有一个想法。您是否有不能使用多播的原因或您选择多播广播的特定原因？据我了解，对于多播，您总是知道在哪个接口上接收数据包，因为在加入多播组时您总是绑定到特定的接口（尤其是在 IP4 中，您通过其中一个 IP 地址绑定到接口）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T21:01:24.027

无法发表评论，因此将其添加为答案。

那很有意思。虽然很好奇你为什么这样做

```
byte[] addrBytes = InetAddress.getByName("126.5.6.7").getAddress(); 
```

而不仅仅是

```
byte[] addrBytes = {126, 5, 6, 7); 
```

还是接口地址以 String 形式提供给您？

# java - 如何使用 Hibernate 创建数据库模式

> ID：835961
> 
> 赞同：5
> 
> 时间：2009-05-07T17:21:54.613
> 
> 标签：java, database, hibernate, hbm2ddl

阅读[Hibernate: hbm2ddl.auto=update in production？](https://stackoverflow.com/questions/221379/hibernate-hbm2ddl-autoupdate-in-production)出现了一些问题。首先，我使用 Hibernate 的原因是独立于数据库供应商（无需编写 10 个版本的“相同”sql 查询，例如 tsql 与 sql）。

我的问题出现在创建数据库模式（生产环境）的时候。据我所知，我有两种选择。

1.  hbm2dll = 更新
2.  纯 sql (ddl) 脚本。

第一种选择在上面的线程中被广泛讨论。第二种选择不好，因为这意味着我又回到了我的第一个问题：“不想创建依赖于数据库供应商的 sql 语句”。（如果“所有”（至少 Hibernate 支持的数据库）正在实现[DDL](http://docs.rinet.ru/O8/glossary.htm)（用于定义和检查数据库结构的 SQL 子集。）相等，则此语句可能是错误的）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T17:27:29.060

在开发/暂存模式下进行所有更改，并手动（或自动，但不要让休眠运行它们）在生产环境中传输和执行脚本。这些脚本可能需要一些调整，因为 hbm2ddl 更新并未涵盖所有情况。

事实上，我从来没有让 hibernate 对任何数据库运行 ddl。我使用 hbm2ddl 生成文本：

```
org.hibernate.tool.hbm2ddl.SchemaExport --config=hibernate.cfg.xml --text --format --delimiter=;

org.hibernate.tool.hbm2ddl.SchemaUpdate --config=hibernate.cfg.xml --text --format --delimiter=; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T17:26:35.850

[如何使用 Hibernate 在不丢失数据的情况下更新数据库模式？](https://stackoverflow.com/questions/737989/how-to-update-a-database-schema-without-losing-your-data-with-hibernate)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-10-27T21:56:14.127

通常，转储 JPA 模式的工具基于`SchemaExport`仅读取静态元数据的工具。

有一个 Maven/Gradle 插件[https://github.com/Devskiler/jpa2ddl](https://github.com/Devskiller/jpa2ddl)可以生成 JPA 模式。In 包括所有属性、命名策略、用户类型等。

您还可以使用它为[Flyway](http://flywaydb.org/)生成自动模式迁移。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T17:35:01.960

我喜欢 Hibernate（很多），并且我认为它可以编写一些非常优质的代码，但我不会在生产数据库上将其松散，而是让一只彬彬有礼的灰熊保姆。一切都可以在一段时间内顺利进行，但一旦发生坏事就**真的**很糟糕。

我的建议是在测试环境中，让休眠生成数据库模式。在测试环境中测试那些。然后将这些脚本带到生产环境并运行它们。注意那里的特殊性；即使测试非常成功，我仍然不会让 Hibernate 在生产服务器上疯狂。获取 Hibernate schemagen 的输出，对其进行测试，并在验证后将其部署到生产服务器。

# excel - 在 Excel 中处理任意大的任意数量项目集的方法

> ID：835981
> 
> 赞同：0
> 
> 时间：2009-05-07T17:25:44.743
> 
> 标签：excel, report

我有一个具体的案例，但这个问题也适用于一般情况。当数据量是任意的时，如何处理 Excel 中的数据？

在我的具体情况下，我有一个程序可以生成 1 到 10 组数据，每组由 5 个任意（但相等）长的数组组成（或者你可以认为它是一个有 5 列的表）。我希望能够将这些数据转储到 Excel 中，对其应用命名范围（我已经做了很多），然后在 Excel 中对其进行操作以创建报告。理想情况下，我想用尽可能少的 VBA 来做到这一点（没有一个是最好的）。这个想法是这些报告的最终用户应该能够更改格式（或生成相同数据的全新报告），而无需我更改我的程序。

基本上，报告应该是 1-10 个表格，5 个数组中的每个元素对应一行（每个数组对应一列）。

希望这个例子能清楚地说明我在问什么。除了在 VBA 中编码整个该死的东西之外，Excel 还为您提供了哪些选项来处理如此任意数量的数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T23:22:47.803

您可以将所有数据集中的所有数据放入单个工作表上的一个大范围内。您还可以有一列标识特定行来自哪个数据集

对于报告，如果您需要汇总数据的某些方面，那么数据透视表（在数据菜单上）是合乎逻辑的选择。您可以将数据集列用作数据透视表中的页面字段，以便每个数据集都可以显示在单独的报表中

如果您需要在生成报告之前过滤数据集，您还可以使用高级过滤器（也在“数据”菜单上）将适当的记录过滤到新工作表中。然后，您可以从该新工作表生成数据透视表

有一些风险因素：

*   数据集的大小可能超过工作表上的最大行数（Excel 2007 中为 1,048,576；Excel 2003 中为 65,536）
*   给定字段中不同值的数量可能超过数据透视表中可以汇总的数量（Excel 2007 中为 1,048,576；Excel 2003 中为 32,500）
*   用户可能会发现高级过滤器和/或数据透视表过于难以使用

如果您的数据可能超过任何最大大小，则 Excel 不太可能是用于该数据的合适程序（除非作为某种数据库的前端）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T07:41:23.723

我不确定我是否理解“然后在 Excel 中操作它以创建报告”，因为我可以想象在 Excel 中生成报告的多种不同方式，但我有一个建议可能会为你打上标记（我' d 已经发表了澄清问题的评论，但可惜我的代表仍然太低！）。如果您需要澄清/示例代码，请告诉我，我很乐意提供帮助。

由于您已经命名了范围，因此您可以使用实际指向同一工作簿中的另一个工作表的 queryTable/listObject。这使用 Excel 文件 DSN（通过 ODBC，它应该在所有带有 Excel 的工作站上），我已经多次使用这个技巧来处理我需要报告的可变数据。如何执行此操作取决于您运行的 Excel 版本。我碰巧现在正在运行 2007，所以方向是“数据选项卡/来自其他来源/来自 Microsoft Query”，选择“Excel 文件”，浏览到您的文件（您可能必须先保存，因为这是与您所在的相同）并选择您所追求的命名范围。如果您熟悉 MS Query，那么它应该从那里直截了当。

现在，新 queryTable 的 DSN 将在连接字符串中包含对工作簿的硬编码引用。要更新它，您需要在 workbook_open 事件中添加一点 VBA 代码。它应该看起来像：

```
Sub Workbook_Open()
   Dim MyLocation as String
   MyLocation = ThisWorkbook.Path & "\" ThisWorkbook.Name
   Sheet1.ListObjects(1).queryTable.ConnectionString = _
         "ODBC;DSN=Excel Files;DBQ=" & _
         MyLocation & ";DriverId=1046;MaxBufferSize=2048;PageTimeout=5;"
End Sub 
```

显然，对于多个查询，您需要执行一些 For Eaching，但这就是要点。让我知道这是否是您正在寻找的东西，我可以更深入地解释创建查询的好处、方法、代码示例（而不是通过 MSQuery 手工制作）、其他版本的不同方向， ETC。

注意：这种方法也适用于数据透视表，但我发现它们对于像您描述的数据这样的简单数据集很麻烦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T22:22:01.407

这可能很有用：

[http://www.exceluser.com/solutions/variablelists_xl12.htm](http://www.exceluser.com/solutions/variablelists_xl12.htm)

我最终采用了这种技术。我只是复制了我可能需要的公式，并编写了一个小 VBA 函数来隐藏未使用的行。这不是最优雅的解决方案，但它可以完成工作。

# c# - 抓取窗体、弹出窗口和菜单

> ID：835985
> 
> 赞同：1
> 
> 时间：2009-05-07T17:26:26.053
> 
> 标签：c#, winapi, printing

我正在开发一个屏幕抓取第三方应用程序的应用程序。现在我可以在我打算抓取的第 3 方应用程序中找到所有属于的表单、菜单和弹出窗口，但我不知道如何确定我正在抓取的窗口是弹出窗口还是菜单管他呢。有没有给定窗口句柄的函数告诉我它是什么窗口？

谢谢，何塞

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T17:37:24.670

您可以从 Windows 类中获得大部分信息。

获得窗口句柄 (HWND) 后，您可以使用[GetClassName()](http://msdn.microsoft.com/en-us/library/ms633582(VS.85).aspx)获取窗口类名称，然后使用[GetClassInfo()](http://msdn.microsoft.com/en-us/library/ms633578(VS.85).aspx)获取有关窗口类本身的信息。

窗口类信息具有样式，其中包含有关该类的大部分信息（即：菜单应该是样式#32768）。有关窗口类的详细信息，请参阅[MSDN](http://msdn.microsoft.com/en-us/library/ms633574(VS.85).aspx)。

# iphone - Iphone横向模式在加载新控制器时切换到纵向模式

> ID：835989
> 
> 赞同：4
> 
> 时间：2009-05-07T17:26:55.943
> 
> 标签：iphone, uiviewcontroller, orientation, landscape

我的应用程序以横向模式正确启动并且运行良好：

```
- (BOOL) shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation 
{
    if(interfaceOrientation == UIInterfaceOrientationPortrait)
        return NO;
    if(interfaceOrientation == UIInterfaceOrientationLandscapeRight || interfaceOrientation == UIInterfaceOrientationLandscapeLeft )
        return YES; 
    return (interfaceOrientation == UIInterfaceOrientationPortrait);
} 
```

并更新了 Info.plist

```
UIInterfaceOrientation = UIInterfaceOrientationLandscapeRight 
```

现在在我的主控制器中，我将一个 ViewController 换成另一个

```
characterController = [ [ CharacterController alloc ] init];
myCurrentViewController = characterController;
self.view =  myCurrentViewController.view ; 
```

它加载但方向处于纵向模式。如果我随后旋转 iPhone，它会将其更正为横向模式。在将新的 viewController 加载到我的 mainController 时如何保持横向的任何想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-12T20:44:06.193

对你的方法要非常小心`self.view=otherVC.view`。UIViewController 旨在管理单个视图。它的设计不是为了换掉它的视图（这就是你的方向改变不起作用的原因）。这在`-didReceiveMemoryWarning`您的 ViewController 不在屏幕上的情况下很重要。它会悄悄地转储它的视图，当它回到屏幕上时，从 NIB 重新加载视图（或重新运行`-loadView`）。

您的`presentModalViewController:`方法要好一些，尽管它不是如何构建模态视图来工作的。它至少让每个 ViewController 管理自己的视图。通常你会在这里使用 UITabBarController 或 UINavigationController。我想你有一些理由避免这些。

我推荐的解决方案是将 UIView 添加到您的主视图控制器的视图中（作为 IBOutlet 或在代码中）。您交换*该*视图进出，而不是交换 UIViewController 的视图进出。我可能会继续使用 UIViewController 的子类来处理这个问题，方法是在 UITabBarController 之后建模。

```
@interface RNSwappableViewController : UIViewController
{
    ...
}
@property(nonatomic, assign) id<RNSwappableViewControllerDelegate> delegate;
@property(nonatomic) NSUInteger selectedIndex;
@property(nonatomic, assign) UIViewController *selectedViewController
@property(nonatomic, copy) NSArray *viewControllers;
@end

@protocol RNSwappableViewControllerDelegate : NSObject
- (void)swappableViewController:(RNSwappableViewController *)swappableViewController didSelectViewController:(UIViewController *)viewController
@end 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-01-09T21:48:04.233

我使用了推荐的代码。事实上，桌子确实会旋转。但是，标题栏仍处于正常的纵向方向和位置。如何重新定位标题栏？

//自定义出现旋转tableview

```
- (void)viewDidAppear:(BOOL)animated
{
    self.view.transform = CGAffineTransformMakeRotation(-3.14 * (90) / 180.0);
    self.view.bounds = CGRectMake(0.0f, 0.0f, 480.0f, 320.0f);
    self.view.center = CGPointMake(160.0f, 240.0f);

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T17:48:59.523

我认为你需要实施

```
- (BOOL) shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation 
```

在您的 CharacterController 中也是如此。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T04:04:37.773

找到另一个解决方案：

```
[myCurrentViewController presentModalViewController: newController animated: NO]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-28T19:12:34.947

即使手机是横向的，您是否遇到过使用 UIInterfaceOrientationPortrait 开始调用 shouldAutorotateToInterfaceOrientation 的问题？

我有一个主要是纵向的应用程序，并且使用一个视图控制器，我提出了我确实想自动旋转的 presentModalViewController，我运行良好，但是当我打开它时，它总是以纵向开始。视图控制器似乎更喜欢父视图控制器的方向而不是设备的方向。

在模态视图的视图控制器中，这对我有用：

```
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
UIDeviceOrientation deviceOrientation = [[UIDevice currentDevice] orientation];

// if device orientation is one of these, don't care what our interface orientation is
if (deviceOrientation == UIDeviceOrientationUnknown && deviceOrientation == UIDeviceOrientationFaceUp && deviceOrientation == UIDeviceOrientationFaceDown)
  return YES;

// otherwise only return YES for the ui orientation matching the current device orientation
return (interfaceOrientation == deviceOrientation);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-15T20:22:14.443

我遇到了完全相同的问题，除了我将模态添加到 UITableViewController。我发现只有从 viewDidLoad 调用它才会有问题，因为模式是在视图控制器的委托确认方向之前呈现的。

所以我只是使用了一个带有计时器的 performSelector 调用，从 viewDidLoad 调用。现在它以正确的方向加载。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-05-07T19:38:29.060

Once again I found my own answer. LOL

After loading the new ViewController

```
self.view =  myCurrentViewController.view; 
```

Update controller to orientate the new ViewController to landscape

```
self.view.transform = CGAffineTransformMakeRotation(-3.14 * (90) / 180.0);
self.view.bounds = CGRectMake(0.0f, 0.0f, 480.0f, 320.0f);
self.view.center = CGPointMake(160.0f, 240.0f); 
```

# jquery - JQuery - 将点击事件添加到 LI 或 SPAN 元素？

> ID：835993
> 
> 赞同：8
> 
> 时间：2009-05-07T17:27:31.667
> 
> 标签：jquery, asp.net-mvc, events

我正在尝试向 LI 元素添加点击事件，但它没有在页面中触发。我的页面标记如下所示：

```
<div id="Navigation">
<ul>
    <li class="navPrevNext inactive">|&lt; First Page</li>
    <li class="navPrevNext inactive">&lt; Prev Page</li>
    <li class="navIndex selected" title="0 ">1</li>
    <li class="navIndex notselected" title="1 ">2</li>
    <li class="navIndex notselected" title="2 ">3</li>
    <li class="navPrevNext active" title="1">Next Page &gt;</li>
    <li class="navPrevNext active" title="2">Last Page &gt;|</li>
</ul>
</div> 
```

在我的 JS 代码中，我有：

```
$("#Navigation li").live('click', function(e) { e.preventDefault; this.blur(); return updateNavigation($(this).attr('title')); }); 
```

有什么想法吗？

TIA

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-07T17:37:46.930

您确定您的代码中包含 jquery 1.3 吗？当我单击任何 LI 时，以下内容对我来说很好（直接从您的问题中复制和粘贴）：

```
<html>
<head>
<script type="text/javascript" src="jquery-1.3.2.min.js"></script>
<script type="text/javascript">
function updateNavigation(title) {
    alert(title);
}

$("#Navigation li").live('click', function(e) { 
    e.preventDefault; 
    this.blur(); 
    return updateNavigation($(this).attr('title')); 
});

</script>
</head>
<body>
<div id="Navigation">
<ul>
    <li class="navPrevNext inactive">|&lt; First Page</li>
    <li class="navPrevNext inactive">&lt; Prev Page</li>
    <li class="navIndex selected" title="0 ">1</li>
    <li class="navIndex notselected" title="1 ">2</li>
    <li class="navIndex notselected" title="2 ">3</li>
    <li class="navPrevNext active" title="1">Next Page &gt;</li>
    <li class="navPrevNext active" title="2">Last Page &gt;|</li>
</ul>
</div>
</body>
</html> 
```

您确定您的 updateNavigation 功能正常吗？也许它正在被触发，但其中有问题......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T17:47:41.103

我和@Parrots 做了同样的事情，它对我有用。但是，您可能希望将选择器更改为：

```
$("#Navigation li[title]" ).live('click', function(e) {
     e.preventDefault;
     this.blur();
     return updateNavigation($(this).attr('title'));
}); 
```

这样处理程序仅适用于具有标题属性的元素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-09T23:14:08.340

我在使用用户选择的弹出列表时遇到了类似的问题。基本上，用户单击输入框并显示 ul。

这对 500 毫秒的动画效果很好，但是当切换到 250 毫秒时，向下滚动的动画太快了，显然 click 事件从未在 li 上触发。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-04T07:06:14.927

不要使用跨度它更好的代表

# javascript - 使用 Javascript 根据下拉列表中选择的选项更改 URL

> ID：835998
> 
> 赞同：1
> 
> 时间：2009-05-07T17:29:11.770
> 
> 标签：javascript, forms, dom

我似乎无法让它发挥作用。有什么想法吗？

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Select Video Test</title>
<script type="text/javascript">
    function selectVideo(){
        var urlString = "http://www.mycookingsite.com/";
        var selectedVideo = this.options[this.selectedIndex];
        if (selectedVideo.value != "nothing"){
            window.location = urlString + selectedVideo.value;
        }
    }
</script>
</head>

<body>

<form>
    <select onchange="selectVideo()">
    <option value="nothing">Select video from this list</option>
    <option value="how-to-grill-burgers">How to Grill Burgers</option>
       <option value="how-to-hard-boil-eggs">How to Make Hard-Boiled Eggs</option>
    </select>
</form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T17:35:49.603

我不确定`this`你的代码中的值是什么，但它不是`<select>`元素。这是一些工作代码：

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Select Video Test</title>
<script type="text/javascript">
    function selectVideo(){
        var urlString = "http://www.mycookingsite.com/";
        var videos = document.getElementById('videos');
        var selectedVideo = videos.options[videos.selectedIndex];
        if (selectedVideo.value != "nothing"){
                window.location = urlString + selectedVideo.value;
        }
    }
</script>
</head>

<body>

<form>
    <select id='videos' onchange="selectVideo()">
    <option value="nothing">Select video from this list</option>
    <option value="how-to-grill-burgers">How to Grill Burgers</option>
       <option value="how-to-hard-boil-eggs">How to Make Hard-Boiled Eggs</option>
    </select>
</form>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T17:36:10.210

您的函数不会在“选择”元素的上下文中运行，因为您只是定期调用该函数。为了解决这个问题，要么不显眼地处理事件，要么从你的“onchange”处理程序中传递“this”：

选项1：

```
// first, give 'select' an id
document.getElementById('select-id').onchange = selectVideo; 
```

选项 2：

```
<select onchange="selectVideo.call(this)"> 
```

选项3：（最好的恕我直言）

```
function addEvent(elem, type, fn) {
    var W3C, callback = function(e){ fn.call(elem, e||window.event); };
    ((W3C = elem.addEventListener) || elem.attachEvent)
        ((W3C?'':'on') + type, callback, false);
    return callback;
}

addEvent(document.getElementById('select-id'), 'change', selectVideo); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T17:43:11.910

您只能`this`在事件代码中使用。当您在函数中时，`this`指的是窗口对象。将引用作为参数发送给函数：

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Select Video Test</title>
<script type="text/javascript">
    function selectVideo(obj){
        var urlString = "http://www.mycookingsite.com/";
        var selectedVideo = obj.options[obj.selectedIndex];
        if (selectedVideo.value != "nothing"){
                window.location = urlString + selectedVideo.value;
        }
    }
</script>
</head>

<body>

<form>
    <select onchange="selectVideo(this)">
    <option value="nothing">Select video from this list</option>
    <option value="how-to-grill-burgers">How to Grill Burgers</option>
       <option value="how-to-hard-boil-eggs">How to Make Hard-Boiled Eggs</option>
    </select>
</form>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-07T17:36:38.947

这是作业吗？有多种方法可以纠正它，但一种简单的方法是让 selectVideo 接受一个 obj 参数，然后将其内部的所有引用更改为 obj。然后，在 onchange 中执行 selectVideo(this)。

如果您想真正理解这一点，我强烈推荐[QuirksMode](http://www.quirksmode.org/)，尤其是[this page 。](http://www.quirksmode.org/js/this.html)******************