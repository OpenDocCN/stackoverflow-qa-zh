# StackOverflow 问答 000115000-000115999

# nhibernate - 如何从 NHibernate 映射文件生成“迁移”DDL？

> ID：115001
> 
> 赞同：5
> 
> 时间：2008-09-22T14:00:14.170
> 
> 标签：nhibernate, postgresql, continuous-integration, ddl

我在我的项目中使用 NHibernate 2 和 PostgreSQL。SchemaExport 类在为数据库生成 DDL 方案方面做得很好，但在第一个应用程序之前它就很棒。

有没有办法使用 NHibernate 映射文件生成“迁移”DLL（一批“ALTER TABLE”而不是 DROP/CREATE 对）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-22T14:36:42.427

查看[SchemaUpdate](http://morten.lyhr.dk/2008/03/nhibernates-schemaupdate-feature.html)。与 SchemaExport 非常相似的 API，但它只创建迁移。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T18:25:05.047

虽然 SchemaUpdate 很好地满足了我的需求，但它仍然存在一些问题。例如，它拒绝对现有数据库列施加新的限制，即使它不会与现有数据冲突。

我打算稍微扩展 SchemaUpdate，或者，如果失败，切换到手动驱动的迁移工具之一（例如 Rails 工具）。

# java - 我们如何在java中将行号打印到日志中

> ID：115008
> 
> 赞同：145
> 
> 时间：2008-09-22T14:02:08.050
> 
> 标签：java, logging

如何将行号打印到日志。说在向日志输出一些信息时，我还想打印输出在源代码中的行号。正如我们在堆栈跟踪中看到的，它显示了发生异常的行号。堆栈跟踪可用于异常对象。

其他替代方法可能是在打印到日志时手动包含行号。还有其他方法吗？

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2008-09-22T14:05:17.510

来自[Angsuman Chakraborty](https://web.archive.org/web/20100818065334/http://blog.taragana.com:80/index.php/archive/core-java-how-to-get-java-source-code-line-number-file-name-in-code/)（存档）：

```
/** Get the current line number.
 * @return int - Current line number.
 */
public static int getLineNumber() {
    return Thread.currentThread().getStackTrace()[2].getLineNumber();
} 
```

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2010-12-02T06:03:39.783

我们最终为我们的 Android 工作使用了这样的自定义类：

```
import android.util.Log;    
public class DebugLog {
 public final static boolean DEBUG = true;    
 public static void log(String message) {
  if (DEBUG) {
    String fullClassName = Thread.currentThread().getStackTrace()[2].getClassName();
    String className = fullClassName.substring(fullClassName.lastIndexOf(".") + 1);
    String methodName = Thread.currentThread().getStackTrace()[2].getMethodName();
    int lineNumber = Thread.currentThread().getStackTrace()[2].getLineNumber();

    Log.d(className + "." + methodName + "():" + lineNumber, message);
  }
 }
} 
```

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2011-05-06T19:54:15.917

快速而肮脏的方式：

```
System.out.println("I'm in line #" + 
    new Exception().getStackTrace()[0].getLineNumber()); 
```

更多细节：

```
StackTraceElement l = new Exception().getStackTrace()[0];
System.out.println(
    l.getClassName()+"/"+l.getMethodName()+":"+l.getLineNumber()); 
```

这将输出如下内容：

```
com.example.mytest.MyClass/myMethod:103 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-22T14:12:34.467

我不得不通过不回答你的问题来回答。我假设您正在寻找仅支持调试的行号。有更好的方法。有一些骇人听闻的方法可以获取当前行。我所看到的都是缓慢的。您最好使用 java.util.logging 包或[log4j](http://logging.apache.org/log4j/1.2/index.html)中的日志框架。使用这些包，您可以配置日志记录信息以将上下文包括到类名。然后每条日志消息将是独一无二的，足以知道它来自哪里。因此，您的代码将有一个您通过调用的“记录器”变量

> `logger.debug("a really descriptive message")`

代替

> `System.out.println("a really descriptive message")`

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-09-22T14:17:09.183

Log4J 允许您将行号作为其输出模式的一部分。有关如何执行此操作的详细信息，请参阅[http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html （转换模式中的关键元素是“L”）。](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html)但是，Javadoc 确实包括以下内容：

> 警告生成呼叫者位置信息非常慢。除非执行速度不是问题，否则应避免使用它。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-22T14:11:37.857

@simon.buchan 发布的代码将起作用...

```
Thread.currentThread().getStackTrace()[2].getLineNumber() 
```

但是，如果您在方法中调用它，它将始终返回方法中行的行号，因此请使用内联代码片段。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-22T14:13:29.707

我建议使用[log4j](http://logging.apache.org/log4j/)之类的日志记录工具包。日志记录可在运行时通过属性文件进行配置，您可以打开/关闭行号/文件名日志记录等功能。

查看[PatternLayout](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html)的 javadoc 可以为您提供完整的选项列表 - 您所追求的是 %L。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2014-04-12T19:56:38.947

我使用这个小方法输出调用它的方法的跟踪和行号。

```
 Log.d(TAG, "Where did i put this debug code again?   " + Utils.lineOut()); 
```

双击输出转到该源代码行！

您可能需要根据放置代码的位置调整级别值。

```
public static String lineOut() {
    int level = 3;
    StackTraceElement[] traces;
    traces = Thread.currentThread().getStackTrace();
    return (" at "  + traces[level] + " " );
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-22T14:07:30.907

您无法保证行号与代码的一致性，尤其是在为发布而编译的情况下。无论如何，我不建议为此目的使用行号，最好提供引发异常的位置的有效负载（简单的方法是将消息设置为包含方法调用的详细信息）。

您可能希望将异常丰富视为一种改进异常处理的技术 [http://tutorials.jenkov.com/java-exception-handling/exception-enrichment.html](http://tutorials.jenkov.com/java-exception-handling/exception-enrichment.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-05-30T15:03:50.963

这些都可以为您提供当前线程和方法的行号，如果您在预期异常的地方使用 try catch，它们将非常有用。但是，如果您想捕获任何未处理的异常，那么您将使用默认的未捕获异常处理程序，并且当前线程将返回处理程序函数的行号，而不是引发异常的类方法。而不是使用 Thread.currentThread() 只需使用异常处理程序传入的 Throwable ：

```
Thread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {
            public void uncaughtException(Thread t, Throwable e) {              
                if(fShowUncaughtMessage(e,t))               
                    System.exit(1);
            }
        }); 
```

在上面的处理函数 (fShowUncaughtMessage) 中使用 e.getStackTrace()[0] 来获取违规者。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T14:12:24.717

如果它是为发布而编译的，这是不可能的。您可能想研究类似 Log4J 的东西，它会自动为您提供足够的信息来非常接近地确定记录的代码发生的位置。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T14:28:26.677

首先是通用方法（在实用程序类中，虽然在普通的旧 java1.4 代码中，您可能必须为 java1.5 和更高版本重写它）

```
/**
 * Returns the first "[class#method(line)]: " of the first class not equal to "StackTraceUtils" and aclass. <br />
 * Allows to get past a certain class.
 * @param aclass class to get pass in the stack trace. If null, only try to get past StackTraceUtils. 
 * @return "[class#method(line)]: " (never empty, because if aclass is not found, returns first class past StackTraceUtils)
 */
public static String getClassMethodLine(final Class aclass)  {
    final StackTraceElement st = getCallingStackTraceElement(aclass);
    final String amsg = "[" + st.getClassName() + "#" + st.getMethodName() + "(" + st.getLineNumber()
    +")] <" + Thread.currentThread().getName() + ">: ";
    return amsg;
} 
```

然后是获取正确stackElement的具体实用方法：

```
/**
   * Returns the first stack trace element of the first class not equal to "StackTraceUtils" or "LogUtils" and aClass. <br />
   * Stored in array of the callstack. <br />
   * Allows to get past a certain class.
   * @param aclass class to get pass in the stack trace. If null, only try to get past StackTraceUtils. 
   * @return stackTraceElement (never null, because if aClass is not found, returns first class past StackTraceUtils)
   * @throws AssertionFailedException if resulting statckTrace is null (RuntimeException)
   */
  public static StackTraceElement getCallingStackTraceElement(final Class aclass) {
    final Throwable           t         = new Throwable();
    final StackTraceElement[] ste       = t.getStackTrace();
    int index = 1;
    final int limit = ste.length;
    StackTraceElement   st        = ste[index];
    String              className = st.getClassName();
    boolean aclassfound = false;
    if(aclass == null) {
        aclassfound = true;
    }
    StackTraceElement   resst = null;
    while(index < limit) {
        if(shouldExamine(className, aclass) == true) {
            if(resst == null) {
                resst = st;
            }
            if(aclassfound == true) {
                final StackTraceElement ast = onClassfound(aclass, className, st);
                if(ast != null) {
                    resst = ast;
                    break;
                }
            }
            else
            {
                if(aclass != null && aclass.getName().equals(className) == true) {
                    aclassfound = true;
                }
            }
        }
        index = index + 1;
        st        = ste[index];
        className = st.getClassName();
    }
    if(isNull(resst))  {
        throw new AssertionFailedException(StackTraceUtils.getClassMethodLine() + " null argument:" + "stack trace should null"); //$NON-NLS-1$
    }
    return resst;
  }

  static private boolean shouldExamine(String className, Class aclass) {
      final boolean res = StackTraceUtils.class.getName().equals(className) == false && (className.endsWith(LOG_UTILS
        ) == false || (aclass !=null && aclass.getName().endsWith(LOG_UTILS)));
      return res;
  }

  static private StackTraceElement onClassfound(Class aclass, String className, StackTraceElement st) {
      StackTraceElement   resst = null;
      if(aclass != null && aclass.getName().equals(className) == false)
      {
          resst = st;
      }
      if(aclass == null)
      {
          resst = st;
      }
      return resst;
  } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-12T07:43:11.237

看看[这个链接](https://stackoverflow.com/a/10599298/779408)。在该方法中，当您双击 LogCat 的行时，您可以跳转到您的行代码。

您也可以使用此代码获取行号：

```
public static int getLineNumber()
{
    int lineNumber = 0;
    StackTraceElement[] stackTraceElement = Thread.currentThread()
            .getStackTrace();
    int currentIndex = -1;
    for (int i = 0; i < stackTraceElement.length; i++) {
        if (stackTraceElement[i].getMethodName().compareTo("getLineNumber") == 0)
        {
            currentIndex = i + 1;
            break;
        }
    }

    lineNumber = stackTraceElement[currentIndex].getLineNumber();

    return lineNumber;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-08-17T22:17:19.390

这是我们使用的记录器。

它包裹着 Android Logger 并显示类名、方法名和行号。

[http://www.hautelooktech.com/2011/08/15/android-logging/](http://www.hautelooktech.com/2011/08/15/android-logging/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-01-14T10:55:17.093

```
private static final int CLIENT_CODE_STACK_INDEX;

static {
    // Finds out the index of "this code" in the returned stack Trace - funny but it differs in JDK 1.5 and 1.6
    int i = 0;
    for (StackTraceElement ste : Thread.currentThread().getStackTrace()) {
        i++;
        if (ste.getClassName().equals(Trace.class.getName())) {
            break;
        }
    }
    CLIENT_CODE_STACK_INDEX = i;
}

private String methodName() {
    StackTraceElement ste=Thread.currentThread().getStackTrace()[CLIENT_CODE_STACK_INDEX+1];
    return ste.getMethodName()+":"+ste.getLineNumber();
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-10-17T18:54:13.570

对于任何想知道的人，`getStackTrace()[3]`方法中的索引表示触发行在实际 .getStackTrace() 方法（不包括执行行）之前经过的线程数量。

这意味着如果从*上面*`Thread.currentThread().getStackTrace()[X].getLineNumber();`的3 个嵌套方法执行该行，则索引号必须为**3**。

 ***例子：

第一层

```
private static String message(String TAG, String msg) {

    int lineNumber = Thread.currentThread().getStackTrace()[3].getLineNumber();

    return ".(" + TAG + ".java:"+ lineNumber +")" + " " + msg;
} 
```

第二层

```
private static void print(String s) {
        System.out.println(s);
} 
```

第三层

```
public static void normal(
        String TAG,
        String message
) {
    print(
            message(
                    TAG,
                    message
            )
    );
} 
```

执行线：

```
 Print.normal(TAG, "StatelessDispatcher"); 
```

作为一个没有接受过任何正式 IT 教育的人，这一直是关于编译器如何工作的想法。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-08-09T06:41:51.323

**下面的代码是记录行的测试代码，没有类名和调用记录方法的方法名**

```
public class Utils {
/*
 * debug variable enables/disables all log messages to logcat
 * Useful to disable prior to app store submission
 */
public static final boolean debug = true;

/*
 * l method used to log passed string and returns the
 * calling file as the tag, method and line number prior
 * to the string's message
 */
public static void l(String s) {
    if (debug) {
        String[] msg = trace(Thread.currentThread().getStackTrace(), 3);
        Log.i(msg[0], msg[1] + s);
    } else {
        return;
    }
}

/*
 * l (tag, string)
 * used to pass logging messages as normal but can be disabled
 * when debug == false
 */
public static void l(String t, String s) {
    if (debug) {
        Log.i(t, s);
    } else {
        return;
    }
}

/*
 * trace
 * Gathers the calling file, method, and line from the stack
 * returns a string array with element 0 as file name and 
 * element 1 as method[line]
 */
public static String[] trace(final StackTraceElement e[], final int level) {
    if (e != null && e.length >= level) {
        final StackTraceElement s = e[level];
        if (s != null) { return new String[] {
                e[level].getFileName(), e[level].getMethodName() + "[" + e[level].getLineNumber() + "]"
        };}
    }
    return null;
}
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-07-02T16:39:56.147

这正是我在这个 lib [XDDLib](https://github.com/adherencegoo/XDDLib)中实现的功能。（但是，它适用于安卓）

```
Lg.d("int array:", intArrayOf(1, 2, 3), "int list:", listOf(4, 5, 6)) 
```

![在此处输入图像描述](https://i.stack.imgur.com/5iQFF.png)

单击**带下划线的文本**以导航到日志命令所在的位置

这`StackTraceElement`是由这个库之外的第一个元素决定的。因此，此库之外的任何地方都是合法的，包括`lambda expression`,`static initialization block`等。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-03-29T18:42:08.410

`stackLevel`取决于您调用此方法的深度。你可以尝试从0到一个大数，看看有什么区别。

如果`stackLevel`是合法的，你会得到类似的字符串`java.lang.Thread.getStackTrace(Thread.java:1536)`

```
public static String getCodeLocationInfo(int stackLevel) {
        StackTraceElement[] stackTraceElements = Thread.currentThread().getStackTrace();
        if (stackLevel < 0 || stackLevel >= stackTraceElements.length) {
            return "Stack Level Out Of StackTrace Bounds";
        }
        StackTraceElement stackTraceElement = stackTraceElements[stackLevel];
        String fullClassName = stackTraceElement.getClassName();
        String methodName = stackTraceElement.getMethodName();
        String fileName = stackTraceElement.getFileName();
        int lineNumber = stackTraceElement.getLineNumber();

        return String.format("%s.%s(%s:%s)", fullClassName, methodName, fileName, lineNumber);
} 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2013-04-23T07:32:18.597

我的方式对我有用

```
String str = "select os.name from os where os.idos="+nameid;  try {
        PreparedStatement stmt = conn.prepareStatement(str);
        ResultSet rs = stmt.executeQuery();
        if (rs.next()) {
            a = rs.getString("os.n1ame");//<<<----Here is the ERROR          
        }
        stmt.close();
  } catch (SQLException e) {
        System.out.println("error line : " + e.getStackTrace()[2].getLineNumber());            
        return a;
  } 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2015-07-14T06:30:48.133

你可以使用 -> Reporter.log("");

# version-control - 保持来自外部存储库的源是最新的

> ID：115021
> 
> 赞同：0
> 
> 时间：2008-09-22T14:04:17.263
> 
> 标签：version-control

在你开始追踪一堆开源软件的源头之后，你如何让你的代码保持同步呢？`svn update`每次要查看或玩代码时都运行？

`cron`让我印象深刻的是，基本上每天晚上开始用（比如说）一份工作来镜像代码会更好。人们是否设置了工作流程来做这种事情？（当/如果您对代码所做的任何更改最终与最新更新冲突时发出警报？）

还是我一个人？（我正在运行 Mac OS X，但对一般解决方案和特定解决方案感兴趣。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T14:13:39.863

[Subversion 书](http://svnbook.red-bean.com/en/1.5/svn.tour.cycle.html#svn.tour.cycle.update)推荐的一般工作流程是经常更新你的工作副本；在每个工作日开始时都是一个好时机。但你不必这样做。只要您想看到最新的更改，只需更新即可。

我在 src/ 目录下签出了许多开源存储库。每隔几天，我记得从那个目录运行'svn up *'，它会更新那里包含的所有工作副本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T14:12:49.647

如果您的存储库在每次有人签入时都会向您发送一封电子邮件，为什么不使用一个程序来检查这些电子邮件，然后在那时更新工作副本？这样您就可以始终保持最新状态。警告包括不必要地消耗带宽以及在您正在处理的文件更新时出现奇怪冲突的可能性。

每天更新一次，或者每隔几天更新一次，只有在项目的不同领域工作的人数有限时才有用。当你有超过五个人，并且他们可能在代码的相似部分工作时，每小时更新一次或更频繁，会好得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T14:35:20.577

只有当我在自己的应用程序中使用开源库时，我才会经常更新，外部存储库实际上是我项目树的一部分，当我更新我的项目时，它也会更新外部存储库。我认为，当您只查看代码进行研究时，只有当您想查看他们发布的新功能然后进行更新时才有意义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T23:03:29.183

您可能想研究使用 svn:externals：[http ://svnbook.red-bean.com/en/1.0/ch07s03.html](http://svnbook.red-bean.com/en/1.0/ch07s03.html)

# c# - 在 C++\CLI 中转换枚举的问题

> ID：115031
> 
> 赞同：5
> 
> 时间：2008-09-22T14:05:52.987
> 
> 标签：c#, enums, c++-cli, enumeration

我有一个用 C++\CLI 编写的程序集，它使用 .Net 提供的一些枚举。它有这样的性质：

```
property System::ServiceProcess::ServiceControllerStatus ^ Status  
{  
    ServiceControllerStatus ^ get()  
    {  
        return (ServiceControllerStatus)_status->dwCurrentState;   
    }  
} 
```

它工作正常，但是当我从我的 C# 代码中使用这个程序集时，这个属性的类型是

```
System.Enum 
```

我必须进行类型转换

```
 if ((ServiceControllerStatus)currentService.Status == ServiceControllerStatus.Running)
     //do smth 
```

问题很简单：为什么会这样，以及如何解决？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T14:22:13.913

在 C++/CLI中， **^**就像标准 C++ 中的类似 *。因为枚举是值类型，所以不应包含**^ ，否则您会将它们视为****System.Enum**。

删除 ^，您将在 C# 端看到正确的枚举。

```
property System::ServiceProcess::ServiceControllerStatus Status  
{  
    System::ServiceProcess::ServiceControllerStatus get()  
    {  
        return (System::ServiceProcess::ServiceControllerStatus)_status->dwCurrentState;   
    }  
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T14:11:11.960

我认为枚举不使用 ^ - 尝试从属性声明和 get() 中删除它。

# inversion-of-control - 有什么理由不将我的 IoC 用作通用设置存储库吗？

> ID：115039
> 
> 赞同：5
> 
> 时间：2008-09-22T14:08:23.183
> 
> 标签：inversion-of-control

假设**ApplicationSettings**类是适用于我的应用程序的设置的通用存储库，例如 TimeoutPeriod、DefaultUnitOfMeasure、HistoryWindowSize 等...假设 MyClass 使用其中一个设置 - DefaultUnitOfMeasure。

我对正确使用控制容器反转的阅读 - 如果我在这方面错了请纠正我 - 是您在其构造函数中定义类的依赖关系：

```
public class MyClass {
  public MyClass(IDataSource ds, UnitOfMeasure default_uom) {...}
} 
```

然后用类似的方法调用实例化你的类

```
var mc = IoC.Container.Resolve<MyClass>(); 
```

其中**IDataSource**已被分配一个具体实现，而 default_uom 已被连接以从**ApplicationSettings.DefaultUnitOfMeasure**属性进行实例化。然而，我不得不怀疑，所有这些箍是否真的有必要跳过。我有什么麻烦我应该怎么做

```
public class MyClass {
  public MyClass(IDataSource ds) {
    UnitOfMeasure duom = IoC.Container.Resolve<UnitOfMeasure>("default_uom");
  }
} 
```

是的，我的许多课程最终都依赖于**IoC.Container**，但无论如何我的大多数课程都会有这种依赖。只要类是耦合的，我似乎应该充分利用它。请敏捷大师，告诉我我错在哪里。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T14:39:55.743

根据我的 IoC 容器，我通常没有很多课程。我通常尝试将 IoC 的东西包装在我注入其他类的外观对象中，但通常我的大部分 IoC 注入仅在我的应用程序的更高层中完成。

如果你按照自己的方式做事，那么如果不为测试创建 IoC 配置，就无法测试 MyClass。这将使您的测试更难维护。

另一个问题是您将拥有想要更改配置的软件高级用户编辑您的 IoC 配置文件。这是我想避免的。您可以将 IoC 配置拆分为普通配置文件和 IoC 特定内容。但是您也可以使用普通的 .Net 配置功能来读取配置。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T03:26:33.623

> IoC.Container.Resolve("default_uom");

我认为这是一个经典的反模式，您将 IoC 容器用作服务定位器 - 导致的关键问题是：

*   如果您的容器配置错误，您的应用程序将不再快速失败（您只会在它第一次尝试在代码中解析该特定服务时才知道它，除了一组特定的逻辑/情况外，这可能不会发生）。
*   更难测试 - 当然不是不可能，但是您要么必须为测试创建一个真实的（和半配置的）windsor 容器实例，要么使用 IWindsorContainer 的模拟注入单例 - 这给测试增加了很多摩擦，与仅能够通过构造函数/属性将模拟/存根服务直接传递到您的测试类相比。
*   更难维护这种应用程序（配置不是集中在一个位置）
*   违反许多其他软件开发原则（DRY、SOC 等）

您原始陈述的相关部分暗示您的大多数类将依赖于您的 IoC 单例 - 如果它们通过构造函数/依赖项注入所有服务，那么与 IoC 有一些紧密耦合应该是例外规则 - 通常我唯一依赖容器的时候是当我做一些棘手的事情时，即试图避免循环依赖问题，或者出于某种原因希望在运行时创建组件，即使这样我也可以通常避免依赖于通用 IServiceProvider 接口以外的任何东西，如果我需要在原始项目之外的环境中重用组件，则允许我交换自制 IoC 或服务定位器实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T14:34:37.627

> 是的，我的许多课程最终都依赖于 IoC.Container，但无论如何我的大多数课程都会有这种依赖。

我认为这是问题的症结所在。如果实际上您的大多数类都与 IoC 容器本身耦合，那么您可能需要重新考虑您的设计。

一般来说，您的应用程序应该只在引导期间直接引用一次容器类。在您将第一个钩子连接到容器之后，对象图的其余部分应该完全由容器管理，并且所有这些对象都应该忘记它们是由 IoC 容器创建的事实。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T03:50:44.907

要评论您的具体示例：

```
public class MyClass {
    public MyClass(IDataSource ds) {
        UnitOfMeasure duom = IoC.Container.Resolve<UnitOfMeasure>("default_uom");
    }
} 
```

这使得重用你的类变得更加困难。更具体地说，它使得在您限制它的狭窄使用模式之外实例化您的类变得更加困难。这将表现出来的最常见的地方之一是在尝试测试您的课程时。如果可以将 UnitOfMeasure 直接传递给构造函数，则测试该类会容易得多。

此外，您为 UOM 实例选择的名称（“default_uom”）意味着可以覆盖该值，具体取决于类的使用情况。在这种情况下，您不希望像这样对构造函数中的值进行“硬编码”。

使用构造函数注入模式**不会**使您的类依赖于 IoC，恰恰相反，它让客户端可以选择是否使用 IoC。

# xml - IKVM 的 Remap XML 文件的格式是什么？

> ID：115041
> 
> 赞同：11
> 
> 时间：2008-09-22T14:09:08.890
> 
> 标签：xml, ikvm

在[本文中](http://weblog.ikvm.net/CommentView.aspx?guid=b9b950c5-eb34-4b81-975a-1c95492736fb)，Jeroen 解释了一个使用 XML 文件将 Java Bean getter 和 setter 重新映射到 .NET 属性的示例。

如果我想重新映射在 .NET 中调用`showDialog()`的Java 方法，那么 XML 文件会是什么样子？`ShowDialog()`以前有人使用过重新映射选项吗？[除了检查remapper.cs](http://ikvm.cvs.sourceforge.net/ikvm/ikvm/ikvmc/remapper.cs?revision=1.16&view=markup)源代码之外，知道从哪里获取有关其工作原理的信息吗？

**编辑 #1** - 找到了一些肯定有帮助的东西：OpenJDK 文件夹中的[map.xml](http://ikvm.cvs.sourceforge.net/ikvm/ikvm/openjdk/map.xml?revision=1.41&view=markup)文件似乎具有相同的格式。

**编辑#2**哎哟。16 小时内观看 7 次。:-) 我已经正式接触了 SO 知识的边缘...... ;)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T19:07:39.157

似乎您将不得不使用提到的文章中提到的[MapFileGenerator.java ;-)](http://www.frijters.net/MapFileGenerator.java)

更多信息可以在[这里](https://java.sun.com/docs/books/tutorial/javabeans/introspection/index.html)找到 BeanInfo 。

# asp.net-mvc - MVC Preview 5 - 将视图渲染到字符串以进行测试

> ID：115060
> 
> 赞同：8
> 
> 时间：2008-09-22T14:12:18.493
> 
> 标签：asp.net-mvc, testing, view, rendering

我正在阅读 Brad Wilson ( [http://bradwilson.typepad.com/blog/2008/08/partial-renderi.html](http://bradwilson.typepad.com/blog/2008/08/partial-renderi.html) ) 的一篇关于 MVC Preview 5 的新 ViewEngine 更改的帖子，并认为能够将视图呈现为字符串以用于测试。我从文章中得到的印象是有可能实现这一目标，但不知道如何实现。

我相信这将使我们能够取消我们的一些 WatIn 测试（这些测试缓慢且不可靠），因为它可以让我们通过简单地检查字符串中的预期值/文本来检查视图是否正确呈现。

有没有人实施过这样的事情？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T19:25:26.010

It's tricky. What you have to do is set the Response.Filter property to a custom stream class that you implement. The MVC Contrib project actually has examples of doing this. I'd poke around in there.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-06-24T03:02:55.490

我想这就是你需要的。该`RenderPartialToString`函数将控制器作为字符串返回。我从[这里](https://stackoverflow.com/questions/1637951/asp-net-mvc-how-to-send-an-html-email-using-a-controller)得到它。

```
public static string RenderPartialToString(string controlName, object viewData)
{
     ViewDataDictionary vd = new ViewDataDictionary(viewData);
     ViewPage vp = new ViewPage { ViewData = vd };
     Control control = vp.LoadControl(controlName);

     vp.Controls.Add(control);

     StringBuilder sb = new StringBuilder();
     using (StringWriter sw = new StringWriter(sb))
     {
         using (HtmlTextWriter tw = new HtmlTextWriter(sw))
         {
             vp.RenderControl(tw);
         }
     }

     return sb.ToString();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-15T04:10:45.793

此外，它对 HTML 到 PDF 转换器等组件很有用。这些组件通常使用 2 种转换方式。

*   将 URL 传递给转换方法
*   传递 HTML 内容（您可以选择指定 baseUrl 来解析虚拟路径）

我在控制器内部使用了 Authorize 过滤器，因此如果我重定向到 URL，则呈现的 HTML 是登录页面之一（我使用自定义身份验证）。

如果我使用 Server.Execute(Url) 来保留上下文，则该方法将失败（HttpUnhandledException: Error execution child request for /Template/Pdf/1.）。

因此，我尝试检索呈现的 ViewResult 的 HTML，但没有成功。

# internet-explorer - 检索 Web 浏览器存储的表单数据？

> ID：115095
> 
> 赞同：0
> 
> 时间：2008-09-22T14:19:40.130
> 
> 标签：internet-explorer, firefox, browser, cross-browser

我的网络浏览器设置为将我输入的内容保存到表单的文本框中。我的浏览器的文本框中存储了很多搜索词，并且希望在清除这些值之前通过某种程序来获取它。太多太多了，我一次都看不完。

网络浏览器必须将这些数据存储在某个地方，有人知道在哪里吗？是否可以检索这些值？ *Firefox*，比 IE 更重要——但是，如果有人知道可以提取这些值的脚本吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T14:27:04.573

**火狐 3**

在 Windows 上的 Firefox 中，它存储在 SQLite 文件中，位于：

```
C:\Documents and Settings\<Username>\Application Data
    \Mozilla\Firefox\Profiles\<UID>.default\formhistory.sqlite 
```

获得 SQLite 文件后，您可以编写一个脚本以非常快速地从中读取数据 - 例如，这是[使用 SQLite 和 PHP 5](http://www.weberdev.com/ViewArticle/Introduction-to-using-PHP-5.0-and-SQLite)的一个很好的入门。

**Firefox 预版本 3**

显然 SQLite 自版本 3 以来仅用于保存的表单历史记录。版本 2 仍然使用 formhistory.dat，它是使用[Mork](http://en.wikipedia.org/wiki/Mork_(file_format))编写的。

来自 Mork 上的 wiki：

> 此外，尽管是纯文本，但 Mork 通常被认为是人类无法理解的，并且是编写解析器的一种硬格式。

[Bugzilla 上](https://bugzilla.mozilla.org/show_bug.cgi?id=241438)有一个项目文件要求引入更健全和可读的格式，文件管理器甚至[尝试](http://www.jwz.org/hacks/mork.pl)为他的 .dat 文件编写 perl 解析器，但成功有限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T14:31:39.977

好像可以在USER_DIR/Mozilla/Firefox/Profiles//formhistory.sqlite下找到sqlite数据库形式的表单历史

我没有尝试用 Sqlite 浏览它，但文件名似乎是明确的。

You can find several wrappers on the [sqlite](http://www.sqlite.org/cvstrac/wiki?p=SqliteWrappers) website to access it from the language of your choice.

Good Luck

# version-control - 如何防止 TFS 覆盖标签？

> ID：115096
> 
> 赞同：1
> 
> 时间：2008-09-22T14:20:00.377
> 
> 标签：version-control, tfs, label, overwrite

如果我在 TFS 中制作了一个标签，然后又制作了一个同名的新标签……那么旧标签将被新标签替换。

如何防止 TFS 覆盖标签？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T14:26:03.297

以下 MSDN 文章介绍[了如何使用标签的范围来尝试尽量减少这些事故的发生](http://msdn.microsoft.com/en-us/library/9ew32kd1(VS.80).aspx)：

> **使用 /Child 选项避免标记错误**
> 
> 如果您发出标签命令以及预先存在的标签名称和包含已用相同标签标记的文件的 itemspec，则 /child 选项的值确定是否使用新的修订信息更新标记的文件。也就是说，这些文件被标记为相同的名称，但具有不同的范围。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T08:09:37.390

谢谢，这使我走上了正确的道路。

似乎标签覆盖是一个“功能”而不是一个错误。它按照上面设计的六字母链接的说明工作，下面是另外两个有关它的信息。

[http://msdn.microsoft.com/en-us/library/ms181439(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms181439(VS.80).aspx) [http://msdn.microsoft.com/en-us/library/ms181440(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms181440(VS.80).aspx)

显然，TFS 标签不是像其他 VCS 那样的时间点快照，尽管我不完全理解解释。

# cvs - CVS：用分支替换 HEAD

> ID：115098
> 
> 赞同：14
> 
> 时间：2008-09-22T14:20:13.420
> 
> 标签：cvs, branch

如何用分支替换 CVS 存储库的 HEAD？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-22T14:21:22.730

看看这个页面，它有一个非常容易理解的在 CVS 中的分支和合并

[http://kb.wisc.edu/middleware/page.php?id=4087](http://kb.wisc.edu/middleware/page.php?id=4087)

它还包括一个用指定分支替换 HEAD 的示例

## **用另一个替换一个分支**

**标记分支的结尾**

```
cvs tag merge_NEW_BRANCH 
```

**切换回您要替换的分支**

*前往：*

```
cvs up -A 
```

*到分支：*

```
cvs up -r OLD_BRANCH 
```

**进行替换：**

*更换头*

```
cvs up -jHEAD -j NEW_BRANCH 
```

*更换分支*

```
cvs up -jOLD_BRANCH -j NEW_BRANCH 
```

如果需要，提交更改和标记。

# java - 如何在 JScrollPane 中实现位置敏感缩放？

> ID：115103
> 
> 赞同：11
> 
> 时间：2008-09-22T14:21:33.947
> 
> 标签：java, swing, user-interface, zooming

我正在尝试在`JScrollPane`. `JScrollPane`包含一个带有自定义的组件，该组件将`paint`在分配的任何空间内绘制自身 - 因此缩放就像使用根据`MouseWheelListener`需要调整内部组件大小一样简单。

但我也想放大（或缩小）一个点，以使该点在生成的放大（或缩小）视图中尽可能居中（这就是我所说的“位置敏感”缩放），类似缩放在谷歌地图中的工作原理。我确信这已经做过很多次了——有人知道在 Java Swing 下做这件事的“正确”方法吗？`Graphic2D`使用's 转换而不是使用会更好`JScrollPanes`吗？

示例代码如下：

```
package test;

import java.awt.*;
import java.awt.event.*;
import java.awt.geom.*;
import javax.swing.*;

public class FPanel extends javax.swing.JPanel {

private Dimension preferredSize = new Dimension(400, 400);    
private Rectangle2D[] rects = new Rectangle2D[50];

public static void main(String[] args) {        
    JFrame jf = new JFrame("test");
    jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    jf.setSize(400, 400);
    jf.add(new JScrollPane(new FPanel()));
    jf.setVisible(true);
}    

public FPanel() {
    // generate rectangles with pseudo-random coords
    for (int i=0; i<rects.length; i++) {
        rects[i] = new Rectangle2D.Double(
                Math.random()*.8, Math.random()*.8, 
                Math.random()*.2, Math.random()*.2);
    }
    // mouse listener to detect scrollwheel events
    addMouseWheelListener(new MouseWheelListener() {
        public void mouseWheelMoved(MouseWheelEvent e) {
            updatePreferredSize(e.getWheelRotation(), e.getPoint());
        }
    });
}

private void updatePreferredSize(int n, Point p) {
    double d = (double) n * 1.08;
    d = (n > 0) ? 1 / d : -d;
    int w = (int) (getWidth() * d);
    int h = (int) (getHeight() * d);
    preferredSize.setSize(w, h);
    getParent().doLayout();
    // Question: how do I keep 'p' centered in the resulting view?
}

public Dimension getPreferredSize() {
    return preferredSize;
}

private Rectangle2D r = new Rectangle2D.Float();
public void paint(Graphics g) {
    super.paint(g);
    g.setColor(Color.red);
    int w = getWidth();
    int h = getHeight();
    for (Rectangle2D rect : rects) {
        r.setRect(rect.getX() * w, rect.getY() * h, 
                rect.getWidth() * w, rect.getHeight() * h);
        ((Graphics2D)g).draw(r);
    }       
  }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-04-09T05:27:57.613

测试了这个，似乎工作......

```
private void updatePreferredSize(int n, Point p) {
    double d = (double) n * 1.08;
    d = (n > 0) ? 1 / d : -d;

    int w = (int) (getWidth() * d);
    int h = (int) (getHeight() * d);
    preferredSize.setSize(w, h);

    int offX = (int)(p.x * d) - p.x;
    int offY = (int)(p.y * d) - p.y;
    setLocation(getLocation().x-offX,getLocation().y-offY);

    getParent().doLayout();
} 
```

**更新**

这里有一个解释：点`p`是鼠标相对于`FPanel`. 由于您正在缩放面板的大小，因此`p`（相对于面板的大小）的位置将按相同的因子进行缩放。通过从缩放位置中减去当前位置，您可以在调整面板大小时获得点“移动”的程度。然后只需将滚动窗格中的面板位置在相反方向上移动相同的量以`p`放回鼠标光标下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-09T16:30:41.817

这是@Kevin K 解决方案的一个小重构：

```
private void updatePreferredSize(int wheelRotation, Point stablePoint) {
    double scaleFactor = findScaleFactor(wheelRotation);
    scaleBy(scaleFactor);
    Point offset = findOffset(stablePoint, scaleFactor);
    offsetBy(offset);
    getParent().doLayout();
}

private double findScaleFactor(int wheelRotation) {
    double d = wheelRotation * 1.08;
    return (d > 0) ? 1 / d : -d;
}

private void scaleBy(double scaleFactor) {
    int w = (int) (getWidth() * scaleFactor);
    int h = (int) (getHeight() * scaleFactor);
    preferredSize.setSize(w, h);
}

private Point findOffset(Point stablePoint, double scaleFactor) {
    int x = (int) (stablePoint.x * scaleFactor) - stablePoint.x;
    int y = (int) (stablePoint.y * scaleFactor) - stablePoint.y;
    return new Point(x, y);
}

private void offsetBy(Point offset) {
    Point location = getLocation();
    setLocation(location.x - offset.x, location.y - offset.y);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T14:34:10.813

您的 MouseWheelListener 还必须定位光标，将其移动到 JScrollPane 的中心并调整要查看的内容的 xmin/ymin 和 xmax/ymax。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-08T07:55:09.600

我认为像这样的smt应该可以工作...

```
 private void updatePreferredSize(int n, Point p) {
    double d = (double) n * 1.08;
    d = (n > 0) ? 1 / d : -d;
    int w = (int) (getWidth() * d);
    int h = (int) (getHeight() * d);
    preferredSize.setSize(w, h);

    // Question: how do I keep 'p' centered in the resulting view?

    int parentWdt = this.getParent( ).getWidth( ) ;
    int parentHgt = this.getParent( ).getHeight( ) ;

    int newLeft = p.getLocation( ).x - ( p.x - ( parentWdt / 2 ) ) ;
    int newTop = p.getLocation( ).y - ( p.y - ( parentHgt / 2 ) ) ;
    this.setLocation( newLeft, newTop ) ;

    getParent().doLayout();
} 
```

编辑：改变了几件事。

# excel - 在 Office 2007 应用程序中使用 VBA？

> ID：115108
> 
> 赞同：4
> 
> 时间：2008-09-22T14:22:43.663
> 
> 标签：excel, vba, visual-studio, ms-office, vsto

VBA 会像 V​​B6 一样很快消失吗？我不应该使用 VBA 开发新的 Office 应用程序吗？或者我应该使用 VSTO 开发所有新的 Office 应用程序？

更新：最近读了这篇[文章](http://visualbasic.about.com/b/2009/09/26/visual-basic-and-office-an-update.htm)。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-22T14:26:48.007

Office VSTO 在 Office VBA 上提供了大量附加功能，虽然我不相信微软已经表示它将终止 VBA（事实上，[他们已经明确](http://blogs.msdn.com/access/archive/2008/01/17/vba-in-office-14.aspx)表示它至少会在 Office 14 之前出现；Office 2007 = Office 12），我认为将您的应用程序迁移到 VSTO 以利用额外的灵活性和功能是非常值得的。

实际上，我认为弃用 VBA 是不可行的，因为大量的 Office 编程是由业务用户在宏观层面进行的，而且我认为这种情况不会很快消失。这些人通常无法访问支持 VSTO 的 IDE。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-27T11:01:56.793

VSTO 有新的特性，但与 VBA 相比也有一些重大的不足。

一方面，代码访问安全性会使部署 VSTO 应用程序变得困难（这是有礼貌的）。

另一方面，对于“高级用户”开发人员而言，VSTO 开发环境远不如 VBA 那样容易访问。例如，没有宏记录器可以帮助您入门。

一个大的亮点是.NET 与进程外 COM 对象的互操作不能很好地工作。例如，如果您想在 Excel VSTO 应用程序中操作其他 Office 应用程序（Word、PowerPoint、Outlook），您会发现这些应用程序的多个副本在后台运行，原因在[本知识库文章](http://support.microsoft.com/default.aspx/kb/317109/EN-US/)中描述。

所有这些加上对现有 VBA 应用程序的巨额投资意味着 VBA 不会很快消失。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-22T14:34:53.430

微软表示在可预见的未来[将支持 VBA](http://blogs.msdn.com/excel/archive/2008/01/16/clarification-on-vba-support.aspx)，但他们也建议新应用程序使用 VSTO。

最新的 Mac 版本的 MS Office 不支持 VBA，64 位 Windows 以虚拟 32 位进程外模式运行它。因此，如果您正在计划使用 Office 作为平台的新应用程序，VSTO**绝对**是要走的路，但您不必太担心遗留支持。

正如@cori 指出的那样，对于 MS 来说，仅仅取消支持并破坏如此多的现有软件将是一个很大的营销禁忌。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-14T10:20:35.503

自从 .NET 首次发布以来，Microsoft 一直在暗示带有集成 VSTO 的 Office 托管代码版本（大概与为 VBA 集成 VB6 IDE 的方式相同，因此为 VSTO 集成 VS IDE）。

考虑到涉及多少编码 - 并且考虑到这不会产生任何用户可见的功能 - 我非常怀疑这在 Microsoft 优先级列表中是否很高。我可以想象他们在现有代码库的顶部分层了一组托管代码对象（就像 Joel Spolsky 首先将 VBA 放入 Excel 时在现有 C 代码库上分层了一组 COM 对象）并安装了一个新的 IDE in 作为默认值，同时隐藏旧的。即使那将是一个主要的练习（想象一下编写宏记录器！）。当然，这将使 .NET 成为 Office 的先决条件，Office 团队只会在枪口下接受。

当然，他们永远不会真正从产品中删除 VBA——Excel 仍然支持 Excel 4 宏，Word 仍然具有支持 Word 6 宏的 WordBasic 自动化对象，并且没有任何被删除的迹象，因为有太多要支持的遗留代码 - 十年来没有人使用过这些编码模型中的任何一种。

如果微软确实在 Office 中加入了 .NET 环境（坦率地说，我怀疑这是否会发生），那么他们可能会停止为新的 Office 功能添加 VBA 支持。这是他们最接近停止使用 VBA 的方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T14:31:54.047

这是[Microsoft](http://blogs.msdn.com/excel/archive/2008/01/16/clarification-on-vba-support.aspx)关于未来 VBA 支持的评论。简而言之，它不会在 Windows 版本的 Office 上消失（但在 Mac 版本中已停产）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T17:50:24.047

VBA 离贬值还有很长的路要走，事实上 VBA 将被重新引入 MAC 上的下一版本 Office ( [http://www.microsoft.com/presspass/press/2008/may08/05-13MacBU2008PR.mspx](http://www.microsoft.com/presspass/press/2008/may08/05-13MacBU2008PR.mspx) ) .

对于现场的大多数人来说，VBA 和 C XLL（以及 VB6 ！！）仍然是首选工具。当前的 .NET 链接速度很慢，并且提供零生产力增益。第 3 部分工具（如 ExcelDNA）在一定程度上减轻了痛苦，但显然基于非托管 C（和基于汇编程序）的 Office 代码库不能轻松地与 .NET 搭配使用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-30T19:49:27.730

VBA 加载项部署起来有点麻烦，但 VSTO 更是如此。此外，VSTO 涉及一些开销，因为它需要在运行代码之前启动 CLR。

但最重要的是；VSTO 消除了编写 VBA 的痛苦。

# c++ - 嵌入式硬件测试自动化

> ID：115115
> 
> 赞同：25
> 
> 时间：2008-09-22T14:24:16.890
> 
> 标签：c++, c, unit-testing, embedded, testing-strategies

**有没有人成功地直接在嵌入式硬件上进行自动化测试？**

具体来说，我正在考虑为硬件层模块自动执行一系列单元测试。我们需要对我们的硬件层代码有更大的信心。我们的很多项目都使用中断驱动定时器、ADC、串行 io、串行 SPI 设备（闪存）等。

**这还值得努力吗？**

我们通常针对：

处理器：8 位或 16 位微控制器（一些 DSP 的东西）
语言：C（有时是 c++）。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-22T14:30:33.770

当然。在汽车行业，我们为每个新产品使用 100,000 美元的定制测试仪来验证硬件和软件是否正常运行。

然而，开发人员还构建了一个更便宜（低于 1,000 美元）的测试仪，其中包括一堆 USB I/O、A/D、PWM 输入/输出等，并且可以在工作站上使用脚本，或者专门构建 HIL/SIL 测试软件例如 MxVDev。

硬件在环 (HIL) 测试可能就是您的意思，它仅涉及连接到设备 I/O 的一些 USB 硬件 I/O，计算机上的软件针对它运行测试。

值不值就看情况了。

在高可靠性行业（飞机、汽车等），客户指定了非常广泛的硬件测试，因此您必须拥有它才能获得投标。

在消费行业，对于非复杂项目，通常不值得。

但是，对于任何涉及多个程序员的项目，在硬件上运行每晚的回归测试*真的*很好 - 很难正确地模拟硬件到满足您自己认为软件测试足够的程度。

当问题进入构建时，测试会立即显示。

通常，您同时执行黑盒和白盒测试 - 您在设备上运行诊断代码，允许您监视硬件中的信号和内存（可能只是一个调试器，或者可能是您编写的对消息做出反应的代码例如公共汽车）。这将是白盒测试，您可以在其中看到内部发生的情况（甚至导致某些事情发生，例如如果不自己引入错误就无法测试的严重内存错误）。

我们还运行了一堆“黑匣子”测试，其中忽略了诊断路径，只有 I/O 被激发/读取。

对于更便宜的设置，您可以获得 100 美元的带有 USB 和/或以太网的微控制器板（例如 Atmel UC3 系列），您可以将其连接到您的设备并运行基本测试。

它对产品维护特别有用——项目完成后，将一些工作板、测试仪和一整套软件存储在 CD 上。当您需要进行修改或调试问题时，很容易将其全部备份并使用一些知识（测试后）主要功能不受您的更改影响。

-亚当

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-22T14:31:13.237

是的。我取得了成功，但这不是一个急需解决的问题。简而言之，这是我的团队所做的：

1.  使用自制的 C 单元测试框架定义了各种单元测试。基本上，只有很多宏，其中大部分被命名为`TEST_EQUAL`、`TEST_BITSET`、`TEST_BITVLR`等。

2.  编写了一个引导代码生成器，它采用这些编译的测试并将它们编排到执行环境中。它只是一个执行我们正常启动例程的小驱动程序——但它不是进入控制循环，而是执行一个测试套件。完成后，它将最后一个要运行的套件存储在闪存中，然后重置 CPU。然后它将运行下一个套件。这是为了在套件死亡时提供隔离。（但是，您可能希望禁用此功能以确保您的模块能够配合。但这是一个集成测试，而不是一个单元测试。）

3.  个别测试将使用串行端口记录其输出。这对我们的设计来说是可以的，因为串口是空闲的。如果您的所有 IO 都被消耗，您将不得不找到一种方法来存储您的结果。

有效！拥有它真是太好了。使用我们的自定义数据记录器，您可以点击“测试”按钮，几分钟后，您将获得所有结果。我强烈推荐它。

**更新**以阐明测试驱动程序的工作原理。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T03:31:28.937

是的。

难度取决于您要测试的硬件类型。正如其他人之前所说，问题将是您需要应用的外部刺激的复杂性。外部刺激可能最好通过一些外部测试装置来实现（正如亚当戴维斯所描述的那样）。

但是，要考虑的一件事*就是*您要验证的内容。

很容易假设要验证硬件和固件的交互，那么您实际上别无选择，只能直接应用外部刺激（即，将 DAC 应用到所有 ADC 输入等）。但是，在这些情况下，您真正​​想要测试的极端情况通常会受到时间问题的影响（例如，当您执行函数 foo() 时会出现中断），这将非常难以测试一种有意义的方式——甚至更难从中获得有意义的结果。（即。我们运行这个测试的前 100K 次很好。我们最后一次运行它失败了。为什么？！？）

但是硬件的验证应该单独进行。完成此操作后，除非它定期更改（通过可下载的 fpga 映像等），否则您应该能够假设硬件可以正常工作并纯粹测试您的固件。

因此，在这种情况下，您可以专注于验证用于处理外部刺激的算法。例如，使用固定值调用您的 ADC 转换例程，就好像它们直接来自您的 ADC 一样。这些测试是可重复的，因此是有益的。不过，他们将需要特殊的测试版本。

测试设备的通信路径将相对简单，不需要特殊的代码构建。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-09-07T16:48:47.813

我们在嵌入式系统上进行了自动化测试，取得了不错的成绩。我们有在专用测试机器上运行的高级（易于编程和调试）语言编写的测试。这些测试通常会进行完整性检查或生成随机输入到设备中，然后检查正确的行为。生成和维护这些测试需要做很多工作。我们设计了一个框架，然后让实习生自己进行测试。

这不是一个完美的解决方案，测试肯定容易出错，但最重要的部分是改进现有的覆盖漏洞。找到最大的洞并设计一些东西以自动方式覆盖它，即使它不完美或不会覆盖整个功能。稍后，当您的所有内容都被覆盖时，您可以回来解决最差的覆盖范围或最关键的功能。

需要考虑的一些事项：

*   固件错误的惩罚是什么？在现场更新固件有多容易。
*   我的测试提供什么样的覆盖范围？这是一个简单的健全性检查吗？它的可配置性是否足以测试许多不同的场景？
*   一旦测试失败，您将如何重现该值以进行调试？您是否记录了所有设备和测试设置，以便尽可能多地消除变量？设备配置、固件版本、测试软件版本、所有外部输入、所有观察到的行为？
*   你在测试什么？规范是否足够清楚您正在测试的设备的预期行为，或者您是否正在验证您认为代码应该做什么？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-22T14:47:55.240

如果您的目标是测试您的低级驱动程序代码，您可能需要创建某种测试夹具，使用环回电缆或多个互连单元来允许您运行每个驱动程序。将具有已知良好软件的电路板与运行开发版本的电路板配对，将允许您测试通信协议等方面的回归。

具体的测试策略取决于您要测试的硬件。例如，可以通过呈现已知波形并转换一系列样本来测试 ADC，然后检查适当的范围、频率、平均值等。

过去我发现这种类型的测试非常有价值，让我可以自信地修改和改进驱动程序代码，而不必担心破坏现有应用程序。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-22T15:55:02.927

是的，我这样做了，尽管我一直有一个可用于测试 I/O 的串行端口。

通常很难让设备*完全*保持原样。有些测试需要注释掉一行或添加一个调用，例如处理看门狗。

恕我直言，这总比没有单元测试好。当然，您还需要进行完整的集成/系统测试。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T14:31:06.997

单元测试嵌入式项目非常困难，因为它通常需要外部刺激和外部测量。

我们已经成功地开发了一个外部串行协议（rs232 或 udp 或 tcpip 消息），其中包含基本命令，用于在低级驱动程序中通过调试日志来执行硬件，以寻找错误条件甚至轻微异常条件（尤其是用于限制检查）

但是一旦开发完成，如果需要，我们就可以在每次构建后运行测试。它绝对可以让您提供更优质的产品。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T14:38:27.917

如果您的目标是制造测试（确保模块正确组装，没有意外短路/开路/等），您应该首先关注测试电缆和连接器，然后是插座和焊接连接，然后是 PCB 本身。这些项目都可以通过查找驱动每条单独线路高而其相邻线路低（反之亦然）的访问模式来测试短路和开路，然后读回线路的值。

如果不了解硬件的更多细节，很难更具体，但大多数嵌入式处理器可以将 I/O 引脚设置为 GPIO 模式，从而简化此类测试。

如果您没有在 PCA 上执行针床测试，则应将此测试视为新制造电路板的强制性第一步。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-12-12T11:48:08.660

我知道这已经过时了，但也许它会有所帮助。是的，你可以做到，但这取决于你想在你想要的解决方案上投资多少。两年多以来，我一直致力于 AUTOSAR 的 MCAL 层的测试和验证。在软件测试方面，这是您可以获得的最低水平。这是一种组件级别的测试。有些人可能称它为单元级别，但它比这略高，因为我们正在测试 MCAL 组件的 API。诸如：ADC、SPI、ICU、DIO 等。

使用的解决方案涉及： - 在目标 micro 上运行的测试框架 - 一个 dSPACE 盒，用于在需要时向目标提供和读取信号 - 通过 Vector CANape 进行 XCP 访问以触发测试执行和结果收集 - python 框架执行测试控制和结果验证

测试用例是用 C 语言编写的，它们与被测软件一起闪现到目标上。这是一个黑盒测试，因为我们没有以任何方式改变 MCAL 的实现。而且我认为甚至没有触及启动顺序。空闲任务用于连续检查标志的状态，该标志是开始执行测试的信号。一个 10 毫秒的任务用于实际运行测试。测试用例实际上是一个开关用例。此开关中的每个案例都是一个测试步骤。Python 在测试步骤级别触发了测试执行。这种方法的一个好处是可以重复使用具有不同参数的步骤。这个测试控制，执行什么以及如何执行，是由 Python 通过一个测试控制数据结构完成的，该结构充当测试实现与测试触发和评估机制之间的 API。这就是 CANape 的用途。设置要执行的测试并读取测试结果。通过测试步骤获得的每个值都存储在数据结构的数组部分中。测试步骤本身不涉及任何验证，因为目标被认为是测试环境的不可信组件。验证是由 Python 根据测试规范完成的。Python 正在解析这些规范，并能够自动创建测试触发脚本，包括每个测试步骤的验证标准。每个测试用例的规范是一系列测试步骤描述及其验证标准。其中一些步骤是与 dSPACE 相关的步骤。例如，一个步骤是初始化一些东西，并要求在已经配置的通道上捕获一些边缘，

A cheaper solution would involve using an in-house board instead of the dSPACE equipment. To some extent, even a programmable signal generator can be used, but that would not help if you need to validate signals output-ed by the target.

# unit-testing - 单元测试类是否应该与其余代码一起受版本控制？

> ID：115116
> 
> 赞同：13
> 
> 时间：2008-09-22T14:24:18.417
> 
> 标签：unit-testing, version-control

如果我为开发项目创建一个测试套件，这些类是否应该与项目代码的其余部分一起受版本控制？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-22T14:25:19.693

是的，没有理由不将它们置于源代码控制中。如果测试发生变化怎么办？如果接口发生变化，需要更改测试怎么办？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T14:26:44.683

是的，您将生产代码放入源代码控制的所有相同原因仍然适用于您编写的任何单元测试。

这是经典的谁，何地和为什么问题：

*   谁改了代码？
*   他们什么时候改的？
*   他们改变它是为了什么？

这些问题与测试代码和生产代码一样重要。您绝对应该将单元测试代码放入存储库。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-22T14:25:46.400

绝对地。测试类必须与代码保持同步。这意味着检查它并在持续集成下运行测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T14:28:17.473

绝对地！测试类是源代码，应该像任何其他源代码一样进行管理。您将需要修改它们并跟踪版本，并且您想知道维护历史记录。

您还应该将测试数据置于源代码控制之下，除非它非常大。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T14:34:36.847

单元测试应该与存储库中的代码库相关联。

除了必须为以前的版本生成维护版本之外，没有其他原因，您可以保证，根据您的单元测试指标，您的代码不会比以前差（希望现在更好）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T14:40:57.910

完全同意。怎么会有人不这样想？

如果你使用代码分支，你应该尝试让你的测试代码自然地适合主代码线，这样当你分支时，测试的正确版本也会分支。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T14:26:28.910

是的，他们应该。检查最新版本的人应该能够在他们的机器上对代码进行单元测试。这将有助于识别缺失的依赖项，还可以为他们提供有关代码如何工作的非官方文档。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T14:26:34.200

是的。

测试代码是一个代码。它应该被维护、重构和版本化。它是您系统源代码的一部分。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T14:27:23.357

当然，他们应该被视为代码库的一等公民。他们需要所有的爱和关怀，即维护，就像任何一段代码一样。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T14:27:29.470

是的，他们应该。每当您进行代码更改时，您都应该检查测试并运行它们。如果您将它们放在其他地方，那么运行它们会更加麻烦。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T14:30:26.140

是的。由于这里提到的所有其他原因，加上随着功能的变化，您的测试套件也会发生变化，并且应该很容易为任何给定的版本、分支等获得正确的测试套件，并且不仅可以进行测试在版本控制中，但与您的代码相同的存储库是实现这一目标的方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T14:34:23.667

绝对地。您可能会发现，随着代码的更改，您的测试也可能需要更改，因此您可能希望记录这些更改，尤其是在测试或代码突然停止工作的情况下。;-)

此外，单元测试用例应尽可能接近他们正在测试的实际代码（同一文件的底部似乎是标准）。它既是为了方便，也是为了维护。

有关什么是好的单元测试的更多信息，请查看[此 stackoverflow 帖子](https://stackoverflow.com/questions/61400/what-makes-a-good-unit-test)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T14:40:56.317

是的，出于上述所有原因，如果您使用的是“监视”源代码控制的持续集成服务器，您可以让它在每次提交时运行最新的单元测试。

这意味着由于单元测试失败以及代码未编译导致构建损坏。

# ruby-on-rails - 编辑操作中没有 respond_to 块（使用脚手架生成）？

> ID：115121
> 
> 赞同：7
> 
> 时间：2008-09-22T14:25:38.587
> 
> 标签：ruby-on-rails, ruby

有谁知道为什么`respond_to`生成的`edit`动作没有块？典型的脚手架控制器中的每个其他操作都有一个`respond_to`用于输出`html`和`xml`格式化的块。为什么该`edit`操作是例外？

我正在使用最新版本的 Ruby on Rails (2.1.1)。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-22T14:39:25.370

Rails 处理了 99% 的情况：在 Edit 操作中几乎不需要进行任何 XML 或 JSON 转换，因为在非视觉上，Edit 操作与 Show 操作非常相似。想要在应用程序中更新模型的非可视客户端可以通过这种方式调用控制器

```
GET /my_models/[:id].xml (Show) 
```

然后，客户端应用程序可以进行任何转换或编辑并将结果发布（或放置）到

```
PUT /my_models/[:id].xml (Update) 
```

当你调用它时，你通常这样做是为了获得 Show 动作的可编辑形式：

```
GET /my_models/[:id]/edit 
```

它是供人类使用的。99%的时间，就是这样。由于在 Edit 操作中转换数据是不常见的，Rails 假设您不会这样做，并通过将 respond_to 排除在脚手架之外来干燥您的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T19:01:25.350

有点相关。有些人可能想知道为什么新动作的 rails 脚手架仍然有一个 respond_to 块；而编辑操作没有。这是因为对以下内容的请求：

```
GET /my_models/new.xml 
```

...返回可用于创建新模型的 XML 模板。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T14:37:44.143

因为只会从 HTML 调用编辑操作，所以不需要在 XML 上下文中返回编辑表单。使用 REST，您只需直接进行 put 调用即可使用相关信息进行更新。

# asp.net - 您对 Windows Workflow Foundation 有何体验？

> ID：115124
> 
> 赞同：34
> 
> 时间：2008-09-22T14:26:06.837
> 
> 标签：asp.net, .net, workflow, workflow-foundation

我正在评估 WF 是否可用于 Web 上的业务线应用程序，我很想听听最近关于这项技术的第一手资料。

我的主要兴趣是提高项目的可维护性，并且可能在处理频繁变化的复杂流程时提高开发人员的生产力。

我真的很喜欢 WF 的想法，但它似乎相对不为人知，而且我遇到的许多旧评论都提到，一旦你进入它，它就会变得非常复杂。

如果它的设计过度以至于对于中小型项目无法使用（或糟糕的权衡），那是我需要知道的。

当然，它从 2006 年底就已经推出，所以它可能已经成熟了。如果是这样，那将是另一条非常有用的信息！

提前致谢！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-22T16:01:16.127

Windows Workflow Foundation 是一款功能非常强大的产品，但仍处于其第一个版本中 :-(

使用的主要原因包括：

1.  可视化建模业务需求。
2.  将您的业务逻辑与业务规则分离，并将规则外部化为 XML 文件。
3.  通过将您的工作流程外部化为 XML 文件，将您的业务流程与您的应用程序分离。
4.  如果长时间没有发生任何事情，创建具有自动反应能力的长时间运行的进程。例如未支付的发票。
5.  自动持久化长时间运行的工作流，以降低资源使用率并允许进程和/或机器重新启动。
6.  自动跟踪有助于满足业务需求的工作流。

WF 以库/框架的形式出现，因此大多数时候您需要编写实例化 WF 运行时的主机。也就是说，使用托管在 IIS 中的 WCF 是一种可行的解决方案，并且可以节省大量工作。然而，WCF/WF 耦合并不完美，需要一些认真的工作。有关更多详细信息，请参见此处[http://msmvps.com/blogs/theproblemsolver/archive/2008/08/06/using-a-transactionscopeactivity-with-a-wcf-receiveactivity.aspx](http://msmvps.com/blogs/theproblemsolver/archive/2008/08/06/using-a-transactionscopeactivity-with-a-wcf-receiveactivity.aspx)。预计在下一个版本中会有相当多的更改/增强。

WF（和 WCF）对于 Microsoft 推出的许多新产品来说非常重要。您可以期待在 PDC 期间发布一些有趣的公告。

顺便说一句，保持工作流的多个版本运行需要一些工作，但这主要是标准的 .NET。我刚刚从这里开始就该主题发表了一系列博客文章：http: [//msmvps.com/blogs/theproblemsolver/archive/2008/09/10/versioning-long-running-workfows.aspx](http://msmvps.com/blogs/theproblemsolver/archive/2008/09/10/versioning-long-running-workfows.aspx)

关于可视化建模业务需求。从理论上讲，这在意图和实现分离的情况下非常有效。然而，在实践中，纯粹出于技术原因，您将在工作流中丢弃相当多的额外活动，这会违背目的，因为您必须告诉业务分析师忽略一半的形状和线条。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-22T15:38:34.200

相关问题：[何时使用 Windows Workflow Foundation？](https://stackoverflow.com/questions/104099/when-to-use-windows-workflow-foundation)我在那里的回答：

> 仅当满足以下任一条件时，您才可能需要 WF：
> 
> 1.  你有一个长期运行的过程。
> 2.  你有一个经常变化的过程。
> 3.  你想要一个过程的可视化模型。
> 
> 有关更多详细信息，请参阅 Paul Andrew 的帖子：[将 Windows Workflow Foundation 用于](http://blogs.msdn.com/pandrew/archive/2007/02/01/what-to-use-windows-workflow-foundation-for.aspx)什么？
> 
> 请不要将 WF 与任何类型的可视化编程混淆或联系起来。这是错误的，可能导致非常糟糕的架构/设计决策。

所以，如果你有这样的要求，那么WF是一个不错的选择。当然它是相对复杂的，但提到试图解决的问题也很复杂（有时非常复杂）。恕我直言，例如对附加了事件处理程序的对象进行脱水/再水化是非常复杂的（当对象不在内存中时可以触发事件）。

我无法判断您所说的“中小型项目”是什么意思，但总的来说，我会说如果您的项目至少有上述列表中的两个要求，那么您可以考虑使用 WF 作为解决方案。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-22T14:51:44.700

我们在一个大型的 SharePoint 应用程序中使用了 WF，我可以说它没问题。它具有强大的功能和灵活性。而且，正如 Kevin 所提到的，一旦你了解了工作流的基本概念，你几乎可以用它做任何你想做的事情。

另一方面，它有一些非常严重的问题，比如缺少版本控制，这可能会在未来真正损害您的应用程序。我们被迫部署最多 3 个名为 xxx-v1、xxx-v2 和 xxx-v3 的相同工作流的并行版本，以保持旧实例运行并让新实例使用更新版本。真是让人头疼。哦，还有一些非常不直观的概念（相关标记，wtf??）

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-03T18:30:55.200

我们有一个工作项目，我参与了使用 Workflows。这个想法（来自管理层）是我们程序员将编写工作流活动以及“引擎”和框架。然后非程序员将通过将他们自己的工作流编译成引擎会自动加载的 dll 来处理所有其余的事情。

管理层被非程序员使用 Workflow 来帮助开发软件的想法所说服，这完全是浪费时间。我们试图用这个项目解决的问题相对复杂，我们从一开始就知道软件几乎必须不断地修改（它的计算依赖于其他公司和政府）。

最终结果是我们无法使工作流模块足够通用以供其他人使用。所以程序员是被迫使用工作流程的人，而工作流程所做的所有事情都妨碍了我们。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-04-07T13:32:58.193

过去几个月我一直在使用 Workflow 4.0，虽然印象最深刻，但我发现它非常难以学习。

对于最新版本（.NET 4.0 RC 附带），网络上几乎没有文档，在任何书籍中或没有可用的培训课程。我只找到了与现已失效的 3.0 版本相关的文章。甚至 MSDN 文档也很简单。

工作流设计器并不像它应该的那样直观，因此学习非常困难。我不得不依赖 StackOverflow 上一个人的答案（顺便感谢 Maurice！）——如果没有他的帮助，我会被填满。

所以总而言之，我认为它有潜力，但你会非常疯狂地学习它——等待更多的培训、文档和书籍，否则你会盲目地进入它！

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-23T13:40:17.107

去年，我们与 WF 一起完成了一个工作应用程序，该应用程序现在被用作一个令人难以置信的庞大系统的支柱，该系统被一家非常大的银行用于其抵押贷款流程。pe流程从客户申请到信贷批准有很多步骤。

虽然成功了，但一路走来也有很多问题和危机。对于任何较小规模的项目，它都不值得麻烦。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-22T15:15:35.563

我认为 MS WF 是一个低级工作流库，而不是一个成熟的企业工作流产品，例如 K2。它将使您能够构建启用工作流的应用程序，但它本身并不是工作流应用程序。尽管我们不得不围绕它构建很多我们自己的基础设施（发布/订阅框架、工作流生命周期管理器等），但我在这种能力方面的经验是积极的。那里的许多文档都相当简单，并没有涵盖构建基于 MS WF 的企业工作流应用程序。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-04-07T13:45:15.957

很难学。相当灵活。不要与最终用户的可视化工具相混淆，仅适用于程序员。不确定我是否喜欢依赖属性方法。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-22T14:32:19.037

这真的取决于你想用它做什么。我只用了一点点，但与更成熟的产品相比，如 MetaStorm（我知道从技术上讲它是一个 BPM，但仍然有一个工作流组件）、Process Choriographer 和 IBM MQ 工作流，没有可比性。只是不够成熟。另一方面，在其他人没有的地方它是免费的，并且可能可以完成工作。我不知道我是否会对其进行数百万美元的手术，但对于较小的手术，我会再试一次。你将要面对的真正障碍是它所需要的思维过程的改变。如果您没有以前使用过状态系统的开发人员，那可能是一个真正的障碍。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-22T15:19:26.040

Brian，我无法回复您的评论，但无论如何，通过版本控制，我的意思是在不破坏已经运行的实例的情况下更改工作流的底层代码，并优雅地将更新应用于现有工作流。我不确定“库存”WF，但至少在 SharePoint 环境中没有工作流版本的概念，因此必须将新版本部署为完全不同的工作流，这成为维护的噩梦。这与“再水化”无关，再水化是在某些事件或状态更改后将“休眠”工作流恢复到活动状态的过程。这由工作流运行时透明地处理。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-22T15:26:56.630

WF ist 集成到 SharePoint (WSS 3.0) 中，我已经为各种 SharePoint 网站创建了相当多的工作流，所以我可以讲述我在 SharePoint 中的 WF 体验。与其他工作流框架相比，WF 得分不错。它很稳定（我没有遇到任何神秘的错误），工作流程相当容易设计（感谢 Visual Studio 中的工作流程设计器），您不仅可以使用顺序工作流程，还可以使用状态机工作流程。

当然，它并不完美，开发人员肯定需要一些时间来理解这个概念（即活动模型）；但它绝对是有用的——即使是“小任务”。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T16:44:56.550

从未尝试过 WFF，但我记得读过[Leon Bambrick 的这篇关于 WFF 的文章](http://www.bwebcentral.com/blog/3/758)，他基本上说软件开发工具的整个类型都是无稽之谈。可能会帮助您决定一种或另一种方式。

# caching - 网络缓存策略？

> ID：115126
> 
> 赞同：7
> 
> 时间：2008-09-22T14:26:20.237
> 
> 标签：caching

在决定何时以及如何进行缓存时，您会考虑哪些问题、流程和问题。总是没有胜利的情况吗？

这假设您被困在已优化的代码库中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T14:35:10.340

我最近一直在使用 DotNetNuke 开发 Web 应用程序，每次实施缓存解决方案时我都会考虑很多事情。

*   所有用户都需要查看缓存的内容吗？
*   每个内容的变化频率如何？
*   我可以缓存整个页面吗？
*   我需要手动清除缓存吗？
*   我可以为整个站点使用单个缓存机制，还是需要多个解决方案？
*   如果信息以某种方式过时，会产生什么影响？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T14:29:39.667

我会查看您的网站/应用程序的每个功能，并为每个功能确定：

*   它应该被缓存吗？
*   应该缓存多长时间？
*   什么时候应该清除缓存？

我个人会反对缓存整个页面，而是支持缓存网站/应用程序的部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T14:34:12.387

首先，如果您的代码按照您所说的进行了优化，那么只有在站点受到大量请求的冲击时，您才会看到显着的性能优势。

但是，从 RAM 中提取资源比从磁盘中提取资源要快，因此如果您有适当的缓存策略，您的 Web 服务器将能够处理更多请求。

至于知道什么时候*需要*缓存，考虑到即使是低端的现代 Web 服务器每秒也可以处理数百个请求，所以除非您期望有大量的流量，否则缓存可能是您可以跳过的。

此外，如果您从数据库中提取内容（例如，StackOverflow 可能会这样做）缓存可能会非常有用，因为数据库操作相对昂贵并且在大容量情况下可能是一个巨大的瓶颈。

至于*不*适合缓存或缓存变得困难的场景......如果您尝试缓存显示当前日期和时间的动态页面，您将不断看到旧日期/时间，除非您获得更多地涉及您的缓存策略。所以这是需要考虑的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T14:32:50.910

您使用什么语言？使用 ASP，您只需在方法上添加一些属性标记即可进行一些非常简单的缓存，并且根据时间缓存值。

如果您想对缓存进行更多控制，可以使用一些流行的系统，例如 MemCached，并通过时间或事件进行控制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T14:35:09.873

例如，雅虎对其 JavaScript进行*“版本化” ，因此您的浏览器会下载***code-1.2.3.js**，当出现新版本时，它们会引用该版本。通过这样做，他们可以使他们的 Javascript 代码可以缓存很长一段时间。

至于一般答案，我认为这取决于您的数据，取决于它多久改变一次。例如，图像不会经常更改，但 html 页面会。“关于我们”页面不会经常更改，但新闻部分会。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T14:35:21.527

您可以按时间缓存。这对于快速变化的数据很有用。您可以将时间设置为 30 秒或 1 分钟。当然，这需要一些流量。您拥有的流量越多，您可以玩的时间越多，因为如果您每小时有 1 次访问，则此访问将填充缓存而不使用它...

您可以按事件缓存...如果您的数据发生更改，则更新缓存...如果数据需要非常快速地为用户提供准确，这将非常有用。

您可以缓存您知道不会经常更改的静态内容。如果您有每天刷新的前 10 名，那么您可以将所有内容存储在缓存中并每天更新。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T14:35:53.070

如果可用，请注意整个对象的内存缓存。在 ASPNET 中，这是一个内置功能，您可以在 IIS 应用程序中植入业务逻辑对象并从那里访问它们。

这意味着您可以将生成页面所需的所有内容存储在内存中（持久写入数据库）并在没有***任何***数据库 IO 的情况下生成页面。

您仍然需要使用页面构建逻辑来生成页面，但是您可以节省*大量*获取数据的时间。

其他技术涉及本地化输出缓存，您在发送之前捕获输出并将其保存到文件中。这对于静态部分（例如某些页面上的导航或文本正文）非常有用，并在请求时将它们包括在内。大多数实现会在发生写入时或在一段时间后像这样清除缓存的对象。

然后是最不“准确”的：整页缓存。它是性能最高的，但除非你有非常简单的页面，否则它几乎没用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T15:31:15.760

什么样的缓存？服务器端缓存？客户端缓存？

客户端缓存对于某些东西来说是不费吹灰之力的，比如静态 HTML、SWF 和图像。找出资产可能更改的频率，并酌情设置“过期”标题。（2 天？2 周？2 个月？）

根据定义，动态页面更难缓存。在使用 Javascript 缓存某些块方面已经进行了一些探索（如果 JS 不可用，则降级为 IFrames。）但是，这可能会更难以改造到现有站点。

取决于您的情况，数据库和应用程序级别的缓存可能有效，也可能无效。这真的取决于你的瓶颈在哪里。找出您的应用程序在页面渲染上花费最多时间的位置可能是优先级 1，然后您可以开始查看缓存的位置和方式。

# asp.net - 什么时候应该在 ASP.NET 控件中使用 # 和 =？

> ID：115159
> 
> 赞同：27
> 
> 时间：2008-09-22T14:30:57.840
> 
> 标签：asp.net, data-binding

我已经使用 ASP.NET 多年，但我不记得何时使用 # 和 = 是合适的。

例如：

```
<%= Grid.ClientID %> 
```

或者

```
<%# Eval("FullName")%> 
```

有人可以解释一下什么时候应该使用它们，这样我就可以把它牢记在心？# 是否仅用于支持数据绑定的控件？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-22T14:39:32.453

有几种不同的“蜜蜂叮咬”：

*   `<%@`- 页面指令
*   `<%$`- 资源访问
*   `<%=`- 显式输出到页面
*   `<%#`- 数据绑定
*   `<%--`- 服务器端评论块

ASP.Net 4 中的新功能：

*   `<%:`- 写入页面，但使用 HTML 编码

ASP.Net 4.5 中的新功能：

*   `<%#:`- HTML 编码数据绑定

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-22T14:37:06.030

<%= %> 相当于在任何地方执行 Response.Write("") 。

<%# %> 用于数据绑定，只能在支持数据绑定的情况下使用（如果您在代码隐藏中调用 Page.DataBind()，则可以在控件外部的页面级别使用这些）

[数据绑定表达式概述](http://msdn.microsoft.com/en-us/library/ms178366.aspx)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-22T14:38:10.443

这是[Dan Crevier 撰写的一篇很棒的博客文章，](http://blogs.msdn.com/dancre/archive/2007/02/13/the-difference-between-lt-and-lt-in-asp-net.aspx)其中介绍了他编写的一个测试应用程序以显示差异。

在本质上：

*   <%= 表达式在渲染时进行评估
*   <%# 表达式在 DataBind() 时计算，如果没有调用 DataBind()，则根本不计算。
*   <%# 表达式可以用作服务器端控件中的属性。<%= 表达式不能。

# php - 如何使用 CodeIgniter 进行表格排序？

> ID：115167
> 
> 赞同：8
> 
> 时间：2008-09-22T14:31:48.430
> 
> 标签：php, sorting, codeigniter

在过去的几周里，我一直在使用 CodeIgniter 作为框架开发一个网站。我一直在考虑完成某事的最佳方式，在其他语言的许多其他框架中，这相对简单：可排序表。CodeIgniter 默认关闭查询字符串，因为您的 URL 包含方法参数。因此 URL 可能如下所示：

```
/controller/method/param1/param2 
```

您可能认为您可以将`sortBy`和`sortOrder`作为两个附加参数添加到控制器方法中。我不是特别想这样做，主要是因为我想要一个可重复使用的控制器。当您使用查询字符串参数时，PHP 可以很容易地告诉您是否有一个名为`sortBy`. 但是，当您使用基于 URL 的参数时，它会因每个控制器而异。

我想知道我的选择是什么。据我所见，它们类似于：

*   传入我的`sortBy`和`sortOrder`参数，把它吸起来，然后为它开发一些不可重用的组件。
*   有一个额外的控制器，它将`sortBy`和存储`sortOrder`在会话中（尽管它必须知道您来自哪里，并将您送回原始页面）。
*   有某种 AJAX 函数，它会调用上面的控制器；然后重新加载页面。
*   破解 CodeIgniter 以重新打开查询字符串。实际上，如果这是唯一的选择，那么任何有关如何执行此操作的链接都将不胜感激。

我简直不敢相信这么简单的任务会出现这样的问题！我错过了什么吗？有人有什么建议吗？

虽然我喜欢 jQuery，并且我已经在网站上使用它，但 TableSorter 是一个不错的选择。但是，我想做服务器端排序，因为有些页面可能有大量结果，包括分页。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T14:51:40.457

如果您可以在客户端进行排序，[那么用于 jQuery 的 Tablesorter 插件](http://tablesorter.com/docs)非常好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T05:16:05.357

我用一张相当复杂的桌子遇到了这个问题。困难的部分是表格可以根据某些变量增长/缩小！大痛苦:(

以下是我的处理方式。。

调整 system/application/config/config.php 以允许 URI 中的逗号字符：

```
$config['permitted_uri_chars'] = 'a-z 0-9~%.:_\-,'; 
```

使用排序功能调整我的控制器：

```
function sorter() {
  //get the sort params
  $sort = explode(",",$this->uri->segment(3)); //the 3rd segment is the column/order
  //pass the params to the model
  $data = $this->model_name->get_the_data($sort[0],$sort[1]);
  $this->_show($data);
}
function _show($data) {
  //all the code for displaying your table
} 
```

我过于简单化了，但你明白了。目的是有一个这样的网址：

/控制器/排序器/列名，排序顺序

sorter 函数调用另一个内部函数来处理显示/模板/视图逻辑 - 它的工作是处理排序调用并从模型中获取适当的数据。

当然，这可以简化为您当前的功能：

```
function showGrid() {
  $sort = $this->uri->segment(3);
  if ($sort) {
    //get the data sorted
  } else {
    //get the data the default way
  }
  //rest of your view logic
} 
```

这样，您甚至不需要单独的函数 - 并且可以使用第三段来定义您的排序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T14:48:00.623

我最近将这个[表格分类器](http://tetlaw.id.au/view/blog/table-sorting-with-prototype/)（使用 Prototype）添加到我的一堆页面中。它快速且易于实施。

# java - 您使用哪个供应商的 JDK 构建是否重要？

> ID：115184
> 
> 赞同：13
> 
> 时间：2008-09-22T14:34:43.930
> 
> 标签：java, build-process

如果我使用 WebSphere 6.1 (Java 1.5) 部署到服务器，我应该在我的构建盒上使用 IBM 的 JDK 吗？或者 Sun 的 JDK 会编译成相同的二进制文件吗？

如果我应该使用 IBM 的，我在哪里可以获得 Windows x64 版本？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-22T14:44:28.260

我会尽可能地尝试使开发尽可能接近生产。IBM 和 Sun 的 JDK 肯定都满足 SDK 认证，但它们绝不相同。它们的检测和内存管理至少略有不同。如果不出意外，JDK 中的错误会有所不同，您的代码可能只会在一种情况下与另一种情况下发生故障。它也可能只发生在凌晨 4 点，当满月时，尤其是当你有公司过来的时候。

我无法告诉您从哪里获得 IBM 的 jdk，但如果您在公司获得了 websphere 的许可证，您应该与 IBM 联系以获得指向该 JDK 的链接。

祝你好运，并始终尽量减少差异。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T14:39:57.897

它不应该有任何区别。它可能不是完全相同的二进制文件，但 100% 兼容。我假设您无论如何都在使用外部库，例如 log4j 或者 hibernate 或其他任何东西，而那些不是使用 IBM JDK 构建的。

但是，JRE 存在差异。例如，我记得当我使用反射列出一个类的方法或字段时，IBM JRE 曾经以与 Sun 不同的顺序将它们提供给我。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T14:40:53.510

我将使用相同的 JDK 来构建将在部署应用程序时使用的（如果您可以控制的话）。

如果编译器不同，则二进制文件可能不同，但它们在语义上应该相同。我不知道 IBM 是否编写了自己的编译器。JRockit JDK 实际上使用 Sun 编译器，但 JVM 不同。因此，对于 JRockit，二进制文件是相同的。

如果应用程序在运行时与不同的 JDK 一起使用，我仍然会使用您认为大多数时间在部署时使用的那个来构建，并使用不同的 JDK 进行一些运行时测试。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-10-25T14:53:41.903

IBM JDK 附带 J9 VM，SUN JDK 在 Hotspot VM 上运行，它们具有不同的算法来运行。如果您在 SUN JDK 中部署和调优，并且您的生产使用 IBM JDK for WAS，那么您的应用程序可能不会执行相同的操作。与供应商核实并开票，让我们知道情况如何。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T14:42:12.510

除非您引用 java.* 和 javax.* pacakges 之外的类（您不应该这样做），否则使用任何 JDK 编译都不会导致问题。当然，给定供应商的 JDK 和规范可能会导致一些很难追踪的非常奇怪的运行时错误，但我以前从未见过这种情况。

我建议使用目标 JRE 运行您拥有的任何测试套件，因为供应商之间的运行时行为差异比编译语义更频繁。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-22T14:46:23.917

JDK 将您的代码编译为**字节码**，而不是直接编译为**机器码**。预计不同供应商的编译器会生成跨供应商兼容的代码。例如，IBM 的 JDK1.5 编译器将生成在 SUN 的 JDK 1.5 及更高版本上运行的代码，没有任何问题。

另一个问题是编译器如何优化字节码，我没有信息表明某些编译器比其他编译器执行更好的优化。大部分优化是在运行时由 JVM 执行的（例如 JIT（即时）或 AOT（提前）策略）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T07:28:41.160

长期使用 WebSphere，JDK 的版本非常重要。WebSphere 6.1 附带 IBM JDK 1.5（或者是 5）。当您修补 WebSphere 时，JDK 也有等效的修补程序。虽然它可能适用于不同版本的 JDK（甚至不同的供应商），但如果出现问题，我怀疑您是否会从 IBM 获得很多支持。

如果您需要 64 位 JVM，我建议可能有 64 位构建，虽然我无法具体评论 Windows，但我可以告诉您有一个适用于 AIX 和 Linux 的 64 位 WebSphere 6.1 构建。

最好的答案是与供应商核实，看看他们是否支持您的配置。你不想做的是让它工作，然后在现场遇到问题，打电话给支持并发现你有一个不受支持的环境。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T14:41:33.150

它们应该编译成相同的字节码规范，尽管它们可能编译不同的字节码（就像不同的 C 编译器生成不同的机器码一样）。我认为运行生成的代码不会有任何问题——我已经在 Mac 上编译了 Java 1.4，然后部署到 IBM 的 J9 在 PocketPC 上运行之前没有任何问题（这是在 J9 可以处理 Java 5 字节码之前） .

无论如何，我肯定会让您的编译平台成为您自述文件中的要点，以便您的客户可以查看它是否有问题。

或者，您可以使用 ANT 构建和部署，并将 Sun 的 JDK 与 ANT 一起使用。

# model-view-controller - MVC 模式是描述角色还是层？

> ID：115198
> 
> 赞同：2
> 
> 时间：2008-09-22T14:37:01.040
> 
> 标签：model-view-controller, design-patterns

我最近读到一篇文章，说 MVC 模式描述了应用程序中的层。但就我个人而言，我看到 MVC 在应用程序中显示了几个关键角色。

您认为哪个词更适合描述 MVC 的三个主要部分，层或角色？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T14:49:18.763

层应该意味着各个代码集之间的耦合非常窄。MVC 涉及模型、视图和控制器之间相对紧密的耦合。因此，如果您将其描述为分层模式，则在定义层之间的 API 方面会出现问题。要正确执行此操作，您必须实现一些不直观的模式。

因此，我同意您将其视为在单个层中定义角色的模式的倾向。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T14:46:18.443

我认为角色是一个更好的描述。视图和控制器都在同一个“层”中，通常模型被描述为一个层，但在层之间使用。

通常，我的应用程序以域模型为中心，并围绕它进行演示、持久性和文件 io 等内容。将架构视为分层的想法并不适合我。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T14:56:11.913

MVC 清楚地定义了 ROLES。这些是您可以在任意数量的层中实现的 3 个角色。例如你可以有一个多层控制器

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T14:59:30.253

角色，而不是层。层完全依赖于 MVC 模式的底层实现。例如，服务层在一个实现上可能是单层，但在另一个实现上它可能有一个 Web 服务远程处理层和一个数据库层（用于两个不同的服务层）。层的概念只是为了帮助您组织它，就像模式一样，但是层不像模式那样容易被发现，而且层可以改变，而尽管层因不同的实现而发生变化，但模式保持不变。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T14:44:33.347

您无法比较这两个词，因为它们描述了不同的概念。对我来说，层是不透明的，它提供了一些我可以用来做事的功能。例如，一个好的无线发射器硬件层只会给我一个发送和一个接收功能（例如，基于字节），对我隐藏所有丑陋、丑陋的细节。
角色是对象的行为方式。例如，我的一个编译器中的转换将采用抽象语法树并返回抽象语法树，或者我当前项目中的情感将采用状态差异并返回特定更改的状态差异。

但是，有了这两个定义，我认为没有必要选择一个“正确”的术语而将另一个视为错误的，因为它们并没有太大的冲突。一个层的一部分具有一定的作用，一组符合一定作用的对象构成一个层。当然，控制器在 UI 和模型之间形成了一个特定的层（至少对于输入），但是，它也有一个作用——它将某个事件转换为某些其他事件（因此，它是某种适配器）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T14:46:57.053

我认为两者都可以合理地论证，但我认为将这些部分描述为“层”更符合其他约定，例如[OSI 模型](http://en.wikipedia.org/wiki/OSI_model)。由于视图、控制器和模型越来越接近您的数据，它更像是一个分层结构。似乎“角色”将适用于同一层上应用程序的不同部分。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-22T14:55:29.060

这都是术语，但我认为正确的软件架构术语应该是“层”，就像在逻辑层中一样。如果更清楚，您可以使用术语“架构层”。

问题是，这只是对应用程序进行切片的另一种方式：经典的 n 层应用程序是：

*   用户界面
*   商业逻辑
*   持久性

您可以在一个简单的 MVC 应用程序中拥有以下逻辑层：

*   用户界面
*   控制器
*   模型
*   持久性

但是您仍然可以将“UI”和“控制器”一起讨论为构成用户界面层——不过，在描述和绘制这些架构时，我通常将控制器拆分为一个单独的层。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-22T14:44:21.223

为什么不兼得？我将其视为实现 3 个不同角色的 3 个独立层。

# java - 如何将 /usr/share/java 库添加到 webapp 的类路径？

> ID：115203
> 
> 赞同：3
> 
> 时间：2008-09-22T14:37:56.293
> 
> 标签：java, linux, tomcat, web-applications, classpath

## 概括

部署在 linux + tomcat5.5 上的 webapps 是否可以自动使用/查看所有`/usr/share/java/`jar？

## 细节

我正在为 Ubuntu 打包我的 java webapp（但问题与任何基于 linux 的发行版有关）并让它依赖于 tomcat。

我将放置上下文描述符（一个 xml 文件）来`/usr/share/tomcat5.5/conf/Catalina/localhost/`部署我的应用程序。在这里有我的网络目录：`/usr/share/<appname>/web`，我怎样才能让我的应用程序使用安装在系统（`/usr/share/java`）中的 java jar 库？

我不能只是 symlink `/usr/share/java -> <webdir>/WEB-INF/lib`，因为我的自定义 jar 需要放在`lib`目录中。

## 糟糕的解决方案

到目前为止我找到的解决方案是将每个所需的 jar 符号链接到`<webdir>/WEB-INF/lib/`.

这不是很好，因为我必须对很多 jar 进行符号链接，更糟糕的是对我的直接依赖库（jar）需要的所有 jar 进行符号链接（等等）。如果我的直接依赖库更改了它所需的 jar 列表，我将不得不维护该符号链接。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T14:42:14.083

根据[Tomcat 类加载文档](http://tomcat.apache.org/tomcat-5.5-doc/class-loader-howto.html)，您需要将所有 Tomcat 应用程序都应该可用的任何共享库放在 $CATALINA_BASE/shared/lib 库中——所以一种方法是移动您的库从 /usr/share/java 到 $CATALINA_BASE/shared/lib。

但是，如果我没有误解相同的文档，Tomcat 还会在启动时为类加载器提供系统范围的 CLASSPATH 变量的内容，所以如果您的目录 - /usr/share/java - 包含在系统范围的 CLASSPATH 中变量，那么这也应该起作用。不过，我从来没有这样做过；Tomcat 使 $CATALINA_BASE/shared/lib 的内容在 Tomcat 范围内可用的方法一直为我提供了完美的服务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T17:24:57.203

entzik 的回答引导我找到以下解决方案。

我将使用修改后的“坏解决方案”（见问题）。

修改如下：

1.  依赖于所有依赖项的特定包版本（在打包 deb 时影响“控制”文件）
    示例：*libcommons-io-java (= 1.3.1)*而不仅仅是*libcommons-io-java*
2.  指向 `/usr/share/java` 中实际 jar 文件的符号链接，而不是“通用”文件的符号链接，
    例如：
    *webdir/WEB-INF/lib/commons-io.jar -> /usr/share/java/commons-io-1.3。 1.jar*
    而不是
    *webdir/WEB-INF/lib/commons-io.jar -> /usr/share/java/commons-io.jar*

如果管理员安装了新版本的库（例如 commons-io），此修改可确保 webapp 不会损坏。

缺点是这种方法显然会使用仅由一个应用程序版本使用的库来膨胀系统，并可能导致由于版本冲突而无法安装其他应用程序/库的问题。如果我们谈论图书馆，我想这两个潜在的问题都是次要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T14:49:40.417

您有两种选择，一种是让类加载器向所有 java 程序提供库，另一种是让类加载器向所有 tomcat 上下文提供库。

将您的符号链接添加到 /usr/lib/jvm/java-1.5.0-sun-1.5.0.11/jre/lib （注意您可能需要在此路径中指定不同的版本）以允许所有 java 程序访问这些库或将它们添加到 var/lib/tomcat5.5/shared/libs 的 Tomcat 共享库（同样，版本号可能不同），以供所有 Tomcat 上下文访问。

我还应该注意，这些目录位置取自 Ubuntu “Feisty”。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-22T15:21:11.277

你不应该那样做。Java EE 应用程序应该是自给自足的，并且不依赖于部署包之外的任何资源，而不是容器提供的资源。因此，您应该从该目录中获取所需的库并将其添加到您的 war 或 ear 包中。

这保证了您的应用程序无论在何处部署都将表现相同，并且您不会受到 /usr/share/java... 中库版本的意外更改的影响。

# code-generation - Codesmith 资源

> ID：115206
> 
> 赞同：4
> 
> 时间：2008-09-22T14:38:14.000
> 
> 标签：code-generation, codesmith

我使用 Codesmith 创建我们的代码生成模板，并通过查看示例模板和内置文档成功地学习了如何使用该工具。但是我想知道是否有任何其他资源（书籍、文章、教程等）可以更好地掌握 Codesmith？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-22T14:40:34.963

你检查过[codesmith 社区网站吗](http://community.codesmithtools.com/content/Tutorials.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T19:41:25.670

我们还提供了一系列很棒的新[视频教程](http://community.codesmithtools.com/blogs/videotutorials/)。您可能还想检查一下。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-06T06:29:24.927

还有一个[Google Code Codesmith 部分](http://code.google.com/p/codesmith/)，您可以在其中下载一些 CSLA、nHibernate 和 Plinqo 模板的最新更新。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T14:41:32.073

这是使用 CodeSmith[构建数据访问层](http://community.codesmithtools.com/blogs/tutorials/archive/2006/02/13/nettiers.aspx)的有趣教程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-30T16:52:33.873

根据您使用的模板，我们可能有一个单独的网站，其中包含大量有用信息，例如[nettiers.com](http://nettiers.com/)和[plinqo.com](http://plinqo.com/)。另请查看[我们社区网站上的帮助部分](http://community.codesmithtools.com/content/Help.aspx)。

我们最近还为我们的所有文档创建了一个新的[WIKI (http://docs.codesmithtools.com)](http://docs.codesmithtools.com/dashboard.action)。

谢谢

——布莱克·涅米斯基

# validation - 如何检查文件是否为有效的 UTF-8？

> ID：115210
> 
> 赞同：72
> 
> 时间：2008-09-22T14:39:15.543
> 
> 标签：validation, utf-8, internationalization

我正在处理一些应该是有效的 UTF-8 但不是的数据文件，这会导致解析器（不在我的控制之下）失败。我想添加一个预先验证 UTF-8 格式良好的数据的阶段，但我还没有找到一个实用程序来帮助做到这一点。

W3C 上有一个[Web 服务](http://www.w3.org/2005/01/yacker/uploads/utf8-validator)似乎已经死了，我发现了一个仅限 Windows 的验证[工具](http://web.archive.org/web/20081101142036/http://bolek.techno.cz:80/UTF8-Validator/)，它报告无效的 UTF-8 文件，但不报告要修复的行/字符。

我会很高兴有一个我可以放入并使用的工具（理想情况下是跨平台的），或者一个我可以作为数据加载过程的一部分的 ruby​​/perl 脚本。

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-09-22T14:48:53.490

您可以使用 GNU iconv：

```
$ iconv -f UTF-8 your_file -o /dev/null; echo $? 
```

或者使用旧版本的 iconv，例如在 macOS 上：

```
$ iconv -f UTF-8 your_file > /dev/null; echo $? 
```

如果文件可以成功转换，该命令将返回 0，否则返回 1。此外，它将打印出发生无效字节序列的字节偏移量。

**编辑**：不必指定输出编码，它将被假定为 UTF-8。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-22T14:44:16.123

使用 python 和 str.encode|decode 函数。

```
>>> a="γεια"
>>> a
'\xce\xb3\xce\xb5\xce\xb9\xce\xb1'
>>> b='\xce\xb3\xce\xb5\xce\xb9\xff\xb1' # note second-to-last char changed
>>> print b.decode("utf_8")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/lib/python2.5/encodings/utf_8.py", line 16, in decode
    return codecs.utf_8_decode(input, errors, True)
UnicodeDecodeError: 'utf8' codec can't decode byte 0xff in position 6: unexpected code byte 
```

抛出的异常在其 .args 属性中具有请求的信息。

```
>>> try: print b.decode("utf_8")
... except UnicodeDecodeError, exc: pass
...
>>> exc
UnicodeDecodeError('utf8', '\xce\xb3\xce\xb5\xce\xb9\xff\xb1', 6, 7, 'unexpected code byte')
>>> exc.args
('utf8', '\xce\xb3\xce\xb5\xce\xb9\xff\xb1', 6, 7, 'unexpected code byte') 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-05-26T02:49:25.327

您可以使用[moreutils](http://linux.die.net/man/1/isutf8)集合中的[isutf8](https://joeyh.name/code/moreutils/)。

```
$ apt-get install moreutils
$ isutf8 your_file 
```

在 shell 脚本中，使用`--quiet`开关并检查退出状态，对于有效的 utf-8 文件，退出状态为零。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-22T14:46:06.133

gnu [iconv](http://www.gnu.org/software/libiconv/documentation/libiconv/iconv.3.html)库怎么样？使用 iconv() 函数：“输入中遇到无效的多字节序列。在这种情况下，它将 errno 设置为 EILSEQ 并返回 (size_t)(-1)。*inbuf 指向无效多字节序列的开头。 "

编辑：哦-我错过了您想要脚本语言的部分。但是对于命令行工作，[iconv](http://www.gnu.org/software/libiconv/documentation/libiconv/iconv.1.html)实用程序也应该为您验证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-02-20T20:43:42.877

您也可以使用[`recode`](https://linux.die.net/man/1/recode)，如果它尝试解码 UTF-8 并遇到无效字符，它将退出并出现错误。

```
if recode utf8/..UCS < "$FILE" >/dev/null 2>&1; then
    echo "Valid utf8 : $FILE"
else
    echo "NOT valid utf8: $FILE"
fi 
```

这会尝试重新编码为[通用字符集 (UCS)](https://en.wikipedia.org/wiki/Universal_Coded_Character_Set)，这始终可以从有效的 UTF-8 进行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-04-07T15:04:10.233

这是检查文件是否为有效 UTF-8 的 bash 脚本：

```
#!/bin/bash

inputFile="./testFile.txt"

iconv -f UTF-8 "$inputFile" -o /dev/null

if [[ $? -eq 0 ]]
then
    echo "Valid UTF-8 file.";
else
    echo "Invalid UTF-8 file!";
fi 
```

**描述：**

*   `--from-code`,`-f`编码（从编码转换字符）
*   `--to-code`,`-t`编码（将字符转换为编码，不必指定，假定为UTF-8。）
*   `--output`, `-o` file (Specify output file 'instead of stdout')

# version-control - 我可以在 perforce 中安全地编辑重命名的文件吗

> ID：115222
> 
> 赞同：6
> 
> 时间：2008-09-22T14:41:20.810
> 
> 标签：version-control, perforce

我有一个需要移动的文件，该文件已经被强制执行。一旦移动它需要一些编辑 - 更新包等 - 适合其新位置。我应该提交移动更改规范，然后重新打开它进行编辑，还是我可以一次性完成？如果是这样，适当的事件顺序是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T14:53:14.277

我以前曾一口气完成过此操作，但根据您的构建过程，我建议您不要这样做。我一般做的是这样的：

1.  移动文件。
2.  如果移动需要更改才能编译，请打开它进行编辑并进行更改。
3.  提交更改，告诉 perforce 重新打开文件进行编辑。
4.  对路径等进行更改，这些更改不会导致编译错误，但应该更新。
5.  提交这些更改并附上适当的描述。

但是，如果您愿意，您可以在上面的步骤 (2) 中进行所有更改。Perforce 可能会将新文件的标志从集成更改为添加，但它仍会记住文件的源路径。

**编辑：更好的方法**

我意识到我经常使用不同的方法，但是“移动”文件的想法让我分心。所以，我会推荐这些步骤：

1.  将文件集成到新的路径/名称中，将之前的文件留在那里。我假设这不会破坏您的构建过程。
2.  提交新文件，提交后再次检查以进行编辑。
3.  对新文件和项目进行必要的更改，以便您使用新文件。
4.  提交对新文件的编辑。
5.  [可选] 您可能需要检查分支规范以查看是否需要将旧文件映射到任何分支中的新文件。
6.  创建一个用于删除旧文件的更改列表，并在稍后提交。

此方法允许将编辑与重命名/移动完全分开，同时永远不会使项目处于无法编译的状态。

另外，为什么要等待第 6 步？有时，尤其是在较大的项目中，您可能想要移动另一个人正在编辑的文件。Perforce 会很有帮助地告诉你这一点。通过等待删除文件，您允许您的同事完成编辑并提交，而无需手动移动他们的工作。提交编辑后，可以将它们整合到新文件中，然后可以安全地删除旧文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T14:51:46.153

提交移动更改，然后重新打开以进行编辑（您也可以使用重新打开选项）。这在更改历史记录中对用户来说更具可读性。

此外，最新版本的 Perforce 会在解析后检查文件的更改。因此，在某些解决操作完成后，可能会有投诉编辑文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T11:02:58.107

I would say always submit first then edit. It is much cleaner and makes it more obvious whats happening in your repository. Then simply checkout the file in the new location and make whatever changes. This also makes it much more obvious that the changes were made in the new location and to all it to work after renaming.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T14:55:00.247

“安全”可能是这里的一个重点。一旦你重命名或移动文件，它会得到一个修订号“1”，这对于你的 Perforce 客户端来说就像一个新文件。当然，管理员将能够获取其先前的历史记录，但如果文件的编辑/版本历史记录对您很重要，那么获取旧版本会有点困难。

更新：感谢 Commodore Jaeger 和 Greg Whitfield 的启发性评论。

即使来自 Perforce 的支持，要找到一个真正的答案也并不容易，所以我想我会向每个人更新我们发现的内容：

*   Perforce 将每个文档的所有版本存储在其数据库中。
*   如果它将您的文件保存为类型`<text>`，或者`<ktext>`它将一个文件版本的差异存储到另一个而不是整个文件。
*   如果您签出一个文件，不对其进行任何更改，然后重新提交，它将另存为具有 0 个差异的新版本。这是可配置的，P4 可以设置为忽略没有任何实际差异的更改列表项。您可以通过在提交更改列表之前选择“还原未更改的文件...”来强制执行此行为。
*   使用“重命名/移动...”在 P4 中移动文件，以便跟踪它们。不要使用 Windows 资源管理器复制它们，然后在 P4 中重新添加它们。
*   如果您使用上下文菜单中的“重命名/移动...”功能，“新”文件将显示修订号“1”，就好像它是一个新文件一样。
*   但是，由于 P4 会保存对文件执行的每个功能，因此您实际上可以使用 CLI 命令访问任何以前的修订版（甚至恢复“已删除”的文件）`p4 filelog -i`
*   如果您想获取已移动或重命名文件的修订历史记录，并且您不是管理员，则可以右键单击并选择其“修订图”，即使在分支之间移动，它也会显示文件的每个版本。

根据 Perforce 支持，通过分支或文件夹移动更轻松地跟踪修订历史是一个经常请求的功能，并且在他们当前的路线图中。

Perforce 的回答：目前，没有办法移动/重命名/集成文件并仍然保持准确的文件历史记录。

但是，如果您通过右键单击要共享的文件夹来选择“集成...”，则新分支文件夹和基础文件的文件版本将从修订 #1 开始，但集成历史分支文件夹和基础文件之间以及原始文件夹和基础文件之间将保留，您可以通过它们跟踪文件的修订历史。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T14:56:26.360

是的你可以。只需重新打开以编辑分支文件（即新文件）。在 P4Win 中，有一个上下文菜单（“重新打开以进行编辑”）。

# visual-studio - 如何禁用程序断点/断言？

> ID：115237
> 
> 赞同：17
> 
> 时间：2008-09-22T14:43:25.703
> 
> 标签：visual-studio, debugging, x86, assert, debugbreak

我正在使用 Visual Studio 开发本机应用程序，我在使用 __asm int 3 或 __debugbreak 放置的代码中有一个程序断点（断言）。有时当我点击它时，我想禁用它，以便同一调试会话中的连续点击不再闯入调试器。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-22T14:43:45.483

## x86 / x64

假设您正在编写 x86/x64 应用程序，请在监视窗口中编写以下内容：

x86:`*(char *)eip,x`

x64:`*(char *)rip,x`

您应该看到一个值 0xcc，它是 INT 3 的操作码。将其替换为 0x90，它是 NOP 的操作码。您还可以使用带有 eip 作为地址的内存窗口。

## 每次点击付费

假设您正在编写 PPC 应用程序（例如 Xbox 360），请在您的监视窗口中写入以下内容：

`*(int *)iar,x`

您应该看到一个值 0xfeNNNNNN，它是陷阱的操作码（通常是 0x0fe00016 = 无条件陷阱）。将其替换为 0x60000000，它是 NOP 的操作码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-06-03T14:40:55.803

你可以尝试这样的事情：

```
#define ASSERT(x) {\
   if (!(x)) \
   { \
      static bool ignore = false; \
      if (!ignore) \
      { \
         ignore = true; \
         __asm int 3 \
      } \
   }\
} 
```

这应该只触发一次调试。您甚至可以向用户显示一个消息框并询问该做什么：继续（什么都没有发生）、中断（调用 int 3）或忽略（忽略设置为 true，断点不再命中）

# asp.net - 注销页面上的 RegisterStartupScript

> ID：115249
> 
> 赞同：0
> 
> 时间：2008-09-22T14:46:03.840
> 
> 标签：asp.net

我正在尝试有一个注销页面，其中显示一条消息，然后重定向到登录页面。这是在 ASP.net 2.0 中。

我有这个`Page_Load`：

```
ClientScript.RegisterStartupScript(typeof(Page), "pageredirect", JavascriptRedirect() ); 
```

这是我的重定向功能：

```
private string JavascriptRedirect()
{
    StringBuilder sb = new StringBuilder();
    sb.Append("<script type=\"text/javascript\" language=\"javascript\">");
    sb.Append("var x = 5;");
    sb.Append("var y = 1;");
    sb.Append("function startClock(){");
    sb.Append("x = x-y;");
    sb.Append("t=setTimeout(\"startClock()\", 1000);");
    sb.Append("if(x==0){");
    sb.Append("window.location='login.aspx';");
    sb.Append("clearTimeout(t);");
    sb.Append(" }");
    sb.Append(" }");
    sb.Append("startClock();");
    sb.Append("</script>");
    return sb.ToString();
} 
```

当我测试时，我的注销页面中没有 javascript。任何人都知道发生了什么。`Page_Load`注册这个是不是太晚了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T14:54:24.617

顺便说一句：您不需要 Javascript 在一定时间后将浏览器重定向到页面。`<HEAD>`只需在您的部分中使用纯 HTML 元标记。

```
<meta http-equiv="refresh" content="5; URL=login.aspx"> 
```

数字代表以秒为单位的时间，即目标的 URL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T14:52:25.480

代替 typeof(Page)，尝试 typeof(YOURPAGECLASS) -- 使用 YOURPAGECLASS 设置页面的类名。Page_Load 绝对不会太晚。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T15:05:51.173

也许您的执行管道中发生了一些不寻常的事情？

当我创建一个新的 .aspx 并粘贴您在问题中提供的代码时，它会按照您的预期工作（即 Javascript 被呈现给客户端）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T15:08:47.077

我会这样注册：

```
Page.ClientScript.RegisterStartupScript(this.GetType(), "Redirect", "script here", true); 
```

最后一个“真”告诉 ASP.NET 呈现脚本标记和 CDATA，因此您不必全部写出来。

您可能还希望将您的 javascript 放在单独的包含文件中，以便在调整它时不必重新编译。如果您这样做，那么在您的页面加载中，您将拥有：

```
Page.ClientScript.RegisterClientScriptInclude("RedirectInclude", "scripts/redirect.js");
Page.ClientScript.RegisterStartupScript(this.GetType(), "Redirect", "JavascriptRedirect();", true); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T17:04:33.867

我不明白为什么它不起作用，但我可以给你一个解决方法：

在页面中声明一个 asp:literal 项。在页面加载中，

yourLiteral.Text = JavascriptRedirecct();

# java - 重构Java工厂方法

> ID：115269
> 
> 赞同：15
> 
> 时间：2008-09-22T14:50:58.353
> 
> 标签：java, factory

这段代码有一些非常不满意的地方：

```
/*
Given a command string in which the first 8 characters are the command name
padded on the right with whitespace, construct the appropriate kind of 
Command object.
*/
public class CommandFactory {
     public Command getCommand(String cmd) {
         cmdName = cmd.subString(0,8).trim();

         if(cmdName.equals("START")) {
             return new StartCommand(cmd);
         }
         if(cmdName.equals("END")) {
             return new EndCommand(cmd);
         }
         // ... more commands in more if blocks here
         // else it's a bad command.
         return new InvalidCommand(cmd);
     }
} 
```

我对多个出口点毫不后悔——结构很清楚。但我对这一系列几乎相同的 if 语句并不满意。我考虑过将字符串映射到命令：

```
commandMap = new HashMap();
commandMap.put("START",StartCommand.class);
// ... etc. 
```

...然后使用反射使适当类的实例从地图中查找。然而，虽然在概念上很优雅，但这涉及到相当多的反射代码，继承此代码的人可能不会欣赏 - 尽管该成本可能会被收益所抵消。将值硬编码到 commandMap 中的所有行的气味几乎与 if 块一样糟糕。

如果工厂的构造函数可以扫描类路径以查找 Command 的子类，查询它们以获取字符串表示形式，并自动将它们添加到其曲目中，那就更好了。

那么 - 我应该如何去重构呢？

我想那里的一些框架免费给了我这种东西。假设我无法将这些东西迁移到这样的框架中。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-22T15:42:50.867

下面的代码怎么样：

```
public enum CommandFactory {
    START {
        @Override
        Command create(String cmd) {
            return new StartCommand(cmd);
        }
    },
    END {
        @Override
        Command create(String cmd) {
            return new EndCommand(cmd);
        }
    };

    abstract Command create(String cmd);

    public static Command getCommand(String cmd) {
        String cmdName = cmd.substring(0, 8).trim();

        CommandFactory factory;
        try {
            factory = valueOf(cmdName);
        }
        catch (IllegalArgumentException e) {
            return new InvalidCommand(cmd);
        }
        return factory.create(cmd);
    }
} 
```

枚举的`valueOf(String)`用于查找正确的工厂方法。如果工厂不存在，它将抛出一个`IllegalArgumentException`. 我们可以将其用作创建`InvalidCommand`对象的信号。

一个额外的好处是，如果您可以将方法`create(String cmd)`公开，如果您还可以使这种构造命令对象的方式编译时间检查可用于您的其余代码。然后，您可以使用`CommandFactory.START.create(String cmd`) 创建一个 Command 对象。

最后一个好处是您可以轻松地在 Javadoc 文档中创建所有可用命令的列表。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-22T14:58:14.203

我认为你的字符串到命令的映射很好。您甚至可以将字符串命令名称分解为构造函数（即 StartCommand 不应该知道它的命令是“START”吗？）如果您可以这样做，则命令对象的实例化要简单得多：

```
Class c = commandMap.get(cmdName);
if (c != null)
    return c.newInstance();
else
    throw new IllegalArgumentException(cmdName + " is not as valid command"); 
```

另一种选择是创建一个`enum`带有类链接的所有命令（假设所有命令对象都实现`CommandInterface`）：

```
public enum Command
{
    START(StartCommand.class),
    END(EndCommand.class);

    private Class<? extends CommandInterface> mappedClass;
    private Command(Class<? extends CommandInterface> c) { mappedClass = c; }
    public CommandInterface getInstance()
    {
        return mappedClass.newInstance();
    }
} 
```

由于枚举的 toString 是它的名称，因此您可以使用它`EnumSet`来定位正确的对象并从内部获取类。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-22T15:00:57.160

除了

```
cmd.subString(0,8).trim(); 
```

部分，这对我来说看起来还不错。您可以使用 Map 并使用反射，但是，根据您添加/更改命令的频率，这可能不会给您带来太多收益。

您可能应该记录为什么只需要前 8 个字符，或者更改协议以便更容易确定该字符串的哪一部分是命令（例如，在命令键之后放置一个标记，如 ':' 或 ';'单词）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-22T14:55:50.043

它不是您问题的直接答案，但您为什么不抛出 InvalidCommandException（或类似的东西），而不是返回 InvalidCommand 类型的对象？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-22T15:03:49.913

除非有理由他们不能是我总是试图让我的命令实现无状态。如果是这种情况，您可以在命令接口中添加一个方法 boolean identifier(String id) 方法，该方法将判断该实例是否可用于给定的字符串标识符。然后你的工厂可能看起来像这样（注意：我没有编译或测试这个）：

```
public class CommandFactory {
    private static List<Command> commands = new ArrayList<Command>();       

    public static void registerCommand(Command cmd) {
        commands.add(cmd);
    }

    public Command getCommand(String cmd) {
        for(Command instance : commands) {
            if(instance.identifier(cmd)) {
                return cmd;
            }
        }
        throw new CommandNotRegisteredException(cmd);
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-22T15:01:39.107

我喜欢你的想法，但如果你想避免反射，你可以向 HashMap 添加实例：

```
commandMap = new HashMap();
commandMap.put("START",new StartCommand()); 
```

每当您需要命令时，只需克隆它：

```
command = ((Command) commandMap.get(cmdName)).clone(); 
```

然后，您设置命令字符串：

```
command.setCommandString(cmdName); 
```

但是使用 clone() 听起来不像使用反射那么优雅:(

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T14:55:26.050

采用 Convetion vs Configuration 方法并使用反射来扫描可用的 Command 对象并将它们加载到您的地图中将是可行的方法。然后，您可以在不重新编译工厂的情况下公开新命令。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T15:04:50.193

另一种动态查找要加载的类的方法是省略显式映射，而只是尝试从命令字符串构建类名。标题案例和连接算法可以变成“START”->“com.mypackage.commands.StartCommand”，并且只需使用反射来尝试实例化它。如果找不到类，则以某种方式失败（InvalidCommand 实例或您自己的异常）。

然后，您只需添加一个对象即可添加命令并开始使用它。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-22T15:43:06.637

一种选择是让每种命令类型都有自己的工厂。这给你两个好处：

1）您的通用工厂不会调用新的。因此，每种命令类型将来都可以根据字符串中空格填充后的参数返回不同类的对象。

2）在您的 HashMap 方案中，您可以通过将每个命令类映射到实现 SpecialisedCommandFactory 接口的对象而不是映射到类本身来避免反射。这个对象在实践中可能是一个单例，但不需要这样指定。然后，您的通用 getCommand 调用专用的 getCommand。

也就是说，工厂扩散可能会失控，而您拥有的代码是完成这项工作的最简单的东西。就我个人而言，我可能会保持原样：您可以比较源代码和规范中的命令列表，而无需考虑以前可能称为 CommandFactory.registerCommand 的非本地考虑，或者通过反射发现了哪些类。这并不令人困惑。对于少于一千个命令，它不太可能很慢。唯一的问题是你不能在不修改工厂的情况下添加新的命令类型。但是您所做的修改是简单且重复的，如果您忘记进行修改，您会在包含新类型的命令行中得到明显的错误，因此它并不繁重。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T14:59:03.000

将这种重复的对象创建代码全部隐藏在工厂中并不是那么糟糕。如果它必须在某个地方完成，至少它都在这里，所以我不会太担心它。

如果你*真的*想对它做点什么，也许去地图，但从一个属性文件配置它，然后从那个道具文件构建地图。

如果不走类路径发现路线（我不知道），您将始终修改 2 个地方：编写一个类，然后在某处添加映射（工厂、映射初始化或属性文件）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T15:02:03.570

考虑到这一点，您可以创建小的实例化类，例如：

```
class CreateStartCommands implements CommandCreator {
    public bool is_fitting_commandstring(String identifier) {
        return identifier == "START"
    }
    public Startcommand create_instance(cmd) {
        return StartCommand(cmd);
    }
} 
```

当然，如果小类只能说“是的，那是开始，给我那个”或“不，不喜欢那个”，那么这会增加一大堆，但是，您现在可以将工厂重新设计为包含这些 CommandCreators 的列表，然后问每个人：“你喜欢这个命令吗？” 并返回第一个接受 CommandCreator 的 create_instance 的结果。当然，现在提取 CommandCreator 之外的前 8 个字符看起来有点不妥，所以我会修改它，以便将整个命令字符串传递给 CommandCreator。

我想我在这里应用了一些“用多态性替换开关”-重构，以防有人对此感到疑惑。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T15:02:20.400

我会通过反射去制作地图和创作。如果扫描类路径太慢，您可以随时向类添加自定义注释，在编译时运行注释处理器并将所有类名存储在 jar 元数据中。

然后，您唯一能做的就是忘记注释。

不久前我做了类似的事情，使用 maven 和[APT](http://java.sun.com/j2se/1.5.0/docs/guide/apt/index.html)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T15:51:30.440

我这样做的方法是没有通用的工厂方法。

我喜欢使用域对象作为我的命令对象。由于我使用 Spring MVC，这是一个很好的方法，因为[DataBinder.setAllowedFields 方法](http://static.springframework.org/spring/docs/1.1.5/api/org/springframework/validation/DataBinder.html#setAllowedFields(java.lang.String[]))允许我非常灵活地将单个域对象用于几种不同的形式。

要获取命令对象，我在 Domain 对象类上有一个静态工厂方法。例如，在成员类中，我会有类似的方法 -

```
public static Member getCommandObjectForRegistration();
public static Member getCommandObjectForChangePassword(); 
```

等等。

我不确定这是一个很好的方法，我从来没有在任何地方看到过它的建议，只是我自己想出了它，我喜欢把这样的东西放在一个地方的想法。如果有人看到任何反对的理由，请在评论中告诉我...

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-22T16:00:51.773

如果可能的话，我建议避免反思。这有点邪恶。

您可以使用三元运算符使代码更简洁：

```
 return 
     cmdName.equals("START") ? new StartCommand  (cmd) :
     cmdName.equals("END"  ) ? new EndCommand    (cmd) :
                               new InvalidCommand(cmd); 
```

你可以引入一个枚举。使每个枚举常量成为工厂是冗长的，并且还具有一些运行时内存成本。但是您可以很容易地查找一个枚举，然后将其与 == 或 switch 一起使用。

```
 import xx.example.Command.*;

 Command command = Command.valueOf(commandStr);
 return 
     command == START ? new StartCommand  (commandLine) :
     command == END   ? new EndCommand    (commandLine) :
                        new InvalidCommand(commandLine); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-22T23:54:06.973

跟着你的直觉走，然后反思。但是，在此解决方案中，现在假定您的 Command 接口具有可访问的 setCommandString(String s) 方法，因此 newInstance 很容易使用。此外，commandMap 是任何带有字符串键 (cmd) 的映射到它们对应的 Command 类实例。

```
public class CommandFactory {
     public Command getCommand(String cmd) {
        if(cmd == null) {
            return new InvalidCommand(cmd);
        }

        Class commandClass = (Class) commandMap.get(cmd);

        if(commandClass == null) {
            return new InvalidCommand(cmd);
        }

        try {
            Command newCommand = (Command) commandClass.newInstance();
            newCommand.setCommandString(cmd);
            return newCommand;
        }
        catch(Exception e) {
            return new InvalidCommand(cmd);
     }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-06-14T14:03:47.467

嗯，浏览，才刚刚遇到这个。我还能评论吗？

恕我直言，原始 if/else 块代码**没有任何问题。**这很简单，简单必须始终是我们在设计中的第一个要求（[http://c2.com/cgi/wiki?DoTheSimplestThingThatCouldPossiblyWork](http://c2.com/cgi/wiki?DoTheSimplestThingThatCouldPossiblyWork)）

这似乎是真的，因为所提供的所有解决方案都比原始代码更少自我记录......我的意思是我们不应该编写我们的代码来阅读而不是翻译......

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-09-22T14:54:52.773

至少，您的命令应该有一个 getCommandString() - 其中 StartCommand 覆盖以返回“START”。然后，您可以注册或发现课程。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2008-09-22T15:56:41.270

+1 关于反思建议，它将为您的班级提供更健全的结构。

实际上，您可以执行以下操作（如果您还没有考虑过）创建与您期望的 String 对应的方法作为 getCommand() 工厂方法的参数，那么您所要做的就是反射和调用（ ) 这些方法并返回正确的对象。

# java - java swing应用程序中的快速搜索？

> ID：115277
> 
> 赞同：2
> 
> 时间：2008-09-22T14:52:04.857
> 
> 标签：java, swing, search

我在徘徊自己哪个组件最适合在摇摆中显示快速搜索结果。我想创建这样的东西，创建一个文本字段，用户可以在其中输入一些文本，在他输入期间我将改进后端快速搜索数据库，我想在文本框下方显示数据，他将能够浏览结果并在预输入结果将显示在表格中。所以我的问题是是否有任何组件已经具有这种显示逻辑？或者不是，实现它的最佳方法是什么。

如果在桌面应用程序上可能的话，这个搜索将是 ajax 在网络上给我的东西，相同的逻辑相同的外观和感觉。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T15:09:33.957

您是否正在为 Java Swing 寻找类似 AutoComplete 组件的东西？

[SwingX](https://swingx.dev.java.net/)就有这样一个组件。有关 JavaDoc，请参见[此处](http://javadesktop.org/swinglabs/build/weekly/latest/swingx-HEAD/javadoc/org/jdesktop/swingx/autocomplete/AutoCompleteDecorator.html)。它有很多实用的方法来做各种事情，即从 JList 的内容中自动完成一个文本框。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T15:05:33.810

您必须首先在`JTextField`s`Document`上附加一个侦听器，以便在用户输入字段（或更改字段）时收到通知。

从那里，您可以启动您需要的任何服务器端代码。其结果可用于更新列表框。

要记住几件事：

1.  对后端进行搜索的代码必须在另一个线程中
2.  更新列表框的代码应该更新列表框的模型
3.  您将需要管理所有后端搜索结果，以便仅使用最新结果更新列表框（例如，用户输入“A”，backenf 搜索该结果。同时，用户输入“C”，启动后端搜索“AC”。如果“AC”搜索结果可用，您需要确保“A”搜索的结果不会出现在列表框中）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T04:58:06.460

我强烈、强烈建议您查看[Glazed Lists——](http://publicobject.com/glazedlists/)这是目前最好的开源 Java 库之一，它使您所询问的大部分内容变得超级简单。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T15:02:29.700

使用休眠搜索。

SwingHack ( [http://oreilly.com/catalog/9780596009076/](http://oreilly.com/catalog/9780596009076/) ) 这本书有一个例子。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T18:38:54.313

为了用一块石头杀死两只鸟：有一个单独的索引线程。这会：

1.  提高执行搜索时的搜索速度。
2.  由于索引是在单独的线程中进行的，因此提高了 UI 的响应能力。

当然，您执行索引的*确切*方式将根据您的特定应用程序而有很大差异。这是开始研究的好地方：[搜索索引](http://en.wikipedia.org/wiki/Index_(search_engine))。请忽略对*Web 3.0* [原文如此] 的引用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T15:03:29.807

这当然是可能的。这也很简单。对于术语的下拉列表，只需使用弹出菜单。这很简单。输入文本的后台处理也很简单。享受！

# svn - 切换到不同的svn分支时出错

> ID：115281
> 
> 赞同：1
> 
> 时间：2008-09-22T14:52:33.000
> 
> 标签：svn, branch, switch-statement

我有两个 SVN 分支（例如开发和稳定），想从一个切换到另一个......

在每个教程中都有如下命令：
`rootOfLocalSvnCopy:>svn switch urlToNewBranch .`

但在我的情况下它会导致错误：

```
svn: REPORT request failed on '/svn/rootOfLocalSvnCopy/!svn/vcc/default'<br/>
svn: Cannot replace a directory from within 
```

我找到的每一个帮助都是关于 svn switch --relocate 但我不想重新定位，只是为了将我的工作副本更改为另一个分支

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T14:58:06.823

好的，我得到它的工作。

错误出现在我用来在命令中指定本地目录的点中。正确的用法是没有它，svn可以自己处理：

*rootOfLocalSvnCopy:>svn switch urlToNewBranch*

（最后没有点...）

# reporting - 哪种报告技术？

> ID：115283
> 
> 赞同：4
> 
> 时间：2008-09-22T14:53:33.307
> 
> 标签：reporting

哪种报告技术最适合产品的最佳情况/类型？我现在正在考虑**3**种技术：

1.  嵌入式报告（Crystal Reports；MS 报告服务）
2.  服务器报告 (MS Reporting Services)
3.  OLAP 数据库（MS 分析服务）

对于现成的产品，您会使用哪种报告技术？是否可以从现成的产品中获得基于 OLAP 类型的报告方面？

哪种技术最适合历史数据？我猜这里 OLAP 数据库会更快，但这取决于数据库的大小，因为我认为您也可以使用嵌入式报告来存储历史数据。

哪种技术最适合定制软件解决方案？

我喜欢在服务器上进行报告的想法，用户可以在该服务器上登录并像使用 MS Reporting 服务一样运行报告。而且实际上只有发票、账单、客户信息表等内容的报告作为嵌入式报告。并且还可以通过 OLAP 数据库为历史数据提供报告服务。

不幸的是，管理层没有看到这种布局，而是想要一个现成的产品，在应用程序中使用 olap 报告以及所有其他报告。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T15:06:38.503

我喜欢报告服务。正如您所说，它可以在客户登录到报告服务网站时使用。但是还有一个组件可以添加到您的应用程序中，该组件在后端使用报告服务。两全其美。

此外，您可以访问分析服务或任何其他数据库中的数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T15:27:39.217

OLAP 不是报告平台，它位于数据库层。

如果您要收集预先计划好的罐装报告，那么 Crystal 或 RS 是最好的主意。就个人而言，我更喜欢 Crystal，但开发报告可能会很痛苦——但是当它们被批准时，Crystal 是一个坚如磐石的平台。（我们将 Crystal 与 .NET 应用程序集成。）

RS 也可以很好地集成，但您必须维护服务器。它们的最大优势是动态/反应式菜单，但是当它们不是很完美时，它们同样难以开发和维护。

OLAP 是一项非常强大的技术——但如果您没有本地知识，那么准确部署它是一个非常具有挑战性的产品。但是，同样，它不是一个报告产品——但它上面有一些有趣的层（例如 ProClarity、Excel 插件）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T06:28:58.100

您还可以查看（我们自己的）[**i-net Clear Reports**](http://www.inetsoftware.de/products/crystalclear)（以前是 i-net Crystal-Clear）。完全基于 Java，可以读取 Crystal Reports 模板，并为任何主要的 Web 服务器提供漂亮而简单的 API 和 servlet。使用 JFreeChart 有漂亮的图表。可以导出为 PDF、HTML、SVG 以及 Swing Java 查看器，您可以嵌入到您自己的应用程序中。我们还提供免费且功能齐全的独立[报表设计](http://www.inetsoftware.de/products/crystal-clear/designer)器。

成本也比 CR 低很多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T14:57:33.207

我们正在使用 DevExpress 的 XtraReports。价格/生产力比率非常高，您可以获得源代码。

您可以将它用于桌面或 Web 应用程序（或导出为 pdf、doc、html 等），并且最终用户设计器由 DevExpress 本地交付。我相信，这是最好的报告套件之一（带有 Telerik Reports）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T15:21:31.587

我真的很喜欢报告服务。您可以将报告嵌入到网页中，您可以让用户通过网络访问您的报告，您甚至可以通过按照设定的时间表将报告通过电子邮件发送给用户来自动化报告交付。您还可以从 OLAP 数据库创建报告。Plus Reporting Services 附带 SQL Server，因此可以节省一些钱。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T06:30:55.987

Crystal 报表使用起来非常简单快捷，但也相当有限。如果您需要做的只是将一些汇总信息添加到报表中，直接从数据库中取出，那么水晶报表就可以满足您的需求。不确定其他人。

# optimization - 将 3D 数学转换为 SSE 或其他 SIMD 的速度提高了多少？

> ID：115291
> 
> 赞同：10
> 
> 时间：2008-09-22T14:55:20.323
> 
> 标签：optimization, x86, native, sse, simd

我在我的应用程序中广泛使用 3D 数学。通过将我的向量/矩阵库转换为 SSE、AltiVec 或类似的 SIMD 代码，我可以实现多少加速？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-12-22T13:20:27.077

*根据我的经验，我通常会看到从 x87 到 SSE 的算法改进*了 3 倍，而在使用 VMX/Altivec 时改进了 5 倍以上（因为与管道深度、调度等有关的复杂问题）。但我通常只在我有数百或数千个数字要操作的情况下这样做，而不是对于那些我一次只做一个向量的情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-25T04:11:29.240

这还不是全部，但可以使用 SIMD 进行进一步优化，请查看 Miguel 在[PDC 2008](http://channel9.msdn.com/pdc2008/PC54/)上关于何时使用 MONO 实现 SIMD 指令的演示文稿，

[![SIMD 在这种特殊配置中胜过双打。](https://i.stack.imgur.com/7iS3h.png)](https://i.stack.imgur.com/7iS3h.png)
[（来源：[tirania.org](http://tirania.org/tmp/xpqetp.png)）]

[图片来自 Miguel 的博客条目。](http://tirania.org/blog/archive/2008/Nov-03.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-09T13:05:47.830

对于一些非常粗略的数字：我听说[ompf.org](http://ompf.org)上的一些人声称某些手动优化的光线追踪程序的速度提高了 10 倍。我也有一些很好的加速。根据问题，我估计我的例程在 2 倍到 6 倍之间，其中许多都有一些不必要的存储和负载。如果您的代码中有大量分支，请忘记它，但对于自然数据并行的问题，您可以做得很好。

但是，我应该补充一点，您的算法应该设计用于数据并行执行。这意味着如果您有一个如您所提到的通用数学库，那么它应该采用打包向量而不是单个向量，否则您只会浪费时间。

例如类似的东西

```
命名空间 SIMD {
类 PackedVec4d
{
  __m128 x;
  __m128 是；
  __m128 z;
  __m128 w;

  //...
};
}
```

大多数**性能很重要的问题**都可以并行化，因为您很可能会使用大型数据集。您的问题对我来说听起来像是过早优化的情况。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-10-03T16:56:45.183

对于 3D 操作，请注意 W 组件中未初始化的数据。我已经看到由于 W 中的数据错误，SSE ops (_mm_add_ps) 需要 10 倍正常时间的情况。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-29T10:24:43.400

答案很大程度上取决于图书馆在做什么以及如何使用它。

增益可以从几个百分点到“快几倍”，最容易看到增益的区域是那些您不处理孤立的向量或值，而是必须处理的多个向量或值同样的方法。

另一个领域是当您达到缓存或内存限制时，这同样需要处理大量值/向量。

增益可能最大的领域可能是图像和信号处理、计算模拟以及网格上的一般 3D 数学运算（而不是孤立向量）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T10:41:59.120

这些天来，x86 的所有优秀编译器都默认为 SP 和 DP 浮点数学生成 SSE 指令。只要您正确安排它们，使用这些指令几乎总是比使用本机指令更快，即使对于标量操作也是如此。这会让许多人感到惊讶，他们过去发现 SSE “慢”，并认为编译器无法生成快速的 SSE 标量指令。但是现在，您必须使用开关关闭 SSE 生成并使用 x87。请注意，此时 x87 已被有效弃用，并且可能会从未来的处理器中完全删除。这样做的一个缺点是我们可能会失去在寄存器中执行 80 位 DP 浮点的能力。但共识似乎是，如果您依赖 80 位而不是 64 位 DP 浮点数来获得精度，您应该寻找更精确的容损算法。

上面的一切对我来说都是一个完全的惊喜。这是非常反直觉的。但数据会说话。

* * *

## 回答 #7

> 赞同：-19
> 
> 时间：2008-09-22T14:55:27.033

很可能您只会看到非常小的加速（如果有的话），并且该过程将比预期的更复杂。有关更多详细信息，请参阅Fabian Giesen[的 The Ubiquitous SSE 矢量类](http://www.farbrausch.de/~fg/articles/ubiquitous_sse_vector.html)文章。

> **无处不在的 SSE 向量类：揭穿一个常见的神话**
> 
> **没那么重要**
> 
> 首先，你的向量类对你的程序的性能可能没有你想象的那么重要（如果是，那更有可能是因为你做错了，而不是因为计算效率低下）。不要误会我的意思，它可能会成为整个程序中最常用的类之一，至少在处理 3D 图形时是这样。但是仅仅因为向量操作很常见并不意味着它们会支配你的程序的执行时间。
> 
> **没那么热**
> 
> **不容易**
> 
> **现在不要**
> 
> **永远不会**

# version-control - 你知道一个好的开源版本控制查看器吗？

> ID：115295
> 
> 赞同：6
> 
> 时间：2008-09-22T14:55:36.377
> 
> 标签：version-control, cvs, atlassian-fisheye

我正在寻找像 Atlassian 的[FishEye](http://www.atlassian.com/software/fisheye/)这样的工具。到目前为止，我发现的替代品（如[StatCVS](http://statcvs.sourceforge.net/)、[ViewCVS](http://www.viewvc.org/)或[Bonsai](http://www.mozilla.org/projects/bonsai/)）要么缺乏功能，要么安装和维护起来很痛苦。因此，在使用这些工具之一之前，我想确定我没有错过任何其他好的、易于安装的、支持 cvs 作为 scm 的开源（最好是 java）版本控制查看器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T15:05:50.563

另一个具有存储库浏览功能的 SVN 工具是[Trac](http://trac.edgewall.org/)。这很好，因为除了存储库的浏览器之外，它还有一个显示提交的时间线。它还进行错误跟踪。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T15:30:53.330

[仓库](http://warehouseapp.com)很酷

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T15:00:56.490

还有[CVS Monitor](http://sourceforge.net/projects/cvsmonitor/)，虽然它没有像 FishEye 那么多的功能。

我们使用 ViewCVS 进行存储库浏览。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T15:01:59.387

如果您使用的是 SVN，我强烈推荐[Tortoise SVN](http://tortoisesvn.net/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T15:40:12.080

[ViewVC](http://www.viewvc.org/)是一个很好的开源、基于 Web 的存储库查看器，类似于 FishEye。我知道您已经看过它，而且您是对的，设置起来很麻烦，但是一旦设置好，它就可以在没有任何干预的情况下对我们运行近三年。

# multithreading - 混合 RTOS 和循环执行程序是否有意义？

> ID：115306
> 
> 赞同：8
> 
> 时间：2008-09-22T14:57:08.557
> 
> 标签：multithreading, embedded, rtos

在一个小型嵌入式系统项目中，我们有一些希望在线程中运行的代码，因此我们选择在嵌入式 RTOS (eCos) 之上构建。

以前，我们在 main() 中使用了一个循环执行程序，它驱动每个任务都实现为状态机。对于某些任务，我们遇到了需要将任务分解为许多细粒度状态的问题，从而使代码更加复杂。

当切换到 RTOS 时，我们发现如果我们将每个单独的任务分配给它自己的线程，每个线程堆栈的内存使用量会迅速增加。（我们只有 64k 并且需要用于通信缓冲区的内存）

我们正在考虑为我们的通信任务使用一个线程，并为循环执行程序使用另一个线程。循环执行器将驱动其他逻辑任务。

**像这样混合 RTOS 和循环执行是否有意义？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T15:01:36.580

这是一个完全有效的设计。
在我们的一个产品中，我们使用了类似的设计，其中异步 I/O 通道（TCP/IP，2 个串行流）在它们自己的任务中，我们有一个“主要”任务负责多个功能领域.

将任务视为简单的分区机制，可让您简化设计。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T20:21:51.677

是的，在一个运行多个“任务”的操作系统线程中拥有一个循环执行程序是有意义的。事实上，除非两个任务与调度需求冲突（一个需要阻塞，一个优先级高于另一个，低优先级的一个需要很长时间才能执行等），否则我建议将它们放在同一个线程中。

在您使用没有内存保护的轻量级 RTOS 的情况下尤其如此：单独的线程并不比一个线程更安全（没有地址空间的 MMU 保护），事实上它们可能更危险，因为对并发保护的需求更大。即使您的 IPC 方案是健壮的并且不易被程序员误用，它的开销通常也不为零，因此避免使用它可以带来性能提升。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-18T11:14:14.807

如果您[查看 FreeRTOS](http://www.freertos.org/croutine.html)，它们实际上在任务中运行另一个调度程序，有点:)

为了呼应其他人，设计中没有任何问题。如果有明确的方式来表达某种东西，那么没有理由（某些）你的任务不能成为状态机。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T16:50:11.063

这是一个有效的设计，但我认为我完全错过了拥有操作系统的原因。

您打算使用操作系统的哪些功能？

从可用信息看来，您最终会将任务的复杂性转移到新的主循环中。

# python - 如何在 Python 中使用 WSDL (SOAP) Web 服务？

> ID：115316
> 
> 赞同：130
> 
> 时间：2008-09-22T14:58:53.873
> 
> 标签：python, web-services, soap

我想在 Python 中使用基于 WSDL SOAP 的 Web 服务。我查看了[Dive Into Python](http://web.archive.org/web/20181001011217/http://www.diveintopython.net/soap_web_services/)代码，但 SOAPpy 模块在 Python 2.5 下不起作用。

我曾尝试使用部分有效的[suds](https://fedorahosted.org/suds)，但会与某些类型中断（suds.TypeNotFound：找不到类型：'item'）。

我也看过[Client](http://trac.optio.webfactional.com/wiki)但这似乎不支持 WSDL。

我看过[ZSI](http://pywebsvcs.sourceforge.net/zsi.html)，但它看起来非常复杂。有没有人有任何示例代码？

WSDL 是[https://ws.pingdom.com/soap/PingdomAPI.wsdl](https://ws.pingdom.com/soap/PingdomAPI.wsdl)并且可以与 PHP 5 SOAP 客户端一起正常工作。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2010-05-13T19:02:39.243

我建议你看看[SUDS](https://fedorahosted.org/suds/)

“Suds 是一个用于使用 Web 服务的轻量级 SOAP python 客户端。”

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2016-04-28T09:33:04.593

有一个相对较新的库，它非常有前途，尽管文档仍然很差，但看起来非常干净和 pythonic：[python zeep](https://github.com/mvantellingen/python-zeep)。

另请参阅[此答案](https://stackoverflow.com/a/36892846/204634)以获取示例。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2014-12-04T19:13:20.773

我最近偶然发现了同样的问题。这是我的解决方案的概要：

**需要的基本组成代码块**

以下是您的客户端应用程序所需的基本代码块

1.  会话请求部分：请求与提供者的会话
2.  会话身份验证部分：向提供者提供凭据
3.  客户端部分：创建客户端
4.  安全标头部分：将 WS-Security 标头添加到客户端
5.  消费部分：根据需要消费可用的操作（或方法）

**你需要什么模块？**

许多人建议使用 Python 模块，例如 urllib2 ；然而，没有一个模块可以工作——至少对于这个特定的项目是这样。

因此，这是您需要获取的模块列表。首先，您需要从以下链接下载并安装最新版本的 suds：

> pypi.python.org/pypi/suds-jurko/0.4.1.jurko.2

此外，您需要分别从以下链接下载和安装 requests 和 suds_requests 模块（免责声明：我是新来这里发布的，所以我现在不能发布多个链接）。

> pypi.python.org/pypi/requests
> 
> pypi.python.org/pypi/suds_requests/0.1

成功下载并安装这些模块后，您就可以开始使用了。

**编码**

按照前面概述的步骤，代码如下所示： 导入：

```
import logging
from suds.client import Client
from suds.wsse import *
from datetime import timedelta,date,datetime,tzinfo
import requests
from requests.auth import HTTPBasicAuth
import suds_requests 
```

会话请求和身份验证：

```
username=input('Username:')
password=input('password:')
session = requests.session()
session.auth=(username, password) 
```

创建客户端：

```
client = Client(WSDL_URL, faults=False, cachingpolicy=1, location=WSDL_URL, transport=suds_requests.RequestsTransport(session)) 
```

添加 WS-Security 标头：

```
...
addSecurityHeader(client,username,password)
....

def addSecurityHeader(client,username,password):
    security=Security()
    userNameToken=UsernameToken(username,password)
    timeStampToken=Timestamp(validity=600)
    security.tokens.append(userNameToken)
    security.tokens.append(timeStampToken)
    client.set_options(wsse=security) 
```

请注意，此方法创建图 1 中描述的安全标头。因此，您的实现可能会有所不同，具体取决于您正在使用的服务的所有者提供的正确安全标头格式。

消费相关方法（或操作）：

```
result=client.service.methodName(Inputs) 
```

**记录**：

此类实现中的最佳实践之一是记录以查看通信是如何执行的。万一出现问题，它使调试变得容易。以下代码执行基本日志记录。但是，除了代码中描述的内容之外，您还可以记录通信的许多方面。

```
logging.basicConfig(level=logging.INFO) 
logging.getLogger('suds.client').setLevel(logging.DEBUG) 
logging.getLogger('suds.transport').setLevel(logging.DEBUG) 
```

**结果：**

这是我的情况的结果。请注意，服务器返回 HTTP 200。这是 HTTP 请求响应的标准成功代码。

```
(200, (collectionNodeLmp){
   timestamp = 2014-12-03 00:00:00-05:00
   nodeLmp[] = 
      (nodeLmp){
         pnodeId = 35010357
         name = "YADKIN"
         mccValue = -0.19
         mlcValue = -0.13
         price = 36.46
         type = "500 KV"
         timestamp = 2014-12-03 01:00:00-05:00
         errorCodeId = 0
      },
      (nodeLmp){
         pnodeId = 33138769
         name = "ZION 1"
         mccValue = -0.18
         mlcValue = -1.86
         price = 34.75
         type = "Aggregate"
         timestamp = 2014-12-03 01:00:00-05:00
         errorCodeId = 0
      },
 }) 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2017-04-22T18:56:26.160

Zeep 是一个不错的 Python SOAP 库，符合您的要求：[http ://docs.python-zeep.org](http://docs.python-zeep.org)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-22T15:55:07.233

Right now (as of 2008), all the SOAP libraries available for Python suck. I recommend avoiding SOAP if possible. The last time we where forced to use a SOAP web service from Python, we wrote a wrapper in C# that handled the SOAP on one side and spoke COM out the other.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-11-07T11:54:38.630

我会定期为此寻找令人满意的答案，但到目前为止还没有运气。我使用soapUI +请求+体力劳动。

*上次我需*要这样做时我放弃并使用了 Java ，并且在我最后一次*想*要这样做时简单地放弃了几次，但这并不是必需的。

去年通过 Project Place 的 RESTful API 成功使用 requests 库后，我突然想到，也许我可以手动滚动我想以类似方式发送的 SOAP 请求。

事实证明这并不太难，但它既*费时*又容易出错，尤其是如果字段名称不一致（我今天正在处理的有'jobId'，JobId'和'JobID'。我使用soapUI加载WSDL，以便更容易提取端点等并执行一些手动测试。到目前为止，我很幸运没有受到我正在使用的任何 WSDL 更改的影响。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-22T19:38:22.360

这不是真的 SOAPpy 不适用于 Python 2.5 - 它可以工作，尽管它非常简单并且非常非常基本。如果您想与任何更复杂的 Web 服务交谈，ZSI 是您唯一的朋友。

我发现的真正有用的演示位于[http://www.ebi.ac.uk/Tools/webservices/tutorials/python](http://www.ebi.ac.uk/Tools/webservices/tutorials/python) - 这确实帮助我理解了 ZSI 的工作原理。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-04-02T16:33:07.007

SOAPpy 现在已经过时了，AFAIK 被 ZSL 取代。这是一个有争议的问题，因为我无法在 Python 2.5 或 Python 2.6 上让任何一个工作，更不用说编译了

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-01-19T11:13:16.103

如果您自己动手，我强烈建议您查看[http://effbot.org/zone/element-soap.htm](http://effbot.org/zone/element-soap.htm)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-03-23T16:06:36.997

```
#!/usr/bin/python
# -*- coding: utf-8 -*-
# consume_wsdl_soap_ws_pss.py
import logging.config
from pysimplesoap.client import SoapClient

logging.config.dictConfig({
    'version': 1,
    'formatters': {
        'verbose': {
            'format': '%(name)s: %(message)s'
        }
    },
    'handlers': {
        'console': {
            'level': 'DEBUG',
            'class': 'logging.StreamHandler',
            'formatter': 'verbose',
        },
    },
    'loggers': {
        'pysimplesoap.helpers': {
            'level': 'DEBUG',
            'propagate': True,
            'handlers': ['console'],
        },
    }
})

WSDL_URL = 'http://www.webservicex.net/stockquote.asmx?WSDL'
client = SoapClient(wsdl=WSDL_URL, ns="web", trace=True)
client['AuthHeaderElement'] = {'username': 'someone', 'password': 'nottelling'}

#Discover operations
list_of_services = [service for service in client.services]
print(list_of_services)

#Discover params
method = client.services['StockQuote']

response = client.GetQuote(symbol='GOOG')
print('GetQuote: {}'.format(response['GetQuoteResult'])) 
```

# c# - 如何解释错误'客户端找到'text / html'的响应内容类型..

> ID：115319
> 
> 赞同：29
> 
> 时间：2008-09-22T14:59:32.717
> 
> 标签：c#, web-services, soap

我正在使用 C# 并通过自动生成的 C# 代理对象连接到 WebService。我调用的方法可能会运行很长时间，有时会超时。我得到不同的错误，有时我得到 a`System.Net.WebException`或 a `System.Web.Services.Protocols.SoapException`。这些异常具有我可以查询的属性，以查找特定类型的错误，我可以从中向用户显示对人类友好的版本。

但有时我只是得到一个`InvalidOperationException`，它有以下消息。有什么方法可以解释这是什么，而无需通过字符串挖掘我认识的东西，感觉很脏，并且与国际化无关，错误消息可能会以不同的语言返回。

```
Client found response content type of 'text/html; charset=utf-8', but expected 'text/xml'.
The request failed with the error message:
--
<html>
    <head>
    <title>Request timed out.</title>
                        <style>
         body {font-family:"Verdana";font-weight:normal;font-size: .7em;color:black;} 
         p {font-family:"Verdana";font-weight:normal;color:black;margin-top: -5px}
         b {font-family:"Verdana";font-weight:bold;color:black;margin-top: -5px}
         H1 { font-family:"Verdana";font-weight:normal;font-size:18pt;color:red }
         H2 { font-family:"Verdana";font-weight:normal;font-size:14pt;color:maroon }
         pre {font-family:"Lucida Console";font-size: .9em}
         .marker {font-weight: bold; color: black;text-decoration: none;}
         .version {color: gray;}
         .error {margin-bottom: 10px;}
         .expandable { text-decoration:underline; font-weight:bold;     color:navy;         cursor:hand; }
        </style>
    </head>

    <body bgcolor="white">

            <span><H1>Server Error in '/PerformanceManager' Application.<hr     width=100% size=1 color=silver></H1>

            <h2> <i>Request timed out.</i> </h2></span>

            <font face="Arial, Helvetica, Geneva, SunSans-Regular, sans-serif ">

            <b> Description: </b>An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.

            <br><br>

            <b> Exception Details: </b>System.Web.HttpException: Request timed out.<br><br>

            <b>Source Error:</b> <br><br>

            <table width=100% bgcolor="#ffffcc">
               <tr>
                  <td>
                      <code>

An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.</code>

                  </td>
               </tr>
            </table>

            <br>

            <b>Stack Trace:</b> <br><br>

            <table width=100% bgcolor="#ffffcc">
                   <tr>
                  <td>
                      <code><pre>

[HttpException (0x80004005): Request timed out.]
</pre></code>

                  </td>
               </tr>
            </table>

            <br>

            <hr width=100% size=1 color=silver>

            <b>Version Information:</b> Microsoft .NET Framework Version:2.0.50727.312; ASP.NET Version:2.0.50727.833

            </font>

    </body>
</html>
<!-- 
[HttpException]: Request timed out.
-->
--. 
```

编辑：我对网络服务器上的方法进行了尝试。我已经调试过了，web-server 方法返回（大约一分钟后）没有任何异常。我还在 Web 服务中添加了一个未处理的异常处理程序，并且没有命中断点。Web 服务返回后，我会在客户端收到此错误，而不是我预期的结果。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-22T16:44:54.257

发生这种情况是因为您的 Web 服务中存在未处理的异常，并且 .NET 运行时正在吐出其 HTML 黄屏死机服务器错误/异常转储页面，而不是 XML。

由于您的 Web 服务的使用者期望的是 text/xml 标头，但得到的是 text/html，因此它会引发该错误。

您应该解决超时的原因（也许是一个冗长的 SQL 查询？）。

此外，请查看 Jeff Atwood 博客上的[这篇博客文章](http://blog.codinghorror.com/throwing-better-soap-exceptions/)，该文章解释了实现全局未处理异常处理程序和使用 SOAP 异常。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-22T15:03:20.180

这意味着您的消费者期望来自 Web 服务的 XML，但正如您的错误所示，Web 服务返回 HTML，因为它由于超时而失败。

因此，您需要与远程 Web 服务提供商交谈，让他们知道它正在失败并采取纠正措施。除非您是 Web 服务的提供者，在这种情况下，您应该捕获异常并返回 XML，告诉消费者发生了哪个错误（“远程提供者”也应该这样做）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-06-01T21:00:01.460

If you are using .NET version 4.0\. the validateRequestion is turned on by default for all the pages. in previous versions 1.1 and 2.0 it was only for aspx page. You can turn the default validation off. In that case you have to do the due diligence and make sure that the data is clean. Use HtmlEncode. Do the following to turn the validation off

In the web.config add the following lines for system.web

```
 <httpRuntime requestValidationMode="2.0" /> 
```

and

```
 <pages validateRequest="false" /> 
```

You can read more about this [http://www.asp.net/learn/whitepapers/aspnet4/breaking-changes](http://www.asp.net/learn/whitepapers/aspnet4/breaking-changes) also [http://msdn.microsoft.com/en-us/library/ff649310.aspx](http://msdn.microsoft.com/en-us/library/ff649310.aspx)

Hope this helps.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-22T16:53:53.550

网络服务器返回一个 http 500 错误代码。这些错误通常发生在网络服务器上抛出异常并且没有逻辑捕获它因此它会吐出 http 500 错误时。您通常可以通过在代码中放置 try-catch 块来解决问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-06-20T11:20:15.617

由于 web.config 中的配置错误，我发生了这种情况。检查连接字符串等可能是超时的答案。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-06-12T10:47:51.610

删除 web.config 文件并重新插入。[http://forums.asp.net/post/916808.aspx](http://forums.asp.net/post/916808.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-04T14:52:30.673

您的网络服务是否在 IIS 中正确配置？其使用的池，ASP.NET（2.0）的版本设置？你能浏览.asmx 吗？

谈到异常，请尝试在访问您的 Web 服务的行中放置一个 try-catch 块。放置并捕获（System.Web.Services.Protocolos.SoapException）。

此外，您可以为 Web 服务对象设置超时。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-11-24T12:03:55.183

更改 Web 服务返回类型和[SoapDocumentMethod](https://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapdocumentmethodattribute.oneway(v=vs.110).aspx)后出现此错误。

最初是：

```
[WebMethod]
public int Foo()
{
    return 0;
} 
```

我决定让它[着火并忘记](https://stackoverflow.com/questions/1541555/asp-net-fire-and-forget-one-way-web-service)这样的类型：

```
[SoapDocumentMethod(OneWay = true)]
[WebMethod]
public void Foo()
{
    return;
} 
```

在这种情况下，更新网络参考会有所帮助。

要更新 Web 服务引用：

*   展开解决方案资源管理器
*   查找**Web 引用**- 只有在您的项目中添加了 Web 服务引用时才会显示此内容
*   右键单击并单击更新网络参考

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-08-15T20:51:57.960

我遇到的问题与 SOAP 版本有关。该`asmx`服务被配置为接受 1.1 和 1.2 这两个版本，因此，我认为当您使用该服务时，客户端或服务器不知道解析哪个版本。

要解决这个问题，有必要添加：

```
using (wsWebService yourService = new wsWebService())
{
    yourService.Url = "https://myUrlService.com/wsWebService.asmx?op=someOption";
    yourService.UseDefaultCredentials = true; // this line depends on your authentication type
    yourService.SoapVersion = SoapProtocolVersion.Soap11; // asign the version of SOAP
    var result = yourService.SomeMethod("Parameter");
} 
```

`wsWebService`作为参考生成的类的名称在哪里。

# c# - 如何在 C# 中进行数据绑定？

> ID：115328
> 
> 赞同：36
> 
> 时间：2008-09-22T15:01:38.173
> 
> 标签：c#, winforms, data-binding

我有以下课程

```
公共级汽车
{
   公共名称{get; 放;}
}

```

我想以编程方式将此绑定到文本框。

我怎么做？

在黑暗中拍摄：

```
...
汽车 car = new Car();
TextEdit 编辑框 = new TextEdit();
editBox.DataBinding.Add("名称", car, "汽车 - 名称");
...

```

我收到以下错误

> “无法绑定到目标控件上的属性‘名称’。

我做错了什么，我应该怎么做？我发现来自网络开发的数据绑定概念有点难以掌握。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-09-22T15:05:02.097

你要

```
editBox.DataBindings.Add("Text", car, "Name"); 
```

第一个参数是要绑定的控件的属性名称，第二个是数据源，第三个参数是要绑定到的数据源的属性。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-22T15:04:45.543

不看语法，我很确定它是：

```
editBox.DataBinding.Add("Text", car, "Name"); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-22T15:07:01.873

```
editBox.DataBinding.Add("Text", car, "Name"); 
```

第一个 arg 是控件属性的名称，第二个是要绑定的对象，最后一个是要用作数据源的对象属性的名称。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-22T15:17:56.183

您非常接近数据绑定行

```
editBox.DataBinding.Add("Text", car, "Name"); 
```

第一个参数是将数据绑定的编辑框对象的属性。第二个参数是要绑定的数据源，最后一个参数是要绑定的数据源的属性。

请记住，数据绑定是一种方式，因此如果您更改编辑框，则汽车对象会更新，但如果您直接更改汽车名称，则不会更新编辑框。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-22T15:05:08.320

尝试：

```
editBox.DataBinding.Add( "Text", car", "Name" ); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-22T15:06:18.427

我相信

`editBox.DataBindings.Add(new Binding("Text", car, "Name"));`

应该做的伎俩。没试过，但我认为是这样的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T15:04:51.470

您正在尝试绑定到 TextEdit 控件的“名称”。该名称用于以编程方式访问控件，不能绑定。您应该对控件的文本进行绑定。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-07-08T06:03:44.847

使用 C# 4.6 语法：

```
editBox.DataBinding.Add(nameof(editBox.Text), car, nameof(car.Name)); 
```

如果 car 为 null，则上述代码将以比使用文字字符串表示`datamember`of更明显的方式失败`car`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-10-03T13:32:09.350

以下是可用作属性的泛型类，并实现了绑定控件使用的 INotifyPropertyChanged 来捕获属性值的变化。

```
public class NotifyValue<datatype> : INotifyPropertyChanged 
{
    public event PropertyChangedEventHandler PropertyChanged = delegate { };

    datatype _value;
    public datatype Value
    {
        get
        {
            return _value;
        }
        set
        {
            _value = value;
            PropertyChanged.Invoke(this, new PropertyChangedEventArgs("Value"));
        }
    }

} 
```

可以这样声明：

```
public NotifyValue<int> myInteger = new NotifyValue<int>(); 
```

并分配给这样的文本框

```
Textbox1.DataBindings.Add(
    "Text", 
    this, 
    "myInteger.Value", 
    false, 
    DataSourceUpdateMode.OnPropertyChanged
); 
```

..其中“Text”是文本框的属性，“this”是当前的 Form 实例。

类不必继承 INotifyPropertyChanged 类。声明 System.ComponentModel.PropertyChangedEventHandler 类型的事件后，控件数据绑定器将订阅类更改事件

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-09-12T03:04:40.993

它是

```
 this.editBox.DataBindings.Add(new Binding("Text", car, "Name")); 
```

# sms - 处理传入 SMS 消息的最佳方式是什么？

> ID：115361
> 
> 赞同：2
> 
> 时间：2008-09-22T15:06:30.423
> 
> 标签：sms, messaging

我有一个客户想要一个解决方案，允许送货人员发送短信（SMS 消息），因为他们已经在特定位置完成了取货。我正在寻找的是读取绑定 SMS 消息或 SMS 组件（如果合适）的代码。这将允许我创建一个 Windows 服务来读取消息并相应地更新 SQL 记录。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T15:09:22.537

可能不是您正在寻找的东西，但一种方法是使用像[iTagg](http://www.itagg.com)这样的网关，它为开发人员提供了许多接口来发送和接收 SMS/MMS 等。根据您的位置，iTagg 可能没有用，但我是确保您所在地区会有等价物。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-15T14:55:21.397

前一段时间，我使用 GSM 调制解调器实现了类似的功能。我认为大多数 GSM 调制解调器都提供 AT 命令，可用于接收和发送 SMS 消息。当时，我使用了一个 Java 库，它提供了一个易于使用的 API。读取和发送 SMS 的命令非常简单，但我敢打赌 .Net 中有一些东西可以用于此目的，可以使任务更加轻松。

我做了一点搜索，发现这篇[文章](http://twit88.com/blog/2007/09/22/use-the-net-sms-library-to-retrieve-phone-settings/)有一个使用 AT 命令与 GSM 手机交互的示例。我查看了提供的源代码，它包含一个库，其中包含与 SMS 相关的操作。

在我之前的项目中，我使用了带有 RS232 接口的 Siemens GSM 调制解调器。它不是很昂贵，并且能够管理放置在车辆中的车载单元发送的所有消息。但是，如果您有一部未使用的手机，它也可以使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T15:41:55.407

谢谢卢克，我想更多的是连接到服务器的 GSM 调制解调器。我认为这将给予更多控制而不是通过第三方，但我同意你的观点并将进一步调查。

# database - Do you use source control for your database items?

> ID：115369
> 
> 赞同：608
> 
> 时间：2008-09-22T15:07:33.273
> 
> 标签：database, version-control

I feel that my shop has a hole because we don't have a solid process in place for versioning our database schema changes. We do a lot of backups so we're more or less covered, but it's bad practice to rely on your last line of defense in this way.

Surprisingly, this seems to be a common thread. Many shops I have spoken to ignore this issue because their databases don't change often, and they basically just try to be meticulous.

However, I know how that story goes. It's only a matter of time before things line up just wrong and something goes missing.

Are there any best practices for this? What are some strategies that have worked for you?

* * *

## 回答 #1

> 赞同：395
> 
> 时间：2008-09-22T15:09:55.827

Must read [Get your database under version control](http://blog.codinghorror.com/get-your-database-under-version-control/). Check the series of posts by K. Scott Allen.

> When it comes to version control, the database is often a second or even third-class citizen. From what I've seen, teams that would never think of writing code without version control in a million years-- and rightly so-- can somehow be completely oblivious to the need for version control around the critical databases their applications rely on. I don't know how you can call yourself a software engineer and maintain a straight face when your database isn't under exactly the same rigorous level of source control as the rest of your code. Don't let this happen to you. Get your database under version control.

* * *

## 回答 #2

> 赞同：136
> 
> 时间：2008-09-22T15:09:22.053

The databases themselves? No

The scripts that create them, including static data inserts, stored procedures and the like; of course. They're text files, they are included in the project and are checked in and out like everything else.

Of course in an ideal world your database management tool would do this; but you just have to be disciplined about it.

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-09-22T15:10:19.227

I absolutely love Rails ActiveRecord migrations. It abstracts the DML to ruby script which can then be easily version'd in your source repository.

However, with a bit of work, you could do the same thing. Any DDL changes (ALTER TABLE, etc.) can be stored in text files. Keep a numbering system (or a date stamp) for the file names, and apply them in sequence.

Rails also has a 'version' table in the DB that keeps track of the last applied migration. You can do the same easily.

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2008-09-22T18:12:38.087

Check out [LiquiBase](http://www.liquibase.org) for managing database changes using source control.

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2008-09-22T15:15:37.280

You should never just log in and start entering "ALTER TABLE" commands to change a production database. The project I'm on has database on every customer site, and so every change to the database is made in two places, a dump file that is used to create a new database on a new customer site, and an update file that is run on every update which checks your current database version number against the highest number in the file, and updates your database in place. So for instance, the last couple of updates:

```
if [ $VERSION \< '8.0.108' ] ; then
  psql -U cosuser $dbName << EOF8.0.108
    BEGIN TRANSACTION;
    --
    -- Remove foreign key that shouldn't have been there.
    -- PCR:35665
    --
    ALTER TABLE     migratorjobitems
    DROP CONSTRAINT migratorjobitems_destcmaid_fkey;
    -- 
    -- Increment the version
    UPDATE          sys_info
    SET             value = '8.0.108'
    WHERE           key = 'DB VERSION';
    END TRANSACTION;
EOF8.0.108
fi

if [ $VERSION \< '8.0.109' ] ; then
  psql -U cosuser $dbName << EOF8.0.109
    BEGIN TRANSACTION;
    --
    -- I missed a couple of cases when I changed the legacy playlist
    -- from reporting showplaylistidnum to playlistidnum
    --
    ALTER TABLE     featureidrequestkdcs
    DROP CONSTRAINT featureidrequestkdcs_cosfeatureid_fkey;
    ALTER TABLE     featureidrequestkdcs
    ADD CONSTRAINT  featureidrequestkdcs_cosfeatureid_fkey
    FOREIGN KEY     (cosfeatureid)
    REFERENCES      playlist(playlistidnum)
    ON DELETE       CASCADE;
    --
    ALTER TABLE     ticket_system_ids
    DROP CONSTRAINT ticket_system_ids_showplaylistidnum_fkey;
    ALTER TABLE     ticket_system_ids
    RENAME          showplaylistidnum
    TO              playlistidnum;
    ALTER TABLE     ticket_system_ids
    ADD CONSTRAINT  ticket_system_ids_playlistidnum_fkey
    FOREIGN KEY     (playlistidnum)
    REFERENCES      playlist(playlistidnum)
    ON DELETE       CASCADE;
    -- 
    -- Increment the version
    UPDATE          sys_info
    SET             value = '8.0.109'
    WHERE           key = 'DB VERSION';
    END TRANSACTION;
EOF8.0.109
fi 
```

I'm sure there is a better way to do this, but it's worked for me so far.

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-09-22T15:12:50.173

Yes. Code is code. My rule of thumb is that I need to **be able to build and deploy the application from scratch**, without looking at a development or production machine.

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-09-22T15:11:58.273

The best practice I have seen is creating a build script to scrap and rebuild your database on a staging server. Each iteration was given a folder for database changes, all changes were scripted with "Drop... Create" 's . This way you can rollback to an earlier version at any time by pointing the build to folder you want to version to.

I believe this was done with NaNt/CruiseControl.

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-09-22T15:11:40.207

YES, I think it is important to version your database. Not the data, but the schema for certain.

In Ruby On Rails, this is handled by the framework with "migrations". Any time you alter the db, you make a script that applies the changes and check it into source control.

My shop liked that idea so much that we added the functionality to our Java-based build [using shell scripts](https://stackoverflow.com/questions/101868/rails-like-database-migrations#104903) and Ant. We integrated the process into our deployment routine. It would be fairly easy to write scripts to do the same thing in other frameworks that don't support DB versioning out-of-the-box.

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-11-30T01:25:49.803

The new Database projects in Visual Studio provide source control and change scripts.

They have a nice tool that compares databases and can generate a script that converts the schema of one into the other, or updates the data in one to match the other.

The db schema is "shredded" to create many, many small .sql files, one per DDL command that describes the DB.

+tom

* * *

Additional info 2008-11-30

I have been using it as a developer for the past year and really like it. It makes it easy to compare my dev work to production and generate a script to use for the release. I don't know if it is missing features that DBAs need for "enterprise-type" projects.

Because the schema is "shredded" into sql files the source control works fine.

One gotcha is that you need to have a different mindset when you use a db project. The tool has a "db project" in VS, which is just the sql, plus an automatically generated local database which has the schema and some other admin data -- but none of your application data, plus your local dev db that you use for app data dev work. You rarely are aware of the automatically generated db, but you have to know its there so you can leave it alone :). This special db is clearly recognizable because it has a Guid in its name,

The VS DB Project does a nice job of integrating db changes that other team members have made into your local project/associated db. but you need to take the extra step to compare the project schema with your local dev db schema and apply the mods. It makes sense, but it seems awkward at first.

DB Projects are a very powerful tool. They not only generate scripts but can apply them immediately. Be sure not to destroy your production db with it. ;)

I really like the VS DB projects and I expect to use this tool for all my db projects going forward.

+tom

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2015-09-07T10:43:12.873

Requiring the development teams to use an SQL database source control management system isn’t the magic bullet which will prevent issues from happening. On its own, database source control introduces additional overhead as the developers are required to save the changes they’ve made to an object in a separate SQL script, open the source control system client, check in the SQL script file using the client and then apply the changes to the live database.

I can suggest using the SSMS add-in called [ApexSQL Source Control](https://www.apexsql.com/sql_tools_source_control.aspx). It allows developers to easily map database objects with the source control system via the wizard directly from SSMS. The add-in includes support for TFS, Git, Subversion and other SC systems. It also includes support for source controlling Static data.

After downloading and installing ApexSQL Source Control, simply right-click the database you want to version control and navigate to ApexSQL Source Control sub-menu in SSMS. Click the Link database to source control option, select the source control system and the development model. After that you’ll need to provide the log-in information and the repository string for the source control system you’ve chosen.

You can read this article for more information: [http://solutioncenter.apexsql.com/sql-source-control-reduce-database-development-time/](http://solutioncenter.apexsql.com/sql-source-control-reduce-database-development-time/)

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-09-22T15:09:55.623

I do by saving create/update scripts and a script that generates sampledata.

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-09-22T15:10:35.747

Yes, we do it by keeping our SQL as part of our build -- we keep DROP.sql, CREATE.sql, USERS.sql, VALUES.sql and version control these, so we can revert back to any tagged version.

We also have ant tasks which can recreate the db whenever needed.

Plus, the SQL is then tagged along with your source code that goes with it.

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2008-09-22T15:13:23.683

The most successful scheme I've ever used on a project has combined backups and differential SQL files. Basically we would take a backup of our db after every release and do an SQL dump so that we could create a blank schema from scratch if we needed to as well. Then anytime you needed to make a change to the DB you would add an alter scrip to the sql directory under version control. We would always prefix a sequence number or date to the file name so the first change would be something like 01_add_created_on_column.sql, and the next script would be 02_added_customers_index. Our CI machine would check for these and run them sequentially on a fresh copy of the db that had been restored from the backup.

We also had some scripts in place that devs could use to re-initialize their local db to the current version with a single command.

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2008-09-22T15:25:38.067

We do source control all our dabase created objects. And just to keep developers honest (because you can create objects without them being in Source Control), our dbas periodically look for anything not in source control and if they find anything, they drop it without asking if it is ok.

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-05-22T05:04:44.023

I use [SchemaBank](https://web.archive.org/web/20090721222904/http://schemabank.com/) to version control all my database schema changes:

*   from day 1, I import my db schema dump into it
*   i started to change my schema design using a web browser (because they are SaaS / cloud-based)
*   when i want to update my db server, i generate the change (SQL) script from it and apply to the db. In Schemabank, they mandate me to commit my work as a version before I can generate an update script. I like this kind of practice so that I can always trace back when I need to.

Our team rule is NEVER touch the db server directly without storing the design work first. But it happens, somebody might be tempted to break the rule, in sake of convenient. We would import the schema dump again into schemabank and let it do the diff and bash someone if a discrepancy is found. Although we could generate the alter scripts from it to make our db and schema design in sync, we just hate that.

By the way, they also let us create branches within the version control tree so that I can maintain one for staging and one for production. And one for coding sandbox.

A pretty neat web-based schema design tool with version control n change management.

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-09-22T15:12:45.227

I have everything necessary to recreate my DB from bare metal, minus the data itself. I'm sure there are lots of ways to do it, but all my scripts and such are stored off in subversion and we can rebuild the DB structure and such by pulling all that out of subversion and running an installer.

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-09-22T15:15:38.107

I typically build an SQL script for every change I make, and another to revert those changes, and keep those scripts under version control.

Then we have a means to create a new up-to-date database on demand, and can easily move between revisions. Every time we do a release, we lump the scripts together (takes a bit of manual work, but it's rarely actually *hard*) so we also have a set of scripts that can convert between versions.

Yes, before you say it, this is very similar to the stuff Rails and others do, but it seems to work pretty well, so I have no problems admitting that I shamelessly lifted the idea :)

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2008-09-22T17:30:01.700

I use SQL CREATE scripts exported from MySQL Workbech, then using theirs "Export SQL ALTER" functionality I end up with a series of create scripts(numbered of course) and the alter scripts that can apply the changes between them.

> 3.- Export SQL ALTER script Normally you would have to write the ALTER TABLE statements by hand now, reflecting your changes you made to the model. But you can be smart and let Workbench do the hard work for you. Simply select File -> Export -> Forward Engineer SQL ALTER Script… from the main menu.
> 
> This will prompt you to specify the SQL CREATE file the current model should be compared to.
> 
> Select the SQL CREATE script from step 1\. The tool will then generate the ALTER TABLE script for you and you can execute this script against your database to bring it up to date.
> 
> You can do this using the MySQL Query Browser or the mysql client.Voila! Your model and database have now been synchronized!

Source: [MySQL Workbench Community Edition: Guide to Schema Synchronization](http://dev.mysql.com/workbench/?p=116)

All this scripts of course are inside under version control.

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2008-09-22T20:29:56.637

Yes, always. You should be able to recreate your production database structure with a useful set of sample data whenever needed. If you don't, over time minor changes to keep things running get forgotten then one day you get bitten, big time. Its insurance that you might not think you need but the day you do it it worth the price 10 times over!

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2008-11-03T11:49:11.447

There has been a lot of discussion about the database model itself, but we also keep the required data in .SQL files.

For example, in order to be useful your application might need this in the install:

```
INSERT INTO Currency (CurrencyCode, CurrencyName) 
VALUES ('AUD', 'Australian Dollars');

INSERT INTO Currency (CurrencyCode, CurrencyName) 
VALUES ('USD', 'US Dollars'); 
```

We would have a file called `currency.sql` under subversion. As a manual step in the build process, we compare the previous currency.sql to the latest one and write an upgrade script.

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2009-05-09T20:25:48.170

We version and source control everything surrounding our databases:

*   DDL (create and alters)
*   DML (reference data, codes, etc.)
*   Data Model changes (using ERwin or ER/Studio)
*   Database configuration changes (permissions, security objects, general config changes)

We do all this with automated jobs using Change Manager and some custom scripts. We have Change Manager monitoring these changes and notifying when they are done.

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2009-07-07T13:30:44.510

I believe that every DB should be under source control, and developers should have an easy way to create their local database from scratch. Inspired by Visual Studio for Database Professionals, I've created an open-source tool that scripts MS SQL databases, and provides and easy way of deploying them to your local DB engine. Try [http://dbsourcetools.codeplex.com/](http://dbsourcetools.codeplex.com/) . Have fun, - Nathan.

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2008-09-22T15:11:44.233

I source control the database schema by scripting out all objects (table definitions, indexes, stored procedures, etc.). But, as for the data itself, simply rely on regular backups. This ensures that all structural changes are captured with proper revision history, but doesn't burden the database each time data changes.

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2008-09-22T15:12:55.757

At our business we use database change scripts. When a script is run, it's name is stored in the database and won't run again, unless that row is removed. Scripts are named based on date, time and code branch, so controlled execution is possible.

Lots and lots of testing is done before the scripts are run in the live environment, so "oopsies" only happen, generally speaking, on development databases.

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2008-09-22T15:23:15.950

We're in the process of moving all the databases to source control. We're using sqlcompare to script out the database (a profession edition feature, unfortunately) and putting that result into SVN.

The success of your implementation will depend a lot on the culture and practices of your organization. People here believe in creating a database per application. There is a common set of databases that are used by most applications as well causing a lot of interdatabase dependencies (some of them are circular). Putting the database schemas into source control has been notoriously difficult because of the interdatabase dependencies that our systems have.

Best of luck to you, the sooner you try it out the sooner you'll have your issues sorted out.

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2008-09-22T15:29:35.220

I have used the dbdeploy tool from ThoughtWorks at [http://dbdeploy.com/](http://dbdeploy.com/). It encourages the use of migration scripts. Each release, we consolidated the change scripts into a single file to ease understanding and to allow DBAs to 'bless' the changes.

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2008-09-22T18:13:58.240

This has always been a big annoyance for me too - it seems like it is just way too easy to make a quick change to your development database, save it (forgetting to save a change script), and then you're stuck. You could undo what you just did and redo it to create the change script, or write it from scratch if you want of course too, though that's a lot of time spent writing scripts.

A tool that I have used in the past that has helped with this some is SQL Delta. It will show you the differences between two databases (SQL server/Oracle I believe) and generate all the change scripts necessary to migrate A->B. Another nice thing it does is show all the differences between database content between the production (or test) DB and your development DB. Since more and more apps store configuration and state that is crucial to their execution in database tables, it can be a real pain to have change scripts that remove, add, and alter the proper rows. SQL Delta shows the rows in the database just like they would look in a Diff tool - changed, added, deleted.

An excellent tool. Here is the link: [http://www.sqldelta.com/](http://www.sqldelta.com/)

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2008-09-22T23:06:19.647

RedGate is great, we generate new snapshots when database changes are made (a tiny binary file) and keep that file in the projects as a resource. Whenever we need to update the database, we use RedGate's toolkit to update the database, as well as being able to create new databases from empty ones.

RedGate also makes Data snapshots, while I haven't personally worked with them, they are just as robust.

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2008-09-23T03:08:25.430

FYI This was also brought up a few days ago by Dana ... [Stored procedures/DB schema in source control](https://stackoverflow.com/questions/77172/stored-proceduresdb-schema-in-source-control#77500)

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2009-04-22T13:32:43.617

Here is a sample poor man's solution for a trigger implementing tracking of changes on db objects ( via DDL stateements ) on a sql server 2005 / 2008 database. I contains also a simple sample of how-to enforce the usage of required someValue xml tag in the source code for each sql command ran on the database + the tracking of the current db version and type ( dev , test , qa , fb , prod) One could extend it with additional required attributes such as , etc. The code is rather long - it creates the empty database + the needed tracking table structure + required db functions and the populating trigger all running under a [ga] schema.

```
USE [master]
GO

/****** Object:  Database [DBGA_DEV]    Script Date: 04/22/2009 13:22:01 ******/
CREATE DATABASE [DBGA_DEV] ON  PRIMARY 
( NAME = N'DBGA_DEV', FILENAME = N'D:\GENAPP\DATA\DBFILES\DBGA_DEV.mdf' , SIZE = 3072KB , MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )
 LOG ON 
( NAME = N'DBGA_DEV_log', FILENAME = N'D:\GENAPP\DATA\DBFILES\DBGA_DEV_log.ldf' , SIZE = 6208KB , MAXSIZE = 2048GB , FILEGROWTH = 10%)
GO

ALTER DATABASE [DBGA_DEV] SET COMPATIBILITY_LEVEL = 100
GO

IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [DBGA_DEV].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO

ALTER DATABASE [DBGA_DEV] SET ANSI_NULL_DEFAULT OFF 
GO

ALTER DATABASE [DBGA_DEV] SET ANSI_NULLS OFF 
GO

ALTER DATABASE [DBGA_DEV] SET ANSI_PADDING ON 
GO

ALTER DATABASE [DBGA_DEV] SET ANSI_WARNINGS OFF 
GO

ALTER DATABASE [DBGA_DEV] SET ARITHABORT OFF 
GO

ALTER DATABASE [DBGA_DEV] SET AUTO_CLOSE OFF 
GO

ALTER DATABASE [DBGA_DEV] SET AUTO_CREATE_STATISTICS ON 
GO

ALTER DATABASE [DBGA_DEV] SET AUTO_SHRINK OFF 
GO

ALTER DATABASE [DBGA_DEV] SET AUTO_UPDATE_STATISTICS ON 
GO

ALTER DATABASE [DBGA_DEV] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO

ALTER DATABASE [DBGA_DEV] SET CURSOR_DEFAULT  GLOBAL 
GO

ALTER DATABASE [DBGA_DEV] SET CONCAT_NULL_YIELDS_NULL OFF 
GO

ALTER DATABASE [DBGA_DEV] SET NUMERIC_ROUNDABORT OFF 
GO

ALTER DATABASE [DBGA_DEV] SET QUOTED_IDENTIFIER OFF 
GO

ALTER DATABASE [DBGA_DEV] SET RECURSIVE_TRIGGERS OFF 
GO

ALTER DATABASE [DBGA_DEV] SET  DISABLE_BROKER 
GO

ALTER DATABASE [DBGA_DEV] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO

ALTER DATABASE [DBGA_DEV] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO

ALTER DATABASE [DBGA_DEV] SET TRUSTWORTHY OFF 
GO

ALTER DATABASE [DBGA_DEV] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO

ALTER DATABASE [DBGA_DEV] SET PARAMETERIZATION SIMPLE 
GO

ALTER DATABASE [DBGA_DEV] SET READ_COMMITTED_SNAPSHOT OFF 
GO

ALTER DATABASE [DBGA_DEV] SET HONOR_BROKER_PRIORITY OFF 
GO

ALTER DATABASE [DBGA_DEV] SET  READ_WRITE 
GO

ALTER DATABASE [DBGA_DEV] SET RECOVERY FULL 
GO

ALTER DATABASE [DBGA_DEV] SET  MULTI_USER 
GO

ALTER DATABASE [DBGA_DEV] SET PAGE_VERIFY CHECKSUM  
GO

ALTER DATABASE [DBGA_DEV] SET DB_CHAINING OFF 
GO

EXEC [DBGA_DEV].sys.sp_addextendedproperty @name=N'DbType', @value=N'DEV' 
GO

EXEC [DBGA_DEV].sys.sp_addextendedproperty @name=N'DbVersion', @value=N'0.0.1.20090414.1100' 
GO

USE [DBGA_DEV]
GO
/****** Object:  Schema [ga]    Script Date: 04/22/2009 13:21:29 ******/
CREATE SCHEMA [ga] AUTHORIZATION [dbo]
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Contains the objects of the Generic Application database' , @level0type=N'SCHEMA',@level0name=N'ga'
GO
/****** Object:  Table [ga].[tb_DataMeta_ObjChangeLog]    Script Date: 04/22/2009 13:21:40 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [ga].[tb_DataMeta_ObjChangeLog](
    [LogId] [int] IDENTITY(1,1) NOT NULL,
    [TimeStamp] [timestamp] NOT NULL,
    [DatabaseName] [varchar](256) NOT NULL,
    [SchemaName] [varchar](256) NOT NULL,
    [DbVersion] [varchar](20) NOT NULL,
    [DbType] [varchar](20) NOT NULL,
    [EventType] [varchar](50) NOT NULL,
    [ObjectName] [varchar](256) NOT NULL,
    [ObjectType] [varchar](25) NOT NULL,
    [Version] [varchar](50) NULL,
    [SqlCommand] [varchar](max) NOT NULL,
    [EventDate] [datetime] NOT NULL,
    [LoginName] [varchar](256) NOT NULL,
    [FirstName] [varchar](256) NULL,
    [LastName] [varchar](50) NULL,
    [ChangeDescription] [varchar](1000) NULL,
    [Description] [varchar](1000) NULL,
    [ObjVersion] [varchar](20) NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'The database version as written in the extended prop of the database' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'TABLE',@level1name=N'tb_DataMeta_ObjChangeLog', @level2type=N'COLUMN',@level2name=N'DbVersion'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'dev , test , qa , fb or prod' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'TABLE',@level1name=N'tb_DataMeta_ObjChangeLog', @level2type=N'COLUMN',@level2name=N'DbType'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'The name of the object as it is registered in the sys.objects ' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'TABLE',@level1name=N'tb_DataMeta_ObjChangeLog', @level2type=N'COLUMN',@level2name=N'ObjectName'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'TABLE',@level1name=N'tb_DataMeta_ObjChangeLog', @level2type=N'COLUMN',@level2name=N'Description'
GO
SET IDENTITY_INSERT [ga].[tb_DataMeta_ObjChangeLog] ON
INSERT [ga].[tb_DataMeta_ObjChangeLog] ([LogId], [DatabaseName], [SchemaName], [DbVersion], [DbType], [EventType], [ObjectName], [ObjectType], [Version], [SqlCommand], [EventDate], [LoginName], [FirstName], [LastName], [ChangeDescription], [Description], [ObjVersion]) VALUES (3, N'DBGA_DEV', N'en', N'0.0.1.20090414.1100', N'DEV', N'DROP_TABLE', N'tb_BL_Products', N'TABLE', N' some', N'<EVENT_INSTANCE><EventType>DROP_TABLE</EventType><PostTime>2009-04-22T11:03:11.880</PostTime><SPID>57</SPID><ServerName>YSG</ServerName><LoginName>ysg\yordgeor</LoginName><UserName>dbo</UserName><DatabaseName>DBGA_DEV</DatabaseName><SchemaName>en</SchemaName><ObjectName>tb_BL_Products</ObjectName><ObjectType>TABLE</ObjectType><TSQLCommand><SetOptions ANSI_NULLS="ON" ANSI_NULL_DEFAULT="ON" ANSI_PADDING="ON" QUOTED_IDENTIFIER="ON" ENCRYPTED="FALSE"/><CommandText>drop TABLE [en].[tb_BL_Products] --<Version> some</Version>&#x0D;
</CommandText></TSQLCommand></EVENT_INSTANCE>', CAST(0x00009BF300B6271C AS DateTime), N'ysg\yordgeor', N'Yordan', N'Georgiev', NULL, NULL, N'0.0.0')
INSERT [ga].[tb_DataMeta_ObjChangeLog] ([LogId], [DatabaseName], [SchemaName], [DbVersion], [DbType], [EventType], [ObjectName], [ObjectType], [Version], [SqlCommand], [EventDate], [LoginName], [FirstName], [LastName], [ChangeDescription], [Description], [ObjVersion]) VALUES (4, N'DBGA_DEV', N'en', N'0.0.1.20090414.1100', N'DEV', N'CREATE_TABLE', N'tb_BL_Products', N'TABLE', N' 2.2.2 ', N'<EVENT_INSTANCE><EventType>CREATE_TABLE</EventType><PostTime>2009-04-22T11:03:18.620</PostTime><SPID>57</SPID><ServerName>YSG</ServerName><LoginName>ysg\yordgeor</LoginName><UserName>dbo</UserName><DatabaseName>DBGA_DEV</DatabaseName><SchemaName>en</SchemaName><ObjectName>tb_BL_Products</ObjectName><ObjectType>TABLE</ObjectType><TSQLCommand><SetOptions ANSI_NULLS="ON" ANSI_NULL_DEFAULT="ON" ANSI_PADDING="ON" QUOTED_IDENTIFIER="ON" ENCRYPTED="FALSE"/><CommandText>CREATE TABLE [en].[tb_BL_Products](&#x0D;
    [ProducId] [int] NULL,&#x0D;
    [ProductName] [nchar](10) NULL,&#x0D;
    [ProductDescription] [varchar](5000) NULL&#x0D;
) ON [PRIMARY]&#x0D;
/*&#x0D;
<Version> 2.2.2 </Version>&#x0D;
&#x0D;
*/&#x0D;
</CommandText></TSQLCommand></EVENT_INSTANCE>', CAST(0x00009BF300B62F07 AS DateTime), N'ysg\yordgeor', N'Yordan', N'Georgiev', NULL, NULL, N'0.0.0')
INSERT [ga].[tb_DataMeta_ObjChangeLog] ([LogId], [DatabaseName], [SchemaName], [DbVersion], [DbType], [EventType], [ObjectName], [ObjectType], [Version], [SqlCommand], [EventDate], [LoginName], [FirstName], [LastName], [ChangeDescription], [Description], [ObjVersion]) VALUES (5, N'DBGA_DEV', N'en', N'0.0.1.20090414.1100', N'DEV', N'DROP_TABLE', N'tb_BL_Products', N'TABLE', N' 2.2.2 ', N'<EVENT_INSTANCE><EventType>DROP_TABLE</EventType><PostTime>2009-04-22T11:25:12.620</PostTime><SPID>57</SPID><ServerName>YSG</ServerName><LoginName>ysg\yordgeor</LoginName><UserName>dbo</UserName><DatabaseName>DBGA_DEV</DatabaseName><SchemaName>en</SchemaName><ObjectName>tb_BL_Products</ObjectName><ObjectType>TABLE</ObjectType><TSQLCommand><SetOptions ANSI_NULLS="ON" ANSI_NULL_DEFAULT="ON" ANSI_PADDING="ON" QUOTED_IDENTIFIER="ON" ENCRYPTED="FALSE"/><CommandText>drop TABLE [en].[tb_BL_Products] &#x0D;
</CommandText></TSQLCommand></EVENT_INSTANCE>', CAST(0x00009BF300BC32F1 AS DateTime), N'ysg\yordgeor', N'Yordan', N'Georgiev', NULL, NULL, N'0.0.0')
INSERT [ga].[tb_DataMeta_ObjChangeLog] ([LogId], [DatabaseName], [SchemaName], [DbVersion], [DbType], [EventType], [ObjectName], [ObjectType], [Version], [SqlCommand], [EventDate], [LoginName], [FirstName], [LastName], [ChangeDescription], [Description], [ObjVersion]) VALUES (6, N'DBGA_DEV', N'en', N'0.0.1.20090414.1100', N'DEV', N'CREATE_TABLE', N'tb_BL_Products', N'TABLE', N' 2.2.2 ', N'<EVENT_INSTANCE><EventType>CREATE_TABLE</EventType><PostTime>2009-04-22T11:25:19.053</PostTime><SPID>57</SPID><ServerName>YSG</ServerName><LoginName>ysg\yordgeor</LoginName><UserName>dbo</UserName><DatabaseName>DBGA_DEV</DatabaseName><SchemaName>en</SchemaName><ObjectName>tb_BL_Products</ObjectName><ObjectType>TABLE</ObjectType><TSQLCommand><SetOptions ANSI_NULLS="ON" ANSI_NULL_DEFAULT="ON" ANSI_PADDING="ON" QUOTED_IDENTIFIER="ON" ENCRYPTED="FALSE"/><CommandText>CREATE TABLE [en].[tb_BL_Products](&#x0D;
    [ProducId] [int] NULL,&#x0D;
    [ProductName] [nchar](10) NULL,&#x0D;
    [ProductDescription] [varchar](5000) NULL&#x0D;
) ON [PRIMARY]&#x0D;
/*&#x0D;
<Version> 2.2.2 </Version>&#x0D;
&#x0D;
*/&#x0D;
</CommandText></TSQLCommand></EVENT_INSTANCE>', CAST(0x00009BF300BC3A69 AS DateTime), N'ysg\yordgeor', N'Yordan', N'Georgiev', NULL, NULL, N'0.0.0')
SET IDENTITY_INSERT [ga].[tb_DataMeta_ObjChangeLog] OFF
/****** Object:  Table [ga].[tb_BLSec_LoginsForUsers]    Script Date: 04/22/2009 13:21:40 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [ga].[tb_BLSec_LoginsForUsers](
    [LoginsForUsersId] [int] IDENTITY(1,1) NOT NULL,
    [LoginName] [nvarchar](100) NOT NULL,
    [FirstName] [varchar](100) NOT NULL,
    [SecondName] [varchar](100) NULL,
    [LastName] [varchar](100) NOT NULL,
    [DomainName] [varchar](100) NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
SET IDENTITY_INSERT [ga].[tb_BLSec_LoginsForUsers] ON
INSERT [ga].[tb_BLSec_LoginsForUsers] ([LoginsForUsersId], [LoginName], [FirstName], [SecondName], [LastName], [DomainName]) VALUES (1, N'ysg\yordgeor', N'Yordan', N'Stanchev', N'Georgiev', N'yordgeor')
SET IDENTITY_INSERT [ga].[tb_BLSec_LoginsForUsers] OFF
/****** Object:  Table [en].[tb_BL_Products]    Script Date: 04/22/2009 13:21:40 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [en].[tb_BL_Products](
    [ProducId] [int] NULL,
    [ProductName] [nchar](10) NULL,
    [ProductDescription] [varchar](5000) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  StoredProcedure [ga].[procUtils_SqlCheatSheet]    Script Date: 04/22/2009 13:21:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [ga].[procUtils_SqlCheatSheet]                

as                 
set nocount on                 

--what was the name of the table with something like role                
/*                
SELECT * from sys.tables where [name] like '%POC%'                
*/                
-- what are the columns of this table                 
/*                
select column_name , DATA_TYPE , CHARACTER_MAXIMUM_LENGTH,  table_name  from Information_schema.columns where table_name='tbGui_ExecutePOC'                
*/                

-- find proc        
--what was the name of procedure with something like role                
/*                
select * from sys.procedures where [name] like '%ext%'                
exec sp_HelpText procName        
*/                
/*                
exec sp_helpText procUtils_InsertGenerator                
*/                
--how to list all databases in sql server                 
/*                
SELECT database_id AS ID, NULL AS ParentID, name AS Text FROM sys.databases ORDER BY [name]                
*/                

--HOW-TO LIST ALL TABLES IN A SQL SERVER 2005 DATABASE                
/*                
SELECT TABLE_NAME FROM [POC].INFORMATION_SCHEMA.TABLES                
WHERE TABLE_TYPE = 'BASE TABLE'                  
AND TABLE_NAME <> 'dtproperties'                  
ORDER BY TABLE_NAME                

*/                
--HOW-TO ENABLE XP_CMDSHELL START                
-------------------------------------------------------------------------                
-- configure verbose mode temporarily                 
-- EXECUTE sp_configure 'show advanced options', 1                 
-- RECONFIGURE WITH OVERRIDE                 
--GO                 

--ENABLE xp_cmdshell                 
-- EXECUTE sp_configure 'xp_cmdshell', '1'                 
-- RECONFIGURE WITH OVERRIDE                 
-- EXEC SP_CONFIGURE 'show advanced option', '1';                 
-- SHOW THE CONFIGURATION                 
-- EXEC SP_CONFIGURE;                 

--turn show advance options off                 
-- GO                 
--EXECUTE sp_configure 'show advanced options', 0                 
-- RECONFIGURE WITH OVERRIDE                 
-- GO                

--HOW-TO ENABLE XP_CMDSHELL END                
-------------------------------------------------------------------------                

--HOW-TO IMPLEMENT SLEEP                 
-- sleep for 10 seconds                 
-- WAITFOR DELAY '00:00:10' SELECT * FROM My_Table                

/* LIST ALL PRIMARY KEYS                 

SELECT                 
  INFORMATION_SCHEMA.TABLE_CONSTRAINTS.TABLE_NAME AS TABLE_NAME,                
  INFORMATION_SCHEMA.KEY_COLUMN_USAGE.COLUMN_NAME AS COLUMN_NAME,                 
  REPLACE(INFORMATION_SCHEMA.TABLE_CONSTRAINTS.CONSTRAINT_TYPE,' ', '_') AS CONSTRAINT_TYPE                 
FROM                 
  INFORMATION_SCHEMA.TABLE_CONSTRAINTS                 
  INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE ON                 
  INFORMATION_SCHEMA.TABLE_CONSTRAINTS.CONSTRAINT_NAME =                 
  INFORMATION_SCHEMA.KEY_COLUMN_USAGE.CONSTRAINT_NAME                 
WHERE                 
  INFORMATION_SCHEMA.TABLE_CONSTRAINTS.TABLE_NAME <> N'sysdiagrams'                 
ORDER BY                 
  INFORMATION_SCHEMA.TABLE_CONSTRAINTS.TABLE_NAME ASC                

*/                

--HOW-TO COPY TABLE AND THE WHOLE TABLE DATA , COPY TABLE FROM DB TO DB                
--==================================================START                 
/*                
use Poc_Dev                
go                
drop table tbGui_LinksVisibility                

use POc_test                
go                
select *                 
INTO [POC_Dev].[ga].[tbGui_LinksVisibility]                
from [POC_TEST].[ga].[tbGui_LinksVisibility]                

*/                
--HOW-TO COPY TABLE AND THE WHOLE TABLE DATA , COPY TABLE FROM DB TO DB                
--====================================================END                
--=================================================== SEE TABLE METADATA START                
/*                

SELECT c.name AS [COLUMN_NAME], sc.data_type AS [DATA_TYPE], [value] AS                 
[DESCRIPTION] , c.max_length as [MAX_LENGTH] , c.is_nullable AS [OPTIONAL]                 
, c.is_identity AS [IS_PRIMARY_KEY] FROM sys.extended_properties AS ep                 
INNER JOIN sys.tables AS t ON ep.major_id = t.object_id                 
INNER JOIN sys.columns AS c ON ep.major_id = c.object_id AND ep.minor_id                 
= c.column_id                 
INNER JOIN INFORMATION_SCHEMA.COLUMNS sc ON t.name = sc.table_name and                 
c.name = sc.column_name                 
WHERE class = 1 and t.name = 'tbGui_ExecutePOC' ORDER BY SC.DATA_TYPE                

*/                
--=================================================== SEE TABLE METADATA END               
    /*            
select * from Information_schema.columns                
select table_name , column_name from Information_schema.columns where table_name='tbGui_Wizards'                
    */            

--=================================================== LIST ALL TABLES AND THEIR DESCRIPTOINS START                
/*                

SELECT T.name AS TableName, CAST(Props.value AS varchar(1000)) AS                
TableDescription                
FROM sys.tables AS T LEFT OUTER JOIN                
(SELECT class, class_desc, major_id, minor_id,                
name, value                
FROM sys.extended_properties                
WHERE (minor_id = 0) AND (class = 1)) AS                
Props ON T.object_id = Props.major_id                
WHERE (T.type = 'U') AND (T.name <> N'sysdiagrams')                
ORDER BY TableName                
*/                
--=================================================== LIST ALL TABLES AND THEIR DESCRIPTOINS START                

--=================================================== LIST ALL OBJECTS FROM DB START                
/*                

use DB                
--HOW-TO LIST ALL PROCEDURE IN A DATABASE                
select s.name from sysobjects s where type = 'P'                
--HOW-TO LIST ALL TRIGGERS BY NAME IN A DATABASE                
select s.name from sysobjects s where type = 'TR'                
--HOW-TO LIST TABLES IN A DATABASE                 
select s.name from sysobjects s where type = 'U'                
--how-to list all system tables in a database                
select s.name from sysobjects s where type = 's'                
--how-to list all the views in a database                
select s.name from sysobjects s where type = 'v'                

*/                

/*                
Similarly you can find out other objects created by user, simple change type =                 

C = CHECK constraint                 

D = Default or DEFAULT constraint                 

F = FOREIGN KEY constraint                 

L = Log                 

FN = Scalar function                 

IF = In-lined table-function                 

P = Stored procedure                 

PK = PRIMARY KEY constraint (type is K)                 

RF = Replication filter stored procedure                

S = System table                 

TF = Table function                 

TR = Trigger                 

U = User table ( this is the one I discussed above in the example)                

UQ = UNIQUE constraint (type is K)                 

V = View                 

X = Extended stored procedure                
*/                

--=================================================== HOW-TO SEE ALL MY PERMISSIONS START                

/*                

SELECT * FROM fn_my_permissions(NULL, 'SERVER');                
USE poc_qa;                
SELECT * FROM fn_my_permissions (NULL, 'database');                
GO                

*/                
--=================================================== HOW-TO SEE ALL MY PERMISSIONS END                

/*               
--find table               

use poc_dev               
go               
select s.name from sysobjects s where type = 'u'  and s.name like '%Visibility%'              
select * from tbGui_LinksVisibility              

*/              

/* find cursor              

use poc      
go        
DECLARE @procName varchar(100)        
DECLARE @cursorProcNames CURSOR        
SET @cursorProcNames = CURSOR FOR        
select name from sys.procedures where modify_date > '2009-02-05 13:12:15.273' order by modify_date desc       

OPEN @cursorProcNames        
FETCH NEXT        
FROM @cursorProcNames INTO @procName        
WHILE @@FETCH_STATUS = 0        
BEGIN        

set nocount off;        
exec sp_HelpText @procName --- or print them        
-- print @procName        

FETCH NEXT        
FROM @cursorProcNames INTO @procName        
END        
CLOSE @cursorProcNames        

select @@error    

*/              

/* --  SEE STORED PROCEDURE EXT PROPS            

SELECT ep.name as 'EXT_PROP_NAME' , SP.NAME , [value] as 'DESCRIPTION' FROM sys.extended_properties as ep left join sys.procedures as sp on sp.object_id = ep.major_id where sp.type='P'            

-- what the hell I ve been doing lately on sql server 2005 / 2008
select o.name , 
(SELECT [definition] AS [text()] FROM sys.all_sql_modules where sys.all_sql_modules.object_id=a.object_id FOR XML PATH(''), TYPE) AS Statement_Text
, a.object_id, o.modify_date from sys.all_sql_modules a left join sys.objects o on a.object_id=o.object_id order by 4 desc

-- GET THE RIGHT LANG SCHEMA START 
DECLARE @template AS varchar(max)
SET @template = 'SELECT * FROM {object_name}'

DECLARE @object_name AS sysname

SELECT @object_name = QUOTENAME(s.name) + '.' + QUOTENAME(o.name)
FROM sys.objects o
INNER JOIN sys.schemas s
    ON s.schema_id = o.schema_id
WHERE o.object_id = OBJECT_ID(QUOTENAME(@LANG) + '.[TestingLanguagesInNameSpacesDelMe]')

IF @object_name IS NOT NULL
BEGIN
    DECLARE @sql AS varchar(max)
    SET @sql = REPLACE(@template, '{object_name}', @object_name)
    EXEC (@sql)
END
-- GET THE RIGHT LANG SCHEMA END 

--  SEE STORED PROCEDURE EXT PROPS end*/             
set nocount off
GO
EXEC sys.sp_addextendedproperty @name=N'AuthorName', @value=N'Yordan Georgiev' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'PROCEDURE',@level1name=N'procUtils_SqlCheatSheet'
GO
EXEC sys.sp_addextendedproperty @name=N'ProcDescription', @value=N'TODO:ADD HERE DESCRPIPTION' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'PROCEDURE',@level1name=N'procUtils_SqlCheatSheet'
GO
EXEC sys.sp_addextendedproperty @name=N'ProcVersion', @value=N'0.1.0.20090406.1317' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'PROCEDURE',@level1name=N'procUtils_SqlCheatSheet'
GO
/****** Object:  UserDefinedFunction [ga].[GetDbVersion]    Script Date: 04/22/2009 13:21:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [ga].[GetDbVersion]()
RETURNS VARCHAR(20)
    BEGIN
        RETURN convert(varchar(20) , (select value from sys.extended_properties where name='DbVersion' and class_desc='DATABASE') )
    END
GO
EXEC sys.sp_addextendedproperty @name=N'AuthorName', @value=N'Yordan Georgiev' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'FUNCTION',@level1name=N'GetDbVersion'
GO
EXEC sys.sp_addextendedproperty @name=N'ChangeDescription', @value=N'Initial creation' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'FUNCTION',@level1name=N'GetDbVersion'
GO
EXEC sys.sp_addextendedproperty @name=N'CreatedWhen', @value=N'getDate()' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'FUNCTION',@level1name=N'GetDbVersion'
GO
EXEC sys.sp_addextendedproperty @name=N'Description', @value=N'Gets the current version of the database ' , @level0type=N'SCHEMA',@level0name=N'ga', @level1type=N'FUNCTION',@level1name=N'GetDbVersion'
GO
/****** Object:  UserDefinedFunction [ga].[GetDbType]    Script Date: 04/22/2009 13:21:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [ga].[GetDbType]()
RETURNS VARCHAR(30)
    BEGIN
        RETURN convert(varchar(30) , (select value from sys.extended_properties where name='DbType' and class_desc='DATABASE') )
    END
GO
/****** Object:  Default [DF_tb_DataMeta_ObjChangeLog_DbVersion]    Script Date: 04/22/2009 13:21:40 ******/
ALTER TABLE [ga].[tb_DataMeta_ObjChangeLog] ADD  CONSTRAINT [DF_tb_DataMeta_ObjChangeLog_DbVersion]  DEFAULT ('select ga.GetDbVersion()') FOR [DbVersion]
GO
/****** Object:  Default [DF_tb_DataMeta_ObjChangeLog_EventDate]    Script Date: 04/22/2009 13:21:40 ******/
ALTER TABLE [ga].[tb_DataMeta_ObjChangeLog] ADD  CONSTRAINT [DF_tb_DataMeta_ObjChangeLog_EventDate]  DEFAULT (getdate()) FOR [EventDate]
GO
/****** Object:  Default [DF_tb_DataMeta_ObjChangeLog_ObjVersion]    Script Date: 04/22/2009 13:21:40 ******/
ALTER TABLE [ga].[tb_DataMeta_ObjChangeLog] ADD  CONSTRAINT [DF_tb_DataMeta_ObjChangeLog_ObjVersion]  DEFAULT ('0.0.0') FOR [ObjVersion]
GO
/****** Object:  DdlTrigger [trigMetaDoc_TraceDbChanges]    Script Date: 04/22/2009 13:21:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create trigger [trigMetaDoc_TraceDbChanges]
on database
for create_procedure, alter_procedure, drop_procedure,
create_table, alter_table, drop_table,
create_function, alter_function, drop_function , 
create_trigger , alter_trigger , drop_trigger 
as

set nocount on

declare @data xml
set @data = EVENTDATA()
declare @DbVersion varchar(20)
set @DbVersion =(select ga.GetDbVersion())
declare @DbType varchar(20)
set @DbType =(select ga.GetDbType())
declare @DbName varchar(256)
set @DbName =@data.value('(/EVENT_INSTANCE/DatabaseName)[1]', 'varchar(256)')
declare @EventType varchar(256)
set @EventType =@data.value('(/EVENT_INSTANCE/EventType)[1]', 'varchar(50)')
declare @ObjectName varchar(256)
set @ObjectName  = @data.value('(/EVENT_INSTANCE/ObjectName)[1]', 'varchar(256)')
declare @ObjectType varchar(25)
set @ObjectType = @data.value('(/EVENT_INSTANCE/ObjectType)[1]', 'varchar(25)')
declare @TSQLCommand varchar(max)
set @TSQLCommand = @data.value('(/EVENT_INSTANCE/TSQLCommand)[1]', 'varchar(max)')
declare @opentag varchar(4)
set @opentag= '&lt;'
declare @closetag varchar(4) 
set @closetag= '&gt;'
declare @newDataTxt varchar(max) 
set @newDataTxt= cast(@data as varchar(max))
set @newDataTxt = REPLACE ( REPLACE(@newDataTxt , @opentag , '<') , @closetag , '>')
-- print @newDataTxt
declare @newDataXml xml 
set @newDataXml = CONVERT ( xml , @newDataTxt)
declare @Version varchar(50)
set @Version = @newDataXml.value('(/EVENT_INSTANCE/TSQLCommand/CommandText/Version)[1]', 'varchar(50)')

-- if we are dropping take the version from the existing object 
if  ( SUBSTRING(@EventType , 0 , 5)) = 'DROP'
set @Version =( select top 1 [Version]  from ga.tb_DataMeta_ObjChangeLog where ObjectName=@ObjectName order by [LogId] desc)

declare @LoginName varchar(256) 
set @LoginName = @data.value('(/EVENT_INSTANCE/LoginName)[1]', 'varchar(256)')
declare @FirstName varchar(50)
set @FirstName= (select [FirstName] from [ga].[tb_BLSec_LoginsForUsers] where [LoginName] = @LoginName)
declare @LastName varchar(50)
set @LastName  = (select [LastName] from [ga].[tb_BLSec_LoginsForUsers] where [LoginName] = @LoginName)
declare @SchemaName sysname 
set @SchemaName = @data.value('(/EVENT_INSTANCE/SchemaName)[1]', 'sysname');
--declare @Description xml 
--set @Description = @data.query('(/EVENT_INSTANCE/TSQLCommand/text())')

--print 'VERSION IS ' + @Version
--print @newDataTxt
--print cast(@data as varchar(max))

-- select column_name from information_schema.columns where table_name ='tb_DataMeta_ObjChangeLog'
insert into [ga].[tb_DataMeta_ObjChangeLog]
(
[DatabaseName] ,
[SchemaName],
[DbVersion] ,
[DbType],
[EventType],
[ObjectName],
[ObjectType] ,
[Version],
[SqlCommand] ,
[LoginName] ,
[FirstName],
[LastName] 
)

values(

@DbName,
@SchemaName,
@DbVersion,
@DbType,
@EventType, 
@ObjectName, 
@ObjectType , 
@Version,
@newDataTxt, 
@LoginName , 
@FirstName , 
@LastName
)
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
DISABLE TRIGGER [trigMetaDoc_TraceDbChanges] ON DATABASE
GO
/****** Object:  DdlTrigger [trigMetaDoc_TraceDbChanges]    Script Date: 04/22/2009 13:21:29 ******/
Enable Trigger [trigMetaDoc_TraceDbChanges] ON Database
GO 
```

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2010-07-01T08:54:53.523

If your Database is SQL Server, we might have just the solution you're looking for. SQL Source Control 1.0 has now been released.

[http://www.red-gate.com/products/SQL_Source_Control/index.htm](http://www.red-gate.com/products/SQL_Source_Control/index.htm)

This integrates into SSMS and provides the glue between your database objects and your VCS. The 'scripting out' happens transparently (it uses the SQL Compare engine under the hood), which should make it so straightforward to use that developers won't be discouraged from adopting the process.

An alternative Visual Studio solution is [ReadyRoll](http://www.red-gate.com/products/sql-development/readyroll/), which is implemented as a sub-type of the SSDT Database Project. This takes a migrations-driven approach, which is more suited to the automation requirements of DevOps teams.

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2014-10-07T18:07:48.733

While this question has many good answers, most of them don’t include the innovations changes in the market, specifically with commercial tools.

Here is a short list of tools that do database version control, I listed the pros and cons of each (full discloser: I work for DBmaestro)

Red-Gate – has been on the market for many years. It provides version control of database objects using scripts integrated with file-based version control.

DBVS – provides version control of the database objects using scripts integrated with file-based version control.

DBmaestro – Provides an enforcement of the version control processes (check-out / check-in) on the real database objects. So there is no question if the version control repository is in-sync with the database being used by the application.

I would encourage you to read a comprehensive, unbiased review on Database Enforced Change Management solutions by veteran database expert Ben Taylor which he posted on LinkedIn [https://www.linkedin.com/pulse/article/20140907002729-287832-solve-database-change-mangement-with-dbmaestro](https://www.linkedin.com/pulse/article/20140907002729-287832-solve-database-change-mangement-with-dbmaestro)

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2008-09-22T15:10:15.997

Yes ... our databases are designed in ERwin and the DDLs for each version are automatically generated. The ERwin files are kept in our source code control system (actually, so are our engineering documents).

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2008-09-22T15:12:33.137

We use replication and clustering to manage our databases, as well as backups. We use Serena to manage our SQL scripts and configuration implementations. Before a configuration change is made, we perform a backup as part of the change management process. This backup satisfies our rollback requirement.

I think it all depends on scale. Are you talking about enterprise applications that need offsite backups and disaster recovery? A small workgroup running an accounting application? Or everywhere in between?

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2008-09-22T15:13:50.623

We have our Create/Alter scripts under source control. As for the database itself, when you have hundreds of tables and a lot of processing data every minutes, it would be CPU and HDD killer to version all the database. That's why backup is still, according to me, the best way to control your data.

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2008-09-22T15:42:34.423

I always check my database structure dumps into source control. Full database dumps however I normally just compress and put away for storage.

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2008-09-22T18:12:06.530

My team versions our database schema as C# classes with the rest of our code. We have a homegrown C# program (<500 lines of code) that reflects the classes and creates SQL commands to build, drop and update the database. After creating the database we run sqlmetal to generate a linq mapping, which is then compiled in another project that is used to generate test data. The whole things works really well because data access is checked at compile time. We like it because the schema is stored in a .cs file which is easy to track compare in trac/svn.

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2008-09-22T21:10:20.470

RedGate software makes some great tools that will help you version your database. Be sure to try to have your devs build their own isolated local databases for dev work rather than rely on a "dev server" which may or may not be down at some time.

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2008-09-23T10:15:02.440

I have used RedGate SQL Compare Pro for schema synchronization with script folder, then I commit all my update to version control. It works great.

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2009-05-23T00:58:15.980

"[Short version: dump your production database into a git repository for an instant backup solution.](http://www.viget.com/extend/backup-your-database-in-git/)"

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2011-01-25T14:45:40.410

I've started working on [sqlHawk](http://timabell.github.com/sqlHawk/) which is aimed at providing (open source) tooling around this problem.

It's currently in fairly early stages, but does already support storing and enforcing [stored procedures](https://stackoverflow.com/questions/2370011/how-to-add-stored-procedures-to-version-control) and running scripted updates.

I'd be grateful for any input from anyone who has the time to look at this tool.

Apologies for blatant self promotion, but I hope this is useful to someone!

* * *

## 回答 #42

> 赞同：2
> 
> 时间：2011-04-03T01:34:04.883

I agree with many of the posting concerning ruby's ActiveRecord migrations - they are an elegant way to manage the database in small incremental files that everyone can share. With that said, I've recently implemented a project using VisualStudio's Database Project, and it's kinda made me a believer. Short story - you create a database project, import all (if any) existing database objects into it (tables/views/triggers/keys/users/etc). That import results in a "Create" script per object. To manage the database you alter the create script and then on deploy VS compares the target database to the state of the database residing in your project and apply the proper alter statements.

It really is a bit of magic and I have to admit, it's one of the better things the VS team has done. I'm really impressed up to this point.

Of course, you can manage the whole database project in the version control system of your choice.

* * *

## 回答 #43

> 赞同：2
> 
> 时间：2017-01-16T21:21:12.663

Wow, so many answers. For solid database versioning you need to version control the code that changes your database. Some CMS offer configuration management tools, such as the one in Drupal 8\. Here is an overview with practical steps to [arrange your workflow and ensure the database configuration is versioned](https://ivan.grynenko.com/how-to-version-control-database/), even in team environments:

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2008-09-22T15:10:27.510

We have a weekly sql dump into a subversion repo. It's fully automated but it's a REALLY beefy task.

You'll want to limit the number of revisions because it really chows disk space after a while!

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2008-09-22T16:25:09.093

I version control the create script, and I use the svn version tag within it. Then, whenever I get a version that is going to be used, I create a script in a dbpatches/ directory named as the version to roll up to. The job of that script is to modify a current database without destroying the data. dbpatches/, for example, might have files named 201, 220, and 240\. If the database is currently at level 201, apply patch 220, then patch 240.

```
DROP TABLE IF EXISTS `meta`;
CREATE TABLE `meta` (
  `property` varchar(255),
  `value` varchar(255),
  PRIMARY KEY (`property`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
INSERT INTO `meta` VALUES ('version', '$Rev: 240 $'); 
```

Don't forget to test your code before considering a patch good. Caveat emptor!

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2012-08-02T21:50:09.750

As a rule, we keep all of our object code (stored procedures, views, triggers, functions, etc.) in source control because these objects are code, and as about every other answer here agrees, code belongs in some form of version control system.

As for CREATE, DROP, ALTER statements, etc. (DDL), we developed and use [BuildMaster](http://inedo.com/downloads/buildmaster) to manage the deployment of these scripts such that they can be run once and only once against a target database (whether they fail or not). The general idea is that developers will upload change scripts into the system and when it comes time for deployment, only the change scripts that haven't been run against the target environment's database will be run (this is managed very similarly to [Autocracy's answer](https://stackoverflow.com/a/115885/44765)). The reason for this separation of script types lies in that once you manipulate a table's structure, add an index, etc., you effectively cannot undo that without writing a brand new script, or restoring the database - as opposed to the object code where you can simply drop a view or stored procedure then recreate it.

Some of the benefits can be seen when, for example, you restore your production database into your integration environment, the system automatically knows exactly which scripts haven't been run and will alter the table structure of that newly restored database to be current with regards to development.

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2008-09-22T15:14:54.957

We insist upon change scrips and a master data definition script. These are checked into CVS along with any other source code. The PL/SQL (were are an Oracle shop) is also source controlled in CVS. The change scripts are repeatable and can be passed to everyone on the team. Basically, just because it is a database, there is never an excuse not to code it and use a source control system to track the changes.

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2008-09-22T17:06:05.953

We maintain DDL (and sometime DML) scripts generated by our ER Tool (PowerAMC).

We have a bench of shell scripts which rename the scripts starting with a number on the trunk branch. Each script is committed and tagged with the bugzilla number.

These scripts are then at need merged within the release branches along with the application code.

We have a table recording the scripts and their status. Each script is executed in order and recorded in this table on each install by the deploying tool.

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2008-09-23T11:28:57.800

Your project team can have a DBA to whom every developer would forward their create alter, delete, insert/update (for master data) sql statements. DBAs would run those queries and on successfully making the required update would add those statements to a text file or a spreadsheet. Each addition can be labeled as a savepoint. Incase you revert back to a particular savepoint, just do a drop all and run the queries uptil the labelled savepoint. This approach is just a thought... a bit of fine tuning here would work for your development environment.

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2008-10-01T13:32:38.580

Any database interface code absolutely should go into version control (Stored Procedures, Functions, etc).

For structure and data, it is a judgement call. I personally keep a clean structural template of my databases around, but don't store them in version control, due to the size. But storing it in version control can be very beneficial, even for just having a history.

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2008-11-03T11:39:33.057

A big problem, often overlooked, is that for larger web based systems, it is required to have a transitional period or bucket testing approach to making new releases. This makes it essential to have both rollback and a mechanism for supporting both the old and new schema in the same DB. This requires a scaffolding approach (made populist by the Agile DB folks). In this scenario, lack of process in DB source control can be a total disaster. You need old schema scripts, new schema scripts and a set of intermediate scripts, as well as a tidy up, once the system is fully on the new version (or rolled back).

Rather than having scripts to recreate schema from scratch, what is required is a state based approach, where you need scripts purely to move the DB into the state you require, both forward and back, from version to version. Your DB becomes a series of state scripts, which can be easily source controlled and tagged along with the rest of the source.

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2009-04-28T06:13:39.770

Yes, of course. We generate dumps of our PostgreSQL schemas whenever there's a change and check it in. It's already saved us many times, and I've only been at my job a few months.

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2009-05-22T05:17:13.800

Sadly, I've seen more than one team developing PL/SQL programs (stored procedures in Oracle) - sometimes ten thousands LOC - just by editing the code in TOAD (a database tool), without even saving the source to files (except for deployment). Even if the database is backuped regulary (wouldn't take that for granted, though), the only way to retrieve an old version of a stored procedure is to restore the whole database, which is many GB large. And of course sometimes concurrent changes in one file lead to loss of work, when more than one developer works on the same project.

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2009-09-20T11:32:31.010

I use ActiveRecord Migrations. This Ruby gem can be used outside of a Rails project and there are adapters to handle most databases you'll come across. My tip: if you are able to run your project off Postgres, you get transactional schema migrations. That means you don't end up with a broken database if a migration only half-applies.

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2009-09-20T11:37:11.763

One of Kira's prime use cases is database upgrades by explicitly specify the schema outside the database as code. It then can manage the database and upgrade it to any version from any version.

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2010-06-25T06:45:21.573

Yes, we source control our sql scripts too with subversion. It's a good practice and you can recreate the schema with default data whenever needed.

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2011-03-19T20:29:13.910

For oracle I use self-written java programm [oracle-ddl2svn](http://oracle-ddl2svn.googlecode.com/) for auto track changes of oracle DDL scheme in SVN

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2013-11-18T21:00:47.710

I've heard people say you absolutely have to keep your schemas in the database. I'm not sure I agree. This really depends on the system you're working with. If your system is relatively small and the data is not terribly important. And the the speed at which you need to bring another development environment online is crucial.. then yes.. you can benefit from it. However when your schema is useless without the data and the database is extremely large, it becomes virtually impossible to "source control" your database. Sure, you can still keep your DDL code in source control but that's essentially useless. You can't get the data needed without backup/restore.

In larger database development efforts, I've found backup and restore as the preferred rollback option. Sure you can keep procs, views, functions etc in source control but keeping table.sql is not necessary. Also, if your deployment process is airtight, you'll most likely never have to "rollback" your production environment.

# visual-studio - 如何自定义 Visual Studio 2005 中的语法突出显示？

> ID：115388
> 
> 赞同：5
> 
> 时间：2008-09-22T15:10:42.767
> 
> 标签：visual-studio, syntax-highlighting

是否可以在 Visual Studio 2005 中自定义语法突出显示？到现在为止，我还没有找到办法做到这一点。

例如，在 Eclipse 中，可以设置自定义突出显示。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T15:14:46.907

你的意思不仅仅是改变颜色——比如用自己的符号和关键字定义一种新语言？如果是这样的话，

[http://msdn.microsoft.com/en-us/library/bb165041(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bb165041(VS.80).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T15:14:05.567

是的，请参阅工具...选项...字体和颜色。

如果您想浏览一些选项，这里是一个[主题库。](http://www.hanselman.com/blog/VisualStudioProgrammerThemesGallery.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T16:26:03.243

对于 C++，您可以添加一个名为 usertype.dat 的文件，其中包含您的自定义关键字列表。

此[MSDN 页面](http://msdn.microsoft.com/en-us/library/zy61y8b8(VS.80).aspx)有更多详细信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-26T02:35:32.167

这是一个很棒的免费图书馆：[http ://studiostyl.es/](http://studiostyl.es/)

通过工具导入设置->导入/导出设置

# .net - 使用软件更新更新 SQL Server 数据库架构

> ID：115389
> 
> 赞同：6
> 
> 时间：2008-09-22T15:10:45.047
> 
> 标签：.net, sql-server, windows-installer

安装产品更新时如何更新 SQL 服务器数据库？是否有任何工具可以与 Windows 安装程序集成？我的典型架构更改是：

*   添加/删除列
*   添加/删除表。
*   添加视图。
*   添加/更改索引。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T15:49:23.220

根据我的经验，最好在您的软件连接到数据库时进行数据库架构更新，而不是在安装时进行。您想要执行以下操作：

*   使用唯一标识符（例如 guid）标识每个架构更改
*   包括您可以对产品应用的所有更改的列表，例如在构建期间编译到资源中
*   在数据库中有一个表来保存已应用的架构更改列表
*   当您连接到数据库时，扫描该表以查看是否需要任何更改

这一切都非常简单，可以在您的运行代码中完成，但在您的安装程序中却不那么容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T10:06:29.917

Adam Cogan 建议创建一个补丁表，用于记录初始版本之后的每个更新。不要通过 SSMS 或企业管理器更改架构，请确保您编写每个更改的脚本……这两个应用程序都允许您编写更改脚本，然后不应用它们。将脚本保存到文件（可能将它们作为资源添加），然后在每次应用程序运行时检查补丁表。

亚当在这里有一些更好的 SQL 数据库的规则

[http://www.ssw.com.au/ssw/Standards/Rules/RulesToBetterSQLServerDatabases.aspx](http://www.ssw.com.au/ssw/Standards/Rules/RulesToBetterSQLServerDatabases.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T15:15:06.347

不确定与 Windows 安装程序的集成，但您可能会查看 Red Gate 的[SQL Packager](http://www.red-gate.com/products/SQL_Packager/index.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T15:18:32.640

[InstallShield](http://www.acresso.com/products/installation/installshield.htm)允许您在安装过程中执行 SQL 脚本。不过没试过，只记得上次我看它是在 GUI 上！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T15:30:42.937

您可能想查看 SubSonic 的[迁移](http://subsonicproject.com/2-1-pakala/subsonic-using-migrations/)。首先，这是对数据库进行版本控制的好方法。其次，弄清楚如何从安装程序运行完全相同的脚本应该不难。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T17:28:56.790

我认为您的软件的每个版本都有一堆数据库更新。为什么不将这些更新编写为 T-SQL 指令，以便在新版本软件首次启动时进行测试执行？只需从您的软件打开与数据库的连接并发送 DDL 指令，就像发送任何 SELECT 或 UPDATE 指令一样。我也会做一些类似于 Jack Paulsen 提议的事情：使用双重标识系统维护这些 T-SQL 指令的列表：一个链接到它适用的数据库/软件版本（可以是唯一标识符），另一个（数字）链接到保持指令按顺序排列（参见我的示例：指令 2 不能在指令 1 之前执行）

例子：

```
//instruction 1, batch instructions for version#2.162
USE myDatabase
GO
ALTER TABLE myTable
    ADD myColumn uniqueIdentifier Null
GO
//instruction 2, batch instructions for version#2.162
USE myDatabase
ALTER TABLE myTable
    ADD CONSTRAINT myTable_myColumn FOREIGN KEY (myColumn) ...
GO 
```

有关 ALTER、DROP 和 CREATE 指令的完整描述，请参阅 T-SQL 帮助。请注意（例如）在删除该字段之前删除链接到该字段的索引和约束。

您当然可以添加一些额外的 UPDATE 指令来计算添加列的值等。

您甚至可以考虑更复杂的事情，检查之前的升级步骤（导致数据库版本 #2.161）是否正确执行。

我的建议：在编写这些 T-SQL 指令时，还要跟踪它们的“对应物”，以便您可以随时（例如调试时）将数据库结构降级到以前的版本。

# c# - 在 C# 中将年份从 4 位转换为 2 位并再次返回

> ID：115399
> 
> 赞同：69
> 
> 时间：2008-09-22T15:12:16.663
> 
> 标签：c#, datetime, 2-digit-year

我的信用卡处理器要求我从信用卡到期日期发送两位数的年份。这是我目前的处理方式：

1.  我`DropDownList`在页面上放了一个 4 位数的年份。
2.  我在`DateTime`字段中验证过期日期，以确保传递给 CC 处理器的过期日期没有过期。
3.  我将两位数的年份发送到 CC 处理器（根据需要）。我通过年份 DDL 中的值的子字符串来执行此操作。

有没有一种方法可以将四位数的年份转换为两位数的年份。我没有在`DateTime`物体上看到任何东西。还是我应该继续按原样处理它？

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2008-09-22T15:17:53.343

如果您使用到期日期（月/年）创建 DateTime 对象，则可以在 DateTime 变量上使用 ToString()，如下所示：

```
DateTime expirationDate = new DateTime(2008, 1, 31); // random date
string lastTwoDigitsOfYear = expirationDate.ToString("yy"); 
```

编辑：如果您在验证期间使用 DateTime 对象，请注意您的日期。如果有人选择 05/2008 作为他们卡的到期日期，它会在 5 月底到期，而不是在第一天到期。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2014-05-21T12:16:25.777

**第一种解决方案**（最快）：

```
yourDateTime.Year % 100 
```

**第二个解决方案**（我认为更优雅）：

```
yourDateTime.ToString("yy") 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2017-06-04T18:12:33.047

答案已经给出。但在这里我想补充一点。有人说它不起作用。

可能是你正在使用

> `DateTime.Now.Year.ToString("yy");`

这就是为什么它不起作用。我也犯了同样的错误。

将其更改为

> `DateTime.Now.ToString("yy");`

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-22T15:22:47.497

这应该适合你：

```
public int Get4LetterYear(int twoLetterYear)
{
    int firstTwoDigits =
        Convert.ToInt32(DateTime.Now.Year.ToString().Substring(2, 2));
    return Get4LetterYear(twoLetterYear, firstTwoDigits);
}

public int Get4LetterYear(int twoLetterYear, int firstTwoDigits)
{
    return Convert.ToInt32(firstTwoDigits.ToString() + twoLetterYear.ToString());
}

public int Get2LetterYear(int fourLetterYear)
{
    return Convert.ToInt32(fourLetterYear.ToString().Substring(2, 2));
} 
```

我认为.NET 中没有任何特殊的内置内容。

**更新**：它缺少一些您可能应该做的验证。验证输入变量的长度，等等。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T15:17:09.383

例如，使用带有自定义格式字符串的 DateTime 对象 ToString，例如 myDate.ToString("MM/dd/yy")。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-04-16T09:52:58.213

```
//using java script
var curDate = new Date();
var curYear = curDate.getFullYear();
curYear = curYear.toString().slice(2);
document.write(curYear)
//using java script
//using sqlserver
select Right(Year(getDate()),2)
//using sql server
//Using c#.net 
DateTime dt = DateTime.Now;
            string curYear = dt.Year.ToString().Substring(2,2).ToString()  ;
//using c#.net 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2021-06-07T15:35:50.437

从 c# 6.0 开始，您可以在任何处理 c#（例如 MVC Razor 页面）的[字符串插值](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/interpolated)中使用内置复合格式。

```
DateTime date = DateTime.Now;

string myTwoDigitYear = $"{date:yy}; 
```

无需扩展。您可以在大括号内的任何有效 DateTime 对象之后的冒号后使用大多数[标准日期和时间格式字符串，以使用内置的](https://docs.microsoft.com/en-us/dotnet/standard/base-types/standard-date-and-time-format-strings)[复合格式](https://docs.microsoft.com/en-us/dotnet/standard/base-types/composite-formatting)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T15:15:28.607

此时，最简单的方法就是截断年份的最后两位数。对于信用卡，过去的日期是不必要的，所以 Y2K 没有意义。如果您的代码以某种方式仍在运行 90 多年，这同样适用。

我会进一步说，不要使用下拉列表，而是让用户自己输入年份。这是一种常见的方法，大多数用户都可以处理。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-22T15:18:39.707

我见过一些系统决定截止值是 75；75+是19xx，低于20xx。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-06-04T07:09:23.290

```
DateTime.Now.Year - (DateTime.Now.Year / 100 * 100) 
```

本年度工作。更改`DateTime.Now.Year`以使其还能再工作一年。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-10-25T08:22:00.603

答案很简单：

```
DateTime Today = DateTime.Today;
string zeroBased = Today.ToString("yy-MM-dd"); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T15:15:38.823

为什么页面上的原始下拉列表不只是一个 2 位数的值？在查看年份时，信用卡只覆盖很小的跨度，特别是如果 CC 供应商已经只接受 2 位数。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T15:24:55.463

这是 4Guys 文章的链接，该文章介绍了如何使用 ToString() 方法通过传入自定义格式字符串来格式化日期和时间。

[http://www.aspfaqs.com/aspfaqs/ShowFAQ.asp?FAQID=181](http://www.aspfaqs.com/aspfaqs/ShowFAQ.asp?FAQID=181)

以防万一它在这里消失是示例之一。

```
'Create a var. named rightNow and set it to the current date/time
Dim rightNow as DateTime = DateTime.Now
Dim s as String 'create a string

s = rightNow.ToString("MMM dd, yyyy") 
```

由于他的链接在此处断开，因此是指向 DateTimeFormatInfo 类的链接，该类使这些格式化选项成为可能。

[http://msdn.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.aspx](http://msdn.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.aspx)

做这样的事情而不是使用子字符串可能更一致，但谁知道呢。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-06-19T09:54:54.757

这是一篇旧文章，但我想我会给出一个使用`ExtensionMethod`（自 C# 3.0 起）的示例，因为这将隐藏实现并允许在项目中的任何地方使用，或者一遍又一遍地重新创建代码或需要注意一些实用程序类。

> 扩展方法使您能够将方法“添加”到现有类型，而无需创建新的派生类型、重新编译或以其他方式修改原始类型。扩展方法是一种特殊的静态方法，但它们被称为扩展类型的实例方法。对于用 C# 和 Visual Basic 编写的客户端代码，调用扩展方法和在类型中实际定义的方法之间没有明显区别。

```
public static class DateTimeExtensions
    {
        public static int ToYearLastTwoDigit(this DateTime date)
        {
            var temp = date.ToString("yy");
            return int.Parse(temp);
        }
    } 
```

然后，您可以在使用`DateTime`对象的任何地方调用此方法，例如...

```
var dateTime = new DateTime(2015, 06, 19);
var year = cob.ToYearLastTwoDigit(); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-11-09T03:08:23.883

这对我来说似乎没问题。 `yourDateTime.ToString().Substring(2);`

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-09-22T15:15:58.277

即使存在内置方式，它也不会验证它比今天更大，并且它与子字符串调用几乎没有什么不同。我不会担心的。

# c# - 成员信息.GetValue() C#

> ID：115418
> 
> 赞同：12
> 
> 时间：2008-09-22T15:15:25.720
> 
> 标签：c#, reflection

如何获取实例的成员值？

使用 propertyInfos 有一个`propertyInfo.GetValue(instance, index)`，但 memberInfo 中不存在这样的东西。

我搜索了网络，但似乎停止获取成员的姓名和类型。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2012-01-10T10:16:00.753

您必须向下转换为`FieldInfo`or `PropertyInfo`：

```
switch (memberInfo)
{
  case FieldInfo fieldInfo:
    return fieldInfo.GetValue(obj);
  case PropertyInfo propertyInfo:
    return propertyInfo.GetValue(obj);
  default:
    throw new InvalidOperationException();
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-22T15:16:29.680

我想你需要的是`FieldInfo`.

# apache-flex - Flex 分析器给出“套接字超时”错误。为什么？

> ID：115420
> 
> 赞同：3
> 
> 时间：2008-09-22T15:15:31.570
> 
> 标签：apache-flex, profiler

当尝试在任何设备上运行 Flex Builder 3 分析器时，我没有得到分析器对话框窗口，然后几秒钟后，我在控制台窗口中得到“套接字超时”。任何想法为什么它无法连接？

我有最新的调试版本的 Flash 播放器，并尝试关闭我的防火墙。
我从本地驱动器在 XP 上运行它，即。不是通过本地主机。

谢谢，亚历克斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T19:22:12.633

It looks like the browser (Firefox in my case) has to be shutdown before the profiler is started. Step 1\. in the livedocs even says this -- wish I had read it earlier. :)

[http://livedocs.adobe.com/flex/3/html/help.html?content=profiler_3.html](http://livedocs.adobe.com/flex/3/html/help.html?content=profiler_3.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-17T23:34:46.060

在这里尝试了所有其他建议后，Adobe 论坛上的这篇文章提示了我 [。Adobe 论坛](http://forums.adobe.com/thread/248762)

当 Flash 调试播放器启动时，它会在 %HOMEDRIVE%%HOMEPATH% 中查找 mm.cfg。在这台特定的计算机上，该路径不是我在 C: 上的主目录，而是在映射到 I: 的文件服务器上。所以一旦我用内容创建了 I:\mm.cfg

```
PreloadSwf=C:\Users\ehedstrom\Documents\FLEXBU~1\.metadata\.plugins\com.adobe.flash.profiler\ProfilerAgent.swf?host=localhost&port=9999 
```

一切都神奇地开始工作！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T15:22:47.480

浏览器选项卡，确保您有最新的调试，如您所说，还要确保端口正确，由于某种原因端口有时会从默认的 9999 更改（1001 或 20957），请确保您的 mm.cfg 具有 ProfilingFileOutputEnable =1，并且该bittorrent未打开。hth

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-07T14:00:49.120

当我尝试运行我的 Flex Profiler 时，我收到了以下错误消息：
在 flash 应用程序中，我遇到了以下异常：

```
Error #2044: Unhandled securityError:. text=Error #2048: Security sandbox violation:
    file:///C|%2Fwork%2Flabsense%2Fbranches%2Frel%5F1%5F2%5F5%5FEA%2Fsources%2Fui%2F.metadata%2F.plugins%2Fcom.adobe.flash.profiler%2FProfilerAgent.swf?host=localhost&port=9999
    cannot load data from localhost:9999.
    at ProfilerAgent()[C:\SVN\branches\3.2.0\modules\profiler3\as\ProfilerAgent.as:127] 
```

在 flex Profiler 控制台中（在 Eclipse 中），我得到了：套接字超时。

我在 windows vista 上运行，
Flex builder：3.2
Flash 调试器：10,0,22,87

我为解决此问题所做的事情：

*   将分析器的连接端口切换到 9998（并返回）
*   删除并重新安装 Flash 调试器播放器。
*   安装 flex builder 3.2（而不是 3.0）
*   删除 mm.cfg 文件中的所有输入
*   在 mm.cfg 中添加 enter：

    ```
    PreloadSwf=C:\work\labsense\Sources\ui\.metadata\.plugins\com.adobe.flash.profiler\ProfilerAgent.swf?host=localhost&port=9999 
    ```

    或者

    ```
    PreloadSwf=C:\work\labsense\Sources\ui\.metadata\.plugins\com.adobe.flash.profiler\ProfilerAgent.swf?host=localhost&port=9998 
    ```

    或者

    ```
    PreloadSwf=C:/work/labsense/Sources/ui/.metadata/.plugins/com.adobe.flash.profiler/ProfilerAgent.swf?host=localhost&port=9999 
    ```

    或带空格：

    ```
    PreloadSwf=C: \ work \ labsense \ Sources \ ui \ .metadata \ .plugins \ com.adobe.flash.profiler \ ProfilerAgent.swf?host=localhost&port=9999 
    ```

    或者

    ```
    C:\work\labsense\Sources\ui\.metadata\.plugins\com.adobe.flash.profiler\ProfilerAgent.swf? 
    ```

    或添加全部或部分输入：

    ```
    TraceOutputFileName=C:\Users\zivo\AppData\Roaming\Macromedia\Flash Player\Logs\flashlog.txt
    ErrorReportingEnable=1
    MaxWarnings=0
    TraceOutputFileEnable=1
    ProfilingFileOutputEnable=1 
    ```

*   打开和关闭vista防火墙
*   在 vista 防火墙中添加端口 9999 的例外
*   尝试单独运行探查器 SWF

结果相同。
尝试最后一件事：
因为我在使用闪存调试器之前遇到过类似的问题，所以当时的解决方案是：

1.  右键单击 Flash 播放器（调试器），
2.  选择 “调试器”,
3.  选择“其他机器”
4.  添加“127.0.0.1”</li>
5.  点击确定

然后，它解决了问题（但显然他使用主机 127.0.0.1 而不是 localhost 连接到调试器（这是相同的）
我现在添加到**mm.cfg**文件中，以下条目：

```
PreloadSwf=C:/work/labsense/branches/rel_1_2_5_EA/sources/ui/.metadata/.plugins/com.adobe.flash.profiler/ProfilerAgent.swf?host=127.0.0.1&port=9999 
```

然后，保存后，我运行分析器，它的工作！

这一切的原因是：
某些程序将文件**C:\Windows\System32\drivers\etc\hosts**更改为：

```
# Copyright (c) 1993-2006 Microsoft Corp.
#
# This is a sample HOSTS file used by Microsoft TCP/IP for Windows.
#
# This file contains the mappings of IP addresses to host names. Each
# entry should be kept on an individual line. The IP address should
# be placed in the first column followed by the corresponding host name.
# The IP address and the host name should be separated by at least one
# space.
#
# Additionally, comments (such as these) may be inserted on individual
# lines or following the machine name denoted by a '#' symbol.
#
# For example:
#
#      102.54.94.97     rhino.acme.com          # source server
#       38.25.63.10     x.acme.com              # x client host

::1             localhost
127.0.0.1       iDBO # LMS GENERATED LINE 
```

这意味着 localhost 不会导致 127.0.0.1 ！！！
修复很容易：

```
# ::1             localhost
# 127.0.0.1       iDBO # LMS GENERATED LINE
127.0.0.1       localhost 
```

而是（备注问题并解决问题

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-07T07:08:32.773

确保您的防火墙没有阻止端口 9999，您也可以自定义端口号：打开 Preferences->Flex->Profiler->Connections。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-02T21:43:31.253

检查 /etc/hosts (C:\Windows\System32\drivers\etc\hosts)，看看它是否包含一行： 127.0.0.1 localhost 在我的情况下，它以某种方式更改为 ::1 localhost，这就是它的原因停止工作。

感谢 Ziv 的（格式错误的）答案。

# perl - 如何获取已安装 CPAN 模块的列表？

> ID：115425
> 
> 赞同：97
> 
> 时间：2008-09-22T15:15:51.383
> 
> 标签：perl, cpan

除了尝试

```
perldoc <module name> 
```

单独为任何我喜欢的 CPAN 模块或通过文件系统查看目录我不知道我们安装了哪些模块。

获取每个已安装 CPAN 模块的大列表的最简单方法是什么？从命令行或其他方式。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-09-23T02:58:02.583

这在 Perl FAQ 中得到了解答，可以通过`perldoc -q installed`. 简而言之，它归结为 using`ExtUtils::Installed`或 using `File::Find`，这两者的变体都已在本线程之前介绍过。

您还可以找到常见问题解答条目[“如何查找我的系统上安装了哪些模块？”](http://perldoc.perl.org/perlfaq3.html#How-do-I-find-which-modules-are-installed-on-my-system%3f) 在 perlfaq3 中。您可以通过查看[perlfaq查看所有常见问题解答的列表](http://perldoc.perl.org/perlfaq.html)

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-22T15:17:44.357

```
perldoc perllocal 
```

[编辑： CPAN 常见问题解答](http://www.cpan.org/misc/cpan-faq.html#How_installed_modules)中有关于它的（少量）更多信息

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2013-03-01T20:32:00.997

`perldoc -q installed`

声称可以`cpan -l`解决问题，但它对我不起作用。另一种选择：

`cpan -a`

确实吐出了一个很好的已安装软件包列表，并且具有将它们写入文件的不错的副作用。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-09-22T16:26:30.463

值得注意的是 perldoc perllocal 只会报告通过 CPAN 安装的模块。如果有人手动安装模块，它不会找到它们。此外，如果您有多个人安装模块并且 perllocal.pod 处于源代码控制之下，人们可能会错误地解决冲突并破坏列表（例如，这在工作中发生过）。

遗憾的是，解决方案似乎是通过 @INC 使用 File::Find 或类似的东西。但是，这不仅会找到模块，还会在分发中找到相关的模块。例如，它会报告 TAP::Harness 和 TAP::Parser 以及 Test::Harness 的实际分发名称（假设您有版本 3 或更高版本）。您可能会将它们与分发名称匹配并丢弃那些不匹配的名称，但是您可能会丢弃本地构建和安装的模块。

我相信 brian d foy 的 backpan 索引工作应该有代码在 .pm 文件中处理它，它会尝试推断分布，但即使这样有时也会失败，因为不一定安装包中的内容（参见 Devel::Cover ::Inc 为例）。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2015-06-05T16:39:13.390

```
$ for M in `perldoc -t perllocal|grep Module |sed -e 's/^.*" //'`; do V=`perldoc -t perllocal|awk "/$M/{y=1;next}y" |grep VERSION |head -n 1`; printf "%30s %s\n" "$M" "$V"; done |sort
              Class::Inspector     *   "VERSION: 1.28"
                    Crypt::CBC     *   "VERSION: 2.33"
               Crypt::Rijndael     *   "VERSION: 1.11"
                    Data::Dump     *   "VERSION: 1.22"
                   DBD::Oracle     *   "VERSION: 1.68"
                           DBI     *   "VERSION: 1.630"
                   Digest::SHA     *   "VERSION: 5.92"
           ExtUtils::MakeMaker     *   "VERSION: 6.84"
                       install     *   "VERSION: 6.84"
               IO::SessionData     *   "VERSION: 1.03"
               IO::Socket::SSL     *   "VERSION: 2.016"
                          JSON     *   "VERSION: 2.90"
                  MIME::Base64     *   "VERSION: 3.14"
                  MIME::Base64     *   "VERSION: 3.14"
                   Mozilla::CA     *   "VERSION: 20141217"
                   Net::SSLeay     *   "VERSION: 1.68"
                        parent     *   "VERSION: 0.228"
                  REST::Client     *   "VERSION: 271"
                    SOAP::Lite     *   "VERSION: 1.08"
                  Task::Weaken     *   "VERSION: 1.04"
                 Term::ReadKey     *   "VERSION: 2.31"
                Test::Manifest     *   "VERSION: 1.23"
                  Test::Simple     *   "VERSION: 1.001002"
                  Text::CSV_XS     *   "VERSION: 1.16"
                     Try::Tiny     *   "VERSION: 0.22"
                   XML::LibXML     *   "VERSION: 2.0108"
         XML::NamespaceSupport     *   "VERSION: 1.11"
                XML::SAX::Base     *   "VERSION: 1.08" 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-09-22T20:25:09.377

您可以尝试[ExtUtils-Installed](http://search.cpan.org/dist/ExtUtils-Installed)，但它只在`.packlist`s 中查找，因此它可能会错过人们`@INC`手动移动的模块。

我为一位想在非 shell 网络托管帐户上将其作为 CGI 脚本执行此操作的朋友编写了[App-Module-Lister 。](http://search.cpan.org/dist/App-Module-Lister)您只需获取模块文件并将其作为文件名上传，您的服务器会将其视为 CGI 脚本。它在标准库之外没有依赖项。按原样使用它或窃取代码。

它输出模块列表及其版本：

```
领带::循环 1.15
领带::IxHash 1.21
领带::切换 1.07
领带::ToObject 0.03
时间::CTime 99.062201
时间::DaysInMonth 99.1117
时间::纪元 0.02
时间::模糊 0.34
时间::JulianDay 2003.1125
时间::解析日期 2006.0814
时间::时区 2006.0814

```

我一直想把它作为一个功能添加到`cpan`工具中，所以我也会这样做。[时间流逝]而且，现在我有一个`-l`开关`cpan`。在发布之前，我还有其他一些事情要做，但[它在 github 中](http://github.com/briandfoy/cpan-script/tree/master)。如果您不想等待，您可以尝试使用`-a`开关来创建自动捆绑包，尽管这会将一些 Pod 放在列表中。

祝你好运;

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2011-04-07T07:27:11.997

这是一个可以解决问题的脚本：

```
use ExtUtils::Installed;

my $inst = ExtUtils::Installed->new();
my @modules = $inst->modules();
foreach $module (@modules){
       print $module ." - ". $inst->version($module). "\n";
}

=head1 ABOUT

This scripts lists installed cpan modules using the ExtUtils modules

=head1 FORMAT

Prints each module in the following format
<name> - <version>

=cut 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-09-22T15:34:40.340

我喜欢为此使用 CPAN 'r' 命令。您可以使用旧样式进入 CPAN shell：

```
sudo perl -MCPAN -e shell 
```

或者，在大多数较新的系统上，有一个“cpan”命令，所以这个命令会让你进入 shell：

```
sudo cpan 
```

（您通常必须使用 'sudo' 以 root 身份运行它，或者在运行它之前使用 'su -' 成为 root，除非您已将 cpan 设置为让您以普通用户身份运行它，但以 root 身份安装。如果您在这台机器上没有 root，您仍然可以使用 CPAN shell 来查找此信息，但您将无法安装模块，并且您可能需要在第一次安装时进行一些设置运行。）

然后，一旦您进入 cpan shell，您可以使用“r”命令报告所有已安装的模块及其版本。因此，在“cpan>”提示符下，输入“r”。这将列出所有已安装的模块及其版本。采用 '？' 获得更多帮助。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-01-30T08:13:34.920

```
perl -MFile::Find=find -MFile::Spec::Functions -Tlwe 'find { wanted => sub { print canonpath $_ if /\.pm\z/ }, no_chdir => 1 }, @INC' 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2018-09-29T07:38:48.807

在 Linux/Unix 上，我使用这个简单的命令：

```
perl -e 'print qx/find $_ -name "*.pm"/ foreach ( @INC );' 
```

它扫描所有文件夹`@INC`并查找任何 *.pm 文件。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-22T16:08:06.827

这是在 *nix 中执行此操作的一种非常老套的方法，您会得到一些您并不真正关心的东西（即：warnings::register 等），但它应该为您提供可通过以下方式访问的每个 .pm 文件的列表perl.

```
 for my $path (@INC) {
    my @list = `ls -R $path/**/*.pm`;
    for (@list) {
        s/$path\///g;
        s/\//::/g;
        s/\.pm$//g;
        print;
    }
} 

```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2013-11-14T11:52:19.253

您可以使用`instmodsh`终端中的命令获取系统中安装的 perl 模块列表。它会询问您三个选项以增强它们的输出：

```
 l            - List all installed modules
   m <module>   - Select a module
   q            - Quit the program 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2013-01-30T06:59:23.747

试试下面的命令

安装程序

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2019-09-26T10:05:09.003

所有无法安装 perldoc 或其他模块，并想知道哪些模块可用（CPAN 或其他）的人，以下适用于 linux 和 Mingw32/64：

```
grep -RhIP '^package [A-Z][\w:]+;' `perl -e 'print join " ",@INC'` | sed 's/package //' | sort | uniq 
```

是的，很乱。是的，它可能报告的比你想要的多。但是，如果将其通过管道传输到文件中，则可以轻松地检查存在哪些 dbm 接口：

```
 grep -RhIP '^package [A-Z][\w:]+;' `perl -e 'print join " ",@INC'` | sed 's/package //' | sort | uniq > modules-installed
 cat modules-installed | grep -i dbm 

AnyDBM_File;
Memoize::AnyDBM_File;
Memoize::NDBM_File;
Memoize::SDBM_File;
WWW::RobotRules::AnyDBM_File; 
```

这就是我最终出现在此页面上的原因（失望）

（我意识到这并不能完全回答 OP 的问题，但我将它发布给任何最终出于同样原因来到这里的人。这就是堆栈的问题***几乎不可能找到你的问题问，即使它存在，但 stack*** 几乎总是谷歌的热门！）

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2020-10-12T02:06:05.427

这是@JamesThomasMoon1979 重写为单行的脚本

```
perl -MExtUtils::Installed -e '$i=ExtUtils::Installed->new(); 
      print "$_ ".$i->version($_)."\n" for $i->modules();' 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-05-31T02:00:12.520

答案可以在[Perl FAQ 列表](http://perldoc.perl.org/perlfaq3.html#How-do-I-find-which-modules-are-installed-on-my-system%3f)中找到。

你应该浏览一下 Perl 附带的优秀文档

```
perldoc perltoc 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-06-01T10:28:36.650

尝试`man perllocal`或`perldoc perllocal`。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-22T21:31:09.530

要在不使用 ls(1) 之类的外部程序的情况下遍历 @INC 目录树，可以使用该`File::Find::Rule`模块，该模块具有很好的声明性接口。

此外，如果以前的 Perl 版本包含相同的模块，您希望过滤掉重复项。执行此操作的代码如下所示：

```
#! /usr/bin/perl -l

use strict;
use warnings;
use File::Find::Rule;

my %seen;
for my $path (@INC) {
    for my $file (File::Find::Rule->name('*.pm')->in($path)) {
        my $module = substr($file, length($path)+1);
        $module =~ s/.pm$//;
        $module =~ s{[\\/]}{::}g;
        print $module unless $seen{$module}++;
    }
} 
```

在运行结束时，您还将所有模块名称作为 %seen 哈希中的键。可以修改代码以将规范文件名（在 $file 中给出）保存为键的值，而不是看到的次数。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-05-31T03:49:32.753

我昨天写了一个 perl 脚本来做到这一点。该脚本使用 '::' 作为分隔符返回安装在 @INC 中的 perl 模块列表。使用 - 调用脚本

```
perl perlmod.pl 
```

或者

```
perl perlmod.pl <module name> #Case-insensitive(eg. perl perlmod.pl ftp) 
```

截至目前，脚本跳过当前目录（'.'），因为我在递归软链接方面遇到问题，但您可以通过将第 17 行中的 grep 函数从

```
 grep { $_ !~ '^\.$' } @INC 
```

只是，

```
@INC 
```

可以在[此处找到该脚本。](http://pastebin.com/f79372961)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-11-14T03:02:45.683

这是另一个列出所有已安装 .pm 文件的命令行工具：

[查找与正则表达式匹配的已安装 Perl 模块](http://www.perlmonks.org/?node_id=795418)

*   便携（仅使用核心模块）
*   用于更快查找的缓存选项
*   可配置的显示选项

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-06-22T20:54:03.697

以下对我有用。

```
$ perldoc perllocal | grep Module
$ perldoc perllocal | grep -E 'VERSION|Module' 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2011-05-26T22:42:14.010

Perl 食谱包含脚本“pmdesc”的多次迭代，可以满足您的需求。谷歌搜索“Perl Cookbook pmdesc”，你会发现[其他问答网站](http://kb.ucla.edu/articles/how-do-i-find-what-perl-modules-are-installed-on-my-system)上的文章、网上的一些代码清单、解决方案的讨论，甚至[一些改进](http://www.perlmonks.org/index.pl?node_id=275693)。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2011-08-18T19:18:07.453

这是一个 Perl 单行程序，它将打印出已安装模块的列表：

```
perl -MExtUtils::Installed -MData::Dumper -e  'my ($inst) = ExtUtils::Installed->new(); print Dumper($inst->modules());' 
```

只需确保您已安装 Data::Dumper。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-02-20T20:19:57.367

```
cd /the/lib/dir/of/your/perl/installation
perldoc $(find . -name perllocal.pod) 
```

Windows 用户只需执行 Windows 资源管理器搜索即可找到它。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-09-11T08:35:04.510

试试“perldoc -l”：

$ perldoc -l Log::Dispatch /usr/local/share/perl/5.26.1/Log/Dispatch.pm

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2017-08-19T22:12:45.893

当您输入 Perl 脚本时，所有已安装的模块都以 .pm 文件的形式出现在 @INC 文件夹下，因此一个小的 bash 脚本将为您完成这项工作：

```
#!/bin/bash

echo -e -n "Content-type: text/plain\n\n"

inc=`perl -e '$, = "\n"; print @INC;'`

for d in $inc
do
   find $d -name '*.pm'
done 
```

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2017-11-08T07:24:06.247

对于 Linux，最简单的获取方法是，

```
dpkg -l | grep "perl" 
```

* * *

## 回答 #28

> 赞同：-2
> 
> 时间：2018-05-09T16:43:14.427

这对我有用

```
perl -e 'print join("\n",@INC,"")' 
```

* * *

## 回答 #29

> 赞同：-3
> 
> 时间：2013-04-23T14:57:06.313

这就是我所做的：`perl -M{cpan_module}`
如果您没有收到任何错误，则很有可能安装了该模块。

# algorithm - 检测两个矩形相交的算法？

> ID：115426
> 
> 赞同：146
> 
> 时间：2008-09-22T15:15:53.397
> 
> 标签：algorithm, math, graphics, geometry, separating-axis-theorem

我正在寻找一种算法来检测两个矩形是否相交（一个以任意角度，另一个只有垂直/水平线）。

测试一个角落是否在另一个几乎可以工作。如果矩形形成十字形状，则失败。

避免使用线的斜率似乎是个好主意，这需要垂直线的特殊情况。

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2008-09-22T15:28:21.650

标准方法是进行**分离轴测试**（对此进行谷歌搜索）。

简而言之：

*   如果您能找到一条分隔两个对象的线，则两个对象不会相交。例如，对象/对象的所有点位于线的不同侧。

有趣的是，只需检查两个矩形的所有边缘就足够了。如果矩形不重叠边缘之一将是分离轴。

在 2D 中，您可以在不使用斜坡的情况下执行此操作。一条边被简单地定义为两个顶点之间的差异，例如

```
 edge = v(n) - v(n-1) 
```

您可以通过将其旋转 90° 来获得垂直。在 2D 中，这很简单：

```
 rotated.x = -unrotated.y
  rotated.y =  unrotated.x 
```

所以不涉及三角学或斜率。也不需要将向量标准化为单位长度。

如果您想测试一个点是否在线的一侧或另一侧，您可以使用点积。标志会告诉你你在哪一边：

```
 // rotated: your rotated edge
  // v(n-1) any point from the edge.
  // testpoint: the point you want to find out which side it's on.

  side = sign (rotated.x * (testpoint.x - v(n-1).x) + 
               rotated.y * (testpoint.y - v(n-1).y); 
```

现在测试矩形 A 的所有点对矩形 B 的边缘，反之亦然。如果您发现一个分离边缘，则对象不相交（假设 B 中的所有其他点都在被测试边缘的另一侧 - 参见下图）。如果没有发现分隔边，则矩形相交或一个矩形包含在另一个矩形中。

顺便说一句，该测试适用于任何凸多边形。

**修正：**要识别分离边缘，仅测试一个矩形的所有点与另一个矩形的每个边缘是不够的。候选边 E（下图）将被识别为分离边，因为 A 中的所有点都在 E 的同一半平面中。但是，它不是分离边，因为 B 的顶点 Vb1 和 Vb2也在那个半平面上。如果不是这种情况，它只会是一个分离的边缘 [http://www.iasess.com/collision.png](http://www.iassess.com/collision.png)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-22T15:25:54.727

基本上看下图：

[![](https://i.stack.imgur.com/q9fHm.gif)](https://i.stack.imgur.com/q9fHm.gif)

如果两个框碰撞，线 A 和 B 将重叠。

请注意，这必须在 X 轴和 Y 轴上完成，并且都需要重叠以使矩形发生碰撞。

[gamasutra.com](http://www.gamasutra.com/features/20000330/bobic_01.htm)上有一篇很好的文章回答了这个问题（图片来自文章）。我在 5 年前做过类似的算法，我必须找到我的代码片段以便稍后在此处发布

**修正**：分离轴定理指出，如果存在分离轴（即所示投影**不**重叠的位置），则两个凸形**不**重叠。所以“存在分离轴”=>“没有重叠”。这不是双重含义，因此您无法得出相反的结论。

 *** * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-12-14T12:19:13.883

在 Cocoa 中，您可以轻松检测 selectedArea 矩形是否与旋转的 NSView 的框架矩形相交。您甚至不需要计算多边形、法线等。只需将这些方法添加到您的 NSView 子类中。例如，用户在 NSView 的 superview 上选择一个区域，然后调用方法 DoesThisRectSelectMe 传递 selectedArea rect。API convertRect: 将完成这项工作。当您单击 NSView 以选择它时，同样的技巧也有效。在这种情况下，只需覆盖 hitTest 方法，如下所示。API convertPoint: 将完成这项工作;-)

```
- (BOOL)DoesThisRectSelectMe:(NSRect)selectedArea
{
    NSRect localArea = [self convertRect:selectedArea fromView:self.superview];

    return NSIntersectsRect(localArea, self.bounds);
}

- (NSView *)hitTest:(NSPoint)aPoint
{
    NSPoint localPoint = [self convertPoint:aPoint fromView:self.superview];
    return NSPointInRect(localPoint, self.bounds) ? self : nil;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-11-25T11:53:13.813

m_pGladiator 的回答是正确的，我更喜欢它。 **分离轴测试**是检测矩形重叠的最简单和标准的方法。投影间隔不重叠的线我们称为**分离轴**。Nils Pipenbrinck 的解决方案过于笼统。它使用**点积**来检查一个形状是否完全在另一个边缘的一侧。该解决方案实际上可以诱导为 n 边凸多边形。但是，它没有针对两个矩形进行优化。

m_pGladiator 回答的关键点是我们应该检查两个矩形在两个轴（x 和 y）上的投影。如果两个投影重叠，那么我们可以说这两个矩形重叠。所以上面对 m_pGladiator 的回答的评论是错误的。

对于简单的情况，如果两个矩形不旋转，我们呈现一个具有结构的矩形：

```
struct Rect {
    x, // the center in x axis
    y, // the center in y axis
    width,
    height
} 
```

我们将矩形 A、B 命名为 rectA、rectB。

```
 if Math.abs(rectA.x - rectB.x) < (Math.abs(rectA.width + rectB.width) / 2) 
&& (Math.abs(rectA.y - rectB.y) < (Math.abs(rectA.height + rectB.height) / 2))
    then
        // A and B collide
    end if 
```

如果两个矩形中的任何一个被旋转，可能需要一些努力来确定它们在 x 和 y 轴上的投影。定义 struct RotatedRect 如下：

```
struct RotatedRect : Rect {
    double angle; // the rotating angle oriented to its center
} 
```

不同之处在于 width' 现在有点不同： rectA 的 widthA' ： rectB 的 widthB `Math.sqrt(rectA.width*rectA.width + rectA.height*rectA.height) * Math.cos(rectA.angle)` ' ：`Math.sqrt(rectB.width*rectB.width + rectB.height*rectB.height) * Math.cos(rectB.angle)`

```
 if Math.abs(rectA.x - rectB.x) < (Math.abs(widthA' + widthB') / 2) 
&& (Math.abs(rectA.y - rectB.y) < (Math.abs(heightA' + heightB') / 2))
    then
        // A and B collide
    end if 
```

可以参考一个 GDC(Game Development Conference 2007) PPT [www.realtimecollisiondetection.net/pubs/GDC07_Ericson_Physics_Tutorial_SAT.ppt](http://www.realtimecollisiondetection.net/pubs/GDC07_Ericson_Physics_Tutorial_SAT.ppt)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T15:23:28.383

检查一个矩形的任何线条是否与另一个矩形的任何线条相交。朴素的线段交点很容易编码。

如果您需要更高的速度，可以使用高级算法进行线段相交（扫描线）。见[http://en.wikipedia.org/wiki/Line_segment_intersection](http://en.wikipedia.org/wiki/Line_segment_intersection)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-15T11:56:24.963

一种解决方案是使用一种称为 No Fit Polygon 的东西。这个多边形是根据两个多边形计算出来的（概念上是通过一个围绕另一个滑动），它定义了多边形在给定相对偏移的情况下重叠的区域。一旦你有了这个 NFP，那么你只需要用两个多边形的相对偏移量给出的点进行包含测试。此包含测试既快速又简单，但您必须先创建 NFP。

在网络上搜索 No Fit Polygon，看看是否可以找到凸多边形的算法（如果您有凹多边形，它会变得更加复杂）。如果您找不到任何东西，请发送电子邮件至 howard dot J dot may gmail dot com

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-06-25T01:18:23.057

这是我认为会处理所有可能情况的方法。进行以下测试。

1.  检查矩形 1 的任何顶点是否位于矩形 2 内，反之亦然。每当您找到位于另一个矩形内的顶点时，您都​​可以得出结论，它们相交并停止搜索。这将处理一个完全位于另一个矩形内的矩形。
2.  如果上述测试没有结果，则找出 1 个矩形的每条线与另一个矩形的每条线的交点。一旦找到一个交点，检查它是否位于由相应的 4 个点创建的假想矩形之间。一旦找到这样的点，就可以断定它们相交并停止搜索。

如果上述 2 个测试返回 false，则这 2 个矩形不重叠。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-10-01T19:28:14.353

关于**分离轴测试**的[公认答案](https://stackoverflow.com/a/115520/12131616)非常有启发性，但我仍然觉得应用它并非易事。我将分享我认为的伪代码，首先使用**边界圆测试**“优化” （请参阅[​​this other answer](https://stackoverflow.com/a/6016515/12131616)），以防它可能对其他人有所帮助。我考虑了两个大小相同的矩形 A 和 B（但考虑一般情况很简单）。

 ****## 1 边界圆测试：

![在此处输入图像描述](https://i.stack.imgur.com/uDmiTm.png)

```
 function isRectangleACollidingWithRectangleB:
      if d > 2 * R:
         return False
      ... 
```

计算上比分离轴测试快得多。您只需要考虑两个圆相撞的情况下的分离轴测试。

## 2 分离轴测试

![在此处输入图像描述](https://i.stack.imgur.com/jkovqm.png)

主要思想是：

*   考虑一个矩形。沿其顶点 V(i) 循环。

*   计算向量 Si+1：V(i+1) - V(i)。

*   使用 Si+1 计算矢量 Ni：Ni = (-Si+1.y, Si+1.x)。该向量是图像中的蓝色。从 V(i) 到其他顶点和 Ni 的向量之间的点积的符号将定义分离轴（洋红色虚线）。

*   计算向量 Si-1：V(i-1) - V(i)。Si-1 和 Ni 之间的点积符号将定义第一个矩形相对于分离轴的位置。在图片的示例中，它们朝不同的方向前进，因此符号为负。

*   循环第二个正方形的所有顶点 j 并计算向量 Sij = V(j) - V(i)。

*   如果对于任何顶点 V(j)，向量 Sij 与 Ni 的点积的符号与向量 Si-1 与 Ni 的点积的符号相同，这意味着顶点 V(i) 和 V(j ) 位于品红色虚线的同一侧，因此顶点 V(i) 没有分离轴。所以我们可以跳过顶点 V(i) 并重复下一个顶点 V(i+1)。但首先我们更新 Si-1 = - Si+1。当我们到达最后一个顶点（i = 4）时，如果我们还没有找到分离轴，我们对另一个矩形重复。如果我们仍然没有找到分离轴，这意味着没有分离轴并且两个矩形发生碰撞。

*   如果对于给定的顶点 V(i) 和所有顶点 V(j)，向量 Sij 与 Ni 的点积符号与向量 Si-1 与 Ni 的符号不同（如图所示），这意味着我们发现分离轴和矩形没有碰撞。

在伪代码中：

```
 function isRectangleACollidingWithRectangleB:
      ...
      #Consider first rectangle A:
      Si-1 = Vertex_A[4] - Vertex_A[1]
      for i in Vertex_A:
         Si+1 = Vertex_A[i+1] - Vertex_A[i]
         Ni = [- Si+1.y, Si+1.x ]
         sgn_i = sign( dot_product(Si-1, Ni) ) #sgn_i is the sign of rectangle A with respect the separating axis

         for j in Vertex_B:
            sij = Vertex_B[j] - Vertex_A[i]
            sgn_j = sign( dot_product(sij, Ni) ) #sgnj is the sign of vertex j of square B with respect the separating axis
            if sgn_i * sgn_j > 0: #i.e., we have the same sign
                break #Vertex i does not define separating axis
            else:
                if j == 4: #we have reached the last vertex so vertex i defines the separating axis
                   return False

        Si-1 = - Si+1

      #Repeat for rectangle B
      ...

      #If we do not find any separating axis
      return True 
```

[您可以在此处](https://github.com/Puco4/separating_axis_test/blob/main/separating_axis_test.py)找到 Python 中的代码。

**注意：** 在[这个另一个答案](https://stackoverflow.com/a/6016515/12131616)中，他们还建议在分离轴测试一个矩形的顶点是否在另一个矩形内部作为碰撞的充分条件之前尝试进行优化。然而，在我的试验中，我发现这个中间步骤实际上效率较低。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T15:22:10.430

如果您使用的是 Java，Shape 接口的所有实现都有一个采用矩形的[intersects](http://java.sun.com/javase/6/docs/api/java/awt/Shape.html#intersects(double,%20double,%20double,%20double))方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T15:23:25.530

好吧，蛮力法是走水平矩形的边缘，检查边缘的每个点，看它是落在另一个矩形上还是落在另一个矩形上。

数学答案是形成描述两个矩形的每个边缘的方程。现在您可以简单地查找矩形 A 的四条线中的任何一条是否与矩形 B 的任何一条线相交，这应该是一个简单（快速）的线性方程求解器。

-亚当

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T15:25:37.990

您可以找到倾斜矩形的每一边与轴对齐矩形的每一边的交点。通过找到每一边所在的无限线的方程来做到这一点（即基本上是 v1 + t(v2-v1) 和 v'1 + t'(v'2-v'1)），找到当这两个方程相等时，线通过求解 t 相交（如果它们平行，您可以测试），然后测试该点是否位于两个顶点之间的线段上，即 0 <= t 是否正确<= 1 和 0 <= t' <= 1。

但是，这不包括一个矩形完全覆盖另一个矩形的情况。您可以通过测试任一矩形的所有四个点是否都位于另一个矩形内来覆盖。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T15:27:00.747

*对于这个问题的3D*版本，这就是我要做的：

将 2 个矩形建模为方程 P1 和 P2 描述的平面，然后写出 P1=P2 并从中推导出相交线方程，如果平面平行（不相交）或在同一平面内，则不存在该方程，在这种情况下，你得到 0=0。在这种情况下，您将需要使用 2D 矩形相交算法。

然后我会查看位于两个矩形平面内的那条线是否穿过两个矩形。如果是这样，那么你有 2 个矩形的交集，否则你没有（或者不应该，我可能已经错过了一个角落案例）。

要查找一条线是否通过同一平面中的矩形，我会找到线的 2 个交点和矩形的边（使用线方程对它们进行建模），然后确保交点在范围。

那是数学描述，不幸的是我没有代码来做上面的事情。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-03-26T16:43:35.090

另一种比使用分离轴测试稍快的测试方法是在任一矩形（任意选择）的每个顶点上使用绕组数算法（仅在象限上 -*不是*非常慢的角度求和）。如果任何顶点的绕组数不为零，则两个矩形重叠。

该算法比分离轴测试更冗长，但更快，因为它只需要在边缘穿过两个象限时进行半平面测试（与使用分离轴方法的多达 32 个测试相反）

该算法的另一个优点是它可以用于测试*任何*多边形（凸面或凹面）的重叠。据我所知，该算法仅适用于二维空间。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-01-03T19:30:40.920

要么我错过了其他东西，为什么要让它如此复杂？

如果 (x1,y1) 和 (X1,Y1) 是矩形的角，那么要找到交点：

```
 xIntersect = false;
    yIntersect = false;
    if (!(Math.min(x1, x2, x3, x4) > Math.max(X1, X2, X3, X4) || Math.max(x1, x2, x3, x4) < Math.min(X1, X2, X3, X4))) xIntersect = true;
    if (!(Math.min(y1, y2, y3, y4) > Math.max(Y1, Y2, Y3, Y4) || Math.max(y1, y2, y3, y4) < Math.min(Y1, Y2, Y3, Y4))) yIntersect = true;
    if (xIntersect && yIntersect) {alert("Intersect");} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-03-16T00:34:12.717

我是这样实现的：

```
bool rectCollision(const CGRect &boundsA, const Matrix3x3 &mB, const CGRect &boundsB)
{
    float Axmin = boundsA.origin.x;
    float Axmax = Axmin + boundsA.size.width;
    float Aymin = boundsA.origin.y;
    float Aymax = Aymin + boundsA.size.height;

    float Bxmin = boundsB.origin.x;
    float Bxmax = Bxmin + boundsB.size.width;
    float Bymin = boundsB.origin.y;
    float Bymax = Bymin + boundsB.size.height;

    // find location of B corners in A space
    float B0x = mB(0,0) * Bxmin + mB(0,1) * Bymin + mB(0,2);
    float B0y = mB(1,0) * Bxmin + mB(1,1) * Bymin + mB(1,2);

    float B1x = mB(0,0) * Bxmax + mB(0,1) * Bymin + mB(0,2);
    float B1y = mB(1,0) * Bxmax + mB(1,1) * Bymin + mB(1,2);

    float B2x = mB(0,0) * Bxmin + mB(0,1) * Bymax + mB(0,2);
    float B2y = mB(1,0) * Bxmin + mB(1,1) * Bymax + mB(1,2);

    float B3x = mB(0,0) * Bxmax + mB(0,1) * Bymax + mB(0,2);
    float B3y = mB(1,0) * Bxmax + mB(1,1) * Bymax + mB(1,2);

    if(B0x<Axmin && B1x<Axmin && B2x<Axmin && B3x<Axmin)
        return false;
    if(B0x>Axmax && B1x>Axmax && B2x>Axmax && B3x>Axmax)
        return false;
    if(B0y<Aymin && B1y<Aymin && B2y<Aymin && B3y<Aymin)
        return false;
    if(B0y>Aymax && B1y>Aymax && B2y>Aymax && B3y>Aymax)
        return false;

    float det = mB(0,0)*mB(1,1) - mB(0,1)*mB(1,0);
    float dx = mB(1,2)*mB(0,1) - mB(0,2)*mB(1,1);
    float dy = mB(0,2)*mB(1,0) - mB(1,2)*mB(0,0);

    // find location of A corners in B space
    float A0x = (mB(1,1) * Axmin - mB(0,1) * Aymin + dx)/det;
    float A0y = (-mB(1,0) * Axmin + mB(0,0) * Aymin + dy)/det;

    float A1x = (mB(1,1) * Axmax - mB(0,1) * Aymin + dx)/det;
    float A1y = (-mB(1,0) * Axmax + mB(0,0) * Aymin + dy)/det;

    float A2x = (mB(1,1) * Axmin - mB(0,1) * Aymax + dx)/det;
    float A2y = (-mB(1,0) * Axmin + mB(0,0) * Aymax + dy)/det;

    float A3x = (mB(1,1) * Axmax - mB(0,1) * Aymax + dx)/det;
    float A3y = (-mB(1,0) * Axmax + mB(0,0) * Aymax + dy)/det;

    if(A0x<Bxmin && A1x<Bxmin && A2x<Bxmin && A3x<Bxmin)
        return false;
    if(A0x>Bxmax && A1x>Bxmax && A2x>Bxmax && A3x>Bxmax)
        return false;
    if(A0y<Bymin && A1y<Bymin && A2y<Bymin && A3y<Bymin)
        return false;
    if(A0y>Bymax && A1y>Bymax && A2y>Bymax && A3y>Bymax)
        return false;

    return true;
} 
```

矩阵 mB 是将 B 空间中的点转换为 A 空间中的点的任何仿射变换矩阵。这包括简单的旋转和平移、旋转加缩放和完全仿射扭曲，但不包括透视扭曲。

它可能不是尽可能最佳的。速度不是一个大问题。但是，它似乎对我来说还可以。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-05-26T21:18:25.280

这是已接受答案的 matlab 实现：

```
function olap_flag = ol(A,B,sub)

%A and B should be 4 x 2 matrices containing the xy coordinates of the corners in clockwise order

if nargin == 2
  olap_flag = ol(A,B,1) && ol(B,A,1);
  return;
end

urdl = diff(A([1:4 1],:));
s = sum(urdl .* A, 2);
sdiff = B * urdl' - repmat(s,[1 4]);

olap_flag = ~any(max(sdiff)<0); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-05-27T11:14:48.007

这是常规方法，逐行检查并检查线是否相交。这是 MATLAB 中的代码。

```
C1 = [0, 0];    % Centre of rectangle 1 (x,y)
C2 = [1, 1];    % Centre of rectangle 2 (x,y)
W1 = 5; W2 = 3; % Widths of rectangles 1 and 2
H1 = 2; H2 = 3; % Heights of rectangles 1 and 2
% Define the corner points of the rectangles using the above
R1 = [C1(1) + [W1; W1; -W1; -W1]/2, C1(2) + [H1; -H1; -H1; H1]/2];
R2 = [C2(1) + [W2; W2; -W2; -W2]/2, C2(2) + [H2; -H2; -H2; H2]/2];

R1 = [R1 ; R1(1,:)] ;
R2 = [R2 ; R2(1,:)] ;

plot(R1(:,1),R1(:,2),'r')
hold on
plot(R2(:,1),R2(:,2),'b')

%% lines of Rectangles 
L1 = [R1(1:end-1,:) R1(2:end,:)] ;
L2 = [R2(1:end-1,:) R2(2:end,:)] ;
%% GEt intersection points
P = zeros(2,[]) ;
count = 0 ;
for i = 1:4
    line1 = reshape(L1(i,:),2,2) ;
    for j = 1:4
        line2 = reshape(L2(j,:),2,2) ;
        point = InterX(line1,line2) ;
        if ~isempty(point)
            count = count+1 ;
            P(:,count) = point ;
        end
    end
end
%%
if ~isempty(P)
    fprintf('Given rectangles intersect at %d points:\n',size(P,2))
    plot(P(1,:),P(2,:),'*k')
end 
```

可以从以下位置下载函数 InterX：[https ://in.mathworks.com/matlabcentral/fileexchange/22441-curve-intersections?focused=5165138&tab=function](https://in.mathworks.com/matlabcentral/fileexchange/22441-curve-intersections?focused=5165138&tab=function)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-06-15T21:38:27.507

如果我们有 2 个矩形，我自己有一个更简单的方法：

R1 = (min_x1, max_x1, min_y1, max_y1)

R2 = (min_x2, max_x2, min_y2, max_y2)

它们重叠当且仅当：

重叠 = (max_x1 > min_x2) 和 (max_x2 > min_x1) 和 (max_y1 > min_y2) 和 (max_y2 > min_y1)

你也可以为 3D 盒子做这件事，实际上它适用于任意数量的维度。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-06-18T23:05:51.367

在其他答案中已经说得够多了，所以我只添加伪代码单行：

```
!(a.left > b.right || b.left > a.right || a.top > b.bottom || b.top > a.bottom); 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-11-29T13:12:26.683

检查两个矩形的所有顶点的质心是否位于其中一个矩形内。

# php - 如何在时间格式之间进行转换？

> ID：115428
> 
> 赞同：1
> 
> 时间：2008-09-22T15:16:15.967
> 
> 标签：php, mysql, time, timestamp

我希望使用 将 a 转换为`MySQL timestamp`以秒为单位的纪元时间，`PHP`反之亦然。

最干净的方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T15:27:38.873

See [strtotime](http://www.php.net/strtotime) and [date](http://www.php.net/date) functions in PHP manual.

```
$unixTimestamp = strtotime($mysqlDate);
$mysqlDate = date('Y-m-d h:i:s', $unixTimestamp); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T15:27:03.243

There are two functions in MySQL which are useful for converting back and forth from the unix epoch time that PHP likes:

[from_unixtime()](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_from-unixtime)

[unix_timestamp()](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_unix-timestamp)

For example, to get it back in PHP unix time, you could do:

```
SELECT unix_timestamp(timestamp_col) FROM tbl WHERE ...
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T15:27:57.423

From MySQL timestamp to epoch seconds:

```
strtotime($mysql_timestamp); 
```

From epoch seconds to MySQL timestamp:

```
$mysql_timestamp = date('Y-m-d H:i:s', time()); 
```

# c# - WPF 和字符串格式化

> ID：115431
> 
> 赞同：4
> 
> 时间：2008-09-22T15:16:54.437
> 
> 标签：c#, wpf, xaml, escaping

假设我有一些这样的 XAML：

```
<Window.Resources>
  <v:MyClass x:Key="whatever" Text="foo\nbar" />
</Window.Resources> 
```

显然，我想要 MyClass.Text 属性中的换行符，但 XAML 解析器使用文字字符串“foo\nbar”构造对象。

是否有 (a) 一种方法可以说服解析器翻译转义序列，或者 (b) 一种 .NET 方法以 C# 编译器的方式解释字符串？

我意识到我可以去那里寻找`\n`序列，但如果有一个通用的方法来做到这一点会更好。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-22T18:45:19.053

您可以使用 XML 字符转义

```
<TextBlock Text="Hello&#13;World!"/> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T15:31:32.140

从我的头顶上，尝试；

1.  也许是自定义绑定表达式？

> `<v:MyClass x:Key="whatever" Text="{MyBinder foo\nbar}"/>`

2.  使用字符串静态资源？

3.  使 Text 成为控件的默认属性，并且；

> ```
> <v:MyClass x:Key="whatever">
> foo
> bar
> </v:MyClass> 
> ```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T15:58:44.087

> 我意识到我可以去那里寻找 \n 序列，[...]

如果您只关心 \n，那么您可以尝试以下操作：

```
string s = "foo\\nbar";
s = s.Replace("\\n", "\n"); 
```

或者，对于 b)，因为我不知道也找不到执行此操作的内置函数，例如：

```
using System.Text.RegularExpressions;

// snip
string s = "foo\\nbar";
Regex r = new Regex("\\\\[rnt\\\\]");
s = r.Replace(s, ReplaceControlChars); ;
// /snip

string ReplaceControlChars(Match m)
{
    switch (m.ToString()[1])
    {
        case 'r': return "\r";
        case 'n': return "\n";
        case '\\': return "\\";
        case 't': return "\t";
        // some control character we don't know how to handle
        default: return m.ToString();
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T16:00:59.543

我会在这里使用默认的 TextBlock 控件作为参考。在该控件中，您可以像这样进行换行：

```
 <TextBlock>
        Line 1
        <LineBreak />
        Line 2
    </TextBlock> 
```

通过将控件的内容值设置为文本属性，您应该能够对控件执行类似的操作。

# c# - 解析 Office 文档

> ID：115445
> 
> 赞同：3
> 
> 时间：2008-09-22T15:18:26.463
> 
> 标签：c#, asp.net, ms-office

我希望能够阅读办公文档的内容（用于自定义爬虫）。

需要阅读的office版本是2000年到2007年，主要是爬words，excel和powerpoint文档。

我不想检索格式，只检索其中的文本。

爬虫基于 lucene.NET，如果这可以提供一些帮助并且在 c# 中。

我已经使用 iTextSharp 解析 PDF

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T15:59:31.590

如果您已经在使用 Lucene.NET，您可能只想利用已经可用的各种 IFilter 来执行此操作。看看开源的[SeekAFile](http://sourceforge.net/projects/seekafile/)项目。它将向您展示如何使用 IFilter 从任何可用 IFilter 的文件类型中打开和提取此信息。有适用于 Word、Excel、Powerpoint、PDf 和大多数其他常见文档类型的 IFilter。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T15:31:28.427

有一个优秀的开源项目[POI](https://olex.openlogic.com/packages/poi)，唯一的缺点 - 它是为 Java 编写的。[.net 端口](http://developer.novell.com/wiki/index.php/Poi.Net)在某种程度上是测试版。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T15:44:26.277

[这](http://www.linux.com/feature/52385)是将 Word 文档转换为纯文本的各种工具的一个很好的列表，您可以使用这些工具进行任何操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T15:39:17.160

这是Krishnan LN[在 c-charpcorner 上的一篇不错的小帖子，](http://www.c-sharpcorner.com/UploadFile/Globalking/fileAccessingusingcsharp02242006050207AM/fileAccessingusingcsharp.aspx)它提供了使用 Word Primary Interop 程序集从 Word 文档中获取文本的基本代码。

基本上，您从 Word 文档中获取“WholeStory”属性，将其粘贴到剪贴板，然后将其从剪贴板中拉出，同时将其转换为文本格式。剪贴板步骤大概是为了去除格式。

对于 PowerPoint，您执行类似的操作，但您需要循环播放幻灯片，然后为每个幻灯片循环播放形状，并获取每个形状中的“TextFrame.TextRange.Text”属性。

对于 Excel，由于 Excel 可以是 OleDb 数据源，因此使用 ADO.NET 是最简单的。这是[Laurent Bugnion 的一篇很好的文章，介绍](http://geekswithblogs.net/lbugnion/archive/2006/08/25.aspx)了这种技术。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-25T16:43:15.310

您也可以考虑查看 DtSearch (www.DtSearch.com)。虽然它主要是一个搜索工具，但它在从大量文件类型中提取文本方面做得很好，并且比其他选项（如 Oracle/Stellent OutsideIn 技术或 Autonomy 的同等技术）便宜得多。

我多年来一直在使用 DtSearch，并且发现它对于此类任务是必不可少的。

# math - 生成数学方程图像文件的在线工具

> ID：115459
> 
> 赞同：37
> 
> 时间：2008-09-22T15:20:20.047
> 
> 标签：math, image

我正在寻找一种在线工具，它可以让我创建一个像这样的 gif 或 png：

![替代文字](https://upload.wikimedia.org/math/b/4/7/b477e400396c711c60c4302bbbd888ae.png)

某种 LaTex 在线服务，有友好的例子吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-06-02T14:07:22.093

我使用[Roger's Online Equation Editor](http://rogercortesi.com/eqn/index.php)。

PNG，颜色，透明背景和抗锯齿都包括在内。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2015-03-11T22:45:07.100

就个人而言，[iTex2Img](http://www.sciweavers.org/free-online-latex-equation-editor)比[Roger 的 Online Equation Editor](http://rogercortesi.com/eqn/index.php)好得多。这是带有示例的屏幕截图：

![在此处输入图像描述](https://i.stack.imgur.com/r6SKe.png)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-05-29T20:41:53.270

[http://www.codecogs.com/latex/eqneditor.php](http://www.codecogs.com/latex/eqneditor.php)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-07-03T15:30:33.437

我第二个 hyperlogic 的建议 ( [http://www.codecogs.com/latex/eqneditor.php](http://www.codecogs.com/latex/eqneditor.php) ) 你可以使用 GET url 获取图像，例如[http://latex.codecogs.com/gif.latex?%5Cint_ %7B0%7D%5E%7B%5Cinfty%20%7D%20x%5E%7Bt%7D%20dt](http://latex.codecogs.com/gif.latex?%5Cint_%7B0%7D%5E%7B%5Cinfty%20%7D%20x%5E%7Bt%7D%20dt)给出：

![在此处输入图像描述](https://i.stack.imgur.com/3SAzR.gif)

主页可帮助您获取编码的 url。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-19T03:16:43.353

我使用[TeXer](http://www.artofproblemsolving.com/Resources/texer.php)从 LaTeX 创建图像。它创建具有透明背景的 gif。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-11-18T03:04:31.120

我正在寻找解决方案并遇到了这个问题。我尝试了此页面中建议的大多数解决方案。但我发现以下内容符合我的需求。这是一个易于使用的 REST API。

[http://api.toolswebtop.com/math/](http://api.toolswebtop.com/math/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T15:22:13.893

[http://smarth.sourceforge.net/](http://smarth.sourceforge.net/)

并在[http://www.physicsforums.com/showthread.php?t=8997实施](http://www.physicsforums.com/showthread.php?t=8997)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-30T19:33:28.030

[http://wolframalpha.com/](http://wolframalpha.com/) 一直有效:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-03-23T21:50:48.593

在线工具： http:
[//www.aprendematematicas.org.mx/profesores/latex.html#Editor](http://www.aprendematematicas.org.mx/profesores/latex.html#Editor)

如果您想将其包含在您的网站中：http:
[//www.codecogs.com/latex/about.php](http://www.codecogs.com/latex/about.php)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-11-09T04:44:38.223

我维护支持 MathML 并且可以输出 PNG 永久链接的[ShareMath.com 。](http://ShareMath.com)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-08-01T10:54:57.007

[http://www.mathjax.org](http://www.mathjax.org) MathJax 是一个开源的 JavaScript 数学显示引擎，适用于所有浏览器。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-11-24T20:32:54.073

已验证是维基百科，您可以使用[沙盒，](http://en.wikipedia.org/wiki/Wikipedia:Sandbox)[帮助](http://en.wikipedia.org/wiki/Help:Displaying_a_formula)中描述的所有内容都可以正常工作。

我没有找到其他页面可以创建这个等式：

![mdist(A, P) & = |A_x - P_x|  + |A_y - P_y|  \ & =max(A_x - P_x, P_x - A_x) + 最大值(A_y - P_y, P_y - A_y)](https://i.stack.imgur.com/BO6bZ.png)

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-09-22T15:22:58.183

[http://www.mr.ethz.ch/~majer/formula/formula.php](http://www.mr.ethz.ch/~majer/formula/formula.php)

# language-agnostic - 按比例调整图像大小

> ID：115462
> 
> 赞同：31
> 
> 时间：2008-09-22T15:20:41.667
> 
> 标签：language-agnostic, image-manipulation

我在将图像缩放到正确预定义的大小时遇到​​了一点问题。我想知道 - 因为它是纯粹的数学，是否有某种通用的逻辑算法适用于每种语言（PHP、ActionScript、Javascript 等）来按比例缩放图像。

我现在正在使用这个：

```
var maxHeight   = 300;
var maxWidth    = 300;

var ratio:Number    =   height / width;

if (height > maxHeight) {
    height = maxHeight;
    width = Math.round(height / ratio);
} 

else if(width > maxWidth) {
    width = maxWidth;
    height = Math.round(width * ratio);
} 
```

但它不能正常工作。图像按比例缩放，确实如此，但尺寸未设置为 300（宽度或高度）。这有点道理，但我想知道是否有一种简单、简单的方法来按比例缩放图像。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-09-22T15:24:33.407

```
ratio = MIN( maxWidth / width, maxHeight/ height );
width = ratio * width;
height = ratio * height; 
```

确保所有除法都是浮点数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T17:01:14.657

黑暗 Shikari 有它。您在问题中所述的解决方案失败了，因为您没有*首先*确定哪个维度的尺寸与最大尺寸的比率更大，*然后*将两个维度都减小了更大的比率。

您当前的解决方案使用对一个潜在的尺寸违规进行连续条件分析，然后另一个将不起作用。

另请注意，如果您想升级*图像*，您当前的解决方案将无法运行，而 Dark Shikari 的再次会。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T15:23:57.260

我建议不要自己编写此代码；有无数像素级细节需要很长时间才能正确处理。使用 ImageMagick，它是最好的图形库。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-29T19:44:52.197

这是我的做法：

```
+ (NSSize) scaleHeight:(NSSize)origSize 
             newHeight:(CGFloat)height {

    NSSize newSize = NSZeroSize;
    if ( origSize.height == 0 ) return newSize;

    newSize.height = height;
    CGFloat factor = ( height / origSize.height );
    newSize.width  = (origSize.width * factor );

    return newSize;
}

+ (NSSize) scaleWidth:(NSSize)origSize 
             newWidth:(CGFloat)width {

    NSSize newSize = NSZeroSize;
    if ( origSize.width == 0 ) return newSize;

    newSize.width  = width;
    CGFloat factor = ( width / origSize.width );
    newSize.height = (origSize.height * factor );

    return newSize;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-12T20:39:22.727

这是我为我的网站开发的功能，您可能想要使用。这是基于你上面的答案。

它不仅做图像处理，还做其他事情——**请删除所有不必要**的东西。

```
<?php

$thumb_width    = 500;
$thumb_height   = 500;

if ($handle = opendir('to-do')) {
    echo "Directory handle: $handle<br />";
    echo "Files:<br /><br />";

    /* This is the correct way to loop over the directory. */
    while (false !== ($file = readdir($handle))) {

        if ( ($file != ".") && ($file != "..") ){
            echo "$file";

            $original_path = "to-do/" . $file;

            $source_image = ImageCreateFromJPEG( $original_path );
            $thumb_width = $thumb_width;
            $thumb_height = $thumb_height;

            // Create the image, of the required size
            $thumbnail = imagecreatetruecolor($thumb_width, $thumb_height);
            if($thumbnail === false) {
                //creation failed -- probably not enough memory
                return null;
            }

            // Fill the image with a white color (this will be visible in the padding around the image,
            // if the aspect ratios of the image and the thumbnail do not match)
            // Replace this with any color you want, or comment it out for black.
            // I used grey for testing =)
            $fill = imagecolorallocate($thumbnail, 255, 255, 255);
            imagefill($thumbnail, 0, 0, $fill);

            // Compute resize ratio
            $hratio = $thumb_height / imagesy($source_image);
            $wratio = $thumb_width / imagesx($source_image);
            $ratio = min($hratio, $wratio);

            // If the source is smaller than the thumbnail size, 
            // Don't resize -- add a margin instead
            // (that is, dont magnify images)
            if ($ratio > 1.0)
                $ratio = 1.0;

            // Compute sizes
            $sy = floor(imagesy($source_image) * $ratio);
            $sx = floor(imagesx($source_image) * $ratio);

            // Compute margins
            // Using these margins centers the image in the thumbnail.
            // If you always want the image to the top left, set both of these to 0
            $m_y = floor(($thumb_height - $sy) / 2);
            $m_x = floor(($thumb_width - $sx) / 2);

            // Copy the image data, and resample
            // If you want a fast and ugly thumbnail, replace imagecopyresampled with imagecopyresized
            if (!imagecopyresampled($thumbnail, $source_image,
                $m_x, $m_y, //dest x, y (margins)
                0, 0, //src x, y (0,0 means top left)
                $sx, $sy,//dest w, h (resample to this size (computed above)
                imagesx($source_image), imagesy($source_image)) //src w, h (the full size of the original)
            ) {
                //copy failed
                imagedestroy($thumbnail);
                return null;
            }

            /* Set the new file name */
            $thumbnail_file_name = $file;

            /* Apply changes on the original image and write the result on the disk */
            ImageJPEG( $thumbnail, $complete_path . "done/" . $thumbnail_file_name );
            unset($source_image);
            unset($thumbnail);
            unset($original_path);
            unset($targeted_image_size);

            echo " done<br />";

        }

    }

    closedir($handle);
}

?> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-22T12:26:31.777

好吧，我让这个函数按比例缩放，它使用给定的宽度、高度，以及你想要的可选的最大宽度/高度（取决于给定的宽度和高度）

```
 function scaleProportional($img_w,$img_h,$max=50)
   {
       $w = 0;
       $h = 0;

       $img_w > $img_h ? $w = $img_w / $img_h : $w = 1;
       $img_h > $img_w ? $h = $img_h / $img_w : $h = 1;

       $ws = $w > $h ? $ws = ($w / $w) * $max : $ws = (1 / $h) * $max;
       $hs = $h > $w ? $hs = ($h / $h) * $max : $hs = (1 / $w) * $max;

       return array(
           'width'=>$ws,
           'height'=>$hs
       );
   } 
```

用法：

```
 $getScale = scaleProportional(600,200,500);
            $targ_w = $getScale['width']; //returns 500
            $targ_h = $getScale['height']; //returns 16,6666667 
```

# javascript - 在 Visual Studio 中调试 JavaScript 时“没有为当前文档加载符号”

> ID：115472
> 
> 赞同：22
> 
> 时间：2008-09-22T15:21:36.580
> 
> 标签：javascript, asp.net, visual-studio, debugging

我正在开发一个 .NET 3.5 网站，一个解决方案下包含三个项目。我在这个项目中使用 jQuery。我想使用 Visual Studio JavaScript 调试器来单步调试我的 JavaScript 代码。如果我在任何 .js 文件中设置断点，我会收到一条警告：

> 当前不会命中断点。没有为此文档加载任何符号。

我该如何解决？我猜 Visual Studio 在解析一些 jQuery 代码时遇到了一些麻烦。我会尝试`jQuery.js`用扩展版本替换最小化版本，但我认为这不会解决它。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-21T17:10:10.567

我在 Visual Studio 2008 中遇到了相同的行为，在花了几分钟试图让符号加载后，我最终使用了一种解决方法 - 添加一行“调试器”；我的 JavaScript 文件中的命令。

添加之后`debugger;`，当您在 Internet Explorer 中重新加载脚本时，它会让您启动脚本调试器的新实例，并且它会在您的调试器命令上停止，让您从那里进行调试。

在这种情况下，我已经在[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)中调试 JavaScript ，但我也想针对 Internet Explorer 进行调试。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-06T14:56:12.900

确保在 Internet 选项中打开[脚本调试。](http://msdn.microsoft.com/en-us/library/z959x58c.aspx)如果您认为它已开启，请仔细检查。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-08-14T14:25:24.550

我遇到了同样的问题，但我通过更改 Internet Explorer 中的浏览器设置解决了这个问题。转到菜单*Tools* -> *Internet Options*，选择*Advanced*选项卡，然后确保未选中“Disable Script Debugging (Internet Explorer)”和“Disable Script Debugging (Other)”。

另外，我需要将 Internet Explorer 设置为我的默认浏览器，通常设置为 Firefox。为此，在 Visual Studio 中，只需右键单击[解决方案资源管理器](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Other_tools)中的任何可浏览文件并选择“浏览方式...”选择 Internet Explorer 并单击“设置为默认值”。

我不确定是否有办法让调试在其他浏览器上运行，但如果 Visual Studio 只在 Internet Explorer 上运行良好，我不会感到惊讶。

此外，您可能需要执行“附加到进程”并添加`IExplorer.exe`以启动调试器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T13:09:48.230

我建议使用[FireBug](http://www.getfirebug.com/)进行 JavaScript 调试。试一试:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-09T14:22:47.033

我终于找到了我认为的答案。

当您将调试器附加到 iexplore.exe 进程时，您需要确保选择“脚本”作为调试选项之一。

它是此处红框中的按钮：[附加到进程窗口中选择按钮的屏幕截图](http://screencast.com/t/5uAUb3g9H8)

然后在下一个屏幕上，选择脚本：[选择代码类型窗口的屏幕截图](http://screencast.com/t/AeWH27rc)

这将警告您不能同时调试托管和脚本，但这应该没问题，因为您的托管代码是您的服务器代码，而您附加到 Web 进程（aspnet 或 w3wp）。

您会知道您做对了，因为 VS 2008 将在解决方案资源管理器中加载与该页面相关的所有脚本文档（内联内容、评估内容等）。

您将拥有对 DOM 的完全访问权限，即时窗口将正常工作，等等。它非常流畅。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-09-25T20:40:59.297

您可能要寻找的另一件事是 JavaScript 代码中的语法错误。这就是今天发生在我身上的事。不会加载任何符号，因为我的代码中有太多括号。IntelliSense 几乎没有记录错误。修复语法错误后，一切正常。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-06-27T22:09:20.947

所有这些答案都是正确的，但还有一件事需要检查。直到昨天，我始终能够从 Visual Studio ( [2012](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2012) ) 内部调试我的 JavaScript 代码。我在解决方案中添加了一个[Silverlight](http://en.wikipedia.org/wiki/Microsoft_Silverlight)项目，它打开了 Silverlight 调试器。这是我的问题。

在 Web 应用程序的属性页 -> 启动选项 -> 页面底部，确保未选中“Silverlight”。实际上，我只检查了 ASP.NET，现在调试器通过了 Visual Studio。

取消选中它，现在调试器在我想要的“初始化”功能上停止。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T15:56:16.467

您必须等待 IDE 解析 JavaScript 代码。稍等片刻，您应该会看到 JavaScript 代码更改颜色。然后，您将能够添加断点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-09-30T18:13:49.150

我的解决方案是将 IE 从版本 9 更新到 11。希望它对某人有所帮助。和平！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-01-16T01:00:06.883

[我在Visual Studio 2013](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2013)上遇到了同样烦人的问题，没有调试器的 JavaScript 开发简直就是自杀。

我所做的只是右键单击断点红点->*禁用断点*，然后再次右键单击->启用断点。

这使得调试器再次像魅力一样在 JavaScript 上工作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-01T14:59:29.747

我有时会在外部 JavaScript 文件中遇到这个问题 - 这是由浏览器缓存保留文件的旧副本引起的。强制刷新链接到 JavaScript 代码的页面可以解决这种情况下的问题。

当然，请确保您的调试器连接到正确的浏览器进程。;)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-11-21T19:10:33.633

这可能是显而易见的，但我偶然发现了这一点，所以也许其他人也会。我没有设置 Internet Explorer 来处理 HTML/HTTP，因此当我在 Visual Studio 中按下运行按钮时它没有启动。

相反，我正在启动 Firefox。我去了**开始按钮 | 默认程序**，为 Internet Explorer 设置所有默认值，然后调试开始在 Visual Studio 中为我工作，没有任何其他大惊小怪。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-03-02T22:01:11.257

当您的解决方案有多个 Web 项目时，也会发生这种情况，即使它们是从不同端口上的不同 ASP.NET 开发服务器 (WebDev.WebServer40.exe) 实例提供服务的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-03-22T22:53:30.420

如果在您的解决方案中运行两个或多个 Web 项目，并且您在不同 Web 的同一位置有多个同名脚本文件，则开发 Web 服务器可能会提供错误的文件，从而导致此问题。

就我而言，删除多余的副本解决了这个问题。

# asp.net-mvc - MVC Preview 5 - ViewData/HTML Helper Quirk

> ID：115478
> 
> 赞同：1
> 
> 时间：2008-09-22T15:22:26.953
> 
> 标签：asp.net-mvc, viewdata

以下代码在`/Courses/Detail`操作中：

```
 [AcceptVerbs("GET")]
    public ActionResult Detail(int id)
    {
        ViewData["Title"] = "A View Title";
        return View(tmdc.GetCourseById(id));
    } 
```

该方法返回视图`tmdc.GetCourseById(id)`类型的实例。`Course`在我正在使用的视图中

```
<%= HTML.TextBox("Title")%> 
```

显示对象的`Title`属性值`Course`。相反，文本框显示的是字符串`A View Title`。这是正常/预期的行为吗？处理这个问题的最佳方法是什么？

**更新**
作为一种解决方法，我已更改`ViewData["Title"]`为`ViewData["VIEW_TITLE"]`但想要一种更清洁的方式来处理此冲突或知道这是否是预期结果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T16:56:32.687

不幸的是，我现在不在我的开发机器上，所以我无法测试这个，但是你有没有尝试过这样的事情？

```
<%= Html.TextBox("Title", ViewData.Model.Title) %> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T17:02:01.970

是的，这种行为是按设计的。目的是您应该能够显示（在您的视图中）无效的用户输入，这些输入实际上永远不会被分配为模型类型实例的属性。[您可以在此博客文章](http://weblogs.asp.net/stephenwalther/archive/2008/08/13/asp-net-mvc-tip-32-repopulate-form-fields-with-viewdata-eval.aspx)中阅读有关此功能的更多信息。

您的解决方法很好，但它确实突出了拥塞视图命名空间的问题。请记住，除了模型和 ViewData 的属性之外，还有 TempData、ModelState 和 HTML 内容。

如果您总是想要显示模型属性“Title”，那么您可能想要使用接受文字值而不是属性名称的 HTML.TextBox 重载之一。

# c# - 在安装 .Net 服务期间创建自定义事件日志和事件源的最可靠方法是什么

> ID：115488
> 
> 赞同：25
> 
> 时间：2008-09-22T15:23:57.307
> 
> 标签：c#, .net, windows-services, event-log, eventlog-source

在安装 .Net Windows 服务期间，我难以可靠地创建/删除事件源。

这是我的 ProjectInstaller 类的代码：

```
// Create Process Installer
ServiceProcessInstaller spi = new ServiceProcessInstaller();
spi.Account = ServiceAccount.LocalSystem;

// Create Service
ServiceInstaller si = new ServiceInstaller();
si.ServiceName = Facade.GetServiceName();
si.Description = "Processes ...";
si.DisplayName = "Auto Checkout";
si.StartType = ServiceStartMode.Automatic;

// Remove Event Source if already there
if (EventLog.SourceExists("AutoCheckout"))
    EventLog.DeleteEventSource("AutoCheckout");

// Create Event Source and Event Log     
EventLogInstaller log = new EventLogInstaller();
log.Source = "AutoCheckout";
log.Log = "AutoCheckoutLog";

Installers.AddRange(new Installer[] { spi, si, log }); 
```

引用的外观方法只返回日志、服务等名称的字符串。

此代码大部分时间都有效，但最近在安装后，我开始让我的日志条目显示在应用程序日志中，而不是自定义日志中。日志中还有以下错误：

> 找不到源 (AutoCheckout) 中事件 ID (0) 的描述。本地计算机可能没有必要的注册表信息或消息 DLL 文件来显示来自远程计算机的消息。您可以使用 /AUXSOURCE= 标志来检索此描述；有关详细信息，请参阅帮助和支持。

由于某种原因，它要么在卸载期间没有正确删除源，要么在安装期间没有创建它。

感谢您对此处最佳实践的任何帮助。

谢谢！

此外，这是我如何将异常写入日志的示例：

```
// Write to Log
EventLog.WriteEntry(Facade.GetEventLogSource(), errorDetails, EventLogEntryType.Error, 99); 
```

**关于 stephbu 的回答：**推荐的路径是安装程序脚本和 installutil，或 Windows 安装程序。

我正在使用一个安装项目，它执行服务的安装并设置日志。无论我使用 installutil.exe 还是 windows 安装项目，我相信它们都调用了我上面显示的相同的 ProjectInstaller 类。

如果在重新启动之前没有真正删除日志，我会看到我的测试机器的状态如何导致错误。我将进行更多实验，看看是否能解决问题。

**编辑：** 我对在安装服务期间注册源和日志名称的可靠方式感兴趣。因此，如果该服务之前已安装，它将删除源，或在后续安装期间重用源。

我还没有机会学习 WiX 来尝试这条路线。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-08-17T10:59:49.320

该类`ServiceInstaller`会自动创建一个`EventLogInstaller`并将其放入自己的 Installers 集合中。

试试这个代码：

```
ServiceProcessInstaller serviceProcessInstaller = new ServiceProcessInstaller();
serviceProcessInstaller.Password = null;
serviceProcessInstaller.Username = null;
serviceProcessInstaller.Account = ServiceAccount.LocalSystem;

// serviceInstaller
ServiceInstaller serviceInstaller = new ServiceInstaller();
serviceInstaller.ServiceName = "MyService";
serviceInstaller.DisplayName = "My Service";
serviceInstaller.StartType = ServiceStartMode.Automatic;
serviceInstaller.Description = "My Service Description";
// kill the default event log installer
serviceInstaller.Installers.Clear(); 

// Create Event Source and Event Log     
EventLogInstaller logInstaller = new EventLogInstaller();
logInstaller.Source = "MyService"; // use same as ServiceName
logInstaller.Log = "MyLog";

// Add all installers
this.Installers.AddRange(new Installer[] {
   serviceProcessInstaller, serviceInstaller, logInstaller
}); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-22T17:22:57.163

这里有几件事

动态创建事件日志和源是非常不受欢迎的。主要是因为执行该操作所需的权限 - 您真的不想用这种权力来祝福您的应用程序。

此外，如果您删除事件日志或源，则只有在服务器重新启动时才会*真正*删除该条目，因此如果您删除并重新创建条目而不弹跳框，您可能会进入奇怪的状态。由于元数据在注册表中的存储方式，还有一堆关于命名冲突的不成文规则。

推荐的路径是安装程序脚本和 installutil，或 Windows 安装例程。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T10:44:46.207

最好的建议是不要在 Visual Studio 中使用安装项目。它有非常严重的局限性。[我用WiX](http://wix.sourceforge.net/)取得了非常好的结果

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T14:56:17.117

我必须同意 stephbu 关于事件日志进入的“奇怪状态”，我之前遇到过。如果我猜的话，你的一些困难就在那里。

但是，据我所知，在应用程序中进行事件记录的最佳方法实际上是使用 TraceListener。您可以通过服务的 app.config 配置它们：

[http://msdn.microsoft.com/en-us/library/system.diagnostics.eventlogtracelistener.aspx](http://msdn.microsoft.com/en-us/library/system.diagnostics.eventlogtracelistener.aspx)

该页面中间附近有一个部分描述了如何使用 EventLog 属性来指定要写入的 EventLog。

希望有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-09T08:03:43.427

我也遵循**了 helb 的**建议，除了我基本上使用了标准设计器生成的类（默认对象“ServiceProcessInstaller1”和“ServiceInstaller1”）。我决定发布这个，因为它是一个稍微简单的版本；也因为我在 VB 中工作，人们有时喜欢看 VB 方式。

正如**tartheode**所说，您不应该修改ProjectInstaller.Designer.vb文件中设计器生成的ProjectInstaller类*，*但您*可以*修改 **ProjectInstaller.vb**文件中的代码。在创建一个普通的 ProjectInstaller（使用标准的“添加安装程序”机制）之后，我所做的唯一更改是在 ProjectInstaller 类的 New() 中。在正常的“InitializeComponent()”调用之后，我插入了这段代码：

```
 ' remove the default event log installer 
  Me.ServiceInstaller1.Installers.Clear()

  ' Create an EventLogInstaller, and set the Event Source and Event Log      
  Dim logInstaller As New EventLogInstaller
  logInstaller.Source = "MyServiceName"
  logInstaller.Log = "MyCustomEventLogName"

  ' Add the event log installer
  Me.ServiceInstaller1.Installers.Add(logInstaller) 
```

这按预期工作，因为安装程序没有**在**应用程序日志中创建事件源，而是在新的自定义日志文件中创建。

但是，我已经搞砸了，以至于我在一台服务器上有点乱。自定义日志的问题在于，如果存在与**错误**日志文件关联的事件源名称（例如“应用程序”日志而不是您的新自定义日志），则必须首先删除源名称；然后机器重新启动；然后可以创建与正确日志关联的源。Microsoft 帮助明确指出（在[EventLogInstaller 类描述中](http://msdn.microsoft.com/en-us/library/system.diagnostics.eventloginstaller.aspx)）：

> 如果 Source 属性与为计算机上的不同事件日志注册的源名称匹配，Install 方法将引发异常。

因此，我的服务中也有这个功能，在服务启动时调用：

```
 Private Function EventLogSourceNameExists() As Boolean
      'ensures that the EventSource name exists, and that it is associated to the correct Log 

      Dim EventLog_SourceName As String = Utility.RetrieveAppSetting("EventLog_SourceName")
      Dim EventLog_LogName As String = Utility.RetrieveAppSetting("EventLog_LogName")

      Dim SourceExists As Boolean = EventLog.SourceExists(EventLog_SourceName)
      If Not SourceExists Then
         ' Create the source, if it does not already exist.
         ' An event log source should not be created and immediately used.
         ' There is a latency time to enable the source, it should be created
         ' prior to executing the application that uses the source.
         'So pass back a False to cause the service to terminate.  User will have 
         'to re-start the application to make it work.  This ought to happen only once on the 
         'machine on which the service is newly installed

         EventLog.CreateEventSource(EventLog_SourceName, EventLog_LogName)  'create as a source for the SMRT event log
      Else
         'make sure the source is associated with the log file that we want
         Dim el As New EventLog
         el.Source = EventLog_SourceName
         If el.Log <> EventLog_LogName Then
            el.WriteEntry(String.Format("About to delete this source '{0}' from this log '{1}'.  You may have to kill the service using Task Manageer.  Then please reboot the computer; then restart the service two times more to ensure that this event source is created in the log {2}.", _
            EventLog_SourceName, el.Log, EventLog_LogName))

            EventLog.DeleteEventSource(EventLog_SourceName)
            SourceExists = False  'force a close of service
         End If
      End If
      Return SourceExists
   End Function 
```

如果函数返回 False，则服务启动代码只是停止服务。此功能几乎可以确保您最终获得与正确事件日志文件关联的正确事件源名称。您可能需要重新启动机器一次；您可能需要多次尝试启动该服务。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T09:39:10.490

我有同样的问题。在我的情况下，Windows 安装程序似乎正在自动添加与我的服务同名的事件源，这似乎会导致问题。您是否对 Windows 服务和日志源使用相同的名称？尝试更改它，以便您的事件日志源的调用方式与服务名称不同。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-09T23:02:13.970

我刚刚在 MSDN 论坛上发布了一个解决方案，我设法使用标准设置 MSI 项目解决了这个问题。我所做的是将代码添加到 PreInstall 和 Committed 事件中，这意味着我可以将其他所有内容保持原样：

```
SortedList<string, string> eventSources = new SortedList<string, string>();
private void serviceProcessInstaller_BeforeInstall(object sender, InstallEventArgs e)
{
  RemoveServiceEventLogs();
}

private void RemoveServiceEventLogs()
{
  foreach (Installer installer in this.Installers)
    if (installer is ServiceInstaller)
    {
      ServiceInstaller serviceInstaller = installer as ServiceInstaller;
      if (EventLog.SourceExists(serviceInstaller.ServiceName))
      {
        eventSources.Add(serviceInstaller.ServiceName, EventLog.LogNameFromSourceName(serviceInstaller.ServiceName, Environment.MachineName));
        EventLog.DeleteEventSource(serviceInstaller.ServiceName);
      }
    }
}

private void serviceProcessInstaller_Committed(object sender, InstallEventArgs e)
{
  RemoveServiceEventLogs();
  foreach (KeyValuePair<string, string> eventSource in eventSources)
  {
    if (EventLog.SourceExists(eventSource.Key))
      EventLog.DeleteEventSource(eventSource.Key);

    EventLog.CreateEventSource(eventSource.Key, eventSource.Value);
  }
} 
```

可以进一步修改代码以仅删除尚不存在的事件源或创建它们（尽管需要将日志名存储在安装程序的某个位置），但是由于我的应用程序代码实际上在运行时创建了事件源那么对我来说就没有意义了。如果已经有事件，那么应该已经有一个事件源。为确保它们已创建，您只需自动启动服务即可。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-08T16:49:14.467

我遇到了一些类似的奇怪行为，因为我试图注册一个与我正在启动的服务同名的事件源。

我注意到您还将 DisplayName 设置为与事件源相同的名称。

在启动服务时，我们发现 Windows 在应用程序日志中记录了“服务已成功启动”条目，源为 DisplayName。这似乎具有在应用程序日志中注册*应用程序名称的效果。*

在我的事件记录器类中，我后来尝试将*应用程序名称*注册为具有不同事件日志的源，但是在添加新的事件日志条目时，它们总是被添加到应用程序日志中。

我还多次收到“源中事件 ID (0) 的描述”消息。

作为一种解决方法，我只是将消息源注册为与 DisplayName 稍有不同的名称，并且从那以后它就一直有效。如果您还没有，那么值得尝试一下。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-11T05:45:02.563

问题来自 installutil，它默认在“应用程序”事件日志中使用您的服务名称注册事件源。我仍在寻找一种方法来阻止它做这种废话。如果能影响 installutil 的行为，那就太好了 :(

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-10T20:55:04.843

遵循**helb 的**建议为我解决了这个问题。在他的示例中指出的点处，终止默认事件日志安装程序会阻止安装程序在应用程序事件日志下自动注册我的 Windows 服务。

试图解决这个令人沮丧的怪癖浪费了太多时间。太感谢了！

FWIW，我无法修改我的设计器生成的 ProjectInstaller 类中的代码，而不会导致 VS 对 mods 抱怨。我废弃了设计器生成的代码并手动输入了课程。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-02-26T21:59:08.733

向 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\eventlog\Application\MY_CUSTOM_SOURCE_NAME_HERE 添加一个空的注册表项似乎可以正常工作。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-01-23T13:49:33.327

更改默认行为（即项目安装程序在应用程序日志中使用您的服务名称创建事件日志源）的一种简单方法是轻松修改项目安装程序的构造函数，如下所示：

```
[RunInstaller( true )]
public partial class ProjectInstaller : System.Configuration.Install.Installer
{
    public ProjectInstaller()
    {
        InitializeComponent();

        //Skip through all ServiceInstallers.
        foreach( ServiceInstaller ThisInstaller in Installers.OfType<ServiceInstaller>() )
        {
            //Find the first default EventLogInstaller.
            EventLogInstaller ThisLogInstaller = ThisInstaller.Installers.OfType<EventLogInstaller>().FirstOrDefault();
            if( ThisLogInstaller == null )
                continue;

            //Modify the used log from "Application" to the same name as the source name. This creates a source in the "Applications and Services log" which separates your service logs from the default application log.
            ThisLogInstaller.Log = ThisLogInstaller.Source;
        }
    }
} 
```

# visual-studio - 如何说服我的团队放弃 sourcesafe 并转向 SVN？

> ID：115493
> 
> 赞同：64
> 
> 时间：2008-09-22T15:24:46.993
> 
> 标签：visual-studio, svn, version-control, visual-sourcesafe

我的开发团队在非常基础的层面上使用源代码安全。我们正在进入一些更高级和扩展的开发周期，我不禁认为不使用分支和合并来管理更改很快就会对我们不利。

为了说服您的团队转向像 SVN 这样更好的解决方案，您认为哪些论点最有用？

您使用了哪些程序来弥补功能差距，以便团队不会错过 ide sourcesafe 集成？

还是我应该接受 sourcesafe 并尝试将更好的做法硬塞进去？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-22T15:40:09.467

## 可靠性

*   SVN 对于大型数据库更可靠
*   SVN 仍然受到积极支持
*   原子提交 - 在 VSS 中，当您在另一个用户执行签入时获得最新版本时，您可能会获得不一致的状态，从而迫使您在更好的情况下重复“获取最新版本”，但有时如果不走运，您可能会留下一个代码库编译但不起作用。由于原子提交，这在 SVN 中不会发生。

## 特征

*   SVN 分支/合并要好得多
*   SVN 内置了对远程访问的支持
*   SVN 更具可配置性（外部 Diff/Merge 工具的集成）
*   SVN 更具扩展性（钩子）

## 更高的生产力

*   SVN“更新”[比SS](https://stackoverflow.com/questions/239452/performance-in-subversion-vs-sourcesafe/239520#239520) “获取最新版本”快很多
*   SVN 命令行更容易和更清洁 - 这对于自动构建或测试工具很有用

## 同级别的 IDE 集成

*   直到最近，VSS 的 VS 集成要好得多，但在[AnkhSVN 2.0](http://ankhsvn.open.collab.net/)中，这不再适用。

## 打开

SVN是开放的，有很多使用SVN或与之合作的工具。一些例子包括：

*   与许多错误跟踪器或产品周期管理产品集成
*   外壳集成
*   集成到各种产品中
*   各种管理和分析工具
*   源可用，您可以根据需要对其进行调整，在需要时解决问题（或聘请某人为您做）

## 成本

*   您无需支付任何许可或维护费用

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-09-22T15:31:43.450

首先，教他们如何有效地使用 SourceSafe。

如果他们足够聪明，他们就会开始喜欢使用版本控制系统的好处，如果是这样，他们很快就会达到 SourceSafe 的极限。在那里，他们将更能倾听您关于切换到更好的 VCS 的论点，可以是 CVCS 还是 DVCS，具体取决于团队准备实现的目标。

如果你试图在他们以错误的方式使用 SourceSafe 时强迫他们使用另一个 VCS，比如保存源代码的 zip 文件（不要笑，他们两年前在我公司就是这样做的），他们将完全不情愿任何争论，尽可能好。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-22T16:46:33.257

找一些借口**开始在你的 C# 代码中使用非 ASCII 字符**（中文和日文非常适合这一点）。

SourceSafe 不喜欢 Unicode（即使 Visual Studio 喜欢），因此如果您选择正确的 Unicode 文本并签入和签出文件，您的整个文件将显示为已损坏的乱码。这样做的美妙之处在于，因为 SS 使用“差异”版本控制系统，这实际上将文件一直损坏到原始签入版本，并且无法自动修复。

当这种情况只发生一次时（就像我在开发必须支持日语的应用程序时发生的那样），您可能会发现它是支持放弃 SourceSafe 的决定性论据。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-22T15:40:20.247

我们曾经在 SVN over VSS 上销售管理和团队的两个功能。

1）分支能力。使用 VSS 时，当一个版本计划发布时，整个存储库都被锁定，直到该版本真正发布。这包括测试和修复周期。因此，开发人员除了对 VSS 存储库的版本进行修复之外，无法提交*任何其他内容。*这导致每次发布后立即进行长时间的集成会话。通过在 SVN 中使用发布分支，不再需要锁定整个存储库。

2) 一次回滚整个更改的能力。因为 SVN 在一个单一的原子提交中记录所有更改的文件，所以恢复有问题的更改是微不足道的。在 VSS 中，开发人员必须遍历整个存储库并找到几乎同时更改的每个文件，并将每个更改单独还原到每个文件。使用 SVN，这就像在 TortoiseSVN 中找到相关提交并点击“Revert Changes from this Commit”按钮一样简单。

附带说明一下，我们使用 TortoiseSVN，每个人都*喜欢*文件覆盖图标，因为它可以查看已更改和未更改的内容。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-09-22T15:35:17.123

不管做什么，慢慢来！不要在第 1 天就开始与他们谈论分支——这只会让他们望而却步。我用该评论对 VSS 用户进行了刻板印象，但这就是我所看到的。

**对于开发人员：**将其作为 VSS 的替代品出售，效果更好更快。在第 1 天使用 VisualSVN，因此他们的学习曲线非常浅。以相同的方式出售它们，除了更快，更稳定，并且 2 个人可以编辑同一个文件，而且他们不会因为某些人因一堆文件而生病而生病。

**对于管理员：**以比 VSS 更稳定、更易于管理的方式出售它们。向他们展示[VisualSVN 服务器](http://www.visualsvn.com/server/)。

祝你好运！

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-22T15:42:55.077

没有人推荐再使用 SourceSafe，甚至微软也不推荐。他们现在将为您提供（昂贵的）TFS 许可证。SourceSafe 只是不可靠。

我在这里写过：[Visual SourceSafe on E2](http://www.everything2.com/index.pl?node_id=1820195)。这有点咆哮，但那是因为我不得不使用 SourceSafe 有一段时间了，而且记忆让我有点口吐白沫。

可靠性是会咬你的大问题。但也有一些您可能会喜欢 SVN 或 TFS 的功能：

TFS 和 SVN 都有多个文件的原子提交，但 Sourcesafe 没有 - 如果您“一次”签入两个文件，这不是一个操作，它与签入其中一个文件，然后签入另一个文件相同。您可以处于两者之间的状态，其中一个文件已签入，但另一个文件未签入。

SourceSafe 不保留已删除文件、文件移动或重命名的历史记录。

与最初的印象相反，如果您设置了正确的选项，SourceSafe 确实支持多个同时检出同一文件。但是 TFS 尤其是 SVN 更适合这种工作方式

与 SourceSafe 不同，TFS 和 SVN 都可以在 Internet 上的服务器上正常工作（TFS 还可以，SVN 非常好），而 SVN 在离线时也能很好地工作 - 例如，如果你在飞机或火车上有一台笔记本电脑，但没有网络，你仍然可以工作和比较到以前的修订版甚至恢复，因为这样做的数据是在本地保存的。

正如其他人所指出的，SourceSafe 与 CVS 一样，是一个“死”的产品。它没有被积极开发。TFS 和 SVN 将在未来某个时间推出下一个版本。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-22T17:02:40.440

首先，记录您遇到的所有问题，这些问题可以追溯到源代码控制系统中的根本原因。跟踪他们一个月左右。再加上因不使用它而错过的机会。（如果你说“不使用颠覆的机会成本”，你可能会给 MBA 型经理留下深刻印象）。这些数字实际上是对机会成本的低估，因为如果您没有搞乱 VSS，大概您所做的工作可能会提供超过您的小时账单价值率。

例如，您是否遇到过需要多人访问的文件被锁定的问题？您是否遇到过部分（非原子）签入问题？您是否存在难以跟踪软件版本并像过去一样重新创建存储库的问题？在没有源安全客户端的服务器上获取代码副本时是否遇到问题？您是否因为持续集成工具无法监控您的版本控制系统的更新而在自动化构建和测试过程中遇到问题？我相信你能想到很多其他人。

如果你能计算出由 sourcesafe 引起的问题的大致时间/金钱成本以及 subversion 提供的东西的好处（使用一个通用数字，如人工成本 100 美元/小时或仅几个小时）以及延迟交付项目的任何成本，这样做. 如果您已经收集了一个月左右的数据，则可以使用 subversion per month 来显示收益。

然后介绍迁移到颠覆的大致时间/成本。（大约 8 小时来设置和迁移代码，每个开发人员需要 2 小时来连接、签出和移动项目，诸如此类）风险很低，因为 sourcesafe 仍然可以回滚。

如果成本超过每月收益，您可以将成本除以收益来计算恢复期。您还应该将其总计超过 3 年左右，以显示长期收益。再次强调，真正的机会成本不是直接可计算的，因为在您尝试在 sourcesafe 中管理非分支版本时，您可能一直在增加价值。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-22T17:02:12.860

首先在谷歌上搜索大量描述 VSS 有多糟糕的页面，并与您的同事分享。

其次，跳过颠覆，直接使用适当的分布式 SCM，如[git](http://git-scm.org)或[mercurial](http://www.selenic.com/mercurial/wiki/)。因为合并是分布式 SCM 的固有部分，它们必须比 svn 等集中式系统更好地处理合并。Subversion 仍在尝试改造自己以更好地处理分支，分布式系统从一开始就被正确构建。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-22T15:35:13.067

VS 的 AnkhSVN 插件非常好。它有一些奇怪的地方，但总的来说效果很好。

说服团队搬家是一项艰巨的工作——我从来没有做到过 :-( 可能更实际的论点之一是速度——当你有一个 1GB 的源数据库和几个用户时， VSS 很**慢。**

*编辑*我已经很久没有使用VSS了，我忘了它是锁定的！是的，正如这里提到的，如果您拥有多个开发人员，那么迁移到非独占/合并更改模型的能力应该会有所帮助。它省去了在办公室里大喊“有人可以检查公用包吗”！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-22T15:47:56.173

你说“为了说服你的团队转向像 SVN 这样更好的解决方案，你认为哪些论点最有用？”

如果你不知道这是一个更好的解决方案，那你为什么要争论呢？如果你下定决心去争论解决方案，你应该*知道*这些原因是什么。

是什么让**你**相信你应该转向更好的东西？这些就是你的论点。任何缺少这些论点的东西听起来都只是个人喜好的问题。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-22T16:42:06.713

[TortoiseSvn](http://tortoisesvn.tigris.org)（免费）非常适合浏览器集成，从上下文菜单中为您提供 svn 的所有功能。

[VisualSvn](http://visualsvn.com/visualsvn)（商业）使得将 svn 集成到 Visual Studio 中同样容易，在解决方案浏览器中具有相同的状态指示以及使用所有颠覆功能的上下文菜单。

这两种工具都有助于实现无缝的版本控制。自从我处理 VSS 以来已经有好几年了，但这些工具是使用源代码控制的更好方式。

同上，[每个人都说过 VSS 是便便](http://www.google.com/search?hl=en&rlz=1C1GGLS_en-USUS292&q=visual+sourcesafe+bad&btnG=Search)

Subversion 对分支和合并有很好的支持……我不记得 VSS 在这个部门有任何能力。我确实记得团队在需要从 VSS 发布时经历了长达一周的合并痛苦，而 Subversion 不再存在这种痛苦。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-23T04:12:44.853

**构建一些将 VSS 存储库镜像到 SVN 存储库的自动化**

建立共识需要时间。如果您的 VSS 存储库的 SVN 镜像始终可用，那么累积转换将更容易。镜子不一定是完美的——它只需要可用。有用于此目的的现有工具。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-22T16:16:38.727

告诉他们将源代码视为金钱，并向他们指出 SourceSafe 失火夺取源代码的众多示例。像这样的事情不应该在适当的源代码控制系统中发生。

**反对 SourceSafe 的最佳论据是它[不安全](http://www.highprogrammer.com/alan/windev/sourcesafe.html) [，](http://www.developsense.com/testing/VSSDefects.html) 其他一切都可能被称为[“](http://www.codinghorror.com/blog/archives/000660.html)**我们不需要的功能”。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-23T04:56:27.243

对我们来说，关键是 VSS over VPN 的速度（即缺乏速度）和路上的低带宽酒店网络，以及试图通过防火墙的问题，以便两个不同站点的两个团队能够快速、安全和可靠地从同一个代码存储库工作。我们正在运行两个 VSS 存储库并打包必须合并到另一个站点的存储库以保持同步的“交付”。

队员们抱怨了一阵，但很快就克服了。TortoiseSVN 本身就很棒，Visual Studio 的 AnkhSVN 插件确实让每个人都轻松地进行了转换。

回想起来，我不敢相信有多少“你能签入 SoAndSo 文件吗？” 我们发送的电子邮件，更不用说“SourceSafe 已关闭。我们必须恢复存储库”电子邮件。

嘘。阅读此评论并撰写此回复后，我不敢相信我们能忍受 VSS 这么久。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-29T14:55:58.960

[总结 VSS 问题的网页](http://www.highprogrammer.com/alan/windev/sourcesafe.html)- 只需将人们指向该 URL

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-22T15:29:59.897

如果您使用 VisualSVN，团队将不会错过 VSS。2 个人能够同时处理一个文件也是一大卖点。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-22T15:32:08.333

源代码安全的不可靠性（“请修复存储库...”）对我们来说已经足够了。Andecdotally（我从未测量过）SVN 似乎也总是更快。良好的并发结帐/合并。

我一直认为这对开发人员来说太明显了。SourceSafe 似乎经常崩溃和死亡，不想更换它......

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-22T15:33:42.103

我不记得有任何 SourceSafe 用户喜欢该产品。你的同事真的喜欢它吗？

在我当前客户的使用中，我遇到了与 CVS 类似的问题。由于“它有效”并且他们大多对此感到满意，因此我无法推动他们改变。但我每天都希望他们会！

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-22T16:08:53.580

告诉他们阅读此[http://www.highprogrammer.com/alan/windev/sourcesafe.html](http://www.highprogrammer.com/alan/windev/sourcesafe.html)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-22T17:10:34.353

我建议您继续并开始在您的 sourcesafe 使用中引入最佳实践，以期进一步更改为 subversion。希望这将使您的实际颠覆迁移更容易，并让您有时间整理计划您的开发周期、分支策略等。适当地。

要考虑的另一件事是您的开发过程。源代码控制管理系统只是解决方案的一部分，为了充分利用 subversion 或任何其他产品，您可能想看看它的使用如何与您的代码审查、质量保证和构建过程交互。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-02-19T21:29:58.550

当我参加 VS2005 的发布会时，我设法把一个微软人逼到了角落，问为什么 SourceSafe 用起来这么糟糕。我得到的答复相当令人震惊，不仅因为他说了什么，还因为他对自己所说的话如此坦率。

他告诉我，它真的只适合一个人使用，即使那样它也不是很擅长这样做。

我和我的同事有点震惊，除了大笑之外，我们想不出别的办法，Microsofty 也是如此！然后他告诉我们，它没有在内部使用。

所以，在那之后不久我们就切换到了颠覆。我们几乎决定在发布活动之前就这样做，但这只是证实了我们做出了正确的决定。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-22T15:35:46.217

我们曾经使用 SourceSafe。然后，当我加入团队时，我在不同的位置，即使我们有一个相当不错的局域网，但当我尝试查看最新版本时却花了 40 分钟。我说服他们转换为 CVS（我们现在使用 SVN），结帐时间减少到几分钟。SourceSafe 太慢了，无法在远程位置使用。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-22T15:40:49.513

我们从 SourceSafe 迁移到 Source Gear Vault。这个源代码控制引擎对于使用 SourceSafe 的人来说非常舒服。在发生了几起 SourceSafe 腐败事件后，我们最终决定做出改变，那是在关键时刻。因此，我的建议是将您的销售演示集中在 SourceSafes 的不可靠性上。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-22T16:09:50.053

当然，使用源代码安全是要迁移到另一个源代码控制系统的充分理由吗？

我在以前的工作中使用了 SVN 和 CVS，并搬到了一家使用 Source safe 的公司（我们将迁移到 SVN），仅仅使用 VSS 就足以让我对它产生严重的反感。尽管我以前工作的许多同事告诉我有关 VSS 的恐怖故事，但我还是抱着开放的心态进入的，我认为自从他们使用它后它会变得更好。

无法编辑文件，因为其他人正在/正在编辑它是荒谬的。我试图转移到更分布式的版本控制系统，例如由 cannonical 制作的 Bazzar，但是就可用工具而言，它还不够成熟。

Source safe 阻碍了 SVN 几乎每一步都能帮助您的开发方式。

另外，使用 tortoise Svn 使代码审查变得更加容易。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-22T16:35:56.777

仅在您能够放牧一群猫的范围内。我去过那里两次，在这两种情况下，在人们看到光明之前，Source Safe 都出现了一些严重的问题。另一方面，作为经理，我只是简单地指示团队使用 SVN，我们的生产力提高了 300%（这是与印度和美国的一个小组合作。在 svn 之前，我们进行了过去需要很长时间的代码交换）

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-22T18:21:48.423

Trac 也安装在 Subversion 之上。它是免费的，是查看存储库（时间线、wiki 等）的好方法

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-22T18:28:58.970

当您提出这些论点时，请考虑您是否需要解决您的公司可能制定的关于使用开源工具的任何政策。请参阅上一个问题的答案： [切换源代码控制](https://stackoverflow.com/questions/44588/how-to-convince-a-company-to-switch-their-source-control#60884)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-09-30T20:46:24.240

让他们使用它，他们将切换到其他东西:)

现在，说真的，告诉他们使用它并不难，我认识的许多开发人员拒绝切换，因为他们将颠覆与 unix 和奇怪的命令相关联，向他们展示像 ToirtoiseSVN 或 VisualSVN 这样的界面，告诉他们 Subversion 允许他们编辑同一个文件，无需像 VSS 那样强制锁定。

最后但同样重要的是，它是开源的。与购买 Team Foundation Server 相比，它的成本更低，并且如果您环顾四周，您会发现小型开发团队可以很好地使用 SVN。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-10-23T13:24:20.180

我在一个小型开发团队中使用了 SourceSafe，并负责保持它的运行。

我发现数据库很容易被破坏，发生这种情况时没有太多的追索权。“修复”功能（与大多数 Microsoft 修复功能一样）在 98% 的情况下都无法正常工作。

自然，当我们的数据库损坏时，我们会尝试从备份存档中恢复。那时我们发现了 SourceSafe 的另一个坏处：它的 2GB 存档限制。在我们意识到它们无法恢复并且毫无用处之前，我们在办公室进行了几个月的备份。

SourceSafe 只是一场等待发生的灾难。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-10-23T13:36:18.813

在忍受了十多年之后，我计划在接下来的几周内放弃 SourceSafe。大多数情况下，我一直在一个小型（< 5 人）团队的环境中使用它，并且不必做很多分支，因为没有人要求这样做。

然而，对我来说，第一大问题一直是，这该死的东西很容易损坏——如果你的 SS 数据库（哈哈，数据库；随机命名文件的集合更准确地描述它）在网络驱动器上，并且您的 LAN 连接在添加/签入操作的中途发生了一些事情 - 十分之九的时候您会收到“无效句柄”并且该死的东西以某种方式损坏，然后您可以使用分析器工具玩俄罗斯轮盘赌。

几个月前，我意识到，在过去的十年中，我一直在制作我正在开发的软件的每个版本的本地压缩副本，因为我不信任源代码控制系统。真是浪费时间。

所以，它正在发生。我可能会使用 Subversion 和 TortoiseSVN，因为我认为团队需要一个 UI 来简化过渡。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2009-08-23T17:19:04.090

在我之前的工作中，我们从 VSS 开始，然后转到 SVN，并且从未回头。

刚开始新工作，他们使用VSS，幸运的是上述问题让他们考虑使用SVN。

因为有人签出项目文件而无法将文件添加到项目中，这真令人气愤！

——李

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2010-03-05T15:51:41.123

如果将 SourceSafe 用于另一个版本控制系统，我建议使用[Mercurial](http://mercurial.selenic.com/)而不是 SVN

Joel Spolsky 写了一篇非常好的[Mercurial 介绍](http://hginit.com)，您也可以使用[Visual Studio 的插件](http://www.newsupaplex.pp.ru/hgscc_news_eng.html)。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2010-08-18T10:41:36.143

每当我在一个 3 人的团队中工作时，他们开始增加人数，进一步远离 VSS 似乎是一个自然的步骤。

每当我向人们展示[持续集成](http://martinfowler.com/articles/continuousIntegration.html)（特别是[CruiseControl.NET](http://ccnet.thoughtworks.com)）的好处时；这本身通常足以保证从 VSS 迁移到 SVN（我发现 SVN 在 CruiseControl.NET 上的效果比 VSS 好得多）。

我建议在 SVN 中启动任何新项目，并在必要时迁移旧项目，而不是一步完成从一个项目到另一个项目的完全迁移。

您会惊讶于 VSS 以这种方式消失的速度有多快。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2011-03-12T01:15:07.327

一本关于这个主题的优秀书籍是“推动技术变革”。

[http://pragprog.com/titles/trevan/driving-technical-change](http://pragprog.com/titles/trevan/driving-technical-change)

# emacs - Emacs 中的眼镜模式

> ID：115496
> 
> 赞同：4
> 
> 时间：2008-09-22T15:25:17.973
> 
> 标签：emacs, customization

如何自定义 Emacs 中“眼镜模式”中插入的符号颜色？我还没有找到这个选项。任何人都可以提出任何建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T16:32:00.483

没有为插入的分隔符设置面的选项（并且通过对 emacs 覆盖的文档的简要研究，我认为添加起来并不容易）。

您可以自定义用于眼镜模式拆分的大写字母的面部；它被称为`glasses-face`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T16:33:16.500

`glasses-separator`您可以手动或在 .emacs 文件中重置以更改符号。我的 elisp 生锈了，但我认为

```
(setq glasses-separator "~") 
```

这样做。在这一点上，我们根本没有改变字体。

我认为您可能必须破解模式（glasses.el）才能完成此操作。

（根据艾伦对问题的更好阅读......）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T11:51:22.193

查看可用定制的最简单方法`glasses-mode`是输入：

```
M-x customize-group 
```

然后`glasses`在`Customize group (default emacs):`提示符下输入。

但是，您需要先设置一个[custom.el 文件](http://www.gnu.org/software/emacs/manual/html_node/emacs/Saving-Customizations.html)。

# java - 如何为 Java 套接字指定端口范围？

> ID：115500
> 
> 赞同：10
> 
> 时间：2008-09-22T15:26:11.450
> 
> 标签：java, tcp, sockets, udp

在 Java 中，您可以将数字零作为 Socket 或 DatagramSocket 构造函数的单个参数。然后 Java 将该 Socket 绑定到一个空闲端口。是否可以将端口查找限制在特定范围内？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T15:53:51.603

Hrm，阅读文档后，我认为您不能。您可以绑定到任何端口，如果不可接受则重新绑定，或者重复绑定到您范围内的端口，直到成功。第二种方法将是最“有效”的。

我对这个答案感到不安，因为它......不雅，但我真的找不到其他任何东西：/

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T16:02:41.737

将套接字绑定到任何空闲端口（通常）是操作系统套接字支持的一个特性；它不是特定于 java 的。例如，Solaris 支持通过*ndd*命令调整临时端口范围。但是只有 root 可以调整范围，它会影响整个系统，而不仅仅是你的程序。

如果常规的临时绑定行为不适合您的需要，您可能必须使用 Socket.bind() 编写自己的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T17:03:42.387

这是您需要的代码：

```
public static Socket getListeningSocket() {
    for ( int port = MIN_PORT ; port <= MAX_PORT ; port++ )
    {
        try {
            ServerSocket s = new ServerSocket( port );
            return s;      // no exception means port was available
        } catch (IOException e) {
            // try the next port
        }
    }
    return null;   // port not found, perhaps throw exception?
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T16:55:29.583

您可能会看一下实现您正在使用的函数的 java 代码。大多数 Java 库都是用 Java 编写的，因此您可能只是在其中看到了您需要的内容。

假设@Kenster 是正确的并且它是一个系统操作，您可能必须简单地迭代尝试绑定到每个端口或对其进行测试的端口。虽然有点痛苦，但应该不会超过几行代码。

# ruby - Ruby 对 GUI 开发有用吗？

> ID：115501
> 
> 赞同：22
> 
> 时间：2008-09-22T15:26:11.997
> 
> 标签：ruby, user-interface, cross-platform

我正在考虑创建一个我想要跨平台的基于 GUI 的工具。我不喜欢 Java，因为我个人不喜欢 Swing。我目前正在考虑使用 C# 并使用 Mono 使其成为跨平台的。但是我想知道像 Ruby 这样的新奇跨平台语言是否可以为我提供一个不错的 GUI 开发环境。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-22T15:43:17.027

**简短的回答：**不（因为你说*cross-platform*）。

**长答案：**跨平台 GUI 是一个古老的问题。Qt、GTK、wxWindows、Java AWT、Java Swing、XUL——它们都面临着同样的问题：生成的 GUI 并不是在每个平台上看起来都是原生的。更糟糕的是，每个平台的外观**和**感觉都略有不同，因此即使您能够以某种方式获得在每个平台上看起来都是原生的工具包，您也必须以某种方式编写应用程序以在每个平台上都*感觉原生。*

它归结为一个决定：您是想尽量减少开发工作并拥有一个在每个平台上看起来和感觉都不太正确的 GUI，还是想最大限度地提高用户体验？如果选择第二个选项，则需要为每个平台开发一个通用后端和自定义 UI。

ruby 对于您的公共后端来说不是一个糟糕的选择。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-22T15:28:28.543

Ruby 有[Shoes](http://shoesrb.com/)，但这可能有点轻量级。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-22T15:39:38.673

您将拥有[Ruby/GTK](http://ruby-gnome2.sourceforge.jp/)，它允许您在 linux 下使用 GTK 工具包。我认为这应该在 Windows 和 Mac Os 下工作（如 Gimp、Gaim 等）。

一家[法国杂志发表了一篇](http://www.unixgarden.com/index.php/programmation/ruby-gtk-le-developpement-d%E2%80%99applications-de-bureau-a-votre-portee)关于 Ruby/GTK 的不错的初学者文章。

编辑：根据[SourceForge 项目](http://sourceforge.net/projects/ruby-gnome2/)的主页，Ruby-Gnome2（又名 Ruby/GTK）是跨平台的（Windows、Linux、Mac Os）。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-22T15:39:26.177

借助 Ruby，您可以使用 Tk，这是一个成熟的跨平台 UI 工具包。它是 Python 和 Tcl 的事实上的 GUI 工具包，也可与 Perl 一起使用。最新版本的 Tk 使用本机小部件，解决了 Tk 看起来过时的主要问题。

专门介绍 Tk 的语言中立网站是[http://www.tkdocs.com/](http://www.tkdocs.com/)，其中包括用 Ruby 和 Tcl 编写的示例。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T15:44:52.233

还有[FXRuby](http://www.fxruby.org/)，它受益于 Pragmatic Programmer 书籍，以及基于 wxWidgets C++ GUI 框架的[wxRuby 。](http://wxruby.org)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-18T17:59:33.897

作为一名 wxperl 程序员，我知道 wxruby 也在那里。Wx 非常快，并且具有真正的跨平台外观和感觉。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-11-04T06:08:35.737

看看[Ruby GUI 2008 调查结果和](http://www.pressure.to/ruby_gui_survey/)[这里](http://old.nabble.com/Desktop-GUI-apps-in-Ruby-td26088853.html#a26088853)的讨论。你会很想知道的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T15:28:57.857

不确定 Ruby，但你提到了 Mono/C#——我最近使用过 Mono 和 GTK#，印象非常深刻。似乎很稳定，跨平台的可移植性很好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-22T20:00:19.310

Ruby/GNOME2 运行良好。您可以使用 Glade 拖放窗口元素并从您的 Ruby 应用程序加载它的 UI。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T00:18:24.793

你看过 Java 上的 SWT 吗？它使用原生小部件，并且比 Swing 更容易获得漂亮的界面。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-30T20:29:23.547

如果您曾经冒险使用 Mac，请查看[RubyCocoa](http://rubycocoa.sourceforge.net/HomePage)。它显然只适用于 OSX，但我看到很多人在寻找在 mac 上进行 GUI 开发时摸不着头脑，如果你喜欢 ruby​​，RubyCocoa 会很有趣。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-11-25T10:09:56.360

我强烈支持 Qt 进行跨平台 GUI 开发。这太棒了，API 非常直观。GUI 的外观和感觉几乎是 Qt 原生的，因为它使用底层操作系统提供的 GUI 控件。

尽管具有 C++ 的基本接口，但其他语言绑定是可用的。对于 Ruby，RubyQt 可用。不幸的是，它非常不成熟。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-11-24T03:50:30.367

我建议看一下[visualruby](http://visualruby.net)。它是一个使用 ruby​​ 创建 GUI 的 IDE。它使用 GTK 作为其图形工具包，并且这些应用程序在任何平台上对我来说都很棒。您可以在屏幕截图页面上看到 Win7、WinXP、Ubuntu 和 Mac 上的屏幕截图：

[http://visualruby.net/site/Screen%20Shots.html](http://visualruby.net/site/Screen%20Shots.html)

通过在各种平台上安装 visualruby 并运行示例程序，您可以轻松地在每个平台上试用它。

检查的答案是在 visualruby 发布之前编写的。

# java - Java 中的重复 Oracle DES 加密

> ID：115503
> 
> 赞同：1
> 
> 时间：2008-09-22T15:26:15.257
> 
> 标签：java, oracle, encryption

我最近问了一个关于 Oracle 加密的问题。在为自己寻找解决方案的过程中，我决定将加密（嗯，混淆）移动到应用程序端以完成某些任务。

我的问题是数据库已经以某种方式加密数据，我需要 Java 代码来复制该功能，以便一个系统加密的文本可以被另一个系统解密，反之亦然。

我希望加密与数据库已经在做的事情兼容，但找不到准确描述 Oracle 正在做什么的文档。如何在 Java 中复制它？

```
dbms_obfuscation_toolkit.DESEncrypt(
  input_string => v_string,
  key_string => key_string,
  encrypted_string => encrypted_string );
RETURN UTL_RAW.CAST_TO_RAW(encrypted_string); 
```

无论我尝试什么，Java DES 加密似乎都与 Oracle 的不同。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T15:30:56.620

我发现这有效：

```
KeySpec ks = new DESKeySpec(new byte[] {'s','e','c','r','e','t','!','!'});
SecretKeyFactory skf = SecretKeyFactory.getInstance("DES");
SecretKey sk = skf.generateSecret(ks);
Cipher c = Cipher.getInstance("DES/CBC/NoPadding");
IvParameterSpec ips = new IvParameterSpec(new byte[] {0,0,0,0,0,0,0,0});
c.init(Cipher.ENCRYPT, sk, ips);
// or
c.init(Cipher.DECRYPT, sk, ips); 
```

缺少的部分是必须为 8 个零的初始化向量 (ips)。当你在 Java 中使用 null 时，你会得到不同的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T17:27:31.723

在数据库中使用 Java 将是另一种方法，它将（应该！）保证代码（以及结果）是相同的。

# java - How to see Java threads from Remote Desktop Connection Client. Ctrl-break not working

> ID：115508
> 
> 赞同：5
> 
> 时间：2008-09-22T15:27:24.320
> 
> 标签：java, macos, remote-desktop

I am connecting to a Windows XP machine via Microsoft's Remote Desktop Connection Client, version 2.0.0 Beta 3, running on a Mac. On the Windows machine there is a Java console running, where I want to send a Ctrl-Break so I can see the Java threads running.

According to the RDC help, Alt/Option-F3 is break, but Ctrl-Opt-F3 and various other combinations do not have an effect.

Any ideas on how to send a Ctrl-Break?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T15:30:00.803

Hit CTRL+ALT+END instead.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-12-29T16:34:51.377

我尝试了上面给出的所有选项，但没有一个对我有用。最终设法通过以下方式访问中断 VBA 代码执行：

```
fn + Esc 
```

作为参考，我正在使用： Macbook Air with OS X 10.7.2 Via Microsoft Remote Desktop Connection Client for Mac version 2.1.0 Accessing Windows 7 Enterprise running on VMWARE

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-25T21:22:17.827

我不知道这是否对任何人有帮助，但我试图调试一个 vba 项目并且遇到了同样的问题。这就是我最终来到这里的方式。我在附件->辅助功能中使用了“屏幕键盘”

希望这可以帮助某人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-05T03:11:12.087

`Ctrl`- `Alt`-`End`在 macbook 上不起作用：没有`End`密钥。“屏幕键盘”虽然起到了作用。谢谢！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-04-17T12:34:53.290

我需要发送一个 BREAK（在我的笔记本电脑上是 FN+Page Down）——这是为了破坏在 Excel 中运行的 VBA 代码。当我从 Mac 进行 RDP 时，我使用了 fn+F14 - 通过反复试验得到了这个。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T17:39:06.070

仍然希望看到一种通过 RDP for Mac 将 Ctrl-Break 从 Mac Book Pro 发送到 Windows 机器的方法。尝试默认键分配 (Option-F3) 不起作用，重新分配键似乎也不起作用。如果有人在 Mac 上使用 RDP 客户端成功发送了 Ctrl-Break，我很想听听您是如何做到的。到目前为止，谷歌搜索一直没有结果。

# html - 有没有办法从 iframe 的内容中获取父 URL？

> ID：115526
> 
> 赞同：11
> 
> 时间：2008-09-22T15:29:10.430
> 
> 标签：html, iframe

我在旧网站的 asp 页面的 iframe 中运行 c# .net 应用程序。访问 Asp 页面的会话信息有些困难，所以我想让我的 .net 应用程序简单地验证它是从批准的页面调用的，或者立即停止。

有没有办法让页面找到它的父文档的 url？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-22T15:30:03.237

```
top.location.href 
```

但这只有在两个页面（iframe 和主页）都来自同一个域时才有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-14T14:44:43.187

要获取 URL：

```
Request.UrlReferrer.... 
```

要消化查询字符串：

```
NameValueCollection qs = HttpUtility.ParseQueryString(Request.UrlReferrer.Query); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T17:10:41.980

```
parent.location.href 
```

# label - In P4V, how do I create a branch from a label?

> ID：115530
> 
> 赞同：9
> 
> 时间：2008-09-22T15:29:53.393
> 
> 标签：label, branch, perforce, p4v

My company just imported our `CVS` repository into Perforce. I'm new to P4V and I can't work out how to create a branch from an existing label. Can anyone tell me how to do this?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2016-09-14T15:55:16.280

在我的 P4V（版本 2013.3）副本中，我转到`Actions`菜单并选择`Branch Files...`，这会打开`Branch Files`对话框：

[![在此处输入图像描述](https://i.stack.imgur.com/eAp34.png)](https://i.stack.imgur.com/eAp34.png)

在该对话框中，我指定要分支的源文件，以及我的分支的目标名称（在我的情况下，我正在分支`//depot/main/...`到`//depot/branch/...`），并在`Filter`选项卡中指定我想使用标签指定源修订。

然后我在文本框中输入我的标签名称（如果我不知道标签名称，我可以`Browse...`为它）。

然后我单击`Branch`按钮来创建分支。

# javascript - 为什么在 JS 中 isNaN(null) == false？

> ID：115548
> 
> 赞同：147
> 
> 时间：2008-09-22T15:32:26.537
> 
> 标签：javascript

JS 中的这段代码给了我一个弹出窗口，上面写着“我认为 null 是一个数字”，我觉得这有点令人不安。我错过了什么？

```
if (isNaN(null)) {
  alert("null is not a number");
} else {
  alert("i think null is a number");
}
```

我正在使用 Firefox 3。这是浏览器错误吗？

其他测试：

```
console.log(null == NaN);   // false
console.log(isNaN("text")); // true
console.log(NaN == "text"); // false
```

那么，问题似乎不是与 NaN 的精确比较？

***编辑：**现在问题已经得到解答，我已经清理了我的帖子，以便为存档提供更好的版本。然而，这使得一些评论甚至一些答案有点难以理解。不要责怪他们的作者。我改变的事情包括：*

**   删除了一条说明我首先通过恢复其含义而搞砸了标题*
*   *较早的答案表明我没有足够清楚地说明为什么我认为这种行为很奇怪，所以我添加了检查字符串并进行手动比较的示例。*

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-09-22T15:54:25.470

我相信代码试图问，“是`x`数字吗？” 与这里的具体情况`x = null`。该函数`isNaN()`可用于回答这个问题，但在语义上它专门指的是 value `NaN`。来自维基百科[`NaN`](http://en.wikipedia.org/wiki/NaN)：

> NaN（**不是**数字）**是数字数据类型的值，表示** **未定义**或无法表示的值，尤其是在浮点计算中。

在大多数情况下，我们认为“是空数字？”的答案。应该没有。但是，`isNaN(null) == false`在语义上是正确的，因为`null`is not `NaN`。

下面是算法解释：

该函数`isNaN(x)`尝试将传递的参数转换为数字^([1](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/isNaN))（相当于`Number(x)`），然后测试该值是否为`NaN`。如果参数不能转换为数字，`Number(x)`将返回`NaN`^([2](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Number))。因此，如果将参数转换为`x`数字的结果为`NaN`，则返回 true；否则，它返回 false。

因此，在特定情况下`x = null`，`null`将转换为数字 0，（尝试评估`Number(null)`并查看它返回 0，）并`isNaN(0)`返回 false。只有数字的字符串可以转换为数字，并且 isNaN 也返回 false。`'abcd'`无法转换为数字的字符串（例如）将导致`isNaN('abcd')`返回 true，特别是因为`Number('abcd')`返回`NaN`。

除了这些明显的边缘情况之外，还有返回 NaN （如 0/0）的标准数值原因。

至于问题中显示的看似不一致的相等测试，`NaN`指定的行为使得任何比较`x == NaN`都是错误的，无论其他操作数如何，包括`NaN`它本身^([1](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/isNaN))。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2013-12-17T08:32:26.283

我自己也遇到了这个问题。

对我来说，使用 isNaN 的最佳方式就是这样

`isNaN(parseInt(myInt))`

以上面的 phyzome 为例，

```
var x = [undefined, NaN,     'blah', 0/0,  null, 0,     '0',   1,     1/0, -1/0,  Number(5)]
x.map( function(n){ return isNaN(parseInt(n))})
        [true,      true,    true,   true, true, false, false, false, true, true, false] 
```

（我根据输入对齐结果，希望它更容易阅读。）

这对我来说似乎更好。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-22T22:50:10.917

这确实令人不安。这是我测试的一组值：

```
var x = [undefined, NaN, 'blah', 0/0, null, 0, '0', 1, 1/0, -1/0, Number(5)] 
```

它评估（在 Firebug 控制台中）为：

```
,NaN,blah,NaN,,0,0,1,Infinity,-Infinity,5 
```

当我调用`x.map(isNaN)`（在每个值上调用 isNaN）时，我得到：

```
true,true,true,true,false,false,false,false,false,false,false 
```

总之，`isNaN`看起来很没用！（**编辑**：除了事实证明 isNaN 只在 Number 上*定义*，在这种情况下它工作得很好——只是名字有误导性。）

顺便说一下，以下是这些值的类型：

```
x.map(function(n){return typeof n})
-> undefined,number,string,number,object,number,string,number,number,number,number 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-22T23:07:29.440

（我的另一条评论采用了实用的方法。这是理论上的一面。）

我查阅了Javascript 实现的[ECMA 262 标准。](http://www.ecma-international.org/publications/standards/Ecma-262.htm)他们对 isNan 的规范：

> 将 ToNumber 应用于其参数，如果结果为 NaN，则返回 true，否则返回 false。

第 9.3 节指定了`ToNumber`（它不是可调用函数，而是类型转换系统的一个组件）的行为。总结该表，某些输入类型可以产生 NaN。它们是 type `undefined`、 type `number`（但只有 value `NaN`）、任何原始表示为 的对象`NaN`，以及任何`string`无法解析的对象。这会留下`undefined`, `NaN`,`new Number(NaN)`和大多数字符串。

任何`NaN`在传递给时作为输出产生的输入将在馈送到时`ToNumber`产生 a 。由于可以成功转换为数字，因此不会产生.`true``isNaN``null``true`

这就是为什么。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-22T15:33:58.280

Null 不是 NaN，字符串也不是 NaN。isNaN() 只是测试你是否真的有 NaN 对象。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-04-23T11:09:57.933

在 ES5 中，它定义为`isNaN (number)`如果参数强制为 NaN 则返回 true，否则返回 false。

*   如果[ToNumber(number)](https://es5.github.io/#x9.3)为 NaN，则返回 true。
*   否则，返回假。

并查看[抽象操作 ToNumber 转换表](https://es5.github.io/#x9.3)。所以它在内部 js 引擎评估`ToNumber(Null)`是`+0`，然后最终`isNaN(null)`是`false`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T15:40:00.187

我不确定何时涉及 JS，但我在其他语言中看到过类似的事情，这通常是因为该函数仅检查 null 是否完全等于 NaN（即 null === NaN 将是错误的）。换句话说，它并不是认为 null 实际上是一个数字，而是 null 不是 NaN。这可能是因为两者在 JS 中的表示方式不同，因此它们不会完全相等，就像 9 !== '9' 一样。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-23T11:50:24.457

笔记：

```
"1" == 1 // true
"1" === 1 // false 
```

== 运算符进行类型转换，而 === 不进行。

[Douglas Crockford 的网站](http://crockford.com/)，一个 Yahoo! JavaScript 布道者，是此类内容的绝佳资源。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2021-06-15T05:04:52.707

```
(NaN == null) // false
(NaN != null) // true 
```

不过好笑：

```
(NaN == true)  // false
(NaN == false) // false
(NaN)          // false
(!NaN)         // true 
```

不是`(NaN == false)`和`(!NaN)`相同吗？

# jscript - Jscript 中的进程终止

> ID：115549
> 
> 赞同：0
> 
> 时间：2008-09-22T15:32:31.030
> 
> 标签：jscript

我正在为我公司使用的会计软件 Caseware 编写一个脚本，我需要终止一个进程，该进程挂起并弄乱了服务器上的文件压缩。问题是它需要用 jscript 编写，而我没有很多经验。

我一直在寻找人们用来杀死进程的代码示例，但我找不到太多。我确实找到了一个从 jscript 调用 .exe 的示例，我想我会在 Windows 中使用 taskkill.exe 尝试它，但它似乎不起作用。

这是我使用的代码块。

```
 function OnFileClose()
{
   w = new ActiveXObject("WScript.Shell");
   w.run("taskkill.exe /im iexpore.exe");
   return true;
} 
```

我会很感激人们有任何例子或建议。

谢谢。

更新：我对脚本进行了更多测试，发现它实际上执行了 taskkill.exe，但它没有传递 /im 参数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T16:18:53.057

那不应该是 iexpLore.exe 而不是 iexpore 吗？

# web-services - WebServiceTransportException: Unauthorized [401] in Spring-WS

> ID：115557
> 
> 赞同：3
> 
> 时间：2008-09-22T15:33:47.097
> 
> 标签：web-services, jakarta-ee, spring-ws, client-applications

We are struggling to configure our web app to be able to connect with web services via Spring WS. We have tried to use the example from the documentation of client-side Spring-WS, but we end up with a WebServiceTransportException. The XML config looks like this:

```
<bean id="webServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate">
    <constructor-arg ref="messageFactory"/>
    <property name="messageSender">
        <bean class="org.springframework.ws.transport.http.CommonsHttpMessageSender">
            <property name="credentials">
                <bean class="org.apache.commons.httpclient.UsernamePasswordCredentials">
                    <constructor-arg value="john"/>
                    <constructor-arg value="secret"/>
                </bean>
            </property>
        </bean>
    </property>
</bean> 
```

We have been able to configure the application programmatically, but this configuration was not possible to "transfer" to a Spring XML config because some setters did not use the format Spring expects. (HttpState.setCredentials(...) takes two parameters). The config was lifted from some other Spring-WS client code in the company.

This is the configuration that works:

```
 public List<String> getAll() {
    List<String> carTypes = new ArrayList<String>();

    try {
        Source source = new ResourceSource(request);
        JDOMResult result = new JDOMResult();

        SaajSoapMessageFactory soapMessageFactory = new SaajSoapMessageFactory(MessageFactory.newInstance());

        WebServiceTemplate template = new WebServiceTemplate(soapMessageFactory);

        HttpClientParams clientParams = new HttpClientParams();
        clientParams.setSoTimeout(60000);
        clientParams.setConnectionManagerTimeout(60000);
        clientParams.setAuthenticationPreemptive(true);

        HttpClient client = new HttpClient(clientParams);
        client.getState().setCredentials(AuthScope.ANY,
                new UsernamePasswordCredentials("username", "password"));

        CommonsHttpMessageSender messageSender = new CommonsHttpMessageSender(client);

        template.setMessageSender(messageSender);
        template.sendSourceAndReceiveToResult(SERVICE_URI,
                source, result);

        // Handle the XML

    } catch (IOException e) {
        throw new RuntimeException(e);
    } catch (SOAPException e) {
        throw new RuntimeException(e);
    }

    return carTypes;
} 
```

Does anyone know how to solve my problem? Every tutorial I have see out there lists the first configuration. It seems that when I set the credentials on the messageSender object, they are just ignored...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-16T16:04:01.147

使用构造函数覆盖 HttpClient，该构造函数接受参数并使用构造函数参数通过 Spring 连接

```
public MyHttpClient(HttpClientParams params, UsernamePasswordCredentials usernamePasswordCredentials) {
        super(params);        
        getState().setCredentials(AuthScope.ANY, usernamePasswordCredentials);
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T19:10:13.887

你如何区分这些：

```
<constructor-arg value="john"/>
<constructor-arg value="secret"/> 
```

尝试用这个替换它：

```
<property name="userName" value="john" />
<property name="password" value="secret" /> 
```

希望能帮助到你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-01T19:41:15.080

如果您在示例中使用 defaultHttpClient，请在 HTTPMessageSender 上使用 afterPropertiesSet 方法，这应该可以通过正确应用凭据来解决您的问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-09-04T08:55:24.047

起初我们在我们的项目中设置凭据是这样的：

```
<bean id="authenticationEnabledCommonsHttpMessageSender" parent="commonsHttpMessageSender"
    p:credentials-ref="clientCredentials" lazy-init="true" />
<bean id="clientCredentials"
    class="org.apache.commons.httpclient.UsernamePasswordCredentials"
    c:userName="${clientCredentials.userName}"
    c:password="${clientCredentials.password}"
    lazy-init="true" /> 
```

这是我们启用凭据的选项。当我们像这样设置凭据时出现问题。如果我们发送消息的服务器（具有 Axis impl）没有获得用户名密码凭据，我们会得到“未经授权”异常。因为，当我们跟踪 vie TCPMon 时，我们意识到“用户名：密码：”字符串被发送，你可以看到用户名和密码没有值。

之后，我们像这样设置凭据：

```
public Message sendRequest(OutgoingRequest message, MessageHeaders headers,
                        EndpointInfoProvider endpointInfoProvider,
                        WebServiceMessageCallback requestCallback){
    Assert.notNull(endpointInfoProvider, "Destination provider is required!");
    final Credentials credentials = endpointInfoProvider.getCredentials();
    URI destinationUri = endpointInfoProvider.getDestination();
    for (WebServiceMessageSender messageSender : webServiceTemplate.getMessageSenders()) {
        if (messageSender instanceof CommonsHttpMessageSender) {
            HttpClient httpClient = ((CommonsHttpMessageSender) messageSender).getHttpClient();
            httpClient.getState().setCredentials(
                    new AuthScope(destinationUri.getHost(),
                            destinationUri.getPort(), AuthScope.ANY_REALM,
                            AuthScope.ANY_SCHEME), credentials
            );
            httpClient.getParams().setAuthenticationPreemptive(true);
            ((CommonsHttpMessageSender) messageSender)
                    .setConnectionTimeout(endpointInfoProvider
                            .getTimeOutDuration());
        }
    } 
```

getCredentials 方法是：

```
@Override
public Credentials getCredentials(){
    if (credentials != null) {
        return credentials;
    }
    String username = parameterService.usernameFor(getServiceName());
    String password = parameterService.passwordFor(getServiceName());
    if (username == null && password == null) {
        return null;
    }
    credentials = new UsernamePasswordCredentials(username, password);
    return credentials;
} 
```

# php - Best PHP IDE for Mac? (Preferably free!)

> ID：115563
> 
> 赞同：107
> 
> 时间：2008-09-22T15:34:34.457
> 
> 标签：php, macos

I need to find a good `PHP IDE` for `Mac`, but would prefer a free one.

Any suggestions?

Thanks!

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2010-03-10T23:44:50.047

## 这是 PHP 的 Mac IDE 的内幕

[NetBeans](http://netbeans.org/) 免费！此外，所有产品的最佳功能。包括内联数据库连接、代码完成、语法检查、颜色编码、拆分视图等。缺点：它在 Mac 上会占用内存。准备好允许半个内存，然后你需要关闭并重新启动。

[Komodo](http://www.activestate.com/komodo-ide) 文本编辑器之上的一个步骤。不支持数据库连接或拆分视图。颜色编码和语法检查在一定程度上是存在的。与其他 IDE 相比，Komodo 上的项目控制非常笨拙和奇怪。

[Aptana](http://www.aptana.com/) 完美的解决方案。基于 Eclipsed 并使用 Aptana PHP 插件。实时语法检查、自动换行、拖放拆分视图、数据库连接和许多其他出色的功能。缺点：不再是受支持的产品。Aptana Studio 2.0+ 使用 PDT，它是一个淡化、欠开发（目前）的 php 插件。

[Zend Studio](http://www.zend.com/en/products/studio/) - 几乎与 Aptana 相同，除了没有自动换行，而且由于错误，您显然无法更改 MAC 上的大量 php 配置。

[Coda](http://www.panic.com/coda/)由 Panic 创建，Coda 与源代码控制和他们流行的 FTP 客户端传输有很好的集成。他们还具有协作功能，非常适合结对编程。

[PhpEd](http://www.nusphere.com/products/phped.htm)与 Parallels 或 Wine。适用于 Windows 的最佳 IDE 具有您可能需要的所有功能，并且值得通过 Parallels 或 Wine 传递它。

[Dreamweaver](http://www.adobe.com/products/dreamweaver.html) 适用于 Javascript/HTML/CSS，但仅适用于 PHP。有一些颜色编码，但没有语法检查或包原生的代码完成。支持数据库连接，拆分视图也是如此。

我使用的是免费且功能丰富的 NetBeans。我可以暂时处理内存问题，但 MAC 可能会很慢。

干杯! Korky Kathman 高级合伙人 Entropy Dynamics, LLC

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-22T15:37:34.950

Komodo is wonderful, and it runs on OS X; they have a free version, Komodo Edit.

**UPDATE** from 2015: I've switched to PHPStorm from Jetbrains, the same folks that built IntelliJ IDEA and Resharper. It's better. Not just better. It's well worth the money.

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-22T15:39:08.783

PDT eclipse from ZEND has a mac version ([PDT all-in-one](http://downloads.zend.com/pdt/all-in-one/)).

I've been using it for about 3 months and it's pretty solid and has debugging capabilities with xdebug ([debug howto](http://www.sitepoint.com/blogs/2007/04/23/faster-php-apps-profile-your-code-with-xdebug/)) and zend debugger.

# .net - 抛出 NullReferenceException 时检测目标对象是什么

> ID：115573
> 
> 赞同：31
> 
> 时间：2008-09-22T15:35:37.450
> 
> 标签：.net, exception

我敢肯定，我们都曾在某个时候收到过非常模糊的“对象引用未设置为对象的实例”异常。识别存在问题的对象通常是设置断点和检查每个语句中的所有成员的乏味任务。

是否有人有任何技巧可以通过编程方式或其他方式轻松有效地识别导致异常的对象？

- 编辑

看来我像例外一样含糊不清=）。关键是_不必调试应用程序来找到错误的对象。编译器/运行时确实知道该对象已被分配/声明，并且该对象尚未被实例化。有没有办法在捕获的异常中提取/识别这些细节

@W.克雷格交易者

您解释这是设计问题的结果可能是我能得到的最佳答案。我对防御性编码非常着迷，并且随着时间的推移改正了我的习惯后，我已经设法摆脱了大多数这些错误。其余的只是将我***调整***到无止境，并引导我将这个问题发布到社区。

感谢大家的建议。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-22T16:00:21.027

在抛出 NRE 的地方，没有目标对象——这就是异常的地方。您最希望的是捕获发生异常的文件和行号。如果您在识别导致问题的对象引用时遇到问题，那么您可能需要重新考虑您的编码标准，因为听起来您在一行代码上做的太多了。

此类问题的更好解决方案是[按合同设计](http://en.wikipedia.org/wiki/Design_By_Contract)，通过内置语言结构或通过库。DbC 建议预先检查方法的任何传入参数是否超出范围数据（即：Null）并抛出异常，因为该方法不适用于错误数据。

**[编辑以匹配问题编辑：]**

我认为 NRE 的描述会误导你。CLR 遇到的问题是，当对象引用为 Null 时，它被要求取消引用对象引用。以这个示例程序为例：

```
public class NullPointerExample {
  public static void Main()
  {
    Object foo;
    System.Console.WriteLine( foo.ToString() );
  }
} 
```

当你运行它时，它会在第 5 行抛出一个 NRE，当它试图评估 foo 上的 ToString() 方法时。没有要调试的对象，只有一个未初始化的对象引用 (foo)。有一个类和一个方法，但没有对象。

* * *

回复：Chris Marasti-Georg 的[回答](https://stackoverflow.com/questions/115573/detecting-what-the-target-object-is-when-nullreferenceexception-is-thrown#115619)：

您永远不应该自己抛出 NRE——这是一个具有特定含义的系统异常：CLR（或 JVM）试图评估未初始化的对象引用。如果你预先检查一个对象引用，那么要么抛出某种无效参数异常，要么抛出一个特定于应用程序的异常，但不是 NRE，因为你只会让下一个必须维护你的应用程序的程序员感到困惑。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-22T18:00:27.807

正如一些答案所指出的，告诉 Visual Studio 为 NullReferenceException 抛出异常。

*抛出未处理的异常时如何告诉VS中断*

*   调试菜单 | 例外（或`Ctrl`++ `Alt`）`E`
*   深入研究公共语言运行时异常
*   深入系统
*   查找 System.NullReferenceException，并在抛出此异常时选中 Break 框，而不是让它继续执行任何 Catch 块

所以现在当它发生时，VS 将立即中断，当前语句行将位于计算为 null 的表达式上。

这个工具对各种异常都很有用，包括自定义异常（可以添加完全限定的类型名称，VS 会在 Debug 时匹配它）

这种方法的一个缺点是，如果调试器中加载的代码遵循抛出和捕获大量您正在寻找的异常的不良做法，在这种情况下，它又会变成大海捞针/针头问题（除非您可以当然修复该代码 - 那么你已经解决了两个问题:)

* * *

另一个可能派上用场的技巧（但仅在某些语言中）是使用 When（或等效）关键字......在 VB 中，这看起来像

```
Try
  ' // Do some work           '
Catch ex As Exception When CallMethodToInspectException(ex)

End Try 
```

*这里的技巧是在调用堆栈展开到 Catch 块之前*评估 When 表达式。因此，如果您使用调试器，您可以在该表达式中设置断点，如果您查看调用堆栈窗口（调试 | Windows | Callstack），您可以查看并导航到触发异常的行。

（您可以选择从 CallMethodToInspectException 返回 false，因此 Catch 块将被忽略，运行时将继续在堆栈中搜索适当的 Catch 块 - 这可以允许不影响行为的日志记录，并且开销更少比接球再扔）

* * *

如果您只是对非交互式日志记录感兴趣，那么假设您有一个 Debug 构建（或者在某种程度上，您已经处理了优化问题，使用 PDB 发布构建），您可以获得追踪所需的大部分信息异常 ToString 中的错误，包含带有行号的堆栈跟踪。

但是，如果行号还不够，您也可以通过提取异常的 StackTrace（使用上述技术或仅在 catch 块中）来获取列号（非常多，特定的本地或为空的表达式）本身）：

```
int colNumber = new System.Diagnostics.StackTrace(ex, true).GetFrame(0).GetFileColumnNumber(); 
```

* * *

虽然我还没有看到它对 NullReference 或其他运行时生成的异常有什么作用，但可能也有兴趣将[Exception Hunter](http://www.red-gate.com/products/Exception_Hunter/index.htm)视为一种静态分析工具。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T15:39:15.180

除了查看堆栈跟踪之外，您真的无能为力；如果您在同一行代码中取消引用多个对象引用，则无法在不设置断点的情况下确定哪个为空。您可以通过每行仅取消引用一个对象来避免这种情况，但这会导致一些看起来很糟糕的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T15:39:59.890

好吧，您无法真正识别该对象，因为它不存在，因此您得到了异常。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T15:41:24.940

# 行和文件通常是您找到罪魁祸首所需要的。如果您是引发异常的人，请考虑`ArgumentNullException`在适当的情况下使用 ，或检查空值并抛出`NullReferenceException`有关空字段的更多详细信息的 s。

编辑@你的编辑:)

AFAIK，您必须检查堆栈跟踪字符串以获取该行＃和文件。最好的办法是获取最里面的异常，然后查看其堆栈跟踪的第一行。如果您希望能够以编程方式解析该信息以找出导致 null 的字段，并使用该字段的名称做一些事情，我担心您会不走运。

@W。克雷格交易者

好点子。对于传递给方法的空值，`[ArgumentNullException](http://msdn.microsoft.com/en-us/library/system.argumentnullexception.aspx)`应该抛出一个。对于尚未初始化的成员变量，类似 an 的东西`InvalidStateException`可能会很好抛出。不幸的是，我在 MSDN 中找不到任何此类异常。自己滚？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T15:39:34.010

您可以检查 Message 和 InnerException 属性

[http://msdn.microsoft.com/en-us/library/system.exception.innerexception.aspx](http://msdn.microsoft.com/en-us/library/system.exception.innerexception.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T15:43:46.027

如果您正在为友好的用户消息或日志记录捕获异常，您可能希望调试器在调试时停止在异常处。转到 Debug/Exceptions 并检查您希望调试器停止运行的异常类型，在您的情况下为 System.NullReferenceException。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T15:46:59.967

将 VS 设置为中断异常，然后当您收到错误时，通常很明显它在哪一行。堆栈跟踪窗口将告诉您如何到达那里。除此之外，您无能为力。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T17:25:12.180

作为参考，一个类似的线程：[我应该只捕获异常来记录它们吗？](https://stackoverflow.com/questions/95547/should-i-catch-exceptions-only-to-log-them#95773)

重点是你要有效地捕获异常。根据我的经验，目标是确保程序员检查代码中的空引用——但我们知道，实际上我们会遗漏一些。UI 代码应该有一定程度的异常处理。我喜欢我对这个问题的回答：[我的回答](https://stackoverflow.com/questions/95547/should-i-catch-exceptions-only-to-log-them#95773)。更重要的是，[1800 information](https://stackoverflow.com/users/3146/1800-information)的评论指出，您只需 throw，而不是 throw ex，以便捕获整个堆栈跟踪，这就是您最终调试这些问题的方式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-25T10:56:25.860

With regards to setting Visual Studio to catch the exception (as suggested [here](https://stackoverflow.com/questions/115573/detecting-what-the-target-object-is-when-nullreferenceexception-is-thrown#116424)), DON'T FORGET to remove this option once you've fixed the problem. I've just wasted half an hour trying to work out why my application was hanging deep in some part of System.Windows.Forms....

# css - Sharepoint、母版页和 CSS

> ID：115627
> 
> 赞同：2
> 
> 时间：2008-09-22T15:42:41.583
> 
> 标签：css, sharepoint, master-pages

我正在尝试将 sharepoint 中的所有内容开发为功能，以便我可以轻松部署到测试和实时站点，而无需执行任何手动步骤。

我可以很好地部署我的母版页，虽然目前我必须手动打开它，但我相信我可以在未来实现自动化。

我遇到的困难是让一个 CSS 文件与之匹配。我已经创建了该文件，并且我认为我正在做正确的事情，因此它被部署在 sharepoint 安装中，但我无法弄清楚如何将它链接到我的母版页。

必须有正确的方法来做到这一点，但我找不到它！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T15:51:49.207

我相信您正在寻找 <SharePoint:CssLink> 标签。下面的链接有很多关于它的细节（除其他外）：

[http://www.cleverworkarounds.com/2007/10/08/sharepoint-branding-how-css-works-with-master-pages-part-1/](http://www.cleverworkarounds.com/2007/10/08/sharepoint-branding-how-css-works-with-master-pages-part-1/)

这个网站也是一个值得一看的好网站，因为 Heather Solomon 是 SharePoint 品牌女王：[http ://www.heathersolomon.com/blog/archive/2006/10/27/sp07cssoptions.aspx](http://www.heathersolomon.com/blog/archive/2006/10/27/sp07cssoptions.aspx)

# asp.net-mvc - 你相信 ASP.Net MVC 已经准备好投入生产了吗？

> ID：115634
> 
> 赞同：9
> 
> 时间：2008-09-22T15:42:59.227
> 
> 标签：asp.net-mvc

我真的很喜欢微软承诺将 MVC 引入 Web 的事实。为此，我对将我现有的一个 ASP.NET 应用程序转换为 MVC 感到很兴奋，并想知道我是否可能会抢先一步。虽然此站点使用 MVC，但它在技术上仍处于测试阶段……您的想法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T15:44:27.553

由于 Stack Overflow 是用 asp.net mvc 编写的并且正在生产中，所以看起来它已经准备好生产了 :)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-22T19:05:56.947

从 Preview 5 到 RTM，重大更改将越来越少。因此，如果担心您的项目将面临多少流失，那么它不应该像早期版本那样糟糕。

如果关注的是支持，我们会提供源代码，您可以根据自己的需要修改（但不能重新分发）源代码。在大多数情况下，我们从客户那里听说他们不必更改源来解决错误，而是选择使用我们的可扩展性挂钩。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T15:47:21.853

是的，它建立在 ASP.NET（缓存、身份验证等）的基础上，因此它不必处理重写/稳定所有那些较低级别的部分。

我在生产中使用它，从运行时的角度来看它非常可靠。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T15:46:15.427

我使用 ASP.NET MVC 的 Preview 5 重新编写了我的网站，我完全爱上了它。但是，在它上线之前，我不会将任何现有应用程序转换为它。太多可能会改变...

# powershell - Is PowerShell a strongly-typed language?

> ID：115643
> 
> 赞同：15
> 
> 时间：2008-09-22T15:43:52.657
> 
> 标签：powershell, strong-typing

PowerShell is definitely in the category of dynamic languages, but would it be considered strongly typed?

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-22T16:14:19.107

围绕术语存在一定程度的混淆。[本文](http://eli.thegreenplace.net/2006/11/25/a-taxonomy-of-typing-systems/)解释了一种有用的类型系统分类法。

PowerShell 是动态的、隐式类型的：

```
> $x=100
> $x=dir 
```

没有类型错误 - 变量可以在运行时更改其类型。这类似于[Python](http://en.wikipedia.org/wiki/Python_%28programming_language%29)、[Perl](http://en.wikipedia.org/wiki/Perl)、[JavaScript](http://en.wikipedia.org/wiki/JavaScript)但不同于[C++](http://en.wikipedia.org/wiki/C%2B%2B)、[Java](http://en.wikipedia.org/wiki/Java_%28programming_language%29)、[C#](http://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29)等。

然而：

```
> [int]$x = 100
> $x = dir
Cannot convert "scripts-2.5" to "System.Int32". 
```

因此，如果您愿意，它还支持*显式*键入变量。但是，类型检查是在运行时而不是编译时完成的，所以它不是*静态*类型的。

我看到有人说 PowerShell 使用*类型推断*（因为您不必声明变量的类型），但我认为这是错误的说法。类型推断是在编译时进行类型检查的系统的一项功能（如`var`C# 中的“”）。PowerShell 仅在运行时检查类型，因此它可以检查实际值而不是进行推理。

但是，有一些自动类型转换正在进行：

```
> [int]$a = 1
> [string]$b = $a
> $b
1
> $b.GetType()

IsPublic IsSerial Name                                     BaseType
-------- -------- ----                                     --------
True     True     String                                   System.Object 
```

所以*有些*类型是即时转换的。根据大多数定义，这将使 PowerShell 成为一种*弱类型*语言。它肯定比 Python 更弱，后者（几乎？）从不即时转换类型。但可能不像 Perl 那样弱，它可以根据需要转换几乎任何东西。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-22T15:48:42.927

It can be if you need it to be.

Like so:

```
[1] » [int]$x = 5
[2] » $x
5
[3] » $x = 'haha'
Cannot convert value "haha" to type "System.Int32". Error: "Input string was not in a correct format."
At line:1 char:3
+ $x  <<<< = 'haha'
[4] » 
```

Use the [type] notation to indicate if you care about variables being strongly typed.

**EDIT**:

As [edg](https://stackoverflow.com/questions/115643/is-powershell-a-strongly-typed-language#115715) pointed out, this doesn't prevent PowerShell from interpreting "5" as an integer, when executing (5 + "5"). I dug a little more, and according to Bruce Payette in [Windows PowerShell in Action](https://rads.stackoverflow.com/amzn/click/com/1932394907), PowerShell is actually a "type-promiscuous language." So, I guess, my answer is "sort of."

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T15:48:56.577

Technically it is a strongly typed language.

You can decline to declare types in the shell, allowing it to behave like a dynamic typed scripting language, but it will wrap weakly-typed objects in a wrapper of type "PsObject". By declaring objects using the "New-Object" syntax, objects are strongly typed and not wrappered.

```
$compilerParameters = New-Object System.CodeDom.Compiler.CompilerParameters 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T16:06:52.663

我认为您需要定义“强类型”的含义：

> 在计算机科学和计算机编程中，术语强类型用于描述编程语言对涉及具有不同数据类型的值的操作如何混合的一种或多种限制的情况。反义词是弱类型。然而，在计算的短暂历史中，这些术语被赋予了如此广泛的含义，以至于通常很难脱离上下文了解单个作者在使用它们时的含义。

——[维基百科](http://en.wikipedia.org/wiki/Strongly_typed)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T16:27:56.763

我认为进一步研究将字符串添加到 Int 示例将为讨论工厂提供更多信息。什么被认为是动态类型转换？有人在其中一条评论中说，在这种情况下：

```
4 + "4" 
```

`"4"` **变成**Int32 。我根本不相信情况是这样的。相反，我相信中间步骤发生在命令更改为：

```
4 + [System.Convert]::ToInt32("4") 
```

请注意，这意味着`"4"`在整个过程中保持一个字符串。为了证明这一点，请考虑以下示例：

```
19# $foo = "4"
20# $foo.GetType()

IsPublic IsSerial Name                                     BaseType
-------- -------- ----                                     --------
True     True     String                                   System.Object

21# 4 + $foo
8
22# $foo.GetType()

IsPublic IsSerial Name                                     BaseType
-------- -------- ----                                     --------
True     True     String                                   System.Object 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-14T10:52:01.783

PowerShell 是动态类型的，简单明了。它的创建者布鲁斯·帕耶特这样描述它。

此外，如果有人上过基本的编程语言理论课，他们就会知道这一点。仅仅因为有一个类型注释系统并不意味着它是强类型的。甚至类型注释的变量在强制转换期间也会动态地表现。任何允许您将字符串分配给变量并将其打印出来然后将数字分配给同一变量并使用它进行计算的语言都是动态类型的。

此外，PowerShell 是动态范围的（如果这里有人知道这意味着什么）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-22T16:03:27.150

我收回我之前的回答——引用如下。我应该说一些更细微的东西，比如：

**PowerShell 具有强大的类型系统和强大的类型推断，并且是动态类型的。**

在我看来，这里有几个问题在起作用，因此要求更好地定义“强类型语言”的含义的答案在他们解决问题的方法上可能更明智。

由于 PowerShell 跨越了许多边界，因此关于 PowerShell 所在位置的答案可能存在于由以下区域组成的维恩图中：

*   静态与动态类型检查
*   强类型与弱类型
*   安全与不安全打字
*   显式与隐式声明和推理
*   结构与主格类型系统

> > “PowerShell 是一种强类型语言。
> > 
> > 但是，它只需要您声明存在歧义的类型。
> > 
> > 如果它能够推断出一个类型，它就不需要你指定它。”

# javascript - Objective-J 是否有任何 jEdit 语法高亮模式

> ID：115644
> 
> 赞同：1
> 
> 时间：2008-09-22T15:44:03.017
> 
> 标签：javascript, syntax-highlighting, cappuccino, jedit, objective-j

我在 Cappuccino 网站（vim、textmate 和 SubEthaEdit）中找到了一些，但不适用于 jEdit，不幸的是我刚刚开始使用 Objective-J，所以无法自己制作。如果有人让其中一个躺在那里，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T15:51:33.683

根据 JEdit[功能页面](http://jedit.org/index.php?page=features)，它已经支持 Objective C。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-13T16:51:32.757

关于 JEdit，我最喜欢的一件事是定义一个新的语法高亮模式是多么容易。我工作的地方是每个傻瓜都想创建自己的自定义配置文件语言，而我已经到了可以在大约 5 分钟内创建新的近似语法突出显示模式的地方。我首先复制一种与我想要创建的新语言相似的模式，然后随着我学习该语言的更多部分而迭代地改进编辑模式。在学习介绍课程时，我使用 Specman（一种硬件验证语言）进行了此操作。

# windows - 枚举 Windows 网络共享和所有自定义权限

> ID：115649
> 
> 赞同：1
> 
> 时间：2008-09-22T15:44:34.137
> 
> 标签：windows, active-directory, file-permissions, shared-directory

我们有各种共享许多目录的服务器。查看共享浏览器可以很容易地了解“顶级”共享是什么，但下面是杂乱无章的自定义权限，没有一个记录在案。

我想枚举域上的所有共享（绝对是所有的“服务器”，本地 PC 会很好），然后递归每个共享并报告与父级的任何偏差。如果孩子具有相同的权限，则无需报告。

我更喜欢简单的脚本解决方案来编写大型 C# 应用程序，但任何可行的方法都可以（甚至是现有软件）。

例如，我想得到：

```
SERVER1\
 \-- C: (EVERYONE: Total control, ADMINs, etc. etc.)
   \-- (skip anything that is not the same as above)
   \-- SuperSecretStuff (Everyone: NO access; Bob: Read access)
SERVER2\ 
 \-- Stuff (some people) 
```

等等

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T20:11:53.527

我知道这不是脚本，但你试过 ShareEnum 吗？[http://technet.microsoft.com/en-us/sysinternals/bb897442.aspx](http://technet.microsoft.com/en-us/sysinternals/bb897442.aspx)然后将其导出？您还可以与较旧的运行进行比较。我认为没有命令行界面（很烂），但它会为您提供所需的信息

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-09-25T13:42:47.303

[这个 Powershell 脚本](http://gallery.technet.microsoft.com/scriptcenter/List-Share-Permissions-83f8c419)可以实现您的目标。

如前所述：

> 这个小脚本将枚举计算机上的所有共享，并列出每个共享的共享级别权限。它使用 WMI 检索共享，并列出权限。
> 
> 请注意，此脚本列出了共享级别的权限，而不是 NTFS 权限。
> 
> 它接受多台计算机作为其输入、单个 IP 或在本地系统中运行它：

```
 .EXAMPLE 
       C:\PS> .\Get-SharePermissions # Operates against local computer. 

       .EXAMPLE 
       C:\PS> 'computerName' | .\Get-SharePermissions 

       .EXAMPLE 
       C:\PS> Get-Content 'computerlist.txt' | .\Get-SharePermissions | Out-File 'SharePermissions.txt' 
```

# .net - ASP.NET Framework effects of moving from 2.0 to 3.5?

> ID：115656
> 
> 赞同：12
> 
> 时间：2008-09-22T15:45:38.487
> 
> 标签：.net, asp.net, visual-studio, visual-studio-2008, .net-3.5

I've started using Visual Studio 2008 and it keeps asking me to upgrade my 2.0 website project to 3.5 **every time** it opens.

*   What effectively happens when I "upgrade" a website project from 2.0 to 3.5 in Visual Studio?
*   Does it update my web.config? How exactly does it change my project/website/code?
*   Is there a potential for any 2.0 methods/settings to BREAK upon upgrade to 3.5?
*   Are there any gotchas involved?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-22T17:29:17.367

(As mentioned elsewhere across the other answers, plus some extras:)

*   Converting a VS 2005 solution to VS 2008 will mean that you'll need to maintain duplicates, or others must also be using Visual Studio 2008 (while the project file format (which from your question you're not using anyway) is in theory unchanged between 2005 and 2008, the solution files are not compatible...)

*   Converting the website to 3.5 mostly affects the web.config. Some references are added to a few default 3.5 assemblies, such as System.Core.dll. And it will add the IIS 7 sections (which is all ignored if the site is published to an IIS6 box).

*   Generally don't see new compile time errors from the upgrade (and if you do, wouldn't expect many). Both the C# and VB teams have put effort into ensuring backwards compatibility on all the new LINQ keywords... so you can have a local named "var" in a method named "where" in a class named "from" and everything compiles just fine... (an improvement for anyone who had symbols named "operator" in a VB 2003 codebase when upgrading to 2005 :-)

*   Obviously, once you've switched, you'll need .NET 3.5 on any server you deploy to. Unlike .NET 1.1 vs .NET 2.0 though, there are no CLR version / AppPool issues to worry about, it all runs in .NET 2.0\. Read on below...

If you are worried about run-time regression for any existing .NET 2.0 code, there's good news and bad news.

The good news: regression is virtually unheard of.

The bad (or other good) news: If you've installed .NET 3.5 on a server running 2.0 sites, you've already tested for regressions :)

As mentioned above, .NET 3.5 is really just the .NET 2.0 CLR with some extra assemblies and new compiler functionality.

And when you install .NET 3.5, it also installs a service pack for .NET 2.0 and 3.0\. So any breaking change would already be affecting .NET 2.0 websites, without any explicit upgrade step.

Scott Hanselman posted a good explanation of the difference between CLR version and .NET Runtime version [here](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx) a while back.

One final comment - you should be aware that when using VS 2008 to target .NET 2.0, you are actually compiling against the updated .NET 2.0\. So if you use one of the (very few, and rarely used) methods quietly *added* to the updated version of .NET 2.0, such as GCSettings.LatencyMode, when you deploy to a machine that has the original .NET 2.0 RTM, it will fail to run. Read about it in more detail [here](http://blogs.msdn.com/kcwalina/archive/2007/10/02/Multi_2D00_TargetingAndFxCop.aspx), and Scott also posted a full list of [API changes here](http://www.hanselman.com/blog/content/binary/org2.0to2.0/APIChangesorg2.0to2.0.html))

While actually encountering an issue like this is pretty unlikely, in some ways (even excluding the benefits of the new 3.5 features) you're better off on 3.5 :-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T15:48:23.207

It updates your web.config to use a few newer dlls. I have yet to experience any breaking changes.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T15:48:32.427

As I understand it, .NET 3.5 is .NET 2.0 with some additional libraries, for new features like LINQ. Therefore, you *should* be able to upgrade seamlessly.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T15:49:05.547

> Is there a potential for any 2.0 methods/settings to BREAK upon upgrade to 3.5?

There's *always* potential for breakage but I suggest you back everything up and give it a go sooner rather than later. If you keep putting it off, you'll find it's a lot more painful when you have several versions of framework API changes to make up for.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T15:49:10.443

If you upgrade the project type, it simply updates the .csproj/.vbproj files to work with the new version. You can set the targeted code base inside project settings to retain functionality on older framework versions.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T15:49:18.963

If, in the upgrade wizard, you choose not to target your code to 3.5, nothing of your application will change. The main difference is that it will "visual-studify" your Solution and project files so that they potentially can't be opened by an older IDE.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T15:49:38.510

All the changes will be in the web.config file. It grows HUGE with new settings for .NET 3.5 assemblies, AJAX handlers, and IIS7 configuration settings. But there are tons of documentations on the internet that describe the differences.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T15:59:43.820

I have upgraded several projects this way and have had no breaking changes. As an experiment, I did this on a project that the rest of my team was using on VS2005 and also experienced no issues, though I made sure not to check in my solution file (which we keep locally as a matter of policy anyway).

The results have been transparent to all, with the added bonus of being able to target different .Net versions.

# c# - 使用 DataReader 和 OLEDB Jet 数据提供程序读取 CSV 文件时，如何控制列数据类型？

> ID：115658
> 
> 赞同：15
> 
> 时间：2008-09-22T15:45:53.713
> 
> 标签：c#, .net, csv, oledb

在我的 C# 应用程序中，我使用 Microsoft Jet OLEDB 数据提供程序来读取 CSV 文件。连接字符串如下所示：

```
Provider=Microsoft.Jet.OLEDB.4.0;Data Source=c:\Data;Extended Properties="text;HDR=Yes;FMT=Delimited 
```

我使用该连接字符串打开一个 ADO.NET OleDbConnection 并使用以下命令从 CSV 文件中选择所有行：

```
select * from Data.csv 
```

当我打开 OleDbDataReader 并检查它返回的列的数据类型时，我发现堆栈中的某些东西试图根据文件中的第一行数据来猜测数据类型。例如，假设 CSV 文件包含：

```
House,Street,Town
123,Fake Street,Springfield
12a,Evergreen Terrace,Springfield 
```

为 House 列调用 OleDbDataReader.GetDataTypeName 方法将显示该列已被赋予数据类型“DBTYPE_I4”，因此从中读取的所有值都被解释为整数。我的问题是 House 应该是一个字符串 - 当我尝试从第二行读取 House 值时，OleDbDataReader 返回 null。

如何告诉 Jet 数据库提供程序或 OleDbDataReader 将列解释为字符串而不是数字？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-22T17:02:46.460

要扩展 Marc 的答案，我需要创建一个名为 Schema.ini 的文本文件，并将其放在与 CSV 文件相同的目录中。除列类型外，此文件还可以指定文件格式、日期时间格式、区域设置和列名（如果文件中未包含它们）。

为了使我在问题中给出的示例有效，Schema 文件应如下所示：

```
[Data.csv]
ColNameHeader=True
Col1=House Text
Col2=Street Text
Col3=Town Text 
```

我也可以尝试让数据提供者在尝试猜测数据类型之前检查文件中的所有行：

```
[Data.csv]
ColNameHeader=true
MaxScanRows=0 
```

在现实生活中，我的应用程序从具有动态名称的文件中导入数据，因此我必须在打开连接之前动态创建一个 Schema.ini 文件并将其写入与 CSV 文件相同的目录。

可以在此处找到更多详细信息 - [http://msdn.microsoft.com/en-us/library/ms709353(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms709353(VS.85).aspx) - 或通过在 MSDN 库中搜索“Schema.ini 文件”。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-22T15:50:27.557

您可以创建一个模式文件，它会告诉 ADO.NET 如何解释 CSV - 实际上是给它一个结构。

试试这个：[http ://www.aspdotnetcodes.com/Importing_CSV_Database_Schema.ini.aspx](https://web.archive.org/web/20081009034412/http://www.aspdotnetcodes.com/Importing_CSV_Database_Schema.ini.aspx)

或最新的[MS 文档](https://docs.microsoft.com/en-us/sql/odbc/microsoft/schema-ini-file-text-file-driver?view=sql-server-2017)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-10-05T07:28:08.117

请检查

[http://kbcsv.codeplex.com/](http://kbcsv.codeplex.com/)

```
using (var reader = new CsvReader("data.csv"))
{
    reader.ReadHeaderRecord();
    foreach (var record in reader.DataRecords)
    {
        var name = record["Name"];
        var age = record["Age"];
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-30T15:37:53.767

您需要告诉驱动程序扫描所有行以确定架构。否则，如果前几行是数字，其余行是字母数字，则字母数字单元格将为空白。

像[Rory](https://stackoverflow.com/a/116111/2350083)一样，我发现我需要动态创建一个 schema.ini 文件，因为无法以编程方式告诉驱动程序扫描所有行。（这不是 excel 文件的情况）

你必须`MaxScanRows=0`在你的 schema.ini

这是一个代码示例：

```
 public static DataTable GetDataFromCsvFile(string filePath, bool isFirstRowHeader = true)
    {
        if (!File.Exists(filePath))
        {
            throw new FileNotFoundException("The path: " + filePath + " doesn't exist!");
        }

        if (!(Path.GetExtension(filePath) ?? string.Empty).ToUpper().Equals(".CSV"))
        {
            throw new ArgumentException("Only CSV files are supported");
        }
        var pathOnly = Path.GetDirectoryName(filePath);
        var filename = Path.GetFileName(filePath);
        var schemaIni =
            $"[{filename}]{Environment.NewLine}" +
            $"Format=CSVDelimited{Environment.NewLine}" +
            $"ColNameHeader={(isFirstRowHeader ? "True" : "False")}{Environment.NewLine}" +
            $"MaxScanRows=0{Environment.NewLine}" +
            $" ; scan all rows for data type{Environment.NewLine}" +
            $" ; This file was automatically generated";
        var schemaFile = pathOnly != null ? Path.Combine(pathOnly, "schema.ini") : "schema.ini";
        File.WriteAllText(schemaFile, schemaIni);

        try
        {
            var sqlCommand = $@"SELECT * FROM [{filename}]";

            var oleDbConnString =
                $"Provider=Microsoft.Jet.OLEDB.4.0;Data Source={pathOnly};Extended Properties=\"Text;HDR={(isFirstRowHeader ? "Yes" : "No")}\"";

            using (var oleDbConnection = new OleDbConnection(oleDbConnString))
            using (var adapter = new OleDbDataAdapter(sqlCommand, oleDbConnection))
            using (var dataTable = new DataTable())
            {
                adapter.FillSchema(dataTable, SchemaType.Source);
                adapter.Fill(dataTable);
                return dataTable;
            }
        }
        finally
        {
            if (File.Exists(schemaFile))
            {
                File.Delete(schemaFile);
            }
        }
    } 
```

如果您同时在多个线程中的同一目录上运行它，则需要进行一些修改。

# windows-mobile - Windows Mobile 开发 - 便携式编程？

> ID：115659
> 
> 赞同：0
> 
> 时间：2008-09-22T15:46:12.370
> 
> 标签：windows-mobile, devtools

我想开始为 Windows Mobile 设备开发，因为我打算下周购买一台。（发薪日）

到目前为止，我的大部分 PDA 体验都是使用 Palm OS（m100、m105、Zire 71 和 T3）。对于 Palm，有一些很好的编程工具，主要是[PocketC](http://www.orbworks.com/pcpalm/index.html)和[OnboardC](http://onboardc.sourceforge.net/)。这些让您可以在路上进行编程和测试。在我的 PC 上编写完整的应用程序之前，我会大量使用 PocketC 进行测试和原型设计。

现在的问题是 Windows Mobile 是否有任何等价物，可以让我在手机上编译/解释代码？

谢谢

PS我知道PocketC CE（不再受支持）和PythonCE，尽管我更喜欢仍然受支持的东西，或者像C或C++。

**编辑：**
也许我应该说我有预算，NSBasic 看起来不错，但 149.99 美元几乎是设备的价格。唯一的另一个问题是它是 BASIC。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T10:04:53.330

嗯.. 所以你真的想在设备上开发？为什么？

无论如何，这是您的选择：

*   [袖珍海合会](http://sourceforge.net/project/showfiles.php?group_id=96949)
*   [袖珍 C# 编译器](http://weblogs.asp.net/pleloup/archive/2004/06/09/151853.aspx)
*   [Ruby on Windows Mobile](http://andryshuzain.com/journal/ruby-on-windows-mobile-5)和[支持文章](http://andryshuzain.com/journal/ruby-on-windows-mobile-5)
*   [PythonCE](http://pythonce.sourceforge.net/)
*   [用于 Windows CE 的 PocketC](http://www.orbworks.com/pcce/index.html)

我知道你提到了 PythonCE 和 Pocket C。但为了理解而添加了 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T16:59:53.147

NSBASIC 怎么样？他们的产品页面 ( [http://www.nsbasic.com/ce/](http://www.nsbasic.com/ce/) ) 说你可以在设备上开发，但我只有 Palm 版本的个人经验，我不需要在桌面以外的任何地方开发。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T17:45:48.230

NS Basic/CE 允许您在设备上进行编程。它有一个内置的屏幕设计器和一个简单的调试器。该语言本身是 VBScript（VB 的一个子集），带有针对 Windows Mobile 的扩展。它还支持 SQLite、Winsock 等的外部 dll。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T00:15:07.420

我不知道它是否会做你想做的事，但也有[MortScript](http://www.sto-helit.de/index.php?module=page&entry=ms_overview&action=view)。

# c# - Infralution VirtualTree leaking GDI+ Objects when Icons are set in GetRowData event handler

> ID：115663
> 
> 赞同：0
> 
> 时间：2008-09-22T15:46:39.810
> 
> 标签：c#

We have seen what appears to be GDI Object leakage when the Infralution VirtualTree control assigns Icons in the GetRowData event. The VirtualTree is contained in a control that is contained within a TabControl. Tabbing away and back to the tree results in the "GDI Objects" counter in Task Manager to continually increment. After commenting out the GetRowData event (basically eliminating the Icons), switching back and forth to this tab results in no increase in GDI Object count.

This has become an issue with our application as several instances of it run at once on client machines, and under load our application crashes due to errors in GDI Object creation.

Is there anyway to pre-empt a cleanup on the Tree control (besides disposing it?). I looked into moving the tree initialization code out of the designer so that I could dispose/re-initialize it each time, but am worried at the impact on ability to design the overall control.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T16:01:46.063

Can we see the code for GetRowData? If this function allocates the GDI objects for the icons, then the solution is to re-use icons rather than re-creating them every time.

# php - 在 CakePHP 中，如何确定某个字段是否在编辑操作中被更改？

> ID：115665
> 
> 赞同：11
> 
> 时间：2008-09-22T15:47:02.960
> 
> 标签：php, cakephp

我正在使用`cacheCounter`in `CakePHP`，它为相关字段增加一个计数器。

例如，我有一个 Person 表和一个 Source 表。Person.source_id 映射到 Source 表中的一行。每个人都有一个 Source，每个 Source 都没有或有多个 Person 行。

`cacheCounter`当我改变一个人的来源的价值时，效果很好。它递增`Source.Person_Count`。凉爽的。

但是当它增加时，它会将它添加到一个人的目标源中，但不会从旧值中删除它。我试过`updateCacheControl()`了`afterSave`，但这并没有做任何事情。

然后我在我的模型中编写了一些代码，用于`afterSave`减去源 source_id，但即使我什至没有更改`source_id`. （所以计数变为负数）。

我的问题：有没有办法判断模型中的字段是否已更改`CakePHP`？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-26T10:04:22.300

要监视字段中的更改，您可以在模型中使用此逻辑，而无需在其他地方进行更改：

```
function beforeSave() {
    $this->recursive = -1;
    $this->old = $this->find(array($this->primaryKey => $this->id));
    if ($this->old){
        $changed_fields = array();
        foreach ($this->data[$this->alias] as $key =>$value) {
            if ($this->old[$this->alias][$key] != $value) {
                $changed_fields[] = $key;
            }
        }
    }
    // $changed_fields is an array of fields that changed
    return true;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-08-24T05:38:50.330

参考***Alexander Morland***答案。

这个怎么样，而不是在过滤器之前循环它。

```
$result = array_diff_assoc($this->old[$this->alias],$this->data[$this->alias]); 
```

您还将获得关键和价值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T19:52:31.210

编辑很少发生，所以在你更新之前再做一次选择没什么大不了的，所以，在你保存之前获取记录，保存它，将编辑表单中提交的数据与你在保存之前从数据库中获取的数据进行比较，如果它不同，做点什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T20:02:03.807

在编辑视图中，为要监视的字段包含另一个隐藏字段，但在字段名称后加上“_prev”之类的后缀，并将值设置为要监视的字段的当前值。然后在控制器的编辑操作中，如果两个字段不相等，请执行某些操作。例如

```
echo $form->input('field_to_monitor');
echo $form->hidden('field_to_monitor_prev', array('value'=>$form->value('field_to_monitor'))); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-08-18T17:50:08.400

您可以在实体中使用 ->isDirty() 来查看字段是否已被修改。

```
// Prior to 3.5 use dirty()
$article->isDirty('title'); 
```

check the doc: [https://book.cakephp.org/3/en/orm/entities.html#checking-if-an-entity-has-been-modified](https://book.cakephp.org/3/en/orm/entities.html#checking-if-an-entity-has-been-modified)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-23T09:15:55.733

查看“保存”是否使用某种返回“受影响的行”的 DBAL 调用，通常这是您可以判断最后一个查询是否更改数据的方式，或者是否没有。因为如果没有，UPDATE 语句后受影响的行是 0。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-09-13T20:49:10.513

您可以在任何模型类上调用 getAffectedRows()。

从类模型：

```
/**
 * Returns the number of rows affected by the last query
 *
 * @return int Number of rows
 * @access public
 */
    function getAffectedRows() {
        $db =& ConnectionManager::getDataSource($this->useDbConfig);
        return $db->lastAffected();
    } 
```

# spell-checking - ASpell 的好选择？

> ID：115666
> 
> 赞同：8
> 
> 时间：2008-09-22T15:47:04.723
> 
> 标签：spell-checking, aspell

ASpell 有什么好的替代品吗？开源的不错，不过好久没更新了。性能不太好，我无法使用非字母字符创建自定义工作列表。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T15:48:01.867

[亨斯佩尔](http://hunspell.sourceforge.net/)。这是 Firefox 用于其拼写检查器的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T15:48:26.797

查看[Hunspell](http://hunspell.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T16:09:23.143

还有[Ispell](http://ficus-www.cs.ucla.edu/geoff/ispell.html "国际伊斯佩尔")，可能不会更快或维护得更好，但它支持国际字符。我不知道它与 Hunspell 相比如何。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-31T18:46:34.103

我为 emacs flyspell 程序切换到 aspell，但它一直冻结我的电脑，我切换回 ispell。

(setq-default ispell-program-name "ispell")

# mysql - MySQL InnoDB 数据库恢复

> ID：115681
> 
> 赞同：10
> 
> 时间：2008-09-22T15:49:22.957
> 
> 标签：mysql, backup, innodb, restore

我必须恢复在 MySQL 5.0 中无意中删除的数据库。通过检查备份文件，我似乎只有 .FRM 文件来保存数据库数据。

谁能告诉我这是否是我从备份中执行数据库恢复/导入所需的全部内容，还是我应该提供其他文件来完成此操作？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-22T16:06:31.790

.frm 文件不是数据文件，它们只是存储“数据字典信息”（参见[MySQL 手册](http://dev.mysql.com/doc/refman/5.0/en/innodb-troubleshooting-datadict.html)）。InnoDB 将其数据存储在 ib_logfile* 文件中。这就是您进行备份/恢复所需要的。有关更多详细信息，请参见[此处](http://dev.mysql.com/doc/refman/5.1/en/innodb-backup.html)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-06-17T05:44:36.893

恢复 innodb：（假设你的数据文件夹是 C:\ProgramData\MySQL\MySQL Server 5.5\data）

1.  将要还原的数据库的文件夹（以数据库名称命名）复制到 C:\ProgramData\MySQL\MySQL Server 5.5\data
2.  将 3 个 ibdata 文件复制到数据文件夹 ex。(C:\ProgramData\MySQL\MySQL 服务器 5.5\data)

    > ```
    > _ib_logfile0
    > _ib_logfile1
    > _ibdata1 
    > ```

3.  通过文件右键->属性获取_ib_logfile0的大小，单位为MB（应该和_ib_logfile1一样）

4.  编辑 mysql 配置文件 (mysql\bin\my.ini) 以使 innodb_log_file_size=343M 与 ibdata 文件大小完全相同

5.  跑

    > mysqld --defaults-file=mysql\bin\my.ini --standalone --console --innodb_force_recovery=6

6.  现在您的数据应该回到您的数据库中。使用 phpmysql 或任何其他工具导出它们

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-22T16:18:21.187

哦，我的……你有麻烦了。关闭数据库。备份 innodb 文件。祈祷你删除数据库后什么都不做。

Percona 的人（包括 MySQL 性能博客的作者）应该能够帮助您：[Percona 紧急支持](http://www.percona.com/contacts/emergency-support.html)。

如果您自己冒险，请随身携带：[Innodb 的数据恢复工具包](http://code.google.com/p/innodb-tools/)。

物流呢？您必须阅读每一页（计算机术语页面......在 Innodb 的情况下为 16k 块）并以这种方式重建您的数据。这是非常低级的工作（我们正在谈论打开你的十六进制编辑器并开始计算字节，如果工具包不为你做的话），如果你不是一个经验丰富的程序员，你会受到伤害.

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2014-03-17T11:58:38.023

您可以在这里找到详细的解决方案：

[http://www.unilogica.com/mysql-innodb-recovery/](http://www.unilogica.com/mysql-innodb-recovery/)（葡萄牙文文章）

除了**innodb_force_recovery**的标志，我还找到了另一个解决方案：**innodb_file_per_table**，它像 MyISAM 表一样在每个文件中拆分 InnoDB 表。

**在崩溃恢复中，与单个文件ibdata1**相比，您丢失的数据更少。

# java - 在eclipse中编译但不在命令行中的代码

> ID：115685
> 
> 赞同：2
> 
> 时间：2008-09-22T15:50:33.780
> 
> 标签：java, eclipse, debugging, eclipse-3.3

我曾经在一个 Java 类中写过这一行。这在 Eclipse 中编译得很好，但在命令行上却没有。

这是在

*   日食 3.3
*   JDK 1.5
*   Windows XP 专业版

有什么线索吗？

命令行上给出的错误是：

```
Icons.java:16: code too large
            public static final byte[] compileIcon = { 71, 73, 70, 56, 57, 97, 50,
                                       ^ 
```

有问题的代码行是：

```
public static final byte[] compileIcon = { 71, 73, 70, 56, 57, 97, 50,
            0, 50, 0, -9, 0, 0, -1, -1, -1, -24, -72, -72, -24, -64, -64,
            -8, -16, -24, -8, -24, -24, -16, -24, -32, -1, -8, -8, 48, 72,
            -72, -24, -80, -80, 72, 96, -40, -24, -24, -8, 56, 88, -56,
            -24, -40, -48, -24, -48, -64, 56, 80, -64, 64, 88, -48, -56,
            -64, -64, -16, -24, -24, -32, -40, -40, -32, -88, -96, -72,
            -72, -72, -48, -56, -56, -24, -32, -32, -8, -8, -1, -24, -40,
            -56, -64, -72, -72, -16, -32, -40, 48, 80, -72, -40, -96, -104,
            -40, -96, -96, -56, -104, -104, 120, 88, -104, -40, -64, -80,
            -32, -88, -88, -32, -56, -72, -72, -80, -80, -32, -80, -88,
            104, -96, -1, -40, -40, -40, -64, -104, -104, -32, -56, -64,
            -112, 104, 112, -48, -104, -112, -128, -112, -24, -72, -80,
            -88, -8, -8, -8, -64, -112, -120, 72, 104, -40, 120, 96, -96,
            -112, -96, -24, -112, -120, -72, -40, -88, -88, -48, -64, -72,
            -32, -72, -80, -48, -72, -88, -88, -72, -24, 64, 88, -56, -120,
            96, 104, 88, -128, -72, 48, 56, 56, 104, 104, 120, 112, -120,
            -16, -128, 104, -88, -40, -48, -48, 88, -120, -24, 104, 88,
            -104, -40, -56, -72, -128, 112, -88, -128, 96, -88, -104, -88,
            -24, -96, -120, 120, -88, -128, -80, -56, -56, -64, 96, 120,
            -8, -96, -128, -88, -80, -96, -104, -32, -72, -72, 96, 104,
            112, 96, -104, -8, -72, -112, -112, -64, -72, -80, 64, 64, 72,
            -128, -120, -96, -128, 88, 88, -56, -72, -80, 88, 96, 120, -72,
            -128, 112, 72, 112, -40, 96, 120, -56, 88, -112, -16, 64, 104,
            -48, -64, -80, -88, -88, -120, -80, 88, 88, 96, -56, -96, -120,
            -40, -56, -64, 96, 104, 120, -120, -80, -24, -104, -88, -40,
            -48, -72, -80, -64, -56, -16, -88, -112, -128, -32, -48, -56,
            -24, -16, -8, -64, -120, 120, -96, -96, -88, 80, -128, -24,
            -56, -72, -88, -96, 120, 88, -72, -112, 120, -64, -104, 120,
            -48, -56, -64, -120, -104, -32, -104, 120, -80, -96, -112,
            -120, 56, 88, -64, -128, 96, 64, 88, 120, -40, -80, -104, -120,
            -104, -128, 104, 96, -104, -24, -72, -120, -128, 56, 96, -56,
            -128, 112, 104, -48, -88, -112, 96, 96, 104, -104, -88, -72,
            -40, -88, -96, -72, -88, -96, -120, 120, 104, -80, -88, -96,
            72, 72, 80, -120, 88, 96, 120, -120, -24, 96, -104, -16, 104,
            80, 48, -56, -80, -96, -56, -88, -104, -104, 120, -88, -88,
            120, 104, -72, -120, -120, -24, -32, -40, 112, 88, -104, 120,
            96, -104, -32, -32, -32, -96, 96, 96, 80, 80, 88, 64, 88, 120,
            72, 120, -40, 72, 88, 112, -88, -96, -104, -56, -80, -88, -72,
            -88, -104, -56, -64, -72, -80, -120, 104, -80, -120, -80, -112,
            112, -88, 120, 112, 112, 112, -96, -24, -120, -120, -64, -120,
            120, -80, 64, 96, -128, 96, 64, 64, 96, -128, -32, 80, 112,
            -24, 112, -120, -24, 104, -96, -8, 96, 120, -16, -88, 120, 120,
            -72, -56, -16, -128, -128, -128, -104, -120, -72, -64, -96,
            -120, -32, -64, -64, -40, -48, -56, -64, -88, -96, -64, -104,
            -72, -96, -88, -24, -104, -96, -40, -96, -128, 96, -128, -128,
            -96, 104, 88, 80, 112, -88, -8, -64, -104, -80, -96, -120, 112,
            96, 120, -32, 56, 80, -72, -104, -88, -32, 104, -128, -24, -56,
            -88, -120, -80, -72, -8, -96, -128, -128, -64, -128, 96, -72,
            -96, -120, 72, 104, -32, -96, 96, 64, -72, -96, -112, -32, -40,
            -48, -64, -88, -112, -88, -128, 96, -88, -128, -88, -64, -64,
            -32, -128, -96, -32, -88, -104, -112, 32, 32, 64, -120, 104,
            -88, 120, -120, -16, -104, 120, -72, -24, -48, -56, -96, -96,
            -96, -64, 96, 96, 96, 64, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 44, 0, 0, 0, 0,
            50, 0, 50, 0, 0, 8, -1, 0, 1, 8, 28, 72, -80, -96, -63, -125,
            8, 19, 42, 92, -120, 112, 0, 3, 6, 12, 23, 6, -104, 72, -79,
            -94, -59, -117, 19, 39, -124, 64, -128, -128, 3, -121, 9, 19,
            48, -118, -92, 24, 81, 33, -118, 8, 40, 7, -88, 84, -55, -64,
            12, 6, 6, 45, 74, -54, 52, 8, 73, -60, 24, 22, 25, 92, 73, 40,
            64, -96, -64, 74, -121, 24, 94, -58, -100, 25, -79, -59, 47,
            17, 3, 52, -120, 88, -125, 105, 73, 6, 42, -102, -68, 96, -16,
            -71, 18, 3, -118, 6, 13, 14, -114, -36, 26, -64, 69, 7, 18, 28,
            -61, -110, -32, -32, -62, -54, -94, 72, -61, -48, -88, -40, 72,
            34, -60, 4, 21, 23, -119, 14, -92, 80, -58, 6, -108, 10, 18,
            44, 68, -8, 57, -96, -128, 16, 98, 70, -24, -48, 97, -45, 6, 4,
            6, 16, 67, -27, 18, 52, -79, -52, -89, -46, 49, -105, -74, -32,
            109, -45, -85, -63, -49, 2, 13, 88, -51, -62, 5, 40, 80, 31,
            91, 103, 20, 11, -116, 32, -124, -81, -54, 2, 40, -58, -40,
            -103, -59, -122, 13, 43, 51, 12, 122, 106, 96, -48, 0, -105,
            40, 29, 106, 32, 17, 20, -64, -69, -73, -17, -33, -68, 25, 113,
            13, 80, -125, 44, -102, 72, 108, -84, -88, 80, 49, -127, -61,
            -94, 28, -97, -108, -4, -98, -103, 102, 9, -127, -21, -40, -81,
            23, -32, 35, -126, 39, -10, 2, 32, -116, 29, -1, 27, -74, 37,
            -40, 29, 60, 90, -60, -120, -90, 0, -122, -118, -23, -107, 54,
            -36, -72, -15, 2, 66, -61, -23, -39, 24, -8, -36, -7, -108,
            -27, -128, 44, -59, -112, -16, -64, 67, 3, -39, 21, 72, 0, 6,
            34, 120, -31, -123, 124, 124, 52, 16, 84, 3, -119, -88, 82,
            -62, 28, -2, 21, 4, -36, -123, -83, -92, -96, 97, 13, 20, 117,
            112, 2, -121, 24, 77, -128, 6, 48, -64, 72, -93, -62, 31, 104,
            -56, 48, 68, 16, 65, 112, 49, 29, 67, 82, 8, 24, 72, 118, 18,
            84, 48, 66, 6, 63, 72, 96, 96, 1, 26, -128, 64, -97, 8, 50, 24,
            114, -64, -112, -22, -51, -28, 7, 24, 77, 116, -15, 75, 1, 123,
            53, 2, -63, 15, 22, 88, 0, 1, 5, 44, 72, 32, -127, 74, -78,
            -47, -122, -62, 27, -90, -24, 49, -28, 1, 69, -106, -108, 76,
            21, -99, 8, -127, -119, 29, -81, 60, 41, -63, 15, 16, -116, 80,
            65, -114, 22, -44, 40, 72, 6, 111, 60, 4, 77, 3, 34, -124, 1,
            -60, -105, 7, 40, 96, -31, -123, -68, 49, -111, 66, 30, 32,
            102, -92, 66, 30, 86, 60, -47, -63, 12, 30, 42, 58, 67, 13, 51,
            120, -32, 1, 35, 30, 112, 112, -62, 39, -114, -80, 24, -124,
            116, 47, 30, 116, 6, 15, -120, 24, -104, 93, 3, -105, 44, -79,
            12, 11, -103, -116, 112, 35, 20, 52, -96, 64, 3, 32, 91, -40,
            -1, 114, 5, -97, 126, -106, 36, 5, 24, -106, -67, 103, 26, 3,
            32, -68, -14, 10, 20, 44, 88, -78, -124, 37, 91, -124, -47,
            -33, -105, 112, -56, -28, 7, -103, -70, -86, 116, -57, 29, 52,
            80, 37, -101, 8, 54, 24, 99, -121, 17, 82, -108, -80, 0, -83,
            7, 93, 56, 70, 14, 41, -96, -78, -107, 11, -117, -48, 97, -42,
            12, 127, 32, 64, 66, 91, 19, -96, -88, -94, 35, -16, 110, 10,
            -88, 65, 103, 76, -62, 67, 19, 114, -120, -102, 93, 49, 107,
            -108, 65, -121, 29, -121, -36, 65, -116, 16, 24, -32, 121,
            -125, 33, -70, 108, -96, 112, -97, 37, 5, -127, 100, 23, -128,
            -4, 68, 65, 5, 123, -103, 102, -63, 24, 101, -20, 49, -51, 33,
            -121, -40, 80, 65, 9, 122, 40, -84, 112, -78, 17, 73, 81, 69,
            -110, -110, -28, -38, -105, 9, 84, -30, 69, 21, -106, 60, 106,
            32, 68, 25, -127, -96, -96, -25, 6, 14, 56, -96, 112, -83, 90,
            81, 116, 2, -72, 57, 16, 66, 8, 88, 28, 49, 26, 66, 8, 51, 60,
            -15, -60, 9, 51, -128, -75, -82, 91, 19, 116, 96, -87, 12, 31,
            84, 93, -75, 18, 91, 13, 100, -126, -67, 125, 72, 50, 72, 45,
            63, 89, -112, 1, 5, 20, -104, 96, 65, 1, 38, -4, 48, 49, 4,
            -82, 60, 84, 48, 13, -90, 92, -111, -13, -36, 60, 39, -44, 66,
            40, 96, -12, -47, -59, 32, 81, -20, -1, -15, 19, 4, 18, 68, 80,
            64, 5, 72, -80, 0, -127, 9, 17, 72, -112, 9, 20, -106, -48,
            -48, -86, -79, 56, -49, 77, -14, 66, -76, -100, -68, 119, 20,
            59, 44, -15, 19, -53, 20, 0, 30, 103, -101, 110, -66, 97, -122,
            25, 52, 44, 33, -125, -74, 11, -92, -98, 115, -35, 90, -55, 1,
            52, 33, 83, 76, 33, -118, 10, 97, 73, -70, 81, 7, 29, 44, -35,
            1, -46, 29, 76, -22, 2, 7, 30, -84, 50, -60, 7, 48, 60, 114,
            -11, 112, 0, -124, -95, 67, 21, -110, 96, -66, -61, 14, 12,
            -84, 36, -27, 8, -99, -101, 80, -128, 5, 72, -36, -104, -55,
            23, -92, 83, -95, -116, 19, 14, -92, 46, 62, -21, 8, 21, 1, 68,
            9, -93, -124, -78, 3, 51, 59, -68, -84, 82, -30, 72, 84, 64, 1,
            18, 121, 85, 0, -123, 32, -126, -80, -112, 6, -56, 11, -32, 32,
            -2, -28, 10, -71, -64, 5, -80, 48, 7, 74, 56, -63, 16, 58, -40,
            65, 45, -28, -16, 5, -108, 56, 16, 37, -112, -80, 17, 5, 70,
            -16, 6, 87, 124, -127, 5, -98, 0, -126, 3, 30, -128, -125, 14,
            -30, 64, 1, 2, 12, -95, 8, 67, 8, 0, -118, 108, -126, 8, 31,
            -16, 1, 40, 100, -96, -120, 20, 76, 33, 18, 121, -104, 64, 88,
            102, 24, 2, -78, 48, 66, 5, -101, -96, 26, 12, 118, -72, 67,
            100, 12, 103, 34, 4, 89, 65, 18, -1, 72, -127, -125, 2, 30, 80,
            7, -107, -24, -37, 22, 26, -15, -66, 2, 20, -96, 17, 12, 64,
            65, 52, -30, -74, -128, 7, 88, -47, -118, -28, 99, -120, 2,
            122, -112, -124, 36, -100, 34, 1, 14, -48, -126, 26, 74, -128,
            -121, 80, 68, 33, 10, -127, -80, -127, 6, 98, -122, 1, 42, 120,
            34, 11, 27, -72, -94, 21, 1, 56, 19, 50, 116, -47, -117, -89,
            32, -59, 3, 28, 112, 5, 39, -108, 0, -119, 81, 16, -123, 17,
            108, 96, 6, 42, -8, 65, 91, 15, 72, -128, 28, -77, -120, 16,
            -116, -64, -30, 25, 113, -120, 100, 36, -101, -15, 8, 24, -84,
            80, 6, 46, -116, 93, 36, -124, -9, 1, 34, 120, -46, -109, 71,
            -8, 33, 73, 16, 66, -122, 21, -12, -32, -108, 61, 40, 5, 47,
            18, 48, -121, 62, -2, 113, 18, 58, 112, -62, 6, 18, 64, -53,
            90, 50, 82, 49, 10, 40, -62, 41, 11, -63, 75, 94, -68, 32, 117,
            106, -16, -93, 30, 18, 89, -53, 4, -60, 64, 52, 10, 81, -128,
            47, 86, -64, 76, 102, -106, 34, 23, 47, -48, -126, 22, 28, 80,
            76, 90, -34, 82, 32, 6, -56, -90, 54, 69, 25, 0, 38, -64, -126,
            11, 71, 8, -89, 56, -107, -96, 8, 31, -104, -45, 7, 68, -32, 2,
            55, -127, 72, -108, 11, -112, -95, 8, 49, -120, -89, 60, 71,
            -15, -126, 122, 38, -32, -102, -56, 60, -120, 2, 110, 80, 51,
            -124, 126, -58, -94, 8, -62, -88, -25, 49, -13, 41, 23, 5,
            -112, -31, 6, 8, 93, 65, 64, -15, -39, -56, 117, 98, -124, 9,
            51, -72, -59, 45, 56, -95, 78, -121, 6, -128, -96, 5, -39, 39,
            67, 49, -54, -47, -114, 122, -44, 32, 1, 1, 0, 59 }; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T17:15:14.933

取自[Sun 支持站点上的这个论坛](http://forums.sun.com/thread.jspa?threadID=747860&messageID=4278559)，任何方法的长度都不能超过 64 KB：

当您有如下代码（伪）时...

```
class MyClass
{
  private String[] s = { "a", "b", "c"}

  public MyClass()
  {
  } 
```

编译器最终生成的代码基本上如下所示。

```
class MyClass
{
  private String[] s;

  private void FunnyName$Method()
  {
    s[0] = "a";
    s[1] = "b";
    s[2] = "c";
  }
  public MyClass()
  {
    FunnyName$Method();
  } 
```

并且如前所述，java 将所有方法限制为 64k，甚至是编译器创建的方法。

可能是 Eclipse 正在偷偷摸摸地解决这个问题，但我向您保证，这在 Eclipse 中仍然是可能的，因为我看到了相同的错误消息。更好的解决方案是从静态文件中读取，如下所示：

```
public class Icons
{
  public static final byte[] compileIcon;
  static
  {
    compileIcon = readFileToBytes("compileIcon.gif");
  }
  //... (I assume there are several other icons)
  private static byte[] readFileToBytes(String filename)
  {
    try {
      File file = new File(filename);
      byte[] bytes = new byte[(int)file.length()];
      FileInputStream fin = new FileInputStream(file);
      fin.read(bytes);
      fin.close();
    }
    catch (Exception e) {
      e.printStackTrace();
      System.exit(1);
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T16:05:24.167

你所拥有的似乎可以编译。

如果可能，我建议尝试将资源嵌入 Jar 并使用 ClassLoader.getResourceAsStream()。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-05T14:04:37.420

Eclipse 有它自己的编译器。Eclipse JDT 编译器处理数组的方式似乎与 javac 不同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T15:59:03.947

很难说为什么你有命令行编译错误，但是......

由于您拥有大量“幻数”，因此可能有比硬编码数组文字更好的方法。

考虑

*   使用静态初始化程序块初始化列表
*   读取一个包含您的数字的 XML 文件，并使用您的类读取 XML 以返回您想要的数据类型（无论是 List 还是 byte[]

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T16:05:49.360

提供确切的错误消息也将帮助我们帮助您...
我想知道为什么您在源代码中硬编码图像（图标），而不是使用某种形式的资源。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T15:53:37.640

从提供的内容很难说，但猜测是

1.  Eclipse 中的 JVM 与命令行不同。
2.  命令行中的错误类路径设置。

什么是编译错误？

你能把问题隔离在一个虚拟类中进行演示吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T16:13:48.887

如果你在 Windows 上写

> 设置 JAVA_HOME=C:\Program Files.... JDK 的路径 路径应该是 jdk 路径而不是我的 PC 上的 jre 是 C:\Program Files\Java\jdk1.6.0_07

**警告**：路径不应该被引号 (") cmd 的自动补全放置它们！

在类 Unix 系统上使用

> export JAVA_HOME= *PATH TO JDK*（允许引用）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T01:32:53.927

您确定您的命令行和 eclipse 使用相同版本的 Java 编译器和相同的编译设置吗？要在命令行类型中找到您正在使用的 Java 版本：Java -version

# model-view-controller - 是否有任何支持多种请求类型的 MVC Web 框架？

> ID：115691
> 
> 赞同：11
> 
> 时间：2008-09-22T15:52:00.733
> 
> 标签：model-view-controller, http, twitter, sms

在我尝试过的每个 MVC 框架（Rails、Merb、Waves、Spring 和 Struts）中，请求（和响应）的概念都与请求的 HTTP 概念相关联。也就是说，即使有一个作为 Request 超类的 AbstractRequest，AbstractRequest 也有诸如标头、请求方法（GET、POST 等）以及与 HTTP 相关的所有其他内容。

我想通过 SMS、Twitter、电子邮件或我可以为其制作适配器的任何其他媒体来支持请求-响应循环。有没有特别好的框架？

例如，我想到的唯一其他选择是创建一个 Twitter 轮询器，该轮询器在单独的线程中运行并将消息转换为本地 HTTP 请求，然后将响应发送回。

如果有*一个*很好的多请求媒体框架，路由会是什么样子？在 Rails 中，HTTP 路由看起来像这样：

```
map.connect 'some/path/with/:parameter_1/:paramter_2', :controller => 'foo', :action => 'bar' 
```

Twitter 或 SMS 路由看起来如何？正则表达式匹配关键字和参数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T16:15:41.270

我一个都没见过。问题是请求也与主机相关联，响应与请求相关联。

因此，如果您通过电子邮件收到请求，并且控制器说要渲染视图“aboutus”，则您需要 MVC 框架知道如何：

*   首先获取请求 - MVC 框架几乎需要成为主机（IIS 不会收到有关新电子邮件的通知，那么您的电子邮件轮询代码是如何被触发的？）
*   允许灵活的路由匹配 - 通过路径/url 匹配并不适用于所有人，因此需要特定于请求的控制器路由
*   使用 aboutus*电子邮件*视图而不是名为“aboutus”的 SMS 或 HTTP 视图
*   通过电子邮件将回复发送给正确的收件人

Web MVC 框架不会削减它 - 你需要一个 MVC“主机”，它可以通过 Web、短信、电子邮件等处理激活。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T15:54:57.447

Java Servlet 规范旨在使 Servlet 保持协议中立，并以特定协议的方式进行扩展 - HttpServlet 是特定于协议的 Servlet 扩展。我一直认为 Sun 或其他第三方框架提供商会提出其他特定于协议的扩展，例如 FtpServlet 或 MailServlet，或者在本例中为 SmsServlet 和 TwitterServlet。

相反，人们要么完全绕过了 Servlet 框架，要么在 HTTP 之上构建了他们的协议。

Of course, if you want to implement a protocol-specific extension for your required protocols, you would have to develop the whole stack - request object, response object, a mechanism of identifying sessions (for example using the MSISDN in an SMS instead of cookies), a templating and rendering framework (equivalent of JSP) - and then build an MVC framework on top of it.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T23:21:02.043

您似乎主要使用 Java 和/或 Ruby，所以请原谅我这个答案基于 Perl :-)。

我非常喜欢 Catalyst MVC 框架 ( [http://www.catalystframework.org/](http://www.catalystframework.org/) )。它通过引擎将请求的实际映射（一般意义上的）委托给代码。诚然，目前所有的引擎类都是基于 HTTP 的，但我一直在尝试编写一个不基于 HTTP 的引擎类（或者可能与 Twitter 之类的东西相关联，但与 HTTP 交互分离） Twitter 使用）。至少，我相信这是可以做到的，即使我还没有开始尝试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T11:31:49.940

您可以在您的网站上实现一个[基于 REST 的](http://en.wikipedia.org/wiki/Representational_State_Transfer)适配器，它会根据输入参数替换模板并重定向。

*来自api* .yourhost.com的所有请求都将由基于 REST 的适配器处理。

该适配器将允许以编程方式调用您的网站，并以可解析的格式获得结果。

实际上这意味着：它用一个自己的模板引擎替换模板，在这个引擎上发生了这样的事情：

*   而不是分配的模板，而是调用通用 xml/json 模板，它只输出一个包含所有模板变量的 xml

然后你可以制作你的 Twitter Poller、SMS Gateway 甚至从 Javascript 调用它。

# java - 如何使用 Hibernate HQL 结果避免类型安全警告？

> ID：115692
> 
> 赞同：108
> 
> 时间：2008-09-22T15:53:27.143
> 
> 标签：java, generics

例如我有这样的查询：

```
Query q = sess.createQuery("from Cat cat");
List cats = q.list(); 
```

如果我尝试做这样的事情，它会显示以下警告

```
Type safety: The expression of type List needs unchecked conversion to conform to List<Cat>

List<Cat> cats = q.list(); 
```

有没有办法避免它？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-09-23T03:38:11.490

正如建议的那样，在任何地方使用`@SuppressWarnings`是一种很好的方法，尽管每次调用时确实需要一些手指打字`q.list()`。

我建议还有另外两种技术：

**写一个演员表助手**

只需将所有内容重构`@SuppressWarnings`到一个地方：

```
List<Cat> cats = MyHibernateUtils.listAndCast(q);

...

public static <T> List<T> listAndCast(Query q) {
    @SuppressWarnings("unchecked")
    List list = q.list();
    return list;
} 
```

**防止 Eclipse 为不可避免的问题生成警告**

在 Eclipse 中，转到 Window>Preferences>Java>Compiler>Errors/Warnings 并在 Generic 类型下，选中复选框 `Ignore unavoidable generic type problems due to raw APIs`

这将关闭针对类似问题的不必要警告，例如上述不可避免的问题。

一些评论：

*   我选择传入`Query`而不是结果，`q.list()`因为这样这种“作弊”方法只能用于在 Hibernate 中作弊，而不是`List`在一般情况下作弊。
*   `.iterate()`您可以为等添加类似的方法。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2015-05-15T20:24:00.280

自从提出问题以来已经有很长时间了，但我希望我的回答可能对像我这样的人有所帮助。

如果您查看 javax.persistence [api 文档](http://docs.oracle.com/javaee/6/api/javax/persistence/EntityManager.html#createQuery(java.lang.String,%20java.lang.Class))，您会发现从那以后那里添加了一些新方法`Java Persistence 2.0`。其中之一是`createQuery(String, Class<T>)`返回`TypedQuery<T>`。您可以`TypedQuery`像以前一样使用它，但`Query`现在所有操作都是类型安全的。

因此，只需将您的代码更改为如下所示：

```
Query q = sess.createQuery("from Cat cat", Cat.class);
List<Cat> cats = q.list(); 
```

你都准备好了。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-09-22T16:55:18.523

我们`@SuppressWarnings("unchecked")`也使用它，但我们最常尝试仅在变量的声明中使用它，而不是在整个方法上使用它：

```
public List<Cat> findAll() {
    Query q = sess.createQuery("from Cat cat");
    @SuppressWarnings("unchecked")
    List<Cat> cats = q.list();
    return cats;
} 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2016-04-05T11:02:14.303

尝试使用`TypedQuery`而不是`Query`. 例如，而不是这个： -

```
Query q = sess.createQuery("from Cat cat", Cat.class);
List<Cat> cats = q.list(); 
```

用这个：-

```
TypedQuery<Cat> q1 = sess.createQuery("from Cat cat", Cat.class);
List<Cat> cats = q1.list(); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-22T15:57:42.733

在我们的代码中，我们用以下方式注释调用方法：

@SuppressWarnings("未选中")

我知道这似乎是一种 hack，但一位联合开发人员最近检查并发现这是我们所能做的。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-12-05T17:46:44.297

显然，Hibernate API 中的 Query.list() 方法“设计”不是类型安全的，并且[没有计划对其进行更改](https://forum.hibernate.org/viewtopic.php?f=9&t=948703&view=next)。

我相信避免编译器警告的最简单的解决方案确实是添加@SuppressWarnings("unchecked")。这个[注解可以放在](https://stackoverflow.com/questions/7387749/add-suppresswarningsunchecked-in-generics-to-single-line-generates-eclipse)方法级别，或者，如果在方法内部，可以放在变量声明之前。

如果您有一个封装 Query.list() 并返回 List（或 Collection）的方法，您也会收到警告。但是这个是使用@SuppressWarnings("rawtypes") 抑制的。

Matt Quail 提出的 listAndCast(Query) 方法不如 Query.list() 灵活。虽然我可以做到：

```
Query q = sess.createQuery("from Cat cat");
ArrayList cats = q.list(); 
```

如果我尝试下面的代码：

```
Query q = sess.createQuery("from Cat cat");
ArrayList<Cat> cats = MyHibernateUtils.listAndCast(q); 
```

我会得到一个编译错误：*类型不匹配：无法从 List 转换为 ArrayList*

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-13T02:55:37.613

这不是疏忽或错误。该警告反映了一个真正的潜在问题 - java 编译器无法真正确定 hibernate 类将正确地完成它的工作，并且它返回的列表将只包含 Cats。这里的任何建议都很好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-22T15:58:50.297

不，但您可以将其隔离到特定的查询方法中并使用`@SuppressWarnings("unchecked")`注释抑制警告。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-02-10T05:53:31.487

较新版本的 Hibernate 现在支持类型安全`Query<T>`对象，因此您不再需要使用`@SuppressWarnings`或实现一些技巧来消除编译器警告。在[Session API](https://docs.jboss.org/hibernate/orm/5.2/javadocs/org/hibernate/Session.html#createQuery-java.lang.String-java.lang.Class-)中，`Session.createQuery`现在将返回一个类型安全的`Query<T>`对象。你可以这样使用它：

```
Query<Cat> query = session.createQuery("FROM Cat", Cat.class);
List<Cat> cats = query.list(); 
```

您也可以在查询结果不返回 Cat 时使用它：

```
public Integer count() {
    Query<Integer> query = sessionFactory.getCurrentSession().createQuery("SELECT COUNT(id) FROM Cat", Integer.class);
    return query.getSingleResult();
} 
```

或者在进行部分选择时：

```
public List<Object[]> String getName() {
    Query<Object[]> query = sessionFactory.getCurrentSession().createQuery("SELECT id, name FROM Cat", Object[].class);
    return query.list();
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-13T02:08:02.673

我们有同样的问题。但这对我们来说没什么大不了的，因为我们必须用 Hibernate Query 和 Session 解决其他更重要的问题。

具体来说：

1.  控制何时可以提交事务。（我们想计算一个 tx 被“启动”了多少次，并且只有在 tx “结束”时才提交与它启动的次数相同的次数。对于不知道是否需要启动事务的代码很有用。现在任何需要 tx 的代码都只是“开始”一个并在完成后结束。）
2.  性能指标收集。
3.  延迟开始事务，直到知道某些事情实际上会完成。
4.  query.uniqueResult() 的行为更温和

所以对我们来说，我们有：

1.  创建一个扩展 Query 的接口 (AmplafiQuery)
2.  创建一个扩展 AmplafiQuery 并包装 org.hibernate.Query 的类 (AmplafiQueryImpl)
3.  创建一个返回 Tx 的 Txmanager。
4.  Tx 有各种 createQuery 方法并返回 AmplafiQueryImpl

最后，

AmplafiQuery 有一个“asList()”，它是 Query.list() 的通用启用版本 AmplafiQuery 有一个“unique()”，它是 Query.uniqueResult() 的通用启用版本（并且只记录问题而不是抛出例外）

为了避免@SuppressWarnings，这需要做很多工作。但是，就像我说的（并列出）还有很多其他更好的！做包装工作的理由。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-04-01T22:53:29.057

我知道这是较旧的，但截至今天，在 Matt Quails Answer 中需要注意 2 点。

# 第 1 点

这

```
List<Cat> cats = Collections.checkedList(Cat.class, q.list()); 
```

应该是这个

```
List<Cat> cats = Collections.checkedList(q.list(), Cat.class); 
```

# 第 2 点

由此

```
List list = q.list(); 
```

对此

```
List<T> list = q.list(); 
```

会明显减少原始回复标签标记中的其他警告被浏览器剥离。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2014-07-15T21:53:05.643

试试这个：

```
Query q = sess.createQuery("from Cat cat");
List<?> results = q.list();
for (Object obj : results) {
    Cat cat = (Cat) obj;
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2015-11-11T18:54:00.337

使用休眠查询避免类型安全警告的一个很好的解决方案是使用像[TorpedoQuery](http://torpedoquery.org)这样的工具来帮助您构建类型安全的 hql。

```
Cat cat = from(Cat.class);
org.torpedoquery.jpa.Query<Entity> select = select(cat);
List<Cat> cats = select.list(entityManager); 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2018-09-17T05:27:07.580

```
TypedQuery<EntityName> createQuery = entityManager.createQuery("from EntityName", EntityName.class);
List<EntityName> resultList = createQuery.getResultList(); 
```

* * *

## 回答 #15

> 赞同：-6
> 
> 时间：2008-09-22T16:34:04.643

如果您不想使用 @SuppressWarnings("unchecked") 您可以执行以下操作。

```
 Query q = sess.createQuery("from Cat cat");
   List<?> results =(List<?>) q.list();
   List<Cat> cats = new ArrayList<Cat>();
   for(Object result:results) {
       Cat cat = (Cat) result;
       cats.add(cat);
    } 
```

仅供参考 - 我创建了一个 util 方法来为我执行此操作，因此它不会乱扔我的代码，我也不必使用 @SupressWarning。

# c# - 如何在 Visual Studio 2008 中永久禁用区域折叠

> ID：115694
> 
> 赞同：109
> 
> 时间：2008-09-22T15:53:41.073
> 
> 标签：c#, visual-studio-2008, text-editor, outlining

有人知道如何在 Visual Studio 2008 中关闭代码折叠功能吗？我的一些同事喜欢它，但我个人总是希望看到所有的代码，并且从不希望代码折叠在视线之外。我想要一个意味着我的 Visual Studio 副本永远不会折叠`#regions`或函数体的设置。

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2008-09-22T15:58:01.767

# 编辑：[我推荐这个其他答案](https://stackoverflow.com/questions/115694/how-to-permanently-disable-region-folding-in-visual-studio-2008/6209270#6209270)

转到“工具”->“选项”菜单。转到文本编辑器-> C#-> 高级。取消选中“打开文件时进入大纲模式”。

这将禁用所有 c# 代码文件的所有大纲，包括区域。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2011-06-02T00:38:39.600

接受的答案会关闭所有代码折叠。如果您想禁用#region 折叠但折叠注释、循环、方法等，我编写了一个插件来为您执行此操作。

**让#regions 吸得更少（免费）：**

[http://visualstudiogallery.msdn.microsoft.com/0ca60d35-1e02-43b7-bf59-ac7deb9afbca](http://visualstudiogallery.msdn.microsoft.com/0ca60d35-1e02-43b7-bf59-ac7deb9afbca)

*   打开文件时自动扩展区域
*   可选地防止区域被折叠（但仍然能够折叠其他代码）
*   给#region / #end 区域线一个更小、更亮的背景，这样它们就不那么明显了（也是一个选项）
*   在 C# 和 VB 中工作（但仅在 VS 2010/2012 中，2008 不支持）

![区域工具截图](https://i.stack.imgur.com/nPFCK.png)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-09-16T16:37:52.607

您还可以在生成的代码上禁用区域包装（例如，当您使用 Visual Studio 快捷方式自动实现接口时）。

[替代文字 http://dusda.com/files/regionssuck.png](http://dusda.com/files/regionssuck.png)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-22T15:57:00.583

选项/文本编辑器/C#/高级/打开文件时进入大纲模式

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-22T15:57:01.597

它不是永久性的，但击键 Ctrl-M Ctrl-L 扩展文件中的区域

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-22T16:00:25.177

此外，切换所有区域的展开/折叠的快速方法是：CTRL + M + L

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-11-26T20:58:00.737

我已经在一个相关但不重复的线程中发布了一个答案，这可能会帮助这里的一些人。我详细介绍了如何通过注释掉#region 和#endregion 指令来创建将停用单个单元的#regions 的宏，以及重新激活它们的同伴。停用#regions 后，Ctrl+M+O / Collapse to Definitions 功能完全符合我的要求。我希望这对我以外的人有用。

[折叠到除区域以外的定义的快捷方式](https://stackoverflow.com/questions/225413/shortcut-to-collapse-to-definitions-except-regions/1805597#1805597)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-02-18T18:28:34.020

此选项似乎仅在 C# 中可用，而在 C/C++ (Visual Studio 2005) 中不可用。要禁用 C/C++ 文件中的大纲，您需要通过将大纲颜色更改为编辑器的背景颜色来制作技巧。为此，请转到工具 > 选项 > 环境 > 字体和颜色 > 可折叠文本 > 将“项目前景”颜色更改为白色（或任何背景颜色）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-06-05T15:20:08.920

我通过环境事件为我解决了这个问题：

1.  启动宏编辑器 (alt+f11)
2.  打开宏项目/EnvironmentEvents
3.  粘贴以下代码：

```
 Private Sub DocumentEvents_DocumentOpened(ByVal Document As EnvDTE.Document) Handles DocumentEvents.DocumentOpened
        If (Not Document Is Nothing) Then
            If (Document.FullName.ToLower().EndsWith(".cs")) Then
                Try
                    DTE.ExecuteCommand("Edit.ExpandAllOutlining")
                Catch ex As Exception
                End Try
            End If
        End If
    End Sub

    Private Sub WindowEvents_WindowActivated(ByVal GotFocus As EnvDTE.Window, ByVal LostFocus As EnvDTE.Window) Handles WindowEvents.WindowActivated
        If (Not GotFocus Is Nothing) Then
            If (Not GotFocus.Document Is Nothing) Then
                If (GotFocus.Document.FullName.ToLower().EndsWith(".cs")) Then
                    Try
                        DTE.ExecuteCommand("Edit.ExpandAllOutlining")
                    Catch ex As Exception
                    End Try
                End If
            End If
        End If
    End Sub 
```

问候托比

# silverlight - 混淆 Silverlight XAP

> ID：115701
> 
> 赞同：3
> 
> 时间：2008-09-22T15:55:32.223
> 
> 标签：silverlight, obfuscation

我想知道隐藏我们 Silverlight 代码的任何有效方法。我知道有一些混淆器可用，但看起来人们也可以破解它。有人在这方面取得了成功吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T18:04:00.947

您真的无法隐藏任何传输给客户端的内容。如果人们想弄清楚，他们会的。

您需要将任何专有代码放在客户端机器无法访问的后端。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T20:36:56.743

托管 silverlight 应用程序的页面上的 Pragma No-Cache 将阻止浏览器缓存 xap，而是通过从 Web 服务器流式传输来读取它。这将使窥视者更难获得 xap。混淆会使事情变得更加困难。

还要确保应用程序托管在 https 中，在主应用程序之外进行身份验证。这样，xap 流在下行过程中被编码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T16:03:44.513

不可以。客户端浏览器必须能够读取代码，因此它是可破解的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-16T08:31:04.207

这是一篇关于如何混淆 xap 文件的简短文章

[http://www.rudigrobler.net/Blog/obfuscating-silverlight](http://www.rudigrobler.net/Blog/obfuscating-silverlight)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-11T14:13:41.370

您可以通过在执行期间下载应用程序的混淆片段（例如使用 MEF）来使潜在黑客的工作复杂化。不用说，如果您的应用程序足够大，这样可以加快启动时间而不是妨碍用户体验，这很有趣。

它不会阻止勇敢的黑客获取您的代码（目前没有任何方法可以阻止这一点，因为 Silverlight 插件必须能够执行它），但是这种技巧会使他的任务变得非常复杂。

阻止浏览器缓存 XAP 是没有用的，就像使用 HTTPS 一样，因为攻击者使用像 firebug 这样复杂的东西来获取 XAP 比在浏览器缓存中查找它或使用中间人攻击要容易得多。

我想如果你有很多动力，你可以：

*   混淆每个程序集
*   使用动态加载的 XAP
*   使用由 web 服务发送的动态生成的密钥加密动态加载的 XAP 服务器端并在客户端解密它（不在同一个请求中。并且不要重用密钥。）

它不会阻止攻击者获取您的代码，但他必须分析您的初始（混淆）xap 以了解解密代码，获取密钥，获取加密（也混淆）动态加载的 XAP，解密它，然后管理去混淆它，然后了解它是如何将自己插入应用程序的。它与使用 HTTPS 不同，因为这里的加密和解密过程是在应用程序中完成的，因此像 firebug 或 fiddler 这样的工具变得毫无用处。

下摆。没有什么可以阻止任何人阅读您的代码。但是你可以让它不值得他花时间。您不必在这里使用所有想法，我相信您可以找到其他想法，但请确保实施这些措施也值得您花时间。

无论哪种方式，写这个都很有趣：p

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-11T11:23:24.400

你不能隐藏（至少不是不重要的）XAP 文件。但是你可以混淆它们。混淆不是一个明确的答案，但它是一个开始并且可以提供很好的保护。

# c++ - 将 C++ 模板函数定义存储在 .CPP 文件中

> ID：115703
> 
> 赞同：643
> 
> 时间：2008-09-22T15:55:52.830
> 
> 标签：c++, templates

我有一些模板代码，我希望将其存储在 CPP 文件中，而不是内联在标题中。我知道只要您知道将使用哪些模板类型就可以做到这一点。例如：

**.h 文件**

```
class foo
{
public:
    template <typename T>
    void do(const T& t);
}; 
```

**.cpp 文件**

```
template <typename T>
void foo::do(const T& t)
{
    // Do something with t
}

template void foo::do<int>(const int&);
template void foo::do<std::string>(const std::string&); 
```

请注意最后两行 - foo::do 模板函数仅与 ints 和 std::strings 一起使用，因此这些定义意味着应用程序将链接。

我的问题是 - 这是一个讨厌的 hack 还是可以与其他编译器/链接器一起使用？我目前仅将此代码与 VS2008 一起使用，但希望移植到其他环境。

* * *

## 回答 #1

> 赞同：285
> 
> 时间：2008-09-22T16:00:44.317

您描述的问题可以通过在标题中定义模板或通过您上面描述的方法来解决。

[我建议阅读C++ FAQ Lite](https://isocpp.org/wiki/faq/templates)中的以下几点：

*   [为什么我不能将模板类的定义与其声明分开并将其放在 .cpp 文件中？](https://isocpp.org/wiki/faq/templates#templates-defn-vs-decl)
*   [如何避免模板函数出现链接器错误？](https://isocpp.org/wiki/faq/templates#separate-template-fn-defn-from-decl)
*   [C++ 关键字导出如何帮助解决模板链接器错误？](https://isocpp.org/wiki/faq/templates#separate-template-fn-defn-from-decl-export-keyword)

他们详细介绍了这些（和其他）模板问题。

* * *

## 回答 #2

> 赞同：157
> 
> 时间：2012-12-19T12:21:45.693

对于此页面上的其他人想知道显式模板专业化（或至少在 VS2008 中）的正确语法是什么（就像我一样），它的以下...

在您的 .h 文件中...

```
template<typename T>
class foo
{
public:
    void bar(const T &t);
}; 
```

在你的 .cpp 文件中

```
template <class T>
void foo<T>::bar(const T &t)
{ }

// Explicit template instantiation
template class foo<int>; 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-09-22T16:15:32.190

这段代码格式正确。您只需要注意模板的定义在实例化时是可见的。引用标准，§ 14.7.2.4：

> 类模板的非导出函数模板、非导出成员函数模板或非导出成员函数或静态数据成员的定义应存在于显式实例化它的每个翻译单元中。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2016-12-22T22:48:07.130

您的示例是正确的，但不是很便携。还有一种更简洁的语法可以使用（正如@namespace-sid 等指出的那样）。

但是，假设模板类是某个要共享的库的一部分......

是否应该编译其他版本的模板类？

库维护者是否应该预测类的所有可能的模板化使用？

# 另一种方法

添加第三个文件，即源代码中的模板实现/实例化文件。

**`lib/foo.hpp`** *在/从图书馆*

```
#pragma once

template <typename T>
class foo
{
public:
    void bar(const T&);
}; 
```

**`lib/foo.cpp`** *直接编译这个文件只会浪费编译时间*

```
// Include guard here, just in case
#pragma once

#include "foo.hpp"

template <typename T>
void foo::bar(const T& arg)
{
    // Do something with `arg`
} 
```

**`foo.MyType.cpp`** *使用库，显式模板实例化`foo<MyType>`*

```
// Consider adding "anti-guard" to make sure it's not included in other translation units
#if __INCLUDE_LEVEL__
  #error "Don't include this file"
#endif

// Yes, we include the .cpp file
#include <lib/foo.cpp>
#include "MyType.hpp"

template class foo<MyType>; 
```

当然，您可以在第三个文件中有多个实现。或者，您可能需要多个实现文件，例如，您想要使用的每种类型（或一组类型）都有一个。

这种设置应该会减少编译时间，尤其是对于大量使用的复杂模板代码，因为您不会在每个翻译单元中重新编译相同的头文件。它还可以通过编译器和构建脚本更好地检测哪些代码需要重新编译，从而减少增量构建负担。

## 使用示例

**`foo.MyType.hpp`** *需要知道`foo<MyType>`的公共接口而不是`.cpp`来源*

```
#pragma once

#include <lib/foo.hpp>
#include "MyType.hpp"

// Declare `temp`. Doesn't need to include `foo.cpp`
extern foo<MyType> temp; 
```

**`examples.cpp`** *可以引用本地声明但也不会重新编译`foo<MyType>`*

```
#include "foo.MyType.hpp"

MyType instance;

// Define `temp`. Doesn't need to include `foo.cpp`
foo<MyType> temp;

void example_1() {
    // Use `temp`
    temp.bar(instance);
}

void example_2() {
    // Function local instance
    foo<MyType> temp2;

    // Use templated library function
    temp2.bar(instance);
} 
```

**`error.cpp`** *可以使用纯标题模板但不在这里的示例*

```
#include <lib/foo.hpp>

// Causes compilation errors at link time since we never had the explicit instantiation:
// template class foo<int>;
// GCC linker gives an error: "undefined reference to `foo<int>::bar()'"
foo<int> nonExplicitlyInstantiatedTemplate;
void linkerError()
{
    nonExplicitlyInstantiatedTemplate.bar();
} 
```

请注意，大多数编译器/linter/代码助手不会将此检测为错误，因为根据 C++ 标准没有错误。但是，当您将此翻译单元链接到完整的可执行文件时，链接器将找不到已定义的`foo<int>`.

* * *

如果没记错的话，我最初是从 SO 那里得到这个想法的。但是当我写下这个答案时，我一辈子都找不到原来的 SOA。今天，我想我找到了：[https ://stackoverflow.com/a/495056/4612476](https://stackoverflow.com/a/495056/4612476)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-09-22T16:01:49.930

这应该可以在支持模板的任何地方正常工作。显式模板实例化是 C++ 标准的一部分。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2018-08-21T18:01:43.527

这是定义模板函数的标准方法。我认为我阅读了三种定义模板的方法。或者可能是 4。每个都有优点和缺点。

1.  在类定义中定义。我根本不喜欢这样，因为我认为类定义仅供参考，应该易于阅读。然而，在类中定义模板比在外面定义模板要简单得多。并不是所有的模板声明都处于相同的复杂程度。此方法还使模板成为真正的模板。

2.  在同一个标​​题中定义模板，但在类之外。这是我大多数时候首选的方式。它使您的类定义保持整洁，模板仍然是真正的模板。然而，它需要完整的模板命名，这可能很棘手。此外，您的代码可供所有人使用。但是，如果您需要内联代码，这是唯一的方法。您还可以通过在类定义的末尾创建一个 .INL 文件来完成此操作。

3.  将 header.h 和 implementation.CPP 包含到您的 main.CPP 中。我认为这就是它的完成方式。您不必准备任何预实例化，它的行为就像一个真正的模板。我的问题是它不自然。我们通常不包含并期望包含源文件。我猜由于您包含了源文件，因此可以内联模板函数。

4.  最后一种方法，也就是发布的方法，是在源文件中定义模板，就像第 3 条一样；但是我们不包含源文件，而是将模板预实例化为我们需要的模板。我对这种方法没有任何问题，有时它会派上用场。我们有一个大代码，它不能从内联中受益，所以只需将它放在 CPP 文件中。如果我们知道常见的实例化并且我们可以预定义它们。这使我们免于将基本相同的东西写 5 次、10 次。这种方法的好处是保持我们的代码专有。但我不建议在 CPP 文件中放置微小的、经常使用的函数。因为这会降低库的性能。

请注意，我不知道 obj 文件臃肿的后果。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-11-06T21:44:49.250

这绝对不是一个讨厌的 hack，但请注意，对于要与给定模板一起使用的每个类/类型，您都必须这样做（显式模板专业化）。如果有许多类型请求模板实例化，您的 .cpp 文件中可能会有很多行。为了解决这个问题，您可以在您使用的每个项目中拥有一个 TemplateClassInst.cpp，这样您就可以更好地控制要实例化的类型。显然，这个解决方案不会是完美的（又名银弹），因为您最终可能会破坏 ODR :)。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2019-06-28T04:47:29.573

举个例子，假设出于某种原因你想要一个模板类：

```
//test_template.h:
#pragma once
#include <cstdio>

template <class T>
class DemoT
{
public:
    void test()
    {
        printf("ok\n");
    }
};

template <>
void DemoT<int>::test()
{
    printf("int test (int)\n");
}

template <>
void DemoT<bool>::test()
{
    printf("int test (bool)\n");
} 
```

如果您使用 Visual Studio 编译此代码 - 它可以开箱即用。gcc 将产生链接器错误（如果从多个 .cpp 文件中使用相同的头文件）：

```
error : multiple definition of `DemoT<int>::test()'; your.o: .../test_template.h:16: first defined here 
```

可以将实现移动到 .cpp 文件，但是您需要像这样声明类 -

```
//test_template.h:
#pragma once
#include <cstdio>

template <class T>
class DemoT
{
public:
    void test()
    {
        printf("ok\n");
    }
};

template <>
void DemoT<int>::test();

template <>
void DemoT<bool>::test();

// Instantiate parametrized template classes, implementation resides on .cpp side.
template class DemoT<bool>;
template class DemoT<int>; 
```

然后 .cpp 将如下所示：

```
//test_template.cpp:
#include "test_template.h"

template <>
void DemoT<int>::test()
{
    printf("int test (int)\n");
}

template <>
void DemoT<bool>::test()
{
    printf("int test (bool)\n");
} 
```

头文件中没有最后两行 - gcc 可以正常工作，但 Visual Studio 会产生错误：

```
 error LNK2019: unresolved external symbol "public: void __cdecl DemoT<int>::test(void)" (?test@?$DemoT@H@@QEAAXXZ) referenced in function 
```

如果您想通过 .dll 导出公开函数，模板类语法是可选的，但这仅适用于 Windows 平台 - 因此 test_template.h 可能如下所示：

```
//test_template.h:
#pragma once
#include <cstdio>

template <class T>
class DemoT
{
public:
    void test()
    {
        printf("ok\n");
    }
};

#ifdef _WIN32
    #define DLL_EXPORT __declspec(dllexport) 
#else
    #define DLL_EXPORT
#endif

template <>
void DLL_EXPORT DemoT<int>::test();

template <>
void DLL_EXPORT DemoT<bool>::test(); 
```

使用上一个示例中的 .cpp 文件。

然而，这让链接器更加头疼，因此如果您不导出 .dll 函数，建议使用前面的示例。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-22T16:07:57.357

在最新的标准中，有一个关键字 ( `export`) 可以帮助缓解这个问题，但是除了 Comeau 之外，我所知道的任何编译器都没有实现它。

请参阅关于此的[FAQ-lite](http://www.parashift.com/c++-faq-lite/templates.html#faq-35.14)。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2020-05-13T19:57:18.547

以上都不适合我，所以这就是你解决它的方法，我的班级只有一个模板化的方法..

。H

```
class Model
{
    template <class T>
    void build(T* b, uint32_t number);
}; 
```

.cpp

```
#include "Model.h"
template <class T>
void Model::build(T* b, uint32_t number)
{
    //implementation
}

void TemporaryFunction()
{
    Model m;
    m.build<B1>(new B1(),1);
    m.build<B2>(new B2(), 1);
    m.build<B3>(new B3(), 1);
} 
```

这避免了链接器错误，并且根本不需要调用 TemporaryFunction

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-22T16:00:16.907

是的，这是进行~~专业化~~显式实例化的标准方法。正如你所说，你不能用其他类型实例化这个模板。

编辑：根据评论更正。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-03-22T01:48:26.440

是时候更新了！创建一个内联（.inl 或任何其他）文件，然后简单地将所有定义复制到其中。请务必在每个函数 ( `template <typename T, ...>`) 上方添加模板。现在，您不将头文件包含在内联文件中，而是执行相反的操作。在您的类 ( ) 声明**之后**包含内联文件`#include "file.inl"`。

我真的不知道为什么没有人提到这一点。我认为没有直接的缺点。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-27T15:13:07.860

您给出的示例没有任何问题。但我必须说我认为将函数定义存储在 cpp 文件中效率不高。我只理解需要将函数的声明和定义分开。

当与显式类实例化一起使用时，Boost 概念检查库 (BCCL) 可以帮助您在 cpp 文件中生成模板函数代码。

# internet-explorer-7 - 为什么 IE7 指定一个 mime 类型的 image/pjpeg 而不仅仅是 image/jpeg？

> ID：115705
> 
> 赞同：54
> 
> 时间：2008-09-22T15:56:18.430
> 
> 标签：internet-explorer-7, file-upload, jpeg

通过 IE7 中的表单上传文件 (jpeg) 时，我看到的是 mime 类型的“image/pjpeg”而不是“image/jpeg”（正如我在 Firefox 或类似中看到的那样）。解决这个问题很容易，但我只是想知道为什么 IE7 在这种情况下表现不同？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-22T15:59:57.283

我相信这是因为您使用的 JPEG 是渐进式 JPEG，它具有不同的 mime 类型。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-22T16:52:50.900

IE 可以将所有 .jpeg 文件作为其 hack MIME 类型“image/pjpeg”上传，无论它们是否实际上是渐进式的。

不要依赖文件上传中提供的 MIME 类型，因为包括这个在内的各种原因，它很有可能是错误的。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-04-01T14:14:53.290

因为微软喜欢违反标准。没有像 image/pjpeg 这样的 MIME 类型。自己看看： [http ://www.iana.org/assignments/media-types/media-types.xhtml#image](http://www.iana.org/assignments/media-types/media-types.xhtml#image)

JPEG 的正确 MIME 类型是 image/jpeg、渐进式或非渐进式。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-02-03T11:20:12.547

png也有同样的问题：

IE7：image/x-png 普通浏览器：image/png

;)

# http - 有没有办法清除我的页面的用户浏览器，或者说不使用缓存？

> ID：115720
> 
> 赞同：4
> 
> 时间：2008-09-22T15:58:52.527
> 
> 标签：http, asp-classic

经典 ASP 中是否有一个命令可以用来告诉浏览器不要从它的缓存中拉取页面，或者不缓存，或者清除我的页面的缓存？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-22T16:03:09.333

您可以使用 HTML 元标记：

```
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="Fri, 01 Jan 1999 1:00:00 GMT" />
<meta http-equiv="Last-Modified" content="0" />
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" /> 
```

或者您可以使用 ASP 响应标头：

```
<% 
   Response.CacheControl = "no-cache"
   Response.AddHeader "Pragma", "no-cache"
   Response.Expires = -1
%> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T16:02:16.747

与 asp 无关，这是一个 HTTP 问题。您可以通过修改 http 缓存的某些方面来做到这一点，例如 Cache-Control、etag、Expires 等。阅读[RFC2616](http://www.w3.org/Protocols/rfc2616/rfc2616.html)尤其是[HTTP 中的缓存](http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html)并设置适当的标头。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T16:31:45.147

忽略每个告诉您使用`<meta>`元素或`Pragma`. 他们非常不可靠。您需要设置适当的 HTTP 标头。[此处](http://www.mnot.net/cache_docs/)提供了有关如何确定适合您的 HTTP 标头的一个很好的教程。 `Cache-Control: no-cache`可能是您所需要的，但请阅读本教程，因为有许多特定于项目的原因可能会导致您想要不同的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T16:00:32.820

如果你把

```
Response.Expires = -1 
```

在您的经典 ASP 页面中，它将指示浏览器不要缓存内容。如果用户单击“返回”或以其他方式导航到页面，浏览器将从服务器刷新页面。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-23T06:27:42.517

可以通过确保根据需要为 Reponse.cachecontrol、response.expires 等设置正确的值来完成。此链接可能有助于理解它们的含义。[http://aspjavascript.com/lesson07.asp](http://aspjavascript.com/lesson07.asp)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-22T16:19:12.680

由于不同浏览器处理缓存的方式，需要使用 Expires 和 no-cache 命令。这是一篇[文章](http://aspalliance.com/articleViewer.aspx?aId=694&pId=-1)，显示了执行此操作的正确方法。

# python - 在 jython 中提供/使用 Web 服务的最简单方法是什么？

> ID：115744
> 
> 赞同：5
> 
> 时间：2008-09-22T16:01:52.193
> 
> 标签：python, web-services, soap, wsdl, jython

我有一个需要提供/使用 Web 服务的 Tomcat 应用程序。由于与 Python 中的可能相比，Java Web 服务是一场噩梦（xml、代码生成等），因此我想从您使用 jython 而不是 java 来提供/使用 Web 服务的经验中学习。

到目前为止，我所做的涉及使[http://pywebsvcs.sourceforge.net/](http://pywebsvcs.sourceforge.net/)适应[Jython](http://www.jython.org)。我仍然收到错误（命名空间、类型等），尽管其中一些对于最简单的服务是成功的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T12:23:43.707

我已经汇总了有关如何使用轴在 jython 中使用 Web 服务的更多详细信息。在此处阅读：[如何使用 Jython 和 Axis 编写 Web 服务脚本](http://www.fishandcross.com/blog/?p=503)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T16:46:13.880

[PyServlet](http://www.jython.org/docs/api/org/python/util/PyServlet.html)可帮助您配置 Tomcat 以从 URL 提供 Jython 脚本。您可以使用这是一种“类似 REST”的方式来执行一些基本的 Web 服务，而无需付出太多努力。[（这里](http://www.informit.com/articles/article.aspx?p=26865&seqNum=6)也有描述。）

我们使用了一个类似的自制框架，非常成功地在一个大型的多个 Web 应用程序中提供了各种数据服务。

# python - 哪个更pythonic，工厂作为模块中的函数，还是作为它创建的类的方法？

> ID：115764
> 
> 赞同：3
> 
> 时间：2008-09-22T16:03:41.750
> 
> 标签：python, factory

我有一些 Python 代码基于从 iCalendar 文件解析的 VEvent 对象创建日历对象。

日历对象只有一个方法，可以在解析事件时添加事件。

现在我想创建一个工厂函数，从文件对象、路径或 URL 创建日历。

我一直在使用[iCalendar python 模块](http://codespeak.net/icalendar/)，它直接在返回实例的 Class 上实现工厂函数作为类方法：

```
cal = icalendar.Calendar.from_string(data) 
```

根据我对 Java 的了解，这是 Java 代码中的一种常见模式，尽管我似乎发现更多对工厂方法的引用位于与您实际要从中实例化实例的类不同的类上。

问题是，这也被认为是 Pythonic 吗？还是仅仅创建一个模块级方法作为工厂函数是否被认为更pythonic？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-22T16:20:38.577

[**注**。在将“日历”一系列事件和“事件”（日历上的单个事件）分开时要非常谨慎。在您的问题中，似乎可能存在一些混乱。]

工厂设计模式有很多变体。

1.  一个独立的便利函数（例如，calendarMaker(data)）

2.  一个单独的类（例如，CalendarParser），它构建您的目标类（日历）。

3.  一个类级别的方法（例如 Calendar.from_string）方法。

这些有不同的目的。都是 Pythonic，问题是“你是什么*意思*？” 和“可能会发生什么变化？” 意义就是一切；改变很重要。

便利函数是 Pythonic 的。像 Java 这样的语言不能有自由浮动的函数；你必须在一个类中包装一个孤独的函数。Python 允许你在没有类开销的情况下拥有一个单独的函数。当您的构造函数没有状态更改或替代策略或任何先前操作的记忆时，函数是相关的。

有时人们会定义一个类，然后提供一个方便的函数来创建该类的实例，设置状态和策略的常用参数以及任何其他配置，然后调用该类的单个相关方法。这为您提供了类的状态以及独立函数的灵活性。

使用了类级别的方法模式，但它有局限性。一，它被迫依赖于类级别的变量。由于这些可能会令人困惑，当您需要添加功能（如状态或替代策略）时，作为静态方法的复杂构造函数会遇到问题。请确保您永远不会扩展静态方法。

第二，它与其他类方法和属性或多或少无关。这种`from_string`只是您的日历对象的许多替代编码之一。您可能有一个`from_xml`, `from_JSON`,`from_YAML`和 on 和 on 。这些都与日历是什么或它的作用无关。这些方法都是关于如何对日历进行编码以进行传输。

您将在成熟的 Python 库中看到工厂与它们创建的东西是分开的。编码（如字符串、XML、JSON、YAML）受制于大量或多或少的随机变化。然而，基本的东西很少改变。

将两个关注点分开。尽可能让编码和表示远离状态和行为。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-22T16:05:25.537

不考虑您在某处阅读的某些模式中的深奥差异，现在想在任何地方使用，例如工厂模式，这是pythonic。

大多数时候你会认为@staticmethod 是一种解决方案，使用模块函数可能会更好，除非你在一个模块中填充多个类并且每个类都有相同接口的不同实现，那么最好使用@静态方法

最终，通过@staticmethod 或模块函数创建实例几乎没有什么区别。

我可能会使用类的初始化程序（ __init__ ），因为 python 中更被接受的“模式”之一是类的工厂是类初始化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T16:11:52.793

恕我直言，模块级方法是一种更清洁的解决方案。它隐藏在 Python 模块系统后面，为它提供了一个独特的命名空间前缀，这是“工厂模式”常用的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T16:09:45.123

工厂模式有自己的[长处和短处](http://en.wikipedia.org/wiki/Factory_method_pattern)。但是，选择一种创建实例的方法通常对您的代码几乎没有实际影响。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T16:30:48.503

静态方法很少有价值，但类方法可能有用。这取决于您希望类和工厂函数实际执行的操作。

模块中的工厂函数将始终创建“正确”类型的实例（在您的情况下，“正确”始终是“日历”类，但您也可以使其依赖于创建实例的内容在......之外。）

如果您希望类方法不依赖于数据，而是依赖于您调用它的类，请使用类方法。类方法类似于静态方法，您可以在没有实例的情况下在类上调用它，但它接收调用它的类作为第一个参数。这允许您实际创建*该类的实例，该*实例可能是原始类的子类。classmethod 的一个示例是 dict.fromkeys()，它从键列表和单个值（默认为 None）创建一个 dict。因为它是一个 classmethod，当您将 dict 子类化时，您将完全免费获得“fromkeys”方法. 这是一个如何自己编写 dict.fromkeys() 的示例：

```
class dict_with_fromkeys(dict):
    @classmethod
    def fromkeys(cls, keys, value=None):
        self = cls()
        for key in keys:
            self[key] = value
        return self 
```

# java - 更高级的表格/电子表格 SWT 实现

> ID：115766
> 
> 赞同：15
> 
> 时间：2008-09-22T16:04:23.030
> 
> 标签：java, eclipse, swt, spreadsheet

我正在开发一个基于 Eclipse 富客户端平台的应用程序，该平台严重依赖于使用表格来显示和编辑数据。我目前正在使用 Table 和 TableViewer 的 SWT 实现。

我的用户总是抱怨它“不像在 excel 中那样工作”。最值得注意的是，我无法选择一行中的单个单元格，并且所有行都具有相同的高度。我正在寻找解决这些问题的实现。

标准：

*   免费（如演讲*和*啤酒——我是博士生，课程是 EPL）
*   SWT（在 SWT 中包含 swing 的各种解决方案都不是很好）

**编辑：**

到目前为止，我有以下建议：

*   [表](http://sourceforge.net/projects/ktable)
*   [星云网格小部件](http://www.eclipse.org/nebula/widgets/grid/grid.php)
*   [表格](http://sourceforge.net/projects/nattable/)
*   [敏捷网格](http://sourceforge.net/projects/agilegrid)
*   [贾雷特表](http://jaret.de/jarettable/index.html)

不幸的是，粗略的一瞥并没有提供有关这些实现之间差异的信息。我当然会寻找解决方案并在这里报告，但是您对这个主题有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T20:02:44.033

其他 3 人

[表格](http://sourceforge.net/projects/nattable/)

[敏捷网格](http://sourceforge.net/projects/agilegrid)

[贾雷特表](http://jaret.de/jarettable/index.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T16:09:46.200

查看[Nebula Grid](http://www.eclipse.org/nebula/widgets/grid/grid.php)组件。它仍在开发中，因此不是 100% 成熟，但似乎可以满足您的需求。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-09-17T12:40:33.260

我认为[SWT Matrix](http://swt-matrix.netanel.pl)具有您正在寻找的功能。

它具有对称设计，因此行和列具有相同的表示形式，这意味着它们都可以像在 excel 中一样被选择、移动、隐藏、调整大小等。单元格导航和选择也类似于 Excel。并且所有键和鼠标手势都绑定到与spreadshit 中相同的动作。

该组件是封闭源代码，但可免费用于私人和非商业用途。不过，此时仍处于 alpha 阶段。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T18:21:07.773

如前所述，我一直在工作项目中使用[Nebula Grid组件，总的来说，我不得不说我认为它工作得很好。](http://www.eclipse.org/nebula/widgets/grid/grid.php)有一些性能问题，它还没有完全完成，但它很容易弯曲成你需要的任何形状，并且在电子表格样式的数据表方面做得很好。您可以拥有列和行标题、列组、自定义单元格渲染器等。

我最近遇到的问题是要正确计算行高，而且目前似乎没有太多积极的开发，所以我会尝试自己修复它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T18:08:48.283

[KTable](http://sourceforge.net/projects/ktable)成熟且可定制。我用它为我的 SWT 应用程序提供了非常类似于 Excel 的体验。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T16:22:21.193

NatTable 倾向于提供高性能和大容量的能力

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-03-21T19:35:18.317

[NatTable](http://eclipse.org/nattable/)免费、快速且功能强大。

自从第一次提出这个问题以来，它已经成为 Eclipse Nebula 项目的一部分。发展依然活跃。

API 很大。大量示例提供了简单的示例代码以供入门。

一些不错的功能：

*   可以处理庞大的数据集而不会出现性能问题
*   行标题
*   跨越单元格
*   树形表
*   单元格编辑器：文本、组合、复选框
*   复制、导出到 Excel 和打印的标准操作。
*   无效值的验证和视觉指示
*   多单元格编辑
*   单元格装饰器
*   保持列大小、顺序、隐藏、排序等状态。

运行示例以查看速度和功率。请注意，您必须将 SWT 插件添加到您的类路径中。示例不包括它。这是一个例子：

> C:> java -cp C:\eclipse\plugins\org.eclipse.swt.win32.win32.x86_ *VERSION* .jar;NatTableExamples-0.9.0.jar org.eclipse.nebula.widgets.nattable.examples.NatTableExamples

[感谢前几年的海报提到 NatTable。这个答案提供了更新和更多信息。]

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T11:06:00.867

KTable 类似于 JTable。

Nebula Grid 非常适合 Widget + Viewer 范例。我能够在几分钟内从普通的 SWT 表迁移到这个表。

# eclipse - 在 Eclipse 中，为什么“自动构建”会被神秘地禁用？

> ID：115770
> 
> 赞同：6
> 
> 时间：2008-09-22T16:04:31.063
> 
> 标签：eclipse

我正在运行 Eclipse Europa (3.3)。我一直在“项目”菜单下的“自动构建”设置。有时我的代码没有编译，我对它感到困惑，然后拉下项目菜单......你瞧，它不再设置了。是什么赋予了？这是一个错误，还是我正在做的其他事情可能导致它？

编辑：我正在运行常规的 Java 开发人员安装，加上 Subversive 及其连接器 Jetty Launcher，我相信没有其他插件。我工作场所的其他人也有同样的问题。

编辑：我仍然遇到这个问题，只是现在我正在使用适用于 Windows 的 Eclipse Galileo (3.5)。我在 OS X 的 Galileo 中没有遇到过这个问题，在 Cocoa 和 Carbon 中都没有，但我已经很久没有使用过这个问题了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2016-02-08T20:50:54.570

对于 Eclipise Mars.1 (4.5.1)，Oomph 可能是罪魁祸首。Eclipse Oomph 支持自动禁用 Build Automatically 与条目

在 Windows %USERPROFILE%\.eclipse\org.eclipse.oomph.setup\setups\user.setup

如果您想禁用此 Oomph 行为，请尝试删除以下设置

“Eclipse->Navigate Menu->Open Setup menu entry-> Open User menu entry”，“User Preferences -> org.eclipse.core.resources -> description.autobuilding”下的一个Preference Task

我于 2016 年 2 月 8 日在 Oomph Eclipse 社区论坛上发帖了解了此设置。我发布了一个题为“Oomph Defect？Build Automatically Keeps Getting Disabled”的问题。Ed Marks 在同一天回复了有关 Oomph 对管理 Eclipse“自动构建”设置的支持的详细信息。 [https://www.eclipse.org/forums/index.php/m/1722751/#msg_1722751](https://www.eclipse.org/forums/index.php/m/1722751/#msg_1722751)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T15:04:57.890

我这里没有日食来测试和确保，但这是一个想法。

SVN 中是否有任何项目甚至工作区文件？如果它们是并且它们是在禁用自动构建的情况下上传的，这可能会解释它

您更新并覆盖您的设置。在您重新启动 Eclipse 之前，这不会变得明显。这也可以解释为什么您工作场所的其他人会遇到这种情况。它甚至可以解释为什么有些人不这样做：他们是那些小心他们更新的内容并且不允许 eclipse 覆盖他们自己的设置的人，以及那些实际上更喜欢禁用自动构建的人:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-08T16:28:08.193

我遇到了同样的问题，当我查看 Java Build Path 下的 Source 选项卡（在菜单 Project > Properties 下）时，有些源目录不再存在（用红色 X 标记）。删除它们后，编译工作正常，所有新的 .class 文件都在 bin 文件夹下。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T19:40:41.980

奇怪的。是否安装了一个插件，在您不知情的情况下将其关闭？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T11:04:47.093

也许有一些冲突的捷径。例如，某些重复的快捷方式可能会切换它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-02T22:51:14.607

我正在运行 3.4，我也有这种神秘的行为。我在 3.3 中也有它。我使用 CVS 而不是 SVN。似乎不遵循一种模式，它偶尔会被关闭，然后发生奇怪的令人困惑的事情，直到我记得检查它并重新打开它。我几乎到了要编写一个插件以在eclipse加载时始终打开它的地步。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-21T10:37:10.300

安装 Google Plugin for Eclipse 时，还会安装“Google App Engine for Android”。

对我来说，我卸载了我不需要的“Google App Engine for Android”，并解决了这个问题。

# python - 如何使用 CherryPy 配置 IP 地址？

> ID：115773
> 
> 赞同：19
> 
> 时间：2008-09-22T16:04:54.290
> 
> 标签：python, cherrypy

我正在使用 python 和 CherryPy 创建一个大约 2 人使用的简单内部网站。我使用带有 CherryPy.quickstart 的内置网络服务器，并且从不弄乱配置文件。我最近更换了机器，所以我安装了最新的 Python 和cherrypy，当我运行该站点时，我可以从 localhost:8080 访问它，但不能通过 IP 或 Windows 机器名称访问它。这可能是机器配置差异或 CherryPy 或 Python 的较新版本。有什么想法可以绑定到正确的 IP 地址吗？

编辑：为了清楚起见，我目前根本没有配置文件。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-30T06:55:25.050

```
server.socket_host: '0.0.0.0' 
```

...也可以。那是 IPv4 INADDR_ANY，意思是“监听所有接口”。

在配置文件中，语法是：

```
[global]
server.socket_host: '0.0.0.0' 
```

在代码中：

```
cherrypy.server.socket_host = '0.0.0.0' 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-22T16:16:12.190

这取决于您如何运行cherrypy init。

如果使用cherrypy 3.1语法，那将这样做：

```
cherrypy.server.socket_host = 'www.machinename.com'
cherrypy.engine.start()
cherrypy.engine.block() 
```

当然你可以有更花哨的东西，比如子类化服务器类，或者使用配置文件。这些用途包含在[文档](http://www.cherrypy.org/wiki/ServerAPI "Cherrypy 服务器 API 文档")中。

但这应该足够了。如果不只是告诉我们你在做什么和cherrypy版本，我会编辑这个答案。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-12-28T18:13:44.370

```
import cherrypy

class HelloWorld(object):
    def index(self):
        return "Hello World!"
    index.exposed = True

cherrypy.server.socket_host = '0.0.0.0' # put it here 
cherrypy.quickstart(HelloWorld()) 
```

# sql - 索引空值以在 DB2 上快速搜索

> ID：115789
> 
> 赞同：4
> 
> 时间：2008-09-22T16:07:13.023
> 
> 标签：sql, performance, indexing, null, db2

我的理解是空值在 DB2 中是不可索引的，因此假设我们有一个巨大的表 (Sales)，其中的日期列 (sold_on) 通常是一个日期，但偶尔（10% 的时间）为空。

此外，让我们假设它是一个我们无法更改的遗留应用程序，因此这些空值将保留在那里并且意味着某些东西（假设是返回的销售额）。

我们可以通过在 sold_on 和 total 列上放置索引来快速进行以下查询

```
Select * from Sales 
where 
Sales.sold_on between date1 and date2
and Sales.total = 9.99 
```

但是索引不会使这个查询更快：

```
Select * from Sales 
where 
Sales.sold_on is null
and Sales.total = 9.99 
```

因为索引是在值上完成的。

我可以索引空值吗？也许通过更改索引类型？索引指标列？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T21:45:46.450

您从哪里得到 DB2 不索引 NULL 的印象？我在支持该声明的文档或文章中找不到任何内容。我刚刚使用 IS NULL 限制在一个大表中执行了一个查询，该限制涉及一个包含一小部分 NULL 的索引列；在这种情况下，DB2 肯定使用了索引（通过 EXPLAIN 验证，并通过观察数据库立即响应而不是花时间执行表扫描）。

所以：我声称 DB2 对非主键索引中的 NULL 没有任何问题。

但正如其他人所写：您的数据可能以 DB2 认为使用索引不会更快的方式组合。或者数据库的统计信息对于所涉及的表不是最新的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T16:15:50.413

我不是 DB2 专家，但如果 10% 的值是空值，我认为仅该列上的索引不会帮助您的查询。10% 太多了，无法使用索引——它只会进行表扫描。如果您谈论的是 2-3%，我认为它实际上会使用您的索引。

想想一个页面/块上有多少条记录——比如 20 条。使用索引的原因是为了避免获取不需要的页面。给定页面包含 0 个空记录的几率是 (90%)^20，即 12%。这些可能性不大——无论如何您都需要获取 88% 的页面，使用索引并不是很有帮助。

但是，如果您的 select 子句仅包含几列（而不是 *） - 只是说 salesid，您可能会让它使用 (sold_on,salesid) 上的索引，因为数据页的读取不会需要——所有数据都在索引中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T17:04:33.680

经验法则是索引可用于高达 15% 的记录的值。...所以索引可能在这里有用。

如果 DB2 不会索引空值，那么我建议添加一个布尔字段 IsSold，并在设置了 sold_on 日期时将其设置为 true（这可以在触发器中完成）。

这不是最好的解决方案，但它可能是您需要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-17T01:53:33.270

Troels 是正确的；即使 SOLD_ON 值为 NULL 的行也会受益于该列上的索引。如果您在 SOLD_ON 上进行范围搜索，则可以通过创建以 SOLD_ON 开头的聚集索引来获得更多好处。在此特定示例中，维护基于 SOLD_ON 的集群顺序可能不需要太多额外开销，因为添加的较新行很可能具有较新的 SOLD_ON 日期。

# perl - 何时是使用反引号的正确时间（和错误时间）？

> ID：115809
> 
> 赞同：14
> 
> 时间：2008-09-22T16:12:30.390
> 
> 标签：perl

许多初级程序员编写这样的代码：

```
sub copy_file ($$) {
  my $from = shift;
  my $to = shift;

  `cp $from $to`;
} 
```

这很糟糕，为什么？应该使用反引号吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-23T03:13:54.793

一些人已经提到你应该只在以下情况下使用反引号：

*   您需要捕获（或抑制）输出。
*   不存在执行相同任务的内置函数或 Perl 模块，或者您有充分的理由不使用该模块或内置。
*   你清理你的输入。
*   您检查返回值。

不幸的是，像*正确*检查返回值这样的事情可能非常具有挑战性。是信号死了吗？它是否运行完成，但返回一个有趣的退出状态？尝试解释的标准方法`$?`非常糟糕。

我建议使用[IPC::System::Simple](http://search.cpan.org/perldoc?IPC::System::Simple)模块`capture()`和`system()`函数而不是反引号。该`capture()`函数就像反引号一样工作，除了：

*   如果命令未启动、被信号终止或返回意外退出值，它会提供详细的诊断信息。
*   如果传递了受污染的数据，它会提供详细的诊断。
*   它提供了一种简单的机制来指定可接受的退出值。
*   如果您愿意，它允许您在没有外壳的情况下调用反引号。
*   即使您使用单个参数，它也提供了避免 shell 的可靠机制。

这些命令也可以在操作系统和 Perl 版本中一致地工作，这与 Perl 的内置命令不同，`system()`后者在旧版本的 Perl（例如，5.6.0 的多个参数）上使用多个参数调用时可能不会检查受污染的数据，或者可能调用无论如何在Windows下shell。

例如，以下代码片段会将调用的结果保存`perldoc`到标量中，避免使用 shell，如果找不到页面（因为 perldoc 返回 1）抛出异常。

```
#!/usr/bin/perl -w
use strict;
use IPC::System::Simple qw(capture);

# Make sure we're called with command-line arguments.
@ARGV or die "Usage: $0 arguments\n";

my $documentation = capture('perldoc', @ARGV); 
```

[IPC::System::Simple](http://search.cpan.org/perldoc?IPC::System::Simple)是纯 Perl，可在 5.6.0 及更高版本上运行，并且没有任何 Perl 发行版通常不会附带的依赖项。（在 Windows 上，它依赖于 ActiveState 和 Strawberry Perl 附带的 Win32:: 模块）。

免责声明：我是[IPC::System::Simple](http://search.cpan.org/perldoc?IPC::System::Simple)的作者，所以我可能会表现出一些偏见。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-22T16:30:40.203

规则很简单：如果你能找到一个内置的来做同样的工作，或者如果它们是 CPAN 上的一个健壮的模块，可以为你做这件事，就不要使用反引号。反引号通常依赖于不可移植的代码，即使你不污染变量，你仍然可以打开自己的许多安全漏洞。

*切勿*对用户数据使用反引号，除非您非常严格地指定允许的内容（而不是不允许的内容 - 您会错过一些事情）！这是非常非常危险的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-22T16:13:22.213

当且仅当您需要捕获命令的输出时，才应使用反引号。否则，应该使用 system()。而且，当然，如果有一个 Perl 函数或 CPAN 模块可以完成这项工作，那么应该使用它来代替其中任何一个。

在这两种情况下，强烈建议做两件事：

首先，**清理所有输入：**如果代码暴露于可能的不受信任的输入，请使用污染模式 (-T)。即使不是，请确保处理（或防止）时髦的字符，如空格或三种引号。

其次，**检查返回码**以确保命令成功。以下是如何执行此操作的示例：

```
my $cmd = "./do_something.sh foo bar";
my $output = `$cmd`;

if ($?) {
   die "Error running [$cmd]";
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-22T16:14:29.057

如果要收集命令的输出，请使用反引号。

否则`system()`是一个更好的选择，尤其是当您不需要调用 shell 来处理元字符或命令解析时。您可以通过将列表传递给 system() 来避免这种情况，例如（但是对于该*特定*`system('cp', 'foo', 'bar')`示例，您可能会更好地使用模块:)）

 ** * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-22T17:16:01.047

另一种捕获标准输出的方法（除了 pid 和退出代码）是使用[IPC::Open3](http://search.cpan.org/%7Etty/kurila-1.13_0/lib/IPC/Open3.pm)可能否定系统和反引号的使用。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-22T16:19:32.493

在 Perl 中，总是有不止一种方法可以做任何你想做的事情。反引号的主要目的是将 shell 命令的标准输出转换为 Perl 变量。（在您的示例中， cp 命令打印的任何内容都将返回给调用者。）在您的示例中使用反引号的缺点是您不检查 shell 命令的返回值；cp 可能会失败，你不会注意到。您可以将它与特殊的 Perl 变量 $? 一起使用。当我想执行 shell 命令时，我倾向于使用**system**：

```
system("cp $from $to") == 0
    or die "Unable to copy $from to $to!"; 
```

（另请注意，这将在带有嵌入空格的文件名上失败，但我认为这不是问题的重点。）

这是一个人为的例子，说明反引号可能有用的地方：

```
my $user = `whoami`;
chomp $user;
print "Hello, $user!\n"; 
```

对于更复杂的情况，您还可以使用**open**作为管道：

```
open WHO, "who|"
    or die "who failed";
while(<WHO>) {
    # Do something with each line
}
close WHO; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-22T17:06:18.013

从“perlop”联机帮助页：

> 这并不意味着当反引号是完成某事的正确方法时，您应该竭尽全力避免反引号。Perl 被设计成一种粘合语言，它粘合在一起的东西之一就是命令。只要明白你让自己陷入什么。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-22T18:23:07.737

对于您使用[File::Copy](http://search.cpan.org/search?query=File+Copy&mode=module)模块显示的情况可能是最好的。但是，要回答您的问题，每当我需要运行系统命令时，我通常都会依赖[IPC::Run3](http://search.cpan.org/dist/IPC-Run3/)。它提供了很多功能，例如收集返回码以及标准和错误输出。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-22T20:14:01.010

无论您做什么，以及清理输入和检查代码的返回值，请确保您调用任何具有明确的完整路径的外部程序。例如说

```
my $user = `/bin/whoami`; 
```

或者

```
my $result = `/bin/cp $from $to`; 
```

如果用户的路径发生变化，只说“whoami”或“cp”可能会导致意外运行命令之外的命令——这是一个恶意攻击者可能试图利用的安全漏洞。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-22T16:14:06.657

您的示例很糟糕，因为有 perl 内置函数可以执行可移植的操作，并且通常比反引号替代方法更有效。

只有在没有 Perl 内置（或模块）替代方案时才应使用它们。这适用于反引号和 system() 调用。反引号用于捕获已执行命令的输出。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-22T16:26:02.463

反引号仅应在您想要捕获输出时使用。在这里使用它们“看起来很傻”。它会让任何查看您的代码的人知道您对 Perl 不是很熟悉。

如果要捕获输出，请使用反引号。如果要运行命令，请使用 system。您将获得的一项优势是能够检查退货状态。尽可能使用模块以实现可移植性。在这种情况下，File::Copy 符合要求。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-22T17:04:04.133

一般来说，最好使用**system**而不是反引号，因为：

1.  **系统**鼓励调用者检查命令的返回码。

2.  **系统**允许“间接对象”表示法，这更安全并增加了灵活性。

3.  反引号在文化上与 shell 脚本相关，这在代码读者中可能并不常见。

4.  反引号对可能是繁重的命令使用最少的语法。

用户可能倾向于使用反引号而不是**系统**的原因之一是对用户隐藏 STDOUT。这通过重定向 STDOUT 流更容易、更灵活地完成：

```
my $cmd = 'command > /dev/null';
system($cmd) == 0 or die "system $cmd failed: $?" 
```

此外，摆脱 STDERR 很容易实现：

```
my $cmd = 'command 2> error_file.txt > /dev/null'; 
```

在使用反引号有意义的情况下，我更喜欢使用**qx{}**以强调正在发生的重量级命令。

另一方面，拥有另一种方法确实可以提供帮助。有时您只需要查看命令打印到 STDOUT 的内容。反引号，当在 shell 脚本中使用时，正是这项工作的正确工具。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T21:03:58.457

Perl 具有分裂的人格。一方面，它是一种很棒的脚本语言，可以替代 shell 的使用。在这种一次性的 I-watching-the-结果使用中，反引号很方便。

使用编程语言时，应避免使用反引号。这是缺乏错误检查，如果可以避免执行单独的程序反引号，则效率会提高。

除了上述之外，当命令的输出没有被使用时，应该使用系统函数。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-23T18:58:04.633

反引号适用于业余爱好者。防弹解决方案是“安全管道打开”（参见“man perlipc”）。您在另一个进程中执行您的命令，这允许您首先使用 STDERR、setuid等*进行*futz . 您可以重定向 STDERR 并更改用户权限，而无需更改主程序的行为。这比反引号更冗长，但是您可以将其包装在自己的函数中，例如 run_cmd($cmd,@args);

```
 sub run_cmd {
  my $cmd = shift @_;
  my @args = @_;

  my $fh; # file handle
  my $pid = open($fh, '-|');
  defined($pid) or die "Could not fork";
  if ($pid == 0) {
    open STDERR, '>/dev/null';
    # setuid() if necessary
    exec ($cmd, @args) or exit 1;
  }
  wait; # may want to time out here?
  if ($? >> 8) { die "Error running $cmd: [$?]"; }
  while (<$fh>) {
    # Have fun with the output of $cmd
  }
  close $fh;
} 
```

# windows - 如何在 Windows 上静态编译 SDL 游戏

> ID：115813
> 
> 赞同：17
> 
> 时间：2008-09-22T16:13:53.803
> 
> 标签：windows, sdl, sdl-image, sdl-mixer

我一直在尝试为我的 Windows 游戏制作一个静态链接的“单一二进制”版本。我想与 sdl、sdl_image 和 sdl_mixer 链接，它们反过来又引入了一些支持库。不幸的是，我还没有找到一种方法让它们全部使用 cygwin/mingw/gcc 进行编译和链接。据我所知，所有现有的公共版本都只是共享库/dll。

请注意，我在这里不是在谈论许可。源将是开放的，因此 sdl 的 GPL/LGPL 不相关。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-08T03:52:49.217

编译项目时，您只需对 makefile 进行一些更改。

*   而不是`sdl-config --libs`，使用`sdl-config --static-libs`
*   用和包围上述`sdl-config --static-libs`使用。这告诉 GCC 强制静态链接，但仅限于它们之间指定的库。`-Wl,-Bstatic``-Wl,-Bdynamic`

如果您的 makefile 当前看起来像：

```
SDLLIBS=`sdl-config --libs` 
```

将其更改为：

```
SDLLIBS=-Wl,-Bstatic `sdl-config --static-libs` -Wl,-Bdynamic 
```

这些实际上是你*应该*在类 Unix 系统上做的同样的事情，但是如果你在`-static`GCC 上使用更简单的标志，它通常不会在类 Unix 系统上导致那么多错误，就像在 Windows 上那样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-04T15:45:56.973

通过这个[SDL 邮件列表帖子](http://lists.libsdl.org/pipermail/sdl-libsdl.org/2008-June/065521.html)，似乎 sdl 开发工具附带了一个 sdl-config 脚本，您可以将其与 --static-libs 标志一起使用来确定您需要使用哪些链接器标志。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-05-10T20:00:43.593

环境：VMWare Virtual Machine with Windows 7 x64 and Equipment we Dev c++ build 7.4.2.569, complilador g++ (tdm-1) 4.6.1

曾经，作为配置 Dev c ++ 安装的 SDL2-2.0.3 API 不是很清楚我做了什么，因为传统需要命令行。

第一个问题是 Windows 7 似乎改变了方法，他们去他的球。存货。参考。[https://stackoverflow.com/users/464581/cheers-and-hth-alf](https://stackoverflow.com/users/464581/cheers-and-hth-alf)

在第一关之后，SDL_platform.h 很糟糕，它又下降了一个，我不记得我在哪里下载了，但是下一个在指示的版本中不起作用。

我们必须将 SDL2.h ls 放在可执行文件的目录中。

`D:\prg_desa\zsdl2>g++ bar.cpp main.cpp -o pepe1 -ID:\SDL2-2.0.3\i686-w64-mingw32\include\SDL2 -LD:\SDL2-2.0.3\i686-w64-mingw32\lib -lmingw32 -lSDL2main -lSDL2 -mwindow`

我终于编译并进行了 SDL2 测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T16:20:43.067

这是因为 SDL 库在 LGPL 许可下。

如果你想静态链接库（如果你重新编译它们，你可以这样做。不过它需要对 makefile 进行一些黑客攻击），你还必须将你的游戏置于一些兼容的开源许可证下。

SDL-lib 以共享库的形式出现，因为大多数使用它们的程序都是封闭源代码。二进制发行版以大多数人需要的形式出现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-12T23:20:14.870

在我的系统（Ubuntu）上，我必须使用以下标志：

```
-Wl,Bstatic -lSDL_image `sdl-config --libs` -lpng12 -lz -ltiff -ljpeg -lasound -laudio -lesd -Wl,-Bdynamic `directfb-config --libs` -lpulse-simple -lcaca -laa -ldl 
```

它将 SDL、SDL`_`映像和它们的许多依赖项作为静态链接。libdl 你永远不需要静态的，所以制作一个使用 SDL`_`图像的完全静态的二进制文件是一个坏主意。脉冲、caca、aa 和 directfb 可能可以设为静态。我还没有足够远去弄清楚它们。

# graphics - 小型网站图片的格式是什么？GIF 还是 PNG？

> ID：115818
> 
> 赞同：35
> 
> 时间：2008-09-22T16:14:37.280
> 
> 标签：graphics, png, file-format, gif

在为网站做小图标、标题图形等时，使用 GIF 或 PNG 更好吗？

显然，如果需要透明效果，那么 PNG 肯定是要走的路，对于更大、更多照片的图像，我会使用 JPEG——但对于普通的网络“家具”，你会推荐哪种方式，为什么？它可能只是我正在使用的工具，但 GIF 文件通常似乎比可比较的 PNG 小一些，但使用它们似乎只是 1987 年。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-09-22T16:18:20.967

作为一般规则，PNG 永远不会比 GIF 更差，而且通常比 GIF 更好，因为它具有出色的压缩率。可能在某些边缘情况下 GIF 稍微好一些（因为 PNG 格式可能会从元数据中产生稍大的开销），但这真的不值得担心。

> 它可能只是我正在使用的工具，但 GIF 文件通常似乎比可比较的 PNG 小一些

这可能确实是由于您使用的编码工具。

/编辑：哇，似乎对 PNG 文件大小有很多误解。引用马特的话：

> 对于颜色很少的图像，GIF 没有任何问题，而且您已经注意到它们往往更小。

这是典型的编码错误，并非格式固有的。您可以控制颜色深度并使 PNG 文件变小。请参阅维基百科文章中的[相关部分](http://en.wikipedia.org/wiki/Portable_Network_Graphics#File_size_and_optimization_software)。

此外，在 MSIE6 中缺乏支持被 Chrono 夸大了：

> 如果您需要透明度并且可以使用 GIF，那么我会推荐它们，因为 IE6 支持它们。IE6 在透明 PNG 上表现不佳。

那是错误的。MSIE6*确实*支持 PNG 透明度。它不支持 alpha 通道（没有一些 hack），但这是另一回事，因为 GIF 根本没有它。

使用 GIF 而不是 PNG的*唯一*技术原因是当使用需要动画并且不想依赖其他格式时。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-22T16:20:47.810

W3C 提到 PNG 优于 GIF 的 3 个优点。

• Alpha 通道（可变透明度），

• 跨平台伽玛校正（图像亮度控制）和色彩校正

• 二维隔行扫描（一种逐行显示的方法）。

此外，请查看以下资源以获取指导：

*   [PNG v 的 GIF（W3C 指南）](http://www.w3.org/QA/Tips/png-gif)
*   [常见问题解答](http://www.libpng.org/pub/png/pngfaq.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-22T17:13:41.630

哇，我真的很惊讶这里的所有错误答案。适当优化后，PNG-8 将始终小于 GIF。**[只需通过PngCrush](http://pmt.sourceforge.net/pngcrush/)**或任何其他 PNG 优化例程运行您的 PNG-8 文件。

要理解的关键事项：

*   **PNG8 和 GIF 是无损的 <= 256 色**
*   **PNG8 总是可以小于 GIF**
*   **除非您需要动画，否则绝不应使用 GIF**

而且当然，

*   **将 JPG 用于黑白或全彩色照片图像**
*   **将 PNG 用于低颜色、线条艺术、屏幕截图类型的图像**

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-22T16:17:28.193

从法律的角度来看，使用 PNG 而非 GIF 的主要原因如下：

[http://www.cloanto.com/users/mcb/199​​50127giflzw.html](http://www.cloanto.com/users/mcb/19950127giflzw.html)

这些专利显然已于 2004 年到期，但您可以使用 PNG 作为开源而不是 GIF 的想法吸引了很多人。

（png开源参考：[http](http://www.linuxtoday.com/news_story.php3?ltsn=1999-09-09-021-04-PS) ://www.linuxtoday.com/news_story.php3?ltsn=1999-09-09-021-04-PS ）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T17:03:39.750

使用 PNG 时要小心颜色偏移。此链接提供了一个示例，并包含更多链接以及进一步的解释：

[http://www.hanselman.com/blog/GammaCorrectionAndColorCorrectionPNGIsStillTooHard.aspx](http://www.hanselman.com/blog/GammaCorrectionAndColorCorrectionPNGIsStillTooHard.aspx)

GIF 图像不受此问题的影响。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-22T16:18:20.907

我不认为这有很大的不同（客户不在乎）。我个人会选择 PNG，因为它们是 W3C 标准。

小心 PNG 透明效果：它们不适用于 IE6。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-22T16:22:31.237

对于网络上的图像，每种格式都有其优点和缺点。对于照片类型的图像（即很多很多颜色，没有硬边），请使用 JPEG。

对于图标等，您可以在 PNG 和 GIF 之间进行选择。GIF 仅限于 256 种颜色。PNG 可以像 GIF 一样格式化（即 256 种颜色，具有 1 位透明度，适用于 IE6），但对于小图像，它们比 GIF*略大。*24 位 PNG 支持大色域和 alpha 透明度（尽管在 IE6 中很麻烦）。

PNGS 是您唯一真正明智的选择，例如屏幕截图（即，大量颜色*和*硬边），而且就个人而言，这是我大部分时间都坚持使用的，除非我有更适合 JPEG 的东西（比如照片）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-22T17:20:09.383

索引 PNG（少于 256 种颜色）实际上总是比 gif 小，所以我大部分时间都使用它。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-22T16:19:34.240

GIF 的一个主要问题是它是一种受专利保护的格式（编辑：这显然不再正确）。如果您不关心这一点，请随意使用 GIF。PNG 比 GIF 具有更大的灵活性，尤其是在色彩空间方面，但这种灵活性通常意味着您需要在发布 PNG 之前对其进行“优化”。网络搜索应该为您的平台发现工具。

当然，如果你想要动画，GIF 是唯一的选择，因为 MNG 出于某种原因基本上无法启动。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-22T16:22:11.583

对于计算机生成的图形（即自己在 Photoshop、Gimp 等中绘制），JPG 是不可能的，因为它是有损的 - 即你会得到随机的灰色像素。对于静态图像，PNG 在各方面都更好：更多颜色、可缩放的透明度（例如，10% 透明，.gif 仅支持 0% 和 100%），但存在一些 Internet Explorer 版本不支持 PNG 的问题透明度正确，所以你得到看起来很难看的平坦的非透明背景。如果您不关心那些 IE 用户，请选择 PNG。

顺便说一句，如果您想要动画，请选择 GIF。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-22T18:05:50.880

PNG 是 GIF 文件的 100% 替代品，您可能会遇到的所有网络浏览器都支持 PNG。

在极少数情况下，GIF 更可取。最重要的是动画——GIF89a 标准支持动画，几乎所有浏览器都支持它，但普通的旧 PNG 格式不支持——你需要使用 MNG，它对浏览器的支持有限。

几乎所有浏览器都支持 PNG 文件中的单位透明度（GIF 格式提供的透明度类型）。IE6 中缺乏对 PNG 的全 8 位透明度的支持，但在大多数情况下，可以通过一点 CSS 魔法来纠正这种情况。

如果你的 PNG 文件比同等的 GIF 文件大，那几乎可以肯定是因为你的源图像有超过 256 种颜色。GIF 文件索引到最多 256 种颜色的调色板，而大多数图形程序中的 PNG 文件默认以 24 位无损格式保存。如果文件大小比准确的颜色更重要，请将文件保存为 8 位索引 PNG，它应该相当于 GIF 或更好。

使用带有不替换标志的动画帧和多个调色板的组合，可以“破解”一个 GIF 文件，使其具有超过 256 种颜色，但自从 PNG 出现以来，这种方法实际上已被遗忘。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-10-25T22:26:17.920

“它可能只是我正在使用的工具，但 GIF 文件通常似乎比可比较的 PNG 文件小一点，但使用它们似乎只是 1987 年。”

它可能是你的工具。来自 PNG 常见问题解答：

“这种现象背后有两个主要原因：比较苹果和橙子（即不比较相同的图像类型），以及使用不良工具。” [继续...](http://www.libpng.org/pub/png/pngfaq.html#size)

但是你总是可以尝试同时保存（使用相同的颜色深度），看看哪个更小。

当然，如果您想为您的网站标准化一种图形格式，PNG 可能是最好的一种。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T16:17:01.983

就我个人而言，我在我的图像中使用了相当多的 gif，因为它们在任何地方都可以使用，显然你的透明度限制是一个关键因素，它将引导某人使用特定的格式。

我没有看到使用 gif 的任何缺点。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-22T16:17:24.060

如果它们变得更小并且您无法从使用 PNG 提供的功能（即 alpha 通道透明度和超过 256 种颜色）中获得任何好处，那么我认为您没有理由使用 PNG。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-22T16:20:28.980

gif 文件往往会小一些，因为它们不支持透明 alpha 通道（可能出于其他一些原因）。就个人而言，我不觉得尺寸差异真的像过去那样值得担心。大多数人现在都在使用某种宽带上网，所以我怀疑他们会注意到不同之处。

使用最适合您的操作工具的图像类型可能更重要。

另外，我喜欢将图像放在任何背景上并进行投影工作的能力，这让我更倾向于 png 格式。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-22T16:20:55.157

由于尺寸的原因，我通常使用 gif，但也有 256 色的 png-8。

如果您需要花哨的半透明东西，请使用 png-24。

我通常使用 Photoshop 中的“保存为网络”功能，它可以让您在保存之前调整文件类型、颜色数量等并查看结果。当然，我会尽可能使用最小的，但在我眼中仍然看起来不错。

* * *

## 回答 #17

> 赞同：-5
> 
> 时间：2008-09-22T16:16:49.067

我将 jpg 用于所有非透明图像。您可以控制我喜欢的压缩。我找到[了](http://www.wfu.edu/~matthews/misc/jpg_vs_gif/JpgVsGif.html)比较两者的网站。jpg 更小，看起来更好。

# performance - 轻量级 X 窗口管理器/环境

> ID：115819
> 
> 赞同：11
> 
> 时间：2008-09-22T16:14:41.990
> 
> 标签：performance, x11, window-managers

我的机器动力严重不足，我想我需要开始节省每个备用周期。我知道与我同事的 KDE 设置相比，我的 Gnome 环境似乎表现不佳。但如果我要做出这么大的转变，我不妨考虑运行更轻的东西。

是否有可能在轻量级窗口管理器上生存并仍然运行现代应用程序（Firefox、Eclipse、OpenOffice）？我可以尝试什么好的候选窗口管理器，我需要知道什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-22T16:15:52.737

下面列出的窗口管理器都订阅了轻量级和快速的方法。它们比 KDE 或 Gnome 等成熟的窗口管理器更快，并且减少了大多数视觉干扰。您选择哪一个将主要取决于您自己的口味以及您可以运行的内容。

这些窗口管理器有一个子家族，特别是那些试图让您通过键盘完成所有操作并让您以最小的屏幕空间浪费平铺应用程序的窗口管理器。如果您来自面向鼠标的窗口管理器，这些可能会很有趣。XMonad 和 ratpoison 是这个家族的成员。

*   [xfce](http://www.xfce.org/)
*   [鼠药](http://www.nongnu.org/ratpoison/)
*   [通量盒](http://www.fluxbox.org/)
*   [真棒](http://awesome.naquadah.org/)-1，无法处理最小化到托盘
*   [XMonad](http://xmonad.org/)
*   [dwm](http://dwm.suckless.org/)
*   [fvwm](http://www.fvwm.org/)（另一个 WM 的代码库）
*   [冰雪](http://www.icewm.org/)
*   [启蒙](http://www.enlightenment.org/)
*   [wmii](http://www.suckless.org/wmii/)
*   [开箱](http://icculus.org/openbox/index.php/Main_Page)
*   [pekwm](http://www.pekwm.org/projects/pekwm)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-22T16:29:38.180

我喜欢[XMonad](http://www.xmonad.org/)。它非常稳定，开销非常低，并且拥有活跃的用户/开发者社区。

XMonad 几乎和ratpoison 一样小，但它通过平铺显示多个窗口，如果您真的需要它们甚至允许浮动窗口（例如，用于模态对话或 GIMP）。这无疑让我动力不足的 Ubuntu 机器焕发了新的生机！

**编辑：**我忘了提到：XMonad 是基于键盘的，而不是 point'n'grunt，所以有一点学习曲线，但是一旦我掌握了它的窍门，我发现我的工作效率要高得多。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-22T16:17:22.607

Fluxbox 是一个很好的替代品，而且非常轻量级。

[http://www.fluxbox.org/](http://www.fluxbox.org/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-25T21:25:03.487

您应该首先使用您需要的东西构建您自己的内核。这将节省大量资源。然后，选择一个轻量级的 WM。我发现 Enlightenment 非常轻巧而且很棒，试一试。稍后，您应该寻找您使用的应用程序的轻量级替代品。您可以将 OpenOffice 替换为 Abiword、Gnumeric。只需 google，您就会发现那些 ram-eater 软件的非常好的替代品。我建议避免使用 Java 软件，它们在低资源 PC 上运行会非常缓慢。此外，检查当前在您的 PC 上运行的服务，并禁用您不使用的服务。考虑将您当前的发行版更改为低资源发行版。我发现 Debian 非常可定制和轻量级。祝你好运！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T16:50:03.997

Icewm 非常漂亮和精简（在一个动力不足的盒子上使用了一段时间，但在盒子升级后移到了 KDE）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-12-28T21:59:40.727

我使用[FVWM](http://fvwm.org/) 7 年了。大多数 WM 基于 FVWM，但剥夺了 FVWM 的任何灵活性。

FVWM 只是 Xlib 的“接口”，因此它为您带来了`Xlib`.

如果您想要当前流行的平铺 - 只需：[FvwmPiazza::Tiler](https://metacpan.org/pod/FvwmPiazza%3a%3aTiler)

谷歌`~/.fvwm/config`因为从头开始太难了，我从这个很好的开始：http: [//zensites.net/fvwm/guide/](http://zensites.net/fvwm/guide/)

另请关注：

*   [https://wiki.archlinux.org/index.php/FVWM](https://wiki.archlinux.org/index.php/FVWM)
*   [http://wiki.gentoo.org/wiki/FVWM](http://wiki.gentoo.org/wiki/FVWM)
*   [https://wiki.debian.org/Fvwm](https://wiki.debian.org/Fvwm)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T20:09:31.723

几年来，icewm 对我有好处。我不需要大型台式机提供的大部分废话，但我确实喜欢在底部的栏中运行的时钟和 CPU 使用监视器——icewm 确实有这些。它的手感明显比流行的台式机轻。没有像瓷砖窗户或防鼠态度这样的怪异现象。自定义根菜单也很容易，比在 KDE 或 Gnome 中这样做要容易得多，我从来没有充分理解。在我工作的一个地方，系统管理员看到了我的屏幕并决定试一试。AFIK，他还在使用它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T21:53:52.853

我会推荐[openbox](http://icculus.org/openbox/index.php/Main_Page)。它的轻量级、可配置性强，而且运行良好，不会妨碍您。非常实用，几乎可以做任何你想做的事情。我喜欢它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T16:21:22.193

第二个是 xfce，它可能是最流行的轻量级 WM（可能是因为它包含在[Xubuntu](http://www.xubuntu.org/)中）。我在[Fluxbox](http://www.fluxbox.org/)方面也有很好的经验（当我将它用作轻量级 Linux VM 时，它与 Damn Small Linux 一起提供（当 VM 很慢时 :-)）。

在迁移到这些更轻量级的 WM 时，肯定有一个易于使用的学习曲线，但在旧硬件上不难看出性能优势（菜单立即出现，导航非常快捷）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T16:21:24.737

我使用[Fluxbox](http://fluxbox.org/)很长时间了，这对于习惯在 KDE、Gnome 等环境中浮动的人来说非常有用。它非常小、非常快且高度可配置，而且它看起来不像其他一些“极简主义”那样难看窗口管理器。;)

几周前，我切换到了[awesome](http://awesome.naquadah.org/)，因为我喜欢它放置和调整窗口大小的效率。这对我来说非常完美，因为我几乎总是在一个屏幕上只有一个全屏终端，而在另一个屏幕上只有一个浏览器。它还支持混合窗口样式，因此您可以在一个屏幕上通过令人敬畏的浮动窗口管理窗口（例如，我几乎总是打开一个托管的全屏 urxvt 并在其中一个角落有一个小的浮动 mplayer 窗口）。它和fluxbox一样轻巧，甚至更快，但没有提供太多自定义外观的选项。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T22:45:21.927

我尝试了一段时间的 PekWM。我真的很喜欢它。它允许我对相同类型的程序进行分组，例如：终端。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T16:31:14.400

我也在使用通量盒。与桌面环境相比，仅使用窗口管理器并不方便。您自己选择每个组件，这既是优势也是劣势。ROX 文件管理器和 usbmount 是 Fl​​uxbox 的绝佳伴侣。还要花点时间寻找一些可能有用的停靠应用程序。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T16:59:51.320

[Enlightenment (v16)](http://enlightenment.org/)实际上与现在的 gnome/kde 相比非常轻量级，而且它的可配置性非常好（虽然似乎没有什么比 fvwm 更可配置） [Florian 的建议](https://stackoverflow.com/questions/115819/lightweight-x-window-managerenvironment#115825)都很好，但是如果你习惯了 gnome/kde，那么你可能不会喜欢ratpoison / xmonad。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-01-21T02:56:51.000

我曾经使用过所有的东西，但我不断地回到 WindowMaker。我喜欢剪辑的概念、多个工作区（我为每种类型的任务保留一个）以及它看起来很不错的主题，而且非常简单。

Docker 是一个必不可少的应用程序，可以添加到桌面以将 nm-applet 和其他小程序保留在 WindowMaker Dock 中。

不要以默认主题来判断它。使用 Wprefs 工具根据自己的喜好对其进行自定义。

干杯KG

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-12-24T11:02:57.893

我本人使用“lwm”或轻量级窗口管理器已有一段时间了，并且对它非常满意。我将它与用于时钟和更好的窗口操作的 xfce4-panel 一起使用。与 xfce、icewm、pekwm 等相比，Lwm 确实是轻量级的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-08-16T18:34:14.703

Blackbox (+ bbkeys) 有点奇怪，但很不错。您还可以查看窗口管理器的[比较表](https://en.wikipedia.org/wiki/Comparison_of_X_window_managers)。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-07-05T04:35:41.460

多年来，我已经降级了我机器的 WM。由于更主流的 WM（如 Gnome 或 KDE）变得越来越需要资源，不久之后，我在笔记本电脑和台式计算机上将 Gnome 替换为 XFCE。

事实上，我使用 XFCE 的时间比任何其他 WM 都长。在我看来，第一次看到 Gnome 和 KDE 之类的东西时，它们的精妙之处就很棒，但是在使用了几周和几个月后，新奇感就消失了，回到过去更有意义更精简的环境。

XFCE 的问题在于，对于我仍然拥有的一些较旧的笔记本电脑来说，它并不像它需要的*那样轻巧。*我决定在这些上使用[LXDE](http://lxde.org)，老实说，我对此有点爱恨交加。它运行*良好*，从某种意义上说它对资源非常友好，并且登录速度很快，等等。但某些事情似乎并不那么好。其中之一是任务栏。似乎有些图标不合适，因为它们是为 Gnome 或 XFCE 之类的东西设计的。这些图标仍然有效，但几乎不可能让整个 LXDE 体验看起来很重要。

# java - 从实时视频设备捕获图像以供基于 Java 的应用程序使用的最佳方法是什么？

> ID：115835
> 
> 赞同：25
> 
> 时间：2008-09-22T16:17:40.377
> 
> 标签：java, video, image-processing, video-capture, image-capture

我正在研究用于对某些场景进行半实时检测的图像处理问题。*我的目标是让实时视频以某种方式*在我的 Java 代码中以 Motion JPEG 帧的形式出现。

我熟悉[Java 媒体框架](http://java.sun.com/javase/technologies/desktop/media/jmf/)，遗憾的是，我认为我们可以认为这是一个有效的死 API。我也熟悉[Axis 盒子](http://www.axis.com/)，虽然我真的很喜欢他们的解决方案，但如果我对我的特定兴趣点提出任何批评性反馈，我将不胜感激。

出于本次讨论的目的，这就是我定义“最佳”的方式：

*   延迟 - 如果我使用此视频流控制相机，我希望尽可能将往返延迟保持在 100 毫秒以下。这是从我的控制输入到我看到可见变化之间的时间来衡量的。稍后编辑：要记住的另一件事是相机控制可能是手动和自动（事件触发器）的组合。即使高质量的提要单独存档，我们也需要立即查看这些图片。
*   成本免费/开源总比不免费好。
*   可调整的编解码器参数 - 我需要能够针对某些情况调整编解码器。有时，高速低分辨率流实际上更容易处理。
*   与 Java 的“集成”——将这个解决方案与我的代码挂钩有多麻烦？我是否通过套接字发送数据包？点击网址？安装 Direct3D / JNI 组合？
*   Windows/Linux/两者？- 我更喜欢与操作系统无关的解决方案，因为我必须提供多种操作系统，但可能有一种解决方案对其中一种而言是最佳的，而对另一种则不是。

注意：我知道其他图像/视频捕获编解码器，这不是这个问题的重点。由于帧精度的损失，我对流 API（例如 MPEG4）特别*不感兴趣。*但是，如果我的问题有一个解决方案可以提供另一个帧精确的数据流，请加入。

跟进这个问题：在这一点上，我强烈倾向于购买[Axis 视频编码器](http://www.axis.com/products/video/video_server/index.htm)等设备，而不是尝试在软件中或直接在 PC 上捕获视频。但是，如果有人有其他选择，我很乐意听到他们的声音。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-01-28T15:24:12.230

这个 JavaCV 实现工作正常。

**代码：**

```
import com.googlecode.javacv.OpenCVFrameGrabber;

import com.googlecode.javacv.cpp.opencv_core.IplImage;
import static com.googlecode.javacv.cpp.opencv_highgui.*;

public class CaptureImage {
    private static void captureFrame() {
        // 0-default camera, 1 - next...so on
        final OpenCVFrameGrabber grabber = new OpenCVFrameGrabber(0);
        try {
            grabber.start();
            IplImage img = grabber.grab();
            if (img != null) {
                cvSaveImage("capture.jpg", img);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    public static void main(String[] args) {
        captureFrame();
    }
} 
```

还有关于从相机[查看实时视频的帖子。](http://ganeshtiwaridotcomdotnp.blogspot.com/2011/12/javacv-capture-save-flip-show-live.html)[以及 JavaCV 的配置：](http://ganeshtiwaridotcomdotnp.blogspot.com/2011/12/opencv-javacv-eclipse-project.html)

我认为这将满足您的要求。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-31T20:31:24.180

FMJ 绝对可以捕获视频并将其转换为 MJPEG 帧。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T17:32:35.937

关于 JMF 的死亡，你知道[FMJ 的实现](http://fmj-sf.net)吗？我不知道它是否有资格作为“最佳”解决方案，但它可能值得加入讨论。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-07-24T16:16:02.380

下面显示了一个使用[Marvin Framework](http://marvinproject.sourceforge.net)的非常简单的实现。使用 Marvin，您可以轻松添加实时视频处理。

```
import javax.swing.JFrame;
import marvin.gui.MarvinImagePanel;
import marvin.image.MarvinImage;
import marvin.video.MarvinJavaCVAdapter;
import marvin.video.MarvinVideoInterface;

public class SimpleVideoTest extends JFrame implements Runnable{

    private MarvinVideoInterface    videoAdapter;
    private MarvinImage             image;
    private MarvinImagePanel        videoPanel;

    public SimpleVideoTest(){
        super("Simple Video Test");

        // Create the VideoAdapter and connect to the camera
        videoAdapter = new MarvinJavaCVAdapter();
        videoAdapter.connect(0);

        // Create VideoPanel
        videoPanel = new MarvinImagePanel();
        add(videoPanel);

        // Start the thread for requesting the video frames 
        new Thread(this).start();

        setSize(800,600);
        setVisible(true);
    }

    public static void main(String[] args) {
        SimpleVideoTest t = new SimpleVideoTest();
        t.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    }

    @Override
    public void run() {
        while(true){
            // Request a video frame and set into the VideoPanel
            image = videoAdapter.getFrame();
            videoPanel.setImage(image);
        }
    }
} 
```

另一个应用多种算法进行实时视频处理的[示例。](http://sourceforge.net/p/marvinproject/code/108/tree/dev/trunk/MarvinSamples/src/video/videoFilters/VideoFilters.java)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-12T23:30:22.867

这是我的 JavaCV 实现，具有高分辨率视频输出，并且与其他解决方案相比，帧速率没有明显下降（只有当我的网络摄像头重新聚焦时，我才注意到轻微下降，但只是片刻）。

```
import java.awt.image.BufferedImage;
import java.io.File;

import javax.swing.JFrame;

import com.googlecode.javacv.CanvasFrame;
import com.googlecode.javacv.OpenCVFrameGrabber;
import com.googlecode.javacv.OpenCVFrameRecorder;
import com.googlecode.javacv.cpp.opencv_core.IplImage;

public class Webcam implements Runnable {

    IplImage image;
    static CanvasFrame frame = new CanvasFrame("Web Cam");
    public static boolean running = false;

    public Webcam()
    {
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    }

    @Override
    public void run()
    {
        try
        {
            grabber.setImageWidth(800);
            grabber.setImageHeight(600);
            grabber.start();
            while (running)
            {
                IplImage cvimg = grabber.grab();
                BufferedImage image;
                if (cvimg != null)
                {
                    // opencv_core.cvFlip(cvimg, cvimg, 1); // mirror
                    // show image on window
                    image = cvimg.getBufferedImage();
                    frame.showImage(image);
                }
            }
            grabber.stop();
            frame.dispose();
        } catch (Exception e)
        {
            e.printStackTrace();
        }
    }

    public static void main(String... args)
    {
        Webcam webcam = new Webcam();
        webcam.start();
    }

    public void start()
    {
        new Thread(this).start();
        running = true;
    }

    public void stop()
    {
        running = false;
    }
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-22T20:28:24.173

你看过[Processing.org](http://processing.org/)吗？它基本上是一个简化的应用程序框架，用于开发“艺术”应用程序和物理计算平台，但它基于 Java，您可以深入挖掘下面的“真正”Java。

想到它的原因是有几个用于处理的视频[库](http://processing.org/reference/libraries/index.html)，它们基本上是 Java 组件（至少我认为它们是 - 该站点包含您可能需要的所有技术信息）。有一个关于在 Eclipse IDE 中使用处理库和工具的[教程](http://processing.org/learning/tutorials/eclipse/)。还有许多关于视频捕获和处理的[示例。](http://processing.org/learning/libraries/)

即使您不能直接使用这些库，Processing 也是一种用于制定算法的出色语言/环境。那里有几个很好的图像和视频捕获以及实时处理的例子。

# binary - 您将如何对从设备中提取的一组二进制数据进行逆向工程？

> ID：115836
> 
> 赞同：8
> 
> 时间：2008-09-22T16:18:00.530
> 
> 标签：binary, reverse-engineering, binary-data

我的一个朋友前几天提出了这个问题，他最近买了一个 garmin 心率监测设备，可以跟踪他的心率，并允许他将一天的心率统计数据上传到他的电脑。

唯一的问题是 garmin USB 设备没有 linux 驱动程序，他设法解释了一些数据，例如型号和他的用户详细信息，并发现本质上存在一些二进制数据表，我们假设它们代表一系列记录他的心率和记录的时间。

当您对结构一无所知时，逆向工程数据从哪里开始？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T16:22:14.220

我遇到了同样的问题，最初在 Google Code 上发现了这个项目，该项目旨在为 Garmin 设备完成跨平台版本的工具……请参阅：[http](http://code.google.com/p/garmintools/) ://code.google.com/p/garmintools/ 。该项目的首页上有一个链接，指向您需要的协议，Garmin 考虑周到，可以公开发布。

这是 Garmin I/O 规范的直接链接：[http ://www.garmin.com/support/pdf/IOSDK.zip](http://www.garmin.com/support/pdf/IOSDK.zip)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T16:21:48.947

我会开始在十六进制编辑器中查看数据，希望是一个知道最常见编码（ASCII、Unicode 等）的好编辑器，然后尝试从您知道它已存储的数据中理解它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T16:24:20.937

正如另一张海报所提到的，逆向工程可能很麻烦，不是在实践中而是在合法性上。

话虽如此，您可以通过查看此项目及其代码来找到与您手头的根本问题相关的所有内容......并且他们也处理跑步者的心率/GPS组合数据

[http://www.gpsbabel.org/](http://www.gpsbabel.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T16:19:46.767

我建议您首先检查您所在国家/地区的逆向工程的合法性。大多数国家对逆向工程设备和代码的允许和不允许有非常严格的法律。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T16:28:24.703

我将首先查看设备正在发送哪些数据，然后考虑如何表示和打包这些数据。

我会首先捕获许多样本，看看是否有任何模式出现，因为心跳是有规律的，这表明它是与心脏本身相关的测量值。我还会寻找单调增加的位字段，因为这会暗示某种时间戳。

在对什么在哪里形成一个假设后，我会编写一个程序来测试它并绘制结果图表，看看它是否有意义。如果确实如此，但不完全如此，那么仔细检查可能会发现您需要一些缩放因子在这里或那里。也完全有可能我需要先处理数据，然后才能看起来像他们的程序显示的那样，即可能需要整合数据点。如果我得到垃圾，那么它又回到了绘图板上:-)

我还会查看制造商的网站，或者`strings`在他们的二进制文件上运行。寻找在生物医学工程领域工作的人也会在我的名单上，因为他们可能知道通常使用哪些协议（如果有的话）。我还会寻找这些协议，看看是否可以将任何协议应用于我看到的数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-05T19:39:38.700

我将从创建数据的十六进制转储开始。估计它可能被一些 2 次方大小的块阻塞了。开始寻找重复的模式。想想他们可能发送什么样的数据。他们要么单独记录每次心跳，要么记录传感器以固定间隔发送的任何内容。如果是单独的节拍，那么将有一个时间增量（从最后一个节拍开始）、一个持续时间以及某种最大或平均强度。如果它是固定间隔，那么它可能是一个简单的读数向量。可能会有某种序言，带有开始时间戳和采样率。您可以尝试自己解码时间戳，或者您可以尝试简单地将其输入`ctime()`并查看它们是否使用标准的绝对时间格式。

请记住，许多廉价的 A/D 转换器仅产生 12 位输出，因此您的读数不太可能大于 16 位（高位 4 位可能用于标志）。我建议将设备重置为“空白”，转储并存储内容，然后读取一组读数，记录结果（无论设备通常报告什么），然后再次转储内容并尝试关联记录的结果在“空白”转储之后出现的任何数据。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-09-17T21:28:54.450

不确定这是否是您正在寻找的，但 Garmin 已经创建了一个与您的浏览器一起运行的 API。似乎支持 OSX 以及 Windows 浏览器......我会从 Google Chromium 尝试它，看看它是否可以用来代替这种逆向工程......

[http://developer.garmin.com/web-device/garmin-communicator-plugin/](http://developer.garmin.com/web-device/garmin-communicator-plugin/)

**API 功能**

> 自动检测连接到计算机的设备 访问设备产品信息，例如产品名称和软件版本 从支持的娱乐、健身和导航设备读取轨迹、路线和航点 将航迹、路线和航点写入支持的娱乐、健身和导航设备 读取健身来自支持的健身设备的数据 地理编码地址并作为航点或收藏夹保存到设备 读写 Garmin XML 文件（GPX 和 TCX）以及二进制文件。支持大多数 Garmin 设备（USB、USB 大容量存储设备、大多数串行设备） 支持 Microsoft Windows 上的 Internet Explorer、Firefox 和 Chrome。在 Mac OS X 上支持 Safari、Firefox 和 Chrome。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-22T16:21:14.207

你能用电脑扬声器之类的东西合成心跳吗？（我不知道这些设备实际上是如何工作的）。观察二进制结果如何根据不同的输入而变化。

拆开设备并检查里面的东西可能也会有所帮助。

# python - 推荐的 Python 发布/订阅/调度模块？

> ID：115844
> 
> 赞同：27
> 
> 时间：2008-09-22T16:19:16.487
> 
> 标签：python, publish-subscribe, pypubsub

来自[PyPubSub](http://pypi.python.org/pypi/PyPubSub/)：

> Pypubsub 为您的 Python 应用程序提供了一种简单的方法来解耦其组件：应用程序的一部分可以发布消息（有或没有数据），而其他部分可以订阅/接收它们。这允许消息“发送者”和消息“侦听者”彼此不知道：
> 
> *   一个不需要导入另一个
> *   发件人不需要知道
>     *   “谁”收到消息，
>     *   听众将如何处理数据，
>     *   或者即使任何侦听器都会获取消息数据。
> *   同样，听众也不必担心消息来自哪里。
> 
> 这是实现模型-视图-控制器架构或任何促进其组件解耦的类似架构的绝佳工具。

从 PyPubSub 到[PyDispatcher](http://pydispatcher.sourceforge.net/)再到简单的“自制”类，似乎有相当多的 Python 模块用于发布/订阅。

在比较不同的不同模块时，是否有特定的优缺点？哪些模块集进行了基准测试和比较？

提前致谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-22T18:44:43.627

[PyDispatcher](http://pydispatcher.sourceforge.net/)在[Django](http://pydispatcher.sourceforge.net/)中被大量使用，它对我来说非常有效（我猜对整个 Django 社区来说也是如此）。

我记得，有一些性能问题：

*   PyDispatcher 进行的参数检查很慢。
*   未使用的连接有不必要的开销。

AFAIK 您不太可能在中小型应用程序中遇到此问题。因此，这些问题可能与您无关。如果您认为您需要每一磅性能（过早的优化是万恶之源！），您可以查看对 Django 中的 PyDispatcher 所做的修改。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-04-03T21:13:25.987

python 最好的调度包似乎是django中的[调度模块（在文档中称为](http://github.com/django/django/tree/master/django/dispatch/)[信号](http://docs.djangoproject.com/en/dev/topics/signals/)）。它独立于 django 的其余部分，并且简短、有文档、经过测试并且编写得非常好。

**编辑：**我将该项目分叉为 Python的[独立信号项目。](https://github.com/olivierverdier/dispatch)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T19:19:31.733

我最近仔细查看了[py-amqplib](http://barryp.org/software/py-amqplib/)作为 RabbitMQ 代理的 AMQP 客户端。后一个工具是用 Erlang 编写的。

如果您希望解耦您的应用程序。那为什么要把它和语言本身结合起来呢？考虑使用语言中立的消息队列，然后你真的有成长的空间！

话虽如此，AMQP 需要努力去理解，如果你的应用程序可能比你愿意承担的更多。工作正常。YMMV。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-01T23:03:28.510

我发现一些尚未提及的库：

*   [Circuits](http://circuitsframework.com/) - 具有强大组件架构的轻量级、事件驱动框架。
*   [C# 事件配方](http://code.activestate.com/recipes/410686/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-06-04T12:45:37.990

这是一个较新的：[https](https://github.com/shaunduncan/smokesignal) ://github.com/shaunduncan/smokesignal 。“ *smokesignal 是一个简单的 python 库，用于发送和接收信号。它从 django 信号框架中汲取了一些灵感，但它是一个通用的变体。* ” 示例：

```
from time import sleep
import smokesignal

@smokesignal.on('debug')
def verbose(val):
    print "#", val

def main():
    for i in range(100):
        if i and i%10==0:
            smokesignal.emit('debug', i)
        sleep(.1)

main() 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T20:52:03.947

还有 PJ Eby、RuleDispatch 和 PEAK 项目的库，特别是 Trellis。我不知道他们的实际状态，但邮件列表非常活跃。

[PyPi 上的最后一个 Trellis 版本](http://pypi.python.org/pypi/Trellis/0.7a2)

[格子文档](http://peak.telecommunity.com/DevCenter/Trellis)

我还使用了来自 BBC 的[Kamaelia 项目](http://edit.kamaelia.org/Home)的组件。Axon 是一种有趣的方法，但比出版商和消费者的灵感更多。好吧，它的网站根本不是最新的……Google SoC 2008 中有一个或 2 个项目，工作正在进行中。

不知道有没有帮助：）

编辑：我刚刚发现[Py-notify](http://home.gna.org/py-notify/tutorial.html)是观察者模式的“非正统”实现。它具有我自己的工具所需的大部分功能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T13:28:17.127

PyPubSub 似乎是一个管理混乱的项目（SF 上的 Wiki 已死，SF 上链接的网站（另一个 Wiki）目前已损坏）这一事实就足以让我有理由不使用它。PyDispatcher 有一个完整的网站，但他们似乎提供的唯一文档是从文档字符串生成的 API 的文档。邮件列表上也没有流量……一个不好的迹象！

正如 Mike 还提到的，完全可以选择独立于 Python 的解决方案。现在不要误会我的意思，我*喜欢*Python，但在这个领域，使用与编程语言分离的框架仍然是有意义的。

我对消息传递没有经验，但我打算研究一些解决方案。到目前为止，这两个（免费、开源）项目对我来说似乎是最有前途的（巧合的是，它们都是 Apache 项目）：

*   [活动MQ](http://activemq.apache.org/)
*   [Qpid](http://qpid.apache.org/)

两者似乎都是相当成熟的项目，至少就文档和社区而言。不过，我无法评论该软件的质量，正如我所说，我没有使用任何软件。

Qpid 附带 Python 的客户端库，但您也可以使用[py-amqplib](http://barryp.org/software/py-amqplib/)。对于 ActiveMQ，有[pyactivemq](http://code.google.com/p/pyactivemq/)，您可以使用它通过 STOMP（面向流文本的消息传递协议）或通过 Openwire 进行连接。

# algorithm - 现有哪些服务可用于计算两个地址之间的距离？

> ID：115850
> 
> 赞同：12
> 
> 时间：2008-09-22T16:19:54.363
> 
> 标签：algorithm, geolocation, distance

我想实现一种方法来显示按与给定地址的接近程度排序的存储地址列表。

列表中的地址将存储在数据库表中。单独的部分有单独的字段（我们有邮政编码、城市名称等字段），因此它不仅仅是一个巨大的`varchar`. 这些是用户输入的，并且由于系统的性质可能并不总是完整的（有些可能缺少邮政编码，而另一些可能只有城市和州）。

虽然这是针对 Intranet 应用程序，但我在使用外部资源（包括访问 Internet Web 服务等）时没有问题。实际上，我更喜欢自己动手，除非自己做是微不足道的。如果谷歌或雅虎！已经提供免费服务，我非常愿意检查一下。关键字是它必须​​是免费的，因为我不能随意为这个项目引入任何额外的成本，因为它已经是一个额外的“特权”可以这么说。

我想这很像许多实体店做他们的“查找位置”功能。将它显示在一个适当排序的简单表格中并显示距离（例如英里）非常棒。显示地图混搭更酷，但我绝对可以忍受只是恢复距离，我处理所有后续显示和排序。

简单距离算法的问题在于数据的性质。由于地址的全部或部分可能未定义，因此我没有任何方便的东西，例如纬度/经度坐标。此外，即使我要求邮政编码，90% 的地址也可能具有相同的五个邮政编码。

虽然它不需要非常快，但正如我们所知，由于延迟而需要超过 7 秒才能显示在页面上的任何内容可能对于普通用户来说等待时间太长。如果这样的假设服务支持一次发送一批地址而不是一次查询一个，那就太好了。尽管如此，我不应该认为地址列表总数会超过 50 个，如果有的话。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-22T16:26:50.150

[谷歌](http://code.google.com/apis/maps/documentation/services.html#Geocoding)和[雅虎！](http://developer.yahoo.com/maps/rest/V1/geocode.html)两者都免费提供地理编码服务。[您可以使用Haversine 公式](http://en.wikipedia.org/wiki/Haversine_formula)（[在 .NET 或 SQL 中实现](http://www.codeproject.com/KB/cs/distancebetweenlocations.aspx)）计算距离。这两种服务都可以让您进行部分搜索（仅限邮政编码，仅限城市），并让您知道其结果的精确度（这样您就可以排除没有有意义信息的位置，尽管 Yahoo! 提供的精确度信息比 Google 高）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T16:27:42.100

由于使用条款，Google Maps API 对您没有好处。但是，Yahoo 提供 REST 服务，用于将地址转换为经纬度坐标，然后您可以使用它来计算距离。它[在这里](http://developer.yahoo.com/maps/rest/V1/geocode.html)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T16:34:55.857

要求他们输入邮政编码，然后创建一个数据库表，将邮政编码映射到纬度/经度对（或在线查找）。我不知道你在哪里工作，但在这里，邮政编码可以特定于几米，所以应该足够精确。然后使用这种方法计算两个邮政编码之间的距离：

```
public static double distance(double lat1, double lon1, double lat2, double lon2, char unit)
{
  double theta = lon1 - lon2;
  double dist = Math.Sin(deg2rad(lat1)) * Math.Sin(deg2rad(lat2)) +
    Math.Cos(deg2rad(lat1)) * Math.Cos(deg2rad(lat2)) * Math.Cos(deg2rad(theta));
  dist = Math.Acos(dist);
  dist = rad2deg(dist);
  dist = dist * 60 * 1.1515;
  if (unit == 'K')
  {
    dist = dist * 1.609344;
  }
  else if (unit == 'N')
  {
    dist = dist * 0.8684;
  }
  return (dist);
}

private static double deg2rad(double deg)
{
  return (deg * Math.PI / 180.0);
}

private static double rad2deg(double rad)
{
  return (rad / Math.PI * 180.0);
} 
```

使用您自己的代码而不是地理编码服务的优势在于，您可以对数据进行更多有趣的计算，并将数据与数据一起存储在您的数据库中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T16:23:12.313

你不能只使用谷歌地图 API 来获取距离并对它们进行排序吗？

[http://code.google.com/apis/maps/](http://code.google.com/apis/maps/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T16:23:21.563

我建议调查谷歌地图 API。

它需要您有一个外部连接（并且可以将其上的数据分流到 Web 服务），但它提供了您所需要的，即通过询问 2 点之间的路线并获取距离它。

[路线 API 的 API 参考](http://code.google.com/apis/maps/documentation/reference.html#GDirections)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T16:25:35.007

我们在我公司做过的一件事是作弊并使用邮政编码的纬度/经度（大致是邮政编码区域的中心）。它并不完美，但对于那些在 y 类型的搜索 n 英里内找到我 x 的人来说已经足够接近了。*当地址清理服务无法识别地址时，这尤其有用。*

在某些时候，我遇到了一个免费的邮政编码到纬度/经度查找表，用于这个近似值。对不起，我没有这个链接了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T16:28:09.213

其他人已经在[Daft Logic](http://www.daftlogic.com/projects-google-maps-distance-calculator.htm)做到了（编辑：错字）。他们使用 Google Maps API 和[Great-circle formula](http://en.wikipedia.org/wiki/Great-circle_distance)。我认为实施起来并不难。

**更新**：实际上，您只需要从您最喜欢的提供商处获取坐标，然后使用您的代码进行计算。当用户提供他们的位置时，您可以预加载商店的坐标 - 您甚至可以使用它进行验证。然后，在发出请求时，您只能查找客户的位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T18:34:20.423

看看这个网站： http: [//geocoder.us/help/utility.shtml](http://geocoder.us/help/utility.shtml)

您可以像这样每 15 秒处理 1 条记录： [http ://geocoder.us/service/distance?zip1=95472&zip2=94305](http://geocoder.us/service/distance?zip1=95472&zip2=94305)

他们还有没有时间限制的订阅服务

# .net - LINQ 有多快？

> ID：115851
> 
> 赞同：9
> 
> 时间：2008-09-22T16:20:13.723
> 
> 标签：.net, linq, linq-to-sql

我需要处理 100,000 - 200,000 条记录。
我正在考虑使用 LINQ (to SQL) 来做到这一点。
我从经验中知道过滤数据视图非常慢。
那么LINQ有多快呢？

您能否告诉我您的经验以及它是否值得使用，或者我最好使用 SQL 存储过程（繁重且不太灵活）？

在数千条记录中，我需要找到数据组然后对其进行处理，每组大约有 50 条记录。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-22T16:25:27.613

LINQ to SQL 将您的查询表达式转换为 T-SQL，因此您的查询性能应该与通过 ADO.NET 发送该 SQL 查询完全相同。我猜有一点开销，将查询的表达式树转换为等效的 T-SQL，但我的经验是，与实际查询时间相比，这很小。

您当然可以准确地找出生成的 T-SQL，因此请确保您有良好的支持索引。

与 DataViews 的主要区别在于 LINQ to SQL 不会将所有数据放入内存并在那里过滤。相反，它让数据库做它擅长的事情，并且只将匹配的数据带入内存。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-22T16:27:15.313

这取决于你想要做什么。LINQ 对我来说从数据库中提取数据的速度非常快，但是 LINQ-to-SQL 确实直接将您的请求转换为 SQL 来运行它。但是，有时我发现在某些情况下使用存储过程会更好。

例如，我有一些需要查询的数据，其中涉及多个表和相当密集的键。使用 LINQ，以及 LINQ 相对不灵活的自定义查询，这些查询将需要几分钟时间。通过手动调整 SQL（即，通过在 JOIN 中放置“WHERE”类型的参数以最小化 JOIN 的数据强度），我能够显着提高性能。

我的建议是，尽可能使用 LINQ，但如果您确定 LINQ 生成的 SQL 太慢，请不要害怕走存储过程路线，并且可以轻松地手动调整 SQL 以完成您需要的操作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T16:27:35.657

您需要更具体地说明操纵记录的含义。如果每条记录的更改不是 100% 单独的，并且可以基于集合进行更改，那么您很可能最好在数据库端（存储的过程）中在 T-SQL 中进行更改。换句话说，尽可能避免通过网络和/或进程边界提取大量数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T16:36:08.727

我发现 LINQ 生成的查询很好。在 linq 查询中实现了一些最佳实践，例如我们，来自所有者的前缀表名，避免 (*) 等等。当查询很复杂（不仅仅是简单的连接）时，我发现 linq 总能找到一个好的解决方案，而我的解决方案从来没有更好（所以我的 SQL 分析器说）。

那么问题是：直接查询更好......还是将查询包装到存储过程中？存储过程应该更好，因为存储了执行计划。但实际上，当您通过 .net sql server provider 进行选择时，您调用了一个特殊的存储过程，其中第一个参数是您的查询文本。然后无论如何都会缓存执行计划。

如果在您的商店中您进行了超过 1 种选择，则存储的 shuold 会更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T16:29:17.977

一段绳子有多长？LInq to SQL 的速度有多快。这取决于你如何使用它。

“过滤数据视图非常慢”，因为在此模型中您检索所有记录，然后在客户端进行过滤。但是 Linq to SQL 不能那样工作，除非你滥用它。

一个 Linq 查询只在它必须的最后一分钟被评估。因此，您可以在评估之前对查询添加“位置”限制。整个表达式，包括过滤器，将按原样在数据库上执行。

Stackoverflow 使用的是 Linq，它不是一个小数据库。

有些人会提倡存储过程通过 SQL 或 ORMS 访问您的数据库。这已在其他问题中进行了辩论。例如[这里](https://stackoverflow.com/questions/15142/what-are-the-pros-and-cons-to-keeping-sql-in-stored-procs-versus-code)和[这里](https://stackoverflow.com/questions/14530/linq-vs-stored-procedures)

我的观点是，对于某些事情，您需要专业的 DBA 来制作最佳的存储过程。然后，您可以根据需要从 Linq 访问它。但是 80% 或更多的数据库访问方法不会对性能至关重要，并且存储过程对于这些方法来说可能是非常耗时的。

对于更新，在存储过程或 sql 中使用“update ... where ...”的基于集合的服务器端操作将比使用多个数据库往返读取记录、写入记录、重复要快得多.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T18:58:21.660

值得牢记的是，LINQ to SQL 首先从数据库中检索对象，然后将属性更改应用于对象并调用 SubmitChanges 将它们持久化，然后每个行/对象都会发出必要的更新语句。

对于批量更新，这远没有一次只发送一条适用于整批行的更新语句那么有效。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-09-22T16:25:18.237

通常，对这么多记录的操作应该尽可能靠近数据库。如果它在我的任务中，我希望在存储过程中完成它。那是我个人。Linq 是数据访问之上的另一个抽象层，虽然它适用于“正常”需求，即发送到 UI 的数百个实体，但不应将其视为数据仓库类型操作的替代品。

# javascript - 声明 JS 脚本的语法

> ID：115862
> 
> 赞同：3
> 
> 时间：2008-09-22T16:22:02.317
> 
> 标签：javascript, scripting

我不确定打开 JS 脚本有什么区别

```
<SCRIPT language='JavaScript'> 
```

或与：

```
<SCRIPT type="text/JavaScript"> 
```

是否应该始终引用 JavaScript（用“”或“”）或者这不是很重要？

感谢您对此主题的任何澄清！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-22T16:27:42.287

在 HTML 3.2 中使用了 language 属性。HTML 4.0 引入了 type（这与引用外部媒体的其他元素一致，例如`<style>`）并使其成为必需。它还[弃用了](http://www.w3.org/TR/html401/conform.html#deprecated)语言。

使用[类型](http://www.w3.org/TR/html401/interact/scripts.html#adef-type-SCRIPT)。不要使用[语言](http://www.w3.org/TR/html401/interact/scripts.html#adef-language)。

[在 HTML（和 XHTML）中，使用单引号或双引号分隔的属性值](http://www.w3.org/TR/html401/intro/sgmltut.html#h-3.2.2)之间没有区别（除非您不能使用用于分隔值内部的字符而不用实体表示它）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T16:43:20.407

请参阅至尊神[Douglas Crockford 的 Javascript Code Conventions](http://javascript.crockford.com/code.html)了解所有关于 Javascript 的内容：

> JavaScript 文件
> 
> JavaScript 程序应存储在 .js 文件中并以 .js 文件的形式交付。
> 
> JavaScript 代码不应嵌入 HTML 文件中，除非该代码特定于单个会话。HTML 中的代码显着增加了页面重量，没有机会通过缓存和压缩来缓解。
> 
> <script src=filename.js> 标签应尽可能放在正文的最后。这减少了脚本加载对其他页面组件造成的延迟的影响。**无需使用语言或类型属性。决定 MIME 类型的是服务器，而不是脚本标签。**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T12:19:11.797

使用外部 JavaScript 文件时不需要 type 和 language 属性：

```
<script src="script.js" /> 
```

您的浏览器将根据文件的扩展名自动确定要执行的操作。不过，在执行脚本块时，您需要 type="text/javascript" 。

**编辑：**

有人可能会说这很糟糕，但这实际上是雅虎的话！网站负载性能方面的 JavaScript 传播者（我认为是 Douglas Crockford）。

也许我应该详细说明一下。

谷歌是在不破坏其网站呈现的情况下打破标准的一个很好的例子。（他们现在遵守 W3C 标准，使用 JavaScript 来呈现他们的页面）。由于他们网站上的负载很重，他们决定将标记减少到最低限度，并使用贬值的标签，如可怕的*字体*和*i*标签。

务实一点没有坏处。当然，在合理范围内:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T16:28:05.313

较旧的浏览器仅支持语言 - 现在使用 text/javascript 的 mimetype 的 type 方法是正确的方法。

```
<script language="javascript" type="text/javascript"> 
```

用于支持较旧的浏览器以及使用正确的方式。

```
<style type="text/css"> 
```

是使用正确标准包含某些内容（样式表）的另一个示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T16:34:25.750

根据[W3 HTML 4.01 参考](http://www.w3.org/TR/html4/interact/scripts.html#edef-SCRIPT)，只需要 type 属性。langage 属性不是参考的一部分，但我认为它来自微软与 Netscape 的较早时期。

此外，简单的引号在 XHTML 1.0 中无效（解析更加严格）。这可能不是问题，但您现在应该更好地[验证您的 html](http://validator.w3.org/)（HTML 4.01 或 XHTML 1.0）。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-22T16:22:36.213

两者都使用：

```
<script language="javascript" type="text/javascript"> 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-09-22T16:27:52.067

您应该始终将属性值括在引号 (") 中。不要使用撇号 (')。

**编辑**：让意见在这里听起来像事实，我的错。单引号在技术上是合法的，但根据我的经验，它们往往比双引号导致更多的问题（它们往往会更频繁地出现在属性值中）所以我总是建议坚持使用后者。您的里程可能会有所不同！

# python - 在python中将mysql时间戳转换为纪元时间

> ID：115866
> 
> 赞同：7
> 
> 时间：2008-09-22T16:22:16.403
> 
> 标签：python, mysql, time, timestamp

在python中将mysql时间戳转换为纪元时间 - 有没有简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-22T16:26:51.337

为什么不让 MySQL 做艰苦的工作呢？

```
select unix_timestamp(fieldname) from tablename; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-03-09T07:51:59.440

将mysql时间转换为纪元：

```
>>> import time
>>> import calendar
>>> mysql_time = "2010-01-02 03:04:05"
>>> mysql_time_struct = time.strptime(mysql_time, '%Y-%m-%d %H:%M:%S')
>>> print mysql_time_struct
(2010, 1, 2, 3, 4, 5, 5, 2, -1)
>>> mysql_time_epoch = calendar.timegm(mysql_time_struct)
>>> print mysql_time_epoch
1262401445 
```

将纪元转换为 MySQL 可以使用的东西：

```
>>> import time
>>> time_epoch = time.time()
>>> print time_epoch
1268121070.7
>>> time_struct = time.gmtime(time_epoch)
>>> print time_struct
(2010, 3, 9, 7, 51, 10, 1, 68, 0)
>>> time_formatted = time.strftime('%Y-%m-%d %H:%M:%S', time_struct)
>>> print time_formatted
2010-03-09 07:51:10 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-22T23:34:51.870

如果您出于某种原因不想让 MySQL 完成这项工作，那么您可以在 Python 中轻松完成这项工作。当你从 MySQLdb 中获取一个 datetime 列时，你会得到一个 Python datetime.datetime 对象。要转换其中之一，您可以使用 time.mktime。例如：

```
import time
# Connecting to database skipped (also closing connection later)
c.execute("SELECT my_datetime_field FROM my_table")
d = c.fetchone()[0]
print time.mktime(d.timetuple()) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T08:30:00.437

我使用类似以下的方法从 MySQL 日期（本地时间）获取纪元（UTC）以来的秒数：

```
calendar.timegm(
   time.gmtime(
      time.mktime(
         time.strptime(t, 
                       "%Y-%m-%d %H:%M:%S")))) 
```

此问题中的更多信息：[如何在 Python 中将本地时间转换为 UTC？](https://stackoverflow.com/questions/79797/how-do-i-convert-local-time-to-utc-in-python)

# c# - 如何使用 c# 获取当前活动窗口的标题？

> ID：115868
> 
> 赞同：122
> 
> 时间：2008-09-22T16:22:23.097
> 
> 标签：c#, .net, windows, winforms

我想知道如何使用 C# 获取当前活动窗口（即具有焦点的窗口）的窗口标题。

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2008-09-22T16:27:14.113

在此处查看有关如何使用完整源代码执行此操作的示例：

[http://www.csharphelp.com/2006/08/get-current-window-handle-and-caption-with-windows-api-in-c/](http://www.csharphelp.com/2006/08/get-current-window-handle-and-caption-with-windows-api-in-c/)

```
[DllImport("user32.dll")]
static extern IntPtr GetForegroundWindow();

[DllImport("user32.dll")]
static extern int GetWindowText(IntPtr hWnd, StringBuilder text, int count);

private string GetActiveWindowTitle()
{
    const int nChars = 256;
    StringBuilder Buff = new StringBuilder(nChars);
    IntPtr handle = GetForegroundWindow();

    if (GetWindowText(handle, Buff, nChars) > 0)
    {
        return Buff.ToString();
    }
    return null;
} 
```

* * *

**使用@Doug McClean 评论编辑以获得更好的正确性**。****

 *** * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-04-16T10:43:16.400

如果您在谈论 WPF，请使用：

```
 Application.Current.Windows.OfType<Window>().SingleOrDefault(w => w.IsActive); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2017-11-24T04:12:41.280

基于[GetForegroundWindow函数| 微软文档](https://msdn.microsoft.com/en-us/library/ms633505(VS.85).aspx)：

```
[DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
static extern IntPtr GetForegroundWindow();

[DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
static extern int GetWindowText(IntPtr hWnd, StringBuilder text, int count);

[DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
static extern int GetWindowTextLength(IntPtr hWnd);

private string GetCaptionOfActiveWindow()
{
    var strTitle = string.Empty;
    var handle = GetForegroundWindow();
    // Obtain the length of the text   
    var intLength = GetWindowTextLength(handle) + 1;
    var stringBuilder = new StringBuilder(intLength);
    if (GetWindowText(handle, stringBuilder, intLength) > 0)
    {
        strTitle = stringBuilder.ToString();
    }
    return strTitle;
} 
```

它支持 UTF8 字符。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-08-27T17:47:18.430

循环`Application.Current.Windows[]`并找到带有`IsActive == true`.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-22T16:25:30.780

使用 Windows API。打电话`GetForegroundWindow()`。

`GetForegroundWindow()`将为您提供`hWnd`活动窗口的句柄（名为 ）。

文档：[GetForegroundWindow 函数 | 微软文档](http://msdn.microsoft.com/en-us/library/ms633505(VS.85).aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-10-24T14:19:11.823

如果碰巧您需要***来自 MDI 应用程序的当前活动表单***：（MDI-多文档界面）。

```
Form activForm;
activForm = Form.ActiveForm.ActiveMdiChild; 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2015-09-14T05:53:13.883

你可以使用进程类，这很容易。使用这个命名空间

```
using System.Diagnostics; 
```

如果你想制作一个按钮来获得活动窗口。

```
private void button1_Click(object sender, EventArgs e)
    {            
       Process currentp = Process.GetCurrentProcess();
       TextBox1.Text = currentp.MainWindowTitle;  //this textbox will be filled with active window.
    } 
```

# sql - SQL Server、远程存储过程和 DTC 事务

> ID：115873
> 
> 赞同：4
> 
> 时间：2008-09-22T16:22:45.420
> 
> 标签：sql, sql-server, msdtc

我们的组织在大型机 Adabas 数据库中有很多基本数据。我们可以通过 ODBC 访问这些数据，并且 C# 已经使用 ODBC/Natural“存储过程”成功地查询/更新了它。

我们现在想做的是从 SQL Server 2005 存储过程中查询大型机表，将结果转储到表变量中，对其进行处理，然后将结果与本机 SQL 数据作为结果集连接起来。

当我们选择它时，从 SQL 执行 Natural proc 可以正常工作；但是，当我们将结果插入到表变量中时，SQL 似乎正在启动一个分布式事务，而这反过来又似乎对我们的连接造成了严重破坏。

鉴于我们没有执行更新，是否可以关闭此 DTC 升级行为？

有关正确设置 DTC 以与 DataDirect（以前的 Neon Systems）Shadow ODBC 驱动程序对话的任何提示？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-14T13:11:24.303

检查[`SET REMOTE_PROC_TRANSACTIONS OFF`](http://msdn.microsoft.com/en-us/library/ms178549(SQL.90).aspx)哪个应该禁用它。或者[`sp_serveroption`](http://msdn.microsoft.com/en-us/library/ms178532.aspx)一般配置链接服务器，而不是每批。

因为您是在 MS SQL 端编写的，所以您启动了一个事务。默认情况下，它会升级是否需要。即使表变量不参与事务。

我之前也遇到过类似的问题，MS SQL 端的行为会根据 MS SQL 是否写入、存储过程和其他内容而有所不同。我发现最可靠的方法是对我的 Sybase 链接服务器使用动态 SQL 调用......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-04-24T20:21:24.513

以下代码为链接服务器设置“启用分布式事务促进”：

```
USE [master]
GO
EXEC master.dbo.sp_serveroption @server=N'REMOTE_SERVER', @optname=N'remote proc transaction promotion', @optvalue=N'false'
GO 
```

这将允许您将链接服务器存储过程调用的结果插入到表变量中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T20:02:44.733

确实如此。您可能会猜到，我们要调用的 Natural 过程会进行查找和计算，如果可能的话，我们希望保持在该级别。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T18:25:28.447

我不确定 DTC，但 DTSX（集成服务）可能对移动数据有用。但是，如果您可以简单地查询数据，则可能需要考虑添加链接服务器以进行直接访问。然后，您可以只编写一个简单的查询来根据链接服务器表中的选择来填充您的表。

# windows - 从给定的文件路径获取有关物理设备的信息

> ID：115874
> 
> 赞同：3
> 
> 时间：2008-09-22T16:23:07.353
> 
> 标签：windows, file, path

假设您有系统上可访问文件或文件夹的完整路径。如何获得文件（或文件夹）实际所在的物理设备的某种唯一标识符？

我的第一次尝试是使用`System.IO.DriveInfo`取决于有驱动器号的。但是 UNC 路径和映射到服务器上同一物理设备的多个网络驱动器增加了一些复杂性。例如，这 3 个路径都指向同一设备上的同一文件夹。

```
\\myserver\users\brian\public\music\
s:\users\brian\public\music\          (here s:\ is mapped to \\myserver\)
u:\public\users\music\                (here u:\ is mapped to \\myserver\users\brian\) 
```

最终我的目标是采用这些多条路径并报告每个设备上已用和可用磁盘空间的数量。我想将这 3 个路径组合成报告中的一个项目，而不是 3 个单独的项目。

在给定任意完整路径的情况下，是否有任何 Windows API 可以帮助查找此信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T16:40:40.523

这个 win API 调用应该可以为您提供有关磁盘空间的信息

```
 GetDiskFreeSpaceEx 
```

[http://msdn.microsoft.com/en-us/library/aa364937(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa364937(VS.85).aspx)

此外，要确定这三个映射是否都来自同一个物理磁盘，请调用

```
GetVolumeInformation 
```

并比较返回的卷序号

[http://msdn.microsoft.com/en-us/library/aa364993(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa364993(VS.85).aspx)

# windows-xp - 你如何处理大量的小文件？

> ID：115882
> 
> 赞同：29
> 
> 时间：2008-09-22T16:24:20.080
> 
> 标签：windows-xp, filesystems, ntfs

我正在开发的产品每天收集数千个读数，并将它们作为 64k 二进制文件存储在 NTFS 分区 (Windows XP) 上。经过一年的生产，单个目录中有超过 300000 个文件，并且数量还在不断增长。这使得从 Windows 资源管理器访问父/祖先目录非常耗时。

我试过关闭索引服务，但没有任何区别。我还考虑将文件内容移动到数据库/zip 文件/tarball 中，但单独访问这些文件对我们是有益的；基本上，这些文件仍然需要用于研究目的，研究人员不愿意处理其他任何事情。

有没有办法优化 NTFS 或 Windows 以便它可以处理所有这些小文件？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-24T18:14:43.043

只要您告诉 NTFS 停止创建与 16 位 Windows 平台兼容的替代文件名，NTFS 实际上可以很好地处理目录中超过 10,000 个文件。默认情况下，NTFS 会自动为每个创建的文件创建一个“8 点 3”文件名。当目录中有许多文件时，这会成为一个问题，因为 Windows 会查看目录中的文件以确保它们创建的名称尚未被使用。您可以通过将 NtfsDisable8dot3NameCreation 注册表值设置为 1 来禁用“8 点 3”命名。该值位于 HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\FileSystem 注册表路径中。进行此更改是安全的，因为只有为非常旧的 Windows 版本编写的程序才需要“8 点 3”名称文件。

此设置需要重新启动才能生效。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-22T16:29:51.987

目录中有 10,000 个文件后，NTFS 性能会严重下降。您所做的是在目录层次结构中创建一个附加级别，每个子目录有 10,000 个文件。

值得一提的是，这是 SVN 人员在[1.5 版本](http://subversion.tigris.org/svn_1.5_releasenotes.html#fsfs-sharding)中采用的方法。他们使用 1,000 个文件作为默认阈值。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-22T16:33:15.317

性能问题是由单个目录中的大量文件引起的：一旦消除它，就应该没问题。这不是特定于 NTFS 的问题：事实上，在大型 UNIX 系统上的用户主目录/邮件文件中经常会遇到这种问题。

解决此问题的一种明显方法是将文件移动到名称基于文件名的文件夹中。假设您所有的文件都有类似长度的文件名，例如 ABCDEFGHI.db、ABCEFGHIJ.db 等，请创建如下目录结构：

```
ABC\
    DEF\
        ABCDEFGHI.db
    EFG\
        ABCEFGHIJ.db 
```

使用这种结构，您可以根据文件名快速定位文件。如果文件名具有可变长度，请选择最大长度，并在前面加上零（或任何其他字符）以确定文件所属的目录。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-22T16:27:55.517

在过去，我已经看到了巨大的改进，例如通过文件名的第一个然后第二个字母将文件拆分为嵌套的目录层次结构；那么每个目录不包含过多的文件。然而，操作整个数据库仍然很慢。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-22T16:27:36.467

如果您可以计算文件的名称，则可以按日期将它们分类到文件夹中，以便每个文件夹仅包含特定日期的文件。您可能还想创建月份和年份层次结构。

此外，您能否将超过一年的文件移动到不同（但仍可访问）的位置？

最后，再一次，这要求您能够计算名称，您会发现直接访问文件比尝试通过资源管理器打开文件要快得多。例如，从命令行说
*notepad.exe "P:\ath\to\your\filen.ame"*
实际上应该很快，假设您知道所需文件的路径而无需获取目录列表。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-22T16:31:47.270

您可以尝试使用 Solid File System 之类的东西。

这为您提供了一个虚拟文件系统，应用程序可以像挂载物理磁盘一样挂载该文件系统。您的应用程序会看到很多小文件，但硬盘上只有一个文件。

[http://www.eldos.com/solfsdrv/](http://www.eldos.com/solfsdrv/)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-22T16:44:23.387

我过去多次遇到这个问题。我们尝试按日期存储，将文件压缩到日期以下，这样您就不会有很多小文件等。所有这些都是针对将数据作为大量小文件存储在 NTFS 上的真正问题的创可贴。

您可以转到 ZFS 或其他可以更好地处理小文件的文件系统，但仍然要停下来询问您是否需要存储小文件。

在我们的例子中，我们最终进入了一个系统，即某个日期的所有小文件都以 TAR 类型的方式附加，并带有简单的分隔符来解析它们。磁盘文件从 120 万个减少到几千个。它们实际上加载得更快，因为 NTFS 不能很好地处理小文件，而且驱动器能够更好地缓存 1MB 文件。在我们的案例中，与存储文件的实际存储和维护相比，找到文件正确部分的访问和解析时间最少。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-22T16:29:06.450

一个常见的技巧是简单地创建一些子目录并将文件分开。

例如，Doxygen 是一个可以生成大量 html 页面的自动化代码文档程序，它可以选择创建两级深度目录层次结构。然后这些文件均匀分布在底部目录中。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-22T16:41:30.583

在一个目录中拥有数十万个文件确实会削弱 NTFS，而您对此无能为力。您应该重新考虑以更实用的格式存储数据，例如一个大的压缩包或数据库。

如果你真的需要为每个读数单独的文件，你应该将它们分类到几个子目录中，而不是将它们都放在同一个目录中。您可以通过创建目录层次结构并根据文件名将文件放在不同的目录中来做到这一点。这样，您仍然可以只知道文件名来存储和加载文件。

我们使用的方法是取文件名的最后几个字母，将它们反转，并从中创建一个字母的目录。例如，考虑以下文件：

```
1.xml
24.xml
12331.xml
2304252.xml 
```

您可以将它们分类到目录中，如下所示：

```
data/1.xml
data/24.xml
data/1/3/3/12331.xml
data/2/5/2/4/0/2304252.xml 
```

此方案将确保您在每个目录中的文件永远不会超过 100 个。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-22T16:30:49.877

除了将文件放在子目录中..

就个人而言，我会开发一个应用程序来保持该文件夹的界面相同，即所有文件都显示为单独的文件。然后在应用程序后台实际获取这些文件并将它们组合成一个更大的文件（并且由于大小始终为 64k，因此获取所需的数据应该相对容易）以摆脱您所拥有的混乱。

因此，您仍然可以让他们轻松访问他们想要的文件，还可以让您更好地控制所有内容的结构。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-22T16:27:40.133

考虑将它们推送到另一台服务器，该服务器使用对大量小文件更友好的文件系统（例如 Solaris w/ZFS）？

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-22T16:31:50.873

如果数据有任何有意义的、分类的方面，您可以将它们嵌套在目录树中。我相信减速是由于一个目录中的文件数量，而不是文件本身的数量。

最明显的一般分组是按日期，并为您提供三层嵌套结构（年、月、日），每个叶目录中的文件数量（1-3k）具有相对安全的界限。

即使您能够提高文件系统/文件浏览器的性能，听起来这也是您将在 2 年或 3 年内遇到的问题......只需查看 0.3-1 百万个文件的列表就会产生成本，因此从长远来看，找到仅查看较小文件子集的方法可能会更好。

使用“find”之类的工具（在 cygwin 或 mingw 下）可以使浏览文件时不存在子目录树的问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-22T16:37:09.143

每天使用时间戳重命名文件夹。

如果应用程序将文件保存到 c:\Readings，则设置计划任务以在午夜重命名 Reading 并创建一个新的空文件夹。

然后，您将每天获得一个文件夹，每个文件夹包含数千个文件。

您可以将该方法进一步扩展为按月分组。例如，C:\Reading 变为 c:\Archive\September\22。

您必须注意时间安排，以确保在产品保存到文件夹时不会尝试重命名文件夹。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-02-23T22:14:11.243

要创建一个可以扩展到大量未知文件的文件夹结构，我喜欢以下系统：

将文件名拆分为固定长度的片段，然后为除最后一个片段之外的每个片段创建嵌套文件夹。

该系统的优点是文件夹结构的深度仅与文件名的长度一样深。因此，如果您的文件是按数字序列自动生成的，那么结构就很深了。

```
12.jpg -> 12.jpg
123.jpg -> 12\123.jpg
123456.jpg -> 12\34\123456.jpg 
```

这种方法确实意味着文件夹包含文件和子文件夹，但我认为这是一个合理的权衡。

这是一个*漂亮*的PowerShell 单线器，可助您一臂之力！

```
$s = '123456'

-join  (( $s -replace '(..)(?!$)', '$1\' -replace '[^\\]*$','' ), $s ) 
```

# windows-mobile - PocketPC - 将 VT_DATE 转换为不变的 VT_BSTR

> ID：115916
> 
> 赞同：0
> 
> 时间：2008-09-22T16:28:03.517
> 
> 标签：windows-mobile, culture, pocketpc

我正在尝试将 VARIANT 从 VT_DATE 转换为**不变**的VT_BSTR。以下代码适用于 Windows XP：

```
VARIANT va;
::VariantInit(&va);

// set the variant to VT_DATE
SYSTEMTIME st;
memset(&st, 0, sizeof(SYSTEMTIME));
st.wYear = 2008;
st.wMonth = 9;
st.wDay = 22;
st.wHour = 12;
st.wMinute = 30;

DATE date;
SystemTimeToVariantTime(&st, &date);

va.vt = VT_DATE;
va.date = date;

// change to a string
err = ::VariantChangeTypeEx(&va, 
                &va, 
                LOCALE_INVARIANT, 
                0, 
                VT_BSTR); 
```

但在 PPC 2003 和 Windows Mobile 5 上，上述代码返回 E_FAIL。有人可以更正上述代码或提供替代方法吗？

**编辑**：将日期转换为字符串后，我使用字符串进行 SQL 更新。无论设备的区域设置如何，我都希望更新能够正常工作，这就是我尝试将其转换为“不变”格式的原因。

我现在使用以下方法将日期转换为似乎可以使用的格式：

```
err = ::VariantTimeToSystemTime(va.date, &time);
if (FAILED(err))
    goto cleanup;

err = strDate.PrintF(_T("%04d-%02d-%02d %02d:%02d:%02d.%03d"),
    time.wYear,
    time.wMonth,
    time.wDay,
    time.wHour,
    time.wMinute,
    time.wSecond,
    time.wMilliseconds); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T15:32:35.593

*(I'm sorry it's taken me a while to respond ('work', you know...))*

I don't see anything wrong with the code, from the COM point of view.

Maybe the problem is with LOCALE_INVARIANT. It was introduced with Windows XP; maybe it's not supported in the Windows CE family?

Try changing the locale to **LOCALE_USER_DEFAULT** and check to see if you still get an error. Most of the time this would be the most appropriate locale anyway; especially if you are trying to display the value to the user.

If you truly need a specific format because you need to pass the value somewhere else that will parse it, try using a specific locale that matches your requirements; perhaps en_US.

Please let us know how it goes.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T03:33:16.353

这不是一个真正的答案，但是将日期更改为字符串*不是*区域设置不变的任务 - 它高度依赖于区域设置。在这种情况下，我会将 Variant Time 转换为 System Time，然后使用 sprintf 样式的函数将其转换为字符串

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T13:31:00.580

在您的上下文中不确定，但似乎您走错了路。为什么不使用[VarBstrFromDate](http://msdn.microsoft.com/en-us/library/ms891320.aspx)？这 aloows 使用一个语言环境（或可选地忽略一个），并且可能更接近你想要的。

# .net - 在 .NET 中使线程向另一个线程发出信号的最佳方法是什么？

> ID：115928
> 
> 赞同：10
> 
> 时间：2008-09-22T16:29:54.217
> 
> 标签：.net, multithreading, signals

如果用户希望中断执行，我需要另一个线程信号，但是我不确定如何实现信号/信号检查机制。我不想在我的项目中有一个单例（比如 global `bool`），但是有没有其他选择？

在[这个线程](https://stackoverflow.com/questions/34151/c-thread-question-setting-a-value-to-indicate-the-thread-has-finished)中，人们建议在 C++ 中使用适当的结构，但我不知道 .NET 中有任何类似的东西。有人可以解释一下吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T16:35:59.740

试试[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)。它支持进度更新和取消正在运行的任务。

如果您希望一个线程等到另一个线程完成它的工作，那么 Monitor.Wait 和 Monitor.Pulse 都很好，ManualResetEvent 也是如此。但是，这些对于取消正在运行的任务并没有任何用处。

如果你想编写自己的取消代码，你可以在某个地方有一个两个线程都可以访问的字段。将其标记为 volatile，例如：

```
private volatile bool cancelling; 
```

让主线程将其设置为 true，并让工作线程定期检查它并在完成后将其设置为 false。

这与拥有一个“全局变量”并没有真正的可比性，因为您仍然可以将信号量变量的范围限制为类私有。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T16:33:39.043

有点模糊（时间短），但请查看[ManualResetEvent 和 AutoResetEvent](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx)。您可能还想查找 Monitor 和 lock 关键字。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T16:44:39.890

查看 Monitor.Wait 和 Monitor.Pulse。这是一篇关于 .Net 中的线程的优秀文章（非常易读）：[http ://www.albahari.com/threading/part4.aspx](http://www.albahari.com/threading/part4.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T16:53:23.100

一个简单的解决方案，如同步的静态布尔值，应该是您所需要的，而不是基于框架的解决方案，这对于您的场景来说是多余的。如果您仍然需要一个框架，请查看[.NET 的并行扩展以](http://blogs.msdn.com/pfxteam/archive/tags/Parallel+Extensions/default.aspx)获得想法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T17:46:03.957

这取决于您需要什么样的同步。如果您希望能够在循环中运行线程直到达到某种执行结束 - 您只需要一个静态 bool 变量。如果您希望一个线程等待另一个线程到达执行点，您可能需要使用 WaitEvents（AutoResetEvent 或 ManualResetEvent）。如果您需要等待多个 waitHandle，您可以使用 WaitHandle.WaitAll 或 WaitHandle.WaitAny。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-22T16:31:06.367

查看 System.Runtime.Remoting 命名空间。

# user-interface - 糟糕的用户界面设计？网站左上角有两个标志？

> ID：115930
> 
> 赞同：0
> 
> 时间：2008-09-22T16:30:27.333
> 
> 标签：user-interface, graphical-logo

好吧，当某些用户希望在网站的左上角有两个徽标时，我目前正在做一些 UI 模型的项目。一个是表明该网站是关于什么的，另一个是表明该网站实际上属于该特定领域。

我认为明智的 UI 设计非常糟糕，因为左上角有两个徽标。如果用户最初进入，他将无法知道哪个徽标意味着什么。

您对此有何看法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T16:35:17.103

这听起来确实相当令人困惑，尽管它可能取决于徽标的内容是否难以弄清楚。

我建议让没有使用该站点的人查看模型并了解他们的想法（无需指导）......即一些可用性测试。

看看[Steve Krug 的 Don't Make Me Think](https://rads.stackoverflow.com/amzn/click/com/0321344758) ...你会想在你读完之后马上做一些测试，他详细介绍了当你被那些不这样做的人拉向错误的方向时该怎么做t 真正了解该决定的后果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T16:40:16.377

当然，这纯粹是主观的，它取决于徽标和网站其余部分的设计？

我想不出任何例子，但我确信我已经看到多个徽标在一个地方过得很愉快。也就是说，我确定我已经看到一个标志看起来完全是垃圾......

这取决于您的设计和徽标。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T16:37:36.537

如果两个徽标具有相同级别的视觉优势，则可能会出现问题，但是如果您使一个看起来从属于另一个，那应该没问题。您可以通过大小、颜色饱和度和/或相对位置（一个可以在另一个的角落）来改变它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T16:38:18.033

我看到的唯一地方是布鲁斯新闻。我不太喜欢

[http://www.bluesnews.com/](http://www.bluesnews.com/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T16:32:02.307

在我看来这很合理。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T16:34:04.423

我认为您需要与您的客户会面，并向他们解释其中一些客户可能存在的潜在困惑。然后提出一个你们都同意的解决方案。适合网站流程的东西，并且仍然呈现您的客户要求显示的信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T16:35:28.960

我认为代表该部门的徽标要么具有柔和的性质（柔和的颜色以免分散主徽标的注意力），要么会位于页面上的其他位置（侧边栏或页脚）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T16:36:15.887

看起来还不算太糟糕。两个标志的大小一样吗？

假设公司 ABC 有一个子公司 Alpha。我认为在徽标中使用 ABC（尽管字体较小）与 Alpha 使用更占主导地位的字体是完全可以的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-22T16:36:16.993

您是否需要为特定部门定制主要标志？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-05T23:12:32.113

我认为您需要找到其他一些用户，去喝醉

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T16:33:07.187

听起来取决于我的实施。

# c# - Linq to SQL 分组子关系

> ID：115955
> 
> 赞同：2
> 
> 时间：2008-09-22T16:34:25.623
> 
> 标签：c#, .net, linq, linq-to-sql

我正在尝试运行 LINQ to SQL 查询，该查询在搜索引擎样式列表的网格视图中返回结果。

在下面的简化示例中，是否可以在单个查询中使用父级 (NAMESOFCHILDREN) 的任何子级的逗号分隔列表填充集合？

```
var family = from p in db.Parents
             where p.ParentId == Convert.ToInt32(Request.QueryString["parentId"])
             join pcl in db.ParentChildLookup on p.ParentId equals pcl.ParentId
             join c in db.Children on pcl.ChildId equals c.ChildId
             select new
             {
                 Family = "Name: " + p.ParentName + "<br />" + 
                          "Children: " + NAMESOFCHILDREN? + "<br />"
             }; 
```

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T16:36:11.067

你的加入会搞砸你的基数！你没有父母名单！

这是一些未经测试的徒手代码。在 Linq 设计器中添加关系可为您提供关系属性。String.Join 会将列表放在一起。

我添加了两个可选的方法调用。

*Where ... Any* 会将父母过滤到只有那些有孩子的父母。我不确定 string.Join 在空数组上的行为。

*ToList*将把父母拉到内存中，孩子将被进一步的数据库调用访问。如果您获得运行时字符串，这可能是必要*的。SQL 翻译器*异常不支持加入。此异常意味着 LINQ 尝试将方法调用转换为 SQL Server 可以理解的内容 - 但失败了。

```
int parentID = Convert.ToInt32(Request.QueryString["parentId"]);

List<string> result =
  db.Parents
  .Where(p => p.ParentId == parentID)
  //.Where(p => p.ParentChildLookup.Children.Any())
  //.ToList()
  .Select(p => 
    "Name: " + p.ParentName + "<br />" + 
    "Children: " + String.Join(", ", p.ParentChildLookup.Children.Select(c => c.Name).ToArray() + "<br />"
)).ToList(); 
```

另请注意：通常在数据正确转义以进行标记之前，您不希望混合数据和标记。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T16:43:56.867

你可以尝试如下：

```
var family = from p in db.Parents            
     where p.ParentId == Convert.ToInt32(Request.QueryString["parentId"])             
    join pcl in db.ParentChildLookup on p.ParentId equals pcl.ParentId             
     select new             {                 
        Family = "Name: " + p.ParentName + "<br />" + string.Join(",",(from c in db.Children where c.ChildId equals pcl.ChildId  select c.ChildId.ToString()).ToArray());
    }; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-08T15:07:39.283

用 发布一个老问题的答案`groupby`。下面的查询将产生公司名称、订单数量和订单 ID，以逗号分隔，来自 Northwind。

```
var query = from c in north.Customers
                    join o in north.Orders on c.CustomerID equals o.CustomerID
                    select new { c, o };

        var query2 = from q in query
                     group q.o by q.c into g
                     select new { CompanyName = g.Key.CompanyName, 
                                orderCount = g.Count(), 
                                orders = string.Join(",", g.Select(o => o.OrderID)) }
                     into result
                         orderby result.orderCount descending
                     select result; 
```

# java - 从所需的 .class 文件间接引用

> ID：115971
> 
> 赞同：41
> 
> 时间：2008-09-22T16:38:01.170
> 
> 标签：java, eclipse, weblogic

当我尝试在 Eclipse 中构建我的项目时，我收到一条错误消息：

`The type weblogic.utils.expressions.ExpressionMap cannot be resolved. It is indirectly referenced from required .class files`

我在网上寻找解决方案，但找不到（除了那些让您付费寻求帮助的网站）。任何人都知道如何解决这个问题？任何帮助表示赞赏，谢谢！

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-22T16:44:20.717

您如何将 Weblogic 类添加到 Eclipse 的类路径中？您是否使用 WTP 和服务器运行时？如果是这样，您的服务器运行时是否与您的项目相关联？

如果您右键单击您的项目并选择构建`path->configure`构建路径，然后选择库选项卡。您应该在此处看到关联的 weblogic 库。如果没有，您可以单击`Add Library->Server Runtime`。如果该库不存在，那么您首先需要对其进行配置。 `Windows->Preferences->Server->Installed runtimes`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-06-06T04:41:01.607

添加 spring-tx jar 文件，它应该解决它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T16:42:41.017

你用谷歌搜索过“weblogic ExpressionMap”吗？你知道它是什么以及它做什么吗？

看起来您肯定需要与 Weblogic 一起编译，并且如果您还没有在 Eclipse 类路径中包含 Weblogic 的 jars 的话。

如果您还没有使用 Weblogic，那么您需要找出世界上是什么在引用它。您可能需要对您的 jar、类文件和/或源文件进行一些繁重的 grepping，以查找哪些包含字符串“weblogic”。

如果我必须包含一些依赖于这个 Weblogic 类但不能使用 Weblogic 的东西，我会很想尝试对兼容的类进行逆向工程。创建自己的 weblogic.utils.expressions.ExpressionMap 类；看看一切是否编译；在编译时或运行时使用任何产生的错误或警告来为您提供有关此类中需要哪些方法和其他成员的线索。如果可能，请制作不执行任何操作或返回 null 的存根方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-11-05T15:58:07.580

发生此问题是因为很少有 jar 从其他 jar 获取引用并且缺少引用 jar。

示例：Spring 框架

```
Description Resource    Path    Location    Type
The project was not built since its build path is incomplete. Cannot find the class file for org.springframework.beans.factory.annotation.Autowire. Fix the build path then try building this project   SpringBatch     Unknown Java Problem 
```

在这种情况下，缺少“org.springframework.beans.factory.annotation.Autowire”。

```
Spring-bean.jar is missing 
```

在类路径中添加依赖项后，问题就会解决。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2015-01-08T11:02:57.903

我收到了这个错误：

> com.ibm.portal.state.exceptions.StateException 类型无法解析。它是从所需的 .class 文件中间接引用的

执行以下操作为我修复了它：

属性 -> Java 构建路径 -> 库 -> 服务器库 [wps.base.v61]unbound -> WAS 7 上的 Websphere Portal v6.1 -> 完成 -> 确定

# python - 在 Linux 中守护 Python 脚本的最简单方法是什么？

> ID：115974
> 
> 赞同：10
> 
> 时间：2008-09-22T16:39:09.670
> 
> 标签：python, scripting, daemon

在 Linux 中守护 Python 脚本的最简单方法是什么？我需要它适用于各种 Linux，所以它应该只使用基于 python 的工具。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-22T16:47:31.380

请参阅[Stevens](http://www.kohala.com/start/)以及[关于 activestate 的这个冗长的线程](http://code.activestate.com/recipes/278731/)，我个人发现它大多是不正确的并且非常冗长，我想出了这个：

```
from os import fork, setsid, umask, dup2
from sys import stdin, stdout, stderr

if fork(): exit(0)
umask(0) 
setsid() 
if fork(): exit(0)

stdout.flush()
stderr.flush()
si = file('/dev/null', 'r')
so = file('/dev/null', 'a+')
se = file('/dev/null', 'a+', 0)
dup2(si.fileno(), stdin.fileno())
dup2(so.fileno(), stdout.fileno())
dup2(se.fileno(), stderr.fileno()) 
```

如果您需要再次停止该进程，则需要知道 pid，通常的解决方案是 pidfiles。如果您需要，请执行此操作

```
from os import getpid
outfile = open(pid_file, 'w')
outfile.write('%i' % getpid())
outfile.close() 
```

出于安全原因，您可以在妖魔化后考虑其中任何一个

```
from os import setuid, setgid, chdir
from pwd import getpwnam
from grp import getgrnam
setuid(getpwnam('someuser').pw_uid)
setgid(getgrnam('somegroup').gr_gid)
chdir('/') 
```

您也可以使用[nohup](http://en.wikipedia.org/wiki/Nohup)但这不适用于[python 的 subprocess 模块](http://docs.python.org/lib/module-subprocess.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T16:41:18.137

[诺哈普](http://en.wikipedia.org/wiki/Nohup)

[以 Python 方式创建守护进程](http://code.activestate.com/recipes/278731/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-31T05:43:08.863

我最近使用了[土库曼巴什](http://pypi.python.org/pypi/Turkmenbashi/1.0.0.01)：

```
$ easy_install turkmenbashi
import Turkmenbashi

class DebugDaemon (Turkmenbashi.Daemon):

    def config(self):
        self.debugging = True

    def go(self):
        self.debug('a debug message')
        self.info('an info message')
        self.warn('a warning message')
        self.error('an error message')
        self.critical('a critical message')

if __name__=="__main__":
    d = DebugDaemon()
    d.config()
    d.setenv(30, '/var/run/daemon.pid', '/tmp', None)
    d.start(d.go) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T19:58:20.313

如果您不关心实际讨论（这往往会偏离主题并且不提供权威响应），您可以选择一些让您更轻松的库。我建议看一下[ll-xist](http://www.livinglogic.de/Python/Download.html)，这个库包含大量挽救生命的代码，比如 cron 作业助手、守护程序框架和（你不感兴趣的，但真的很棒）*面向对象的 XSL*（ ll-存在本身）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T16:57:14.277

使用[grizzled.os.daemonize](http://www.clapper.org/software/python/grizzled/)：

```
$ easy_install grizzled

>>> from grizzled.os import daemonize
>>> daemon.daemonize() 
```

要了解其工作原理或自己动手，请阅读[有关 ActiveState 的讨论](http://code.activestate.com/recipes/278731/)。

# python - 在 Django 中使用 Pylint

> ID：115977
> 
> 赞同：150
> 
> 时间：2008-09-22T16:39:34.677
> 
> 标签：python, django, static-analysis, pylint

我非常想将[pylint](http://www.logilab.org/857)集成到我的 python 项目的构建过程中，但我遇到了一个问题：我发现非常有用的错误类型之一——：——`E1101: *%s %r has no %r member*`使用常见 django 字段时会不断报告错误， 例如：

```
E1101:125:get_user_tags: Class 'Tag' has no 'objects' member 
```

这是由以下代码引起的：

```
def get_user_tags(username):
   """
   Gets all the tags that username has used.

   Returns a query set.
   """
   return Tag.objects.filter(  ## This line triggers the error.
       tagownership__users__username__exact=username).distinct()

# Here is the Tag class, models.Model is provided by Django:
class Tag(models.Model):
   """
   Model for user-defined strings that help categorize Events on
   on a per-user basis.
   """
   name = models.CharField(max_length=500, null=False, unique=True)

   def __unicode__(self):
       return self.name 
```

如何调整 Pylint 以正确考虑对象等字段？（我也查看了 Django 源代码，但我一直无法找到 的实现`objects`，所以我怀疑它不仅仅是一个类字段。另一方面，我对 python 还很陌生，所以我很可能忽略了一些东西。）

**编辑：**我发现告诉 pylint 不对这些警告发出警告的唯一方法是阻止所有类型 (E1101) 的错误，这是不可接受的解决方案，因为（在我看来）这是一个非常有用的错误。如果有另一种方法，而不增加 pylint 源，请指出具体细节:)

有关我遇到的问题的摘要，请参见[此处](http://creswick.github.io/blog/2008/09/05/wrestling-python/)`pychecker`，并且`pyflakes`- 它们已被证明对于一般用途而言远非不稳定。（在 pychecker 的情况下，崩溃源于 pychecker 代码——而不是它正在加载/调用的源代码。）

* * *

## 回答 #1

> 赞同：169
> 
> 时间：2015-06-23T10:47:45.510

不要通过添加`ignores`或来禁用或削弱 Pylint 功能`generated-members`。
使用**理解**Django 的积极开发的 Pylint 插件。
[这个 Django 的 Pylint 插件](https://github.com/landscapeio/pylint-django)运行良好：

```
pip install pylint-django 
```

并在运行 pylint 时将以下标志添加到命令中：

```
--load-plugins pylint_django 
```

详细的博文在[这里](https://blog.landscape.io/using-pylint-on-django-projects-with-pylint-django.html)。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2009-09-12T22:21:47.310

我使用以下内容：`pylint --generated-members=objects`

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2017-12-12T14:09:20.387

如果您使用 Visual Studio Code，请执行以下操作：

`pip install pylint-django`

并添加到 VSC 配置：

```
"python.linting.pylintArgs": [
    "--load-plugins=pylint_django"
], 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2010-11-12T08:59:11.543

我的 ~/.pylintrc 包含

```
[TYPECHECK]
generated-members=REQUEST,acl_users,aq_parent,objects,_meta,id 
```

最后两个是专门为 Django 设计的。

请注意，[PyLint 0.21.1](http://www.logilab.org/ticket/28796)中存在一个需要修补才能使其正常工作的错误。

编辑：在搞砸了这个之后，我决定稍微破解一下 PyLint，让我将上面的内容扩展为：

```
[TYPECHECK]
generated-members=REQUEST,acl_users,aq_parent,objects,_meta,id,[a-zA-Z]+_set 
```

我只是补充说：

```
 import re
    for pattern in self.config.generated_members:
        if re.match(pattern, node.attrname):
            return 
```

在错误报告中提到的修复之后（即第 129 行）。

快乐的时光！

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2010-03-16T17:00:16.963

[django-lint 是一个很好的工具，它使用 django 特定设置包装 pylint： http](http://chris-lamb.co.uk/projects/django-lint/) ://chris-lamb.co.uk/projects/django-lint/

github项目：[https ://github.com/lamby/django-lint](https://github.com/lamby/django-lint)

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-09-22T16:46:00.760

由于 pylint 的工作方式（它检查源本身，而不让 Python 实际执行它），pylint 很难弄清楚元类和复杂基类如何实际影响类及其实例。'pychecker' 工具在这方面要好一些，因为它*确实*让 Python 执行代码；它导入模块并检查生成的对象。但是，这种方法还有其他问题，因为它确实让 Python 执行代码:-)

你可以扩展 pylint 来教它 Django 使用的魔法，或者让它更好地理解元类或复杂的基类，或者在检测到它不太理解的一个或多个特性后忽略这种情况。我认为这不会特别容易。您也可以通过源代码、命令行选项或 .pylintrc 文件中的特殊注释告诉 pylint 不要警告这些事情。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-22T20:12:40.373

我放弃使用 pylint/pychecker 转而使用带有 Django 代码的 pyflakes - 它只是尝试导入模块并报告它发现的任何问题，例如未使用的导入或未初始化的本地名称。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-23T00:17:58.663

这不是一个解决方案，但您可以在`objects = models.Manager()`不改变任何行为的情况下添加到您的 Django 模型中。

我自己只使用 pyflakes，主要是由于我在 pylint 中的一些愚蠢的默认设置和懒惰（不想查找如何更改默认设置）。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-22T16:50:09.160

尝试运行 pylint

```
pylint --ignored-classes=Tags 
```

如果可行，请添加所有其他 Django 类 - 可能使用脚本，例如 python :P

的文档`--ignore-classes`是：

> `--ignored-classes=<members names>`
> 不应检查其成员属性的类名称列表（对于动态设置属性的类很有用）。[当前：%default]

我应该补充一点，在我看来，这不是一个特别优雅的解决方案，但它应该可以工作。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-02-24T12:48:37.580

在这个[其他问题](https://stackoverflow.com/questions/3509599/can-an-api-tell-pylint-not-to-complain-in-the-client-code)中提出的解决方案只需将**get_attr**添加到您的 Tag 类中。丑陋，但有效。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-06-14T12:40:38.173

用于`neovim & vim8`使用`w0rp's ale`插件。如果您已正确安装所有内容，包括`w0rp's ale`, `pylint`& `pylint-django`。在您`vimrc`添加以下行并享受使用 django 开发 Web 应用程序的乐趣。谢谢。

```
let g:ale_python_pylint_options = '--load-plugins pylint_django' 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-04T11:37:48.100

到目前为止，我还没有找到真正的解决方案，但可以解决：

*   在我们公司，我们要求 pylint 分数 > 8。这允许 pylint 不理解的编码实践，同时确保代码不太“不寻常”。到目前为止，我们还没有看到 E1101 使我们无法达到 8 分或更高分的情况。
*   我们的 'make check' 目标过滤掉“for has no 'objects' member” 消息，以消除由于 pylint 不理解 Django 造成的大部分干扰。

# javascript - Flash：从浏览器中的另一个选项卡返回，可以 Flash 听返回到某种类型的选项卡事件吗？

> ID：115979
> 
> 赞同：0
> 
> 时间：2008-09-22T16:39:55.190
> 
> 标签：javascript, actionscript-3, events, focus, stage

我得到了这个 Flash 应用程序，您可以在其中观看视频时单击链接。它将打开一个新标签并暂停视频。现在，当您回到 Flash 应用程序时，如果视频能够再次开始播放，那就太好了。有没有办法，一个事件或这样做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T06:01:07.750

一种更清洁的方法是使用以下内容：

```
stage.addEventListener( Event.ACTIVATE, playMovie );
stage.addEventListener( Event.DEACTIVATE, pauseMovie ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T16:45:43.927

Flash 可能是不可行的，但您可能对纯 javascript 有一些运气，并且可以与您的 Flash 电影进行通信。我建议您使用 Window 的 onFocus 事件。

我以前从未使用过它，因此它可能不会在任何/所有浏览器上触发。

*这*在FF3中有效。它不是有效或好的代码，但它是您的垫脚石：

```
<html>
    <head></head>
    <body onFocus="alert('testing');"></body>
</html> 
```

这也很烦人，因为单击 OK 确定警报，重新触发焦点。Control+W 将为您关闭选项卡并允许您中断循环。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T17:16:46.287

当焦点进入和离开播放器时，Flash 播放器会发送激活和停用事件。您可能会使用这些，但它们仅限于 Flash 内容焦点更改时，而不是页面焦点更改时。

查看[blog.flexaxamples.com](http://blog.flexexamples.com/2008/02/29/determining-if-a-flex-application-has-focus-using-the-activate-and-deactivate-events/)以了解如何使用 Flash 激活和停用事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T17:26:49.213

我想我已经这样解决了：

我在舞台上听了一个 mouse_leave 事件，因为你的鼠标在另一个选项卡中时会离开舞台。（或者至少，您必须单击一个选项卡才能返回到 Flash，因此您总是在 Flash 之外）。当您离开舞台时，stageLeave 布尔值设置为 true。

然后我有另一个事件侦听器 mouse_move，它将 stageLeave 布尔值设置为 false（当为 true 时）并调度自定义 STAGE_RETURN 事件。

这里唯一的旁注是，您必须将鼠标移到舞台上才能再次播放视频。但无论如何，这是你要做的事情。

# git - 如何将空白目录添加到 Git 存储库？

> ID：115983
> 
> 赞同：4884
> 
> 时间：2008-09-22T16:41:03.660
> 
> 标签：git, directory, git-add

如何将空白目录（不包含文件）添加到 Git 存储库？

* * *

## 回答 #1

> 赞同：4720
> 
> 时间：2009-05-31T22:10:40.167

使目录保持（几乎）空（在存储库中）的另一种方法是`.gitignore`在该目录中创建一个包含以下四行的文件：

```
# Ignore everything in this directory
*
# Except this file
!.gitignore 
```

那么您不必像在 m104 的[解决方案](https://stackoverflow.com/a/180917/32453)中那样正确地获得订单。

这也带来了好处，即当您执行 git status 时，该目录中的文件不会显示为“未跟踪”。

使[@GreenAsJade](https://stackoverflow.com/users/554807/greenasjade)的评论持久化：

> 我认为值得注意的是，这个解决方案正是问题所要求的，但也许不是许多查看这个问题的人一直在寻找的。此解决方案保证目录保持为空。它说“我真的不想在这里签入文件”。与“我这里还没有要签入的文件，但我需要这里的目录，文件可能稍后会出现”相反。

* * *

## 回答 #2

> 赞同：1159
> 
> 时间：2008-09-22T16:42:52.733

你不能。请参阅[Git 常见问题解答](https://git.wiki.kernel.org/index.php/GitFaq#Can_I_add_empty_directories.3F)。

> 目前 git 索引（暂存区）的设计只允许列出文件，并且没有足够能力进行更改以允许空目录的人足够关心这种情况来补救它。
> 
> 在目录中添加文件时会自动添加目录。也就是说，目录永远不必添加到存储库中，并且不会自行跟踪。
> 
> 你可以说“ `git add <dir>`”，它会在那里添加文件。
> 
> 如果您确实需要一个目录存在于结帐中，您应该在其中创建一个文件。.gitignore 很适合这个目的；您可以将其留空，或填写您希望在目录中显示的文件的名称。

* * *

## 回答 #3

> 赞同：957
> 
> 时间：2011-12-07T16:03:56.057

在目录中创建一个名为的空文件`.gitkeep`，然后添加它。

* * *

## 回答 #4

> 赞同：508
> 
> 时间：2011-03-14T23:38:41.893

您始终可以在目录中放置一个 README 文件，并说明您为什么要在存储库中使用此目录，否则为空目录。

* * *

## 回答 #5

> 赞同：454
> 
> 时间：2014-01-29T04:29:54.393

```
touch .placeholder 
```

在 Linux 上，这会创建一个名为`.placeholder`. 值得一提的是，这个名称对 git 来说是不可知的，并且这种方法用于系统中的各个其他地方，例如`/etc/cron.d/.placeholder`. 其次，正如另一位用户所指出的，`.git`前缀约定可以保留给 Git 本身用于配置目的的文件和目录。

或者，如另一个[答案](https://stackoverflow.com/a/5305908/)**中**所述，**该目录可以包含一个描述性[`README.md`文件](https://stackoverflow.com/questions/8655937/github-readme-and-readme-md)**。

无论哪种方式，这都要求文件的存在不会导致您的应用程序中断。

* * *

## 回答 #6

> 赞同：346
> 
> 时间：2013-12-04T23:32:56.110

### 为什么我们需要空的版本化文件夹

第一件事：

> 在 Git 版本控制系统下，空目录*不能成为树的一部分*。

它根本不会被跟踪。但是在某些情况下，“版本控制”空目录可能是有意义的，例如：

*   搭建**预定义的文件夹结构**，使其可供存储库的每个用户/贡献者使用；或者，作为上述的特殊情况，为**临时文件**创建一个文件夹，例如 a`cache/`或`logs/`目录，我们希望在其中提供文件夹但`.gitignore`其内容
*   与上述相关，*如果没有某些文件夹，某些项目将无法工作*（这通常暗示项目设计不佳，但这是现实世界中常见的情况，也许可能存在需要解决的权限问题）。

### 一些建议的解决方法

许多用户建议：

1.  放置`README`具有某些内容的文件或另一个文件以使目录非空，或
2.  `.gitignore`使用某种“反向逻辑”（即包含所有文件）创建一个文件，最后，该文件的目的与方法#1 相同。

虽然*这两种解决方案都有效*，但我发现它们与有意义的 Git 版本控制方法不一致。

*   为什么你应该在你的项目中放置你可能并不真正想要的伪造文件或自述文件？
*   为什么要使用与它的意义（*不包括*文件）完全相反的`.gitignore`事情（*保存*文件），即使它是可能的？

 *### .gitkeep 方法

使用一个名为的*空*`.gitkeep`文件来强制版本控制系统中存在该文件夹。

虽然看起来差别不大：

*   您使用的文件*仅*用于保存文件夹。你不要放任何你不想放的信息。

    例如，您应该使用自述文件作为包含有用信息的自述文件，而不是作为保留文件夹的借口。

    关注点分离总是一件好事，您仍然可以添加一个`.gitignore`来忽略不需要的文件。

*   命名它`.gitkeep`可以使文件名本身（以及*其他开发人员*，这对于共享项目和 Git 存储库的核心目的之一有好处）非常清晰和直接，该文件是

    *   与代码无关的文件（因为前导点和名称）
    *   与 Git 明显相关的文件
    *   它的目的（**保持**）被清楚地陈述和一致并且在语义上是对立的，它的意思是**忽略**

### 采用

我已经看到了[Laravel](https://laravel.com/)、[Angular-CLI](https://github.com/angular/angular-cli)`.gitkeep`等非常重要的框架所采用的方法。

* * *

## 回答 #7

> 赞同：133
> 
> 时间：2011-05-03T15:17:52.883

如其他答案中所述，Git 无法在其暂存区域中表示空目录。（请参阅[Git 常见问题解答](https://git.wiki.kernel.org/index.php/GitFaq#Can_I_add_empty_directories.3F)。）但是，如果出于您的目的，如果一个目录仅包含一个文件就足够空，那么您只能通过以下方式在空目录`.gitignore`中创建文件：`.gitignore`

```
find . -type d -empty -exec touch {}/.gitignore \; 
```

* * *

## 回答 #8

> 赞同：75
> 
> 时间：2008-09-22T17:28:41.297

Andy Lester 是对的，但是如果您的目录只需要为空而不是*空*，您可以在其中放置一个空`.gitignore`文件作为解决方法。

顺便说一句，这是一个实现问题，而不是基本的 Git 存储设计问题。正如 Git 邮件列表中多次提到的那样，之所以没有实施，是因为没有人足够关心为它提交补丁，而不是它不能或不应该完成。

* * *

## 回答 #9

> 赞同：33
> 
> 时间：2012-10-22T13:24:59.057

[Ruby on Rails](http://en.wikipedia.org/wiki/Ruby_on_Rails)日志文件夹的创建方式：

```
mkdir log && touch log/.gitkeep && git add log/.gitkeep 
```

现在日志目录将包含在树中。它在部署时非常有用，因此您不必编写例程来创建日志目录。

可以通过发出将日志文件排除在外，

```
echo log/dev.log >> .gitignore 
```

但你可能知道。

* * *

## 回答 #10

> 赞同：32
> 
> 时间：2011-05-06T15:45:48.240

Git 不跟踪空目录。有关更多说明，请参阅[Git 常见问题解答](https://git.wiki.kernel.org/index.php/GitFaq#Can_I_add_empty_directories.3F)。建议的解决方法是将`.gitignore`文件放在空目录中。我不喜欢那个解决方案，因为它`.gitignore`被 Unix 约定“隐藏”了。也没有解释为什么目录是空的。

我建议在空目录中放一个 README 文件，解释为什么该目录是空的以及为什么需要在 Git 中对其进行跟踪。有了 README 文件，就 Git 而言，目录不再是空的。

真正的问题是为什么你需要 git 中的空目录？通常你有某种构建脚本可以在编译/运行之前创建空目录。如果没有，那就做一个。这比将空目录放在 git 中要好得多。

所以你有一些理由在 git 中需要一个空目录。把这个原因放在 README 文件中。这样其他开发人员（以及未来的你）就知道为什么需要有空目录。您还将知道，当需要空目录的问题解决后，您可以删除空目录。

* * *

要列出每个空目录，请使用以下命令：

```
find -name .git -prune -o -type d -empty -print 
```

在每个空目录中创建占位符自述文件：

```
find -name .git -prune -o -type d -empty -exec sh -c \
  "echo this directory needs to be empty because reasons > {}/README.emptydir" \; 
```

要忽略目录中除 README 文件之外的所有内容，请将以下行放入您的`.gitignore`:

```
path/to/emptydir/*
!path/to/emptydir/README.emptydir
path/to/otheremptydir/*
!path/to/otheremptydir/README.emptydir 
```

或者，您可以排除*每个*README 文件被忽略：

```
path/to/emptydir/*
path/to/otheremptydir/*
!README.emptydir 
```

要在创建后列出每个 README：

```
find -name README.emptydir 
```

* * *

## 回答 #11

> 赞同：31
> 
> 时间：2012-01-20T15:50:07.760

**警告：事实证明，这个调整并没有真正起作用。**带来不便敬请谅解。

**原帖如下：**

我在玩 Git 内部时找到了一个解决方案！

1.  假设您在存储库中。
2.  创建你的空目录：

    ```
    $ mkdir path/to/empty-folder 
    ```

3.  [使用管道命令和空树SHA-1](http://en.wikipedia.org/wiki/SHA-1)将其添加到索引中：

    ```
    $ git update-index --index-info
    040000 tree 4b825dc642cb6eb9a060e54bf8d69288fbee4904    path/to/empty-folder 
    ```

    键入命令，然后输入第二行。按`Enter`，然后按`Ctrl`+`D`终止您的输入。注意：格式为*模式*[SPACE]*输入*[SPACE] SHA-1hash **[TAB]**路径（制表符很重要，答案格式不保留）。

4.  就是这样！您的空文件夹在您的索引中。你所要做的就是承诺。

这个解决方案很短，显然工作正常（**见编辑！**），但它不是那么容易记住......

空树 SHA-1 可以通过在其中创建一个新的空 Git 存储库并发出来找到，`cd`它`git write-tree`会输出空树 SHA-1。

**编辑：**

自从我找到这个解决方案以来，我一直在使用它。它的工作方式似乎与创建子模块完全相同，只是没有在任何地方定义模块。这会导致发布时出错`git submodule init|update`。问题在于将部分`git update-index`重写为.`040000 tree``160000 commit`

此外，放置在该路径下的任何文件都不会被 Git 注意到，因为它认为它们属于某个其他存储库。这很讨厌，因为它很容易被忽视！

但是，如果您还没有（也不会）在存储库中使用任何 Git 子模块，并且“空”文件夹将保持为空，或者如果您希望 Git 知道它的存在并忽略其内容，您可以使用这个调整。采用子模块的常规方式需要更多的步骤来进行调整。

* * *

## 回答 #12

> 赞同：29
> 
> 时间：2008-10-08T00:13:30.887

假设您需要一个名为*tmp*的空目录：

```
$ mkdir tmp
$ touch tmp/.gitignore
$ git add tmp
$ echo '*' > tmp/.gitignore
$ git commit -m 'Empty directory' tmp 
```

换句话说，您需要将 .gitignore 文件添加到索引中，然后才能告诉 Git 忽略它（以及空目录中的所有其他内容）。

* * *

## 回答 #13

> 赞同：20
> 
> 时间：2011-10-26T16:33:20.783

也许添加一个空目录似乎是*阻力最小的路径，*因为您有脚本期望该目录存在（可能是因为它是生成的二进制文件的目标）。另一种方法是**修改您的脚本以根据需要创建目录**。

```
mkdir --parents .generated/bin ## create a folder for storing generated binaries
mv myprogram1 myprogram2 .generated/bin ## populate the directory as needed 
```

在此示例中，您可能会签入到目录的（损坏的）符号链接，以便您可以在没有“.generated”前缀的情况下访问它（但这是可选的）。

```
ln -sf .generated/bin bin
git add bin 
```

当你想清理你的源代码树时，你可以：

```
rm -rf .generated ## this should be in a "clean" script or in a makefile 
```

如果您采用通常建议的方法来签入一个几乎是空的文件夹，那么在不删除“.gitignore”文件的情况下删除内容的复杂性很小。

您可以通过将以下内容添加到根 .gitignore 来忽略所有生成的文件：

```
.generated 
```

* * *

## 回答 #14

> 赞同：17
> 
> 时间：2017-05-15T19:08:13.977

我喜欢 @Artur79 和 @mjs 的答案，所以我一直在使用两者的组合，并将其作为我们项目的标准。

```
find . -type d -empty -exec touch {}/.gitkeep \; 
```

但是，我们只有少数开发人员在 Mac 或 Linux 上工作。在 Windows 上做了很多工作，我找不到一个等效的简单单线来完成同样的工作。有些人很幸运因为其他原因安装了[Cygwin](http://cygwin.com/)，但仅仅为此开出 Cygwin 似乎有点过头了。

**编辑以获得更好的解决方案**

因此，由于我们的大多数开发人员已经安装了[Ant](http://ant.apache.org/)，我首先想到的是将 Ant 构建文件放在一起，以独立于平台完成此任务。这仍然可以在[这里找到](https://github.com/mig82/gitkeep)

**但是**，后来我觉得把它做成一个小实用命令会更好，所以我用 Python 重新创建了它，并在[这里](https://pypi.org/project/gitkeep2/)发布到 PyPI 。您可以通过简单地运行来安装它：

```
pip3 install gitkeep2 
```

它将允许您`.gitkeep`递归地创建和删除文件，它还允许您向它们添加消息，以便您的同行了解为什么这些目录很重要。最后一点是奖金。我认为如果`.gitkeep`文件可以自我记录会很好。

```
$ gitkeep --help
Usage: gitkeep [OPTIONS] PATH

  Add a .gitkeep file to a directory in order to push them into a Git repo
  even if they're empty.

  Read more about why this is necessary at: https://git.wiki.kernel.org/inde
  x.php/Git_FAQ#Can_I_add_empty_directories.3F

Options:
  -r, --recursive     Add or remove the .gitkeep files recursively for all
                      sub-directories in the specified path.
  -l, --let-go        Remove the .gitkeep files from the specified path.
  -e, --empty         Create empty .gitkeep files. This will ignore any
                      message provided
  -m, --message TEXT  A message to be included in the .gitkeep file, ideally
                      used to explain why it's important to push the specified
                      directory to source control even if it's empty.
  -v, --verbose       Print out everything.
  --help              Show this message and exit. 
```

希望对你有帮助。

* * *

## 回答 #15

> 赞同：16
> 
> 时间：2015-03-15T18:17:02.073

你不能，不幸的是永远也不能。这是 Linus Torvald 自己做出的决定。他知道什么对我们有好处。

我读过一次的地方有一篇咆哮。

我找到了*[Re: Empty directory..](http://markmail.org/message/4eqjxx73opiswfis)*，但也许还有另一个。

你必须忍受这些变通方法......不幸的是。

* * *

## 回答 #16

> 赞同：15
> 
> 时间：2009-07-23T22:33:06.180

我也一直面临空目录的问题。使用占位符文件的问题在于，如果不再需要它们，您需要创建它们并删除它们（因为后来添加了子目录或文件。使用大型源树管理这些占位符文件可能很麻烦并且会出错易于。

这就是为什么我决定编写一个开源工具来自动管理此类占位符文件的创建/删除。它是为 .NET 平台编写的，可在 Mono（.NET for Linux）和 Windows 下运行。

看看：[http ://code.google.com/p/markemptydirs](http://code.google.com/p/markemptydirs)

* * *

## 回答 #17

> 赞同：12
> 
> 时间：2008-09-24T06:43:41.067

添加`.gitignore`文件时，如果要在其中放入任意数量的内容（您希望 Git 忽略），您可能需要添加仅带有星号的单行，`*`以确保不会意外添加被忽略的内容.

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2019-10-24T14:23:54.563

阅读[@ofavre](https://stackoverflow.com/a/8944077/277882)和[@stanislav-bashkyrtsev](https://stackoverflow.com/a/27635349/277882)的答案，使用损坏的 GIT 子模块引用来创建 GIT 目录，我很惊讶没有人建议对这个想法进行简单的修改，以使整个事情变得理智和安全：

*与其将假子模块侵入 GIT*，不如**添加一个空的真实**子模块。

### 输入：[https ://gitlab.com/empty-repo/empty.git](https://gitlab.com/empty-repo/empty.git)

一个只有一次提交的 GIT 存储库：

```
commit e84d7b81f0033399e325b8037ed2b801a5c994e0
Author: Nobody <none>
Date: Thu Jan 1 00:00:00 1970 +0000 
```

没有消息，没有提交的文件。

### 用法

向您的 GIT 存储库添加一个空目录：

```
git submodule add https://gitlab.com/empty-repo/empty.git path/to/dir 
```

要将所有现有的空目录转换为子模块：

```
find . -type d -empty -delete -exec git submodule add -f https://gitlab.com/empty-repo/empty.git \{\} \; 
```

Git 将在创建子模块引用时存储最新的提交哈希，因此您不必担心我（或 GitLab）使用它来注入恶意文件。不幸的是，我没有找到任何方法来强制在结帐期间使用哪个提交 ID，因此您必须在添加 repo 后手动检查参考提交 ID 是否正在`e84d7b81f0033399e325b8037ed2b801a5c994e0`使用。`git submodule status`

仍然不是原生解决方案，但我们可能拥有最好的解决方案，而无需有人*真正*、*非常*肮脏地使用 GIT 代码库。

### 附录：重新创建此提交

您应该能够使用（在一个空目录中）重新创建这个确切的提交：

```
# Initialize new GIT repository
git init

# Set author data (don't set it as part of the `git commit` command or your default data will be stored as “commit author”)
git config --local user.name "Nobody"
git config --local user.email "none"

# Set both the commit and the author date to the start of the Unix epoch (this cannot be done using `git commit` directly)
export GIT_AUTHOR_DATE="Thu Jan 1 00:00:00 1970 +0000"
export GIT_COMMITTER_DATE="Thu Jan 1 00:00:00 1970 +0000"

# Add root commit
git commit --allow-empty --allow-empty-message --no-edit 
```

创建可重现的 GIT 提交非常困难……</p>

* * *

## 回答 #19

> 赞同：11
> 
> 时间：2020-09-03T15:04:54.130

这个解决方案对我有用。

### 1\. 将`.gitignore`文件添加到您的空目录：

```
*
*/
!.gitignore 
```

*   `*`忽略文件夹中的所有文件
*   `*/`忽略子目录
*   `!.gitignore`包含 .gitignore 文件

### 2\. 然后删除缓存，暂存文件，提交并推送：

```
git rm -r --cached .
git add . // or git stage .
git commit -m ".gitignore fix"
git push 
```

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2011-04-19T14:10:35.610

如前所述，不可能添加空目录，但这是一个将空 .gitignore 文件添加到所有目录的衬里。

`ruby -e 'require "fileutils" ; Dir.glob(["target_directory","target_directory/**"]).each { |f| FileUtils.touch(File.join(f, ".gitignore")) if File.directory?(f) }'`

为了方便访问，我将它保存在 Rakefile 中。

* * *

## 回答 #21

> 赞同：10
> 
> 时间：2015-04-26T22:54:56.663

没有办法让 Git 跟踪目录，因此唯一的解决方案是在您希望 Git 跟踪的目录中添加一个占位符文件。

该文件可以命名并包含您想要的任何内容，但大多数人使用一个名为的空文件`.gitkeep`（尽管有些人更喜欢 VCS-agnostic `.keep`）。

前缀`.`将其标记为隐藏文件。

另一个想法是添加一个`README`文件来解释目录的用途。

* * *

## 回答 #22

> 赞同：10
> 
> 时间：2019-08-13T09:34:58.043

许多人已经回答了这个问题。只需在此处添加 PowerShell 版本。

> 找到目录中所有的空文件夹
> 
> 在其中添加一个空的 .gitkeep 文件

```
Get-ChildItem 'Path to your Folder' -Recurse -Directory | Where-Object {[System.IO.Directory]::GetFileSystemEntries($_.FullName).Count -eq 0} | ForEach-Object { New-Item ($_.FullName + "\.gitkeep") -ItemType file} 
```

* * *

## 回答 #23

> 赞同：9
> 
> 时间：2014-06-22T13:06:30.117

[Jamie Flournoy 的解决方案](https://stackoverflow.com/a/932982/456814)效果很好。这是一个有点增强的版本，以保持`.htaccess`：

```
# Ignore everything in this directory
*
# Except this file
!.gitignore
!.htaccess 
```

使用此解决方案，您可以提交一个空文件夹，例如`/log`，`/tmp`或者`/cache`该文件夹将保持为空。

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2011-04-04T10:06:02.050

我总是构建一个函数来检查我想要的文件夹结构并在项目中为我构建它。这解决了这个问题，因为空文件夹由代理保存在 Git 中。

```
function check_page_custom_folder_structure () {
    if (!is_dir(TEMPLATEPATH."/page-customs"))
        mkdir(TEMPLATEPATH."/page-customs");    
    if (!is_dir(TEMPLATEPATH."/page-customs/css"))
        mkdir(TEMPLATEPATH."/page-customs/css");
    if (!is_dir(TEMPLATEPATH."/page-customs/js"))
        mkdir(TEMPLATEPATH."/page-customs/js");
} 
```

这是在 PHP 中，但我确信大多数语言都支持相同的功能，并且由于文件夹的创建由应用程序负责，因此文件夹将始终存在。

* * *

## 回答 #25

> 赞同：8
> 
> 时间：2014-12-24T10:24:24.703

这是一个 hack，但有趣的是它可以工作（Git 2.2.1）。类似于@Teka 的建议，但更容易记住：

*   将子模块添加到任何存储库 ( `git submodule add path_to_repo`)
*   这将添加一个文件夹和一个文件`.submodules`。提交更改。
*   删除`.submodules`文件并提交更改。

现在，您有一个在签出提交时创建的目录。有趣的是，如果您查看此文件的树对象的内容，您将得到：

> 致命：不是有效的对象名称 b64338b90b4209263b50244d18278c0999867193

我不鼓励使用它，因为它可能会在未来的 Git 版本中停止工作。这可能会使您的存储库损坏。

* * *

## 回答 #26

> 赞同：8
> 
> 时间：2017-05-11T13:36:46.220

如果您想添加一个文件夹，该文件夹将在多个语义目录中容纳大量临时数据，那么一种方法是将类似这样的内容添加到您的根 .gitignore ...

`/app/data/**/*.* !/app/data/**/*.md`

然后，您可以在每个目录中提交描述性 README.md 文件（或空白文件，只要您可以像`*.md`在这种情况下一样唯一地定位它们），以确保这些目录都保留在 repo 中，但文件（带扩展名）被忽略。LIMITATION: `.`'s 不允许在目录名称中！

您可以使用 xml/images 文件或其他任何内容填充所有这些目录，并`/app/data/`随着应用程序的存储需求的发展而随着时间的推移添加更多目录（README.md 文件用于刻录每个存储目录的用途的描述）确切地）。

无需通过为每个新目录`.gitignore`创建一个新目录来进一步改变您的或去中心化。`.gitignore`可能不是最聪明的解决方案，但在 gitignore 方面很简洁，并且总是对我有用。又好又简单！;)

[![在此处输入图像描述](https://i.stack.imgur.com/xNBNN.png)](https://i.stack.imgur.com/xNBNN.png)

* * *

## 回答 #27

> 赞同：7
> 
> 时间：2016-06-02T16:42:50.527

有时您必须处理糟糕的编写库或软件，它们需要一个“真正的”空目录和现有目录。放一个简单的`.gitignore`或`.keep`可能会破坏它们并导致错误。在这些情况下，以下内容可能会有所帮助，但不能保证......

首先创建需要的目录：

```
mkdir empty 
```

然后向该目录添加一个损坏的符号链接（但在上述用例之外的任何其他情况下，请使用`README`带有解释的 a）：

```
ln -s .this.directory empty/.keep 
```

要忽略此目录中的文件，您可以将其添加到您的根目录中`.gitignore`：

```
echo "/empty" >> .gitignore 
```

要添加忽略的文件，请使用参数强制它：

```
git add -f empty/.keep 
```

提交后，您的索引中有一个损坏的符号链接，git 会创建目录。断开的链接有一些优点，因为它不是常规文件并且不指向常规文件。所以它甚至适合问题“（不包含文件）”的部分，不是出于意图，而是出于含义，我猜：

```
find empty -type f 
```

此命令显示一个空结果，因为此目录中不存在任何文件。因此，大多数获取目录中所有文件的应用程序通常看不到这个链接，至少如果他们看到“文件存在”或“可读”。甚至某些脚本也不会在那里找到任何文件：

```
$ php -r "var_export(glob('empty/.*'));"
array (
  0 => 'empty/.',
  1 => 'empty/..',
) 
```

但是我强烈建议只在特殊情况下使用这个解决方案，一个好的写`README`在一个空目录中通常是一个更好的解决方案。（而且我不知道这是否适用于 Windows 文件系统......）

* * *

## 回答 #28

> 赞同：7
> 
> 时间：2019-06-17T05:03:37.373

一种简单的方法是将`.gitkeep`文件添加到您希望（当前）保持为空的目录中。

有关更多信息，请参阅此[SOF 答案](https://stackoverflow.com/a/7229996/1882064)- 这也解释了为什么有些人发现添加 .gitignore 文件的竞争约定（如这里的许多答案所述）令人困惑。

* * *

## 回答 #29

> 赞同：7
> 
> 时间：2021-12-01T11:20:15.477

在该目录中添加一个 .gitkeep 文件并提交它。

```
touch .gitkeep 
```

它是 git 遵循的标准。

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2016-05-26T01:18:52.723

为战斗增加了一个选项。

假设您想向其中添加一个目录`git`，出于与 , 相关的所有目的`git`，应该保持为空并且永远不会跟踪其内容，`.gitignore`正如这里多次建议的那样，将起到作用。

如前所述，格式为：

```
*
!.gitignore 
```

现在，如果您想在命令行中执行此操作，一举一动，在*您*要添加的目录中，您可以执行：

```
$ echo "*" > .gitignore && echo '!.gitignore' >> .gitignore && git add .gitignore 
```

我自己，我有一个用来执行此操作的 shell 脚本。随意命名脚本，然后将其添加到包含路径中的某个位置，或直接引用它：

```
#!/bin/bash

dir=''

if [ "$1" != "" ]; then
    dir="$1/"
fi

echo "*" > $dir.gitignore && \
echo '!.gitignore' >> $dir.gitignore && \
git add $dir.gitignore 
```

有了这个，您可以从要添加的目录中执行它，或者引用该目录，因为它是第一个也是唯一的参数：

```
$ ignore_dir ./some/directory 
```

另一种选择（回应@GreenAsJade 的评论），如果您想跟踪一个空文件夹，该文件夹将来*可能*包含跟踪的文件，但现在将是空的，您可以`*`从文件*中*`.gitignore`省略，然后签入。基本上，所有文件都在说“不要忽略*我*”，但除此之外，目录是空的并被跟踪。

 **您的`.gitignore`文件如下所示：

```
!.gitignore 
```

就是这样，签入，你有一个空的但被跟踪的目录，你可以在以后跟踪文件。

我建议在文件中保留这一行的原因是它给出了`.gitignore`目的。否则，有些人可能会考虑将其删除。如果您在该行上方添加评论可能会有所帮助。

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2008-09-22T19:50:38.320

你不能。这是 Git 维护人员有意的设计决定。基本上，像 Git 这样的源代码管理系统的目的是管理源代码，而空目录不是源代码。Git 也经常被描述为内容跟踪器，同样，空目录不是内容（实际上恰恰相反），因此它们不会被跟踪。

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2011-06-26T22:41:27.070

您可以将此代码保存为 create_readme.php 并从 Git 项目的根目录运行[PHP代码。](http://en.wikipedia.org/wiki/PHP)

```
> php create_readme.php 
```

它会将 README 文件添加到所有空目录，以便将这些目录添加到索引中。

```
<?php
    $path = realpath('.');
    $objects = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($path),       RecursiveIteratorIterator::SELF_FIRST);
    foreach($objects as $name => $object){
        if ( is_dir($name) && ! is_empty_folder($name) ){
            echo "$name\n" ;
            exec("touch ".$name."/"."README");
        }
    }

    function is_empty_folder($folder) {
        $files = opendir($folder);
        while ($file = readdir($files)) {
            if ($file != '.' && $file != '..')
                return true; // Not empty
            }
        }
?> 
```

然后做

```
git commit -m "message"
git push 
```

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2020-11-21T14:24:29.907

`.gitignore`只需在要跟踪的空目录中添加空（没有内容）文件。

例如，如果你想跟踪空目录`/project/content/posts`然后创建新的空文件`/project/content/posts/.gitignore`

注意： .gitkeep 不是官方[git](https://git-scm.com/)的一部分：

[![在此处输入图像描述](https://i.stack.imgur.com/u0lfD.png)](https://i.stack.imgur.com/u0lfD.png)

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2016-07-11T18:36:20.517

有时我的存储库中的文件夹只会包含被认为是“内容”的文件——也就是说，它们不是我关心的版本控制的文件，因此永远不应该提交。使用 Git 的 .gitignore 文件，您可以忽略整个目录。但有时将文件夹放在 repo 中会很有用。这是满足此需求的绝佳解决方案。

我过去所做的是将 .gitignore 文件放在我的 repo 的根目录中，然后排除该文件夹，如下所示：

```
/app/some-folder-to-exclude
/another-folder-to-exclude/* 
```

但是，这些文件夹不会成为 repo 的一部分。您可以在其中添加类似 README 文件的内容。但是你必须告诉你的应用程序不要担心处理任何 README 文件。

如果您的应用程序依赖于那里的文件夹（尽管是空的），您可以简单地将 .gitignore 文件添加到相关文件夹中，并使用它来实现两个目标：

告诉 Git 文件夹中有一个文件，这会让 Git 将其添加到存储库中。告诉 Git 忽略这个文件夹的内容，减去这个文件本身。这是放置在空目录中的 .gitignore 文件：

```
*
!.gitignore 
```

第一行 (*) 告诉 Git 忽略此目录中的所有内容。第二行告诉 Git 不要忽略 .gitignore 文件。您可以将此文件填充到要添加到存储库的每个空文件夹中。

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2019-10-22T18:46:12.633

要将 Jamie Flournoy 的[解决方案](https://stackoverflow.com/a/932982/8213124)扩展到目录树，您可以将此 .gitignore 放在顶级目录和`touch .keepdir`git 应跟踪的每个子目录中。所有其他文件都被忽略。这对于确保构建目录的结构一致很有用。

```
# Ignore files but not directories. * matches both files and directories
# but */ matches only directories. Both match at every directory level
# at or below this one.
*
!*/

# Git doesn't track empty directories, so track .keepdir files, which also 
# tracks the containing directory. 
!.keepdir

# Keep this file and the explanation of how this works
!.gitignore
!Readme.md 
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2019-11-20T02:21:23.550

我搜索这个问题是因为：我创建了一个新目录，它包含许多文件。在这些文件中，有些我想添加到 git 存储库，有些不。但是当我做“git status”时。它只显示：

```
Untracked files:
  (use "git add <file>..." to include in what will be committed)
    ../trine/device_android/ 
```

它没有列出这个新目录中的单独文件。然后我想也许我可以只添加这个目录，然后处理单独的文件。所以我用谷歌搜索“仅 git 添加目录”。

在我的情况下，我发现我可以在新目录中添加一个文件，我确定我想将它添加到 git。

```
git add new_folder/some_file 
```

在此之后，“git status”将显示单独文件的状态。

* * *

## 回答 #37

> 赞同：-6
> 
> 时间：2020-09-10T03:04:07.817

只需添加 a`readme`或 a`.gitignore`然后删除它，而不是从终端，从 github 网站，这将给出一个空的存储库

# pdf - 从结构化数据生成 PDF

> ID：115984
> 
> 赞同：3
> 
> 时间：2008-09-22T16:41:07.730
> 
> 标签：pdf, graphics, pdf-generation

我希望能够从我可能在数据库或 xml 或任何其他结构化形式中的数据中生成高度图形化（也包含大量文本内容）的 PDF 文件。

目前，我们的平面设计师在将内容获取为 MS Word 文档后，在 Photoshop 中手动创建这些 PDF 文件。但通常，内容有20多个修改；这里和那里的小改动，拼写更正等。

两个缺点是： 1) 平面设计师的时间被不必要地占用。第一个版本是他/她唯一需要处理的版本。2) PDF 文件变成了现在有最终修改内容的文档，而初始内容与它不同步。因此，如果初始内容需要在其他地方（例如网站上），我们需要从 PDF 文件重新创建它。

生成 PDF 文件将帮助我解决这两个问题。也许图形设计师创建“模板”然后放入标签/持有者并将这些标签/持有者映射到相关数据的某种方式。

谢谢 ：-）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T16:46:27.763

有一些工具可以做到这一点。XSL-FO 很有用。[这](http://cocoon.apache.org/2.1/howto/howto-html-pdf-publishing.html)是使用 cocoon 从 xml（或 xhtml）创建 pdf 的教程。另请参阅[Apache FOP](http://xmlgraphics.apache.org/fop/)。

您可以将 SQL 数据格式化为 XML，并且仍然可以通过这种方式使用相同的模板。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T16:44:30.030

为此，我使用 ReportLab python 库。它也许可以解决你的问题，但你需要做一些工作......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T16:45:01.607

过去我编写了吐出 LaTeX 的脚本，然后使用[texi2pdf](http://linux.die.net/man/1/texi2pdf)来解决这类问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T16:45:52.617

看看[http://jasperforge.org](http://jasperforge.org)上的 iReport 和 JasperReports 。iReport 允许您设计报告，然后您可以使用 JasperReports 库 (Java) 以编程方式填充它，或者仅使用 iReport 手动创建报告。

我只将它用于表格数据，但我认为其他类型的文档不会有任何问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T16:46:32.867

您可以使用 iText (Java) 等 pdf 库以编程方式创建表单并填充条目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T16:43:39.393

您可以查看 PostScript 中的工作流程，它是纯文本，您可以轻松地从片段中组合。然后您可以使用任何[免费工具](http://www.cutepdf.com/Products/CutePDF/writer.asp)转换为 PDF。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T16:52:57.843

看看[Prince XML](http://www.princexml.com "王子 XML")。该工具允许基于 XML 或 HTML 和 CSS 生成 PDF。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T17:09:26.913

一种可能的方法是使用模板引擎，例如 FreeMarker 或 StringTemplate：它们通常用于生成 HTML，但实际上它们足够灵活，可以输出任何格式。
我想问题是制作一个PDF模板。也许您可以获取一个示例输出并对其进行编辑，以用模板引擎填充的占位符替换数据。可能不是小事！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T17:18:11.183

听起来像是 SQL Server Reporting Services 可以轻松处理的工作。
Reporting Services 允许您在没有任何干预的情况下查询数据、定义布局并导出为 PDF。PDF 输出可以通过电子邮件分发，存储在文件共享中，并通过报表服务器上的页面进行访问。
它也可以处理 XML 数据源。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-03-16T14:40:10.247

从数据生成 PDF 文件的另一种方法是使用基于[ruby​​ 的](http://www.ruby-lang.org/en/)[prawn](http://prawn.majesticseacreature.com)。我对虾中包含的功能感到非常惊喜。这可能需要一些前期投资，但这种方法会给你很大的灵活性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-08-08T21:25:37.433

您可以将 CSStoXSLFO 与 RenderX 的 XEP 结合使用，以获得高质量的输出。使用此解决方案，您可以将 XML 数据合并到用 CSS 修饰的 XHTML 模板中。它还可以使用出色的 JFreeChart 库生成图表。支持 CSS3 页面媒体功能。

# iis - 使用 Powershell 访问 IIS 日志？

> ID：115989
> 
> 赞同：5
> 
> 时间：2008-09-22T16:42:24.280
> 
> 标签：iis, logging, powershell, shell

我知道您可以使用 PowerShell 将注册表之类的东西变成驱动器号。PowerShell 中还有其他对象以这种方式对待其他对象。有谁知道以这种方式访问​​ IIS 日志的任何 cmdlet？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-02-18T18:06:48.600

快速而肮脏的脚本会起作用吗？W3c日志文件头的第三行（IIS默认保存）有#Header行...另存为Import-W3CLog.ps1

```
param ($logfile)
import-csv -Delimiter " " -Header "date","time","s-ip","cs-method","cs-uri-stem","cs-uri-query","s-port","cs-username","c-ip","csUser-Agent","sc-status","sc-substatus","sc-win32-status","time-taken" -path $logfile | where { !($_.Date.StartsWith('#')) } 
```

# ssl - 非域环境中的 Windows Server 2008 SSTP VPN？

> ID：115994
> 
> 赞同：3
> 
> 时间：2008-09-22T16:43:18.600
> 
> 标签：ssl, windows-server-2008, vpn

将非基于域的（独立）Windows Server 2008 设置为 SSTP VPN（安全套接字层隧道协议 VPN）是否可行？

我想通过 Win2k8 服务器建立 SSTP VPN 连接，使远程用户能够通过基于 SSL 的 VPN（当前使用 PPTP）访问网络。大多数文档似乎都包含在 AD 域中运行，并具有内部证书颁发机构以启用此功能。

是否可以使用独立的 Win2k8 服务器来执行此操作？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T19:12:21.230

您连接到 sstp 的主机地址。您可以使用来自任何 ssl 证书提供商的标准 Web 证书。该主机地址需要解析为您的 VPN 服务器。

分步指南 [http://www.windowsecurity.com/articles/Configuring-Windows-Server-2008-Remote-Access-SSL-VPN-Server-Part2.html](http://www.windowsecurity.com/articles/Configuring-Windows-Server-2008-Remote-Access-SSL-VPN-Server-Part2.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T05:02:26.183

我的理解是，用作身份验证一部分的证书必须来自 Active Directory 证书服务，并且无法从任何其他来源获取它（我承认不会太努力地弄清楚是否可能，我正在为另一个 VPN 相关项目调查 SSTP）

将 2008 服务器设置为独立的 AD 控制器可以解决这个问题；客户端系统不需要在域中。

# error-reporting - 在表单顶部显示错误消息？还是在每个单独的字段旁边？

> ID：115996
> 
> 赞同：0
> 
> 时间：2008-09-22T16:43:26.353
> 
> 标签：error-reporting

大家认为哪种方法更好？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T16:44:40.407

在每个字段旁边，以独特的颜色或易于区分的标记突出显示每个字段，因此问题出在哪里是不言而喻的，尤其是在长表格上。还要在每个故障旁边放置一个帮助图标，以提供更多信息，以防某些用户需要它。此外，不要忘记在两次故障之间保留正确的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T16:47:52.800

我将错误摘要放在表单顶部，详细**说明**字段值不正确的原因，例如“Field1 是必需的并且必须是整数”。我还在出错的字段上添加了视觉指示器，通常是字段旁边的星号或更改输入区域的颜色。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T16:46:21.213

这将始终取决于情况，但...

我更喜欢在每个字段旁边做一个不显眼的指示符（可能是 *），并在表单的顶部（或底部）显示更详细的消息或摘要消息，并带有较长的表单。

~~如果表格较短，您可能无需提供“摘要”就可以逃脱。~~我改变了主意，您可能应该提供一个摘要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T16:47:30.257

确定有错误的字段是很重要的，当然。但是，顶部的摘要让用户知道下面有错误可能有助于长表单。此外，您可以将更多详细信息放在顶部的摘要部分，您可能在下面没有空间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T16:59:16.377

我们在每个有错误的字段旁边提供一个小指标。当您翻转指示器时，工具提示会为您提供需要修复的内容。然后，我们还会在 smae 时提供一个摘要，以便他们可以看到他们需要修复的所有错误。***************