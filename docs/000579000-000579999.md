# StackOverflow 问答 000579000-000579999

# excel - 从 Matlab 修改 Excel 工作表

> ID：579006
> 
> 赞同：7
> 
> 时间：2009-02-23T19:32:05.080
> 
> 标签：excel, matlab, worksheet-function

是否可以从matlab中打开excel中的工作表并编辑公式？这个想法是通过创建第二张表来自动化不确定性分析，其中每个单元格中的不确定性来自前一个单元格的值。本质上，我想将单元格视为变量并对每个单元格执行 SQRT(SUM(Partials(xi)^2)) 。Matlab的计算应该没有问题，但是它可以编辑表格中的公式吗？

目前的过程是从excel复制粘贴到matlab。这是一个小函数，它可以在 matlab 中对方程组进行不确定性：

```
function [f_u_total f_u] = uncertAnalysis(f, vars, vars_u)
    f_u = [];
    f_u_total = [];
    for(i=1:length(f))
        f(i)
        item = uncertAnalysisi(f(i), vars, vars_u);
        f_u = [f_u; item(1)];
        f_u_total = [f_u_total; item(1)];
    end
end

function [f_u_total f_u] = uncertAnalysisi(f, vars, vars_u)
    f_u = [];
    % take the partials and square them
    for i=1:length(vars)
        f_u = [f_u; vars(i) (diff(f, vars(i)).*vars_u(i)).^2];
    end
    % calculate the RSS
    f_u_total = (sum(f_u(:,2))).^.5;
end 
```

顺便说一句，方程式看起来像这样（为什么我不手动这样做）：

```
=(9*C!S3^2/C!V3^4*C!W3*(C!O3-
C!P3)/C!X3*C!Q3^6*C!F3^4/C!Y3^6/(C!U3^C!Z3)^6*F3^2+1/4*C!S3^2/C!V3^4*C!W3/(C!O3-
C!P3)/C!X3*C!Q3^6*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*O3^2+1/4*C!S3^2/C!V3^4*C!W3/(C!O3-
C!P3)/C!X3*C!Q3^6*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*P3^2+9*C!S3^2/C!V3^4*C!W3*(C!O3-
C!P3)/C!X3*C!Q3^4*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*Q3^2+1/C!V3^4*C!W3*(C!O3-
C!P3)/C!X3*C!Q3^6*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*S3^2+9*C!S3^2/C!V3^4*C!W3*(C!O3-
C!P3)/C!X3*C!Q3^6*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*C!Z3^2/C!U3^2*U3^2+4*C!S3^2/C!V3^6*C!W3*(C!O
3-C!P3)/C!X3*C!Q3^6*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*V3^2+1/4*C!S3^2/C!V3^4/C!W3*(C!O3-
C!P3)/C!X3*C!Q3^6*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*W3^2+1/4*C!S3^2/C!V3^4*C!W3*(C!O3-
C!P3)/C!X3^3*C!Q3^6*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*X3^2+9*C!S3^2/C!V3^4*C!W3*(C!O3-
C!P3)/C!X3*C!Q3^6*C!F3^6/C!Y3^8/(C!U3^C!Z3)^6*Y3^2+9*C!S3^2/C!V3^4*C!W3*(C!O3-
C!P3)/C!X3*C!Q3^6*C!F3^6/C!Y3^6/(C!U3^C!Z3)^6*LOG(C!U3)^2*Z3^2)^(1/2) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T20:43:16.937

您应该可以通过 COM/ActiveX/Automation 来完成。查看[外部接口](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_external/brd05nl.html)文档；有一个如何通过 Excel 的自动化接口访问 Excel 文档的示例。

我几乎没有以这种方式操作 Excel 的经验，但我知道您可以通过自动化在 Excel 中做任何事情，并且编辑单元格公式听起来并不难。

编辑：我找不到对 Excel 对象模型的引用，但这是另一个示例：http: [//support.microsoft.com/kb/301982](http://support.microsoft.com/kb/301982)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T19:51:16.453

编辑：我之前认为[XLSWRITE](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/xlswrite.html)不起作用的假设是错误的。我刚刚在 MATLAB 中尝试了以下操作：

```
xlswrite('xltest.xls',{'1' '2' '=SUM(A1,B1)'}); 
```

当我在 excel 中打开文件时，该功能实际上就在那里！对此的限制是您只能使用 Excel 中的函数。

不幸的是，我不相信[XLSREAD](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/xlsread.html)可以将公式读入 MATLAB（它似乎只是得到结果）。

以前建议的选项：

您可能想查看 MathWorks 网站上的[Spreadsheet Link EX](http://www.mathworks.com/access/helpdesk/help/toolbox/exlink/exlink_product_page.html)软件，尽管我对它有点陌生，并且不确定它是否能满足您的需求。您应该研究的其他内容是[MATLAB Builder EX](http://www.mathworks.com/products/matlabxl/)，它“允许您将 MATLAB® 应用程序作为宏函数或插件集成到您组织的 Excel® 工作簿中”。听起来很有希望...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T19:51:35.517

这不是一个非常优雅的解决方案，但是如果您保存一个`.xls`只是制表符分隔（或 CSV）文件的新电子表格，您可以让 Matlab 生成公式，当 Excel 打开文档时，这些值将被填充。

在 Perl 中，我处理它是这样的：

```
打开（输出，'>tmpfile.xls'）；
打印输出“1\t2\t=A1+B1\n”；
关闭（输出）；

```

在`tmpfile.xls`Excel 中打开时，单元格将显示为 3，如果或更改`C1`，它将动态更新。`A1``B1`

（我不擅长 Matlab，所以我对任何类型的插件一无所知）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-25T16:57:32.643

使用 COM/ActiveX。您可以通过以下命令打开 Excel 实例：

```
xlApp = COM.Excel.Application; 
```

然后结合使用代码完成和 Excel 本身中的 VBA 帮助来计算其余部分。

记得关闭 Excel

```
xlApp.Quit;
delete(xlApp); 
```

附带说明一下，所谓的 CSE（Control-Shift-Enter）公式可能会有所帮助吗？见[谷歌](http://www.google.co.uk/search?q=excel+cse+formula)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-02T02:23:52.820

作为替代方案，请参阅下面的代码 (xlswrite) 以使用 Matlab 中的 ActiveX：

[http://www.mathworks.com/matlabcentral/fileexchange/2855](http://www.mathworks.com/matlabcentral/fileexchange/2855)

# silverlight - Silverlight 中异常处理的最佳实践是什么？

> ID：579007
> 
> 赞同：12
> 
> 时间：2009-02-23T19:32:16.687
> 
> 标签：silverlight, exception-handling

在 ASP.NET 中，我通常在服务器端记录异常，在 Windows 窗体中，我可以在服务器端记录异常或写入客户端上的日志文件。Silverlight 似乎介于两者之间。

我想知道其他人都在做什么来处理他们的 Silverlight 异常，我很好奇是否已经出现了任何最佳实践。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T21:07:24.697

对于您可以存储和跟踪的真实日志记录，您需要在服务器上执行此操作，因为您无法保证客户端上的任何内容都会被持久化。

我建议在服务器端 Web 服务（也许你已经有一个）上公开一个“LogEvent(..)”方法，然后执行与 ASP.net 中相同的日志记录

这是关于 Silverlight 中基本 Web 服务调用的视频，如果您还没有这样做的话 [http://silverlight.net/learn/learnvideo.aspx?video=66723](http://silverlight.net/learn/learnvideo.aspx?video=66723)

不过，我不确定是否有任何日志记录最佳实践，我的第一个猜测是在服务器上登录 Web 服务并将其公开给客户端。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T21:00:05.883

我会说 Silverlight 更适合模型的 ASP.NET 端。您有提供网页的服务器。页面上的一个对象（Silverlight 应用程序）ping 数据服务以获取数据并显示它。

所有数据访问都发生在服务器端，无论数据是用于在服务器上创建 ASP.NET 页面还是将原始数据发送到 RIA 以进行显示，都无关紧要。我确实记录了服务器端数据服务中的任何故障（事件日志工作正常），并且不允许任何异常传递给 WCF。当客户端没有收到预期的数据（它得到空集合或类似的东西）时，它会向用户显示通用数据访问错误。我们可能需要尽快扩展它以传递更多信息（区分访问被拒绝/缺少数据库/基础设施故障/内部错误/等），但我们不打算将异常错误消息传递给客户端。

至于客户端，有时我们可能会遇到异步调用超时的情况——这只是另一条消息。对于来自客户端代码的一般异常（通常是我们代码中的错误），我只是将异常传递给浏览器，以与任何脚本异常相同的方式显示。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-24T10:57:53.267

使用[可用于 Silverlight 应用程序的独立存储](http://www.silverlight.net/learn/graphics/file-and-local-data/isolated-storage-%28silverlight-quickstart%29)。您应该在此处存储您的日志。

然后，您可以开发一种机制来将用户日志发送到 Web 服务，例如 Windows 错误报告服务。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-09T17:43:09.930

[另请查看Microsoft 模式和实践](http://msdn.com/practices)中用于企业库的新[Silverlight 集成包](http://entlib.codeplex.com/wikipage?title=EntLib5Silverlight)。它支持将异常记录到隔离存储或远程服务，并且可以通过外部配置中的策略或以编程方式进行配置。还支持批量记录和自动重试（在偶尔连接的情况下）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-25T17:10:54.780

这在很大程度上取决于您正在开发的应用程序的类型。

如果它是基于 mvc / mvp 的架构，那么您的模型，或者至少其中的大部分，将在服务器上，我想这是您的大多数异常将被抛出的地方，因此您可以将它们记录在那里并选择显示给用户的消息与否。

对于客户的例外情况，您可能想知道详细信息，所以只需将它们发回即可。

# asp.net - 如何在 IIS7 中设置本地 ASP.NET 2.0 站点以进行本地测试？

> ID：579011
> 
> 赞同：4
> 
> 时间：2009-02-23T19:34:56.307
> 
> 标签：asp.net, iis, iis-7, installation, local

与旧的 IIS 相比，这件事太令人困惑了，我什至还没有找到在哪里选择 .NET 的版本。我不得不从我的 web.config 中注释掉 and 因为我不断得到：

> 此配置部分不能在此路径中使用。当该部分锁定在父级别时会发生这种情况。锁定是默认情况下 (overrideModeDefault="Deny") 或由具有 overrideMode="Deny" 或旧 allowOverride="false" 的位置标记显式设置的。

在那之后，我现在得到一个 HTTP 错误 404.3 Not Found on Default.aspx 但它在那里（我为它创建了一个默认页面条目）。它说它可能缺少处理程序映射，那到底是什么？为什么他们让使用新的 IIS 变得如此混乱？我在这个项目上浪费了很多时间来尝试设置它。我是否从我的 web.config 中注释掉了这个新问题？请帮忙！

哦，等等，它还说可能没有安装 ASP.NET，但我很确定我正在运行 Windows 7。我需要在 IIS 中配置什么来启用 ASP.NET aspx/ashx 处理吗？

更新：是的，我必须安装 asp.net 现在我得到 500.19：

> 模块 DefaultDocumentModule 通知 ExecuteRequestHandler 处理程序 StaticFile 错误代码 0x800700b7 配置错误无法添加类型为“add”的重复集合条目，其唯一键属性“value”设置为“Default.aspx”配置文件 \?\C:\Users\Ryan\Bancroft Archive\ SANTIAGO\圣地亚哥代码\trunk\web.config

唔...

更新（2）：删除了 web.config 中将 Default.aspx 添加为默认文档的那一行，因为我已经在 ISS7 中手动添加了它并且它是重复的。似乎现在正在工作。有趣的是，我在发布后解决了它，但我一直在更新，所以希望它不会完全浪费，这增加了这个网站的有用内容。感谢所有的答复。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T06:31:54.553

确保在应用程序池高级设置中选中启用 32 位应用程序为 true，特别是如果您在经典模式下运行，我真的不知道为什么，但在启用它之前我非常头疼。

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T19:43:24.460

我发现 IIS7 比 IIS6 更容易配置。我的意思是更容易。

在添加站点方面，它并没有什么不同，您只需在 IIS 管理器中添加一个站点并配置您要使用的绑定。你不需要做任何特别的事情来让它与 asp.net 2.0 一起工作，它应该开箱即用。

我想我从你的问题中遗漏了一些东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T19:43:53.757

您是否将应用程序池设置为使用 Classic 作为其托管管道模式？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T22:17:57.653

我发现最好的方法是让 Visual Studio 为您完成。如果您使用的是 Web 应用程序项目，则在项目属性中的 Web 选项卡上，您可以选择使用 IIS。在该选项组中，您可以选择让 Visual Studio 为您创建虚拟目录。

您提到了.NET 版本。只有一个 .NET CLR 版本 - 2.0。如果您正在寻找其中一个版本，则没有 .NET 3.0 或 3.5 CLR。

# visual-studio - 如何确定 C++ 项目中的代码行数？

> ID：579016
> 
> 赞同：1
> 
> 时间：2009-02-23T19:37:08.003
> 
> 标签：visual-studio, code-metrics, lines-of-code

在 Visual Studio 中，有没有一种快速的方法可以知道项目中存在多少行代码？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T19:42:31.250

在 Visual Studio 2008 中，右键单击一个项目并选择“计算代码度量”。它包括一些其他指标，例如圈复杂度。但是，它只计算真正的代码行，而不是空行或带有 } 的行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T19:45:42.770

安装 cygwin，启动一个 bash shell，cd 到顶层目录并发出类似：

寻找 。-name "*.cpp" -exec cat {} \; | wc -l

保罗。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T19:39:40.197

您始终可以使用示例代码[中的行计数器加载项。](http://blogs.msdn.com/vsxfaq/archive/2008/03/28/how-to-create-a-line-counter-using-an-add-in.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T19:41:08.850

我用过[SourceMonitor](http://www.campwoodsw.com/sourcemonitor.html)。工作得很好。

### 另请参阅以下答案：[计算 NLOC 的简单脚本？](https://stackoverflow.com/questions/323419/simple-script-to-count-nloc)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T20:10:48.030

对于可以为您提供行数和更多有用指标的更通用的解决方案，我强烈推荐[Source Monitor](http://www.campwoodsw.com/)，它是免费的并且可以与 VS 集成。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-31T23:21:08.677

我经常使用[http://cloc.sourceforge.net/](http://cloc.sourceforge.net/)来获取包括 C++ 在内的多种语言的代码指标。

# asp.net - 使用 jquery 调用 ascx 页面方法

> ID：579024
> 
> 赞同：24
> 
> 时间：2009-02-23T19:38:56.827
> 
> 标签：asp.net, jquery, web-services, asmx, pagemethods

我知道我可以使用以下语法使用 jquery 调用页面方法

```
$.ajax({
  type: "POST",
  url: "Default.aspx/GetDate",
  data: "{}",
  contentType: "application/json; charset=utf-8",
  dataType: "json",
  success: function(msg) {
    // Replace the div's content with the page method's return.
    $("#Result").text(msg.d);
  }
}); 
```

这适用于**aspx**页面，但它可以用于**ascx**页面吗？（网络控制）

我已经尝试了大约半个小时，因为我无法让它工作，我想知道它是否可能。

注意：为了清楚起见，当我尝试调用 ascx 页面时，我**正在**更新 jquery 中的 url :)

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-23T19:45:21.307

不，因为 ascx 控件不代表可以从客户端计算机访问的真实 URL。它们纯粹是服务器端的，旨在嵌入其他页面。

您可能想要做的只是有一个 aspx 页面，它提供您当前在 ascx 文件中拥有的相同 html 片段。aspx 页面不一定需要提供完整的 html 文档（<html><body> 等），它可以只呈现您感兴趣的用户控件。

我们一直使用这种技术和 ingrid 插件，它需要一个回调 url 用于表格内容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T19:43:20.937

我认为直接请求 ascx 文件是不可能的——即将“MyControl.ascx”作为 url 参数提供给 $.ajax(..)。ascx 文件不直接由 Web 服务器公开。

我相信，您可以提供包含用户控件的 aspx 页面的 url——即，如果 MyControl.ascx 的实例位于 MyPage.aspx 上，则您必须提供“MyPage.aspx”作为 url 参数。听起来这可能会破坏您想要完成的目标。

编辑：克莱德在下面所说的似乎是个好主意。我自己也在做类似的事情，将 ascx 控件包含在一个页面上，该页面的工作或多或少只是为了托管它以便从客户端脚本访问。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T19:43:13.277

我认为这是不可能的，因为用户控件并不意味着可以从外部访问（在页面之外）。我建议只使用脚本服务（网络服务）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T19:51:46.047

如何在 .aspx 页面上创建方法来使用来自控件的信息来完成它需要的操作？我知道人们会反复讨论应该包含或不包含哪些控件，但如果控件只包含属性和对象，我认为在 .aspx 页面中具有该功能可能对您有用。显然会有很多取舍。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-24T19:33:22.713

[这是一个通过 jQuery Web 服务调用呈现用户控件的示例](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-05T03:29:50.173

这是一种解决在 ASPX 页面中只能使用页面方法 (ScriptMethod) 的限制的方法。此示例使用页面基类和特殊属性构建代理，以装饰 ASCX 页面代码隐藏中的方法，并通过客户端访问这些方法。

[使用 AJAX、JSON、基类和反射在 ASCX 用户控件中创建页面方法 (ScriptMethod)](http://www.chadscharf.com/index.php/2009/11/creating-a-page-method-scriptmethod-within-an-ascx-user-control-using-ajax-json-base-classes-and-reflection/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-24T01:46:56.147

我将创建一个通用处理程序 (.ashx)，它加载控件并将其呈现的 HTML 写入响应。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-30T16:50:47.113

您可以在 Default.aspx 或其他 aspx 文件中编写 GetDate() 方法，并且可以**从 .ASCX 文件**中调用该方法。

前任：

在 UserControl.ascx 中：

```
$.ajax({
 type: "POST",
 url: "Default.aspx/GetDate",
 data: "{}",
 contentType: "application/json; charset=utf-8",
 dataType: "json",
 success: function(msg) {
 // Replace the div's content with the page method's return.
 $("#Result").text(msg.d);
} 
```

});

在 Default.aspx.cs 中：

`Public void GetDate() //Public static void { //your code here }`

# java - Java 泛型

> ID：579031
> 
> 赞同：5
> 
> 时间：2009-02-23T19:41:40.813
> 
> 标签：java, generics

为什么以下被认为比旧的铸造方式更好？

`MyObj obj = someService.find(MyObj.class, "someId");`

对比

`MyObj obj = (MyObj) someService.find("someId");`

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T19:44:09.217

无法保证非泛型版本会返回“MyObj”类型的对象，因此您可能会收到 ClassCastException。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-23T19:47:49.223

`someId`在情况 1 中，如果找不到类型为 id 的对象，大多数实现良好的服务将能够返回 null `MyObj`。此外，第一种情况使服务有可能具有一些特定于使用 type 类的特定逻辑`MyObj`。

`ClassCastException`在情况 2 中，除非您使用 instanceof （如果可能，请避免使用），否则您将面临必须捕捉和处理的丑陋风险。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T19:53:42.237

使用显式类型参数的另一个优点是允许使用 a 实现服务方法`Proxy`（在这种情况下`MyObj`需要是`MyInterface`）。如果没有明确的类型参数，这是不可能的。

`Proxy`出于多种原因，您可能会使用 a （测试一个）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T19:48:50.127

第一种情况更好的一个原因是该`find(Class,String)`方法现在知道它的返回值被分配给什么。因此，它现在能够在内部进行任何相关的转换，而不是简单地希望返回正确的类型。例如，假设该`find`方法在使用 调用时在内部定位一个`String`对象`"someId"`。该`find`方法可能具有将 a`String`转换为`MyObj`实例的策略。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-13T04:45:22.550

这不是更好。可以说它更糟，除非在非常特殊的情况下。只有当你需要那种东西时，目标才需要在类对象上调用 newInstance() （等等）——工厂方法和东西。

如果你想保存电子，顺便说一句，这也可以

```
MyObj obj = someService.find((Class<MyObj>) null, "someId"); 
```

# c# - 如何从 C# 中的文件/流中读取 Pkcs#7 证书链？

> ID：579035
> 
> 赞同：6
> 
> 时间：2009-02-23T19:42:42.187
> 
> 标签：c#, x509certificate2, pkcs#7

我有两个保存到磁盘的证书。一个是我导出为 .pfx 文件的带有私钥的证书，另一个是我保存的证书，包括其证书链作为 PKCS#7 文件（“certchain.p7b”）。

在 C# 中，我现在可以加载 .pfx 文件

```
 var cert = new X509Certificate2(myPfxFileStream); 
```

（myPfxFileStream 是`FileStream`对 .pfx 文件的打开以供读取），但是在“Der Indexwert ist ungültig”中尝试使用 PKCs#7 证书进行相同操作会失败，`CryptoGraphicException`这会转换为“无效的索引值”。

我假设我必须以不同的方式解析 PKCS#7（它包含一个链，而不是一个证书！），但是如何？

（哦，顺便说一句：目前我在这些证书上没有密码）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T19:49:21.903

您将希望使用命名空间[`SignedCms`](http://msdn.microsoft.com/en-us/library/system.security.cryptography.pkcs.signedcms.aspx)中的类[`System.Security.Cryptography.Pkcs`](http://msdn.microsoft.com/en-us/library/6see7k14.aspx)。

此博客条目将向您展示如何使用该类：

2021 年链接更新：[https ://docs.microsoft.com/en-us/archive/blogs/shawnfa/envelope-pkcs-7-signatures](https://docs.microsoft.com/en-us/archive/blogs/shawnfa/enveloped-pkcs-7-signatures)

原文链接：http: [//blogs.msdn.com/shawnfa/archive/2006/02/27/539990.aspx](http://blogs.msdn.com/shawnfa/archive/2006/02/27/539990.aspx)

您基本上将调用该[`Decode`](http://msdn.microsoft.com/en-us/library/system.security.cryptography.pkcs.signedcms.decode.aspx)方法，传递代表 PKCS 文件的字节。

# visual-studio - 在 Visual Studio 加载项中仅触发 OnConnection

> ID：579041
> 
> 赞同：0
> 
> 时间：2009-02-23T19:43:25.867
> 
> 标签：visual-studio, visual-studio-2008

我正忙于一个小而简单的加载项，但这个过程似乎非常复杂且记录不充分。现在，加载项中唯一触发的事件是 OnConnection。我试图处理的另外两个似乎不存在。

```
 private DTE2 applicationObject;
    private SolutionEvents solutionEvents;

    public void OnConnection(object application, ext_ConnectMode connectMode, object addInInst, ref Array custom)
    {
        applicationObject = (DTE2)application;
        solutionEvents = ((Events2)applicationObject.Events).SolutionEvents;
        solutionEvents.Opened +=new _dispSolutionEvents_OpenedEventHandler(SolutionEvents_Opened);          
    }
    private void SolutionEvents_Opened()
    {
        Debug.WriteLine("Solution loaded: " + applicationObject.Solution.FullName);
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T19:52:22.333

`Events.SolutionEvents`嗯，您是否尝试过在本地保存副本？我猜如果您的加载项中没有明确引用它，它可能会“消失”。

这只是一个猜测:)

# c# - SQL Server 触发器 - 将消息发送到队列

> ID：579045
> 
> 赞同：7
> 
> 时间：2009-02-23T19:45:19.323
> 
> 标签：c#, sql-server, sql-server-2005, msmq

是否可以在 SQL Server 2005 中的 CLR 触发器上通过 MSMQ 将消息发送到队列？

我使用的是 SQL Server Project 类型，但 System.Messaging 没有作为我可以添加的参考出现。

* * *

基本上，当将一行写入表时，我需要执行某种类型的操作（打印）。生成该行的设备是一个只能执行基本操作的手持扫描仪——其中一个是通过 odbc 写入 SQL Server。最初的想法是轮询表、抓取记录、打印记录、删除记录。这可能会很好，但它似乎是了解消息队列的一个很好的案例和借口。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T19:52:38.683

是的，这是可能的。

不过，我不会在触发器中这样做：TXN 将保持打开更长时间，它是资源密集型的，如果它挂起怎么办等。

您可以通过存储过程进行更新吗？

或者将一行推送到由写入队列的 SQL 代理作业监控的轮询表中？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-25T20:32:19.350

如果该程序集不受信任，您仍然可以从 SQL Server 访问它 - 它本身不可用，并且必须手动导入并标记为“不受信任”本身。我前段时间在 System.DirectoryServices 上遇到了同样的问题。

关于 System.DirectoryServices，这个人和你有同样的问题，但是以同样的方式执行 CREATE ASSEMBLY 语句应该允许你访问 System.Messaging：

[http://www.mydatabasesupport.com/forums/ms-sqlserver/218655-system-directoryservices-allowable-clr.html](http://www.mydatabasesupport.com/forums/ms-sqlserver/218655-system-directoryservices-allowable-clr.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T19:48:20.800

这可能对您有用：http: [//support.microsoft.com/kb/555070](http://support.microsoft.com/kb/555070)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-10-24T20:06:57.497

这里有一些关于如何处理这个老问题的新想法：http: [//nginn.org/blog/ ?p=376](http://nginn.org/blog/?p=376)

Nginn-messagebus 是我基于 SQL Server 的消息队列项目，针对依赖 SQL Server 的 .Net 应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-12-18T22:18:58.873

通过推送技术很难进行事务处理。

这样做的唯一事务选项是使用 WCF 桥，它需要反过来使用 SQL Server 2008，自 2012 年以来，SQL Server 托管 CLR 阻止的基于 WSDL 的程序集的动态后台编译，我从未破解过如何强制编译这些程序集以避免引用托管 CLR 策略禁止的程序集。

我发现工作的唯一选择（可能是由于我未能找出解决方法）是使用 HttpClient RESTFull 样式的网络客户端和 CLR 集成过程，该过程脱离 SQL Server Broker 激活过程。它工作得非常好，只有一个问题，RESTFull 不支持开箱即用的事务。因此，如果您需要保证消息的传递，您将需要在消息流中的某处进行检查调用。

事实上，为了保护 MSMQ 操作的完整性，我在我的 RESTFull 和 MSMQ 之间插入了一个事务性 WCF 服务，并且在 MSMQ 上使用了触发器，它又具有策略驱动的事务性数据处理。请注意，MSMQ 触发器需要安装 MSMQ 触发器功能。我选择了基于 exe 的触发器，因为替代方法是使用基于 COM 的 DLL，我不喜欢使用 COM，因为自由线程 DLL 需要实现复杂的 C++ 应用程序和单元线程，这在 C# 中使用 CCW 设计相对容易，对应用规模施加限制。最后 RESTFull 调用可以被认为是“接近事务的”，因为它是在事务的上下文中执行的，除非你有一些严重的错误，例如错过捕获错误条件（基本上错过实现 try / catch ）并抛出，当需要提高错误条件时，您将受益于可靠的提交/回滚。然而，当丢失数据被认为等于没有提交时，通过检查调用和合理的超时来加强，以确保消息传递的可靠性，这是很好的。

# asp.net - 如何在 VB.NET 中对数组进行 JSON 编码？

> ID：579053
> 
> 赞同：14
> 
> 时间：2009-02-23T19:46:55.903
> 
> 标签：asp.net, arrays, json, vb.net, encode

我需要为我正在使用的例程传回 JSON 结果。在`VB.NET`中，如何对数组进行 JSON 编码？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-23T19:50:27.207

```
Dim serializer as New JavaScriptSerializer()
Dim arrayJson as String = serializer.Serialize(myArray) 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-23T19:50:58.233

有四种方式：

1.  使用自定义格式化程序滚动您自己
2.  [.NET](http://www.codeplex.com/Json) .
3.  [JavaScriptSerializer](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx)
4.  [DataContractJsonSerializer](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.json.datacontractjsonserializer.aspx)

我最近写了一篇关于如何进行[Json 序列化](http://blog.framework-it.net/2009/02/json-serialization.html)的博客。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T19:50:38.047

您将要研究 JSON 序列化。 [这是一篇很好的文章](http://pietschsoft.com/post/2008/02/NET-35-JSON-Serialization-using-the-DataContractJsonSerializer.aspx)，它解释了一种方法（不幸的是，这些示例是用 C# 编写的），但有了更多信息，我们可能会引导您使用正确的工具包。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T19:51:01.277

您可以尝试使用 javascript 序列化程序（[http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx)）我相信它已被微软弃用了一段时间，但后来又被弃用了（这是一个词吗？？）当他们想在 MVC 中使用它时

# mysql - mysql SELECT AS 中的索引或使用视图

> ID：579060
> 
> 赞同：0
> 
> 时间：2009-02-23T19:49:32.357
> 
> 标签：mysql, indexing, derived-table

我对一个大的 mysql 查询（mysql 5.0）感到头疼，我希望这里有人能提供帮助。

之前我问过如何从连接查询中获取不同的值 [mysql count only for distinct values in join query](https://stackoverflow.com/questions/508707/mysql-count-only-for-distinct-values-in-joined-query)

我得到的响应（使用带有连接的子查询）

```
选择 *
来自媒体 m
内部联接
     （选择uid
     来自 users_tbl
     限制 0,30) 地图
  在 map.uid = m.uid
内连接 users_tbl u
  在 u.uid = m.uid

```

不幸的是，我的查询变得越来越不守规矩，虽然我运行它，但加入派生表需要太长时间，因为派生查询没有可用的索引。

我的查询现在看起来像这样

```
选择 mdate.bid, mdate.fid, mdate.date, mdate.time, mdate.title, mdate.name,
       mdate.address, mdate.rank, mdate.city, mdate.state, mdate.lat, mdate.`long`,
       分机链接，
       ext.source、ext.pre、meta、mdate.img
从分机
右外连接（
  选择 media.bid,
         media.date, media.time, media.title, users.name, users.img, users.rank, media.address,
         media.city, media.state, media.lat, media.`long`,
         GROUP_CONCAT(tags.tagname SEPARATOR ' | ') 作为元
  来自媒体
  在 media.bid = users.bid 上加入用户
  LEFT JOIN tags ON users.bid=tags.bid
  在 -122.52224684058 和 -121.79760915942 之间的“长”
    和 37.07500915942 和 37.79964684058 之间的纬度
    AND 日期 = '2009-02-23'
  GROUP BY media.bid, media.date
  ORDER BY media.date, users.rank DESC
  限制 0, 30
) mdate ON (mdate.bid = ext.bid AND mdate.date = ext.date)

```

呸！

所以，正如你所看到的，如果我正确理解了我的问题，我有两个没有索引的派生表（我不否认我可能以某种方式搞砸了 Join 语句，但我一直在搞乱不同的类型，这结束了吗给我我想要的结果）。

创建与此类似的查询的最佳方法是什么，这将使我能够利用索引？我敢说，我实际上还有一张桌子可以在以后添加到组合中。

目前，我的查询需要 0.8 秒才能完成，但我确信如果我可以利用索引，这可能会快得多。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T19:52:01.693

新鲜开始：

问题 - 为什么要同时按 media.bid 和 media.date 分组？投标可以有多个日期的记录吗？

这是一个更简单的尝试版本：

> ```
> SELECT 
>     mdate.bid,
>     mdate.fid,
>     mdate.date,
>     mdate.time,
>     mdate.title,
>     mdate.name, 
>     mdate.address,
>     mdate.rank,
>     mdate.city,
>     mdate.state,
>     mdate.lat,
>     mdate.`long`,
>     ext.link, 
>     ext.source,
>     ext.pre, 
>     meta,
>     mdate.img,
>     (   SELECT GROUP_CONCAT(tags.tagname SEPARATOR ' | ')
>         FROM tags 
>         WHERE ext.bid = tags.bid
>         ORDER BY tags.bid GROUP BY tags.bid
>     ) AS meta
> 
> FROM 
>     ext
> 
> LEFT JOIN
>     media ON ext.bid = media.bid AND ext.date = media.date
> 
> JOIN
>     users ON ext.bid = users.bid
> 
> WHERE 
>     `long` BETWEEN -122.52224684058 AND -121.79760915942
>     AND lat BETWEEN 37.07500915942 AND 37.79964684058
>     AND ext.date = '2009-02-23'
>     AND users.userid IN
>     (    
>         SELECT userid FROM users ORDER BY rank DESC LIMIT 30
>     )
> 
> ORDER BY 
>     media.date, 
>     users.rank DESC
>     LIMIT 0, 30 
> ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T20:08:54.557

首先，检查`ext(bid, date)`,`users(bid)`和上的索引`tags(bid)`，你真的应该拥有它们。

但是，它似乎是`LONG`并且`LAT`会导致您遇到大多数问题。您应该尝试将`LONG`and保留`LAT`为，在此列上创建 a并像这样查询：`(coordinate` [`POINT`](http://dev.mysql.com/doc/refman/5.0/en/mysql-spatial-datatypes.html)`)``SPATIAL INDEX`

```
WHERE MBRContains(@MySquare, coordinate) 
```

如果由于某种原因无法更改架构，您可以尝试创建包含`date`作为第一个字段的附加索引：

```
CREATE INDEX ix_date_long ON media (date, `long`)
CREATE INDEX ix_date_lat ON media (date, lat) 
```

这些索引对您的查询会更有效，因为您使用精确搜索 on`date`结合范围搜索 on `axes`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T05:45:32.797

您可能希望将您的性能与为每个选择使用临时表进行比较，并将这些表连接在一起。

创建表#whatever 创建表#whatever2

插入 #whatever 选择... 插入 #whatever2 选择...

选择 #whatever 加入 #whatever 2

……

删除表 #whatever 删除表 #whatever2

如果您的系统有足够的内存来保存完整的表，这可能会更快。这取决于你的数据库有多大。

# zend-framework - Zend_Form_Element_Text 过早引发错误

> ID：579064
> 
> 赞同：0
> 
> 时间：2009-02-23T19:50:42.790
> 
> 标签：zend-framework, zend-form

这是我的代码

```
$firstname = new Zend_Form_Element_Text('firstname', array('id' => 'firstname'));
$firstname->setLabel('Firstname')
        ->addError('Your firstname.')
        ->addFilter('StringTrim')
        ->addFilter('StripTags')
        ->addValidator('StringLength', false, array(1))
        ->setRequired(true);
$form->addElement($firstname); 
```

加载页面后，addValidator 会立即触发，并显示错误消息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T08:11:06.190

我认为您希望将“消息”参数设置为您的验证器，而不是表单元素上的 addError() （它完全按照您的要求执行）。

不确定您是否可以在“建筑”中做到这一点，但类似于：

```
$firstname->getValidator('StringLength')->setMessages(array( 
  'stringLengthTooShort' => '%value% whatever message'
)); 
```

另外-您似乎正在通过测试至少1个字符长来测试字符串是否为空。您可能想切换到“NotEmpty” - 很确定这会起作用：

```
$firstname->addValidator('NotEmpty',true, array('messages'=>'Please Provide your First Name')); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T20:34:26.507

我现在无法测试，但我相信你应该使用`addErrorMessage()`而不是`addError()`. 请参阅[手册](http://framework.zend.com/manual/en/zend.form.forms.html#zend.form.forms.validation.errors)和[API 文档](http://framework.zend.com/apidoc/core/Zend_Form/Element/Zend_Form_Element.html#sec-method-summary)。

`addError()`将元素标记为无效并设置错误消息，同时`addErrorMessage()`设置在元素无效时应使用的消息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T16:59:52.993

您应该在添加验证器时指定消息（通过配置数组中的消息键）。addError($yourErrorString) 和 addErrorMessage($messageIdentifier) 都会将元素标记为无效。检查有关翻译来自验证器的消息的手册...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-24T14:31:00.553

Even if I use addErrorMessage() the addValidator is firing immediately.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T23:05:23.663

您使用的是哪个版本的 Zend Framework？
你在代码中的任何地方调用 $form->isValid()

# moq - 使用 Moq 模拟数据集

> ID：579075
> 
> 赞同：8
> 
> 时间：2009-02-23T19:52:38.853
> 
> 标签：moq

我正在尝试开始使用最小起订量，但无法找到任何好的资源来做我需要的事情。

我有一个数据接口类，它有一个通过存储过程返回数据集的 Get 方法。这就是代码的编写方式，我目前无法更改它，因此必须以这种方式完成。

我想通过模拟数据集并返回数据来测试这个类，这样我就不必实际进行数据库调用。

有没有人这样做，如果有的话，从哪里开始做呢？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T21:19:50.203

您不需要数据库连接来填充 DataSet。你可以像这样模拟它：

```
IDataInterface di = new Mock<IDataInterface>();
DataSet mockDataSet = CreateMockDataSet();
di.Expect(x => x.Get()).Returns(mockDataSet);
something.UseDataInterface(di.Object); 
```

但是，填充模拟 DataSet 是相当痛苦的。如果我这样做，我一般会在返回的DataSet前面放一个facade interface，这样更容易mock。或者我把代码改成使用DataTable，这样更容易填写。

或者，为您的单元测试使用嵌入式数据库，例如 SQLite 或 SQL Server CE。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2018-04-23T05:24:31.127

我也遇到了上述问题并提出了这个解决方案。我分享它是因为我无法在谷歌上找到任何东西：

```
[TestCategory("GetDataSet")]
[TestMethod]
public void GetDataSet_ValidCall_ShouldPass()
{
    // Arrange

    var dataSet = Builder<DataSet>.CreateNew().Build();

    DataTable table1 = new DataTable();
    table1.Columns.Add("Id", typeof(int));
    table1.Columns.Add("Name", typeof(string));
    table1.Rows.Add("1", "Name1");

    DataTable table2 = new DataTable();
    table2.Columns.Add("More", typeof(bool));
    table2.Rows.Add(false);    

    dataSet.Tables.Add(table1);
    dataSet.Tables.Add(table2);

    objectWhichHaveProcMethod.Setup(elem => elem.ExecuteProcAndGetDataSet("YourSprocName", It.IsAny<SqlParameter>(), It.IsAny<SqlParameter>())).Returns(dataSet);

    // Act
    var response = dataInterfaceClass.Get();

    // Assert  
    Assert.AreNotEqual(response, null);
} 
```

# visual-studio - VC++ 速成版中的类向导问题

> ID：579083
> 
> 赞同：0
> 
> 时间：2009-02-23T19:54:16.917
> 
> 标签：visual-studio, visual-c++

我刚刚开始使用 Visual C++，但我遇到了障碍。我正在尝试创建一个新类，所以我右键单击我的项目，添加|类，C++ 类，并将其称为“片段”。这将创建“piece.h”和“piece.cpp”。到现在为止还挺好。但是，当我尝试在 main.cpp 文件中包含“piece.h”时，编译时我得到

```
fatal error C1083: Cannot open include file: 'piece.h': No such file or directory 
```

谁能告诉我我做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T20:20:01.783

您是否在#include 中使用引号“”或尖括号<>？尖括号不会在本地目录中搜索，因此您会错过在那里创建的包含文件。

[http://msdn.microsoft.com/en-us/library/36k2cdd4.aspx](http://msdn.microsoft.com/en-us/library/36k2cdd4.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T23:43:21.420

问题在于项目的设置方式。我从头开始制作了一个新的，现在一切正常。

# javascript - JavaScript 正则表达式替换？

> ID：579084
> 
> 赞同：2
> 
> 时间：2009-02-23T19:54:38.723
> 
> 标签：javascript, regex

我正在尝试提出一个正则表达式，它将`JJDnnnnnnnnnnnnnnnn`用一个指向包含查询字符串中匹配字符串的 url 的锚点来包装字符串中所有出现的 。

我很讨厌正则表达式:(

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T20:01:03.513

要用它后面的 16 位数字替换 JJD，你可以说

```
str.replace(/(JJD[0-9]{16})/gi,"<a href='somepage.html/foo?value=$1'>$1</a>"); 
```

如果您不需要精确的 16 位数字，但需要 10-20 位数字，您可以说

```
str.replace(/(JJD[0-9]{10,20})/gi,"<a href='somepage.html/foo?value=$1'>$1</a>"); 
```

# apache-flex - 如何将相对路径添加到 FlexBuilder 的构建路径？

> ID：579092
> 
> 赞同：6
> 
> 时间：2009-02-23T19:55:45.493
> 
> 标签：apache-flex, flex3, flexbuilder

有没有办法向 FlexBuilder 的相对构建路径添加条目？

我将有多个项目将使用共享代码库，但我无法让它们引用该共享代码。我可以用绝对路径来做到这一点，但这不会很好。这段代码（和项目）将进入源代码控制，而我团队中的其他人可能没有像我那样在硬盘驱动器上的相同位置拥有存储库。因此，虽然定义的路径可以在我的机器上运行，但它不会在其他开发人员的机器上运行。

FlexBuilder 的 UI 不允许我输入相对路径。我尝试手动修改 .project 和 .actionScriptProperties 文件以添加相对路径，但随后项目无法打开。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T08:38:31.540

我个人在我的 flex 项目根目录的 libs 文件夹中设置了一个[svn external 。](http://svnbook.red-bean.com/en/1.0/ch07s03.html)然后我会通过转到 {ROOT_PROJECT_FOLDER}>Properties>Flex Build Path>Source Path> Add Folder 添加对源路径的引用 - 然后添加 libs 文件夹（然后应该与您的项目相关）。希望在每次新结帐时，您都应该获得外部库并拥有项目的正确引用。做到这一点有点繁琐，但你最终会到达那里。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-22T15:23:58.087

我很幸运，只是`.actionScriptProperties`自己手动编辑并添加了相关路径：

```
<compilerSourcePathEntry kind="1" linkType="1" path="../utils/src"/>
...
<libraryPathEntry kind="1" linkType="1" path="../utils/libs"/> 
```

然而，这*确实*有一个缺点，即 FlexBuilder 不够聪明，无法意识到何时更改了链接源；由`.project`（FlexBuilder 不是很棒吗？）处理。

`.project_skel`为了解决这个问题，在将项目导入 FlexBuilder 之前，我已将文件提交给开发人员复制到适当位置的源代码控制，修复绝对路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T14:06:04.123

我最终做的是正常创建项目，然后重命名项目文件以在它们的末尾添加一个“-template”。我将它们与 readme.txt 一起签入，其中详细说明了需要对模板文件进行的更改，以使它们可用作项目文件。

因此，当用户第一次获得该项目的最新信息时，他们将不得不从模板创建 FlexBuilder 项目，但希望在那之后他们将不需要接触它。

我必须注意的一件事是项目参考。最初我的项目引用了另一个 FlexBuilder 项目。我发现尊重 SWC 本身而不是项目更容易。

几乎不是最佳解决方案，但鉴于 FlexBuilder 无法处理相对路径，这是我能想到的最佳解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-03T22:15:48.383

如果我了解您想要什么，两种方法中的一种可能会起作用（我使用的是 Flex builder 3）：

选项 #1 - 创建一个 flex 构建“Flex 库项目”来保存您的共享源。在使用项目的 Properties > Flex Build Path > Library Path 中，添加“共享”项目作为参考。

选项 #2 - 将目录添加到项目的 Properties > Flex Build Path > Source Path。如您所述， builder 使用完全限定的路径。我保存了项目，退出了 Flex Builder 并编辑了 .actionScriptProperties - 神奇的似乎是使用工作区中一个项目的名称，就好像它是完全限定的：尝试更改：

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-02-24T05:26:23.717

你试过`Import Project`选项吗？

# c# - 如何在 C# 中通过网络提供单例对象？

> ID：579096
> 
> 赞同：0
> 
> 时间：2009-02-23T19:57:20.107
> 
> 标签：c#, singleton

我正在为一个学校项目用 C# 创建一个纸牌游戏。这个纸牌游戏是联网的。纸牌游戏的游戏数据作为 gameData 存储在单例对象中。gameData 包含玩家姓名、游戏正在等待的玩家、玩家对象。每个玩家有 3 个 List 对象。卡片又是自定义对象。最初我打算为每个卡片、玩家和 gameData 对象创建一个 ToByte() 方法，并使用 TCPlistener 将它们序列化以通过网络发送。但是时间不多了，我正在寻找其他方法。

这些是我听说过的解决方案：

-SOAP（不知道如何实现）

- 数据库（对于 LAN 来说似乎有点过分了，除非可以让小型数据库服务器即时运行）

-客户端激活对象（但这会为每个客户端创建不同的单例）

我想做的是让每个客户端都使用他们自己的游戏数据，但使用 get, set 它会与托管这个单例对象数据的服务器对话。你有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T20:38:42.097

WCF 支持单例服务

```
[ServiceBehavior(InstanceContextMode = InstanceContextMode.Single)] 
class MySingleton : ...
{...} 
```

这样，您就有了一个服务于所有客户的服务实例。

WCF 使得用很少的网络代码进行网络通信变得容易。

查看[这篇文章](http://msdn.microsoft.com/en-us/magazine/cc163590.aspx)了解更多详情。

将单例实例与您找到的任何 WCF 教程相结合，您应该有一个很好的起点。

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T20:06:56.167

由于这是一个学校项目，我认为使用 .NET 远程处理是最快的方法:)

为了使事情变得简单并减少令人讨厌的调试和对象管理的东西，我建议使用单例对象处理服务器上的所有内容，并将值对象作为数据返回给客户端（同样，因为它是一个学校项目）。给每个客户端一个 ID 以传递给服务器对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T20:22:08.127

.net 远程处理或多或少是为您所要求的那种事情而构建的，但不一定是您需要的。

对类的任何远程访问都会在线路的另一端留下一个“单例”，实际上根本不是单例，而是本地内存中的代理存根。

在您的情况下，我会添加一个服务类（可能的 Web 服务），它接受入站请求并将它们应用于服务器端的单例，然后返回所需的数据。这将为您节省调试痛苦的世界。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T20:26:08.540

我会完全避免单身。远程处理不仅是一种痛苦，而且通常被认为是一种糟糕的设计模式。这里有很多关于 SO 以及网络上关于为什么单例不好的讨论。我认为，尤其是在这种情况下，如果单例会给您带来问题，请避免使用它。

[编辑] 避免单例的主要动机之一是单例提供了一个共享的全局状态，这是单元测试的敌人。尽可能避免它。

# python - 是否有传播错误和警告细节的模式？

> ID：579097
> 
> 赞同：6
> 
> 时间：2009-02-23T19:58:15.300
> 
> 标签：python, design-patterns, error-handling, warnings

是否有传播错误和警告细节的通用模式？*我所说的错误*是指应该导致代码流停止的严重问题。*警告*是指值得通知用户问题的问题，但太微不足道而无法停止程序流程。

我目前使用异常来处理硬错误，并使用 Python 日志框架来记录警告。但是现在我想在当前正在处理的记录的数据库字段中记录警告。我想，我希望警告以与异常相同的方式冒泡，但不会停止程序流。

```
>>> import logging
>>>
>>> def process_item(item):
...     if item:
...         if item == 'broken':
...             logging.warning('soft error, continue with next item')

...     else:
...         raise Exception('hard error, cannot continue')
...
>>> process_item('good')
>>> process_item(None)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 6, in process_item
Exception: hard error, cannot continue
>>> process_item('broken')
WARNING:root:soft error, continue with next item 
```

*这个例子（和我当前的问题）是在 Python 中，但它也应该适用于其他语言，但也有例外。*

* * *

按照[David](https://stackoverflow.com/users/56541/david)的建议和对下面示例的简要介绍，Python 的`warnings`模块是要走的路。

```
import warnings

class MyWarning(Warning):
    pass

def causes_warnings():
    print 'enter causes_warnings'
    warnings.warn("my warning", MyWarning)
    print 'leave causes_warnings'

def do_stuff():
    print 'enter do_stuff'
    causes_warnings()
    causes_warnings()
    causes_warnings()
    print 'leave do_stuff'

with warnings.catch_warnings(record=True) as w:
    # Cause all warnings to always be triggered.
    warnings.simplefilter("always")
    # Trigger a number of warnings.
    do_stuff()
    # Do something (not very) useful with the warnings generated
    print 'Warnings:',','.join([str(warning.message) for warning in w]) 
```

输出：

```
enter do_stuff
enter causes_warnings
leave causes_warnings
enter causes_warnings
leave causes_warnings
enter causes_warnings
leave causes_warnings
leave do_stuff
Warnings: my warning,my warning,my warning 
```

注意：Python 2.6+ 是`catch_warnings`.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T20:05:54.827

查看 Python 的`warnings`模块，[http://docs.python.org/library/warnings.html](http://docs.python.org/library/warnings.html)

如果不指定语言，我认为您不能对这个问题说太多，因为非终端错误处理因一种语言而异。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-23T20:00:00.130

严重错误应该冒泡，警告应该就地记录而不抛出异常。

# asp.net-mvc - 将 ASP.NET MVC 应用程序部署到 IIS7 并保持干净的 web.config

> ID：579107
> 
> 赞同：6
> 
> 时间：2009-02-23T20:03:32.993
> 
> 标签：asp.net-mvc, iis, deployment, iis-7

我想将我的 ASP.NET MVC 应用程序部署到网络托管公司（如 DiscountASP.net）。我对 Web 服务器上的 web.config 文件中需要包含的内容感到困惑。当我在本地创建项目时，我会得到一个臃肿的 web.config，其中包含各种附加模块、处理程序、编译器。我是否需要将所有这些项目添加到生产 web.config 文件中？

我仍在 IIS6 中部署我当前的 ASP.NET 应用程序（不是 MVC），我一直为生产环境手工制作一个简单的 web.config 并将其与其余应用程序文件一起上传。似乎对于 IIS7，我打算使用 Web 服务器上的 IIS 管理器来构建 web.config。在生产服务器上构建/管理 web.config 的最佳方式是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T14:58:08.217

因此，到目前为止，这是我在尝试将 MVC 应用程序部署到 DiscountASP.net 时发现的。

我发现的第一个想法是我必须确保 System.Web.Mvc 已部署到 bin，因为它没有安装在 GAC 中：

[http://haacked.com/archive/2008/11/03/bin-deploy-aspnetmvc.aspx](http://haacked.com/archive/2008/11/03/bin-deploy-aspnetmvc.aspx)

然后我从一个超级基本的 web.config 开始，它只包含数据库连接字符串。我的应用程序不起作用。

然后，我将本地 web.config 的混乱复制到服务器并更改了数据库连接字符串，一切开始工作，但我仍然收到错误消息：

```
Could not load type 'System.Web.Mvc.ViewPage<MyCustomModel>' 
```

然后我发现这篇文章解释了您需要如何更改 web.config 以支持不使用代码隐藏文件（由于某种原因，您不需要使用本地 Visual Studio Web 服务器执行此操作）：

[http://blog.benhall.me.uk/2009/01/aspnet-mvc-rc1-removing-code-behind.html](http://blog.benhall.me.uk/2009/01/aspnet-mvc-rc1-removing-code-behind.html)

就个人而言，我不喜欢简单的应用程序设置（如连接字符串和 SMTP 设置）与复杂的 MVC（和 AJAX.NET）基础设施设置混在一起。一个不错的选择是托管公司（例如 DiscountASP.net）设置 Master.config（或更高级别的 web.config）以支持 MVC，这样我的 web.config 只需要包含我的简单应用程序设置。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T20:24:26.827

.Net 3.5 和 IIS7 都向 web.config 添加了相当多的文本。我所做的是使用 IIS7 中的 IIS 管理器来配置应用程序一次。然后我将修改后的 web.config 重新检入到源代码管理中。这样，在环境之间迁移时，所有 IIS 设置都会被保留。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-24T19:31:27.540

System.Web.Extensions 是 MS AJAX AKA Atlas 的东西，有几个模块和处理程序以及与此程序集相关的部分。如果您不使用 MS AJAX 的东西，请随意删除它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T20:19:09.227

也许你采取了一种搜索和销毁的方法，并削减配置，直到你删除了所有你不需要的东西。在不了解您的应用程序及其依赖项的情况下，很难说出您可能需要或不需要什么。

最好的方法是始终拥有一个尽可能地反映您的生产环境的开发环境——您不想以这种方式编辑生产配置。

# java - 使用哪个富客户端平台

> ID：579109
> 
> 赞同：15
> 
> 时间：2009-02-23T20:03:55.177
> 
> 标签：java, osgi, rcp

我们最近开始开发 Java 桌面应用程序，管理层要求我们使用富客户端平台。我知道Java有四个：

1.  Eclipse RCP - [www 链接到 ecipse rcp](http://wiki.eclipse.org/index.php/Rich_Client_Platform)，
2.  Netbean RCP - [Netbeans RCP 网站](http://platform.netbeans.org/)，
3.  Spring RCP -[春天富客户端](http://spring-rich-c.sourceforge.net/1.0.0/index.html)
4.  Valkyrie RCP - [Valkyrie 富客户端](https://www.gitorious.org/valkyrie-rcp/pages/Home)

有没有人在这些方面有任何经验，如果有，每个方面的优势和劣势是什么？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-27T13:33:26.713

INTRO - 如果您只对结果感兴趣，请跳过；)
我正在为与 JSP 非常相似的自定义编程语言开发一个编辑器。首先，我使用**NetBeans 平台**将编辑器实现为我的论文。完成学业后，我找到了一份工作，他们希望我在**Eclipse RCP**中实现相同的东西，所以现在我至少可以比较这两个平台，至少在我在这个项目中遇到的问题上。

结果 -**如果我可以在 Netbeans 平台和 Eclipse RCP 之间进行选择，我肯定会选择 NetBeans 平台**。为什么？
很棒的截屏视频，很好的教程，非常活跃的友好和乐于助人的社区，有很好的文档记录，源代码写得很好，并且具有良好的代码约定。还有一些有趣的小工具（cookies、查找）。它很适合我。

为什么 Eclipse RCP 不适合我？
文档较弱，约定和 API 有时..ehm..对我来说太奇怪了 :-) 看到以下方法很常见：

```
/**
* Returns a description of the cursor position.
*
* @return a description of the cursor position
* @since 2.0
*/
protected String getCursorPosition() {
..
} 
```

好吧，我认为他们一定是在开玩笑 :-D 我应该如何使用这种方法？或者像这样：

```
/**
* Returns the range of the current selection in coordinates of this viewer's document.
*
* @return a <code>Point</code> with x as the offset and y as the length of the current selection
*/
Point getSelectedRange(); 
```

尽管属性的数量和类型很合适，但我找不到 Point 对象存储范围的理想数据结构；-)

Eclipse RCP 中有很多这样的惊喜

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-08-04T10:48:40.763

回答太晚了，但有些人可能会点击此页面。

我会选择 Netbeans RCP，1）Netbeans 平台。它相当成熟并且已经发展成为一个用于开发应用程序的“易于使用”的平台。

2)它很容易上手，而eclipse RCP的学习曲线相当陡峭。去吧，[http://netbeans.org/kb/trails/platform.html](http://netbeans.org/kb/trails/platform.html)，那里有教程、视频（一定要看前 10 个 api 的视频，并在阅读书籍之前尝试教程，这样你就会掌握事前）。

3）有关 netbeans RCP 的书籍（我猜有 2 个有关 netbeans RCP 的书籍）是最新的（只有小改动，您不会有太多问题）。而关于 RCP 的主要书籍很长一段时间都没有（最近。也就是 2010 年 5 月，新版本已经发布，所以这对 eclipse RCP 开发人员来说是一件非常好的事情。当我尝试时它不存在学习它。我对不发布新版本的作者感到沮丧，几乎让新开发人员陷入困境。不是每个人都喜欢阅读文档。不发布更新的书籍几乎等于扼杀技术）。我很想看到一本适用于这两个平台的食谱类型的书。

4)Netbeans 有完全集成的GUI builder，这是一大优势。Eclipse RCP，要么您必须手动编写代码，要么购买一些第三方 GUI 构建器。

5)Netbeans 平台有这个非常酷的 Lookup api 用于模块间通信。我猜 Eclipse 家伙为此目的使用扩展点。但是一旦你掌握了它，lookup api 就很容易了。

6）无论如何，这是一个重大的设计决定，关于选择哪个平台。Netbeans 平台适合我。它可能不适合你。这两个平台都需要努力，都提供了出色的“开箱即用”功能。两者都试驾再决定。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-24T05:08:35.147

我建议您看一下 JSR 296 - 它还没有完全完成，但我认为它提供了您在每个 Java GUI 应用程序中真正需要的某些核心功能，而不会强迫您生活在其中一个过于复杂的框架。

我已经成功地使用 JSR 296 创建了一个中型应用程序。对于此应用程序中的窗口布局，我们使用[MyDoggy](http://mydoggy.sourceforge.net/)（强烈推荐）。对于布局管理，我们使用 MiGLayout（强烈推荐）。对于数据绑定，我们使用 JSR 295 的修改形式（我们在用于 GUI 绑定的 JSR 295 之上实现了类似于[PresentationModel的东西）。](http://martinfowler.com/eaaDev/PresentationModel.html)我正在将 Guice 作为 DI 机制合并，但还没有完成这项工作（到目前为止，我认为它会与 JSR 296 一起“玩得很好”，并在此处和那里进行调整）。让我们看看......持久性是这里缺失的重要环节——我目前正在评估[Simple](http://simple.sourceforge.net/)的 XML 持久性，但在让它与 Guice 等 DI 容器一起工作时遇到了问题。我有[Betwixt](http://commons.apache.org/betwixt/)工作，但对 Betwixt 的依赖很大，所以我们正在寻找更精简的东西。

关于 Java 的其他 RCP 选项的意见：

NetBeans：我对 NetBeans 使用的方法有一些基本的哲学反对意见（太多的设计反模式不符合我的口味）。最后，该框架迫使您做出糟糕的设计决策——如果您不使用 NetBeans 作为您的 IDE（我尝试过，但我无法从 Eclipse 切换到 NB），它几乎是不可能使用的。可能只有我一个人，但似乎应该可以为 RCP 框架编写代码，而无需使用大型复杂的向导和大量自动生成的代码和 XML 文件。我花了很多时间对 Visual Studio 生成的旧 Visual C++ 代码进行故障排除，以至于我对任何无法手动编码的框架都非常谨慎。

Spring RCP：Spring 的人有一个很好的可靠设计，但是文档真的非常薄弱。加快速度是相当困难的（但是一旦你做到了，你就可以很快地完成工作）。

Eclipse RCP：仅仅因为部署开销而没有使用 Eclipse（取决于您的目标受众 - 对我们来说，部署额外的 50 MB 运行时是行不通的）。毫无疑问，如果您的应用程序需要重要的插件功能（当然，您也可以使用 JSR 296 运行 Equinox，或者使用类似于 OSGi 推广的白板模式的设计模式），那么 Equinox 是一件好事。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-23T20:45:49.677

我有 Eclipse RCP 的经验并会推荐它。

优点：

*   组件 - 组件/插件模型允许重用。
*   使用[SWT](http://www.eclipse.org/swt/)和 JFace，这允许具有原生外观的 UI
*   可插入视图、编辑器和透视图使布局变得简单且可配置。
*   Eclipse 扩展点使与 3rd 方 API 和工具的扩展和集成变得容易。

缺点：

*   学习曲线

如果您选择 Eclipse RCP，请务必获得这本书，这在刚开始使用该框架时非常宝贵：http: [//www.amazon.com/Eclipse-Rich-Client-Platform-Applications/dp/0321334612](https://rads.stackoverflow.com/amzn/click/com/0321334612)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-05-25T13:04:24.613

我目前正在开发一个 Spring RCP 应用程序。文档确实很薄弱，这是肯定的，但是博客和论坛有大量的信息可以开始。一旦你开始巡航，事情确实进展得相当快，如果你不熟悉框架，你真的只需要学习基本的 Spring。与 VLDocking 等 Spring 库的集成也非常出色。

如果您的用例是开发独立的 Java 桌面应用程序，我认为 Spring Rich 非常棒。我的意思是，如果您不需要分发模块和进行在线更新，那么它应该可以满足大多数需求。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T20:19:17.823

从我的最终用户的角度来看。

我在 Eclipse 中看到的实现比在其他两个中更多。实际上，我知道 Netbeans 的实现，但我从来没有掌握过。

从春天开始，这是我第一次听说它。

虽然我的回答绝对是超级 10,000 英尺的视图，但它以某种方式反映了该行业对使用其中一种或另一种的偏好。

此外，差异与平台可用的时间成正比。请记住 Eclipse 创建 SWT 是为了解决 Java Swing 在 1.3 中遇到的问题，其中它的速度简直令人望而却步。

Netbeans 受益于 JVM 的改进，现在运行非常非常快。

Spring 还很年轻（与其他两个相比），但一如既往，新事物向前者学习，使用起来可能更简单。

这是一篇关于这两个平台 Eclipse RCP 与 Netbeans RCP 的文章。可能会有所帮助

[http://blogs.oracle.com/geertjan/entry/eclipse_platform_vs_netbeans_platform](http://blogs.oracle.com/geertjan/entry/eclipse_platform_vs_netbeans_platform)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T20:27:04.217

虽然我没有明确使用它们中的任何一个，但我已经使用了 Eclipse RCP 的一部分。具体来说，我使用了 Eclipse OSGi 运行时 (Equinox) 和一些常见的实用程序，我非常满意。OSGi 非常适合使用。我有几个朋友签订了使用 Eclipse RCP（比我使用的多）的大型合同，他们对此赞不绝口。

如果我的项目不包含大量遗留的 Swing，Eclipse RCP 将是我的首选。OSGi 真是太有趣了！（我想 Spring 也使用它，但尚未检查）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-09T14:02:11.013

当然，这完全取决于您要提供的应用程序和服务的类型以及目标环境。但我也可以推荐 OSGi 作为开发和部署平台。底层架构和规范已经很好地开发和验证。

除了 Eclipse RCP，您还应该看看 Apache Felix ( [http://felix.apache.org](http://felix.apache.org) ) 和 Knopflerfish ( [http://www.knopflerfish.org](http://www.knopflerfish.org) )，它们是（较小的）开源 OSGi 框架实现。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-02-12T14:53:47.100

Netbeans RCP 非常好。多年来，它走了很长一段路。它使用许多人使用和理解的更强大的技术（“Swing”）。Eclipse RCP（更具体地说是 SWT）让我很困惑。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-06T15:20:34.767

Eclipse RCP 提供插件机制，以便您可以在以后的部署中添加新功能。此外，通过更新机制，您可以在不受用户干预的情况下更改系统。在开发阶段，Eclipse RCP 提供了一个快速、健壮的基础，包括透视图、视图、编辑器、命令和操作机制。如果您的项目需要许多具有不同工具栏和菜单（以及自定义上下文菜单）的不同窗口，我建议您使用 Eclipse RCP。我只查看 Netbeans Platform 的视频并运行 Helloworld 项目，但它看起来很慢而且很笨拙 :) 启动 40 秒（您可以重新加载应用程序，但无需重新启动。）vogella.de 是一个很好的教程集合日食 RCP

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-11-06T18:31:32.270

还有基于反射的 UI 生成和定制。

您将自定义默认生成的 GUI，而不是自定义 IDE 以满足您的需求。尝试一种新方法可能会很有趣。

[https://github.com/dotxyteam/ReflectionUI](https://github.com/dotxyteam/ReflectionUI)

# editor - vi 替换命令

> ID：579110
> 
> 赞同：4
> 
> 时间：2009-02-23T20:04:28.590
> 
> 标签：editor, command, vi, substitution

使用 vi，如何将当前行号替换为当前行？例如，如果光标在第 10 行，我想将数字 10 放在该行的某处。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T20:13:10.833

您想实际插入行号，而不仅仅是在边距中显示它？如果是这样 -

```
:s/$/\=line(".")/ 
```

这会将其附加到行尾。将 $ 替换为 ^ 以添加到该行的前面。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T20:14:54.027

首先：以下假设您使用的是 vim，而不是 vi 或类似的工作或 Heirloom 项目 vi。

这里有几个选项：

首先，如果您要使用`:s`，则将光标放在您选择的行上，然后：

```
:s/texttoreplace/<C-R>=line(".")<CR>/ 
```

where`<C-R>=`表示实际命中`Ctrl`-`R`然后键入等号。提示会改变，你可以输入：

```
line(".") 
```

然后按回车键，如 所示`<CR>`。此时，您将返回`:s` 插入行号的命令。您也可以在插入模式下执行相同的技巧 ( `<C-R>=line(".")<CR>`)。

其次，您可以使用`\=`相同的方式在正则表达式中插入行号，但这在插入模式或其他地方不起作用。

最后，如果您愿意，这些很有用`Ctrl`-`A`在插入和命令行模式下插入当前行号：

```
:imap <silent> <C-A> <C-R>=line(".")<CR>
:cmap <C-A> <C-R>=line(".")<CR> 
```

不要将静默属性添加到该`cmap`行：它会禁止将该行输出到您正在键入的命令中，直到您退格为止。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-01T10:07:36.733

我试过了

```
:s/texttoreplace/<C-R>=line(".")<CR>/ 
```

但这将文本替换为我在每一行上发出命令 (1) 时所在的行号，而不是为每一行使用不同的数字。

以下对我有用。

```
g/^/exec "s/texttoreplace/(".line(".")."/" 
```

在匹配正则表达式的每一行（即每一行）`g/^/exec`上执行给定的命令。`/^/`然后在正在处理的行的范围内评估表达式`line(".")`，而不是在键入命令时在范围内的行。

# wpf - 关于启用拼写检查的 WPF RichTextBox

> ID：579114
> 
> 赞同：0
> 
> 时间：2009-02-23T20:05:16.967
> 
> 标签：wpf, richtextbox

拼写检查.IsEnabled="真"

... wpf 应用程序中的属性，它适用于装有 SO Windows XP 和 Office 2007 的机器，但是使用 Office 2003 的 PC 有什么问题？似乎拼写检查器已禁用，这个问题可以用代码解决吗？提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T20:15:02.887

检查以确保两台机器处于相同（或受支持的语言环境），因为 SpellCheck 对象的一个​​有趣问题是它仅适用于以下语言环境：

*   英语
*   法语
*   德语
*   西班牙语

你也可以试试微软的这段代码：

```
textBox1.Language =
    XmlLanguage.GetLanguage(CultureInfo.CurrentCulture.IetfLanguageTag); 
```

# windows-mobile - 移动平台上的游戏消息？

> ID：579118
> 
> 赞同：0
> 
> 时间：2009-02-23T20:06:55.340
> 
> 标签：windows-mobile, mobile

有人对移动平台上多人游戏的消息传递有建议吗？我认为 SMS 对于普通玩家来说太贵了。

我不是在谈论大量实时消息，而只是每轮每个玩家向所有其他玩家发送一条消息。

是否有任何可用的跨平台消息传递（例如，windows mobile 与 iphone、android 等之间）？

添加信息：我的约束（可能不可靠）是它应该是对等的——不需要服务器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T20:20:14.810

如果您的移动设备有互联网连接：使用带有（restful）网络服务的网络应用程序。应该在你提到的每个平台上工作。

移动应用程序在每一轮后连接到服务器并收集消息。

我认为不存在针对移动平台的与平台无关的点对点解决方案，除此之外：它在您描述的情况下无法很好地扩展。想象：

拥有 10 个用户意味着在每一轮之后每个用户发送 9 条消息。现在想象在您的网络上有 10,000 个用户... 简短：点对点不是您正在寻找的解决方案。

# sql - 如何防止 Oracle SQLPlus 中的 SQL 注入？

> ID：579130
> 
> 赞同：1
> 
> 时间：2009-02-23T20:11:51.147
> 
> 标签：sql, oracle, batch-file, sql-injection, sqlplus

显然，如果我使用 JDBC/ODBC，我可以使用绑定变量和准备好的语句来防止 SQL 注入。但是，当数据被传递到最终调用 Oracle SQLPlus 的批处理时，有没有办法防止 SQL 注入？例如：

查询.sql：

```
select '&1' from dual;
exit; 
```

如果我这样从 SQLPlus 调用这个脚本：

```
$ sqlplus SCOTT/TIGER @query.sql "x','y" 
```

我将得到以下输出：

```
old   1: select '&1' from dual
new   1: select 'x','y' from dual

' '
- -
x y 
```

如您所见，SQLPlus 命令行参数使用简单的宏替换。有没有我想念的替代方法？否则，我如何防止它被利用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-24T02:51:22.153

如果人们对您的数据库具有 sql*plus 访问权限，并且您在脚本中拥有特权用户的用户 ID 和密码供他们阅读，那么无论如何您都只是把裤子丢给了他们。SQL 注入是您最不必担心的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T22:03:17.090

通过命令行通过 SQL*Plus 传递参数将不仅仅是 SQL 注入，因为命令行将首先通过操作系统进行解释。因此，您还需要考虑操作系统用户可能执行的操作。

就个人而言，我会放弃 SQL*Plus 并使用 Perl 之类的东西。您有一种适当的编程语言来包装您的 SQL 语句，并且可以更好地处理变量和异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T20:28:02.980

我建议改用绑定变量。在您的脚本中，您应该能够执行以下操作：

```
variable my_var varchar2(100);
begin
:my_var := &1;
end;
/
select :my_var from dual; 
```

“my_var”变量将绑定到查询。而不是简单的查找/替换。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-23T20:23:58.997

除非您将 SQL*Plus 脚本暴露给 Internet 上的恶意陌生人，否则您不会真正受到 SQL 注入攻击。真正会攻击你公司的人。

看来您是在谈论内部运行的批处理作业；完全在防火墙后面，其余的网络用户是你的同事，对吗？

除非他们是非常疯狂的反社会者，否则“攻击”没有任何意义。任何确实出现的 SQL 注入问题要么是非常糟糕的设计，要么是终止的原因。这只是对人们的访问权限和他们使用可用工具的技能的普通管理。

* * *

**编辑**

虽然我不能假装知道“由于控制字符造成的损坏”是什么意思，但我可以提供一些额外的建议。

如果你怀疑你可能有一个编程问题——通过 SQL 注入——会导致运行时中断，那么你需要一个测试环境。

克隆您的生产模式以制作测试模式。加载已知的数据子集。在测试模式上运行您的 SQL 脚本。如果您“以某种方式”将“控制字符”放入您的 SQL 脚本中，您将有一个测试脚本来演示这一点。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-10-27T10:18:21.757

您可以使用以下 SQL Plus 命令：

```
SET DEFINE OFF 
```

# tfs - 如何使用 PowerShell 更新以前 TFS 构建的构建质量？

> ID：579132
> 
> 赞同：3
> 
> 时间：2009-02-23T20:12:38.760
> 
> 标签：tfs, powershell, build

我们正在使用 TFSDeployer 来监听构建质量的变化，并在过渡到“Staging”时部署到我们的登台环境。

我想让它继续进行，并将当前构建质量为“暂存”的所有其他构建更新为“拒绝”。

这似乎是需要在 PowerShell 脚本中发生的事情，如下所示：

```
$droplocation = $TfsDeployerBuildData.DropLocation
ECHO $droplocation

$websourcepath = $droplocation + "\Release\_PublishedWebsites\CS.Public.WebApplication\"
$webdestinationpath = "\\vmwebstg\WebRoot\CreditSolutions\"

new-item -force -path $webdestinationpath -itemtype "directory"
get-childitem $webdestinationpath | remove-item -force -recurse
get-childitem $websourcepath | copy-item -force -recurse -destination $webdestinationpath

$configFile = $webdestinationpath + "web.development.config"
remove-item $configFile -force

$configFile = $webdestinationpath + "web.staging.config"
$configFileDest = $webdestinationpath + "web.config"
move-item $configFile $configFileDest -force 
```

那么，我该怎么做呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T09:51:50.900

首先将 Get-tfs 函数添加到您的脚本中：

```
function get-tfs (
    [string] $serverName = $(Throw 'serverName is required')
)
{
    # load the required dll
    [void][System.Reflection.Assembly]::LoadWithPartialName("Microsoft.TeamFoundation.Client")

    $propertiesToAdd = (
        ('VCS', 'Microsoft.TeamFoundation.VersionControl.Client', 'Microsoft.TeamFoundation.VersionControl.Client.VersionControlServer'),
        ('WIT', 'Microsoft.TeamFoundation.WorkItemTracking.Client', 'Microsoft.TeamFoundation.WorkItemTracking.Client.WorkItemStore'),
        ('BS', 'Microsoft.TeamFoundation.Build.Common', 'Microsoft.TeamFoundation.Build.Proxy.BuildStore'),
        ('CSS', 'Microsoft.TeamFoundation', 'Microsoft.TeamFoundation.Server.ICommonStructureService'),
        ('GSS', 'Microsoft.TeamFoundation', 'Microsoft.TeamFoundation.Server.IGroupSecurityService')
    )

    # fetch the TFS instance, but add some useful properties to make life easier
    # Make sure to "promote" it to a psobject now to make later modification easier
    [psobject] $tfs = [Microsoft.TeamFoundation.Client.TeamFoundationServerFactory]::GetServer($serverName)
    foreach ($entry in $propertiesToAdd) {
        $scriptBlock = '
            [System.Reflection.Assembly]::LoadWithPartialName("{0}") > $null
            $this.GetService([{1}])
        ' -f $entry[1],$entry[2]
        $tfs | add-member scriptproperty $entry[0] $ExecutionContext.InvokeCommand.NewScriptBlock($scriptBlock)
    }
    return $tfs
} 
```

接下来，实例化 TFS 对象

```
$tfs = get-tfs http://YourTfsServer:8080 
```

然后找到构建质量为“Staging”的构建

```
$builds = $tfs.BS.GetListOfBuilds("Test Project", "TestBuild") | 
where {$_.BuildQuality -eq "Staging"} 
```

最后，更新这些构建的质量

```
 foreach ($build in $builds) { $tfs.BS.UpdateBuildQuality($build.BuildUri, "Rejected") } 
```

（我还没有运行这个脚本，但你应该可以毫无问题地运行它）

有关我的博客的更多信息：[将 Team Foundation 对象模型与 PowerShell 结合使用](http://www.brokenwire.net/bw/Programming/73/using-the-team-foundation-object-model-with-powershell)

最后一个建议，如果您从 TfsDeployer 运行的脚本中更新构建质量，如果您有 Staging --> Rejected 转换的映射，您最终可能会同时运行 2 个脚本！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T10:49:02.663

这不是完整的答案，因为我对 TFSDeployer 或 PowerScript 了解不多。然而，用于 Team Build 的 .NET API 能够做到这一点。您想获取构建的[IBuildDetail](http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.build.client.ibuilddetail.quality.aspx)。最简单的方法是如果你有 BuildUri（听起来像你可能），在这种情况下，调用[IBuildServer.GetBuild](http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.build.client.ibuildserver.getbuild.aspx)应该会得到你感兴趣的构建。

IBuildServer 还具有[QueryBuilds](http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.build.client.ibuildserver.getbuild.aspx)方法，您可以调用这些方法来查找您感兴趣的构建，然后您可以在要更改的 IBuildDetails 上设置 Quality 属性，记住在每个上调用 Save() 方法一。

希望这能给您一个开始-抱歉，这不是一个更完整的答案。

# javascript - 使用 jQuery 即时创建复选框元素 - 奇怪的 IE 行为

> ID：579135
> 
> 赞同：5
> 
> 时间：2009-02-23T20:13:44.980
> 
> 标签：javascript, jquery, internet-explorer

我正在使用jQuery动态创建一些复选框元素并将它们附加到这样的节点

```
var topics = ['All','Cat1','Cat2'];
var topicContainer = $('ul#someElementId');

$.each( topics, function( iteration, item )
{
    topicContainer.append(
        $(document.createElement("li"))
        .append(
            $(document.createElement("input")).attr({
                 id:    'topicFilter-' + item
                ,name:  item
                ,value: item
                ,type:  'checkbox'
                ,checked:true
            })
            .click( function( event )
            {
                var cbox = $(this)[0];
                alert( cbox.value );
            } )
        )
        .append(
            $(document.createElement('label')).attr({
                'for':  'topicFilter' + '-' + item
            })
            .text( item )
        )
    )
} ); 
```

我遇到的问题有两个（仅在 IE 中存在）

*   复选框被添加到页面中，但当我为该值指定“真”时，它们的默认选中状态是未选中的。（使用“检查”的值进行测试没有区别）
*   执行时`alert( cbox.value );`，每次输出都是“on”。

我认为这里的核心问题是我需要一种更好的方法来设置复选框的默认选中状态，并设置它们的默认“值”属性。但是我还没有找到其他方法。

*注意：所有这些代码在 Firefox 和 Chrome 中都可以正常工作。*

这是使用 IE 7.0.5730.11 进行的 jQuery 1.3.1 测试

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-23T20:18:52.457

Internet Explorer 不希望您更改不属于 DOM 的输入的检查值。尝试在附加项目后设置选中的值，看看是否有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-10T11:34:42.933

我重用了您的一些代码，并且遇到了类似的问题

[为什么在 jquery 中为动态创建的复选框定义属性的顺序会影响其值？](https://stackoverflow.com/questions/3218898/why-does-order-of-defining-attributes-for-a-dynamically-created-checkbox-in-jquer)

我发现解决方法是简单地移动属性声明

```
type:  'checkbox', 
```

一开始即：

```
$(document.createElement("input")).attr({
type:  'checkbox', 
```

这个问题发生在我的所有浏览器中，所以我不认为它是一个 IE 问题，而是一个 jquery“东西”。对我来说，我设置附加值（之前或之后）并不重要。不同之处在于我声明输入类型的时间/地点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-06T23:24:43.427

选中复选框的“checked”属性不具有 true 状态，它具有字符串“checked”状态。我通常使用 jQuery 向 DOM 添加元素：

```
var el = $('<input type="checkbox" id="topicFilter-' + '"'
         + ' checked="checked" />');
$(topicContainer).append(el); 
```

无论如何，IMO 更易读，读起来像 HTML。如果它在 IE 中也不起作用，我会被诅咒的，我多年来一直这样做。

# c++ - 如何检查 Visual Studio C++ 中的内存是否已释放？

> ID：579151
> 
> 赞同：3
> 
> 时间：2009-02-23T20:18:19.463
> 
> 标签：c++, visual-studio-2008, winapi, memory-management

我想检查我的所有内存在 C++ 中的 Visual Studio 2008 中是否已正常释放。我听说我可以添加一些包含，也许可以编写一些代码行，这应该可以。

有谁知道我该怎么做？

提前致谢，

格雷格

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T20:38:31.613

像这样的东西可能是你正在寻找的东西。

```
#define _CRTDBG_MAP_ALLOC
#include <stdio.h> 
#include <crtdbg.h>

int main()
{
    malloc(100);
    _CrtDumpMemoryLeaks();
    return 1;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T21:23:33.847

最古老的方法之一是覆盖 new 和 delete 运算符（假设所有堆分配都是通过 new 完成的）。打印输出策略性地放置在过载的新操作符和删除操作符中，让您帮助确保在退出之前进行清理。但这可能有点棘手。你会很想在全局范围内重载 new 和 delete 。但这可能会造成其他未解释的错误。（当然，您将在调试模式下仅使用重载运算符，好的）将其保留在您的类范围内。

另一种聪明的方法是使用 auto_ptr。您要确保删除的指针存储在堆栈上的 auto_ptr 模板对象中。因此，当此对象超出范围时，它会获取与其一起存储的指针。

如果您仍然担心泄漏，请尝试使用 windbg 进行学习。它是一个很棒的工具，可以帮助您识别内存泄漏。我发现找出由手柄引起的泄漏非常有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T20:39:45.340

包括“crtdbg.h”

并使用

_CrtDumpMemoryLeaks()

您可以在 crtdbg 中查找其他可能有用的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T22:04:44.527

我正在为 VC++ 2003 寻找一个类似的工具，并通过软件验证 ( [www.softwareverify.com](http://www.softwareverify.com/) ) 遇到了 MemoryChecker。不是免费的，但价格非常合理（低于 Purify and Bounds Checker）。我仍在评估它，但我使用的部件看起来非常令人印象深刻。30 天免费试用。

您可以跟踪内存错误（删除而不是 delete[] 等）、内存泄漏、内存热点等......以前没有使用过类似的东西，我发现它非常酷:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T22:24:23.590

[CodeProject](http://www.codeproject.com)上有一个不错的（免费）实用程序类，可以帮助进行[内存泄漏检测](http://www.codeproject.com/KB/cpp/MemLeakDetect.aspx)。在处理一些充满内存泄漏的遗留代码时，我发现它非常有用。

为了避免使用 auto_ptr 和[RAAI](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)在新代码中泄漏，一般是要走的路。

# c# - 接口可以替代 C# 中的多重继承吗？

> ID：579159
> 
> 赞同：0
> 
> 时间：2009-02-23T20:19:48.290
> 
> 标签：c#

接口可以替代 C# 中的多重继承吗？

编辑：这是一个副本：[https ://stackoverflow.com/questions/579090/why-c-doesnt-support-multiple-inheritence-can-interfaces-be-used-as-a-substi](https://stackoverflow.com/questions/579090/why-c-doesnt-support-multiple-inheritence-can-interfaces-be-used-as-a-substi)

与以下内容重复：[C# 是否应该具有多重继承？](https://stackoverflow.com/questions/191691/should-c-include-multiple-inheritance)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T20:21:34.463

多重继承意味着您从多个基类继承功能。由于接口定义了接口，而不是实现，所以答案是否定的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T20:25:53.640

在某种程度上，是的。继承提供的经典“is-a”关系可以通过使用接口进行扩展。意思是，如果一个类继承自另一个类，并实现了 3 个接口，则可以将此类的一个对象传递给以基类或三个接口中的任何一个作为参数的方法。所以，从某种意义上说，这个类“是”四种不同事物之一。说得通？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T20:28:51.700

从概念上讲，接口可以让您与其他类别的类有多个 is-a 关系。这是使用多重继承的部分原因。

例如，

```
public class TradeReport : IReport, ITrade, IComplianceRecord 
```

如果上面的类有意义地实现了所有三个接口的方法，您就可以用它来描述报告、交易和合规记录。

但是，这就是极限。接口中没有实现继承。

# .net - POLL：您如何称呼您的业务层基础命名空间？

> ID：579166
> 
> 赞同：1
> 
> 时间：2009-02-23T20:21:21.110
> 
> 标签：.net, visual-studio

我有以下项目的简单解决方案（基本命名空间与项目名称匹配）...

MyCompany.MyProduct.BusinessLayer
MyCompany.MyProduct.Web.Service
MyCompany.MyProduct.Web.Site

我只是想为 BusinessLayer 找到一个更好的名称，我只是出于某种原因不太喜欢它。所以我的问题是您如何称呼您的 BusinessLayer 项目/命名空间。

关于命名空间指南的文章 [http://msdn.microsoft.com/en-us/library/ms229026.aspx](http://msdn.microsoft.com/en-us/library/ms229026.aspx)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T20:27:36.803

我会删除“层”后缀：MyCompany.MyProduct.Business

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T20:35:31.573

我们只使用 BL，因为它代表业务层和 BudLight。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T20:25:46.090

过去我只是称其为“业务”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-05-21T11:43:55.960

为什么首先以与命名空间的一对一关系直接映射层？分层是一种分解复杂软件系统的技术。这是一种看到主要子系统像蛋糕一样排列的方式，其中每一层都位于较低的层上。较高层使用较低层的服务，但较低层不知道较高层。一个应用程序可以很容易地拥有每个主题领域（演示、业务、数据源）的多个包。

例如，在 Web 应用程序中，HTML 和 CSS 是表示层的一部分，但这些文档都不会驻留在 MyCompany.MyProduct.PresentationLayer 命名空间中。

因此，回答您的问题“您将业务层基础命名空间称为什么？” 绝对没有。这样的命名空间不应该存在。命名空间应按功能命名。*业务层*不是*功能*。*表示层、数据层或服务层*都不是。

只是我的两个位。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T20:25:32.393

我们的是：

```
CompanyName.CentralClassLibrary
CompanyName.Utilities.*
CompanyName.TradingTools.* 
```

第一个主要是来自我们应用程序原始版本的类，它们描述了中央交易对象。第二个是提供非交易特定功能（配置、多机等）的类。第三个是针对特定交易领域的类（一个用于我们与之交谈的每个服务，一个用于计算价值等）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T20:30:14.223

我做 Client.Project.BusinessObjects

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T20:36:01.543

在 Java 中，我使用`com.companyname.applicationname.*`“标准”，尽管它有点过时。

在 C# 中，我使用这种`CompanyName.ApplicationName.*`方法。

在这两种情况下`*`，通常都是`business`针对业务层、`data`针对数据层等等。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T20:44:23.817

我们的业务逻辑和数据访问层

公司名称.应用程序名称.BLL 公司名称.应用程序名称.DAL

另一种可能是 BusObj 或类似的东西。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T21:02:30.167

Company.Product.FunctionalDomain.Biz

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T21:05:18.600

我已经看过 BusinessLogic，但是正如这里的其他答案所指出的那样，很多时候你会看到......

*   MyCompany.MyProduct.DataAccessLayer（或 DAL）
*   MyCompany.MyProduct.BusinessEntities（或 BusinessObjects）
*   我的公司.我的产品.业务逻辑
*   我的公司.我的产品.Web.服务
*   我的公司.我的产品.网站

这类东西的另一个很好的参考是《[框架设计指南》](https://rads.stackoverflow.com/amzn/click/com/0321246756)一书。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-23T21:14:35.833

我们开发的大多数应用程序都将 DAL 用于数据访问层，将 BR 用于业务规则......

# sql - 使用嵌套的 group-by/having 子句进行复杂连接？

> ID：579175
> 
> 赞同：1
> 
> 时间：2009-02-23T20:24:48.760
> 
> 标签：sql, join, group-by, having

我最终需要一个“导入”记录列表，其中包括每个只有一首“歌曲”的“专辑”记录。

这就是我现在正在使用的：

```
select i.id, i.created_at 
from imports i 
where i.id in (
    select a.import_id 
    from albums a inner join songs s on a.id = s.album_id
    group by a.id having 1 = count(s.id)
); 
```

嵌套选择（带有连接）非常快，但外部“in”子句非常慢。

我试图使整个查询成为单个（无嵌套）连接，但遇到了 group/having 子句的问题。我能做的最好的就是列出带有欺骗性的“导入”记录，这是不可接受的。

有没有更优雅的方式来编写这个查询？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T20:44:04.440

这个怎么样？

```
SELECT i.id,
       i.created_at
FROM   imports i
       INNER JOIN (SELECT   a.import_id
                   FROM     albums a
                            INNER JOIN songs s
                              ON a.id = s.album_id
                   GROUP BY a.id
                   HAVING   Count(* ) = 1) AS TEMP
         ON i.id = TEMP.import_id; 
```

在大多数数据库系统中，JOIN 的工作速度比 WHERE ... IN 快。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T20:45:17.293

```
SELECT i.id, i.created_at, COUNT(s.album_id)
FROM imports AS i
    INNER JOIN albums AS a
        ON i.id = a.import_id
    INNER JOIN songs AS s
        ON a.id = s.album_id
GROUP BY i.id, i.created_at
HAVING COUNT(s.album_id) = 1 
```

*（您可能不需要将 包括`COUNT`在`SELECT`列表本身中。SQL Server 不需要它，但不同的 RDBMS 可能会。）*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T20:27:05.573

未经测试：

```
select
    i.id, i.created_at
from
    imports i
where
    exists (select *
       from
           albums a
           join
           songs s on a.id = s.album_id
       where
           a.import_id = i.id
       group by
           a.id
       having
           count(*) = 1) 
```

或者

```
select
    i.id, i.created_at
from
    imports i
where
    exists (select *
       from
           albums a
           join
           songs s on a.id = s.album_id
       group by
           a.import_id, a.id
       having
           count(*) = 1 AND a.import_id = i.id) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T21:06:34.230

所有三种建议的技术都应该比您的 WHERE IN 更快：

1.  存在相关子查询 (gbn)
2.  内部连接的子查询 (achinda99)
3.  内连接所有三个表（卢克）

（所有这些都应该工作......，所以对所有这些都+1。如果其中一个不起作用，请告诉我们！）

哪个实际上是最快的，取决于您的数据和执行计划。但是一个有趣的例子是在 SQL 中表达同一事物的不同方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T21:15:40.403

> 我试图使整个查询成为单个（无嵌套）连接，但遇到了 group/having 子句的问题。

如果您使用的是 SQL Server 版本 2005/2008，则可以使用 CTE（公用表表达式）加入子查询

As far as I know, CTE is simply an expression that works like a virtual view that works only one a single *select* statement - So you will be able to do the following. I usually find using CTE to improve query performance as well.

```
with AlbumSongs as (
    select  a.import_id 
    from    albums a inner join songs s on a.id = s.album_id
    group by a.id 
    having 1 = count(s.id)
)
select  i.id, i.created_at 
from    imports i 
        inner join AlbumSongs A on A.import_id = i.import_id 
```

# windows-server-2003 - Windows 的 Plesk 替代品

> ID：579180
> 
> 赞同：2
> 
> 时间：2009-02-23T20:26:01.987
> 
> 标签：windows-server-2003, plesk

我正在为我的 windows server 2003 寻找 Plesk 的免费替代品。任何人都知道替代品。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-29T12:02:37.357

据我所知是没有的。Plesk 收购了 Helm，它是 Windows 领域唯一的主要竞争对手。我知道的唯一“正常”的免费面板是 ISPConfig，但它仅适用于 Linux。

我们公司还在寻找 Plesk 的替代方案，用于 Windows 托管。

编辑 2010 年 10 月 25 日：DotNetPanel 重命名为 WebsitePanel 似乎是开源的：http: [//sourceforge.net/projects/websitepanel/](http://sourceforge.net/projects/websitepanel/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-02-24T17:04:33.070

如果这没有帮助，我很抱歉，但您为什么希望有一个 Windows 控制面板？充其量是GUI上的GUI，您不能触摸IIS，因为它会破坏面板等。

老实说，我会坚持使用非控制面板 Windows 服务器，以我的诚实观点，它更容易管理。

# javascript - Javascript 正则表达式

> ID：579181
> 
> 赞同：2
> 
> 时间：2009-02-23T20:26:07.947
> 
> 标签：javascript, regex

当我遇到这个问题时，我正试图为其他人做一个正则表达式。要求是正则表达式应该从一组字符串中返回结果，比如说，“apple”。例如，考虑以下字符串：

`"I have an apple"` `"You have two Apples"` `"I give you one more orange"`

结果集应该有前两个字符串。

我尝试的正则表达式是：

`/[aA]pple/`和`/[^a-zA-Z0-9][aA]pple/`

第一个的问题是“aapple”、“bapple”等词（好吧，所以它们毫无意义，但仍然......）用它测试为阳性，而第二个的问题是当一个字符串实际上以“苹果”、“苹果和橙子”这个词开头，例如，它测试为阴性。有人可以解释为什么第二个正则表达式会这样表现以及正确的正则表达式是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T20:28:37.473

```
/(^.*?\bapples?\b.*$)/i 
```

编辑：上面将匹配包含单词“apples”的整个字符串，我认为这就是你所要求的。如果您只是想查看字符串是否包含该单词，则以下内容将起作用。

```
/\bapples?\b/i 
```

> 我尝试的正则表达式是：
> 
> `/[aA]pple/ and /[^a-zA-Z0-9][aA]pple/`

第一个只是按顺序检查以下字符是否存在：apple，无论它们在什么上下文中使用。\b 或单词边界字符，匹配非单词字符和单词字符的任何位置见面，阿拉`\W\w`。

第二个是在apple出现之前尝试匹配其他字符，与第一个基本相同，只是它前面*需要其他字符。*

我回答的问题如下。从字符串的开头，非贪婪地匹配任何字符（如果它们存在），直到遇到单词边界。如果字符串以 apple 开头，则字符串的开头是单词边界，因此它仍然匹配。然后它匹配字母`a-p-p-l-e`，`s`如果它存在，后面跟着另一个单词边界。然后它将所有字符匹配到字符串的末尾。末尾的 /i 表示不区分大小写，因此“Apple”、“APPLE”和“apple”都有效。

如果您有时间，我强烈建议您浏览[http://regular-expressions.info](http://regular-expressions.info)上的教程。它真的很深入，并讨论了正则表达式引擎如何匹配不同的表达式，它帮助了我很多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T20:38:43.627

要在@tj111 上构建，您的第二个正则表达式失败的原因是`[^a-zA-Z0-9]`需要一个字符匹配；也就是说，那个位置有一些字符，它的值不包含在 set 中`[a-zA-Z0-9]`。像这样的标记`\b`被称为“零宽度断言”。`\b`，特别是匹配字符之间的边界或字符串的开头或结尾。因为它不匹配任何字符，所以它的“宽度”为零。

总之，`[^a-zA-Z0-9]`需要一个不带特定值的字符，而`\b`只需要一个边界。

**编辑：** @tj111 在他的回复中添加了大部分内容。我又来晚了：）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T20:47:11.953

这适用于`apple`and`apples`及其不区分大小写的拼写：

```
var strings = ["I have an apple", "You have two Apples", "I give you one more orange"];
var result = [];
var pattern = /\bapples?\b/i;
for (var i=0; i<strings.length; i++) {
    if (pattern.test(strings[i])) {
        result.push(strings[i]);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T20:29:56.220

```
/\bapple/i 
```

\b 是[单词边界](http://www.regular-expressions.info/wordboundaries.html)。

为了解释为什么你的尝试不起作用，第一个不检查它是否是单词的开头，所以它之前可以有一些东西。您给出的第二个正则表达式说某些东西必须在“apple”这个词之前，但它不能是字母数字。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T20:38:00.710

您的第二个正则表达式在苹果的第一个 a 之前需要一个非字母数字字符。“苹果”不能满足这一点。正如其他人所指出的，“\b”匹配的不是字符，而是单词边界位置。

# nhibernate - 休眠下一个/上一个兄弟映射

> ID：579183
> 
> 赞同：0
> 
> 时间：2009-02-23T20:26:17.307
> 
> 标签：nhibernate, hibernate, nhibernate-mapping

我正在使用 nHibernate 映射一个与 .NET 的 System.Web.SiteMapNode 非常相似的对象。为了使我的对象与这个 .NET 对象相似，我希望它包含 ParentNode、PreviousSibling、NextSibling 和 ChildNodes 复杂属性。

该表看起来有点像这样，并且可以更改：

*   编号（整数）
*   标题（字符串）
*   描述（字符串）
*   键（字符串）
*   ParentNodeId (int)
*   OrdinalPosition (int)
*   只读（布尔）
*   网址（字符串）

我可能有一些其他属性不需要模拟 .NET SiteMapNode 对象（如 isExternal 布尔值），但我认为这些对这个问题无关紧要。

我当前的映射如下所示：

```
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" namespace="AthletesCafe.Core.Domain.System.SiteMap" assembly="AthletesCafe.Core">
<class name="SiteMapNode" table="SiteMapNode" lazy="true" >

<id name="ID" type="Int32" unsaved-value="0">
  <column name="ID" not-null="true" unique="true" index="PK_SiteMapNode"/>
  <generator class="identity" />
</id>

<property name="Title" column="Title" type="String" length="255" not-null="true" />
<property name="Description" column="Description" type="String" not-null="false" />

<property name="Url" column="Description" type="String" not-null="true"  />

<property name="SiteMapKey" column="SiteMapKey" type="String" not-null="true" length="255"  />

<property name="OrdinalPosition" column="OrdinalPosition" type="Int32" not-null="true" />

<property name="ReadOnly" column="ReadOnly" not-null="true" type="System.Boolean" />

<property name="IsExternal" column="IsExternal" not-null="true" type="System.Boolean" />

<many-to-one name="ParentNode" column="ParentNodeId" class="AthletesCafe.Core.Domain.System.SiteMap.SiteMapNode, AthletesCafe.Core" 
             access="field.pascalcase-underscore" not-null="false" />
<many-to-one name="PreviousNode" column="ParentNodeId" class="EatMyTrainer.Core.Domain.SiteMap.SiteMapNode, EatMyTrainer.Core" not-null="false" /></hibernate-mapping> 
```

ParentNode 映射很简单，因为它应该只是一个简单的多对一映射。这是我的代码（未经测试，但我相信它是正确的）：

```
<many-to-one name="ParentNode" column="ParentNodeId" class="AthletesCafe.Core.Domain.System.SiteMap.SiteMapNode, AthletesCafe.Core" 
             access="field.pascalcase-underscore" not-null="false" /> 
```

子节点的映射应该只是一个简单的包，它将带回 ParentNodeId 等于当前 ID 的所有 SiteMapNode 对象。我还没有写这个包，但我相信这没什么大不了的。

我似乎无法解决的问题是如何执行 Next/Previous Sibling 属性。该对象可以从每个节点的以下公式派生：

*   PreviousSibling：与当前对象具有相同的ParentNode (ParentNodeId)，并且其OrdinalPosition 应该比当前对象的OrdinalPosition 小一。
*   NextSibling：与当前对象具有相同的ParentNode（ParentNodeId），并且其OrdinalPosition应该比当前对象的OrdinalPosition大一。

我认为这可以通过多对一映射的形式属性来实现。这可能吗？我还没有找到一个很好的例子来说明这是如何工作的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T22:44:14.823

我认为您所要求的绝对不可能（尽管如果可以的话，我很想看到解决方案）。会有一个相对简单的解决方法，但 NHibernate 不支持在多端具有索引集合的双向一对多映射。

唯一想到的是有点难看：让父对象为每个子对象保留自己的索引映射（从 OrdinalPosition 键控）。在孩子身上做这样的事情：

```
public SiteMapNode NextSibling()
{
    return this.Parent.NextSibling(this);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-25T18:47:22.677

我相信 Stuart 在这种情况下是正确的。对于多对一映射是不可能的。如果 NHibernate 提供了一种在此映射上执行 where 子句的方法，那么我可能有机会。

另一个可能的解决方案虽然效率低，但创建一个使用字段设置器的包。将是 Next/Previous 设置的公共属性仍将返回对象引用（而不是可枚举）。在 getter 中，它只会引用字段中可枚举的第一个位置。延迟加载将是理想的，因为 NHibernate 无法在对象的初始加载中一次性加载该对象。每次访问此对象都会受到惩罚。

我想这两种解决方案都有类似的惩罚。

# php - php/dos：如何解析 regedit 导出文件？

> ID：579195
> 
> 赞同：2
> 
> 时间：2009-02-23T20:29:13.977
> 
> 标签：php, regex, registry, regedit

我的目标是在注册表配置单元中查找 Company 键值，然后在其后面提取相应的 Guid 和其他键和值。所以我想我会运行 regedit export 命令，然后用 php 解析文件以获得我需要的密钥。

所以运行dos批处理命令后

```
>regedit /E "output.txt" "HKLM\System....\Company1" 
```

输出文本文件似乎是某种对正则表达式不友好的 UNICODE 格式。我正在使用 php 解析文件并提取密钥。

这是我用来解析文件的 php 代码

```
<?php 

$regfile = "output.txt";

$handle = fopen ("c:\\\\" . $regfile,"r");
//echo "handle: " . $file . "<br>";
$row = 1;

while ((($data = fgets($handle, 1024)) !== FALSE) ) {

    $num = count($data);
    echo "$num fields in line $row: \n";

$reg_section = $data;   
//$reg_section = "[HKEY_LOCAL_MACHINE\SOFTWARE\TECHNOLOGIES\MEDIUS\CONFIG MANAGER\SYSTEM\COMPANIES\RECORD11]";

$pattern = "/^(\[HKEY_LOCAL_MACHINE\\\SOFTWARE\\\TECHNOLOGIES\\\MEDIUS\\\CONFIG MANAGER\\\SYSTEM\\\COMPANIES\\\RECORD(\d+)\])$/";
if ( preg_match($pattern, $reg_section )) { 

echo "<font color=red>Found</font><br>"; 

} else { 
echo "not found<br>"; 
echo $data . "<br>";
}
$row++;
} //end while 
fclose($handle);

?> 
```

输出看起来像这样......

> 第 1 行中的 1 个字段：未找到r� �V�e�r�s�o�n� �5�.�0�0� 第 2 行中的 1 个字段：未找到
> 
> 第 3 行中的 1 个字段：未找到 [.H.K.E.Y.<em>.L.O.C.A.L.</em>.M.A.C.H.I.N.E ＠S.O.F.T.W.A.R.E.\.I.T.E.R.S.T.A.R..T.E.C.H.N. O.L.O.G.I.E.S.\.X.M.E.D.I.U.S.\.C.O.N.F.I.G..M.A.N ‘A.G.E.R.\.S.Y.S.T.E.M.\.C.O.M.P.A.N.I.E.S.]. 1 个字段在行4: 在第 5 行中未找到“.N.e.x.t..R.e.c.o.r.d..I.D.”.=.".4.1.". 1 个字段： 未找到

任何想法如何解决这个问题？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T20:55:40.730

我知道为此有一个 Perl 库：

[解析::Win32Registry](http://search.cpan.org/perldoc/Parse::Win32Registry)

不过，从中创建一个 PHP 类应该不会太难。还有一个用于解析 Perl 代码的 PHP 的 PECL 扩展：

[http://devzone.zend.com/node/view/id/1712](http://devzone.zend.com/node/view/id/1712)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-22T18:06:40.063

尝试像这样将 /A 添加到 REGEDIT 命令以产生兼容的输出：

`REGEDIT /E /A "output.txt" "HKEY_LOCAL_MACHINE\System....\Company1"`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T20:51:44.733

正则表达式适用于 unicode。您是否收到特定的错误消息？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-28T15:40:37.873

在 Windows XP 中，Regedit 导出是 Unicode，因此是 2 个字节。如果您在记事本中打开导出，您会看到这一点。我不确定旧版本的 php 是否能够处理 unicode 文件。

您是否无法读取所需的特定密钥？通过另一个工具等。这将是一种更直接的方法。

# svn - 获取 SVN 中的最新修订号？

> ID：579196
> 
> 赞同：108
> 
> 时间：2009-02-23T20:29:30.233
> 
> 标签：svn

使用 PHP、Perl 或 Python（最好是 PHP），我需要一种方法来查询 SVN 数据库并找出发送到 SVN 的最新修订号。我不需要除此之外的任何东西。它需要是非密集的（所以我每 5 分钟执行一次 cron 作业；不应影响 SVN 的性能）。

SVN 位于我的 Intranet 上，但不是我的特定计算机。

我安装了 SVN，但没有为 PHP/Perl/Python 安装绑定。我正在运行 Windows XP，但我更喜欢也可以在 Linux 中运行的独立于平台的解决方案。如果您有一个仅限 Linux（或仅限 XP）的解决方案，那也会很有帮助。

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2009-02-23T20:50:47.590

如果您想分析本地工作副本，最好的工具是`svnversion`Subversion 附带的`968:1000M`. 文档说：

> 如果工作副本是单个修订版、未修改、未切换且具有与 TRAIL_URL 参数匹配的 URL，则版本号将是单个数字。如果工作副本异常，版本号会更复杂：
> 
> ```
> 4123:4168     mixed revision working copy
> 4168M         modified working copy
> 4123S         switched working copy
> 4123:4168MS   mixed revision, modified, switched working copy 
> ```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2009-02-23T20:40:25.010

```
<?php
    $url = 'your repository here';
    $output = `svn info $url`;
    echo "<pre>$output</pre>";
?> 
```

您可以像这样以 XML 格式获取输出：

```
$output = `svn info $url --xml`; 
```

如果有错误，则输出将被定向到 stderr。要在输出中捕获 stderr，请使用：

```
$output = `svn info $url 2>&1`; 
```

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2009-02-23T20:42:20.747

> `svn info -r HEAD`

这将为您提供存储库头部的最新修订号。

有一些关于将颠覆号集成到构建脚本中的不错的博客文章：

*   [在 Ant 中获取 Subversion 修订版](http://ccollins.wordpress.com/2008/01/30/getting-subversion-revision-in-ant/)
*   [Xcode 中的自动构建子版本](http://www.red-sweater.com/blog/23/automatic-build-sub-versioning-in-xcode)

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2009-02-23T20:35:04.867

这应该在工作目录中的 Bash 中工作。[我已经在安装了unixutils](http://sourceforge.net/projects/unxutils)的 Windows 中使用它：

```
svn info |grep Revision: |cut -c11- 
```

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2009-06-05T16:37:46.337

以下应该有效：

```
svnlook youngest <repo-path> 
```

它返回单个修订号。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2013-10-15T18:06:13.920

*要真正获得远程*存储库上的最新版本（“头版本”）编号，请使用以下命令：

```
svn info -r 'HEAD' | grep Revision | egrep -o "[0-9]+" 
```

输出例如：

```
35669 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2011-11-11T01:39:13.097

关于获取最新修订号的说明：

假设我`cd`在一个修改过的子目录 ( `MyProjectDir`) 中进行了编辑。然后，如果我打电话`svnversion`：

```
$ svnversion .
323:340 
```

...我得到“ `323:340`”，我猜这意味着：“*你这里有项目，从修订版 323 到 340* ”。

然后，如果我打电话`svn info`：

```
$ svn info
Path: .
URL: svn+ssh://server.com/path/to/MyProject/MyProjectDir
Repository Root: svn+ssh://server.com/path/to/MyProject
Repository UUID: 0000ffff-ffff-...
Revision: 323
Node Kind: directory
Schedule: normal
Last Changed Author: USER
Last Changed Rev: 323
Last Changed Date: 2011-11-09 18:34:34 +0000 (Wed, 09 Nov 2011) 
```

...我得到“ `323`”作为修订版 - 这实际上是那些报告的*最低*`svnversion`修订版！

然后我们可以`svn info`在递归模式下使用从本地目录获取更多信息：

```
> svn info -R | grep 'Path\|Revision'
Path: .
Revision: 323
Path: file1.txt
Revision: 333
Path: file2.txt
Revision: 327
Path: file3.txt
Revision: 323
Path: subdirA
Revision: 328
Path: subdirA/file1.txt
Revision: 339
Path: subdirA/file1.txt
Revision: 340
Path: file1.txt
Revision: 323
... 
```

...（删除`grep`以查看更多详细信息）。

最后，当我们想检查*在线*存储库的最新版本（在本例中为 @ `server.com`）时该怎么办？然后我们再次发出`svn info`，但使用（注意之前的大写选项和现在的小写`-r HEAD`之间的区别）：`-R``-r`

```
> svn info -r 'HEAD'
USER@server.com's password:
Path: MyProjectDir
URL: svn+ssh://server.com/path/to/MyProject/MyProjectDir
Repository Root: svn+ssh://server.com/path/to/MyProject
Repository UUID: 0000ffff-ffff-...
Revision: 340
Node Kind: directory
Last Changed Author: USER
Last Changed Rev: 340
Last Changed Date: 2011-11-11 01:53:50 +0000 (Fri, 11 Nov 2011) 
```

有趣的是——仍然是`svn info`指*当前*`MyProjectDir`子目录`MyProjectDir`（本地）。`.`*`340``323`*

 ** * *

## 回答 #8

> 赞同：11
> 
> 时间：2015-08-20T10:25:47.667

*   从 Subversion 1.9 开始，您可以使用选项[--show-item](http://subversion.apache.org/docs/release-notes/1.9.html#svn-info-item)`svn info`获取命令输出字段之一的值。此命令将仅显示修订号：

    ```
    svn info --show-item=revision <URL-to-repository> 
    ```

*   使用选项获取 svn info 的 XML 输出`--xml`并使用 PowerShell 获取修订号。这是一个简单的例子：

    ```
    [xml]$svninfo = svn info <REPOSITORY-URL> --xml -r HEAD
    $latestrevnum = $svninfo.info.entry.revision
    $latestrevnum 
    ```

*   使用 VisualSVN Server 3.4 或更高版本，您可以通过运行以下命令获取存储库中的修订数量：

    `$repo = Get-SvnRepository <REPOSITORY-NAME>`

    `$repo.Revisions`

    有关详细信息，请参阅[`Get-SvnRepository`PowerShell cmdlet 参考](https://www.visualsvn.com/support/topic/00088/)。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-02-23T20:34:25.587

我想你正在寻找

```
svn info -r HEAD 
```

你能shell到那个命令吗？

您可能还需要在存储库中提供登录凭据。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-02-23T20:53:45.133

其他人打败了我发布关于 的答案`svnversion`，如果您有工作副本（IIRC，它不适用于 URL），这绝对是最好的解决方案。我会补充一点：如果您在托管 SVN 的服务器上，最好的方法是使用该`svnlook`命令。这是您在编写钩子脚本以检查存储库（甚至是当前事务，在预提交钩子的情况下）时使用的命令。您可以键入`svnlook help`以获取详细信息。您可能想要使用该`svnlook youngest`命令。请注意，它需要直接访问 repo 目录，因此必须在服务器上使用它。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2017-06-19T13:38:53.353

最简单和干净的方法（实际上是 svn 1.9，2015 年发布）是使用：

```
svn info --show-item revision [--no-newline] [SVNURL/SVNPATH] 
```

输出是 SVNURL 的*最后修订版*（最年轻）的编号，或 SVNPATH工作副本的*当前修订版的编号。*`--no-newline`是可选的，指示`svn`不要在值之后发出修饰换行符 ( `\n`)，如果您需要最少的输出（仅修订号）。

见：[https ://subversion.apache.org/docs/release-notes/1.9.html#svn-info-item](https://subversion.apache.org/docs/release-notes/1.9.html#svn-info-item)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-23T20:43:06.207

您正在寻找类似于命令行调用的调用

```
svn info URL 
```

使用 pysvn 库似乎可以做到这一点，并且有[一个食谱](http://code.activestate.com/recipes/497011/)可以帮助您入门。我不确定PHP是否有类似的东西。

如果您需要自己调用 SVN 二进制文件，请确保使用`--xml`参数以 XML 格式获取结果。这应该比命令行输出更容易解析。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-03-06T18:14:20.683

```
nickh@SCLLNHENRY:~/Work/standingcloud/svn/main/trunk/dev/scripts$ svnversion
12354 
```

或者

```
nickh@SCLLNHENRY:~/Work/standingcloud/svn/main/trunk/dev/scripts$ svn info --xml |     xmlstarlet sel -t --value-of "//entry/@revision"
12354 
```

或者

```
nickh@SCLLNHENRY:~/Work/standingcloud/svn/main/trunk/dev/scripts$ svn info --xml | xmlstarlet sel -t --value-of "//commit/@revision"
12335 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-02-28T08:00:24.967

如果你想要一个很短的：

```
svn info ^/ 
```

[插入符号](http://svnbook.red-bean.com/nightly/en/svn.basic.in-action.html#svn.advanced.reposurls)是“存储库根目录的 URL”的简写。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-05-01T00:20:49.567

如果您不幸需要从 Windows 批处理文件中执行此操作，这里是您正在寻找的咒语：

```
set REV=unknown
for /f "usebackq tokens=1,2 delims=: " %%A in (`svn info`) do if "%%A" == "Revision" set REV=%%B
echo Current SVN revision is %REV% 
```

这运行“svn info”，迭代生成的每一行输出。它使用冒号作为行中第一个和第二个标记之间的分隔符。当第一个标记为“修订版”时，它将环境变量 REV 设置为第二个标记。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-01-23T05:07:34.130

您可以使用 XML 输出格式，例如：

```
 svn info --xml | grep 'revision' | head -1 | grep -Eo "[0-9]+" | xargs expr -1 + 
```

示例：使用修订号

```
working=`svn info --xml | grep 'revision' | head -1 | grep -Eo "[0-9]+" | xargs expr -1 +`
svn diff -r $working:HEAD --summarize --xml 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-04-04T05:38:43.750

您可以使用以下任一命令：

```
1)
> svn info | awk '/Revision:/ { print $2 }' =>returns the latest version

2)
> svn log -l 1 | grep '^r[0-9]\+' | awk '{print $1}'

svn log -l 1     => returns the latest version commit 
grep '^r[0-9]\+' => greps the r4324 (revision) number
awk '{print $1}' => prints the match found 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-01-25T05:10:14.633

Just `svn info`in BASH 将为您提供所有详细信息

```
RESULT:
Path: .
URL: 
Repository Root: 
Repository UUID: 
Revision: 54
Node Kind: directory
Schedule: normal
Last Changed Author: 
Last Changed Rev: 54
Last Changed Date: 
```

您将从这里获得 REVISION

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2014-10-10T09:17:56.593

您可以尝试以下命令：

```
svn info -r 'HEAD' | grep Revision: | awk -F' ' '{print $2}' 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-06-15T20:27:47.480

发布的解决方案不处理使用外部的情况。

如果我有一个带有`svn:externals`属性集的 URL 或工作副本，则外部可能会更改，因此 subversion 服务器的最新版本会更改。但是，工作副本或 URL 的最新版本只会在 svn:externals 属性发生更改或 URL 路径中任何较低的项目时报告修订号，这是预期的行为。

因此，您要么获取`svn:externals`属性并遍历 URL 并选择高度修订版，要么从 subversion 服务器查询基本 URL。从基本 URL 报告的版本将包含服务器上所有内容的最新版本。

因此，如果您使用外部，最好使用subversion 服务器`svn info BASE_URL`上`BASE_URL`所有路径的根 URL 位置。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-10-24T20:26:08.360

`svn info`或者`svnversion`不考虑子目录，以找到实时代码库的最新“修订版”，下面的黑客方式对我有用 - 可能需要一段时间才能运行：

```
repo_root$ find ./ | xargs -l svn info  | grep 'Revision: ' | sort
...
Revision: 86
Revision: 86
Revision: 89
Revision: 90
$ 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-04-29T23:52:09.140

`$ svn log | head -10` 在任何有`.svn`文件夹的目录上

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-12-27T18:17:19.687

这将只获得最后更改的版本的版本号：

```
<?php
$REV="";
$repo = ""; #url or directory
$REV = svn info $repo --show-item last-changed-revision;
?> 
```

我希望这有帮助。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2020-06-11T07:37:35.227

这可以使用**“SVN”**库获得：

```
import svn.remote

file_path = "enter your filepath"

svn_inf = svn.remote.RemoteClient(file_path)

head_revision = ([x for x in svn_inf.log_default(revision_to = 'HEAD')] [-1]).revision 
```

head_revision 应该包含文件的最新修订号

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2009-02-23T20:34:38.847

看起来[官方常见问题解答中有一个条目](http://subversion.tigris.org/faq.html#version-value-in-source)。源代码用 C 语言编写，但同样的原则也适用，如[本邮件列表中所述](http://svn.haxx.se/users/archive-2006-06/0847.shtml)。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2014-06-09T15:54:41.923

更新：Subversion 1.9 将支持一个新命令“svn youngest”，它只输出最新的修订号。与“svnlook youngest”的区别在于“svn youngest”也可以远程工作。

[http://subversion.tigris.org/issues/show_bug.cgi?id=4299](http://subversion.tigris.org/issues/show_bug.cgi?id=4299)

# c# - GAC 对象的配置文件

> ID：579198
> 
> 赞同：2
> 
> 时间：2009-02-23T20:30:12.307
> 
> 标签：c#, .net, configuration

通常，我们将配置值保存在 web.config/app.config 中，并将环境全局配置变量（而不是特定于应用程序的变量）保存在服务器 machine.config 文件中。

将对象部署到 GAC 时，保存这些配置类型值的最佳位置是哪里？似乎最好的位置是链接的资源文件。

有没有人对这种方法有任何经验/建议？（示例代码？）

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T20:32:28.773

配置值需要在执行程序集的应用程序配置中。拥有配置值是应用程序的责任，以便您的程序集在加载到 AppDomain 时可以访问它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T20:54:18.643

过去，我需要特定于程序集的配置文件（而不是执行程序集配置文件）。

对于 GAC 中的程序集，可以（但不推荐）将配置文件物理复制到程序集 dll 文件夹。

我用于创建可以跨程序集共享的配置文件的解决方案，而不管 AppDomain 是什么，它是我的应用程序的一个简单注册表项，它定义了一个共享的配置文件位置。这样，任何程序集都可以从共享位置检索配置设置，而不管是哪个执行程序集启动了它。（对脚本特别有用 - 否则，您必须在 windows\system32 文件夹中部署一个名为 wscript.exe.config 的配置文件 - 哎呀！）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T20:58:11.597

如果您不关心使用您的 dll 为每个应用程序进行特定配置，您可以将配置放在框架文件夹内的**machine.config文件中。**

%systemRoot%/Windows/Microsoft.Net/Framework/[版本]/Machine.config

# machine-learning - 自然语言处理中的二值化

> ID：579203
> 
> 赞同：12
> 
> 时间：2009-02-23T20:31:55.623
> 
> 标签：machine-learning, nlp, classification, libsvm

二值化是将实体的彩色特征转换为数字向量（通常是二进制向量）的行为，以便为分类器算法提供良好的示例。

如果我们在哪里对句子“The cat ate the dog”进行二值化，我们可以首先为每个单词分配一个 ID（例如 cat-1、ate-2、the-3、dog-4），然后简单地将单词替换为它的 ID 给出了向量 <3,1,2,3,4>。

给定这些 ID，我们还可以通过为每个单词提供四个可能的槽位并将与特定单词对应的槽位设置为 1 来创建二进制向量，从而使向量 <0,0,1,0,1,0,0,0 ,0,1,0,0,0,0,0,1>。据我所知，后一种方法通常被称为词袋法。

现在我的问题是，在描述自然语言处理的一般特征，特别是基于转换的*依赖解析*（使用 Nivres 算法）时，*最好的二值化方法是什么？*

 *在这种情况下，我们不想对整个句子进行编码，而是要对解析的当前状态进行编码，例如堆栈上的顶部单词和输入队列中的第一个单词。由于顺序是高度相关的，这排除了词袋方法。

用*best*，我指的是使数据对分类器最易理解的方法，而不会占用不必要的内存。例如，我不希望一个单词 bigram 对 20000 个唯一单词使用 4 亿个特征，如果实际上只有 2% 的 bigrams 存在的话。

由于答案也取决于特定的分类器，我最感兴趣的是最大熵模型（liblinear）、支持向量机（libsvm）和感知器，但也欢迎适用于其他模型的答案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-25T18:32:52.460

这实际上是一个非常复杂的问题。您必须做出的第一个决定是是否对您的输入标记（您的单词）进行[词形还原。](http://en.wikipedia.org/wiki/Lemmatization)如果你这样做，你会大大减少你的类型计数，并且你的语法解析会变得不那么复杂。但是，要对令牌进行词形还原需要做很多工作。现在，在计算机语言中，这项任务大大减少了，因为大多数语言使用一组明确定义的符号来分隔关键字或变量名，例如空格或句点或诸如此类。

第二个关键决定是您将在事后处理数据。您提供的二进制形式的“词袋”方法会忽略词序，如果您正在[对文本进行摘要，](http://en.wikipedia.org/wiki/Automatic_summarization)或者您不关心*在哪里*进行谷歌风格的搜索，这完全可以词出现，只要它们出现。另一方面，如果您正在构建诸如编译器或解析器之类的东西，那么顺序非常重要。您可以使用标记向量方法（如第二段中所述），或者您可以扩展词袋方法，以便词袋向量中的每个非零条目都包含标记的线性索引位置在短语中。

最后，如果您要构建[解析树](http://en.wikipedia.org/wiki/Parse_tree)，有明显的理由表明您想要使用标记向量方法，因为为袋子中的每个单词维护子短语 ID 是一个很大的麻烦。 -words 向量，但很容易在标记向量中创建“子向量”。事实上，Eric Brill 为他[的词性标注器](http://www.cs.cmu.edu/afs/cs/project/ai-repository/ai/areas/nlp/parsing/taggers/brill/0.html)使用了一个 token-id 序列，这非常简洁。

你介意我问你在做什么具体的任务吗？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-02T01:19:20.407

> 二值化是将实体的彩色特征转换为数字向量（通常是二进制向量）的行为，以便为分类器算法提供良好的示例。

我经常遇到数值特征，取值*介于* `0`和`1`（不是你所描述的二进制）之间，表示向量中特定特征的相关性（在 0% 和 100% 之间，`1`代表 100%）。一个常见的例子是[tf-idf](http://nlp.stanford.edu/IR-book/html/htmledition/tf-idf-weighting-1.html)向量：在表示文档（或句子）的向量中，整个词汇表中的每个术语都有一个值，表示该术语与所表示文档的相关性。

正如迈克在[他的回复](https://stackoverflow.com/questions/579203/binarization-in-natural-language-processing/587243#587243)中已经说过的，这是一个广泛领域的复杂问题。除了他的建议之外，您可能会发现研究一些[信息检索](http://www-csli.stanford.edu/~hinrich/information-retrieval-book.html)技术（如[向量空间模型](http://nlp.stanford.edu/IR-book/html/htmledition/scoring-term-weighting-and-the-vector-space-model-1.html)、[向量空间分类](http://nlp.stanford.edu/IR-book/html/htmledition/vector-space-classification-1.html)和[潜在语义索引](http://nlp.stanford.edu/IR-book/html/htmledition/matrix-decompositions-and-latent-semantic-indexing-1.html)）作为起点很有用。此外，[词义消歧](http://www.wsdbook.org/)领域在 NLP 中处理了很多[特征表示问题。](http://ccgi.edgard.plus.com/wsdbook/index/search.pl?q=features)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T12:30:00.530

[不是直接答案] 这完全取决于您尝试解析和处理的内容，但对于一般的短人类短语处理（例如 IVT），另一种方法是使用神经网络来学习模式。这对于小的词汇量非常准确

# .net - .NET 中的 RSS 描述 html 清理

> ID：579206
> 
> 赞同：1
> 
> 时间：2009-02-23T20:33:45.883
> 
> 标签：.net, rss, sanitization

我想编写一个使用 RSS 的应用程序。我希望能够将 RSS 提要的项目描述中的一些项目显示为 HTML，例如图像、链接、br 等。但是，我不希望任何嵌入式脚本运行、不守规矩的 css 元素等。我也不想重新发明轮子。他们的任何库是否只删除了正确级别的 HTML？

我遇到的问题是我正在从 phpBB 生成一个 RSS 提要，所以这些帖子确实已经有 br 和 a (link) 标签。但是，用户可以在帖子中粘贴脚本标签，它会被正确编码以在页面上显示为文本。

但是，当我在 RSS 阅读器中查看帖子时，帖子中的所有 html 都被编码为 < 和 >...等。这模糊了 br 标签和（小于）脚本（大于）标签之间的区别，因为它们都出现在 & lt ; 和>

我觉得这应该更容易，我只是错过了一些明显的东西......我希望。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-24T07:40:51.383

您的问题并不完全清楚，但通常在尝试清理 html 以输出时，您只想允许标签白名单。

这是您可以轻松适应 .net 的 strip_tags 的 javascript 实现

[http://kevin.vanzonneveld.net/techblog/article/javascript_equivalent_for_phps_strip_tags/](http://kevin.vanzonneveld.net/techblog/article/javascript_equivalent_for_phps_strip_tags/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T14:53:48.177

我想到了。我使用的 RSS 脚本导致 html 编码的尖括号与 rss 提要中的真实 html “混合”

这是 phpBB 中源代码的样子：

```
<a href="link">link</a>
&lt;script&gt;alert("hack you");&lt;/script&gt; 
```

但在我的 rss 提要中，它被生成为：（注意转义 html 和非转义 html 之间没有区别）

```
&lt;a href="link"&gt;link&lt;/a&gt;
&lt;script&gt;alert("hack you");&lt;/script&gt; 
```

我对 rss.php 文件进行了更改，所以它变成了这样：

```
&lt;a href="link"&gt;link&lt;/a&gt;
&amp;lt;script&amp;gt;alert("hack you");&amp;lt;/script&amp;gt; 
```

这样它就可以正确地显示在 RSS 提要中。

谢谢！

# .net - 如何在 .NET 中启动远程协助会话？

> ID：579209
> 
> 赞同：0
> 
> 时间：2009-02-23T20:34:13.637
> 
> 标签：.net, winapi, rdp

我正在编写帮助台应用程序，并希望允许我的用户在远程 PC 上启动远程协助会话。这可以通过 Windows XP 中的帮助来完成，但我无法在 .NET 中找到任何代码示例。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-11-06T22:13:57.010

它实际上非常简单，我写这个是为了让客户下载一个小 exe 并单击一个按钮，它会生成一个远程协助请求票证并在后台打开远程协助。然后文件通过 ftp 和繁荣发送到我的帮助台服务器，我可以一键访问客户端计算机。

只需确保在之后包含递归 kill() ，这样它就不会在后台留下任何挥之不去的进程。

```
System.Diagnostics.Process p = new System.Diagnostics.Process();
string fileurl = System.IO.Path.GetTempPath() + "Invitation.msrcincident";
p.StartInfo.UseShellExecute = true;
p.StartInfo.RedirectStandardOutput = false;
p.StartInfo.CreateNoWindow = true;
p.StartInfo.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
p.StartInfo.FileName = "Msra.exe";
p.StartInfo.Arguments = "/saveasfile " + fileurl + " MyPassword";
Console.WriteLine(p.StartInfo.Arguments);
p.Start();

while (File.Exists(fileurl) == false)
{
   Thread.Sleep(1000);
}

//CODE TO EMAIL/UPLOAD FILE HERE 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T20:41:20.343

[http://msdn.microsoft.com/en-us/library/ms811079.aspx](http://msdn.microsoft.com/en-us/library/ms811079.aspx)

您可能需要 P/Invoke 才能实际访问这些功能。

* * *

进一步审查后，CodePlex 上有一些来源可以生成远程协助票证。如果我错了，请纠正我，但您希望在客户端生成远程协助票证。查看[http://www.codeplex.com/RemoteAssistHelper](http://www.codeplex.com/RemoteAssistHelper)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-01-23T08:35:31.843

```
Remote Assistance using the MSRA Exe and its arguments.

Here I have desinged a class and a form,  and it gives you the following functionalities,

1)  Offer Remote Assistance to a Machine
2)  Ask for Remote Help. (Invite someone to help you)

Design A form with the folloiwng controls,

1)  Textbox for taking the IP or Computer name to Connect
2)  Button 1\. To connect to the Remote Machine for offering Remote Assistance
3)  Button 2\. To Ask or invite someone to help.

Code Behind in the Form:

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Text;
using System.Windows.Forms;

namespace RemoteAssist
{
    public partial class FrmConnect : Form
    {
        public FrmConnect()
        {
            InitializeComponent();
        }

        private void btnConnect_Click(object sender, EventArgs e)
        {
            RemoteConnect remoteConnect = new RemoteConnect();
            Boolean status;
status = remoteConnect.StartRemoteAssistance(txtComputerName.Text.ToString(), true,false);
            if (status == false)
            {
System.Windows.Forms.MessageBox.Show("Unable to Connect to the Remote Machine.Please try Again later.");
            }

        }

        private void BtnInvite_Click(object sender, EventArgs e)
        {
            RemoteConnect remoteConnect = new RemoteConnect();
            Boolean status;
            status = remoteConnect.StartRemoteAssistance(txtComputerName.Text.ToString(), false, true);

            if (status == false)
            {
                System.Windows.Forms.MessageBox.Show("Unable to Establish Connection, Please try Again later.");
            }
        }

        private void FrmConnect_Load(object sender, EventArgs e)
        {

        }

        private void txtComputerName_TextChanged(object sender, EventArgs e)
        {
            txtComputerName.CharacterCasing = CharacterCasing.Upper;
        }             

    }
}

We have two buttons here and they are sending the Boolean variable to the class function for differentiating between offer Help and Asking for Help.

Code under the Class File : RemoteConnect

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace RemoteAssist
{
    class RemoteConnect
    {
        public Boolean StartRemoteAssistance(String strMachinename, Boolean offerHelp, Boolean askForHelp)
        {            
            System.Diagnostics.Process process = new System.Diagnostics.Process();                        

            System.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo();
            startInfo.WindowStyle = System.Diagnostics.ProcessWindowStyle.Maximized;            
            startInfo.FileName = "msra.exe";

            // Offer Remote Assitance 
            if (offerHelp == true)
            {
                startInfo.Arguments = "/offerRA " + strMachinename;
            }

            //ASK for Remote Assistance
            if (askForHelp == true)
            {
                startInfo.Arguments = "novice";
            }

            try
            {
                process.StartInfo = startInfo;
                process.Start();
                return true;
            }

            catch (Exception ex)
            {
                //System.Windows.Forms.MessageBox.Show("Error Occured while trying to Connect" + ex.Message);
                return false;
            }           
        }
    }
} 
```

# c# - 以图形方式模板化 .NET winforms 应用程序

> ID：579211
> 
> 赞同：9
> 
> 时间：2009-02-23T20:34:20.297
> 
> 标签：c#, visual-studio, winforms, user-interface, desktop

我为我的公司创建了一个漂亮的 winforms 应用程序。我们让一个平面设计师创建了 GUI，实现起来很痛苦，所有的图形按钮、许多分层的背景和徽标、动画等。

但是现在我的公司想以不同的品牌转售它。但由于我*大部分*代码都很好，我告诉我的上级我可以在一周内完成一个完全重新命名的版本。基本上，我要做的就是更改 xml 设置文件中的一组设置，用新设置替换图形，然后构建。

问题是如果他们想要 5 或 6 个不同的品牌，我将支持 5 个不同的版本（我真的应该支持 1 个，带有 diff 模板）

问题是（据我所知）在 winforms 应用程序中换出图像并不容易。我在一个文件夹中拥有所有图形资源，但是一旦将每个文件输入到 Visual Studio 中其各自的图像列表或容器中，使其更新的唯一方法是删除它并重新添加它，更改源文件夹不会导致嵌入的图像刷新。对于每个构建来说，这将是非常乏味的，必须有一个更简单的方法。

**补充：**
所以经过进一步调查，我倾向于某种 resx 文件编辑器。然而，到目前为止我所看到的更专注于将字符串翻译成各种语言，并且要么非常弱，要么根本无法编辑二进制资源，如位图/png。虽然如果您在 xml 查看器中打开一个 resx 文件（我使用带有 .resx 的记事本 2 设置为使用 xml sytax 突出显示）MS 很友好地告诉您每种类型的确切编译方式（主要是 base 64 的变体）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-23T20:57:22.973

我认为您的目标应该是拥有“品牌化”的资源文件；您实际上是在本地化您的应用程序，除了您只有几个不同版本的英语。

您可以使用 ResGen.exe 和 ResourceManager 加载外部资源文件，因此您可以使用 5 个不同的“资源”文件但保持代码库相同。

这篇文章也可能有帮助...... [http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/b388c700-0e07-452b-a19e-ce02775f78a6/](http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/b388c700-0e07-452b-a19e-ce02775f78a6/)

**编辑：**顺便说一句，我会附议，如果你在这方面付出了很大的努力，考虑 WPF ......大多数“图形”元素都可以在本地完成，特别是如果它是渐变和东西，而不是提到简单的模板。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T17:20:31.993

我要做的只是在启动时从一个文件夹加载磁盘的所有图形，并根据需要创建任何所需的图像列表，而不是在设计器中执行此操作。如果您担心有人会窃取图形，那么我将为我的图形创建一个简单的文件格式（可能是加密的），并为您或设计师创建一个简单的小应用程序，用于从常规文件转换为这种格式。那么这只是一个在不同品牌之间交换这个文件夹的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T17:45:10.390

如果您的大多数表单都是相似的（即相同的徽标、底部的相同按钮等），您可以使用WinForms 上的[可视继承](http://www.code-magazine.com/article.aspx?quickid=0102021&page=1)来定义一组“基本表单”，您的实际表单将从这些“基本表单”继承。

如果您为每个品牌开发了一组“基本表单”，则每组在一个单独的程序集中您可以将生成新品牌所需的工作减少为生成一组新的基本表单。

希望能帮助到你

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T21:11:35.347

现在为时已晚，但 WPF 会是比 WinForms 更好的选择，因为它更容易换肤。

但是看看[DevExpress](http://devexpress.com/)为 WinForms 做了什么，因为他们的控件有一个皮肤系统。将 DevExpress winform 控件替换为标准 winform 控件并不难。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-02-23T20:36:44.130

我认为您应该考虑为表单的可动态替换区域创建用户控件。在运行时，您可以将一个程序集换成另一个程序集。

# javascript - 你们如何处理操作顺序很重要的复杂状态情况？

> ID：579215
> 
> 赞同：4
> 
> 时间：2009-02-23T20:34:39.550
> 
> 标签：javascript, design-patterns, architecture, user-interface

我遇到了一种情况，我有几个交互的小部件（在 Web UI 上），所有这些小部件都可以处于多种不同的状态，并且它们的行为取决于其他人。我遇到的情况是，例如，一组数据被排序两次，或者数据在排序之前被显示，而不是相反。这是一个有点古怪的问题，我认为我已经简化了一些事情并让它工作，只是发现我在其他地方破坏了一些东西。

我有执行以下操作的功能：

```
widgetAFunction
  load data into widget B
  tell widget B to sort the data
  tell widget B to display the data 
```

我对代码重用的热爱让我想做一些事情，比如在小部件 A 中编写一个 loadData 函数，如下所示：

```
widgetBLoadDataFunction
  update data
  sort the data
  refresh the view 
```

因此，widgetA 所要做的就是在 widgetB 上调用一个函数。但是在某些情况下，我只想对数据进行排序，而不更新数据，所以我写：

```
widgetBSortFunction
  sort the data
  refresh the view 
```

然后也许我想要一个过滤功能

widgetBFilterFunction 过滤数据刷新视图

也许我想更新数据但不排序，所以我有

```
widgetBNoSortLoadDataFunction
  update data
  refresh the view 
```

它看起来并不复杂，但我最终得到了这些非常长、非常脆弱的函数调用链，或者一堆非常相似的调用。正如 Martin Fowler 所说，代码变得有点臭了。

那么，我还有什么其他选择？我在最近的一个项目中做了一些事情，我做了一个状态机之类的事情，我注册了一堆带有一组条件的函数，或者会触发它们执行的状态。这有点效果，我认为这种方法可能会很好地再次使用。

有谁知道我在这里说的是什么，甚至更好的是，任何人都可以指出一些可以帮助我更好地理解这个问题的模式吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T20:49:51.667

您需要的是[有限状态机](http://en.wikipedia.org/wiki/Finite_state_machine)实现。基本上每个有限状态机都需要：

> *   程序响应的事件
> *   程序在事件之间等待的状态
> *   响应事件的状态之间的转换
> *   过渡期间采取的行动
> *   保存事件之间操作所需值的变量

[IBM 的一篇好文章](http://www.ibm.com/developerworks/library/wa-finitemach1/)教你一种通过 Javascript 实现它的方法。

**编辑**：[这是一个 FSM builder](http://www.schuerig.de/michael/blog/index.php/2007/12/22/javascript-fsm/)，因此您不必自己构建。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T22:17:23.937

Fernando 已经提到了 FSM，并提供了很好的信息和链接。:)

此外，我还要补充一点，您的类应该已经包含足够的状态，这样您就不必担心排序两次等。即，widgetB.sort() 应该检查自上次更新以来它是否已排序，如果是则返回。这样做几乎没有缺点，它可以提高性能（也可以保护一致性）。

# c# - 我希望能够通过网络从 BIOS 中提取错误日志

> ID：579216
> 
> 赞同：5
> 
> 时间：2009-02-23T20:35:04.213
> 
> 标签：c#, logging, wmi, bios

我希望能够通过网络从 BIOS 中提取错误日志。查看 MSDN 中的 Win32_BIOS，我没有看到任何定义错误日志的内容。很想在 C# 中使用 WMI 执行此操作，但我愿意接受建议。可能吗？

Win32_BIOS 没有包含 BIOS 错误日志的属性（不知道这是否正确）。是否有库、API 等可用于在本地或从网络中提取此信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2017-04-11T03:18:29.673

通常，不可能以适用于各种主板的方式执行此操作，因为必要的命令和接口将是特定于硬件的。

一些主板可能包含允许这样做的 API 调用，但是，我自己从未遇到过。

# java - 设置 catalina.policy 以允许 servlet 访问文件

> ID：579224
> 
> 赞同：5
> 
> 时间：2009-02-23T20:36:26.550
> 
> 标签：java, security, configuration, tomcat

我们有一个本地开发的基于 b 树的三元存储，我想在许多 servlet 应用程序中将其用于持久存储。我不想将 b-tree 索引文件嵌入到 servlet .war 中，而是希望将它们存储在已知位置并让 servlet 直接访问它们。这一切都适用于 Jetty，但当我在 Tomcat 中尝试时会引发安全异常。有人告诉我，Tomcat 的安全模型需要明确的 servlet 权限才能访问解压 .war 的目录树之外的文件。如果我正确理解了 Tomcat（5.5 版）文档，则添加以下内容`catalina.policy`应该允许 servlet 访问索引文件所在的目录：

```
grant codeBase "jar:file:${catalina.home}/webapps/mytestapp/-"
{
  permission java.io.FilePermission "/var/data/tdb/-", "read, write, delete"; 
} 
```

但是，我仍然遇到安全异常：

```
java.io.FileNotFoundException: 
                    /var/data/tdb/kb/node2id.idn (Permission denied)
    at java.io.RandomAccessFile.open(Native Method)
    ... 
```

剔除明显的愚蠢错误：我检查了索引文件位于正确的位置，具有正确的权限，并且没有损坏。任何关于我在安全设置中出错的建议或提示将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T20:49:20.653

```
java.io.FileNotFoundException: 
                /var/data/tdb/kb/node2id.idn (Permission denied) 
```

这是您的操作系统拒绝访问，而不是 Java 安全性。如果它是 Java 安全性，你会得到一个`AccessControlException`（或其他形式的`SecurityException`）。您正在运行 Tomcat 进程的用户可能无权访问该文件。

# mysql - MySQL数据库优化最佳实践

> ID：579244
> 
> 赞同：16
> 
> 时间：2009-02-23T20:42:19.233
> 
> 标签：mysql, database, performance

在处理较大的表（> 50k 条记录，每个表总共大约 100MB）时，优化 MySQL 安装以获得最佳性能的最佳实践是什么？我们目前正在研究重写 DelphiFeeds.com（Delphi 编程社区的新闻网站），并注意到简单的 Update 语句可能需要 50 毫秒。这似乎很多。是否有任何我们应该启用/设置的推荐配置设置，这些设置通常在标准 MySQL 安装中被禁用（例如，利用更多 RAM 来缓存查询和数据等）？

此外，存储引擎的选择对性能有何影响？我们计划使用 InnoDB，但如果出于性能原因推荐使用 MyISAM，我们可能会使用 MyISAM。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-23T22:09:45.780

“最佳实践”是：

1.  测量性能，尽可能隔离相关子系统。
2.  确定瓶颈的根本原因。您是否受 I/O 限制？CPU 受限？内存绑定？等锁？
3.  进行更改以减轻您发现的根本原因。
4.  再次测量，以证明您修复了瓶颈以及修复了*多少*。
5.  转到步骤 2 并根据需要重复，直到系统运行得足够快。

[在http://www.mysqlperformanceblog.com](http://www.mysqlperformanceblog.com)订阅 RSS 提要并阅读其历史文章。对于与性能相关的智慧，这是一个非常有用的资源。例如，您询问了 InnoDB 与 MyISAM 的对比。他们的结论是：InnoDB 的平均性能比 MyISAM 高约 30%。尽管也有一些使用场景 MyISAM 的性能优于 InnoDB。

*   [InnoDB vs. MyISAM vs. Falcon 基准测试 - 第 1 部分](http://www.mysqlperformanceblog.com/2007/01/08/innodb-vs-myisam-vs-falcon-benchmarks-part-1/)

该博客的作者也是@Andrew Barnett 提到的“高性能 MySQL”一书的合著者。

* * *

来自@ʞɔıu 的重新评论：如何判断您是否受 I/O 限制、CPU 限制和内存限制取决于平台。操作系统可能提供诸如 ps、iostat、vmstat 或 top 之类的工具。或者，如果您的操作系统没有提供第三方工具，您可能需要获取第三方工具。

基本上，无论哪种资源的利用率/饱和度为 100%，都可能成为您的瓶颈。如果您的 CPU 负载较低，但您的 I/O 负载对于您的硬件来说是最大的，那么您就是 I/O 受限的。

然而，这只是一个数据点。补救措施也可能取决于其他因素。例如，一个复杂的 SQL 查询可能正在执行文件排序，这会使 I/O 保持忙碌。您应该投入更多/更快的硬件，还是应该重新设计查询以避免文件排序？

在 StackOverflow 帖子中要总结的因素太多了，而且有很多关于该主题的书籍的事实支持了这一点。保持数据库高效运行并充分利用资源是一项需要专业技能和不断学习的全职工作。

* * *

Jeff Atwood 刚刚写了一篇关于发现系统瓶颈的精彩博客文章：

*   [计算机性能壳牌游戏](http://www.codinghorror.com/blog/archives/001235.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-23T21:18:22.813

去 O'Reilly 购买“高性能 MySQL”。关于该主题的内容将近 700 页，因此我怀疑您会在 SO 上找到简洁的答案。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-24T06:11:48.367

很难概括事物，但可以有一个适度的高级视图。

*   您需要评估读：写比率。对于比率低于 5:1 的表，您可能会从 InnoDB 中受益，因为这样插入不会阻塞选择。但如果您不使用事务，则应更改`innodb_flush_log_at_trx_commit`为 1 以恢复 MyISAM 的性能。
*   看内存参数。MySQL 的默认值非常保守，即使在普通硬件上，某些内存限制也可以提高 10 倍或更多。这将使您的 SELECT 而不是 INSERT 受益。
*   MySQL 可以记录诸如不使用索引的查询之类的内容，以及耗时过长的查询（用户可定义）。
*   查询缓存可能很有用，但您需要对其进行检测（即查看使用了多少）。仙人掌可以做到这一点；穆宁也一样。
*   应用程序设计也很重要：
    *   轻微缓存频繁获取但较小的数据集将有很大的不同（即几秒钟的缓存寿命）。
    *   不要重新获取您已经必须处理的数据。
    *   多步存储可以帮助将大量插入到也很忙的表中。基本思想是您可以有一个用于临时插入的表（`INSERT DELAYED`也可能很有用），但是一个批处理过程可以将 MySQL 中的更新从那里移动到所有读取发生的地方。有这种变化。
*   不要忘记观点和背景也很重要：如果“长时间”更新每天只发生一次，那么您可能认为需要很长时间`UPDATE`才能发生的事情实际上可能非常微不足道。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-07-18T22:14:40.750

之前已经讨论过大量最佳实践，因此没有理由重复它们。对于具体的建议，我会尝试运行[MySQL Tuner](http://wiki.mysqltuner.com/MySQLTuner)。它是一个 perl 脚本，您可以下载然后在数据库服务器上运行，它会为您提供有关数据库执行情况的大量统计信息（例如缓存命中）以及需要调整哪些问题或配置参数的一些具体建议以提高性能。

虽然这些统计数据都在 MySQL 本身中可用，但我发现这个工具以更容易理解的方式提供它们。虽然重要的是要注意关于建议的 YMMV，但我发现它们通常非常准确。只需确保您在使用实际流量之前做好了使用数据库的工作。

# php - 包括一个 PHP 文件，处理来自该目录的相对 URL

> ID：579246
> 
> 赞同：1
> 
> 时间：2009-02-23T20:42:29.717
> 
> 标签：php, url, relative-path, server-side-scripting

我的服务器**根目录**有一个 PHP 文件.. index.php ..[`include`](http://www.php.net/include/)是 .. DIR/main.php

现在 .. DIR/main.php .. [`include`](http://www.php.net/include/)的许多**附近**的PHP 文件使用**相对**URL 使用 ..`include("./common1.php");`

任何方式我都可以更改相对 URL**基本路径**，因此当包含“DIR/main.php”时，它可以相对访问其附近的 PHP 文件，如“DIR/common1.php”，而不是尝试在站点根目录。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T20:46:08.773

看看[set_include_path](http://www.php.net/manual/en/function.set-include-path.php)

编辑：将路径附加到[include_path](http://www.php.net/manual/en/ini.core.php#ini.include-path)时，请务必使用 PATH_SEPARATOR 常量，因为它旨在使您的包含路径操作系统不可知。

```
<?php

set_include_path(implode(PATH_SEPARATOR, array(
    get_include_path(),
    '/DIR1',
    '/DIR2/DIR3',
    dirname(__FILE__),
)));

?> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T20:49:57.453

除了 lonut 的答案，您还可以使用[`__FILE__`](http://us.php.net/manual/en/language.constants.predefined.php)常量和`dirname()`.

```
$include_path = dirname(__FILE__);
set_include_path($include_path); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T20:55:33.570

首先，将*“相对 URL**基本路径**”*设置为您的目录

```
set_include_path( get_include_path() . '/DIR' ); 
```

其次，包括你的文件！

```
require( 'main.php' ); 
```

尽管我没有测试过，但这应该可以工作。

# ruby-on-rails - 如何为多站点应用程序的集成测试长度设置子域？

> ID：579249
> 
> 赞同：6
> 
> 时间：2009-02-23T20:42:48.437
> 
> 标签：ruby-on-rails, subdomain, integration-testing

在集成测试期间更改子域的最佳方法是什么？

jamis buck 建议使用主机！这里： [http ://weblog.jamisbuck.org/2006/3/9/integration-testing-in-rails-1-1#12](http://weblog.jamisbuck.org/2006/3/9/integration-testing-in-rails-1-1#12)

但根据rails API，主机！仅更改以下单个请求的主机。我在功能测试中寻找类似@request.host 的东西，它让我可以在整个测试中使用子域。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-23T22:31:28.503

我正在使用**主机！**在我的集成测试中没有问题。**我一般在设置**方法中调用一次，例如

```
def setup
    host! "my.host"    
end 
```

# css - 水平有序列表（和 IE）

> ID：579253
> 
> 赞同：9
> 
> 时间：2009-02-23T20:43:23.647
> 
> 标签：css, internet-explorer, list, alignment

我正在寻找类似这样的输出：

```
1\. One      2\. Two      3\. Three      4\. Four 
```

来自以下 HTML 代码

```
<ol>
    <li>One</li>
    <li>Two</li>
    <li>Three</li>
    <li>Four</li>
</ol> 
```

当您浮动 li 以使它们水平时，Internet Explorer 似乎不想显示数字（列表项）。

有没有人遇到过这个问题并找到了我可以使用的解决方案？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T20:44:59.913

你能用这个 CSS 吗？

```
li  {display: inline} 
```

*编辑*：这不会保留项目编号，我不知道有任何方法可以这样做。作为替代，我想你所能做的就是手动插入数字，直到浏览器更好地支持 CSS 计数器。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-11-06T14:34:59.747

此代码适用于我测试过的所有浏览器。如果您还没有找到答案，那么关于最受欢迎答案的建议是有效的。如果你想让它包裹起来，只需调整你的宽度。

```
<ol style="list-style-type:decimal; width: 600px;">
    <li style="float: left; width: 200px; padding: 2px 0px;">Test</li>
    <li style="float: left; width: 200px; padding: 2px 0px;">Test</li>
    <li style="float: left; width: 200px; padding: 2px 0px;">Test</li>
</ol>

ol.horizontal{
    list-style-type: decimal;
    width: 600px;
}

ol.horizontal li{
    float: left;
    width: 200px;
    padding: 2px 0px;
}

<ol class="horizontal">
    <li>Test</li>
    <li>Test</li>
    <li>Test</li>
</ol> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T21:10:22.507

我已经尝试了[此页面](http://www.w3schools.com/css/pr_class_display.asp)`display`上的每个属性，但在 IE 中水平显示列表时，它们都没有保留有序列表编号（它们也没有保留在 Windows 的 Firefox、Opera 或 Safari 中 - 并且扩展可能是 Google Chrome，尽管我承认我没有测试那里的每个属性）。`display`

唯一有效的解决方案（部分 - 仅在 Firefox 中）是[Al W's answer](https://stackoverflow.com/questions/579253/horizontal-ordered-list-and-ie/579278#579278)。

我认为如果你想要一个水平编号的列表，你将不得不在服务器上生成它或使用 JavaScript 在客户端操作列表以重新插入数字。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-09T12:48:36.590

好的，你需要在css中添加一个float、width和list-style-type属性。看起来像这样：

```
李{
    向左飘浮;
    宽度：50px；
    列表样式类型：十进制；
}

```

古士肯

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T20:48:24.990

您不能在内联元素上设置宽度。所以我通常最终会浮动它们

```
li
{
    float: left;
    width:30px;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T20:44:50.990

CSS：

```
li { display:inline; } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T12:12:12.323

我发现[这个关于 IE hasLayout 的页面](http://www.satzansatz.de/cssd/onhavinglayout.html#list)很有用。它包括对此类列表格式的讨论（链接指向页面的列表部分）

# performance - EBP帧指针寄存器的作用是什么？

> ID：579262
> 
> 赞同：99
> 
> 时间：2009-02-23T20:45:38.040
> 
> 标签：performance, assembly, x86

我是汇编语言的初学者，并且注意到编译器发出的 x86 代码即使在发布/优化模式下通常也会保留帧指针，因为它可以将`EBP`寄存器用于其他用途。

`alloca()`我理解为什么帧指针可能会使代码更容易调试，并且如果在函数中调用它可能是必要的。但是，x86 的寄存器很少，并且使用其中的两个来保存堆栈帧的位置，而一个就足够了，这对我来说没有意义。为什么即使在优化/发布版本中省略帧指针也被认为是一个坏主意？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2009-02-23T20:55:59.293

帧指针是一个引用指针，允许调试器通过单个常量偏移量知道局部变量或参数的位置。尽管 ESP 的值在执行过程中发生变化，但 EBP 保持不变，从而可以在相同的偏移量处达到相同的变量（例如第一个参数将始终为 EBP+8 而 ESP 的偏移量可能会发生显着变化，因为您将推动/弹出东西）

为什么编译器不丢弃帧指针？因为使用帧指针，调试器可以确定局部变量和参数在哪里使用符号表，因为它们保证在 EBP 的恒定偏移处。否则，没有一种简单的方法可以确定局部变量在代码中的任何位置。

正如 Greg 所提到的，它还有助于调试器的堆栈展开，因为 EBP 提供了堆栈帧的反向链接列表，因此让调试器能够确定函数的堆栈帧（局部变量 + 参数）的大小。

大多数编译器都提供了省略帧指针的选项，尽管它使调试变得非常困难。该选项不应该在全局范围内使用，即使在发布代码中也是如此。您不知道何时需要调试用户的崩溃。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-02-24T21:43:25.867

只需将我的两美分添加到已经很好的答案中。

拥有堆栈帧链是良好语言架构的一部分。BP 指向当前帧，其中存储了子程序局部变量。（局部变量为负偏移，参数为正偏移。）

它阻止在优化中使用完美的寄存器的想法提出了一个问题：优化何时何地真正值得？

只有在以下情况下优化才值得：1) 不调用函数，2) 程序计数器花费大量时间，以及 3) 在编译器实际会看到的代码中（即非库函数）。这通常只占整个代码的一小部分，尤其是在大型系统中。

其他代码可以被扭曲和压缩以摆脱循环，这根本不重要，因为程序计数器几乎不存在。

我知道你没有问这个，但根据我的经验，99% 的性能问题与编译器优化完全无关。它们与过度设计有关。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-23T20:49:53.117

当然，这取决于编译器。我见过 x86 编译器发出的优化代码，它们自由地将 EBP 寄存器用作通用寄存器。（不过，我不记得我注意到哪个编译器了。）

编译器也可以选择维护 EBP 寄存器以帮助在异常处理期间展开堆栈，但这又取决于编译器的精确实现。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-23T21:00:41.297

> 但是，x86 的寄存器很少

这仅在操作码只能寻址 8 个寄存器的意义上是正确的。处理器本身实际上将拥有比这更多的寄存器，并使用寄存器重命名、流水线、推测执行和其他处理器流行语来绕过这个限制。维基百科有一个很好的介绍性段落，说明 x86 处理器可以做什么来克服寄存器限制：[http](http://en.wikipedia.org/wiki/X86#Current_implementations) ://en.wikipedia.org/wiki/X86#Current_implementations 。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T20:51:58.993

使用堆栈帧在任何硬件中都变得非常便宜，即使是远程现代的。如果您有便宜的堆栈帧，那么保存几个寄存器就不是那么重要了。我确信快速堆栈帧与更多寄存器是一个工程权衡，并且快速堆栈帧获胜。

纯注册可以节省多少钱？这值得么？

# ruby-on-rails - 在 Rails 中从 2 个变为多个

> ID：579266
> 
> 赞同：1
> 
> 时间：2009-02-23T20:46:31.657
> 
> 标签：ruby-on-rails, entity-relationship

我有一个正在设计的 Rails 应用程序。我有一个单独的模型，只需要链接到一个模型中的两个。具体来说，我的“评估”有 2 个“成员”，一个评估者和一个评估者。他们也有一些其他的信息，但它们不应该与此相关。

代表这一点的最佳方式是什么？评估中的 2 个外键是最好的，还是评估和成员之间的多对多关系？是否有其他选择会更好？

我最初会考虑多对多，但由于关系的一侧有一个定义的数字，我质疑这里的适用性。据我所知，多对多通常意味着关系每一侧的数字是可变的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T20:52:08.710

您可能需要两个不同的关联，可能具有相同的类：

```
class Member < ActiveRecord::Base
  has_many :evaluations_out, :class_name => 'evaluation', :as => :evaluator
  has_many :evaluations_in, :class_name => 'evaluation', :as => :evaluatee
end

class Evaluation < ActiveRecord::Base
  belongs_to :evaluator, :class_name => 'member'
  belongs_to :evaluatee, :class_name => 'member'
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T21:00:03.013

我自己还没有测试过，听起来可能有点冒险，但我认为这可行：

**评估模型**

```
class Evaluation < ActiveRecord::Base 
  belongs_to :evaluator, :class_name => "Member", :foreign_key => "evaluator_id"
  belongs_to :evaluatee, :class_name => "Member", :foreign_key => "evaluatee_id"

end 
```

**会员模型**

```
class Member < ActiveRecord::Base
  has_many :evaluators, :class_name => "Evaluation", :foreign_key => "evaluator_id"
  has_many :evaluatees, :class_name => "Evaluation", :foreign_key => "evaluatee_id"

end 
```

# entity-framework - 实体框架、动态数据和版本控制

> ID：579269
> 
> 赞同：0
> 
> 时间：2009-02-23T20:47:05.010
> 
> 标签：entity-framework, dynamic-data

我正在寻找后台工具的选项。从表面上看，该工具是简单的 CRUD，因此我立即被 Entity Framework 之上的动态数据所吸引（我们绝对是 Microsoft 商店！）。

问题是未来的要求是支持版本控制。我的意思是：

1.  用户对一系列实体执行一系列更新
2.  当他们满意时，他们会提交更改
3.  更改与足够的信息一起保存到数据库以支持回滚

在其他地方，我们有手工制作的应用程序：

*   包括一个版本 id，它随着每个新行的插入而增加 - 即我们不更新我们添加一个新行
*   工作项表使用版本 ID 和实体类型（表）将更改联系在一起

那么，问题是，我如何使用实体框架和动态数据实现类似的最终结果？

如果实体框架等不合适 - 你会使用什么（.Net）？

谢谢，艾伦

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-13T22:20:26.997

一种解决方案是将版本控制的逻辑移至数据库触发器。通过这种方式，您可以在 Entity Framework 之上使用标准动态数据，并通过运行一组数据库脚本来改进版本控制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T16:43:09.200

我想提一下，在新的 Dyanmic Data Preview 3 中，有一个支持基于角色的安全性的新功能 DomainService 请在此处查看 MIX09 中的 David Ebbo 的 Serssion [Microsoft ASP.NET 4.0 Data Access: Patterns for Success with Web Forms MIX09-T47F](http://videos.visitmix.com/MIX09/T47F)

# c# - 在 C# 中实例化一个 python 类

> ID：579272
> 
> 赞同：44
> 
> 时间：2009-02-23T20:47:25.570
> 
> 标签：c#, .net, python, ironpython, cross-language

我在 python 中编写了一个类，我想通过 IronPython 将其包装到 .net 程序集中并在 C# 应用程序中实例化。我已经将该类迁移到 IronPython，创建了一个库程序集并引用了它。现在，我如何真正获得该类的实例？

该类（部分）看起来像这样：

```
class PokerCard:
    "A card for playing poker, immutable and unique."

    def __init__(self, cardName): 
```

我用 C# 编写的测试存根是：

```
using System;

namespace pokerapp
{
    class Program
    {
        static void Main(string[] args)
        {
            var card = new PokerCard(); // I also tried new PokerCard("Ah")
            Console.WriteLine(card.ToString());
            Console.ReadLine();
        }
    }
} 
```

为了在 C# 中实例化这个类，我需要做什么？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-02-23T22:14:43.380

IronPython 类*不是*.NET 类。它们是 Python 元类 IronPython.Runtime.Types.PythonType 的实例。这是因为 Python 类是动态的，并且支持在运行时添加和删除方法，这是 .NET 类无法做到的。

要在 C# 中使用 Python 类，您需要使用 ObjectOperations 类。此类允许您以语言本身的语义对 python 类型和实例进行操作。例如，它在适当的时候使用魔术方法，自动将整数提升为长整数等。您可以通过查看源代码或使用反射器来了解有关 ObjectOperations 的更多信息。

这是一个例子。Calculator.py 包含一个简单的类：

```
class Calculator(object):
    def add(self, a, b):
        return a + b 
```

您可以在 .NET 4.0 C# 之前的代码中使用它，如下所示：

```
ScriptEngine engine = Python.CreateEngine();
ScriptSource source = engine.CreateScriptSourceFromFile("Calculator.py");
ScriptScope scope = engine.CreateScope();

ObjectOperations op = engine.Operations;

source.Execute(scope); // class object created
object klaz = scope.GetVariable("Calculator"); // get the class object
object instance = op.Call(klaz); // create the instance
object method = op.GetMember(instance, "add"); // get a method
int result = (int)op.Call(method, 4, 5); // call method and get result (9) 
```

您将需要引用程序集 IronPython.dll、Microsoft.Scripting 和 Microsoft.Scripting.Core。

C# 4 使用*新*的动态类型使这变得更加容易。

```
ScriptEngine engine = Python.CreateEngine();
ScriptSource source = engine.CreateScriptSourceFromFile("Calculator.py");
ScriptScope scope = engine.CreateScope();
source.Execute(scope);

dynamic Calculator = scope.GetVariable("Calculator");
dynamic calc = Calculator();
int result = calc.add(4, 5); 
```

如果您使用带有 NuGet 支持的 Visual Studio 2010 或更高版本，只需执行此操作即可下载并引用相应的库。

```
Install-Package IronPython 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2010-04-27T15:39:13.937

现在 .Net 4.0 已发布并具有动态类型，此示例应该更新。使用与 m-sharp 的原始答案相同的 python 文件：

```
class Calculator(object):
    def add(self, a, b):
        return a + b 
```

以下是使用 .Net 4.0 调用它的方式：

```
string scriptPath = "Calculator.py";
ScriptEngine engine = Python.CreateEngine();
engine.SetSearchPaths(new string[] {"Path to your lib's here. EG:", "C:\\Program Files (x86)\\IronPython 2.7.1\\Lib"});
ScriptSource source = engine.CreateScriptSourceFromFile(scriptPath);
ScriptScope scope = engine.CreateScope();
ObjectOperations op = engine.Operations;
source.Execute(scope);

dynamic Calculator = scope.GetVariable("Calculator");
dynamic calc = Calculator();
return calc.add(x,y); 
```

同样，您需要添加对 IronPython.dll 和 Microsoft.Scripting 的引用。

如您所见，源文件的初始设置和创建是相同的。

但是，一旦源代码成功执行，使用 python 函数就容易多了，这要归功于新的“动态”关键字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-06-11T14:12:29.587

我正在更新 Clever Human 为编译的 IronPython 类 (dll) 提供的上述示例，而不是 .py 文件中的 IronPython 源代码。

```
# Compile IronPython calculator class to a dll
clr.CompileModules("calculator.dll", "calculator.py") 
```

新动态类型的 C# 4.0 代码如下：

```
// IRONPYTHONPATH environment variable is not required. Core ironpython dll paths should be part of operating system path.
ScriptEngine pyEngine = Python.CreateEngine();
Assembly myclass = Assembly.LoadFile(Path.GetFullPath("calculator.dll"));
pyEngine.Runtime.LoadAssembly(myclass);
ScriptScope pyScope = pyEngine.Runtime.ImportModule("calculator");
dynamic Calculator = pyScope.GetVariable("Calculator");
dynamic calc = Calculator();
int result = calc.add(4, 5); 
```

参考：

1.  [使用 .NET/CSharp IP 2.6 中的已编译 Python 类](http://www.ironpython.info/index.php/Using_Compiled_Python_Classes_from_.NET/CSharp_IP_2.6)
2.  [IronPython脚本的静态编译](http://blogs.msdn.com/b/srivatsn/archive/2008/08/06/static-compilation-of-ironpython-scripts.aspx)

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-02-23T21:09:38.887

我搜索了高低，恐怕似乎没有太多与此有关的信息。我几乎可以肯定，没有人设计出一种以您想要的干净方式执行此操作的方法。

我认为这是一个问题的主要原因是，为了查看`PokerCard`C# 应用程序中的类型，您必须将 Python 代码编译为 IL。我不相信那里有任何 Python `->`IL 编译器。

# iphone - iPhone：仅将 UITableView 的一部分置于编辑模式

> ID：579273
> 
> 赞同：9
> 
> 时间：2009-02-23T20:47:38.097
> 
> 标签：iphone, objective-c, cocoa-touch, uikit

我假设的 UITableView 中有三个部分。我想要一个处于编辑模式的部分。其余部分不处于编辑模式。这可能吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-24T03:29:16.073

这真的不应该是一个谜，因为它在文档中清楚地说明了。只需使用数据源方法

```
- (BOOL)tableView:(UITableView *)tableView canEditRowAtIndexPath:(NSIndexPath *)indexPath 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-01-19T01:10:56.593

这对我很有用。在下面的示例中，第 0 部分不可编辑，而其他部分则可编辑。

```
override func tableView(_ tableView: UITableView, canEditRowAt indexPath: IndexPath) -> Bool {
    if indexPath.section == 0{
        return false
    }
    return true
} 
```

# reporting-services - 在 SQL 报告服务中，有没有办法对用户动态隐藏某些参数（但不是全部）？

> ID：579281
> 
> 赞同：2
> 
> 时间：2009-02-23T20:49:28.967
> 
> 标签：reporting-services, reportingservices-2005

有没有办法让 SQL Reporting Services (2005) 动态显示或隐藏参数？

例如，如果用户是“超级用户”，则显示参数 A、B、C、D，但如果您是新手，只显示 A 和 B？

这不是安全或“限制”问题，只是试图不压倒某些用户或过度限制其他用户。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T06:38:02.373

不像你想的那么简单，对不起。

一种方法是为不同的用户创建链接报告，例如“报告（高级过滤器）”和“报告（简单过滤器）”。您可以在链接报表的属性中隐藏参数。

另一种方法，假设您使用 User!UserID，将基于此更改列表参数的内容（通过在将参数绑定到数据集时在数据库端进行过滤）。

最后，您可以使用 ReportViewer 控件来完成此操作，但这需要 ASP.NET 包装器。

# .net - 单元测试 Mere Mortals .NET Framework

> ID：579298
> 
> 赞同：1
> 
> 时间：2009-02-23T20:53:31.127
> 
> 标签：.net, unit-testing

假设客户已经选择使用 Oak Leaf Software 的 Mere Mortals Framework，那么推荐的方法是什么来允许单元测试和正确分离生成的应用程序的关注点？理想情况下，我想实现类似 SOLID 设计原则的东西，并拥有不完全耦合到数据库的层。我对 MM.NET 的了解仍然是介绍性的 - 是否有人处理过这个问题，如果有，您能否确定框架中的接缝，使之成为可能（我敢希望很容易吗？）从系统中实现这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T21:33:35.397

首先，阅读[有关单元测试的其他线程。](https://stackoverflow.com/questions/tagged/unit-testing)，包括这里的几个好宝石：

*   [什么是好的单元测试](https://stackoverflow.com/questions/61400/what-makes-a-good-unit-test)
*   [测试私有方法的最佳方法是什么](https://stackoverflow.com/questions/34571/whats-the-best-way-of-unit-testing-private-methods)
*   [你怎么知道要测试什么](https://stackoverflow.com/questions/62625/how-do-you-know-what-to-test-when-writing-unit-tests)
*   [开始 TDD 开发](https://stackoverflow.com/questions/24965/beginning-tdd-challenges-solutions-recommendations)

直接查看适用于您的项目的内容。

具体来说，在使用框架时，请确定您需要测试的内容。你信任框架和供应商吗？然后不要太担心对他们的代码进行单元测试。你可以假设那里有一个测试边界——他们已经确保他们的东西是正确的。由您来确保*您的*代码是正确的。

除此之外，使用 MM.NET 为您的代码开发单元测试与为任何其他应用程序库开发代码没有什么不同。遵循其他问题中的一些建议，你应该做得很好。

# c# - 如何将 32bpp 图像转换为索引格式？

> ID：579301
> 
> 赞同：2
> 
> 时间：2009-02-23T20:54:04.073
> 
> 标签：c#, image-processing, color-palette

所以这里是详细信息（我使用的是 C# BTW）：

我从服务器接收到 32bpp 图像（JPEG 压缩）。在某些时候，我想使用位图的 Palette 属性将过饱和像素（亮度 > 240）着色为红色。为此，我需要将图像转换为索引格式。

我曾尝试将图像转换为 GIF，但质量下降。我尝试通过以下方法创建索引格式的新位图：

```
// causes a "Parameter not valid" error
Bitmap indexed = new Bitmap(orig.Width, orig.Height, PixelFormat.Indexed)

// no error, but the resulting image is black due to information loss I assume
Bitmap indexed = new Bitmap(orig.Width, orig.Height, PixelFormat.Format8bppIndexed) 
```

我现在不知所措。此图像中的数据由用户不断更改，因此如果可以避免的话，我不想手动设置亮度 > 240 的像素。如果我可以在创建图像时设置一次调色板，我的工作就完成了。如果我要以错误的方式开始，请告诉我。

编辑：谢谢大家，这里有一些关于我想要完成的事情的更多细节。

我们正在以高分辨率扫描组织载玻片（病理学应用）。我将接口写入实际的扫描仪。我们使用线扫描相机。为了测试相机的线速，用户扫描一个非常小的部分并查看图像。

图像显示在轨迹栏旁边。当用户移动轨迹栏（调整行频）时，我会更改图像的整体强度，以尝试模拟在新行频下的样子。我目前使用 ImageAttributes 和 ColorMatrix 对象来执行此操作。

当用户调整轨迹栏时，我调整矩阵。这并没有给我每个像素的信息，但性能非常好。我*可以*在这里使用 LockBits 和一些不安全的代码，但如果可能的话，我宁愿不重写它。创建新图像时，我希望将亮度值 > 240 的所有像素都涂成红色。我在想，预先为位图定义一个调色板将是一种干净的方式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T21:04:52.660

从 32bpp 索引到 8bpp 索引几乎总是会导致质量损失，除非原始图像总共少于 256 种颜色。

您能否创建另一个图像，该图像是受影响像素为红色的叠加图像，然后显示这两个图像？

由于您要获得 > 240 的亮度，因此您可以先将叠加层转换为灰度，然后再进行索引以获得过亮像素。

一旦你标记了罪犯，你就没有指定你在做什么，所以我不知道这是否会奏效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T21:02:43.210

听起来您可以使用像素着色器轻松完成。即使是非常早期的着色器模型也会支持像这样简单的东西。

然而问题是：

你能在你的应用程序中包含着色器支持而不用太麻烦吗？

你知道着色器编程吗？

编辑：

你可能没有 3D 上下文可以做这样的事情 =/

我主要是在表达我的想法。

一个像素一个像素地处理图片应该可以用一个 CPU 实时完成，不是吗？

如果没有，请查看 GPGPU 编程和 Open CL。

再次编辑：

如果您提供有关该应用程序实际功能的更多详细信息，我们可能会提供更多帮助吗？例如，如果您正在制作一个网络应用程序，那么我的任何提示都没有意义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T00:18:47.840

感谢大家的帮助。似乎这可以使用 ImageAttributes 类并简单地设置颜色重映射表来解决。

```
ColorMap[] maps = new ColorMap[someNum]
//  add mappings
imageAttrs.SetRemapTable(maps); 
```

再次感谢您的帮助，至少我学到了一些东西。

# programming-languages - 是否有用于 Web 编程的稳定编程语言？

> ID：579302
> 
> 赞同：7
> 
> 时间：2009-02-23T20:54:15.523
> 
> 标签：programming-languages, web

一位著名的 PHP 用户曾经说过：无论如何，2 年后会重新启动。

那些时光已经一去不复返了。超过 5 年的 Web 应用程序很常见。原来的开发者走了。

如果您没有大量员工，那么操作系统、编程语言和框架的发布周期会妨碍您进行实际工作。

有没有办法开发不需要不断移植到下一个级别的东西，而不用担心失去社区的支持和支持？对于那些想要留在编程而不是爬上公司阶梯并将问题留给下一代“一代”的人？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-23T20:57:56.873

我的公司几乎完全用 C# 编写代码，但是我们有 ColdFusion 5 应用程序仍在嗡嗡作响，这是在 2001 年左右编写的。无需移植它们。

**如果它没有坏，不要修理它。**

除了安全漏洞（通常由操作系统/服务器补丁处理，因此它们不需要更改代码）之外，没有必要仅仅因为语言的新版本出现而更改应用程序。

如果我没记错的话，自从我们停止将 ColdFusion 用于新代码以来，它至少已经发布了 2 个新版本。但这丝毫没有影响我们的 ColdFusion 站点。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-23T21:20:09.703

用 FORTRAN 77 编写 CGI 程序。应该很稳定。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-23T21:45:19.083

首先，可能夸大了维护 Web 应用程序的难度。在许多情况下，对语言或平台的更改本质上是扩展性的，而不是破坏性的。几年前的 .NET、python 等代码仍将运行，但正在添加新选项以使这些工具对未来的应用程序更强大。发生巨大变化的情况往往发生在语言的第一次或第二次迭代中，例如 Rails 1 到 Rails 2。

其次，网络编程仍然活跃的发展是值得感谢的。这意味着这是该行业的一部分，将在未来几年保持高效和令人兴奋。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-23T20:58:11.020

[传统的 CGI](http://hoohoo.ncsa.uiuc.edu/cgi/)是稳定的。这并不性感，但如果您的操作系统继续能够运行相同的二进制文件或脚本，它仍然可以工作。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-23T21:02:21.760

唯一保持稳定的编程框架是那些已被放弃的框架。一个静止不动的框架将不支持 AJAX 或 JSON 甚至 XML。

你不会找到你要的东西。您可以期望的最好的结果是一个成熟的框架，它具有良好的支持，如 ASP.net 或 JSP。而且，正如@Neil N 所说，除非有迫切的业务需求，否则不要继续升级。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-23T22:07:52.057

我做过的第一个 Web 编程是用 C 语言编写与 dBase 数据库通信的 Apache 模块。我相当肯定代码今天仍然可以运行（如果我为其编写代码的公司仍然存在的话）。

我目前大部分与 Web 相关的编程都是在 Perl 中完成的，它非常稳定，并且在向后兼容性方面有着出色的记录。大多数（如果不是全部）为 Perl 4（1991 年 3 月 21 日发布）编写的代码仍应在最新的稳定 Perl (5.10) 上运行——尽管您可能希望无论如何更新它以利用过去 18 年在这两个方面的改进软件开发技术和语言特性。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-07-09T09:51:36.907

考虑[剪切层](http://en.wikipedia.org/wiki/Shearing_layers)。我之前曾在大型航空航天公司工作，在这些公司中，相同的 Fortran 后端代码和数据库的前端从纸带时代发展到大型机、客户端服务器和 Intranet 网站。

在外部，您通常拥有 CSS 和 XHTML 模板，可以对其进行更改以重新设计应用程序的外观。这些变化非常迅速，在大型组织中，因为高层管理人员似乎决定每隔几周将自行车棚换成不同的颜色。

通常，您有一些逻辑将模板与来自后端的数据结合起来，并将用户操作转发到后端。这不应该很快改变，而是将演示文稿转换为后端的调用。预计每隔几年更新一次，并每隔十年重写一次。从 1990 年代后期开始，我们为此使用了 Java。有些零件的更换速度比其他零件快，但这不是大问题。

后端通常是稳定的（一些空气动力学代码可以追溯到 1970 年代；物理定律不会经常改变），并且会比 Web UI 更持久，因为它具有所有其他 UI 范例。Fortran 是永恒的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-23T21:34:47.127

用 C 编写自己的 Web 服务器，然后您就不必担心 Web 编程语言。

*（不，这不是一个严肃的答案）*

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-27T06:06:45.530

您是否认真研究过 TDD、CI、结对编程和可靠、快速的开发框架（基本上是 Django 或 Rails）可以为您作为开发人员提供什么，以及您编写和设计代码的方式？所有这些部分都为开发过程提供了一些真正巨大的好处，使再次成为程序员几乎是一种乐趣。当然，也有缺点，但优点都是支持工程师的快乐和易于开发，从而提高生产力。在我的书中，这是一场扣篮胜利。我的生产力和幸福的结果是可靠的产品和出色的工程。

YMMV，但是如果您有认真的想法（并且我非常认真地对待它们），我认为值得您研究这些工具可以提供什么。通过从敏捷宗教中汲取好处并留下坏处，加上我上面列出的一些东西，在经历了 5 年的快乐下滑之后，我又回到了去年再次找到编程的乐趣职业。这是关于找到适合你的东西。我只能通过向您展示对我有用的方法来提供帮助和引导。如果您想离线交谈，我非常乐意详细讨论，我认为这是一个非常重要的话题……它使我多次考虑转行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-11-16T17:27:26.893

Java Servlet 和 JSP 已经使用了十年左右，它们的工作方式仍然与 99 年相同。但老实说，你能想象比 90 年代的 Web 应用程序更丑陋的东西，而没有任何返工吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-10-31T12:20:44.503

Python Web 框架[web2py](http://www.web2py.com/)承诺向后兼容：

> **始终向后兼容。**自 2007 年 1.0 版以来，我们没有破坏向后兼容性，我们保证将来不会破坏它。

并支持从 2.4 到 2.7 的 Python 版本

**编辑：**更新一个重要项目 2 次，每次出现问题。嗯……</p>

**编辑 2：**现在需要 Python 2.6 到 2.7。不支持 Python 3。

# image - 禁用图像时，图像映射 alt 标签不可见

> ID：579304
> 
> 赞同：1
> 
> 时间：2009-02-23T20:54:21.000
> 
> 标签：image, imagemap

任何人都可以提供任何指示以确保在禁用图像时图像映射中的 alt 标记可见吗？

我正在使用 FireFox Developer 工具栏将图像替换为 Alt 属性。所有图像都替换为与其对应的替代文本，但图像映射不会。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T21:21:10.700

您应该将 Alt 标签放在 AREA 标签上，而不是图像上。

```
<area href="#" shape="rect" coords="0,25,50,100" alt="A rectangle" /> 
```

也尝试使用 Title 属性。

*   奥辛

# sql-server-ce - 使用 MSTest 进行数据驱动的单元测试

> ID：579305
> 
> 赞同：2
> 
> 时间：2009-02-23T20:54:32.323
> 
> 标签：sql-server-ce, mstest

我正在开发一个使用 MSTest 进行单元测试的项目，我需要为与数据源紧密耦合的模型类编写一些单元测试。我们在数据库项目 (.dbproj) 中维护模型类所依赖的数据库的源代码。我想做的是在我的测试类上编写一个 ClassInitialize 方法，该方法使用数据库项目以编程方式构建我们数据库的 SQL CE 实例，然后我可以填充可以将模型类连接到并对其执行测试的数据与已知数据。

如果有人有其他建议，我愿意接受。

我试图弄清楚如何从我的 ClassInitialize 方法的代码中运行这个数据库项目。我还没有找到任何很好的例子来说明如何做这样的事情。这可能吗？如果是这样，怎么做？有人有代码示例吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T20:59:44.450

不幸的是，数据层的单元测试是出了名的困难。我能建议的最好的方法是为您的数据层构建一个通用接口，并为您的业务层调用数据层模拟该接口。

如果您尝试对数据层进行单元测试，您将陷入痛苦的世界。我建议您跳过它并尝试在集成测试期间清除任何数据层错误。

也就是说，如果您使用的是 LINQ to SQL，我前几天看到了[这篇文章](http://aabs.wordpress.com/2007/06/26/using-mock-objects-when-testing-linq-code/)，它展示了如何模拟 LINQ to SQL 存储库。它需要一些额外的工作才能让它工作，但它可能对你有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T20:56:17.017

也许您应该考虑模拟 -起[订](http://code.google.com/p/moq/)量是一个很好的起点。基本上，模拟是有一个框架来模拟代码中的依赖项以帮助测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T15:44:53.270

我同意关于模拟的评论，但是您仍然可以进行自动化集成测试来练习存储库中的方法，例如类。

我在这里对我使用的一种技术（w/MS 测试）进行了非常详细的[描述](https://stackoverflow.com/questions/12374/has-anyone-had-any-success-in-unit-testing-sql-stored-procedures/25204#25204)

# xcode - WebView PDF 页面跳转

> ID：579308
> 
> 赞同：0
> 
> 时间：2009-02-23T20:55:35.503
> 
> 标签：xcode

我有一个显示本地 pdf 文件的 WebView。该文件有 230 页长并且加载良好等。如果可以的话，我需要一种方法让用户跳转到特定页面。例如，如果他们查看 pdf 的目录并想跳转到第 120 页，他们可以做到吗？关于完成这项工作的任何想法？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-02-25T06:55:58.487

您在询问有关在 iPhone SDK 中使用 Cocoa Touch API 的问题，但您将它们标记为“Xcode”。Xcode 是开发**工具**，而不是平台或 API；如果您添加“iphone-sdk”或“cocoa-touch”标签，您可能会为您的问题找到更好的听众。

# python - 在python中将长数字格式化为字符串

> ID：579310
> 
> 赞同：63
> 
> 时间：2009-02-23T20:55:58.170
> 
> 标签：python, formatting, string, integer

Python中有什么简单的方法可以将整数格式化为字符串，用K表示数千，用M表示数百万，逗号后只留下几个数字？

我想将 7436313 显示为 7.44M，将 2345 显示为 2,34K。

是否有一些可用的 % 字符串格式化运算符？或者只能通过在循环中实际除以 1000 并逐步构造结果字符串来完成？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-02-23T21:11:36.167

我不认为有一个内置函数可以做到这一点。你必须自己动手，例如：

```
def human_format(num):
    magnitude = 0
    while abs(num) >= 1000:
        magnitude += 1
        num /= 1000.0
    # add more suffixes if you need them
    return '%.2f%s' % (num, ['', 'K', 'M', 'G', 'T', 'P'][magnitude])

print('the answer is %s' % human_format(7436313))  # prints 'the answer is 7.44M' 
```

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2017-08-23T18:18:42.130

此版本不受先前答案中的错误的影响，即 999,999 为您提供 1000.0K。它也只允许 3 个有效数字并消除尾随的 0。

```
def human_format(num):
    num = float('{:.3g}'.format(num))
    magnitude = 0
    while abs(num) >= 1000:
        magnitude += 1
        num /= 1000.0
    return '{}{}'.format('{:f}'.format(num).rstrip('0').rstrip('.'), ['', 'K', 'M', 'B', 'T'][magnitude]) 
```

输出如下所示：

```
>>> human_format(999999)
'1M'
>>> human_format(999499)
'999K'
>>> human_format(9994)
'9.99K'
>>> human_format(9900)
'9.9K'
>>> human_format(6543165413)
'6.54B' 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2017-08-03T08:17:20.970

一个更“数学”的解决方案是使用`math.log`：

```
from math import log, floor

def human_format(number):
    units = ['', 'K', 'M', 'G', 'T', 'P']
    k = 1000.0
    magnitude = int(floor(log(number, k)))
    return '%.2f%s' % (number / k**magnitude, units[magnitude]) 
```

测试：

```
>>> human_format(123456)
'123.46K'
>>> human_format(123456789)
'123.46M'
>>> human_format(1234567890)
'1.23G' 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-04-21T12:09:23.060

可变精度并且没有 999999 错误：

```
def human_format(num, round_to=2):
    magnitude = 0
    while abs(num) >= 1000:
        magnitude += 1
        num = round(num / 1000.0, round_to)
    return '{:.{}f}{}'.format(num, round_to, ['', 'K', 'M', 'G', 'T', 'P'][magnitude]) 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-04-24T12:12:07.167

我今天需要这个函数，为 Python >= 3.6 的人刷新了接受的答案：

```
def human_format(num, precision=2, suffixes=['', 'K', 'M', 'G', 'T', 'P']):
    m = sum([abs(num/1000.0**x) >= 1 for x in range(1, len(suffixes))])
    return f'{num/1000.0**m:.{precision}f}{suffixes[m]}'

print('the answer is %s' % human_format(7454538))  # prints 'the answer is 7.45M' 
```

编辑：鉴于评论，您可能想要更改为`round(num/1000.0)`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-12-05T03:12:35.283

我对其他人展示的一些东西有点困惑，所以我做了下面的代码。它四舍五入到第二个小数点，例如。'235.6 亿'，但您可以通过将最后一行中的两个 '100.0' 替换为更大或更小的数字来更改它的小数位数，例如。“10.0”四舍五入到小数点后一位，“1000.0”四舍五入到小数点后三位。此外，使用此代码，它总是从实际值向下取整。您可以根据需要更改此设置，将 'floor' 替换为 'ceil' 或 'round'。

```
#make the dictionary to store what to put after the result (ex. 'Billion'). You can go further with this then I did, or to wherever you wish. 
#import the desired rounding mechanism. You will not need to do this for round. 
from math import floor
magnitudeDict={0:'', 1:'Thousand', 2:'Million', 3:'Billion', 4:'Trillion', 5:'Quadrillion', 6:'Quintillion', 7:'Sextillion', 8:'Septillion', 9:'Octillion', 10:'Nonillion', 11:'Decillion'}
def simplify(num):
    num=floor(num)
    magnitude=0
    while num>=1000.0:
        magnitude+=1
        num=num/1000.0
    return(f'{floor(num*100.0)/100.0} {magnitudeDict[magnitude]}') 
```

最后一行字符串之前的'f'是让python知道你正在格式化它。运行 print(simplify(34867123012.13)) 的结果是这样的：

```
34.86 Billion 
```

如果您有任何问题，请告诉我！谢谢，安格斯

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-01-14T16:01:26.743

我也有同样的需要。如果有人谈到这个话题，我找到了一个这样做的库：[https ://github.com/azaitsev/millify](https://github.com/azaitsev/millify)

希望能帮助到你 ：）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-07-20T11:59:15.657

[Numerize](https://pypi.org/project/numerize/)库很好。

```
from numerize import numerize
a = numerize.numerize(1000)
print(a)
1k 
```

感谢@tdy 指出这一点，

```
a = numerize.numerize(999999) 
print(a)  # 1000K 
1000K 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T21:02:49.247

[根据文档](http://docs.python.org/library/stdtypes.html#string-formatting-operations)，没有字符串格式运算符。我从来没有听说过这样的事情，所以你可能不得不按照你的建议自己动手。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T21:05:36.853

我认为没有格式运算符，但您可以简单地除以 1000，直到结果介于 1 和 999 之间，然后在逗号后使用 2 位数的格式字符串。在大多数情况下，单位是单个字符（或者可能是一个小字符串），您可以将其存储在字符串或数组中，并在每次划分后对其进行迭代。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-23T21:10:45.420

我不知道像这样的任何内置功能，但这里有几个可能有帮助的列表线程：

[http://coding.derkeiler.com/Archive/Python/comp.lang.python/2005-09/msg03327.html](http://coding.derkeiler.com/Archive/Python/comp.lang.python/2005-09/msg03327.html) [http://mail.python.org/pipermail/python-list/2008-August/503417.html](http://mail.python.org/pipermail/python-list/2008-August/503417.html)

# wcf - WCF服务调用SSIS包，w3wp.exe内存不断攀升

> ID：579322
> 
> 赞同：0
> 
> 时间：2009-02-23T20:58:47.667
> 
> 标签：wcf, ssis, memory-leaks

我的 .net WCF 服务使用 Package.Execute(); 调用 SSIS 包；方法。

调用执行后，我设置 pkg.Dispose() 和 app = null;

内存使用量不断攀升，从 100mb 到 150mb 一直到接近 300mb。

我现在正在回收进程，但想知道问题的根源。

有任何想法吗？

**更新** 调用 WCF 服务的应用程序位于另一台服务器上，因此那里没有问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-24T12:18:32.590

增加虚拟内存不一定是问题，300MB无论如何也不是很大的内存。IIS 会自行回收吗？如果没有，那么我建议你别管它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T21:16:22.617

你要关闭你的主机吗？只使用 using 语句？打开/关闭代码是什么样的？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T21:19:08.910

有很多方法可以完成这个非常常见的任务（诊断 w3wp 工作进程中的内存泄漏）。苔丝在这里有一篇很棒的“入门”帖子：

[http://blogs.msdn.com/tess/archive/2008/05/21/debugdiag-1-1-or-windbg-which-one-should-i-use-and-how-do-i-gather-内存转储.aspx](http://blogs.msdn.com/tess/archive/2008/05/21/debugdiag-1-1-or-windbg-which-one-should-i-use-and-how-do-i-gather-memory-dumps.aspx)

*   奥辛

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-28T23:43:44.360

您运行的是 SSIS 05 还是 08？我记得 05 在使用 API 调用时有一个已知的内存泄漏问题。

高温高压

# php - 是否可以跳过函数调用中具有默认值的参数？

> ID：579331
> 
> 赞同：8
> 
> 时间：2009-02-23T21:00:23.777
> 
> 标签：php, optional-parameters, function-call, named-parameters

我有这个：

```
function foo($a='apple', $b='brown', $c='Capulet') {
    // do something
} 
```

这样的事情可能吗：

```
foo('aardvark', <use the default, please>, 'Montague'); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-23T21:13:24.230

如果它是您的函数，您可以使用`null`通配符并稍后在函数内设置默认值：

```
function foo($a=null, $b=null, $c=null) {
    if (is_null($a)) {
        $a = 'apple';
    }
    if (is_null($b)) {
        $b = 'brown';
    }
    if (is_null($c)) {
        $c = 'Capulet';
    }
    echo "$a, $b, $c";
} 
```

然后您可以使用以下命令跳过它们`null`：

```
foo('aardvark', null, 'Montague');
// output: "aarkvark, brown, Montague" 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T21:13:22.077

如果它是您自己的函数而不是 PHP 的核心之一，您可以这样做：

```
function foo($arguments = []) {
  $defaults = [
    'an_argument' => 'a value',
    'another_argument' => 'another value',
    'third_argument' => 'yet another value!',
  ];

  $arguments = array_merge($defaults, $arguments);

  // now, do stuff!
}

foo(['another_argument' => 'not the default value!']); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T21:04:02.597

找到了这个，这可能仍然是正确的：

[http://www.webmasterworld.com/php/3758313.htm](http://www.webmasterworld.com/php/3758313.htm)

简短的回答：没有。

长答案：是的，以上面概述的各种笨拙方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T21:07:40.267

您几乎找到了答案，但学术/高级方法是[函数柯里化](http://en.wikipedia.org/wiki/Currying)，老实说，我从来没有发现它有多大用处，但知道存在是有用的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-11-17T21:24:22.207

[您可以使用一些怪癖，或者像ceejayoz](https://stackoverflow.com/users/1902010/ceejayoz)建议的那样将所有参数作为数组传递，或者使用一些过于复杂的代码来解析 func_get_args() 并与默认值列表合并。不要复制粘贴它，您必须使用对象和特征。最后，为了能够传递所有类型的值（不排除 null 或 false，通过使它们成为默认参数替换的信号），您必须声明一个虚拟的特殊类型 DefaultParam。另一个缺点是，如果您想在任何 IDE 中获得类型提示或帮助，您必须在函数声明中复制名称和默认值。

```
class DefaultParam {}

trait multi_arg_functions
{
  private static function multi_arg($defaults, $list, $preserve_index = false)
  {
    $arg_keys = array_slice(array_keys($defaults), 0, count($list));

    if ($preserve_index) {
      $listed_arguments = array_slice($list, 0, count($arg_keys));
      $extras = array_slice($list, count($arg_keys), null, true);
    } else {
      $listed_arguments = array_splice($list, 0, count($arg_keys));
      $extras = &$list;
    }
    unset($list);

    $arguments = array_combine($arg_keys, $listed_arguments);
    $arguments = array_filter($arguments, function ($entry) {
      return !($entry instanceof DefaultParam); //remove entries that mean default, a special class in this case
    });
    $arguments = array_merge($defaults, $arguments);

    return [$arguments, $extras];
  }
}

class b {
  use multi_arg_functions;

  static function func1($an_argument = 'a value', $another_argument = 'another value', $third_argument = 'yet another value') { //give defaults here to get hints in an IDE
      list($args, $extras) = self::multi_arg( //note: duplicate names and defaults
          [
          'an_argument' => 'a value',
          'another_argument' => 'another value',
          'third_argument' => 'yet another value!',
          ], func_get_args());

      echo json_encode(['args' => $args, 'extras' => $extras])."\n";
  }
}

$default_param = new DefaultParam();

b::func1('value 1');
b::func1('value 2', $default_param, 'third argument');
b::func1('value 3', $default_param, 'third argument', 'fourth argument'); 
```

注意：通过使用 preserve_index = true 您可以获得从原始索引开始的额外参数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-02T17:23:54.563

从 PHP 8 开始，使用[命名参数](https://php.watch/versions/8.0/named-parameters)：

```
function foo($a='apple', $b='brown', $c='Capulet') {
  // do something
}
foo('apple', c:'Montague'); 
```

这让您可以绕过任意数量的参数，允许它们采用默认值。这对冗长的函数很有帮助，例如[`setcookie`](https://www.php.net/manual/en/function.setcookie.php)：

```
setcookie('macadamia', httponly:true); // skips over 5 parameters 
```

请注意，命名参数需要传递所有非可选参数。这些可以按位置传递（就像我在这里所做的那样，上面没有名字）或以任何顺序传递名字。

# sql - 有没有办法阻止 SQL Express 2008 空闲？

> ID：579332
> 
> 赞同：8
> 
> 时间：2009-02-23T21:00:27.957
> 
> 标签：sql, database, sql-server-express

我正在使用 SQL Express 2008 作为 Web 应用程序的后端，问题是 Web 应用程序是在工作时间使用的，所以有时在午餐或休息时间，如果 20 分钟内没有用户登录，SQL Express 会进入空闲状态模式并释放其缓存。

我知道这一点，因为它记录了以下内容：

> 服务器在空闲 9709 秒后恢复执行

或者

> 在事件日志中启动数据库“xxxxxxx”

我想避免这种空闲行为。无论如何配置 SQL express 以停止空闲或至少将时间窗口扩大到超过 20 分钟？或者是我唯一的选择是编写一个每 15 分钟轮询一次数据库以保持后台运行的服务？

在阅读了这样的文章后[，](http://blogs.msdn.com/sqlexpress/archive/2008/02/22/sql-express-behaviors-idle-time-resources-usage-auto-close-and-user-instances.aspx)它看起来并不乐观，但也许有人知道有黑客或注册表设置。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T21:07:11.640

该行为是不可配置的。

您确实必须实现一种方法来经常轮询数据库。另外，就像您链接到的文章所说，将 AUTO CLOSE 属性设置为 false。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-02-25T17:02:00.580

每隔几分钟执行一次这样的简短 SQL 查询就可以防止 SQLserver 空闲：

```
SELECT TOP 0 NULL
  FROM [master].[dbo].[MSreplication_options]
GO 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T21:08:03.120

编写一个线程，每隔几分钟执行一次简单查询。在你的 global.asax Application_Start 中启动线程，你应该完成了！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-07-26T15:39:38.320

这是一个很好的解释：[https ://blogs.msdn.microsoft.com/sqlexpress/2008/02/22/understanding-sql-express-behavior-idle-time-resource-usage-auto_close-and-user-instances/](https://blogs.msdn.microsoft.com/sqlexpress/2008/02/22/understanding-sql-express-behavior-idle-time-resource-usage-auto_close-and-user-instances/)

随便：不知道`sql`快递空转后的时间。我建议每 10 分钟运行一次下面的脚本（也许是任务调度程序）。这将防止`SQL`Server Express 空闲：

```
SELECT TOP 0 NULL FROM [master].[dbo].[MSreplication_options] GO 
```

还要确保所有数据库的属性都设置为`AUTO_CLOSE = FALSE`

# c# - 存在数据时添加 ID 列的简单方法

> ID：579333
> 
> 赞同：1
> 
> 时间：2009-02-23T21:00:34.417
> 
> 标签：c#, .net, sql-server, linq-to-sql, tsql

有没有一种简单的方法可以将 ID (Identity(1,1) & PK) 列添加到已经有数据的表中？

我挑选了一个项目，该项目是由一个糟糕的开发人员自由开发的，他没有在他制作的表格上放置 PK、索引或任何东西。

现在我正在对其进行 LINQ 化，我没有 PK 可以插入或更新。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T21:06:10.363

```
ALTER TABLE MyTable ADD id INT IDENTITY(1,1) PRIMARY KEY CLUSTERED 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T21:08:06.723

我很想分三个阶段来做——

1.  创建一个包含所有相同列的新表，加上主键列（脚本出表，然后更改它以添加 PK 字段）
2.  将旧表中的所有值插入新表
3.  满意后，删除旧表并使用与旧表相同的主键重命名新表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T21:07:28.207

打开 SQL Server Management Studio
右键单击​​表
单击修改
添加列
设置属性（（是身份）是，身份种子 1，身份增量 1）
右键单击列
单击设置主键
Ctrl-S

# javascript - JavaScript 正则表达式将 URL 和电子邮件包装在锚点中

> ID：579335
> 
> 赞同：3
> 
> 时间：2009-02-23T21:00:43.730
> 
> 标签：javascript, regex

我搜索了高低，但无法找到明确的答案。正则表达式通常是这种情况。所以我想我会在这里问。

我正在尝试组合一个正则表达式，我可以在 JavaScript 中使用指向它们的锚标记替换 URL 和电子邮件地址的所有实例（不需要如此严格）。

显然，这通常在服务器端非常简单地完成，但在这种情况下，有必要使用纯文本，因此在运行时执行替换的优雅 JavaScript 解决方案将是完美的。

唯一的问题是，正如我之前所说，我的技能中有一个巨大的正则表达式形状的大洞:(

我知道你们中的一个人的答案唾手可得：）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T21:09:56.843

好吧，盲目地使用来自[http://www.osix.net/modules/article/?id=586的正则表达式](http://www.osix.net/modules/article/?id=586)

```
var emailRegex = 
   new RegExp(
   '([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}' + 
   '\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.' + 
   ')+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)',
   "gi");

var urlRegex = 
   new RegExp(
   '((https?://)' + 
   '?(([0-9a-z_!~*\'().&=+$%-]+: )?[0-9a-z_!~*\'().&=+$%-]+@)?' + //user@ 
   '(([0-9]{1,3}\.){3}[0-9]{1,3}' + // IP- 199.194.52.184 
   '|' + // allows either IP or domain 
   '([0-9a-z_!~*\'()-]+\.)*' + // tertiary domain(s)- www. 
   '([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.' + // second level domain 
   '[a-z]{2,6})' + // first level domain- .com or .museum 
   '(:[0-9]{1,4})?' + // port number- :80 
   '((/?)|' + // a slash isn't required if there is no file name 
   '(/[0-9a-z_!~*\'().;?:@&=+$,%#-]+)+/?))',
   "gi"); 
```

然后

```
text.replace(emailRegex, "<a href='mailto::$1'>$1</a>"); 
```

和

```
text.replace(urlRegex, "<a href='$1'>$1</a>"); 
```

可能会工作

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T07:30:08.147

这是一篇关于网址的好文章......

[https://blog.codinghorror.com/the-problem-with-urls/](https://blog.codinghorror.com/the-problem-with-urls/)

电子邮件更直接，因为它们必须以 .tld 结尾。你不需要对那个感兴趣，因为你没有验证，只是匹配，所以在我的脑海中......

[^\s]+@\w[\w-.]*.[a-zA-Z]+

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T21:09:39.310

不是罐装解决方案，但这[将为](http://www.regular-expressions.info/javascriptexample.html)您指明正确的方向。

我使用[Regex Coach](http://weitz.de/regex-coach/)来构建和测试我的正则表达式。您可以在线找到大量用于 url 和电子邮件地址的正则表达式示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T14:10:39.120

只需添加一些有关电子邮件正则表达式的信息：他们中的大多数似乎都忽略了域名中可以包含字符“åäö”。因此，如果您关心这一点，请确保您使用的解决方案在正则表达式的域部分中有 åäöÅÄÖ。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T21:31:36.277

与往常一样，this（“this”是“使用正则表达式处理 HTML”）将变得困难且容易出错。以下内容仅适用于格式合理的输入，但这是我要做的：

1.  找到你要处理的元素，取它的`innerHTML`属性值
2.  迭代地找到所有已经*是*链接的东西 ( `/(<a\b.+?</a>/ig`)
3.  基于此，将您的字符串切割成“这不是一个链接”和“这是一个链接”位，将它们全部附加到一个整齐有序的数组中
4.  仅处理“非链接”位（不以 开头的位`"<a "`），查找 URL 或电子邮件地址模式
5.  `<a>`将您在标签中找到的每个地址包装起来
6.  `join()`数组变回字符串
7.  将`innerHTML`属性设置为您的新值

我相信您会找到匹配电子邮件地址和 URL 的正则表达式示例。选择最适合您的，并在步骤 4 中使用它们。）。

# url - 您如何看待 ColdFusion 中的客户端 URL？

> ID：579350
> 
> 赞同：2
> 
> 时间：2009-02-23T21:05:50.083
> 
> 标签：url, coldfusion, cgi

假设在 ColdFusion 站点上，用户导航到 [http://www.example.com/sub1/](http://www.example.com/sub1/)

服务器端代码通常用于告诉您用户所在的 URL，如下所示： [http://#cgi.server_name##cgi.script_name#?#cgi.query_string#](http://#cgi.server_name##cgi.script_name#?#cgi.query_string#)

但是，“cgi.script_name”会自动包含该文件夹的默认 cfm 文件——例如，该代码在解析和扩展时将显示“ [http://www.example.com/sub1/index.cfm](http://www.example.com/sub1/index.cfm) ”

因此，无论用户访问的是 sub1/index.cfm 还是 sub1/，“cgi.script_name”变量都将包含该“index.cfm”。

问题是，如何确定用户实际访问的是哪个 URL？这个问题主要是出于搜索引擎优化的目的——通常最好将 301 重定向“/index.cfm”到“/”以确保任何内容只有一个 URL——因为这主要是为了蜘蛛的利益，所以 JavaScript 不是在这种情况下不是合适的解决方案。此外，假设一个人无权访问 isapi_rewrite 或 mod_rewrite - 问题是如何在 ColdFusion 中实现这一点，特别是。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T22:29:00.990

我想这是不可能的。

如果客户端请求“GET /”，Web 服务器将在调用 ColdFusion 之前将其转换为“GET /{whatever-default-file-exists-fist}”。（这对于让 Web 服务器知道必须首先调用 ColdFusion 是必要的！）

从 ColdFusion（或任何应用程序服务器）的角度来看，客户端请求“GET /index.cfm”，这就是您在`#CGI#`.

正如您自己指出的那样，可以通过使用 URL 重写工具来区分。由于您专门排除了该路径，因此我只能说您在这里不走运。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T21:35:45.907

不确定是否可以仅使用 CF，但您可以使用网络服务器的 URL 重写来实现这一点——*当然，如果您正在使用它们*。

对于 Apache，它可以是这样的。说，我们正在使用以下 mod_rewrite 规则：

> RewriteRule ^page/([0-9]+)/?$ index.cfm?page=$1&noindex=yes [L]

现在，当我们尝试访问 URL **[http://website.com/page/10/](http://website.com/page/10/)**时， CGI 显示：

> QUERY_STRING page=10&noindex=yes

看到这个想法了吗？认为在使用 IIS 时也有同样的可能。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T22:28:03.397

我认为这在 CF 中是不可能的。据我了解，网络服务器（Apache、IIS 等）确定要显示的默认页面，并从 CF 请求它。因此，CF 并不知道实际调用的页面是什么。

Sergii 是对的，您可以使用 URL 重写来执行此操作。如果这对您不可用，您可以使用特定页面在默认页面列表中优先的事实。

假设 default.htm 是默认页面列表中的第一页。编写一个自动转发到 index.cfm（或其他）的通用 default.htm。如果您可以调整默认列表，您可以让 CF 执行 301 重定向。如果没有，您可以在 HTML 文件中执行元刷新、JS 重定向或类似的操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T23:17:48.440

我认为这是可能的。

使用`GetHttpRequestData`您将可以访问所有 HTTP 标头。

然后其中的`GET`标题应该告诉您浏览器正在请求什么文件。

尝试

```
<cfdump var="#GetHttpRequestData()#"> 
```

准确查看您可以使用的内容。

注意 - 我没有 Coldfusion 可以验证这一点。

**编辑**：做了一些更多的研究后，似乎`GetHttpRequestData`不包括`GET`标题。所以这种方法可能行不通。

不过，我相信有一种方法 - 尝试转储 CGI 范围，看看你有什么。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-03T16:00:33.377

如果您能够安装 ISAPI_rewrite（假设您在 IIS 上） - [http://www.helicontech.com/isapi_rewrite/](http://www.helicontech.com/isapi_rewrite/)

它将变量 x-rewrite-url 插入到 GetHttpRequestData() 结果结构中，该结构将具有 / 或 /index.cfm ，具体取决于访问的 URL。

马丁

# c# - 在 if() 中调用方法 - C#

> ID：579352
> 
> 赞同：15
> 
> 时间：2009-02-23T21:06:31.360
> 
> 标签：c#, language-features, short-circuiting

我有几个方法根据它们的成功返回一个布尔值，在 IF() 内部调用这些方法有什么问题吗？

```
//&& makes sure that Method2() will only get called if Method1() returned true, use & to call both methods
if(Method1() && Method2())
{
    // do stuff if both methods returned TRUE
} 
```

如果 Method1() 返回 FALSE，则 Method2() 不需要触发。

让我知道上面的代码有任何问题。

谢谢你。

**编辑：**由于代码没有问题，我会接受最有用的答案...添加评论以解决“新手&&&”问题

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-23T21:16:07.670

我要说明的是，如果您将来出于某种原因希望避免短路，您可以使用`& operator`（而不是`&&`）来保证调用这两种方法，即使左侧是，也是如此。`false`

逆向适用于`| operator`，即使左侧条件评估为`true`，右侧条件也将被评估。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-23T21:09:03.710

不，if 条件下的方法调用没有任何问题。实际上，这可能是使您的代码更具可读性的好方法！

例如，写起来要干净得多：

```
private bool AllActive()
{
    return x.IsActive && y.IsActive && z.IsActive;
}

if(AllActive())
{
    //do stuff
} 
```

比：

```
if(x.IsActive && y.IsActive && z.IsActive)
{
    //do stuff
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T21:11:49.817

尽管它们很有用，但序列点可能会令人困惑。除非您真正理解这一点，否则 Method2() 可能根本不会被调用尚不清楚。另一方面，如果您需要调用这两个方法并且它们必须返回 true，您会写什么？你可以和

```
bool result1 = Method1();
bool result2 = Method2();
if (result1 && result2)
{
} 
```

或者你可以去

```
if (Method1())
    if (Method2())
    {
    } 
```

因此，我想恕我直言，您的问题的答案是，不，尽管行为将是您所描述的，但您的意思并不完全清楚。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T21:38:33.857

如果方法是纯（无副作用）功能，我只会推荐它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-23T21:45:07.930

正如每个人所说，以这种方式做事并没有什么“错误”，而且在许多情况下，您所做的正是该语言的设计目的。

但是请记住，为了可维护性，如果 Method2 有副作用（即，它改变了某些状态），那么这个函数没有被调用可能并不明显（一个好的程序员通常会知道，但有时即使是好的程序员有脑放屁）。

如果短路表达式有某种副作用，那么严格从维护的角度来看，将语句分开可能更具可读性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T21:12:20.067

对我来说看起来不错，如果早期条件失败，if() 块中的多个子句将短路。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T21:13:30.313

应该没有问题。

正常行为是 Method1() 将执行，如果返回 true Method2() 将执行，并且根据 Method2() 返回的内容，您可能/可能不输入 if() 语句。

现在，这*假设*编译器生成以这种方式执行的代码。如果你想**绝对确定**Method2() 不会执行，除非 Method1() 返回 true 你可以这样写

```
if( Method1() )
{
  if( Method2() )
  {
    // do stuff if both methods returned TRUE 
  }
} 
```

但是，我一直观察到您的代码将按预期运行，因此这可能没有必要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T21:08:49.233

没有错。

实际上...我不会将它们命名为 Method1 和 Method2。更具描述性的东西。也可能是被动的声音（比如 StuffHasHappened 或 DataHasLoaded）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T22:35:01.007

对我来说看起来不错，但有一些警告......这不是适用一揽子规则的事情。

我的*指导方针*是：

*   如果方法名很短，而且没有太多，那就没问题了。
*   如果您在语句中有太多的语句/方法调用`if`，那么您很可能正在比较多个“集合”的事物。打破这些“集合”并引入临时变量。
*   “太多”是主观的，但通常超过 3 个左右
*   当我说“方法名称很短”时，我说的不仅仅是名称，还有它们所采用的参数。基本上是某人阅读它所需的努力。例如`if( Open(host) )`比 短`if( WeCouldConnectToTheServer )`。所有这些项目的总大小就是归结为。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-02-23T22:24:24.760

就个人而言，我会考虑

```
if(Method1() && Method2())
{
    // do stuff if both methods returned TRUE
} 
```

成为一种不好的做法。是的，它适用于当前环境，但也适用

```
if(Method1())
{
  if (Method2())
  {
    // do stuff if both methods returned TRUE
  }
} 
```

但它会在所有环境中工作吗？未来，可能是非微软的 C# 编译器会以这种方式工作吗？如果您的下一份工作涉及另一种语言，而这两种方法都将被调用，该怎么办？我不会依赖那个特定的构造，不是因为它是错误的，而是因为它不能解决任何严重的问题，而且将来可能会出错

# user-interface - 从用户那里获取日期/时间输入的最佳方法是什么？

> ID：579354
> 
> 赞同：15
> 
> 时间：2009-02-23T21:06:39.097
> 
> 标签：user-interface, language-agnostic, user-input

这是一个多年来一次又一次地重新发明的轮子。

**问题：用户需要输入日期/时间**

基本注意事项

*   我们希望让用户尽可能轻松地输入所需的日期/时间
*   一些应用程序需要历史日期，一些应用程序只需要未来日期，一些需要同时处理两者
*   我们希望防止用户输入乱码数据
*   我们希望尽可能积极地自动填充此控件。
*   我们希望这个控件尽可能地可重用。

流行的解决方案包括：

*   文本框
*   组合框
*   弹出式日历
*   服务器端和/或客户端验证
*   提醒用户有关不良数据的各种方式

有很多即食解决方案，但我正在寻找一些更一般的信息。是否对各种日期时间控制方法进行了任何可用性研究？那里有“最佳”日期时间控制吗？是否有任何完善的“注意事项”？

* * *

相关问题：[描述时间范围的最佳 GUI 控件](https://stackoverflow.com/questions/206092/best-gui-controls-to-describe-a-time-range)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-23T21:17:18.480

我的偏好是文本输入，旁边有一个省略号按钮：

```
Enter a date [        ] [...] 
```

省略号会弹出一个日历来填充文本输入，但用户可以根据需要输入日期。应在按下表单的“确定”按钮时进行验证 - 根据我的经验，尝试逐个字符地进行日期验证注定要失败。

验证应该是复杂的，并允许像这样的表达式

```
"today"
"Tomorrow"
"23 Jan" 
```

等等

**编辑：**在回复一些评论时，可以在文本编辑失去焦点时进行验证（尽管我讨厌那种事情），在这种情况下，编辑内容可能会从“23 Jan”变为“23-01-2009”以表明表示理解。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-23T21:49:05.033

给我一个日历，让我用鼠标选择日期。让我用键盘输入日期。接受尽可能多的格式。如果我需要输入 2012 年 12 月 21 日，让我使用：

*   2012 年 12 月 21 日
*   2012 年 12 月 21 日
*   2012 年 12 月 21 日
*   2012 年 12 月 21 日（或 2012 年 12 月 21 日，选择一个，可能取决于我在哪个国家/地区使用该软件）
*   12212012（与上面相同的括号片段）
*   等等。

无论您决定采取什么措施来解决本地化问题，请确保您的期望是显而易见的。给我一个例子，或者一个`MMDDYYYY`我可以输入的模板。

请不要给我必须滚动的下拉框，尤其是多年来。如果我老了，并且我正在进入我的出生日期，我的生命中没有足够的时间向下滚动到下拉框的底部。当我不知道选项是什么时，下拉框是一种很好的模式，但如果它是我非常熟悉的东西，比如我的出生日期，那么下拉菜单就很麻烦了。

现在，WRT 时间输入（Big pet peeve），不要以为我的意思是凌晨 3 点。如果我输入 3 的时间，假设我的意思是下午 3 点。让我做额外的工作来安排凌晨 3 点的事情。如果你不愿意代表我做这么多，至少提醒我我已经在凌晨 3 点安排了一些事情，这样我就可以现在解决它，而不是稍后当我的活动邀请列表上的某个人通过电子邮件说“你这个白痴，你将我们的 D&D 聚会安排在凌晨 3 点！”

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T22:51:10.657

我认为谷歌日历上的日期范围条目相当不错。您可以通过键盘或鼠标输入。唯一的问题是输入不同年份的日期。

您可以通过键盘轻松完成，但日历上应该有第二组小箭头，可以使用鼠标一次来回跳转一年。

[![日期输入示例](https://i.stack.imgur.com/ltwhu.jpg)](https://i.stack.imgur.com/ltwhu.jpg)

[![时间输入示例](https://i.stack.imgur.com/yHEuV.png)](https://i.stack.imgur.com/yHEuV.png)

编辑：在回答这个问题时，“*如果你想安排一个从周二晚上 11 点到周三凌晨 1 点的活动（例如，每天构建）怎么办？你如何在午夜结束时间？* ”

如果“到”时间超过了午夜，则将“到”日期滚动到第二天。这只是组件业务逻辑的一部分。您会在上面的第二张图片中注意到，下拉菜单同时指示了事件的结束时间和持续时间，这应该是一个提示。

[![替代文字](https://i.stack.imgur.com/kkIpu.jpg)](https://i.stack.imgur.com/kkIpu.jpg)

如果您尝试将结束日期设置为早于开始日期，则可以突出显示字段的背景颜色和/或在保存时显示错误消息。

[![替代文字](https://i.stack.imgur.com/uyVjC.jpg)](https://i.stack.imgur.com/uyVjC.jpg)

在[Google 日历](https://www.google.com/calendar/)上玩一玩，看看它的表现如何。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T21:12:56.993

我的选择是带有指向侧面弹出日历的图像链接的文本框。两全其美。

如果你想要一些额外的东西，你可以让一个自然语言的日期/时间解析器，比如 Chronic [http://chronic.rubyforge.org/](http://chronic.rubyforge.org/)来增加它的趣味性。

也不要忘记国际用户。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-23T21:24:55.573

我建议您还允许喜欢键入而不是单击日历控件的用户，因此文本框 + 弹出日历的组合效果很好。

我们用这样的组合创建了一个自定义控件。用户可以在文本框中输入多种格式的日期，或单击按钮弹出日历。

我们允许各种输入，例如“today”、“wed”或“+2”（后天），并在大多数验证客户端使用正则表达式。当然，我们还进行服务器端验证。

该控件还有一个可选的时间文本框，可以通过属性启用或隐藏。我们觉得将日期与时间分开更容易。对于时间，我们允许“9pm”、“2100”、“09:00”等。

该控件适用于最小和最大日期，因此出生日期的范围可以从 -100 年到当年，而信用卡到期日的范围可能从当年到 +5 年，因此我们使用范围验证器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T21:58:06.133

如果您要使用组合框/列表框选项，请确保将月份设置为“Jan”、“Feb”...“Dec”而不是“1”、“2”...“12” .
不得不根据值的范围来确定哪个槽是月份，哪个是日期，这是相当烦人的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T21:28:12.743

我会根据情况选择三种替代方案：

1.  2个组合框。一个上市年+月，另一个日
2.  3个组合框。一上市年一月一日
3.  来自 YUI的可见日历/s 和组合，[例如这个](http://developer.yahoo.com/yui/examples/calendar/formsel.html)

而且我相信还有更多的选择可以选择。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T21:28:13.977

您需要检查您的 UI 要求。如果您只想要启用脚本的支持，那么您可以使用您的任何脚本，并以它们在隐藏字段中提供的任何日期/时间格式运行。

但是，如果您需要在文本框中输入用户条目，那么您将面临一些决定：

*   日期/时间格式是否严格？例如，仅 mm/dd/yyy hh:mm:ss 格式？
*   或者松散定义，以允许“今天”、“明天”、“1 月 23 日”样式条目？
*   格式是否特定于语言环境？例如 mm/dd/yyyy 与 dd/mm/yyyy

验证方法取决于您对需求的决定。

我喜欢[jQuery 日期选择器](http://www.kelvinluck.com/projects/jquery-date-picker/)插件。它将允许以特定格式输出。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T21:40:30.997

连续显示多个月的日历：[http ://www.cs.helsinki.fi/u/salaakso/patterns/Calendar-Strip.html](http://www.cs.helsinki.fi/u/salaakso/patterns/Calendar-Strip.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T21:42:24.237

在这方面，我一直觉得 Google 日历很容易使用。你当然可以比试图模仿它做得更糟。关键是在用户输入信息的方式上给予用户很大的灵活性。例如，我可以从下拉列表中选择时间或手动输入，当我输入时，我不需要在“pm”中包含冒号或“m”。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-23T22:23:53.187

我真的很喜欢 QT4 的日期/时间小部件的工作方式。

*   您可以手动输入日期（以常用格式输入日期）。
*   您可以使用滚轮快速更改日期/时间字段。
*   您有一个可扩展的日历，其中包含月份的下拉和前进/后退箭头。您可以单击特定日期并手动输入年份，也可以使用组合框（滚轮也可以在此处使用）。

这是一个简短的视频 (~7.5MB)，展示了小部件的工作原理以及它的一些功能：[视频在这里](http://s000.tinyupload.com/index.php?file_id=06582721091289366320)

我希望任何复杂的应用程序都具有部分或全部这些功能。

能够输入相对日期（今天、上周、3 天前）很方便，但我不确定它是否实用，考虑到诸如“你的出生日期是什么时候？”或“你什么时候可以”这样的标准问题就像 X 通过电子邮件发送给你的一样？”。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-03-26T14:54:26.623

你可以使用插件[cxcalendar](http://code.ciaoca.com/jquery/cxcalendar/)。它看起来像其他日期选择器。但是您可以在单击年月标题后选择年和月。

![在此处输入图像描述](https://i.stack.imgur.com/W9qFX.png)

# asp.net - 退出后返回箭头

> ID：579359
> 
> 赞同：5
> 
> 时间：2009-02-23T21:07:33.823
> 
> 标签：asp.net, authentication, session

我有一个使用表单身份验证的 ASP.NET 应用程序。当用户单击页面上的“退出”按钮时，它会运行以下代码。

```
 FormsAuthentication.SignOut();
        Response.Expires = 0;
        Response.Cache.SetNoStore();
        Response.AppendHeader("Pragma", "no-cache"); 
```

然而，用户仍然可以只按返回箭头并查看上一页，而无需再次登录。我确信这与缓存的前一页有关。如何确保提示他们再次登录并返回？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T21:28:45.847

```
Response.Cache.SetCacheability(HttpCacheability.NoCache); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T21:19:50.860

现在您知道为什么会收到消息“您已注销。出于安全原因，请关闭此浏览器窗口。”

没有缓存是一种解决方法。

倒数第二个解决方法是使用 ajax 将任何敏感信息拉下 - 这将在后面的情况下再次运行，并且不应缓存信息。这是更多的连接和更多的延迟，但是由于现代浏览器缓存，除了诸如此类的变通方法之外，没有什么可以做的。

-亚当

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T21:32:49.847

虽然不能保证缓存，但这在大多数情况下对我有用

```
 //Used for disabling page caching
    HttpContext.Current.Response.Cache.SetExpires(
      DateTime.UtcNow.AddDays(-1));
    HttpContext.Current.Response.Cache.SetValidUntilExpires(false);
    HttpContext.Current.Response.Cache.SetRevalidation(
      HttpCacheRevalidation.AllCaches);
    HttpContext.Current.Response.Cache.SetCacheability(
      HttpCacheability.NoCache);
    HttpContext.Current.Response.Cache.SetNoStore(); 
```

在您不希望用户能够缓存的任何页面上，在任何页面的 OnInit() 方法（可能通过使用基类）中运行它。

但请注意，某些页面可能要求您允许缓存，例如在 SSL 页面上进行文件下载等。

我在某处找到了这段代码，如果我找到链接，我会更新帖子。

# php - 点斜杠对 PHP 包含调用有什么作用？

> ID：579374
> 
> 赞同：39
> 
> 时间：2009-02-23T21:11:20.083
> 
> 标签：php, url, include, relative-path

A. 这是做什么的？

```
require ("./file.php"); 
```

B. 与此相比？

```
require ("file.php"); 
```

* * *

（它**不是**一个目录..这将是）

```
require ("../file.php"); 
```

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-23T21:15:20.293

`./`是*当前*目录。它与 just 基本相同`file.php`，但在许多情况下（包括这一点）它不检查 PHP 可能查找文件的任何标准位置，而是*仅*检查当前目录。

从[PHP 文档](http://us.php.net/manual/en/function.include.php)（注意最后一句话）：

> 首先在相对于当前工作目录的每个 include_path 条目中查找包含文件，然后在当前脚本的目录中查找。例如，如果您的 include_path 是库，当前工作目录是 /www/，您包含 include/a.php 并且该文件中有包含“b.php”，b.php 首先在 /www/libraries/ 中查找，然后在/www/包括/。如果文件名以 ./ 或 ../ 开头，则仅在当前工作目录中查找。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-23T21:15:03.150

第一个版本强制内部机制包含相对于...直接执行的文件的文件。所以例如你有

**索引.php**

```
// directly executed script (php -f index.php or from a browser)
include 'second.php'; 
```

**第二个.php**

```
// This is included relatively to index.php
// Actually, it is first searched relatively to include_path, then relatively
// to index.php
include './third.php'; 
```

**第三个.php**

```
// This is included relatively to second.php ONLY. It does not search
// include_path
return "foo"; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-23T21:21:17.627

**简短的回答**

你是对的，它不是一个目录。一种 。指您所在的目录，而 .. 指父目录。

意思是，./file.php 和 file.php 在 PHP 中的功能是等效的。这是文档的相关页面：http: [//us.php.net/manual/en/wrappers.file.php](http://us.php.net/manual/en/wrappers.file.php)

**更长的答案**

然而，仅仅因为它们在这种情况下工作相同并不意味着它们总是相同的。

当您在 *nix shell 环境中操作并键入可执行文件的名称时，shell 将在 PATH 目录中查找，但不会在 CWD 或您当前所在的目录中查找。

因此，如果您所在的目录中有一个名为 myprogram.php 的文件（这将是一个 PHP CLI 文件），您只需键入：

`myprogram.php`

您的程序是否可执行并不重要。shell 会在 /bin/、/usr/bin/ 等中查找您的文件，但不会在 ./ 或您所在的目录中查找。

要在不将目录添加到 PATH 的情况下执行该程序，您需要键入

`./myprogram`

所以真的， ./ 更明确。这意味着，“您要查找的文件必须在此处”，而没有 ./ 表示，“该文件应该在程序查找文件的某个位置”。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-24T19:46:15.540

点斜杠强制仅在当前目录中找到文件，而不是额外搜索 include_path 设置中提到的路径。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-23T21:16:48.917

只需告诉 php**仅**将文件包含在当前目录中，否则如果文件不存在则失败。

如果您使用“indexcommon3.php”格式并且文件不存在，php 会将其搜索到 include_path 系统变量中。

作为参考，您可以使用[http://www.php.net/manual/en/function.include.php](http://www.php.net/manual/en/function.include.php)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-06-05T17:35:41.087

**编辑**：为了清楚起见，我完全重写了答案

* * *

包含文件时，您可以使用`./myfile.php`或`myfile.php`。

它们不一样，除非您知道自己在做什么，否则您最好始终使用第一种语法。

最好用一个例子来说明差异：假设您有以下文件和文件夹结构：

```
index.php
inc/inner.php 
```

从 index.php 中，您可以包含不带“./”的内部模板，它将按预期工作：

```
# index.php
<?php
include "inc/inner.php"; 
```

现在假设我们添加了一个新文件，所以文件夹结构现在是这样的：

```
index.php
inc/inner.php
inc/inner-inner.php 
```

要包含`inner-inner.php`在 中`inner.php`，我们会这样做……对吗？

```
# src/inner.php
<?php
include "inner-inner.php"; 
```

**错了**。`index.php`只会`inner-inner.php`在根文件夹中查找 *。

```
index.php
inc/inner.php
inc/inner-inner.php
* inner-inner.php <- Doesn't exist, PHP ERROR. 
```

相反，我们应该使用`./`包含inner-inner 的语法。这将指示我们包含的文件必须**相对于当前文件包含在内，而不是相对于 PHP 脚本的当前“入口点”**。

```
# src/inner.php
<?php
include "./inner-inner.php"; 
```

此外，正如其他评论中提到的，如果您为 PHP 应用程序配置了不同的“加载路径”，则将首先查找该加载路径，而不使用`./`语法。相反，`./`语法更有效，因为它不检查 php.ini 的“包含路径”。

如果您想让您的包含更加明确，请使用`__DIR__`常量。这告诉 php：“打印此文件所在的当前目录”。

```
# src/inner.php
<?php
include __DIR__ . "/inner-inner.php"; 
```

TLDR；始终使用`./`or`__DIR__`因为它是相对于工作目录的，并且不依赖于 php 的“包含路径”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T21:16:09.060

它明确命名*当前*目录。

# c# - MVC ActionLink 生成不同类型的链接......为什么？

> ID：579389
> 
> 赞同：4
> 
> 时间：2009-02-23T21:13:31.267
> 
> 标签：c#, asp.net-mvc, actionlink

我是 MVC 领域的新手，并且有一个我正在开发的应用程序。我在全球有 2 条不同的链接，其中 2 条路线非常相似

路线 1

```
routes.MapRoute("Category", "Movies/{category}/{subcategory}", 
    new { controller = "Catalog", action = "Index", category = "", subcategory = "" }); 
```

路线 2

```
routes.MapRoute("Movie", "Movie/{movie}", 
    new { controller = "Movie", action = "Index", movie = "" }); 
```

当我为第一条路线调用 actionlink 时，它会按照我的想法创建它：

> `.../Movies/Category/SubCategory`

但是，当我创建第二个链接时，它会像这样填充它：

> `.../Movie?movieId=ff569575-08ec-4049-93e2-901e7b0cb96a`

我之前使用的是字符串而不是 guid，它仍然在做同样的事情，即

> `.../Movie?movieName=Snatch`

我的操作链接设置如下

```
<%= Html.ActionLink(parent.Name, "Index", "Catalog",
    new { category = parent.Name, subCategory = "" }, null)%>

<%= Html.ActionLink(movie.Name, "Index", "Movie", 
    new { movieId = movie.MovieId }, null)%> 
```

我的应用程序仍然有效，但我认为这种行为很奇怪。任何帮助都会很棒。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T21:24:29.617

```
routes.MapRoute("Movie", "Movie/{movieId}", 
    new { controller = "Movie", action = "Index", movie = "" }); 
```

路由文本是否应该与您提交到 mvc 链接的属性名称不匹配？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T21:23:21.460

问题是当你调用 ActionLink 时，路由系统无法确定要使用两个路由中的哪一个，所以它选择了第一个。解决方案是使用 RouteLink 而不是 ActionLink。RouteLink 允许您指定生成 URI 时要使用的路由的名称。那么对于使用哪条路线就没有歧义了。我认为 ActionLink 已经过时了。我想不出任何理由用它来代替 RouteLink。

但是，当用户提交链接时，您可能仍然会遇到问题。在这种情况下，使用路由约束来强制选择正确的路由。

Andrew 是正确的（赞成），您在 ActionLink/RouteLink 中使用的令牌和路由本身必须匹配。

# asp.net-mvc - 如何？控制器不返回任何内容/当前视图

> ID：579390
> 
> 赞同：35
> 
> 时间：2009-02-23T21:13:35.820
> 
> 标签：asp.net-mvc

SHORT：
如何让控制器返回当前视图或什么都不做？

LONG：
我有一个局部视图，我在其中创建了一个图像滑块。它包含一个链接，该链接向控制器发送请求以获取下一个图像（使用 ajax）。控制器获取下一张图像，将其存储在 ViewData 中并发送回部分视图（上面的那个）。

现在，我今天要做的是，当控制器到达最后一个图像时，它会重新返回相同的图像（通过重新获取它），但仍会创建一个新视图，即客户端/浏览器重新解析“相同”数据。
这似乎有些不理想。

我想做的是，当控制器到达最后一个图像时，它应该什么都不做。
如果我返回 null 则视图将更新为空内容。
我希望视图/客户端/浏览器保留它所拥有的一切，而控制器则什么也不做。

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult GetNextImage(...)
    {
        if(Request.IsAjaxRequest())
        {
            if(CURRENT_IMAGE != LAST_IMAGE)
            {
                Image image = GetNextImage(...);
                var partialViewResult = new PartialViewResult();
                partialViewResult.ViewName = "ImageSlide";
                partialViewResult.ViewData.Model = image;
                return partialViewResult;
            }
            else
            {
                // DO NOTHING, HOW?
            }
        }

        return RedirectToAction("Error", "Home");
    } 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-23T21:18:00.707

如果您不希望它执行任何操作，则可以返回 EmptyResult ...

```
return new EmptyResult(); 
```

如果您使用的是 AjaxHelper，您可以通过提供不成功的状态代码（例如 404 或任何最合适的代码）来避免更新，这将阻止它替换您的 div，因为 MicrosoftMvcAjax.js 中的 javascript 在之前明确检查成功响应更新任何元素：-

```
this.ControllerContext.HttpContext.Response.StatusCode = 404;
return new EmptyResult(); 
```

最终避免它的最好方法是设计局部视图，以便它首先避免问题（就像你提到自己一样）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2018-08-16T20:58:37.530

我今天遇到了这个问题。我想找到一个解决方案，以解决如何处理客户端双击尝试在服务器端重新输入控制器操作时仍在处理的问题。如果用户输入了该操作，我希望它只是忽略请求并且在浏览器端什么都不做。

解决方案如下所示：

```
public async Task<ActionResult> MyAction()
{
    if(!CanEnterAction(nameof(MyAction))) return new HttpStatusCodeResult(204);
    try
    {
         // Do long running stuff
         return ValidActionResult();
    }
    finally
    {
        ExitedAction(nameof(MyAction));
    }
} 
```

返回状态码 204 基本上对浏览器中显示的页面没有任何作用。当操作完成时，实际结果最终会返回到浏览器。

这个问题很老，但我无法在 StackOverflow 上的任何地方找到答案。我认为它必须是可能的，因为 FileResult 也不会真正影响当前页面，除了保存文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-05-27T19:34:26.143

我会用

```
return new HttpStatusCodeResult(204); 
```

这样，您将留在同一页面上，并且没有回发。这是定义

**HTTP 204** No Content 成功状态响应码表示**请求已成功**，但客户端**不需要离开当前页面**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T21:34:25.770

假设您使用的是 MicrosoftMvcAjax，您可以发回一个 JavascriptResult，提醒用户他们已到达滑块的末尾。如果响应是 javascript 而不是内容，MicrosoftMvcAjax 处理程序会执行它而不是替换 DOM 内容。

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult GetNextImage(...)
{
    if(Request.IsAjaxRequest())
    {
        if(CURRENT_IMAGE != LAST_IMAGE)
        {
            Image image = GetNextImage(...);
            var partialViewResult = new PartialViewResult();
            partialViewResult.ViewName = "ImageSlide";
            partialViewResult.ViewData.Model = image;
            return partialViewResult;
        }
        else
        {
            return JavaScript( "alert('No more images');" );
        }
    }

    return RedirectToAction("Error", "Home");
} 
```

当然，您可能想要更有创意并使用 jQuery 对话框插件或其他东西而不是警报。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T21:52:02.017

好的，我明白了。
不是我的问题的解决方案，但仍然可以解决问题。

当视图显示最后一张图像时，我将根本不显示“下一个”链接。

不敢相信我之前没有想到...

谢谢你们的努力

# java - Java中的TrueType解析？

> ID：579404
> 
> 赞同：1
> 
> 时间：2009-02-23T21:16:31.680
> 
> 标签：java, fonts, freetype

是否有一个简单的库可以解析 True Type 字体文件并给我一个向量/点列表供我自己渲染？我说的是类似于 freetype 的东西，但适用于 Java。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-25T10:07:11.693

Java 可以开箱即用地做到这一点。前段时间，我探索了这个领域。

我使用[处理](http://processing.org/ "覆盖")来进行简单/快速的图形渲染，但访问字体信息的代码是纯 Java 的。所以也许我的小程序可能会让你感兴趣。我刚刚把它粘贴到了[Pastebin](http://pastebin.com/f54e1c72f "PhiLho的粘贴箱")

```
/**
Get a font and display glyphs with additional information
(bounding boxes, anchor & control points...)

by Philippe Lhoste <PhiLho(a)GMX.net> http://Phi.Lho.free.fr & http://PhiLho.deviantART.com
*/
/* File/Project history:
 1.01.000 -- 2008/08/28 (PL) -- Some improvements.
 1.00.000 -- 2008/08/28 (PL) -- Creation.
*/
/* Copyright notice: For details, see the following file:
http://Phi.Lho.free.fr/softwares/PhiLhoSoft/PhiLhoSoftLicence.txt
This program is distributed under the zlib/libpng license.
Copyright (c) 2008 Philippe Lhoste / PhiLhoSoft
*/

import java.awt.font.*;
import java.awt.geom.*;

final static int DEMO_ID = 2;
final static String FONT_NAME = "Times New Roman";
final static String STRING = "p@";

int FONT_SIZE, SCALE;
Graphics2D g2;
AffineTransform transform;
HashMap colorList = new HashMap();

void setup()
{
  size(1000, 700);

  smooth();
  noLoop();
  background(150);
  noFill();

  g2 = ((PGraphicsJava2D) g).g2;

  // Move drawing to a convenient place
  transform = new AffineTransform();
  if (DEMO_ID == 1)
  {
    FONT_SIZE = 1;
    SCALE = 300;
    transform.translate(40, 320);
    transform.scale(SCALE, SCALE);
  }
  else if (DEMO_ID == 2)
  {
    FONT_SIZE = 2;
    SCALE = 300;
    transform.translate(50, 500);
    transform.scale(SCALE, SCALE);
  }
  else if (DEMO_ID == 3)
  {
    FONT_SIZE = 2;
    SCALE = 300;
    transform.translate(50, 500);
    transform.scale(SCALE, SCALE);
  }
//  g2.setTransform(transform);

  // And show the origin (and scale) of drawing
  SetColor(#FF0000); // Update g2
  strokeWeight(5);
  Line2D.Double line = new Line2D.Double(-0.1, -0.1, 0.1, 0.1);
  g2.draw(transform.createTransformedShape(line));
  line = new Line2D.Double(-0.1, 0.1, 0.1, -0.1);
  g2.draw(transform.createTransformedShape(line));
  strokeWeight(2);

  // Now, we get the font
  Font font = new Font(FONT_NAME, Font.PLAIN, FONT_SIZE);
  g2.setFont(font);
  FontRenderContext frc = g2.getFontRenderContext();

  if (DEMO_ID == 1)
  {
//~     String str = "%&@";
    GlyphVector glyphVector = font.createGlyphVector(frc, STRING);
    for (int i = 0; i < STRING.length(); i++)
    {
      strokeWeight(2);

      SetColor(#00FF00);
      Shape vbs = glyphVector.getGlyphVisualBounds(i);
      g2.draw(transform.createTransformedShape(vbs));

      SetColor(#005000);
      Rectangle r = glyphVector.getGlyphPixelBounds(i, null, 0.0f, 0.0f);
      g2.draw(transform.createTransformedShape(r));

      SetColor(#A0A000);
      Shape lbs = glyphVector.getGlyphLogicalBounds(i);
      g2.draw(transform.createTransformedShape(lbs));

      SetColor(#0050F0);
      strokeWeight(5);

      Shape shape = glyphVector.getGlyphOutline(i);
      g2.draw(transform.createTransformedShape(shape));
    }

    // Draw the whole string at once
    SetColor(#F0A000);
    strokeWeight(1);

    Shape shape = glyphVector.getOutline();
    g2.draw(transform.createTransformedShape(shape));
  }
  else if (DEMO_ID == 2)
  {
    GlyphVector glyphVector = font.createGlyphVector(frc, STRING);
    for (int i = 0; i < STRING.length(); i++)
    {
      SetColor(#0050F0);
      strokeWeight(5);

      Shape shape = glyphVector.getGlyphOutline(i);
      g2.draw(transform.createTransformedShape(shape));

      HighlightPoints(shape);
    }
  }
  else if (DEMO_ID == 3) // To test the SEG_CUBICTO case!
  {
    SetColor(#0050F0);
    strokeWeight(5);

    GeneralPath shape = new GeneralPath();
    shape.moveTo(1.5, 0.0);
    shape.lineTo(1.8, 0.0);
    shape.quadTo(2.0, 0.3, 1.5, 0.3);
    shape.lineTo(1.1, 0.3);
    shape.curveTo(0.7, 0.3, 0.5, -0.5, 1.2, -0.2);
    shape.lineTo(1.5, -0.3);
    shape.closePath();

    g2.draw(transform.createTransformedShape(shape));

    HighlightPoints(shape);
  }
}

void HighlightPoints(Shape shape)
{
  strokeWeight(1);

  PathIterator iterator = shape.getPathIterator(null);
  float[] coords = new float[6];
  float px = 0, py = 0;
  while (!iterator.isDone())
  {
    int type = iterator.currentSegment(coords);
    switch (type)
    {
    case PathIterator.SEG_MOVETO: // One point
      print("Move ");
      px = coords[0];
      py = coords[1];
      DrawMovePoint(px, py);
      break;
    case PathIterator.SEG_LINETO:
      print("Line ");
      px = coords[0];
      py = coords[1];
      DrawLinePoint(px, py);
      break;
    case PathIterator.SEG_QUADTO: // Two points
      print("Quad ");
      DrawControlLine(coords[0], coords[1], px, py);
      px = coords[2];
      py = coords[3];
      DrawControlLine(coords[0], coords[1], px, py);
      DrawControlPoint(coords[0], coords[1]);
      DrawQuadPoint(px, py);
      break;
    case PathIterator.SEG_CUBICTO: // Three points
      print("Cubic "); // Not seen yet...
      DrawControlLine(coords[0], coords[1], px, py);  // Connect to last point
      px = coords[4];
      py = coords[5];
      DrawControlLine(coords[2], coords[3], px, py);
      DrawControlPoint(coords[0], coords[1]);
      DrawControlPoint(coords[2], coords[3]);
      DrawCubicPoint(px, py);
      break;
    case PathIterator.SEG_CLOSE:  // No points
    }
    iterator.next();
  }
}

void DrawMovePoint(float x, float y)
{
  float radius = 2.5 / SCALE;
  Ellipse2D.Float e = new Ellipse2D.Float(x - radius, y - radius, 2 * radius, 2 * radius);
  SetColor(#FF00A0);
  g2.fill(transform.createTransformedShape(e));
  SetColor(#FF00FF);
  g2.draw(transform.createTransformedShape(e));
}

void DrawLinePoint(float x, float y)
{
  float radius = 4.5 / SCALE;
  Ellipse2D.Float e = new Ellipse2D.Float(x - radius, y - radius, 2 * radius, 2 * radius);
  SetColor(#FF00FF);
  g2.draw(transform.createTransformedShape(e));
}

void DrawQuadPoint(float x, float y)
{
  SetColor(#80FF00);
  float radius = 3.0 / SCALE;
  Rectangle2D.Float r = new Rectangle2D.Float(x - radius, y - radius, 2 * radius, 2 * radius);
  g2.draw(transform.createTransformedShape(r));
}

void DrawCubicPoint(float x, float y)
{
  SetColor(#FF8000);
  float radius = 5.0 / SCALE;
  Rectangle2D.Float r = new Rectangle2D.Float(x - radius, y - radius, 2 * radius, 2 * radius);
  g2.draw(transform.createTransformedShape(r));
}

void DrawControlPoint(float x, float y)
{
  SetColor(#D0E000);
  float radius = 3.0 / SCALE;
  Ellipse2D.Float e = new Ellipse2D.Float(x - radius, y - radius, 2 * radius, 2 * radius);
  g2.draw(transform.createTransformedShape(e));
}

void DrawControlLine(float x1, float y1, float x2, float y2)
{
  SetColor(#FFA000);
  Line2D.Float l = new Line2D.Float(x1, y1, x2, y2);
  g2.draw(transform.createTransformedShape(l));
}

Color GetColor(color c)
{
  Integer ic = Integer.valueOf(c);  // New to 1.5! Cache values
  Color k = (Color) colorList.get(ic);
  if (k == null)
  {
    k = new Color(ic);
    colorList.put(ic, k);
  }
  return k;
}
void SetColor(color c)
{
  Color k = GetColor(c);
  g2.setPaint(k);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T21:28:21.683

您可以使用[Batik](http://xmlgraphics.apache.org/batik/)解析 TrueType 字体并生成 SVG 文件 ( [SVGFont](http://xmlgraphics.apache.org/batik/tools/font-converter.html) )。所以我打赌你可以使用这些库来获取你的向量。

# c# - SQL BULK INSERT 的替代方案

> ID：579406
> 
> 赞同：3
> 
> 时间：2009-02-23T21:17:00.070
> 
> 标签：c#, sql-server-2005, .net-2.0

我需要将数据表单 .csv 文件导入数据库表（MS SQL Server 2005）。SQL BULK INSERT 似乎是一个不错的选择，但问题是我的数据库服务器与我的 WEB 服务器不在同一个盒子上。[这个问题](https://stackoverflow.com/questions/440289/ms-sql-server-bulk-insert-across-a-network)描述了同样的问题，但是我对我的数据库服务器没有任何控制权，也不能在上面共享任何文件夹。

我需要一种以编程方式（C#）导入我的 .csv 的方法，有什么想法吗？

**编辑：**这是网站的一部分，用户可以在其中使用 .csv 内容填充表格，这将每周发生一次，如果不是更频繁的话

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T21:19:57.910

你有几个选择：

1.  [SSIS](http://www.accelebrate.com/sql_training/ssis_tutorial.htm)
2.  [DTS](http://www.verio.com/support/documents/view_article.cfm?doc_id=3846)
3.  自定义应用程序

这些方法中的任何一种都应该完成工作。如果它只是临时工作，最好用你最喜欢的语言编写一个一次性应用程序来获取数据。如果它需要一个更长寿的解决方案，你可能需要研究 SSIS 或 DTS，因为它们是为它们而设计的这种情况。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T21:29:33.643

试试 Rhino-ETL，它是一个用 C# 编写的开源 ETL 引擎，甚至可以将 BOO 用于简单的 ETL 脚本，因此您无需一直编译它。

代码可以在这里找到： [https ://github.com/hibernating-rhinos/rhino-etl](https://github.com/hibernating-rhinos/rhino-etl)

写它的人： [http ://www.ayende.com/blog](http://www.ayende.com/blog)

组列表对此进行了一些讨论，实际上我前段时间为 boo 脚本添加了批量插入。 [http://groups.google.com/group/rhino-tools-dev](http://groups.google.com/group/rhino-tools-dev) [http://groups.google.com/group/rhino-tools-dev/browse_thread/thread/2ecc765c1872df19/d640cd259ed493f1](http://groups.google.com/group/rhino-tools-dev/browse_thread/thread/2ecc765c1872df19/d640cd259ed493f1)

如果您下载代码有几个示例，如果您需要更多帮助，还请查看 google 组列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T00:08:46.990

我最终使用了[CSV Reader](http://www.codeproject.com/KB/database/CsvReader.aspx)。我在@Jon Skeet 的一个答案中看到了对它的引用，无法再次找到它来放置它的链接

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T21:44:40.050

你的数据集有多大？除非它们**非常**大，否则您可以使用参数化的插入语句。出于安心或性能原因，您可能希望首先加载到临时表。

# nhibernate - 一对一流畅的nhibernate？

> ID：579414
> 
> 赞同：5
> 
> 时间：2009-02-23T21:19:00.270
> 
> 标签：nhibernate, fluent-nhibernate, mapping

是否有可能使用流利的 nhibernate 进行一对一的映射？我有以下作为我试图转换为流利的 hbm 的一部分：

```
 <one-to-one name="Person" property-ref="FileData" constrained="true"/> 
```

我在代码中看到 a`OneToOnePart<OTHER>`但我不确定如何或是否使用它来完成此操作。

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-24T01:33:10.500

有一个 HasOne 映射

```
map => map.HasOne(x => x.Person)
     .PropertyRef(x => x.FileData)
     .Constrained(); 
```

我想这就是你要找的。

# terminology - 经常使用很少定义的术语：左值

> ID：579421
> 
> 赞同：21
> 
> 时间：2009-02-23T21:20:42.777
> 
> 标签：terminology, language-theory

什么是左值？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-23T21:23:31.100

*左值*是可以分配给的值：

```
lvalue = rvalue; 
```

它是“left value”或“lefthand value”的缩写，它基本上只是符号*左侧*的`=`值，即您分配的值。

作为*不是*左值（即仅右值）的示例：

```
printf("Hello, world!\n") = 100; // WTF? 
```

该代码不起作用，因为`printf()`（返回 的函数`int`）不能是左值，只能是右值。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-23T21:22:31.807

出现在分配左侧的东西，即可以分配到的东西。

请注意，在 C++ 中，如果满足以下条件，函数调用可能是左值：

```
int & func() {
   static int a = 0;
   return a;
} 
```

然后：

```
func() = 42;     // is legal (and not uncommon) 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-23T21:46:23.200

它传统上是“=”运算符的左侧。然而，随着时间的推移，“左值”/“右值”的含义发生了变化。C++ 添加了“不可修改左值”的术语，它是任何不能分配给的左值：用“const”限定的数组和变量就是两个例子。在 C 中，您不能分配给任何右值（见下文）。同样，在 C++ 中，您不能分配给不属于某些用户定义的类类型的右值。

您可以说“左值”是一个表达式，它命名一个随时间持续存在并占用某个存储位置的对象。您是否可以分配给该表达式对于该分类并不重要。特别是引用也是一个左值，因为它的名称会随着时间的推移而持续存在。以下都是左值，因为它们都引用了命名对象。另请注意， a`const`对左值没有任何影响。

```
int a; lvalue: a;
       lvalue: ++a;
int a[2]; lvalue: a;
int &ra = a; lvalue: ra;
int *pa = &a; lvalue: *pa; 
```

术语“右值”用于诸如文字和枚举值之类的东西，以及不享受长寿乐趣并在完整表达式结束时立即销毁的临时对象。对于右值，重要的不是持久性方面，而是值方面。C++ 中的函数是左值，因为它们是持久的并且有地址，即使它们不是对象。我在上面的左值概述中将它们排除在外，因为当首先只考虑对象时更容易掌握左值。以下都是右值：

```
enum { FOO, BAR }; rvalue: BAR;
int a[2]; rvalue: (a+1);
rvalue: 42;
int a; rvalue: a++; // refering to a temporary
struct mystruct { }; mystruct f() { return mystruct(); } rvalue: f(); 
```

顺便说一句，通常你有一个左值，但运算符需要一个右值。例如，二进制内置“+”运算符添加两个值。左值表达式 first and for all 指定首先必须读出值的位置。因此，当您添加两个变量时，会发生“左值到右值”的转换。标准说，左值表达式中包含的值是它的右值结果：

```
int a = 0, b = 1;
int c = a + b; // read values out of the lvalues of a and b. 
```

其他运算符不采用右值，而是采用左值。他们不读取值。一个例子是地址运算符，`&`。您不能获取右值表达式的地址。有些右值甚至不是对象：它们不占用任何存储空间。示例再次是文字 (10, 3.3, ...) 和枚举值。

### 那可怕的东西有什么用？

那么区分左值和右值有几个优点

*   允许编译器省略存储右值并使用寄存器/只读内存存储标量值
*   将表达式标记为难以捉摸：右值不会长久
    *   允许编译器内部和 c++1x 中的高效复制语义也暴露给程序员（参见移动语义和右值引用）：我们可以从右值中窃取资源，这些资源无论如何都会被销毁。
*   允许在该属性上建立规则
    *   不允许从左值引用的尚未初始化的对象生成右值。但是左值可以引用未初始化的对象就好了
    *   右值永远不能是多态的。它们的静态类型也必须是它们的动态类型：简化 typeid 运算符的规则。

......还有更多，我觉得......

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-23T21:33:52.403

我所知道的最好的解释之一可以在[这篇关于 RValue 参考](http://blogs.msdn.com/vcblog/archive/2009/02/03/rvalue-references-c-0x-features-in-vc10-part-2.aspx)的文章中找到。

> 确定表达式是否为左值的另一种方法是询问“我可以获取它的地址吗？”。如果可以，它是一个左值。如果你不能，它是一个右值。例如， &obj 、 &*ptr 、 &ptr[index] 和 &++x 都是有效的（即使其中一些表达式很愚蠢），而 &1729 、 &(x + y) 、 &std::string("meow ") 和 &x++ 都是无效的。为什么这行得通？地址运算符要求其“操作数应为左值”（C++03 5.3.1/2）。为什么需要这样？获取持久对象的地址很好，但是获取临时对象的地址会非常危险，因为临时对象会很快消失。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-23T22:05:44.650

左值中的“L”通常被描述为代表“位置”。左值指定某物的位置；正如另一位回答者指出的那样，左值通常可以获取其地址。这就是为什么数字文字和非引用函数返回值不是左值的原因。

在 const 被引入 C++ 之前，L 曾经代表“左”。const 左值不能出现在赋值的左侧。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-10-16T16:41:30.797

对于 C 编程语言[C11 草案 n1570 6.3.2.1p1](http://port70.net/~nsz/c/c11/n1570.html#6.3.2.1)简洁地说：

> 左值是一个表达式（对象类型不是 void），它可能指定一个对象 [...]

它是如此简单。

撰写此答案当天的维基百科[定义几乎一样好](https://en.wikipedia.org/wiki/L-value)

> [...]一个指向存储位置的值，可能允许分配新值或提供可以写入数据的变量的可访问内存地址的值，它被称为位置值。

* * *

左值表达式的例子？给定

```
int a, b[1], *c; 
```

我们可以有以下左值表达式：`a`，`b`并且`c`每个都*明确*指定一个对象。`b[0]`也指定一个对象，因此它是一个左值表达式。那么*潜力*呢？`*c`始终是左值表达式，但如果`c`不包含指向有效对象的指针，则不指定对象。`b[1]` *可以在*语义上指定一个对象，但它不能，因为它访问数组越界。它们都是左值表达式。

当计算一个实际上不指定对象的左值表达式时，行为是**undefined**。

左值表达式可能比这更复杂，例如：

```
((flag ? foo() : bar())->pointed_to_by_struct_member[42])[0] 
```

如果它编译，它是一个左值表达式。

基本上，您可以`&`在 C 中应用 (address-of operator) 的所有内容都是*左值*，除了*函数*，因为*函数*不是 C 中的对象。

那么**L**代表什么呢？

[C11 n1570 脚注 64](http://port70.net/~nsz/c/c11/n1570.html#note64)：

> 64) 名称**lvalue**最初来自赋值表达式`E1 = E2`，其中要求左操作数`E1`是（可修改的）左值。将其视为表示对象**定位器值**可能更好。[...]

* * *

请注意，在 ISO C 中不需要编译为左`E1 = E2`值*。* 6.3.2.1p1[继续](http://port70.net/~nsz/c/c11/n1570.html#6.3.2.1p1)：`E1`

> 可**修改**的左值是没有数组类型、没有不完整类型、没有`const`限定类型，并且如果它是结构体或联合体，则没有任何成员（递归地包括任何成员或所有包含的聚合或联合的元素）具有`const`- 限定类型。

在 C 之前的语言（例如 B）中曾经是所有定位符值都可能出现在赋值的左侧的情况，因此命名。这在 C 中不再是这种情况，因为数组永远不会被分配给，并且 ISO C 添加了`const`.

* * *

PS 相同的脚注解释了相关术语*右值*，如下所示：

> [...] 有时称为**右值**的东西在本国际标准中被描述为**表达式的值**。[...]

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T21:25:07.167

从这篇[文章](http://publib.boulder.ibm.com/infocenter/lnxpcomp/v7v91/index.jsp?topic=/com.ibm.vacpp7l.doc/language/ref/clrc05lvalue.htm)。由于 OP 在问他的问题时有点懒惰（尽管有些人不同意，请参阅评论），我也会很懒惰，只是将整个相关部分粘贴在这里，可能违反了一些版权法。

> 对象是可以检查和存储的存储区域。左值是引用此类对象的表达式。左值不一定允许修改它指定的对象。例如，一个 const 对象是一个不能修改的左值。术语可修改左值用于强调左值允许更改和检查指定对象。以下对象类型是左值，但不是可修改的左值：
> 
> *   数组类型
> *   不完整的类型
> *   一个 const 限定的类型
> *   对象是结构或联合类型，其成员之一具有 const 限定类型
> 
> 因为这些左值是不可修改的，所以它们不能出现在赋值语句的左侧。
> 
> 在 C++ 中，返回引用的函数调用是左值。否则，函数调用是右值表达式。在 C++ 中，每个表达式都产生一个左值、一个右值或不产生值。
> 
> 某些运算符的某些操作数需要左值。下表列出了这些运算符以及对其使用的附加限制。

```
     操作员要求
     &（一元）操作数必须是左值。
     ++ -- 操作数必须是左值。
                                          这适用于两个前缀
                                            和后缀形式。
     = += -= *= %= >= &= ^= |= 左操作数必须是左值。

```

> 例如，所有赋值运算符都会计算其右操作数并将该值分配给其左操作数。左操作数必须是可修改的左值或对可修改对象的引用。
> 
> 地址运算符 (&) 需要一个左值作为操作数，而递增 (++) 和减量 (--) 运算符需要一个可修改的左值作为操作数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T21:49:23.677

一个绝对不是左值的简单示例：

```
3 = 42; 
```

# python - WSGI 字节范围服务

> ID：579426
> 
> 赞同：5
> 
> 时间：2009-02-23T21:22:48.577
> 
> 标签：python, http, http-headers, wsgi, middleware

我正在研究在 WSGI 服务器/应用程序中支持[HTTP/1.1 字节服务：](http://en.wikipedia.org/wiki/Byte_serving)

*   恢复部分下载
*   多部分下载
*   更好的流媒体

[WSGI PEP 333](http://www.python.org/dev/peps/pep-0333/#other-http-features)提到 WSGI 服务器可以实现对字节服务的处理（来自[RFC 2616](https://www.rfc-editor.org/rfc/rfc2616)第 14.35.2 节定义了 Accept-Range/Range/Content-Range 响应/请求/响应标头），如果宣布该功能，应用程序应该实现它：

> 如果客户端请求，服务器可以传输应用程序响应的字节范围，而应用程序本身不支持字节范围。但是，如果需要，应用程序应再次执行此功能。

我已经执行了一些谷歌搜索，但几乎没有关于哪些可用的 WSGI 服务器/中间件/应用程序实现字节范围的信息？有没有人在该领域有经验并且可以提示我进一步挖掘的地方？

编辑：任何人都可以发表评论，我如何增强问题以找到答案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T12:10:21.257

我认为[webob](http://pythonpaste.org/webob/)可以做到这一点，请参阅[文件末尾的示例](http://pythonpaste.org/webob/file-example.html)以了解范围请求实现，该实现有效地寻找正在服务的文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-23T14:25:59.970

您只需要使用 WebOb 并将响应创建为[WebOb Response 对象](http://pythonpaste.org/webob/reference.html#conditional-wsgi-application)`Response(conditional_request=True)`或将其子类化为默认值。`conditional_request=True`

当`conditional_request=True`请求请求范围时，WebOb 会`Response.app_iter_range`包装完整的响应以仅返回请求的范围。

WebOb[文件服务示例](http://pythonpaste.org/webob/file-example.html)`app_iter_range`展示了在实际获取一系列字节而不生成整个响应的情况下，您将如何实现自己的。

# jquery - 在 asp.net 网格中显示大数据

> ID：579443
> 
> 赞同：1
> 
> 时间：2009-02-23T21:30:23.377
> 
> 标签：jquery, grid

我正在寻找不同的方式在具有 500 - 1000 行的 gridview 中呈现数据。网格应支持键盘导航。我编写了 jquery 函数来处理它。但是当我将 500 行加载到网格中时，浏览器会冻结。我不确定我是否对 jquery 做错了什么。我可以查看 jquery，但我想知道在网格中有 500 行并期望良好的性能是否可行。一种选择是使用分页。我想听听我可能遗漏的任何其他想法。

请告诉我。

谢谢，斯里达尔。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T22:36:16.200

尽量减少 HTML 的大小，使用 CSS 类而不是大量的内联样式和标记。通过这种方式，您应该会看到解析和渲染时间的显着加快（500 行并不多）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T01:20:28.910

尝试使用[Repeater](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.repeater_properties.aspx)而不是 GridView 。这至少可以让您完全控制正在渲染的内容。GridViews 在 html、ViewState 和包含的 javascript 中为页面添加了很多臃肿，而且通常是矫枉过正。

如果您对 PostBacks 没问题，而不是使用一些自定义 ajax（不是 AJAX.Net）进行分页，则可以将 Repeater 绑定到[PagedDataSource](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.pageddatasource_properties.aspx)对象，该对象可以绑定到 DataSet、DataTable 或您正在使用的任何 Collection .

我希望这有帮助！

* * *

*此外，一个 GridView 应该能够处理 500 行而不会冻结您的浏览器。你能发布你的jQuery吗？*

# java - Java 构造函数

> ID：579445
> 
> 赞同：30
> 
> 时间：2009-02-23T21:31:27.633
> 
> 标签：java, constructor

我正在尝试学习如何在 Java 中指定类构造函数。我开始明白它们指定了由该类创建的对象的实例变量的类型。它们也可用于设置实例变量的初始值。以下示例来自 Sun 网站上的 Java 教程：

```
public Bicycle(int startCadence, int startSpeed, int startGear) {
    gear = startGear;
    cadence = startCadence;
    speed = startSpeed;
} 
```

你应该把构造函数放在你的类源代码的什么地方？

这些参数是变量的名称吗？: (int startCadence, int startSpeed, int startGear) 还是 gear, cadence 和 speed 变量的名称？

(int startCadence, int startSpeed, int startGear) 和 gear, cadence 和 speed 有什么区别？

万一我的导师或盐湖社区学院的任何管理员遇到这个问题，让我明确表达我的意图。这个问题是本着学术诚信的最大精神发布的。我问这个问题是为了寻求一般建议和帮助，以了解使用 Java 编程语言的正确方法。我绝不会使用他人的作品并将其视为我自己的作品。我使用此处提供的答案作为我理解的一般帮助。我自己做所有的工作，不会复制回答我问题的人提供的工作。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-23T21:44:41.050

构造函数可以出现在类代码中的任何位置。但是，按照惯例，大多数人将它们放在任何其他非构造函数之前。

至于变量名，这6个其实都是变量名，只是作用域不同。指定为构造函数参数的参数（startCadence、startSpeed、startGear）仅在构造函数中可用。其他 3 个（齿轮、节奏、速度）可能是类范围的变量，可用于所有方法。但是，该定义未显示在您的代码片段中。整个班级看起来像：

```
class Bicycle
{
    // class-level variables
    private int gear;
    private int cadence;
    private int speed;

    // constructor
    public Bicycle(int startCadence, int startSpeed, int startGear) {
        gear = startGear;
        cadence = startCadence;
        speed = startSpeed;
    }

    // another method (not a constructor)
    public void ShiftUp() {
        gear = gear + 1; // notice the 'gear' variable is available here too.
    }
} 
```

希望有帮助！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-23T21:41:19.297

gear、cadence 和 speed 是类的成员变量（在别处声明），而 startCadence、startSpeed 和 startGear 是函数参数。

```
class Bicycle
{
    private int gear, cadence, speed;

    public Bicycle(int startCadence, int startSpeed, int startGear)
    {
        // set the value of member variables from passed parameters
        gear = startGear;
        cadence = startCadence;
        speed = startSpeed;

    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-23T22:01:11.667

> *你应该把构造函数放在你的类源代码的什么地方？*

我使用以下内容：

```
package statement ....
import statements....

public class MyClass { 
     // instance attributes
     private int i;

     // class attribute 
     private static int MAX;

     // static methods 
     public static int getClassCount() { 
     }

     // Constructor!! 
     public MyClass() {  // constructor.
     }

     // public methods 
     // protected methods
     // private methods 

     // public static void main
 } 
```

但他们可以去任何地方。我觉得最好把事情按可见度排列。例如，我宁愿在私有方法之前使用公共方法（所以如果我正在寻找一个特定的公共方法，我知道它在文件的顶部）出于同样的原因，我通常将构造函数放在顶部。

> *这些参数是变量的名称吗？：*

没必要，你可以随意命名。我通常使用相同的名称。

> *...或者是齿轮，节奏和速度变量的名称？*...

它们是**实例**变量名称

> *(int startCadence, int startSpeed, int startGear) 和 gear, cadence 和 speed 有什么区别？*

第一个是构造函数的参数名称，前者是它自己的对象的属性名称。

取另一个样本：

```
 public class Person { 
     private String name; // a person has a name.

     public Person( String nameParameter ) {  
        this.name = nameParameter;
     }
     public String toString() { 
         return "My name is : " + this.name;
     }

     public static void main( String [] args )  { 

          // creates a new "instance" and assign "Patrick" as its name.
         Person one = new Person("Patrick");
         System.out.println( one ); // prints "My name is: Patrick"

         // each person have its own name. 
         Person two = new Person("Oscar");
         System.out.println( two ); // prints "My name is: Oscar"         

     } 
 } 
```

如您所见，当您将值传递给构造函数时，您正在使用参数，当您看到构造函数代码时，您会看到参数名称（接收该参数），然后将其分配给实例属性。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T21:40:44.490

1.  这完全取决于你。我通常从所有变量开始，然后是构造函数，然后是方法，但这只是个人喜好。
2.  参数的名称完全无关紧要，只要您不将它们命名为与变量相同的名称。在本例中`gear`，`cadence`、 和`speed`是变量。
3.  您正在（或某人正在）将三个传递`ints`给构造函数。名称 ( `startCadence`、`startSpeed`和`startGear`被称为*形式参数*，它们是您识别参数的方式。请参阅[http://en.wikipedia.org/wiki/Parameter_(computer_science)](http://en.wikipedia.org/wiki/Parameter_(computer_science)) .
    `gear`、`cadence`、 和`speed`在其他地方定义类。类中的任何方法都可以引用它们。

别担心——如果你努力工作，这种事情很快就会成为第二天性。

哦，我可以建议您获得一个好的 IDE 吗？[BlueJ](http://www.bluej.org/)应该适合初学者，而[NetBeans](http://www.netbeans.org/)和[Eclipse](http://www.eclipse.org/)适合更有经验的程序员。源代码高亮是无价的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-23T21:40:56.737

我通常将构造函数放在文件顶部附近，在包、导入、Javadoc 和静态/实例变量声明部分之后。

gear、cadence 和 speed 是类变量，大概是在构造函数之外的某个地方定义的。startCadence、startSpeed 和 startGear 也是变量，但它们是传递给构造函数的参数。

您可能还会看到如下内容：

```
public Bicycle(int cadence, int speed, int gear) {
    this.gear = gear;
    this.cadence = cadence;
    this.speed = speed;
} 
```

它从同名的参数中设置类变量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T21:44:48.537

实际上，构造函数的参数不必存储为对象的成员变量。这是一个例子：

```
class NumberAsString {

   private String numAsStr;

   public NumberAsString(double number) {
      this.numAsStr = Double.toString(number);
   }

} 
```

在此示例中，构造函数参数实际上并未存储在任何地方，但它的值对于计算一个或多个成员变量值是必需的。

您所看到的所有参数都直接存储为成员变量的行为很常见。特别是对于某些只为其成员变量提供“getter”和“setter”方法的类（不提供任何计算或转换函数）。在 Java 世界中，这些类通常被称为“bean”。（是的，这是一个非常愚蠢的名字。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T21:46:58.563

int startCadence 和 cadence 的基本区别不在于变量，而在于它们的作用域。如果在方法内部定义了一个变量，比如构造函数，它将只存在于该方法内部，而不存在于外部。如果在一个类中定义了一个变量，它将存在于该类中的任何地方，这样的变量具有全局范围。变量 startCadence 只存在于构造函数中，所以如果你想在其他地方使用它的值，你可以将它传递给另一个具有全局范围的变量。这就是这里发生的事情： cadence = startCadence;

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T22:02:15.190

`(int startCadence, int startSpeed, int startGear)`参数是构造函数参数，它们将设置 Bicycle字段`cadence`、`speed`和`gear`。它们仅在构造函数中可用。`gear`, `cadence`, 和`speed`是每个 Bicycle 实例唯一的实例变量，可以从其他方法引用。构造函数参数允许您为对象的初始化提供参数。在此示例中，您可以创建一个档位为 1、踏频为 0、速度为 0 的自行车对象，如下所示：

```
Bicycle bike = new Bicycle(0, 0, 1); 
```

或者，您可以创建一辆移动自行车，其节奏为 60 rpm，速度为 10 mph，在 3 档，如下所示：

```
Bicycle bike = new Bicycle(60, 10, 3); 
```

构造函数的位置无关紧要，但通常构造函数放置在类定义的开头。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-24T00:01:59.113

1）构造函数的位置一点也不重要。但是，按照惯例，我*个人*将其放置如下：

```
public class Bicycle {

    public int gear, cadence speed;

    public Bicycle(int startCadence, int startSpeed, int startGear) {
        gear = startGear;
        cadence = startCadence;
        speed = startSpeed;
    }

    public void otherFunction1() {}
    public void otherFunction2() {}
    public void otherFunction3() {}

} 
```

2）gear、cadence、speed是类的成员变量；它们属于每辆自行车，并且是每辆自行车的不同变量。然而，startCadence、startSpeed 和 startGear 是局部变量，它们只属于该函数。当我要求一个

```
new Bicycle(10, 15, 5); 
```

startCadence 设置为 10，startSpeed 设置为 15，startGear 设置为 5。然后，构造函数将成员变量初始化为它们“start”对应的变量。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2014-11-03T13:28:25.703

```
public class Account 

{

    private static final Exception InsufficientFundsException = null;

    private int  accountNumber;
    private double availableBalance;
    private int pin;
    public Account(int account, int pin,double amount )
    {

        this.accountNumber = account;
        this.pin = pin;
        this.availableBalance = amount;
    }

    public void credit(double amount)
    {
        this.availableBalance= this.availableBalance+amount;
    }

    public void debit(double amount) throws Exception
    {
        if(this.availableBalance>=amount)
        {
        this.availableBalance= this.availableBalance-amount;
        }
        else
        { 
            throw new InsufficientFundsException();
        }

    }

    public int getAccountNumber() 
    {
        return accountNumber;
    }   

    public double getAvailableBalance()
    {
        return availableBalance;
    }
    public String toString()
    {
        return "Account="+accountNumber+"pin="+pin+"balance"+availableBalance;
    }
    public boolean validatePIN(int pin)
    {
        if(this.pin==pin)
            return true;
        else return false;  
}
} 
```

# c# - 与 C# 相比，您会强调 Ruby 的哪些语言特性？

> ID：579446
> 
> 赞同：6
> 
> 时间：2009-02-23T21:31:27.993
> 
> 标签：c#, ruby, programming-languages

我正在与 .NET (C#) 开发团队就 Ruby 语言和环境进行一系列会谈。我正在接近它作为一个机会来强调 Ruby 相对于 C# 的好处。首先，我想在进入环境之前专注于语言本身（RoR 与 ASP MVC 等）。您会介绍 Ruby 语言的哪些特性？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-23T22:17:26.790

不久前，我与一个 .NET 用户组就 IronRuby 进行了一次谈话，并遇到了类似的问题。我关注的事情是：

*   鸭打字。没有什么比`List<string> stringList = new List<string>()`;

*   富有表现力和简洁的语法。简单的东西，比如省略括号、数组和散列文字等（结合鸭子类型，你会得到`string_list = []`明显更好的）。所有的小事都加起来很大。

*   元编程。从简单的东西开始，`attr_accessor`如果他们没有立即看到好处，那么可能会更高级一些。不要试图将事情与 lisp 和关于编写其他程序的程序进行比较......人们只会认为你在抽烟。保持简单并强调*您不必再编写相同的蹩脚样板代码*

*   作为一个很好的“结局”，向他们展示一些普通的 NUnit 风格测试以及`Assert.NotEqual<string> blah`他们通常拥有的所有混乱，然后说“这是用 ruby​​ 编写的相同代码”并展示给他们使用 rspec 编写的（它将是一半的长度和阅读起来容易 10 倍……如果这不卖它们，什么都不会）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T22:27:06.173

> 我正在接近它作为一个机会来强调 Ruby 相对于 C# 的好处。

我不确定这是正确的做法。如果你谈话的语气是，“Ruby 很酷，因为你可以在里面做*x*！” 你会很快失去你的 C# 观众。他们会回答：“如果我们愿意，我们可以在 C# 中模拟*x*，但我们在设计中没有太多用处*x*。” 或者，“如果你认为你需要做*x*那么你做错了！”

在他们了解 Ruby 之前，他们不会理解 Ruby 可以如何帮助他们。为什么不带他们解决一些玩具问题并向他们展示 Ruby 程序员如何解决这些问题呢？用 Ruby 的方式教他们。一周后，当他们看到他们遇到的问题时，其中一个会说，“哎呀，我知道如何解决这个问题，但如果我使用 Ruby 会容易得多...... 。”

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T22:06:53.307

鸭打字！这在 c# 4.0 中将不再是一个问题，但有时我不得不复制整个代码块，因为具有（出于我的目的）相同 API 的两个相关类不共享一个基类。

还有，块。C# 有 lambda，但 Ruby 的语法更漂亮，它们在整个标准库中普遍使用。它们更像是惯用的 Ruby 的一部分，而不是惯用的 c#，这很重要。

**编辑**
哈希文字也值得一提。一般来说，我会强调你在 Ruby 中的简洁程度，以及这如何让你更好地表达意图并花费更少的时间来让编译器满意

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-24T15:14:58.407

除了大家说的，**Open Classes**是 Ruby 的一个重要特性，值得一提：（从*[Ruby From Other Languages](http://www.ruby-lang.org/en/documentation/ruby-from-other-languages/)**偷来的例子*）

```
class Fixnum
  def hours
    self * 3600 # number of seconds in an hour
  end
  alias hour hours
end

# 14 hours from 00:00 January 1st
# (aka when you finally wake up ;)
Time.mktime(2006, 01, 01) + 14.hours # => Sun Jan 01 14:00:00 
```

我知道，[应该避免像猴子一样打补丁](http://www.infoq.com/articles/ruby-open-classes-monkeypatching)，但我认为向新手强调这个特性应该让他们对 Ruby 背后的哲学有所了解。只要记住说：“*孩子们，不要在家里尝试这个！* ”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T21:44:20.787

混入和多重继承。

它在坏人手中是危险的，但对于正确封装事物非常有益，而不是必须继承许多你不一定需要的东西。

# c# - 为什么 MSTest 向导将 F 后缀作为双精度而不是 D？

> ID：579449
> 
> 赞同：1
> 
> 时间：2009-02-23T21:31:42.657
> 
> 标签：c#, .net, visual-studio-2008, mstest

当我使用 MS Visual Studio 的内置单元测试向导创建测试时，它创建的代码如下所示：

```
double number = 0F; 
```

在 C# 中，“F”代表浮点数、大小写无关，“D”代表双精度。使用“F”后缀而不是“D”会导致精度丢失。

如果是错误，我可以在哪里向 Microsoft 报告？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T21:46:16.990

我不明白这怎么可能只是一个错误。在这种情况下完全无害，但仍然是一个错误。您可以使用[Connect](http://connect.microsoft.com/)报告此类事情。但是，我已经排除了比这更重要的错误，所以我不希望采取太多行动。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T00:42:36.723

如果该值始终为 0F，则根本不会丢失任何信息。

通常，任何浮点数都可以转换为双精度而不损失精度（假设为 IEEE 754）。

只要测试值不需要截断来表示为浮点数，那么在*正确性*方面就没有问题。最终用户的困惑和想要修改值时增加的麻烦仍然是一个问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-23T21:47:54.270

如果您使用小数（M 后缀），那么您不必担心它会出现估计错误或精度损失。

# benchmarking - 使用 AB 进行负载测试...假失败请求（长度）

> ID：579450
> 
> 赞同：228
> 
> 时间：2009-02-23T21:32:25.150
> 
> 标签：benchmarking, load-testing, apachebench

为了我自己的好奇心，在我的服务器上进行一些负载测试，我运行了：

```
ab -kc 50 -t 200 http://localhost/index.php 
```

这会打开 50 个保持活动连接，持续 200 秒，然后用 index.php 请求猛击我的服务器

在我的结果中，我得到：

```
Concurrency Level:      50
Time taken for tests:   200.007 seconds
Complete requests:      33106
Failed requests:        32951
   (Connect: 0, Receive: 0, Length: 32951, Exceptions: 0)
Write errors:           0
Keep-Alive requests:    0
Total transferred:      1948268960 bytes
HTML transferred:       1938001392 bytes
Requests per second:    165.52 [#/sec] (mean)
Time per request:       302.071 [ms] (mean)
Time per request:       6.041 [ms] (mean, across all concurrent requests)
Transfer rate:          9512.69 [Kbytes/sec] received 
```

请注意 32951“失败”请求。我无法弄清楚这一点。

随着测试的运行，我可以从我的家用电脑完美地访问我的网站，尽管页面底部的页面加载时间报告为 0.5 而不是通常的 0.02。但是，我从来没有一次失败的请求。

那么为什么 AB 会报告一半的连接失败呢？在这种情况下，“长度：”是什么意思？

* * *

## 回答 #1

> 赞同：386
> 
> 时间：2009-02-23T21:36:41.070

没关系。“长度失败”仅表示响应长度的大约一半时间不同。

由于内容是动态的，它可能是会话标识符或类似的东西。

* * *

## 回答 #2

> 赞同：149
> 
> 时间：2011-10-11T19:10:22.367

换句话说，描述这个问题：

apache 基准测试工具 (ab) 假定响应内容的长度在整个测试期间是相同的。它存储第一个响应的内容长度。如果任何进一步的响应具有不同的内容长度，它们会导致“长度失败”。

以下 apache 错误报告似乎证实了这一点：[ASF Bug 42040](https://issues.apache.org/bugzilla/show_bug.cgi?id=42040)

**摘要**：如果您正在提供任何可变长度的内容，您可能应该忽略这种 ab 请求失败。

**编辑**：我最近注意到该`ab`命令有一个新的（至少对我而言）选项：

```
-l   Accept variable document length (use this for dynamic pages) 
```

我可以在*ab Version 2.3 <$Revision: 1528965 $>中看到它，但在**ab Version 2.3 <$Revision: 655654 $> 中看*不到它，所以它可能是最近才添加的。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-09-24T18:27:56.607

很抱歉复活了一个老问题，但这是第一个出现在 Google 中的问题。有时，ab 报告的长度错误可能是由一个实际问题引起的：如果在客户端没有收到 Content-Length 标头中声明的总字节数之前，连接在服务器端关闭。如果客户端和服务器之间有其他方，例如天真的手工负载平衡器（我的例子），就会发生这种情况。

# java - 用于国际化的 Java 和 GNU gettext

> ID：579453
> 
> 赞同：11
> 
> 时间：2009-02-23T21:33:02.810
> 
> 标签：java, internationalization, gettext

有没有人有过使用 GNU gettext 开发大型 Java 应用程序以实现国际化的经验？我发现我真的很喜欢在我的源代码中包含英文文本，但我想确保我所做的对于我参与的相对较大的软件项目来说是实用的。

如果您有这方面的经验，您使用什么来查找 Java 中的资源？我目前正在尝试 Gettext Commons ( [http://code.google.com/p/gettext-commons/](http://code.google.com/p/gettext-commons/) )，到目前为止它似乎运行良好。

将原始文本保留在源代码中的 gettext 的任何替代方法？Windows 上支持的类似工具会很棒。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-29T19:32:28.223

[JSOM](http://josm.openstreetmap.de/)开源 OpenStreetMap Java 编辑器项目正在使用 Gettext 库来处理其所有翻译，并且效果非常好，因为人们能够使用各种翻译工具（如 KBabel、poedit、launchpad...）来使用po 文件，因此那里没有平台限制。此外，我不太明白为什么您认为上述设置不能在任何平台上使用 - 您当然可以在 Windows 中使用 gettext 参见：[here](http://sourceforge.net/projects/gettext)或[here](http://gnuwin32.sourceforge.net/packages/gettext.htm)

鉴于 gettext 的流行程度，我当然会推荐它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T21:41:50.510

您可以改用[普通的旧 Java 消息资源包](http://java.sun.com/j2se/1.4.2/docs/api/java/util/ResourceBundle.html)。

**编辑**：嗯，我们在开发团队中真正使用的是标准[TMX 格式](http://xml.coverpages.org/tmxSpec971212.html)，它允许您在 XML 文件中指定本地化字符串。它是翻译工具常用的格式。[这是一个免费的](http://tmx-editor.sourceforge.net/)，可让您更轻松地编辑这些文件。

尽管如此，我之前没有提到它，因为它没有提供比消息资源包任何真正的优势或功能，除了通过 XML 处理工具更好的编码处理（在处理不同语言的国际化文字时，编码可能是一个真正的痛苦到英语）。

此外，我们真正使用的是我们的软件是我们自己的框架，它解析这种 XML 格式并让我们在语言之间进行切换（在 HTML 页面或 Swing 框架中），而无需重新启动我们的应用程序。开发一个以这种方式处理字面翻译的简单库并不难，但缺点是您必须实现它。

# java - Java中的大类分解

> ID：579454
> 
> 赞同：12
> 
> 时间：2009-02-23T21:33:05.570
> 
> 标签：java, architecture, oop, refactoring

我刚开始学习 Java，很好奇 Java 中有没有好的对象分解的好习惯？让我描述一个问题。在大型软件项目中，它总是像“core”或“ui”这样的大类，它们往往有很多方法，并且旨在作为较小类之间的中介。例如，如果用户单击某个窗口上的按钮，该窗口的类会向“ui”类发送一条消息。此“ui”类捕获此消息并通过使用应用程序用户界面（通过其中一个成员对象的调用方法）或通过将消息发布到应用程序“核心”（如果它类似于“退出应用程序”或“启动网络”）来相应地采取行动联系'。

这些对象很难分开，因为它们只是许多小型应用程序对象之间的中介。但是在应用程序中拥有一个具有成百上千方法的类并不是很方便，如果这些方法是从一个对象到另一个对象的微不足道的任务委托的话。C#通过允许将类实现分解为多个源文件来解决此类问题：您可以选择任何方式划分上帝对象，它会起作用。

在Java中划分此类对象的任何做法？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-23T21:52:15.947

开始拆分这样一个大对象的一种方法是首先找到由大对象管理的字段或属性的良好子集，这些字段或属性彼此相关并且不与对象的其他字段或属性交互。然后，仅使用这些字段创建一个新的、更小的对象。也就是说，将*所有*逻辑从大类移动到新的小类。在原始的大类中，创建一个简单地传递请求的委托方法。这是一个很好的第一步，只涉及更改大对象。它不会减少方法的数量，但可以大大减少大类中所需的逻辑量。

在这样做几轮之后，您可以通过将其他对象直接指向更新的、更小的对象来开始删除一些委托，而不是通过之前位于所有对象中间的巨大对象。

例如，参见[Wikipedia 的委托模式](http://en.wikipedia.org/wiki/Delegation_pattern)讨论。

举个简单的例子，如果你有一个人事对象来代表公司的员工，那么你可以创建一个工资对象来跟踪与工资相关的值，一个评级对象来跟踪员工评级，一个奖励对象来跟踪该人获得的奖项，等等。

也就是说，如果您从一个包含以下方法的大类开始，每个方法都包含业务逻辑以及许多其他方法：

```
...
public boolean isManagement() { ... }
public boolean isExecutive() { ... }
public int getYearsOfService() { ... }
public Date getHireDate() { ... }
public int getDepartment() { ... }
public BigDecimal getBasePay() { ... }
public BigDecimal getStockShares() { ... }
public boolean hasStockSharePlan() { ... }
... 
```

那么这个大对象可以在其构造函数中创建一个新创建的对象`StaffType`和一个新创建的对象`PayInformation`和一个新创建的对象`StaffInformation`，最初大对象中的这些方法如下所示：

```
// Newly added variables, initialized in the constructor (or as appropriate)
private final StaffType      staffType;
private final StaffInformation staffInformation;
private final PayInformation payInformation;

...

public boolean isManagement() { return staffType.isManagement(); }
public boolean isExecutive() { return staffType.isExecutive(); }
public int getYearsOfService() { return staffInformation.getYearsOfService(); }
public Date getHireDate() { return staffInformation.getHireDate(); }
public int getDepartment() { return staffInformation.getDepartment(); }
public BigDecimal getBasePay() { return payInformation.getBasePay(); }
public BigDecimal getStockShares() { return payInformation.getStockShares(); }
public boolean hasStockSharePlan() { return payInformation.hasStockSharePlan(); }
... 
```

曾经在大对象中的完整逻辑已移至这三个新的较小对象。通过此更改，您可以将大对象分解成更小的部分，而无需接触任何利用大对象的东西。但是，随着时间的推移，您会发​​现大对象的某些客户端可能只需要访问可分割组件之一。对于这些客户，他们可以直接使用小对象，而不是使用大对象并委托给特定对象。但是即使这种重构永远不会发生，您也可以通过将不相关项的业务逻辑分成不同的类来改进事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T21:58:29.160

下一个合乎逻辑的步骤可能是将 BigClass 更改为 java 包。接下来为每组相关功能创建新对象（在每个类中注意该对象是新包的一部分）。

这样做的好处是减少依赖性和提高性能。

1.  无需为了获得一些方法而导入整个包/BigClass。
2.  对相关功能的代码更改不需要重新编译/重新部署整个包/BigClass。
3.  用于分配/释放对象的内存更少，因为您使用的是较小的类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T21:42:10.103

我见过一些通过继承解决这个问题的案例：假设类 Big 处理 5 个不同的事情，并且（出于各种原因）它们都必须在同一个类中。所以你选择一个任意的继承顺序，并定义：

```
BigPart1 // all methods dealing with topic #1
BigPart2 extends BigPart1 // all methods dealing with topic #2
...
Big extends BigPart4 // all methods dealing with the last topic. 
```

如果你真的可以把东西分层，这样破坏就有意义了（Part2 实际上使用了 Part1 中的东西，但反之则不然，等等），那么也许它是有道理的。

我在 WebWorks 中看到过这种情况，其中一个类有大量的 getter/setter 方法——用于依赖注入的 setter（例如，在执行时传递给对象的 URL args）和用于使值可访问的 getter到各种页面模板（我认为是 JSP）。

因此，细分在逻辑上对内容进行了分组，例如，假设该类称为 MyAction，则有 MyActionBasicArgs（基本 CGI 参数的字段和设置器），由 MyActionAdvancedArgs（高级选项参数）扩展，由 MyActionExposedValues（getter）扩展，由 MyActionDependencies 扩展（Spring 依赖注入使用的设置器，非 CGI 参数），由 MyAction 扩展（其中包含实际的 execute() 方法）。

由于 WebWorks 中依赖注入的工作方式（或者至少在当时是这样工作的），它必须是一个巨大的类，因此以这种方式分解它可以使事情更易于维护。但首先，拜托，拜托，看看你是否可以简单地避免上一堂大课；仔细考虑你的设计。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T22:23:29.693

是的，C# 提供了部分类。我假设这就是您所说的：

> C#通过允许将类实现分解为多个源文件来解决此类问题：您可以选择任何方式划分上帝对象，它会起作用。

这确实有助于使大型课程更易于管理。但是，我发现当需要扩展由代码生成器创建的代码时，最好使用部分类。当一个类和你所说的一样大时，它几乎总是可以通过适当的面向对象设计分成更小的类。使用部分类回避了更正确的面向对象设计，这有时是可以的，因为最终目标是稳定、可靠、可维护的代码，而不是教科书式的 OO 代码示例。然而，很多时候，将一个大对象的代码放到同一个类的大量较小的部分类实例中并不是理想的解决方案。

如果您可能找到不相互交互的“上帝”对象的属性子集，那么这些集合中的每一个在逻辑上都会成为新对象类型的良好候选者。但是，如果这个“上帝”对象的所有属性都相互依赖，那么您就无法分解该对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T23:48:58.787

我不知道你为什么会有这么大的班级。

我想如果你正在使用 gui builder 代码生成并且对此很懒惰，你可能最终会遇到这种情况，但是除非你自己控制，否则 codegen 通常会很糟糕。

任意拆分单个班级是解决可怕的制造问题的可怕解决方案。（代码重用，一方面将变得几乎不可能）

如果您必须使用 GUI 构建器，请让它构建较小的组件，然后使用小组件构建更大的 GUI。每个组件都应该只做一项工作并且做得很好。

如果可以避免，请尽量不要编辑生成的代码。将业务逻辑放入生成的“框架”中只是一种可怕的设计模式。大多数代码生成器对此没有太大帮助，因此请尝试仅进行一次最小的编辑以从外部类中获取所需的内容（想想 MVC，其中生成的代码是您的视图，而您编辑的代码应该在您的模型中和控制器）。

有时您可以只从 Frame 对象中公开 getComponents 方法，通过迭代容器来取出所有组件，然后将它们动态绑定到数据和代码（通常绑定到 name 属性效果很好），我已经能够安全地以这种方式使用表单编辑器，所有的绑定代码往往很容易被抽象和重用。

如果您不是在谈论生成的代码——那么在您的“上帝”课程中，它是否只完成了一项小工作并且做得很好？如果没有，请取出一个“作业”，将其放入它自己的类中，然后委托给它。

你的 GOD 课程是否充分考虑？当我看到像这样的大型课程时，我通常会看到很多复制/粘贴/编辑行。如果有足够的相似性来复制、粘贴和编辑某个部分，那么就足以将这些行分解为单个代码块。

如果您的大类是 GUI 类，请考虑装饰器——可重用并将内容移出主类。双赢。

我想您的问题的答案是，在 Java 中，我们只是使用良好的 OO 来确保问题不会首先出现（或者我们没有——Java 肯定不能免于您正在谈论的问题）比任何其他语言）

# wpf - 从 WinForms 托管的 WPF 控件加载/使用资源字典

> ID：579460
> 
> 赞同：11
> 
> 时间：2009-02-23T21:33:52.510
> 
> 标签：wpf, winforms, interop, resources, elementhost

我有一个需要在运行时托管 WPF 控件的 Windows 窗体应用程序。我已经完成了基本的托管和交互（使用 ElementHost 控件）并且一切正常，直到我尝试做一些需要 WPF 控件来使用已定义的自定义资源字典的事情。（WPF 控件及其所有资源字典都定义在同一个 WPF 控件库 DLL 中。）

一旦发生这种情况，我就会收到一堆看起来像这样的错误：

```
System.Windows.ResourceDictionary Warning: 9 : Resource not found; ResourceKey='DocumentHeaderInterestStyle' 
```

我找到了一个[参考资料](http://www.drwpf.com/blog/Home/tabid/36/EntryID/10/Default.aspx)（**链接由于归档而失效**，[这](http://drwpf.com/blog/2007/10/05/managing-application-resources-when-wpf-is-hosted/) *可能*是最初参考的同一篇文章）。这谈到了这一点，但似乎这篇文章更多地从 WPF 方面处理事情，但我真的不想对 WPF 控件进行更改，因为一切都在独立的 WPF 应用程序中工作。

如果实现这一点的唯一方法是在 WPF 端进行更改，我可以进行这些更改（我不负责 WPF 控件库，但也为同一家公司工作的人，所以这不是问题其他而不是让他有时间进行更改。）但我希望我可以在 WinForms 方面做一些事情来让它发挥作用。

WPF 控件库在项目中定义了一个名为“Default.xaml”的资源字典文件，具有以下属性：

构建操作：页面复制到输出目录：不要复制自定义工具：MSBuild:Compile

独立 WPF 应用程序的 App.xaml 文件中有以下条目：

```
 <ResourceDictionary x:Uid="ResourceDictionary_1">
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary x:Uid="ResourceDictionary_2" Source="/SmartClient.Infrastructure;component/Themes\Default.xaml"/>
        </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary> 
```

看起来控制库应该已经知道如何获取它的资源。使用 Resources.MergedDictionaries.Add() 似乎应该可以工作，但是我在哪里可以获得现有字典的实例？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T21:43:32.067

假设你知道你需要什么资源（听起来像你做的那样），你应该能够自己“注入”它们。就像是：

```
var wpfControl = new ...;
wpfControl.Resources.Add(...);
elementHost.Child = wpfControl; 
```

在您的问题中，您提到控制库中有现有的资源字典。如果是这样，您可以这样做：

```
var wpfControl = new ...;
wpfControl.Resources.MergedDictionaries.Add(/* instance of existing dictionary */);
elementHost.Child = wpfControl; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-21T19:05:51.440

为了加载嵌入到程序集中的资源字典，我使用以下代码段在运行时加载它们：

```
//using System.Windows
ResourceDictionary dict = new ResourceDictionary();
dict.Source = new Uri("MyResourceDictionary.xaml", UriKind.Relative);

Application.Current.Resources.MergedDictionaries.Add(dict); 
```

这也适用于在可执行目录中加载字典。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-09-08T13:29:00.113

假设您将样式/模板/资源划分为许多文件`Resources1.xaml`，并且`Resources2.xaml`可以将它们聚合到单个资源字典 ( `AllResources.xaml`) 中。可以轻松地将资源字典添加到控件的 xaml 文件中的控件。请参见下面的示例。

**（！）**设置`Resources1.xaml`，`Resources2.xaml`并`AllResources.xaml`建立行动**`Page`**

资源1.xaml

```
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <ControlTemplate x:Key="ScrollViewerControlTemplate" TargetType="{x:Type ScrollViewer}">
        ...
    </ControlTemplate>

    <LinearGradientBrush x:Key="VerticalScrollBarBackground" EndPoint="1,0" StartPoint="0,0">
        ...
    </LinearGradientBrush>

    <Style x:Key="StyleA" TargetType="{x:Type ScrollBar}">
        ...
    </Style>

</ResourceDictionary> 
```

资源2.xaml

```
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Style x:Key="StyleB" TargetType="{x:Type ScrollBar}">
        ...
    </Style> 

    <Style x:Key="StyleC" TargetType="{x:Type TextBlock}">
        ...
    </Style>

</ResourceDictionary> 
```

所有资源.xaml

将资源字典源添加为**AllResources.xaml的****相对**路径

 **```
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="Resources1.xaml" />
        <ResourceDictionary Source="Resources2.xaml" />
    </ResourceDictionary.MergedDictionaries>
</ResourceDictionary> 
```

最后在你的 UserControl

```
<UserControl.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="pack://application:,,,/projectName;component/PathToTheFileRelativeToProjectRootDirectory/AllResources.xaml
        <converters:StringToUpperCaseConverter x:Key="StringToUpperCaseConverter" />
        <converters:LocalizationEntryToStringCaseConverter x:Key="LocalizationEntryToStringCaseConverter" />
    </ResourceDictionary>
</UserControl.Resources> 
```

# javascript - 现在你把 DHTML 叫做什么？

> ID：579463
> 
> 赞同：22
> 
> 时间：2009-02-23T21:34:53.537
> 
> 标签：javascript, ajax, terminology, dhtml

所以最近每当我使用“dHTML”这个词时，我都会从初级开发人员那里得到很多废话。我知道这个术语已经过时了，但它描述了任务是什么：更改客户端上呈现的标记。每当我看到术语“Ajax”应用于没有异步请求的客户端动画或表单验证时，我都会感到畏缩。“Web 2.0”也被大量使用，但该术语可以应用于从商业模式到视觉风格的所有事物。

什么术语用于描述客户端脚本和 CSS 效果的组合，这些效果可能会或可能不会伴随异步服务器请求？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-23T21:48:56.687

它是 DHTML。

*   这不是 AJAX；没有必要异步或使用 XML 来操作 DOM。
*   它不是 HTML；那是静态标记。
*   这不是 Javascript；Javascript 是一种不一定与 HTML 有任何关系的语言。
*   这不是 JQuery；那是一个框架和完全不同的蜡球。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-02-23T21:41:14.723

[DOM 脚本/操作](http://en.wikipedia.org/wiki/DOM_scripting)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-23T21:38:16.027

我只是称它为 JavaScript。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-23T21:40:34.040

只需将其称为*客户端脚本和可能涉及或可能不涉及异步服务器请求的 css 效果的组合*。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-23T21:38:22.127

我称之为客户端行为。

我也同意你的观点：“AJAX”是为回调服务器的行为保留的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-23T21:38:33.297

阿贾克斯。我知道它最常用于服务器端请求，但仅仅因为它只是客户端并不意味着它仍然不被称为 Ajax。

[阿贾克斯](http://en.wikipedia.org/wiki/AJAX)：

> ...尽管名称如此，但实际上并不需要使用 JavaScript 和 XML，请求也不需要是异步的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-23T21:36:54.017

我称之为 jQuery。:)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-23T21:42:33.100

我会说你试图解决错误的问题。问题是小学生的态度，而不是你的语言。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-23T21:55:28.497

我会选择 DOM Scripting。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-23T22:27:10.277

称之为 dHTML 或 DOM 脚本。我同意：您的问题不在于语言，而在于初级开发人员。如果你想解决真正的问题，你可能会问他怎么称呼它，然后从那里处理它。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-23T21:38:07.947

DHTML 仍然适合并在我的同龄人组中占有一席之地。它们可能是基于 Ajax 的 UI，它仍然是带有 Ajax 的 DHTML，但最终，就这样称呼它吧。/耸耸肩

或 Javascript

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-23T22:49:40.800

我的 DHTML 的 0.02 是一个有效的术语，尽管目前不流行。
[http://en.wikipedia.org/wiki/DHTML](http://en.wikipedia.org/wiki/DHTML) - 动态 HTML
- 仅仅因为大多数 javascript 动画很糟糕，而 JQuery 在该术语被创造时并不存在，并没有降低它的有效性。

有些人甚至在 Ajax 还没有名字之前就做过了……

你怎么称呼它并不重要，除非你在营销部门。
*“如果你愿意，就叫它妈妈”*

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-23T21:38:49.630

我想也许是 RIA，因为我认为“富有”很合适，但考虑到可能不正确的实际定义。事实上，RIA 可能不如 Ajax 准确。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-23T21:39:43.340

“Dynamic web [content|pages|stuff]”是准确的，如果不准确的话。我可以看到“dHTML”过于具体的案例。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-23T22:10:06.557

我认为你所说的取决于谈话的性质。如果对话是面向行为的（即我希望这个区域基于 x 进行更改，或者这些是拖动山墙），那么像动态这样的解决方案不可知术语可能是最好的。如果您在谈论特定的解决方案，最好使用语言/技术特定的术语来清楚地说明。

# objective-c - 需要后台进程。线？

> ID：579487
> 
> 赞同：1
> 
> 时间：2009-02-23T21:40:04.463
> 
> 标签：objective-c, cocoa, networking, background-process

我需要一个后台进程每分钟左右运行一次。我不希望这个过程干扰应用程序其余部分的响应能力。这会是一个很好的线程候选人吗？如果是这样，你会建议我如何设置线程 - 特别是，哪些类/方法可以很好地研究？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T21:50:30.460

这听起来像是一个非常好的候选者`NSOperation`-`NSOperationQueue`将您的工作单元打包为一个操作，并在必要时将其启动。对于做“每分钟左右”一点，`NSTimer`是不足为奇的选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T21:53:33.947

这取决于后台进程的紧密程度。制作一个在后台运行的单独程序可能是一个更好的主意。

要开始使用，请查看 Apple 的[线程指南](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/Multithreading/Introduction/chapter_1_section_1.html)。

多线程编程不适合胆小的人，因此您需要确保了解其背后的想法和注意事项——并且可能首先尝试其他解决方案。如果这个“后台进程”不是很繁重，你几乎可以肯定只在主线程上使用一个计时器就可以了。如果它与您的应用程序的内部没有紧密联系，那么“工人”程序可能是一个好主意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T16:09:46.387

这实际上取决于后台进程在做什么，它需要访问哪些资源等等。如果您只想调用 someMethod: 每分钟然后使用 NSTimer。如果你真的需要像 NSOperationQueue 这样的东西，我建议你研究一下这个替代品，它解决了当前实现中的一些错误。

[http://www.mikeash.com/?page=pyblog/raoperationqueue-an-open-source-replacement-for-nsoperationqueue.html](http://www.mikeash.com/?page=pyblog/raoperationqueue-an-open-source-replacement-for-nsoperationqueue.html)

# ios - iPhone：用 UITextField 替换单元格的视图

> ID：579497
> 
> 赞同：0
> 
> 时间：2009-02-23T21:42:11.477
> 
> 标签：ios, objective-c, iphone, cocoa, cocoa-touch

我基本上是在尝试在 tableView:commitEditingStyle:forRowAtIndexPath: 上将 UITextField 添加到 UITableViewCell。在插入时，我想在现有单元格上添加一个 UITextField。

我用这样的东西设置了textField：

```
-(void) setUpIndexField {
    inputField = [[UITextField alloc] init];
    inputField.textAlignment = UITextAlignmentCenter;
    inputField.borderStyle = UITextBorderStyleRoundedRect;    
    inputField.keyboardType = UIKeyboardTypeNamePhonePad;
    inputField.delegate = self;
 } 
```

然后在 commitEditingStyle 中，我有一些东西，例如：

```
- (void)tableView:(UITableView *)tv
    commitEditingStyle:(UITableViewCellEditingStyle)editingStyle 
    forRowAtIndexPath:(NSIndexPath *)indexPath 
{
    NSInteger row = [indexPath row];
    if (editingStyle == UITableViewCellEditingStyleInsert) {
    if (row == 0) {
        UITableViewCell *cell = [tv cellForRowAtIndexPath:indexPath];
        inputField.frame = [tv cellForRowAtIndexPath:indexPath].frame;
        [cell.contentView addSubview:inputField];
        [inputField becomeFirstResponder];
        return;
    }
// more code etc.
} 
```

当我单击插入访问器 (+) 时，textField 确实会弹出到屏幕上，但在单击它的单元格附近没有。它进入 UIView 的随机部分，而不是单击 + 的 indexPath 的实际单元格。

深入了解我出错的地方以及如何将 UITextField 放置到单击 + 的单元格上是理想的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T21:50:56.557

您正在将框架设置为`inputField`不会执行您想要的操作的单元格的框架。单元格内的视图使用框架的左上角作为`0,0`. 您的文本框框架应该是：

```
inputField.frame = CGRectMake(0, 0, cell.frame.size.width, cell.frame.size.height); 
```

因为这是相对于它将放置文本字段的超级视图，所以它完全覆盖了该单元格中的其他视图。

# asp.net - ASP.NET Gridview 分页问题

> ID：579503
> 
> 赞同：2
> 
> 时间：2009-02-23T21:44:02.267
> 
> 标签：asp.net, gridview, custompaging

我有一个使用存储过程在代码隐藏中绑定数据的gridview。我也在代码中处理 Paging 事件，但是每当我单击页码时，我都会不断获取空数据模板而不是更多行。有什么建议么？

编辑：更改页面索引后，我正在重新绑定 gv 的数据源。

这是我的代码 - 我有一个下拉列表来确定数据源是什么：

```
Protected Sub ddlProjectForm_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles ddlProjectForm.SelectedIndexChanged
    Dim strProjectFormID As String = Me.ddlProjectForm.SelectedValue
    Dim conn As New SqlConnection(WebConfigurationManager.ConnectionStrings("Conn").ConnectionString)
    Dim cmd As New SqlCommand()
    Dim da As New SqlDataAdapter
    Dim ds As New DataSet

    If strProjectFormID <> "Select" Then
        Try
            Using conn
                conn.Open()

                With cmd
                    .Connection = conn
                    .CommandType = CommandType.StoredProcedure
                    .CommandText = "sp_GetAllFormData"
                    .Parameters.AddWithValue("@projectFormID", strProjectFormID)
                End With

                da.SelectCommand = cmd
                da.Fill(ds)

                Me.gvAllSentData.DataSource = ds.Tables(0)
                Me.gvAllSentData.DataBind()
                Me.gvAllSentData.Visible = True
            End Using
        Catch sqlEx As SqlException
            Dim newError As New ErrorLogger(Me.Page.Title, sqlEx.Message, Session("UserName"))
            newError.LogError()

            Trace.Write(sqlEx.Message)
            Me.lblBadFeedback.Visible = True
            Me.lblBadFeedback.Text = "We're sorry - an error has occurred.  It has been logged and will be reviewed by the site admin."
        Catch ex As Exception
            Dim newError As New ErrorLogger(Me.Page.Title, ex.Message, Session("UserName"))
            newError.LogError()

            Trace.Write(ex.Message)
            Me.lblBadFeedback.Visible = True
            Me.lblBadFeedback.Text = "We're sorry - an error has occurred.  It has been logged and will be reviewed by the site admin."
        End Try
    Else
        Me.gvAllSentData.DataSource = Nothing
        Me.gvAllSentData.Visible = False
    End If

End Sub

Protected Sub gvAllSentData_PageIndexChanging(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewPageEventArgs) Handles gvAllSentData.PageIndexChanging
    Me.gvAllSentData.PageIndex = e.NewPageIndex
    Me.gvAllSentData.DataBind()
End Sub 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T21:47:00.403

您正在重新绑定一个空数据源。您的代码应为：

```
Protected Sub gvAllSentData_PageIndexChanging(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewPageEventArgs) Handles gvAllSentData.PageIndexChanging
    Me.gvAllSentData.PageIndex = e.NewPageIndex
    Me.gvAllSentData.DataSource = __The_Data_To_Bind__
    Me.gvAllSentData.DataBind()
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T21:45:58.113

听起来很傻，你还记得再次调用你的数据绑定代码吗？当分页发生时，会进行回发，并且您的 GridView 的数据源会丢失，因此您需要再次重新绑定数据，以便 GridView 可以根据页面加载适当的数据。

我认为这是我写的第二个或第三个 ASP.NET 应用程序，然后我记得在编写代码时第一次重新数据绑定 8^D

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T21:49:39.510

这听起来确实像一个数据绑定问题。也许您的数据源在回发后是空的？

其他事件（如排序）是否有效？

你能在回发后单步执行代码的绑定部分并确认数据都在那里吗？

你有任何可以发布的代码吗？也许您应该创建一个测试工具，其中仅包含无法尝试跟踪问题的代码部分。

# python - 仅使用 Django 的 DB 部分

> ID：579511
> 
> 赞同：50
> 
> 时间：2009-02-23T21:45:54.777
> 
> 标签：python, django, orm

有人知道 Django 有多“模块化”吗？我可以只使用 ORM 部分来获取映射到数据库表并知道如何从这些表中读取/写入的类吗？

如果不是，您会推荐什么作为“Hibernate 的 Python 等价物”？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-02-25T00:01:21.137

如果你喜欢 Django 的 ORM，那么“独立”使用它非常简单；我已经[编写了几种在 Web 上下文之外使用 Django 部分的技术](http://www.b-list.org/weblog/2007/sep/22/standalone-django-scripts/)，您可以自由使用其中的任何一种（或自行使用）。

上面的 Shane 似乎对这一点和其他几点有点误解——例如，Django*可以*做多个不同的数据库，它只是不*默认*（你需要在使用其他东西的模型上做一个自定义管理器）比“主要”数据库，这不是太难，而且有一些食谱可供使用）。确实，Django 本身不进行连接管理/连接池，但我个人一直为此使用外部工具（例如，`pgpool`它比 ORM 内置的任何东西都更难）。

我建议花一些时间阅读并可能尝试一些可能的谷歌搜索（例如，我链接到你的帖子作为“独立 Django 脚本”的最高结果）来了解什么最适合你需求和品味——这可能是 Django 的 ORM 不适合你，如果不适合你就不应该使用它，但不幸的是，那里有很多错误的信息使事情变得混乱。

**编辑回应Shane：**

同样，您似乎被误导了：需要配置 SQLAlchemy（即，告诉要使用什么数据库，如何连接等），然后才能使用它运行查询，那么 Django 需要类似配置的事实如何（通过完成您选择的方法——您**不需要**完整的 Django 设置文件）有什么缺点吗？

至于多数据库支持，您似乎很困惑：支持水平很低。查询对象——不是`QuerySet`，而是它将执行的底层`Query`对象知道它正在连接的数据库，并接受数据库连接作为其初始化参数之一。告诉一个模型使用一个数据库，另一个模型使用另一个数据库就像在管理器上设置一种方法一样简单，该方法将正确的连接信息传递到`Query`. 诚然，没有更高级别的 API，但这与“不支持”不同，也与“需要自定义代码”不同（除非您认为在 SQLAlchemy 中显式配置多个数据库，如果您想要多个数据库，则需要DBs，也是“自定义代码”）。

至于你是否最终*间接*使用了不在的东西`django.db`，那么，那又怎样？就我个人而言，由于存在数据结构和其他代码位，而不仅仅是对 ORM 有用，所以`django.db`导入位的事实很好；`django.utils`如果某些东西具有外部依赖关系或使用标准 Python 库而不是 100% 自包含，那么人们不妨抱怨一下。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-23T22:00:22.493

简短的回答是：不，您不能将 Django ORM 与 Django 分开使用。

长答案是：是的，如果你愿意加载 Django 的大部分内容，你可以。例如，Django 使用的数据库连接在对 Django 的请求发生时打开。当发送信号时会发生这种情况，因此您可以表面上发送此信号以打开连接，而无需使用特定的请求机制。此外，您需要为 Django 项目设置各种应用程序和设置。

最终，它可能不值得你花时间。[SQL Alchemy](http://www.sqlalchemy.org/)是一个相对知名的 Python ORM，它实际上比 Django 更强大，因为它支持多个数据库连接和连接池以及其他好东西。

* * *

**编辑：**为了回应詹姆斯在其他地方的批评，我将澄清我在原始帖子中描述的内容。虽然很高兴有一位主要的 Django 贡献者把我叫出来，但我仍然认为我是对的 :)

首先，考虑将 Django 的 ORM 与任何其他部分分开使用需要做什么。您使用 James 描述的一种[方法](http://www.b-list.org/weblog/2007/sep/22/standalone-django-scripts/)来进行 Django 的基本设置。但是其中许多方法不允许使用该`syncdb`命令，而该命令是为您的模型创建表所必需的。为此需要一个 settings.py 文件，其中不仅包含 for 变量`DATABASE_*`，还`INSTALLED_APPLICATIONS`包含所有 models.py 文件的正确路径。

可以在没有 settings.py 的情况下使用自己的解决方案`syncdb`，但它需要一些 Django 的高级知识。当然，您不需要使用`syncdb`; 可以独立于模型创建表。但这是 ORM 的一个方面，除非您在设置上付出一些努力，否则它是不可用的。

其次，考虑如何使用标准`Model.objects.filter()`调用创建对数据库的查询。如果这是作为视图的一部分完成的，则非常简单：构造`QuerySet`并查看实例。例如：

```
tag_query = Tag.objects.filter( name='stackoverflow' )
if( tag_query.count() > 0 ):
    tag = tag_query[0]
    tag.name = 'stackoverflowed'
    tag.save() 
```

不错，简单干净。现在，没有 Django 的请求/响应链系统的拐杖，您需要初始化数据库连接，进行查询，然后关闭连接。所以上面的例子变成了：

```
from django.db import reset_queries, close_connection, _rollback_on_exception
reset_queries()
try:
    tag_query = Tag.objects.filter( name='stackoverflow' )
    if( tag_query.count() > 0 ):
        tag = tag_query[0]
        tag.name = 'stackoverflowed'
        tag.save()
except:
    _rollback_on_exception()
finally:
    close_connection() 
```

数据库连接管理也可以通过 Django 信号来完成。以上所有内容都在[django/db/ **init** .py](http://code.djangoproject.com/browser/django/trunk/django/db/__init__.py)中定义。其他 ORM 也有这种连接管理，但您不需要深入研究它们的源代码来了解如何做到这一点。SQL Alchemy 的连接管理系统记录在[教程](http://www.sqlalchemy.org/docs/05/ormtutorial.html)和其他地方。

最后，您需要记住，数据库连接对象始终是当前线程的本地对象，这可能会或可能不会根据您的要求限制您。如果您的应用程序不是无状态的，如 Django，而是持久的，您可能会遇到线程问题。

总之，这是一个见仁见智的问题。在我看来，Django 的 ORM 与框架分离的限制和所需的设置都太过分了。其他地方有完全可行的专用 ORM 解决方案，专为图书馆使用而设计。Django的不是。

不要认为以上所有的一切都表明我不喜欢 Django 以及它的所有工作原理，我真的非常喜欢 Django！但我对它的功能很现实，作为一个 ORM 库不是其中之一。

PS 多数据库连接支持正在[开发](http://code.djangoproject.com/ticket/1142)中。但它现在不存在。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-06-04T04:25:16.650

（我正在报告我的解决方案，因为我的问题说是重复的）

啊，好吧，我想通了，并将为任何尝试做同样事情的人发布解决方案。

此解决方案假定您要创建新模型。

首先创建一个新文件夹来存储您的文件。我们将其称为“独立”。在“standAlone”中，创建以下文件：

```
__init__.py
myScript.py
settings.py 
```

显然“myScript.py”可以随便命名。

接下来，为您的模型创建一个目录。

我们将模型目录命名为“myApp”，但要意识到这是项目中的普通 Django 应用程序，因此，请将其命名为您正在编写的模型集合。

在此目录中创建 2 个文件：

```
__init__.py
models.py 
```

您将需要来自现有 Django 项目的 manage.py 副本，或者您可以从 Django 安装路径中获取副本：

```
django\conf\project_template\manage.py 
```

将 manage.py 复制到您的 /standAlone 目录。好的，所以您现在应该具有以下结构：

```
\standAlone
    __init__.py
    myScript.py
    manage.py
    settings.py
\myApp
    __init__.py
    models.py 
```

**将以下内容添加到您的 myScript.py 文件中：**

```
# settings.py
from django.conf import settings

settings.configure(
    DATABASE_ENGINE    = "postgresql_psycopg2",
    DATABASE_NAME      = "myDatabase",
    DATABASE_USER      = "myUsername",
    DATABASE_PASSWORD  = "myPassword",
    DATABASE_HOST      = "localhost",
    DATABASE_PORT      = "5432",
    INSTALLED_APPS     = ("myApp")
)

from django.db import models
from myApp.models import * 
```

**并将其添加到您的 settings.py 文件中：**

```
 DATABASE_ENGINE    = "postgresql_psycopg2"
    DATABASE_NAME      = "myDatabase"
    DATABASE_USER      = "myUsername"
    DATABASE_PASSWORD  = "myPassword"
    DATABASE_HOST      = "localhost"
    DATABASE_PORT      = "5432",
    INSTALLED_APPS     = ("myApp") 
```

**最后是你的 myApp/models.py：**

```
# myApp/models.py
from django.db import models

class MyModel(models.Model):
     field = models.CharField(max_length=255) 
```

就是这样。现在让 Django 管理您的数据库，在命令提示符下导航到我们的 /standalone 目录并运行：

```
manage.py sql MyApp 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-23T21:51:51.843

您当然可以以独立的方式使用 Django 的各个部分。毕竟它只是 Python 模块的集合，您可以将其导入到您想使用它们的任何其他代码中。

如果您只关注 ORM 方面，我还建议您查看[SQL Alchemy 。](http://www.sqlalchemy.org/)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-01-07T09:28:37.973

我正在使用没有设置文件的 django ORM。就是这样：

在独立应用程序启动器文件中：

```
from django.conf import settings
from django.core.management import execute_from_command_line

#Django settings
settings.configure(DEBUG=False,
    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.sqlite3',
            'NAME': '/path/to/dbfile',
            'USER': '',
            'PASSWORD': '',
            'HOST': '',
            'PORT': '',
        }
    },
    INSTALLED_APPS = ('modelsapp',)
)

if not os.path.exists('/path/to/dbfile'):
    sync = ['manage.py', 'syncdb']
    execute_from_command_line(sync) 
```

现在您只需要一个`./modelsapp`包含 an`__init__.py`和 a的文件夹`models.py`。为简单起见，配置使用 sqlite，但它可以使用任何数据库后端。

文件夹结构：

```
./launcher.py
./modelsapp
    __init__.py
    models.py 
```

请注意，您不必拥有正确的 manage.py。`import execute_from_command_line`才发现。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2018-07-25T21:20:28.670

# 使用 Django 2.0 ORM - 需要一个文件

```
from myproject.config import parse_config
from django import setup as django_setup
from django.conf import settings as django_settings

"""
Requirements:
  ODBC Driver: https://www.microsoft.com/en-ca/download/details.aspx?id=36434
  Django Engine: https://pypi.org/project/django-pyodbc-azure/
"""

config = parse_config()
django_settings.configure(
    DEBUG=True,
    DATABASES={
        'default': {
            'ENGINE': 'sql_server.pyodbc',
            'NAME': config.database_name,
            'HOST': config.database_server,  # exclude '\\MSSQLSERVER'
            'USER': config.database_username,
            'PASSWORD': config.database_password,
            'PORT': '',
            'AUTOCOMMIT': False,
            'OPTIONS': {
                'driver': 'ODBC Driver 11 for SQL Server',
            },
        },
    })
django_setup()

from django.db import models

class Foo(models.Model):
    name = models.CharField(max_length=25)

    class Meta:
        app_label = 'myapp'  # each model will require this 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-23T21:52:36.087

我推荐[SQLAlchemy](http://sqlalchemy.org "SQL炼金术")。它应该做所有的 ORM 东西，以及基本的 SQL 东西。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-05-11T14:43:54.127

看看[django-standalone](http://pypi.python.org/pypi/django-standalone)，它使这个设置变得非常简单。

我还发现[这个博客条目](http://jystewart.net/2008/02/18/using-the-django-orm-as-a-standalone-component/)非常有用。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-03-20T21:09:57.477

这个例子很简单。我已经有一个名为 thab 的 django 应用程序正在运行。我想在独立的 python 脚本中使用 django orm，并使用与我用于 Web 编程的相同模型。这是一个例子：

```
# nothing in my sys.path contains my django project files
import sys
sys.path.append('c:\\apython\\thab')  # location of django app (module) called thab          where my settings.py and models.py is
# my settings.py file is actualy in c:\apython\thab\thab
from thab import settings as s  # need it because my database setting are there
dbs = s.DATABASES
from django.conf import settings
settings.configure(DATABASES=dbs) # configure can only be called once
from thab.models import *
boards = Board.objects.all()
print 'all boards:' + str(boards) # show all the boards in my board table 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-10-19T15:21:45.923

可能我的答案已经很晚了，但迟到总比没有好。

试试这个简单的包： [https ://github.com/serglopatin/django-models-standalone](https://github.com/serglopatin/django-models-standalone)

如何使用：

1.  下载

2.  安装

    ```
    python setup.py install 
    ```

3.  创建项目

    ```
    django-models-standalone startproject myproject 
    ```

4.  调整文件 settings.py (DATABASES) 和 models.py，如果没有创建表则迁移

5.  在您的应用程序中使用 djando 模型（example.py）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-02-19T06:33:55.270

```
import django
from django.conf import settings
from backend_mock.admin import settings as s
settings.configure(
    DATABASES=s.DATABASES,
    INSTALLED_APPS=('backend_mock.admin.mocker', )
)
django.setup() 
```

看看这个，它适用于 django 版本 gte 1.8.x

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-03-08T12:23:49.870

这就是在**Django > 1.4中对我有用的**

假设您的独立脚本是您的 django 项目 DIR。

只需将其复制到**conf.py**文件中（您可以给它起任何名称）。

```
import os
import sys
import django

BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.append(BASE_DIR) 
#sys.path.append('c:\\apython\\thab')
 # location of django app (module) called thab          where my settings.py and models.py is
# my settings.py file is actualy in c:\apython\thab\thab
from elsaserver import settings as s  # need it because my database setting are there
dbs = s.DATABASES
from django.conf import settings
settings.configure(
    DATABASES=dbs,
    INSTALLED_APPS=('core.apps.CoreConfig', )) #add all the apps you need here
django.setup() 
```

然后在你的 python 脚本中导入**conf.py。**

这是项目结构：

```
mydjangoproject
    |
    > app1
    > core
    > app2
    > standalone
    | | __init__.py  
    | | conf.py  
    | | myscript.py
    > manage.py 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-03-27T14:37:40.440

> 我可以只使用 ORM 部分来获取映射到数据库表并知道如何从这些表中读取/写入的类吗？

是的你可以。

这是关于如何使用 Django**模型和数据库抽象的****简洁**明了的解释：[https ://stackoverflow.com/a/49515366/2682613](https://stackoverflow.com/a/49515366/2682613)

 **Django 版本：**2.0.2**

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-08-25T00:48:23.290

我知道这篇文章很旧，但近年来我发现一个较小的解决方案效果很好：

```
import os, sys
import django

# sys.path.append('/abs/path/to/my-project/)
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'project.settings')
django.setup()

# Use
from myapp import models
kv = models.KeyValue() 
```

确保此脚本在适用的相对目录中运行，或应用 sys PATH 附加以确保解析模块。

希望能帮助到你。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-05-23T05:32:20.503

您可以在 django 项目之外使用它。但是有些事情你应该注意。

### 1\. 多数据库路由器。

路由器看起来像：

```
class Router(object):
    app_label = ''

    def db_for_read(self, model, **hints):
        if model._meta.app_label == self.app_label:
            return self.app_label
        return None

    def db_for_write(self, model, **hints):
        if model._meta.app_label == self.app_label:
            return self.app_label
        return None

    def allow_relation(self, obj1, obj2, **hints):
        if obj1._meta.app_label == self.app_label or obj2._meta.app_label == self.app_label:
           return True
        return None

    def allow_migrate(self, db, app_label, model=None, **hints):
        if app_label == self.app_label:
            return db == self.app_label
    return None 
```

您可以使用元类来动态创建路由器。

```
def add_db(db_conf):
    app_label = 'al_' + str(uuid4())

    settings.DATABASES[app_label] = db_conf

    router_class_name = 'Router' + app_label.capitalize()
    setattr(
        settings,
        router_class_name,
        type(router_class_name, (Router,), dict(app_label=app_label)),
    )
    settings.DATABASE_ROUTERS.append(
        '.'.join([settings.__name__, router_class_name])
    )
    connections.close_all()
return app_label 
```

## 2\. Django 设置。

最重要的关键是`TIME_ZONE`。`DatetimeField`并`DateField`与之相关。最简单的设置应该是：

```
SECRET_KEY = 'secret'
DATABASES = {'default': {}}
DATABASE_ROUTERS = []
TIME_ZONE = None 
```

### 3\. `close_old_connections`.

Django 框架默认在每个请求中间件中运行 close_old_connections 以避免“ [mysql has gone away](https://stackoverflow.com/questions/7942154/mysql-error-2006-mysql-server-has-gone-away) ”。

* * *

**PS**：我已经编写了使用 django orm 的包，而不是在经典的 django 项目中， https://github.com/jdxin0/django_db( [https://github.com/jdxin0/django_db)](https://github.com/jdxin0/django_db(https://github.com/jdxin0/django_db))。但是你应该始终注意上面的三个问题。我的包使用元类来解决多数据库，设置`TIME_ZONE=None`并留给`close_old_connections`用户。

# ruby-on-rails - Ruby on Rails 应用程序的最佳 Web 服务器是什么？

> ID：579515
> 
> 赞同：50
> 
> 时间：2009-02-23T21:46:57.707
> 
> 标签：ruby-on-rails, webserver

ruby on rails 应用程序的最佳 Web 服务器是什么？为什么？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2011-01-11T10:48:29.357

GitHub 和 37 Signals 都使用 nginx + unicorn。

[https://github.com/blog/517-unicorn](https://github.com/blog/517-unicorn)

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-02-23T21:51:20.723

在 Apache 上运行的[乘客。](http://www.modrails.com/)易于设置，内存使用率低，并且得到很好的支持。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-23T21:52:01.860

[乘客](http://www.modrails.com/)正在成为常态。它有更多的配置选项并且[速度更快](http://izumi.plan99.net/blog/index.php/2008/03/31/benchmark-passenger-mod_rails-vs-mongrel-vs-thin/)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-06-21T23:18:52.910

此外，对于开发人员非常快速/容易的事情，请尝试[http://pow.cx/](http://pow.cx/)

# asp.net-mvc - 如何在 asp.net mvc 应用程序中为一个控制器操作设置请求超时

> ID：579523
> 
> 赞同：104
> 
> 时间：2009-02-23T21:48:28.263
> 
> 标签：asp.net-mvc, asp.net-web-api

我想增加应用程序中特定控制器操作的请求超时。我知道我可以在整个应用程序的 web.config 中执行此操作，但我宁愿仅在这一操作上进行更改。

Web.config 示例：

```
<system.web>
  <httpRuntime executionTimeout="1000" /> 
</system.web> 
```

我该怎么做？

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2009-02-23T22:11:35.197

您可以在控制器中以编程方式设置：-

```
HttpContext.Current.Server.ScriptTimeout = 300; 
```

将超时设置为 5 分钟，而不是默认的 110 秒（这是什么奇怪的默认值？）

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2011-12-06T17:43:12.767

```
<location path="ControllerName/ActionName">
    <system.web>
        <httpRuntime executionTimeout="1000"/>
    </system.web>
</location> 
```

可能最好在 web.config 而不是控制器中设置这些值。可配置选项的硬编码被认为是有害的。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2015-05-19T16:49:45.247

我必须使用 .NET 4.5 添加“当前”：

```
HttpContext.Current.Server.ScriptTimeout = 300; 
```

# python - 如何编写从 python 到 ruby 的源代码转换器？

> ID：579524
> 
> 赞同：5
> 
> 时间：2009-02-23T21:48:29.170
> 
> 标签：python, ruby, converter

我的老师告诉我，如果我想在我们的编程课上取得最好的成绩，我应该编写一个简单的源代码转换器。

Python to Ruby（他说的最简单的）

现在我的问题是：编写一个简单的从 python 到 ruby​​ 的源代码转换器有多难。（它应该转换文件控制、控制语句等）

你对我有什么建议吗？

我应该使用哪种语言对转换器进行编码（C#、Python 或 Ruby）？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-23T21:52:37.067

我认为你的老师在撒谎——这很难。它相当于编写一个编译器/解释器。我不知道你有多少时间可以用于这个项目，但你通常会考虑几个人年的工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T22:10:00.193

将一种类型的代码转换为另一种类型的程序有一个名称。它被称为编译器（即使目标语言实际上不是机器码或字节码）。

编译器不是计算机科学中最简单的部分，如果它不仅仅是一个转换器的玩具实现，那么这个项目将是一个庞大的项目。肯定比大多数大学课程中通常为课堂项目所做的要大。（即使是许多/大多数编译器课程也有相当少的项目分配。

至于使用什么语言？好吧，无论您最了解哪一个，都可能是答案。虽然如果你想学习一些新东西，Haskell 将是一个不错的选择，它具有模式匹配功能。（免责声明：我是 haskell 的新手。）（如果您真的很想进入编译器，也可以使用 Yacc。）

您还需要查阅：[The Dragon Compiler Book](https://rads.stackoverflow.com/amzn/click/com/0321486811)，即使您不打算编写编译器，也值得学习。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T21:51:58.897

就像想出足够聪明的正则表达式来正确转换语法一样简单。
Ruby 和 python 的语法非常接近，所以这不是很难。
你可能需要做一些额外的工作来重写你在 python 中的东西，这些东西在 ruby​​ 中不存在，例如列表理解。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T21:52:02.903

第一个简单可能意味着它不处理 Python 的所有有效语义，而只处理其中的一个子集。

我会得到的第一件事是龙书的副本，你可以在任何大学图书馆找到它。我要做的第二件事是获取 Python 的语法和语义的副本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T21:52:16.773

语言应该无关紧要。选择你最喜欢使用弦乐的那个。

明智的提示我会为关键字使用字典/查找数组。最困难的部分将是处理 python 中的空白

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T22:10:25.747

听起来你的老师有点恶作剧！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T22:19:49.343

最难的部分是保留语义。

比如你在使用 Ruby 时如何处理**元类**分配、函数装饰器或基于产量的生成器？我没有 Ruby 经验，所以我不知道直接支持什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T22:21:04.723

[在Brainf***](http://en.wikipedia.org/wiki/Brainfuck)和 C之间编写一个转换器相当简单。我确信这远低于你需要做的范围（我猜是关于解析上下文无关语法的教学），但会真的很容易做到。

# asp.net - 通过 href 导航到 pdf 后清除浏览器历史记录

> ID：579526
> 
> 赞同：0
> 
> 时间：2009-02-23T21:48:56.750
> 
> 标签：asp.net, vb.net, virtual-directory, browser-history

好的，希望我以您可以理解的方式表达了这一点。首先我会说我的网站有一个登录页面[http://www.mywebsite.com/PageOne.aspx](http://www.mywebsite.com/PageOne.aspx)

在 PageOne.aspx 上，我有一个指向另一个页面的链接：[http ://www.mywebsite.com/PageTwo.aspx](http://www.mywebsite.com/PageTwo.aspx)

在 PageTwo.aspx 上，我有一个指向以下内容的链接：

```
<a href="http://www.mywebsite.com/MyFiles/testfile.pdf">Attachment</a> 
```

/MyFiles/ 目录实际上是一个虚拟目录，它指向保存许多其他文件（PDF、jpeg、doc 等）的文件服务器。

当我从 PageOne.aspx 导航到 PageTwo.aspx 时，我可以单击“返回”并且仍然可以访问 PageOne.aspx（我的浏览器历史记录是正常的）。当我单击 PageTwo.aspx 上的链接时，PDF 在同一个窗口中打开……然后我可以单击“返回”返回 PageTwo.aspx，但我无法再次单击“返回”返回 PageOne .aspx（似乎我的浏览器历史记录减少了一页）。

有谁知道为什么会发生这种情况？我只能想象这是因为虚拟目录而发生的，因为如果 PDF 与我的 .aspx 页面位于同一台服务器上，我就无法复制这个问题。如果是这种情况，有谁知道如何解决这个问题，并且我的 PDF 仍然驻留在文件服务器（虚拟目录）上？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-25T19:24:41.777

我发现了问题所在。我正在链接到单独服务器上的文件只是一个巧合。真正的问题是链接到它的页面 (PageTwo.aspx) 具有非常大的文件大小，因此清除了历史记录以腾出空间。我禁用了页面上的视图状态并简化了我的一些 html，现在它之前的页面仍在历史记录中。

我不确定为历史分配了多少内存，但我所做的足以让它工作。

# .net - .NET - 将颜色名称字符串转换为 System.Drawing.Color

> ID：579528
> 
> 赞同：15
> 
> 时间：2009-02-23T21:49:18.370
> 
> 标签：.net, colors, system.drawing.color

将“red”、“green”、“yellow”、“aliceblue”等字符串转换为实际 System.Drawing.Color 值的最佳方法是什么？

我在看反射，但似乎有些不对劲。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-23T21:54:34.397

您可以使用 Color.FromName()

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-23T21:53:02.620

System.Drawing.Color 有一个静态方法：

```
public static Color FromName(string name) 
```

像这样使用它：

```
 Color c = Color.FromName("AliceBlue") 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-23T21:51:53.777

System.Drawing.Color.FromName("红色");

# ios - 性能：在 UIView 中的 UIView 还是替换 UIView？

> ID：579531
> 
> 赞同：2
> 
> 时间：2009-02-23T21:49:47.793
> 
> 标签：ios, objective-c, iphone, cocoa-touch

我想让一个主 UIView 负责将多个 UIView 之一添加为子视图。由于任何时候只有一个子视图处于活动状态，并且子视图完全覆盖了主视图，所以我还不如更换主视图。但这需要一些努力，而且我不确定这是否值得在性能上获得小小的收益。我会看到任何不同吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T22:20:13.740

它们是全屏视图吗？如果是这样，那么你可以`UIViewController`用来做管理。

# ruby-on-rails - 如何让 Rails 使用 mysql 中的 LONGBLOB 列？

> ID：579536
> 
> 赞同：10
> 
> 时间：2009-02-23T21:51:41.610
> 
> 标签：ruby-on-rails

我正在尝试编写将 LONGBLOB 列添加到 MySQL 数据库中的表的迁移。我想使用 LONGBLOB 而不是 BLOB 以便我可以在二进制列中存储更多数据。问题是即使我指定了更大的大小，它也会添加一个 BLOB 列。

这是我用来添加列的行：

```
add_column :db_files, :data, :binary, :null => false, :size => 1.megabyte 
```

我做错了吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-23T22:23:41.550

下面将创建一个 MEDIUMBLOB 字段。使用 16.megabyte 转至 LONGBLOB。

```
def self.up
  create_table "blob_test", :force => true do |t|
    t.column :data, :binary, :limit => 10.megabyte
  end
end 
```

* * *

## 回答 #2

> 赞同：-4
> 
> 时间：2013-10-05T11:27:53.860

类 Migration_create_technologe 扩展 CI_Migration {

```
public function up()
{
    $this->dbforge->add_field(array(
        'id' => array(
            'type' => 'INT',
            'constraint' => 11,
            'unsigned' => TRUE,
            'auto_increment' => TRUE
        ),
        'title' => array(
            'type' => 'VARCHAR',
            'constraint' => '100',
            'collation' => 'utf8_unicode_ci',
        ),
        'writer' => array(
            'type' => 'VARCHAR',
            'constraint' => '100',
            'collation' => 'utf8_unicode_ci',
        ),
        'created' => array(
            'type' => 'datetime',
             'default'=> '0000-00-00 00:00:00',
            'collation' => 'utf8_unicode_ci',
            ),                           
    ));
    $this->dbforge->add_key('id',TRUE);
   $this->dbforge->add_field("body longblob NOT NULL ");
    $this->dbforge->create_table('technologe');
}

public function down()
{
    $this->dbforge->drop_table('technologe');
}
} 
```

# java - 用于在“可搜索 pdf”中提取文本边界的工具包和方法

> ID：579552
> 
> 赞同：0
> 
> 时间：2009-02-23T21:53:11.543
> 
> 标签：java, pdf

我有一个“可搜索的 pdf”又名“带有不可见但可选择文本的图像文件”。（当此文件在 Acrobat 中打开时，我收到警告“您正在以 PDF/A 模式查看此文档。”）

我需要提取此文档中每个单词的边界矩形。任何建议的工具包和访问“invisi-text”单词边界框的方法？

我更喜欢java中的工具，但感谢任何建议。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-24T08:44:26.317

查看 iText 库：[http ://www.lowagie.com/iText/](http://www.lowagie.com/iText/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T14:33:05.323

Acrobat 的 javascript 库看起来是最直接的，尤其是：

```
getPageNthWordQuads 
```

它适用于“可搜索的pdf”。

如果 acrobat javascript 库可作为 java 调用使用，那就太好了...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T09:02:02.763

PdfBox 和 JPedal 也提供文本提取方法。

# c++ - sys/_types.h 中的 cygwin 编译错误

> ID：579556
> 
> 赞同：0
> 
> 时间：2009-02-23T21:54:16.487
> 
> 标签：c++, cygwin

我正在尝试使用 cywin 在 win32 机器上构建一些 linux 代码。

我在 ym 编译器中收到以下 VS.net 2003 错误：

“c:\cygwin\usr\include\sys_types.h(15): 错误 C2144: 语法错误: '__int64' 应该以 ';' 开头 "

和

c:\cygwin\usr\include\sys_types.h(15)：错误 C2501：“**扩展**”：缺少存储类或类型说明符

代码行是

```
__extension__ typedef long long _off64_t; 
```

显然我在这里遗漏了一些东西，但我以前从未使用过 cygwin，这让我很生气。

出于几个原因，我希望至少能够在我的 win32 机器上编译我的 CPP 文件。

（这只是数百个错误中的前两个错误）

谢谢，蒂姆

编辑：

我选择的简单解决方法作为答案 - 虽然我确实理解它不像使用 gcc 编译那样完整或可取......这是一个快速而肮脏的编译，因此我可以在尝试与集成之前使用我熟悉的工具linux机器。（哦跨平台开发的乐趣）

到目前为止，我已经对这些答案中的每一个都投了赞成票，并感谢您的帮助）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T22:02:29.290

我可能是错的，但是 cygwin 头文件可以专门用于使用 cygwin gcc 而不是 Visual Studio 进行编译。尝试在 cygwin 中使用 gcc/g++ 进行编译。

编辑：我可能可以使用 Visual Studio，这个页面（对于另一个项目）似乎暗示你可以用 vc++/cygwin 编译一些东西。[http://opensg.vrsource.org/trac/wiki/BuildVS2005Cygwin](http://opensg.vrsource.org/trac/wiki/BuildVS2005Cygwin)。

你可能想检查一下。

EDIT2：另见： http: [//www.coin-or.org/OS/documentation/node14.html](http://www.coin-or.org/OS/documentation/node14.html)

EDIT3：我想最好的粗略行动是确保Visual Studio首先搜索标准Windows路径。因此，如果有一个 system `<sys/types.h>`，那可能比 cygwin 版本更受欢迎。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T22:04:35.167

`__extension__`关键字是一个 gcc 扩展，表示使用 gcc 扩展的代码（在本例中）`long long`，因此它不会在迂腐模式下崩溃。如果可以，请尝试使用 gcc 编译代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T22:20:22.557

在 C++ 中，任何前面（或包含）双下划线的名称都是为特定实现保留的名称，在这种情况下是 GNU C++。MS C++ 将使用其他名称。底线 - 如果源使用此类名称，则不能使用 MS C++ 编译 g++ 源，反之亦然。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T22:00:55.723

我认为**扩展**宏可能没有定义。您可能想在 cygwin 标头目录上进行文本搜索，看看是否是这种情况。如果是这样，请确保正确定义了标题搜索路径等。

# asp.net - 将图像数据从 ASP.NET 下载到 iphone 的最佳方法是什么？

> ID：579564
> 
> 赞同：2
> 
> 时间：2009-02-23T21:59:46.100
> 
> 标签：asp.net, iphone, encoding, binary

我正在构建一个 iphone 应用程序，该应用程序需要从 ASP.NET Web 应用程序（作为根据属性列表架构或自身格式化的 XML 文档的一部分）下载图像到 (NSData *) 对象中。

我应该在服务器端使用什么编码器来为 iphone 生成兼容的 XML？像 Base64 一样简单吗？BigEndian 与 LittleEndian 的问题呢？

谢谢，-先生

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T22:10:23.873

XML 的字节序是由文档的文本编码定义的。因此，只要您在两边都使用标准编码（例如，UTF-8 或 UTF-8），它实际上应该像在图像的二进制数据上使用 Convert.ToBase64String 一样简单。

# php - 更改 PHP 中包含内容的相对链接路径

> ID：579565
> 
> 赞同：1
> 
> 时间：2009-02-23T22:00:17.987
> 
> 标签：php, url, include, relative-path

我的服务器根目录有一个 PHP 文件.. **index.php** ..[`include`](http://www.php.net/include/)是 .. DIR/ **main.php**

现在 .. DIR/ **main.php** .. 有很多附近文件的相对链接。

所有相关链接都已断开。

* * *

有什么办法可以更改**链接的相对 URL 基本路径？**

...因此 DIR/ **main.php的包含内容将其所有指向****friend1.php**的链接都更改为**DIR/friend1.php**。

* * *

编辑：这不是关于包含的，这是关于整体更改 ahref 链接的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T22:19:02.997

假设 main.php 是 HTML 和 PHP 的混合体，那么当您输出链接时，您需要包含一个前缀：

```
<a href="<?php echo $web_root; ?>relative/path/">relative link</a> 
```

其中 $web_root 是您的根路径 ('DIR')。在单独的包含文件中定义它可能是一个好主意，因此您只需为所有脚本定义一次。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T22:49:46.337

html 中的**基本**标记适用于相对链接。有关如何使用它的示例，请参阅[w3schools 。](http://www.w3schools.com/TAGS/tag_base.asp)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T22:15:49.510

图片不太清楚，但您可能可以重新排列一些文件并使用符号链接来解决问题。

对于您的示例，您可以创建一个指向 /friend1.php 的符号链接 DIR/friend1.php，但您必须对所有文件执行此操作，或者只是移动它们。

# vb.net - VB.NET 不断向文本框添加一个

> ID：579576
> 
> 赞同：0
> 
> 时间：2009-02-23T22:04:33.140
> 
> 标签：vb.net, exception, overloading

我正在尝试创建一个具有按钮和文本框的程序。每次按下按钮时，我都希望它在文本框中添加一个。我不断收到此错误：

> 重载解决失败，因为没有可访问的“Int”接受此数量的参数

我也是一个巨大的n00b。这是我到目前为止的位置，在此先感谢。

```
Option Strict On

Public Class Form1

  Private Sub btnPlus_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPlus.Click
    Dim i As Integer = Int.Parse(txtAdd.Text)
    i += 1
    txtAdd.Text = i.ToString()
  End Sub
End Class 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T22:07:48.780

```
Dim i As Integer = Int32.Parse(txtAdd.Text) 
```

或者

```
Dim i As Integer = Integer.Parse(txtAdd.Text) 
```

没有名为“Int”的类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T22:09:59.727

看起来你打算这样做： `Integer.Parse(txtAdd.Text)`

另外，我建议制作`Integer i`Form1 的成员变量（字段）。这样你就不必将它从字符串解析为整数。

```
Public Class Form1

    Dim i As Integer

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        i += 1
        Me.TextBox1.Text = i.ToString()
    End Sub
End Class 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T22:12:48.470

使用 TryParse 方法将意味着如果输入无法解析为整数，则代码不会抛出 Format 异常

```
Private Sub btnPlus_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

    Dim i as Integer
    If Integer.TryParse(txtAdd.Text, i) Then
        i += 1
        txtAdd.Text = i.ToString()
    End If

End Sub 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T22:08:29.120

尝试调用 Convert.ToInt32(txtAdd.Text)

```
Dim i As Integer = Convert.ToInt32(txtAdd.Text) 
```

# actionscript-3 - AS3中任意数量的参数

> ID：579579
> 
> 赞同：6
> 
> 时间：2009-02-23T22:05:06.570
> 
> 标签：actionscript-3, actionscript, parameters

ActionScript 3.0 是否提供任何方法来接受任意数量的参数？我通常使用 .NET，但我被迫将 AS3 用于项目，并且类似于函数 blah(params double[] x) 的东西对于辅助库来说会很棒。

谢谢;

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-23T22:14:09.077

查看其余参数： http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/statements.html#..._(rest) [_parameter](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/statements.html#..._(rest)_parameter)

```
package {
  import flash.display.MovieClip;

  public class RestParamExample extends MovieClip {
    public function RestParamExample() {
        traceParams(100, 130, "two"); // 100,130,two
        trace(average(4, 7, 13));     // 8
    }
  }
}

function traceParams(... rest) {
 trace(rest);
}

function average(... args) : Number{
  var sum:Number = 0;
  for (var i:uint = 0; i < args.length; i++) {
    sum += args[i];
  }
  return (sum / args.length);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T22:16:03.440

试试椭圆（如 C）...

```
function trace_all (... args): void {
    for each (a in args) {
       trace (a);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-24T19:05:20.660

除了“ [rest](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/statements.html#..._(rest)_parameter) ”参数之外，还有一个“ [arguments](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/arguments.html) ”对象。

```
function foo() {
    for (var i:Number = 0; i < arguments.length; i++) {
        trace(arguments[i]);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T22:19:44.320

如果您想传递不确定数量的有序值，只需传递一个数组

```
function foobar(values:Array):void
{
    ...
}

foobat([1.0, 3.4, 4.5]);
foobat([34.6, 52.3, 434.5, 3344.5, 3562.435, 1, 1, 2, 5]); 
```

如果要传递命名参数，其中仅传递其中一些参数，则使用对象

```
 function woof(params:object):string
   {
       if (params.hasProperty('name')) {
           return name + "xxx";
       }
       ...
   }

   woof({name:'Joe Blow', count: 123, title: 'Mr. Wonderful'}); 
```

# emacs - XEmacs 缓冲区选项卡不显示所有缓冲区

> ID：579582
> 
> 赞同：2
> 
> 时间：2009-02-23T22:06:24.570
> 
> 标签：emacs, xemacs

我正在使用 xemacs 进行编辑。xemacs 在编辑窗口的顶部显示缓冲区选项卡。但是，我的缓冲区选项卡有这种奇怪的行为。

当我切换到 cpp 文件时，缓冲区选项卡仅显示打开的 cpp 缓冲区。当我切换到 ah 文件（使用 Cx b）时，只显示 h 文件。

如何让 xemacs 始终在缓冲区选项卡中显示所有打开的缓冲区？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T07:45:51.480

我不确定 xemacs，但是对于 emacs，选项卡由选项卡模式显示。

默认情况下，tabbar-mode 按主要模式对缓冲区进行分组，因此在您的选项卡中，您只能看到一组相同模式的选项卡。

您可以自定义它，就像他们在这里说的：[http ://www.emacswiki.org/emacs/TabBarMode](http://www.emacswiki.org/emacs/TabBarMode)

```
(setq tabbar-buffer-groups-function
      (lambda ()
        (list "All"))) ;; code by Peter Barabas 
```

此外，还有用于在选项卡中切换模式的按键（ Mx tabbar-forward-group，Mx tabbar-backward-group）。

希望有帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-04T19:57:26.920

您想对缓冲区选项卡进行自定义。您可以通过执行*Mx customize*来获得它，然后执行*buffers-tab*。“过滤器函数”有一个选项，默认为“select-buffers-tab-buffers-by-mode”，我猜这就是你想要改变的。如果没有，您一定会在该页面的某处找到解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-31T01:37:17.793

XEmacs 中的缓冲区选项卡具有自动过滤设置以显示类似文件扩展名的组。我相信您还可以过滤其他关于缓冲区列表中缓冲区的可发现属性。

当您在小型显示器上打开许多文件时，它很有用，但在其他时候会妨碍您，因此您可以通过以下方式设置过滤，这是 XEmacs 手册的摘录：

`buffers-tab-filter-functions'. Setting this variable to`“可以通过自定义所有缓冲区的 nil 强制显示来更改此行为 ，直到`buffers-tab-max-size' (also customizable). More complex behavior may be available in 3rd party libraries. These, and some more rarely customized options, are in the` buffers-tab 的自定义组。”

# silverlight - XAML 中的 Silverlight 控件在运行时为空

> ID：579588
> 
> 赞同：0
> 
> 时间：2009-02-23T22:09:06.357
> 
> 标签：silverlight, initialization, nullreferenceexception

我创建了一个带有 DeepEarth 地图控件的 silverlight 应用程序。这是我的基本 XAML

```
<Grid x:Name="LayoutRoot" >
    <!-- Map Control -->
    <DeepEarth:Map x:Name="map" Margin="0,0,0,0">
        <Controls:CoordControl VerticalAlignment="Bottom" HorizontalAlignment="Right" />
        <Controls:ScaleControl VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="12,12,12,40" />
    </DeepEarth:Map>
    <Controls:NavControl x:Name="navControl" >
        <StackPanel Orientation="Horizontal">
            <Button x:Name="MyButton" Content="Hi" Click="MyButton_Click"></Button>
        </StackPanel>
    </Controls:NavControl>
</Grid> 
```

我有一个我创建的行为类，我想将它附加到按钮上

```
public Page()
{
    InitializeComponent();
    new ButtonActionWithCancel(MyButton, new CreatePointCommand(map));
}
void MyButton_Click(object sender, RoutedEventArgs e)
{
    if (MyButton == null) throw new Exception("Wat?");
} 
```

这是为了对 MyButton 做一些事情，连接一些事件和东西。问题是 MyButton 在运行时为空。怎么会？层次结构中的其他控件不为空。这是怎么回事？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-05T11:47:40.340

当我离开测试版时它就停止了

# c# - 继承流；在 Read() 中缓冲

> ID：579593
> 
> 赞同：3
> 
> 时间：2009-02-23T22:10:13.517
> 
> 标签：c#, stream, buffer

我继承了 Stream 类，其中我不知道如何正确实现 Read() 函数，所以我最终不会有很多嵌套的 if 和难以调试的代码。关键是从该流的源读取返回恒定大小的缓冲区（例如不可更改），但 Read() 函数接受不同的缓冲区大小。我虽然想添加 BufferedStream，但我认为这是个坏主意。感谢帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T22:49:11.177

内部源返回固定大小的缓冲区？如果是这种情况，那并不是完全`BufferedStream`可以做的——这只是减少了对物理流的调用次数。您需要一个单独的缓存机制 - 您填充和清空的 MemoryStream 将是一个合理的选择。例如（完全未经测试）：

```
MemoryStream localBuffer = new MemoryStream();
bool ReadNextChunk()
{
    // clear
    localBuffer.Position = 0;
    localBuffer.SetLength(0);
    // get data
    byte[] chunk = null; // TODO - read from source
    if(chunk == null || chunk.Length == 0) return false; // EOF
    localBuffer.Write(chunk, 0, chunk.Length);
    localBuffer.Position = 0;
    return true;
}
public override int Read(byte[] buffer, int offset, int count)
{
    int bytes;
    if ((bytes = localBuffer.Read(buffer, offset, count)) > 0) return bytes;
    if (!ReadNextChunk()) return 0;
    return localBuffer.Read(buffer, offset, count);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T22:50:15.603

这是您的“10 人入门”（不确定是否在全球范围内翻译）。

```
byte[] myBuffer = new byte[fixedSize];
int myBufferPos = fixedSize;

public int Read(byte[] buffer, int offset, int count)
{
    int copiedCount = 0
    while (copiedCount < count)
    {
        if (myBufferPos >= fixedSize)
        {
            //Read new fixed buffer into myBuffer
            // use break on no more buffer.
            myBufferPos = 0;
        }

        int bytesToCopy = fixedSize - myBufferPos;
        if (bytesToCopy > count - copiedCount)
            byteToCopy = count - copiedCount;

        Array.Copy(myBuffer, myBufferPos, buffer, offset, byteToCopy);

        offset += bytesToCopy;
        myBufferPos += bytesToCopy;
        copiedCount += bytesToCopy;
    }

    return copiedCount;
} 
```

未经测试，所以可能有一些错误。不清楚您的源流的长度是否是其固定大小的精确倍数。如果不是，那么最终的部分缓冲区需要一些额外的逻辑。

基本原则是保持您自己的固定大小的缓冲区，并跟踪该缓冲区中到目前为止被读取消耗的位置

# asp.net - 如何确定 JavaScript 中 RadioButtonList 的 SelectedValue？

> ID：579597
> 
> 赞同：16
> 
> 时间：2009-02-23T22:10:52.843
> 
> 标签：asp.net, javascript, radio-button

我有一个带有数据绑定 RadioButtonList 的 ASP.NET 网页。我不知道在设计时会渲染多少单选按钮。我需要通过 JavaScript 确定客户端上的 SelectedValue。我没有太多运气尝试了以下方法：

```
var reasonCode = document.getElementById("RadioButtonList1");
var answer = reasonCode.SelectedValue; 
```

（“答案”被返回为“未定义”）请原谅我对 JavaScript 的无知，但我做错了什么？

提前致谢。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-23T22:35:53.923

ASP.NET 围绕实际的无线电输入呈现一个表格和一堆其他标记。以下应该有效： -

```
 var list = document.getElementById("radios"); //Client ID of the radiolist
 var inputs = list.getElementsByTagName("input");
 var selected;
 for (var i = 0; i < inputs.length; i++) {
      if (inputs[i].checked) {
          selected = inputs[i];
          break;
       }
  }
  if (selected) {
       alert(selected.value);
  } 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-12-18T10:22:02.963

试试这个从 RadioButtonList 中获取选定的值。

```
var selectedvalue = $('#<%= yourRadioButtonList.ClientID %> input:checked').val() 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T22:19:30.827

我总是查看源代码。您会发现每个单选按钮项都有一个唯一的 id，您可以使用并遍历它们以确定哪个是 Checked。

编辑：找到一个例子。我有一个单选按钮列表 rbSearch。这是在一个名为 ReportFilter 的 ascx 中。在查看源代码中我看到

```
ReportFilter1_rbSearch_0
ReportFilter1_rbSearch_1
ReportFilter1_rbSearch_2 
```

因此，您可以循环遍历 document.getElementById("ReportFilter1_rbSearch_" + idx ) 或使用 switch 语句，看看哪个具有 .checked = true。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T22:13:44.957

`RadioButtonList`是一个 ASP.NET 服务器控件。这会将 HTML 呈现给包含您尝试使用 JavaScript 操作的单选按钮的浏览器。

我建议使用[IE Developer Toolbar](http://www.microsoft.com/en-us/download/details.aspx?id=18359)（如果您更喜欢 Internet Explorer）或[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)（如果您更喜欢 FireFox）来检查 HTML 输出并找到要在 JavaScript 中操作的单选按钮的 ID。

然后您可以使用`document.getElementByID("radioButtonID").checked`from JavaScript 来确定单选按钮是否被选中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T22:43:30.003

与 ASP.NET RadioButtonList 等效的 HTML 是一组具有相同名称的 <input type="radio"> 属性（基于 RadioButtonList 的 ID 属性）。

您可以使用 getElementsByName 访问这组单选按钮。这是单选按钮的集合，可通过其索引访问。

```
alert( document.getElementsByName('RadioButtonList1') [0].checked ); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-07T10:18:12.747

对于只有 2 个值“是”和“否”的“RadioButtonList”，我这样做了：

```
var chkval=document.getElemenById("rdnPosition_0") 
```

这里 rdnposition_0 指的是 yes 的 id `ListItem`。我通过查看表单的源代码得到它。

然后我做了 chkval.checked 以了解是否检查了值“是”。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-22T08:34:59.220

```
function CheckRadioListSelectedItem(name) {

    var radioButtons = document.getElementsByName(name);
    var Cells = radioButtons[0].cells.length;

    for (var x = 0; x < Cells; x++) {
        if (document.getElementsByName(name + '_' + x)[0].checked) {
            return x;
        }
    }

    return -1;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-02-28T10:11:14.980

我想为这个问题添加最直接的解决方案：

```
var reasons= document.getElementsByName("<%=RadioButtonList1.UniqueID%>");
var answer;
for (var j = 0; j < reasons.length; j++) {
    if (reason[j].checked) {
        answer = reason[j].value;
    }
} 
```

UniqueID 是为您提供控件内输入名称的属性，因此您可以非常轻松地检查它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T22:13:54.163

```
reasonCode.options[reasonCode.selectedIndex].value 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-10-04T01:23:27.657

我已经尝试了各种方法来确定 Javascript 中的 RadioButtonList 的 SelectedValue，但没有任何乐趣。然后我查看了网页的 HTML，发现 ASP.NET 将 RadioButtonList 控件作为单列 HTML 表格呈现给网页！

```
<table id="rdolst" border="0">
  <tr>
    <td><input id="rdolst_0" type="radio" name="rdolst" value="Option 1" /><label for="rdolst_0">Option 1</label></td>
  </tr>
  <tr>
    <td><input id="rdolst_1" type="radio" name="rdolst" value="Option 2" /><label for="rdolst_1">Option 2</label></td>
  </tr>
</table> 
```

要通过 Javascript 访问 RadioButtonList 上的单个 ListItem，您需要在相关行的单元格的子控件（在 Javascript 中称为节点）中引用它。每个 ListItem 都呈现为其行上第一个（零）单元格中的第一个（零）元素。

此示例循环遍历 RadioButtonList 以显示 SelectedValue：

```
var pos, rdolst;

for (pos = 0; pos < rdolst.rows.length; pos++) {
    if (rdolst.rows[pos].cells[0].childNodes[0].checked) {
        alert(rdolst.rows[pos].cells[0].childNodes[0].value);
        //^ Returns value of selected RadioButton
    }
} 
```

要选择 RadioButtonList 中的最后一项，您可以这样做：

```
rdolst.rows[rdolst.rows.length - 1].cells[0].childNodes[0].checked = true; 
```

因此，在 Javascript 中与 RadioButtonList 交互非常类似于使用常规表格。就像我说的那样，我已经尝试了大多数其他解决方案，但这是唯一适合我的解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-09-07T18:50:30.267

我只想在 is 时执行`ShowShouldWait`脚本。在脚本结束时，返回 b 的值以防止事件在它无效的情况下发生。`Page_ClientValidate``true``postback`

如果有人好奇，如果选择的输出类型是“HTML”而不是“CSV” ，则`ShouldShowWait`调用仅显示“请稍候”。`div`

```
onclientclick="var isGood = Page_ClientValidate('vgTrxByCustomerNumber');if(isGood){ShouldShowWait('optTrxByCustomer');} return isGood" 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-02-28T07:19:58.137

要检查 JavaScript 中下拉列表的选定索引：

```
function SaveQuestion() {
    var ddlQues = document.getElementById("<%= ddlQuestion.ClientID %>");
    var ddlSubQues = document.getElementById("<%=ddlSecondaryQuestion.ClientID%>");

    if (ddlQues.value != "" && ddlSubQues.value != "") {
        if (ddlQues.options[ddlQues.selectedIndex].index != 0 ||
            ddlSubQues.options[ddlSubQues.selectedIndex].index != 0) {
            return true;
        } else {
            return false;
        }
    } else {
        alert("Please select the Question or Sub Question.");
        return false;
    }
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-02-23T22:24:06.057

从[这里](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.radiobuttonlist.aspx)：

```
if (RadioButtonList1.SelectedIndex > -1) 
{
    Label1.Text = "You selected: " + RadioButtonList1.SelectedItem.Text;
} 
```

# asp.net-mvc - 将依赖项注入自定义 ModelBinder

> ID：579598
> 
> 赞同：4
> 
> 时间：2009-02-23T22:10:54.840
> 
> 标签：asp.net-mvc, binding, inversion-of-control

我目前有一个 ASP.net MVC 项目正在进行中，我想知道以下是否可能：我有一个自定义 ModelBinder 类，它具有对服务（本质上是 fetcher）的引用作为依赖项。我希望使用 IoC 容器（当前为 Ninject）注入依赖项，但在方法链中似乎没有任何地方可以插入一些东西，说从我的 IoC 容器加载模型绑定器。

我的第一个想法是拥有一个通用对象绑定器，然后尝试从容器中检索特定的 ModelBinder，如果找不到则返回 null，然后将其设置为绑定器，即类似于：ModelBinders.Binders.Add(typeof(object ),typeof(NinjectModelBinder));

但我不确定

*   a）如果这行得通
*   b) 如果这真的是正确的做法

我可以放弃对复杂对象的解析，直到使用 Action 方法，但是能够提供复杂对象（本质上是从数据访问层加载和构建的）作为操作的参数会更清晰，更可取。

任何想法/帮助表示赞赏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-24T11:26:15.757

我认为您将不得不在模型绑定器中进行服务定位器调用，或者构建模型绑定器，或者两者兼而有之。

```
 ModelBinders.Binders.Add(typeof(Customer), Resolve<CustomerBinder>()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T03:12:26.427

我个人在与您类似的场景中使用 setter 注入。查了一下，NInject 调用了这个属性注入。它可以工作并完成工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-02T16:32:49.280

在你的模型绑定器中，你可以调用类似的东西

```
IMyFetcher db = DependencyResolver.Current.GetService<IMyFetcher>(); 
```

# java - 如何将 ByteBuffer 的内容放入 OutputStream？

> ID：579600
> 
> 赞同：37
> 
> 时间：2009-02-23T22:12:08.333
> 
> 标签：java, outputstream, bytebuffer

我需要将 a 的内容`java.nio.ByteBuffer`放入`java.io.OutputStream`. （希望我有一个`Channel`，但我没有）最好的方法是什么？

我不能使用 ByteBuffer 的`array()`方法，因为它可以是只读缓冲区。

我也可能在使用此 ByteBuffer 和拥有一个可以直接使用的常规数组之间散布对 OutputStream 的`byte[]`写入`OutputStream.write()`。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-02-23T22:16:25.200

查看[Channels.newChannel(OutputStream)](http://docs.oracle.com/javase/7/docs/api/java/nio/channels/Channels.html#newChannel%28java.io.OutputStream%29)。它会给你一个给定输出流的频道。使用 WritableByteChannel 适配器，您可以提供将其写入 OutputStream 的 ByteBuffer。

```
public void writeBuffer(ByteBuffer buffer, OutputStream stream) {
   WritableByteChannel channel = Channels.newChannel(stream);

   channel.write(buffer);
} 
```

这应该可以解决问题！

# java - 为什么选择 Buckminster 而不是 Maven？

> ID：579603
> 
> 赞同：21
> 
> 时间：2009-02-23T22:13:21.263
> 
> 标签：java, maven-2, build-automation, buckminster

我已经使用[Maven](http://maven.apache.org/)几个月了，我对它在概念上和实践中的工作方式非常满意。

我还非常广泛地研究了[Buckminster](http://www.eclipse.org/buckminster/)（但还没有运行样本），试图弄清楚它是什么以及它是如何比较的。文档很差。例如，他们使用 Build Automate 和 Deploy 之类的术语，但我还没有看到任何关于部署的内容。分阶段迁移是另一个暗示但未讨论的话题。

Maven 和 Buckminster 都使您能够指定依赖关系并通常管理构建、测试和可能的部署过程。

它们都具有 Eclipse 集成，并且都应该（仅使用 Maven）简化基于 Eclipse 的项目及其依赖项的设置和共享。

我可以看到的主要区别是：

*   依赖项：

    *   Buckminster 可以指定存在于源存储库中的依赖项和它自己的存储库类型，此外还能够引用 Maven 存储库以获取依赖项。
    *   Buckminster 可以将依赖项分组到虚拟发行版中，并且还具有平台意识。在 Maven 中，使用引用其他依赖项并将它们分组的 pom 对软件进行分组当然是可能的。
*   建造

    *   Maven 使用基于布局的隐式构建系统。很容易创建一个默认项目，把东西放在他们期望的地方，并让 maven 构建、测试和创建 jars。同时，含蓄也可能是一种束缚。你必须接受 Maven 做事的方式。
    *   Buckminster - 我不清楚 Buckminster 如何决定构建什么以及如何构建它。看起来这将与 eclipse 过程保持一致。Buckminster 也允许使用 ant，但不清楚这是否是必需的。至少，生命周期的好坏定义较少（un？），允许更大的灵活性。
    *   这两种工具都允许无头构建，尽管 buckminster 可能会带来更多的包袱。
*   插件

    *   Maven 为生命周期的所有阶段提供了一套非常广泛的插件，用于许多不同类型的自动化，从代码生成到运行嵌入式服务进行测试。
    *   Buckminster 似乎没有相同的插件概念。有读者和演员，但他们似乎扮演的角色并不相同。Buckminster 应该可以访问大量可用于 ant 的插件集。目前尚不清楚 ant 操作如何与 Buckminster 的其余进程无缝集成（这也是 maven ant 插件的一个问题）。
*   部署

    *   Maven 有许多插件用于生成软件分发（程序集）和移动它们（货车）。Buckminster 是否从 Ant 获得所有这些？
*   复杂

    *   Buckminster 的不同模式可能非常复杂，在 CPEC、RMAP、MSPEC 等之间。
    *   Maven 在配置方面稍微简单一些，尽管它可能会因大型和多模块项目而变得复杂。Maven 还具有用于轻松创建新项目的原型。
*   文档

    *   他们都是坏人。;-)
    *   Buckminster 在文档方面非常肤浅。没有足够的例子可用。
    *   Maven 插件的文档往往很差，因此很难让它们正确运行。

从我的角度来看，我想用 Buckminster 做的大部分事情都可以用 Maven 做。来自版本控制的“物化”是一个加分项，但组织内的开发人员可以将 maven 快照发布到存储库以相互共享，而不仅仅是提供固定版本。

似乎从 Maven 生命周期的限制中获得了更多的灵活性和自由度（曾经想添加另一个阶段，例如用于清理的后测试？必须等待他们在核心中完成它）。

我错过了什么？Buckminster 中是否有一些重要的功能值得增加复杂性？

上面是否有任何非常不准确的陈述（假设我不是 Buckminster 用户，只是一个中低级 Maven 用户）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-04-28T15:41:10.140

一些澄清。

*   依赖项

    Buckminster 没有自己的存储库类型。它有一个发现机制，可以将现有的元数据（例如 Maven POM）转换为 Buckminster 可以理解的模型。如果无法以任何其他方式派生此元数据，则可以将其作为 XML 文件逐字添加。

*   建造

    Buckminster 以与 Eclipse IDE 相同的方式决定构建什么。除此之外，它还从清单、build.properties、plugin.xml 等已知工件中提取信息，并将其转换为模型中的操作，这些操作可以使用 Buckminster perform 命令显式触发。

    我完全不相信 Buckminster 会为无头构建带来更多包袱。事实上，我认为相反的情况更常见。在空机器上使用 Maven 进行构建通常从下载大量组件开始，即使手头的任务是微不足道的。

*   插件

    Buckminster 基于 OSGi 并使用 Eclipse 扩展点进行扩展。可以使用此机制添加新类型的存储库、新类型的操作、新发现机制等。

*   复杂

    最小的 Buckminster 配置只需要一个 CQUERY 和一个 RMAP。使用它们，可以构建一个使用 pack200 签名和处理的任意大小的完整 p2 更新站点。无需将文件添加到任何功能和捆绑包中。没有什么需要“巴克敏斯特化”。所以我不确定我是否同意 Maven 更易于配置。

除了 Roland 和 Zoltán 已经提到的好处之外，我想补充一点，由于 buckminster 构建是真正的工作空间构建，它将利用 .project 文件中声明的所有构建器。这里有些例子：

*   PDE Manifest builder - 从清单、属性文件等生成警告和错误。
*   PDE Schema builder（扩展点模式相同）
*   为 Eclipse Build 结构制作的所有其他构建器。这包括 XML 模式验证构建器、Java 脚本构建器以及许多其他构建器。

我确信 Maven 与他们中的大多数人都有对应关系。Buckminster 的要点是您不需要维护额外的构建系统。在 IDE 工作区中工作的东西，也可以无头工作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-24T01:00:31.890

> Maven 使用基于布局的隐式构建系统。很容易创建一个默认项目，把东西放在他们期望的地方，并让 maven 构建、测试和创建 jars。同时，含蓄也可能是一种束缚。你必须接受 Maven 做事的方式。

实际上，您可以明确指定在 Maven 中放置内容的位置。默认位置就是这样，默认值，易于覆盖，尽管很少有充分的理由。

> Buckminster - 我不清楚 Buckminster 如何决定构建什么以及如何构建它。看起来这将与 eclipse 过程保持一致。Buckminster 也允许使用 ant，但不清楚这是否是必需的。至少，生命周期的好坏定义较少（un？），允许更大的灵活性。

我认为 Maven 倾向于遵循容易被覆盖的合理默认值的哲学。

> Maven 在配置方面稍微简单一些，尽管它可能会因大型和多模块项目而变得复杂。Maven 还具有用于轻松创建新项目的原型。

Maven 的真正优势在于它对依赖项的管理，这在具有多个子项目的复杂项目中往往表现得特别好。定义子项目的层次结构并让它正常工作非常容易。

> 文档：它们都很糟糕。;-)

不能不同意这一点！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-04-28T14:03:05.210

Buckminster 下载页面提供了 PDF 格式的 Buckminster Book - 超过 250 页的文档，包括介绍和详细的参考文档。

从这里下载：http: [//www.eclipse.org/downloads/download.php?file= /tools/buckminster/doc/BuckyBook.pdf](http://www.eclipse.org/downloads/download.php?file=/tools/buckminster/doc/BuckyBook.pdf)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-03-09T15:31:24.100

使用 Buckminster 的最大优势是在编译 OSGi 包或 Eclipse 插件时，因为它可以重用 PDE 构建基础架构，该基础架构可以处理 manifest.mf/plugin.xml 文件中已经存在的各种版本信息。使用 Maven 时，必须复制此信息（AFAIK）。如果您不开发 Eclipse 插件，并且已经熟悉 Maven，那么 Buckminster 将不会提供任何真正的优势，尤其是考虑到陡峭的学习曲线。另一方面，对于构建 Eclipse 插件，它提供了更好的 ot-of-the-box 支持。

您可以通过编写新的阅读器（从其他位置获取源代码）或新的参与者（提供构建步骤 - 这些参与者可以重用 Maven 或 Ant，从而提供额外的功能）来扩展 Buckminster。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-07-12T12:27:45.283

我想知道为什么没有人提到[第谷](http://tycho.sonatype.org/)。Tycho 已被提议为[Eclipse 项目](http://www.eclipse.org/proposals/tycho/)，现在处于[孵化阶段](http://www.eclipse.org/tycho/)。

我试图与巴克敏斯特相处，但现在我将看看第谷。这有以下原因：

*   如前所述，buckminster 的文档非常糟糕。
*   实际上，我从未运行过 buckminster 示例之一。
*   我知道 Maven，而且文档恕我直言，比 buckminster 的要好。
*   我想使用构建服务器（Jenkins），Maven的集成非常好。

我目前没有使用第谷的经验，但它似乎很有希望。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-26T04:41:12.780

简而言之，我对 Buckminster 的（*极其有限*的）理解是，它是一个用于在团队成员之间为一组项目进行版本控制和共享 Eclipse 项目配置的系统。它似乎与 Maven 重叠，因为它管理依赖项，但我认为这些是 Eclipse 项目级别的依赖项，而不是 java 依赖项。

我个人不想将我的构建过程绑定到 Eclipse 或任何其他 IDE。无需 IDE 或其他 GUI 工具即可从命令行工具执行完整构建有很多好处。

免费的 O'Reilly 书籍[Maven: The Definitive Guide](http://www.sonatype.com/products/maven/documentation/book-defguide)写得非常好，真正填补了 Maven 文档的空白。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-02T11:37:50.817

**由于缺少 buckminster 文档，我使用 Buckminster/Hudson**创建了一个建筑产品示例。这可能有助于开始，也适用于**Jenkins**。

> 我使用[Ralf 的教程](http://www.ralfebert.de/blog/eclipsercp/rcp_builds/)来很好地了解该主题。
> 
> **目标平台**
> 
> 如何设置 Hudson 和 Buckminster 可以在 Ralf 的教程中阅读。小提示，为防止 OutOfMemoryErrors，将 -Xmx1024m 添加到 Buckminster 安装的“附加参数”中（请参阅 [故障排除提示 Hudson out of memory](https://bugs.eclipse.org/bugs/show_bug.cgi?id=306102)）。
> 
> 我有一个单独的自由式工作来发布我的目标平台以用于其他工作。在“源代码管理”部分，我检查了包含我的目标定义的功能（在我的例子中是 ch.scodi.client.site）。
> 为了真正解决目标定义，我使用以下命令添加了一个构建步骤“Run Buckminster”：
> 
> `importtargetdefinition -A '${WORKSPACE}ch.scodi.client.site/TargetDefinition.target'`
> 
> 在**Post-Build-Action 中**选中“归档并发布 Eclipse 目标平台”并添加 `.metadata/.plugins/org.eclipse.pde.core/.bundle_pool`为路径。
> 
> 考虑到 TargetDefinition 无法解析目录位置。我的目标定义曾经有一个目录位置，其中包含来自 springsource 存储库的包。
> 我尝试在实现过程中使用 rmap 文件来获取捆绑包，但遇到了一些麻烦，因此我决定为这些捆绑包创建一个自己的更新站点并将该站点添加到目标定义中。更多信息可以在这里找到：http:
> [//www.eclipse.org/forums/index.php?t=msg &th=164508&start=0&](http://www.eclipse.org/forums/index.php?t=msg&th=164508&start=0&)
> 
> **构建产品**
> 
> 目标定义作业运行后，我们就可以开始构建产品了。
> 这很简单，请参阅 Ralf 的教程，了解如何从 SVN 签出您的源代码。
> 我为每个服务器和客户端产品提供了三种不同的构建：集成、夜间和发布。
> 对于每个构建，插件限定符应该不同（例如 I20100326-2、N20100326、R20100326-01）。为此，我安装了流动插件：
> [http](http://wiki.hudson-ci.org/display/HUDSON/Version+Number+Plugin)
> ://wiki.hudson-ci.org/display/HUDSON/Version+Number+Plugin在集成作业中，我选择“创建格式化的版本号”，将其命名为“版本”并使用这样的东西`I${BUILD_YEAR, XXXX}${BUILD_MONTH, XX}${BUILD_DAY, XX}-${BUILDS_TODAY}`作为格式。
> 
> 为了最终构建客户端产品，我添加了 Buckminster 构建步骤，选择了之前发布的目标平台并使用以下命令：

```
import '${WORKSPACE}source/scodi-rcp/features/ch.scodi.client.site/site.cquery'

build

perform -D target.os=* -D target.ws=* -D target.arch=* -D
qualifier.replacement.*=${version} ch.scodi.client.site#site.p2.zip
perform -D target.os=win32 -D target.ws=win32 -D target.arch=x86
ch.scodi.client.site#create.product.zip perform -D target.os=win32 -D
target.ws=win32 -D target.arch=x86_64
ch.scodi.client.site#create.product.zip 
```

> 请注意`qualifier.replacement.*=${version}`，这告诉 Buckminster/Eclipse 使用我的格式化版本作为限定符，并生成像这样命名的插件 `com.softmodeler.model_1.0.0.I20100325-3.jar`，需要 `Bundle-Version: 1.0.0.qualifier`在包中定义`manifest`。

[http://flaviodonze.blogspot.ch/2010/03/building-products-with.html](http://flaviodonze.blogspot.ch/2010/03/building-products-with.html)

# visual-studio - 生成引导程序是否需要 VS2008

> ID：579604
> 
> 赞同：1
> 
> 时间：2009-02-23T22:13:31.713
> 
> 标签：visual-studio, windows-installer, bootstrapper

我是否需要安装 Visual Studio 2008 才能为我的 msi 安装程序构建引导程序？

我的构建服务器上没有安装 VS2008，我宁愿不安装它只是为了生成这个引导程序，但似乎所需的引导程序文件（setup.bin、Microsoft SDKs 文件夹等）包含在VS设置。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T23:23:07.757

我刚刚将文件从我的开发箱复制到构建服务器。那工作得很好。

安装 Windows SDK 没有帮助，因为引导程序[不是 SDK 的一部分，](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=361924)即使文件所在的位置也是如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T22:20:43.803

应该可以在包含引导程序的构建服务器上安装[Windows SDK 。](http://en.wikipedia.org/wiki/Microsoft_Windows_SDK)

为了构建 Visual Studio 设置和部署项目，您需要安装 VS。但是，您可以使用 MSBuild 脚本在没有 VS 的情况下构建引导程序（一个很好的组合是使用 WiX 为您的 MSI 和 MSBuild 来创建引导程序）。您将需要使用 GenerateBootstrapper 任务（以下将输出安装 .NET Framework 的本地化引导程序）：

```
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <ItemGroup>
        <BootstrapperFile Include="Microsoft.Net.Framework.2.0">
                <ProductName>.NET Framework 2.0</ProductName>
        </BootstrapperFile>
        <BootstrapperFile Include="Microsoft.Windows.Installer.3.1">
                <ProductName>Windows Installer 3.1</ProductName>
        </BootstrapperFile>
    </ItemGroup>

    <Target Name="Bootstrapper">
        <GenerateBootstrapper ApplicationFile="mySetup.msi" 
            Culture="de-DE" 
            ApplicationName="My Application" 
            OutputPath="$(OutDir)\de-DE" 
            BootstrapperItems="@(BootstrapperFile)" 
            Path="C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\" />

        <GenerateBootstrapper ApplicationFile="mySetup.msi" 
            Culture="en-US" 
            ApplicationName="My Application" 
            OutputPath="$(OutDir)\en-US" 
            BootstrapperItems="@(BootstrapperFile)" 
            Path="C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\" />
    </Target>
</Project> 
```

这些相关问题可能会有所帮助：

*   [Wix 和 .NET Framework（先决条件）](https://stackoverflow.com/questions/427775/wix-and-net-framework-pre-requisites)
*   [如何在 MSBuild 中获取 Windows SDK 文件夹？](https://stackoverflow.com/questions/442476/how-to-get-the-windows-sdk-folder-in-msbuild)

# https - HTTPS 导致 Joomla 在创建链接时恢复到旧域

> ID：579610
> 
> 赞同：0
> 
> 时间：2009-02-23T22:15:10.570
> 
> 标签：https, joomla, hyperlink

我已将网站 BradPPresents.com 移至 BradP.com。**URL 不适合工作**

该网站在 HTTP 上正确链接，但一旦使用 HTTPS，链接就会恢复到 BradPPresents.com。

我以为这是 Joomla！configuration.php 文件，但它已更改为 BradP.com。

此外，我能找到的所有 BradPPresents.com 实例都已在 MySQL 数据库中更改为 BradP.com。

有没有人有任何想法？非常感谢，尼克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T22:43:41.237

致其他人：在您的好奇心得到充分发挥并决定查看此人的网站之前，请注意在某些地方可能不适合工作。更新：我无权编辑添加到问题中的 URL 声明，所以我将在这里更新：该网站不是经典意义上的成人网站，而是关于如何获得女孩的网站之一。尽管如此，首页上的一些图片还是有点不雅，所以如果你在工作，我仍然建议你远离。

检查服务器软件的配置。它可能将端口 443 (https) 指向与端口 80 (http) 不同的默认目录。如果是这样，您需要更改端口 443 的默认目录以匹配端口 80 的默认目录。

如果您使用的是 Apache，我希望在某处有名为 httpd.conf 和 ssl.conf 的文件，可能位于不同的目录中。（很可能这些目录处于同一级别，或者其中一个是另一个的子目录。可能的起点是 /etc/httpd/ 和 /usr/local/apache2/。这些目录通常命名为 conf 和 conf。 d.) 这两个文件可能都有 DocumentRoot 条目（尽管 ssl.conf 中的条目可能用“#”注释掉）。如果两者都没有被注释掉并且它们不匹配，请更改 ssl.conf 中的那个。有关详细信息，请参阅[Apache](http://httpd.apache.org)网站。

我只使用过 Apache，所以我无法帮助其他服务器。

您可能知道这一点，但为了完整起见，我应该提一下：不要忘记在编辑现有配置文件之前备份它们！这样，如果您的更改不起作用，您可以返回到您拥有的内容。

编辑：我错过了这是我从未使用过的 Joomla。所以，我不确定这是否有用。

# c - 在运行时或编译/链接时绑定模块的接口要求，哪个更好？

> ID：579612
> 
> 赞同：1
> 
> 时间：2009-02-23T22:15:31.320
> 
> 标签：c, binding, interface

我有一个问题或在运行时或编译/链接时连接接口的最佳方法。对于我的嵌入式项目，设备驱动程序和 I/O 具有需要绑定（即粘合）到其相应接口依赖项的接口。例如，对于模拟设备驱动程序，它需要一个到离散输出驱动程序的接口，以便设置 MUX 和 Enable 线，其接口如下所示：

```
unsigned char (*SetDiscOutput)(unsigned short signalID, unsigned char state); 
```

目前，我正在使用一个配置表，该表将模块的接口要求与相关的接口依赖项相关联，然后在运行时环境配置遍历此列表并分配依赖项。到目前为止，我提出的另一种方法是使用硬件配置文件，它将模块接口绑定到它们相关的依赖接口，这些接口将在编译/链接时分配。

这将是一种更好的方法（赞成/反对），更重要的是有一种更优雅的方式来绑定这些接口依赖项。

标记

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T03:13:29.480

I like to MUX them with semaphores. But it really depends on if you are going to be using an OS and if there is any point to having it available for change. I have kept it in software so that different versions of embedded hardware could run the same code, just with different settings.

# c# - 从 C# 客户端使用 PHP Web 服务

> ID：579613
> 
> 赞同：0
> 
> 时间：2009-02-23T22:15:46.310
> 
> 标签：c#, php, web-services

我正在尝试在 Apache/PHP 服务器上使用 Web 服务，我只有以下示例请求作为文档。

```
POST /server/service.php HTTP/1.1
Host: server.example.com
ContentType: text/xml
ContentLength: xxx
<?xml version=\"1.0\"?>
<command>
    <parameters />
</command> 
```

每次我尝试使用该服务时，都会收到 HTTP 400 错误。我已经联系了软件的供应商，他们回答说服务器没有问题，并附上了成功的回复。

```
HTTP/1.1 200 OK
Date: 
Server: Apache/2.2.3 (Debian) PHP/5.2.0-8+etch7
X-Powered-By: PHP/5.2.0-8+etch7
Content-Length: 205
Connection: close
Content-Type: text/xml;charset=ISO-8859-1

<?xml version=\"1.0\"?>
<reply>
      <reply stuff />
</reply> 
```

我不知道是什么导致了我这边的 HTTP 400（错误请求）响应。我最好的猜测可能是某种编码问题或协议方面的某种不兼容（或者当然是糟糕的编程）。

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T22:23:20.473

考虑使用[Fiddler](http://www.fiddlertool.com/fiddler/)来准确查看您的代码作为请求发送的内容（并考虑将请求发送到您自己的机器上的服务进行测试）。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-23T22:24:12.360

您可以使用微软提供的[**WSDL.exe**](http://msdn.microsoft.com/en-us/library/7h3ystb6(VS.80).aspx)工具，该工具可以生成您需要连接到任何符合 SOAP 的 Web 服务的代理类

还要检查您的 XmlCommand 格式是否正确

# c# - 删除未使用代码的最佳实践

> ID：579617
> 
> 赞同：16
> 
> 时间：2009-02-23T22:17:04.107
> 
> 标签：c#

我想知道人们删除未使用代码的最佳实践是什么。就我个人而言，我喜欢删除（不仅仅是评论）任何当前未使用的内容。但我不确定要走多远。

以此为例（尽管我对一般性讨论感兴趣）。在我的项目中，我有十几个用户控件。对于后来被固定的功能，我在其中一个 UserControl 上实现了几个方法和属性。附加代码并非特定于该功能，但需要支持它。以后可能会有用。

*   我是否应该删除代码，因为我们目前不使用它，并且代码越少越容易阅读？问题是，未来的开发人员如何知道这项工作已经完成？
*   或者我应该将它保留在那里，以便其他开发人员在以后需要使用它时可以轻松找到它（他们不会考虑通过源代码管理来查看是否有人这样做并删除了它）？
*   或者还有其他选择吗？

这同样适用于当前未使用的用户控件。我应该删除它们还是保留它们？

**编辑：**不用说（或者我认为会）我们正在使用源代码控制。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-23T22:19:01.357

首先要记住的是**您的所有代码都应该在源代码管理中**。

考虑到这一点，您当然希望删除过时的代码，而不仅仅是将其注释掉。任何长度的注释代码块都是*危险*的，至少有两个原因：

1.  有一种趋势是假设注释与代码的其余部分一起维护。这不是真的，并且可能导致诸如错误回归之类的问题。
2.  在一个长块的中间很容易错过一个未注释的右花括号（例如）。

如果您确实需要，删除的代码仍然可用，但它不再使您的工作副本混乱。如果您*真的*担心旧代码的可发现性，您可以留下评论，指出代码已被删除以及您需要找到它的修订号。总而言之，这比实际代码块使用的要好得多。更清楚的是，这段代码被允许失效，并且失效了多长时间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T22:20:12.557

如果您使用的是源代码控制系统，删除代码是我的首选。

使用当前代码时它不会妨碍您，并且如果您再次需要它，您将始终将代码保存在存储库中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-23T22:28:56.247

一段代码可以有两种状态。
要么它是活动的、可运行的且经过测试，在这种情况下它应该在源代码控制中，
要么它已经过时，以至于你无法想象任何人都想再使用它，仅仅是因为它已经过时了。在这种情况下，它应该被删除。

不删除代码以便“其他开发人员可以轻松找到它”是保持代码活动和编译的绝佳理由。不要担心库的大小，链接器会删除任何未使用的内容。

如果您正在擦除代码并想警告其他人那里的代码以及删除的原因，以便他们不会再犯同样的错误，可以放置一个好的注释。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T22:45:55.723

我的猜测是，即使您评论它在存储库中，它也会被重新编写，而不是有人回去抓住它。

并不是说我在很多地方都使用过这种“不留下任何代码”的政策（只有一个），但我从未见过有人回到存储库并获取一些旧代码。

但是，除了小块之外，我也从未见过有人取消注释别人的代码！

如果你想保存它，我会让它完全实现和测试（检查测试！）但是如果需要新代码，条件会改变。

我有不需要的代码，只是在需要时“打开”，这是一种非常好的感觉（并不是说它总是可以完成）。

如果你懒得让它功能齐全并经过测试，那就剪掉它，让下一个人重新编写它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-23T22:31:09.050

我也喜欢删除未使用的代码。

如果我知道代码以后会有所帮助，我会在从主干中删除代码之前创建一个分支（我们使用的是颠覆 - 所以创建分支非常便宜和容易）。这使我可以轻松地获得该代码一次/如果需要的话。

例如，如果您有一个新功能，在发布时不会完成，此过程允许从主干中删除部分功能，但是一旦您完成它，您就可以将其添加回来。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-23T22:48:29.383

我通常让死代码闲置一段时间，直到它的使用稳定下来，我将不再使用该功能。那时，我将其删除。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T23:21:01.380

我们的源代码树中有一个“过时”区域，我们在其中移动不再使用的东西。它在通常不检查的区域远离行李箱，因此没有人需要查看它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-04-02T19:16:25.877

我将建议将删除的代码替换为指定删除代码所针对的工作项的注释。我的理由是这提供了一个“钩子”，任何代码审查评论都可以附加到它上面。我们正在使用 TFS 更改集进行代码审查 VS Professional。如果代码被 100% 删除，则没有挂钩。

# python - 在解决 isinstance 时包装对象以扩展/添加功能

> ID：579620
> 
> 赞同：6
> 
> 时间：2009-02-23T22:17:28.960
> 
> 标签：python, design-patterns

在 Python 中，我看到了使用保持或包装来扩展对象或类的功能而不是继承的建议。特别是，我认为 Alex Martelli 在他的[Python 设计模式](http://www.lecturefox.com/blog/python-design-patterns-by-alex-martelli)演讲中谈到了这一点。我已经看到这种模式在库中用于依赖注入，比如[pycontainer](http://pypi.python.org/pypi/PyContainer/0.4)。

我遇到的一个问题是，当我必须与使用 [isinstance anti-pattern](https://stackoverflow.com/questions/576988/python-specific-antipatterns/577848#577848)的代码交互时，这种模式会失败，因为持有/包装对象未能通过`isinstance`测试。如何设置保持/包装对象以绕过不必要的类型检查？这可以通用吗？在某种意义上，对于类实例，我需要类似于保留签名的函数装饰器（例如[simple_decorator](http://wiki.python.org/moin/PythonDecoratorLibrary)或 Michele Simionato 的[装饰器](http://pypi.python.org/pypi/decorator)）的东西。

一个限定：我并不是说所有`isinstance`的用法都是不合适的；几个答案对此提出了很好的观点。也就是说，应该认识到`isinstance`使用对对象交互造成了很大的限制——它迫使*继承*成为多态性的来源，而不是*行为*的来源。

关于这到底是如何/为什么会成为问题的似乎有些困惑，所以让我提供一个简单的例子（从[pycontainer](http://pypi.python.org/pypi/PyContainer/0.4)广泛提升）。假设我们有一个类 Foo，以及一个 FooFactory。为了这个例子，假设我们希望能够实例化记录每个函数调用的 Foo 对象，或者不考虑 AOP。此外，我们希望在不以任何方式修改 Foo 类/源的情况下做到这一点（例如，我们实际上可能正在实现一个通用工厂，它可以动态地向任何类实例添加日志记录能力）。对此的第一次尝试可能是：

```
class Foo(object):
    def bar():
        print 'We\'re out of Red Leicester.'

class LogWrapped(object):
    def __init__(self, wrapped):
        self.wrapped = wrapped
    def __getattr__(self, name):
        attr = getattr(self.wrapped, name)
        if not callable(attr):
            return attr
        else:
            def fun(*args, **kwargs):
                print 'Calling ', name
                attr(*args, **kwargs)
                print 'Called ', name
            return fun

class FooFactory(object):
    def get_foo(with_logging = False):
        if not with_logging:
            return Foo()
        else:
            return LogWrapped(Foo())

foo_fact = FooFactory()
my_foo = foo_fact.get_foo(True)
isinstance(my_foo, Foo) # False! 
```

您可能想以这种方式做事（使用装饰器等），但请记住：

*   我们不想碰 Foo 类。假设我们正在编写可供我们还不知道的客户端使用的框架代码。
*   关键是返回一个本质上是 Foo 的对象，但具有附加功能。对于任何其他期望 Foo 的客户端代码，它应该尽可能地显示为 Foo。因此想要解决问题`isinstance`。
*   是的，我知道我不需要工厂类（在这里先发制人）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T10:35:52.430

如果您依赖的库代码使用`isinstance`并依赖于继承，为什么不遵循这条路线呢？如果您无法更改库，那么最好与它保持一致。

我还认为 . 有合法用途`isinstance`，并且随着 2.6 中[抽象基类](http://www.python.org/dev/peps/pep-3119/)的引入，这已得到官方承认。在某些情况下，`isinstance`确实是正确的解决方案，而不是使用`hasattr`或使用异常的鸭式打字。

如果出于某种原因您真的不想使用继承，则有一些肮脏的选择：

*   您可以使用实例方法仅修改类实例。`new.instancemethod`为您的实例创建包装器方法，然后调用原始类中定义的原始方法。这似乎是唯一既不修改原始类也不定义新类的选项。

如果您可以在运行时修改类，则有很多选项：

*   使用运行时 mixin，即只需将一个类添加到类的`__base__`属性中。但这更多地用于添加特定功能，而不是用于不知道需要包装什么的不加选择的包装。

*   Dave 回答中的选项（Python >= 2.6 或元类中的类装饰器）。

编辑：对于您的具体示例，我猜只有第一个选项有效。但我仍然会考虑`LogFoo`为特定的事情（如日志记录）创建或选择完全不同的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T18:17:58.217

要记住的一件事是，如果您采用继承路线，则不一定必须在基类中*使用任何东西。*您可以创建一个从不添加任何具体实现的存根类继承。我做过几次这样的事情：

```
class Message(object):
     pass

class ClassToBeWrapped(object):
    #...

class MessageWithConcreteImplementation(Message):
    def __init__(self):
        self.x = ClassToBeWrapped()
    #... add concrete implementation here

x = MessageWithConcreteImplementation()
isinstance(x, Message) 
```

如果你需要从其他东西继承，我想你可能会遇到多重继承的一些问题，但如果你不提供任何具体的实现，这应该是相当小的。

> 我遇到的一个问题是，当我必须与使用 isinstance 反模式的代码交互时

我同意尽可能避免使用 isinstance，但我不确定是否将其称为反模式。使用 isinstance 有一些正当理由。例如，有一些消息传递框架使用它来定义消息。例如，如果你得到一个继承自 Shutdown 的类，那么是时候关闭子系统了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T22:37:25.713

*   Python 2.6 有你想要的类级装饰器。[http://docs.python.org/3.0/whatsnew/2.6.html#pep-3129-class-decorators](http://docs.python.org/3.0/whatsnew/2.6.html#pep-3129-class-decorators)

*   您也许可以使用元类：[http](http://www.google.com/search?q=python+metaclasses) ://www.google.com/search?q=python+metaclasses （这种方式很疯狂）。我不确定它会完全解决您的问题，但尝试可能会很有趣。;-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-24T00:24:11.977

我的第一个冲动是尝试修复使用`isinstance`. 否则，您只是将其设计错误传播到您自己的设计中。有什么理由不能修改？

**编辑：** 所以你的理由是你正在编写你希望人们能够在所有情况下使用的框架/库代码，即使他们想使用 isinstance？

我认为这有几个问题：

*   你试图支持一个破碎的范式
*   您是定义库及其接口的人，正确使用它取决于用户。
*   你不可能预料到你的图书馆用户会做的所有糟糕的编程，所以试图支持糟糕的编程实践几乎是徒劳的

我认为您最好编写惯用的、设计良好的代码。好的代码（和坏的代码）有传播的趋势，所以让你的代码成为一个例子。希望它将导致代码质量的整体提高。走另一条路只会继续质量下降。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T18:46:09.553

如果您正在编写一个需要接受来自 API 用户的某种输入的框架，那么我没有理由想到使用 isinstance。尽管它可能很丑，但我总是检查它是否真的提供了我想要使用的接口：

```
def foo(bar):
    if hasattr(bar, "baz") and hasattr(bar, "quux"):
        twiddle(bar.baz, bar.quux())
    elif hasattr(bar, "quuux"):
        etc... 
```

如果 API 用户想要使用它，我还经常提供一个很好的类来继承默认功能：

```
class Bar:
    def baz(self):
        return self.quux("glu")

    def quux(self):
        raise NotImplemented 
```

# .net - 是否可以事后确定 .NET 程序集是用哪种语言编写的？

> ID：579636
> 
> 赞同：10
> 
> 时间：2009-02-23T22:22:14.440
> 
> 标签：.net, clr, c++-cli, managed, managed-c++

这最初是作为一种查找 C++/CLI 和托管 C++ 程序集的方法，以便可以测试它们内部的所有类，以确保重新实现所有继承的方法。我想将此添加为构建过程步骤，以确保它不再发生。

考虑到这个问题也让我有点好奇，因为能够确定使用的任何 .NET 语言会很有趣。因此，我走得更远，比较了所有 .NET 语言的程序集。到目前为止，这是我通过我编写的一个小程序发现的，它通过反射比较任何一组 .NET 程序集的类型和属性数据：

*   C# - 有 AssemblyConfigurationAttribute，有 GuidAttribute
*   VB - 有许多额外的“我的”类型（例如 MyApplication、MySettings），有 GuidAttibute
*   F# - 有一个 FSharpInterfaceDataVersionAttribute，它还指定使用的编译器的版本。
*   C++（除 /clr:safe 之外的所有） - 有一堆额外的类型（FrameInfo、type_info）
*   C++ /clr:safe - 似乎没有独特的反射特性。

按此顺序解析可能是合理的：

1.  如果它具有 FSharpInterfaceDataVersionAttribute，则为 F#
2.  如果它在我发现的大量额外类型中有任何一个，那就是 C++。
3.  如果它具有“My*”类型，则它是 VB。
4.  如果它具有 AssemblyConfigurationAttribute 或 GuidAttribute，则为 C#
5.  很可能是 C++ /clr:Safe

然而，由于这是一个可怕的 hack，我想在这里检查以确保没有其他选项可用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T06:53:52.773

检查 VB 或 F# 类库之类的引用似乎是最不可靠的方法，但正如其他人所提到的，这是一种启发式方法——就像没有明确的方法来判断本机二进制文件是用哪种语言编写的（但是您可以通过启发式方法几乎 100% 确定）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-24T06:27:54.240

编译 .NET 语言时，您得到的只是 IL。我不知道确定哪种特定语言创建程序集的标准方法。您可以使用现有的程序集并将其 ildasm（拆卸）到 IL 中，然后再将其 ilasm（组装）回几乎相同的程序集。

您使用的启发式方法是识别用于创建程序集的语言的合理且聪明的方法。但是，请记住，这些细节可能会在语言的编译器版本之间发生变化。

# javascript - 有哪些提高 UI 响应能力的技术？

> ID：579637
> 
> 赞同：3
> 
> 时间：2009-02-23T22:22:38.633
> 
> 标签：javascript, performance, dom, user-experience

在下面的示例中，谁能告诉我如何在不修改 appendContent() 的情况下使“单击时响应缓慢”响应更快？我想知道是否有办法将便宜的操作放在更昂贵的操作之前，并确保便宜的操作实际上得到快速执行。

```
<div id="draw">slow response when clicked</div>

<div style="overflow: auto; height: 300px; border:solid 1px grey" id="content"></div>

<script language="javascript">

    var clickLink = document.getElementById("draw");
    var contentDiv = document.getElementById("content")

    function appendContent(){
        contentDiv.innerHTML =  contentDiv.innerHTML + "hello ";
    }

    clickLink.onclick = function(){
        clickLink.style.color = "red";
        for (var i = 0; i < 1500; i++){     
            appendContent();    
        }
    };
</script> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T22:33:06.160

对于用户必须等待的持续时间，反馈机制应该不同。不到 0.1 秒，用户不会注意到。

在 1 到 10 秒之间，您可以简单地显示一个符号，例如某种表示您的应用正在处理的动画 gif。请参阅[http://www.ajaxload.info/](http://www.ajaxload.info/) 我使用带有 ID“处理”的 div 并使用微调器对其进行样式设置，并使用以下 jquery 代码在处理之前和之后显示和隐藏它。

```
function showProcessing(){
    $("#processing").fadeIn("fast");
}

function hideProcessing(){
    $("#processing").fadeOut("fast");
} 
```

超过 10 秒，最好提供处理时间的估计值。

有关这些数字的来源，请参阅[响应时间概述](http://www.useit.com/papers/responsetime.html)。

以下代码立即将链接颜色更改为红色，并在几分之一秒后调用 append 方法。本质上是允许浏览器在循环挂断之前执行一个单独的线程。超时时间可能需要根据浏览器进行调整。如果您需要以更通用的方式放弃控制，请查看 Neil Mix 的[Threading in JavaScript 1.7 。](http://www.neilmix.com/2007/02/07/threading-in-javascript-17/)

```
 function startAppend(){
      for     (var i = 0; i < 1500; i++){             
              appendContent();        
      }
    }

    clickLink.onclick = function(){
            clickLink.style.color = "red";
            setTimeout('startAppend()', 10)                
    }; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T22:34:56.157

如果您想要做的只是向用户提供一些反馈，以便他们知道发生了什么事，您可以尝试在按钮旁边放置一个动画 gif - 加载圈或其他东西并禁用按钮本身，然后将其恢复正常重绘完成后。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T22:28:44.750

由于 javascript 没有良好的多线程支持，因此您需要将 dom 操作拆分为更小的部分。通常这些事情是通过在单独的线程中执行长时间操作来完成的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T22:32:30.560

雅虎用户界面库有很多很好的代码和控件，它们已经使用 AJAX 等技术来提高您的 Web 应用程序的感知响应能力。

使用 Yahoo! 之类的库可以更快地向您的应用程序添加此功能，并且更不容易出错。

[http://developer.yahoo.com/yui/](http://developer.yahoo.com/yui/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T00:43:53.490

试试这个：默认情况下添加一个包含加载图形的 div，但将 CSS 设置为 display:none。然后，当单击 div#draw 时，将加载图形的显示设置为阻塞，然后进行绘图。绘制完成后，将显示设置回无。

# safari - 图像的 Amazon S3 临时 URL 适用于 IE 和 Firefox，但不适用于 Safari

> ID：579644
> 
> 赞同：3
> 
> 时间：2009-02-23T22:24:17.443
> 
> 标签：safari, amazon-s3, amazon-web-services, right-aws

我正在使用 Amazon S3 来托管图像。S3 存储桶是私有的，因此我生成了一个临时 URL（使用[Right AWS](http://rightaws.rubyforge.org/)），有效期为 5 分钟，以允许呈现图像。URL 如下所示（注意：下面的 URL 将不起作用）：

```
https://mybucket.s3.amazonaws.com:443/attachments%2F30%2Fsmall.png?Signature=J%2BXzQd95myCNv0Re8arMhuTFSvk%3D&Expires=1235511662&AWSAccessKeyId=1K3MW21E6T8LWBY94C01 
```

这很好用，我可以将 URL 粘贴到 Firefox 中并显示图像。IE也一样。但是，当我在 Safari 中尝试时，URL 似乎可以解析，但没有显示图像。同样，如果我尝试在网页上的**IMG标记的****src**属性中使用 URL，则 Safari 不会呈现任何内容（在所有其他浏览器中都可以），例如：

 **[替代文字 http://lylo.co.uk/screenshot.png](http://lylo.co.uk/screenshot.png)

有没有人见过这种行为，你能指出我可能做错了什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-24T12:06:57.077

通过在我正在使用的 S3 库中进行一些挖掘，我在这里发现了问题。

当您将文件上传到 S3 时，您必须设置`Content-Type`标题。在我的情况下，我上传了两个文件，一个是 Content-Type 的原始 PDF 文件`application/pdf`，另一个是 PNG 格式的缩略图预览。我用来上传到 S3 的库确实设置了`Content-Type`标题，但它为`application/pdf`原始 PDF 和 PNG 缩略图设置了标题。

似乎 Firefox 和 IE 会愉快地从 S3 渲染 PNG 图像，即使它有错误的`Content-Type`标题，而 Safari 根本不喜欢这样，因此不会渲染图像。

因此，修补我正在使用的 S3 库，以便`Content-Type`在 PNG 缩略图上正确设置正确的标题解决了这个问题。

呸。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T00:39:07.993

AWS 无法识别您的 URL：

```
...attachments%2F30%2Fsmall.png... 
```

它实际上应该是：

```
...attachments/30/small.png... 
```

Firefox**将**在实际提交请求之前将所有 URL 编码实体（在 '?' 查询标记之前）替换为相应的 ASCII 表示（即，Firefox 将在上面的示例中替换`%2F`为`/`），而 Safari 可能不会。在这种情况下，AWS 可能会向 Safari 回复 HTTP 404。

确保您的 URL 格式正确，适用于 AWS。*仔细研究 Firefox 在成功*检索图像后其地址栏中的 URL 与 Safari 在图像检索*失败*后在其地址栏中的 URL 之间的任何差异。

# sql - 如何在实体框架中手动添加复合关联？

> ID：579647
> 
> 赞同：7
> 
> 时间：2009-02-23T22:25:21.733
> 
> 标签：sql, visual-studio-2008, entity-framework, .net-3.5

这似乎是一个常见的情况，但无论出于何种原因，我都被 EF 的弱编辑器所阻碍。

我有两张桌子，像这样：

```
Table1
(
Column1 int, PK
Column2 int, PK
)

Table2
(
Column1 int, PK, FK
Column2 int, PK, FK
Column3 int, PK
) 
```

现在，数据库（我们无法控制）没有外键约束。在这个例子中，Table2 应该有一个外键约束，它在 (Column1, Column2) 上引用 Table1。换句话说，Table2 的前两列引用了 Table1 中的主键。这是任何普通数据库中的日常问题。

在其他框架中，例如 LLBLGenPro，我们可以以非常简单的方式手动添加关系。但是，我们无法弄清楚如何在 EF 的编辑器中实现这一点。这个“映射详细信息”窗口非常糟糕且不直观。到目前为止，我们已经成功地选择了映射中的各个表，但它似乎总是希望关联所有列。

有什么想法或参考吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-27T04:04:56.173

假设您有两个实体。

1.  右键单击 Table1 实体标题并选择添加关联。
2.  从右端选择 Table2。（在此向导中设置任何其他属性）
3.  选择新创建的关联并编辑映射。（应该已经被选中）
4.  在 Mapping Details 窗口中，选择 Table2

应该是这样的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T03:29:28.817

1.  Create "temporary" tables with same columns but proper FKs. Use a backup of the DB if you can't alter the "real" one. Don't bother mapping the tables without FKs. It may be easiest if you use a new model, as deleting in the designer doesn't remove store mappings.
2.  Map them with the wizard.
3.  Open the EDMX as XML (not in the designer)
4.  Search and replace the table names, using the tables you *really* want to map.
5.  Drop the "temporary" tables.

General advice: Edit EDMX manually when doing non-standard things. No FKs = non-standard. The GUI designer only handles certain cases.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-22T13:58:10.360

1.  右键单击 Table1 实体标题并选择添加关联。
2.  从右端选择 Table2。（在此向导中设置任何其他属性）
3.  **双击**新创建的关联并设置属性

# specifications - 如何证明编写规范胜过代码牛仔？

> ID：579651
> 
> 赞同：12
> 
> 时间：2009-02-23T22:27:16.127
> 
> 标签：specifications

所以我有一个问题。或者更确切地说，我的朋友有问题，因为我永远不会在互联网论坛上写我的公司。

在我朋友的公司，规范写作，容我们说，有点未充分利用。首先编写代码，然后再提出问题，这是一种根深蒂固的文化，无论是为了库例程还是新工具，都可以强加给长期受苦的设计师。

这当然会导致功能部分正确、不正确或完全丢失的情况（“哦，在尝试任何您可能想要撤消的操作之前先保存”）。这通常会导致那些糟糕的设计师失去生产力，或者在测试阶段主要花费在修复错误上来正确地实现事物。

我的朋友发现他关于编写（和测试）规范的建议普遍受到好评。他的大多数同事都接受了在纸上发现错误假设的美妙感觉，而不是在测试期间的周日晚上 11 点。革命万岁！

然而，有一些人会在他们的任务和键盘之间拉屎任何东西。他们嘲笑实际设计任何东西的想法，并愉快地编写代码。大多数是资深的、长期受雇的开发人员，不愿“浪费时间”。

问题在于，这第二批异端总是比第一批更快地产生东西（或至少是某种东西）。随后，这变成了“为像图像调整器这样简单的东西编写规范是没有意义的！哦，那些宽度！=高度或图像使用 RLE 的错误只需要一些调整”。

现在的问题:)

除了在项目结束时说“告诉你”之外，还有哪些好的短期方法可以证明编写功能或技术规范的实践如何在长期内带来更好的软件？

干杯!

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-23T22:36:48.630

目标是编写正确的软件……规范只是尝试查找/定义正确事物的一种工具。

我认为作为一个团队，需要决定如何构建正确的东西，以及如何在每个人之间进行沟通。

即，专注于真正的问题，然后就如何解决它达成共识。而不是说，“这是一个问题的解决方案，让我们去做吧！”，这通常不会得到每个人的认可。也可能是规范也不是解决问题的正确方法。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-23T22:50:02.577

规范击败牛仔的一个领域是“[范围蔓延](http://en.wikipedia.org/wiki/Scope_creep)”以及与之相关的成本。

规范是客户和开发人员之间的合同。如果您没有明确的合同，您如何知道合同何时已履行？

此外，拥有详细的规范可以更轻松地让两个或多个开发人员同时处理项目的不同部分。而且，它为测试人员提供了一些东西来比较软件，以确保该死的东西有效！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-23T22:32:40.747

这是相当困难的，因为办公室文化和工作习惯很难改变。但是，如果您对此非常认真，请尝试让管理层同意试验，其中将规范用于小型项目/模块，并且随着时间的推移对维护成本（时间、错误等）进行量化。

你可能不会以这种方式让其他开发人员站在你这边，但 $$ 比更抽象的开发实践更容易理解。poo-poo'ers 的管理层负责该团队的持续就业和绩效评估，因此这是说服他们改变或让他们在其他地方工作的一种方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T22:40:59.557

如果您有能力，请尝试让所有开发人员在对其他人的例程有任何疑问时直接询问原始编码人员。少数仍然认为规范和文档不重要的程序员可能愿意尝试几次，如果他们一直被困在回答“新手问题”中。

这正是几年前我在一家大型开发公司工作的场景，人们很快了解到他们要么必须大量记录他们的代码，要么冒着“浪费时间”来响应许多小问题的风险。

当然，这只有在你能让足够多的人尝试的情况下才可行:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T22:37:22.750

我认为如果您与整个团队一起编写规范可能会有所帮助。花时间一起做，小组讨论。我们通常在每次迭代开始时与整个团队举行这样的会议，如果需要，我们会与一些开发人员讨论更多细节。根据我的经验，没有必要讨论每一个细节，因为这对某些人来说很无聊。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T22:38:40.920

这通常需要时间——而这始终是问题所在。

编辑：

对于您自己的公司，我的意思是您的朋友，每当有东西必须改变并且规格不可用时，都需要记录下来。每当规范或文档可以节省时间时，记录该事件。记录花费的时间（研究人员和被询问、帮助的人（如果有的话）等在需要的时候不拥有它是值得的。

在某些情况下，写一个可能会有所回报，您可能会发现其他情况下它不是“需要”的。在实践中，收益可能如此之大，以至于最好在一开始就完成。

现在 - 警告：

*   你可能有不情愿的人。暂时不要试图说服他们。
*   您需要一个标准使用的存储库 - 位置或方式无关紧要，但它必须是一致且众所周知的，以便可以找到它们
*   他们必须保持最新和维护

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-24T01:37:04.050

将两种文化分成两个不同的组，提出您喜欢的绩效指标并将它们放宽。最好的小组获胜等等。

或者将他们指向一千种不同的定量/定性研究中的任何一种，这些研究可以科学地证明他的观点。

或者解雇所有牛仔和/或其他明智的要求，无论它惹恼了谁，都必须使用最低水平的规范。根据项目的复杂性，您可能只会意识到缺乏任何规范和文档实际上是多么有害，直到大多数原始开发人员离开为止。

或者将应用程序模块分包给一个纯粹的外包团队，看看缺乏规范和文档对他们的性能和满足关键指标的能力有多么不利。

或者向客户询问产品质量/成本/等。

如果他们的雇佣合同设计和执行得当，你的朋友就不会在项目结束时告诉开发人员“我告诉过你”，而是可以给他们他们的粉红单。

除此之外，您不必等到项目结束才知道存在问题，也不必进行人员变动。

或者劝你的朋友退出，加入一个开发方式和做法更符合自己喜好的店铺。“也许他只是在错误的地方。”

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-24T01:48:36.313

规范是关于知道做了什么。如果你不知道做什么，你怎么知道该回家了？

在最简单的情况下，开发人员是否与利益相关者交谈以了解他们想要什么？如果是这样，那么他们决定的就是“规范”。

把它白下来——实施它——然后回家。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T23:19:14.987

只是，告诉你的朋友，他们必须避免走向另一个极端，在规范完美和 100% 完成之前什么都做不了。而且编码每周都会延迟，因为有人在规范中添加了其他内容。有时这种方法可能需要 2 到 3 个月，之后高层管理人员会非常沮丧，并会说“我不在乎，我只想完成产品”，情况会更糟。

您可以通过保持流程敏捷（每周回顾、尽早交付、快速查找等）获得两全其美

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-24T01:30:56.293

规格是浪费时间。大多数将使用该软件的人无法说出他们想要什么，但他们可以知道他们得到的东西是否足够好。

出于同样的原因，原型制作很少起作用，他们无法判断此功能是尚未完成还是根本不会完成，所以他们会突然告诉你这一切都是错误的，你应该在他们实际需要时重做所有事情只是一个快速的调整。或者当他们最终意识到它不可用时，他们会告诉你这一切都很好，直到发布点。

最好的设计方式是走出去，看看他们过去是如何做事的，并尝试将您的应用程序融入他们的工作流程中。每个团队成员都应该这样做。

我并不是说你不能写下需求，而是将它们展示给你的实际用户是没有意义的。如果您单独处理该功能，您可以很好地掌握所有规范。

**简而言之**：不要编写规范，监视您的用户。确保所有团队成员都这样做。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-03-16T21:00:28.170

在规格上花费太多时间*是*浪费时间。我曾经参与过一个项目，销售、编写和交付一次性专业服务应用程序，之后老板要求我们编写规范。问题是，编写规范需要更长的时间，需要更多的人，并且比原来的应用程序成本更高，而原始应用程序永远不会被再次使用。

敏捷方法论说我们不应该因为文档而疯狂。相反，应该清楚地描述*需求并将其分配给各个团队和开发人员，并定期进行代码审查。*当您有一个称职的架构师时，这很有效，但如果项目领导没有资格确定团队不同部分所提出的不同方法的相对技术优势，则可能是灾难性的。

代码应该是自我记录的。应遵守规范标准。应仔细考虑和列举需求。但是你不需要的是一个 200 页的文档，描述每个模块中每一个怪异的代码行发生了什么，或者比代码本身更详细的注释。开发人员应该能够阅读这些内容。如果他们不能，那么你的问题就出在其他地方。

# iphone - iPhone SSL 客户端证书不起作用

> ID：579653
> 
> 赞同：1
> 
> 时间：2009-02-23T22:27:44.863
> 
> 标签：iphone, iis, ssl, certificate, x509

通过 iPhone 的 Safari 浏览器使用 RSA 证书对用户进行身份验证无法与 IIS 网站一起使用。我无法让它工作。IIS 只是放弃了“需要客户端证书”错误，而 safari 不提供证书。

客户：

*   iPhone 3G最新固件
*   已部署 CA 和用户证书（显示为未签名）

服务器：

*   IIS、Windows XP（网上也有关于 iis7 的未回答问题）
*   要求客户端证书设置已打开

证书：

*   RSA
*   用户和服务器一个 CA

笔记：

*   没有客户端身份验证的 SSL 运行良好。
*   我已经阅读了有关 iPhone 配置的 Dartmouth、UVa 和 MIT 说明——我猜这些是针对 wifi 的

我暂时无法解决的问题：

*   Safari 在握手期间返回加密警报 21（我想这是 TLS 的 decryption_failed 错误） - 为什么？
*   iPhone SSL 客户端身份验证的任何证书要求 - 在哪里？
*   有人通过 SSL 反向代理让它工作，例如 - 如何？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-24T21:53:48.993

找到使用 STunnel 反向代理的解决方法。

# firefox - 如何让我的 Firefox 扩展工具栏按钮自动出现？

> ID：579656
> 
> 赞同：8
> 
> 时间：2009-02-23T22:28:41.413
> 
> 标签：firefox, installation, toolbar

我创建了一个包含工具栏按钮的 Firefox 扩展。如何设置它，以便在安装我的扩展程序时，该按钮会自动出现在主工具栏中。我不希望我的用户必须转到自定义工具栏菜单并将我的按钮拖过来。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-24T01:33:16.133

来自[https://developer.mozilla.org/En/Code_snippets:Toolbar#Adding_button_by_default](https://developer.mozilla.org/En/Code_snippets:Toolbar#Adding_button_by_default) --

> 当您创建和部署扩展并通过覆盖自定义工具栏选项板为其包含工具栏按钮时，默认情况下它不可用。用户必须将其拖到工具栏上。以下代码将默认将您的按钮放在工具栏上。这应该只在安装后第一次运行您的插件时完成，这样如果用户决定删除您的按钮，它就不会在每次启动应用程序时再次出现。
> 
> 笔记
> 
> 默认情况下仅插入一次按钮，在首次运行时或在扩展更新添加新按钮时。
> 
> 请仅在默认情况下添加您的按钮，如果它为用户增加了真正的价值，并且将成为您的扩展的频繁入口点。
> 
> 您不得在以下任何元素之间插入工具栏按钮：组合后退/前进按钮、位置栏、停止按钮或重新加载按钮。这些元素在彼此相邻放置时具有特殊行为，如果被另一个元素分开，则会中断。

```
/**
 * Installs the toolbar button with the given ID into the given
 * toolbar, if it is not already present in the document.
 *
 * @param {string} toolbarId The ID of the toolbar to install to.
 * @param {string} id The ID of the button to install.
 * @param {string} afterId The ID of the element to insert after. @optional
 */
function installButton(toolbarId, id, afterId) {
    if (!document.getElementById(id)) {
        var toolbar = document.getElementById(toolbarId);

        // If no afterId is given, then append the item to the toolbar
        var before = null;
        if (afterId) {
            let elem = document.getElementById(afterId);
            if (elem && elem.parentNode == toolbar)
                before = elem.nextElementSibling;
        }

        toolbar.insertItem(id, before);
        toolbar.setAttribute("currentset", toolbar.currentSet);
        document.persist(toolbar.id, "currentset");

        if (toolbarId == "addon-bar")
            toolbar.collapsed = false;
    }
}

if (firstRun) {
    installButton("nav-bar", "my-extension-navbar-button");
    // The "addon-bar" is available since Firefox 4
    installButton("addon-bar", "my-extension-addon-bar-button");
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T02:42:06.000

我们正在使用以下代码....

```
function init() {

    // .... 

    var navbar = document.getElementById("nav-bar");
    if ((myExtensionShared.checkMyBtnInstalled() == false) &&
        (navbar != null && document.getElementById("myExtension-button") == null)) {
        var newset;
            if (navbar.getAttribute('currentset') && 
              navbar.getAttribute('currentset').indexOf('myExtension-button') == -1) {

                navbar.insertItem ('myExtension-button', null, null, false);
                newset = navbar.getAttribute('currentset') + ',myExtension-button';
                navbar.setAttribute('currentset', newset);
                document.persist('nav-bar', 'currentset');
            }
            else if (!navbar.getAttribute('currentset')) {

                navbar.insertItem ('myExtension-button', null, null, false);
                newset=navbar.getAttribute('defaultset') + ',myExtension-button';
                navbar.setAttribute('currentset', newset);
                document.persist('nav-bar', 'currentset');
            }

    }

    // .... 

}

myExtensionShared.prototype.checkMyBtnInstalled = function() {
    var prefs = Components.classes["@mozilla.org/preferences-service;1"]
                                       .getService(Components.interfaces.nsIPrefBranch);
    var btnInstalled = false;
    if (prefs.prefHasUserValue("extensions.myExtension.myBtnInstalled")) {
        btnInstalled = prefs.getBoolPref("extensions.myExtension.myBtnInstalled");
    }
    if (!btnInstalled) {
        prefs.setBoolPref("extensions.myExtension.myBtnInstalled", true);
    }
    return btnInstalled;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-19T17:50:47.010

这是我编写的一个小脚本片段，它在您的扩展程序第一次运行时向 Firefox 工具栏添加一个按钮：[在首次运行时将您的扩展程序的工具栏按钮添加到 Firefox](http://www.soyoucode.com/2011/add-extensions-toolbar-button-firefox-run)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-28T15:28:09.277

我们正在使用以下代码来附加按钮（如果已经存在于栏中的其他位置）。

```
//...
appendButtonInToolbar:function(buttonId, toolbarId) {
    var toolbar = document.getElementById(toolbarId);
    var button = document.getElementById(buttonId);
    if(button) {
        var parentBar = button.parentNode;          
        if(parentBar && parentBar != toolbar) {
            var newset = this.removeButtonFromToolbarCurrentSet(parentBar,buttonId);              
        }
        toolbar.appendChild(button);
    }else{          
        toolbar.insertItem(buttonId);
    }

    this.appendButtonInToolbarCurrentSet(toolbar,buttonId);
},

appendButtonInToolbarCurrentSet:function(toolbar, buttonId) {
    var oldset = toolbar.getAttribute("currentset");
    var newset = "";
    if(oldset && oldset!="") {
        newset = oldset + ",";
    }        
    newset += buttonId;        
    toolbar.setAttribute("currentset", newset);
    document.persist(toolbar.id,"currentset");
    return newset;
},

removeButtonFromToolbarCurrentSet:function(toolbar, buttonId) {
    var oldset = toolbar.getAttribute("currentset");
    if(!oldset || oldset=="" || oldset.indexOf(buttonId) == -1) return oldset;
    var reg = new RegExp(buttonId+",?", "gi");        
    var newset = oldset.replace(reg,"");
    if (newset.charAt(newset.length-1) == ",") {
       newset = newset.substring(0, newset.length - 1);
    }

    toolbar.setAttribute("currentset", newset);
    document.persist(toolbar.id,"currentset");
    return newset;
}, 
//... 
```

# javascript - 简单的 AJAX 脚本不会仅在主页上加载

> ID：579661
> 
> 赞同：1
> 
> 时间：2009-02-23T22:30:44.683
> 
> 标签：javascript, ajax, browser-security

我在左侧导航面板上的电子邮件脚本......在“Brad's Secrets of Attraction”下将不会加载到主页上。它适用于所有其他页面。

直播网站：[BradP.com](http://www.BradP.com) **网站可能是 NSFW**

这对我来说很奇怪。

有谁知道为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T22:41:54.797

萤火虫报告：

未捕获的异常：访问受限 URI 被拒绝 (NS_ERROR_DOM_BAD_URI) [打破此错误] eval(function(p,a,c,k,e,r){e=function(c)...h|borderTopWidth|abbr'.拆分('|'),0,{}))

它适用于 bradp.com 但不适用于 www.bradp.com 可能是因为您的基本 href 是 bradp.com。尝试删除基本 href 并查看是否可以修复它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T22:42:28.383

该脚本似乎仅在您**第一次**访问该页面时才加载（实际激活）。换句话说，当我刷新它时它没有加载，但是一旦我清除了我的 cookie，它就会加载。因此，它似乎是在某种 cookie 上触发的。这有帮助吗？

# mysql - 为什么我的图像存储为 MySQL longblob 仅部分显示？

> ID：579662
> 
> 赞同：2
> 
> 时间：2009-02-23T22:30:54.200
> 
> 标签：mysql, image

一位客户刚刚要求我解决他们网站的问题。我没有构建它，但这是正在发生的事情。

图像作为 longblob 存储在数据库中。在迁移到新服务器之前，一切正常。在新服务器上，**某些**图像仅显示部分。即使图像以所需的宽度和高度显示，但超过一半的图像是白色或灰色的。 **编辑：只有在服务器更改后上传的图像才会受到影响！**

这用于将图像读入字符串以进行数据库插入：

```
move_uploaded_file($_FILES['imagefile1']['tmp_name'],"tmppic.img")) 
$tmpstr = fopen("tmppic.img","rb");
$image = addslashes(fread($tmpstr,filesize("tmppic.img"))); 
```

以下是用于显示图像的 PHP 函数：imagecreatefromstring、imagecreatetruecolor、imagecopyresampled、imagejpeg

由于这在服务器移动后开始发生，我怀疑服务器配置。

到底是怎么回事？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T22:37:26.133

不知道这是否会杀死您，但是您绝对需要将其更改`addslashes()`为`mysql_real_escape_string()`. SQL 注入 哎呀...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T02:15:25.953

好的，想通了。看下面的代码。

```
if (move_uploaded_file($_FILES['imagefile1']['tmp_name'],"tmppic.img")){
$tmpstr = fopen("tmppic.img","rb");
$image = addslashes(fread($tmpstr,filesize("tmppic.img"))); 
```

上传的文件被移动到 tmppic.img 文件中。该文件经常被使用。问题是 filesize("tmppic.img") 返回**之前** `move_uploaded_file`文件的大小。因此，如果之前的 tmppic.img 文件大小为 120k，而新上传的文件更大，则仅读取 120K 的信息，因此图片中的灰色区域。

我通过将 filesize("tmppic.img") 替换为

```
$file_size = $_FILES['imagefile1']['size'];
$image = mysql_real_escape_string(fread($tmpstr,$file_size)); 
```

这是一个错误吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-02T15:46:18.873

确保您的图像字段设置为正确的 BLOB 类型。

我有同样的问题，这是一个非常简单的解决方案；我将图像字段设置为“Blob”，而不是“LongBlob”。我的数据库无法在字段中分配足够的空间来存储图像数据。将其更改为 LongBlog 并且效果很好！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T22:41:36.077

在服务器移动期间数据可能会损坏 - 特别是如果数据被转储然后重新插入。你能确认整个图像数据实际上在数据库中吗？

编辑：刚刚看到您对问题的编辑。您能否确认新图像已完全插入数据库？可能是插入问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T22:41:57.293

如果图像通过 ftp 传输到新服务器，则传输模式可能设置不正确（即 ascii 与二进制）。如果您以 ascii ftp 模式传输二进制文件，它可能会将图像中的某些字节解释为换行符并尝试将它们转换为 windows (CRLF) 或 UNIX(LF) 等模式。这通常会损坏图像，因此它不是完全可读的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T22:43:51.283

您使用的是什么 MySQL 库？MySQLi 库的某些版本在从数据库中正确检索 blob 时存在问题。

我将验证您是否在两台服务器上运行相同版本的 PHP 和相关的 MySQL 库。

# php - 当使用 php 和 mysql 从数据库中列出信息时，如何使第一行看起来与其他行不同？

> ID：579664
> 
> 赞同：2
> 
> 时间：2009-02-23T22:31:12.030
> 
> 标签：php, mysql, database, arrays, resultset

基本上我的数据库中有文章，我想改变第一条记录的显示方式。我希望最新（已发布）文章成为焦点，而较旧的文章仅列出，（请参阅[F1.com](http://www.formula1.com/)）。我需要知道如何在数组中获取我的第一个值并让它以不同的方式显示，但我不确定如何执行此操作，我可以这样做，以便所有行显示相同，而不是如何更改第一行。我还需要知道如何告诉其余的行在之后显示相同的内容，我猜你在那里使用了 if 语句，并且在此之前对行进行了某种计数。

* * *

### 当前代码：

```
 $result = mysql_query("SELECT * FROM dbArticle WHERE userID='".$_SESSION["**"]."' ORDER BY timestamp DESC");

while($row = mysql_fetch_array($result))
  {
  echo "<h2 class=\"heading1\">". $row['title'] ."</h2>";
  echo "By:  ".$row['username']."  Type: ".$row['type']."  Posted: ".$row['timestamp']." 
  $body = $row['body'];
  echo "<br/><p>";
  echo substr("$body",0,260);
  echo "...<span class=\"tool\"><a class=\"blue\" href=\"index.php?pageContent=readArticle&id=".$row['id']."\">Read More</a></span></p><hr/>";
  }
mysql_close($con); 
```

* * *

好的，我采用了 Luke Dennis 的代码并尝试对其进行测试，但我收到此错误：**警告：为 foreach() 提供的参数无效，**这是 foreach 语句的行。刚刚想到的是，我只希望显示 5 篇左右的旧文章。这就是我创建错误的原因：

```
<? $con = mysql_connect("localhost","****","***");
if (!$con)
  {
  die('Could not connect: ' . mysql_error());
  }

mysql_select_db("******", $con);

$result = mysql_query("SELECT * FROM dbArticle ORDER BY timestamp DESC");
$first = true;    
foreach($result as $row){
    if($first)
    {
        echo"".$row['title']."";
        echo"this is the headline";

        $first = false;
    }
    else
    {
        echo"".$row['title']."";

    }
}

?> 
```

我需要在某处添加 mysql_fetch_array 来设置数组吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T22:36:48.630

我将遍历结果并将 css 类应用于第一个条目：

```
$first = true;    
while ($row = mysql_fetch_assoc($result)) {
  $cssClass = '';
  if ($first) {
    $cssClass = 'highlight';
  }
  echo '<p class="' . $cssClass . '">' . $row['text'] . '</p>';
  $first = false;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T22:37:43.950

这有点粗糙，但我经常硬编码一个变量来指定循环的第一次运行。所以像：

```
$first = true;
foreach($list_of_items as $item)
{
    if($first)
    {
        // Do some stuff

        $first = false;
    }
    else
    {
        // Do some other stuff
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T22:37:03.000

循环遍历结果时的简单 if 语句通常可以解决问题。您可以使用布尔值来指示您是否已输出第一行结果或现在。如果你还没有，那么给它一个特定的样式，然后将布尔值设置为 true。然后所有后续行都会获得不同的样式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T23:15:27.150

以上所有内容均正确。卢克丹尼斯的帖子当然更加充实。

正如 Brian Fisher 所说，根据 Luke 的帖子在第一个链接中添加一些 CSS 样式。

我看了看F1网站上的文章列表。建造得很好的网站-“人们会期望的。” :-)

无论如何，文章列表都包含在一个两行表（summary="Latest Headlines"）中，按降序排列（最新的在前）。

只需在第二列中放置一个类 (<td class="first-news-article">)。然后在 css 文件中添加类名和适当的样式值 - 可能是你的 modules.css。该文件中已经有很多与文章关联的类值，因此您可以只使用现有值。

这应该是关于它 - 除了实际做它！

顺便说一句，从底层 html 的质量来看，我假设已经有一个“文章列表发射器”。只需找到该发射器并放置适当的条件来测试第一条记录。

达雷尔

*我刚刚注意到您的代码添加。我假设您以 F1 站点为例。无论如何，我认为你正在路上。*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T22:37:28.647

我想你有一些代码循环通过你的结果集并将它们打印到页面中？你能把这段代码粘贴进去吗，这可能会给我们一个帮助你的起点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-24T21:02:42.983

我会使用[`array_shift()`](http://php.net/array-shift)：

```
$result = mysql_fetch_assoc($resultFromSql); // <- edit
$first = array_shift($result);
echo '<h1>'.$first['title'].'</h1>';

foreach ($result as $row) {
  echo '<h2>'.$row['title'].'</h2>';
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-24T21:23:56.520

我不懂 PHP，所以我会用 Perl 对其进行伪代码。我不会这样做：

```
my $row_num = 0;
for my $row ($query->next) {
    $row_num++;

    if( $row_num == 1 ) {
        ...format the first row...
    }
    else {
        ...format everything else...
    }
} 
```

循环内的 if 语句不必要地使循环逻辑混乱。这不是性能问题，而是代码可读性和可维护性问题。这种事情只是在寻找一个错误。利用它是数组中的第一件事这一事实。这是两件不同的事情，用两段不同的代码来做。

```
my $first = $query->next;
...format $first...

for my $row ($query->next) {
    ...format the row...
} 
```

当然，您必须通过使用标签使第一行脱颖而出。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-24T20:03:25.887

最好的方法是在 while 循环之前放置一个 fetch 语句。

在 while 循环中放置一个仅对一次迭代有效的测试对于数百万行的结果可能是浪费时间。

# c# - 如何显示超过 63 个字符的系统托盘工具提示？

> ID：579665
> 
> 赞同：21
> 
> 时间：2009-02-23T22:31:23.467
> 
> 标签：c#, winforms, systray

如何显示超过 63 个字符的系统托盘工具提示？NotifyIcon.Text 有 63 个字符的限制，但我看到 VNC Server 的工具提示更长。

我怎样才能做 VNC 服务器所做的事情？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-24T02:44:57.413

实际上，这是 Text 属性的属性设置器中的一个错误。Windows 窗体中 NOTIFYICONDATA 的 P/Invoke 声明使用 128 个字符的限制。你可以用反射来破解它：

```
using System;
using System.Windows.Forms;
using System.Reflection;

    public class Fixes {
      public static void SetNotifyIconText(NotifyIcon ni, string text) {
        if (text.Length >= 128) throw new ArgumentOutOfRangeException("Text limited to 127 characters");
        Type t = typeof(NotifyIcon);
        BindingFlags hidden = BindingFlags.NonPublic | BindingFlags.Instance;
        t.GetField("text", hidden).SetValue(ni, text);
        if ((bool)t.GetField("added", hidden).GetValue(ni))
          t.GetMethod("UpdateIcon", hidden).Invoke(ni, new object[] { true });
      }
    } 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-24T01:28:13.243

从 Win32 [NOTIFYICONDATA 结构](http://msdn.microsoft.com/en-us/library/bb773352(VS.85).aspx)的 MSDN 文档中：

> **szTip**
> 
> 一个以 null 结尾的字符串，它指定标准工具提示的文本。它最多可以有 64 个字符，包括终止空字符。
> 
> 对于 Windows 2000（Shell32.dll 5.0 版）及更高版本，szTip 最多可以有 128 个字符，包括终止空字符。

看起来 Windows 窗体库在这里支持最低公分母。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T02:18:13.107

扩展 bk1e 的正确答案。

在后台，WinForms 中的系统托盘图标被实现为 Win32 通知图标。因此，winforms 版本具有与本机版本一样的所有限制。工具提示大小限制只是一个例子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-12T10:09:40.147

我最近遇到了一个类似的问题。我没有破解后端，而是实现了一种变通方法，它利用了 BalloonTipText，它可以容纳相当多的字符。

工具提示显示在托盘图标上的第一个 MouseMove 事件上，并且工具提示显示 2 秒。工具提示关闭后，可以通过新的 MouseMove 事件再次打开它。

此解决方案的唯一缺点是无法以编程方式关闭气球，例如，当用户离开图标区域时，它只会在超时或用户单击小 X 按钮后消失。

请注意，可以在程序的其他地方随时设置标题和文本。在活动中设置它们仅用于演示目的。

*编辑：* `ShowBalloonTip()`触发附加级联`MouseMove`事件，因此有必要禁用此事件，直到气球工具提示被隐藏。此外，`BalloonTipClosed`is（根据[文档](http://msdn.microsoft.com/en-us/library/system.windows.forms.notifyicon.balloontipclosed.aspx)）仅在用户主动单击“X”时触发，尽管我观察到它在超时后关闭工具提示时触发。因此，我添加了一个辅助计时器来重置状态，而不是依赖于`BalloonTipClosed`事件。修改和测试的代码如下：

```
 private bool balloonTipShown;
    private Timer balloonTimer;
    private void trayIcon_MouseMove(object sender, MouseEventArgs e)
    {
        if (balloonTipShown)
        {
            return;
        }
        balloonTipShown = true;
        trayIcon.MouseMove -= trayIcon_MouseMove;
        balloonTimer = new Timer();
        balloonTimer.Tick += balloonTimer_Tick;
        balloonTimer.Interval = 2005;
        balloonTimer.Start();
        trayIcon.ShowBalloonTip(2000);
    }

    void balloonTimer_Tick(object sender, EventArgs e)
    {
        balloonTipShown = false;
        balloonTimer.Stop();
        balloonTimer.Dispose();
        trayIcon.MouseMove += trayIcon_MouseMove;
    } 
```

[编辑 2：可以在 blog 中看到](http://stanislavs.org/bitcoin-miners-in-tray-miner-gui-manager/)使用此解决方案的带有大量文本的气球工具提示的屏幕截图。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2009-02-23T22:39:02.057

bk1e 在这里说限制是 128 个字符，现在，如果您使用 UTF-16，这是 Windows 尤其是 .NET 中的本机 unicode 格式，这意味着您被限制为 64 个*字符*，包括 NUL。

我相信您使用的 unicode API 将工具提示限制为 64 个 16 位字符（包括 null），而 VNC 服务器使用 ascii（或 ANSI）api，允许使用 128 个 8 位字符（包括空值）。

编辑：这个答案是错误的，这是 Cody Gray 的有用评论，解释了原因：

> 这个推理很有说服力，但实际上并不正确。当 MSDN 文档谈到“字符”时，它实际上是指数组中 char 或 wchar_t 项的数量（取决于您是否针对 Unicode）。因此，当您在 Windows 2000+ 上运行时，您将获得承诺的全部 128 个字符。Windows 9x 被限制为 64 个字符。– 科迪·格雷 6 月 19 日 4:11"

# windows - 在 Windows XP 和 200x 服务器中，多语言用户界面包是否足以进行本地化测试？

> ID：579671
> 
> 赞同：1
> 
> 时间：2009-02-23T22:33:44.317
> 
> 标签：windows, localization, multilingual

有没有人有任何应用程序只能与 MUI 一起使用但不能与本机操作系统一起使用的经验，反之亦然？或者有人知道开发本地化应用程序的开发人员应该注意的两个系统之间的区别吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T19:56:18.940

[请参阅Windows MUI](https://www.microsoft.com/globaldev/handson/dev/AppCompatInMUI.mspx) 中此应用程序兼容性的最佳实践部分

一般来说，如果您是 Unicode 应用程序并且您不检查系统区域设置并且您不硬编码任何常见的文件夹路径，则几乎没有区别。

# cocoa - 在 NSString 中转义换行符和双引号等字符的最佳方法

> ID：579672
> 
> 赞同：10
> 
> 时间：2009-02-23T22:33:52.430
> 
> 标签：cocoa, macos, string

假设我有一个 NSString（或 NSMutableString），其中包含：

```
I said "Hello, world!".
He said "My name's not World." 
```

把它变成：

```
I said \"Hello, world!\".\nHe said \"My name\'s not World.\" 
```

我是否必须`-replaceOccurrencesOfString:withString:`一遍又一遍地手动使用来转义字符，还是有更简单的方法？这些字符串可能包含来自其他字母/语言的字符。

这是如何在其他语言中使用其他字符串类完成的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-04-22T10:26:00.380

stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-24T00:57:50.057

我认为没有任何内置方法可以“转义”一组特定的字符。

如果您希望转义的字符定义明确，我可能会坚持使用您提出的简单解决方案，粗略地替换字符的实例。

请注意，如果您的源字符串中已经包含转义字符，那么您可能希望避免“双重转义”它们。实现此目的的一种方法是先遍历并“取消转义”字符串中的任何转义字符串，然后再将它们全部转义。

如果您需要支持一组可变的转义字符，请查看 NSScanner 方法“scanUpToCharactersFromSet:intoString:”和“scanCharactersFromSet:intoString:”。您可以在 NSScanner 上使用这些方法来浏览字符串，将“scanUpTo”部分中的部分原样复制到可变字符串中，并仅在转义后从特定字符集中复制部分。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-03-18T10:22:20.420

这将转义 NSString 中的双引号：

```
NSString *escaped = [originalString stringByReplacingOccurrencesOfString:@"\"" withString:@"\\\""]; 
```

所以你需要小心并逃脱转义字符......

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-11-04T05:23:46.383

我认为在这种情况下，一次操作一个字符很有用，无论是 UniChars 还是 UTF8 字节。如果您使用的是 UTF-8，那么`vis(3)`将为您完成大部分工作（见下文）。我能问一下为什么要在双引号字符串中转义单引号吗？你打算如何处理多字节字符？在下面的示例中，我使用 UTF-8，使用 C-Style 八进制转义对 8 位字符进行编码。这也可以通过 撤消`unvis(3)`。

```
#import <Foundation/Foundation.h>
#import <vis.h>

@interface NSString (Escaping)

- (NSString *)stringByEscapingMetacharacters;

@end

@implementation NSString (Escaping)

- (NSString *)stringByEscapingMetacharacters
{
    const char *UTF8Input = [self UTF8String];
    char *UTF8Output = [[NSMutableData dataWithLength:strlen(UTF8Input) * 4 + 1 /* Worst case */] mutableBytes];
    char ch, *och = UTF8Output;

    while ((ch = *UTF8Input++))
        if (ch == '\'' || ch == '\'' || ch == '\\' || ch == '"')
        {
            *och++ = '\\';
            *och++ = ch;
        }
        else if (isascii(ch))
            och = vis(och, ch, VIS_NL | VIS_TAB | VIS_CSTYLE, *UTF8Input);
        else
            och+= sprintf(och, "\\%03hho", ch);

    return [NSString stringWithUTF8String:UTF8Output];
}

@end

int
main(int argc, const char *argv[])
{
    NSAutoreleasePool *pool = [NSAutoreleasePool new];

    NSLog(@"%@", [@"I said \"Hello, world!\".\nHe said \"My name's not World.\"" stringByEscapingMetacharacters]);

    [pool drain];
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-18T06:04:10.327

这是我过去使用过的一个片段，效果很好：

```
- (NSString *)escapeString:(NSString *)aString
{
    NSMutableString *returnString = [[NSMutableString alloc] init];

    for(int i = 0; i < [aString length]; i++) {

        unichar c = [aString characterAtIndex:i];

        // if char needs to be escaped
        if((('\\' == c) || ('\'' == c)) || ('"' == c)) {
            [returnString appendFormat:@"\\%c", c];            
        } else {
            [returnString appendFormat:@"%c", c];
        }
    }

    return [returnString autorelease];   
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-06T14:30:45.060

做这个：

```
NSString * encodedString = (NSString *)CFURLCreateStringByAddingPercentEscapes(
    NULL,
    (CFStringRef)unencodedString,
    NULL,
    (CFStringRef)@"!*'();:@&=+$,/?%#[]",
    kCFStringEncodingUTF8 ); 
```

参考：[http ://simonwoodside.com/weblog/2009/4/22/how_to_really_url_encode/](http://simonwoodside.com/weblog/2009/4/22/how_to_really_url_encode/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-24T17:48:43.013

您甚至可能想考虑使用正则表达式库（有很多可用选项，RegexKit 是一种流行的选择）。找到一个预先编写的正则表达式来转义处理特殊情况（如现有转义字符）的字符串应该不难。

# c++ - 我的 win32 程序应该将其文件保存在哪里？

> ID：579673
> 
> 赞同：11
> 
> 时间：2009-02-23T22:34:19.933
> 
> 标签：c++, winapi

我们的 win32 应用程序（用 C++ 编写）已经存在了 10 多年，并且在保存文件的位置方面还没有更新以遵循“良好实践”。应用程序默认安装在“C:\AppName”文件夹中，并将应用程序生成的文件、配置文件、下载的文件和保存的用户文档保存在该文件夹的子文件夹中。

据推测，现在默认安装在“c:\Program Files\AppName”下是“最佳实践”。但是如果我们这样做了，我们应该把剩下的文件放在哪里呢？从Vista开始，写入程序文件文件夹是有问题的，而且似乎还有一百万个其他地方可以放置不同的文件，我很困惑。

有什么地方可以参考吗？

* * *

**编辑：扩展人们迄今为止提出的问题：**

* * *

我对 SHGetFolderPath 函数很熟悉，但是您可以从中获得很多选项，而且我找不到这样的资源：“这正是每个选项的用途，以及当您可能想使用它”。

到目前为止，我们已经完成了“所有文件，包括保存的用户文件，在一个文件夹下”的事情，并且工作正常 - 但当人们想要在 Program Files 文件夹下安装应用程序时就不行了。出于某种原因，Vista 所做的虚拟化对我们的应用程序不起作用。如果我们无论如何都要做出改变，我们不妨努力以“正确”的方式做事，因为我们不想在 12 个月后再次改变它。

* * *

**进一步的问题：**

* * *

我们在我们的应用程序中包含了一些“示例”文档，我们会不时更新这些文档。如果我们每隔几个月就会覆盖它们，将它们安装到我的文档中是否合适？或者我的文档是否被认为是完全安全的，用户可以随意使用？

如果我们无法将它们安装到我的文档中，我们应该将它们放在哪里以便用户可以轻松查看它们？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-23T22:40:10.167

> 据推测，默认安装在“c:\Program Files\AppName”下是“最佳实践”

关闭，但不完全。用户可以配置 Program Files 文件夹的名称，甚至可能没有 C: 驱动器。相反，安装到`%ProgramFiles%\AppName`环境变量文件夹。

请注意，您应该假设在安装完成后您只有对该文件夹的读取权限。对于您可能需要写入权限的程序数据文件，请使用`%AppData%\AppName`.

最后，您确定您的应用程序是唯一具有该名称的应用程序吗？如果您不是 100% 确定这一点，您可能还想在其中包含您的公司名称。

您用来检索这些变量的机制会因您的编程平台而异。它通常最终归结为`SHGetFolderPath()`Win32 方法，但 Java 或 .Net 等不同平台也可能提供更简单的抽象。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-23T22:42:23.487

此知识库文章中有一些指导原则：[如何使用 Visual C++ 编写将用户和应用程序数据存储在正确位置的 Windows XP 应用程序](http://support.microsoft.com/kb/310294)。此外，如果您在 MSDN 中搜索*Windows 徽标计划*，您将找到有关应用程序需要做什么才能真正兼容的文档。

[SHGetKnownFolderPath](http://msdn.microsoft.com/en-us/library/bb762188(VS.85).aspx)可以为您提供所需的目录。如果需要向后兼容 XP 和更早版本，请使用已弃用的 [SHGetFolderPath](http://msdn.microsoft.com/en-us/library/bb762181(VS.85).aspx)

话虽如此，如果您的应用程序附带说明“此应用程序使用的所有内容都在此目录中”的文档，我会*喜欢*它；）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-23T22:39:49.827

使用 Windows [SHGetFolderPath()](http://msdn.microsoft.com/en-us/library/bb762181(VS.85).aspx)函数获取正确的目录。

**编辑：**要回答您的其他问题，在编辑中添加：将应用程序的示例文件放在哪里很大程度上取决于您的应用程序是为单个用户还是为所有用户安装，以及安装应用程序的人是否可以被认为是使用它的人。

如果您的程序将由系统上的多个用户使用，则将内容复制到“我的文档”中是行不通的——只有安装应用程序的用户才能访问这些文件。更糟糕的是，如果您的应用程序的唯一用户需要以管理员身份安装，那么 [s] 他也将无权访问这些文件。因此，除非您相当确定您的应用程序只有一个用户，并且他们有足够的权限使用自己的帐户安装应用程序，否则不要使用“我的文档”。

IMO 您应该将示例文件安装到*CSIDL_COMMON_APPDATA*标识的目录中。这将为您提供所有用户的确切副本，并且由于您希望每个用户都能看到原始的、未更改的示例文件，因此所有用户都应该将它们视为只读文件。事实上，您的安装程序可能应该将它们设为只读。打开其中一个示例适用于所有用户，但一旦他们尝试保存修改，应用程序应该检测到该文件是只读的，并打开“另存为”对话框，指向“我的文档”或合适的里面的目录。当安装程序稍后更新示例文件时，这也将保留所有用户修改。

当然，用户要找到示例文件要困难一些。您可以将示例文件夹的链接添加到应用程序的开始菜单组，以便快速访问文件，当然您应该正确记录所有内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T22:53:19.717

对于您的应用程序二进制文件，您可以假设您可以写入 PROGRAM FILES 目录（使用 %ProgramFiles% 环境变量来支持默认英语版本以外的安装 - 例如，在德语安装中，默认为 c:\Programme）。[维基百科](http://en.wikipedia.org/wiki/Environment_variable)列出了最常见的变量。另一种选择是[SHGetFolderPath](http://msdn.microsoft.com/en-us/library/bb762181%28VS.85%29.aspx)或更新的[SHGetKnownFolderPath](http://msdn.microsoft.com/en-us/library/bb762188%28VS.85%29.aspx)函数。

对于用户数据，您应该假设应用程序以有限的访问权限运行，并且只能写入用户的主目录。同样适用于注册表项。该路径应该可由用户配置，因为主目录实际上可能是网络服务器，并且用户可能连接了第二个磁盘用于数据存储。有关当前 (Vista) 文件系统指南的信息，请参阅[这篇文章](http://www.microsoft.com/downloads/details.aspx?FamilyID=88AD7E7C-4068-48B8-9503-E160A6693BBA&displaylang=en)。

关于插件，这可能更复杂。最佳实践接缝提供仅为当前用户安装的选项，并将插件放置在用户目录中，或者为所有用户安装并将文件放入您的程序文件目录（但请记住检查写入权限并请求如果需要，提高访问权限）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T22:44:13.310

有很多环境变量，例如：%USERPROFILE%、%HOMEPATH%、%APPDATA% 所有这些都指向一些特定于用户的目录，您可以在其中放置特定于用户的文件。

对于系统范围的存储，您可以使用 %ALLUSERSPROFILE%，这是您应该放置不特定于任何用户的读/写数据文件的地方。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-23T22:41:11.007

c:\users 下有一个目录结构用于面向用户的数据。

有将应用程序从旧 Windows 操作系统移植到 Vista 的文档。

查看[http://www.innovateon.com](http://www.innovateon.com)并点击 Vista 的链接。有关于认证的文档，其中包含有关此类主题的详细信息。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-23T22:41:36.450

抱歉，我不知道正确答案，但是...

您是否有想要这样做的商业案例？您的客户是否抱怨文件未存储在他们期望的位置？您的应用程序是否因为您将文件存储在非标准位置而以某种方式瘫痪？如果不是，我认为没有理由花费时间和预算来重做文件存储策略以满足“最佳”实践。如果您的程序正常工作，那么恕我直言，您应该不理会它们，并将金钱和时间花在重要的事情上。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-02-23T22:40:52.180

大约 10 年前，我们使用 MFC 创建了一个类似的应用程序。最简单的做法是直接从 C:\ 创建一个文件夹（例如 C:\OurApp）。没有安装文件，没有特殊权限，没有注册表更改等。客户（尤其是他们的系统管理员）喜欢它。

另一个考虑因素 - 您是否打算突然更改现有客户端的安装文件夹（假设它安装在许多位置）？如果东西没有坏，为什么要修理它？

# .net - 我可以在 .NET 中重定向事件吗？

> ID：579676
> 
> 赞同：3
> 
> 时间：2009-02-23T22:35:38.727
> 
> 标签：.net, events

我有一堂正在赶上`System.Diagnostics.DataReceivedEventArgs`活动的班级。

我想让这个事件在外部可用。为了实现这一点，目前我正在内部捕捉到这一点并引发另一个事件，这对我来说似乎有点重复。

最好的方法是什么？我可以连接这些事件，这样我就不需要引发新事件了吗？

这是代码：

```
Class MyClass  

Public Event OutputDataReceived(sender As Object, e As System.Diagnostics.DataReceivedEventArgs)

Public Sub Action()
    ....
     AddHandler Process.OutputDataReceived, AddressOf ReadData
    ....
End Sub

  Private Sub ReadData(ByVal sender As Object, ByVal e As System.Diagnostics.DataReceivedEventArgs)
        RaiseEvent Me.OutputDataReceived(sender, e)
    End Sub

End Class 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T22:44:07.740

“捕捉”事件是什么意思？您可以做的一件事是公开您自己的事件，它只是将订阅/取消订阅传递给另一个事件：

```
public event DataReceivedEventHandler DataReceived
{
    add
    {
        realEventSource.DataReceived += value;
    }
    remove
    {
        realEventSource.DataReceived -= value;
    }
} 
```

有关事件的更多详细信息，请阅读[我关于该主题的文章](http://pobox.com/~skeet/csharp/events.html)- 如果有任何不清楚的地方，请告诉我。

编辑：这是 VB.NET 中的等价物：

```
Public Custom Event DataReceived As DataReceivedEventHandler
    AddHandler(ByVal value As DataReceivedEventHandler)
        AddHandler Me.realEventSource.DataReceived, value
    End AddHandler
    RemoveHandler(ByVal value As DataReceivedEventHandler)
        RemoveHandler Me.realEventSource.DataReceived, value
    End RemoveHandler
    RaiseEvent(ByVal sender as Object, ByVal args as DataReceivedEventArgs)
        Throw New NotSupportedException
    End RaiseEvent
End Event 
```

# python - 如何将字符串复制到剪贴板？

> ID：579687
> 
> 赞同：232
> 
> 时间：2009-02-23T22:38:02.607
> 
> 标签：python, windows, interop, clipboard

我正在尝试制作一个基本的 Windows 应用程序，它根据用户输入构建一个字符串，然后将其添加到剪贴板。如何使用 Python 将字符串复制到剪贴板？

* * *

## 回答 #1

> 赞同：337
> 
> 时间：2010-11-17T11:31:06.507

实际上，`pywin32`对于`ctypes`这个简单的任务似乎有点过头了。`Tkinter`是一个跨平台的 GUI 框架，默认情况下与 Python 一起提供，并具有剪贴板访问方法以及其他很酷的东西。

如果您只需要将一些文本放入系统剪贴板，就可以了：

```
from Tkinter import Tk
r = Tk()
r.withdraw()
r.clipboard_clear()
r.clipboard_append('i can has clipboardz?')
r.update() # now it stays on the clipboard after the window is closed
r.destroy() 
```

仅此而已，无需使用特定于平台的第三方库。

如果您使用的是 Python 3，请替换`TKinter`为`tkinter`.

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2012-02-23T09:06:00.927

我没有解决方案，只是一种解决方法。

Windows Vista 及更高版本有一个名为的内置命令`clip`，该命令从命令行获取命令的输出并将其放入剪贴板。例如，`ipconfig | clip`。

因此，我使用模块创建了一个函数，该`os`模块接受一个字符串并使用内置的 Windows 解决方案将其添加到剪贴板。

```
import os
def addToClipBoard(text):
    command = 'echo ' + text.strip() + '| clip'
    os.system(command)

# Example
addToClipBoard('penny lane')

# Penny Lane is now in your ears, eyes, and clipboard. 
```

然而，正如前面在评论中指出的那样，这种方法的一个缺点是该`echo`命令会自动在文本末尾添加换行符。为避免这种情况，您可以使用命令的修改版本：

```
def addToClipBoard(text):
    command = 'echo | set /p nul=' + text.strip() + '| clip'
    os.system(command) 
```

如果您使用的是 Windows XP，则只需按照*[从 Windows XP Pro 的命令提示符直接复制并粘贴到剪贴板](http://www.techrepublic.com/blog/window-on-windows/copy-and-paste-from-windows-xp-pros-command-prompt-straight-to-the-clipboard/521)*中的步骤操作即可。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2014-07-02T05:43:27.550

您可以使用[**pyperclip**](http://coffeeghost.net/2010/10/09/pyperclip-a-cross-platform-clipboard-module-for-python/) - 跨平台剪贴板模块。或[**Xerox**](https://github.com/kennethreitz/xerox) - 类似的模块，但需要 win32 Python 模块才能在 Windows 上运行。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2010-08-07T03:33:26.060

您还可以使用 ctypes 来利用 Windows API 并避免使用庞大的 pywin32 包。这就是我使用的（请原谅糟糕的风格，但想法就在那里）：

```
import ctypes

# Get required functions, strcpy..
strcpy = ctypes.cdll.msvcrt.strcpy
ocb = ctypes.windll.user32.OpenClipboard    # Basic clipboard functions
ecb = ctypes.windll.user32.EmptyClipboard
gcd = ctypes.windll.user32.GetClipboardData
scd = ctypes.windll.user32.SetClipboardData
ccb = ctypes.windll.user32.CloseClipboard
ga = ctypes.windll.kernel32.GlobalAlloc    # Global memory allocation
gl = ctypes.windll.kernel32.GlobalLock     # Global memory Locking
gul = ctypes.windll.kernel32.GlobalUnlock
GMEM_DDESHARE = 0x2000

def Get():
  ocb(None) # Open Clip, Default task

  pcontents = gcd(1) # 1 means CF_TEXT.. too lazy to get the token thingy...

  data = ctypes.c_char_p(pcontents).value

  #gul(pcontents) ?
  ccb()

  return data

def Paste(data):
  ocb(None) # Open Clip, Default task

  ecb()

  hCd = ga(GMEM_DDESHARE, len(bytes(data,"ascii")) + 1)

  pchData = gl(hCd)

  strcpy(ctypes.c_char_p(pchData), bytes(data, "ascii"))

  gul(hCd)

  scd(1, hCd)

  ccb() 
```

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2016-03-23T12:36:54.027

您可以使用具有内置剪贴板支持的优秀 pandas，但您需要通过 DataFrame。

```
import pandas as pd
df=pd.DataFrame(['Text to copy'])
df.to_clipboard(index=False,header=False) 
```

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2017-03-08T12:21:13.290

最简单的方法是使用[pyperclip](https://pypi.org/project/pyperclip/)。在 python 2 和 3 中工作。

要安装此库，请使用：

```
pip install pyperclip 
```

示例用法：

```
import pyperclip

pyperclip.copy("your string") 
```

如果要获取剪贴板的内容：

```
clipboard_content = pyperclip.paste() 
```

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2019-11-23T20:45:13.867

如果您可以依赖 Pandas，这是我发现的最简单可靠的方法。但是我不认为这正式成为 Pandas API 的一部分，因此它可能会随着未来的更新而中断。它从 0.25.3 开始工作

```
from pandas.io import clipboard
clipboard.copy("test") 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2014-09-05T03:11:03.157

出于某种原因，我一直无法让 Tk 解决方案为我工作。[kapace 的解决方案](https://stackoverflow.com/a/3429034/5987)更可行，但格式与我的风格相反，它不适用于 Unicode。这是一个修改后的版本。

```
import ctypes

from ctypes.wintypes import BOOL, HWND, HANDLE, HGLOBAL, UINT, LPVOID
from ctypes import c_size_t as SIZE_T

OpenClipboard = ctypes.windll.user32.OpenClipboard
OpenClipboard.argtypes = HWND,
OpenClipboard.restype = BOOL
EmptyClipboard = ctypes.windll.user32.EmptyClipboard
EmptyClipboard.restype = BOOL
GetClipboardData = ctypes.windll.user32.GetClipboardData
GetClipboardData.argtypes = UINT,
GetClipboardData.restype = HANDLE
SetClipboardData = ctypes.windll.user32.SetClipboardData
SetClipboardData.argtypes = UINT, HANDLE
SetClipboardData.restype = HANDLE
CloseClipboard = ctypes.windll.user32.CloseClipboard
CloseClipboard.restype = BOOL
CF_UNICODETEXT = 13

GlobalAlloc = ctypes.windll.kernel32.GlobalAlloc
GlobalAlloc.argtypes = UINT, SIZE_T
GlobalAlloc.restype = HGLOBAL
GlobalLock = ctypes.windll.kernel32.GlobalLock
GlobalLock.argtypes = HGLOBAL,
GlobalLock.restype = LPVOID
GlobalUnlock = ctypes.windll.kernel32.GlobalUnlock
GlobalUnlock.argtypes = HGLOBAL,
GlobalSize = ctypes.windll.kernel32.GlobalSize
GlobalSize.argtypes = HGLOBAL,
GlobalSize.restype = SIZE_T

GMEM_MOVEABLE = 0x0002
GMEM_ZEROINIT = 0x0040

unicode_type = type(u'')

def get():
    text = None
    OpenClipboard(None)
    handle = GetClipboardData(CF_UNICODETEXT)
    pcontents = GlobalLock(handle)
    size = GlobalSize(handle)
    if pcontents and size:
        raw_data = ctypes.create_string_buffer(size)
        ctypes.memmove(raw_data, pcontents, size)
        text = raw_data.raw.decode('utf-16le').rstrip(u'\0')
    GlobalUnlock(handle)
    CloseClipboard()
    return text

def put(s):
    if not isinstance(s, unicode_type):
        s = s.decode('mbcs')
    data = s.encode('utf-16le')
    OpenClipboard(None)
    EmptyClipboard()
    handle = GlobalAlloc(GMEM_MOVEABLE | GMEM_ZEROINIT, len(data) + 2)
    pcontents = GlobalLock(handle)
    ctypes.memmove(pcontents, data, len(data))
    GlobalUnlock(handle)
    SetClipboardData(CF_UNICODETEXT, handle)
    CloseClipboard()

paste = get
copy = put 
```

自从首次创建此答案以来，上述内容发生了变化，以更好地应对扩展的 Unicode 字符和 Python 3。它已经在 Python 2.7 和 3.5 中进行了测试，甚至可以与`\U0001f601 ()`.

2021-10-26 更新：这在 Windows 7 和 Python 3.8 中对我来说非常有用。然后我得到了一台装有 Windows 10 和 Python 3.10 的新计算机，它以与评论中所示相同的方式失败了。 [这个帖子](https://forums.autodesk.com/t5/maya-programming/ctypes-bug-cannot-copy-data-to-clipboard-via-python/td-p/9195866)给了我答案。来自的函数`ctypes`没有正确指定参数和返回类型，并且默认值与 64 位值不一致。我已经修改了上面的代码以包含缺失的信息。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2014-12-04T10:20:38.780

我尝试了各种解决方案，但这是通过[我测试](https://gist.github.com/CTimmerman/133cb80100357dde92d8)的最简单的解决方案：

```
#coding=utf-8

import win32clipboard  # http://sourceforge.net/projects/pywin32/

def copy(text):
    win32clipboard.OpenClipboard()
    win32clipboard.EmptyClipboard()
    win32clipboard.SetClipboardText(text, win32clipboard.CF_UNICODETEXT)
    win32clipboard.CloseClipboard()
def paste():
    win32clipboard.OpenClipboard()
    data = win32clipboard.GetClipboardData(win32clipboard.CF_UNICODETEXT)
    win32clipboard.CloseClipboard()
    return data

if __name__ == "__main__":  
    text = "Testing\nthe “clip—board”: "
    try: text = text.decode('utf8')  # Python 2 needs decode to make a Unicode string.
    except AttributeError: pass
    print("%r" % text.encode('utf8'))
    copy(text)
    data = paste()
    print("%r" % data.encode('utf8'))
    print("OK" if text == data else "FAIL")

    try: print(data)
    except UnicodeEncodeError as er:
        print(er)
        print(data.encode('utf8')) 
```

在 Windows 8.1 上的 Python 3.4 和 Windows 7 上的 Python 2.7 中测试正常。在使用从 Windows 复制的 Unix 换行符读取 Unicode 数据时也是如此。Python 退出后，复制的数据保留在剪贴板上：`"Testing the “clip—board”: "`

如果您不想要外部依赖项，请使用此代码（现在是跨平台的一部分`pyperclip`- `C:\Python34\Scripts\pip install --upgrade pyperclip`）：

```
def copy(text):
    GMEM_DDESHARE = 0x2000
    CF_UNICODETEXT = 13
    d = ctypes.windll # cdll expects 4 more bytes in user32.OpenClipboard(None)
    try:  # Python 2
        if not isinstance(text, unicode):
            text = text.decode('mbcs')
    except NameError:
        if not isinstance(text, str):
            text = text.decode('mbcs')
    d.user32.OpenClipboard(0)
    d.user32.EmptyClipboard()
    hCd = d.kernel32.GlobalAlloc(GMEM_DDESHARE, len(text.encode('utf-16-le')) + 2)
    pchData = d.kernel32.GlobalLock(hCd)
    ctypes.cdll.msvcrt.wcscpy(ctypes.c_wchar_p(pchData), text)
    d.kernel32.GlobalUnlock(hCd)
    d.user32.SetClipboardData(CF_UNICODETEXT, hCd)
    d.user32.CloseClipboard()

def paste():
    CF_UNICODETEXT = 13
    d = ctypes.windll
    d.user32.OpenClipboard(0)
    handle = d.user32.GetClipboardData(CF_UNICODETEXT)
    text = ctypes.c_wchar_p(handle).value
    d.user32.CloseClipboard()
    return text 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2009-02-23T22:43:08.647

看起来您需要将 win32clipboard 添加到您的站点包中。它是[pywin32 包的一部分](http://sourceforge.net/projects/pywin32/)

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2019-08-25T10:35:58.050

如果你不喜欢这个名字，你可以使用派生模块[`clipboard`](https://pypi.org/project/clipboard/)。

[[**注意：**它只是一个选择性的包装器`pyperclip`](https://github.com/terryyin/clipboard/blob/master/clipboard.py)]

安装后，导入：

```
import clipboard 
```

然后你可以像这样复制：

```
clipboard.copy("This is copied") 
```

您还可以粘贴复制的文本：

```
clipboard.paste() 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2021-03-23T10:57:56.577

# 使用`pyperclip`模块

使用 pip 安装`pip install pyperclip`。

*   [https://pypi.org/project/pyperclip/](https://pypi.org/project/pyperclip/)

### 将文本复制`"Hello World!"`到剪贴板

```
import pyperclip
pyperclip.copy('Hello World!') 
```

您可以使用`Ctrl+V`任何地方将其粘贴到某处。

### 使用python粘贴复制的文本

```
pyperclip.paste() # This returns the copied text of type <class 'str'> 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-10-26T04:00:27.160

小部件还有一个名为`.clipboard_get()`返回剪贴板内容的方法（除非根据剪贴板中的数据类型发生某种错误）。

该`clipboard_get()`错误报告中提到了该方法：http:
[//bugs.python.org/issue14777](http://bugs.python.org/issue14777)

奇怪的是，我通常参考的常见（但非官方）在线 TkInter 文档资源中没有提到这种方法。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2017-01-23T20:42:19.467

我认为有一个更简单的解决方案。

```
name = input('What is your name? ')
print('Hello %s' % (name) ) 
```

然后在命令行中运行你的程序

> 蟒蛇欢迎者.py | 夹子

这会将文件的输出通过管道传输到剪贴板

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2020-02-17T20:53:31.443

并非所有答案都适用于我的各种 python 配置，因此此解决方案仅使用 subprocess 模块。但是，`copy_keyword`必须`pbcopy`适用于 Mac 或`clip`Windows：

```
import subprocess
subprocess.run('copy_keyword', universal_newlines=True, input='New Clipboard Value ') 
```

下面是一些更广泛的代码，可以自动检查当前操作系统是什么：

```
import platform
import subprocess

copy_string = 'New Clipboard Value '

# Check which operating system is running to get the correct copying keyword.
if platform.system() == 'Darwin':
    copy_keyword = 'pbcopy'
elif platform.system() == 'Windows':
    copy_keyword = 'clip'

subprocess.run(copy_keyword, universal_newlines=True, input=copy_string) 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-09-24T10:34:55.110

除了[Mark Ransom](https://stackoverflow.com/a/25678113/11055225)使用 ctypes 的回答：这不适用于（所有？）x64 系统，因为句柄似乎被截断为 int 大小。显式定义参数和返回值有助于克服这个问题。

```
import ctypes
import ctypes.wintypes as w

CF_UNICODETEXT = 13

u32 = ctypes.WinDLL('user32')
k32 = ctypes.WinDLL('kernel32')

OpenClipboard = u32.OpenClipboard
OpenClipboard.argtypes = w.HWND,
OpenClipboard.restype = w.BOOL

GetClipboardData = u32.GetClipboardData
GetClipboardData.argtypes = w.UINT,
GetClipboardData.restype = w.HANDLE

EmptyClipboard = u32.EmptyClipboard
EmptyClipboard.restype = w.BOOL

SetClipboardData = u32.SetClipboardData
SetClipboardData.argtypes = w.UINT, w.HANDLE,
SetClipboardData.restype = w.HANDLE

CloseClipboard = u32.CloseClipboard
CloseClipboard.argtypes = None
CloseClipboard.restype = w.BOOL

GHND = 0x0042

GlobalAlloc = k32.GlobalAlloc
GlobalAlloc.argtypes = w.UINT, w.ctypes.c_size_t,
GlobalAlloc.restype = w.HGLOBAL

GlobalLock = k32.GlobalLock
GlobalLock.argtypes = w.HGLOBAL,
GlobalLock.restype = w.LPVOID

GlobalUnlock = k32.GlobalUnlock
GlobalUnlock.argtypes = w.HGLOBAL,
GlobalUnlock.restype = w.BOOL

GlobalSize = k32.GlobalSize
GlobalSize.argtypes = w.HGLOBAL,
GlobalSize.restype = w.ctypes.c_size_t

unicode_type = type(u'')

def get():
    text = None
    OpenClipboard(None)
    handle = GetClipboardData(CF_UNICODETEXT)
    pcontents = GlobalLock(handle)
    size = GlobalSize(handle)
    if pcontents and size:
        raw_data = ctypes.create_string_buffer(size)
        ctypes.memmove(raw_data, pcontents, size)
        text = raw_data.raw.decode('utf-16le').rstrip(u'\0')
    GlobalUnlock(handle)
    CloseClipboard()
    return text

def put(s):
    if not isinstance(s, unicode_type):
        s = s.decode('mbcs')
    data = s.encode('utf-16le')
    OpenClipboard(None)
    EmptyClipboard()
    handle = GlobalAlloc(GHND, len(data) + 2)
    pcontents = GlobalLock(handle)
    ctypes.memmove(pcontents, data, len(data))
    GlobalUnlock(handle)
    SetClipboardData(CF_UNICODETEXT, handle)
    CloseClipboard()

#Test run
paste = get
copy = put
copy("Hello World!")
print(paste()) 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-12-16T12:20:53.250

使用 python 的剪贴板库！

```
import clipboard as cp
cp.copy("abc") 
```

剪贴板现在包含“abc”。快乐粘贴！

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-08-16T07:41:13.500

你也可以使用 >`clipboard`

```
import clipboard

def copy(txt):
    clipboard.copy(txt)

copy("your txt") 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-04-14T16:41:37.057

```
import wx

def ctc(text):

    if not wx.TheClipboard.IsOpened():
        wx.TheClipboard.Open()
        data = wx.TextDataObject()
        data.SetText(text)
        wx.TheClipboard.SetData(data)
    wx.TheClipboard.Close()

ctc(text) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-02-18T23:13:47.243

这是*雾化器*的改进答案。

注意它们之间的 2 个调用`update()`和`200 ms`延迟。由于剪贴板状态不稳定，它们可以保护冻结的应用程序：

```
from Tkinter import Tk
import time     

r = Tk()
r.withdraw()
r.clipboard_clear()
r.clipboard_append('some string')

r.update()
time.sleep(.2)
r.update()

r.destroy() 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-04-10T11:23:10.287

我在这里分享的片段利用了格式化文本文件的能力：如果你想将复杂的输出复制到剪贴板怎么办？（在列中说一个 numpy 数组或某个东西的列表）

```
import subprocess
import os

def cp2clip(clist):

    #create a temporary file
    fi=open("thisTextfileShouldNotExist.txt","w")

    #write in the text file the way you want your data to be
    for m in clist:
        fi.write(m+"\n")

    #close the file
    fi.close()

    #send "clip < file" to the shell
    cmd="clip < thisTextfileShouldNotExist.txt"
    w = subprocess.check_call(cmd,shell=True)

    #delete the temporary text file
    os.remove("thisTextfileShouldNotExist.txt")

    return w 
```

仅适用于 Windows，我猜可以适用于 linux 或 mac。可能有点复杂...

例子：

```
>>>cp2clip(["ET","phone","home"])
>>>0 
```

任何文本编辑器中的 Ctrl+V ：

```
ET
phone
home 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-03-09T20:00:53.187

你可以使用winclip32模块！安装：

```
pip install winclip32 
```

复印：

```
import winclip32
winclip32.set_clipboard_data(winclip32.UNICODE_STD_TEXT, "some text") 
```

要得到：

```
import winclip32
print(winclip32.get_clipboard_data(winclip32.UNICODE_STD_TEXT)) 
```

更多信息：[https ://pypi.org/project/winclip32/](https://pypi.org/project/winclip32/)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-07-28T15:29:22.403

在 Windows 上，您可以使用它。没有外部依赖也不必打开子流程：

```
import win32clipboard

def to_clipboard(txt):

    win32clipboard.OpenClipboard()
    win32clipboard.EmptyClipboard()
    win32clipboard.SetClipboardText(txt)
    win32clipboard.CloseClipboard() 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-10-26T05:50:35.147

如果（且仅当）应用程序已经使用 Qt，您可以使用它（优点是没有额外的第三方依赖）

```
from PyQt5.QtWidgets import QApplication
clipboard = QApplication.clipboard()

# get text (if there's text inside instead of e.g. file)
clipboard.text()

# set text
clipboard.setText(s) 
```

**这要求已经构造了一个 Qt 应用程序对象**，因此除非应用程序已经使用 Qt，否则不应使用它。

此外，像往常一样，在 X 系统（可能还有其他系统）中，除非您使用 parcellite 或 xclipboard 之类的东西，否则内容只会持续到应用程序存在为止。

文档：

*   [QGui应用类 | Qt 图形用户界面 5.15.6](https://doc.qt.io/qt-5/qguiapplication.html#clipboard)
*   [QClipboard 类 | Qt 图形用户界面 5.15.6](https://doc.qt.io/qt-5/qclipboard.html#setText)

另请参阅：[python - PyQT - 将文件复制到剪贴板 - 代码日志](https://stackoverflow.com/questions/6062382/pyqt-copy-file-to-clipboard)

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2015-11-05T09:19:09.213

复制剪贴板的代码片段：

*在名为 ( clipboard.py* )的模块中创建包装 Python 代码：

```
import clr
clr.AddReference('System.Windows.Forms')
from System.Windows.Forms import Clipboard
def setText(text):
    Clipboard.SetText(text)

def getText():
    return Clipboard.GetText() 
```

然后将上述模块导入您的代码中。

```
import io
import clipboard
code = clipboard.getText()
print code
code = "abcd"
clipboard.setText(code) 
```

我必须感谢 IronPython 中的博客文章*[剪贴板访问](http://mark-dot-net.blogspot.nl/2010/10/clipboard-access-in-ironpython.html)*。

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2018-03-24T10:49:13.917

你可以试试这个：

```
command = 'echo content |clip'
subprocess.check_call(command, shell=True) 
```

# log4net - 为什么使用 Log4Net 时文件名上会附加两次日期？

> ID：579688
> 
> 赞同：23
> 
> 时间：2009-02-23T22:38:09.783
> 
> 标签：log4net, rollingfileappender

我试图将日期添加到我的日志文件名中，并且通过遵循我在 stackoverflow 中找到的一些建议，我能够使其工作。一切正常，但由于某种原因，第一个文件总是将日期附加两次。

例如，我得到**log.2009-02-23.log.2009-02-23.log而不是****log.2009-02-23.log**。

 **我发现它很奇怪，仅供参考，这是一个非常简单的代码。这不像我让它在多线程环境中运行。

我的 log4net 配置：

```
<log4net>
<appender name="MyLog" type="log4net.Appender.RollingFileAppender">
    <file value="../../Logs/Mylog"/>
    <staticLogFileName value="false" />
    <appendToFile value="true"/>
    <rollingStyle value="Date"/>
    <datePattern value=".yyyy-MM-dd.lo\g" />
    <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%d{DATE} [%t] %-5p %c - %m%n"/>
    </layout>
</appender>
<root>
    <level value="INFO"/>
    <appender-ref ref="MyLog"/>
</root>
</log4net> 
```

任何想法为什么？

编辑：我想添加有关我正在测试的环境的信息。
-asp.net
-.net framework 2.0
-windows server 2003 64-bit service pack 2
-log4net 1.2.10

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-25T04:26:08.690

如果在初始化日志系统时访问日志文件时出现问题，则会发生这种情况。如果您两次初始化日志系统，如果您在另一个副本正在运行并写入日志文件时运行程序，或者如果您正在文本编辑器中编辑日志文件，则可能会发生这种情况。基本上任何在 log4net init 运行时导致日志文件写锁定的东西。

检查您的代码是否重复调用 log4net init - 例如，您可能是在构造函数中进行初始化，而不是在单例的静态构造函数或全局 init 中进行初始化。

如果您在“网络花园”配置中运行并且文件名中不包含 PID，也会发生这种情况，因为每个不同的网络服务器进程都试图写入同一个文件。如果使用网络花园并写入文件，请将 pid 添加到文件名模式中，以便每个服务器进程都有自己的文件。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-27T01:57:52.243

这是一个权限问题。至少这就是发生在我身上的事情。

我是使用 Log4Net 的新手，所以我不知道它有内部日志记录，但我发现了它，所以我尝试打开[内部日志记录](http://logging.apache.org/log4net/release/faq.html#Troubleshooting)。我不太确定它在说什么，但在我看来它正在做什么： 1\. 将日期附加到文件名。2\. 尝试访问要写入的文件（失败）。*3.再次*将日期附加到文件名。4\. 成功访问文件（现在文件名很奇怪）

在我知道这一点之前，我正在用谷歌搜索这个问题的解决方案，比如我在这个 stackoverflow 问题上的标题。那里没有那么多信息。我发现也许有人说它发生在某些人身上，但从未真正解释过原因或解决方案。有了这些新信息（+来自 Log4Net 的内部错误消息），我正在查看来自搜索引擎的不同线程。有了这个，我发现这可能是一个权限问题。

似乎编写应用程序对日志文件夹没有足够的权限。应用程序的默认标识通常是 NETWORK_SERVICE。在我给予文件夹更多权限（我给予它完全控制但我不知道使它工作的最低限度）之后，它工作得很好。

如果有人能比我更好地解释这一点，请随时编辑。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-10-13T21:35:14.440

我遇到了同样的问题。对我来说，这是将 RollingFileAppender 用于我的测试日志和使用 ReSharper 运行我的 NUnit 测试的组合。

事实证明，ReSharper 使用*两个*进程来运行测试：

![2 个任务运行者](https://i.stack.imgur.com/RWpNj.jpg)

这会在日志文件上创建一个竞争条件。

现在，如果我们更改日志文件名以包含进程 ID：

```
<appender name="MyLog" type="log4net.Appender.RollingFileAppender">
  <file type="log4net.Util.PatternString" value="MyLog.pid.%processid" />
  <appendToFile value="true" />
  <rollingStyle value="Composite" />
  <maxSizeRollBackups value="10" />
  <maximumFileSize value="10MB" />
  <staticLogFileName value="false"/>
  <datePattern value="_yyyy-MM-dd'.log'"/>
  <layout type="log4net.Layout.PatternLayout">
    <conversionPattern value="%d{HH:mm:ss.fff} [%15.15t] %-5p '%40.40c' - %m%n" />
  </layout>
</appender> 
```

问题已经解决了。每个文件都有自己的唯一名称：

> MyLog.pid.5440_2010-10-13.log
> MyLog.pid.1496_2010-10-13.log

注意[PatternString](http://logging.apache.org/log4net/release/sdk/log4net.Util.PatternString.html)用于“类型”。

希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T23:07:07.933

正如olle指出的那样。您的问题与“\ g”有关，您的 log4net 将其解释为另一种日期格式。尝试删除“.yyyy-MM-dd.lo\g”并将其替换为“yyyy-MM-dd”

“.log”不属于日期格式

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T09:26:35.840

我使用以下内容：

```
<param name="DatePattern" value="yyyy.MM.dd.\l\o\g"/> 
```

有了这个，我得到如下文件名：2009.02.23.log

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T22:41:57.463

试试`<datePattern value=".yyyy-MM-dd.lo\g" />`我不明白 \g 是干什么用的。

# asp.net - ASP.NET 中网站的最低安全权限是什么？

> ID：579689
> 
> 赞同：2
> 
> 时间：2009-02-23T22:38:14.853
> 
> 标签：asp.net, asp.net-mvc, iis, iis-7, permissions

有人可以指导我参考 IIS7 网站中每个 Web 文件夹的最低安全权限吗？

对于用户、管理员、系统、网络服务？

我也是`Network Service`SQL 的数据库所有者，这是必要的还是应该限制它的访问？

编辑：特别是 MVC 文件夹

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T18:04:29.983

我建议在 IIS 中创建一个应用程序池并将其 ID 设置为正确的帐户。然后，您只需授予该帐户对应用程序文件夹和数据库的访问权限（受信任的连接）。通过这种方式，您可以获得更多的控制权。

我绝对不会设置`Network Service`为 db_owner。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T22:46:38.810

不是直接的答案，但我通过让我的应用程序安装程序运行“aspnet_regiis -ga SomeDomain\SomeUser”来为服务帐户授予运行 ASP.NET 应用程序所需的所有权限来回避这个问题。

# c - 如何在 Windows 上交叉编译 C 代码以使二进制文件也可以在 Unix (Solaris/HPUX/Linux) 上运行？

> ID：579695
> 
> 赞同：5
> 
> 时间：2009-02-23T22:39:59.560
> 
> 标签：c, windows, unix, cross-platform, cross-compiling

我一直在研究[Cygwin](http://www.cygwin.com/) / [Mingw](http://www.mingw.org/) / [lcc](http://www.cs.princeton.edu/software/lcc/)，我希望能够在我的 Windows 上编译 perl 本机 C 扩展（最好在 cygwin 下），然后在 Solaris 和 HP unix 上运行它们而无需大惊小怪，这可能吗？

这一切都源于我最初的 perl cross-platform question [here](https://stackoverflow.com/questions/570762/how-can-i-create-a-portable-perl-when-i-cant-install-modules-on-the-target-host)。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-02-03T22:11:51.607

*（这是一个非常古老的问题，但缺少一些有用的信息——我亲自为 Solaris（SPARC 和 x86）、AIX、HP-UX 和 Linux（x86、x64）做过这个。）*

*   让 C++ 交叉编译比直接 C 更难。

*   不支持 HP-UX 32 位 PA-RISC，因为它使用 SOM 格式而不是 ELF，并且 binutils 不（并且可能永远不会）支持 SOM。换句话说，您只能交叉编译 64 位 PA-RISC。（需要 PA-RISC 2.0 芯片。）

*   如果可以的话，我会选择 mingw 而不是 cygwin。Cygwin 引入了很多令人头疼的文件权限问题和 cygwin1.dll 依赖项，这些问题可能很麻烦。但是，如果可能，请在 linux 上构建。一切都会更快，因为您运行的所有工具和脚本都是为快速操作的环境`exec`而设计的。`stat`Windows + NTFS 不是那种环境。

*   从 crosstools 脚本开始，但要准备好在这上面花费**大量**时间。

*   首先尝试使用最新的 gcc/binutuils，但如果您无法解决问题，请尝试回退到较旧的软件包。例如对于 Power3 (AIX) gcc 4.x 系列交叉编译器生成错误代码，3.x 很好。

*   复制本机库和标头时，请确保您是从您可能运行的最旧的机器上复制的。复制新的 libc 意味着您的代码不会在任何具有旧 libc 的机器上运行。

*   复制本机库和头文件时，您可能希望 'tar -h' 将符号链接转换为实际文件，还要注意在 Solaris 上，一些必需的 crt 对象文件被埋在 cc 目录中，而不是 /usr/lib 下

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T22:59:18.517

交叉编译器很难设置和正常工作。

考虑一下 NetBSD 的（人员）必须投入大量工作才能使交叉编译工作，而且他们运行的是相同的操作系统，只是架构不同。

您至少必须将所有头文件从其他操作系统复制到 Windows，并为目标操作系统/架构获取交叉编译器、链接器等。

这也很可能是不可能的——perl 和共享库可以用本机/非 gcc 编译器编译，这在 Windows 上根本不可用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-28T23:44:50.520

我同意[Douglas](https://stackoverflow.com/questions/579695/how-do-i-cross-compile-c-code-on-windows-for-a-binary-to-also-be-run-on-unix-sol/579771#579771)的观点，让一个交叉编译器运行起来非常困难。这通常是您最后的选择。如果您正在引导或为嵌入式设备制作二进制文件，那么交叉编译通常是您唯一的选择。在考虑交叉编译之前，您应该能够在 Cygwin 下编译自己的 gcc。要交叉编译，您需要构建一个 gcc 以在 windows 下运行，但这将为您的执行平台创建二进制文件。可以在[此处](http://www.delorie.com/howto/cygwin/cygwin-cross-howto.html)找到执行此操作的示例说明。

也许您想要交叉编译，因为您没有 root 和/或无法在您的目标平台上编译。例如，我有一个运行 Redhat Linux 的托管服务提供商。我可以运行 Perl CGI 脚本和相关模块，但我无法在目标机器上编译，而且我构建的库必须存在于我自己的目录中。

为了解决这个问题，我本可以尝试为我的目标平台进行交叉编译，但我决定在 Windows 上的 VM 中设置一个类似的主机。在 Cygwin 中，您可以创建一个脚本，将 ssh 放入您的虚拟机，复制您的源代码，并执行完整的配置/构建。最后一步是将二进制工件部署到我的托管系统上。

我已经成功地在 Windows 上的 VM 中运行了 Solaris 10 和 Open Solaris。不幸的是，您可能很难在 VM 下运行 HPUX。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-29T00:06:24.097

为什么不阅读“Grand Unified Builder”（[http://lilypond.org/gub/](http://lilypond.org/gub/)和[http://valentin.villenave.info/The-LilyPond-Report-11](http://valentin.villenave.info/The-LilyPond-Report-11)（第 4 节））

我不知道它是如何工作的，但是 GUB 允许 Lilypond 开发人员在一个 linux 机器上编译大约 11 个平台。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-24T14:04:18.620

在 Windows 上编译，然后使用 Wine 在任何 *nix 上运行它们。它大部分时间都运行良好。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-23T22:53:42.927

不，这在二进制级别是不可能的。各种操作系统和 CPU 在二进制级别上有很多差异。

但是您可以做的是使您的 C 扩展源兼容，以便它可以编译到不同的平台。C 被设计为一种“可移植的汇编语言”。只要您坚持使用跨平台的例程，它们通常会以相同的方式工作。您仍然需要进行测试，因为特定平台上可能存在错误。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-02-23T22:55:21.690

这无法做到……但是在 Solaris 或 HP 下重新编译代码有那么麻烦吗？

# vb.net - 在哪里可以找到一些带有 VB.NET 教程的网站？

> ID：579700
> 
> 赞同：1
> 
> 时间：2009-02-23T22:41:16.873
> 
> 标签：vb.net, visual-studio

我正在寻找一个类似于 W3Schools 的网站，该网站教授 VB.NET 2008 的基础知识。

如果不存在，我只想有一些好的教程来帮助我入门。几年前我做了一些基本的 VB.NET，但我需要刷新自己，有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T22:44:25.540

您可以在 MSDN 中找到 Visual Basic 教程：转到[Visual Basic 开发人员中心](http://msdn.microsoft.com/en-gb/vbasic/default.aspx)开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T22:57:17.303

这有一些非常好的截屏视频：http: [//windowsclient.net/learn/videos.aspx](http://windowsclient.net/learn/videos.aspx)

更多视频在这里：http: [//msdn.microsoft.com/en-us/vbasic/bb466226.aspx](http://msdn.microsoft.com/en-us/vbasic/bb466226.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T22:44:38.707

它的格式可能不如 w3schools，但 MSDN 可能是最适合您的地方。从我所看到的来看，他们有很好的文档，但我并没有在 VB 中工作太多。不过，这是链接。这应该是您正在寻找的大致内容。

[http://msdn.microsoft.com/en-us/vbasic/default.aspx](http://msdn.microsoft.com/en-us/vbasic/default.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T22:56:53.873

[Visual Basic 2005 的 101 个示例](http://msdn.microsoft.com/en-us/vbasic/ms789075.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T23:06:49.260

[learnvisualstudio.net](http://learnvisualstudio.net) 它不是免费的，但他们有很棒的视频教程

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-23T23:54:45.573

我知道这个适用于 VB.NET 2008：http: [//msdn.microsoft.com/en-us/vbasic/bb964686.aspx](http://msdn.microsoft.com/en-us/vbasic/bb964686.aspx)

您需要接受许可，然后下载一个 zip 文件，其中包含 VB.NET 2008 的各种示例。

# ubuntu - 如何运行两个节奏盒实例或如何对节奏盒进行编程以在 mp3 文件中的先前位置开始播放？

> ID：579704
> 
> 赞同：1
> 
> 时间：2009-02-23T22:41:37.293
> 
> 标签：ubuntu, mp3, media, gnome

我喜欢交替收听网络广播和其他东西，例如播客，但不喜欢在播客文件中失去我的位置。奇怪的是，有时在音频文件的快进过程中，节奏盒会退出。

或者不是有两个节奏盒实例，我是否能够编写一个程序，以便它可以自动返回到我正在收听的 mp3 文件中的先前位置（即当我返回播客部分时）。

编辑：我还希望能够打开节奏盒并自动或轻松地返回到我在关闭它之前正在收听的音频文件中的位置。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T10:38:59.660

Banshee ( [http://banshee-project.org/](http://banshee-project.org/) ) 允许您为曲目中的特定位置添加书签并稍后打开它们。它也是一款出色的媒体播放器，比起 Rhythmbox，我更喜欢它。

# postgresql - 仅当 Postgresql 中的列不为空时，如何强制执行约束？

> ID：579710
> 
> 赞同：8
> 
> 时间：2009-02-23T22:42:11.240
> 
> 标签：postgresql, constraints, unique-key

我想要一个仅在列不为空时强制执行约束的解决方案。我似乎无法在文档中找到执行此操作的方法。

```
create table mytable(
  table_identifier_a INTEGER,
  table_identifier_b INTEGER,
  table_value1,...) 
```

根据数据的性质，我将在创建表时拥有标识符 b 和一个值。在我们收到额外的数据后，我将能够填充标识符 a。在这一点上，我想确保 a`unique key of (identifier_a, value1)`但仅当 identifier_a 存在时。

希望这是有道理的，有人有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-24T02:06:42.853

嗯。唯一约束不会阻止多个 NULL 值。

```
CREATE TABLE mytable (
    table_identifier_a   INTEGER    NULL,
    table_identifier_b   INTEGER    NOT NULL,
    table_value1         INTEGER    NOT NULL,

    UNIQUE(table_identifier_a, table_identifier_b)
); 
```

请注意，我们可以在其中插入多个 NULL，即使 identifier_b 匹配：

```
test=# INSERT INTO mytable values(NULL, 1, 2);
INSERT 0 1
test=# INSERT INTO mytable values(NULL, 1, 2);
INSERT 0 1
test=# select * from mytable;
 table_identifier_a | table_identifier_b | table_value1 
--------------------+--------------------+--------------
                    |                  1 |            2
                    |                  1 |            2
(2 rows) 
```

但是我们不能创建重复的 (a,b) 对：

```
test=# update mytable set table_identifier_a = 3;
ERROR:  duplicate key value violates unique constraint "mytable_table_identifier_a_key" 
```

当然，您确实有一个问题：您的表没有主键。您可能有数据模型问题。但是你没有提供足够的细节来解决这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T22:54:58.977

如果在一个事务中完成整个操作是可行的，则可以更改 postgres 评估约束的时间，即：

```
START;
SET CONSTRAINTS <...> DEFERRED;
<SOME INSERT/UPDATE/DELETE>
COMMIT; 
```

在这种情况下，约束在提交时进行评估。请参阅： [Postgres 7.4 Doc - 设置约束](http://www.postgresql.org/docs/7.4/static/sql-set-constraints.html)或[Postgres 8.3 Doc](http://www.postgresql.org/docs/8.3/interactive/sql-set-constraints.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T02:41:23.880

实际上，我可能会将其分解为两张表。您正在对两种不同的事物进行建模。第一个是初始版本，只是部分的，第二个是完整的。一旦需要将第一种事物带到第二种事物所需的信息，将行从一个表移动到另一个表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T22:44:04.213

您可以使用触发器而不是约束来处理此问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T22:48:16.233

如果我是你，我会将表拆分为两个表，并可能创建根据需要组合它们的视图。

# git - 使用 gitosis 指定每个分支的权限？

> ID：579714
> 
> 赞同：10
> 
> 时间：2009-02-23T22:43:04.747
> 
> 标签：git, gitosis, gitolite

使用gitosis，是否可以指定写权限，让用户可以用自己的名字自由推送到分支，但不能与master合并？例如 $USER/test1 .. $USER/test5

这意味着您可以为每个项目仅托管一个存储库，而不是为同一项目托管多个存储库，特定于每个用户：

```
 project1-user1
 project1-user2
 project1-user3
 ...
 project5-user1
 project5-user2
 project5-user3 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-09-14T01:16:53.380

Gitolite项目提供了这个功能[。](http://sitaramc.blogspot.com/2009/08/gitolite-managing-multiple-git.html)这是在 Perl 中对 Gitosis 的重写。它的代码可以[在github上找到](http://github.com/sitaramc/gitolite)

当我第一次写这个答案时，它不支持`gitweb`或`git-daemon`集成，但现在支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-24T08:48:48.190

此脚本似乎按分支访问控制执行：

[http://www.kernel.org/pub/software/scm/git/docs/howto/update-hook-example.txt](http://www.kernel.org/pub/software/scm/git/docs/howto/update-hook-example.txt)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T04:36:03.977

Gitosis 控制对存储库的访问，但不是通过分支或提交。因此，您可以将 master 本身放在具有只读访问权限的存储库中，并让用户将他们的各个分支推送到另一个存储库（或每个用户一个，如您所说）。我还没有看到任何人扩展 gitosis 以获得更细粒度的控制。

如果你真的需要限制你的用户访问并且你想使用 Git，那么也许你应该只通过电子邮件获取补丁并将你的 repo 保持为只读。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-23T08:17:18.163

[Gitolite 很好地](https://github.com/sitaramc/gitolite)支持分支或标签名称的权限。

在 Pro GIT 书中，[本节](http://progit.org/book/ch4-8.html)详细解释了如何设置和配置每个分支的访问权限。在该页面中搜索“配置文件和访问控制规则”。

# c# - 如何将此 Java 代码移植到 C#？

> ID：579729
> 
> 赞同：0
> 
> 时间：2009-02-23T22:46:08.297
> 
> 标签：c#, java, design-patterns, reflection

我正在查看用 Java 实现的模式，并且对它如何与（可以移植到）C# 对齐有一些疑问。

爪哇：

```
class Foo
{
    private Class someClass;
    ...
}

class Bar
{
    private Field some Field;
} 
```

首先，Class 存储域对象的一个​​实例。看起来 Java 在类型上公开了反射方法，这些反射方法用于通过反射访问对象上的字段。什么类型在 C# 中是同义词？我会使用对象然后使用 MethodInfo 还是有更好的方法？

其次，Field 是框架中的类型，并通过以下方式分配：

```
someClass.getDeclaredField(fieldName) 
```

我应该使用的 .NET 框架中是否存在并行？

现在我创建了一个自定义对象来代替 Foo 中的 Class，并为 Field 创建了一个自定义对象。有没有首选的方法来做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T22:59:35.737

你可以看看[FieldInfo](http://msdn.microsoft.com/en-us/library/system.reflection.fieldinfo(VS.71).aspx)类型和[GetField](http://msdn.microsoft.com/en-us/library/aa332471(VS.71).aspx)方法。

代码可能看起来有点像：

```
class Foo
{
    public Type someClass;
    ...
}

class Bar
{
    private FieldInfo some_Field;

    public Assign(string fieldName)
    {
        Foo foo = new Foo();
        some_Field = foo.someClass.GetField(fieldName);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-25T08:25:50.423

您还可以使用以下方法获取该字段的值：

```
 foo.GetType().GetField("name").GetValue(foo).ToString() 
```

在这个例子中，我们假设类 foo 有一个名为“name”的字段。这有什么帮助？好吧，这样想：

```
private string getValueOfUnknownField(string fieldName)
{
    return(foo.GetType().GetField(fieldName).GetValue(foo).ToString());
} 
```

即使您更改类 foo 并向其添加新字段，也无需更改 getValueOfUnknownField 方法。

# iphone - 如何使用 UIImages 创建 UITableView？- 可可/Objective-C

> ID：579732
> 
> 赞同：0
> 
> 时间：2009-02-23T22:46:45.097
> 
> 标签：iphone, cocoa-touch, uitableview

我正在尝试使用类别表为 iPhone 创建一个应用程序。如果我选择一个类别，它将显示一个 UIImage。但是，我一直在研究它，但我不确定该怎么做。任何人都可以伸出援助之手吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T00:05:05.643

听起来最简单的解决方案是在基于导航的应用程序中使用 UITableView。（Apple 有关于如何使用它的示例）

使用您的类别加载表格。

当用户选择一个类别时，将一个新视图从 Nib 文件推送到导航堆栈上。

这将允许您对所有类别使用相同的 Nib，并且您只需将要加载的图像传递给类，该类处理将其加载到 UIImageView 中。

例如：

```
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
[tableView deselectRowAtIndexPath:indexPath animated:NO];

imageCatView *catView = [[imageCatView alloc] initWithNibName: @"imageCatView" bundle: nil];
catView.categoryID = [[[categories objectAtIndex: _selectedRow] objectForKey:@"CatID"] intValue];

[[self navigationController] pushViewController:catView animated:YES];
[catView release];
} 
```

# c - 将字符串分配给字符数组

> ID：579734
> 
> 赞同：84
> 
> 时间：2009-02-23T22:47:18.717
> 
> 标签：c

我对以下内容感到有些惊讶。

示例 1：

```
char s[100] = "abcd"; // declare and initialize - WORKS 
```

示例 2：

```
char s[100]; // declare
s = "hello"; // initalize - DOESN'T WORK ('lvalue required' error) 
```

我想知道为什么第二种方法不起作用。它应该看起来很自然（它适用于其他数据类型）？有人可以解释一下这背后的逻辑吗？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-02-23T22:54:14.020

初始化数组时，C 允许您用值填充它。所以

```
char s[100] = "abcd"; 
```

基本上是一样的

```
int s[3] = { 1, 2, 3 }; 
```

但它不允许您进行分配，因为`s`它是一个数组而不是一个空闲指针。的意思

```
s = "abcd" 
```

是分配 to 的指针值，`abcd`但`s`你不能改变`s`，因为那时没有任何东西指向数组。如果是- 一个可以指向任何东西的指针，
这可以并且确实有效。`s``char*`

如果你想简单地复制字符串，请使用[`strcpy`](https://www.tutorialspoint.com/c_standard_library/c_function_strcpy.htm).

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2009-02-23T22:52:56.673

C 中没有“字符串”之类的东西。在 C 中，字符串是 的一维数组`char`，以空字符 终止`\0`。由于不能在 C 中分配数组，因此也不能分配字符串。字面上的“你好”是语法糖`const char x[] = {'h','e','l','l','o','\0'};`

正确的方法是：

```
char s[100];
strncpy(s, "hello", 100); 
```

或者更好：

```
#define STRMAX 100
char    s[STRMAX];
size_t  len;
len = strncpy(s, "hello", STRMAX); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-23T22:49:29.163

初始化和赋值是两个不同的操作，在这里碰巧使用了相同的运算符（“=”）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T22:57:42.980

```
1    char s[100];
2    s = "hello"; 
```

在您提供的示例中， s 实际上是在第 1 行而不是第 2 行初始化的。即使此时您没有明确地为它分配值，编译器也这样做了。

在第 2 行，您正在执行赋值操作，并且不能像这样将一个字符数组分配给另一个字符数组。您必须使用`strcpy()`或某种循环来分配数组的每个元素。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-23T22:59:03.023

扩展[斯帕的答案](https://stackoverflow.com/questions/579734/assigning-strings-to-arrays-of-characters/579744#579744)

> 初始化和赋值是两个不同的操作，在这里碰巧使用了相同的运算符（“=”）。

可以这样想：

假设有 2 个函数，称为`InitializeObject`和`AssignObject`。当编译器看到`thing = value`时，它会查看上下文并`InitializeObject`在您创建新的`thing`. 如果你不是，它会调用`AssignObject`.

通常这很好，`InitializeObject`并且`AssignObject`通常表现相同。除了在处理 char 数组（和其他一些边缘情况）时，它们的行为不同。为什么要这样做？好吧，这是另一篇涉及堆栈与堆等等的帖子。

PS：顺便说一句，如果你曾经涉足 C++，以这种方式思考它也将帮助你理解复制构造函数和其他类似的东西

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-24T14:22:56.783

请注意，您仍然可以执行以下操作：

```
s[0] = 'h';
s[1] = 'e';
s[2] = 'l';
s[3] = 'l';
s[4] = 'o';
s[5] = '\0'; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-03-01T15:44:10.177

我知道这已经被回答了，但我想分享一个答案，我给在 C/C++ Facebook 组上问了一个非常相似的问题的人。

* * *

**数组没有赋值运算符函数*。**这意味着您不能简单地将 char 数组分配给字符串文字。为什么？因为数组本身没有任何赋值运算符。（*这是一个无法更改的 const 指针。）

> 数组只是一块连续分配的内存区域，数组的名称实际上是指向数组第一个元素的指针。（引自[https://www.quora.com/Can-we-copy-an-array-using-an-assignment-operator](https://www.quora.com/Can-we-copy-an-array-using-an-assignment-operator)）

要将字符串文字（例如`"Hello world"`or `"abcd"`）复制到 char 数组，您必须手动将字符串文字的所有 char 元素复制到数组中。

`char s[100];`这将初始化一个长度为 100 的空数组。

现在要将您的字符串文字复制到此数组中，请使用`strcpy`

`strcpy(s, "abcd");`这将从字符串文字中`"abcd"`复制内容并将其复制到`s[100]`数组中。

这是它正在做的一个很好的例子：

```
int i = 0; //start at 0
do {
    s[i] = ("Hello World")[i]; //assign s[i] to the string literal index i
} while(s[i++]); //continue the loop until the last char is null 
```

您显然应该使用`strcpy`这个自定义字符串文字复制器来代替，但它是一个很好的示例，它解释了`strcpy`基本原理是如何工作的。

希望这可以帮助！

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2015-07-21T02:30:44.937

你可以使用这个：

```
yylval.sval=strdup("VHDL + Volcal trance..."); 
```

其中 yylval 是 char*。strdup from 完成这项工作。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2012-10-08T20:27:30.793

我会用的是

```
char *s = "abcd"; 
```

# sql-server - 当我使用 CTE 进行 maxrecursion 时应该怎么做？

> ID：579747
> 
> 赞同：2
> 
> 时间：2009-02-23T22:49:46.930
> 
> 标签：sql-server, recursion, common-table-expression

我有一个 CTE 正在做一些递归。想象问题空间的最简单方法是在世界各地的汽车中使用的电阻器，并且您拥有所有这些信息。电阻器 A 用于板 B 和 C，用于 DashAssembly D、E、F...ZZ，用于汽车 AAA、AAB 和 AAC。

我让 CTE 与一个零件一起工作，检查了结果，一切都很好（使用 100 的 MAXRECURSION）。然后我添加了一个在零件树中更常见的零件。轰，坏了。我尝试将 MAXRECURSION 提高到 32767，但它仍然坏了。查看数据，这个特定的部分被到处使用。在第二级递归中，它有 426 个父级。依此类推，我认为是 6 级递归。这是有道理的（我认为）这是轰炸MAXRECURSION。

下一个问题是，B计划是什么？我从来没有做过任何不使用 CTE 的递归。

**更新**：答案是：确保你没有任何循环引用，并确保你的递归表正确过滤了它的连接（我没有正确地做第二个）。基本上我搞砸了，并认为我的问题是我疯狂的狂野数据，而不是我蹩脚的 sql 技能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T23:11:34.930

大多数情况下，如果你达到了递归限制，你将限制增加到 $BIGNUM 并且你仍然在达到它，这意味着你有一个循环引用。

您应该检查以确保您没有任何循环引用并且您的递归表正在正确过滤。

# css - CSS浮动与重叠

> ID：579753
> 
> 赞同：30
> 
> 时间：2009-02-23T22:51:46.163
> 
> 标签：css, z-index, css-float

我正在尝试为我正在处理的页面设置一个简单的水平选项卡结构，并且在浮动 div 与 z-index 结合时遇到了一些麻烦。

在浏览器中查看以下代码：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Untitled Document</title>
    <style type="text/css">
        #main { width: 500px; z-index: 1;}

        .left { float: left; width: 96px; background-color: red; border: 2px solid orange; z-index: 2; margin-right: -2px }
        .right { float: left; width: 396px; background-color: #09c; border: 2px solid green; z-index: 3; }

        .clear { clear: both; }
</style>
</head>

<body>
    <div id="main">
        <div class="left">
            LEFT
        </div>
        <div class="right">
            RIGHT
            <br />
            RIGHT
        </div>
        <div class="clear"></div>
    </div>
</body>
</html> 
```

为什么左 div 的橙色边框不与右 div 的绿色边框重叠？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-02-23T23:01:43.720

z-index 属性不适用于静态定位的元素。为了使用 z-index，CSS 还必须包含除静态之外的任何位置值（即相对、绝对、固定）。

```
.left { float: left; width: 96px; background-color: red; border: 2px solid orange; z-index: 3; margin-right: -2px; position: relative; }
.right { float: left; width: 396px; background-color: #09c; border: 2px solid green; z-index: 2; position: relative; } 
```

我想会给你你想要的。我添加了位置：相对；并将 .left 的 z-index 更改为 3（从 2）并将 .right 的 z-index 更改为 2（从 3）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-23T23:02:24.123

`z-index`对未定位的元素没有影响（例如`position:absolute;`）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-03-26T03:21:59.390

使用`position`元素上部的属性。添加`position:relative`到`.left`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T23:04:46.380

负数`margin-left`？

```
.right { float: left; width: 396px; background-color: #09c; border: 2px solid green; z-index: 3; margin-left: -5px;} 
```

# web-applications - 自动化 Web 应用程序的建议（工作流程未测试）

> ID：579760
> 
> 赞同：1
> 
> 时间：2009-02-23T22:55:01.723
> 
> 标签：web-applications

客户有一个主要用于捕获信息的遗留 Web 应用程序。该应用程序没有其他可用的接口，例如 Web 服务、API。

典型工作流程：

*   第一种形式：通过单选按钮选择“付款”的“操作类型”。选择“输入”</li>
*   第二种形式：通过单选按钮选择“Fine”的“Payment Type”。选择“输入”</li>
*   第三种形式：通过单选按钮选择“停车”的“精细类型”。选择“输入”。
*   第四种形式：输入停车罚款号码。选择“输入”。

后端系统查找此停车罚款号码的金额。

*   第五种形式：显示详细信息摘要。选择“输入”。弹出“确认您希望通过信用卡支付xx.xx的罚款”。选择“确定”。
*   第六种形式：输入信用卡详细信息。选择“输入”。
*   第七种形式：确认。

由于各种原因，客户希望通过文件提供这些详细信息。因此，我们将读取一条记录并将详细信息插入到上述相关字段中。

我们可以通过 Selenium 之类的工具捕获工作流程，但我们需要以某种方式修改“脚本”，因为文件中每条记录的详细信息都不同。

我们或许可以发送一系列 HTTP 帖子？

该解决方案必须在所有浏览器中运行，并且客户不希望必须在所有用户 PC 上安装插件等。

对如何交付没有限制，例如我们可以使用 Java、C#（首选）或其他任何东西。

做过类似事情的人有什么建议或建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T00:14:22.423

您将希望在*没有*浏览器的情况下使用 HTTP POST 请求来执行此操作。 **就简单性而言， Perl、Python 等脚本语言将是一个不错的选择**——在这种情况下，实际代码可能不会超过 30 行。

您基本上必须：

1.  可能会发出一个初始（设置）POST（用户名+密码）来模拟人工代理登录

然后，

2.  从输入文件中读取一组参数
3.  使用第一个表单的参数子集（例如操作类型）发出第一个 POST
4.  从 POST 回复中读取适用`<input type="hidden" name="..." value="...">`的标签（如果有）
5.  使用第二个表单的参数子集（例如支付类型）发出第二个 POST，以及`name=value`从上一步中的 POST 回复中读取的任何对
6.  从 POST 回复中读取适用`<input type="hidden" name="..." value="...">`的标签（如果有）
7.  使用第三个表单的参数子集（例如精细类型）发出第三个 POST，以及`name=value`在上一步中从 POST 回复中读取的任何对
8.  等等
9.  重复输入文件中的下一组参数

您可能还必须指示您的 HTTP 库不要丢弃 cookie，如果默认/已经没有配置为这样。

# python - 自动生成/更新表并使用 SQLite 的 Python ORM？

> ID：579770
> 
> 赞同：10
> 
> 时间：2009-02-23T22:59:10.607
> 
> 标签：python, sqlite, orm, auto-generate

我正在为我用 Python 编写的新桌面应用程序做一些原型设计，我想使用 SQLite 和 ORM 来存储数据。

我的问题是，是否有任何支持自动生成/更新数据库模式并使用 SQLite 的 ORM 库？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-23T23:05:02.010

[SQLAlchemy](http://www.sqlalchemy.org/)是支持 SQLite 的 Python ORM 空间中的绝佳选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-24T02:18:30.407

SQLAlchemy，与[sqlalchemy-migrate](http://code.google.com/p/sqlalchemy-migrate/)库一起使用时。

# c# - 运行 assoc 命令而不启动 cmd.exe

> ID：579774
> 
> 赞同：0
> 
> 时间：2009-02-23T23:00:00.277
> 
> 标签：c#, .net

我试图在尝试启动文件之前找到文件关联，找到该关联的最佳方法是使用 assoc 命令，我的问题是我可以通过某种 API 方式运行此命令吗？现在，应用程序启动一个 cmd 窗口来运行命令，然后解析输出。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T23:04:25.850

```
try
{
    Process.Start(@"C:\textfile.txt");
}
catch(Win32Exception e)
{
    Process.Start(@"C:\");
} 
```

为我工作。使用该文件启动关联的应用程序（记事本）。我意识到这不是异常处理的最佳方式，但它确实有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T23:06:07.827

查看[http://www.codeproject.com/KB/dotnet/System_File_Association.aspx](http://www.codeproject.com/KB/dotnet/System_File_Association.aspx)

# javascript - HTTP 请求，加载对 HTML 进行的 javascript DOM 操作

> ID：579776
> 
> 赞同：-1
> 
> 时间：2009-02-23T23:00:40.417
> 
> 标签：javascript, http, firefox, curl

我目前正在使用[cURL](http://curl.haxx.se/)来执行 HTTP 请求，并且效果很好。但是，我需要获取 javascript 代码并在 HTML 的上下文中执行它，使其像操作 Web 浏览器一样操作 DOM。

首先想到的是使用*firefox*，有一个命令行界面，所以我认为以编程方式执行 HTTP 请求会很容易（可能有一些附加组件），让它本机运行 javascript 并操作 DOM , 并得到操作后生成的 HTML。

然而，这比我预期的要难，因为异步获取数据会出现问题。

也许有人已经这样做了，可以给我一些关于什么是最好的解决方案的提示。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T23:53:09.120

您可能可以使用[Selenium 遥控器](http://seleniumhq.org/projects/remote-control/)来实现这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T15:08:15.150

我会推荐[Watir](http://wtr.rubyforge.org/)

> Watir，发音为 water，是用于自动化 Web 浏览器的开源 (BSD) Ruby 库系列。它允许您编写易于阅读和维护的测试。它简单而灵活。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-25T18:28:48.947

这就是你想要用于这样的事情：

[http://code.google.com/p/envjs/](http://code.google.com/p/envjs/)

# python - 在 Python 中更改函数内的基本（不可变）类型？

> ID：579782
> 
> 赞同：0
> 
> 时间：2009-02-23T23:03:12.563
> 
> 标签：python, variables, pass-by-reference

我正在使用一个 C++ SDK，其中有一个类似的函数（它有一个 python 包装器，但没有文档）：

```
getPos ( int uvId, float & u, float & v ) const 
```

如何在 Python 中指定以便更改传递的变量？

我尝试了这个例子，看看我是否可以修改函数内部的浮点数，但它不起作用，所以打印了 12.0：

```
def change ( a ) :

    a = 35.0

b = 12.0

change ( b )

print b 
```

那么如何调用这个可以在 Python 中更改 2 个外部浮点数的函数呢？

有关的：

*   [Python：变量范围和函数调用](https://stackoverflow.com/questions/575196/python-variable-scope-and-function-calls/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T23:11:23.243

在 Python 中：

```
def getPos(uvID):
    # compute u, v
    return u, v

# 
u, v = getPos(uvID) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T23:16:00.113

据我所知，Python 不支持按引用调用，因此您建议的确切代码不起作用（显然）。

为 C++ 函数生成 Python 包装器的工具（或人）必须做了一些特殊的事情来支持这个函数（希望如此，否则你将无法使用它）。你知道使用什么工具来生成包装器吗？

通常像这样的工具会生成某种容器数据类型：

```
b.value = 12.0
change(b)
print b.value 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-24T00:38:15.780

您将不得不求助于[ctypes](https://docs.python.org/library/ctypes.html)。

具体来说，请参阅[https://docs.python.org/library/ctypes.html#passing-pointers-or-passing-parameters-by-reference](https://docs.python.org/library/ctypes.html#passing-pointers-or-passing-parameters-by-reference)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T23:05:20.247

对于简单的情况，让函数返回新值。

对于更复杂的情况，您可以传入对象或列表并进行更改：

```
def foobar(alist):
    alist[0] = 10

blist = [42]
foobar(blist)
print blist[0] 
```

编辑：

对于包装 C++ 引用，没有任何标准方法（基本的 python 接口在 C 级别 - 不是 C++） - 所以它取决于 python 接口是如何实现的 - 它可能是数组，或者返回多个值。我不确定 boost.python 是如何处理它的，但你可以从那里开始，或者在调试器下查看参数是如何处理的。

# c++ - 如何在 Linux 中以编程方式检测 IP 地址更改？

> ID：579783
> 
> 赞同：33
> 
> 时间：2009-02-23T23:03:34.603
> 
> 标签：c++, linux

有没有办法使用 C++ 以编程方式检测 Linux 中本地计算机上的 IP 地址更改？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2010-03-01T01:38:15.810

给你..这没有轮询。

它只监听 RTM_NEWADDR 但如果你需要它应该很容易更改以支持 RTM_DELADDR

```
#include <stdio.h>
#include <string.h>
#include <netinet/in.h>
#include <linux/netlink.h>
#include <linux/rtnetlink.h>
#include <net/if.h>

int
main()
{
    struct sockaddr_nl addr;
    int sock, len;
    char buffer[4096];
    struct nlmsghdr *nlh;

    if ((sock = socket(PF_NETLINK, SOCK_RAW, NETLINK_ROUTE)) == -1) {
        perror("couldn't open NETLINK_ROUTE socket");
        return 1;
    }

    memset(&addr, 0, sizeof(addr));
    addr.nl_family = AF_NETLINK;
    addr.nl_groups = RTMGRP_IPV4_IFADDR;

    if (bind(sock, (struct sockaddr *)&addr, sizeof(addr)) == -1) {
        perror("couldn't bind");
        return 1;
    }

    nlh = (struct nlmsghdr *)buffer;
    while ((len = recv(sock, nlh, 4096, 0)) > 0) {
        while ((NLMSG_OK(nlh, len)) && (nlh->nlmsg_type != NLMSG_DONE)) {
            if (nlh->nlmsg_type == RTM_NEWADDR) {
                struct ifaddrmsg *ifa = (struct ifaddrmsg *) NLMSG_DATA(nlh);
                struct rtattr *rth = IFA_RTA(ifa);
                int rtl = IFA_PAYLOAD(nlh);

                while (rtl && RTA_OK(rth, rtl)) {
                    if (rth->rta_type == IFA_LOCAL) {
                        char name[IFNAMSIZ];
                        if_indextoname(ifa->ifa_index, name);
                        char ip[INET_ADDRSTRLEN];
                        inet_ntop(AF_INET, RTA_DATA(rth), ip, sizeof(ip));
                        printf("interface %s ip: %s\n", name, ip);
                    }
                    rth = RTA_NEXT(rth, rtl);
                }
            }
            nlh = NLMSG_NEXT(nlh, len);
        }
    }
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-24T01:05:41.893

在 C 中，要获取我使用的当前 IP：

```
 int s;
    struct ifreq ifr = {};

    s = socket(PF_INET, SOCK_DGRAM, 0);

    strncpy(ifr.ifr_name, "eth0", sizeof(ifr.ifr_name));

    if (ioctl(s, SIOCGIFADDR, &ifr) >= 0)
        printf("%s\n",
          inet_ntoa(((struct sockaddr_in *)&ifr.ifr_addr)->sin_addr)); 
```

将“eth0”替换为您正在查看的界面。您现在需要做的就是轮询更改。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T23:19:22.227

无论如何都不容易。每个 linux 发行版使用不同的位置来存储 IP 地址等（如果您考虑其他 UNIX 变体，则会有更多变化）。例如，您*可以*`/sbin/ifconfig`使用来获取接口的 IP 地址，但您甚至无法确定是否会在这个地方找到它，或者根本找不到，等等。

此外，如果您拥有该可执行文件，则必须设置一个线程调用它以获取给定时间段（例如 5 秒）的数据，并解释输出。它可能会有所不同，例如，如果您有桥梁等。也就是说，这并不容易。

我想到的一个解决方案是，如果你有机会使用 GNOME 或其他一些广泛的发行版作为 KDE，你可以依赖它们提供的消息/信息。例如，当设备发生变化时，向[DBUS 标准总线](http://www.freedesktop.org/wiki/Software/dbus)`NetworkManager`输出一个信号。您必须为这些信号实现一个​​侦听器。[这里](http://people.redhat.com/dcbw/NetworkManager/NetworkManager%20DBUS%20API.txt)的信息（现在不工作，所以这里有一个[缓存](http://209.85.229.132/search?q=cache:hUnwH0JfIUsJ:people.redhat.com/dcbw/NetworkManager/NetworkManager%2520DBUS%2520API.txt+network+manager+dbus+messages&hl=es&ct=clnk&cd=3&gl=es&client=firefox-a)）。请注意添加新接口或其中一个接口更改 IP 地址时的不同消息。这是我现在能想到的最好的方法。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-23T23:36:42.310

如果您的用户使用 NetworkManager，您可以通过 D-Bus 轮询 NetworkManager.Connection.Active 和 NetworkManager.IP4Config 以获得确定此信息的更多交叉分发方式。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-24T10:41:24.833

如果安装了 iproute2 并且您使用的是 2.6 内核，

```
/sbin/ip monitor 
```

将本地接口状态和地址的变化输出到标准输出。你的程序可以读取这个。

您也可以使用与 iproute2 工具相同的低级机制（我认为它是一个 netlink 套接字）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-11-16T21:34:37.307

ste 建议使用 ioctl SIOCGIFADDR 过去在技术上是正确的，不幸的是它对于现代 Linux 系统是不可靠的，在现代 Linux 系统中，单个接口可以有多个地址而不使用子接口（例如 eth0:1），就像现在已经过时的 ifconfig 所做的那样。

最好的办法是使用 glibc 2.3 中的 getifaddrs(3)：http: [//www.kernel.org/doc/man-pages/online/pages/man3/getifaddrs.3.html](http://www.kernel.org/doc/man-pages/online/pages/man3/getifaddrs.3.html)

不幸的是，它的效率有点低（您会返回所有接口上所有地址的链接列表，并且必须遍历才能找到您感兴趣的地址），但在大多数情况下，您可能不会每分钟检查一次以上左右，使开销可以忍受。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T23:08:38.883

一种方法是编写一个 cron 作业，其中包含对 gethost 系列库函数的调用。如果您使用 gethostbyname()，您可以比较 h_addr_list 的返回值。请参阅 man gethostbyname。

如果您想在程序中执行此操作，请生成一个执行相同操作的 pthread，然后休眠一段时间。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-05-30T00:53:42.803

用 C 语言完成测试示例，并在单独的线程中监视通知：

```
#include <sys/socket.h> // AF_INET, socket(), bind()
#include <ifaddrs.h> // struct ifaddrs, getifaddrs()
#include <netinet/in.h> // struct sockaddr_in
#include <arpa/inet.h> // inet_ntoa(), htonl()
#include <net/if.h> // if_indextoname()
#include <pthread.h>
#include <asm/types.h>
#include <linux/netlink.h>
#include <linux/rtnetlink.h>
#include <stdbool.h>

typedef enum {
    IP_ADDR_ADD,
    IP_ADDR_REMOVE
} ip_address_change_notification_type_t;

typedef void (*ip_address_change_notification_callback_t)(ip_address_change_notification_type_t type, uint32_t ipaddr, void *userdata);

static int ip_address_change_notification_socket = -1;
static pthread_t ip_address_change_notification_thread;
static ip_address_change_notification_callback_t ip_address_change_notification_callback;
static void *ip_address_change_notification_callback_userdata;

void *ip_address_change_notification_worker(void *arg)
{
    fprintf(stderr, "ip_address_change_notification_worker entered.\n");
    if (ip_address_change_notification_socket == -1) {
        goto done;
    }

    char buffer[4096];
    struct nlmsghdr *nlh = (struct nlmsghdr *)buffer;
    int len;
    while ((len = recv(ip_address_change_notification_socket, nlh, sizeof(buffer), 0)) > 0) {
        for (; (NLMSG_OK(nlh, len)) && (nlh->nlmsg_type != NLMSG_DONE); nlh = NLMSG_NEXT(nlh, len)) {
            if (nlh->nlmsg_type == RTM_NEWADDR) {
                fprintf(stderr, "Netlink: RTM_NEWADDR\n");
            } else if (nlh->nlmsg_type == RTM_DELADDR) {
                fprintf(stderr, "Netlink: RTM_DELADDR\n");
            } else {
                fprintf(stderr, "Netlink: nlmsg_type=%d\n", nlh->nlmsg_type);
                continue; // Some other kind of announcement.
            }

            struct ifaddrmsg *ifa = (struct ifaddrmsg *)NLMSG_DATA(nlh);
            struct rtattr *rth = IFA_RTA(ifa);
            int rtl = IFA_PAYLOAD(nlh);
            for (; rtl && RTA_OK(rth, rtl); rth = RTA_NEXT(rth,rtl)) {
                char name[IFNAMSIZ];
                uint32_t ipaddr;

                if (rth->rta_type != IFA_LOCAL) continue;
                ipaddr = *((uint32_t *)RTA_DATA(rth)); // In network byte-order.
                fprintf(stderr, "Interface %s %s has IP address %s\n", if_indextoname(ifa->ifa_index, name), (nlh->nlmsg_type == RTM_NEWADDR ? "now" : "no longer"), inet_ntoa(*((struct in_addr *)&ipaddr)));
                if (ip_address_change_notification_callback) (*ip_address_change_notification_callback)((nlh->nlmsg_type == RTM_NEWADDR ? IP_ADDR_ADD : IP_ADDR_REMOVE), ipaddr, ip_address_change_notification_callback_userdata);
            }
        }
    }

done:
    fprintf(stderr, "ip_address_change_notification_worker exited.\n");
    return (NULL);
}

bool begin_ip_address_change_notifications(ip_address_change_notification_callback_t callback, void *userdata)
{
    if (ip_address_change_notification_socket != -1) return false;

    ip_address_change_notification_callback = callback;
    ip_address_change_notification_callback_userdata = userdata;

    if ((ip_address_change_notification_socket = socket(PF_NETLINK, SOCK_RAW, NETLINK_ROUTE)) == -1) {
        perror("begin_ip_address_change_notifications socket");
        return false;
    }

    struct sockaddr_nl addr;
    memset(&addr, 0, sizeof(addr));
    addr.nl_family = AF_NETLINK;
    addr.nl_groups = RTMGRP_IPV4_IFADDR;
    if (bind(ip_address_change_notification_socket, (struct sockaddr *)&addr, sizeof(addr)) == -1) {
        perror("begin_ip_address_change_notifications bind");
        goto bail;
    }

    pthread_attr_t attr;
    pthread_attr_init(&attr);
    pthread_attr_setdetachstate(&attr, 1); // Preclude the need to do pthread_join on the thread after it exits.
    int err = pthread_create(&ip_address_change_notification_thread, &attr, ip_address_change_notification_worker, NULL);
    pthread_attr_destroy(&attr);
    if (err != 0) {
        fprintf(stderr, "Error creating ip address change notification thread.\n");
        goto bail;
    }

    return (true);

bail:
    close(ip_address_change_notification_socket);
    ip_address_change_notification_socket = -1;

    ip_address_change_notification_callback = NULL;
    ip_address_change_notification_callback_userdata = NULL;
    return false;
}

void end_ip_address_change_notifications(void)
{
    if (ip_address_change_notification_socket == -1) return;

    pthread_cancel(ip_address_change_notification_thread);

    close(ip_address_change_notification_socket);
    ip_address_change_notification_socket = -1;

    ip_address_change_notification_callback = NULL;
    ip_address_change_notification_callback_userdata = NULL;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-11-16T21:07:35.030

从 rtnetlink 的手册页：

描述

Rtnetlink 允许读取和更改内核的路由表。它在内核中用于在各种子系统之间进行通信，尽管这里没有记录这种用法，也用于与用户空间程序进行通信。网络路由、IP 地址、链接参数、邻居设置、排队规则、流量类别和数据包分类器都可以通过 NETLINK_ROUTE 套接字进行控制。它基于 netlink 消息，有关详细信息，请参阅 netlink(7)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-05-04T15:05:24.580

使用 libnl-3 库，检测链接和 ip4 地址变化。

参考 - [https://www.infradead.org/~tgr/libnl/doc/core.html#_introduction](https://www.infradead.org/%7Etgr/libnl/doc/core.html#_introduction)

```
#include <netlink/netlink.h>
#include <netlink/socket.h>
#include <netlink/msg.h>
#include <arpa/inet.h>
#include <iostream>

static char ip4Addr[INET_ADDRSTRLEN];

static int parseAddress(struct nlmsghdr *hdr)
{
    std::cout << "parseAddress" << std::endl;

    struct ifaddrmsg *iface = (struct ifaddrmsg *)nlmsg_data(hdr);

    struct nlattr *attrs[IFA_MAX + 1];

    if (nlmsg_parse(hdr, sizeof(struct ifaddrmsg), attrs, IFA_MAX, nullptr) < 0)
    {
        std::cerr << "problem parsing Netlink response" << std::endl;
        return -1;
    }

    if (attrs[IFA_ADDRESS] == nullptr)
    {
        std::cerr << "Address Never Received "
                  << std::endl;
        return -1;
    }

    inet_ntop(iface->ifa_family, nla_data(attrs[IFA_ADDRESS]), ip4Addr, sizeof(ip4Addr));

    if ((hdr->nlmsg_type == RTM_NEWADDR) && (iface->ifa_family == AF_INET))
    {
        std::cout << "IPv4 Address added : " << ip4Addr << std::endl;
    }

    if ((hdr->nlmsg_type == RTM_DELADDR) && (iface->ifa_family == AF_INET))
    {
        std::cout << "IPv4 Address deleted : " << ip4Addr << std::endl;
    }
    return 0;
}

static int parseLink(struct nlmsghdr *hdr)
{
    std::cout << "parseLink" << std::endl;
    struct ifinfomsg *iface = (struct ifinfomsg *)nlmsg_data(hdr);

    struct nlattr *attrs[IFLA_MAX + 1];

    if (nlmsg_parse(hdr, sizeof(struct ifinfomsg), attrs, IFLA_MAX, nullptr) < 0)
    {
        std::cerr << "problem parsing Netlink response" << std::endl;
        return -1;
    }

    if (attrs[IFLA_IFNAME] != nullptr)
    {
        if (hdr->nlmsg_type == RTM_NEWLINK)
        {
            std::cout << (char *)nla_data(attrs[IFLA_IFNAME]) << std::endl;
        }
        else if (hdr->nlmsg_type == RTM_DELLINK)
        {
            std::cout << (char *)nla_data(attrs[IFLA_IFNAME]) << std::endl;
        }
    }
    return 0;
}

static int receiveNewMsg(struct nl_msg *msg, void *arg)
{
    struct nlmsghdr *nlh = nlmsg_hdr(msg);
    int len = nlh->nlmsg_len;
    int type = nlh->nlmsg_type;
    while (nlmsg_ok(nlh, len))
    {
        if (type != RTM_NEWLINK && type != RTM_DELLINK && type != RTM_NEWADDR && type != RTM_DELADDR)
        {
            if (nlh->nlmsg_type == NLMSG_DONE)
            {
                std::cout << "message complete" << std::endl;
            }
            nlh = nlmsg_next(nlh, &len);
            continue;
        }
        if ((nlh->nlmsg_type == RTM_NEWLINK) || (nlh->nlmsg_type == RTM_DELLINK))
        {
            parseLink(nlh);
        }
        if ((nlh->nlmsg_type == RTM_NEWADDR) || (nlh->nlmsg_type == RTM_DELADDR))
        {
            parseAddress(nlh);
        }
        nlh = nlmsg_next(nlh, &len);
    }
    return 1;
}

int main(int argc, char const *argv[])
{
    struct nl_sock *sk;

    /* Allocate a new socket */
    sk = nl_socket_alloc();

    /*
    * Notifications do not use sequence numbers, disable sequence number checking.
    */
    nl_socket_disable_seq_check(sk);

    /*
    * Define a callback function, which will be called for each notification received
    */
    nl_socket_modify_cb(sk, NL_CB_VALID, NL_CB_CUSTOM, receiveNewMsg, nullptr);
    nl_socket_modify_cb(sk, NL_CB_FINISH, NL_CB_CUSTOM, receiveNewMsg, nullptr);

    /* Connect to routing netlink protocol */
    nl_connect(sk, NETLINK_ROUTE);

    /* Subscribe to link notifications group */
    nl_socket_add_memberships(sk, RTNLGRP_LINK, 0);
    nl_socket_add_memberships(sk, RTNLGRP_IPV4_IFADDR, 0);

    /*
    * Start receiving messages. The function nl_recvmsgs_default() will block
    * until one or more netlink messages (notification) are received which
    * will be passed on to my_func().
    */

    while (1)
        nl_recvmsgs_default(sk);

    return 0;
} 
```

# sharepoint - Moss Farm 问题（前端）Web 应用程序服务无法启动

> ID：579784
> 
> 赞同：0
> 
> 时间：2009-02-23T23:03:43.560
> 
> 标签：sharepoint, moss, sharepoint-2007

所以，我的苔藓农场里有三台服务器。一个数据库服务器和两个前端服务器...

在服务器 1 上，我可以正常访问我的 Web 应用程序并且服务运行正常。但是，在服务器 2 上，我无法启动 Web 应用程序服务；我在屏幕上收到一条错误消息，指出“检查服务器事件日志以获取其他错误信息”...

当我检查服务器上的事件日志时，我看到了这个错误......

执行服务实例（取消）配置作业时出错。服务实例：“Windows SharePoint Services Web 应用程序”（id“2d8886db-4b63-4841-bf48-4bd48d9a0c89）“1387”

有什么想法吗..？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T23:36:05.977

我猜想要么是服务器 2 上的 IIS 出现问题，要么服务器 2 上存在更深层次的 MOSS 问题。首先要弄清楚是哪个 Web 应用程序导致了问题。

在管理中心 > 应用程序管理 > Web 应用程序列表下。当您单击 Web 应用程序名称时，您将在查询字符串中看到它的 ID。（即 /applications.aspx?WebApplicationId= **ID-here**）

找到匹配的 ID，您就知道是 Web 应用程序有问题。检查以确保服务器 2 上 IIS 中的 Web 应用程序没有任何问题。

如果一切正常，我将从场中删除服务器 2 并重新添加到配置中。如果这不起作用，请从场中删除服务器 2，重新安装 MOSS，然后重新添加到场。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T07:59:52.680

我会检查用于 Web 应用程序的服务帐户是否具有必要的权限。转到中央管理，然后打开“操作”>“服务帐户”单击 Web 应用程序选择 Web 应用程序或检查哪些用户用于不同的 Web 应用程序。然后检查他们是否有必要的权利。我不记得他们是否需要成为服务器上的本地管理员，但至少我会尝试让他们成为本地管理员。然后检查他们是否拥有 SQL 服务器上的必要权限。我认为数据库创建者和作者是唯一必要的角色。但是我通常会提高权利，直到它起作用，然后再删除我认为不必要的权利。

# svn - 为什么 $Id$ 有时在 SVN 中不展开？

> ID：579790
> 
> 赞同：9
> 
> 时间：2009-02-23T23:06:20.543
> 
> 标签：svn

我正在做一个项目，我们正在积极使用`$Id$`subversion 生成的字符串在文档中写入版本号。比如我们解析这个字符串

```
$Id: filename 999 2009-02-23 22:51:29Z author $ 
```

并在文档标题页上打印“999”。

但是时不时地，在提交之后，信息会被删除，我们只剩下

```
$Id$ 
```

这显然会破坏一些事情。有谁知道为什么会发生？

* * *

好的，显而易见的答案是正确的；`svn:keywords`不再为该文件设置。但我发誓他们曾经是！知道如何/为什么`svn:keywords`会在没有人注意到/故意做任何事情的情况下从文件中清除吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-23T23:08:14.983

svn:keywords 属性可能没有在该文件上正确设置。您需要将其设置为（至少）“Id”：

```
svn ps svn:keywords 'Id' filename.txt 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-09-10T03:46:26.457

确保您的文件是 UTF-8 而不是 Unicode。Unicode 没有得到扩展，因为 SVN 认为这些不是文本文件......我使用记事本另存为 UTF-8 来解决问题

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T23:08:59.007

如果定义了 'svn:keywords' 属性，则仅在结帐时扩展关键字。使用 ViewSVN 等存储库浏览工具时，不应扩展它们，即。它们显示为 $Id$。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-24T08:21:28.913

您选择的答案是正确的。您还可以查看设置您的 auto-props 以自动启用关键字属性。见[http://svnbook.red-bean.com/en/1.1/ch07s02.html#svn-ch-7-sect-2.4](http://svnbook.red-bean.com/en/1.1/ch07s02.html#svn-ch-7-sect-2.4)

完成后，您偶尔可以从[http://subversion.tigris.org/tools_contrib.html运行 svn_apply_autoprops.py](http://subversion.tigris.org/tools_contrib.html)

svn_apply_autoprops.py 将检查您的 autoprops 设置并通过您的存储库进行所有设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T16:55:09.960

> 好的，显而易见的答案是正确的；svn:keywords 不再为该文件设置。但我发誓他们曾经是！知道如何/为什么 svn:keywords 会在没有人注意到/故意做任何事情的情况下从文件中清除吗？

我能想到的第一个原因是：如果文件是 svn 添加的，然后在第一次提交之前移动/重命名，则不应用自动属性。

在这种情况下使文件失去其属性的错误将在 Subversion 1.5.6 和 1.6.0 中得到解决。

# c# - 如果 ThreadPool 已满，如何让 Action.BeginInvoke 产生一个非线程池线程

> ID：579794
> 
> 赞同：1
> 
> 时间：2009-02-23T23:07:37.327
> 
> 标签：c#, multithreading, .net-3.5, asynchronous

在.net 3.5 中

试图`ThreadPool.QueueUserWorkItem(a=> {Work()});`在 ThreadPool 没有可用线程时导致 BeginInvoke 锁定。

```
void Work()
{
   Action executor = () = { DoSomething(); };
   IAsyncResult result = executor.BeginInvoke(null, null);

   using (WaitHandle hWait = result.AsyncWaitHandle)
   {
      if (hWait.WaitOne(timeoutMilliseconds))
      {
        executor.EndInvoke(result);
      }
      else
      {  throw new ImDyingException(); }
   }
} 
```

如何使 BeginInvoke 使用非池线程？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T23:12:01.497

你不能。听起来您正在过度使用游泳池。也许考虑一个受限制的队列/自定义线程池（即同步的生产者/消费者队列）？

（不要增加池大小；这几乎总是错误的做法）

# excel - 打开 Excel 文件以使用 VBA 读取而不显示

> ID：579797
> 
> 赞同：79
> 
> 时间：2009-02-23T23:08:38.413
> 
> 标签：excel, vba, file-io

我想使用宏搜索现有的 Excel 文件，但我不想在代码打开这些文件时显示这些文件。可以这么说，有没有办法让它们“在后台”打开？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-02-23T23:25:19.093

不确定是否可以在当前的 excel 实例中不可见地打开它们

您可以打开一个新的 excel 实例，将其隐藏，然后打开工作簿

```
Dim app as New Excel.Application
app.Visible = False 'Visible is False by default, so this isn't necessary
Dim book As Excel.Workbook
Set book = app.Workbooks.Add(fileName)
'
' Do what you have to do
'
book.Close SaveChanges:=False
app.Quit
Set app = Nothing 
```

正如其他人发布的那样，请确保在完成所有打开的工作簿后进行清理

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-08-13T15:46:04.817

如果这适合您的需求，我会简单地使用

```
Application.ScreenUpdating = False 
```

额外的好处是加速你的代码，而不是通过使用 Excel 的第二个实例来减慢它。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2012-01-16T11:54:22.520

要打开隐藏在现有 Excel 实例中的工作簿，请使用以下命令：

```
 Application.ScreenUpdating = False
    Workbooks.Open Filename:=FilePath, UpdateLinks:=True, ReadOnly:=True
    ActiveWindow.Visible = False
    ThisWorkbook.Activate
    Application.ScreenUpdating = True 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-08-13T15:58:28.150

即使您已经得到了答案，对于那些发现此问题的人，也可以打开 Excel 电子表格作为 JET 数据存储。从我用过的项目中借用连接字符串，它看起来有点像这样：

```
strExcelConn = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & objFile.Path & ";Extended Properties=""Excel 8.0;HDR=Yes"""
strSQL = "SELECT * FROM [RegistrationList$] ORDER BY DateToRegister DESC" 
```

请注意，“RegistrationList”是工作簿中选项卡的名称。网络上流传着一些教程，其中详细说明了以这种方式访问​​工作表可以做什么和不可以做什么。

只是想我会添加。:)

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2016-07-13T18:40:04.487

一种更简单的方法，不涉及操作活动窗口：

```
Dim wb As Workbook
Set wb = Workbooks.Open("workbook.xlsx")
wb.Windows(1).Visible = False 
```

据我所知，工作簿上的 Windows 索引应该始终是`1`. 如果有人知道任何会使这不真实的比赛条件，请告诉我。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2021-01-22T16:03:45.300

使用 ADO（**AnonJr**已经解释过）并利用**SQL**可能是从关闭的工作簿中获取数据而不以传统方式打开它的最佳选择。请观看此**[视频](https://www.youtube.com/watch?v=L0I24NGrUtc)**。

OTHERWISE，可能`GetObject(<filename with path>)`是最**简洁**的方式。工作表仍然不可见，但会出现在 VBE 的项目资源管理器窗口中，就像以传统方式打开的任何其他工作簿一样。

```
Dim wb As Workbook

Set wb = GetObject("C:\MyData.xlsx")  'Worksheets will remain invisible, no new window appears in the screen
' your codes here
wb.Close SaveChanges:=False 
```

如果您想阅读特定工作表，甚至不需要定义 Workbook 变量

```
Dim sh As Worksheet
Set sh = GetObject("C:\MyData.xlsx").Worksheets("MySheet")
' your codes here
sh.Parent.Close SaveChanges:=False 'Closes the associated workbook 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2014-07-22T19:07:53.643

iDevlop 和 Ashok 的答案的问题在于，根本问题是 Excel 设计缺陷（显然），其中 Open 方法未能遵守 Application.ScreenUpdating 设置为 False。因此，将其设置为 False 对这个问题没有任何好处。

如果由于启动第二个 Excel 实例的开销而导致 Patrick McDonald 的解决方案过于繁琐，那么我发现的最佳解决方案是通过尽快重新激活原始窗口来最小化打开的工作簿可见的时间：

```
Dim TempWkBk As Workbook
Dim CurrentWin As Window

Set CurrentWin = ActiveWindow
Set TempWkBk = Workbooks.Open(SomeFilePath)
CurrentWin.Activate      'Allows only a VERY brief flash of the opened workbook
TempWkBk.Windows(1).Visible = False 'Only necessary if you also need to prevent
                                    'the user from manually accessing the opened
                                    'workbook before it is closed.

'Operate on the new workbook, which is not visible to the user, then close it... 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-07-18T17:19:12.497

将工作簿打开为隐藏，然后将其设置为“已保存”，以便用户在关闭时不会收到提示。

```
Dim w As Workbooks

Private Sub Workbook_Open()
    Application.ScreenUpdating = False
    Set w = Workbooks
    w.Open Filename:="\\server\PriceList.xlsx", UpdateLinks:=False, ReadOnly:=True 'this is the data file were going to be opening
    ActiveWindow.Visible = False
    ThisWorkbook.Activate
    Application.ScreenUpdating = True
End Sub

Private Sub Workbook_BeforeClose(Cancel As Boolean)
    w.Item(2).Saved = True 'this will suppress the safe prompt for the data file only
End Sub 
```

这有点衍生于 Ashok 发布的答案。

虽然这样做不会提示您将更改保存回您读取的 Excel 文件。如果您从中读取的 Excel 文件旨在作为验证的数据源，这将非常有用。例如，如果工作簿包含产品名称和价格数据，则可以将其隐藏，并且您可以显示一个 Excel 文件，该文件代表一张发票，其中包含从该价目表验证的产品的下拉菜单。

然后，您可以将价目表存储在某处网络上的共享位置，并将其设为只读。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-23T23:43:27.333

从 Excel 的新实例中打开它们。

```
Sub Test()

    Dim xl As Excel.Application
    Set xl = CreateObject("Excel.Application")

    Dim w As Workbook
    Set w = xl.Workbooks.Add()

    MsgBox "Not visible yet..."
    xl.Visible = True

    w.Close False
    Set xl = Nothing

End Sub 
```

您需要记住在完成后进行清理。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T23:18:02.107

在 excel 中，隐藏工作簿，并将它们保存为隐藏。当您的应用加载它们时，它们将不会显示。

编辑：重新阅读后，很明显这些工作簿不是您的应用程序的一部分。这样的解决方案不适合用户工作簿。

# adsense - 如何让 Adsense 抓取我的动态网站，或者有更好的选择吗？

> ID：579801
> 
> 赞同：3
> 
> 时间：2009-02-23T23:09:00.427
> 
> 标签：adsense

问题是 AdSense 必须抓取您的网页才能制作合适的广告。如果我有动态内容或用户生成的内容，那么 AdSense 不适合。如何修改我的网站，以便 Adsense 爬虫可以访问它，或者我应该从另一个角度解决通过我的网站获利的问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T23:16:07.897

您的内容需要登录吗？

如果不是，那么谷歌没有理由不能抓取它。仅仅因为它的动态或用户生成并不意味着谷歌看不到它。

如果它不需要登录并且谷歌仍然无法抓取您的网站，那么您做错了什么并且您的网站一开始就不是很好的 SEO。

就其他广告网络而言，我想到了一些

*   突发媒体
*   价值点击媒体
*   卡萨莱媒体。

尽管请记住，这些通常比 Adsense 更难加入。

# c# - C# 将文本/数据流式传输到 zip/gpg 而不是向应用程序传递文件名？

> ID：579804
> 
> 赞同：1
> 
> 时间：2009-02-23T23:11:02.903
> 
> 标签：c#, zip, stream, pipe, gnupg

我目前有一个用 C# 编写的应用程序，它可以获取文件并使用 gpg.exe 对其进行加密

我要做的是，而不是 1\. 创建文件（通常来自数据库查询） 2\. 加密文件 3\. 删除未加密的文件

我想要

1.  将信息收集到内存中（到字典或列表或其他任何东西中）
2.  将文本/数据流式传输到 gpg.exe 以输出加密文件

我已经研究了 pipestream，将标准输入重定向到 gpg 进程等，但我还没有找到一种方法来欺骗 gpg.exe 接受流式传输的文本/数据而不是硬盘驱动器上的文件。

最初想如果我可以为 gpg 做，我也可以为 Zip 做，但我想知道这是否可能。找到了一些似乎与 php 相关的 popen 参考，但与 c# 无关。

本质上，我希望以编程方式执行以下操作，其中 text.txt 是内存中流式传输到应用程序的内容，而不是硬盘驱动器上的实际文件。

C:\Program Files\GNU\GnuPG>类型 C:\test.txt | zip > plubber.zip C:\Program Files\GNU\GnuPG>类型 C:\test.txt | gpg -er "mycomp_operations" > Test.pgp

感谢您提供的任何帮助:)

托尼！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T05:21:15.633

您可以使用 DotNetZip 在内存中创建一个 zip 文件，但我不知道这将如何与 gpg 内容交互。DotNetZip 可以进行 AES 加密，但这显然是与 PGP 或 GPG 不同的模型。

只需在 GPG 上进行快速谷歌搜索就可以找到
[此提示。](http://www.codeproject.com/KB/security/gnupgdotnet.aspx)

看起来他们在一个单独的进程中运行 gpg.exe，坐在那里等待输入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-20T22:45:39.377

请在以下位置查看 BouncyCastle C# 实现：

[http://www.bouncycastle.org/csharp/](http://www.bouncycastle.org/csharp/)

这将允许 GPG 在没有外部文件的情况下进行进程内加密和解密。我目前正在使用它为 BizTalk 管道组件做同样的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-02T09:39:00.917

Benton Stark 为 GnuPG 编写了一个很好的包装器，它演示了（除其他外）如何从流中获取数据，将其通过管道传输到 GPG 可执行文件中，并将输出写回流中 - 全部使用 C#。

本顿用他网站的链接回答[了另一个问题。](https://stackoverflow.com/questions/1214026/gnupg-wrapper-with-c-sharp)本顿写道：

> 您可以尝试使用我的 C#（和 VB.NET）的开源和免费 GnuPG 包装器。所有代码均通过 MIT 许可，非 GPL 限制。您可以在 Sourceforge.net 上找到带有源代码的版本。
> 
> [http://sourceforge.net/projects/starksoftopenpg/](http://sourceforge.net/projects/starksoftopenpg/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-27T19:49:48.290

使用我们的[SecureBlackbox](http://www.eldos.com/sbb/)组件，您可以避免调用外部程序进行 ZIP 或 PGP 操作。组件使用流操作，不需要临时文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T23:15:39.413

好吧，命名管道完成了您所讨论的大部分工作，但老实说，这不值得……在大多数情况下，临时文件是一种合理的方法。

# c++ - 仿真设计 - 数据流、耦合

> ID：579806
> 
> 赞同：2
> 
> 时间：2009-02-23T23:11:29.047
> 
> 标签：c++, simulation

我正在编写一个模拟，需要一些关于设计的提示。基本思想是生成给定随机过程的数据，然后用于各种计算。例如对于 1 次迭代：

*   流程 1 -> 为源 1 生成数据：x1
*   过程 2 -> 为源 1 生成数据：x2
*   等等

稍后我想对源 2 的输出应用一些转换，这会导致 x2a、x2b、x2c。所以最终得到以下向量：[x1, x2a, x2b, x2c]。

我有一个问题，至于 N 多元随机过程（例如代表多个相关现象）我必须一次生成 N 维样本：

*   过程 1 -> 为源 1...N 生成数据：x1...xN

我正在考虑一种简单的架构，它允许结构化模拟代码并提供灵活性而不影响性能。

我在想一些事情（伪代码）：

```
class random_process
{
    // concrete processes would generate and store last data
    virtual data_ptr operator()() const = 0;
};

class source_proxy
{
    container_type<process> processes;
    container_type<data_ptr> data; // pointers to the process data storage
    data operator[](size_type number) const { return *(data[number]);}
    void next() const {/* update the processes */}
}; 
```

不知何故，我不相信这种设计。例如，如果我想使用样本向量而不是单次迭代，那么应该更改上述设计（例如，我可以让进程用数据填充传递给它们的代理矩阵的子矩阵，但又一次不确定这是否是一个好主意-如果是，那么它也很适合单次迭代情况）。欢迎任何意见、建议和批评。

编辑：

对上面的文字进行简短的总结，以总结要点并澄清情况：

*   `random_processes`包含生成一些数据的逻辑。例如，它可以从具有给定均值和相关矩阵的多元随机高斯中抽取样本。例如，我可以使用 Cholesky 分解 - 结果，我将获得一组样本 [x1 x2 ... xN]
*   我可以有多个具有不同维度和参数的随机进程
*   我想对生成的单个元素进行一些转换`random_processes`

这是数据流图

```
random_processes 输出
   x1 --------------> x1
                               ----> x2a
p1 x2 ------------变换|----> x2b
                               ----> x2c
   x3 --------------> x3

p2 y1 ------------变换|----> y1a
                               ----> y1b

```

输出用于进行一些计算。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T08:03:38.817

我会对此进行尝试，也许我遗漏了一些东西，但听起来我们有一个进程列表 1...N 不接受任何参数并返回一个 data_ptr。那么，如果在编译时已知数字，为什么不将它们存储在向量（或数组）中......然后以任何有意义的方式构造它们。您可以使用 stl 和内置容器（std::vector）函数对象（std::tr1::function）和算法（std::transform）走得很远......层次结构，所以我假设一个非常愚蠢的天真结构，但显然你会适当地构建数据流。如果您有一个支持 C++0x lambda 的编译器，它会变得更加容易，因为您可以更轻松地嵌套转换。

```
//compiled in the SO textbox...
#include <vector>
#include <functional>
#include <numerics>
typedef int data_ptr;

class Generator{
public:
    data_ptr operator()(){
      //randomly generate input
      return 42 * 4;
    }
};
class StochasticTransformation{
public:
    data_ptr operator()(data_ptr in){
       //apply a randomly seeded function
       return in * 4;
    }
};
public:
    data_ptr operator()(){
      return 42;
    }
};
int main(){

    //array of processes, wrap this in a class if you like but it sounds 
    //like there is a distinction between generators that create data
    //and transformations

    std::vector<std::tr1::function<data_ptr(void)> generators;

    //TODO: fill up the process vector with functors...
    generators.push_back(Generator());

    //transformations look like this (right?)
    std::vector<std::tr1::function<data_ptr(data_ptr)> transformations;

    //so let's add one 
    transformations.push_back(StochasticTransformation);

    //and we have an array of results...
    std::vector<data_ptr> results;

    //and we need some inputs
    for (int i = 0; i < NUMBER; ++i)
       results.push_back(generators[0]());

    //and now start transforming them using transform...
    //pick a random one or do them all...
    std::transform(results.begin(),results.end(),
                   results.begin(),results.end(),transformation[0]);
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T23:25:00.590

当我读到这个“答案”时，我的脑海中并没有出现，而是一个问题：

（这个问题是市场上各种工具供应商为其创建可配置解决方案的一类问题的一部分。）

您是否“必须”写这篇文章，或者您可以投资于久经考验的技术以使您的生活更轻松？

在微软的工作中，我与高性能计算供应商合作——其中一些供应商拥有数学库。这些公司的人会比我更接近于理解这个问题。:)

干杯，格雷格奥利弗 [MSFT]

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T07:34:54.860

我认为第二个选项（上一段中提到的那个）更有意义。在您介绍的那个中，您正在玩​​指针和对随机过程数据的间接访问。另一个将所有数据（向量或矩阵）存储在一个地方 -`source_proxy`对象。然后使用子矩阵调用随机过程对象以填充为参数，并且它们本身不存储任何数据。代理管理一切——从提供源数据（对于任何不同的源）到从生成器请求新数据。

因此，稍微更改一下您的代码段，我们最终可能会得到这样的结果：

```
class random_process
{
    // concrete processes would generate and store last data
    virtual void operator()(submatrix &) = 0;
};

class source_proxy
{
    container_type<random_process> processes;
    matrix data;
    data operator[](size_type source_number) const { return a column of data}
    void next() {/* get new data from the random processes */}
}; 
```

但我同意另一条评论（格雷格），这是一个难题，取决于最终的应用程序可能需要深思熟虑。很容易陷入死胡同，导致重写大量代码......

# php - 如何更新一个 使用 jQuery 和 CakePHP？

> ID：579812
> 
> 赞同：3
> 
> 时间：2009-02-23T23:14:22.037
> 
> 标签：php, jquery, ajax, cakephp

我将 CakePHP 用于一个小型 Web 应用程序，在一个表单页面上有一个下拉菜单可以选择工作编号。我想根据使用 jQuery 在下拉列表中选择的工作编号更新两个文本字段（我也愿意使用默认的 ajax 帮助程序，但我没有取得很大的成功）。

这是我的 jQuery 片段：

```
<script>
    $(document).ready(function() {
        $('#job_id').change(function() {
            $.post('/surveys/jobdetails', {id: $(this).attr('id')});
        })
        .change();
    });
</script> 
```

`jobdetails`是我的控制器中的一个方法，它根据传入的作业 ID 获取当前作业。但是，当下拉列表更改值时，它不会被调用。我尝试用 alert 函数代替 .post 并且效果很好，因此 onchange 被正确调用。

这是`<div>`我要更新的内容：

```
echo "<div id='job_details'>";
echo $form->label('jobtitle', 'Job Title');
echo "<input type='text' name='jobtitle' id='jobtitle'>";
echo $form->label('department', 'Department');
echo "<input type='text' name='department' id='department'>";
echo "</div>"; 
```

我想将每个文本字段的值设置为从 ajax 调用返回的作业的相应值。有很多非常好的 jQuery 和 CakePHP 文档，但我还没有找到完全涵盖我正在尝试做的事情的任何内容。谁能看到我做错了什么？有没有更好的方法来使用 ajax 用 CakePHP 更新 div？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T23:50:02.137

现在，AJAX 请求似乎命中了“/surveys/jobdetails”URL，但对结果没有任何作用。您需要向 AJAX 请求添加回调，如下所示：

```
$(document).ready(function() {
    $('#job_id').change(function() {
        $.post('/surveys/jobdetails', {id: $(this).attr('id')},
        function(result) {
            $('#job_id').html(result);
        });
    })
    .change();
}); 
```

jQuery 中还有一个名为[load()](http://docs.jquery.com/Ajax/load)的便利函数，它进一步简化了它，获取 URL 的内容并将其应用于所选元素：

```
$(document).ready(function() {
    $('#job_id').change(function() {
        $(this).load('/surveys/jobdetails', {id: $(this).attr('id')});
    })
    .change();
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-24T00:24:09.777

你的 CakePHP 控制器需要看起来像这样：

```
function jobdetails() {
    // get the data however you want
    // $_POST['id'] will have the job_id
    print json_encode(array(
        'jobtitle' => $jobtitle,
        'department'=>$dept
    ));
    exit;
} 
```

然后，您需要向您`$.post`的实际更新字段添加一个回调：

```
$(document).ready(function() {
    $('#job_id').change(function() {
        $.post('/surveys/jobdetails', {id: $(this).attr('id')}, function(json) {
            // now that we are in the callback,
            // the variable json is an object
            // with the values we passed above
            // so we can update the fields with the new values
            $('#jobtitle').val(json.jobtitle);
            $('#department').val(json.department);
        });
    })
    .change();
}); 
```

我还建议您使用 Firebug 之类的工具，这样您就可以查看 AJAX 请求的进度，并确保服务器正在返回您认为返回的内容。它使测试和调试与 AJAX 相关的任何事情变得更容易。

在我看来，这比输出整个 DIV 来更新更优雅，但如果你想走这条路，你只需使用 jQuery[`.load`](http://docs.jquery.com/Ajax/load)来实现你想要的。

# axapta - 通过 Axapta 发送电子邮件

> ID：579816
> 
> 赞同：3
> 
> 时间：2009-02-23T23:15:45.543
> 
> 标签：axapta

我设法让我的 Axapta 3.0 通过 printjobSettings 类发送电子邮件。但是，似乎没有任何地方可以为我的电子邮件创建正文。目前我可以发送带有附件的电子邮件，但我想包含一些文本来为收件人的附件提供一些上下文。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-24T04:12:58.853

类 printJobSettings 有一个方法 mailSubject 用于设置生成的电子邮件的主题，但没有设置消息正文的方法。printJobSettings 是一个内核类，所以你不能修改它。

为了实际发送电子邮件，内核将一个 printJobSettings 对象传递给方法 Info.ReportSendMail，您可以对其进行修改。因此，作为一种变通方法，将您的主题和正文打包在主题中，然后在 ReportSendMail 中解压缩它们。

在您的报告中：

```
printJobSettings.mailSubject(msgSubject + '|' + msgBody); 
```

在 Info.ReportSendMail 中：

```
subjectAndBody=printJobSettings.mailSubject();
delimiterPos=strFind(subjectAndBody,'|',1,strlen(subjectAndBody));
if(delimiterPos>0)
{
    msgSubject=subStr(subjectAndBody,1,delimiterPos-1);
    msgBody=subStr(subjectAndBody,delimiterPos+1,strlen(subjectAndBody)-delimiterPos);
}
else
{
    msgSubject=subjectAndBody;
    msgBody='Axapta Report';
} 
```

# c++ - 在 C 和 C++ 中编译但执行方式不同的代码示例

> ID：579828
> 
> 赞同：10
> 
> 时间：2009-02-23T23:19:42.490
> 
> 标签：c++, c

我正在寻找更多在 C（任何标准）和 C++ 下编译但运行方式不同的示例。例如，我在 comp.lang.c 中找到了这个，它为 C 生成 8，为 C++ 生成 512：

```
#include <stdio.h>

struct A { char block[8]; };

int main(void) {
    struct B {
        struct A {
            char block[512];
        } a;
    };

    printf("sizeof(struct A) = %lu\n",
        (unsigned long) sizeof(struct A));
    return 0;
} 
```

有没有人有更多的例子，尤其是那些不使用这个特殊技巧的例子？

# javascript - 无法让 Adob e AIR 的 ApplicationUpdaterUI() 工作

> ID：579830
> 
> 赞同：1
> 
> 时间：2009-02-23T23:20:11.290
> 
> 标签：javascript, air

这是我的问题 - 我正在尝试编写一个自我更新的应用程序，但我不断收到错误消息，提示 runtime.air.update.ApplicationUpdaterUI() 不返回构造函数。

这是代码的相关部分；还包括其他 javascript 文件，但我认为它们中的任何一个都不会主动破坏 AIR 本身。

```
<html>
<head>
<script type="text/javascript" src="./js/AIRAliases.js"></script>
<script type="text/javascript" src="./js/jquery-1.3.1.js"></script>
<script src="ApplicationUpdater_UI.swf" type="application/x-shockwave-flash"></script>
<script>
    $(document).ready( function() {
        var appUpdater = new runtime.air.update.ApplicationUpdaterUI();  // line 64 in this example
    }
</script>
</head>
<body> ... stuff ... </body>
</html> 
```

我测试它时得到的错误是

```
    TypeError：值不是构造函数。不能与新的一起使用。
     在应用程序：/index3.html：64
     在应用程序：/js/jquery-1.3.1.js：2912
     在应用程序：/js/jquery-1.3.1.js：686
     在应用程序：/js/jquery-1.3.1.js：2916
     在应用程序：/js/jquery-1.3.1.js：2936

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T05:35:37.637

验证 SWF 的脚本标记中的路径，我猜您没有正确引用 ApplicationUpdater_UI.swf。

Air 基本上是在抱怨它无法找到可以在任何地方调用的 runtime.air.update.ApplicationUpdaterUI() 方法，这可能意味着它找不到 SWF（或者我认为 SWF 可能已损坏）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-19T17:55:07.307

不确定这是否相关，但如果您在脚本之前加载 .swf，则 $(document).ready 和 .load 都不会起作用。确保将 .swf 引用放在页面的最底部。

# c# - 使用 XPath 绑定表达式时，您能否返回 InnerXml 而不是 InnerText？

> ID：579831
> 
> 赞同：3
> 
> 时间：2009-02-23T23:20:33.487
> 
> 标签：c#, asp.net, xml, data-binding

我将控件绑定到 XmlDocument 并使用“XPath”绑定表达式输出数据：

```
<div class="Bio"><%# XPath("Biography") %></div> 
```

但是，这将返回“传记”元素的 InnerText 属性，而不是 InnerXml。这意味着它会从中剥离所有内部标签，这不是我想要的。

我查看了 XPathBinder 对象，但无论如何我都找不到让它返回 InnerXml 而不是 InnerText

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-04T12:43:44.890

Binding.XPath 返回一个值而不是一个节点，因此您将无法以这种方式获取 InnerXml。您可以定义一个返回 SelectSingleNode(...).InnerXml 的方法吗？如果您定义一个方法，例如

```
public string GetInnerXml(object o)
{
    string val = String.Empty;
    XmlNode parent = o as XmlNode;
    XmlNode child = parent.SelectSingleNode("bob/fred");
    if (child != null)
        val = child.InnerXml;
    return val;
} 
```

然后从您的绑定表达式中调用它，这应该可以解决问题。代码应该是正确的，但我没有测试它，所以可能会有错误。

# java - Java Colt Matrix 包需要帮助

> ID：579832
> 
> 赞同：0
> 
> 时间：2009-02-23T23:20:46.670
> 
> 标签：java, matrix, linear-algebra

谁能告诉我如何使用[Colt](http://acs.lbl.gov/~hoschek/colt/)库从矩阵中删除列？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-02T11:54:09.967

没有明确的方法来删除一列，但是您可以创建一个原始矩阵的视图，其中包含除您想要删除的列之外的所有列。

```
/**
 * Returns a view of the original matrix that contains all rows and all columns
 * except for the specified column.
 *
 * The view is backed by the original matrix, that is, all changes to the
 * returned matrix will be reflected by the original matrix.
 *
 * @param src The matrix to have a column "removed".
 * @param colIdx The index of the column to be hidden
 *        ({@code 0 <= colIdx < src.columns()} .
 * @return A view of the original matrix with column {@code colIdx} removed.
 */
public DoubleMatrix2D hideColumn(final DoubleMatrix2D src, final int colIdx) {
    // create array of column indices to be preserved
    final int[] keepColumns = new int[src.columns() - 1];
    for (int i = 0; i < keepColumns.length; i++) {
        keepColumns[i] = ((i < colIdx) ? i : i + 1);
    }

    return src.viewSelection(null /* keep ALL rows */, keepColumns);
} 
```

# c# - 如何处理具有动态默认值的属性

> ID：579833
> 
> 赞同：0
> 
> 时间：2009-02-23T23:20:56.873
> 
> 标签：c#, java

我在创建简单的数据对象时经常会遇到这样的情况。我有一个名为 Label 的属性，它应该具有基于对象名称的默认值。因此，如果没有设置标签，则使用名称，否则使用设置的标签。C#中的一个简单示例

```
public class FooBat {
    public string Name { get; set; }
    public string Label {
        get {
            if (_label == null) return Name;
            return _label;
        }
        set { _label = value; }
    }
} 
```

现在的问题是，如果你想编辑这个对象，你不能只绑定到 Label 属性，否则你会得到默认值，它看起来好像有一个值，而实际上没有。所以我最终要做的是创建另一个进行默认设置的只读属性，我使用的是所有实例，除了在编辑基础对象时。这会导致许多额外的属性具有奇怪的名称，例如 LabelWithDefault。我尝试过的另一种选择是让 Label 处理默认设置并创建一个名为 RealLabel 的新属性，用于编辑基础对象。这同样糟糕。

我曾考虑将默认代码移到其他地方，但在任何不会多次复制默认代码的“正常”模型中，我都没有找到合适的位置。

我现在开始做的是在设置了 Name 字段（并且没有设置 Label 字段）时初始化 Label 字段，然后将 Label 字段视为普通字段。这可行，但现在默认代码与错误的属性相关联。为什么 Name 应该知道 Label 字段关心它？所以这也不“对”。

有没有人有更好的方法来处理这个问题？

* * *

我认为我的要求有点混乱。基本上我需要对同一个对象有两种不同的视图来实现两种不同的用途。首先是对象本身的编辑，我希望未设置的字段显示为空（未设置）。第二个是针对所有其他情况（包括当对象是另一个对象的字段的值时），我想以动态确定的默认值显示每个字段。第一次设置默认值并没有帮助，因为如果（在这种情况下）名称字段发生更改，那么标签字段也必须更改*，直到设置标签字段*。

* * *

答案越来越接近，但我仍然认为它们过于针对我给出的示例。我试图给出一个具体的例子来说明问题，但实际上这更像是一个最佳实践问题。我给出的示例是 C# 和字符串属性，但我使用的大多数语言和系统都有相同的问题，这些语言和系统具有为您以及字符串以外的数据类型处理数据访问和数据显示的框架。更改从数据源查询的对象是可能的，但通常很棘手，并且知道何时进行更改（在这种情况下使用子类，但在这种情况下不使用）特别困难。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T23:36:05.883

```
public class FooBat {
    public string Name { get; set; }    
    public string Label {
        get {
             if (_label == null) 
                 _label = Name;
             return _label;        
            }        
        set { _label = value; }    
   }
} 
```

* * *

关于您的更新：您可以子类化您的对象。如果尚未设置该字段，则基类将返回 null，而子类将返回您的默认值。因此，如果您需要查询是否已设置值，您将转换为基类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T04:15:58.927

我经常使用`Nameable`界面（带有`getName()`）。在我开始之前，我建议你根本不想这样做。它应该是您的显示逻辑的域，而不是您的域对象。通常，使用 的代码`FooBat`能够以比对象本身更好的方式做出此决定。那一边...

```
public interface Label{
    string getLabel();
    boolean isDefault(); //or isValued() or use instanceof expressions
}

public interface Nameable{
    string getName();
}

public class FooBat implements Nameable {
    public string Name { get; set; }
    public Label Label {
        get {
            if (_label == null) {
                _label = new DefaultLabel(this);
            }
            return _label;
        }
        set { _label = value; }
    }
}

public class DefaultLabel implements Label{
    public DefaultCharSequence(Nameable named){
        this.named = named;
    }

    public string getLabel(){
        return named.getName();
    }

    public boolean isDefault(){ return true; }
 }

 public class StringLabel implements Label {
     ...
 } 
```

这一切本质上归结为为您的标签对象返回一个更好的类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T23:37:08.550

为简洁起见，删除了以前的答案/更新。

* * *

**更新 2：** 我不得不说最好的方法是使用 IsPropertySet 布尔跟踪属性是否已设置。该属性的 Getter 将检查该值以查看它是否应该返回自己的值或默认值。并且属性的设置器会根据设置的值设置 IsPropertySet（如果值不为空，则为 true，如果为空，则为 false）。然后，使用该类的代码可以查看 IsPropertySet 值，以确定它在调用 Property 的 Getter 时接收的是设置值还是默认值。

```
public class FooBat {
   public string Name { get; set; }
   public bool IsLabelSet { get; set; }
   public string Label {
      get {
         if (IsLabelSet)
            return _label;
         else
            return Name;
      }
      set {
         IsLabelSet = value != null;
         _label = value;
      }
   }
} 
```

# c++ - 访问boost线程对象的成员变量

> ID：579838
> 
> 赞同：4
> 
> 时间：2009-02-23T23:22:57.193
> 
> 标签：c++, multithreading, boost

我正在使用一个对象来启动 boost 线程，它有一些我在线程中修改的公共成员变量（在 () 运算符中）。如何从线程外部访问对象的成员变量？

我尝试使用在对象的 operator() 和外部都锁定的互斥锁（在对象的类中定义），但它似乎不起作用。

这是线程对象代码：

```
struct Mouse
{
  int x, y;
  string port;

  boost::mutex mutex;

  Mouse(const string& p) : port(p) { x = y = 0; }
  Mouse(const Mouse& m) : mutex() { x = m.x; y = m.y; port = m.port; }

  void operator()()  
  {
    ifstream ifs;
    ifs.open (port.c_str(), ios::binary );
    if (!ifs.is_open())
    {
      cout << "Impossible d'ouvrir " << port.c_str() << "\n";
      exit(0);
    }
    while (true) //modify x, y in infinit loop
      {
    char buf[3];
    ifs.read(buf, 3);
        unsigned char * msg = (unsigned char *) buf;
    unsigned char xsign = (msg[0]>>4) & 1;
    unsigned char ysign = (msg[0]>>5) & 1;
        unsigned char always1 = (msg[0]>>3) & 1;
    short dx = msg[1] - 256*xsign;
    short dy = msg[2] - 256*ysign;
    {
      boost::mutex::scoped_lock lock(mutex);
      x += abs(dx);
      y += dy;
    }
      }
  }
}; 
```

这是我尝试访问鼠标的 x 和 y 变量的地方：

```
 {
    boost::mutex::scoped_lock leftlock(leftMouse.mutex);
    xLeft = leftMouse.x;
    yLeft = leftMouse.y;
  }
  {
    boost::mutex::scoped_lock rightlock(rightMouse.mutex);
    xRight = rightMouse.x;
    yRight = rightMouse.y;
  }
  cout << xRight << " " << yRight << endl;  //this always prints 0 0 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-23T23:56:39.470

`boost::thread`将传递的线程函数复制到内部存储，因此如果您像这样启动线程，线程将在不同的副本上运行`mouse`：

```
int main() {
  Mouse mouse("abc.txt");
  boost::thread thr(mouse); // thr gets a copy of mouse
  ...
  // thread changes it's own copy of mouse
  ...
} 
```

您可以使用`boost::ref`来传递对现有对象的引用：

```
 Mouse mouse("abc.txt");
  boost::thread thr(boost::ref(mouse)); // thr gets a reference of mouse 
```

在这种情况下`thr`将修改全局`mouse`对象，但您必须确保在完成`mouse`之前不会超出范围或被破坏`thr`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T23:51:50.557

好的，现在我看得更清楚了。查看您的代码的一些建议：

1.  不要暴露内部互斥锁。
2.  锁定和解锁互斥锁的写入访问操作。这样，您不必依靠您班级的用户来有效地锁定（和解锁）互斥锁。
3.  在线程**之前**从文件中读取数据。可能读取是阻塞的，或者其他线程获取数据的速度太慢。如果之前读取数据，然后启动线程，所有数据都会在客户端访问线程数据的时候被读取。

# objective-c - 使用简单图形在 iPhone 上的性能问题

> ID：579840
> 
> 赞同：0
> 
> 时间：2009-02-23T23:23:18.723
> 
> 标签：objective-c, iphone, cocoa-touch

我们正在开发几个简单的游戏，并且我们一直遇到一些性能问题，我很好奇这是代码问题还是“我们使用了错误的对象”问题。

我们的游戏基本上是简单的游戏，其工作方式如下：

我们有一个要加载的自定义视图，以及一个作为我们游戏引擎的自定义对象。该视图有一个像这样触发的计时器：

```
[NSTimer scheduledTimerWithTimeInterval:1.0 / 30.0 target:self selector:@selector(animationTimerMethod) userinfo:nil repeats:YES]; 
```

在我们的计时器方法中，我们有以下内容：

```
- (void)animationTimerMethod:(NSTimer*)timer 
{
  if([gameEngine doGameLoop])  //only redraw if we need to
    [self setNeedsDisplay];
} 
```

我们的绘图代码非常简单，我们只是在屏幕上绘制了几个图像，使用类似于以下的代码：

```
- (void)drawRect:(CGRect)rect
{
  CGGraphicsContext ctx = UIGraphicsGetCurrentContext();
  CGContextDrawImage(ctx, someRect, someImage);
} 
```

我们遇到的主要问题是对触摸的响应能力。我们的代码在 touchesBegan 方法中多次不会得到响应。这只是核心图形库的限制吗？我们应该使用OpenGL吗？是否有其他方法可以做出响应更快的简单动画（甚至不是在屏幕上移动的对象，对于同一位置的对象只有 6 帧左右的动画）？

非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T05:41:22.417

肯定有办法加快速度。每帧手动重绘图像意味着您正在重绘可以重复使用的纹理。您可以通过移动到 OpenGL 或将图像移动到 CALayer 来重用它们，然后只需重新定位图层而不是重绘图像。

如果您不想迁移到 OpenGL，您可能还会看到通过迁移到 CAAnimation 而不是让您的代码计算每一帧的显着性能提升，但这可能需要对引擎进行重大更改。

此外，如果您可以避免避免 alpha 合成，它会大大加快速度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T23:55:57.770

我的第一个问题是您的图像是否具有透明度？

具有高度效果性能的透明图像。在 Apple 的文档中，他们多次提到这一点。

我要问的第二件事是，您是否尝试过在 Instruments 和/或 Shark 中运行您的应用程序？这两个应用程序都可以帮助您了解问题发生在哪里。

# iphone - 如何提示用户在 iPhone 上选择图像？

> ID：579841
> 
> 赞同：1
> 
> 时间：2009-02-23T23:23:44.900
> 
> 标签：iphone

我想允许用户选择几个预先提供的图像之一。有没有标准的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T23:51:32.273

唯一与此类似的标准是图像选择器控件。但是，要使其正常工作，您必须将图像添加到 iPhone 的图像库中，并且用户必须从所有其他图片中选择它们。

您需要做的是构建类似的东西。

您可以根据需要/想要的简单或复杂。

我会很简单（因为这是 iPhone 的想法）并有一个滚动视图（取决于你想要的图片数量）并加载图像的缩略图。当他们选择一个时，你就用它做点什么。（在 iphone 上查看相册时查看视图）

我相信我以前见过这种开源表示。我会检查谷歌代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T16:53:03.520

I use a UITableView for this, with a thumbnail and description of the image they're choosing.

# xhtml - Windows 的 XHTML 批量验证器？

> ID：579843
> 
> 赞同：0
> 
> 时间：2009-02-23T23:24:15.007
> 
> 标签：xhtml, validation, bulk

我有数百个（静态 - 不包含或服务器端解析）HTML 页面。我想验证 HTML（XHTML 1.0 过渡），但是将它们中的每一个单独插入 W3C Validator 的想法——或者甚至使用 Firefox 插件打开每一个——让我充满恐惧。

有谁知道可以进行批量验证的任何（Windows）应用程序？[http://www.htmlhelp.com/tools/validator](http://www.htmlhelp.com/tools/validator)上的“验证整个站点”功能是我最接近的功能，但仅限于 100 页。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T23:29:54.963

你应该可以根据[html tidy](http://tidy.sourceforge.net/)库找到一些东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T23:33:35.297

下载源代码并在本地运行有什么问题？

[源代码在这里](http://www.htmlhelp.com/tools/validator/source.html.en)

特别是还有[一个适用于 Windows 的 Real Validator](http://arealvalidator.com/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-14T06:03:37.100

我们编写了一个工具来执行此操作 - 一次最多可处理 50,000 个 URL，我们的服务器会处理所有数据并通过电子邮件将报告发送给您：

[http://www.cybercompare.net/web-hosting/bulk-html-validation/](http://www.cybercompare.net/web-hosting/bulk-html-validation/)

# authentication - svn 访问 https 存储库：总是提示输入用户名/密码

> ID：579850
> 
> 赞同：0
> 
> 时间：2009-02-23T23:28:29.850
> 
> 标签：authentication, svn, https

我刚刚将我的 svn 存储库移至新服务器。

以前我通过以下方式访问我的存储库：svn://oldserver/yyy/zzz。
现在我想通过：https://newserver:8443/svn/yyy/zzz 访问它。

我曾经`switch --relocate`重新指向我的源代码树，这似乎运作良好。

当我尝试更新我使用的源时：

`svn.exe update zzz --username myusername --password mypassword --non-interactive`

当我这样做时，它仍然要求我输入用户名和密码（如果我重新输入就可以了）。

无论我做什么，我都无法让它接受用户名和密码参数。

任何人都可以在这里帮助我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T00:57:55.423

您可能需要检查`%APPDATA%\Subversion\auth\`（`$HOME/.subversion/auth`在 linux 中）文件夹下的文件以及该项目是否有 auth 条目，并根据需要编辑或删除它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T23:40:56.027

我不是真正的 SVN 之神，但我假设您的结帐工作正常吗？如果你只输入会发生什么

```
svn.exe update zzz 
```

在项目的根目录中？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T00:49:51.697

当你传递 --username 和 --password 时，你告诉 Subversion 忽略缓存的用户名/密码，并使用它们。用户名和/或密码可能有错误（可能是由您的 shell 引起的？）

# glassfish - Liferay 5.2 和 Sun Glassfish Web Space Server 10 有什么区别

> ID：579851
> 
> 赞同：1
> 
> 时间：2009-02-23T23:29:32.140
> 
> 标签：glassfish, liferay, portal, glassfish-webspace

我发现 Liferay 5.2 存在相当多的错误（IMO），更具体地说，有许多与安全相关的错误，我觉得非常麻烦。这个产品（Glassfish Web Space Server）的 Sun 版本是否更好？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T19:01:59.167

Webspace Server 基于 Liferay 5.2，所以如果错误出现在 LR 5.2 中，那么它很可能出现在 Webspace 中。如果我们在 Webspace 中发现错误，并且它们实际上是 Liferay 错误，它们将在 Liferay 中修复（不仅仅是在 Webspace 中）。这是我们社区对 Liferay 承诺的一部分。

编辑：Sun 然后生产具有附加功能、文档、服务、支持、与 Sun 和非 Sun 产品集成的商业支持产品。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T21:09:34.667

我花了一点时间设置 Sun 的 Webspace 服务器，并立即注意到 Liferay 的几个相同的缺陷困扰着我。我不会再继续下去了。

编辑：Liferay 有一个开放的 JIRA 站点：http: [//issues.liferay.com](http://issues.liferay.com)

我不会费心详细介绍我寻找的每个错误，只是说它们存在于 Liferay 和 Webspace 中。我不想花太多时间在这上面。Liferay + Sun 的合作是相当新的事物，所以我对这两种产品如此相似并不感到惊讶。

# javascript - RJS：Ajaxified select_tag

> ID：579855
> 
> 赞同：3
> 
> 时间：2009-02-23T23:32:21.323
> 
> 标签：javascript, ruby-on-rails, ruby, rjs

[由于我在最后一个问题](https://stackoverflow.com/questions/575862/rjs-using-observefield-on-selecttag)上没有得到预期的答案，我将尝试简化和缩小我的问题：

> 如何构建一个使用 AJAX（无提交按钮）的下拉菜单来调用某个控制器的显示操作？

给出以下内容：

**Model-Association**是*Categories HABTM Projects*，因此下拉菜单包含所有类别名称。

应实施下拉菜单的**视图部分。**下拉菜单下方是应根据下拉菜单中的选择进行更改的项目列表：

```
 <!-- placeholder for AJAX dropdown menu -->

   <!-- list of projects related to categories chosen by the select tag -->
   <ul class="projects">
     <% @projects.each do |_project| %>
       <li>
         <%= link_to(_project.name, _project) %>
       </li>
     <% end %>
   </ul> 
```

带有应该调用的 show-action的**Categories 控制器：**

```
class CategoriesController < ApplicationController
  def show
    # params[:id] should be the choice the user made in the dropdown menu
    @category = Category.find(params[:id])
    @projects = @category.projects.find(:all)

    respond_to do |format|
      format.html # show.html.erb
      format.js   # needed for ajax response?
    end
  end

  def index
    @projects = Category.find(params[:id]).projects.find(:all)
    @category = @project.categories.first

    respond_to do |format|
      format.html # index.html.erb
    end
  end 
end 
```

在 Categories 控制器中调用 show-action的**路径：**

```
category GET    /categories/:id    {:controller=>"categories", :action=>"show"} 
```

你将如何实现这一点？任何帮助都非常感谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-25T15:51:25.860

这个怎么样：

```
<% form_for :category, :url => { :action => "show" } do |f| %>
  <%= select_tag :id, options_from_collection_for_select(Category.find(:all), :id, :name),
  { :onchange => "this.form.submit();"} %>
<% end %> 
```

这将调用传统的 html 调用，因此它将刷新整个页面（并响应 format.html）。

然后控制器会根据提交的 [:id] 找到类别

```
@category = Category.find(params[:id]) 
```

# python - 将两个序列组合成字典的 Pythonic 方式是什么？

> ID：579856
> 
> 赞同：8
> 
> 时间：2009-02-23T23:33:26.407
> 
> 标签：python

在 Python 中有更简洁的方法吗？：

```
def toDict(keys, values):
  d = dict()
  for k,v in zip(keys, values):
    d[k] = v

  return d 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-02-23T23:35:34.950

是的：

```
dict(zip(keys,values)) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T23:59:41.397

如果`keys`' 大小可能比`values`' 大，那么您可以使用[`itertools.izip_longest`](http://docs.python.org/library/itertools.html#itertools.izip_longest)(Python 2.6)，它允许为其余键指定默认值：

```
from itertools import izip_longest

def to_dict(keys, values, default=None):
    return dict(izip_longest(keys, values, fillvalue=default)) 
```

例子：

```
>>> to_dict("abcdef", range(3), 10)
{'a': 0, 'c': 2, 'b': 1, 'e': 10, 'd': 10, 'f': 10} 
```

注意：`itertools.izip*()`与函数不同的`zip()`函数返回迭代器而不是列表。

# c# - 在 ASP.NET 中处理较长的页面执行时间

> ID：579861
> 
> 赞同：1
> 
> 时间：2009-02-23T23:35:34.527
> 
> 标签：c#, asp.net, performance, asp.net-3.5

我正在开发一个 Web 应用程序导入程序。目前，管理员用户可以上传我的页面将解析的格式化 csv 文件。我遇到了执行持续时间问题，因为每一行都与必须保存到 Scribd、S3 以及一些内部处理的文件有关。

你们会建议什么来改善执行时间？由于这是一个仅限管理员的页面，我怀疑它每周会运行一次以上，所以我希望尽快将其推出。

我看过一些 Async="true" 标志，但我不确定这是否是我想要的方向，或者我是否应该看起来更像一个 Windows 服务器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T23:50:42.977

想到两个选择：

**线程**：在您的代码中设置一组线程，加入它们，然后让每个线程处理一个文件。一旦所有线程完成，您将能够返回页面。这将增加您的周转时间，但仍然可能在页面返回时留下一些不足之处

**队列**：让用户提交 csv 文件并提供 GUID/Hash/Whatever ID，然后管理员可以转到“状态”页面，输入他们的 ID 并检查他们的工作细节。该解决方案将为用户提供快速反馈，并允许他们跟踪结果而无需等待。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T23:47:30.460

一个快速而肮脏的选择可能是将 Page.Server.ScriptTimeout 设置为该页面上的一个非常高的值。（我认为它在 Int.MaxValue 处达到最大值）。

可能建议在单击提交按钮后阻止它，并通知用户他们可能想去煮咖啡。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T23:54:27.837

我建议使用 AJAX 进行内部回发以处理异步处理。您可以定期轮询状态，并防止您的母版页让“处理”轮在页面上不断搅动以进行冗长的过程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-24T00:11:55.190

我有一个网页需要很长时间来处理邮件列表，所以我在它自己的线程中启动它。完成该过程后，可以从结果页面上的另一个链接查看报告。我有一个可运行的 MailSender 类。ASPX 脚本中有一些内容，如下所示：

```
// 准备 MailSender
MailSender ms = new MailSender(people, Subject, FileName....);                       
如果（发送异步）{
    ThreadStart ts = new ThreadStart(ms.run);
    线程 WorkerThread = new Thread(ts);
    WorkerThread.Start();
} 别的 {
    ms.run();
}

```

如果您想加快代码速度，请尝试将其分解为可并行化的部分，并为每个部分编写一个类。然后，您可以为每个位启动一个新线程并监视某处的状态，以便通知用户何时返回结果。你说你输入的每一行都会生成它自己的输出文件。听起来像是多线程的绝佳候选者。如果您在服务器上没有可用的多核，则不会加快速度。

整个方案的一个问题是服务器重新启动或应用程序池回收将终止您长时间运行的进程。如果您的线程要运行一两个小时，这可能是个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T01:04:27.387

由于处理时间涉及外部因素，您需要考虑性能改进是否会影响“实际”性能，如果大部分时间都在处理它并将其发送给第三方（即Scribd，S3），然后在改进你的结局可能不会产生巨大的影响，并且可能会增加简单任务的复杂性。

我要做的是让 aspx 页面只做 aspx 最擅长的事情；即只处理用户界面部分（即上传），所以一旦上传完成就用户而言，他们的部分就完成了。您可以使用 AJAX 实现进度指示器以使其更好，但作为管理部分，我不会打扰这些细节，

然后让简单的控制台应用程序以特定的时间间隔触发，或者让 Windows 服务监视目录（取决于更新的时间紧迫性），一旦应用程序在后台运行并且不需要用户交互，时间就不需要了一个关键因素（即您没有用户等待返回上下文）..

用户会觉得事情非常快（即上传文件所需的时间），并且您将不必要的复杂性排除在您的解决方案之外。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-24T03:45:52.350

我认为最简单的解决方案是在 ASP.NET 中使用异步页面。你有什么特别的理由不想走那条路吗？

我可以想到一个替代方案，即有一些后台进程（如由 Windows 中的计划任务或 Windows 服务触发的进程），它将查看等待作业的队列（例如，来自数据库表）并处理那些工作。这样，您必须在某处上传该 CSV 并插入一个数据库记录，以便后台进程将看到该 CSV 并在它出现时使用它。但对我来说，这似乎需要更多的工作，所以我宁愿使用异步页面 :)

[这是一个关于 ASP.NET 异步页面](http://msdn.microsoft.com/en-us/magazine/cc163725.aspx)的不错的教程

# .net - ASP.NET ListView、自定义数据源和编辑项

> ID：579868
> 
> 赞同：2
> 
> 时间：2009-02-23T23:36:58.253
> 
> 标签：.net, asp.net, data-binding

MSDN 演练提供了许多示例，您可以从工具箱中拖动 DataSource，运行一些简单的配置步骤，然后将[ListView](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listview.aspx)拖动到屏幕上，将其指向 DataSource，嘿——您已经完成了完整的表格编辑。

现在我正在尝试编写我自己的 DataSource 类（一个实现[*System.Web.UI.IDataSource*](http://msdn.microsoft.com/en-us/library/system.web.ui.idatasource.aspx)的类）和我自己的 DataSourceView 类。我现在将这个自定义 DataSource 类的一个实例分配给[*ListView.DataSource*](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.basedataboundcontrol.datasource.aspx)属性。

所有项目的显示都运行良好。但是，更新、插入和删除只是不起作用。我在我的 DataSourceView 类中覆盖了我可以使用的每个函数，而它们只是没有被调用。

这是一个巨大的话题，我将把这个问题集中在一个简单的例子上：

当您按下“编辑”按钮（*ItemTemplate*内的按钮，*CommandName*为“Edit”时，您希望*ItemTemplate*被*EditItemTemplate*替换。这没有发生。我能做到的唯一方法是处理oniteediting*活动*。

```
protected void _listViewPublicHolidays_ItemEditing(object sender, ListViewEditEventArgs e)
{
    _listViewPublicHolidays.EditIndex = e.NewEditIndex;
    _listViewPublicHolidays.DataBind();
} 
```

这几乎不是问题，但为什么我必须这样做呢？在我将*ListView*附加到*LinqDataSource*的 MSDN 演练中，不必编写此代码。以前来过这里的人可以猜测我的自定义数据源中会有什么不同或缺少什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T23:51:47.390

我知道这是一种替代方法，可能不适用于您的特定情况，但您可能希望考虑将 ObjectDataSource 与简单的对象模型一起使用，它会为您完成一些工作，而不是编写整个 DataSource。

因此，例如，您可以创建一个相当简单的 PublicHolidays 类，其中包含几个方法

```
public List<PublicHoliday> GetAllPublicHolidays() 
```

和

```
public void UpdatePublicHoliday(string name, date holidayDate) 
```

等，您可以将 ObjectDataSource 直接指向这些方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-01T21:57:23.867

使用 LinqDataSource 或 ObjectDataSource，绑定、设置 editindex 等通过数据源处理。如果你绑定到你自己的集合或数据集，你需要自己做一些调查。这些数据源类会自动处理维护数据的状态，而列表或数据集等标准集合则不能。

# git - 我可以让 vim 尊重我的 .gitignore 文件吗？

> ID：579871
> 
> 赞同：14
> 
> 时间：2009-02-23T23:38:18.343
> 
> 标签：git, vim, gitignore

我想知道是否有办法让 vim 读取 .gitignore 文件并使用它们来确定在自动完成文件名时不显示的选项。

例如，在 python 中工作，我不想看到 .pyc 文件提供编辑。我认为 vim 对此有自己的机制，我想知道如何将信息从 .gitignore 加载到其中。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-24T14:05:26.747

正如@dwc 所建议的，这是一个vim 脚本：

```
let filename = '.gitignore'
if filereadable(filename)
    let igstring = ''
    for oline in readfile(filename)
        let line = substitute(oline, '\s|\n|\r', '', "g")
        if line =~ '^#' | con | endif
        if line == '' | con  | endif
        if line =~ '^!' | con  | endif
        if line =~ '/$' | let igstring .= "," . line . "*" | con | endif
        let igstring .= "," . line
    endfor
    let execstring = "set wildignore=".substitute(igstring, '^,', '', "g")
    execute execstring
endif 
```

获取该源并将其放在插件目录中的文件中，例如`~/.vim/plugin/gitignore.vim`. 它将读取您的`.gitignore`文件并对其进行解析，将其格式转换为适合的格式`wildignore`，然后设置该选项。

**限制**：

*   这将从您启动 vim 的目录中读取`.gitignore`文件。无需努力寻找其他`.gitignore`文件并解析它们。或者，您可以在第一行指定文件的绝对路径。
*   vim 中的`wildignore`选项不支持像在文件中那样*否定*忽略的概念。`.gitignore`也就是说，你不能说`:set wildignore=*.html,!foo.html`让它忽略所有 html 文件，除了`foo.html`. 因此，`.gitignore`以 ! 开头的行 被简单地忽略了。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-23T23:45:39.793

Vim 将忽略 option 中指定的文件模式，所以你可以像这样设置它们： [`wildignore`](http://vimdoc.sourceforge.net/htmldoc/options.html#%27wildignore%27)

```
:set wildignore=*.o,*~,*.pyc 
```

或者在 ~/.vimrc 文件中放置同一行（不带“:”）。如果你需要一些更动态的东西，比如调整当前目录中的 .gitignore ，那么你需要编写一些脚本，但我会把它留给别人做练习。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-03-18T16:05:11.833

我为此写了一个插件：[https ://github.com/octref/RootIgnore](https://github.com/octref/RootIgnore)

它可以自动将`.gitignore`模式添加到您的 Wildignore。
一些方便的功能：

*   当您在子目录中时，如下所示：

> ```
> my_proj/  
>    .gitignore  
>    .git/
>    sub/ 
> ```

如果你 cd 进入 sub，并在那里打开 Vim，插件会递归地找到`.gitignore`并添加到`wildignore`.

*   您可以通过 轻松添加`~/.gitignore`规则`let g:RootIgnoreUseHome = 1`。

# sql - 在 TSQL 中转换日期

> ID：579873
> 
> 赞同：2
> 
> 时间：2009-02-23T23:39:31.897
> 
> 标签：sql, tsql, sql-server-ce

我正在移动一些数据，我需要提出一个 TSQL 语句来将当前日期时间字段中的日期转换为另一个具有 varchar MM/yy 格式的数据库字段。

此语句需要同时在 SQL Server 2k5**和**SQL Compact Edition 3.5 上工作 - 因此答案需要基于“设置”并且不包括 SQLCE 不支持的游标等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T00:43:42.353

如果您曾经在非美国数据库服务器上运行，则依赖于类型，即“101”可能会很危险，因为 mm 和 dd 会被切换。可能与使用类型“3”相同。只要您知道服务器的语言将始终相同，那么这些方法是最简单的。

使用 datepart 可能更可靠，但如果你想说 03/08 而不是 3/08，你必须确保在月份前加上“0”，所以

```
select 
    right( '00' + convert(varchar(2), datepart( mm, @ddate)), 2) + '/' +
    right( convert(varchar(4), datepart( yy, @ddate) ), 2 ) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T23:47:14.767

不完全是您想要的，但您应该能够轻松更改：

```
DECLARE @ddate datetime

set @ddate = getdate()

SELECT CAST(DATEPART(month, @ddate) as varchar(2))  + '/' + CAST(DATEPART(year, @ddate) as varchar(4)) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T23:52:30.557

像这样的东西怎么样...

```
select substring(convert(varchar(8),yourdatefield,3),4,5) as newdate 
from yourtable 
```

所以，例如，

```
select substring(convert(varchar(8),getdate(),3),4,5) 
```

给出“02/09”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T23:44:10.733

查看 DATEPART() 函数的联机丛书文档。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T23:48:30.987

[http://msdn.microsoft.com/en-us/library/ms187928.aspx](http://msdn.microsoft.com/en-us/library/ms187928.aspx)

转换为类型 3 并修剪最后三个字符。

# jquery - AJAX 复选框

> ID：579878
> 
> 赞同：0
> 
> 时间：2009-02-23T23:41:25.480
> 
> 标签：jquery, ajax, checkbox

我有一个使用 php 和 js 的服务器驱动站点。一个部分显示我们的用户上传的所有照片，然后管理员决定保留哪些照片以供最终演示。大多数网站都使用 jquery 进行就地编辑，但这个任务让我很难过。我想在 MySQL 数据库表中插入一行，单击复选框 ...NO SUBMIT 按钮复制照片的 URL 和其他相关信息。

我在 foreach (glob($dir)) 中生成了我需要的所有信息，并且在生成的每张照片旁边我可以放置复选框。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T23:49:51.123

```
$('checkbox selectors here').bind('click', function() {
    $.ajax({
        type: 'POST',
        url: url/to/backend.page,
        data: {dictionary of data},
        etc etc
    });
); 
```

在后端页面，只需处理 POST 请求并插入适当的 MySQL 记录。

# objective-c - 复制/粘贴在模态窗口中不起作用

> ID：579879
> 
> 赞同：6
> 
> 时间：2009-02-23T23:42:10.097
> 
> 标签：objective-c, cocoa

在我的可可应用程序中，我将 NSPanel 显示为另一个 NSPanel 的模态“窗口”，使用：

```
[modalPanel setWorksWhenModal:YES];
[[NSApplication sharedApplication] beginSheet:modalPanel modalForWindow:mainPanel modalDelegate:nil didEndSelector:nil contextInfo:nil]; 
```

这可行，但是显示在该模式“窗口”中的 NSTextField 不允许复制和粘贴。

通过搜索，我在 Cocoabuilder 上找到了以下线程，这似乎几乎是相同的问题，但是该线程中也没有给出解决方案。

[http://www.cocoabuilder.com/archive/message/cocoa/2007/11/6/192462](http://www.cocoabuilder.com/archive/message/cocoa/2007/11/6/192462)

该线程说要确保您不会通过使用验证来停止复制/粘贴，但这对我来说并非如此，因为我目前对任何字段都没有任何验证。

我需要做一些特别的事情来让它工作吗，或者有人对我可以检查/尝试什么有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-25T18:16:36.447

您的应用程序中是否存在“编辑”菜单？

如果您删除编辑菜单，您将失去内置的复制和粘贴功能。

# nhibernate - NHibernate中未映射的列？

> ID：579885
> 
> 赞同：1
> 
> 时间：2009-02-23T23:44:35.363
> 
> 标签：nhibernate, fluent-nhibernate, nhibernate-mapping

我正在使用 Oracle 中的旧数据库，并且我的一些表的列设置为 NOT-NULL，这是我在域模型中不想要的，但是，显然，我需要指定至少一些默认值的地方被保存到数据库中（例如，组表可能有一个“缩进”列 thaqt 总是需要一个 char(8) 值）。

我将如何在 NHibernate 中解决这个问题？是否有捷径可寻？如果没有，有没有人知道我可以做到这一点的方法（我考虑过使用 Inteceptor，但真的不知道从哪里开始......）。我无法更改数据库架构，所以遗憾的是，这不是一个选项（流利的版本也可以......）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-24T00:06:48.993

如果你不想污染你的 POCO，拦截器可能是最好的选择。看看关于拦截器的各种文章，比如[这个](http://www.lostechies.com/blogs/rhouston/archive/2008/03/27/creating-a-timestamp-interceptor-in-nhibernate.aspx)。

在您的拦截器上，您需要检查类型，以便知道将虚拟数据放入哪些字段。确保在 OnFlushDirty 方法中使用 currentState[]（OnFlushDirty 是“更新”）和在 OnSave 方法中使用 state[]（ “插入”）。例如（OnSave）：

```
if (entity is Group)
{
    state[Array.IndexOf(propertyNames, "Indentation")] = "dummy value";
    return true;
}
return false; 
```

编辑：

您正在尝试插入您的域中不存在但您的数据库模型需要的数据，因此上述方法对您不太适用。相反，您必须向每个 state、propertyNames 和 types 数组添加一个元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T00:03:39.907

您可以使用[自定义 CRUD sql](http://www.hibernate.org/hib_docs/v3/reference/en-US/html_single/#querysql-cud)，在 java 中我会说具有属性默认值的私有设置器也可以工作

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T00:07:12.330

NHibernate 的答案是实现[IInterceptor](http://20.targetprocess.com/2006/08/entity-life-cycle-in-nhibernate.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-26T07:43:38.290

还有一种使用 IPropertyAccessor 接口的替代方法，请参见[http://elegantcode.com/2009/07/13/using-nhibernate-for-legacy-databases/](http://elegantcode.com/2009/07/13/using-nhibernate-for-legacy-databases/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-26T17:38:43.297

我一直认为最好通过为列指定默认值来解决此类问题。

这样你就可以忘记它，而不是实现一些拦截器，这甚至听起来很可怕。

下面是示例 SQL 代码：[alter table with default value](http://www.java2s.com/Tutorial/Oracle/0120__Table/ChangingtheDefaultValueofaColumn.htm)

我猜即使 DB 是遗留的，你也可以控制它，因为你可以插入新行。这是非常便宜且轻量级的解决方案。

# c++ - RTTI 有多贵？

> ID：579887
> 
> 赞同：167
> 
> 时间：2009-02-23T23:46:21.430
> 
> 标签：c++, performance, rtti

我知道使用 RTTI 会造成资源损失，但它有多大？我所看到的所有地方都只是说“RTTI 很昂贵”，但它们实际上都没有提供任何基准或定量数据来保护内存、处理器时间或速度。

那么，RTTI 到底有多贵？我可能会在只有 4MB RAM 的嵌入式系统上使用它，因此每一位都很重要。

编辑：[根据 S. Lott 的回答](https://stackoverflow.com/questions/579887/how-expensive-is-rtti/579917#579917)，如果我包括我实际在做的事情会更好。 [我正在使用一个类来传递不同长度的数据并且可以执行不同的操作](https://stackoverflow.com/questions/566846)，因此仅使用虚拟函数很难做到这一点。似乎使用几个`dynamic_cast`s 可以通过允许不同的派生类通过不同的级别来解决这个问题，但仍然允许它们完全不同的行为。

据我了解，`dynamic_cast`使用 RTTI，所以我想知道在有限的系统上使用它是多么可行。

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2010-12-02T11:25:59.817

无论编译器如何，如果您负担得起，您总是可以节省运行时间

```
if (typeid(a) == typeid(b)) {
  B* ba = static_cast<B*>(&a);
  etc;
} 
```

代替

```
B* ba = dynamic_cast<B*>(&a);
if (ba) {
  etc;
} 
```

前者只涉及一个比较`std::type_info`；后者必然涉及遍历继承树和比较。

过去......就像每个人都说的那样，资源使用是特定于实现的。

我同意其他所有人的意见，即提交者出于设计原因应避免使用 RTTI。但是，使用 RTTI*有*充分的理由（主要是因为 boost::any）。请记住，了解其在常见实现中的实际资源使用情况很有用。

我最近对 ​​GCC 中的 RTTI 进行了大量研究。

tl;dr：GCC 中的 RTTI 在`typeid(a) == typeid(b)`许多平台（Linux、BSD 和可能的嵌入式平台，但不是 mingw32）上使用的空间可以忽略不计并且非常快。如果您知道您将永远在一个有福的平台上，那么 RTTI 非常接近免费。

坚韧的细节：

GCC 更喜欢使用特定的“供应商中立”C++ ABI[1]，并且始终将此 ABI 用于 Linux 和 BSD 目标[2]。对于支持此 ABI 和弱链接的平台`typeid()`，即使跨动态链接边界，也会为每种类型返回一致且唯一的对象。您可以 test `&typeid(a) == &typeid(b)`，或者仅仅依靠可移植测试`typeid(a) == typeid(b)`实际上只是在内部比较指针这一事实。

在 GCC 的首选 ABI 中，类 vtable*始终*包含指向每个类型 RTTI 结构的指针，尽管它可能不会被使用。因此，`typeid()`调用本身的成本*应该*与任何其他 vtable 查找一样多（与调用虚拟成员函数相同），并且 RTTI 支持*不应该*为每个对象使用任何额外的空间。

据我所知，GCC 使用的 RTTI 结构（这些都是 的所有子类`std::type_info`）除了名称之外，每种类型只包含几个字节。我不清楚这些名称是否存在于输出代码中，即使`-fno-rtti`. 无论哪种方式，编译后的二进制文件大小的变化都应该反映运行时内存使用的变化。

一个快速的实验（在 Ubuntu 10.04 64 位上使用 GCC 4.4.3）表明`-fno-rtti`实际上将简单测试程序的二进制大小*增加*了几百字节。`-g`这在和的组合中始终如一地发生`-O3`。我不确定为什么尺寸会增加；一种可能性是 GCC 的 STL 代码在没有 RTTI 的情况下表现不同（因为异常不起作用）。

[1] 称为 Itanium C++ ABI，记录在[http://www.codesourcery.com/public/cxx-abi/abi.html](http://www.codesourcery.com/public/cxx-abi/abi.html)。这些名称非常混乱：名称指的是原始开发架构，尽管 ABI 规范适用于包括 i686/x86_64 在内的许多架构。GCC 的内部源代码和 STL 代码中的注释将 Itanium 称为“新”ABI，而不是他们之前使用的“旧”ABI。更糟糕的是，“新”/Itanium ABI 指的*是*通过`-fabi-version`; “旧” ABI 早于这个版本。GCC 在 3.0 版本中采用了 Itanium/versioned/"new" ABI；如果我正确阅读了他们的变更日志，则在 2.95 及更早版本中使用了“旧”ABI。

[2] 我找不到任何`std::type_info`按平台列出对象稳定性的资源。对于我可以访问的编译器，我使用了以下内容：`echo "#include <typeinfo>" | gcc -E -dM -x c++ -c - | grep GXX_MERGED_TYPEINFO_NAMES`. 从 GCC 3.0 开始，该宏控制GCC 的 STL中`operator==`for的行为。`std::type_info`我确实发现 mingw32-gcc 遵循 Windows C++ ABI，其中`std::type_info`对象对于跨 DLL 的类型不是唯一的；`typeid(a) == typeid(b)`在幕后打电话`strcmp`。我推测在像 AVR 这样没有代码链接的单程序嵌入式目标上，`std::type_info`对象总是稳定的。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2012-12-15T18:00:42.133

也许这些数字会有所帮助。

我正在使用这个进行快速测试：

*   GCC Clock() + XCode 的 Profiler。
*   100,000,000 次循环迭代。
*   2 个 2.66 GHz 双核 Intel Xeon。
*   有问题的类派生自一个基类。
*   typeid().name() 返回“N12fastdelegate13FastDelegate1IivEE”

测试了5个案例：

```
1) dynamic_cast< FireType* >( mDelegate )
2) typeid( *iDelegate ) == typeid( *mDelegate )
3) typeid( *iDelegate ).name() == typeid( *mDelegate ).name()
4) &typeid( *iDelegate ) == &typeid( *mDelegate )
5) { 
       fastdelegate::FastDelegateBase *iDelegate;
       iDelegate = new fastdelegate::FastDelegate1< t1 >;
       typeid( *iDelegate ) == typeid( *mDelegate )
   } 
```

5 只是我的实际代码，因为我需要先创建一个该类型的对象，然后再检查它是否与我已有的对象相似。

# 没有优化

结果是（我平均了几次运行）：

```
1)  1,840,000 Ticks (~2  Seconds) - dynamic_cast
2)    870,000 Ticks (~1  Second)  - typeid()
3)    890,000 Ticks (~1  Second)  - typeid().name()
4)    615,000 Ticks (~1  Second)  - &typeid()
5) 14,261,000 Ticks (~23 Seconds) - typeid() with extra variable allocations. 
```

所以结论是：

*   对于没有优化`typeid()`的简单转换情况，比`dyncamic_cast`.
*   在现代机器上，两者之间的差异约为 1 纳秒（百万分之一毫秒）。

# 优化 (-Os)

```
1)  1,356,000 Ticks - dynamic_cast
2)     76,000 Ticks - typeid()
3)     76,000 Ticks - typeid().name()
4)     75,000 Ticks - &typeid()
5)     75,000 Ticks - typeid() with extra variable allocations. 
```

所以结论是：

*   对于经过优化的简单演员表，`typeid()`比`dyncamic_cast`.

# 图表

![在此处输入图像描述](https://i.stack.imgur.com/lWuDb.png)

# 编码

根据评论中的要求，代码如下（有点乱，但有效）。'FastDelegate.h' 可从[此处](http://www.codeproject.com/Articles/7150/Member-Function-Pointers-and-the-Fastest-Possible)获得。

```
#include <iostream>
#include "FastDelegate.h"
#include "cycle.h"
#include "time.h"

// Undefine for typeid checks
#define CAST

class ZoomManager
{
public:
    template < class Observer, class t1 >
    void Subscribe( void *aObj, void (Observer::*func )( t1 a1 ) )
    {
        mDelegate = new fastdelegate::FastDelegate1< t1 >;

        std::cout << "Subscribe\n";
        Fire( true );
    }

    template< class t1 >
    void Fire( t1 a1 )
    {
        fastdelegate::FastDelegateBase *iDelegate;
        iDelegate = new fastdelegate::FastDelegate1< t1 >;

        int t = 0;
        ticks start = getticks();

        clock_t iStart, iEnd;

        iStart = clock();

        typedef fastdelegate::FastDelegate1< t1 > FireType;

        for ( int i = 0; i < 100000000; i++ ) {

#ifdef CAST
                if ( dynamic_cast< FireType* >( mDelegate ) )
#else
                // Change this line for comparisons .name() and & comparisons
                if ( typeid( *iDelegate ) == typeid( *mDelegate ) )
#endif
                {
                    t++;
                } else {
                    t--;
                }
        }

        iEnd = clock();
        printf("Clock ticks: %i,\n", iEnd - iStart );

        std::cout << typeid( *mDelegate ).name()<<"\n";

        ticks end = getticks();
        double e = elapsed(start, end);
        std::cout << "Elasped: " << e;
    }

    template< class t1, class t2 >
    void Fire( t1 a1, t2 a2 )
    {
        std::cout << "Fire\n";
    }

    fastdelegate::FastDelegateBase *mDelegate;
};

class Scaler
{
public:
    Scaler( ZoomManager *aZoomManager ) :
        mZoomManager( aZoomManager ) { }

    void Sub()
    {
        mZoomManager->Subscribe( this, &Scaler::OnSizeChanged );
    }

    void OnSizeChanged( int X  )
    {
        std::cout << "Yey!\n";        
    }
private:
    ZoomManager *mZoomManager;
};

int main(int argc, const char * argv[])
{
    ZoomManager *iZoomManager = new ZoomManager();

    Scaler iScaler( iZoomManager );
    iScaler.Sub();

    delete iZoomManager;

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2009-02-23T23:56:44.680

这取决于事物的规模。在大多数情况下，它只是几个检查和一些指针取消引用。在大多数实现中，在每个具有虚函数的对象的顶部，都有一个指向 vtable 的指针，该指针包含指向该类上所有虚函数实现的指针列表。我猜想大多数实现会使用它来存储另一个指向该类的 type_info 结构的指针。

例如在伪 C++ 中：

```
struct Base
{
    virtual ~Base() {}
};

struct Derived
{
    virtual ~Derived() {}
};

int main()
{
    Base *d = new Derived();
    const char *name = typeid(*d).name(); // C++ way

    // faked up way (this won't actually work, but gives an idea of what might be happening in some implementations).
    const vtable *vt = reinterpret_cast<vtable *>(d);
    type_info *ti = vt->typeinfo;
    const char *name = ProcessRawName(ti->name);       
} 
```

一般来说，反对 RTTI 的真正理由是每次添加新的派生类时都必须修改代码的不可维护性。与其到处使用 switch 语句，不如将它们分解为虚函数。这会将类之间不同的所有代码移动到类本身中，因此新的派生只需要覆盖所有虚函数即可成为功能齐全的类。如果每次有人检查类的类型并执行不同的操作时，您都必须在大型代码库中寻找，那么您将很快学会远离这种编程风格。

如果您的编译器允许您完全关闭 RTTI，那么最终节省的代码大小可能会非常显着，因为 RAM 空间如此之小。编译器需要为每个具有虚函数的类生成一个 type_info 结构。如果您关闭 RTTI，则所有这些结构都不需要包含在可执行映像中。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2013-10-29T02:12:45.407

好吧，分析器从不撒谎。

由于我有一个非常稳定的 18-20 类型的层次结构，变化不大，我想知道是否只使用一个简单的*枚举成员*就可以解决问题并避免 RTTI 所谓的“高”成本。如果 RTTI 实际上比`if`它引入的声明更昂贵，我持怀疑态度。男孩哦，男孩，是吗。

事实证明，RTTI**很**昂贵，**比**C++ 中的等效`if`语句或简单的原始变量要昂贵得多。`switch`所以 S.Lott 的回答并不完全正确， RTTI*需要*额外的成本，这*不仅仅是*因为混合*了一个`if`声明*。这是因为 RTTI 非常昂贵。

此测试是在 Apple LLVM 5.0 编译器上完成的，并启用了库存优化（默认发布模式设置）。

因此，我有以下 2 个函数，每个函数都通过 1) RTTI 或 2) 一个简单的开关来确定对象的具体类型。它这样做了 50,000,000 次。事不宜迟，我将向您展示 50,000,000 次运行的相对运行时间。

![在此处输入图像描述](https://i.stack.imgur.com/7O6tJ.png)

没错，它`dynamicCasts`占用了**94%**的运行时间。而`regularSwitch`块只占**3.3%**。

长话短说：如果你有能力`enum`像我在下面做的那样连接一个 'd 类型，我可能会推荐它，如果你需要做 RTTI*并且*性能是最重要的。它只需要设置*一次*成员（确保通过*所有构造函数*获取它），并且确保以后永远不要编写它。

也就是说，**这样做不应该弄乱你的 OOP 实践。**它只适用于类型信息根本不可用并且你发现自己被迫使用 RTTI 的情况。

```
#include <stdio.h>
#include <vector>
using namespace std;

enum AnimalClassTypeTag
{
  TypeAnimal=1,
  TypeCat=1<<2,TypeBigCat=1<<3,TypeDog=1<<4
} ;

struct Animal
{
  int typeTag ;// really AnimalClassTypeTag, but it will complain at the |= if
               // at the |='s if not int
  Animal() {
    typeTag=TypeAnimal; // start just base Animal.
    // subclass ctors will |= in other types
  }
  virtual ~Animal(){}//make it polymorphic too
} ;

struct Cat : public Animal
{
  Cat(){
    typeTag|=TypeCat; //bitwise OR in the type
  }
} ;

struct BigCat : public Cat
{
  BigCat(){
    typeTag|=TypeBigCat;
  }
} ;

struct Dog : public Animal
{
  Dog(){
    typeTag|=TypeDog;
  }
} ;

typedef unsigned long long ULONGLONG;

void dynamicCasts(vector<Animal*> &zoo, ULONGLONG tests)
{
  ULONGLONG animals=0,cats=0,bigcats=0,dogs=0;
  for( ULONGLONG i = 0 ; i < tests ; i++ )
  {
    for( Animal* an : zoo )
    {
      if( dynamic_cast<Dog*>( an ) )
        dogs++;
      else if( dynamic_cast<BigCat*>( an ) )
        bigcats++;
      else if( dynamic_cast<Cat*>( an ) )
        cats++;
      else //if( dynamic_cast<Animal*>( an ) )
        animals++;
    }
  }

  printf( "%lld animals, %lld cats, %lld bigcats, %lld dogs\n", animals,cats,bigcats,dogs ) ;

}

//*NOTE: I changed from switch to if/else if chain
void regularSwitch(vector<Animal*> &zoo, ULONGLONG tests)
{
  ULONGLONG animals=0,cats=0,bigcats=0,dogs=0;
  for( ULONGLONG i = 0 ; i < tests ; i++ )
  {
    for( Animal* an : zoo )
    {
      if( an->typeTag & TypeDog )
        dogs++;
      else if( an->typeTag & TypeBigCat )
        bigcats++;
      else if( an->typeTag & TypeCat )
        cats++;
      else
        animals++;
    }
  }
  printf( "%lld animals, %lld cats, %lld bigcats, %lld dogs\n", animals,cats,bigcats,dogs ) ;  

}

int main(int argc, const char * argv[])
{
  vector<Animal*> zoo ;

  zoo.push_back( new Animal ) ;
  zoo.push_back( new Cat ) ;
  zoo.push_back( new BigCat ) ;
  zoo.push_back( new Dog ) ;

  ULONGLONG tests=50000000;

  dynamicCasts( zoo, tests ) ;
  regularSwitch( zoo, tests ) ;
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-09-23T21:19:10.520

标准方式：

```
cout << (typeid(Base) == typeid(Derived)) << endl; 
```

标准 RTTI 很昂贵，因为它依赖于进行底层字符串比较，因此 RTTI 的速度可能会因类名长度而异。

使用字符串比较的原因是为了使它在库/DLL 边界上一致地工作。如果您静态构建应用程序和/或使用某些编译器，那么您可能可以使用：

```
cout << (typeid(Base).name() == typeid(Derived).name()) << endl; 
```

这不能保证有效（永远不会给出误报，但可能会给出误报），但可以快 15 倍。这依赖于 typeid() 的实现以某种方式工作，而您所做的只是比较一个内部 char 指针。这有时也相当于：

```
cout << (&typeid(Base) == &typeid(Derived)) << endl; 
```

但是，您*可以*安全地使用混合，如果类型匹配，它将非常快，并且对于不匹配的类型将是最坏的情况：

```
cout << ( typeid(Base).name() == typeid(Derived).name() || 
          typeid(Base) == typeid(Derived) ) << endl; 
```

要了解您是否需要对此进行优化，您需要查看与处理数据包所需的时间相比，您花费了多少时间来获取新数据包。在大多数情况下，字符串比较可能不会产生很大的开销。（取决于你的类或命名空间::类名长度）

优化这一点的最安全方法是将您自己的 typeid 实现为 int （或 enum Type : int ）作为 Base 类的一部分，并使用它来确定类的类型，然后只需使用 static_cast<> 或 reinterpret_cast< >

对我来说，未优化的 MS VS 2005 C++ SP1 的差异大约是 15 倍。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-24T00:00:40.927

对于简单的检查，RTTI 可以像指针比较一样便宜。对于继承检查，如果您在一个实现中从上到下进行检查，它可能与`strcmp`继承树中的每种类型一样昂贵。`dynamic_cast`

您还可以通过不使用`dynamic_cast`而是通过 &typeid(...)==&typeid(type) 显式检查类型来减少开销。虽然这不一定适用于 .dll 或其他动态加载的代码，但对于静态链接的东西来说可能非常快。

虽然那时它就像使用 switch 语句，所以你去吧。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-24T15:11:26.917

衡量事物总是最好的。在下面的代码中，在g++下，使用手工编码的类型识别似乎比RTTI快三倍左右。我敢肯定，使用字符串而不是字符的更现实的手工编码实现会更慢，从而使时间更接近。

```
#include <iostream>
using namespace std;

struct Base {
    virtual ~Base() {}
    virtual char Type() const = 0;
};

struct A : public Base {
    char Type() const {
        return 'A';
    }
};

struct B : public Base {;
    char Type() const {
        return 'B';
    }
};

int main() {
    Base * bp = new A;
    int n = 0;
    for ( int i = 0; i < 10000000; i++ ) {
#ifdef RTTI
        if ( A * a = dynamic_cast <A*> ( bp ) ) {
            n++;
        }
#else
        if ( bp->Type() == 'A' ) {
            A * a = static_cast <A*>(bp);
            n++;
        }
#endif
    }
    cout << n << endl;
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-12-02T11:32:51.163

不久前，我测量了 RTTI 在 MSVC 和 GCC 的特定情况下用于 3ghz PowerPC 的时间成本。在我运行的测试中（一个具有深度类树的相当大的 C++ 应用程序），每个`dynamic_cast<>`成本在 0.8μs 到 2μs 之间，具体取决于它是命中还是未命中。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-24T01:12:20.880

> 那么，RTTI 到底有多贵？

这完全取决于您使用的编译器。我知道有些使用字符串比较，有些使用真正的算法。

`dynamic_casts`您唯一的希望是编写一个示例程序并查看您的编译器做了什么（或至少确定执行一百万或一百万`typeid`s需要多少时间）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-08-26T13:27:20.513

RTTI 可以很便宜，并且不一定需要 strcmp。编译器限制测试以相反的顺序执行实际的层次结构。因此，如果您有一个类 C 是类 B 的子类，而类 B 是类 A 的子类，则从 A* ptr 到 C* ptr 的 dynamic_cast 仅意味着一个指针比较而不是两个（顺便说一句，只有 vptr 表指针是比较的）。测试就像“if (vptr_of_obj == vptr_of_C) return (C*)obj”

另一个例子，如果我们尝试从 A* 到 B* 的 dynamic_cast。在这种情况下，编译器将依次检查两种情况（obj 是 C，obj 是 B）。这也可以简化为单个测试（大多数时候），因为虚函数表是作为聚合制作的，因此测试恢复为“if (offset_of(vptr_of_obj, B) == vptr_of_B)”

offset_of = return sizeof(vptr_table) >= sizeof(vptr_of_B) ? vptr_of_new_methods_in_B：0

内存布局

```
vptr_of_C = [ vptr_of_A | vptr_of_new_methods_in_B | vptr_of_new_methods_in_C ] 
```

编译器如何知道在编译时对其进行优化？

在编译时，编译器知道对象的当前层次结构，因此它拒绝编译不同类型的层次结构dynamic_casting。然后它只需要处理层次结构深度，并添加测试的反转量以匹配这样的深度。

例如，这不会编译：

```
void * something = [...]; 
// Compile time error: Can't convert from something to MyClass, no hierarchy relation
MyClass * c = dynamic_cast<MyClass*>(something); 
```

* * *

## 回答 #11

> 赞同：-4
> 
> 时间：2009-02-23T23:56:57.863

RTTI 可能是“昂贵的”，因为您在每次进行 RTTI 比较时都添加了一个 if 语句。在深度嵌套的迭代中，这可能会很昂贵。在永远不会在循环中执行的东西中，它基本上是免费的。

选择是使用适当的多态设计，消除 if 语句。在深度嵌套的循环中，这对性能至关重要。否则，这无关紧要。

RTTI 也很昂贵，因为它会掩盖子类层次结构（如果有的话）。它可能具有从“面向对象编程”中删除“面向对象”的副作用。

# php - PHP 日历重复逻辑

> ID：579892
> 
> 赞同：0
> 
> 时间：2009-02-23T23:48:36.900
> 
> 标签：php, calendar, icalendar, recurrence

我知道已经有一百万个项目已经做到了这一点。话虽如此，我想做的是使用 PHP & MySQL 创建一个在线日历，这就是我的计划：

1.  数据库中的表

    ```
    ((calendar_item)
    id, title, start_date, start time, end time, recurrence_type_id,
    recurrence_qty, interval, end_date)
    ((recurrence_type)
    id, name, value (where I want to store the logic so it can be edited
    on the fly))
    ((calendar_item_exception)
    id, calendar_item_id, title, start_date, start time, end time,
    recurrence_type_id, recurrence_qty, interval, end_date)
    ((join_calendar_day)
    calendar_id, day_id)
    ((day)
    id, name) 
    ```

2.  基本流程，从数据库中拉取所有记录 INNER JOIN calendar_item 和 calendar_item_exception ON id/calendar_item_id

3.  首先查看今天的日期是否有异常，然后打印那里的任何内容……如果没有任何内容移动到 calendar_item。

到目前为止，这一切在我的脑海中都是完全合理的。我想知道从这里到哪里添加recurrence_id的实际逻辑以及如何实现它：

即项目在 __date recurs (recurrence_id) 每天 (qty) 5x (interval) 每 3 天 (join_calendar_day) 周一、周三、周五

我已经看过 ical 格式，并且看过 PEAR，但老实说，我无法在脑海中掌握下一步来制作异常（我真的希望在不使用其他框架的情况下发生这种情况，最好只使用 PHP 和 MySQL）。

为了进一步澄清我的问题，我正在寻找现实世界的例子，而不是抽象的原则；我不是程序员，所以我必须看到一些有效的东西，这样我才能剖析它来理解它。

没有 PEAR，没有 Ruby，没有 Horde，没有其他框架，只有 PHP 和 MySQL，请尽可能简单。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T00:52:26.467

这是这些问题的重复：

*   [设计问题：你将如何设计一个循环事件系统？](https://stackoverflow.com/questions/123793/design-question-how-would-you-design-a-recurring-event-system)
*   [在日历应用程序中模拟重复事件的最佳方法是什么？](https://stackoverflow.com/questions/85699/whats-the-best-way-to-model-recurring-events-in-a-calendar-application)

其中一个问题的一个很好的链接是Martin Fowler 的[这篇文章](http://martinfowler.com/apsupp/recurring.pdf)。

# sqlite - 在哪里可以找到带有模式智能感知的 SQLite 代码编辑器？

> ID：579906
> 
> 赞同：1
> 
> 时间：2009-02-23T23:53:07.327
> 
> 标签：sqlite, intellisense

是否有支持 SQLite 数据库并且还具有模式智​​能感知功能的 SQL 编辑器？

我似乎找不到任何东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T00:14:56.913

你试过[SQLite 管理员](http://sqliteadmin.orbmu2k.de/)吗？它一点也不差，而且是免费的:)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T23:59:09.057

你应该试试[RazorSQL](http://www.razorsql.com/)。他们有一个[SQLite SQL 编辑器](http://www.razorsql.com/features/sqlite_editor.html)。

从他们的页面：

*   SQL 语法高亮
*   SQL 函数查找
*   自动查表和完成
*   自动列查找和完成
*   广泛的查找、替换和查找/替换文件功能
*   括号、圆括号和大括号自动匹配
*   支持参数化查询
*   SQL 格式化程序
*   Execute、Execute Fetch All 和 Execute Batch 函数
*   查询结果的多表格显示
*   可排序的查询结果
*   可过滤的查询结果
*   可搜索的查询结果
*   所有查询的 SQL 历史记录和每个连接的查询日志
*   查询导航器，用于在编辑器中显示可点击的查询显示
*   用于一键填充用户定义文本的 Key Ahead 功能
*   内置和自定义用户模板
*   连接保活
*   插件 API（允许用户向 RazorSQL 添加自定义功能）

# sql-server-2005 - 在 SQL 2005 中进行跨数据库调用是否会对性能产生影响？

> ID：579908
> 
> 赞同：3
> 
> 时间：2009-02-23T23:54:07.277
> 
> 标签：sql-server-2005

在 SQL 2005 中进行跨数据库调用是否会对性能产生影响？换句话说，存储过程和函数在与数据所在的数据库相同的数据库中运行会更好吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-25T13:29:44.733

不会影响性能，但可能会影响灾难恢复。例如，如果您正在执行数据库镜像，您可能会在另一个数据库故障转移之前将一个数据库故障转移到 DR 数据中心。如果它们被设计为在与它们自己不同的数据库中执行，并且该数据库已故障转移，则您的查询将失败。为简单起见，您可能希望在正确的数据库中运行它们以防止此类问题 - 想想几年后当您离开并且其他人必须维护应用程序时会发生什么。

其次，有一个绩效报告的含义。当您对数据库进行配置文件/跟踪时，您可能会尝试根据数据库过滤活动。如果查询来自不同的数据库，除非您从两个数据库中捕获活动，否则您不会捕获这些查询。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-24T14:03:20.683

如果数据库驻留在相同的服务器实例中，则不是很多。如果它们驻留在不同的服务器实例中，您需要承担传输请求和数据的成本。所以我想答案是肯定的，让它在同一个数据库中运行会更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T06:45:03.620

回答您的具体问题，是的，代码在与您的表相同的数据库中更好。

*   [所有权链接](http://msdn.microsoft.com/en-us/library/ms188676(SQL.90).aspx)（代码到表）
*   [跨数据库所有权链接](http://msdn.microsoft.com/en-us/library/ms188694(SQL.90).aspx)问题
*   管理安全。您的服务器级登录映射到数据库级用户。这需要 maitianed 两次
*   BCP 问题（版本冲突、数据不匹配等）

没有性能开销（同一台服务器），但存在巨大的维护问题。

请问你为什么要考虑这个设计？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T11:33:26.337

国标，

包含数据的数据库来自第 3 方 MS Enterprise Server 应用程序。我们不想在这个数据库中放置自定义 SQL。我们选择创建一个自定义数据库，在需要的地方进行跨数据库查询。

# c# - 当要滚动的项目太多时，Windows 窗体列表框溢出

> ID：579912
> 
> 赞同：3
> 
> 时间：2009-02-23T23:55:47.803
> 
> 标签：c#, .net, winforms, listbox

我正在构建一个基于后缀树的索引器应用程序，它使我能够非常快速地索引整个文档并搜索字符串、子字符串等。

我正在做的是在文本框中输入一个字符串，按下一个按钮，然后运行一个查询后缀树并将字符串的所有出现位置添加到列表框的函数。所以列表框里面有很多整数。

通常，这可以正常工作。例如，搜索“wizard”或“Gandalf”或“hobbit”（我将 FOTR 作为测试：D）工作得很好而且很花哨。但是，我现在正在尝试使用字母 e。

问题是字母 e 的位置确实列在列表框中。全部 88974 个。但是，当我通过拖动滚动按钮向下滚动时，当我在项目 60000 左右时，列表框似乎会循环回到顶部。由于我尝试向下滚动页面并且一切正常，因此问题变得更加复杂。

我知道滚动 88974 个（基于 listbox.Items.Count）项目有点极端，但从逻辑上讲，没有理由应该出现这样的问题。

感谢您阅读到这里！

编辑：对于所有回答的人，感谢您的回答。我终于用列表视图实现了这个，它更快，并且可以很好地容纳许多项目。谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-24T01:43:17.263

这是一个特定于 Vista 的错误。当您滚动超过 65536 + 可见项目数时，它会变得疯狂。该错误未在 SP1 中得到修复。XP中没有问题。但是，是的，这是一个很少被测试的错误。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-24T00:50:53.363

可能 ListBox 仍然使用 16 位范围/位置消息作为滚动条。如果是底层控件的问题，您可以尝试在 Win32 中重现它。

您可能想尝试使用列表视图控件而不是列表框。我希望它不会遇到这个限制，它的虚拟模式也应该更有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T00:36:31.183

听起来您在 16 位 (2^16=65536) 点附近遇到了奇怪的问题。我的猜测是，这是控件的滚动逻辑中的一个错误，导致该点附近出现打嗝。我想他们认为没有人会在列表框中放置超过 65000 个项目 :)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-24T02:10:59.303

正如其他人所说，您似乎遇到了可以存储在 ListBox 中的最大项目数的限制。您可能最好切换到在虚拟模式下使用具有这么多项目的 DataGridView。

对于 SO 答案来说，实现 DataGridView 有点太长了，但这里有一个教程的链接：

[http://msdn.microsoft.com/en-us/library/2b177d6d.aspx](http://msdn.microsoft.com/en-us/library/2b177d6d.aspx)

# c# - 软件架构和数据库设计：每个公司一个数据库/Web 应用程序，还是所有公司一个数据库/Web 应用程序？

> ID：579919
> 
> 赞同：5
> 
> 时间：2009-02-23T23:57:06.253
> 
> 标签：c#, sql-server, database-design, architecture, deployment

我正在从头开始设计一个 Web 驱动的 SQL 数据库应用程序。该应用程序将为处于同一行业类型的客户管理信息。换句话说，关于每个客户端的信息（实体和它们之间的关系）不会因一个而异。但是，信息量取决于公司的规模。该应用程序可以托管在我们的服务器上或客户选择的任何地方。

**我的第一个问题是：以下选项的优缺点是什么：**

*   A.在同一个数据库中管理多个客户信息；
*   B. 每个数据库管理一个客户信息；所以每个客户都有自己的数据库；

**我的第二个问题是：以下部署方法的优缺点是什么？**

*   A. 每个客户端都有自己的服务器（节点）；
*   B. 将大型 RAID 驱动器与具有多个网站的强大服务器一起使用；

由于对这些选择的决定会影响我的设计，我想从不同的角度了解优缺点，包括维护、成本（财务和时间）和架构等等。

使用的技术：

*   数据库：MS SQL
*   平台：ASP.NET
*   语言：C#

欢迎任何意见或建议，

谢谢，

卡伦

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-24T00:36:44.803

我会混合这个。**将其设计为能够使用单独的数据库，但在有明显的性能优势之前不要分开。**

设计您的应用程序，以便多个客户端可以存在于同一个数据库中。（即在客户端数据之间建立一层分离）。然后计划将其全部存储在一个数据库中。

这样，您一开始就不会过度设计您的解决方案，但它使您可以灵活地将使用率非常高的客户端分拆到专用数据库。如果您的数据库中只有一个客户端，那又如何呢？这也将节省服务器成本，因此您可以确保在添加更多容量之前以合理的方式使用硬件投资。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-24T00:26:11.427

我不建议为每个客户提供自己的数据库。我计划为我当前的应用程序这样做，并被谈成一个单一的数据库。好事，因为我们现在有 300 个客户。你能想象管理 300 个数据库吗？每次升级都更新？确保每个都是最新的，等等。

免责声明：在实践中，我们实际上有几个数据库。一些非常大的客户拥有自己的数据库，其他人共享剩余的数据库。我想总共可能有 7 个数据库。

我们在一台功能强大的 SQL 服务器上拥有数据库。如果您有多个数据库并将它们放在不同的服务器上，您将面临一些服务器比其他服务器更忙而小型客户端未充分利用其服务器的风险。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-24T00:32:29.587

您确实想查看以下内容：

[https://docs.microsoft.com/en-us/azure/sql-database/sql-database-design-patterns-multi-tenancy-saas-applications](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-design-patterns-multi-tenancy-saas-applications)

这是一篇讨论多租户架构的不同设计场景的论文。从适当的数据分区、安全性和技能组合中，有很多事情需要考虑。

*更新了新链接

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-02T21:01:26.960

我有运行大约 40 个客户的**单租户**设计的经验。每个客户端都有单独的 ASP.NET 应用程序文件和一个 SQL Server 数据库。每个客户端的应用程序核心二进制文件都是相同的，但客户端也有自定义模块。

我建议首先将整个系统设计为多租户，但在必要时保留选择单租户的选项。我认为我们采用单租户的原因来自客户需求。我们的许多客户在他们的 Intranet 中运行该应用程序。

事实证明，我们的业务非常以客户为导向，具有许多针对客户的定制功能。为此，单租户设置非常适合。但我认为不可能将其扩展到更低的价格点和更大的客户群。

**优点**

*   适合商业软件。易于定制，但您仍然可以从重复使用中受益
*   只要每个数据库小于 4GB，我们就可以在每个服务器上使用一个 SQL Express 实例
*   客户之间有很多分离。例如，每个客户端可以有一个单独的 IIS 应用程序池
*   更多系统级别的安全性，而不是完全应用程序级别
*   单个客户端软件版本可长期冻结
*   错误通常不会出现在每个客户端上
*   可以根据实际客户需求很好地扩展新功能。功能的第一批客户基本上是 beta 测试人员

**缺点**

*   对消费软件不利。不要期望扩大规模
*   维护是劳动密集型的：更新、备份、调试客户端特定的问题......
*   当版本略有不同时，质量控制会更加困难。更新后出现意外问题

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-24T00:25:49.463

最大的问题是应用程序的维护和更新。如果您运行多个实例，则必须维护/升级所有这些实例，如果它们在地理位置上位于不同的区域，这将变得更加麻烦。

目前商业软件行业的总体趋势是将您的应用程序集中到您自己的服务器上，并将软件作为服务提供给您的客户。

我可以看到必须在您的客户站点上运行应用程序的唯一真正原因是：如果它正在处理敏感信息并且公司有限制远程存储该数据的政策。

如果您担心硬件成本，您可以考虑[Amazon s2](http://aws.amazon.com/ec2/)、[Google App Engine](http://code.google.com/appengine/)和[Microsoft Azure](http://www.microsoft.com/azure/default.mspx)等云托管服务。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-02T21:08:42.873

除了性能等，提供单独的数据库是否最适合您的客户？如果没有您的公司和/或许可证，该软件是否可以存在或使用？

例如，简单的电子商务解决方案必须提供数据库，以便在出现业务需求时可以将内容和数据库从主机移动到主机。假设您的公司没有失败，则永远使用您的软件。我怀疑我的公司会使用这样的解决方案，尽管如果我们知道以后可以在内部托管它，我们可能会使用托管解决方案。

安全性也是另一个问题。一个数据库存在单点故障，如果一个客户受到威胁并且您的代码中有错误，那么您所有客户的潜在风险都会暴露出来。

应用程序是否会被定制，如果是这样，单个数据库会导致问题吗？

# javascript - Firebug 可以在外部 JavaScript 文件中设置断点吗？

> ID：579920
> 
> 赞同：4
> 
> 时间：2009-02-23T23:57:15.537
> 
> 标签：javascript, firebug

[Firebug](http://www.getfirebug.com/)中是否有任何方法可以在页面链接到的外部 .js 文件中设置断点，以便可以单步执行？

（我怀疑我在 jQuery 中发现了一个错误，我希望能够单步执行 jQuery，因为它正在处理事件以查看它在做什么。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-24T00:04:45.223

不确定我是否理解这个问题，但我认为 Firebug 对待外部 JavaScript 的方式与处理内部 JavaScript 没有任何不同。只需转到“脚本”选项卡，在下拉列表中选择 .js 文件并设置断点。

# c# - 如何获取休眠 DynamicProxy 的代理类型的全名？

> ID：579921
> 
> 赞同：0
> 
> 时间：2009-02-23T23:57:41.370
> 
> 标签：c#, .net, nhibernate, castle-windsor, proxy-classes

我正在使用 netdatacontractserializer 和 SerializationBinder 为客户端的休眠代理创建自己的运行时类型。

除了我被迫假设域模型中的每个名称只有一种类型之外，这一切都有效。即我被迫忽略命名空间。原因是 SerializationBinder 只允许我访问“MyObjectProxyb04bae2d04d34e8a98b1d93bf24428cc”和“DynamicProxyGenAssembly2，Version=0.0.0.0，Culture=neutral，PublicKeyToken=null”来派生父类型。

如您所见，没有数据指向父类型的命名空间。

我已经查看了更改生成代理的名称（以包含名称空间前缀），但这似乎是硬编码的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-25T00:58:51.090

您可以将代理转换为 INHibernateProxy 并获取持久的底层类：

```
((INHibernateProxy)proxy).HibernateLazyInitializer.PersistentClass 
```

# java - 生成唯一负数的非阻塞算法

> ID：579925
> 
> 赞同：2
> 
> 时间：2009-02-23T23:58:48.793
> 
> 标签：java, algorithm, atomic, nonblocking

我最近重构了一段用于生成唯一负数的代码。
**编辑：**多个线程获取这些 id 并作为键添加到数据库；数字需要为负数才能轻松识别 - 在测试会话结束时，它们会从数据库中删除。

我的 Java 算法如下所示：

```
private final Set<Integer> seen = Collections.synchronizedSet(new HashSet<Integer>());
public Integer generateUniqueNegativeIds() {
    int result = 0;
    do {
        result = random.nextInt();
        if (result > 0) {
            result *= -1;
        }
    } while (!seen.add(result));
    return result;
} 
```

上面的代码结构，加上它对集合和“重试”循环的推测性添加，让我觉得有一个等效的非阻塞算法可以用任何[原子变量](http://java.sun.com/docs/books/tutorial/essential/concurrency/atomicvars.html)替换同步集合。

我做了几次尝试使用原子变量重写，但都没有通过多线程攻击测试。

有没有优雅的非阻塞等价物？

**编辑：**出于好奇，这是使用原子整数作为保护的有缺陷的尝试

```
private final AtomicInteger atomi = new AtomicInteger(0);
public Integer generateUniqueNegativeIdsWithAtomicAlgo() {
    boolean added = false;
    int result = 0;
    do {
        result = random.nextInt();
        if (result > 0) {
            result *= -1;
        }
        if (atomi.compareAndSet(0, result)) {
            added = cache.add(result);
        }   
    } while (!added);
    return atomi.getAndSet(0);
} 
```

**编辑：**下面的测试工具：

```
public static void main(String[] args) {
    final int NUMBER_OF_THREADS = 10000;
    final Set<Integer> uniques = Collections.synchronizedSet(new HashSet<Integer>());
    final List<Integer> positives = Collections.synchronizedList(new ArrayList<Integer>());
    final NegativeUniqueIdGenerator nuig = new NegativeUniqueIdGenerator();
    Thread[] workers = new Thread[NUMBER_OF_THREADS];
    long start = System.nanoTime();
    for (int i = 0; i < workers.length; i++) {
        Runnable runnable = new Runnable() {
            public void run() {
                int number = nuig.generateUniqueNegativeIds();
                if (number > 0) {
                    positives.add(number);
                }
                uniques.add(number);
            }
        };
        workers[i] = new Thread(runnable);
        workers[i].start();
    }
    for (int i = 0; i < workers.length; i++) {
        try {
            workers[i].join();
        } catch (InterruptedException ie) {}
    }
    long end = System.nanoTime();
    System.out.println(String.format("duration = %dns", (end - start)));
    System.out.println(String.format("#threads = %d", NUMBER_OF_THREADS));
    System.out.println(String.format("#uniques = %d", uniques.size()));
    System.out.println(String.format("#positives = %d", positives.size()));
    System.out.println(String.format("#duplicates = %d", NUMBER_OF_THREADS - uniques.size()));
    System.out.println(String.format("ratio = %f",
            ((double) NUMBER_OF_THREADS - uniques.size())
                    / NUMBER_OF_THREADS));
    assert uniques.size() == NUMBER_OF_THREADS;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-24T00:06:40.833

如果您不关心随机性，您可以减少一个计数器，如下所示：

```
private final AtomicInteger ai=new AtomicInteger(0);

public int nextID() {
  return ai.addAndGet(-1);
} 
```

编辑：

对于随机数，您可以使用您的解决方案并使用例如。ConcurrentHashMap 或 ConcurrentSkipListSet 而不是 synchronizedSet。您必须确保不同的线程使用随机生成器的不同实例，并且这些生成器不相关。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-24T00:38:07.747

建议使用计数器的其他答案非常好，但如果不可预测性（或至少非平凡的可预测性）*很*重要，那么您的原始算法应该没问题。

为什么？

基本上，你会得到一个重复整数的概率是非常非常（非常）（非常）小，大约是 1 除以你还没有看到的整数个数。如果您已经生成`N`了数字，则算法的预期运行时间近似线性，`N`系数为 1/2^32，这意味着您必须生成超过十亿个数字才能使预期运行时间超过 2 次迭代循环！在实践中，检查集合中是否存在某个数字将比重复循环的可能性更能延长算法的运行时间（好吧，除非你使用`HashSet`可能 - 我忘记了它的渐近运行时间是什么）。

对于它的价值，确切的预期循环迭代次数是

```
2^64/(2^32 - N)^2 
```

在您生成一百万个数字后，结果为 1.00047 - 这意味着，例如，要生成第 1,000,001 到第 1,002,000 个数字，您可能会在所有这些调用中得到*一个*重复数字*total 。*

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-24T00:03:30.747

据我所知，所有列出的需求的优雅解决方案只是从 -1 开始递减一个值。但是，我怀疑您没有列出所有要求。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-24T05:24:24.253

根据您给出的要求，我个人只会使用中等质量的随机数生成器，您知道它不会在您需要的唯一数字数量内产生重复。除非您有未提及的额外要求，否则保留所有先前生成的数字的集合似乎有点过分。

例如，使用 32 位 XORShift 生成器将在重复模式之前以“随机”顺序生成所有 2^31 个负 4 字节整数。如果您需要比这更多的数字，您可能不希望将它们放在哈希集中。所以像这样的东西（警告：未经测试的头顶代码......）：

```
int seed = (int) System.nanoTime();
final int origSeed = seed;

public int nextUniqueNegativeNumber() {
  int n = seed;
  do {
    n ^= (n << 13);
    n ^= (n >>> 17);
    n ^= (n << 5);
    seed = n;
    if (n == origSeed) {
      throw new InternalError("Run out of numbers!");
    }
  } while (n > 0);
  return n;
} 
```

如果需要并发，我会留给读者将“种子”转换为使用 AtomicInteger ......

编辑：实际上，为了优化并发情况，您可能只想在获得下一个*负数*后写回“种子” 。

好的，根据大众的需求，原子版本将是这样的：

```
 AtomicInteger seed = new AtomicInteger((int) System.nanoTime());

  public int nextUniqueNegativeNumber() {
    int oldVal, n;
    do {
      do {
        oldVal = seed.get();
        n = oldVal ^ (oldVal << 13); // Added correction
        n ^= (n >>> 17);
        n ^= (n << 5);
      } while (seed.getAndSet(n) != oldVal);
    } while (n > 0);
    return n;
  } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-25T03:04:16.687

试试这个：[http ://www.javaconcurrencyinpractice.com/listings.html](http://www.javaconcurrencyinpractice.com/listings.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-25T03:49:41.990

我会将 OP 的答案与 jpalecek 的答案结合起来给出：

```
private final AtomicInteger ai=new AtomicInteger(0);

public int nextID() {
    return ai.addAndGet(-1 - random.nextInt(1000));
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-25T04:26:15.477

高级库有一个可以使用的 NonBlockingHashSet。只需将您的 set 实例替换为 NonBlockingHashSet 的实例即可。

[http://sourceforge.net/projects/high-scale-lib](http://sourceforge.net/projects/high-scale-lib)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-24T00:29:28.720

我认为你的意思是非阻塞和可重入的。

**编辑：（**替换我原来的，因为这要好得多）

一个基于线程的选项实际上非常高效（至少比原来的性能更高）。如果您创建了一个弱散列映射，其中一个线程对象作为“键”并作为“值”，则放置一个能够从特定范围内制造一系列例如 1000 个数字的对象。

这样你就可以为每个线程分配它自己的 1000 个数字范围来分配。当对象的数字用完时，让它返回一个无效的数字（0？），您就会知道您必须为该对象分配一个新的范围。

任何地方都不会同步任何东西（编辑：哎呀，有点错误。见下文），弱哈希映射会自动释放被破坏的线程（无需特殊维护），最慢的部分将是线程的单个哈希查找这实际上非常快。

获取当前正在运行的线程：

```
Thread currThread=Thread.getCurrentThread(); 
```

我也可能是错的，您可能只需要使方法同步，那么这将起作用：

```
int n=-1;
synchronized int getNegativeNumber() {
    return n--;
} 
```

我继续写了它（有时这些东西在我写之前一直卡在我的脑海里，只要我写了，我还不如把它贴出来）。未经测试，但我很确定它应该是关闭的，如果不是开箱即用的话。只有一个类和一个静态方法可以调用以获得唯一的负数。（哦，我确实需要一些同步，但它只会被使用 0.001% 的时间）。

希望有一种方法可以创建链接代码块，而不是像这样在不离开站点的情况下内联 - 对不起长度。

```
package test;

import java.util.WeakHashMap;

public class GenNumber {
    // Static implementation goes first.
    private static int next = -1;
    private static final int range = 1000;

    private static WeakHashMap<Thread, GenNumber> threads = new WeakHashMap<Thread, GenNumber>();

    /**
     * Generate a unique random number quickly without blocking
     * 
     * @return the random number < 0
     */
    public static int getUniqueNumber() {
        Thread current = Thread.currentThread();
        int next = 0;

        // Have to synchronize some, but let's get the very
        // common scenario out of the way first without any
        // synchronization. This will be very fast, and will
        // be the case 99.9% of the time (as long as range=1000)
        GenNumber gn = threads.get(current);
        if (gn != null) {
            next = gn.getNext();
            if (next != 0)
                return next;
        }

        // Either the thread wasn't found, or the range was
        // used up. Do the rest in a synchronized block.
        // The three lines tagged with the comment "*" have
        // the potential to collide if this wasn't synchronized.
        synchronized (threads) {
            if (gn == null) {
                gn = new GenNumber(next -= range); // *
                threads.put(current, gn); // *
                return gn.getNext(); // can't fail this time
            }
            // now we know the range has run out

            gn.setStart(next -= range); // *
            return gn.getNext();
        }
    }

    // Instance implementation (all private, nobody needs to see this)
    private int start;
    private int count;

    private GenNumber(int start) {
        setStart(start);
    }

    private int getNext() {
        if (count < range)
            return start - count;
        return 0;
    }

    private GenNumber setStart(int start) {
        this.start = start;
        return this;
    }
} 
```

让我感到震惊的是，可以用两个在不同对象上同步的非常小的同步块代替一个大的同步块，一个用于“+= count”，一个用于 .put()。如果碰撞仍然让你慢下来，那可能会有所帮助（尽管如果碰撞仍然让你慢下来（真的？？？）你最好只增加计数。

# actionscript-3 - 使用 asdoc 时跳过某些文件/类

> ID：579950
> 
> 赞同：2
> 
> 时间：2009-02-24T00:07:21.270
> 
> 标签：actionscript-3

由于某些原因，**asdoc**似乎只擅长“排除”类而不擅长“跳过”，这意味着所有文件将始终被遍历并检查错误。

有没有办法让**asdoc**真正“跳过”某些文件？所以它可以绕过一些已知的有问题的文件，仍然可以优雅地生成必要的文档。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T23:39:48.270

我们还没有找到一种让 asdoc*跳过*文件的方法，但是我们只提供了一个我们想要解析的文件的白名单来让它工作。您可以轻松编写一个脚本来查找所有 *.as 文件并将它们与“拒绝”列表进行比较，然后将它们全部传递给 asdoc。

较新版本的 asdoc 支持 exclude-sources - 请参见[此处](http://bugs.adobe.com/jira/browse/SDK-16545?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel)。更多[在这里](http://www.adobeforums.com/webx/.59b703a1)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-25T14:11:51.170

仅在 Gumbo(Flex 4) 中可用的 asdoc 工具有一些增强功能：http: [//opensource.adobe.com/wiki/display/flexsdk/Download+Flex+4](http://opensource.adobe.com/wiki/display/flexsdk/Download+Flex+4)

除了 RizwanK 提到的选项**“-exclude-sources”**之外，还有**“-lenient”**来询问 asdoc 生成输出，即使它在 ASDoc 注释中遇到错误 - 当指定时，lenient 选项会导致工具省略不正确的从输出 ASDoc 注释，但完成构建。

# django - 模型下一个可用的主键

> ID：579957
> 
> 赞同：11
> 
> 时间：2009-02-24T00:11:57.233
> 
> 标签：django, django-models

我如何知道某个模型的下一个免费主键？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-24T01:12:32.673

即使您可以查询下一个可用的主键值，它也无济于事。除非您锁定表，否则您不能在其他数据库客户端获取该值进行插入之前使用该值。

相反，您应该只插入您的行，然后您可以查询当前会话期间生成的*最新*键值。每个支持自动生成主键的数据库都提供了一种方法来检索会话期间插入的最新键。

“在您的会话期间”部分很重要，因为它使您的会话免受其他客户端同时进行的任何插入的影响。它们可以生成键值，您的会话将继续报告*它*最近插入的相同值。

@Stuart Childs[假设](https://stackoverflow.com/questions/579957/model-next-available-primary-key/580061#580061)MySQL 生成下一个 ID，`MAX(column_name)+1`但这是不正确的。假设您插入一行并生成一个 ID 值。但是您回滚此插入，或随后回滚该`DELETE`行。下次插入时，MySQL 会生成一个全新的 ID 值。因此，无论表中当前存储了哪些行， ID 值都比*任何客户端*生成的最后一个 ID 值大一。

同样，如果您插入但不立即提交。在您提交之前，其他一些客户端会执行插入操作。您的会话和其他客户的会话都将生成自己的唯一 ID 值。自动生成的主键操作不考虑事务隔离，以确保唯一性。

自动生成的主键值不会重复使用或分配给多个会话，即使您尚未提交插入、回滚插入或删除行也是如此。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-06-12T01:36:36.147

- 使用 Django 和 Mysql

next_id = Table.objects.filter(id__gt = current_id)[0].id

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-04-30T02:31:06.157

```
next_id = User.objects.order_by('-id').first().id + 1 
```

如果不存在，可能需要处理。

或使用最大查询：

```
from django.db.models import Max
users = User.objects.all()
#might be possible model has no records so make sure to handle None
next_id = users.aggregate(Max('id'))['id__max'] + 1 if users else 1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-24T00:53:05.417

我认为您必须执行一些[自定义 SQL](http://docs.djangoproject.com/en/dev/topics/db/sql/#topics-db-sql)。您需要的 SQL 将是特定于数据库的。据我所知，在 MySQL 中没有可靠的方法来做到这一点。您可以获得最后一个插入 ID，但它是特定于会话的（即，您可以获得您在数据库会话中插入的最后一条记录的 ID，但不能获得可能在您之后发生的另一个会话的最后一个 ID）。 ~~但是（如果我错了，有人纠正我），MySQL 使用 MAX(column_name) + 1 生成下一个 ID，所以你可以这样做。~~

[PostgreSQL 通过它的序列操作函数](http://www.postgresql.org/docs/8.3/interactive/functions-sequence.html)使它变得容易得多。

编辑：

原来我正在考虑使用 MAX(column_name)+1 生成`AUTO_INCREMENT`的[多列键](http://dev.mysql.com/doc/refman/5.1/en/example-auto-increment.html)中*的列。*但是，重点仍然是在下一个 ID由插入生成*之前*无法检索它，这是原始问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-23T21:35:20.527

我有同样的问题，因为我正在复制一个元素，我想将它的 pk 更改为一个新的以便能够插入它。

我的解决方案如下：

```
import copy
objectCopy=copy.copy(object)
objectCopy.pk=None
objectCopy.save() 
```

我的意思是，如果`save()`为你做，你为什么要手动做呢？

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-01-17T12:00:32.110

[这个](http://djangosnippets.org/snippets/1415/)片段肯定会帮助你。

# model-view-controller - 你应该在 MVC 中给你的控制器起什么名字？什么时候应该创建一个新的？

> ID：579958
> 
> 赞同：9
> 
> 时间：2009-02-24T00:13:05.607
> 
> 标签：model-view-controller, controller, heuristics

我有一个真正适用于任何 MVC 框架的问题，我正在使用 Zend Framework MVC。

你应该在什么时候创建一个新的控制器？控制器层究竟应该定义什么？

我用 MVC 创建了几个应用程序，逐渐变得更加可重用，但我一直在为控制器类命名而苦苦挣扎。在大多数情况下，它匹配任何 URL 请求，因此是业务/前端逻辑。但在某些情况下，这似乎完全是武断的。

有人可以遵循一些启发式/指南吗？似乎所有关于 MVC 的炒作，尤其是 PHP，关于实际约定和启发式的数据很少。因为创建一个杂乱无章的 MVC 应用程序非常容易......

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-24T06:59:01.483

我通常为每个逻辑功能组配备一个控制器。通常这将对应于每个模型一个控制器，有时不是。

想象一下，您正在创建一个简单的在线目录，其中显示一个类别列表，然后当用户选择一个类别时，显示该类别的产品列表，以及一个用于`CRUD`对类别和产品进行操作的管理面板。我有两个模型（`CategoryModel`和`ProductModel`）。我有一个为前端生成类别列表的控制器，以及另一个生成产品列表的控制器（例如`CategoryController`和`ProductController`）。然后我会在后端有一个类别和产品的控制器（`AdminCategoryController`和`AdminProductController`）。两个后端控制器将处理它们各自模型的列表/添加/编辑/删除/查看操作。如果您考虑您的 URL 结构并将相关函数放在相关 url 上，那么您的控制器结构通常会与您的 URL 结构匹配。事实上，一些框架（例如 CodeIgniter）基于控制器的名称作为默认行为路由请求。

至于控制器中的内容，我认为模型用于数据访问，并包装和隐藏数据库结构。诸如“当状态设置为‘完成’时将当前时间分配给完成日期”之类的逻辑非常适合模型。

视图包含整个演示文稿。控制器/模型不应生成或处理 HTML。2 列或 3 列等决策属于视图。视图中的逻辑应限于生成可见输出所需的逻辑。如果您发现自己想从视图中查询数据库，那么您可能在视图中放入了太多逻辑。

控制器用于剩下的东西。一般来说，这意味着验证输入、将表单数据分配给模型、选择正确的视图并实例化处理请求所需的模型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T01:15:26.877

在大多数情况下，我遵循每个模型的控制器模式。我有一些控制器可以服务于多个模型（例如服务于多个管理模型的 Admin 控制器），但一般规则是每个业务模型一个控制器。

# c# - C# 鼠标悬停时点亮按钮？

> ID：579959
> 
> 赞同：0
> 
> 时间：2009-02-24T00:14:05.747
> 
> 标签：c#, winforms

当我将鼠标悬停在程序 (Vista) 中的一个按钮上时，该按钮变为蓝色（发光），我需要改进引导用户完成程序的方式，因此我正在考虑突出显示指示下一步的相应按钮。这听起来是错误的方式还是可以接受的？我假设我可以将按钮编码为发光。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T00:23:04.943

这取决于您的目标受众。您是否需要了解可访问性以及色盲或法律盲的用户？此外，用户可以更改操作系统的视觉风格，因此您不必依赖能够重现“悬停”效果。

一般来说，你的 UI 设计应该足够直观，以至于你不需要添加明确的视觉提示来说明如何使用它。再说一次，这取决于它是什么类型的应用程序以及您想要实现的目标。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T02:32:49.267

您不应该需要颜色作为下一步指示。您的应用程序阻止使用“下一步”或“继续”按钮的原因是什么？通常，我会坚持特定平台的用户也已经习惯的预期规范。

对于 90% 的应用程序，用户只想尽可能快速有效地完成工作。因此，如果您需要颜色来告知他们下一步的建议，那么您的 UI 可能太复杂了。您可能需要将当前的一些单步屏幕重构为 2 个或更简单的屏幕。

我个人认为更好的 UI 设计是我们几乎没有注意到的。如果用户不得不浪费脑力循环解释需要他们将蓝色与 Go 或 Next 相关联的 UI 导航系统，那么坦率地说，我认为它失败了......特别是因为我来自“Green”的地方更可能意味着“Go ”。

顺便说一句，谁说你“需要”改进它的导航？你真的也“需要”吗？或者你只是想炫耀一些你刚刚学到的可能非常酷但可能完全无用的编程技巧？来吧，说实话；）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T00:18:36.437

如果您使用的是 WPF，则使用样式和控件模板很容易做到这一点。您可能希望了解新的 Visual State Manager 功能。适当地考虑每个“步骤”一个状态和颜色按钮。

另一个需要研究的小巷是使用装饰器来突出显示控件周围或旁边的区域，例如箭头和彩色边框。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-24T00:26:44.280

是的，在 WinForm 中，您只需在鼠标悬停事件上运行动画。

我认为这是一个不错的方法（尽管也许你最好先关注功能；））因为它是一个漂亮的 UI 提示，总是看起来不错。

# c# - 我可以从 Func 中获取特定的元数据吗 ?

> ID：579963
> 
> 赞同：7
> 
> 时间：2009-02-24T00:15:20.220
> 
> 标签：c#, .net, linq, generics, reflection

考虑以下代码：

```
string propertyName;
var dateList = new List<DateTime>() { DateTime.Now };
propertyName = dateList.GetPropertyName(dateTimeObject => dateTimeObject.Hour);

// I want the propertyName variable to now contain the string "Hour" 
```

这是扩展方法：

```
public static string GetPropertyName<T>(this IList<T> list, Func<T, object> func) {
   //TODO: would like to dynamically determine which 
   // property is being used in the func function/lambda
} 
```

有没有办法做到这一点？我想也许这种其他方法，使用`Expression<Func<T, object>>`而不是`Func<T, object>`会给我更多的力量来找到我需要的东西，但我不知道如何。

```
public static string GetPropertyName<T>(this IList<T> list, Expression<Func<T, object>> expr) {
   // interrogate expr to get what I want, if possible
} 
```

这是我第一次用 Linq 做这么深的事情，所以也许我遗漏了一些明显的东西。基本上我喜欢传入 lambdas 的想法，这样我就可以进行编译时检查，但我不知道我在这种特殊情况下如何使用它们的想法是否可行。

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-24T00:21:04.620

这是我使用的版本，它返回 a `PropertyInfo`，但获取名称是微不足道的。

```
public static PropertyInfo GetProperty<T>(Expression<Func<T, object>> expression)  
{
    MemberExpression memberExpression = null;

    if (expression.Body.NodeType == ExpressionType.Convert)
    {
        memberExpression = ((UnaryExpression) expression.Body).Operand as MemberExpression;
    }
    else if (expression.Body.NodeType == ExpressionType.MemberAccess)
    {
        memberExpression = expression.Body as MemberExpression;
    }

    if (memberExpression == null)
    {
        throw new ArgumentException("Not a member access", "expression");
    }

    return memberExpression.Member as PropertyInfo;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T17:36:35.857

这是在此博客上执行此操作的一种非常简单快捷的方法：http: [//blog.bittercoder.com/PermaLink,guid,206e64d1-29ae-4362-874b-83f5b103727f.aspx](http://blog.bittercoder.com/PermaLink,guid,206e64d1-29ae-4362-874b-83f5b103727f.aspx)

> 所以给出：
> 
> func func = 名称 => "值";
> 
> 您可以通过调用从函数委托中获取 lambda 参数“名称”：
> 
> func.Method.GetParameters()[0].Name（将返回“名称”）
> 
> 这是 Andrey 修改后的 Hash 方法：

```
public Dictionary<string, T> Hash<T>(params Func<string, T>[] args)
where T : class
{
    var items = new Dictionary<string, T>();
    foreach (var func in args)
    {
        var item = func(null);
        items.Add(func.Method.GetParameters()[0].Name, item);
    }
    return items;
} 
```

希望它有帮助，帕特里克

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-24T00:20:37.697

这样的事情应该可以解决问题：

```
public static string GetPropertyName<T>(this IList<T> list, Expression<Func<T, object>> expr) {
  MemberExpression member_expression = expr.Body as MemberExpression;
  if (member_expression == null)
      throw new ArgumentNullException("member_expression");
  MemberInfo member = member_expression.Member;
  PropertyInfo property = member as PropertyInfo;
  string proname = memeber.name;
} 
```

警告：空气代码！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-25T18:54:03.243

顺便说一句：与编译 lambda 并提取成员表达式、成员信息和名称相比， **func.Method.GetParameters()[0].Name**非常快。

# php - php会话结束时释放数据库锁？

> ID：579965
> 
> 赞同：0
> 
> 时间：2009-02-24T00:15:40.017
> 
> 标签：php, database, session, locking

假设用户正在编辑数据库中的记录，在架构中，您有一个名为“lock”的字段，因此用户不能同时编辑相同的记录，一旦用户结束编辑，您设置 lock = false 以允许其他用户编辑记录.

我的问题是，我可以在 php 会话结束时运行一些代码，所以如果用户离开计算机、关闭浏览器或其他任何东西，我可以将锁定设置为 false 吗？因为如果不是，如果我错了，请纠正我，记录会保持锁定状态吗？

我已经阅读了`session_set_save_handler`php 手册中的部分，但我不确定“关闭”回调是否是我需要的......

或者我是否需要在 db 架构中添加时间戳并运行 cronjob 以每 x 次“解锁”记录？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T00:41:33.120

我认为您最好使用您描述的锁定时间戳。会话关闭回调的问题是您永远无法确定它们是否被调用。例如，如果有人关闭了您的网络服务器，或者更糟糕的是，终止了该进程，会发生什么情况。在这些情况下，您也需要数据库一致性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T03:39:13.817

仅仅因为您在第二段中提到的原因，我不想使用上述方法实现锁定。

我要做的是在表中有一个时间戳列。每当尝试写入该表时，应首先读取它，然后记录其时间戳（例如，在某处的会话变量中）。在将更新的信息写回行之前，我将查看时间戳并确保其时间戳与我看到的完全相同（并在会话变量中注明）。如果不是，则有人在我没有查看时更新了该行（在这种情况下，当您向用户提交表单并且用户尚未将表单提交回服务器时）。

这种方法是许多 O/RM 用来确保一个会话不会无意中覆盖另一个会话中所做的更改的方法。这种方法的好处是您不会遇到放弃会话的用户留下“锁”的机会，并且您不需要有一个 cron 作业来解锁陈旧的锁。这种方法的缺点是您只会在尝试更新数据库中的记录时才知道冲突。这意味着用户已经提交了包含数据更改的表单，并且您必须通知用户他/她必须再试一次（例如，在显示该记录中的更新/最新信息之后）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T01:22:16.567

也许这是您在[register_shutdown_function()](http://us.php.net/manual/en/function.register-shutdown-function.php)中会做的事情。

# comparison - 计算二进制数据相似度

> ID：579981
> 
> 赞同：37
> 
> 时间：2009-02-24T00:21:08.490
> 
> 标签：comparison, binary-data, similarity

我在这里看到了一些与确定文件相似性有关的问题，但它们都与特定域（图像、声音、文本等）相关联。作为解决方案提供的技术需要了解被比较文件的基础文件格式。我正在寻找的是一种没有此要求的方法，可以比较任意二进制文件而无需了解它们包含什么类型的数据。也就是说，我正在寻找确定**两个文件的二进制数据的相似性百分比**。

为了提供更多细节供您使用，尽管这可能适用于许多事情，但我确实有一个正在处理的特定问题。我目前也有一个可行的解决方案，但我认为它并不理想。在比较方法和存储结果方面可能有很多优化。希望这里的一些人能够给我一些新的想法。几天后我可能会编辑一些关于我当前方法的信息，但我不想通过告诉你我已经在做什么来偏见人们对这个问题的看法。

我正在处理的问题是**视频游戏 ROM 映像的克隆检测**。对于那些没有仿真经验的人来说，ROM 是游戏卡带上数据的转储。ROM“克隆”通常是同一游戏的修改版本，最常见的类型是翻译版本。例如，NES原版*《最终幻想》的日文版和英文版都是克隆版。*游戏共享几乎所有的资产（精灵、音乐等），但文本已被翻译。

目前有几个小组致力于维护各种系统的克隆列表，但据我所知，这一切都是手动完成的。我正在尝试做的是找到一种方法来自动和客观地检测相似的 ROM 映像，基于数据相似性而不是“这些看起来像同一个游戏”。检测克隆有几个原因，但主要动机之一是与[Solid 压缩](http://en.wikipedia.org/wiki/Solid_compression)一起使用。这允许将所有游戏克隆一起压缩到同一个存档中，整个压缩克隆集通常只占用比单个 ROM 稍多的空间。

在提出潜在方法时需要考虑的一些问题：

*   ROM 的大小差异很大，具体取决于系统。有些很小，但现代系统可能有较大的系统，256MB 或更多。一些（全部？）系统只有 2 作为可能大小的幂，其中一个系统上的 130MB 游戏将有 256MB ROM，大部分是空的。请注意，因此，如果游戏版本超过阈值并且必须使用两倍大小的卡带，某些克隆的大小可能会有很大差异。
*   目前，许多系统上有数千个已知的 ROM，大多数系统仍在不断发布新的 ROM。即使对于旧系统，也有一个主要的 ROM 黑客社区经常生产修改后的 ROM。
*   为每对可能的 ROM 存储相似性数据将为任何更流行的系统产生数百万行数据。一个有 5000 个 ROM 的系统需要 2500 万行相似性数据，而一个新游戏又增加了 5000 行。
*   处理的状态必须是可恢复的，这样如果它被中断，它可以从中断的地方继续。使用任何方法都需要进行大量处理，并且假设整个事情将在一批中运行是不安全的。
*   可以随时添加新的 ROM，因此该方法不应假定它已经具有“完整”集。也就是说，即使您已经确定了所有现有 ROM 的相似性，如果添加了一个新 ROM（这也可能在之前的处理完全完成之前发生），必须有一种方法将其与所有之前的 ROM 进行比较，以确定哪个（如果有的话）是它的克隆。
*   更高的处理速度应该优先于准确性（到一个点）。知道两个 ROM 是 94% 还是 96% 相似并不是特别重要，但如果需要一天的时间来比较一个新的 ROM 和以前的所有 ROM，那么程序可能永远不会真正完成。

这是一个有趣的问题，我期待看到其他人能想出什么。如果您需要更多详细信息，请在评论中告诉我，我会尽力提供。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-05T21:17:58.350

听起来您想要一个二进制增量，或者可能是一个从二进制增量应用程序派生的索引（就像它的大小一样）。然后，您可以将此索引与您通过实验确定的某个基线进行比较，以确定它是否是“克隆”。

压缩和增量创建之间有很多相似之处，所以我想说您与当前的实现相距不远。

话虽如此，数据库中每个二进制文件的成对比较可能非常昂贵（我认为 O(n ² )）。我会尝试找到一个简单的哈希来识别可能的候选者进行比较。在概念上类似于 spdenne 和 Eduard 的建议。也就是说，找到一个可以应用于每个项目一次的散列，对该列表进行排序，然后对列表中散列靠近的项目使用更细粒度的比较。

多年来，构建对一般情况有用的哈希一直是 CS 中积极追求的研究课题。LSHKit软件库实现了一些此类算法[。](http://lshkit.sourceforge.net/)互联网可访问的论文[FINDING SIMILAR FILES IN A LARGE FILE SYSTEM](http://www.usenix.org/publications/library/proceedings/sf94/full_papers/manber.finding)似乎更多地针对比较文本文件，但可能对您有用。最近的论文[多分辨率相似性哈希](http://www.sciencedirect.com/science?_ob=ArticleURL&_udi=B7CW4-4P06CJD-7&_user=1617289&_rdoc=1&_fmt=&_orig=search&_sort=d&view=c&_acct=C000053976&_version=1&_urlVersion=0&_userid=1617289&md5=335d7e5e9bf27f9f42bf6a3cf493e44f)描述了一种更强大的算法。不过，如果没有订阅，它似乎无法访问。您可能希望保留有关[Locality Sensitive Hashing的维基百科文章](http://en.wikipedia.org/wiki/Locality_sensitive_hashing)方便您浏览其他资源。他们都获得了相当的技术性，维基百科条目本身的数学很重。作为一种更加用户友好的替代方案，您可以应用[声学指纹](http://en.wikipedia.org/wiki/Acoustic_fingerprint)领域的一些想法（甚至可执行文件） 。

如果您愿意放弃一般情况，您可能会找到一个更简单（更快）的特定于域的哈希函数，它只适用于您的 ROM。可能涉及标准或通用字节序列的放置以及它们附近的选择位的值。我对你的二进制格式不太了解，但我在想象文件中部分开始的信号，比如声音、图像或文本的区域。二进制格式经常将这类部分的地址存储在文件开头附近。有些还使用链接机制，将第一部分的地址及其大小存储在已知位置。这使您可以移动到下一个部分，该部分还包含大小等。稍作调查可能会让您发现任何相关的格式，

如果散列函数不能完全满足您的要求（或者它们需要某种类型的输入来定义度量/距离），那么网络上有几种二进制增量算法和实现。我最熟悉的是subversion版本控制系统。它使用称为 xdelta 的二进制增量算法来有效地存储二进制文件修订。这是直接指向其存储库中实现它的文件的链接：[xdelta.c](http://svn.collab.net/repos/svn/trunk/subversion/libsvn_delta/xdelta.c)。网络上可能有一个工具也可以使这更容易访问。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-24T00:30:42.850

您可能想查看[bsdiff](http://www.daemonology.net/bsdiff/)，它是一个二进制差异/修补系统。还有一篇论文有很多理论。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-04T12:02:07.273

使用[抄袭检测](http://en.wikipedia.org/wiki/Plagiarism_detection)算法中的一些想法。

我的点子：

为了为每个 ROM 创建一个可比较的“签名”，随着小部分的变化而略有不同，产生类似于词频图的东西，但不是记录词的频率，您可以散列 ROM 的非常短的部分，并记录哈希值的频率。

不要只散列一个部分，然后从第一部分的末尾开始下一部分，而是使用滑动窗口，从字节 1 开始散列部分，然后从字节 2 开始散列相同大小的部分，然后从字节3等。这将抵消ROM中可变大小的变化部分的影响。

如果您使用简单的哈希函数，例如每个 8 位字节的 xor，那么您可以通过 xor 与传出的 8 位和 xor 传入的 8 位轻松计算下一个窗口位置的哈希。另一种替代散列函数可能只是使用指令码字长。这可能足以为表示机器指令的代码创建静态模式。重要的是，您需要一个哈希函数，它会在指令代码中产生常见的短序列，从而产生相同的哈希值。

您可能需要较少的散列值和较高的频率，但不要走得太远，否则您的图表将太平，导致难以比较它们。同样不要太宽，否则你会有很多非常小的频率，再次难以比较。

每个 ROM 存储此图。通过计算每个哈希值的频率差的平方和来比较两个不同 ROM 的频率图。如果总和为零，则 ROM 很可能是相同的。离零越远，ROM 就越不相似。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-03T15:35:01.403

虽然这不仅仅是“几天”，但我想我应该在这里添加我当前的解决方案。

Nils Pipenbrinck 的方向与我目前的方法相同。由于找到克隆的主要结果之一是从固态存档中节省了大量资金，我想我可以尝试将任意两个 ROM 压缩在一起，看看节省了多少空间。为此，我正在使用[7zip](http://www.7-zip.org)中的 LZMA 算法。

第一步是单独压缩每个 ROM 并记下压缩后的大小，然后尝试将任意两个 ROM 归档在一起，看看生成的大小与它们各自的压缩大小有多大不同。如果组合大小与单个大小的总和相同，则它们的相似度为 0%，如果大小与其中之一（最大的）相同，则它们是相同的。

现在，这需要大量的压缩尝试，所以到目前为止我有一些优化（并且想了解更多）：

1.  根据压缩大小的相似程度对比较进行优先级排序。如果 ROM A 的压缩大小为 10MB，而 ROM B 的压缩大小为 2MB，它们的相似度不可能超过 20%，因此比较它们以获得真正的结果可以留到以后。对高度相似的文件运行相同的压缩算法往往会产生相似大小的结果，因此可以很快找到很多克隆。

2.  结合上述内容，保持任何一对 ROM 之间可能的相似性的上限和下限。这允许进一步确定优先级。如果 ROM A 和 B 的相似度为 95%，而 ROM B 和 C 的相似度仅为 2%，那么您已经知道 A 和 C 在 0% 到 7% 之间。这对于克隆来说太低了，因此可以安全地推迟甚至完全忽略这种比较，除非我真的想知道所有事物的确切相似之处。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-24T02:54:00.137

我认为从数据压缩中借来的一些技术在这里可能很有趣：

假设您有两个文件，A 和 B。

单独压缩每个文件并将压缩后的大小加在一起。然后将这两个文件连接成一个大文件并压缩它。

大小的差异将使您粗略估计文件的相似程度。

我建议您尝试使用 Burrow Wheeler Transformation (bzip2) 进行压缩。大多数其他压缩算法只有有限的历史。BWT 算法otoh 可以处理非常大的数据块。该算法同时“看到”两个文件，任何相似性都会导致更高的压缩率。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-10T12:02:08.220

XDelta 对于获得体面的二进制差异非常有用：http: [//xdelta.org](http://xdelta.org)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-24T02:45:12.387

[您可以从存储哈希树](http://en.wikipedia.org/wiki/Hash_tree)之类的东西开始。只需要为每个 ROM 存储一组这样的哈希，并且所需的存储空间仅与 ROM 的大小成比例（但远低于），假设块大小恒定。选择的块大小必须提供足够的粒度以确保准确性，例如：对于 128MiB 的最小大小，1% 的准确性约束和[Tiger-128 哈希](http://en.wikipedia.org/wiki/Tiger_(hash))（类似于他们用来检查通过 DirectConnect 传输的文件），块大小为 1MiB没问题，您可以将所有哈希值存储在 128 * 128 / 8 = 2048 字节中！因此，为 10,000 个 ROM 执行此操作只需要大约 20MiB 的空间。此外，您可以选择不太安全但更快和/或更小的散列。添加/检查新 ROM 的相似性将需要以下内容：

1.  将新的 ROM 分成块并散列每个块。
2.  对于数据库中已经存在的每个 ROM，将其哈希值与新 ROM 的哈希值进行比较（见下文）。

比较函数应该检查相似性。但它应该将每个散列视为一个不可分割的值，即不要费心试图找到两个散列之间的逻辑显着差异函数。只要块大小足够小并且哈希冲突足够少，通过简单的等值比较就可以保证准确性。

如您所见，问题在性能方面被简化为一个更简单的问题：检查小得多的数据集的相似性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-24T03:09:54.870

两个想法：

*   考虑将文件组织为数据流图并对该表示进行一些规范化。既然你知道指令集，这可能是可行的，也许只是捆绑一个反汇编程序并进行一些文本处理。
*   诸如[CRM114 之](http://crm114.sourceforge.net/)类的可训练分类器可能会派上用场，为您提供紧凑的表示，让您了解二进制文件是否有很多共同点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-08T13:01:57.050

正如 Waylon Flinn 所说，您可能需要二进制增量算法。[rsync 算法](http://www.samba.org/rsync/tech_report/)是一个很好的算法。它快速可靠。另请参阅[实用程序的文档](http://samba.anu.edu.au/rsync/)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-08T19:47:22.783

这里的困难在于，由于您正在处理可执行代码，因此简单的更改可以传播到整个 ROM。ALL 值的地址和偏移量可以随着添加单个变量或无操作指令而改变。这将使基于块的散列变得毫无价值。

一个快速而肮脏的解决方案是使用[difflib](http://docs.python.org/library/difflib.html)（或具有您喜欢的语言的等效语言）破解一个解决方案，因为它可以为您提供可以处理数据添加或删除的滑动比较。将 ROM 拆分为可执行和数据部分（如果可能）。可以直接比较数据部分并[计算相似率](http://docs.python.org/library/difflib.html#id1)，尽管您仍然会遇到地址或偏移量的问题。

可执行部分更有趣。阅读机器的 asm 格式，获取可执行文件并将其拆分为一系列操作码。保留操作码和寄存器部分，但屏蔽“有效负载”/“立即”部分（它加载变量地址的位置）。将得到的信息也交给相似率计算器。

不幸的是，这仍然是对您跟踪的 ROM 数量的 O(n^2) 操作，但这可以通过（增量）聚类或基于频率的比较顺序来减轻，以减少所需的比较量。

# forms - Winforms中不可编辑的下拉框（组合框）应该如何格式化？

> ID：579992
> 
> 赞同：0
> 
> 时间：2009-02-24T00:26:15.450
> 
> 标签：forms

我正在使用 Visual Studio 2005，下拉框有 3 种下拉样式“简单”、“下拉”和“下拉列表”。我的下拉框不允许用户输入包含固定数量的可选项目的值。我一直将样式设置为“下拉列表”，因为这不允许编辑，但我注意到即使该框允许数据输入，Microsoft 也使用“下拉”而不是下拉列表。我应该将盒子设置为什么？我想让程序符合设计标准。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T00:27:51.813

当用户不应该对项目有任何编辑能力时，使用下拉列表。

# java - 我怎样才能让 JPanel 在窗口滚动后自行更新？

> ID：579993
> 
> 赞同：2
> 
> 时间：2009-02-24T00:26:34.343
> 
> 标签：java, user-interface, swing

我是 Java 新手，所以这可能很简单，但我不知道如何让它工作。

基本上，我有一个用于绘制网格的类，它扩展了 JPanel。我把这个类放在一个窗口中，在一个 JScrollPane 里面。滚动按我想要的方式工作，除了我的类中的绘图在窗口滚动后不会自行更新。如果调整窗口大小，它会更新。

我想我应该使用事件/侦听器或类似的东西，但我不确定从哪里开始寻找。

编辑：另外，当我打开其中一个菜单并在绘图上重叠时，菜单覆盖的区域不会更新。

好的，让我们再试一次：我有一个名为 draw 的类。然后我有一个 GridBagLayout 出局。这创建了我需要的网格。我有一个在网格周围移动的对象，所以这样我可以更新网格，而不必自己计算必须更新的矩形。

然后这个网格在一个 JScrollPane 内，它没有被子类化。我在创建窗口时使用 pack()，但问题是，窗口可能比分辨率允许的大，所以我需要它是可滚动的。滚动对我有用，但是当我使用它时它不会更新图像。但是，调整窗口大小确实会更新它。

我想要的是一种在单击 JScrollPane 时重绘所有窗口的方法。现在，一旦我访问菜单，我还需要重新绘制整个东西（或某些部分，我稍后会看到），因为菜单下网格的绘制部分没有更新。

这是我能描述它的最好方式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T00:47:13.670

~~只需为滚动~~视口更改事件添加一个侦听器并发出 repaint()。我想我会反对史蒂夫莫耶的回答，因为绘画只能作为绘画活动的一部分。

如果滚动组件足够大，您应该只重新绘制在视口组件（您的 JScrollPane）中可见的 JPanel 部分。

* * *

**编辑**

要跟踪视口的移动，请使用 JScrollPane getViewport() 和 JViewport addChangeListener()。然后在绘制方法中确定要绘制的区域时，使用JViewport的方法来识别视图的哪一部分是可见的。请注意，这应该是仅在绘画正常工作后通过在每个绘画事件中重新绘画整个视图来应用的优化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T23:09:08.483

听起来你想做这样的事情：

```
 final JScrollPane pane = new JScrollPane();
    pane.addMouseListener(new MouseAdapter() {
        @Override
        public void mouseClicked(MouseEvent e) {
            pane.revalidate();
        }
    }); 
```

这可能有点矫枉过正，但每次单击滚动窗格时，它都会尝试重新绘制层次结构中的所有组件，这与调整屏幕大小时应该相似。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T09:47:21.720

您是否有机会在paint() 或paintComponent() 方法之外进行“绘制”的绘制？如果是这样，您需要将您的绘画代码移动到paintComponent() 中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-24T23:12:37.413

确保将包含所有内容的面板设置为滚动窗格的视口视图 (JScrollPane.setViewportView)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T00:37:51.647

可能您需要指定最小尺寸。

您不发布代码或屏幕截图，因此很难对其进行审查。

尝试阅读此线程中的评论，它看起来很相似

[JScrollPane 现在显示其视口](https://stackoverflow.com/questions/448832/jscrollpane-now-showing-its-viewport)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-24T00:40:14.483

自从我在 Swing 中做任何图形以来已经有一段时间了，但我认为您正在寻找的代码类似于：

```
Graphics g = getGraphics();
if (g != null) paintComponent(g);
else repaint(); 
```

正如您所指出的，您需要将此代码添加到附加到 JPanel 的滚动函数的侦听器中。

我可能会创建一个包含整个绘图的 Canvas 并将其放在 JScrollPane 中。这将让 Java 完成所有工作！

# performance - 如何并行化小的纯函数？

> ID：579997
> 
> 赞同：5
> 
> 时间：2009-02-24T00:28:08.957
> 
> 标签：performance, multithreading, optimization, parallel-processing, d

我有 D2 程序，在其当前形式下，它是单线程的，并且对于该程序的外循环的每次迭代，在内循环中调用相同的纯函数大约 10 到 100 次。调用之间没有数据依赖关系，即没有调用使用来自任何其他调用的结果。总的来说，这个函数被调用了数百万次，是我程序的主要瓶颈。参数几乎每次都是唯一的，因此缓存无济于事。

乍一看，这似乎是并行化的完美候选者。唯一的问题是该函数每次调用只需要大约 3 微秒，远低于创建新线程的延迟，并且不高于将作业添加到任务池的开销（意思是，获取互斥体，分配内存到保存有关任务的信息，处理可能的任务池队列争用等）。有没有什么好的方法可以利用这种细粒度的并行性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T00:41:17.117

不要启动每个线程来运行单个任务然后立即将其关闭。

在您的程序开始时，为每个核心创建一个线程，等待来自队列（管道或您自己创建的某种机制）的数据。如果你能想出一种机制，让所有线程在同一个队列上等待，那就更好了，但是队列的 get 方法必须同步......

每当您要计算一个包含数百或数千个进程的块时，将整个块放入下一个空队列中。

实际上，您最终会得到一个或多个线程为队列提供数据，一堆线程处理来自队列的数据，以及一个或多个读取和处理结果的线程。

您可能需要在您正在处理的“项目”中放入足够的数据，以便能够告诉您在完成后如何处理它们。它们几乎肯定应该是一个对象，并且您可能希望它们包含状态信息。

您可能不希望有比核心更多的线程进行处理。

**编辑：还要查看一些并发库，例如[ThreadPoolExecutor](http://java.sun.com/j2se/1.5.0/docs/api/)。很容易忘记并发库（就像我刚才所做的那样），这可能正是您正在寻找的（因此强调）**

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-24T00:33:12.860

如何创建多个线程，它们有自己的队列可以工作？因为队列没有重叠，所以您不必创建锁。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-24T07:05:23.607

多么有趣的问题......正如您所指出的，您将无法承担与传统锁定相关的工作队列的开销。如果可以的话，我鼓励您尝试使用现有的基于细粒度任务的编程环境之一......我在三个工作桶中考虑了这一点：

问题的第一部分是确保安全性、正确性和可并行性，听起来你已经涵盖了这些，因为你的函数是纯粹的。

我认为下一个最具挑战性的部分是描述并发性，特别是你提到这个函数被多次调用。您可以将其流水线化并将调度功能与其工作分开吗？如果你不能把它流水线化，它看起来像一个并行循环、一个树遍历还是比这更非结构化。具体来说，如果你不能重叠工作并确保它有多个实例或其他东西同时运行，那么[服从 Amdahl](http://en.wikipedia.org/wiki/Amdahl's_law)，即使你是纯粹的，你实际上也是连续的。无论使用哪种库，您可以将工作重构为管道、递归树遍历（或并行循环），或者如果您必须进行更多非结构化工作以及任务之间的显式依赖关系，那么您可以做的任何事情都会有所帮助。

我考虑的最后一个领域是确保在您的平台上高效执行，这涉及减少代码和调度代码中的开销和争用，并确保任何串行代码绝对尽可能高效。如果您不能使用现有库之一并且必须构建自己的库，我鼓励您查看[工作窃取队列](http://www.bluebytesoftware.com/blog/SearchView.aspx?q=workstealing)和自我引导的调度算法，正如您所指出的，您将无法从使用传统锁中看到收益，因为它们的成本超过了您的功能成本，您很可能需要查看无锁技术以降低成本调度和删除任务到您使用的任何队列。您还需要非常注意调度算法和函数内部的共享和争用，因为在这种粒度级别上，除了通常的分支预测错误和指令吞吐量问题之外，您还需要查看即使在读取时也处于[共享状态和争用状态，因为它们也可能是争用的来源](http://www.ddj.com/hpc-high-performance-computing/214100002)。

如果这不是非常具体，我很抱歉，但我希望它有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-24T02:01:41.977

如上所述，不要每次进入该函数时都启动一个线程，并且“作业”粒度大于内部函数的一次操作，以便很好地摊销创建作业的开销。将您的原始例程描述为：

```
void OuterFunction( Thingy inputData[N] )
{
  for ( int i = 0 ; i < N ; ++i )
    InnerFunction( inputData[i] );
} 
```

我们将通过（假设存在作业队列系统）解决您的问题：

```
void JobFunc( Thingy inputData[], int start, int stop )
{
  for ( int i = start ; i < stop ; ++i )
    InnerFunction( inputData[i] );  
}
void OuterFunction( Thingy inputData[N], int numCores )
{
   int perCore = N / numCores; // assuming N%numCores=0 
                               // (omitting edge case for clarity)
   for ( int c = 0 ; c < numCores ; ++c )
     QueueJob( JobFunc, inputData, c * perCore, (c + 1) * perCore );
} 
```

只要您的输入数据是完全独立的，正如您在原始问题中所说，您无需锁定它；仅当线程之间存在依赖关系时才需要同步，而这里没有。

此外，在这个性能级别上，微优化开始变得相关：**最重要的是缓存局部性**。预取可以让你走得更远。

然后考虑 SIMD 的可能性，您可以将其矢量化以同时通过单个寄存器运行四个输入点。使用四个内核和 4 宽 SIMD，*理论上*您可以获得 16 倍的加速，但这假设 InnerFunction 所做的工作主要是一个固定的数学函数，因为分支往往会抹杀 SSE/VMX 的性能提升。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-24T00:36:21.340

根据程序的结构，您总是可以将一组调用组合成一个任务。如果每个任务执行 50 个函数调用，那么任务管理的开销就不再是一个大因素。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-24T01:35:11.947

这听起来像是 SIMD 指令可以提供帮助的东西。如果您有一个自动矢量化编译器，您应该能够重写该函数以同时对 4 个值进行操作，并且编译器可以将其压缩为适当的 SSE 指令。这可以帮助减少函数调用开销。如果您的编译器不擅长自动矢量化代码，那么您可以使用 SSE 内在函数来几乎降低到汇编级别来对函数体进行编程。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-25T20:33:21.037

> 调用之间没有数据依赖关系，即没有调用使用来自任何其他调用的结果。

这将有助于并行化，但绝对可以肯定该函数根本没有副作用。如果函数正在更新数据结构，它是线程安全的吗？如果它正在执行 IO，如果您设法并行执行该函数，那么 IO 最终会成为瓶颈吗？

如果这些问题的答案是“是”，那么前面的建议很好，只需尝试通过将函数的执行分配给每个线程尽可能多的次数来最大化应用程序的粒度。

尽管如此，你可能不会从大规模并行中获得任何好处，但也许可以得到一些更适度的加速......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-24T17:50:29.233

您也许可以使用 Compare-and-Swap 将循环翻过来，以获得原子无锁增量：

```
void OuterFunction()
{
  for(int i = 0; i < N; i++)
    InnerFunction(i);
} 
```

去：

```
void OuterFunction()
{
   int i = 0, j = 0;

   void Go()
   {
      int k;
      while((k = atomicInc(*i)) < N)
      {
         InnerFunction(k);

         atomicInc(*j);
      }
   }

   for(int t = 0; t < ThreadCount - 1; t++) Thread.Start(&Go);

   Go(); // join in

   while(j < N) Wait(); // let everyone else catch up.
} 
```

* * *

*编辑：我的线程生锈了，因此无法编译，因为名称都错误***********