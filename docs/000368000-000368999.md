# StackOverflow 问答 000368000-000368999

# c# - 是否可以从 .NET 测试 COM 公开的程序集？

> ID：368001
> 
> 赞同：11
> 
> 时间：2008-12-15T10:50:25.397
> 
> 标签：c#, visual-studio, com, interop, com-interop

我有一个通过 tlb 文件向 COM 公开的 .NET 程序集，以及一个注册 tlb 的安装程序。我已手动检查安装程序是否正常工作以及 COM 客户端是否可以访问该库。到现在为止还挺好...

但是，我正在尝试将一些自动化系统测试放在一起，以检查安装程序是否正常工作。作为其中的一部分，我已经在 VM 上自动安装，现在我想对已安装的 COM 库进行一些调用，以验证它是否正常工作。我最初考虑用 VB6 编写一些测试，但我已经有一大套用 C# 编写的测试，它们引用了 .NET 程序集。我希望我可以更改这些以引用 .tlb，但是当我在 VS2008 中尝试此操作时出现错误：

ActiveX 类型库“blah.tlb”是从 .NET 程序集中导出的，不能作为参考添加。

有什么办法可以欺骗 VS2008 让我添加这个引用，也许是通过编辑 tlb 文件？

谷歌搜索没有提出任何解决方案。我发现的只是一篇 Microsoft Connect 文章，说明这是“按设计”：[http ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=120882](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=120882)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-04-18T18:52:30.083

我最接近的解决方案如下所示：

```
using System;
class ComClass
{
    public bool CallFunction(arg1, arg2)
    {
        Type ComType;
        object ComObject;

        ComType = Type.GetTypeFromProgID("Registered.ComClass");
        // Create an instance of your COM Registered Object.
        ComObject = Activator.CreateInstance(ComType);

        object[] args = new object[2];
        args[0] = arg1;
        args[1] = arg2;

        // Call the Method and cast return to whatever it should be.
        return (bool)ComType.InvokeMember("MethodToCall", BindingFlags.InvokeMethod, null, ComObject, args))
    }
} 
```

这不是很漂亮，但我认为明白了这一点。您当然可以将 ComObject 实例化放入构造函数中并将其余的调用包装到对象中，但对于测试代码可能不是必需的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T11:00:39.497

您应该能够使用 TLBImp 为已安装的 COM 组件创建一个包装器类，然后针对它运行测试。您基本上将编写一个 .Net 程序集，将其安装到 COM，然后针对包装类进行测试，这样您的测试将被路由，就好像它被 COM 组件调用一样

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-15T10:59:12.323

使用[tlbimp.exe](http://msdn.microsoft.com/en-us/library/tt0cf3sx(VS.80).aspx)，您可以从 COM 组件生成可用于 .NET 代码的程序集

# linux - Linux 上的网络使用率 top/htop

> ID：368002
> 
> 赞同：271
> 
> 时间：2008-12-15T10:50:33.527
> 
> 标签：linux, networking, top-command, htop

Linux 上是否有一个 htop/top，我可以在其中按网络使用情况对进程进行排序？

* * *

## 回答 #1

> 赞同：338
> 
> 时间：2009-03-05T22:31:40.183

[NetHogs](https://github.com/raboof/nethogs)可能是您正在寻找的：

> 一个小的“网顶”工具。它不像大多数工具那样按协议或子网分解流量，**而是按进程对带宽进行分组**。
> 
> NetHogs 不依赖一个特殊的内核模块来加载。如果突然出现大量网络流量，您可以启动 NetHogs 并立即查看是哪个 PID 导致了这种情况。这可以很容易地识别已经疯狂并突然占用您的带宽的程序。
> 
> 由于 NetHogs 严重依赖 /proc，因此大多数功能仅在 Linux 上可用。NetHogs 可以在 Mac OS X 和 FreeBSD 上构建，但它只会显示连接，而不是进程...

* * *

## 回答 #2

> 赞同：170
> 
> 时间：2008-12-15T11:28:26.663

还有[iftop](http://ex-parrot.com/~pdw/iftop/)：

> ### 在接口上显示带宽使用情况
> 
> iftop 对网络使用的作用与 top(1) 对 CPU 使用的作用相同。它侦听命名接口上的网络流量，并按主机对显示当前带宽使用情况表。方便回答“为什么我们的 ADSL 链接这么慢？”的问题......

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2012-06-22T04:41:09.600

[iptraf](http://iptraf.seul.org/)是我的最爱。它有一个很好的 ncurses 界面和过滤选项等。

![在此处输入图像描述](https://i.stack.imgur.com/BKydV.png)

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2008-12-15T11:12:58.190

[jnettop](https://sourceforge.net/projects/jnettop/)是另一个候选人。

编辑：它只显示流，而不是所有者进程。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-12-15T11:03:49.100

[ntop](http://www.ntop.org/)或[nagios](http://www.nagios.org)          

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-01-10T14:54:36.960

您可以尝试的另一个选择是[iptstate](http://linuxcommand.org/man_pages/iptstate8.html)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-11-19T08:39:35.367

检查[bmon](https://github.com/tgraf/bmon)。它是 cli，简​​单并且有图表。

不完全是问的问题 - 它不按进程划分，仅按网络接口划分。

# python - 如何按时间顺序重新排序 mbox 文件？

> ID：368003
> 
> 赞同：5
> 
> 时间：2008-12-15T10:51:38.563
> 
> 标签：python, email, sorting, mbox

我有一个使用evolution 创建的spool mbox 文件，其中包含一系列我希望打印的电子邮件。我的问题是电子邮件没有按时间顺序放入 mbox 文件中。我想知道使用 bash、perl 或 python 从头到尾排列文件的最佳方式。对于发给我的文件，我想按收到的方式订购，对于我发送的文件，我想按已发送的方式订购。使用maildir文件等可能更容易吗？

电子邮件目前以以下格式存在：

```
From x@blah.com Fri Aug 12 09:34:09 2005
Message-ID: <42FBEE81.9090701@blah.com>
Date: Fri, 12 Aug 2005 09:34:09 +0900
From: me <x@blah.com>
User-Agent: Mozilla Thunderbird 1.0.6 (Windows/20050716)
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: someone <someone@hotmail.com>
Subject: Re: (no subject)
References: <BAY101-F9353854000A4758A7E2CCA9BD0@phx.gbl>
In-Reply-To: <BAY101-F9353854000A4758A7E2CCA9BD0@phx.gbl>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Status: RO
X-Status: 
X-Keywords:                 
X-UID: 371
X-Evolution-Source: imap://x+blah.com@blah.com/
X-Evolution: 00000002-0010

Hey

the actual content of the email

someone wrote:

> lines of quotedtext 
```

我想知道是否有一种方法可以使用这些信息来轻松地重组文件，也许是使用 perl 或类似的。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-15T11:27:26.260

这就是你可以在python中做到的方式：

```
#!/usr/bin/python2.5
from email.utils import parsedate
import mailbox

def extract_date(email):
    date = email.get('Date')
    return parsedate(date)

the_mailbox = mailbox.mbox('/path/to/mbox')
sorted_mails = sorted(the_mailbox, key=extract_date)
the_mailbox.update(enumerate(sorted_mails))
the_mailbox.flush() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-01T11:35:32.217

如果使用 Thunderbird 的 ImportExportTools 插件将邮件消息导入 mbox，则 Python 解决方案将不起作用。有一个错误：消息应在格式中以'from'行为前缀：

```
From - Tue Apr 27 19:42:22 2010 
```

但是 ImportExportTools 前缀带有这样的“来自”行：

```
From - Sat May 01 2010 15:07:31 GMT+0400 (Russian Daylight Time) 
```

所以有两个错误：

1.  序列“时间年”分解为“年时间”
2.  带有 GMT 信息和时区名称的额外垃圾

由于 Python 的 mailbox.py/UnixMailbox 为“发件人”行匹配硬编码正则表达式，因此某些消息无法解析。

我给作者写了错误信息，但是有很多错误导入的信息:(。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-12-15T10:57:36.443

重写 mbox 有什么意义，而您可以在加载邮箱时重新排序内存中的邮件？您想在哪个时间订购？收到日期？发送日期？无论如何，所有用于玩 mbox 的 Ruby/Python/Perl 模块都可以做到这一点。

# c# - C# 我可以将值添加到具有后台工作线程的列表框吗？

> ID：368006
> 
> 赞同：6
> 
> 时间：2008-12-15T10:53:35.640
> 
> 标签：c#, backgroundworker

我希望我的后台工作人员将项目添加到列表框中，它似乎在调试时这样做，但列表框不显示值。我怀疑这与在后台工作线程中添加项目有关，我是否需要将这些添加到数组中，然后在期间从数组中填充列表框`backgroundWorker1_RunWorkerCompleted`？

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-15T11:00:26.923

您可以像这样使用调用：

```
private void AddToListBox(object oo)
{
    Invoke(new MethodInvoker(
                   delegate { listBox.Items.Add(oo); }
                   ));
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T10:58:16.020

您可以，但您必须建议您的 Backgroundworker 报告状态，并将具有当前状态的框的输入发送到该事件。在该事件的方法中，您可以访问该框并将新值放入其中。

否则需要手动调用。

```
 public Form1()
        {
            InitializeComponent();

            BackgroundWorker bw = new BackgroundWorker();
            bw.WorkerReportsProgress = true;
            bw.ProgressChanged += new ProgressChangedEventHandler(bw_ProgressChanged);
            bw.DoWork += new DoWorkEventHandler(bw_DoWork);
            bw.RunWorkerAsync();
        }

        void bw_DoWork(object sender, DoWorkEventArgs e)
        {
            for (int i = 0; i < 10; i++)
            {
                ((BackgroundWorker)sender).ReportProgress(0, i.ToString());
            }
        }

        void bw_ProgressChanged(object sender, ProgressChangedEventArgs e)
        {
            listBox1.Items.Add((string)e.UserState);
        } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T19:14:26.437

我添加了如下函数，以便可以从主线程或后台线程将项目添加到列表框中。该线程检查是否需要调用，然后在需要时使用调用。

```
 delegate void AddListItemDelegate(string name,object otherInfoNeeded);

  private void
     AddListItem(
        string name,
        object otherInfoNeeded
     )
  {
     if (InvokeRequired)
     {
        BeginInvoke(new AddListItemDelegate(AddListItem), name, otherInfoNeeded
        return;
     }

     ... add code to create list box item and insert in list here ...
  } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T10:57:02.903

您可以通过以下方式在后台线程上添加它们：

```
Form.Invoke 
```

或者

```
Form.BeginInvoke 
```

这是将调用从后台线程编组到主 UI 线程所必需的。但是，我很确定 BackgroundWorker 提供了一个在前台线程上自动调用的事件，您应该能够毫无问题地更新此事件。这是“ProgressChanged”，可以通过调用 ReportProgress 由后台工作进程触发。

您是否也尝试过调用`.Refresh()`列表框？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-11-16T23:09:17.513

如果您尝试更新数据库。我建议从列表框中创建一个数据集。

例如，如果您为数据库中的每个项目做某事。通过创建新数据集并由 mainDataset 声明来复制数据库数据集。

例如：//gridview 数据集是 dataset1

```
BackgroundWorker_DoWork(object sender, DoWorkArgs e)
{
     Dataset dataset2 = dataset1;
     foreach(DataGridViewRow row in GridView)
     {
         //do some work
         dataset2.Main.AddMainRow(values to add);
         dataset2.AcceptChanges();
     }
}

BackgroundWorker_WorkCompleted(object sender, DoWorkArgs e)
{
    //Forces UI thread to valitdate dataset
    dataset2.update();

    // Sets file Path
    string FilePath = "Some Path to file";

    dataset2.writexml(FilePath, XmlWriteOptions.WriteSchema);

    //if you use xml to fill your dataset filepath to write should equal path to dataset1 xml
    dataset1.Refresh();
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-30T09:27:29.467

`Application.Doevents()`功能将解决问题。

# wpf - WPF - 如何在 WebBrowser 控件中插入我的代理凭据

> ID：368010
> 
> 赞同：1
> 
> 时间：2008-12-15T10:57:03.340
> 
> 标签：wpf, proxy, networking, browser, credentials

我`webbrowser` `control`在 WPF 中使用 a 来显示虚拟地球地图，但是因为我在`proxy`我的公司后面开发，所以每次我尝试查看地图时，我都必须插入我的凭据。

我想在 c# 代码中自动插入它们，我该如何实现呢？

我已经尝试在网络浏览器的导航事件中使用：

```
void webBrowser_Navigating(object sender, NavigatingCancelEventArgs e)
{
    //NetworkCredential credential = new NetworkCredential("u007239", "****", "****");
    //e.WebRequest.Proxy.Credentials = credential;

} 
```

但这不起作用，因为我得到的`e.webrequest`是一个`null object`.

欢迎所有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T03:09:09.807

你不能把以下内容放在你的 app.config 中吗？

```
<configuration>
  <system.net>
    <defaultProxy useDefaultCredentials="true" enabled="true"></defaultProxy>
  </system.net>
</configuration> 
```

# c - C 标识符限制

> ID：368011
> 
> 赞同：0
> 
> 时间：2008-12-15T10:57:24.713
> 
> 标签：c, dynamic-linking

如何从 C 中调用名称损坏的符号？

```
module.name:version

void* function(TypeSig); // Type of the function 
```

我希望能够使用用我的 C 语言编写的代码路径。函数调用约定大致相同。只是我必须在导出的符号中修改版本和模块路径，并且我具有与 C 相同的标识符约定，因此我不能只使用下划线。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T13:38:18.977

IIUC，您正在定义自己的语言，并且正在寻找合适的名称修饰算法。

您可能想使用 Intel et.al。[Itanium name mangling algorithm](http://www.codesourcery.com/public/cxx-abi/abi.html#mangling)，g++ 在所有平台上都使用它。对于特定情况，您可能会破坏每个名称，就好像 C++ 声明是

```
namespace module{ namespace name { namespace Vversion /*e.g. V1_0 */ {
  void *function(int){}
}}} 
```

这会破坏为

```
_ZN6module4name4V1_08functionEi 
```

由于您的所有符号都使用该算法，因此它们不能相互冲突。它们也不能与名为 的标准 C 函数冲突`_ZN6module4name4V1_08functionEi`，因为所有以 _Z（或 _UPPERCASE）开头的名称都保留用于（C）实现。如果你想方便地从 g++ 调用，你可以使用这个确切的约定；否则你选择一个不同于 Z 的字母。

# iphone - 从 iPhone 上的睡眠事件中醒来？

> ID：368014
> 
> 赞同：7
> 
> 时间：2008-12-15T10:57:59.203
> 
> 标签：iphone, cocoa-touch

有什么方法可以在您的应用程序运行时检测 iPhone 是否从睡眠中唤醒？例如：您的应用程序正在运行，用户锁定屏幕（或屏幕自动锁定），一段时间后用户解锁屏幕并弹出您的应用程序。有没有办法在那个时候得到一个事件或以某种方式检测它？

我试过搜索谷歌和这个论坛，但我似乎找不到任何关于它的东西。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-15T11:27:25.447

请参阅`applicationDidBecomeActive:`UIApplicationDelegate。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-09-29T05:46:51.043

将这些粘贴到您的 AppDelegate.m 文件中：

```
-(void) applicationWillResignActive:(UIApplication *)application {

     NSLog(@"Asleep");
}

-(void) applicationDidBecomeActive:(UIApplication *)application {

     NSLog(@"Awake");
} 
```

@Kevin - 你的回答没有错 - 顺便谢谢。只是以为我会为下一个人保存 Google 搜索。

# linux - 如何用脚本进行多行搜索和替换？

> ID：368018
> 
> 赞同：1
> 
> 时间：2008-12-15T10:58:32.573
> 
> 标签：linux, sed, multiline, non-greedy

我正在尝试替换 Python 源文件中的每个多行导入。所以，源代码就像

```
from XXX import (
   AAA,
   BBB,
)
from YYY import (
   CCC,
   DDD,
   EEE,
   ...
)
...other instructions... 
```

我想得到类似的东西

```
from XXX import AAA, BBB
from YYY import CCC, DDD, EEE, ...
...other instructions... 
```

我尝试使用 sed，但它看起来不支持右括号的非贪婪匹配，所以它“吃掉”第二个导入.. :(
任何提示？这对 sed 来说是不可能的吗？我应该尝试使用其他工具吗?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-12-22T16:40:26.160

这可能对您有用：

```
sed '/^from/,/^)/{H;//{x;/)/{s/[\n()]//g;s/  */ /g;s/,$//;p;x}};d}' source
from XXX import AAA, BBB
from YYY import CCC, DDD, EEE, ...
...other instructions... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T11:04:52.513

嗯...... Python有什么问题？

```
lineIter= iter(aFile)
for aLine in lineIter:
    if aLine.startswith("import"):
        if aLine.endswith("("):
            for aModule in lineIter:
                if aModule.endwith(")"):
                    break
                print "import", aModule.strip()
        else:
            print aLine.stri()
    else:
        print aLine.strip() 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T13:06:01.333

对于后人，这里是 S.Lott 脚本的一个稍微完善的版本（我会将其作为评论发布，但它太长了 ^^; ）.. 这个版本保留了缩进并产生了更接近我的示例的结果。

```
lineIter=iter(aFile)
对于 lineIter 中的 aLine：
    s = aLine.strip()
    如果 s.startswith("from ") 和 s.endswith("("):
        完成 = s[:-1]
        对于 lineIter 中的模块：
            m = aModule.strip()
            如果 m.endswith(")"):
                休息
            完成 += m.strip()
        打印完成
    别的：
        打印一行，

```

# mysql - mysql范围索引

> ID：368020
> 
> 赞同：0
> 
> 时间：2008-12-15T10:59:21.277
> 
> 标签：mysql, optimization

我有非常简单的选择，如下所示：

```
SELECT * FROM table 
  WHERE column1 IN (5, 20, 30); 
```

在 column1 上设置了索引，在解释查询是使用索引后，一切看起来都可以。

但如果范围内的值超过三个，如下所示：

```
 SELECT * FROM table 
      WHERE column1 IN (5, 20, 30, 40); 
```

不使用索引，并且选择通过所有记录运行。难道我做错了什么？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T11:11:15.853

MySql 认为表中有多少行？

Mysql 通常（通常是正确的！）假设对行进行顺序扫描会更快，而不是通过索引处理更复杂的访问。

它因 DBMS 而异，但折衷点是大约 30% 的行。

IE。如果优化器期望选择超过 30% 的行，它将顺序扫描整个表，因为这通常比通过索引进行大量直接访问要快。

# iphone - iPhone模拟器和applicationWillTerminate()

> ID：368021
> 
> 赞同：11
> 
> 时间：2008-12-15T10:59:28.047
> 
> 标签：iphone, ios-simulator

当我的应用在 iPhone 模拟器中运行时，委托方法

```
- (void)applicationWillTerminate:(UIApplication *)application 
```

仅在我第一次点击 iPhone 模拟器的主页按钮时调用。

按下主页按钮并再次启动应用程序后，点击主页按钮不会调用委托方法。

这里发生了什么？我误解了一些基本的东西吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-15T11:26:24.170

我怀疑它正在被调用，但你会感到困惑，因为在模拟器中点击 Home 按钮后，你已经结束了 Xcode 中的当前会话。`NSLog`您的方法中可能有一个`applicationWillTerminate:`，是吗？一旦你点击 Home 按钮，`NSLog`s 就不再出现在 Xcode 的运行控制台中。如果你打开`/Applications/Console.app`我希望他们会出现在那里。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-12-07T01:49:53.120

```
- (void)applicationWillTerminate:(UIApplication *)application 
```

当应用程序“终止”时调用。如果您使用的是 iOS，则应用程序不会在按下主页按钮时终止，除非您为应用程序禁用了多任务处理或用户没有“支持多任务处理”的设备。

```
- (void)applicationDidEnterBackground { 
```

现在在用户按下主页按钮时使用。除非（如我之前所说）您为您的应用禁用了多任务处理，或者用户没有“支持多任务处理”的设备。

# packages - 哪个更好：DMG 或 PackageMaker

> ID：368022
> 
> 赞同：1
> 
> 时间：2008-12-15T10:59:36.613
> 
> 标签：packages, xcodebuild

这是我的要求： 1\. 我希望我的可安装程序具有自定义许可协议 2\. 作为安装的一部分运行另一个包 3\. 让用户可以选择在启动时运行应用程序

我应该使用什么，创建 dmg 或使用 xcode 提供的 PackageMaker？有没有好的网页展示如何使用 PackageMaker？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T11:55:53.830

它们有不同的用途：

*   DMG（磁盘映像）只是一种容器文件格式，用于解决多叉文件和传输协议以及无法处理它们的中间主机的古老问题，首先不依赖它们。此外，磁盘映像可以使用内部压缩。您的用户会感谢您没有将它们与包含在文件中的文件混淆（尽管磁盘映像本身最初需要一些解释）。

*   PackageMaker 是一个成熟的安装包构建器。您可以自定义安装过程和位置，进行子安装以及您可能需要的几乎任何其他事情。如果您的安装不仅仅需要将应用程序包拖放到适当的位置，那么这就是要使用的。

根据您的要求，选择似乎很明显。由于安装程序包本身就是一个捆绑包，我想说：使用 PackageMaker 创建一个安装程序包并将其放入压缩磁盘映像中。将磁盘映像分发给您的用户。它只是提供更好的体验。

# ruby - 如何在 Ruby 的终端上编写带有窗口的控制台应用程序？

> ID：368032
> 
> 赞同：0
> 
> 时间：2008-12-15T11:03:38.290
> 
> 标签：ruby, console, prompt, curses

我想用 Ruby 为终端编写一个简单的聊天客户端。问题是，我需要两个单独的“窗口”，一个用于聊天日志，另一个用于输入提示。我不知道如何做到这一点。我看了 (n)curses 和其他一些 ruby​​-libs，但没有什么能给我这个功能。

```
.--------------------------------。
| 迈克：嗨，珍妮 |
| 珍妮：嗨，迈克，你好吗？|
|------------------------------------------|
|> 我很好_ |
`-----------------'

```

最大的问题是，如果出现新行，上框应该滚动，但提示应该保持在其位置。如果我在输入提示中写了一些东西，当用户按下 ENTER 时，文本应该会消失。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T11:15:01.980

好吧，ncurses（及其 ruby​​ 绑定库）确实允许您这样做，因为所有带有`windows(1)`,`talk(1)`和的相应工具`screen(1)`都是用 ncurses 编写的。您可以有多个带有 (n) 诅咒的窗口。

# java - Wicket：如何为索引列表实现 IDataProvider/LoadableDetachableModel

> ID：368033
> 
> 赞同：0
> 
> 时间：2008-12-15T11:03:48.430
> 
> 标签：java, wicket

在 Wicket 中为索引列表实现 an`IDataProvider`和 a的最佳方法是什么？`LoadableDetachable`假设我有一个拥有地址列表的客户。

```
class Customer {
    List<Adress> adresses;
} 
```

现在我想为客户的地址实现一个数据提供者/ldm。我想通常的方法是`IDataProvider`作为一个内部类引用组件的客户模型，例如：

```
class AdressDataProvider implements IDataProvider {

public Iterator iterator() {
    Customer c = (Customer)Component.this.getModel(); // somehow get the customer model
    return c.getAdresses().iterator();
}

public IModel model(Object o) {
    Adress a = (Adress) o;
    // Return an LDM which loads the adress by id.
    return new AdressLoadableDetachableModel(a.getId());
}

} 
```

问题：当地址没有 ID（例如，它是 Hibernate Embeddable/CollectionOfElements）但只能通过其在 customer.adresses 列表中的索引来识别时，我将如何实现这一点？如何保持对拥有实体和索引的引用？

事实上，我知道一个解决方案，但我想知道是否有一个通用的模式可以做到这一点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-18T06:52:35.787

您提出的解决方案是什么？你的问题对我来说似乎不太清楚。地址是由休眠延迟加载的吗？我真的看不出上面的代码有什么问题。如果你的地址被 Hibernate 加载到 c.getAdresses().iterator(); 打电话，然后你有地址，有什么问题？customer.adresses 实际上是地址对象的列表，还是只是 id 的列表？您始终可以在 AdressLoadableDetachableModel 中记录拥有实体及其索引，即 AdressLoadableDetachableModel(a.getId(), (Customer)Component.this.getModel()) 您能帮忙澄清一下吗？

# header - 如何在 .vm 文件中插入页眉和页脚

> ID：368036
> 
> 赞同：1
> 
> 时间：2008-12-15T11:04:43.560
> 
> 标签：header, velocity, footer

我有一个运行以生成 DOC 文件的 .vm (Velocity) 文件。我想在这个生成的 DOC 文件中有一个非常简单的页眉和页脚。我如何为此在 .vm 文件中编写代码。我不想将页眉和页脚文件包含为外部文件。我想要在同一个 .vm 文件中的简单代码。请帮忙！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T05:37:05.733

不包括单独的文件？只需编写 HTML。以下代码是 vm 文件的摘录：

```
<div class="footer">
    <div class="footerlinks">
    <ul>
        <li class="first">Something</li>
    </ul>
 </div>
</div> 
```

# sql-server - SQL Server 2005 - 关闭休眠连接

> ID：368039
> 
> 赞同：2
> 
> 时间：2008-12-15T11:08:23.223
> 
> 标签：sql-server, iis, connection, sleep

我的开发服务器上似乎有一个应用程序，它有很多打开的连接（它们应该在那里，但是一些错误的数据层被用来打开它们，忘记关闭它们）。我只是希望它们关闭，这样我就可以让其他应用程序在服务器上运行。如何强制关闭所有连接？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T12:13:06.870

使用以下脚本杀死来自特定主机/登录的非活动会话。您可以从计划的工作中使用它，当然您的首要任务应该是修复您的应用程序层。

```
SET NOCOUNT ON;

DECLARE @host VARCHAR(50), @login NVARCHAR(128);

SET @host = 'fooHost'; --NULL to kill sessions from all hosts.
SET @login = 'fooLogin';

DECLARE @cmd NVARCHAR(255);
DECLARE @possition INT, @total INT, @selSpid SMALLINT;
DECLARE @spidInfo TABLE
(
    [id] INT IDENTITY(1,1),
    spid SMALLINT,
    loginame NVARCHAR(128)
);

INSERT @spidInfo(spid, loginame)
SELECT session_id, login_name 
FROM sys.dm_exec_sessions
WHERE is_user_process = 1 AND [status] = 'sleeping' AND 
    login_name = @login AND [host_name] = COALESCE(@host, [host_name]);

SELECT @total = @@IDENTITY, @selSpid = 0, @possition = 0;

WHILE @possition < @total
    BEGIN
        SELECT TOP 1 @selSpid = spid, @possition = [id]
        FROM @spidInfo
        WHERE [ID] > @possition

        SET @cmd = N'KILL ' + CAST(@selSpid AS NVARCHAR(10));
        EXEC sp_executesql @cmd;
        PRINT 'SessionId = ' + CAST(@selSpid AS NVARCHAR(10)) + '[' + @login + 
            '] killed by ' + system_user + ' at ' + CAST(GETDATE() AS VARCHAR(50));
    END;

IF (@total = 0)
    PRINT 'No sessions owned by user ' + '[' + @login + ']'; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T11:13:18.830

除了手动终止连接之外，您还可以

*   处理连接。也就是说，以某种方式检索 Connection 对象并在它们上调用 .Close 和 .Dispose() 。使用“使用”将是理想的，因为它会自动为您调用 .Dispose()。
*   回收您的应用程序池。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T11:15:48.170

使用 sysprocesses 中的 last_batch 列来确定它是否真的处于活动状态。SPID > 50（或者是 >= 50？）以避免杀死系统 SPID。

将此与您想要的睡眠时间和 KILL spid 进行比较。

你必须循环过去。

```
DECLARE @kill_id smallint 
DECLARE spid_cursor CURSOR FOR
select spid from sysprocesses 
where dbid = > 4 and last_batch < dateadd(hour, -24, getdate()) and spid >= 50

OPEN spid_cursor

FETCH NEXT FROM spid_cursor INTO @kill_id

WHILE (@@FETCH_STATUS = 0)
BEGIN
-- Kill the current spid here
-- KILL @kill_id <---This line will not work

-- Get the next cursor row
FETCH NEXT FROM spid_cursor INTO @kill_id
END 

CLOSE spid_cursor

DEALLOCATE spid_cursor 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T21:28:57.070

首先运行它来找到有问题的数据库......

```
SELECT DB_NAME(dbid) as 'Database Name', 
COUNT(dbid) as 'Total Connections' 
FROM master.dbo.sysprocesses WITH (nolock)
WHERE dbid > 0
GROUP BY dbid
SELECT @@MAX_CONNECTIONS AS 'Max Allowed Connections' 
```

然后运行它以终止与所需数据库的连接

```
USE master
go

DECLARE @dbname sysname

SET @dbname = 'Events'

DECLARE @spid int
SELECT @spid = min(spid) from master.dbo.sysprocesses where dbid = db_id(@dbname)
WHILE @spid IS NOT NULL
BEGIN
EXECUTE ('KILL ' + @spid)
SELECT @spid = min(spid) from master.dbo.sysprocesses where dbid = db_id(@dbname) AND spid > @spid
END 
```

# batch-file - 如何为批处理文件中的等待进程编写微调器？

> ID：368041
> 
> 赞同：15
> 
> 时间：2008-12-15T11:10:02.487
> 
> 标签：batch-file, spinner

我想用微调器向用户展示一些事情是在后台完成的，但不知道这在批处理文件中是如何工作的。

有人有线索吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-16T13:19:04.067

这实际上可以使用纯本机命令很容易地完成，您只需要知道如何使用其中更棘手的命令即可。不需要使用 VBScript 等外部工具或清除屏幕等讨厌的副作用。

您正在寻找的是 bash " `echo -n`" 命令的等效项，它输出没有换行符的行。在 XP 批处理中，这是通过使用`set /p`带有空输入的“”（要求用户提供提示响应）来实现的，如下所示：

```
<nul (set /p junk=Hello)
echo. again. 
```

将输出字符串“Hello again”。没有干预换行符。

这个技巧（以及 CTRL-H 的使用，退格字符可以在以下测试脚本中看到，该脚本开始（一个接一个）10 秒的子任务，20 秒的超时和 15 秒的子任务10 秒超时的任务。

有效负载脚本由实际运行的脚本创建，它唯一的要求是它完成它必须做的工作，然后在完成时删除一个标志文件，以便监控功能能够检测到它。

请记住，此脚本中的 ^H 字符串实际上是 CTRL-H 字符，^| 是用于转义管道符号的两个单独字符。

```
@echo off

:: Localise environment.
setlocal enableextensions enabledelayedexpansion

:: Specify directories. Your current working directory is used
:: to create temporary files tmp_*.*
set wkdir=%~dp0%
set wkdir=%wkdir:~0,-1%

:: First pass, 10-second task with 20-second timeout.
del "%wkdir%\tmp_*.*" 2>nul
echo >>"%wkdir%\tmp_payload.cmd" ping 127.0.0.1 -n 11 ^>nul
echo >>"%wkdir%\tmp_payload.cmd" del "%wkdir%\tmp_payload.flg"
call :monitor "%wkdir%\tmp_payload.cmd" "%wkdir%\tmp_payload.flg" 20

:: Second pass, 15-second task with 10-second timeout.
del "%wkdir%\tmp_*.*" 2>nul:
echo >>"%wkdir%\tmp_payload.cmd" ping 127.0.0.1 -n 16 ^>nul
echo >>"%wkdir%\tmp_payload.cmd" del "%wkdir%\tmp_payload.flg"
call :monitor "%wkdir%\tmp_payload.cmd" "%wkdir%\tmp_payload.flg" 10

goto :final

:monitor
    :: Create flag file and start the payload minimized.
    echo >>%2 dummy
    start /min cmd.exe /c "%1"

    :: Start monitoring.
    ::    i is the indicator (0=|,1=/,2=-,3=\).
    ::    m is the number of seconds left before timeout.
    set i=0
    set m=%3
    <nul (set /p z=Waiting for child to finish: ^|)

    :: Loop here awaiting completion.
    :loop
        :: Wait one second.
        ping 127.0.0.1 -n 2 >nul

        :: Update counters and output progress indicator.
        set /a "i = i + 1"
        set /a "m = m - 1"
        if %i% equ 4 set i=0
        if %i% equ 0 <nul (set /p z=^H^|)
        if %i% equ 1 <nul (set /p z=^H/)
        if %i% equ 2 <nul (set /p z=^H-)
        if %i% equ 3 <nul (set /p z=^H\)

        :: End conditions, complete or timeout.
        if not exist %2 (
            echo.
            echo.   Complete.
            goto :final
        )
        if %m% leq 0 (
            echo.
            echo.   *** ERROR: Timed-out waiting for child.
            goto :final
        )
        goto :loop
:final
endlocal 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-10-15T08:04:11.253

试试这个：

```
@ECHO OFF
SETLOCAL ENABLEDELAYEDEXPANSION
CALL :BACKSPACE $BS
SET /A FULL_COUNT=60
SET /A MAX_COUNT=160
SET /A Spin_Delay=50
SET "_MSG=Process running..."
SET /A CTR=0
SET /A TCT=0
IF NOT [%1]==[] SET _MSG=%~1
IF NOT [%2]==[] SET /A FULL_COUNT=%2
IF NOT [%3]==[] SET /A SPIN_DELAY=%3
IF %FULL_COUNT% GTR %MAX_COUNT% SET FULL_COUNT=%MAX_COUNT%
(SET/P=%_MSG%*)<nul
FOR /L %%A IN (1,1,%FULL_COUNT%) DO (
  CALL :DELAY %SPIN_DELAY%
  IF !CTR! EQU 0 (set/p=%$BS%³)<nul
  IF !CTR! EQU 1 (set/p=%$BS%/)<nul
  IF !CTR! EQU 2 (set/p=%$BS%Ä)<nul
  IF !CTR! EQU 3 (set/p=%$BS%\)<nul
  SET /A CTR=%%A %% 4
)
(SET/P=%$BS%*)<nul
ENDLOCAL & EXIT /B %CTR%

:BackSpace
setlocal
for /f %%a in ('"prompt $H$S &echo on &for %%b in (1) do rem"') do set "Bs=%%a"
endlocal&call set %~1=%BS%&exit /b 0

:Delay msec
setlocal enableextensions
set/a correct=0
set/a msecs=%1+5
if /i %msecs% leq 20 set /a correct-=2
set time1=%time: =%
set/a tsecs=%1/1000 2>nul
set/a msecs=(%msecs% %% 1000)/10
for /f "tokens=1-4 delims=:." %%a in ("%time1%") do (
  set hour1=%%a&set min1=%%b&set sec1=%%c&set "mil1=%%d"
)
if /i %hour1:~0,1% equ 0 if /i "%hour1:~1%" neq "" set hour1=%hour1:~1% 
if /i %min1:~0,1% equ 0 set min1=%min1:~1% 
if /i %sec1:~0,1% equ 0 set sec1=%sec1:~1%
if /i %mil1:~0,1% equ 0 set mil1=%mil1:~1% 
set/a sec1+=(%hour1%*3600)+(%min1%*60)
set/a msecs+=%mil1%
set/a tsecs+=(%sec1%+%msecs%/100)
set/a msecs=%msecs% %% 100
::    check for midnight crossing
if /i %tsecs% geq 86400 set /a tsecs-=86400
set/a hour2=%tsecs% / 3600
set/a min2=(%tsecs%-(%hour2%*3600)) / 60
set/a sec2=(%tsecs%-(%hour2%*3600)) %% 60
set/a err=%msecs%
if /i %msecs% neq 0 set /a msecs+=%correct%
if /i 1%msecs% lss 20 set msecs=0%msecs%
if /i 1%min2% lss 20 set min2=0%min2%
if /i 1%sec2% lss 20 set sec2=0%sec2%
set time2=%hour2%:%min2%:%sec2%.%msecs%
:wait
  set timen=%time: =%
  if /i %timen% geq %time2% goto :end
goto :wait
:end
for /f "tokens=2 delims=." %%a in ("%timen%") do set num=%%a
if /i %num:~0,1% equ 0 set num=%num:~1%
set/a err=(%num%-%err%)*10
endlocal&exit /b %err% 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T16:20:30.550

如果您不介意屏幕清除...试试这个：

```
@ECHO OFF

SETLOCAL ENABLEDELAYEDEXPANSION
SET COUNT=1

START CALC

:BEGIN
  CLS
  IF !COUNT! EQU 1 ECHO \
  IF !COUNT! EQU 2 ECHO -
  IF !COUNT! EQU 3 ECHO /
  IF !COUNT! EQU 4 ECHO -
  IF !COUNT! EQU 4 (
    SET COUNT=1
  ) ELSE (
    SET /A COUNT+=1
  )
  PSLIST CALC >nul 2>&1
  IF %ERRORLEVEL% EQU 1 GOTO END
GOTO BEGIN

:END 
```

编辑：此示例将启动计算器，然后显示“微调器”，直到您关闭计算器。我使用**pslist**检查 CALC.EXE 的存在。*>nul 2>&1*将STDOUT 和 STDERR 重定向到 nul，因此 PSLIST 中的任何内容都不会显示。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T13:16:19.580

如果我理解您的问题，您想要一个微调器，因为您正在执行的某些操作需要时间，并且您想向用户展示正在发生的事情，对吗？

在这种情况下，据我所知，使用本机命令是不可能的。（如果您的程序在执行需要很长时间的操作时显示微调器，则有可能）

而且看起来 echo 不支持 ansi 转义序列（在过去你必须加载 ansi.sys，不知道它是否仍然存在）所以你不能使用 ansi 来控制光标。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T15:55:37.137

如果您的意思是在 Windows 批处理脚本中，您不能在本地执行此操作。用于打印到控制台的 echo 语句将始终打印换行符，并且您不能移动光标。

这有点小技巧，但您可以结合使用 VBScript 和批处理脚本来做到这一点。

这个 VBScript 将打印一个退格，然后是它的参数：

```
WScript.StdOut.Write(chr(8) & WScript.Arguments(0)) 
```

把它放在一个文件中`vbsEcho.vbs`，然后从你的批处理脚本中调用这个脚本。以下批处理脚本将一直显示微调器，直到您按下 CTRL-C：

```
@echo off

:LOOP
cscript //nologo vbsEcho.vbs "\"
cscript //nologo vbsEcho.vbs "|"
cscript //nologo vbsEcho.vbs "/"
cscript //nologo vbsEcho.vbs "-"
goto :LOOP 
```

编辑：使用 aphoria 答案中的一些想法，此脚本将启动 Windows 计算器，并显示一个微调器，直到计算器关闭：

```
@ECHO OFF

SETLOCAL ENABLEDELAYEDEXPANSION
SET COUNT=1

START CALC

cscript //nologo vbsEcho.vbs "Calculating: \"
:LOOP
IF !COUNT! EQU 1 cscript //nologo vbsEcho.vbs "|"
IF !COUNT! EQU 2 cscript //nologo vbsEcho.vbs "/"
IF !COUNT! EQU 3 cscript //nologo vbsEcho.vbs "-"
IF !COUNT! EQU 4 (
    cscript //nologo vbsEcho.vbs "\"
    set COUNT=1
) else (
    set /a COUNT+=1
)

pslist CALC >nul 2>&1
if %ERRORLEVEL% EQU 1 goto :end

goto :LOOP

:END
cscript //nologo vbsEcho.vbs ". Done." 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T16:11:47.293

微调器**可以**在批处理脚本中完成，您只需要一些变量：

```
@echo off

:spinner
set mSpinner=%mSpinner%.
if %mSpinner%'==..............................' set mSpinner=.
cls
echo %mSpinner%

rem Check if the process has finished via WMIC and/or tasklist.

goto spinner

:exit 
```

让 BAT 本身检测正在运行/退出的进程。您可以通过[WMI 命令行界面](http://msdn.microsoft.com/en-us/library/aa827351(VS.85).aspx)或我所知有限的 tasklist 命令来执行此操作。

如果它回到 DOS 时代，你甚至可以在不清除屏幕的情况下做到这一点......没有使用一些转义字符的组合。我不知道它在 Vista/XP 上是否仍然可行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T11:12:16.570

您可以使用从给定集合中打印不同字符的计数器（例如“\|/-”），然后根据“counter modulo 4”之类的方式更改字符。无论如何，您没有说您正在使用哪种语言工作，因此更准确地说有点困难。

编辑：既然我们知道您在哪个环境中玩，我会说 BAT/CMD 语言并不能真正胜任这项任务……我会推荐任何脚本语言，Ruby 是我的最爱。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-12T18:33:41.690

我发现最简单的方法是更新标题——这样你就不必一直做 CLS。

使用两行 ping -n 的原因是，每次 ping 执行 1 秒的双 ping 比执行 2 秒的单 ping 更快。

此外，对于那些不知道的人，a :: 与 REM 相同，只是在解析器的开头（我认为这是正确的词）而不是结尾处忽略了注释。简而言之，该行被忽略。

```
:: begin spin.cmd
@echo off
setlocal

set COUNT=0
set MAXCOUNT=10
set SECONDS=1

:LOOP
title "\"
call :WAIT
title "|"
call :WAIT
title "/"
call :WAIT
title "-"
if /i "%COUNT%" equ "%MAXCOUNT%" goto :EXIT
set /a count+=1
echo %COUNT%
goto :LOOP

:WAIT
ping -n %SECONDS% 127.0.0.1 > nul
ping -n %SECONDS% 127.0.0.1 > nul
goto :EOF

:EXIT
title FIN!
endlocal
:: end spin.cmd 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-17T06:33:06.790

paxdiablos 有一个惊人的答案，但是必须将您的命令回显到有效负载文件中是很烦人的。它很难阅读，也很难调试。我拿了他的代码并对其进行了一些修改以供自己使用：

```
@echo off

:: Localise environment.
setlocal enableextensions enabledelayedexpansion

set wkdir=%~dp0%
set wkdir=%wkdir:~0,-1%
set done_flag="%wkdir%\tmp_payload.flg"
set timeout=7

:controller

IF (%1)==() (
    call :monitor step1 "Getting stuff from SourceSafe: "
    call :monitor step2 "Compiling some PHP stuff: "
    call :monitor step3 "Finishing up the rest: "
) ELSE ( goto %1 )

goto final

:step1
::ping for 5 seconds
    ping 127.0.0.1 -n 6 >nul
    del "%wkdir%\tmp_payload.flg"
goto final

:step2
::ping for 10 seconds
    ping 127.0.0.1 -n 11 >nul
    del "%wkdir%\tmp_payload.flg"
goto final

:step3
::ping for 5 seconds
    ping 127.0.0.1 -n 6 >nul
    del "%wkdir%\tmp_payload.flg"
goto final

:monitor
:: Create flag file and start the payload minimized.
:: echo the word "dummy" to the flag file (second parameter)
    echo >>%done_flag% dummy
:: start the command defined in the first parameter
    start /min cmd.exe /c "test2.bat %1"

:: Start monitoring.
::    i is the indicator (0=|,1=/,2=-,3=\).
::    m is the number of seconds left before timeout.
set i=0
set m=%timeout%
set str=%2
for /f "useback tokens=*" %%a in ('%str%') do set str=%%~a

<nul (set /p z=%str%^|)

:: Loop here awaiting completion.
:loop
    :: Wait one second.
    ping 127.0.0.1 -n 2 >nul

    :: Update counters and output progress indicator.
    set /a "i = i + 1"
    set /a "m = m - 1"
    if %i% equ 4 set i=0
    if %i% equ 0 <nul (set /p z=^|)
    if %i% equ 1 <nul (set /p z=/)
    if %i% equ 2 <nul (set /p z=-)
    if %i% equ 3 <nul (set /p z=\)

    :: End conditions, complete or timeout.
    if not exist %done_flag% (
        ::echo.
        echo Complete
        goto :final
    )
    if %m% leq 0 (
        echo.
        echo.   *** ERROR: Timed-out waiting for child.
        goto :final
    )
    goto :loop

:final
endlocal 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-03-12T01:02:50.677

此例程检查您从 cmd 启动的进程的任务列表的输出。
将 exe 的名称作为参数传递给它，例如
call :spinner calc.exe
它报告
Elapsed: 001 秒
并增加秒数，直到 exe 进程终止。
ECHO.exe -n \r 每秒都会覆盖 Elapsed 001 seconds 消息，
这会在没有换行的情况下回显 cr。
Echo.exe 位于 [http://www.paulsadowski.com/wsh/cmdprogs.htm](http://www.paulsadowski.com/wsh/cmdprogs.htm)

```
 @echo off
 start calc
 call :spinner calc.exe
 pause

 :spinner       
 SET COUNT=1
 :BEGIN
 set "formattedValue=000000%count%"
 ECHO.exe -n Elapsed: %formattedValue:~-3% seconds
 ECHO.exe -n \r    %= -n (suppress crlf) \r output a cr =%

 SET /A COUNT+=1

 set EXE=%1    %= search output of tasklist for EXE =%
 set tl=tasklist /NH /FI "IMAGENAME eq %EXE%"
 FOR /F %%x IN ('%tl%') DO IF %%x == %EXE% goto FOUND
 set result=0
 goto FIN
 :FOUND
 set result=1
 :FIN
 IF %result% EQU 0 GOTO END

 PING -n 2 127.0.0.1 > nul    %= wait for about 1 second =%

 GOTO BEGIN
 :END 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-08-02T21:02:18.907

启动应用程序，等待加载

```
@echo off & setlocal enabledelayedexpansion
start application.exe
:1
for %%a in (^| ^/ ^- ^\ ^| ^/ ^- ^\) do (
for %%b in (^| ^/ ^- ^\ ^| ^/ ^- ^\) do (
for %%c in (^| ^/ ^- ^\ ^| ^/ ^- ^\) do (
cls &echo processing..%%c%%b%%a
sleep -m 20
IF EXIST "result file" (exit)
)))
goto 1 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-05-26T04:58:23.993

:LOOP ECHOX -n "~r%Processing..." IF %CTR% EQU 4 SET /A CTR=0 IF %CTR%==0 (set /p DOT=³)

# sql - 在 ACCESS 中添加一个具有默认值的字段

> ID：368049
> 
> 赞同：2
> 
> 时间：2008-12-15T11:14:35.693
> 
> 标签：sql, alter, jet

我想使用 Visual C++ 代码插入一个具有默认值的新字段。我写了这个：

```
CADODatabase pDB;
String strConnessione = _T("Provider=Microsoft.Jet.OLEDB.4.0;""Data Source=");
strConnessione = strConnessione + "MioDatabase.mdb";
pDB.SetConnectionString(strConnessione);
pDB.Open();

query.Format("ALTER TABLE TBProva ADD Fattore Double Default 0;");
pDB.Execute(query); 
```

但这是不正确的。我该怎么做呢？你们中的某个人可以给我写正确的代码吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T14:44:32.913

在 JET-SQL 语言中，您必须更具体地使用语法并在“ALTER TABLE”句子中添加“COLUMN”单词。示例：

```
strSql = "ALTER TABLE MyTable ADD COLUMN MyField DECIMAL (28,3);"
strSql = "ALTER TABLE MyTable ADD COLUMN MyText TEXT(3);" 
```

根据帮助，您可以定义一个默认值，但我从未尝试过。此语法仅对 Access/JET 数据库有效。如果您通过 ODBC 或 ADO 访问您的访问表，我认为它不会起作用。

在这种情况下，您可以通过其他方式更改数据库结构。你会在[这里](https://stackoverflow.com/questions/180929/how-do-i-create-a-decimal-field-in-access-with-alter-table#181763)找到一个例子。这是使用 DAO 对象模型制作的，但可以轻松切换到通用 ADO 对象模型以与 ADODB 连接一起使用。

编辑：一个“隐式 ADO 解决方案”（意味着使用 ADODB 连接而不是 ADO 表对象等）可以如下：

（有关连接字符串示例，请查看[此处](http://www.connectionstrings.com)）

```
Dim myConnection AS ADODB.connection
set myConnection = New ADODB.connectionString
myConnection.connectionString = 'here is your connection string'
myConnection.open
myConnection.execute "ALTER TABLE myTable ADD Column MyField DECIMAL (12,3);"
myConnection.close 
```

如果您正在使用活动的 mdb 文件，只需编写：

```
CurrentProject.Connection.Execute "ALTER TABLE myTable ADD Column MyField DOUBLE;" 
```

而已。

如果您更喜欢使用 ADO 对象，请将 ADOX 库添加到您的代码源并使用该`Table.columns.append`方法。你会在[这里找到一个例子](http://msdn.microsoft.com/en-us/library/ms676514(VS.85).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T11:42:29.060

您缺少`COLUMN`关键字，例如

```
ALTER TABLE TBProva ADD COLUMN Fattore Double Default 0; 
```

实际上，我认为您也可能缺少该`NOT NULL`部分，例如

```
ALTER TABLE TBProva ADD COLUMN Fattore DOUBLE DEFAULT 0 NOT NULL; 
```

我这样说是因为 Jet 不支持`DEFAULT`在 SQL DML 中使用关键字，因此唯一的`DEFAULT`应用 a 是当列声明为`NOT NULL`并且列名从`INSERT`. 如果该列是 NULLable，您将如何让引擎应用默认值？！

# python - 通过 sys.modules 使虚拟包可用

> ID：368057
> 
> 赞同：11
> 
> 时间：2008-12-15T11:20:14.900
> 
> 标签：python, import, module

假设我有一个包“mylibrary”。

我想让“mylibrary.config”可用于导入，可以作为动态创建的模块，也可以作为从完全不同的地方导入的模块，然后基本上“安装”在“mylibrary”命名空间内。

即，我这样做：

```
import sys, types
sys.modules['mylibrary.config'] = types.ModuleType('config') 
```

鉴于该设置：

```
>>> import mylibrary.config    # -> works

>>> from mylibrary import config
<type 'exceptions.ImportError'>: cannot import name config 
```

更陌生：

```
>>> import mylibrary.config as X
<type 'exceptions.ImportError'>: cannot import name config 
```

所以似乎使用直接导入的作品，其他形式没有。是否也可以使这些工作？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-15T12:13:05.480

您不仅需要将模块修补到 sys.modules 中，还需要修补到其父模块中：

```
>>> import sys,types,xml
>>> xml.config = sys.modules['xml.config'] = types.ModuleType('xml.config')
>>> import xml.config
>>> from xml import config
>>> from xml import config as x
>>> x
<module 'xml.config' (built-in)> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T16:28:24.123

以及以下内容：

```
import sys, types
config = types.ModuleType('config')
sys.modules['mylibrary.config'] = config 
```

你还需要做：

```
import mylibrary
mylibrary.config = config 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T12:41:41.227

你可以尝试这样的事情：

```
class VirtualModule(object):
  def __init__(self, modname, subModules):
    try:
      import sys
      self._mod = __import__(modname)
      sys.modules[modname] = self
      __import__(modname)
      self._modname = modname
      self._subModules = subModules
    except ImportError, err:
      pass  # please signal error in some useful way :-)
  def __repr__(self):
    return "Virtual module for " + self._modname
  def __getattr__(self, attrname):
    if attrname in self._subModules.keys():
      import sys
      __import__(self._subModules[attrname])
      return sys.modules[self._subModules[attrname]]
    else:
      return self._mod.__dict__[attrname]

VirtualModule('mylibrary', {'config': 'actual_module_for_config'})

import mylibrary
mylibrary.config
mylibrary.some_function 
```

# iphone - 在 iphone 应用程序中创建配置文件

> ID：368062
> 
> 赞同：4
> 
> 时间：2008-12-15T11:24:54.627
> 
> 标签：iphone, build, provisioning, user-profile

如何构建用于部署 iPhone 应用程序的配置文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-16T01:10:41.213

同意上面的观点，但这里是它的要点。

1.  在 Apple 注册成为 iPhone 开发人员。
2.  给他们 100 美元，让您进入可以在手机上部署应用程序的俱乐部。
3.  在您在 2 中访问的[门户](https://developer.apple.com/ios/manage/overview/index.action)中创建您的移动配置。
4.  在各种场景中使用此移动配置构建您的应用程序。（开发、AdHoc 分发、部署。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T11:40:35.483

请[阅读文档](http://developer.apple.com/iphone/download.action?path=/iphone/iphone_developer_program_user_guide/iphone_developer_program_user_guide__standard_program_v2.4.pdf)。如果您有特定问题，请随时更新您的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-12T07:49:38.330

确保您的 iPhone 没有越狱。描述的过程有点痛苦，但它是一次性的。

# c# - 如何实现树视图中映射的文件的撤消/重做

> ID：368073
> 
> 赞同：-1
> 
> 时间：2008-12-15T11:29:27.673
> 
> 标签：c#, undo-redo

谁能知道我应该如何实现在 C# 的树视图中映射的文件（目录、子目录）的剪切/复制/粘贴的撤消/重做？

有一些代码示例会很棒。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T11:52:08.893

考虑实现[命令模式](http://en.wikipedia.org/wiki/Command_pattern)（GoF）：

*   将您的操作逻辑放入实现通用 ICommand {Do(); 的类中 撤消（）；}接口。
*   在每个用户操作上，您创建请求的命令对象并使用新旧文件名等上下文参数对其进行初始化。
*   调用 Do()，将对象放入已完成命令的堆栈中。
*   每个命令都提供了上下文，因此通过调用 Undo() 它可以反转更改。
*   考虑将文件移动到临时文件夹而不是删除。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-15T11:39:50.570

撤消/重做通常使用所谓的“命令模式”来实现。使用 Google 搜索或阅读以下文章：

> [http://blogs.vbcity.com/jspano/articles/198.aspx](http://blogs.vbcity.com/jspano/articles/198.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T11:52:21.997

对于快速线性撤消/重做，您可以使用[Memento 模式](http://www.dofactory.com/Patterns/PatternMemento.aspx)，使用文件的 zip 作为纪念品。

# jquery - JQuery AJAX返回链接不起作用

> ID：368074
> 
> 赞同：0
> 
> 时间：2008-12-15T11:29:51.777
> 
> 标签：jquery, ajax, hyperlink, return

我在集成 PHP 和 JQuery 时遇到问题：

我的主文件是`MyFile.html`，AJAX 调用文件是`ajax.php`.

该`ajax.php`函数将链接返回`myFile.html`为

`<a href Link.php?action=Function ></a>` （即`echo " <a href Link.php?action=Delete";`）

当我单击返回的链接时，`MyFile.html`它按预期执行。我需要如何修改等效代码以在`Myfile.Html`.

我的动机是`ajax.php`返回链接应该在 HTML 中工作。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T11:46:07.033

您缺少`=`and 引号：

```
<a href Link.php?action=Function > 
```

应该

```
<a href="Link.php?action=Function"> 
```

您需要像这样在 PHP 中转义这些：

```
echo "<a href=\"Link.php?action=Function\">"; 
```

或者使用单引号：

```
echo '<a href="Link.php?action=Function">'; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T12:12:08.633

听起来您正试图简单地将 HTML 元素的内容设置为执行 PHP 脚本的结果。这是一个示例 PHP 脚本，它将根据您在“foo”参数中传递的参数打印一个 HTML 链接。

```
<?
  // Get the parameter "foo" from the URL string.
  $action = $_GET['foo'];

  // Return a different link depending on what 'foo' is.
  switch ($action) {
    case 'a':
      print('<a href="Link.php?action=Delete">Delete</a>');
      break;
    case 'b':
      print('<a href="Link.php?actiom=Edit">Edit</a>');
      break;
    default:
      print('<a href="Link.php?action=New">New</a>');
      break;
  }
?> 
```

现在您需要使用 Javascript (jQuery) 从 HTML 文件中加载该 PHP 脚本。这是一个简单的页面来证明这一点。

```
<html>
<head>
<title>Demo Page</title>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript">
  $(function() {
    $.get('ajax.php?foo=a', function(data) {
      $('#result').html('Received response: ' + data);
    });
  });
</script>
</head>
<body>
<!-- This div will contain a link to the "Delete" -->
<div id="result"/>
</body>
</html> 
```

一些要记住的事情：

1.  此演示假定“ajax.php”和“demo.html”文件位于同一目录中。
2.  还假设您的 jQuery Javascript 文件位于名为“js”的目录中名为“jquery.js”的文件中。
3.  您需要从实时 Web 服务器运行此示例。换句话说，如果您将这些文件放在桌面上并在 Web 浏览器中打开“demo.html”，这将不起作用。有两个原因。现代浏览器中的安全限制通常会阻止来自本地文件的 AJAX 调用。此外，PHP 页面将无法运行，从而使整个练习变得毫无用处。

这是您应该拥有的目录结构，假设 /www/data 是您的 Web 服务器文件的根目录：

*   /www/data/demo.html
*   /www/data/ajax.php
*   /www/data/js/jquery.js

# c# - 我可以在 .NET 程序集中嵌入一个 win32 DLL，并使用 P/Invoke 对其进行调用吗？

> ID：368080
> 
> 赞同：5
> 
> 时间：2008-12-15T11:33:08.447
> 
> 标签：c#, .net, pinvoke

我正在为第三方本机库编写 C# 包装器，我们将其作为 DLL。我希望能够为新程序集分发一个 DLL。我是否可以将 win32 DLL 嵌入到我的 .NET DLL 中，并且仍然使用 P/Invoke 对其进行调用？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T11:41:25.623

如果本机 dll 没有任何依赖项，则应该可以工作。

您可以将 dll 编译为嵌入式资源，而不是从代码内部访问流，将其序列化到临时文件夹并从那里使用它。

在这里发布示例代码太多了，但方法并不复杂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T15:22:05.083

我从来没有做过，但我知道有一个开源项目可以做到这一点。他们使用自己的名为[mergebin](http://www.koushikdutta.com/2008/09/day-6-mergebin-combine-your-unmanaged.html)的工具将原生 SQLite3 代码嵌入到托管 SQLite 程序集中。

去看看[PHX 的 .NET 的 SQLite 项目](http://sqlite.phxsoftware.com/)并获取源代码，你可以看到它是如何完成的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T11:35:49.003

我认为您不能直接执行此操作，但可以在运行时将其提取到某个临时位置并调用该副本。

# clearcase - ClearCase 时间和查询

> ID：368086
> 
> 赞同：3
> 
> 时间：2008-12-15T11:34:57.087
> 
> 标签：clearcase, config-spec

这个配置规范显示了我需要的文件：

```
element -dir * '{version(/main/LATEST) && !version(SLT-T)}'
element -file * '{version(/main/LATEST) && !version(SLT)}' 
```

现在我需要看看源在未来的某个时间点是如何看待的，所以我这样做：

```
time 01-Nov-2008
element -dir * '{version(/main/LATEST) && !version(SLT-T)}'
element -file * '{version(/main/LATEST) && !version(SLT)}' 
```

不幸的是，这仍然向我展示了“现在”。手册说：

> 时间规则可以嵌套。它们可能不包括任何查询语言结构。

好的，但那我该怎么办？

如何在不使用查询语言的情况下排除具有特定标签的文件和目录？或者有没有办法在查询语言中指定时间？

（没有文件有 SLT-T 标签，也没有目录有 SLT 标签。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T23:01:55.607

您是否尝试添加一些查询语言指令，例如：

```
&& !ver{created_since(1-Nov-2008)}
&& ver{created_since(1-Nov-2008)} 
```

（2008 年 11 月 1 日之前/之后存在的所有版本）

这是查询语言的一部分，可以帮助您完善选择规则。

* * *

我确认已对其进行了测试：

```
element /myPath/... /main/{!created_since(01-Sep-2008)}
element /myPath/... /main/LATEST 
```

在这种情况下，将为您提供 9 月之前创建的所有版本。

不过，我不确定它是否可以与您的规则相结合以成功实现您正在寻找的东西。

我的意思是确保您可以在配置规范中包含基于时间的选择规则。

# hyper-v - Hyper-V 关机失败 - 错误 32768

> ID：368091
> 
> 赞同：0
> 
> 时间：2008-12-15T11:36:04.433
> 
> 标签：hyper-v

我正在尝试为我们的开发\测试实验室自动化 Hyper-V。我下载了 PSHyperV 包，大多数脚本都可以工作，但是当我尝试关闭机器时，它失败并出现错误代码 32768。

我还尝试了 Ben[博客上](http://blogs.msdn.com/virtual_pc_guy/archive/2008/01/30/shutting-down-a-hyper-v-virtual-machine.aspx%29)的脚本。

然而这也失败了。

```
__GENUS          : 2
__CLASS          : __PARAMETERS
__SUPERCLASS     :
__DYNASTY        : __PARAMETERS
__RELPATH        :
__PROPERTY_COUNT : 1
__DERIVATION     : {}
__SERVER         :
__NAMESPACE      :
__PATH           :
ReturnValue      : 32768 
```

有没有人有任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-20T09:23:23.757

这是一个解释：[http ://social.technet.microsoft.com/Forums/en-US/winserverhyperv/thread/ddcf44cb-7cf2-413d-abe4-b0ed33f5d3fa](http://social.technet.microsoft.com/Forums/en-US/winserverhyperv/thread/ddcf44cb-7cf2-413d-abe4-b0ed33f5d3fa)

# java - System.currentTimeMillis() vs. new Date() vs. Calendar.getInstance().getTime()

> ID：368094
> 
> 赞同：256
> 
> 时间：2008-12-15T11:36:54.867
> 
> 标签：java, performance, date, time, calendar

在 Java 中，使用的性能和资源影响是什么

```
System.currentTimeMillis() 
```

对比

```
new Date() 
```

对比

```
Calendar.getInstance().getTime() 
```

据我了解，`System.currentTimeMillis()`是最有效的。但是，在大多数应用程序中，需要将 long 值转换为 Date 或一些类似的对象才能对人类做任何有意义的事情。

* * *

## 回答 #1

> 赞同：262
> 
> 时间：2008-12-15T11:53:14.880

`System.currentTimeMillis()`显然是最**有效**的，因为它甚至不创建对象，但`new Date()`实际上只是一个很长的薄包装器，所以它也不甘落后。`Calendar`另一方面，它相对缓慢且非常复杂，因为它必须处理日期和时间（闰年、夏令时、时区等）所固有的相当复杂和所有奇怪的问题。

通常最好只处理`Date`应用程序中的长时间戳或对象，并且仅`Calendar`在您实际需要执行日期/时间计算或格式化日期以将其显示给用户时使用。如果你必须做很多这样的事情，使用[Joda Time](http://joda-time.sourceforge.net/)可能是一个好主意，因为它的界面更简洁，性能更好。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-12-15T11:44:32.090

查看JDK，最里面的构造函数`Calendar.getInstance()`有这个：

```
public GregorianCalendar(TimeZone zone, Locale aLocale) {
    super(zone, aLocale);
    gdate = (BaseCalendar.Date) gcal.newCalendarDate(zone);
    setTimeInMillis(System.currentTimeMillis());
} 
```

所以它已经自动执行您的建议。Date 的默认构造函数包含以下内容：

```
public Date() {
    this(System.currentTimeMillis());
} 
```

因此，除非您想在使用它创建日历/日期对象之前对其进行一些数学运算，否则实际上不需要专门获取系统时间。如果您的目的是大量使用日期计算，我还必须推荐[joda-time](http://joda-time.sourceforge.net/)来替代 Java 自己的日历/日期类。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-12-15T11:40:48.790

如果您使用日期，那么我强烈建议您使用 jodatime，[http:](http://joda-time.sourceforge.net/) //joda-time.sourceforge.net/ 。使用日期`System.currentTimeMillis()`字段听起来是个非常糟糕的主意，因为您最终会得到很多无用的代码*。*

日期和日历都非常糟糕，日历绝对是它们中表现最差的。

我建议您`System.currentTimeMillis()`在实际操作毫秒时使用，例如像这样

```
 long start = System.currentTimeMillis();
    .... do something ...
 long elapsed = System.currentTimeMillis() -start; 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2013-04-27T08:27:10.747

在我的机器上，我尝试检查它。我的结果：

```
Calendar.getInstance().getTime() (*1000000 次) = 402ms
新日期().getTime(); (*1000000 次) = 18ms
System.currentTimeMillis() (*1000000 次) = 16ms

```

不要忘记 GC（如果你使用`Calendar.getInstance()`or `new Date()`）

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-12-15T11:39:59.103

我更喜欢将返回的值`System.currentTimeMillis()`用于所有类型的计算，并且仅在`Calendar`或者`Date`我需要真正显示人类读取的值时才使用。这也将防止 99% 的夏令时错误。:)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-15T22:10:19.863

根据您的应用程序，您可能需要考虑`System.nanoTime()`改用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-01-24T17:12:18.327

我试过这个：

```
 long now = System.currentTimeMillis();
        for (int i = 0; i < 10000000; i++) {
            new Date().getTime();
        }
        long result = System.currentTimeMillis() - now;

        System.out.println("Date(): " + result);

        now = System.currentTimeMillis();
        for (int i = 0; i < 10000000; i++) {
            System.currentTimeMillis();
        }
        result = System.currentTimeMillis() - now;

        System.out.println("currentTimeMillis(): " + result); 
```

结果是：

日期（）：199

当前时间米利斯（）：3

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-01-24T17:18:36.407

`System.currentTimeMillis()`显然是最快的，因为它只是一个方法调用，不需要垃圾收集器。

# asp.net-mvc - ASP.NET MVC & Ajax 控制工具包

> ID：368098
> 
> 赞同：1
> 
> 时间：2008-12-15T11:37:54.193
> 
> 标签：asp.net-mvc, asp.net-ajax, asp.net-mvc-beta1

我喜欢编写“old skool”（网络表单）的一件事是 AJAX 控制工具包。

我在[Microsoft Storefront 视频 14](http://www.asp.net/learn/mvc-videos/video-373.aspx)上看到，[Rob Conery 使用 TextboxWatermark](http://blog.wekeroad.com/mvc-storefront/mvcstore-part-14/)控件。

但是，当我[下载代码](http://www.codeplex.com/mvcsamples/SourceControl/changeset/view/9325)时，我无法从工具包中找到对 Watermark 控件或任何其他控件的任何引用，也无法使其正常工作。

所以我的问题是，AJAX 控制工具包是否甚至可以在没有视图状态的 MVC / AJAX / JQuery 类型世界中工作。您将什么用于“简单”控件，例如日历和水印？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T11:43:14.510

[jQuery UI](http://ui.jquery.com/)具有日历和其他 UI 组件。还可以查看大量的[jQuery 插件](http://plugins.jquery.com/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-08T21:01:26.667

我最近一直在研究这个问题，我发现 AJAX 控件工具包不容易以您希望用于 ASP.NET MVC 的“仅 JavaScript”方式使用。事实上，这是一种真正的痛苦。这里有两个例子：

[示例 1 - 弹出日历](http://stephenwalther.com/blog/archive/2008/08/23/asp-net-mvc-tip-36-create-a-popup-calendar-helper.aspx)

[示例 2 - 自动完成文本字段](http://stephenwalther.com/blog/archive/2008/08/24/asp-net-mvc-tip-37-create-an-auto-complete-text-field.aspx)

两者都不容易。

您可以像在常规 ASP.NET 中那样为您的 MVC 页面提供代码隐藏并使用 AJAX 控件工具包，但这确实违反了 MVC 的整个理念，所以我不建议这样做。

我的建议是遵循 Fredrik Kalseth 的建议并使用 jQuery UI 或众多插件之一。Telerik 还有一些好看的基于 jQuery 的[开源 MVC 控件。](http://www.telerik.com/products/aspnet-mvc.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-12T14:17:55.557

大多数 AJAX 控制工具包都以 MVC 友好的 javascript 形式提供，来自[MS AJAX CDN](http://www.asp.net/ajaxlibrary/CDNACT40412.ashx)。这些也可以使用 jquery 插件语法来使用。

# sdk - Symbol SDK - 获取设备序列号

> ID：368101
> 
> 赞同：0
> 
> 时间：2008-12-15T11:40:11.850
> 
> 标签：sdk, symbols

有人用 Symbol Device SDK 做过开发吗？我想获取设备序列号并将其写入注册表中的一个值。

Symbol SDK 是否为您提供了获取设备序列号的便利？如果是这样，你知道这个类叫什么吗，因为 SDK 包中有很多？

欢迎任何帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T11:56:21.020

我把你的问题标题输入谷歌，[第一场比赛](http://www.pocketpcdn.com/articles/serial_number.html)说

> Symbol 支持团队写道，Symbol PPT 设备支持可以使用 RCM_GETUNIQUEUNITID 函数读取的序列号。

谷歌搜索 RCM_GETUNQUEUNITID 然后让我找到[它](http://forums.devbuzz.com/fb.aspx?m=17996)，它有源代码来检索 ID。

# internet-explorer - Internet Explorer 提交错误的按钮

> ID：368114
> 
> 赞同：1
> 
> 时间：2008-12-15T11:46:39.793
> 
> 标签：internet-explorer, xhtml

我有一个带有两个按钮的 HTML 表单，如下所示：

```
<input type="submit" name="confirm" value="Yes, Delete"  />
<button name="confirm" type="button" onclick="history.back()" value="No, Go Back">No, Go Back</button> 
```

现在，当我在 Firefox 中单击任何一个时，行为都符合预期。如果我单击提交按钮，则会发布“是，删除”，如果我单击“否，返回”，就好像我点击了浏览器上的后退按钮。但是，在 Internet Explorer（6 或 8）中，如果我单击“是，删除”，则会发布“否，返回”。这是为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T23:27:58.677

Firefox、Safari、Chrome、Opera***都玩***“***第一局胜***”的游戏，而 IE 玩的是“*最后一局胜*”的游戏。

（[请参阅此处的错误/功能报告](http://webbugtrack.blogspot.com/2008/06/bug-or-feature-round-three.html)）

一般来说，除非它们是单选/复选框集的一部分，否则我会以不同的方式命名按钮。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T11:52:22.963

因为名称为“confirm”的控件的值是“No, Go Back”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T11:59:30.047

`<button>`仅供参考，在 Internet Explorer（甚至 IE7）中有多个元素存在问题。例如，查看[此处](http://www.dev-archive.net/articles/forms/multiple-submit-buttons.html)和[此处](http://www.peterbe.com/plog/button-tag-in-IE)。

我在尝试制作具有三个`<BUTTON>`元素的“保存/更新/删除”页面时发现了这一点 - 在 Firefox 中完美运行......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T11:53:40.823

我相信这是因为两个按钮的名称相同。第二个按钮必须“覆盖”第一个按钮的属性。无论如何，更改第二个按钮的名称解决了这个问题。

# c++ - 释放不会释放 Windows/C++ 应用程序中的内存

> ID：368117
> 
> 赞同：4
> 
> 时间：2008-12-15T11:49:31.690
> 
> 标签：c++, windows, winapi, memory-management, memory-leaks

我的 Windows/C++ 应用程序使用操作员在内存中分配 ~1Gb 的数据`new`并处理这些数据。处理后数据被删除。

我注意到，如果我在不退出应用程序的情况下再次运行处理，则对操作员的第二次调用以`new`分配 ~1Gb 的数据会失败。

我希望 Windows 能够将内存返回。这可以通过其他一些 Win32 调用等以更好的方式进行管理吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T11:53:30.247

我认为这不是 Windows 问题。检查您是否正确使用了 delete 或 delete[]。如果您发布分配/释放内存的代码，也许会有所帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-15T11:55:00.120

在大多数运行时环境中，从操作系统分配给应用程序的内存保留在应用程序中，并且很少返回给操作系统。释放内存块允许您在应用程序内重用该块，但不会将其释放到操作系统以使其可用于其他应用程序。

Microsoft 的 C 运行时库尝试通过 _heapmin_region 调用 _heap_free_region 或 _free_partial_region 将内存返回给操作系统，后者调用 VirtualFree 将数据释放到操作系统。但是，如果相应区域中的整个页面不为空，则它们不会被释放。造成这种情况的一个常见原因是 C++ 容器的簿记信息和存储缓存。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T11:54:48.933

这*可能*是由于内存碎片（实际上是地址空间碎片）造成的，其中各种因素导致您的程序地址空间没有可用的 1gb 连续孔。实际上，我怀疑您的内存管理中存在错误（抱歉）-您是否通过泄漏检测运行代码？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T20:22:28.877

由于您使用的是非常大的内存块，您应该考虑使用[VirtualAlloc()](http://msdn.microsoft.com/en-us/library/aa366887(VS.85).aspx)和[VirtualFree()](http://msdn.microsoft.com/en-us/library/aa366892(VS.85).aspx)，因为它们允许您直接分配和释放页面，而无需与堆管理器交互的开销（内存和时间）。

由于您使用的是 C++，因此值得注意的是，您可以使用[Placement new](http://www.parashift.com/c++-faq-lite/dtors.html#faq-11.10)在以这种方式分配的内存中构造 C++ 对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-10T20:51:02.277

这个问题几乎可以肯定是内存碎片。在 32 位 Windows 上，您可以分配的最大连续区域约为 1.1GB（因为 EXE 中的各种 DLL 会阻止更大的连续区域可用）。如果在取消分配内存分配（或 DLL 加载，或内存映射文件）后，最终位于您之前的 1GB 区域的中间，那么将不再有 1GB 区域可用于您下次调用 new 以分配 1GB。因此它会失败。

您可以使用[VM Validator](http://www.softwareverify.com/cpp/virtual_memory/index.html)可视化此过程。

# error-handling - 为什么错误处理很重要？

> ID：368139
> 
> 赞同：13
> 
> 时间：2008-12-15T11:55:32.037
> 
> 标签：error-handling

我的任务是为我的团队编写编码指南，并且进展顺利，直到我的经理要求我写一篇解释**为什么错误处理很重要**。

我本能地知道，但我该如何用语言表达呢？

我试着先用谷歌搜索它，但结果是空的，所以我现在问我的编码向导伙伴。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-15T12:18:11.897

恕我直言......大多数程序都非常大，非常复杂并且由多人编写。这种因素的组合几乎总是会导致某种软件错误。并不是说程序员是恶意的、愚蠢的或懒惰的……只是在匆忙赶上最后期限的过程中，我们通常不会预见到用户可以对我们的程序做的每件事，而且一定会发生一些事情。

在这方面，错误处理有两个目的。

*   首先，它以一种相对友好的方式让用户知道出了问题，他们应该联系技术支持部门，或者已经通知了技术支持人员。众所周知，收到一个相当讨厌的、充满技术的通知，上面写着“对象未设置为对象的引用”之类的东西……和收到一个漂亮的弹出式窗口，上面写着“有一个问题。请联系帮助台”。

*   其次，它允许程序员添加一些细节来帮助调试问题。例如......在我的代码中，我通常编写一个自定义错误处理程序，它接受许多参数并返回一个漂亮的格式化消息，可以通过电子邮件发送给帮助台，隐藏在事件日志中，写入日志文件等。错误消息将包含尽可能多的信息，以帮助我弄清楚发生了什么，堆栈跟踪，函数参数，数据库调用......你命名它。我喜欢详细的错误消息来帮助我弄清楚实际发生了什么。用户不必看到任何内容，他们会收到上面的友好消息，让他们知道有人可以弄清楚发生了什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T12:04:18.620

错误处理很重要，因为它使代码的最终用户更容易正确使用它。另一个重要问题是它使您的代码更易于维护。错误处理使将输入规范嵌入代码变得更加容易，因此您在编写和以后维护代码时不必查找设计。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T12:01:46.283

> 为什么错误处理很重要。

因为如果你不这样做会发生什么。

如果您有能力编写编码指南，那么您应该能够处理这个问题，确定吗？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-05-11T19:07:24.863

向外行经理解释很简单：

如果您处理了错误，您的程序可能会在错误后继续运行，您的客户可能会继续工作，并且您可以提供错误发生的确切报告，以便您修复它。

如果您不处理错误，您的程序可能会崩溃，失去所有客户的工作，并且您可能不知道错误发生在哪里（前提是您不使用堆栈跟踪处理致命异常）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-12-15T21:08:00.090

错误处理如此重要的另一个重要原因是*安全性*！某些类型的错误如果处理不当，可能会使程序和底层操作系统处于易受攻击的状态。处理错误必须是一个深思熟虑的过程，因为即使处理得当，错误也可以写入日志文件或将错误消息溅到屏幕上，从而为潜在的攻击者提供非常有价值的信息，以便他们以后可以利用这些信息来利用特定的漏洞。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T12:04:50.537

首先我要问重要吗？

我见过（丑陋的）代码，其中一些错误被忽略（例如空引用）

那么处理哪些类型的错误很重要呢？

和`System.IO.FileNotFoundException`之间有很大区别`System.Data.SqlClient.SqlException``System.ApplicationException`

# asp.net-mvc - ASP.NET MVC 路由到模拟对象图遍历？

> ID：368143
> 
> 赞同：0
> 
> 时间：2008-12-15T11:56:43.220
> 
> 标签：asp.net-mvc, routing

我是 ASP.NET MVC 的新手，我发现的所有教程、示例等都非常基础。

是否有可能（如果是，一个好的设计）有这样的路线： .../Organization/10/User/5/Edit .../Organization/10/User/List

换句话说; 网址可以反映您的域模型吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T12:39:35.693

可能的，是的，路线类似于：

```
"~/Organization/{orgId}/{Controller}/{id}/{action}" 
```

它是否是一个好的设计我不能肯定地说，只是它对我来说似乎相当复杂。

如果您有多个用户表，每个公司一个，这可能是有道理的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T12:49:52.817

除非绝对必要，否则保持路由与对象模型关系**分离**。否则，您将不得不在模型的每次更改时**重写路由**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T13:42:54.223

“**如果您有多个 User 表**，每个公司一个，这可能是有道理的。” 为什么只有那时？

“~/组织/10/用户/5/编辑”

...始终为我提供组织背景。

我在第一个问题中没有这么说，但是我编写了一个操作过滤器，根据登录用户必须属于当前操作的组织的规则进行授权（因此无法查看/编辑/无论如何另一个组织的用户）。

我并不是说这是最好的解决方案，但是如果不将这个横切关注点（方面）作为一个知道组织 ID（通过操作参数）的操作过滤器来实现，您将如何优雅地解决授权问题？

正如我最初所说，我是 MVC 世界的新手，并且对答案感到非常兴奋。

# model-view-controller - 在 MVC 模型中，谁负责清理输入？

> ID：368146
> 
> 赞同：18
> 
> 时间：2008-12-15T11:58:04.980
> 
> 标签：model-view-controller

一个简单的问题：我有一个模型-视图-控制器设置，模型访问 SQL 数据库。我应该在哪一部分清理/检查格式错误的传入数据？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-15T12:14:08.647

重要的是在堆栈中保持尽可能低的错误处理，但在其他部分进行补充。如果您继续在控制器中进行清理，您可以通过将控制器换成较松的控制器来破坏模型，但您永远不能通过在堆栈中严格更高来破坏模型。保持清理在堆栈中的低位以保持一致性，并在堆栈中保持高位以获取用户反馈。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T12:09:24.943

我会说控制器应该清理输入。

模型最多应该拒绝存储无效数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T12:07:49.780

我想说控制器有责任在将数据传递给模型之前验证输入并确保数据有效。

如果发现无效数据，控制器应重定向回视图并显示相关错误消息。

如果用户没有启用 javascript 或直接发布到 url，则只能绕过视图中的验证，但是从用户体验的角度来看，视图中的一些验证更好，因为用户不需要等待在 Web 应用程序中从服务器返回。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T12:14:26.803

该模型将验证业务逻辑规则，即密码长度要求，是否允许用户执行操作。

该模型显然还应该确保与数据库的交互以安全的方式完成，这样就不可能进行 SQL 注入。

控制器应该处理将业务逻辑错误转发回视图，但也可以进行一些基本的完整性检查，即字段不为空。

我想说输出清理也应该在传递给视图之前进入控制器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T12:31:14.150

我使用两个级别的检查。我的控制器将检查应该是一个日期是一个日期、一个 int 和一个 int 等等。基本上确保它们可以用来设置我的对象的值。

然后我的域对有效值和其他业务规则等内容进行了验证。在保存或与编辑的对象交互之前，总是会检查这些。

任一级别的所有错误都会返回给用户，以便他们可以根据需要采取补救措施。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T12:08:44.087

我倾向于：

*   在视图中放置*语法*验证（“该字段是数字”，“该字段是日期”）。这通常很容易甚至隐含在您选择的视图设计中（例如：对日期字段使用日期选择器）。

*   将*语义*冲突放在单独的验证器类中（“此日期字段必须在该日期字段之后”，“如果大于零，则可以为空”）并从控制器调用验证器，将错误传递回视图展示。

（对于我自己对语法和语义的伪正确定义......）

# c# - 我需要从 MSI 源目录复制文件的 MSI 自定义操作

> ID：368154
> 
> 赞同：5
> 
> 时间：2008-12-15T12:00:00.827
> 
> 标签：c#, installation, windows-installer, custom-action

我正在使用 VS 2008 为 ac# windows 项目创建安装程序。我正在尝试编写一个自定义操作，该操作从存储在文件服务器上的 MSI 文件的源目录复制设置文件（例如 \server\fileshare\myappinstaller \mysetting.xml）复制到安装了我的应用程序的计算机上的目标目录（例如 C:\Program Files\My App）。

无法将设置文件添加到安装程序中，因为它将包含安装应用程序的客户所独有的设置。

有没有人有这种自定义操作的代码（最好是 C# 或 VB.NET）？或者，是否有人知道如何在自定义操作中获取 MSI 源位置（例如 \server\fileshare\myappinstaller）。

非常感谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-01-19T15:40:50.963

我已经通过添加解决了这个问题

> /InstallerPath="[原始数据库]"

到自定义操作的 CustomActionData（在设置项目的选项卡自定义操作中）并在自定义操作中使用此代码读取值：

```
 Public Overrides Sub Commit(ByVal savedState As System.Collections.IDictionary)
        MyBase.Commit(savedState)

        Dim directoryOfMSI As String = IO.Path.GetDirectoryName(Context.Parameters("InstallerPath"))

        'Do your work here
        '...

    End Sub 
```

再见！斯特凡

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T12:41:47.733

我建议您将 XML 文件作为要安装的组件之一添加到安装程序中。这将是最简单的方法，并且不需要自定义操作。

WiX 可能是您的选择。它允许您在安装期间使用 XmlConfig 自定义 XML 配置文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T02:05:45.003

我做了类似的事情，但在 MSI 文件中提供默认配置，然后使用 MST 添加自定义配置文件。它更可靠，因为一切都是 Windows 安装程序的“原生”，我只需要向每个客户发送一个小的自定义 MST。

有关我如何执行此操作的更多信息，请参阅[最简单的解决方案来替换 MSI 中的小文件？](https://stackoverflow.com/questions/319894/simplest-solution-to-replace-a-tiny-file-inside-an-msi)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T12:49:51.880

通常，WindowsInstaller 中的自定义操作使用 msi 表中的某些内容将某些内容放入 msi 的任何表中。

此外，WindowsInstaller-Team 拒绝安装程序的任何托管扩展，其原因在网络上随处可见。

但是，我前段时间确实想出了一个为 WindowsInstallers[创建托管自定义操作的扩展，可与](http://www.forestwalk.de/?p=31)[WiX](http://wix.sourceforge.net)一起使用，它仍然有效，但在这项工作之上还有一个更新的解决方案，一个真正的 WiX 扩展以允许托管自定义操作。

# c# - C# 将接口应用到表单类

> ID：368156
> 
> 赞同：1
> 
> 时间：2008-12-15T12:00:44.273
> 
> 标签：c#, interface

如何将接口应用于表单类

```
partial class Form1 : Form, InterfaceA 
```

这个对吗？

基本上我想在表单上实现一个接口。如何 ....

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T12:03:29.557

表单只是一个类（它是 System.Windows.Forms.Form 的子类），所以是的 - 标准语法很好，正如你所拥有的那样。

编辑：至于问题的部分类部分，不，您只需要声明您实现了一次接口。从 MSDN...

> 如果任何部分被声明为抽象的，那么整个类型都被认为是抽象的。如果任何部分被声明为密封，则整个类型被认为是密封的。*如果任何部分声明了基类型，则整个类型都会继承该类*。

请记住，表单或部分类没有魔法。C#/.Net 是为数不多的无魔法的微软项目之一——它确实倾向于按照您认为的方式行事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T12:03:52.393

是的 - 表格只是一天结束时的课程

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T12:23:42.137

在 C# 中使用部分类时，可以：

*   任何带有 ':' 运算符的声明都必须指定完全相同的基类和接口
*   在其中一个声明上指定基类和接口就足够了

为了让自己的生活更轻松，只在一个地方添加接口规范（不检查我怀疑这是在使用 WinForms 设计器时默认在设计器类部分中）。

# vba - 循环通过 PivotItems：运行时错误 91

> ID：368160
> 
> 赞同：0
> 
> 时间：2008-12-15T12:02:21.587
> 
> 标签：vba, excel

我在工作表中有一个数据集，每次都可能不同。我正在从该数据创建一个数据透视表，但其中一个 PivotItems 可能不存在。例如：

```
.PivotItems("Administratie").Visible = False 
```

如果该特定值不在我的数据集中，则 VBA 脚本将失败，说它无法在指定字段中定义项目。（错误 1004）

所以我认为循环可能会起作用。我有以下内容：

```
Dim pvtField As PivotField
Dim pvtItem As PivotItem
Dim pvtItems As PivotItems

For Each pvtItem In pvtField.pvtItems
        pvtItem.Visible = False
Next 
```

但这给了我在 For Each pvtItem 行的 91 错误：

```
Object variable or With block variable not set 
```

我以为我已经很好地声明了变量，但我很可能遗漏了一些明显的东西......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T10:00:15.607

我懂了！:D

```
Dim Table As PivotTable
Dim FoundCell As Object
Dim All As Range
Dim PvI As PivotItem

    Set All = Worksheets("Analyse").Range("A7:AZ10000")
    Set Table = Worksheets("Analyse").PivotTables("tablename")
    For Each PvI In Table.PivotFields("fieldname").PivotItems
        Set FoundCell = All.Find(PvI.Name)
        If FoundCell <> "itemname" Then
            PvI.Visible = False
        End If
    Next 
```

呜呼

多亏了 Excel 先生，答案*就在*那里，尽管被深深地埋没了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T12:25:11.477

尝试这样的事情：

```
Public Function Test()
    On Error GoTo Test_EH

    Dim pvtField As PivotField
    Dim pvtItem As PivotItem
    Dim pvtItems As PivotItems

    ' Change "Pivot" to the name of the worksheet that has the pivot table.
    ' Change "PivotTable1" to the name of the pivot table; right-click on the
    ' pivot table, and select Table Options... from the context menu to get the name.
    For Each pvtField In Worksheets("Pivot").PivotTables("PivotTable1").PivotFields
        Debug.Print "Pivot Field: " & pvtField.Name
        For Each pvtItem In pvtField.VisibleItems
            pvtItem.Visible = False
        Next
    Next

Exit Function

Test_EH:
    Debug.Print pvtItem.Name & " error(" & Err.Number & "): " & Err.Description
    Resume Next

End Function 
```

如果你想要一个函数来测试一个数据透视项的存在，你可以使用这样的东西：

```
Public Function PivotItemPresent(sName As String) As Boolean
    On Error GoTo PivotItemPresent_EH

    PivotItemPresent = False

    For Each pvtField In Worksheets("Pivot").PivotTables("PivotTable1").PivotFields
        For Each pvtItem In pvtField.VisibleItems
            If pvtItem.Name = sName Then
                PivotItemPresent = True
                Exit Function
            End If
        Next
    Next

    Exit Function

PivotItemPresent_EH:
    Debug.Print "Error(" & Err.Number & "): " & Err.Description
    Exit Function

End Function 
```

您可以像这样从代码中调用它：

```
If PivotItemPresent("name_of_the_thing") Then
    ' Do something
End If 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T11:12:05.650

```
For Each pvtField In Worksheets("my_sheet").PivotTables("my_table").PivotFields
    For Each pvtItem In pvtField.PivotItems
        Debug.Print vbTab & pvtItem.Name & ".Visible = " & pvtItem.Visible
        /*.PivotItems(pvtItem).Visible = False*/ 
    Next
Next
.PivotItems("certain_Item").Visible = True 
```

那仍然行不通……所有变量仍然可见。没有显示错误，它编译但值仍然存在。
我添加的注释行是我自己的“发明”，但它无效。

编辑：快速问题：我可以使用 IF 语句来检查某个 PivotItem 是否实际上在 PivotTable 数据中？就像是

```
If PivotItem("name_of_the_thing") = present Then {
    do_something()
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T12:18:45.220

您不能在“ ”块`.PivotItems(pvtItem).Visible`之外说“” 。改为`With`“ ”。`pvtField.PivotItems(pvtItem.Name).Visible = False`

我还编辑了我的原始答案，以包括 Excel 无法设置 Visible 属性时的错误处理。发生这种情况是因为 Pivot 表需要至少一个行字段、一个列字段和一个数据项，因此不能使每一个中的最后一个不可见。

尝试访问已经不可见的数据透视项目时，您还会收到 1004 错误；我想你可以忽略这些。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T14:30:48.463

当我实现帕特里克发布的代码时， -

> 无法设置 PivotItem 类的可见属性

- 抛出错误。

微软承认有一个错误：[M$ help](http://support.microsoft.com/default.aspx?scid=kb;en-us;114822&Product=xlw)
但是只是隐藏线路......当然不是一种选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T08:23:05.723

错误在循环结束时抛出。
我将帕特里克的两个答案合并为以下内容：

```
With ActiveSheet.PivotTables("Table").PivotFields("Field")

    Dim pvtField As Excel.PivotField
    Dim pvtItem As Excel.PivotItem
    Dim pvtItems As Excel.PivotItems

    For Each pvtField In Worksheets("Sheet").PivotTables("Table").PivotFields
        For Each pvtItem In pvtField.PivotItems
            If pvtItem.Name = "ItemTitle" Then
                pvtField.PivotItems("ItemTitle").Visible = True
            Else
                pvtField.PivotItems(pvtItem.Name).Visible = False
            End If
        Next
    Next
End With 
```

如果 Item 与特定字符串匹配，则将该 Item 设置为 True。别的; 项目集 False。在 False 条件下，将引发错误。
我知道 True 条件只有一个匹配项。虽然当我通过宏“F8”时，从来没有输入真正的条件......

这解释了错误，一切都设置为 False。（感谢帕特里克！）

*让我想到这个问题...... PivotItem*到底是什么？

**事情的想法：**
它解决（或应该解决）以下问题：一组具有可变大小的数据，对于这个特定的表，一个列是感兴趣的。从该列中，我需要一个值的计数并将其放入表中。表是有条件的，还需要与其他列组合，所以数据透视表是最好的解决方案。
问题是：在某些数据集中没有出现一个特定的值。DO 出现的值每次都不一样。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T12:19:55.683

PivotItems 是字段（列、行、数据）中的单个值。我将它们视为包含您要聚合的所有单个数据项的“存储桶”。

无需浏览所有数据透视表字段（列、行和数据），您只需浏览您感兴趣的字段。例如，此代码将仅显示指定字段的指定数据透视项：

```
Public Sub ShowInPivot(Field As String, Item As String)
    On Error GoTo ShowInPivot_EH

    Dim pvtField As PivotField
    Dim pvtItem As PivotItem
    Dim pvtItems As PivotItems

    For Each pvtItem In Worksheets("Pivot").PivotTables("PivotTable1").PivotFields(Field).PivotItems
        If pvtItem.Name = Item Then
            pvtItem.Visible = True
        Else
            pvtItem.Visible = False
        End If
    Next

    Exit Sub

ShowInPivot_EH:
    Debug.Print "Error(" & Err.Number & "): " & Err.Description
    Exit Sub

End Sub 
```

假设我有一个数据透视表，显示每个客户发布的问题计数以及在我们的 SDLC 中检测到的问题。“客户”和“发布”是列字段，“阶段”是行字段。如果我想在 QA 期间将数据透视表限制为对 CustomerA 的问题进行计数，版本 1.2 我可以像这样使用上面的子：

```
ShowInPivot "Customer", "CustomerA"
ShowInPivot "Release", "1.2"
ShowInPivot "Phase", "QA" 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-13T01:17:34.050

尝试将数据透视项设置为可见的真假时，我也有相同的错误消息..这以前有效，但不再有效...我正在比较两个值，并且没有明确地将字符串更改为整数以进行比较..这样做会使错误消失..

..因此，如果您收到此消息，请检查是否有任何正在比较的值以使项目可见或不被正确比较..否则，pivotitem 为 null 并且它不能使其可见或不可见。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-10-12T21:25:58.667

我在这一行遇到了一个错误，提示“无法设置数据透视项目类的可见属性”：

```
For Each pi In pt.PivotFields("Fecha").PivotItems
    If pi.Name = ffan Then
        pi.Visible = True
    Else
        pi.Visible = False '<------------------------
    End If
Next pi 
```

然后我在互联网上读到我必须手动排序然后清除缓存。我这样做了，但错误仍然出现.....然后我读到这是因为我在该数据透视字段上有日期所以我将它更改为我的列到一般数字然后我想设置可见的日期我将其更改为一般号也。那么没问题!!!!!!!!!!!!!!!....在这里....我希望这会有所帮助，因为我很绝望！

```
Dim an As Variant
an = UserForm8.Label1.Caption 'this label contains the date i want to see its the pivot item i want to see of my pivot fiel that is "Date"
Dim fan
fan = Format(an, "d m yyyy")  
Dim ffan
ffan = Format(fan, "general number")

Sheets("Datos refrigerante").Activate 'this is the sheet that has the data of the pivottable
Dim rango1 As Range
Range("B1").Select
Range(Selection, Selection.End(xlDown)).Select

Set rango1 = Selection
ActiveSheet.Cells(1, 1).Select
rango1.Select

Selection.NumberFormat = "General" 'I change the format of the column that has all my dates

'clear the cache
Dim pt As PivotTable
Dim ws As Worksheet
Dim pc As PivotCache

'change the settings
For Each ws In ActiveWorkbook.Worksheets
    For Each pt In ws.PivotTables
        pt.PivotCache.MissingItemsLimit = xlMissingItemsNone
    Next pt
Next ws

'refresh all the pivot caches
For Each pc In ActiveWorkbook.PivotCaches
  On Error Resume Next
  pc.Refresh
Next pc

'now select the pivot item i want
Dim pi As PivotItem

Set pt = Sheets("TD Refrigerante").PivotTables("PivotTable2")

'Sets Pivot Table to Manual Sort so you can manipulate PivotItems in PivotField
pt.PivotFields("Fecha").AutoSort xlManual, "Fecha"

'Speeds up code dramatically
pt.ManualUpdate = True

For Each pi In pt.PivotFields("Fecha").PivotItems
    If pi.Name = ffan Then
        pi.Visible = True
    Else
        pi.Visible = False
    End If
Next pi

pt.ManualUpdate = False
pt.PivotFields("Fecha").AutoSort xlAscending, "Fecha" 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-02-17T09:05:37.153

使用**Caption**而不是**Name**。

```
For Each pvtItem In ActiveSheet.PivotTables("PivotTable1").PivotFields("Something").PivotItems
    If Not pvtItem.Caption = "Example" Then
       pvtItem.Visible = False
    End If
Next 
```

# asp.net-mvc - 在 vb.net 中将 MVC 路由器的 ID 从整数更改为字符串

> ID：368167
> 
> 赞同：1
> 
> 时间：2008-12-15T12:06:15.527
> 
> 标签：asp.net-mvc, vb.net, routing

我正在查看一些页面，我注意到默认情况下，控制器/动作/ID 的路由中的 ID 是整数而不是字符串。

我怎样才能改变它，使它成为一个字符串？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T12:24:58.327

纯粹通过创建这样的动作：

```
Public Function MyAction(ByVal id as String) as ActionResult 
```

该框架会`MyController/MyAction/SomeId`为您转换 url。通常它会将最后一部分转换为整数，因为这就是您的方法的定义方式，没有什么可以阻止您说它是一个字符串，因此不需要转换。

# c# - ASP.net 页面中的条件逻辑

> ID：368169
> 
> 赞同：8
> 
> 时间：2008-12-15T12:07:09.283
> 
> 标签：c#, asp.net, conditional

我有一些代码可以将数据库值打印到 asp.net 页面上的转发器控件中。但是，返回的一些值是 null/空白 - 当有空格时，这会使结果看起来很难看。

您如何在asp.net 控件中执行条件逻辑，即打印出一个值（如果存在），否则就转到下一个值。

我还应该补充一点——我希望标记也是有条件的，就好像没有值我也不想要
标签一样。

下面是一段代码，只是为了显示我从数据库中获取的值的类型。（**地址 2**根本没有值是很常见的）。

```
<div id="results">
    <asp:Repeater ID="repeaterResults" runat="server">
        <ItemTemplate>
             Company:      <strong><%#Eval("CompanyName") %></strong><br />
             Contact Name: <strong><%#Eval("ContactName") %></strong><br />
             Address:      <strong><%#Eval("Address1")%></strong><br />                    
                           <strong><%#Eval("Address2")%></strong><br />.................. 
```

非常感谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-15T13:56:59.313

我建议将每个键/值对包装到具有 2 个属性的自定义控件中。仅当 value 不为空时，此控件才会显示自身：

```
 <%@ Control Language="C#" AutoEventWireup="true" CodeBehind="ShowPair.ascx.cs" Inherits="MyWA.ShowPair" %>

<% if (!string.IsNullOrEmpty(Value))
   { %>
<%=Key %> : <%=Value %>
<% } %> 
```

然后将控件放入转发器模板中：

```
<asp:Repeater runat='server' ID="repeater1">
     <ItemTemplate>
        <cst:ShowPair Key="Company Name:" Value="<%#((Company)Container.DataItem).CompanyName %>" runat="server"/>
        <cst:ShowPair Key="Contact Name:" Value="<%#((Company)Container.DataItem).ContactName %>" runat="server" />
        <cst:ShowPair Key="Address 1:" Value="<%#((Company)Container.DataItem).Address1 %>" runat="server" />
     </ItemTemplate>
    </asp:Repeater> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T12:32:01.090

这将是一个非常主观的问题，因为它完全取决于您喜欢在哪里以及如何处理空值/空白值，以及实际上您正在处理这两个值中的哪一个。

例如，有些人喜欢在数据库级别处理空值，有些人喜欢在业务逻辑层编写默认值，而另一些人喜欢在 UI 上处理默认/空白值——更不用说介于两者之间的过多选项了。

无论哪种方式，我个人的选择是确保在 UI 级别显示该字段没有可用的数据，以避免混淆。最坏的情况是：

```
<strong><% If (Eval("Address2").Length > 0) Then %><%#Eval("Address2")%><% Else %>No data available for Address 2<% End If %></strong><br /> 
```

这样至少用户知道没有可用的数据，而不是不知道是否存在一些系统/管理错误。

希望有帮助:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T12:38:19.453

有可能做到这一点，我通常使用转发器的事件 OnItemDataBound 事件，该事件在转发器的项目绑定到数据项时发生。

为了解释 OnItemDataBound 事件，我们假设我们有一个中继器，其中一个始终显示的字段（名称）和一个在不为空时显示的可选字段（可选）。此外，如果可选字段为空或空，我们希望显示一些预定义的值。
为此，我们首先需要将转发器的 OnItemDataBound 事件设置为指向一个方法，并构建转发器的项目模板。我们可以在转发器的项目模板中使用任何服务器控件，稍后我们可以在 OnItemDataBound 方法中引用这些控件。

```
<asp:Repeater ID="repeaterResults" runat="server"   OnItemDataBound="repeaterResult_ItemDataDataBound">
    <ItemTemplate>
    <strong><%#Eval("Name") %></strong>
    <asp:Literal runat="server" ID="ltlOption" />
    <br />
    </ItemTemplate></asp:Repeater> 
```

进一步假设我们将绑定一个简单对象的集合，这些对象具有两个属性：Name 和 Option，如下所示：

```
public class SimpleEntity
{
    public string Name {get;set;}
    public string Option {get;set;}
} 
```

接下来我们将实现repeaterResult_ItemDataDataBound方法如下：

```
protected void repeaterResult_ItemDataDataBound(object sender, RepeaterItemEventArgs e)
{
  SimpleEntity ent = e.Item.DataItem as SimpleEntity;
  Literal ltlOption = e.Item.FindControl("ltlOption") as Literal;
  if (ent != null && ltlOption != null)
  {
     if (!string.IsNullOrEmpty(ent.Option))
     {
        ltlOption.Text = ent.Option;
     }
     else
     {
        ltlOption.Text = "Not entered!";
     }

  }
} 
```

实现上述方法后，如果存在，我们将显示可选字段，而如果可选字段为空或空字符串，我们将显示预定义的字符串“未输入！”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T12:36:18.803

您可以使用 IsDBNull(obj)

```
If IsDbNull(<%#Eval("Address2")%>) then
     etc
End If 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-02-20T14:29:55.653

我意识到这是一个非常古老的问题，但我想补充一点，也许处理这个问题的最佳方法更多的是在数据库级别，是的 - 我知道 OP 没有指定任何类型的数据源.

我只是假设（是的 - 你和我的屁股）当前使用的语言至少是 Transact SQL。

为此，我倾向于使用数据源来产生复合字段。在地址的情况下，[`ISNULL`](https://docs.microsoft.com/en-us/sql/t-sql/functions/isnull-transact-sql)会很高兴地测试查看哪些字段正在使用，如果遇到 NULL 字段，则返回默认值。最重要的是，可以包含分隔符以允许在目标输出媒体中换行。一种选择是使用逗号 + 一个空格作为分隔符`', '`。

```
SELECT 
    ISNULL(src.address1 + ', ', '') +
    ISNULL(src.address2 + ', ', '') +
    ISNULL(src.address3 + ', ', '') +
    ISNULL(src.address4 + ', ', '') +
    ISNULL(src.postalcode, '') AS CompoundAddress
... 
```

这通过使用`NULL`自身来起作用 - 添加到`NULL`返回 a `NULL`，因此返回的值将包含我们的逗号 + 空格或者它将返回一个空字符串。

可以做类似的事情来“欺骗”Microsoft Access 生成您的地址字段......

```
SELECT 
    (src.address1 + ', ') & 
    (src.address2 + ', ') & 
    (src.address3 + ', ') & 
    (src.address4 + ', ') & 
    (src.postalcode) As CompoundAddress
... 
```

在这种情况下，与号将转换`NULL`为空字符串，但同样适用于将字符串添加到潜在`NULL`字段。

所以现在，我们可以在 HTML 中正确输出我们的地址...

```
<div id="results">
    <asp:Repeater ID="repeaterResults" runat="server">
        <ItemTemplate>
            Company:      <strong><%#Eval("CompanyName") %></strong><br />
            Contact Name: <strong><%#Eval("ContactName") %></strong><br />
            Address:      <strong><%#Eval("CompoundAddress").ToString().Replace(", ", "<br />") %></strong><br /> 
```

# .net - 在 ASP.net 中按属性查找 XmlNode

> ID：368170
> 
> 赞同：0
> 
> 时间：2008-12-15T12:07:10.907
> 
> 标签：.net, xml, xpath

我正在尝试编写一些代码来根据 XML 站点地图中的 URL 查找特定的 XmlNode 对象，但无法让它找到任何东西。

该站点地图是标准的 ASP.net 站点地图，包含：

```
<siteMapNode url="~/lev/index.aspx" title="Live-Eye-Views">
--- Child Items ---
</siteMapNode> 
```

我用来搜索元素的代码是：

```
XmlDocument siteMapXml = new XmlDocument();
siteMapXml.Load(AppDomain.CurrentDomain.BaseDirectory + _siteMapFileName)
XmlNode levRoot = siteMapXml.SelectSingleNode("siteMapNode[@url=\"~/lev/index.aspx\"]"); 
```

levRoot 对象始终为空。当我在 Load 方法之后中断时，我可以看到 XML 文件中的所有元素，因此它按预期加载。

我尝试在 XPath 查询中使用单引号，但这并没有什么不同。

_siteMapFileName 在 Initialize 方法中设置并指向正确的文件。

有没有人知道这可能会发生什么或建议另一种按属性查找特定元素的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T12:37:54.977

站点地图有一个默认名称空间，但您不引用它。

```
<siteMap xmlns="http://schemas.microsoft.com/AspNet/SiteMap-File-1.0" >
  <siteMapNode url="~/lev/index.aspx" title="Live-Eye-Views">
    <!-- Child Items -->
  </siteMapNode>
</siteMap> 
```

所以，你应该使用这个：

```
XmlNamespaceManager nsmgr = new XmlNamespaceManager(siteMapXml.NameTable);
nsmgr.AddNamespace("smap", "http://schemas.microsoft.com/AspNet/SiteMap-File-1.0");
string xpath = "//smap:siteMapNode[@url=\"{1}\"]";
string url = "~/lev/index.aspx";
XmlNode levRoot = siteMapXml.SelectSingleNode(String.Format(xpath, url), nsmgr); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T12:11:38.417

尝试将“//”添加到 XPath 查询的开头，这样它将匹配*任何*带有正确 url 的 siteMapNode 元素，而不仅仅是顶级的那些。

（我不熟悉 ASP.NET 站点地图 XML 格式，所以这可能没有任何区别......）

编辑：我建议您使用 XPath 测试工具（周围有很多 - 我自己没有使用它们，因为我很少需要 XPath 表达式）。它们将让您加载文档，然后向您展示 XPath 正在做什么。*看起来*不错，所以很奇怪...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T12:12:45.217

看起来不错afaik，您是否尝试过使用类似的xpath：

**//**siteMapNode[@url="~/lev/index.aspx"]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T12:41:15.020

站点地图文件包含顶级“siteMap”节点，该节点可以包含单个“siteMapNode”节点。该“siteMapNode”可以包含任意深度的子“siteMapNode”节点树。

虽然添加“//”将确保节点获得匹配，但这是一个草率且危险的习惯。如果您知道在 XML 文档中可以找到节点的位置，那么通常最好进行更明确的匹配。

在这种情况下，假设您想要的节点位于树的顶部，您想要的 XPath 可能是**"siteMap/siteMapNode/siteMapNode[@url=\"~/lev/index.aspx\"]"**。

# arrays - 在未排序的数组中找到小于平均值的差异？

> ID：368176
> 
> 赞同：0
> 
> 时间：2008-12-15T12:12:43.437
> 
> 标签：arrays, algorithm

我需要在未排序的数组中找到 2 个元素，使它们之间的差异小于或等于（最大值 - 最小值）/（数组中的元素数）。

在 O(n) 中。

我知道最大值和最小值。

有人能想到什么吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T16:31:33.260

第 1 步：使用[桶排序](http://en.wikipedia.org/wiki/Bucket_sort)。不要对单个存储桶进行排序。

应该很明显从这里做什么，以及如何调整桶的大小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T21:47:28.630

1.  桶数 = `2n`.

    每个桶中的值 =`(min + k((max-min)/2n)) <= value < (min + (k+1)((max-min)/2n)).`

    0 <= k < 2n

    每个桶的范围=`((max-min)/2n)`

2.  将每个元素分配到桶中。不要在桶内排序。

3.  如果任何桶有超过 1 个元素，它们之间的最大可能差异为`((max-min)/2n)`。因此你有你的答案。

4.  如果任何两个连续的桶每个都有超过零个元素，它们之间的最大差异是`((max-min)/2n)*2 = ((max-min)/n)`。因此你有你的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-12-04T12:45:02.433

正确的问题应该是：在数组 A=[a0,a2,..an] 中找到两个元素 a, b 使得它们之间的差小于或等于： (Mm)/n > | a - b| 其中 M=max(A) 且 m = min(A)。

我建议的解决方案是使用 quickSelect，期望的时间复杂度为 O(n)。实际最坏的情况是 O(n^2)。这是一个权衡，因为大多数时候它是 O(n)，但它需要 O(1) 的空间复杂度（如果 quickSelect 是迭代实现的，并且我的伪代码是用 while 循环而不是递归实现的）。

**主要思想：**`|max - medianValue | > |min - medianValue |`在每次迭代中，如果我们知道应该搜索数组的左侧，我们就会 使用 quickSelect 找到中值。那是因为我们在两边都有相同数量的元素，但中值更接近最小值，因此应该存在它们之间差异较小的元素。否则我们应该在右侧搜索。

每次我们这样做时，我们都知道 subArray 的新最大值或最小值应该是中位数。我们继续搜索，每次将数组的大小除以 2。

**预期中的运行时证明：** 假设对 n 个元素的每次迭代都在预期中采用 c*n + d。因此我们有：

(c *n + d) + 0.5* (c *n + d) + 0.25* (c*n + d) + … +(1/log_{2}(n)) *(c* n + d) <=

<=(1+0.5+0.25+….)d + (c*n + 0.5*c *n +….) = (1+0.5+0.25+….)d + c* n(1+0.5+0.25+… .) =

=2*d +2*c*n

意味着我们有 O(n) 的期望。

**使用递归的伪代码：**

```
run(arr):
   M = max(arr)
   m = min(arr)
   return findPairBelowAverageDiff(arr,0,arr.length,m,M)

findPairBelowAverageDiff(arr, start, end,  min,  max) :
      if start + 1 < end:
            medianPos = start + (end - start) / 2
         // median that is between start and end in the arr.
            quickSelect(arr,  start,  medianPos,  end)
            if max - arr[medianPos] > arr[medianPos] - min:
                return findPairBelowAverageDiff(arr, start, medianPos, 
                                min, arr[medianPos])
            else :
                return findPairBelowAverageDiff(arr, medianPos, 
                                        end, arr[medianPos], max);
       else :
            return (arr[start],  arr[start + 1]) 
```

# .net - 有没有办法防止 Reflector 能够反映我的源代码？

> ID：368180
> 
> 赞同：7
> 
> 时间：2008-12-15T12:13:45.153
> 
> 标签：.net, reflector, disassembly

有没有办法（可靠的，最好不是商业的）防止 Reflector 反映我的源代码？？？

谢谢，阿迪

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T12:15:46.740

不会。Reflector 会像 .NET 运行时一样查看您的程序集，以便生成要执行的本机代码。您可能希望的最好结果是[混淆](https://stackoverflow.com/questions/2525/best-net-obfuscation-toolsstrategy)您的代码并使其（有点）更难让读者理解。

执行混淆的一些优点和缺点可以在[您是否混淆商业 .Net 应用程序中找到？](https://stackoverflow.com/questions/71195/should-you-obfuscate-a-commercial-net-application)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T13:41:51.933

没有办法阻止.net 代码的反编译，也就是说一个好的混淆器会使反射代码更难阅读，其中一些像 dotfuscator 会阻止反射器显示 C# 代码；但是，您将始终能够看到 IL。

Dotfuscator 中的选项之一是使用不可打印的名称（反射器上的反射）这使得反编译极其困难恕我直言。

Microsoft 曾经出售软件保护和许可服务，该服务将加密 IL 并使用与加密密钥绑定的自定义 VM，从而防止使用传统工具进行反射。这会带来巨大的性能成本，但是如果您想保护关键算法或例如您的许可代码，这很好。

[http://msdn.microsoft.com/en-us/slps/default.aspx](http://msdn.microsoft.com/en-us/slps/default.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T12:23:57.987

试试dotfuscator。2005/2008 带有社区版。未能重新架构您的代码（痛苦），即.NET 组件（公共）调用的 ATL/COM 对象（私有）。

选择是你的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T13:47:31.857

如果你正在寻找一个好的混淆器，试试[RemoteSoft](http://www.remotesoft.com)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-10T08:00:21.703

不久前有一个有效的反反射器技巧，因为 .NET 反射器无法将特定的 IL 指令转换为 c# 代码，但他们已经发布了补丁，乐趣结束了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-10T08:07:12.483

[Xheo Codeveil](http://www.xheo.com/products/codeveil/)也是一款很棒的产品。他们还有一个许可解决方案（用于创建序列号等，然后通过您自己的激活服务器激活它们0

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-08-11T05:02:59.413

Reflector 不使用反射来显示您的源代码。它使用 .Net 元数据（采用众所周知的发布格式）来做到这一点。

没有办法阻止这种情况，但你通过混淆你的程序集使它变得毫无意义。混淆后，类/方法/字段被重命名，方法中的内联字符串被加密，方法调用被隐藏，方法控制流被打乱等等。因此，任何使用 Reflector 的人都会看到很多垃圾，并且无法理解其中的大部分内容。

[免责声明：我为Crypto Obfuscator](http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm)的开发人员 LogicNP Software 工作

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-09-29T18:17:54.253

或者，您可以使用本机 C++ 应用程序引导您的 .Net 应用程序。然后，您可以对所有 .net dll 文件进行混淆和加密。

使用 bootstrap c++​​ 应用程序将所有文件解密为基于内存的字节数组（它们的物理自身的精确副本）。

我这样做的方法是将我所有的 .net 文件保存在一个带有 .DAT 扩展名的加密文件中。C++ 代码将文件抓取到内存映射文件中，然后使用 CLR 托管 API 将我的 Native C++ 应用程序转换为 .net 应用程序，然后我使用 load 使用

Assembly.Load(byte[]...)

所以在我的应用程序中，我避免创建一个 .net EXE 并将我的 C++ 应用程序设为 EXE，因此我的所有表单、控件等都存在于一个 .Net Dll 中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-27T19:11:35.867

免责声明：我不为 SmartAssembly 的制造商 RedGate 工作。我只是一个非常高兴的客户，他找到了一个好的、负担得起的解决方案。

选择很简单，选择SmartAssembly！不要在市场上的其他混淆器上浪费您的时间或金钱。我在评估竞争产品的非计费时间方面花了更多的钱。它们都有致命的缺陷，几乎无法调试。SmartAssembly 是一个易于使用、文档齐全、完善的应用程序，具有出色的支持。在他们的论坛上发布一个问题，并期望实际开发人员相当快地给出答案。

SmartAssembly 不仅仅是一个混淆器。它具有一系列功能，包括内置的、高度可定制的崩溃报告生成器，您的客户可以自动通过电子邮件发送给您。您可以在自己的服务器或 red-gates 服务器上查看这些报告。当您进行 beta 测试或向客户发布产品时，我无法告诉您这有多大用处。它还生成调试器文件，因此您可以调试您可能遇到的混淆产品的任何发布后问题。

如果您正在交付一个商业应用程序，那么将钱花在一个像样的混淆器上是有意义的。此处的错误选择可能会损害您的知识产权，或者更糟的是导致您经历令人毛骨悚然的调试。与 SmartAssembly 的成本相比，这个成本是多少？

# c++ - 在 main(...) 中捕获异常是否有意义？

> ID：368184
> 
> 赞同：11
> 
> 时间：2008-12-15T12:14:34.900
> 
> 标签：c++, exception, exception-handling

我在一个项目中发现了一些代码，看起来像这样：

```
int main(int argc, char *argv[])
{
  // some stuff

 try {
  theApp.Run();
 } catch (std::exception& exc) {
  cerr << exc.what() << std::endl;
  exit(EXIT_FAILURE);
 }
 return (EXIT_SUCCESS);
} 
```

我不明白为什么要捕获异常。如果不是，应用程序将简单地退出并打印异常。

您认为有什么好的理由在这里捕获异常吗？

* * *

编辑：我同意打印异常错误是件好事。但是，重新抛出异常不是更好吗？我有一种感觉，我们在这里吞下了它……

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-15T12:57:27.060

如果未捕获异常，则标准不定义堆栈是否展开。所以在某些平台上会调用析构函数，而在其他平台上程序会立即终止。在顶层捕获可确保始终调用析构函数。

因此，如果您不在调试器下运行，那么捕获所有内容可能是明智之举：(...) 以及 std::exception。然后，即使出现致命异常，您的应用程序代码也可以使用 RAII 进行清理。在许多此类情况下，您实际上不需要清理，因为操作系统会为您完成。但是例如，您可能更愿意在可能的情况下完全断开与远程服务的连接，并且可能存在进程外部的资源，例如命名管道/互斥锁，您更愿意破坏而不是泄漏。

在我看来，在 main 中重新抛出异常的用处有限，因为您已经丢失了最初抛出异常的上下文。我认为在调试器中捕获未捕获的异常比仅将故障记录到 std::cerr 更嘈杂，因此如果有可能丢失日志记录，则重新抛出将是明智之举。

如果您希望调试器在调试模式下捕获意外情况，在发布模式下会引发异常并最终导致退出，那么除了不捕获异常以便调试器看到它​​之外，还有其他方法可以做到这一点。例如，您可以使用断言宏。当然，如果您在 .NET 上使用 SEH，这对于意外和不可预测的情况（例如硬件异常）无济于事。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T12:17:43.397

你为什么说会打印异常？这不是 C++ 运行时的典型行为。充其量，您可以期望它的类型被打印出来。

此外，该程序会留下“失败”状态，而异常可能会导致终止通过中止状态（即退出代码中指示的信号）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-15T12:22:48.923

主函数中的 Try-catch 对调试器隐藏了异常。我会说，这不好。

另一方面，客户不应该有调试器，所以捕获异常很好。所以很好。

就个人而言，在进行发布构建时，我会在 main 函数中捕获所有异常，而在构建调试配置时我不会这样做。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-15T15:42:15.823

堆栈未展开的情况的一个简单示例：
[为什么在异常时不调用析构函数？](https://stackoverflow.com/questions/222175/why-destructor-is-not-called-on-exception)

异常可能导致应用程序终止而不是展开堆栈的情况列表。
[为什么异常时不调用析构函数？](https://stackoverflow.com/questions/222175/why-destructor-is-not-called-on-exception#222358)

如果在任何级别都没有捕获到异常并且会逃脱 main() ，那么允许实现调用 terminate() 而不是展开堆栈（是的，这也让我感到意外）。

结果，我总是在 main() 中捕获所有异常。

```
int main()
{
    try
    {
    }
    catch(std::exception const& e)
    {  /* LOG */
       // optimally rethrow
    }
    catch(...) // Catch anything else.
    {  /* LOG */
       // optimally rethrow
    }
} 
```

帮助在调试过程中发现问题。从 std::exception 派生异常，然后在 std::exception 的构造函数中粘贴断点。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-15T12:20:19.570

这是一个全局 catch 块。显示一个很好且用户理解的消息（“内部错误”）而不是神秘的异常打印输出是很常见的。这可能从特定的代码块中看不出来，但总的来说这是一个好主意。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T12:29:06.400

看看 C++ 圣经，即 Stroustrup，他有一个例子，在 Applied C++ 编程中也有重复。理由是：

```
int main(void)
{
     try
     {
          // your code 
     }
     catch ( /* YourPossibleExceptions i.e. barfs you expect may occur */ )
     {
     }
     catch ( ... ) // unexpected errors, so you can exit gracefully
     {
     }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-06T09:35:36.830

根据 Windows 规范，`main`不允许抛出。（实际上它会导致询问您是否要将错误报告发送给 Microsoft 的消息）

# php - javascript函数行为不正确

> ID：368192
> 
> 赞同：0
> 
> 时间：2008-12-15T12:18:55.890
> 
> 标签：php, javascript, easyphp

我有这个小功能

```
function makewindows(){
child1 = window.open ("about:blank");
child1.document.write("<?php echo htmlspecialchars(json_encode($row2['ARTICLE_DESC']), ENT_QUOTES); ?>");
child1.document.close(); 
} 
```

无论我尝试什么，都只是将 php 代码输出为 html 源代码，而不是 php 代码的结果。这以前工作正常，我不确定我做了什么改变导致了这种行为。

我现在已经粘贴了所有代码。调用 updateByQuery 的链接会生成错误，从而阻止正确解析 makewindows..我认为。但是，我不确定 updateByQuery 有什么问题：

```
function updateByQuery(layer, query) {
   url = "get_records.php?cmd=GetRecordSet&query="+query+"&sid="+Math.random();
   update(layer, url);
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T12:26:15.673

您最近是否将此文件从 PHP 解析文件（即 .phtml/.php）移出到 .js 文件中？请注意，您希望执行的任何 PHP 在交付给客户端之前必须由 PHP 解析器解析。如果它最初位于 .php 文件中，那么它将被解析/执行，并且工作正常。

但是，默认情况下，PHP 不解析 .js 文件。也许他们曾经是，但您的服务器管理员最近升级了一些东西，并且失去了这种行为？您可以使用本地配置文件（在 Apache 中为 .htaccess）重新启用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T12:24:33.430

在发送到浏览器之前，此代码必须位于由 PHP 解析的文件中。确保它具有“.php”扩展名（或者 Apache/（或其他）配置为通过 PHP 放置它使用的任何扩展名）。此外，请确保 PHP 安装正确且正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T12:28:50.440

**确保您从网络服务器运行页面，**如下所示：`http://localhost/yourpage.php`而不是直接从文件本身运行，如下所示：`file://yourpage.php`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T12:34:24.347

我假设您仍然将它保存在由 PHP 解析的文件中，就像其他人已经说过的那样。那么可能是这个代码片段上面的东西混淆了 php-parser，因此它无法识别 php-tag。

为了测试这一点，试着在这个函数之前输出一些其他的东西，也许只是一个评论之类的。

此外，在 client1 之前使用“var”，否则 client1 将在全局范围内。

**更新 1** 由于您尝试插入一段 php 代码并且它损坏了，那么问题是服务器没有按应有的方式解析文件。

要测试服务器是否真的解析了您的 .js 文件（我相信它不是默认设置），请创建一个新文件：**test.js**

```
<?php echo "This is a test"; ?> 
```

在浏览器中打开**test.js文件并查看页面源代码。**如果它具有 php 标签，则您的服务器不会解析 .js 文件。

**更新 2** 如果 php 在 .js 文件中工作，请尝试像这样重写函数（抱歉，我没有测试它，因为我现在无权访问 php-server）

```
<?php    
echo "function makewindows(){var child1 = window.open (\"about:blank\"); " .
"child1.document.write(\"" . htmlspecialchars(json_encode($row2['ARTICLE_DESC']), ENT_QUOTES) . "\");" . "child1.document.close(); }";    
?> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T13:35:59.900

我不确定这是否会有所帮助，但最佳实践规定，每当您使用 JavaScript 写入新窗口时，都应该打开和关闭文档。你能试试这个吗？

```
function makewindows(){
  var child1 = window.open ("about:blank");
  child1.document.open();
  child1.document.write("<?php echo htmlspecialchars(json_encode($row2['ARTICLE_DESC']), ENT_QUOTES); ?>");
  child1.document.close(); 
} 
```

# linq - 如何创建对现有记录的引用

> ID：368193
> 
> 赞同：1
> 
> 时间：2008-12-15T12:19:25.407
> 
> 标签：linq, linq-to-sql

放轻松，这是我的第一个问题:)

我已经使用 linqToSql 大约一个月了，只有这件事困扰着我......

假设我有一个名为“Customer”的实体对象和另一个名为“CustomerType”的实体对象，Customer 作为对 CustomerType 的引用。

插入客户时，我需要设置客户类型，我有我想要设置的客户类型 ID 值，所以我正在做的是：

```
if(c.CustomerTypeReference == null)
{
   c.CustomerTypeReference = new System.Data.Objects.DataClasses.EntityReference<CustomerType>
}

c.CustomerTypeReference.EntityKey = new System.Data.EntityKey("DataContext.CustomerType", "id", value); 
```

这可行，但在我看来过于复杂。有没有其他方法可以做到这一点？

请记住，我不想从数据库中获取对象 CustomerType，这个例子很简单，但我确实使用包含大约 100 个属性的对象。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T12:54:32.853

您是在使用 DBML Designer 还是手动编写了实体类？`customerTypeID`如果您正在使用设计器，我希望由于您的表有一个 customerTypeID 列，因此在您的`Customer`类中会有一个属性。您真正需要做的就是将此属性的值设置为 id 的值

```
 Customer c = new Customer();
  c.customerTypeID = value; 
```

只要您不想引用相关实体本身，这应该可以正常工作（即，您只是要保存这个特定对象，而不是立即使用它）。如果您需要引用相关实体——比如访问它们的属性——就必须从数据库中检索值。我必须查看设计器生成的代码，但我认为 id-value 列上的属性设置器不会更新实体引用，而实体引用设置器会更新 id-value 字段。

# java - Java JFrame：如何通过组件递归解析（即，如果使用 JScrollPane）

> ID：368194
> 
> 赞同：2
> 
> 时间：2008-12-15T12:19:30.320
> 
> 标签：java, swing, jscrollpane, jtextarea, tablelayout

我将[TableLayout](https://tablelayout.dev.java.net/)用于我的摇摆 GUI。最初只有一些需要的基本标签、按钮和文本字段，稍后我可以通过以下方式访问：

```
public Component getComponent(String componentName) {
    return getComponent(componentName, this.frame.getContentPane());
}

private Component getComponent(String componentName, Component component) {
    Component found = null;

    if (component.getName() != null && component.getName().equals(componentName)) {
        found = component;
    } else {
        for (Component child : ((Container) component).getComponents()) {
            found = getComponent(componentName, child);

            if (found != null)
                break;
        }
    }
    return found;
} 
```

不幸的是，我在使用 using`JScrollPane`支持滚动`JTextArea`和 JTable 之后遇到了问题，我使用了以下方法：

```
JTextArea ta = new JTextArea();
ta.setName("fooburg");
JScrollPane scr = new JScrollPane(ta);
frame.getContentPane().add(scr, "1, 1");  // EDIT: changed, tkx bruno 
```

经过建议，我已经能够通过`getComponent("fooburg")`所需的组件访问（上面的版本是最终版本）。非常感谢丹和布鲁诺！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T12:41:28.763

您需要将孩子添加到 JFrame 的内容窗格中：

```
frame.getContentPane().add(comp); 
```

如果您直接将新组件添加到 JFrame，则上面的代码永远不会用到它，因为您只是在枚举`frame.getContentPane()`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T13:02:10.250

@bruno 是对的 - 您需要将文本窗格添加到框架的内容窗格中。

有点 OT：如果您通常想要访问层次结构中的每个组件，则需要一些递归的东西 - 您当前的方法将只打印直接子名称：

```
void printNames(Component component) {
    System.out.println(component.getName());
    for (Component child : component.getComponents()) {
        printNames(child);
    }
}

void printFrameNamesComponents(JFrame frame) {
    printNames(frame.getContentPane());
} 
```

（未经测试，但类似这样。）

# multithreading - 将使用 ManualResetEvent 的异步调用实现更改为使用 Thread 方法的组合

> ID：368199
> 
> 赞同：0
> 
> 时间：2008-12-15T12:22:18.550
> 
> 标签：multithreading, .net-3.5, concurrency, asynchronous, manualresetevent

我正在寻找一种设计模式，以从使用 ManualResetEvent 切换到使用 Thread.Join 等线程方法。现在我正在进行异步调用，然后使用 ManualResetEvent 等待异步调用完成，然后再继续进行调用的线程。

我很高兴能够产生更稳定和易读的代码的任何实现。有兴趣查看使用 C# yield 关键字和 F# Async（如果有）的实现。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T14:21:24.253

看看[这里](http://wintellect.com/PowerThreading.aspx)提供的 Jeff Richter PowerThreading 库。这个库有 AsyncEnumerator 类，它利用 'yield' 关键字以同步方式执行异步操作。

有一个关于这个类的截屏视频，可以在这里找到：

[http://channel9.msdn.com/posts/Charles/Jeffrey-Richter-and-his-AsyncEnumerator/](http://channel9.msdn.com/posts/Charles/Jeffrey-Richter-and-his-AsyncEnumerator/)

希望这可以帮助。

阀门。

# wpf - 在 DocumentViewer 中禁用文本选择

> ID：368200
> 
> 赞同：7
> 
> 时间：2008-12-15T12:22:40.640
> 
> 标签：wpf, documentviewer, textselection

简单的问题。如何在 WPF 中禁用 DocumentViewer 的文本选择？这是查看器显示 XPS 文档然后可以通过鼠标突出显示文本的功能。突出显示的文本也可以复制，但我已经禁用了它。我只是不知道如何禁用突出显示。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T07:10:12.473

你可以使用 IsFocusable=false。但是搜索框也将被禁用...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T01:55:07.337

我们通过覆盖嵌入在 DocumentViewer 控件中的 ScrollViewer 的 ControlTemplate 解决了这个问题。在“Window.Resources”中插入以下样式：

```
<Style TargetType="{x:Type ScrollViewer}"  x:Key="CustomScrollPresenter">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type ScrollViewer}">
                <Grid Background="{TemplateBinding Panel.Background}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Rectangle Grid.Column="1" Grid.Row="1" Fill="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" />
                    <ScrollContentPresenter 
                        PreviewMouseLeftButtonDown="ScrollContentPresenter_PreviewMouseLeftButtonDown"
                        Grid.Column="0" 
                        Grid.Row="0" 
                        Margin="{TemplateBinding Control.Padding}" 
                        Content="{TemplateBinding ContentControl.Content}" 
                        ContentTemplate="{TemplateBinding ContentControl.ContentTemplate}" 
                        CanContentScroll="{TemplateBinding ScrollViewer.CanContentScroll}" />
                    <ScrollBar 
                        x:Name="PART_VerticalScrollBar"
                        Grid.Column="1" 
                               Grid.Row="0" 
                               Minimum="0" 
                               Maximum="{TemplateBinding ScrollViewer.ScrollableHeight}" 
                               ViewportSize="{TemplateBinding ScrollViewer.ViewportHeight}" 
                               Value="{Binding Path=VerticalOffset, Mode=OneWay, RelativeSource={RelativeSource Mode=TemplatedParent}}" 
                               Visibility="{TemplateBinding ScrollViewer.ComputedVerticalScrollBarVisibility}" 
                               Cursor="Arrow" AutomationProperties.AutomationId="VerticalScrollBar" />
                    <ScrollBar 
                        x:Name="PART_HorizontalScrollBar"
                        Orientation="Horizontal" Grid.Column="0" Grid.Row="1" Minimum="0" 
                               Maximum="{TemplateBinding ScrollViewer.ScrollableWidth}" ViewportSize="{TemplateBinding ScrollViewer.ViewportWidth}" Value="{Binding Path=HorizontalOffset, Mode=OneWay, RelativeSource={RelativeSource Mode=TemplatedParent}}" Visibility="{TemplateBinding ScrollViewer.ComputedHorizontalScrollBarVisibility}" Cursor="Arrow" AutomationProperties.AutomationId="HorizontalScrollBar" />

                </Grid>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

然后在 DocumentViewer 的 ControlTemplate 中用它覆盖 ScrollViewer 的样式：

```
 <Style
      x:Key="MyDVStyleExtend"
      BasedOn="{StaticResource {x:Type DocumentViewer}}"
      TargetType="{x:Type DocumentViewer}">

      <Setter Property="Template">                
       <Setter.Value>

          <ControlTemplate TargetType="DocumentViewer">
                        <Border BorderThickness="2,2,2,2"
                    BorderBrush="SlateBlue" Focusable="False">
              <Grid Background="{StaticResource GridBackground}" 
                KeyboardNavigation.TabNavigation="Local">
                <Grid.ColumnDefinitions>                  
                  <ColumnDefinition Width ="*"/>                                    
                </Grid.ColumnDefinitions>                

                <ScrollViewer Style="{StaticResource CustomScrollPresenter}"  Grid.Column ="0" 
                  CanContentScroll="True"
                  HorizontalScrollBarVisibility="Auto"
                  x:Name="PART_ContentHost"
                  IsTabStop="True"/>

              </Grid>
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>

    </Style> 
```

然后为 CustomScrollPresenter 样式中声明的“PreviewMouseLeftButtonDown="ScrollContentPresenter_PreviewMouseLeftButtonDown"”属性创建一个函数。

```
 private void ScrollContentPresenter_PreviewMouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {
        e.Handled = true;
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-07-04T13:38:27.300

另一种方法是添加例如停靠面板：

```
<DockPanel Name="pnlTouchTaker" 
               VerticalAlignment="Bottom" HorizontalAlignment="Left"
               Background="Transparent">
    </DockPanel> 
```

位于文档查看器“上方”并将其宽度和高度设置为滚动查看器内容的实际宽度和高度，例如页面加载事件。

如果使用缩放选项并且水平工具栏变得可见，您可能需要添加额外的逻辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-09-07T11:39:27.517

在 xaml.cs 部分中实现以下代码（DocumentViewerInstance x：您的 xaml 中 DocumentViewer 的名称。）

```
DocumentViewerInstance.GetType().GetProperty("IsSelectionEnabled", BindingFlags.Instance | BindingFlags.NonPublic).SetValue(DocumentViewerInstance, false, null); 
```

您可以使用`IsFocusable=false`or`IsHitTestVisible = false`或处理任何预览事件（例如在接受的答案中）来禁用选择，但超链接不起作用！如果设置 IsSelectionEnabled = false，则选择将被禁用，但超链接也可以使用。（警告！IsSelectionEnabled 设置为 false 后可以更改为 true 值，因此您应该经常检查该值。）

# ms-access - 根据参数的位数查询表以获取值？

> ID：368215
> 
> 赞同：0
> 
> 时间：2008-12-15T12:28:40.317
> 
> 标签：ms-access

考虑下表

我有一个大表，我可以从中查询以获取下表

```
type       no of times type occurs
101            450
102            562
103            245
111            25
112            28
113            21 
```

现在假设我想得到一个表格，它向我显示类型出现的次数总和，该类型以 1 开头，然后以 10、11、12、13.......19 开始，然后以 2、20、21 开头, 22, 23...29 等等。

像这样的东西

```
1        1331               10        1257
                            11        74
                            12         ..
                            13         ..
                            ..         ..
2        ...                20         ..
                            21         .. 
```

希望我清楚谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T14:26:19.207

你真的有两个不同的查询：

```
SELECT [type]\100 AS TypePart, Count(t.type) AS CountOftype
FROM t
GROUP BY [type]\100; 
```

和：

```
SELECT [type]\100 AS TypePart, [type] Mod 100 AS TypeEnd, 
    Count(t.type) AS CountOftype
FROM t
GROUP BY [type]\100, [type] Mod 100; 
```

其中 t 是表的名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T14:09:29.083

在第一个查询中，我得到了类似的东西

```
utypPart    CountOftype
    1   29
    2   42
    3   46
    4   50
    5   26
    6   45
    7   33
    9   1 
```

它告诉我有多少 utyp 从 1 2 等开始，但我想要的是这些类型出现在 utyp 的次数之和。

# javascript - Javascript - onchange 内

> ID：368219
> 
> 赞同：13
> 
> 时间：2008-12-15T12:30:23.993
> 
> 标签：javascript, html

我有一个相对简单的表格，它提出了各种各样的问题。其中一个问题是通过选择框回答的。我想做的是，如果该人选择了特定选项，则会提示他们提供更多信息。

在一些在线教程的帮助下，我设法让 Javascript 很好地显示隐藏的 div。我的问题是我似乎无法将事件本地化到选项标签，只有选择标签真的没用。

目前代码看起来像（简化代码以帮助清晰！）：

```
<select id="transfer_reason" name="transfer_reason onChange="javascript:showDiv('otherdetail');">
<option value="x">Reason 1</option>
<option value="y">Reason 2</option>
<option value="other">Other Reason</option>
</select>

<div id="otherdetail" style="display: none;">More Detail Here Please</div> 
```

我想要的是，如果他们选择“其他原因”，那么它会显示 div。如果 onChange 不能与 Option 标签一起使用，我不确定如何实现这一点！

非常感谢任何帮助:)

注意：当涉及到 Javascript 时，完全是初学者，如果实现起来非常简单，我深表歉意！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-15T12:34:32.880

为选择框设置`onchange`事件处理程序以查看当前选定的索引。如果所选索引是“其他原因”选项的索引，则显示消息；否则，隐藏分区。

```
 <html>
 <head>
  <script type="text/javascript">
    window.onload = function() {
        var eSelect = document.getElementById('transfer_reason');
        var optOtherReason = document.getElementById('otherdetail');
        eSelect.onchange = function() {
            if(eSelect.selectedIndex === 2) {
                optOtherReason.style.display = 'block';
            } else {
                optOtherReason.style.display = 'none';
            }
        }
    }
  </script>
 </head>
 <body>
    <select id="transfer_reason" name="transfer_reason">
        <option value="x">Reason 1</option>
        <option value="y">Reason 2</option>
        <option value="other">Other Reason</option>
    </select>
    <div id="otherdetail" style="display: none;">More Detail Here Please</div>
</body>
</html> 
```

就个人而言，我会更进一步，将 JavaScript 移动到外部文件中，然后将其包含在页面的标题中；但是，出于所有意图和目的，这应该有助于回答您的问题。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-15T13:00:48.240

在阅读了 Tom 的出色回复后，我意识到如果我在表单中添加其他选项，它就会崩溃。在我的示例中，这很有可能，因为可以使用 php 管理面板添加/删除选项。

我做了一些阅读并稍微改变了它，以便它使用**value而不是使用****selectedIndex**。

 **```
<script type="text/javascript">
window.onload = function() {
    var eSelect = document.getElementById('transfer_reason');
    var optOtherReason = document.getElementById('otherdetail');
    eSelect.onchange = function() {
        if(eSelect.value === "Other") {
            optOtherReason.style.display = 'block';
        } else {
            optOtherReason.style.display = 'none';
        }
     }
  }
  </script> 
```

希望这对将来的其他人有所帮助！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-15T13:03:20.013

汤姆的回答很优雅，并且巧妙地将 JS 与 HTML 标记分开。如前所述，它甚至可以移动到外部文件。然而，它给代码添加了很多“废话”，比如多个匿名函数分配等。

如果您想要快速解决方案，您也可以将其全部放在 select 标记内的 onchange() 中。选择你认为更合适的那个。

```
<select id="transfer_reason" name="transfer_reason" onchange="document.getElementById('otherdetail').style.display = (this.selectedIndex === 2) ? 'block' : 'none';">
    <option value="x">Reason 1</option>
    <option value="y">Reason 2</option>
    <option value="other">Other Reason</option>
</select>
<div id="otherdetail" style="display: none;">More Detail Here Please</div> 
```

# ios - 如何检查 NSTimer 是否已经失效

> ID：368253
> 
> 赞同：12
> 
> 时间：2008-12-15T12:43:11.397
> 
> 标签：ios, objective-c, iphone, cocoa-touch, nstimer

`NSTimer`如果用户点击按钮或退出视图，我需要使对象无效。

所以我有：

```
[myNSTimer invalidate]; 
```

在我的按钮处理程序和里面`viewWillDisappear`。如果用户点击按钮然后存在视图，则应用程序会抛出异常，因为`myNSTimer`已经失效。我需要在该`viewWillDisappear`方法中做的是检查是否`myNSTimer`已失效。我怎么做？

我试过了：

```
if(myNSTimer != nil)
  [myNSTimer invalidate]; 
```

但这没有用。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-15T12:47:43.693

一旦您使计时器无效，只需调用`release`它（假设您保留了您所持有的参考），然后取消您的参考。这样，当您退出视图时，再次尝试使计时器无效只会在 nil 上调用该方法，而不会执行任何操作。

或者，您可以`-[NSTimer isValid]`在无效之前检查它是否有效，但是在第一次无效之后确实没有理由保留您的参考。此外，如果你真正的问题是你没有保留你的引用，所以第一个`-invalidate`实际上给你留下了一个指向已释放对象的引用，那么调用`-isValid`无论如何也无济于事。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T13:38:21.830

我通常做的是将保存计时器的成员变量置零，无论是在它触发时，还是在我使其无效时。然后你可以这样做：

```
[myNSTimer invalidate]; 
myNSTimer = nil; 
```

它会做正确的事。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-11T08:40:22.310

我在尝试暂停和重新启动计时器时遇到了同样的问题。要停止它：

```
[timer invalidate];
[timer release];
timer = nil; 
```

并启动/重新启动它：

```
timer = [[NSTimer scheduledTimerWithTimeInterval:3 target:self selector:@selector(aSelector) userInfo:nil repeats:YES] retain]; 
```

现在，当我使其无效时它不会崩溃。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-04-19T23:13:31.113

迅速：

```
if timer.valid {
   timer.invalidate()
} 
```

# java - 当一个错误没有使程序崩溃时是什么意思

> ID：368260
> 
> 赞同：0
> 
> 时间：2008-12-15T12:45:28.020
> 
> 标签：java, eclipse, crash

有时 Eclipse 会说“嘿，你应该调试这条线！！！” 但实际上并没有关闭程序。然后我可以继续玩大二，甚至经历第一次导致错误的相同事件并弹出另一个错误框！

这个bug很简单，我会修复它，我只想知道为什么有些bug是终端的，有些不是？有什么不同？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T12:53:25.790

编程错误可分为以下几类：

1.  编译时错误，编译器在编译时捕获并且不纠正它们，根本不可能运行程序。
2.  运行时错误，编译器不会捕捉到，但会使计算机处于无法自行判断该做什么的情况，例如未处理的异常。大多数时候，这会导致程序在运行时失败并崩溃。
3.  计算机完全可以接受的逻辑错误，因为它是有效的计算机程序，但不会产生您期望的结果。计算机无法捕捉到它们，因为计算机不知道您的意图。

在实践中，让错误一出现就尽可能致命是一件好事。它使我们更快地找到它们并更容易地纠正它们。这就是为什么在 Java 等“更安全”的语言中，我们检查了异常，而未处理的异常将导致应用程序立即崩溃，而不是继续运行并可能产生不正确的结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T13:02:35.927

我猜在您的情况下，这与发生异常的线程有关（您的应用程序是 GUI 应用程序，对吗？）。如果你的主线程中发生异常，它可能是终端，但如果它发生在另一个线程中，它不是终端。如果应用程序中的其他线程是守护线程，则它是主线程的终端。当线程是守护进程时，应用程序将在它们完成之前终止，无论它们的状态如何。如果它们不是守护进程，则应用程序将等待它们完成后再终止。

我不太了解 Eclipse 框架，但我想它能够处理 GUI 线程中的异常。

我包含了一个示例 Java 应用程序来说明我的示例；

```
public class ThreadTest {

    public static void main(String[] args) {

        Runnable test = new Runnable() {

            public void run() {
                try {
                    System.out.println("Sleeping");
                    Thread.sleep(5000);
                    System.out.println("Slept");
                } catch (InterruptedException e) {
                }
            }
        };

        Thread t = new Thread(test);
        //t.setDaemon(true);
        t.start();

        System.out.println("Waiting to fail");
        throw new RuntimeException("Error");
    }
} 
```

取消标记 t.setDaemon(true) 行时，您将看到行为上的差异。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T16:10:44.643

先前的答案得到了这个权利的java部分：

> 如果你的主线程中发生异常，它可能是终端，但如果它发生在另一个线程中，它不是终端。如果应用程序中的其他线程是守护线程，则它是主线程的终端。

更大的事实是，当没有非守护线程仍在运行时，运行应用程序的 JVM 将关闭。那，或者对 System.exit 的显式调用（或彻底的 JVM 崩溃）是 JVM 完全退出的唯一方式。

在许多更简单的 Java 应用程序中，只有 1 个非守护线程（JVM 在启动时开始运行 main() 的线程）。因为在简单的情况下，运行我们的代码的线程是唯一的非守护线程线程，我们得到的印象是未处理的异常导致 JVM 退出。这是不正确的，除非该线程恰好是唯一剩下的非守护线程。

您可以使用以下小程序向自己证明这一点：

```
public class TestMain {
    public static void main(String[] args) {
        Thread t1 = new Thread() {
            public void run() {
                while(true) {
                    System.out.println("A");
                    try {
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        System.out.println("t1 interrupted.");
                    }
                }
            }
        };
        t1.setDaemon(false);

        Thread t2 = new Thread() {
            public void run() {
                int count = 0;
                while(true) {
                    if(count < 5) {
                        System.out.println("B");
                        count++;
                    } else {
                        throw new RuntimeException("Intentional RuntimeException!");
                    }
                    try {
                        Thread.sleep(2000);
                    } catch (InterruptedException e) {
                        System.out.println("t2 interrupted.");
                    }
                }
            }
        };
        t2.setDaemon(false);
        t1.start();
        t2.start();
    }
} 
```

如果你运行它，你会注意到你混合了“A”和“B”，直到第 5 个“B”，此时你会得到我们抛出的异常的堆栈跟踪，以及“A”' s continue （“B”s 不继续，因为该线程由于未处理的异常而刚刚死亡。）

现在，如果您返回并更改`t1.setDaemon(false)`为`t1.setDaemon(true)`，然后再次运行，您会看到当 t2 因异常终止时，没有剩余的非守护线程，JVM 将退出。

这回答了“为什么有些错误不能关闭 JVM”的问题。但它并没有回答为什么 Eclipse 会弹出调试器的部分问题。

答案更简单（但我对此不太确定......其他人插话）：每当线程因未处理的异常而死亡时，Eclipse 调试器都会挂起。它假设您并不意味着线程死亡，并且您需要修复错误。我相信它实际上是在监视 java.lang.ThreadDeath 异常，并在它被抛出时暂停。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T13:15:59.300

例如，想象一下您的银行使用的一款软件。

在你的储蓄账户中，他们做了以下几行：

```
Account -= Interest; 
```

这显然是一个错误，但它不会使系统崩溃。

# c++ - 函数调用跳转到错误的函数

> ID：368262
> 
> 赞同：15
> 
> 时间：2008-12-15T12:47:03.010
> 
> 标签：c++, visual-studio-2008, static, stack-pointer

我正在 vs2008 中编译一个 c++ 静态库，在解决方案中我还有一个使用该库的启动项目，并且工作正常。

但是当在另一个解决方案中使用该库时，我会遇到运行时检查失败。“ESP 的值没有在函数调用中正确保存” 单步执行代码时，我注意到函数 foo() 在崩溃之前跳转到 bar()。有问题的函数只是常规函数，没有函数指针。

任何人都有任何线索可能会发生什么，以及为什么在使用同一解决方案中的库时它会起作用？

编辑：函数（方法）是类的一部分，如果有帮助的话。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-16T01:05:33.830

请原谅我在这里说明了明显的流血，但是......我已经看到这种事情发生过很多次，当对象（.o）和头（.h）文件不同步时。特别是关于虚拟方法。

考虑：目标文件是用头文件编译的：

```
class Foo { virtual void f(); }; 
```

但随后标题更改为：

```
class Foo { virtual void g(); virtual void f(); }; 
```

对于下一个目标文件，编译器关于 f() 在类的 vtable 中的位置的假设是不正确的。

通常简单地重新编译世界（一切！）会有所帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-15T13:06:21.130

这很可能是由于调用约定不兼容，库和调用者对堆栈布局有不同的想法。

查看[MSDN](http://msdn.microsoft.com/en-us/library/984x0h58(VS.80).aspx)了解更多信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T05:15:43.123

*   确保您没有在项目中选择旧版本的库，即（正如 Adam 提到的）您选择了旧的调试版本而不是当前的发布版本，反之亦然。

*   你可能需要重建。

*   还要注意条件编译，其中宏可能会在某些时候得到#defined 或#undef'd（另一种解决方案可能有一些宏或投影的#defines）。有时，删除 .lib .obj 和预编译的标头缓存以及重建可能会有所帮助。

*   在您的 IDE 或项目配置中出现问题的可能性很小，您可能需要从头开始重新创建项目。

*   我对 MS VC 不太熟悉，您可以从其他解决方案添加库的项目文件吗？例如，在 Borland C++ Builder 中，您可以定义项目组并构建/制作多个项目，我总是将我使用的库的项目放在我的程序项目组中，以便在我构建时一切都是最新的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T12:48:43.270

确保您在调试模式而不是发布模式下编译。如果您尝试在 Release 模式下调试程序，由于优化，您从调试器返回的数据将是垃圾。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T13:10:04.320

我记得当二进制文件的结构成员对齐（/Zp 编译器开关）不同时看到这样的事情。你也可以检查一下。

通过#pragma pack 设置它而不是通过项目设置应该更安全。

# .net - .NET 的简单事件总线

> ID：368265
> 
> 赞同：23
> 
> 时间：2008-12-15T12:49:17.623
> 
> 标签：.net, generics, events, c#-2.0, bus

我想制作一个非常简单的事件总线，它允许任何客户端订阅特定类型的事件，并且当任何发布者使用`EventBus.PushEvent()`方法在总线上推送事件时，只有订阅该特定事件类型的客户端才会获得该事件。

我正在使用 C# 和 .NET 2.0。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2011-12-19T10:54:29.897

Tiny Messenger 是一个不错的选择，我已经在现场项目中使用它 2.5 年了。来自 Wiki 的一些代码示例（下面的链接）：

**出版**

```
messageHub.Publish(new MyMessage()); 
```

**订阅**

```
messageHub.Subscribe<MyMessage>((m) => { MessageBox.Show("Message Received!"); });
messageHub.Subscribe<MyMessageAgain>((m) => { MessageBox.Show("Message Received!"); }, (m) => m.Content == "Testing"); 
```

The code's on GitHub: [https://github.com/grumpydev/TinyMessenger](https://github.com/grumpydev/TinyMessenger)

The Wiki is here: [https://github.com/grumpydev/TinyMessenger/wiki](https://github.com/grumpydev/TinyMessenger/wiki)

It has a Nuget package also

```
Install-Package TinyMessenger 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-05-06T08:00:17.867

Another one, inspired by EventBus for android, but far simpler:

```
public class EventBus
{
    public static EventBus Instance { get { return instance ?? (instance = new EventBus()); } }

    public void Register(object listener)
    {
        if (!listeners.Any(l => l.Listener == listener))
            listeners.Add(new EventListenerWrapper(listener));
    }

    public void Unregister(object listener)
    {
        listeners.RemoveAll(l => l.Listener == listener);
    }

    public void PostEvent(object e)
    {
        listeners.Where(l => l.EventType == e.GetType()).ToList().ForEach(l => l.PostEvent(e));
    }

    private static EventBus instance;

    private EventBus() { }

    private List<EventListenerWrapper> listeners = new List<EventListenerWrapper>();

    private class EventListenerWrapper
    {
        public object Listener { get; private set; }
        public Type EventType { get; private set; }

        private MethodBase method;

        public EventListenerWrapper(object listener)
        {
            Listener = listener;

            Type type = listener.GetType();

            method = type.GetMethod("OnEvent");
            if (method == null)
                throw new ArgumentException("Class " + type.Name + " does not containt method OnEvent");

            ParameterInfo[] parameters = method.GetParameters();
            if (parameters.Length != 1)
                throw new ArgumentException("Method OnEvent of class " + type.Name + " have invalid number of parameters (should be one)");

            EventType = parameters[0].ParameterType;
        }

        public void PostEvent(object e)
        {
            method.Invoke(Listener, new[] { e });
        }
    }      
} 
```

Use case:

```
public class OnProgressChangedEvent
{

    public int Progress { get; private set; }

    public OnProgressChangedEvent(int progress)
    {
        Progress = progress;
    }
}

public class SomeForm : Form
{
    // ...

    protected override void OnLoad(EventArgs e)
    {
        base.OnLoad(e);
        EventBus.Instance.Register(this);
    }

    public void OnEvent(OnProgressChangedEvent e)
    {
        progressBar.Value = e.Progress;
    }

    protected override void OnClosed(EventArgs e)
    {
        base.OnClosed(e);
        EventBus.Instance.Unregister(this);
    }
}

public class SomeWorkerSomewhere
{
    void OnDoWork()
    {
        // ...

        EventBus.Instance.PostEvent(new OnProgressChangedEvent(progress));

        // ...
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T13:25:48.453

[复合应用程序块](http://msdn.microsoft.com/en-us/library/aa480450.aspx)包括一个可能对您有用的事件代理。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T15:05:45.443

我找到了*[通用消息总线](http://perrybirch.blogspot.com/2007/06/generic-message-bus.html)*。这是一门简单的课。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-05T14:56:27.750

您还可以查看 Unity 扩展：http: [//msdn.microsoft.com/en-us/library/cc440958.aspx](http://msdn.microsoft.com/en-us/library/cc440958.aspx)

```
[Publishes("TimerTick")]
public event EventHandler Expired;
private void OnTick(Object sender, EventArgs e)
{
  timer.Stop();
  OnExpired(this);
}

[SubscribesTo("TimerTick")]
public void OnTimerExpired(Object sender, EventArgs e)
{
  EventHandler handlers = ChangeLight;
  if(handlers != null)
  {
    handlers(this, EventArgs.Empty);
  }
  currentLight = ( currentLight + 1 ) % 3;
  timer.Duration = lightTimes[currentLight];
  timer.Start();
} 
```

有更好的吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-22T14:51:20.897

另一个很好的实现可以在以下位置找到：

[http://code.google.com/p/fracture/source/browse/trunk/Squared/Util/EventBus.cs](http://code.google.com/p/fracture/source/browse/trunk/Squared/Util/EventBus.cs)

用例可在以下位置访问：/trunk/Squared/Util/UtilTests/Tests/EventTests.cs

此实现不需要外部库。

改进可能是能够订阅类型而不是字符串。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T13:20:39.790

您应该查看[Hibernating Rhinos](http://ayende.com/hibernating-rhinos.aspx)中的第 3 集，Ayende 的屏幕演员系列 - “实现事件代理”。

它展示了如何使用 Windsor 来实现一个非常简单的事件代理。源代码也包括在内。

提议的事件代理解决方案非常简单，但不需要太多时间来扩充解决方案以允许参数与事件一起传递。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-25T12:30:14.937

I created this :

[https://github.com/RemiBou/RemiDDD/tree/master/RemiDDD.Framework/Cqrs](https://github.com/RemiBou/RemiDDD/tree/master/RemiDDD.Framework/Cqrs)

There is a dependancy with ninject. You got a MessageProcessor. If you want to obsere an event, implement "IObserver" if you want to handle a command implement "ICommandHandleer"

# perl - 如何按日期对 mbox 文件进行排序？

> ID：368271
> 
> 赞同：2
> 
> 时间：2008-12-15T12:52:23.593
> 
> 标签：perl, mbox

我想知道如何修改下面的代码以去除`=20`多行末尾的字符，主要是按时间顺序对消息从第一个接收或发送到最后一个进行排序。我不确定这是否是内部 Perl 例程。

```
#!/usr/bin/perl
use warnings;
use strict;
use Mail::Box::Manager;

my $file = shift || $ENV{MAIL};
my $mgr = Mail::Box::Manager->new(
    access          => 'r',
);

my $folder = $mgr->open( folder => $file )
or die "$file: Unable to open: $!\n";

for my $msg ($folder->messages)
{
    my $to          = join( ', ', map { $_->format } $msg->to );
    my $from        = join( ', ', map { $_->format } $msg->from );
    my $date        = localtime( $msg->timestamp );
    my $subject     = $msg->subject;
    my $body        = $msg->body;

    # Strip all quoted text
    $body =~ s/^>.*$//msg;

    print <<"";
From: $from
To: $to
Date: $date
$body

} 
```

尝试运行此程序时，出现以下错误：

"my" 变量 $msg 掩盖了 x.pl 第 16 行相同范围内的早期声明。 x.pl 第 15 行的语法错误，靠近 ") ) " x.pl 第 31 行的语法错误，靠近 "}"（可能是runaway multi-line << string 从第 25 行开始） x.pl 的执行由于编译错误而中止。

我不确定为什么，因为语法看起来不错。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T13:07:18.507

我猜这些实例`=20`都在消息的正文中。阅读一点[Mail::Message 的文档](http://search.cpan.org/~markov/Mail-Box/lib/Mail/Message.pod)就会发现这个有用的说明：

> 请注意，这会返回一个可能已编码的对象：使用 decoded() 获取包含可用数据的主体。

因此，不要`$msg->body`在循环中调用，只需调用`$msg->decoded->string`.

使用时完成排序应该是最容易的`Mail::Message::timestamp`：

```
...
for my $msg ( sort { $a->timestamp <=> $b->timestamp } $folder->messages) )
... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T13:05:40.757

我建议查看[MIME::Base64](http://search.cpan.org/~gaas/MIME-Base64-Perl-1.00/)模块，其中包括 MIME::QuotedPrint::Perl 模块来解码 QP 主体。

# javascript - JavaScript hashmap 等价物

> ID：368280
> 
> 赞同：397
> 
> 时间：2008-12-15T12:56:50.853
> 
> 标签：javascript, data-structures, language-features, hashmap

[正如此答案](https://stackoverflow.com/questions/367440/javascript-associative-array-without-tostring-etc#367454)的更新 3 中所述，此表示法：

```
var hash = {};
hash[X] 
```

实际上并没有散列对象`X`；它实际上只是转换`X`为一个字符串（`.toString()`如果它是一个对象，或者是各种原始类型的其他一些内置转换），然后在“ `hash`”中查找该字符串，而不对其进行散列。也不会检查对象相等性 - 如果两个不同的对象具有相同的字符串转换，它们只会相互覆盖。

鉴于此 - JavaScript 中是否有任何有效的 hashmap 实现？

（例如，Google 的第二个结果[`javascript hashmap`](http://www.google.com/search?rlz=1C1GGLS_en-USUS299US303&sourceid=chrome&ie=UTF-8&q=javascript%20hashmap)产生的实现对于任何操作都是 O(n)。各种其他结果忽略了具有等效字符串表示的不同对象相互覆盖的事实。

* * *

## 回答 #1

> 赞同：412
> 
> 时间：2008-12-15T14:21:15.487

自己手动散列您的对象，并将生成的字符串用作常规 JavaScript 字典的键。毕竟，您最有能力知道是什么让您的对象与众不同。我就是做这个的。

例子：

```
var key = function(obj){
  // Some unique object-dependent key
  return obj.totallyUniqueEmployeeIdKey; // Just an example
};

var dict = {};

dict[key(obj1)] = obj1;
dict[key(obj2)] = obj2; 
```

通过这种方式，您可以控制由 JavaScript 完成的索引，而无需繁重的内存分配和溢出处理。

当然，如果你真的想要“工业级的解决方案”，你可以构建一个通过key函数参数化的类，并拥有容器所需的所有API，但是……我们使用JavaScript，并尝试简单轻量，所以这个功能解决方案简单快捷。

密钥功能可以像选择对象的正确属性一样简单，例如，一个密钥或一组密钥，它们已经是唯一的，密钥的组合，它们一起是唯一的，或者像使用一些密码散列一样复杂，例如在[DojoX 编码](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/encoding/)或[DojoX UUID](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/uuid/)中。虽然后一种解决方案可能会产生唯一的密钥，但我个人会不惜一切代价避免它们，特别是如果我知道是什么让我的对象独一无二。

**2014 年更新：** 2008 年回答这个简单的解决方案仍然需要更多解释。让我以问答形式澄清这个想法。

*您的解决方案没有真正的哈希。它在哪里？？？*

JavaScript 是一种高级语言。它的基本原语（[Object](http://en.wikipedia.org/wiki/JavaScript_syntax#Objects)）包括一个哈希表来保存属性。为了提高效率，这个哈希表通常是用低级语言编写的。使用带有字符串键的简单对象，我们无需任何努力即可使用高效实现的哈希表。

*你怎么知道他们使用哈希？*

有三种主要的方法来保持对象集合可通过键寻址：

*   无序。在这种情况下，要通过其键检索对象，我们必须遍历所有在找到它时停止的键。平均而言，它将进行 n/2 次比较。
*   订购。
    *   示例#1：一个排序数组——进行二分搜索，我们将平均在 ~log2(n) 次比较之后找到我们的键。好多了。
    *   示例#2：一棵树。再次是 ~log(n) 尝试。
*   哈希表。平均而言，它需要一个恒定的时间。比较：O(n) vs. O(log n) vs. O(1)。繁荣。

显然，JavaScript 对象以某种形式使用哈希表来处理一般情况。

*浏览器供应商真的使用哈希表吗？？？*

真的。

*   Chrome/node.js/ [V8](https://github.com/v8/v8/)： [JSObject](https://github.com/v8/v8/blob/master/src/objects.h#L1680)。[在objects.cc](https://github.com/v8/v8/blob/master/src/objects.cc) 和[objects-inl.h](https://github.com/v8/v8/blob/master/src/objects-inl.h)中查找 具有相关详细信息的[NameDictionary](https://github.com/v8/v8/blob/master/src/objects.h#L3618)和 [NameDictionaryShape](https://github.com/v8/v8/blob/master/src/objects.h#L3606)。
*   Firefox/ [Gecko](https://github.com/mozilla/gecko-dev)： [JSObject](https://github.com/mozilla/gecko-dev/blob/master/js/src/jsobj.h#L99)、 [NativeObject](https://github.com/mozilla/gecko-dev/blob/master/js/src/vm/NativeObject.h#L349)和 [PlainObject ，在](https://github.com/mozilla/gecko-dev/blob/master/js/src/vm/NativeObject.h#L1238)[jsobj.cpp](https://github.com/mozilla/gecko-dev/blob/master/js/src/jsobj.cpp)和 [vm/NativeObject.cpp](https://github.com/mozilla/gecko-dev/blob/master/js/src/vm/NativeObject.cpp)中有相关细节 。

*他们处理碰撞吗？*

是的。往上看。如果您在不相等的字符串上发现冲突，请立即向供应商提交错误。

*那么你的想法是什么？*

如果你想散列一个对象，找出是什么使它独一无二并将其用作键。不要试图计算真正的哈希或模拟哈希表——它已经被底层的 JavaScript 对象有效地处理了。

将此键与 JavaScript 一起使用`Object`以利用其内置哈希表，同时避免与默认属性可能发生的冲突。

帮助您入门的示例：

*   如果您的对象包含唯一的用户名 - 将其用作键。
*   如果它包含一个唯一的客户编号 - 将其用作密钥。
    *   如果它包含唯一的政府颁发的号码，如美国[SSN](https://en.wikipedia.org/wiki/Social_Security_number)或护照号码，并且您的系统不允许重复 - 将其用作密钥。
*   如果字段组合是唯一的 - 将其用作键。
    *   美国州缩写+驾驶执照号码是一个很好的关键。
    *   国家缩写+护照号码也是一个很好的关键。
*   字段或整个对象上的某些函数可以返回唯一值——将其用作键。

*我使用了您的建议并使用用户名缓存了所有对象。但是一些聪明的人被命名为“toString”，这是一个内置属性！我现在该怎么办？*

显然，如果生成的密钥完全由拉丁字符组成的可能性很小，那么您应该对此采取一些措施。例如，在开头或结尾添加您喜欢的任何非拉丁 Unicode 字符以与默认属性取消冲突：“#toString”、“#MarySmith”。如果使用复合键，则使用某种非拉丁分隔符分隔键组件：“name,city,state”。

通常，这是我们必须发挥创造力并选择具有给定限制（唯一性，与默认属性的潜在冲突）的最简单键的地方。

注意：根据定义，唯一键不会发生冲突，而潜在的哈希冲突将由底层`Object`.

*你为什么不喜欢工业解决方案？*

恕我直言，最好的代码根本就是没有代码：它没有错误，不需要维护，易于理解，并且可以立即执行。我看到的所有“JavaScript 中的哈希表”都超过 100 行代码，并且涉及多个对象。将其与：`dict[key] = value`.

另一点：使用 JavaScript 和相同的原始对象来实现已经实现的东西，甚至有可能击败用低级语言编写的原始对象的性能吗？

*我仍然想在没有任何键的情况下散列我的对象！*

我们很幸运：[ECMAScript 6](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_%E2%80%93_ECMAScript_2015)（2015 年 6 月发布）定义了[map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)和[set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set)。

从定义来看，他们可以使用对象的地址作为键，这使得对象在没有人工键的情况下立即区分。OTOH，两个不同但相同的对象，将被映射为不同的。

[来自MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map#Objects_and_maps_compared)的比较细分：

> 对象与 Maps 类似，都允许您将键设置为值、检索这些值、删除键以及检测是否在键中存储了某些内容。正因为如此（并且因为没有内置的替代品），对象在历史上一直被用作地图；但是，在某些情况下，使用 Map 更可取的重要区别是：
> 
> *   对象的键是字符串和符号，而它们可以是 Map 的任何值，包括函数、对象和任何原语。
> *   Map 中的键是有序的，而添加到对象的键不是。因此，在对其进行迭代时， Map 对象会按插入顺序返回键。
> *   您可以使用 size 属性轻松获取 Map 的大小，而 Object 中的属性数量必须手动确定。
> *   Map 是可迭代的，因此可以直接迭代，而对 Object 进行迭代则需要以某种方式获取其键并对其进行迭代。
> *   一个对象有一个原型，所以如果你不小心，地图中有默认键可能会与你的键发生冲突。从 ES5 开始，这可以通过使用 map = Object.create(null) 绕过，但很少这样做。
> *   在涉及频繁添加和删除密钥对的场景中，Map 可能会表现得更好。

* * *

## 回答 #2

> 赞同：176
> 
> 时间：2008-12-20T17:57:30.630

# 问题描述

JavaScript 没有内置的通用*映射*类型（有时称为*关联数组*或*字典*），它允许通过任意键访问任意值。JavaScript 的基本数据结构是*object*，这是一种特殊类型的 map，它只接受字符串作为键，并具有特殊的语义，如原型继承、getter 和 setter 以及一些进一步的巫术。

将对象用作映射时，您必须记住，键将通过 转换为字符串值`toString()`，这会导致映射`5`并`'5'`转换为相同的值，并且所有不会将该`toString()`方法覆盖为索引的值的对象`'[object Object]'`。如果您不检查`hasOwnProperty()`.

JavaScript 的内置*数组*类型一点帮助都没有：JavaScript 数组不是关联数组，而只是具有一些特殊属性的对象。如果你想知道为什么它们不能用作地图，[请看这里](http://andrewdupont.net/2006/05/18/javascript-associative-arrays-considered-harmful/)。

# 尤金的解决方案

[Eugene Lazutkin 已经描述](https://stackoverflow.com/questions/368280/javascript-hashmap-equivalent/368504#368504)了使用自定义哈希函数生成唯一字符串的基本思想，该字符串可用于将关联值作为字典对象的属性进行查找。这很可能是最快的解决方案，因为对象在内部实现为*哈希表*。

*   **注意：**哈希表（有时称为*哈希映射*）是映射概念的特定实现，它使用支持数组并通过数字哈希值查找。运行时环境可能会使用其他结构（例如*搜索树*或*跳过列表*）来实现 JavaScript 对象，但由于对象是基本的数据结构，因此应该对其进行充分优化。

为了获得任意对象的唯一哈希值，一种可能性是使用全局计数器并将哈希值缓存在对象本身中（例如，在名为 的属性中`__hash`）。

执行此操作并适用于原始值和对象的哈希函数是：

```
function hash(value) {
    return (typeof value) + ' ' + (value instanceof Object ?
        (value.__hash || (value.__hash = ++arguments.callee.current)) :
        value.toString());
}

hash.current = 0; 
```

这个函数可以按照 Eugene 的描述来使用。为方便起见，我们将进一步将其包装在一个`Map`类中。

# 我的`Map`实现

以下实现会将键值对另外存储在双向链表中，以允许对键和值进行快速迭代。要提供您自己的哈希函数，您可以在创建后覆盖实例的`hash()`方法。

```
// Linking the key-value-pairs is optional.
// If no argument is provided, linkItems === undefined, i.e. !== false
// --> linking will be enabled
function Map(linkItems) {
    this.current = undefined;
    this.size = 0;

    if(linkItems === false)
        this.disableLinking();
}

Map.noop = function() {
    return this;
};

Map.illegal = function() {
    throw new Error("illegal operation for maps without linking");
};

// Map initialisation from an existing object
// doesn't add inherited properties if not explicitly instructed to:
// omitting foreignKeys means foreignKeys === undefined, i.e. == false
// --> inherited properties won't be added
Map.from = function(obj, foreignKeys) {
    var map = new Map;

    for(var prop in obj) {
        if(foreignKeys || obj.hasOwnProperty(prop))
            map.put(prop, obj[prop]);
    }

    return map;
};

Map.prototype.disableLinking = function() {
    this.link = Map.noop;
    this.unlink = Map.noop;
    this.disableLinking = Map.noop;
    this.next = Map.illegal;
    this.key = Map.illegal;
    this.value = Map.illegal;
    this.removeAll = Map.illegal;

    return this;
};

// Overwrite in Map instance if necessary
Map.prototype.hash = function(value) {
    return (typeof value) + ' ' + (value instanceof Object ?
        (value.__hash || (value.__hash = ++arguments.callee.current)) :
        value.toString());
};

Map.prototype.hash.current = 0;

// --- Mapping functions

Map.prototype.get = function(key) {
    var item = this[this.hash(key)];
    return item === undefined ? undefined : item.value;
};

Map.prototype.put = function(key, value) {
    var hash = this.hash(key);

    if(this[hash] === undefined) {
        var item = { key : key, value : value };
        this[hash] = item;

        this.link(item);
        ++this.size;
    }
    else this[hash].value = value;

    return this;
};

Map.prototype.remove = function(key) {
    var hash = this.hash(key);
    var item = this[hash];

    if(item !== undefined) {
        --this.size;
        this.unlink(item);

        delete this[hash];
    }

    return this;
};

// Only works if linked
Map.prototype.removeAll = function() {
    while(this.size)
        this.remove(this.key());

    return this;
};

// --- Linked list helper functions

Map.prototype.link = function(item) {
    if(this.size == 0) {
        item.prev = item;
        item.next = item;
        this.current = item;
    }
    else {
        item.prev = this.current.prev;
        item.prev.next = item;
        item.next = this.current;
        this.current.prev = item;
    }
};

Map.prototype.unlink = function(item) {
    if(this.size == 0)
        this.current = undefined;
    else {
        item.prev.next = item.next;
        item.next.prev = item.prev;
        if(item === this.current)
            this.current = item.next;
    }
};

// --- Iterator functions - only work if map is linked

Map.prototype.next = function() {
    this.current = this.current.next;
};

Map.prototype.key = function() {
    return this.current.key;
};

Map.prototype.value = function() {
    return this.current.value;
}; 
```

# 例子

以下脚本，

```
var map = new Map;

map.put('spam', 'eggs').
    put('foo', 'bar').
    put('foo', 'baz').
    put({}, 'an object').
    put({}, 'another object').
    put(5, 'five').
    put(5, 'five again').
    put('5', 'another five');

for(var i = 0; i++ < map.size; map.next())
    document.writeln(map.hash(map.key()) + ' : ' + map.value()); 
```

生成此输出：

```
string spam : eggs
string foo : baz
object 1 : an object
object 2 : another object
number 5 : five again
string 5 : another five 
```

# 进一步的考虑

[PEZ 建议](https://stackoverflow.com/questions/368280/javascript-hashmap-equivalent/384517#384517)`toString()`用我们的哈希函数覆盖该方法。这是不可行的，因为它不适用于原始值（更改原始值`toString()`是一个*非常*糟糕的主意）。如果我们想`toString()`为任意对象返回有意义的值，我们将不得不修改`Object.prototype`，有些人（不包括我自己）认为是*verboten*。

* * *

我的实现的当前版本`Map`以及其他 JavaScript 好东西[可以从这里获得](http://mercurial.intuxication.org/hg/js-hacks/raw-file/tip/map.js)。

* * *

## 回答 #3

> 赞同：74
> 
> 时间：2014-09-28T17:50:12.780

现在有一些非常棒的外部库解决方案：

*   [集合.js](http://www.collectionsjs.com/)
*   [不可变的.js](https://facebook.github.io/immutable-js/)

JavaScript 也有它的语言提供`Map`。

*   [地图](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2015-11-23T08:25:57.200

根据 ECMAScript 2015 (ES6)，标准 JavaScript 有一个 Map 实现。更多关于哪个可以在[这里](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)找到。

基本用法：

```
var myMap = new Map();
var keyString = "a string",
    keyObj = {},
    keyFunc = function () {};

// Setting the values
myMap.set(keyString, "value associated with 'a string'");
myMap.set(keyObj, "value associated with keyObj");
myMap.set(keyFunc, "value associated with keyFunc");

myMap.size; // 3

// Getting the values
myMap.get(keyString);    // "value associated with 'a string'"
myMap.get(keyObj);       // "value associated with keyObj"
myMap.get(keyFunc);      // "value associated with keyFunc" 
```

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2012-07-10T11:32:50.927

这是使用类似于 Java 映射的简单方便的方法：

```
var map = {
              'map_name_1': map_value_1,
              'map_name_2': map_value_2,
              'map_name_3': map_value_3,
              'map_name_4': map_value_4
          } 
```

并获得价值：

```
alert(map['map_name_1']);    // Gives the value of map_value_1

... etc. ... 
```

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2013-12-26T15:54:34.753

您可以使用 ECMAScript 6[`WeakMap`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)或[`Map`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)：

*   > WeakMaps 是键/值映射，其中键是对象。

`Map`对象是简单的键/值映射。任何值（对象和原始值）都可以用作键或值。

请注意，两者都没有得到广泛支持，但您可以使用[ECMAScript 6 Shim](https://github.com/paulmillr/es6-shim)（需要本机 ECMAScript 5 或[ECMAScript 5 Shim](https://github.com/kriskowal/es5-shim)）来支持`Map`，但不支持`WeakMap`（[请参阅原因](https://github.com/paulmillr/es6-shim#weakmap-shim)）。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-12-15T16:54:14.133

您必须以某种内部状态存储对象/值对的对联：

```
HashMap = function(){
  this._dict = [];
}

HashMap.prototype._get = function(key){
  for(var i=0, couplet; couplet = this._dict[i]; i++){
    if(couplet[0] === key){
      return couplet;
    }
  }
}

HashMap.prototype.put = function(key, value){
  var couplet = this._get(key);
  if(couplet){
    couplet[1] = value;
  }else{
    this._dict.push([key, value]);
  }
  return this; // for chaining
}
HashMap.prototype.get = function(key){
  var couplet = this._get(key);
  if(couplet){
    return couplet[1];
  }
} 
```

并像这样使用它：

```
var color = {}; // Unique object instance
var shape = {}; // Unique object instance
var map = new HashMap();
map.put(color, "blue");
map.put(shape, "round");
console.log("Item is", map.get(color), "and", map.get(shape)); 
```

当然，这个实现也是在 O(n) 的某个地方。[Eugene 的示例](https://stackoverflow.com/questions/368280/javascript-hashmap-equivalent/368504#368504)是获得以您期望从真实哈希中获得的任何速度的哈希的唯一方法。

与尤金的回答类似，另一种方法是以某种方式将唯一 ID 附加到所有对象。我最喜欢的方法之一是采用从 Object 超类继承的内置方法之一，将其替换为自定义函数传递并将属性附加到该函数对象。如果你要重写我的 HashMap 方法来做到这一点，它看起来像：

```
HashMap = function(){
  this._dict = {};
}

HashMap.prototype._shared = {id: 1};
HashMap.prototype.put = function put(key, value){
  if(typeof key == "object"){
    if(!key.hasOwnProperty._id){
      key.hasOwnProperty = function(key){
        return Object.prototype.hasOwnProperty.call(this, key);
      }
      key.hasOwnProperty._id = this._shared.id++;
    }
    this._dict[key.hasOwnProperty._id] = value;
  }else{
    this._dict[key] = value;
  }
  return this; // for chaining
}

HashMap.prototype.get = function get(key){
  if(typeof key == "object"){
    return this._dict[key.hasOwnProperty._id];
  }
  return this._dict[key];
} 
```

这个版本似乎只是稍微快了一点，但理论上它对于大型数据集会快得多。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2011-04-07T07:25:11.513

不幸的是，以前的答案都不适用于我的情况：不同的关键对象可能具有相同的哈希码。因此，我编写了一个简单的类似 Java 的 HashMap 版本：

```
function HashMap() {
    this.buckets = {};
}

HashMap.prototype.put = function(key, value) {
    var hashCode = key.hashCode();
    var bucket = this.buckets[hashCode];
    if (!bucket) {
        bucket = new Array();
        this.buckets[hashCode] = bucket;
    }
    for (var i = 0; i < bucket.length; ++i) {
        if (bucket[i].key.equals(key)) {
            bucket[i].value = value;
            return;
        }
    }
    bucket.push({ key: key, value: value });
}

HashMap.prototype.get = function(key) {
    var hashCode = key.hashCode();
    var bucket = this.buckets[hashCode];
    if (!bucket) {
        return null;
    }
    for (var i = 0; i < bucket.length; ++i) {
        if (bucket[i].key.equals(key)) {
            return bucket[i].value;
        }
    }
}

HashMap.prototype.keys = function() {
    var keys = new Array();
    for (var hashKey in this.buckets) {
        var bucket = this.buckets[hashKey];
        for (var i = 0; i < bucket.length; ++i) {
            keys.push(bucket[i].key);
        }
    }
    return keys;
}

HashMap.prototype.values = function() {
    var values = new Array();
    for (var hashKey in this.buckets) {
        var bucket = this.buckets[hashKey];
        for (var i = 0; i < bucket.length; ++i) {
            values.push(bucket[i].value);
        }
    }
    return values;
} 
```

注意：关键对象必须“实现” hashCode() 和 equals() 方法。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-07-09T20:20:52.600

我已经实现了一个 JavaScript HashMap，它的代码可以从[http://github.com/lambder/HashMapJS/tree/master获得](http://github.com/lambder/HashMapJS/tree/master)

这是代码：

```
/*
 =====================================================================
 @license MIT
 @author Lambder
 @copyright 2009 Lambder.
 @end
 =====================================================================
 */
var HashMap = function() {
  this.initialize();
}

HashMap.prototype = {
  hashkey_prefix: "<#HashMapHashkeyPerfix>",
  hashcode_field: "<#HashMapHashkeyPerfix>",

  initialize: function() {
    this.backing_hash = {};
    this.code = 0;
  },
  /*
   Maps value to key returning previous association
   */
  put: function(key, value) {
    var prev;
    if (key && value) {
      var hashCode = key[this.hashcode_field];
      if (hashCode) {
        prev = this.backing_hash[hashCode];
      } else {
        this.code += 1;
        hashCode = this.hashkey_prefix + this.code;
        key[this.hashcode_field] = hashCode;
      }
      this.backing_hash[hashCode] = value;
    }
    return prev;
  },
  /*
   Returns value associated with given key
   */
  get: function(key) {
    var value;
    if (key) {
      var hashCode = key[this.hashcode_field];
      if (hashCode) {
        value = this.backing_hash[hashCode];
      }
    }
    return value;
  },
  /*
   Deletes association by given key.
   Returns true if the association existed, false otherwise
   */
  del: function(key) {
    var success = false;
    if (key) {
      var hashCode = key[this.hashcode_field];
      if (hashCode) {
        var prev = this.backing_hash[hashCode];
        this.backing_hash[hashCode] = undefined;
        if(prev !== undefined)
          success = true;
      }
    }
    return success;
  }
}

//// Usage

// Creation

var my_map = new HashMap();

// Insertion

var a_key = {};
var a_value = {struct: "structA"};
var b_key = {};
var b_value = {struct: "structB"};
var c_key = {};
var c_value = {struct: "structC"};

my_map.put(a_key, a_value);
my_map.put(b_key, b_value);
var prev_b = my_map.put(b_key, c_value);

// Retrieval

if(my_map.get(a_key) !== a_value){
  throw("fail1")
}
if(my_map.get(b_key) !== c_value){
  throw("fail2")
}
if(prev_b !== b_value){
  throw("fail3")
}

// Deletion

var a_existed = my_map.del(a_key);
var c_existed = my_map.del(c_key);
var a2_existed = my_map.del(a_key);

if(a_existed !== true){
  throw("fail4")
}
if(c_existed !== false){
  throw("fail5")
}
if(a2_existed !== false){
  throw("fail6")
} 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-11-12T07:33:30.620

在 ECMAScript 6 中，您可以使用[Wea​​kMap](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)。

例子：

```
var wm1 = new WeakMap(),
    wm2 = new WeakMap(),
    wm3 = new WeakMap();
var o1 = {},
    o2 = function(){},
    o3 = window;

wm1.set(o1, 37);
wm1.set(o2, "azerty");
wm2.set(o1, o2); // A value can be anything, including an object or a function
wm2.set(o3, undefined);
wm2.set(wm1, wm2); // Keys and values can be any objects. Even WeakMaps!

wm1.get(o2); // "azerty"
wm2.get(o2); // Undefined, because there is no value for o2 on wm2
wm2.get(o3); // Undefined, because that is the set value

wm1.has(o2); // True
wm2.has(o2); // False
wm2.has(o3); // True (even if the value itself is 'undefined')

wm3.set(o1, 37);
wm3.get(o1); // 37
wm3.clear();
wm3.get(o1); // Undefined, because wm3 was cleared and there is no value for o1 anymore

wm1.has(o1);   // True
wm1.delete(o1);
wm1.has(o1);   // False 
```

但：

由于引用很弱，WeakMap 键是不可枚举的（即没有方法可以为您提供键列表）。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-05-27T10:40:26.843

试试我的 JavaScript 哈希表实现：[http ://www.timdown.co.uk/jshashtable](http://www.timdown.co.uk/jshashtable)

它查找关键对象的 hashCode() 方法，或者您可以在创建 Hashtable 对象时提供散列函数。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-21T15:07:01.003

JavaScript 没有内置的 map/hashmap。它应该被称为[关联数组](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/Array)。

`hash["X"]`等于`hash.X`，但它允许 "X" 作为​​字符串变量。换句话说，`hash[x]`在功能上等于`eval("hash."+x.toString())`。

它更类似于 object.properties 而不是键值映射。如果您正在寻找更好的 JavaScript 键/值映射，请使用[Map 对象](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-07-04T00:19:46.877

我的“地图”实现，源自[Christoph 的示例](https://stackoverflow.com/questions/368280/javascript-hashmap-equivalent/383540#383540)：

示例用法：

```
var map = new Map();  // Creates an "in-memory" map
var map = new Map("storageId");  // Creates a map that is loaded/persisted using html5 storage 
```

* * *

```
function Map(storageId) {
    this.current = undefined;
    this.size = 0;
    this.storageId = storageId;
    if (this.storageId) {
        this.keys = new Array();
        this.disableLinking();
    }
}

Map.noop = function() {
    return this;
};

Map.illegal = function() {
    throw new Error("illegal operation for maps without linking");
};

// Map initialisation from an existing object
// doesn't add inherited properties if not explicitly instructed to:
// omitting foreignKeys means foreignKeys === undefined, i.e. == false
// --> inherited properties won't be added
Map.from = function(obj, foreignKeys) {
    var map = new Map;
    for(var prop in obj) {
        if(foreignKeys || obj.hasOwnProperty(prop))
            map.put(prop, obj[prop]);
    }
    return map;
};

Map.prototype.disableLinking = function() {
    this.link = Map.noop;
    this.unlink = Map.noop;
    this.disableLinking = Map.noop;

    this.next = Map.illegal;
    this.key = Map.illegal;
    this.value = Map.illegal;
//    this.removeAll = Map.illegal;

    return this;
};

// Overwrite in Map instance if necessary
Map.prototype.hash = function(value) {
    return (typeof value) + ' ' + (value instanceof Object ?
        (value.__hash || (value.__hash = ++arguments.callee.current)) :
        value.toString());
};

Map.prototype.hash.current = 0;

// --- Mapping functions

Map.prototype.get = function(key) {
    var item = this[this.hash(key)];
    if (item === undefined) {
        if (this.storageId) {
            try {
                var itemStr = localStorage.getItem(this.storageId + key);
                if (itemStr && itemStr !== 'undefined') {
                    item = JSON.parse(itemStr);
                    this[this.hash(key)] = item;
                    this.keys.push(key);
                    ++this.size;
                }
            } catch (e) {
                console.log(e);
            }
        }
    }
    return item === undefined ? undefined : item.value;
};

Map.prototype.put = function(key, value) {
    var hash = this.hash(key);

    if(this[hash] === undefined) {
        var item = { key : key, value : value };
        this[hash] = item;

        this.link(item);
        ++this.size;
    }
    else this[hash].value = value;
    if (this.storageId) {
        this.keys.push(key);
        try {
            localStorage.setItem(this.storageId + key, JSON.stringify(this[hash]));
        } catch (e) {
            console.log(e);
        }
    }
    return this;
};

Map.prototype.remove = function(key) {
    var hash = this.hash(key);
    var item = this[hash];
    if(item !== undefined) {
        --this.size;
        this.unlink(item);

        delete this[hash];
    }
    if (this.storageId) {
        try {
            localStorage.setItem(this.storageId + key, undefined);
        } catch (e) {
            console.log(e);
        }
    }
    return this;
};

// Only works if linked
Map.prototype.removeAll = function() {
    if (this.storageId) {
        for (var i=0; i<this.keys.length; i++) {
            this.remove(this.keys[i]);
        }
        this.keys.length = 0;
    } else {
        while(this.size)
            this.remove(this.key());
    }
    return this;
};

// --- Linked list helper functions

Map.prototype.link = function(item) {
    if (this.storageId) {
        return;
    }
    if(this.size == 0) {
        item.prev = item;
        item.next = item;
        this.current = item;
    }
    else {
        item.prev = this.current.prev;
        item.prev.next = item;
        item.next = this.current;
        this.current.prev = item;
    }
};

Map.prototype.unlink = function(item) {
    if (this.storageId) {
        return;
    }
    if(this.size == 0)
        this.current = undefined;
    else {
        item.prev.next = item.next;
        item.next.prev = item.prev;
        if(item === this.current)
            this.current = item.next;
    }
};

// --- Iterator functions - only work if map is linked

Map.prototype.next = function() {
    this.current = this.current.next;
};

Map.prototype.key = function() {
    if (this.storageId) {
        return undefined;
    } else {
        return this.current.key;
    }
};

Map.prototype.value = function() {
    if (this.storageId) {
        return undefined;
    }
    return this.current.value;
}; 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-11-20T23:11:36.757

如果性能不重要（例如，键的数量相对较少）并且您不想使用 , 等附加字段污染您的（或者可能不是您的）对象`_hash`，`_id`那么您可以利用以下事实[`Array.prototype.indexOf`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)采用严格的平等。这是一个简单的实现：

```
var Dict = (function(){
    // Internet Explorer 8 and earlier does not have any Array.prototype.indexOf
    function indexOfPolyfill(val) {
      for (var i = 0, l = this.length; i < l; ++i) {
        if (this[i] === val) {
          return i;
        }
      }
      return -1;
    }

    function Dict(){
      this.keys = [];
      this.values = [];
      if (!this.keys.indexOf) {
        this.keys.indexOf = indexOfPolyfill;
      }
    };

    Dict.prototype.has = function(key){
      return this.keys.indexOf(key) != -1;
    };

    Dict.prototype.get = function(key, defaultValue){
      var index = this.keys.indexOf(key);
      return index == -1 ? defaultValue : this.values[index];
    };

    Dict.prototype.set = function(key, value){
      var index = this.keys.indexOf(key);
      if (index == -1) {
        this.keys.push(key);
        this.values.push(value);
      } else {
        var prevValue = this.values[index];
        this.values[index] = value;
        return prevValue;
      }
    };

    Dict.prototype.delete = function(key){
      var index = this.keys.indexOf(key);
      if (index != -1) {
        this.keys.splice(index, 1);
        return this.values.splice(index, 1)[0];
      }
    };

    Dict.prototype.clear = function(){
      this.keys.splice(0, this.keys.length);
      this.values.splice(0, this.values.length);
    };

    return Dict;
})(); 
```

使用示例：

```
var a = {}, b = {},
    c = { toString: function(){ return '1'; } },
    d = 1, s = '1', u = undefined, n = null,
    dict = new Dict();

// Keys and values can be anything
dict.set(a, 'a');
dict.set(b, 'b');
dict.set(c, 'c');
dict.set(d, 'd');
dict.set(s, 's');
dict.set(u, 'u');
dict.set(n, 'n');

dict.get(a); // 'a'
dict.get(b); // 'b'
dict.get(s); // 's'
dict.get(u); // 'u'
dict.get(n); // 'n'
// etc. 
```

与 ECMAScript 6 WeakMap 相比，它有两个问题：O(n) 搜索时间和非弱点（即，如果不使用`delete`或`clear`释放​​键会导致内存泄漏）。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-08-19T18:15:47.490

添加另一个解决方案：`HashMap`几乎是我从 Java 移植到 JavaScript 的第一个类。你可以说有很多开销，但实现几乎 100% 等于 Java 的实现，并且包括所有接口和子类。

该项目可以在这里找到：[https](https://github.com/Airblader/jsava) ://github.com/Airblader/jsava 我还将附上 HashMap 类的（当前）源代码，但如上所述，它也依赖于超类等。OOP 框架使用的是qooxdoo。

请注意，此代码已经过时，当前工作请参阅 GitHub 项目。在撰写本文时，还有一个`ArrayList`实现。

```
qx.Class.define( 'jsava.util.HashMap', {
    extend: jsava.util.AbstractMap,
    implement: [jsava.util.Map, jsava.io.Serializable, jsava.lang.Cloneable],

    construct: function () {
        var args = Array.prototype.slice.call( arguments ),
            initialCapacity = this.self( arguments ).DEFAULT_INITIAL_CAPACITY,
            loadFactor = this.self( arguments ).DEFAULT_LOAD_FACTOR;

        switch( args.length ) {
            case 1:
                if( qx.Class.implementsInterface( args[0], jsava.util.Map ) ) {
                    initialCapacity = Math.max( ((args[0].size() / this.self( arguments ).DEFAULT_LOAD_FACTOR) | 0) + 1,
                        this.self( arguments ).DEFAULT_INITIAL_CAPACITY );
                    loadFactor = this.self( arguments ).DEFAULT_LOAD_FACTOR;
                } else {
                    initialCapacity = args[0];
                }
                break;
            case 2:
                initialCapacity = args[0];
                loadFactor = args[1];
                break;
        }

        if( initialCapacity < 0 ) {
            throw new jsava.lang.IllegalArgumentException( 'Illegal initial capacity: ' + initialCapacity );
        }
        if( initialCapacity > this.self( arguments ).MAXIMUM_CAPACITY ) {
            initialCapacity = this.self( arguments ).MAXIMUM_CAPACITY;
        }
        if( loadFactor <= 0 || isNaN( loadFactor ) ) {
            throw new jsava.lang.IllegalArgumentException( 'Illegal load factor: ' + loadFactor );
        }

        var capacity = 1;
        while( capacity < initialCapacity ) {
            capacity <<= 1;
        }

        this._loadFactor = loadFactor;
        this._threshold = (capacity * loadFactor) | 0;
        this._table = jsava.JsavaUtils.emptyArrayOfGivenSize( capacity, null );
        this._init();
    },

    statics: {
        serialVersionUID: 1,

        DEFAULT_INITIAL_CAPACITY: 16,
        MAXIMUM_CAPACITY: 1 << 30,
        DEFAULT_LOAD_FACTOR: 0.75,

        _hash: function (hash) {
            hash ^= (hash >>> 20) ^ (hash >>> 12);
            return hash ^ (hash >>> 7) ^ (hash >>> 4);
        },

        _indexFor: function (hashCode, length) {
            return hashCode & (length - 1);
        },

        Entry: qx.Class.define( 'jsava.util.HashMap.Entry', {
            extend: jsava.lang.Object,
            implement: [jsava.util.Map.Entry],

            construct: function (hash, key, value, nextEntry) {
                this._value = value;
                this._next = nextEntry;
                this._key = key;
                this._hash = hash;
            },

            members: {
                _key: null,
                _value: null,
                /** @type jsava.util.HashMap.Entry */
                _next: null,
                /** @type Number */
                _hash: 0,

                getKey: function () {
                    return this._key;
                },

                getValue: function () {
                    return this._value;
                },

                setValue: function (newValue) {
                    var oldValue = this._value;
                    this._value = newValue;
                    return oldValue;
                },

                equals: function (obj) {
                    if( obj === null || !qx.Class.implementsInterface( obj, jsava.util.HashMap.Entry ) ) {
                        return false;
                    }

                    /** @type jsava.util.HashMap.Entry */
                    var entry = obj,
                        key1 = this.getKey(),
                        key2 = entry.getKey();
                    if( key1 === key2 || (key1 !== null && key1.equals( key2 )) ) {
                        var value1 = this.getValue(),
                            value2 = entry.getValue();
                        if( value1 === value2 || (value1 !== null && value1.equals( value2 )) ) {
                            return true;
                        }
                    }

                    return false;
                },

                hashCode: function () {
                    return (this._key === null ? 0 : this._key.hashCode()) ^
                        (this._value === null ? 0 : this._value.hashCode());
                },

                toString: function () {
                    return this.getKey() + '=' + this.getValue();
                },

                /**
                 * This method is invoked whenever the value in an entry is
                 * overwritten by an invocation of put(k,v) for a key k that's already
                 * in the HashMap.
                 */
                _recordAccess: function (map) {
                },

                /**
                 * This method is invoked whenever the entry is
                 * removed from the table.
                 */
                _recordRemoval: function (map) {
                }
            }
        } )
    },

    members: {
        /** @type jsava.util.HashMap.Entry[] */
        _table: null,
        /** @type Number */
        _size: 0,
        /** @type Number */
        _threshold: 0,
        /** @type Number */
        _loadFactor: 0,
        /** @type Number */
        _modCount: 0,
        /** @implements jsava.util.Set */
        __entrySet: null,

        /**
         * Initialization hook for subclasses. This method is called
         * in all constructors and pseudo-constructors (clone, readObject)
         * after HashMap has been initialized but before any entries have
         * been inserted.  (In the absence of this method, readObject would
         * require explicit knowledge of subclasses.)
         */
        _init: function () {
        },

        size: function () {
            return this._size;
        },

        isEmpty: function () {
            return this._size === 0;
        },

        get: function (key) {
            if( key === null ) {
                return this.__getForNullKey();
            }

            var hash = this.self( arguments )._hash( key.hashCode() );
            for( var entry = this._table[this.self( arguments )._indexFor( hash, this._table.length )];
                 entry !== null; entry = entry._next ) {
                /** @type jsava.lang.Object */
                var k;
                if( entry._hash === hash && ((k = entry._key) === key || key.equals( k )) ) {
                    return entry._value;
                }
            }

            return null;
        },

        __getForNullKey: function () {
            for( var entry = this._table[0]; entry !== null; entry = entry._next ) {
                if( entry._key === null ) {
                    return entry._value;
                }
            }

            return null;
        },

        containsKey: function (key) {
            return this._getEntry( key ) !== null;
        },

        _getEntry: function (key) {
            var hash = (key === null) ? 0 : this.self( arguments )._hash( key.hashCode() );
            for( var entry = this._table[this.self( arguments )._indexFor( hash, this._table.length )];
                 entry !== null; entry = entry._next ) {
                /** @type jsava.lang.Object */
                var k;
                if( entry._hash === hash
                    && ( ( k = entry._key ) === key || ( key !== null && key.equals( k ) ) ) ) {
                    return entry;
                }
            }

            return null;
        },

        put: function (key, value) {
            if( key === null ) {
                return this.__putForNullKey( value );
            }

            var hash = this.self( arguments )._hash( key.hashCode() ),
                i = this.self( arguments )._indexFor( hash, this._table.length );
            for( var entry = this._table[i]; entry !== null; entry = entry._next ) {
                /** @type jsava.lang.Object */
                var k;
                if( entry._hash === hash && ( (k = entry._key) === key || key.equals( k ) ) ) {
                    var oldValue = entry._value;
                    entry._value = value;
                    entry._recordAccess( this );
                    return oldValue;
                }
            }

            this._modCount++;
            this._addEntry( hash, key, value, i );
            return null;
        },

        __putForNullKey: function (value) {
            for( var entry = this._table[0]; entry !== null; entry = entry._next ) {
                if( entry._key === null ) {
                    var oldValue = entry._value;
                    entry._value = value;
                    entry._recordAccess( this );
                    return oldValue;
                }
            }

            this._modCount++;
            this._addEntry( 0, null, value, 0 );
            return null;
        },

        __putForCreate: function (key, value) {
            var hash = (key === null) ? 0 : this.self( arguments )._hash( key.hashCode() ),
                i = this.self( arguments )._indexFor( hash, this._table.length );
            for( var entry = this._table[i]; entry !== null; entry = entry._next ) {
                /** @type jsava.lang.Object */
                var k;
                if( entry._hash === hash
                    && ( (k = entry._key) === key || ( key !== null && key.equals( k ) ) ) ) {
                    entry._value = value;
                    return;
                }
            }

            this._createEntry( hash, key, value, i );
        },

        __putAllForCreate: function (map) {
            var iterator = map.entrySet().iterator();
            while( iterator.hasNext() ) {
                var entry = iterator.next();
                this.__putForCreate( entry.getKey(), entry.getValue() );
            }
        },

        _resize: function (newCapacity) {
            var oldTable = this._table,
                oldCapacity = oldTable.length;
            if( oldCapacity === this.self( arguments ).MAXIMUM_CAPACITY ) {
                this._threshold = Number.MAX_VALUE;
                return;
            }

            var newTable = jsava.JsavaUtils.emptyArrayOfGivenSize( newCapacity, null );
            this._transfer( newTable );
            this._table = newTable;
            this._threshold = (newCapacity * this._loadFactor) | 0;
        },

        _transfer: function (newTable) {
            var src = this._table,
                newCapacity = newTable.length;
            for( var j = 0; j < src.length; j++ ) {
                var entry = src[j];
                if( entry !== null ) {
                    src[j] = null;
                    do {
                        var next = entry._next,
                            i = this.self( arguments )._indexFor( entry._hash, newCapacity );
                        entry._next = newTable[i];
                        newTable[i] = entry;
                        entry = next;
                    } while( entry !== null );
                }
            }
        },

        putAll: function (map) {
            var numKeyToBeAdded = map.size();
            if( numKeyToBeAdded === 0 ) {
                return;
            }

            if( numKeyToBeAdded > this._threshold ) {
                var targetCapacity = (numKeyToBeAdded / this._loadFactor + 1) | 0;
                if( targetCapacity > this.self( arguments ).MAXIMUM_CAPACITY ) {
                    targetCapacity = this.self( arguments ).MAXIMUM_CAPACITY;
                }

                var newCapacity = this._table.length;
                while( newCapacity < targetCapacity ) {
                    newCapacity <<= 1;
                }
                if( newCapacity > this._table.length ) {
                    this._resize( newCapacity );
                }
            }

            var iterator = map.entrySet().iterator();
            while( iterator.hasNext() ) {
                var entry = iterator.next();
                this.put( entry.getKey(), entry.getValue() );
            }
        },

        remove: function (key) {
            var entry = this._removeEntryForKey( key );
            return entry === null ? null : entry._value;
        },

        _removeEntryForKey: function (key) {
            var hash = (key === null) ? 0 : this.self( arguments )._hash( key.hashCode() ),
                i = this.self( arguments )._indexFor( hash, this._table.length ),
                prev = this._table[i],
                entry = prev;

            while( entry !== null ) {
                var next = entry._next,
                    /** @type jsava.lang.Object */
                        k;
                if( entry._hash === hash
                    && ( (k = entry._key) === key || ( key !== null && key.equals( k ) ) ) ) {
                    this._modCount++;
                    this._size--;
                    if( prev === entry ) {
                        this._table[i] = next;
                    } else {
                        prev._next = next;
                    }
                    entry._recordRemoval( this );
                    return entry;
                }
                prev = entry;
                entry = next;
            }

            return entry;
        },

        _removeMapping: function (obj) {
            if( obj === null || !qx.Class.implementsInterface( obj, jsava.util.Map.Entry ) ) {
                return null;
            }

            /** @implements jsava.util.Map.Entry */
            var entry = obj,
                key = entry.getKey(),
                hash = (key === null) ? 0 : this.self( arguments )._hash( key.hashCode() ),
                i = this.self( arguments )._indexFor( hash, this._table.length ),
                prev = this._table[i],
                e = prev;

            while( e !== null ) {
                var next = e._next;
                if( e._hash === hash && e.equals( entry ) ) {
                    this._modCount++;
                    this._size--;
                    if( prev === e ) {
                        this._table[i] = next;
                    } else {
                        prev._next = next;
                    }
                    e._recordRemoval( this );
                    return e;
                }
                prev = e;
                e = next;
            }

            return e;
        },

        clear: function () {
            this._modCount++;
            var table = this._table;
            for( var i = 0; i < table.length; i++ ) {
                table[i] = null;
            }
            this._size = 0;
        },

        containsValue: function (value) {
            if( value === null ) {
                return this.__containsNullValue();
            }

            var table = this._table;
            for( var i = 0; i < table.length; i++ ) {
                for( var entry = table[i]; entry !== null; entry = entry._next ) {
                    if( value.equals( entry._value ) ) {
                        return true;
                    }
                }
            }

            return false;
        },

        __containsNullValue: function () {
            var table = this._table;
            for( var i = 0; i < table.length; i++ ) {
                for( var entry = table[i]; entry !== null; entry = entry._next ) {
                    if( entry._value === null ) {
                        return true;
                    }
                }
            }

            return false;
        },

        clone: function () {
            /** @type jsava.util.HashMap */
            var result = null;
            try {
                result = this.base( arguments );
            } catch( e ) {
                if( !qx.Class.isSubClassOf( e.constructor, jsava.lang.CloneNotSupportedException ) ) {
                    throw e;
                }
            }

            result._table = jsava.JsavaUtils.emptyArrayOfGivenSize( this._table.length, null );
            result.__entrySet = null;
            result._modCount = 0;
            result._size = 0;
            result._init();
            result.__putAllForCreate( this );

            return result;
        },

        _addEntry: function (hash, key, value, bucketIndex) {
            var entry = this._table[bucketIndex];
            this._table[bucketIndex] = new (this.self( arguments ).Entry)( hash, key, value, entry );
            if( this._size++ >= this._threshold ) {
                this._resize( 2 * this._table.length );
            }
        },

        _createEntry: function (hash, key, value, bucketIndex) {
            var entry = this._table[bucketIndex];
            this._table[bucketIndex] = new (this.self( arguments ).Entry)( hash, key, value, entry );
            this._size++;
        },

        keySet: function () {
            var keySet = this._keySet;
            return keySet !== null ? keySet : ( this._keySet = new this.KeySet( this ) );
        },

        values: function () {
            var values = this._values;
            return values !== null ? values : ( this._values = new this.Values( this ) );
        },

        entrySet: function () {
            return this.__entrySet0();
        },

        __entrySet0: function () {
            var entrySet = this.__entrySet;
            return entrySet !== null ? entrySet : ( this.__entrySet = new this.EntrySet( this ) );
        },

        /** @private */
        HashIterator: qx.Class.define( 'jsava.util.HashMap.HashIterator', {
            extend: jsava.lang.Object,
            implement: [jsava.util.Iterator],

            type: 'abstract',

            /** @protected */
            construct: function (thisHashMap) {
                this.__thisHashMap = thisHashMap;
                this._expectedModCount = this.__thisHashMap._modCount;
                if( this.__thisHashMap._size > 0 ) {
                    var table = this.__thisHashMap._table;
                    while( this._index < table.length && ( this._next = table[this._index++] ) === null ) {
                        // do nothing
                    }
                }
            },

            members: {
                __thisHashMap: null,

                /** @type jsava.util.HashMap.Entry */
                _next: null,
                /** @type Number */
                _expectedModCount: 0,
                /** @type Number */
                _index: 0,
                /** @type jsava.util.HashMap.Entry */
                _current: null,

                hasNext: function () {
                    return this._next !== null;
                },

                _nextEntry: function () {
                    if( this.__thisHashMap._modCount !== this._expectedModCount ) {
                        throw new jsava.lang.ConcurrentModificationException();
                    }

                    var entry = this._next;
                    if( entry === null ) {
                        throw new jsava.lang.NoSuchElementException();
                    }

                    if( (this._next = entry._next) === null ) {
                        var table = this.__thisHashMap._table;
                        while( this._index < table.length && ( this._next = table[this._index++] ) === null ) {
                            // do nothing
                        }
                    }

                    this._current = entry;
                    return entry;
                },

                remove: function () {
                    if( this._current === null ) {
                        throw new jsava.lang.IllegalStateException();
                    }

                    if( this.__thisHashMap._modCount !== this._expectedModCount ) {
                        throw new jsava.lang.ConcurrentModificationException();
                    }

                    var key = this._current._key;
                    this._current = null;
                    this.__thisHashMap._removeEntryForKey( key );
                    this._expectedModCount = this.__thisHashMap._modCount;
                }
            }
        } ),

        _newKeyIterator: function () {
            return new this.KeyIterator( this );
        },

        _newValueIterator: function () {
            return new this.ValueIterator( this );
        },

        _newEntryIterator: function () {
            return new this.EntryIterator( this );
        },

        /** @private */
        ValueIterator: qx.Class.define( 'jsava.util.HashMap.ValueIterator', {
            extend: jsava.util.HashMap.HashIterator,

            construct: function (thisHashMap) {
                this.base( arguments, thisHashMap );
            },

            members: {
                next: function () {
                    return this._nextEntry()._value;
                }
            }
        } ),

        /** @private */
        KeyIterator: qx.Class.define( 'jsava.util.HashMap.KeyIterator', {
            extend: jsava.util.HashMap.HashIterator,

            construct: function (thisHashMap) {
                this.base( arguments, thisHashMap );
            },

            members: {
                next: function () {
                    return this._nextEntry().getKey();
                }
            }
        } ),

        /** @private */
        EntryIterator: qx.Class.define( 'jsava.util.HashMap.EntryIterator', {
            extend: jsava.util.HashMap.HashIterator,

            construct: function (thisHashMap) {
                this.base( arguments, thisHashMap );
            },

            members: {
                next: function () {
                    return this._nextEntry();
                }
            }
        } ),

        /** @private */
        KeySet: qx.Class.define( 'jsava.util.HashMap.KeySet', {
            extend: jsava.util.AbstractSet,

            construct: function (thisHashMap) {
                this.base( arguments );
                this.__thisHashMap = thisHashMap;
            },

            members: {
                __thisHashMap: null,

                iterator: function () {
                    return this.__thisHashMap._newKeyIterator();
                },

                size: function () {
                    return this.__thisHashMap._size;
                },

                contains: function (obj) {
                    return this.__thisHashMap.containsKey( obj );
                },

                remove: function (obj) {
                    return this.__thisHashMap._removeEntryForKey( obj ) !== null;
                },

                clear: function () {
                    this.__thisHashMap.clear();
                }
            }
        } ),

        /** @private */
        Values: qx.Class.define( 'jsava.util.HashMap.Values', {
            extend: jsava.util.AbstractCollection,

            construct: function (thisHashMap) {
                this.base( arguments );
                this.__thisHashMap = thisHashMap;
            },

            members: {
                __thisHashMap: null,

                iterator: function () {
                    return this.__thisHashMap._newValueIterator();
                },

                size: function () {
                    return this.__thisHashMap._size;
                },

                contains: function (obj) {
                    return this.__thisHashMap.containsValue( obj );
                },

                clear: function () {
                    this.__thisHashMap.clear();
                }
            }
        } ),

        /** @private */
        EntrySet: qx.Class.define( 'jsava.util.HashMap.EntrySet', {
            extend: jsava.util.AbstractSet,

            construct: function (thisHashMap) {
                this.base( arguments );
                this.__thisHashMap = thisHashMap;
            },

            members: {
                __thisHashMap: null,

                iterator: function () {
                    return this.__thisHashMap._newEntryIterator();
                },

                size: function () {
                    return this.__thisHashMap._size;
                },

                contains: function (obj) {
                    if( obj === null || !qx.Class.implementsInterface( obj, jsava.util.Map.Entry ) ) {
                        return false;
                    }

                    /** @implements jsava.util.Map.Entry */
                    var entry = obj,
                        candidate = this.__thisHashMap._getEntry( entry.getKey() );
                    return candidate !== null && candidate.equals( entry );
                },

                remove: function (obj) {
                    return this.__thisHashMap._removeMapping( obj ) !== null;
                },

                clear: function () {
                    this.__thisHashMap.clear();
                }
            }
        } )
    }
} ); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-08-26T05:16:13.247

这看起来像一个非常强大的解决方案：[https ://github.com/flesler/hashmap](https://github.com/flesler/hashmap)

它甚至适用于看起来相同的函数和对象。它使用的唯一技巧是向对象添加一个不起眼的成员来识别它。如果您的程序没有覆盖那个晦涩的变量（类似于*hashid*），那么您就是黄金。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-01-13T21:10:15.273

我的另一个地图实现。使用随机数，“泛型”和“迭代器”=）

```
var HashMap = function (TKey, TValue) {
    var db = [];
    var keyType, valueType;

    (function () {
        keyType = TKey;
        valueType = TValue;
    })();

    var getIndexOfKey = function (key) {
        if (typeof key !== keyType)
            throw new Error('Type of key should be ' + keyType);
        for (var i = 0; i < db.length; i++) {
            if (db[i][0] == key)
                return i;
        }
        return -1;
    }

    this.add = function (key, value) {
        if (typeof key !== keyType) {
            throw new Error('Type of key should be ' + keyType);
        } else if (typeof value !== valueType) {
            throw new Error('Type of value should be ' + valueType);
        }
        var index = getIndexOfKey(key);
        if (index === -1)
            db.push([key, value]);
        else
            db[index][1] = value;
        return this;
    }

    this.get = function (key) {
        if (typeof key !== keyType || db.length === 0)
            return null;
        for (var i = 0; i < db.length; i++) {
            if (db[i][0] == key)
                return db[i][1];
        }
        return null;
    }

    this.size = function () {
        return db.length;
    }

    this.keys = function () {
        if (db.length === 0)
            return [];
        var result = [];
        for (var i = 0; i < db.length; i++) {
            result.push(db[i][0]);
        }
        return result;
    }

    this.values = function () {
        if (db.length === 0)
            return [];
        var result = [];
        for (var i = 0; i < db.length; i++) {
            result.push(db[i][1]);
        }
        return result;
    }

    this.randomize = function () {
        if (db.length === 0)
            return this;
        var currentIndex = db.length, temporaryValue, randomIndex;
        while (0 !== currentIndex) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            temporaryValue = db[currentIndex];
            db[currentIndex] = db[randomIndex];
            db[randomIndex] = temporaryValue;
        }
        return this;
    }

    this.iterate = function (callback) {
        if (db.length === 0)
            return false;
        for (var i = 0; i < db.length; i++) {
            callback(db[i][0], db[i][1]);
        }
        return true;
    }
} 
```

例子：

```
var a = new HashMap("string", "number");
a.add('test', 1132)
 .add('test14', 666)
 .add('1421test14', 12312666)
 .iterate(function (key, value) {console.log('a['+key+']='+value)});
/*
a[test]=1132
a[test14]=666
a[1421test14]=12312666 
*/
a.randomize();
/*
a[1421test14]=12312666
a[test]=1132
a[test14]=666
*/ 
```

# svn - SVN - 不是工作副本错误

> ID：368281
> 
> 赞同：26
> 
> 时间：2008-12-15T12:56:58.373
> 
> 标签：svn, aptana, working-copy

我正在把头发拉出来。

我有一个使用 Subversion 进行版本控制的网站。我使用aptana（eclipse，subclipse）来做svn。我一直在签入和签出文件，更新等，一切都很好。然而，我们一直在构建的系统一直在添加自己的文件和文件夹。

当我尝试提交这些时，它告诉我`<path>`不是工作副本。如果我尝试进行清理，那么它会给出相同的错误。我发现我可以手动将每个文件添加到版本控制中，但这会引发相同的错误。进行更新无济于事，刷新工作区也无济于事。错误后清理似乎死了，然后目录被锁定。

我知道您应该使用 SVN 添加文件，但是您到底如何处理生成的文件？如何解决此“`<folder>`不是工作副本目录”错误？如何让 Subversion 只查看文件并将它们添加到其存储库？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-05T17:53:13.697

今天当我尝试添加一个我没有写权限的文件夹“A”时遇到了这个问题（因此它无法创建 A/.svn 文件夹）。

运行 svn status 在文件夹 A 旁边给了我一个“~”。运行 svn cleanup 表示 A 的父级已锁定。

最终起作用的是：

```
cp -r A A~    # backup, since A was not in the repo
rm -rf A      # removed locked directory
svn rm A      # remove A from pending commit
mv ~A A       # restore backup
svn add A     # re-add to pending commit
svn cleanup   # (had to cleanup several parent folders higher as well) 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-15T13:07:06.293

如果您希望将生成的文件添加到 SVN，请使用`svn add`递归添加它们 - 这将确保所有目录都是工作副本的一部分，并且所有文件和目录都添加到 SVN，并将作为一部分提交接下来`svn commit`。

但是，通常生成的文件和文件夹不应添加到 SVN，因为它们是作为构建的一部分*从源文件生成的。*[在这种情况下，你应该用svn:ignore](http://svnbook.red-bean.com/en/1.5/svn.advanced.props.special.ignore.html)标记它们，这样它们就不是工作副本的一部分。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-16T13:27:00.620

*not a working copy 错误*意味着当前文件夹没有被**SVN**正确初始化。

要修复错误，只需重命名当前文件夹，然后通过**检出**项目从**SVN***获取项目的正确工作副本*。

 ****然后签出将创建该项目的正确配置的工作副本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-17T15:52:51.550

我刚刚在我的工作副本中遇到“不是工作副本”错误。这是针对一个 JDeveloper 项目的，结果发现我刚刚安装的 JDeveloper 升级 (11.1.1.2.0) 包含的 SVNKit 版本比我用于命令行 SVN 访问 (jsvn) 的版本更高。所以 JDeveloper 悄悄地升级了 .svn 文件的格式，这意味着命令行客户端无法理解它们。当 jsvn 抱怨我项目的顶级目录中缺少文件“.svn/format”时，一分钱就掉了。我在子文件夹中发现了一堆这些，看起来都一样，并且只包含数字“9”。所以我将一个复制到顶级文件夹中，然后 jsvn 最后给出了一条适当的消息：“svn：这个客户端太旧了，无法使用工作副本'。';

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-13T07:42:26.497

现在使用 TortoiseSVN 清理一些死目录时遇到了这个问题。我对文件进行了备份，然后使用 rep 浏览器删除了有问题的目录（无论如何，这是一个失败者）。然后清理项目工作，我现在可以继续处理我当前的文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-01T23:00:03.613

请尝试找出问题所在。这是丢失的 .svn 文件还是其他文件。请记住 .svn 文件是在您完成签入后创建的。并包含相应的目录路径、带有唯一编号的代号。转到您认为已完美签入的项目的基本路径。创建一个新的临时包并在该路径中添加示例 java 代码。添加到版本并尝试提交。如果您收到错误消息说文件夹已锁定（尝试锁定已锁定的文件夹），请转到 .svn 文件夹并重命名锁定文件。再次尝试签入并提交

如果它工作正常，那么你就完成了。使用相同的基本目录并在清理后再次从该目录将代码签入到您的文件夹级别。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T13:00:57.350

“不是工作副本”意味着您的 IDE 尝试运行的地方之一`svn`不受`svn`其自身控制（例如在不属于 的子目录中添加文件`svn`）。我会说检查你在 IDE 中的路径。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-15T17:14:50.703

因为我使用可视化工具完成每一项任务，所以我无法告诉您需要执行哪些命令。

这是我的环境，Windows XP。带有 Subversion 1.6.9 的 tortoiseSVN 1.6.7，带有 Subclipse 1.6.10 的 Eclipse 3.5。并且存储库通过 Windows 上的可视 SVN 服务器进行管理。

1.  在视觉 svn 服务器中，我**删除了**由其他工具创建的文件夹（这就是问题所在，就像 Keltia 所说的那样）。
2.  在我的 Windows 资源管理器中，右键单击我的项目并使用 tortoise SVN press **update**选项。通过此操作，该文件夹在我的工作副本中被删除。
3.  **提交**了我所有的更改。
4.  运行**创建文件夹**的工具（再次）。
5.  用乌龟 SVN 我用**添加到忽略列表**标记。

希望这可以帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-01-24T08:15:46.040

就我而言，我将 eclipse 工作区位置移动到另一个位置，然后出现问题。为了解决问题，我从 svn repo 签出项目。然后在旧项目中我清理所有 svn 文件。（简单搜索 .svn 并删除）然后我将内容复制到刚刚签出的内容中，我的更改变得可见并且我的项目是最新的。此方法可应用于其他烦人的错误。希望帮助某人

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-08-28T06:35:00.007

请将`move`当前目录放在另一个位置，然后执行`svn update`命令，然后用移动的目录替换目录，
如果使用`tortoisteSVN`，你可以在运行 svn update 之前，运行清理你的根目录

# c# - 在子键值中查找匹配

> ID：368288
> 
> 赞同：1
> 
> 时间：2008-12-15T12:58:39.943
> 
> 标签：c#, registry

我在以下两个项目上遇到问题：

*   如何检索 ClassesRoot\Typelib 中的所有子键值，以及；
*   如何在子键值数组中查找已知值（路径/dll 名称）的匹配项。

作为背景信息，我试图找到一种方法来检查是否已注册 DLL。有人提到检查 DLL 的 ClassesRoot\Typelib 是一种方法，因为我知道 DLL 的目录位置和名称，但没有别的。

有没有人有任何提示？干杯。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T14:45:42.803

我没有对它进行过广泛的测试，它几乎没有错误处理代码，但这应该可以帮助你开始。

```
public static bool IsRegistered(string name, string dllPath)
{
    RegistryKey typeLibKey = Registry.ClassesRoot.OpenSubKey("TypeLib");
    foreach (string libIdKeyName in typeLibKey.GetSubKeyNames())
    {
        RegistryKey libIdKey = typeLibKey.OpenSubKey(libIdKeyName);
        foreach (string versionKeyName in libIdKey.GetSubKeyNames())
        {
            RegistryKey versionKey = libIdKey.OpenSubKey(versionKeyName);
            string regName = (string)versionKey.GetValue("");
            if (regName == name)
            {
                foreach (string itterKeyName in versionKey.GetSubKeyNames())
                {
                    int throwawayint;
                    if (int.TryParse(itterKeyName, out throwawayint))
                    {
                        RegistryKey itterKey = versionKey.OpenSubKey(itterKeyName);
                        string regDllPath = (string)itterKey.OpenSubKey("win32").GetValue("");
                        if (regDllPath == dllPath)
                        {
                            return true;
                        }
                    }
                }
            }
        }
    }

    return false;
} 
```

}

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T13:43:52.443

查看 Microsoft.Win32.Registry 和 Microsoft.Win32.RegistryKey。

```
public void Foo()
{
   foreach (string s in Microsoft.Win32.Registry.CurrentUser.GetSubKeyNames())
   {
      Microsoft.Win32.RegistryKey rk = Microsoft.Win32.Registry.CurrentUser.OpenSubKey(s);
      // check here for the dll value and exit if found
      // recurse down the tree...
   }
} 
```

# java - 如何在Java中获得真实的字符串高度？

> ID：368295
> 
> 赞同：19
> 
> 时间：2008-12-15T13:02:21.700
> 
> 标签：java, fonts, awt

我`FontMetrics.getHeight()`用来获取字符串的高度，但它给了我一个错误的值，切断了字符串字符的下行。我可以使用更好的功能吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2012-09-19T12:53:12.173

下面的`getStringBounds()`方法是基于`GlyphVector`当前`Graphics2D`字体的，对于一行文本的效果非常好：

```
public class StringBoundsPanel extends JPanel
{
    public StringBoundsPanel()
    {
        setBackground(Color.white);
        setPreferredSize(new Dimension(400, 247));
    }

    @Override
    protected void paintComponent(Graphics g)
    {
        super.paintComponent(g);

        Graphics2D g2 = (Graphics2D) g;

        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,
                            RenderingHints.VALUE_ANTIALIAS_ON);

        // must be called before getStringBounds()
        g2.setFont(getDesiredFont());

        String str = "My Text";
        float x = 140, y = 128;

        Rectangle bounds = getStringBounds(g2, str, x, y);

        g2.setColor(Color.red);
        g2.drawString(str, x, y);

        g2.setColor(Color.blue);
        g2.draw(bounds);

        g2.dispose();
    }

    private Rectangle getStringBounds(Graphics2D g2, String str,
                                      float x, float y)
    {
        FontRenderContext frc = g2.getFontRenderContext();
        GlyphVector gv = g2.getFont().createGlyphVector(frc, str);
        return gv.getPixelBounds(null, x, y);
    }

    private Font getDesiredFont()
    {
        return new Font(Font.SANS_SERIF, Font.BOLD, 28);
    }

    private void startUI()
    {
        JFrame frame = new JFrame();
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.add(this);
        frame.pack();
        frame.setLocationRelativeTo(null);
        frame.setVisible(true);
    }

    public static void main(String[] args) throws Exception
    {
        final StringBoundsPanel tb = new StringBoundsPanel();

        SwingUtilities.invokeAndWait(new Runnable()
        {
            public void run()
            {
                tb.startUI();
            }
        });
    }
} 
```

请注意，为了清楚起见，我省略了导入。

结果：

![结果截图。](https://i.stack.imgur.com/fpk48.png)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-15T13:07:07.523

是什么让您认为它返回错误的值？您对它返回的期望与规范不匹配的可能性要大得多。请注意，如果字体中的某些字形超过或低于这些值，那很好。

`getMaxDescent()`并且`getMaxAscent()`应该告诉您字体中任何字形的这些字段的绝对最大值。

如果您想知道特定字符串的指标，那么您肯定想调用`getLineMetrics()`.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-15T13:05:40.023

[FontMetrics.getAscent()](http://java.sun.com/javase/6/docs/api/java/awt/FontMetrics.html#getAscent())和[FontMetrics.getDescent()](http://java.sun.com/javase/6/docs/api/java/awt/FontMetrics.html#getDescent())可能会成功。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-03-28T16:17:32.523

我最近编写了下面的代码，因为我需要对字体的特定范围（例如：所有小字符或所有数字）进行像素完美高度测量。

如果您需要更快的代码（我的有 for 循环），我建议您在启动时运行一次以获取数组中的所有值（例如从 1 到 100），然后改用数组。

该代码基本上在 250x250 位图上重叠的同一位置绘制输入字符串中的所有字符（如果需要，增加或减少），它从顶部开始寻找像素，然后从底部开始，然后返回找到的最大高度。即使它是为字符范围设计的，它也适用于普通字符串。这意味着当某些字符重复时评估常规字符串时存在某种冗余。因此，如果您的输入字符串超过字母计数 (26)，请使用 'tRange' 输入：“abcd...z”和其他可能使用的字符。它更快。

希望有帮助。

```
public int getFontPixelHeight(float inSize, Paint sourcePaint, String tRange)
{
    // It is assumed that the font is already set in the sourcePaint

    int bW = 250, bH = 250;                                     // bitmap's width and height
    int firstContact = -1, lastContact = -2;                    // Used when scanning the pixel rows. Initial values are set so that if no pixels found, the returned result is zero.
    int tX = (int)(bW - inSize)/2, tY = (int)(bH - inSize)/2;   // Used for a rough centering of the displayed characters

    int tSum = 0;

    // Preserve the original paint attributes
    float oldSize = sourcePaint.getTextSize();
    int oldColor = sourcePaint.getColor();
    // Set the size/color
    sourcePaint.setTextSize(inSize); sourcePaint.setColor(Color.WHITE);

    // Create the temporary bitmap/canvas
    Bitmap.Config bConf = Bitmap.Config.ARGB_8888;
    Bitmap hld = Bitmap.createBitmap(250, 250, bConf);
    Canvas canv = new Canvas(hld);

    for (int i = 0; i < bH; i++)
    {
        for (int j = 0; j < bW; j++)
        {
            hld.setPixel(j, i, 0); // Zero all pixel values. This might seem redundant, but I am not quite sure that creating a blank bitmap means the pixel color value is indeed zero, and I need them to be zero so the addition performed below is correct.
        }
    }

    // Display all characters overlapping at the same position
    for (int i = 0; i < tRange.length(); i++)
    {
        canv.drawText("" + tRange.charAt(i), tX, tY, sourcePaint);
    }

    for (int i = 0; i < bH; i++)
    {
        for (int j = 0; j < bW; j++)
        {
            tSum = tSum + hld.getPixel(j, i);
        }

        if (tSum > 0) // If we found at least a pixel, save row index and exit loop
        {
            firstContact = i;
            tSum = 0;   // Reset
            break;
        }   
    }

    for (int i = bH - 1; i > 0 ; i--)
    {
        for (int j = 0; j < bW; j++)
        {
            tSum = tSum + hld.getPixel(j, i);
        }

        if (tSum > 0) // If we found at least a pixel, save row index and exit loop
        {
            lastContact = i;
            break;
        }   
    }

    // Restore the initial attributes, just in case the paint was passed byRef somehow
    sourcePaint.setTextSize(oldSize);
    sourcePaint.setColor(oldColor);

    return lastContact - firstContact + 1;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T14:03:37.847

`getHeight()`不能切断字符串的下行，只有绘制字符串才能做到这一点。您正在使用从返回的高度`getHeight`以某种方式绘制字符串，并且您可能正在滥用高度。例如，如果您将字符串的起点定位在 getHeight() 高的框的底部，则文本的基线将位于框的底部边缘，并且很可能会剪裁下降部分。

文本几何是一个复杂的话题，充满了奇异的历史文物。正如其他人所建议的那样，使用`getAscent`并`getDescent`尝试在您的框中正确定位基线。

# mysql - 为什么 com.mysql.jdbc.Driver 需要永远在 MATLAB 中打开？

> ID：368300
> 
> 赞同：0
> 
> 时间：2008-12-15T13:04:41.070
> 
> 标签：mysql, matlab

我在 MATLAB 中遇到了 com.mysql.jdbc.Driver 的问题，我希望其他人遇到过它并可以帮助我。基本上，我的问题是在一台机器上，每次我调用`database('mysql.jdbc.Driver', ...)`时，该调用大约需要 30 秒。我只是照常记下这个，除了当我在不同的机器上运行相同的脚本时，`database`第一次调用大约需要 15 秒，之后每次不到 1 秒。建立数据库连接后，无论我在使用什么机器，运行查询都需要相同的时间。

有没有其他人遇到（并解决）这个问题？我最好的猜测是某种环境问题导致了这个问题，但我什至不知道从哪里开始寻找。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-08T12:51:27.807

事实证明这是某种网络/服务问题。当我关闭一些不需要的服务（无线零配置等）时，我从一致的 20 秒创建连接到几毫秒。我希望我能更好地关注我更改的服务，但希望这对其他人有所帮助。

感谢 Fooz 先生建议使用其他东西，这让我能够确认这是一个系统问题，而不是 MATLAB 特定的问题。

# c# - 以最小的痛苦使基于 C# 的 Excel 加载项在进程外运行

> ID：368311
> 
> 赞同：3
> 
> 时间：2008-12-15T13:07:42.483
> 
> 标签：c#, .net, excel, com

我在 VS2005 中开发了一个原型 C# Excel 2003 插件，它支持一个带有一些简单调用的对象，加上一个单独的 RTD 类，所有这些都位于一个现有的大型内部 C# 堆栈之上。

一切正常，但是...

有人告诉我，为了避免与其他可能需要不同 .Net 运行时的 Excel 加载项发生潜在冲突，我将不得不将 .Net 代码推送到进程外。

1）这是真的吗？

2）这可以通过这样的方式完成，即进程外服务器按需自动启动，只有适当的用户可以访问（以简化安全问题）并且不需要精心安装等？

3）如果可以做到这一点，怎么做？

目前我的（COM 可见）类存根开始：

```
namespace SimpleAddinMockup1
{
    /// <summary>
    /// Main entry point from Excel for non-real-time methods.
    /// </summary>
    [ClassInterface(ClassInterfaceType.AutoDual), ComVisible(true)]
    public sealed class Main
    {

    ...
    }
} 
```

和

```
namespace SimpleAddinMockup1
{
    /// <summary>
    /// In-proc real-time server facade for an Excel instance to our main server connection.
    /// </summary>
    /// Note: to throttle updates in Excel use 'Application.RTD.ThrottleInterval = nnn' for nnn ms between updates (default is 2000).
    /// See: http://msdn.microsoft.com/en-us/library/aa140060(office.10).aspx
    [ClassInterface(ClassInterfaceType.AutoDual), ComVisible(true)]
    public sealed class CPRTDServer : Excel.IRtdServer
    {

    ...

    }
} 
```

**更新：**我仍然很想知道推动 C# outproc 是否容易做到，例如以声明方式...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T00:48:06.253

确实，对于当前可用的 CLR 版本（1.0、1.1 和 2.0），不同版本的 CLR 不能在一个进程中共存。但是，理论上，只要将 Excel 配置为加载 2.0 CLR，1.x 插件代码和 2.0 插件代码并存应该不会有任何问题。当加载任何 1.x 插件代码时，它应该自动指向向后兼容的 2.0 CLR。

曾经有一段时间，Excel 被连接为不加载 2.0 CLR 以解决特定的兼容性问题（在[本文](http://msdn.microsoft.com/en-us/magazine/cc163638.aspx)的侧栏中进行了解释），但这已通过可单独安装的 Office 更新 ( [KB908002](http://support.microsoft.com/kb/908002/en-us) ) 或使用加载项的安装程序（无论如何现在应该已经推送）。应用此更新后，Excel 应该会自动加载最新的可用 CLR 版本。

微软目前的计划是，当 4.0 CLR 发布时（与 VS2010 一起），它将能够与 2.0 CLR 共存于一个进程中，因此希望这也不会成为问题。

# .net - 我可以用 WHERE 关键字限制这个 c# 扩展方法定义吗？

> ID：368312
> 
> 赞同：2
> 
> 时间：2008-12-15T13:08:01.330
> 
> 标签：.net, extension-methods

当您提供枚举时，我正在尝试执行以下扩展方法->将 int 转换为枚举：-

```
public static T ToEnum<T>(this int value)
{
    return (T)Enum.ToObject(typeof(T), value);
} 
```

现在，我希望做到这一点，以便您只能将类型 T 定义为枚举。有什么我可以限制的吗？

例如。

```
int day = 3;
DaysOfWeek dow = day<DaysOfWeek>(); // No compiler error.
DaysOfWeek dow2 = day<Foo>(); // Compiler error. 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T13:12:39.277

在哪里使用 T：结构

请参阅此问题 [Create Generic method constraining T to an Enum](https://stackoverflow.com/questions/79126/create-generic-method-constraining-t-to-an-enum)

# php - PHP filter() 函数 - 为什么？

> ID：368313
> 
> 赞同：1
> 
> 时间：2008-12-15T13:09:05.867
> 
> 标签：php

为什么我要使用 PHP 的[过滤器](http://www.php.net/filter)库？我为什么不呢？

它似乎试图做一些清理工作（当你必须使用正则表达式时这很糟糕），但另一方面，如果你问我，函数命名和参数常量似乎是一场灾难。它一定被包含在 PHP 中是有原因的，但我似乎不喜欢它。我错过了什么？

*稍后编辑：*
关于 GaryF 的回答，我想解释一下为什么我不喜欢这个功能。如果合适的话，这不是在“我的情况”中使用它。这是关于在适合的地方使用它。很有可能需要一个不适合 PHP 功能的过滤器，所以我必须创建自己的过滤器。在这种情况下，应用程序将使用两种完全不同的函数进行数据过滤。我认为这比仅仅发明一个更好的轮子要糟糕得多。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T13:17:49.920

可能最好的资源是从 PHP 手册页链接到的教程：http: [//devolio.com/blog/archives/413-Data-Filtering-Using-PHPs-Filter-Functions-Part-one.html](http://devolio.com/blog/archives/413-Data-Filtering-Using-PHPs-Filter-Functions-Part-one.html)

它对于简单的过滤来说已经足够了，但是如果您在该页面上找不到您的用例，它可能不适合您。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T14:02:40.503

我的立场是过滤输入数据的概念在概念层面上是有缺陷的。请参阅我对几乎类似问题的回复 [What's the best method for sanitizing user input with PHP?](https://stackoverflow.com/questions/129677/whats-the-best-method-for-sanitizing-user-input-with-php#130323)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T14:03:33.153

它是关于使用经过良好测试的数据过滤框架来防止 XSS 和 SQL 注入攻击。

如果您查看所有可能性，那是您不想自己实现的那种过滤。

[http://www.php.net/manual/en/intro.filter.php](http://www.php.net/manual/en/intro.filter.php)

# unix - System V 和 Posix 信号量之间的差异

> ID：368322
> 
> 赞同：30
> 
> 时间：2008-12-15T13:13:26.640
> 
> 标签：unix, comparison, posix, semaphore, tradeoff

使用 System V 和 Posix 信号量之间的权衡是什么？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-12-15T13:36:44.220

来自[奥莱利](http://www.linuxdevcenter.com/pub/a/linux/2007/05/24/semaphores-in-linux.html?page=4)：

> *   System V 和 POSIX 信号量实现之间的一个显着区别是，在 System V 中，您可以控制可以增加或减少多少信号量。而在 POSIX 中，信号量计数增加和减少 1。
> *   POSIX 信号量不允许操纵信号量权限，而 System V 信号量允许您将信号量的权限更改为原始权限的子集。
> *   信号量的初始化和创建在 POSIX 信号量中是原子的（从用户的角度来看）。
> *   从使用的角度来看，System V 信号量是笨拙的，而 POSIX 信号量是直截了当的
> *   POSIX 信号量（使用未命名的信号量）的可扩展性远高于 System V 信号量。在用户/客户端场景中，每个用户都创建自己的服务器实例，最好使用 POSIX 信号量。
> *   System V 信号量在创建信号量对象时创建一个信号量数组，而 POSIX 信号量只创建一个。由于这个特性，与 POSIX 信号量相比，System V 信号量的信号量创建（内存占用）成本更高。
> *   据说 POSIX 信号量的性能优于基于 System V 的信号量。
> *   POSIX 信号量为进程范围的信号量而不是系统范围的信号量提供了一种机制。因此，如果开发人员忘记关闭信号量，则在进程退出时清除信号量。简单来说，POSIX 信号量为非持久信号量提供了一种机制。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2013-02-24T07:41:50.297

在单独的进程（不是线程）中使用 POSIX 共享/命名信号量的两个主要问题：当另一个进程在持有信号量锁时死掉时，POSIX 信号量没有提供唤醒等待进程的机制。这种缺乏清理可能导致僵尸信号量，这将导致任何其他或后续进程试图使用它们死锁。也没有 POSIX 方法列出操作系统中的信号量以尝试识别和清理它们。SysV IPC 的 POSIX 部分确实指定了 ipcs 和 ipcrm 工具来列出和操作全局 SysV IPC 资源。没有为 POSIX IPC 指定此类工具甚至机制，尽管在 Linux 上这些资源通常可以在 /shm 下找到。这意味着在错误的时间向错误的进程发出 KILL 信号会导致整个交互进程系统死锁，直到重新启动。

另一个缺点是对 POSIX 信号量使用文件语义。这意味着可以有多个共享信号量具有相同的名称，但处于不同的状态。例如，一个进程调用 sem_open，然后在 sem_close 之前调用 sem_unlink。这个过程仍然可以使用信号量，就像在关闭它之前取消链接打开的文件一样。进程 2 在进程 1 的 sem_unlink 和 sem_close 调用之间的同一信号量上调用 sem_open，并且（根据文档）获得一个具有相同名称但状态与进程 1 不同的全新信号量。两个具有相同名称的共享信号量独立操作违背了共享信号量的目的。

上述限制使 POSIX 共享信号量在现实系统中无法使用，但不能保证永远无法发送无法捕获的信号。限制二可以通过仔细编码来减轻，假设控制所有将使用给定信号量的代码。坦率地说，他们把它变成了标准，这有点令人惊讶。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-10-11T22:34:52.303

我知道这已经过时了，但是为了那些仍在阅读 Google 的礼貌的人的利益，我发现使用 System V 信号量而不是 POSIX（系统级）信号量的第一原因是能够以某种方式获取信号量资源无论进程如何退出，内核都会自动返回。

我同意很少使用多个（原子）信号量操作（尽管它们在暂存期间很有用），并且 System V 接口很奇怪，但是根本没有办法可靠地实现与 POSIX 信号量相同的清理语义。

# .net - 这个 Linq2Sql 如何在 select 子句中创建枚举？

> ID：368323
> 
> 赞同：1
> 
> 时间：2008-12-15T13:14:30.863
> 
> 标签：.net, linq-to-sql, enums, enumeration

我有以下 linq2sql 查询，我将结果设置为 POCO。我的 POCO 属性之一是枚举。

```
public IQueryable<Models.Achievement> GetAchievements()
{
    return from a in _sqlDatabase.Achievements
        select new Models.Achievement
            {
                // Note: ToEnum is an extension method that converts an int -> the enum.
                AchievementType = a.AchievementTypeId.ToEnum<Models.AchievementType>(),
                DateTimeCreated = a.DateTimeCreated,
                UserId = a.UserId
            };
} 
```

当我运行查询时，我收到以下错误。

```
System.NotSupportedException: Method 'Models.AchievementType 
    ToEnum[AchievementType](int)' has no supported translation to SQL. 
```

唔。有没有一种方法可以让我将结果 int 转换为我的自定义枚举？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T13:18:42.713

您实际上可以在 LINQ-to-SQL 中直接使用枚举（但不能在实体框架中使用）；只需将属性的类型（在 dbml/designer 中）更改为完全限定的枚举类型，它就会为您进行强制转换。当然，您可能希望将其命名为 AchievementType - 这假设是直接（转换）翻译。

如果这不适合您的方案，您可能必须将其选择为整数，然后在 LINQ-to-Objects 中进行最终转换（通过 AsEnumerable()）。您也可以尝试直接转换（假设这已经足够）而不是您的通用扩展方法：

```
select new {..., AchievementType = (AchievementType) foo.Bar, ...} 
```

并不是说如果`Models.Achievement`在 dbml 中定义了类型，则不能以这种方式创建它 - 您必须简单地选择它。但是，如果这不是 db-model 的一部分，那就没问题了。[这](https://stackoverflow.com/questions/211875/linq-to-sql-mapping-enum-from-string#211894)是在 LINQ-to-SQL 中将字符串映射到枚举的相关示例。

如果这些都不适合，另一种方法是将枚举属性声明为部分类中的 shim。[我在这里](https://stackoverflow.com/questions/353190/how-do-i-replace-an-int-property-with-an-enum-in-entity-framework#353195)举了一个例子（对于 EF，但它的工作原理相同），但请注意，如果你这样做，你不能在`Where`子句等中使用 enum 属性，因为它没有映射到模型中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T13:21:38.260

也许你可以在你的 Models.Achievement 声明中尝试这样的事情：

```
 AchievementType achievementType{
    get
      {
         return this.AchievementTypeId.ToEnum<Models.AchievementType>();
      }
      set
      {
        this.AchievementTypeId = (int)value;
      }
    } 
```

# php - 为什么我应该使用 $_GET 和 $_POST 而不是 $_REQUEST？

> ID：368329
> 
> 赞同：8
> 
> 时间：2008-12-15T13:16:18.113
> 
> 标签：php, security

除了从 cookie 中读取的事实之外`$_REQUEST`，还有什么理由我应该使用`$_GET`and`$_POST`而不是`$_REQUEST`？这样做的理论和实践原因是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-15T15:44:53.540

当我只希望用户的某些数据返回某些数据时，我使用 $_REQUEST。

当请求有副作用时，切勿使用 $_REQUEST。产生副作用的请求应该是 POST（出于语义原因，也因为基本的 CSRF 内容，错误的 img 标签可以在用户不知道的情况下命中任何 GET 端点）。

当 GET 或 POST 到页面会产生不同的结果时，应该使用 $_GET。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T14:08:28.807

> 除了 $_REQUEST 从 cookie 中读取的事实之外

除了这是未定义的事实（它可以在每个安装级别上配置），使用的问题`$_REQUEST`是它过度简化了事情。GET 请求和 POST 请求之间存在（或应该存在）语义差异。因此，如果您从一个来源或另一个来源获得输入，这对您的应用程序应该很重要。这就是 HTTP 协议的定义方式，因此忽略它会破坏协议，从而降低应用程序的互操作性。它与使用语义 HTML 标记而不是面向表示的标记的类型参数相同。或者更一般地说，遵循协议的意图，而不是仅仅在具体情况下做任何有效的事情。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-15T13:20:39.027

你已经给出了一个答案，那我再给出一个：

这更像是一种风格选择。例如，您通常不希望更改服务器上状态的信息可缓存，因此您可能希望将其限制为`$_POST`变量。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-15T13:20:22.537

$_REQUEST 的使用会向您的应用程序打开一些攻击向量，在这些攻击向量中，变量可能会在您不希望发生的地方被覆盖。

还要考虑将填充 $_REQUEST 的订单 GPC（Get、Post、Cookie）。

即请求：

```
$_GET['foo'] = 'bar'
$_POST['foo'] = 'baz' 
```

将导致

**`$_REQUEST['foo'] == 'bar'`**

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T13:56:18.097

$_REQUEST 经常提到的不安全感是假的。所有这些都是从具有非安全机器的用户那里获取数据的方法。您总是必须清理输入，因此使用任何一个都没有真正的安全优势。

仅当您在不同通道上对具有相同名称的值有不同用途时，它才有意义。在这种情况下，无论如何您都应该重命名其中的一些。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-16T22:50:21.373

HTTP GET 在语义上意味着用于获取页面，而 POST 可以说是在使用时，您会期望某种状态发生了变化。

例如，期望多次使用具有相同参数的 GET 会产生相同的结果，而使用 POST 可能不会。

当你应该屈服于问题时不使用 POST。我认为 Ruby on Rails AJAX 库使用 GET 而不是 POST，并且在被网络蜘蛛触及时会导致大量数据丢失。

因此，您应该避免使用 $_REQUEST。您应该知道页面的用途，并决定如何回答 GET 请求以及如何回答 POST 请求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T15:31:02.493

这是我刚刚找到的一个：[何时以及为什么应该使用 $_REQUEST 而不是 $_GET / $_POST / $_COOKIE？](https://stackoverflow.com/questions/107683/when-and-why-should-request-be-used-instead-of-get-post-cookie). 很抱歉没有早点找到，所以我不会问这个问题...

# sql - 我可以在过程中传递游标吗？

> ID：368338
> 
> 赞同：11
> 
> 时间：2008-12-15T13:20:25.923
> 
> 标签：sql

我可以在过程中传递游标吗？

```
CURSOR  BLT_CURSOR IS
SELECT  BLT.sol_id,
        BLT.bill_id,
        BLT.bank_id
FROM BLT; 
```

是我的光标。

```
Procedure abc(i want to pass the cursor here) 
```

我该怎么做。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-15T14:29:35.237

我假设您使用的是 Oracle（看起来是这样）。

你可以这样做：

```
PROCEDURE abc( p_cursor IN SYS_REFCURSOR) IS
   v_sol_id blt.sol_id%TYPE;
   v_bill_id blt.bill_id%TYPE;
   v_bank_id blt.bank_id%TYPE;
BEGIN
   LOOP
      FETCH p_cursor INTO v_sol_id, v_bill_id, v_bank_id;
      EXIT WHEN p_cursor%NOTFOUND;
      ...
   END LOOP;
END; 
```

然后使用它：

```
DECLARE
   v_cursor SYS_REFCURSOR;
BEGIN
   OPEN v_cursor FOR
      SELECT  BLT.sol_id,
              BLT.bill_id,
              BLT.bank_id
      FROM BLT;
   abc (v_cursor);
   CLOSE v_cursor;
END; 
```

但是，请注意过程 abc 需要知道游标的结构，即它返回 3 个特定类型的列。如果您希望能够将**任何**游标传递给该过程，那么您需要考虑使用 DBMS_SQL 包（这不是微不足道的！）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T13:39:25.370

来自[MSDN](http://msdn.microsoft.com/en-us/library/ms187926.aspx) (SQL Server 2008)：游标数据类型只能用于 OUTPUT 参数。指定游标数据类型时，还必须指定 VARYING 和 OUTPUT 关键字。您可以使用游标数据类型指定多个输出参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-11-18T17:00:17.620

关于 MS-SQL，您不能将光标作为输入参数传递。您只能将光标作为输出参数传递。
您可以做的是将光标选择子句文本作为输入参数传递。您可能会发现下面的工作代码很有用。

```
--Create the table and fill it with data
DROP   TABLE    dbo.StackOverflow_MyTable
GO
CREATE TABLE    dbo.StackOverflow_MyTable (
                MyChar      varchar(10),
                MyDate      datetime,
                MyNum       numeric(10,2)
                PRIMARY KEY (MyChar))
GO
INSERT INTO dbo.StackOverflow_MyTable SELECT 'A1', '2018-01-13', 123.45
INSERT INTO dbo.StackOverflow_MyTable SELECT 'B2', '2018-01-14', 123.46
INSERT INTO dbo.StackOverflow_MyTable SELECT 'C3', '2018-01-15', 123.47
GO
/* Create the procedure which returns the cursor variable based on select statement
   The cursor must be opened here. Otherwise it throws an Error:
   The variable '@MyCursorVar' does not currently have a cursor allocated to it
*/
DROP   PROCEDURE dbo.StackOverflow_OpenCursor
GO
CREATE PROCEDURE dbo.StackOverflow_OpenCursor @SelectSQL nvarchar(128), @MyCursorVar CURSOR VARYING OUTPUT
    AS
    DECLARE @SQL nvarchar(256)
    SET @SQL='  SET     @MyCursorVar = CURSOR FOR '+@SelectSQL+'
                OPEN    @MyCursorVar'

    EXEC sp_executesql @SQL, N'@MyCursorVar CURSOR OUTPUT', @MyCursorVar OUTPUT
GO

--Create the procedure which browses the table using the cursor variable
DROP   PROCEDURE dbo.StackOverflow_BrowseCursor
GO
CREATE PROCEDURE dbo.StackOverflow_BrowseCursor @SelectSQL nvarchar(128)
    AS
    --Create the cursor variable based on select statement and OPEN the cursor
    DECLARE @MyCursorVar CURSOR
    EXEC dbo.StackOverflow_OpenCursor @SelectSQL, @MyCursorVar OUTPUT

    --Declare the variables corresponding to table column
    DECLARE @MyChar varchar(10), @MyDate datetime, @MyNum numeric(10,2)
    --Browse record by record
    WHILE 1=1
    BEGIN
        FETCH NEXT FROM @MyCursorVar INTO @MyChar, @MyDate, @MyNum
        IF @@FETCH_STATUS <> 0 BREAK
        PRINT @MyChar   --Here you might call any other procedure or dataset update
        PRINT @MyDate
        PRINT @MyNum
    END
    --release the cursor resources
    CLOSE       @MyCursorVar
    DEALLOCATE  @MyCursorVar
GO

--How to call the cursor browsing 
DECLARE @SelectSQL nvarchar(128)
SET     @SelectSQL = 'SELECT MyChar, MyDate, MyNum FROM dbo.StackOverflow_MyTable ORDER BY MyChar'
EXEC dbo.StackOverflow_BrowseCursor @SelectSQL 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T13:34:39.310

在 MSSQL2005 中是不可能的。我不知道 2008 或其他平台。

有好几次我都想做。它将支持更模块化的架构。我可以有一个 proc 对数据集执行通用过程，但能够将光标从各种其他过程传递到该数据集。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-11T13:23:00.570

建议可能使用视图的答案假设意图是能够使用相同查询的结果执行两种不同的算法。当然，这是传递游标的一种用途，但对我来说，我想用两个不同查询的结果执行相同的算法。我有两个程序，每个程序都有自己的目的和一个有意义的名称，它们碰巧基于不同的查询共享相同的算法，因此每个程序都会使用适当的查询打开游标，然后调用一个通用程序来执行算法。

那么，为什么不传入查询的 SQL，因为文本已经让内部过程在那里打开游标呢？因为如果你这样做并且 SQL 有任何绑定变量，你需要将它们与文本一起传递，这意味着两个（或更多）查询不仅需要返回相同的列集，它们还必须采用相同的数字和绑定变量的类型。如果您传递游标，则打开游标并且变量绑定在声明 SQL 的过程的上下文中，但在游标传递到的过程的上下文中处理的行。

# .net - 如何在 ADO.NET 实体框架中执行此操作

> ID：368347
> 
> 赞同：2
> 
> 时间：2008-12-15T13:24:43.840
> 
> 标签：.net, linq, entity-framework, c#-3.0

我有一个名为 BlogPost 的表，它与 Comment 表具有一对多的关系。（在 Comment 中，有一个外键 BlogPostId。）

现在我想检索所有帖子以及每个帖子的最新评论。我已经尝试过如下所示的 s/t，但它不起作用。

```
from r in Db.BlogPost
select new {Post = r, LatestComment = r.Comments.Last()}; 
```

错误消息听起来像 Last() 不是 EF 支持的运算符。有没有办法处理这个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T13:28:21.740

r.Comments.OrderByDescending(x=>x.Id).FirstOrDefault() 怎么样？

本质上，订购它（最近的第一个），然后拿第一个？

# hyperlink - 彩信中的内部超链接

> ID：368348
> 
> 赞同：3
> 
> 时间：2008-12-15T13:25:32.167
> 
> 标签：hyperlink, wap, mms, wml

是否可以在彩信中放置内部超文本链接（或锚点）。我不想让 MMS 服务的用户在多个链接之间进行选择并进入 MMS。知道怎么可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T14:18:40.470

你是如何编写彩信的？您在使用某种 API 或网关消息编译器吗？还是从头开始创建消息（多部分 MIME）？

我相信 MMS 中的默认 mimetype 是 WAP/WML（可能是 application/vnd.wap.mms-message ？）在这种情况下，您可以将页面构建为一系列卡片。即是这样的：

```
<?xml version="1.0"?>
<!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD WML 1.1//EN"
"http://www.wapforum.org/DTD/wml_1.1.xml">

<wml>

<card id="part1" title="Intro">
<p>
<go href="#part3">click to go to card 3</go>
</p>
</card>

<card id="part2" title="And More">
<p>
blah blah blah
</p>
</card>

<card id="part3" title="Target Page">
<p>
blah blah blah
</p>
</card>

</wml> 
```

w3schools 有[一个很好的 wml 教程](https://web.archive.org/web/20101201115125/http://w3schools.com/wap/wap_intro.asp)

# java - 将任意数据与 ejb 调用上下文相关联

> ID：368350
> 
> 赞同：0
> 
> 时间：2008-12-15T13:26:24.273
> 
> 标签：java, jakarta-ee, ejb-3.0

我有一堆无状态的 ejb 3.0 bean 在链中相互调用。考虑一下，BeanA.do(message) -> BeanB.do() -> BeanC.do() -> BeanD.do()。现在我想从 BeanD.do() 访问消息数据。明显的解决方案是将消息作为参数传递给所有 do() 调用（实际上这就是它现在的工作方式），但我想要一些更好的解决方案。

是否有某种调用上下文？我可以将任意数据与之关联吗？

我想做的，只是将 BeanA.do(message) 中的消息放入与 bean 函数调用关联的一些本地存储中，然后在 BeanD.do() 中检索它。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T15:44:42.590

我不相信 EJB 规范中有任何提供该功能的东西。如果您在特定的应用服务器上，您可能能够使用应用服务器特定的东西（我认为 JBoss 允许您将东西添加到调用上下文）。你也可以使用 JNDI 伪造一些东西。

就我个人而言，这似乎（对我来说）是一个糟糕的设计。如果您在中间有一些您无法控制的代码，我可以看到这样做，但为什么要这样做呢？你让你的代码逻辑很难遵循，因为你有一堆“神奇”的数据，它们只是出现在你的函数中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T03:37:12.477

您可以拥有一个具有访问静态 ThreadLocal 字段的静态 get/set 方法的类。但是，如果您想将 EJB 耦合到其他类，我会接受 james 的建议并仔细考虑。一定要仔细检查您的应用服务器文档，因为我不确定是否支持在 EJB 环境中使用 ThreadLocals。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:26:59.717

我有完全一样的问题。具有讽刺意味的是，这在 jax-ws 或 jax-rpc 中使用 SOAP 很容易做到，但使用 EJB 很难做到。

我正在争论是否要放弃使用 EJB 本地或远程接口，而是通过 JMS 传递消息，这也很容易。

在某些合法情况下需要这样做，但并不代表设计缺陷。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T20:51:49.800

这就是 Seam 提供的。使用纯 Web 服务（即没有 Web GUI 前端）运行有点尴尬。但是，我已经成功了，而且效果很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T06:57:38.667

我需要在 JAX WS 中使用调用上下文。Brent 说：“具有讽刺意味的是，这在 jax-ws 或 jax-rpc 中使用 SOAP 很容易做到，但使用 EJB 很难做到。”

你能告诉我如何在 JAX WS 中使用 Call 上下文吗

# sql - 从几列中选择最小值的最佳方法是什么？

> ID：368351
> 
> 赞同：99
> 
> 时间：2008-12-15T13:27:23.257
> 
> 标签：sql, sql-server, tsql, sql-server-2005, min

鉴于 SQL Server 2005 中的下表：

```
ID   Col1   Col2   Col3
--   ----   ----   ----
1       3     34     76  
2      32    976     24
3       7    235      3
4     245      1    792 
```

编写产生以下结果的查询的最佳方法是什么（即产生最后一列的查询 - 一列包含**每行**的 Col1、Col2 和 Col 3 中的最小值）？

```
ID   Col1   Col2   Col3  TheMin
--   ----   ----   ----  ------
1       3     34     76       3
2      32    976     24      24
3       7    235      3       3
4     245      1    792       1 
```

***更新：***

为了在真实场景中进行澄清（正如我在评论中所说），数据库已**正确规范化**。这些“数组”列不在实际表中，而是在报表所需的结果集中。而新的要求是报表也需要这个 MinValue 列。我无法更改底层结果集，因此我正在寻找 T-SQL 以获得方便的“越狱卡”。

我尝试了下面提到的 CASE 方法，它可以工作，虽然它有点麻烦。它也比答案中所说的更复杂，因为您需要满足同一行中有两个最小值的事实。

无论如何，我想我会发布我当前的解决方案，考虑到我的限制，它工作得很好。它使用 UNPIVOT 运算符：

```
with cte (ID, Col1, Col2, Col3)
as
(
    select ID, Col1, Col2, Col3
    from TestTable
)
select cte.ID, Col1, Col2, Col3, TheMin from cte
join
(
    select
        ID, min(Amount) as TheMin
    from 
        cte 
        UNPIVOT (Amount for AmountCol in (Col1, Col2, Col3)) as unpvt
    group by ID
) as minValues
on cte.ID = minValues.ID 
```

我会提前说我不希望它提供最好的性能，但是考虑到这种情况（我不能只为新的 MinValue 列要求重新设计所有查询），这是一个非常优雅的“越狱”卡片”。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-12-15T13:39:23.123

可能有很多方法可以做到这一点。我的建议是使用 Case/When 来做。有3列，还不错。

```
Select Id,
       Case When Col1 < Col2 And Col1 < Col3 Then Col1
            When Col2 < Col1 And Col2 < Col3 Then Col2 
            Else Col3
            End As TheMin
From   YourTableNameHere 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2015-04-23T21:35:49.533

使用`CROSS APPLY`：

```
SELECT ID, Col1, Col2, Col3, MinValue
FROM YourTable
CROSS APPLY (SELECT MIN(d) AS MinValue FROM (VALUES (Col1), (Col2), (Col3)) AS a(d)) A 
```

[SQL小提琴](http://sqlfiddle.com/#!3/dbbd3/1)

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2016-01-04T11:03:22.697

```
SELECT ID, Col1, Col2, Col3, 
    (SELECT MIN(Col) FROM (VALUES (Col1), (Col2), (Col3)) AS X(Col)) AS TheMin
FROM Table 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2014-04-03T09:46:06.047

在 MySQL 上，使用这个：

```
select least(col1, col2, col3) FROM yourtable 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-03-02T13:09:44.533

您可以使用“蛮力”方法进行扭曲：

```
SELECT CASE
    WHEN Col1 <= Col2 AND Col1 <= Col3 THEN Col1
    WHEN                  Col2 <= Col3 THEN Col2
    ELSE                                    Col3
END AS [Min Value] FROM [Your Table] 
```

当第一个条件失败时，它保证 Col1 不是最小值，因此您可以从其余条件中消除它。对于后续条件也是如此。对于五列，您的查询变为：

```
SELECT CASE
    WHEN Col1 <= Col2 AND Col1 <= Col3 AND Col1 <= Col4 AND Col1 <= Col5 THEN Col1
    WHEN                  Col2 <= Col3 AND Col2 <= Col4 AND Col2 <= Col5 THEN Col2
    WHEN                                   Col3 <= Col4 AND Col3 <= Col5 THEN Col3
    WHEN                                                    Col4 <= Col5 THEN Col4
    ELSE                                                                      Col5
END AS [Min Value] FROM [Your Table] 
```

请注意，如果两个或更多列之间存在关联，则`<=`确保我们`CASE`尽早退出语句。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-15T13:43:17.797

做到这一点的最好方法可能是*不*这样做——奇怪的是，人们坚持以一种需要 SQL“体操”来提取有意义信息的方式来存储他们的数据，而如果你只是用更简单的方法来实现所需的结果更好地构建您的架构:-)

在我看来，*正确的方法是使用下表：*

```
ID    Col    Val
--    ---    ---
 1      1      3
 1      2     34
 1      3     76

 2      1     32
 2      2    976
 2      3     24

 3      1      7
 3      2    235
 3      3      3

 4      1    245
 4      2      1
 4      3    792 
```

with`ID/Col`作为主键（也可能`Col`作为额外的键，取决于您的需要）。然后您的查询变得简单`select min(val) from tbl`，您仍然可以通过`where col = 2`在其他查询中使用来单独处理各个“旧列”。如果“旧列”的数量增加，这也允许轻松扩展。

这使您的查询*变得*更加容易。我倾向于使用的一般准则是，如果您*曾经*在数据库行中有一些看起来像数组的东西，那么您可能做错了什么，应该考虑重组数据。

* * *

但是，如果由于某种原因您*无法*更改这些列，我建议使用插入和更新触发器并添加*另一*列，这些触发器在`Col1/2/3`. 这会将操作的“成本”从选择转移到它所属的更新/插入 - 根据我的经验，大多数数据库表的读取频率远高于写入频率，因此随着时间的推移，写入成本往往会更有效。

换句话说，一行的最小值仅在其他列之一发生变化时才发生变化，因此*您*应该计算它，而不是每次选择时（如果数据没有变化，这将被浪费）。然后你会得到一个像这样的表：

```
ID   Col1   Col2   Col3   MinVal
--   ----   ----   ----   ------
 1      3     34     76        3
 2     32    976     24       24
 3      7    235      3        3
 4    245      1    792        1 
```

必须及时做出决定的任何其他选项`select`通常在性能方面都是一个坏主意，因为数据仅在插入/更新时更改 - 添加另一列会占用数据库中的更多空间，并且插入和更新的速度会稍慢更新，但对于选择来说可以*更快*- 首选方法应该取决于您在那里的优先级，但如前所述，大多数表的读取频率*远*高于写入频率。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-08-28T13:48:52.927

如果列是您的示例中的整数，我将创建一个函数：

```
create function f_min_int(@a as int, @b as int) 
returns int
as
begin
    return case when @a < @b then @a else coalesce(@b,@a) end
end 
```

然后当我需要使用它时，我会这样做：

```
select col1, col2, col3, dbo.f_min_int(dbo.f_min_int(col1,col2),col3) 
```

如果你有 5 个列，那么上面变成

```
select col1, col2, col3, col4, col5,
dbo.f_min_int(dbo.f_min_int(dbo.f_min_int(dbo.f_min_int(col1,col2),col3),col4),col5) 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-15T13:51:25.580

您也可以使用联合查询来执行此操作。随着列数的增加，您将需要修改查询，但至少这是一个直接的修改。

```
Select T.Id, T.Col1, T.Col2, T.Col3, A.TheMin
From   YourTable T
       Inner Join (
         Select A.Id, Min(A.Col1) As TheMin
         From   (
                Select Id, Col1
                From   YourTable

                Union All

                Select Id, Col2
                From   YourTable

                Union All

                Select Id, Col3
                From   YourTable
                ) As A
         Group By A.Id
       ) As A
       On T.Id = A.Id 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-15T13:40:36.193

这是蛮力但有效

```
 select case when col1 <= col2 and col1 <= col3 then col1
           case when col2 <= col1 and col2 <= col3 then col2
           case when col3 <= col1 and col3 <= col2 then col3
    as 'TheMin'
           end

from Table T 
```

...因为 min() 仅适用于一列而不是跨列。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-16T02:40:20.910

这两个[问题](https://stackoverflow.com/questions/196256/returning-the-largest-of-2-columns-in-sql-server-closed) 和[这个问题](https://stackoverflow.com/questions/124417/is-there-a-max-function-in-sql-server-that-takes-two-values-like-mathmax-in-net)都试图回答这个问题。

总结一下，Oracle 对此有一个内置函数，使用 Sql Server，您要么定义用户定义函数，要么使用 case 语句。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-10-11T15:50:54.627

对于多个列，最好使用 CASE 语句，但是对于两个数字列 i 和 j，您可以使用简单的数学：

min(i,j) = (i+j)/2 - abs(ij)/2

此公式可用于获取多列的最小值，但它在 2 之后真的很混乱， min(i,j,k) 将是 min(i,min(j,k))

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-15T13:44:56.543

如果你能够创建一个存储过程，它可能需要一个值数组，你可以调用它。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-15T13:46:11.143

```
select *,
case when column1 < columnl2 And column1 < column3 then column1
when columnl2 < column1 And columnl2 < column3 then columnl2
else column3
end As minValue
from   tbl_example 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-15T15:53:13.947

如果您使用 SQL 2005，您可以执行以下操作：

```
;WITH    res
          AS ( SELECT   t.YourID ,
                        CAST(( SELECT   Col1 AS c01 ,
                                        Col2 AS c02 ,
                                        Col3 AS c03 ,
                                        Col4 AS c04 ,
                                        Col5 AS c05
                               FROM     YourTable AS cols
                               WHERE    YourID = t.YourID
                             FOR
                               XML AUTO ,
                                   ELEMENTS
                             ) AS XML) AS colslist
               FROM     YourTable AS t
             )
    SELECT  YourID ,
            colslist.query('for $c in //cols return min(data($c/*))').value('.',
                                            'real') AS YourMin ,
            colslist.query('for $c in //cols return avg(data($c/*))').value('.',
                                            'real') AS YourAvg ,
            colslist.query('for $c in //cols return max(data($c/*))').value('.',
                                            'real') AS YourMax
    FROM    res 
```

这样你就不会迷失在这么多运营商中:)

但是，这可能比其他选择慢。

这是你的选择...

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-08-30T20:53:15.057

联合查询的一点转折：

```
DECLARE @Foo TABLE (ID INT, Col1 INT, Col2 INT, Col3 INT)

INSERT @Foo (ID, Col1, Col2, Col3)
VALUES
(1, 3, 34, 76),
(2, 32, 976, 24),
(3, 7, 235, 3),
(4, 245, 1, 792)

SELECT
    ID,
    Col1,
    Col2,
    Col3,
    (
        SELECT MIN(T.Col)
        FROM
        (
            SELECT Foo.Col1 AS Col UNION ALL
            SELECT Foo.Col2 AS Col UNION ALL
            SELECT Foo.Col3 AS Col 
        ) AS T
    ) AS TheMin
FROM
    @Foo AS Foo 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-08-28T19:47:52.427

如果您知道要查找的值（通常是状态代码），则以下内容可能会有所帮助：

```
select case when 0 in (PAGE1STATUS ,PAGE2STATUS ,PAGE3STATUS,
PAGE4STATUS,PAGE5STATUS ,PAGE6STATUS) then 0 else 1 end
FROM CUSTOMERS_FORMS 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-01-02T00:37:59.987

下面我使用一个临时表来获得几个日期的最小值。第一个临时表查询多个连接表以获取各种日期（以及查询的其他值），然后第二个临时表使用与日期列一样多的通道获取各种列和最小日期。

这本质上类似于联合查询，需要相同数量的通过，但可能更有效（基于经验，但需要测试）。在这种情况下，效率不是问题（8,000 条记录）。一个可以索引等。

```
--==================== this gets minimums and global min
if object_id('tempdb..#temp1') is not null
    drop table #temp1
if object_id('tempdb..#temp2') is not null
    drop table #temp2

select r.recordid ,  r.ReferenceNumber, i.InventionTitle, RecordDate, i.ReceivedDate
, min(fi.uploaddate) [Min File Upload], min(fi.CorrespondenceDate) [Min File Correspondence]
into #temp1
from record r 
join Invention i on i.inventionid = r.recordid
left join LnkRecordFile lrf on lrf.recordid = r.recordid
left join fileinformation fi on fi.fileid = lrf.fileid
where r.recorddate > '2015-05-26'
 group by  r.recordid, recorddate, i.ReceivedDate,
 r.ReferenceNumber, i.InventionTitle

select recordid, recorddate [min date]
into #temp2
from #temp1

update #temp2
set [min date] = ReceivedDate 
from #temp1 t1 join #temp2 t2 on t1.recordid = t2.recordid
where t1.ReceivedDate < [min date] and  t1.ReceivedDate > '2001-01-01'

update #temp2 
set [min date] = t1.[Min File Upload]
from #temp1 t1 join #temp2 t2 on t1.recordid = t2.recordid
where t1.[Min File Upload] < [min date] and  t1.[Min File Upload] > '2001-01-01'

update #temp2
set [min date] = t1.[Min File Correspondence]
from #temp1 t1 join #temp2 t2 on t1.recordid = t2.recordid
where t1.[Min File Correspondence] < [min date] and t1.[Min File Correspondence] > '2001-01-01'

select t1.*, t2.[min date] [LOWEST DATE]
from #temp1 t1 join #temp2 t2 on t1.recordid = t2.recordid
order by t1.recordid 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-11-10T10:11:16.667

```
SELECT [ID],
            (
                SELECT MIN([value].[MinValue])
                FROM
                (
                    VALUES
                        ([Col1]),
                        ([Col1]),
                        ([Col2]),
                        ([Col3])
                ) AS [value] ([MinValue])
           ) AS [MinValue]
FROM Table; 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-07-19T23:43:12.853

当 Col1 < Col2 和 Col1 < Col3 然后 Col1 当 Col2 为 null 并且 Col3 为 null 然后 Col1 当 Col1 < Col2 和 Col3 为 null 然后 Col1 当 Col1 < Col3 和 Col2 为 null 然后 Col1 当 Col2 < Col1 和 Col2 < Col3 然后Col2 当 Col1 为 null 且 Col3 为 null 然后 Col2 当 Col2 < Col1 且 Col3 为 null 然后 Col2 当 Col2 < Col3 且 Col1 为 null 然后 Col2 当 Col3 < Col1 且 Col3 < Col2 然后 Col3 当 Col1 为 null 且 Col2 为 null 然后Col3 当 Col3 < Col1 和 Col2 为空时 Col3 当 Col3 < Col2 和 Col1 为空 然后 Col3 当 Col2 = Col3 然后 Col2 当 Col1 = Col3 然后 Col1 当 Col1 = Col2 然后 Col1 当 Col2 = Col3 和 Col1 = Col3 然后 Col1
否则空结尾为'MIN'

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-04-18T13:25:02.967

我知道这个问题很老，但我仍然需要答案，并且对其他答案不满意，所以我不得不设计自己的答案，这是对@paxdiablo[答案](https://stackoverflow.com/a/368394/3336667)的一个转折。

* * *

我来自 SAP ASE 16.0，我只需要查看某些数据的统计数据，恕我直言，这些数据有效地存储在单行的不同列中（它们代表不同的时间 - 计划到达的时间，预期的时间行动开始了，最后是什么实际时间）。因此，我已将列转置到临时表的行中，并像往常一样对此进行了查询。

注意**前面不是一刀切的解决方案！**

```
CREATE TABLE #tempTable (ID int, columnName varchar(20), dataValue int)

INSERT INTO #tempTable 
  SELECT ID, 'Col1', Col1
    FROM sourceTable
   WHERE Col1 IS NOT NULL
INSERT INTO #tempTable 
  SELECT ID, 'Col2', Col2
    FROM sourceTable
   WHERE Col2 IS NOT NULL
INSERT INTO #tempTable 
  SELECT ID, 'Col3', Col3
    FROM sourceTable
   WHERE Col3 IS NOT NULL

SELECT ID
     , min(dataValue) AS 'Min'
     , max(dataValue) AS 'Max'
     , max(dataValue) - min(dataValue) AS 'Diff' 
  FROM #tempTable 
  GROUP BY ID 
```

这在 630000 行的源集上花费了大约 30 秒，并且只使用了索引数据，所以不是在时间关键的过程中运行的东西，而是像一次性数据检查或一天结束的报告这样的事情，你可能会很好（但请与您的同事或上级核实！）。这种风格*的*主要好处是我可以轻松地使用更多/更少的列并更改分组、过滤等，尤其是在复制数据后。

附加数据 ( `columnName`, `max`es, ...) 是为了帮助我进行搜索，因此您可能不需要它们；我把它们留在这里也许是为了激发一些想法:-)。

# performance - 为什么在 MATLAB 中缓存答案需要更长的时间？

> ID：368359
> 
> 赞同：2
> 
> 时间：2008-12-15T13:29:21.380
> 
> 标签：performance, matlab

我在 MATLAB 中有一个长时间运行的函数，我试图通过添加缓存来加速它并最终显着降低了我的性能。我的代码基本上是在边缘检测图像中搜索连续的“水平”线，原始代码如下所示：

```
function lineLength = getLineLength(img, startRow, startCol)
    [nRows, nCols] = size(img);
    lineLength = 0;
    if startRow < 1 || startRow > nRows
        return;
    end

    for curCol = startCol:nCols
        if img(curCol)
            lineLength = lineLength + 1;
            continue;
        elseif lineLength > 0
            lengths = zeros(2,1);
            lengths(1) = getLineLength(img, startRow - 1, curCol);
            lengths(2) = getLineLength(img, startRow + 1, curCol);
            increment = max(lengths);
            lineLength = lineLength + increment;
        end
        break; %// At this point the end of the current line has been reached
    end
end function 
```

由于这个函数的性能不是我想要的，我想我会从任何一点添加长度缓存，如下所示：

```
function lineLength = getLineLength(img, startRow, startCol)
persistent pointCache; 
    if startRow == 0 && startCol == 0
        pointCache = zeros(size(img, 1), size(img, 2), 2);
    end
    [nRows, nCols] = size(img);
    lineLength = 0;
    if startRow < 1 || startRow > nRows
        return;
    end

    for curCol = startCol:nCols
        if pointCache(startRow, curCol, 2)
            lineLength = lineLength + pointCache(startRow, curCol, 1);
            break;
        end
        if img(curCol)
            lineLength = lineLength + 1;
            continue;
        elseif lineLength > 0
            lengths = zeros(2,1);
            lengths(1) = getLineLength(img, startRow - 1, curCol);
            lengths(2) = getLineLength(img, startRow + 1, curCol);
            increment = max(lengths);
            lineLength = lineLength + increment;
        end
        break; %// At this point the end of the current line has been reached
    end
    pointCache(startRow, startCol, 1) = lineLength;
    pointCache(startRow, startCol, 2) = 1;
end function 
```

令我惊讶的是，实现这种缓存实际上使我的性能更差，而不是更好。我最好的猜测是`global`变量给我带来了麻烦，或者它使用了额外的内存，但我没有足够的 MATLAB 经验知道。

**已编辑...**

正如 Gautam 正确指出的那样，原始代码中存在一个忽略递归结果的错误。这就是实际代码的作用。我确信这很明显，但 MATLAB 不是我的母语，所以如果有更 MATLAB 的方式来做到这一点，我会喜欢这些建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T15:11:21.627

我很确定全局不是问题，但就风格而言，您应该使用 a `persistent`，它在调用之间保持它的值，但对于函数来说是本地的。

每当您遇到性能问题时，请配置文件。调用`profile on`，然后调用你的函数，然后调用`profile report`。它会指出你真正的性能问题。直觉很少有利于分析问题，尤其是在 matlab 中。您可以阅读帮助，但它非常不言自明。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T17:01:30.873

It's not clear to me what the function does. In particular, why do you recursively call getLineLength and then effectively throw away the results (you only test if increment is greater than zero)?

My guess for why pointCache doesn't help: your function probably doesn't call itself repeatedly with the same paramters (startRow, startCol). Have you tried to log how many times getLineLength is called for a particular startRow and startCol?

Whatever your algorithm is, using recursion to iterate over a image is **completely unsuited** to MATLAB's strengths. If you want high performance:

1.  Set up your algorithm to use iteration instead of recursion, and
2.  Figure out how to vectorize the iterated parts.

Some tips on vectorizing:

*   Use built-in functions like `sum`, `cumsum`, `diff`, `bsxfun`, and `accumarray` to operate directly over the image matrix.
*   Complicated double-iteration computations on images can sometimes be reexpressed as matrix multiplications.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T13:42:33.287

我的猜测是您正在缓存代码的错误部分。elseif 部分的递归似乎是真正的瓶颈。整个算法对我来说看起来有点奇怪，也许你最好尝试这样的事情（虽然我不确定这是否是你想要的）：

```
for every pixel p in img
  if (pixel p set)
    linelength = 1
    p2 = p
    while (pixel p2 set) and (p2 in same column as p)
      p++ // don't check lines twice
      p2++
      linelength++
    endwhile
  endif 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-18T04:09:05.503

据我所知，您正在尝试查找每列的非零元素的数量，尽管代码似乎并没有完全实现这一点。会像以下工作：

```
lineLengths = max(cumsum(img~=0, 1), 1) 
```

如果您尝试从图像中提取 blob，请考虑使用 BWLABEL 函数。

我赞同 Gautam 所说的在 Matlab 中通常运行良好的内容。

# c# - 在 C# 中使用正则表达式提取字符串的逗号分隔部分

> ID：368362
> 
> 赞同：2
> 
> 时间：2008-12-15T13:32:46.537
> 
> 标签：c#, regex

样本数据：!!Part|123456,ABCDEF,ABC132!!

逗号分隔列表可以是任意数量的字母和数字的任意组合

我想要一个正则表达式来匹配逗号分隔列表中的条目：

我所拥有的是： !!PART\|(\w+)(?:,{1}(\w+))*!!

这似乎可以完成这项工作，问题是我想将它们按顺序检索到 ArrayList 或类似的数据中，因此在我想要的示例数据中：

*   1 - 132456
*   2 - ABCDEF
*   3 - ABC123

我的代码是：

```
string partRegularExpression = @"!!PART\|(\w+)(?:,{1}(\w+))*!!"
Match match = Regex.Match(tag, partRegularExpression);
ArrayList results = new ArrayList();

foreach (Group group in match.Groups)
{
    results.Add(group.Value);
} 
```

但这给了我意想不到的结果。我错过了什么？

谢谢

**编辑：** 一个解决方案是使用像 !!PART\|(\w+(?:,??\w+)*)!! 这样的正则表达式 捕获逗号分隔的列表，然后按照 Marc Gravell 的建议进行拆分

但是，我仍然对此有用的正则表达式感到好奇：o）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T13:57:29.873

您可以使用拆分：

```
string csv = tag.Substring(7, tag.Length - 9);
string[] values = csv.Split(new char[] { ',' }); 
```

或正则表达式：

```
Regex csvRegex = new Regex(@"!!Part\|(?:(?<value>\w+),?)+!!");
List<string> valuesRegex = new List<string>();
foreach (Capture capture in csvRegex.Match(tag).Groups["value"].Captures)
{
    valuesRegex.Add(capture.Value);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T13:41:13.790

除非我弄错了，那仍然只算一组。我猜你需要做一个 string.Split(',') 来做你想做的事？确实，在这里完全不用正则表达式看起来要简单得多......根据数据，如何：

```
 if (tag.StartsWith("!!Part|") && tag.EndsWith("!!"))
        {
            tag = tag.Substring(7, tag.Length - 9);
            string[] data = tag.Split(',');
        } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T13:54:48.833

我认为您正在寻找的 RegEx 是这样的：

```
(?:^!!PART\|){0,1}(?<value>.*?)(?:,|!!$) 
```

然后可以像这样运行

```
 string tag = "!!Part|123456,ABCDEF,ABC132!!";

        string partRegularExpression = @"(?:^!!PART\|){0,1}(?<value>.*?)(?:,|!!$)";
        ArrayList results = new ArrayList();

        Regex extractNumber = new Regex(partRegularExpression, RegexOptions.IgnoreCase);
        MatchCollection matches = extractNumber.Matches(tag);
        foreach (Match match in matches)
        {
            results.Add(match.Groups["value"].Value);
        }            

        foreach (string s in results)
        {
            Console.WriteLine(s);
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T13:53:25.357

以下代码

```
string testString = "!!Part|123456,ABCDEF,ABC132!!";
foreach(string component in testString.Split("|!,".ToCharArray(),StringSplitOptions.RemoveEmptyEntries) )
{
    Console.WriteLine(component);
} 
```

将给出以下输出

```
Part
123456
ABCDEF
ABC132 
```

这样做的好处是使字符串的逗号分隔部分与您在原始问题 (1,2,3) 中指定的索引号（可能不小心不正确）匹配。

高温高压

-EDIT- 忘了提一下，如果每个字符串的格式与上面预期的不一样，这可能会有缺点，但是如果没有非常复杂的正则表达式，它也会很容易破坏。

# sql - 如何实施自定义评级系统（日期相关性下降）

> ID：368369
> 
> 赞同：2
> 
> 时间：2008-12-15T13:35:18.873
> 
> 标签：sql, linq, algorithm

在用户可以提交“故事”方面，我正在一个类似于 digg 的网站上工作。

我跟踪每个项目获得了多少“投票”和“类似添加”。类似的添加被定义为两个用户添加相同的“链接”。

这是算法的*一部分*（本质上是最重要的）：

```
y = day number 
sy = number of adds on day y

∑ y[1:10]  sy / y 
```

因此，基本上计算指定日期的“类似添加”的数量，然后除以自发布内容以来的秒数。在过去 10 天内执行此操作（例如）。

但是，我不确定如何实现它以使其表现良好。我能想到的每一种方法都会很慢。

我能想到实现这一点的唯一方法是计算过去 10 天内提交的每个项目的添加数量将永远持续下去。（因此，在过去 10 天内执行了 10 次按日期分组的 sql 命令 - 显然这种方法很糟糕）。

即使我保留一个每天更新一次的表（并在后台运行上述 sql），一旦数据库变大，它仍然会非常慢。加上评级将“过时”，因为它不是实时的（例如突发新闻“项目”永远不会到达顶部）。

有没有人有任何经验如何去做这件事？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T14:40:59.583

试试这个：每个人都有一票。你的投票坚持你投票的最后一件事。时间的东西将来自用户行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-18T15:55:44.760

你可以做一个对数加权平均。这样做的好处是您只需要存储“当前值”和加权平均值。在您的情况下，“当前值”可能是当天的投票数，您可以每晚重新计算加权平均值。

```
const float WeightFactor = 0.70; //for example
float PreviousAverage = GetPreviousAverage();
float CurrentValue = GetVoteCountToday();

float NewAverage = (WeightFactor * CurrentValue) + ( (1-WeightFactor) * PreviousAverage); 
```

仅当您有一个以设定频率出现的新值时，这才真正有效。如果您想在任意时间重新计算您的投票，那么这是行不通的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T14:21:49.153

不需要执行 SQL 10 次即可获得结果，您可以在一次执行中获得它，例如：

```
select sum(dayval)
from
( select count(*) / (current_date-day+1) dayval
  from votes
  where story_id = 123
  and day >= current_date - 9
  group by (current_date-day+1)
) 
```

（实际代码因使用的 DBMS 而异）。

我并不是说这会表现良好！

也许是一个折衷方案：在每日批处理中计算并存储“一天的开始”值，然后为一天中收到的每张选票将存储值加 1？

# wpf - Winforms和WPF的性能对比

> ID：368371
> 
> 赞同：16
> 
> 时间：2008-12-15T13:35:59.400
> 
> 标签：wpf, winforms, xaml

由于 XAML 被编译，因此在执行这样的代码时应该没有区别。
Winforms（类似代码）：

```
Form formPeter = new Form();
Textbox textbox = new Textbox();
Label l1 = new Label1(); 
```

正如我所想的那样，Xaml 不会在运行时被解析... :-)

但是如何渲染/执行带有大量控件的大型表单呢？哪种技术更快？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-15T14:10:43.340

哪种技术更快？恐怕你的问题并没有一个简单的答案。

您关于在运行时未解析 XAML 的评论是真假。虽然未解析 XAML，但在运行时解析**称为**BAML 的规范化二进制版本（作为资源嵌入到应用程序中） 。说 DirectX 比 GDI 更快也是一种简化 - WPF 和基于 GDI 的渲染技术只是具有**不同的**性能特征。例如 WPF 使用保留呈现模式，而 WinForms 和其他基于 GDI 的技术则不使用。WPF 对象往往更重，因为它们支持的属性比它们的 winform 对象多得多。我们在如何使 GDI 运行得非常快方面拥有数十年的知识，而使用 WPF 和 XAML 的时间相对较短。

WPF 对于编写应用程序来说足够快，但您需要时刻保持警惕，以免元素数量过多（例如，通过创建过于复杂的模板，然后让它们在 UI 中重复数百或数千次）。此外，WPF 在不同的图形硬件上执行不同（因为它在内部调用 DirectX）。2D 内容在 WPF 中应该没问题，即使它完全在软件中渲染（比如在虚拟机上的方式），但具有大量元素的动画、抗锯齿 3D 需要真正的 GPU 能力。随着时间的推移，图形硬件变得更加强大和流行，以及关于如何调整 WPF 性能的知识得到改进，我们应该看到 WPF 进一步领先（假设现在稍微如此......对于某些场景......有时）。所以我想答案是“这取决于”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T13:53:02.173

WPF 使用 DirectX 进行渲染（速度更快）而不是本机 Windows GDI。

您可能已经知道，Native GDI 是基于位图的。由于 WPF 是基于矢量的，因此与 GDI 相比，WPF 可以以更好的方式利用硬件支持。

然而，选择 WPF 或 Winforms 的决定在很大程度上取决于其他因素——你在 UI 中需要的灵活性、有多少媒体支持你的应用程序需要等。WPF 不是 Winforms 的替代品——它也不是银牌所有问题的子弹。

随着更多硬件加速功能的出现，WPF 可以提供比 Winform 应用程序更好的性能。

我之前读过一些有趣的博客。

[约翰的帖子](http://joshsmithonwpf.wordpress.com/2007/09/05/wpf-vs-windows-forms/)

[罗布的帖子](http://rrelyea.spaces.live.com/Blog/cns!167AD7A5AB58D5FE!2365.entry)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T15:19:58.210

WPF 绘图要快得多，但对象更重。如果你放入 1000 个单独的按钮，它就会爬行。另一方面，这些按钮可以具有复杂的透明度和渐变，而不会显着影响性能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-01-15T16:23:43.117

WPF 与 Winforms 的性能不再是主要标准。

我知道以前有人问过这个问题，但是鉴于 .NET 4.x 以及使 WPF 性能更高的改进，社区是否认为性能不再是选择一种技术而不是另一种技术的标准。

由于 WPF 相对于 WinForms 的几个架构优势，在需要复杂 UI、样式自定义和图形密集型场景的场景中，整体 WPF 桌面应用程序的性能明显优于等效的 WinForms 代码：

*   更好地利用 GPU
*   保留模式渲染
*   更高效的数据绑定 更高效的对象树构建
*   更有效的 RAM 使用（使用 DependencyObject）
*   更小的程序代码

然而，两者的性能都足够快，我认为性能不会是选择 WPF 而不是 WinForms 的主要原因。它将能够更快地创建更好的应用程序。

游戏开发人员和其他需要终极性能的人不会将 WPF 或 WinForms 用于其 UI 的关键部分：他们将针对 Direct3D 甚至硬件进行编程。

[本文](https://docs.microsoft.com/en-us/windows/desktop/choose-your-technology)介绍了平台（UWP、WPF 和 Windows 窗体）并帮助您确定最适合您的应用程序的平台。

对于 Winforms 单元测试，您要做的第一件事是确保将业务逻辑与表单正确分离。基本上，使用 MVC 模式。然后，您可以轻松地测试表单之外的所有内容，就好像表单甚至不存在一样。

# outlook - 开始使用 MAPI 的最佳方式是什么？

> ID：368376
> 
> 赞同：6
> 
> 时间：2008-12-15T13:37:13.110
> 
> 标签：outlook, exchange-server, mapi

为了在服务器和客户端上创建用于流程自动化的工具，我一直在花时间研究 MAPI。与其他来源相比，我在网上阅读的大多数资源要么缺乏细节和/或示例，要么充满了相互矛盾的信息。

假设我了解 C++、COM 和 .NET，哪些印刷或在线资源最适合入门并包含详细参考？

背景：我在 Exchange 2003 环境中工作。我们可能有一天会使用 Exchange 2007，但没有推动力。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T22:26:04.743

**[Inside MAPI](http://books.google.co.uk/books?id=UZ5jQgAACAAJ)**肯定是关于这个主题的最好的书。您可以在网站上购买电子书 - 如果您更喜欢死树版，您将不得不在亚马逊上购买非常昂贵的二手书（我实际上已经这样做了）。

由于 Outlook 是基于 MAPI 构建的，因此它已被证明是访问 Outlook 和 Exchange 的最稳定的技术，因为 Microsoft 倾向于在每个 Exchange 版本中引入至少一个新的 API。

MAPI 一直存在、存在并且将来还会存在。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T13:40:27.863

我认为 MAPI 正在被 MS 自己逐步淘汰，并且应该将 WebDAV 作为从 Exchange 访问信息的首选方式？我鼓励你也这样做...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T17:26:40.170

“Inside MAPI”是该主题的最佳书籍。它已绝版，但您仍然可以在周围找到它。最好的方法可能是从 Microsoft 下载[MFCMapi](http://mfcmapi.codeplex.com/)及其源代码，然后看看他们是如何做到的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T19:55:44.927

我们正在做一个客户端 Outlook 应用程序以及一些服务。MAPI 似乎是最持久的 API。我担心未来，但似乎支持将继续，因为 OL 是建立在 MAPI 之上的。但是，客户端库是作为单独安装提供的。我还鼓励您查看 Outlook Redemption。这对我们来说是一个救命稻草：[http ://www.dimastr.com/redemption/](http://www.dimastr.com/redemption/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-19T17:09:33.963

您可能还想查看 OutlookSpy [(http://www.dimastr.com/outspy/home.htm](http://www.dimastr.com/outspy/home.htm) ) - 它直接内置于 Outlook 中，让您查看各种 MAPI 和 Outlook 对象模型对象。

# asp.net-mvc - 在 asp.net mvc 中选择列表用法

> ID：368377
> 
> 赞同：8
> 
> 时间：2008-12-15T13:37:14.017
> 
> 标签：asp.net-mvc, caching, selectlist

我正在开发一个 MVC 站点，这是我的公司所做的第一个，我发现自己经常做的一件事是在控制器中创建选择列表，将它们放入 viewdata 并在创建 html.DropDownList 时读取它们。有几件事让我觉得我做事的方式很臭。

1.  某些页面可以重复列表（酒店房间的董事会费率，用户可以根据需要向酒店添加任意数量的房间），目前我使用相同的选择列表，这是一种好的做法还是应该每个人都有一个？

2.  在前面的示例中，“房间”是一个 ascx，由 renderpartial 或通过 jquery 的 ajax 调用呈现。控制器传递选择列表以便ascx可以使用它的最佳方式是什么，目前我添加到页面的viewdata中，它将它的viewdata传递给renderpartial，但是在ajax调用上还需要添加action方法ascx 的 Viewdata 的选择列表，又不确定这是最好的方法。

3.  我有一个存储库，它保存这个“静态”数据并作为通用列表返回，所以每次控制器需要数据时，它都会访问列表的存储库（除了董事会费率之外，还有一些其他的东西，比如人的头衔，先生，夫人等）我怀疑某种缓存会更好，因为数据很少发生变化。

有人在这些领域有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T14:14:13.583

1.  如果这些 SelectLists 完全相等，那么我肯定最好将一个列表用于多个 DropDownLists。

2.  看起来像它的常见用法。我也在使用类似的方法，但是考虑将一些控件移植到 Html.RenderAction，因为通过页面的 ViewData 来控制对我来说也感觉不好。是的，我知道它不会是纯 MVC :)

3.  如果你的 ORM 支持缓存，当然使用它。

但是，如果您的项目不小并且您认为它会继续增长，我建议在您的存储库之上实现一个服务层（PoEAA 模式），该层也将包含业务逻辑和缓存管理逻辑。

如果你想透明地管理你的缓存，而不影响你的 dal 或 mvc 层，我认为最好的方法是使用 AOP。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T21:07:53.513

一种方法是通过类型化视图将选择列表所需的数据放入模型中。视图可以遍历模型中的数据以生成它需要的任何选择列表。您也可以将对象直接填充到 ViewData 集合中，但我认为拥有类型化视图会产生更简洁的代码。

# objective-c - Mac 和 iOS Cocoa/Objective C 的编程控件是否有任何商业添加？

> ID：368383
> 
> 赞同：11
> 
> 时间：2008-12-15T13:40:04.510
> 
> 标签：objective-c, ios, macos, cocoa, custom-controls

如果为 Windows .NET API 进行开发，我可以使用 100 种商业上可用的附加控件、图形 API 和其他有用的东西来增加我的工作量。谁能指出我在 Mac Cocoa/Objective C 开发中类似的商业软件的方向？

**此外：**

是否有足够的开发人员在商业上做这件事？

我的问题的重点是 Mac 开发者市场已经足够成熟，可以支持商业开发者附加组件。我知道有“开源”......一切似乎都默认......主要是因为还没有人带路。开源免费软件的问题是有一天所有人都变成了可怜的、半不熟练的无家可归者，他们将免费的东西拼在一起。我们值得更好！

如果您没有注意到 Mac 市场上的人们愿意为好东西买单。

我有销售开发工具的历史。你不必只是把这些东西送出去。

托尼

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T17:14:21.927

我见过的大多数此类可重用的源代码和框架都是免费的，而不是商业的。其中，大多数都在 BSD 或 MIT 许可下，这意味着您可以在~~商业的~~闭源软件。（极少数属于 GPL 之一，该 GPL 禁止这样做。）

我有[一份清单](http://boredzo.org/opensourcelinks)，虽然现在还很不完整。我在 OmniOutliner 中有一个更长的列表，以及一个用于展示它的更好网站的宏伟计划。

还有[MacCode](http://code.google.com/p/maccode/)，它是可重用源代码和框架的存储库。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T15:42:03.373

[Omni 框架](http://www.omnigroup.com/developer/)用于商业软件，尽管它们本身是开源的。我怀疑是否有足够的 OS X 开发人员来真正支持小型独立闭源库供应商。您也许可以发布开源库并销售咨询或文档服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-08T16:27:35.717

我找到了一个很棒的网站，上面有 Mac 和 iOS 自定义控件和源代码。查看[可可控件](http://www.cocoacontrols.com)

# .net - 当发布 dll 不起作用但调试 dll 起作用时

> ID：368384
> 
> 赞同：18
> 
> 时间：2008-12-15T13:40:08.830
> 
> 标签：.net, debugging

在将我们庞大的分布式系统部署到我们的一个客户之后，我们遇到了一个意外错误。在调查期间，我们将导致错误的组件替换为添加了一些诊断代码的组件。我们使用的 dll 是在调试模式下构建的。突然之间，一切都奏效了！

用发布版本（带有诊断代码）替换调试 dll 使其再次崩溃。

我们的代码中没有预编译器指令、条件调试属性等。该问题已在两个不同的安装站点中发现，而在其他几个站点中都可以正常工作。

（该项目混合了 C# 和 VB.NET，麻烦的程序集是 VB.NET..，如果这有什么不同的话）

所以问题是：***在这种情况下你会怎么做？通常是什么原因？***欢迎提供有关调试此问题的任何建议。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-15T13:48:52.027

对于原因......好吧，一些症状的暗示会有所帮助。一种可能性是你有一个类似的方法的代码`Debug.WriteLine`有副作用（即使它工作）。`[Conditional(...)]`除非您定义了正确的符号，否则不会编译对标记为的方法的调用- 因此任何标记的内容`[Conditional("DEBUG")]`都将被静默删除。

它也可能是编译器错误，但这有点不太可能（但并非不可能）。

症状是什么？怎么破？

作为上述示例：

```
 static string Bar { get; set; }
    static void Main()
    {
        Bar = "I'm broken";
        Debug.WriteLine(Foo());
        Console.WriteLine(Bar);
    }
    // note Foo only called in DEBUG builds
    static string Foo()
    {
        Bar = "I'm working";
        return "mwahahah";
    } 
```

在调试模式下编译它会打印“我正在工作”；在 RELEASE 模式下编译它会打印“我坏了”。这听起来相似吗？检查您是否没有*直接*使用具有副作用的东西调用任何调试方法。在大多数情况下，您可以通过间接修复：

```
string foo = Foo();
Debug.WriteLine(foo); 
```

现在它在任何一种模式下都会被调用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T13:53:16.653

您可以尝试在构建设置中关闭优化代码。你得到的实际错误是什么。

您可以做的另一件事是在发布模式下编译，但启用 #Debug 条件。如果您使用 Diagnostics.Debug 并且其中的代码影响您的应用程序，这将处理这种情况。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T14:21:27.233

您是否尝试过包含调试文件？(pdb)

如果你去你的项目设置然后编译'选项卡'在顶部附近的下拉列表中选择你的发布版本，然后选择底部附近的高级编译选项，确保将其设置为创建完整的调试信息，然后重新部署，你应该现在获取有关崩溃原因的更多详细信息。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-15T14:53:47.340

我已经看到导致 Debug 和 Release 构建之间出现问题的时间。通常 Debug 构建运行比 Release 构建慢。您可能想要检查代码的时间关键部分。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-15T13:58:35.237

```
Debug.Assert(ImportantMethod()); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-15T14:16:16.653

如果您不在单线程代码中工作，则可能是某种竞争条件。例如，如果您的程序的某些部分需要在其他部分访问它之前执行某些操作，它可能会在发布模式下失败，因为代码访问得太早。我们曾经在一些手机代码中遇到过类似的问题，这些代码在模拟器中运行良好，但在速度较慢的手机上，情况完全不同。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-07-25T19:43:53.503

包含为多个客户端应用程序提供的 WCF 客户端的 C# DLL 也有同样的问题。

发现 C# 客户端库中有一个方法访问 StackTrace 以进行日志记录，在调试中编译时恰好不同。

```
StackTrace stackTrace = new StackTrace();
MethodBase methodBase = stackTrace.GetFrame(2).GetMethod(); 
```

`GetFrame(2)`发布时不存在。更多信息可以在这里找到：[StackTrace 类方法在发布模式下不起作用](https://stackoverflow.com/questions/26292033/stacktrace-class-methods-not-working-in-release-mode)

有趣的是一个 VB.NET 客户端受到影响，而在另一个 C#.NET 客户端中它工作正常。

希望能帮助到你。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-11T21:41:17.697

确保应用程序正在正确的平台目标下构建。这可能是一个问题，尤其是在提供或使用 DLL 时。在“Project->Properties”下查看并选择“Build”选项卡。平台目标选项将允许您在任何 CPU（默认）、x86 或 x64 之间进行选择。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-15T15:14:27.460

有一次我遇到了终结器比预期更早关闭的问题，因为我没有完全理解终结器、垃圾收集器之间的相互作用，以及当一个本地对象被认为是可回收的（提示：它不在块）。如果您的代码使用终结器，您可能希望查看 GC.KeepAlive()。在以下块中：

```
void MyFunction() 
{ 
  Foo f = new Foo();
  SomeFunction(f.SomeProp);
} 
```

`f`甚至在运行之前就有资格完成`SomeFunction()`！如果终结者做了一些事情，比如处置任何`SomeProp`手，你可能会遇到麻烦。`GC.KeepAlive(f)`在调用 to之后添加调用 to`SomeFunction`确保`f`在调用`KeepAlive()`.

编辑：毕竟，我忘了指出这个问题在发布模式下运行时更加明显。我不知道 Debug 构建是否将隐式 KeepAlives 放在函数末尾以使调试器受益，或者垃圾收集是否只是不那么激进，或者是什么，但在我的情况下，Release 模式极大地加剧了这个问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-07-31T14:46:02.423

首先对我的英语感到抱歉。我知道这篇文章很旧，但我也遇到了同样的问题，我意识到在调试模式下构建是为**32 位 OS**制作的，而发布模式默认为**64 位**。这使得为​​ 32 位制作的 DLL 在发行版中不起作用。如果你去 Project properties -> build 你可以选择你想要的架构。这对我有用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-15T01:59:35.723

我有一个类似的问题。我的情况是这样的：我在类库 A 中定义了一些反射函数。然后我定义了一个 WPF 用户控件库 B，它使用库 A 中的函数。然后我编写了一个应用程序，它使用库 B 中的用户控件和函数库 A。当我使用库 B 的调试版本时，它工作正常。但是当我使用库B的发布版本时，反射功能不起作用。我还在库A中定义了其他函数。似乎只有反射函数会造成麻烦。我想不出原因。最后，我放弃了，将反射函数从库 A 移到了库 B。它奏效了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-14T10:27:37.203

您可能知道这一点，但是，有时在调试和发布版本中初始化变量的方式不同。例如，我认为变量在 VC6 调试版本中是自动初始化的，如果您没有初始化某些东西，这可能会隐藏问题。我还认为调试数组可能会使用哨兵字节来指示溢出。这也可能导致不同的行为。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-09-06T13:38:30.010

你解决了你的问题吗？
我和你有同样的问题。
如果我在调试中编译 dll，一切正常。
如果我在发布中编译，我会得到一个空引用异常。
但是，如果我在某些方法调用中包含类似上述的一些行，即使在发布模式下，异常也会消失：
System.Diagnostics.EventLog.WriteEntry("blablabla", "blablabla")

希望对您有所帮助。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-09-29T20:15:41.473

在我的情况下，我的 DLL 使用者项目（在 VS 中）具有 x64 配置，但解决方案在任何 CPU 中。由于某种原因，在运行应用程序时，这并没有与我的 x64 DLL 挂钩。我将应用程序配置为明确的 x64 平台，一切正常。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-10-25T15:52:52.377

这可能与原始问题无关，但对于运行应用程序的任何人来说

```
var isThisMyAssembly = System.Reflection.Assembly.GetCallingAssembly(); 
```

该调用可能会在运行时内联到另一个程序集中的方法中，因此会得到意外的输出（如[MSDN 文档](https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assembly.getcallingassembly?redirectedfrom=MSDN&view=netframework-4.7.2#remarks "GetCallingAssembly 的 MSDN 文档")中所述）。

为避免这种情况，您可以将 a`MethodImplAttribute`应用于您的方法：

```
[MethodImpl(MethodImplOptions.NoInlining)]
void DoSomeThings()
{
    var isThisMyAssembly = System.Reflection.Assembly.GetCallingAssembly();
    //do stuff
} 
```

或者您可以改用使用`Assembly.GetExecutingAssembly()`。

# c - 在纯 C 中实现 RAII？

> ID：368385
> 
> 赞同：76
> 
> 时间：2008-12-15T13:40:09.017
> 
> 标签：c, raii

是否可以在纯 C中实现[RAII ？](http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization)

我认为以任何理智的方式都是不可能的，但也许可以使用某种肮脏的技巧。`free`想到重载标准函数，或者可能会覆盖堆栈上的返回地址，以便当函数返回时，它会调用其他一些以某种方式释放资源的函数？或者也许有一些 setjmp/longjmp 技巧？

这纯粹是学术兴趣，我无意实际编写如此不可移植和疯狂的代码，但我想知道这是否可能。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-12-15T15:38:35.770

这是固有的实现依赖，因为标准不包括这种可能性。对于 GCC，`cleanup`当变量超出范围时，该属性会运行一个函数：

```
#include <stdio.h>

void scoped(int * pvariable) {
    printf("variable (%d) goes out of scope\n", *pvariable);
}

int main(void) {
    printf("before scope\n");
    {
        int watched __attribute__((cleanup (scoped)));
        watched = 42;
    }
    printf("after scope\n");
} 
```

印刷：

```
before scope
variable (42) goes out of scope
after scope 
```

看[这里](http://gcc.gnu.org/onlinedocs/gcc-4.0.0/gcc/Variable-Attributes.html#index-g_t_0040code_007bcleanup_007d-attribute-1768)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-06-07T21:43:27.513

将 RAII 引入 C 的一种解决方案（当您没有 RAII 时`cleanup()`）是使用将执行清理的代码包装您的函数调用。这也可以打包在一个整洁的宏中（显示在最后）。

```
/* Publicly known method */
void SomeFunction() {
  /* Create raii object, which holds records of object pointers and a
     destruction method for that object (or null if not needed). */
  Raii raii;
  RaiiCreate(&raii);

  /* Call function implementation */
  SomeFunctionImpl(&raii);

  /* This method calls the destruction code for each object. */
  RaiiDestroyAll(&raii);
}

/* Hidden method that carries out implementation. */
void SomeFunctionImpl(Raii *raii) {
  MyStruct *object;
  MyStruct *eventually_destroyed_object;
  int *pretend_value;

  /* Create a MyStruct object, passing the destruction method for
     MyStruct objects. */
  object = RaiiAdd(raii, MyStructCreate(), MyStructDestroy);

  /* Create a MyStruct object (adding it to raii), which will later
     be removed before returning. */
  eventually_destroyed_object = RaiiAdd(raii,
      MyStructCreate(), MyStructDestroy);

  /* Create an int, passing a null destruction method. */
  pretend_value = RaiiAdd(raii, malloc(sizeof(int)), 0);

  /* ... implementation ... */

  /* Destroy object (calling destruction method). */
  RaiiDestroy(raii, eventually_destroyed_object);

  /* or ... */
  RaiiForgetAbout(raii, eventually_destroyed_object);
} 
```

你可以用宏来表达所有的样板代码，`SomeFunction`因为每次调用都是一样的。

例如：

```
/* Declares Matrix * MatrixMultiply(Matrix * first, Matrix * second, Network * network) */
RTN_RAII(Matrix *, MatrixMultiply, Matrix *, first, Matrix *, second, Network *, network, {
  Processor *processor = RaiiAdd(raii, ProcessorCreate(), ProcessorDestroy);
  Matrix *result = MatrixCreate();
  processor->multiply(result, first, second);
  return processor;
});

void SomeOtherCode(...) {
  /* ... */
  Matrix * result = MatrixMultiply(first, second, network);
  /* ... */
} 
```

注意：您可能希望使用 P99 等高级宏框架来实现上述操作。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-07-08T19:55:13.463

如果您的编译器支持 C99（甚至大部分），您可以使用可变长度数组 (VLA)，例如：

```
int f(int x) { 
    int vla[x];

    // ...
} 
```

如果没有记错的话，gcc 在它被添加到 C99 之前就已经/支持了这个特性。这（大致）等同于以下简单情况：

```
int f(int x) { 
    int *vla=malloc(sizeof(int) *x);
    /* ... */
    free vla;
} 
```

但是，它不允许您执行 dtor 可以执行的任何其他操作，例如关闭文件、数据库连接等。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-15T15:20:30.593

可能最简单的方法是使用 goto 跳转到函数末尾的标签，但这对于您正在查看的内容可能过于手动。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T14:02:47.803

我会选择覆盖堆栈上的返回地址。它会成为最透明的。替换`free`仅适用于堆分配的“对象”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-24T07:02:16.663

你看过 alloca() 吗？当 var 离开作用域时，它将释放。但是要有效地使用它，调用者必须始终在将其发送到事物之前执行 alloca...如果您正在实现 strdup，那么您不能使用 alloca。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-04-25T10:17:26.070

为了补充约翰内斯回答的这一部分：

> 当变量超出范围时，cleanup 属性运行一个函数

清理属性有一个限制（[http://gcc.gnu.org/onlinedocs/gcc-4.0.4/gcc/Variable-Attributes.html](http://gcc.gnu.org/onlinedocs/gcc-4.0.4/gcc/Variable-Attributes.html)）：此属性只能应用于自动函数范围变量。

因此，如果文件中有静态变量，则可以通过以下方式为静态变量实现 RAII：

```
#include <stdio.h>
#include <stdlib.h>

static char* watched2;

__attribute__((constructor))
static void init_static_vars()
{
  printf("variable (%p) is initialazed, initial value (%p)\n", &watched2, watched2);
  watched2=malloc(1024);
}

__attribute__((destructor))
static void destroy_static_vars()
{
  printf("variable (%p), value( %p) goes out of scope\n", &watched2, watched2);
  free(watched2);
}

int main(void)
{
  printf("exit from main, variable (%p) value(%p) is static\n", &watched2, watched2);
  return 0;
} 
```

这是一个测试：

```
>./example
variable (0x600aa0) is initialazed, initial value ((nil))
exit from main, variable (0x600aa0) value(0x16df010) is static
variable (0x600aa0), value( 0x16df010) goes out of scope 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-04-07T19:55:41.563

检查[https://github.com/psevon/exceptions-and-raii-in-c](https://github.com/psevon/exceptions-and-raii-in-c)以了解唯一和共享智能指针和异常的 C 实现。此实现依赖于宏括号 BEGIN ... END 替换大括号并检测超出范围的智能指针，以及返回的宏替换。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-04-08T17:11:19.897

我以前不知道属性清理。当然是一个适用的巧妙解决方案，但它似乎不适用于基于 setjmp/longjmp 的异常实现；不会为引发异常的范围和捕获它的范围之间的任何中间范围/函数调用清理函数。Alloca 没有这个问题，但是使用 alloca，您不能将内存块的所有权从调用它的函数转移到外部作用域，因为内存是从堆栈帧分配的。可以实现类似于 C++ unique_ptr 和 shared_ptr 的智能指针，认为它需要使用宏括号而不是 {} 并返回才能将额外的逻辑关联到范围进入/退出。[请参阅https://github.com/psevon/exceptions-and-raii-in-c](https://github.com/psevon/exceptions-and-raii-in-c)中的 autocleanup.c实施。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-04-28T16:35:59.567

```
my implementation of raii for c in pure c and minimal asm
@ https://github.com/smartmaster/sml_clang_raii

**RAII for C language in pure C and ASM**

**featurs : **

-easy and graceful to use
- no need seperate free cleanup functions
- able to cleanup any resources or call any function on scope exits

**User guide : **

-add source files in src folder to your project
-include sml_raii_clang.h in.c file
-annote resource and its cleanup functions 
```

/* 示例代码 */

```
void sml_raii_clang_test()
{
    //start a scope, the scope name can be any string
    SML_RAII_BLOCK_START(0);

    SML_RAII_VOLATILE(WCHAR*) resA000 = calloc(128, sizeof(WCHAR)); //allocate memory resource
    SML_RAII_START(0, resA000); //indicate starting a cleanup code fragment, here 'resA000' can be any string you want
    if (resA000) //cleanup code fragment
    {
        free(resA000);
        resA000 = NULL;
    }
    SML_RAII_END(0, resA000); //indicate end of a cleanup code fragment

    //another resource
    //////////////////////////////////////////////////////////////////////////
    SML_RAII_VOLATILE(WCHAR*) res8000 = calloc(128, sizeof(WCHAR));
    SML_RAII_START(0, D000);
    if (res8000)
    {
        free(res8000);
        res8000 = NULL;
    }
    SML_RAII_END(0, D000);

    //scope ended, will call all annoated cleanups
    SML_RAII_BLOCK_END(0);
    SML_RAII_LABEL(0, resA000); //if code is optimized, we have to put labels after SML_RAII_BLOCK_END
    SML_RAII_LABEL(0, D000);
} 
```

# sql-server-2005 - 在 SSRS 2005 中存储凭据

> ID：368409
> 
> 赞同：2
> 
> 时间：2008-12-15T13:48:53.867
> 
> 标签：sql-server-2005, reporting-services

当我尝试在 SQL Server Reporting Services 2005 中创建新快照时，我收到消息：“可能无法创建报告历史记录，因为未存储用于运行报告的凭据，报告使用用户定义的参数值，默认报告参数值丢失，或者如果链接的报告，链接不再有效”

在数据源下，它已选中“Windows 集成安全性”。我可以选择“安全存储在报表服务器中的凭据”并输入我的用户名、密码，但这似乎不对，因为我不想为每个报表都这样做。

现在我只是在我的本地机器上运行它（[http://localhost/Reports](http://localhost/Reports) $SQL2005/），所以我不知道为什么会出现这些错误

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T21:45:23.500

如果要使用订阅和报表快照等 Reporting Services 功能，则需要将数据源设置为使用“安全地存储在报表服务器中的凭据”。您只需在数据源上执行此操作，因此假设您没有为每个报表创建新数据源（因此它们共享一个或多个数据源），您只需在第一次部署时进行设置数据源。

许多人为 Reporting Services 创建一个特定的域帐户并将这些凭据用于数据源（确保您已为域帐户授予对所涉及的基础数据库的必要权限）。这意味着无论何时运行报表，它们都会作为 Reporting Services 帐户执行。

更多信息： http: [//msdn.microsoft.com/en-us/library/ms160330 (SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms160330(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-14T21:00:18.773

这篇文章有点晚了，但我遇到了一个问题，我将报告凭据存储在报告服务器中，但我仍然无法拍摄快照。转向报告有一个子报告，我必须将凭证与该报告一起存储，以使其正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T02:32:14.467

同意内森所说的一切。确保您使用的凭据至少具有对报表服务器、reportservertemp 和您使用的任何其他数据库的 dbdatareader 访问权限。

# sql-server - 当基表位于不同的数据库中时，在视图而非基表上授予选择

> ID：368414
> 
> 赞同：21
> 
> 时间：2008-12-15T13:52:14.767
> 
> 标签：sql-server

我有一个视图，它正在从不同数据库中的表中选择行。我想授予对视图的选择访问权限，但不授予对基表的直接访问权限。该视图有一个限制行数的 where 子句。

我可以将选择授予视图而不是基表，还是需要切换到存储过程？我宁愿不这样做。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-15T13:58:12.523

```
GRANT SELECT ON [viewname] TO [user] 
```

应该这样做。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-12-15T14:38:21.380

正如您在其中一条评论中所说，有问题的表位于不同的数据库中，然后[所有权链接](http://msdn.microsoft.com/en-us/library/ms188676.aspx)适用。我怀疑某个地方的链条中断了-检查该链接以获取完整的详细信息。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2011-06-17T09:04:29.460

我也有这个问题。我使用了上面提到的链接中的信息，并找到了快速解决方案。如果您有不同的架构，比如说**test**，并创建用户**utest ，架构****测试**的所有者以及架构**测试**中的视图，您可以查看**vTestView**，基于架构**dbo**中的表，同时从中选择您会得到上面提到的错误 - 否访问基础对象。对我来说执行语句就足够了

 ******`ALTER AUTHORIZATION ON test.vTestView TO dbo`;

这意味着我将**vTextView**的所有权从它所属的模式（**测试**）更改为数据库用户**dbo ，即模式****dbo**的所有者。之后，无需任何其他权限，用户**utest**就可以从**test.vTestView访问数据**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T14:01:42.640

您可以授予视图而不是基表的权限。这是人们喜欢使用视图的原因之一。

看看这里：[GRANT Object Permissions (Transact-SQL)](http://msdn.microsoft.com/en-us/library/ms188371.aspx?ppud=4)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T00:16:33.710

我在我的一个数据库中试过这个。

为了让它工作，必须将用户添加到包含实际数据的数据库中。不需要任何权利，只需访问。

您是否考虑过将视图保留在它引用的数据库中？可重用性和所有如果它的好处可以跟随。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-10-13T14:36:56.140

我有一个类似的问题，我为用户收到相同的错误消息。我觉得通过分享我的错误，我可以澄清问题，回答问题，并防止其他人犯同样的错误。
我希望用户可以访问 4 个特定视图，而无需访问其基础表（或数据库中的任何其他内容）。
最初我给了他们“db_denydatareader”的数据库角色成员资格，认为这会阻止他们从任何表或视图中选择任何东西（它确实 - 正如我所想的那样），尽管我随后在这 4 个视图上授予“选择”，假设它会按我的预期工作 - 它没有。
正确的做法是*不*授予他们 db_datareader 角色，并在您希望用户能够访问的项目上简单地授予“选择”权限。上述结果是，用户无法访问这 4 个视图之外的任何内容 - 这些视图区域所基于的表也对该用户不可用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-04-08T14:01:24.060

我有这个问题。看来，如果 View1 使用 dbo.table1，则需要由所有者“dbo”授予对“View1”作为模式“schema1”一部分的权限。

除非使用不属于 dbo 的模式，否则此问题可能不会变得明显，并且“将选择授予用户”的常规解决方案将起作用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-12-28T16:35:19.753

我这样做的方式是授予用户对我不希望他们访问的表的权限。然后通过仅允许对我视图中的列的选择权限来微调 SSMS 中的选择权限。这样，表上的 select 子句无论如何只限于他们在视图中看到的列。

[![在此处输入图像描述](https://i.stack.imgur.com/FyS3l.png)](https://i.stack.imgur.com/FyS3l.png)

沙集

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-10-24T12:04:08.227

`Create view Schema1.viewName1 as (select * from plaplapla)`

`Schema1`有所有的桌子

`Create view Schema2.viewName2 as (select * from schema1.viewName1)`

`schema2`没有表（仅查看架构）

在这种情况下，您可以在 schema2 中执行 ( `select * from viewName2`)，但是 .. 如果您`deleted viewNmae1 from Schema1`，`ViewName2`则将无法正常工作..

Amani El Gamal aljamalaisj81@gmail.com

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-23T17:46:24.310

前面的答案部分正确，您可以使用[GRANT 语句](https://docs.microsoft.com/en-us/sql/t-sql/statements/grant-object-permissions-transact-sql?redirectedfrom=MSDN&view=sql-server-ver15)仅授予视图权限而不授予其基表权限。

但由于是跨数据库，因此您还需要在实例级别启用跨数据库所有权链。 [![Corss 数据库所有权链](https://i.stack.imgur.com/Na24P.png)](https://i.stack.imgur.com/Na24P.png)

您还需要确保视图和基表属于同一所有者，否则所有权链将不起作用。在现代版本的 SQL Server 中（可能在 SQL Server 2003 之后），默认情况下，所有表和视图都归其架构所有，因此这实际上意味着架构的所有者也应该是相同的。默认情况下，每个用户表的架构都是“dbo”，意思是“数据库所有者”，因此两个相关数据库的数据库所有者应该相同。

[![数据库所有者](https://i.stack.imgur.com/4BMbX.png)](https://i.stack.imgur.com/4BMbX.png)

您可以阅读这两篇文章以了解有关 SQL Server Ownership Chaining 和 Cross Database Ownship Chaining 的更多信息。 [https://www.mssqltips.com/sqlservertip/6394/understanding-sql-server-ownership-chaining/](https://www.mssqltips.com/sqlservertip/6394/understanding-sql-server-ownership-chaining/) [https://www.mssqltips.com/sqlservertip/1782/understanding-cross-database-ownership-chaining-in- sql服务器/](https://www.mssqltips.com/sqlservertip/1782/understanding-cross-database-ownership-chaining-in-sql-server/)

也许您还想了解更多关于 SQL Server 登录和数据库用户的信息，因为对于您希望仅在 DB A 中授予对视图访问权限的用户，您确实需要在 DB 中至少给他“公共”角色您的基表位于：[https ://docs.microsoft.com/en-us/sql/relational-databases/security/authentication-access/create-a-database-user?view=sql-server-ver15](https://docs.microsoft.com/en-us/sql/relational-databases/security/authentication-access/create-a-database-user?view=sql-server-ver15)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2014-03-25T22:58:33.843

只要有一个具体化的视图，你就不必担心所有其他因素。这只有在空间和刷新时间不是什么大问题的情况下才会起作用。物化视图非常酷。

# apache-pig - Apache Pig Latin 参考手册

> ID：368425
> 
> 赞同：7
> 
> 时间：2008-12-15T13:57:23.883
> 
> 标签：apache-pig, dataflow, manual

Pig 是一个用于处理超大文件的数据流编程环境。猪的语言叫做猪拉丁语。

有谁知道[PigLatin](http://wiki.apache.org/pig/)的好参考手册？我正在寻找包含该语言所有语法和命令描述的内容。不幸的是，Pig wiki 中的 wiki 页面已损坏。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-23T11:53:53.160

我使用的参考手册位于 Wiki：[Pig Latin Manual](http://hadoop.apache.org/pig/docs/r0.2.0/piglatin.html)中。

它包含所有 Pig Latin 命令及其语法和示例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-11-04T23:30:40.893

我经常使用这些：

[http://pig.apache.org/docs/r0.6.0/piglatin_ref1.html](http://pig.apache.org/docs/r0.6.0/piglatin_ref1.html)

[http://pig.apache.org/docs/r0.6.0/piglatin_ref2.html](http://pig.apache.org/docs/r0.6.0/piglatin_ref2.html)

我希望它也对你有用。

干杯

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T21:58:33.007

正如 Craig Stuntz 提到的，尝试 wiki： [http ://wiki.apache.org/pig/FrontPage](http://wiki.apache.org/pig/FrontPage)

发布，因为这是一个答案，而不是评论。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-26T06:36:45.560

[http://pig.apache.org/docs/r0.9.0/](http://pig.apache.org/docs/r0.9.0/)

[https://cwiki.apache.org/confluence/display/PIG/Index](https://cwiki.apache.org/confluence/display/PIG/Index)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-23T16:26:58.233

更新到最新的猪版本 - [http://pig.apache.org/docs/r0.9.1/](http://pig.apache.org/docs/r0.9.1/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-03T10:17:12.630

可以在 dist 中找到文件。下载最新的 tar 和查找文档。

# c# - 如何通过 .asmx Web 服务获取此请求结构？

> ID：368430
> 
> 赞同：2
> 
> 时间：2008-12-15T13:58:40.213
> 
> 标签：c#, web-services, wsdl, asmx

我正在努力创建一个 .asmx Web 服务来满足集成环境的特定需求，而在我的一生中，我无法弄清楚如何让它的一部分工作。关键是请求 WSDL 需要类似于以下内容。（注意我删除了肥皂信封和命名空间信息）

```
<methodOne>
    <myValue>string</myValue>
    <myDemoGroup>
        <myDemoGroupItem>string</myDemoGroupItem>
        <myDemoGroupItem2>string</myDemoGroupItem2>
    </myDemoGroup>
    <myComplexGroup>
        <mySubStructure>
            <subItem1>string</subItem1>
            <subItem2>string</subItem2>
        </mySubStructure>
    </myComplexGroup
</methodOne> 
```

现在，我知道如何处理大部分内容了，方法一标记由我的参数名称处理，然后里面的项目只是类中的元素。所以像这样的东西得到了一切，除了“MyComplexGroup”

```
[Web Method]
public void MyWebMethod(MyWebMethodRequest methodOne)
{
    //Do my stuff
}

public class MyWebMethodRequest
{
    public string myValue {get; set;}
    public MyDemoGroupInfo myDemoGroup {get; set;}
}

public class MyDemoGroupInfo
{
    public string myDemoGroupItem {get; set;}
    public string myDemoGroupItem2 {get; set;}
} 
```

问题是如何定义“myComplexGroup”以允许创建多个 mySubStructure 元素，同时仍将所有项目输出到 WSDL。

如果我继续做这样的事情

```
public class MyComplexGroupInfo 
{
    public List<MySubStructureInfo> mySubStructure {get; set;}
}

public class MySubStructureInfo
{
    public string subItem1 {get; set;}
    public string subItem2 {get; set;}
} 
```

然后我可以添加`public MyComplexGroupInfo myComplexGroup {get; set;}`到该对象，我会得到它的一部分，但不是列出 subItem1 和 subItem2 它只是说 MySubStructureInfo 与 nil 设置为一。

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T14:14:29.293

如果您有需要实现的 WSDL 契约，您可以尝试`wsdl.exe /serverInterface`生成服务存根。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T14:02:24.653

也许是一个显而易见的问题，但您是否尝试使用 wsdl.exe 来查看它吐出的内容？您总是可以将其用作指导（即您不必直接使用该类）。

# delphi - 设置 Canvas.LineTo 的线端样式

> ID：368432
> 
> 赞同：5
> 
> 时间：2008-12-15T13:59:17.263
> 
> 标签：delphi, winapi, gdi, tcanvas

有没有办法为 TCanvas.LineTo 方法设置线端的样式？它似乎默认为圆形末端，当 Pen.Width 设置为较大的值（例如 9）时，对于一行不同颜色的几行来说，这看起来非常糟糕。

它看起来像这样（圆形末端）：

```
 ********........******
**********........******
**********........******
 ********........****** 
```

（其中 * 是蓝色，. 是黄色）

如果在中间线之后画两条外线，那就更糟了：

```
 ********........******
**********......********
**********......********
 ********........****** 
```

我希望它看起来像这样（直线结束）：

```
 ********........******
 ********........******
 ********........******
 ********........****** 
```

Pen 似乎没有为此提供任何设置，LineTo 方法也没有。是否有我可以调用的 Windows API 函数？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T14:56:18.520

也许[ExtCreatePen 有](https://msdn.microsoft.com/en-us/library/dd162705(v=vs.85).aspx)帮助。检查`PS_ENDCAP_*`和`PS_JOIN_*`标志。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-11-28T12:42:48.413

DelphiPraxis 论坛的示例代码[（德语）](https://www.delphipraxis.net/92808-tcanvas-pen-und-die-abgerundeten-ecken.html)

```
procedure TForm1.FormCreate(Sender: TObject);
   var LogBrush:TLOGBRUSH;
begin
   ZeroMemory(@LogBrush, SizeOf(LogBrush));
   LogBrush.lbColor:=ColorToRGB(Canvas.Pen.Color);
   LogBrush.lbHatch:=0;

   DeleteObject(Canvas.Pen.Handle);
   Canvas.Pen.Handle:=ExtCreatePen(PS_Geometric or PS_Solid or PS_EndCap_Square or PS_Join_Miter, 10, LogBrush, 0, nil);
end;

procedure TForm1.FormPaint(Sender: TObject);
begin
   Canvas.MoveTo(0, 0);
   Canvas.LineTo(50, 50);
end; 
```

# tfs - 需要一个关于 TFS 构建过程的好的入门教程

> ID：368433
> 
> 赞同：18
> 
> 时间：2008-12-15T13:59:26.593
> 
> 标签：tfs, build-process

我们正在慢慢推出团队基础，我必须加快在 TFS 上设置构建过程的速度。

TFS 构建有哪些好的起点？

从表面上看，TFS 构建没有 GUI 对吗？它只是关于学习 MSBuild？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T14:08:29.710

2008 年的 Team Build 对 2005 年提供的内容进行了全面改进。我假设您说的是 2008 年，因为它是更新的版本。

Buck Hodge 的博客是一个很好的起点。Buck 是 Team Build 的团队负责人。具体来说，他有一篇名为[TFS 2008：Team Build 2008 的基本指南](http://blogs.msdn.com/buckh/archive/2007/08/14/tfs-2008-a-basic-guide-to-team-build-2008.aspx)的文章，这是一个很好的起点。

此外，作为正在迁移到 Team Foundation Server 的团队的工作人员，我强烈建议在 Microsoft 认可的培训提供商处进行培训。我们选择了[Notion Solutions](http://www.notionsolutions.com/Pages/default.aspx)。它价格便宜且质量相当合理。它是带有托管实验室的自定进度视频培训，如果需要，还可以提供讲师问答时间。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T15:01:03.863

除了 Joseph 的[指点](http://blogs.msdn.com/buckh/archive/2007/08/14/tfs-2008-a-basic-guide-to-team-build-2008.aspx)之外，我给出的以下演讲还包括我在 2007 年与 Brian Randall 在 TechEd EMEA 的 Team Foundation Build 上进行的一次会议中的大部分幻灯片。

[http://www.woodwardweb.com/vsts/team_foundation_4.html](http://www.woodwardweb.com/vsts/team_foundation_4.html)

在 TFS2008 及更早版本中，Team Build 非常依赖于 MSBuild。有关 MSBuild 的快速介绍，请阅读[Deploying .NET Applications](https://rads.stackoverflow.com/amzn/click/com/1590596528)一书的第 5 章。该章节可在此处免费在线获取：

[http://en.csharp-online.net/MSBuild:_By_Example](http://en.csharp-online.net/MSBuild:_By_Example)

希望有帮助，

马丁。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T06:52:31.820

您可能还想看看这本书：http: [//blogs.msdn.com/microsoft_press/archive/2009/01/31/sayed.aspx](http://blogs.msdn.com/microsoft_press/archive/2009/01/31/sayed.aspx)

# c# - 检查通用列表内容的最佳方法

> ID：368438
> 
> 赞同：3
> 
> 时间：2008-12-15T14:01:25.713
> 
> 标签：c#, .net, performance, generics

我必须处理一些使用通用列表来存储自定义对象集合的代码。

然后它会执行以下操作来检查给定对象是否在集合中，如果是，则执行以下操作：

```
List<CustomObject> customObjects;
//fill up the list
List<CustomObject> anotherListofCustomObjects;
//fill it up

//...

foreach (CustomObject myCustomObject in customObjects)
{
   if (anotherListofCustomObjects.Contains(myCustomObject))
   {
      //do stuff
   }
} 
```

问题是要花很长时间来处理 7000 个这样的对象。

这不是我的代码 - 我只是想提出改进它的选项 - 在我看来，使用字典按键获取内容会更快，而不是像上面那样循环遍历整个集合。

建议？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-15T14:10:19.003

除了字典之外的另一种方法是，如果您使用的是 .NET 3.5，则使用 Linq 到对象和相交：

```
foreach(CustomObject c in customObjects.Intersect(anotherListOfCustomObjects))
{
    // do stuff.
} 
```

根据反射器，它使用基于哈希的集合来执行序列的交集。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T14:07:53.703

好吧，您似乎已经自己回答了？如果您需要对一组数据进行快速查询，那么字典可能比平面列表更好（对于较大的数据大小，您就是这样）。

例如，您可以将对象用作自己的键 -

```
Dictionary<CustomObject,CustomObject> ... 
```

请注意，相等的含义取决于上下文。如果您要传递原始参考，那很好 -`ContainsKey`可以完成这项工作。如果您有一个*不同但相似的平等*对象来比较，那么您需要实现自己的`GetHashCode()`,`Equals()`和 理想的`IEquatable<CustomObject>`。无论是`CustomObject`本身，还是在自定义`IEqualityComparer<CustomObject>`中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T14:08:09.040

实际上，您的代码目前是 O(n^2)，这会很慢。你可以：

*   改用字典或 KeyedCollections，这将使它成为 O(nlog n)
*   如果您可以确保项目的顺序相同，则可以重写最后一个循环以仅使用一个索引，这将是 O(n)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T14:15:54.907

你也可以考虑[`System.Collections.ObjectModel.KeyedCollection<TKey, TItem>`](http://msdn.microsoft.com/en-us/library/ms132438.aspx)。

为了补充这一点，我通常创建自己的 IKeyable 接口和 KeyedCollection 的特定实现，该实现使用 IKeyable 来实现所需的重载。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T14:37:29.730

测试是你的朋友。集合的大小决定了您应该使用的数据结构/算法。我建议您对以下选项进行一些性能基准测试：

1.  您当前的解决方案
2.  `BinarySearch`在排序列表中使用算法。
3.  使用`HashSet<CustomObject>`.

考虑到元素的数量，我怀疑这`HashSet<CustomObject>`是要走的路。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T14:12:19.513

如果您*必须*维护两个单独的列表，则其中一种 Set 类型可能会更快（使用 Join 操作）。一些可用的库是

1.  [IESI 收藏](http://www.codeproject.com/KB/recipes/GenericISet.aspx)
2.  [PowerCollections](http://www.codeplex.com/PowerCollections)
3.  [C5](http://www.itu.dk/research/c5/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T14:12:54.990

只是对其他评论的一个小补充。如果您需要对其他客户列表进行排序，您可以使用 SortedList。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T16:04:50.660

Hashset 也很好用。

```
new HashSet<CustomObject>().Join() 
```

# java - XmlTextAttribute 和 CDATA

> ID：368442
> 
> 赞同：1
> 
> 时间：2008-12-15T14:02:37.240
> 
> 标签：java, xml, serialization, msxml

我们有一部分应用程序，我们的用户可以通过定制的所见即所得组件创建包含 HTML、JavaScript 和 CSS 的对象。这些对象在某些时候被序列化，然后被反序列化。但是，由于我们的用户/客户遍布全球，他们有时会在反序列化过程中输入引起不满的字符。最近，我看到`&#X1D;`出现在来自中国用户的序列化 XML 中，后来由于 XML 是使用 MSXML2 通过一些 Java 代码加载而导致问题（在 .NET 和 System.Xml 中同样不是问题，但这是另一个问题）。我们目前坚持使用 MSXML2，因此需要单独解决。

一个建议是更改一些字段以序列化为 CDATA，而不是像现在这样的 HtmlTextAttribute。

我怎样才能做到这一点，它会对在这种变化之前序列化的数据产生影响吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-22T21:37:13.017

0x1D 是没有人使用的 ASCII 控制字符，所以看起来中国用户的输入使用了一些非 UTF-8 编码，而将其序列化为 XML 的代码错误地假设输入字节是 Unicode 代码点（并对其进行序列化作为字符实体引用）。

仅将其更改为 CDATA 将不起作用，因为序列化程序仍将输出 mojibake。

最简单的解决方法是确保客户端应用程序始终使用 UTF-8。

# windows - 显示写入硬盘的进程的工具？

> ID：368450
> 
> 赞同：12
> 
> 时间：2008-12-15T14:04:04.477
> 
> 标签：windows, process, hard-drive

是否有工具可以实时显示哪些应用程序正在写入硬盘？我正在考虑类似任务管理器的东西，但用于 I/O。我有许多后台进程正在运行，并且永远无法判断 Visual Studio 何时停止运行，或者其他进程何时占用磁盘（尤其是当处理器运行速度低于 20% 时）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-15T14:05:57.033

来自 Sysinternals/Microsoft 的[ProcMon 。](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-15T17:16:56.803

[Microsoft SysInternals 的 Process Explorer。](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)您可以一次查看有关所有进程的此信息，或者在双击单个进程时获得更详细的信息。

这是我离不开的工具之一。

[![替代文字](https://i.stack.imgur.com/tsNzi.jpg)](https://i.stack.imgur.com/tsNzi.jpg)
[（来源：[microsoft.com](http://i.technet.microsoft.com/bb896653.ProcessExplorer(en-us,MSDN.10).jpg)）]

[![替代文字](https://i.stack.imgur.com/c41IS.jpg)](https://i.stack.imgur.com/c41IS.jpg)
[（来源：[microsoft.com](http://i.technet.microsoft.com/bb896653.ProcessExplorer1(en-us,MSDN.10).jpg)）]

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-15T14:08:03.673

你知道任务管理器可以有列

*   I/O 读取
*   I/O 读取字节
*   I/O 写入
*   I/O 写入字节
*   输入输出 其他
*   I/O 其他字节

? 这可能会有所帮助 - 请参阅查看/选择列

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-06-18T02:52:28.577

可以通过打开 Windows 检索有关写入磁盘的进程的信息`Task Manager`--> `Performance`-->`Resource Monitor`

资源监视器可以按进程深入了解磁盘使用情况：

![在此处输入图像描述](https://i.stack.imgur.com/JdW2W.png)

# .net - 以英文发送的电子邮件以图片字母（中文、日文等）和随机字符显示给最终用户

> ID：368456
> 
> 赞同：-2
> 
> 时间：2008-12-15T14:07:51.163
> 
> 标签：.net, email, encoding

我有向用户发送 HTML 电子邮件的代码。为了适应没有/想要 HTML 电子邮件的用户，电子邮件包含 2 个备用视图，View(0) 是 HTML，View(1) 是纯文本。

HTML 视图具有页眉和页脚图形，但样式是内联完成的，而不是通过 css 文件完成的。文本视图只是文本；没有标签、图像等。该消息附有 3 个 pdf 文件。

当大多数用户收到消息时，他们看起来很好。没有损坏的图像链接，没有乱码等。

当其他人收到消息时，会发生以下两种情况之一。

*   整个 HTML 备用视图被打包为附件（以 3 个 pdf 作为附件），父消息包含图片字母/随机字符，如...

> “㰡䑏䍔丢䔠桴浬⁐啂䱉䌠∭工∈呍䰠㐮〱ご桠桴浬⁐啂䱉䌠∍手工⌯䌯⽄呄ⁱ摍䰠㐮〱ご牡湳楴浬桠桴浬਍㾰਍桴浬਍㾰਍桴浬਍㾰ഀ慤਍〾ഀ ਍㰀਍ ਍਍㱢润礠执捯汯爽∣晦晦晦∠瑥硴㴢⌰〰〰〢਍㰾਍扲਍㰾਍⽢਍਍㰯桴浬਍ാ਍社"

*   收到的邮件是带附件的，但是邮件的文字和之前的乱码差不多。

使用 System.Net.Mail 类发送电子邮件。它读取一个 XML 模板来构建电子邮件消息，所以在这里发布有点长，但非常简单。

电子邮件有问题的用户来自 comcast.net 和其他公司地址。

我确实意识到，从接收者的角度来看，这是来自未知发件人的电子邮件，有图形，有附件，因此在某些情况下可能会被识别为垃圾邮件，但这是企业想要的，所以他们得到了它。

我的直觉告诉我这是某种编码问题，我对所有格式都使用 Unicode，这是一个糟糕的假设吗？编辑：检查[这个](http://www.joelonsoftware.com/articles/Unicode.html)以确保我的理解。

有没有人知道可能是什么原因造成的，或者有什么建议可以解决这个问题？

编辑@some：html电子邮件有

```
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
```

在顶部，但 AlternateView.CreateAlternateViewFromString() 方法正在应用 System.Text.Encoding.Unicode (utf-16)。我可以看到这可能在哪里发生冲突并将对其进行更新，但这可能需要一些时间来查看它是否已修复。

用户在完成注册过程后只会收到一次电子邮件，但我们已将同一电子邮件发送到另一个 comcast 电子邮件帐户并且查看它没有问题。

编码是操作系统或电子邮件客户端（浏览器、outlook/express）特定的还是强制的？

（请作为答案发布，以便您在有帮助时获得投票！）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T14:30:39.417

理想情况下，按照 W3C 的建议，您应该使用 UTF8 进行编码。

这可能会奏效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-11-01T04:58:20.790

在我的电脑自动进行 Windows 更新后，我遇到了这种问题。我猜有些设置改变了。所以我转到邮件格式并寻找编辑器选项->校对->自动更正选项并取消选中“直引号”和“键入时自动格式化”选项卡下的“智能引号”。然后我比较了我的电脑和我朋友的电脑之间的设置（他们还没有应用最新的 Window 更新 - 大约 2016 年 10 月 12 日 -）。我检查并取消检查以匹配他。现在它工作正常，不再有这种问题。（到目前为止，另一位朋友开始遇到同样的问题。我还没有问他是否得到了自动窗口更新。）祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-01-15T23:18:43.093

我最近遇到了类似的问题，电子邮件中插入了一张笑脸表情符号。文字看起来很好，直到幸福的脸，然后一切都是中文或类似的。邮件以文本形式发送，显然无法呈现快乐的表情。我们将发件人的格式更改为html，问题就解决了。

# sql - SQL 帮助：选择语句连接一对多关系

> ID：368459
> 
> 赞同：3
> 
> 时间：2008-12-15T14:08:07.403
> 
> 标签：sql, sql-server, concatenation

例如我有两张桌子。第一个表是学生，第二个表是学生正在学习的课程。如何使用 select 语句，以便我可以看到两列学生和课程，以便课程用逗号分隔。

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-15T15:10:08.867

假设您使用的是 SQL Server 2005：

这应该做你所追求的 - 显然根据需要替换字段：

出于演示目的，请考虑以下两个表结构：

```
Students(
  STU_PKEY Int Identity(1,1) Constraint PK_Students_StuPKey Primary Key,
  STU_NAME nvarchar(64)
)

Courses(
  CRS_PKEY Int Identity(1, 1) Constraint PK_Courses_CrsPKey Primary Key,
  STU_KEY Int Constraint FK_Students_StuPKey Foreign Key References Students(STU_PKEY),
  CRS_NAME nvarchar(64)
) 
```

现在这个查询应该完成你所追求的工作：

```
Select  s.STU_PKEY, s.STU_NAME As Student,
        Stuff((
            Select  ',' + c.CRS_NAME
            From    Courses c
            Where   s.STU_PKEY = c.STU_KEY
            For     XML Path('')
        ), 1, 1, '') As Courses 
From    Students s
Group By s.STU_PKEY, s.STU_NAME 
```

比当前接受的答案简单得多......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-19T14:13:43.383

```
create table Project (ProjectId int, Description varchar(50));
insert into Project values (1, 'Chase tail, change directions');
insert into Project values (2, 'ping-pong ball in clothes dryer');

create table ProjectResource (ProjectId int, ResourceId int, Name varchar(15));
insert into ProjectResource values (1, 1, 'Adam');
insert into ProjectResource values (1, 2, 'Kerry');
insert into ProjectResource values (1, 3, 'Tom');
insert into ProjectResource values (2, 4, 'David');
insert into ProjectResource values (2, 5, 'Jeff');

SELECT *, 
  (SELECT Name + ' ' AS [text()] 
   FROM ProjectResource pr 
   WHERE pr.ProjectId = p.ProjectId 
   FOR XML PATH ('')) 
AS ResourceList 
FROM Project p

--    ProjectId    Description                        ResourceList
--    1            Chase tail, change directions      Adam Kerry Tom 
--    2            ping-pong ball in clothes dryer    David Jeff 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T14:14:10.527

这取决于您使用的服务器。SQL 服务器？MySQL？其他？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T14:16:24.903

通常，您所说的是联接：

```
SELECT 
    S.*,
    SC.*
  FROM
    Students S
    INNER JOIN Student_Courses SC
      ON S.student_id = SC.student_id 
```

但是，这将为您每*门课程*提供一排。SQL 并不容易将一组课程作为逗号分隔的列表放在一行中（这不是基于集合的操作）。根据供应商的不同，有不同的方法可以做到这一点，包括循环。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T14:17:03.717

我认为这个 MySQL 页面会帮助你。 [http://dev.mysql.com/doc/refman/4.1/en/group-by-modifiers.html](http://dev.mysql.com/doc/refman/4.1/en/group-by-modifiers.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T14:17:21.470

所以你想看到：

```
'Jade', 'Math, English, History'
'Kieveli', 'History, Biology, Physics' 
```

是的，逗号分隔总是可取的，但 SQL 并不擅长。这是我一直计划使用的方法：

在 SQL 服务器上创建一个使用游标循环子查询的函数（对不起 - 我没有完全测试这个）：

```
CREATE FUNCTION commacourselist(@studentname varchar(100))
RETURNS @List varchar(4096)
AS
BEGIN

DECLARE @coursename varchar(100)

DECLARE FOR
SELECT course.name FROM course WHERE course.studentname = @studentname
OPEN coursecursor

FETCH NEXT FROM coursecursor INTO @coursename 
WHILE @@FETCH_STATUS = 0
BEGIN
 IF @List = ''
 BEGIN
  SET @List = @coursename
 END
 ELSE
 BEGIN
  SET @List = @List + ',' + @coursename 
 END
 FETCH NEXT FROM coursecursor INTO @coursename 
END
CLOSE coursecursor 
DEALLOCATE coursecursor 

RETURN
END
GO 
```

然后在查询中调用函数：

```
SELECT student.name, 
       commacourselist( student.name )  
FROM student 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T14:18:27.257

您可以使用 UDF 游标通过相关记录并将返回字符串连接在一起，但这会很昂贵 - 如果您试一试，请确保您的游标是 READ_ONLY FAST_FORWARD

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T14:22:31.413

你用的是2005还是2008？如果是这样，则查找 PIVOT 命令。它应该比带有游标的函数更有效。

# web-services - 如何设计和实现一个简单的 WCF 服务中继？

> ID：368463
> 
> 赞同：3
> 
> 时间：2008-12-15T14:08:32.393
> 
> 标签：web-services, wcf, authentication, routing

我们正在设计一个使用 WCF 作为实现框架的简单的面向服务的架构。少数应用程序使用了一些服务。这些服务大多在内部使用，因此一个基本的身份验证和授权方案（例如基于 Windows）就足够了。

但是，我们希望将某些服务公开给某些业务合作伙伴。他们可以访问的服务集取决于合同。一种标准架构。

我认为我们可以实现一个*服务网关*，它对请求进行身份验证并将它们中继到正确的内部服务端点（这类似于简单的 ESB），因此我们可以集中身份验证/授权代码并向世界公开一个端点。我查看了一些可用的 ESB 工具包，但对于此目的而言，它们似乎过于复杂。我们不需要集成很多不同的服务，而只是将其中的一些服务暴露给 Internet。

如何在 WCF 中设计和实现这样的中继/路由器，并保持非常简单？我读过[Inside Windows Communication Foundation](http://www.microsoft.com/mspress/books/9610.aspx)，这是一本好书，但我仍然对如何开始没有足够的信心。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T14:31:36.480

我做了一些与此非常相似的事情。您可以做的是通过单个操作公开端点。

该操作看起来像

```
[OperationContract(Namespace="www.fu.com", Action="*")]
void CallThis(Message msg); 
```

让您的客户使用一个代理，该代理是为他们打算调用他们想要的操作的服务而设计的。然后让他们更改配置以指向您的端点/服务。“CallThis”方法将接受任何操作，无论其签名如何。Message 参数是 WCF 消息。

做你需要做的事情来确定事情应该去哪里，但是你需要改变“To”去你的内部端点。

我实际上有一个完整的实现，所以如果你有问题，请告诉我。

乔。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T15:57:10.677

构建如下界面似乎就足够了：

```
[OperationContract(Action="*", ReplyAction="*")]
Message CallThis(Message msg); 
```

我还发现[这篇文章](http://sajay.com/sending-a-simple-string-using-wcf-understandi)对于通过“摆弄” *Message*对象来实现*CallThis方法很有用。**CallThis*方法的基本实现如下：

 **```
public Message CallThis(Message message) {
    MessageBuffer buffer = message.CreateBufferedCopy(524288);
    Message output = buffer.CreateMessage();
    output.Headers.To = <INTERNAL_SERVICE_URI>;

    BasicHttpBinding binding = new BasicHttpBinding();
    IChannelFactory<IRequestChannel> factory = binding.BuildChannelFactory<IRequestChannel>(<INTERNAL_SERVICE_URI>);
    factory.Open();

    IRequestChannel channel = factory.CreateChannel(new EndpointAddress(<INTERNAL_SERVICE_URI>));
    channel.Open();

    Message result = channel.Request(output);

    message.Close();
    output.Close();
    factory.Close();
    channel.Close();

    return result;
} 
```

添加身份验证和授权应该非常简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-17T18:50:16.157

查看[这个 SO question](https://stackoverflow.com/questions/1213781/is-is-possible-to-relay-a-wcf-service-from-another-server)，其中一个响应建议使用 .NET 4 的 RoutingService。WCF 的非常好的补充。

# c# - 在运行时从 UnityContainer 中删除已注册的类型？

> ID：368468
> 
> 赞同：4
> 
> 时间：2008-12-15T14:11:09.893
> 
> 标签：c#, unity-container

我想知道是否有一种简单的方法可以从统一容器中删除已经注册的类型，或者至少用另一个替换现有的接口/类型映射。仅将另一种类类型映射到接口并覆盖旧的类就足够了吗？

* * *

这不应该经常发生。实际上几乎没有时间，但在某些情况下，我想用另一个实现某个接口的服务替换另一个服务，而不会干扰其他部分。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-03-25T19:53:04.667

在 Unity 2 中，如果您尝试将一个注册替换为另一个注册，则需要在新注册中指定 From 类型和 To 类型（如果它们包含在原始注册中）。

例如，如果您有：

```
 public interface IService
{
    void DoSomething();
}

public class SomeService : IService
{
    public void DoSomething();
}

public class AnotherService : IService
{
    public void DoSomething();
} 
```

并且您将 SomeService 注册为：

```
 container.RegisterType<IService, SomeService>(); 
```

那么如果您的系统的另一部分想要覆盖 IService 注册来解析另一个服务，您需要将其注册为：

```
 container.RegisterType<IService, AnotherService>(); 
```

这看起来很简单，但是当另一个服务需要由工厂创建时，我就挂断了：

```
 container.RegisterType<IService>(new InjectionFactory(x =>
{
    // this would be some complicated procedure
    return new AnotherService();
})); 
```

在这种情况下，您仍然会获得 SomeService。要像您期望的那样获得 AnotherService，您需要指定 TTo 类型：

```
 container.RegisterType<IService, AnotherService>(new InjectionFactory(x =>
{
    return new AnotherService();
})); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-08T00:31:12.093

收听网络广播（参见 msdn webcasts search for unity）它会在最后一个 win 场景中替换已注册的类型。因此，如果您使用 config 加载容器，则使用代码注册相同类型的代码（顺便说一句，反之亦然）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T14:22:03.160

我还没有检查过 Unity，所以我可能是错的，但我想你想要做的事情是不可能的，因为我在我们的框架中处理我们自己的 DI 功能，结果证明这样做效率更高首先发现类型，然后让应用程序运行，因为这样您就不必为每次访问都锁定类型存储以查看要注入实例的实例，因为存储是只读的，它永远不会发生变异。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T15:01:53.597

您总是可以重新创建容器并注册新类型。如果您需要一遍又一遍地这样做，这样做的成本很可能相当高，我认为您可能需要重新考虑您的框架设计。

# linux - Linux 基准测试工具

> ID：368472
> 
> 赞同：11
> 
> 时间：2008-12-15T14:13:02.180
> 
> 标签：linux, benchmarking

我被要求评估新供应商的计算系统，管理层要求我不要使用我们现有的任何软件来评估平台（信不信由你，他们有一些正当的理由）。

无论如何，我已经开始尝试阅读有意义的服务器级计算机基准程序，但并没有给人留下深刻的印象。我试图展示原始计算能力和内存 I/O 吞吐量。

关于我应该运行的有意义的测试有什么建议吗？-- 我将可以访问现有系统和评估所有这些测试的系统。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-15T14:24:15.793

[Phoronix](http://www.phoronix.com "佛罗尼克斯")有一个适用于 Linux 的基准测试套件。也许对你来说已经足够了。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-15T15:13:34.837

我最终使用以下站点来获得一些有意义的基准：

*   [Linux 基准测试 HOWTO](http://tldp.org/HOWTO/Benchmarking-HOWTO.html)
*   [SPEC](http://www.spec.org/)（由[matli](https://stackoverflow.com/users/23896/matli)[建议](https://stackoverflow.com/questions/368472/linux-benchmarks#368874)）
*   [Linux 基准套件主页](http://lbs.sourceforge.net/)
*   [LMBench](http://www.bitmover.com/lmbench/)
*   [SELinux 基准测试](http://www.nsa.gov/selinux/papers/freenix01/node13.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-12-28T18:35:52.930

我喜欢 UnixBenchmark - [http://code.google.com/p/byte-unixbench/](http://code.google.com/p/byte-unixbench/)。这是一个全面的测试。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-15T16:15:50.047

[SPEC](http://www.spec.org/)是一套相当标准化和公认的基准。它们不是免费的，但也不是很贵。他们的网站上也有很多针对各种服务器的已发布基准测试结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T14:16:51.533

我看到的很多 linux“基准”都展示了诸如使用 LAME 编码之类的东西。我不知道该示例是否适用于“服务器级”测试

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-15T16:02:18.483

这不是 FLOSS，但[http://www.primatelabs.ca/geekbench/](http://www.primatelabs.ca/geekbench/)相当不错 :)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-15T14:32:27.213

看看交易处理委员会的想法。他们可能已经为您的机器提供了结果。

不幸的是，您需要成为会员才能获得最高级别 1 硬件供应商级别的软件。

# sharepoint - 从内容编辑器/页面查看器 Webpart 中删除滚动条

> ID：368480
> 
> 赞同：2
> 
> 时间：2008-12-15T14:14:41.850
> 
> 标签：sharepoint, iframe, moss, web-parts, cewp

我正在尝试在另一个 SharePoint webpart 页面中显示 HTML 页面。

我使用了开箱即用的页面查看器 Web 部件，但页面查看器 Web 部件在其中显示了一个禁用的滚动条。

我还尝试使用其中带有 IFRAME 标记的内容编辑器 Web 部件，但它仍然无法正常工作。

这是我在内容编辑器 webpart 中使用的代码。

```
<iframe name="Iframe" src="URL1" scrolling="no"
    FRAMEBORDER="0" style="width:100%; border:0;  height:100%; overflow:hidden;">
</iframe> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-02-24T23:47:10.177

在您的样式表上使用它：

```
#s4-workspace {

   overflow-y: hidden !important;

   overflow-x: hidden !important;

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T19:05:17.570

"width:100%;height:100%" 可能是罪魁祸首。使 iframe 的大小大于框架窗口。也尝试使用 scrolling="no"

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-08T03:05:24.387

我使用 Web 捕获 Web 部件而不是页面查看器 Web 部件获得了最佳结果。

确保您的内容没有定义大小（因此它在较小的框架中流动），然后调整网络捕获部分的大小，直到滚动条消失。

干杯，里夫斯

# iis - 如何记录 *所有* ColdFusion 脚本和使用的 CFC？

> ID：368490
> 
> 赞同：1
> 
> 时间：2008-12-15T14:16:49.897
> 
> 标签：iis, logging, coldfusion

我希望从大型代码库中确定在一段时间内实际使用了哪些文件。我需要了解 CFM 页面和 CFC 以及任何包含的 CFM 文件等。

我知道我可以使用登录 application.cfm 或使用 IIS 来获取其中的*一些信息，但我仍然会丢失任何包含文件和使用的任何 CFC。*

有没有办法让 CF 记录它执行的每个文件？理想情况下，我希望将任何新编码保持在最低限度或仅在一个地方。

谢谢， 夏兰

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T14:12:47.377

嗯，我认为您需要打开调试并创建自定义调试模板。

调试模板位于：[coldfusiondir]/wwwroot/WEB-INF/debug

查看`classic.cfm`用于将模板显示到屏幕的代码，然后创建一些类似的代码，将每个模板运行记录到合适的数据存储中。

注意：报告执行时间和 CFC 存在性能问题（在 CFMX6/7 中），因此请确保禁用该设置，并删除任何相关代码。

事实上，如果这要在 Live 环境中运行（不理想），那么请确保您将自定义模板精简为仅执行此日志记录所需的最少代码。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-12-20T12:30:48.590

使用调试模板的方法将有效，但仅在您启用调试时才有效。如果代码库很大且笨拙，并且您必须收集此信息的唯一地方是实时的，那么请确保这些模板没有输出任何内容。

此外，您的 CFC 调用会减慢很多。要非常小心，看看这会如何破坏您的服务器。

就我个人而言，我只会让它更新一个服务器级别的结构，而不仅仅是文件名。

```
<cfparam name="server.st_FileLog" default="#structNew()#">
<cfparam name="server.st_FileLog[thisFile]" default="1"> 
```

Application.cfc 或 Application.cfm 中的这两行可能就是这样做的。

然后只需要一段单独的代码来转储代码。

```
<cfoutput><code>#structKeyList(server.st_FileLog,chr(13))#</code></cfoutput> 
```

# rhino-mocks - 是否可以使用 Rhino Mocks 生成部分存根？

> ID：368493
> 
> 赞同：2
> 
> 时间：2008-12-15T14:17:05.573
> 
> 标签：rhino-mocks, stub

我通常是单元测试和模拟的新手，并且正在尝试为我的一个类设置测试，我想确保从同一个类中的另一个方法调用特定方法。因此，我想使用具体的实现，但要模拟它的一部分。这可能吗？

```
公共课 MyClass
{
  公共帐户[] GetAccounts()
  {
      返回GetAccounts（空）；
  }

  public Accounts[] GetAccounts(CustomerId id)
  {
      如果（id == null）
      {
          // 获取所有账户
      }
  }
}

```

因此，我试图设置一个将调用 GetAccounts() 的存根（我想使用具体的实现），但我想检查该方法是否调用 GetAccounts(null)。

```
[测试]
公共无效GetAccountsTest（）
{
  MockRepository 模拟 = new MockRepository();
  MyClass 存根 = mocks.Stub();
  使用（模拟。记录（））
  {
     Expect.Call(() => stub.GetAccounts()).CallOriginalMethod();
     Expect.Call(() => stub.GetAccounts(null));
  }
  模拟.ReplayAll();
  stub.GetAccounts();
  mocks.VerifyAll();
}

```

问题是具体类在 CallOriginalMethod() 行上被调用，当我调用 stub.GetAccounts() 时，我希望在重放期间调用该行。因此，无论是在录制期间还是在我执行测试时，当我只是想模拟它们时都会调用实现的具体方法——正如我已经解释的那样。这是我的误解吗？我应该不能模拟/存根具体类和接口吗？

我是否需要将 virtual 关键字添加到我希望能够模拟的方法中？

这甚至可能吗？我该怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T14:23:24.780

看起来您可能想要使用 PartialMock。它将允许您模拟虚拟方法。

# wcf - WCF 请求失败，HTTP 状态为 405：不允许方法

> ID：368494
> 
> 赞同：7
> 
> 时间：2008-12-15T14:17:16.103
> 
> 标签：wcf, http-status-code-405

我有一个托管在 Windows 服务上的 WCF 服务，并使用 BasicHttp 端点为已连接到它的 Windows Mobile 设备提供服务。

问题在于设备模拟器。我可以连接到该服务并毫无问题地使用它，但可以使用实际设备。我收到错误：

> WCF 请求失败，HTTP 状态为 405：方法不允许。

我使用以下代码来实现该服务。

```
BasicHttpBinding basicHttpBinding = new BasicHttpBinding();
basicHttpBinding.UseDefaultWebProxy = false;

m_ServiceHost.AddServiceEndpoint(typeof(IKooft), basicHttpBinding, "KooftService");
m_ServiceHost.Open(); 
```

我怎么解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T16:42:35.040

检查您的 IIS 扩展，尤其是 .wsdl 的扩展是否有效：

在 IIS 中：

*   查看您网站的属性。
*   在主目录选项卡中，单击配置。
*   点击添加（我的路径是“C:\Program Files (x86)\Common Files\MSSOAP\BINARIES\SOAPIS30.DLL”）
*   将扩展名设置为 .WSDL 并允许“获取”和“发布”
*   选择“脚本引擎”和“验证文件是否存在”

应该是这样的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-04-01T06:33:35.143

如果您使用的是 WCF REST 服务，您应该像这样定义您的合同方法：

```
[OperationContract]
[WebInvoke(Method = "POST", ResponseFormat = WebMessageFormat.Json)]
string CheckService(); 
```

特别注意`WebInvoke`属性和`Method="POST"`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T19:24:55.877

使用 WCF 时，您可能还需要将 .svc 文件类型映射到 IIS 中的 aspnet_isapi.dll。

# sql - 是否可以使用列序号位置选择 sql server 数据

> ID：368505
> 
> 赞同：36
> 
> 时间：2008-12-15T14:21:20.230
> 
> 标签：sql, sql-server, sql-server-2005, tsql, ordinals

是否可以使用 ordinal_position 为表列选择列数据？我知道使用序数位置是一种不好的做法，但对于一次性数据导入过程，我需要能够使用序数位置来获取列数据。

所以例如

```
create table Test(
    Col1 int,
    Col2 nvarchar(10)

) 
```

而不是使用

```
select Col2 from Test 
```

我可以写吗

```
select "2" from Test -- for illustration purposes only 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2015-08-14T11:50:42.547

如果您知道列的数量，但不知道其名称和类型，则可以使用以下技巧：

```
select NULL as C1, NULL as C2 where 1 = 0 
-- Returns empty table with predefined column names
union all
select * from Test 
-- There should be exactly 2 columns, but names and data type doesn't matter 
```

结果，您将拥有一个包含 2 列 [C1] 和 [C2] 的表。如果表中有 100 列，此方法不是很有用，但它适用于预定义列数较少的表。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-15T14:45:17.467

你必须做类似的事情

```
declare @col1 as varchar(128)
declare @col2 as varchar(128)
declare @sq1 as varchar(8000) 

select @col1 = column_name from information_schema.columns where table_name = 'tablename'
and ordinal_position = @position

select @col2 = column_name from information_schema.columns where table_name = 'tablename'
and ordinal_position = @position2

set @sql = 'select ' + col1 ',' + col2 'from tablename' 

exec(@sql) 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-15T14:39:11.660

您可以使用此查询

```
select * from information_schema.columns 
```

获取列的序数位置。就像 Michael Haren 所写的那样，您必须使用它来构建一个动态查询，无论是在代码中还是在将列位置传递给的存储过程中。

FWIW，这是纯粹的邪恶。

另外，deathofrats 是对的，您不能真正做到这一点，因为您将根据位置构建一个带有列名的常规查询。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-15T14:27:04.150

是的，您可以通过对系统表的一些非常丑陋的点击来做到这一点。您可能需要进入动态 sql 的世界。

我真的，真的不推荐这种方法。

如果那没有阻止您，那么这可能会让您开始（[参考](http://www.experts-exchange.com/Databases/Q_21310849.html)）：

```
select table_name, column_name, ordinal_position, data_type
from information_schema.columns
order by 1,3 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T14:29:22.850

不，据我所知，您不能根据它们的顺序位置选择列。

在查看事务 SQL 参考时，没有任何建议可以 ( [http://msdn.microsoft.com/en-us/library/ms176104(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms176104(SQL.90).aspx) )。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-05-14T15:31:13.150

如果您知道列数，一种方法可能是将数据传输到具有该列数的 tmp 表中，然后从临时表中选择...

```
declare @tmp table(field1 sql_variant, field2 int, field3 sql_variant)

insert into @tmp
select * from Test

select field2 from @tmp 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-01-12T10:28:07.573

您可以选择使用条件：在您的示例中：

```
 SELECT 
     CASE YourColumnNumber 
      WHEN "1" THEN Col1
      WHEN "2" THEN Col2
      ELSE "?"
     END AS Result
    FROM Test 
```

恐怕去模式会减慢查询速度......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T14:39:23.657

我不认为你可以。正如@Michael Haren 所示，您可以在 ORDER BY 子句中使用序数位置，但我从未见过它们在 SQL Server 的其他地方使用过。

我不确定你的一次性数据导入有什么问题，这将有助于解决 - 大概是一些不幸的列名？你能再解释一下吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-15T14:51:53.257

除了使用动态 SQL，我不知道有什么方法可以做到这一点。也许如果你包含更多关于为什么你觉得你必须使用这里的序数值的信息，那么有人可以就如何解决这个问题给你建议。

编辑：我看到你在另一条评论中在某种程度上回答了这个问题。你能提供更多细节吗？导入过程和/或表定义？

* * *

## 回答 #10

> 赞同：-6
> 
> 时间：2008-12-15T15:00:31.837

如果您使用的是 MS SQL 2005，您可以使用 ROW_NUMBER 函数。

SELECT Col1, Col2, ROW_NUMBER() OVER(ORDER BY Col1) FROM Test WHERE ROW_NUMBER() Over(Order BY Col1) 在@Position 和 @Position 之间

如果我正确阅读了问题，那应该会给您带来理想的结果。

# blackberry - 黑莓开发，它和智能手机开发一样用户友好吗？

> ID：368514
> 
> 赞同：0
> 
> 时间：2008-12-15T14:23:10.383
> 
> 标签：blackberry, sdk, smartphone

我玩过智能手机开发（windows ce），使用 vs.net 并拥有一个不错的模拟器等似乎很简单。

黑莓的发展如何？看到它使用 JavaME，我猜想为 .net 开发人员学习 SDK/语法并不难。

但是开发 IDE、调试、仿真器等呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T14:57:15.603

我对黑莓的体验非常有限，但就我所拥有的而言，它相当用户友好。Java 与您可能用于 CE 开发的 C# 非常相似。

您可能会使用 Eclipse 作为 IDE，一旦您习惯了它就很好。来自 Visual Studio 可能会让您有点沮丧，但请给它一个机会。

至于调试和模拟器，根据我有限的经验，没有问题。实际上，我发现 Blackberry 在很多方面都比任何 CE 设备都好得多。

还有一个用于黑莓开发的 Visual Studio 插件，但它需要在使用所开发程序的黑莓上安装运行时，因此它仅对您可以控制用户手机的企业应用程序真正有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T15:28:24.697

除了语法高亮和“智能插入”编辑器、编译器和调试器之外，BlackBerry 还提供了一个[Java 开发环境，该环境具有许多集成工具（特别是覆盖、内存使用和分析）。](http://na.blackberry.com/eng/developers/javaappdev/javadevenv.jsp)BlackBerry 代码签名工具、JAD 和 COD 生成也包括在内。

我发现在 Eclipse 中开发代码、使用 Ant 编译（使用 etaras 的 RAPC ant 任务，但它们似乎已经消失了——BlackBerry [Ant Tools](http://bb-ant-tools.sourceforge.net/)似乎是一个合适的替代品）并使用 JDE调试/分析等

我没有使用新的 RIM Eclipse 插件。

[MDS Studio](http://na.blackberry.com/eng/developers/rapidappdev/mdsstudio.jsp)具有基于 Eclipse 和 Visual Studio 的环境。我发现它对于制作 UI 原型很方便，但对于进行任何自定义开发来说却很麻烦。BB 将其推销为“快速应用程序开发”，它具有这种范式的优点和缺点。

我发现 BlackBerry 开发与其他基于 Java 的专用应用程序非常相似——如果您开发标准的 J2ME Midlet 应用程序，您不需要了解更多。如果你真的想利用 BlackBerry 的独特功能，与 BB 应用程序集成等，那么你需要学习 BlackBerry 特定的 API——javadoc 很好，论坛和白皮书有帮助，但很少有真正的“概述” ”文件或文件告诉你如何把它们放在一起。

警告 Emptor、YMMV 等，令人作呕。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T14:59:59.717

实际上，正是出于这个原因，我才购买了一个黑莓。您可以使用 Eclipse IDE，然后安装 JDE 插件。JDE 插件包括黑莓 sdk 以及一些模拟器。

编辑 - [http://na.blackberry.com/eng/developers/javaappdev/](http://na.blackberry.com/eng/developers/javaappdev/)

几周前我在设置环境时遇到了一个问题，但是，我在黑莓论坛中找到了我的解决方案。YMMV

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T15:05:53.353

还有一个名为[“Blackberry MDS studio”](http://na.blackberry.com/eng/developers/rapidappdev/mdsstudio.jsp)的 Blackberry 开发环境，它是 Java 的替代品。我知道我的一些 Lotus Notes 开发人员喜欢这个 IDE，因为它更直观。就我个人而言，我更喜欢作为 Java 开发人员的 Java。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T15:12:13.403

支持社区对那些显然已经对他们所写的内容进行了一些思考的人提出的精心编写的问题做出了相当快的回应。RIM 也很快为新手机发布了新的模拟器更新，我过去曾遇到过来自其他制造商的问题。

# performance - ColdFusion Web 应用程序级查询缓存

> ID：368516
> 
> 赞同：1
> 
> 时间：2008-12-15T14:23:34.843
> 
> 标签：performance, caching, coldfusion, cluster-computing

我们有许多 Web 服务器，每个服务器运行一个版本的 ColdFusion。集群前面有一个负载均衡器。

显然，这些服务器中的每一个都运行着自己的 CF 应用程序，这在 CF 应用程序级别实现了查询缓存。但是，由于所有这些服务器都服务于一个 Web 应用程序，因此这些缓存查询中的许多查询在 CF 应用程序实例之间重复。

有没有办法在 Web 应用程序级别（即跨许多 CF 实例）实现查询缓存。或者如果没有，是否有更好的方法来设置我们的集群以最小化数据库服务器上的负载？

我希望我说清楚了:)

干杯，Ciaran

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T14:58:42.307

你可以考虑试试[memcached 。](http://www.flexablecoder.com/blog/index.cfm/2007/12/11/external-caching-for-coldfusion-with-memcached)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T03:30:03.680

我会看看 memcached - 这里有一个用于将它集成到 ColdFusion 中的开源项目：[cfmemcached](http://cfmemcached.riaforge.org)。

如果您碰巧在使用 Railo，我听说它也有一个“集群”范围。

如果这些都不可用或对您没有吸引力，您也可以设置一个服务器来处理您想要缓存的查询，然后直接通过 Web 服务从该服务器获取它们。这样您就可以将它们缓存在一台服务器上，这将减少整个集群的内存占用，并降低对数据库服务器的访问频率。但是，您可能希望将处理查询缓存的服务器从集群中取出，并将其专门用于查询缓存以及您想要从前端机器卸载的任何其他内容，而其他服务器则处理外部流量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T08:19:18.063

决定在我们的每个 Web 服务器上使用[EHCache](http://ehcache.sourceforge.net/)，因为它允许部分页面缓存，并且可以扩展到中央缓存服务器，例如 memcached。到目前为止非常满意。

非常感谢所有的建议！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T00:07:00.913

您可以跨服务器集群并在服务器之间共享应用程序范围，但您必须使用企业版的 ColdFusion。更多信息在这里： http: [//livedocs.adobe.com/coldfusion/7/htmldocs/00001774.htm](http://livedocs.adobe.com/coldfusion/7/htmldocs/00001774.htm)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T22:19:09.703

如果您打开 j2ee 会话，会话范围可以聚集在 ColdFusion 中。但是集群范围所做的只是跨服务器复制数据。因此查询仍将被复制到所有 3 台服务器上。所以你会回到你现在的位置。

但是，我将只使用 cfquery 的 CachedWithin 属性，而不是使用应用程序范围。这样，您就可以让 CF 引擎进行实际的缓存管理。防止内存失控，并且不会增加在服务器之间复制大量数据的开销。

# xml - API 设计：公开 XML 或对象

> ID：368521
> 
> 赞同：1
> 
> 时间：2008-12-15T14:25:13.593
> 
> 标签：xml, wcf, architecture, n-tier-architecture

我们正在着手开发一项新的中间层服务，该服务将允许内部客户端系统在一些底层数据存储中创建、更新和查询记录。该服务将聚合多达 3 个独立的底层数据存储。出于这个问题的目的，假设：

数据存储#1：专有 XML 数据库。
数据存储#2：现成的关系数据库。
数据存储#3：平面文件存储（以二进制形式存储的文件）。

客户端将不知道（也不关心）他们正在查询/更新哪个数据存储。新服务将做出该决定。我的问题是：我的 API 应该公开 XML 还是对象？例如，新的 API 将有一个 add 方法。假设我们的系统是一个车载存储系统，那么API的add方法可能是这样的：

```
AddNewCar( CarObject car ) 
```

或者，它可能看起来像这样：

```
AddNewCar( string carXml ) 
```

现在，即使第二个方法在入口处被弱类型化，XML 将立即根据模式进行验证，至少是。

新服务将用 C# 编写（尚未确定哪个版本，但可能是 WCF 的 3/3.5）。API 的客户端可以是 C#/VBA/VB.Net/C++/Java)。

任何更多细节请告诉我。谢谢

* * *

更新：请注意，API 还将通过消息总线发布 XML。例如，当添加新车时，将发布汽车 XML，以便任何对新车感兴趣的人都会收到通知。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T14:32:21.550

您不应该公开 XML，因为这会修复您的格式以及您可能面临的有关基础架构的任何未来决策。我总是走强类型路线，以确保您正确地将您的实现从使用中抽象出来。

如果您采用 XML 路线并在开发过程中发现 XML 出于某种原因必须更改，那么更改 API 的所有用途以纠正该问题将比您强类型化 API 和将 XML 细节隐藏在对象后面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T14:29:18.623

当然，从最终用户开发人员的角度来看，严格类型的方法将是最简单的，这是我更喜欢的。但是，如果最终一切都在幕后转换为 Xml，或者您不确定您的客户将采用哪种方法，我绝对建议您同时支持这两种方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T14:32:26.340

您应该使用对象创建 API，并在需要时利用 WCF 提供 XML API。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T15:11:28.477

您应该使用对象创建一个 API，然后围绕该 API 创建一个 Web 服务接口（例如，对于 Java，您将在接口上使用 java2wsdl，然后使用 wsdl2java 创建一个框架服务器端实现或客户端实现，我确保 WCF 中存在所有其他系统都可以查询的等效方法。

由于您有多语言客户端，我认为 Web 服务是您的最佳选择，并且（忽略业务逻辑实现）只需几分钟即可在您的 API 之上工作。您可以将 wsdl 或 xsd 文件分发给所有客户端软件的开发人员，然后他们可以使用这些文件简单快速地连接到您的系统。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T12:44:34.263

我会说公开一个对象 API。虽然不是因为上面另一篇文章中提到的原因 - 公开 XML 会导致更难更改的固定格式。

可以说，强类型业务对象的 API 与 XML 一样难以更改——两者都需要重新编译和重新构建。所以这不是您应该丢弃 XML 的原因。

原因 - IMNSHO - 是抽象级别的原因。在 API 级别，您谈论的是哪些业务对象或服务可以对哪些其他业务对象执行哪些操作。因此，API 必须根据业务对象进行交谈。

正如在另一篇文章中已经提到的，您始终可以使用 XML 表示来支持业务对象。将业务对象和服务的 XML 表示保持在较低的抽象级别，您的 API 将为您提供 XML 的所有灵活性，同时允许您构建具有良好语义的更高级别的 API。

# vb.net - Mono 应该更好地支持哪些 .NET 函数？

> ID：368540
> 
> 赞同：3
> 
> 时间：2008-12-15T14:33:08.677
> 
> 标签：vb.net, visual-studio, mono

我正在尝试实现一个 Visual Studio 插件来支持跨平台开发。该插件目前仅在使用不受支持的功能时警告开发人员，但我还想实现一个功能，通知他已实现但产生副作用/不稳定等的功能。

谁能帮我？我真的很感激这个！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T15:17:39.803

Mono 提供了一个实用程序来分析应用程序二进制文件并检查 Mono 支持，称为 Mono Migration Analyzer。您可能可以阅读源代码以了解有关较少支持的功能的更多信息。您甚至可以直接在您的插件中使用运行此工具并处理结果。

# asp.net - 在网页中实现快捷键

> ID：368542
> 
> 赞同：11
> 
> 时间：2008-12-15T14:33:51.983
> 
> 标签：asp.net, web-applications

我正在考虑在宠物网络应用程序中实现快捷键，我正在为我开发。我正在使用 c# 和 asp.net。

我见过很少有网站（坦率地说我只记得 g-mail）有快捷键。

有没有人为 Web 应用程序实现过快捷键，如果有，该怎么做？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T14:40:10.003

访问密钥没有用，但如果您坚持使用它们，请访问[此站点。](http://www.cs.tut.fi/~jkorpela/forms/accesskey.html)使用它比使用 javascript 好得多，尽管访问密钥的方式因浏览器而异。与丑陋的 Javascript 解决方案相比，它的优势在于它让浏览器和用户的浏览器设置来处理它们。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-12-05T15:06:54.133

[Mousetrap](http://craig.is/killing/mice)是一个用于处理快捷键的优秀 JavaScript 库。

根据我看到其他应用程序（Gmail、JIRA）使用快捷键的方式，并根据我自己的经验，我会提出几点建议：

*   干扰浏览器快捷键是一种真正的可能性。避免这种情况的最可靠方法是使用未修改的字母（即，`A`代替`Ctrl-A`or `Alt-A`）。
*   键盘快捷键对于网站来说相对较少，因此它们的可发现性很差。由于它们不太容易被发现，因此您需要添加工具提示或不显眼的提示，让用户知道它们的存在。键盘快捷键似乎对预计会大量使用的 Web 应用程序（如 Gmail 和 JIRA）最有用；否则，就没有足够的机会或好处来学习它们。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T14:38:37.823

如果您启用此功能，**请确保您可以打开和关闭它**- 请注意，您的快捷方式可能会干扰或与许多辅助软件包（即 Jaws）的内置快捷方式发生冲突，并且**可能会适得其反可访问性条款**。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-15T14:36:57.983

[在 JavaScript 中处理键盘快捷键](http://ajaxian.com/archives/handling-keyboard-shortcuts-in-javascript)

但我理解为什么很少有网站使用它——这种方式有很多困难。并鼓励你也不要使用它。或者不把它作为主要功能。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-15T14:42:54.040

为了实现这一点，您需要使用 JavaScript 注册所需的键盘组合键。这就像在 C# 中为某些事件注册动作侦听器。我在 Google 上找到的第一个 URL 似乎有一个很好的概述：[Handling Keyboard Shortcuts in JavaScript](http://www.openjs.com/scripts/events/keyboard_shortcuts/)。

一旦注册了键盘事件，您就可以使用 JavaScript 在您的 ASP.net 后端调用 AJAXy（我认为是技术上的 JSON 调用）操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-29T06:18:15.837

```
<script  type="text/javascript">
    if (window.captureEvents) {
        window.captureEvents(Event.KeyUp);
        window.onkeyup = executeCode;
    }
    else if (window.attachEvent) {
        document.attachEvent('onkeyup', executeCode);
    }

    function executeCode(evt) {
        if (evt == null) {
            evt = window.event;
        }
        var theKey = parseInt(evt.keyCode, 10);
        switch (theKey) {
            case 35:  // End
                document.getElementById("<%=btnSave.ClientID%>").click();
                //document.getElementById('ctl00_ContentPlaceHolder1_btnHome').click(); 

                break;
            case 36:  // F8
                document.getElementById('btnreset').click();
                break;
            case 120:  // F9
                // document.getElementById('Button1').click();

                break;
            case 87: //w
                if (window.event.altKey)
                    document.getElementById('buttonid').click();
                break;
        }
        evt.returnValue = false;
        return false;
    }

</script>

             <asp:Button ID="btnSave" runat="server" Text="Button"  />
           </asp:Content> 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2013-12-27T05:28:20.497

```
use this javascript on your master page this work using keycode.........

------------------------------------------ 

var isfocused=false;    
   document.onkeydown = overrideKeyboardEvent;
document.onkeyup = overrideKeyboardEvent;
var keyIsDown = {};
var get_focused="";
function overrideKeyboardEvent(e){
  switch(e.type){
    case "keydown":
      if(!keyIsDown[e.keyCode]){
        keyIsDown[e.keyCode] = true;
        // do key down stuff here
       if (e.keyCode == 40) {
                var t = new Array;
                t = document.getElementsByTagName("input");
                var n = "1";
                for (var r = 0; r < t.length; r++) {
                    if (t[r].type == "checkbox") {
                        var i = document.cookie.split(";");
                        var s = y = i[0].substr(i[0].indexOf("=") + 1);
                        if (s.toLowerCase().indexOf("active") != -1) {
                            if (n == "2") {
                                document.getElementById(t[r].id).focus();
                                document.cookie = "aa" + "=" + t[r].id;
                                return false
                            }
                            if (t[r].id == s) {
                                n = "2"
                            }
                        } else {
                            document.getElementById(t[r].id).focus();
                            document.cookie = "aa" + "=" + t[r].id;
                            return false
                        }
                    }
                }
            }
         if( e.keyCode==115)
        {    e.preventDefault();
             var c = new Array();
             c = document.getElementsByTagName('input');
             for (var i=0;i<c.length;i++)
             {
                 if(c[i].type=='submit' && c[i].value=='Submit' ||  c[i].type=='submit' && c[i].value=='Summary Report' )
                 {  
                    e.preventDefault();
                    document.getElementById(''+c[i].id+'').click();
                  }
             }

           return ;

        }
         if( e.keyCode==27 )
        {
           window.location = document.referrer;
        }
        if( e.keyCode==46 )
        {
           var c=new Array();
           c=document.getElementsByTagName('tr');
           for(var i=0;i<c.length;i++)
           {
                if(c[i].onclick!=null)
                {
                    if(c[i].onclick.toString().indexOf('OnUserSelected')!=-1 && c[i].onclick.toString().indexOf(''+get_focused+'')!=-1)
                    {       
                         var children =new Array();
                         if(c[i].innerHTML.indexOf('remove')!=-1)
                         {
                         children = c[i].innerHTML.split('remove');
                         var gg=children[1];
                         var get1=new Array();
                         get1=gg.split('id="');

                        // document.getElementById('ctl00_ContentPlaceHolder2_hidden111').value='1111';
                         var a= document.getElementById(''+get1[1]+'remove').click();
                         return false;
                       //__doPostBack(''+get1[1]+'remove','');
                        }
                        else
                        {
                            children = c[i].innerHTML.split('delete');
                         var gg=children[1];
                         var get1=new Array();
                         get1=gg.split('id="');

                        // document.getElementById('ctl00_ContentPlaceHolder2_hidden111').value='1111';
                         var a= document.getElementById(''+get1[1]+'d`enter code here`elete').click();
                         return false;
                        }

                    }
                }
           }
        }
         if( e.keyCode==112 )
        {   
            e.preventDefault();
            var c=new Array();
            c=document.getElementsByTagName('a');

            for(i=0;i<c.length;i++)
            {
                if(c[i].innerText.indexOf('Add New')!=-1 || c[i].innerText.indexOf('Back to')!=-1)
                {
                    window.location=''+c[i].href+'';
                }
            }

        }
         if( e.keyCode==113)
        {
            if(get_focused!="")
            {
                var c=new Array();
                c=document.getElementsByTagName('input');

                for(var i=0;i<c.length;i++)
                {
                if(c[i].type=='hidden')
                  {

                    if(c[i].id.indexOf('hidden111')!=-1)
                    {
                    document.getElementById(''+c[i].id+'').value='00';
                    document.getElementById(''+c[i].id+'').value=get_focused;
                         __doPostBack(c[i].id,"");
                    }
                  } 
                }

            }
        }
         if (e.keyCode == 38) {

                var t = new Array;
                t = document.getElementsByTagName("input");
                var n = "1";
                for (var r = 0; r < t.length; r++) {
                    if (t[r].type == "checkbox") {
                        var i = document.cookie.split(";");
                        var s = y = i[0].substr(i[0].indexOf("=") + 1);
                        if (s.toLowerCase().indexOf("active") != -1) {
                            if (t[r].id == s) {
                                n = "2"
                            }
                            if (n == "2") {
                                var f = 0;
                                while (f == 0) {
                                    if (t[r - 1].type == "checkbox") {
                                        f = 1
                                    } else {
                                        r--
                                    }
                                }
                                document.getElementById(t[r - 1].id).focus();
                                document.cookie = "aa" + "=" + t[r - 1].id;
                                return false
                            }
                        }
                    }
                }
            }
        }
    break;
    case "keyup":
      delete(keyIsDown[e.keyCode]);
      // do key up stuff here
    break;
  }

  //e.preventDefault();
  return true;
}
function disabledEventPropagation(e) {
    if (e) {
        if (e.stopPropagation) {
            e.stopPropagation()
        } else if (window.event) {
            window.event.cancelBubble = true
        }
    }
}
document.body.setAttribute("onunload","getdeleted()");
function getdeleted()
{
     document.cookie="aa" + "=" +"";
}
0
function OnUserSelected(source,eventArgs) {

                   if(document.getElementById('ctl00_ContentPlaceHolder2_hidden111').value!='1111')
                   { 

                      var hdnValueID = 'ctl00_ContentPlaceHolder2_hidden111';
                    try
                    {
                   document.getElementById(hdnValueID).value =source;

                    document.getElementById(hdnValueID).value = eventArgs;
                    __doPostBack(hdnValueID, "");
                    }

                    catch(errorr)

                    {
                        alert(errorr);
                    }
                  }
                else
                {
                   get_focused =eventArgs;

                     document.getElementById('ctl00_ContentPlaceHolder2_hidden111').value='';

                }
                    } 
```

# python - 如何停止 While 循环？

> ID：368545
> 
> 赞同：14
> 
> 时间：2008-12-15T14:35:02.153
> 
> 标签：python, while-loop

我`while loop`在一个函数中写了一个，但不知道如何停止它。当它不满足其最终条件时，循环就永远进行下去。我怎样才能阻止它？

```
def determine_period(universe_array):
    period=0
    tmp=universe_array
    while True:
        tmp=apply_rules(tmp)#aplly_rules is a another function
        period+=1
        if numpy.array_equal(tmp,universe_array) is True:
            break    #i want the loop to stop and return 0 if the 
                     #period is bigger than 12
        if period>12:  #i wrote this line to stop it..but seems it 
                       #doesnt work....help..
            return 0
        else:   
            return period 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-15T14:37:59.760

只需正确缩进您的代码：

```
def determine_period(universe_array):
    period=0
    tmp=universe_array
    while True:
        tmp=apply_rules(tmp)#aplly_rules is a another function
        period+=1
        if numpy.array_equal(tmp,universe_array) is True:
            return period
        if period>12:  #i wrote this line to stop it..but seems its doesnt work....help..
            return 0
        else:   
            return period 
```

您需要了解`break`示例中的语句将退出您使用创建的无限循环`while True`。所以当break条件为True时，程序会退出无限循环，继续下一个缩进块。由于您的代码中没有后续块，因此函数结束并且不返回任何内容。因此，我通过用语句替换`break`语句来修复您的代码`return`。

按照您的想法使用无限循环，这是编写它的最佳方式：

```
def determine_period(universe_array):
    period=0
    tmp=universe_array
    while True:
        tmp=apply_rules(tmp)#aplly_rules is a another function
        period+=1
        if numpy.array_equal(tmp,universe_array) is True:
            break
        if period>12:  #i wrote this line to stop it..but seems its doesnt work....help..
            period = 0
            break

    return period 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T14:38:42.847

```
def determine_period(universe_array):
    period=0
    tmp=universe_array
    while period<12:
        tmp=apply_rules(tmp)#aplly_rules is a another function
        if numpy.array_equal(tmp,universe_array) is True:
            break 
        period+=1

    return period 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T18:03:02.217

Python 中的`is`运算符可能不符合您的预期。而不是这个：

```
 if numpy.array_equal(tmp,universe_array) is True:
        break 
```

我会这样写：

```
 if numpy.array_equal(tmp,universe_array):
        break 
```

运算符测试对象身份，这`is`与相等性完全不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T19:03:27.803

我会使用 for 循环来做到这一点，如下所示：

```
def determine_period(universe_array):
    tmp = universe_array
    for period in xrange(1, 13):
        tmp = apply_rules(tmp)
        if numpy.array_equal(tmp, universe_array):
            return period
    return 0 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2021-06-27T17:35:36.527

这是 Charles Severance 的“python or everyone”中关于编写 while True 循环的一段示例代码：

```
while True:
    line = input('> ')
    if line == 'done':
        break
    print(line)
print('Done!') 
```

这帮助我解决了我的问题！

# .net - 逗号“化”项目列表

> ID：368551
> 
> 赞同：13
> 
> 时间：2008-12-15T14:38:12.257
> 
> 标签：.net, string, vb.net

给定一个字符串列表，将这些字符串连接成一个逗号分隔列表的最佳方法是什么，最后没有逗号。（VB.NET 或 C#）（使用 StringBuilder 或 String Concat。）

```
Dim strResult As String = ""
Dim lstItems As New List(Of String)
lstItems.Add("Hello")
lstItems.Add("World")
For Each strItem As String In lstItems
    If strResult.Length > 0 Then
        strResult = strResult & ", "
    End If
    strResult = strResult & strItem
Next
MessageBox.Show(strResult) 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-15T14:42:47.177

```
Dim Result As String
Dim Items As New List(Of String)
Items.Add("Hello")
Items.Add("World")

Result = String.Join(",", Items)
MessageBox.Show(Result) 
```

如果您真的关心空字符串，请使用此连接函数：

```
Function Join(ByVal delimiter As String, ByVal items As IEnumerable(Of String), Optional ByVal IgnoreEmptyEntries As Boolean = True) As String
    Dim delim As String = ""
    Dim result As New Text.StringBuilder("")

    For Each item As String In items
        If Not IgnoreEmptyEntries OrElse Not String.IsNullOrEmpty(item) Then
            result.Append(delim).Append(item)
            delim = delimiter
        End If
    Next
    Return result.ToString()
End Function 
```

* * *

上面的真的很老了。今天，我会像这样清除空字符串：

```
Dim Result As String = String.Join("," Items.Where(Function(i) Not String.IsNullOrWhitespace(i))) 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-28T19:43:58.217

解决方案是否*必须*使用 a`StringBuilder`或`Concat`方法？

如果没有，您可以使用静态`String.Join`方法。例如（在 C# 中）：

```
string result = String.Join(",", items.ToArray()); 
```

有关更多详细信息，请参阅[我非常相似的问题](https://stackoverflow.com/questions/799446/creating-a-comma-separated-list-from-iliststring-or-ienumerablestring)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-15T14:53:43.783

像这样：

```
lstItems.ToConcatenatedString(s => s, ", ") 
```

如果您想忽略示例中的空字符串：

```
lstItems
    .Where(s => s.Length > 0)
    .ToConcatenatedString(s => s, ", ") 
```

我的工具箱中最流行的自定义聚合函数。我每天都使用它：

```
public static class EnumerableExtensions
{

    /// <summary>
    /// Creates a string from the sequence by concatenating the result
    /// of the specified string selector function for each element.
    /// </summary>
    public static string ToConcatenatedString<T>(
        this IEnumerable<T> source,
        Func<T, string> stringSelector)
    {
        return EnumerableExtensions.ToConcatenatedString(source, stringSelector, String.Empty);
    }

    /// <summary>
    /// Creates a string from the sequence by concatenating the result
    /// of the specified string selector function for each element.
    /// </summary>
    /// <param name="separator">The string which separates each concatenated item.</param>
    public static string ToConcatenatedString<T>(
        this IEnumerable<T> source,
        Func<T, string> stringSelector,
        string separator)
    {
        var b = new StringBuilder();
        bool needsSeparator = false; // don't use for first item

        foreach (var item in source)
        {
            if (needsSeparator)
                b.Append(separator);

            b.Append(stringSelector(item));
            needsSeparator = true;
        }

        return b.ToString();
    }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-15T15:07:42.197

从 String.Join 答案开始，忽略空/空字符串（如果您使用的是 .NET 3.5），您可以使用一些 Linq。例如

```
Dim Result As String
Dim Items As New List(Of String)
Items.Add("Hello")
Items.Add("World")
Result = String.Join(",", Items.ToArray().Where(Function(i) Not String.IsNullOrEmpty(i))
MessageBox.Show(Result) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-23T19:33:23.140

如果您不必*使用*`StringBuilder`或方法，`Concat`您也可以使用：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;
using System.Net;
using System.Configuration;

namespace ConsoleApplication
{
    class Program
    {
        static void Main(string[] args)
        {
            CommaDelimitedStringCollection commaStr = new CommaDelimitedStringCollection();
            string[] itemList = { "Test1", "Test2", "Test3" };
            commaStr.AddRange(itemList);
            Console.WriteLine(commaStr.ToString()); //Outputs Test1,Test2,Test3
            Console.ReadLine();
        }
    }
} 
```

*这需要引用 System.Configuration*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T14:43:54.460

有几种方法可以做到这一点，但它们基本上是主题的变体。

伪代码：

```
For Each Item In Collection:
  Add Item To String
  If Not Last Item, Add Comma 
```

我更喜欢的另一种方式是这样的：

```
For Each Item In Collection:
  If Not First Item, Add Comma
  Add Item To String 
```

编辑：我喜欢第二种方式的原因是每个项目都是独立的。使用第一种方法，如果您稍后修改了逻辑以便可能不会添加后续项目，那么您最终*可能会*在字符串末尾出现一个杂散的逗号，除非您还使前一个项目中的测试更加智能，即哑的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-15T14:49:02.797

或者你可以这样做：

```
Separator = ""
For Each Item In Collection
  Add Separator + Item To String
  Separator = ", " 
```

通过在第一次迭代中将分隔符设置为空字符串，您可以跳过第一个逗号。少一个 if 语句。这可能会或可能不会更具可读性，具体取决于您的习惯

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-15T15:48:26.670

您是否相信 .NET 框架中有一个提供此功能的类？

```
public static string ListToCsv<T>(List<T> list)
        {
            CommaDelimitedStringCollection commaStr = new CommaDelimitedStringCollection();

            list.ForEach(delegate(T item)
            {
                commaStr.Add(item.ToString());
            });

            return commaStr.ToString();
        } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-16T03:20:22.700

```
Dim strResult As String = ""
Dim separator = ","
Dim lstItems As New List(Of String)
lstItems.Add("Hello")
lstItems.Add("World")
For Each strItem As String In lstItems
     strResult = String.Concat(strResult, separator)
Next
strResult = strResult.TrimEnd(separator.ToCharArray())
MessageBox.Show(strResult) 
```

这个想法是使用`String.TrimEnd() function`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-16T02:07:52.050

感谢所有的回复。

似乎“正确”的答案取决于构建逗号分隔列表的上下文。我没有要使用的项目的整洁列表（必须使用某些东西作为示例......），但我确实有一个数组，其项目可能会或可能不会根据各种条件添加到逗号分隔列表中。

所以我选择了一些效果

```
 strResult = ""
strSeparator = ""
for i as integer = 0 to arrItems.Length - 1
  if arrItems(i) <> "test" and arrItems(i) <> "point" then
    strResult = strResult & strSeparator & arrItem(i)
    strSeparator = ", "
  end if
next 
```

像往常一样，有很多方法可以做到这一点。我不知道任何一种方法比另一种更值得赞扬或推广。有些在某些情况下更有用，而另一些则满足不同情况的要求。

再次感谢大家的意见。

顺便说一句，带有“我的头顶”代码示例的原始帖子没有过滤零长度项目，而是在添加逗号之前等待结果字符串变得大于零长度。可能不是很有效，但我还没有测试过。再一次，它不在我的脑海中。

# perl - 如何处理包含多种编码的文件？

> ID：368557
> 
> 赞同：2
> 
> 时间：2008-12-15T14:39:26.730
> 
> 标签：perl, encoding

我有一个小程序来排序和排序电子邮件，使用`$msg->decoded->string`. perl 程序输出到`stdout`，然后我将其重定向到 txt 文件。但是，由于字符集问题，gedit 无法打开此文本文件，我想知道如何使用 perl 恢复或设置字符集。

该程序现在是这样的：

```
#!/usr/bin/perl
use warnings;
use strict;
use Mail::Box::Manager;

open (MYFILE, '>>data.txt');

my $file = shift || $ENV{MAIL};
my $mgr = Mail::Box::Manager->new(
    access          => 'r',
);

my $folder = $mgr->open( folder => $file )
or die "$file: Unable to open: $!\n";

for my $msg ( sort { $a->timestamp <=> $b->timestamp } $folder->messages)
{
    my $to          = join( ', ', map { $_->format } $msg->to );
    my $from        = join( ', ', map { $_->format } $msg->from );
    my $date        = localtime( $msg->timestamp );
    my $subject     = $msg->subject;
    my $body        = $msg->decoded->string;

    # Strip all quoted text
    $body =~ s/^>.*$//msg;

    print MYFILE <<"";
From: $from
To: $to
Date: $date
$body

} 
```

但是，我遇到了同样的问题，即我无法使用 gedit 打开文件，即使它适用于 vi 等。如果文件中有非 unicode 字符，这会破坏它吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T15:42:08.490

不同的消息可能采用不同的编码。可能 gedit 将其检测为 UTF-8，但后来发现文件的某些部分不是 UTF-8。像这样的混合文件是主要的 PITA。

最好的（也许是唯一的）解决方案是检查内容类型 ( `$message->contentType`) 并将所有内容转换为 UTF-8。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T14:50:40.403

如果您只是重定向 Perl 的输出，那么 Perl 将很难生成一个像样的文件。

您应该尝试直接从 Perl 写入文件。

您还应该检查您是否真的有编码问题，或者根本不属于您的文件的字符是否仍然存在。使用 vi 或十六进制编辑器或简单地使用 hexdump 来执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T15:27:17.787

您可以使用 IO 层工具。打开这样的文件以指定编码：

```
open my $fh, '>:encoding(UTF-8)', $file; 
```

或者您可以使用 binmode() 来更改已打开的文件句柄：

```
binmode(STDOUT, ':encoding(UTF-8)'); 
```

当然，您可以设置除 utf8 之外的其他编码，还有很多其他选项。只需查看 open 和 binmode 的文档即可。也许 IO::File 也值得一看：

```
perldoc -f open
perldoc -f binmode
perldoc IO::File 
```

# internationalization - 搜索引擎和浏览器接受语言

> ID：368570
> 
> 赞同：10
> 
> 时间：2008-12-15T14:44:17.267
> 
> 标签：internationalization, search-engine

我正在构建一个门户网站，其中语言内容通常取决于浏览器发送的“接受语言”。因此，相同的 content-URI 将根据不同的用户的浏览器设置为不同的用户提供不同的内容。

我很想知道这将如何影响搜索索引。Google 是否使用所有语言编制索引，是否处理得当？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T14:55:46.977

他们不发送接受语言，因此该网站将以您选择的默认语言编制索引。

我建议您为每种语言设置不同的 URL，不仅适用于搜索引擎，还可以让用户在不更改“接受语言”的情况下更改站点语言，并让用户将 URL 发送给所选语言的朋友.

在这个[答案](https://stackoverflow.com/questions/82380/best-way-to-handle-urls-in-a-multilingual-site-in-aspnet)中，您了解了我在 .net 中的管理方式，但您会明白：使用“接受语言”进行第一个重定向，并且它们仅使用 url 播放。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T14:50:44.803

可能 Googlebot 不会发送任何接受语言。如果没有发送接受语言，我将对该站点进行编程以吐出所有语言的所有信息。

另一种解决方案是通过添加 URL 查询而不更改 URL 的基本部分来更改语言的链接，因此 Googlebot 仍将遍历所有语言并将人们指向正确的地址。在用户实际想要更改语言的情况下，具有更改语言的链接也很有用。

免责声明：我为 Google 工作，但我对 Googlebot 一无所知。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T14:55:07.137

接受语言 HTTP 标头不是强制性的，因此您应该在用户代理不发送时提供默认值。

为 Google 索引页面的 Googlebot 可能不会发送接受语言，因为它对所有语言都感兴趣并且不希望被限制在某些语言上。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T17:50:00.437

这是我自己问的。根据 W3C，这肯定是可能的，我们可以用不同的语言显示网站。我们还可以显示其他语言的菜单并将其存储在用户的 cookie 中，以便我们可以为用户完美地显示不同语言的站点。

因此，当用户登录时，我们会显示默认英语，但他可以从菜单中选择其他语言。我们将其存储在 cookie 中，然后我们就出发了。我们可以用不同的语言显示所有 URL。

然而，搜索引擎打破了这种可能性，坚持我们对每种语言都有不同的 URL，并惩罚我们显示重复的内容！！！（虽然语言不同，但内容/信息是一样的......对吧？？？）

这种使用搜索引擎的方法基本上很烂。虽然我也明白 WE（网页设计师）没有一个好的选择来告诉客户特定 URL 可用的语言（除了使用不同的 URL）

里斯·范特维斯克

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-12-15T14:46:59.040

基恩问题！

谷歌不在乎文本是什么语言，它只是索引！

# html - 发送在 Notes 7 中正确呈现的 HTML 电子邮件

> ID：368587
> 
> 赞同：1
> 
> 时间：2008-12-15T14:47:53.547
> 
> 标签：html, css, language-agnostic, lotus-notes

这里有人对如何发送在 Lotus Notes Client 7 上正确呈现的 HTML 电子邮件有任何经验吗？

我的电子邮件有几个复杂的 CSS 文件，我尝试将它们嵌入到 <style> 标签中，但它似乎不起作用。问题是电子邮件在版本 8 和其他电子邮件客户端上完美呈现。

任何提示或指示？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T15:23:19.263

Lotus Notes 7 有一个糟糕的 HTML 引擎。真的很糟糕。不是你。

这是一些关于处理它的[旧建议。](http://web.archive.org/web/20120422155811/http://www.templatekit.com/lotusnotes1.php)我还建议注册像[Litmus](http://litmusapp.com/email-testing)这样的电子邮件测试服务。如果你看不到问题，你永远不会解决问题。

（在我使用的模板中，我发现问题实际上出在 HTML 中。盒子模型有一些奇怪的问题。在 DIV 中包装一堆元素有帮助）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T15:00:27.920

这是各种电子邮件客户端的好图表。不幸的是，此时仅涉及 Notes 6，但它为您提供了一个起点。

[http://www.campaignmonitor.com/css/](http://www.campaignmonitor.com/css/)

# java - 在Java中将字符串从ASCII转换为EBCDIC？

> ID：368603
> 
> 赞同：20
> 
> 时间：2008-12-15T14:55:22.720
> 
> 标签：java, ascii, ibm-midrange, ebcdic

我需要编写一个“简单”实用程序来从 ASCII 转换为 EBCDIC？

Ascii 来自 Java、Web 和 AS400。我有一个谷歌，似乎找不到一个简单的解决方案（也许因为没有一个:(）。我希望有一个开源工具或为已经编写的工具付费。

也许像这样？

```
Converter.convertToAscii(String textFromAS400)
Converter.convertToEBCDIC(String textFromJava) 
```

谢谢，

斯科特

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-15T23:49:20.223

请注意，Java 中的字符串以 Java 的本机编码保存文本。当在内存中保存 ASCII 或 EBCDIC“字符串”时，在编码为字符串之前，您将在 byte[] 中拥有它。

```
ASCII -> Java：新字符串（字节，“ASCII”）
EBCDIC -> Java：新字符串（字节，“Cp1047”）
Java -> ASCII：string.getBytes("ASCII")
Java -> EBCDIC: string.getBytes("Cp1047")

```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-15T16:58:14.547

[JTOpen](http://jt400.sourceforge.net/)是 IBM 的 Java 工具箱的开源版本，它包含一组用于访问 AS/400 对象的类，包括用于访问本机 AS400 文本文件的 FileReader 和 FileWriter。这可能比编写自己的转换类更容易使用。

从 JTOpen 主页：

> 这里只是您可以使用 JTOpen 访问的众多 i5/OS 和 OS/400 资源中的一小部分：
> 
> *   数据库——JDBC (SQL) 和记录级访问 (DDM)
> *   集成文件系统
> *   程序调用
> *   命令
> *   数据队列
> *   数据区
> *   打印/假脱机资源
> *   产品和 PTF 信息
> *   作业和作业日志
> *   消息、消息队列、消息文件
> *   用户和组
> *   用户空间
> *   系统价值
> *   系统状态

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T15:05:54.320

您应该使用 Java 字符集 Cp1047 (Java 5) 或 Cp500 (JDK 1.3+)。

使用字符串构造函数：`String(byte[] bytes, [int offset, int length,] String enc)`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-04-01T23:31:57.883

```
package javaapplication1;

import java.nio.ByteBuffer;
import java.nio.CharBuffer;

import java.nio.charset.CharacterCodingException;

import java.nio.charset.Charset;

import java.nio.charset.CharsetDecoder;

import java.nio.charset.CharsetEncoder;

public class ConvertBetweenCharacterSetEncodingsWithCharBuffer {

    public static void main(String[] args) {

       //String cadena = "@@@@@@@@@@@@@@@ñâæÃÈÄóöó@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ÔÁâãÅÙÃÁÙÄ@ÄÅÂÉã@âæÉãÃÈ@@@@@@@@";
        String cadena = "ñâæÃÈÄóöó";
        System.out.println(Convert(cadena,"CP1047","ISO-8859-1"));
        cadena = "1SWCHD363";
        System.out.println(Convert(cadena,"ISO-8859-1","CP1047"));

    }

    public static String Convert (String strToConvert,String in, String out){
       try {

        Charset charset_in = Charset.forName(out);
        Charset charset_out = Charset.forName(in);

        CharsetDecoder decoder = charset_out.newDecoder();

        CharsetEncoder encoder = charset_in.newEncoder();

        CharBuffer uCharBuffer = CharBuffer.wrap(strToConvert);

        ByteBuffer bbuf = encoder.encode(uCharBuffer);

        CharBuffer cbuf = decoder.decode(bbuf);

        String s = cbuf.toString();

        //System.out.println("Original String is: " + s);
        return s;

    } catch (CharacterCodingException e) {

        //System.out.println("Character Coding Error: " + e.getMessage());
        return "";

    }

}

} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T15:02:45.437

您可以使用此[转换表](http://www.natural-innovations.com/computing/asciiebcdic.html)自己创建一个。

但[这里](http://www.reply42.com/ascii_ebcdic_comp_3/index.php)有一个链接到 Java 示例的站点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-01-24T15:04:02.187

也许，[像我一样](https://stackoverflow.com/questions/41817266/being-replaced-with-%C2%A3-in-jt400-encoding)，您并没有严格使用 JDBC 功能（在我的例子中写入数据队列），因此**自动魔法**编码不适用于您，因为我们通过多个 API 进行通信。

我的问题类似于@scottyab 的某些字符未映射的问题。就我而言，我引用的示例代码运行良好，但是将 xml 字符串写入数据队列导致 [ 被替换为 £。

作为一名使用具有数十年信息的预先存在的数据库后端的 Web 开发人员，**我并没有**像其他评论者所说的那样简单地“纠正”“错误配置”。

但是，通过向 400 发出命令以显示已知良好文件的文件字段信息，我能够看到我可能使用的编码字符集标识符：`DSPFFD *LIB*/*FILE*`.

这样做给了我很好的信息，包括特定的 CCSID 集： [![CCSID 标识符](https://i.stack.imgur.com/th03p.jpg)](https://i.stack.imgur.com/th03p.jpg)

[在CCSIDs 上](http://www.think400.dk/files/Whats_with_these_ASCII_EBCDIC_Unicode_CCSIDs.pdf)搜索了一些信息后，我在 IBM 的[EBCDIC](http://www.ibm.com/support/knowledgecenter/en/SSEPEK_11.0.0/char/src/tpc/db2z_ebcdic.html)页面上看到了一个页面，该页面上印有关键信息（因为它有消失的习惯）：

> 版本 11.0.0 扩展二进制编码十进制交换码 (EBCDIC) 是一种编码方案，通常用于 zSeries (z/OS®) 和 iSeries (System i®)。

最有帮助的：

> 一些示例 EBCDIC CCSID 是 37、500 和 1047。

由于我已经[从这个问题本身了解到这](https://stackoverflow.com/a/370101/7106420)是`Cp1047`另一个值得尝试的好字符集（这次，£ 变成了重音“Y”），我试图`Cp37`查看不存在这样的字符集，**但尝试`Cp037`并获得了正确的编码。**

看起来关键是找到您的系统中使用了哪个**编码字符集标识符（CCSID）**，并确保您的 jt400 实例（否则正在完善）与 as400 上的编码集 100% 匹配，以我*为例*在我有生之年和几十年的商业逻辑之前。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-02-02T18:14:32.577

我编写了一个可以轻松转换数据类型的代码。

```
public class Converter{

    public static void main(String[] args) {

        Charset charsetEBCDIC = Charset.forName("CP037");
        Charset charsetACSII = Charset.forName("US-ASCII");

        String ebcdic = "(((((((";
        System.out.println("String EBCDIC: " + ebcdic);
        System.out.println("String converted to ASCII: " + convertTO(ebcdic, charsetEBCDIC, charsetACSII));

        String ascII = "MMMMMM";
        System.out.println("String ASCII: " + ascII);
        System.out.println("String converted to EBCDIC: " + convertTO(ascII, charsetACSII, charsetEBCDIC));
    }

    public static String convertTO(String dados, Charset encondingFrom, Charset encondingTo) {
        return new String(dados.getBytes(encondingFrom), encondingTo);
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-08-24T15:16:35.540

我想补充一下 Kwebble 和 Shawn S 所说的话。我可以使用 JTOpen 来做到这一点。

我需要写入一个 6 0P 的字段（6 个字节，小数点后面没有，打包）。对于那些不了解 DDM 的人来说，这是一个小数 (11,0)。

```
 AS400PackedDecimal convertedCustId = new AS400PackedDecimal(11, 0);
    byte[] packedCust = convertedCustId.toBytes((int) custId);

    String packedCustStr = new String(packedCust, "Cp037");

    StringBuilder jcommData = new StringBuilder();
    jcommData.append(String.format("%6s", packedCustStr)); 
```

是的，我使用了 KWebble 提到的库。查看 Shawn S 提到的 DSPPFD，我发现该表使用的是 CCSID 37。这很有效。

根据 Alan Krueger 的建议，我最初尝试使用 Cp1047。它似乎奏效了。不幸的是，如果我的 custId 以 5 结尾，则呈现到文件中的数据是 B0 而不是 5F。将其更改为 Cp037 可以解决此问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-15T15:02:03.550

为 EBCDIC 字符集和 ASCII 字符集编写一个映射应该相当简单，并在每个映射中返回另一个的字符表示。然后只需遍历要翻译的字符串，并在地图中查找每个字符并将其附加到输出字符串中。

我不知道是否有任何公开的转换器，但写一个应该不会超过一个小时左右。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-01-02T05:46:39.873

这是我一直在使用的。

```
public static final int[] ebc2asc = new int[256];
public static final int[] asc2ebc = new int[256];

static
{
  byte[] values = new byte[256];
  for (int i = 0; i < 256; i++)
    values[i] = (byte) i;

  try
  {
    String s = new String (values, "CP1047");
    char[] chars = s.toCharArray ();
    for (int i = 0; i < 256; i++)
    {
      int val = chars[i];
      ebc2asc[i] = val;
      asc2ebc[val] = i;
    }
  }
  catch (UnsupportedEncodingException e)
  {
    e.printStackTrace ();
  }
} 
```

# .net - 我可以在使用 .Net WebBrowser 控件时检测错误吗？

> ID：368612
> 
> 赞同：14
> 
> 时间：2008-12-15T14:58:52.993
> 
> 标签：.net, winforms, com, webbrowser-control

我有一个 .Net Froms 应用程序，它通过 WebBrowser 控件显示网页。

无论如何我可以检测到控件是否显示“*找不到页面*”或“*无法显示网页*”错误？似乎没有任何错误事件处理程序。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-15T15:38:56.750

WebBrowser Windows 窗体控件是 Internet Explorer 的包装器，它不公开底层 ActiveX 控件的所有功能，尤其是 NavigateError 事件。这是一个解决方法：

首先将 SHDocVw.dll 的引用添加到您的项目（添加引用窗口的 COM 选项卡）。然后您可以执行以下操作来捕获错误：

```
private void button1_Click(object sender, EventArgs e)
{
    SHDocVw.WebBrowser instance = (SHDocVw.WebBrowser)webBrowser1.ActiveXInstance;
    instance.NavigateError += new SHDocVw.DWebBrowserEvents2_NavigateErrorEventHandler(instance_NavigateError);
    webBrowser1.Navigate("http://www.google.com/foo");
}

void instance_NavigateError(object pDisp, ref object URL, ref object Frame, ref object StatusCode, ref bool Cancel)
{
    // Do whatever you want with the error            
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-11-04T23:02:01.200

我找到了另一种解决此问题的方法，而无需设置对 SHDocVw dll 的引用。

请参阅MSDN 上的[Web 浏览器 CreateSink 方法](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.createsink(VS.80).aspx)。

# java - 两个 ExecutorService 可以共享一个线程池吗？

> ID：368613
> 
> 赞同：7
> 
> 时间：2008-12-15T14:59:29.140
> 
> 标签：java, concurrency, threadpool

我有一组要处理的记录，并且可以并行处理，所以我创建了一个[ExecutorService](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ExecutorService.html)（通过[Executors#newCachedThreadPool()](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/Executors.html#newCachedThreadPool())）。单个记录的处理本身是由可并行化的步骤组成的，所以我想使用另一个`ExecutorService`. 有没有一种简单的方法可以让这个新线程使用相同的底层线程池？它甚至是可取的吗？谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T15:25:09.213

回答你的问题：**不**，两个`ExecutorService`对象**不能**共享一个线程池。但是，您可以在您的对象之间共享一个`ExecutorService`，或者根据需要创建多个执行器，尽管不太推荐这样做。

`Executor`最佳解决方案：在您的对象之间共享。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T15:56:41.317

简短的回答：没有。

更长的答案：您将需要自己的实现来做到这一点。`ExecutorService`是一个接口，`AbstractExecutorService`很容易实现。如果您想要两个`ExecutorService`共享相同的线程池（例如具有不同的最大活动线程值），您可以使用代理模式来进行线程池共享`ExecutorService`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T15:17:56.857

您可以将现有 ExecutorService 的引用传递给您的工作对象吗？

```
public class Task implements Runnable {
    private final ExecutorService threadPool;
    private final SubTask[] subtasks;

    public Task(ExecutorService threadPool) {
        this.threadPool = threadPool;
        this.subtasks = createSubtasksIGuess();
    }

    public void run() {
        for(SubTask sub : subtasks)
            threadPool.submit(sub);
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-12-18T16:58:52.553

有几个很好的理由想要这样做，例如每个队列的单独边界和指标。AFAIK，Cassandra 2.1 从使用共享线程池的执行器服务实现中获得了不小的好处；代码位于[https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/concurrent/SEPExecutor.java](https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/concurrent/SEPExecutor.java)。

# oop - 持有类的对象和聚合它们有什么区别？

> ID：368618
> 
> 赞同：0
> 
> 时间：2008-12-15T15:01:18.480
> 
> 标签：oop, class, relationship

我无法区分聚合和持有之间的区别。比如说，C++ 是什么意思？
我想当 A 类的对象持有（或实例化）B 类的对象时，它使用它自己来执行一些功能。
例如：

```
class A {
 int state;
 public: 
  A(int s): state(s) {}
  int inc() { return state++; }
};
class B {
  int app;
  string s;
public:
  B(): app(0), s("") {}
  B(int A, const string& str): app(A), s(str) {}
  void f(int p);
  ~B() { app = 0; s = ""; }
};
void B::f(int p)
{
   A mA(p);
   app = mA.inc();
} 
```

A类对象的聚合是这样的：

```
class B{
 A t;
 //...
} 
```

请给我一个网站链接或书中某个地方的链接，我可以在其中找到关于 OO 语言的明确定义，类之间的每种关系到底是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T15:37:56.427

持有另一个类意味着一个类通过父子关系与另一个类关联。例如，路径有一个点列表。路径是点列表的父级，点列表是各个点的父级。

聚合意味着采用不同的类并将它们放在接口后面，以便它们显示为一个类。例如，一个 FileDialog 将有几个按钮类、一个文本输入类、一个列表视图/树视图类等等。但是对于系统的其余部分，它只有激活方法，可能分配一个默认文件名，然后检索其余部分。

它由所有其他类组成的事实对于使用它作为文件对话框的其他类来说并不重要。但是它通过聚合所有类来执行预期的行为来工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T18:13:08.843

国际海事组织，如果我理解正确，您要求的是组合与聚合的定义。聚合或控股是实体的集合。组合具有更严格的约束。想想授予学生的平均分：当我们计算平均分时，我们不能排除任何项目。组成与此类似。不能错过任何项目。另一方面，聚合的定义更为宽松。

一个有趣的类比是一个装满箭的箭袋和一辆汽车。箭袋是箭头的聚合，箭袋可以没有箭而存在；汽车是一个组合（部分的总和）。并且不要争论没有轮子的汽车仍然是汽车:)

As for references: [http://www.bletchleypark.net/algorithms/software/oop.html](http://www.bletchleypark.net/algorithms/software/oop.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T15:13:17.677

这在很大程度上与所有权和知名度有关。这些关系有不同的名称，但您应该考虑以下两点：

*   父母是否对孩子有严格的所有权，父母死了，孩子也应该死？

*   除了父母之外，其他实体是否可以看到孩子？

这些问题的答案将帮助您澄清这些关系。

# performance - 如何处理长时间运行的单元测试？

> ID：368622
> 
> 赞同：10
> 
> 时间：2008-12-15T15:02:12.723
> 
> 标签：performance, unit-testing, http, tdd, legacy

我有大约 100 个单元测试，覆盖率为 %20，我正在尝试增加覆盖率，这也是一个正在开发的项目，所以请不断添加新的测试。

目前在每次构建后运行我的测试是不可行的，它们大约需要 2 分钟。

测试包括：

*   从测试文件夹中读取的文件（模拟一些 HTTP 内容的数据驱动风格）
*   向本地网络服务器发出实际的 HTTP 请求（模拟起来非常痛苦，所以我不会）
*   并非所有这些都是单元测试，但也有相当复杂的多线程类需要测试，我确实测试了测试的整体行为。这可以被视为功能测试，但也需要每次都运行。

大多数功能需要读取 HTTP、执行 TCP 等。我无法更改它们，因为如果我更改这些测试，这就是项目的全部想法，那么测试东西将毫无意义。

此外，我认为我没有最快的工具来运行单元测试。我当前的设置使用带有 Gallio 和 nUnit 作为框架的 VS TS。我认为 VS TS + Gallio 也比其他人慢一些。

你会推荐我什么来解决这个问题？我想在 btu 的每一点变化之后运行单元测试，目前这个问题正在打断我的流程。

**进一步澄清编辑：**

代码**高度耦合！**不幸的是，改变就像一个巨大的重构过程。而且有一个鸡蛋综合症，我需要单元测试来重构这么大的代码，但是如果我不重构它，我就不能有更多的单元测试:)

高度耦合的代码不允许我将测试分成更小的块。另外我不测试私人的东西，这是个人的选择，这让我发展得更快，仍然获得了大量的好处。

而且我可以确认所有单元测试（具有适当的隔离）实际上都非常快，而且我对它们没有性能问题。

* * *

进一步澄清：

代码**高度耦合！**不幸的是，改变就像一个巨大的重构过程。而且有一个鸡蛋综合症，我需要单元测试来重构这么大的代码，但是如果我不重构它，我就不能有更多的单元测试:)

高度耦合的代码不允许我将测试分成更小的块。另外我不测试私人的东西，这是个人的选择，这让我发展得更快，仍然获得了大量的好处。

而且我可以确认所有单元测试（具有适当的隔离）实际上都非常快，而且我对它们没有性能问题。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-15T15:06:32.213

这些对我来说听起来不像单元测试，而更像是功能测试。很好，自动化功能测试很好，但是功能测试很慢是很常见的。他们正在测试整个系统（或其中的大部分）。

单元测试往往很快，因为它们测试的是与其他一切隔离的一件事。如果您不能将事物与其他所有事物隔离开来进行测试，那么您应该考虑一个警告信号，表明您的代码**耦合过于紧密**。

你能告诉你哪些测试是单元测试（仅测试 1 件事）与功能测试（同时测试 2 件或更多件事）吗？哪些快，哪些慢？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T15:07:11.760

您可以将测试分成两组，一组用于短期测试，另一组用于长期运行测试，并在每次更改后运行短期测试时降低运行长期测试的频率。除此之外，模拟来自网络服务器的响应和您的应用程序发出的其他请求会导致更短的测试运行。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-15T15:51:59.347

我会推荐一种组合方法来解决您的问题：

*   经常运行与您更改的代码接近的测试子集（例如来自相同包、模块或类似的测试）。不太频繁地运行与您当前正在处理的代码相距较远的测试。
*   将您的套件至少分成两部分：快速运行测试和慢速运行测试。更频繁地运行快速运行的测试。
*   考虑让一些不太可能失败的测试仅由自动化的持续集成服务器执行。
*   学习提高测试性能的技术。最重要的是，用更快的假货代替对慢速系统资源的访问。例如，在内存流而不是文件中使用。存根/模拟 http 访问。等等
*   了解如何使用低风险的依赖破坏技术，例如（非常强烈推荐的）“有效地使用遗留代码”一书中列出的技术。这些允许您在不应用高风险重构的情况下有效地使您的代码更具可测试性（通常通过暂时使实际设计变得更糟，例如破坏封装，直到您可以使用测试安全网重构为更好的设计）。

One of the most important things I learned from the book mentioned above: there is no magic, working with legacy code *is* pain, and always *will be* pain. All you can do is accept that fact, and do your best to slowly work your way out of the mess.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-15T15:39:47.327

首先，这些不是单元测试。

在每次小的更改之后运行这样的功能测试并没有多大意义。在进行了相当大的更改后，您将需要运行功能测试。

其次，不要害怕模拟应用程序的 Http 部分。如果您真的想对应用程序进行单元测试，那是必须的。如果您不愿意这样做，您将浪费更多时间尝试测试您的实际逻辑，等待 HTTP 请求返回并尝试设置数据。

我会保留您的集成级别测试，但会努力创建真正的单元测试。这将解决您的速度问题。真正的单元测试没有 DB 交互或 HTTP 交互。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T15:42:37.837

我总是使用“LongTest”的类别。这些测试每天晚上执行，而不是在白天执行。这样你就可以大大减少你的等待时间。试试看：分类你的单元测试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T15:43:55.603

听起来您可能还需要管理开发团队的期望。

我假设人们每天要进行几次构建，​​并且希望在每次构建之后运行测试。我们可能会很好地为您切换您的测试计划，以便在午餐时间运行带有测试的构建，然后在晚上运行另一个。

我同意 Brad 的观点，这些听起来像是功能测试。如果您可以将代码分开，那就太好了，但在那之前，我会切换到不那么频繁的测试。

# svn - 不在办公室时的源代码控制

> ID：368624
> 
> 赞同：3
> 
> 时间：2008-12-15T15:02:47.323
> 
> 标签：svn, version-control

当我不在办公室时，我有时会编码。我想在未连接到公司网络时继续使用源代码控制的好处。

我理想的系统将允许我在笔记本电脑上签入对存储库的修订，然后当我连接到公司网络时，该存储库将与我们的主 SVN 存储库同步。在与主存储库同步时，如果可以维护单独的签入和评论，那将是一件好事。

我不会总是有互联网连接，所以 VPN 不是一个很好的解决方案。

如有必要，可以更改 SVN 服务器的配置，但我不希望这样做。

有谁知道任何可以帮助我完成此任务的工具？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T15:05:27.957

这就是[GIT](http://git.or.cz/)（一种新的颠覆）的原理。Git 有本地存储库。对于 SVN，我有一个到公司的 VPN，所以我仍然可以在家中使用 SVN 服务器，也许这可以是避免更改存储库系统的解决方案（我知道你并不总是连接......但是...... . 没有任何改变，它可能是 VPN 或尝试 GIT）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T15:05:47.490

不确定标准 SVN 是否可以做到这一点。我知道这是分布式版本控制系统的设计目的（除其他外）。

您可以尝试[SVK](http://svk.bestpractical.com/view/HomePage)，它基本上是对 SVN 的去中心化修改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T15:10:05.717

任何去中心化/分布式 VCS 都可以在一定程度上做到这一点，我推荐[Mercurial](http://selenic.com/wiki/Mercurial)而不是 git，因为它的 UI 更接近 svn。我有几个我关注并使用 Mercurial 的 svn 存储库。Mercurial 还有一个用于 Windows 机器的[TortoiseHg实用程序。](http://tortoisehg.sourceforge.net/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T15:38:51.820

显而易见的答案将是 Mercurial 和 Git。

我会从左边投出一个：Perforce。虽然它不像 Mercurial 或 Git 那样真正分布，但人们确实错过了一个很棒的功能：

'协调离线工作'

它是 P4V 客户端的一部分。您甚至可以在没有互联网连接的情况下离开办公室。它不会跟踪个人的离线签到，但它可以让您跟踪发生的变化。回到办公室后，您可以轻松办理登机手续，而不会错过任何更改。

正如您提到的 SVN，您可能不是在寻找商业解决方案。但无论如何我还是忍不住推荐它。它将 SVN 从水中吹走。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-05T09:49:39.563

在我以前的公司中，svn 服务器是通过公共域提供的，但是对服务器的访问是严格的。您可以设置身份验证以在您的 svn 服务器上签出和提交，就像我推荐 git 的离线提交一样。

# python - 关于设置工具和替代品的问题

> ID：368636
> 
> 赞同：21
> 
> 时间：2008-12-15T15:06:49.093
> 
> 标签：python, packaging, setuptools, pip

我最近在互联网上看到了大量的 setuptools。最近，我阅读了 James Bennett 的关于为什么没有人应该使用 setuptools的[关于包装的帖子。](http://www.b-list.org/weblog/2008/dec/14/packaging/)从我在 Freenode 上的#python 开始，我就知道那里有一些人绝对讨厌它。我会把自己算在其中，但我确实使用它。

我已经将 setuptools 用于足够多的项目以了解它的不足之处，我更喜欢更好的东西。我不是特别喜欢 egg 格式及其部署方式。对于所有 setuptools 的问题，我还没有找到更好的选择。

我对[pip](http://pip.openplans.org/)之类的工具的理解是，它是一个 easy_install 替代品（而不是 setuptools）。事实上，pip 使用了一些 setuptools 组件，对吧？

我的大多数包都使用了 setuptools-aware setup.py，它声明了所有依赖项。当它们准备好后，我将构建一个 sdist、bdist 和 bdist_egg，并将它们上传到 pypi。

如果我想切换到使用 pip，我需要进行哪些更改才能摆脱 easy_install 依赖项？依赖项在哪里声明？我猜我需要摆脱使用 egg 格式，而只提供源代码分发。如果是这样，我如何生成 egg-info 目录？还是我什至需要？

这将如何改变我对 virtualenv 的使用？virtualenv 不使用 easy_install 来管理环境吗？

这将如何改变我对 setuptools 提供的“开发”命令的使用？我不应该使用它吗？有什么选择？

我基本上是想了解我的开发工作流程会是什么样子。

在任何人建议之前，我并不是在寻找依赖于操作系统的解决方案。我主要关心 debian linux，但 deb 包不是一个选项，原因是 Ian Bicking[在这里](http://blog.ianbicking.org/2008/12/14/a-few-corrections-to-on-packaging/)概述。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-15T23:29:35.803

pip 使用 Setuptools，并且不需要对包进行任何更改。它实际上使用 Setuptools 安装软件包，使用：

```
python -c 'import setuptools; __file__="setup.py"; execfile(__file__)' \
    install \
    --single-version-externally-managed 
```

因为它使用该选项 ( `--single-version-externally-managed`)，所以它永远不会将 egg 安装为 zip 文件，不支持同时安装的多个软件版本，并且包是平面安装的（`python setup.py install`如果你只使用 distutils 就可以工作）。Egg 元数据仍然安装。pip 也像 easy_install 一样，下载和安装包的所有要求。

*此外*，您还可以使用需求文件来添加应批量安装的其他软件包，并使版本要求更准确（无需将这些确切要求放入您的`setup.py`文件中）。但是，如果您不制作需求文件，那么您将像 easy_install 一样使用它。

对于您`install_requires`，我不建议您进行任何更改，除非您一直在尝试在那里创建非常精确的要求，这些要求已知是好的。我认为您在有关版本的文件中的有用程度是有限的`setup.py`，因为您无法真正知道新库的未来兼容性会是什么样子，我不建议您尝试预测这一点。需求文件是布置保守版本需求的替代位置。

您仍然可以使用`python setup.py develop`，事实上，如果您这样做`pip install -e svn+http://mysite/svn/Project/trunk#egg=Project`，它将检查出（进入`src/project`）并`setup.py develop`在其上运行。所以这个工作流程实际上并没有什么不同。

如果您详细运行 pip（如`pip install -vv`），您会看到很多正在运行的命令，并且您可能会识别其中的大部分。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-04-18T19:00:46.557

我在 2014 年 4 月写这篇文章。请注意任何关于 Python 打包、分发或安装的日期。看起来，在过去的三年里，派别性有所减少，实施有所改进，PEP 标准化和战线统一。

例如，[Python Packaging Authority](http://packaging.python.org/en/latest/glossary.html#term-python-packaging-authority-pypa)是“一个维护 Python 打包相关项目的工作组”。

`python.org` [Python 打包用户指南](http://packaging.python.org/en/latest/)包含[工具推荐](http://packaging.python.org/en/latest/current.html)和Python 打包的[未来](http://packaging.python.org/en/latest/future.html)部分。

`distribute`是其中的一个分支`setuptools`，于 2013 年 6 月重新合并。指南说，“`setuptools`用于定义项目和创建源分布。”

从 PEP 453 和 Python 3.4 开始，该指南建议“用于`pip`从 PyPI 安装 Python 包”，并`pip`包含在 Python 3.4 中，并通过 安装在 virtualenvs 中`pyvenv`，也包括在内。您可能会发现[PEP 453 “基本原理”部分](http://legacy.python.org/dev/peps/pep-0453/#rationale)很有趣。

指南中还提到了一些新的和新的工具，包括[`wheel`](http://packaging.python.org/en/latest/glossary.html#term-wheel)和[`buildout`](http://packaging.python.org/en/latest/projects.html#buildout).

我很高兴我阅读了以下两个技术/半政治历史。

Martijn Faassen 在 2009 年：[Python 打包的历史](http://blog.startifact.com/posts/older/a-history-of-python-packaging.html)。

并由 Armin Ronacher 于 2013 年 6 月撰写（标题并不严肃）：[Python Packaging: Hate,hate,hate无处不在](https://lucumr.pocoo.org/2012/6/22/hate-hate-hate-everywhere/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T18:24:26.417

对于初学者来说，pip 真的很新。新的，不完整的，在现实世界中很大程度上未经测试。

它显示出巨大的希望，但直到它可以完成 easy_install/setuptools 可以做的所有事情之前，它不太可能在很大程度上流行起来，当然不会在公司中流行起来。

Easy_install/setuptools 又大又复杂——这冒犯了很多人。不幸的是，这种复杂性有一个很好的理由，那就是它可以满足大量不同的用例。我自己的支持大型（> 300）桌面用户池，以及具有经常更新的应用程序的类似大小的网格。我们可以通过允许每个用户从源代码安装来做到这一点的想法是可笑的——eggs 已经证明它们是分发我的项目的可靠方式。

我的建议：学习使用 setuptools - 这真的是一件很棒的事情。大多数讨厌它的人不理解它，或者根本没有作为全功能分发系统的用例。

:-)

# .net - 过程需要未提供的参数

> ID：368642
> 
> 赞同：117
> 
> 时间：2008-12-15T15:07:54.457
> 
> 标签：.net, sql-server, stored-procedures

访问 SQL Server 中的存储过程时出现错误

```
Server Error in '/' Application.
Procedure or function 'ColumnSeek' expects parameter '@template', which was not supplied. 
```

当我通过.net 到 sql 的数据连接调用带有参数的存储过程时，就会发生这种情况`(System.data.SqlClient)`，即使我提供了参数。这是我的代码。

```
SqlConnection sqlConn = new SqlConnection(connPath);
sqlConn.Open();

//METADATA RETRIEVAL
string sqlCommString = "QCApp.dbo.ColumnSeek";
SqlCommand metaDataComm = new SqlCommand(sqlCommString, sqlConn);
metaDataComm.CommandType = CommandType.StoredProcedure;
SqlParameter sp = metaDataComm.Parameters.Add("@template",SqlDbType.VarChar,50);
sp.Value = Template;

SqlDataReader metadr = metaDataComm.ExecuteReader(); 
```

我的存储过程是：

```
 USE [QCApp]
   GO
   SET ANSI_NULLS ON
   GO
   SET QUOTED_IDENTIFIER ON
   GO

   ALTER PROCEDURE [dbo].[ColumnSeek] 
       @template varchar(50)
   AS
   EXEC('SELECT Column_Name, Data_Type 
   FROM [QCApp].[INFORMATION_SCHEMA].[COLUMNS] 
   WHERE TABLE_NAME = ' + @template); 
```

我试图弄清楚我在这里做错了什么。

**编辑：**事实证明，模板为空，因为我从通过 URL 传递的参数中获取它的值，并且我搞砸了 url 参数传递（我使用的是`@`for 而不是`&`）

* * *

## 回答 #1

> 赞同：324
> 
> 时间：2010-05-04T15:15:05.417

除了这里的其他答案，如果您忘记输入：

```
cmd.CommandType = CommandType.StoredProcedure; 
```

然后你也会得到这个错误。

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2008-12-15T15:20:57.987

我会检查我的应用程序代码并查看您将 @template 设置为什么值。我怀疑它是空的，这就是问题所在。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2011-07-07T03:19:57.477

这个问题确实通常是由上面提到的**HLGEM**将参数值设置为 null 引起的。我想我会详细说明这个问题的一些解决方案，我发现这些解决方案对这个问题的新手很有用。

我更喜欢的解决方案是将存储过程参数默认为 NULL（或您想要的任何值），上面**sangram**提到了这一点，但可能会因为答案非常冗长而被遗漏。类似于以下内容：

```
CREATE PROCEDURE GetEmployeeDetails
    @DateOfBirth    DATETIME = NULL,
    @Surname        VARCHAR(20),
    @GenderCode     INT = NULL,
AS 
```

这意味着如果参数在某些情况下最终在代码中设置为 null，.NET 将不会设置该参数，并且存储过程将使用它定义的默认值。如果您真的想在代码中解决问题，另一种解决方案是使用为您处理问题的扩展方法，例如：

```
public static SqlParameter AddParameter<T>(this SqlParameterCollection parameters, string parameterName, T value) where T : class
{
    return value == null ? parameters.AddWithValue(parameterName, DBNull.Value) : parameters.AddWithValue(parameterName, value);
} 
```

[Matt Hamilton在这里](http://madprops.org/blog/addwithvalue-via-extension-methods/)有一篇很好的文章，列出了在处理这个领域时一些更出色的扩展方法。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-08-30T13:13:24.870

当我将 0 提供给整数参数时，我遇到了一个问题。并发现：

```
cmd.Parameters.AddWithValue("@Status", 0); 
```

有效，但这不会：

```
cmd.Parameters.Add(new SqlParameter("@Status", 0)); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2012-11-28T19:11:53.810

对于我的情况，我必须从代​​码中传递`DBNULL.Value`（使用 if else 条件）未定义`null`但值为 `null`.

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-11-22T08:40:11.063

我在调用存储过程时遇到了类似的问题

```
CREATE PROCEDURE UserPreference_Search
    @UserPreferencesId int,
    @SpecialOfferMails char(1),
    @NewsLetters char(1),
    @UserLoginId int,
    @Currency varchar(50)
AS
DECLARE @QueryString nvarchar(4000)

SET @QueryString = 'SELECT UserPreferencesId,SpecialOfferMails,NewsLetters,UserLoginId,Currency FROM UserPreference'
IF(@UserPreferencesId IS NOT NULL)
BEGIN
SET @QueryString = @QueryString + ' WHERE UserPreferencesId = @DummyUserPreferencesId';
END

IF(@SpecialOfferMails IS NOT NULL)
BEGIN
SET @QueryString = @QueryString + ' WHERE SpecialOfferMails = @DummySpecialOfferMails';
END

IF(@NewsLetters IS NOT NULL)
BEGIN
SET @QueryString = @QueryString + ' WHERE NewsLetters = @DummyNewsLetters';
END

IF(@UserLoginId IS NOT NULL)
BEGIN
SET @QueryString = @QueryString + ' WHERE UserLoginId = @DummyUserLoginId';
END

IF(@Currency IS NOT NULL)
BEGIN
SET @QueryString = @QueryString + ' WHERE Currency = @DummyCurrency';
END

EXECUTE SP_EXECUTESQL @QueryString
                     ,N'@DummyUserPreferencesId int, @DummySpecialOfferMails char(1), @DummyNewsLetters char(1), @DummyUserLoginId int, @DummyCurrency varchar(50)'
                     ,@DummyUserPreferencesId=@UserPreferencesId
                     ,@DummySpecialOfferMails=@SpecialOfferMails
                     ,@DummyNewsLetters=@NewsLetters
                     ,@DummyUserLoginId=@UserLoginId
                     ,@DummyCurrency=@Currency; 
```

通过以下方式动态构建我在上面调用的搜索查询：

```
public DataSet Search(int? AccessRightId, int? RoleId, int? ModuleId, char? CanAdd, char? CanEdit, char? CanDelete, DateTime? CreatedDatetime, DateTime? LastAccessDatetime, char? Deleted)
    {
        dbManager.ConnectionString = ConfigurationManager.ConnectionStrings["MSSQL"].ToString();
        DataSet ds = new DataSet();
        try
        {
            dbManager.Open();
            dbManager.CreateParameters(9);
            dbManager.AddParameters(0, "@AccessRightId", AccessRightId, ParameterDirection.Input);
            dbManager.AddParameters(1, "@RoleId", RoleId, ParameterDirection.Input);
            dbManager.AddParameters(2, "@ModuleId", ModuleId, ParameterDirection.Input);
            dbManager.AddParameters(3, "@CanAdd", CanAdd, ParameterDirection.Input);
            dbManager.AddParameters(4, "@CanEdit", CanEdit, ParameterDirection.Input);
            dbManager.AddParameters(5, "@CanDelete", CanDelete, ParameterDirection.Input);
            dbManager.AddParameters(6, "@CreatedDatetime", CreatedDatetime, ParameterDirection.Input);
            dbManager.AddParameters(7, "@LastAccessDatetime", LastAccessDatetime, ParameterDirection.Input);
            dbManager.AddParameters(8, "@Deleted", Deleted, ParameterDirection.Input);
            ds = dbManager.ExecuteDataSet(CommandType.StoredProcedure, "AccessRight_Search");
            return ds;
        }
        catch (Exception ex)
        {
        }
        finally
        {
            dbManager.Dispose();
        }
        return ds;
    } 
```

然后经过大量挠头后，我将存储过程修改为：

```
ALTER PROCEDURE [dbo].[AccessRight_Search]
    @AccessRightId int=null,
    @RoleId int=null,
    @ModuleId int=null,
    @CanAdd char(1)=null,
    @CanEdit char(1)=null,
    @CanDelete char(1)=null,
    @CreatedDatetime datetime=null,
    @LastAccessDatetime datetime=null,
    @Deleted char(1)=null
AS
DECLARE @QueryString nvarchar(4000)
DECLARE @HasWhere bit
SET @HasWhere=0

SET @QueryString = 'SELECT a.AccessRightId, a.RoleId,a.ModuleId, a.CanAdd, a.CanEdit, a.CanDelete, a.CreatedDatetime, a.LastAccessDatetime, a.Deleted, b.RoleName, c.ModuleName FROM AccessRight a, Role b, Module c WHERE a.RoleId = b.RoleId AND a.ModuleId = c.ModuleId'

SET @HasWhere=1;

IF(@AccessRightId IS NOT NULL)
    BEGIN
        IF(@HasWhere=0) 
            BEGIN
                SET @QueryString = @QueryString + ' WHERE a.AccessRightId = @DummyAccessRightId';
                SET @HasWhere=1;
            END
        ELSE                SET @QueryString = @QueryString + ' AND a.AccessRightId = @DummyAccessRightId';
    END

IF(@RoleId IS NOT NULL)
    BEGIN
        IF(@HasWhere=0)
            BEGIN   
                SET @QueryString = @QueryString + ' WHERE a.RoleId = @DummyRoleId';
                SET @HasWhere=1;
            END
        ELSE            SET @QueryString = @QueryString + ' AND a.RoleId = @DummyRoleId';
    END

IF(@ModuleId IS NOT NULL)
BEGIN
    IF(@HasWhere=0) 
            BEGIN   
                SET @QueryString = @QueryString + ' WHERE a.ModuleId = @DummyModuleId';
                SET @HasWhere=1;
            END
    ELSE SET @QueryString = @QueryString + ' AND a.ModuleId = @DummyModuleId';
END

IF(@CanAdd IS NOT NULL)
BEGIN
    IF(@HasWhere=0) 
            BEGIN       
                SET @QueryString = @QueryString + ' WHERE a.CanAdd = @DummyCanAdd';
                SET @HasWhere=1;
            END
    ELSE SET @QueryString = @QueryString + ' AND a.CanAdd = @DummyCanAdd';
END

IF(@CanEdit IS NOT NULL)
BEGIN
    IF(@HasWhere=0) 
        BEGIN
            SET @QueryString = @QueryString + ' WHERE a.CanEdit = @DummyCanEdit';
            SET @HasWhere=1;
        END
    ELSE SET @QueryString = @QueryString + ' AND a.CanEdit = @DummyCanEdit';
END

IF(@CanDelete IS NOT NULL)
BEGIN
    IF(@HasWhere=0) 
        BEGIN
            SET @QueryString = @QueryString + ' WHERE a.CanDelete = @DummyCanDelete';
            SET @HasWhere=1;
        END
    ELSE SET @QueryString = @QueryString + ' AND a.CanDelete = @DummyCanDelete';
END

IF(@CreatedDatetime IS NOT NULL)
BEGIN
    IF(@HasWhere=0) 
    BEGIN
        SET @QueryString = @QueryString + ' WHERE a.CreatedDatetime = @DummyCreatedDatetime';
        SET @HasWhere=1;
    END
    ELSE SET @QueryString = @QueryString + ' AND a.CreatedDatetime = @DummyCreatedDatetime';
END

IF(@LastAccessDatetime IS NOT NULL)
BEGIN
    IF(@HasWhere=0) 
        BEGIN
            SET @QueryString = @QueryString + ' WHERE a.LastAccessDatetime = @DummyLastAccessDatetime';
            SET @HasWhere=1;
        END
    ELSE SET @QueryString = @QueryString + ' AND a.LastAccessDatetime = @DummyLastAccessDatetime';
END

IF(@Deleted IS NOT NULL)
BEGIN
  IF(@HasWhere=0)   
    BEGIN
        SET @QueryString = @QueryString + ' WHERE a.Deleted = @DummyDeleted';
        SET @HasWhere=1;
    END
  ELSE SET @QueryString = @QueryString + ' AND a.Deleted = @DummyDeleted';
END

PRINT @QueryString

EXECUTE SP_EXECUTESQL @QueryString
                      ,N'@DummyAccessRightId int, @DummyRoleId int, @DummyModuleId int, @DummyCanAdd char(1), @DummyCanEdit char(1), @DummyCanDelete char(1), @DummyCreatedDatetime datetime, @DummyLastAccessDatetime datetime, @DummyDeleted char(1)'
                      ,@DummyAccessRightId=@AccessRightId
                      ,@DummyRoleId=@RoleId
                      ,@DummyModuleId=@ModuleId
                      ,@DummyCanAdd=@CanAdd
                      ,@DummyCanEdit=@CanEdit
                      ,@DummyCanDelete=@CanDelete
                      ,@DummyCreatedDatetime=@CreatedDatetime
                      ,@DummyLastAccessDatetime=@LastAccessDatetime
                      ,@DummyDeleted=@Deleted; 
```

在这里，我将存储过程的输入参数初始化为 null，如下所示

```
 @AccessRightId int=null,
@RoleId int=null,
@ModuleId int=null,
@CanAdd char(1)=null,
@CanEdit char(1)=null,
@CanDelete char(1)=null,
@CreatedDatetime datetime=null,
@LastAccessDatetime datetime=null,
@Deleted char(1)=null 
```

这对我有用。

我希望这对陷入类似陷阱的人有所帮助。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-15T15:22:44.367

如果没有设置 Template（即 ==null），也会引发此错误。

更多评论：

如果在添加参数的时候就知道参数值，也可以使用AddWithValue

EXEC 不是必需的。您可以直接在 SELECT 中引用 @template 参数。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2021-06-29T11:07:43.767

以防万一有人遇到，谷歌搜索。如果尽管定义了默认参数值（这应该允许您在不显式传递该参数的情况下运行该过程）仍然出现此错误，请仔细检查您是否确实设置了默认值，如下所示：

```
@someTextParameter NVARCHAR(100) NULL 
```

只让参数接受`NULL`作为输入，而这：

```
@someTextParameter NVARCHAR(100) = NULL 
```

实际上是声明参数可选。

这是一个愚蠢的错误，忽略了这花了我半个小时；）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-09-10T17:18:11.067

我遇到了同样的问题。我的参数是空值。所以我通过处理空值来解决。如果有人不确定运行时值并想要处理 null ，那么只需使用它。（而且您不想更改 SP/功能。）例如

```
sp.Value = Template ?? (object)DBNull.Value; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-15T15:12:47.630

首先 - 为什么那是 EXEC？那不应该只是

```
AS
SELECT Column_Name, ...
FROM ...
WHERE TABLE_NAME = @template 
```

现在的SP没有意义？特别是，这将寻找与@template 匹配的**列**，而不是@template 的varchar 值。即如果@template 是`'Column_Name'`，它会搜索`WHERE TABLE_NAME = Column_Name`，这是非常罕见的（表和列的名称相同）。

此外，如果您*必须*使用动态 SQL，则应使用`EXEC sp_ExecuteSQL`（将值保留为参数）以防止注入攻击（而不是输入连接）。但在这种情况下没有必要。

重新解决实际问题 - 乍一看还可以；你确定你没有其他的 SP 副本吗？这是一个常见的错误...

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-05-26T23:33:02.780

我遇到了同样的问题，要解决它，只需将与存储过程中完全相同的参数名称添加到参数集合中即可。

例子

假设您创建了一个存储过程：

```
create procedure up_select_employe_by_ID 
     (@ID int) 
as
    select * 
    from employe_t 
    where employeID = @ID 
```

因此，请确保完全按照存储过程中的名称命名您的参数，这将是

```
cmd.parameter.add("@ID", sqltype,size).value = @ID 
```

如果你走的话

```
cmd.parameter.add("@employeID", sqltype,size).value = @employeid 
```

然后发生错误。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-11-13T17:23:31.730

我今天在将空值传递给我的存储过程的参数时遇到了这个错误。我可以通过添加默认值 = null 来更改存储过程来轻松修复。

# fonts - 是否有任何完整、免费的键盘 TrueType 字体？

> ID：368647
> 
> 赞同：3
> 
> 时间：2008-12-15T15:09:04.457
> 
> 标签：fonts

我需要一种在键盘上显示字母和功能键的字体，这样我就可以在键盘上将 Ctrl+Alt+S 显示为 3 个单独的键，而不是文本。

我看过两个，其中一个有很多丢失的键（除其他外，Win 键），另一个花费超过 100 美元。

有什么好主意吗？

哦，这需要是一个 truetype 字体，适用于 Windows，并且可以在 .NET 中使用（所以显然没有纯位图字体）

* * *

**编辑**：上述意义上的“免费”意味着我可以用我的程序自由分发字体文件。当我在中输入问题时，我也希望可以免费下载，但我会接受便宜的，因为我总是可以在其他项目中使用该字体来记录文档。因此，如果有人知道一些便宜的非免费、非版税、完整的键盘字体，我也会接受。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T15:20:23.997

这看起来符合您的要求： [http ://www.webpagepublicity.com/free-fonts/k/Keycaps%20Regular.ttf](http://www.webpagepublicity.com/free-fonts/k/Keycaps%20Regular.ttf)

我更喜欢在页面中显示字体的网站，这样我可以直接看到它们，因为我几乎不知道任何字体的名称。到那时，这个网站就像我喜欢的那样[http://www.webpagepublicity.com](http://www.webpagepublicity.com)

* * *

编辑：在使用此链接之前，请阅读评论。有人指出，该字体不是免费的，并且该站点有许多字体可供下载，不得重新分发。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-09T04:07:44.477

对于 Windows 键（包括 Windows 标志和右键单击菜单键），从 larabiefonts 获取 Betsy Flanagan 和 Betsy Flanagan Two，免费供网站使用。

对于 Mac 键（包括 Clover、Cmd、Opt、灯和数字小键盘键），使用 MacKeyCaps，但它确实有版权。有几个网站可供下载，但尚未找到检查许可的实际来源。

我有一个页面显示我尝试过的键帽字体，使用映射和 CSS 来下载和显示字符，因此键上的文本与网页上的文本大小大致相同，位于[http://www.lernerconsult.com/keycaps.php](http://www.lernerconsult.com/keycaps.php)

我有如何使用可下载的 TrueType/OpenType 字体，如果您的用户的浏览器不支持可下载字体，则通过 CSS 自动替换字体，以及如何使字体看起来相同大小，即使 x、a、c 等字母的高度不同在我的字体大小调整页面上，以相同的点大小，从键帽页面链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-02T00:04:12.693

见[http://mindprod.com/project/keyboardillustrator.html](http://mindprod.com/project/keyboardillustrator.html)

它具有指向键帽字体的各种来源的链接。

# winapi - 通过win32检测多个登录用户

> ID：368651
> 
> 赞同：2
> 
> 时间：2008-12-15T15:10:41.567
> 
> 标签：winapi

使用标准的 win32 api，检测多个用户登录的最佳方法是什么？我有一个升级到我们的软件产品，当多个用户登录时无法运行。（我知道这是应该避免的，因为它的烦恼因素，但产品非常复杂。你必须当我说真的没有其他解决方案时，请相信我。）谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T16:05:46.277

为了让多个用户同时登录，必须启用终端服务或快速用户切换。由于快速用户切换是使用终端服务实现的，因此您首先需要确定操作系统是否启用了它。您可以将[GetVersionEx](http://msdn.microsoft.com/en-us/library/ms724451.aspx)与[OSVERSIONINFOEX](http://msdn.microsoft.com/en-us/library/ms724833.aspx)一起使用。检查 VER_SUITE_SINGLEUSERTS 和 VER_SUITE_TERMINAL 标志。

如果启用了 TS，您可以使用[WTSEnumerateSessions](http://msdn.microsoft.com/en-us/library/aa383833.aspx)找出有多少用户登录。这仅在“终端服务”服务启动时有效。

如果机器不支持终端服务（或者服务没有启动），那么您只能让一个用户登录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T16:33:45.923

这是一个适用于 XP、Server 2003、Vista 和 Server 2008 的解决方案。注意，这不适用于 Windows 2000，因为“ [LsaEnumerateLogonSessions](http://msdn.microsoft.com/en-us/library/aa378275(VS.85).aspx) ”在 Windows 2000 上不可用。此代码是从[Delphi-PRAXIS 帖子](http://www.delphipraxis.net/topic108302.html)中修改的。

要编译它，请在表单上创建一个带有 TButton 和 TMemo 的新 VCL 应用程序。然后复制并粘贴此代码，它应该可以编译。我在 XP 和 Vista 上测试过，效果很好。它将返回交互式和远程用户。

```
unit main;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls;

const
  WTS_CURRENT_SERVER_HANDLE = 0;

type
  PTOKEN_USER = ^TOKEN_USER;
  _TOKEN_USER = record
    User: TSidAndAttributes;
  end;
  TOKEN_USER = _TOKEN_USER;

  USHORT = word;

  _LSA_UNICODE_STRING = record
    Length: USHORT;
    MaximumLength: USHORT;
    Buffer: LPWSTR;
  end;
  LSA_UNICODE_STRING = _LSA_UNICODE_STRING;

  PLuid = ^LUID;
  _LUID = record
    LowPart: DWORD;
    HighPart: LongInt;
  end;
  LUID = _LUID;

  _SECURITY_LOGON_TYPE = (
    seltFiller0, seltFiller1,
    Interactive,
    Network,
    Batch,
    Service,
    Proxy,
    Unlock,
    NetworkCleartext,
    NewCredentials,
    RemoteInteractive,
    CachedInteractive,
    CachedRemoteInteractive);
  SECURITY_LOGON_TYPE = _SECURITY_LOGON_TYPE;

  PSECURITY_LOGON_SESSION_DATA = ^SECURITY_LOGON_SESSION_DATA;
  _SECURITY_LOGON_SESSION_DATA = record
    Size: ULONG;
    LogonId: LUID;
    UserName: LSA_UNICODE_STRING;
    LogonDomain: LSA_UNICODE_STRING;
    AuthenticationPackage: LSA_UNICODE_STRING;
    LogonType: SECURITY_LOGON_TYPE;
    Session: ULONG;
    Sid: PSID;
    LogonTime: LARGE_INTEGER;
    LogonServer: LSA_UNICODE_STRING;
    DnsDomainName: LSA_UNICODE_STRING;
    Upn: LSA_UNICODE_STRING;
  end;
  SECURITY_LOGON_SESSION_DATA = _SECURITY_LOGON_SESSION_DATA;

  _WTS_INFO_CLASS = (
    WTSInitialProgram,
    WTSApplicationName,
    WTSWorkingDirectory,
    WTSOEMId,
    WTSSessionId,
    WTSUserName,
    WTSWinStationName,
    WTSDomainName,
    WTSConnectState,
    WTSClientBuildNumber,
    WTSClientName,
    WTSClientDirectory,
    WTSClientProductId,
    WTSClientHardwareId,
    WTSClientAddress,
    WTSClientDisplay,
    WTSClientProtocolType);
  WTS_INFO_CLASS = _WTS_INFO_CLASS;

  _WTS_CONNECTSTATE_CLASS = (
    WTSActive,              // User logged on to WinStation
    WTSConnected,           // WinStation connected to client
    WTSConnectQuery,        // In the process of connecting to client
    WTSShadow,              // Shadowing another WinStation
    WTSDisconnected,        // WinStation logged on without client
    WTSIdle,                // Waiting for client to connect
    WTSListen,              // WinStation is listening for connection
    WTSReset,               // WinStation is being reset
    WTSDown,                // WinStation is down due to error
    WTSInit);               // WinStation in initialization
  WTS_CONNECTSTATE_CLASS = _WTS_CONNECTSTATE_CLASS;

  function LsaFreeReturnBuffer(Buffer: pointer): Integer; stdcall;

  function WTSGetActiveConsoleSessionId: DWORD; external 'Kernel32.dll';

  function LsaGetLogonSessionData(LogonId: PLUID;
     var ppLogonSessionData: PSECURITY_LOGON_SESSION_DATA): LongInt; stdcall;
     external 'Secur32.dll';

  function LsaNtStatusToWinError(Status: cardinal): ULONG; stdcall;
     external 'Advapi32.dll';

  function LsaEnumerateLogonSessions(Count: PULONG; List: PLUID): LongInt;
     stdcall; external 'Secur32.dll';

  function WTSQuerySessionInformationA(hServer: THandle; SessionId: DWORD;
     WTSInfoClass: WTS_INFO_CLASS; var pBuffer: Pointer;
     var pBytesReturned: DWORD): BOOL; stdcall; external 'Wtsapi32.dll';

type
  TForm1 = class(TForm)
    Button1: TButton;
    Memo1: TMemo;
    procedure Button1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

function LsaFreeReturnBuffer; external 'secur32.dll' name 'LsaFreeReturnBuffer';

procedure GetActiveUserNames(var slUserList : TStringList);
var
   Count: cardinal;
   List: PLUID;
   sessionData: PSECURITY_LOGON_SESSION_DATA;
   i1: integer;
   SizeNeeded, SizeNeeded2: DWORD;
   OwnerName, DomainName: PChar;
   OwnerType: SID_NAME_USE;
   pBuffer: Pointer;
   pBytesreturned: DWord;
   sUser : string;
begin
   //result:= '';
   //Listing LogOnSessions
   i1:= lsaNtStatusToWinError(LsaEnumerateLogonSessions(@Count, @List));
   try
      if i1 = 0 then
      begin
          i1:= -1;
          if Count > 0 then
          begin
              repeat
                inc(i1);
                LsaGetLogonSessionData(List, sessionData);
                //Checks if it is an interactive session
                sUser := sessionData.UserName.Buffer;
                if (sessionData.LogonType = Interactive)
                  or (sessionData.LogonType = RemoteInteractive)
                  or (sessionData.LogonType = CachedInteractive)
                  or (sessionData.LogonType = CachedRemoteInteractive) then
                begin
                    //
                    SizeNeeded := MAX_PATH;
                    SizeNeeded2:= MAX_PATH;
                    GetMem(OwnerName, MAX_PATH);
                    GetMem(DomainName, MAX_PATH);
                    try
                    if LookupAccountSID(nil, sessionData.SID, OwnerName,
                                       SizeNeeded, DomainName,SizeNeeded2,
                                       OwnerType) then
                    begin
                      if OwnerType = 1 then  //This is a USER account SID (SidTypeUser=1)
                      begin
                        sUser := AnsiUpperCase(sessionData.LogonDomain.Buffer);
                        sUser := sUser + '\';
                        sUser := sUser + AnsiUpperCase(sessionData.UserName.Buffer);
                        slUserList.Add(sUser);
//                          if sessionData.Session = WTSGetActiveConsoleSessionId then
//                          begin
//                            //Wenn Benutzer aktiv
//                            try
//                                if WTSQuerySessionInformationA
//                                   (WTS_CURRENT_SERVER_HANDLE,
//                                    sessionData.Session, WTSConnectState,
//                                    pBuffer,
//                                    pBytesreturned) then
//                                begin
//                                    if WTS_CONNECTSTATE_CLASS(pBuffer^) = WTSActive then
//                                    begin
//                                      //result:= sessionData.UserName.Buffer;
//                                      slUserList.Add(sessionData.UserName.Buffer);
//                                    end;
//                                end;
//                            finally
//                              LSAFreeReturnBuffer(pBuffer);
//                            end;
                          //end;
                      end;
                    end;
                    finally
                    FreeMem(OwnerName);
                    FreeMem(DomainName);
                    end;
                end;
                inc(List);
                try
                    LSAFreeReturnBuffer(sessionData);
                except
                end;
            until (i1 = Count-1);// or (result <> '');
          end;
      end;
   finally
      LSAFreeReturnBuffer(List);
   end;
end;

procedure TForm1.Button1Click(Sender: TObject);
var
  slUsers : TStringList;
begin
  slUsers := TStringList.Create;
  slUsers.Duplicates := dupIgnore;
  slUsers.Sorted := True;

  try
    GetActiveUserNames(slUsers);
    Memo1.Lines.AddStrings(slUsers);
  finally
    FreeAndNil(slUsers)
  end;
end;

end. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T16:06:41.423

这可能是一种迂回的方式，但运行进程列表并查看进程所有者是谁。

# ruby - 除非用 \ 转义，否则 Ruby 正则表达式匹配

> ID：368652
> 
> 赞同：3
> 
> 时间：2008-12-15T15:10:46.963
> 
> 标签：ruby, regex, lookbehind

使用 Ruby 我正在尝试使用正则表达式拆分以下文本

```
~foo\~\=bar =cheese~monkey 
```

其中 ~ 或 = 表示匹配的开始，除非它用 \ 转义

所以它应该匹配

```
~foo\~\=bar 
```

然后

```
=cheese 
```

然后

```
~monkey 
```

我认为以下内容会起作用，但事实并非如此。

```
([~=]([^~=]|\\=|\\~)+)(.*) 
```

什么是更好的正则表达式？

**编辑**更具体地说，上面的正则表达式匹配所有出现的 = 和 ~

**编辑**工作解决方案。这是我想出的解决问题的方法。我发现 Ruby 1.8 具有前瞻功能，但没有后瞻功能。所以看了一圈之后，我在 comp.lang.ruby 中看到了[这篇文章，并用以下内容完成了它：](http://groups.google.com/group/comp.lang.ruby/browse_thread/thread/2d510e6db73d1598)

```
# Iterates through the answer clauses
def split_apart clauses
  reg = Regexp.new('.*?(?:[~=])(?!\\\\)', Regexp::MULTILINE)

  # need to use reverse since Ruby 1.8 has look ahead, but not look behind
  matches =  clauses.reverse.scan(reg).reverse.map {|clause| clause.strip.reverse}

  matches.each do |match|
    yield match
  end
end 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T15:30:38.687

在这种情况下，“去掉头”是什么意思？

如果您想删除某个字符之前的所有内容，可以这样做：

```
.*?(?<!\\)=      // anything up to the first "=" that is not preceded by "\"
.*?(?<!\\)~      // same, but for the squiggly "~"
.*?(?<!\\)(?=~)  // same, but excluding the separator itself (if you need that) 
```

替换为“”，重复，完成。

如果您的字符串恰好包含三个元素 ( `"1=2~3"`) 并且您想一次匹配所有这些元素，您可以使用：

```
^(.*?(?<!\\)(?:=))(.*?(?<!\\)(?:~))(.*)$

matches:  \~foo\~\=bar =cheese~monkey
         |      1      |   2  |  3   | 
```

或者，您使用此正则表达式拆分字符串：

```
(?<!\\)[=~]

returns: ['\~foo\~\=bar ', 'cheese', 'monkey']   for "\~foo\~\=bar =cheese~monkey"
returns: ['', 'foo\~\=bar ', 'cheese', 'monkey'] for "~foo\~\=bar =cheese~monkey" 
```

# jsp - 如何在浏览器选项卡中区分会话？

> ID：368653
> 
> 赞同：137
> 
> 时间：2008-12-15T15:10:58.477
> 
> 标签：jsp, servlets, browser, web-applications, sessionid

在使用 JSP 和 Servlet 以 java 实现的 Web 应用程序中；如果我将信息存储在用户会话中，则此信息会从同一浏览器的所有选项卡中共享。如何在浏览器选项卡中区分会话？在这个例子中：

```
<%@page language="java"%>
<%
String user = request.getParameter("user");
user = (user == null ? (String)session.getAttribute("SESSIONS_USER") : user);
session.setAttribute("SESSIONS_USER",user);
%>
<html><head></head><body>
<%=user %>
<form method="post">
User:<input name="user" value="">
<input type="submit" value="send">
</form>
</body></html> 
```

将此代码复制到 jsp 页面`testpage.jsp`（`localhost/context1/testpage.jsp`输入您的姓名并提交表格。然后在同一浏览器中打开一个新选项卡，然后您可以在新选项卡上看到您的姓名（从会话中获取）。小心浏览器缓存，有时似乎没有发生，但它在缓存中，刷新第二个选项卡。

谢谢。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2012-08-02T18:39:35.937

您可以使用 HTML5 SessionStorage (window.sessionStorage)。您将生成一个随机 id 并保存在每个浏览器选项卡的会话存储中。然后每个浏览器选项卡都有自己的 ID。

> 使用 sessionStorage 存储的数据不会跨浏览器选项卡保留，即使两个选项卡都包含来自同一域来源的网页。换句话说，sessionStorage 中的数据不仅限于调用页面的域和目录，还包括页面所在的浏览器选项卡。与会话 cookie 相比，会话 cookie 会在选项卡之间保存数据。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-15T15:40:57.590

您必须意识到服务器端会话是 HTTP 的人工附加组件。由于 HTTP 是无状态的，因此服务器需要以某种方式识别请求属于它所知道的特定用户并为其建立会话。有两种方法可以做到这一点：

*   饼干。更清洁和更流行的方法，但这意味着一个用户的所有浏览器选项卡和窗口共享会话 - IMO 这实际上是可取的，我会对一个让我为每个新选项卡登录的网站感到非常恼火，因为我非常密集地使用标签
*   网址重写。站点上的任何 URL 都附加了一个会话 ID。这是更多的工作（您必须在有站点内部链接的任何地方做一些事情），但是可以在不同的选项卡中拥有单独的会话，尽管通过链接打开的选项卡仍将共享会话。这也意味着用户在访问您的网站时始终必须登录。

你到底想做什么？为什么你希望标签有单独的会话？也许有一种方法可以在不使用会话的情况下实现您的目标？

**编辑：** 为了测试，可以找到其他解决方案（例如在不同的虚拟机上运行多个浏览器实例）。如果一个用户需要同时扮演不同的角色，那么应该在应用程序中处理“角色”的概念，以便一个登录可以具有多个角色。您必须决定是使用 URL 重写还是仅仅接受当前情况更容易接受，因为根本不可能使用基于 cookie 的会话单独处理浏览器选项卡。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2011-06-20T20:51:30.573

window.name Javascript 属性是唯一会在选项卡活动中持续存在的东西，但可以保持独立（而不是 URL 胡言乱语）。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-12-15T15:35:51.983

**你不应该。**如果您想做这样的事情，您需要通过动态编写 URL 来强制用户使用应用程序的单个实例，使用类似的 sessionID（不是 sessionid 它不会工作）id 并将其传递到每个 URL 中。

我不知道你为什么需要它，但除非你需要制作一个完全无法使用的应用程序，否则不要这样做。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-07-15T20:53:51.033

我想出了一个新的解决方案，它有一点点开销，但到目前为止似乎是一个原型。一个假设是您在登录的荣誉系统环境中，尽管这可以通过在切换选项卡时重新请求密码来进行调整。

使用 localStorage（或等效）和 HTML5 存储事件来检测新浏览器选项卡何时切换了哪个用户处于活动状态。发生这种情况时，创建一个幽灵叠加层，其中包含一条消息，说明您不能使用当前窗口（或者暂时禁用窗口，您可能不希望它如此显眼。）当窗口重新获得焦点时，发送 AJAX 请求日志记录用户返回。

这种方法的一个警告：您不能在没有焦点的窗口中进行任何正常的 AJAX 调用（即依赖于您的会话的调用）（例如，如果您在延迟后发生了调用），除非您在此之前手动进行 AJAX 重新登录调用。所以你真正需要做的就是首先检查你的 AJAX 函数以确保 localStorage.currently_logged_in_user_id === window.yourAppNameSpace.user_id，如果没有，首先通过 AJAX 登录。

另一个是竞争条件：如果你可以足够快地切换窗口来混淆它，你最终可能会出现 relogin1->relogin2->ajax1->ajax2 序列，而 ajax1 是在错误的会话下创建的。通过将登录 AJAX 请求推送到数组中来解决此问题，然后在存储上并在发出新的登录请求之前中止所有当前请求。

最后要注意的问题是窗口刷新。如果有人在您激活 AJAX 登录请求但未完成时刷新窗口，它将以错误人的名义刷新。在这种情况下，您可以使用非标准的 beforeunload 事件来警告用户潜在的混淆并要求他们单击取消，同时重新发出 AJAX 登录请求。然后，他们可以搞砸的唯一方法是在请求完成之前单击“确定”（或不小心按回车键/空格键，因为“确定”是——不幸的是，对于这种情况——默认值。）还有其他处理这种情况的方法，比如检测 F5 和 Ctrl+R/Alt+R 按下，这在大多数情况下都有效，但可能会因用户键盘快捷键重新配置或替代操作系统使用而受阻。然而，这在现实中有点极端，最坏的情况永远不会那么糟糕：在荣誉系统配置中，您会以错误的人身份登录（但您可以通过使用颜色、样式、突出显示的名称来个性化页面来明确这种情况， ETC。）; 在密码配置中，责任在于最后一个输入密码以注销或共享会话的人，或者如果此人实际上是当前用户，则没有违规行为。

但最终，您将拥有一个每个选项卡一个用户的应用程序，该应用程序（希望）只是按应有的方式运行，而不必设置配置文件、使用 IE 或重写 URL。确保在登录到该特定选项卡的每个选项卡中都很明显，但是...

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2014-04-15T06:17:13.597

我们遇到了这个问题，我们很容易解决了。我的意思是简单，因为不涉及编程。我们想要做的是让用户在同一个浏览器窗口中登录多个帐户，而不会发生会话冲突。

所以解决方案是随机子域。

```
23423.abc.com
242234.abc.com
235643.abc.com 
```

所以我们要求我们的系统管理员为 *.abc.com 而不是 abc.com 配置 SSL 证书。然后几乎不需要更改代码，每次用户尝试登录时，他都会登录一个带有随机子域编号的选项卡。因此每个选项卡都可以独立拥有自己的会话。同样为了避免任何冲突，我们使用用户 ID 的哈希或 md5 开发了随机数。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2013-10-15T14:42:26.953

我在这里说实话。. . **以上所有内容**可能正确，也可能不正确，但这一切似乎都**太**复杂了，或者不知道服务器端正在使用哪个选项卡。

有时我们需要应用奥卡姆剃刀。

**这是奥卡姆的方法：（**不，我不是奥卡姆，他死于 1347 年）

1.  在加载时为您的页面分配一个浏览器唯一 ID。当且仅当窗口还没有 id 时（所以使用前缀和检测）

2.  在您拥有的每个页面上（使用全局文件或其他东西）只需将代码放置到位以检测焦点事件和/或鼠标悬停事件。（我将在这部分使用 jquery，以方便代码编写）

3.  在您的焦点（和/或鼠标悬停）功能中，设置一个带有 window.name 的 cookie

4.  当您需要读取/写入选项卡特定数据时，从您的服务器端读取该 cookie 值。

**客户端：**

```
//Events 
$(window).ready(function() {generateWindowID()});
$(window).focus(function() {setAppId()});
$(window).mouseover(function() {setAppId()});

function generateWindowID()
{
    //first see if the name is already set, if not, set it.
    if (se_appframe().name.indexOf("SEAppId") == -1){
            "window.name = 'SEAppId' + (new Date()).getTime()
    }
    setAppId()
}

function setAppId()
{
    //generate the cookie
    strCookie = 'seAppId=' + se_appframe().name + ';';
    strCookie += ' path=/';

    if (window.location.protocol.toLowerCase() == 'https:'){
        strCookie += ' secure;';
    }

    document.cookie = strCookie;
} 
```

**服务器端（C# - 用于示例目的）**

```
//variable name 
string varname = "";
HttpCookie aCookie = Request.Cookies["seAppId"];
if(aCookie != null) {
     varname  = Request.Cookies["seAppId"].Value + "_";
}
varname += "_mySessionVariable";

//write session data 
Session[varname] = "ABC123";

//readsession data 
String myVariable = Session[varname]; 
```

完毕。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-15T15:15:13.117

从单个页面开始时，您可以使用链接重写将唯一标识符附加到所有 URL（例如 index.html/jsp/whatever）。浏览器将为您的所有标签使用相同的 cookie，因此您放入 cookie 中的所有内容都*不会*是唯一的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-10-05T07:09:25.903

[在 javascript 中，如何从另一个基于 cookied 的 sessionId 唯一地识别一个浏览器窗口](https://stackoverflow.com/questions/864942/in-javascript-how-can-i-uniquely-identify-one-browser-window-from-another-which)

本质上使用window.name。如果未设置，请将其设置为唯一值并使用它。属于同一会话的选项卡会有所不同。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-08-02T18:51:46.437

我认为您可能想要的是跨选项卡维护导航状态，而不是专门为每个选项卡创建单个会话。这正是 Seam 框架通过其对话范围/上下文实现的。他们的实现依赖于这样一个事实，即会话 ID 随每个请求一起传播，并在服务器端创建会话的概念，这是位于会话和请求之间的东西。它允许导航流控制和状态管理。

虽然这主要针对 JSF，但请查看并检查是否可以从中获取一些想法： http: [//docs.jboss.org/seam/latest/reference/en-US/html_single/#d0e3620](http://docs.jboss.org/seam/latest/reference/en-US/html_single/#d0e3620)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-06-08T14:31:24.990

注意：这里的解决方案需要在应用程序设计阶段完成。以后很难设计这个。

**使用隐藏字段传递会话标识符**。

为此，每个页面都必须包含一个表单：

```
<form method="post" action="/handler">

  <input type="hidden" name="sessionId" value="123456890123456890ABCDEF01" />
  <input type="hidden" name="action" value="" />

</form> 
```

您这边的每个操作，包括导航，都会将表单返回（根据需要设置`action`）。对于[“不安全”](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html)的请求，您可以包含另一个参数，比如包含要提交的数据的 JSON 值：

```
<input type="hidden" name="action" value="completeCheckout" />
<input type="hidden" name="data" value='{ "cardNumber" : "4111111111111111", ... ' /> 
```

由于没有 cookie，每个选项卡都是独立的，并且不知道同一浏览器中的其他会话。

有很多优势，尤其是在安全性方面：

*   不依赖 JavaScript 或 HTML5。
*   从本质上防止[CSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29)。
*   不依赖 cookie，因此可以防止[POODLE](http://en.wikipedia.org/wiki/POODLE)。
*   不易受到[会话固定](https://www.owasp.org/index.php/Session_fixation)的影响。
*   可以防止使用后退按钮，当您希望用户按照设置的路径通过您的站点时，这是可取的（这意味着可以防止有时会被无序请求攻击的逻辑错误）。

一些缺点：

*   可能需要返回按钮功能。
*   缓存不是很有效，因为每个操作都是 POST。

[更多信息在这里](https://stackoverflow.com/a/30026215/413180)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-09-21T17:09:46.713

另一种可行的方法是创建一个唯一的窗口 ID，并将此值与会话 ID 一起存储在数据库表中。我经常使用的窗口 id 是整数（现在）。如果窗口被刷新、重新加载或提交给自身，则在打开窗口并重新分配给同一窗口时创建此值。使用链接将窗口值（输入）保存在本地表中。当需要一个值时，根据窗口id/会话id链接从数据库表中获取。虽然这种方法需要本地数据库，但它实际上是万无一失的。数据库表的使用对我来说很容易，但我看不出本地数组不能正常工作的原因。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-02-20T07:45:54.753

Spring Session 支持同一浏览器中的多个会话查看示例和实现细节 [http://docs.spring.io/spring-session/docs/current/reference/html5/guides/users.html](http://docs.spring.io/spring-session/docs/current/reference/html5/guides/users.html)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-12-08T19:30:11.080

我通过以下方式解决了这个问题：

*   我已经为窗口分配了一个名称，这个名称与连接资源相同。
*   加 1 以摆脱存储在 cookie 中的附加连接。
*   我创建了一个函数来捕获所有 xmloutput 响应并将 sid 和 rid 分配给 json 格式的 cookie。我为每个 window.name 执行此操作。

这里的代码：

```
var deferred = $q.defer(),
        self = this,
        onConnect = function(status){
          if (status === Strophe.Status.CONNECTING) {
            deferred.notify({status: 'connecting'});
          } else if (status === Strophe.Status.CONNFAIL) {
            self.connected = false;
            deferred.notify({status: 'fail'});
          } else if (status === Strophe.Status.DISCONNECTING) {
            deferred.notify({status: 'disconnecting'});
          } else if (status === Strophe.Status.DISCONNECTED) {
            self.connected = false;
            deferred.notify({status: 'disconnected'});
          } else if (status === Strophe.Status.CONNECTED) {
            self.connection.send($pres().tree());
            self.connected = true;
            deferred.resolve({status: 'connected'});
          } else if (status === Strophe.Status.ATTACHED) {
            deferred.resolve({status: 'attached'});
            self.connected = true;
          }
        },
        output = function(data){
          if (self.connected){
            var rid = $(data).attr('rid'),
                sid = $(data).attr('sid'),
                storage = {};

            if (localStorageService.cookie.get('day_bind')){
              storage = localStorageService.cookie.get('day_bind');
            }else{
              storage = {};
            }
            storage[$window.name] = sid + '-' + rid;
            localStorageService.cookie.set('day_bind', angular.toJson(storage));
          }
        };
    if ($window.name){
      var storage = localStorageService.cookie.get('day_bind'),
          value = storage[$window.name].split('-')
          sid = value[0],
          rid = value[1];
      self.connection = new Strophe.Connection(BoshService);
      self.connection.xmlOutput = output;
      self.connection.attach('bosh@' + BoshDomain + '/' + $window.name, sid, parseInt(rid, 10) + 1, onConnect);
    }else{
      $window.name = 'web_' + (new Date()).getTime();
      self.connection = new Strophe.Connection(BoshService);
      self.connection.xmlOutput = output;
      self.connection.connect('bosh@' + BoshDomain + '/' + $window.name, '123456', onConnect);
    } 
```

希望对你有帮助

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-07-18T17:40:46.493

我一直在阅读这篇文章，因为我想我想做同样的事情。对于我正在处理的应用程序，我有类似的情况。实际上，这是一个测试而不是实用性的问题。

在阅读了这些答案，尤其是 Michael Borgwardt 给出的答案后，我意识到需要存在的工作流程：

1.  如果用户导航到登录屏幕，请检查现有会话。如果存在绕过登录屏幕并将它们发送到欢迎屏幕。
2.  如果用户（在我的情况下）导航到注册屏幕，请检查现有会话。如果存在，请让用户知道您将注销该会话。如果他们同意，请退出并开始注册。

这将解决用户在他们的会话中看到“另一个用户的”数据的问题。他们并没有真正在他们的会话中看到“另一个用户的”数据，他们真正看到的是他们打开的唯一会话中的数据。显然，这会导致一些有趣的数据，因为某些操作会覆盖某些会话数据而不是其他数据，因此您在该单个会话中拥有数据组合。

现在，解决测试问题。唯一可行的方法是利用[预处理器指令](http://msdn.microsoft.com/en-us/library/ed8yd1ha.aspx)来确定是否应该使用无 cookie 会话。看，通过为特定环境构建特定配置，我能够对环境及其用途做出一些假设。这将允许我在技术上让两个用户同时登录，并且测试人员可以从同一个浏览器会话测试多个场景，而无需注销任何这些服务器会话。

但是，这种方法有一些严重的警告。其中最重要的一点是，测试人员正在测试的东西**并不是**要在生产中运行的东西。

所以我想我不得不说，这最终是个**坏主意。**

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-11-22T08:47:32.553

```
How to differ sessions in browser-tabs? 
```

在浏览器选项卡中区分会话的最直接方法是禁止您的特定域设置 cookie。这样，您可以从单独的选项卡中获得单独的会话。假设您禁止来自以下域的 cookie：www.xyz.com。您打开 Tab 1，登录并开始浏览。然后打开选项卡 2，您可以以相同用户或不同用户身份登录；无论哪种方式，您都会有一个与 Tab 1 分开的会话。依此类推。

但是，当您可以控制客户端时，这当然是可能的。否则，这里的人规定的解决方案应该适用。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-03-16T05:23:34.587

我看到许多实现都有客户端更改来操作会话 id cookie。但一般会话 id cookie 应该是 HttpOnly 以便 java-script 无法访问，否则可能导致通过 XSS 的会话劫持

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-10-05T20:54:04.613

如果尚未设置时间戳，则将其存储在 window.sessionStorage 中。这将为每个选项卡提供一个唯一值（即使 URL 相同）

[http://www.javascriptkit.com/javatutors/domstorage.shtml](http://www.javascriptkit.com/javatutors/domstorage.shtml)

[https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Storage](https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Storage)

希望这可以帮助。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-10-25T01:02:24.430

你需要做

1-为帐户列表存储一个cookie

2-可选存储一个cookie作为默认值

3- 为每个帐户存储它的索引，如 acc1、acc2

4-在url中输入代表帐户索引的东西，如果没有，您将选择默认的，例如google mail domain.com/0/some-url >> 0 这里代表帐户索引，您可能还需要知道如何使用 urlwrite

5-选择cookie时，根据你的urlpath选择它代表帐户索引

问候

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-04-19T08:04:59.273

如果是因为每个选项卡将在您的应用程序中运行不同的流程，并且混合两个流程会导致问题，那么最好“区域化”您的会话对象，以便每个流程将使用会话的不同区域

该区域可以简单地实现为每个流具有不同的前缀，或者会话对象将包含多个映射（每个流一个），并且您使用这些映射而不是会话属性，最好的办法是扩展您的会话类和改用它。

# java - 在 java 中使用文件路径的最佳方法是什么？

> ID：368658
> 
> 赞同：1
> 
> 时间：2008-12-15T15:12:38.863
> 
> 标签：java, file

我相信这是`File`课程，但我听说这在内存中非常昂贵。

有没有更好的方法来处理文件路径？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T15:21:25.523

不知道自己想做什么很难说，但请不要过早优化。我怀疑 File 对象的内存使用在您的应用程序中会很明显。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T15:23:38.590

[File](http://java.sun.com/javase/6/docs/api/java/io/File.html)类本身并没有保存太多数据。它具有所有两个实例字段。如果您担心的只是内存，那么看起来这不是什么大问题。在您打开流或通道之前，不会从文件系统加载任何内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T15:24:28.263

File 类可能足够昂贵，以至于您不想使用它来将硬盘驱动器上的每个文件存储在内存中。我知道我遇到了问题，特别是当我尝试使用 File 对象树时。如果您确实遇到使用文件类过于昂贵的情况，请考虑仅使用字符串，并在需要时转换为文件。但是让你的程序变得实用的优化可能表明你有更大的问题。与保存对象的结构相关的开销更有可能成为问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T17:54:02.330

我唯一知道 File 使用大量内存的地方是当您使用 File.list() 时...

请参阅这些以获取一些解决方案：

[Java 在遍历大型目录时性能不佳是否有解决方法？](https://stackoverflow.com/questions/354703/is-there-a-workaround-for-javas-poor-performance-on-walking-huge-directories)

# tfs - 我可以将 TFS 工作项重新分配给签入代码吗？

> ID：368664
> 
> 赞同：10
> 
> 时间：2008-12-15T15:14:09.233
> 
> 标签：tfs

是否可以返回并将工作项与已签入 TFS 的代码联系起来？例如 。. . 开发人员选择了错误的工作项，或者忘记选择工作项？我可以看到 ChangeSet 的工作项详细信息，但工作项页面是只读的。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-15T15:33:04.360

如果您转到工作项并转到“链接”选项卡，您应该能够添加/编辑到变更集的链接。我认为这应该可以解决问题。

M。

# xml - 如何在带有 XSLT 的 XML 文档中获取根元素的标签名称？

> ID：368668
> 
> 赞同：28
> 
> 时间：2008-12-15T15:16:13.817
> 
> 标签：xml, xslt, xpath

我有兴趣将 xml 文档中根元素的标记名称分配给 xslt 变量。例如，如果文档看起来像（减去 DTD）：

```
<foo xmlns="http://.....">
    <bar>1</bar>
</foo> 
```

我想将字符串 'foo' 分配给一个 xslt 变量。有没有办法参考？

谢谢，马特

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-15T15:36:49.487

我认为您想检索最外层 XML 元素的名称。这可以像下面的 XSL 示例一样完成：

```
<?xml version="1.0" encoding="UTF-8" ?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <xsl:variable name="outermostElementName" select="name(/*)" />

  <xsl:template match="/">
    <xsl:value-of select="$outermostElementName"/>
  </xsl:template>
</xsl:stylesheet> 
```

请注意，XPath 术语略有不同：

> 树的顶部是根节点（1.0 术语）或文档节点（2.0）。这就是“/”所指的。它不是一个元素：它是最外层元素的父元素（以及在最外层元素之前或之后的任何注释和处理指令）。根节点没有名称。

见[http://www.dpawson.co.uk/xsl/sect2/root.html#d9799e301](http://www.dpawson.co.uk/xsl/sect2/root.html#d9799e301)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-15T17:58:51.897

使用 XPath[**`name()`**](http://www.w3.org/TR/xpath#function-name)函数。

获取顶部（不是根！）元素名称的一个 XPath 表达式是：

       **`name(/*)`**

name() 函数返回节点的完全限定名称，因此对于元素`<bar:foo/>`，将返回字符串“bar:foo”。

如果只需要名称的本地部分（无前缀和“:”），[**`local-name()`**](http://www.w3.org/TR/xpath#function-local-name)则应使用 XPath 函数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T15:35:53.497

弄清楚了。给定参数 * 的函数 name() 将返回 foo。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T15:38:40.027

你想要**[本地名称（）](http://zvon.org/xxl/XSLTreference/Output/function_local-name.html)**

# version-control - 最佳实践，针对主干构建主干？

> ID：368669
> 
> 赞同：6
> 
> 时间：2008-12-15T15:16:40.180
> 
> 标签：version-control, testing, build-process

我们有许多使用共享组件 (dll) 的公共基础的项目。目前，每个项目的开发版本都链接到从组件主干构建的 dll。（即主干构建使用来自其他主干构建的 dll）

当我们进行发布构建时，我们有一个脚本，它遍历项目文件并将主干引用替换为组件的特定编号版本（从标记的分支构建）

我认为这削弱了我们在开发过程中所做的测试，因为我实际从事的项目使用的 dll 与发布版本将使用的不同。我想始终针对组件的编号版本进行开发，并且仅在有特定需求时才更新它们。

然而团队中的其他人认为，除非我们针对主干进行开发（并在每个版本中更新到较新版本的组件），否则我们将遇到以下问题：（a）我们的产品将几乎不会更新到较新版本的组件（ b）当我们确实需要更新时，这将是一项艰巨的任务，因为组件源/接口将发生很大变化。

你遵循什么做法，为什么？

编辑：对不起，我刚刚意识到我提到有几个主要产品共享组件而混淆了事情 - 尽管它们共享它们不在同一台 PC 上运行的组件。我的担忧与这样一个事实有关，因为组件可能会随着产品的每次发布而发生变化（即使没有特定要求更新组件），所以测试会遗漏在组件中完成的一些细微的变化，而不是与在产品上所做的具体工作。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-15T15:42:52.173

嗯，我在这里可能是少数，但这归结为发布管理。

根据定义，针对`trunk`一组共享组件进行开发意味着这些组件是一个“移动目标”——使用这些共享组件的开发人员不一定知道新发现的缺陷或故障是由于项目代码还是共享组件，这会导致生产力损失，IMNSHO。

“共享组件”有自己的发布周期。让您的其他开发人员休息一下并修复项目将要使用和使用的共享组件的版本`tags`，`labels`或者`branches`确定共享组件的版本。在项目的下一次迭代中，升级到共享组件的最新“稳定”或“生产”版本。

如果你原谅这个表达，这里还有另一种“气味”。在项目发布之间拥有“源/接口将发生很大变化”的“共享组件”听起来好像组件不是那么可靠或不应该共享。

另请参阅此问题的答案[Shared components across all projects，是否有比 svn:externals 更好的选择？](https://stackoverflow.com/questions/249085/shared-components-throughout-all-projects-is-there-a-better-alternative-than-sv#249146)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T15:28:18.427

您应该拥有很少更改的强大接口，因此更改版本应该不会那么难。

当您需要更改时，分离版本并针对特定版本工作会增加开销，但它也应该鼓励总体上减少界面更改，从长远来看这将有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T15:28:26.460

我们同时针对多个分支和主干进行开发，并且我们选择使用我们将推出生产的代码来构建和测试每个分支。我不认为它是安全的任何其他方式。

基本上，如果开发人员正在开发主干，他们所要做的就是担心从主干构建并将代码提交到主干。

任何在分支上工作的开发人员都需要构建和测试该分支（有多个项目都分支/标记相同的构建/发布）。当他们向该分支提交更改时，他们还必须将这些单独的更改合并到主干中。

我们希望所有开发人员都熟悉 SCM (SVN) 并能够维护多个代码分支。作为一个团队，我们处理主要的框架变化或巨大的代码更改，以尽量减少麻烦的合并。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T15:31:21.633

这里有两件事。首先，我认为你是对的；您想针对最新的开发版本进行构建，而不是针对旧版本。如果你还没有，你*会*看到发布版本崩溃的情况，你必须通宵清理差异。

无论如何，我个人是“提交到主干，从分支发布”模型的粉丝。所有提交都进入主干，隔夜构建或 CI 构建都是针对主干的，人们可以自由地创建分支。当你有一个符合验收标准的主干时，标记一个发布候选，但继续对主干进行更新。如果您的发布周期较长，那么您*可能*会将发布 n+1 的更改添加到主干，但理想情况下您应该缩短发布周期。如果发布版本中不应该对主干*进行更改，并且您遇到需要更改的问题，请针对**标记版本*创建一个分支--- 并确保在完成后将所有更改合并回主干实际发布。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T15:32:57.950

我们正在使用 scons 构建系统，并且在根目录中有我们自己的文件，它指定了我们在构建应用程序时要使用的每个库的版本。

这减少了在您提到的几个位置更改版本名称的需要。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T15:37:34.727

(b) 是否是一个有效的论点取决于您的共享组件多久更改一次以及更改多少。如果它们在您的工作场所经常更改，那么您“被迫”开发最新版本可能是有效的。这本身是否是一个问题是一个有效的问题。

但是，从您的角度来看，我看不出如何在不对生产中使用的共享组件进行测试的情况下将代码推送到生产中。您是否针对发布版本进行第二个测试周期？你只是祈祷没有任何破坏吗？坦率地说，(b) 在这些情况下可以颠倒以支持您的观点：如果主干与最近的标记分支足够不同，那么必须努力确保您的应用程序与它正常工作。

如果您的共享组件被标记得足够频繁，那么您的同事可能是对的，并且管理从最新标记到主干的增量更改比管理任意版本 X 的更改更容易（在最后一次构建时确定）到任意版本 Y（在您选择升级时确定）。

# ide - File -> Make... 菜单选项在 VB6 IDE 中被禁用

> ID：368684
> 
> 赞同：16
> 
> 时间：2008-12-15T15:23:33.973
> 
> 标签：ide, vb6

当文件菜单下的 Make XXXX 菜单选项被禁用时，VB6 IDE 会进入一个状态。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-12-15T15:26:03.890

找到了我自己的不需要重新安装 VB6 的解决方案。在 VB6 中，右键单击工具栏，转到自定义和重置工具栏。之后，文件菜单下的 Make XXXX 菜单重新启用！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T22:01:24.607

当文件是只读的时，我遇到了这个问题。使文件读/写，然后重试。

# asp.net - ASP.NET AJAX 部分回发时不更新屏幕

> ID：368687
> 
> 赞同：0
> 
> 时间：2008-12-15T15:23:54.503
> 
> 标签：asp.net, ajax, .net-2.0, postback

我们的页面上有一个问题，即第一次返回按钮时（我们有 ASP.NET ajax 来启用部分更新）没有任何反应，然后在每次后续单击时，信息都会更新，就像之前的事件被触发一样。

这是页面的代码。这些事件是从表内触发的按钮单击。在后端重新渲染。

```
<asp:ScriptManager EnablePartialRendering="true" ID="scrptMgr1" runat="server">
    </asp:ScriptManager>
    <asp:UpdatePanel runat="server" ID="folderContainer">
        <ContentTemplate>
            <asp:Table id="FolderTable" CssClass="FolderTable" runat="server" CellSpacing="0"></asp:Table>
        </ContentTemplate>
    </asp:UpdatePanel> 
```

有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T15:29:07.487

您是否尝试过使用或不使用 runat="server" 的 HTML 表格？

您是否在回发的表格内添加或删除控件？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T20:28:54.513

受到罗伯特回答的启发：

您在哪个事件处理程序中构建您的表？如果您在 Page_Load 中构建它而不检查 IsPostBack)，则尚未处理按钮的单击事件。

您需要在按钮单击处理程序中构建表格。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-15T20:09:12.603

您的表格可能在页面生命周期中被填充得太晚。尝试在 PreInit 中创建表。

# tfs - Team Foundation Server 自动发行说明生成

> ID：368707
> 
> 赞同：12
> 
> 时间：2008-12-15T15:29:30.187
> 
> 标签：tfs

从 Team Foundation Server 2008 夜间版本自动生成发行说明文本文件的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T23:33:22.050

我们创建了一个 TFS 报告，其中列出了与指定迭代（版本）关联的所有工作项。此外，我们向工作项添加了一个自定义字段，以指示我们是否希望将工作项包含在发行说明报告中。（并非所有工作项都适合所有客户/用户。）

您可以自动执行此过程，但您需要在构建任务中指定迭代。或者，您可以列出截至特定日期已完成的每个工作项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-06-21T20:49:08.777

我认为这里的解决方案是描述“构建说明”。如果你想这样做，你真的需要查看[TFS Community Build Manager](https://visualstudiogallery.msdn.microsoft.com/73bf2d8e-aec6-406c-8e7f-1c678e46557f)。它具有使用 OpenXML 在 Word 文件中生成构建注释的功能。它正在单击 VSIX，您就完成了。

但是恕我直言，构建说明不是发行说明。发行说明提供了一种对客户更友好的方式来列出您的更改。并且您需要能够在注释中指定您想要的工作项，以及您不希望客户看到的工作项。为此，我创建了一个自定义团队资源管理器加载项。它或多或少地完成了构建管理器在生成 OpenXML Word 时所做的事情。

我使用查询来定义错误修正是什么，有哪些新功能可用，......然后团队资源管理器扩展提供 GUI 来指定文档字段（标题、描述、备注......）并选择相应的查询到发行说明上的块。填写详细信息后，生成word文档。如果你愿意，我可以提供所有细节。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T07:08:31.187

**更新**：

我上传了一个示例 xsl 文件，用于转换 buildlog.xml 以获得信息丰富的普通 releasenotes.txt。在此处获取：[从 Team Foundation Build 自动生成发行说明文本文件](http://www.trimagination.info/2009/01/23/automatically-generate-release-notes-textfile-from-team-foundation-build/)

* * *

那一个实际上很容易。格兰特霍利迪在他的博客上描述了它。它基本上是这样的：

1.  安装 MSBuild 社区任务（其中包含 WebDownload 任务）
2.  从 Microsoft 安装 MSXSL.exe（用于转换 xml 文件）
3.  使用有关检索 buildlog.xml（使用 WebDownload 任务）和使用 MSXSL.exe 转换的信息扩展 tfsbuild 项目

但是，您需要直接从 tigris 下载 MSBuild 社区任务，而不是使用此博客文章中提供的链接。这是因为链接引用了不支持 UseDefaultCredentials 选项的错误版本（您需要 MSBuild 任务才能连接到正确的 TFS Web 服务）。

这是文章的链接： [使用团队构建构建发行说明文本文件](http://ozgrant.com/2008/02/19/building-a-release-notes-text-file-with-team-build/)

除了 xsl 文件，我得到了一切工作，因为不幸的是，格兰特没有提供示例 xsl。如果您设法创建了一个适合您需要的适当的 xml 转换文件，那么如果您能给我发送一份副本，那就太棒了。;-)

# sql - 排除物料清单样式关系中的空值

> ID：368725
> 
> 赞同：1
> 
> 时间：2008-12-15T15:36:13.963
> 
> 标签：sql, database, referential-integrity

给定架构

```
人{姓名，配偶}

```

其中 PERSON.spouse 是 PERSON.name 的外键，当一个人未婚或我们没有任何信息时，NULL 是必要的。

带着反对空值的论点，在这种情况下你如何避免它们？

我有一个备用架构

```
人{姓名}
配偶 { 姓名 1，姓名 2 }

```

其中 SPOUSE.name* 是 PERSON 的 FK。我在这里看到的问题是，没有办法确保某人只有一个配偶（即使有所有可能的 UNIQUE 限制，也有可能有两个配偶）。

在物料清单样式关系中排除空值的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T15:56:03.707

我认为对这种类型的关系不强制执行 NULL 和不重复会使模式定义变得比实际需要的更复杂。即使您允许空值，一个人仍然有可能拥有多个配偶，或者有冲突的记录，例如：

```
PERSON { A, B }
PERSON { B, C }
PERSON { C, NULL } 
```

您需要引入更多数据，例如性别（或同性婚姻的“配偶编号”？），以确保例如只允许一种类型的人拥有配偶。另一方的配偶将由第一方的记录确定。例如：

```
PERSON { A, FEMALE, B }
PERSON { B, MALE, NULL }
PERSON { C, FEMALE, NULL } 
```

......所以只有女性的人才能有一个非空的配偶。

但是恕我直言，即使使用 NULL，这也过于复杂且不直观。如果没有 NULL，情况会更糟。除非您确实别无选择，否则我会避免进行这样的架构限制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T15:42:02.080

好吧，首先我会使用自动递增的 ID，因为当然，有人可能有相同的名字。但是，我假设您打算这样做并且不会竖琴。然而，反对 NULL 的论点究竟如何呢？我对 NULL 没有任何问题，并认为这是解决此问题的适当方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T17:12:37.357

我不确定为什么还没有人指出这一点，但实际上很容易确保一个人只有一个配偶，使用与您的问题几乎相同的模型。

我将暂时忽略将名称用作主键（它可以更改并且重复相当普遍，因此这是一个糟糕的选择），并且我还将忽略对历史跟踪的可能需求（您可能想要添加某种生效日期，以便您知道他们何时是配偶 - Joe Celko 写了一些关于时间建模的好东西，但我不记得当时它在哪本书中）。否则，如果我离婚再婚，你会失去我在另一个时间有另一个配偶的想法——也许这对你来说并不重要。

此外，您可能希望将 name 分解为 first_name、middle_name、last_name、prefix、suffix 等。

鉴于这些警告...

```
CREATE TABLE People
(
     person_name     VARCHAR(100),
     CONSTRAINT PK_People PRIMARY KEY (person_name)
)
GO
CREATE TABLE Spouses
(
     person_name     VARCHAR(100),
     spouse_name     VARCHAR(100),
     CONSTRAINT PK_Spouses PRIMARY KEY (person_name),
     CONSTRAINT FK_Spouses_People FOREIGN KEY (person_name) REFERENCES People (person_name)
)
GO 
```

如果您想让配偶也出现在 People 表中，那么您也可以为此添加 FK。但是，此时您正在处理双向链接，这变得有点复杂。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T15:52:05.820

好吧，从使用 name 以外的键开始，也许是 int 种子。但是为了防止某人拥有多个配偶，只需在配偶表中的 parent(name1) 中添加一个唯一索引。这将阻止您两次插入相同的 name1。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T15:52:17.097

您可以使用触发器来强制执行约束。PostgreSQL 有[约束触发器](http://developer.postgresql.org/pgdocs/postgres/sql-createconstraint.html)，这是一种将约束评估推迟到事务中的适当时间的特别好的方法。

来自 Fabian Pascal*在数据库管理中的实际问题*，第 66-67 页：

> 存储过程（无论是否触发）比应用程序级完整性代码更可取，但它们实际上不如声明性支持且风险更大，因为它们编写起来更加繁琐、容易出错，并且无法从完整的 DBMS 优化中受益。
> 
> ...
> 
> 选择具有更好的声明完整性支持的 DBMS。鉴于产品在此类支持方面存在相当大的差距，知识渊博的用户至少能够 *正确*模拟（尽管使用过程和/或应用程序代码）不受 DBMS 支持的约束。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T16:00:31.637

好吧，使用自动 ID，然后使用检查约束。“Name1”列（这将只是一个 int ID）将被强制只有奇数编号的 ID，而 Name2 将只有偶数。

然后为 Column1 和 Column2 创建一个唯一约束。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T16:46:18.970

您需要一个人员表和一个单独的“Partner_Off”表来定义关系。

人（身份证、姓名等）；

Partner_Off (id, partner_id, 关系);

要处理更复杂的社交情况，您可能需要在其中添加一些日期，此外，为了简化 sql，您需要 (fred,wilma,husband) 的一个条目和 (wilma,fred,wife) 的匹配条目。

# windows - P/Invoke 以纠正 Win32 DLL 的版本？

> ID：368726
> 
> 赞同：0
> 
> 时间：2008-12-15T15:36:22.183
> 
> 标签：windows, winapi, pinvoke

我有一些调用 DBGHELP.DLL 的 P/Invoke 代码。稍后我会将签名添加到 pinvoke.net。

Windows 2003 附带的 DBGHELP.DLL 版本太旧，我的代码需要“Windows 调试工具”版本 6.9 附带的 DBGHELP.DLL 版本。

如何执行以下操作之一？

*   确保 DllImport 需要最低版本。
*   找出将加载哪个 DLL，然后获取其版本号。我需要使用 FileVersionInfo，但是如何找出 P/Invoke 将使用的搜索顺序？

也就是说：是否有人拥有使用 FileVersionInfo 来检查最低版本信息的健壮代码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T21:44:28.883

使用您想要的 DBGHELP 的显式路径 P/Invoke 对 LoadLibrary 的调用，这样当您进行实际的 P/Invoke 调用时，DLL 将已经被加载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T12:15:29.920

导入（但不调用）仅存在于 DbgHelp.DLL 6.9 及更高版本中的函数不是更容易吗？

# java - 加速 JDBC 写入的技巧？

> ID：368736
> 
> 赞同：14
> 
> 时间：2008-12-15T15:39:03.240
> 
> 标签：java, performance, postgresql, jdbc

我正在编写一个对 Postgres 数据库进行大量写入的程序。在典型的场景中，我会将 100,000 行写入一个规范化的表（三个外整数键，它们的组合是主键和表的索引）。我正在使用 PreparedStatements 和 executeBatch()，但是当我们要替换的嵌入式数据库（具有相同的外键约束和索引）在我的笔记本电脑上执行时，我只能设法在大约 70 秒内推入 100k 行10.

我是 JDBC 的新手，我不希望它能够击败自定义嵌入式数据库，但我希望它只慢 2-3 倍，而不是 7 倍。有什么明显我可能遗漏的东西吗？写入的顺序重要吗？（即说如果它不是索引的顺序？）。挤出一点速度要注意什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T00:19:25.843

这是我在当前项目中经常不得不处理的一个问题。对于我们的应用程序，插入速度是一个关键瓶颈。但是，我们发现对于绝大多数数据库用户来说，选择速度是他们的主要瓶颈，所以你会发现有更多的资源来处理这个问题。

因此，以下是我们提出的一些解决方案：

首先，所有解决方案都涉及使用 postgres [COPY 命令](http://www.postgresql.org/docs/8.3/static/sql-copy.html)。使用 COPY 将数据导入 postgres 是迄今为止最快的方法。但是，默认情况下，JDBC 驱动程序当前不支持通过网络套接字进行 COPY。因此，如果您想使用它，您需要执行以下两种解决方法之一：

1.  修补以支持 COPY 的 JDBC 驱动程序，例如[这个](http://kato.iki.fi/sw/db/postgresql/jdbc/copy/).
2.  如果您插入的数据和数据库在同一台物理机上，您可以将数据写入文件系统上的文件，然后使用 COPY 命令批量导入数据。

提高速度的其他选择是使用 JNI 来访问 postgres api，这样您就可以通过 unix 套接字进行交谈，删除索引和[pg_bulkload 项目](http://pgfoundry.org/projects/pgbulkload/)。但是，最终如果您不实施 COPY，您总是会发现性能令人失望。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T02:01:09.943

检查您的连接是否设置为自动提交。如果 autoCommit 为 true，那么当您调用 executeBatch 时，如果批处理中有 100 个项目，它将发出 100 个单独的提交。这可能比调用 executionBatch() 后跟一个显式的 commit() 慢很多。

我会避免在插入期间删除索引或外键的诱惑。它在负载运行时将表置于不可用状态，因为在索引消失时没有人可以查询表。另外，它看起来很无害，但是当您尝试重新启用约束并且由于发生了您没想到会发生的事情而失败时，您会怎么做？RDBMS 具有完整性约束是有原因的，即使“暂时”禁用它们也是危险的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T16:05:18.693

您显然可以尝试更改批次的大小以找到最适合您的配置的大小，但我怀疑您会获得 3 倍。

您还可以尝试调整您的数据库结构。使用单个字段作为主键时，您可能会比使用组合 PK 获得更好的性能。根据您需要的完整性级别，您可以通过停用数据库上的完整性检查来节省相当多的时间。

您还可以更改正在使用的数据库。MySQL 应该非常适合高速简单插入……而且我知道 MySQL 有一个分支，它试图削减功能以在高并发访问时获得非常高的性能。

祝你好运 ！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T16:16:31.323

尝试禁用索引，并在插入后重新启用它们。另外，将整个过程包装在事务中

# c++ - c++推演“非类型函数指针”类模板参数

> ID：368737
> 
> 赞同：4
> 
> 时间：2008-12-15T15:39:10.493
> 
> 标签：c++, templates, decltype, result-of

考虑一个模板类，如：

```
template<typename ReturnType, ReturnType Fn()>
class Proxy
{
    void run()
    {
        ReturnType ret = Fn();
        // ... do something ...
    }
};

// and a functions
int fn1() { return 5; }
float fn2() { return 5; } 
```

这可以通过使用实例化：

```
Proxy<int, &fn1> p1; 
```

但是显式声明返回值类型似乎是不必要的。我想要实现的是：

```
 someProxyInstantation<&fn1> p1;
 someProxyInstantation<&fn2> p2; 
```

不幸的是，我不是 c++ 期望的，这似乎是语言的一个隐藏角落（至少对我来说）。

如果我可以从指向函数的指针获取其类型 - 类似于： std::tr1::result_of<&fn>::type // 错误 1 ​​错误 C2923: 'std::tr1::result_of' : 'fn1 ' 不是参数 '_Fty' 的有效模板类型参数

该错误是有道理的，因为该参数根本不是“类型”

C++0x 有 decltype(&fn1) 但那是几年后的事了。

**在 C++03 (+ tr1) 中有什么方法可以做到这一点？**

限制： - 我不想传递函子，f1 和 f2 必须保留具有返回值的全局函数（不能将其移动到参数）。）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T15:58:59.707

这在 C++03 中是不可能的。如果要将函数指针作为非类型参数传递，编译器必须知道参数的类型。所以你必须提供缺失的部分（在这种情况下，返回类型）。您可以在运行时为代理提供函数指针作为值，并为其提供它的类型作为唯一参数。然后你可以为你编写一个生成器函数来完成这项工作：

```
template<typename T>
Proxy<T> make_proxy(T t) { return Proxy<T>(t); } 
```

可悲的是，在当前的 C++ 中，您仍然必须为其指定类型才能分配给自动变量：

```
Proxy<int(*)()> p = make_proxy(&fn1); 
```

你还不能用`auto p = make_proxy(&fn1);`。请注意，如果要在左侧使用函数类型，则必须将生成器函数更改为不提供函数指针类型：

```
template<typename T>
Proxy<typename boost::remove_pointer<T>::type> make_proxy(T t) { 
    return Proxy<typename boost::remove_pointer<T>::type>(t); 
} 
```

现在你可以做

```
Proxy<int()> p = make_proxy(&fn1); 
```

使用代理，你现在可以做

```
doSomething(make_proxy(&fn1)); 
```

如果 doSomething 是模板化的或其他多态的，则不需要您知道函数的确切类型。

# c# - 抛出 ArgumentNullException

> ID：368742
> 
> 赞同：71
> 
> 时间：2008-12-15T15:41:21.817
> 
> 标签：c#, .net, exception, exception-handling

假设我有一个将某种对象作为参数的方法。现在说如果这个方法传递了一个空参数，这是一个致命错误，应该抛出一个异常。我是否值得编写这样的代码（记住这是一个简单的例子）：

```
void someMethod(SomeClass x)
{
    if (x == null){
        throw new ArgumentNullException("someMethod received a null argument!");
    }

    x.doSomething();
} 
```

或者当它调用 x.doSomething() 时仅仅依靠它抛出 NullException 对我来说是安全的吗？

其次，假设 someMethod 是一个构造函数，并且 x 在调用另一个方法之前不会被使用。我应该立即抛出异常还是等到需要 x 后再抛出异常？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-12-15T15:46:10.840

我更喜欢不检查参数会提供的`ArgumentNullException`。`NullReferenceException`一般来说，我的偏好是在尝试调用可能为空的对象上的方法之前始终检查是否为空。

如果该方法是一个构造函数，那么它将取决于几个不同的因素：该属性是否还有一个公共设置器以及该对象实际被使用的可能性有多大。如果有一个公共的 setter，那么不通过构造函数提供一个有效的实例是合理的并且不应该导致异常。

如果没有公共设置器并且可以在不引用注入对象的情况下使用包含对象，您可能希望推迟检查/异常直到尝试使用它。不过，我认为一般情况是注入的对象对于实例的运行至关重要，因此 ArgumentNull 异常是完全合理的，因为没有它实例就无法运行。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-12-15T15:46:12.243

我总是遵循**快速失败**的做法。如果您的方法依赖于 X，并且您了解 X 可能以 null 形式传递，请对其进行 null 检查并立即引发异常，而不是延长故障点。

**2016 年更新：**

现实世界的例子。我强烈推荐使用[JetBrains Annotations](https://www.jetbrains.com/help/resharper/2016.1/Code_Analysis__Code_Annotations.html)。

```
[Pure]
public static object Call([NotNull] Type declaringType, 
                          [NotNull] string methodName, 
                          [CanBeNull] object instance)
{
    if (declaringType == null) throw new ArgumentNullException(nameof(declaringType));
    if (methodName == null) throw new ArgumentNullException(nameof(methodName)); 
```

使用 C# 6 提供了运算符，Guard 语句得到了极大的改进`nameof`。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-15T15:46:57.140

我更喜欢显式异常，原因如下：

*   如果该方法有多个 SomeClass 参数，它让您有机会说出它是哪一个（调用堆栈中的所有其他内容都可用）。
*   如果你在引用 x 之前做了一些可能有副作用的事情怎么办？

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2020-03-11T10:58:46.363

这些天没有理由不检查。C# 继续前进，您可以使用丢弃和空合并运算符非常巧妙地做到这一点：

```
_ = declaringType ?? throw new ArgumentNullException(nameof(declaringType));
_ = methodname ?? throw new ArgumentNullException(nameof(methodName)); 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-12-15T18:28:14.803

我同意快速失败的想法——但是知道为什么快速失败是可行的是明智的。考虑这个例子：

```
void someMethod(SomeClass x)
{       
    x.Property.doSomething();
} 
```

如果你依靠`NullReferenceException`来告诉你出了什么问题，你怎么知道什么是空的？堆栈跟踪只会给你一个行号，而不是哪个引用为空。在这个例子中`x`，或者`x.Property`两者都为空，并且事先没有通过积极的检查快速失败，您将不知道它是哪个。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-12-15T15:50:39.270

我也更喜欢使用显式 ArgumentNullException 进行参数检查。

查看元数据：

```
 //
    // Summary:
    //     Initializes a new instance of the System.ArgumentNullException class with
    //     the name of the parameter that causes this exception.
    //
    // Parameters:
    //   paramName:
    //     The name of the parameter that caused the exception.
    public ArgumentNullException(string paramName); 
```

您可以看到，该字符串应该是参数的名称，即为 null，因此向开发人员提示出了什么问题。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-15T15:50:35.417

如果您期望输入不为空，则应显式抛出 ArgumentNullException。您可能想编写一个名为 Guard 的类，为此提供帮助方法。所以你的代码将是：

```
void someMethod(SomeClass x, SomeClass y)
{
    Guard.NotNull(x,"x","someMethod received a null x argument!");
    Guard.NotNull(y,"y","someMethod received a null y argument!");

    x.doSomething();
    y.doSomething();
} 
```

NonNull 方法将执行空值检查并抛出 NullArgumentException 以及调用中指定的错误消息。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-15T15:48:30.240

最好尽早抛出 ArgumentNullException。如果你抛出它，你可以提供比 NullReferenceException 更有用的问题信息。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-15T15:49:07.573

1.  如果您不想要 Null 值，请明确执行此操作。否则，当其他人查看您的代码时，他们会认为传递 Null 值是可以接受的。

2.  尽早做。这样，您就不会在不应该传播 Null 的“错误”行为时传播它。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-15T15:47:20.680

如果您进行防御性编程，则应该快速失败。因此，请在代码开头检查您的输入和错误。你应该善待你的来电者，并尽可能给他们最具描述性的错误信息。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-10-05T14:32:58.070

我可能会因此而被否决，但我认为完全不同。

遵循一种称为**“从不传递 null”**的良好做法并删除丑陋的异常检查怎么样？

如果参数是对象，请勿传递 NULL。此外，请勿返回 NULL。您甚至可以使用 Null 对象模式来帮助解决这个问题。

如果它是可选的，请使用默认值（如果您的语言支持它们）或创建重载。

比丑陋的例外要干净得多。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-07-19T16:30:54.457

您可以使用如下语法来不仅抛出`ArgumentNullException`异常，还可以将该异常命名为参数作为其错误文本的一部分。例如;

```
void SomeMethod(SomeObject someObject)
{
    Throw.IfArgNull(() => someObject);
    //... do more stuff
} 
```

用于引发异常的类是；

```
public static class Throw
{
    public static void IfArgNull<T>(Expression<Func<T>> arg)
    {
        if (arg == null)
        {
            throw new ArgumentNullException(nameof(arg), "There is no expression with which to test the object's value.");
        }

        // get the variable name of the argument
        MemberExpression metaData = arg.Body as MemberExpression;
        if (metaData == null)
        {
            throw new ArgumentException("Unable to retrieve the name of the object being tested.", nameof(arg));
        }

        // can the data type be null at all
        string argName = metaData.Member.Name;
        Type type = typeof(T);
        if (type.IsValueType && Nullable.GetUnderlyingType(type) == null)
        {
            throw new ArgumentException("The expression does not specify a nullible type.", argName);
        }

        // get the value and check for null
        if (arg.Compile()() == null)
        {
            throw new ArgumentNullException(argName);
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-10-16T14:02:24.433

我非常同意@tvanfosson。除了他的回答之外，使用 .net 6 很容易抛出`ArgumentNullException`.

```
ArgumentNullException.ThrowIfNull(object); 
```

[这是](https://docs.microsoft.com/en-us/dotnet/api/system.argumentnullexception.throwifnull?view=net-6.0)官方文档。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-08-11T11:47:19.553

所有代码示例都使用容易出错的 IF 子句，其中一个使用 equal operator `==`。

如果类型覆盖会发生什么`==`？

在 C# 7 及更高版本上，使用常量模式匹配。

例子：

```
if (something is null) 
{
    throw new ArgumentNullException(nameof(something), "Can't be null.");
} 
```

# bash - Shell 脚本：出现任何错误都会死掉

> ID：368744
> 
> 赞同：38
> 
> 时间：2008-12-15T15:41:49.630
> 
> 标签：bash, shell, scripting

假设一个 shell 脚本（/bin/sh 或 /bin/bash）包含几个命令。如果任何命令的退出状态失败，我如何才能干净地使脚本终止？显然，可以使用 if 块和/或回调，但有没有一种更简洁、更简洁的方法？使用 && 也不是一个真正的选择，因为命令可能很长，或者脚本可能包含循环和条件等重要内容。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-15T15:43:34.200

使用标准`sh`and `bash`，您可以

```
set -e 
```

它会

```
$ help set
...
        -e  Exit immediately if a command exits with a non-zero status. 
```

它也适用于`zsh`. 它也应该适用于任何 Bourne shell 后代。

使用`csh`/ `tcsh`，您必须使用`#!/bin/csh -e`

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-08-03T14:06:42.420

也许你可以使用：

```
$ <any_command> || exit 1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-07T22:07:04.253

你可以检查$？看看最近的退出代码是什么..

例如

```
#!/bin/sh
# A Tidier approach

check_errs()
{
  # Function. Parameter 1 is the return code
  # Para. 2 is text to display on failure.
  if [ "${1}" -ne "0" ]; then
    echo "ERROR # ${1} : ${2}"
    # as a bonus, make our script exit with the right error code.
    exit ${1}
  fi
}

### main script starts here ###

grep "^${1}:" /etc/passwd > /dev/null 2>&1
check_errs $? "User ${1} not found in /etc/passwd"
USERNAME=`grep "^${1}:" /etc/passwd|cut -d":" -f1`
check_errs $? "Cut returned an error"
echo "USERNAME: $USERNAME"
check_errs $? "echo returned an error - very strange!" 
```

# java - 使用断言的一些（反）模式（Java 等）

> ID：368750
> 
> 赞同：14
> 
> 时间：2008-12-15T15:42:30.613
> 
> 标签：java, language-agnostic, assert

最后，我有一个关于 Stack Overflow 的问题要问！:-)

主要目标是 Java，但我相信它主要与语言无关：如果您没有本机断言，您总是可以模拟它。

我在一家销售一套用 Java 编写的软件的公司工作。代码很旧，至少可以追溯到 Java 1.3，并且在某些地方，它显示... 这是一个很大的代码库，大约 200 万行，所以我们不能一次全部重构。
最近，我们将最新版本从 Java 1.4 语法和 JVM 切换到 Java 1.6，保守地使用了一些新功能，例如`assert`（我们曾经使用 DEBUG.ASSERT 宏——我知道`assert`在 1.4 中已经引入但我们没有使用它之前）、泛型（仅类型化集合）、foreach 循环、枚举等。

尽管我已经阅读了几篇关于该主题的文章，但我对 assert 的使用仍然有些不满。然而，我看到的一些用法让我感到困惑，伤害了我的常识...... ^_^ 所以我想我应该问一些问题，看看我想要纠正的东西是否正确，或者它是否违反了惯例。我很罗嗦，所以我把问题**加粗**了，给那些喜欢略读的人。

作为参考，我在 SO中搜索了*assert java并发现了一些有趣的线程，但显然没有完全相同的重复。*

*   [如何避免 Java 中的“！= null”语句？](https://stackoverflow.com/questions/271526/how-to-avoid-null-statements-in-java "如何避免 Java 中的“！= null”语句？")[多少空检查就足够了](https://stackoverflow.com/questions/302736/how-much-null-checking-is-enough "多少空检查就足够了？")？非常相关，因为很多断言我们只是检查变量是否为空。在我们的代码中的某些地方，有空对象的用法（例如返回`new String[0]`），但并非总是如此。我们必须忍受这一点，至少为了维护遗留代码。
*   [在Java assertions underused](https://stackoverflow.com/questions/298909/java-assertions-underused "Java 断言未得到充分利用")中也有一些很好的答案。
*   哦，SO 有理由指出[我应该何时使用 Debug.Assert()？](https://stackoverflow.com/questions/129120/when-should-i-use-debugassert "什么时候应该使用 Debug.Assert()？")问题也相关（减少重复的好功能！）。

首先，主要问题，今天引发了我的问题：

```
SubDocument aSubDoc = documents.GetAt( i );
assert( aSubDoc != null );
if ( aSubDoc.GetType() == GIS_DOC )
{
   continue;
}
assert( aSubDoc.GetDoc() != null );
ContentsInfo ci = (ContentsInfo) aSubDoc.GetDoc(); 
```

（*是的，我们使用 MS 的 C/C++ 样式/代码约定。我什至喜欢它（来自相同的背景）！所以起诉我们。*）
首先，`assert()`表单来自`DEBUG.ASSERT()`调用的转换。我不喜欢多余的括号，因为 assert 是一种语言结构，而不是（不再是）函数调用。我也不喜欢`return (foo);`:-)
接下来，断言不在这里测试不变量，它们被用作防止错误值的保护。但据我了解，它们在这里毫无用处：断言将引发异常，甚至没有用伴随字符串记录，并且只有在启用断言的情况下。所以如果我们有`-ea`选项，我们只是抛出一个断言而不是常规的 NullPointerException 一个。这看起来并不是最重要的优势，因为无论如何我们都会在最高级别捕获未经检查的异常。
**我是否正确地假设我们可以摆脱它们并忍受它（即让 Java 引发这种不受约束的异常）？**（或者，当然，如果可能的话，测试空值，这是在其他地方完成的）。

旁注：如果我必须在上面的代码段中断言，我会针对 ci 值而不是针对 getter 执行此操作：即使大多数 getter 都经过优化/内联，我们也无法确定，因此我们应该避免调用它两次。

有人告诉，在最后一个引用的线程中，公共方法应该使用针对参数值的测试（公共 API 的使用），而私有方法应该依赖于断言。好建议。
现在，这两种方法都必须检查另一个数据源：外部输入。IE。例如，来自用户、数据库、某个文件或网络的数据。
在我们的代码中，我看到了针对这些值的断言。我总是将这些更改为真实测试，因此即使禁用断言它们也会起作用：这些不是不变的，必须正确处理。
我只看到一个可能的异常，其中输入应该是常量，例如一个数据库表，其中填充了关系中使用的常量：如果这个表被更改但相应的代码没有更新，程序会中断。
**您是否看到其他例外情况？**

我看到的另一个相对频繁的用法，看起来还不错：在开关的默认值中，或者在一系列 `else if`测试所有可能值的末尾（这些情况可以追溯到我们使用枚举之前！），通常有一个`assert false : "Unexpected value for stuff: " + stuff;`
**Looks legal for我（这些情况不应该在生产中发生），你怎么看？**（除了这里不相关的“不切换，使用 OO”建议之外）。

最后，我在这里错过了**任何其他有用的用例或烦人的陷阱吗？**（大概！）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-16T00:20:40.927

第一条规则是避免断言中的副作用。换句话说，代码在关闭断言时的行为应该与打开断言且未失败时的行为相同（显然，失败的断言将改变行为，因为它们会引发错误）。

第二条规则是不要将断言用于必要的检查。它们可以关闭（或者，更准确地说，不打开）。对于非私有方法的参数检查，请使用 IllegalArgumentException。

断言是可执行的假设。我使用断言来陈述我对程序当前状态的信念。例如，诸如*“我假设 n 在这里是正数”*或*“我假设列表在这里只有一个元素”之*类的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T16:16:50.043

我使用`assert`，不仅用于参数验证，还用于验证线程。每次我摇摆时，我几乎在每个方法中都写了断言来标记“我应该只在工作线程/AWTThread 中执行”。（我认为 Sun 应该为我们这样做。）由于 Swing 线程模型，如果您从非 UI 线程访问 swing api，它可能不会失败（并且随机失败）。没有断言很难找出所有这些问题。

我可以想象的另一个例子是检查 JAR 封闭的资源。您可以有英语例外而不是 NPE。

* * *

编辑：另一个例子；对象锁检查。如果我知道我将使用嵌套同步块，或者当我要修复死锁时，我会使用[Thread.holdLock(Object)](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html#holdsLock(java.lang.Object))来确保不会以相反的顺序获得锁。

* * *

编辑（2）：如果你很确定某些代码块永远不会到达，你可以写

```
throw new AssertionError("You dead"); 
```

而不是

```
assert false:"I am lucky"; 
```

例如，如果您在可变对象上覆盖“equals(Object)”，如果您认为它永远不会成为关键，则使用 AssertionError 覆盖 hashCode()。这种做法在一些书籍中有所建议。我不会损害性能（因为它永远不应该达到）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T15:58:47.413

您已经谈到了我认为通常应该避免断言的许多原因。除非您使用的代码库中断言的使用具有*非常*严格的指导方针，否则您很快就会陷入无法关闭断言的情况，在这种情况下，您还不如只使用正常的逻辑测试。

所以，我的建议是跳过断言。不要坚持额外的空指针检查语言会为你做的地方。但是，如果指针可能暂时不会被取消引用，那么预先进行空值检查是一个好主意。此外，对于“永远不会”发生的情况（最终的 if 分支或默认的 switch 情况），请*始终*使用真正的异常，不要使用“assert false”。如果您使用断言，则有可能有人可以将其关闭，如果情况确实发生，事情会变得非常混乱。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T15:59:02.840

我建议检查公共 (API) 方法中的参数，如果参数无效则抛出 IllegalArgumentException。这里没有断言，因为 API 用户需要获取正确的错误（消息）。

断言应在非公共方法中用于检查后置条件和可能的前置条件。例如：

```
List returnListOfSize(int size) {
    // complex list creation
    assert list.size == size;
} 
```

通常使用巧妙的错误处理策略可以规避断言。

# sql-server - 从命令行启动和停止 SQL Server 的最佳方式是什么？

> ID：368761
> 
> 赞同：8
> 
> 时间：2008-12-15T15:46:12.803
> 
> 标签：sql-server, command-line, powershell

我需要从命令行启动和停止 SQL Server。如有必要，我愿意编写一个小型 C# 程序，但我怀疑当前存在的某些东西（PowerShell，也许是？）可以优雅地完成此操作。

谢谢

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-15T15:48:50.287

`net {start|stop} mssqlserver`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-15T15:48:59.007

网络开始/停止

[http://technet.microsoft.com/en-us/library/cc736564.aspx](http://technet.microsoft.com/en-us/library/cc736564.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T18:58:26.537

或者，在 PowerShell 中，Stop-Service、Start-Service 或 Restart-Service。请注意，所有这些都必须在每个实例的基础上完成，就像这里的其他建议一样。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T15:49:51.253

[http://msdn.microsoft.com/en-us/library/ms187463.aspx](http://msdn.microsoft.com/en-us/library/ms187463.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-01-14T03:35:07.873

这是一个实际上包含一些额外信息的答案......并且更彻底地回答了这个问题。如果您有多个 SQL Server 实例怎么办？那么你需要知道NET START的扩展语法。您可以按名称启动服务，而不仅仅是通过服务名字对象（或任何 mssqlserver 示例）：

NET START "sql server (instancename)"

这也适用于其他服务。想要启动系统事件通知服务？

NET START“系统事件通知服务”

轰炸炸药！呵呵

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-11-15T14:29:47.207

要重新启动 SQL Server 和 SQL Server 代理，您可以创建一个名为 restartsql.bat 的批处理文件，其中包含以下命令，保存并在需要时运行它：

@ECHO OFF net stop "SQL Server Agent (MSSQLSERVER)" net stop MSSQLSERVER net start MSSQLSERVER net start "SQL Server Agent (MSSQLSERVER)"

享受！

# delphi - Delphi(2006) 循环帮助

> ID：368762
> 
> 赞同：1
> 
> 时间：2008-12-15T15:46:39.763
> 
> 标签：delphi, object, pascal

所以我基本上想要做的是让某件事在 70% 的时间发生，另外一些事情在每件事的 10% 的时间发生，如果这是有道理的，但我的应用程序似乎没有执行我猜测的任何操作我误解了循环语法或其他东西，无论如何，如果有人可以看一下，也许会给我一些建议

```
per1 := 70;
per2 := 77;
per3 := 84;
per4 := 91;
per5 := 100;
per6 := Random(2) + 1;
randomize;
RandPer:= Random(100);
randomize;
RandPer2 := Random(100);

 if RandPer2 <= 70 then begin
If RandPer <= per1 then begin
  Functiontest(1);
    end Else If RandPer <= per2 then begin
      Functiontest(3);
     end Else begin If RandPer <= per3 then begin
      Functiontest(5);
        end Else begin  If RandPer <= per4 then begin
        Functiontest(6);
          end Else begin If RandPer <= per5 then begin
          Functiontest(9);
          end;
         end;
        end;
      end; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T16:16:09.717

您没有任何循环语法，因此这肯定是您混淆的可能来源。

不要`Randomize`多次调用。每次您这样做时，它都会重新初始化随机种子，这是基于系统时钟的。如果您的代码运行速度快于时钟提前，那么您的几次调用`Randomize`实际上会将随机种子*重置*为之前的相同值，从而导致重复`Random`调用返回相同的值。

帮助建议您在程序开始时只调用`Randomize`一次。如果您正在编写一个单元或组件并且您不负责整个程序，那么根本不要调用`Randomize`。相反，记录您的代码的使用者应该自己调用它。

如果您正在编写 DLL 并且不使用运行时包，则调用`Randomize`DLL 导出的初始化函数；您的 DLL 的使用者将无法访问您的 DLL 的 Delphi 运行时库副本。

此外，如果您希望某事在 70% 的时间内发生，那么您应该检查您的值是否*严格小于*70。可能的返回值`Random`包括零；70% 的结果将介于 0 和 69 之间。允许 70 实际上会使事件在 71% 的时间内发生。

最后，你10%的时间计算对我来说没有意义。你有 7% 的时间会发生三件事，还有 9% 的时间会发生一件事。当你只剩下 30% 的时间时，你不可能有四个事件，每个事件都有 10% 的时间发生。您的意思是每个事件的频率都独立于其他事件进行测量吗？如果是这样，那么不要将所有条件测试与`else`;链接在一起。对每一个都使用完全单独的`if`语句。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T16:37:19.533

我刚刚修改了 CharlesF 代码来做你需要的。希望CharlesF不会介意。

```
begin
  randomize;
  for i := 0 to NumberOfTimesNeed do
  begin
    R :=  Random(100);
    case R of 
       0..69  : Functiontest(1); // this will fire 70% of NumberofTimes
       70..79 : Funciotntest(2); // 10 percent 
       80..89 : Funciotntest(3); // 10 percent 
       90..94 : Funciotntest(4); //  5 percent  
       // and so on ...
    end; 
end; 
```

# asp.net - 如何以编程方式将参数传递给 SSRS 报告

> ID：368766
> 
> 赞同：15
> 
> 时间：2008-12-15T15:47:31.930
> 
> 标签：asp.net, vb.net, reporting-services

我正在寻找一些关于通过 VB.NET 和 ASP.NET 以编程方式将参数传递给 SSRS 报告的帮助。这似乎应该是一件相对简单的事情，但我没有太多运气在这方面找到帮助。

有没有人有任何关于去哪里获得帮助的建议，或者甚至是一些示例代码？

谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-15T16:06:57.147

您可以执行以下操作：（它适用于本地报告，就像在 Full Blown SSRS 报告中一样。但在完整模式下，使用适当的类，参数部分保持不变）

```
LocalReport myReport = new LocalReport();
myReport.ReportPath = Server.MapPath("~/Path/To/Report.rdlc");

ReportParameter myParam = new ReportParameter("ParamName", "ParamValue");
myReport.SetParameters(new ReportParameter[] { myParam });

// more code here to render report 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-15T16:03:59.523

如果报表服务器可直接访问，则可以在使用 URL 访问报表时在查询字符串中传递参数：

[http://MyServer/ReportServer/?MyReport&rs:Command=Render&Param1=54321&Param2=product](http://MyServer/ReportServer/?MyReport&rs:Command=Render&Param1=54321&Param2=product)

您可以通过在 URL 末尾添加以下内容来添加输出格式：

&rs:格式=Excel

或者

&rs:格式=PDF

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-03T16:28:25.640

自从我编写此代码以来已经有一段时间了，但它可能会有所帮助：您的 Web 项目必须是一个网站，而不是“ASP.Net Web 应用程序”类型的项目，否则您将无法添加引用如以下所说的。右键单击该项目并添加一个 ASP.Net 文件夹 - App_WebReferences。您必须指定 SRS 所在的服务器；选择.asmx。添加后，该级别下的文件夹称为 RSService，在该文件夹下有 2 个内容：reportservice.discomap 和 .wsdl。在我的 VB 中，我执行 Imports RSService 和 Imports System.Web.Services.Protocols，然后...

```
Dim MyRS As New ReportingService 
```

报告服务与应用程序所在的网络服务器位于不同的服务器上，因此我无法执行以下操作：`MyRS.Credentials = System.Net.CredentialCache.DefaultCredentials`

相反： `MyRS.Credentials = New System.Net.NetworkCredential(rs1, rs2, rs3)`，其中 rs1/2/3 是 SRS 框的登录名、SRS 框的密码和域名”。（这些在我的 web.config 中加密。）

然后，大量粘贴：

```
MyRS.Credentials = New System.Net.NetworkCredential(rs1, rs2, rs3)

Dim ReportByteArray As Byte() = Nothing
Dim ReportPath As String = "/SRSSiteSubFolder/ReportNameWithoutRDLExtension"
Dim ReportFormat As String = "PDF"
Dim HistoryID As String = Nothing
Dim DevInfo As String = "<DeviceInfo><Toolbar>False</Toolbar></DeviceInfo>"
'Dim x As ReportParameter - not necessary
Dim ReportParams(0) As ParameterValue
ReportParams(0) = New ParameterValue()
ReportParams(0).Name = "TheParamName"
ReportParams(0).Value = WhateverValue

Dim Credentials As DataSourceCredentials() = Nothing
Dim ShowHideToggle As String = Nothing
Dim Encoding As String
Dim MimeType As String
Dim ReportHistoryParameters As ParameterValue() = Nothing
Dim Warnings As Warning() = Nothing
Dim StreamIDs As String() = Nothing
'Dim sh As New SessionHeader() - not necessary
''MyRS.SessionHeaderValue = sh - not necessary

ReportByteArray = MyRS.Render(ReportPath, ReportFormat, HistoryID, DevInfo, ReportParams, Credentials, _
    ShowHideToggle, Encoding, MimeType, ReportHistoryParameters, Warnings, StreamIDs)
'(Yay! That line was giving "HTTP error 401 - Unauthorized", until I set the credentials
' as above, as explained by http://www.odetocode.com/Articles/216.aspx.)

'Write the contents of the report to a PDF file:
Dim fs As FileStream = File.Create(FullReportPath, ReportByteArray.Length)
fs.Write(ReportByteArray, 0, ReportByteArray.Length)
fs.Close()

Call EmailTheReport(FullReportPath)

If IO.File.Exists(FullReportPath) Then
    IO.File.Delete(FullReportPath)
End If 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-29T13:24:10.983

```
ReportViewer1.LocalReport.DataSources.Clear();
ReportViewer1.Reset();
Label1.Visible = false;
ReportViewer1.Visible = true;
DataSet dataSet = new DataSet();
dataSet = new ClassBLL().Load_Report_Detail(TextBox1.Text, 
ddlType.SelectedValue, levelcode, fields);
ReportDataSource datasource = new ReportDataSource("DataSet_StoreprocedureName",
dataSet.Tables[0]);

if (dataSet.Tables[0].Rows.Count == 0)
{
    ReportViewer1.Visible = false;
}

ReportViewer1.LocalReport.ReportPath = Server.MapPath("") + @"\Report.rdlc";
ReportViewer1.LocalReport.DataSources.Clear();
ReportViewer1.LocalReport.DataSources.Add(datasource);
string fields="name,girish,Z0117";
string[] filedName = fields.Split(',');
ReportParameter[] param = new ReportParameter[2];

//for (int i = 0; i < filedName.Length; i++)
//{

param[0] = new ReportParameter(filedName[0], filedName[0], true);
param[1] = new ReportParameter(filedName[3], filedName[3], true);

// }

ReportViewer1.LocalReport.SetParameters(param);

ReportViewer1.ServerReport.Refresh(); 
```

# asp.net-mvc - 如何使用 MVC 控制器发布表单？

> ID：368771
> 
> 赞同：2
> 
> 时间：2008-12-15T15:48:41.427
> 
> 标签：asp.net-mvc

如何使用 ASP.NET MVC 控制器将表单发布到外部站点？

**编辑：**好的......我有一个关于它的一些数据的视图。用户完成表单后，我需要使用指定的表单格式回发到外部站点（例如贝宝）。发布构建的表单后，我需要将操作重定向到新视图

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T17:10:21.997

You have to do the POST on the server-side..

of which this guy has written a helper class to do [Http Post in C#](http://geekswithblogs.net/rakker/archive/2006/04/21/76044.aspx) ([pastebin-ed](http://pastebin.com/f15346568)). Check it out.

Send the post with the PostSubmitter class and just render your view normally.

Basically, in situation like this one would create a HttpWebRequest, set Method to post and write the post data to the request stream. But the linked code already does that for you in a nice and cozy way.

So no need rewire anything.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T15:52:51.777

您可以手动将表单标签中的操作设置为您要发布到的任何位置...

编辑 -

也就是说你应该手动创建表单标签..

代替：

```
<% using (Html.Form<Controller>("Action", c => c.Method())) { %> 
```

你应该使用：

```
<form action="http://www.someotherwebsite.com/action"> 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-09-05T16:02:16.507

如何向浏览器发送重定向。

# c# - 双胞胎异常之谜

> ID：368786
> 
> 赞同：1
> 
> 时间：2008-12-15T15:52:53.307
> 
> 标签：c#, .net

这是一个有趣的问题。我有一个尝试运行一些初始化代码的系统。如果失败，我们调用反初始化程序来清理所有内容。

因为我们在异常处理中调用了 deinitializer，所以我们冒着初始化和 deinitialize 都会失败的风险，假设现在看来我们必须抛出**两个**异常。

不过，我们似乎不太可能这样做。那么会发生什么，代码应该在这里做什么？

```
 try { /* init code here */ }        
      catch (Exception ex)
      {
         try
         {
            _DeinitializeEngine();
         }
         catch (Exception ex2)
         {
            throw new OCRException("Engine failed to initialize; ALSO failed to deinitialize engine!", ex2);
         }
         finally
         {
            throw new OCRException("Engine failed to initialize; failed to initialize license!", ex);
         }
      } 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T15:56:14.923

你不应该扔在 finally 块中。相反，使用 InnerException 在 throw 中添加信息。

## 更新

您需要做的是捕捉并重新抛出异常的“历史”，这是通过 InnerException 完成的。您可以在构建新异常时对其进行编辑。这是我刚刚编写的一个代码片段，用于说明我在下面所有评论中解释的想法。

```
 static void Main(string[] args)
    {
        try
        {
            principalMethod();
        }
        catch (Exception e)
        {
            Console.WriteLine("Test : " + e.Message);
        }
        Console.Read();
    }

    public static void principalMethod()
    {
        try
        {
            throw new Exception("Primary");
        }
        catch (Exception ex1)
        {
            try
            {
                methodThatCanCrash();
            }
            catch
            {
                throw new Exception("Cannot deinitialize", ex1);
            }
        }
    }

    private static void methodThatCanCrash()
    {
        throw new NotImplementedException();
    } 
```

无需在 finalize 中使用双掷。如果您在 Console.WriteLine(...) 处设置断点。您会注意到您拥有所有异常跟踪。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T16:29:27.570

如果我正确理解您的问题，我会这样做：

```
try { /* init code here */ }            
catch (Exception ex)
{
    // Passing original exception as inner exception
    Exception ocrex = new OCRException("Engine failed to initialize", ex);

    try
    {
        _DeinitializeEngine();
    }
    catch (Exception ex2)
    {
        // Passing initialization failure as inner exception
        ocrex = new OCRException("Failed to deinitialize engine!", ocrex);            
    }
    throw ocrex;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T16:32:28.593

如果您的清理代码失败并且您无法让应用程序处于干净且已知的状态，我会让异常未处理（或使用 UnhandledException 事件捕获它以记录它）然后关闭应用程序。

因为如果你不能处理第一个异常，那么捕获第二个异常有什么意义呢？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T18:35:19.703

您有两种可能的异常情况：一种是第一种方法失败，另一种是两种方法都失败。

您已经在定义自己的异常类。`RelatedException`因此，使用or`PriorException`属性创建另一个（或扩展第一个） 。当您在第二种情况下抛出异常时，请在此属性中保存对第一个异常的引用。

由捕获此异常的异常处理程序来确定如何处理第二个异常。

# xaml - Xaml FlowDocument 表 - 如何在多页表的每个页面上获取标题？

> ID：368789
> 
> 赞同：3
> 
> 时间：2008-12-15T15:54:19.123
> 
> 标签：xaml, flowdocument, xps

我有一个 XAML FlowDocument，其中包含一个包含很多行、跨越多个页面的表，并且我正在将此 FlowDocument 转换为 XPS。

现在我正在寻找一种在每一页上重复表格标题的方法。

我看到两种可能的方法：

1.  让表格自动打印每页上的标题。

2.  以某种方式通过程序找出页面可以容纳多少行，在那里停止表格，在下一页开始一个具有相同内容和标题的新表格。

到目前为止，我对这两种方法都没有运气。也许有人知道如何对 FlowDocument 表进行分页？

# c# - 动态图过滤

> ID：368790
> 
> 赞同：0
> 
> 时间：2008-12-15T15:54:20.963
> 
> 标签：c#, wpf, graphing

我正在处理 WPF 中的图表，在每个部分中都有数千个点要绘制。渲染此图的性能非常糟糕。

有没有人有任何使用过滤器的经验，它将用更少的点来表示图形 - 类似于股票图在缩小时绘制自身的方式。

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T16:59:44.700

当您谈论图表时，我假设您的意思是图表而不是大量节点和边（因此是股票示例）。

因此，假设是这种情况，这里有几个网页介绍了用于简化折线的算法：

[http://www.kevlindev.com/tutorials/geometry/simplify_polyline/page2.htm](http://www.kevlindev.com/tutorials/geometry/simplify_polyline/page2.htm)

[http://softsurfer.com/Archive/algorithm_0205/algorithm_0205.htm](http://softsurfer.com/Archive/algorithm_0205/algorithm_0205.htm)

您可以为各种比例生成简化的折线版本（按需）。

# java - 保护 MBean 操作

> ID：368792
> 
> 赞同：1
> 
> 时间：2008-12-15T15:55:01.680
> 
> 标签：java, security, jakarta-ee, jmx, mbeans

我有一些需要保护的 MBean 操作。我希望用户需要以服务器管理员身份登录，并且我希望在部署应用程序时以编程方式或最好通过 WAR 中的配置文件进行设置。我想避免要求管理员将其设置为部署步骤。

我们正在运行 glassfish，但首选平台中性。但是，glassfish 特定的配置文件会很好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-10T04:55:19.727

默认情况下，Sun JDK 允许您通过将凭据放入文件系统中来执行访问控制，该文件系统将位于您的 jar 之外。有关详细信息，请参阅[管理指南](http://java.sun.com/j2se/1.5.0/docs/guide/management/agent.html#PasswordAccessFiles)。

但是，由于您想从应用程序中控制事物，您可以使用 JAAS 将基于文件的配置替换为您自己的配置。有关详细信息，请参阅[com.sun.jmx.remote.security.JMXPluggableAuthenticator](http://www.java2s.com/Open-Source/Java-Document/6.0-JDK-Modules-com.sun/jmx/com/sun/jmx/remote/security/JMXPluggableAuthenticator.java.htm)上的 java 文档。

您可以以编程方式注入您自己的 JAAS 提供程序，然后根据需要管理身份验证详细信息。

# java - 如何从 JVM 外部调用对象中的方法？

> ID：368802
> 
> 赞同：2
> 
> 时间：2008-12-15T15:57:10.833
> 
> 标签：java, jvm, communication

我有一个非常简单的 Java 类，它通过输入验证有效地装饰了一个 Map，具有明显的 void set() 和 String get() 方法。

我希望能够有效地调用这些方法并处理来自 JVM 外部的返回值和异常，但仍然在同一台机器上**更新：我想到的调用者不是另一个 JVM；谢谢@戴夫雷**

我的实施考虑是典型的

*   表现
*   易于实施和维护（简单？）
*   可靠性
*   灵活性（即我可以从远程机器呼叫等）

有没有“正确的方法”？如果没有，我有什么选择，每种选择的优缺点是什么？

（人们实际上已经做过并且可以提供真实反馈的东西会很棒！）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T16:07:40.077

您是从另一个基于 JVM 的系统调用，还是客户端语言是任意的？如果您从另一个 JVM 调用，最简单的方法之一是通过 JMX 将您的对象公开为 MBean。[此处](http://java.sun.com/developer/technicalArticles/J2SE/jmx.html)显示了规范的 Hello World MBean 。优点是：

*   真的很容易实现
*   从其他 JVM 调用真的很容易
*   支持远程机器
*   jconsole 允许您在不编写客户端的情况下手动测试您的 MBean

缺点：

*   客户端必须在 JVM 上（我认为）
*   对于更复杂的数据结构和交互来说不是很好。例如，我认为 MBean 不能返回对另一个 MBean 的引用。它将序列化并返回一个副本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T19:03:30.770

行。现在我知道客户端不是 Java，这是另一个尝试。由于您想要进程外访问和可能的远程机器访问，我认为 JNI 不是您想要的，因为这完全是进程内的（而且很麻烦）。以下是一些其他选项：

**原始套接字**：只需在 Java 中设置一个侦听器套接字并接受连接。当您获得连接时，请阅读请求并发送回响应。几乎每种语言都可以使用套接字，因此这是一个非常通用的解决方案。但是，您必须定义自己的编组方案、解析等。

**[XML-RPC](http://www.xmlrpc.com/)**：现在这并不时髦，但它简单而有效。有[Java 库](http://ws.apache.org/xmlrpc/)以及大多数其他语言的库。

**CORBA**：如上所述，CORBA 是一种选择，但它相当复杂，而且越来越难找到专家。

**Web 服务器**：在您的应用程序中设置嵌入式 Web 服务器并处理请求。我听说过有关[Jetty](http://www.mortbay.org/jetty/)的好消息，或者您可以使用[Java 提供的](http://java.sun.com/javase/6/docs/jre/api/net/httpserver/spec/com/sun/net/httpserver/package-summary.html)。我已经成功地使用后者将 KML 文件从用 Java 编写的模拟服务器发送到 Google 地球。大多数其他语言都有用于发出 HTTP 请求的库。如何编码数据（XML、文本等）取决于您。

**Web 服务**：我认为这会更复杂，但您可以使用[JAX-WS](https://jax-ws.dev.java.net/)将对象公开为 Web 服务。NetBeans 有非常好的构建 Web 服务的工具，但这可能有点过头了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T16:25:31.290

由于您的调用者不是 Java 应用程序，并且您已经预见到网络调用者，[RMI-IIOP (CORBA)](http://en.wikipedia.org/wiki/RMI-IIOP)可能是一种选择。虽然它绝对不容易实现，但它的优势是成为一个被广泛认可的标准。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T16:30:22.060

由于您的调用者不是基于 JVM 的，因此这是与 JVM 的进程间通信问题。我想到的选项是：

1.  通过套接字进行通信：让你的 JVM 监听传入的连接和调用者发送命令
2.  使用共享文件进行通信（调用者写入文件、JVM 轮询和更新）
3.  使用 JNI，在调用者进程中启动 JVM，然后使用 RMI/MBeans 与第一个（“服务器”）JVM 通信。调用者将可以使用 JNI 访问结果

选项 3 IMO 是执行此操作的最“Java”方式，并且是最复杂/最容易出错的。选项 2 丑陋但简单 选项 1 比较简单（java 部分），否则没问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T16:33:08.780

为了便于使用，我会使用[Spring Remoting](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html)。如果你已经在你的项目中使用 Spring，那是没有道理的。如果你不是......好吧，无论如何你应该看看。

Spring 提供了一种抽象，允许您轻松切换远程协议。它支持最广泛部署的协议（SOAP、Hessian、Burlap、RMI，...）。如果您从非 Java 代码调用，[Hessian](http://hessian.caucho.com/)支持许多其他语言，已知它比 SOAP 更有效，比 CORBA 更容易。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-08T22:55:52.343

Beanshell 是一个类似于 shell 的 java 解释器，可以通过网络套接字公开。基本上你是从java做的：

```
i = new bsh.Interpreter();
i.set( "myapp", this );  // Provide a reference to your app
i.eval("server(7000)"); 
```

然后你从其他任何地方执行此操作：

```
telnet localhost 7001
myapp.someMethod(); 
```

这个小实用程序比 JNI 或 RMI 更容易进行远程 Java 调用。

更多信息，请访问：[http ://www.beanshell.org/manual/remotemode.html](http://www.beanshell.org/manual/remotemode.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T16:18:44.563

JNI（Java Native Interface）允许从 C 或 C++ 访问 java 代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T16:23:48.593

我有一个 Inno Setup 脚本（安装 Java 程序），它调用一些 Java 方法来执行一些操作或检查一些条件。
我（实际上是我的前任）只是在每次调用时实例化 java.exe。显然，这很昂贵，尽管在我的情况下并不重要（我想 Windows 缓存会启动）。

另一种方法是使用一些跨语言通信/消息传递，您的 Java 程序充当服务器。Corba 浮现在脑海中，因为它与语言无关。但也许有点重。您可以使用套接字。RPC 也是另一个流行词，但我在该领域没有太多经验。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-15T16:38:03.573

您想要的是 Java 本机接口 (JNI)，尽管它可能存在困难。没有其他同等技术可以如此容易实施。

正如前面答案的评论中所提到的，JNI 已针对从 Java 调用本机代码进行了优化，但它也可以用于反向操作，但需要做一些工作。在您的本机代码中，您需要实现 JNI 入口点——类似于 SetMapPointer()——然后在构建 Map 后从 Java 代码中调用该函数。SetMapPointer() 的实现应该将 Java 对象指针保存在某个可访问的地方，然后本机代码可以根据需要在其上调用 Java 方法。

您需要确保这以正确的顺序发生（即本机代码在构建并传递给本机代码之前不会尝试访问地图），但这不应该是一个特别困难的问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-15T21:32:42.997

如果另一个进程将在同一台机器上并且操作系统是否符合 POSIX（不是 Windows），另一个需要考虑的替代方法是命名管道。

外部进程将操作作为字符串或其他约定的字节编码写入命名管道，而 Java 应用程序正在从管道读取，解析传入的操作并针对您的对象执行它们。

这与您用于套接字连接的策略相同，只是您将从附加到命名管道的 FileInputStream 中读取而不是使用 SocketInputStream。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-27T19:54:29.757

CORBA 的替代品是**[ICE](http://www.zeroc.com)**，除非许可证有问题（它是 GPL，但您也可以购买商业许可证）。

它几乎具有 CORBA 的所有优点，但供应商 ZeroC 为许多不同的语言提供绑定。CORBA 供应商往往只提供一种或两种语言绑定，然后您就会开始发现兼容性问题。

文档也很棒。我不会说它特别容易上手，但可能比 CORBA 更容易。

否则，我认为没有提到的另一个选项是 Cisco 开发的新中间件/RPC 框架，现在捐赠给 Apache，称为**[Etch](http://cwiki.apache.org/ETCH/)**。不过它仍然很新，而且文档很少。

# visual-studio - 如何在 Visual Studio 的硬盘上找到解决方案/项目的位置？

> ID：368803
> 
> 赞同：-1
> 
> 时间：2008-12-15T15:57:11.300
> 
> 标签：visual-studio

我想知道解决方案/项目存储在我的硬盘上的什么位置。

我原以为在 Visual Studio 中右键单击该项目会获得有关它在我的硬盘驱动器上的存储位置的信息，但事实并非如此。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T15:59:39.987

在解决方案资源管理器中单击项目本身，然后在属性窗口中列出项目文件夹。

仅当您实际保存了项目时才有效。即新创建的项目没有位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T15:59:14.870

一种方法是在解决方案资源管理器中选择项目，然后单击文件/另存为或按 F4 并查看“项目文件夹”属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T15:59:58.580

启动 Visual Studio 并转到工具->选项。

在打开的对话框中，确保选中显示“显示所有设置”的框。

从那里，您应该找到一个名为“项目和解决方案”的设置，其中包含项目、模板等的默认位置列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T16:00:11.043

在 Visual Studio 中加载项目后，在解决方案资源管理器窗口中选择解决方案，然后选择属性窗口。您将在“属性”窗口中看到指向实际文件的“路径”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T16:00:26.443

打开解决方案中的一个文件，然后将鼠标悬停在代码窗口中的选项卡上。完整路径将显示在工具提示中。

您也可以前往**窗口 | Windows...**显示所有打开文件的完整路径。

# python - Python UnicodeDecodeError - 我误解了编码吗？

> ID：368805
> 
> 赞同：56
> 
> 时间：2008-12-15T15:57:24.187
> 
> 标签：python, unicode, ascii, encode

关于为什么这不起作用的任何想法？我真的认为“忽略”会做正确的事。

```
>>> 'add \x93Monitoring\x93 to list '.encode('latin-1','ignore')
Traceback (most recent call last):
  File "<interactive input>", line 1, in ?
UnicodeDecodeError: 'ascii' codec can't decode byte 0x93 in position 4: ordinal not in range(128) 
```

* * *

## 回答 #1

> 赞同：214
> 
> 时间：2008-12-16T00:45:11.670

…它们被称为“编码”是有原因的…</p>

一点前言：将 unicode 视为规范或理想状态。Unicode 只是一个字符表。№65 是拉丁文大写 A。№937 是希腊大写 omega。只是。

为了让计算机存储和/或操作 Unicode，它必须将其*编码*为字节。Unicode最直接的*编码*是 UCS-4；每个字符占用 4 个字节，所有 ~1000000 个字符都可用。这 4 个字节包含 Unicode 表中字符的编号，作为 4 字节整数。另一种非常有用的编码是 UTF-8，它可以将任何 Unicode 字符编码为一到四个字节。但也有一些有限的编码，如“latin1”，其中包含非常有限的字符范围，主要由西方国家使用。这样的*编码*每个字符只使用一个字节。

基本上，Unicode 可以用多种*编码*方式进行编码，编码后的字符串可以*解码*为 Unicode。*问题是，Unicode 来得太晚了，所以我们所有使用 8 位字符集*长大的人都太晚了，因为我们一直在使用*编码*字符串。编码可以是 ISO8859-1，或 windows CP437，或 CP850，或，或，或，取决于我们的系统默认值。

因此，当您在源代码中输入字符串“add “Monitoring” to list”（我认为您想要字符串“add “Monitoring” to list”时，请注意第二个引号），实际上您已经使用了一个字符串根据您系统的默认代码页*编码（按字节 \x93 我假设您使用 Windows 代码页 1252，“Western”）。*如果要从中获取 Unicode，则需要从“cp1252”编码中*解码*字符串。

所以，你的意思是：

```
"add \x93Monitoring\x94 to list".decode("cp1252", "ignore") 
```

不幸的是，Python 2.x 也包含了一个`.encode`字符串方法。这是“特殊”编码的便利功能，例如“zip”或“rot13”或“base64”编码，它们与 Unicode 无关。

无论如何，对于来回 Unicode 转换，您只需要记住：

*   一个 Unicode 字符串被*编码*为一个 Python 2.x 字符串（实际上是一个字节序列）
*   Python 2.x 字符串被*解码*为 Unicode 字符串

在这两种情况下，您都需要指定将使用的*编码*。

我不是很清楚，我很困，但我当然希望我能帮上忙。

PS 一个幽默的旁注：玛雅人没有 Unicode；古罗马人、古希腊人、古埃及人也没有。他们都有自己的“编码”，几乎不尊重其他文化。所有这些文明都化为灰烬。想想吧人！为了人类的利益，让您的应用程序支持 Unicode。:)

PS2 请不要说“但是中国人……”来破坏之前的信息。但是，如果您倾向于或有义务这样做，请考虑到 Unicode BMP 主要由中文表意文字填充，因此延迟它，因此中文是 Unicode 的基础。只要人们开发支持 Unicode 的应用程序，我就可以继续编造令人发指的谎言。干杯!

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T16:02:02.617

encode 可用于 unicode 字符串，但您拥有的字符串似乎不是 unicode（尝试使用 u'add \x93Monitoring\x93 to list '）

```
>>> u'add \x93Monitoring\x93 to list '.encode('latin-1','ignore')
'add \x93Monitoring\x93 to list ' 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2020-07-01T08:11:13.613

神奇的线是：

```
unicodedata.normalize('NFKD', text).encode('utf-8', 'ignore') 
```

在最需要时不会引发异常的一种衬里（删除错误的 Unicode 字符......）

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-12-15T16:10:11.413

这似乎有效：

```
'add \x93Monitoring\x93 to list '.decode('latin-1').encode('latin-1') 
```

有什么问题吗？我想知道“忽略”、“替换”和其他此类编码错误处理何时出现？

# class - 没有成员数据的类

> ID：368806
> 
> 赞同：2
> 
> 时间：2008-12-15T15:57:26.230
> 
> 标签：class

你如何处理没有成员数据，只有方法的类？

你让它们静态吗？

在我的例子中，它是一个对数据库执行查询的存储库类。也许我弄错了存储库模式......（它确实实现了一个接口）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T16:03:14.253

从接口继承意味着您不能使用静态。只需创建一个类并实例化它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T16:01:15.693

*如果它实现了一个接口，并作为*该接口传递，那么你不能使成员（或类）静态。接口方面意味着虽然一个实例没有任何实际字段，但它仍然包含有价值的信息——它的类型。

你*可能*想让它成为一个单例，但没有特别需要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T16:07:58.673

您为什么不创建一个数据库包装类，以维护与打开/关闭的数据库的连接。此外，如果发送新查询，它也可以自动打开它。您可以包含您的类具有的函数，在指向数据库的内部指针上运行它们。

我想这是最好的数据库管理模式。如果您使用它，您应该创建一个工厂方法，该方法返回在某个特定数据库上初始化的此类的对象。然后你传递那个对象。

或者，如果您很懒惰并确定您只需要 1 个数据库，请将其设为单例。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-15T16:01:11.730

这取决于。大多数情况下，可以将类设为静态，但有时您需要传递它的一个实例。听起来你可能有这种情况。在这种情况下，也许您应该考虑使用单例模式，因为可能不需要超过 1 个类的实例？

# jquery - Internet Explorer 中的 jquery show()/hide() 问题？

> ID：368807
> 
> 赞同：8
> 
> 时间：2008-12-15T15:57:37.557
> 
> 标签：jquery, internet-explorer

以下 html 代码在 Firefox 中有效，但由于某种原因在 IE 中失败（未显示 Label2）。这是一个错误还是我错过了什么？

任何帮助，将不胜感激。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <script src="http://jqueryjs.googlecode.com/files/jquery-1.2.6.min.js" type="text/javascript">
        </script>
        <script>
            jQuery(document).ready(function(){
                function setVis(){
                    var val = $("#check").is(":checked");
                    if (val) 
                        $("#g_1").show();
                    else 
                        $("#g_1").hide();
                }

                setVis();
                $("#check").change(setVis);
            });
        </script>
    </head>
    <body>
        <span>
            <input type="checkbox" id="check" />
            <label>Label1</label>
        </span>
        <span id="g_1">
            <label>Label2</label>
        </span>
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-15T16:22:38.800

### 原因：

根据 MSDN，[更改事件](http://msdn.microsoft.com/en-us/library/ms536912(VS.85).aspx)是

> ...在提交内容时触发，而不是在值更改时触发。例如，在文本框上，不会在用户键入时触发此事件，而是在用户通过离开具有焦点的文本框提交更改时触发。

复选框的行为是相似的：在 IE 中，事件不会触发，直到焦点从元素中移除（尝试一下：单击复选框然后关闭复选框，行为与预期一致）。Firefox 显然不尊重这种区别。

### 解决方案：

使用`click`事件处理程序而不是`change`：

```
 $("#check").click(setVis); 
```

...并且行为应该在浏览器之间保持一致。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-15T16:09:28.063

请记住，**在您选中复选框然后离开复选框后**会触发 onchange 事件。您是否尝试检查它，然后单击文档上的其他位置？

您可能希望在 jQuery 中使用**click**和 keypress 事件（通过点击和空格键检查框）。

`<sidequestion>`你有什么理由在你的文档准备段落中声明/定义一个函数，而不是在它之外？`</sidequestion>`

再编辑一次；我可以推荐这个更时尚的代码：

```
jQuery(document).ready(function(){
    $("#g_1").hide();
    $("#check").change(function() { $("#g_1").toggle(); });
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T16:29:40.737

将 .change 事件更改为 .click 事件。两个浏览器的结果是一样的。在 IE 中单击复选框时，没有发生模糊。

# xslt - xsl分组排序问题

> ID：368808
> 
> 赞同：2
> 
> 时间：2008-12-15T15:57:43.950
> 
> 标签：xslt, sorting, variables, grouping

我有以下 xsl 模板，用于对我的 xsl 进行分组。我遇到的问题是我需要将@Title 大写，因为目前我的分组将大写和小写视为单独的组。

```
 <xsl:key name="rows-by-title" match="Row" use="substring(@Title,1,1)" />

    <xsl:template name="Meunchian" match="/dsQueryResponse/Rows">

            <xsl:for-each select="Row[count(. | key('rows-by-title', substring(@Title,1,1))[1]) = 1]">

                <xsl:sort select="substring(@Title,1,1)" />

                <p></p><xsl:value-of select="substring(@Title,1,1)" /><br />
                    <xsl:for-each select="key('rows-by-title', substring(@Title,1,1))">
                        <xsl:value-of select="@Title" /><br/>
                    </xsl:for-each>

            </xsl:for-each>

    </xsl:template> 
```

我尝试使用 call-template 并设置一个变量，但 xsl 似乎不喜欢这样：

```
 <xsl:key name="rows-by-title" match="Row" use="substring(@Title,1,1)" />

    <xsl:template name="Meunchian" match="/dsQueryResponse/Rows">

            <xsl:for-each select="Row[count(. | key('rows-by-title', substring(@Title,1,1))[1]) = 1]">

    <xsl:variable name="myTitle">

          <xsl:call-template name="to-upper">
            <xsl:with-param name="text">
                <xsl:value-of select="@Title"/>
            </xsl:with-param>
          </xsl:call-template>

    </xsl:variable> 
```

```
 <p></p><xsl:value-of select="$myTitle" /><br />
                    <xsl:for-each select="key('rows-by-title', substring(@Title,1,1))">
                        <xsl:value-of select="@Title" /><br/>
                    </xsl:for-each>

            </xsl:for-each>

    </xsl:template> 
```

我想要实现的是 meunchian 分组，但不区分大小写 - 希望这有意义！

基兰

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T05:22:11.260

**将小写字母转换为大写字母的方法是使用[XPath translate() 函数](http://www.w3.org/TR/xpath#function-translate)**。

使用它，表达所需转换的一种方法如下：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output method="xml"/>

 <xsl:variable name="vLower" select=
  "'abcdefghijklmnopqrstuvwxyz'"
  />

 <xsl:variable name="vUpper" select=
  "'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"
  />

 <xsl:key name="rows-by-title" match="Row" use=
 "translate(substring(@Title,1,1),
            'abcdefghijklmnopqrstuvwxyz',
            'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
            )" />

    <xsl:template match="/">
     <html>
      <xsl:apply-templates select="*/*"/>
     </html>
    </xsl:template>

    <xsl:template name="Meunchian" match="/dsQueryResponse/Rows">
        <xsl:for-each select=
          "Row[generate-id()
              =
               generate-id(key('rows-by-title',
                                translate(substring(@Title,1,1),
                                          $vLower,
                                          $vUpper)
                                )[1]
                       )
               ]">
            <xsl:sort select="translate(substring(@Title,1,1),
                                              $vLower,
                                              $vUpper)" />
            <p></p>
            <xsl:value-of select="translate(substring(@Title,1,1),
                                                  $vLower,
                                                  $vUpper)" />
            <br />
            <xsl:for-each select=
                             "key('rows-by-title', 
                                   translate(substring(@Title,1,1),
                                     $vLower,
                                     $vUpper)">

                <xsl:value-of select="@Title" />
                <br/>
            </xsl:for-each>
        </xsl:for-each>
    </xsl:template>
</xsl:stylesheet> 
```

**应用于以下 XML 文档时**：

```
<dsQueryResponse>
    <Rows>
        <Row Title="Agenda" />
        <Row Title="Policy" />
        <Row Title="policy" />
        <Row Title="Report" />
        <Row Title="report" />
        <Row Title="Test2" />
        <Row Title="test1" />
        <Row Title="Boo" />
        <Row Title="foo" />
    </Rows>
</dsQueryResponse> 
```

**它产生了预期的结果**：

```
<html>
    <p/>A
    <br/>Agenda
    <br/>
    <p/>B
    <br/>Boo
    <br/>
    <p/>F
    <br/>foo
    <br/>
    <p/>P
    <br/>Policy
    <br/>policy
    <br/>
    <p/>R
    <br/>Report
    <br/>report
    <br/>
    <p/>T
    <br/>Test2
    <br/>test1
    <br/>
</html> 
```

**在 XPath 2.0 中，将使用[`upper-case`](http://www.w3.org/TR/xpath-functions/#func-upper-case)() 函数**将小写字母转换为大写字母。

此外，使用 **指令****可以更好地表达 XSLT 2.0 中的分组[`<xsl:for-each-group>`](http://www.w3.org/TR/xslt20/#xsl-for-each-group)**。

# javascript - HTML 表单只读 SELECT 标记/输入

> ID：368813
> 
> 赞同：692
> 
> 时间：2008-12-15T15:59:09.987
> 
> 标签：javascript, html

根据 HTML 规范，`select`HTML 中的标签没有`readonly`属性，只有`disabled`属性。因此，如果您想阻止用户更改下拉菜单，则必须使用`disabled`.

唯一的问题是禁用的 HTML 表单输入不会包含在 POST / GET 数据中。

模拟标签`readonly`属性`select`并仍然获取 POST 数据的最佳方法是什么？

* * *

## 回答 #1

> 赞同：515
> 
> 时间：2008-12-15T16:03:17.060

您应该保留该`select`元素`disabled`，但还要添加另一个`input`具有相同名称和值的隐藏元素。

如果重新启用 SELECT，则应将其值复制到 onchange 事件中的隐藏输入并禁用（或删除）隐藏输入。

这是一个演示：

```
$('#mainform').submit(function() {
    $('#formdata_container').show();
    $('#formdata').html($(this).serialize());
    return false;
});

$('#enableselect').click(function() {
    $('#mainform input[name=animal]')
        .attr("disabled", true);

    $('#animal-select')
        .attr('disabled', false)
    	.attr('name', 'animal');

    $('#enableselect').hide();
    return false;
});
```

```
#formdata_container {
    padding: 10px;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<div>
    <form id="mainform">
        <select id="animal-select" disabled="true">
            <option value="cat" selected>Cat</option>
            <option value="dog">Dog</option>
            <option value="hamster">Hamster</option>
        </select>
        <input type="hidden" name="animal" value="cat"/>
        <button id="enableselect">Enable</button>

        <select name="color">
            <option value="blue" selected>Blue</option>
            <option value="green">Green</option>
            <option value="red">Red</option>
        </select>

        <input type="submit"/>
    </form>
</div>

<div id="formdata_container" style="display:none">
    <div>Submitted data:</div>
    <div id="formdata">
    </div>
</div>
```

* * *

## 回答 #2

> 赞同：241
> 
> 时间：2014-05-02T13:03:38.640

我们还可以禁用除选定选项之外的所有选项。

这样下拉菜单仍然有效（并提交其值），但用户无法选择另一个值。

[演示](http://jsfiddle.net/ret7mhfa/)

```
<select>
    <option disabled>1</option>
    <option selected>2</option>
    <option disabled>3</option>
</select>
```

* * *

## 回答 #3

> 赞同：117
> 
> 时间：2008-12-15T16:00:27.283

您可以在提交时重新启用选择对象。

**编辑**：即，通常禁用选择标签（使用 disabled 属性），然后在提交表单之前自动重新启用它：

jQuery 示例：

*   要禁用它：

    ```
    $('#yourSelect').prop('disabled', true); 
    ```

*   要在提交之前重新启用它，以便包含 GET / POST 数据：

    ```
    $('#yourForm').on('submit', function() {
        $('#yourSelect').prop('disabled', false);
    }); 
    ```

此外，您可以重新启用每个禁用的输入或选择：

```
$('#yourForm').on('submit', function() {
    $('input, select').prop('disabled', false);
}); 
```

* * *

## 回答 #4

> 赞同：65
> 
> 时间：2014-08-15T05:32:48.613

`readOnly`对元素执行属性的另一种方法`select`是使用`css`

你可以这样做：

```
$('#selection').css('pointer-events','none'); 
```

[**演示**](http://jsfiddle.net/be1mgdh0/)

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2012-05-11T23:55:47.840

简单的 jQuery 解决方案

如果您的选择有`readonly`课程，请使用此选项

```
jQuery('select.readonly option:not(:selected)').attr('disabled',true); 
```

或者，如果您的选择具有`readonly="readonly"`属性

```
$('select[readonly="readonly"] option:not(:selected)').attr('disabled',true); 
```

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2008-12-15T16:04:53.033

```
<select id="countries" onfocus="this.defaultIndex=this.selectedIndex;" onchange="this.selectedIndex=this.defaultIndex;">
<option value="1">Country1</option>
<option value="2">Country2</option>
<option value="3">Country3</option>
<option value="4">Country4</option>
<option value="5">Country5</option>
<option value="6">Country6</option>
<option value="7" selected="selected">Country7</option>
<option value="8">Country8</option>
<option value="9">Country9</option>
</select> 
```

在 IE 6、7 和 8b2、Firefox 2 和 3、Opera 9.62、Safari 3.2.1 for Windows 和 Google Chrome 中测试和工作。

* * *

## 回答 #7

> 赞同：32
> 
> 时间：2016-09-06T14:17:08.483

我知道为时已晚，但可以使用简单的 CSS 来完成：

```
select[readonly] option, select[readonly] optgroup {
    display: none;
} 
```

The style hides all the options and the groups when the select is in `readonly`state, so the user can not change his selection.

不需要 JavaScript hack。

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2014-08-07T16:07:18.527

简单的 CSS 解决方案：

```
select[readonly]{
    background: #eee;
    cursor:no-drop;
}

select[readonly] option{
    display:none;
} 
```

这导致选择为灰色，悬停时带有漂亮的“禁用”光标，
选择选项列表为“空”，因此您无法更改其值。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2012-02-23T10:01:55.830

另一个更现代的选项（不是双关语）是禁用选择元素的所有选项，而不是所选元素。

但是请注意，这是 HTML 4.0 功能，即 6、7、8 beta 1 似乎不尊重这一点。

[http://www.gtalbot.org/BrowserBugsSection/MSIE7Bugs/OptionDisabledSupport.html](http://www.gtalbot.org/BrowserBugsSection/MSIE7Bugs/OptionDisabledSupport.html)

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2014-08-27T22:06:30.737

这是我找到的最佳解决方案：

```
$("#YourSELECTIdHere option:not(:selected)").prop("disabled", true); 
```

上面的代码***禁用***所有其他未选中的选项，同时保持选中的选项处于启用状态。这样做，选定的选项将使其成为回发数据。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2017-02-16T07:13:01.933

更简单：将样式属性添加到您的**选择**标签：

```
style="pointer-events: none;" 
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2020-07-27T09:34:22.147

派对有点晚了。但这对我来说似乎完美无缺

```
select[readonly] {
    pointer-events:none;
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-07-04T11:01:12.760

除了禁用不应该选择的选项之外，我还想让它们从列表中消失，但如果我以后需要，仍然可以启用它们：

```
$("select[readonly]").find("option:not(:selected)").hide().attr("disabled",true); 
```

这会找到所有具有 readonly 属性的选择元素，然后在那些未选择的选择中找到所有选项，然后隐藏它们并禁用它们。

出于性能原因将jquery查询分开2很重要，因为jquery从右到左读取它们，代码：

```
$("select[readonly] option:not(:selected)") 
```

将首先在文档中查找所有未选择的选项，然后使用 readonly 属性过滤选择中的选项。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2014-11-13T19:08:23.383

这是最简单和最好的解决方案。您将在您的选择上设置一个 readolny 属性，或任何其他属性，如 data-readonly，并执行以下操作

```
$("select[readonly]").live("focus mousedown mouseup click",function(e){
    e.preventDefault();
    e.stopPropagation();
}); 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2011-05-24T05:52:38.190

当您计划将选择禁用时设置为只读，然后在提交表单之前删除禁用属性。

```
// global variable to store original event/handler for save button
var form_save_button_func = null;

// function to get jQuery object for save button
function get_form_button_by_id(button_id) {
    return jQuery("input[type=button]#"+button_id);
}

// alter value of disabled element
function set_disabled_elem_value(elem_id, value)  {
    jQuery("#"+elem_id).removeAttr("disabled");
    jQuery("#"+elem_id).val(value);
    jQuery("#"+elem_id).attr('disabled','disabled');
}

function set_form_bottom_button_save_custom_code_generic(msg) {
    // save original event/handler that was either declared
    // through javascript or html onclick attribute
    // in a global variable
    form_save_button_func = get_form_button_by_id('BtnSave').prop('onclick'); // jQuery 1.6
    //form_save_button_func = get_form_button_by_id('BtnSave').prop('onclick'); // jQuery 1.7

    // unbind original event/handler (can use any of following statements below)
    get_form_button_by_value('BtnSave').unbind('click');
    get_form_button_by_value('BtnSave').removeAttr('onclick');

    // alternate save code which also calls original event/handler stored in global variable
    get_form_button_by_value('BtnSave').click(function(event){
        event.preventDefault();
        var confirm_result = confirm(msg);
        if (confirm_result) {
            if (jQuery("form.anyForm").find('input[type=text], textarea, select').filter(".disabled-form-elem").length > 0) {
                jQuery("form.anyForm").find('input[type=text], textarea, select').filter(".disabled-form-elem").removeAttr("disabled");
            }

            // disallow further editing of fields once save operation is underway
            // by making them readonly
            // you can also disallow form editing by showing a large transparent
            // div over form such as loading animation with "Saving" message text
            jQuery("form.anyForm").find('input[type=text], textarea, select').attr('ReadOnly','True');

            // now execute original event/handler
            form_save_button_func();
        }
    });
}

$(document).ready(function() {
    // if you want to define save button code in javascript then define it now

    // code below for record update
    set_form_bottom_button_save_custom_code_generic("Do you really want to update this record?");
    // code below for new record
    //set_form_bottom_button_save_custom_code_generic("Do you really want to create this new record?");

    // start disabling elements on form load by also adding a class to identify disabled elements
    jQuery("input[type=text]#phone").addClass('disabled-form-elem').attr('disabled','disabled');
    jQuery("input[type=text]#fax").addClass('disabled-form-elem').attr('disabled','disabled');
    jQuery("select#country").addClass('disabled-form-elem').attr('disabled','disabled');
    jQuery("textarea#address").addClass('disabled-form-elem').attr('disabled','disabled');

    set_disabled_elem_value('phone', '123121231');
    set_disabled_elem_value('fax', '123123123');
    set_disabled_elem_value('country', 'Pakistan');
    set_disabled_elem_value('address', 'address');

}); // end of $(document).ready function 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2014-01-17T11:46:15.320

如果您禁用表单字段，则在提交表单时不会发送该字段。因此，如果您需要一个`readonly`类似`disabled`但发送值的方法，请执行以下操作：

在元素的只读属性发生任何更改之后。

```
$('select.readonly option:not(:selected)').attr('disabled',true);

$('select:not([readonly]) option').removeAttr('disabled'); 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2018-04-18T15:59:30.707

**使用 tabindex 的解决方案。**适用于选择但也适用于文本输入。

只需使用 .disabled 类。

CSS：

```
.disabled {
    pointer-events:none; /* No cursor */
    background-color: #eee; /* Gray background */
} 
```

JS：

```
$(".disabled").attr("tabindex", "-1"); 
```

HTML：

```
<select class="disabled">
    <option value="0">0</option>
</select>

<input type="text" class="disabled" /> 
```

* * *

编辑：使用 Internet Explorer，您还需要这个 JS：

```
$(document).on("mousedown", ".disabled", function (e) {
    e.preventDefault();
}); 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2013-03-29T20:06:18.663

一种简单的服务器端方法是删除除您要选择的选项之外的所有选项。因此，在 Zend Framework 1.12 中，如果 $element 是 Zend_Form_Element_Select：

```
 $value =  $element->getValue();
 $options = $element->getAttrib('options');
 $sole_option = array($value => $options[$value]);
 $element->setAttrib('options', $sole_option); 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2010-01-19T23:01:13.357

遵循格兰特瓦格纳的建议；这是一个使用处理函数而不是直接 onXXX 属性的 jQuery 片段：

```
var readonlySelect = function(selector, makeReadonly) {

    $(selector).filter("select").each(function(i){
        var select = $(this);

        //remove any existing readonly handler
        if(this.readonlyFn) select.unbind("change", this.readonlyFn);
        if(this.readonlyIndex) this.readonlyIndex = null;

        if(makeReadonly) {
            this.readonlyIndex = this.selectedIndex;
            this.readonlyFn = function(){
                this.selectedIndex = this.readonlyIndex;
            };
            select.bind("change", this.readonlyFn);
        }
    });

}; 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2011-08-09T13:34:09.330

我用jquery解决了它：

```
 $("select.myselect").bind("focus", function(){
        if($(this).hasClass('readonly'))
        {
          $(this).blur();   
          return;
        }
      }); 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2013-02-05T16:50:39.803

如果您使用的是 jquery validate，您可以执行以下操作，我使用 disabled 属性没有问题：

```
$(function(){
    $('#myform').validate({
        submitHandler:function(form){
            $('select').removeAttr('disabled');
            form.submit();
        }
    });
}); 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2016-12-13T20:21:37.667

我发现使用纯 javascript（即：不需要 JQuery 库）效果很好，是将`<select>`标签的 innerHTML 更改为所需的单个剩余值。

前：

```
<select name='day' id='day'>
  <option>SUN</option>
  <option>MON</option>
  <option>TUE</option>
  <option>WED</option>
  <option>THU</option>
  <option>FRI</option>
  <option>SAT</option>
</select> 
```

示例 Javascript：

```
document.getElementById('day').innerHTML = '<option>FRI</option>'; 
```

后：

```
<select name='day' id='day'>
  <option>FRI</option>
</select> 
```

这样，视觉效果不会发生变化，这将在`<FORM>`.

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-12-11T16:48:40.813

`input`成为你的`<select>`元素：

```
input.querySelectorAll(':not([selected])').forEach(option => {
  option.disabled = true
}) 
```

这将保留数据中的选择（因为它没有被禁用），并且只有`option`那些未被选中的被禁用，因此不可选择。结果是无法更改的可读选择（=> 只读）。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-12-15T16:04:31.537

除了选择本身，您可以禁用除当前选择的选项之外的所有选项。这给出了一个工作下拉列表的外观，但只有您想要传入的选项才是有效的选择。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2011-11-25T14:29:46.337

html解决方案：

> `<select onfocus="this.blur();">`

javascript的：

> `selectElement.addEventListener("focus", selectElement.blur, true);` `selectElement.attachEvent("focus", selectElement.blur); //thanks, IE`

去除：

> `selectElement.removeEventListener("focus", selectElement.blur, true);` `selectElement.detachEvent("focus", selectElement.blur); //thanks, IE`

编辑：添加删除方法

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2012-01-25T02:42:58.007

在 IE 中，我能够通过双击来击败 o​​nfocus=>onblur 方法。但是记住这个值然后在 onchange 事件中恢复它似乎可以解决这个问题。

```
<select onfocus="this.oldvalue=this.value;this.blur();" onchange="this.value=this.oldvalue;">
....
</select> 
```

您可以使用 javascript 变量在没有扩展属性的情况下执行类似操作。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2013-09-03T23:48:39.387

简单地说，在提交表单之前删除 disabled 属性。

```
 $('form').submit(function () {
        $("#Id_Unidade").attr("disabled", false);
    }); 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2015-11-04T09:45:40.147

```
<select id="case_reason" name="case_reason" disabled="disabled"> 
```

`disabled="disabled" ->`将从数据库中获取您的值，并以表格形式显示。 `readonly="readonly" ->`您可以在选择框中更改您的值，但您的值无法保存在您的数据库中。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2019-11-09T01:39:21.447

> 模拟 select 标签的 readonly 属性并仍然获取 POST 数据的最佳方法是什么？

只需将其设为输入/文本字段并为其添加“只读”属性即可。如果选择被有效地“禁用”，那么无论如何您都无法更改该值，因此您不需要选择标签，您可以简单地将“选定”值显示为**只读**文本输入。对于大多数 UI 目的，我认为这应该足够了。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-12-15T16:06:13.187

如果选择下拉菜单自出生以来就是只读的并且根本不需要更改，也许您应该使用另一个控件来代替？像一个简单的`<div>`（加上隐藏的表单域）或一个`<input type="text">`？

**补充：**如果下拉菜单不是一直只读的并且使用 JavaScript 来启用/禁用它，那么这仍然是一个解决方案 - 只需即时修改 DOM。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2011-10-24T20:43:22.190

下面为我​​工作：

```
$('select[name=country]').attr("disabled", "disabled"); 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2011-12-07T12:54:42.593

我通过隐藏选择框并`span`在其位置显示仅具有信息值的 a 来管理它。在禁用`.readonly`类的情况下，我们还需要删除`.toVanish`元素并显示它们`.toShow`。

```
 $( '.readonly' ).live( 'focus', function(e) {
                $( this ).attr( 'readonly', 'readonly' )
                if( $( this ).get(0).tagName == 'SELECT' ) {
                    $( this ).before( '<span class="toVanish readonly" style="border:1px solid; padding:5px">' 
                            + $( this ).find( 'option:selected' ).html() + '</span>' )
                    $( this ).addClass( 'toShow' )
                    $( this ).hide()
            }
    }); 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2012-11-09T00:14:09.643

这是使用自定义 jQuery 函数来实现功能的尝试（如此处所述）：

```
$(function(){

 $.prototype.toggleDisable = function(flag) {
    // prepare some values
    var selectId = $(this).attr('id');
    var hiddenId = selectId + 'hidden';
    if (flag) {
      // disable the select - however this will not submit the value of the select
      // a new hidden form element will be created below to compensate for the 
      // non-submitted select value 
      $(this).attr('disabled', true);

      // gather attributes
      var selectVal = $(this).val();
      var selectName = $(this).attr('name');

      // creates a hidden form element to submit the value of the disabled select
      $(this).parents('form').append($('<input></input>').
        attr('type', 'hidden').
        attr('id', hiddenId).
        attr('name', selectName).
        val(selectVal) );
    } else {
      // remove the newly-created hidden form element
      $(this).parents('form').remove(hiddenId);
      // enable back the element
      $(this).removeAttr('disabled');
    }
  }

  // Usage
  // $('#some_select_element').toggleDisable(true);
  // $('#some_select_element').toggleDisable(false);

}); 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2014-01-17T07:52:25.520

```
    var selectedOpt;//初始化var
    var newIdForHidden;//初始化var
    $('.disabledOnEdit').focusin(function(){
        selectedOpt = $(this).find(":selected").val();
        newIdForHidden = $(this).attr('id')+'Hidden';
        //alert(selectedOpt+','+newIdForHidden);
        $(this).append('');
        $(this).find('input.hiddenSelectedOpt').attr('id',newIdForHidden).val(selectedOpt);
    });
    $('.disabledOnEdit').focusout(function(){
        var oldSelectedValue=$(this).find('input.hiddenSelectedOpt').val();
        $(this).val(oldSelectedValue);
    });

```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2014-09-09T17:22:14.930

select multiple 对上述代码建议的响应几乎没有。经过大量的大锤和拼凑，我最终得到了这个：

```
var thisId="";
var thisVal="";
function selectAll(){
    $("#"+thisId+" option").each(function(){
        if(!$(this).prop("disabled"))$(this).prop("selected",true);
    });
    $("#"+thisId).prop("disabled",false);
}
$(document).ready(function(){
    $("select option:not(:selected)").attr('disabled',true);
    $("select[multiple]").focus(function(){
        thisId=$(this).prop("id");
        thisVal=$(this).val();
        $(this).prop("disabled",true).blur();
        setTimeout("selectAll();",200);
    });
}); 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2014-12-15T07:04:28.177

非常简单。首先将值存储在变量中。然后在将事件设置值更改为保存初始值的存储变量时

我有一个名字叫映射。那么我的代码将如下所示；

```
$("document").ready(function(){ 
    var mapping=$("select[name=mapping]").val();
    $("select[name=mapping]").change(function(){
        $("select[name=mapping]").val(mapping);
    });
}); 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2015-11-17T14:14:53.817

如果您有一个应该是只读的选择标签，您必须在逻辑上将选择框转换为单个“文本”字段。

我这样说是合乎逻辑的，因为它就像：“我必须向用户显示一个值”

无论值是否来自选择标签，仍然**是单个值并且不能更改**（只读）。

因此，从逻辑上讲，只有在第一次插入值时才使用选择标记。

然后，当您需要显示此值时，您必须将其放在“文本字段-只读”上。

如果只读，则成为值列表（选定值）的多选相同

我使用“文本”是因为只读标签不需要“类型”属性。干杯

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2018-09-17T20:38:09.047

我知道这不会帮助所有人（如果您只是客户端），但会帮助一些全栈并控制后端和前端的人。

如果用户没有编辑字段的权限，我只返回下拉列表的当前选择。

这是我的一些后端控制器：

```
 #region Prepare Action Priviledges
        editAuditVM.ExtAuditEditRoleMatrixVM = new ExtAuditEditRoleMatrixVM
        {
            CanEditAcn = _extAuditEditRoleMatrixHelper.CanEditAcn(user, audit),
            CanEditSensitiveDesignation = _extAuditEditRoleMatrixHelper.CanEditSensitiveDesignation(user, audit),
            CanEditTitle = _extAuditEditRoleMatrixHelper.CanEditTitle(),
            CanEditAuditScope = _extAuditEditRoleMatrixHelper.CanEditAuditScope(user, audit)
        };
        #endregion

        #region Prepare SelectLists for Drop Downs
        #region AuditScope List
        IQueryable<SelectListItem> auditScopes = _auditTypesRepo.AuditTypes
            .Where(at => at.AuditTypeClassCode.ToLower() == "e")
            .Select(at => new SelectListItem
            { Text = at.AuditTypeText, Value = at.AuditTypeID.ToString() });
        // Cannot make a select readonly on client side.
        //  So only return currently selected option.
        if (!editAuditVM.ExtAuditEditRoleMatrixVM.CanEditAuditScope)
        {
            auditScopes = auditScopes
                .Where(ascopeId => ascopeId.Value == editAuditVM.ExternalAudit.AuditTypeID.ToString());
        }
        #endregion
        #endregion 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2020-01-17T15:05:47.257

因此，无论出于何种原因，这里提到的所有基于 jquery 的解决方案都不适合我。所以这是一个纯 javascript 解决方案，它在进行 POST 时也应该保留选定的值。

```
setDropdownReadOnly('yourIdGoesHere',true/false) 
```

> ```
>  function setDropdownReadOnly(controlName, state) {
>         var ddl = document.getElementById(controlName);
> 
>         for (i = 0; i < ddl.length; i++) {
>             if (i == ddl.selectedIndex)
>                 ddl[i].disabled = false;
>             else
>                 ddl[i].disabled = state;
>         }
>     } 
> ```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2020-09-18T03:36:10.877

我的解决方案是`select[readonly] { pointer-events: none; }`按照这里的建议添加样式，然后添加这个 JS 来处理键盘事件：

```
$(document).on('keydown', 'select[readonly]', function(e) {
    if (e.keyCode != 9) {
        if (e.preventDefault) {
            e.preventDefault();
        }

        e.returnValue = false;
        e.cancel = true;
    }
}); 
```

这仍然允许使用制表符遍历元素。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2022-02-14T22:51:50.647

摘自[https://stackoverflow.com/a/71086058/18183749](https://stackoverflow.com/a/71086058/18183749)

> 如果您不能使用“禁用”属性（因为它会删除 POST 时的值输入），并注意到 html 属性“只读”仅适用于 textarea 和一些输入（文本、密码、搜索，据我所知） )，最后，如果您不想费心用隐藏的输入逻辑复制所有选择、复选框和单选，您可能会发现以下函数或任何您喜欢的内部逻辑：

```
addReadOnlyToFormElements = function (idElement) {

        // html readonly don't work on input of type checkbox and radio, neither on select. So, a safe trick is to disable the non-selected items
        $('#' + idElement + ' select>option:not([selected])').prop('disabled',true);

        // and, on the selected ones, to mimic readOnly appearance
        $('#' + idElement + ' select').css('background-color','#eee');
    } 
```

没有什么比删除这些只读的更容易的了

```
removeReadOnlyFromFormElements = function (idElement) {

    // Remove the disabled attribut on non-selected 
    $('#' + idElement + ' select>option:not([selected])').prop('disabled',false);

    // Remove readOnly appearance on selected ones
    $('#' + idElement + ' select').css('background-color','');
} 
```

* * *

## 回答 #42

> 赞同：-2
> 
> 时间：2013-06-19T15:39:29.987

在您可以使用的选项中`disabled="disabled"`，而不是在选择本身上

* * *

## 回答 #43

> 赞同：-4
> 
> 时间：2013-12-03T17:11:08.323

有同样的问题，发现了非常有用的形式属性 - `submitdisabledcontrols`。

将其设置为 True 和禁用的输入现在是`POST`.

# c++ - 从压缩档案中读取

> ID：368819
> 
> 赞同：1
> 
> 时间：2008-12-15T16:00:02.950
> 
> 标签：c++, compression

我想将我所有的程序内容放在一个压缩的存档文件中，因为它开始变得非常大。我知道有一些像 zlib 这样的库，但我不知道如何让它们做我想做的事情：

*   能够从文件中加载纹理/模型等，目前使用 d3dx 方法，例如 D3DXCreateTextureFromFileEx。我真的不想为我想要的不同格式编写自己的图像加载器，所以我需要一些方法来兼容这些 d3d 方法。我知道他们有办法从内存文件中加载，是否适合以某种方式将文件提取到内存中然后加载？

*   能够将 c++ 流与压缩存档中的文件一起使用，例如：
    std::zipstream file("data.zip:sounds/beep.wav", std::ios::in | std::ios::binary);

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T16:17:12.413

我建议您查看开源游戏（例如quake3）。正如 Vilx 所指出的，其中一些正在打包资源并具有“虚拟文件系统”的工作实现。你可能会得到一些想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T17:11:03.647

There is an article entitled [Programming a Virtual File System](http://www.flipcode.com/archives/Programming_a_Virtual_File_System-Part_I.shtml) archived on [flipcode](http://www.flipcode.com/) that should provide what you need. If you have questions specific to that article, many former flipcode members now frequent the [forums](http://www.devmaster.net/forums/) at [DevMaster.net](http://www.devmaster.net/).

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-15T16:04:14.953

这类事情有现成的库。恐怕我不知道任何名字，但我建议谷歌搜索关键字“虚拟文件系统”。

# active-directory - 快速确定用户帐户是否是 AD 组成员的最佳方法？

> ID：368830
> 
> 赞同：9
> 
> 时间：2008-12-15T16:02:27.983
> 
> 标签：active-directory, ldap, adsi, directoryentry

我目前有一些代码可以拉下组中的用户列表，然后遍历该组以确定给定帐户是否存在，但似乎应该有一种更简洁（也许更快）的方法来完成此操作。

此代码 (VB.NET) 尝试使用组对象的成员属性，但即使用户是该组的成员，它也会返回 false。谁能看到我在这里做错了什么？

```
Dim group As DirectoryEntry =  GetNetworkObject(GroupDomanName, NetworkObjectType.NetworkGroup, GroupName)
Dim user As DirectoryEntry =GetNetworkObject(UserDomainName, NetworkObjectType.NetworkUser, Login)

Return group.Properties("member").Contains(user.Path) 
```

仅供参考：GetNetworkObject 调用仅返回一个 directoryEntry 对象，我已确认为组和用户对象返回了正确的对象。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-15T16:21:51.563

如果您在 .NET 3.5 堆栈上，[System.DirectoryServices.AccountManagement.dll 程序集](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.aspx)在 AD 之上有一个不错的 API。可以实施以下方法来解决您的问题：

```
static bool IsUserMemberOf(string userName, string groupName)
{
    using (var ctx = new PrincipalContext(ContextType.Domain))
    using (var groupPrincipal = GroupPrincipal.FindByIdentity(ctx, groupName))
    using (var userPrincipal = UserPrincipal.FindByIdentity(ctx, userName))
    {
        return userPrincipal.IsMemberOf(groupPrincipal);
    }
}

// Usage:
bool result = IsUserMemberOf("CONTOSO\\john.doe", "CONTOSO\\Administrators"); 
```

我不知道这种方法如何执行，但它是一个干净的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T16:43:52.563

这是我过去在一个运行良好的 VBS 脚本中使用的内容：

```
Set wshNet = CreateObject("WScript.Network")                'Setup connection to the Network
Set fso = CreateObject("Scripting.FileSystemObject")        'Create File System Object for any file manipulations

Set ADSysInfo = CreateObject("ADSystemInfo")                'Setup connection to Active Directory
Set CurrentUser = GetObject("LDAP://" & ADSysInfo.UserName) 'Setup current user to look for in Active Directory
strGroups = LCase(Join(CurrentUser.MemberOf))               'Grabs all the groups the current user is a member of 
```

然后我使用 InStr 查看用户是否属于该组：

```
If InStr(strGroups, "MyGroup") Then MyGroupSub 
```

您也许可以在您的项目中调整上述内容。

顺便说一句，我注意到在您的代码中，您将***groupdoman***作为“group”的最后一个参数不确定您是否希望它是***groupdomain***：

暗组作为 DirectoryEntry = GetNetworkObject(GroupDomanName, NetworkObjectType.NetworkGroup, GroupName, ***groupdoman*** )

对比

Dim group As DirectoryEntry = GetNetworkObject(GroupDomanName, NetworkObjectType.NetworkGroup, GroupName, ***groupdomain*** )

让我知道这是否有帮助！联合部队

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T16:52:16.353

我找到了一个似乎在 NET 2.0 中有效的答案，相对较快，并且克服了包含 100 多个项目的组的可能问题（需要范围搜索）

这是我结束的代码：

```
Dim DSearcher As New DirectorySearcher(group, "(&(objectClass=user)(cn=" + Login + "))", New String() {"member;Range=0-5000"}, SearchScope.OneLevel)                  
group = GetNetworkObject(GroupDomanName, NetworkObjectType.NetworkGroup, GroupName)
user = GetNetworkObject(UserDomainName, NetworkObjectType.NetworkUser, Login)
DSearcher.AttributeScopeQuery = "member"
Return (DSearcher.FindOne() IsNot Nothing) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T20:48:53.800

这是使用目录搜索器和 memberOf 的另一种方法。这是使用当前用户的 objectSID，但您可以将其更改为其他标识符。

```
dSearch.Filter = String.Format("(&(memberOf={0})(objectSid={1}))", groupDN, WindowsIdentity.GetCurrent.User)

Return dSearch.FindOne() IsNot Nothing 
```

如果您要使用可能包含无效字符的用户输入，则应始终对它们进行转义...

```
searchName = searchName.Replace("\", "\5c"). _
                                Replace("/", "\2f"). _
                                Replace("*", "\2a"). _
                                Replace("(", "\28"). _
                                Replace(")", "\29") 
```

# java - 如何编写分析器？

> ID：368831
> 
> 赞同：16
> 
> 时间：2008-12-15T16:02:47.297
> 
> 标签：java, profiler

我想知道如何编写分析器？推荐什么书和/或文章？任何人都可以帮助我吗？

有人已经做过这样的事情了吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-15T16:45:21.670

令人鼓舞的很多，不是我们:)

如果您只是想对程序大部分时间花在哪里有一个合理的了解，那么分析器并不是太难。如果您对高精度和最小干扰感到困扰，事情就会变得困难。

因此，如果 yoyu 只是想要分析器给你的答案，那就去找别人写的。如果您正在寻找智力挑战，为什么不尝试写一个呢？

我已经写了几个，用于多年来变得无关紧要的运行时环境。

有两种方法

*   在记录时间和位置的每个功能或其他重要点上添加一些内容。

*   让计时器定期启动并查看程序当前所在的位置。

JVMPI 版本似乎是第一种——uzhin 提供的链接表明它可以报告很多事情（参见第 1.3 节）。执行此操作的内容会发生变化，因此分析可能会影响性能（如果您正在分析原本非常轻量但经常调用的函数，它可能会产生误导）。

如果你能得到一个定时器/中断，告诉你程序计数器在中断时在哪里，你可以使用符号表/调试信息来确定它当时在哪个函数中。这提供的信息较少，但破坏性较小。通过遍历调用堆栈以识别调用者等可以获得更多信息。我不知道这些在Java中是否可能......

保罗。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-16T00:20:04.093

我会先看看那些开源项目：

*   Eclipse TPTP ( [http://www.eclipse.org/tptp/](http://www.eclipse.org/tptp/) )
*   VisualVM ( [https://visualvm.dev.java.net/](https://visualvm.dev.java.net/) )

然后我会看看 JVMTI（不是 JVMPI）

*   [http://java.sun.com/developer/technicalArticles/Programming/jvmti/](http://java.sun.com/developer/technicalArticles/Programming/jvmti/)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-10T19:36:13.267

我曾经写过一篇，主要是为了让“深度采样”更加用户友好。当您手动执行该方法时，[将在此处进行说明](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)。它是基于抽样的，但不是取大量的小样本，而是取少量的大样本。

例如，它可以告诉您，该指令`I`（通常是函数调用）正在花费您总执行时间的一定百分比 X，或多或少，因为它出现在 X% 的样本上的堆栈中。

想一想，因为**这是一个关键点**。只要程序在运行，调用栈就存在。如果某个特定的调用指令`I`有 X% 的时间在堆栈上，那么如果该指令可以消失，那么 X% 的时间就会消失。*这不取决于`I`执行了多少次，或者函数调用需要多长时间。所以计时器和计数器没有抓住重点。*从某种意义上说，所有指令都是调用指令，即使它们只调用微码。

采样器基于这样一个前提，即`I`准确地知道指令的地址（*因为那是您要查找的*）比准确地知道数字 X% 更好。如果你知道通过重新编码可以节省大约 30% 的时间，你真的关心你可能会节省 5% 的时间吗？你仍然会想要修复它。它实际节省的时间不会因您准确了解 X 而减少或增加。

因此可以从定时器中驱动样本，但坦率地说，我发现通过用户同时按下两个 shift 键来触发中断同样有用。由于 20 个样本通常就足够了，这样您就可以确保在相关时间（即不是在等待用户输入时）进行采样，这就足够了。另一种方法是在用户同时按住两个 shift 键（或类似的键）时仅执行计时器驱动的采样。

我并不担心采样可能会减慢程序，因为目标不是测量速度，而是找到最昂贵的指令。修复某些东西后，整体加速很容易衡量。

分析器提供的主要内容是 UI，因此您可以轻松地检查结果。采样阶段产生的是调用堆栈样本的集合，其中每个样本是指令地址列表，其中除最后一条指令之外的每条指令都是调用指令。UI 主要是所谓的“蝴蝶视图”。它有一个当前的“焦点”，这是一个特定的指令。左侧显示了该指令正上方的调用指令，这些指令是从堆栈样本中挑选出来的。如果焦点指令是一个调用指令，那么它下面的指令会出现在右侧，就像从样本中挑选出来的一样。在焦点指令上显示一个百分比，即包含该指令的堆栈的百分比。同样对于左边或右边的每条指令，该百分比按每条此类指令的频率细分。当然，指令由文件、行号和它所在的函数的名称表示。用户可以通过单击任何指令轻松浏览数据，使其成为新的焦点。

这个 UI 的一个变体将蝴蝶视为两部分，由交替的函数调用指令层和包含它们的函数组成。这可以让每个函数花费的时间更加清晰。

也许它并不明显，所以值得一提的是这种技术的一些特性。

*   递归不是问题，因为如果一条指令在任何给定的堆栈样本上出现多次，那仍然算作只有一个包含它的样本。移除它所节省的估计时间仍然是它所在的堆栈的百分比，这仍然是正确的。

*   请注意，这与调用树不同。无论它位于调用树的多少个不同分支，它都会为您提供指令的成本。

*   UI 的性能不是问题，因为样本的数量不需要很大。如果一个特定的指令 I 是焦点，那么很容易找到样本包含它的方式，以及对于每条相邻指令，有多少包含 I 的样本还包含它旁边的相邻指令。

*   如前所述，采样速度不是问题，因为我们不是在测量性能，而是在诊断。抽样不会影响结果，因为抽样不会影响整个程序的功能。一个算法需要 N 条指令才能完成，即使它被暂停了任意次数，它仍然需要 N 条指令。

*   我经常被问到如何对在几毫秒内完成的程序进行采样。简单的答案是将其包裹在一个外部循环中，以使其花费足够长的时间进行采样。您可以找出需要 X% 的时间，删除它，获得 X% 的加速，然后删除外部循环。

这个我称之为 YAPA（又一个性能分析器）的小分析器是基于 DOS 的，并且做了一个不错的小演示，但是当我有严肃的工作要做时，我会求助于手动方法。主要原因是调用堆栈本身通常不足以告诉您为什么要花费特定周期。您可能还需要了解其他状态信息，以便更全面地了解程序当时在做什么。由于我发现手动方法非常令人满意，因此我搁置了该工具。

谈论分析时经常忽略的一点是，您可以反复进行分析以发现多个问题。例如，假设指令`I1`有 5% 的时间在堆栈上，并且`I2`有 50% 的时间在堆栈上。二十个样品很容易找到`I2`，但也许不是`I1`。所以你修复`I2`. 然后你再做一遍，但现在`I1`需要 10% 的时间，所以 20 个样本可能会看到它。这种*放大效应*允许重复应用分析以实现较大的复合加速因子。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T16:15:15.913

JVMPI 规范：http: [//java.sun.com/j2se/1.5.0/docs/guide/jvmpi/jvmpi.html](http://java.sun.com/j2se/1.5.0/docs/guide/jvmpi/jvmpi.html)

我向你的勇气和勇敢致敬

编辑：正如用户 Boune 所指出的，JVMTI：http: [//java.sun.com/developer/technicalArticles/Programming/jvmti/](http://java.sun.com/developer/technicalArticles/Programming/jvmti/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-17T13:33:00.047

作为另一个答案，我只是在 sourceforge 上查看了 LukeStackwalker。这是一个不错的小型堆栈采样器示例，如果您想编写分析器，它也是一个不错的起点。

在我看来，这就是它的正确之处：

*   它对整个调用堆栈进行采样。

叹息……那么近却那么远。在这里，IMO 是它（以及其他堆栈采样器，如 xPerf）应该做的：

*   它应该保留原始堆栈样本。事实上，它在采样时在功能级别进行汇总。这会丢失定位有问题的呼叫站点的关键线路号码信息。

*   如果保存它们的存储是一个问题，它不需要那么多样本。由于典型的性能问题成本从 10% 到 90%，因此 20-40 个样本将非常可靠地显示它们。数百个样本提供了更高的测量精度，但它们并没有增加定位问题的概率。

*   UI 应该根据语句而不是函数进行总结。如果保留原始样本，这很容易做到。附加到声明的关键度量是包含它的样本的比例。例如：

    5/20 MyFile.cpp:326 for (i = 0; i < strlen(s); ++i)

这表示 MyFile.cpp 中的第 326 行出现在 20 个样本中的 5 个样本中，在调用`strlen`. 这非常重要，因为您可以立即看到问题，并且您知道修复它可以获得多少加速。如果您替换`strlen(s)`为`s[i]`，它将不再在该调用中花费时间，因此不会出现这些样本，并且加速大约为 1/(1-5/20) = 20/(20-5) = 4/3 = 33% 加速。（感谢 David Thornley 提供此示例代码。）

*   UI 应该有一个显示语句的“蝴蝶”视图。（如果它也显示函数，那没关系，但语句才是真正重要的。）例如：

    3/20 MyFile.cpp:502 MyFunction(myArgs)
    2/20 HisFile.cpp:113 MyFunction(hisArgs)

    5/20 MyFile.cpp:326 for (i = 0; i < strlen(s); ++i)

    5/20 strlen.asm:23 ...一些汇编代码...

在此示例中，包含`for`语句的行是“关注焦点”。它发生在 5 个样品上。它上面的两行表示，在其中 3 个样本上，它是从 调用的`MyFile.cpp:502`，而在其中 2 个样本上，它是从 调用的`HisFile.cpp:113`。它下面的行表示在所有 5 个样本中，它都在`strlen`（这并不奇怪）。一般来说，焦点线会有一棵“父母”树和一棵“孩子”树。如果由于某种原因，焦点线不是您可以修复的，您可以向上或向下。目标是在尽可能多的样本上找到可以修复的行。

重要提示：分析不应被视为您只做**一次**的事情。例如，在上面的示例中，我们通过修复一行代码获得了 4/3 的加速。当重复该过程时，其他有问题的代码行的出现频率应该是之前的 4/3，因此更容易找到。我从来没有听说过有人谈论迭代分析过程，但这对于获得整体的复合加速至关重要。

PS 如果一个语句在一个样本中出现不止一次，这意味着正在发生递归。这不成问题。它仍然只算作一个包含该语句的样本。语句的成本仍然是由包含它的样本的分数来近似的。

# .net - 字符编码问题 - PHP 输出，由 .NET 通过 HttpWebRequest 读取

> ID：368832
> 
> 赞同：2
> 
> 时间：2008-12-15T16:02:51.587
> 
> 标签：.net, php, vb.net, encoding, character-encoding

我有一个 PHP 脚本（在 Linux 服务器上运行）输出服务器上某些文件的名称。它以简单的纯文本格式输出这些文件名。

此输出是使用 HttpWebRequest、HttpWebResponse 和 StreamReader 从 VB.NET 程序中读取的。

问题是一些正在输出的文件名包含......不寻常的字符。具体来说，“节”符号（§）。

如果我在 Web 浏览器中查看 PHP 脚本的输出，则该符号看起来很好。

但是，当我将 PHP 脚本的输出读入我的 .NET 程序时，符号显示不正确（它显示为通用“块”符号）。

我已经尝试了在读取响应流（来自 HttpWebResponse）时可以使用的所有不同字符编码选项。我尝试将流直接输出到文本文件（不好），在 TextBox 中显示（不好），即使直接在 Visual Studio 调试器中查看结果，字符也会显示为块而不是“节”符号。

我已经检查了十六进制编辑器中的输出（正如相关问题所建议的那样，“[你如何解决字符编码问题](https://stackoverflow.com/questions/29499/how-do-you-troubleshoot-character-encoding-problems)。”

当我从 .NET 本身写出节符号 (§) 时，我看到的表示它的十六进制字节是“c2 a7”（如果它是 unicode 就有意义，对吧？需要两个字节？）。当我将 PHP 脚本的输出直接写入文件并使用十六进制编辑器检查时，符号显示为“ef bf bd”——三个字节而不是两个？

我不知道该怎么做——如果我需要指定其他字符编码，或者我遗漏了一些明显的东西。

下面是用于获取 PHP 脚本输出的代码（修改了 VB 样式的注释，以便它们在此站点上正确显示）：

```
 Dim myRequest As HttpWebRequest = WebRequest.Create("http://www.example.com/sample.php")

Dim myResponse As HttpWebResponse = myRequest.GetResponse()

// read the response stream
Dim myReader As New StreamReader(myResponse.GetResponseStream())

// read the entire output in one block (just as an example)
Dim theOutput as String = myReader.ReadToEnd() 
```

有任何想法吗？

*   我是否使用了错误类型的 StreamReader？（我尝试在调用中传递字符编码以创建新的 StreamReader - 我已经尝试了 System.Text.Encoding 中的所有字符编码 - UTF-8、UTF-7、ASCII、UTF-32、Unicode、 ETC。）
*   我应该使用不同的方法来读取 PHP 脚本的输出吗？
*   输出文本时，我应该在 PHP 端做些什么不同的事情吗？

**更新信息：**

*   PHP 的输出通过调用专门编码为 UTF-8：`utf8_encode($file);`
*   当我从 .NET 中写出符号时，我从 Windows 中的 Character Map 应用程序中复制并粘贴了该符号。我还直接从文件名（在 Windows 中）和此网页本身复制并粘贴了它 - 写出时都给出了相同的十六进制值（c2 a7）。
*   是的，我说的“部分符号”是 U+00A7（Windows 上的 ALT+0167，根据字符映射表）。
*   内容类型是通过`header('Content-Type: text/html; charset=utf-8');`PHP 脚本开头的右侧显式设置的。

**更新：**

我自己想出来了，但如果没有回答的人的帮助，我是做不到的。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T17:30:57.977

**弄清楚了！！**

就像很多事情一样，回想起来很简单！

Jon Skeet 是正确的——它*应该*是 UTF-8，但绝对不是。

事实证明，在我使用的原始脚本中（在我将其剥离以使其更易于调试之前），脚本有一些额外的文本输出没有包含在`utf8_encode()`调用中。这导致整个页面以 ISO-8859-1 而不是 UTF-8 输出。

当我检查我的测试脚本的“编码”属性（在 Firefox 中，“查看页面信息”）时，我注意到了这一点。测试脚本是 UTF-8，但是 ISO-8859-1。生产脚本还打印了文件的日期；这没有包含在对 utf8_encode 的调用中——这导致整个输出更改为 ISO-08859-1。

[在这里插入我拍脑门的声音]

感谢所有回答的人！你很有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T16:06:34.603

PHP 是否让您完全控制编码？仅仅猜测它通常不是一个好主意。

当您说您已经从 .NET 中写出符号时，您使用的是什么编码？它是什么实际的 Unicode 代码点？[unicode U+00A7](http://www.unicode.org/charts/PDF/U0080.pdf)处有一个节符号- 是你的意思吗？我不知道为什么 PHP 会将其表示为“ef bf bd”。

使用 StreamReader 应该没问题，但您需要知道正确的编码。

编辑：好的，所以它*应该*是 UTF-8，当然不是 - 所以问题出在 PHP 方面。如果您运行`utf8_encode($file)`然后显式打印出结果的字节（没有 Web 服务器妨碍）会发生什么？我真的很惊讶浏览器设法获得正确的符号......这只是普通的HTML吗？您确定所有“ef bf bd”都只是节符号吗？

这个网络服务器在任何地方都是公开的吗？如果我可以将浏览器指向它，我*也许*可以弄清楚发生了什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T16:34:55.407

您正在使用`utf8_encode($file)`，很好，但是 PHP 是否也将内容类型返回为 UTF-8？你能检查`Content-Type`你的 PHP 页面返回的标题吗？您应该特别查看该`charset`字段以确保您拥有以下内容：

```
Content-Type: text/html; charset=utf-8 
```

我可以看到浏览器如何在 .NET（正确或错误）失败时正确显示字符。浏览器通常会尝试尽可能地健壮和宽容。您使用的浏览器可能会从字符序列中推断出实际的字符编码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-06T15:10:56.773

使用上面的建议，我创建了一个简单的解决方案，即创建一个包含以下内容的文件：

```
$feed = header("Content-Type: text/html; charset=utf-8");
$feed.=utf8_encode(readfile(rawurldecode($_GET["url"])));
$feed = fread(rawurldecode($_GET["url"]));
die($feed); 
```

这是 PHP，但可以很容易地移植到任何其他语言。然后，您只需调用任何要使用的导致 UTF8 问题的 URL（我发现 RSS 提要有问题，因此我需要它），并在 URL 获取变量中使用问题文件的 URL，[例如 http://example。 com/fix-my-rss.php?url=http://anotherexample.com/broken.rss](http://example.com/fix-my-rss.php?url=http://anotherexample.com/broken.rss)

然后，这将加载到文件中并将其作为另一个文件返回给您，您可以将其加载到其他文件中，例如屏幕阅读器。您可以类似地修改它以读取字符串或任何其他包含问题代码的内容。

# php - 通过 ext/ldap 将 LDAP 条目添加到 Active Directory

> ID：368844
> 
> 赞同：1
> 
> 时间：2008-12-15T16:05:17.010
> 
> 标签：php, active-directory, ldap

使用 ext/ldap 我正在尝试将条目添加到 Active Directory。只要我只使用一个结构对象类，一切都会按预期工作，但是一旦我尝试添加带有第二个辅助对象类的条目，服务器就会报告错误：

> 服务器不愿意执行；00002040：SvcErr：DSID-030F0AA0，问题 5003 (WILL_NOT_PERFORM)，数据 0

以下代码有效：

```
ldap_add($ldap, 'OU=Test,OU=Test,DC=domain,DC=example,DC=local', array(
    'ou' => 'Test',
    'objectClass' => 'organizationalUnit',
    'l' => 'location'
)); 
```

这不会：

```
ldap_add($ldap, 'OU=Test,OU=Test,DC=domain,DC=example,DC=local', array(
    'ou' => 'Test',
    'associatedDomain' => 'domain',
    'objectClass' => array('organizationalUnit', 'domainRelatedObject'),
    'l' => 'location'
)); 
```

如果我尝试将辅助 objectClass 添加到现有条目，也会发生同样的情况：

```
ldap_mod_add($ldap, 'OU=Test,OU=Test,DC=domain,DC=example,DC=local', array(
    'associatedDomain' => 'domain',
    'objectClass' => 'domainRelatedObject'
)); 
```

对应的错误信息基本相同

> 服务器不愿意执行；00002040：SvcErr：DSID-030508F8，问题 5003 (WILL_NOT_PERFORM)，数据 0

由于所有其他更新和添加操作都有效，我认为问题必须与 objectClass 属性有关。

由于我对 Active Directory 没有足够的经验（我习惯于 OpenLDAP）：Active Directory 中的 objectClasses 是否存在任何已知问题？我在这里错过了什么吗？是否有任何限制不允许添加`domainRelatedObject`例如`organizationalUnit`？这到底是怎么回事;-)？

*以防万一您想知道：`domainRelatedObject`存在于 Active Directory 架构中。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T21:41:15.990

我刚刚发现，为了添加动态（每个实例）辅助类，[域的森林功能级别必须是 2003](http://msdn.microsoft.com/en-us/library/ms676290.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T17:47:21.610

您可能无权设置 objectClass 属性。[通过ADSI Edit](http://technet.microsoft.com/en-us/library/cc773354.aspx)查看是否可以在创建后附加辅助类。如果不能，请先修复权限（检查安全设置的高级视图中的属性选项卡）

我现在可以将这个特定的类附加到一个organizationalUnit 对象上，作为域管理员；所以原则上这是可能的。

# c# - Linq2Sql Many：很多问题，你会怎么做？

> ID：368854
> 
> 赞同：7
> 
> 时间：2008-12-15T16:08:21.620
> 
> 标签：c#, linq-to-sql, entity-framework, many-to-many

我知道很多：Linq2Sql 不支持很多，但我正在研究一种解决方法

我正在使用我的小 SO 克隆，我有一个带有问题的表和一个带有标签的表和一个链接表 QuestionTag，所以我在问题和标签之间有一个经典的多：多关系。

为了在首页显示问题列表，我有这个类，我想从 Linq2Sql 查询中填写

```
public class ListQuestion
{
   public int QuestionID { get; set; }
   public string Title{ get; set; }
   public IEnumerable<Tag> Tags { get; set; }
}

public IEnumerable<ListQuestion> GetQuestions()
{
   from q in Questions
   .................
   select new ListQuestion{ ... }
} 
```

问题是我应该如何填写标签集合。我发现这不可能在 1 个单一查询中完成，因此我将其分为 2 个查询，1 个用于获取问题，1 个用于获取标签，然后尝试加入它们。我知道 Entity 框架支持 many:many 那么他们是如何做到的呢？你会怎么做？任何替代方法？查询当然应该是有效的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T08:31:46.520

这可能适用于您的情况；

```
from q in Questions
select new ListQuestion 
{ 
  Tags = q.QuestionTags.Select(qt => qt.Tag),
  QuestionId = q.ID,
  Title = q.Title
} 
```

# mysql - MySQL的隐藏特性

> ID：368858
> 
> 赞同：101
> 
> 时间：2008-12-15T16:09:58.200
> 
> 标签：mysql, database, hidden-features

我已经使用[Microsoft SQL Server](http://www.microsoft.com/Sqlserver/)很多年了，但直到最近才开始在我的 Web 应用程序中使用[MySQL](http://www.mysql.com/)，我渴望知识。

为了继续一长串的[“隐藏功能”问题](https://stackoverflow.com/questions/tagged/hidden-features)，我想知道 MySQL 的任何隐藏或方便的功能，这将有望提高我对这个开源数据库的了解。

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2009-03-01T23:32:24.907

既然你提出了赏金，我会分享我来之不易的秘密......

一般来说，我今天调优的所有 SQL 都需要使用子查询。来自 Oracle 数据库世界，我认为理所当然的事情与 MySQL 不同。我对 MySQL 调优的阅读使我得出结论，MySQL 在优化查询方面落后于 Oracle。

虽然大多数 B2C 应用程序所需的简单查询可能适用于 MySQL，但 Intelligence Reporting 所需的大多数聚合报告类型的查询似乎需要相当多的计划和重新组织 SQL 查询以指导 MySQL 更快地执行它们。

# 行政：

`max_connections`是并发连接数。默认值为 100 个连接（自 5.0 起为 151 个）- 非常小。

笔记：

连接占用内存，您的操作系统可能无法处理大量连接。

Linux/x86 的 MySQL 二进制文件允许您拥有多达 4096 个并发连接，但自编译二进制文件的限制通常较小。

设置 table_cache 以匹配您打开的表和并发连接的数量。观察 open_tables 值，如果它增长很快，您将需要增加它的大小。

笔记：

前面的 2 个参数可能需要大量打开的文件。20+max_connections+table_cache*2 可以很好地估计您的需求。Linux 上的 MySQL 有一个 open_file_limit 选项，设置这个限制。

如果您有复杂的查询，sort_buffer_size 和 tmp_table_size 可能非常重要。值将取决于查询复杂性和可用资源，但建议的起点分别为 4Mb 和 32Mb。

注意：这些是“每个连接”值，包括 read_buffer_size、read_rnd_buffer_size 和其他一些值，这意味着每个连接都可能需要此值。因此，在设置这些参数时，请考虑您的负载和可用资源。例如 sort_buffer_size 仅在 MySQL 需要进行排序时才分配。注意：小心不要耗尽内存。

如果您建立了许多连接（即没有持久连接的网站），您可以通过将 thread_cache_size 设置为非零值来提高性能。16 是很好的价值开始。增加该值，直到您的 threads_created 增长速度不会很快。

# 首要的关键：

每个表只能有一个 AUTO_INCREMENT 列，它必须被索引，并且不能有 DEFAULT 值

KEY 通常是 INDEX 的同义词。当在列定义中给出键属性 PRIMARY KEY 时，也可以仅将其指定为 KEY。这是为了与其他数据库系统兼容而实现的。

PRIMARY KEY 是唯一索引，其中所有键列必须定义为 NOT NULL

如果 PRIMARY KEY 或 UNIQUE 索引仅包含一个具有整数类型的列，您还可以在 SELECT 语句中将该列称为“_rowid”。

在 MySQL 中，PRIMARY KEY 的名称是 PRIMARY

目前，只有 InnoDB (v5.1?) 表支持外键。

通常，您在创建表时创建所需的所有索引。任何声明为 PRIMARY KEY、KEY、UNIQUE 或 INDEX 的列都将被索引。

NULL 表示“没有值”。要测试 NULL，您*不能*使用算术比较运算符，例如 =、< 或 <>。请改用 IS NULL 和 IS NOT NULL 运算符：

NO_AUTO_VALUE_ON_ZERO 禁止自动递增为 0，以便只有 NULL 生成下一个序列号。如果 0 已存储在表的 AUTO_INCREMENT 列中，则此模式很有用。（顺便说一句，不推荐存储 0。）

要更改用于新行的 AUTO_INCREMENT 计数器的值：

```
ALTER TABLE mytable AUTO_INCREMENT = value; 
```

或 SET INSERT_ID = 值；

除非另有说明，否则该值将以： 1000000 开头，或者这样指定：

...) ENGINE=MyISAM 默认字符集=latin1 AUTO_INCREMENT=1

# 时间戳：

TIMESTAMP 列的值从当前时区转换为 UTC 进行存储，从 UTC 转换为当前时区进行检索。

[http://dev.mysql.com/doc/refman/5.1/en/timestamp.html](http://dev.mysql.com/doc/refman/5.1/en/timestamp.html) 对于表中的一个 TIMESTAMP 列，您可以将当前时间戳指定为默认值和自动更新值。

在 WHERE 子句中使用其中一种类型时要注意的一件事是，最好使用 WHERE datecolumn = FROM_UNIXTIME(1057941242) 而不是 WHERE UNIX_TIMESTAMP(datecolumn) = 1057941242。后者不会利用索引在那一栏。

[http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html)

```
 UNIX_TIMESTAMP() 
 FROM_UNIXTIME() 
 UTC_DATE()
 UTC_TIME()
 UTC_TIMESTAMP() 
```

如果您在 MySQL 中将日期时间转换为 unix 时间戳：
然后将 24 小时添加到它：
然后将其转换回日期时间，它会神奇地失去一个小时！

这是正在发生的事情。将 unix 时间戳转换回日期时间时，会考虑时区，并且恰好在 2006 年 10 月 28 日至 29 日之间，我们关闭了夏令时并损失了一个小时。

从 MySQL 4.1.3 开始，CURRENT_TIMESTAMP()、CURRENT_TIME()、CURRENT_DATE() 和 FROM_UNIXTIME() 函数返回连接的*当前时区*中的值，该时区可用作 time_zone 系统变量的值。此外，UNIX_TIMESTAMP() 假定其参数是当前时区中的日期时间值。

当前时区设置不会影响 UTC_TIMESTAMP() 等函数显示的值或 DATE、TIME 或 DATETIME 列中的值。

注意：ON UPDATE*仅*在字段更改时更新 DateTime 如果 UPDATE 导致没有字段被更改，则 DateTime 不会更新！

此外，第一个 TIMESTAMP 默认始终为 AUTOUPDATE，即使未指定也是如此

在使用 Dates 时，我几乎总是使用 Julian Date，因为数据数学是一个简单的加减整数的问题，而 Seconds since Midnight 出于同样的原因。我很少需要比秒更细粒度的时间分辨率。

这两个都可以存储为一个 4 字节整数，如果空间真的很紧，可以将 UNIX 时间（自 1970 年 1 月 1 日以来的秒数）作为无符号整数组合到 2106 年左右，如下所示：

' 24 小时内的秒数 = 86400

' 有符号整数 max val = 2,147,483,647 - 可以保存 68 年的秒数

' 无符号整数 max val = 4,294,967,295 - 可以保存 136 年的秒数

# 二进制协议：

MySQL 4.1 引入了一种二进制协议，允许以本机格式发送和返回非字符串数据值，而无需与字符串格式进行转换。（非常有用）

另外，mysql_real_query() 比 mysql_query() 快，因为它不调用 strlen() 对语句字符串进行操作。

[http://dev.mysql.com/tech-resources/articles/4.1/prepared-statements.html](http://dev.mysql.com/tech-resources/articles/4.1/prepared-statements.html) 二进制协议支持服务器端准备好的语句，并允许以本机格式传输数据值。在 MySQL 4.1 的早期版本中，二进制协议经历了相当多的修订。

您可以使用 IS_NUM() 宏来测试字段是否具有数字类型。将类型值传递给 IS_NUM()，如果字段为数字，则计算结果为 TRUE：

需要注意的一件事是，如果您对二进制数据进行*转义*并记住 MySQL*只*需要反斜杠和引号字符被转义，则可以在常规查询中发送二进制数据。因此，这是插入较短的二进制字符串（例如加密/加盐密码）的一种非常简单的方法。

# 主服务器：

[http://www.experts-exchange.com/Database/MySQL/Q_22967482.html](http://www.experts-exchange.com/Database/MySQL/Q_22967482.html)

[http://www.databasejournal.com/features/mysql/article.php/10897_3355201_2](http://www.databasejournal.com/features/mysql/article.php/10897_3355201_2)

授予复制奴隶*。*到 slave_user 由“slave_password”识别

```
#Master Binary Logging Config  STATEMENT causes replication 
              to be statement-based -  default

log-bin=Mike
binlog-format=STATEMENT
server-id=1            
max_binlog_size = 10M
expire_logs_days = 120    

#Slave Config
master-host=master-hostname
master-user=slave-user
master-password=slave-password
server-id=2 
```

二进制日志文件必须阅读：

[http://dev.mysql.com/doc/refman/5.0/en/binary-log.html](http://dev.mysql.com/doc/refman/5.0/en/binary-log.html)

[http://www.mydigitallife.info/2007/10/06/how-to-read-mysql-binary-log-files-binlog-with-mysqlbinlog/](http://www.mydigitallife.info/2007/10/06/how-to-read-mysql-binary-log-files-binlog-with-mysqlbinlog/)

[http://dev.mysql.com/doc/refman/5.1/en/mysqlbinlog.html](http://dev.mysql.com/doc/refman/5.1/en/mysqlbinlog.html)

[http://dev.mysql.com/doc/refman/5.0/en/binary-log.html](http://dev.mysql.com/doc/refman/5.0/en/binary-log.html)

[http://dev.mysql.com/doc/refman/5.1/en/binary-log-setting.html](http://dev.mysql.com/doc/refman/5.1/en/binary-log-setting.html)

您可以使用 RESET MASTER 语句删除所有二进制日志文件，或使用 PURGE MASTER 删除其中的一部分

--result-file=binlog.txt TrustedFriend-bin.000030

# 正常化：

[http://dev.mysql.com/tech-resources/articles/intro-to-normalization.html](http://dev.mysql.com/tech-resources/articles/intro-to-normalization.html)

# UDF 函数

[http://www.koders.com/cpp/fid10666379322B54AD41AEB0E4100D87C8CDDF1D8C.aspx](http://www.koders.com/cpp/fid10666379322B54AD41AEB0E4100D87C8CDDF1D8C.aspx)

[http://souptonuts.sourceforge.net/readme_mysql.htm](http://souptonuts.sourceforge.net/readme_mysql.htm)

# 数据类型：

[http://dev.mysql.com/doc/refman/5.1/en/storage-requirements.html](http://dev.mysql.com/doc/refman/5.1/en/storage-requirements.html)

[http://www.informit.com/articles/article.aspx?p=1238838&seqNum=2](http://www.informit.com/articles/article.aspx?p=1238838&seqNum=2)

[http://bitfilm.net/2008/03/24/saving-bytes-efficient-data-storage-mysql-part-1/](http://bitfilm.net/2008/03/24/saving-bytes-efficient-data-storage-mysql-part-1/)

需要注意的一点是，在具有 CHAR 和 VARCHAR 的混合表上，mySQL 会将 CHAR 更改为 VARCHAR

RecNum integer_type UNSIGNED NOT NULL AUTO_INCREMENT, PRIMARY KEY (RecNum)

根据标准 SQL 和 ISO 8601 规范，MySQL 始终以年份表示日期

# 杂项：

关闭一些 MySQl 功能将导致更小的数据文件和更快的访问。例如：

--datadir 将指定数据目录和

--skip-innodb 将关闭 inno 选项并为您节省 10-20M

更多在这里 [http://dev.mysql.com/tech-resources/articles/mysql-c-api.html](http://dev.mysql.com/tech-resources/articles/mysql-c-api.html)

下载第 7 章 - 免费

InnoDB 是事务性的，但随之而来的是性能开销。我发现 MyISAM 表足以满足我 90% 的项目。非事务安全表 (MyISAM) 有自己的几个优点，所有这些都是因为：

没有交易开销：

快多了

降低磁盘空间要求

执行更新所需的内存更少

每个 MyISAM 表都存储在磁盘上的三个文件中。这些文件的名称以表名开头，并具有指示文件类型的扩展名。.frm 文件存储表格格式。数据文件具有 .MYD (MYData) 扩展名。索引文件具有 .MYI (MYIndex) 扩展名。

这些文件*可以*原封不动地复制到存储位置，而无需使用耗时的 MySQL 管理员备份功能（还原也是如此）

诀窍是制作这些文件的副本，然后 DROP 表。当你把文件放回去时，MySQl 会识别它们并更新表跟踪。

如果您必须备份/恢复，

恢复备份或从现有转储文件导入可能需要很长时间，具体取决于您在每个表上拥有的索引和主键的数量。您可以通过使用以下内容来修改原始转储文件来显着加快此过程：

```
SET AUTOCOMMIT = 0;
SET FOREIGN_KEY_CHECKS=0;

.. your dump file ..

SET FOREIGN_KEY_CHECKS = 1;
COMMIT;
SET AUTOCOMMIT = 1; 
```

要大大提高重新加载的速度，请添加 SQL 命令 SET AUTOCOMMIT = 0; 在转储文件的开头，并添加 COMMIT；命令到最后。

默认情况下，自动提交是打开的，这意味着转储文件中的每个插入命令都将被视为一个单独的事务，并在下一个启动之前写入磁盘。如果不添加这些命令，将大型数据库重新加载到 InnoDB 可能需要很多小时......

MySQL 表中行的最大大小为 65,535 字节

MySQL 5.0.3 及更高版本中 VARCHAR 的有效最大长度 = 最大行大小（65,535 字节）

VARCHAR 值在存储时不会被填充。按照标准 SQL，在存储和检索值时保留尾随空格。

MySQL 中的 CHAR 和 VARCHAR 值在比较时不考虑尾随空格。

如果整个记录是固定大小的，使用 CHAR 只会加快您的访问速度。也就是说，如果您使用任何可变大小的对象，您不妨将它们全部设为可变大小。在还包含 VARCHAR 的表中使用 CHAR 不会提高速度。

自 MySQL 5.0.3 起，255 个字符的 VARCHAR 限制已提高到 65535 个字符

仅 MyISAM 表支持全文搜索。

[http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html)

BLOB 列没有字符集，排序和比较是基于列值中字节的数值

如果未启用严格 SQL 模式，并且您为 BLOB 或 TEXT 列分配的值超过了列的最大长度，则该值将被截断以适应并生成警告。

# 有用的命令：

检查严格模式：SELECT @@global.sql_mode；

关闭严格模式：

SET @@global.sql_mode='';

SET @@global.sql_mode='MYSQL40'

或删除： sql-mode="STRICT_TRANS_TABLES,...

显示来自的列`mytable`

SELECT max(namecount) AS `virtualcolumn`FROM mytable ORDER BY virtualcolumn

[http://dev.mysql.com/doc/refman/5.0/en/group-by-hidden-fields.html](http://dev.mysql.com/doc/refman/5.0/en/group-by-hidden-fields.html)

[http://dev.mysql.com/doc/refman/5.1/en/information-functions.html#function_last-insert-id](http://dev.mysql.com/doc/refman/5.1/en/information-functions.html#function_last-insert-id) last_insert_id()

为您获取当前线程中插入的最后一行的 PK max(pkcolname) 为您提供最后一个 PK。

注意：如果表为空 max(pkcolname) 返回 1 mysql_insert_id() 将本机 MySQL C API 函数 mysql_insert_id() 的返回类型转换为 long 类型（在 PHP 中命名为 int）。

如果您的 AUTO_INCREMENT 列具有 BIGINT 列类型，则 mysql_insert_id() 返回的值将不正确。相反，在 SQL 查询中使用内部 MySQL SQL 函数 LAST_INSERT_ID()。

[http://dev.mysql.com/doc/refman/5.0/en/information-functions.html#function_last-insert-id](http://dev.mysql.com/doc/refman/5.0/en/information-functions.html#function_last-insert-id)

请注意，当您尝试将数据插入表中时会出现错误：

```
Unknown column ‘the first bit of data what you want to put into the table‘ in ‘field list’ 
```

使用类似的东西

```
INSERT INTO table (this, that) VALUES ($this, $that) 
```

这是因为你没有在你试图粘贴到表格中的值周围加上任何撇号。因此，您应该将代码更改为：

```
INSERT INTO table (this, that) VALUES ('$this', '$that') 
```

提醒 `` 用于定义 MySQL 字段、数据库或表，而不是值；）

查询期间失去与服务器的连接：

[http://dev.mysql.com/doc/refman/5.1/en/gone-away.html](http://dev.mysql.com/doc/refman/5.1/en/gone-away.html)

[http://dev.mysql.com/doc/refman/5.1/en/packet-too-large.html](http://dev.mysql.com/doc/refman/5.1/en/packet-too-large.html)

[http://dev.mysql.com/doc/refman/5.0/en/server-parameters.html](http://dev.mysql.com/doc/refman/5.0/en/server-parameters.html)

[http://dev.mysql.com/doc/refman/5.1/en/show-variables.html](http://dev.mysql.com/doc/refman/5.1/en/show-variables.html)

[http://dev.mysql.com/doc/refman/5.1/en/option-files.html](http://dev.mysql.com/doc/refman/5.1/en/option-files.html)

[http://dev.mysql.com/doc/refman/5.1/en/error-log.html](http://dev.mysql.com/doc/refman/5.1/en/error-log.html)

# 调优查询

[http://www.artfulsoftware.com/infotree/queries.php?&bw=1313](http://www.artfulsoftware.com/infotree/queries.php?&bw=1313)

嗯，这应该足以赚取我认为的奖金......许多小时和许多项目的成果，以及一个很棒的*免费*数据库。我主要使用 MySQL 在 Windows 平台上开发应用程序数据服务器。我不得不理顺的最糟糕的烂摊子是

[终极 MySQL 遗留数据库噩梦](https://stackoverflow.com/questions/101333/the-ultimate-mysql-legacy-database-nightmare)

这需要一系列应用程序来使用这里提到的许多技巧将表格处理成有用的东西。

如果您发现这非常有帮助，请通过投票表示感谢。

另请查看我的其他文章和白皮书：www.coastrd.com

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-15T16:21:00.690

MySQL 的一个不那么隐藏的特性是它不太擅长与 SQL 兼容，嗯，不是真正的错误，但是，更多的[陷阱](http://sql-info.de/mysql/gotchas.html)...... :-)

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-12-15T16:30:24.823

用于找出缓存中当前有哪些表的命令：

```
mysql> SHOW open TABLES FROM test;
+----------+-------+--------+-------------+
| DATABASE | TABLE | In_use | Name_locked |
+----------+-------+--------+-------------+
| test     | a     |      3 |           0 |
+----------+-------+--------+-------------+
1 row IN SET (0.00 sec) 
```

（来自[MySQL 性能博客](http://www.mysqlperformanceblog.com/2008/12/14/show-open-tables-what-is-in-your-table-cache/)）

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-12-15T16:22:43.840

找出谁在做什么的命令：

```
mysql> show processlist;
show processlist;
+----+-------------+-----------------+------+---------+------+----------------------------------+------------------+
| Id | User        | Host            | db   | Command | Time | State                            | Info             |
+----+-------------+-----------------+------+---------+------+----------------------------------+------------------+
|  1 | root        | localhost:32893 | NULL | Sleep   |    0 |                                  | NULL             |
|  5 | system user |                 | NULL | Connect |   98 | Waiting for master to send event | NULL             |
|  6 | system user |                 | NULL | Connect | 5018 | Reading event from the relay log | NULL             |
+-----+------+-----------+---------+---------+-------+-------+------------------+
3 rows in set (0.00 sec) 
```

你可以杀死一个进程：

```
mysql>kill 5 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-12-22T10:20:28.727

`inet_ntoa()`我特别喜欢 MySQL 对和的内置支持`inet_aton()`。它使处理表中的 IP 地址变得非常简单（至少只要它们只是 IPv4 地址！）

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-06-21T20:35:03.703

我喜欢[`on duplicate key`](http://dev.mysql.com/doc/refman/5.1/en/insert-on-duplicate.html)（AKA upsert，merge）懒惰创建的各种计数器：

```
insert into occurances(word,count) values('foo',1),('bar',1) 
  on duplicate key cnt=cnt+1 
```

您可以在一个查询中插入多行，并立即处理每一行的重复索引。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-06-22T11:31:12.730

再次 - 不是真正隐藏的功能，但非常方便：

**特征**

轻松抓取 DDL：

`SHOW CREATE TABLE CountryLanguage`

输出：

```
CountryLanguage | CREATE TABLE countrylanguage (
  CountryCode char(3) NOT NULL DEFAULT '',
  Language char(30) NOT NULL DEFAULT '',
  IsOfficial enum('T','F') NOT NULL DEFAULT 'F',
  Percentage float(4,1) NOT NULL DEFAULT '0.0',
  PRIMARY KEY (CountryCode,Language)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 
```

**功能： GROUP_CONCAT() 聚合函数** 为每个详细信息创建其参数的连接字符串，并通过连接每个组的参数进行聚合。

示例 1：简单

```
SELECT   CountryCode
,        GROUP_CONCAT(Language) AS List
FROM     CountryLanguage
GROUP BY CountryCode 
```

输出：

```
+-------------+------------------------------------+
| CountryCode | List                               |
+-------------+------------------------------------+
| ABW         | Dutch,English,Papiamento,Spanish   |
. ...         . ...                                .
| ZWE         | English,Ndebele,Nyanja,Shona       |
+-------------+------------------------------------+ 
```

示例 2：多个参数

```
SELECT   CountryCode
,        GROUP_CONCAT(
             Language
,            IF(IsOfficial='T', ' (Official)', '')
         )               AS List
FROM     CountryLanguage
GROUP BY CountryCode 
```

输出：

```
+-------------+---------------------------------------------+
| CountryCode | List                                        |
+-------------+---------------------------------------------+
| ABW         | Dutch (Official),English,Papiamento,Spanish |
. ...         . ...                                         .
| ZWE         | English (Official),Ndebele,Nyanja,Shona     |
+-------------+---------------------------------------------+ 
```

示例 3：使用自定义分隔符

```
SELECT   CountryCode
,        GROUP_CONCAT(Language SEPARATOR ' and ') AS List
FROM     CountryLanguage
GROUP BY CountryCode 
```

输出：

```
+-------------+----------------------------------------------+
| CountryCode | List                                         |
+-------------+----------------------------------------------+
| ABW         | Dutch and English and Papiamento and Spanish |
. ...         . ...                                          .
| ZWE         | English and Ndebele and Nyanja and Shona     |
+-------------+----------------------------------------------+ 
```

示例 4：控制列表元素的顺序

```
SELECT   CountryCode
,        GROUP_CONCAT(
         Language
         ORDER BY CASE IsOfficial WHEN 'T' THEN 1 ELSE 2 END DESC
         ,        Language
         )               AS List
FROM     CountryLanguage
GROUP BY CountryCode 
```

输出：

```
+-------------+------------------------------------+
| CountryCode | List                               |
+-------------+------------------------------------+
| ABW         | English,Papiamento,Spanish,Dutch,  |
. ...         . ...                                .
| ZWE         | Ndebele,Nyanja,Shona,English       |
+-------------+------------------------------------+ 
```

**特征：具有多个表达式的 COUNT(DISTINCT)**

您可以在 COUNT(DISTINCT ...) 表达式中使用多个表达式来计算组合数。

`SELECT COUNT(DISTINCT CountryCode, Language) FROM CountryLanguage`

**Feature / Gotcha：无需在 GROUP BY 列表中包含非聚合表达式**

大多数 RDBMS 强制执行符合 SQL92 的 GROUP BY，它要求 SELECT 列表中的所有非聚合表达式都出现在 GROUP BY 中。在这些 RDBMS-es 中，此语句：

```
SELECT     Country.Code, Country.Continent, COUNT(CountryLanguage.Language)
FROM       CountryLanguage 
INNER JOIN Country 
ON         CountryLanguage.CountryCode = Country.Code
GROUP BY   Country.Code 
```

无效，因为 SELECT 列表包含未出现在 GROUP BY 列表中的非聚合列 Country.Continent。在这些 RDBMS-es 中，您必须修改 GROUP BY 列表以读取

```
GROUP BY   Country.Code, Country.Continent 
```

或者您必须向 Country.Continent 添加一些无意义的聚合，例如

```
SELECT     Country.Code, MAX(Country.Continent), COUNT(CountryLanguage.Language) 
```

现在，问题是，从逻辑上讲，没有什么要求 Country.Continent 应该聚合。看，Country.Code 是 Country 表的主键。Country.Continent 也是 Country 表中的一列，因此在功能上依赖于主键 Country.Code 的定义。因此，对于每个不同的 Country.Code，Country.Continent 中必须只存在一个值。如果您意识到这一点，那么您就会意识到聚合它（只有一个值，对的）或按它分组（因为它不会使结果更加独特，因为您已经在分组） PK）

无论如何 - MySQL 允许您在 SELECT 列表中包含非聚合列，而无需您将它们也添加到 GROUP BY 子句中。

问题在于，如果您碰巧使用非聚合列，MySQL 不会保护您。所以，这样的查询：

```
SELECT     Country.Code, COUNT(CountryLanguage.Language), CountryLanguage.Percentage
FROM       CountryLanguage 
INNER JOIN Country 
ON         CountryLanguage.CountryCode = Country.Code
GROUP BY   Country.Code 
```

将毫无怨言地执行，但 CountryLanguage.Percentage 列将包含无意义的内容（也就是说，在所有语言百分比中，将随机选择百分比的可用值之一，或者至少在您的控制之外。

见：[揭穿集团的神话](http://rpbouman.blogspot.com/2007/05/debunking-group-by-myths.html)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-06-22T06:14:55.957

客户端中的“寻呼机”命令

例如，如果您的结果中有 10,000 行并想要查看它们（这假定“less”和“tee”命令可用，这在 Linux 下通常是这种情况；在 Windows YMMV 中。）

```
pager less
select lots_of_stuff FROM tbl WHERE clause_which_matches_10k_rows; 
```

你会在“less”文件查看器中找到它们，这样你就可以很好地翻页、搜索等。

还

```
pager tee myfile.txt
select a_few_things FROM tbl WHERE i_want_to_save_output_to_a_file; 
```

将方便地写入文件。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-02-27T20:52:40.033

您可能会发现一些有趣的事情：

```
<query>\G -- \G in the CLI instead of the ; will show one column per row
explain <query>; -- this will show the execution plan for the query 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-03-06T00:54:37.547

不是隐藏功能，但仍然有用：http: [//mtop.sourceforge.net/](http://mtop.sourceforge.net/)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-03T06:19:04.750

以下是我的一些技巧 - 我在我的博客（[链接](http://technikhil.wordpress.com/category/mysql/)）中写了关于它们的博客

1.  声明变量时不需要使用“@”符号。
2.  您必须使用分隔符（默认为';'）来划分语句的结尾 -[链接](http://technikhil.wordpress.com/2007/03/13/nikhil-in-mysql-land-2-2/)
3.  如果您尝试在 MS-SQL 2005 和 mySQL 之间移动数据，则需要跳过一些障碍 -[链接](http://technikhil.wordpress.com/2007/05/13/getting-microsoft-sql-server-and-mysql-to-talk/)
4.  在 mySQL 中进行区分大小写的匹配 -[链接](http://technikhil.wordpress.com/2007/09/17/case-sensitive-matches-in-mysql/)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-03-03T06:45:16.077

如果您要使用大型和/或高事务 InnoDb 数据库学习并理解“SHOW INNODB STATUS” [Mysql 性能博客](http://www.mysqlperformanceblog.com/2006/07/17/show-innodb-status-walk-through/)，它将成为您的朋友。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-06-20T13:18:28.940

如果使用 cmdline Mysq，您可以使用尖叫/感叹号与命令行交互（在 Linux 机器上 - 不确定在 Windows 上是否有等效效果）。例如：

```
\! cat file1.sql 
```

将显示 file1.sql 的代码。要将您的语句和查询保存到文件中，请使用 tee 工具

```
\T filename 
```

要关闭此功能，请使用 \t

最后，要运行您已经保存的脚本，请使用“源文件名”。当然，正常的替代方法是在命令行启动mysql时直接输入脚本名：

```
 mysql -u root -p < case1.sql 
```

希望这对某人有用！

编辑：只记得另一个 - 从命令行调用 mysql 时，您可以使用 -t 开关，以便输出为表格格式 - 对一些查询来说是一个真正的好处（当然，如这里其他地方提到的，使用 \G 终止查询也是在这方面有帮助）。更多关于各种开关的[命令行工具](http://www.techotopia.com/index.php/The_mysql_Command-Line_Tool)

刚刚找到了一种更改排序顺序的巧妙方法（通常使用案例...）如果您想更改排序顺序（可能按 1, 4, 3 ,2 而不是 1, 2, 3 排序， 4) 您可以在 Order by 子句中使用字段函数。例如

按字段排序（sort_field,1,4,3,2）

*   [在 MySQL 中按 day_of_week](https://stackoverflow.com/questions/1126961/order-by-dayofweek-in-mysql)排序，由用户 gms8994提供

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2011-09-21T12:14:54.120

我不认为这是特定于 MySQL 的，但对我来说很有启发性：

而不是写

```
WHERE (x.id > y.id) OR (x.id = y.id AND x.f2 > y.f2) 
```

你可以写

```
WHERE (x.id, x.f2) > (y.id, y.f2) 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-06-22T11:53:25.383

mysqlsla - 非常常用的慢查询日志分析工具之一。自您上次推出慢查询日志以来，您可以看到前 10 个最差查询。它还可以告诉您 BAD 查询被触发的次数以及它在服务器上花费的总时间。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-07-12T12:20:12.423

实际上[记录在案](http://dev.mysql.com/doc/refman/5.0/en/constraint-invalid-data.html)，但很烦人：错误日期和其他错误输入的自动转换。

> 在 MySQL 5.0.2 之前，MySQL 允许非法或不正确的数据值，并强制它们为数据输入的合法值。在 MySQL 5.0.2 及更高版本中，这仍然是默认行为，但您可以更改服务器 SQL 模式以选择更传统的错误值处理方式，以便服务器拒绝它们并中止它们发生的语句。

至于日期：有时当 MySQL 不将输入调整为附近的有效日期，而是将其存储为`0000-00-00`根据定义无效的日期时，您会很“幸运”。但是，即使那样，您也可能希望 MySQL 失败，而不是默默地为您存储此值。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2011-03-16T14:57:53.797

内置[SQL Profiler](http://dev.mysql.com/doc/refman/5.0/en/show-profiles.html)。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-06-05T08:08:23.850

InnoDB 默认将所有表存储在一个*永远不会收缩*的全局表空间中。

您可以使用`innodb_file_per_table`which 将每个表放在一个单独的表空间中，当您删除表或数据库时，该表空间将被删除。

提前为此做好计划，因为否则您必须转储和恢复数据库以回收空间。

[使用每表表空间](http://dev.mysql.com/doc/refman/5.1/en/multiple-tablespaces.html)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-08-01T12:04:00.640

如果您在日期时间列中插入空字符串值“”，MySQL 将保留该值作为 00/00/0000 00:00:00。不像Oracle，它将保存空值。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2011-10-08T17:15:48.283

在我对大型数据集和 DATETIME 字段进行基准测试期间，执行此查询总是较慢：

```
SELECT * FROM mytable
WHERE date(date_colum) BETWEEN '2011-01-01' AND ''2011-03-03'; 
```

比这种方法：

```
SELECT * FROM mytable
WHERE date_column BETWEEN '2011-01-01 00:00:00' AND '2011-03-03 23:59:59' 
```

# inversion-of-control - Castle Windsor：如何以编程方式将列表参数传递给容器？

> ID：368866
> 
> 赞同：6
> 
> 时间：2008-12-15T16:12:04.047
> 
> 标签：inversion-of-control, castle-windsor

解析类型时是否可以传递列表构造函数参数？如果可能，我想使用编程配置。我一直在玩参数方法，如下所示，但我还没有偶然发现答案。

```
container.Register(
    Component
    .For<IDoSomething>()
    .ImplementedBy<DoSomething>()
    .Parameters(...)
); 
```

DoSomething 类看起来像这样

```
public class DoSomething : IDoSomething
{
    public DoSomething(List<string> listOfStrings) 
    {
        ...
    }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T16:30:22.637

啊哈！

```
container.Register(
    Component
    .For<IDoSomething>()
    .ImplementedBy<DoSomething>()
    .Parameters(new { listOfStrings = someList })
); 
```

# c# - 在未能加载预期的注册表设置时抛出的最合适的 .NET 异常是什么？

> ID：368879
> 
> 赞同：10
> 
> 时间：2008-12-15T16:18:19.277
> 
> 标签：c#, .net

我有一个应用程序尝试在其构造函数中加载一些预期的注册表设置。

如果无法加载这些（基本的、不可默认的）注册表设置，那么从 BCL 抛出的最合适的 .NET 异常是什么？

例如：

```
 RegistryKey registryKey = Registry.LocalMachine.OpenSubkey("HKLM\Foo\Bar\Baz");

 // registryKey might be null!
 if (registryKey == null)
 {
     // What exception to throw?
     throw new ???Exception("Could not load settings from HKLM\foo\bar\baz.");
 } 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-15T16:24:45.083

为什么不创建您的自定义异常？

```
public class KeyNotFoundException : RegistryException
{
    public KeyNotFoundException(string message)
        : base(message) { }
}
public class RegistryException : Exception
{
    public RegistryException(string message)
        : base(message) { }
}

....

if (registryKey == null)
{
    throw new KeyNotFoundException("Could not load settings from HKLM\foo\bar\baz.");
} 
```

此外，`Exception`您可以继承自`ApplicationException`. 这取决于您希望应用程序在这种情况下发生的故障类型。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T16:22:28.690

实际上，我不会在这里抛出异常。我将有一个默认值，然后使用该默认值创建密钥。

如果你必须有一个用户定义的值，我会使用 ArgumentException （因为这基本上是你所缺少的，你的构造函数的一个参数 - 你存储它的位置与你试图生成的异常类型无关）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-15T16:22:22.263

我会选择[ArgumentException](http://msdn.microsoft.com/en-us/library/system.argumentexception.aspx)或[ArgumentOutOfRangeException](http://msdn.microsoft.com/en-us/library/system.argumentoutofrangeexception.aspx) ..

```
throw new ArgumentException("Could not find registry key: " + theKey); 
```

引用 MSDN：

> 当提供给方法的参数之一无效时引发的异常。

...

**IMO 编写适当的异常消息更为重要。**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T16:25:44.270

这取决于失败的原因。如果是权限问题，我会`System.UnauthorizedAccess`例外：

> 当操作系统由于 I/O 错误或特定类型的安全错误而拒绝访问时引发的异常。

我不知道它是否与“特定类型”匹配，但这是一个安全错误，并且未授权访问。

另一方面，如果该项目不存在，那么我会抛出`FileNotFound`异常。当然，注册表项不是文件，但 FileNotFound 很好理解。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T17:01:34.290

既然你说这个条目是一个本质的值，那么如果这个值得不到，对你的应用有什么影响呢？您需要拖运操作还是只需要通知应用程序。

此外，该值可能为 null 的原因有很多

*   用户无权读取密钥
*   密钥不存在

这会影响您在使用该应用程序时采取的行动吗？

我认为这些类型的场景会影响抛出什么异常。就我个人而言，我永远不会只抛出异常，因为它确实是标准设计实践中的“禁忌”。

如果是由于用户没有权限，并且没有此权限可能会导致将来出现问题，我会投票支持 UnauthroizedAccess 异常。

如果问题不是关键问题，但您确实需要知道密钥不存在，我强烈推荐 elsehwere 中提到的“KeyNotFoundException”实现。

抛出异常时，您要确保抛出的异常是描述性的并提供所有需要的信息，因此我认为这取决于根本原因以及对应用程序的整体影响。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-15T18:19:06.273

引用 MSDN 的《开发类库的设计指南》

> **应用程序异常**
> 
> 如果您正在设计需要创建自己的异常的应用程序，建议您从 Exception 类派生自定义异常。最初认为自定义异常应该从 ApplicationException 类派生；然而，在实践中，这并没有增加显着的价值。有关详细信息，请参阅处理异常的最佳实践。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-15T17:02:46.160

我认为最好的方法是退后一步。如果没有一个明确的例外来描述正在发生的事情，那么只需几分钟就可以定义一个。尽量避免重新利用异常，因为它“足够接近”。

我的建议是您应该创建一个从 Exception 或 ApplicationException 继承的基本异常类。这将允许您从堆栈跟踪中轻松识别异常是您定义的自定义异常还是源自其他地方。您的所有自定义异常都应继承自您创建的基本异常。

*注意：我不建议使用 Exception 或 ApplicationException。社区与 Microsoft 的文档中存在足够多的争论，即应该使用哪些文档以及用于什么目的。在个人层面上，我选择异常作为我的基本异常。*

如果没有与您的意图相匹配的明确预定义的异常，请继续从您的基本异常派生自定义异常。它肯定有助于追查问题的根源，使它们更容易处理（想象一个现有的框架异常是在代码块中引发的，但是是由框架或其他方法引发的），而且很简单。

请记住，您可以有多个异常层次结构来将类似的异常组合在一起。例如，我可以拥有继承 ApplicationException 或 Exception 的 MyBaseException。然后我可以有一个更通用的 MyRegsitryException，它继承自 MyBaseException。然后我可以有特定的异常，例如 MyRegistryKeyNotFoundException 或 MyRegistryKeyPermissionException。

这允许您在更高级别捕获分组异常并减少您可能拥有的包含冗余处理机制的捕获数量。将此与将异常的范围隔离到将使用它们的特定名称空间相结合，您就有了一个非常干净的异常处理方案的开始。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T16:21:48.723

我可能会抛出一个 ApplicationException，因为这与您的应用程序特别相关。或者，您可以抛出 ConfigurationErrorsException，尽管这通常与解析应用程序配置文件的错误相关联，而不是从注册表中读取配置。

想到的其他潜在异常是 ArgumentException 或 ArgumentNullException，但它们具有与传递给方法的参数相关的含义，因此不适合我的想法。当试图确定它为什么不起作用时，它很容易导致使用/修改您的代码的人误入歧途。

无论如何，一个好的、描述性的错误消息可能是传达问题所在的最有效方式。

**编辑：**请注意，在 null 值上引发异常不会掩盖尝试读取注册表值时可能发生的任何异常。我相信，只要您不将其包装在 try/catch 块中，当您尝试读取没有足够权限的值时抛出的任何 SecurityException 仍然会发生。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-12-15T16:25:10.667

我认为只有异常本身可以完成这项工作。如果您的信息足够具有描述性，那么一切都很好。如果您真的想准确地说，那么我会同意 petr k。只是滚动你自己的。

# stored-procedures - Sql 查询通知是否适用于 clr 存储过程？

> ID：368889
> 
> 赞同：0
> 
> 时间：2008-12-15T16:21:48.910
> 
> 标签：stored-procedures, caching, clr

尝试在我们的数据集上设置缓存 - 我们正在使用 clr 存储过程 - 数据库似乎没有通知应用程序数据更改

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T13:13:34.963

经过大量测试，答案似乎是否定的……它似乎不适用于 CLR 存储过程。

# parsing - 解析资源

> ID：368895
> 
> 赞同：0
> 
> 时间：2008-12-15T16:22:50.390
> 
> 标签：parsing

有谁知道与解析相关的任何资源（书籍/网站/任何东西）。我对特定技术（如 yacc、XML 或正则表达式）不太感兴趣，但对最佳实践、流与拉取、错误报告和恢复、需要注意的问题等更一般的东西感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T16:31:55.163

有一本关于解析技术的好书[Parsing Techniques, a Practical Guige](http://www.cs.vu.nl/~dick/PTAPG.html)。你应该能够找到一些有趣的部分。有关于错误处理的完整章节。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T17:42:17.313

这可能不是您的意思，而是一本非常好的书，而且有点相关； [数据处理：使用 Java、Python 等解决日常问题](http://www.pragprog.com/titles/gwd/data-crunching)

# asp.net-mvc - 来自模型的 ASP.NET MVC 访问应用程序属性

> ID：368902
> 
> 赞同：-1
> 
> 时间：2008-12-15T16:25:38.763
> 
> 标签：asp.net-mvc, vb.net

我的 global.asax 看起来像这样

```
Imports Castle.Windsor
Imports Castle.Windsor.Configuration.Interpreters

Public Class MvcApplication
    Inherits System.Web.HttpApplication
    Implements IContainerAccessor

    Private Shared IoC As IWindsorContainer

    Shared Sub RegisterRoutes(ByVal routes As RouteCollection)
        routes.IgnoreRoute("{resource}.axd/{*pathInfo}")

        ' MapRoute takes the following parameters, in order:
        ' (1) Route name
        ' (2) URL with parameters
        ' (3) Parameter defaults
        routes.MapRoute( _
            "Default", _
            "{controller}/{action}/{id}", _
            New With {.controller = "Home", .action = "Index", .id = ""} _
        )

    End Sub

    Sub Application_Start()
        RegisterRoutes(RouteTable.Routes)
        IoC = New WindsorContainer(New XmlInterpreter)
    End Sub

    Public ReadOnly Property Container() As Castle.Windsor.IWindsorContainer Implements Castle.Windsor.IContainerAccessor.Container
        Get
            Return IoC
        End Get
    End Property
End Class 
```

我如何从任何模型类中访问容器属性？是否有一个我可以继承的类，它给了我视图中的“应用程序”属性，所以我可以这样做

IoC = Application.Item("Container")...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T20:10:33.660

您可能不希望您的模型对象知道您的 IoC 容器。

但是，为了回答您的问题，您可以像这样访问它：

（C＃）

```
var container = ((IContainerAccessor)MvcApplication).Container; 
```

# asp.net - 控制对表单字段的访问的最佳实践

> ID：368904
> 
> 赞同：5
> 
> 时间：2008-12-15T16:25:59.993
> 
> 标签：asp.net

我有一个经典的 3 层 ASP.Net 3.5 Web 应用程序，其中包含显示业务对象并允许对其进行编辑的表单。表单上的控件对应于底层业务对象的属性。根据他/她的角色，用户将对各种控件具有读/写、只读或无访问权限。很传统的东西。

我的问题是：编写此代码的面向对象的最佳实践是什么？有什么比将每个控件包装在用户角色的测试中并设置其 Visible 和 Enabled 属性更优雅的呢？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T18:08:39.227

你会想把它从数据中剔除，相信我。你需要很多表才能做到这一点，但最终还是值得的。每次企业想要更改权限时，都必须破解开放代码并编辑一堆 if 语句是一个杀手。

您将需要一个用于主要高级类型的表，您可能已经拥有业务对象类。然后是他们每个状态的表格。然后是这些类的字段的表。然后是用户角色（管理员、访客等）的表。最后是权限本身的表。此表将包含业务类、状态、字段、用户角色以及他们拥有的权限的列。对于权限，我会使用一个字段并使用枚举：隐藏、只读、可编辑和必需。必需意味着可编辑。除了隐藏之外的任何东西都意味着可见。最后在此表上放置一个优先级列，以控制在可能应用多个权限时使用哪个权限。

您使用类、状态、字段、角色和权限的各种组合来填写此表。如果一个值为空，那么它适用于所有可能的值。所以你不需要一万亿行来覆盖你所有的基地。例如，在 99% 的情况下，来宾用户都是只读用户。因此，您可以在表中放置一个条目，仅指定 Guest 角色，其他所有内容为空，并将其设置为 nice 和 high，并将权限设置为只读。现在对于所有课程、所有状态、所有字段，如果用户是访客，他们将拥有只读权限。

我将状态添加到您的关注列表中，因为根据我的经验，企业一直希望通过对象的状态来限制事物。因此，例如，也许用户可以在项目处于草稿状态时编辑项目的名称，但是一旦处于已发布状态，名称就不再可编辑。这在我的经验中很常见。

您希望将此表带入内存并将其存储在应用程序的缓存中，因为它不会经常更改（如果有的话），除非您制作一个全新的版本。

现在，我怀疑以上内容将满足您 90% 的需求。

除非您想真正花哨，否则必须在代码中处理的一个领域是用户的权限部分取决于*对象*本身的字段*值的情况。*假设你有一个 Project 类，它有一个 Project Manager 类。现在该类的 Percent Complete 字段基本上对所有人都是只读的，*除了*项目经理。你打算怎么处理？您需要提供一种将类的特定实例合并到决策制定过程中的方法。我在代码中这样做。

 *** * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-16T17:43:23.337

为了正常工作，我发现访问级别应该按递增顺序排列：NONE、VIEW、REQUIRED、EDIT。

请注意，REQUIRED 不是您可能认为的最高级别，因为 EDIT（填充和取消填充权限）比 REQUIRED（仅填充权限）具有更大的权限。

枚举看起来像这样：

```
/** NO permissions.
 *     Presentation: "hidden"
 *     Database: "no access"
 */
NONE(0),

/** VIEW permissions.
 *     Presentation: "read-only"
 *     Database: "read access"
 */
VIEW(1),

/** VIEW and POPULATE permissions.
 *     Presentation: "required/highlighted"
 *     Database: "non-null"
 */
REQUIRED(2),

/** VIEW, POPULATE, and DEPOPULATE permissions.
 *     Presentation: "editable"
 *     Database: "nullable"
 */
EDIT(3); 
```

从底层（数据库约束）创建要访问的字段映射。然后，此地图在下一层（业务规则 + 用户权限）得到更新（进一步限制）。最后，如果需要，顶层（表示规则）可以进一步限制地图。

重要提示：必须包装地图，以便它只允许在任何后续更新中*减少访问。*试图增加访问权限的更新应该被忽略而不触发任何错误。这是因为它应该像一个投票系统一样决定访问应该是什么样子。本质上，上述访问级别的后续分层可以以任何顺序发生，因为一旦所有层都投票，它将导致每个字段的访问级别低水位标记。

后果：

1) 表示层可以为数据库指定的只读 (VIEW) 字段隐藏一个字段（将访问权限设置为 NONE）。

2) 当业务规则说用户至少没有 VIEW 访问权限时，表示层不能显示字段。

3）如果数据库说它只是“必需的”（不可为空），表示层不能将字段的访问权限移动到“可编辑”（可空）。

注意：应该使表示层（自定义显示标签）通过读取访问映射来呈现字段，而不需要任何“if”语句。

用于设置显示的相同访问映射也可以在提交验证期间使用。可以编写通用验证器来读取任何表单及其访问映射，以确保已遵循所有规则。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T16:53:49.843

我经常发现这确实是唯一真正简单易懂的方法，因为您的界面需要根据他们可以完成的信息和编辑级别进行修改。

我确实发现通常情况下，根据需要，如果您计划移动到不同的表示级别，您可以通过将角色信息传递到业务级别来插入“无法编辑”信息。但这增加了复杂性，如果您只为一个界面构建，那很可能是矫枉过正

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T17:11:29.247

我以更面向对象的方式执行此操作的第一直觉是处理您的角色及其为此目的的实现（控制权限读/写/等）是为您的角色使用抽象工厂模式。如果您愿意，我很乐意解释我所说的内容的来龙去脉，但网络上可能有 900 个示例。这是[一个链接](http://geekswithblogs.net/SanjayU/archive/2008/12/15/another-abstract-factory-explanation.aspx)（免责声明：这是我的博客，但它确实谈到了专门针对角色使用抽象工厂）

使用类似的方法，您可以使用多种方法为每个具有正确属性（读/写/隐藏/显示/等）的业务对象属性显示正确的控件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T21:19:06.190

对于网站菜单，我们可以使用站点地图根据用户角色拥有不同的菜单。对于像按钮这样的控件，我们将不得不使用它们的 Visible 属性来隐藏它们。我认为一个好主意是创建一个服务器控件（按钮）并公开 Role 属性。如果用户不是正确的角色，这将隐藏按钮。

# .net - 从通过 WCF 代理发送的 SOAP 消息中删除可选值类型元素

> ID：368906
> 
> 赞同：1
> 
> 时间：2008-12-15T16:27:20.990
> 
> 标签：.net, wcf

我们有一个指定日期时间元素的 wsdl。在 minOccurs=0 的意义上，它是可以为空的。但是，使用 svcutil 生成代理类并没有为我们提供 .net 可为空的 DateTime 属性，那么我们如何才能最好地使代理类将消息序列化为不包含 datetime 元素的 SOAP 消息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T23:15:47.593

svcutil 通过生成一个名为“xxxSpecified”（其中“xxx”是元素名称）的额外布尔属性来处理元素被标记为 minOccurs="0" 的情况。要从 SOAP 消息中排除该元素，您必须将该属性设置为 false。要包含该元素，您必须将该属性设置为 true。

因此，如果元素被称为“Fred”，svcutil 会在代理类中为您提供两个属性：

日期时间弗雷德

和

布尔弗雷德指定

如果要在 SOAP 消息中包含 Fred，则应将 Fred 属性设置为要发送的日期时间，并将 FredSpecified 设置为 true。

如果您不想在 SOAP 消息中包含 Fred，则应将 FredSpecified 设置为 false（并且 Fred 属性中的值无关紧要）。

如果您的 WSDL 使用空值的 nillable="true" 样式而不是 minOccurs="0" 样式，svcutil 只会为您提供正确的可空类型。

# xml - 使用 RTTI 而不是自定义代码将 Delphi 对象树序列化为 XML 的好方法是什么？

> ID：368913
> 
> 赞同：15
> 
> 时间：2008-12-15T16:29:22.250
> 
> 标签：xml, delphi, serialization, xml-serialization, rtti

使用 RTTI 而不是自定义代码将 Delphi 对象树序列化为 XML 的好方法是什么？

我很想发现这个功能已经内置在 Delphi 中，但似乎没有。

我发现了一些似乎可以执行此功能的组件（已在下面发布）。您是否使用过它们中的任何一个或其他产品？你自己建了吗？在德尔福中，我是否遗漏了一些明显的东西？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-15T16:44:06.197

您可以使用 JVCL TJvAppXMLFileStorage 组件来序列化 TPersistent 派生类。

```
uses
  JvAppXMLStorage;

var
  Storage: TJvAppXMLFileStorage;
begin
  Storage := TJvAppXMLFileStorage.Create(nil);
  try
    Storage.WritePersistent('', MyObject);
    Storage.Xml.SaveToFile('S:\TestFiles\Test.xml');

    Storage.Xml.LoadFromFile('S:\TestFiles\Test.xml');
    Storage.ReadPersistent('', MyObject);
  finally
    Storage.Free;
  end;
end; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-16T09:27:53.630

JVCL 是一种选择，但如果您更喜欢小型的、自包含的库，可以**使用 OmniXML**（Mozilla Public License 1.1，[http:](http://www.omnixml.com/) //www.omnixml.com/ ）。我已经在几个项目中成功地使用了它，我发现它是在 Delphi 中使用的最简单的 XML 库。OmniXML 带有“OmniXMLPersistent”单元，它通过 RTTI 完成您需要的工作，就像 JVCL 解决方案一样。

```
// saving:
pers : TPersistent;
// SaveToFile is a class method, so no need to instantiate the object:
TOmniXMLWriter.SaveToFile( pers, 'd:\path\file.xml', pfAttributes, ofIndent ); 
```

pfAttributes 表示属性将被存储为 XML 元素的属性；ofIndent 将生成一个很好的缩进代码以提高可读性。

```
// loading:
TOmniXMLWriter.LoadFromFile( pers, 'd:\path\file.xml' ); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-15T16:32:29.780

**DragonSoft 的 XML 类序列化器**

*链接：* [http ://www.dragonsoft.us/delphi_vcl.php](http://www.dragonsoft.us/delphi_vcl.php)

*许可证：*根据 Mozilla 公共许可证（“MPL”）1.1 版获得许可

*引用：*允许通过 XML 序列化/反序列化 VCL 对象/组件。存储/恢复对象的状态（已发布的属性）。特殊类支持 - TStrings、TCollection、TPicture。全过程控制。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-15T16:33:31.587

**Simdesign 的 NativeXml**

*链接：* [http ://www.simdesign.nl/xml.html](http://www.simdesign.nl/xml.html)

*许可证：* 29,95 欧元

*Quote:*本机Delphi XML 解析器和编写器。独特的功能：直接从 XML 存储、读取和创建任何 TPersistent 对象（参见示例 5）。这是通过使用 RTTI（运行时类型信息）迭代所有对象的已发布属性来完成的。此功能仅适用于 D5 及更高版本。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-15T16:31:13.167

**JVCL 的 TJvTranslator.ComponentToXML**

*链接： http:* [//sourceforge.net/project/showfiles.php ?group_id=45786&package_id=42327](http://sourceforge.net/project/showfiles.php?group_id=45786&package_id=42327)

*许可证：*根据 Mozilla 公共许可证（“MPL”）1.1 版获得许可

*观察：*似乎在做递归序列化，但它显然是为“翻译”而设计的，这让我停了下来。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-16T19:42:05.603

我使用 SOAP XML 为 D2006 制作了一个序列化程序：http://jankajanos.spaces.live.com/blog/cns!C3E2695FC6F7B0A4! [791.entry](http://jankajanos.spaces.live.com/blog/cns!C3E2695FC6F7B0A4!791.entry)

但是D2009也有通用版。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-19T07:11:54.933

我已经上传了一个新版本。它包含英文注释： [http](http://janosjanka.spaces.live.com/blog/cns!E5C994C03FC0E370!181.entry) : //janosjanka.spaces.live.com/blog/cns!E5C994C03FC0E370!181.entry 另外，它可以通过预先注册的类类型反序列化对象。这是一件非常有用的事情，因为您可以在不知道类型的情况下反序列化对象。

# c# - 在实体类中访问 LINQ-2-SQL DataContext

> ID：368924
> 
> 赞同：9
> 
> 时间：2008-12-15T16:31:25.227
> 
> 标签：c#, .net, linq, linq-to-sql

是否有任何简单的方法可以访问`DataContext`linq2sql 实体类。

我正在尝试创建类似的东西，`EntitySet`但我无法弄清楚如何`EntitySet`首先访问创建实体对象的上下文。

我想要一个常规的 linq2sql 实体类，该类可以访问`DataContext`创建它的实体类。我知道这是可能的，因为当你有一个带有主键的实体类时，linq2sql 让你可以选择加载所有子级而不创建新的`DataContext`.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-03-12T17:18:34.287

我只需要做同样的事情。这是我的解决方案（虽然可能不是最好的方法，但至少相当优雅）：

首先，为所有要实现的实体创建一个接口，该接口继承自 INotifyPropertyChanging。这用于连接一些扩展方法并保持我们的实现独立。在我的例子中，接口被称为 ISandboxObject：

```
public interface ISandboxObject : INotifyPropertyChanging
{
    // This is just a marker interface for Extension Methods
} 
```

然后新建一个静态类，包含一个扩展方法来获取DataContext。这是通过在附加到 INotifyPropertyChanging.PropertyChanging 事件的 LINQ 更改跟踪器上查找事件处理程序来实现的。找到更改跟踪器后，我们可以从那里获取 DataContext：

```
 /// <summary>
    /// Obtain the DataContext providing this entity
    /// </summary>
    /// <param name="obj"></param>
    /// <returns></returns>
    public static DataContext GetContext(this ISandboxObject obj)
    {
        FieldInfo fEvent = obj.GetType().GetField("PropertyChanging", BindingFlags.NonPublic | BindingFlags.Instance);
        MulticastDelegate dEvent = (MulticastDelegate)fEvent.GetValue(obj);
        Delegate[] onChangingHandlers = dEvent.GetInvocationList();

        // Obtain the ChangeTracker
        foreach (Delegate handler in onChangingHandlers)
        {
            if (handler.Target.GetType().Name == "StandardChangeTracker")
            {
                // Obtain the 'services' private field of the 'tracker'
                object tracker = handler.Target;
                object services = tracker.GetType().GetField("services", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(tracker);

                // Get the Context
                DataContext context = services.GetType().GetProperty("Context").GetValue(services, null) as DataContext;
                return context;
            }
        }

        // Not found
        throw new Exception("Error reflecting object");
    } 
```

现在您有了一个很好的扩展方法，它将为您提供来自任何实现 ISandboxObject 的对象的 DataContext。在愤怒地使用它之前，请做更多的错误检查！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T20:34:00.023

基本上，没有。

该类`EntitySet<T>`具有`Source`由数据上下文分配的内部属性，这是它按需获取数据的方式。但是，数据类本身没有任何相似之处。

但是，我相信实体框架有更多的访问权限，但以强制对象层次结构为代价。

与实体框架不同，LINQ-to-SQL（按设计）可以与常规的、持久性无关的类一起使用——因此它不假定它可以访问这种类型的数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-05T06:10:07.940

An Entity class should not be aware of the data context as its just a mapping of the table but the data context has the knowledge of all the entities and the connection properties

You are able to link to the child table through the parent entity class because of the entity relationship and not through the data context

The data context class will be used at the end where the entities are consumed, I don't see a need for the entities to be aware of the context,

If you can tell the specific scenario we can try another approach.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-04T06:27:07.677

我确切地知道你的意思。我们应该在实体的部分类中进行计算/验证，但是如果实体无法访问数据上下文，那么我们能做多少？例如，在我的 SalesOrder 对象中，每当“Ship To”地址发生更改时，SalesOrder 都需要查询数据库以查明税款是否适用于该州/邮编。我已经为此奋斗了一段时间，但今天我崩溃了，并采用了丑陋的方法，但到目前为止一切都很好。基本上我所做的只是在我的部分类中创建一个“上下文”属性，并在创建实体时使用数据上下文设置它。

```
Partial Class SalesOrder
    Private moContext As L2S_SalesOrdersDataContext

    Friend Property Context() As L2S_SalesOrdersDataContext
        Get
            Return moContext
        End Get
        Set(ByVal value As L2S_SalesOrdersDataContext)
            moContext = value
        End Set
    End Property
... 
```

YMMV，尤其是在您分离实体时。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-10T21:41:04.673

基本上，你可以通过一些技巧来做到这一点。DataCONtext 将 StandardChangeTracker 附加到您的实体：

```
            数据上下文上下文 = null;
            object changeTracker = (from i in o1.GetInvocationList() where i.Target.GetType().FullName == "System.Data.Linq.ChangeTracker+StandardChangeTracker" 选择 i.Target).FirstOrDefault();
            if (changeTracker != null) // DataCONtext 通过 StandardChangeTracker 跟踪我们的更改
            {
                对象服务 = Reflector.GetFieldValue(changeTracker, "services");
                context = (DataContext)Reflector.GetFieldValue(services, "context");
            }

```

其中 Reflector.GetFieldValue 等于

```
        公共静态对象GetFieldValue（对象实例，字符串propertyName）
        {
            return instance.GetType().GetField(propertyName, BindingFlags.Instance | BindingFlags.NonPublic).GetValue(instance);
        }

```

# .net - 如何确定 WPF 窗口是否是模态的？

> ID：368926
> 
> 赞同：33
> 
> 时间：2008-12-15T16:31:35.023
> 
> 标签：.net, wpf

确定窗口是否以模态方式打开的最简单方法是什么？

**澄清：**

我打开一个窗口调用

```
myWindow.ShowDialog(); 
```

我有一个带有“确定”和“取消”按钮的页脚，我只想显示窗口是否以模态方式打开。现在我意识到我可以通过这样做来设置一个属性：

```
myWindow.IsModal = true;
myWindow.ShowDialog(); 
```

但我希望窗户本身做出这样的决定。我想检查`Loaded`窗口是否是模态的。

**更新**

该`IsModal`属性*实际上并不*存在于 WPF 窗口中。这是我创建的属性。`ShowDialog()`阻塞当前线程。

我猜我可以`ShowDialog()`通过检查当前线程是否被阻塞来确定窗口是否打开。我该怎么做呢？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-08-12T15:24:56.097

`_showingAsDialog`每当 WPF 窗口是模式对话框时，都会有一个私有字段。您可以通过反射获得该值并将其合并到扩展方法中：

```
public static bool IsModal(this Window window)
{
    return (bool)typeof(Window).GetField("_showingAsDialog", BindingFlags.Instance | BindingFlags.NonPublic).GetValue(window);
} 
```

当窗口显示为模式 (ShowDialog) 时，该值设置为 true，一旦窗口关闭，该值设置为 false。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-03-12T10:18:15.270

来自[http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/c95f1acb-5dee-4670-b779-b07b06afafff/](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/c95f1acb-5dee-4670-b779-b07b06afafff/)

*“System.Windows.Interop.ComponentDispatcher.IsThreadModal 可以告诉您调用线程当前是否正在运行模态 hwnd。”*

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-15T16:59:42.437

好的，自从我的最后一个想法被否决以来，我证明了这一点。这有效 - 我在一个新的 WPF 应用程序中对其进行了测试，所以我知道它有效：

在我的主窗口 (Window1) Loaded 事件中，我做了：

```
Dim frm As New Window2
frm.ShowDialog() 
```

在我的 Window2 中，我隐藏了 ShowDialog() 方法

```
Private _IsModal As Boolean = False 'This will be changed in the IsModal method

Public Property IsModal() As Boolean
  Get
    Return _IsModal
  End Get
  Set(ByVal value As Boolean)
    _IsModal = value
  End Set
End Property

Public Shadows Sub ShowDialog()
  IsModal = True
  MyBase.ShowDialog()
End Sub 
```

在我的 Loaded 事件中，我随后触发了一个消息框，以确保 IsModal 属性从 False 更改为 True 并且它给了我 True，所以我知道 IsModal 已设置。MyBase.ShowDialog() 然后强制基类作为模态加载。阴影允许我们覆盖默认行为，即使 ShowDialog() 方法未声明为可覆盖。

虽然它不是“自我确定”，但它不需要您从外部传入任何布尔值，也不需要您从外部设置 IsModal，它会将其设置在自身内部，如果您可以从外部访问它选择以这种方式使用它。它仅在我们使用 ShowDialog() 方法加载而不是在您使用 Show() 方法时设置值。我怀疑你会找到一个更简单的方法来做到这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-18T19:40:02.180

这是一个转换器片段，可用于在 ShowDialog 方法调用窗口时隐藏元素：

```
 public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        Window window = value as Window;
        if (window != null)
        {               
            var showingAsDialogFieldInfo = typeof(System.Windows.Window).GetField("_showingAsDialog",
                BindingFlags.NonPublic | BindingFlags.Instance);
            if ((bool) showingAsDialogFieldInfo.GetValue(window) == false)
            {
                return Visibility.Visible;
            }
        }
        return Visibility.Hidden;
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T16:43:25.530

模态窗口将停止处理，直到它关闭。

此示例显示显示非模式窗口

```
dim f as myWindow
f.show
someOtherMethod() 
```

在此示例中， someOtherMethod 在窗口启动后立即运行。

此示例显示显示模式的：

```
dim f as myWindow
f.showDialog
someOtherMethod() 
```

在这个例子中， someOtherMethod() 在 ShowDialog 方法返回之前不会运行（这意味着模态窗口已经关闭）

编辑由于澄清：覆盖 ShowDialog 并传入一个布尔值。

```
dim f as MyWindow
f.ShowDialog(true) 
```

然后在窗口

```
Public Function Shadows ShowDialog(myVar as boolean) As Boolean
    if myVar then ShowButtons()
    return mybase.ShowDialog()
End Function 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T17:18:43.350

在 Windows 中使用 UI 自动化，我想出了这样的东西：

```
void Window2_Loaded(object sender, RoutedEventArgs e)
{
    var hwnd = new System.Windows.Interop.WindowInteropHelper(this).Handle;
    var el = AutomationElement.FromHandle(hwnd);

    Object oPattern = null;

    if (el.TryGetCurrentPattern(WindowPattern.Pattern, out oPattern))
    {
        var pattern = oPattern as WindowPattern;

        this.Title = pattern.Current.IsModal.ToString();
    }
} 
```

但这似乎不起作用。有一个 IsModal 属性[http://msdn.microsoft.com/en-us/library/system.windows.automation.provider.iwindowprovider.ismodal.aspx](http://msdn.microsoft.com/en-us/library/system.windows.automation.provider.iwindowprovider.ismodal.aspx)必须有适当的方法来获取窗口的 AutomationElement 并检查 IsModal它的属性通过自动化是真实的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-06-26T09:16:03.090

您还可以创建一个继承自*Window的新类**Dialog*。在 Dialog 类中创建一个私有变量*IsDialog*并使用 new覆盖*ShowDialog函数。*调用 ShowDialog 时将 IsDialog 变量设置为 true：

 ***```
public class Dialog : Window
{
    private bool IsDialog;

    new public bool? ShowDialog()
    {
        IsDialog = true;
        return base.ShowDialog();
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-09-09T11:47:19.150

如果未使用 ShowDialog() 打开窗口，则 Window 不允许您设置 Window.DialogResult 的值。因此，您可能会尝试设置 Window.DialogResult 并查看它是否引发异常。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-15T17:50:19.310

是否可以检查窗口的父级以查看它是否被禁用？我不确定这是否可以通过 WPF API 完成，但如果没有其他方法可以获取 WPF 窗口的 HWND，请通过 Win32 P/Invoke（或其他）获取其父级，然后检查它是否是否禁用。

绝对不是一个干净的方法，但它似乎可以工作。

# linux - 使用 ctrl c 完成程序时调用函数

> ID：368927
> 
> 赞同：6
> 
> 时间：2008-12-15T16:31:54.100
> 
> 标签：linux, function

我在 Linux 环境中工作，我有一个 C++ 程序，我想要的是当我用 ctrl+c 取消程序时，我希望程序执行一个函数，关闭一些文件并打印一些 sutff，有没有怎么做？谢谢你。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-17T21:15:59.173

`signal()`在某些操作系统上可能很危险，并且在 Linux 上已弃用，而支持`sigaction()`. [“信号与信号”](https://www.petesh.com/archives/2008/11/signal_versus_sigaction/)

这是我最近遇到的一个示例（[“点击中断信号”](http://cc.byexamples.com/20070520/tap-the-interrupt-signal/)）并在我玩弄它时进行了修改。

```
#include<stdio.h>
#include<unistd.h>
#include<signal.h>
#include<string.h>

struct sigaction old_action;

void sigint_handler(int sig_no)
{
    printf("CTRL-C pressed\n");
    sigaction(SIGINT, &old_action, NULL);
    kill(0, SIGINT);
}

int main()
{

    struct sigaction action;
    memset(&action, 0, sizeof(action));
    action.sa_handler = &sigint_handler;
    sigaction(SIGINT, &action, &old_action);

    pause();

    return 0;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T17:19:30.760

对于完整的工作示例，您可以尝试以下代码：

```
#include <signal.h>
#include <stdio.h>
#include <stdbool.h>

volatile bool STOP = false;
void sigint_handler(int sig);

int main() {
    signal(SIGINT, sigint_handler);
    while(true) {
        if (STOP) {
            break;
        }
    }
    return 0;
}

void sigint_handler(int sig) {
    printf("\nCTRL-C detected\n");
    STOP = true;
} 
```

示例运行：

```
[user@host]$ ./a.out 
^C
CTRL-C detected 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T16:37:30.923

你必须抓住信号。像这样的东西：

```
void sigint_handler(int sig)
{
    [do some cleanup]
    signal(SIGINT, SIG_DFL);
    kill(getpid(), SIGINT);
} 
```

[在此处加载更多详细信息](http://www.cons.org/cracauer/sigint.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T16:36:34.107

简短回答：查看信号函数，特别是捕获 SIGINT。您编写一个回调函数并通过信号函数将其传递给系统，然后当该特定信号发生时，系统会调用您的回调函数。您可以关闭文件并在其中执行任何其他清理工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T17:36:27.747

请注意可能偶然发现此问题的人，而是在**Windows**中寻找答案：

使用`SetConsoleCtrlHandler`API 调用设置自定义处理程序并监视`CTRL_C_EVENT`,`CTRL_BREAK_EVENT`或`CTRL_CLOSE_EVENT`.

# entity-framework - 数据库设计：更多表与更少表

> ID：368929
> 
> 赞同：5
> 
> 时间：2008-12-15T16:32:27.907
> 
> 标签：entity-framework, database-design, oop

假设我想为一个包含博客、照片、论坛等的社区站点设计一个数据库，这样做的一种方法是挑出“帖子”的概念，作为博客条目、博客评论、照片、照片评论，论坛帖子都可以认为是帖子。所以，我可能有一个名为 Post [PostID, PostType, Title, Body .... ] 的表，PostType 将告诉它是什么类型的帖子。

或者我可以用更多的表、BlogPost、PhotoPost、ForumPost 来设计整个事情，我将留下 Comment 只是它自己的带有 CommentType 列的表。

或者对所有类型的帖子都有一个 Post 表，但有一个单独的 Comment 表。

为了完整起见，我使用 ADO.NET Entity Framework 来实现我的 DAL。

现在的问题是，如果我采用上述任何会影响我的数据库性能和可管理性、中间层设计和代码清洁度、EF 性能等的路线，会有什么影响？

非常感谢你！

射线。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T16:38:06.727

让我问你一下：

如果两年后您决定将“音乐帖子”添加为博客类型会怎样？您是否必须为 MusicPost 创建一个新表，然后重新编码您的应用程序以集成它？或者您更愿意登录您的博客管理面板，在名为“音乐”的下拉框中添加一个博客类型，然后尽情享受？

在这种情况下，更少的表！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T18:10:08.630

通常，如果您可以将所有帖子放在一张表中，生活会更轻松：

*   更少的连接来执行
*   需要维护的表更少
*   表之间不重复公共属性
*   代码更通用

但是，您可能会遇到一些问题：

*   如果每个子类型都有很多自己的属性，那么您最终可能会得到很多列 - 对于您的 DBMS 来说可能太多了
*   如果子类型有一个属性（例如存储的图片），即使在未使用的情况下，DBMS 维护起来也很昂贵，那么您可能不希望所有行都包含该列

如果您遇到此类问题，您可以仅为该帖子子类型的特定属性创建一个新表 - 例如：

```
create table posts (post_id number primary key, 
                    post_date date,
                    post_title ...); /* All the common attributes */

create table photo_post (post_id references posts, photograph ...); 
```

在许多情况下，不会出现此类问题，一张表就足够了。

我想不出为每个子类型创建一个不同的表有什么好处。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T16:59:23.140

这个问题类似于 OO 设计中的层次结构应该有多深的问题。

OO 术语中的一个简单方法是拥有一个基类`Post`和子类`BlogPost`，`ForumPost`依此类推。根据您的要求，`Comment`可以是子层次结构或它自己的层次结构。`Post`

那么这将如何映射到数据库表是一个完全不同的问题。[Scott Ambler 的这篇经典文章](http://www.agiledata.org/essays/mappingObjects.html)处理了不同的映射策略，并以相当详细的方式解释了它们的优缺点。

# asp.net - 如何让 ASP.Net CompositeScript 在浏览器中缓存？

> ID：368932
> 
> 赞同：0
> 
> 时间：2008-12-15T16:32:38.950
> 
> 标签：asp.net, performance, caching

我一直在尝试提高引用几个单独的 JavaScript 文件的网页的性能。我在 .Net 3.5 SP1 中发现了新的 CompositeScript 功能，它允许您在运行时通过 ScriptManager 组合脚本，它可以很好地减少页面加载时服务器上的点击次数。

但问题是组合脚本永远不会在客户端缓存。从我到目前为止读过的所有内容来看，它应该会自动执行此操作。我没有设置任何东西来阻止它缓存（我们引用的其他脚本不能很好地组合缓存，`ScriptResource.axd`文件也是如此）。我什至添加了以下内容以显式启用缓存`web.config`：

```
<system.web.extensions>
    <scripting>
        <scriptResourceHandler enableCompression="true" enableCaching="true"/>
    </scripting>
</system.web.extensions> 
```

但它似乎没有效果。

有没有人看到这个问题或对我可以尝试解决的问题有一些建议？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-01-19T01:31:48.200

Is debug mode on anywhere? Make sure your webserver's `Machine.Config` has `Retail="True"`

```
<configuration>
    <system.web>
        <deployment retail="true"/>
    </system.web>
</configuration> 
```

# delphi - Delphi 分析工具

> ID：368938
> 
> 赞同：23
> 
> 时间：2008-12-15T16:34:36.310
> 
> 标签：delphi, performance, profiling

我的 Delphi 2006 应用程序存在一些性能问题。你能推荐任何可以帮助我找到瓶颈的分析工具吗

即像turbo Profiler这样的工具

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-15T22:41:53.543

不久前我问了同样的[问题](https://stackoverflow.com/questions/291631/profiler-and-memory-analysis-tools-for-delphi)

我已经下载并尝试了 AQtime。它看起来确实很全面，但它不是一个易于使用的工具，而且对于单个程序员来说非常昂贵（即 600 美元）。我喜欢它是非侵入性的（没有更改您的代码），并且它可以进行逐行分析，直到我发现因为它是一个检测分析器，它可能导致不正确的优化，如下所示：[为什么 CharInSet 比 Case 语句快？](https://stackoverflow.com/questions/332948/why-is-charinset-faster-than-case-statement)

我尝试了 ProDelphi 的演示，价格便宜得多（我认为大约 80 美元），但它对我来说太笨重了——我根本不喜欢用户界面，而且它是侵入性的——更改代码以添加检测，你必须小心。

我使用 GpProfile 和 Delphi 4 很多年了。我爱它。它也是侵入性的，但它运作良好，我学会了信任它，而且它在 10 年内从未给我带来任何问题。但是当我升级到 Delphi 2009 时，我认为最好不要尝试使用它，因为它还没有升级，而且 GP 承认，不修改就无法工作。我希望您也无法在 Delphi 2006 中使用它。

ProDelphi 和 GpProfile 将仅在过程级别进行分析。如果你想做单独的行（我有时不得不这样做），你必须为每一行调用 PROC1、PROC2、PROC3 并将一行放在每个 PROC 中。不得不这样做有点烦人，但它给了我很好的结果（至少我对 GpProfile 这样做的结果感到满意）。

我在 CharInSet 问题中接受的答案是“定期检查 CPU 位置的采样分析器通常更适合测量代码时间。” 后来的[回答](https://forums.codegear.com/thread.jspa?messageID=18506)给了 Eric Grange 的 Delphi 免费采样分析器，现在支持 Delphi 2009。我还没有尝试过，但我听说过它的好消息，这是我要尝试的下一个。

顺便说一句，您最好不要购买 AQtime 来节省 600 美元，而是使用它来将您的 Delphi 2006 升级到 Delphi 2009。稳定性、速度和额外的功能（特别是 Unicode）值得您花时间。请参阅：[升级到 D2009（Unicode 除外）的主要激励措施是什么？](https://stackoverflow.com/questions/305016/what-are-major-incentives-to-upgrade-to-d2009-unicode-excluded#307419)

AQtime 还没有集成到 Delphi 2009 中。

另一个免费的，我发现但尚未尝试过的来源是[TProfiler](http://www.delphiarea.com/products/delphi-components/profiler/)。如果有人试过那个，我想知道他们的想法。

* * *

注意：我后来添加到[问题 291631](https://stackoverflow.com/questions/291631/profiler-and-memory-analysis-tools-for-delphi)的附录似乎可能是答案。查看[Andre 的开源程序：asmprofiler](https://stackoverflow.com/questions/291631/profiler-and-memory-analysis-tools-for-delphi/672554#672554)

* * *

2010 年 2 月随访。我硬着头皮买了AQTime。几个月前，他们终于将它集成到我使用的 Delphi 2009 中（但他们仍然必须使用 Delphi 2010）。查看源代码行及其各个时间和计数对我来说非常宝贵，而 AQTime 在这方面做得非常出色。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-08T12:11:27.217

我刚刚找到了一个非常不错的免费 [采样分析器](http://delphitools.info/)，它支持 Delphi 2009

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-07-13T21:46:26.580

我用过 ProDelphi，主要是为了确定哪些例程消耗的时间最多。它是一个 Instrumenting Profiler，这意味着它会在每个例程的开头和结尾添加一些代码。您可以通过注释中的指令控制它配置的例程。您还可以分析例程的各个部分。但是这些部分必须在同一块级别开始和停止，没有进入或退出该部分。优化必须在 ProDelphi 插入其代码的地方（放置指令的地方）关闭，但您可以在其他任何地方打开它。

界面有点笨拙，但是一旦掌握了它就会非常快。您可以使用免费版本（限于 10 个例程或部分）进行有用的工作。ProDelphi 可以快速告诉您应该检查哪些例程。但不是为什么，或者是哪一行。

最近，我开始使用英特尔的 VTune 性能分析器。“哇”并没有开始总结它。我**印象深刻**。我根本不知道所有这些都内置在现代英特尔处理器中。您是否知道它可以准确地告诉您在从更高的缓存重新加载一个字之前，一条指令需要多长时间等待 L1 数据缓存侧向查看另一个内核？如果我继续写下去，我听起来就像是一个令人窒息的产品广告。

前往英特尔并下载完整的定时演示。在网上挖掘并找到一些关于如何开始的视频。（否则，您将面临被所有选项所阻碍的风险。）它适用于任何编译器。只需将其指向 .exe。如果您的 .exe 包含调试信息并且您将其指向源代码，它将向您显示源代码行。

* * *

我被困在试图优化一个调用我编写的函数的内部循环。除了长度（str）之外，没有外部调用。这个内部循环每次运行数十亿次，消耗了大约一半的 CPU 时间——这是优化的完美候选者。我尝试了各种标准优化，几乎没有效果。VTune 显示热点。我只是深入研究，直到它向我展示了我的代码生成的 ASM，以及每条指令花费了多少时间。

这是 VTune 告诉我的：

> *   line nnnn [delphi 代码行] ...
> *   addr hhhh cmp byte ptr [edx+ecx],0x14h - - - - - - - - 3 个周期
> *   addr hhhh ja label_x - - - - - - - - - - - - - - - - -10302 个周期

绝对值没有任何意义。（我想我是在测量每条退役指令的周期。）相对值很清楚所有时间都去了哪里。最棒的是建议窗口。它告诉我代码停止等待数据加载到 L1 数据缓存中，实际上给了我关于如何避免停止的很好的建议。

我的错误在于将 Core2 Quad 视为一个非常快的 8086 CPU。没有^3。代码花费了 99% 的时间等待从内存中加载数据，因为我跳的太多了。我的算法假设内存是 RAM（随机存取）。这不是现代 CPU 的工作方式。L1 缓存中的数据可能会在 1 或 2 个周期内被访问，但访问 L2 或 L3 缓存需要数十到数百个周期，而进入 RAM 则需要数千个周期。 **但是**，当您按顺序访问数据时，所有这些延迟都可以避免——因为处理器会在您请求的第一个字节之后使用数据预加载缓存。

最终结果是我重写了算法以更顺序地访问数据，并获得了 10 倍的加速，这已经足够好了。当我有时间时，我确信我可以再获得 10 倍的收益。但这只是我心中的极客。够好就够了。

我已经知道通过优化算法而不是代码来获得最大的收益。我以为我只需要探查器告诉我需要优化什么。但我也需要它来找出瓶颈的原因，这样我就可以设计一个更快的算法。

The new algorithm isn't radically different from the old. It just stores the data such that it can be accessed sequentially. For example, in one place I moved a field from an array of records into it's own array of integers -- because the inner loop didn't need the rest of the data in each record. I also had a rectangular matrix stored as a dynamic array of dynamic arrays. The code used this to randomly access megabytes of data (and the poor L1 data cache is only 64Kb). I figured out how to store it in a linear array as diagonals of the matrix, which is the order I use the data. (OK, maybe that part **is** radical.)

Anyway, I'm sold on VTune.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-15T16:48:09.980

我过去曾在 Delphi 7 项目上成功使用过[http://www.prodelphi.de 。](http://www.prodelphi.de)便宜又好用。不要让丛林联盟网站吓跑你。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-15T16:40:08.937

www.AutomatedQA.com 拥有 Delphi profiling (AQTime) 的最佳选择

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-15T19:25:10.337

我使用并推荐 Sampling Profiler，我想你可以从 embarcadeiro.public,attachments 新闻组获得它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T16:43:36.277

这是另一种选择，我之前没有使用过这个：http: [//www.prodelphi.de](http://www.prodelphi.de)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T16:44:34.717

我知道的 Delphi 的最终选择， http: [//gp.17slon.com/gpprofile/index.htm](http://gp.17slon.com/gpprofile/index.htm)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-15T16:45:17.227

最后一点，www.torry.net 是 Delphi 组件/工具搜索的好地方

# c# - 何时将某些实体分成不同的存储库？

> ID：368940
> 
> 赞同：4
> 
> 时间：2008-12-15T16:35:27.463
> 
> 标签：c#, .net, design-patterns, domain-driven-design, repository-design

我通常会尝试将所有相关实体保存在同一个存储库中。以下是两者之间有关系的实体（标有缩进）：

*   用户
    *   用户偏好

因此，进入用户存储库是有意义的。但是，用户通常与许多不同的实体相关联，在下面的示例中您会怎么做？

*   用户

    *   用户偏好
    *   命令
*   命令

    *   产品

订单与产品和用户都有关系，但您不会将所有 4 个实体的功能都放在同一个存储库中。当您与用户实体打交道并收集订单信息时，您会做什么？您可能需要有关产品的额外信息，并且 ORM 通常会提供延迟加载的能力。但是，如果您的产品实体与用户实体位于单独的存储库中，那么这肯定会导致存储库之间发生冲突吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-16T11:55:24.220

在 Eric Evan 的领域驱动设计 ( [http://domaindrivendesign.org/index.htm](http://domaindrivendesign.org/index.htm) ) 中，您应该首先考虑您的聚合。然后，您围绕这些构建存储库。

有许多技术可用于处理彼此相关的聚合。我最常使用的是只允许聚合通过只读接口相互关联。Aggregates 背后的关键思想之一是，如果不通过根，就无法更改底层对象的状态。因此，如果产品和用户是模型中的根聚合，那么如果我通过用户->订单->产品得到它，我将无法更新产品。我必须从产品存储库中获取产品才能对其进行编辑。（从 UI 的角度来看，您可以使它看起来像用户->订单->产品，但是当您点击产品编辑屏幕时，您会从产品存储库中获取实体）。

当您通过从用户->订单->产品查看产品（在代码中）时，您应该查看的产品界面没有任何方法可以更改产品的底层状态（只有没有集合等。 )

根据您使用它们的方式来组织您的聚合和存储库。我可以看到 User 和 Prodcut 是他们自己的聚合并拥有自己的存储库。根据您的描述，我不确定 Order 是否应该属于 User 或者也应该是独立的。

当聚合相关时，无论哪种方式都使用只读接口。当您必须从一个聚合跨越到另一个聚合时，请从其自己的存储库中获取它。

如果您的存储库正在缓存，那么当您（通过用户）加载订单时，只需从数据库中加载产品 ID。然后使用产品 ID 从产品存储库加载详细信息。您可以通过在加载订单时在产品上加载任何其他不变量来进行一些优化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T11:18:56.713

存储库是指类？

根据对象（存储库）的使用，您可以创建一个将数据库上的数据组合在一起的视图，并使用您的 ORM 创建一个类（存储库）来表示该视图。当您想要显示每个表中只有几列的重量较轻的对象时，这种设计会起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T20:19:04.797

如果 SQL Server 是您的数据库，并且存储库是指数据库，那么我只需将信息粘贴在任何有意义的数据库中，并在依赖数据库中查看通过三点符号从另一个数据库中选择的视图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T23:19:30.970

我仍然对“存储库”的含义感到困惑。我会将您谈到的所有内容都制作为单独的类（因此是单独的文件），并且它们都将驻留在同一个项目中。

# jquery - jQuery 如何在这段代码中获取 div？

> ID：368943
> 
> 赞同：0
> 
> 时间：2008-12-15T16:36:22.440
> 
> 标签：jquery, jquery-selectors

如何从这个（最后一个）列表项中获取 div？

目前我有这个，这只是丑陋......关于更清洁的选择器/解决方案的任何建议？

```
var div = ul.append("<li><div></div></li>").contents("li:last-child")[0].children[0]; 
```

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T16:45:37.850

您也可以进行一些不同的添加：

```
var div = $('<div/>'); 
// do whatever you need to do with the div
$('<li/>').appendTo(ul).append(div); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T17:13:26.950

使用数组索引只返回 HTMLElement 对象，因此删除了许多 jQuery 的有用功能，所以要小心。我倾向于以这种方式处理它：

```
var div = $("<div/>").appendTo($("<li/>").appendTo(ul)); 
```

从最里面到最外面，这会创建一个列表项，将其附加到您的列表中，创建一个 div，将其附加到您的新列表元素，然后返回 div，仍然包裹在 jQuery 中。如果你愿意，你可以附加一个数组索引来获取 HTMLElement：

```
var div = $("<div/>").appendTo($("<li/>").appendTo(ul))[0]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T16:38:43.667

像这样？

```
var div = ul.append("<li><div></div></li>").contents("li:last-child > div")[0]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T16:40:18.157

那这个呢：

```
ul.append("<li><div></div></li>").contents("li:last-child > div").get(0); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T16:49:37.263

这一点，我认为：

```
var div = ul.append('<li><div></div></li>').find("li:last div"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T16:50:03.957

这个怎么样：

```
 var div = $('<li><div/></li>').appendTo(ul).find('div'); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T16:52:47.397

只是为了完整性：

```
var div = $('<div></div>').appendTo($("<li></li>").appendTo(ul)); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T17:04:03.443

```
var div = ul.append("<li><div></div></li>").find('div').get(0); 
```

我想这就是你要找的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-15T18:44:29.387

我的解决方案是：

```
var div = ul.append("<li><div></div></li>").find("div:last"); 
```

# ssis - SSIS package works with windows account, fails with sqlserver sa account

> ID：368945
> 
> 赞同：0
> 
> 时间：2008-12-15T16:37:02.750
> 
> 标签：ssis, permissions

Having some SSIS permissions issue.

I am calling the SSIS package in my .net console application with:

```
Package pkg = app.LoadFromSqlServer(packagePath, serverName, serverUsername, serverPassword, dtsEvents); 
```

It is working when manually running it using the windows accout, but fails with the above call in my console application.

Shouldn't it work with the sql server sa account?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T19:19:35.010

There are plenty of reasons for it to fail when run under different account, to avoid trying to fix it blindly, you should get the error information. It looks like you are supplying dtsEvent parameter - so your app should get the error message. Another way to get it to examine package.Error collection after execution, or enable SSIS logging and check the error log.

Once you have the error message, update the post :)

There is also a KB article dedicated to troubleshooting such errors: [http://support.microsoft.com/kb/918760/](http://support.microsoft.com/kb/918760/).

But it just lists lots of possible error causes - to find out your issue, you need to get the error message first.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T07:44:52.427

当您有使用链接服务器访问不同服务器上的数据库的 sql 查询时，通常会发生这种情况。

# .net - .NET 中的 AjaxToolKit 仅在某些机器上引发 Javascript 错误

> ID：368947
> 
> 赞同：2
> 
> 时间：2008-12-15T16:37:27.133
> 
> 标签：.net

我们有一个使用 AjaxToolKit/C#/.NET 异步保存的按钮。我在我的错误控制台中得到了这个：

```
Error: [Exception... "'Sys.WebForms.PageRequestManagerServerErrorException: Sys.WebForms.PageRequestManagerServerErrorException:
An unknown error occurred while processing the request on the server. The status code returned from the server was: 500' when calling method:
[nsIDOMEventListener::handleEvent]"  nsresult: "0x8057001c (NS_ERROR_XPC_JS_THREW_JS_OBJECT)"  location: "<unknown>"  data: no] 
```

最奇怪的是它只发生在某些机器上（但不是全部）。办公室里的每个人都在 FF 3.0.4 和 IE 7 中检查了这一点，并且保存对大多数人来说都很好。对于少数不适合它的人来说，它在两种浏览器中都失败了。

关于从哪里开始解决这个问题的任何想法？

1.  我会说这是一个服务器/代码错误，但它适用于大多数人。
2.  我会说这是一个 javascript 错误，但我们都使用相同的浏览器。
3.  我什至可以说这是操作系统的差异，但它发生在 XP 和 Vista 用户身上。
4.  用户权限对我们所有人都是一样的

该应用程序一直正常工作，直到本周末的更新，我们更新了页面上的 UserControl。如果我删除该控件，则保存在所有计算机上都可以正常工作。当我添加控件时，我们遇到了上述情况，它在随机计算机上失败。

**回答**

不幸的是，由于 AjaxToolKit 如何返回错误的神秘性，这很难追踪。真正的罪魁祸首是我们在 UserControl 中的某些字段中有 HTML。我们在页面顶部添加了 ValidateRequest="false"，我们的问题就消失了。

我们最终发现问题的方法是从我们的 Save 按钮周围**删除 UpdatePanel**。

抱歉，我没有早点想到这一点，因为从那里开始很简单。我正在为迈克尔的辛勤工作和详尽的故障排除列表提供公认的答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T16:56:21.227

检查事项：

1.  重新启动（老歌但很好，并不总是不言而喻）
2.  操作系统版本（你做了这个）
3.  网络浏览器（你做了这个）
4.  Web 浏览器设置（您通过尝试多个浏览器涵盖了这一点）
5.  网络连接和[主机文件](http://en.wikipedia.org/wiki/Hosts_file)规则
6.  用户权限（你涵盖了这个）
7.  应用程序权限（你涵盖了这个）
8.  操作系统区域设置（控制面板：区域和语言选项）
9.  尝试获取更多信息。
    *   [http://www.communitymx.com/content/article.cfm?cid=A66B8](http://www.communitymx.com/content/article.cfm?cid=A66B8)
    *   [http://forums.asp.net/p/1163435/2673051.aspx](http://forums.asp.net/p/1163435/2673051.aspx)
    *   [http://projects.nikhilk.net/WebDevHelper/Default.aspx](http://projects.nikhilk.net/WebDevHelper/Default.aspx)
    *   [http://www.fiddlertool.com/fiddler/](http://www.fiddlertool.com/fiddler/)
    *   IIS 日志；服务器事件日志

在这种情况下，我可能会下载一个原始浏览器来尝试排除浏览器设置。我会把谷歌浏览器扔到一台已知的好机器和一台已知的坏机器上，看看会发生什么。如果它在这两种情况下都有效，那么我会进一步查看浏览器设置。我知道这不太可能，因为它在 FF 和 IE 中都失败了，但是 IE 这个简单的测试仍然可以帮助提供更多信息。

这是一个奇怪的。由于它同时影响 IE 和 FF，因此我还要查看连接角度、主机文件和权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-15T13:01:16.343

这不是 Ajax 的错误，你的代码有错误。删除 Ajax 然后检查，你会知道什么是确切的错误。

阿吉特

# apache-flex - Flex：是否有禁用 NumericStepper 中的文本字段并强制用户仅通过使用向上/向下按钮来更改值？

> ID：368954
> 
> 赞同：1
> 
> 时间：2008-12-15T16:38:43.527
> 
> 标签：apache-flex, actionscript-3, numericstepper

在这里可能没有更多详细说明 - 我正在使用 NumericStepper 控件，我希望用户只使用按钮来更改 NS 中的值，而不是通过输入控件 - 我找不到要禁用的属性文本 - 它存在吗？

如果没有，我将如何子类化这个东西来禁用文本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T17:06:10.180

好的 - 我想我明白了 - 没有可以设置的属性，但你可以子类化控件并设置：

```
mx_internal::inputField.enabled = false; 
```

尽管这提出了下一个关于 mx_internal 到底是什么的问题......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T20:45:12.063

mx_internal 是一个命名空间。这里有一个很好的解释它是如何工作的：

[http://nondocs.blogspot.com/2007/04/mxcoremxinternal.html](http://nondocs.blogspot.com/2007/04/mxcoremxinternal.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T21:01:17.067

一般来说，如果您使用 mx_internal，您的应用程序很有可能会在 flex 版本之间中断。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-19T17:46:08.097

如果您使用的是 spark NumericStepper，最佳做法是创建自定义皮肤并隐藏 TextInput 部分（它是必需的皮肤部分，因此它必须位于皮肤中的某个位置）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-02-01T06:09:15.027

文本输入具有可设置为 false 的属性“可编辑”。它对我有用。

# asp.net-mvc - ASP.NET MVC 和分页 - 搜索和结果场景

> ID：368956
> 
> 赞同：1
> 
> 时间：2008-12-15T16:39:02.200
> 
> 标签：asp.net-mvc, paging

我的页面中有一个 get 和一个 post 表单，我想在我的 get 表单上添加寻呼机 .. 所以我无法翻阅结果..

我遇到的问题是当我移动到第二页时它没有显示任何内容..

我正在使用这个库进行分页.. [http://stephenwalther.com/Blog/archive/2008/09/18/asp-net-mvc-tip-44-create-a-pager-html-helper.aspx](http://stephenwalther.com/Blog/archive/2008/09/18/asp-net-mvc-tip-44-create-a-pager-html-helper.aspx)

这是我的操作代码。

```
 [AcceptVerbs("GET")]
    public ActionResult SearchByAttraction()
    {
        return View();
    }  

    [AcceptVerbs("POST")]
    public ActionResult SearchByAttraction(int? id, FormCollection form)
    {....
    } 
```

这就是我在获取表单上使用的页面

<%= Html.Pager(ViewData.Model)%> //但是当我这样做时它会转到这个方法 [AcceptVerbs("GET")] public ActionResult SearchByAttraction()

而不是去这个这个

[AcceptVerbs("POST")] public ActionResult SearchByAttraction(int?id, FormCollection form)

哪种有意义..但我真的想不出任何其他方式来做到这一点

任何帮助将不胜感激..

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-15T19:34:41.987

我建议不要通过 HTTP POST 进行分页。页面和搜索条件是查询字符串用途的 2 个完美示例。将这些值放在查询字符串中并加载您的操作参数。

想想这个。您可以在谷歌搜索“馅饼”，导航到第 14 页，复制链接并将其发送给您的祖母。当您的分页/搜索仅适用于表单帖子时，您不能这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T17:10:05.927

当然它会命中 SearchByAttraction 的 GET 版本，因为使用这个控件你有一个链接作为输出。

所以你需要做的：

```
1\. make form on the page:
    <form id="myForm" action="your/url" method="post">
        <input type="hidden" name="page" />

        <input type="hidden" name="your_param1" />
        <input type="hidden" name="your_param2" />
        <input type="hidden" name="your_paramN" />
    </form>

2\. make changes to pager - it should produce something like that:

    <ul id="pager">
        <li><a href="url/as/was/created/by/pager" onclick="return submitMyForm(1);">1</a></li>
        <li><a href="url/as/was/created/by/pager" onclick="return submitMyForm(2);">2</a></li>
        <li><a href="url/as/was/created/by/pager" onclick="return submitMyForm(3);">3</a></li>
    </ul>

3\. add simple javascript function on the page:

    <script language="javascript" type="text/javascript">
        function submitMyForm(page) {
            var form = document.forms["myForm"];
            form.elements["page"].value = page;
            form.submit();
            return false;
        }
    </script> 
```

您将能够访问 POST 版本，因为单击该链接将使用 POST 请求在服务器上提交您的表单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T18:09:16.777

试试这个：

```
[AcceptVerbs("GET")]
public ActionResult SearchByAttraction(int? id)
{
    return View();
} 
```

id 应该包含您需要显示的页码。

如果您使用这种方法丢失了表单值，那么您需要更改 Html.Pager 方法以将每个操作链接呈现为表单提交链接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T18:37:11.853

谢谢大家，我终于让它工作了..只用了一种形式..做了这样的事情

控制器动作

```
 [AcceptVerbs("GET")]
    public ActionResult SearchByAttraction()
    {
        return View();
    }

    public ActionResult Search(FormCollection form,int? id)
    {
        var info = _repository.ListByLocation(city, postal, pageIndex, 2);
        return View("SearchByAttraction", info); 
    } 
```

看法

```
<% using (Html.BeginForm("Search", "Home", FormMethod.Get))
{ %> 
```

所以它每次发帖时都会调用搜索方法..

# php - PHP 源代码控制服务器

> ID：368958
> 
> 赞同：3
> 
> 时间：2008-12-15T16:39:54.257
> 
> 标签：php, svn, version-control

我有一个与 SVN 客户端兼容的基于 PHP 的源代码控制“服务器”吗？
我想在我的托管服务器上托管我的 SVN，但是当前主机不允许我启动任何进程或安装任何软件

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-30T13:56:30.407

你可以试试：

[http://sourceforge.net/projects/deltaweb](http://sourceforge.net/projects/deltaweb)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T16:42:10.647

你可以有一个 PHP 前端，但你仍然需要在某个地方运行 SVN 服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T16:59:28.773

从来没听说过。

你可以看看像[CVSDude.org](http://cvsdude.com/)这样的服务，它提供了非常实惠的 SVN 托管。他们基本上专注于 CVS 和现在的 SVN 托管。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T17:20:31.757

我知道的唯一一个基于 PHP 的 SVN 项目是这个包，它允许 PHP 使用一些 SVN 绑定： http: [//pecl.php.net/package/svn](http://pecl.php.net/package/svn)。

正如此处的其他答案所表明的那样，我认为您不会找到想要的东西。基于 PHP 的 SVN 服务器似乎不存在。

我建议为您的存储库寻找不同的托管服务提供商。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T22:35:46.253

如果您想要一个托管的 svn 存储库并且您不介意使用和信任第三方，请尝试[beanstalk](http://beanstalkapp.com/)，他们有一个免费帐户和一些相当合理的付费选项，考虑到您不需要他们的管理开销。

# c++ - Symbian C++ - 单个变量的持久存储

> ID：368963
> 
> 赞同：2
> 
> 时间：2008-12-15T16:41:29.637
> 
> 标签：c++, symbian, s60, carbide, persistent-storage

我希望在我的应用程序中存储一个变量，该变量将在运行之间保存。这将是一个版本号，用于触发更新选项，因此很少更改。

有没有人对实现这一点的最佳方式提出建议？考虑到这是一个如此简单的要求，我对最简单的解决方案很感兴趣。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T16:44:44.543

通常，此类信息将保存在二进制文件中的常量（而不是变量）中，并且二进制文件将联系外部站点以查明是否有更新版本的软件。当它下载新的时，新下载的文件将嵌入一个新的常量。

或者，您可以将信息保存在文件系统中的某种文件中。我不熟悉 Symbian 环境，但很可能存在类似的环境。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T06:45:09.743

已经提到了，所以我将详细说明它。在您的项目目录中创建一个包含版本号的文件。通过在 PKG 文件中添加一行来使该文件成为最终 SIS 文件的一部分——例如，在 PKG 文件中添加一行以告诉安装程序将文件复制到`c:\System\Apps\${AppName}\${filename}`设备上的某个位置。在代码中，从该文件中读取版本号。这样做的好处是，当您更新代码并编辑项目目录中的文件并重新创建更新的 SIS 文件时，在更新设备上的 SIS 时，版本文件将自动替换为当前一。

# java - 如何在休眠中重用 Criteria 对象？

> ID：368966
> 
> 赞同：29
> 
> 时间：2008-12-15T16:42:29.010
> 
> 标签：java, hibernate, spring-mvc, pagination, displaytag

我正在尝试使用 hibernate 和 displaytag 对查询结果进行分页，而 Hibernate`DetachedCriteria`对象正在尽力阻止。让我解释...

使用 displaytag 进行分页的最简单方法似乎是实现`PaginatedList`具有以下方法的接口：

```
/* Gets the total number of results. */
int getFullListSize();

/* Gets the current page of results. */
List getList();

/* Gets the page size. */
int getObjectsPerPage();

/* Gets the current page number. */
int getPageNumber();

/* Get the sorting column and direction */
String getSortCriterion();
SortOrderEnum getSortDirection(); 
```

我正在考虑将我的 PaginatedList 实现扔一个 Criteria 对象，并让它按照这些思路工作......

```
getFullListSize() {
    criteria.setProjection(Projections.rowCount());
    return ((Long) criteria.uniqueResult()).intValue();
}

getList() {
    if (getSortDirection() == SortOrderEnum.ASCENDING) {
        criteria.addOrder(Order.asc(getSortCriterion());
    } else if (getSortDirection() == SortOrderEnum.DECENDING) {
        criteria.addOrder(Order.desc(getSortCriterion());
    }
    return criteria.list((getPageNumber() - 1) * getObjectsPerPage(),
                         getObjectsPerPage());
} 
```

但这不起作用，因为`addOrder()`或`setProjection()`调用修改了条件对象，使其无法用于后续调用。我不完全确定调用的顺序，但是数据库在`getFullListSize()`尝试执行“ `select count(*) ... order by ...`”时会抛出错误，这显然是错误的。

我想我可以通过创建自己的对象来跟踪查询条件并为每次调用重建 Criteria 对象来解决这个问题，但这感觉就像重新发明了另一个轮子。有没有更聪明的方法，可能复制最初传入的标准并处理该副本？

***更新***：它看起来像`getList`第一次被调用，然后`getFullListSize`被多次调用，所以，一旦有一个 ordering 传入，`getFullListSize`就会失败。`getList`只打一次数据库（我想说）并缓存结果是有意义的`Criteria`对象，但仍然......

***更新（再次）***：忘记这一点，一旦我完成了`count`我不能做的`select`，反之亦然。我真的需要两个不同的`Criteria`对象。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-09-24T16:59:29.073

```
Criteria.setProjection(null);
Criteria.setResultTransformer(Criteria.ROOT_ENTITY); 
```

将有效地“重置” rowCount 投影和标准本身执行之间的标准。

我会确保在执行 rowCount 之前没有添加您的订单，这会减慢速度。我的 PaginatedList 实现总是在查找结果之前运行计数查询，因此排序不是问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T17:59:15.267

好吧，DetachedCriteria 是可序列化的，所以你有内置的（如果不优雅的话）深度克隆支持。您可以在构造时将初始条件序列化为 byte[]，然后在每次要使用它时反序列化它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T19:21:17.677

[http://weblogs.asp.net/stefansedich/archive/2008/10/03/paging-with-nhibernate-using-a-custom-extension-method-to-make-it-easier.aspx](http://weblogs.asp.net/stefansedich/archive/2008/10/03/paging-with-nhibernate-using-a-custom-extension-method-to-make-it-easier.aspx)

在那篇文章中，我发现了一个 CriteriaTransformer.clone 方法。

那应该复制标准对象。

您还可以在 getlist 方法上设置投影。

糟糕，我没有注意到您指的是 java hibernate。无论如何，这个[http://forum.hibernate.org/viewtopic.php?t=939039](http://forum.hibernate.org/viewtopic.php?t=939039)

论坛帖子应该可以回答你的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T11:58:10.330

尽管可能很丑，但我最终还是使用了序列化技巧。我只是`DetachedCriteria`在构造对象时将对象序列化为字节数组，`PaginatedList`并在需要时对其进行反序列化。哎哟。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T07:55:20.913

另一件值得尝试的事情：

实现一个通用 DAO，就像[hibernate 网站上建议的](https://www.hibernate.org/328.html)那样，并将它与 Restrictions 对象一起传递给 PaginatedList 对象。然后 PaginatedList 对象将执行类似的操作

```
Criteria.forClass(myDAO.getPersistentClass())
        .add(myRestrictions)
        .addOrder(<someOrder>) 
```

和

```
Criteria.forClass(myDAO.getPersistentClass())
        .add(myRestrictions)
        .setProjection(Projections.rowCount()); 
```

还没有尝试过，但它应该可以工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-04-15T08:30:40.180

有一种更好、更简单的克隆标准的方法，很简单：

```
ICriteria criteria = ...(your original criteria init here)...;

var criteriaClone = (ICriteria)criteria.Clone(); 
```

回到你的问题。对于分页，我做了一个方法，结果是：

```
1.总行数
2.按page & pageSize过滤的行
在对 DB 的单个查询中。

```

```
ICriteria criteria = ...(your original criteria init here)...;    
var countCrit = (ICriteria)criteria.Clone();
countCrit.ClearOrders(); // avoid missing group by exceptions

var rowCount = countCrit
    .SetProjection(Projections.RowCount()).FutureValue<Int32>();

var results = criteria
    .SetFirstResult(pageIndex * pageSize)
    .SetMaxResults(pageSize)
    .Future<T>();

var resultsArray = results.GetEnumerable();

var totalCount = rowCount.Value; 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2010-07-17T10:44:46.687

```
public static DetachedCriteria Clone(this DetachedCriteria criteria)
{
   var dummy = criteria.ToByteArray();
   return dummy.FromByteArray<DetachedCriteria>();
} 
```

# c - Writing AVI files in OpenCV

> ID：368967
> 
> 赞同：11
> 
> 时间：2008-12-15T16:42:33.597
> 
> 标签：c, video, opencv, avi

There example on the net and code given in Learn OpenCv,Orielly.

After many attempts the out.avi file is written with 0 bytes. I wonder where i went wrong.

The following are the code i used...

```
int main(int argc, char* argv[]) {
    CvCapture* input = cvCaptureFromFile(argv[1]);
    IplImage* image = cvRetrieveFrame(input);

    if (!image) {
        printf("Unable to read input");
        return 0;
    }

    CvSize imgSize;
    imgSize.width = image->width;
    imgSize.height = image->height;

    double fps = cvGetCaptureProperty(
            input,
            CV_CAP_PROP_FPS
            );

    CvVideoWriter *writer = cvCreateVideoWriter(
            "out.avi",
            CV_FOURCC('M', 'J', 'P', 'G'),
            fps,
            imgSize
            );

    IplImage* colourImage;
    //Keep processing frames...
    for (;;) {

        //Get a frame from the input video.
        colourImage = cvQueryFrame(input);
        cvWriteFrame(writer, colourImage);

    }

    cvReleaseVideoWriter(&writer);
    cvReleaseCapture(&input);

} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-08T16:12:46.590

我敢打赌 cvCreateVideoWriter 返回 NULL。只需一步一步，看看它是否属实。在这种情况下，问题可能出在 CV_FOURCC(..) 上，它找不到编解码器并强制返回 0；

您可以尝试使用 -1 而不是 CV_FOURCC。运行时会提示您选择合适的编解码器

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-30T14:59:06.723

当我用谷歌搜索这个问题时，我遇到了一个答案：“Mac os x 上的 OpenCV 不支持 avi 写入，直到它将用 ffmpeg 编译”

对我来说似乎是这个解决方案 [http://article.gmane.org/gmane.comp.lib.opencv/16005](http://article.gmane.org/gmane.comp.lib.opencv/16005)

> 您需要在 cvCreateVideoWriter 中提供包含电影的文件的完整路径。我不知道这是否只是 Mac OS X 端口问题，但可能是，因为使用了 QT 后端的 QTNewDataReferenceFromFullPathCFString。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-23T14:51:21.483

嘿这段代码在 DevC++ 中工作试试看：

```
 #include<cv.h>
  #include<highgui.h>
  #include<cvaux.h>
  #include<cvcam.h>
  #include<cxcore.h>

  int main()
  {
  CvVideoWriter *writer = 0;
  int isColor = 1;
  int fps     = 5;  // or 30
  int frameW  = 1600; //640; // 744 for firewire cameras
  int frameH  = 1200; //480; // 480 for firewire cameras
  //writer=cvCreateVideoWriter("out.avi",CV_FOURCC('P','I','M','1'),
  //                           fps,cvSize(frameW,frameH),isColor);
  writer=cvCreateVideoWriter("out.avi",-1,
                       fps,cvSize(frameW,frameH),isColor);
  IplImage* img = 0; 

  img=cvLoadImage("CapturedFrame_0.jpg");
  cvWriteFrame(writer,img);      // add the frame to the file
  img=cvLoadImage("CapturedFrame_1.jpg");
  cvWriteFrame(writer,img);
  img=cvLoadImage("CapturedFrame_2.jpg");
  cvWriteFrame(writer,img);
  img=cvLoadImage("CapturedFrame_3.jpg");
  cvWriteFrame(writer,img);
  img=cvLoadImage("CapturedFrame_4.jpg");
  cvWriteFrame(writer,img);
  img=cvLoadImage("CapturedFrame_5.jpg");
  cvWriteFrame(writer,img);

  cvReleaseVideoWriter(&writer);
  return 0;
  } 
```

我编译并运行它，工作正常。（我没有在上面看到你是否得到了答案......但是对于这个特殊的事情，我之前非常努力地工作，突然间我就从一些代码片段中做到了。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-02T19:12:34.767

这是一个编解码器问题。尝试所有可能的编解码器（选项`-1`中的选项`cvCreateVideo`）。就我而言，Microsoft Video`1`运行良好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T13:18:18.613

也许您可以尝试在 for(;;) 中插入 printf("Frame found\n") 以查看它是否实际上正在捕获帧。甚至更好：

```
if(colourImage == NULL) {
    printf("Warning - got NULL colourImage\n");
    continue;
}
cvNamedWindow( "test", 1);
cvShowImage( "test", colourImage );
cvWaitKey( 0 );
cvDestroyWindow( "test" ); 
```

然后查看是否有任何窗口，以及它们是否包含正确的内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-27T07:19:45.523

这段代码运行良好：

```
 cv.h 
 highgui.h 
 cvaux.h 
 cvcam.h 
 cxcore.h 

int main(){

    CvVideoWriter *writer = 0;
    int isColor = 1;
    int fps     = 5;  // or 30
    IplImage* img = 0; 
    img=cvLoadImage("animTest_1.bmp");
    int frameW  = img->width; //640; // 744 for firewire cameras
    int frameH  = img->height; //480; // 480 for firewire cameras

    writer=cvCreateVideoWriter("out.avi",-1,
        fps,cvSize(frameW,frameH),1);

    cvWriteFrame(writer, img);      // add the frame to the file

    char *FirstFile,fF[20]="",*fileNoStr,fns[4]="";
    fileNoStr=fns;
    for(int fileNo;fileNo<100;fileNo++){
        FirstFile=fF;   
        itoa(fileNo,fileNoStr,10);
        FirstFile=strcat ( FirstFile,"animTest_");
        FirstFile=strcat ( FirstFile,fileNoStr);
        FirstFile=strcat ( FirstFile,".bmp");

        printf(" \n%s .",FirstFile);
        img=cvLoadImage(FirstFile);

        cvWriteFrame(writer, img);

    }
    cvReleaseVideoWriter(&writer);

    return 0;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-18T16:06:52.477

我认为您遇到的问题是您的“for”循环永远不会结束。因此，`cvReleaseVideoWriter(&writer);`永远`cvReleaseCapture(&input);`不会被调用。尝试类似的东西`for(int i=0; i<200; i++)`，看看你是否最终得到了一个工作视频。

视频通常会在磁盘上最终确定之前写入临时文件。如果您的文件未最终确定，则将看不到任何内容。

希望有帮助。

# c++ - 如何使用抽象类为实例数组分配内存？

> ID：368976
> 
> 赞同：3
> 
> 时间：2008-12-15T16:44:50.097
> 
> 标签：c++, memory, abstraction

我有一个在 C++ 中定义纯虚方法的抽象类：

```
class Base
{
Base();
~Base();

virtual bool Test() = 0;
}; 
```

我已经用许多其他类（它们提供了 Test() 的实现）对它进行了子类化，我将它们称为 A、B、C 等。我现在想使用它创建任何这些类型的数组基类：

```
int main(int argc, char* argv[])
{
    int size = 0;
    Base* bases = new Base[10];

    bases[size++] = new A();
    bases[size++] = new B();

    for (int i = 0; i < size; i++)
    {
        Base* base = bases[i];
        base->Test();
    }
} 
```

（请原谅我可能犯的任何错误，我正在即时写这个以提供一个简单的例子）。

问题是我无法实例化数组，因为它需要创建 Base 类的实例（它不能这样做，因为它是抽象的）。但是，如果不这样做，它就没有分配分配给数组索引所需的内存，因此在尝试访问该内存时会出现分段错误。我的印象是，将 new 和 delete 与 malloc 和 free 混合使用并不是一个好习惯。

可能是我混淆了应该使用它的方式，我应该尝试使用模板或其他一些机制来做到这一点，但希望我已经提供了足够的信息来说明我正在尝试做的事情。

那么最好的方法是什么，我将如何解决将内存分配给抽象类的问题？

谢谢，丹

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-15T16:47:50.760

该代码中只有一个轻微的误解。您必须分配指针，而不是分配 Base 对象。指针可以随时存在。指向抽象类、不完整类型甚至 void 的指针都是有效的：

```
int main(int argc, char* argv[])
{
    int size = 0;
    Base** bases = new Base*[10];

    bases[size++] = new A();
    bases[size++] = new B();

    for (int i = 0; i < size; i++)
    {
        Base* base = bases[i];
        base->Test();
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T16:49:33.723

首先，确保你的析构函数也被声明为虚拟的：

```
virtual ~Base(); 
```

你最好存储一个指向实例的指针数组：

```
Base** bases = new Base *[10]; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-15T16:59:07.743

数组依赖于其所有元素的大小相同。当您有从同一基派生的 C++ 类时，实例可以是任何大小。因此，无论基础是否抽象，都不能分配基础实例数组，然后将派生实例放在那里。

正如其他答案所说，您需要使用指针。分配一个指向基址的指针数组，然后分配各种派生实例并将指向它们的指针存储在数组中。

# c++ - Passing a Python array to a C++ vector using Swig

> ID：368980
> 
> 赞同：4
> 
> 时间：2008-12-15T16:45:43.573
> 
> 标签：c++, python, swig

I have an array of objects in Python

```
[obj1, obj2, obj3] 
```

and I want to pass them to off to a C++ function to perform some computation. I'm using SWIG to write my interface. The class type of the passed object is already defined in C++.

What's the best way to do this?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T22:17:57.007

这取决于您的函数是否已经编写并且无法更改，在这种情况下，您可能需要检查 Swig 文档以查看是否已经存在从 PyList 到 std::vector 的类型映射（我认为有）。如果没有，将 PyObject* 作为函数的参数并使用 Python C API 来操作列表应该可以正常工作。到目前为止，我还没有遇到任何问题。对于自文档，我建议将 PyObject* 类型定义为某种预期类型，例如“PythonList”，以便参数具有一定的意义。

这也可能有用：

[如何使用 SWIG 将 std::vector<int> 公开为 Python 列表？](https://stackoverflow.com/questions/276769/how-to-expose-stdvectorint-as-a-python-list-using-swig)

# php - PHP摆脱斜线完整路径

> ID：368981
> 
> 赞同：1
> 
> 时间：2008-12-15T16:45:58.237
> 
> 标签：php, string

我有一个完整的路径，我想删除它的某些级别。例如，

```
/home/john/smith/web/test/testing/nothing/ 
```

我想摆脱4个级别，所以我得到

```
/test/testing/nothing/ 
```

这样做有什么好处？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T16:49:16.280

一个简单的解决方案是将路径分割成多个部分，然后在将数组重新组合在一起之前对其进行操作：

```
join("/", array_slice(explode("/", $path), 5)); 
```

当然，如果你想删除那个特定的路径，你也可以使用正则表达式：

```
preg_replace('~^/home/john/smith/web/~', '', $path); 
```

一句忠告。如果您的应用程序经常使用路径，那么创建一个表示路径的类可能是一个好主意，以便封装逻辑，而不是到处进行大量字符串操作。如果您混合绝对路径和相对路径，这尤其是一个好主意。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-12-16T12:49:13.253

为什么你们都对完全不需要匹配的东西使用正则表达式？CPU 周期很有价值！

str_replace 会更有效：

```
$s_path = '/home/john/smith/web/test/testing/nothing/';
$s_path = str_replace('john/smith/web/test/', '', $s_path); 
```

并用于`realpath()`解析任何`'../../'`路径。

记住`dirname(__FILE__)`获取 CWD 并且`rtrim()`对于删除尾部斜杠非常有用..

# c# - C# Sorting Datagrid column by date

> ID：368997
> 
> 赞同：4
> 
> 时间：2008-12-15T16:51:46.057
> 
> 标签：c#, datagridview

I have a column that contains dates, when I click the column header the column is sorted numerically and not by date. How would I sort this by date? The date is in the format dd/mm/yy.

Example (sorted oldest first):

10/12/08 <--December 10/09/08 <--September 12/12/08 <--December

Many thanks

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-15T16:57:22.863

Is the source a datatable? If so, you'll probably need to specify that the column in question is of type DateTime:

```
myDataTable.Columns["ColumnName"].DataType = System.Type.GetType("System.Date"); 
```

Hope that helps!

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-10T15:05:00.290

如果数据源来自存储过程，则将日期作为数据集中的两列返回。一个是格式化的（varchar），另一个是日期时间数据类型。

假设存储过程返回列：COLUMN_STRING_FORMAT 和 COLUMN_DATETIME_FORMAT

在网格的标记中，

<asp:BoundColumn DataField="COLUMN_STRING_FORMAT" SortExpression="COLUMN_DATETIME_FORMAT" DataFormatString="{0:dd-MMM-yyyy}" /> <asp:BoundColumn DataField="COLUMN_DATETIME_FORMAT" Visible="false"/>

请注意第一行中的排序表达式。它指的是 DateTime 数据类型中的列。

当我以 DD-MMM-YYYY 格式对日期进行排序时，这对我有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-17T07:10:41.207

试试这个，它对我有用。

```
dataGridView1.Columns[colNum].DefaultCellStyle.Format = "d"; 
```

将 替换`colNum`为实际的列号。这`d`是短期日期。我也有军事时间，所以我不得不添加`HH:mm:ss`时间块。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-24T11:50:41.547

您应该使用单元格格式

```
dgv.Rows[rowId].Cells["colCreated"].Style.Format = "HH:mm :: dd/MM/yyyy"; 
```

或整个列的类似内容（请参阅列的 DefaultCellStyle）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-11-13T11:27:19.903

当 datagrid 未绑定到数据源并且 dataGrid 逐行填充时，以下方法适用于我：

```
//Init 
dataGridView_records.Columns[0].DefaultCellStyle.Format = "dd/MM/yy HH:mm:ss"; 
```

然后按如下方式填充数据网格：

```
DateTime date = DateTime.ParseExact((String)drs["data"], "dd/MM/yy HH:mm:ss", CultureInfo.InvariantCulture);
object[] gdr = new object[1] { date };//add the other columns data here
dataGridView_records.Rows.Add(gdr); 
```*******************