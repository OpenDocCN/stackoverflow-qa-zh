# StackOverflow 问答 000613000-000613999

# python - Python单行打印当前目录中的每个文件

> ID：613007
> 
> 赞同：1
> 
> 时间：2009-03-04T23:45:09.063
> 
> 标签：python, cygwin, cmd, pipe

如何通过 Python 使以下一行打印每个文件？

```
python -c "import sys;print '>>',sys.argv[1:]" | dir *.* 
```

具体想知道如何通过管道输入python -c。接受 DOS 或 Cygwin 响应。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T23:47:33.473

```
python -c "import os; print os.listdir('.')" 
```

如果您想应用一些格式，就像您的问题一样，

```
python -c "import os; print '\n'.join(['>>%s' % x for x in os.listdir('.')])" 
```

如果要使用管道，请使用`xargs`：

```
ls | xargs python -c "import sys; print '>>', sys.argv[1:]" 
```

或反引号：

```
python -c "import sys; print '>>', sys.argv[1:]" `ls` 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T00:06:43.847

您可以通过读取 sys.stdin 来读取通过管道传输**到Python 脚本中的数据。**例如：

```
ls -al | python -c "import sys; print sys.stdin.readlines()" 
```

目前还不完全清楚你想做什么（也许我很愚蠢）。混淆来自您的示例，该示例将数据从 python 脚本中传递出来。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T00:15:53.997

如果要打印*所有*文件：

```
find . -type f 
```

如果您只想打印当前目录的文件

```
find . -type f -maxdepth 1 
```

如果您想在每行之前包含“>>”

```
find . -type f -maxdepth 1 | xargs -L 1 echo ">>" 
```

如果您不希望 echo 中的 ">>" 和 $path 之间有空格

```
find . -type f -maxdepth 1 | xargs -L 1 printf ">>%s\n" 
```

当然，这都是使用cygwin。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T00:29:16.477

```
ls | python -c "import sys; print sys.stdin.read()" 
```

只需正常读取管道的标准输入

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T00:44:18.780

> 想知道如何管道虽然

你把管道弄错了，如果你想把'dir'的输出输入Python，'dir'必须在左边。例如。：

```
dir "*.*" | python -c "import sys;[sys.stdout.write('>>%s\n' % line) for line in sys.stdin]" 
```

（使用列表理解的 hack 是因为您不允许在分号后的一行中使用块引入“for”语句。）

显然，Python 原生解决方案（'os.listdir'）在实践中要好得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T09:12:06.987

> 具体想知道如何通过管道输入 python -c

见[cobbal 的回答](https://stackoverflow.com/questions/613007/613134#613134)

从程序的角度来看，通过程序的管道是透明的，程序所知道的只是它从标准输入流中获取输入

一般来说，一个shell命令的形式

```
A | B 
```

将 A 的输出重定向为 B 的输入

因此，如果 A 向标准输出吐出“asdf”，则 B 将“asdf”输入其标准输入

python中的标准输入流是[`sys.stdin`](http://docs.python.org/library/sys.html#sys.stdin)

# sql-server - 使用 SQL Server 从表插入中获取多个新创建的键值的最佳方法？

> ID：613016
> 
> 赞同：1
> 
> 时间：2009-03-04T23:48:24.627
> 
> 标签：sql-server

函数 Scope_Identity() 将提供从表插入中最后生成的主键值。是否有任何普遍接受的方法可以从集合的插入中获取多个键（由选择查询产生的插入）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T23:53:39.293

在 SQL Server 2005 及更高版本中，您可以使用[OUTPUT 子句](http://technet.microsoft.com/en-us/library/ms177564.aspx)来获取一组返回的值。从链接的文章：

> 下面的示例创建 EmployeeSales 表，然后使用带有 SELECT 语句的 INSERT 语句将几行插入其中，以从源表中检索数据。EmployeeSales 表包含一个标识列 (EmployeeID) 和一个计算列 (ProjectedSales)。因为这些值是在插入操作期间由 SQL Server 数据库引擎生成的，所以这些列都不能在 @MyTableVar 中定义。

```
USE AdventureWorks ;
GO
IF OBJECT_ID ('dbo.EmployeeSales', 'U') IS NOT NULL
    DROP TABLE dbo.EmployeeSales;
GO
CREATE TABLE dbo.EmployeeSales
( EmployeeID   int IDENTITY (1,5)NOT NULL,
  LastName     nvarchar(20) NOT NULL,
  FirstName    nvarchar(20) NOT NULL,
  CurrentSales money NOT NULL,
  ProjectedSales AS CurrentSales * 1.10 
);
GO
DECLARE @MyTableVar table(
  LastName     nvarchar(20) NOT NULL,
  FirstName    nvarchar(20) NOT NULL,
  CurrentSales money NOT NULL
  );

INSERT INTO dbo.EmployeeSales (LastName, FirstName, CurrentSales)
  OUTPUT INSERTED.LastName, 
         INSERTED.FirstName, 
         INSERTED.CurrentSales
  INTO @MyTableVar
    SELECT c.LastName, c.FirstName, sp.SalesYTD
    FROM HumanResources.Employee AS e
        INNER JOIN Sales.SalesPerson AS sp
        ON e.EmployeeID = sp.SalesPersonID 
        INNER JOIN Person.Contact AS c
        ON e.ContactID = c.ContactID
    WHERE e.EmployeeID LIKE '2%'
    ORDER BY c.LastName, c.FirstName;

SELECT LastName, FirstName, CurrentSales
FROM @MyTableVar;
GO
SELECT EmployeeID, LastName, FirstName, CurrentSales, ProjectedSales
FROM dbo.EmployeeSales;
GO 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T14:02:58.923

使用行数和最后一个标识值....

```
DECLARE @LastID  int
DECLARE @Rows    int

--your insert from a select here

SELECT @LastID=@@IDENTITY, @Rows=@@ROWCOUNT

--set of rows you want...
SELECT * FROM YourTable Where TableID>@LastID-@Rows AND TableID<=@LastID 
```

# php - 有谁知道从 YUI 开始的好网站？

> ID：613017
> 
> 赞同：1
> 
> 时间：2009-03-04T23:48:27.510
> 
> 标签：php, javascript, yui

有谁知道从 YUI 开始的好网站？

雅虎的开发人员手册对我来说太混乱了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T23:52:51.713

[Webmonkey](http://www.webmonkey.com/)有一个关于 YUI的不错的小[教程。](http://www.webmonkey.com/tutorial/Create_Rich_Interfaces_With_the_YUI_Library)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T00:52:46.733

试试 [http://www.insideria.com/2008/05/writing-your-first-yui-applica.html](http://www.insideria.com/2008/05/writing-your-first-yui-applica.html)

# emacs - 如何在 Emacs 中用换行符替换字符？

> ID：613022
> 
> 赞同：312
> 
> 时间：2009-03-04T23:50:14.403
> 
> 标签：emacs, replace

我正在尝试使用和/或在 Emacs`;`中用新行替换一个字符 - 比如说 - 。`replace-string``replace-regexp`

我尝试了以下命令：

*   `M-x` `replace-string` `RET` `;` `RET` `\n`

    这将替换`;`为两个字符：`\n`.

*   `M-x` `replace-regex` `RET` `;` `RET` `\n`

    这会导致以下错误（显示在 minibuffer 中）：

    > 在替换文本中使用无效的 `'。

`replace-string`用于此任务有什么问题？还有另一种方法吗？

* * *

## 回答 #1

> 赞同：477
> 
> 时间：2009-03-04T23:52:48.513

`M-x` `replace-string` `RET` `;` `RET` `C-q C-j`.

*   `C-q`对于`quoted-insert`,

*   `C-j`是换行符。

* * *

## 回答 #2

> 赞同：87
> 
> 时间：2014-03-16T21:58:32.023

我发现有四种方法可以将换行符放入迷你缓冲区。

1.  `C-o`

2.  `C-q C-j`

3.  `C-q` `12`（12 是换行符的八进制值）

4.  `C-x o`到主窗口，用 杀死一个换行符`C-k`，然后`C-x o`回到迷你缓冲区，用 猛拉它`C-y`

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-05T12:02:19.947

不要忘记您可以随时剪切并粘贴到 minibuffer 中。

因此，您可以从缓冲区中复制一个换行符（或任何字符串），然后在提示输入替换文本时将其拉出。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-08-01T22:25:08.920

更明确地说：

要将分号字符 (;) 替换为换行符，请按照以下确切步骤操作。

1.  将光标定位在缓冲区左上角要更改的包含文本

2.  输入`m-x`替换字符串并点击`Return`

3.  迷你缓冲区将显示如下内容：替换字符串（默认 ^ -> ）：

4.  输入要替换的字符。在这种情况下，`;` 并击中`Return`

5.  迷你缓冲区将显示如下内容：

    细绳 ; 和：

6.  现在执行`C-q C-j`

7.  分号的所有实例将被替换一个换行符（从光标位置到缓冲区末尾现在将出现）

它比原来的解释说的还要多。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-02-18T04:24:48.527

切换到文本模式：

```
M-x text-mode 
```

突出显示要缩进的块。

缩进：`Ctrl`+ `M`</kbd>

切换回任何模式...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-10-11T04:05:55.240

仅内联：

`C-M-S-%`（如果绑定键仍然是默认值）然后 `replace-string` `^``J`.

# javascript - 使用jQuery计算两个特定行之间的表行数

> ID：613024
> 
> 赞同：11
> 
> 时间：2009-03-04T23:50:25.260
> 
> 标签：javascript, jquery, html-table

```
<table>
  <tr id="parent_1">
    <td>Parent 1</td>
  </tr>
  <tr class="child">
    <td>Child 1</td>
  </tr>
  <tr class="child">
    <td>Child 2</td>
  </tr>
  ...
  <tr id="parent_2">
    <td>Parent2</td>
  </tr>
  ...
</table> 
```

如何使用 jQuery 找到 parent_1 和 parent_2 之间的子行数？

编辑：抱歉，没有明确说明这只是一个示例，该表可以包含任意数量的父行和任意数量的子行

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-05T00:23:47.643

这会让你得到你想要的

```
var childCount = ($('#parent_2').get(0).rowIndex - $('#parent_1').get(0).rowIndex) - 1; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-04T23:59:58.840

这：

```
$('#parent_1 ~ .child:not(#parent_2 ~ *)').size() 
```

翻译：匹配类中所有`child`属于 , 的兄弟和*之后*的元素，`#parent_1`但不匹配属于 的兄弟和之后的元素`#parent_2`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T23:56:45.197

想到的第一个想法。我确信有一些精心设计的方法可以选择有问题的元素（这意味着您只需要做 $(selector).length），但我想不出一个。

```
var doCount = false;
var numberOfChildren = 0;

$('tr').each(function(i){
    if($(this).is("#parent_2"))
        doCount = false;

    if(count)
        numberOfChildren++;

    if($(this).is("#parent_1"))
        doCount = true;
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T00:13:38.590

我认为最好的方法可能是手动计数。它会更快，因为当你知道你已经完成计数时你可以停下来（如果你的桌子很大，这很有用）。

```
var rowid1 = 'parent_1';
var rowid2 = 'parent_2';

var rows = $("#"+rowid1).parent().find('tr');
var count = 0;

for (var i = 0; i < rows.size(); i++) {
    var el = rows.get(i);

    // Done counting
    if (el.id == rowid2) break;

    if (el.id != rowid1) {
        ++count;
    }
}

alert("There are " + count + " rows between"); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T00:22:08.663

有些人在这里有一些很好的答案，我已经开始使用我的了，所以我只是添加它以获取更多信息。

```
$(document).ready(function() {
    n = 0;
    var x = new Array(0,0,0);

    $("table tr").each(function(i)
    {
        if($(this).hasClass("child"))
        {
            x[n] += 1;
        }
        else
        {
            n += 1;
        }
    });

    for(var y = 0; y < x.length; y++)
    {
        alert(x[y]);
    }
}); 
```

顺便说一句，我的编辑不在乎有多少父母，只要数组足够大，它就会一直计数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T23:54:20.913

假设 parent_1 和 parent_2 分别是开始行和结束行：

```
$("#parent_1").siblings().size() - 1 
```

# php - 滚动您自己的纯文本 Wiki（数据库中的 Wiki）

> ID：613038
> 
> 赞同：6
> 
> 时间：2009-03-04T23:55:08.960
> 
> 标签：php, database, wiki, wiki-engine

任何人都知道用于创建类似 wiki 的数据存储的 API（最好是 php，但我对任何语言都感兴趣）？

滚动您自己的纯文本 wiki 的任何资源如何？其他纯文本 wiki 如何处理文本文件的格式？

我知道我可以使用 Markdown 或 Textile 进行格式化。但我最感兴趣的是如何处理多用户编辑的明文存储。

我正在编写一个主要是数据库驱动的 Web 应用程序。我希望该数据库的至少一个文本字段采用类似 wiki 的格式。具体来说，该文本可以由多个用户编辑，并且能够回滚到任何版本。[想想Last.FM](http://www.last.fm/music/Oingo+Boingo/)的 wiki/bio 部分（几乎整个网站都是由数据库严格构建的，除了每个艺术家的这个部分）。

到目前为止，我将 MediaWiki 拆分并整合到数据库中的方法似乎有点矫枉过正。我认为滚动我自己的纯文本 wiki 并将此文件存储在数据库的适当文本字段中会容易得多。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-05T00:41:35.963

所以，基本上这是一个“我如何在我的数据库中版本文本信息”。

嗯，最简单的方法就是简单地复制数据。

简单地说，创建一个包含“旧版本”数据的“版本”表，并将其链接回您的主表。

```
create table docs {
    id integer primary key not null,
    version integer not null,
    create_date date,
    change_date date,
    create_user_id integer not null references users(id),
    change_user_id integer references users(id),
    text_data text
}

create table versions {
    id integer primary key not null,
    doc_id integer not null references docs(id),
    version integer,
    change_date date,
    change_user integer not null references users(id),
    text_data text
} 
```

每当您更新原始文档时，将旧文本值复制到此表中，复制用户并更改日期并更新版本。

```
select version, change_date, change_user, text_data 
    into l_version, l_change_data, l_change_user, l_text_data 
from docs where id = l_doc_id;

insert into versions values (newid, l_doc_id, l_version, 
    l_change_date, l_change_user, l_text_data);

update docs set version = version + 1, change_date = now, 
    change_user = cur_user, text_data = l_new_text where id = l_doc_id; 
```

如果您的数据库支持这些，您甚至可以在触发器中执行此操作。

这种方法的缺点是它是数据的完整副本（因此，如果您有一个大文档，则版本会很大）。您可以通过使用 diff(1) 和 patch(1) 之类的方法来缓解这种情况。

例如：

```
diff version2.txt version1.txt > difffile 
```

然后您可以将该差异文件存储为“版本 1”。

为了从版本 2 中恢复版本 1，您需要获取版本 2 数据，使用 diff 文件数据对其运行补丁程序，这将为您提供 v1.1 版本。

如果您想从 v3 转到 v1，则需要执行两次（一次获取 v2，然后再次获取 v1）。

这降低了您的存储负担，但增加了您的处理（显然），因此您必须判断您想要如何执行此操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T01:04:49.903

威尔的巨大答案是正确的，但我认为可以总结一下：你需要存储版本，然后你需要存储元数据（数据的谁在什么时间）。

但是您的问题是关于类似 Wiki 的版本控制的资源。我没有（嗯，一个：[上面威尔的回答](https://stackoverflow.com/questions/613038/rolling-your-own-plaintext-wiki-wiki-inside-a-db/613165#613165)）。但是，关于 Wiki 的存储，我有一个。查看[来自 DokuWiki 的比较矩阵](http://www.wikimatrix.org/show/DokuWiki)。我知道。你在想“我在乎什么品牌的 DB 不同的 Wiki 使用？” 因为 DokuWiki 使用纯文本文件。你可以打开它们，它们确实很简单。所以这是一种方法，对于为什么 DBMS 不是最好的方法，他们有一些有趣的论据。它们甚至不包含太多元数据：大部分内容都是通过平面文件本身完成的。

DokuWiki 对您的意义在于，这可能是一个相对简单的问题（取决于您想要解决的程度：）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T00:12:05.723

这是 WikiMatrix 上所有 12 个用 PHP 编写并使用文本文件进行存储的 wiki 的列表。也许其中一个将具有您可以适应数据库的存储方法：

[http://www.wikimatrix.org/search.php?sid=1760](http://www.wikimatrix.org/search.php?sid=1760)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T00:38:36.360

听起来您实际上只是在寻找版本控制。如果是这种情况，您可能需要研究 diff 算法。

这是维基百科[差异](http://en.wikipedia.org/wiki/Diff)页面。

我做了一个快速的 php diff google 搜索，但没有一个像样的例子，因为我只有基本的 PHP 知识。

# c# - 在 C# 中比较两个 DateTime 的相等性的最佳方法是什么......但只能达到一定的精度？

> ID：613041
> 
> 赞同：6
> 
> 时间：2009-03-04T23:55:53.500
> 
> 标签：c#, datetime, date

我有两个日期时间，一个来自时间戳，另一个是我在代码中生成的。我需要测试它们的平等性，并且愿意在没有太多表达的情况下做到这一点。这是我的两个日期的示例：

```
DateTime expireTimeStampUTC = 
    DateTime.Parse(UTCValueFromDatabase));
DateTime expectedExpireTime = 
    DateTime.UtcNow.AddHours(NumberOfExpectedHoursInConfig); 
```

这是一个测试的精度太高：

if (expireTimeStampUTC.Equals(expectedExpireTime)){}

我不在乎它们是否精确到秒，只是小时。

它可能是做这样的复合的最佳解决方案：

```
if (expireTimeStampUTC.Date.Equals(expectedExpireTime.Date))
{
    if (!expireTimeStampUTC.Hour.Equals(expectedExpireTime.Hour))
    {
        pass = false;
    }
} 
```

我不是 C# 最有经验的人......有什么优雅的方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-05T00:19:24.427

如果您遇到的问题是因为它们是数据库类型，您可以转换为该类型并在那里进行比较，我们在大约 1/3 的数据库保存中损失/获得大约一毫秒转换为 SQLDateTimes。

如果不是，请比较您真正关心的单位：

```
DateTime dt1 = DateTime.UtcNow;
DateTime dt2 = DateTime.UtcNow.AddMinutes(59); // or 1 or 61 for test values;

// if the dates are in the same hour (12:10 == 12:50, 1:58 != 2:02)
if(dt1.Hour == dt2.Hour) // result 
```

或者如果你关心他们在一小时的时间跨度内

```
// if the dates are within one hour of each other (1:58 == 2:02, 3:30 != 4:45)
if((dt1 - dt2).Duration() < TimeSpan.FromHours(1)) // result 
```

这里减去日期会生成一个时间跨度，持续时间是“绝对值”，然后我们从我们关心的单位（FromHours）显式创建限制并进行比较。

最后一行是我认为在特定时间跨度内进行平等的干净利落。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T23:59:02.667

如何找出两个小时之间的差异，看看它是否低于某个阈值（比如一个小时 3600 秒）？

```
var diff = expireTimeStamp.Subtract(expectedExpireTime).TotalSeconds;
pass = Math.Abs(diff) < 3600; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T23:59:44.503

减去它们。检查结果是否[`TimeSpan`](http://msdn.microsoft.com/en-us/library/system.timespan(VS.80).aspx)在某个最大范围内。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T23:58:27.970

构造新的 DateTime 对象并比较它们。在 C# 中，以这种方式构造“一次性”对象几乎没有什么惩罚。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-22T06:55:44.387

我在尝试编写提交然后检索业务对象的单元测试时遇到了这个问题。我试图使用对象的“StartTime”属性来确保可以检索对象并遇到此问题。数据库中提交的“StartTime”值在 Ticks 值中丢失了 6 位精度！

这是我重写测试条件的方法，以便我的测试能够正确执行并通过。相关行是块的倒数第二行。

```
DateTime start = DateTime.Now;
NewEventInfo testEvent1 = FakeEvent("test01action", start); //plus other params for testing
mServiceClient.AddEvent(testEvent1);

EventInfo[] eventInfos = null; //code to get back events within time window

Assert.IsNotEmpty(eventInfos);
Assert.GreaterOrEqual(eventInfos.Length, 1);

EventInfo resultEvent1 = eventInfos.FirstOrDefault(e => 
e.Action == "test01action" &&
Math.Abs(e.StartTime.Subtract(testEvent1.StartTime).TotalMilliseconds) < 1000); //checks dates are within 1 sec
Assert.IsNotNull(resultEvent1); 
```

这样我可以确定该对象是单元测试提交的对象，因为 EventInfo.StartTime 属性仅使用精度为 1 秒的日期时间。

编辑：添加了 Math.Abs​​（围绕 DateTime diff）以确保将绝对值与 1000 进行比较。

# mysql - 与 MySQL ALTER TABLE 相比，Oracle 架构更改的性能？

> ID：613059
> 
> 赞同：3
> 
> 时间：2009-03-05T00:02:07.680
> 
> 标签：mysql, oracle

当使用 MySQL MyISAM 表并发出 ALTER TABLE 语句来添加列时，MySQL 会创建一个临时表并将所有数据复制到新表中，然后再覆盖原始表。

如果那个表有很多数据，这个过程可能会很慢（尤其是在重建索引时），并且需要您在磁盘上有足够的可用空间来存储表的 2 个副本。这很烦人。

添加列时 Oracle 是如何工作的？在大桌子上速度快吗？

我总是对能够在没有大量停机时间的情况下进行架构更改感兴趣。我们一直在向我们的软件添加新功能，这些新功能需要在每个版本中更改架构。任何建议表示赞赏...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T01:05:17.547

在 Oracle 的大表中添加没有数据的列通常非常快。没有数据的临时副本，也不需要重建索引。当您想要将一列添加到一个大表并将数据回填到所有现有行的新列中时，通常会出现缓慢，因为现在您正在谈论影响大量行的 UPDATE 语句。

随着时间的推移，添加列会导致行迁移。如果您有一个 80% 的块，有 4 行，并且您添加的列会随着时间的推移将每行的大小增加 30%，那么您最终会达到 Oracle 必须将 4 行之一移动到不同的位置的地步。堵塞。它通过在旧块中留下指向新块的指针来实现这一点，这会导致对该迁移行的读取需要更多 I/O。消除迁移的行可能会有些昂贵，尽管假设您使用的是企业版，通常可以在不停机的情况下做到这一点，但如果您有一点停机时间，通常会更容易。但是行迁移是您通常只需要担心的事情。如果您知道某些表将来可能会大幅增加其行大小，

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T02:30:15.673

关于停机时间，更改表（和一堆其他 DDL 操作）需要排他锁。然而，Oracle 也可以使用 DBMS_REDEFINITION 包执行对象的在线重新定义，这确实可以减少停机时间。

# c# - C# 与 C 的互操作与与 Java 的互操作：哪个更好/更容易/更快？

> ID：613063
> 
> 赞同：1
> 
> 时间：2009-03-05T00:02:34.450
> 
> 标签：c#, java, c, interop

我有一个 C# 中的应用程序，当前对 LDAP 进行身份验证。我们希望扩展功能以支持 IBM 的 Tivoli Access Manager，它由 Policy Server 和 LDAP 服务器（以及其他模块）组成。不幸的是，为我们的客户使用 LDAP 服务器进行身份验证是不可接受的，因此我们必须改为绑定策略服务器。

TAM 的策略服务器有 2 个用于身份验证的 API，一个使用 Java，一个使用 C

我的问题：C# 互操作、C 或 Java 哪种语言更好？

牢记：可维护性和开发成本。

提前感谢大家。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T00:11:18.627

在我看来，C 是 C# 更容易交互操作的语言，因为 .NET 中有一个本机接口允许“不安全”访问。要与 Java 通信，您必须通过 JNI 才能进入 Java，或者使用 J#，或者跳过循环从 C# 到 Java 并再次返回。

我没有进行任何 C# 到 Java 的通信（通过套接字或 Web 服务除外），但我所在的团队使用 JNI 通过 C++ 代码从 Java 到 COM 通信。我们最终不得不放弃 JNI 解决方案，因为它太笨重了。我们用 C# 重写了 C++ 组件，并使用固定的套接字在两个组件之间进行通信。这非常有效。

根据这个经验，如果您已经在使用 C#，那么我会使用 C# 中的 C API。这很容易做到。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T00:09:47.803

过去，我在托管 C++/CLI 与 C/C++ 接口方面取得了很好的成功，在与 java 接口方面不能说太多。

此外，如果您要直接使用 C，则可以将函数调用直接导出到 C#。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T00:52:12.867

我认为您正在连接的 API 只不过是一个 API。一个前端是 Java，另一个是 C，但您可能不与 Java 代码交互，可能只是 C。

也就是说，我想无论哪个界面看起来更简单。我猜 C 是，但如果有一些很棒的 Java 绑定软件可以让 C# 轻松访问 Java 库，那可能会更好。

很可能它们都链接到 API 正下方的 C 代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T05:18:27.187

我喜欢埃迪的回答，但我会用这个观察来缓和它 - 这取决于你在家里拥有的技能。如果你有很多 Java 专家，那么使用 Java 是有意义的。如果您有一群 C 程序员，那么选择是显而易见的。

另一条评论：你确定[TAM 不做 .NET](http://search.msn.com/results.aspx?q=%22Tivoli+access+manager%22++.NET)吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-31T18:15:26.570

我是[jni4net](http://jni4net.sf.net/)的作者，它是 JVM 和 CLR 之间的开源进程内桥梁。它建立在 JNI 和 PInvoke 之上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-09T05:09:30.867

您不需要在 C# 和 C 或 Java 之间架起任何桥梁。正如 Cheeso 所引用的，TAM 已经支持 .NET API 一段时间了——有关信息，请参见[此处](http://www-01.ibm.com/software/tivoli/resource-center/security/code-access-mgr.jsp)。

# domain-driven-design - 存储库的替代数据访问模式

> ID：613065
> 
> 赞同：0
> 
> 时间：2009-03-05T00:04:18.487
> 
> 标签：domain-driven-design, dao, repository

我的域中有某些不是聚合根/实体的对象，但我仍然需要从数据库中检索它们。我不想通过为这些东西创建存储库来混淆事情。那么，什么是替代数据访问模式？您是否会简单地为它们创建一个 DAO，同时仍然分离接口？

编辑：

关于我在做什么的更多细节。我需要创建一个代码。此代码对其格式有一定的规则。规则之一是最后一个字符必须是一个唯一的数字，从最后生成的代码开始加一。例如：

ABCD1 ABCD2 ABCD3

因此，我保留了一张表格，其中包含一行、一列来存储相关数字。现在，我不想将这个数字视为一个实体并为其创建一个存储库——这太过分了。我只需要一种检索数字、将其加 1 并保存的方法。我知道有无数种方法可以做到这一点，但我想知道是否有习惯的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T00:10:35.680

理论上，有几种数据访问模式可以应用。如果您希望我们建议特定模式，您需要提供更多详细信息。

如果没有更多细节，我只能建议考虑查看[Martin Fowler 的企业应用程序架构模式](http://martinfowler.com/)一书。

编辑：习惯方式？不，不是我能想到的——这实际上取决于您在域中的何处以及如何使用此唯一代码。如果我这样做，我可能会创建一个直接与数据库对话以执行此功能的小型服务 - 不像存储库那样重量级，并且非常专注于手头的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T00:26:50.290

基于编辑：我将首先查看您需要在其中创建该代码的上下文。也许有一些相关的实体或您缺少的东西。

顺便说一句，我发现这个问题真的很有趣，因为它在编写特定功能时不时出现。我通常最终会发现我在场景中遗漏了一些东西，它最终很适合正常的存储库模式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T07:46:40.950

在调查了选项后，我将使用 Table Gateway 模式。

# c# - SQL Server 超时疑难解答

> ID：613068
> 
> 赞同：7
> 
> 时间：2009-03-05T00:05:53.117
> 
> 标签：c#, sql-server

我有一个 Web 服务，几年来一直运行良好而无需修改。今天突然它决定它不想运行，并抛出一个 SQL 超时：

System.Data.SqlClient.SqlException：超时已过期。在操作完成之前超时时间已过或服务器没有响应。

有趣的是，此 Web 服务与数据库位于同一台服务器上，而且如果我从 SQL 跟踪中提取查询并在管理工作室中运行它，它会在一秒钟内返回。但是，当从 Web 服务调用时，它会在 30 秒后超时。我正在使用企业库连接到数据库，所以我无法想象随机开始失败。

我不太确定是什么突然使它停止工作。我已经回收了它所在的应用程序池，甚至重新启动了我看到它正在使用的 SQL 进程。相同的行为。有什么办法可以解决这个问题？

**更新：**米奇*做到*了。只要我在 sproc 定义中的“AS”关键字之前添加“WITH RECOMPILE”，它就恢复了活力。太棒了！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T00:08:10.973

您描述的症状 99.9% 肯定是由于不正确的缓存查询计划造成的。

请看这些答案：

*   [Managment Studio 和 TableAdapter 之间存储过程的执行时间差异很大](https://stackoverflow.com/questions/452467/big-difference-in-execution-time-of-stored-proc-between-managment-studio-and-tabl)

*   [`WITH RECOMPILE`关于何时使用选项的经验法则](https://stackoverflow.com/questions/422632/rule-of-thumb-on-when-to-use-with-recompile-option)

其中包括重建索引和确保统计数据是最新的建议作为起点。

您是否安排并启用了定期索引维护作业？

规范参考是：[应用程序慢，SSMS 快？](http://www.sommarskog.se/query-plan-mysteries.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T00:10:23.747

重建任何相关索引。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T00:11:24.647

更新统计信息，检查探查器中查询的设置选项。SSMS 可能正在使用不同的连接集选项。

# popup - 到达某个页面后弹出浏览器返回父浏览器

> ID：613079
> 
> 赞同：4
> 
> 时间：2009-03-05T00:10:16.320
> 
> 标签：popup

我有一个在链接点击时打开的弹出窗口（我必须使用它）。我让用户浏览一系列选择属性的页面，然后将其发送到购物车。

我的问题：在用户完成选择过程后，我想终止打开的弹出窗口并将请求发送回原始浏览器（父级），以便用户可以结帐。

知道我会怎么做吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T00:13:52.597

Javascript：在子（弹出）窗口中。

```
window.opener.location = 'page.html";
window.close(); 
```

那是你要找的吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T00:16:33.653

可以使用 JavaScript 中的“opener”访问父窗口。例子：

```
window.opener.title='hello parent window'; 
```

或者

```
window.opener.location.href='http://redirect.address'; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-22T09:07:37.397

我的孩子形式的脚本：

```
<script language="JavaScript" type="text/javascript">
    function SetData() {
        // form validation
         // var frmvalidator  = new Validator("myForm");
        // frmvalidator.addValidation("name","req","Please enter Account Name");

        // get the new dialog values
        var str1 = document.getElementById("name").value;
        var winArgs = str1;

        // pass the values back as arguments
        window.returnValue = winArgs;
        window.close();
        document.myForm.submit();
    }
</script> 
```

我的父表单中的脚本：

```
<% @account_head= current_company.account_heads.find_by_name("Sundry Debtors")%>
<script type="text/javascript">
    function OpenDialog() {
        var winSettings = 'center:yes;resizable:no;help:yes;status:no;dialogWidth:450px;dialogHeight:200px';

        // return the dialog control values after passing them as a parameter
        winArgs = window.showModalDialog('<%= "/accounts/new?account_head_id=#{@account_head.id} #man" %>', winSettings);

        if(winArgs == null) {
            window.alert("no data returned!");
        } else {
            // set the values from what's returned
            document.getElementById("to_account_auto_complete").value = winArgs;
        }
    }
</script> 
```

这是工作，但不是我想要的，如果找到好的解决方案，请提出任何建议。

# character-encoding - 精通编码的 grep 替代品？

> ID：613087
> 
> 赞同：10
> 
> 时间：2009-03-05T00:11:42.540
> 
> 标签：character-encoding, grep

我很沮丧 grep 在我的 UTF-16 文档中找不到像“hello”这样的词。

任何人都可以推荐一个尝试猜测文件编码然后正确处理它的 grep 版本吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T03:16:54.063

## ack 作为基于 perl 的 grep 替代品？

你肯定想看看[`ack`](http://petdance.com/ack/)。

它支持 Unicode 编码，基本上是 grep，但更好。

## 尝试使用 grep 匹配的 Unicode 语言环境

如果您在 Linux、Unix 等系统下，您可能希望将 LANG 变量更改为编码以匹配您的文档。

首先检查您的语言环境。这是我在*MacBook Pro*上的默认设置：

```
 $ locale 
 LANG="en_US.UTF-8"
 LC_COLLATE="en_US.UTF-8"
 LC_CTYPE="en_US.UTF-8"
 LC_MESSAGES="en_US.UTF-8"
 LC_MONETARY="en_US.UTF-8"
 LC_NUMERIC="en_US.UTF-8"
 LC_TIME="en_US.UTF-8" 
 LC_ALL= 
```

说，在bash下：

```
$ LANG="foo" grep 'gotta be found now' file.name 
```

一些更永久的东西（小心这个）：

```
$ export LANG="foo"
$ grep 'bar' mitz.vah 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T00:26:49.727

Perl 有一种比 grep 更好的正则表达式语法（更强大），它支持 UTF8 和 UTF16，但我不确定它在猜测编码方面有多好......不过，如果你告诉它使用哪种编码，它可以毫无问题地读取这些文件并在它们上运行正则表达式。为此，您必须自己编写一个小型 Perl 程序（可以说是您自己在 Perl 中实现的 micro-grep 实现），但这并不难。Perl 适用于所有主要操作系统。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-04-16T14:26:54.233

> 我很沮丧 grep 在我的 UTF-16 文档中找不到像“hello”这样的词。
> 
> 任何人都可以推荐一个尝试猜测文件编码然后正确处理它的 grep 版本吗？

1.  [ugrep](https://github.com/Genivia/ugrep)是免费的 BSD-3 开源，支持所有 UTF 编码，并通过支持 GNU/BSD grep 命令行选项声称是 grep 的真正替代品。同样，ripgrep、ack 和 silver searcher (ag) 也支持 UTF 编码，但不是 grep 的直接替代品，因为它们的行为和选项与 grep 不同。

2.  您可以`iconv`结合使用过滤器实用程序`grep`将 UTF-16 文件转换为 UTF-8，但您必须明确指定输入和输出编码，例如：

    iconv -f utf-16 -t utf8` < file.txt | grep 模式

# java - Eclipse 插件 - 类对象

> ID：613097
> 
> 赞同：0
> 
> 时间：2009-03-05T00:14:30.147
> 
> 标签：java, eclipse, eclipse-plugin

我正在创建一个 Eclipse 插件，我需要所选文件的 Class 对象，而不是 IType。有可能吗，最好的方法是什么？

编辑：当我想到它时，最好的方法是像 run as 一样添加它（就像 junit、profiler 或其他插件正在做的那样）。我想他们必须有权访问 Class （如果 X 是有问题的类），因为他们正在运行它的功能。那么如何创建具有“运行方式”操作的插件并获取活动对象？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T05:11:58.670

例如，在 Eclipse 插件中，您将通过[**IAction**](http://kickjava.com/src/org/eclipse/jface/action/IAction.java.htm)获取所选文件。
（它代表可由最终用户触发的命令的非 UI 端。操作通常与按钮、菜单项和工具栏中的项相关联。）

从那里：

```
IResource selectedResource = ResourceUtils.getSelectedResource(); 
```

[**IResource**](http://kickjava.com/src/org/eclipse/core/resources/IResource.java.htm)文件系统文件和目录的工作区模拟。有四种*类型*的资源：文件、文件夹、项目和工作区根。

根据它的类型，您可以将其转换为**[IFile](http://kickjava.com/src/org/eclipse/core/resources/IFile.java.htm)**，这使您可以访问其完整路径 ( `getFullPath()`)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T22:43:13.027

Eclipse 使用所选择对象的抽象表示，无论是文件（IResource）还是Java 类型（IJavaType）。由于不需要编译源文件（例如禁用自动构建），因此编辑的代码不一定要有 .class 文件或 Class 对象。因此，没有正确的方法从用户界面中的选择中获取“类”对象。

但是，正如昨天提到的，您可以依赖 Eclipse 构建器机制将始终立即编译源文件并因此存在 .class 文件这一事实。要在运行时访问此 .class 文件，您需要为项目创建动态类加载器或启动运行时 VM。我试过了，它确实有效，但这是一种非常不稳定的方法，可能会导致各种难以追踪的故障。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T11:59:22.457

IType "curIType" 的类名可以通过

```
curIType.getFullyQualifiedName() 
```

这是简单的部分。但是你有一个问题，这个类不必在你的插件的类加载器中（如果它是一个用户项目的类，它很少是你的类加载器的一部分）。所以调用 Class.forName(classname) 不会有任何好处。

我有一个类似的案例，并且（在第一次尝试中）通过使用自己的类加载器创建一个自己的线程来解决它，其中包括当前类加载器的所有库和该类型项目的所有库。这既不是一个简短的代码也不是一个简单的代码，我已经对其进行了重构。从 IType 中获取所有信息并且不在插件代码中的任何地方使用类要简单得多。

# c# - TableAdapter 偶尔会返回行数 1 但所有列都为空

> ID：613107
> 
> 赞同：0
> 
> 时间：2009-03-05T00:17:38.017
> 
> 标签：c#, .net, sql, tableadapter

我会在我的页面上刷新 20 次，它会工作，然后几分钟后它会停止工作 5 分钟。tableadapter 说它的计数为 1，但是当我访问一个属性时，例如： tableadapter1[0].property1 它会引发异常：

[StrongTypingException：表 'blogpull' 中列 'blogpull_keywords' 的值为 DBNull。]

但是当我在 SQL 管理中运行该方法后面的存储过程时，它不会返回任何空值，只是数据。

```
careers.jobdepartmentDataTable dtDepartments = new jobdepartmentTableAdapter().GetDepartmentByJobID(iJobID);
        if (dtDepartments.Count > 0)
        {
            try
            {
                iDepartmentID = dtDepartments[0].job_department_id; //thows error here
            }
            catch
            {
                Context.Response.Write("error info: " + iJobID.ToString());
                Context.Response.End();
            } 
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T01:40:34.090

我在连接字符串中设置了 MultipleActiveResultSets = true 并且这个错误消失了。

# python - 为什么我在 Python 中得到错误的结果 hmac 而不是 Perl？

> ID：613111
> 
> 赞同：2
> 
> 时间：2009-03-05T00:20:15.797
> 
> 标签：python, perl, hash, hmac

我正在尝试使用 sha-512 计算 hmac。

Perl 代码：

```
use Digest::SHA qw(hmac_sha512_hex);

$key = "\x0b"x20;
$data = "Hi There";

$hash = hmac_sha512_hex($data, $key);
print "$hash\n"; 
```

并给出正确的哈希

```
87aa7cdea5ef619d4ff0b4241a1d6cb02379f4e2ce4ec2787ad0b30545e17cde  
daa833b7d6b8a702038b274eaea3f4e4be9d914eeb61f1702e696c203a126854 
```

蟒蛇版本：

```
import hashlib, hmac

print hmac.new("\x0b"*20, "Hi There", hashlib.sha512).hexdigest() 
```

这给出了不正确的散列

```
9656975ee5de55e75f2976ecce9a04501060b9dc22a6eda2eaef638966280182
477fe09f080b2bf564649cad42af8607a2bd8d02979df3a980f15e2326a0a22a 
```

任何想法为什么 Python 版本给了我错误的哈希？

编辑：
版本是darwin 上的
Python 2.5.1 (r251:54863, Jan 13 2009, 10:26:13)
[GCC 4.0.1 (Apple Inc. build 5465)]

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-05T01:23:29.687

是的，确实——似乎python2.5的Leopard版本是坏的。

下面在基于 Penryn 的 MBP 上运行...

```
$ **uname -a**
Darwin lizard-wifi 9.6.0 Darwin Kernel Version 9.6.0: Mon Nov 24 17:37:00 PST 2008; root:xnu-1228.9.59~1/RELEASE_I386 i386
dpc@lizard-wifi:~$ **which python**
/usr/bin/python 
```

运行安装在 Leopard OS 中的这个版本

```
dpc@lizard-wifi:~$ python
Python 2.5.1 (r251:54863, Jan 13 2009, 10:26:13) 
[GCC 4.0.1 (Apple Inc. build 5465)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import hashlib, hmac
>>> print hmac.new("\x0b"*20, "Hi There", hashlib.sha512).hexdigest()
9656975ee5de55e75f2976ecce9a04501060b9dc22a6eda2eaef638966280182477fe09f080b2bf564649cad42af8607a2bd8d02979df3a980f15e2326a0a22a
>>> 
```

然后是 MacPorts 版本的`python2.5`

```
$ /opt/local/bin/python2.5
Python 2.5.4 (r254:67916, Feb  3 2009, 21:40:31) 
[GCC 4.0.1 (Apple Inc. build 5488)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import hashlib, hmac
>>> print hmac.new("\x0b"*20, "Hi There", hashlib.sha512).hexdigest()
87aa7cdea5ef619d4ff0b4241a1d6cb02379f4e2ce4ec2787ad0b30545e17cdedaa833b7d6b8a702038b274eaea3f4e4be9d914eeb61f1702e696c203a126854
>>> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T00:30:30.810

我无法在这里复制您的结果。在使用 Python 2.5 的 IDLE 中：

```
Python 2.5.2 (r252:60911, Feb 21 2008, 13:11:45) [MSC v.1310 32 bit (Intel)] on win32 Type "copyright", "credits" or "license()" for more information.

...

IDLE 1.2.2      
>>> import hashlib, hmac
>>> print hmac.new("\x0b"*20, "Hi There", hashlib.sha512).hexdigest()
87aa7cdea5ef619d4ff0b4241a1d6cb02379f4e2ce4ec2787ad0b30545e17cdedaa833b7d6b8a702038b274eaea3f4e4be9d914eeb61f1702e696c203a126854 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T00:27:08.417

哪个版本的 Python？Python 3 中的字符串是 Unicode。这是 Unicode 问题吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T00:50:23.807

在python 2.5.2下我得到了正确的哈希
我猜是旧版本的问题

# iphone - mobileSafari中iphone的文本字段输入中的小“x”？

> ID：613114
> 
> 赞同：13
> 
> 时间：2009-03-05T00:22:02.797
> 
> 标签：iphone, html, ajax

我一直在到处寻找这个没有任何运气。如果您在 iphone 上访问 google.com，当您专注于搜索字段时，右侧会一直出现一个小“x”，如果您触摸它，它会清除该字段的当前值。有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T00:58:59.760

这是一种特殊类型的输入，由 Apple 开发，未经 W3C 批准。如果您使用它，它可以在无法识别它的浏览器上正常工作。

```
<input type="search" name="q" /> 
```

还有其他参数，包括域名和搜索结果，因此用户可以使用他们的搜索历史。谷歌如何使用这些。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T01:02:55.087

我在 Safari 中使用了开发菜单并将用户代理更改为 iPhone。在谷歌上查看源代码，看起来他们的 html 是这样设置的：

```
<div class="gp2">
<input class="gp7" id="query" type="text" name="q" size="30" maxlength="2048" autocorrect="off" autocomplete="off" />
<a class="clear" id="clearQuery" href="#">
    <img src="data:image/gif;base64,R0lGODlhAQABAID%2FAMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw%3D%3D" alt="" />
</a> 
```

并正在使用这个 javascript：

```
function initClearQueryLink(query,clearQuery){
    clearQuery.setAttribute("title","Clear");
    clearQuery.addEventListener("mousedown",clearQueryBox,true);
    query.addEventListener("keyup",_handleClearQueryLink,false)
}

function _handleClearQueryLink(){
    var query=document.getElementById("query");
    var clearQuery=document.getElementById("clearQuery");
    if(clearQuery)
        if(query.value.length>0){
            clearQuery.style.display="inline";
            clearQuery.style.visibility="visible"
        } else{
            clearQuery.style.display="none";
            clearQuery.style.visibility="hidden"
        }
}

function clearQueryBox(event){
    var query=document.getElementById("query");
    var clearQuery=document.getElementById("clearQuery");
    query.value="";
    clearQuery.style.display="none";
    clearQuery.style.visibility="hidden";
    hideSuggest();
    if(event)event.preventDefault()
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-16T01:01:14.200

诀窍是在 mousedown 上侦听/绑定事件，这样单击事件永远不会触发并且您的输入元素不会失去焦点。如上面的谷歌示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T00:43:58.640

iPhone web 开发的一个非常好的资源是[iphonewebdev](http://groups.google.com/group/iphonewebdev)。

然而，这个特殊功能似乎不是 Apple API 的一部分（至少从我的研究来看），而是纯粹的 javascript / css 实现。

您可以使用以下内容重新创建它：

```
<script>
    window.onload = function() {
        var btn = document.getElementById("clear_input");
        btn.onclick = function() {
            var div = btn.parentNode;
            var input = div.getElementsByTagName("input")[0];
            input.value = "";
            return false;
        }
    }
</script>
<div>
    <input type="text" /><a href="#" id="clear_input">X</a>
</div> 
```

您应该将 X 设置为图像，以便它融合到输入中。当然，如果可以的话，我强烈推荐使用 JavaScript 框架。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-05T03:19:59.253

Jquery mobile 提供了这个：

[http://jquerymobile.com/test/docs/forms/search/](http://jquerymobile.com/test/docs/forms/search/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-25T12:42:58.163

这是我的 jQuery 版本，它在开始时将其隐藏，如果用户删除键入的内容，它将删除“x”。此外，当他们使用按钮删除文本时，它也会隐藏“x”。

**html**：

```
<input type="search" name="search" id="search" />
<a href="#" class="clear_input">X</a> 
```

**JavaScript**：

```
$('.clear_input').hide();   
    $('#search').keyup(function() {

        var search = $(this).val().replace(/^\s+|\s+$/g,"");

        if (search.length >= 1) {
            $('.clear_input').show();
        } else {
            $('.clear_input').hide();
        }

        $('.clear_input').click(function() {
            $('#search').val('');
            $('.clear_input').hide();
        }); 
    }); 
```

JavaScript 版本当然比 jQuery 版本快。

# svn - 用于 Windows 的 svn 客户端二进制文件

> ID：613119
> 
> 赞同：49
> 
> 时间：2009-03-05T00:23:53.807
> 
> 标签：svn, command-line-tool, binaries

SVN 命令行版本的 Windows 二进制文件在哪里？无论我在哪里搜索，它都必须是一些公司的带有安装程序的精美客户端软件。

我正在使用没有管理员帐户的机器。只需给我简单的命令行二进制文件，它们到底在哪里？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-05T00:33:35.313

以前的直接链接不起作用，但 subversion 项目现在提供了几个到 Windows 二进制文件的非现场链接：

[http://subversion.apache.org/packages.html#windows](http://subversion.apache.org/packages.html#windows)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-05T00:33:51.880

我使用[Slik SVN](http://www.sliksvn.com/)。它不需要像 CollabNet 那样需要一堆注册信息。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-05T01:01:28.863

[从Slik SVN](http://www.sliksvn.com/en/download/)获取版本，不需要注册，你应该可以在任何你想要的地方安装它（并且有权限）。

如果您无法运行安装程序，您可以随时尝试使用[UniExtract](http://legroom.net/software/uniextract)或使用[MSI 插件的](http://ghisler.fileburst.com/plugins/msi_plugin.zip)[Total Commander](http://www.ghisler.com/)从中[提取文件](https://stackoverflow.com/questions/549065/how-to-extract-files-from-msi-package)。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-05T01:12:53.487

您始终可以使用[cygwin](http://www.cygwin.com/)并在安装过程中安装 subversion 包，这将使其可以在命令提示符下访问（通过一些 $PATH 更改），但我知道这是否不符合您的“仅二进制文件”标准。

**编辑**：我理解为什么人们不赞成，但这只是获取二进制文件进行颠覆的最后手段。要回答“如果您只需要 subversion，为什么要安装所有 cygwin”的问题：我发现最初是一个 linux 应用程序，我更愿意在 cygwin 等 *nix 环境中使用 subversion，因此可以利用 GNU 实用程序，例如`find`, `grep`,`bash`等来执行基于文件的操作，颠覆主要处理。

因为这个我建议它，我认为这将是最简单和最快的方式来获得颠覆，因为 OP 对找到合法的二进制文件表示沮丧：点击几下，你就完成了。这是一个被要求的建议，在我最初的评论中，我有一个警告，那就是在那里安装 cygwin。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-08-17T07:27:07.527

我已经找到了这个：[http](http://alagazam.net/) ://alagazam.net/ 。[这与http://sourceforge.net/projects/win32svn/](http://sourceforge.net/projects/win32svn/)确实是同一个项目，在另一个答案中提出了建议。

这是最接近原始的 pre-Apache 二进制文件的解决方案。在过去的两三年里，我一直在毫无问题地使用它。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-05T00:30:53.790

[http://subversion.tigris.org/](http://subversion.tigris.org/)

客户端二进制文件随源以及其他几个打包的安装程序一起提供。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-05T00:29:41.517

[CollabNet](http://www.collab.net/downloads/subversion/)的命令行客户端，虽然它确实有一个 Windows 安装程序，但它只要求您将文件放在哪里，然后完成。它只是命令行客户端，就像它说的那样，没有别的。Subversion 不分发自己的二进制文件。

> Subversion 项目并未正式认可或维护任何 Subversion 软件的二进制包。但是，志愿者已经为不同的发行版和平台创建了二进制包，为了方便起见，我们在此处维护了指向它们的链接列表。如果对不同的二进制包有任何问题或疑问，请发送电子邮件至 Subversion 用户邮件列表。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-04-21T19:59:31.307

我已经成功地将二进制文件下载到一个 zip 文件中，并在没有管理员访问权限的 Windows 上使用它们：

[http://sourceforge.net/projects/win32svn/](http://sourceforge.net/projects/win32svn/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-12-05T10:21:52.980

如前所述，请查看官方[Apache Subversion Binary Packages](http://subversion.apache.org/packages.html#windows)页面。

如果您正在寻找最新的 Subversion 命令行工具的压缩二进制文件，您可以在[http://www.visualsvn.com/downloads/](http://www.visualsvn.com/downloads/) (!) 上获取它们，无需任何注册。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-08-11T09:45:09.150

便携式二进制文件也可以在以下位置找到：

[http://www.smartsvn.com/download#svn](http://www.smartsvn.com/download#svn)

# asp.net - 如何编写支持参数化查询的数据库类

> ID：613129
> 
> 赞同：1
> 
> 时间：2009-03-05T00:27:50.117
> 
> 标签：asp.net, ado.net, class-design

我曾经是一名经典的 ASP 程序员，有时也是编写我的第一个 ASP.NET 应用程序的 PHP 程序员。我喜欢大大改进的 ADO.NET 函数，但我觉得有必要编写一个数据库类。一方面我想整合实际与数据库交互的代码，另一方面我想减少重复的感觉。

一个简单的数据库类并不难做，但我使用参数化查询作为我的安全措施之一。我正在努力解决如何将其纳入课程中。我编写了一个函数，通过传入表和列名来返回数据库中列的数据类型，但是我想不出一种从 SQL 查询中获取表和列名的可靠方法。

我对这个类的设计是有一个用于选择的 Query() 函数和一个用于插入/更新/删除的 Execute() 函数。（不反对拥有更多的公共函数，但不想超越自己。）这两个函数都采用 SQL 字符串和 SortedList 作为参数。可以通过在 SQL 字符串中查找参数名称并查看等号前面来获取列名称。同样，当查询是插入、更新或删除时，获取表名应该相当简单，因为您一次只使用一个表。最大的问题是选择，因为可能有一个或多个连接、内部选择等。

我是不是走错了方向？我没有想到的任何事情都会使我的生活更轻松或更困难？有人用任何可以提供一些建议的语言为此写了一个课程吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T00:58:29.840

不要重新发明轮子。查看[nHibernate](http://www.hibernate.org/343.html)或[LINQToSQL](http://msdn.microsoft.com/en-us/library/bb425822.aspx)（或[LINQToEntities](http://msdn.microsoft.com/en-us/library/bb386964.aspx)）以满足您的 ORM 需求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T01:07:49.520

会第二次打电话来寻找适合您的久经考验的轮子，特别是如果这是您第一次涉足 aspnet ……还有很多其他事情可以让您忙碌。

[会为SubSonic](http://subsonicproject.com/)添加一个建议，它可能比 nHibernate 轻一点，但这实际上取决于您的项目的性质，它们都是很棒的工具，并且在过去几年中都为我节省了几个月的工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T01:46:13.717

我认为由于这是您在 ASP.NET 中的第一次体验，因此建议您研究一下 Linq to SQL。做[一些教程](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)，以便在尝试编写任何 Linq 查询代码之前了解它的工作原理。

我能想到的在您的情况下不使用 Linq to SQL 的唯一原因是您不使用 SQL Server（或者现在或将来需要支持其他数据库），或者由于某种原因您不能使用 .NET 3.5 运行时.

祝你好运

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T01:09:20.920

在我看来，您的“简单数据库类”向需要使用它的类隐藏了太多细节。

我编写了包含 SqlCeEngine 的类并公开了诸如“LookupDescription(String Code)”之类的方法……我认为这种设计是您应该研究的。并且，考虑研究 LINQ。它有很多东西可以提供。

# c++ - 依赖注入和运行时对象创建

> ID：613131
> 
> 赞同：4
> 
> 时间：2009-03-05T00:27:53.313
> 
> 标签：c++, dependency-injection

我一直在尝试遵循依赖注入的原则，但是[在阅读了这篇文章之后，我知道我做错了什么。](http://misko.hevery.com/2008/10/21/dependency-injection-myth-reference-passing/)

这是我的情况：我的应用程序收到不同类型的物理邮件。所有传入的邮件都通过我的`MailFunnel`对象。

在运行时，`MailFunnel`从外部接收不同类型的消息：Box、Postcard 和 Magazine。

每种邮件类型都需要以不同方式处理。例如，如果有一个盒子进来，我可能需要在交付之前记录重量。因此，我有`BoxHandler`和对象。`PostcardHandler``MagazineHandler`

每次有新消息进入 my`MailFunnel`时，我都会实例化一个**新**的相应`MailHandler`对象。

例如：

```
邮件漏斗类
{
  无效NewMailArrived（邮件邮件）
  {
    开关（邮件类型）
    {
      案例框：
        BoxHandler * bob = new BoxHandler(shreddingPolicy, maxWeightPolicy);
        鲍勃->get_to_work();
        休息;

      案例明信片：
        PostcardHandler * frank = new PostcardHandler(coolPicturePolicy);
        坦率->get_to_work();
        休息;

      案例杂志：
        MagazineHandler * nancy = new MagazineHandler(censorPolicy);
        南希->get_to_work();
        休息;
    }
  }

  私人的：
    最大权重策略和最大权重策略；
    ShreddingPolicy & shreddingPolicy;
    CoolPicturePolicy &coolPicturePolicy;
    审查政策和审查政策；
}

```

一方面，这很好，因为这意味着如果我收到五封不同的邮件，我立即有五个不同的`MailHandlers`工作同时处理业务。然而，这也意味着[我将对象创建与应用程序逻辑混合在一起](http://misko.hevery.com/2008/09/10/where-have-all-the-new-operators-gone/)——当涉及到依赖注入时，这是一个很大的禁忌。

此外，我的`MailFunnel`对象中有所有这些`MailFunnel`实际上不需要的策略引用。拥有这些对象的唯一原因`MailFunnel`是将它们传递给`MailHandler`构造函数。同样， [这是我要避免的另一件事](http://misko.hevery.com/2008/10/21/dependency-injection-myth-reference-passing/)。

欢迎所有建议。谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T00:53:52.237

这对我来说更像是一个工厂。将 get_to_work() 方法的调用移出调用并返回处理程序。这种模式对工厂来说效果很好。

```
class MailHandlerFactory
{
  IMailHandler*  GetHandler( Mail mail )
  {
    switch (mail.type)
    {
      case BOX:
        return new BoxHandler(shreddingPolicy, maxWeightPolicy);
        break;

      case POSTCARD:
        return new PostcardHandler(coolPicturePolicy);
        break;

      case MAGAZINE:
        return new MagazineHandler(censorPolicy);
        break;
    }
  }

  private:
    MaxWeightPolcy & maxWeightPolicy;
    ShreddingPolicy & shreddingPolicy;
    CoolPicturePolicy & coolPicturePolicy;
    CensorPolicy & censorPolicy;
}

class MailFunnel
{
    MailHandlerFactory* handlerFactory;

    MailFunnel( MailHandlerFactory* factory ) {
        handlerFactory = factory;
    }

    void NewMailArrived( Mail mail ) {
        IMailHandler handler = handlerFactory.GetHandler(mail);
        handler.get_to_work();
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T00:34:52.563

为什么你不能只使用三个重载的方法来接收不同类型的邮件，然后做适当的事情？或者让每种类型自己处理。

事实上，如果你有类似类型的东西，那么你实际上应该有不同的类型。

基本上做到以下几点：

1) 使 Mail 类抽象。

2) 创建邮件、Box、PostCard 和 Magazine 三个子类

3）给每个子类一个方法来处理邮件，或者集中在一个单独的HandlerFactory中

4) 当传递到邮件漏斗时，只需让它调用处理邮件方法，或者让 HandlerFactory 将邮件传递给它，然后取回适当的处理程序。同样，不要到处使用笨拙的 switch 语句，而是使用该语言，这就是类型和方法重载的目的。

如果您的邮件处理变得复杂并且您想将其取出，您最终可以创建一个邮件处理程序类并将这些策略提取到其中。

您也可以考虑使用模板方法，因为它们之间唯一真正的区别似乎是您实例化的处理程序，也许您可​​以简化它，例如邮件类型确定处理程序，其余代码基本相同.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T00:46:52.050

当您看到该 switch 语句时，请考虑多态性。这种设计只能通过修改来扩展。我会以这样一种方式重做它，以便我可以通过添加类来添加新的行为。这就是开放/封闭原则的全部意义所在。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T00:56:33.727

有趣的是，您正在将依赖注入应用到 C++ 项目；它已经在其他地方完成，快速谷歌搜索找到谷歌代码项目[Autumn Framework](http://code.google.com/p/autumnframework/)。

但是 tvanfosson 的答案是我建议在采用新框架之前先尝试一下。

# c# - 高效的字符串匹配算法

> ID：613133
> 
> 赞同：4
> 
> 时间：2009-03-05T00:28:09.537
> 
> 标签：c#, algorithm

我正在尝试构建一个有效的字符串匹配算法。这将在大容量环境中执行，因此性能至关重要。

以下是我的要求：

*   给定一个域名，即 www.example.com，确定它是否“匹配”条目列表中的一个。
*   条目可能是绝对匹配的，即 www.example.com。
*   条目可能包含通配符，即*.example.com。
*   通配符条目从最定义的级别开始匹配。例如，*.example.com 将匹配 www.example.com、example.com 和 sub.www.example.com。
*   未嵌入通配符条目，即 sub.*.example.com 将不是条目。

语言/环境：C# (.Net Framework 3.5)

我考虑将条目（和域查找）拆分为数组，颠倒顺序，然后遍历数组。虽然准确，但感觉很慢。

我考虑过正则表达式，但担心将条目列表准确表示为正则表达式。

我的问题：根据上面列出的描述，查找一个以域名形式存在的字符串是否与字符串列表中的任何一个匹配的有效方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-05T00:54:03.873

如果您想自己动手，我会将条目存储在树结构中。请参阅[我对有关拼写检查器的另一个 SO 问题的回答，](https://stackoverflow.com/questions/346757/how-do-spell-checkers-work/346818#346818)以了解我的意思。

而不是用“。”标记结构。字符，我只会将每个条目视为一个完整的字符串。无论如何，任何标记化的实现仍然必须对完整的字符集进行字符串匹配，因此您不妨一次性完成所有操作。

这与常规拼写检查树之间的唯一区别是：

1.  匹配需要反向进行
2.  您必须考虑通配符

要解决第 2 点，您只需在测试结束时检查“*”字符。

一个简单的例子：

参赛作品：

```
*.fark.com
www.cnn.com 
```

树：

```
m -> o -> c -> . -> k -> r -> a -> f -> . -> *
                \
                 -> n -> n -> c -> . -> w -> w -> w 
```

检查 www.blog.fark.com 将涉及到遍历树直到第一个`"*"`. 因为遍历结束于 a `"*"`，所以存在匹配。

检查 www.cern.com 将在 n,n,c, 的第二个“n”上失败...

检查 dev.www.cnn.com 也会失败，因为遍历以 . 以外的字符结束`"*"`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T00:32:36.390

我会使用正则表达式，只需确保将表达式编译一次（而不是一次又一次地计算）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-05T00:56:13.043

您不需要正则表达式 .. 只需反转所有字符串，去掉“*”，并放置一个标志以指示部分匹配，直到这一点过去。

不知何故，trie 或后缀 trie 看起来最合适。

如果在编译时域列表是已知的，您可以在“.”处查看标记化。并使用多台 gperf 生成的机器。

链接：谷歌搜索 [http://marknelson.us/1996/08/01/suffix-trees/](http://marknelson.us/1996/08/01/suffix-trees/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T00:40:10.070

我会使用树结构来存储规则，其中每个树节点是/包含一个字典。

构造树使得“com”、“net”等是顶级条目，“example”在下一级，依此类推。您需要一个特殊标志来说明该节点是通配符。

要执行查找，请按句点拆分字符串，然后向后迭代，根据输入导航树。

这似乎与您所说的类似，但假设规则不会更改每次运行，使用缓存的基于字典的树将比数组列表更快。

此外，我敢打赌这种方法会比 RegEx 更快。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T00:34:50.550

对于您认为有效的输入，您似乎有一套明确定义的规则——您可以考虑为此使用手写的[LL 解析器](http://en.wikipedia.org/wiki/LL_parser)。这样的解析器相对容易编写和优化。通常你会让解析器输出一个描述输入的树结构 - 我会使用这个树作为匹配例程的输入，该例程执行将树与条目列表匹配的工作，使用上面描述的规则。

这是[一篇关于递归下降解析器](http://www.engr.mun.ca/~theo/Misc/exp_parsing.htm)的文章。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T00:53:02.037

假设规则如您所说：文字或以 * 开头。

爪哇：

```
public static boolean matches(String candidate, List<String> rules) {
    for(String rule : rules) {
        if (rule.startsWith("*")) {
            rule = rule.substring(2);
        }
        if (candidate.endsWith(rule)) {
            return true;
        }
    }
    return false;
} 
```

这取决于您拥有的规则数量。

编辑：

在这里要清楚。

当我说“对规则进行排序”时，我的意思是从规则字符中创建一棵树。

然后您使用匹配字符串尝试遍历树（即，如果我有一个 xyz 字符串，我从 x 字符开始，看看它是否有 y 分支，然后是 az child）。

对于“通配符”，我将使用相同的概念，但将其“向后”填充，并与匹配候选者的后面一起走。

如果您有很多（很多）规则，我会对规则进行排序。

对于非通配符匹配，您迭代每个字符以缩小可能的规则（即，如果它以“w”开头，那么您使用“w”规则等）

如果它是通配符匹配，您会执行完全相同的操作，但您会针对“向后规则”列表工作，并且只需将字符串末尾与规则末尾匹配即可。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-05T01:38:58.057

我会尝试结合使用[最长前缀匹配的](http://en.wikipedia.org/wiki/Longest_prefix_match)[尝试](http://en.wikipedia.org/wiki/Trie)（用于 IP 网络的路由）。[如果空间是一个问题，有向无环词图](http://en.wikipedia.org/wiki/Directed_acyclic_graph#Directed_acyclic_word_graph)可能比尝试更合适。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-05T04:01:26.357

我将建议树结构方法的替代方案。使用 Burrows-Wheeler 变换创建域列表的压缩索引。有关该技术的完整说明，请参阅[http://www.ddj.com/architect/184405504?pgno=1](http://www.ddj.com/architect/184405504?pgno=1)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-05T00:35:06.447

看看[RegExLib](http://regexlib.com/Search.aspx?k=URL)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-05T00:42:53.653

不确定您对拆分和迭代的想法是什么，但似乎不会很慢：

如您所说，向上和反向拆分域。存储本质上可以是一棵树。使用哈希表来存储 TLD。例如，键是“com”，值是该 TLD 下的子域的哈希表，反复迭代，令人作呕。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-05T00:46:43.253

鉴于您的要求，我认为您正在考虑从字符串末尾 (TLD) 到主机名的工作。您*可以*使用正则表达式，但由于您并没有真正使用正则表达式的任何功能，我不明白您为什么要承担它们的成本。如果您反转字符串，则更明显的是您实际上只是在寻找前缀匹配（'*.example.com' 变为：“'moc.elpmaxe' 是我输入字符串的开头吗？），这当然不会不需要像正则表达式那样严厉的东西。

您用于存储条目列表的结构在很大程度上取决于列表的大小和更改的频率……对于一个巨大的稳定列表，树/树可能是性能最高的；一个经常变化的列表需要一个易于初始化/更新的结构，等等。如果没有更多信息，我不会推荐任何一种结构。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-05T00:55:55.117

我想我很想用另一个问题来回答你的问题：你在做什么，你认为你的瓶颈是一些字符串匹配，超出了简单的字符串比较？在你的性能分析中肯定还有其他东西列在更高的位置吗？

我会首先使用明显的字符串比较测试，这在 90% 的情况下都是正确的，如果它们失败，则回退到正则表达式

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-05T04:40:00.960

如果它只是匹配字符串，那么您应该查看 trie 数据结构和算法。较早的答案表明，如果您的所有通配符一开始都是一个通配符，则可以使用一些特定的算法。但是，处理通用通配符的要求意味着，为了快速执行，您将需要生成一个状态机。

这就是正则表达式库为您所做的：“预编译”正则表达式 == 生成状态机；这使得运行时的实际匹配速度更快。如果没有特别的优化工作，您不太可能获得比这更好的性能。

如果你想自己动手，我可以说专门为多个通配符编写自己的状态机生成器应该是有教育意义的。在这种情况下，您需要阅读他们在正则表达式库中使用的算法类型......

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-05T05:15:49.720

研究 KMP (Knuth-Morris-Pratt) 或 BM (Boyer-Moore) 算法。这些使您可以比线性时间更快地搜索字符串，但需要进行一些预处理。正如其他人所指出的，删除前导星号当然是至关重要的。

这些信息的一个来源是：

KMP：[http ://www-igm.univ-mlv.fr/~lecroq/string/node8.html](http://www-igm.univ-mlv.fr/~lecroq/string/node8.html)

BM：[http ://www-igm.univ-mlv.fr/~lecroq/string/node14.html](http://www-igm.univ-mlv.fr/~lecroq/string/node14.html)

# user-interface - 区域邻近用户界面

> ID：613144
> 
> 赞同：1
> 
> 时间：2009-03-05T00:32:28.793
> 
> 标签：user-interface, regional, proximity

我正在开发一个 UI（启用 AJAX；LAMP 服务器），它允许用户指定公司运营的区域。在这种情况下，“地区”可能是一个州（如果与美国打交道）、一个省（加拿大）或整个国家（其他所有人）。

由于世界上有 195 个国家/地区，我想避免使用多选框或复选框列表。在通往这个特定屏幕的工作流中，用户已经输入了公司的完整地址，所以我有一个起始区域可以工作。

由于大多数公司只在自己的区域外运营，而覆盖多个区域的公司往往不会分支太远，我正在考虑根据邻近度逐步显示区域列表。我意识到在某个时候（我现在使用 3 次通行证）需要显示完整列表；我只是想延迟用户到达那一点，因为这是一个明确的边缘情况。

[这是一个 PNG 模型，可以更清楚地解释这个概念](http://mark-hurd.com/temp/region-proximity.png)。(196kb)

**问题：**

*   您对实际的表单交互有什么建议？这还没有呈现给有代表性的最终用户，但我对原型设计阶段的所有建议持开放态度。
*   您认为在转换之间“汇总”美国各州和/或加拿大各省会对用户的空间记忆产生负面影响吗？
    *   更清楚的是：在第三次通过后，公司将在美国的每个州开展业务——因此将这 50 个输入转换为一个。
*   是否有任何现有的应用程序使用这种方法作为基准或演示？
*   而且，因为我知道我的开发人员会想知道 - 存储每个区域的接近度的最简单方法是什么？中心的纬度/经度？“边界框”每个角的纬度/经度（更准确）？我假设我们最终会根据公司实际地址的纬度/经度编写一些邻近度计算。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T00:58:22.303

我不太清楚你想从当前的 UI 中实现什么（你在寻找分支机构吗？其他公司？等等？）

我不喜欢使用纯粹的地理邻近度来定义区域。例如，如果一家公司在纽约市经营，它可能在新泽西州设有一间办公室，该办公室很可能远在月球上。另一方面，对于锚地的公司，温哥华的办事处仍可能在该地区内。不幸的是，州界也毫无意义。例如，我住在宾夕法尼亚州西部，可以告诉你，虽然匹兹堡和费城在同一个州，但它们可能是不同的国家，而且大多数公司在每个国家都有办事处。

如果您的项目是基于灯的，为什么不让用户单击地图上的一个点，然后根据该点询问他的意思（例如，最近的城市、整个县、整个州、整个国家？如果您需要定义整个区域，您也许可以使用某种抓取工具来单击或描绘可能属于其中的所有其他区域？

无论哪种方式，将您的办公室显示为地图上的图钉，然后可能在标准谷歌地图处理搜索的方式旁边有一个列表。

这可能是很多工作，但如果它是一个重要的表单，用户可能更喜欢手动输入文本或从列表中选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T14:23:48.640

您是否希望用户阅读地图以了解要访问的复选框列表？如果您的用户具有一定程度的地理能力，那么他们直接从地图中选择区域，而不是让他们进行地图到邻近级别的认知转移，然后进行邻近级别到 -区域转移。

如果某些用户没有那种水平的地理专业知识（您可能会惊讶于有多少美国人在美国地图上找不到自己的州），那么我会尝试，也许除了地图之外，不超过两个列表，一个近端（默认）具有靠近家庭地址的区域，并且一个详尽无遗。我看不到地理能力较弱的用户能够处理多个任意级别的接近度。不能很好地阅读地图的人将无法估计一个地区与另一个地区的接近程度。所以我们的想法是尝试一个最近的列表，如果这不起作用，那么忘记邻近度并详尽无遗——不要让你的用户在邻近度之间徘徊寻找爱达荷州（“我发誓它在印第安纳州附近”）。

默认情况下，根据对可能客户的研究，显示可能满足大多数用户的区域的邻近列表。“更多”按钮显示详尽列表。两个列表都应按字母顺序排序，除了首先将详尽列表细分为美国各州、加拿大省和地区以及国家（包括美国（全部）和加拿大（全部））。

您可以提供一些命令按钮来选择多个区域（例如，“所有 48 个连续的美国州，所有南美洲），允许用户在之后取消选择某些区域。出于这个原因，在用户提交输入之前，我不会汇总任何内容。

作为某人使用地图加列表的示例（全部在 HTML 中，不少于），请参阅[http://justaddwater.dk/2007/12/21/map-with-positions-in-css/](http://justaddwater.dk/2007/12/21/map-with-positions-in-css/)

# algorithm - 计算图像之间的差异

> ID：613146
> 
> 赞同：29
> 
> 时间：2009-03-05T00:33:25.297
> 
> 标签：algorithm, image

你们知道任何可用于计算图像之间差异的算法吗？

以这个网页为例[http://tineye.com/](http://tineye.com/)你给它一个链接或上传一张图片，它会找到类似的图片。我怀疑它是否会将相关图像与所有图像进行比较（或者可能会）。

通过计算，我的意思是像[Levenshtein_distance](http://en.wikipedia.org/wiki/Levenshtein_distance)或[Hamming 距离](http://en.wikipedia.org/wiki/Hamming_distance)对于字符串的含义。

我绝对不需要为一个项目或任何东西提供正确的答案，我只是找到了这个网站并且很好奇。我知道 digg 为他们的网站支付了类似的服务。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-05T01:03:10.640

最简单的措施将是基于 RMS 误差的方法，例如：

*   [均方根偏差](http://en.wikipedia.org/wiki/RMSD)
*   [峰值信噪比](http://en.wikipedia.org/wiki/PSNR)

这些可能与您的距离度量概念融为一体，但它们的结果只有在您有两张已经非常接近的图像时才真正有意义，就像您正在查看特定压缩方案如何保存原始图像一样。此外，两种比较的相同结果可能意味着很多不同的事情，具体取决于存在的伪影类型（请查看我在下面引用的论文，其中一些 RMS/PSNR 的示例照片可能会产生误导）。

除此之外，还有一个专门研究图像相似性的研究领域。我不是专家，但这里有一些建议：

*   许多工作已经进入使用[降维](http://en.wikipedia.org/wiki/Dimensionality_reduction)（PCA、SVD、特征值分析等）的方法来挑选图像的主要成分并在不同的图像之间进行比较。

*   其他方法（特别是医学成像）使用[分割](http://en.wikipedia.org/wiki/Segmentation_(image_processing))技术来挑选图像的重要部分，然后根据发现的内容比较图像

*   还有一些人试图设计相似性度量来解决 RMS 误差和 PSNR 的一些缺陷。有一篇关于[空间域结构相似性 (SSIM)](http://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=230F49B56EF7810EBD8B84BD3ACF7815?doi=10.1.1.5.54&rep=rep1&type=pdf)度量的非常酷的论文，它试图模仿人们对图像错误的看法，而不是直接的、数学的错误概念。在[这篇关于 WSSIM的论文中，同样的人使用](http://www.ece.uwaterloo.ca/~z70wang/publications/icassp05.pdf)[小波分析](http://en.wikipedia.org/wiki/Wavelet)做了一个改进的平移/旋转不变版本。

*   看起来 TinEye 使用具有*许多*属性值的特征向量来进行比较。如果你在他们的网站上四处寻找，你最终会到达[Ideé Labs](http://labs.ideeinc.com)页面，[他们的常见问题解答](http://labs.ideeinc.com/faq.html#technology)有一些（但不是太多）算法细节：

    *问：视觉搜索如何工作？*

    *答：Idée 的视觉搜索技术使用复杂的算法来分析数百种图像属性，例如颜色、形状、纹理、亮度、复杂性、对象和区域。这些属性形成了一个紧凑的数字签名，描述了每张图像的外观，而这些签名由我们的软件计算和索引。在执行视觉搜索时，我们的搜索引擎会快速比较这些签名，以返回视觉上相似的结果。*

这绝不是详尽无遗的（这只是我在自己的研究过程中遇到的一些技术），但如果你在谷歌上搜索技术论文或查看最近关于图像处理的会议记录，你一定会发现这个东西的更多方法。这不是一个已解决的问题，但希望这些指针能让您了解所涉及的内容。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T00:50:55.113

一种技术是使用[颜色直方图](http://en.wikipedia.org/wiki/Color_histogram)。您可以使用机器学习算法根据您使用的表示来查找相似的图像。比如常用的[k-means算法](http://en.wikipedia.org/wiki/K-means)。[我已经看到其他解决方案试图在使用边缘检测](http://en.wikipedia.org/wiki/Edge_detection)后分析图像中的垂直和水平线。还使用[纹理分析。](http://www.cs.iupui.edu/~tuceryan/research/ComputerVision/texture-analysis.html)

最近的[一篇论文](http://www.cs.ucsb.edu/~wychen/sc.html)对来自 picasa 网络的图像进行了聚类。您也可以尝试我正在研究的[聚类算法。](http://ktree.sf.net)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T00:54:13.937

考虑使用有损[小波压缩](http://en.wikipedia.org/wiki/Wavelet_compression)并比较图像的最高相关性元素。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T00:43:03.120

TinEye 所做的是对图像或其部分进行散列处理（请参阅他们的[常见问题解答](http://tineye.com/faq#how)）。它可能不是真正的哈希函数，因为他们想要相似（或几乎相同）图像的相似“哈希”。但他们需要做的就是比较该散列和可能的子串，以了解图像是否相似/相同，或者是否包含在另一个中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T00:44:55.863

这是一个[图像相似性](http://www.cs.umu.se/kurser/TDBAfl/VT06/algorithms/BOOK/BOOK5/NODE196.HTM)页面，但它用于多边形。您可以根据颜色和形状将图像转换为有限数量的多边形，并在每个多边形上运行这些算法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T02:00:13.980

这是我 4 年前在 java **yikes**中编写的一些代码，它使用直方图进行图像比较。除了 buildHistograms() 之外，不要看它的任何部分

[https://jpicsort.dev.java.net/source/browse/jpicsort/ImageComparator.java?rev=1.7&](https://jpicsort.dev.java.net/source/browse/jpicsort/ImageComparator.java?rev=1.7&) view=markup

也许它有帮助，至少如果你使用的是 java

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T00:49:20.860

相关技术将使匹配跳出。如果它们是 JPEG，您可以比较每个 8x8 块的主要系数并获得不错的匹配。这不完全是相关性，但它基于余弦变换，所以它是第一个表亲。

# svn - SVN：无法读取状态行：连接已被服务器关闭

> ID：613149
> 
> 赞同：29
> 
> 时间：2009-03-05T00:33:54.907
> 
> 标签：svn

今天，当我尝试更新时，我的 subversion 存储库开始出现此错误。有什么建议么？

> svn：' [http](http://example.org/example_repo) ://example.org/example_repo '的选项：无法读取状态行：连接已被服务器关闭（[http://example.org](http://example.org)）

看来，当我使用 svn+ssh 而不是 HTTP 时，它可以工作。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2013-01-08T22:46:10.283

我有同样的问题。原来是与 Cisco Anyconnect 客户端的网络安全模块发生冲突。我意识到这一点是因为我看到了一些控制台消息，进行了搜索并发现了这个： [http ://www.thebitguru.com/blog/view/394-Random%20Slowdown%20of%20Browsers%20in%20OS%20X %20山%20狮子](http://www.thebitguru.com/blog/view/394-Random%20Slowdown%20of%20Browsers%20in%20OS%20X%20Mountain%20Lion)

把它放在我的脑海里：

*   移除 cisco anyconnect，成功
*   重新安装了没有“网络安全”模块的anyconnect，成功。

这令人困惑，因为它以前运行良好。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-05T00:40:17.450

我相信这是一个协议问题。您最近是否更改了有关 HTTP/HTTPS 的任何服务器设置？

您可以尝试对 [https://example.org/example_rep](https://example.org/example_rep)执行“svn relocate” 。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-11-10T16:47:19.347

它对我有用。当我应该有 HTTPS 时，我尝试了 HTTP。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-01-14T10:02:27.880

这发生在我的 Cisco VPN 客户端（AnyConnect 安全移动客户端）自行更新后。我通过使用此博客文章中显示的选项卸载并重新安装客户端来修复它：

[http://www.thebitguru.com/blog/view/394-Random%20Slowdown%20of%20Browsers%20in%20OS%20X%20Mountain%20Lion](http://www.thebitguru.com/blog/view/394-Random%20Slowdown%20of%20Browsers%20in%20OS%20X%20Mountain%20Lion)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-04-09T05:56:02.873

我对 HTTPS 服务器的证书进行了更改，如上所述，我的存储库出现了缓存问题。

我将存储库重新定位在同一个 URL 中，错误消失了。（先备份）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-02-06T00:10:36.983

我通常不发帖，但我的团队花了 12 个工时来解决这个问题。

对我们来说，这也证明是与 Cisco AnyConnect 客户端的冲突

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-12-10T20:12:56.850

有同样的问题。对我来说，最后，结果证明（可能）与我的 apache 虚拟主机和服务器的 SSL 证书混淆有关（我整理了一些虚拟主机并将我的蛇油证书替换为一个真正的 - 我怀疑后者是我问题的真正原因）。

解决方案：对我有用的是清除客户端中所有保存的密码（我使用的是 Eclipse - subclipse 或 subversive，我忘了是哪个 - 还有 Tortoise）。我猜想某种基于 SSL 证书的散列被用于加密保存的密码，当我更换证书时，这使得它们无法访问或无效。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-08-02T17:45:43.727

我的问题是我的路径为 http://....并且我正在使用文件系统，那么我的 SVN 路径必须是 file://，我尝试重新定位并将其作为 file:// 和它运行良好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-11-12T12:41:15.120

这个问题也发生在我身上。原因最终是我们设置的透明 Web 代理 (Squid)。此处的防火墙配置为通过 Squid 静默重定向所有端口 80 流量。在防火墙配置中为 SVN 服务器的主机名添加一个例外修复了该问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-10-12T08:28:59.027

从 http 更改为 https 对我有用

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-11-16T17:18:36.787

查看代理配置设置...尝试取消选中它的使用

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-08-26T00:28:30.233

我有同样的问题（但我可能有不同的配置设置 - 虽然似乎是普通的香草）

下面的行显示了我的最后一个错误和我的“修复”。（感谢上述建议 - 约书亚）

```
[user1@hoho6 RubymineProjects]$ svn checkout svn://localhost/home/user1/DummySVNrepo
svn: URL 'svn://localhost/home/user1/DummySVNrepo' doesn't exist

[user1@hoho6 RubymineProjects]$ svn checkout svn+ssh://localhost/home/user1/DummySVNrepo

The authenticity of host 'localhost (::1)' can't be established.RSA key fingerprint is 10:8d:10:04:00:02:b1...
Are you sure you want to continue connecting (yes/no)? yes
user1@localhost's password: 
user1@localhost's password: 
A    DummySVNrepo/test
A    DummySVNrepo/test/unit
... etc 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-10-05T08:28:44.227

遇到了同样的问题。即使我尝试重新定位，也出现了相同的错误。

我的解决方案：我打开了回购浏览器。之后，更新和提交时错误消失了。不要问我为什么：）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-02-20T15:07:20.010

和这个线程中的任何人一样，同样的问题，不同的原因。

我不得不将 SVNPath 选项更改为 SVNParentPath 。原因是 SVNPath 只处理一个存储库，并将其作为浏览器请求的 url 的前缀。但是在我的设置中，我有一个目录，其中包含所有 svn 存储库，并且由 SVNParentPath 获取句柄。下面是我对 apache2 的位置指令。

```
<Location /svn/>
    DAV svn
    SVNParentPath /svn
    AUTHType Basic
    AUTHName "foo"
    AuthUserFile /path/to/passwd
    AuthzSVNAccessFile /path/to/authz-svn-access
    Require valid-user
</Location> 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2014-11-21T15:16:31.897

我发现[尼克厄本的评论](https://stackoverflow.com/questions/613149/svn-could-not-read-status-line-connection-was-closed-by-server#comment34764105_14225362)非常有用：

```
sudo /opt/cisco/anyconnect/bin/websecurity_uninstall.sh 
```

# sql-server - 如何将我们所有的图像从 SQL Server 2008 中的 VARBINARY(MAX) 字段转储到文件系统？

> ID：613154
> 
> 赞同：2
> 
> 时间：2009-03-05T00:35:14.887
> 
> 标签：sql-server, sql-server-2008, varbinary

我有一个表，其中有一个`IDENTITY`字段和一个`VARBINARY(MAX)`字段。有什么办法可以将每个`VARBINARY(MAX)`字段的内容转储到*文件系统*（例如`c:\temp\images`）？

### 表架构：

```
PhotoId INTEGER NOT NULL IDENTITY
Image VARBINARY(MAX) NOT NULL
DateCreated SMALLDATETIME 
```

### 输出：

```
c:\temp\images\1.png
c:\temp\images\2.png
c:\temp\images\3.png
... etc... 
```

解决这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-20T05:12:45.593

[多亏了这篇文章](http://madhuottapalam.blogspot.com/2008/08/creating-files-from-images-stored-in.html)，我已经弄清楚了...

```
SET NOCOUNT ON

DECLARE @IdThumbnail INTEGER,
        @MimeType VARCHAR(100),
        @FileName VARCHAR(200),
        @Sqlstmt varchar(4000)

DECLARE Cursor_Image CURSOR FOR
    SELECT a.IdThumbnail
    FROM tblThumbnail a
    ORDER BY a.IdThumbnail

OPEN Cursor_Image
    FETCH NEXT FROM Cursor_Image INTO @IdThumbnail

    WHILE @@FETCH_STATUS = 0
    BEGIN

        -- Generate the file name based upon the ID and the MIMETYPE.
        SELECT @FileName = LTRIM(STR(@IdThumbnail)) + '.png'

        -- Framing DynamicSQL for XP_CMDshell            
        SET @Sqlstmt='BCP "SELECT OriginalImage 
                      FROM Appian.dbo.tblThumbnail 
                      WHERE IdThumbnail = ' + LTRIM(STR(@IdThumbnail)) +
                      '" QUERYOUT c:\Temp\Images\' + LTRIM(@FileName) + 
                      ' -T -fC:\Temp\ImageFormatFile.txt'
        print @FileName
        print @sqlstmt

        EXEC xp_cmdshell @sqlstmt
        FETCH NEXT FROM Cursor_Image INTO @IdThumbnail
    END

CLOSE Cursor_Image
DEALLOCATE Cursor_Image 
```

请注意 -> 对于 BCP 命令，您需要有一个格式文件。这是文件的内容，我将它放在 c:\Temp 中（如上面的 BCP 命令行中所述）。

```
10.0
1
1       SQLIMAGE            0       0       ""   1     OriginalImage                      "" 
```

关于该格式文件的最后说明.. 在最后一行之后必须有一个新行。否则你会得到一个错误。

享受！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T00:46:49.150

最简单的（对我来说）是编写一个将 varbinary 字段转储到文件的小 .NET 应用程序。

如果您反对在 .NET 中工作，那么您应该（我没有对此进行测试）能够创建一个类型为“VARBINARY(MAX) FILESTREAM”的新列。确保您也有相应的“ROWGUIDCOL”列。然后你可以（理论上）做类似的事情：

更新表 SET varfilestream_col = varbinary_col

希望对你有用。

# wpf - 以编程方式为 DataGrid 创建 WPF DataGridTemplateColumn

> ID：613158
> 
> 赞同：2
> 
> 时间：2009-03-05T00:37:29.953
> 
> 标签：wpf, vb.net, .net-3.5, datagrid

我希望能够基于我的数据源以编程方式创建 DataGridTemplateColumns。例如，如果我的源在特定列中有日期，我希望能够使用 Datepicker 控件。我知道这很容易在设计时使用 xaml 和 DataGridTemplateColumn 完成，但是，我将如何在运行时完成此操作？

是我最好的选择 xamlreader.load 还是更传统的路线，例如：

`Dim TempCol As Microsoft.Windows.Controls.DataGridTemplateColumn`

后者我没有取得任何成功。

谢谢。

-保罗

编辑：这是我尝试使用的代码：

```
 Dim TempCol As New Microsoft.Windows.Controls.DataGridTemplateColumn

    TempCol.CellEditingTemplate = DataTemplate.Equals(DatePicker) 
```

我收到 DatePicker 是一种类型，不能用作表达式。

我基于 WPF Toolkit 演示。 [http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-datagrid-feature-walkthrough.aspx](http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-datagrid-feature-walkthrough.aspx)

```
<dg:DataGridTemplateColumn Header="Date" MinWidth="100">
    <dg:DataGridTemplateColumn.CellEditingTemplate>
        <DataTemplate>
            <dg:DatePicker SelectedDate="{Binding Date}" SelectedDateFormat="Short" />
        </DataTemplate>
    </dg:DataGridTemplateColumn.CellEditingTemplate>
    <dg:DataGridTemplateColumn.CellTemplate>
        <DataTemplate>
            <TextBlock Text="{Binding Date, StringFormat=d}" />
        </DataTemplate>
    </dg:DataGridTemplateColumn.CellTemplate>
</dg:DataGridTemplateColumn> 
```

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T18:46:35.840

您的代码不起作用的原因是您将`CellEditingTemplate`列的值设置为 a `bool`（调用的结果`DataTemplate.Equals()`，而不是在代码中创建模板的实例。

您可以使用类似这样的代码在代码中创建模板（相当于您提供的 XAML 代码片段）：

```
DataGridTemplateColumn col = new DataGridTemplateColumn();
col.Header = "Date";

// Create a factory. This will create the controls in each cell of this
// column as needed.
FrameworkElementFactory factory =
    new FrameworkElementFactory(typeof(DatePicker));

// Bind the value of this cell to the value of the Date property of the
// DataContext of this row. The StringFormat "d" will be used to display
// the value.
Binding b = new Binding("Date");
b.StringFormat = "d";
factory.SetValue(DatePicker.SelectedDateProperty, b);

// Create the template itself, and add the factory to it.
DataTemplate cellEditingTemplate = new DataTemplate();
cellEditingTemplate.VisualTree = factory;

col.CellEditingTemplate = cellEditingTemplate; 
```

我不确定这种方法是否比自己加载 XAML 更好。也许尝试两种方法，看看哪一种最适合您，并且效果更快？

# delphi - 在 Delphi 中枚举系统 Com 端口列表

> ID：613166
> 
> 赞同：1
> 
> 时间：2009-03-05T00:41:59.177
> 
> 标签：delphi, winapi, registry, serial-port

**目标：**我希望能够在 Delphi 中列出系统上可用的 COM 端口。

**作业：** 我已经阅读[了这个](https://stackoverflow.com/questions/374200/finding-available-lpt-parallel-ports-and-addresses-in-delphi)关于使用注册表枚举系统的 LPT 端口的 SO 线程。我还发现 COM 端口列在注册表中，但在[同一线程](http://forums.devshed.com/delphi-programming-90/list-of-com-ports-on-machine-510990.html)`HKEY_LOCAL_MACHINE\HARDWARE\DEVICEMAP\SERIALCOMM`中发现未回答的手势，这在不同的机器和不同版本的 Windows 上可能不可靠。

我还找到了引用使用 QueryDosDevice() 的文章，但在尝试[此示例代码](http://delphi.about.com/cs/adptips2001/a/bltip0501_2.htm)时，我发现它似乎根本没有列出任何 COM 端口。

**问题：**列出 Windows 机器上的 COM 端口最可靠的方法是什么（跨越未知的 Windows 版本）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T01:14:28.583

[DEVICEMAP\SERIALCOMM](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/regentry/44.mspx?mfr=true)适用于所有 NT 版本。您可能需要在 DYN_DATA 下查看 Win9x。

如果您需要运行时可靠性，请使用[此方法。](http://www.codeproject.com/KB/system/serial_portsenum_fifo.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T12:18:48.003

请通过用 C++ 编写的 URL

[http://www.codeproject.com/KB/system/serial_portsenum_fifo.aspx](http://www.codeproject.com/KB/system/serial_portsenum_fifo.aspx)

同样的方法也可以在delphi中实现..或者有人可以在SO中为你转换..

这适用于所有 Windows 版本，因为这适用于适用于所有 Windows 版本的设备管理器的原理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T11:50:08.150

这是 LINUX 的代码，而不是 WINDOWS 的代码......

```
function GetSerialPortNames: string;
var
  Index: Integer;
  Data: string;
  TmpPorts: String;
  sr : TSearchRec;
begin
  try
    TmpPorts := '';
    if FindFirst('/dev/ttyS*', $FFFFFFFF, sr) = 0 then
    begin
      repeat
        if (sr.Attr and $FFFFFFFF) = Sr.Attr then
        begin
          data := sr.Name;
          index := length(data);
          while (index > 1) and (data[index] <> '/') do
            index := index - 1;
          TmpPorts := TmpPorts + ' ' + copy(data, 1, index + 1);
        end;
      until FindNext(sr) <> 0;
    end;
    FindClose(sr);
  finally
    Result:=TmpPorts;
  end;
end; 
```

# html - 图片 alt 属性最佳实践

> ID：613173
> 
> 赞同：8
> 
> 时间：2009-03-05T00:44:53.523
> 
> 标签：html, accessibility

标签上`alt`属性的预期用途到底是什么？`<img>`

它应该描述图像，还是应该为屏幕阅读器（以及关闭图像的人）提供有意义的替换文本？

例如，如果我的网站上有一个人的简短传记，并附上一张他们的小照片，那么让视障用户向他们朗读“John Smith 的照片”真的有意义吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-05T00:51:18.593

HTML 5 规范对此有[很大](http://www.whatwg.org/specs/web-apps/current-work/multipage/embedded-content-0.html#the-img-element)的影响。

基本上，`alt`如果您根本没有使用图像，该属性应该是文本。如果您的图像纯粹是装饰性的，则可以使用`alt=""`. 描述在`title`属性中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T00:51:14.693

我认为这个想法是使用替代文本来传达与图像相同的信息。这取决于图像是什么。

导航元素的功能（“下一页”、“返回”）可能比它们的外观（“右箭头”）更好地描述。

约翰史密斯的照片可能会被替换为约翰史密斯的描述，或对正在发生的事件的描述等。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T00:50:17.050

来自[w3.org](http://www.w3.org/TR/html401/struct/objects.html#adef-alt)：

虽然替代文本可能非常有用，但必须小心处理。作者应遵守以下准则：

*   在包含用于格式化页面的图像时，不要指定不相关的替代文本，例如，alt="red ball" 不适用于添加红球来装饰标题或段落的图像。在这种情况下，替代文本应该是空字符串 ("")。在任何情况下都建议作者避免使用图像来格式化页面；应该改用样式表。
*   不要指定无意义的替代文本（例如，“虚拟文本”）。这不仅会使用户感到沮丧，还会减慢必须将文本转换为语音或盲文输出的用户代理。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T00:47:05.593

如果由于某种原因无法加载图像，它会提供“替代”文本。在您的示例中，我会说是的，这将是合适的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T00:52:39.540

“alt”属性是图像语义的替代（文本）表示。这不仅用于无法加载的图像：它还用于屏幕阅读器或纯文本浏览器。

在您的特定情况下，包括替代文本类型取决于您是否认为注意页面是否包含该人的图片很重要。如果它是一个纯粹的视觉项目，您可能不需要任何替代文本。如果它也被用作某种链接，您可能*确实*需要一些替代文本，以便使用屏幕阅读器的人对链接后的操作有一些线索。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T00:49:03.137

谷歌上的第一次点击 [img alt 可访问性] 给出了*考虑页面在未显示图像时的外观或声音。然后，为每个图像写一个最适合替换的*替代文本（[img 元素中的替代文本指南](http://www.cs.tut.fi/~jkorpela/html/alt.html)）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T00:47:10.927

如果图像没有显示，它应该是对用户有帮助的任何东西。

顺便说一句，当您将鼠标悬停在 IE 中的图像上并且工具提示显示 ALT 不是 ALT 的正确行为时的“功能”。标题应该用于此。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T00:49:18.050

简洁地描述图像，就好像你在和一个盲人说话一样。很简单。

我确定 Google 使用此属性值来索引图像搜索。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-05T13:21:05.327

> 如果我的网站上有一个人的简短传记，并附上一张他们的小照片，那么让视障用户向他们朗读“约翰·史密斯的照片”真的有意义吗？

如果你没有那个替代文字，你认为他们会假设图像是什么？“约翰史密斯和他妻子的照片”？“约翰史密斯接受奥斯卡奖的照片”？“约翰史密斯刺杀肯尼迪的照片”？“约翰史密斯被他的宠物大象谋杀后死在露台上的照片”？

如果是约翰史密斯的照片，是的，说出来。如果是别的，就这么说吧。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-10-08T15:40:47.347

**Alt**属性与**img**标签一起使用。

Alt 表示**备用**

它用于**图像的简短描述。**

**如果浏览器无法加载图像**，它会显示在屏幕上

 **[点击了解更多](http://webdesigningbydkc.blogspot.in/2015/10/image-tag.html)

# java - 带有 Mac OS X 10.4 的 Mac PowerPC 上的 Java 6

> ID：613175
> 
> 赞同：9
> 
> 时间：2009-03-05T00:46:24.500
> 
> 标签：java, macos

是否可以在装有 Mac OS X 10.4 的 Mac PowerPC 上运行 Java 6？AFAIK [SoyLatte](http://landonf.bikemonkey.org/static/soylatte/)仅适用于英特尔处理器。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-01-21T09:09:18.700

截至 2009 年 12 月，用于 OS X 10.5 PPC 的 OpenJDK 7 测试版可在[http://landonf.bikemonkey.org/static/soylatte/](http://landonf.bikemonkey.org/static/soylatte/)获得——还没有尝试过，它不是你想要的，但是这是迄今为止我第一次在任何 PPC OS X 版本上看到 Java >=6！更多详情，请访问[http://landonf.bikemonkey.org/2009/12/index.html](http://landonf.bikemonkey.org/2009/12/index.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T00:51:33.693

昨天有人推荐 SoyLatte 用于 PPC（[在 Mac OS 上安装 Java 6](https://stackoverflow.com/questions/607945/installing-java-6-on-mac-os/607966#607966)），事实上这些说明似乎支持他的理论（阅读有人声称它适用于他的 PPC 的评论）：[http ://blog.adsdevshop.com/2008 /02/26/安装-the-jdk-16-on-mac-os-x/](http://blog.adsdevshop.com/2008/02/26/installing-the-jdk-16-on-mac-os-x/)

YMMV :-) 或者尝试从源代码构建。再次，YMMV :-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T01:57:53.847

请注意，除了不能在 PPC 上运行之外，Apple 的 Java6[也不能在 32 位 Intel](http://support.apple.com/kb/HT1856)上运行。并且对于新的 Java6 还有其他一些限制，导致了这样的[意见](http://java.dzone.com/news/java-6-mac-worsest-release-eve)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-05-20T11:15:59.710

是的，来自 10.4 开发者预览版的 PPC 有 1.6 版本。

[http://images.spelpunt.nl/javase6release1dp6.dmg](http://images.spelpunt.nl/javase6release1dp6.dmg)

您不能通过安装程序安装它，而是转到 /Volumes/Java\ SE\ 6\ Release\ 1/JavaSE6Release1.pkg/ 并将 Archive.pax.gz 复制到您的桌面；gzip -d Archive.pax.gz 然后 pax 或双击 Archive.pax。

现在有包装内容。在 /Your Desktop/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Home/bin 下，您可以找到 PPC 1.6 JDK ;-) 测试版，但可以找到工作的 1.6 JDK。

将 1.6.0 复制到 /System/Library/Frameworks/JavaVM.framework/Version .. 运行 /System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Home/bin/java

就是这样 ...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-01T05:40:12.133

有一个可以在 ppc Tiger 上运行和运行：

1.  获取 .dmg 并安装它
2.  苏根; cd /System/Library/Frameworks/JavaVM.framework/Versions；ls
3.  确保你看到 '1.6 -> 1.6.0' CurrentJDK -> 1.5
4.  rm CurrentJDK（删除符号链接，而不是 jdk）
5.  ln -s 1.6 当前JDK
6.  java版本

java 版本“1.6.0-dp”Java(TM) SE 运行时环境（构建 1.6.0-dp-b88-34）Java HotSpot(TM) 核心 VM（构建 1.6.0-b88-17-release，解释模式，分享）

不知道从哪里下载的包。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T08:41:45.687

我见过的唯一适用于 PowerPC 的 Java 6 是适用于 Linux 的：

[http://www.ibm.com/developerworks/java/jdk/linux/download.html](http://www.ibm.com/developerworks/java/jdk/linux/download.html)

恐怕您将不得不在 PowerPC 上的 Mac OS X 上继续使用 Java 5。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-10-26T04:13:45.517

如果有人仍在寻找答案，我有解决方案，我从 Mac Insights 中获取：

Tiger、PowerPC 或 Intel 上的 Java 1.6

安装程序：[https ://hell.meiert.org/core/dmg/java-6-dp.dmg](https://hell.meiert.org/core/dmg/java-6-dp.dmg)

如果您在完全更新的 Tiger 系统上运行安装程序，它会通知您“此卷包含较新版本的 Java”。因此，首先将它正在检查的文件移到一边。

**sudo mv /System/Library/Frameworks/JavaVM.framework/Resources/Info-macos.plist{,.old} sudo mv /System/Library/Frameworks/JavaVM.framework/Resources/version.plist{,.old}**

运行安装程序后，在 /Applications/Utilities/Java/Java SE 6 中打开新的“Java Preferences”。将“Use version”设置为“Java SE 6”并重新排序“Java Application Runtime Settings”中的列表，以便“Java SE 6”是第一个。单击“保存”并退出后，通过运行 java -version 确认 Java 6 处于活动状态。

完毕。

来源：[https ://ericfromcanada.github.io/output/2018/java-6-tiger-leopard.html](https://ericfromcanada.github.io/output/2018/java-6-tiger-leopard.html)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2011-10-12T11:05:34.353

令我惊讶的是，我在 10.4.6 中有 Java 1.5，只需按照链接中给出的步骤将其设为默认 JRE：[Java 1.5 in 10.4.6](http://techmindviews.blogspot.com/2011/10/changing-java-version-mac-1046.html)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2012-01-11T19:43:24.547

这是 java 10.6 的可下载 dmg

[http://www.macupdate.com/app/mac/33087/apple-java-for-mac-os-x-10.6](http://www.macupdate.com/app/mac/33087/apple-java-for-mac-os-x-10.6)

# python - 如何按值对字典进行排序？

> ID：613183
> 
> 赞同：3417
> 
> 时间：2009-03-05T00:49:05.383
> 
> 标签：python, sorting, dictionary

我有一个从数据库中的两个字段读取的值字典：一个字符串字段和一个数字字段。字符串字段是唯一的，因此它是字典的键。

我可以对键进行排序，但是如何根据值进行排序？

注意：我在这里阅读了堆栈溢出问题*[如何按字典的值对字典列表进行排序？](https://stackoverflow.com/questions/72899)*并且可能可以将我的代码更改为具有字典列表，但是由于我真的不需要字典列表，因此我想知道是否有更简单的解决方案可以按升序或降序排序。

* * *

## 回答 #1

> 赞同：6238
> 
> 时间：2009-03-05T00:59:34.143

### Python 3.7+ 或 CPython 3.6

字典在 Python 3.7+ 中保留插入顺序。在 CPython 3.6 中相同，但[它是一个实现细节](https://stackoverflow.com/q/39980323/4518341)。

```
>>> x = {1: 2, 3: 4, 4: 3, 2: 1, 0: 0}
>>> {k: v for k, v in sorted(x.items(), key=lambda item: item[1])}
{0: 0, 2: 1, 1: 2, 4: 3, 3: 4} 
```

或者

```
>>> dict(sorted(x.items(), key=lambda item: item[1]))
{0: 0, 2: 1, 1: 2, 4: 3, 3: 4} 
```

### 较旧的 Python

无法对字典进行排序，只能获得已排序字典的表示。字典本质上是无序的，但其他类型，例如列表和元组，则不是。所以你需要一个有序的数据类型来表示排序后的值，这将是一个列表——可能是一个元组列表。

例如，

```
import operator
x = {1: 2, 3: 4, 4: 3, 2: 1, 0: 0}
sorted_x = sorted(x.items(), key=operator.itemgetter(1)) 
```

`sorted_x`将是按每个元组中的第二个元素排序的元组列表。`dict(sorted_x) == x`.

对于那些希望对键而不是值进行排序的人：

```
import operator
x = {1: 2, 3: 4, 4: 3, 2: 1, 0: 0}
sorted_x = sorted(x.items(), key=operator.itemgetter(0)) 
```

在 Python3 中，由于[不允许解包，](https://stackoverflow.com/a/15712231/4293057)我们可以使用

```
x = {1: 2, 3: 4, 4: 3, 2: 1, 0: 0}
sorted_x = sorted(x.items(), key=lambda kv: kv[1]) 
```

如果要将输出作为字典，可以使用[`collections.OrderedDict`](https://docs.python.org/3/library/collections.html#collections.OrderedDict)：

```
import collections

sorted_dict = collections.OrderedDict(sorted_x) 
```

* * *

## 回答 #2

> 赞同：1507
> 
> 时间：2010-07-05T08:01:16.697

## 很简单：`sorted(dict1, key=dict1.get)`

好吧，实际上可以进行“按字典值排序”。最近我不得不在 Code Golf 中这样做（堆栈溢出问题*[Code golf：词频图表](https://stackoverflow.com/questions/3169051/code-golf-word-frequency-chart#3170549)*）。简而言之，问题是这样的：给定一个文本，计算每个单词出现的频率，并显示一个排名靠前的单词列表，按频率递减排序。

如果你构建一个以单词为键，每个单词出现的次数为值的字典，这里简化为：

```
from collections import defaultdict
d = defaultdict(int)
for w in text.split():
    d[w] += 1 
```

然后你可以得到一个单词列表，按使用频率[`sorted(d, key=d.get)`](https://docs.python.org/library/functions.html#sorted)排序 - 排序迭代字典键，使用单词出现的次数作为排序键。

```
for w in sorted(d, key=d.get, reverse=True):
    print(w, d[w]) 
```

我正在写这个详细的解释来说明人们通常所说的“我可以轻松地按键排序字典，但我如何按值排序” - 我认为原始帖子试图解决这样一个问题。解决方案是根据值对键列表进行排序，如上所示。

* * *

## 回答 #3

> 赞同：1051
> 
> 时间：2010-02-13T16:33:51.107

你可以使用：

```
sorted(d.items(), key=lambda x: x[1]) 
```

这将按照字典中每个条目的值从最小到最大对字典进行排序。

要按降序对其进行排序，只需添加`reverse=True`：

```
sorted(d.items(), key=lambda x: x[1], reverse=True) 
```

**输入：**

```
d = {'one':1,'three':3,'five':5,'two':2,'four':4}
a = sorted(d.items(), key=lambda x: x[1])    
print(a) 
```

**输出：**

```
[('one', 1), ('two', 2), ('three', 3), ('four', 4), ('five', 5)] 
```

* * *

## 回答 #4

> 赞同：260
> 
> 时间：2009-03-05T01:05:22.473

无法对字典进行排序，但您可以从中构建排序列表。

dict 值的排序列表：

```
sorted(d.values()) 
```

（键，值）对的列表，按值排序：

```
from operator import itemgetter
sorted(d.items(), key=itemgetter(1)) 
```

* * *

## 回答 #5

> 赞同：178
> 
> 时间：2010-07-05T02:50:41.450

在最近的 Python 2.7 中，我们有了新的[OrderedDict](http://docs.python.org/dev/whatsnew/2.7.html#pep-372-adding-an-ordered-dictionary-to-collections)类型，它会记住添加项目的顺序。

```
>>> d = {"third": 3, "first": 1, "fourth": 4, "second": 2}

>>> for k, v in d.items():
...     print "%s: %s" % (k, v)
...
second: 2
fourth: 4
third: 3
first: 1

>>> d
{'second': 2, 'fourth': 4, 'third': 3, 'first': 1} 
```

要从原始字典创建一个新的有序字典，按值排序：

```
>>> from collections import OrderedDict
>>> d_sorted_by_value = OrderedDict(sorted(d.items(), key=lambda x: x[1])) 
```

OrderedDict 的行为类似于普通的 dict：

```
>>> for k, v in d_sorted_by_value.items():
...     print "%s: %s" % (k, v)
...
first: 1
second: 2
third: 3
fourth: 4

>>> d_sorted_by_value
OrderedDict([('first': 1), ('second': 2), ('third': 3), ('fourth': 4)]) 
```

* * *

## 回答 #6

> 赞同：118
> 
> 时间：2015-12-05T09:46:06.350

**更新：2015 年 12 月 5 日使用 Python 3.5**

虽然我发现接受的答案很有用，但令我感到惊讶的是，它没有更新为从标准库**集合模块中引用****[OrderedDict](https://docs.python.org/3/library/collections.html#collections.OrderedDict)**作为一种可行的现代替代方案——旨在解决这类问题。

 **```
from operator import itemgetter
from collections import OrderedDict

x = {1: 2, 3: 4, 4: 3, 2: 1, 0: 0}
sorted_x = OrderedDict(sorted(x.items(), key=itemgetter(1)))
# OrderedDict([(0, 0), (2, 1), (1, 2), (4, 3), (3, 4)]) 
```

官方**[OrderedDict](https://docs.python.org/3/library/collections.html#collections.OrderedDict)**文档也提供了一个非常相似的示例，但使用 lambda 作为排序函数：

```
# regular unsorted dictionary
d = {'banana': 3, 'apple':4, 'pear': 1, 'orange': 2}

# dictionary sorted by value
OrderedDict(sorted(d.items(), key=lambda t: t[1]))
# OrderedDict([('pear', 1), ('orange', 2), ('banana', 3), ('apple', 4)]) 
```

* * *

## 回答 #7

> 赞同：108
> 
> 时间：2009-03-05T01:06:04.377

[与汉克盖伊的回答](https://stackoverflow.com/a/613207/11044033)几乎相同：

```
sorted([(value,key) for (key,value) in mydict.items()]) 
```

或者按照 John Fouhy 的建议进行轻微优化：

```
sorted((value,key) for (key,value) in mydict.items()) 
```

* * *

## 回答 #8

> 赞同：84
> 
> 时间：2016-09-10T10:05:36.240

# 从[Python 3.6](https://docs.python.org/3.6/whatsnew/3.6.html)开始，内置 dict 将被排序

好消息，因此 OP 的原始用例将从数据库中检索到的映射对与唯一的字符串 id 作为键和数值作为值作为内置 Python v3.6+ dict 的映射，现在应该尊重插入顺序。

如果说从数据库查询中生成的两个列表表达式，例如：

```
SELECT a_key, a_value FROM a_table ORDER BY a_value; 
```

将存储在两个 Python 元组中，k_seq 和 v_seq（由数字索引对齐，当然长度相同），然后：

```
k_seq = ('foo', 'bar', 'baz')
v_seq = (0, 1, 42)
ordered_map = dict(zip(k_seq, v_seq)) 
```

允许稍后输出为：

```
for k, v in ordered_map.items():
    print(k, v) 
```

在这种情况下产生（对于新的 Python 3.6+ 内置字典！）：

```
foo 0
bar 1
baz 42 
```

每个 v 值的顺序相同。

在我的机器上安装 Python 3.5 时，它目前产生：

```
bar 1
foo 0
baz 42 
```

## 细节：

正如 Raymond Hettinger 在 2012 年提出的那样（参见关于 python-dev 的邮件，主题为[“更紧凑的字典和更快的迭代”](https://mail.python.org/pipermail/python-dev/2012-December/123028.html)），现在（2016 年）由 Victor Stinner 在给 python-dev 的邮件中宣布，主题为[“Python 3.6 dict become紧凑并获得私有版本；并且关键字变得有序”](https://mail.python.org/pipermail/python-dev/2016-September/146327.html)由于在 Python 3.6 中修复/实施问题 27350 [“紧凑和有序 dict”](http://bugs.python.org/issue27350)，我们现在可以使用内置 dict 来维护插入顺序！

希望这将导致作为第一步的薄层 OrderedDict 实现。正如@JimFasarakis-Hilliard 所指出的，有些人将来还会看到 OrderedDict 类型的用例。我认为整个 Python 社区都会仔细检查这是否经得起时间的考验，以及下一步将是什么。

是时候重新考虑我们的编码习惯，以免错过稳定排序带来的可能性：

*   关键字参数和
*   （中级）字典存储

第一个是因为它在某些情况下简化了函数和方法的实现中的分派。

第二个，因为它鼓励更容易地将`dict`s 用作处理管道中的中间存储。

Raymond Hettinger 友好地提供了解释“ [Python 3.6 字典背后的技术](https://dl.dropboxusercontent.com/u/3967849/sfmu2/_build/html/goal.html "Python 3.6 字典背后的技术")”的文档——来自他的旧金山 Python 聚会小组演示文稿 2016-DEC-08。

也许相当多的 Stack Overflow 高装饰问答页面会收到这些信息的变体，许多高质量的答案也需要每个版本更新。

### Caveat Emptor（但另见下文更新 2017-12-15）：

正如@ajcr 正确指出的那样：“这个新实现的顺序保留方面被认为是一个实现细节，不应依赖。” （来自[whatsnew36](https://docs.python.org/3.6/whatsnew/3.6.html)）不是挑剔，**但**引用被削减了一点悲观;-)。它继续为“（这可能会在未来发生变化，但在更改语言规范以强制所有当前和未来的 Python 实现保持顺序的语义之前，希望在几个版本中在语言中使用这个新的 dict 实现；这也是有助于保持与随机迭代顺序仍然有效的旧版本语言的向后兼容性，例如 Python 3.5）。”

因此，在某些人类语言（例如德语）中，用法塑造了语言，并且现在已经在[whatsnew36](https://docs.python.org/3.6/whatsnew/3.6.html)中宣布了遗嘱。

### 2017 年 12 月 15 日更新：

在[给 python-dev list 的邮件中](https://mail.python.org/pipermail/python-dev/2017-December/151283.html)，Guido van Rossum 宣称：

> 让它如此。“字典保持插入顺序”是裁决。谢谢！

因此，dict 插入排序的 3.6 版 CPython 副作用现在成为语言规范的一部分（不再只是实现细节）。`collections.OrderedDict`正如 Raymond Hettinger 在讨论中提醒的那样，该邮件线程还提出了一些不同的设计目标。

* * *

## 回答 #9

> 赞同：83
> 
> 时间：2011-08-30T00:30:15.053

**[使用namedtuple](http://docs.python.org/library/collections.html#collections.namedtuple)**通常非常方便。例如，你有一个字典，'name' 作为键，'score' 作为值，你想按'score' 排序：

```
import collections
Player = collections.namedtuple('Player', 'score name')
d = {'John':5, 'Alex':10, 'Richard': 7} 
```

首先以最低分排序：

```
worst = sorted(Player(v,k) for (k,v) in d.items()) 
```

首先以最高分排序：

```
best = sorted([Player(v,k) for (k,v) in d.items()], reverse=True) 
```

现在您可以像这样以 Python 方式获得第二好的玩家（索引=1）的名称和分数：

```
player = best[1]
player.name
    'Richard'
player.score
    7 
```

* * *

## 回答 #10

> 赞同：52
> 
> 时间：2010-11-18T14:19:57.443

我有同样的问题，我是这样解决的：

```
WantedOutput = sorted(MyDict, key=lambda x : MyDict[x]) 
```

（回答“It is not possible to sort a dict”的人没有读过这个问题！事实上，“我可以按键排序，但我如何根据值排序？”显然意味着他想要一个列表键根据其值的值排序。）

请注意，顺序没有明确定义（具有相同值的键将在输出列表中以任意顺序排列）。

* * *

## 回答 #11

> 赞同：49
> 
> 时间：2012-06-27T15:43:45.450

如果值是数字，您也可以使用[`Counter`](https://docs.python.org/library/collections.html#collections.Counter)from [collections](https://docs.python.org/library/collections.html)。

```
from collections import Counter

x = {'hello': 1, 'python': 5, 'world': 3}
c = Counter(x)
print(c.most_common())

>> [('python', 5), ('world', 3), ('hello', 1)] 
```

* * *

## 回答 #12

> 赞同：41
> 
> 时间：2013-08-22T08:38:48.327

在 Python 2.7 中，只需执行以下操作：

```
from collections import OrderedDict
# regular unsorted dictionary
d = {'banana': 3, 'apple':4, 'pear': 1, 'orange': 2}

# dictionary sorted by key
OrderedDict(sorted(d.items(), key=lambda t: t[0]))
OrderedDict([('apple', 4), ('banana', 3), ('orange', 2), ('pear', 1)])

# dictionary sorted by value
OrderedDict(sorted(d.items(), key=lambda t: t[1]))
OrderedDict([('pear', 1), ('orange', 2), ('banana', 3), ('apple', 4)]) 
```

复制粘贴来自：[http ://docs.python.org/dev/library/collections.html#ordereddict-examples-and-recipes](http://docs.python.org/dev/library/collections.html#ordereddict-examples-and-recipes)

享受 ;-）

* * *

## 回答 #13

> 赞同：31
> 
> 时间：2011-03-08T02:06:25.777

这是代码：

```
import operator
origin_list = [
    {"name": "foo", "rank": 0, "rofl": 20000},
    {"name": "Silly", "rank": 15, "rofl": 1000},
    {"name": "Baa", "rank": 300, "rofl": 20},
    {"name": "Zoo", "rank": 10, "rofl": 200},
    {"name": "Penguin", "rank": -1, "rofl": 10000}
]
print ">> Original >>"
for foo in origin_list:
    print foo

print "\n>> Rofl sort >>"
for foo in sorted(origin_list, key=operator.itemgetter("rofl")):
    print foo

print "\n>> Rank sort >>"
for foo in sorted(origin_list, key=operator.itemgetter("rank")):
    print foo 
```

结果如下：

**原来的**

```
{'name': 'foo', 'rank': 0, 'rofl': 20000}
{'name': 'Silly', 'rank': 15, 'rofl': 1000}
{'name': 'Baa', 'rank': 300, 'rofl': 20}
{'name': 'Zoo', 'rank': 10, 'rofl': 200}
{'name': 'Penguin', 'rank': -1, 'rofl': 10000} 
```

**罗弗**

```
{'name': 'Baa', 'rank': 300, 'rofl': 20}
{'name': 'Zoo', 'rank': 10, 'rofl': 200}
{'name': 'Silly', 'rank': 15, 'rofl': 1000}
{'name': 'Penguin', 'rank': -1, 'rofl': 10000}
{'name': 'foo', 'rank': 0, 'rofl': 20000} 
```

**秩**

```
{'name': 'Penguin', 'rank': -1, 'rofl': 10000}
{'name': 'foo', 'rank': 0, 'rofl': 20000}
{'name': 'Zoo', 'rank': 10, 'rofl': 200}
{'name': 'Silly', 'rank': 15, 'rofl': 1000}
{'name': 'Baa', 'rank': 300, 'rofl': 20} 
```

* * *

## 回答 #14

> 赞同：31
> 
> 时间：2014-04-07T04:46:44.087

尝试以下方法。让我们用以下数据定义一个名为 mydict 的字典：

```
mydict = {'carl':40,
          'alan':2,
          'bob':1,
          'danny':3} 
```

如果想按键对字典进行排序，可以执行以下操作：

```
for key in sorted(mydict.iterkeys()):
    print "%s: %s" % (key, mydict[key]) 
```

这应该返回以下输出：

```
alan: 2
bob: 1
carl: 40
danny: 3 
```

另一方面，如果想按值对字典进行排序（如问题中所问），可以执行以下操作：

```
for key, value in sorted(mydict.iteritems(), key=lambda (k,v): (v,k)):
    print "%s: %s" % (key, value) 
```

此命令的结果（按值对字典进行排序）应返回以下内容：

```
bob: 1
alan: 2
danny: 3
carl: 40 
```

* * *

## 回答 #15

> 赞同：30
> 
> 时间：2018-09-15T13:37:17.720

从 Python 3.6 开始，`dict`对象现在按插入顺序排序。它正式在 Python 3.7 的规范中。

```
>>> words = {"python": 2, "blah": 4, "alice": 3}
>>> dict(sorted(words.items(), key=lambda x: x[1]))
{'python': 2, 'alice': 3, 'blah': 4} 
```

在此之前，您必须使用`OrderedDict`.

[Python 3.7 文档](https://docs.python.org/3.7/library/stdtypes.html#typesmapping)说：

> 在 3.7 版更改: 字典顺序保证为插入顺序。这种行为是 CPython 3.6 的实现细节。

* * *

## 回答 #16

> 赞同：27
> 
> 时间：2009-03-05T01:52:18.960

您也可以创建“倒排索引”

```
from collections import defaultdict
inverse= defaultdict( list )
for k, v in originalDict.items():
    inverse[v].append( k ) 
```

现在你的逆有值；每个值都有一个适用键的列表。

```
for k in sorted(inverse):
    print k, inverse[k] 
```

* * *

## 回答 #17

> 赞同：25
> 
> 时间：2013-03-09T12:30:22.083

您可以使用[collections.Counter](http://docs.python.org/2/library/collections.html#collections.Counter)。请注意，这适用于数字和非数字值。

```
>>> x = {1: 2, 3: 4, 4:3, 2:1, 0:0}
>>> from collections import Counter
>>> #To sort in reverse order
>>> Counter(x).most_common()
[(3, 4), (4, 3), (1, 2), (2, 1), (0, 0)]
>>> #To sort in ascending order
>>> Counter(x).most_common()[::-1]
[(0, 0), (2, 1), (1, 2), (4, 3), (3, 4)]
>>> #To get a dictionary sorted by values
>>> from collections import OrderedDict
>>> OrderedDict(Counter(x).most_common()[::-1])
OrderedDict([(0, 0), (2, 1), (1, 2), (4, 3), (3, 4)]) 
```

* * *

## 回答 #18

> 赞同：20
> 
> 时间：2014-09-25T22:56:55.200

您可以使用[skip dict](https://pypi.python.org/pypi/skipdict/1.0)，它是一个按值永久排序的字典。

```
>>> data = {1: 2, 3: 4, 4: 3, 2: 1, 0: 0}
>>> SkipDict(data)
{0: 0.0, 2: 1.0, 1: 2.0, 4: 3.0, 3: 4.0} 
```

如果您使用`keys()`,`values()`或者`items()`您将按值按排序顺序进行迭代。

它是使用[跳过列表](http://en.wikipedia.org/wiki/Skip_list)数据结构实现的。

* * *

## 回答 #19

> 赞同：19
> 
> 时间：2017-05-25T18:13:11.387

您还可以使用可以传递给 key 的自定义函数。

```
def dict_val(x):
    return x[1]
x = {1: 2, 3: 4, 4: 3, 2: 1, 0: 0}
sorted_x = sorted(x.items(), key=dict_val) 
```

* * *

## 回答 #20

> 赞同：16
> 
> 时间：2010-11-01T12:16:41.697

```
from django.utils.datastructures import SortedDict

def sortedDictByKey(self,data):
    """Sorted dictionary order by key"""
    sortedDict = SortedDict()
    if data:
        if isinstance(data, dict):
            sortedKey = sorted(data.keys())
            for k in sortedKey:
                sortedDict[k] = data[k]
    return sortedDict 
```

* * *

## 回答 #21

> 赞同：16
> 
> 时间：2015-07-31T08:08:49.640

当然，请记住，您需要使用`OrderedDict`，因为常规 Python 字典不会保持原始顺序。

```
from collections import OrderedDict
a = OrderedDict(sorted(originalDict.items(), key=lambda x: x[1])) 
```

* * *

如果您没有 Python 2.7 或更高版本，那么您能做的最好的事情就是迭代生成器函数中的值。（这里有[2.4](https://pypi.python.org/pypi/ordereddict)`OrderedDict`和 2.6 的，但是

a) 我不知道它的效果如何

和

b）您当然必须下载并安装它。如果您没有管理权限，那么恐怕该选项已失效。）

* * *

```
def gen(originalDict):
    for x, y in sorted(zip(originalDict.keys(), originalDict.values()), key=lambda z: z[1]):
        yield (x, y)
    #Yields as a tuple with (key, value). You can iterate with conditional clauses to get what you want. 

for bleh, meh in gen(myDict):
    if bleh == "foo":
        print(myDict[bleh]) 
```

* * *

您还可以打印出每个值

```
for bleh, meh in gen(myDict):
    print(bleh, meh) 
```

如果不使用 Python 3.0 或更高版本，请记住在打印后删除括号

* * *

## 回答 #22

> 赞同：14
> 
> 时间：2015-06-20T01:44:58.983

这是使用 zip[`d.values()`和`d.keys()`](https://docs.python.org/2/library/stdtypes.html#dictionary-view-objects). 此链接下的几行（在字典视图对象上）是：

> 这允许使用 zip() 创建（值，键）对：pairs = zip(d.values(), d.keys())。

所以我们可以做到以下几点：

```
d = {'key1': 874.7, 'key2': 5, 'key3': 8.1}

d_sorted = sorted(zip(d.values(), d.keys()))

print d_sorted 
# prints: [(5, 'key2'), (8.1, 'key3'), (874.7, 'key1')] 
```

* * *

## 回答 #23

> 赞同：14
> 
> 时间：2018-03-02T16:48:07.737

[正如 Dilettant 所指出的](https://stackoverflow.com/a/39424969/1150683)，Python 3.6 现在*将保持秩序*！我想我会分享一个我编写的函数，它可以简化可迭代（元组、列表、字典）的排序。在后一种情况下，您可以按键或值进行排序，并且可以考虑数字比较。**仅适用于 >= 3.6！**

当您尝试在包含字符串和整数的可迭代对象上使用 sorted 时，sorted() 将失败。当然，您可以强制使用 str() 进行字符串比较。但是，在某些情况下，您希望在小于的地方进行*实际*的数字比较（字符串比较中不是这种情况）。所以我想出了以下内容。当您想要显式数字比较时，您可以使用该标志，该标志将通过尝试将所有值转换为浮点数来尝试进行显式数字排序。如果成功，它将进行数字排序，否则它将诉诸字符串比较。`12``20``num_as_num`

欢迎提出改进意见。

```
def sort_iterable(iterable, sort_on=None, reverse=False, num_as_num=False):
    def _sort(i):
      # sort by 0 = keys, 1 values, None for lists and tuples
      try:
        if num_as_num:
          if i is None:
            _sorted = sorted(iterable, key=lambda v: float(v), reverse=reverse)
          else:
            _sorted = dict(sorted(iterable.items(), key=lambda v: float(v[i]), reverse=reverse))
        else:
          raise TypeError
      except (TypeError, ValueError):
        if i is None:
          _sorted = sorted(iterable, key=lambda v: str(v), reverse=reverse)
        else:
          _sorted = dict(sorted(iterable.items(), key=lambda v: str(v[i]), reverse=reverse))

      return _sorted

    if isinstance(iterable, list):
      sorted_list = _sort(None)
      return sorted_list
    elif isinstance(iterable, tuple):
      sorted_list = tuple(_sort(None))
      return sorted_list
    elif isinstance(iterable, dict):
      if sort_on == 'keys':
        sorted_dict = _sort(0)
        return sorted_dict
      elif sort_on == 'values':
        sorted_dict = _sort(1)
        return sorted_dict
      elif sort_on is not None:
        raise ValueError(f"Unexpected value {sort_on} for sort_on. When sorting a dict, use key or values")
    else:
      raise TypeError(f"Unexpected type {type(iterable)} for iterable. Expected a list, tuple, or dict") 
```

* * *

## 回答 #24

> 赞同：12
> 
> 时间：2014-03-03T14:58:30.070

另一个答案中提到的集合解决方案绝对是一流的，因为您保留了键和值之间的联系，这在字典的情况下非常重要。

我不同意另一个答案中提出的第一选择，因为它扔掉了钥匙。

我使用了上面提到的解决方案（代码如下所示）并保留了对键和值的访问权，在我的情况下，排序是在值上，但重要的是在对值进行排序后对键进行排序。

```
from collections import Counter

x = {'hello':1, 'python':5, 'world':3}
c=Counter(x)
print( c.most_common() )

>> [('python', 5), ('world', 3), ('hello', 1)] 
```

* * *

## 回答 #25

> 赞同：10
> 
> 时间：2011-10-19T06:25:41.393

使用**dicts**中的[ValueSortedDict](http://pypi.python.org/pypi/dicts)：

```
from dicts.sorteddict import ValueSortedDict
d = {1: 2, 3: 4, 4:3, 2:1, 0:0}
sorted_dict = ValueSortedDict(d)
print sorted_dict.items() 

[(0, 0), (2, 1), (1, 2), (4, 3), (3, 4)] 
```

* * *

## 回答 #26

> 赞同：10
> 
> 时间：2018-05-27T17:45:24.013

刚刚从[Python for Everyone](https://www.coursera.org/learn/python-data/lecture/0ou0N/10-tuples)学习了相关技能。

您可以使用临时列表来帮助您对字典进行排序：

```
#Assume dictionary to be:
d = {'apple': 500.1, 'banana': 1500.2, 'orange': 1.0, 'pineapple': 789.0}

# create a temporary list
tmp = []

# iterate through the dictionary and append each tuple into the temporary list 
for key, value in d.items():
    tmptuple = (value, key)
    tmp.append(tmptuple)

# sort the list in ascending order
tmp = sorted(tmp)

print (tmp) 
```

如果要按降序对列表进行排序，只需将原始排序行更改为：

```
tmp = sorted(tmp, reverse=True) 
```

使用列表理解，一个衬里将是：

```
#Assuming the dictionary looks like
d = {'apple': 500.1, 'banana': 1500.2, 'orange': 1.0, 'pineapple': 789.0}
#One liner for sorting in ascending order
print (sorted([(v, k) for k, v in d.items()]))
#One liner for sorting in descending order
print (sorted([(v, k) for k, v in d.items()], reverse=True)) 
```

样本输出：

```
#Asending order
[(1.0, 'orange'), (500.1, 'apple'), (789.0, 'pineapple'), (1500.2, 'banana')]
#Descending order
[(1500.2, 'banana'), (789.0, 'pineapple'), (500.1, 'apple'), (1.0, 'orange')] 
```

* * *

## 回答 #27

> 赞同：9
> 
> 时间：2011-10-30T19:42:06.947

遍历 dict 并按其值降序排序：

```
$ python --version
Python 3.2.2

$ cat sort_dict_by_val_desc.py 
dictionary = dict(siis = 1, sana = 2, joka = 3, tuli = 4, aina = 5)
for word in sorted(dictionary, key=dictionary.get, reverse=True):
  print(word, dictionary[word])

$ python sort_dict_by_val_desc.py 
aina 5
tuli 4
joka 3
sana 2
siis 1 
```

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2012-01-24T19:28:36.253

如果您的值是整数，并且您使用 Python 2.7 或更高版本，则可以[`collections.Counter`](http://docs.python.org/py3k/library/collections.html#collections.Counter)使用`dict`. 该`most_common`方法将为您提供按值排序的所有项目。

* * *

## 回答 #29

> 赞同：8
> 
> 时间：2011-11-16T07:32:01.920

这适用于 3.1.x：

```
import operator
slovar_sorted=sorted(slovar.items(), key=operator.itemgetter(1), reverse=True)
print(slovar_sorted) 
```

* * *

## 回答 #30

> 赞同：8
> 
> 时间：2013-03-23T14:19:53.313

为了完整起见，我发布了一个使用[heapq](http://docs.python.org/2/library/heapq.html)的解决方案。请注意，此方法适用于数值和非数值

```
>>> x = {1: 2, 3: 4, 4:3, 2:1, 0:0}
>>> x_items = x.items()
>>> heapq.heapify(x_items)
>>> #To sort in reverse order
>>> heapq.nlargest(len(x_items),x_items, operator.itemgetter(1))
[(3, 4), (4, 3), (1, 2), (2, 1), (0, 0)]
>>> #To sort in ascending order
>>> heapq.nsmallest(len(x_items),x_items, operator.itemgetter(1))
[(0, 0), (2, 1), (1, 2), (4, 3), (3, 4)] 
```

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2014-02-13T23:18:20.070

```
months = {"January": 31, "February": 28, "March": 31, "April": 30, "May": 31,
          "June": 30, "July": 31, "August": 31, "September": 30, "October": 31,
          "November": 30, "December": 31}

def mykey(t):
    """ Customize your sorting logic using this function.  The parameter to
    this function is a tuple.  Comment/uncomment the return statements to test
    different logics.
    """
    return t[1]              # sort by number of days in the month
    #return t[1], t[0]       # sort by number of days, then by month name
    #return len(t[0])        # sort by length of month name
    #return t[0][-1]         # sort by last character of month name

# Since a dictionary can't be sorted by value, what you can do is to convert
# it into a list of tuples with tuple length 2.
# You can then do custom sorts by passing your own function to sorted().
months_as_list = sorted(months.items(), key=mykey, reverse=False)

for month in months_as_list:
    print month 
```

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2019-02-26T04:12:26.853

除了使用内置模块等之外，我尝试手动解决它..... **首先**我创建了一个函数，其工作是返回 dict 的每个项目的最小值：

```
def returnminDict(_dct):
    dict_items = _dct.items()
    list_items = list(dict_items)
    init_items = list_items[0]
    for i in range(len(list_items)):
        if list_items[i][1] > init_items[1]:
           continue
        else:
           init_items = list_items[i]
    return init_items 
```

**其次**，现在我们有一个返回具有最小值的项目的函数，然后我创建一个新的字典然后循环遍历该字典：

```
def SelectDictSort(_dct):
    new_dict = {}
    while _dct:
        mindict = returnminDict(_dct)
        new_dict.update(dict((mindict,)))
        _dct.pop(mindict[0])
    return new_dict 
```

我试试这个`SelectDictSort({2: 5, 5: 1, 4: 3, 1: 1, 0: 1, 9: 2, 8: 2})`会返回：

```
{0: 1, 1: 1, 5: 1, 8: 2, 9: 2, 4: 3, 2: 5} 
```

嗯......我不知道哪个是正确的，但这是我尝试过的......

（更新代码从`retrun new_dct`到`return new_dict`）

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2012-11-03T11:07:21.490

使用 Python 3.2：

```
x = {"b":4, "a":3, "c":1}
for i in sorted(x.values()):
    print(list(x.keys())[list(x.values()).index(i)]) 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2017-05-24T03:19:04.433

此方法不会使用 lambda，并且在 Python 3.6 上运行良好：

```
 # sort dictionary by value
d = {'a1': 'fsdfds', 'g5': 'aa3432ff', 'ca':'zz23432'}
def getkeybyvalue(d,i):
    for k, v in d.items():
        if v == i:
            return (k)

sortvaluelist = sorted(d.values())

# In >> Python 3.6+ << the INSERTION-ORDER of a dict is preserved. That is,
# when creating a NEW dictionary and filling it 'in sorted order',
# that order will be maintained.
sortresult ={}
for i1 in sortvaluelist:   
    key = getkeybyvalue(d,i1)
    sortresult[key] = i1
print ('=====sort by value=====')
print (sortresult)
print ('=======================') 
```

# ruby - 如何在另一个文件中包含 Ruby 源代码？

> ID：613187
> 
> 赞同：4
> 
> 时间：2009-03-05T00:50:13.260
> 
> 标签：ruby, command-line

我有许多 Ruby 文件，每个文件都声明 a `Class`，但可以想象每个文件都可以从命令行运行。

我想将以下功能放在每个文件的底部，尽可能减少重复：

```
if __FILE__ == $0
  # instantiate the class and pass ARGV to instance.run
end 
```

我的第一直觉是这样做：

```
# /lib/scriptize.rb:
Kernel.class_eval do
  def scriptize(&block)
    block.call(ARGV) if __FILE__ == $0
  end
end

# /lib/some_other_file.rb:
include 'scriptize'
class Foo
  # ...
end
scriptize { |args| Foo.new.run(args) } 
```

但这不起作用，因为`__FILE__`在 中评估`scriptize.rb`，所以它*永远不是*Foo。

我想解决方案是从字面上内联 的内容`scriptize.rb`，但我不知道语法。我可以使用`eval`，但这仍然是相当多的重复——它不能真正简化为我添加的方法`Kernel`。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-05T00:57:40.153

尝试评估它。

```
eval(IO.read(rubyfile), binding) 
```

这就是 Rails 的初始化程序在加载文件时所做的`config/environments`，因为它需要在`Rails::Initializer.run`块中评估它们。

`binding`是一个 ruby​​ 方法，它将返回当前上下文，当传递给 时`eval`，会导致它在调用环境中评估代码。

* * *

试试这个：

```
 # my_class.rb 
  class MyClass
    def run
      puts 'hi'
    end
  end

  eval(IO.read('whereami.rb'), binding)

  # whereami.rb 
  puts __FILE__

  $ ruby my_class.rb 
  my_class.rb 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T01:40:15.387

用于`caller`确定您与调用堆栈顶部的距离：

```
---------------------------------------------------------- Kernel#caller
     caller(start=1)    => array
------------------------------------------------------------------------
     Returns the current execution stack---an array containing strings
     in the form ``_file:line_'' or ``_file:line: in `method'_''. The
     optional _start_ parameter determines the number of initial stack
     entries to omit from the result.

        def a(skip)
          caller(skip)
        end
        def b(skip)
          a(skip)
        end
        def c(skip)
          b(skip)
        end
        c(0)   #=> ["prog:2:in `a'", "prog:5:in `b'", "prog:8:in `c'", "prog:10"]
        c(1)   #=> ["prog:5:in `b'", "prog:8:in `c'", "prog:11"]
        c(2)   #=> ["prog:8:in `c'", "prog:12"]
        c(3)   #=> ["prog:13"] 
```

这给出了这个定义`scriptize`

```
# scriptize.rb
def scriptize
    yield ARGV if caller.size == 1
end 
```

现在，作为一个例子，我们可以使用两个相互需要的库/可执行文件

```
# libexA.rb
require 'scriptize'
require 'libexB'

puts "in A, caller = #{caller.inspect}"
if __FILE__ == $0
    puts "A is the main script file"
end

scriptize { |args| puts "A was called with #{args.inspect}" }

# libexB.rb
require 'scriptize'
require 'libexA'

puts "in B, caller = #{caller.inspect}"
if __FILE__ == $0
    puts "B is the main script file"
end

scriptize { |args| puts "B was called with #{args.inspect}" } 
```

所以当我们从命令行运行时：

```
% ruby libexA.rb 1 2 3 4
in A, caller = ["./libexB.rb:2:in `require'", "./libexB.rb:2", "libexA.rb:2:in `require'", "libexA.rb:2"]
in B, caller = ["libexA.rb:2:in `require'", "libexA.rb:2"]
in A, caller = []
A is the main script file
A was called with ["1", "2", "3", "4"]
% ruby libexB.rb 4 3 2 1
in B, caller = ["./libexA.rb:2:in `require'", "./libexA.rb:2", "libexB.rb:2:in `require'", "libexB.rb:2"]
in A, caller = ["libexB.rb:2:in `require'", "libexB.rb:2"]
in B, caller = []
B is the main script file
B was called with ["4", "3", "2", "1"] 
```

所以这显示了使用 scriptize 和`if $0 == __FILE__`

但是，请考虑：

1.  `if $0 == __FILE__ ... end`是一个标准的 ruby​​ 习语，阅读你的代码的其他人很容易识别
2.  `require 'scriptize'; scriptize { |args| ... }`为相同的效果需要更多的打字。

为了真正值得这样做，您需要在 scriptize 的主体中有更多的通用性 - 初始化一些文件，解析参数等。一旦它变得足够复杂，您最好将更改分解为一种不同的方式 - 可能通过脚本化您的类，因此它可以实例化它们并执行主脚本主体，或者拥有一个根据名称动态需要您的类之一的主脚本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T01:18:15.173

或者，您可以简单地传递`__FILE__`给`scriptize`

```
# /lib/scriptize.rb:
module Kernel
  def scriptize(calling_file, &block)
    block.call(ARGV) if calling_file == $0
  end
end

# /lib/some_other_file.rb:
...
scriptize(__FILE__) { |args| Foo.new.run(args) } 
```

我也花时间处理掉这`class_eval`件事。（你也可以取消整个`module`事情，因为`Kernel`默认情况下是你的范围。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T09:03:39.563

另一种方法是如何`Test::Unit`做到这一点。测试用例文件中只有一个类定义（和一个`require 'test/unit'`）。

'test/unit' 库设置了一个`at_exit`自动运行任何测试用例和套件的处理程序。如果您最常见的情况是运行这些类文件，并且偶尔将它们用作库，您可以做类似的事情，并设置一个全局以在它作为库包含时禁用自动运行。

例如：

```
 # tc_mytest.rb
 require 'test/unit'

 class TC_MyTest < Test::Unit::TestCase
   def test_succeed
     assert(true, 'Assertion was true.')
   end
   def test_fail
     assert(false, 'Assertion was false.')
   end
 end 
```

无需样板即可运行：

```
% ruby tc_mytest.rb
Loaded suite tc_mytest
Started
F.
Finished in 0.007241 seconds.

  1) Failure:
test_fail(TC_MyTest) [tc_mytest.rb:8]:
Assertion was false.
<false> is not true.

2 tests, 2 assertions, 1 failures, 0 errors 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-27T06:40:58.153

我们可以使用 eval(IO.read('filename.rb'), binding)

例子：-

# 安装程序.rb

```
def setup
  @driver = Selenium::WebDriver.for :chrome
  @base_url = "http://stage.checkinforgood.com/"
  @driver.manage.timeouts.implicit_wait = 30
  @verification_errors = []
end

def teardown
  @driver.quit
  assert_equal [], @verification_errors
end 
```

# c4g.rb

```
require "selenium-webdriver"
require "test/unit"

class C4g < Test::Unit::TestCase

  eval(IO.read('setup.rb'), binding)

  def test_login
    @driver.get "http://stage.checkinforgood.com/"
    @driver.find_element(:link, "Sign In").click
    @driver.find_element(:id, "user_email").clear
    @driver.find_element(:id, "user_email").send_keys "vtr@weboniselab.com"
    @driver.find_element(:id, "user_password").clear
    @driver.find_element(:id, "user_password").send_keys "test123"
    @driver.find_element(:id, "user_submit").click
  end

  def element_present?(how, what)
    @driver.find_element(how, what)
    true
  rescue Selenium::WebDriver::Error::NoSuchElementError
    false
  end

  def verify(&blk)
    yield
  rescue Test::Unit::AssertionFailedError => ex
    @verification_errors << ex
  end

end 
```

现在我们可以跑了，

$ruby c4g.rb

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-05T00:59:56.170

```
load 'somefile' 
```

# php - AJAX 实时电子邮件验证 (PHP)

> ID：613194
> 
> 赞同：1
> 
> 时间：2009-03-05T00:51:55.517
> 
> 标签：php, jquery, ajax, validation

当用户在我的网站上创建帐户时，我希望根据我的数据库（MySQL）中的所有当前用户名检查输入用户名，并确认它是否可用。

有谁知道我可以使用的任何好的库，或者 jQuery 的插件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T13:03:14.030

[此处](http://jqueryfordesigners.com/using-ajax-to-validate-forms/)以示例形式给出了您想要的内容。它使用 jQuery 作为 JavaScript 库

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T01:14:14.933

这是未经测试的服务器端代码

```
<?php
// check_username_available.php?name=(name they supplied)

// this stuff is normally in config.inc.php
$username = "...";  // Mysql username 
$password = "...";  // Mysql password 
$db_name = "...";   // Database name 

// get name supplied from querystring
$name = $_GET('name');

// Connect to server and select database.
//
mysql_connect("localhost", $username, $password) or die("cannot connect to db"); 
mysql_select_db($db_name) or die("cannot select $db_name DB");

$query = "SELECT COUNT(*) FROM 'users' WHERE user_name = '$name'";
$result = mysql_query($query) or die("cannot count rows: " . mysql_error());

header("Content-Type: text/plain");
echo ( 0 < mysql_result($result, 0) ? "false" : "true" ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T00:57:36.767

创建一个以用户名作为参数的 PHP 文件。然后通过 jquery 中的 $.get 方法传递它。然后返回一个变量（在我的例子中称为数据），该变量将包含 PHP 文件打印的任何内容。

```
$.get("ajax_available.php?u="+username, function(data){
    if(data == "true")
    {
        // username avaiable
            $("#usernameAlert").html("<img src='images/icons/accept.png' 
               title='Laust' /> Username available");
    }
    else
    {
        // username not avaiable
    }
}); 
```

在这个例子中，我的 php 文件返回字符串“true”，但这只是一个简单的例子。

# html - 屏幕阅读器的隐藏目录

> ID：613203
> 
> 赞同：4
> 
> 时间：2009-03-05T00:54:58.567
> 
> 标签：html, accessibility

我在几个网站上看到他们将在页面顶部包含一个导航部分，并带有指向页面其他部分的内部链接，以便使用屏幕阅读器的用户可以快速跳转到内容、菜单、页脚、等等。这个“导航”元素使用 CSS 移出屏幕，因此普通用户看不到它。

**实现这一点的最佳方法是什么？也就是说，对于屏幕阅读器来说，什么是最容易访问和干扰最小的？**这是我一直在玩的：

```
<div id="nav">
    <a href="#one">Jump to section one</a>
    <a href="#two">Jump to section two</a>
    <a href="#three">Jump to section three</a>
</div>

<!-- versus -->

<ul id="nav">
    <li><a href="#one">Jump to section one</a></li>
    <li><a href="#two">Jump to section two</a></li>
    <li><a href="#three">Jump to section three</a></li>
</ul> 
```

第一个的好处是它的标记更清晰，但并不完全是语义的。此外，它看起来像“跳转到第一节 跳转到第二节 跳转到第三节”。我知道视觉外观并不重要，因为它是隐藏的，但这会影响它的读取方式吗？每个人之间是否有适当的停顿？

第二个在语法上有点冗长，但希望更具描述性。

其中哪个更好，还有更好的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T01:57:23.397

您可以下载一个名为[Fangs](http://www.standards-schmandards.com/fangs)的 Firefox 插件（参考真正的屏幕阅读器 Jaws）。它将生成 Jaws 会阅读的文本。它非常方便。我会一个接一个地对链接进行良好的语义布局。我也会把它隐藏起来......类似的东西

```
#nav {
    position: absolute;
    left: 0;
    top: -9999px

} 
```

`display: none` *在某些屏幕阅读器中可能*无法读出使用。

在我自己的网站中，我通常这样做：

```
<div id="section-nav">
    <p>Jump to</p>
    <ul>
       <li><a href="#section1">Section1</a></li>
    </ul>
</div> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T01:02:20.470

请记住，屏幕阅读器通常会这样宣布超链接。这意味着您的第一个示例不会被读出为“跳转到第一节跳转到第二节跳转到第三节”，而是“链接：跳转到第一节，链接：跳转到第二节，链接：跳转到第三节”三”之类的。

（就个人而言，我仍然会选择第二个语义选项，但这只是我个人的偏好。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T07:24:06.463

你应该把链接放在一个ID（或类）为#nav 的地方。这让那些使用屏幕阅读器的人知道内容是一个链接列表：“*这是一个包含三个项目的列表：一个链接，'跳转到第一个部分，一个链接'跳转到第二个部分'......* ”

将“ul”放置在 id 为“#nav”的“div”中是可行的，但 div 除了包装“ul”以进行识别之外没有做任何事情。只识别“ul”并将“div”排除在外会更干净。以下代码是最好的（我认为）。干净利落。

```
<ul id="nav">
    <li><a href="#one">Jump to section one</a></li>
    <li><a href="#two">Jump to section two</a></li>
    <li><a href="#three">Jump to section three</a></li>
</ul> 
```

要使用 css 从页面中删除文本，请使用：

```
ul#nav {
    position: absolute;
    left: -9999px
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T01:06:25.857

有了良好的语义布局，您就不需要它了。您可以使您已经在使用的导航元素与屏幕阅读器兼容。第二个选项通常是你如何做到这一点。您可以设置列表项的样式以匹配您当前正在执行的操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-03T22:02:55.210

执行您要求的最佳方法是使用`<ul>`其中的锚点。

但是，WebKit 中有一些错误会导致焦点实际上不会转移到目标元素，因此您还需要将事件处理程序附加到链接，以便焦点转移。这也将要求目标是选项卡焦点紫貂（`tabindex="-1"`将为此工作）。

但是，如果您在页面上有良好的标题结构，那么屏幕阅读器用户可以导航页面而无需您正在创建的导航菜单。事实上，这个菜单对于没有屏幕阅读器的只有键盘的用户可能更有用。在这种情况下，您将希望使其显示在焦点上，以便键盘用户可以看到它。

# wpf - 从 WPF 中的 VB 代码调用 XAML 动画

> ID：613211
> 
> 赞同：1
> 
> 时间：2009-03-05T00:56:55.333
> 
> 标签：wpf, vb.net, events, xaml, animation

这就是我想要做的事情：

我有一个在 Expression Blend 中完成的对象的故事板动画。我需要的是能够从 VB.net 代码触发该动画。有任何想法吗？

谢谢，

编辑：

现在我在尝试调试应用程序时遇到此错误：

**重载解决失败，因为没有可访问的“开始”接受此数量的参数。**

“开始”是开始情节提要动画的参数。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T01:03:04.617

我刚刚翻译了这个 C#（使用一个工具，我很讨厌 VB.NET）

```
Storyboard myStoryboard = (Storyboard)FindResource("StoryboardName");
myStoryboard.Begin(); 
```

对此

```
Dim myStoryboard As Storyboard = DirectCast(FindResource("StoryboardName"), Storyboard)
myStoryboard.Begin() 
```

这假设您的 Storyboard 的 x:Key 是 StoryboardName。

如果不使用 .NET 3.5 **SP1**试试

```
myStoryboard.Begin(me) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T01:05:58.980

如果我没记错的话，如果您将 x:Name 属性应用于资源，它将作为控件的成员属性进行访问，并且您可以调用（假设您使用了 x:Name="myStoryBoard"）

```
myStoryBoard.Begin() 
```

# security - 在 Web 应用程序源代码中存储密码是否安全？

> ID：613233
> 
> 赞同：10
> 
> 时间：2009-03-05T01:06:59.803
> 
> 标签：security

所以我有一个 Web 应用程序，它与其他几个需要身份验证的 API 和服务集成。我的问题是，**在我的源代码中以纯文本形式存储我的身份验证凭据是否安全？** **我可以做些什么来安全地存储这些凭据？**

我认为这是一个常见问题，因此我希望看到一种解决方案，可以在答案中保护凭据。

回应评论：我经常使用 PHP、Java 和 RoR

我希望看到更多投票来回答这个问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T18:08:55.487

这就是我们如何处理我们的密码。

```
$db['hostname'] = 'somehost.com'
$db['port'] = 1234;

$config = array();
include '/etc/webapp/db/config.php';

$db['username'] = $config['db']['username'];
$db['password'] = $config['db']['password']; 
```

除了网络服务器用户之外，没有人可以访问/etc/webapp/db/config.php，这样您就可以保护用户名和密码免受开发人员的攻击。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T02:13:12.217

不在代码中存储 PW 的唯一原因仅仅是因为配置问题（即需要更改密码并且不想重建/编译应用程序）。

但是，源是否是“安全敏感”内容（如密码、密钥、算法）的“安全”位置。当然是的。

显然，安全敏感信息需要得到适当保护，但无论使用何种文件，这都是基本事实。无论是配置文件、注册表设置还是 .java 文件或 .class 文件。

从架构的角度来看，由于上述原因，这是一个坏主意，就像如果可以避免的话，您不应该在代码中“硬编码”任何“外部”依赖项。

但是敏感数据就是敏感数据。将 PW 嵌入源代码文件会使该文件比其他源代码文件更敏感，如果这是您的做法，我会认为所有源代码都与密码一样敏感。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T01:08:28.363

不建议这样做。

加密的[web.config](http://weblogs.asp.net/scottgu/archive/2006/01/09/434893.aspx)将是一个更合适的地方（但注意不能与网络场一起使用）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-05T09:44:07.867

看来答案如下：

1.  不要将凭据放在源代码中，但是...
2.  将凭据放入配置文件
3.  清理日志文件
4.  在配置上设置适当的权限/所有权

可能更多取决于平台...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T01:10:35.113

不它不是。

另外，您可能希望有一天更改密码，并且可能让您更改源代码可能不是最佳选择。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T01:31:55.390

不，有时这是不可避免的。更好的方法是建立一个体系结构，其中服务将基于另一个信任隐式信任您正在运行的代码。（比如信任运行代码的机器，或者信任运行软件的应用服务器）

如果这些都不可用，那么编写自己的信任机制是完全可以接受的，尽管我会将它与应用程序代码完全分开。此外，建议研究使密码不落入掠夺者手中的方法，即使存储在本地机器上 - 请记住，如果有人控制了它所在的物理机器，您将无法保护任何东西。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-06T18:19:00.297

如果您控制 Web 服务器，并维护它以进行安全更新，那么最好在源中（最好在配置模块中）或在源使用的配置文件中。

如果您不控制 Web 服务器（例如，您在托管公司提供的共享甚至专用服务器上），那么加密对您没有多大帮助；如果应用程序可以解密给定主机上的凭据，则该主机可用于在无需您干预的情况下解密凭据（想想`root`或管理员查看源代码，并调整解密例程以便它可用于读取配置）。如果您使用未混淆的托管代码（例如，JVM 或 .NET）或以纯文本形式驻留在服务器上的 Web 脚本语言（如 PHP），则这种可能性更大。

通常情况下，安全性和可访问性之间存在折衷。我会考虑您要防范的威胁是什么，并想出一种方法来防范您需要的情况。如果您正在处理需要安全的数据，您可能应该相当定期地编辑数据库，并在数据在站点上变得陈旧时立即将数据离线移动到有防火墙且保护良好的数据库服务器。这将包括可以参考的社会安全号码、账单信息等数据。这也意味着您最好控制自己网络上提供计费服务或安全数据存储的服务器。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-05T10:04:41.937

我更喜欢将它们保存在一个单独的配置文件中，该文件位于 Web 服务器文档根目录之外的某个位置。

虽然这不能防止攻击者以可以强制告诉他们密码的方式破坏我的代码，但与将密码直接放入代码（或任何其他 Web 可访问文件）相比，它仍然具有优势因为它消除了对允许攻击者直接下载包含密码的文件的 Web 服务器错误配置（或错误/漏洞）的担忧。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-12-28T22:47:37.550

我正在为接收密码而不是客户端的 Web 服务应用程序编写此代码：如果您在源代码中保存散列密码，则查看源代码的人将无法帮助自己处理该散列。您的程序将收到普通密码并对其进行哈希处理并比较两个哈希值。这就是为什么我们将散列密码保存到数据库中，而不是纯文本。因为如果有人窃取 db 或出于恶意目的查看它，它们就无法逆转，他不会获得所有用户的密码，只有对他来说毫无用处的哈希值。

散列是一种单向过程：它从相同的源产生相同的值，但您不能从散列中计算源值。

存储在客户端：当用户输入 pass 时，你将它以明文形式保存到 db/file，可能会混淆一点，但你可以做的不多，以防止持有该计算机的人获取该密码。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2013-02-16T18:43:06.423

一种方法是在将密码放入 config.web 之前加密密码

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2012-07-29T16:44:43.683

似乎还没有人提到散列——使用强大的散列算法（即 SHA-2 而不是 MD5），它应该更安全。

# asp.net - ASP.net 网站发布版本包括 pdb 文件。我该如何摆脱它们？

> ID：613234
> 
> 赞同：3
> 
> 时间：2009-03-05T01:07:22.110
> 
> 标签：asp.net

我使用 VS 2008 的 WebDepolymentAdd 来完成我的网站的最终构建。这是网站，而不是 Web 应用程序项目。

我将构建设置为发布而不是调试，并且在我完成构建之后。在 bin 文件夹中，它包含第三方 .dll 的 .pdb 和 .xml，例如 AJAXcontrol 和 .compiled 文件。我是否需要将这些文件包含在最终版本中？我该如何摆脱它们？

我还注意到它也创建了 PrecompiledApp.config。那个文件需要吗？

谢谢

杰克

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T01:12:27.340

您不需要包含最终版本的 .pdb 文件，但这样做有一些好处，例如能够使用符号调试实时站点。

本文展示了如何打开/关闭此功能[。](http://gchandra.wordpress.com/2008/02/22/disable-pdp-file-generation-in-release-mode/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T01:15:15.057

.pdb 文件只是符号文件。在发布版本中，它并不是很有用，因为您很可能会将调试设置为 false。xml 文件很可能是程序集中代码中的 xml 注释，通常也不需要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T01:15:36.553

如果您发布网站（甚至发布到文件系统中的备用目录），您可以告诉 VS 仅复制运行应用程序实际需要的文件。

# ruby-on-rails - 如何定义一个代码块一次使用多次？

> ID：613238
> 
> 赞同：3
> 
> 时间：2009-03-05T01:08:40.330
> 
> 标签：ruby-on-rails, ruby

通过代码块，我的意思是：

```
def callBlock
  yield
  yield
end

callBlock { puts "In the block" } #this is the block 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T01:28:22.047

```
b = lambda { puts "this is the block" }
callBlock &b 
```

或者

```
b.call 
```

有论据：

```
def call_block_name
    yield "Dave"
    yield "Mary"
    end

b = lambda { |s| puts "this is block #{s}" }
call_block_names &b 
```

和

```
b.call("sam") 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T01:20:36.197

用于`Proc.new`捕获块，例如

```
def callBlocks(*args, &block)
  args.each { |arg| arg.call }
  block.call if block_given?
end

my_proc1 = Proc.new { puts "proc1" }
my_proc2 = Proc.new { puts "proc2" }

callBlocks(my_proc1, my_proc1, my_proc2) {
  puts "block"
} 
```

产生：

```
proc1
proc1
proc2
block 
```

想要一些争论吗？

```
def callBlocks(*args, &block)
  args.each { |arg| arg.call(1, 2, 3) }
  block.call(4, 5, 6) if block_given?
end

my_proc1 = Proc.new { |a, b, c| puts "proc1 with #{a}, #{b}, #{c}" }
my_proc2 = Proc.new { |a, *dummy| puts "proc2 only needs #{a}" }

callBlocks(my_proc1, my_proc1, my_proc2) { |*abc|
  puts "block with #{abc.join('/')}"
} 
```

产生：

```
proc1 with 1, 2, 3
proc1 with 1, 2, 3
proc2 only needs 1
block with 4/5/6 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T09:54:26.470

1.  [这是有关如何在视图中使用块的截屏视频](http://railscasts.com/episodes/40-blocks-in-view)
2.  [这是另一个很棒的块教程](http://www.igvita.com/2007/03/15/block-helpers-and-dry-views-in-rails/)

# c# - 如何在转发器内的数据绑定字段上进行客户端文本格式设置？

> ID：613244
> 
> 赞同：0
> 
> 时间：2009-03-05T01:12:25.670
> 
> 标签：c#, asp.net, javascript

我有一个转发器控件，其中一些 html 控件从某些服务器端数据源中填充。中继器内这些控件的代码看起来像这样..

```
<img src='<%# DataBinder.Eval(Container.DataItem, "Path")%>' title='<%# DataBinder.Eval(Container.DataItem, "Name")%>' alt=""> 
```

我需要格式化一些文本，所以我在这段代码中添加了一个方法。我添加的方法是服务器端方法。所以我假设这并不是处理性能方面的最佳方式。代码看起来像这样......

```
<span><%# trimItemName((DataBinder.Eval(Container.DataItem, "Name"))%></span> 
```

trimItemName(Object obj) 是一个服务器端方法，显然会修剪名称。

有没有办法我可以使用 javascript 来做到这一点，所以不必在服务器端进行简单的字符串修剪（或任何其他类型的格式化）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T01:19:34.517

就我个人而言，我会首先将这种字符串处理放在服务器上。在我看到某种显着的性能下降之前，我实际上不会认为这是一个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T01:20:25.450

你总是可以这样做：

```
<script type="text/javascript">
    function trimItemName(input) {
        //return trimmed string
    }
</script>

<span>
    <script type="text/javascript">
        document.write(
            trimItemName('<%# DataBinder.Eval(Container.DataItem, "Name") %>')
        );
    </script>
 </span> 
```

但我不确定如何将它移至客户端会​​为您购买任何东西。如果用户禁用了 JS 或不支持它（大约 10% 的互联网用户），以及保持客户端和服务器端逻辑同步的开发开销，你就有可能无法对其进行修剪。

# python - Vista 回收站如何工作？

> ID：613246
> 
> 赞同：5
> 
> 时间：2009-03-05T01:12:38.120
> 
> 标签：python, windows-vista, recycle-bin

我正在尝试编写一个 python 模块来将文件移动到 Mac 和 PC 上的“回收站”。

有没有办法，只能从命令行（是的，我的意思是绝对不使用 C#/C++/etc）将文件移动到回收站，并让它显示为通过拖放删除的文件（或通过 SHFileOperation 删除） ， ETC）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T01:17:39.980

您应该使用该[`SHFileOperation`](http://msdn.microsoft.com/en-us/library/bb762164(VS.85).aspx)功能，或者在 Vista 上使用该[`IFileOperation`](http://msdn.microsoft.com/en-us/library/bb775771(VS.85).aspx)界面（如下面的 gix 所指出的）。

从上的评论`SHFileOperation`：

> 当用于删除文件时，SHFileOperation 将永久删除文件，除非您在 lpFileOp 指向的 SHFILEOPSTRUCT 结构的 fFlags 成员中设置 FOF_ALLOWUNDO 标志。设置该标志会将文件发送到回收站。如果您想简单地删除一个文件并保证它不被放入回收站，请使用 DeleteFile。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T01:20:37.023

将文件移动到 Windows 的回收站是一个 Shell 操作。Shell 操作通过 COM 运行。对于较旧的 Windows 版本，有[SHFileOperation 接口](http://msdn.microsoft.com/en-us/library/bb762164(VS.85).aspx)。从 Vista 开始，就有了新的[IFileOperation 接口。](http://msdn.microsoft.com/en-us/library/bb775771(VS.85).aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-06-14T18:28:15.837

我已经编写了一个[Python 库，它正是这样做的](http://pypi.python.org/pypi/Send2Trash/)。你可能想检查一下。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-05T01:18:39.353

看起来[这个邮件列表条目](http://mail.python.org/pipermail/python-list/2001-June/091800.html)可能会对您有所帮助。

# c# - c# performanceCounter 设置计数器的原始值

> ID：613262
> 
> 赞同：1
> 
> 时间：2009-03-05T01:18:58.153
> 
> 标签：c#, performancecounter

我正在尝试 System.Diagnostic 的 c# PerformanceCounter Library 部分。在使用设置计数器的原始值时

公共长原始值 { 设置；得到; }

我将 Rawalue 传递给 0。但是我注意到计数器的最大值被重置为一个非常大的数字。计数器的先前值为 2

有人可以帮助我并指出我可能犯的任何错误，这是我的代码

```
using (PerformanceCounter ctr = new     
PerformanceCounter(Settings.Instance.SetSourceAppliacationName, counter.ToString(), false))
{
    if (incrementCounter)
    {
        ctr.IncrementBy(value);
    }
    else
    {
        ctr.RawValue = value;
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-27T00:59:04.713

我不认为你真的犯了一个错误。

最大值不是 PerformanceCounter 本身的特性；它是监控工具（如 PerfMon）的一部分。您不能使用 PerformanceCounter 类来设置它。

您可能想要做的一件事是在应用程序开始尝试将有用数据应用到其中之前将 RawValue 设置为零。如果您有多个应用程序使用单个实例类别 (PerformanceCounterCategoryType.SingleInstance) 或 PerformanceCounterCategoryType.MultiInstance 的相同实例名称（如“**总**”实例名称），这可能会很棘手。

非常高的数字可能只是来自用于存储性能计数器变量的未初始化内存块中的某个随机数。由于多个应用程序可能会尝试通过实例化新的 PerformanceCounter 对象来访问正在进行的性能计数器，因此该实例化过程不会根据设计自动将值设置为零。

# ajax - AJAX 演示思路

> ID：613268
> 
> 赞同：0
> 
> 时间：2009-03-05T01:21:56.397
> 
> 标签：ajax

我在我的工作中做一个关于 AJAX 的演示，并试图想办法让它变得有趣，特别是对于更高级的程序员。我计划解释 Ajax，然后可能会展示实际的 XMLHTTPRequest 代码是什么样的。也许是 HTTP 请求和响应的屏幕截图。但我真的很想做一些超越顶部的事情，并且想要一些想法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T07:30:02.877

用 ajax 创建聊天室怎么样？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T07:36:14.780

我认为你会得到更好的回应，而不是显示 XHR，而是使用像[jQuery](http://docs.jquery.com/Ajax)这样的酷和现代的东西来做你的演示，这使得 ajax 事情变得非常简单。这会让任何刚接触 ajax 的人对它的潜力感到非常兴奋。

# transparency - XFillPolygon：使用像素图传输填充？

> ID：613269
> 
> 赞同：0
> 
> 时间：2009-03-05T01:22:23.480
> 
> 标签：transparency, xlib

由于使用带有 StippleFill 的 XFillPolygon 和像素图的驱动程序问题非常慢。驱动程序提供商在提供修复方面也非常缓慢，所以我需要一个解决方法。

有没有办法使用 XFillPolygon 用透明颜色填充多边形而不使用点画填充和像素图？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-13T04:22:53.933

经过大量研究，我得出结论，不能通过 xlib 完成。然而，它可以通过硬件特定的 X 扩展来完成。因此，我的下一步是从硬件提供商那里获得解决方法。

# user-interface - 将标签云拟合到可用空间

> ID：613274
> 
> 赞同：5
> 
> 时间：2009-03-05T01:27:01.690
> 
> 标签：user-interface, tag-cloud

给定单词及其频率和屏幕空间区域，将标签云拟合到空间的好方法是什么？我能想到的两个变量是：

*   字体大小（绝对和渐变）
*   字数

我能想到的所有方法都需要迭代，例如设置单词数量的上限，然后对字体大小使用二进制搜索，直到单词刚好适合该区域。我宁愿有一个分析解决方案。

我的情况的一个复杂情况是云可以调整大小，因此算法需要能够很好地处理 100x100 像素或 1000x1000 像素。

编辑：我应该说这是针对富客户端应用程序，而不是 Web（因此可以调整大小）。另外，我希望听到一些经验，例如“没有人在标签云中查看超过 100 个单词，所以不要费心显示它们”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-23T10:04:24.883

我们在 Software Cartographer 中所做的是

*   有一个最大字体大小，
*   映射`Math.sqrt(term.frequency)`到这个范围（因为单词是 2D 区域），
*   只显示前 30 个（左右）字词，
*   排除任何精美的印刷品，即小于 6 pt 的字体大小，
*   按字母顺序对云中的术语进行排序。

备择方案

*   不要显示前 30 个，而是选择`k`没有滚动条的顶部。
*   与其将最常用的单词映射到最大字体大小，不如使用全局映射，使云之间的单词大小具有可比性（这取决于您的用例）。

据我所知，没有关于术语云的实证研究（也许 Worlde 名气的 Jonathan Feinberg 在这方面了解得更多）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T01:31:46.390

这听起来像是[背包问题](http://en.wikipedia.org/wiki/Knapsack_problem)，但倒过来了，变量更多。没有简单的完整解决方案，但您很可能能够找到在大多数情况下接近最优解决方案的启发式算法。

PS：您只能使用以像素为单位的字体大小来可靠地完成这项工作。以像素为单位的字体大小在良好的网页设计中是一件坏事 (TM)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T02:14:55.600

您可以创建一组预定的发生范围，然后可以与云中的字体大小相关。例如：

*   0 - 100: 1 厘米
*   101 - 500：1.2 厘米
*   501 - 1000：1.4 em 粗体
*   1001 - 1500：1.8 em 粗体
*   1501 - 2000：2.0 em 粗斜体/下划线/闪烁/其他等...

您可以通过根据容器大小向所有范围添加固定偏移量来缩放云。

# sql-server - 完全恢复模型是否会生成额外的事务日志？

> ID：613276
> 
> 赞同：0
> 
> 时间：2009-03-05T01:28:26.040
> 
> 标签：sql-server, backup, restore, recoverymodel

我读了一些关于恢复/备份的在线书籍，一个愚蠢的问题，如果我使用完整数据库备份/完整恢复模式，对于备份操作本身，它会为源数据库服务器生成任何额外的事务日志吗？完全恢复操作会为目标数据库生成额外的事务日志吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T02:20:35.540

一个更有用的观点可能是说完全恢复可以防止事务日志的内容被覆盖*，而没有其他操作允许它们被覆盖*

SQL Server 将记录大多数事务（例如批量加载和一些其他事务），并且在简单恢复模式下运行时，在与创建相同的事务相关的事务结束时有效地丢弃新创建的日志内容。在完全恢复模式下运行时，传输日志的内容会保留，直到标记为可被覆盖。要将它们标记为可被覆盖，通常会执行备份（完整或跨日志）。

如果 trans 日志中没有空间并且没有标记为可覆盖的日志内容，则 SQL Server 将尝试增加日志的大小。

实际上，完全恢复要求您管理事务日志，通常通过每隔一段时间执行一次事务日志备份（如果您没有 SLA 可工作或其他驱动程序来确定多久备份一次，则每 1 小时可能是一个很好的经验法则）做这个）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T01:59:12.063

我不确定我是否完全理解你的问题，但这里有。将您的数据库保持在完全恢复模式可以使您的事务日志变得非常大。权衡是您可以恢复到恢复点。

事务日志大于正常的原因是所有事务都已完全记录。这可以包括批量记录操作、索引创建等。

如果驱动器空间不是问题（并且驱动器如此便宜，不应该），这是推荐的备份方法。

# c# - 在 ListView EmptyDataTemplate 中查找控件

> ID：613277
> 
> 赞同：12
> 
> 时间：2009-03-05T01:28:32.870
> 
> 标签：c#, asp.net, .net, listview, findcontrol

我有一个`ListView`这样的

```
<asp:ListView ID="ListView1" runat="server">
   <EmptyDataTemplate>
      <asp:Literal ID="Literal1" runat="server" text="some text"/>
   </EmptyDataTemplate>
   ...
</asp:ListView> 
```

在`Page_Load()`我有以下内容：

```
Literal x = (Literal)ListView1.FindControl("Literal1");
x.Text = "other text"; 
```

但`x`返回`null`。我想更改`Literal`控件的文本，但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-05T02:05:16.777

我相信除非你在代码后面调用你的`DataBind`方法，否则永远不会尝试数据绑定。然后什么都不会渲染，甚至控件也不会被创建。`ListView``ListView``Literal`

在您的`Page_Load`活动中尝试类似：

```
protected void Page_Load(object sender, EventArgs e)
{
    if (!Page.IsPostBack)
    {
        //ListView1.DataSource = ...
        ListView1.DataBind();

        //if you know its empty empty data template is the first parent control
        // aka Controls[0]
        Control c = ListView1.Controls[0].FindControl("Literal1");
        if (c != null)
        {
            //this will atleast tell you  if the control exists or not
        }    
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-04T13:07:41.203

您可以使用以下内容：

```
 protected void ListView1_ItemDataBound(object sender, ListViewItemEventArgs e)
        {
            if (e.Item.ItemType == ListViewItemType.EmptyItem)
            {
                 Control c = e.Item.FindControl("Literal1");
                if (c != null)
                {
                    //this will atleast tell you  if the control exists or not
                }
            }
        } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-16T17:58:08.307

这不是你问的具体问题，但另一种做这种事情的方法是这样的：

```
<EmptyDataTemplate>
  <%= Foobar() %>
</EmptyDataTemplate> 
```

Foobar 在您的页面代码隐藏文件中定义的位置

```
public partial class MyClass : System.Web.UI.Page
{
...
    public string Foobar()
    {
         return "whatever";
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-09-17T14:45:25.897

另一种方法...

```
<asp:ListView ID="ListView1" runat="server">
   <EmptyDataTemplate>
      <asp:Literal ID="Literal1" runat="server" text="some text" OnInit="Literal1_Init" />
   </EmptyDataTemplate>
   ...
</asp:ListView> 
```

在代码隐藏...

```
protected void Literal1_Init(object sender, EventArgs e)
{
    (sender as Literal).Text = "Some other text";
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-24T12:59:48.733

```
 Protected Sub ListView1_ItemDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.ListViewItemEventArgs) Handles ListView1.ItemDataBound
    Dim searchValue As String = Replace(Request.QueryString("s"), "", "'")
    Dim searchLiteral2 As Literal = CType(ListView1.FindControl("Literal2"), Literal)
    searchLiteral2.Text = "''" & searchValue & "''"
End Sub 
```

...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-02-18T18:12:10.970

回答 Broam 的问题“有没有办法在数据绑定方法中做到这一点？我宁愿不硬编码“控制 [0]”，因为那太草率了”

```
protected void ListView1_DataBound(object sender, EventArgs e)
{
    ListView mylist = ((ListView)sender);
    ListViewItem lvi = null;
    if (mylist.Controls.Count == 1)
        lvi = mylist.Controls[0] as ListViewItem;

    if (lvi == null || lvi.ItemType != ListViewItemType.EmptyItem)
        return;

    Literal literal1 = (Literal)lvi.FindControl("Literal1");
    if (literal1 != null)
        literal1.Text = "No items to display";
} 
```

不幸的是，我还没有找到不使用 Controls[0] 的方法。

在通常的Item事件（ItemDataBound或ItemCreate）中，可以使用ListViewItemEventArgs的e.Item来获取ListViewItem。在 DataBound 事件中，只有一个通用的 EventArgs。

最重要的是，似乎 ((Control)sender).FindControl("Literal1") 也不起作用（从树顶部的列表视图中查找控件），因此使用 Controls[0] 。 FindControl(...)（从 listviewitem 中查找控件）。

# c++ - 如何将用 swig 包装的 c++ 类的实例推送到 lua 堆栈上？

> ID：613282
> 
> 赞同：4
> 
> 时间：2009-03-05T01:32:34.610
> 
> 标签：c++, lua, stack, swig

我有一个用 swig 包装的类，并用 lua 注册。我可以在 lua 脚本中创建此类的实例，并且一切正常。

但是假设我有一个在我的 C++ 代码中创建的类的实例，并调用了 new X，并且我有 la lua_state L，其中有一个我想调用的函数，它接受一个参数，一个 X 的实例......我如何调用该函数。这是（一些）有问题的代码（我省略了错误处理的东西）：

主文件

```
class GuiInst;
extern "C"
{
    int luaopen_engine (lua_State *L);
}

int main()
{
    GuiInst gui=new GuiInst;
    lua_State *L=luaL_newstate();
    luaopen_engine(L); //this is swigs module
    int error=luaL_loadfile(L,"mainmenu.lua")||
    lua_pcall(L, 0, 0, 0);
    lua_getglobal(L,"Init");
    //Somehow push gui onto lua stack...
    lua_pcall(L, 1, 0, 0));
    lua_close(L);
} 
```

主菜单.lua

```
function Init(gui)
    vregion=gui:CreateComponent("GuiRegionVertical");
end 
```

目前，我发现可以工作的只是从 swig 生成的 cpp 文件中公开一些功能，然后调用它。由于几个原因，这很糟糕......如果我有多个模块并且我不得不更改 swig 文件中的默认链接规范（使用 -DSWIGRUNTIME=），它将无法工作。

我将以下内容添加到 main.cpp

```
extern "C"
{
    struct swig_module_info;
    struct swig_type_info;
    int luaopen_engine (lua_State *L);
    swig_module_info *SWIG_Lua_GetModule(lua_State* L);
    void SWIG_Lua_NewPointerObj(lua_State* L,void* ptr,swig_type_info *type, int own);
    swig_type_info *SWIG_TypeQueryModule(swig_module_info *start,swig_module_info *end,const char *name);
}
//and then to push the value...
SWIG_Lua_NewPointerObj(L,gui,SWIG_TypeQueryModule(SWIG_Lua_GetModule(L),SWIG_Lua_GetModule(L),"GuiInst *"),0); 
```

它得到一个指向模块的指针，然后是指向类型的指针，然后调用 swigs 函数来注册它。不得不挖掘一个不应该是人类可读的文件（所以它在文件的顶部说）而且只是混乱，这是一件不合理的事情！（但它确实有效！）

当然，有更好的方法来完成我正在尝试做的事情。

PS 从高级 pov 我想要的是让 lua 不引用由 GuiInst 中的对象工厂创建的 Gui 组件，以防我遇到这个错误。这是我第一次向脚本语言公开功能，除了一些非常简单（和非 swig）的 python 模块，所以我准备接受建议。

感谢您的任何建议！

* * *

RBerteig 对评论的回应

当 swig 运行以防止 lua 构造它的实例时，GuiInst 的构造函数是 #defined 私有的，所以这对我不起作用。我试图阻止的是以下（在lua中）：

```
r=engine.GuiRegionVertical()
r:Add(engine.GuiButton()) 
```

它将调用“g=new GuiButton”，然后将其注册到 GuiRegionVertical（由于各种原因需要存储一个指针），然后调用“delete g”，并且 GuiRegionVertical 留下了一个指向 g 的悬空指针。

我怀疑真正需要发生的是 GuiRegionVertical::Add(GuiButton*) 应该增加 GuiButton* 的引用计数，然后 GuiRegionVertical 的析构函数应该减少其所有内容的引用计数，尽管我不确定这应该如何痛饮就完事了。

这将消除对私有构造函数、Gui 对象工厂和讨厌的外部对象的需要。

我要解决这个错误吗？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-03-02T00:50:05.627

迟到总比不好，这个解决方案将帮助其他人。

```
void handle_web_request(WebRequest *request, WebResponse *response)
{
  lua_getfield(rackam->lua_state, LUA_GLOBALSINDEX, "handle_web_request");
  SWIG_Lua_NewPointerObj(rackam->lua_state, request, SWIGTYPE_p_WebRequest, 0);
  SWIG_Lua_NewPointerObj(rackam->lua_state, response, SWIGTYPE_p_WebResponse, 0);
  lua_call(rackam->lua_state, 2, 0);
} 
```

此代码必须在 .i 文件的 %{}% 块内，因为 SWIGTYPE_p_WebRequest 是

```
#define SWIGTYPE_p_WebResponse swig_types[6] 
```

和 swig_types[6] 是

```
static swig_type_info *swig_types[12]; 
```

这意味着 swig_types 只能从定义它的 C++ 文件中访问。

这个特定的片段发送了我的两个包装指针，因此从 C++ 端调用 handle_web_request(request, response) 将运行全局 lua 函数“handle_web_request”并将我的两个指针传递给它，应用 SWIG 魔法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T02:56:17.823

有一个简单直接的答案，这可能不是最有效的答案。SWIG 生成用于从脚本语言端操作对象的包装器。对于对象，它还合成一个包装的构造函数。因此，直接的解决方案是让 Lua 解释器调用 SWIG 的构造函数来创建新对象。

对于包装`engine.GuiInst`类，您几乎可以肯定可以执行以下操作：

```
int main()
{
    lua_State *L=lua_open();
    luaopen_engine(L); //this is swigs module
    int error=luaL_loadfile(L,"mainmenu.lua")||
    lua_pcall(L, 0, 0, 0);

    luaL_dostring(L, "Init(engine.new_GuiInst())");

    lua_close(L);
} 
```

对于像脚本启动这样的一次性情况，通过 luaL_dostring() 运行字符串常量的惩罚一点也不差。但是，在事件回调或内部循环中，我会更加努力地避免它。

似乎应该有一种方法可以将指针直接转换为包装对象，我没有在我自己的少数 SWIG 生成的包装器中发现它。

**编辑：**当然，Lua 片段可以分解为 API 调用，这些调用在堆栈上获取引擎表 global，从中提取`new_GuiInst`成员，调用它，然后调用 global `Init`，但是一点点效率是以牺牲一些为代价的明晰。

至于处理不应在用户代码中意外构建的对象，正如已澄清的问题所表明的那样，我的第一个冲动是让 SWIG 生成构造函数，如果以后需要保留一个私有引用，并将其从表中删除. 即使是 C 模块（通常）也只是一个表，其成员包含函数值。除非付出额外的努力，否则在 C 中实现不会使它们成为只读的。

因此，您始终可以检索 的值`engine.new_GuiInst`并将其存放在注册表中（有关详细信息，请参阅伪索引[的 Lua 参考手册的第 3.5 节中](http://www.lua.org/manual/5.1/manual.html#3.5)[`luaL_ref()`](http://www.lua.org/manual/5.1/manual.html#luaL_ref)的讨论）以供以后使用。然后，在让任何用户代码运行之前，只需执行. 我应该注意，对于我最近使用的 C 数据类型，SWIG 为每种类型创建了两个构造函数，分别命名为和. 两者都在模块的表中可见，您希望将两个名称都设置为. 如果对 SWIG 包装 C++ 类的经验要少得多，结果可能会有所不同......`LUA_REGISTRYINDEX``engine.new_GuiInst = nil``new_TYPE``TYPE``nil`

您可能想要检查和查看`engine`SWIG 返回的表的全部内容，并创建一个仅包含您希望用户可用的方法的代理对象。您还可以更改用户脚本看到的[环境](http://www.lua.org/manual/5.1/manual.html#2.9)，以便它只有代理可用，并命名代理`engine`。[在Lua 列表](http://www.lua.org/lua-l.html)和[lua-users wiki](http://lua-users.org/wiki/)上已经有大量关于[沙盒](http://lua-users.org/wiki/SandBoxes)用户脚本的讨论。

# css - 仅将样式应用于第一级 td 标签

> ID：613284
> 
> 赞同：152
> 
> 时间：2009-03-05T01:33:21.517
> 
> 标签：css, css-selectors

有没有办法将一个类的样式应用到一个级别的 td 标签？

```
<style>.MyClass td {border: solid 1px red;}</style>

<table class="MyClass">
  <tr>
    <td>
      THIS SHOULD HAVE RED BORDERS
    </td>
    <td>
      THIS SHOULD HAVE RED BORDERS
      <table><tr><td>THIS SHOULD NOT HAVE ANY</td></tr></table>
    </td>
  </tr>
</table> 
```

* * *

## 回答 #1

> 赞同：246
> 
> 时间：2009-03-05T01:39:32.300

> 有没有办法将一个类的样式应用到一个级别的 td 标签？

是^* :

```
.MyClass>tbody>tr>td { border: solid 1px red; } 
```

但！'<code>>' 直接子选择器在 IE6 中不起作用。如果您需要支持该浏览器（唉，您可能会这样做），您所能做的就是单独选择内部元素并取消设置样式：

```
.MyClass td { border: solid 1px red; }
.MyClass td td { border: none; } 
```

* * *

^*请注意，第一个示例引用了`tbody`HTML 中未找到的元素。它*应该*在您的 HTML 中，但浏览器通常可以忽略它......他们只是在幕后添加它。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-11-26T08:39:31.507

如何使用 CSS :first-child 伪类：

```
.MyClass td:first-child { border: solid 1px red; } 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-05T01:47:44.043

这种风格：

```
table tr td { border: 1px solid red; }
td table tr td { border: none; } 
```

给我：

[这个 http://img12.imageshack.us/img12/4477/borders.png](http://img12.imageshack.us/img12/4477/borders.png)

但是，在这里使用类可能是正确的方法。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-05T01:48:54.803

只需为 MyClass 中的表创建一个选择器。

```
.MyClass td {border: solid 1px red;}
.MyClass table td {border: none} 
```

（一般适用于所有内表，您也可以这样做`table table td`。）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-10-13T22:57:08.747

我想设置表格第一列的宽度，我发现这很有效（在 FF7 中）——第一列是 50px 宽：

```
#MyTable>thead>tr>th:first-child { width:50px;} 
```

我的标记在哪里

```
<table id="MyTable">
 <thead>
  <tr>
   <th scope="col">Col1</th>
   <th scope="col">Col2</th>
  </tr>
 </thead>
 <tbody>
   ...
 </tbody>
</table> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-03-14T10:30:48.290

我想，它会起作用的。

```
.Myclass tr td:first-child{ }

 or 

.Myclass td:first-child { } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-05T01:39:14.500

我想你可以试试

```
table tr td { color: red; }
table tr td table tr td { color: black; } 
```

或者

```
body table tr td { color: red; } 
```

其中 'body' 是表父级的选择器

但是上课很可能是去这里的正确方式。

# api - Tokyo Cabinet 和 SQLite 兼容的接口？

> ID：613287
> 
> 赞同：4
> 
> 时间：2009-03-05T01:34:13.327
> 
> 标签：api, sqlite, tokyo-cabinet

我想知道是否有人见过将 SQLite 和 Tokyo-Cabinet 抽象为相同 API 的库。基本上我正在寻找可以让我使用 SQLite 进行测试和开发的东西，然后转移到 TC 进行生产。

无论如何，我专门使用的语言是 Lua，但我确信 Lua 不存在这样的库，因此使用**任何其他语言执行此操作的库也**可以，因为我可以基于该语言为 Lua 开发类似的东西.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T03:21:04.987

DataMapper 是 Merb 的默认 ORM（用 Ruby 编写），可能会有所帮助。查看用于 Tokyo-Cabinet的实验性[DataMapper 适配器](http://github.com/makoto/dm-tokyo-cabinet-adapter/tree/master)。DataMapper 已经获得 SQLite3 支持，因此您可以比较两者。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-05T01:37:20.930

I don't know for sure, but since [Carbonado](http://carbonado.sourceforge.net/) supports RDBMSs (Oracle) and "persisted b-trees" (BDB), it could definitely support both.

# google-maps - 使用谷歌地图的 iPhone 应用程序？

> ID：613289
> 
> 赞同：0
> 
> 时间：2009-03-05T01:34:41.797
> 
> 标签：google-maps

我有一个将使用 Google 地图的 iPhone 游戏应用程序的想法，我想知道我是否可以为使用 Google 地图的应用程序收费？这就像一个混搭。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T01:37:15.643

是的，您可以，但您必须为他们的企业许可证付费。如果您不为此收费，或者您只是在开发它 - 它是免费的。

[http://www.google.com/enterprise/maps/](http://www.google.com/enterprise/maps/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-03-19T17:01:13.343

是的，您可以收费，不，您不必为企业许可证付费。移动应用程序被排除在规定使用谷歌地图的应用程序必须是免费的规则之外。

[https://developers.google.com/maps/terms](https://developers.google.com/maps/terms)

9.1.1 一般规则。

(a) 免费访问（免费）。您的 Maps API 实施必须通常可供用户免费访问，并且不得要求付费订阅或其他基于费用的受限访问。此规则适用于您的内容和 Maps API 实施中的任何其他内容，无论您的内容或其他内容是现在存在还是以后添加。

9.1.2 例外。

(b) 移动应用程序。如果您的 Maps API 实施用于通过在线商店收费出售并且可下载到可以访问在线的移动设备的移动应用程序中，则第 9.1.1(a) 节（免费访问）中的规则不适用店铺。

# c# - C# 析构函数（又名：终结器）所涉及的成本？

> ID：613290
> 
> 赞同：3
> 
> 时间：2009-03-05T01:36:24.333
> 
> 标签：c#, idisposable, destructor, finalizer

> 析构函数应该只释放你的对象持有的非托管资源，它不应该引用其他对象。如果您只有托管引用，则不需要（也不应该）实现析构函数。您只希望它用于处理非托管资源。**因为有一个析构函数需要一些成本**，所以你应该只在消耗有价值的、非托管资源的方法上实现它。
> 
> -- [C++ 程序员的 C# 十大陷阱](http://www.ondotnet.com/pub/a/dotnet/2002/02/11/csharp_traps.html)

本文没有对此进行更深入的讨论，但是在 C# 中使用析构函数会涉及哪些成本？

**注意：**我知道 GC 和析构函数在可靠时间没有被调用的事实，除此之外，还有什么其他的吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T01:51:49.023

任何具有终结器的对象（我更喜欢这个术语而不是析构函数，以强调与 C++ 析构函数的区别）被添加到终结器队列中。这是对具有终结器的对象的引用列表，在删除它们之前必须调用该终结器。

当对象准备好进行垃圾回收时，GC 会发现它在终结器队列中，并将引用移动到可访问（f-reachable）队列。这是终结器后台线程依次调用每个对象的终结器方法所经过的列表。

一旦调用了对象的终结器，该对象就不再在终结器队列中，因此它只是一个常规的托管对象，GC 可以删除它。

这一切都意味着，如果一个对象有一个终结器，它至少会在一次垃圾回收中存活下来，然后才能被删除。这通常意味着对象将被移动到下一个堆代，这实际上涉及将内存中的数据从一个堆移动到另一个堆。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T01:45:49.443

[我见过的关于这一切如何运作的最广泛的讨论是由 Joe Duffy 完成的](http://www.bluebytesoftware.com/blog/PermaLink.aspx?guid=88e62cdf-5919-4ac7-bc33-20c06ae539ae)。它的细节比你想象的要多。

在此之后，我每天都制定了[一种实用的方法](http://www.atalasoft.com/cs/blogs/stevehawley/archive/2006/09/21/10887.aspx)来执行此操作 - 更少关注成本，更多关注实施。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T02:24:10.523

Guffa 和 JaredPar 很好地涵盖了细节，所以我将添加一些关于终结器或析构函数的有点深奥的注释，不幸的是 C# 语言规范称之为它们。

要记住的一件事是，由于终结器线程按顺序运行所有终结器，终结器中的死锁将阻止所有剩余（和未来）终结器运行。由于这些实例在它们的终结器完成之前不会被收集，因此死锁的终结器也会导致内存泄漏。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T04:58:17.860

[Guffa](https://stackoverflow.com/users/69083/guffa)已经很好地总结了终结器成本的因素。最近有[一篇](http://www.javaspecialists.eu/archive/Issue170.html)关于 Java 中终结器成本的文章也提供了一些见解。

通过使用 GC.SuppressFinalize 从终结器队列中删除对象，可以避免 .net 中的部分成本。我根据文章在 .net 中进行了一些快速测试，并将其发布在[此处](http://lukequinane.blogspot.com/2009/03/java-suppress-finalizer.html)（尽管重点更多地放在 Java 方面）。

* * *

下面是结果图 - 它实际上并没有最好的标签；-)。“Debug=true/false”指的是空的 vs 简单的终结器：

```
~ConditionalFinalizer()  
{  
    if (DEBUG)  
    {  
        if (!resourceClosed)  
        {  
            Console.Error.WriteLine("Object not disposed");  
        }  
        resourceClosed = true;  
    }  
} 
```

“Suppress=true”是指在 Dipose 方法中是否调用了 GC.SuppressFinalize。

## 概括

对于 .net，通过调用 GC.SuppressFinalize 从终结器队列中删除对象是将对象留在队列中的一半成本。

![](https://lh3.ggpht.com/_XbofknnK27o/SazqfA8eyZI/AAAAAAAABcg/Sgp8L-eBwXU/DotnetPerformance2_thumb%5B2%5D.png)

# c - 为 Core 2 或 Core i7 架构全面优化的 memcpy/memmove？

> ID：613294
> 
> 赞同：10
> 
> 时间：2009-03-05T01:37:46.500
> 
> 标签：c, optimization, memcpy

具有 DDR3 双通道内存的 Core 2 处理器的理论最大内存带宽令人印象深刻：根据[Wikipedia](http://en.wikipedia.org/wiki/Intel_Core_2)关于架构的文章，每秒 10+ 或 20+ GB。但是，股票 memcpy() 调用无法达到此目的。（3 GB/s 是我在此类系统上见过的最高值。）这可能是由于操作系统供应商要求 memcpy() 根据处理器的特性针对每条处理器线进行调整，因此库存 memcpy() 实现在广泛的品牌和线路上应该是合理的。

我的问题：是否有可在 C 程序中使用的针对 Core 2 或 Core i7 处理器的免费、高度调整的版本？我敢肯定，我不是唯一一个需要它的人，每个人都对自己的 memcpy() 进行微优化会浪费很大的精力。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T02:33:44.930

在测量带宽时，您是否考虑过 memcpy 既是读取又是写入，因此复制的 3 GB/s 内存实际上是 6 GB/s 的带宽？

请记住，带宽是理论上的最大值 - 现实世界的使用会低得多。例如，一页错误，您的带宽将下降到 MB/s。

memcpy/memmove 是编译器内在函数，通常会内联到 rep movsd（或者如果您的编译器可以针对该指令，则内联到相应的 SSE 指令）。在此之上改进代码生成可能是不可能的，因为现代 CPU 将非常非常好地处理这样的 rep 指令。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T01:50:05.957

如果您将 /ARCH:SSE2 指定给 MSVC，它应该为您提供经过调整的 memcpy（至少，我的）。

如果做不到这一点，请自己使用 SSE 对齐的加载/存储内在函数以大块的形式复制内存，在必要时使用 Duff 的字读取设备来处理数据的头部和尾部，以使其达到对齐的边界。您还需要使用缓存管理内在函数来获得良好的性能。

您的限制因素可能是缓存未命中和南桥带宽，而不是 CPU 周期。鉴于内存总线上总会有大量其他流量，我通常很高兴在此类操作中达到理论内存带宽吞吐量的 90% 左右。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T01:50:59.010

你可以自己写。尝试使用[英特尔优化编译器](http://cache-www.intel.com/cd/00/00/21/92/219281_compiler_optimization.pdf)直接针对架构？

英特尔还生产了一种称为[VTune](http://www.intel.com/cd/software/products/asmo-na/eng/239144.htm)（独立于编译器和语言）的东西，用于优化应用程序。

这是[一篇](http://software.intel.com/en-us/articles/achieving-performance-an-approach-to-optimizing-a-game-engine/)关于优化游戏引擎的文章。

# .net - XslTransform 与 XslCompiledTransform

> ID：613303
> 
> 赞同：6
> 
> 时间：2009-03-05T01:45:10.227
> 
> 标签：.net, xslt, xslcompiledtransform

XslTransform 似乎已被 Microsoft 弃用，取而代之的是 XslCompiledTransform。从理论上讲，如果我在执行应用程序期间只进行一次转换，那么解释 XSLT（通过 XslTransform）不应该比编译它更快吗？如果是这样，XslTransform 是否写得如此糟糕以至于对 XslCompiledTransform 所做的改进足以弥补它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T14:41:36.243

**您可能希望查看`XslTransform`和`XslCompiledTransform` [此处](http://msdn.microsoft.com/en-us/library/66f54faw.aspx)和[此处](http://blogs.msdn.com/antosha/archive/2006/07/16/xslcompiledtransform-slower-than-xsltransform.aspx)之间记录的差异，并自己做出决定**。

此外，在某些情况下，XslTransform 更不兼容。在 XslCompiledTransform 的安全性方面做了更多的工作。

**因此，人们应该考虑使用 new`XslCompiledTransform`而不是 old`XslTransform`**的原因有很多，即使在转换只运行一次并且使用旧 XslTransform 可能会稍微快一些的情况下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T08:59:43.507

好吧，你有 XslTransform 的（慢）运行时间与 XslCompiledTransform 的编译时间加上它的（快速）运行时间。没有理论上的方法可以最终决定这种比较。

理论表明：运行时间取决于输入和所需的操作，而编译时间取决于 XSLT 的复杂性。实践证实，使用微不足道的输入和复杂的 XSLT 一次执行 XslTransform 肯定会更快。

但是，对于所有实际应用程序，您将需要 XslCompiledTransform，前提是 XslTransform 已被弃用并且很可能包含永远无法修复的缺陷。实际上，我有一些样式表在 XslTransform 下表现异常，并且在 XslCompiledTransform 下完美运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T09:05:50.387

在任何情况下都应该使用 XslCompiledTransform，因为 XslTransform 已被贬低，并且可能会从框架的未来版本中删除。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-09T15:02:43.293

作为一个不相关的数据点，我只是浪费了几个小时来调试一个以前可以正常工作但现在不再正常工作的 XSLT。结果证明 XSLT 很好，问题是应用它的代码在不久前从 XslTransform（运行良好）更新为 XslCompiledTransform（转换很糟糕），这引发了错误。

所以，在这里，对 XslTransform 已过时不满意，因为我只需要还原代码即可使用它... :(

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-08-01T10:28:17.570

两者都有自己的优点和缺点。我都在使用，但在不同的情况下。我正在使用 XslTransform 将输出传递给 XML 控件变量并在文字控件中写入输出，但是当我需要在页面上传递给 XML 控件时，我需要 XslCompiledTransform。这是因为两种方法的输出不同。

```
 System.Web.UI.WebControls.Xml objXML = new System.Web.UI.WebControls.Xml();
        System.IO.StringWriter objTextWriter = new System.IO.StringWriter();
        System.Web.UI.HtmlTextWriter objHtmlTextWriter = new System.Web.UI.HtmlTextWriter(objTextWriter);
        XslTransform objTrans = new XslTransform();
        objTrans.Load(HttpContext.Current.Server.MapPath(strXslFileName));
        objXML.TransformArgumentList = objArgsList;
        objXML.Transform = objTrans;
        objXML.Document = objOutputXml;
        objXML.RenderControl(objHtmlTextWriter);
        return objTextWriter.ToString();

 XslCompiledTransform objTrans = new System.Xml.Xsl.XslCompiledTransform();
        System.IO.StringWriter objStringReader = new System.IO.StringWriter();
        objTrans.Load(HttpContext.Current.Server.MapPath(strXslFileName));
        objTrans.Transform(objOutputXml, objArgsList, objStringReader);
        return objStringReader.ToString().Replace("&lt;br&gt;", "<BR/>"); 
```

# ruby - 迭代器的无限收益

> ID：613305
> 
> 赞同：4
> 
> 时间：2009-03-05T01:46:09.037
> 
> 标签：ruby, iterator, infinite

我正在尝试学习一些红宝石。想象一下，我正在循环并执行一个长时间运行的过程，在这个过程中，我想获得一个微调器，只要有必要。

所以我可以这样做：

```
a=['|','/','-','\\']
aNow=0
# ... skip setup a big loop
print a[aNow]
aNow += 1
aNow = 0 if aNow == a.length
# ... do next step of process
print "\b" 
```

但我认为这样做会更清洁：

```
def spinChar
  a=['|','/','-','\\']
  a.cycle{|x| yield x}
end
# ... skip setup a big loop
print spinChar
# ... do next step of process
print "\b" 
```

当然 spinChar 调用需要一个块。如果我给它一个块，它会无限期地挂起。

我怎样才能得到这个块的下一个产量？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T02:31:37.277

Ruby[`yield`](http://www.rubycentral.com/pickaxe/tut_containers.html#UD)不能按照您的示例所希望的方式工作。但这可能是一个[关闭](http://www.rubycentral.com/pickaxe/tut_containers.html#UG)的好地方：

```
def spinner()
  state = ['|','/','-','\\']
  return proc { state.push(state.shift)[0] }
end

spin = spinner

# start working
print spin.call
# more work
print spin.call
# etc... 
```

在实践中，我认为这个解决方案可能太“聪明”了，但[`Proc`](http://www.rubycentral.com/pickaxe/ref_c_proc.html)无论如何理解 s 的想法可能是有用的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T03:33:49.530

我喜欢所有这些建议，但我在标准库中找到了生成器，我认为它更符合我想要做的事情：

```
spinChar=Generator.new{ |g|
  ['|','/','-','\\'].cycle{ |x|
    g.yield x
  }
}
#then
spinChar.next
#will indefinitly output the next character. 
```

在冻结数组上使用模数进行简单`array index`增量似乎是最快的。

Vlad 的主题很漂亮，但不是我想要的。如果像这样`spinner class`支持 Ruby，单行增量会更好`i++``GLYPHS[@i++%GLYPHS.length]`

Max's `spinner closure`with push shift 对我来说似乎有点密集，但生成的语法几乎与此生成器完全相同。至少我认为这是一个带有 proc 的闭包。

Chuck's`with_spinner`实际上非常接近我想要的，但是如果你不需要像上面那样的生成器，为什么要打破。

Vadim，感谢您指出这`generator`会很慢。

```
"Here's a test of 50,000 spins:"
                   user       system     total       real
"array index"      0.050000   0.000000   0.050000 (  0.055520)
"spinner class"    0.100000   0.010000   0.110000 (  0.105594)
"spinner closure"  0.080000   0.030000   0.110000 (  0.116068)
"with_spinner"     0.070000   0.030000   0.100000 (  0.095915)
"generator"        6.710000   0.320000   7.030000 (  7.304569) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-02-15T12:03:41.797

我认为你在正确的轨道上`cycle`。像这样的东西怎么样：

```
1.8.7 :001 > spinner = ['|','/','-','\\'].cycle
 => #<Enumerable::Enumerator:0x7f111c165790> 
1.8.7 :002 > spinner.next
 => "|" 
1.8.7 :003 > spinner.next
 => "/" 
1.8.7 :004 > spinner.next
 => "-" 
1.8.7 :005 > spinner.next
 => "\\" 
1.8.7 :006 > spinner.next
 => "|" 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-05T02:10:32.833

我认为您不太了解`yield`Ruby 中的功能。它不会从块中返回值——它会将值传递*给*您传递给封闭方法的块。

我想你想要更像这样的东西：

```
def with_spinner
  a=['|','/','-','\\']
  a.cycle do |x|
    print x
    $stdout.flush # needed because standard out is usually buffered
    yield # this will call the do-block you pass to with_spinner
  end
end

with_spinner do
  #process here
  #break when done
end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T02:03:11.633

你的代码有点由内而外，如果你能原谅我这么说的话。:)

为什么不：

```
class Spinner
  GLYPHS=['|','/','-','\\']
  def budge
    print "#{GLYPHS[@idx = ((@idx || 0) + 1) % GLYPHS.length]}\b"
  end
end

spinner = Spinner.new
spinner.budge
# do something
spinner.budge
spinner.budge
# do something else
spinner.budge 
```

**现在**，如果你想要类似的东西：

```
with_spinner do
  # do my big task here
end 
```

...那么你必须**使用多线程**：

```
def with_spinner
  t = Thread.new do
    ['|','/','-','\\'].cycle { |c| print "#{c}\b" ; sleep(1) }
  end
  yield
  Thread.kill(t) # nasty but effective
end 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T04:12:20.153

曾几何时，我写了一个数组。但它不仅仅是一个数组，它是一个有指针的数组，所以你可以调用 next everrr！ [http://gist.github.com/55955](http://gist.github.com/55955)

将这个类与一个简单的迭代器或循环配对，你就可以了。

```
 a = Collection.new(:a, :b, :c)
 1000.times do |i|
   puts a.current
   a.next
 end 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-13T02:50:53.140

呵呵，我上面的答案都是肮脏的。

```
a=['|','/','-','\\']
a << a
a.each {|item| puts item} 
```

# java - 在 Java 中读取错误响应正文

> ID：613307
> 
> 赞同：100
> 
> 时间：2009-03-05T01:46:40.130
> 
> 标签：java, http, httpurlconnection

在 Java 中，当 HTTP 结果为 404 范围时，此代码会引发异常：

```
URL url = new URL("http://stackoverflow.com/asdf404notfound");
HttpURLConnection conn = (HttpURLConnection) url.openConnection();
conn.getInputStream(); // throws! 
```

就我而言，我碰巧知道内容是 404，但我仍然想阅读响应的正文。

（在我的实际情况下，响应代码是 403，但响应的正文解释了拒绝的原因，我想向用户显示。）

如何访问响应正文？

* * *

## 回答 #1

> 赞同：182
> 
> 时间：2009-03-05T03:26:26.427

[这是错误报告](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4513568)（关闭，不会修复，不是错误）。

他们的建议是这样编码：

```
HttpURLConnection httpConn = (HttpURLConnection)_urlConnection;
InputStream _is;
if (httpConn.getResponseCode() < HttpURLConnection.HTTP_BAD_REQUEST) {
    _is = httpConn.getInputStream();
} else {
     /* error from server */
    _is = httpConn.getErrorStream();
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-06-29T18:34:01.333

这与我遇到的问题相同： 如果您尝试从连接中读取，`HttpUrlConnection`则会返回。 您应该在状态码高于 400 时使用。`FileNotFoundException``getInputStream()`
`getErrorStream()`

不仅如此，请注意，因为成功状态码不仅是200，甚至201、204等也经常被用作成功状态。

这是我如何管理它的示例

```
... connection code code code ...

// Get the response code 
int statusCode = connection.getResponseCode();

InputStream is = null;

if (statusCode >= 200 && statusCode < 400) {
   // Create an InputStream in order to extract the response object
   is = connection.getInputStream();
}
else {
   is = connection.getErrorStream();
}

... callback/response to your handler.... 
```

通过这种方式，您将能够在成功和错误情况下获得所需的响应。

希望这可以帮助！

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2016-05-17T11:50:20.237

在 .Net 中，您拥有 WebException 的 Response 属性，该属性可以在异常情况下访问流。所以我想这对Java来说是一个好方法，......

```
private InputStream dispatch(HttpURLConnection http) throws Exception {
    try {
        return http.getInputStream();
    } catch(Exception ex) {
        return http.getErrorStream();
    }
} 
```

或者我使用的一个实现。（可能需要更改编码或其他内容。在当前环境中工作。）

```
private String dispatch(HttpURLConnection http) throws Exception {
    try {
        return readStream(http.getInputStream());
    } catch(Exception ex) {
        readAndThrowError(http);
        return null; // <- never gets here, previous statement throws an error
    }
}

private void readAndThrowError(HttpURLConnection http) throws Exception {
    if (http.getContentLengthLong() > 0 && http.getContentType().contains("application/json")) {
        String json = this.readStream(http.getErrorStream());
        Object oson = this.mapper.readValue(json, Object.class);
        json = this.mapper.writer().withDefaultPrettyPrinter().writeValueAsString(oson);
        throw new IllegalStateException(http.getResponseCode() + " " + http.getResponseMessage() + "\n" + json);
    } else {
        throw new IllegalStateException(http.getResponseCode() + " " + http.getResponseMessage());
    }
}

private String readStream(InputStream stream) throws Exception {
    StringBuilder builder = new StringBuilder();
    try (BufferedReader in = new BufferedReader(new InputStreamReader(stream))) {
        String line;
        while ((line = in.readLine()) != null) {
            builder.append(line); // + "\r\n"(no need, json has no line breaks!)
        }
        in.close();
    }
    System.out.println("JSON: " + builder.toString());
    return builder.toString();
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T02:03:24.300

我知道这并不能直接回答这个问题，但是您可能不想使用 Sun 提供的 HTTP 连接库，而是想看看[Commons HttpClient](http://hc.apache.org/httpclient-3.x/tutorial.html)，它（在我看来）有一个更容易使用的 API。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T02:20:51.170

首先检查响应代码，然后使用`HttpURLConnection.getErrorStream()`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-19T10:30:00.073

```
InputStream is = null;
if (httpConn.getResponseCode() !=200) {
    is = httpConn.getErrorStream();
} else {
     /* error from server */
    is = httpConn.getInputStream();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-09-22T08:32:15.690

我的运行代码。

```
 HttpURLConnection httpConn = (HttpURLConnection) urlConn;    
 if (httpConn.getResponseCode() < HttpURLConnection.HTTP_BAD_REQUEST) {
                        in = new InputStreamReader(urlConn.getInputStream());
                        BufferedReader bufferedReader = new BufferedReader(in);
                        if (bufferedReader != null) {
                            int cp;
                            while ((cp = bufferedReader.read()) != -1) {
                                sb.append((char) cp);
                            }
                            bufferedReader.close();
                        }
                            in.close();

                    } else {
                        /* error from server */
                        in = new InputStreamReader(httpConn.getErrorStream());
                    BufferedReader bufferedReader = new BufferedReader(in);
                    if (bufferedReader != null) {
                        int cp;
                        while ((cp = bufferedReader.read()) != -1) {
                            sb.append((char) cp);
                        }
                        bufferedReader.close();
                    }    
                    in.close();
                    }
                    System.out.println("sb="+sb); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-03-19T11:07:56.453

**如何在 java 中读取 404 响应正文：**

使用 Apache 库 - [https://hc.apache.org/httpcomponents-client-4.5.x/httpclient/apidocs/](https://hc.apache.org/httpcomponents-client-4.5.x/httpclient/apidocs/)

或 Java 11 - [https://docs.oracle.com/en/java/javase/11/docs/api/java.net.http/java/net/http/HttpClient.html](https://docs.oracle.com/en/java/javase/11/docs/api/java.net.http/java/net/http/HttpClient.html)

下面给出的片段使用 Apache：

```
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.util.EntityUtils;

CloseableHttpClient client = HttpClients.createDefault();
CloseableHttpResponse resp = client.execute(new HttpGet(domainName + "/blablablabla.html"));
String response = EntityUtils.toString(resp.getEntity()); 
```

# c# - C# 和 SAPI，我有语音识别，但它会拾取我不感兴趣的单词。我怎样才能限制，而不仅仅是超重，gramer dict？

> ID：613313
> 
> 赞同：1
> 
> 时间：2009-03-05T01:48:53.743
> 
> 标签：c#, speech-recognition, sapi

唷，大标题，但是是的，它总结了这个问题。

我在 C# 中使用 Microsoft SAPI，在我正在处理的程序中使用他们的语音识别。

我所做的是。语法 = objRecoContext.CreateGrammar(0);

```
 menuRule = grammar.Rules.Add("typewrite", SpeechRuleAttributes.SRATopLevel | SpeechRuleAttributes.SRADynamic, 1);
            object PropValue = "";

            menuRule.InitialState.AddWordTransition(null, "will", " ", SpeechGrammarWordType.SGLexical, "will", 1, ref PropValue, 1.0F);
            menuRule.InitialState.AddWordTransition(null, "New", " ", SpeechGrammarWordType.SGLexical, "New", 1, ref PropValue, 1.0F);
            menuRule.InitialState.AddWordTransition(null, "Open", " ", SpeechGrammarWordType.SGLexical, "Open", 2, ref PropValue, 1.0F);
            menuRule.InitialState.AddWordTransition(null, "Close", " ", SpeechGrammarWordType.SGLexical, "Close", 3, ref PropValue, 1.0F); 
```

对于自定义词。但这会比我想要的更多。我怎样才能解决这个问题。

我要问的是，我怎样才能让 m$ sapi 只关心我想要的单词。不是默认字典中的每个单词。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-13T01:40:03.967

您可以尝试使用命令和控制模式让识别器仅识别您想要的单词。对于您的代码，您需要做的就是添加

语法.CmdSetRuleState("打字",SpeechRuleState.SGDSActive);

和 objRecoContext.State = SpeechRecoContextState.SRCS_Enabled；

希望这可以帮助..

# javascript - 编写 JavaScript 邮政编码验证函数

> ID：613316
> 
> 赞同：1
> 
> 时间：2009-03-05T01:49:20.233
> 
> 标签：javascript, hash, compression, zipcode

我想编写一个[JavaScript](http://en.wikipedia.org/wiki/JavaScript)函数，通过检查邮政编码是否实际存在来验证邮政编码。以下是所有邮政编码的列表：

[http://www.census.gov/tiger/tms/gazetteer/zips.txt](http://www.census.gov/tiger/tms/gazetteer/zips.txt) （我只关心第2栏）

* * *

这确实是一个压缩问题。我想这样做是为了好玩。好的，现在已经不碍事了，这是我能想到的对直接哈希表的优化列表，请随意添加我没有想到的任何内容：

*   将邮政编码分为 2 部分，前 2 位数字和后 3 位数字。
*   做一个巨大的 if-else 语句，首先检查前 2 位数字，然后检查最后 3 位数字内的范围。
*   或者，将拉链转换为十六进制，看看我是否可以使用较小的组来做同样的事情。
*   找出在所有有效邮政编码范围内是否有更多有效邮政编码与无效邮政编码。针对较小的群体编写上述代码。
*   将散列分解为单独的文件，并通过 Ajax 加载它们作为邮政编码中的用户类型。所以也许分成两部分，第一部分是前 2 位，第二部分是后 3 位。

最后，我计划使用另一个程序而不是手动生成 JavaScript 文件。

编辑：性能在这里很重要。我确实想用这个，如果它不烂的话。JavaScript 代码执行性能 + 下载时间。

编辑 2：请仅使用 JavaScript 解决方案。我无权访问应用程序服务器，另外，这将成为另一个问题 =)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T01:56:33.617

您可以做不可思议的事情并将代码视为数字（请记住，它实际上不是数字）。将您的列表转换为一系列范围，例如：

```
zips = [10000, 10001, 10002, 10003, 23001, 23002, 23003, 36001]
// becomes
zips = [[10000,10003], [23001,23003], [36001,36001]]
// make sure to keep this sorted 
```

然后测试：

```
myzip = 23002;
for (i = 0, l = zips.length; i < l; ++i) {
    if (myzip >= zips[i][0] && myzip <= zips[i][1]) {
        return true;
    }
}
return false; 
```

这只是使用非常简单的线性搜索（O(n)）。如果您保持列表排序并使用二进制搜索，则可以实现 O(log n)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T02:21:36.520

> 我想编写一个验证邮政编码的 JavaScript 函数

可能比它的价值更多的努力，保持更新，以便在任何时候都不会拒绝某人真正有效的邮政编码。您也可以尝试外部服务，或者像其他人一样做，只接受任何 5 位数字！

> 这是我能想到的对直接哈希表的优化列表

很抱歉破坏了潜在的乐趣，但您可能无法管理比 JavaScript 的 Object 在用作哈希表时提供的更好的实际性能。对象成员访问是 JS 中最常见的操作之一，将进行超级优化；即使从计算机科学的角度来看它们可能是更好的结构，构建自己的数据结构也不太可能击败它。特别是，任何使用 'Array' 的东西都不会像你想象的那么好，因为 Array 实际上是作为一个对象（哈希表）本身实现的。

话虽如此，如果您只需要知道“有效与否”，一个可能的空间压缩工具就是使用一个 100000 位的位域，打包成一个字符串。例如，对于只有 100 个邮政编码的空间，其中代码 032-043 是“有效的”：

```
var zipfield= '\x00\x00\x00\x00\xFF\x0F\x00\x00\x00\x00\x00\x00\x00';
function isvalid(zip) {
    if (!zip.match('[0-9]{3}'))
        return false;
    var z= parseInt(zip, 10);
    return !!( zipfield.charCodeAt(Math.floor(z/8)) & (1<<(z%8)) );
} 
```

现在我们只需要找出最有效的方法来获取脚本的位域。上面简单的 '\x00' 填充版本效率很低。减少这种情况的传统方法是，例如。对其进行base64编码：

```
var zipfield= atob('AAAAAP8PAAAAAAAAAA=='); 
```

这将使 100000 个标志降至 16.6kB。不幸的是 atob 仅适用于 Mozilla，因此其他浏览器需要额外的 base64 解码器。（这不是太难，但它需要更多的启动时间来解码。）也可以使用 AJAX 请求来传输直接二进制字符串（以 ISO-8859-1 文本编码到 responseText）。这会将它降低到 12.5kB。

但实际上，只要您使用 mod_deflate 提供脚本，可能任何事情，即使是幼稚的版本，都会做，这将压缩掉很多冗余，以及所有长范围的 'invalid 重复 '\x00' '代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T01:59:06.637

我使用[Google Maps API](http://code.google.com/apis/maps/)检查邮政编码是否存在。

它更准确。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T01:56:02.650

假设您已经在排序数组中找到了 zip（如果您正在控制数据结构的生成，这似乎很公平），请查看简单的二进制搜索是否足够快。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T02:00:08.990

这可能有用：

[PHP邮政编码范围和距离计算](http://www.micahcarrick.com/04-19-2005/php-zip-code-range-and-distance-calculation.html)

以及[邮政编码列表](http://en.wikipedia.org/wiki/List_of_postal_codes)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T04:36:10.143

所以...您正在进行客户端验证并希望针对文件大小进行优化？您可能无法击败一般压缩。幸运的是，大多数浏览器都为您支持 gzip，因此您可以免费使用它。

一个简单的 json 编码字典或带有按排序顺序的邮政编码的列表，然后查看字典。它会很好地压缩，因为它是一个可预测的序列，很容易导入，因为它是 json，使用浏览器内置的解析器，并且查找也可能非常快，因为这是一个 javascript 原语。

# wpf - 调用情节提要开始时出现调试错误

> ID：613322
> 
> 赞同：0
> 
> 时间：2009-03-05T01:51:24.923
> 
> 标签：wpf, vb.net, xaml, animation

我在 XAML（WPF 项目）中有一些故事板，我从 VB 代码中调用它们：

```
Dim ServiceOff As Storyboard = DirectCast(FindResource("ServiceStopped"), Storyboard)
ServiceOff.Begin() 
```

尝试构建时出现以下错误：

> 重载解决失败，因为没有可访问的“开始”接受此数量的参数。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T01:54:54.930

我在你的另一个问题中回答了。

如果您不使用 .NET 3.5 **SP1 ，则需要调用 ServiceOff.Begin(me)**

# iphone - iPhone：自定义 UIImagePickerController？

> ID：613324
> 
> 赞同：2
> 
> 时间：2009-03-05T01:51:40.740
> 
> 标签：iphone

似乎内置的 UIImagePickerController 无法接受其设备相机卷以外的来源。

我想在我自己的应用程序中获得挑选和放大图片的功能。另外我想允许用户选择图片并将其保存到他们的相机胶卷中（以便他们以后可以将其用作墙纸）

1）构建支持我需要的自定义 UIImagePickerController 的推荐方法是什么？我还缺少另一个内置控制器吗？

3）有没有办法把一个 UIImage 直接保存到设备的桌面背景中？还是分两步（首先保存到相机胶卷），然后让用户从那里加载图片以保存为墙纸

提前致谢！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T17:45:52.250

此时，似乎构建自定义 UIImagePickerController 功能的唯一方法是子类化，然后直接使用视图层次结构。这允许您移动、隐藏和替换 UI 元素并访问控制相机操作的非公共类，但正如您可能收集到的那样，这种技术都不受支持（因为它可能并且可能会破坏未来的更新）并且不推荐（因为如果检测到它可能会并且很可能会让您的应用被 App Store 拒绝）。

至于您的第二点（不知何故编号为 3），John 是对的：公共 SDK 中没有调用来完成此操作。如果你很聪明，你可能会一起破解一些东西，但请记住我第一段中的警告......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T01:57:06.907

关于#3）SDK 中没有公开调用将 UIImage 保存到桌面。

我不知道你的其他问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-11T21:38:11.520

就在今天我开始了一个开源的 UIImagePickerController 克隆，它并不完美，但它工作得很好。随意分叉[http://github.com/jeena/JPImagePickerController](http://github.com/jeena/JPImagePickerController)

# c# - 虚拟类中的抽象方法

> ID：613327
> 
> 赞同：4
> 
> 时间：2009-03-05T01:53:08.273
> 
> 标签：c#, oop, virtual, abstract

我有 ac# 类，它有很多虚拟方法，其中一些方法本质上是抽象的（它们在子类中完全实现，基类是空的）。

为了让它编译，我在基类中抛出了一个 InvalidOperationException 并注释了应该做什么。这只是感觉很脏。

有没有更好的方法来设计我的课程？

编辑：它用于将在加拿大运行的应用程序的中间层，一半的方法是通用的，因此是虚拟的。一半的方法是针对特定省份的。

```
Public class PersonComponent() 
{

 public GetPersonById(Guid id) {
  //Code to get person - same for all provinces
 }

 Public virtual DeletePerson(Guid id) {
  //Common code
 }

 Public virtual UpdatePerson(Person p) {
  throw new InvalidOperation("I wanna be abstract");
 }

Public Class ABPersonComponent : PersonComponent
{
    public override DeletePerson(Guid id) 
    {
       //alberta specific delete code
    }

    public override UpdatePerson(Person p) 
    {
       //alberta specific update codecode
    }

} 
```

希望这是有道理的

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-05T01:56:52.383

将基类标记为抽象，以及没有实现的方法。

像这样

```
public abstract class BaseClass
{

    public abstract void AbstractMethod();
}

public class SubClass: BaseClass
{
    public override void AbstractMethod()
    {
        //Do Something
    }
} 
```

您不能在抽象类之外拥有抽象方法。将类标记为抽象意味着您将无法实例化它。但这没有任何意义。你打算对一个无论如何都没有实现方法的类做什么？

**编辑：**通过查看您的课程，是的，我将 PersonComponent 与 UpdatePerson 方法一起抽象。或者，如果 UpdatePerson 只是不为 PersonComponent 做任何事情，请保持原样，但将 PersonComponent 的 UpdatePerson 方法设为空。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T09:48:57.740

想想你的对象层次结构。您是否想为所有派生类共享公共代码，然后在基类中实现基本功能。

共享基本代码时，请注意模板模式。使用公共方法并将其链接到具有核心/共享实现的受保护虚拟方法。以“Core”结束共享实现方法名。

例如：

```
public abstract class BaseClass
{
    protected virtual void DeletePersonCore(Guid id)
    {
        //shared code
    }

    public void DeletePerson(Guid id)
    {
        //chain it to the core
        DeletePersonCore(id);
    }
}

public class DerivedClass : BaseClass
{
    protected override void DeletePersonCore(Guid id)
    {
        //do some polymorphistic stuff

        base.DeletePersonCore(id);
    }
}

public class UsageClass
{
    public void Delete()
    {
        DerivedClass dc = new DerivedClass();

        dc.DeletePerson(Guid.NewGuid());
    }
} 
```

# php - 日期范围内的营业周

> ID：613337
> 
> 赞同：-2
> 
> 时间：2009-03-05T01:57:15.393
> 
> 标签：php, date, range

我需要一个 php 函数，它可以在给定的日期范围内以特定格式计算工作日。例子：

开始日期 = 02-03-2009

结束日期 = 31-12-2010

3月2-6日

3月9-13日

3月16-20日

3月23-27日

3 月 30 日 - 4 月 3 日

4 月 6 日 - 10 日

等等...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T04:33:31.117

这不是直接的答案——它是用 Perl 编写的（Perl 在这方面有一些自己的怪癖）。但是，我认为它确实会产生所需的输出。

```
#!/bin/perl -w
#
# Given two Unix-style timestamps (smaller, larger), produce a range of weeks.
# SO 613337

use strict;
use POSIX;

my($t1) = $ARGV[0];
my($t2) = $ARGV[1];

# Split given times into pieces
my($sec1,$min1,$hour1,$mday1,$mon1,$year1,$wday1) = localtime($t1);
my($sec2,$min2,$hour2,$mday2,$mon2,$year2,$wday2) = localtime($t2);

# Determine midday on Monday for starting week.
# Determine midday on Friday for ending week.
# Saturday rounds backwards; Sunday rounds upwards.
my($t3) = mktime(0, 0, 12, $mday1 - ($wday1 - 1) + 0, $mon1, $year1);
my($t4) = mktime(0, 0, 12, $mday2 - ($wday2 - 1) + 5, $mon2, $year2);

my($sec3,$min3,$hour3,$mday3,$mon3,$year3,$wday3) = localtime($t3);
my($sec4,$min4,$hour4,$mday4,$mon4,$year4,$wday4) = localtime($t4);

print "t1 = %10d; %04d-%02d-%02d (%d)\n", $t1+1900, $year1, $mon1+1, $mday1, $wday1;
print "t2 = %10d; %04d-%02d-%02d (%d)\n", $t2+1900, $year2, $mon2+1, $mday2, $wday2;
print "t3 = %10d; %04d-%02d-%02d (%d)\n", $t3+1900, $year3, $mon3+1, $mday3, $wday3;
print "t4 = %10d; %04d-%02d-%02d (%d)\n", $t4+1900, $year4, $mon4+1, $mday4, $wday4;

use constant secs_per_week  => 24 * 3600 * 7;
use constant secs_to_friday => 24 * 3600 * 4;

for (my($t) = $t3; $t < $t4; $t += secs_per_week)
{
    my($mon) = strftime("%b %e", localtime($t));
    my($fri) = strftime("%b %e", localtime($t + secs_to_friday));
    my($ans) = "$mon - $fri";
    $ans =~ s/^(\w\w\w)\s+(\d+) - (\1)\s+(\d+)$/$1 $2-$4/;
    $ans =~ s/  +/ /g;
    print "$ans\n";
} 
```

*已编辑：修复 0..11 范围内的月份数字，打印为 01..12。年的变更处理也。*

使用星期一和星期五的中午，否则只处理几天，我可以忽略与在冬季和夏季（标准和夏令时）时间之间切换有关的问题。

例如：

```
$ perl weekdays.pl 1234567890 1324567890
t1 = 1234567890; 2009-02-13 (5)
t2 = 1324567890; 2011-12-22 (4)
t3 = 1234209600; 2009-02-09 (1)
t4 = 1324756800; 2011-12-24 (6)
Feb 9-13
Feb 16-20
Feb 23-27
Mar 2-6
Mar 9-13
Mar 16-20
Mar 23-27
Mar 30 - Apr 3
Apr 6-10
Apr 13-17
Apr 20-24
Apr 27 - May 1
May 4-8
May 11-15
May 18-22
May 25-29
Jun 1-5
Jun 8-12
Jun 15-19
Jun 22-26
Jun 29 - Jul 3
Jul 6-10
Jul 13-17
Jul 20-24
Jul 27-31
Aug 3-7
Aug 10-14
Aug 17-21
Aug 24-28
Aug 31 - Sep 4
Sep 7-11
Sep 14-18
Sep 21-25
Sep 28 - Oct 2
Oct 5-9
Oct 12-16
Oct 19-23
Oct 26-30
Nov 2-6
Nov 9-13
Nov 16-20
Nov 23-27
Nov 30 - Dec 4
Dec 7-11
Dec 14-18
Dec 21-25
Dec 28 - Jan 1
Jan 4-8
Jan 11-15
Jan 18-22
Jan 25-29
Feb 1-5
Feb 8-12
Feb 15-19
Feb 22-26
Mar 1-5
Mar 8-12
Mar 15-19
Mar 22-26
Mar 29 - Apr 2
Apr 5-9
Apr 12-16
Apr 19-23
Apr 26-30
May 3-7
May 10-14
May 17-21
May 24-28
May 31 - Jun 4
Jun 7-11
Jun 14-18
Jun 21-25
Jun 28 - Jul 2
Jul 5-9
Jul 12-16
Jul 19-23
Jul 26-30
Aug 2-6
Aug 9-13
Aug 16-20
Aug 23-27
Aug 30 - Sep 3
Sep 6-10
Sep 13-17
Sep 20-24
Sep 27 - Oct 1
Oct 4-8
Oct 11-15
Oct 18-22
Oct 25-29
Nov 1-5
Nov 8-12
Nov 15-19
Nov 22-26
Nov 29 - Dec 3
Dec 6-10
Dec 13-17
Dec 20-24
Dec 27-31
Jan 3-7
Jan 10-14
Jan 17-21
Jan 24-28
Jan 31 - Feb 4
Feb 7-11
Feb 14-18
Feb 21-25
Feb 28 - Mar 4
Mar 7-11
Mar 14-18
Mar 21-25
Mar 28 - Apr 1
Apr 4-8
Apr 11-15
Apr 18-22
Apr 25-29
May 2-6
May 9-13
May 16-20
May 23-27
May 30 - Jun 3
Jun 6-10
Jun 13-17
Jun 20-24
Jun 27 - Jul 1
Jul 4-8
Jul 11-15
Jul 18-22
Jul 25-29
Aug 1-5
Aug 8-12
Aug 15-19
Aug 22-26
Aug 29 - Sep 2
Sep 5-9
Sep 12-16
Sep 19-23
Sep 26-30
Oct 3-7
Oct 10-14
Oct 17-21
Oct 24-28
Oct 31 - Nov 4
Nov 7-11
Nov 14-18
Nov 21-25
Nov 28 - Dec 2
Dec 5-9
Dec 12-16
Dec 19-23
$ 
```

# teamsystem - 使用触发器处理 TeamSystem DB 中的计算字段

> ID：613342
> 
> 赞同：0
> 
> 时间：2009-03-05T01:58:25.513
> 
> 标签：teamsystem

在我们的自定义流程中，有一些字段是计算字段。今天我使用团队系统事件和网络服务来计算这些，但老实说它有点笨拙。我不得不添加一个延迟，因为一旦保存 TFSService 确实对工作项进行了更改，一个人可能想要立即进行另一项更改，然后得到一个错误，说明工作项已被更改。因此，服务会稍等片刻以确保所有编辑都已完成（我选择了 30 秒。）除此之外，它还不错。

我想知道数据库中的触发器将是一个好习惯，或者在升级到较新版本（即 Team System 2010）时会导致问题。

有没有人这样做或对使用触发器有任何评论？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T02:02:00.780

最好将数据库保持原样，以防您所做的任何更改干扰其运行。

但是话虽如此，只要您编写触发器创建和删除脚本，并在升级之前将删除脚本应用到数据库，就可以了。

# ms-access - 为什么我的 VBA 项目在其他计算机上失败？

> ID：613359
> 
> 赞同：0
> 
> 时间：2009-03-05T02:05:44.873
> 
> 标签：ms-access, vba, excel

我做了一个基于 Excel 和 Access 的 VBA 项目。当我复制到其他计算机时，某些方法（左、右等）或控件（组合框）有时会被禁用。我不得不在那台电脑上重建。但有时没关系。为什么？是因为许可证问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T03:08:17.077

这是版本差异/缺少参考问题。有时它会在正确的功能上为您提供错误，有时在完全不相关的功能上会出现错误。

如果您要部署到不同版本的 Excel，您可以使用后期绑定而不是早期绑定来缓解此问题。当你在开发时，你可以使用类似的东西

```
Dim x As Excel.Application
x = New Excel.Application 
```

但是对于部署，您可以将其更改为以下内容，然后完全删除该引用。

```
Dim x As Object
x = CreateObject("Excel.Application") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T03:07:42.180

检查失败的计算机上的引用（通过 VBA 编辑器中的工具/引用菜单项）。不同的平台可以安装不同的 DLL 集，如果有标记为“MISSING”的引用，您将从 excel 中得到一些误导性错误。

这[在这个问题中讨论](http://tinyurl.com/bgk568)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T02:21:05.943

不是因为许可。可能有很多因素，但我可以将其归结为：根据多台计算机上的 Office SP 版本差异，它可能会让您头疼。还要检查每个的 Office Web Components 版本。Office 上的选项和加载项可能会为您提供一些线索。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T00:26:15.993

检查您遇到问题的计算机上的安全性和权限非常重要。用户必须对前端和后端文件夹具有完全权限。如果安全设置不允许，宏将不会运行。您可能希望阅读：

[自我认证和数字签名](http://office.microsoft.com/en-us/access/HP010397921033.aspx)

[有关 Office 代码和宏安全性的安全主体的一般信息](http://office.microsoft.com/en-us/ork2003/CH011480831033.aspx)

[Office 2003 的受信任位置默认值](http://office.microsoft.com/en-us/ork2003/HA011403181033.aspx?pid=CH011480851033)

[Office 2003 中的宏安全性](http://office.microsoft.com/en-us/ork2003/HA011403071033.aspx?pid=CH011480831033)

在大多数情况下，后期绑定将解决 VBA 中的引用问题，除非您有一些不寻常的引用。大多数问题是由可以通过后期绑定克服的库版本差异引起的。使用 VBA，通常建议您使用早期绑定进行开发，但使用后期绑定进行发布。后期绑定的主要缺点是将内置常量更改为值（速度不再是过去的问题。）

# c++ - 以一定速率生成随机数

> ID：613361
> 
> 赞同：0
> 
> 时间：2009-03-05T02:06:06.557
> 
> 标签：c++, algorithm, random

我有以下试图生成随机数的 C++ 代码。这个[想法](https://stackoverflow.com/questions/601727/generating-synthetic-dna-sequence-with-subtitution-rate/601750#601750)是我们给出了一些速率“x”和运行次数；我们希望它会产生与（x * 运行次数）一样多的数字。

```
#include <iostream>      
#include <vector>
#include <fstream>
#include <sstream>       
#include <time.h>        
using namespace std;     

int main  () {

    // Initialize Random Seed 
    srand (time(NULL));

    string line;
    double SubsRate = 0.003;  
    double nofRuns   = 1000000;

    for (unsigned i=0; i < nofRuns ; i++) {

        int toSub = rand() % 1000 + 1;

        if (toSub == (SubsRate * 1000)) {
         cout << toSub << " Sub"  << endl; 
        }

    }
    return 0;
} 
```

因此，如果我们使用此命令运行 K 次以上的代码：

```
$ a=0 ; while test $a -lt 10 ; do ./MyCode | wc -l ; a=`expr $a + 1` ; done 
```

我们预计它会在 1M 次运行中生成多达约 3000 次的数字“3”。但是我上面的代码如何只生成数字“3”多达 900 ~ 1000 次。

如何改进我上面的代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T02:17:31.443

换句话说，您正在检查结果 == 3，而不是结果 <= 3。

3 只会发生，千分之一，但 <= 3 会以你想要的速度发生。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T02:17:33.393

*   您将期望在 1000 次中获得第 3 次，即在 1M 中获得 1000 次。
*   您将期望在 1000 次中获得第 9 次，即在 1M 中获得 1000 次。
*   您将期望在 1000 次中获得第 7 次，即在 1M 中获得 1000 次。
*   您将期望在 1000 次中获得 3、7 或 9 中的任意一种，即 1M 中的 3000 次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T02:12:55.777

我觉得你这里的数学有点不对...

根据您那里的代码，您将统一生成 1 到 1000 之间的随机数。

您的检查 (toSub==(SubsRate*1000)) 仅检查您生成的数字是否为 3（因为 rate*1000=3）。因此，您只会得到 3 次大约 1000 次，而不是 3000 次。

你没有提到你的数字的范围是什么，但一般来说，如果你想使用均匀分布在 IMIN 和 IMAX 之间的范围内生成一个数字（每个值出现的机会相同），那么你只需写：

```
int I = IMin + rand() % (IMax - IMin); 
```

在这种情况下，如果您希望每个数字每 3000 次出现一次，则必须将 1 到 3000 之间的数字随机化。否则，您不是在谈论均匀分布。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T16:41:52.543

正如其他人所提到的，您的原件是测试随机数是否等于您想要的分布的分数，而不是低于该分数。

`rand()`生成一个介于 0 和`RAND_MAX`（含）之间的值。`RAND_MAX`可能非常小 - 典型值为 32767。如果使用模 1000，则有 32 个值`rand()`返回映射到从 768 到 999 的每个值，以及 33 个映射到值 0 到 767 的值。所以这有点倾斜.

您似乎已经从空中拉出 1000 个。相反，如果您`RAND_MAX`按您想要的分布比例缩放自己，那么您不会得到倾斜效果，也不必处理 rand() 的输出来进行比较：

```
int main  () {
    srand (time(NULL));

    double subsRate = 0.003;  

    unsigned int nofRuns   = 1000000;

    int cutoff = (int) ( subsRate * ( (long) RAND_MAX + 1L ) );

    for (unsigned int i = 0; i < nofRuns ; i++) 
        if ( rand() < cutoff ) 
            cout << " Sub "  << endl; 

    return 0;
} 
```

# php - 文件主机的目录结构

> ID：613363
> 
> 赞同：3
> 
> 时间：2009-03-05T02:08:12.730
> 
> 标签：php, linux, filesystems

我有一个简单的文件主机，它为文件提供一个唯一的 ID，并将它们存储在一个目录中。有人告诉我，这将在未来引起问题，我想知道我应该注意什么以确保它在未来及以后顺利运行。

此外，通过发送标头信息和 readfile() 强制下载是否存在性能问题？保留文件名并允许使用直接下载不是使用脚本会更好吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T02:21:48.610

您被告知的这类问题很可能与将**成千上万个文件堆积在同一目录中对性能的影响有关**。

为了避免这种情况，不要将文件直接存储在一个目录下，而是**尝试将它们分散到子目录**（*存储桶*）下。

为了实现这一点，请查看您要存储的文件的 ID（例如 19873），并将其存储在 下`<uploads>/73/98/19873_<filename.ext>`，其中 73 是`ID % 100`， 98 是`(ID / 100) % 100`等等。

以上保证您将在下面最多有 100 个子目录`<uploads>`，并且下面最多还有 100 个子目录`<uploads>/*`。这将显着减少叶子中每个目录的文件数量。

两个级别的子目录足够典型，并且代表了在不浪费太多时间将目录或文件名解析为 inode 之间的良好平衡（当您在同一目录中查看太多文件名时会发生什么 - 尽管现代文件系统如在`ext3`这里将非常有效）和深度（当您必须深入 20 个子目录来查找您的文件时会发生什么）。您也可以选择使用更大或更小的值（10、1000）而不是 100。模 100 的两个级别对于 100k 和 5M 之间的文件是理想的

在给定需要检索的文件 ID 的情况下，使用相同的技术来计算文件系统上文件的完整路径。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T02:27:02.293

您的第一个问题实际上取决于您使用的文件系统的类型。我会假设 ext3 在回答时没有任何日志优化。

首先，是的，当文件数量超过系统 ARG_MAX 时，一个地方的许多文件可能会导致问题。换句话说， rm -rf * 会在抱怨太多参数时退出。您可能会考虑拥有目录 AZ / az 并根据其唯一名称中最左边字节的值适当地停放文件。

另外，尽量避免在短时间内打开所有这些文件的进程......一旦你真正开始填满，像'updatedb'这样的crons会导致问题。同样，尝试将这些目录排除在“查找”等命令的范围之外。

这导致了另一个潜在的问题，缓冲区。这些文件的访问频率如何？如果给定目录中有 300 个文件，是否每 30 分钟至少访问一次？如果是这样，您可能希望打开 /proc/sys/vfs_cache_pressure 设置，以便 Linux 将回收更多内存并使其可用于 PHP/Apache/Etc。

最后，关于 readfile ...我建议只使用直接下载链接。这避免了 PHP 在下载过程中必须保持活动状态。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T03:08:28.543

> 此外，通过发送标头信息和 readfile() 强制下载是否存在性能问题？

是的，如果你天真地这样做。一个好的文件下载脚本应该：

*   流式传输长文件以避免填充内存
*   支持 ETags 和 Last-Modified 请求/响应标头以确保缓存继续工作
*   提出合理的 Expires/Cache-Control 设置

它仍然不会像 Web 服务器那样快（它通常是用 C 语言编写的，并且针对提供文件进行了高度优化，甚至可能使用 OS 内核功能），但它会好得多。

> 保留文件名并允许使用直接下载不是使用脚本会更好吗？

它会表现得更好，是的，但是获得安全权利是一个挑战。请参阅[此处](https://stackoverflow.com/questions/602539/stop-people-uploading-malicious-php-files-via-forms/602904#602904)进行一些讨论。

一种折衷方案是使用重写，使 URL 看起来像：

```
hxxp://www.example.com/files/1234/Lovely_long_filename_that_can_contain_any_Unicode_character.zip 
```

但它在内部被重定向到：

```
hxxp://www.example.com/realfiles/1234.dat 
```

并由 Web 服务器（快速）提供。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T02:39:28.317

如果您可能有数千个文件，则应该将它们分布在许多子目录中。

我建议保留原始文件名，尽管您可能需要修改它以保证唯一性。这有助于您诊断问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T02:17:30.837

我认为我建议使用一些脚本来控制滥用。此外，我建议保留文件名，除非您的脚本将在数据库上创建与其原始状态相关的索引。您还可以尝试编写一个带有一些 Rewrite 魔法的脚本，这样可以通过不将背后的真实姓名（您的唯一 ID）暴露给最终用户来带来另一层安全性。

# python - 是否需要“使用严格”的 Python 编译器？

> ID：613364
> 
> 赞同：31
> 
> 时间：2009-03-05T02:08:25.273
> 
> 标签：python, perl, compiler-construction, static-analysis, use-strict

Python存在[静态分析工具](https://stackoverflow.com/questions/35470/are-there-any-static-analysis-tools-for-python)，但编译时检查往往与Python 所拥护的[运行时绑定理念](http://python-history.blogspot.com/2009/01/introduction-and-overview.html)截然相反。可以*使用*静态分析工具包装标准 Python 解释器来强制执行一些“[使用严格](http://perldoc.perl.org/strict.html)”类的约束，但我们没有看到这种东西被广泛采用。

Python 是否有某些东西使“使用严格”行为变得不必要或特别不受欢迎？

或者，尽管 Perl 被广泛采用，但“使用严格”行为是否不必要？

注意：“必要”是指“实际上必要”，而不是绝对必要。显然你*可以*不使用“use strict”来编写 Perl，但是（据我所见）大多数 Perl 程序员*确实*使用它。

注意：Python 解释器包装器不需要*类似*“use strict”的约束——您可以使用类似于“use strict”的伪编译指示，普通解释器会忽略它。我不是在谈论添加语言级别的功能。

* * *

更新：根据评论解释 Perl 中“使用严格”的作用。（官方文档的链接在第一段。）

“use strict”指令具有三个不同的组件，其中只有两个非常有趣：

*   use strict vars：静态检查程序中词法范围的变量使用情况。（请记住，在 Python 中，基本上只有`global`作用域和`local`作用域）。许多 Python linter 会检查这类事情。因为这是他们唯一可以做的静态分析，所以 linter 假设你使用简单的词法作用域，并警告你在这种意义上看起来错误的事情，直到你告诉他们闭嘴。IE

    ```
    FOO = 12
    foo += 3 
    ```

    如果您没有对命名空间做任何花哨的事情，这对于检查拼写错误很有用。

*   use strict refs：防止符号命名空间取消引用。Python 最接近的类比是使用`locals()`和`globals()`进行符号绑定和标识符查找。

*   使用严格的潜艇：Python 中没有真正的模拟。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-05T15:37:14.737

好吧，我不是一个 Python 程序员，但我会说答案是“是”。

任何允许您随时创建具有任何名称的变量的动态语言都可以使用“严格”编译指示。

Perl 中的严格变量（Perl 中的严格选项之一，“使用严格”将它们全部打开）要求在使用之前声明所有变量。这意味着这段代码：

```
my $strict_is_good = 'foo';
$strict_iS_good .= 'COMPILE TIME FATAL ERROR'; 
```

在编译时生成致命错误。

我不知道如何让 Python 在编译时拒绝此代码：

```
strict_is_good = 'foo';
strict_iS_good += 'RUN TIME FATAL ERROR'; 
```

您将得到一个`strict_iS_good`未定义的运行时异常。但仅在代码执行时。如果您的测试套件没有 100% 的覆盖率，您可以轻松发布此错误。

每当我使用一种没有这种行为的语言（例如 PHP）工作时，我都会感到紧张。我不是一个完美的打字员。一个简单但难以发现的错字可能会导致您的代码以难以追踪的方式失败。

因此，重申一下，**YES** Python 可以使用“严格”编译指示来打开编译时检查，以检查可以在编译时检查的内容。我想不出要添加的任何其他检查，但更好的 Python 程序员可能会想到一些。

**请注意**，我专注于 Perl 中 stict vars 的实用效果，并忽略了一些细节。如果您真的想了解所有详细信息，请参阅[perldoc for strict](http://perldoc.perl.org/strict.html)。

**更新：对一些评论的回应**

*Jason Baker*：像 pylint 这样的静态检查器很有用。但它们代表了一个可以并且经常被跳过的额外步骤。在编译器中构建一些基本检查可确保始终如一地执行这些检查。如果这些检查可以通过编译指示来控制，那么即使是与检查成本相关的反对意见也变得毫无意义。

*popcnt*：我知道 python 会生成运行时异常。我说了这么多。我提倡尽可能进行编译时检查。请重读帖子。

*mpeters*：没有任何计算机分析代码可以发现所有错误——这相当于解决了停机问题。更糟糕的是，要找到分配中的拼写错误，您的编译器需要知道您的*意图*并找到您的意图与代码不同的地方。这显然是不可能的。

然而，这并不意味着不应该进行检查。如果存在易于检测的问题类别，那么捕获它们是有意义的。

我对 pylint 和 pychecker 不够熟悉，无法说出它们会捕获哪些类型的错误。正如我所说，我对 python 非常缺乏经验。

这些静态分析程序很有用。但是，我相信除非它们复制编译器的功能，否则编译器将始终比任何静态检查器都能够“了解”更多关于程序的信息。尽可能不利用这一点来减少错误似乎很浪费。

**更新 2：**

cdleary - 理论上，我同意你的看法，静态分析器可以做任何编译器可以做的验证。在 Python 的情况下，它应该足够了。

但是，如果您的编译器足够复杂（尤其是如果您有很多编译指示会改变编译的发生方式，或者如果像 Perl 一样，您可以在编译时运行代码），那么静态分析器必须接近编译器/解释器的复杂性以做分析。

嘿，所有这些关于复杂编译器和编译时运行代码的讨论都显示了我的 Perl 背景。

我的理解是Python没有编译指示，不能在编译时运行任意代码。因此，除非我错了或添加了这些功能，否则静态分析器中相对简单的解析器就足够了。在每次执行时强制进行这些检查肯定会有所帮助。当然，我这样做的方式是使用编译指示。

一旦您将 pragma 添加到组合中，您就开始走下一个滑坡，并且分析器的复杂性必须与您在 pragma 中提供的功能和灵活性成正比。如果你不小心，你可能会像 Perl 一样结束，然后“只有 python 可以解析 Python”，这是我不想看到的未来。

也许命令行开关是添加强制静态分析的更好方法；）

（当我说 Python 不能像 Perl 那样适应编译时行为时，绝不是要批评 Python 的功能。我有一种预感，这是一个经过仔细考虑的设计决策，我可以从中看到智慧。Perl 的恕我直言，编译时的极大灵活性是该语言的一大优势和一个可怕的弱点；我也看到了这种方法的智慧。）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-05T02:54:53.507

Python 确实有一些可以改变脚本语法的东西：

```
from __future__ import print_function 
```

以及具有语法含义的各种其他未来功能。只是 Python 的语法比历史上的 Perl 更严格、更稳定、定义更明确；'strict refs' 和 'strict subs' 禁止的东西在 Python 中从未存在过。

'strict vars' 主要是为了阻止输入错误的引用和遗漏的 'my's 创建意外的全局变量（好吧，Perl 术语中的包变量）。这在 Python 中不会发生，因为裸分配默认为本地声明，裸未分配符号会导致异常。

（仍然存在这样的情况，即用户不小心尝试直写到全局而不使用“全局”语句声明它，从而导致意外的本地错误，或者更常见的是 UnboundLocalError。这往往很快就能学会，但它这是一个有争议的案例，必须声明你的本地人可能会有所帮助。尽管很少有经验丰富的 Python 程序员会接受可读性的负担。）

其他不涉及语法的语言和库更改通过[警告](http://docs.python.org/library/warnings.html)系统处理。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-05T03:36:24.453

“Python 所拥护的运行时绑定哲学......使得“使用严格”的行为变得不必要 [并且] 特别不受欢迎”

很不错的总结。谢谢。

基本上就是这样。静态分析工具对 Python 的帮助不足以值得。

* * *

**编辑**

“我要求我们反思*为什么*我们不需要它，以及为什么 Perl 程序员认为他们确实需要它。”

原因正是你已经给出的原因。我们不需要它，因为它没有帮助。显然，你不喜欢这个答案，但没有什么可说的了。编译时或预编译时检查根本没有帮助。

但是，由于您花时间再次提出问题，我将为您已经给出的答案提供更多证据。

我写 Java 的次数几乎和我写 Python 的次数一样多。Java 的静态类型检查并不能防止任何逻辑问题；它不利于满足性能要求；它无助于满足用例。它甚至不会减少单元测试的数量。

虽然静态类型检查确实会发现偶尔滥用方法的情况，但您在 Python 中也能很快发现这一点。在 Python 中，您会在单元测试时找到它，因为它不会运行。注意：我并不是说通过大量聪明的单元测试发现错误类型，我是说大多数错误类型问题是通过未处理的异常发现的，在这些异常中，事情根本无法运行到足以测试断言。

Pythonistas 不在静态检查上浪费时间的原因很简单。我们不需要它。它没有提供任何价值。这是一个没有经济利益的分析水平。它不再使我能够解决真实的人在使用真实数据时遇到的实际问题。

查看与语言（不是问题域或库）相关的最流行的 SO Python 问题。

[“foo is None”和“foo == None”之间有什么区别吗？](https://stackoverflow.com/questions/26595/is-there-any-difference-between-foo-is-none-and-foo-none)——`==`对`is`。没有静态检查可以帮助解决这个问题。另外，请参阅[Python 中的 `==` 和 `is` 之间有区别吗？](https://stackoverflow.com/questions/132988/is-there-a-difference-between-and-is-in-python)

[**（双星）和*（星）对参数有什么作用？](https://stackoverflow.com/questions/36901/what-does-and-do-for-python-parameters)--`*x`给出一个列表，`**x`给出一个字典。如果您不知道这一点，那么当您尝试执行不适合这些类型的操作时，您的程序会立即终止。“如果你的程序从不做任何‘不恰当’的事情怎么办？”。然后你的程序就可以工作了。'纳夫说。

[如何在 Python 中表示“枚举”？](https://stackoverflow.com/questions/36932/whats-the-best-way-to-implement-an-enum-in-python)——这是对某种有限域类型的请求。具有类级别值的类几乎可以完成这项工作。“如果有人更改作业怎么办”。易于构建。重写`__set__`以引发异常。是的，静态检查可能会发现这一点。不，实际上不会有人对枚举常量和变量感到困惑。当他们这样做时，很容易在运行时发现。“如果逻辑永远不会被执行怎么办”。嗯，这是糟糕的设计和糟糕的单元测试。抛出编译器错误并放入从未测试过的错误逻辑并不比从未测试过的动态语言中发生的事情更好。

[生成器表达式与列表理解](https://stackoverflow.com/questions/47789/generator-expressions-vs-list-comprehension)——静态检查无助于解决这个问题。

[为什么 1+++2 = 3？](https://stackoverflow.com/questions/470139/why-does-12-3-in-python)-- 静态检查不会发现这一点。尽管进行了所有编译器检查，C 中的 1+++2 是完全合法的。它在 Python 中与在 C 中不同，但同样合法。同样令人困惑。

[列表列表的变化意外地反映在子列表中](https://stackoverflow.com/questions/240178/unexpected-feature-in-a-python-list-of-lists)——这完全是概念性的。静态检查也无助于解决这个问题。Java 等价物也会编译并表现不佳。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-05T12:27:03.430

从我看到的评论来看，我认为“使用严格”的做法有些混乱。它不会打开编译时类型检查（就像 Java 一样）。从这个意义上说，Perl 程序员与 python 程序员是一致的。正如 S.Lott 上面所说，这些类型的检查不能防止逻辑错误，不要减少您需要编写的单元测试的数量，而且我们也不是束缚编程的忠实拥护者。

以下是“use strict”的作用列表：

1.  使用符号引用是一个运行时错误。这可以防止你做疯狂（但有时有用的事情，比如）

    `$var = 'foo';`

    `$foo = 'bar';`

    `print $$var; # this would contain the contents of $foo unless run under strict`

2.  使用未声明的变量是一个运行时错误（这意味着您需要在使用之前使用“my”、“our”或“local”来声明变量的范围。

3.  所有的barewords都被认为是编译时语法错误。裸词是没有被声明为符号或子程序的词。这主要是为了取缔历史上做过但被认为是错误的事情。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-11-10T00:28:43.933

这个原始答案是正确的，但也许不能从实际意义上解释这种情况。

> Python 存在静态分析工具，但编译时检查往往与 Python 所拥护的运行时绑定理念截然相反。

Perl 中的 'use strict' 提供了确保拼写错误或变量名（通常）在编译时被捕获的能力。这确实提高了代码的可靠性，并加快了开发速度。但是为了让这样的事情有价值，你需要声明变量。而 Python 风格似乎不鼓励这种做法。

因此，在 Python 中，您永远不会发现变量拼写错误，除非您在运行时注意到您认为自己所做的赋值没有被执行，或者表达式似乎解析为意外的值。捕捉此类错误可能非常耗时，尤其是当程序变大时，以及人们被迫维护他人开发的代码时。

Java 和 C/C++ 更进一步，包括类型检查。动机是实际的，而不是哲学的。如何尽快捕获尽可能多的错误，并确保在将代码发布到生产环境之前消除所有错误？每种语言似乎都采取了特定的策略并根据他们认为重要的内容来运行它。在像 Perl 这样不支持运行时绑定的语言中，利用“use strict”来简化开发是有意义的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-05T12:25:19.517

Python 没有真正的词法作用域，所以严格的变量不是很明智。它没有符号引用 AFAIK，因此不需要严格的引用。它没有裸词，因此不需要严格的变量。

老实说，我想念的只是词汇范围。另外两个我认为是 Perl 中的疣。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-05T02:57:31.660

正如您所暗示的，我认为`'use strict'`in Perl 更像是一个编译指示：它改变了编译器的行为。

Perl 语言哲学不同于 python 哲学。就像在 Perl 中，你得到了足够多的绳子来反复吊死自己。

Larry Wall 对语言学很感兴趣，所以我们从 Perl 中得到了所谓的 TIMTOWDI（比如`tim-toe-dee`）原理与 python 的 Zen：

> 应该有一种——最好只有一种——明显的方法来做到这一点。

你可以很容易地使用 pylint 和 PyChecker 来提出你自己的`use strict`for python 风格（或类似的东西`perl -cw *scriptname*`），但由于语言设计中的不同理念，你不会在实践中广泛遇到这种情况。

根据您对第一张海报的评论，您熟悉 python 的`import this`. 里面有很多东西可以说明为什么你`use strict`在 Python 中看不到类似的东西。如果你冥想《Python 之禅》中的*公案*，你可能会为自己找到启迪。:)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-05T19:25:17.403

我发现我只关心检测对未声明变量的引用。Eclipse 通过 PyDev 集成了 pylint，虽然 pylint 远非完美，但它在这方面做得很合理。

它确实有点违背 Python 的动态特性，当我的代码变得聪明时，我确实不得不偶尔添加#IGNOREs。但我发现这种情况很少发生，我对此很满意。

但是我可以看到一些类似 pylint 的功能以命令行标志的形式变得可用。有点像 Python 2.6 的 -3 开关，用于识别 Python 2.x 和 3.x 代码之间的不兼容点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-18T23:44:44.347

在 Perl 中不使用“use strict”来编写大型程序是非常困难的。如果没有'use strict'，如果你再次使用一个变量，并且因为遗漏了一个字母而拼错了它，程序仍然可以运行。如果没有测试用例来检查你的结果，你永远找不到这样的错误。由于这个原因，找出您得到错误结果的原因可能非常耗时。

我的一些 Perl 程序由 5,000 到 10,000 行代码组成，分成几十个模块。如果没有“使用严格”，就无法真正进行生产编程。我绝不允许使用不强制“变量声明”的语言在工厂中安装生产代码。

这就是为什么 Perl 5.12.x 现在将“use strict”作为默认行为。您可以关闭它们。

由于没有强制执行变量声明，PHP 给了我很多问题。所以你需要限制自己使用这种语言的小程序。

只是一个意见...

abc解析

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2014-08-06T03:10:24.523

正如他们所说，Perl 是一种无拘无束的语言 :) 。所以你可以在宣布之前使用变量；例如：如果你使用 var name "is_array" 但输入 "is_arrby" ，编译器不会在没有 "use strict" 的情况下报告错误。因此，在 perl 中编写长程序时，最好使用“use strict”语句。当然，运行一次脚本少于 50 行，没有必要:)

# .net - 可以使用 TextBox 和 Label 创建 ToolStripMenuItem 吗？

> ID：613372
> 
> 赞同：3
> 
> 时间：2009-03-05T02:13:59.673
> 
> 标签：.net, winforms, user-interface

在 WinForms .Net 2.0 应用程序中，我想创建一个带有 ToolStripMenuItem 的上下文菜单，该菜单在项目本身中具有标签和文本框。可以在 Access 中找到我正在谈论的示例 - 查看 Access 表时，上下文菜单具有“按选择过滤”、“过滤排除选择”和“过滤为：_ _ _ _ _ _ ”。第三个选项本质上是单个项目中的标签和文本框。这是我不知道该怎么做。

我用两个*单独*的 ToolStripMenuItems 来实现这个没有问题——一个用于文本，然后是一个只有文本框的子项。但这很尴尬，而且不如 Access 中的实现好看。

谁能指出我正确的方向？我在搜索时遇到了麻烦，因为我发现的所有内容似乎都与文本框本身的上下文菜单有关。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T08:35:22.457

这里给你一个答案：

[如何：使用 ToolStripControlHost](http://msdn.microsoft.com/en-us/library/9k5etstz.aspx)
[ToolStripControlHost 类包装 Windows 窗体控件](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripcontrolhost.aspx)

而且，我写了一个简短的演示（请记住，它看起来很可怕，因为我根本没有设计它）：

（我更喜欢VB.net，你没有指定你喜欢哪种语言）

```
Public Class ToolStripEntry
    Inherits ToolStripControlHost

    Public Sub New()
        MyBase.New(New ControlPanel)

    End Sub

    Public ReadOnly Property ControlPanelControl() As ControlPanel
        Get
            Return CType(Me.Control, ControlPanel)
        End Get
    End Property

End Class

Public Class ControlPanel
    Inherits Panel

    Friend WithEvents txt As New TextBox  //with events so you can just use the events
    Friend WithEvents lbl As New Label    //don think you can just do that in c#, but you get the idea

    Public Sub New()

        lbl.Anchor = AnchorStyles.Left Or AnchorStyles.Top Or AnchorStyles.Bottom
        lbl.Text = "Test"
        lbl.TextAlign = ContentAlignment.MiddleLeft
        lbl.Size = New Size(30, Me.Height)          //think of somthing!
        lbl.Location = New Point(0, 0)
        lbl.Parent = Me

        txt.Anchor = AnchorStyles.Left Or AnchorStyles.Right Or AnchorStyles.Top
        txt.Location = New Point(lbl.Right, 0)
        txt.Width = Me.Width - txt.Left
        txt.Parent = Me

    End Sub

End Class 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2022-01-14T18:44:40.750

**更通用的解决方案：**

```
 public abstract class CaptionControl<T> : FlowLayoutPanel where T: Control, new()
{
    public new Windows.Forms.Label With {.AutoSize = true, .Anchor == AnchorStyles.None, .Text == "Label"} Label
    {

    Public ReadOnly Property ControlMain() As new T();

    Public Property Caption As string;
        get
        {
            return Label.Text;
        }
        set
        {
            if (value != Label.Text)
            {
                Label.Text = value;
            }
        }
    }

    public CaptionControl()
    {

        this.Dock = DockStyle.Top;
        //Me.Bounds = Parent.ClientRectangle

        this.FlowDirection = FlowDirection.LeftToRight;
        this.WrapContents = false;
        this.Anchor = AnchorStyles.Left | AnchorStyles.Right;

        this.Controls.Add(Label);
        this.Controls.Add(ControlMain);

        ControlMain.Anchor = AnchorStyles.Left | AnchorStyles.Right;
        ControlMain.Dock = DockStyle.Top;

        // Me.Controls.Add(flp)

    }

}
public class CaptionTextBox : CaptionControl<TextBox>
{
    public TextBox TextBox
    {
        get
        {
            return ControlMain;
        }
    }
}
public class CaptionNumericUpdown : CaptionControl<NumericUpDown>
{
    public NumericUpDown Numericupdown
    {
        get
        {
            return ControlMain;
        }
    }
} 
```

**其次是：**

```
 <System.ComponentModel.DesignerCategory("Code")>
    <System.Windows.Forms.Design.ToolStripItemDesignerAvailability(System.Windows.Forms.Design.ToolStripItemDesignerAvailability.All)>
    Public Class ToolstripCaptionTextBox
        Inherits ToolStripControlHost
        Public Sub New()
            MyBase.New(New CaptionTextBox)

        End Sub
        ''' <summary>Create a strongly typed property called MainControl - handy to prevent casting everywhere.</summary>
        <DesignerSerializationVisibility(DesignerSerializationVisibility.Content)>
        Public ReadOnly Property HostedTextBox As CaptionTextBox
            Get
                Return TryCast(Control, CaptionTextBox)
            End Get
        End Property

    End Class 
```

ETC...

# mysql - MySQL 中每个表的更多主/自动添加唯一 ID？

> ID：613386
> 
> 赞同：0
> 
> 时间：2009-03-05T02:22:00.917
> 
> 标签：mysql, primary-key

MySQL 中的每个表是否可以有两个或多个主要/自动添加的唯一 ID？例如：

主键 (INT,11);shop_id;invoice_id

```
1;200;2001
1;201;2011
2;200;2002
2;201;2012 
```

是否可以将其设置为 MySQL 表？-> 所以表中还有一些其他值的主键.. ?

我正在一张表中寻找更多的自动增量。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T04:36:37.273

[您是否在多列索引的辅助列上](http://dev.mysql.com/doc/refman/5.1/en/example-auto-increment.html)寻找AUTO_INCREMENT ？您可以对 MyISAM 表执行此操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T02:54:09.140

在 MySQL 中，每个表只能有一个 AUTO_INCREMENT 列。在 MySQL 的表中只能有一个 PRIMARY 键，但它可以是复合键并且包含多个列。

但是从您给出的示例来看，您似乎要求的是不同的东西。你能澄清一下吗？

# algorithm - 如何从 UML 状态图中获取所有组合

> ID：613392
> 
> 赞同：0
> 
> 时间：2009-03-05T02:26:22.170
> 
> 标签：algorithm, uml

我有一个简单的 UML 状态图，我想从中获取所有可能组合的列表。有人知道可以为我做这件事的程序或算法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T03:23:34.157

对于单个状态图（例如，对于单个类），只需将它们从图中枚举出来。

对于具有非耦合转换的多个状态图，它只是笛卡尔积（也称为中文菜单）——您可以使用嵌套循环迭代各种独立枚举来生成它。

但如果它们是耦合的，事情就会变得更加棘手。虽然在一个设计良好的系统中几乎总是可以列举出可能的组合，但它通常是一个无法解决的问题（称为停机问题）。可能的状态将是简单笛卡尔积的子集，但使用通用算法可能无法确定*哪个子集。*

这就是您提供的细节（或缺乏细节）所能说的一切。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T16:56:42.830

这取决于您对组合的实际含义......可能状态的组合，还是通过状态图的所有路径？或者您在状态图中是否有并发/正交区域，以便您能够枚举状态图的不同并发配置？

# asp.net - detailsview：自动调用插入或编辑模式

> ID：613403
> 
> 赞同：1
> 
> 时间：2009-03-05T02:32:22.423
> 
> 标签：asp.net, detailsview, sqldatasource

表结构如下：

```
id int identity
firstname varchar(100) 
lastname varchar(100) 
```

我有一个在 profile.aspx 页面上显示/插入/更新名字姓氏的详细信息视图控件。

如果客户以查询字符串中的 id 登陆此页面，那么我希望它通过 sqldatasource 将该记录加载到详细信息视图中并启用编辑按钮。

如果客户在查询字符串中没有 id 的情况下登陆此页面，那么我希望它通过 sqldatasource 将名字/姓氏记录的空白显示到详细信息视图中，并启用插入按钮。

我怎么做到这一点？？？

请帮忙...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T17:56:38.060

在您的 Page_Load 中设置一个条件

```
Page_Load
{

check query string and find empID

If (empID != null)
{

detailsView1.ChangeMode(DetailsViewMode.Edit);
}
else
{

detailsView1.ChangeMode(DetailsViewMode.Insert);
}

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T05:38:57.170

如果传入了 ID，请使用此方法将 DetailsView 弹出到编辑模式：

```
 Dim theID As Int32 = Request.QueryString("id")
    If Not theID Is Nothing Then
        SqlDataSource.SelectParameters("THE_ID").DefaultValue = theID
        SqlDataSource.DataBind()
        DetailsView.ChangeMode(DetailsViewMode.Edit)
    End If 
```

只需对“没有传入 ID”的情况进行一些额外的调整。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T05:02:01.440

阅读此[使用 ASP.NET 2.0 SqlDataSource 更新数据库](http://www.aspfree.com/c/a/ASP.NET/More-Ways-to-Update-Databases-using-ASPNET-20-SqlDataSource/2/)

使用以下代码检查是否有传入的 id 是否使用他的数据填充字段。

```
int EmpID = 0;

if (Request.Querystring.Get("EmpID") != null) 
{ 
    id = Page.Request.QueryString["EmpID"];
    //load your values
} 
```

# apache-flex - 相同数据的不同过滤数据提供者？

> ID：613410
> 
> 赞同：1
> 
> 时间：2009-03-05T02:36:37.637
> 
> 标签：apache-flex, actionscript-3, arraycollection, objectdataprovider

我有几个查找表，其中一些是指其他人之间的关系。

例如，我有`membership type included inventory`其中的会员 ID 和库存类型 ID，并且是当一个人获得特定类型的会员资格时获得的每种库存类型的数量。

当用户查看库存类型时，我希望他们查看每种会员类型的金额；当用户查看会员类型时，我希望他们查看该会员将获得哪些库存。

我可以对 InvetoryType 实例仅使用一个 ArrayCollection，对 MembershipType 实例仅使用一个 ArrayCollection，并以某种方式创建过滤器来获取数据的不同“视图”吗？

每个“视图”都需要自己的光标、排序顺序、过滤器等。

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T22:31:54.247

您可以将单个`Array`实例与多个`ArrayCollection`实例一起使用。如果您只是显示数据，或者使用提供的方法/属性进行排序和过滤`ArrayCollection`（而不是`Array`直接编辑），它应该对底层 shared 没有影响`Array`。

# c# - 视觉工作室速成版功能

> ID：613415
> 
> 赞同：0
> 
> 时间：2009-03-05T02:39:45.680
> 
> 标签：c#, visual-studio

你知道 Visual Studio 2005/2008 的速成版是否支持从 C# 调用托管 C++ 代码吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T02:42:03.320

是的，它确实。

Visual Studio 的表达式版本绝不限制语言。这些语言本身就是 Visual Studio 的一项功能，并且在 Visual Studio 的非免费版本之间具有 100% 的对等性。您在 SO 上看到的任何代码都可以在 VS 的表达式版本中编译得很好。

事实上，如果你不喜欢 VS（你怎么了 :) ），你可以将编译器作为 SDK 的一部分单独下载，然后从命令行执行所有操作。

VS 的表达式版本和非免费版本的区别在于与 IDE 捆绑在一起的工具。例如，探查器和某些 TFS 产品在 VS 的免费版本中不可用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T02:48:23.117

您将需要通过 Express Editions 跳过一个额外的环节，因为它们不会将所有语言捆绑到一个包中。您需要为每种语言类型创建单独的 SLN，然后通过外部参考连接它们（即，任意 DLL）。

# c++ - Winsock：C++ 中的 Windows 网络编程

> ID：613423
> 
> 赞同：2
> 
> 时间：2009-03-05T02:42:19.090
> 
> 标签：c++, windows, sockets

我需要在 C++ 中真正解释 Windows 中的套接字的书籍，我一直在看教程，但他们没有说明什么意味着他们没有详细介绍，所以我需要有关 Windows 的 C++ 中 Winsock 的书籍

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T02:45:36.773

这是迄今为止最好的、最新的书：[Microsoft Windows 的网络编程](https://rads.stackoverflow.com/amzn/click/com/0735615799)。本书的优点之一是它展示了从阻塞套接字到完成端口的样式范围。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T02:51:59.707

这本教科书有点过时，它不是特定于 Windows 的，但它确实深入介绍了套接字：[Unix Network Programming, Volume 1](https://rads.stackoverflow.com/amzn/click/com/013490012X "Unix网络编程")。Winsock 是 Microsoft 对 Berkeley Sockets 的采用，因此教科书中的大部分功能也可以在 Winsock 中使用。

希望这可以帮助 ：）。

# c# - 从 C# 备份和恢复 SQL Server 表

> ID：613427
> 
> 赞同：0
> 
> 时间：2009-03-05T02:49:32.240
> 
> 标签：c#, asp.net, sql-server

在我正在构建的 web 应用程序中，我需要从 SQL Server 数据库中备份和恢复大约 10-15 个表。

我的解决方案..

-备份：对于每个表，填充一个数据集，将其序列化到一个文件中

-Restore：将文件反序列化为数据集并使用 SQLBulkCopy

这是实现我的目标的最佳方式吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T02:57:46.043

您可以使用 SQLSMO 备份/恢复整个 SQL Server 数据库。John Papa 的这篇[文章](http://msdn.microsoft.com/en-us/magazine/cc163409.aspx)详细介绍了它。

您还可以以编程方式对数据库运行 BACKUP/RESTORE 命令。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T02:54:05.023

您不能简单地在（备份）数据库表之间来回移动/复制数据吗？为什么要处理文件？

IMO 数据库几乎可以肯定是存储备份数据的最佳场所。它可能在同一个数据库中（客户>>客户Bak），或者您可以拥有一个将数据复制到的小型数据库。

恢复数据时可能会遇到两个问题：

1）正如三宝提到的，身份列。

2) 与其他表的外键约束可能不同步并阻止您刷新原始表

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T03:49:52.377

您需要确保考虑以下事项。

1.  当架构改变时会发生什么？如何升级数据？
2.  如果任何表具有标识列，则需要确保在加载数据之前进行标识插入。
3.  注意触发器，根据您的设置，它们可能会在批量加载期间触发，也可能不会触发。

# linq - DataContext Refresh 和 PropertyChanging & PropertyChanged 事件

> ID：613428
> 
> 赞同：2
> 
> 时间：2009-03-05T02:50:32.800
> 
> 标签：linq, linq-to-sql, datacontext, inotifypropertychanged

我处于从外部来源获悉某个特定实体已在我当前数据上下文之外更改的情况。我能够找到实体并像这样调用刷新

MyDataContext.Refresh(RefreshMode.OverwriteCurrentValues, myEntity);

并且实体上已更改的属性已正确更新。但是，当刷新发生时，INotifyPropertyChanging INotifyPropertyChanged 似乎都没有出现，这使我的 UI 显示不正确的信息。

我知道 Refresh() 未能在实体上使用正确的属性获取器和设置器来引发更改通知事件，但也许还有另一种方法可以完成同样的事情？

难道我做错了什么？有没有比刷新更好的方法？如果刷新是唯一的选择，有没有人可以解决？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-04-22T13:49:51.963

我有一个类似的问题。我绑定到 TreeView 并且需要调用 Refresh 以响应用户取消编辑操作。该`Refresh()`方法乖乖地将所有原始值放回原处，但这并没有反映在我的TreeView UI中。在咨询了全能的谷歌之后，我遇到了这个解决方案：

```
CollectionViewSource.GetDefaultView(treeViewClusters.ItemsSource).Refresh(); 
```

这似乎迫使我的 TreeView 更新所有内容。唯一的缺点（这是一个非常大的缺点）是它似乎折叠了所有的树节点，这导致用户失去了他们的位置。我也可以将 my 设置`ItemsSource`为 null 并再次返回...效果相同，尽管如果您有一堆绑定的文本框或其他东西，这种方法会更简单，因为您不需要重新绑定每个文本框。

还有比这更好的解决方案吗？

***编辑：是的，有...***

我的一个比我聪明的同事想出了这个解决方案，这似乎可以解决问题。在 Linq2Sql 对象的分部类中，添加以下代码：

```
public void SendPropertiesChanged()
{
     foreach (System.Reflection.PropertyInfo prop in this.GetType().GetProperties())
     SendPropertyChanged(prop.Name);
} 
```

您可以在应用程序代码中调用它：

```
context.Refresh(RefreshMode.OverwriteCurrentValues, employee);
employee.SendPropertiesChanged(); 
```

所有 UI 元素都会收到消息，并适当地更新自己。这甚至适用于树视图控件以及您不希望 UI 在刷新绑定时出现“重置”的情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T03:10:35.387

如果你知道调用 Refresh()，那为什么不直接刷新 UI 呢？

通过在 LINQtoSQL DBML 生成的实体类上调用 setter 来调用 PropertyChanging 和 PropertyChanged。调用 Refresh() 不会这样做：

```
[Column(Storage="_DisplayName", DbType="VarChar(50) NOT NULL", CanBeNull=false)]
public string DisplayName
{
    get
    {
        return this._DisplayName;
    }
    set
    {
        if ((this._DisplayName != value))
        {
            this.OnDisplayNameChanging(value);
            this.SendPropertyChanging();
            this._DisplayName = value;
            this.SendPropertyChanged("DisplayName");
            this.OnDisplayNameChanged();
        }
    }
} 
```

# iphone - 如何对 iPhone 应用商店评论提出质疑？

> ID：613430
> 
> 赞同：12
> 
> 时间：2009-03-05T02:52:58.333
> 
> 标签：iphone

我在应用商店有一个应用程序。我已向应用程序提交了 3 个更新。这 3 个更新中有 2 个已被拒绝，原因是自原始提交以来根本没有改变。

我知道他们每次审核我的申请时都有不同的人。

然而，净效应是：

*   我如何有效地对评论提出异议？我每次都回复评论回复电子邮件，但从未收到回复。如果我没有客户期望错误修复和更新，我会按原样重新提交并期待不同的审阅者。
*   是否有任何电话号码或其他方式可以实际与人交谈？最近的拒绝是基于可笑的“侵犯苹果商标”。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T03:17:24.437

我遇到了类似的更新被拒绝的问题。即使当前的商店应用程序存在相同的问题，您仍然必须解决拒绝问题。

我知道与真人交谈的唯一方法是支付 199 美元购买 ADC 支持票。

由于这似乎是 App Store 的现实，它影响着每个人。因此，在 Apple 解决问题并扩大规模时，我们的客户、客户和用户将不得不忍受我们。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-05T22:57:31.917

听从他们的建议，保持礼貌。即使您可能不同意他们对 UI 元素使用等更主观的项目的看法，但请听取他们的建议并调整您的应用程序以匹配。从第一天开始，您的应用程序中是否存在某些内容并不重要。我有一个表格视图，它在不应该的时候不正确地保留了一个选择，这是从 App Store 推出时就已经存在的东西。当他们指出时，我纠正了错误，几天后申请通过了审查。有时候，你真的是罪魁祸首。

如果在返工后您仍然收到拒绝并​​且不知道如何解决它，请写一个清晰，礼貌的回复审阅者，要求澄清和可能的建议。抵制跑出去的冲动，开始向全世界大喊苹果专门压制你和你的创新。从长远来看，这只会伤害你。请记住，在 From: 地址的另一端有真实的人。

任何接触过美国专利制度的人都会在这里找到相似之处。有时你会得到一位专利审查员，他会挑选出你提交的文件中的每一个元素，有时你会得到一份带有荒谬广泛的权利要求的专利。在这两种情况下，您都在与需要整理大量申请的组织打交道（尽管专利局的限制要严格得多）。我发现与一个组织合作的耐心和接受变化的意愿在与另一个组织打交道时会有所帮助。

除此之外，它还有助于培养与 Apple 员工的关系。他们确实想为您提供帮助，他们的工程师是非常乐于助人的人。WWDC 即将到来，是了解这些工程师以及其他 Apple 主办的技术活动的好地方。如果你在公司内为你的工作培养了一个倡导者，那肯定会对审查过程有所帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-05T03:08:34.427

你没有。你不能。你只需要重新提交。

它是应用商店最大的问题之一。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-09T04:18:39.870

我见过一些人抱怨这一点，就好像一个应用程序滑过第一个评论者的事实在某种程度上给了他们一个先例。

将 App Store 评论者视为测试者。如果您将应用程序的连续版本交给测试，您是否会声称在第二轮测试中发现的错误因为第一次被遗漏而有权存在？

他们正在根据 UI 和业务指南测试您的应用程序，就像他们还查看它是否崩溃一样认真。我会感谢你的关注范围——这是保证应用程序交付的 iPhone 不会喷出太多不一致的一种方法！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T03:11:20.690

这是 Apple 反馈系统存在的较大问题之一。没有办法“修复”可怜的观众。

# asp.net - 是否可以即时将 ASP.NET 控件转换为图片？

> ID：613441
> 
> 赞同：2
> 
> 时间：2009-03-05T02:58:59.347
> 
> 标签：asp.net, wpf, bitmap, gdi

在 ASP.NET 中，如果我有一个多行文本框（甚至是第 3 方富文本框），我可以在回发期间将其内容转换为图片吗？通过转换，我的意思是保留图片中的格式和内容。

例如，我有一个富文本编辑框，最终用户可以直接在上面添加花哨的文本字体和符号，一旦他们点击“提交”，有没有办法将这个富文本内容保存为位图？还是有这样一个具有此内置功能的第 3 方富编辑框？

我猜它可能需要 GDI+ 或 WPF，但只是不知道从哪里开始。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T15:05:18.830

我不确定先前的答案是否解决了您的问题。您想捕捉最终用户（即浏览器）窗口中显示的内容，对吗？然后您想将 BMP 发布回您的服务器。据推测，您想要这样做是因为最终用户可能拥有您没有的字体支持等，或者您希望他们将此图像显示给没有它们的其他用户。

我很确定这在浏览器中是不可能的。这听起来也应该很困难（我不希望看到可以轻松捕获桌面窗口区域并将其发布回来的网站）。我怀疑您正在编写自己的 ActiveX/Silverlight/Flash 控件，但您应该考虑这样做是否明智 - 您是否可以控制浏览器（换句话说，您能否保证浏览器版本和您的用户拥有的操作系​​统）？如果没有，您可能会发现在操作系统/浏览器矩阵的所有部分上运行屏幕捕获控件比它的价值更多。

也许如果您扩展您的问题，可以找到更好的解决方案，或者更有可能找到完全不同的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T03:01:53.880

这是一个非常讨厌、丑陋的代码示例，但它一次性涵盖了所有概念：[如何使用 ASP.NET 即时创建 (a) 文本图像](http://www.codeproject.com/KB/web-image/AspNetCreateTextImage.aspx)。

本质上，这是通过创建一个新的[System.Drawing.Bitmap](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx)并使用[System.Drawing.Graphics.DrawString(text)](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.drawstring.aspx)来完成的。它需要估计绘制的字符串有多大，并确保你的画布足够大；设置字体等，但总的来说，只要你做几次就很简单了。

# sql - SQL Server 2000 奇数插入触发器行为——递归类似

> ID：613447
> 
> 赞同：0
> 
> 时间：2009-03-05T03:04:38.303
> 
> 标签：sql, sql-server, triggers

我在 SQL Server 2000 的表中有一个触发器，这是触发器：

```
ALTER Trigger [dbo].[Set_Asignado_State] ON [dbo].[Tables] 
FOR INSERT AS 
BEGIN           
    DECLARE @area varchar(1)
    SELECT @area = Table_Area_ID FROM inserted

    IF (@area = 'L')
    BEGIN
        INSERT INTO Table_History
        SELECT  (SELECT TOP 1 Table_Area_Id AS Table_Area_Id FROM inserted) AS Table_Area_Id,
                (SELECT SUBSTRING( CAST( YEAR( GETDATE() ) AS VARCHAR), 3, 2) ) AS Table_Year, 
                (SELECT TOP 1 Table_Seq AS Table_Seq FROM inserted) AS Table_Seq, 
                (SELECT TOP 1 ID FROM Table_Status WHERE Description = 'Asignado') AS Status, 
                '' AS Responsible, 
                (SELECT TOP 1 OrigDept FROM inserted) AS User_Responsible, 
                GETDATE() AS [DateTime],
                'None' AS Comments
        FROM Tables
        WHERE Tables.Table_Area_Id = (SELECT TOP 1 Table_Area_Id AS Table_Area_Id FROM inserted) AND
              Tables.Table_Year = (SELECT SUBSTRING(CAST(YEAR(GETDATE()) AS VARCHAR), 3, 2) )

        IF @@ERROR <> 0
        BEGIN
            DECLARE @errorMsg NVARCHAR(256)
            SET @errorMsg = @@ERROR; 

            PRINT 'Error Inserting in Table_History'

        END
    END
END 
```

现在，当他们在“表”中插入一条记录时，会调用触发器，但它会继续在 Table_History 上插入很多很多记录。

我和我的同龄人谈过，似乎没有任何问题！=S 有什么线索吗？难道我做错了什么？

提前感谢=）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T03:54:19.027

Table_History 表上是否有另一个触发器插入到表中？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T04:19:07.610

触发器是基于设置的，因此
`IF (@area = 'L')` 只会查看插入表中的第一条记录。尝试将检查添加为 WHERE 子句的一部分：

```
WHERE Tables.Table_Area_Id = (SELECT TOP 1 Table_Area_Id AS Table_Area_Id FROM inserted) AND
              Tables.Table_Year = (SELECT SUBSTRING(CAST(YEAR(GETDATE()) AS VARCHAR), 3, 2) )  
 AND SUBSTRING(Tables.Table_Area_Id, 1, 1) = 'L' 
```

您确定主 Select 语句只返回一行吗？我注意到您广泛使用了 Top(1) 限定符。如果它返回不止一行，那么将有不止一行插入到您的历史表中。

也许作为一个盲目的镜头，尝试为最外层的选择放入 Top(1)：

```
 INSERT INTO Table_History
    SELECT TOP(1) (SELECT TOP 1 ... 
```

否则，看起来好像您在触发器中进行了一些递归。我看不到它，但如果你愿意，你可以关闭整个数据库的递归触发，因为它是一个数据库选项。

# asp.net-mvc - 当我尝试在同一解决方案中将 MVC Futures 库与 ASP.NET MVC 源代码一起使用时出错

> ID：613451
> 
> 赞同：0
> 
> 时间：2009-03-05T03:07:52.337
> 
> 标签：asp.net-mvc

尝试在同一解决方案中同时使用 MVC Futures 库 (Microsoft.Web.Mvc) 和 ASP.NET MVC 源代码时出现以下错误：

'System.Web.Mvc.Controller' 类型在未引用的程序集中定义。您必须添加对程序集“System.Web.Mvc，Version=1.0.0.0，Culture=neutral，PublicKeyToken=31bf3856ad364e35”的引用。

我在 Web.config 文件中删除了 GAC 对 System.Web.Mvc 的引用，以便项目将使用对 MVC 源代码的项目引用。知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T13:02:18.697

我认为问题在于您的应用程序和您使用的 Futures 库版本引用了 System.Web.Mvc 程序集的不同版本。您需要仔细检查每个程序集，并确保依赖关系对齐。这可能需要获取新版本的 Futures 或从 GAC 中删除 System.Web.Mvc，具体取决于您发现的问题的确切性质。

我要对这个问题提出异议：

> 我在 Web.config 文件中删除了 GAC 对 System.Web.Mvc 的引用，以便项目将使用对 MVC 源代码的项目引用。

删除它似乎并不总是阻止 ASP.NET 编译器（不同于 VS 编译器）在 GAC 中查找 MVC 程序集。我们在尝试使使用 RC 1 和 Preview 5 构建的项目共存时遇到了这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T03:16:12.160

如果您删除对 MVC Futures 程序集的引用，这是否有效？据我所知，`Microsoft.Web.Mvc`命名空间不会覆盖`System.Web.Mvc.Controller`类，因此不应该与实际的 MVC 程序集冲突。

# wpf - 如何让 Expander 向上扩展

> ID：613455
> 
> 赞同：0
> 
> 时间：2009-03-05T03:08:39.557
> 
> 标签：wpf, expander

我有一个 dataGrid 和一个扩展器，如下所示：

```
<Grid>
    ...
    <DataGrid ....>
    <Expander ...>
</Grid> 
```

我希望数据网格尽可能大，扩展器在开始时尽可能小。当用户单击扩展器时，我希望它向上扩展而不是向下扩展，并使数据网格缩小。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T03:21:02.477

您可以在Grid中定义行高，然后将扩展器放在最下面一行，然后让网格对其进行排序。

* - 此高度为一个单位，其中总高度除以单位数并分配。因此，如果高度为 300 并且有两行 2* 和 *，那么它们将分别为 200 和 100。

**自动**- 这是内容的最小高度。

```
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <Canvas Grid.Row="0" Background="LightBlue" />
    <Expander Grid.Row="1">
        <Canvas Background="LightGreen" Height="200" />
    </Expander>
</Grid> 
```

# wpf - WPF ListBoxItem 未填充

> ID：613464
> 
> 赞同：1
> 
> 时间：2009-03-05T03:15:04.270
> 
> 标签：wpf, listbox

在列表框中，当我选择一个项目时，我的列表框周围仍然会出现某种边框或空间，从而创建您在图像中看到的线条。我想删除我在周围圈的那条线。

顺便说一句，它已经有了`HorizontalContentAlignment = "Stretch"`。

我究竟做错了什么？

### 问题：

![替代文字](https://lh3.ggpht.com/_ZjKW281-SXM/Sa9CsgxF42I/AAAAAAAAAMg/a2uH99NzAlA/FillProblem.jpg)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T03:26:24.693

我认为这是 ListBox 中的一个错误。下面是我如何让我的项目模板伸展以填充 ListBox 的宽度。使每个列表项的容器成为一个单元格网格，并使用网格加载事件调用将网格拉伸到 ListBox 宽度的方法。

```
<ListBox x:Name="lvHolePatterns"  ItemsSource="{Binding HolePatterns}"
                              SelectedItem="{Binding ActivePattern, Mode=TwoWay}"
                              HorizontalContentAlignment="Stretch"
                              ScrollViewer.VerticalScrollBarVisibility="Visible"
                              Background="Gray">

<ListBox.ItemTemplate>
    <DataTemplate>
        <Grid Loaded="StretchFrameworkElement">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition />
            </Grid.RowDefinitions>
            <Border Margin="0,3,5,3" BorderThickness="1" BorderBrush="SlateGray" CornerRadius="4"
                RenderTransformOrigin="0.5,0.5" HorizontalAlignment="Stretch" >
                <Border.Background>
                    <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                        <GradientStop Color="#FF000000" Offset=" 1"/>
                        <GradientStop Color="#FF396DBE" Offset="0"/>
                    </LinearGradientBrush>
                </Border.Background>
                <StackPanel Orientation="Vertical" >
                    <TextBlock FontWeight="Bold" Text="{Binding Path=PatternName}" Foreground="WHITE" VerticalAlignment="Center"  Margin="5,5,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="5,0,0,5">
                        <TextBlock Text="{Binding Path=HoleCount}" Margin="10,0,0,0" Foreground="WHITE" VerticalAlignment="Center"/>
                        <TextBlock Text=" Holes" Margin="3,0,0,0" Foreground="WHITE" VerticalAlignment="Center"/>
                        <CheckBox Content="Visible" IsChecked="{Binding Visible, Mode=TwoWay}" Foreground="WHITE" Margin="10,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </DataTemplate>
</ListBox.ItemTemplate>
</ListBox> 
```

然后，添加此方法来处理网格加载事件：

```
private void StretchFrameworkElement(object sender, RoutedEventArgs e)
{
    // found this method at: http://silverlight.net/forums/p/18918/70469.aspx#70469
    FrameworkElement t = sender as FrameworkElement;
    ContentPresenter p = VisualTreeHelper.GetParent(t) as ContentPresenter;
    p.HorizontalAlignment = HorizontalAlignment.Stretch;       
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T03:40:35.643

马特是对的，因为这是一个错误。填充是在 ListBox 模板中硬编码的，而不是绑定到您可以更改的属性。

解决此问题的最佳方法是重新定义模板，如下所示：

```
<ListBox>
    <ListBox.Template>
        <ControlTemplate TargetType="{x:Type ListBox}">
            <Border 
                SnapsToDevicePixels="true" 
                x:Name="Bd" 
                Background="{TemplateBinding Background}" 
                BorderBrush="{TemplateBinding BorderBrush}" 
                BorderThickness="{TemplateBinding BorderThickness}" 
                Padding="0"> <!-- This was originally 1 -->
                <ScrollViewer 
                    Focusable="false" 
                    Padding="{TemplateBinding Padding}">
                    <ItemsPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                </ScrollViewer>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsEnabled" Value="false">
                    <Setter 
                        Property="Background" 
                        TargetName="Bd" 
                        Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                </Trigger>
                <Trigger Property="IsGrouping" Value="true">
                    <Setter 
                        Property="ScrollViewer.CanContentScroll" 
                        Value="false"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
    </ListBox.Template>

    <ListBoxItem>Item1</ListBoxItem>
    <ListBoxItem>Item2</ListBoxItem>
    <ListBoxItem>Item3</ListBoxItem>
</ListBox> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T04:40:12.817

这是我的应用程序的 WPF 版本中的 ListView。ListView DataTemplate 使用Border，它会自动延伸到ListView 的宽度。不需要像上面的 Silverlight 答案那样的额外方法。

```
<ListView x:Name="lvHolePatterns" ItemsSource="{Binding Path=HolePatterns}"
                              SelectedItem="{Binding Path=ActivePattern}"
                              IsSynchronizedWithCurrentItem="True"
                              HorizontalContentAlignment="Stretch"
                              ScrollViewer.VerticalScrollBarVisibility="Visible"
                              Background="Gray">
    <ListView.ItemContainerStyle>
        <Style BasedOn="{StaticResource lvRowHighlighter}" TargetType="{x:Type ListViewItem}">
            <!--<Setter Property="Height" Value="50" />-->
        </Style>
    </ListView.ItemContainerStyle>
    <ListView.ItemTemplate>
        <DataTemplate>
            <Border Margin="0,3,5,3" BorderThickness="1" BorderBrush="SlateGray" CornerRadius="4" RenderTransformOrigin="0.5,0.5">
                <Border.Background>
                    <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                        <GradientStop Color="#FF000000" Offset=" 1"/>
                        <GradientStop Color="#FF396DBE" Offset="0"/>
                    </LinearGradientBrush>
                </Border.Background>
                <StackPanel Orientation="Vertical">
                    <TextBlock FontWeight="Bold" Text="{Binding Path=PatternName}" Foreground="WHITE" VerticalAlignment="Center"  Margin="5,5,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="5,0,0,5">
                        <TextBlock Text="{Binding Path=HoleCount}" Margin="15,0,0,0" Foreground="WHITE" VerticalAlignment="Center"/>
                        <TextBlock Text=" Holes" Margin="3,0,0,0" Foreground="WHITE" VerticalAlignment="Center"/>
                        <CheckBox Content="Visible" IsChecked="{Binding Path=Visible}" Foreground="WHITE" Margin="10,0,0,0" />
                </StackPanel>
                </StackPanel>
            </Border>
        </DataTemplate>
    </ListView.ItemTemplate>
</ListView> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-08T21:11:48.127

只需将其添加到文本框实例属性中：

```
HorizontalContentAlignment="Stretch" 
```

无需任何代码即可完成这项工作。

吉利

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-30T23:18:06.233

我发现了一个非常简单的解决列表框项中硬编码填充问题的方法：将数据模板中最外层元素的边距设置为 -1

——海农

# x11 - 任何人仍然直接使用 xlib 编程

> ID：613470
> 
> 赞同：7
> 
> 时间：2009-03-05T03:18:42.187
> 
> 标签：x11, xlib

我对我在 SO 上遇到的所有与 xlib 相关的问题都没有回应感到惊讶，这是因为没有人再直接使用 xlib 了，还是这是问这些类型问题的错误地方？即使没有人直接使用 xlib，但仍然有人会记住过去的糟糕时光并帮助解决这些问题，但看起来他们并不在这里......

编辑：我还可以在哪些其他地方寻求与 xlib 相关的帮助？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-05T03:46:30.560

不，XLib 在这里肯定是一个有效的主题，但我认为您的第一个论点是正确的：几乎没有人再使用它了。我隐约记得大约十五年前使用它，我把它比作：

*   用锤子拔掉你的牙齿。
*   尝试不先切菠萝就吃。
*   将果冻钉在树上。
*   试图训练家猫。

（选择你最喜欢的）。

我怀疑经常访问此站点的 PHP/Silverlight/.NET/Python 组不会很快回答这种问题。您可能需要等待几天，直到对主题更了解的人注意到它。

抱歉，我对具体问题无能为力（我假设您的意思是没有点画的多边形填充物 - 如果不是，请告诉我是哪一个（带有链接），我会快速浏览一下）。

其他寻求帮助的地方：

*   [http://www.linuxforums.org/forum/linux-programming-scripting/](http://www.linuxforums.org/forum/linux-programming-scripting/)
*   [http://www.linuxquestions.org/questions/](http://www.linuxquestions.org/questions/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T15:32:23.297

获得 xlib 帮助的可能方法：

*   [http://freedesktop.org/](http://freedesktop.org/)（和邮件列表）
*   的开发者
    *   窗口管理器
    *   ui 工具包 ( [Qt](http://qt.nokia.com/) , [Gtk+](http://gtk.org/) )

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T04:09:24.217

不，没有那么多。我最近在 2003 年做过 Motif，但仅此而已。当时，其中大部分都被重量级的 Java Swing 应用程序所取代。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-08T09:02:25.703

我正在使用它！

我和朋友一起写的... [http://open.vitaminap.it/en/x_tile.htm](http://open.vitaminap.it/en/x_tile.htm)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-14T23:51:21.383

我[直接](http://github.com/sidorares/node-x11)使用 X11 协议（这有点类似于使用 xlib 关于你的问题）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-11-19T14:52:09.717

我使用 xlib 创建 tk 画布项目。 [http://www.tcl.tk/man/tcl8.4/TkLib/CrtItemType.htm](http://www.tcl.tk/man/tcl8.4/TkLib/CrtItemType.htm)

# python - 以编程方式发现公共 IP

> ID：613471
> 
> 赞同：27
> 
> 时间：2009-03-05T03:18:42.560
> 
> 标签：python, ip-address, tcp

我在路由器后面，我需要一个简单的命令来发现我的公共 IP（而不是谷歌搜索我的 IP 并单击一个结果）

是否有任何标准协议？我听说过 STUN 但我不知道如何使用它？

PS我打算写一个简短的python脚本来做

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-05T04:47:07.480

这可能是最简单的方法。解析以下命令的输出：

1.  运行 traceroute 以查找距离您的计算机不到 3 跳的路由器。
2.  使用选项运行 ping 以记录源路由并解析输出。记录路由中的第一个 IP 地址是您的公共 IP 地址。

例如，我在一台 Windows 机器上，但同样的想法也应该适用于 unix。

```
> tracert -d www.yahoo.com

Tracing route to www-real.wa1.b.yahoo.com [69.147.76.15]
over a maximum of 30 hops:

  1    <1 ms    <1 ms    <1 ms  192.168.14.203
  2     *        *        *     Request timed out.
  3     8 ms     8 ms     9 ms  68.85.228.121
  4     8 ms     8 ms     9 ms  68.86.165.234
  5    10 ms     9 ms     9 ms  68.86.165.237
  6    11 ms    10 ms    10 ms  68.86.165.242 
```

68.85.228.121 是 Comcast（我的提供商）路由器。我们可以ping通：

```
> ping -r 9 68.85.228.121 -n 1

Pinging 68.85.228.121 with 32 bytes of data:

Reply from 68.85.228.121: bytes=32 time=10ms TTL=253
    Route: 66.176.38.51 ->
           68.85.228.121 ->
           68.85.228.121 ->
           192.168.14.203 
```

瞧！66.176.38.51 是我的公共 IP。

**执行此操作的 Python 代码**（希望适用于 py2 或 py3）：

```
#!/usr/bin/env python

def natIpAddr():
  # Find next visible host out from us to the internet
  hostList = []
  resp, rc = execute("tracert -w 100 -h 3 -d 8.8.8.8") # Remove '-w 100 -h d' if this fails

  for ln in resp.split('\n'):
    if len(ln)>0 and ln[-1]=='\r': ln = ln[:-1]  # Remove trailing CR
    if len(ln)==0: continue
    tok = ln.strip().split(' ')[-1].split('.') # Does last token look like a dotted IP address?
    if len(tok)!=4: continue
    hostList.append('.'.join(tok))
    if len(hostList)>1: break  # If we found a second host, bail

  if len(hostList)<2:
    print("!!tracert didn't work, try removing '-w 100 -h 3' options")
    # Those options were to speed up tracert results

  else:
    resp, rc = execute("ping -r 9 "+hostList[1]+" -n 1")
    ii = resp.find("Route: ")
    if ii>0: return resp[ii+7:].split(' ')[0]
  return none     

def execute(cmd, showErr=True, returnStr=True):
  import subprocess
  if type(cmd)==str:
    cmd = cmd.split(' ')
  # Remove ' ' tokens caused by multiple spaces in str             
  cmd = [xx for xx in cmd if xx!='']
  proc = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
  out, err = proc.communicate()
  if type(out)==bytes:  # Needed for python 3 (stupid python)
    out = out.decode()
    try:
      err = err.decode()
    except Exception as ex: 
      err = "!!--"+str(type(ex))+"--!!"

  if showErr and len(err)>0:
    out += err
  if returnStr and str(type(out))=="<type 'unicode'>":
    # Trying to make 'out' be an ASCII string whether in py2 or py3, sigh.
    out = out.encode()  # Convert UNICODE (u'xxx') to string
  return out, proc.returncode

if __name__ == "__main__":
  print("(This could take 30 sec)")
  print(natIpAddr()) 
```

从命令行（在 Windows 上）或 python 程序中使用它：

```
import natIpAddr
myip = natIpAddr.natIpAddr()
print(myip) 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-05T03:26:16.660

我制作了一个连接到[http://automation.whatismyip.com/n09230945.asp](http://automation.whatismyip.com/n09230945.asp)的程序， 它是用 D 编写的，让别人告诉你他们看到你的 ip 是什么，这可能是最可靠的方法：

```
/*
    Get my IP address
*/

import tango.net.http.HttpGet;
import tango.io.Stdout;

void main()
{
      try
      {
          auto page = new HttpGet ("http://automation.whatismyip.com/n09230945.asp");
          Stdout(cast(char[])page.read);
      }
      catch(Exception ex)
      {
          Stdout("An exception occurred");
      }
} 
```

编辑python代码应该是这样的：

```
from urllib import urlopen
print urlopen('http://automation.whatismyip.com/n09230945.asp').read() 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2016-02-10T14:00:15.983

我喜欢[ipify.org](https://ipify.org)：

*   它可以免费使用（甚至以编程方式，甚至允许大量流量）
*   响应仅包含 IP 地址，没有任何垃圾（无需解析）
*   您还可以请求 JSON 格式的响应
*   适用于 IPv4 和 IPv6
*   它托管在云中
*   它是开源的

```
$ curl api.ipify.org
167.220.196.42

$ curl "api.ipify.org?format=json"
{"ip":"167.220.196.42"} 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-05T04:30:19.907

针对 www.whatsmyip.org 是不礼貌的。他们请求不要在页面上这样做。

只有与目标处于同一 NAT 级别的系统才能看到相同的 IP。例如，您的应用程序可能位于多层 NAT 之后（当您远离 IP 过剩的美国时，这种情况发生得更多）。

STUN确实是最好的方法。一般来说，您应该计划在您的应用程序可以要求的某个地方运行（STUN）服务器：不要硬编码其他人的服务器。您必须编写代码以发送一些特定的消息，如 rfc5389 中所述。

我建议好好阅读和相关链接。 [http://www.ietf.org/html.charters/behave-charter.html](http://www.ietf.org/html.charters/behave-charter.html)

您可能更喜欢查看 IPv6 和 Teredo，以确保您始终拥有 IPv6 访问权限。（有人告诉我，Microsoft Vista 让这变得非常简单）

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-05T03:20:57.000

每当我想这样做时，我都会抓取[whatismyip.org](http://whatismyip.org)。当您访问该站点时，它会为您提供纯文本公共 IP。干净利落。

只需让您的脚本访问该站点并读取 IP。

我不知道您是否在帖子中暗示了这一点，但是不可能从您自己的计算机上获取您的公共 IP。它必须来自外部来源。

**2013 年编辑：此站点现在返回图像而不是文本，因此对此没有用处。**

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-09T21:54:33.890

正如一些人提到的，[STUN](http://en.wikipedia.org/wiki/STUN)确实是正确的解决方案。

*   [公共 STUN 服务器](http://www.voip-info.org/wiki-STUN)列表
*   免费软件[STUN 客户端](http://sourceforge.net/projects/stun/)
*   STUN[标准](http://www.ietf.org/rfc/rfc5389.txt)

[`pynat`这是一个使用Python 模块](https://github.com/arantonitis/pynat)的代码示例：

```
>>> import pynat
>>> pynat.get_ip_info()
('UDP Firewall', '192.0.2.2', 54320) 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-05-22T17:57:52.287

**编辑**： curlmyip.com 不再可用。（感谢 maxywb）

**原帖**：

在撰写本文时，curmyip.com 有效。从命令行：

```
curl curlmyip.com 
```

这是一个第三方网站，几年后可能会也可能不会。但就目前而言，这似乎很简单，也很中肯。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-05T03:22:34.970

您最简单的方法可能是询问网络外部的某个服务器。

要记住的一件事是，不同的目的地可能会为您看到不同的地址。路由器可能是多宿主的。实际上，这正是问题开始的地方。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-05T03:52:25.833

如果网络有一个在网关上运行的 UpNp 服务器，您可以与网关通信并询问您的外部 IP 地址。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-02-27T17:22:34.870

要获取您的外部 IP，您可以使用特殊主机名“myip.opendns.com”对 opendns 服务器进行 dns 查询：

```
from subprocess import check_output

ip = check_output(["dig", "+short", "@resolver1.opendns.com",
                   "myip.opendns.com"]).decode().strip() 
```

在 Windows 上，您可以尝试`nslookup`.

Python stdlib 中没有允许指定自定义 dns 服务器的 dns 模块。您可以使用第三方库，例如[Twisted](https://twistedmatrix.com/trac/)进行 dns 查询：

```
from twisted.internet     import task # $ pip install twisted
from twisted.names.client import Resolver
from twisted.python.util  import println

def main(reactor):
    opendns_resolvers = [("208.67.222.222", 53), ("208.67.220.220", 53)]
    resolver = Resolver(servers=opendns_resolvers, reactor=reactor)
    # use magical hostname to get our public ip
    return resolver.getHostByName('myip.opendns.com').addCallback(println)
task.react(main) 
```

这是相同的使用[`dnspython`库](http://www.dnspython.org/)：

```
import dns.resolver # $ pip install dnspython

resolver = dns.resolver.Resolver(configure=False)
resolver.nameservers = ["208.67.222.222", "208.67.220.220"]
print(resolver.query('myip.opendns.com')[0]) 
```

这是`asyncio`使用[`aiodns`库](https://github.com/saghul/aiodns)的变体：

```
$ pipenv install aiodns
$ pipenv run python -m asyncio
...
>>> import asyncio
>>> import aiodns  # pip install aiodns
>>> resolver = aiodns.DNSResolver()
>>> resolver.nameservers = "208.67.222.222", "208.67.220.220"
>>> await resolver.query("myip.opendns.com", "A")
[<ares_query_a_result> host=192.0.2.2, ttl=0] 
```

获取 IPv6 地址：

```
>>> resolver.nameservers = "2620:119:35::35", "2620:119:53::53"
>>> await resolver.query("myip.opendns.com", "AAAA") 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-01-25T23:51:58.203

`curl api.infoip.io`- 完整的细节

`curl api.infoip.io/ip`- 只是IP地址

`curl api.infoip.io/country`- 只是国家名称

......还有更多相同的

[您可以在http://docs.ciokan.apiary.io/](http://docs.ciokan.apiary.io/)查看文档

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-02-06T14:32:38.440

我正在与您分享我无需使用外部 API 即可检索服务器公共 IP 地址的方法（这当然是一个安全风险）

```
INTERFACE=`ip route get 8.8.8.8 | grep 8.8.8.8 | cut -d' ' -f5`
HOSTIP=`ifconfig $INTERFACE | grep "inet " | awk -F'[: ]+' '{ print $4 }'` 
```

或者如果您愿意，可以在 python 中：

```
import subprocess
public_ip = subprocess.check_output(["ifconfig `ip route get 8.8.8.8 | grep 8.8.8.8 | cut -d' ' -f5` | grep \'inet \' | awk -F'[: ]+' '{ print $4 }'"], shell=True) 
```

它是这样工作的：

*   确定到达 google dns 服务器的最佳接口
*   `ifconfig`从该接口的条目中greps 公共 IP

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-03-04T11:57:47.987

以下是一些支持 IPv4 和 IPv6 的公共服务：

*   `curl http://icanhazip.com`
*   `curl http://www.trackip.net/ip`
*   `curl https://ipapi.co/ip`
*   `curl http://api6.ipify.org`
*   `curl http://www.cloudflare.com/cdn-cgi/trace`
*   `curl http://checkip.dns.he.net`

以下似乎目前仅支持 IPv4：

*   `curl http://bot.whatismyipaddress.com`
*   `curl http://checkip.dyndns.org`
*   `curl http://ifconfig.me`
*   `curl http://ip-api.com`
*   `curl http://api.infoip.io/ip`

以编程方式进行 HTTP 调用很容易。因此，所有这些都应该相对容易使用，并且您可以尝试多个不同的 URL，以防万一失败。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-11-16T20:10:49.977

Duck Duck Go 根据他们自己的页面在这里免费访问他们的 API： [https ://duckduckgo.com/api](https://duckduckgo.com/api)

如果您想要您的 IP 地址，请点击以下 URL： [http ://api.duckduckgo.com/?q=my+ip&format=json](http://api.duckduckgo.com/?q=my+ip&format=json)

这将返回一个 JSON 对象。该`Answer`属性有一个人类可读的字符串，其中包含您的 IP 地址。例子：

```
{
    ...
    "Answer": "Your IP address is ww.xx.yyy.zzz in <a href=\"http://open.mapquest.com/?q=aaaaa(bbbbb)\">aaaaa(bbbbb)</a>"
    ...
} 
```

`split()[4]`如果您认为可以安全地假设该字符串永远不会更改或者您愿意需要定期修复它，则可以使用 来从该字符串中提取 IP 地址。

或者，如果您想要一个更面向未来的方法，您可以遍历返回的所有内容`split()`并返回第一项是 IP 地址。请参阅此处以验证 IP 地址： [如何在 Python 中验证 IP 地址？](https://stackoverflow.com/q/319279/901641)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2011-03-04T21:13:42.287

另一种厚颜无耻的方式：如果您的路由器可以选择在[DynDNS](http://dyn.com/dns/)上更新其网络 IP ，您可以通过以下方式获得自己的 IP：

```
IP=`resolveip -s myalias.dyndns-home.com` 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2018-07-06T02:38:51.637

现在托管您自己的“无服务器”API 非常便宜。所有主要的云提供商都为此提供服务。例如，使用 Google Cloud Functions 只需：

```
exports.requestIP = (req, res) => {
    res.status(200).send(req.ip)
} 
```

这种方法可能比使用上面的公共服务更可靠，您可以在函数名称中添加一个长随机字符串以使其保持私有。

# c++ - 在哪里可以找到 C++ 语言的标准 BNF 或 YACC 语法？

> ID：613479
> 
> 赞同：23
> 
> 时间：2009-03-05T03:24:22.233
> 
> 标签：c++, yacc, bnf

我正在尝试开发一种代码生成器来帮助对遗留的 C/C++ 混合项目进行单元测试。我没有发现任何一种独立的工具可以从声明中生成存根代码。所以我决定建一个，应该不会那么难。

拜托，任何人都可以给我一个标准的语法链接，用 yacc 语言更好地描述。

希望我不是在重新发明轮子，在这种情况下请帮助我。

最好的问候，凯文

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-05T03:37:43.747

来自[C++ FAQ Lite](http://www.parashift.com/c++-faq-lite/)：

[38.11 有 yacc-able C++ 语法吗？](http://www.parashift.com/c++-faq-lite/compiler-dependencies.html#faq-38.11)

> 您需要的主要 yacc 语法来自 Ed Willink。Ed 相信他的语法完全符合[ISO/ANSI C++ 标准](http://www.parashift.com/c++-faq-lite/big-picture.html#faq-6.13)，但他不保证：“语法没有，”他说，“被用于愤怒。” 您可以获得[没有动作例程](http://www.computing.surrey.ac.uk/research/dsrg/fog/CxxGrammar.y)的语法或[带有虚拟动作例程的语法](http://www.computing.surrey.ac.uk/research/dsrg/fog/CxxTester.y)。您还可以获得[相应的 lexer](http://www.computing.surrey.ac.uk/research/dsrg/fog/CxxLexer.l)。对于那些对他如何实现无上下文解析器感兴趣的人（通过推动所有歧义以及在解析完成后进行少量修复），您可能需要阅读[他论文](http://www.computing.surrey.ac.uk/research/dsrg/fog/FogThesis.pdf)的第 4 章。
> 
> 还有一个非常古老的 yacc 语法，它不支持模板、异常和名称空间；加上它以一些微妙的方式偏离了核心语言。[您可以在此处](http://www.empathy.com/pccts/roskind.zip)或[此处](http://srawgw.sra.co.jp/.a/pub/cmd/c++grammar2.0.tar.gz)获得该语法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-11-14T12:33:34.523

I've recently found some grammar files for C++ (C++ 1998: **ISO/IEC 14882:1998** and C++ 2008: **ISO/IEC SC22/WG21 N2723=08-0233**) at the [grammarware website](http://grammarware.github.com/zoo/#cpp). The grammars are represented in **Enahnced BNF, DMS BNF, BGF, SDF and Rascal** notation. It's a pity, though, that the C++ grammars don't seem to get updated (no C++2003 or C++11).

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T06:00:01.033

Jared 的链接是您可以获得的最接近上下文无关语法的东西。某些事情确实需要延迟到以后，但这是通过一些比 C++ 的上下文敏感语法更好的论点。

更糟糕的是，C++1x 将显着复杂化语法。为了达到对 C++ 的完美解析，解析器需要实现足够多的标准来正确进行重载解析，包括模板参数推导，这反过来又需要概念机制、lambdas，实际上几乎所有的语言，除了两阶段名称查找和异常规范，如果我没记错的话，不需要实际实现来成功解析程序。

实际上，如果你能解析 C++，你就已经完成了编译器的一半。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T03:41:35.203

我最近发现[了这个。](http://www.sigala.it/sandro/software.php#grammars)我还没有尝试过，所以不确定它是否有效。您能否提供有关您正在尝试开发的工具的更多信息？我下载了这个语法，因为我正在开发一个检测工具，这样我就可以为我的[单元测试框架](http://code.google.com/p/cunitwin32/)添加覆盖率信息。

重新阅读您的评论后...

我认为[这个工具](http://www.radwin.org/michael/projects/stubgen/)完全符合您的需求。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-07-26T04:20:03.297

对于另一种方法，您可以考虑搭载现有编译器。

[GCC-XML](http://www.gccxml.org/HTML/Index.html)会将 C++“编译”成包含大量有用信息的 XML 文件；这可能足以满足您的目的。

不幸的是，GCC-XML 只维护了 1/4，让它工作可能是……有趣的。祝你好运，如果你走这条路。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-17T15:13:38.593

我们的 DMS Software Reengineering Toolkit 可以通过功能强大的全功能 C++ 解析器获得。请参阅 [http://www.semanticdesigns.com/Products/FrontEnds/CppFrontEnd.html](http://www.semanticdesigns.com/Products/FrontEnds/CppFrontEnd.html) 这会构建 AST 和符号表，并且可以推断任何表达式的类型。DMS 使人们能够对 C++ 代码进行任意分析和转换。

一种“简单”的转换是检测代码以收集测试覆盖率数据；我们将其作为 COTS 工具提供。请参阅本文以了解 DMS 是如何做到的： [http ://www.semanticdesigns.com/Company/Publications/TestCoverage.pdf](http://www.semanticdesigns.com/Company/Publications/TestCoverage.pdf)

编辑 2013 年 9 月（这个答案有点陈旧）：DMS 的 C++ 解析器/名称解析/控制流分析在 ISO-、GNU- 和 Microsoft 变体中处理完整的 C++11。它还将解析（并保留）包含大多数预处理器条件的源代码。与 GCC 或 Clang 不同，它具有驱动解析过程的显式语法。

# svn - 如何让 TortoiseSVN 获取不在存储库中的文件列表？

> ID：613485
> 
> 赞同：17
> 
> 时间：2009-03-05T03:27:44.410
> 
> 标签：svn, tortoisesvn

TortoiseSVN 有没有办法获取不在存储库中的文件列表？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-05T03:31:58.910

右键单击 -> TortoiseSVN -> 检查修改

确保选中显示未版本控制的文件

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T03:55:00.273

我通常右键单击颠覆树的根并选择提交。在选择哪些文件的对话框中，它显示了已添加到工作副本但尚未添加到存储库的文件。请记住不要单击确定按钮。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T03:32:51.263

在任何本地项目目录中，您都可以运行 svn status。TortoiseSvn 中的等价物在[手册](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-wcstatus.html)中。带有 ? 标记对存储库是未知的。

# telnet - 如何自动化 telnet 端口 25 测试？

> ID：613508
> 
> 赞同：5
> 
> 时间：2009-03-05T03:44:29.457
> 
> 标签：telnet

我需要在 telnet 中进行大量测试。我正在研究一些方法来自动检测我们电子邮件服务器上的字典攻击，然后将它们限制回去，或者将它们列入黑名单等。

我现在准备进行一些测试，看看我的工作是否有回报。我想我会下载一些脚本小子应用程序来运行测试。我找不到任何东西，而那些我能找到的东西是坏的或二进制的和不可配置的。

我将有一个我在循环中生成的地址列表。

我想将 $address 作为参数并执行以下操作：

> telnet myserver.com 25 helo some-string.com mail from: me@me.com rcpt to: $address quit

其中，我需要测试一些东西，例如，如果我启用灰名单，我想使脚本失败，因为这是我的第一个对策。我想在那种情况下，我只会有 telnet 超时？

*   `helo`应该返回一个以 220 开头的代码字符串，这与我进行此测试所需的准确度差不多。

*   `mail from`应该返回 250，或者寻找 OK 就足够了

*   `rctp to`当我发送一个有效的用户时，有时应该返回 250 或 Ok，但大多数时候我会发送一个错误的地址，所以我寻找没有 250 或 OK。

*   最后，我将发送一个`quit`.

我无法在交互式情况下获得条件和日志记录。我看了看，`expect`但无法让它工作。

### 到目前为止我的代码：

```
echo -e "helo foo\nmail from: foo.... | telnet example.com 25 | grep -i blah 
```

这没有按预期执行。

我能做些什么来实现我的目标？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T03:58:05.633

试试 netcat： http: [//netcat.sourceforge.net/](http://netcat.sourceforge.net/)

它可以让您在套接字上发送和接收数据。telnet 不是您想要的——它是用于交互式使用的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T04:18:36.003

期望围绕netcat（而不是telnet）可能是最好的初始选择。但是，如果你真的需要这个，我会使用 perl。它有 SMTP 客户端库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T04:02:49.257

我很惊讶 Expect 没有为你做这件事，因为它只是为这类事情而写的。

Perl 在某些方面更简单，可以完成这样的工作。但是有了 Perl，你就不用 Telnet 了，你可以直接打开 25 端口。

如果您真的想锻炼您的服务器，请获取[Siege](http://www.joedog.org/index/siege-home)的源并将其修改为使用 SMTP 而不是 HTTP。那是我最喜欢的用于测试 Apache 性能的工具，我相信让它测试 Sendmail 不会太难。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-07-20T15:38:39.890

您可以为此使用 Bash 语法，例如

```
exec {stream}<>/dev/tcp/example.com/80
printf "GET / HTTP/1.1\nHost: example.com\nConnection: close\n\n" >&${stream}
grep Example <&${stream} 
```

这是另一个[从 memcached 转储键列表的](https://serverfault.com/a/674104)语法示例：

```
exec {memcache}<>/dev/tcp/localhost/11211; printf "stats items\nquit\n" >&${memcache}; cat <&${memcache} 
```

# web-services - 共享点网络服务

> ID：613512
> 
> 赞同：1
> 
> 时间：2009-03-05T03:46:47.250
> 
> 标签：web-services, sharepoint, sharepoint-2003

我有几个 Sharepoint 门户（Sharepoint Portal Server 2003 + SQL Server）正在运行，它们都应该共享一些公共数据。我计划使用两个单独的列表，并构建一个 Web 应用程序，负责通过 WSS 列表服务 ( [http://server/_](http://server/_) vti_bin/lists.asmx) 更新它们。我想知道这是否是一种常见的做法？我应该担心这种解决方案的可扩展性吗？- 该列表应该以每月约 3000 条记录的速度增长。

抱歉标题很差，我想不出更好的标题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T15:25:41.940

正如 Corey 所提到的，每个文件夹 2000（或 3000）个项目不是硬性限制，而只是推荐的限制。我相信每个文件夹或索引实际上是 2000/3000 个项目。因此，您也可以为列设置索引，并且如果每个索引值只有 2000 个或更少的项目，那么您也可以在推荐范围内。我之前有 40k 个项目没有文件夹，它仍然可以执行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T06:28:25.007

如果我正确理解您将要构建的 Web 应用程序不是 SharePoint Web 应用程序，它只是一个 ASP.NET Web 应用程序，它将调用 SharePoint 以使用您的应用程序可能收集的数据更新列表。

这是一个完全可以接受的方案，我认为这正是列表 Web 服务的用途。

您可能遇到的唯一棘手问题是，您是否必须将其中一个列表中的数据回传回您的 Web 应用程序。双向同步始终是一个棘手的检票口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T06:39:19.317

您**绝对**应该关注可伸缩性。在 WSS v3.0 中，每个容器（又名文件夹）只能（假设）存储 2000 个列表项。一个文件夹算作一个列表项。

如果您在每个文件夹中嵌套 2000 个项目，您可能会扩展到数百万个，但它仍然是存储数据的一种尴尬方式。

您仍然可以拉出所有项目，展平您创建的任何文件夹层次结构，以帮助您使用一些 CAML 进行扩展，但再次有查询大型列表的方法可以更好地扩展。我建议[阅读 Joel Oleson 在这里合并的资源](http://www.sharepointjoel.com/Lists/Posts/Post.aspx?ID=84)。

很抱歉，我找不到更具体的文档，**但我怀疑列表在 SPS 2003 中是否会更好地扩展**。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T14:38:40.757

The new recommendation is 3000 per container as Microsoft updated in this [white paper](http://download.microsoft.com/download/0/E/B/0EBA7263-A555-4279-B9DD-1720F0139A2E/SharePointOptimizationTWP.doc). This isn't actually a hard limit. It is just the maximum you can store before seeing a significant performance hit. With that many items, you will definitely want to come up with a strategy of splitting your list items into multiple folders.

Here is Microsoft's official link on [planning for software boundries](http://technet.microsoft.com/en-us/library/cc262787.aspx) although it hasn't been updated since the release of the white paper.

# windows - 如何使子进程窗口在我的进程中显示为模态？

> ID：613513
> 
> 赞同：8
> 
> 时间：2009-03-05T03:46:48.797
> 
> 标签：windows, winapi

我有一个应用程序，它调用其他一些实用程序应用程序来为特定设备设置一些设置。使用 ShellExecuteEx 调用该实用程序应用程序。

为了不混淆用户，最好将实用程序应用程序的窗口设置为我的主窗口。如何做到这一点？

我尝试过的事情：

1.  ShellExecuteEx，INFINITE TIMEOUT 之后的进程上的 WaitForSingleObjectEx - 窗口是模态的，但主应用程序不会重新绘制（因为它正在等待单个对象！）
2.  在 ShellExecuteEx 之后的进程上的 WaitForSingleObjectEx，一些小的超时，然后调用 Peekmessage 和 DispatchMessage - 现在重新绘制工作，但实用程序应用程序不再是“模态”。主应用程序响应鼠标点击、按钮点击等
3.  EnableWindow(FALSE)，然后执行方法 #2，然后 EnableWindow(TRUE) - WORKS!!!，但在此之后，我的应用程序的 z 顺序发生了变化。（它现在位于其他窗口下方）。为什么？！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T20:42:01.513

你有两件事要模拟：所有权和形式。

模拟所有权：您需要将新子进程窗口的所有者设置为您的窗口。这应该可以缓解任何 z 排序问题。虽然我不知道这是否适用于另一个进程。如果没有，那么您可能必须附加您的线程输入队列，然后调用它。或者使用其他一些代码注入技术。

```
SetWindowLong <target window handle>, GWL_HWNDPARENT, <new owner handle> 
```

为了模拟模态，我认为您使用 EnableWindow 和 WaitForSingleObjectEx 走在正确的轨道上。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T01:23:12.547

简短的回答是，即使线程在同一个进程中，也没有办法在线程 B 模式下无缝地为线程 A 中的窗口创建一个窗口。如果您拥有两个窗口的代码，您可能会接近，但在这种情况下，通过将所有 UI 放在一个线程中，您将获得更好的结果。

如果您尝试向用户建议线程 B 的窗口对于线程 A 是模态的，那么您必须正确处理许多微妙的 Z 顺序和激活行为（正如您已经注意到的），以免遭受 uncanny-valley 效应排序，用户很清楚线程 B 的窗口试图成为它不是的东西，因此似乎坏了。

为了避免这种情况，我会采取这种方法：

1.  用户在 canner.exe 的主窗口中单击“FDA 检查”。canner.exe 显示一个模式对话框，指示它正在打开一个外部程序（“正在打开肉毒杆菌中毒设置...”）。这会禁用主窗口等，以便用户知道正在发生模式交互。
2.  canner.exe调用[ShellExecuteEx](http://msdn.microsoft.com/en-us/library/bb762154(VS.85).aspx) ()来启动botulism.exe。
3.  canner.exe 在从 ShellExecuteEx() 返回的句柄上调用[WaitForInputIdle](http://msdn.microsoft.com/en-us/library/ms687022(VS.85).aspx) ()。当 botulsim.exe 准备好进行用户交互时，WaitForInputIdle() 将返回（大约，但通常足够接近）。如果 botulism.exe 通常需要 5 秒或更长时间来显示其 UI，我可能会在循环中使用 WaitforInputIdle() 的短暂超时，并偶尔使用 PeekMessage()/ProcessMessage() 处理任何待处理的消息。
4.  canner.exe 更改其对话框文本以反映它正在等待用户关闭 botulism.exe（“关闭 Botulism 设置以继续...”）。
5.  canner.exe 在循环中调用[MsgWaitForMultipleObjects](http://msdn.microsoft.com/en-us/library/ms684242(VS.85).aspx) () 以等待 botulsim.exe 关闭。当传递的句柄发出信号或线程队列中有消息等待时，MsgWaitForMultipleObjects() 将返回。
6.  如果用户在 canner.exe 等待时点击了 canner.exe 模态对话框中的关闭框，canner.exe 会提示用户 botulism.exe 仍在运行（“Botulism 设置仍然打开，是否继续？”，“是的，我知道”或“不，我还没说完”）。如果确认，canner.exe 将关闭对话框并取消在步骤 1 中开始的原始 FDA 检查并返回到主窗口的消息循环。
7.  当 MsgWaitForMultipleObjects() 指示 botulism.exe 已完成时，canner.exe 将关闭对话框并正常继续执行步骤 1 中开始的 FDA 检查。

这样，如果一切正常且快速地进行，交互很可能是无缝的，但如果子进程出现问题或 Z 顺序发生更改等，就会清楚为什么父进程正在等待以及用户在做什么需要取消或继续他开始的任务。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-11T14:09:22.633

EnableWindow 是正确的，这通常是消息框和其他“模式”窗口的操作方式。对于 zorder 变化，可以拦截 WM_WINDOWPOSCHANGING 消息并设置 SWP_NOZORDER 标志来防止 zorder 变化。确保仅在设置 EnableWindow(false) 时执行此操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-16T22:25:00.027

只是合乎逻辑的建议，
也许您可​​以创建**不可见的模态形式**，并从他那里使用方法＃1。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T20:18:54.110

让我们看一下您的方法＃3，它非常接近您想要的。我怀疑问题是当辅助应用程序关闭时，Windows 决定它不想将焦点恢复到禁用的窗口。您可以尝试在此之前重新启用您的窗口，但这可能会很棘手（而且不值得努力）。

不要直接禁用窗口，而是尝试通过忽略用户输入来禁用它。因此，与其调用 EnableWindow，不如更改您的消息循环以过滤掉输入消息。特别是，如果

```
msg >= WM_KEYFIRST || msg <= WM_KEYLAST || msg >= WM_MOUSEFIRST || msg <= WM_MOUSELAST 
```

然后丢弃该消息；否则，将其传递给正常的调度循环。您正在做的是创建自己的禁用窗口，但 Windows 不知道这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-01-21T17:57:23.450

试试这个。这会暂停调用者，直到子进程退出。

```
 private void btnChildApp_Click(object sender, EventArgs e)
    {
        Process p = Process.Start(@".\ChildApp.exe");
        p.WaitForExit();
    } 
```

# java - Tomcat 服务：wrapper.conf 中的引号

> ID：613514
> 
> 赞同：3
> 
> 时间：2009-03-05T03:48:18.793
> 
> 标签：java, tomcat, windows-services

我想从 Eclipse 设置远程调试。Tomcat 在 Windows 上作为服务运行。

这一点很好，一个快速的谷歌向我指出了正确的设置以添加到 wrapper.conf 以启用它。wrapper.conf 中已经有条目，所以我复制/粘贴了最后一个条目并对其进行了修改：

```
wrapper.java.additional.8="-Djava.endorsed.dirs=C:/Program Files/OurApp/tomcat/common/endorsed"
wrapper.java.additional.8.stripquotes=TRUE
wrapper.java.additional.9="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=9135,suspend=n"
wrapper.java.additional.9.stripquotes=TRUE 
```

它不起作用，因为引号围绕着所有内容，而带引号仅适用于 linux 系统。

理论上正确的条目应该是：

```
wrapper.java.additional.8=-Djava.endorsed.dirs="C:/Program Files/OurApp/tomcat/common/endorsed"
wrapper.java.additional.8.stripquotes=TRUE
wrapper.java.additional.9=-Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=9135,suspend=n 
```

第二个示例不需要引号 - 没有空格来分隔它。第一个例子是——因为“程序文件”我在这个评估中是正确的吗？

如果是这样，应用程序如何/为什么按原样工作？有几个参数表面上是这样设置的（嵌套在 qutoes 中），我认为实际上没有效果。
例如最小/最大内存设置。

[我在这里](http://cocoondev.org/books/daisy_docs_book--20070924-080121/publications/html-chunked/output/dsy331-cd.html)找到了一个具有相同内容的示例，表面上是 Windows 和 linux 的配​​置。

我的问题：这些引号会阻止配置命令通过吗？
如果是这种情况，为什么应用程序可以工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T23:23:29.857

在更多地玩耍和浏览调试日志之后，我想我已经隔离了这个问题。问题是 1 - 懒惰并将两个配置项放在同一行上的混合。[（在我的辩护中，我将它复制为Tomcat 常见问题](http://wiki.apache.org/tomcat/FAQ/Developing)2 中的一行 - 使用引号

这两者的结合导致了这个问题。

```
wrapper.java.additional.9="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=9135,suspend=n"
wrapper.java.additional.9.stripquotes=TRUE 
```

像这样它会生成一个命令行：

```
java "-Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=9135,suspend=n" ... 
```

它将整个字符串视为一个参数 - 而不是我想要的两个。

没有引号 wrapper.java.additional.9=-Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=9135,suspend=n wrapper.java.additional.9.stripquotes=TRUE 它会生成：

```
java -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=9135,suspend=n ... 
```

鉴于没有引号可以解决问题，它会按照我的意愿处理两个 -X 参数。作为两个单独的条目更好（并且可能是预期用途）

```
 wrapper.java.additional.9="-Xdebug" 
    wrapper.java.additional.9.stripquotes=TRUE
    wrapper.java.additional.10="-Xrunjdwp:transport=dt_socket,server=y,address=9135,suspend=n"
    wrapper.java.additional.10.stripquotes=TRUE

java "-Xdebug" "-Xrunjdwp:transport=dt_socket,server=y,address=9135,suspend=n" ... 
```

每个都有引号，并且单独对待它们。现有条目都很好，因为它们每行只设置一项。

因此，我将把它归结为一次学习经历（叹息），并意识到我现在对 wrapper.conf 的了解更多，而我以前不知道。

干杯，evnafets

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T06:16:59.167

我通过 *.bat 文件在 Eclipse 中使用远程调试。可能这对您来说会更简单。

完成步骤：

1.  下载 zip 文件中的 tomcat 安装并将所有文件复制到 bin 文件夹
2.  使用以下内容创建 debug.bat 文件

    设置 JPDA_ADDRESS=8000

    设置 JPDA_TRANSPORT=dt_socket

    调用 catalina.bat jpda 开始

如果您收到端口已在使用中的错误，请将 8000 更改为任何其他（8001、8002 等）。

从 Eclipse 方面：

1.  打开调试对话框
2.  新建远程 Java 应用程序（连接选项卡：主机 - localhost 或任何其他 IP 地址，端口 - 8000；源选项卡：添加所有源文件（例如，删除所有、添加 Java 项目、选择所有项目）
3.  推送调试
4.  在 Eclipse 中设置断点并尝试从 Tomcat 访问它们

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T12:08:26.700

如果您仍在寻找另一种解决方案，我会选择 tomcat6w.exe，它是用于配置 Windows 服务的对话框应用程序（在 tomcats bin 目录中可用）。我相信有一些选项可用于设置 jvm 参数，如您所说。这些选项将进入注册表，配置服务。

# sharepoint - MOSS (SharePoint) 发布页面计划选项未出现

> ID：613517
> 
> 赞同：0
> 
> 时间：2009-03-05T03:50:23.793
> 
> 标签：sharepoint, moss, site-definition

我正在为 MOSS 2007 构建自定义发布站点定义，但我似乎遇到了问题。我导入的内容类型没有任何可用的页面调度选项。

我已经查看了发布站点使用的文件旁边的 onet.xml（在 BLANKINTERNET 文件夹中），并且我正在添加标准文件中的所有功能。

我是发布定义场景的新手，所以我不太确定我做错了什么来放弃调度选项。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-08T21:31:20.693

不确定这是否有帮助，但也许可以给你一些方向。共有三个 BLANKINTERNET 模板：

1.  **BLANKINTERNET#0** Publishing site - 用于按计划发布网页并启用工作流功能的网站

2.  **BLANKINTERNET#1** 新闻稿网站

3.  **BLANKINTERNET#2** Publishing site with workflow - 使用审批工作流的网页发布网站

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T02:00:53.937

试试这个：[http ://weblogs.asp.net/jan/archive/2007/01/11/how-to-enable-scheduled-publishing-in-a-moss-collaboration-portal.aspx](http://weblogs.asp.net/jan/archive/2007/01/11/how-to-enable-scheduled-publishing-in-a-moss-collaboration-portal.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T02:38:03.627

我最终在这里找到了解决这个问题的方法 - [http://social.msdn.microsoft.com/Forums/en-US/sharepointdevelopment/thread/042a59a2-9889-4894-8785-18eebf63872d/](http://social.msdn.microsoft.com/Forums/en-US/sharepointdevelopment/thread/042a59a2-9889-4894-8785-18eebf63872d/)

# silverlight - Silverlight 部署

> ID：613535
> 
> 赞同：1
> 
> 时间：2009-03-05T04:04:55.100
> 
> 标签：silverlight, deployment

我有一个在开发中工作的 Silverlight 2.0 站点。我将 System.Web.Silverlight 的 Copy Local 设置为 true （不确定是否有必要）。在生产中，网页加载，JS被发送到客户端，但电影没有加载。

服务器需要安装什么特别的东西吗？（它有 3.5 SP1）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-15T10:50:32.970

您是否在 IIS 中注册了 .xap mime 类型？

.xap 应用程序/x-silverlight-app

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-15T11:01:23.713

[我在 Silverlight 发布](https://stackoverflow.com/questions/962005/problem-in-silverlight-publish/964098#964098)问题中为类似问题写了一个相当长的答案。

快速总结：

1.  服务器不需要任何特殊的东西——它只是将 XAP 文件发送到浏览器。Unix 服务器托管 Silverlight 应用程序没有问题。
2.  你看到“蓝色加载漩涡”还是只是一个空白的白色区域？如果没有加载指示器，您的 XAP 文件可能没有下载。
3.  您可以直接下载 XAP 文件还是获得 404（例如，输入[http://yourserver.com/ClientBin/YourSLApp.xap](http://yourserver.com/ClientBin/YourSLApp.xap)并查看是否获得下载提示）。如果您收到 404，那么您的服务器正在阻止下载。尝试将您的 .XAP 重命名为 .ZIP（并更新您的 HTML OBJECT 标签）
4.  如果您的 Silverlight 应用程序加载正确但未显示某些内容（例如图像或电影），那么再次检查您是否可以直接从浏览器下载它们，并验证您在 Silverlight 应用程序中输入的 URL 是否正确，特别是如果它们是相对路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T09:54:36.760

你的电影在哪里？你能给我们一些关于你的项目架构的更多细节吗？

如果可以加载您的 Silverlight 应用程序，则可能只是电影文件的安全访问问题。

# vb.net - 循环遍历特定 DataTable 的行

> ID：613539
> 
> 赞同：37
> 
> 时间：2009-03-05T04:10:14.153
> 
> 标签：vb.net, datatable

IDE：VS 2008，平台：.NET 3.5，

你好，

这是我的 DataTable 列：

身份证件详情

我想这样写：

```
//below code block is not the right syntax

For each q in dtDataTable.Column("Detail")

    strDetail = Row of Column Detail

 Next 
```

任何人都可以给我一个建议并给我看一个代码示例吗？谢谢。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2009-03-05T04:18:32.870

```
For Each row As DataRow In dtDataTable.Rows
    strDetail = row.Item("Detail")
Next row 
```

还有一个简写：

```
For Each row As DataRow In dtDataTable.Rows
    strDetail = row("Detail")
Next row 
```

请注意，Microsoft 的 .Net 样式指南现在特别建议不要对变量使用匈牙利类型前缀。例如，您应该只使用“Detail”而不是“strDetail”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T04:18:58.780

```
Dim row As DataRow
For Each row In dtDataTable.Rows
    Dim strDetail As String
    strDetail = row("Detail")
    Console.WriteLine("Processing Detail {0}", strDetail)
Next row 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-01-11T14:44:37.210

这是我发现的最好方法：

```
 For Each row As DataRow In your_table.Rows
        For Each cell As String In row.ItemArray
            'do what you want!
        Next
    Next 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T04:17:41.263

您想在 .Rows 上循环，并像 q("column") 那样访问行的列

只是：

```
 For Each q In dtDataTable.Rows
            strDetail = q("Detail")
        Next 
```

还要确保检查你正在使用的任何类的[msdn](http://msdn.microsoft.com/en-us/library/system.data.datatable(VS.80).aspx) doc + 使用智能感知

# asp.net - 在 ASP.NET 中实现模板化数据绑定控件的权威模式

> ID：613540
> 
> 赞同：0
> 
> 时间：2009-03-05T04:12:03.290
> 
> 标签：asp.net, data-binding, templates, custom-server-controls

我正在开发一个项目，我们正在为**ASP.NET构建****模板化数据绑定控件**(TDBC) 。

 **问题是似乎没有人真正制定出如何做到这一点的明确模式——有 3 或 4 种不同的“风格”。

不仅如此，而且许多控件在设计时都给出了“当控件不在页面上时不能使用数据绑定”错误，因此显然这些控件中出现了错误。

这是[来自 MSDN 的示例](http://msdn.microsoft.com/en-us/library/aa720696(VS.71).aspx)。

问题是我在网上遇到了许多相似但不同的例子。

如果您在 Reflector 中查看人们（包括 MS）如何实施他们的 TDBC，您会再次看到不同的方法。

**如果您知道任何您认为显示构建 TDBC 的最佳实践的文章、示例代码或库，请告诉我。**

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T04:34:41.253

我在[开发 Microsoft ASP.NET 服务器控件和组件 (Pro-Developer) (Paperback)](https://rads.stackoverflow.com/amzn/click/com/0735615829)中阅读了一些内容。它非常好，但已经过时了。它带您了解构建服务器控件的各个方面，从处理状态到模板字段。

一本更新的书，虽然我还没有读过，是[Professional ASP.NET 2.0 Server Control and Component Development (Wrox Professional Guides)](https://rads.stackoverflow.com/amzn/click/com/0471793507)。我猜它有类似的内容。

当然，两者都不一定涉及最佳实践。

# apache-flex - Flex/Flash 可以录屏吗？

> ID：613545
> 
> 赞同：3
> 
> 时间：2009-03-05T04:16:41.173
> 
> 标签：apache-flex, flash, actionscript-3, video-capture

这个问题很简单，我真的只想流式传输用户计算机的视频。就像从网络摄像头录制一样，但来源来自桌面（想想“截屏工具”。）我特别想在纯 Flash 中执行此操作，无需下载或附加组件。

这对 Google 来说是一个简单的问题，但它被所有“导出到 Flash”的独立截屏工具弄糊涂了，因此无法找到任何有用的东西。

提前致谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T15:23:18.077

由于安全限制，这是不可能的。如果您查看 Adob​​e 的“ConnectNow”产品，您会注意到您必须安装一个名为“ConnectNow Add-In”的特殊帮助应用程序才能使用他们的屏幕共享功能。加载项实际上是一个可执行文件，具有共享/记录屏幕所需的提升权限。

如果您正在寻找将此类功能添加到 Flash 应用程序的方法，最好的办法是使用带有 java.awt.Robot 类（支持屏幕捕获）或本机 ActiveX / 浏览器插件的签名 Java 小程序。在。然后，您可以使用 ExternalInterface / Javascript 桥将这些与 Flash 集成。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T04:24:48.627

我当然希望这是不可能的。这将是一个巨大的安全漏洞。想象一下访问一个带有微小（不引人注意的）swf 的流氓网站，它将您桌面的视频流回流氓网站。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T13:19:19.030

你不能像上面的评论所说的那样。除了安全原因，Flash 无法记录 Flash 播放器之外的内容，更不用说浏览器了。

根本不认为这是可能的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T13:25:59.840

我同意 jdigital 所说的，但注意到在某些网站上会出现一个弹出窗口，询问它是否可以访问网络摄像头以将其流式传输，您也可以通过电子管等方式从网络摄像头直接录制到网络（我还没有尝试过，但假设他们使用闪存），我猜这里但是如果你可以用视频流代替桌面的 vid，那么这应该以某种方式成为可能。

高温高压

OneSHOT

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-03T05:50:37.907

我认为要将计算机录制到屏幕上，您可以下载一些可以将屏幕录制导出为 Flash 的屏幕录像机。[**DemoCreator**](http://www.sameshow.com/demo-creator.html#107)是一款不错的 Flash 截屏工具，具有强大的编辑功能。**Jing Project**的免费版本只生成 SWF 文件，但这正是您想要的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-04-13T12:02:32.667

Flex 不能录制屏幕，但是如果你想录制你在 .swf 中运行的 flash 项目是可能的……我们可以录制 flex 的组件，所以把你所有的组件放在一个组件中并记录那个组件。 .

这里[也检查一下](https://stackoverflow.com/questions/29491649/recording-using-flex-flash)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-20T13:40:36.433

由于安全沙箱，Flex/Flash 无法录制屏幕...true。

但是它提供了一种机制来记录它的组件，所以我们可以使用这个东西。比如......将所有组件放入 Panner（或任何其他组件）并记录该组件，它可以替代记录屏幕。

[检查这个](http://www.actionscript.org/resources/articles/1084/1/Screen-capture-with-ActionScript/Page1.html)

并从这里下载一个 swf 文件

[屏幕捕捉.swc](https://drive.google.com/file/d/0B9Ko8oNP6AZJenowTE9fN0k5Xzg/view)

# c# - 如何在 PerlNet 模块中引发事件？

> ID：613553
> 
> 赞同：0
> 
> 时间：2009-03-05T04:19:18.123
> 
> 标签：c#, perl

我使用 PDK 7.3 作为开发工具来开发使用 .NET 和 Perl 的应用程序。

我想将 Perl 构建到一个 .NET 兼容的 dll 中，这个模块可以引发一个 .NET GUI 应用程序可以处理的事件。

我找不到任何关于它的文档。据我所知，PDK 7.3 不支持实现委托。

这是真的？我有什么选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T09:45:26.663

我从 ActiveState 公司给 Jan Dubois 写了一封电子邮件。他提出了一种实现回调机制的方法。

希望这有帮助。

============================================

嗨，明，

您可以在 PerlNET 中很好地*实现*委托，只是不能在其中声明新的委托类型。

我附上了一些示例代码，这些代码在 Perl 中定义了一个委托，然后将其传递给 C#。您需要将这些部分分成单独的文件并手动编译它们；代码是从一些回归测试中提取出来的，您将没有测试工具的其余部分来按原样运行它。（看起来格式也被砍了一点，但代码的意图应该还是很清楚的）。

干杯，

-一月

```
#!./perl -w

# Define some properties and fields in perl and try to access them.
print "1..1\n";
require 'setup.pl';
csc("-target:library DB.cs");
cleanup("DB.dll");
plc(-target => "library", -out => "P.dll", -r => "DB.dll", "P.pm");
csc("test.cs -r:DB.dll -r:P.dll");
cleanup("./test.exe");
my $res = `./test.exe`;
print "----\n$res----\n";
print "not " unless $res eq <<'EOT';
XXX 65
XXX 66
XXX 67
XXX 68
XXX 69
XXX 70
XXX 71
XXX 4.2
XXX 4.30000019073486
XXX 4.4
XXX a
XXX 1
XXX ""
XXX Hi
XXX <undef>
EOT
print "ok 1\n";
__END__ 
```

======================= test.cs =====================

```
using System;

class main : IPrint
{
    public static void Main(string[] args)
    {
         P p = new P(new main());
         DataBase db = new DataBase();
         db.Add((byte)65);
         db.Add((short)66);
         db.Add((int)67);
         db.Add((long)68);
         db.Add((uint)69);
         db.Add((ushort)70);
         db.Add((ulong)71);
         db.Add(4.2D);
         db.Add(4.3F);
         db.Add(4.4M);
         db.Add('a');
         db.Add(true);
         db.Add(false);
         db.Add("Hi");
         db.Add(null);
         db.Scan(p.handler);
    }

    main() {}

    public void print(string s) {
         Console.WriteLine(s);

   }
} 
```

======================= DB.cs =====================

```
using System;
using System.Collections;

public delegate void ProcessItem(Object i);
public class DataBase : ArrayList {
    public DataBase() {}
    public void Scan(ProcessItem handler) {

        foreach (object o in this) {
            handler(o);
        }
    }

}

public interface IPrint {
    void print(string s);

} 
```

=======================P.pm =====================

```
package P;

=for interface

interface ProcessItem;  # a delegate type
interface IPrint;
interface System.Object;

interface P {
    static P P(IPrint ip);
    readonly ProcessItem handler;
    void x(System.Object y);
    private field IPrint ip;
}

=cut

sub P {
    my($self, $ip) = @_;
    $self->{ip} = $ip;
}

sub handler {
    my $self = shift;
    return ProcessItem->new($self, "x");
}

sub x {
    my($self, $obj) = @_;
    $obj = "<undef>" unless defined $obj;
    $obj = '""' unless length $obj;
    $self->{ip}->print("XXX $obj");
}

1; 
```

# c# - 当查询字符串更改时保持控件持久

> ID：613554
> 
> 赞同：0
> 
> 时间：2009-03-05T04:19:37.547
> 
> 标签：c#, persistence, postback, query-string

无论如何要使用不会将页面上的所有控件重置为默认值的新查询字符串进行回发？我有一个名为“default.aspx”的页面，上面有几个复选框控件。我可以根据需要检查它们，并且它们将在回发到“default.aspx”时保持持久性（意味着它们保持选中或未选中状态）。但是，如果我回发到“default.aspx?page=2”，所有控件都会恢复到它们的默认状态。有没有办法阻止他们这样做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T04:28:18.773

这里要记住的是，每次进行新的回发时，您都在使用页面类的全新实例。旧实例在发送到 Web 浏览器的那一刻就被丢弃了。考虑到这一点，状态可以在回发之间持续存在的事实非常惊人。有很多事情必须发生才能使一切正常同步。

其中之一就是 ViewState。ViewState 是页面表单中一个特殊的隐藏输入元素。当您使用新的查询字符串请求您的页面时，您不再从表单中发布该视图状态字段。您根本不再真正进行回发：这是对全新页面的请求。没有来自任何表单的 POST 数据，因此缺少 ViewState 数据，并且 ASP.Net 对您之前可能做过的任何事情一无所知。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T04:43:56.427

更改查询字符串时如何发回？如果您使用的是 ASP.net 复选框控件（使用 runat="server"），那么它们应该与视图状态保持一致。

Joel 是正确的，创建了 Page 类的新实例，但这是 Viewstate 的目的，以克服 HTTP 的无状态特性。

# shell - 运行 shell 脚本时出错

> ID：613558
> 
> 赞同：0
> 
> 时间：2009-03-05T04:27:17.497
> 
> 标签：shell

```
WARNING: error instantiating 'java.util.logging.FileHandler,' referenced by handlers, class not found
java.lang.ClassNotFoundException: java.util.logging.FileHandler,
   at java.lang.Class.forName(libgcj.so.7rh)
   at java.util.logging.LogManager.locateClass(libgcj.so.7rh)
   at java.util.logging.LogManager.createInstance(libgcj.so.7rh)
   at java.util.logging.LogManager.readConfiguration(libgcj.so.7rh)
   at vists.VisTS.main(VisTS.java:64)
Exception in thread "main" java.lang.NullPointerException
   at java.util.logging.Logger.addHandler(libgcj.so.7rh)
   at java.util.logging.LogManager.readConfiguration(libgcj.so.7rh)
   at vists.VisTS.main(VisTS.java:64)
./SampleStartVisTsData.sh: line 5: cd..: command not found 
```

我无法找出运行批处理文件时遇到的错误

下面是shell脚本：

```
cd ../../classes
export CLASSPATH=$CLASSPATH:../vismine.jar:../mysql-connector-java-5.1.6-bin.jar
java -Xm500m vists.VisTS ../ConfigFiles/dataCenterMySQL-log.xml
cd.. 
```

需要帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T04:45:54.830

当你应该有 cd .. 时，你在第 5 行有 cd .. （注意空格）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T05:00:21.660

错误之一是“ ”命令，如果它不是多余的，则`cd..`需要在其中“ ”中留一个空格。`cd ..`您的脚本更改目录以在正确的位置运行 Java，但在退出之前无需再次更改目录 - 这是 Linux 而不是 DOS（这是必要的；并且您的退出`cd`不会将您返回到您开始的位置）。

切换到 classes 目录然后期望在上面的目录中找到 jar 文件似乎很奇怪 - 你确定这是对的吗？

确保第一个`cd`工作也可能是明智的：

```
error(){
    echo "$@" 1>&2
    exit 1
}
cd ../../classes || exit 1
[ -r ../vismine.jar ] || error "did not find vismine.jar"
[ -r ../mysql-connector-java-5.1.6-bin.jar ] ||
    error "did not find mysql-connector-java-5.1.6-bin.jar"
export CLASSPATH=$CLASSPATH:../vismine.jar:../mysql-connector-java-5.1.6-bin.jar
java -Xm500m vists.VisTS ../ConfigFiles/dataCenterMySQL-log.xml 
```

原则上，您可以单独为 Java 命令导出 CLASSPATH，方法是：

```
CLASSPATH=$CLASSPATH:../vismine.jar:../mysql-connector-java-5.1.6-bin.jar \
java -Xm500m vists.VisTS ../ConfigFiles/dataCenterMySQL-log.xml 
```

但是，这一次不值得，因为它无论如何都会分布在两行代码中。

# import - 如何使用 .NET 读取 Microsoft Money 数据文件？

> ID：613561
> 
> 赞同：9
> 
> 时间：2009-03-05T04:28:09.383
> 
> 标签：import, ofx, quicken

我需要从 MS Money 数据文件中读取和导入数据。我怎样才能做到这一点？有可用的 SDK 吗？

我也想有一个类似的机制来读取 Quicken 文件。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-15T03:53:52.247

随着 Microsoft 停止 MS Money 产品，我正在研究相同的问题以尝试对 MS Money 数据文件交易信息进行完整的数据导出。我能遇到的最好的事情是一个论坛帖子，详细说明了如何通过 MS Access 读取文件。不幸的是，他的方法需要购买一个软件来“修复”文件以使其可打开。线程在这里：[http](http://www.archivum.info/microsoft.public.money/2007-09/msg00739.html) ://www.archivum.info/microsoft.public.money/2007-09/msg00739.html ，正文如下。

> 好吧，花了 300 美元 + 一些自定义 SQL 编程，我终于找到了摆脱金钱监狱的方法。这是如何
> 
> 1.  在此处获取 FileBinReplace 实用程序[http://www.softtreetech.com/24x7/script.htm](http://www.softtreetech.com/24x7/script.htm)
> 2.  作为 FileBinReplace *.mny "MSISAM Database" "Standard Jet DB" 运行它
> 3.  将 *.mny 重命名为 *.mdb
> 4.  使用 AccessFIX 工具（300 美元；在网上搜索下载链接）修复 MDB 文件。
> 
> 根据需要查询 TRN 和 TRN_INVOICE 表。
> 
> 顺便说一句，当我看到 Money 中的内部数据库设计时，我真的很震惊。该数据库肯定是由入门级数据库程序员设计的……学生可能……对关系数据库设计、规范化或效率一无所知……只是为了记录，发票文本字符串（地址、客户备注、行项目描述等）。 . 存储在存储在线交易的同一个表中，发票抬头和详细信息存储在同一个表中!!!你知道谁和如何设计它）

我希望由于 MS 不再支持产品或数据文件格式，他们将发布数据文件规范，以便可以创建工具来正确导出现有数据。

这里还有一个 SourceForge 项目，用于以其他格式导出 MsMoney 数据：http: [//sunriise.sourceforge.net/](http://sunriise.sourceforge.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-23T02:15:11.273

OFX 与 MS Money 数据文件 (mny) 无关。OFX 是基于 sgml 或 xml 的开放标准，取决于 OFX 版本，MNY 是专有的二进制格式。MS Money 可以导入 OFX 文件，仅此而已。

如果要求只导入一次，则从 Money 导出到 csv 或 qif 并处理导出的文件。同样适用于 Quicken。

金钱日落是免费的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T04:57:59.123

[CodeProject](http://www.codeproject.com/)上有一个“[将 OFX (Microsoft Money) 文件转换为 DataSet 的类](http://www.codeproject.com/Articles/14386/Class-to-transform-ofx-Microsoft-Money-file-into-D)” 。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-11T07:11:20.693

此工具是免费的，将执行更全面的 Microsoft Money 数据导出。我认为它不能以编程方式使用。 [http://www.ultrasoft.com/MoneyLink/overview.shtml](http://www.ultrasoft.com/MoneyLink/overview.shtml)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-27T23:31:12.210

如果您正在寻找英国版本，请尝试[http://www.microsoft.com/en-us/download/details.aspx?id=26915](http://www.microsoft.com/en-us/download/details.aspx?id=26915)

# iis - 负载平衡的 ASP.NET 站点的架构建议

> ID：613568
> 
> 赞同：13
> 
> 时间：2009-03-05T04:31:01.903
> 
> 标签：iis, architecture, scalability, load-balancing, infrastructure

**更新 2009-05-21**

我一直在测试使用单个网络共享的#2 方法。这会导致 Windows Server 2003 在负载下出现一些问题：

[http://support.microsoft.com/kb/810886](http://support.microsoft.com/kb/810886)

**结束更新**

我收到了一份关于 ASP.NET 网站的提案，该网站的工作方式如下：

硬件负载平衡器 -> 4 个 IIS6 Web 服务器 -> 带有故障转移集群的 SQL Server DB

这就是问题所在...

我们正在选择存储 Web 文件（aspx、html、css、图像）的位置。提出了两种选择：

1) 在 4 台 IIS 服务器上分别创建相同的 Web 文件副本。

2) 将 Web 文件的单个副本放在 4 个 Web 服务器可访问的网络共享上。4 个 IIS 服务器上的 webroot 将映射到单个网络共享。

哪个是更好的解决方案？选项 2 显然对于部署更简单，因为它只需要将文件复制到一个位置。但是，我想知道是否会有可伸缩性问题，因为四个 Web 服务器都在访问一组文件。IIS 会在本地缓存这些文件吗？它会在每个客户端请求上命中网络共享吗？另外，访问网络共享总是比在本地硬盘上获取文件慢吗？如果添加更多 IIS 服务器，网络共享的负载是否会变得更糟？

举例来说，这是针对目前每月获得约 2000 万次点击的网站。在最近的高峰期，它每秒收到大约 200 次点击。

如果您对此类设置有特殊经验，请告诉我。感谢您的输入。

**更新 2009-03-05**

为了澄清我的情况 - 这个系统中的“部署”比典型的 Web 应用程序要频繁得多。该网站是后台 CMS 的前端。每次在 CMS 中发布内容时，都会自动将新页面（aspx、html 等）推送到实时站点。部署基本上是“按需”的。从理论上讲，这种推动可能在一分钟或更长时间内发生多次。因此，我不确定一次部署一台 Web 服务器是否可行。想法？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-05T04:51:08.000

我会在 4 台服务器之间分担负载。这不是很多。

您不希望在部署时出现单点争用，也不希望在生产中出现单点故障。

部署时，您可以一次执行 1 个。您的部署工具应该通过通知负载均衡器不应使用服务器、部署代码、所需的任何预编译工作以及最后通知负载均衡器服务器已准备好来自动执行此操作。

我们在 200 多个 Web 服务器场中使用了这种策略，并且它在不中断服务的情况下很好地部署。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T04:52:39.963

如果您主要关心的是性能，我认为这是因为您将所有这些钱都花在了硬件上，那么仅仅为了方便而共享网络文件系统就没有任何意义。即使网络驱动器具有极高的性能，它们的性能也不会像本机驱动器那样好。

无论如何，部署您的 Web 资产都是自动化的（对吗？），因此以多个方式进行部署并没有太大的不便。

如果它比你说的更复杂，那么像 DeltaCopy 这样的东西可能对保持这些磁盘同步很有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T05:37:19.590

中央共享不好的一个原因是因为它使共享服务器上的 NIC 成为整个场的瓶颈，并造成单点故障。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-28T18:53:47.300

在 IIS6 和 7 中，明确支持在 N 个连接的 Web/应用服务器机器上使用网络单一共享的方案。MS 进行了大量的性能测试，以确保这种情况运行良好。是的，使用了缓存。使用双网卡服务器，一个用于公共互联网，一个用于专用网络，您将获得非常好的性能。部署是防弹的。

值得花时间对其进行基准测试。

您还可以评估 ASP.NET 虚拟路径提供程序，它允许您为整个应用程序部署单个 ZIP 文件。或者，使用 CMS，您可以直接从内容数据库而不是文件系统提供内容。这为版本控制提供了一些非常好的选项。

[通过 #ZipLib 进行 ZIP 的 VPP](http://msdn.microsoft.com/en-us/library/Aa479502.aspx)。

[通过 DotNetZip 用于 ZIP 的 VPP](http://code.msdn.microsoft.com/DotNetZip/Wiki/View.aspx?title=ASP.NET%20VirtualPathProvider)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-01T02:28:17.870

在理想的高可用性情况下，不应该出现单点故障。

这意味着一个带有网页的盒子是禁止的。在为一家大型电信公司完成 HA 工作后，我最初会提出以下建议：

*   四台服务器中的每台都有自己的数据副本。
*   在安静的时间，使两台服务器脱机（即修改 HA 平衡器以删除它们）。
*   更新两个离线服务器。
*   修改 HA 平衡器以开始使用两台新服务器而不是两台旧服务器。
*   测试以确保正确性。
*   更新另外两台服务器，然后将它们联机。

这就是你可以在没有额外硬件的情况下做到这一点的方法。在我工作的电信公司的肛门保留世界中，我们会这样做：

*   我们应该有八台服务器（当时，我们的钱比你能花的多）。到了过渡时间，将使用新数据设置四个离线服务器。
*   然后将 HA 平衡器修改为使用四个新服务器并停止使用旧服务器。这使得切换（更重要的是，如果我们塞满了的话，切换回）一个非常快速和无痛的过程。
*   只有当新服务器运行一段时间后，我们才会考虑下一次切换。在那之前，四台旧服务器一直处于离线状态，但已准备就绪，以防万一。
*   为了以更少的财务支出获得相同的效果，您可以拥有额外的磁盘而不是整个额外的服务器。恢复不会那么快，因为您必须关闭服务器才能将旧磁盘放回原处，但它仍然比恢复操作更快。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-25T19:54:49.970

使用部署工具，其进程一次部署一个，系统的其余部分继续工作（如 Mufaka 所说）。这是一个经过尝试的过程，可以同时处理内容文件和应用程序的任何已编译片段（部署会导致 asp.net 进程的回收）。

关于**更新率，**这是您可以控制的。让更新通过一个队列，并有一个单独的部署过程来控制何时部署每个项目。请注意，这并不意味着您可以单独处理每个更新，因为您可以获取队列中的当前更新并将它们一起部署。进一步的更新将到达队列，并在当前的更新集结束后被拾取。

**更新：**关于评论中的问题。这是基于我对需要控制其更新速率的繁重/长流程的经验的自定义解决方案。我不需要在部署场景中使用这种方法，因为对于这样的动态内容，我通常会结合不同级别的数据库和缓存。

队列不需要保存完整的信息，它只需要有适当的信息（ids/paths），让您的进程传递信息以使用外部工具启动发布过程。由于它是自定义代码，您可以让它加入要发布的信息，因此您不必在发布过程/工具中处理它。

数据库更改将在发布过程中完成，您只需要知道所需更改的信息在哪里，并让发布过程/工具处理它。关于队列使用什么，我使用的主要是 msmq 和 sql server 中带有信息的自定义实现。队列只是用来控制更新速率，因此您不需要任何专门针对部署的东西。

**更新 2：**确保您的数据库更改是向后兼容的。当您将更改实时推送到不同的服务器时，这非常重要。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-31T19:53:31.860

我负责开发一个每月有 6000 万点击量的游戏网站。我们这样做的方式是选项#1。用户确实有能力上传图像等，这些图像被放在服务器之间共享的 NAS 上。结果很好。我假设您还在房子的应用程序端进行页面缓存等。我还会按需将新页面同时部署到所有服务器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-25T18:21:00.740

使用 4IIS 在 NLB 上获得了什么，而使用应用服务器的 BottleNeck 则失去了它。

对于可扩展性，我会推荐前端 Web 服务器上的应用程序。

在我的公司，我们正在实施该解决方案。前端的 .NET 应用程序和 Sharepoint 的 APP 服务器 + SQL 2008 集群。

希望能帮助到你！

问候！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-26T17:31:34.643

我们的情况与您类似，我们的解决方案是使用发布者/订阅者模型。我们的 CMS 应用程序将实际文件存储在数据库中，并在创建或更新文件时通知发布服务。然后，该发布者通知所有订阅的 Web 应用程序，然后他们从数据库中获取文件并将其放置在他们的文件系统中。

我们在发布者的配置文件中设置了订阅者，但您可以全力以赴，让网络应用在应用启动时自行进行订阅，以使其更易于管理。

您可以使用 UNC 进行存储，我们选择 DB 是为了在生产环境和测试环境之间提供方便和可移植性（我们只需将 DB 复制回来，我们就拥有所有实时站点文件和数据）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-26T19:58:14.557

部署到多个服务器（一旦正确设置节点）的一种非常简单的方法是使用 robocopy。

最好有一个用于测试的小型临时服务器，然后将“robocopy”到所有部署服务器（而不是使用网络共享）。

robocopy 包含在[MS ResourceKit](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en)中- 与 /MIR 开关一起使用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-27T08:50:41.113

为了让您深思熟虑，您可以看看[Microsoft 的 Live Mesh 之](https://www.mesh.com/Welcome/default.aspx) 类的东西。我并不是说它是你的答案，但它使用的存储模型可能是。

使用 Mesh，您可以将小型 Windows 服务下载到您想要在 Mesh 中使用的每台 Windows 机器上，然后指定系统上属于 Mesh 的文件夹。当您将文件复制到 Live Mesh 文件夹时 - 这与复制到系统上的任何其他文件夹的操作完全相同 - 该服务负责将该文件同步到所有其他参与设备。

例如，我将所有代码源文件保存在 Mesh 文件夹中，并让它们在工作和家庭之间同步。我根本不需要做任何事情来使它们保持同步，在 VS.Net、记事本或任何其他应用程序中保存文件的操作会启动更新。

如果您的网站包含需要转到多个服务器的频繁更改的文件，并且可能有多个作者进行这些更改，那么您可以将 Mesh 服务放在每个 Web 服务器上，并且随着作者添加、更改或删除文件，更新将是自动推送。就作者而言，他们只是将文件保存到计算机上的普通旧文件夹中。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-31T08:50:55.883

假设您的 IIS 服务器正在运行 Windows Server 2003 R2 或更高版本，请务必查看[DFS Replication](http://www.microsoft.com/windowsserver2003/technologies/storage/dfs/default.mspx)。每台服务器都有自己的文件副本，这消除了许多其他人警告过的共享网络瓶颈。部署就像将更改复制到复制组中的任何一台服务器一样简单（假设是全网状拓扑）。复制会自动处理其余的工作，包括使用远程差异压缩仅发送已更改文件的增量。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-01T14:58:24.323

我们很高兴使用 4 个 Web 服务器，每个服务器都有一个页面的本地副本和一个带有故障转移集群的 SQL Server。

# bash - 将多行输出捕获到 Bash 变量中

> ID：613572
> 
> 赞同：649
> 
> 时间：2009-03-05T04:32:18.437
> 
> 标签：bash, variables

我有一个脚本“myscript”，它输出以下内容：

```
abc
def
ghi 
```

在另一个脚本中，我调用：

```
declare RESULT=$(./myscript) 
```

并`$RESULT`获得价值

```
abc def ghi 
```

有没有办法用换行符或'\n'字符存储结果，以便我可以用' `echo -e`'输出它？

* * *

## 回答 #1

> 赞同：1201
> 
> 时间：2009-03-05T04:36:09.877

实际上，RESULT 包含您想要的内容 - 以演示：

```
echo "$RESULT" 
```

你所展示的就是你从中得到的：

```
echo $RESULT 
```

* * *

如评论中所述，不同之处在于（1）变量（）的双引号版本`echo "$RESULT"`保留了值的内部间距，与变量中表示的值完全相同——换行符、制表符、多个空格等等——而（2 ) 未加引号的版本 ( `echo $RESULT`) 用一个空格替换一个或多个空格、制表符和换行符的每个序列。因此 (1) 保留输入变量的形状，而 (2) 创建一个可能非常长的单行输出，其中“单词”由单个空格分隔（其中“单词”是非空白字符的序列；不需要'不是任何单词中的任何字母数字）。

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2011-03-16T09:03:30.543

另一个陷阱是[命令替换](http://www.gnu.org/software/bash/manual/bash.html#Command-Substitution)——`$()`去掉尾随的换行符。可能并不总是很重要，但是如果您真的想*准确*保留输出的内容，则必须使用另一行和一些引用：

```
RESULTX="$(./myscript; echo x)"
RESULT="${RESULTX%x}" 
```

如果您想[处理*所有*可能的文件名](https://github.com/l0b0/tilde/blob/master/examples/safe-find.sh)（以避免未定义的行为，例如操作错误的文件），这一点尤其重要。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2013-07-11T20:28:45.133

如果您对特定行感兴趣，请使用结果数组：

```
declare RESULT=($(./myscript))  # (..) = array
echo "First line: ${RESULT[0]}"
echo "Second line: ${RESULT[1]}"
echo "N-th line: ${RESULT[N]}" 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-07-11T13:03:29.100

除了@l0b0 给出的答案之外，我还遇到了一种情况，即我需要保留脚本输出的任何尾随换行符**并**检查脚本的返回码。l0b0 的答案的问题是“echo x”正在重置 $? 回到零......所以我设法想出了这个非常狡猾的解决方案：

```
RESULTX="$(./myscript; echo x$?)"
RETURNCODE=${RESULTX##*x}
RESULT="${RESULTX%x*}" 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2020-10-13T07:28:12.330

# 解析多个输出

## 介绍

所以你的`myscript`输出 3 行，可能看起来像：

```
myscript() { echo $'abc\ndef\nghi'; } 
```

或者

```
myscript() { local i; for i in abc def ghi ;do echo $i; done ;} 
```

好的，这是一个函数，而不是脚本（不需要 path `./`），但输出是一样的

```
myscript
abc
def
ghi 
```

### 考虑*结果代码*

要检查结果代码，测试函数将变为：

```
myscript() { local i;for i in abc def ghi ;do echo $i;done;return $((RANDOM%128));} 
```

## 1\. 将多个输出存储在一个变量中，显示*换行符*

你的操作是正确的：

```
RESULT=$(myscript) 
```

关于*结果代码*，您可以添加：

```
RCODE=$? 
```

即使在同一行：

```
RESULT=$(myscript) RCODE=$? 
```

然后

```
echo $RESULT $RCODE
abc def ghi 66

echo "$RESULT"
abc
def
ghi

echo ${RESULT@Q}
$'abc\ndef\nghi'

printf "%q\n" "$RESULT"
$'abc\ndef\nghi' 
```

但为了显示变量定义，请使用`declare -p`：

```
declare -p RESULT RCODE
declare -- RESULT="abc
def
ghi"
declare -- RCODE="66" 
```

## 2.解析数组中的多个输出，使用`mapfile`

将答案存储到`myvar`变量中：

```
mapfile -t myvar < <(myscript)
echo ${myvar[2]}
ghi 
```

显示`$myvar`：

```
declare -p myvar
declare -a myvar=([0]="abc" [1]="def" [2]="ghi") 
```

### 考虑*结果代码*

如果您必须检查结果代码，您可以：

```
RESULT=$(myscript) RCODE=$?
mapfile -t myvar <<<"$RESULT"

declare -p myvar RCODE
declare -a myvar=([0]="abc" [1]="def" [2]="ghi")
declare -- RCODE="40" 
```

## `read`3.在命令组中通过连续解析多个输出

```
{ read firstline; read secondline; read thirdline;} < <(myscript)
echo $secondline
def 
```

显示变量：

```
declare -p firstline secondline thirdline
declare -- firstline="abc"
declare -- secondline="def"
declare -- thirdline="ghi" 
```

我经常使用：

```
{ read foo;read foo total use free foo ;} < <(df -k /) 
```

然后

```
declare -p use free total
declare -- use="843476"
declare -- free="582128"
declare -- total="1515376" 
```

### 考虑*结果代码*

相同的前置步骤：

```
RESULT=$(myscript) RCODE=$?
{ read firstline; read secondline; read thirdline;} <<<"$RESULT"

declare -p firstline secondline thirdline RCODE
declare -- firstline="abc"
declare -- secondline="def"
declare -- thirdline="ghi"
declare -- RCODE="50" 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-05-03T22:52:12.180

在这里尝试了大多数解决方案之后，我发现最简单的事情是显而易见的 - 使用临时文件。我不确定你想对多行输出做什么，但你可以使用 read 逐行处理它。关于你唯一不能真正做的事情就是轻松地将它们全部放在同一个变量中，但对于大多数实际目的来说，这更容易处理。

```
./myscript.sh > /tmp/foo
while read line ; do 
    echo 'whatever you want to do with $line'
done < /tmp/foo 
```

快速破解以使其执行请求的操作：

```
result=""
./myscript.sh > /tmp/foo
while read line ; do
  result="$result$line\n"
done < /tmp/foo
echo -e $result 
```

请注意，这会增加一行。如果你在它上面工作，你可以围绕它编写代码，我只是太懒了。

* * *

编辑：虽然这个案例效果很好，但阅读本文的人应该知道，您可以轻松地将您的标准输入压缩到 while 循环中，从而为您提供一个运行一行、清除标准输入并退出的脚本。我认为像 ssh 会那样做吗？我最近才看到它，这里的其他代码示例：[https ://unix.stackexchange.com/questions/24260/reading-lines-from-a-file-with-bash-for-vs-while](https://unix.stackexchange.com/questions/24260/reading-lines-from-a-file-with-bash-for-vs-while)

再一次！这次使用不同的文件句柄（stdin、stdout、stderr 是 0-2，所以我们可以在 bash 中使用 &3 或更高）。

```
result=""
./test>/tmp/foo
while read line  <&3; do
    result="$result$line\n"
done 3</tmp/foo
echo -e $result 
```

您也可以使用 mktemp，但这只是一个快速的代码示例。mktemp 的用法如下所示：

```
filenamevar=`mktemp /tmp/tempXXXXXX`
./test > $filenamevar 
```

然后像使用文件的实际名称一样使用 $filenamevar。可能不需要在这里解释，但有人在评论中抱怨。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-21T14:21:08.850

怎么样，它会将每一行读取到一个变量中，然后可以使用它！假设 myscript 输出被重定向到一个名为 myscript_output 的文件

```
awk '{while ( (getline var < "myscript_output") >0){print var;} close ("myscript_output");}' 
```

# powershell - 如何筛选从未在 Exchange 命令行管理程序中登录的邮箱？

> ID：613577
> 
> 赞同：1
> 
> 时间：2009-03-05T04:35:37.307
> 
> 标签：powershell, exchange-server

我需要运行一个 Get-Mailbox | Get-MailboxStatistics 命令跨越大量邮箱，但大多数从未使用过，因为它是新安装的。结果，我不得不坐过几百行

```
WARNING: There is no data to return for the specified mailbox '<mailbox DN>' because it has not been logged on to. 
```

看来我需要使用某种服务器端过滤器，但我找不到任何合适的东西。

我可以在这里做什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T11:36:16.233

Get-MailboxStatistics 中没有服务器端过滤，我无法重现它。你可以试试这个：

获取邮箱 | Get-MailboxStatistics -warningAction 静默继续

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T14:11:42.337

这是警告的标准 PS 行为。您可以在 common_parameters 的帮助中找到 Shay 的参数`get-help about_common_parameters`。或者，您可以设置`$WarningPreference = silentlycontinue`. 由于邮箱尚未初始化，因此没有要返回的统计信息，因此会发出警告。

# mono - 单声道上的 NUnit？

> ID：613578
> 
> 赞同：11
> 
> 时间：2009-03-05T04:35:46.713
> 
> 标签：mono, nunit

有谁知道你是否可以在 Mono 上运行 NUnit？我问的原因是因为在[下载页面上](http://www.nunit.org/index.php?p=download)它说：

> 对于某些版本，我们提供了一个压缩包以供在 Mono 下使用。

然而，唯一真正具有单独单声道版本的版本（从它的标签判断，“单声道：”然后显示 .zip）是古老的 2.2。NUnit 的最新版本是 2.4.8，所以我真的不想使用那个旧版本。

你能在 Mono 上使用最新版本的 NUnit 吗？如果没有，我能做些什么来让它工作吗？究竟是什么让 Mono 可以运行？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-05T15:25:19.850

Mono 2.4 将与 NUnit 2.4.8 一起发布，并且 Mono 项目已经使用了几个月来进行测试，所以它应该工作得很好。

Mono 2.4 预览版：http: [//mono.ximian.com/monobuild/preview/download-preview/](http://mono.ximian.com/monobuild/preview/download-preview/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T18:55:00.657

为了回答任何其他“Will x 在单声道上运行...”，他们制作了一个名为 Mono Migation Analyser 的工具。

它可以在[这里](http://mono-project.com/MoMA)找到，它会告诉你运行你的应用程序时缺少哪些方法（如果有的话）mono。

# iphone - 为什么自动释放对 iPhone 应用程序特别危险/昂贵？

> ID：613583
> 
> 赞同：14
> 
> 时间：2009-03-05T04:37:06.367
> 
> 标签：iphone, objective-c, performance, autorelease

我正在寻找一个主要来源（或一个非常好的解释）来支持在`autorelease`为 iPhone 编写软件时使用是危险的或过于昂贵的说法。

有几位开发人员提出了这种说法，我什至听说苹果不推荐它，但我无法找到任何具体的来源来支持它。

SO 参考：
[autorelease-iphone](https://stackoverflow.com/questions/429524/autorelease-iphone)
[为什么这会造成内存泄漏（iPhone）？](https://stackoverflow.com/questions/612986/why-does-this-create-a-memory-leak-iphone/613150#613150)

注意：我可以看到，从概念的角度来看，这`autorelease`比简单地调用 稍微贵一些`release`，但我认为小惩罚不足以让 Apple 推荐反对它。

真实的故事是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-05T05:36:11.527

（不能接受你自己的答案？）

好吧，毕竟，我确实设法找到了来自 Apple Developer 的参考资料，在页面底部附近作为旁注添加：

> iPhone OS 注意：因为在 iPhone OS 上，应用程序在更受内存限制的环境中执行，所以不鼓励在应用程序创建许多对象的方法或代码块（例如循环）中使用自动释放池。相反，您应该尽可能显式释放对象。

尽管如此，这仍然建议谨慎使用自动释放，而不是完全避免它。

（现在我的评论）

听起来维护池有一定的开销。我读[了这篇文章](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmAutoreleasePools.html)，这可能会导致我尽可能避免自动释放，因为我更喜欢保持一致。如果您在自动释放下有一些内存，而其他内存完全是手动管理的，则可能会更加混乱。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-01-06T20:51:21.360

使用或不使用 autorelease 不是问题，因为在某些情况下，autorelease 是您通过的唯一方法。问题应该是“*为什么不对所有对象使用自动释放，而不是使用保留和释放？* ”。

要回答这个问题，您应该首先了解什么是自动释放的正确用途。假设您有一个具有两个属性的类：firstName 和 lastName。每个都有一个 getter 和一个 setter。但是您还需要一个返回 fullName 的方法，将这两个字符串连接成一个全新的字符串：

```
- (NSString *) fullName {
   NSString str = [[NSString alloc]initWithFormat:@"%@ %@", firstName, lastName];
   // this is not good until we put [str autorelease];
   return str;
} 
```

那张图有什么问题？返回字符串的引用计数为 1，因此如果您不想泄漏，调用者应该在完成后释放它。从调用者的角度来看，他只是请求了一个属性 value `fullName`。他不知道他得到了一个在使用后应该释放的全新对象，而不是对类内部持有的 NSString 的一些引用！

If we put the `[str release]` before return, the string would be destroyed and the method would return garbage! That's where we use `[str autorelease]`, to mark the object for release at a later time (typically when the event processing is done). That way the caller gets his object, and does not have to worry whether he should release it or not.

*The convention is to call autorelease on a new object before the method returns it to the caller. Exceptions are methods with names that start with `alloc`, `new` or `copy`. In such cases the callers know that a brand new object is created for them and it is their duty to call release on that object.*

*Replacing release with autorelease altogether is a bad idea, since the objects would pile up and clog the memory very quickly, especially in loops. The resources on the iPhone are limited, so in order to minimize memory hogging, it is your duty to release the object as soon as you're done with it.*

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-05T20:36:48.417

我不同意完全避免自动释放是明智的。

Cocoa Touch 在内部非常频繁地使用它，并且在许多情况下，它是正确分配内存的唯一方法（一个很好的例子是可重用的表格视图单元格）。如果您了解正在发生的事情，那么自动释放池是您可以使用的一个很好的工具。要记住的主要事情是，直到运行循环中的某个时间点才释放块。如果你在没有用户交互的情况下运行一个紧密的循环并且正在堆积自动释放块，你最终会耗尽内存。

Autorelease 不能替代垃圾收集（iPhone SDK 中不可用），并且可能导致令人讨厌的悬空指针错误（指针似乎仍然很好，然后在某些不可预测的点变得无效），但在编写时也非常有用清晰且易于维护的代码。考虑以下情况：

```
[aDictionary writeToFile:
     [documentsDirectory stringByAppendingPathComponent:@"settings.plist"]
              atomically:YES]; 
```

路径字符串作为自动释放对象生成。我们不需要创建临时对象，因此我们避免了这种开销（以及我们可能忘记释放它的可能性）。内存将被完全释放（没有泄漏），只是它会在运行循环的后期发生。问问自己：在我回到用户输入之前，我会分配数百个这些吗？如果没有（就像这里的情况一样），自动释放是一个很好的解决方案，实际上这种用于处理路径的 NSString 方法只能使用自动释放的内存。

我同意上面的海报，即遵循惯例并保持一致是一个非常好的主意。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-05T22:19:12.413

我倾向于尽可能避免在 iPhone 上使用自动释放（正如 Jon 指出的那样，你不能总是没有它），仅仅是因为我想知道我正在使用的对象会在我不释放的那一刻被释放需要他们。内存限制是您在设备上将面临的最大问题之一，我相信它们是您在那里发现的大多数崩溃问题的根源。

正如 Apple 所强调的，当您在任何类型的循环中使用自动释放的对象时，需要特别关注的一个方面，因为它们会堆积在自动释放池中。然后，您必须管理何时耗尽池或创建/释放池。每次通过循环都这样做可能会降低性能，但是如果没有通过太多次可能会导致危险的内存使用。我仍在 Molecules 中对此进行调整，因为从蛋白质数据库导入大型 (>2 MB) 文本文件时会出现间歇性内存问题。我能够通过最小化自动释放的对象来提高性能，但不能完全消除它们。

另一个需要注意的领域是使用带有线程的自动释放对象。如果可能，在处理在后台线程上执行的方法时不要使用自动释放的对象，因为池可能会在随机时间耗尽。这会导致间歇性崩溃，追踪起来真的很有趣。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T06:16:29.747

我强烈建议避免像瘟疫一样自动释放。内存管理错误是浪费大量时间和金钱的好方法，我有幸在旧的 Mac 应用程序上多次经历这个过程，而 iPhone 的内存限制很严格意味着你有要非常小心，否则应用程序将不稳定并经常崩溃……就像去年夏天发布的许多第一批应用程序一样。

我发现编写稳定的 iPhone 应用程序的唯一可靠方法是自己管理所有内存，并且始终如一地执行此操作。即使您是项目中唯一的程序员，您也会在以后感谢自己。如果你学会了用“为你处理一切”的语言编程可能会很困难，但如果你认真地想创建高质量的 iPhone 应用程序，那么学习如何做得好确实是值得的。

# vb.net - How can I update a row in a DataTable in VB.NET?

> ID：613596
> 
> 赞同：14
> 
> 时间：2009-03-05T04:44:38.470
> 
> 标签：vb.net, datatable

I have the following code:

```
Dim i As Integer = dtResult.Rows.Count
For i = 0 To dtResult.Rows.Count Step 1
    strVerse = blHelper.Highlight(dtResult.Rows(i).ToString, s)
    ' syntax error here
    dtResult.Rows(i) = strVerse 
Next 
```

I want to add a `strVerse` to the current row.

What am I doing wrong?

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-05T04:52:47.107

The problem you're running into is that you're trying to replace an entire row object. That is not allowed by the DataTable API. Instead you have to update the values in the columns of a row object. Or add a new row to the collection.

To update the column of a particular row you can access it by name or index. For instance you could write the following code to update the column "Foo" to be the value strVerse

```
dtResult.Rows(i)("Foo") = strVerse 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-05T04:49:24.433

You can access columns by index, by name and some [other ways](http://msdn.microsoft.com/en-us/library/system.data.datarow.item.aspx):

```
dtResult.Rows(i)("columnName") = strVerse 
```

You should probably make sure your `DataTable` has some columns first...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-02-13T17:15:41.500

```
Dim myRow() As Data.DataRow
myRow = dt.Select("MyColumnName = 'SomeColumnTitle'")
myRow(0)("SomeOtherColumnTitle") = strValue 
```

Code above instantiates a DataRow. Where "dt" is a DataTable, you get a row by selecting any column (I know, sounds backwards). Then you can then set the value of whatever row you want (I chose the first row, or "myRow(0)"), for whatever column you want.

# java - 具有透明文本字段的 Java Nimbus LAF

> ID：613603
> 
> 赞同：11
> 
> 时间：2009-03-05T04:48:44.917
> 
> 标签：java, swing, nimbus

我有一个应用程序在几个地方使用禁用的 JTextFields，这些地方旨在透明 - 允许背景显示而不是文本字段的正常背景。

运行新的 Nimbus LAF 时，这些字段是不透明的（尽管设置了 setOpaque(false)），并且我的 UI 已损坏。就好像 LAF 忽略了 opaque 属性。明确地设置背景颜色~~在几个地方都很困难，并且由于背景图像~~实际上不起作用，因此不是最佳的 - 它仍然在顶部绘制它的 LAF 默认背景，留下类似边框的外观（下面的启动屏幕有背景明确设置为匹配图像）。

关于如何让 Nimbus 不为 JTextField 绘制背景的任何想法？

注意：我需要一个 JTextField，而不是 JLabel，因为我需要线程安全的 setText() 和包装能力。

注意：我的后备立场是继续使用系统 LAF，但 Nimbus 看起来确实要好得多。

请参阅下面的示例图像。

* * *

## 结论

这种行为*令人惊讶*是由于对 setOpaque() 的作用的误解——来自 Nimbus 错误报告：

> 这是 Swing 的原始设计以及多年来一直令人困惑的问题。问题是 setOpaque(false) 在退出 LAF 时产生了副作用，即隐藏背景，这并不是它真正的用途。应该说组件有透明的部分，swing 应该在它后面绘制父组件。

不幸的是，Nimbus 组件似乎也不支持 setBackground(null)，否则这将是停止背景绘制的推荐方法。设置一个完全透明的背景对我来说似乎不直观。

在我看来，setOpaque()/isOpaque() 是一个错误的公共 API 选择，应该只是：

```
public boolean isFullyOpaque(); 
```

我这样说是因为 isOpaque()==true 是与 Swing 的合同，组件子类将负责绘制它的整个背景——这意味着父级可以根据需要跳过绘制该区域（这是一个重要的性能增强）。外部的东西不能*直接*（合法地）改变这个契约，它的实现可以被编码到组件中。

所以组件的不透明度不应该使用 setOpaque() 设置。相反，像 setBackground(null) 这样的东西应该会导致许多组件“没有背景”，因此变得不完全不透明。例如，在理想世界中，大多数组件应该有一个 isOpaque()，如下所示：

```
public boolean isOpaque() { return (background!=null); } 
```

* * *

[![例子](https://i.stack.imgur.com/Abu15.png)](https://i.stack.imgur.com/Abu15.png)

[![替代文字](https://i.stack.imgur.com/pFI5p.png)](https://i.stack.imgur.com/pFI5p.png)

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-05T17:25:59.170

上周我使用 JTextPane 遇到了同样的问题。当使用 nimbus 以外的任何外观和感觉时，setOpaque() 方法会按预期工作。显然，nimbus 的外观和感觉改变了我们对许多组件使用 setOpaque() 所期望的行为。根据你如何看待它，它可以被认为是一个错误。查看有关此 sun bugid 的评论：

[灵气不透明错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6687960)

对我有用的解决方法是：

```
myPane.setOpaque(false); // added by OP
myPane.setBorder(BorderFactory.createEmptyBorder());
myPane.setBackground(new Color(0,0,0,0)); 
```

* * *

来自 OP 的注释：我还必须确保 JTextField 的 setOpaque(false) 以便绘制父背景 - 只是想向其他跟随者提及这一点，以防他们像我一样尝试过 setOpaque(true)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T04:56:58.190

嘿，软件猴子。

嗯，安装真正尊重 setOpaque 行为的 UI 的子类替换怎么样。

我认为它类似于 setUI 或类似的东西。

您可以获取 nimbus 的源代码并查看那里有什么问题（如果存在），将其子类化并安装“已修复”的代码。

你的听起来很有趣，你有我们可以看到的截图吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T13:08:23.663

我认为问题是如何解释“不透明”和“背景”。对于 JTextfield 有一个问题：“背景是什么可见部分？”。我将“背景”定义为边界矩形的一部分，这些部分不是由组件绘制的。例如，对于“圆形”按钮，这将是圆外的角。因此，我会说 JTextfield 没有可见的背景！它具有矩形形状，您作为背景的不是字段的背景，而是字段的画布。

* * *

**OP的反驳**

这是一个足够有趣的想法，值得在未来观众的答案中做出回应（而不是在评论中）。

我不得不不同意。我会争辩说，边界外的组件部分不是组件的一部分 - 它在组件*之外*。具有圆角的字段必然是不透明的，因为它不能负责绘制整个矩形区域 - 这是所有组件在尺寸上都是矩形的副作用。

我认为这种考虑为 isOpaque() 的现有（和被误解的）含义提供了论证。这也使我的论点是 setOpaque() 不应该存在并且 setBackground(null) 应该导致组件不绘制背景。

我会提出，文本字段的背景确实是其边界内区域的颜色，我认为作为一个直观的结论，您不会发现很多人对此提出异议 - 因此将背景应用于该区域服从API 用户最不意外的规则。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T13:28:18.250

来自 javadoc

> 公共无效 setBackground（颜色背景）
> 
> 设置此组件的背景颜色。仅当组件不透明时才使用背景颜色，并且仅由 JComponent 或 ComponentUI 实现的子类使用。JComponent 的直接子类必须覆盖paintComponent 以遵守此属性。
> 
> 尊重此属性取决于外观和感觉，有些人可能会选择忽略它。

# jquery - 如何防止 Facebook Connect isUserConnected 函数在 jQuery 中运行两次？

> ID：613612
> 
> 赞同：0
> 
> 时间：2009-03-05T04:53:32.207
> 
> 标签：jquery, facebook

Facebook 集成有点问题。

当我的用户点击一个链接时，一个函数会检查用户是否登录到 Facebook。如果他们没有登录，我设置一条数据，然后运行 ​​Facebook 登录的东西。当 Facebook 返回他们登录时，我会检查存储的数据并运行他们选择的原始功能。

### 问题：

Facebook 功能运行两次。他们的留言板上有一些关于这个问题的评论，但似乎这是自 connect 开始以来一直存在的问题，并且没有得到解决。

所以，我不想等待 Facebook。我有什么办法可以防止该函数多次调用我的函数？

我可以设置一些说“运行一次”的东西吗？问题是一旦它运行一次，如果用户再次点击，我将需要再次运行它，所以我不能完全禁用该功能（即使这是可能的）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T05:24:43.070

这是相当骇人听闻的，但它应该可以解决 Facebook 调用你的函数两次的问题。由于没有代码，我将根据我的解决方案进行一些补充。另外，我假设 facebook 登录代码有一个回调（否则它会如何调用您的函数两次？）。

```
// This function is what is called when the link is clicked
// funToRun - the function that should be run after login is confirmed.
// params - parameters to pass to fToRun, as an array
clickWrapper = function(funToRun, params)
{
    // Keeps track of the state of the click
    var doFunction = true;

    var callback = function()
    {
        if (doFunction)
        {
            funToRun.apply(this, params);
            doFunction = false;
        }
    }

    // The facebook 
    facebookLogin(callback);
} 
```

在此解决方案中，您将要运行的函数包装在只运行一次的回调中，因为 doFunction 将阻止未来的回调执行任何操作。但是，每次用户点击时它至少会运行一次，因为 doFunction 是在本地管理的（因此每次点击都为真）。

# c - 枚举数据类型和 gcc

> ID：613614
> 
> 赞同：0
> 
> 时间：2009-03-05T04:55:35.947
> 
> 标签：c, linux, enums

我有一个函数，其中函数参数之一是整数。在函数调用期间，我将枚举数据类型传递给该函数。使用 gcc 构建后，对函数内部的 INTEGER 变量的任何访问都会导致分段错误。

### 示例代码：

```
void somefun (unsigned int nState)
{
    switch (nState) // <-- Crashes on this line
    {
        //
        // functionality here ...
        //
    }
}

enum {

    UNDEFINED = -1,
    STATE_NICE,
    STATE_GREEDY
} E_STATE;

int main (int argc, char *argv [])
{
    somefun (STATE_NICE);
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T05:00:46.607

首先，枚举在 main() 中定义，并且对于 somefun() 不存在。您应该在 main 之外定义枚举，尽管我看不出这是如何导致崩溃的。

在 main 之外定义枚举后，您应该将 somefun 定义为 somefun( E_STATE nState ) 并再次测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T05:10:58.297

实际上为我运行：

```
bash $ cat bar.c
#include <stdio.h>

void somefun (unsigned int nState)
{
    switch (nState) // <-- Crashes on this line
    {
        //
        // functionality here ...
        //
      default:
        printf("Hello?\n");
    }
}

int main (int argc, char *argv [])
{
    enum {

        UNDEFINED = -1,
        STATE_NICE,
        STATE_GREEDY
    } E_STATE;

    somefun (STATE_NICE);
    return 0;
}
bash $ gcc -Wall bar.c -o bar
bar.c: In function 'main':
bar.c:22: warning: unused variable 'E_STATE'
bash $ ./bar
Hello?
bash $ 
```

进行了一些更改，但没有它们就可以运行。(1) 在 switch 中添加一个标签，让它有一些东西；(2) 添加了`#include <stdio.h>`，`printf`所以我可以知道它已经运行了；(3) 添加了`return 0;`消除无趣的警告。

它确实在没有任何更改的情况下成功运行，只是没有做任何可见的事情。

那么，什么是操作系统，什么是硬件架构？

### 更新

代码在我尝试的时候发生了变化，所以这里是对更新版本的测试：

```
bash $ cat bar-prime.c
#include <stdio.h>

void somefun (unsigned int nState)
{
    switch (nState) // <-- Crashes on this line
    {
        //
        // functionality here ...
        //
      default:
        printf("Hello?\n");
    }
}

enum {

    UNDEFINED = -1,
    STATE_NICE,
    STATE_GREEDY
} E_STATE;

int main (int argc, char *argv [])
{

    somefun (STATE_NICE);
    return 0;
}
bash $ gcc -Wall bar-prime.c -o bar-prime && ./bar-prime
Hello?
bash $ 
```

仍然有效。您是否在您的版本中获得核心文件？您是否尝试过获取堆栈跟踪？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T05:12:26.827

我使用 gcc 4.2.4 版在我的计算机上完全编译并运行了该代码（剪切和粘贴），没有错误或分段错误。我相信问题可能出在其他地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T16:19:00.143

您的情况就像特定于 sun sparc 硬件或类似设备。请发布 uname -a 和 dmesg 的输出

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T04:35:33.280

从您的所有答案看来，代码在逻辑上是正确的，我需要调查崩溃的*真正*原因。我会调查它并尽快发布。

# c# - 在 C# 中使用 RegEx 和 XML 的解析器

> ID：613615
> 
> 赞同：0
> 
> 时间：2009-03-05T04:55:42.703
> 
> 标签：c#, xml, regex, parsing

我正在制作一个应用程序，我需要验证每一行的语法，其中包含一个涉及关键字作为第一个单词的命令。
此外，如果语法正确，我需要检查关键字中使用的变量的类型。

就像如果有一个打印命令：

```
 print "string" < variable < "some another string" //some comments

  print\s".*"((\s?<\s?".*")*\s?<\s?(?'string1'\w+))?(\s*//.*)? 
```

所以我做了以下正则表达式：

```
 \s*[<>]\s*((?'variant'\w+)(\[\d+\])*) 
```

这是访问变体组中的所有单词以提取使用的变量并验证它们的类型。
像这样我的工具有很多关键字，目前我正在为每个关键字粗略地编写正则表达式。如果明天有变化，我会在每个关键字的任何地方都替换相应的变化。
我将每个关键字的正则表达式存储在 XML 文件中。但是我有兴趣使它可扩展，说规范明天会改变，所以我只需要改变一次，它会反映在所有地方，比如我将打印正则表达式转换为：

```
print %string% (%<% %string%|%variable%)* %comments% 
```

现在像这样，我为每个关键字编写一个规范，并将字符串、变量、注释的定义写入另一个存储它们的正则表达式的文件中。然后我编写一个解析器来解析这个字符串并为我创建一个正则表达式字符串。

这可能吗？

有没有更好的方法可以做到这一点，或者有什么方法可以在 XML 中做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T05:08:08.773

上次我问这样的问题时，有人指给我[http://www.antlr.org/](http://www.antlr.org/)。享受。:-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T11:26:00.127

我有了一个想法并制作了自己的替代品。我使用 %myname% 类型的标签来定义我的正则表达式，我使用正则表达式分别编写了 %myname% 标签的定义。然后我递归地扫描字符串并将 %myname% 标记的出现转换为它们所拥有的规范。它完成了我的工作。谢谢任何方式

# security - 为什么质询-响应方法是忘记密码的糟糕解决方案？

> ID：613619
> 
> 赞同：5
> 
> 时间：2009-03-05T04:59:25.127
> 
> 标签：security, authentication, forgot-password

我的公司正在开发一个在线 HR 和薪资应用程序，其中安全访问至关重要。我很清楚如何锁定大多数身份验证/授权过程，但“忘记密码”页面除外。

我最初的计划是要求用户输入电子邮件地址和对先前选择/输入的挑战问题的回复，并将临时密码邮寄到列出的电子邮件（假设电子邮件有效）。但是我在[这里](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta#477583)和[这里](https://stackoverflow.com/questions/522967/forgot-password-what-is-the-best-method-of-implementing-a-forgot-password-functi)（都在 SO 上）读到挑战-响应方法是不安全的。

但是，如果我们只是通过电子邮件发送临时密码，真的那么不安全吗？我能想到的唯一更安全的选择是要求用户致电他们的客户服务代表，这会给我们的员工带来很大负担。

我错过了什么......有更好的方法吗？谢谢！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-05T05:01:58.973

不要通过电子邮件发送临时密码，而是通过电子邮件向用户发送 URL+token 到重置密码页面。这样一来，任何密码都不会在未加密的情况下易手。如果最终用户尝试访问该页面并且重置令牌已被使用，那么最终用户也会立即发现他们的帐户已被盗用。

从评论中添加：

我认为挑战-响应（“秘密问题”）方面实际上使事情变得不那么安全，因为它们通常是可以通过研究有关目标的公共信息发现的事情。步骤总数越少，在无人知晓的情况下可以破解的越少。让重置电子邮件尽早发送通常是让人们知道正在尝试的好方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T05:41:54.790

正如[本文](http://blog.wired.com/27bstroke6/2008/09/palin-e-mail-ha.html)中所解释的，州长佩林的电子邮件帐户最近被黑客使用了对以前提出的问题的回答。来自文章：

> 正如帖子中所详述的，Palin hack 不需要任何真正的技能。取而代之的是，黑客只需使用佩林的出生日期、邮政编码和她在哪里认识她的配偶的信息——她雅虎帐户上的安全问题，通过简单的谷歌搜索就得到了答案（瓦西拉高）来重置佩林的密码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T20:50:06.340

有几种常见的方法来管理丢失的密码：

*   秘密问题：它实际上是一种较弱的身份验证形式，就像上面发布的人一样。用户可以选择一些非常简单并且很容易猜到的东西。我不建议这样做，因为它不需要任何技术“黑客”

*   邮寄新密码。要绕过此控制，需要访问电子邮件帐户或需要中间人 (MITM) 职位：您要么从用户的收件箱中读取临时密码，要么在中间拦截。这种方法很容易被滥用，因为任何人都可以重置密码并强制用户退出系统，如果他无法阅读新密码的电子邮件。

*   邮寄密码重置哈希，为了避免这种情况，您需要访问收件箱或 MITM，就像在此之前的情况一样，但在确认完成之前实际上不会重置密码。因此，即使他没有阅读电子邮件，用户也不能被锁定在系统之外。将冷却计时器添加到每 8 小时重置一次，以防止您的系统淹没用户的收件箱。

*   考虑一些带外通信，例如，在打印的合同中，写下 PIN。然后让用户使用已知电话号码致电您的帮助台（检查来电显示）并提供他的用户名和 PIN。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T05:44:47.873

像 SO 那样外包整个密码管理并使用 OpenId 或类似的东西不是很容易/可行吗？当然，这会增加另一个依赖项，但是您可以将其与保存（和保护）密码的需要进行交换，并按照您的描述处理它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T14:06:30.257

你说这是一个在线人力资源和工资单应用程序。您是否可以选择让用户表明他/她忘记了他/她的密码，并向人力资源代表或组织中的某些官员发送消息，他们可以确认身份，然后重设密码？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-04T15:09:48.783

简而言之，挑战问题往往是最薄弱的环节。它们比密码更容易猜到，并且有效地充当密码的代理，因此它们实际上降低了安全性，而不是通过提供另一种实际上更容易破解的攻击向量来增强安全性。[Web Application Hacker's Handbook](https://rads.stackoverflow.com/amzn/click/com/0470170778)提供了有关这方面的一些重要信息。

# iphone - 如何在播放声音时显示 UIImageView？

> ID：613626
> 
> 赞同：2
> 
> 时间：2009-03-05T05:00:59.773
> 
> 标签：iphone

我正在尝试在播放声音时显示图像。我可以让它出现，但是一旦声音完成播放，我就无法让它消失。

### 我的代码：

```
-(IBAction)guitarChord:(id)sender
{
    if (theAudio.playing == YES) {
        theAudio.stop;
        theAnimation.stop;
    } else {
        theAudio.play;   
        theAnimation.play;   
    }
} 
```

我正在使用 AVAudioPlayer。

任何想法我做错了什么？

如何检测声音已停止？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T05:16:45.880

简单来说，你需要看看 AVAudioPlayerDelegate 和 audioPlayerDidFinishPlaying。

# picasa - 谁知道 Picasa 是用什么编程的？

> ID：613630
> 
> 赞同：8
> 
> 时间：2009-03-05T05:05:59.353
> 
> 标签：picasa

我正在寻找有关如何构建 Picasa 的信息，因为我想为我的应用程序创建一个类似的界面。

信息可以包括编程语言、UI设计等。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-05T05:13:02.067

我发现这个[美丽的 Picasa UI 是由动态 PSD 文件组成的](http://web.archive.org/web/20081120034208/http://www.secretrobot.com/blog/archives/2004/11/the_beautiful_p_1.html)：

> 我在 Picasa 的“运行时”文件夹中四处窥探，发现了一堆 Photoshop .PSD 文件。果然，大部分 UI 都是在 Photoshop 中构建的。层用于组织按钮、替身和光标。翻转是通过类似于 JavaScript/DHTML 的图像替换来实现的。例如，时间线视图只是一个 640x480 的图像，带有一个标记层，用于保存所选组的缩略图和在他们自己的层集中定义的自定义光标。
> 
> Picasa 的底层图形引擎很可能是一个简化的“Photoshop 运行时”，带有一个 DOM，可以轻松定位从 .PSD 文件导入的标记元素。这是一个智能架构，因为它提供了快速的 UI 原型设计和跨不同平台的一致外观。设计人员可以在 Photoshop 中进行更改，然后重新启动 Picasa 以查看结果。更好的是，最终用户无需学习任何新工具即可对应用程序进行皮肤设计。
> 
> “运行时”文件夹还包含一些简单的脚本，这些脚本将 UI 元素绑定到它们的 .PSD 对应项，并定义布局位置和可见性。

# c# - 如何从 C# 中唯一地识别 USB 密钥？

> ID：613634
> 
> 赞同：5
> 
> 时间：2009-03-05T05:09:57.927
> 
> 标签：c#, windows

我希望能够检测到何时插入 USB 密钥。此外，如果我能区分 USB 密钥 A 和 USB 密钥 B，那么我的状态会更好。最后，如果我可以使用某种硬件序列号、MAC 地址或其他任何东西来唯一地识别密钥，那么我就处于最佳状态。

基本上，我正在考虑使用 USB 密钥作为硬件加密狗来“解锁”我的 C# 应用程序。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T05:24:15.440

所有硬盘驱动器都有一个序列号，USB 闪存驱动器也不例外。这是一篇带有示例项目的文章，展示[了如何获取非易失性序列号](http://www.cfdan.com/posts/Retrieving_Non-Volatile_USB_Serial_Number_Using_C_Sharp.cfm)。基本上，您只需要枚举系统驱动器并获取 PNPDeviceID 属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T05:16:46.427

您需要检索密钥的[Hardware ID](http://ezinearticles.com/?Unique-Hardware-ID-in-C&id=1057498)。

我看不到如何订阅插件事件，但您也可以随时让用户单击按钮。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-14T18:53:51.847

硬盘 ID 不是唯一的。也许理论上是这样，但实际上并非如此。这没有任何破解、模拟器或任何特殊程序。

# c++ - C++ 中的无效转换问题

> ID：613642
> 
> 赞同：2
> 
> 时间：2009-03-05T05:15:26.960
> 
> 标签：c++, string, char

我有以下片段：

```
string base= tag1[j]; 
```

这给出了无效的转换错误。

我下面的代码有什么问题？我该如何克服它。

完整代码在这里：

```
#include <iostream>
#include <vector>
#include <fstream>
#include <sstream>
#include <time.h>
using namespace std;

int main  ( int arg_count, char *arg_vec[] ) {
    if (arg_count < 3 ) {
        cerr << "expected one argument" << endl;
        return EXIT_FAILURE;
    }

    // Initialize Random Seed
    srand (time(NULL));

    string line;
    string tag1     = arg_vec[1];
    string tag2     = arg_vec[2];

    double SubsRate = 0.003;
    double nofTag   = static_cast<double>(atoi(arg_vec[3])); 

    vector <string> DNA;
      DNA.push_back("A");
      DNA.push_back("C");
      DNA.push_back("G");
      DNA.push_back("T");

      for (unsigned i=0; i < nofTag ; i++) {

          int toSub = rand() % 1000 + 1;

          if (toSub <= (SubsRate * 1000)) {
              // Mutate
              cout << toSub << " Sub" << endl;

              int mutateNo = 0;
              for (int j=0; j < tag1.size(); j++) {

                  mutateNo++;

                  string base = tag1[j]; // This fail

                  int dnaNo = rand() % 4;

                  if (mutateNo <= 3) {
                     // Mutation happen at most at 3 position
                        base = DNA[dnaNo];
                  }

                  cout << tag1[j] << " " << dnaNo << " " << base  <<  endl;
                  //cout << base;

              }
               cout << endl;

          }
          else {
              // Don't mutate
              //cout << tag1 << endl;
          }

      }
    return 0;
} 
```

为什么在循环字符串时会得到无效的`char`转换？`const char*`

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T05:24:09.357

`std::string operator []`返回单个字符。字符串不能用单个字符实例化。

采用：

`string base = string( 1, tag1[j] )`反而

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T05:22:36.443

将其更改为

```
char base = tag1[j]; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T05:21:50.720

字符串 tag1 = arg_vec[1];

tag1 是一个字符串文字。

`string base = tag1[j];`用 a`char`而不是初始化`char *`。

尝试，`char base = tag1[j];`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T05:25:44.067

没有构造函数`string`只需要一个`char`（就是这样`tag1[j]`）。你有几个选择：

```
string base;  // construct a default string
base  = tag1[j]; // set it to a char (there is an 
                 //   assignment from char to string, 
                 //   even if there's no constructor 
```

或者

```
string base( 1, tag1[j]);  // create a string with a single char 
```

或者正如[Josh 提到](https://stackoverflow.com/questions/613642/why-do-i-get-an-invalid-conversion-from-char-to-const-char-when-looping-over/613656#613656)的那样，您可以定义`base`为 a `char`，因为无论如何您都没有对其执行任何字符串操作。如果您决定这样做，则需要更改`DNA`为 a `vector<char>`（并将初始化更改`DNA`为使用字符而不是字符串）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T05:23:00.233

一个问题是错误消息说程序需要一个参数，而实际上它需要两个参数。您可能应该遵循 Unix 约定并显示所需的用法（或相反）：

```
if (arg_count != 3) {
    cerr << "Usage: " << arg_vec[0] << " tag1 tag2";
    return EXIT_FAILURE;
} 
```

'argc' 和 'argv' 的名称非常传统（我见过的唯一主要替代品是 'ac' 和 'av'）。可能值得坚持下去。

# language-agnostic - 我应该使用像 IEnumerable 这样的接口，还是像 List<> 这样的具体类

> ID：613652
> 
> 赞同：4
> 
> 时间：2009-03-05T05:19:44.190
> 
> 标签：language-agnostic, oop, polymorphism

我最近在别处*表达了我对此的看法，但我认为它值得进一步分析，所以我将其作为自己的问题发布。

假设我需要在我的程序中创建和传递一个容器。至少在现阶段，我可能对一种容器与另一种容器没有强烈的看法，但我确实选择了一个；为了争论，假设我将使用*List<>*。

问题是：**编写我的方法来接受和返回高级接口（例如 C# 的*IEnumerable* ）是否更好？或者我应该编写方法来获取和传递我选择的特定容器类。**

我应该寻找哪些因素和标准来决定？哪种程序可以从其中一种或另一种中受益？计算机语言会影响您的决定吗？表现？程序规模？个人风格？

（这还重要吗？）

**（作业：找到它。但请在寻找我自己的答案之前在这里发布您的答案，以免偏见您。）*

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-05T05:24:33.757

您的方法应始终接受执行其功能所需的最不具体的类型。如果您的方法需要枚举，请接受`IEnumerable`. 如果它需要做`IList<>`特定的事情，根据定义，你必须给它一个`IList<>`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T05:24:22.307

唯一会影响您的决定的是您计划如何使用该参数。如果您只是对其进行迭代，请使用`IEnumerable<T>`. 如果您正在访问索引成员（例如`var x = list[3]`）或以任何方式修改列表（例如`list.Add(x)`），请使用`ICollection<T>`或`IList<T>`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T09:39:59.430

正是与我的讨论引发了这个问题，所以 Euro Micelli 已经知道我的答案了，但就是这样！:)

我认为 Linq to Objects 已经为这个问题提供了一个很好的答案。通过对一系列项目使用最简单的接口，它为如何实现该序列提供了最大的灵活性，这允许延迟生成，在不牺牲性能的情况下提高生产力（不是真正意义上的）。

确实，过早的抽象会产生成本——但主要是发现/发明新抽象的成本。但是，如果您已经为您提供了非常好的接口，那么如果您不利用它们，那就太疯狂了，而这正是通用集合接口为您提供的。

有些人会告诉你，公开一个类中的所有数据“更容易”，以防万一你需要访问它。同样，Euro 建议最好对容器`IList<T>`（甚至是具体的类`List<T>`）使用丰富的接口，然后再清理这些烂摊子。

但我认为，就像最好隐藏一个你不想访问的类的数据成员一样，让你以后可以轻松地修改该类的实现，所以你应该使用最简单的接口来引用一系列项目。在实践中，先暴露一些简单和基本的东西，然后再“放松”它，这比从松散的东西开始并努力强加秩序要容易得多。

所以假设`IEnumerable<T>`会代表一个序列。然后在您需要`Add`或`Remove`项目（但仍不需要按索引查找）的情况下，使用`IContainer<T>`继承`IEnumerable<T>`，因此将与您的其他代码完美互操作。

这样一来（仅通过对某些代码的本地检查）就可以完全清楚地知道该代码将能够对数据做什么。

小程序需要较少的抽象，这是真的。但如果他们成功了，他们往往会成为大项目。如果他们首先使用简单的抽象，这会容易得多。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T05:47:00.520

总是有一个权衡。一般的经验法则是在层次结构中尽可能高地声明事物。因此，如果您只需要访问 IEnumerable 中的方法，那么这就是您应该使用的。

另一个最近的 SO 问题示例是一个 C API，它采用文件名而不是 File *（或文件描述符）。那里的文件名严重限制了可以传递的东西（有很多东西可以用文件描述符传递，但只有一个有文件名）。

一旦你必须开始铸造，你要么太高了，要么你应该制作第二种方法，采用更具体的类型。

我能想到的唯一例外是当速度是绝对必要的并且您不想花费虚拟方法调用的费用时。声明特定类型消除了虚函数的开销（将取决于语言/环境/实现，但作为可能正确的一般陈述）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T09:21:20.740

[我在这里](https://stackoverflow.com/questions/21715/listbusinessobject-or-businessobjectcollection/483504#483504)回答了一个类似的 C# 问题。我认为您应该始终提供最简单的合同，在我看来，在集合的情况下，通常是 IEnumerable Of T。

该实现可以由内部 BCL 类型提供 - 无论是 Set、Collection、List 等 - 其所需成员由您的类型公开。

您的抽象类型始终可以继承简单的 BCL 类型，这些类型由您的具体类型实现。在我看来，这可以让你更容易地坚持[LSP](https://stackoverflow.com/questions/56860/what-is-the-liskov-substitution-principle)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T05:26:20.537

这确实很重要，但正确的解决方案完全取决于使用情况。如果您只需要做一个简单的枚举，那么一定要使用 IEnumerable，这样您就可以传递任何实现者来访问您需要的功能。但是，如果您需要列表功能，并且您不想创建列表的新实例，如果碰巧每次调用该方法时传递的可枚举不是列表，那么请使用列表。

# ajax - 使用 AJAX 进行内联编辑 - 如何在同一页面上创建多个可编辑区域？

> ID：613670
> 
> 赞同：0
> 
> 时间：2009-03-05T05:28:31.873
> 
> 标签：ajax, inline-editing

我找到了有关如何使用 AJAX 在页面上创建可编辑区域的教程。

这很棒，除了它是为具有唯一 ID 的单个元素编写的。我希望能够单击同一页面上的多个元素并使它们也可编辑（例如，我想更改下面的脚本，使其不与单个元素一起使用，而是与特定元素的多个元素一起使用**类**）。

这是我的 HTML：

```
<h2>Edit This</h2>
<p class="edit">This is some editable content</p>
<p class="edit">This is some more editable content</p>
<p class="edit">I could do this all day</p> 
```

这是我正在使用的 JS 文件（我根据下面 Rex 的回答更新了脚本）：不幸的是，这个脚本不起作用 - 谁能指出我正确的方向？

```
Event.observe(window, 'load', init, false);

function init() {
    makeEditable('edit');
}

function makeEditable(className) {
    var editElements = document.getElementsByClassName(className);
    for(var i=0;i<editElements.length;i++) {
        Event.observe(editElements[i], 'click', function(){edit($(className))}, false);
        Event.observe(editElements[i], 'mouseover', function(){showAsEditable($(className))}, false);
        Event.observe(editElements[i], 'mouseout', function(){showAsEditable($(className), true)}, false);
    }
}

function showAsEditable(obj, clear) {
    if (!clear) {
        Element.addClassName(obj, 'editable');
    } else {
        Element.removeClassName(obj, 'editable');
    }
}

function edit(obj) {
    Element.hide(obj);

    var textarea ='<div id="' + obj.id + '_editor"><textarea cols="60" rows="4" name="' + obj.id + '" id="' + obj.id + '_edit">' + obj.innerHTML + '</textarea>';

    var button = '<input type="button" value="SAVE" id="' + obj.id + '_save"/> OR <input type="button" value="CANCEL" id="' + obj.id + '_cancel"/></div>';

    new Insertion.After(obj, textarea+button);

    Event.observe(obj.id+'_save', 'click', function(){saveChanges(obj)}, false);
    Event.observe(obj.id+'_cancel', 'click', function(){cleanUp(obj)}, false);
}

function cleanUp(obj, keepEditable) {
    Element.remove(obj.id+'_editor');
    Element.show(obj);
    if (!keepEditable) showAsEditable(obj, true);
}

function saveChanges(obj) {
    var new_content = escape($F(obj.id+'_edit'));

    obj.preUpdate = obj.innerHTML // stow contents prior to saving in case of an error
    obj.innerHTML = "Saving…";
    cleanUp(obj, true);

    var success = function(t){editComplete(t, obj);}
    var failure = function(t){editFailed(t, obj);}

    var url = 'http://portal.3roadsmedia.com/scripts/edit.php';
    var pars = 'id=' + obj.id + '&content=' + new_content + '&pre=' + obj.preUpdate;
    var myAjax = new Ajax.Request(url, {method:'post',
    postBody:pars, onSuccess:success, onFailure:failure});
}

function editComplete(t, obj) {
    obj.innerHTML = t.responseText;
    showAsEditable(obj, true);
}

function editFailed(t, obj) {
    obj.innerHTML = 'Sorry, the update failed.';
    cleanUp(obj);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T05:33:45.870

该`Event.observe`方法当前附加到具有指定 ID 的单个元素。您应该将其更改为遍历由类名定位的元素集合并附加到每个元素。根据 Prototype 文档，您可以提供元素对象作为第一个参数，而不是 ID。

目前，`id`是一个字符串：

```
function makeEditable(id) {
    Event.observe(id, 'click', function(){edit($(id))}, false);
    //... 
```

这意味着 Event.observe 使用提供的 ID 附加到元素的单击事件。你想用一个类附加到所有元素。尝试：

```
function makeEditable(className) {
    var editElements = document.getElementsByClassName(className);
    for(var i=0;i<editElements.length;i++) {
        Event.observe(editElements[i], 'click', function()
        //...
    }
    //... 
```

# c# - 如何在不重新排列数组元素的情况下计算数组中的唯一数字？

> ID：613671
> 
> 赞同：10
> 
> 时间：2009-03-05T05:30:44.600
> 
> 标签：c#, arrays, algorithm

我无法计算数组中的唯一值，我需要这样做而不重新排列数组元素。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-05T05:31:58.263

如果您有 .NET 3.5，您可以通过以下方式使用 LINQ 轻松实现此目的：

```
int numberOfElements = myArray.Distinct().Count(); 
```

非 LINQ：

```
List<int> uniqueValues = new List<int>();
for(int i = 0; i < myArray.Length; ++i)
{
    if(!uniqueValues.Contains(myArray[i]))
        uniqueValues.Add(myArray[i]);
}
int numberOfElements = uniqueValues.Count; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-05T05:43:48.873

这是一种效率更高的非 LINQ 实现。

```
 var array = new int[] { 1, 2, 3, 3, 3, 4 };
        // .Net 3.0 - use Dictionary<int, bool> 
        // .Net 1.1 - use Hashtable 
        var set = new HashSet<int>();
        foreach (var item in array) {
            if (!set.Contains(item)) set.Add(item);
        }
        Console.WriteLine("There are {0} distinct values. ", set.Count); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T10:12:02.363

O(n) 运行时间 max_value 内存使用量

```
boolean[] data = new boolean[maxValue];
for (int n : list) {
   if (data[n]) counter++
   else data[n] = true;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T22:41:41.517

Should only the distinct values be counted or should each number in the array be counted (e.g. "number 5 is contained 3 times")?

The second requirement can be fulfilled with the starting steps of the counting sort algorithm.
It would be something like this:

*   build a set where the index/key is the element to be counted
*   a key is connected to a variable which holds the number of occurences of the key element
*   iterate the array
    *   increment value of key(array[index])

Regards

# sql-server - 在 TSQL 中，您将如何从 int 转换为 datetime 并给出年龄？

> ID：613678
> 
> 赞同：6
> 
> 时间：2009-03-05T05:37:13.523
> 
> 标签：sql-server, tsql

下面的sql是什么，

我在一个 int 字段中有一个出生日期，

即 YYYYMMDD = 19600518

我想知道年龄。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-06T17:04:25.220

其他答案都没有真正计算年龄。他们正在计算年份界限的数量，而不是考虑生日。

要计算年龄，您需要执行以下操作：

```
DECLARE @d DATETIME
SET @d = CONVERT(DATETIME, CONVERT(VARCHAR(8), 19600518), 112)

SELECT DATEDIFF(year, @d, GETDATE())
    - CASE WHEN DATEADD(year, DATEDIFF(year, @d, GETDATE()), @d) <= GETDATE()
           THEN 0 ELSE 1 END AS Age 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T01:32:45.973

大多数其他答案都*没有*计算年龄 - 只是整年（例如，2009 年 1 月 1 日是 2008 年 12 月 31 日之后的一个“年”）。因此，如果您使用此页面上的*大部分*计算，您将平均返回半年的错误年龄。卢克是唯一看到这一点的人，但他的回答让我觉得太复杂了——有一种更简单的方法：

```
Select CAST(DATEDIFF(hh, [birthdate], GETDATE()) / 8766 AS int) AS Age 
```

（注意：感谢“学习”让我对我的原始算法有了很好的了解——这是一个使用小时而不是天的修订版）

因为这里的四舍五入非常精细，所以对于每年的每一天来说这*几乎是完全准确的。*例外是如此令人费解，以至于它们几乎是幽默的：如果我们 A) 要求在早上 6:00 之前的年龄，B) 在这个人的生日和 C) 他们的生日在之后2 月 28 日。当然，根据某人出生的时间，这可能“技术上”是正确的！在我的环境中，这是一个完全可以接受的折衷方案。

这是一个打印出年龄的循环，以表明这是有效的。

```
Declare @age int;
Declare @BirthDate datetime;
Declare @Year int;
Set @Year = 2008;
WHILE (@Year > 1930)
BEGIN
    -- Put today's date where you see '-03-18'
    SET @BirthDate = CAST(Cast(@Year as varchar(4)) + '-03-18'  AS DATETIME)
    SELECT @age=CAST(DATEDIFF(hh, @BirthDate, GETDATE()) / 8766 AS int);
    Print Cast(@Year as varchar)  + ' Age: ' + Cast(@age as varchar);
    Set @Year = @Year - 1;
END; 
```

最后，这也是将 Paul 的整数日期转换为真实日期的版本：

```
CAST(DATEDIFF(hh, Convert(Datetime, Convert(varchar(8), [birthdate]), 112), GETDATE()) / 8766 AS int) AS Age 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T05:45:09.790

```
DECLARE @dateSt VARCHAR(8)
DECLARE @startDt DATETIME

-- Set the start date string
SET @dateSt = '19600518'

-- Make it a DATETIME (the ISO way)
SET @startDt = CAST(SUBSTRING(@dateSt, 1, 4) + '-' + 
   SUBSTRING(@dateSt, 5, 2) + '-' + 
   SUBSTRING(@dateSt, 7, 2)  AS DATETIME)

-- Age in Days
SELECT DATEDIFF(D, @startDt, getdate()) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T05:56:54.287

年龄：

```
select datediff(YY, convert(datetime, convert(varchar, 19600518)), getdate()) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T02:02:27.837

```
[EDIT]

-- I forgot to declare the variables

declare @birthday datetime;
set @birthday = convert(datetime,convert(varchar, 19600518), 112);
declare @datetoday datetime;
set @datetoday = getdate();

select 
(
CASE
WHEN dateadd(year, datediff (year, @birthday, @datetoday), @birthday) <= @datetoday
THEN datediff (year, @birthday, @datetoday)     
ELSE datediff (year, @birthday, @datetoday) - 1
END) as age; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T05:45:39.197

这是一种单线方法：

```
CONVERT(DATETIME, CONVERT(VARCHAR(8),19600518), 112) 
```

但要小心！这依赖于 T-SQL，可能无法在其他 SQL 环境中工作。

请注意，112 的“样式”只是 yyyymmdd 的“ISO”日期格式。（我在一些[CONVERT](http://doc.ddart.net/mssql/sql70/ca-co_1.htm)文档中找到的东西。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T06:02:56.707

我解决了，得到了和@Learning一样的结果

```
select dob, datediff(year, convert(datetime, convert(varchar(8),[dob])) ,getdate()) as age
from  [mytable]
where IsDate(convert(varchar(8),[dob])) = 1 
```

注意。我需要 IsDate 以及数据中的一些无效日期。

编辑。这是[SQLServerCentral 关于计算年龄的文章。](http://www.sqlservercentral.com/articles/T-SQL/63351/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T15:19:47.727

这就是为什么您不应该将日期存储为除日期时间数据类型之外的任何内容的原因。最好的解决方法是更改​​您的数据类型并将所有日期转换一次（如果其中也很少有无效日期，也不会感到惊讶）。那么你再也不需要做这些变通方法了。

# php - 将服务器变量回显到页面时，我是否已经覆盖了所有安全基础？

> ID：613680
> 
> 赞同：1
> 
> 时间：2009-03-05T05:38:02.460
> 
> 标签：php, security, xss

使用我一直使用的表格

```
<form method="post" action="<?php echo strip_tags($_SERVER['REQUEST_URI']); ?>"> 
```

让我的表格提交给自己。

我使用`striptags()`以防有人链接到：

```
http://www.mysite.com/page-with-form.php?bla="><script src="http://www.nasty.com/super-nasty.js"></script><a href="# 
```

我是否涵盖了所有基础，以防止 XSS 攻击，或者我应该使用更多的白名单方法，比如只允许字母数字字符、正斜杠、问号、等号、括号等的正则表达式？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T06:12:41.627

使用[`htmlspecialchars`](http://docs.php.net/htmlspecialchars)而不是`strip_tags`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T06:17:11.307

如果你想引用相同的模式/主机/路径一个简单的动作=“？” 应该够了。根据[https://www.rfc-editor.org/rfc/rfc3986#section-4.2](https://www.rfc-editor.org/rfc/rfc3986#section-4.2)

```
相对参考=相对部分[“？” 查询] [“#”片段]

      relative-part = "//" 权限路径-abempty
                    /绝对路径
                    /路径-noscheme
                    / 路径为空

```

这是一个有效的相对 uri。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T05:50:00.277

通过将表单发送到此来提交表单：

```
$_SERVER["PHP_SELF"] 
```

该全局变量将输出当前页面。除非有理由需要整个查询字符串吗？

**编辑**

正如 VolkerK 在评论中指出的那样，even`PHP_SELF`是易受攻击的，您可以根据 URI 编写自己的小变量`PHP_SELF`并分解出您知道不属于您的页面的 URI 的其余部分。像这样的东西：

```
$file_ext = '.php'; //knowing what file extension your URI is
$page_on = $_SERVER["PHP_SELF"]; //grab this page, with all that junk
$page_huh = explode($file_ext, $page_on); //blow it apart based on file ext
$page_on = $page_huh[0].$file_ext; //attach the leg back onto the URI

echo $page_on; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T05:56:25.927

如果您`striptags()`只去除标签（“<”和“>”之间的字符，包括尖括号），仍然有人可以注入 javascript：

```
http://www.mysite.com/page-with-form.php?bla=" onsubmit="return function(){ /*nasty code here*/ }()" style=" 
```

更好地将 HTML、Javascript 和 CSS 中所有可能的元字符列入白名单（即尖括号、圆括号、大括号、分号、双引号、单引号等）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T03:59:02.203

如果您希望表单提交给自己，只需将操作留空，例如

```
<form action="" method="POST">
...
</form> 
```

# database-design - “惩罚”开发者还是自动修复它？触发器与约束

> ID：613682
> 
> 赞同：0
> 
> 时间：2009-03-05T05:39:32.580
> 
> 标签：database-design, triggers, constraints

假设我有一个应始终为大写的数据库列。

这里有几个想法：

1）创建一个列约束：`col = UPPER(col)`

2）创建一个插入/更新行触发器之前设置：`col = UPPER(col)`

通常对数据库数据的约束越多越好，而触发器可能是神秘而糟糕的。假设编写代码的开发人员在同一个组织中，因此他们编写的代码可以由我们修改。

你会使用哪种方法，为什么？

它必须是大写的，因为有问题的数据实际上总是大写的（它最初是由各种第三方以这种方式打印的）。对于此特定字段，大写与小写没有任何意义。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-05T05:47:01.860

这取决于为什么该列需要大写，但总的来说我会选择约束。

我不喜欢在将数据插入数据库时​​更改数据的东西。这意味着我写的内容与下次阅读的内容不匹配。

如果文本已由用户输入，请考虑添加一个包含大写版本的额外列。这样，您始终可以显示用户输入的文本

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T05:43:37.703

在大多数情况下，我会说（1），因为正如您所指出的，触发器通常可能是坏的/奇怪的（尽管并非总是如此）。但是在处理字符串区分大小写时，我倾向于将其视为一种特殊情况，并始终在沿途的每一步进行修复。我不确定我这样做有什么具体的理由，只是“感觉”是对的。可能是因为至少在我工作过的大多数环境中，从业务逻辑的角度来看`FoO`always equals `foo`always equals `FOO`。

此外，在这种情况下，开发人员说“仅供参考，所有字符串都以大写形式存储在服务器上”似乎比每次忘记时都拍他们的手腕来减轻负担。这不像说“仅供参考，每次您将价格插入数据库时​​，都会添加销售税。”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T06:44:01.177

这最好作为一个约束来实现，它可以避免额外的负载并做你想做的事——强制数据采用你需要的格式。

我认为在数据库中强制转换是错误的方法，因为可以在不丢失完整性的情况下转换的数据应该在数据库层中处理。如果案例无关紧要，则照此处理 - 约束有助于捕获错误。

添加不区分大小写的索引可能是更好的解决方案（参见[数据库不](https://stackoverflow.com/questions/12855/database-case-insensitive-index)区分大小写索引）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T05:42:31.967

或者增加自动化测试的覆盖率，并避免生产服务器上的额外负载。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T02:42:09.443

我还会考虑另一种方法 - 提供“表 API”，允许开发人员将值传递给存储过程（或其他），然后确保值在插入时为大写（根据您的示例）。我也会用一个约束来支持这一点（它可以帮助一件事的查询优化）并删除表上的直接更改权限——如果你不相信开发人员将所有插入都大写，那么你不应该相信他们始终使用 TAPI。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-29T22:35:13.320

如果您可以在数据库的列约束中执行某些操作，而不是触发器，则通常首选它，因为它通常更快。如果您正在谈论通过应用程序强制执行，我不建议这样做。如果必须始终应用该规则，则它不应出现在数据库中以外的任何地方。除了您正在为其编写代码的应用程序之外，其他事物都可以更改数据库中的数据。数据完整性是数据库的责任，将代码保存在它所属的位置以避免出现问题。

# javascript - Javascript：这同时评估为真和假！到底是怎么回事？

> ID：613688
> 
> 赞同：1
> 
> 时间：2009-03-05T05:43:48.577
> 
> 标签：javascript

有没有人解释一下javascript如何做到这一点。不知何故，这个函数同时是真假。这只是一次通过，没有循环或任何东西。

```
 console.log(key);
    if (this.watches.get(key)) {
      console.log("found it");
    } else {
      console.log("whhhat?");
    }
    console.log(this.watches); 
```

Firebug 控制台按原样记录。

```
search-key
found it
Object search-key=Object $family=Object
whhhat?
Object search-key=Object $family=Object 
```

**[编辑]** 在这里。上面的完整脚本和输出块是从 firebug 复制和粘贴的。这是我见过的最奇怪的事情。 [http://snipt.org/Hkl](http://snipt.org/Hkl)

我使用 mootools 框架，所以 this.watches = $H({}); 是一个哈希表。我正在使用 Array 并且遇到了完全相同的问题，然后将其切换到 $H({}) 因为我认为我做错了什么。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-05T05:58:09.493

如果这

```
Object search-key=Object $family=Object 
```

由以下公司生产：

```
console.log(this.watches); 
```

那么这*显然*不只是一关。

这并不是说它在一个循环或任何东西中，只是这个代码被多次调用。

有人可能会说

> 为什么搜索键只出现一次？

答案是：我们真的不知道，因为我们没有看到所有的代码。

最可能的情况是`key`第二次是空字符串

试试看`console.log("")` 什么都不打印

也试试这个：

```
>>> console.log(""); console.log(1); console.log(""); console.log(2) 
```

复制输出并将其粘贴到任何文本编辑器中（即粘贴为纯文本）

```
1
2 
```

看起来1*和*2 之间没有任何内容，即使控制台*确实*显示了空行的提示，但是当您将输出复制粘贴为纯文本时，此提示会消失。

**更新**

好吧，如果这个过程是由对 的调用启动的`WCHistory.implement(..)`，并且这个方法被调用了两次，那么显然，第二次，由于某种原因，键是空的。

**试试这个**

更改`console.log(key)`为`console.log("key: " + key)`，您应该会看到如下内容：

```
key: search-key
found it
Object search-key=Object $family=Object
key: 
whhhat?
Object search-key=Object $family=Object 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T05:49:27.143

我认为答案是，这不仅仅是一次通过。

这看起来代码被调用了两次，然后第二次使用空键。可能需要查看更多代码才能确定。

我猜你可以在 if 语句之前添加一个整数计数来确认这个假设。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T07:21:57.640

将您的代码片段更改为此，以查看它是否实际上被调用了两次，但由于某种原因，`console.log(key)`第二次没有输出任何内容。

```
console.log("=====");
console.log(key);
if (this.watches.get(key)) {
  console.log("found it");
} else {
  console.log("whhhat?");
}
console.log(this.watches); 
```

然后你会得到输出：

```
=====
search-key
found it
Object search-key=Object $family=Object
=====
whhhat?
Object search-key=Object $family=Object 
```

如果你得到输出：

```
=====
search-key
found it
Object search-key=Object $family=Object
whhhat?
Object search-key=Object $family=Object 
```

那么我错了，我会删除答案（或者更有可能将其设为社区 wiki，以便其他人不会遵循相同的路径）。

# php - 为什么这个 PHP preg_replace() 不起作用？

> ID：613693
> 
> 赞同：0
> 
> 时间：2009-03-05T05:46:30.957
> 
> 标签：php, mysql, regex

我有一些需要修复的不良 MySQL 条目。我正在尝试在 PHP 中这样做。

**我有什么**：

`a whole bunch of text with no numbers Entry #:`**2439**`. a whole bunch of text Click here to blah blah blah`

**我想要什么**：

`a whole bunch of text with no numbers Entry #:`**2439** `. a whole bunch of text <BR><A href="somepage.php?entry_no=`**2439**`">Click here to blah blah blah</A>`

**我的 PHP 代码**：

```
$fixed = preg_replace('/(.*)(\d*)(.*)(Click here.*)/i',"$1$2$3<BR><A href=\"somepage.php?entry_no=$2\">$4</A>",$originalData); 
```

出于某种原因，这就是我得到的：

`a whole bunch of text with no numbers Entry #:`**2439**`. a whole bunch of text <BR><A href="somepage.php?entry_no=">Click here to blah blah blah</A>`

2 美元第二次没有给我号码。有人有想法么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T06:06:01.643

这是因为第一场比赛是贪婪的：

鉴于此输入，以下是每个部分匹配的内容：

```
a whole bunch of text with no numbers Entry #: 2439\. a whole bunch of text Click here to blah blah blah

(.*)    // "a whole bunch of text with no numbers Entry #: 2439\. a whole bunch of text "
(\d*)   // "" (0 or more numbers)
(.*)    // "" (0 or more characters) 
```

您所要做的就是使第一个匹配不贪心：

```
(.*?)(\d+)(.*)(Click here.*) 
```

此外，由于您在字符串中定义正则表达式，因此您需要转义斜杠：

```
"/(.*?)(\\d*) ... 
```

# ruby - 在 Ruby 中生成不同的范围，即所有可能的 /[0-9A-Za-z]{3}/

> ID：613697
> 
> 赞同：2
> 
> 时间：2009-03-05T05:47:20.987
> 
> 标签：ruby, range

我觉得我在这里使用 Ruby 的方式是错误的：我想为正则表达式生成所有可能的匹配项`/[0-9A-Za-z]{3}/`

我不能使用`succ`，因为`"999".succ => "1000"`和`"zZz".succ => "aaAa"`。我无法使用范围，因为我似乎无法联合`(0..9), ('A'..'Z'), ('a'..'z')`

所以我写道：

```
def alphaNumeric
  #range and succ don't cut it for [0-9a-zA-Z]
  (0..9).each{|x|yield x.to_s}
  ('a'..'z').each{|x|yield x}
  ('A'..'Z').each{|x|yield x}
end
def alphaNumericX3
  alphaNumeric{ |a|
    alphaNumeric{ |b|
      alphaNumeric{ |c|
        yield a+b+c
      }
    }
  }
end
alphaNumericX3.each{|x|p x} 
```

我的问题是2折：

有没有更丑陋的方法，有没有一种方法`alphaNumericX3`可以从参数中定义`(alphaNumeric, 3)`？

PS我知道我可以为范围定义一个新类。但这绝对不会更短。如果您可以使下一个块比上面的块更短、更清晰，请执行以下操作：

```
class AlphaNum
  include Comparable
  attr :length
  def initialize(s)
    @a=s.chars.to_a
    @length=@a.length
  end
  def to_s
    @a.to_s
  end
  def <=>(other)
    @a.to_s <=> other.to_s
  end
  def succ
    def inc(x,n)
      return AlphaNum.new('0'*(@length+1)) if x<0
      case n[x]
      when '9'
        n[x]='A'
      when 'Z'
        n[x]='a'
      when 'z'
        n[x]='0'
        return inc(x-1,n)
      else
        n[x]=n[x].succ
      end
      return AlphaNum.new(n.to_s)
    end
    inc(@length-1,@a.clone)
  end
end
# (AlphaNum.new('000')..AlphaNum.new('zzz')).each{|x|p x}
#  === alphaNumericX3.each{|x|p x} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T07:19:46.177

使用[`Array#product`](http://ruby-doc.org/core/Array.html#method-i-product)：

```
alpha_numerics = ('0'..'9').to_a + ('a'..'z').to_a + ('A'..'Z').to_a
alpha_numerics
  .product(alpha_numerics, alpha_numerics)
  .map { |triplet| triplet.join('') } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T07:38:50.610

```
class String
  def nextify
    case self
    when '9' then 'A'
    when 'Z' then 'a'
    when 'z' then '0'
    else self.succ
    end
  end
end

class AlphaNum
  def initialize(string)
    @string = string
  end

  def succ
    @string.split(//).inject("") { |s,n| s << n.nextify }
  end

  def method_missing(*args, &block)
    @string.send(*args, &block)
  end
end

a = AlphaNum.new("999")
puts a.succ #=> 'AAA' 
```

# .net - 为什么要在 .NET 中复制字符串？

> ID：613699
> 
> 赞同：4
> 
> 时间：2009-03-05T05:47:36.087
> 
> 标签：.net, string

由于字符串在 .NET 中是不可变的，为什么要复制它们以用于简单的操作，例如`Substring`or `Split`？例如，通过保留`char[] value`,`int start`和`int length`，可以创建一个子字符串以简单地指向现有字符串，并且我们可以节省许多简单操作复制字符串的开销。所以我想知道，为什么选择为此类操作复制字符串的决定？

例如，这样做是为了支持当前的实现`StringBuilder`吗？`char[]`或者在只需要几个字符时避免保持对大的引用？还是你能想到的其他原因？你能建议这种设计的优缺点吗？

正如@cletus 提到的并得到@Jon Skeet 的支持，这更像是在问为什么.NET 字符串在这方面与Java 不同。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-05T06:10:18.733

这基本上就是 Java 的工作方式。.NET 方式有一些好处，IMO：

*   参考位置 - 数据和长度在同一个地方
*   更少的取消引用 - 数据位于字符串对象本身的固定点；无需取消引用另一个 char 数组
*   正如 Renaud 所提到的，当您有一个原始大字符串的单个字符子字符串时，缺少别名。
*   您最终会得到更少的对象和变量。对于 .NET 字符串（假设没有浪费缓冲区空间），总大小（在 x86 上）大约为`20+2*n`字节。在 Java 中，您获得了数组 ( `12 + 2*n`) 字节的大小和字符串本身（24 个字节：对象开销、引用、开始和计数；如果计算过哈希，它还会缓存哈希）。所以对于一个空字符串，.NET 版本需要大约 20 个字节，而 Java 需要 36 个字节。当然，这是最坏的情况，它只会是“恒定的差异”——但如果你使用很多独立的字符串，可能最终变得重要。垃圾收集器也可以查看更多内容。

当然，好处是在*不*发生上述混叠时需要更少的空间。

最后，这将取决于您的使用 - 编译器和运行时无法预测在您的确切代码中哪种使用模式更有可能。

当前的字符串表示可能还具有互操作性的好处，但我对此的了解还不足以肯定地说。

编辑：我不确定你的问题为什么会收到这么多有点敌意的答案。这当然不是表示字符串的“愚蠢”方式，而且它显然有效。在这种情况下，对数据丢失和复杂性的担忧几乎只是 FUD，我相信 - Java 字符串实现简单而健壮。我个人*怀疑*.NET 的处理方式在*大多数*程序中更有效，我怀疑 MS 进行了研究以检查这一点，但肯定会有“共享”模型效果更好的情况。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T05:51:33.973

如果你重复使用相同的字符串来返回子字符串，当主字符串超出范围时会发生什么？

在最好的情况下，它需要保留在内存中，并且在所有子字符串也被释放之前无法收集，因此您最终会使用更多的内存。

这只是问题之一。

实际上，垃圾收集器几乎没有选择：

*   将整个原始字符串保留在内存中，即使只使用很短的子字符串。

*   释放原始字符串中未被引用的部分，仅将子字符串保留在原处。这会产生很多碎片，这意味着垃圾收集器可能不得不在某个时候重新定位字符串：无论如何我们最终都会制作副本。

我确信它有它的用例，并且在处理子字符串时（比如在处理大型 XML 文档时）*有时可能会更有效。*
但是，正如 Jon 所说，Java 字符串对象需要更多空间，因此如果您有很多小字符串，它们实际上可能会比 .Net 使用更多的内存。

这是一个权衡。
我认为，如果您的内存管理方式非常重要，并且您需要具有完全可预测的行为，那么 Java 或 .Net 都不是最好的工具。

我们使用垃圾收集器是因为它们经过优化，可以在绝大多数情况下高效工作。
了解它们是如何工作的很重要，但是它们是否重用字符串更多的是留给底层框架的优化，它不应该过多地泄露到表面。
毕竟，GC 是来帮助我们的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T05:53:15.857

在您的子字符串示例中，这意味着我们每次引用“新”字符串时都会重新执行子字符串逻辑。仅此一项的开销就很明显我们为什么要复制字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T06:00:14.887

我想关键是突出以下之间的区别：

1.  不可变字符串
2.  不可变的字符串永远存在

如果字符串是＃2，您所说的将起作用。然而，虽然字符串是不可变的，但它们可以被销毁。

正如您进一步看到的那样，它们有自己的成本：

1.  不可变字符串 - 正如您所提到的，总是制作副本
2.  不可变的字符串永远存在 - 永远创建每个字符串

很容易看出为什么 #1 会更好:)

（但我并不是说#2 不好或愚蠢）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T06:06:54.747

相信我，如果字符串不是不可变的，你会讨厌它。给你一个 Java 的例子： java.util.Date 是可变的，它是一场噩梦。基本上，它强制任何接收数据作为参数或函数返回的人必须防御性地复制它。

我不能说 .Net 字符串，但 Java 的子字符串操作实际上确实引用了主字符串，这意味着 Java 中的每个字符串都有大约 16-20 字节的开销（指向字符串的指针、开始索引、结束索引、长度和可能的东西别的）。这既有优点也有缺点。从内存不足的角度来看，这可能是一个真正的“陷阱”。在我从事的一个项目中，我们使用了大量内存。事实证明，我们正在接收大型消息（数千个字符）并使用子字符串处理它们。因为子字符串保留了对原始字符串的引用，所以原始字符串从未被清除。

现在您可以通过使用 String 构造函数来解决这个问题，但这并不明显，而且很多人不知道这一点。

基本上，您所说的子字符串是真正的蠕虫罐头。小心你想要什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T06:25:44.467

如果字符串对象包含对字符数据的引用，这意味着大多数字符串将是两个对象而不是一个。

# c# - 如何将应用程序的构建日期放在应用程序的某个位置？

> ID：613700
> 
> 赞同：11
> 
> 时间：2009-03-05T05:47:41.640
> 
> 标签：c#

我想将应用程序的构建日期放在应用程序的某个位置。说一下关于框。任何想法如何做到这一点？我需要为 C# 执行此操作，但我也在寻找一个总体思路，因此您可以针对 C# 以外的任何特定语言回答此问题。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-05T06:27:31.843

通常我们只使用可执行文件的最后修改日期。这将在构建 exe 时设置，并且通常永远不会更改（缺少实际编辑文件的人）。当文件被安装、复制、移动等时，Windows 不会更改该值。

```
DateTime buildDate = 
   new FileInfo(Assembly.GetExecutingAssembly().Location).LastWriteTime; 
```

我们将这种技术用于 C# 和 C++ 应用程序中的 about 对话框。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-05T05:55:07.597

如果您使用 [assembly: AssemblyVersion("1.0.*")]，则程序集版本的第三个数字是儒略日期，0=1 Jan 2000

例如

```
DateTime buildDate = new DateTime(2000,1,1).AddDays(
  System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.Build
 ); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T07:55:02.787

您[应该](https://stackoverflow.com/questions/52608/is-subversion-version-control-necessary-for-a-small-development-group-1-2-prog)使用版本控制 - [Subversion](http://subversion.tigris.org/)是免费的。然后，您可以包含来自版本控制系统的数字，该数字将明确标识用于构建应用程序的源代码。约会不会那样做。还有其他优点。

*   项目所有更改的完整历史记录。
*   与同一项目的其他开发人员无缝协作。

编辑：Nikhil 已经在做这一切。但[由于一些难以理解的原因](http://en.wikipedia.org/wiki/Pointy-Haired_Boss)，他被告知也要包括日期。无论如何，对于这个问题的未来读者，我将把这个答案留在这里。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T05:57:49.277

在你的源代码控制系统中通常有这类事情的关键字。

否则，请查看在版本号中包含日期和时间，或者只是创建一个包含日期和时间的小源代码文件，并包含在构建中

# django - 经理每次请求返回一次模型对象（经理在返回一次后丢弃对象）

> ID：613706
> 
> 赞同：0
> 
> 时间：2009-03-05T05:50:04.943
> 
> 标签：django, django-models

该行为与下面立即呈现的问题无关。请参阅帖子底部的说明。谢谢。

* * *

你好，

我目前遇到的行为是，特定模型的默认管理器在每个请求或每个 shell 会话中只返回一次该模型的对象。下面是在视图中停止的 PDB 记录（但在没有 PDB 的情况下也会发生这种行为）：

```
#Nothing up my sleeves (using the default Manager):
(Pdb) p Entry.objects
<django.db.models.manager.Manager object at 0x18523b0>

#Now you see them...
(Pdb) Entry.objects.all()
[<Entry: Entry 1>, <Entry: Entry 2>, <Entry: Entry 3>, <Entry: Entry 4]

#Now you don't!
(Pdb) Entry.objects.all()
[] 
```

每当我检索一个对象时，该对象就不再出现在以后的 QuerySet 中。

```
#(New Request from above)

#If I only request one object then it is the one that disappears
(Pdb) Entry.objects.all()[0]
[<Entry: Entry 1>]

#Here Entry 1 is missing
(Pdb) Entry.objects.all()
[<Entry: Entry 2>, <Entry: Entry 3>, <Entry: Entry 4]

#And now they're all gone.
(Pdb) Entry.objects.all()
[] 
```

此行为仅适用于我的一个模型；其他模型似乎查询正确。我认为这与我的模型的定义没有任何关系，基本上是：

```
class Entry(models.Model):
    user = models.ForeignKey(User, related_name='entries')
    blog = models.ForeignKey(Blog, related_name='entries')
    positive = models.BooleanField() 
```

抱歉，我的描述有点含糊；我对这种行为是如何出现的感到困惑，不知道下一步该在哪里闲逛。

Manager 为 QuerySet 生成的 SQL 每次都是相同的（并且显然是正确的）：

```
(Pdb) p Entry.objects.all().query.as_sql()
('SELECT "myapp_entry"."id", "myapp_entry"."user_id", "myapp_entry"."blog_id", "myapp_entry"."positive" FROM "myapp_entry"', ())
(Pdb) p Entry.objects.all()
[<Entry: Entry 1>, <Entry: Entry 2>, <Entry: Entry 3>, <Entry: Entry 4]

(Pdb) p Entry.objects.all().query.as_sql()
('SELECT "myapp_entry"."id", "myapp_entry"."user_id", "myapp_entry"."blog_id", "myapp_entry"."positive" FROM "myapp_entry"', ())
(Pdb) Entry.objects.all()
[] 
```

我在 Mac OS 10.5 机器上使用 Django 1.0.2、Python 2.6.1 和与 Python 2.6.1 一起打包的 SQLite。

为了回应其中一条评论，我尝试将`related_name`参数重命名为`entries1`并`entries2`避免可能的冲突，但这并没有改变行为。

* * *

已解决（我认为）

对不起，这个问题实际上与我提出的问题无关。我在 Entry 的一个信号中有一个粗心的错误：

在`myapp.__init__`：

```
post_init.connect(entry_initialized, sender=Entry) 
```

在`myapp.signals`：

```
def entry_initialized(sender, instance, *args, **kwargs):
    try:
        #Disconnect signal to avoid infinite recursion
        post_init.disconnect(entry_initialized, sender=Entry)

        #Intializing a new Entry here would cause the recursion
        #Check to see if there is a previous entry by this user in this blog
        #In this app entries are unique by (User, Blog)
        #And what we want to do is remove the old Entry if the positive fields don't match
        prev_instance = Entry.objects.get(user=instance.user, blog=instance.blog)

        #This is an error: it is not appropriate to delete without some checking
        prev_instance.delete()

        post_init.connect(verification_initialized, sender=Verification)
    except:
        post_init.connect(verification_initialized, sender=Verification) 
```

我的代码的正确版本是：

```
 #Only delete if this is a different Entry with same user/blog and the positive field is different.
        if not instance.id == prev_instance and not instance.positive == prev_instance.positive:
            prev_instance.delete() 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-02-14T20:55:22.890

对不起，这个问题实际上与我提出的问题无关。我在 Entry 的一个信号中有一个粗心的错误：

在`myapp.__init__`：

```
post_init.connect(entry_initialized, sender=Entry) 
```

在`myapp.signals`：

```
def entry_initialized(sender, instance, *args, **kwargs):
    try:
        #Disconnect signal to avoid infinite recursion
        post_init.disconnect(entry_initialized, sender=Entry)

        #Intializing a new Entry here would cause the recursion
        #Check to see if there is a previous entry by this user in this blog
        #In this app entries are unique by (User, Blog)
        #And what we want to do is remove the old Entry if the positive fields don't match
        prev_instance = Entry.objects.get(user=instance.user, blog=instance.blog)

        #This is an error: it is not appropriate to delete without some checking
        prev_instance.delete()

        post_init.connect(verification_initialized, sender=Verification)
    except:
        post_init.connect(verification_initialized, sender=Verification) 
```

我的代码的正确版本是：

```
 #Only delete if this is a different Entry with same user/blog and the positive field is different.
        if not instance.id == prev_instance and not instance.positive == prev_instance.positive:
            prev_instance.delete() 
```

# c# - 将 VSTO Word 2007 模板应用程序保存到 docx 而不提示保存模板

> ID：613710
> 
> 赞同：1
> 
> 时间：2009-03-05T05:53:04.983
> 
> 标签：c#, ms-word, vsto

重现步骤：

1.  创建 Word 2007 模板项目 (Visual Studio 2008 Professional SP1)
2.  将 DateContentControl 放在文档上
3.  保存、发布、打开 .dotx
4.  修改 DateContentControl，保存
5.  单击否，关闭 Word
6.  打开已保存的文档，修改 DateContentControl - 后续保存不再提示...
7.  更改项目代码，发布，更新 V​​STO 应用程序，打开 .dotx，重复步骤 4

Word 2007 模板应用程序如何允许用户在不提示保存的情况下修改文档？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T11:20:07.083

Word会检查文档的附件模板是否被修改，并提示是否保存更改。为避免出现此类提示，您可以将`Saved`附加模板的属性设置为`true`.

在 VBA 中，这将是：

```
ActiveDocument.AttachedTemplate.Saved = True 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T16:07:33.493

谢谢迪沃。

以下是 VSTO 的 C# 中的 2 行：

```
Word.Template template = (Word.Template)this.Application.ActiveDocument.get_AttachedTemplate();
template.Saved = true; 
```

# iphone - iPhone 配置问题：公钥/私钥

> ID：613719
> 
> 赞同：1
> 
> 时间：2009-03-05T05:58:21.100
> 
> 标签：iphone, provisioning

再次配置问题。

参考我的问题： [iPhone Development Provisioning Assistant Step 3 public/private Key problem](https://stackoverflow.com/questions/609486/iphone-development-provisioning-assistant-step-3-public-private-key-problem)

我有另一台需要安装证书的 mac 计算机。

此页面描述了如何“保存您的私钥并转移到其他系统”：http: [//developer.apple.com/iphone/manage/certificates/team/howto.action](http://developer.apple.com/iphone/manage/certificates/team/howto.action)

“HowTo”只显示了私钥的转移，是否也需要转移公钥？如果可以，如何转移？

非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T06:34:24.260

哦，经过这里和那里的一系列修复，终于把应用程序放到了 iPhone 上。并且不需要将公钥转移到其他机器上。

# java - Java - 切换回主线程？

> ID：613724
> 
> 赞同：6
> 
> 时间：2009-03-05T06:00:12.907
> 
> 标签：java, multithreading

出现异常时如何从不同的线程切换回主线程。当子线程引发异常时，我希望将通知发送到主线程并从主线程执行一个方法。我怎样才能做到这一点？

谢谢。

**附加信息**

我正在从我的主要方法调用一个方法，并在进行一些计算和更改后在那里启动一个新线程

```
Thread thread = new Thread() {
    @Override
    public void run() {
        .....
    }
}
thread.start(); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T06:12:47.383

当子线程发生异常时，主线程要做什么？它必须*等待*子线程中的任何错误。

您可以[`UncaughtExceptionHandler`](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html#setUncaughtExceptionHandler(java.lang.Thread.UncaughtExceptionHandler))在子线程中建立一个，它可以引发一个主线程正在等待的事件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T06:13:04.170

正如 TofuBeer 所说，您需要提供更多上下文，但是如果该上下文是您是一个摇摆应用程序...

SwingUtilities.invokeLater(Runnable r) 允许您回调 Swing 的主执行线程。

```
} catch (final Exception e) {
    SwingUtilities.invokeLater(new Runnable(){
        public void run() {
           //do whatever you want with the exception
        }
    }); 
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T06:02:20.390

如果您的子线程是在主线程中创建的，您可能会弹出异常并在主线程上处理它。

您也可以进行某种回调。

不过，我自己还没有尝试过。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T06:13:10.380

在您的应用程序的某个类中实现接口[http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.UncaughtExceptionHandler.html](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.UncaughtExceptionHandler.html)，并让它处理线程及其异常生成。

有关详细信息，请参阅文档。

编辑：这可能不是您想要的 - 我相信该方法将由刚刚引发异常的线程调用。如果您希望在主线程（在其上下文中）上执行某些方法，则主线程必须以某种方式等待它。

但是，如果您只想处理异常，那就是一种情况。认为最好的方法是在线程内的 try...catch 块中处理异常。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-03-05T06:12:54.483

这*可能*对你有用。

```
public class Main
{
    public static void main(final String[] argv)
    {
        final Main main;

        main = new Main();
        main.go();
    }

    public void go()
    {
        final Runnable runner;
        final Thread   thread;

        runner = new Foo(this);
        thread = new Thread(runner);
        thread.start();
    }

    public void callback()
    {
        System.out.println("hi!");
    }
}

class Foo
    implements Runnable
{
    private final Main main;

    Foo(final Main m)
    {
        main = m;
    }

    public void run()
    {
        // try catch and handle the exception - the callback is how you notify main
        main.callback();
    }
} 
```

# c++ - 在 C++ 中的类定义中延迟数组大小？

> ID：613739
> 
> 赞同：5
> 
> 时间：2009-03-05T06:10:25.877
> 
> 标签：c++, arrays, size, delay

有没有办法延迟定义数组的大小，直到类方法或构造函数？

我在想的可能看起来像这样，（当然）不起作用：

```
class Test
{
    private:
    int _array[][];

    public:
    Test::Test(int width, int height);
};

Test::Test(int width, int height)
{
    _array[width][height];
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T06:21:16.473

Daniel 所说的是，当调用 Test (width, height) 方法时，您需要为数组动态分配内存。

你会像这样声明你的二维（假设整数数组）：

```
int ** _array; 
```

然后在您的 Test 方法中，您需要首先分配指针数组，然后为每个指针分配一个整数数组：

```
_array = new  *int [height];
for (int i = 0; i < height; i++)
{
    _array [i] = new int[width];
} 
```

然后当对象被释放时，您将需要显式删除您分配的内存。

```
for (int i = 0; i < height; i++)
{
    delete [] _array[i];
    _array [i] = NULL;
}
delete [] _array;
_array = NULL; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-05T06:27:04.137

矢量是你最好的朋友

```
class Test
{
    private:
    vector<vector<int> > _array;

    public:
    Test(int width, int height) :
        _array(width,vector<int>(height,0))
    {
    }
}; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T06:12:32.643

我认为是时候查找新/删除运算符了。

鉴于这是一个多维数组，您将不得不在执行过程中循环调用“new”（同样不要忘记：delete）。

尽管我相信很多人会建议使用带有 width*height 元素的一维数组。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-07T14:29:18.310

（几个月后）可以使用模板，如下所示：

```
// array2.c
// http://www.boost.org/doc/libs/1_39_0/libs/multi_array/doc/user.html
// is professional, this just shows the principle

#include <assert.h>

template<int M, int N>
class Array2 {
public:
    int a[M][N];  // vla, var-len array, on the stack -- works in gcc, C99, but not all

    int* operator[] ( int j )
    {
        assert( 0 <= j && j < M );
        return a[j];
    }

};

int main( int argc, char* argv[] )
{
    Array2<10, 20> a;
    for( int j = 0; j < 10; j ++ )
    for( int k = 0; k < 20; k ++ )
        a[j][k] = 0;

    int* failassert = a[10];

} 
```

# c# - 在另一个线程中使用 SSRS Webservice

> ID：613741
> 
> 赞同：0
> 
> 时间：2009-03-05T06:10:51.150
> 
> 标签：c#, asp.net, web-services, multithreading, reporting-services

我从 asp.net 应用程序内部调用 SQL Server Reporting Services Webservice。我需要触发给定报告的所有订阅。但我不希望用户必须等待一切发生，所以我希望将所有 web 服务调用放在一个单独的线程中，并立即返回给用户。

我正在使用看起来像这样的代码：

```
public static void FireAllAsync(string ReportPath)
{
    Hashtable paramValues = new Hashtable();
    ThreadPool.QueueUserWorkItem(new WaitCallback(FireAll), ReportPath);
}

public static void FireAll(object ReportPath)
{

    ReportingService rs = new ReportingService();
    rs.Credentials = System.Net.CredentialCache.DefaultCredentials;

    Subscription[] SubList = rs.ListSubscriptions((string)ReportPath, null);

    foreach (Subscription CurSub in SubList) {
        rs.FireEvent(CurSub.EventType, CurSub.SubscriptionID);
    }

} 
```

调用`FireAll`工作正常，但尝试调用`FireAllAsync`以使用 Thread 失败并出现 401 错误。我相信凭据没有正确通过的问题。即这里的这行代码：

```
rs.Credentials = System.Net.CredentialCache.DefaultCredentials; 
```

我对凭据缓存的工作原理没有很好的理解，所以我无法弄清楚为什么它不喜欢在单独的线程中。

我尝试在外部函数中获取凭据，并将它们作为参数传递，但发生了同样的错误。

有谁知道可能会发生什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T06:51:53.187

当您的主线程正在执行时，它会为它准备一个模拟上下文。在经过身份验证的情况下，IIS 已对用户进行身份验证，然后为该用户设置线程令牌 - 而不是进程令牌。

因为线程令牌是为用户设置的，所以该线程可以代表用户（在本地机器上；如果在集成 Windows 身份验证 (NTLM/Kerberos) 时代表用户在另一个机器上运行，则需要设置*委派*）用来）。

但是，如果您在没有任何身份信息的情况下启动工作线程，则该工作线程将在没有自己的令牌的情况下生成，因此它将使用进程令牌。

如果您可以在初始线程上做您需要做的事情，那么您就没有委派问题，只是工作线程上缺少用户令牌。

Threadpool 线程将作为进程标识运行（默认情况下是 NetworkService，因此是主机的计算机帐户，除非您的 App Pool 设置为以 SomeUser 运行，在这种情况下，所有工作线程都将以 SomeUser 运行） - 如果该用户有访问初始用户想要的任何内容，一切都很好。

如果没有，401sville。

有一些网络参考可以帮助解决这个问题，并提供各种可能的答案：

[http://geekswithblogs.net/khanna/archive/2005/02/09/22441.aspx](http://geekswithblogs.net/khanna/archive/2005/02/09/22441.aspx)

[http://aspalliance.com/articleViewer.aspx?aId=650&pId=2](http://aspalliance.com/articleViewer.aspx?aId=650&pId=2)

# javascript - 绕过屏幕抓取时发生的警报和错误

> ID：613748
> 
> 赞同：0
> 
> 时间：2009-03-05T06:12:54.327
> 
> 标签：javascript, screen-scraping

我创建了一个网页来筛选一个站点，同时从另一个站点抓取；该站点上存在一些错误，因此它会引发错误（预期对象）。但最后我得到了完美的结果。

它表明错误发生在我的程序中。是否可以绕过这些错误（不在屏幕上显示它们）。我不想显示这些错误，并且在抓取时是否可以绕过警告框而不在屏幕上显示它。

请指导我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T07:05:11.550

您可以尝试重定向 window.onerror：

```
var _oldonerror = window.onerror;
window.onerror = function(errorMsg,url,lineNr) { return true; }; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T06:29:32.727

我不知道您如何废弃该网站，我不知道，但如果您通过 eval 或类似的方式在 javascript 中安装内容，您可以尝试*try-catch*块：

```
try
{
   // your content injected to page here.
}
catch(err)
{
   alert(err.description);
} 
```

或者您可以使用此正则表达式在包含到您的站点之前清除脚本元素：

```
(<script\b[^>]*>.*?</script>) 
```

# iphone - 将 AVAudioPlayer 音量设置为用户的铃声音量？

> ID：613758
> 
> 赞同：3
> 
> 时间：2009-03-05T06:18:28.307
> 
> 标签：iphone, avfoundation

AVAudioPlayer 的音量有问题。

我可以将Audio.volume 属性设置为1.0，但我宁愿以用户设置的iphone 铃声的音量播放音频。

摆脱卷属性默认为 1.0。

这似乎微不足道，但我在任何地方都找不到它的参考。

非常感谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T11:37:50.020

您设置为 AVAudioPlayer 实例的音量只是一个相对音量，例如，如果您想播放两种声音，一种是另一种音量的一半，则将第一个设置为 0.5，将第二个设置为 1.0。

真实设备音量仅由用户控制，不能以编程方式更改。( [Audio & Video Coding How-To's - 如何访问硬件音量控制器？](http://developer.apple.com/iphone/library/codinghowtos/AudioAndVideo/index.html#AUDIO_HARDWARE-ACCESS_THE_HARDWARE_VOLUME_CONTROLLER) )

您可以为用户添加一个 MPVolumeView 来控制全局音量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T06:44:18.447

我通过设置此回调来跟踪硬件更改

```
AudioSessionAddPropertyListener(kAudioSessionProperty_CurrentHardwareOutputVolume, audioVolumeChangeListenerCallback, self); 
```

但出于某种原因，我认为我得出的结论是，获取初始状态需要一个未发布的 API 调用。我暂时不记得了。也许这些信息会让您朝着正确的方向开始！

# cocoa - 如何显示没有图标的文档窗口的标题？

> ID：613759
> 
> 赞同：1
> 
> 时间：2009-03-05T06:18:33.737
> 
> 标签：cocoa

现在我将一个文件拖到 Dock 中的应用程序图标上，这个应用程序是基于 document 的。我发现应用程序运行并且主窗口打开后，窗口标题左侧没有小图像。但是当我在应用程序运行之前将文件拖到停靠图标并使用此方法运行应用程序时，窗口标题左侧的小图像显示文件，就像 xcode 等一样。现在我想显示小图像双向显示或不显示小图像双向，怎么办？我认为它可能是基于文档的窗口属性，但我不知道如何修复它？谢谢！[替代文字 http:///Users/jinxin/Desktop/Mydocument.png](http:///Users/jinxin/Desktop/Mydocument.png)

* * *

我使用了`[mainWindow setTitle:tmp];`，但图标仍然出现。当我使用时，`setTitleWithRepresentedFilename:`我发现图标和窗口标题名称都被修改了，在文档类中我重载了`-(void)displayName;`所以我想随时固定窗口标题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T02:57:53.637

好的，我找到了结果：

1.

```
[[window standardWindowButton:NSWindowDocumentIconButton] setImage:image] 
```

2.

```
- (BOOL)window:(NSWindow *)sender shouldPopUpDocumentPathMenu:(NSMenu *)titleMenu
{
    return NO;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T06:56:15.890

如果您只使用`-setTitle:`，则没有图标。如果你使用`-setTitleWithRepresentedFilename:`你会得到图标。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T06:56:10.337

`NSWindow`来自（下）的 Cocoa 文档`representedURL`：

```
[[window standardWindowButton:NSWindowDocumentIconButton] setImage:image] 
```

也许将它设置为 nil 就可以了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-19T17:36:08.543

我尝试了上面的所有答案，但没有奏效。这在小牛队对我有用：

[如何在 NSDocument 的窗口标题栏中隐藏文件图标](https://stackoverflow.com/questions/25372521/how-to-hide-file-icon-in-window-titlebar-of-nsdocument/25389571#25389571)

# java - 从 Java 写入串行端口的问题

> ID：613760
> 
> 赞同：0
> 
> 时间：2009-03-05T06:20:11.437
> 
> 标签：java, core

> [Java中Xmodem协议](https://stackoverflow.com/questions/606074/implementation-of-xmodem-protocol-in-java)的实现副本

* * *

我必须实现 xmodem 协议才能从目标设备接收文件。为此，我必须请求文件，然后对于收到的每个 128 字节数据包，我必须发送一个确认。我的问题是当我打开输出流来请求文件时，它会写入，但之后我无法再次写入输出流。我没有得到什么问题？

```
package writeToPort;

import java.awt.Toolkit;
import java.io.*;
import java.util.*;

import javax.comm.*;
import javax.swing.JOptionPane;

import constants.Constants;

public class Flashwriter implements Runnable, SerialPortEventListener {
    Enumeration portList;
    CommPortIdentifier portId;
    String messageString = "\r\nFLASH\r\n";
    SerialPort serialPort;
    OutputStream outputStream,outputStream2;
    InputStream inputStream;
    //Thread readThread;
    String one, two;
    String test = "ONLINE";
    String[] dispArray = new String[1];
    int i = 0;

    Thread readThread;

    byte[] readBufferArray;
    int numBytes;
    String response;
    FileOutputStream out;
    final int FLASH = 1, FILENAME = 2;
    int number;

    File winFile;

    public static void main(String[] args) throws IOException {
        Flashwriter sm = new Flashwriter();
        sm.FlashWriteMethod();
    }

    public void FlashWriteMethod() throws IOException {

        portList = CommPortIdentifier.getPortIdentifiers();
        winFile = new File("D:\\testing\\out.FLS");

        while (portList.hasMoreElements()) {
            portId = (CommPortIdentifier) portList.nextElement();
            if (portId.getPortType() == CommPortIdentifier.PORT_SERIAL) {
                if (portId.getName().equals("COM2")) {
                    // if (portId.getName().equals("/dev/term/a")) {
                    try {
                        serialPort = (SerialPort) portId.open("SimpleWriteApp",
                                1000);
                    } catch (PortInUseException e) {
                    }

                    try {
                        outputStream = serialPort.getOutputStream();
                        inputStream = serialPort.getInputStream();

                        System.out.println(" Input Stream... " + inputStream);
                    } catch (IOException e) {
                        System.out.println("IO Exception");
                    }
                    try {
                        serialPort.addEventListener(this);

                    } catch (TooManyListenersException e) {
                        System.out.println("Tooo many Listener exception");
                    }
                    serialPort.notifyOnDataAvailable(true);

                    try {
                        serialPort.setSerialPortParams(9600,
                                SerialPort.DATABITS_8, SerialPort.STOPBITS_1,
                                SerialPort.PARITY_NONE);
                        serialPort
                                .setFlowControlMode(SerialPort.FLOWCONTROL_NONE);
                        // serialPort.disableReceiveTimeout();

                        // outputStream.write(messageString.getBytes());

                        // sendRequest("/r/n26-02-08.FLS/r/n");
                        number = FLASH;
                        sendRequest(number);

                    } catch (UnsupportedCommOperationException e) {
                    }
                }
            }
        }
    }

    public void serialEvent(SerialPortEvent event) {
        SerialPort port = (SerialPort) event.getSource();

        switch (event.getEventType()) {
        case SerialPortEvent.DATA_AVAILABLE:
            try {
                while (inputStream.available() > 0) {
                    numBytes = inputStream.available();
                    readBufferArray = new byte[numBytes];
                    // int readtheBytes = (int) inputStream.skip(2);
                    int readBytes = inputStream.read(readBufferArray);

                    one = new String(readBufferArray);
                    System.out.println("readBytes " + one);

                if (one.indexOf("FLASH_") > -1 & !(one.indexOf("FLASH_F") > -1)) {
                    System.out.println("got message");
                    response = "FLASH_OK";
                    // JOptionPane.showMessageDialog(null,
                    // "ONLINE",
                    // "Online Dump",
                    // JOptionPane.INFORMATION_MESSAGE);
                    // Toolkit.getDefaultToolkit().beep();
                    // outputStream.write("\r\nONLINEr\n".getBytes());
                    // outputStream.flush();
                    // outputStream.write("/r/n26-02-08.FLS/r/n".getBytes());

                    number = FILENAME;
                    sendRequest(number);
                }

                out = new FileOutputStream(winFile, true);
                out.write(readBufferArray);
                out.close();

                }
            } catch (IOException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }
            readBufferArray = null;
            // break;
        }

        // try {
        // int c;
        // while((c = inputStream.read()) != -1) {
        // out.write(c);
        // }
        // } catch (IOException e) {
        // // TODO Auto-generated catch block
        // e.printStackTrace();
        // }
        // // readBufferArray=null;
        // break;
        // }
        // if (inputStream != null)
        // try {
        // inputStream.close();
        // if (port != null) port.close();
        // } catch (IOException e) {
        // // TODO Auto-generated catch block
        // e.printStackTrace();
        // }
        //      
        //
        readThread = new Thread(this);
        readThread.start();
    }

    public void run() {
        try {
            System.out.println("In run() function ");
            Thread.sleep(1000);

        } catch (InterruptedException e) {
            System.out.println("Interrupted Exception in run() method");
        }
    }

    public void dispPacket(String packet) {
        if (response == "FLASH_OK") {
            System.out.println("disppacket " + packet);
        } else {
            System.out.println("No resust");
        }
    }

    public void sendRequest(int num) {
        switch (num) {
        case FLASH:
            try {
            //  outputStream = serialPort.getOutputStream();
                outputStream.write("AT".getBytes());
            //  outputStream.write("\r\n26-02-08.FLS\r\n".getBytes());

                System.out.println("Flash switch");
             //   outputStream.close();
                outputStream.flush();
            } catch (IOException e) {
                e.printStackTrace();
            }
            break;
        case FILENAME:
            try {
                //outputStream =(serialPort.getOutputStream());
                outputStream.write("\r\nSUNSHINE\\06-03-09.FLS\r\n".getBytes());

                System.out.println("File name");
                outputStream.flush();

            } catch (IOException e) {
                e.printStackTrace();
            }
            break;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T07:02:35.360

也许流正在阻塞。

Java nio 有不阻塞的通道。尝试使用其中之一。

这是[使用 nio 读取文件的示例](https://stackoverflow.com/questions/326390/how-to-create-a-java-string-from-the-contents-of-a-file/326440#326440)。我不确定这是否适用于您。

我希望它有所帮助。

# asp.net-ajax - ASP.NET AJAX 4.0 教程

> ID：613768
> 
> 赞同：0
> 
> 时间：2009-03-05T06:25:38.897
> 
> 标签：asp.net-ajax

我是 ASP.NET AJAX 的新手。谁能告诉我同样的好资源？我用谷歌搜索，但找不到好的教程来学习 ASP.NET AJAX 4.0 的基本和高级使用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-24T17:33:16.980

他们刚刚更新了预览版，以包括客户端文档、详细的自述文件（对新功能进行了很好的解释和示例）以及一组新客户端模板的示例：

[CodePlex 上的 ASP.NET AJAX 4.0 预览版 4](http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24645)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T07:03:32.787

4.0 可能还没有很多资源，因为它还没有发布……它仍然在预览版 3 中。直到 API 被确定下来，通常是由 RC1 确定文档才开始高速运转。预览文档[可在此处获得](http://quickstarts.asp.net/previews/ajax/templates/default.aspx)。

# c# - 为什么 Settings.settings 文件将其所有值转储到 app.config 中？

> ID：613774
> 
> 赞同：0
> 
> 时间：2009-03-05T06:27:15.913
> 
> 标签：c#, settings, app-config

为什么 Settings.settings 文件将其所有值转储到 app.config 中？

这不是什么大问题，但是，我的应用程序变得越来越大，我认为将它们分组到单独的文件中会帮助我更好地组织事情。我正在考虑只创建多个设置文件，这很好，但是 app.config 正在爆炸。

大家对 app.config 有什么看法？您是否真的关心它，因为从逻辑上讲，所有内容都在您的解决方案中分组，或者您是否也希望在部署后有一些顺序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T06:37:53.877

对于某些部分，您可以指定外部配置文件...只是作为提示:)

例如

```
<appSettings configSource="appsettings.config" /> 
```

**编辑：**
由于将设置换成单独的文件，您的 app.config 会变小。然后，您可以将生产和测试设置分开（可能在构建过程中，例如[this](https://stackoverflow.com/questions/132544/net-configuration-appconfigwebconfigsettingssettings)或[this](http://weblogs.asp.net/scottgu/archive/2005/11/06/429723.aspx)）

更多信息[在这里](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework/topic42429.aspx)

**编辑：**
找到了另一种解决方案，不交换整个部分，而是在一个部分中添加一个增量（更多信息[在这里](http://support.microsoft.com/default.aspx/kb/555396)）

例如

```
<appSettings file="config.config"> 
```

**编辑：**
简短回答：您可能没有使用用户属性进行设置，因此您的设置将存储在 app.config（或 .dll）中，在运行时基本上不可更改（有一些“黑客”） ）。如果要更改设置，请使用用户属性！
[这是](http://dotnetperls.com/Content/Settings-Visual-Studio.aspx)一个很好的描述...
ps.：抱歉编辑了这么多！:)

# crystal-reports - 在 Crystal Reports Server 中计划参数化报表

> ID：613776
> 
> 赞同：0
> 
> 时间：2009-03-05T06:27:32.700
> 
> 标签：crystal-reports, scheduling, parameterized, crystal-reports-server

我正在尝试在 Crystal Reports Server 2008 中设置每月运行的报告，该报告将为我提供下个月的平价医疗计划终止日期。但是，据我所知，我只能给它一个特定的日期字符串，而不是“安排报告后 7 天”。我该怎么做呢？（实际上，CR2008 的问题相同，但服务器是我现在感兴趣的服务器。）

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-19T22:20:45.840

您可能想在 reportalsoftware.com 上查看报告。它允许您使用动态日期参数（例如，currentdate + 7D）计划您的报告，并指向报告的同一副本以进行按需 Web 访问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-08T03:46:16.763

原来这个问题的答案涉及到CR2008的新特性，可选参数。如果 HasValue({?MyParameter}) 函数返回 false，则可以使用默认值：否则，使用 MyParameter 的值。

# python - 将扭曲的代码添加到 pygtk 应用程序

> ID：613777
> 
> 赞同：0
> 
> 时间：2009-03-05T06:28:20.780
> 
> 标签：python, pygtk, twisted

我有一个使用 urllib2 的简单 pygtk 应用程序，我应该进行哪些更改来添加工作扭曲代码？

pbgtk2.py 示例令人困惑

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T11:48:22.493

您从使用 gtk 主循环切换到正确的[Twisted reactor](http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html#auto11)。或者您决定使用[reactor.run(installSignalHandlers=0) 在单独的线程中运行 Twisted，并继续使用 gtk mainloop](http://unpythonic.blogspot.com/2008/10/what-twisted-could-learn-from-kamaelia.html)。

您决定是否要将 urllib2 调用推迟到[它自己的线程](http://twistedmatrix.com/documents/current/api/twisted.internet.threads.deferToThread.html)，或者是否要使用[Twisted 的 HTTP 客户端库](http://twistedmatrix.com/documents/8.2.0/api/twisted.web.client.html)重写该代码。

你去 Twisted 邮件列表或 IRC 频道[寻求帮助](http://twistedmatrix.com/trac/wiki/TwistedCommunity)。

# c++ - 在 C++ 中有 &func 或 class::func 的用途吗？

> ID：613799
> 
> 赞同：2
> 
> 时间：2009-03-05T06:44:26.107
> 
> 标签：c++, function-pointers, member-pointers

这似乎不一致。为什么我们使用 &Example::func 而不是 Example::func？Example::func 或 &exampleFunction 有没有用处？似乎我们不能引用一个函数，以便排除 Example::func。而且我想不出一种使用 &exampleFunction 的方法，因为 exampleFunction 已经返回了一个指针。

```
#include <iostream>
class Example {
public:
    void func() { std::cout <<"print me\n"; }
};
void exampleFunction() { std::cout << "print me too\n"; }
typedef void (Example::*ExampleFunc_t)(); 
typedef void (*ExampleFunction_t)();
int main()
{
    Example e;
    ExampleFunc_t     f  = &Example::func;
    ExampleFunction_t f2 = exampleFunction;
    (e.*f)();
    f2();
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T09:10:30.733

因为这就是标准定义函数指针的方式。

您实际上总是必须使用地址运算符`&`来获取指向函数的指针，但是对于常规函数和静态成员函数，标准中定义了从函数到指针到函数的隐式转换。

这不是为（非静态）成员函数定义的，因为您无法获得非静态成员函数的左值。

从 C++ 标准：

> **4.3 函数到指针的转换**
> 
> 1.  函数类型 T 的左值可以转换为“指向 T 的指针”类型的右值。结果是指向函数的指针。

脚注 52：

> 这种转换永远不会应用于非静态成员函数，因为无法获得引用非静态成员函数的左值。

我认为出于一致性原因，他们宁愿只允许 &function，但隐式转换只是 C 遗产的产物......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T07:16:51.350

关键是使用[Function Pointers](http://en.wikipedia.org/wiki/Function_pointer)。对于一个非常粗略的示例，假设您有一个具有多个成员变量的类，您可能需要通过这些成员变量对该类类型的数组的元素进行排序，如下所示：

```
struct CL {
    int x, y, z;
};

bool sort_by_x(const CL& obj1, const CL& obj2);
bool sort_by_y(const CL& obj1, const CL& obj2);
bool sort_by_z(const CL& obj1, const CL& obj2);

...

CL obj[100];
...
sort(obj, obj+100, sort_by_x);
...
sort(obj, obj+100, sort_by_y);
...
sort(obj, obj+100, sort_by_z); 
```

这里 std::sort 用于对 CL 对象数组进行排序。看第三个参数，它是一个函数的名字。std::sort 函数可以在第三个参数中获取函数指针，并将该函数用作比较器来对数组进行排序。如何定义 sort_by_* 函数以使 std::sort 按预期工作取决于我们。

# oop - 如何解决 OOP 中的交叉引用？

> ID：613801
> 
> 赞同：5
> 
> 时间：2009-03-05T06:45:30.520
> 
> 标签：oop

我现在遇到过几次，我想知道解决循环引用的 OO 方法是什么。我的意思是A类有B类作为成员，而B类又有A类作为成员。

这方面的一个例子是类 Person 具有 Person 配偶作为成员。

```
Person jack = new Person("Jack");
Person jill = new Person("Jill");
jack.setSpouse(jill);
jill.setSpouse(jack); 
```

另一个示例是具有其他产品集合作为成员的产品类。例如，该集合可能是对该产品感兴趣的人也可能感兴趣的产品，并且我们希望在每个产品基础上维护该列表，而不是基于相同的共享属性（例如，我们不想只显示同一类别中的所有其他产品）。

```
Product pc = new Product("pc");
Product monitor = new Product("monitor");
Product tv = new Product("tv");
pc.setSeeAlso({monitor, tv});
monitor.setSeeAlso({pc});
tv.setSeeAlso(null); 
```

（这些产品只是为了说明问题，问题不在于某些产品是否相互关联）

一般来说，这在 OOP 中会是糟糕的设计吗？所有 OOP 语言都会/应该允许这样做，还是只是不好的做法？如果这是不好的做法，解决这个问题的最好方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T06:56:07.093

您提供的示例（无论如何对我而言）是合理的 OO 设计示例。

您描述的交叉引用问题不是任何设计过程的产物，而是您作为对象表示的事物的真实特征，所以我认为没有问题。

**你遇到了什么让你觉得这种方法设计不好的印象？**

*3 月 11 日更新：*

在缺乏垃圾收集的系统中，内存管理是显式管理的，一种常见的方法是要求所有对象都有一个*所有者*——其他一些负责管理该对象生命周期的对象。

一个例子是Delphi的TComponent类，它提供了级联支持——销毁父组件，所有拥有的组件也被销毁。

如果您正在开发这样一个系统，那么这个问题中描述的引用循环类型*可能*被认为是糟糕的设计，因为没有明确的所有者，没有一个对象负责管理生命周期。

我在某些系统中看到处理此问题的方式是保留引用（因为它们正确捕获业务关注点），并添加一个显式*TransactionContext*对象，该对象拥有从数据库加载到业务域的所有内容。这个上下文对象负责知道哪些对象需要保存，并在处理完成时清理所有内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T07:04:55.560

这是一个问题的主要原因是它是否变得过于混乱而无法应对或维护，因为它可能成为一种意大利面条代码。

但是，要谈谈您的示例；

*如果这是您的代码中需要的功能*，请参阅也完全有效- 它是用户可能感兴趣的其他项目的指针（或引用）的简单列表。

同样，添加配偶也是完全有效的，因为这是一种*简单*的现实世界关系，不会让维护您的代码的人感到困惑。

我一直将其视为一种*潜在*的代码异味，或者可能是一种让我退后一步并合理化我正在做的事情的警告。

至于在您的代码中找到递归关系的某些系统（在上面的评论中提到），无论这种设计如何，这些都可能出现。我最近研究了一个具有递归“类型”关系的元数据捕获系统——即列与其他列在逻辑上相关。它需要由试图解析您的系统的代码来处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T07:28:37.843

这不是 OO 设计中的基本问题。它可能成为问题的一个例子是在图遍历中，例如，找到两个对象之间的最短路径 - 你可能会陷入无限循环。但是，这是您必须根据具体情况考虑的事情。如果您知道在这种情况下可能存在交叉引用，则编写一些检查代码以避免无限循环（例如，维护一组已访问节点以避免重新访问）。但是，如果没有理由它可能是一个问题（例如在您在问题中给出的示例中），那么拥有这样的交叉引用一点也不坏。正如您所描述的，在许多情况下，它是解决手头问题的好方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T08:01:02.057

我不认为这是交叉引用的一个例子。

交叉引用通常与这种情况有关：

```
class A
{
    public void MethodA(B objectB)
    {
       objectB.SomeMethodInB();
    }
}

class B
{
    public void MethodB(A objectA)
    {
        objectA.SomeMethodInA();
    }
} 
```

在这种情况下，每种对象都会相互“接触”；A 调用 B，B 调用 A，它们变得紧密耦合。如果 A 和 B 在不同的包/命名空间/程序集中，情况会更糟；在许多情况下，由于程序集是线性编译的，因此会产生编译时错误。

解决这个问题的方法是让任一对象实现一个带有所需方法的接口。

在您的情况下，您只有一个级别的“进入”：

```
public Class Person
{
    public void setSpouse(Person person)
    { ... }
} 
```

我不认为这是不合理的，甚至不是交叉引用/循环引用的情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T07:52:20.190

我不认为这样的循环引用是一个问题。

但是，将所有这些关系放在对象内部可能会增加太多混乱，因此您可能希望在外部表示它们。例如，您可以使用哈希表来存储产品之间的关系。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T08:07:21.713

引用其他对象根本不是一个真正糟糕的 OO 设计。这是在每个对象中管理状态的方式。

一个好的经验法则是得墨忒耳法则。看看这张完美的 LoD 论文（Paperboy and the wallet）：[点击这里](http://www.ccs.neu.edu/research/demeter/demeter-method/LawOfDemeter/paper-boy/demeter.pdf)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-03-05T07:11:51.330

解决此问题的一种方法是通过 id 引用其他对象。

例如

```
Person jack = new Person(new PersonId("Jack"));
Person jill = new Person(new PersonId("Jill"));
jack.setSpouse(jill.getId());
jill.setSpouse(jack.getId()); 
```

我并不是说这是一个完美的解决方案，但它会阻止循环引用。您正在使用对象而不是对象引用来建模关系。

# datetime - 编写一个批处理文件以按日期和时间删除文件夹

> ID：613803
> 
> 赞同：3
> 
> 时间：2009-03-05T06:48:12.557
> 
> 标签：datetime, scripting, batch-file

### 精确重复：

*   [如何编写批处理文件以从文件夹中删除 5 天或更早的文件？](https://stackoverflow.com/questions/625613/how-do-i-write-a-batch-file-to-delete-folders-and-files-on-a-time-basis)
*   [编写批处理文件以从文件夹中删除 6 天前的文件](https://stackoverflow.com/questions/662607/)
*   [编写一个批处理文件以从文件夹中删除 5 天的旧文件](https://stackoverflow.com/questions/659770/)
*   [如何编写批处理文件以按时间删除文件夹和文件？](https://stackoverflow.com/questions/625613/)
*   [如何创建将按计划删除文件夹的批处理脚本？](https://stackoverflow.com/questions/615008/)
*   [编写脚本从文件夹中删除比当前日期早 5 天的文件](https://stackoverflow.com/questions/658717/)

我在网络上的服务器上有一个名为“dump”的文件夹。每天都会有很多临时文件和文件夹保存在该文件夹中。

我想删除这些文件和子文件夹。条件是我只想在文件和文件夹前一小时删除，即在我们运行批处理文件的当前时间之前的一个小时。

这意味着我想将我们的文件保留在该文件夹中以运行其他活动。像现在这样。

1.  转到文件夹并按时间列出文件
2.  获取当前时间
3.  删除比当前时间早 1 小时的文件

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T11:52:18.490

我认为在这种情况下，您最好使用 PowerShell 或 WSH（如 Rihan Meij 所述）。比较数据和时间是可能的，但非常脆弱（因为没有办法以文化中立的方式批量获得数据/时间）。你可能会这样写：

```
setlocal enableextensions
set Now=%date%
set NowTime=%time:~0,-3%
call :tokenize_date %Now%
call :tokenize_time %NowTime%
echo %YEAR%-%MONTH%-%DAY%T%HOUR%:%MINUTE%:%SECOND%
call :one_hour_before %Now% %NowTime%
echo %RESULT_DATE% %RESULT_TIME%
ping -n 1 -w 1500 ::1>NUL
set Now2=%date%
set NowTime2=%time:~0,-3%
call :date_time_compare %Now% %NowTime% %Now2% %NowTime2%
echo %Now%T%NowTime% compared to %Now2%T%NowTime2%: %RESULT%
endlocal
goto :eof

:tokenize_date
    rem assuming ISO 8601 date format YYYY-MM-DD
    setlocal enableextensions
    set arg=%1
    set YEAR=%arg:~0,4%
    set MONTH=%arg:~5,2%
    set DAY=%arg:~8,2%
    endlocal&set YEAR=%YEAR%&set MONTH=%MONTH%&set DAY=%DAY%
goto :eof

:tokenize_time
    rem assuming ISO-8601 time format HH:MM:SS, 24-hour
    setlocal enableextensions
    set arg=%1
    set HOUR=%arg:~0,2%
    set MINUTE=%arg:~3,2%
    set SECOND=%arg:~6,2%
    endlocal&set HOUR=%HOUR%&set MINUTE=%MINUTE%&set SECOND=%SECOND%
goto :eof

:one_hour_before
    rem gets a date as %1 and a time as %2
    rem returns a date in RESULT_DATE and a time in RESULT_TIME
    setlocal enabledelayedexpansion enableextensions
    set months=31 28 31 30 31 30 31 31 30 31 30 31
    set i=0
    for %%x in (%months%) do (
        set /a i+=1
        set month_length_!i!=%%x
    )
    call :tokenize_date %1
    call :tokenize_time %2
    set /a HOUR-=1
    if %HOUR% LSS 0 (
        set /a DAY-=1
        set /a HOUR+=24
        if %DAY% LSS 0 (
            set /a MONTH-=1
            if %MONTH% LSS 0 (
                set /a YEAR-=1
                set /a MONTH+=12
            )
            set /a DAY+=month_length_!MONTH!
        )
    )
    endlocal&set RESULT_DATE=%YEAR%-%MONTH%-%DAY%&set RESULT_TIME=%HOUR%:%MINUTE%:%SECOND%
goto :eof

:date_time_compare
    rem expects %1 - date 1, %2 - time 1, %3 - date 2, %4 - time 2
    rem returns a value < 0 if datetime1 is earlier than datetime2
    rem                 > 0                 later than
    rem                 = 0                 equal to
    rem the return value is saved in the variable %RETURN%
    setlocal enableextensions
    call :tokenize_date %3
    call :tokenize_time %4
    set YEAR2=%YEAR%
    set MONTH2=%MONTH%
    set DAY2=%DAY%
    set HOUR2=%HOUR%
    set MINUTE2=%MINUTE%
    set SECOND2=%SECOND%
    call :tokenize_date %1
    call :tokenize_time %2
    if %YEAR2% GTR %YEAR% (endlocal&set RESULT=-1&goto :eof) else (
        if %YEAR2% LSS %YEAR% (endlocal&set RESULT=1&goto :eof) else (
            if %MONTH2%%DAY2%%HOUR2%%MINUTE2%%SECOND2% GTR %MONTH%%DAY%%HOUR%%MINUTE%%SECOND% (
                endlocal&set RESULT=-1&goto :eof
            ) else (
                if %MONTH2%%DAY2%%HOUR2%%MINUTE2%%SECOND2%==%MONTH%%DAY%%HOUR%%MINUTE%%SECOND% (
                    endlocal&set RESULT=0&goto :eof
                ) else (
                    endlocal&set RESULT=1&goto :eof
                )
            )
        )
    )
goto :eof 
```

抱歉，时间有点长了。比较日期/时间现在只经过部分测试，但应该可以工作。小心它包含亚秒的时间，因为它们在这里引入了一个逗号，这会扰乱被调用子例程的参数顺序（因此`%time:~0,-3%`要避免这种情况）。

之后，您可以使用`%~tI`扩展来获取日期和时间，将它们与当前减去一小时进行比较，并在适用时删除。

注 1：我假设 ISO 8601 日期和时间格式为 24 小时，这就是我在这里使用的。对于非标准日期格式，您将不得不稍微更改子程序（但 12 小时的时间可能会很痛苦）。

注意 2：目前，该代码不关心闰年。我想应该是另外 5 或 6 行代码`:one_hour_before`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T09:58:12.913

我知道我知道您可能尝试做的唯一方法是使用 for 命令和 ~t 扩展参数。

```
for %r in (*.*) DO echo %r "created on" %~tr 
```

这会产生：

```
C:\>echo BOOTSECT.BAK "created on" 2009/02/17 11:59 PM
BOOTSECT.BAK "created on" 2009/02/17 11:59 PM

C:\>echo config.sys "created on" 2006/09/18 11:43 PM
config.sys "created on" 2006/09/18 11:43 PM 
```

我认为更可能的情况是使用 Windows 脚本主机或 powershell，但您没有提到这些是您的选择，所以我假设有充分的理由无法使用这些技术。

# c++ - 关于比较字符串与字符串

> ID：613807
> 
> 赞同：0
> 
> 时间：2009-03-05T06:51:08.087
> 
> 标签：c++, string, comparison

我尝试在字符串类型下逐个字符进行比较，代码如下：

```
vector <int> getQuality(string seedTag, vector <string> &MuTag) { 

    vector <int> Quals;  

     for (unsigned i = 0; i<MuTag.size(); i++) { 
         Quals.push_back(-40);
         cout << MuTag[i] << " " << seedTag[i] << endl;

         if (MuTag[i] == seedTag[i]) { // This line 33 with error
           Quals.push_back(40);
         }

     }

     return Quals;
} 
```

但是为什么它会给出这样的错误：

```
 Mycode.cc:33: error: no match for 'operator==' in '(+ MuTag)->std::vector<_Tp, _Alloc>::operator[] [with _Tp = std::string, _Alloc = std::allocator<std::string>](((long unsigned int)i)) == seedTag. std::basic_string<_CharT, _Traits, _Alloc>::operator[] [with _CharT = char, _Traits = std::char_traits<char>, _Alloc = std::allocator<char>](((long unsigned int)i) 
```

我该如何解决？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T06:56:32.443

您正在尝试将字符串 (MuTag[i]) 与字符 (seedTag[i]) 进行比较。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T07:15:46.280

正如亚历山大所说，您正在比较一个字符串和一个字符。

可悲的是，编译器已经告诉你了，只是它在 ISO-STL-TEMPLATE 加密中对其进行了加密，而 perl 更难阅读！

您可能希望查看[此脚本](http://www.bdsoft.com/tools/stlfilt.html)以解密 C++ STL 错误消息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T07:22:04.473

我知道很多其他人已经对导致编译错误的原因做出了回应，所以让我回顾一下，然后提出一个解决方案：

seedTag 是一个字符串，根据定义，它是一个有序的字符集合。MuTag 被定义为字符串向量：字符串的有序集合。

当您进行比较时：

```
MuTag[i] == seedTag[i] 
```

正如其他人所说，您不是在比较同一类型。

**要解决这个问题：**

从表面上看，您希望将 MuTag 中的每个值与 seedTag 进行比较。如果确实如此，只需去掉“seedTag[i]”中的[i]。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T07:20:37.643

```
vector <string> & MuTag 
```

是字符串的集合，而

```
string seedTag 
```

是字符的集合。所以在你比较

```
MuTag[i] == seedTag[i] 
```

你实际上比较像这样的东西

```
 "aaaaa" == 'a' 
```

这绝对是不正确的。

# jquery - 是否可以在同一页面上加载多个不同版本的 jQuery？

> ID：613808
> 
> 赞同：5
> 
> 时间：2009-03-05T06:51:19.087
> 
> 标签：jquery, bookmarklet

我正在制作一个书签，如果找不到对象，它将加载 jQuery。加载将检查 jQuery 的版本。代码如下：

```
(function(){

    var myBkl = {
         loadScript: function(src) {
            if(window.jQuery && window.jQuery.fn.jquery == '1.3.2'){
                return;
            }
            var s = document.createElement('script');
            s.setAttribute('src', src);
            s.setAttribute('type', 'text/javascript');
            document.getElementsByTagName('head')[0].appendChild(s); 
        },
        whenLoaded: function(callback){
            if (typeof(window.jQuery) !== 'undefined' && window.jQuery.fn.jquery == '1.3.2') { 
                callback(window.jQuery); 
            } 
            else {
                setTimeout((function() {myBkl.whenLoaded(callback); }), 100);
            } 
        },
        init: function($){
            console.log($.fn.jquery);
        }
    };
    myBkl.loadScript('http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js');
    myBkl.whenLoaded(myBkl.init);

})(); 
```

我使用这个书签生成器来创建书签[http://subsimple.com/bookmarklets/jsbuilder.htm](http://subsimple.com/bookmarklets/jsbuilder.htm)

显然，如果页面已经加载了 jQuery。1.3.2 脚本的加载将覆盖页面上的 window.jQuery 对象。我只是想知道有没有让 1.3.2 加载到另一个自命名变量？使用`jQuery.noConflict(true);`?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T07:09:51.443

是的。我通过以下代码使其工作：

```
 (function(){

    var myBkl = {
         jq: null,
         loadScript: function(src) {
            if(window.jQuery && window.jQuery.fn.jquery == '1.3.2'){
                return;
            }
            var s = document.createElement('script');
            s.setAttribute('src', src);
            s.setAttribute('type', 'text/javascript');
            document.getElementsByTagName('head')[0].appendChild(s); 
        },
        whenLoaded: function(callback){
            if (typeof(window.jQuery) !== 'undefined' && window.jQuery.fn.jquery == '1.3.2') { 
                myBkl.jq = window.jQuery.noConflict(true);
                callback(myBkl.jq); 
            } 
            else {
                setTimeout((function() {myBkl.whenLoaded(callback); }), 100);
            } 
        },
        init: function($){
            console.log($.fn.jquery);
            console.log(window.jQuery.fn.jquery);
        }
    };
    myBkl.loadScript('http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js');
    myBkl.whenLoaded(myBkl.init);

})(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T07:02:33.693

我怀疑你已经看到了所有的警告并且明白你可以将 jQuery 移动到另一个命名空间：

```
//Completely move jQuery to a new namespace in another object.

var dom = {};
dom.query = jQuery.noConflict(true); 
```

并且该插件可能无法正常工作，并且您必须在加载或使用其他脚本之前完成所有这些操作。

祝你好运/有点想知道这是否适合你~

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-16T07:02:35.253

运行“jQuery.noConflict(true);”时 使用第一个 jQuery 版本的代码可能会中断。
在某些情况下，代码甚至不属于您。您编写了一个脚本，该脚本应该被添加到页面并使用 jQuery，而您对托管页面一无所知。
托管代码可能会加载其 jQuery 版本，检测到它已加载，开始使用它，然后等待 (setTimeout)，然后您的代码启动，执行“jQuery.noConflict(true);” , 并等待它被加载。当您的代码等待时，控件可能会返回到尝试运行其 jQuery 并发现它不存在的托管代码。

对于这种情况，我的建议是在另一个新窗口中加载 jQuery，而不是将其从原始窗口中删除。然后，当它被加载时，使用“jQuery.noConflict(true);” 在新窗口上将其复制到原始窗口。然而，新的 jQuery 对象实际上是在新窗口及其文档上运行的。因此，当使用新的 jQuery 时，必须将原始 window.document 作为第二个参数传递，如下所示：

```
newJq("#elementInOriginalDocument", window.document).html("some text"); 
```

按照我对这个想法的实施：

```
<html>
    <head>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>
    </head>
    <body>
        Test jQuery
        <br />
        <span id="hostScope">hostScope</span>
        <br />
        <span id="guestScope">guestScope</span>

        <script>
            (function(hostWin){
                    var myBkl = {
                            win: null,
                            doc: null,
                            jq: null,
                            loadScript: function(src) {
                                if (this.doc == null){
                                    var nAgt = navigator.userAgent;
                                    if ((verOffset=nAgt.indexOf("MSIE"))!=-1) {
                                        var iframe = document.createElement('iframe');
                                        iframe.id = "if1";
                                        iframe.src= window.location.href;
                                        document.getElementsByTagName('head')[0].appendChild(iframe);
                                        this.whenIEIFrameLoaded(src, 0);
                                    } else {
                                        var iframe = document.createElement('iframe');
                                        iframe.id = "if1";
                                        document.getElementsByTagName('head')[0].appendChild(iframe);
                                        setTimeout((function() {myBkl.whenIframeLoaded(src); }), 1);
                                    }
                                }
                            },
                            whenIframeLoaded: function(src){
                                var oIframe = document.getElementById('if1');
                                var newdocument = (oIframe.contentWindow || oIframe.contentDocument);
                                if (newdocument.document) {
                                    newdocument = newdocument.document;
                                }
                                var newwin = oIframe.contentWindow;

                                if (newwin.document.documentElement.innerHTML){
                                    newwin.document.documentElement.innerHTML = '<!DOCTYPE html><html><head></head><body>N</body></html>';
                                }
                                this.doc = newwin.document;
                                this.win = newwin;

                                var script = this.doc.createElement('script');
                                script.setAttribute('src', src);
                                script.setAttribute('type', 'text/javascript');

                                this.doc.getElementsByTagName('head')[0].appendChild(script); 
                                this.whenLoaded(this.callback, 0);
                            },
                            whenIEIFrameLoaded: function(src, times){
                                var oIframe = document.getElementById('if1');

                                if (oIframe && oIframe.contentWindow && oIframe.contentWindow.document && oIframe.contentWindow.document.body){
                                    var newdocument = (oIframe.contentWindow || oIframe.contentDocument);
                                    if (newdocument.document) {
                                        newdocument = newdocument.document;
                                    }

                                    var script = newdocument.createElement('script');
                                    script.setAttribute('src', src);
                                    script.setAttribute('type', 'text/javascript');

                                    newdocument.getElementsByTagName('head')[0].appendChild(script); 

                                    this.doc = newdocument;
                                    this.win = oIframe.contentWindow;
                                    this.whenLoaded(myBkl.callback, 0);
                                } else {
                                    if (times < 5000){
                                        times++;
                                        setTimeout((function() {myBkl.whenIEIFrameLoaded(src, times); }), 2);
                                    }
                                } 
                            },
                            whenLoaded: function(callback, times){
                                    if (this.win && this.win.jQuery && typeof(this.win.jQuery) !== 'undefined' && this.win.jQuery.fn.jquery == '1.3.2') { 
                                        myBkl.jq = this.win.jQuery.noConflict(true);
                                        callback(myBkl.jq);
                                    } 
                                    else {
                                        if (times < 5000){
                                            times++;
                                            setTimeout((function() {myBkl.whenLoaded(callback, times); }), 5);
                                        }
                                    } 
                            },
                            callback: function(loadedJq){
                                    hostWin.myJq = loadedJq;
                                    //console.log("callback: The loaded jQuery ver is " + loadedJq.fn.jquery);
                                    whenLoadedOut();
                            }
                    };
                    myBkl.loadScript('http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js');
            })(window);

            function whenLoadedOut(){
                if (window.jQuery) { 
                    //console.log("Host jQuery ver (window.jQuery.fn.jquery) is " + jQuery.fn.jquery);
                    //console.log("guest jQuery ver (window.lpJq)  is " + myJq.fn.jquery);
                    $("#hostScope").html("The jQuery ver of host is " + jQuery.fn.jquery);
                    myJq("#guestScope", document).html("The jQuery ver of guest is " + myJq.fn.jquery);
                } 
                else {
                    setTimeout((function() {whenLoadedOut(); }), 2);
                } 
            }
        </script>
    </body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-18T13:59:43.343

检查[这个博客](http://aspnetnova.blogspot.com/2009/12/jquery-multiple-version-of-jquery-in.html)

您可以使用该方法

```
$.noConflict(true); 
```

来实现这一点。例如：

```
<script src="http://code.google.com/p/jqueryjs/downloads/detail?name=jquery-1.3.2.min.js" type="text/javascript"></script>
<script type="text/javascript">
    //create this naming for Jquery 1.3.2 version
    var jQuery_1_3_2 = $.noConflict(true);
</script>
<script src="http://jqueryjs.googlecode.com/files/jquery-1.2.6.min.js" type="text/javascript"></script> 
```

# javascript - 从 Web 应用程序访问 iPhone 上的位置信息

> ID：613815
> 
> 赞同：1
> 
> 时间：2009-03-05T06:54:26.037
> 
> 标签：javascript, iphone, web-applications, core-location

Web 应用程序有没有办法在不安装额外的 iPhone 客户端应用程序的情况下访问 iPhone 的位置数据？

如果没有，那么下一个最好的事情就是如果有任何人可以推荐一个现有的本地应用程序，最好对最终用户免费并且尽可能轻量级，这*确实*会将这些信息暴露给 Mobile Safari。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T23:04:51.293

是的，在 iPhone OS 3.0 中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-04T23:09:47.680

您可以使用[HTML5 Geolocation API](http://dev.w3.org/geo/api/spec-source.html)做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T06:56:44.703

我不认为这是可能的。MobileSafari 不会公开此信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T09:11:50.997

那没有。至少您必须实现自己的基于 UIWebView 的应用程序，从 CLLocationManager 读取位置并将其注入 WebView。

一个很好的起点是[iPhone-google-maps-component](http://code.google.com/p/iphone-google-maps-component/)。它...

> ... 在后台使用 UIWebView 加载 HTML/Javascript 版本的 Google 地图，并提供一组 Objective-C 方法，这些方法模仿原始 Javascript 方法的子集来控制地图。目前支持设置中心位置，以及使用触摸界面进行缩放和平移

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T19:13:10.193

对于越狱手机， [Locatable](http://lbs.tralfamadore.com/)正是您所描述的，它在 cydia 上可用，并且在服务器端集成非常简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T07:39:36.083

[PhoneGap](http://phonegap.com/)采用了一种有趣的方法，提供了一个允许 Javascript 访问硬件功能的本地包装器。这不完全是我问题的答案，但它本身很有趣，它最终可能会完成工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-20T10:02:31.173

`GeoLocation API`您可以在以下 URL 中查看使用 Web 应用程序获取当前位置的简单示例：http: [//mrvautin.com/2010/01/06/iphone-web-application-get-current-location/](http://mrvautin.com/2010/01/06/iphone-web-application-get-current-location/)

# asp.net - 修改 web.config 时如何防止 ASP.NET 应用程序重新启动？

> ID：613824
> 
> 赞同：37
> 
> 时间：2009-03-05T06:58:27.213
> 
> 标签：asp.net, iis, web-config, recycle, httpruntime

我通过该`ApplicationHost.CreateApplicationHost`方法托管 ASP.NET 运行时。当我`web.config`在应用程序运行时修改时，我看到很多第一次机会`ThreadAbortException`被抛出。这是在我的应用程序崩溃之前。我假设这是因为运行时检测到配置更改并想要重新启动。

这对我们来说并不是一个真正受支持的场景，所以如果我可以关闭自动重新加载，我会更喜欢。

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2015-07-17T07:04:45.487

实际上，前两个答案是不正确的。防止这种回收发生是可能的，而且*非常*容易，并且至少从 IIS6 开始就可以使用此功能。

## 方法 1（系统范围）

`DWORD`将注册表设置更改为`HKLM\SOFTWARE\Wow6432Node\Microsoft\ASP.NET\FCNMode`值`1`，这将禁用*所有*文件更改通知。

不要被位置所迷惑：`Wow6432Node`在这种情况下，它不会影响您的 Web 应用程序的位数。

## 方法 2 (.NET 4.5+)

如果您使用的是 .NET 4.5，那么[现在可以在每个站点级别禁用此功能](https://support.microsoft.com/en-us/kb/911272)，只需在您的`web.config`：

```
<httpRuntime fcnMode="Disabled"/> 
```

## 方法 3 (IIS6+)

最后，并且（至少）从 IIS6 开始，[有一个设置被称为`DisallowRotationOnConfigChange`](https://msdn.microsoft.com/en-us/library/ms525764%28v=vs.90%29.aspx)仅适用于应用程序池的设置（至少我认为 MSDN 上的文本试图这么说，但我还没有测试过）。将其设置为`true`并且更改应用程序池的配置不会导致立即回收。

最后一个设置也可以从应用程序池的高级设置中设置：

![为配置更改禁用回收](https://i.stack.imgur.com/oaoKP.png)

## 方法 4（ASP.NET 1.0 和 1.1）

对于使用 ASP.NET 1.0 或 1.1 的（旧）网站，[存在一个已确认的错误](https://support.microsoft.com/en-us/kb/319947)，该错误可能导致文件更改的快速和重复回收。当时的解决方法类似于[MartinHN](https://stackoverflow.com/users/2972/martinhn)在主要问题下建议的方法，即在您的 中类似于以下内容`web.config`：

```
<compilation 
   debug="false"
   defaultLanguage="vb"
   numRecompilesBeforeAppRestart="5000"> 
```

这不会禁用回收，但仅在进行*5000 次*重新编译后才会禁用。这个数字是否有用取决于您的应用程序的大小。微软并没有明确说明*重新编译*到底是什么。但是，默认值为*15*。

*顺便说一句：*无论 .NET 或 Windows 的版本如何，我们发现当应用程序从共享运行并在负载平衡的环境中使用时，站点会不断循环使用。解决它的唯一方法是将该`FNCMode`设置添加到注册表中（但现在有更多细粒度的选项）。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-03-05T07:04:30.973

~~据我所知，无法禁用此行为，更改 webconfig 会强制重新启动应用程序。~~

更新：实际上是可能的，有很多方法，有据可查，如[本答案所述](https://stackoverflow.com/a/31470150/111575)*

**原答案：**

[这里](https://stackoverflow.com/questions/178342/what-happens-when-i-edit-webconfig)有一个类似的问题，仅供参考。我发现了可能有帮助的其他信息。

> **配置更改导致应用**
> 程序域重新启动 Web.config 文件中配置设置的更改间接导致应用程序域重新启动。此行为是设计使然。您可以选择使用 configSource 属性来引用在进行更改时不会导致重新启动的外部配置文件。[有关详细信息，请参阅节元素继承的常规属性](http://msdn.microsoft.com/en-us/library/ms228167(v=vs.100).aspx)中的configSource 。

来自[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/ackhksh7.aspx)

*^(免责声明：我写了另一个答案，通常不会进行自我参考，但发现它足够相关，因为在这篇文章发布 8 年后它可以链接到这里，它真的很不一样：通过点击 IIS 前面的解决方案很容易-end，并且从 ASP.NET 1.0 开始存在变通方法。)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-03-10T12:16:28.123

我遇到了一个更大的问题——对 AppDomain 基本目录中的*任何*文件或子文件夹的更改都会导致托管环境关闭。这对我们的应用程序来说是一个相当大的问题，因为我们在同一个 AppDomain 中运行 WPF UI，我们无法在不干扰用户的情况下重新启动它。

我真的很想避免为应用程序的基于 Web 的部分运行单独的 AppDomain，所以我使用 Reflector 进行了一些挖掘。我发现罪魁祸首是内部类`FileChangesMonitor`。

所以我写了一个可怕的反射黑客来解决这个问题。我想我会把它贴在这里作为其他有同样问题的人的潜在解决方案。您只需要调用`HttpInternals.StopFileMonitoring()`以禁用文件/文件夹更改的关闭。

```
internal static class HttpInternals
{
    private static readonly FieldInfo s_TheRuntime = typeof(HttpRuntime).GetField("_theRuntime", BindingFlags.NonPublic | BindingFlags.Static);

    private static readonly FieldInfo s_FileChangesMonitor = typeof(HttpRuntime).GetField("_fcm", BindingFlags.NonPublic | BindingFlags.Instance);
    private static readonly MethodInfo s_FileChangesMonitorStop = s_FileChangesMonitor.FieldType.GetMethod("Stop", BindingFlags.NonPublic | BindingFlags.Instance);

    private static object HttpRuntime
    {
        get
        {
            return s_TheRuntime.GetValue(null);
        }
    }

    private static object FileChangesMonitor
    {
        get
        {
            return s_FileChangesMonitor.GetValue(HttpRuntime);
        }
    }

    public static void StopFileMonitoring()
    {
        s_FileChangesMonitorStop.Invoke(FileChangesMonitor, null);
    }
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-08-24T09:54:04.983

一个解决方案是将以下元素添加到 web.config 部分：

```
<httpRuntime
    waitChangeNotification="315360000"
    maxWaitChangeNotification="315360000"
/> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-10T09:20:25.557

正如 jfburdet 所提到的，解决方案是使用 waitChangeNotification 和 maxWaitChangeNotification。

话虽如此，如果 ASP.NET 在混合模式下运行，您应该知道它们不适用于 IIS 7：[http ://forums.iis.net/t/1149344.aspx](http://forums.iis.net/t/1149344.aspx)

# c++ - c++ stl中是否有任何三态类型？

> ID：613825
> 
> 赞同：12
> 
> 时间：2009-03-05T06:58:44.840
> 
> 标签：c++, stl

c++ stl中是否有任何三态类型？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-05T07:05:54.527

不，但是有[boost tribool](http://www.boost.org/doc/libs/1_38_0/doc/html/tribool.html)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-05T07:08:52.430

您还可以使用具有三个值的枚举类型

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T07:17:06.543

这个网站可能有帮助 =P

[http://thedailywtf.com/Articles/What_Is_Truth_0x3f_.aspx](http://thedailywtf.com/Articles/What_Is_Truth_0x3f_.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T07:02:29.607

不，您最好的选择可能是定义一个自定义类并重载所有运算符（运算符&& 等）。

# openfire - Openfire3.6.3 无法连接到雅虎网关

> ID：613826
> 
> 赞同：1
> 
> 时间：2009-03-05T07:00:38.923
> 
> 标签：openfire, gateway, chatbot, yahoo-messenger

就openfire而言，我是新手。

我希望每个用户无论是在 gtalk、yahoo、MSN 上都与我的服务器联系，但现在只有 gtalk 用户能够连接并看到连接的状态。但雅虎用户可以将我添加为好友，但状态总是离线。

我检查了网关选项卡中的连接，它显示连接成功。

连接主机：scs.msg.yahoo.com 连接端口：5050

请指导我

谢谢

# vb.net - 错误 - 标签显示 System.Data.DataRow

> ID：613828
> 
> 赞同：0
> 
> 时间：2009-03-05T07:01:49.827
> 
> 标签：vb.net, datatable

我一直在尝试突出显示 DataTable 中的搜索结果。首先，我遍历 DataTable 的行并调用一个函数来查找匹配的关键字以突出显示这些单词，然后使用带有突出显示的关键字的新字符串更新 DataTable 行。

我将 DataTable dtResult 绑定到 DataList。在我将此代码块添加到 SearchDemo 函数以突出显示关键字之前，它运行良好：

* * *

```
 For i = 0 To dtResult.Rows.Count - 1 Step 1

        Dim strTemp As String = dtResult.Rows(i).ToString
        strVerse = blHelper.Highlight(s, strTemp)
        dtResult.Rows(i)("verse") = strVerse
    Next 
```

* * *

DataList 内的标签绑定此“诗句”列显示 System.Data.DataRow。其余显示正确的数据。

请参阅以下代码块：

…………………………………………………………………………………………………………

```
Public Shared Function SearchDemo(ByVal s As String) As DataTable

    Dim dtResult As New DataTable

    dtResult = SearchDetail(s) 

    Dim i As Integer = dtResult.Rows.Count

    For i = 0 To dtResult.Rows.Count - 1 Step 1

        Dim strTemp As String = dtResult.Rows(i).ToString
        strVerse = blHelper.Highlight(s, strTemp)
        dtResult.Rows(i)("verse") = strVerse

    Next

    Return dtResult
End Function 
```

..................................................... …………

下面这两个功能可以正常工作。

```
 'Highlight the keywords in the returned result

Public Shared Function Highlight(ByVal Search_Str As String, ByVal InputTxt As String) As String

    ' Setup the regular expression and add the Or operator.
    Dim RegExp As Regex = New Regex(Search_Str.Replace(" ", "|").Trim(), RegexOptions.IgnoreCase)

    ' Highlight keywords by calling the MatchEvaluator delegate each time a keyword is found.
    Highlight = RegExp.Replace(InputTxt, New MatchEvaluator(AddressOf ReplaceKeyWords))

    ' Set the Regex to nothing.
    RegExp = Nothing

End Function

Public Shared Function ReplaceKeyWords(ByVal m As Match) As String

    Return "<b>" & m.Value & "</b>"

End Function 
```

除了我试图突出显示关键字的“verse”列的行之外，DataTable dtResul 的所有其他行都正确显示。如果我在 SearchDemo 中删除一个循环（以突出显示关键字），它将正常工作。任何人都可以看看这些代码并指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T07:38:21.063

您的输入文本是 dtResult.Rows(i).ToString，即“System.Data.DataRow”。

更改此行：

```
Dim strTemp As String = dtResult.Rows(i).ToString 
```

到：

```
Dim strTemp As String = dtResult.Rows(i)("verse").ToString 
```

# c# - 枚举和常量。什么时候用？

> ID：613837
> 
> 赞同：108
> 
> 时间：2009-03-05T07:04:36.090
> 
> 标签：c#, language-agnostic, enums

我正在阅读枚举，发现它们与声明常量非常相似。我怎么知道何时使用常量而不是枚举，反之亦然。使用枚举有哪些优点？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-03-05T07:13:41.077

当您想定义某个值的范围时，请使用枚举。颜色是一个明显的例子，例如：

```
public enum Colour
{
    White,
    Red,
    Blue
} 
```

或者可能是一组可能的事情，例如：（例如我偷懒从[这里偷了）](http://mark.michaelis.net/Blog/FlagsAttributeAndBitwiseORWithoutTheFlagsAttribute.aspx)

```
[FlagsAttribute]
enum DistributedChannel
{
  None = 0,
  Transacted = 1,
  Queued = 2,
  Encrypted = 4,
  Persisted = 16,
  FaultTolerant = Transacted | Queued | Persisted
} 
```

常量应该用于单个值，例如 PI。没有 PI 值的范围，只有 PI。

其他需要考虑的点是：

*   a：常量不一定表示常量之间的关系，而枚举表示某些东西可以是枚举定义的集合之一。
*   b：定义的枚举在用作参数时可以帮助您进行类型检查。常量只是值，所以它们不提供任何额外的语义信息。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-03-05T16:22:47.793

其他答案中缺少的是枚举具有整数基类型。您可以将默认值从 int 更改为除 char 之外的任何其他整数类型，例如：

```
enum LongEnum : long {
    foo,
    bar,
} 
```

您可以从基类型显式或隐式强制转换，这在 switch 语句中很有用。请注意，即使枚举没有具有适当值的成员，也可以将基类型的任何值强制转换为枚举。因此，始终在开关中使用默认部分是一个好主意。顺便说一句，.NET 本身甚至允许浮点值枚举，但你不能在 C# 中定义它们，尽管我认为你仍然可以使用它们（除了在 switch 中）。

此外，使用枚举可以为您提供更多的类型安全性。如果您打算使用例如 int 常量作为方法参数，那么我可以使用任何 int 值调用该方法。当然，通过强制转换它也可以在枚举中发生，但它不会意外发生。更糟糕的是可能会混淆参数的顺序。

```
void method(int a, int b) {...} 
```

如果常量 A 只能进入 a，而常量 B 只能进入 b，那么使用两种不同的枚举类型将发现编译期间的任何误用。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-03-05T07:09:22.880

常量是一种语言特性，它表示变量不会改变值（因此编译器可以围绕该知识进行优化），其中枚举是特定类型。

常量可以是任何数据类型，但枚举就是枚举。

我在可以有多个选项并希望提高代码可读性的任何地方都使用枚举。即，您可以将跟踪级别作为具有值 0、1、2 的 int 或作为错误、警告和信息的枚举。

Enum 还可以用作按位运算符，即 FontStyle.Bold | FontStyle.Italic 会给你粗体和斜体字体。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-05T07:14:22.727

除了罗伯特的回答：

1.  将 enum 用于一组有限的命名值。您并不真正关心每个符号背后的数值（但您仍然可以强加它们，例如为了与遗留系统兼容）。

2.  罗伯特：是的，枚举可以用作位域。使用[Flags](http://msdn.microsoft.com/en-us/library/system.flagsattribute.aspx)属性（并确保枚举成员具有合适的数值）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-05T07:16:30.320

AC# 常量类似于变量，因为它为值提供了定义的名称。但是，常量与标准变量不同，因为一旦定义，分配给常量的值就永远无法更改。常量的主要好处是它们有助于创建自记录代码以及允许在单个位置声明键值，如果需要更新值和重新编译软件，则可以轻松维护。

而枚举器列表对于定义序列和状态很有用，特别是当这些状态有自然进展时。这是因为列表中的每个常量都可以使用其名称或值进行格式化和比较。枚举也可用于定义一组有限的有效值。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-04-05T00:06:42.933

使用`enum`而不是时我发现方便的一件事`const`是您可以遍历 an 中的值`enum`，但使用值更难做到这一点`const`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-12-05T00:39:33.887

如果您需要基于整数的值，请使用枚举。如果您需要基于字符串的值，请使用带有常量的结构。

当你有类似的东西

```
class x
{
    public string string_value {get;set;}
    publi int int_value  {get;set;}
}

x model = new x();
model.string_value  = struct.some_value;
model.int_value = enum.some_value; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-02-19T11:44:30.993

```
If you have a set of predefined choices which is not supposed to change (i.e adding more choices etc.) than use enum otherwise consts. Consider the following:
public class Math
{
    enum Command {none = 0, add =1, subtract = 2} 
    const int none =0, add=1,subtract =2;
    public virtual int Operate(int a, int b, Command command) 
    {
        if (command == Command.add) return a+b;
        if(command == Command.subtract) return a-b;
        return a;
    }
    public virtual int Operate(int a, int b, int command) 
    {
        if (command == add) return a+b;
    if(command==subtract) return a-b;
        return a;
    }
}`

class Math1: Math
{
    public override Operate(int a, int b, int command)
    {
        if(command<3) return base.Operate(a, b, command)
        if(command =3) return a*b;
        if(command==4) return a/b;
        return a;
    }
} 
```

因此使用 const 可以让您传递未在 const 声明中定义的参数值，即 3 用于乘法，4 用于除法。这是好是坏取决于您的逻辑，有时允许用户传递任意值并收到意外结果是不明智的。

# c# - 如何隐藏表格

> ID：613843
> 
> 赞同：0
> 
> 时间：2009-03-05T07:08:00.277
> 
> 标签：c#

当我按下表单内的按钮时，我想隐藏我的表单。当我这样做时，任务栏中必须显示一些东西，如果我点击那个东西，表单将再次进入可见状态。

编辑：我不应该最小化或调整表单大小。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T07:22:45.750

你有两个选择：

1.  使用 Windows 窗体的标准最小化行为。在您的按钮单击处理程序中，将[`Form.WindowState`](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.windowstate.aspx#)属性设置为[`FormWindowState.Minimized`](http://msdn.microsoft.com/en-us/library/system.windows.forms.formwindowstate.aspx)或只让用户使用标准最小化按钮。这将“隐藏”表单，但会将其按钮保留在任务栏上，用户可以单击它以恢复表单。

**编辑：**根据您的问题编辑，您应该使用[`NotifyIcon`](http://msdn.microsoft.com/en-us/library/system.windows.forms.notifyicon.aspx#).

2.  关闭表单并在任务栏通知区域（又名“系统托盘”）中添加通知图标。为此，您需要将组件的实例添加[`NotifyIcon`](http://msdn.microsoft.com/en-us/library/system.windows.forms.notifyicon.aspx#)到表单中。然后，在您的按钮单击处理程序上，您将调用[`Form.Close`](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.close.aspx)以关闭表单。当用户想要恢复表单时，他们将单击代表您的应用程序的系统托盘图标，您将打开表单。

这是一个如何做到这一点的[VB.NET 示例。](http://support.microsoft.com/kb/903898)用 C# 翻译应该不难。您还可以搜索[`NotifyIcon`](http://search.live.com/results.aspx?q=notifyicon+.net&go=&form=QBLH)以查看更多示例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T07:23:26.420

```
//this is Form object
//Option 1

this.Hide();

//Option 2

this.Visible = false; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T07:10:27.650

标准最小化按钮是否符合要求？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T07:22:07.733

在按钮代码中：

```
 FormBorderStyle = FormBorderStyle.None;
        Width = 0;
        Height = 0; 
```

比如说......激活的表单事件：

```
 FormBorderStyle = FormBorderStyle.Fixed3D;
        Width = 800;
        Height = 500; 
```

这种效果适合你吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-23T01:32:47.037

正如尼尔斯所说。

```
Hide();
// or 
Visible = false;

NotifyIcon trayIcon;
//....
trayIcon.Visible = true; 
```

根据表单可见性显示/隐藏托盘图标。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-19T13:50:38.817

使用表单的属性“不透明度”。

```
// Hide your windows frame
form1.Opacity = 0; 

/*
 * Your actions Here
 */

// Show your windows frame
form1.Opacity = 1.0; 
```

# objective-c - NSString 的内存问题

> ID：613868
> 
> 赞同：2
> 
> 时间：2009-03-05T07:23:12.817
> 
> 标签：objective-c, cocoa

我遇到了 NSString 的问题。

```
NSString* str = [[NSString alloc] initWithString:@"Hello world"]; 
```

在上面的代码中，我需要释放对象str吗？按照规则，这个对象是用alloc创建的，所以应该用release方法显式释放。但是，当我没有明确释放它时，我在 Instruments 中找不到任何内存泄漏。当 NSString 被 NSNumber 替换时，就会发生内存泄漏。

谁能给我一些建议？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T07:35:53.207

是的，您确实需要释放它。Instruments、Leaks、ObjectAlloc 等工具并非万无一失。还因为您使用常量字符串来创建实例，所以完全有可能不会发生泄漏。但是，如果你`+alloc`是一个对象，你也应该`-release`确保对象不会泄漏，所以你确实需要释放这个对象。

我常用的 Cocoa 内存管理文章链接集：http: [//iamleeg.blogspot.com/2008/12/cocoa-memory-management.html](http://iamleeg.blogspot.com/2008/12/cocoa-memory-management.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T08:28:20.303

您所看到的可能是一个实现细节。我怀疑`-[NSString initWithString:]`参数的不可变字符串只是保留其参数并返回它。对于像 一样的常量字符串`@"Hello world"`，它们在程序的生命周期中一直存在，所以保留和释放不会做任何事情。

但是你不需要注意这些。Cocoa 只是保证，如果您遵循内存管理准则，您的内存将得到妥善管理。它在幕后的运作方式通常不是你应该关心的——只是你是否遵守规则。

# c# - 绑定到自动更新对象？

> ID：613869
> 
> 赞同：0
> 
> 时间：2009-03-05T07:23:24.673
> 
> 标签：c#, .net, wpf, data-binding, xaml

是否有我可以用来制作自动更新对象的对象或接口，并让这些更新过滤到 WPF 中的 UI？

基本上我正在寻找这样的东西：

```
<TextBlock Text="{Binding Source={StaticResource myClass}, Path=DataObject}" />

public class MyClass
{
    public AutoUpdatingObject DataObject { get; set; }
}

public class AutoUpdatingObject: ???
{
    ???
} 
```

不，我不能让 MyClass 实现 INotifyPropertyChanged。我需要 AutoUpdatingObject 类能够通知 WPF 更改。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T09:07:15.267

实现 INotifyPropertyChanged 不是更新绑定的唯一方法，您还可以在不实现接口的情况下使用事件。

[使用 CLR 类作为绑定源对象](http://msdn.microsoft.com/en-us/library/ms743643.aspx#classes)

> 如果您不实现 INotifyPropertyChanged，那么您必须安排自己的通知系统以确保绑定中使用的数据保持最新。您可以通过支持要为其更改通知的每个属性的 PropertyChanged 模式来提供更改通知。为了支持此模式，您为每个属性定义一个 PropertyNameChanged 事件，其中 PropertyName 是属性的名称。每次属性更改时都会引发事件。

在你的情况下 MyClass 看起来像这样：

```
public class MyClass
{
    private AutoUpdatingObject dataObject;
    public AutoUpdatingObject DataObject
    {
        get { return dataObject; }
        set { dataObject = value; DataObjectChanged(this, new EventArgs()); }
    }

    public event EventHandler DataObjectChanged = delegate { };
} 
```

# javascript - JS：等到其他帧加载

> ID：613891
> 
> 赞同：1
> 
> 时间：2009-03-05T07:38:25.743
> 
> 标签：javascript

有没有办法等待脚本直到框架完全加载？
该框架来自其他域。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T07:41:40.573

让我哑口无言。

```
<frameset onLoad="myFunction();"> 
```

# java - java lang验证错误

> ID：613903
> 
> 赞同：5
> 
> 时间：2009-03-05T07:50:32.063
> 
> 标签：java

```
java.lang.VerifyError: (class: a method: parse signature: 
()Z) Incompatible argument to function

public boolean parse() {

} 
```

此错误是什么意思以及如何修复此类错误

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T08:03:15.123

通常这种错误与版本问题有关，您正在使用与正在运行的不同版本的库进行编译。java 1.5 类型强制也可能会出现一些非常微妙的变化，其中 1.4 编译器会选择不同的类型。使用 1.5 重新编译所有内容，并确保使用相同的版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T07:59:47.177

它通常与 java 1.5 或 6 的兼容性问题有关（例如尝试使用较旧的 1.4 javac 编译 Java5 或 6 代码）。

清理所有 .class 文件并从头开始重建，检查您的 JDK 和 JRE 是否处于同一级别。

* * *

它也可能是从第三方类方法“返回项目”到本地的错误类型转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T07:59:01.140

我刚发现这个：

> 当“验证器”检测到类文件虽然格式良好，但包含某种内部不一致或安全问题时抛出。 [Java API](http://java.sun.com/javase/6/docs/api/java/lang/VerifyError.html)

你有没有返回一个布尔值？

您能否提供更多信息，设置了哪个环境？我认为安全问题很重要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T08:02:55.700

好吧，首先似乎是返回值是missong。您应该返回一个布尔值。但这不是问题。当您进行无法解析的引用时会出现这种异常，例如循环中的分配

对于 (i=i; i!=XX;i++)

检查这些参考。

路易斯

# perl - 为什么 Programming Perl 使用本地（不是我的）文件句柄？

> ID：613906
> 
> 赞同：11
> 
> 时间：2009-03-05T07:54:16.783
> 
> 标签：perl, filehandle, lexical

当我通读*Programming Perl*，第 2 版，第 51 页时，有些事情让我感到困惑：

```
sub newopen {
    my $path = shift;
    local *FH;    #not my!
    open (FH, $path) || return undef;
    return *FH;
}

$fh = newopen('/etc/passwd'); 
```

我知道，为什么我们不推荐使用我的？到目前为止，我看不出如果我们使用 my() 会出什么问题。

谢谢！

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-05T20:42:32.800

陈词滥调的答案是你必须使用`local`，因为`my *FH`它是一个语法错误。

“正确”（但不是很有启发性）的答案是你做错了。您应该使用词法文件句柄和三参数形式的`open`代替。

```
sub newopen {
    my $path = shift;
    my $fh;
    open($fh, '<', $path) or do {
        warn "Can't read file '$path' [$!]\n";
        return;
    }
    return $fh;
} 
```

要真正回答*为什么*需要解释词法变量和全局变量之间以及变量范围和持续时间之间的区别。

变量的范围是程序中其名称有效的部分。范围是一个静态属性。另一方面，变量的持续时间是动态属性。持续时间是程序执行期间变量存在并保存值的时间。

`my`声明一个词法变量。词法变量的范围从声明点到封闭块（或文件）的末尾。您可以在不同的范围内拥有其他具有相同名称的变量而不会发生冲突。（您也可以在重叠范围内重复使用名称，但不要这样做。）词法变量的持续时间是通过引用计数来管理的。只要至少有一个对变量的引用，该值就存在，即使该名称在特定范围内无效！`my`还具有运行时效果——它分配一个具有给定名称的**新**变量。

`local`有点不同。它对全局变量进行操作。全局变量具有全局范围（名称在任何地方都有效）和程序整个生命周期的持续时间。所做的是对全局变量的*值*`local`进行临时更改。这有时被称为“动态范围”。更改从声明点开始，一直持续到封闭块的末尾，之后旧值被恢复。重要的是要注意新值不限于块——它在任何地方都是可见的（包括被调用的子例程）。引用计数规则仍然适用，因此您可以在更改过期后获取并保留对本地化值的引用。*`local`*

 *回到例子：`*FH`是一个全局变量。更准确地说，它是一个“typeglob”——一组全局变量的容器。typeglob 包含每个基本变量类型（标量、数组、散列）以及其他一些内容的槽。从历史上看，Perl 使用 typeglobs 来存储文件句柄并将`local`它们 - 化有助于确保它们不会相互干扰。词法变量没有类型团，这就是为什么说`my *FH`是语法错误。

在现代版本的 Perl 中，词法变量可以而且应该用作文件句柄。这让我们回到了“正确”的答案。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-05T09:08:45.183

在您的示例代码中，对内置子例程的调用`open`使用一个裸词作为文件句柄，这相当于一个全局变量。正如[Nathan Fellman 的回答](https://stackoverflow.com/questions/613906/why-use-local-not-my-for-filehandle/614007#614007)所解释的，如果在脚本或模块的其他地方定义了另一个具有相同名称的全局变量，则 using`local`会将这个裸词本地化到当前代码块。这将防止先前定义的全局变量被新声明清除。

这在过去的 Perl 时代是一种非常普遍的做法，但是**从 Perl 5.6 开始，最好使用标量（带有`my`您在问题中暗示的声明）来定义您的文件句柄**，此外，使用三个参数打电话给`open`.

```
use Carp;
open my $error_log, '>>', 'error.log' or croak "Can't open error.log: $OS_ERROR"; 
```

顺便说一句，请注意，对于标准输入/输出读取和写入，最好使用两个参数`open`：

```
use Carp;
open my $stdin, '<-' or croak "Can't open stdin: $OS_ERROR"; 
```

或者，您可以使用该[`IO::File`](http://search.cpan.org/perldoc?IO::File)模块来祝福类的文件句柄：

```
use IO::File;
my $error_log = IO::File->new('error.log', '>>') or croak "Can't open error.log: $OS_ERROR"); 
```

这里的大部分功劳归功于[优秀著作 Perl Best Practices 的作者 Damian Conway](http://books.google.com/books?id=gJf9tI2mytIC&pg=PA207&lpg=PA208&ots=Hk0ghLttcp&dq=perl+best+practices+file+io)。如果您对 Perl 开发很认真，那么您应该自己购买这本书。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-05T08:02:50.350

你为什么要读一本过时的书。第三版已经出很久了！您使用的是哪个版本的 Perl？第 2 版描述了 Perl 5.004 (5.4.x) 或更高版本。

现在，您不应该对文件句柄使用 typeglob 表示法。使用“词法文件句柄”（我认为请参见[open](http://perldoc.perl.org/functions/open.html)）或[FileHandle](http://perldoc.perl.org/index-modules-F.html)模块，或其亲属之一。

* * *

*感谢 Michael Schwern 和 Ysth 在此处提供的评论。*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T08:47:35.530

我相信这是因为`my`在堆栈上分配了变量的新副本，并且在退出块时它会丢失。 `local`将现有的保存在`*FH`别处并覆盖现有的`*FH`. 当您退出堆栈时，它会恢复旧的。当您退出块时`my`，`*FH`typeglob 超出范围。它`local`会一直存在，因此您可以在退货后继续使用它。

我不是 100% 确定这一点，但也许它可以为您指明正确的方向。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T09:06:58.060

[请参阅此处](http://perl.plover.com/local.html)的本地化文件句柄，我想这可以解释它。

# database - 使用 Amazon 的 EBS 进行 MySQL 热备份

> ID：613908
> 
> 赞同：9
> 
> 时间：2009-03-05T07:55:16.000
> 
> 标签：database, backup, amazon-ec2, amazon-web-services, amazon-ebs

您使用 Amazon EBS 快照功能进行 MySql 热备份的经验是什么？

我有一个在 ec2 中运行批处理作业的数据库。我用 EBS 快照备份。到目前为止，备份看起来是一致的。但我担心他们“一旦我停止检查就会停止一致”（不确定性原则）。

您在使用 ebs 快照备份关系数据库（尤其是 mysql）方面有何经验？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-10-25T12:11:28.220

一年多来，我一直在使用 EBS 快照备份我的 MySQL 数据目录。它一直在完美地工作。使用这些快照作为替换（或克隆）MySQL 设置的基础，我从来没有遇到过问题。

最佳实践是使用允许冻结的文件系统（例如 XFS）格式化 EBS 卷。这允许您获得一致的快照：将 MySQL 的内存刷新到磁盘，冻结文件系统，快照，然后解冻。整个过程需要不到 10 秒的时间（但当数据库大量使用时可能需要更长的时间）。

请参阅Eric Hammond 的[这篇文章](http://alestic.com/2009/09/ec2-consistent-snapshot "EBS 一致快照")，了解为您完成所有这些工作的脚本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-26T12:54:52.303

MySQL 以从不一致的磁盘状态中恢复不佳而闻名，XFS 本质上是在快照发生时暂停对文件系统的 IO。通常，一旦创建了完整的事务日志条目，数据库就会执行 flush()，这实际上表明了文件系统的检查点。在日志文件系统的情况下，这很重要，并且在大多数情况下，一旦挂载，文件系统将恢复到最后一个有效的日志条目，这不是 100%，但总比没有好。如果数据库文件在事务日志之后，大多数数据库系统使用事务日志文件在恢复时“前滚”，并且数据库引擎只会在给定事务日志内容的情况下前滚。它不会尝试通过部分写入的事务前滚。这里的问题是 MySQL 在实现这一点方面并不是最好的，所以它绝对是一个问题。我还没有找到一个可靠的解决方案，我想运行一个镜像，在你做快照的同时暂停 MySQL，然后恢复同步可能会起作用，但我不知道 MySQL 镜像是否可以处理部分不可用的镜像一段时间，然后能够在没有完整重新镜像的情况下赶上，在这种情况下，您不妨只对所有数据库进行 mysqldump，因为它对数据库的影响与运行完整镜像大致相同。这是我能想到的另一个运行时选项——将所有数据库的 mysqldump 运行到备份分区并对其进行快照。不给你运行备份，所以你不能经常这样做，如果你是 24/7，

其他数据库引擎在这方面要好得多。PostgreSQL 非常擅长从不稳定的磁盘状态恢复到他们根本不建议在日志文件系统上运行它的地步。您还可以选择归档事务日志，这样您就可以从最后一个良好的完整备份前滚到归档日志存在的任何时间点。使用它进行一致的备份要容易得多。Oracle 将允许您拥有在物理磁盘/EBS 分区之间切换的多组事务日志，从而为您提供频繁的窗口来拍摄一致的快照，并能够向数据库引擎指示您希望这样做，而不是翻转回来，直到你这么说。

按照日志的思路，LVM 通常可以在一秒钟内对整个文件系统进行快照。我不知道 EBS 快照功能是否会利用这一点，尽管您可以手动执行此操作。LVM 比 XFS 稍微复杂一些，但我过去曾遇到过 XFS 的问题，因为它在一个 ext3 很好的单个目录中处理大量文件。LVM 还有很多其他好处，无论哪种方式都绝对值得研究。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-03-09T13:58:37.910

我建议使用 LVM 作为数据库文件系统的抽象层。因为这将获得本地快照的好处，就像热备份一样。LVM 快照的好处是可以实现与 EBS 相似的结果，并且可以在任何机器上使用它（不仅仅是基于亚马逊的）。

另一个优点是 LVM 可以使用热调整大小，当您需要最少的停机时间并且需要动态扩展磁盘空间时特别好（**不推荐**，但在特定情况下可能）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-19T17:52:19.397

我主要关心的是依赖 EBS 快照在它们运行的​​级别进行数据库备份。快照在磁盘上的一个非常低的级别上运行并拍摄图像，而不管应用程序写入它的状态如何。从理论上讲，您的备份映像可能处于事务或其他事情的中间，如果到了那个时候，这会使恢复变得有些尴尬。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2012-01-17T22:13:20.420

您可能会考虑使用[Amazon RDS](http://aws.amazon.com/rds/)来管理您的数据库——它就像标准的 MySQL 服务器一样工作，然后如果它崩溃（它不会），您可以责怪 Amazon。此外，他们会定期为您备份和修补服务器。我移动了我的 Wordpress 和 vBulletin 安装，大概花了一个小时。

只是我的2美分！

# solaris - Solaris 9 项目（资源管理）

> ID：613913
> 
> 赞同：0
> 
> 时间：2009-03-05T07:58:19.020
> 
> 标签：solaris

我试图让项目在 solaris 9 (SPARC) 中运行，所以我可以限制一些用户的内存使用。

根据我读过的内容以及我在 solaris 10 中的回忆，我应该能够

1.  创建一个组（prodsupt），并将其设为用户默认组
2.  创建一个名为“group.prodsupt”的项目
3.  限制组中的资源。

我已经这样做了，但是我的用户仍然没有获得有限的资源

```
> grep prodsupt /etc/group
prodsupt::6011:
> grep prodsupt /etc/project
group.prodsupt:100:Production Support Project:::process.max-address-space=(privileged.16777216.deny) 
```

这应该将使用 prodsupt 作为默认设置的任何人限制为大约 16mb 的地址空间，但是，如果我以该组中的用户身份登录

```
> id -p
id=1055(mwatson) gid=6011(prodsupt) projid=100(group.prodsupt)
> prctl -n process.max-address-space $$
3084:   zsh
process.max-address-space                [ lowerable deny no-local-action ]
   18446744073709551615 system     deny           [ max ] 
```

谁能发现我在这里做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T09:17:25.413

问题是权限中的拼写错误。

```
group.prodsupt:100:Production Support Project:::process.max-address-space=(privileged.16777216.deny) 
```

本来应该

```
group.prodsupt:100:Production Support Project:::process.max-address-space=(privileged,16777216,deny) 
```

这解决了问题。

# debugging - Win32 调试宏

> ID：613916
> 
> 赞同：1
> 
> 时间：2009-03-05T07:59:55.990
> 
> 标签：debugging, winapi

用于在 Win32（MFC 外部）中将文本写入输出窗口的标准宏是什么？我正在寻找预处理器有条件地从发布版本中排除的东西。

我们正处于手工制作自己的边缘。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T08:10:29.443

我不相信有一个标准，最好自己动手。

但是，您可能需要考虑`OutputDebugString(char*)`. 它将输出发送到调试通道。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T08:14:15.253

为此有一个[跟踪宏](http://msdn.microsoft.com/en-us/library/4wyz8787.aspx)，它是一个仅调试`printf`样式的输出函数。除此之外，您可能想尝试一下[`_RPT`宏](http://msdn.microsoft.com/en-us/library/42773424.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T08:14:17.453

也许您正在考虑 ATLTRACE？不完全是“标准宏”，但我猜非常接近。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-17T12:09:44.633

您必须使用 debugapi 函数创建自己的调试助手

例子：

'#'ifdef _DEBUG '#'define TRACE(x) OutputDebugString(x) '#'endif

# firefox - 如何运行两个独立的 Firefox 实例？

> ID：613917
> 
> 赞同：18
> 
> 时间：2009-03-05T08:00:04.727
> 
> 标签：firefox, ubuntu

出于测试目的，我想在 ubuntu 上安装两个不同的 firefox 实例——这样它们就不会共享 cookie。（我想以不同用户的身份同时使用这两个实例登录我们的网站）。我怎么做？我使用 Firefox 和 Opera，但我更喜欢 Firefox（因为 firebug）。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-24T02:59:52.953

还有一种可能。您可以执行如下`firefox`命令：

```
firefox -P "profile-name" -no-remote 
```

该选项`-no-remote`禁用新实例的远程控制（即使用`firefox`命令进行控制），从逻辑上讲，它还暗示`-new-instance`运行新的隔离实例所需的选项。也可以只使用选项`-new-instance`：

```
firefox -P "profile-name" -new-instance 
```

## 创建新配置文件

```
firefox -ProfileManager -new-instance 
```

该命令将打开一个交互式窗口，您可以在其中管理现有配置文件并创建新配置文件。您还可以使用选定的配置文件启动新的 Firefox 实例。请注意“*使用选定的配置文件而不在启动时询问*”选项，该选项在默认情况下处于选中状态，这将使选定的配置文件成为在没有启动时使用的默认配置`firefox`文件`-P`。

## 帮助

摘自`firefox -help`：

```
 -P <profile>       Start with <profile>.
  -ProfileManager    Start with ProfileManager.
  -no-remote         Do not accept or send remote commands; implies -new-instance.
  -new-instance      Open new instance, not a new window in running instance. 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T08:06:16.707

查看[profile 参数](http://kb.mozillazine.org/Command_line_arguments)，如下所示：

```
firefox -profile "E:\myprofile" 
```

对 windows 文件路径感到抱歉；）如果您将主配置文件复制到不同的配置文件，您将启动一个单独的实例。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-03-14T09:45:48.460

您可以使用[Multifox](http://br.mozdev.org/multifox/)扩展来拥有两个不共享 cookie 的独立 Firefox 实例，但仍只使用一个配置文件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T08:07:21.680

在 ubuntu 上创建两个用户

用户 1 用户 2

以 user1 身份登录启动 Firefox1

启动某种终端和 ssh -X user2@host

启动 Firefox2

或者，您的意思是 Firefox 的两个不同版本，比如 3.x 和 2.x？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T08:10:16.667

[http://www.command-tab.com/2008/06/18/how-to-run-firefox-2-and-3-simultaneously/](http://www.command-tab.com/2008/06/18/how-to-run-firefox-2-and-3-simultaneously/)

我相信上面的网址会对您有所帮助。它与同时运行 FF2 和 FF3 以及作为单独的实例有关。

上面描述了windows和mac，但无论什么操作系统，概念都是一样的。安装后不要仅仅让它进入同一个旧的火狐文件夹，给它一个唯一的路径。然后，在 Firefox 中为每个文件创建一个配置文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-03-01T13:56:46.700

如果您只需要两个 firefox 实例，您可以使用*New Private Window*

运行第二个实例。（`Ctrl+Shift+P`用作快捷方式）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-02-18T09:54:07.610

在linux终端运行，

`firefox -new-instance -P "Another Profile"`

然后创建新配置文件 > 启动 Firefox。

它打开新实例，而不是正在运行的实例中的新窗口，它允许一次打开多个应用程序副本。

从下次开始`firefox -new-instance -P <Profile name>`

来源：Mozilla[网站](https://developer.mozilla.org/en-US/docs/Mozilla/Command_Line_Options)

# sql - 部分更新命令

> ID：613918
> 
> 赞同：2
> 
> 时间：2009-03-05T08:00:29.950
> 
> 标签：sql, sql-server, transactions

我想对一组记录执行 UPDATE 命令，但它失败了，因为更新后的某些记录会违反表约束。是否可以以某种方式仅更新合适的记录？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T08:28:19.370

全部或全部更新的行为是设计使然

您可以在 Update 命令中添加 Where 子句以检查所有约束，但这会导致代码重复，这不是一件好事

使用 Cursor 或 CLR 循环一次更新一行怎么样？

如果这是多层应用程序的一部分，那么您的业务对象需要通过元数据或模式询问了解您的 SQL 约束，以便在数据到达数据库之前完成数据验证

[CSLA 框架](http://www.lhotka.net/cslanet/)对此有一些好处

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T08:16:42.767

更新语句本身是原子的，它要么全部成功，要么全部失败。您需要修改 SQL 以仅更新不会违反约束的行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T08:26:13.103

您需要将约束添加到 WHERE 子句。

要么为每一行单独运行更新，但这似乎根本不是一个好主意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T17:37:09.690

要添加一些已经发布的答案：您可能需要在 where 子句中使用子查询。喜欢（在伪代码中）

```
update mytable
set myfield = myval
where not exists (select from some table that would tell you if a constraint is violated for this row) 
```

如果您发布代码，我可能会为您提供更多帮助。

# c - C 日志库

> ID：613919
> 
> 赞同：13
> 
> 时间：2009-03-05T08:00:34.647
> 
> 标签：c, logging

那里有什么 C 日志记录 API？我发现其中一些是

1.  [日志4c](http://sourceforge.net/projects/log4c/)
2.  [万神殿](http://www.pantheios.org/)
3.  [lwl](http://home.gna.org/lwl/)

有谁知道其他记录器。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T11:16:09.043

[系统日志](http://www.gnu.org/software/libtool/manual/libc/Syslog.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-02-26T08:45:05.350

看看Zlog。它重量轻、线程安全且易于设置。

你可以在[这里找到](https://github.com/HardySimpson/zlog)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T16:10:20.803

glib2 also has a good scalable logging API: [Glib message logging](http://developer.gnome.org/glib/stable/glib-Message-Logging.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T08:06:13.993

使用 log4c，您应该拥有一个好的日志 API。

为什么你需要更多？

可在[此处](http://log4c.cvs.sourceforge.net/viewvc/*checkout*/log4c/log4c/doc/Log4C-DevelopersGuide.odt?revision=1.10)找到说明。

# xml - 新手使用 xsd 验证 xml

> ID：613924
> 
> 赞同：0
> 
> 时间：2009-03-05T08:04:56.070
> 
> 标签：xml, xsd, validation

我需要在 .net 中使用 xsd 验证 xml，

我的文件

看下一篇

有什么帮助吗？任何示例代码源？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T08:52:42.617

请参阅以下示例[验证 XML 文档](http://asp.dotnetheaven.com/howto/doc/Xml/XmlDocumentValidation.aspx "验证和 XML 文档")。在我看来是对的。

# mysql - 如何从 Clojure 连接到 MySQL 数据库？

> ID：613929
> 
> 赞同：30
> 
> 时间：2009-03-05T08:07:00.420
> 
> 标签：mysql, clojure

假设：您的机器上已经运行了 Clojure 和 MySQL。
你怎么让他们说话？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-05T08:07:38.810

假设：您的机器上已经运行了 Clojure 和 MySQL。

1.  结帐并构建[clojure-contrib](http://code.google.com/p/clojure-contrib/)：

    ```
    git clone git://github.com/richhickey/clojure-contrib.git
    cd clojure-contrib
    build 
    ```

    将生成的**clojure-contrib.jar**放在**CLASSPATH**上。

2.  下载[MySQL Connector/J](http://dev.mysql.com/doc/refman/5.0/en/connector-j.html)并将**mysql-connector-java-5.1.7-bin.jar**放在**CLASSPATH上**

    *您可能必须使用以下参数运行 JVM：*

    ```
    -Djdbc.drivers=com.mysql.jdbc.Driver 
    ```

3.  确定 MySQL 数据库的连接 URL

    例如，如果您在[MAMP](http://www.mamp.info)下运行 MySQL， 那么您将在 JDBC 中使用的 URL 将类似于：

    ```
    conn = DriverManager.getConnection
            ("jdbc:mysql://localhost:8889/db_name?user=root&password=root") 
    ```

    url 被分解为以下组件：

    *   协议：`jdbc:`
    *   子协议：`mysql`
    *   数据库主机：`localhost`
    *   数据库端口：`8889`
    *   用户名
    *   密码
4.  制作这个clojure脚本，修改数据库连接参数以匹配你的URL，另存为test.clj，编译运行。

```
 (use 'clojure.contrib.sql)               ;;' satisfy prettify

      (let [db-host "localhost"
            db-port 8889
            db-name "db_name"]
        (def db {:classname "com.mysql.jdbc.Driver"
               :subprotocol "mysql"
               :subname (str "//" db-host ":" db-port "/" db-name)
               :user "root"
               :password "root"})
        (with-connection db
          (with-query-results rs ["select * from languages"]
            (dorun (map #(println (:language :iso_code %)) rs)))))

            ; rs will be a sequence of maps,
            ; one for each record in the result set. 
```

注意 此代码改编自 Mark Volkmann 编写的类似代码，用于[从 Clojure 访问 Postgres 数据库](http://groups.google.com/group/clojure/browse_thread/thread/176a11847601cc5a/445026a02e302837)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-04-18T20:19:17.047

这是一个对 lein 友好的答案，在[Nurullah Akkaya 的这篇博客](http://nakkaya.com/2009/12/14/using-mysql-with-clojure/)中提供了很多指导：

1.  将依赖项添加到您的`project.clj`：

    ```
    (defproject clojql "1.0.0-SNAPSHOT"
      :description "FIXME: write description"
      :dependencies [[org.clojure/clojure "1.2.1"]
                     [org.clojure/clojure-contrib "1.2.0"]   ;; for clojure.contrib.sql
                     [org.clojure/java.jdbc "0.0.6"]         ;; jdbc 
                     [mysql/mysql-connector-java "5.1.6"]])  ;; mysql driver 
    ```

2.  从命令行运行`lein deps`以获取依赖项

3.  在地图中指定您的连接信息：

    ```
    user=> (use 'clojure.contrib.sql)
    nil
    user=> (def db {:classname "com.mysql.jdbc.Driver" 
                    :subprotocol "mysql" 
                    :subname "//localhost:3306/nmr" 
                    :user "root"}) 
    ```

4.  使用`with-connection`和`with-query-results`宏[（及其他）](http://richhickey.github.com/clojure-contrib/sql-api.html#clojure.contrib.sql)：

    ```
    user=> (with-connection db (with-query-results rs ["select * from sometable"] (count rs)))
    667 
    ```

*第 3 步和第 4 步可以来自 repl（`lein repl`启动它）或在普通源代码中*

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-02-10T13:55:16.840

截至 2016 年：

使用[Leiningen](http://leiningen.org/)，在 project.clj 中添加依赖项：

```
:dependencies [[org.clojure/clojure "1.8.0"]
               [org.clojure/java.jdbc "0.4.2"]
               [mysql/mysql-connector-java "5.1.38"]] 
```

在命名空间定义中需要数据库连接器：

```
(ns name.space
  (:require [clojure.java.jdbc :as j])) 
```

定义数据库连接：

```
(def db-map {:subprotocol "mysql"
             :subname "//localhost:3306/SCHEME"
             :user "DB_USER"
             :password "DB_USER_PASS"}) 
```

查询数据库：

```
(j/query db-map ["SELECT * FROM table"]) 
```

[在http://clojure-doc.org/articles/ecosystem/java_jdbc/using_sql.html](http://clojure-doc.org/articles/ecosystem/java_jdbc/using_sql.html)找到更多示例

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-12-30T13:39:31.233

如果你想要一些语法糖，你可以试试 Korma。

[文档](http://sqlkorma.com/)

[Github](https://github.com/korma/Korma)

```
(use 'korma.db)
(defdb db (postgres {:db "mydb"
                     :user "user"
                     :password "dbpass"}))

(use 'korma.core)
(defentity users)

(select users)
;; executes: SELECT * FROM users

(select users
  (where (or (= :usersname "chris")
             (= :email "chris@chris.com"))))
;; executes: SELECT * FROM users WHERE (users.usersname = 'chris' OR users.email = 'chris@chris.com') 
```

# jquery - ASP.NET 中通过 jQuery 的 Gmail 类似警报框（用于信息或错误显示）

> ID：613934
> 
> 赞同：5
> 
> 时间：2009-03-05T08:08:03.503
> 
> 标签：jquery, messagebox

我正在寻找一些示例代码/控件，它通过 ASP.NET 中的 jQuery 让我感觉像 gmail 的消息框。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-05T09:06:46.843

我认为您正在寻找的是[jQuery BlockUI](http://malsup.com/jquery/block/)。

看看[演示的](http://malsup.com/jquery/block/#demos).

使用 css 可以匹配 gmail 的样式。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T09:48:52.403

您可以使用插件，但您也可以在页面顶部放置一个固定的 DIV 并将其淡入/淡出。让我们看一个例子：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>jQuery</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                $('input').click(function() {
                    $('#notification').fadeIn('slow');
                });
            });
        </script>
    </head>
    <body style="height: 1000px;">
        <div id="notification" style="position: fixed; top: 0px; margin-left: 50%; background-color: yellow; font-weight: bold; display: none;">Sending...</div>
        <input type="button" value="Gmail notification!" />
    </body>
</html> 
```

您必须弄清楚如何隐藏它（操作完成后的回调等），设置样式等等。这只是一个例子。

# linux - Linux 中的 _splitpath

> ID：613941
> 
> 赞同：16
> 
> 时间：2009-03-05T08:12:37.207
> 
> 标签：linux, unix, parsing

是否有 Linux 等效的 Win32 API`_splitpath`函数？
细节：

```
void _splitpath (
   const char *path,  // Path Input
   char *drive,       // Drive     : Output
   char *dir,         // Directory : Output
   char *fname,       // Filename  : Output
   char *ext          // Extension : Output
); 
```

它将完整路径作为输入，并提供驱动器、目录、文件名和扩展名作为输出。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-05T08:44:07.740

[`dirname()`](http://www.manpagez.com/man/3/dirname/) 和[`basename()`](http://www.manpagez.com/man/3/basename/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T08:17:24.247

我不知道，不。我要做的是：

*   运行路径`[realpath](http://linux.about.com/library/cmd/blcmdl3_realpath.htm)()`，使其规范
*   只需在目录分隔符上拆分，即`/`字符

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-14T13:44:11.527

使用`dirname()`和`basename()`。

# java - Java JVM 时区名称通过 java.text.SimpleDateFormat

> ID：613942
> 
> 赞同：2
> 
> 时间：2009-03-05T08:13:27.097
> 
> 标签：java, jvm, timezone

java.text.SimpleDateFormat 上的 Javadocs 在“z”模式字母上声明以下内容：

> z 时区 一般时区 太平洋标准时间；太平洋标准时间; GMT-08:00
> 
> 一般时区：如果时区有名称，则将其解释为文本。对于表示 GMT 偏移值的时区，使用以下语法...

问题是 - “如果他们有名字”......它从哪里得到这些名字？我在一个环境中看到 JST 以“JST”的形式出现，而在另一个环境中以“GMT+9”的形式出现

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T08:24:11.593

时区名称嵌入在 JVM 中。它们来自Arthur David Olson 维护的[tz数据库。](http://www.twinsun.com/tz/tz-link.htm)时区名称之间的差异是由 JVM 使用不同版本的 tz 数据库引起的。Sun为其 JVM提供了一个[时区更新工具，您可以使用它来更新时区名称定义。](http://java.sun.com/javase/tzupdater_README.html)当然，使用最新的 JVM 更新总是更好，但这并不总是一种选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T08:24:16.307

**它应该支持LDML**
（[**Unicode 区域设置数据标记语言**](http://www.unicode.org/reports/tr35/)）规范 定义的时区显示名称。

您会在[时区本地化](http://unicode.org/cldr/data/docs/design/formatting/time_zone_localization.html)中找到所有名称，尤其是在“[**别名**](http://unicode.org/cldr/data/docs/design/formatting/zone_log.html)”中

# delphi - TWebbrowser 中恼人的点击声

> ID：613943
> 
> 赞同：5
> 
> 时间：2009-03-05T08:14:14.770
> 
> 标签：delphi

我在我的 Delphi 应用程序中使用 TWebbrowser 组件，我以编程方式加载其内容：

```
(aWebBrowser.Document as IPersistStreamInit).
                               Load(TStreamAdapter.Create(aMemoryStream)) 
```

每次加载时，组件都会产生烦人的咔嗒声。这可以禁用吗？
TIA

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-05T10:44:38.403

看一下 URLMON.DLL 中的 CoInternetSetFeatureEnabled 过程，如此处[所述](http://msdn.microsoft.com/en-us/library/ms537184(VS.85).aspx)。为您的应用启用 FEATURE_DISABLE_NAVIGATION_SOUNDS 将满足您的需求。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-05T08:38:24.913

这是一个[窗口设置](http://ask-leo.com/ies_click_sound_how_do_i_turn_that_off.html)。我不确定您的应用程序是否应该更改该设置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T10:29:30.933

好的，这是我尝试过的：

```
procedure TForm1.FormCreate(Sender: TObject);
begin
  Application.OnActivate := AppActivate;
  Application.OnDeactivate := AppDeactivate;
end;

procedure TForm1.AppActivate(Sender: TObject);
begin
  with TRegistry.Create do
  try
    RootKey := HKEY_CURRENT_USER;
    OpenKey('AppEvents\Schemes\Apps\Explorer\Navigating\.Current', False);
    if ReadString('') <> '' then
      RememberSoundFile := ReadString('');
    WriteString('', '');
  finally
    Free;
  end;
end;

procedure TForm1.AppDeactivate(Sender: TObject);
begin
  with TRegistry.Create do
  try
    RootKey := HKEY_CURRENT_USER;
    OpenKey('AppEvents\Schemes\Apps\Explorer\Navigating\.Current', False);
    WriteString('', RememberSoundFile);
  finally
    Free;
  end;
end; 
```

它很丑，但它有效。:-) 虽然我基本上同意 Davy，但这个解决方案至少具有其他应用程序不会受到影响的优势。
我可以将它添加为禁用点击的用户选项，但我个人真的希望它消失！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T08:33:27.280

有没有可能这是 Windows 标准的“开始导航”声音（请参阅“控制面板”-“声音和音频设备”）？

# jquery - 在页面上执行一些操作后使用 jQuery 中的分页保留页面

> ID：613947
> 
> 赞同：0
> 
> 时间：2009-03-05T08:14:46.030
> 
> 标签：jquery, jquery-ui, pagination

我正在使用 JQuery 进行分页。我在该页面中有一个按钮，当单击的信息存储在后端并且页面被刷新时。

但刷新后，我可以看到分页的第一页，而不是我点击的页面。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T18:14:18.353

将当前页面保存在隐藏的输入元素中。

在您的后端，如果您需要对 pageNumber 执行某些操作，您可能可以访问表单元素。在 asp.net 中，隐藏字段仍应包含 pageNumber，因此您可以在回发后在 jquery 中重新设置分页。

或者，您可以编辑表单的 action 属性以将 pageNumber 设置为 url 参数。像这样：

```
$("form").attr("action", "my_web_page.php?pageNumber=" + $("#my_hidden_pageNumber").val()); 
```

然后在回发后加载页面时，再次使用 url 参数在 jquery 中设置正确的页面。这里有一个插件可以轻松读取 url 参数： http: [//www.mathias-bank.de/2007/04/21/jquery-plugin-geturlparam-version-2/](http://www.mathias-bank.de/2007/04/21/jquery-plugin-geturlparam-version-2/)

# configuration - 分发前配置安装程序

> ID：613949
> 
> 赞同：-1
> 
> 时间：2009-03-05T08:16:07.900
> 
> 标签：configuration, installation, product-management

我们开发了一种产品，由我们的客户分发给他们的客户。我们需要允许客户公司的管理员在将安装程序发送给最终用户之前对安装程序进行配置更改。在这种情况下，配置更改意味着要在最终用户计算机上创建几个注册表项。我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T08:25:55.193

请检查： http: [//ozgrant.com/2008/03/11/customising-your-wix-msi-with-transform-files/](http://ozgrant.com/2008/03/11/customising-your-wix-msi-with-transform-files/)

这里，

*   开发团队创建一个通用安装程序。
*   然后，IT 团队使用 Orca 创建不同的转换（.mst 文件），并且，
*   这些带有特定 .mst 的安装程序被运送到不同的客户端集。

高温高压

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T22:51:26.813

这是我们发送给客户的示例脚本。他们创建一个自定义配置文件，运行这个脚本，最终得到一个 MST 和一个 CAB，它将覆盖基本 MSI 中包含的默认值。

最初我们只是向客户提供使用 Orca 的说明，但这实际上只能让他们更新属性/值 - 如果您需要替换配置文件，那么对于大多数 IT 人员来说，这最终会有点复杂，除非他们可以访问 WISE、InstallShield或类似的。

```
Option Explicit

Const MSI_SRC = "myapp.msi"
Const MSI_TEMP = "temp.msi"
Const MST_FILE = "custom.mst"
Const MY_CONFIG = "customsettings.reg"
Const CAB_FILE = "config.cab"

Dim filesys 
Set filesys=CreateObject("Scripting.FileSystemObject")

If filesys.FileExists(MSI_SRC) Then
   filesys.CopyFile MSI_SRC, MSI_TEMP
Else
    MsgBox "Unable to find " & MSI_SRC & "exiting", 48, "Fatal Error"
    Set filesys = Nothing
    WScript.Quit
End If

If filesys.FileExists(MST_FILE) Then
   filesys.DeleteFile(MST_FILE)
End If

Dim installer, database, database2, view

Set installer = CreateObject("WindowsInstaller.Installer")
Set database = installer.OpenDatabase (MSI_TEMP, 1)
Set database2 = installer.OpenDatabase (MSI_SRC, 1)

If filesys.FileExists(MY_CONFIG) Then
    Dim objFile, size, result, seq, objCab
    Set objCab = CreateObject("MakeCab.MakeCab.1")
    objCab.CreateCab CAB_FILE, False, False, False
    objCab.AddFile MY_CONFIG, filesys.GetFileName(MY_CONFIG)
    objCab.CloseCab

    Set objFile = filesys.GetFile(MY_CONFIG)
    size = objFile.Size

    Set view = database.OpenView ("SELECT LastSequence FROM Media WHERE DiskId = 1")
    view.Execute
    Set result = view.Fetch
    seq = result.StringData(1) + 1 ' Sequence for new configuration file

    Set view = database.OpenView ("INSERT INTO Media (DiskId, LastSequence, Cabinet) VALUES ('2', '" & seq & "', '" & CAB_FILE & "')")
    view.Execute

    Set view = database.OpenView ("UPDATE File SET FileSize = " & size & ", Sequence = " & seq & ", FileName = 'CUSTOM~2.REG|customsettings.reg' WHERE File = '" & LCase(MY_CONFIG) & "'")
    view.Execute
End If

database.GenerateTransform database2, MST_FILE
database.CreateTransformSummaryInfo database2, MST_FILE, 0, 0

' Cleanup
Set database = Nothing
Set database2 = Nothing
Set installer = Nothing
Set view = Nothing

filesys.DeleteFile(MSI_TEMP)
Set filesys = Nothing 
```

# java - 针对检查异常的案例

> ID：613954
> 
> 赞同：502
> 
> 时间：2009-03-05T08:18:54.603
> 
> 标签：java, exception, checked-exceptions

多年来，我一直无法得到以下问题的正确答案：为什么有些开发人员如此反对受检异常？我进行了无数次对话，阅读了博客上的内容，阅读了布鲁斯·埃克尔（Bruce Eckel）所说的话（我看到的第一个反对他们的人）。

我目前正在编写一些新代码，并非常注意我如何处理异常。我试图看到“我们不喜欢检查异常”人群的观点，但我仍然看不到它。

我的每一次谈话都以同样的问题结束……让我来设置一下：

一般来说（从 Java 的设计方式来看），

*   `Error`用于永远不应该被抓住的东西（VM 对花生过敏，有人在上面掉了一罐花生）
*   `RuntimeException`是针对程序员做错的事情（程序员离开了数组的末尾）
*   `Exception`（除了`RuntimeException`）是程序员无法控制的事情（写入文件系统时磁盘已满，已达到进程的文件句柄限制，您无法打开更多文件）
*   `Throwable`只是所有异常类型的父级。

我听到的一个常见论点是，如果发生异常，那么开发人员要做的就是退出程序。

我听到的另一个常见论点是检查异常使重构代码变得更加困难。

对于“我要做的就是退出”的论点，我说即使您要退出，您也需要显示合理的错误消息。如果您只是在处理错误，那么当程序退出而没有明确说明原因时，您的用户不会过分高兴。

对于“重构变得困难”的人群，这表明没有选择适当的抽象级别。而不是声明一个方法抛出一个`IOException`，`IOException`应该将其转换为一个更适合正在发生的事情的异常。

我对 Main 包装没有问题`catch(Exception)`（或者在某些情况下`catch(Throwable)`确保程序可以正常退出 - 但我总是捕获我需要的特定异常。这样做至少可以让我显示一个适当的错误信息。

人们从不回答的问题是：

> 如果你抛出`RuntimeException` 子类而不是`Exception` 子类，那么你怎么知道你应该捕获什么？

如果答案是catch `Exception`，那么您也将像处理系统异常一样处理程序员错误。这对我来说似乎是错误的。

如果你抓住`Throwable`了，那么你就会以同样的方式处理系统异常和 VM 错误（等等）。这对我来说似乎是错误的。

如果答案是你只捕获你知道抛出的异常，那么你怎么知道抛出了什么？当程序员 X 抛出一个新异常并忘记捕获它时会发生什么？这对我来说似乎很危险。

我会说显示堆栈跟踪的程序是错误的。不喜欢检查异常的人不会有这种感觉吗？

所以，如果你不喜欢检查的异常，你能解释一下为什么不回答没有得到回答的问题吗？

我不是在寻找关于何时使用这两种模型的建议，我正在寻找的是*为什么*人们`RuntimeException`因为不喜欢从扩展而扩展`Exception`和/或为什么他们捕获异常然后重新抛出 a`RuntimeException`而不是在他们的方法中添加抛出. 我想了解不喜欢检查异常的动机。

* * *

## 回答 #1

> 赞同：310
> 
> 时间：2009-03-05T12:03:49.960

我想我读过和你一样的布鲁斯·埃克尔采访——它总是让我烦恼。事实上，这个论点是由 .NET 和 C# 背后的 MS 天才 Anders Hejlsberg（如果这确实是你正在谈论的帖子）提出的。

> [http://www.artima.com/intv/handcuffs.html](http://www.artima.com/intv/handcuffs.html)

尽管我是 Hejlsberg 和他的作品的粉丝，但这个论点一直让我觉得是假的。它基本上归结为：

> “检查的异常是不好的，因为程序员只是滥用它们，总是捕捉它们并解雇它们，这导致问题被隐藏和忽略，否则这些问题会呈现给用户”。

“以*其他方式呈现给用户”*是指如果您使用运行时异常，懒惰的程序员将忽略它（而不是用空的 catch 块捕获它）并且用户会看到它。

该论点的总结是*“程序员不会正确使用它们，不正确使用它们比没有它们更糟糕”*。

这个论点有一些道理，事实上，我怀疑 Gosling 不在 Java 中放置运算符覆盖的动机来自一个类似的论点——它们使程序员感到困惑，因为它们经常被滥用。

但最后，我发现这是 Hejlsberg 的一个虚假论点，并且可能是为了解释缺乏而创建的一个事后论点，而不是一个经过深思熟虑的决定。

我认为，虽然过度使用已检查异常是一件坏事，并且往往会导致用户处理草率，但是正确使用它们可以让 API 程序员给 API 客户端程序员带来很大的好处。

现在 API 程序员必须小心不要到处抛出已检查的异常，否则它们只会惹恼客户端程序员。Hejlsberg 警告说，非常懒惰的客户端程序员将求助于捕获`(Exception) {}`，所有好处都将丢失，地狱将接踵而至。但是在某些情况下，一个好的检查异常是无可替代的。

对我来说，经典的例子是文件打开 API。语言历史上的每一种编程语言（至少在文件系统上）都有一个 API，可以让你打开文件。每个使用这个 API 的客户端程序员都知道他们必须处理他们试图打开的文件不存在的情况。让我换个说法：每个使用此 API 的客户端程序员*都应该知道*他们必须处理这种情况。还有一个问题：API 程序员是否可以帮助他们知道他们应该通过单独评论来处理它，或者他们确实可以*坚持*让客户处理它。

在 C 中，成语类似于

```
 if (f = fopen("goodluckfindingthisfile")) { ... } 
  else { // file not found ... 
```

where`fopen`通过返回 0 表示失败，而 C（愚蠢地）让您将 0 视为布尔值，并且...基本上，您学习了这个习语就可以了。但是，如果您是菜鸟并且没有学习成语怎么办。然后，当然，你从

```
 f = fopen("goodluckfindingthisfile");
   f.read(); // BANG! 
```

并努力学习。

请注意，我们在这里只讨论强类型语言：对于强类型语言中的 API 有一个清晰的概念：它是一个功能（方法）的大杂烩，供您使用，每个功能（方法）都有一个明确定义的协议。

该明确定义的协议通常由方法签名定义。此处 fopen 要求您向其传递一个字符串（或在 C 的情况下为 char*）。如果你给它其他东西，你会得到一个编译时错误。您没有遵守协议 - 您没有正确使用 API。

在某些（晦涩的）语言中，返回类型也是协议的一部分。如果您尝试`fopen()`在某些语言中调用等价物而不将其分配给变量，您也会得到一个编译时错误（您只能使用 void 函数来做到这一点）。

我要说明的一点是：*在静态类型语言中，API 程序员鼓​​励客户端正确使用 API，如果客户端代码出现任何明显错误，则阻止其编译。*

（在动态类型语言中，比如 Ruby，你可以传递任何东西，比如浮点数，作为文件名——它会编译。如果你甚至不打算控制方法参数，为什么还要用检查异常来麻烦用户。此处提出的论点仅适用于静态类型语言。）

那么，检查异常呢？

好吧，这是您可以用来打开文件的 Java API 之一。

```
try {
  f = new FileInputStream("goodluckfindingthisfile");
}
catch (FileNotFoundException e) {
  // deal with it. No really, deal with it!
  ... // this is me dealing with it
} 
```

看到那个渔获了吗？这是该 API 方法的签名：

```
public FileInputStream(String name)
                throws FileNotFoundException 
```

请注意，这`FileNotFoundException`是一个*检查*异常。

API 程序员对你说：“你可以使用这个构造函数来创建一个新的 FileInputStream，但是你

a)*必须*将文件名作为字符串传递
b)*必须*接受在运行时可能找不到文件的可能性”

就我而言，这就是重点。

关键基本上是问题所说的“程序员无法控制的事情”。我的第一个想法是他/她的意思是*API*程序员无法控制的东西。但事实上，正确使用的检查异常应该是针对客户端程序员和 API 程序员无法控制的事情。我认为这是不滥用检查异常的关键。

我认为打开文件很好地说明了这一点。API 程序员知道您可能会给他们一个在调用 API 时结果不存在的文件名，并且他们将无法返回您想要的内容，但必须抛出异常。他们也知道这会经常发生，并且客户端程序员可能希望文件名在他们编写调用时是正确的，但在运行时也可能由于他们无法控制的原因而出错。

因此 API 明确表示：在某些情况下，当您致电给我时，该文件不存在，而您最好更好地处理它。

如果有反例，这会更清楚。想象一下，我正在编写一个表 API。我在某处有一个包含此方法的 API 的表模型：

```
public RowData getRowData(int row) 
```

现在，作为一名 API 程序员，我知道在某些情况下，某些客户端会为行传入负值或在表外传入行值。所以我可能很想抛出一个检查异常并强制客户端处理它：

```
public RowData getRowData(int row) throws CheckedInvalidRowNumberException 
```

（当然，我不会真正称其为“已检查”。）

这是对检查异常的不好使用。客户端代码将充满获取行数据的调用，每一个都必须使用 try/catch，这是为了什么？他们是否会向用户报告搜索了错误的行？可能不会——因为无论我的表格视图周围的 UI 是什么，它都不应该让用户进入请求非法行的状态。所以这是客户端程序员的一个错误。

API 程序员仍然可以预测客户端将编写此类错误，并应使用运行时异常（如`IllegalArgumentException`.

对于 中的已检查异常`getRowData`，这显然会导致 Hejlsberg 的懒惰程序员简单地添加空捕获。发生这种情况时，即使对测试人员或客户端开发人员进行调试，非法行值也不会很明显，而是会导致难以查明来源的连锁错误。阿里安火箭发射后会爆炸。

好的，问题来了：我是说检查的异常`FileNotFoundException`不仅仅是一件好事，而且是 API 程序员工具箱中的一个必不可少的工具，用于以对客户端程序员最有用的方式定义 API。但这`CheckedInvalidRowNumberException`是一个很大的不便，导致糟糕的编程，应该避免。但是如何区分。

我想这不是一门精确的科学，我想这在一定程度上是 Hejlsberg 论点的基础，并且可能证明了这一点。但是我不乐意把婴儿和洗澡水一起扔在这里，所以请允许我在这里提取一些规则来区分好的检查异常和坏的：

1.  不受客户控制或封闭与开放：

    *仅当错误情况超出 API和*客户端程序员的控制范围时，才应使用已检查异常。这与系统的*开放*程度或*封闭*程度有关。在客户端程序员可以控制所有按钮、键盘命令等的*受限*UI 中，这些按钮、键盘命令等从表视图（封闭系统）中添加和删除行，如果它试图从一个不存在的行。在基于文件的操作系统中，任何数量的用户/应用程序都可以添加和删除文件（开放系统），可以想象客户端请求的文件已在他们不知情的情况下被删除，因此应该期望他们处理它.

2.  无处不在：

    不应在客户端频繁进行的 API 调用上使用已检查的异常。经常我的意思是来自客户端代码中的很多地方 - 不是经常在时间上。所以客户端代码不会经常尝试打开同一个文件，但我的表格视图会`RowData`从不同的方法中得到。特别是，我将编写很多代码，例如

    ```
    if (model.getRowData().getCell(0).isEmpty()) 
    ```

每次都必须包含在 try/catch 中会很痛苦。

3.  通知用户：

    在您可以想象向最终用户呈现有用的错误消息的情况下，应使用已检查的异常。这就是*“当它发生时你会怎么做？”* 我在上面提出的问题。它还与第 1 项有关。由于您可以预测客户端 API 系统之外的某些内容可能会导致文件不存在，因此您可以合理地告诉用户它：

    ```
    "Error: could not find the file 'goodluckfindingthisfile'" 
    ```

    由于您的非法行号是由内部错误引起的，并且不是用户的过错，因此您实际上没有任何有用的信息可以提供给他们。如果您的应用程序不允许运行时异常进入控制台，它可能最终会给它们一些丑陋的消息，例如：

    ```
    "Internal error occured: IllegalArgumentException in ...." 
    ```

    简而言之，如果您认为您的客户端程序员不能以帮助用户的方式解释您的异常，那么您可能不应该使用已检查异常。

所以这些是我的规则。有点做作，毫无疑问会有例外（如果你愿意，请帮助我完善它们）。但我的主要论点是，在某些情况下`FileNotFoundException`，检查的异常与参数类型一样重要和有用的 API 合同的一部分。所以我们不应该仅仅因为它被滥用就放弃它。

抱歉，我不是故意让这件事变得如此冗长和胡扯。最后让我提出两个建议：

答：API 程序员：谨慎使用已检查异常以保持其有用性。如有疑问，请使用未经检查的异常。

B：客户端程序员：养成在开发早期创建包装异常（google it）的习惯。JDK 1.4 及更高版本为此提供了一个构造函数`RuntimeException`，但您也可以轻松创建自己的构造函数。这是构造函数：

```
public RuntimeException(Throwable cause) 
```

然后养成每当你必须处理一个检查的异常并且你感到懒惰（或者你认为 API 程序员一开始就过分热衷于使用检查的异常）的习惯，不要只是吞下异常，包装它并重新抛出它。

```
try {
  overzealousAPI(thisArgumentWontWork);
}
catch (OverzealousCheckedException exception) {
  throw new RuntimeException(exception);  
} 
```

把它放在你的 IDE 的一个小代码模板中，当你感到懒惰时使用它。这样，如果您确实需要处理已检查的异常，您将在运行时看到问题后被迫返回并处理它。因为，相信我（和 Anders Hejlsberg），你永远不会回到你的 TODO

```
catch (Exception e) { /* TODO deal with this at some point (yeah right) */} 
```

* * *

## 回答 #2

> 赞同：208
> 
> 时间：2009-03-05T10:59:39.007

关于检查异常的事情是，按照通常对概念的理解，它们并不是真正的异常。相反，它们是 API 替代返回值。

异常的整个想法是，在调用链的某个地方抛出的错误可以冒泡并由更远的地方的代码处理，而无需干预代码担心它。另一方面，已检查的异常要求抛出者和捕获者之间的每一级代码都声明他们知道可以通过它们的所有形式的异常。这在实践中与如果检查的异常只是调用者必须检查的特殊返回值几乎没有什么不同。例如。[伪代码]：

```
public [int or IOException] writeToStream(OutputStream stream) {
    [void or IOException] a= stream.write(mybytes);
    if (a instanceof IOException)
        return a;
    return mybytes.length;
} 
```

由于 Java 不能做替代返回值，或者简单的内联元组作为返回值，所以检查异常是一个合理的响应。

问题是很多代码，包括大量的标准库，滥用检查的异常来处理真正的异常情况，你可能很想赶上几个级别。为什么 IOException 不是 RuntimeException？在所有其他语言中，我都可以让 IO 异常发生，如果我不采取任何措施来处理它，我的应用程序将停止，并且我会得到一个方便的堆栈跟踪来查看。这是可能发生的最好的事情。

可能有两个方法，你想从整个写入到流的过程中捕获所有 IOExceptions，中止该过程并跳转到错误报告代码；在 Java 中，如果不在每个调用级别添加“抛出 IOException”，即使是本身不执行 IO 的级别，也无法做到这一点。这样的方法不需要知道异常处理；必须为其签名添加例外：

1.  不必要地增加耦合；
2.  使界面签名很难更改；
3.  降低代码的可读性；
4.  太烦人了，程序员的常见反应是通过做一些可怕的事情来打败系统，比如“抛出异常”、“捕获（异常 e）{}”，或者将所有内容包装在 RuntimeException 中（这使得调试更加困难）。

然后有很多荒谬的库异常，例如：

```
try {
    httpconn.setRequestMethod("POST");
} catch (ProtocolException e) {
    throw new CanNeverHappenException("oh dear!");
} 
```

当你不得不用这样可笑的杂物来弄乱你的代码时，难怪受检异常会受到很多讨厌，即使这只是简单的糟糕的 API 设计。

另一个特别不好的影响是控制反转，其中组件 A 向通用组件 B 提供回调。组件 A 希望能够让异常从其回调中抛出回它调用组件 B 的地方，但它不能因为这会改变由 B 修复的回调接口。A 只能通过将真正的异常包装在 RuntimeException 中来做到这一点，这是要编写的更多异常处理样板。

在 Java 及其标准库中实现的已检查异常意味着样板、样板、样板。在已经冗长的语言中，这不是胜利。

* * *

## 回答 #3

> 赞同：83
> 
> 时间：2009-03-05T11:44:29.460

我不会针对检查的异常重新讨论所有（许多）原​​因，而是只选择一个。我已经记不清我写这段代码的次数了：

```
try {
  // do stuff
} catch (AnnoyingcheckedException e) {
  throw new RuntimeException(e);
} 
```

99%的时间我对此无能为力。finally 块进行任何必要的清理（或者至少它们应该）。

我也记不清我看到这个的次数了：

```
try {
  // do stuff
} catch (AnnoyingCheckedException e) {
  // do nothing
} 
```

为什么？因为有人不得不处理它并且很懒惰。是不是错了？当然。它会发生吗？绝对地。如果这是一个未经检查的异常呢？该应用程序将刚刚死掉（这比吞下异常更可取）。

然后我们有令人愤怒的代码，它使用异常作为流控制的一种形式，就像[java.text.Format](http://java.sun.com/j2se/1.5.0/docs/api/java/text/Format.html#parseObject(java.lang.String))一样。嗡嗡声。错误的。用户将“abc”放入表单的数字字段中也不例外。

好吧，我想这是三个原因。

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2013-11-27T02:03:24.187

我知道这是一个老问题，但我花了一段时间来处理检查的异常，我有一些东西要补充。请原谅我的长度！

我对检查异常的主要不满是它们破坏了多态性。让它们与多态接口很好地配合是不可能的。

采用好的 ol' Java[`List`](http://docs.oracle.com/javase/8/docs/api/java/util/List.html)接口。我们有常见的内存实现，例如`ArrayList`和`LinkedList`。我们还有 skeletal 类[`AbstractList`](http://docs.oracle.com/javase/8/docs/api/java/util/AbstractList.html)，可以很容易地设计新类型的列表。对于只读列表，我们只需要实现两个方法：`size()`和`get(int index)`.

这个示例`WidgetList`类从文件中读取一些固定大小的类型对象`Widget`（未显示）：

```
class WidgetList extends AbstractList<Widget> {
    private static final int SIZE_OF_WIDGET = 100;
    private final RandomAccessFile file;

    public WidgetList(RandomAccessFile file) {
        this.file = file;
    }

    @Override
    public int size() {
        return (int)(file.length() / SIZE_OF_WIDGET);
    }

    @Override
    public Widget get(int index) {
        file.seek((long)index * SIZE_OF_WIDGET);
        byte[] data = new byte[SIZE_OF_WIDGET];
        file.read(data);
        return new Widget(data);
    }
} 
```

通过使用熟悉的界面公开 Widget `List`，您可以检索项目 ( `list.get(123)`) 或迭代列表 ( `for (Widget w : list) ...`) 而无需了解`WidgetList`其自身。可以将此列表传递给任何使用通用列表的标准方法，或将其包装在`Collections.synchronizedList`. 使用它的代码既不需要知道也不需要关心“小部件”是在现场组成的，来自数组，还是从文件、数据库、网络中读取，或者来自未来的子空间中继。它仍然可以正常工作，因为`List`接口已正确实现。

除非它不是。上面的类不能编译，因为文件访问方法可能会抛出一个`IOException`你必须“捕获或指定”的检查异常。您***不能将其指定为抛出***- 编译器不会让您这样做，因为这会违反`List`接口的合同。并且没有任何有用的方法`WidgetList`可以处理异常（稍后我将详细说明）。

显然，唯一要做的就是捕获并重新抛出已检查的异常作为一些未检查的异常：

```
@Override
public int size() {
    try {
        return (int)(file.length() / SIZE_OF_WIDGET);
    } catch (IOException e) {
        throw new WidgetListException(e);
    }
}

public static class WidgetListException extends RuntimeException {
    public WidgetListException(Throwable cause) {
        super(cause);
    }
} 
```

（（编辑：Java 8[`UncheckedIOException`](http://docs.oracle.com/javase/8/docs/api/java/io/UncheckedIOException.html)为这种情况添加了一个类：用于`IOException`跨多态方法边界捕获和重新抛出 s。有点证明了我的观点！））

所以检查异常在这种情况下***根本不起作用***。你不能扔它们。`Map`由数据库支持的聪明人或`java.util.Random`通过 COM 端口连接到量子熵源的实现同上。一旦您尝试对多态接口的实现做任何新颖的事情，检查异常的概念就会失败。但是检查的异常是如此阴险，它们仍然不会让你平静下来，因为你仍然必须从低级方法中捕获并重新抛出任何异常，从而使代码和堆栈跟踪变得混乱。

我发现无处不在的[`Runnable`](http://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html)接口经常被退回到这个角落，如果它调用了引发检查异常的东西。它不能按原样抛出异常，所以它所能做的就是通过捕获并重新抛出`RuntimeException`.

实际上，如果你使用 hack ，你*可以抛出未声明的检查异常。*JVM 在运行时并不关心检查异常规则，所以我们只需要欺骗编译器。最简单的方法是滥用泛型。这是我的方法（显示类名是因为（在 Java 8 之前）它在泛型方法的调用语法中是必需的）：

```
class Util {
    /**
     * Throws any {@link Throwable} without needing to declare it in the
     * method's {@code throws} clause.
     * 
     * <p>When calling, it is suggested to prepend this method by the
     * {@code throw} keyword. This tells the compiler about the control flow,
     * about reachable and unreachable code. (For example, you don't need to
     * specify a method return value when throwing an exception.) To support
     * this, this method has a return type of {@link RuntimeException},
     * although it never returns anything.
     * 
     * @param t the {@code Throwable} to throw
     * @return nothing; this method never returns normally
     * @throws Throwable that was provided to the method
     * @throws NullPointerException if {@code t} is {@code null}
     */
    public static RuntimeException sneakyThrow(Throwable t) {
        return Util.<RuntimeException>sneakyThrow1(t);
    }

    @SuppressWarnings("unchecked")
    private static <T extends Throwable> RuntimeException sneakyThrow1(
            Throwable t) throws T {
        throw (T)t;
    }
} 
```

欢呼！使用它，我们可以在堆栈的任何深度抛出已检查的异常，而无需声明它，无需将其包装在 a`RuntimeException`中，也不会弄乱堆栈跟踪！再次使用“WidgetList”示例：

```
@Override
public int size() {
    try {
        return (int)(file.length() / SIZE_OF_WIDGET);
    } catch (IOException e) {
        throw sneakyThrow(e);
    }
} 
```

不幸的是，对受检异常的最后侮辱是编译器拒绝让您**捕获**受检异常，如果它有缺陷地认为它不能被抛出的话。（未经检查的异常没有这条规则。）为了捕捉偷偷抛出的异常，我们必须这样做：

```
try {
    ...
} catch (Throwable t) { // catch everything
    if (t instanceof IOException) {
        // handle it
        ...
    } else {
        // didn't want to catch this one; let it go
        throw t;
    }
} 
```

这有点尴尬，但从好的方面来说，它仍然比用于提取包含在`RuntimeException`.

令人高兴的`throw t;`是，即使`t`检查了 of 的类型，该语句在这里也是合法的，这要归功于 Java 7 中添加的关于重新抛出捕获的异常的规则。

* * *

当检查的异常遇到多态性时，相反的情况也是一个问题：当一个方法被指定为可能抛出一个检查的异常，但重写的实现没有。例如，抽象类[`OutputStream`](http://docs.oracle.com/javase/8/docs/api/java/io/OutputStream.html)的`write`方法都指定`throws IOException`. [`ByteArrayOutputStream`](http://docs.oracle.com/javase/8/docs/api/java/io/ByteArrayOutputStream.html)是写入内存数组而不是真正的 I/O 源的子类。它的重写`write`方法不能导致`IOException`s，因此它们没有`throws`子句，您可以调用它们而不必担心 catch-or-specify 要求。

除了并非总是如此。假设`Widget`有一种方法可以将其保存到流中：

```
public void writeTo(OutputStream out) throws IOException; 
```

声明这个方法接受一个plain`OutputStream`是正确的做法，所以它可以多态地用于各种输出：文件、数据库、网络等等。和内存数组。但是，对于内存中的数组，有一个虚假的要求来处理实际上不可能发生的异常：

```
ByteArrayOutputStream out = new ByteArrayOutputStream();
try {
    someWidget.writeTo(out);
} catch (IOException e) {
    // can't happen (although we shouldn't ignore it if it does)
    throw new RuntimeException(e);
} 
```

像往常一样，检查的异常会阻碍。如果您的变量被声明为具有更多开放式异常要求的基类型，则您必须为这些异常添加处理程序，即使您*知道*它们不会在您的应用程序中发生。

但是等等，检查异常实际上*很*烦人，*它们甚至不会让你做相反的事情！*想象一下，您当前捕获了对 an 的调用`IOException`所抛出的任何内容，但是您想将变量的声明类型更改为 a ，编译器会责备您试图捕获它说不能抛出的已检查异常。`write``OutputStream``ByteArrayOutputStream`

该规则会导致一些荒谬的问题。例如， 的三种`write`方法之一*不会*`OutputStream`被覆盖。具体来说，是一种方便的方法，它通过调用偏移量为 0 和数组长度来写入完整数组。覆盖三参数方法，但按原样继承一参数便捷方法。继承的方法完全正确，但它包含一个不需要的子句。这可能是 设计中的一个疏忽，但他们永远无法修复它，因为它会破坏与捕获异常的任何代码的源代码兼容性——从未、永远不会、永远不会抛出异常！*`ByteArrayOutputStream``write(byte[] data)``write(byte[] data, int offset, int length)``ByteArrayOutputStream``throws``ByteArrayOutputStream`*

 *该规则在编辑和调试期间也很烦人。例如，有时我会临时注释掉一个方法调用，如果它可能抛出一个检查异常，编译器现在会抱怨本地`try`和`catch`块的存在。所以我也必须将它们注释掉，现在在编辑其中的代码时，IDE 将缩进到错误的级别，因为`{`and`}`被注释掉了。呸！这是一个小小的抱怨，但似乎检查异常所做的唯一一件事就是造成麻烦。

* * *

我快完成了。我对检查异常的最后一个挫折是，*在大多数呼叫站点*，您对它们没有任何用处。理想情况下，当出现问题时，我们会有一个称职的特定于应用程序的处理程序，可以通知用户问题和/或适当地结束或重试操作。只有堆栈上的处理程序才能做到这一点，因为它是唯一知道总体目标的处理程序。

相反，我们得到了以下惯用语，它作为一种关闭编译器的方式很猖獗：

```
try {
    ...
} catch (SomeStupidExceptionOmgWhoCares e) {
    e.printStackTrace();
} 
```

在 GUI 或自动化程序中，不会看到打印的消息。更糟糕的是，它会在异常发生后继续处理其余代码。异常实际上不是错误吗？那就不要打印了。否则，一会儿其他东西会爆炸，到那时原始异常对象将消失。这个成语并不比 BASIC`On Error Resume Next`或 PHP 的`error_reporting(0);`.

调用某种记录器类也好不到哪里去：

```
try {
    ...
} catch (SomethingWeird e) {
    logger.log(e);
} 
```

`e.printStackTrace();`这就像在不确定状态下继续使用代码一样懒惰。此外，特定日志系统或其他处理程序的选择是特定于应用程序的，因此这会损害代码重用。

可是等等！有一种简单而通用的方法可以找到特定于应用程序的处理程序。它在调用堆栈上更高（或者它被设置为线程的[未捕获异常处理程序](https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#setUncaughtExceptionHandler-java.lang.Thread.UncaughtExceptionHandler-)）。所以在大多数地方，***你需要做的就是把异常抛到更高的堆栈上***。例如，`throw e;`。已检查的异常只会妨碍您。

我确信在设计语言时检查异常听起来是个好主意，但在实践中我发现它们都很麻烦而且没有任何好处。

* * *

## 回答 #5

> 赞同：47
> 
> 时间：2009-03-05T09:40:37.057

好吧，这与显示堆栈跟踪或静默崩溃无关。这是关于能够在层之间传达错误。

检查异常的问题是它们鼓励人们吞下重要的细节（即异常类）。如果您选择不接受这些细节，那么您必须在整个应用程序中不断添加 throws 声明。这意味着 1) 一种新的异常类型会影响许多函数签名，以及 2) 您可能会错过您实际想要捕获的异常的特定实例（例如，您为将数据写入文件。辅助文件是可选的，所以你可以忽略它的错误，但因为签名`throws IOException`，很容易忽略这一点）。

我现在实际上正在应用程序中处理这种情况。我们将几乎所有异常重新打包为 AppSpecificException。这使得签名非常干净，我们不必担心`throws`签名爆炸。

当然，现在我们需要专门化更高级别的错误处理，实现重试逻辑等。但是，一切都是 AppSpecificException，所以我们不能说“如果抛出 IOException，请重试”或“如果抛出 ClassNotFound，则完全中止”。我们没有可靠的方法来处理*真正的*异常，因为当它们在我们的代码和第三方代码之间传递时，它们会一次又一次地重新打包。

这就是为什么我非常喜欢 python 中的异常处理。您只能捕获您想要和/或可以处理的东西。其他所有东西都会冒泡，就好像你自己重新扔了一样（反正你已经做过了）。

我一次又一次地发现，在我提到的整个项目中，异常处理分为 3 类：

1.  捕获并处理*特定*的异常。例如，这是为了实现重试逻辑。
2.  捕获并重新抛出*其他*异常。这里发生的一切通常是日志记录，它通常是一条陈词滥调的消息，例如“无法打开 $filename”。这些是您无能为力的错误；只有更高级别的人知道足以处理它。
3.  捕获所有内容并显示错误消息。这通常位于调度程序的根部，它所做的一切确保它可以通过非异常机制（弹出对话框、编组 RPC 错误对象等）将错误传达给调用者。

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2009-04-01T03:25:32.227

## 信噪比

首先，检查异常会降​​低代码的“信噪比”。Anders Hejlsberg 还谈到了命令式编程与声明式编程，这是一个类似的概念。无论如何考虑以下代码片段：

从 Java 中的非 UI 线程更新 UI：

```
try {  
    // Run the update code on the Swing thread  
    SwingUtilities.invokeAndWait(() -> {  
        try {
            // Update UI value from the file system data  
            FileUtility f = new FileUtility();  
            uiComponent.setValue(f.readSomething());
        } catch (IOException e) {  
            throw new UncheckedIOException(e);
        }
    });
} catch (InterruptedException ex) {  
    throw new IllegalStateException("Interrupted updating UI", ex);  
} catch (InvocationTargetException ex) {
    throw new IllegalStateException("Invocation target exception updating UI", ex);
} 
```

从 C# 中的非 UI 线程更新 UI：

```
private void UpdateValue()  
{  
   // Ensure the update happens on the UI thread  
   if (InvokeRequired)  
   {  
       Invoke(new MethodInvoker(UpdateValue));  
   }  
   else  
   {  
       // Update UI value from the file system data  
       FileUtility f = new FileUtility();  
       uiComponent.Value = f.ReadSomething();  
   }  
} 
```

这对我来说似乎更清楚。当你开始在 Swing 中做越来越多的 UI 工作时，检查异常开始变得非常烦人和无用。

## 越狱

即使是最基本的实现，例如 Java 的 List 接口，作为契约式设计工具的已检查异常也会失败。考虑一个由数据库或文件系统或任何其他引发检查异常的实现支持的列表。唯一可能的实现是捕获已检查的异常并将其作为未检查的异常重新抛出：

```
@Override
public void clear()  
{  
   try  
   {  
       backingImplementation.clear();  
   }  
   catch (CheckedBackingImplException ex)  
   {  
       throw new IllegalStateException("Error clearing underlying list.", ex);  
   }  
} 
```

现在你不得不问所有这些代码的意义是什么？检查的异常只是增加了噪音，异常已被捕获但未处理，并且合同设计（就检查的异常而言）已经崩溃。

## 结论

*   捕获异常与处理它们不同。
*   检查的异常会给代码增加噪音。
*   没有它们，异常处理在 C# 中运行良好。

[我以前](http://lukequinane.blogspot.com/2009/03/java-exceptions.html)在博客上写过这个。

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2009-03-05T10:34:58.830

Artima[发表了对 .NET 架构师之一 Anders Hejlsberg 的采访](http://www.artima.com/intv/handcuffs.html)，其中敏锐地涵盖了反对检查异常的论点。短暂的品尝者：

> throws 子句，至少它在 Java 中实现的方式，不一定强制您处理异常，但如果您不处理它们，它会强制您准确确认哪些异常可能通过。它要求您要么捕获已声明的异常，要么将它们放入您自己的 throws 子句中。为了解决这个要求，人们会做一些荒谬的事情。例如，他们用“抛出异常”来装饰每个方法。这完全破坏了该功能，并且您只是让程序员编写了更多狼吞虎咽的东西。这对任何人都没有帮助。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2009-03-05T09:07:15.063

我最初同意你的观点，因为我一直支持检查异常，并开始思考为什么我不喜欢在 .Net 中没有检查异常。但后来我意识到我实际上并不喜欢检查异常。

回答你的问题，是的，我喜欢我的程序显示堆栈跟踪，最好是非常丑陋的。我希望应用程序爆炸成一堆你可能想看到的最丑陋的错误消息。

原因是，如果它这样做，我必须修复它，而且我必须立即修复它。我想立即知道有问题。

您实际处理了多少次异常？我不是在谈论捕获异常——我是在谈论处理它们？编写以下内容太容易了：

```
try {
  thirdPartyMethod();
} catch(TPException e) {
  // this should never happen
} 
```

而且我知道您可以说这是不好的做法，并且“答案”是对异常做某事（让我猜猜，记录它？），但是在现实世界（tm）中，大多数程序员只是不这样做它。

所以，是的，如果我不必这样做，我不想捕获异常，并且我希望我的程序在我搞砸时会爆炸。默默地失败是最糟糕的结果。

* * *

## 回答 #9

> 赞同：21
> 
> 时间：2009-03-05T12:56:54.917

[Effective Java Exceptions](http://www.oracle.com/technetwork/articles/entarch/effective-exceptions-092345.html)一文很好地解释了何时使用未检查的异常以及何时使用检查的异常。以下是该文章中的一些引述，以突出要点：

> **偶然性：** 一种预期的条件，要求一种方法的替代响应，可以用方法的预期目的来表达。方法的调用者期望这些条件，并有应对它们的策略。
> 
> **故障：** 阻止方法实现其预期目的的计划外情况，如果不参考方法的内部实现就无法描述。

（所以不允许表格，所以您可能想从[原始页面](http://www.oracle.com/technetwork/articles/entarch/effective-exceptions2-097044.html)阅读以下内容......）

> **应急**
> 
> *   被认为是：设计的一部分
> *   预计会发生：经常但很少发生
> *   谁在乎它：调用方法的上游代码
> *   示例：替代返回模式
> *   最佳映射：检查异常
> 
> **过错**
> 
> *   被认为是：令人讨厌的惊喜
> *   预计会发生：从不
> *   谁在乎：需要解决问题的人
> *   示例：编程错误、硬件故障、配置错误、文件丢失、服务器不可用
> *   最佳映射：未经检查的异常

* * *

## 回答 #10

> 赞同：20
> 
> 时间：2009-03-05T09:40:12.130

在过去三年中，我一直在与几位开发人员合作开发相对复杂的应用程序。我们有一个代码库，它经常使用检查异常并进行适当的错误处理，而其他一些则没有。

到目前为止，我发现使用 Checked Exceptions 更容易使用代码库。当我使用其他人的 API 时，很高兴我可以准确地看到当我调用代码并通过记录、显示或忽略正确处理它们时会出现什么样的错误情况（是的，有忽略的有效案例异常，例如 ClassLoader 实现）。这使我正在编写的代码有机会恢复。我会传播所有运行时异常，直到它们被缓存并使用一些通用错误处理代码进行处理。当我发现一个我真的不想在特定级别处理的检查异常，或者我认为是编程逻辑错误时，我将它包装到 RuntimeException 中并让它冒泡。永远不要在没有充分理由的情况下吞下异常（这样做的充分理由相当稀缺）

当我使用没有检查异常的代码库时，我很难事先知道调用函数时我能期待什么，这可能会严重破坏一些东西。

这当然是一个偏好和开发人员技能的问题。编程和错误处理的两种方式都可以同样有效（或无效），所以我不会说有 The One Way。

总而言之，我发现使用 Checked Exceptions 更容易，特别是在有很多开发人员的大型项目中。

* * *

## 回答 #11

> 赞同：19
> 
> 时间：2009-03-05T10:40:04.107

简而言之：

*异常是一个 API 设计问题。* ——不多也不少。

**检查异常的参数：**

要理解为什么受检异常可能不是好事，让我们转过头来问：受检异常何时或为什么具有吸引力，即为什么您希望编译器强制声明异常？

答案很明显：有时您*需要*捕获异常，而这只有在被调用的代码为您感兴趣的错误提供特定异常类时才有可能。

因此，检查异常的论点**是编译器强制程序员声明哪些异常被抛出，并****希望**程序员随后也会记录特定的异常类和导致它们的错误。

但实际上，一个包经常`com.acme`只抛出一个`AcmeException`而不是特定的子类。然后调用者需要处理、声明或重新发出信号`AcmeExceptions`，但仍不能确定是`AcmeFileNotFoundError`发生了还是`AcmePermissionDeniedError`.

因此，如果您只`AcmeFileNotFoundError`对`AcmeException`.

**那么为什么要打扰呢？**

因此，即使有检查异常，编译器也不能强制程序员抛出**有用**的异常。这仍然只是 API 质量的问题。

因此，没有检查异常的语言通常不会差很多。程序员可能会倾向于抛出一个通用`Error`类的非特定实例而不是一个`AcmeException`.，但如果他们完全关心他们的 API 质量，他们`AcmeFileNotFoundError`终究会学会引入一个。

总的来说，异常的规范和文档与普通方法的规范和文档没有太大区别。这些也是 API 设计问题，如果程序员忘记实现或导出有用的功能，则需要改进 API，以便您可以有效地使用它。

如果您遵循这种推理，很明显，在 Java 等语言中很常见的声明、捕获和重新抛出异常的“麻烦”通常不会增加任何价值。

还值得注意的是，Java VM 没有*检查*异常——只有 Java 编译器检查它们，并且具有更改的异常声明的类文件在运行时是兼容的。Java VM 的安全性并没有通过检查异常提高，只有编码风格。

* * *

## 回答 #12

> 赞同：16
> 
> 时间：2013-05-12T00:49:00.897

## 例外类别

谈到异常时，我总是参考[Eric Lippert 的 Vexing exceptions](https://blogs.msdn.com/b/ericlippert/archive/2008/09/10/vexing-exceptions.aspx)博客文章。他将例外分为以下几类：

*   **致命**的——这些异常*不是你的错*：你无法阻止，也无法明智地处理它们。例如，`OutOfMemoryError`或`ThreadAbortException`。
*   **Boneheaded** - 这些异常*是你的错*：你应该阻止它们，它们代表代码中的错误。例如`ArrayIndexOutOfBoundsException`，`NullPointerException`或任何`IllegalArgumentException`。
*   **烦恼**- 这些异常*不是异常*，不是你的错，你无法阻止它们，但你必须处理它们。它们通常是不幸的设计决策的结果，例如抛出`NumberFormatException`from`Integer.parseInt`而不是提供`Integer.tryParseInt`在解析失败时返回布尔值 false 的方法。
*   **外生**的——这些异常*通常是异常的*，不是你的错，你不能（合理地）阻止它们，但*你必须处理它们*。例如，`FileNotFoundException`。

API 用户：

*   *不得*处理*致命*或*愚蠢*的异常。
*   *应该*处理*令人烦恼*的异常，但它们不应该出现在理想的 API 中。
*   *必须*处理*外生*异常。

## 已检查的异常

*API 用户必须*处理特定异常这一事实是调用者和被调用者之间方法契约的一部分。除其他事项外，合同还指定：被调用者期望的参数的数量和类型、调用者可以期望的返回值类型以及调用者*期望处理的异常*。

由于API 中不应该存在*令人烦恼的异常，因此只有这些**外生*异常必须经过*检查异常*才能成为方法契约的一部分。相对较少的异常是*外生*的，因此任何 API 都应该有相对较少的检查异常。

已检查异常是*必须处理*的异常。处理异常可以像吞下它一样简单。那里！异常被处理。时期。如果开发人员想以这种方式处理它，那很好。但他不能忽视异常，并且已经被警告。

## API 问题

但是任何检查了*令人烦恼*和*致命*异常的 API（例如 JCL）都会给 API 用户带来不必要的压力。此类异常*必须*处理，但要么异常非常普遍以至于它本来就不应该是异常，要么在处理时无能为力。这*导致*Java 开发人员讨厌检查异常。

此外，许多 API 没有适当的异常类层次结构，导致各种非外生异常原因由单个检查异常类（例如`IOException`）表示。这也导致 Java 开发人员讨厌检查异常。

## 结论

*外生*异常是那些不是您的错、无法避免且应该处理的异常。这些构成了可以抛出的所有异常的一小部分。API 应该只**检查*外生*异常**，而未检查所有其他异常。这将制作更好的 API，减轻 API 用户的压力，从而减少捕获所有、吞下或重新抛出未经检查的异常的需要。

所以不要讨厌 Java 和它的检查异常。相反，讨厌过度使用检查异常的 API。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2009-08-07T17:34:53.607

好的......检查的异常并不理想并且有一些警告，但它们确实有目的。创建 API 时，会出现特定的失败案例，这些案例与该 API 的约定有关。在 Java 等强静态类型语言的上下文中，如果不使用检查异常，则必须依靠临时文档和约定来传达错误的可能性。这样做会消除编译器在处理错误方面可能带来的所有好处，并且您完全取决于程序员的善意。

那么，移除 Checked 异常，例如在 C# 中完成的，那么如何以编程和结构方式传达错误的可能性呢？如何通知客户端代码可能会发生这样那样的错误并且必须处理？

在处理受检异常时，我听到了各种各样的恐惧，它们被滥用，这是肯定的，但未经检查的异常也是如此。我说等几年，当 API 堆叠很多层时，你会乞求某种结构化手段的回归来传达失败。

以 API 层底部某处抛出异常并冒泡的情况为例，因为没有人知道甚至可能发生此错误，即使这是一种在调用代码时非常合理的错误扔掉它（例如 FileNotFoundException 而不是 VogonsTrashingEarthExcept... 在这种情况下，我们是否处理它并不重要，因为没有任何东西可以处理它）。

许多人争辩说，无法加载文件几乎总是这个过程的世界末日，它必须死于可怕而痛苦的死亡。所以是的......当然......好吧......你为某事构建一个API并在某个时候加载文件......我作为所述API的用户只能响应......“你到底是谁来决定我的程序应该崩溃！” 当然 考虑到异常被吞噬并且不留痕迹的选择，或者 EletroFlabbingChunkFluxManifoldChuggingException 的堆栈跟踪比 Marianna 沟槽更深，我会毫不犹豫地采用后者，但这是否意味着这是处理异常的理想方式? 难道我们不能在中间的某个地方，每次遍历到一个新的抽象级别时都会重新转换和包装异常，以便它实际上意味着什么？

最后，我看到的大多数论点是“我不想处理异常，很多人不想处理异常。受检异常迫使我处理它们，因此我讨厌受检异常” 完全消除这种机制并将其降级为goto hell的鸿沟只是愚蠢的，缺乏判断力和远见。

如果我们消除检查异常，我们还可以消除函数的返回类型并始终返回一个“anytype”变量......这会让生活变得如此简单，不是吗？

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2016-04-14T15:09:10.110

这不是反对检查异常的纯粹概念的论据，但 Java 用于它们的类层次结构是一个畸形秀。我们总是将事物简单地称为“异常”——这是正确的，因为语言规范[也这么称呼它们](https://docs.oracle.com/javase/specs/jls/se8/html/jls-11.html)——但是异常在类型系统中是如何命名和表示的呢？

由[`Exception`](https://docs.oracle.com/javase/8/docs/api/java/lang/Exception.html)一个想象的类？不，因为`Exception`s 是异常，同样异常也是`Exception`s，除了那些***不是*** `Exception`s 的异常，因为其他异常实际上是[`Error`](https://docs.oracle.com/javase/8/docs/api/java/lang/Error.html)s，这是另一种异常，一种永远不应该发生的额外异常异常，除非当它发生时，你不应该抓住它，除非有时你必须这样做。除了这还不是全部，因为您还可以定义其他既不是`Exception`s 也不`Error`是 s 而仅仅是异常的[`Throwable`](https://docs.oracle.com/javase/8/docs/api/java/lang/Throwable.html)异常。

其中哪些是“已检查”异常？`Throwable`s 是检查异常，除非它们也是`Error`s，它们是未检查异常，然后是`Exception`s，它们也是`Throwable`s 并且是检查异常的主要类型，除了也有一个例外，那就是如果它们也是[`RuntimeException`](https://docs.oracle.com/javase/8/docs/api/java/lang/RuntimeException.html)s，因为那是另一种未经检查的异常。

s 是干什么`RuntimeException`用的？就像名字所暗示的那样，它们是异常，就像所有`Exception`s 一样，它们发生在运行时，实际上就像所有异常一样，除了`RuntimeException`s 与其他运行时 s 相比是异常的，`Exception`因为它们不应该发生，除非当你犯了一些愚蠢的错误时，虽然`RuntimeException`s 从来都不`Error`是 s，所以它们是针对那些非常错误但实际上不是`Error`s 的东西。除了[`RuntimeErrorException`](https://docs.oracle.com/javase/8/docs/api/javax/management/RuntimeErrorException.html), 这确实是一个`RuntimeException`for `Error`s。但是，不是所有的例外都应该代表错误的情况吗？是的，所有这些。除了[`ThreadDeath`](https://docs.oracle.com/javase/8/docs/api/java/lang/ThreadDeath.html)，一个非常普通的例外，因为文档解释说这是一个“正常事件”，并且那个'`Error`

无论如何，由于我们将所有异常划分为`Error`s（用于异常执行异常，因此未检查）和`Exception`s（用于较少异常执行错误，因此检查，除非它们不是），我们现在需要两个不同种类的几种例外。所以我们需要[`IllegalAccessError`](https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalAccessError.html)和[`IllegalAccessException`](https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalAccessException.html), 和[`InstantiationError`](https://docs.oracle.com/javase/8/docs/api/java/lang/InstantiationError.html),[`InstantiationException`](https://docs.oracle.com/javase/8/docs/api/java/lang/InstantiationException.html)和,[`NoSuchFieldError`](https://docs.oracle.com/javase/8/docs/api/java/lang/NoSuchFieldError.html)和[`NoSuchFieldException`](https://docs.oracle.com/javase/8/docs/api/java/lang/NoSuchFieldException.html),[`NoSuchMethodError`](https://docs.oracle.com/javase/8/docs/api/java/lang/NoSuchMethodError.html)和[`NoSuchMethodException`](https://docs.oracle.com/javase/8/docs/api/java/lang/NoSuchMethodException.html),[`ZipError`](https://docs.oracle.com/javase/8/docs/api/java/util/zip/ZipError.html)和[`ZipException`](https://docs.oracle.com/javase/8/docs/api/java/util/zip/ZipException.html).

除了即使检查了异常，也总是有（相当简单的）方法可以欺骗编译器并在不检查的情况下将其抛出。如果你这样做，你可能会得到一个[`UndeclaredThrowableException`](https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/UndeclaredThrowableException.html)，除非在其他情况下，它可能抛出一个[`UnexpectedException`](https://docs.oracle.com/javase/8/docs/api/java/rmi/UnexpectedException.html)，或一个[`UnknownException`](https://docs.oracle.com/javase/8/docs/api/org/omg/CORBA/portable/UnknownException.html)（与 无关[`UnknownError`](https://docs.oracle.com/javase/8/docs/api/java/lang/UnknownError.html)，仅用于“严重异常”），或一个[`ExecutionException`](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutionException.html)，或一个[`InvocationTargetException`](https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/InvocationTargetException.html)，或一个[`ExceptionInInitializerError`](https://docs.oracle.com/javase/8/docs/api/java/lang/ExceptionInInitializerError.html)。

哦，我们不能忘记 Java 8 的时髦 new [`UncheckedIOException`](https://docs.oracle.com/javase/8/docs/api/java/io/UncheckedIOException.html)，这是一个`RuntimeException`异常，旨在让您通过包装由 I/O 错误引起的已检查[`IOException`](https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html)异常（不会导致[`IOError`](https://docs.oracle.com/javase/8/docs/api/java/io/IOError.html)异常，尽管存在太）这非常难以处理，因此您需要不检查它们。

谢谢爪哇！

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2009-03-05T12:23:02.440

事实上，检查异常一方面增加了程序的健壮性和正确性（您被迫对接口进行正确的声明——方法抛出的异常基本上是一种特殊的返回类型）。另一方面，您面临的问题是，由于异常“冒泡”，因此当您更改异常时，您通常需要更改大量方法（所有调用者，以及调用者的调用者等）方法抛出。

Java 中的检查异常并不能解决后一个问题；C# 和 VB.NET 把婴儿和洗澡水一起扔掉。

[这篇 OOPSLA 2005 论文](https://dl.acm.org/citation.cfm?id=1094847)（或[相关技术报告](http://www.cs.kuleuven.be/publicaties/rapporten/cw/CW407.pdf)）中描述了一种采取中间道路的好方法。

简而言之，它允许您说：`method g(x) throws like f(x)`，这意味着 g 抛出所有异常 f 抛出。瞧，检查了没有级联更改问题的异常。

尽管这是一篇学术论文，但我鼓励您阅读（部分）它，因为它很好地解释了检查异常的好处和坏处。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2011-12-31T09:48:25.957

[这篇文章](http://articles.vconst.com/2009/08/error-handling-and-exceptions-in-java.html)是我读过的关于 Java 异常处理的最好的一篇文章。

它支持未经检查的异常而不是检查的异常，但这种选择被非常彻底地解释并基于强有力的论据。

我不想在这里引用太多的文章内容（最好将其作为一个整体来阅读），但它涵盖了来自该线程的 unchecked exceptions 倡导者的大部分论点。特别是这个论点（这似乎很流行）被涵盖：

> 以 API 层底部某处抛出异常并冒泡的情况为例，因为没有人知道甚至可能发生此错误，尽管这是一种在调用代码时非常合理的错误扔掉它（例如 FileNotFoundException 而不是 VogonsTrashingEarthExcept... 在这种情况下，我们是否处理它并不重要，因为没有任何东西可以处理它）。

作者“回应”：

> 假设不应捕获所有运行时异常并允许传播到应用程序的“顶部”，这是绝对错误的。(...) 对于每个需要明确处理的异常情况 - 由系统/业务需求 - 程序员必须决定在哪里捕获它以及一旦捕获到该条件该做什么。这必须严格根据应用程序的实际需求来完成，而不是基于编译器警报。必须允许所有其他错误自由传播到将记录它们的最顶层处理程序，并且将采取优雅（可能是终止）操作。

主要思想或文章是：

> 当谈到软件中的错误处理时，唯一安全和正确的假设是，绝对存在的每个子程序或模块都可能发生故障！

因此，如果“*没有人知道甚至可能发生此错误*”，那么该项目就有问题。正如作者所建议的那样，此类异常应至少由最通用的异常处理程序（例如，处理所有未由更具体处理程序处理的异常的处理程序）处理。

可悲的是，似乎没有多少人发现这篇很棒的文章:-(。我衷心建议所有犹豫哪种方法更好的人花点时间阅读它。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2011-10-28T22:01:38.120

## 问题

我看到的异常处理机制最糟糕的问题是**它大规模地引入了代码重复**！老实说：在大多数项目中，95% 的时间里，开发人员真正需要做的就是以某种方式将异常传达给用户（在某些情况下，也传达给开发团队，例如通过发送一个 e -带有堆栈跟踪的邮件）。因此，通常在处理异常的每个地方都使用相同的代码行/代码块。

假设我们在每个 catch 块中对某种类型的检查异常进行简单的日志记录：

```
try{
   methodDeclaringCheckedException();
}catch(CheckedException e){
   logger.error(e);
} 
```

如果这是一个常见的例外，在更大的代码库中甚至可能有数百个这样的 try-catch 块。现在让我们假设我们需要引入基于弹出对话框的异常处理而不是控制台日志记录，或者开始另外向开发团队发送电子邮件。

等一下……我们真的要编辑代码中的数百个位置吗？！你明白我的意思:-)。

## 解决方案

我们为解决该问题所做的工作是引入*异常处理程序*（我将进一步称为 EH）的概念来*集中*异常处理。对于每个需要处理异常的类，我们的[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)框架都会注入一个异常处理程序的实例。所以异常处理的典型模式现在看起来像这样：

```
try{
    methodDeclaringCheckedException();
}catch(CheckedException e){
    exceptionHandler.handleError(e);
} 
```

现在要自定义我们的异常处理，我们只需要在一个地方更改代码（EH 代码）。

当然，对于更复杂的情况，我们可以实现 EH 的几个子类并利用 DI 框架提供给我们的特性。通过更改我们的 DI 框架配置，我们可以轻松地全局切换 EH 实现或将 EH 的特定实现提供给具有特殊异常处理需求的类（例如使用 Guice @Named 注释）。

这样，我们可以毫不费力地区分开发和发布版本的应用程序中的异常处理行为（例如，开发 - 记录错误并暂停应用程序，生产 - 记录错误并提供更多详细信息并让应用程序继续执行）。

## 最后一件事

最后但并非最不重要的一点是，似乎只需将我们的异常“向上”传递，直到它们到达某个顶级异常处理类，就可以获得相同类型的集中化。但这会导致我们的方法的代码和签名混乱，并引入该线程中其他人提到的维护问题。

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2017-10-09T14:39:08.790

没有人提到的一件重要的事情是它如何干扰接口和 lambda 表达式。

假设您定义一个`MyAppException extends Exception`. 它是您的应用程序抛出的所有异常所继承的顶级异常。在某些地方您不想对特定异常做出反应，您希望调用者解决它，因此您声明`throws MyAppException`.

在您想使用其他人的界面之前，一切看起来都很好。显然他们没有声明要 throw 的意图`MyAppException`，因此编译器甚至不允许您调用在其中声明的方法`throws MyAppException`。这是特别痛苦的`java.util.function`。

但是，如果您的异常 extends `RuntimeException`，接口将没有问题。如果您愿意，可以在 JavaDoc 中提及异常。但除此之外，它只是默默地冒出任何东西。当然，这意味着它可以终止您的应用程序。但是在许多企业软件中，您都有异常处理层，未经检查的异常可以节省很多麻烦。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2009-05-17T20:15:40.570

正如人们已经说过的那样，Java 字节码中不存在已检查的异常。它们只是一种编译器机制，与其他语法检查不同。我看到检查异常很像我看到编译器抱怨冗余条件：`if(true) { a; } b;`。这很有帮助，但我可能是故意这样做的，所以让我忽略你的警告。

事实是，如果你强制执行检查异常，你将无法强迫每个程序员“做正确的事情”，而现在其他所有人都是附带损害，他们只是因为你制定的规则而讨厌你。

修复那里的不良程序！不要试图修复语言以不允许它们！对于大多数人来说，“对异常做一些事情”实际上只是告诉用户它。我也可以告诉用户一个未经检查的异常，所以不要让你的检查异常类离开我的 API。

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2012-07-04T13:21:47.477

要尝试仅解决未回答的问题：

> 如果你抛出 RuntimeException 子类而不是 Exception 子类，那么你怎么知道你应该捕获什么？

这个问题包含似是而非的推理恕我直言。仅仅因为 API 告诉您它抛出了什么并不意味着您在所有情况下都以相同的方式处理它。换句话说，您需要捕获的异常取决于您使用引发异常的组件的上下文。

例如：

如果我正在为数据库编写连接测试器，或者要检查用户输入 XPath 的有效性，那么我可能想要捕获并报告操作引发的所有已检查和未检查的异常。

但是，如果我正在编写一个处理引擎，我可能会以与 NPE 相同的方式处理 XPathException（已检查）：我会让它运行到工作线程的顶部，跳过该批处理的其余部分，记录问题（或将其发送给支持部门进行诊断）并留下反馈以供用户联系支持。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2009-03-05T10:02:53.790

Anders 在软件工程广播的[第 97 集中](http://www.se-radio.net/podcast/2008-05/episode-97-interview-anders-hejlsberg)谈到了检查异常的陷阱以及他为什么将它们排除在 C# 之外。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2009-11-07T20:34:38.873

我在 c2.com 上的文章与原来的形式基本保持不变：[CheckedExceptionsAreIncompatibleWithVisitorPattern](http://c2.com/cgi/wiki?CheckedExceptionsAreIncompatibleWithVisitorPattern)

总之：

访问者模式及其亲属是一类接口，其中间接调用者和接口实现都知道异常，但接口和直接调用者形成一个不知道的库。

CheckedExceptions 的基本假设是所有声明的异常都可以从调用具有该声明的方法的任何点抛出。VisitorPattern 揭示了这个假设是错误的。

在这种情况下，检查异常的最终结果是大量原本无用的代码，它们基本上在运行时删除了编译器的检查异常约束。

至于根本问题：

我的一般想法是顶级处理程序需要解释异常并显示适当的错误消息。我几乎总是看到 IO 异常、通信异常（出于某种原因 API 区分）或任务致命错误（程序错误或后备服务器上的严重问题），所以如果我们允许堆栈跟踪严重的问题，这应该不会太难服务器问题。

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2014-06-02T03:34:41.560

Checked exceptions 的原始形式是尝试处理意外事件而不是失败。值得称赞的目标是突出特定的可预测点（无法连接、找不到文件等）并确保开发人员处理了这些问题。

原始概念中从未包含的内容是强制宣布大量系统性和不可恢复的故障。这些失败永远不会正确地被声明为检查异常。

代码中通常可能出现故障，并且 EJB、Web 和 Swing/AWT 容器已经通过提供最外层的“失败请求”异常处理程序来满足这一点。最基本的正确策略是回滚事务并返回错误。

一个关键点是**运行时和检查的异常在功能上是等效的。**没有检查异常可以做的处理或恢复，运行时异常不能。

反对“已检查”异常的最大论据是大多数异常无法修复。简单的事实是，我们不拥有损坏的代码/子系统。我们看不到实现，我们不对它负责，也无法修复它。

如果我们的应用程序不是数据库......我们不应该尝试修复数据库。那将违反 *封装原则*。

特别成问题的是 JDBC (SQLException) 和 RMI for EJB (RemoteException) 领域。不是根据最初的“检查异常”概念来识别可修复的意外事件，而是将这些强制普遍存在的、实际上不可修复的系统可靠性问题广泛声明。

Java 设计中的另一个严重缺陷是异常处理应该正确地置于最高可能的“业务”或“请求”级别。这里的原则是“早扔，晚赶”。已检查的异常几乎没有什么作用，但会阻碍这一点。

我们在 Java 中有一个明显的问题，即需要数千个什么都不做的 try-catch 块，其中很大一部分 (40%+) 被错误编码。这些几乎都没有实现任何真正的处理或可靠性，但会带来很大的编码开销。

最后，“检查异常”与 FP 函数式编程几乎不兼容。

他们坚持“立即处理”与“赶上”异常处理最佳实践以及任何抽象循环/或控制流的 FP 结构都不一致。

许多人谈论“处理”检查的异常，但他们是在谈论他们的帽子。在失败后继续使用空、不完整或不正确的数据来*假装*成功是不处理任何事情。这是最低形式的工程/可靠性弊端。

彻底失败是处理异常的最基本的正确策略。回滚事务、记录错误并向用户报告“失败”响应是合理的做法——最重要的是，防止将不正确的业务数据提交到数据库。

其他异常处理策略是在业务、子系统或请求级别的“重试”、“重新连接”或“跳过”。所有这些都是通用的可靠性策略，并且在运行时异常下工作得很好/更好。

最后，失败比使用不正确的数据运行要好得多。继续会导致次要错误，远离原始原因并且更难调试；或者最终会导致错误的数据被提交。人们因此而被解雇。

请参阅：
- [http://literatejava.com/exceptions/checked-exceptions-javas-biggest-mistake/](http://literatejava.com/exceptions/checked-exceptions-javas-biggest-mistake/)

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2009-03-05T10:00:40.083

我认为这是一个很好的问题，完全没有争论。我认为第 3 方库应该（通常）抛出*未经检查*的异常。这意味着您可以隔离您对库的依赖（即您不必重新抛出它们的异常或抛出`Exception`- 通常是不好的做法）。Spring 的[DAO 层](http://static.springframework.org/spring/docs/2.0.x/reference/jdbc.html)就是一个很好的例子。

另一方面，来自核心 Java API 的异常通常应该检查它们是否**可以**被处理。拿`FileNotFoundException`或（我最喜欢的）`InterruptedException`。这些条件*几乎总是*应该专门处理（即您对 an 的反应`InterruptedException`与您对 an 的反应不同`IllegalArgumentException`）。检查您的异常这一事实迫使开发人员考虑条件是否可以处理。（也就是说，我很少看到`InterruptedException`处理得当！）

还有一件事 - a`RuntimeException`并不总是“开发人员出错的地方”。当您尝试创建`enum`using`valueOf`并且没有`enum`该名称时，将引发非法参数异常。这不一定是开发人员的错误！

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2009-03-05T17:14:42.893

已检查异常的一个问题是，即使该接口的一个实现使用它，异常也经常附加到接口的方法上。

检查异常的另一个问题是它们容易被滥用。[`java.sql.Connection`](http://java.sun.com/javase/6/docs/api/java/sql/Connection.html)完美的例子就是 in[`close()`](http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#close())方法。[`SQLException`](http://java.sun.com/javase/6/docs/api/java/sql/SQLException.html)即使您已经**明确声明**您已完成连接，它也会抛出。close() 可能传达您关心的哪些信息？

通常，当我 close() 一个连接`*`时，它看起来像这样：

```
try {
    conn.close();
} catch (SQLException ex) {
    // Do nothing
} 
```

另外，不要让我开始使用各种解析方法和 NumberFormatException ...... .NET 的 TryParse，它不会抛出异常，使用起来非常容易，不得不回到 Java 是很痛苦的（我们同时使用 Java 和C# 我工作的地方）。

`*`作为补充说明，PooledConnection 的 Connection.close() 甚至不会*关闭*连接，但您仍然必须捕获 SQLException，因为它是一个已检查的异常。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2015-07-16T02:03:04.120

程序员需要知道方法可能抛出的**所有**异常，才能正确使用它。所以，仅仅用一些例外来击败他并不一定能帮助粗心的程序员避免错误。

繁重的成本超过了微薄的好处（尤其是在较大、不太灵活的代码库中，不断修改接口签名是不切实际的）。

静态分析可能很好，但真正可靠的静态分析通常不灵活地要求程序员进行严格的工作。有一个成本效益计算，并且需要将标准设置为高，以进行导致编译时错误的检查。如果 IDE 承担传达方法可能抛出哪些异常（包括哪些是不可避免的）的角色，将会更有帮助。尽管如果没有强制异常声明它可能不会那么可靠，但大多数异常仍然会在文档中声明，并且 IDE 警告的可靠性并不那么重要。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2013-05-10T15:16:43.017

不需要 Checked Exception 的好证明是：

1.  很多框架都为 Java 工作。像 Spring 将 JDBC 异常包装成未经检查的异常，将消息抛出到日志
2.  java之后出现的许多语言，甚至在java平台上也是如此——他们不使用它们
3.  检查异常，它是关于客户端如何使用引发异常的代码的一种预测。但是编写此代码的开发人员永远不会知道代码客户端正在使用的系统和业务。例如，强制抛出已检查异常的接口方法。系统上有 100 个实现，50 个甚至 90 个实现都不会抛出这个异常，但是如果用户引用该接口，客户端仍然必须捕获这个异常。那些 50 或 90 个实现倾向于在它们自己内部处理这些异常，将异常放入日志（这对它们来说是很好的行为）。我们应该怎么做？我最好有一些背景逻辑来完成所有这些工作 - 将消息发送到日志。如果我，作为代码的客户，会觉得我需要处理异常 - 我会这样做。
4.  另一个例子，当我在 java 中使用 I/O 时，如果文件不存在，它会强制我检查所有异常？我该怎么办？如果不存在，系统将不会进行下一步。此方法的客户端不会从该文件中获得预期的内容 - 他可以处理运行时异常，否则我应该首先检查检查异常，将消息写入日志，然后从方法中抛出异常。不...不 - 我最好使用 RuntimeEception 自动执行它，它会自动亮起。手动处理它没有任何意义 - 我很高兴在日志中看到一条错误消息（AOP 可以帮助解决这个问题.. 修复 java 的东西）。如果最终我认为系统应该向最终用户显示弹出消息 - 我会显示它，这不是问题。

如果在使用核心库（如 I/O）时，java 可以让我**选择使用什么，我会很高兴。**Like 提供了两个相同类的副本——一个用 RuntimeEception 包装。**然后我们可以比较人们会使用什么**。不过，就目前而言，许多人最好选择基于 java 或其他语言的一些框架。像 Scala、JRuby 什么的。许多人只是相信 SUN 是对的。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2012-08-02T16:54:02.687

我们已经看到了一些对 C# 首席架构师的引用。

以下是 Java 专家关于何时使用检查异常的另一种观点。他承认其他人提到的许多负面影响： [有效的例外](http://www.oracle.com/technetwork/articles/entarch/effective-exceptions2-097044.html)

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2011-08-23T06:52:43.977

尽管阅读了整页，我仍然找不到一个合理的反对检查异常的论据。大多数人都在谈论糟糕的 API 设计，无论是在某些 Java 类中还是在他们自己的类中。

此功能可能令人讨厌的唯一情况是原型设计。这可以通过向语言添加一些机制来解决（例如，一些@supresscheckedexceptions 注释）。但是对于常规编程，我认为检查异常是一件好事。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-03-05T09:12:51.040

[这](http://www.joelonsoftware.com/items/2003/10/13.html)是反对检查异常的一个论点（来自 joelonsoftware.com）：

> 原因是我认为异常并不比“goto”更好，自 1960 年代以来就被认为是有害的，因为它们会造成从一个代码点到另一个代码点的突然跳转。事实上，它们比 goto 的要差得多：
> 
> *   它们在源代码中是不可见的。查看一段代码，包括可能引发或不引发异常的函数，无法查看可能引发哪些异常以及从何处引发。这意味着即使仔细的代码检查也不会发现潜在的错误。
> *   它们为函数创建了太多可能的退出点。要编写正确的代码，你真的必须考虑通过你的函数的每一个可能的代码路径。每次调用可能引发异常但没有立即捕获的函数时，都会为突然终止的函数、使数据处于不一致状态或其他代码路径导致的意外错误创造机会想一想。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2009-05-18T03:36:06.293

我已经阅读了很多关于异常处理的内容，即使（大部分时间）我真的不能说我对检查异常的存在感到高兴或难过这是我的看法：低级代码中的检查异常（IO，网络、操作系统等）和高级 API/应用程序级别中的未经检查的异常。

即使它们之间没有那么容易划清界限，我发现在同一屋檐下集成多个 API / 库而不总是包装大量检查异常确实很烦人/很难，但另一方面，有时它被迫捕获一些异常并提供在当前上下文中更有意义的不同异常是有用/更好的。

我正在做的项目需要大量的库并将它们集成在同一个 API 下，API 完全基于未检查的异常。这个框架提供了一个高级 API，它在开始时充满了已检查的异常，只有几个未检查的异常异常（初始化异常，配置异常等），我必须说不是很*友好*。大多数时候，您必须捕获或重新抛出您不知道如何处理的异常，或者您甚至不关心（不要与您应该忽略异常混淆），尤其是在客户端click 可能会引发 10 个可能的（已检查）异常。

当前版本（第 3 个）仅使用未经检查的异常，并且它有一个全局异常处理程序，负责处理任何未捕获的内容。API 提供了一种注册异常处理程序的方法，该处理程序将决定是否将异常视为错误（大多数情况下是这种情况），这意味着记录并通知某人，或者它可能意味着其他东西——比如这个异常，AbortException，这意味着中断当前的执行线程并且不记录任何错误，因为不希望这样做。当然，为了解决所有自定义线程必须使用 try {...} catch(all) 处理 run() 方法。

公共无效运行（）{

```
try {
     ... do something ...
} catch (Throwable throwable) {
     ApplicationContext.getExceptionService().handleException("Handle this exception", throwable);
} 
```

}

如果您使用 WorkerService 来安排作业（Runnable、Callable、Worker），这不是必需的，它会为您处理所有事情。

当然，这只是我的意见，可能不是正确的，但对我来说这似乎是一个好方法。我会在我发布项目后看到，如果我认为它对我有好处，对其他人也有好处...... :)

* * *

## 回答 #32

> 赞同：-2
> 
> 时间：2013-08-22T22:11:25.263

在我看来，检查异常是一个非常好的概念。不幸的是，与我们一起工作的大多数程序员都有另一种意见，因此项目有很多错误使用的异常处理。我已经看到大多数程序员创建一个（只有一个）异常类，即 RuntimeException 的子类。其中包含一条消息，有时是多语言键。我没有机会反对这一点。当我向他们解释什么是反模式，什么是方法的契约时，我的印象是我在对着墙说话......我有点失望。

但是今天很明显，对所有事物都有一个通用的运行时异常的概念是一种反模式。他们用它来检查用户输入。抛出异常，以便用户对话可以从中生成错误消息。但并不是每个方法的调用者都是对话！通过抛出运行时异常，方法的契约被更改但没有被声明，因为它不是一个检查异常。

希望他们今天学到了一些东西，并将在另一个地方进行检查（这是有用和必要的）。仅使用受检异常无法解决问题，但受检异常会向程序员发出信号，表明他实现了错误。

# flash - TextField 得到 FocusEvent type="focusIn" 即使它不是真的

> ID：613956
> 
> 赞同：2
> 
> 时间：2009-03-05T08:22:23.423
> 
> 标签：flash, actionscript-3, flex3

似乎我的 TextField() 得到“FocusEvent type=focusIn”，即使没有真正的键盘焦点（光标不闪烁）
我正在调用“stage.focus = mytextfield;” 在主构造函数中，它似乎导致它：

但是，整个 Flash 应用程序中还没有焦点，除非我单击 Flash 区域，否则会在焦点保持在网页上时出现 focusIN 事件。

我如何知道 textfield() 何时收到真正的键盘焦点，例如光标何时开始闪烁？它是另一种事件类型吗？任何解决方法？

我需要知道 FOCUS 何时收到 OK。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T13:43:19.903

您还需要倾听整个应用程序的焦点：

```
addEventListener(Event.ACTIVATE, handleActivate); 
```

当你失去焦点时：

```
addEventListener(Event.DEACTIVATE, handleDeactivate); 
```

# ajax - grails中的远程文件上传

> ID：613958
> 
> 赞同：6
> 
> 时间：2009-03-05T08:22:45.763
> 
> 标签：ajax, grails, frameworks, asyncfileupload

我正在使用使用大量 ajax 的 grails 创建一个 web 应用程序。我想使用 ajax 实现文件上传。我不知道如何使用 ajax 进行文件上传。我的示例 GSP 代码是：

```
<!-- code for file upload form-->
<div id="updateArea">

</div> 
```

我试过了。上传后我想用结果更新“updateArea”。结果我打算显示上传文件的详细信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T09:06:18.247

通过 Ajax 上传文件是不可能的。您仍然可以使用隐藏的 iframe 在后台上传文件并评估响应（然后在 iframe 内）或在上传完成后触发另一个 ajax 调用。

```
<g:form name="upload-form" action="upload" method="post" enctype="multipart/form-data" target="hidden-upload-frame">
    File: <input type="file" name="myFile" />
    <button type="submit">Upload</button>
</g:form>

<iframe id="hidden-upload-frame" name="hidden-upload-frame" style="display: none" onload="onUploadComplete">
</iframe>

<script type="text/javascript">
    function onUploadComplete(e) {
        // Handle upload complete
        alert("upload complete");
        // Evaluate iframe content or fire another ajax call to get the details for the previously uploaded file
    }
</script> 
```

另一种选择是使用基于 Flash 的上传机制（例如[swfupload](http://swfupload.org/)）而不是 iframe。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-21T00:28:19.747

[http://grails.org/plugin/ajax-uploader](http://grails.org/plugin/ajax-uploader)

# security - JSONP 可以安全使用吗？

> ID：613962
> 
> 赞同：70
> 
> 时间：2009-03-05T08:24:57.397
> 
> 标签：security, json, jsonp

使用 JSONP 时是否需要考虑任何安全问题？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-03-05T08:46:37.080

**更新**：JSONP 是执行跨域请求的常见技巧。现代浏览器现在有跨域资源共享，IE8+ 有类似的 XDomainRequest。有关详细信息，请参阅[http://enable-cors.org/](http://enable-cors.org/)。

JSONP 只是一个脚本包含，允许您使用回调。但是，您应该注意[Cross-site request forgery (CSRF)](http://www.squarefree.com/securitytips/web-developers.html#CSRF)。

只要您控制脚本和服务器，JSONP 就不再比脚本包含不安全。除非您有一个 JSONP 服务将敏感数据返回给登录用户。恶意站点可以向服务发送请求（希望用户登录到您的站点），然后检索数据。该服务可以检查请求的引用者，但可以使用 flash 来欺骗引用者（感谢 Chris Moschini）。

想象一下这个情景： - 用户登录到他的网上银行账户。在用户浏览器中存储会话 cookie。该站点有一个 jsonp 服务，其中包含有关用户及其帐户的敏感信息。- 其他站点不会知道用户已登录，但他们可以大胆猜测并尝试访问 jsonp 服务。由于用户有一个会话 cookie，浏览器会得到响应，并且没有什么可以阻止站点进行 ajax 发布以将敏感数据保存在其服务器上。

**2012 年 6 月 28 日更新**：如果您想防止 CSRF 攻击，您应该阅读安全专家的这篇深入博客文章：[http ://erlend.oftedal.no/blog/?blogid=130](http://erlend.oftedal.no/blog/?blogid=130)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-09-08T05:32:02.983

是的，您需要小心，但是当与受信任的服务一起使用时，它是相对安全的。

据我了解，以下是 JSONP 安全问题的摘要：

从消费者的角度来看：

*   您必须信任提供程序不会返回恶意 JavaScript，而不是返回您指定的 JSONP 回调中包装的预期 JSON。
*   任何第三方 JavaScript 嵌入式附加组件也是如此，例如 Google Analytics。
*   它与 XSS 攻击的唯一相似之处在于它允许第 3 方在您的应用程序中执行任意 JavaScript，但是，您必须首先通过发出请求来选择信任第 3 方。

从供应商的角度来看：

*   即使请求中存在客户的 cookie，您也不得假设消费者是您控制的网页。根据授权 URL 的白名单检查 Referer 标头，和/或不要依赖基于 cookie 的身份验证。
*   类似于 CSRF / 混淆代理攻击。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-03-27T03:28:09.950

双方都有安全问题。最严重的是包括 JSONP 在内的网站。

如果您包含来自另一个域（您无法控制）的 a，则该域可以随时更改脚本。他们可以使 javascript 在您的网页上下文中执行任何您自己的 javascript 可以执行的操作。如果您使用 JSONP，则无法解决此问题。您应该研究使用 iframe 的跨域通信，这最好由优秀的 EasyDXM 库完成。

如果您提供处理 JSONP 的 Web 服务，则必须防止跨站点请求伪造 (CSRF)。这是您的网络服务向登录用户返回敏感信息的地方。如果用户已登录您的站点，则任何其他站点都可以向 JSONP 服务生成 GET 请求，并且您的域的 cookie 会随请求一起提交——本质上是对登录用户进行身份验证——除了现在，远程域获得响应并能够读取敏感数据！

防止 CSRF 的最佳方法是生成一个随机数（一个难以猜测的随机生成的数字）并将其存储在会话中。在您网页上的所有表单中输出此 nonce，并将其包含在您网页上的所有 JSONP 请求中。在服务器上，确保请求中的 nonce 存在且正确（无论是 GET、POST 等）。其他域将无法猜测此 nonce，因此无法获取敏感信息，尽管有 cookie被发送。

最后，还有另一种安全问题：JSONP 根本不支持浏览器中的用户身份验证，而 OAuth 则可以。当然，您可以让服务器获取某种访问令牌（例如使用 OAuth）并使用它。但是，如果您想完全在浏览器中进行身份验证，则必须使用 iFrame 进行跨域通信。我认为这就是 OAuth 2.0 的做法。以下是您的设置方式：您网站上托管的页面可以完全访问您的服务器。拥有一个加载 EasyDXM 并使用它为您的网站设置隐藏 iframe 的 javascript 库，并使用它与之交谈。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-06-16T12:23:58.793

JSONP 绝对不安全，因为它只是将跨域的任何东西作为 JavaScript 运行。

**解决方案！解决方案！**

创建一个 iframe，最好是一个沙盒，并在那里加载 JSONP。捕获结果并通过`window.postMessage`

是的，像往常一样，有人首先想到了这个想法:)

博客文章不再存在，但我将链接保留在此处以获取信用： [http](http://beebole.com/blog/general/sandbox-your-cross-domain-jsonp-to-improve-mashup-security/)
://beebole.com/blog/general/sandbox-your-cross-domain-jsonp-to-improve-mashup-security/ 编辑:[回程机链接](http://web.archive.org/web/20120219001631/http://beebole.com:80/blog/general/sandbox-your-cross-domain-jsonp-to-improve-mashup-security)

它使用 window.name hack 进行 iframe 通信，但那是针对 IE6 和 7 的。

# vb.net - 如何在文本框中只允许一个小数点？

> ID：613963
> 
> 赞同：1
> 
> 时间：2009-03-05T08:25:44.023
> 
> 标签：vb.net, textbox

下面是 C# 中的代码，它允许文本框中只有一个小数点：

```
if textbox5.text.contains(".") && e.keychar="."
{
e.handled=true
} 
```

我必须在 VB.NET 2003 版本中使用它，但我不能使用 contains 属性。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T08:29:29.663

改用这个`Text.IndexOf(".")`方法怎么样？如果它返回 >=0，那么你已经有了一个小数点。

```
If (textbox5.Text.IndexOf(".") >= 0 And e.KeyChar = ".") Then e.Handled = True 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-04T09:07:40.603

不要忘记用户的区域设置和数字格式。我相信使用句点（'.'）作为十进制字符在世界范围内是少数。您可以使用`CurrentUICulture`'`NumberFormat`字段来帮助您以最正确的方式进行解析。尝试使用：

```
decimal d;
bool isValidInput = decimal.TryParse(
    textBox1.Text,
    System.Globalization.NumberStyles.AllowDecimalPoint,
    System.Globalization.CultureInfo.CurrentUICulture.NumberFormat,
    out d); 
```

这将验证是否正确输入了数字。使用其他`NumberStyles`标志，您可以控制要允许的数字类型，例如千位分隔符。

*对不起这里的 C#。不过，VB.NET 应该很容易适应这一点；也许某个善良的灵魂可以编辑它。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2012-10-04T05:40:14.640

```
package Utility
{

    import flash.events.Event;

    import flashx.textLayout.operations.PasteOperation;

    import spark.components.TextInput;
    import spark.events.TextOperationEvent;

    /**
     * This is a text input component that can only input numbers.
     * A number means a real number.
     * @author Cheng Liang
     * @version 0.0.1
     */
    public class NumberInput extends TextInput
    {

        [Bindable("numberChange")]
        /**
         * Sets number as input value.
         */
        public function set number(value : Number) : void
        {
            var s : String = value.toString();
            if(text != s) {
                text = s;
                dispatchEvent(new Event("numberChange"));
            }
        }

        public function get number() : Number
        {
            return Number(text);
        }

        public function NumberInput()
        {
            super();
            this.addEventListener(TextOperationEvent.CHANGE, onTextChange);
        }

        protected function onTextChange(event : TextOperationEvent) : void
        {

            if (event.operation is PasteOperation)
            {
                TextInput(event.currentTarget).text='';
            }

            if(text == "" || text.length == 1) {
                return;
            }

            /* To allow single (.) */
            var idx : int = text.indexOf(".", 0);
            if(idx >= 0) {
                text = text.substring(0, idx + 1) + text.substring(idx + 1).replace(".", "");
            }

            /* To allow single (-) only at the 1st position*/
            if(text.lastIndexOf("-")==0)
                text ='-'+ text.substring(1);
            else if(text.lastIndexOf("-")>0)
            {
                if(text.charAt(0)=='-')
                    text ='-'+ text.substring(1).replace("-", "");
                else
                    text =text.replace("-", "");
            }

            var arr:Array = TextInput(event.currentTarget).text.split(".");
            try{
                if(arr[1] && String(arr[1]).length > 2){                        
                    TextInput(event.currentTarget).text = arr[0]+"."+String(arr[1]).slice(0,2);
                }
            }catch(err:Error){}

            this.selectRange((text.length), (text.length));
        }
    }
} 
```

# php - 禁用 cookie 时 PHP 会话如何工作？

> ID：613967
> 
> 赞同：18
> 
> 时间：2009-03-05T08:27:18.857
> 
> 标签：php, session, cookies

我试图研究这种机制，但只找到了一些提示，而且这些提示并不是很一致。session_id 是如何发送到浏览器的，当用户请求一个新页面时，浏览器是如何指示返回它的？

谢谢，克里斯

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-05T08:37:51.420

PHP 会做两件事：

*   它将重写所有链接以传递额外的 GET 参数，通常是 PHPSESSID 但这可以通过在 php.ini 中设置 session.name 来更改
*   它将在所有`<form>`打开标签之后添加一个具有相同名称的隐藏输入。

请注意，这样做很危险，因为您复制/粘贴包含 PHPSESSID 参数的 URL 的任何人都将能够在站点上共享您的登录会话 - 网络服务器没有简单的方法来告诉您与您将链接发送给的人...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T08:39:24.380

PHP 自己的会话模块支持从 GET 和 POST 数据中获取会话 id（除了 cookie）。您可以使用[http://uk.php.net/manual/en/session.configuration.php#ini.session.use-trans-sid](http://uk.php.net/manual/en/session.configuration.php#ini.session.use-trans-sid)和[http://uk.php.net/manual/en/session.configuration .php#ini.url-rewriter.tags](http://uk.php.net/manual/en/session.configuration.php#ini.url-rewriter.tags)让 php 处理 id 的转发。但无论如何请记住，特别是如果您使用 GET 传输 id，则更有可能您的一些用户意外泄露了他们的（有效）会话 id。

底层机制并不关心会话 id 是*如何*从客户端传输到服务器的。只要你将“正确”的值传递给 session_id() 它就会起作用——即使你做了一些奇怪的事情（愚蠢的？），比如滥用 etag-header 作为会话 ID 的工具；-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-30T11:03:37.330

会话通过为每个访问者创建唯一 ID (UID) 并基于此 UID 存储变量来工作。UID 要么 (1) 存储在 cookie 中，要么 (2) 在 URL 中传播。

# c++ - 虚拟机软件优化

> ID：613968
> 
> 赞同：12
> 
> 时间：2009-03-05T08:27:23.943
> 
> 标签：c++, optimization, virtualization

当您知道您的软件（不是驱动程序，不是操作系统的一部分，只是一个应用程序）将主要在虚拟化环境中运行时，是否有策略来优化您的代码和/或编译器设置？或者任何关于你应该做什么和不应该做什么的指南？

这不是关于 0.0x% 的性能提升，而是也许，只是也许有一些简单的事情会显着提高性能，或者一些看似简单但在虚拟化环境中众所周知的灾难性的事情。例如，在内核构建中启用 CONFIG_PARAVIRT 很容易完成，并且可以大大提高性能。现在我正在为应用程序寻找类似的东西，如果有的话。

在我的情况下，它将是 C++ 代码，可能是 VMWare，但我想尽可能地保持这个问题与语言/产品无关。我想知道是否有这样的策略，或者这是否会完全浪费时间——毕竟虚拟化的概念是你不必太在意它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T10:39:07.557

我发现这完全是关于 I/O 的。

虚拟机在 IO 上的表现通常非常糟糕。这使得各种事情比在真正的锡上要糟糕得多。

交换尤其是一个糟糕的杀手——它完全破坏了虚拟机的性能，即使是一点点，因为 IO 太慢了。

大多数实现在虚拟机之间都有大量的 IO 争用，我还没有看到一个可以避免这种情况或明智地处理它的方法。

因此，如果可以的话，请为临时文件使用 ramdisc，但不要导致它交换，因为那样会更糟。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T08:58:31.713

我能给你的唯一建议是小心使用 mlock() / mlockall() .. 同时寻找有问题的气球驱动程序。

例如，如果 Xen 来宾以 1GB 启动，然后膨胀到 512 MB，特权域没有查看半虚拟化内核实际承诺给进程的内存量（即 Committed_AS）是非常典型的。实际上，对于 Xen，除非将这个值放在 Xenbus 上，否则特权主机不知道这样的气球会做什么。我相信这也与 KVM 不谋而合，具体取决于内核的配置方式.. 但您的问题假定我们对这些事情一无所知:)

所以，保护那些根本无法被分页的东西（小心，但谨慎），总是考虑到“天塌下来”的情况。

同样，使用 posix_fadvise() / posix_madvise() 告诉 PV 内核您需要或不需要缓冲多少总是一个好主意。

除此之外，您几乎无能为力......因为您只与半虚拟化内核交谈，该内核旨在使进程首先忽略虚拟化。

虽然我计划在未来更多地探索它，但我（还）不怎么使用 KVM。然而，我最近写的 90% 的东西都是专门为在半虚拟化 Xen 客户机上运行而设计的。很抱歉有点以 Xen / C 为中心，但这就是我的经验所在，pv_ops 也在主线中（很快还有 xen-0 ops）:)

好问题，顺便说一句:)

**编辑：**

当我说“谨慎但谨慎”时，我的意思是比保守高出一步。如果您的程序分配了大多数功能需要的一些作业结构，请将其锁定。如果您分配缓冲区来读取大文件，请不要锁定它们.. 并确保调用 posix_fadvise() 让内核知道您只打算访问它一次（如果是这种情况）。此外，请务必告知内核您使用内存映射文件，特别是如果它们用于组织并发性。

简而言之，帮助您的主机内核管理内存，不要让关键分配的块陷入脏页，不要通过锁定它分配的所有内容来假设您的程序比其他任何事情都重要:)

很抱歉模棱两可。我能想到的最好的短语是“小心，但谨慎”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T09:18:56.830

我唯一的建议是尽可能降低内存和 IO 使用率。

与物理硬件相比，VM 中的 IO 非常慢。如果你能避免这样做，那就避免它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T09:20:53.877

当系统被虚拟化时，真实硬件上慢的东西甚至更慢。这取决于所使用的虚拟化技术会变慢多少。

尤其要避免任何需要与虚拟环境之外的世界进行 I/O 的事情。根据设置的不同，这包括在屏幕上绘图、交换以及磁盘和网络 I/O。这大致按重要性递减顺序排列。

如果可能的话，假装你正在为一台使用了十年的电脑写作。如果您的应用程序可以在 1999 年的台式 PC 或笔记本电脑上运行，那么它应该可以。

# pdf - 带有飞碟/iText 的 pdf 横向和纵 向

> ID：613971
> 
> 赞同：17
> 
> 时间：2009-03-05T08:28:35.000
> 
> 标签：pdf, itext

有没有办法使用 Flying Saucer/iText 设置不同的页面样式？我需要将前几页设为横向，然后在某个页面切换到纵向并退出。

有任何想法吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-05T09:02:42.187

没关系，找到答案了。对于任何感兴趣的人，这就是您的操作方式：

```
@page land { size:landscape; }
@page port { size:portrait; }
.landscapePage { page:land; }
.portraitPage { page:port; } 
```

瞧！

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-08-24T10:16:33.877

对于仍然坚持 Derek 提到的问题的任何人，我发现我需要在切换其布局的元素上显式设置宽度。所以使用示例 div

```
<div class="portraitPage">
    <p>Some page content in portrait</p>
</div>
<div class="landscapePage">
    <p>Some page content in landscape</p>
</div> 
```

它将正确格式化纵向页面，然后是横向页面，但横向页面中的内容将仅与纵向页面一样宽，即使*@page 土地*声明包含宽度。我需要的是直接在应用了相关类的 div 上设置宽度，所以声明更像

```
.landscapePage { page:land; width: 29.7cm; } 
```

请注意，宽度应考虑通过 @page 声明块应用的任何边距或填充。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-12T10:40:31.757

您可以在运行时动态处理页面大小。请按照以下步骤

1.  在 pageType 参数中为页面类型添加额外参数，例如横向或纵向
2.  当您在服务器端生成 html 时，在样式标签中添加以下代码，例如

> ```
> FileOutputStream fos = new FileOutputStream(file);
> ITextRenderer renderer = new ITextRenderer();
> StringBuilder htmls = new StringBuilder();
> htmls.append("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
> htmls.append("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">");
> htmls.append("<html xmlns=\"http://www.w3.org/1999/xhtml\">");
> htmls.append("<head><style type=\"text/css\">");
> htmls.append("@page{ size: "+request.getParameter("pageType")}");
> htmls.append("</style></head>");
> htmls.append("<body><div>dynamic pdf data</div></body></html>");
> renderer.getFontResolver().addFont("C:\\Windows\\Fonts\\Calibri.ttf","UTF-8",BaseFont.NOT_EMBEDDED);
> renderer.setDocumentFromString(htmls.toString());
> renderer.layout();
> response.setContentType("application/octet-stream");
> response.setHeader("Content-Disposition", "attachment;filename=\"" + fileName + ".pdf\"");
> renderer.createPDF(outputStream);
> renderer.createPDF(fos); 
> ```

# java - Netbeans 6.5：在运行/调试/测试期间更改环境变量？

> ID：613973
> 
> 赞同：3
> 
> 时间：2009-03-05T08:29:54.340
> 
> 标签：java, netbeans, ant

直到 Netbeans 6.1，我在运行/调试/测试任务期间使用以下配方更改 PATH 环境变量：在我包含的 build.xml 文件中：

```
<property environment="env"/>
<目标名称="-init-macrodef-java">
   <macrodef name="java" uri="http://www.netbeans.org/ns/j2se-project/1">
       <attribute default="${main.class}" name="classname"/>
       <element name="customize" optional="true"/>
       <顺序>
           <java classname="@{classname}" dir="${work.dir}" fork="true">
               <jvmarg line="${run.jvmargs}"/>
               <env key="Path" path="${work.dir}/../../bin;${env.Path}">                              
...

```

（这适用于 Windows 机器）。在 Netbeans 6.5 下，这种魔法似乎不再起作用，不适用于 PATH 或其他环境变量（使用 key="..." value="..." 代替）。我从头开始重建 NB 项目，但收效甚微，而且我一开始就不是 Ant 专家。任何指示/建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T10:30:04.577

尝试使用

```
 <env key="PATH" path="..."/> 
```

代替

```
 <env key="Path"  path="..."/> 
```

仅在 Windows 和 ant > 1.7 上不区分大小写

# command-line - 如何与其他人共享 Putty 会话？

> ID：613975
> 
> 赞同：0
> 
> 时间：2009-03-05T08:31:04.417
> 
> 标签：command-line, ssh, remote-desktop

我正在寻找类似 VNC 的命令行界面。具体来说，我希望能够与在全国各地的另一个办公室工作的其他人共享一个 ssh 会话（比如通过 Putty）。我们都可以在控制台中输入东西，然后看看对方在做什么（包括更复杂的东西，比如 vim 和 top）。在我看来，对于这样的事情，完全图形化的 VNC 太过分了。有什么办法可以设置吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T08:34:19.277

[多用户屏幕](http://aperiodic.net/screen/multiuser)- 它不需要客户端上的任何内容。

# java - 使用 Swing + 模型时识别组合框取消选择？

> ID：613981
> 
> 赞同：1
> 
> 时间：2009-03-05T08:35:07.997
> 
> 标签：java, swing, events, model, jcombobox

我正在尝试在 Swing 中编写一个漂亮的 GUI，尽可能地使用正确的模型委托模式。我有一个 JComboBox，当它发生变化时，需要用新数据更新模型。要获取当前选定的项目，我正在使用：

```
fooCombo.addItemListener(new ItemListener() {
    public void itemStateChanged(final ItemEvent arg0) {
        fooChangedHandler((Foo) fooModel.getSelectedItem());
    }
}); 
```

它将数据更改为一个不错的对象返回。但是，我找不到找到旧值的方法，所以我不知道需要更改哪个对象。这里有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T05:46:50.280

最终根本不去模型，而是从 getItem 方法中获取我的对象，如下所示：

```
`public void itemStateChanged(final ItemEvent event) {
    if (event.getStateChange() == event.DESELECTED) {
        deselectedFoo = (Foo) event.getItem();
    } 
    else if (event.getStateChange() == event.SELECTED) {
        FooChangedHandler(deselectedFoo,(Foo) event.getItem());
    }
}` 
```

* * *

 `## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T10:19:37.027

```
Foo oldFoo;
....
fooCombo.addItemListener(new ItemListener() {
    public void itemStateChanged(final ItemEvent arg0) {
        Foo newFoo = (Foo) fooModel.getSelectedItem();
        fooChangedHandler(oldFoo, newFoo);
        oldFoo = newFoo;
    }
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T09:52:39.540

由于默认的 ComboBoxModel 和 ItemEvent 不允许您获得先前选择的值，因此您可以使用此功能实现您自己的 ComboBoxModel。

# ruby - 常见的 Ruby 习语

> ID：613985
> 
> 赞同：68
> 
> 时间：2009-03-05T08:35:51.160
> 
> 标签：ruby, idioms

我喜欢 ruby​​ 的一件事是它主要是一种非常易读的语言（这对于自记录代码来说非常有用）

然而，受这个问题的启发：[Ruby Code explain](https://stackoverflow.com/questions/609612/ruby-code-explained) and the description of how `||=`works in ruby​​，我在想我不使用的 ruby​​ 成语，坦率地说，我并没有完全理解它们。

所以我的问题是，类似于引用问题中的示例，我需要了解哪些常见但不明显的 ruby​​ 习语才能成为真正精通的 ruby​​ 程序员？

顺便说一句，从引用的问题

```
a ||= b 
```

相当于

```
if a == nil || a == false
  a = b
end 
```

（感谢 Ian Terrell 的更正）

**编辑：**事实证明，这一点并非完全没有争议。正确的展开其实是

```
(a || (a = (b))) 
```

请参阅以下链接了解原因：

*   [http://DABlog.RubyPAL.Com/2008/3/25/a-short-circuit-edge-case/](http://DABlog.RubyPAL.Com/2008/3/25/a-short-circuit-edge-case/)
*   [http://DABlog.RubyPAL.Com/2008/3/26/short-circuit-post-correction/](http://DABlog.RubyPAL.Com/2008/3/26/short-circuit-post-correction/)
*   [http://ProcNew.Com/ruby-short-circuit-edge-case-response.html](http://ProcNew.Com/ruby-short-circuit-edge-case-response.html)

感谢 Jörg W Mittag 指出这一点。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-03-05T09:27:09.010

让同一个文件充当库或脚本的神奇 if 子句：

```
if __FILE__ == $0
  # this library may be run as a standalone script
end 
```

打包和解包数组：

```
# put the first two words in a and b and the rest in arr
a,b,*arr = *%w{a dog was following me, but then he decided to chase bob}
# this holds for method definitions to
def catall(first, *rest)
  rest.map { |word| first + word }
end
catall( 'franken', 'stein', 'berry', 'sense' ) #=> [ 'frankenstein', 'frankenberry', 'frankensense' ] 
```

哈希作为方法参数的语法糖

```
this(:is => :the, :same => :as)
this({:is => :the, :same => :as}) 
```

哈希初始化器：

```
# this
animals = Hash.new { [] }
animals[:dogs] << :Scooby
animals[:dogs] << :Scrappy
animals[:dogs] << :DynoMutt
animals[:squirrels] << :Rocket
animals[:squirrels] << :Secret
animals #=> {}
# is not the same as this
animals = Hash.new { |_animals, type| _animals[type] = [] }
animals[:dogs] << :Scooby
animals[:dogs] << :Scrappy
animals[:dogs] << :DynoMutt
animals[:squirrels] << :Rocket
animals[:squirrels] << :Secret
animals #=> {:squirrels=>[:Rocket, :Secret], :dogs=>[:Scooby, :Scrappy, :DynoMutt]} 
```

元类语法

```
x = Array.new
y = Array.new
class << x
  # this acts like a class definition, but only applies to x
  def custom_method
     :pow
  end
end
x.custom_method #=> :pow
y.custom_method # raises NoMethodError 
```

类实例变量

```
class Ticket
  @remaining = 3
  def self.new
    if @remaining > 0
      @remaining -= 1
      super
    else
      "IOU"
    end
  end
end
Ticket.new #=> Ticket
Ticket.new #=> Ticket
Ticket.new #=> Ticket
Ticket.new #=> "IOU" 
```

块、过程和 lambda。生活和呼吸它们。

```
 # know how to pack them into an object
 block = lambda { |e| puts e }
 # unpack them for a method
 %w{ and then what? }.each(&block)
 # create them as needed
 %w{ I saw a ghost! }.each { |w| puts w.upcase }
 # and from the method side, how to call them
 def ok
   yield :ok
 end
 # or pack them into a block to give to someone else
 def ok_dokey_ok(&block)
    ok(&block)
    block[:dokey] # same as block.call(:dokey)
    ok(&block)
 end
 # know where the parentheses go when a method takes arguments and a block.
 %w{ a bunch of words }.inject(0) { |size,w| size + 1 } #=> 4
 pusher = lambda { |array, word| array.unshift(word) }
 %w{ eat more fish }.inject([], &pusher) #=> ['fish', 'more', 'eat' ] 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-05T09:22:29.347

这张[幻灯片](http://cbcg.net/talks/rubyidioms/)非常完整地介绍了主要的 Ruby 习语，如下所示：

*   交换两个值：

    `x, y = y, x`

*   如果未指定，则采用某些默认值的参数

    `def somemethod(x, y=nil)`

*   将无关参数批处理到数组中

    `def substitute(re, str, *rest)`

等等...

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-07-04T21:47:35.723

还有一些成语：

和分隔符`%w`的使用`%r``%(`

```
%w{ An array of strings %}
%r{ ^http:// }
%{ I don't care if the string has 'single' or "double" strings } 
```

case 语句中的类型比较

```
def something(x)
  case x
    when Array
      # Do something with array
    when String
      # Do something with string
    else
      # You should really teach your objects how to 'quack', don't you?
  end
end 
```

`===`...以及在案例陈述中对该方法的整体滥用

```
case x
  when 'something concrete' then ...
  when SomeClass then ...
  when /matches this/ then ...
  when (10...20) then ...
  when some_condition >= some_value then ...
  else ...
end 
```

`each`对 Ruby主义者来说应该看起来很自然的东西，但对于来自其他语言的人来说可能不是这样：使用`for .. in`

```
some_iterable_object.each{|item| ... } 
```

在 Ruby 1.9+、Rails 中，或者通过修补 Symbol#to_proc 方法，[这](http://blog.thoughtfolder.com/2008-02-25-a-detailed-explanation-of-ruby-s-symbol-to-proc.html)正变得越来越流行：

```
strings.map(&:upcase) 
```

条件方法/常量定义

```
SOME_CONSTANT = "value" unless defined?(SOME_CONSTANT) 
```

查询方法和破坏性（bang）方法

```
def is_awesome?
  # Return some state of the object, usually a boolean
end

def make_awesome!
  # Modify the state of the object
end 
```

隐式 splat 参数

```
[[1, 2], [3, 4], [5, 6]].each{ |first, second| puts "(#{first}, #{second})" } 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-05T09:08:46.247

我喜欢这个：

```
str = "Something evil this way comes!"
regexp = /(\w[aeiou])/

str[regexp, 1] # <- This 
```

这（大致）相当于：

```
str_match = str.match(regexp)
str_match[1] unless str_match.nil? 
```

或者至少那是我用来替换这些块的东西。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-05T09:27:51.770

我建议通读你钦佩和尊重的人的流行和精心设计的插件或宝石的代码。

我遇到的一些例子：

```
if params[:controller] == 'discussions' or params[:controller] == 'account'
  # do something here
end 
```

对应于

```
if ['account', 'discussions'].include? params[:controller]
  # do something here
end 
```

稍后将被重构为

```
if ALLOWED_CONTROLLERS.include? params[:controller]
  # do something here
end 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-05T09:47:55.433

这里有一些，从各种来源中挑选出来的：

使用“除非”和“直到”而不是“如果不是”和“而不是”。但是，当存在“其他”条件时，尽量不要使用“除非”。

请记住，您可以一次分配多个变量：

```
a,b,c = 1,2,3 
```

甚至交换没有临时变量的变量：

```
a,b = b,a 
```

在适当的地方使用尾随条件，例如

```
do_something_interesting unless want_to_be_bored? 
```

请注意定义类方法的常用但不是立即显而易见（至少对我而言）的方式：

```
class Animal
  class<<self
    def class_method
      puts "call me using Animal.class_method"
    end
  end
end 
```

一些参考资料：

*   [http://cbcg.net/talks/rubyidioms/index.html](http://cbcg.net/talks/rubyidioms/index.html)
*   [http://www.therailsway.com/2006/12/8/idiomatic-ruby](http://www.therailsway.com/2006/12/8/idiomatic-ruby)
*   [http://www.therailsway.com/2007/1/21/more-idiomatic-ruby](http://www.therailsway.com/2007/1/21/more-idiomatic-ruby)
*   [http://www.caliban.org/ruby/rubyguide.shtml](http://www.caliban.org/ruby/rubyguide.shtml)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-05T15:23:49.120

> 顺便说一句，从引用的问题
> 
> ```
> a ||= b 
> ```
> 
> 相当于
> 
> ```
> if a == nil   
>   a = b 
> end 
> ```

这是不正确的，并且是新手 Ruby 应用程序中错误的来源。

由于两者（并且唯一）`nil`和`false`评估为布尔假，`a ||= b`实际上（几乎*）等同于：

```
if a == nil || a == false
  a = b
end 
```

或者，用另一个 Ruby 习语重写它：

```
a = b unless a 
```

（*由于每个语句都有一个值，因此这些在技术上并不等同于`a ||= b`。但如果您不依赖该语句的值，您将看不到差异。）

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-09-27T13:42:44.363

我维护了一个 wiki 页面，其中涵盖了一些 Ruby 习语和格式：

[https://github.com/tokland/tokland/wiki/RubyIdioms](https://github.com/tokland/tokland/wiki/RubyIdioms)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-10-25T17:53:18.167

我总是忘记这个简写 if else 语句的确切语法（以及运算符的名称。评论任何人？）我认为它在 ruby​​ 之外被广泛使用，但如果其他人想要这里的语法，它是：

```
refactor < 3 ? puts("No need to refactor YET") : puts("You need to refactor this into a  method") 
```

扩展到

```
if refactor < 3
  puts("No need to refactor YET")
else
  puts("You need to refactor this into a  method")
end 
```

*更新*

称为三元运算符：

返回 myvar ？我的变量大小：0

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-04T21:13:23.980

您可以轻松地使用 Marshaling 对象进行深度复制。- 取自 The Ruby Programming Language

```
def deepcopy(o)
  Marshal.load(Marshal.dump(o))
end 
```

> 请注意，文件和 I/O 流以及 Method 和 Binding 对象过于动态而无法编组；没有可靠的方法来恢复他们的状态。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-03-09T20:13:42.867

```
a = (b && b.attribute) || "default" 
```

大致是：

```
if ( ! b.nil? && ! b == false) && ( ! b.attribute.nil? && ! b.attribute.false) a = b
else a = "default" 
```

当 b 是可能已找到或未找到的记录时，我使用它，并且我需要获取它的一个属性。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-02-09T00:51:51.967

我喜欢 If-then-elses 或 case-when 可以如何缩短，因为它们返回一个值：

```
if test>0
  result = "positive"
elsif test==0
  result = "zero"
else
  result = "negative"
end 
```

可以重写

```
result = if test>0
  "positive"
elsif test==0
  "zero"
else
  "negative"
end 
```

这同样适用于 case-when：

```
result = case test
when test>0 ; "positive"
when test==0 ; "zero"
else "negative"
end 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-04-22T00:30:08.500

好问题！

我认为代码越直观、越快，我们正在构建的软件就越好。我将向您展示我如何使用 Ruby 在小段代码中表达我的想法。[**在这里阅读更多**](https://medium.com/the-renaissance-developer/idiomatic-ruby-1b5fa1445098)

**地图**

我们可以通过不同的方式使用 map 方法：

```
user_ids = users.map { |user| user.id } 
```

或者：

```
user_ids = users.map(&:id) 
```

**样本**

我们可以使用 rand 方法：

```
[1, 2, 3][rand(3)] 
```

随机播放：

```
[1, 2, 3].shuffle.first 
```

以及惯用、简单和最简单的方法……示例！

```
[1, 2, 3].sample 
```

**双管等于/记忆**

正如您在描述中所说，我们可以使用记忆：

```
some_variable ||= 10
puts some_variable # => 10

some_variable ||= 99
puts some_variable # => 10 
```

**静态方法/类方法**

我喜欢使用类方法，我觉得这是一种非常惯用的创建和使用类的方式：

```
GetSearchResult.call(params) 
```

简单的。美丽的。直觉的。后台发生了什么？

```
class GetSearchResult
  def self.call(params)
    new(params).call
  end

  def initialize(params)
    @params = params
  end

  def call
    # ... your code here ...
  end
end 
```

有关编写惯用 Ruby 代码的更多信息，请阅读[**此处**](https://medium.com/the-renaissance-developer/idiomatic-ruby-1b5fa1445098)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-03-28T09:49:34.713

Array.pack 和 String.unpack 用于处理二进制文件：

```
# extracts four binary sint32s to four Integers in an Array
data.unpack("iiii") 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-06-20T10:13:42.753

方法缺少魔法

```
class Dummy  
  def method_missing(m, *args, &block)  
    "You just called method with name #{m} and arguments- #{args}"  
  end  
end

Dummy.new.anything(10, 20)
=> "You just called method with name anything and arguments- [10, 20]" 
```

如果您调用 ruby​​ 对象中不存在的方法，ruby 解释器将调用名为“method_missing”的方法（如果已定义），您可以将其用于一些技巧，例如编写 api 包装器或 dsl，您不知道所有方法和参数名字

# c# - 如何从 WCF AuthenticationService 获取用户名？

> ID：613989
> 
> 赞同：3
> 
> 时间：2009-03-05T08:36:29.567
> 
> 标签：c#, wcf

`AuthenticationService.isLoggedIn()`当结果为真时，如何获取登录用户的名称？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T19:44:09.567

通常我会从 ServiceSecurityContext.Current 中找到 WCF 安全信息。尝试 ServiceSecurityContext.Current.PrimaryIdentity

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T09:09:04.090

您是否尝试过查看 Thead.CurrentPrincipal？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-30T19:35:18.683

ServiceSecurityContext.Current.WindowsIdentity.Name

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-18T12:34:29.557

`WebContext.Current.Authentication`?

# php - 在 CakePHP 中创建动态数据库驱动菜单的最佳方法是什么？

> ID：613996
> 
> 赞同：9
> 
> 时间：2009-03-05T08:41:06.890
> 
> 标签：php, cakephp

我想在从数据库运行的每个页面上显示一个菜单。使用简单而肮脏的 php 很容易，但我想使用他们的 MVC 系统将它与 cakephp 集成。现在我的问题是最好的方法是如何做到这一点？

我的想法是用布局制作一个元素，然后为所有逻辑制作一个组件或控制器。对此有何建议？或者是我想要使用的助手？

我还需要从数据库中的多个表中获取所有数据。最好通过一个模型来完成我所有的数据收集逻辑吗？还是在菜单控制器（或组件）中完成大部分操作并为每个表使用模型？

谢谢，

沃尔特

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T09:40:57.480

模型应该从他们正在建模的表中获取和处理数据，因此为该模型中的每个模型获取菜单数据。

组件旨在容纳多个控制器共享的逻辑，因此所有控制器都使用的菜单组件听起来像是放置代码以从模型中获取菜单数据并将其混合在一起的好地方。

菜单通常是嵌套列表，如果您的菜单也是这种情况，那么输出标记的最简单方法是递归函数（一个调用自身的函数），它一次输出一个级别，而不是元素，我只需在其中创建一个带有 menu() 方法的助手，然后直接从布局中调用它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T16:54:06.017

我同意 neilcrooks 的回答，但为了清楚起见，我想添加一些内容。

助手和元素非常简单，除了助手可以更健壮一些（至少，这就是我对他们的看法；））。因此，如果您使用帮助程序，您可以即时绑定和取消绑定模型关联——这将允许您从（临时）关联模型中获取数据。

就个人而言，我喜欢胖模型和瘦控制器，所以我想如果我处于这种情况，我会使用一个助手并将模型临时绑定到它。我需要从现有模型中获取的任何数据都将通过 Model1->fetchMenuPart(...) 类型调用进行访问。

然后你可以从你的布局文件中调用你的助手。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-31T23:12:51.463

我不知道为什么在任何地方都没有记录，但我昨晚才发现这个。您的布局或元素的变量必须以 _for_layout 结尾。例如：$this->set('categories_for_layout',$this->Category->find('all'));

我在 AppController 类中使用了 beforeFilter 方法，因为我在每个页面中都需要该菜单。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-28T18:32:53.827

这是我在互联网上搜索这个东西时发现的一个很好的解决方案。

[http://articles.classoutfit.com/cakephp-dynamic-navigation-bars/](http://articles.classoutfit.com/cakephp-dynamic-navigation-bars/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T07:30:01.537

我想你会使用创建一个元素来保存菜单的 html，然后在你的布局中呈现菜单。

```
echo $this->element('your menu'); 
```

为了使其动态化，您可以设置菜单链接，可能是控制器中的数组。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-06T00:35:53.817

我在这里找到了一篇好文章 [http://www.milestree.com/webdev/cakephp/dynamic_menu](https://web.archive.org/web/20100124090913/http://www.milestree.com/webdev/cakephp/dynamic_menu)

# vb.net - VB.NET 中共享变量有什么用？

> ID：613998
> 
> 赞同：36
> 
> 时间：2009-03-05T08:41:23.877
> 
> 标签：vb.net

`Shared`VB.NET中变量的用途是什么？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-05T08:46:18.250

它与`static`C# 和大多数其他语言中的相同。这意味着类中的每个对象都使用相同的变量、属性或方法副本。当与静态方法一起使用时，您不需要对象实例。

```
MyClass.DoSomething() 
```

而不是

```
Dim oObject as New MyClass()
oObject.DoSomething() 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-05T08:52:34.240

VB.NET 中的“Shared”关键字等同于 C# 中的“static”关键字。

在 VB.NET 中，Shared 关键字可以应用于类中的 Dim、Event、Function、Operator、Property 和 Sub 语句；但是，在 C# 中，`static`关键字既可以应用于普通类中的这些语句，也可以应用于类级别以使整个类成为静态的。

“共享”或“静态”方法作用于“类型”（即类），而不是作用于类型/类的*实例*。由于`Shared`方法（或变量）作用于类型而不是实例，因此在非共享（即，实例）方法或变量。

例如：如果你有一个类，让我们用一个名为 MyMethod 的非共享方法将它称为 MyClass。

```
Public Class MyClass
    Public Sub MyMethod()
        ' Do something in the method
    End Sub
End Class 
```

为了调用该方法，您需要一个类的实例才能调用该方法。就像是：

```
Dim myvar As MyClass = New MyClass()
myvar.MyMethod() 
```

如果此方法随后被制成“共享”方法（通过在方法定义中添加“共享”限定符，则不再需要类的实例来调用该方法。

```
Public Class MyClass
    Public Shared Sub MyMethod()
        ' Do something in the method
    End Sub
End Class 
```

进而：

```
MyClass.MyMethod() 
```

您还可以在 .NET 框架本身中看到这方面的示例。例如，“字符串”类型有许多静态/共享方法。IE

```
' Using an instance method (i.e. Non-shared) of the string type/class.
Dim s As String = "hello"
s.Replace("h", "j")

' Using a static/shared method of the string type/class.
s = String.Concat(s, " there!"); 
```

这是一篇很好的文章，可以进一步解释它：

[VB.NET 中的共享成员和实例成员](http://visualbasic.about.com/od/learnvbnet/a/sharedinstance.htm)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-05T08:48:34.110

只要你想为整个应用程序拥有一个变量实例，在你的类的对象之间共享。而不是每个对象 1 个。`********